0000                ;	LSX-Dodgers for X1/turbo/Z
0000                ;	Programmed by
0000                ;	Gaku (Lovers/Tablacus)
0000                
0000 00 00 C6 00    RUN	EQU	0C600h
0000                
0000                	ORG	RUN-7
C5F9                
C5F9                ;	MSX BINARY HEADER
C5F9 FE             	DB	0FEH
C5FA                ;	MSX BINARY START ADDRESS
C5FA 00 C6          	DW	RUN
C5FC                ;	MSX BINARY END ADDRESS
C5FC E0 ED          	DW	LDEND
C5FE                ;	MSX BINARY EXEC ADDRESS
C5FE 00 C6          	DW	RUN
C600                
C600                	INCLUDE	"LDDEF.ASM"
C600                
C600                ;	LSX-Dodgers DEF
C600                
C600 00 00 1D 90    MAC	EQU	01D90H		;X1
C600 00 00 00 01    VER_1   EQU	1
C600 00 00 00 03    VER_2   EQU	3
C600 00 00 00 09    VER_3   EQU	9
C600 00 00 01 3C    VER	EQU	VER_1 * 256 + VER_2 * 17 + VER_3
C600                
C600 00 00 00 05    SYSTEM	EQU	00005H
C600 00 00 00 0F    JP_HL	EQU	0000FH
C600 00 00 00 5C    FCB1	EQU	0005CH
C600 00 00 00 6C    FCB2	EQU	0006CH
C600 00 00 00 5D    FCB1FN	EQU	FCB1+1
C600 00 00 00 6D    FCB2FN	EQU	FCB2+1
C600 00 00 00 80    DTA1	EQU	00080H
C600 00 00 EE 00    FATBF	EQU	0EE00H
C600 00 00 FA 00    DTBUF	EQU	0FA00H
C600 00 00 FE 00    KEYBF	EQU	0FE00H
C600 00 00 FF 00    KBUF	EQU	0FF00H
C600 00 00 FF A0    STACK	EQU	0FFA0H
C600 00 00 00 00    EXTSP	EQU	00000H
C600 00 00 00 18    LINE	EQU	24
C600                	INCLUDE	"LDINIT.ASM"
C600                
C600                ;	LSX-Dodgers INIT
C600                
C600 C3 07 C6       	JP	START
C603 90 1D          MACHINE:DW	MAC
C605 3C 01          VERSION:DW	VER
C607                
C607                START:
C607 F3             	DI
C608 ED 5E          	IM	2
C60A 31 00 00       	LD	SP,EXTSP
C60D CD 1B C6       	CALL	INIT		;NZならAUTOEXECを実行
C610 21 00 00       	LD	HL,0
C613 E5             	PUSH	HL
C614 C8             	RET	Z
C615 11 B6 C9       	LD	DE,AUTOD
C618 C3 FD EC       	JP	_COMANL
C61B                
C61B                INIT:
C61B 3E 1E          	LD	A,01EH
C61D D3 00          	OUT	(0),A
C61F                
C61F 01 00 00       	LD	BC,0
C622 ED 43 8C EC    	LD	(_CTC),BC
C626 01 04 0A       	LD	BC,00A04H
C629 CD 60 C9       	CALL	CHKCTC
C62C 01 04 07       	LD	BC,00704H
C62F CD 60 C9       	CALL	CHKCTC
C632 01 A8 1F       	LD	BC,01FA8H
C635 CD 60 C9       	CALL	CHKCTC
C638 01 A0 1F       	LD	BC,01FA0H
C63B CD 60 C9       	CALL	CHKCTC
C63E                ;
C63E                INISIO:
C63E 01 91 1F       	LD	BC,01F91H	;INIT SIO
C641 16 01          	LD	D,1
C643 ED 51          	OUT	(C),D
C645                
C645 ED 71          	DB	0EDH,071H	;OUT (C),0	Z80未定義命令
C647 0E 93          	LD	C,093H
C649 ED 51          	OUT	(C),D
C64B ED 71          	DB	0EDH,071H	;OUT (C),0	Z80未定義命令
C64D 0E 99          	LD	C,099H		;INIT SIO
C64F 16 01          	LD	D,1
C651 ED 71          	DB	0EDH,071H	;OUT (C),0	Z80未定義命令
C653 0E 9B          	LD	C,09BH
C655 ED 51          	OUT	(C),D
C657 ED 71          	DB	0EDH,071H	;OUT (C),0	Z80未定義命令
C659                
C659 0E 80          	LD	C,080H		;INIT DMA
C65B 21 06 C3       	LD	HL,0C306H
C65E                INIDMA:
C65E ED 61          	OUT	(C),H
C660 2D             	DEC	L
C661 20 FB          	JR	NZ,INIDMA
C663                
C663 3E E4          	LD	A,0E4H
C665 CD 78 DA       	CALL	COMOUT
C668 AF             	XOR	A
C669 CD 52 DA       	CALL	OT49SB
C66C                
C66C 3E EC          	LD	A,INTVEC/256
C66E ED 47          	LD	I,A
C670                
C670 ED 4B 8C EC    	LD	BC,(_CTC)
C674 0B             	DEC	BC
C675 0B             	DEC	BC
C676                
C676 ED 71          	DB	0EDH,071H	;OUT (C),0	Z80未定義命令
C678 3E C0          	LD	A,CTC0
C67A ED 79          	OUT	(C),A
C67C                
C67C 0C             	INC	C
C67D 3E 47          	LD	A,047H
C67F ED 79          	OUT	(C),A
C681 3E 0D          	LD	A,13		;Baudrate 9600-13
C683 ED 79          	OUT	(C),A
C685                
C685 79             	LD	A,C
C686 D6 10          	SUB	010H
C688 4F             	LD	C,A
C689                ;	LD	(SIOAD+1),BC
C689                ;	LD	(SIOAD0+1),BC
C689                ;	LD	(SIOAD1+1),BC
C689                
C689 21 18 CA       	LD	HL,SIODATA
C68C                SINIT1:
C68C 7E             	LD	A,(HL)
C68D 23             	INC	HL
C68E FE FF          	CP	0FFH
C690 28 04          	JR	Z,SINIT2
C692 ED 79          	OUT	(C),A
C694 18 F6          	JR	SINIT1
C696                SINIT2:
C696 3E E4          	LD	A,0E4H
C698 CD 78 DA       	CALL	COMOUT
C69B 3E C8          	LD	A,INTVEC
C69D CD 52 DA       	CALL	OT49SB
C6A0                ;
C6A0 01 C4 1F       	LD	BC,01FC4H
C6A3 3E 0C          	LD	A,00CH
C6A5 ED 79          	OUT	(C),A
C6A7                
C6A7 0E C0          	LD	C,0C0H
C6A9 ED 71          	DB	0EDH,071H	;OUT (C),0	Z80未定義命令
C6AB                
C6AB 0C             	INC	C
C6AC 3E 28          	LD	A,40
C6AE ED 79          	OUT	(C),A
C6B0                
C6B0 0C             	INC	C
C6B1 ED 71          	DB	0EDH,071H	;OUT (C),0	Z80未定義命令
C6B3                
C6B3 0C             	INC	C
C6B4 ED 71          	DB	0EDH,071H	;OUT (C),0	Z80未定義命令
C6B6                
C6B6 0E C5          	LD	C,0C5H
C6B8 ED 71          	DB	0EDH,071H	;OUT (C),0	Z80未定義命令
C6BA                
C6BA                TEXT:
C6BA 0E B0          	LD	C,0B0H
C6BC 3E 80          	LD	A,080H
C6BE ED 79          	OUT	(C),A
C6C0 16 07          	LD	D,7
C6C2 0E B9          	LD	C,0B9H
C6C4 21 11 CA       	LD	HL,TEXTDT
C6C7                TEXT1:
C6C7 04             	INC	B
C6C8 ED A3          	OUTI
C6CA 0C             	INC	C
C6CB 15             	DEC	D
C6CC 20 F9          	JR	NZ,TEXT1
C6CE 01 B0 1F       	LD	BC,01FB0H
C6D1 ED 71          	DB	0EDH,071H	;OUT (C),0	Z80未定義命令
C6D3                
C6D3 0E C4          	LD	C,0C4H
C6D5 ED 71          	DB	0EDH,071H	;OUT (C),0	Z80未定義命令
C6D7                
C6D7 01 01 1A       	LD	BC,01A01H
C6DA ED 78          	IN	A,(C)
C6DC E6 08          	AND	8
C6DE 28 09          	JR	Z,PRN
C6E0 0E 03          	LD	C,003H
C6E2 3E 0F          	LD	A,00FH
C6E4 ED 79          	OUT	(C),A
C6E6 01 04 0A       	LD	BC,00A04H
C6E9                PRN:
C6E9 21 00 00       	LD	HL,0
C6EC 06 5C          	LD	B,05CH
C6EE 3E C9          	LD	A,0C9H	;C9=RET
C6F0 CD FE DC       	CALL	FILL_MEMORY
C6F3 06 A4          	LD	B,0A4H
C6F5 AF             	XOR	A
C6F6 CD FE DC       	CALL	FILL_MEMORY
C6F9                
C6F9 3E C3          	LD	A,0C3H		;JP
C6FB 21 03 EB       	LD	HL,WBOOT
C6FE 32 00 00       	LD	(00000H),A
C701 22 01 00       	LD	(00001H),HL	;IPL
C704                
C704 2A 03 C6       	LD	HL,(MACHINE)	;3 bit7  DPB Original(1)
C707                				;  bit6-4 DPB_LEVEL
C707 22 03 00       	LD	(00003H),HL	;  bit3-0 Machine X1(0)
C70A                ;				;4 LSX-Dodgers(01DH)
C70A 21 06 CC       	LD	HL,BDOS
C70D 32 05 00       	LD	(00005H),A
C710 22 06 00       	LD	(00006H),HL	;BDOS
C713                
C713 21 49 D6       	LD	HL,BIOS
C716 32 18 00       	LD	(00018H),A	;BIOS-ROM
C719 22 19 00       	LD	(00019H),HL
C71C                
C71C 21 00 00       	LD	HL,0
C71F 32 38 00       	LD	(00038H),A	;RST038H
C722 22 39 00       	LD	(00039H),HL
C725                
C725 3E EC          	LD	A,STABLE/256
C727 32 0B 00       	LD	(0000BH),A
C72A                
C72A 3E E9          	LD	A,0E9H		;JP (HL)
C72C 32 0F 00       	LD	(0000FH),A
C72F                
C72F 3A 7D EC       	LD	A,(_FATBF+1)
C732 32 13 00       	LD	(00013H),A
C735                
C735 3A 7F EC       	LD	A,(_DTBUF+1)
C738 32 17 00       	LD	(00017H),A
C73B                
C73B 3E FE          	LD	A,KEYBF/256
C73D 32 1B 00       	LD	(0001BH),A
C740                
C740 3E FF          	LD	A,KBUF/256
C742 32 1F 00       	LD	(0001FH),A
C745                
C745 2A 05 C6       	LD	HL,(VERSION)
C748 22 5A 00       	LD	(0005AH),HL
C74B                
C74B 3E E6          	LD	A,0E6H
C74D CD 78 DA       	CALL	COMOUT
C750 CD 5D DA       	CALL	IN49SB
C753 F5             	PUSH	AF
C754 CD 5D DA       	CALL	IN49SB
C757 F1             	POP	AF
C758 F5             	PUSH	AF
C759 E6 12          	AND	012H
C75B 20 05          	JR	NZ,KEYR
C75D 3E 01          	LD	A,1
C75F 32 C6 C8       	LD	(KEYREP+1),A
C762                KEYR:
C762 F1             	POP	AF
C763 E6 03          	AND	3
C765 28 0E          	JR	Z,NON
C767                
C767 01 D0 3F       	LD	BC,03FD0H
C76A ED 49          	OUT	(C),C
C76C 3E 37          	LD	A,037H
C76E D3 D0          	OUT	(0D0H),A
C770 ED 78          	IN	A,(C)
C772 B9             	CP	C
C773 28 78          	JR	Z,TURBO
C775                NON:
C775 3D             	DEC	A		;A=0FFH
C776 32 18 00       	LD	(00018H),A	;BIOS-ROM
C779                
C779 21 24 CA       	LD	HL,AT_SCR1
C77C 11 02 DB       	LD	DE,SCR1
C77F 01 A1 00       	LD	BC,SCRNX-SCR1	;転送先のサイズ確認用
C782 01 9F 00       	LD	BC,AT_SCRE-AT_SCR1
C785 ED B0          	LDIR
C787                
C787 21 C3 CA       	LD	HL,AT_WTTRK
C78A 11 47 EA       	LD	DE,WTTRK
C78D 01 B9 00       	LD	BC,DMAE-WTTRK	;転送先のサイズ確認用
C790 01 B1 00       	LD	BC,AT_CPUE-AT_WTTRK
C793 ED B0          	LDIR
C795                
C795 21 74 CB       	LD	HL,AT_EDWT
C798 11 F6 D2       	LD	DE,EDWT
C79B 01 4C 00       	LD	BC,EMME-EDWT	;転送先のサイズ確認用
C79E 01 48 00       	LD	BC,AT_EMME-AT_EDWT
C7A1 ED B0          	LDIR
C7A3                
C7A3 21 A8 EA       	LD	HL,AT_DRD+AT_R
C7A6 22 EC EC       	LD	(_FDRD+1),HL
C7A9 21 4D EA       	LD	HL,AT_DWT+AT_R
C7AC 22 EF EC       	LD	(_FDWT+1),HL
C7AF 21 0A D3       	LD	HL,AT_EDRD+AT_RE
C7B2 22 82 ED       	LD	(EMMRD),HL
C7B5 21 F6 D2       	LD	HL,AT_EDWT+AT_RE
C7B8 22 84 ED       	LD	(EMMWR),HL
C7BB                
C7BB 3E 27          	LD	A,027H			;ノンターボはMFM切り替えを行わない
C7BD 32 12 ED       	LD	(DEVICE+012H),A		;Aドライブ
C7C0 32 32 ED       	LD	(DEVICE+012H+32),A	;Bドライブ
C7C3 32 52 ED       	LD	(DEVICE+012H+32*2),A	;Cドライブ
C7C6 32 72 ED       	LD	(DEVICE+012H+32*3),A	;Dドライブ
C7C9                
C7C9 21 00 00       	LD	HL,0
C7CC 22 A3 DA       	LD	(X1PAT),HL
C7CF                
C7CF 3E AF          	LD	A,0AFH		;XOR	A
C7D1 32 BC D8       	LD	(X1KPAT),A
C7D4                
C7D4 21 A3 DB       	LD	HL,SCRNX
C7D7 22 D1 EC       	LD	(_SCRN+1),HL
C7DA                
C7DA CD 87 C9       	CALL	SETCRTC
C7DD 06 10          	LD	B,010H		;PALET
C7DF ED 71          	DB	0EDH,071H	;OUT (C),0	Z80未定義命令
C7E1 04             	INC	B
C7E2 ED 71          	DB	0EDH,071H	;OUT (C),0	Z80未定義命令
C7E4 04             	INC	B
C7E5 ED 71          	DB	0EDH,071H	;OUT (C),0	Z80未定義命令
C7E7 04             	INC	B
C7E8 ED 71          	DB	0EDH,071H	;OUT (C),0	Z80未定義命令
C7EA C3 81 C8       	JP	NOBANK
C7ED                
C7ED                TURBO:
C7ED F3             	DI			;Check BIOS
C7EE 06 1D          	LD	B,01DH
C7F0 ED 79          	OUT	(C),A		;BIOS ON
C7F2 3A 51 2F       	LD	A,(02F51H)
C7F5 04             	INC	B		;B=01EH
C7F6 ED 79          	OUT	(C),A		;BIOS OFF
C7F8 FB             	EI
C7F9 FE C9          	CP	0C9H
C7FB 28 0B          	JR	Z,BIOSOK
C7FD 3E AF          	LD	A,0AFH		;XOR	A
C7FF 32 BC D8       	LD	(X1KPAT),A
C802 21 A3 DB       	LD	HL,SCRNX
C805 22 D1 EC       	LD	(_SCRN+1),HL
C808                BIOSOK:
C808 3E 1F          	LD	A,01FH
C80A DB F0          	IN	A,(0F0H)
C80C 0F             	RRCA
C80D 38 0B          	JR	C,CRT1
C80F 21 01 CA       	LD	HL,_C8025H
C812 11 B0 EC       	LD	DE,CRTCD
C815 01 10 00       	LD	BC,16
C818 ED B0          	LDIR
C81A                CRT1:
C81A CD 87 C9       	CALL	SETCRTC
C81D 01 AA 10       	LD	BC,010AAH	;PALET
C820 ED 49          	OUT	(C),C
C822 01 CC 11       	LD	BC,011CCH
C825 ED 49          	OUT	(C),C
C827 01 F0 12       	LD	BC,012F0H
C82A ED 49          	OUT	(C),C
C82C 04             	INC	B
C82D ED 71          	DB	0EDH,071H
C82F                
C82F 3E 1F          	LD	A,01FH		;スタートポート
C831 DB F0          	IN	A,(0F0H)
C833 CB 57          	BIT	2,A
C835 28 18          	JR	Z,BANK
C837                
C837 AF             	XOR	A
C838                TZ1:				;前面スイッチが2HDの場合はMFMモードを2HDにしておく
C838 F5             	PUSH	AF
C839 CD DC EC       	CALL	_GETDPB
C83C DD 7E 12       	LD	A,(IX+012H)	;DPB_12_DEVICE
C83F E6 8F          	AND	08FH
C841 FE 87          	CP	087H		;フロッピーでMEM切り替えがON
C843 20 04          	JR	NZ,TZ2
C845 DD CB 0A 86    	RES	0,(IX+0AH)	;(DPB_0A_FDMODE)
C849                TZ2:
C849 F1             	POP	AF
C84A 3C             	INC	A
C84B FE 08          	CP	8
C84D 38 E9          	JR	C,TZ1
C84F                
C84F                BANK:
C84F 01 00 0B       	LD	BC,00B00H
C852 21 00 7F       	LD	HL,07F00H
C855 F3             	DI
C856                BANK1:
C856 ED 69          	OUT	(C),L
C858 5E             	LD	E,(HL)
C859 7B             	LD	A,E
C85A C6 A5          	ADD	A,0A5H
C85C 77             	LD	(HL),A
C85D BE             	CP	(HL)
C85E 73             	LD	(HL),E
C85F 20 05          	JR	NZ,BANK2
C861 2C             	INC	L
C862 CB 65          	BIT	4,L
C864 28 F0          	JR	Z,BANK1
C866                BANK2:
C866 3E 10          	LD	A,010H
C868 ED 79          	OUT	(C),A
C86A 7D             	LD	A,L
C86B B7             	OR	A
C86C 28 13          	JR	Z,NOBANK
C86E 26 00          	LD	H,0
C870 29             	ADD	HL,HL	;*2
C871 29             	ADD	HL,HL	;*4
C872 29             	ADD	HL,HL	;*8
C873 29             	ADD	HL,HL	;*16
C874 29             	ADD	HL,HL	;*32
C875 2B             	DEC	HL	;-1
C876 2B             	DEC	HL	;-2
C877 2B             	DEC	HL	;-3
C878 22 A8 ED       	LD	(BANKCL),HL
C87B CD A6 C9       	CALL	CALC_FATLN
C87E 32 A0 ED       	LD	(BANKFL),A
C881                NOBANK:
C881                EMM:
C881 CD 50 C9       	CALL	EADR0
C884 ED 78          	IN	A,(C)
C886 F5             	PUSH	AF
C887                
C887 11 00 00       	LD	DE,0
C88A                ECHECK1:
C88A 13             	INC	DE
C88B CD 33 C9       	CALL	EADR2
C88E ED 60          	IN	H,(C)
C890 CD 33 C9       	CALL	EADR2
C893 7C             	LD	A,H
C894 C6 E5          	ADD	A,0E5H
C896 ED 79          	OUT	(C),A
C898 3C             	INC	A
C899 CD 50 C9       	CALL	EADR0
C89C ED 79          	OUT	(C),A
C89E 3D             	DEC	A
C89F CD 33 C9       	CALL	EADR2
C8A2 ED 68          	IN	L,(C)
C8A4 CD 33 C9       	CALL	EADR2
C8A7 ED 61          	OUT	(C),H
C8A9 BD             	CP	L
C8AA 20 04          	JR	NZ,ECHECK2
C8AC CB 5A          	BIT	3,D
C8AE 28 DA          	JR	Z,ECHECK1
C8B0                ECHECK2:
C8B0 CD 50 C9       	CALL	EADR0
C8B3 F1             	POP	AF
C8B4 ED 79          	OUT	(C),A
C8B6                
C8B6 21 F7 FF       	LD	HL,0-9
C8B9 19             	ADD	HL,DE
C8BA 30 09          	JR	NC,NOEMM
C8BC 22 88 ED       	LD	(EMMCL),HL
C8BF CD A6 C9       	CALL	CALC_FATLN
C8C2 32 80 ED       	LD	(EMMFL),A
C8C5                NOEMM:
C8C5 3E 00          KEYREP:	LD	A,000H
C8C7 B7             	OR	A
C8C8 28 07          	JR	Z,KEYR1
C8CA 01 00 00       	LD	BC,0
C8CD ED 43 8C EC    	LD	(_CTC),BC
C8D1                KEYR1:
C8D1 01 30 F8       	LD	BC,0-80*25
C8D4 2A BA EC       	LD	HL,(CRTCD+10)
C8D7 ED 43 BA EC    	LD	(CRTCD+10),BC
C8DB 1E 0C          	LD	E,00CH
C8DD CD CD EC       	CALL	_PRINT
C8E0 22 BA EC       	LD	(CRTCD+10),HL
C8E3                
C8E3 21 C2 C9       	LD	HL,INIMES
C8E6 CD 84 D3       	CALL	MSX
C8E9                
C8E9 3A 87 FF       	LD	A,(0FF87H)
C8EC FE 08          	CP	8
C8EE 30 1E          	JR	NC,INIT0
C8F0 5F             	LD	E,A
C8F1 C6 41          	ADD	A,'A'
C8F3 32 BF C9       	LD	(AUTODV),A
C8F6 0E 0E          	LD	C,00EH
C8F8 CD 05 00       	CALL	SYSTEM
C8FB 1C             	INC	E
C8FC 21 85 EC       	LD	HL,_SEEKSP	;Disk error Ignore
C8FF CB FE          	SET	7,(HL)
C901 0E 1B          	LD	C,01BH
C903 CD 05 00       	CALL	SYSTEM
C906                
C906 21 85 EC       	LD	HL,_SEEKSP
C909 CB BE          	RES	7,(HL)
C90B                
C90B 3C             	INC	A
C90C 20 08          	JR	NZ,INIT1
C90E                INIT0:
C90E 1E 00          	LD	E,0
C910 0E 0E          	LD	C,00EH
C912 CD 05 00       	CALL	SYSTEM
C915 AF             	XOR	A
C916                INIT1:
C916 F3             	DI
C917 08             	EX	AF,AF'
C918 2E FE          	LD	L,0-2		;CALLのスタック分減らす
C91A 39             	ADD	HL,SP
C91B 11 00 FF       	LD	DE,0FF00H
C91E 45             	LD	B,L
C91F CD 2E D0       	CALL	ZERO_MEMORY_DE
C922 08             	EX	AF,AF'
C923 B7             	OR	A
C924 C8             	RET	Z
C925                
C925 3E E6          	LD	A,0E6H
C927 CD 78 DA       	CALL	COMOUT
C92A CD 5D DA       	CALL	IN49SB
C92D CD 5D DA       	CALL	IN49SB
C930 FE 1B          	CP	01BH
C932 C9             	RET
C933                
C933                EADR2:
C933 D5             	PUSH	DE
C934 EB             	EX	DE,HL
C935 29             	ADD	HL,HL
C936 29             	ADD	HL,HL
C937 ED 4B 8B ED    	LD	BC,(EMMBL-1)
C93B 0E 00          	LD	C,0
C93D 09             	ADD	HL,BC
C93E ED 4B 93 ED    	LD	BC,(EMMDV)
C942 06 0D          	LD	B,00DH
C944 ED 49          	OUT	(C),C
C946 0C             	INC	C
C947 ED 69          	OUT	(C),L
C949 0C             	INC	C
C94A ED 61          	OUT	(C),H
C94C 0C             	INC	C
C94D EB             	EX	DE,HL
C94E D1             	POP	DE
C94F C9             	RET
C950                
C950                EADR0:
C950 ED 4B 93 ED    	LD	BC,(EMMDV)
C954 06 0D          	LD	B,00DH
C956 ED 71          	DB	0EDH,071H	;OUT (C),0	Z80未定義命令
C958 0C             	INC	C
C959 ED 71          	DB	0EDH,071H	;OUT (C),0	Z80未定義命令
C95B 0C             	INC	C
C95C ED 71          	DB	0EDH,071H	;OUT (C),0	Z80未定義命令
C95E 0C             	INC	C
C95F C9             	RET
C960                
C960                CHKCTC:
C960 C5             	PUSH	BC
C961 11 03 47       	LD	DE,04703H
C964                INICTC1:
C964 0C             	INC	C
C965 ED 51          	OUT	(C),D
C967 ED 71          	DB	0EDH,071H	;OUT (C),0	Z80未定義命令
C969 1D             	DEC	E
C96A 20 F8          	JR	NZ,INICTC1
C96C C1             	POP	BC
C96D                
C96D 11 FA 07       	LD	DE,007FAH
C970 ED 51          	OUT	(C),D
C972 ED 59          	OUT	(C),E
C974 ED 78          	IN	A,(C)
C976 BB             	CP	E
C977 C0             	RET	NZ
C978 ED 51          	OUT	(C),D
C97A ED 51          	OUT	(C),D
C97C ED 78          	IN	A,(C)
C97E BA             	CP	D
C97F C0             	RET	NZ
C980 03             	INC	BC
C981 03             	INC	BC
C982 ED 43 8C EC    	LD	(_CTC),BC
C986 C9             	RET
C987                
C987                SETCRTC:
C987 21 B0 EC       	LD	HL,CRTCD
C98A AF             	XOR	A
C98B                SETCRT1:
C98B 01 00 18       	LD	BC,01800H
C98E ED 79          	OUT	(C),A
C990 0C             	INC	C
C991 04             	INC	B
C992 ED A3          	OUTI
C994 3C             	INC	A
C995 FE 0C          	CP	12
C997 20 F2          	JR	NZ,SETCRT1
C999 23             	INC	HL
C99A 23             	INC	HL
C99B 01 03 1B       	LD	BC,01A03H+00100H
C99E ED A3          	OUTI
C9A0 01 D0 20       	LD	BC,01FD0H+00100H
C9A3 ED A3          	OUTI
C9A5 C9             	RET
C9A6                
C9A6                CALC_FATLN:	;FAT12のクラスタ数から必要なFATサイズを求める(セクタサイズ512)
C9A6 5D             	LD	E,L
C9A7 54             	LD	D,H
C9A8 29             	ADD	HL,HL	;*2
C9A9 19             	ADD	HL,DE	;*3
C9AA CB 3C          	SRL	H	;/2
C9AC CB 1D          	RR	L	;1クラスタ辺り1.5バイト必要
C9AE 11 FF 01       	LD	DE,511	;切り上げる
C9B1 19             	ADD	HL,DE
C9B2 7C             	LD	A,H
C9B3 CB 3F          	SRL	A
C9B5 C9             	RET
C9B6                
C9B6 41 55 54 4F    AUTOD:	DB	"AUTOEXEC "
C9BA 45 58 45 43
C9BE 20
C9BF 41 3A 00       AUTODV:	DB	"A:",0
C9C2                
C9C2 4C 53 58 2D    INIMES:	DB	"LSX-Dodgers for X1/turbo version "
C9C6 44 6F 64 67
C9CA 65 72 73 20
C9CE 66 6F 72 20
C9D2 58 31 2F 74
C9D6 75 72 62 6F
C9DA 20 76 65 72
C9DE 73 69 6F 6E
C9E2 20
C9E3 31 2E          	DB	030H + VER_1, '.'
C9E5 33 39          	DB	030H + VER_2 ,030H + VER_3
C9E7 20 47 61 6B    	DB	' Gaku (Lovers/Tablacus)',0DH,0AH
C9EB 75 20 28 4C
C9EF 6F 76 65 72
C9F3 73 2F 54 61
C9F7 62 6C 61 63
C9FB 75 73 29 0D
C9FF 0A
CA00 00             	DB	0
CA01                
CA01                _C8025H:
CA01 6B 50 59 88    	DB	06BH,050H,059H,088H,01BH,001H,019H,01AH
CA05 1B 01 19 1A
CA09 00 0F          	DB	000H,00FH
CA0B 80 F8 B0 FF    	DW	0-80*LINE,0-80
CA0F 0C A3          	DB	00CH,0A3H
CA11                
CA11 03 0C 0F 30    TEXTDT:	DB	003H,00CH,00FH,030H,033H,03CH,03FH
CA15 33 3C 3F
CA18                
CA18                SIODATA:
CA18 18             	DB	018H
CA19 01 00          	DB	1,0
CA1B 02 00          	DB	2,0
CA1D 03 C1          	DB	3,0C1H
CA1F 04 44          	DB	4,044H
CA21 05 E8          	DB	5,0E8H
CA23 FF             	DB	0FFH
CA24                
CA24                ;	ノンターボ用パッチ
CA24                
CA24                AT_SCR1:
CA24 D9             	EXX
CA25 C5             	PUSH	BC
CA26 01 50 20       	LD	BC,02000H+80
CA29 D9             	EXX
CA2A C5             	PUSH	BC
CA2B 01 00 20       	LD	BC,02000H
CA2E                
CA2E 67             	LD	H,A
CA2F B7             	OR	A
CA30                AT_SCRUP1:
CA30 28 15          	JR	Z,AT_SCRCL
CA32 C5             	PUSH	BC
CA33 CB E0          	SET	4,B
CA35 D9             	EXX
CA36 C5             	PUSH	BC
CA37 CB E0          	SET	4,B
CA39 D9             	EXX
CA3A CD 3C DB       	CALL	AT_UPSUB+AT_RS
CA3D D9             	EXX
CA3E C1             	POP	BC
CA3F D9             	EXX
CA40 C1             	POP	BC
CA41 CD 3C DB       	CALL	AT_UPSUB+AT_RS
CA44 25             	DEC	H
CA45 18 E9          	JR	AT_SCRUP1
CA47                
CA47                AT_SCRCL:
CA47 21 50 20       	LD	HL,02000H+80
CA4A 3A 96 EC       	LD	A,(_COLORF)
CA4D                AT_SCRCL1:
CA4D CB E0          	SET	4,B
CA4F ED 61          	OUT	(C),H
CA51 CB A0          	RES	4,B
CA53 ED 79          	OUT	(C),A
CA55 03             	INC	BC
CA56 2D             	DEC	L
CA57 20 F4          	JR	NZ,AT_SCRCL1
CA59 C1             	POP	BC
CA5A D9             	EXX
CA5B C1             	POP	BC
CA5C D9             	EXX
CA5D C9             	RET
CA5E                
CA5E                AT_UPSUB:
CA5E 2E 28          	LD	L,40
CA60                AT_UPSUB1:
CA60 D9             	EXX
CA61 ED 78          	IN	A,(C)
CA63 03             	INC	BC
CA64 D9             	EXX
CA65 ED 79          	OUT	(C),A
CA67 03             	INC	BC
CA68 D9             	EXX
CA69 ED 78          	IN	A,(C)
CA6B 03             	INC	BC
CA6C D9             	EXX
CA6D ED 79          	OUT	(C),A
CA6F 03             	INC	BC
CA70 2D             	DEC	L
CA71 20 ED          	JR	NZ,AT_UPSUB1
CA73 C9             	RET
CA74                
CA74                ;	FLOPPY DISK DRIVER(CPU)
CA74                
CA74                DISKC:
CA74 1B             	DEC	DE
CA75 CB 5F          	BIT	3,A
CA77 C4 40 EA       	CALL	NZ,RNF
CA7A                DISKD:
CA7A E5             	PUSH	HL
CA7B 21 46 EA       	LD	HL,RETRY
CA7E 35             	DEC	(HL)
CA7F E1             	POP	HL
CA80 20 3E          	JR	NZ,AT_ERR		;Retry
CA82 B7             	OR	A
CA83 28 3B          	JR	Z,AT_ERR		;Error
CA85                
CA85                AT_DELP:
CA85 CD 40 EA       	CALL	RNF
CA88 CD 1C EA       	CALL	FDMOFF
CA8B 3A 85 EC       	LD	A,(_SEEKSP)
CA8E 87             	ADD	A,A
CA8F 38 2E          	JR	C,AT_ERRZ
CA91                AT_DELP1:
CA91 D5             	PUSH	DE
CA92 21 C0 EB       	LD	HL,DEMES
CA95 CD 84 D3       	CALL	MSX
CA98 CD 1F D7       	CALL	KEYBC
CA9B                AT_DELP2:
CA9B CD CA EC       	CALL	_INKEY
CA9E 28 FB          	JR	Z,AT_DELP2
CAA0                
CAA0 D1             	POP	DE
CAA1 CD 72 DF       	CALL	CAP
CAA4 FE 52          	CP	'R'		;Retry
CAA6 20 0A          	JR	NZ,AT_DELP3
CAA8 21 00 00       DHLPAT:	LD	HL,0
CAAB 3E 02          	LD	A,2
CAAD 32 46 EA       	LD	(RETRY),A
CAB0 B7             	OR	A
CAB1 C9             	RET
CAB2                AT_DELP3:
CAB2 FE 49          	CP	'I'		;Ignore
CAB4 28 07          	JR	Z,AT_IGNORE
CAB6 FE 41          	CP	'A'		;Abort
CAB8 20 D7          	JR	NZ,AT_DELP1
CABA C3 00 EB       	JP	BOOT
CABD                AT_IGNORE:
CABD 3E FF          	LD	A,0FFH
CABF                AT_ERRZ:
CABF BF             	CP	A
CAC0                AT_ERR:
CAC0 3E FF          	LD	A,0FFH
CAC2 C9             	RET
CAC3                
CAC3                AT_SCRE:
CAC3                
CAC3                AT_WTTRK:
CAC3 06 01          	LD	B,1
CAC5 3E F0          	LD	A,0F0H
CAC7 18 02          	JR	AT_WTTRK1
CAC9                AT_DWT:
CAC9 3E A0          	LD	A,0A0H
CACB                AT_WTTRK1:
CACB 32 E4 E9       	LD	(FDCPAT+1),A
CACE 78             	LD	A,B
CACF 32 93 EA       	LD	(AT_WTB+1+AT_R),A
CAD2                DWTBL:
CAD2 3E 02          	LD	A,2		;Retry count
CAD4 32 46 EA       	LD	(RETRY),A
CAD7                
CAD7                DWT0:
CAD7 D5             	PUSH	DE
CAD8 E5             	PUSH	HL
CAD9 22 87 DB       	LD	(DHLPAT+1+AT_RS),HL
CADC CD 7E E9       	CALL	SEEK		;Write disk
CADF E1             	POP	HL
CAE0 38 38          	JR	C,ERRDW
CAE2 F3             	DI
CAE3 3A E4 E9       	LD	A,(FDCPAT+1)
CAE6 CD 28 EA       	CALL	SECSET
CAE9 0E FB          	LD	C,0FBH
CAEB                
CAEB                DWT1:
CAEB 56             	LD	D,(HL)
CAEC                DWT2:
CAEC 78             	LD	A,B
CAED DB F8          	IN	A,(0F8H)
CAEF 0F             	RRCA
CAF0 30 08          	JR	NC,DWT4
CAF2 0F             	RRCA
CAF3 30 F7          	JR	NC,DWT2
CAF5                DWT3:
CAF5 ED 51          	OUT	(C),D
CAF7 23             	INC	HL
CAF8 18 F1          	JR	DWT1
CAFA                
CAFA                DWT4:
CAFA 3D             	DEC	A
CAFB 28 F8          	JR	Z,DWT3
CAFD 3C             	INC	A
CAFE FB             	EI
CAFF D1             	POP	DE
CB00 13             	INC	DE
CB01 CD 1C EA       	CALL	FDMOFF
CB04 28 08          	JR	Z,DISKOK_WT
CB06 CD 52 DB       	CALL	DISKC+AT_RS
CB09 20 CC          	JR	NZ,DWT0
CB0B B7             	OR	A
CB0C 20 05          	JR	NZ,ERRW
CB0E                
CB0E                DISKOK_WT:
CB0E 06 01          AT_WTB:	LD	B,1
CB10 10 C0          	DJNZ	DWTBL
CB12 C9             	RET
CB13                
CB13                ERRW:
CB13 3E FF          	LD	A,0FFH
CB15                ERRZ:
CB15 BF             	CP	A
CB16 37             	SCF
CB17 C3 1C EA       	JP	FDMOFF
CB1A                
CB1A                ERRDW:
CB1A D1             	POP	DE
CB1B CD 63 DB       	CALL	AT_DELP+AT_RS
CB1E 20 B7          	JR	NZ,DWT0
CB20 B7             	OR	A
CB21 20 F0          	JR	NZ,ERRW
CB23 C9             	RET
CB24                
CB24                AT_DRD:
CB24 3E 80          	LD	A,080H
CB26 32 E4 E9       	LD	(FDCPAT+1),A
CB29                DRDBL:
CB29 78             	LD	A,B
CB2A 32 EA EA       	LD	(AT_RDB+1+AT_R),A
CB2D 3E 02          	LD	A,2		;Retry count
CB2F 32 46 EA       	LD	(RETRY),A
CB32                DRD0:
CB32 D5             	PUSH	DE
CB33 E5             	PUSH	HL
CB34 22 87 DB       	LD	(DHLPAT+1+AT_RS),HL
CB37 CD 7E E9       	CALL	SEEK		;Read disk
CB3A E1             	POP	HL
CB3B 38 2D          	JR	C,ERRDR
CB3D F3             	DI
CB3E 3A E4 E9       	LD	A,(FDCPAT+1)
CB41 CD 28 EA       	CALL	SECSET
CB44 0E FB          	LD	C,0FBH
CB46                DRD1:
CB46 78             	LD	A,B
CB47 DB F8          	IN	A,(0F8H)
CB49 0F             	RRCA
CB4A 30 08          	JR	NC,DRD3
CB4C 0F             	RRCA
CB4D 30 F7          	JR	NC,DRD1
CB4F ED A2          	INI
CB51 04             	INC	B
CB52 18 F2          	JR	DRD1
CB54                
CB54                DRD3:
CB54 B7             	OR	A
CB55 FB             	EI
CB56 D1             	POP	DE
CB57 13             	INC	DE
CB58 CD 1C EA       	CALL	FDMOFF
CB5B 28 08          	JR	Z,DISKOK_RD
CB5D CD 52 DB       	CALL	DISKC+AT_RS
CB60 20 D0          	JR	NZ,DRD0
CB62 B7             	OR	A
CB63 20 AE          	JR	NZ,ERRW
CB65                
CB65                DISKOK_RD:
CB65 06 01          AT_RDB:	LD	B,1
CB67 10 C0          	DJNZ	DRDBL
CB69 C9             	RET
CB6A                
CB6A                ERRDR:
CB6A D1             	POP	DE
CB6B CD 63 DB       	CALL	AT_DELP+AT_RS
CB6E 20 C2          	JR	NZ,DRD0
CB70 B7             	OR	A
CB71 20 A0          	JR	NZ,ERRW
CB73 C9             	RET
CB74                
CB74                AT_CPUE:
CB74                
CB74                
CB74                ;	EMM DRIVER(CPU)
CB74                
CB74                
CB74                AT_EDWT:
CB74 CD 1E D3       	CALL	AT_EADR+AT_RE
CB77                AT_EDWT0:
CB77 F5             	PUSH	AF
CB78 AF             	XOR	A
CB79                AT_EDWT1:
CB79 04             	INC	B
CB7A ED A3          	OUTI
CB7C 04             	INC	B
CB7D ED A3          	OUTI
CB7F 3D             	DEC	A
CB80 20 F7          	JR	NZ,AT_EDWT1
CB82 13             	INC	DE
CB83 F1             	POP	AF
CB84 3D             	DEC	A
CB85 20 F0          	JR	NZ,AT_EDWT0
CB87 C9             	RET
CB88                
CB88                AT_EDRD:
CB88 CD 1E D3       	CALL	AT_EADR+AT_RE
CB8B                AT_EDRD0:
CB8B F5             	PUSH	AF
CB8C AF             	XOR	A
CB8D                AT_EDRD1:
CB8D ED A2          	INI
CB8F 04             	INC	B
CB90 ED A2          	INI
CB92 04             	INC	B
CB93 3D             	DEC	A
CB94 20 F7          	JR	NZ,AT_EDRD1
CB96 13             	INC	DE
CB97 F1             	POP	AF
CB98 3D             	DEC	A
CB99 20 F0          	JR	NZ,AT_EDRD0
CB9B C9             	RET
CB9C                
CB9C                AT_EADR:
CB9C C5             	PUSH	BC
CB9D D5             	PUSH	DE
CB9E EB             	EX	DE,HL
CB9F 29             	ADD	HL,HL
CBA0 29             	ADD	HL,HL
CBA1 0E 00          	LD	C,0
CBA3 3A A1 EC       	LD	A,(_MAXCYL)
CBA6 47             	LD	B,A
CBA7 09             	ADD	HL,BC
CBA8 3A 84 EC       	LD	A,(_DRIVE)
CBAB 4F             	LD	C,A
CBAC 06 0D          	LD	B,00DH
CBAE ED 49          	OUT	(C),C
CBB0 0C             	INC	C
CBB1 ED 69          	OUT	(C),L
CBB3 0C             	INC	C
CBB4 ED 61          	OUT	(C),H
CBB6 0C             	INC	C
CBB7 EB             	EX	DE,HL
CBB8 D1             	POP	DE
CBB9 F1             	POP	AF
CBBA A7             	AND	A	;CF=0
CBBB C9             	RET
CBBC                
CBBC                AT_EMME:
CBBC                
CBBC                INITE:
CBBC                	DS	0CC06H-INITE
CC06                
CC06                BDOS:
CC06 C3 42 D3       	JP	BDOS0
CC09                	DS	25	;Reserved
CC22                	INCLUDE	"LDCCP.ASM"
CC22                
CC22                ;	LSX-Dodgers CCP
CC22                
CC22                WBOOT1:
CC22 F3             	DI
CC23 31 A0 FF       	LD	SP,STACK
CC26                
CC26 3E EC          	LD	A,INTVEC/256
CC28 ED 47          	LD	I,A
CC2A                
CC2A 3E E4          	LD	A,0E4H
CC2C CD 78 DA       	CALL	COMOUT
CC2F 3E C8          	LD	A,INTVEC
CC31 CD 52 DA       	CALL	OT49SB
CC34                
CC34 3A BC EC       	LD	A,(CRTCD+12)
CC37 B7             	OR	A
CC38 20 0C          	JR	NZ,SETCRT0
CC3A 21 80 F8       	LD	HL,0-80*LINE
CC3D 22 BA EC       	LD	(CRTCD+10),HL
CC40 21 B0 FF       	LD	HL,0-80
CC43 22 BC EC       	LD	(CRTCD+12),HL
CC46                SETCRT0:
CC46 21 B0 EC       	LD	HL,CRTCD
CC49 AF             	XOR	A
CC4A                SETCRT2:
CC4A 01 00 18       	LD	BC,01800H
CC4D ED 79          	OUT	(C),A
CC4F 0C             	INC	C
CC50 04             	INC	B
CC51 ED A3          	OUTI
CC53 3C             	INC	A
CC54 FE 0C          	CP	12
CC56 20 F2          	JR	NZ,SETCRT2
CC58 0D             	DEC	C
CC59 ED 79          	OUT	(C),A
CC5B 0C             	INC	C
CC5C ED 71          	DB	0EDH,071H	;OUT (C),0	Z80未定義命令
CC5E                
CC5E 0D             	DEC	C
CC5F 3C             	INC	A
CC60 ED 79          	OUT	(C),A
CC62 0C             	INC	C
CC63 ED 71          	DB	0EDH,071H	;OUT (C),0	Z80未定義命令
CC65 23             	INC	HL
CC66 23             	INC	HL
CC67 01 03 1B       	LD	BC,01A03H+00100H
CC6A ED A3          	OUTI
CC6C 01 D0 20       	LD	BC,01FD0H+00100H
CC6F ED A3          	OUTI
CC71 21 92 EC       	LD	HL,_KEYD
CC74 3E 03          	LD	A,3
CC76 BE             	CP	(HL)
CC77 CC 1F D7       	CALL	Z,KEYBC
CC7A 36 00          	LD	(HL),0
CC7C 3E 04          	LD	A,4
CC7E CD 56 D7       	CALL	MSG_A
CC81                COMMAND:
CC81 CD 34 CD       	CALL	SETDTA1
CC84 3A 87 EC       	LD	A,(_DVSW)
CC87 C6 41          	ADD	A,'A'
CC89 CD 56 D7       	CALL	MSG_A
CC8C 3E 3E          	LD	A,'>'
CC8E CD 56 D7       	CALL	MSG_A
CC91 3E 50          	LD	A,80
CC93 12             	LD	(DE),A
CC94 CD A5 D7       	CALL	_SYS0A		;(BDOS)文字列入力
CC97 CD F0 CE       	CALL	LTNL
CC9A                
CC9A 11 82 00       	LD	DE,DTA1+2
CC9D CD FD EC       	CALL	_COMANL
CCA0 30 DF          	JR	NC,COMMAND
CCA2 11 79 EB       	LD	DE,COMERM
CCA5 CD 75 D3       	CALL	_SYS09		;(BDOS)文字列出力
CCA8 C7             	RST	0
CCA9                
CCA9                COMANL:
CCA9 CD 52 DC       	CALL	FILE
CCAC 3A 19 EB       	LD	A,(FNAME+4)
CCAF FE 20          	CP	020H
CCB1 20 1C          	JR	NZ,COMB2
CCB3 D5             	PUSH	DE
CCB4 11 15 EB       	LD	DE,FNAME
CCB7 1A             	LD	A,(DE)
CCB8 FE 20          	CP	020H
CCBA 28 44          	JR	Z,SDVSW
CCBC 1B             	DEC	DE
CCBD 1A             	LD	A,(DE)
CCBE C6 FF          	ADD	A,0FFH
CCC0 38 09          	JR	C,COMB
CCC2 13             	INC	DE
CCC3                
CCC3 21 FB D1       	LD	HL,COMTB
CCC6 06 09          	LD	B,COMS
CCC8 CD EA DE       	CALL	CPNAME
CCCB                COMB:
CCCB D1             	POP	DE
CCCC D2 0F 00       	JP	NC,JP_HL
CCCF                COMB2:
CCCF EB             	EX	DE,HL
CCD0 22 AF CD       	LD	(COMPAT+1),HL
CCD3 F5             	PUSH	AF
CCD4 CD 5B CD       	CALL	CEXE4
CCD7 F1             	POP	AF
CCD8 21 15 EB       	LD	HL,FNAME
CCDB 11 6D 00       	LD	DE,FCB2+1	;COMMAND NAME
CCDE 01 0B 00       	LD	BC,11
CCE1 ED B0          	LDIR
CCE3 11 BA D1       	LD	DE,PATHD
CCE6                CEX1:
CCE6 1A             	LD	A,(DE)
CCE7 FE 20          	CP	020H
CCE9 D8             	RET	C
CCEA CD 47 DC       	CALL	FILEC
CCED D5             	PUSH	DE
CCEE 21 6D 00       	LD	HL,FCB2+1	;COMMAND NAME
CCF1 11 15 EB       	LD	DE,FNAME
CCF4 01 0B 00       	LD	BC,11
CCF7 ED B0          	LDIR
CCF9 CD 5B CD       	CALL	CEXE4
CCFC D1             	POP	DE
CCFD 13             	INC	DE
CCFE 18 E6          	JR	CEX1
CD00                
CD00                SDVSW:
CD00 F1             	POP	AF
CD01 3A 14 EB       	LD	A,(FDRV)
CD04 3D             	DEC	A
CD05 5F             	LD	E,A
CD06 0E 0E          	LD	C,00EH		;(BDOS)カレントドライブの設定
CD08 18 31          	JR	SYSTEM0
CD0A                
CD0A                OPEN1:
CD0A 21 14 EB       	LD	HL,FDRV
CD0D                OPEN:
CD0D 0E 11          	LD	C,011H		;(BDOS)ファイルの検索
CD0F                OPEN3:
CD0F D5             	PUSH	DE
CD10 11 95 D1       	LD	DE,DTA_CCP
CD13 CD 31 CD       	CALL	SETDTA
CD16 EB             	EX	DE,HL
CD17 CD 3B CD       	CALL	SYSTEM0
CD1A D1             	POP	DE
CD1B C9             	RET
CD1C                
CD1C                OPEN2:
CD1C 0E 12          	LD	C,012H
CD1E 18 EF          	JR	OPEN3
CD20                
CD20                DEFCB:				;Z=Ok NZ=Error
CD20 11 95 D1       	LD	DE,DTA_CCP
CD23 CD 39 CD       	CALL	SYSC0F
CD26                
CD26 11 B6 D1       	LD	DE,DTA_CCP+33	;(FCB)ランダムレコード
CD29 06 04          	LD	B,4
CD2B CD 2E D0       	CALL	ZERO_MEMORY_DE
CD2E 11 00 01       	LD	DE,00100H
CD31                SETDTA:
CD31 C3 A2 D5       	JP	_SYS1A		;(BDOS)DTAの設定
CD34                
CD34                SETDTA1:
CD34 11 80 00       	LD	DE,DTA1
CD37 18 F8          	JR	SETDTA
CD39                
CD39                SYSC0F:
CD39 0E 0F          	LD	C,00FH		;(BDOS)ファイルのオープン
CD3B                SYSTEM0:
CD3B CD 05 00       	CALL	SYSTEM
CD3E B7             	OR	A
CD3F C9             	RET
CD40                
CD40                C_CD:
CD40 CD 47 DC       	CALL	FILEC
CD43 21 00 00       	LD	HL,0
CD46 11 14 EB       	LD	DE,FDRV
CD49 18 0C          	JR	S27
CD4B                
CD4B                S27BUF:
CD4B 3A 07 00       	LD	A,(SYSTEM+2)
CD4E 3D             	DEC	A
CD4F E6 F8          	AND	0F8H
CD51 67             	LD	H,A
CD52 2E 00          	LD	L,0
CD54                S27DTA:
CD54 11 95 D1       	LD	DE,DTA_CCP
CD57                S27:
CD57 0E 27          	LD	C,027H		;(BDOS)ランダムブロック読み込み
CD59 18 E0          	JR	SYSTEM0
CD5B                
CD5B                CEXE4:
CD5B 3A 14 EB       	LD	A,(FDRV)
CD5E 32 57 00       	LD	(00057H),A
CD61 2A 22 EB       	LD	HL,(FDRV+14)
CD64 22 58 00       	LD	(00058H),HL
CD67                
CD67 21 1D EB       	LD	HL,FNAME+8
CD6A 7E             	LD	A,(HL)
CD6B FE 20          	CP	020H
CD6D 20 07          	JR	NZ,CEXE7
CD6F 3E 3F          	LD	A,'?'
CD71 77             	LD	(HL),A
CD72 23             	INC	HL
CD73 77             	LD	(HL),A
CD74 23             	INC	HL
CD75 77             	LD	(HL),A
CD76                CEXE7:
CD76 CD 0A CD       	CALL	OPEN1
CD79                CEXE5:
CD79 C0             	RET	NZ
CD7A 2A 9F D1       	LD	HL,(DTA_CCP+1+9)
CD7D 7C             	LD	A,H
CD7E CD 72 DF       	CALL	CAP
CD81 67             	LD	H,A
CD82 7D             	LD	A,L
CD83 CD 72 DF       	CALL	CAP
CD86 6F             	LD	L,A
CD87 3A 9E D1       	LD	A,(DTA_CCP+1+8)
CD8A CD 72 DF       	CALL	CAP
CD8D D6 42          	SUB	'B'
CD8F 28 2C          	JR	Z,C_BAT
CD91 3D             	DEC	A		;'C'
CD92 28 05          	JR	Z,C_EXE
CD94                CEXE6:
CD94 CD 1C CD       	CALL	OPEN2
CD97 18 E0          	JR	CEXE5
CD99                
CD99                C_EXE:
CD99 7C             	LD	A,H
CD9A FE 4D          	CP	'M'
CD9C 20 F6          	JR	NZ,CEXE6
CD9E                
CD9E CD 20 CD       	CALL	DEFCB
CDA1 CD 4B CD       	CALL	S27BUF
CDA4 3D             	DEC	A
CDA5 37             	SCF
CDA6 C0             	RET	NZ
CDA7 7C             	LD	A,H
CDA8 B5             	OR	L
CDA9 37             	SCF
CDAA C8             	RET	Z
CDAB CD 34 CD       	CALL	SETDTA1
CDAE 11 00 00       COMPAT:	LD	DE,0
CDB1 CD F9 CF       	CALL	SETFCB
CDB4 AF             	XOR	A
CDB5 67             	LD	H,A
CDB6 6F             	LD	L,A	;HL=0x0000
CDB7 31 A0 FF       	LD	SP,STACK
CDBA E5             	PUSH	HL
CDBB 24             	INC	H	;HL=0x0100
CDBC E9             	JP	(HL)
CDBD                
CDBD                C_BAT:
CDBD 11 41 54       	LD	DE,'A'+'T'*256
CDC0 ED 52          	SBC	HL,DE
CDC2 20 D0          	JR	NZ,CEXE6
CDC4                
CDC4 F1             	POP	AF
CDC5 F1             	POP	AF
CDC6 CD 20 CD       	CALL	DEFCB
CDC9 21 00 02       	LD	HL,00200H
CDCC CD 54 CD       	CALL	S27DTA
CDCF C6 FE          	ADD	A,0FEH
CDD1 D8             	RET	C
CDD2 7D             	LD	A,L
CDD3 B7             	OR	A
CDD4 37             	SCF
CDD5 C8             	RET	Z
CDD6 3C             	INC	A
CDD7 F5             	PUSH	AF
CDD8                
CDD8 CD 1F D7       	CALL	KEYBC
CDDB 3E 06          	LD	A,6
CDDD CD 56 D7       	CALL	MSG_A
CDE0 C1             	POP	BC
CDE1 21 00 01       	LD	HL,00100H
CDE4                BAT1:
CDE4 A7             	AND	A
CDE5 05             	DEC	B
CDE6 C8             	RET	Z
CDE7 7E             	LD	A,(HL)
CDE8 FE 25          	CP	'%'
CDEA 28 0C          	JR	Z,BAT2
CDEC                BAT1X:
CDEC 7E             	LD	A,(HL)
CDED 23             	INC	HL
CDEE FE 1A          	CP	01AH
CDF0 C8             	RET	Z
CDF1 FE 0A          	CP	00AH
CDF3 C4 05 D7       	CALL	NZ,KEYBS
CDF6 18 EC          	JR	BAT1
CDF8                
CDF8                BAT2:
CDF8 23             	INC	HL
CDF9 7E             	LD	A,(HL)
CDFA 2B             	DEC	HL
CDFB D6 31          	SUB	'1'
CDFD 38 ED          	JR	C,BAT1X
CDFF FE 09          	CP	9
CE01 30 E9          	JR	NC,BAT1X
CE03 23             	INC	HL
CE04 23             	INC	HL
CE05 3C             	INC	A
CE06 4F             	LD	C,A
CE07 ED 5B AF CD    	LD	DE,(COMPAT+1)
CE0B                BAT3:
CE0B 1A             	LD	A,(DE)
CE0C B7             	OR	A
CE0D 28 D5          	JR	Z,BAT1
CE0F CD 29 DD       	CALL	SPCUT
CE12 0D             	DEC	C
CE13 28 08          	JR	Z,BAT5
CE15                BAT4:
CE15 1A             	LD	A,(DE)
CE16 FE 21          	CP	021H
CE18 38 F1          	JR	C,BAT3
CE1A 13             	INC	DE
CE1B 18 F8          	JR	BAT4
CE1D                BAT5:
CE1D 1A             	LD	A,(DE)
CE1E FE 21          	CP	021H
CE20 38 C2          	JR	C,BAT1
CE22 13             	INC	DE
CE23 CD 05 D7       	CALL	KEYBS
CE26 18 F5          	JR	BAT5
CE28                
CE28                SWITCH:
CE28 1A             	LD	A,(DE)
CE29                SW1:
CE29 13             	INC	DE
CE2A B9             	CP	C
CE2B 1A             	LD	A,(DE)
CE2C C8             	RET	Z
CE2D FE 20          	CP	020H
CE2F 30 F8          	JR	NC,SW1
CE31                C_REM:
CE31 AF             	XOR	A
CE32 C9             	RET
CE33                
CE33                C_DEL:
CE33 CD F9 CF       	CALL	SETFCB
CE36 CD 6C D7       	CALL	_SYS08		;(BDOS)エコーなしコンソール入力
CE39                
CE39 0E 13          	LD	C,013H
CE3B 18 0A          	JR	CDEL1		;(BDOS)ファイルの削除
CE3D                
CE3D                C_REN:
CE3D CD F9 CF       	CALL	SETFCB
CE40 3E 10          	LD	A,010H		;ディレクトリも対象にする
CE42 32 69 00       	LD	(FCB1+13),A	;属性
CE45 0E 17          	LD	C,017H		;(BDOS)ファイル名の変更
CE47                CDEL1:
CE47 11 5C 00       	LD	DE,FCB1
CE4A CD 05 00       	CALL	SYSTEM
CE4D C6 FF          	ADD	A,0FFH
CE4F C9             	RET
CE50                
CE50                C_DIR:
CE50 CD 47 DC       	CALL	FILEC
CE53 21 15 EB       	LD	HL,FDRV+1
CE56 CD 8A D1       	CALL	CWILD1
CE59 3E F1          	LD	A,0F1H
CE5B 32 21 EB       	LD	(FDRV+13),A
CE5E CD 0A CD       	CALL	OPEN1
CE61                CDIR1:
CE61 B7             	OR	A
CE62 20 08          	JR	NZ,PDSKF
CE64 CD AF CE       	CALL	P_NAME
CE67 CD 1C CD       	CALL	OPEN2
CE6A 18 F5          	JR	CDIR1
CE6C                
CE6C                PDSKF:
CE6C 3A 14 EB       	LD	A,(FDRV)
CE6F 5F             	LD	E,A
CE70 0E 1B          	LD	C,01BH		;(BDOS)ディスク情報の獲得
CE72 CD 05 00       	CALL	SYSTEM
CE75 4F             	LD	C,A		;C←1クラスタ辺りの論理セクタ数
CE76 C6 01          	ADD	A,001H
CE78 D8             	RET	C		;Aが0FFHだった場合
CE79 AF             	XOR	A
CE7A                PDS1:				;HL=未使用クラスタの総数
CE7A CB 19          	RR	C
CE7C 38 04          	JR	C,PDS2
CE7E 29             	ADD	HL,HL
CE7F 8F             	ADC	A,A
CE80 18 F8          	JR	PDS1
CE82                PDS2:
CE82 CB 50          	BIT	2,B		;B←論理セクタのサイズの上位8ビット
CE84 20 0A          	JR	NZ,PDSKF1	;K単位(4)になるまで未使用を2で割る
CE86 CB 3F          	SRL	A
CE88 CB 1C          	RR	H
CE8A CB 1D          	RR	L
CE8C CB 10          	RL	B
CE8E 18 F2          	JR	PDS2
CE90                PDSKF1:
CE90 CD 25 CF       	CALL	PRDEC_AHL
CE93 11 31 D2       	LD	DE,KBFREE
CE96 CD 75 D3       	CALL	_SYS09		;(BDOS)文字列出力
CE99 CD 17 CF       	CALL	PUTDRV
CE9C 3E 5C          	LD	A,05CH
CE9E CD 56 D7       	CALL	MSG_A
CEA1 2A 22 EB       	LD	HL,(FDRV+14)	;ディレクトリのクラスタ番号
CEA4 AF             	XOR	A
CEA5 11 FE FF       	LD	DE,0-2
CEA8 19             	ADD	HL,DE
CEA9 23             	INC	HL
CEAA DC 24 CF       	CALL	C,PRDEC_HL
CEAD 18 41          	JR	LTNL
CEAF                
CEAF                P_NAME:
CEAF 3A 96 D1       	LD	A,(DTA_CCP+1)
CEB2 FE 2E          	CP	'.'
CEB4 C8             	RET	Z
CEB5 11 4A D2       	LD	DE,DIRHD
CEB8 CD 75 D3       	CALL	_SYS09		;(BDOS)文字列出力
CEBB 3A A1 D1       	LD	A,(DTA_CCP+1+00BH)
CEBE F5             	PUSH	AF
CEBF 0F             	RRCA
CEC0 9F             	SBC	A,A
CEC1 E6 0A          	AND	'*'-020H
CEC3 C6 20          	ADD	A,020H
CEC5 CD 56 D7       	CALL	MSG_A
CEC8 CD 17 CF       	CALL	PUTDRV
CECB 21 96 D1       	LD	HL,DTA_CCP+1
CECE CD 68 CF       	CALL	FPRNT
CED1                
CED1 F1             	POP	AF
CED2 CB 67          	BIT	4,A
CED4 28 08          	JR	Z,DIR3
CED6 11 3F D2       	LD	DE,DIRMES
CED9 CD 75 D3       	CALL	_SYS09		;(BDOS)文字列出力
CEDC 18 0A          	JR	DIR6
CEDE                DIR3:
CEDE ED 5B B4 D1    	LD	DE,(DTA_CCP+1+01EH)
CEE2 2A B2 D1       	LD	HL,(DTA_CCP+1+01CH)
CEE5 CD 28 CF       	CALL	PRDEC_DEHL
CEE8                DIR6:
CEE8 3A B1 EC       	LD	A,(CRTCD+1)
CEEB FE 29          	CP	40+1
CEED D4 8A CF       	CALL	NC,PRTTMS
CEF0                
CEF0                LTNL:
CEF0 1E 03          	LD	E,3
CEF2 C3 CD EC       	JP	_PRINT
CEF5                
CEF5                C_PATH:
CEF5 CD 29 DD       	CALL	SPCUT
CEF8 21 BA D1       	LD	HL,PATHD
CEFB FE 21          	CP	021H
CEFD 30 0C          	JR	NC,CPATH0
CEFF                CPATHP:
CEFF 7E             	LD	A,(HL)
CF00 23             	INC	HL
CF01 FE 20          	CP	020H
CF03 3F             	CCF
CF04 30 EA          	JR	NC,LTNL
CF06 CD 56 D7       	CALL	MSG_A
CF09 18 F4          	JR	CPATHP
CF0B                CPATH0:
CF0B FE 3B          	CP	';'
CF0D 20 01          	JR	NZ,CPATH1
CF0F 13             	INC	DE
CF10                CPATH1:
CF10 EB             	EX	DE,HL
CF11 01 40 00       	LD	BC,PATHX
CF14 ED B0          	LDIR
CF16 C9             	RET
CF17                
CF17                PUTDRV:
CF17 3A 14 EB       	LD	A,(FDRV)
CF1A C6 40          	ADD	A,'A'-1
CF1C CD 56 D7       	CALL	MSG_A
CF1F 3E 3A          	LD	A,':'
CF21                MSG_AR:
CF21 C3 56 D7       	JP	MSG_A
CF24                
CF24                PRDEC_HL:
CF24 AF             	XOR	A
CF25                PRDEC_AHL:
CF25 5F             	LD	E,A
CF26 16 00          	LD	D,0
CF28                PRDEC_DEHL:
CF28 D5             	PUSH	DE
CF29 11 0F EB       	LD	DE,DECBF
CF2C 06 05          	LD	B,5
CF2E CD 2E D0       	CALL	ZERO_MEMORY_DE	;A=0
CF31 D1             	POP	DE
CF32                
CF32 0E 20          	LD	C,32
CF34                DEC1:
CF34 29             	ADD	HL,HL
CF35 EB             	EX	DE,HL
CF36 ED 6A          	ADC	HL,HL
CF38 EB             	EX	DE,HL
CF39 E5             	PUSH	HL
CF3A 21 13 EB       	LD	HL,DECBF+4
CF3D 06 05          	LD	B,5
CF3F                DEC2:
CF3F 7E             	LD	A,(HL)
CF40 8F             	ADC	A,A
CF41 27             	DAA
CF42 77             	LD	(HL),A
CF43 2B             	DEC	HL
CF44 10 F9          	DJNZ	DEC2
CF46 E1             	POP	HL
CF47 0D             	DEC	C
CF48 20 EA          	JR	NZ,DEC1
CF4A                
CF4A 21 0F EB       	LD	HL,DECBF
CF4D 3E 20          	LD	A,020H
CF4F 06 04          	LD	B,4
CF51                DEC3:
CF51 CD 5E CF       	CALL	DEC4
CF54 CD 5E CF       	CALL	DEC4
CF57 23             	INC	HL
CF58 10 F7          	DJNZ	DEC3
CF5A                DECX:
CF5A CD 5E CF       	CALL	DEC4
CF5D AF             	XOR	A
CF5E                DEC4:
CF5E ED 6F          	RLD
CF60 FE 20          	CP	020H
CF62 28 02          	JR	Z,DEC5
CF64 F6 30          	OR	030H
CF66                DEC5:
CF66 18 B9          	JR	MSG_AR
CF68                
CF68                FPRNT:
CF68 06 08          	LD	B,8
CF6A CD 7B CF       	CALL	P_N1
CF6D 7E             	LD	A,(HL)
CF6E C6 80          	ADD	A,0A0H-020H
CF70 FE A0          	CP	0A0H
CF72 28 02          	JR	Z,FPR1
CF74 3E 2E          	LD	A,'.'
CF76                FPR1:
CF76 CD 56 D7       	CALL	MSG_A
CF79 06 03          	LD	B,3
CF7B                
CF7B                P_N1:
CF7B C5             	PUSH	BC
CF7C E5             	PUSH	HL
CF7D 7E             	LD	A,(HL)
CF7E CD 7E DF       	CALL	CAP3
CF81 CD 56 D7       	CALL	MSG_A
CF84 E1             	POP	HL
CF85 C1             	POP	BC
CF86 23             	INC	HL
CF87 10 F2          	DJNZ	P_N1
CF89 C9             	RET
CF8A                
CF8A                PRTTMS:
CF8A 3E 20          	LD	A,020H
CF8C CD 56 D7       	CALL	MSG_A
CF8F                
CF8F 2A AE D1       	LD	HL,(DTA_CCP+1+24)
CF92 7D             	LD	A,L
CF93 B7             	OR	A
CF94 C8             	RET	Z
CF95 CB 3C          	SRL	H
CF97 17             	RLA
CF98 17             	RLA
CF99 17             	RLA
CF9A 17             	RLA
CF9B E6 0F          	AND	00FH
CF9D 57             	LD	D,A
CF9E 7C             	LD	A,H
CF9F C6 50          	ADD	A,80
CFA1 CD E4 CF       	CALL	PRDEC_A
CFA4 3E 2D          	LD	A,'-'
CFA6 CD 56 D7       	CALL	MSG_A
CFA9 7A             	LD	A,D
CFAA CD E4 CF       	CALL	PRDEC_A
CFAD 3E 2D          	LD	A,'-'
CFAF CD 56 D7       	CALL	MSG_A
CFB2 7D             	LD	A,L
CFB3 E6 1F          	AND	01FH
CFB5 CD E4 CF       	CALL	PRDEC_A
CFB8                
CFB8 2A AC D1       	LD	HL,(DTA_CCP+1+22)
CFBB                
CFBB 3E 20          	LD	A,020H
CFBD CD 56 D7       	CALL	MSG_A
CFC0 7C             	LD	A,H
CFC1 65             	LD	H,L
CFC2 06 03          	LD	B,3
CFC4                PRTTMS1:
CFC4 1F             	RRA
CFC5 CB 1D          	RR	L
CFC7 10 FB          	DJNZ	PRTTMS1
CFC9 E6 1F          	AND	01FH
CFCB CD E4 CF       	CALL	PRDEC_A
CFCE 3E 3A          	LD	A,':'
CFD0 CD 56 D7       	CALL	MSG_A
CFD3 7D             	LD	A,L
CFD4 0F             	RRCA
CFD5 0F             	RRCA
CFD6 E6 3F          	AND	03FH
CFD8 CD E4 CF       	CALL	PRDEC_A
CFDB 3E 3A          	LD	A,':'
CFDD CD 56 D7       	CALL	MSG_A
CFE0 7C             	LD	A,H
CFE1 E6 1F          	AND	01FH
CFE3 87             	ADD	A,A
CFE4                
CFE4                ;	PRINT10
CFE4                
CFE4                PRDEC_A:
CFE4 E5             	PUSH	HL
CFE5 06 08          	LD	B,8
CFE7 4F             	LD	C,A
CFE8 AF             	XOR	A
CFE9                PRTA1:
CFE9 CB 01          	RLC	C
CFEB 8F             	ADC	A,A
CFEC 27             	DAA
CFED 10 FA          	DJNZ	PRTA1
CFEF 21 0F EB       	LD	HL,DECBF
CFF2 77             	LD	(HL),A
CFF3 AF             	XOR	A
CFF4 CD 5A CF       	CALL	DECX
CFF7 E1             	POP	HL
CFF8 C9             	RET
CFF9                
CFF9                SETFCB:
CFF9 CD 29 DD       	CALL	SPCUT
CFFC 1A             	LD	A,(DE)
CFFD FE 20          	CP	020H
CFFF 38 01          	JR	C,SETFCBA
D001 1B             	DEC	DE
D002                SETFCBA:
D002 06 24          	LD	B,36
D004 21 5C 00       	LD	HL,FCB1
D007 E5             	PUSH	HL
D008 AF             	XOR	A
D009 CD FE DC       	CALL	FILL_MEMORY
D00C E1             	POP	HL
D00D D5             	PUSH	DE
D00E CD 01 D6       	CALL	_SYS29		;(BDOS)ファイル名の解析
D011 21 6C 00       	LD	HL,FCB2
D014 CD 01 D6       	CALL	_SYS29		;(BDOS)ファイル名の解析
D017 E1             	POP	HL
D018 01 00 50       	LD	BC,05000H
D01B 11 81 00       	LD	DE,00081H
D01E                SETFCB1:
D01E 7E             	LD	A,(HL)
D01F 23             	INC	HL
D020 FE 20          	CP	020H
D022 38 05          	JR	C,SETFCB2
D024 12             	LD	(DE),A
D025 13             	INC	DE
D026 0C             	INC	C
D027 10 F5          	DJNZ	SETFCB1
D029                SETFCB2:
D029 79             	LD	A,C
D02A 32 80 00       	LD	(DTA1),A
D02D 04             	INC	B
D02E                ZERO_MEMORY_DE:
D02E AF             	XOR	A
D02F                FILL_MEMORY_DE:
D02F 12             	LD	(DE),A
D030 13             	INC	DE
D031 10 FC          	DJNZ	FILL_MEMORY_DE
D033 C9             	RET
D034                
D034                C_COPY:
D034 CD F9 CF       	CALL	SETFCB
D037 11 81 00       	LD	DE,DTA1+1
D03A 0E 2F          	LD	C,'/'
D03C CD 28 CE       	CALL	SWITCH
D03F CD 72 DF       	CALL	CAP
D042 32 CA D0       	LD	(SW+1),A
D045                
D045 11 61 EB       	LD	DE,BEEPD
D048 CD 4A DC       	CALL	FILEC2
D04B 21 6C 00       	LD	HL,FCB2
D04E CD 08 D6       	CALL	S29X1
D051                
D051 3E 10          	LD	A,010H
D053 32 69 00       	LD	(FCB1+13),A
D056 21 6D 00       	LD	HL,FCB2+1
D059 CD 8A D1       	CALL	CWILD1
D05C                COPY0:
D05C CD 87 D1       	CALL	CWILD
D05F 21 5C 00       	LD	HL,FCB1
D062 CD 0D CD       	CALL	OPEN
D065 37             	SCF
D066                COPY1:
D066 C0             	RET	NZ
D067 CD 20 CD       	CALL	DEFCB
D06A                
D06A 3A A2 D1       	LD	A,(DTA_CCP+13)
D06D CB 67          	BIT	4,A
D06F 28 24          	JR	Z,COPY1A
D071                
D071 21 5D 00       	LD	HL,FCB1+1
D074 CD A7 E0       	CALL	CHKWILD
D077 38 17          	JR	C,COPY9
D079                
D079 3E 20          	LD	A,020H
D07B 32 5D 00       	LD	(FCB1+1),A
D07E 2A AF D1       	LD	HL,(DTA_CCP+26)
D081 23             	INC	HL
D082 22 6A 00       	LD	(FCB1+14),HL
D085 18 D5          	JR	COPY0
D087                
D087                COPYS:
D087 11 74 EB       	LD	DE,SKIP
D08A                COPY8:
D08A CD 75 D3       	CALL	_SYS09		;(BDOS)文字列出力
D08D CD F0 CE       	CALL	LTNL
D090                COPY9:
D090 CD 1C CD       	CALL	OPEN2
D093 18 D1          	JR	COPY1
D095                
D095                COPY1A:
D095 21 6C 00       	LD	HL,FCB2
D098 11 14 EB       	LD	DE,FDRV
D09B 01 97 D1       	LD	BC,DTA_CCP+2
D09E ED A0          	LDI
D0A0 3E 0B          	LD	A,11
D0A2                COPY2:
D0A2 F5             	PUSH	AF
D0A3 7E             	LD	A,(HL)
D0A4 FE 3F          	CP	'?'
D0A6 20 01          	JR	NZ,COPY3
D0A8 0A             	LD	A,(BC)
D0A9                COPY3:
D0A9 12             	LD	(DE),A
D0AA 03             	INC	BC
D0AB 13             	INC	DE
D0AC 23             	INC	HL
D0AD F1             	POP	AF
D0AE 3D             	DEC	A
D0AF 20 F1          	JR	NZ,COPY2
D0B1 01 05 00       	LD	BC,16-11
D0B4 ED B0          	LDIR
D0B6                PUTNAME:
D0B6 21 5D 00       	LD	HL,FCB1+1
D0B9 CD A7 E0       	CALL	CHKWILD
D0BC 30 0B          	JR	NC,PUTN1
D0BE 21 15 EB       	LD	HL,FDRV+1
D0C1 CD 68 CF       	CALL	FPRNT
D0C4 3E 20          	LD	A,020H
D0C6 CD 56 D7       	CALL	MSG_A
D0C9                PUTN1:
D0C9 3E 00          SW:	LD	A,000H
D0CB FE 54          	CP	'T'
D0CD 20 05          	JR	NZ,CSW1
D0CF 21 E9 D0       	LD	HL,SWNE
D0D2 18 07          	JR	SWT1
D0D4                CSW1:
D0D4 FE 4E          	CP	'N'
D0D6 20 11          	JR	NZ,SWNE
D0D8 21 87 D0       	LD	HL,COPYS
D0DB                SWT1:
D0DB 11 14 EB       	LD	DE,FDRV
D0DE CD 39 CD       	CALL	SYSC0F
D0E1 28 01          	JR	Z,SWN1
D0E3 E9             	JP	(HL)
D0E4                SWN1:
D0E4 CD 3D D1       	CALL	CTIME
D0E7 30 9E          	JR	NC,COPYS
D0E9                SWNE:
D0E9 11 14 EB       	LD	DE,FDRV
D0EC 0E 16          	LD	C,016H		;(BDOS)ファイルの作成
D0EE CD 3B CD       	CALL	SYSTEM0
D0F1 20 48          	JR	NZ,COPYE2
D0F3 67             	LD	H,A		;A=0
D0F4 6F             	LD	L,A
D0F5 22 35 EB       	LD	(FDRV+33),HL	;(FCB)ランダムレコード
D0F8 22 37 EB       	LD	(FDRV+35),HL
D0FB                COPY6:
D0FB CD 4B CD       	CALL	S27BUF
D0FE 47             	LD	B,A
D0FF 3C             	INC	A
D100 28 31          	JR	Z,COPYE
D102 7C             	LD	A,H
D103 B5             	OR	L
D104 28 0C          	JR	Z,COPY7
D106 11 14 EB       	LD	DE,FDRV
D109 0E 26          	LD	C,026H		;(BDOS)ランダムブロック書き込み
D10B CD 3B CD       	CALL	SYSTEM0
D10E 20 23          	JR	NZ,COPYE
D110 10 E9          	DJNZ	COPY6
D112                COPY7:
D112 3A A2 D1       	LD	A,(DTA_CCP+13)	;(FCB)属性
D115 32 21 EB       	LD	(FDRV+13),A
D118 21 A9 D1       	LD	HL,DTA_CCP+20	;(FCB)タイムスタンプ
D11B 11 28 EB       	LD	DE,FDRV+20
D11E 01 04 00       	LD	BC,4
D121 ED B0          	LDIR
D123                
D123 11 14 EB       	LD	DE,FDRV
D126 0E 10          	LD	C,010H		;(BDOS)ファイルのクローズ
D128 CD 3B CD       	CALL	SYSTEM0
D12B 20 06          	JR	NZ,COPYE
D12D                
D12D 11 71 EB       	LD	DE,OK
D130 C3 8A D0       	JP	COPY8
D133                
D133                COPYE:
D133 11 14 EB       	LD	DE,FDRV
D136 0E 13          	LD	C,013H		;(BDOS)ファイルの削除
D138 CD 05 00       	CALL	SYSTEM
D13B                COPYE2:
D13B 37             	SCF
D13C C9             	RET
D13D                
D13D                CTIME:
D13D ED 5B A9 D1    	LD	DE,(DTA_CCP+20)
D141 2A 28 EB       	LD	HL,(FDRV+20)
D144 A7             	AND	A
D145 ED 52          	SBC	HL,DE
D147 C0             	RET	NZ
D148 ED 5B AB D1    	LD	DE,(DTA_CCP+22)
D14C 2A 2A EB       	LD	HL,(FDRV+22)
D14F ED 52          	SBC	HL,DE
D151 C9             	RET
D152                
D152                C_TYPE:
D152 CD F9 CF       	CALL	SETFCB
D155 21 5C 00       	LD	HL,FCB1
D158 CD 0D CD       	CALL	OPEN
D15B 37             	SCF
D15C                TYPE1:
D15C C0             	RET	NZ
D15D CD 20 CD       	CALL	DEFCB
D160 3E 06          	LD	A,6
D162 CD 56 D7       	CALL	MSG_A
D165                TYPE2:
D165 CD 4B CD       	CALL	S27BUF
D168 C6 FE          	ADD	A,0FEH
D16A D8             	RET	C
D16B 7C             	LD	A,H
D16C B5             	OR	L
D16D 28 13          	JR	Z,TYPEE
D16F 01 00 01       	LD	BC,00100H
D172                TYPE3:
D172 0A             	LD	A,(BC)
D173 03             	INC	BC
D174 FE 1A          	CP	01AH
D176 28 0A          	JR	Z,TYPEE
D178 CD 56 D7       	CALL	MSG_A
D17B 2B             	DEC	HL
D17C 7C             	LD	A,H
D17D B5             	OR	L
D17E 20 F2          	JR	NZ,TYPE3
D180 18 E3          	JR	TYPE2
D182                TYPEE:
D182 CD 1C CD       	CALL	OPEN2
D185 18 D5          	JR	TYPE1
D187                
D187                CWILD:
D187 21 5D 00       	LD	HL,FCB1+1
D18A                CWILD1:
D18A 7E             	LD	A,(HL)
D18B FE 20          	CP	020H
D18D C0             	RET	NZ
D18E                CWILD2:
D18E 3E 3F          	LD	A,'?'
D190 06 0B          	LD	B,11
D192 C3 FE DC       	JP	FILL_MEMORY
D195                
D195                DTA_CCP:
D195                	DS	37
D1BA                
D1BA 00 00 00 40    PATHX	EQU	64
D1BA                PATHD:	DS	PATHX
D1FA 00             PATHE:	DB	0
D1FB                
D1FB 00 00 00 09    COMS	EQU	9
D1FB                COMTB:
D1FB 44 20 20 20    	DB	"D   "	;1
D1FF 50 CE          	DW	C_DIR
D201 44 49 52 20    	DB	"DIR "	;2
D205 50 CE          	DW	C_DIR
D207 43 4F 50 59    	DB	"COPY"	;3
D20B 34 D0          	DW	C_COPY
D20D 43 44 20 20    	DB	"CD  "	;4
D211 40 CD          	DW	C_CD
D213 44 45 4C 20    	DB	"DEL "	;5
D217 33 CE          	DW	C_DEL
D219 50 41 54 48    	DB	"PATH"	;6
D21D F5 CE          	DW	C_PATH
D21F 52 45 4E 20    	DB	"REN "	;7
D223 3D CE          	DW	C_REN
D225 54 59 50 45    	DB	"TYPE"	;8
D229 52 D1          	DW	C_TYPE
D22B 52 45 4D 20    	DB	"REM "	;9
D22F 31 CE          	DW	C_REM
D231                
D231 6B 20 62 79    KBFREE:	DB	"k bytes free",9,'$'
D235 74 65 73 20
D239 66 72 65 65
D23D 09 24
D23F 20 20 20 20    DIRMES:	DB	"     <DIR>$"
D243 20 3C 44 49
D247 52 3E 24
D24A 20 20 3A 24    DIRHD:	DB	"  :$"
D24E                	INCLUDE	"LDDISK2.ASM"
D24E                
D24E                ;	LSX-Dodgers DISK2
D24E                
D24E                
D24E                ;	GRAPHIC RAM DISK DRIVER
D24E                
D24E                
D24E                GDRD:
D24E C5             	PUSH	BC
D24F CD 77 D2       	CALL	GADR
D252 F1             	POP	AF
D253                GDRD1:
D253 ED A2          	INI
D255 04             	INC	B
D256 0C             	INC	C
D257 20 FA          	JR	NZ,GDRD1
D259 04             	INC	B
D25A 13             	INC	DE
D25B 3D             	DEC	A
D25C 20 F5          	JR	NZ,GDRD1
D25E                GBANK0:
D25E 3A BF EC       	LD	A,(WK1FD0)
D261 E6 EF          	AND	0EFH		;BANK0
D263 18 1D          	JR	S1FD0
D265                
D265                GDWT:
D265 C5             	PUSH	BC
D266 CD 77 D2       	CALL	GADR
D269 F1             	POP	AF
D26A                GDWT1:
D26A 04             	INC	B
D26B ED A3          	OUTI
D26D 0C             	INC	C
D26E 20 FA          	JR	NZ,GDWT1
D270 04             	INC	B
D271 13             	INC	DE
D272 3D             	DEC	A
D273 20 F5          	JR	NZ,GDWT1
D275 18 E7          	JR	GBANK0
D277                
D277                GADR:
D277 0E 00          	LD	C,0
D279 7B             	LD	A,E
D27A C6 40          	ADD	A,040H
D27C 47             	LD	B,A
D27D 3A BF EC       	LD	A,(WK1FD0)
D280 F6 10          	OR	010H		;BANK1
D282                S1FD0:
D282 C5             	PUSH	BC
D283 32 BF EC       	LD	(WK1FD0),A
D286 01 D0 1F       	LD	BC,01FD0H
D289 ED 79          	OUT	(C),A
D28B C1             	POP	BC
D28C C9             	RET
D28D                
D28D                
D28D                ;	BANK RAM DISK DRIVER
D28D                
D28D                BDWT:
D28D 3E             	DB	03EH	;LD A,??
D28E 37             	SCF
D28F 18 02          	JR	BRW
D291                
D291                BDRD:
D291 3E             	DB	03EH	;LD A,??
D292 A7             	AND	A
D293                BRW:
D293 F3             	DI
D294 32 BC D2       	LD	(BRWPAT),A
D297 ED 73 DC D2    	LD	(BANKSP+1),SP
D29B 3A DD D2       	LD	A,(BANKSP+2)
D29E 87             	ADD	A,A
D29F 38 03          	JR	C,BRW0
D2A1 31 00 00       	LD	SP,EXTSP
D2A4                BRW0:
D2A4 D9             	EXX		;裏レジスタ
D2A5 C5             	 PUSH	 BC
D2A6 D5             	 PUSH	 DE
D2A7 01 00 0B       	 LD	 BC,00B00H	 ;バンクメモリ
D2AA 11 10 10       	 LD	 DE,01010H
D2AD D9             	 EXX		;表レジスタ
D2AE                BRW1:
D2AE C5             	PUSH	BC
D2AF D5             	PUSH	DE
D2B0 EB             	EX	DE,HL
D2B1 29             	ADD	HL,HL
D2B2 29             	ADD	HL,HL
D2B3 7C             	LD	A,H
D2B4 E6 0F          	AND	00FH	;バンク
D2B6 65             	LD	H,L
D2B7 CB 3C          	SRL	H	;/2
D2B9 2E 00          	LD	L,0
D2BB D9             	EXX		;裏レジスタ
D2BC A7             BRWPAT:	 AND	 A	;自己書き換え(AND A:読み出し/SCF:書き込み)
D2BD 38 08          	 JR	 C,BRWT
D2BF 57             	 LD	 D,A	 ;D=バンク
D2C0 D9             	 EXX		;表レジスタ
D2C1 EB             	EX	DE,HL
D2C2 CD E0 D2       	CALL	BTFR
D2C5 18 06          	JR	BRW2
D2C7                BRWT:
D2C7 5F             	 LD	E,A	 ;E=バンク
D2C8 D9             	 EXX		;表レジスタ
D2C9 CD E0 D2       	CALL	BTFR
D2CC EB             	EX	DE,HL
D2CD                BRW2:
D2CD D1             	POP	DE
D2CE C1             	POP	BC
D2CF 13             	INC	DE
D2D0 10 DC          	DJNZ	BRW1
D2D2                
D2D2 D9             	EXX		;裏レジスタ
D2D3 3E 10          	 LD	 A,10H
D2D5 ED 79          	 OUT	 (C),A		;メインメモリに切り替える
D2D7 D1             	 POP	 DE
D2D8 C1             	 POP	 BC
D2D9 D9             	 EXX		;表レジスタ
D2DA AF             	XOR	A
D2DB 31 00 00       BANKSP:	LD	SP,0
D2DE FB             	EI
D2DF C9             	RET
D2E0                
D2E0                ;メインメモリ←→バンクメモリ 512バイトの転送を行う
D2E0                ; DE:転送元アドレス
D2E0                ; HL:転送先アドレス
D2E0                ; 裏BC:バンク切り替えポート(0B00H)
D2E0                ; 裏D:転送元バンク(0-0FH:10Hはメインメモリ)
D2E0                ; 裏E:転送先バンク(0-0FH:10Hはメインメモリ)
D2E0                
D2E0                BTFR:
D2E0 06 00          	LD	B,0	;256回ループ(256*2)
D2E2                BTFR1:
D2E2 D9             	EXX		;裏レジスタ
D2E3 ED 51          	 OUT	 (C),D	 ;BANK(MAIN)
D2E5 D9             	 EXX		;表レジスタ
D2E6 1A             	LD	A,(DE)
D2E7 4F             	LD	C,A
D2E8 13             	INC	DE
D2E9 1A             	LD	A,(DE)
D2EA 13             	INC	DE
D2EB D9             	EXX		;裏レジスタ
D2EC ED 59          	 OUT	 (C),E	 ;MAIN(BANK)
D2EE D9             	 EXX		;表レジスタ
D2EF 71             	LD	(HL),C
D2F0 23             	INC	HL
D2F1 77             	LD	(HL),A
D2F2 23             	INC	HL
D2F3 10 ED          	DJNZ	BTFR1
D2F5 C9             	RET
D2F6                
D2F6                ;	EMM DRIVER(DMA)
D2F6                
D2F6                
D2F6                EDWT:
D2F6 0E 0F          	LD	C,15
D2F8 18 02          	JR	EDWT1
D2FA                EDRD:
D2FA 0E 0E          	LD	C,14
D2FC                EDWT1:
D2FC C5             	PUSH	BC
D2FD D5             	PUSH	DE
D2FE 22 3F D3       	LD	(DMAB),HL
D301 78             	LD	A,B
D302 87             	ADD	A,A
D303 3D             	DEC	A
D304 32 38 D3       	LD	(DMALEN+1),A
D307 3C             	INC	A
D308 84             	ADD	A,H	;HL(アドレス)を先に進めておく
D309 67             	LD	H,A
D30A EB             	EX	DE,HL
D30B 29             	ADD	HL,HL
D30C 3A A1 EC       	LD	A,(_MAXCYL)
D30F 47             	LD	B,A
D310 79             	LD	A,C
D311 0E 00          	LD	C,0
D313 09             	ADD	HL,BC
D314 ED 4B 84 EC    	LD	BC,(_DRIVE)
D318 06 0D          	LD	B,00DH
D31A ED 49          	OUT	(C),C
D31C 0C             	INC	C
D31D ED 69          	OUT	(C),L
D31F 0C             	INC	C
D320 ED 61          	OUT	(C),H
D322                
D322 21 33 D3       	LD	HL,EDMAD
D325 CD 2E DB       	CALL	SETDMA
D328 CD 56 DB       	CALL	GO_DMA
D32B EB             	EX	DE,HL
D32C D1             	POP	DE
D32D C1             	POP	BC
D32E                DMA_ADD_SEC:
D32E 13             	INC	DE
D32F 10 FD          	DJNZ	DMA_ADD_SEC
D331 AF             	XOR	A
D332 C9             	RET
D333                
D333                EDMAD:
D333 C3             	DB	0C3H	;WR6 リセット
D334 7D             	DB	07DH	;WR0 ポートA→ポートB 転送
D335 03 0D          	DW	00D03H	;ポートA開始アドレス EMMリード/ライト
D337 FF 01          DMALEN:	DW	001FFH	;ブロック長(転送サイズ-1)
D339 2C             	DB	02CH	;WR1 ポートAアドレス固定 I/O
D33A 50             	DB	050H	;WR2 ポートBアドレスインクリメント メモリ
D33B 02             	DB	002H	;ポートBタイミング
D33C 80             	DB	080H	;WR3
D33D 9A             	DB	09AH	;WR5 WAIT RDY:HIGH
D33E AD             	DB	0ADH	;WR4 連続 ポートB開始アドレス
D33F 00 00          DMAB:	DW	0
D341 01             	DB	001H	;WR0 ポートA←ポートB 転送
D342                EMME:
D342                
D342 00 00 07 82    AT_RE	EQU	EDWT-AT_EDWT
D342                
D342                	INCLUDE	"LDOS.ASM"
D342                
D342                ;	LSX-Dodgers OS
D342                
D342                BDOS0:
D342 E5             	PUSH	HL
D343 21 60 00       	LD	HL,010000H-STACK
D346 39             	ADD	HL,SP
D347 38 10          	JR	C,BDOS1X
D349                BDOS2:
D349 E1             	POP	HL
D34A ED 73 55 D3    	LD	(BDSP+1),SP
D34E 31 00 00       	LD	SP,EXTSP
D351 CD 58 D3       	CALL	BDOS1
D354 31 00 00       BDSP:	LD	SP,0
D357 C9             	RET
D358                BDOS1:
D358 E5             	PUSH	HL
D359                BDOS1X:
D359 79             	LD	A,C
D35A FE 31          	CP	031H
D35C 30 0A          	JR	NC,OVERFN
D35E 87             	ADD	A,A
D35F 6F             	LD	L,A
D360 26 EC          	LD	H,STABLE/256
D362 7E             	LD	A,(HL)
D363 2C             	INC	L
D364 66             	LD	H,(HL)
D365 6F             	LD	L,A
D366 E3             	EX	(SP),HL
D367 C9             	RET
D368                OVERFN
D368 E1             	POP	HL
D369 FE 6F          	CP	06FH		;DOSVER MSX-DOS のバージョン番号の獲得
D36B 20 06          	JR	NZ,_ERROR
D36D 01 1D 01       	LD	BC,011DH
D370 11 3C 01       	LD	DE,VER
D373                _ERROR:
D373 AF             	XOR	A
D374 C9             	RET
D375                
D375                _SYS09:		;文字列出力
D375 D5             	PUSH	DE
D376                _SX09:
D376 1A             	LD	A,(DE)
D377 13             	INC	DE
D378 FE 24          	CP	'$'
D37A 28 32          	JR	Z,SX0E2
D37C CD 56 D7       	CALL	MSG_A
D37F 18 F5          	JR	_SX09
D381                
D381                MSX1:
D381 CD 56 D7       	CALL	MSG_A
D384                MSX:
D384 7E             	LD	A,(HL)
D385 23             	INC	HL
D386 B7             	OR	A
D387 20 F8          	JR	NZ,MSX1
D389 C9             	RET
D38A                
D38A                _SYS0C:		;(BDOS)バージョン番号の獲得
D38A 21 22 00       	LD	HL,00022H
D38D AF             	XOR	A
D38E 7D             	LD	A,L
D38F C9             	RET
D390                
D390                _SYS0D:		;(BDOS)ディスクリセット
D390 CD DF EC       	CALL	_FFLUSH
D393 E5             	PUSH	HL
D394 21 80 00       	LD	HL,00080H
D397 22 8A EC       	LD	(_DTA),HL
D39A E1             	POP	HL
D39B D5             	PUSH	DE
D39C 1E 00          	LD	E,0
D39E 3E             	DB	03EH
D39F                
D39F                _SYS0E:		;(BDOS)カレントドライブの設定
D39F D5             	PUSH	DE
D3A0 7B             	LD	A,E
D3A1 DD E5          	PUSH	IX
D3A3 CD DC EC       	CALL	_GETDPB
D3A6 DD E1          	POP	IX
D3A8 38 04          	JR	C,SX0E2
D3AA 7B             	LD	A,E
D3AB 32 87 EC       	LD	(_DVSW),A
D3AE                SX0E2:
D3AE 3E 08          	LD	A,8
D3B0 D1             	POP	DE
D3B1 C9             	RET
D3B2                
D3B2                _SYS0F:		;(BDOS)ファイルのオープン
D3B2 CD 3B DD       	CALL	SETDRV
D3B5 FD 7E 1C       	LD	A,(IY+28)	;(FCB)オープンモード
D3B8 C6 02          	ADD	A,002H		;Write
D3BA 28 48          	JR	Z,FEND0F
D3BC CD A3 E0       	CALL	CHKWILDX
D3BF                
D3BF D4 5B DD       	CALL	NC,SOPENX
D3C2                _S16XX:
D3C2 38 40          	JR	C,FEND0F
D3C4                				;Directory location
D3C4 3A 9F EC       	LD	A,(_FILEN)
D3C7 FD 77 19       	LD	(IY+25),A	;(FCB)ディレクトリロケーション
D3CA                ;				_DIRF
D3CA 3A A0 EC       	LD	A,(_DIRF)
D3CD FD 77 1D       	LD	(IY+29),A	;(FCB)ディレクトリモード
D3D0                ;				_FBPS
D3D0 FD 73 1E       	LD	(IY+30),E	;(FCB)ディレクトリポジション
D3D3 FD 72 1F       	LD	(IY+31),D
D3D6                ;				Open(Read)
D3D6 FD 36 1C FF    	LD	(IY+28),0FFH	;(FCB)オープンモード
D3DA                ;				FILENAME
D3DA FD E5          	PUSH	IY
D3DC D1             	POP	DE
D3DD 13             	INC	DE
D3DE 01 0B 00       	LD	BC,11
D3E1 ED B0          	LDIR
D3E3                ;				Attribute
D3E3 7E             	LD	A,(HL)
D3E4 FD 77 0D       	LD	(IY+13),A	;(FCB)属性(アトリビュート)
D3E7 11 0B 00       	LD	DE,11		;Reserved
D3EA 19             	ADD	HL,DE
D3EB                					;(FCB)ファイルを最後に変更した時刻
D3EB 11 EA EB       	LD	DE,SDDATA		;(FCB)ファイルを最後に変更した日付
D3EE 06 0A          	LD	B,SDDATAE-SDDATA	;(FCB)ファイルの先頭クラスタ
D3F0                S16LOOP:				;(FCB)ファイルのサイズ(バイト単位)
D3F0 1A             	LD	A,(DE)
D3F1 13             	INC	DE
D3F2 32 F9 D3       	LD	(S16PAT+2),A
D3F5 7E             	LD	A,(HL)
D3F6 23             	INC	HL
D3F7 FD 77 00       S16PAT:	LD	(IY+0),A
D3FA 10 F4          	DJNZ	S16LOOP
D3FC                
D3FC AF             	XOR	A
D3FD FD 77 0C       	LD	(IY+12),A	;(FCB)カレントブロック
D400 FD 22 D0 D4    	LD	(OFCB+1),IY
D404                FEND0F:
D404 18 43          	JR	FEND10
D406                
D406                _SYS10:		;(BDOS)ファイルのクローズ
D406 CD 3B DD       	CALL	SETDRV
D409 FD 7E 1C       	LD	A,(IY+28)	;(FCB)オープンモード
D40C D6 FE          	SUB	0FEH
D40E 37             	SCF
D40F 3F             	CCF
D410 20 37          	JR	NZ,FEND10
D412                _S10A:				;Write
D412 FD 77 0E       	LD	(IY+14),A	;(FCB)レコードサイズ/アクセスするディレクトリのクラスタ番号+1
D415 FD 77 0F       	LD	(IY+15),A
D418                
D418 FD 34 1C       	INC	(IY+28)		;0FEH->0FFH ;オープンモード
D41B CD 91 E1       	CALL	SETTMS
D41E                
D41E FD 7E 1D       	LD	A,(IY+29)	;(FCB)ディレクトリモード
D421 32 A0 EC       	LD	(_DIRF),A
D424 E6 7F          	AND	07FH
D426 32 73 E6       	LD	(_SECPS+1),A
D429 FD 5E 1E       	LD	E,(IY+30)	;(FCB)ディレクトリポジション
D42C FD 56 1F       	LD	D,(IY+31)
D42F CD 96 DE       	CALL	READ_DIR
D432 38 15          	JR	C,FEND10
D434                
D434 FD 7E 19       	LD	A,(IY+25)	;(FCB)ディレクトリロケーション
D437 E6 1F          SDECM1:	AND	01FH		;自己書き換え(1セクタ辺りのディレクトリエントリ数-1) 1024=01FH / 512=00FH / 256=7
D439 6F             	LD	L,A
D43A 26 00          	LD	H,0
D43C 29             	ADD	HL,HL		;*2
D43D 29             	ADD	HL,HL		;*4
D43E 29             	ADD	HL,HL		;*8
D43F 29             	ADD	HL,HL		;*16
D440 29             	ADD	HL,HL		;*32
D441 ED 4B 7E EC    	LD	BC,(_DTBUF)
D445 09             	ADD	HL,BC
D446                
D446 CD B3 E0       	CALL	SDIRENT
D449                FEND10:
D449 18 6C          	JR	FEND
D44B                
D44B                OPENDD:
D44B FD 36 1C FD    	LD	(IY+28),0FDH	;(FCB)オープンモード
D44F FD 36 0D 20    	LD	(IY+13),020H	;(FCB)属性(アトリビュート)
D453 CD 96 E1       	CALL	SETTMSX
D456 18 5F          	JR	FEND
D458                
D458                _SYS11:		;(BDOS)最初のファイルの検索
D458 CD 3B DD       	CALL	SETDRV
D45B CD DD DE       	CALL	CHKDDX
D45E 38 18          	JR	C,_S11A
D460 FD E5          	PUSH	IY
D462 E1             	POP	HL
D463 ED 5B 8A EC    	LD	DE,(_DTA)
D467 01 0C 00       	LD	BC,12
D46A ED B0          	LDIR
D46C 3E 20          	LD	A,020H
D46E 12             	LD	(DE),A
D46F 13             	INC	DE
D470 62             	LD	H,D
D471 6B             	LD	L,E
D472 13             	INC	DE
D473 0E 13          	LD	C,19
D475 70             	LD	(HL),B
D476 18 3D          	JR	_S11B
D478                _S11A:
D478 CD 8F DD       	CALL	SOPEN
D47B                _S12X1:
D47B 38 3A          	JR	C,FEND
D47D CD 2F DE       	CALL	SOPENE2
D480 ED 5B 8A EC    	LD	DE,(_DTA)
D484 3A 88 EC       	LD	A,(_DRV)
D487 3C             	INC	A
D488 12             	LD	(DE),A
D489 D5             	PUSH	DE
D48A 13             	INC	DE
D48B 01 20 00       	LD	BC,32
D48E ED B0          	LDIR
D490 FD 6E 0E       	LD	L,(IY+14)	;(FCB)レコードサイズ/アクセスするディレクトリのクラスタ番号+1
D493 FD 66 0F       	LD	H,(IY+15)
D496 22 F4 EB       	LD	(SCDIR),HL
D499 2A 9A EC       	LD	HL,(_FBPS)
D49C 22 F6 EB       	LD	(SFBPS),HL
D49F 2A 9F EC       	LD	HL,(_FILEN)
D4A2 7C             	LD	A,H
D4A3 B7             	OR	A
D4A4 28 06          	JR	Z,_S12DIR
D4A6 3A 73 E6       	LD	A,(_SECPS+1)
D4A9 F6 80          	OR	080H
D4AB 67             	LD	H,A
D4AC                _S12DIR
D4AC 22 F8 EB       	LD	(SFNDF),HL	;Directory position and Flags
D4AF E1             	POP	HL
D4B0 11 39 EB       	LD	DE,SFILE
D4B3 0E 21          	LD	C,33
D4B5                _S11B:
D4B5 ED B0          	LDIR
D4B7                FEND:
D4B7 9F             	SBC	A,A		;CF=0 A=0 : CF=1 A=0FFH
D4B8                FENDE:
D4B8 FD E1          	POP	IY
D4BA C1             	POP	BC
D4BB D1             	POP	DE
D4BC E1             	POP	HL
D4BD C9             	RET
D4BE                
D4BE                _SYS12:		;(BDOS)次のファイルの検索
D4BE E5             	PUSH	HL
D4BF D5             	PUSH	DE
D4C0 C5             	PUSH	BC
D4C1 FD E5          	PUSH	IY
D4C3 CD F3 DD       	CALL	NOPEN
D4C6 18 B3          	JR	_S12X1
D4C8                
D4C8                _S16K:
D4C8 FD 7E 1C       	LD	A,(IY+28)	;(FCB)オープンモード
D4CB FE FD          	CP	0FDH		;Device(0FDH)
D4CD 37             	SCF
D4CE C8             	RET	Z
D4CF                
D4CF 11 00 00       OFCB:	LD	DE,0
D4D2 D5             	PUSH	DE
D4D3 06 1A          	LD	B,26		;First cluster
D4D5                S16K1:
D4D5 13             	INC	DE
D4D6 23             	INC	HL
D4D7 10 FC          	DJNZ	S16K1
D4D9                
D4D9 1A             	LD	A,(DE)
D4DA BE             	CP	(HL)
D4DB 20 13          	JR	NZ,S16K2
D4DD 13             	INC	DE
D4DE 23             	INC	HL
D4DF 1A             	LD	A,(DE)
D4E0 BE             	CP	(HL)
D4E1 20 0D          	JR	NZ,S16K2
D4E3                
D4E3 E1             	POP	HL
D4E4 FD E5          	PUSH	IY
D4E6 D1             	POP	DE
D4E7 1A             	LD	A,(DE)		;Drive
D4E8 BE             	CP	(HL)
D4E9 20 06          	JR	NZ,S16K3
D4EB                				;ここはCFが必ず0
D4EB ED 52          	SBC	HL,DE		;CP HL,DE
D4ED 37             	SCF
D4EE C0             	RET	NZ
D4EF E5             	PUSH	HL
D4F0                S16K2:
D4F0 E1             	POP	HL
D4F1                S16K3:
D4F1 FD E5          	PUSH	IY
D4F3 D1             	POP	DE
D4F4                _SYS13:		;(BDOS)ファイルの削除
D4F4 CD 3B DD       	CALL	SETDRV
D4F7 CD CD DF       	CALL	KILL
D4FA                FEND13:
D4FA 18 BB          	JR	FEND
D4FC                
D4FC                _SYS14:		;(BDOS)シーケンシャルな読み出し
D4FC CD 3B DD       	CALL	SETDRV
D4FF CD C3 E1       	CALL	PUSHRR
D502 CD 04 E2       	CALL	GETSEQ
D505                
D505 CD 18 E2       	CALL	RB_READ
D508 E5             	PUSH	HL
D509 CD D7 E1       	CALL	SETSEQ
D50C                SREAD:
D50C E1             	POP	HL
D50D                
D50D C6 01          	ADD	A,001H
D50F 38 A6          	JR	C,FEND
D511                
D511 7D             	LD	A,L
D512 D6 01          	SUB	001H
D514                FENDX:
D514 9F             	SBC	A,A
D515 E6 03          	AND	3
D517 1F             	RRA
D518 18 9E          	JR	FENDE
D51A                
D51A                _SYS15:		;(BDOS)シーケンシャルな書き込み
D51A CD 3B DD       	CALL	SETDRV
D51D CD C3 E1       	CALL	PUSHRR
D520 CD 04 E2       	CALL	GETSEQ
D523                
D523 CD 11 E2       	CALL	RB_WRITE
D526 E5             	PUSH	HL
D527 CD D7 E1       	CALL	SETSEQ
D52A                SWRITE:
D52A E1             	POP	HL
D52B                
D52B C6 FF          	ADD	A,0FFH
D52D 18 E5          	JR	FENDX
D52F                
D52F                _SYS17:		;(BDOS)ファイル名の変更
D52F CD 3B DD       	CALL	SETDRV
D532 CD 29 E0       	CALL	NAME
D535 18 C3          	JR	FEND13
D537                
D537                _SYS16:		;(BDOS)ファイルの作成
D537 CD 3B DD       	CALL	SETDRV
D53A                
D53A CD A3 E0       	CALL	CHKWILDX
D53D 38 BB          	JR	C,FEND13
D53F FD 7E 01       	LD	A,(IY+1)	;(FCB)主ファイル名
D542 FE 05          	CP	5
D544 28 05          	JR	Z,_S16X2
D546 FE 21          	CP	021H
D548 DA FA D4       	JP	C,FEND13
D54B                _S16X2:
D54B                ;				Clear FCB
D54B FD E5          	PUSH	IY
D54D E1             	POP	HL
D54E 01 10 00       	LD	BC,16
D551 09             	ADD	HL,BC
D552                _S16X1:
D552 70             	LD	(HL),B		;B=0
D553 23             	INC	HL
D554 0D             	DEC	C
D555 20 FB          	JR	NZ,_S16X1
D557                
D557 CD 96 E1       	CALL	SETTMSX
D55A FD 36 0D FF    	LD	(IY+13),0FFH	;(FCB)Attribute
D55E CD 5B DD       	CALL	SOPENX
D561 3F             	CCF
D562 CC C8 D4       	CALL	Z,_S16K
D565 D4 40 DE       	CALL	NC,COPEN
D568 D4 B3 E0       	CALL	NC,SDIRENT
D56B C3 C2 D3       	JP	_S16XX
D56E                
D56E                _SYS21:		;(BDOS)ランダムな読み出し
D56E                
D56E CD 3B DD       	CALL	SETDRV
D571 CD C3 E1       	CALL	PUSHRR
D574 FD 6E 21       	LD	L,(IY+33)	;(FCB)Random record
D577 FD 66 22       	LD	H,(IY+34)
D57A                
D57A CD 18 E2       	CALL	RB_READ
D57D E5             	PUSH	HL
D57E CD EE E1       	CALL	POPRR
D581 18 89          	JR	SREAD
D583                
D583                _SYS22:		;(BDOS)ランダムな書き込み
D583                _SYS28:		;(BDOS)ランダムな書き込み・その2
D583 CD 3B DD       	CALL	SETDRV
D586 CD C3 E1       	CALL	PUSHRR
D589 FD 6E 21       	LD	L,(IY+33)	;(FCB)Random record
D58C FD 66 22       	LD	H,(IY+34)
D58F                
D58F CD 11 E2       	CALL	RB_WRITE
D592 E5             	PUSH	HL
D593 CD EE E1       	CALL	POPRR
D596 18 92          	JR	SWRITE
D598                
D598                _SYS18:		;(BDOS)ログインベクトルの獲得
D598 21 FF 00       	LD	HL,000FFH
D59B AF             	XOR	A
D59C C9             	RET
D59D                
D59D                _SYS19:		;(BDOS)カレントドライブ番号の獲得
D59D 3A 87 EC       	LD	A,(_DVSW)
D5A0 A7             	AND	A
D5A1 C9             	RET
D5A2                
D5A2                _SYS1A:		;(BDOS)DTAの設定
D5A2 ED 53 8A EC    	LD	(_DTA),DE
D5A6 AF             	XOR	A
D5A7 C9             	RET
D5A8                
D5A8                _SYS1B:		;(BDOS)ディスク情報の獲得
D5A8 7B             	LD	A,E
D5A9 CD 4E DD       	CALL	GETDRV
D5AC CD DC EC       	CALL	_GETDPB
D5AF D4 E2 EC       	CALL	NC,_RDFATX
D5B2 21 00 00       	LD	HL,0
D5B5 D4 6F E1       	CALL	NC,DSKF
D5B8                
D5B8 ED 5B 70 E1    	LD	DE,(MAXCLP+1)	;DPB_08_MAXCL-1
D5BC 1B             	DEC	DE		;DE←クラスタの総数
D5BD FD 2A 7C EC    	LD	IY,(_FATBF)	;IY←メモリ上のFATの先頭アドレス
D5C1 9F             	SBC	A,A
D5C2 D8             	RET	C
D5C3 4F             	LD	C,A		;C=0
D5C4 DD 7E 0F       	LD	A,(IX+00FH)	;DPB_0F_BPS
D5C7 E6 0F          	AND	00FH
D5C9 47             	LD	B,A
D5CA DD 7E 07       	LD	A,(IX+7)	;DPB_07_SECPCL
D5CD C9             	RET
D5CE                
D5CE                _SYS1D:		;(BDOS)書き込みが禁止されているディスクの調査
D5CE AF             	XOR	A
D5CF 67             	LD	H,A
D5D0 6F             	LD	L,A
D5D1 C9             	RET
D5D2                
D5D2                _SYS1F:		;(BDOS)ディスク装置のパラメータの読み出し
D5D2 21 00 ED       	LD	HL,DEVICE
D5D5 7B             	LD	A,E
D5D6 C3 DC EC       	JP	_GETDPB
D5D9                
D5D9                _SYS23:		;(BDOS)ファイルサイズの獲得
D5D9 E5             	PUSH	HL
D5DA 2A 1E EC       	LD	HL,(STABLE+2*00FH)	;ファイルのオープン
D5DD CD 0F 00       	CALL	JP_HL
D5E0 38 14          	JR	C,_S23X1
D5E2                
D5E2 D5             	PUSH	DE		;EX DE,IY
D5E3 FD E3          	EX	(SP),IY		;
D5E5                ;	POP	DE		;
D5E5                ;	PUSH	DE		;DEを破壊しないように注意vv
D5E5 CD F4 E1       	CALL	GETSIZE
D5E8                _S24X1:
D5E8 FD 75 21       	LD	(IY+33),L	;(FCB)Random record
D5EB FD 74 22       	LD	(IY+34),H
D5EE FD 36 23 00    	LD	(IY+35),0
D5F2                ;	POP	DE		;^^^^^^^^^^^^^^^^^^^^^^^^
D5F2                ;	PUSH	DE		;EX DE,IY
D5F2 FD E3          	EX	(SP),IY		;
D5F4 D1             	POP	DE		;
D5F5                
D5F5 AF             	XOR	A
D5F6                _S23X1:
D5F6 E1             	POP	HL
D5F7 C9             	RET
D5F8                
D5F8                _SYS24:		;(BDOS)ランダムレコードフィールドの設定
D5F8 E5             	PUSH	HL
D5F9 D5             	PUSH	DE		;EX DE,IY
D5FA FD E3          	EX	(SP),IY		;
D5FC                ;	POP	DE		;
D5FC                ;	PUSH	DE		;DEを破壊しないように注意vv
D5FC CD 04 E2       	CALL	GETSEQ
D5FF 18 E7          	JR	_S24X1		;^^^^^^^^^^^^^^^^^^^^^^^^
D601                
D601                _SYS29:		;(BDOS)ファイル名の解析
D601 C5             	PUSH	BC
D602 E5             	PUSH	HL
D603 CD 52 DC       	CALL	FILE
D606 E1             	POP	HL
D607 C1             	POP	BC
D608                S29X1:
D608 C5             	PUSH	BC
D609 D5             	PUSH	DE
D60A E5             	PUSH	HL
D60B EB             	EX	DE,HL
D60C 21 14 EB       	LD	HL,FDRV
D60F 01 0D 00       	LD	BC,13
D612 ED B0          	LDIR
D614 70             	LD	(HL),B		;B=0
D615 0E 03          	LD	C,3
D617 ED B0          	LDIR
D619 E1             	POP	HL
D61A D1             	POP	DE
D61B C1             	POP	BC
D61C AF             	XOR	A
D61D C9             	RET
D61E                
D61E                _SYS30:		;(BDOS)論理セクタを用いた書き込み
D61E C5             	PUSH	BC
D61F 01 E2 E7       	LD	BC,DWT16
D622 18 04          	JR	S2FX
D624                _SYS2F:
D624 C5             	PUSH	BC
D625 01 D2 E7       	LD	BC,DRD16
D628                S2FX:
D628 ED 43 3D D6    	LD	(S2FPAT+1),BC
D62C CD DF EC       	CALL	_FFLUSH
D62F                
D62F D5             	PUSH	DE
D630 E5             	PUSH	HL
D631 7D             	LD	A,L		;Drive
D632 CD D9 EC       	CALL	_CHGDRV
D635 38 0D          	JR	C,S30X2
D637 44             	LD	B,H		;Number of clusters
D638 2A 8A EC       	LD	HL,(_DTA)
D63B                S30X:
D63B C5             	PUSH	BC
D63C CD D2 E7       S2FPAT:	CALL	DRD16
D63F C1             	POP	BC
D640 38 02          	JR	C,S30X2
D642 10 F7          	DJNZ	S30X
D644                S30X2:
D644 E1             	POP	HL
D645 D1             	POP	DE
D646 C1             	POP	BC
D647 9F             	SBC	A,A
D648 C9             	RET
D649                	INCLUDE	"LDIO.ASM"
D649                
D649                ;	LSX-Dodgers IO
D649                
D649 00 00 D3 73    _SYS04	EQU	_ERROR		;(BDOS)外部出力
D649 00 00 D3 73    _SYS05	EQU	_ERROR		;(BDOS)プリンタ出力
D649 00 00 D3 73    _SYS1C	EQU	_ERROR		;(BDOS)ディスクの書き込み禁止化
D649 00 00 D3 73    _SYS1E	EQU	_ERROR		;(BDOS)ファイル属性の設定
D649 00 00 D3 73    _SYS20	EQU	_ERROR		;(BDOS)利用者番号の設定と読み出し
D649 00 00 D3 73    _SYS2E	EQU	_ERROR		;(BDOS)ベリファイ・フラグの設定
D649                
D649                BIOS:
D649 E5             	PUSH	HL
D64A 21 10 80       	LD	HL,08010H
D64D 39             	ADD	HL,SP
D64E E1             	POP	HL
D64F 30 0E          	JR	NC,BIOS2
D651                BIOS1:
D651 CD 59 D6       	CALL	BIOS3
D654 06 1E          	LD	B,01EH
D656 ED 79          	OUT	(C),A
D658 C9             	RET
D659                BIOS3:
D659 C5             	PUSH	BC
D65A 06 1D          	LD	B,01DH
D65C ED 79          	OUT	(C),A
D65E C9             	RET
D65F                BIOS2:
D65F ED 73 6A D6    	LD	(SPPAT+1),SP	;スタックがBIOS-ROMと被っている場合
D663 31 00 00       	LD	SP,EXTSP
D666 CD 51 D6       	CALL	BIOS1
D669 31 00 00       SPPAT:	LD	SP,0
D66C C9             	RET
D66D                
D66D                INT:
D66D F5             	PUSH	AF
D66E E5             	PUSH	HL
D66F 21 60 00       	LD	HL,010000H-STACK
D672 39             	ADD	HL,SP
D673 38 0F          	JR	C,INTP1X
D675 ED 73 80 D6    	LD	(INTSP+1),SP
D679 31 00 00       	LD	SP,EXTSP
D67C CD 8C D6       	CALL	INTP1
D67F 31 00 00       INTSP:	LD	SP,0
D682 18 03          	JR	INTPE
D684                INTP1X:
D684 CD 8C D6       	CALL	INTP1
D687                INTPE:
D687 E1             	POP	HL
D688                INTPE2:
D688 F1             	POP	AF
D689                INTCTCE:
D689 FB             	EI
D68A ED 4D          	RETI
D68C                INTP1:
D68C C5             	PUSH	BC
D68D                
D68D CD 5D DA       	CALL	IN49SB
D690 67             	LD	H,A
D691 CD 5D DA       	CALL	IN49SB
D694 6F             	LD	L,A
D695                
D695 FE 08          	CP	8		;DELキー
D697 20 05          	JR	NZ,SCEXE
D699 7C             	LD	A,H
D69A E6 11          	AND	011H		;CTRLキー + GRAPHキー
D69C 28 08          	JR	Z,RESET
D69E                SCEXE:
D69E 22 92 EC       	LD	(_KEYD),HL
D6A1 CD D2 D6       	CALL	KEYSET1
D6A4                
D6A4 C1             	POP	BC
D6A5 C9             	RET
D6A6                
D6A6                RESET:
D6A6 3E 1D          	LD	A,01DH
D6A8 D3 00          	OUT	(0),A
D6AA C7             	RST	0
D6AB                
D6AB                INTCTC2:
D6AB F5             	PUSH	AF
D6AC 3E 00          INTCPAT:LD	A,000H
D6AE 3D             	DEC	A
D6AF 32 AD D6       	LD	(INTCPAT+1),A
D6B2 20 D4          	JR	NZ,INTPE2
D6B4                
D6B4 3A 92 EC       	LD	A,(_KEYD)
D6B7 B7             	OR	A
D6B8 28 CE          	JR	Z,INTPE2
D6BA                KEYSET0:
D6BA E5             	PUSH	HL
D6BB 2A 90 EC       	LD	HL,(_KEYPS)
D6BE 7C             	LD	A,H
D6BF AD             	XOR	L
D6C0 20 06          	JR	NZ,INTC2A
D6C2                
D6C2 2A 92 EC       	LD	HL,(_KEYD)
D6C5 CD FC D6       	CALL	KEYSET
D6C8                INTC2A:
D6C8 3A 94 EC       	LD	A,(_KEYSP)
D6CB E6 0F          	AND	00FH
D6CD 32 AD D6       	LD	(INTCPAT+1),A
D6D0                
D6D0 18 B5          	JR	INTPE
D6D2                
D6D2                KEYSET1:
D6D2 CB 6C          	BIT	5,H
D6D4 F5             	PUSH	AF
D6D5 ED 4B 8C EC    	LD	BC,(_CTC)
D6D9 78             	LD	A,B
D6DA B1             	OR	C
D6DB 20 06          	JR	NZ,KEYS10E
D6DD                
D6DD F1             	POP	AF
D6DE 20 1C          	JR	NZ,KEYSET
D6E0 F5             	PUSH	AF
D6E1 18 D7          	JR	KEYSET0
D6E3                KEYS10E:
D6E3 F1             	POP	AF
D6E4 C8             	RET	Z
D6E5 F5             	PUSH	AF
D6E6 3E 03          	LD	A,3		;CTC STOP
D6E8 ED 79          	OUT	(C),A
D6EA F1             	POP	AF
D6EB                
D6EB B7             	OR	A
D6EC C8             	RET	Z
D6ED                
D6ED E5             	PUSH	HL
D6EE 2A 94 EC       	LD	HL,(_KEYSP)
D6F1 3E A7          	LD	A,0A7H
D6F3 ED 79          	OUT	(C),A
D6F5 ED 69          	OUT	(C),L
D6F7 7C             	LD	A,H
D6F8 32 AD D6       	LD	(INTCPAT+1),A
D6FB E1             	POP	HL
D6FC                
D6FC                KEYSET:
D6FC 7D             	LD	A,L
D6FD CB 7C          	BIT	7,H
D6FF CC 2C D7       	CALL	Z,FKEY
D702 CB 74          	BIT	6,H
D704 C0             	RET	NZ
D705                KEYBS:
D705 B7             	OR	A
D706 C8             	RET	Z
D707                KEYBS1:
D707 FE 03          	CP	3
D709 CC 1F D7       	CALL	Z,KEYBC
D70C E5             	PUSH	HL
D70D F5             	PUSH	AF
D70E 2A 90 EC       	LD	HL,(_KEYPS)
D711 2C             	INC	L
D712 7D             	LD	A,L
D713 BC             	CP	H
D714 28 12          	JR	Z,POP_AF_HL_SCF_RET
D716 32 90 EC       	LD	(_KEYPS),A
D719 26 FE          	LD	H,KEYBF/256
D71B F1             	POP	AF
D71C 77             	LD	(HL),A
D71D E1             	POP	HL
D71E C9             	RET
D71F                
D71F                KEYBC:
D71F E5             	PUSH	HL
D720 21 00 00       	LD	HL,0
D723 22 90 EC       	LD	(_KEYPS),HL
D726 E1             	POP	HL
D727 C9             	RET
D728                
D728                POP_AF_HL_SCF_RET:
D728 F1             	POP	AF
D729 E1             	POP	HL
D72A 37             	SCF
D72B C9             	RET
D72C                
D72C                FKEY:
D72C CB 75          	BIT	6,L
D72E C8             	RET	Z
D72F 3E 1B          	LD	A,01BH
D731 CD 07 D7       	CALL	KEYBS1
D734 7D             	LD	A,L
D735 C6 AF          	ADD	A,020H-'q'
D737 CB 7D          	BIT	7,L
D739 C8             	RET	Z
D73A 2E 50          	LD	L,'P'
D73C D6 90          	SUB	0E1H+020H-'q'
D73E 28 10          	JR	Z,KEYBSL
D740 2C             	INC	L
D741 3D             	DEC	A
D742 28 0C          	JR	Z,KEYBSL
D744 2C             	INC	L
D745 D6 09          	SUB	0EBH-0E2H
D747 28 07          	JR	Z,KEYBSL
D749 2E 43          	LD	L,'C'
D74B 3D             	DEC	A
D74C 28 02          	JR	Z,KEYBSL
D74E 2E 58          	LD	L,'X'
D750                KEYBSL:
D750 7D             	LD	A,L
D751 18 B4          	JR	KEYBS1
D753                
D753                _SYS01:		;(BDOS)コンソール入力
D753 CD 09 EB       	CALL	_SYS07
D756                MSG_A:
D756 F5             	PUSH	AF
D757 D5             	PUSH	DE
D758 5F             	LD	E,A
D759 CD 5F D7       	CALL	_SYS02
D75C D1             	POP	DE
D75D F1             	POP	AF
D75E C9             	RET
D75F                
D75F                _SYS02:		;(BDOS)コンソール出力
D75F CD 71 D7       	CALL	BREAK
D762 18 05          	JR	PRINTX
D764                
D764                _SYS06:		;(BDOS)コンソール直接入出力
D764 7B             	LD	A,E
D765 3C             	INC	A
D766 CA CA EC       	JP	Z,_INKEY
D769                PRINTX:
D769 C3 CD EC       	JP	_PRINT
D76C                
D76C                _SYS08:		;(BDOS)エコーなしコンソール入力
D76C CD 09 EB       	CALL	_SYS07
D76F 18 04          	JR	BREAK1
D771                BREAK:
D771 FB             	EI
D772 3A 92 EC       	LD	A,(_KEYD)
D775                BREAK1:
D775 FE 03          	CP	3
D777 CA 00 00       	JP	Z,0
D77A FE 13          	CP	013H
D77C C0             	RET	NZ
D77D                
D77D                PAUSE:
D77D CD 1F D7       	CALL	KEYBC
D780                
D780                FLGET:
D780 CD DF EC       	CALL	_FFLUSH
D783 C5             	PUSH	BC
D784 E5             	PUSH	HL
D785 ED 4B 8E EC    	LD	BC,(_TXADR)
D789 CB E8          	SET	5,B
D78B ED 60          	IN	H,(C)
D78D                FLGET1:
D78D 3A 93 EC       	LD	A,(_KEYD+1)
D790 0F             	RRCA
D791 0F             	RRCA
D792 E6 10          	AND	010H
D794 F6 08          	OR	8
D796 ED 68          	IN	L,(C)
D798 B5             	OR	L
D799 ED 79          	OUT	(C),A
D79B CD CA EC       	CALL	_INKEY
D79E 28 ED          	JR	Z,FLGET1
D7A0 ED 61          	OUT	(C),H
D7A2 E1             	POP	HL
D7A3 C1             	POP	BC
D7A4 C9             	RET
D7A5                
D7A5                _SYS0A:		;(BDOS)文字列入力
D7A5 C5             	PUSH	BC
D7A6 E5             	PUSH	HL
D7A7 D5             	PUSH	DE
D7A8 CD BA DB       	CALL	GETL
D7AB 11 00 FF       	LD	DE,KBUF
D7AE E1             	POP	HL
D7AF E5             	PUSH	HL
D7B0 0E 00          	LD	C,0
D7B2 30 04          	JR	NC,SAX0
D7B4 23             	INC	HL
D7B5 23             	INC	HL
D7B6 18 08          	JR	SAX4
D7B8                SAX0:
D7B8 46             	LD	B,(HL)
D7B9 23             	INC	HL
D7BA                SAX1:
D7BA 23             	INC	HL
D7BB 1A             	LD	A,(DE)
D7BC 13             	INC	DE
D7BD B7             	OR	A
D7BE 20 04          	JR	NZ,SAX2
D7C0                SAX4:
D7C0 36 0D          	LD	(HL),00DH
D7C2 18 04          	JR	SAX3
D7C4                SAX2:
D7C4 77             	LD	(HL),A
D7C5 0C             	INC	C
D7C6 10 F2          	DJNZ	SAX1
D7C8                SAX3:
D7C8 D1             	POP	DE
D7C9 79             	LD	A,C
D7CA 13             	INC	DE
D7CB 12             	LD	(DE),A
D7CC 1B             	DEC	DE
D7CD E1             	POP	HL
D7CE C1             	POP	BC
D7CF A7             	AND	A
D7D0 C9             	RET
D7D1                
D7D1                _SYS0B:		;(BDOS)コンソール状態のチェック
D7D1 CD 71 D7       	CALL	BREAK
D7D4 3A 92 EC       	LD	A,(_KEYD)
D7D7 B7             	OR	A
D7D8 C8             	RET	Z
D7D9                CONSTX:
D7D9 CD DF EC       	CALL	_FFLUSH
D7DC E5             	PUSH	HL
D7DD 2A 90 EC       	LD	HL,(_KEYPS)
D7E0 7C             	LD	A,H
D7E1 AD             	XOR	L
D7E2 E1             	POP	HL
D7E3 C6 FF          	ADD	A,0FFH
D7E5 9F             	SBC	A,A
D7E6 C9             	RET
D7E7                
D7E7                _SYS2A:		;(BDOS)日付の獲得
D7E7 C5             	PUSH	BC
D7E8 3E ED          	LD	A,0EDH		;Read calendar
D7EA CD 78 DA       	CALL	COMOUT
D7ED CD 0A D8       	CALL	IN49SB_BCD	;YY
D7F0 6F             	LD	L,A
D7F1 26 00          	LD	H,0
D7F3                ;	LD	DE,1900		;0076CH
D7F3                ;	CP	90		;90以上は1900年代 1990-1999
D7F3                ;	JR	NC,RDDATE1	;90未満は2000年代 2000-2089
D7F3                ;	LD	E,0D0H		;2000 & 0FFH D=007H
D7F3 11 D0 07       	LD	DE,2000		;すべて2000年代で処理 2000-2099
D7F6                RDDATE1:
D7F6 19             	ADD	HL,DE
D7F7 CD 5D DA       	CALL	IN49SB		;MM
D7FA 57             	LD	D,A
D7FB CD 0A D8       	CALL	IN49SB_BCD	;DD
D7FE 5F             	LD	E,A
D7FF 7A             	LD	A,D
D800 E6 07          	AND	7
D802 06 04          	LD	B,4
D804                RDDATE2:
D804 CB 3A          	SRL	D
D806 10 FC          	DJNZ	RDDATE2
D808 C1             	POP	BC
D809 C9             	RET
D80A                IN49SB_BCD:
D80A CD 5D DA       	CALL	IN49SB
D80D                ;------------------------
D80D                ;BCDの10進数化
D80D                ;in
D80D                ;	A  : BCD
D80D                ;out
D80D                ;	A  : 10進数
D80D                ;------------------------
D80D 4F             	LD	C,A
D80E E6 F0          	AND	0F0H	;10の位
D810 0F             	RRCA
D811 47             	LD	B,A
D812 0F             	RRCA
D813 0F             	RRCA
D814 80             	ADD	A,B
D815 47             	LD	B,A
D816 79             	LD	A,C
D817 E6 0F          	AND	00FH	;1の位
D819 80             	ADD	A,B
D81A C9             	RET
D81B                
D81B                _SYS2C:		;(BDOS)時刻の獲得
D81B C5             	PUSH	BC
D81C 3E EF          	LD	A,0EFH		;Read time
D81E CD 78 DA       	CALL	COMOUT
D821 CD 0A D8       	CALL	IN49SB_BCD	;TT
D824 67             	LD	H,A
D825 CD 0A D8       	CALL	IN49SB_BCD	;MM
D828 6F             	LD	L,A
D829 CD 0A D8       	CALL	IN49SB_BCD	;SS
D82C 57             	LD	D,A
D82D C1             	POP	BC
D82E AF             	XOR	A
D82F C9             	RET
D830                
D830                ESC1:
D830 7B             	LD	A,E
D831 FE 41          	CP	'A'
D833 CA 74 D9       	JP	Z,CTRL1E
D836 FE 42          	CP	'B'
D838 CA E3 DA       	JP	Z,CTRL1F
D83B FE 43          	CP	'C'
D83D CA 81 D9       	JP	Z,CTRL1C
D840 FE 44          	CP	'D'
D842 CA 6A D9       	JP	Z,CTRL1D
D845 FE 45          	CP	'E'
D847 28 02          	JR	Z,CT0CX
D849 FE 6A          	CP	'j'
D84B                CT0CX:
D84B CA B6 DA       	JP	Z,CTRL0C
D84E FE 48          	CP	'H'
D850 CA FE D9       	JP	Z,CTRL0B
D853 FE 4A          	CP	'J'
D855 CA B9 DA       	JP	Z,CTRL06
D858 FE 4B          	CP	'K'
D85A CA C1 D9       	JP	Z,CTRL05
D85D FE 4C          	CP	'L'
D85F CA F8 DA       	JP	Z,CTRL0E
D862 FE 54          	CP	'T'
D864 CA C1 D9       	JP	Z,CTRL05
D867 FE 78          	CP	'x'
D869 28 04          	JR	Z,ESC1X
D86B FE 79          	CP	'y'
D86D 20 02          	JR	NZ,ESC1Y
D86F                ESC1X:
D86F 36 01          	LD	(HL),1
D871                ESC1Y:
D871 FE 3D          	CP	'='
D873 28 04          	JR	Z,ESC1W
D875 FE 59          	CP	'Y'
D877 20 02          	JR	NZ,ESC1Z
D879                ESC1W:
D879 36 02          	LD	(HL),2
D87B                ESC1Z:
D87B FE 20          	CP	020H
D87D 38 02          	JR	C,ESC1C
D87F 87             	ADD	A,A
D880 D0             	RET	NC
D881                ESC1C:
D881 E1             	POP	HL
D882 18 4A          	JR	ANK
D884                
D884                ESC:
D884 21 DF D8       	LD	HL,PRINTE5
D887 E5             	PUSH	HL
D888 21 AA D8       	LD	HL,ESCFLG+1
D88B 36 00          	LD	(HL),0
D88D 3D             	DEC	A
D88E 28 A0          	JR	Z,ESC1
D890 3D             	DEC	A
D891 20 09          	JR	NZ,ESC2
D893 36 03          	LD	(HL),3
D895 7B             	LD	A,E
D896 D6 20          	SUB	020H
D898 32 9F D8       	LD	(ESCYP+1),A
D89B C9             	RET
D89C                ESC2:
D89C 3D             	DEC	A
D89D C0             	RET	NZ
D89E 26 00          ESCYP:	LD	H,0
D8A0 7B             	LD	A,E
D8A1 D6 20          	SUB	020H
D8A3 6F             	LD	L,A
D8A4 C3 D6 EC       	JP	_LOC
D8A7                
D8A7                PRINT:
D8A7 C5             	PUSH	BC
D8A8 E5             	PUSH	HL
D8A9 3E 00          ESCFLG:	LD	A,000H
D8AB B7             	OR	A
D8AC 20 D6          	JR	NZ,ESC
D8AE                
D8AE 3E 1F          	LD	A,01FH
D8B0 BB             	CP	E
D8B1 30 30          	JR	NC,CTRL
D8B3                PRINTC:
D8B3 A7             INSFLG:	AND	A
D8B4 DC 81 DA       	CALL	C,CTRL12
D8B7                
D8B7 3E 00          KANFLG:	LD	A,000H
D8B9 B7             	OR	A
D8BA 20 3F          	JR	NZ,KANJI2
D8BC 7B             X1KPAT:	LD	A,E
D8BD FE 80          	CP	080H
D8BF 38 0D          	JR	C,ANK
D8C1 FE A0          	CP	0A0H
D8C3 38 04          	JR	C,KANJI1
D8C5 FE E0          	CP	0E0H
D8C7 38 05          	JR	C,ANK
D8C9                KANJI1:
D8C9 32 B8 D8       	LD	(KANFLG+1),A
D8CC 18 11          	JR	PRINTE5
D8CE                ANK:
D8CE ED 4B 8E EC    	LD	BC,(_TXADR)
D8D2 78             	LD	A,B
D8D3 F6 38          	OR	038H
D8D5 47             	LD	B,A
D8D6 ED 71          	DB	0EDH,071H	;OUT (C),0	Z80未定義命令	kanji
D8D8 CB 98          	RES	3,B
D8DA ED 59          	OUT	(C),E		;Text
D8DC                KANJIE:
D8DC CD 46 D9       	CALL	PRINTE7
D8DF                PRINTE5:
D8DF E1             	POP	HL
D8E0 C1             	POP	BC
D8E1 AF             	XOR	A
D8E2 C9             	RET
D8E3                
D8E3                CTRL:
D8E3 CD 2D D9       	CALL	KANCLR
D8E6 3E A7          	LD	A,0A7H		;AND	A
D8E8 32 B3 D8       	LD	(INSFLG),A
D8EB 7B             	LD	A,E
D8EC 87             	ADD	A,A
D8ED F6 80          	OR	080H
D8EF 6F             	LD	L,A
D8F0 26 EB          	LD	H,CTRLTB/256
D8F2 7E             	LD	A,(HL)
D8F3 2C             	INC	L
D8F4 66             	LD	H,(HL)
D8F5 6F             	LD	L,A
D8F6 CD 0F 00       	CALL	JP_HL
D8F9 18 E4          	JR	PRINTE5
D8FB                
D8FB                KANJI2:
D8FB D5             	PUSH	DE
D8FC 57             	LD	D,A
D8FD 01 81 2F       	LD	BC,02F81H	;SFTJIS
D900 DF             	RST	018H
D901 01 C3 2F       	LD	BC,02FC3H	;Instead or JISVRM
D904 DF             	RST	018H
D905                
D905 ED 4B 8E EC    	LD	BC,(_TXADR)
D909 78             	LD	A,B
D90A F6 38          	OR	038H
D90C 47             	LD	B,A
D90D ED 51          	OUT	(C),D		;kanji
D90F CB 98          	RES	3,B
D911 ED 59          	OUT	(C),E		;Text
D913 CD 46 D9       	CALL	PRINTE7
D916 ED 4B 8E EC    	LD	BC,(_TXADR)
D91A 78             	LD	A,B
D91B F6 38          	OR	038H
D91D 47             	LD	B,A
D91E CB F2          	SET	6,D
D920 ED 51          	OUT	(C),D		;Kanji
D922 CB 98          	RES	3,B
D924 ED 59          	OUT	(C),E		;Text
D926 D1             	POP	DE
D927 AF             	XOR	A
D928 32 B8 D8       	LD	(KANFLG+1),A
D92B 18 AF          	JR	KANJIE
D92D                
D92D                KANCLR:
D92D 3A B8 D8       	LD	A,(KANFLG+1)
D930 B7             	OR	A
D931 C8             	RET	Z
D932 ED 4B 8E EC    	LD	BC,(_TXADR)
D936 78             	LD	A,B
D937 F6 38          	OR	038H
D939 47             	LD	B,A
D93A AF             	XOR	A
D93B 32 B8 D8       	LD	(KANFLG+1),A
D93E ED 79          	OUT	(C),A		;Kanji
D940 CB 98          	RES	3,B
D942 3E 20          	LD	A,020H
D944 ED 79          	OUT	(C),A		;Text
D946                PRINTE7:
D946 CB A0          	RES	4,B
D948                PRINTE6:
D948 3A 96 EC       	LD	A,(_COLORF)
D94B                PRINTE4:
D94B ED 79          	OUT	(C),A		;Color
D94D 78             	LD	A,B
D94E E6 07          	AND	7
D950 47             	LD	B,A
D951                PRINTE2:
D951 03             	INC	BC
D952                PRINTE3:
D952 2A BA EC       	LD	HL,(CRTCD+10)
D955 A7             	AND	A
D956 ED 4A          	ADC	HL,BC
D958                PRINTE8:
D958 28 05          	JR	Z,PRINT2
D95A                PRINTE1:
D95A ED 43 8E EC    	LD	(_TXADR),BC
D95E                PRINTE:
D95E C9             	RET
D95F                
D95F                PRINT2:
D95F CD FE DA       	CALL	SCR
D962 2A BC EC       	LD	HL,(CRTCD+12)
D965 09             	ADD	HL,BC
D966 22 8E EC       	LD	(_TXADR),HL
D969 C9             	RET
D96A                
D96A                CTRL08:
D96A                CTRL1D:
D96A ED 4B 8E EC    	LD	BC,(_TXADR)
D96E 78             	LD	A,B
D96F B1             	OR	C
D970 C8             	RET	Z
D971 0B             	DEC	BC
D972 18 E6          	JR	PRINTE1
D974                
D974                CTRL1E:
D974 ED 4B 8E EC    	LD	BC,(_TXADR)
D978 2A BC EC       	LD	HL,(CRTCD+12)
D97B 09             	ADD	HL,BC
D97C D0             	RET	NC
D97D 44             	LD	B,H
D97E 4D             	LD	C,L
D97F 18 D9          	JR	PRINTE1
D981                
D981                CTRL1C:
D981 ED 4B 8E EC    	LD	BC,(_TXADR)
D985 18 CA          	JR	PRINTE2
D987                
D987                CTRL09:
D987 ED 4B 8E EC    	LD	BC,(_TXADR)
D98B 79             	LD	A,C
D98C E6 F8          	AND	0F8H
D98E C6 08          	ADD	A,8
D990 4F             	LD	C,A
D991 88             	ADC	A,B
D992 91             	SUB	C
D993 47             	LD	B,A
D994 18 BC          	JR	PRINTE3
D996                
D996                CTRL02:
D996 2A 8E EC       	LD	HL,(_TXADR)
D999 7C             	LD	A,H
D99A B5             	OR	L
D99B C8             	RET	Z
D99C 2B             	DEC	HL
D99D 22 8E EC       	LD	(_TXADR),HL
D9A0 D5             	PUSH	DE
D9A1 CD D3 EC       	CALL	_POS
D9A4 3A B1 EC       	LD	A,(CRTCD+1)
D9A7 95             	SUB	L
D9A8 6F             	LD	L,A
D9A9 2D             	DEC	L
D9AA 26 38          	LD	H,038H
D9AC ED 4B 8E EC    	LD	BC,(_TXADR)
D9B0 09             	ADD	HL,BC
D9B1 44             	LD	B,H
D9B2 4D             	LD	C,L
D9B3 11 00 20       	LD	DE,02000H	;D:Text E:kanji
D9B6 2A 96 EC       	LD	HL,(_COLORF)	;L:Color
D9B9                C8X1:
D9B9 CD 9D DA       	CALL	C12S
D9BC 0B             	DEC	BC
D9BD 20 FA          	JR	NZ,C8X1
D9BF D1             	POP	DE
D9C0 C9             	RET
D9C1                
D9C1                CTRL05:
D9C1 CD D3 EC       	CALL	_POS
D9C4 3A B1 EC       	LD	A,(CRTCD+1)
D9C7 95             	SUB	L
D9C8 6F             	LD	L,A
D9C9 26 20          	LD	H,020H
D9CB ED 4B 8E EC    	LD	BC,(_TXADR)
D9CF                C05X1:
D9CF 78             	LD	A,B
D9D0 F6 38          	OR	038H
D9D2 47             	LD	B,A
D9D3 ED 71          	DB	0EDH,071H	;OUT (C),0	Z80未定義命令	kanji
D9D5 CB 98          	RES	3,B
D9D7 ED 61          	OUT	(C),H		;Text
D9D9 CB A0          	RES	4,B
D9DB 3A 96 EC       	LD	A,(_COLORF)
D9DE ED 79          	OUT	(C),A		;Color
D9E0 03             	INC	BC
D9E1 2D             	DEC	L
D9E2 20 EB          	JR	NZ,C05X1
D9E4 C9             	RET
D9E5                
D9E5                CTRL0D:
D9E5 CD D3 EC       	CALL	_POS
D9E8 2E 00          	LD	L,0
D9EA                LOC:
D9EA C5             	PUSH	BC
D9EB E5             	PUSH	HL
D9EC CD 2D D9       	CALL	KANCLR
D9EF CD 0B DA       	CALL	LOC1
D9F2 22 8E EC       	LD	(_TXADR),HL
D9F5 E1             	POP	HL
D9F6 C1             	POP	BC
D9F7 C9             	RET
D9F8                
D9F8                CTRL01:
D9F8 3E 37          	LD	A,037H		;SCF
D9FA 32 B3 D8       	LD	(INSFLG),A
D9FD C9             	RET
D9FE                
D9FE                CTRL0B:
D9FE 21 00 00       	LD	HL,0
DA01 22 8E EC       	LD	(_TXADR),HL
DA04 C9             	RET
DA05                
DA05                CTRL1B:
DA05 3E 01          	LD	A,1
DA07 32 AA D8       	LD	(ESCFLG+1),A
DA0A C9             	RET
DA0B                
DA0B                LOC1:
DA0B D5             	PUSH	DE
DA0C 4D             	LD	C,L
DA0D 06 08          	LD	B,8
DA0F 5C             	LD	E,H
DA10 16 00          	LD	D,0
DA12 2A B0 EC       	LD	HL,(CRTCD)
DA15 6A             	LD	L,D
DA16                LOC2:
DA16 29             	ADD	HL,HL
DA17 30 01          	JR	NC,LOC3
DA19 19             	ADD	HL,DE
DA1A                LOC3:
DA1A 10 FA          	DJNZ	LOC2
DA1C 09             	ADD	HL,BC
DA1D D1             	POP	DE
DA1E C9             	RET
DA1F                
DA1F                CONOUT1:
DA1F CD 31 DA       	CALL	CURSOR
DA22 59             	LD	E,C
DA23 CD CD EC       	CALL	_PRINT
DA26 7B             	LD	A,E
DA27 FE 0A          	CP	00AH
DA29 20 06          	JR	NZ,CURSOR
DA2B CD E5 D9       	CALL	CTRL0D
DA2E CD C1 D9       	CALL	CTRL05
DA31                CURSOR:
DA31 C5             	PUSH	BC
DA32 ED 4B 8E EC    	LD	BC,(_TXADR)
DA36 CB E8          	SET	5,B
DA38 ED 78          	IN	A,(C)
DA3A EE 18          	XOR	018H
DA3C ED 79          	OUT	(C),A
DA3E C1             	POP	BC
DA3F C9             	RET
DA40                
DA40                CTRL07:
DA40 21 61 EB       	LD	HL,BEEPD
DA43                BEEP1:
DA43 7E             	LD	A,(HL)
DA44 23             	INC	HL
DA45 FE FF          	CP	0FFH
DA47 C8             	RET	Z
DA48 F3             	DI
DA49 06 1C          	LD	B,01CH
DA4B ED 79          	OUT	(C),A
DA4D ED A3          	OUTI
DA4F FB             	EI
DA50 18 F1          	JR	BEEP1
DA52                
DA52                OT49SB:
DA52 C5             	PUSH	BC
DA53 CD 6E DA       	CALL	CANW
DA56 01 00 19       	LD	BC,01900H
DA59 ED 79          	OUT	(C),A
DA5B C1             	POP	BC
DA5C C9             	RET
DA5D                
DA5D                IN49SB:
DA5D C5             	PUSH	BC
DA5E 01 01 1A       	LD	BC,01A01H
DA61                CANR:
DA61 ED 78          	IN	A,(C)
DA63 E6 20          	AND	020H
DA65 20 FA          	JR	NZ,CANR
DA67 01 00 19       	LD	BC,01900H
DA6A ED 78          	IN	A,(C)
DA6C C1             	POP	BC
DA6D C9             	RET
DA6E                
DA6E                CANW:
DA6E 01 01 1A       	LD	BC,01A01H
DA71 ED 48          	IN	C,(C)
DA73 CB 71          	BIT	6,C
DA75 20 F7          	JR	NZ,CANW
DA77 C9             	RET
DA78                
DA78                COMOUT:
DA78 FB             	EI
DA79 CD 52 DA       	CALL	OT49SB
DA7C CD 6E DA       	CALL	CANW
DA7F F3             	DI
DA80 C9             	RET
DA81                
DA81                CTRL12:
DA81 D5             	PUSH	DE
DA82 CD D3 EC       	CALL	_POS
DA85 3A B1 EC       	LD	A,(CRTCD+1)
DA88 95             	SUB	L
DA89 ED 4B 8E EC    	LD	BC,(_TXADR)
DA8D 11 00 20       	LD	DE,02000H	;D:Text E:Kanji
DA90 2A 96 EC       	LD	HL,(_COLORF)	;L:Color
DA93 CB E8          	SET	5,B
DA95                C12X1:
DA95 CD 9D DA       	CALL	C12S
DA98 03             	INC	BC
DA99 20 FA          	JR	NZ,C12X1
DA9B D1             	POP	DE
DA9C C9             	RET
DA9D                
DA9D                C12S:
DA9D CB E0          	SET	4,B
DA9F CB D8          	SET	3,B
DAA1 ED 60          	IN	H,(C)
DAA3 ED 59          X1PAT:	OUT	(C),E
DAA5 5C             	LD	E,H
DAA6 CB 98          	RES	3,B
DAA8 ED 60          	IN	H,(C)
DAAA ED 51          	OUT	(C),D
DAAC 54             	LD	D,H
DAAD CB A0          	RES	4,B
DAAF ED 60          	IN	H,(C)
DAB1 ED 69          	OUT	(C),L
DAB3 6C             	LD	L,H
DAB4 3D             	DEC	A
DAB5 C9             	RET
DAB6                
DAB6                CTRL0C:
DAB6 CD FE D9       	CALL	CTRL0B
DAB9                CTRL06:
DAB9 ED 4B 8E EC    	LD	BC,(_TXADR)
DABD                C1AX1:
DABD 78             	LD	A,B
DABE F6 38          	OR	038H
DAC0 47             	LD	B,A
DAC1 ED 71          	DB	0EDH,071H	;OUT (C),0	Z80未定義命令	kanji
DAC3 CB 98          	RES	3,B
DAC5 3E 20          	LD	A,020H
DAC7 ED 79          	OUT	(C),A		;Text
DAC9 CB A0          	RES	4,B
DACB 3A 96 EC       	LD	A,(_COLORF)
DACE ED 79          	OUT	(C),A		;Color
DAD0 03             	INC	BC
DAD1 CB A8          	RES	5,B
DAD3 2A BA EC       	LD	HL,(CRTCD+10)
DAD6 09             	ADD	HL,BC
DAD7 30 E4          	JR	NC,C1AX1
DAD9 C9             	RET
DADA                
DADA                CTRL04:
DADA CD D3 EC       	CALL	_POS
DADD 7D             	LD	A,L
DADE B7             	OR	A
DADF C8             	RET	Z
DAE0                CTRL03:
DAE0 CD E5 D9       	CALL	CTRL0D
DAE3                CTRL0A:
DAE3                CTRL1F:
DAE3 ED 4B 8E EC    	LD	BC,(_TXADR)
DAE7 2A B1 EC       	LD	HL,(CRTCD+1)
DAEA 26 00          	LD	H,0
DAEC 09             	ADD	HL,BC
DAED 44             	LD	B,H
DAEE 4D             	LD	C,L
DAEF 2A BA EC       	LD	HL,(CRTCD+10)
DAF2 09             	ADD	HL,BC
DAF3 3F             	CCF
DAF4 9F             	SBC	A,A
DAF5 C3 58 D9       	JP	PRINTE8
DAF8                
DAF8                CTRL0E:
DAF8 CD D3 EC       	CALL	_POS
DAFB 7C             	LD	A,H
DAFC 18 04          	JR	SCR1
DAFE                SCR:
DAFE 3A 97 EC       	LD	A,(_LINE)
DB01 3D             	DEC	A
DB02                SCR1:
DB02 C5             	PUSH	BC
DB03 D5             	PUSH	DE
DB04 F5             	PUSH	AF
DB05 3E 07          	LD	A,7
DB07 21 38 DB       	LD	HL,SCRDMAD
DB0A CD 2E DB       	CALL	SETDMA
DB0D F1             	POP	AF
DB0E 21 00 38       	LD	HL,03800H
DB11                
DB11                SCRUP1:
DB11 B7             	OR	A
DB12 28 4D          	JR	Z,SCRCL
DB14 F5             	PUSH	AF
DB15 CD 3F DB       	CALL	UPSUB		;kanji
DB18 3A BC EC       	LD	A,(CRTCD+12)
DB1B 5F             	LD	E,A
DB1C 16 F7          	LD	D,0F7H
DB1E 19             	ADD	HL,DE
DB1F D5             	PUSH	DE
DB20 CD 3F DB       	CALL	UPSUB		;Text
DB23 D1             	POP	DE
DB24 19             	ADD	HL,DE
DB25 CD 3F DB       	CALL	UPSUB		;Color
DB28 CB E4          	SET	4,H
DB2A F1             	POP	AF
DB2B 3D             	DEC	A
DB2C 18 E3          	JR	SCRUP1
DB2E                
DB2E                SETDMA:
DB2E 01 87 1F       	LD	BC,01F87H
DB31                SDMA:
DB31 04             	INC	B
DB32 ED A3          	OUTI
DB34 3D             	DEC	A
DB35 20 FA          	JR	NZ,SDMA
DB37 C9             	RET
DB38                
DB38                SCRDMAD:
DB38 C3             	DB	0C3H		;WR6 リセット
DB39 9A             	DB	09AH		;WR5 ストップ WAIT READY:HIGH
DB3A 65             	DB	065H		;WR0 ブロック長(LH)
DB3B 4F 00          	DW	79
DB3D 1C             	DB	01CH		;WR1 ポートAインクリメント I/O
DB3E 18             	DB	018H		;WR0 ポートAアドレス(LH)
DB3F                
DB3F                UPSUB:
DB3F 3A B1 EC       	LD	A,(CRTCD+1)
DB42 5F             	LD	E,A
DB43 16 00          	LD	D,0
DB45 3E CD          	LD	A,0CDH		;WR4 バースト ポートB開始アドレス(LH)
DB47 ED 79          	OUT	(C),A
DB49 ED 69          	OUT	(C),L		;SOURCE
DB4B ED 61          	OUT	(C),H
DB4D 19             	ADD	HL,DE
DB4E 3E 1D          	LD	A,01DH		;WR0 ポートA開始アドレス(LH) ポートA→ポートB 転送
DB50 ED 79          	OUT	(C),A
DB52 ED 69          	OUT	(C),L		;DEST
DB54 ED 61          	OUT	(C),H
DB56                GO_DMA:
DB56 3E CF          	LD	A,0CFH
DB58 ED 79          	OUT	(C),A		;WR6 ロード
DB5A 3E B3          	LD	A,0B3H
DB5C ED 79          	OUT	(C),A		;WR6 強制RDY
DB5E ED 49          	OUT	(C),C		;WR6 イネーブル
DB60 C9             	RET
DB61                
DB61                SCRCL:
DB61 44             	LD	B,H
DB62 4D             	LD	C,L
DB63 21 50 20       	LD	HL,02000H+80
DB66 3A 96 EC       	LD	A,(_COLORF)
DB69                SCRCL1:
DB69 ED 71          	DB	0EDH,071H	;OUT (C),0	Z80未定義命令
DB6B CB 98          	RES	3,B
DB6D ED 61          	OUT	(C),H
DB6F CB A0          	RES	4,B
DB71 ED 79          	OUT	(C),A
DB73 CB D8          	SET	3,B
DB75 CB E0          	SET	4,B
DB77 03             	INC	BC
DB78 2D             	DEC	L
DB79 20 EE          	JR	NZ,SCRCL1
DB7B D1             	POP	DE
DB7C C1             	POP	BC
DB7D C9             	RET
DB7E                
DB7E                SCRN:
DB7E D5             	PUSH	DE
DB7F ED 58          	IN	E,(C)		;Text
DB81 CB D8          	SET	3,B
DB83 ED 50          	IN	D,(C)		;Kanji
DB85 28 19          	JR	Z,SCRNE
DB87 AF             	XOR	A
DB88 C5             	PUSH	BC
DB89 01 37 30       	LD	BC,03037H	;VRMJIS
DB8C DF             	RST	018H
DB8D 01 52 2F       	LD	BC,02F52H	;JISSFT
DB90 DF             	RST	018H
DB91 C1             	POP	BC
DB92 ED 78          	IN	A,(C)
DB94 CB 98          	RES	3,B
DB96 E6 40          	AND	040H
DB98 20 03          	JR	NZ,SCRN1
DB9A 7A             	LD	A,D
DB9B D1             	POP	DE
DB9C C9             	RET
DB9D                SCRN1:
DB9D 7B             	LD	A,E
DB9E D1             	POP	DE
DB9F C9             	RET
DBA0                
DBA0                SCRNE:
DBA0 D1             	POP	DE
DBA1 CB 98          	RES	3,B
DBA3                SCRNX:
DBA3 ED 78          	IN	A,(C)
DBA5 C9             	RET
DBA6                
DBA6                POS:
DBA6 2A 8E EC       	LD	HL,(_TXADR)
DBA9 C5             	PUSH	BC
DBAA ED 4B BC EC    	LD	BC,(CRTCD+12)
DBAE AF             	XOR	A
DBAF                POS1:
DBAF 09             	ADD	HL,BC
DBB0 3C             	INC	A
DBB1 38 FC          	JR	C,POS1
DBB3 ED 42          	SBC	HL,BC
DBB5 3D             	DEC	A
DBB6 67             	LD	H,A
DBB7 C1             	POP	BC
DBB8 A7             	AND	A
DBB9 C9             	RET
DBBA                
DBBA                GETL:
DBBA CD D3 EC       	CALL	_POS
DBBD E5             	PUSH	HL
DBBE                GETL1:
DBBE CD D3 EC       	CALL	_POS
DBC1 C1             	POP	BC
DBC2 C5             	PUSH	BC
DBC3 7D             	LD	A,L
DBC4 91             	SUB	C
DBC5 69             	LD	L,C
DBC6 4F             	LD	C,A
DBC7 DC D6 EC       	CALL	C,_LOC
DBCA                GET1W:
DBCA CD 6C D7       	CALL	_SYS08
DBCD FE 08          	CP	8
DBCF 20 07          	JR	NZ,GETL1X
DBD1 0D             	DEC	C
DBD2 CB 79          	BIT	7,C
DBD4 20 02          	JR	NZ,GETL1X
DBD6 3E 02          	LD	A,2
DBD8                GETL1X:
DBD8 FE 1B          	CP	01BH
DBDA 20 16          	JR	NZ,GETL1V
DBDC CD 6C D7       	CALL	_SYS08
DBDF FE 22          	CP	022H
DBE1 20 08          	JR	NZ,GETL1Y
DBE3 21 00 FF       	LD	HL,KBUF
DBE6 CD 84 D3       	CALL	MSX
DBE9 18 0E          	JR	GETL1Z
DBEB                GETL1Y:
DBEB F5             	PUSH	AF
DBEC 1E 1B          	LD	E,01BH
DBEE CD CD EC       	CALL	_PRINT
DBF1 F1             	POP	AF
DBF2                GETL1V:
DBF2 5F             	LD	E,A
DBF3 CD F8 D9       	CALL	CTRL01
DBF6 CD CD EC       	CALL	_PRINT
DBF9                GETL1Z:
DBF9 7B             	LD	A,E
DBFA FE 0D          	CP	00DH
DBFC 20 C0          	JR	NZ,GETL1
DBFE                
DBFE 11 00 FF       	LD	DE,KBUF
DC01 3A B1 EC       	LD	A,(CRTCD+1)
DC04 47             	LD	B,A
DC05 CD 2E D0       	CALL	ZERO_MEMORY_DE
DC08                
DC08 D1             	POP	DE
DC09 CD D3 EC       	CALL	_POS
DC0C 6B             	LD	L,E
DC0D 3A B1 EC       	LD	A,(CRTCD+1)
DC10 95             	SUB	L
DC11 57             	LD	D,A
DC12 CD 0B DA       	CALL	LOC1
DC15 4D             	LD	C,L
DC16 7C             	LD	A,H
DC17 F6 30          	OR	030H
DC19 47             	LD	B,A
DC1A 5A             	LD	E,D
DC1B 21 00 FF       	LD	HL,KBUF
DC1E                GETL2:
DC1E CD D0 EC       	CALL	_SCRN
DC21 03             	INC	BC
DC22 77             	LD	(HL),A
DC23 23             	INC	HL
DC24 1D             	DEC	E
DC25 20 F7          	JR	NZ,GETL2
DC27                GETL3:
DC27 2B             	DEC	HL
DC28 7E             	LD	A,(HL)
DC29 FE 21          	CP	021H
DC2B D0             	RET	NC
DC2C 36 00          	LD	(HL),0
DC2E 15             	DEC	D
DC2F 20 F6          	JR	NZ,GETL3
DC31 C9             	RET
DC32                
DC32                INKEY:
DC32 FB             	EI
DC33 E5             	PUSH	HL
DC34 2A 90 EC       	LD	HL,(_KEYPS)
DC37 7C             	LD	A,H
DC38 AD             	XOR	L
DC39 28 09          	JR	Z,INKEY1
DC3B 7C             	LD	A,H
DC3C 3C             	INC	A
DC3D 32 91 EC       	LD	(_KEYPS+1),A
DC40 6F             	LD	L,A
DC41 26 FE          	LD	H,KEYBF/256
DC43 7E             	LD	A,(HL)
DC44                INKEY1:
DC44 E1             	POP	HL
DC45 B7             	OR	A
DC46 C9             	RET
DC47                
DC47 00 00 10 DE    AT_RS	EQU	SCR1-AT_SCR1
DC47                	INCLUDE	"LDFILE.ASM"
DC47                
DC47                ;	LSX-Dodgers FILE
DC47                
DC47                FILEC:
DC47 CD 52 DC       	CALL	FILE
DC4A                FILEC2:
DC4A 3A 15 EB       	LD	A,(FDRV+1)
DC4D FE 20          	CP	020H
DC4F C8             	RET	Z
DC50 18 39          	JR	SETDIR1
DC52                
DC52                FILE:
DC52 AF             	XOR	A
DC53 32 14 EB       	LD	(FDRV),A
DC56 67             	LD	H,A
DC57 6F             	LD	L,A
DC58 22 22 EB       	LD	(FDRV+14),HL
DC5B CD 29 DD       	CALL	SPCUT
DC5E CD 0E DD       	CALL	CCHK3
DC61 28 12          	JR	Z,DEVI1
DC63 13             	INC	DE
DC64 1A             	LD	A,(DE)
DC65 1B             	DEC	DE
DC66 FE 3A          	CP	':'
DC68 20 0B          	JR	NZ,DEVI1
DC6A 1A             	LD	A,(DE)		;DRIVE
DC6B CD 72 DF       	CALL	CAP
DC6E D6 40          	SUB	'@'
DC70 13             	INC	DE
DC71 13             	INC	DE
DC72 32 14 EB       	LD	(FDRV),A
DC75                DEVI1:
DC75 1A             	LD	A,(DE)
DC76 D6 5C          	SUB	05CH		;\
DC78 20 09          	JR	NZ,NOROOT
DC7A 6F             	LD	L,A		;A=0でH=0のはずなのでHL=0
DC7B 22 2E EB       	LD	(FDRV+26),HL
DC7E 2C             	INC	L
DC7F 22 22 EB       	LD	(FDRV+14),HL
DC82 13             	INC	DE
DC83                NOROOT:
DC83                
DC83                SETDIR:
DC83 CD AF DC       	CALL	FILED
DC86 1A             	LD	A,(DE)
DC87 FE 5C          	CP	05CH		;\
DC89 C0             	RET	NZ
DC8A 13             	INC	DE
DC8B                SETDIR1:
DC8B 3E 10          	LD	A,010H		;Directory
DC8D 32 21 EB       	LD	(FDRV+13),A
DC90 D5             	PUSH	DE
DC91 11 14 EB       	LD	DE,FDRV
DC94 2A 1E EC       	LD	HL,(STABLE+2*00FH)
DC97 CD 0F 00       	CALL	JP_HL
DC9A D1             	POP	DE
DC9B B7             	OR	A
DC9C C0             	RET	NZ
DC9D                
DC9D 3A 21 EB       	LD	A,(FDRV+13)
DCA0 CB 67          	BIT	4,A
DCA2 C8             	RET	Z
DCA3                
DCA3 CD F6 DC       	CALL	FILEI
DCA6 2A 2E EB       	LD	HL,(FDRV+26)
DCA9 23             	INC	HL
DCAA 22 22 EB       	LD	(FDRV+14),HL
DCAD 18 D4          	JR	SETDIR
DCAF                
DCAF                FILED:
DCAF CD F6 DC       	CALL	FILEI
DCB2 21 15 EB       	LD	HL,FNAME
DCB5                
DCB5 06 08          	LD	B,8
DCB7                FILE2:
DCB7 CD 03 DD       	CALL	CCHKF
DCBA C8             	RET	Z
DCBB FE 2A          	CP	'*'
DCBD 28 2E          	JR	Z,FILE9
DCBF FE 2E          	CP	'.'
DCC1 28 0C          	JR	Z,FILE4
DCC3 77             	LD	(HL),A
DCC4 23             	INC	HL
DCC5 10 F0          	DJNZ	FILE2
DCC7                
DCC7                FILE3:
DCC7 CD 03 DD       	CALL	CCHKF
DCCA C8             	RET	Z
DCCB FE 2E          	CP	'.'
DCCD 20 F8          	JR	NZ,FILE3
DCCF                
DCCF                FILE4:
DCCF 21 1D EB       	LD	HL,FNAME+8
DCD2 06 03          	LD	B,3
DCD4                
DCD4                FILE4L:
DCD4 CD 03 DD       	CALL	CCHKF
DCD7 C8             	RET	Z
DCD8 FE 2E          	CP	'.'
DCDA 20 08          	JR	NZ,FILE12
DCDC 32 15 EB       	LD	(FNAME),A	;Parent directory(..)
DCDF 32 16 EB       	LD	(FNAME+1),A
DCE2 3E 20          	LD	A,020H
DCE4                FILE12:
DCE4 FE 2A          	CP	'*'
DCE6 28 0A          	JR	Z,FILE10
DCE8 77             	LD	(HL),A
DCE9 23             	INC	HL
DCEA 10 E8          	DJNZ	FILE4L
DCEC C9             	RET
DCED                
DCED                FILE9:				;名前の*処理、名前の残りを?で埋める
DCED CD F2 DC       	CALL	FILE10
DCF0 18 D5          	JR	FILE3
DCF2                
DCF2                FILE10:
DCF2 3E 3F          	LD	A,'?'
DCF4 18 08          	JR	FILL_MEMORY
DCF6                FILEI:				;名前＋拡張子をスペースで初期化
DCF6 3E 20          	LD	A,020H
DCF8 01 00 0B       	LD	BC,11*256	;C=0にしておく
DCFB 21 15 EB       	LD	HL,FNAME
DCFE                FILL_MEMORY:			;HLからBバイトAで埋める
DCFE 77             	LD	(HL),A
DCFF 23             	INC	HL
DD00 10 FC          	DJNZ	FILL_MEMORY
DD02 C9             	RET
DD03                
DD03                CCHKF:
DD03 1A             	LD	A,(DE)
DD04 CD 0B DD       	CALL	CCHK2
DD07 C8             	RET	Z
DD08 C3 90 E0       	JP	FKAN
DD0B                
DD0B                CCHK2:
DD0B 0C             	INC	C
DD0C 0D             	DEC	C
DD0D C0             	RET	NZ
DD0E                CCHK3:				;ZF=1 で使えない文字
DD0E FE 2B          	CP	'+'
DD10 C8             	RET	Z
DD11 FE 2C          	CP	','
DD13 C8             	RET	Z
DD14 FE 2F          	CP	'/'
DD16 C8             	RET	Z
DD17 FE 3A          	CP	':'
DD19 C8             	RET	Z
DD1A FE 3B          	CP	';'
DD1C C8             	RET	Z
DD1D FE 3D          	CP	'='
DD1F C8             	RET	Z
DD20 FE 5C          	CP	05CH	;\
DD22 C8             	RET	Z
DD23 FE 20          	CP	020H
DD25 D0             	RET	NC
DD26 BF             	CP	A		;Z=1
DD27 C9             	RET
DD28                
DD28                SS1:
DD28 13             	INC	DE
DD29                SPCUT:				;スペースをカット
DD29 1A             	LD	A,(DE)
DD2A FE 20          	CP	020H
DD2C 28 FA          	JR	Z,SS1
DD2E C9             	RET
DD2F                
DD2F                SETDRVF:
DD2F 11 14 EB       	LD	DE,FDRV
DD32                SETDRV0:
DD32 CD 3B DD       	CALL	SETDRV
DD35 FD E1          	POP	IY
DD37 C1             	POP	BC
DD38 D1             	POP	DE
DD39 E1             	POP	HL
DD3A C9             	RET
DD3B                
DD3B                SETDRV:
DD3B E3             	EX	(SP),HL		;HL=RETRN ADDRESS
DD3C D5             	PUSH	DE		;PUSH HL/DE/BC/IY
DD3D C5             	PUSH	BC
DD3E 1A             	LD	A,(DE)
DD3F D5             	PUSH	DE
DD40 FD E3          	EX	(SP),IY
DD42                
DD42 CD 4E DD       	CALL	GETDRV
DD45 3C             	INC	A
DD46 FD 77 00       	LD	(IY+0),A	;(FCB)ドライブ番号
DD49 3D             	DEC	A
DD4A CD D9 EC       	CALL	_CHGDRV
DD4D                
DD4D E9             	JP	(HL)
DD4E                
DD4E                GETDRV:
DD4E E6 7F          	AND	07FH
DD50 D6 01          	SUB	001H
DD52 30 03          	JR	NC,GETDRV1
DD54 3A 87 EC       	LD	A,(_DVSW)	;Current Drive
DD57                GETDRV1:
DD57 32 88 EC       	LD	(_DRV),A
DD5A C9             	RET
DD5B                
DD5B                SOPENX:
DD5B CD DD DE       	CALL	CHKDDX
DD5E 38 02          	JR	C,SOPENX1
DD60 C1             	POP	BC
DD61 E9             	JP	(HL)
DD62                SOPENX1:
DD62 11 39 EB       	LD	DE,SFILE
DD65 1A             	LD	A,(DE)
DD66 FD BE 00       	CP	(IY+0)		;(FCB)ドライブ番号
DD69 20 24          	JR	NZ,SOPEN
DD6B 13             	INC	DE
DD6C FD E5          	PUSH	IY
DD6E E1             	POP	HL
DD6F 23             	INC	HL
DD70 CD 0A DF       	CALL	CPFILE
DD73 20 1A          	JR	NZ,SOPEN
DD75                
DD75 2A F4 EB       	LD	HL,(SCDIR)
DD78 FD 75 0E       	LD	(IY+14),L	;(FCB)アクセスするディレクトリのクラスタ番号+1
DD7B FD 74 0F       	LD	(IY+15),H
DD7E                
DD7E 2A F8 EB       	LD	HL,(SFNDF)	;Direcroty location and Flags
DD81 22 9F EC       	LD	(_FILEN),HL
DD84                
DD84 ED 5B F6 EB    	LD	DE,(SFBPS)
DD88 21 39 EB       	LD	HL,SFILE
DD8B 36 FF          	LD	(HL),0FFH
DD8D 23             	INC	HL
DD8E C9             	RET
DD8F                SOPEN:
DD8F 21 A5 DE       	LD	HL,FILESE
DD92                SOPENC:
DD92 22 CB DD       	LD	(OPENPAT+1),HL
DD95                
DD95 CD E2 EC       	CALL	_RDFATX		;Detect Media
DD98 38 56          	JR	C,RDDERR
DD9A                
DD9A AF             	XOR	A
DD9B 32 9F EC       	LD	(_FILEN),A
DD9E CD B7 DF       	CALL	LDDIRX1		;A=0で呼び出す
DDA1 28 18          	JR	Z,SDIRX1
DDA3                
DDA3 CD 96 DE       	CALL	READ_DIR	;Sub Directory
DDA6 38 08          	JR	C,SDIRX0
DDA8 2A 7E EC       	LD	HL,(_DTBUF)
DDAB 7E             	LD	A,(HL)
DDAC FE 2E          	CP	'.'
DDAE 28 0F          	JR	Z,SOPEN1
DDB0                SDIRX0:
DDB0 AF             	XOR	A
DDB1 32 A0 EC       	LD	(_DIRF),A
DDB4 FD 36 0E 01    	LD	(IY+14),1	;(FCB)レコードサイズ
DDB8 FD 77 0F       	LD	(IY+15),A
DDBB                SDIRX1:
DDBB ED 5B FC EB    	LD	DE,(_DIRPS)	;Root Directory
DDBF                SOPEN1:
DDBF 0E 20          SDECPAT:LD	C,32		;自己書き換え 1セクタ辺りのディレクトリエントリ数  1024=32 / 512=16
DDC1                SOPEN1X:
DDC1 CD 96 DE       	CALL	READ_DIR	;FILE SEARCH
DDC4 38 2A          	JR	C,RDDERR
DDC6 2A 7E EC       	LD	HL,(_DTBUF)
DDC9                SOPEN2:
DDC9 D5             	PUSH	DE
DDCA CD A5 DE       OPENPAT:CALL	FILESE		;(Self-rewriting)
DDCD D1             	POP	DE
DDCE 38 6E          	JR	C,SOPENE
DDD0 28 1B          	JR	Z,SCF_FF_RET
DDD2                SOPEN3:
DDD2 3A A0 EC       	LD	A,(_DIRF)	;ディレクトリか判別
DDD5 B7             	OR	A
DDD6 20 0C          	JR	NZ,SOPEN5
DDD8 13             	INC	DE		;ルートディレクトリ
DDD9 E5             	PUSH	HL
DDDA 21 0C 00       MD_PAT:	LD	HL,12		;(Self-rewriting)MAXDIR
DDDD ED 52          	SBC	HL,DE		;CF=0 なので SUB HL,DE
DDDF E1             	POP	HL
DDE0 20 DD          	JR	NZ,SOPEN1
DDE2 18 07          	JR	SOPEN6
DDE4                SOPEN5:
DDE4 CD 7B E6       	CALL	GNCLX		;END DIR
DDE7 D8             	RET	C
DDE8 CD 6A DF       	CALL	ENDCL
DDEB                SOPEN6:
DDEB 38 D2          	JR	C,SOPEN1
DDED                SCF_FF_RET:
DDED 37             	SCF			;CF=1
DDEE 9F             	SBC	A,A		;A=0FFH
DDEF C9             	RET
DDF0                
DDF0                RDDERR:
DDF0 BF             	CP	A		;READ ERR CF=1 ZF=1
DDF1 37             	SCF
DDF2 C9             	RET
DDF3                
DDF3                NOPEN:
DDF3 21 A5 DE       	LD	HL,FILESE
DDF6 22 CB DD       	LD	(OPENPAT+1),HL
DDF9 FD 2A 98 EC    	LD	IY,(_FCB)
DDFD CD A3 E0       	CALL	CHKWILDX
DE00 30 EB          	JR	NC,SCF_FF_RET
DE02 FD 7E 00       	LD	A,(IY+0)	;(FCB)ドライブ番号
DE05 3D             	DEC	A
DE06 32 88 EC       	LD	(_DRV),A
DE09 CD D9 EC       	CALL	_CHGDRV
DE0C D8             	RET	C
DE0D 2A F8 EB       	LD	HL,(SFNDF)	;Direcroty location and Flags
DE10 22 9F EC       	LD	(_FILEN),HL
DE13                
DE13 CD B2 DF       	CALL	LDDIRX
DE16 ED 5B 9A EC    	LD	DE,(_FBPS)
DE1A CD 96 DE       	CALL	READ_DIR
DE1D 38 D1          	JR	C,RDDERR
DE1F 3A 9E EC       	LD	A,(_FBCNT)
DE22 3D             	DEC	A
DE23 28 AD          	JR	Z,SOPEN3
DE25                NOPEN2:
DE25 2A 9C EC       	LD	HL,(_FBAD)
DE28 01 20 00       	LD	BC,020H
DE2B 09             	ADD	HL,BC
DE2C 4F             	LD	C,A
DE2D 18 9A          	JR	SOPEN2
DE2F                
DE2F                SOPENE2:
DE2F 22 9C EC       	LD	(_FBAD),HL
DE32 79             	LD	A,C
DE33 32 9E EC       	LD	(_FBCNT),A
DE36 ED 53 9A EC    	LD	(_FBPS),DE
DE3A FD 22 98 EC    	LD	(_FCB),IY
DE3E                SOPENE:
DE3E AF             	XOR	A
DE3F C9             	RET
DE40                
DE40                COPEN:
DE40 FD 36 0D 20    	LD	(IY+13),020H	;(FCB)属性(アトリビュート)
DE44                
DE44 21 C2 DE       	LD	HL,NEXTSE
DE47 CD 92 DD       	CALL	SOPENC
DE4A D0             	RET	NC
DE4B C8             	RET	Z
DE4C 3A A0 EC       	LD	A,(_DIRF)	;ディレクトリか判別
DE4F B7             	OR	A
DE50 37             	SCF
DE51 C8             	RET	Z		;ルートディレクトリ
DE52 06 01          	LD	B,1
DE54 CD FF E0       	CALL	WRDF
DE57 D8             	RET	C
DE58 ED 5B FE EB    	LD	DE,(_CLPS)
DE5C D5             	PUSH	DE
DE5D CD 33 DF       	CALL	DCPAT
DE60 CD 12 E5       	CALL	DRDNX
DE63 2A 7E EC       	LD	HL,(_DTBUF)	;ディレクトリエントリを0クリア
DE66 3A 8D E4       	LD	A,(SECSZ+2)	;1024=4 / 512=2 / 256=1
DE69 47             	LD	B,A
DE6A AF             	XOR	A
DE6B 4F             	LD	C,A
DE6C                COPENCL:
DE6C 77             	LD	(HL),A
DE6D ED A1          	CPI			;HL=HL+1 BC=BC-1 BCが0の場合にP/V=0
DE6F EA 6C DE       	JP	PE,COPENCL
DE72                
DE72 3A 51 DF       	LD	A,(SPCPAT+1)	;1クラスタの論理セクタ数
DE75 3D             	DEC	A
DE76 28 19          	JR	Z,COPENE
DE78 3E 01          	LD	A,1		;1セクタ辺りのセクタ数が2以上の場合
DE7A 32 73 E6       	LD	(_SECPS+1),A
DE7D D1             	POP	DE		;DE=(_CLPS)
DE7E D5             	PUSH	DE
DE7F                COPEN1:
DE7F D5             	PUSH	DE		;データバッファに入らないセクタもゼロクリア
DE80 C5             	PUSH	BC
DE81 2A 7E EC       	LD	HL,(_DTBUF)
DE84 CD 4D DF       	CALL	CLUSTX
DE87 CD E4 E7       	CALL	DWT24
DE8A C1             	POP	BC
DE8B D1             	POP	DE
DE8C CD 72 E6       	CALL	NEXTX
DE8F 20 EE          	JR	NZ,COPEN1
DE91                COPENE:
DE91 2A 7E EC       	LD	HL,(_DTBUF)
DE94 D1             	POP	DE
DE95 C9             	RET
DE96                
DE96                READ_DIR:
DE96 ED 53 FE EB    	LD	(_CLPS),DE
DE9A C5             	PUSH	BC
DE9B D5             	PUSH	DE
DE9C CD 33 DF       	CALL	DCPAT
DE9F CD F2 E4       	CALL	DRDX
DEA2 D1             	POP	DE
DEA3 C1             	POP	BC
DEA4 C9             	RET
DEA5                
DEA5                FILESE:
DEA5 7E             	LD	A,(HL)
DEA6 B7             	OR	A
DEA7 C8             	RET	Z		;END:ZF=1 CF=0
DEA8 FE E5          	CP	0E5H
DEAA 28 0E          	JR	Z,FILESE1
DEAC FD E5          	PUSH	IY
DEAE D1             	POP	DE
DEAF 13             	INC	DE
DEB0 E5             	PUSH	HL
DEB1 CD 0A DF       	CALL	CPFILE
DEB4 CC 2B DF       	CALL	Z,CPFILE2
DEB7 E1             	POP	HL
DEB8 37             	SCF
DEB9 C8             	RET	Z		;!!!:(ZF=1) CF=1
DEBA                FILESE1:
DEBA CD D1 DE       	CALL	FNEXT
DEBD 20 E6          	JR	NZ,FILESE
DEBF                ZF0_CF0_AFF_RET:
DEBF F6 FF          	OR	0FFH		;ZF=0 CF=0
DEC1 C9             	RET
DEC2                
DEC2                NEXTSE:
DEC2 7E             	LD	A,(HL)
DEC3 B7             	OR	A
DEC4 37             	SCF
DEC5 C8             	RET	Z		;!!!:ZF=1 CF=1
DEC6 FE E5          	CP	0E5H
DEC8 37             	SCF
DEC9 C8             	RET	Z		;!!!:(ZF=1) CF=1
DECA CD D1 DE       	CALL	FNEXT
DECD 20 F3          	JR	NZ,NEXTSE
DECF 18 EE          	JR	ZF0_CF0_AFF_RET
DED1                
DED1                FNEXT:
DED1 E5             	PUSH	HL
DED2 21 9F EC       	LD	HL,_FILEN
DED5 34             	INC	(HL)
DED6 E1             	POP	HL
DED7 11 20 00       	LD	DE,020H
DEDA 19             	ADD	HL,DE
DEDB 0D             	DEC	C
DEDC C9             	RET
DEDD                
DEDD                CHKDDX:
DEDD CD A3 E0       	CALL	CHKWILDX
DEE0 D8             	RET	C
DEE1 FD E5          	PUSH	IY
DEE3 D1             	POP	DE
DEE4 13             	INC	DE
DEE5 21 62 EC       	LD	HL,DDTB
DEE8 06 04          	LD	B,DDS
DEEA                CPNAME:
DEEA C5             	PUSH	BC
DEEB D5             	PUSH	DE
DEEC E5             	PUSH	HL
DEED CD 04 DF       	CALL	CPFILE4
DEF0 E1             	POP	HL
DEF1 23             	INC	HL
DEF2 23             	INC	HL
DEF3 23             	INC	HL
DEF4 23             	INC	HL
DEF5 D1             	POP	DE
DEF6 C1             	POP	BC
DEF7 20 05          	JR	NZ,CPNAME1
DEF9 7E             	LD	A,(HL)
DEFA 23             	INC	HL
DEFB 66             	LD	H,(HL)
DEFC 6F             	LD	L,A
DEFD C9             	RET
DEFE                CPNAME1:
DEFE 23             	INC	HL
DEFF 23             	INC	HL
DF00 10 E8          	DJNZ	CPNAME
DF02 37             	SCF
DF03 C9             	RET
DF04                
DF04                CPFILE4:
DF04 C5             	PUSH	BC
DF05 01 00 04       	LD	BC,00400H
DF08 18 04          	JR	CPSTR1
DF0A                CPFILE:
DF0A C5             	PUSH	BC
DF0B 01 00 0B       	LD	BC,00B00H
DF0E                CPSTR1:
DF0E 1A             	LD	A,(DE)
DF0F FE 3F          	CP	'?'		;Wild card
DF11 28 12          	JR	Z,CPSTR2
DF13 7E             	LD	A,(HL)
DF14 CD 89 E0       	CALL	FKANC
DF17 E5             	PUSH	HL
DF18 67             	LD	H,A
DF19 1A             	LD	A,(DE)
DF1A CB 01          	RLC	C
DF1C CD 89 E0       	CALL	FKANC
DF1F CB 09          	RRC	C
DF21 BC             	CP	H		;CP (HL),(DE)
DF22 E1             	POP	HL
DF23 20 04          	JR	NZ,CPSTR3
DF25                CPSTR2:
DF25 13             	INC	DE
DF26 23             	INC	HL
DF27 10 E5          	DJNZ	CPSTR1
DF29                CPSTR3:
DF29 C1             	POP	BC
DF2A C9             	RET
DF2B                
DF2B                CPFILE2:
DF2B FD 7E 0D       	LD	A,(IY+13)	;(FCB)属性(アトリビュート)
DF2E F6 E1          	OR	0E1H
DF30 2F             	CPL
DF31 A6             	AND	(HL)
DF32 C9             	RET
DF33                
DF33                DCPAT:
DF33 0E 00          	LD	C,0
DF35 2A 7E EC       	LD	HL,(_DTBUF)
DF38 3A A0 EC       	LD	A,(_DIRF)	;ディレクトリか判別
DF3B B7             	OR	A
DF3C C8             	RET	Z		;ルートディレクトリの場合はCレジスタを0にしておく(CDEがセクタ番号)
DF3D 3A 51 DF       	LD	A,(SPCPAT+1)
DF40 4F             	LD	C,A
DF41 3A 73 E6       	LD	A,(_SECPS+1)
DF44 B9             	CP	C
DF45 38 01          	JR	C,DC1
DF47 AF             	XOR	A
DF48                DC1:
DF48 F6 80          	OR	080H
DF4A 32 A0 EC       	LD	(_DIRF),A	;bit0-6:セクタインデックス
DF4D                CLUSTX:
DF4D E5             	PUSH	HL
DF4E EB             	EX	DE,HL
DF4F AF             	XOR	A
DF50 0E 01          SPCPAT:	LD	C,1		;自己書き換え（1クラスタの論理セクタ数）
DF52                L_CLDBL:
DF52 CB 19          	RR	C		;->CF
DF54 38 04          	JR	C,E_CLDBL
DF56 29             	ADD	HL,HL		;*2
DF57 8F             	ADC	A,A
DF58 18 F8          	JR	L_CLDBL
DF5A                E_CLDBL
DF5A 4F             	LD	C,A
DF5B 3A 73 E6       	LD	A,(_SECPS+1)
DF5E B5             	OR	L
DF5F 6F             	LD	L,A
DF60 11 08 00       CLSPAT:	LD	DE,8	;+8 (2D)  !ADDCL (Self-rewriting)
DF63 AF             	XOR	A
DF64 19             	ADD	HL,DE	;データ格納領域の先頭論理セクタ番号
DF65 89             	ADC	A,C
DF66 4F             	LD	C,A
DF67 EB             	EX	DE,HL
DF68 E1             	POP	HL
DF69 C9             	RET
DF6A                
DF6A                ENDCL:
DF6A 7A             	LD	A,D	;END CLUSTER
DF6B FE 01          CLPAT1:	CP	1	;164=356	(Self-rewriting)
DF6D C0             	RET	NZ
DF6E 7B             	LD	A,E
DF6F FE 64          CLPAT2:	CP	064H	;		(Self-rewriting)
DF71 C9             	RET
DF72                
DF72                CAP:
DF72 FE 61          	CP	'a'
DF74 D8             	RET	C
DF75 FE 7B          	CP	'z'+1
DF77 D0             	RET	NC
DF78 D6 20          	SUB	020H
DF7A C9             	RET
DF7B                CAP2:
DF7B CD 72 DF       	CALL	CAP
DF7E                CAP3:
DF7E CD 87 DF       	CALL	CAP4
DF81 FE 21          	CP	021H
DF83 D0             	RET	NC
DF84 3E A0          	LD	A,0A0H
DF86 C9             	RET
DF87                CAP4:
DF87 FE 05          	CP	5
DF89 C0             	RET	NZ
DF8A 3E E5          	LD	A,0E5H
DF8C C9             	RET
DF8D                
DF8D                CHDIR:
DF8D CD 33 E9       	CALL	GETDPBD
DF90 38 1D          	JR	C,CHDIR2
DF92 DD 75 1A       	LD	(IX+01AH),L		;_SDIR_
DF95 DD 74 1B       	LD	(IX+01BH),H		;_SDIR_+1
DF98 18 15          	JR	CHDIR2		;POP_IX_RET
DF9A                
DF9A                LDDIR:
DF9A CD 33 E9       	CALL	GETDPBD
DF9D DD 5E 1A       	LD	E,(IX+01AH)		;_SDIR_
DFA0 DD 56 1B       	LD	D,(IX+01BH)		;_SDIR_+1
DFA3 13             	INC	DE
DFA4 FD 73 0E       	LD	(IY+14),E	;(FCB)アクセスするディレクトリのクラスタ番号+1
DFA7 FD 72 0F       	LD	(IY+15),D
DFAA 1B             	DEC	DE
DFAB AF             	XOR	A
DFAC 32 A0 EC       	LD	(_DIRF),A
DFAF                CHDIR2:
DFAF DD E1          	POP	IX
DFB1 C9             	RET
DFB2                
DFB2                LDDIRX:
DFB2 3A A0 EC       	LD	A,(_DIRF)	;(FCB)アクセスするディレクトリのセクタインデックス
DFB5 E6 7F          	AND	07FH
DFB7                LDDIRX1:
DFB7 32 73 E6       	LD	(_SECPS+1),A
DFBA FD 5E 0E       	LD	E,(IY+14)	;(FCB)アクセスするディレクトリのクラスタ番号+1
DFBD FD 56 0F       	LD	D,(IY+15)
DFC0 1B             	DEC	DE
DFC1 CD 6A DF       	CALL	ENDCL
DFC4 D4 9A DF       	CALL	NC,LDDIR
DFC7                LDDIRS:
DFC7 7A             	LD	A,D
DFC8 B3             	OR	E
DFC9 32 A0 EC       	LD	(_DIRF),A	;ディレクトリか判別
DFCC C9             	RET
DFCD                
DFCD                KILL:
DFCD CD A3 E0       	CALL	CHKWILDX
DFD0 38 3A          	JR	C,KILLW
DFD2 CD DD DE       	CALL	CHKDDX
DFD5 3F             	CCF
DFD6 D4 62 DD       	CALL	NC,SOPENX1
DFD9                KILLS:
DFD9 3E 1F          	LD	A,01FH
DFDB D4 1F E0       	CALL	NC,CHKATT
DFDE D8             	RET	C
DFDF                KILLSX:
DFDF 36 E5          	LD	(HL),0E5H	;DIR
DFE1 CD 7D E0       	CALL	WTDB
DFE4 11 1A 00       	LD	DE,01AH
DFE7 19             	ADD	HL,DE
DFE8 5E             	LD	E,(HL)
DFE9 23             	INC	HL
DFEA 56             	LD	D,(HL)
DFEB 18 04          	JR	KILLS2
DFED                KILLS1:
DFED ED 5B FE EB    	LD	DE,(_CLPS)	;FAT
DFF1                KILLS2:
DFF1 CD 6A DF       	CALL	ENDCL
DFF4 D0             	RET	NC		;CF=0
DFF5 21 FE FF       	LD	HL,0-2
DFF8 19             	ADD	HL,DE
DFF9 D0             	RET	NC		;DE= 0 or 1
DFFA D5             	PUSH	DE
DFFB CD F7 EC       	CALL	_GNCL
DFFE ED 53 FE EB    	LD	(_CLPS),DE
E002 D1             	POP	DE
E003 21 00 00       	LD	HL,0
E006 D4 FA EC       	CALL	NC,_SNCL
E009 30 E2          	JR	NC,KILLS1
E00B C9             	RET
E00C                
E00C                KILLW:
E00C CD 8F DD       	CALL	SOPEN
E00F                KILLW1:
E00F 38 0B          	JR	C,KILLW2
E011 CD 2F DE       	CALL	SOPENE2
E014 CD D9 DF       	CALL	KILLS
E017 CD F3 DD       	CALL	NOPEN
E01A 18 F3          	JR	KILLW1
E01C                KILLW2:
E01C C8             	RET	Z
E01D 3F             	CCF
E01E C9             	RET
E01F                
E01F                CHKATT:
E01F E5             	PUSH	HL
E020 11 0B 00       	LD	DE,00BH
E023 19             	ADD	HL,DE
E024 A6             	AND	(HL)
E025 E1             	POP	HL
E026 C8             	RET	Z
E027 37             	SCF
E028 C9             	RET
E029                
E029                NAME:
E029 CD A3 E0       	CALL	CHKWILDX
E02C D8             	RET	C
E02D 11 04 00       	LD	DE,4
E030 19             	ADD	HL,DE
E031 22 49 E0       	LD	(NAMEP+2),HL
E034 23             	INC	HL
E035 CD A7 E0       	CALL	CHKWILD
E038 D8             	RET	C
E039                
E039 CD 62 DD       	CALL	SOPENX1
E03C 3E 0F          	LD	A,00FH
E03E D4 1F E0       	CALL	NC,CHKATT
E041 D8             	RET	C
E042                
E042 FD 7E 00       	LD	A,(IY+0)
E045 FD E5          	PUSH	IY
E047 FD 21 00 00    NAMEP:	LD	IY,0
E04B FD 77 00       	LD	(IY+0),A
E04E CD 62 DD       	CALL	SOPENX1
E051 FD E3          	EX	(SP),IY
E053 3F             	CCF
E054 D4 8F DD       	CALL	NC,SOPEN
E057 EB             	EX	DE,HL
E058 E1             	POP	HL
E059 D8             	RET	C
E05A                
E05A                SETNAME:
E05A 01 00 0B       	LD	BC,11*256
E05D 23             	INC	HL
E05E 7E             	LD	A,(HL)
E05F FE E5          	CP	0E5H
E061 20 04          	JR	NZ,SNAME1
E063 3E 05          	LD	A,5
E065 18 0E          	JR	SNAME3
E067                SNAME1:
E067 7E             	LD	A,(HL)
E068 0C             	INC	C
E069 0D             	DEC	C
E06A 20 09          	JR	NZ,SNAME3
E06C CD 72 DF       	CALL	CAP
E06F FE A0          	CP	0A0H
E071 20 02          	JR	NZ,SNAME3
E073 3E 20          	LD	A,020H
E075                SNAME3:
E075 12             	LD	(DE),A
E076 7E             	LD	A,(HL)
E077 23             	INC	HL
E078 CD 90 E0       	CALL	FKAN
E07B 10 EA          	DJNZ	SNAME1
E07D                WTDB:
E07D 3E FF          	LD	A,0FFH
E07F 32 39 EB       	LD	(SFILE),A
E082                SWTDBF:
E082 3E 01          	LD	A,1
E084 32 A4 EC       	LD	(_WTDBF),A
E087 AF             	XOR	A
E088 C9             	RET
E089                
E089                FKANC:
E089 CB 41          	BIT	0,C
E08B CC 7B DF       	CALL	Z,CAP2
E08E 18 01          	JR	FKANX
E090                FKAN:			;漢字チェック
E090 13             	INC	DE
E091                FKANX:
E091 CB 41          	BIT	0,C
E093 CB 81          	RES	0,C
E095 C0             	RET	NZ
E096 FE 80          	CP	080H
E098 D8             	RET	C
E099 FE A0          	CP	0A0H
E09B 38 03          	JR	C,FKAN1
E09D FE E0          	CP	0E0H
E09F D8             	RET	C
E0A0                FKAN1:
E0A0 0C             	INC	C
E0A1 A7             	AND	A
E0A2 C9             	RET
E0A3                
E0A3                CHKWILDX:
E0A3 FD E5          	PUSH	IY
E0A5 E1             	POP	HL
E0A6 23             	INC	HL
E0A7                CHKWILD:
E0A7 06 0B          	LD	B,11
E0A9 3E 3F          	LD	A,'?'
E0AB                CHKWIL1:
E0AB BE             	CP	(HL)
E0AC 23             	INC	HL
E0AD 37             	SCF
E0AE C8             	RET	Z
E0AF 10 FA          	DJNZ	CHKWIL1
E0B1 AF             	XOR	A
E0B2 C9             	RET
E0B3                
E0B3                SDIRENT:		;IY=FCB HL=DIR
E0B3 D5             	PUSH	DE
E0B4 E5             	PUSH	HL
E0B5 FD E5          	PUSH	IY
E0B7 D1             	POP	DE
E0B8 EB             	EX	DE,HL
E0B9 CD 5A E0       	CALL	SETNAME
E0BC                ;				Attribute
E0BC FD 7E 0D       	LD	A,(IY+13)	;(FCB)属性(アトリビュート)
E0BF 12             	LD	(DE),A
E0C0 13             	INC	DE
E0C1                ;				Reserved
E0C1 AF             	XOR	A
E0C2 06 0A          	LD	B,10
E0C4                SDE1:
E0C4 12             	LD	(DE),A
E0C5 13             	INC	DE
E0C6 10 FC          	DJNZ	SDE1
E0C8                					;(FCB)更新時刻
E0C8 21 EA EB       	LD	HL,SDDATA		;(FCB)更新年月日
E0CB 06 0A          	LD	B,SDDATAE-SDDATA	;(FCB)ファイルの先頭クラスタ
E0CD                SDLOOP:					;(FCB)ファイルのサイズ(バイト単位)
E0CD 7E             	LD	A,(HL)
E0CE 23             	INC	HL
E0CF 32 D4 E0       	LD	(SDPAT+2),A
E0D2 FD 7E 00       SDPAT:	LD	A,(IY+0)	;LD A,(IY+A)
E0D5 12             	LD	(DE),A
E0D6 13             	INC	DE
E0D7 10 F4          	DJNZ	SDLOOP
E0D9                
E0D9 AF             	XOR	A
E0DA E1             	POP	HL
E0DB D1             	POP	DE
E0DC C9             	RET
E0DD                
E0DD                WOPEN:
E0DD FD 7E 0D       	LD	A,(IY+13)	;(FCB)属性(アトリビュート)
E0E0 E6 1F          	AND	01FH
E0E2 37             	SCF
E0E3 C0             	RET	NZ
E0E4 FD 36 1C FE    	LD	(IY+28),0FEH	;(FCB)オープンモード
E0E8                TOPEN2:
E0E8 AF             	XOR	A
E0E9                TOPEN:				;Initializes the time stamp
E0E9 FD 36 17 FF    	LD	(IY+23),0FFH	;(FCB)更新時刻
E0ED C9             	RET
E0EE                
E0EE                WRDFX:
E0EE 3A 51 DF       	LD	A,(SPCPAT+1)	;1クラスタの論理セクタ
E0F1                L_WRFX:
E0F1 1F             	RRA		;->CF
E0F2 38 04          	JR	C,E_WRFX
E0F4 CB 39          	SRL	C	;C=C/2
E0F6 18 F9          	JR	L_WRFX
E0F8                E_WRFX:
E0F8 41             	LD	B,C
E0F9 04             	INC	B
E0FA 3E 37          	LD	A,037H		;SCF
E0FC 32 0F E5       	LD	(DRDN1),A
E0FF                
E0FF                WRDF:				;Bクラスタ分FATを確保する
E0FF 11 02 00       	LD	DE,2
E102 AF             	XOR	A
E103 32 73 E6       	LD	(_SECPS+1),A
E106                WRDF1:
E106 C5             	PUSH	BC
E107 D5             	PUSH	DE
E108 CD F7 EC       	CALL	_GNCL
E10B 38 1C          	JR	C,WRDF3
E10D 7A             	LD	A,D		;空いているかチェック
E10E B3             	OR	E
E10F 20 27          	JR	NZ,WRDF4
E111 E1             	POP	HL		;HL=空いているクラスタ
E112 E5             	PUSH	HL
E113 ED 5B FE EB    	LD	DE,(_CLPS)	;DE=元の(_CLPS)
E117 22 FE EB       	LD	(_CLPS),HL
E11A 7A             	LD	A,D		;元の(_CLPS)が 0 か?
E11B B3             	OR	E
E11C 20 08          	JR	NZ,WRDF2
E11E FD 75 1A       	LD	(IY+26),L	;(FCB)ファイルの先頭クラスタ
E121 FD 74 1B       	LD	(IY+27),H	;元が空の場合はFCBにクラスタをセットする
E124 18 03          	JR	WRDF3
E126                WRDF2:
E126 CD FA EC       	CALL	_SNCL
E129                WRDF3:
E129 D1             	POP	DE
E12A C1             	POP	BC
E12B D8             	RET	C
E12C 10 0C          	DJNZ	WRDF5		;ここでループカウンタチェック
E12E ED 5B FE EB    	LD	DE,(_CLPS)
E132 21 FF FF       	LD	HL,0FFFFH	;FATエントリ終了(EOCマーク)
E135 C3 FA EC       	JP	_SNCL
E138                
E138                WRDF4:				;DEクラスタが空じゃないので次に移動する
E138 D1             	POP	DE
E139 C1             	POP	BC
E13A                WRDF5:
E13A 13             	INC	DE
E13B CD 6A DF       	CALL	ENDCL
E13E 38 C6          	JR	C,WRDF1
E140 37             	SCF
E141 C9             	RET
E142                
E142                RWXR:
E142 3A 8D E4       	LD	A,(SECSZ+2)	;1024=4 / 512=2 / 256=1
E145                L_RWX:
E145 1F             	RRA		;->CF
E146 38 06          	JR	C,E_RWX
E148 CB 38          	SRL	B	;BC=BC/2
E14A CB 19          	RR	C	;
E14C 18 F7          	JR	L_RWX
E14E                E_RWX:
E14E FD 5E 1A       	LD	E,(IY+26)	;(FCB)ファイルの先頭クラスタ
E151 FD 56 1B       	LD	D,(IY+27)
E154 AF             	XOR	A
E155 32 73 E6       	LD	(_SECPS+1),A
E158                RWX1:
E158 ED 53 FE EB    	LD	(_CLPS),DE
E15C 7A             	LD	A,D
E15D B3             	OR	E
E15E 28 0D          	JR	Z,SCF_RET	;RET DE==0 => CF=1
E160                
E160 78             	LD	A,B
E161 B1             	OR	C
E162 C8             	RET	Z		;RET BC==0 => CF=0
E163                
E163 CD 7B E6       	CALL	GNCLX
E166 D8             	RET	C
E167 0B             	DEC	BC
E168                
E168 CD 6A DF       	CALL	ENDCL
E16B 38 EB          	JR	C,RWX1
E16D                SCF_RET:
E16D 37             	SCF
E16E C9             	RET
E16F                
E16F                DSKF:
E16F 11 00 00       MAXCLP:	LD	DE,0
E172 2A AC EC       	LD	HL,(_FAKEFREE)
E175 7C             	LD	A,H
E176 B5             	OR	L
E177 28 03          	JR	Z,DSKF1
E179 11 01 00       	LD	DE,1
E17C                DSKF1:
E17C D5             	PUSH	DE
E17D CD F7 EC       	CALL	_GNCL
E180 38 0C          	JR	C,POPSCF
E182 7A             	LD	A,D
E183 B3             	OR	E
E184 20 01          	JR	NZ,DSKF2
E186 23             	INC	HL
E187                DSKF2:
E187 D1             	POP	DE
E188 1B             	DEC	DE
E189 7A             	LD	A,D
E18A B3             	OR	E
E18B 20 EF          	JR	NZ,DSKF1
E18D C9             	RET
E18E                
E18E                POPSCF:
E18E F1             	POP	AF
E18F 37             	SCF
E190 C9             	RET
E191                
E191                SETTMS:
E191 FD 7E 17       	LD	A,(IY+23)	;(FCB)ファイルを最後に変更した時刻
E194 3C             	INC	A
E195 C0             	RET	NZ		;ファイルが更新されていない
E196                SETTMSX:			;FCBに日付時刻をセットする
E196 CD 1B D8       	CALL	_SYS2C		;(BDOS)時刻の獲得
E199                				;H←時  L←分  D←秒
E199 CB 25          	SLA	L		;   *2
E19B CB 25          	SLA	L		;   *4
E19D 29             	ADD	HL,HL		;*2 *8
E19E 29             	ADD	HL,HL		;*4 *16
E19F 29             	ADD	HL,HL		;*8 *32
E1A0 7A             	LD	A,D
E1A1 0F             	RRCA			;bit.0->7->->->0->C
E1A2 E6 1F          	AND	01FH
E1A4 B5             	OR	L
E1A5 FD 77 16       	LD	(IY+22),A	;(FCB)ファイルを最後に変更した時刻
E1A8 FD 74 17       	LD	(IY+23),H
E1AB                
E1AB CD E7 D7       	CALL	_SYS2A		;(BDOS)日付の獲得
E1AE                				;HL←年  D←月  E←日
E1AE 01 44 F8       	LD	BC,0-1980
E1B1 09             	ADD	HL,BC
E1B2 65             	LD	H,L
E1B3                
E1B3 7A             	LD	A,D
E1B4 87             	ADD	A,A		;*2
E1B5 87             	ADD	A,A		;*4
E1B6 87             	ADD	A,A		;*8
E1B7 87             	ADD	A,A		;*16
E1B8 6F             	LD	L,A
E1B9 29             	ADD	HL,HL		;*32
E1BA 7D             	LD	A,L
E1BB B3             	OR	E
E1BC FD 77 14       	LD	(IY+20),A	;(FCB)ファイルを最後に変更した日付
E1BF FD 74 15       	LD	(IY+21),H
E1C2 C9             	RET
E1C3                
E1C3                PUSHRR:
E1C3 CD C9 E1       	CALL	SUBRR
E1C6                POPRR1:
E1C6 ED B0          	LDIR
E1C8 C9             	RET
E1C9                
E1C9                SUBRR:
E1C9 FD E5          	PUSH	IY
E1CB E1             	POP	HL
E1CC 11 21 00       	LD	DE,33
E1CF 19             	ADD	HL,DE
E1D0 11 5A EB       	LD	DE,HLBUF
E1D3 01 03 00       	LD	BC,3
E1D6 C9             	RET
E1D7                
E1D7                SETSEQ:
E1D7 F5             	PUSH	AF		;AHL=Random record
E1D8 FD 7E 21       	LD	A,(IY+33)	;(FCB)ランダムレコード
E1DB FD 6E 22       	LD	L,(IY+34)
E1DE FD 66 23       	LD	H,(IY+35)
E1E1                
E1E1 CD FD E1       	CALL	SSQ1
E1E4                
E1E4 29             	ADD	HL,HL
E1E5 CB 3D          	SRL	L		;L=L/2
E1E7 FD 75 20       	LD	(IY+32),L	;(FCB)カレントレコード
E1EA FD 74 0C       	LD	(IY+12),H	;(FCB)カレントブロック
E1ED F1             	POP	AF
E1EE                
E1EE                POPRR:
E1EE CD C9 E1       	CALL	SUBRR
E1F1 EB             	EX	DE,HL
E1F2 18 D2          	JR	POPRR1
E1F4                
E1F4                GETSIZE:
E1F4 FD 7E 10       	LD	A,(IY+16)	;(FCB)ファイルのサイズ(バイト単位)
E1F7 FD 6E 11       	LD	L,(IY+17)
E1FA FD 66 12       	LD	H,(IY+18)
E1FD                SSQ1:				;バイト単位からCP/Mのレコード単位を求める（1レコード=128バイト）
E1FD 87             	ADD	A,A		;in HLA => out HL
E1FE ED 6A          	ADC	HL,HL
E200 B7             	OR	A
E201 C8             	RET	Z
E202 23             	INC	HL
E203 C9             	RET
E204                
E204                GETSEQ:
E204 FD 6E 20       	LD	L,(IY+32)	;(FCB)カレントレコード
E207 FD 66 0C       	LD	H,(IY+12)	;(FCB)カレントブロック
E20A                
E20A CB 25          	SLA	L	;L=L*2
E20C                
E20C CB 3C          	SRL	H	;HL=HL/2
E20E CB 1D          	RR	L	;
E210 C9             	RET
E211                
E211                RB_WRITE:
E211 C5             	PUSH	BC
E212 ED 4B 4C EC    	LD	BC,(STABLE+2*026H)	;(BDOS)ランダムブロック書き込み
E216 18 05          	JR	RBRW
E218                RB_READ:
E218 C5             	PUSH	BC
E219 ED 4B 4E EC    	LD	BC,(STABLE+2*027H)	;(BDOS)ランダムブロック読み込み
E21D                RBRW:
E21D AF             	XOR	A	;HLA = HL*128
E21E CB 3C          	SRL	H	;HL=HL/2
E220 CB 1D          	RR	L	;
E222 1F             	RRA			;HLA
E223 FD 77 21       	LD	(IY+33),A	;(FCB)ランダムレコード
E226 FD 75 22       	LD	(IY+34),L
E229 FD 74 23       	LD	(IY+35),H
E22C 21 80 00       	LD	HL,128
E22F                
E22F FD E5          	PUSH	IY
E231 D1             	POP	DE
E232 D5             	PUSH	DE
E233 CD 3A E2       	CALL	JP_BC
E236 FD E1          	POP	IY
E238 C1             	POP	BC
E239 C9             	RET
E23A                JP_BC:
E23A C5             	PUSH	BC
E23B C9             	RET
E23C                
E23C 00 00 DD ED    _SYS03	EQU	SCF_FF_RET	;(BDOS)外部入力
E23C 00 00 DD ED    _SYS2B	EQU	SCF_FF_RET	;(BDOS)日付の設定
E23C 00 00 DD ED    _SYS2D	EQU	SCF_FF_RET	;(BDOS)時刻の設定
E23C                	INCLUDE	"LDFILE2.ASM"
E23C                
E23C                ;	LSX-Dodgers FILE2
E23C                
E23C                RBWDD:
E23C E5             	PUSH	HL
E23D C1             	POP	BC
E23E 21 18 E3       	LD	HL,NUL
E241 CD 4C E3       	CALL	DDX
E244 20 03          	JR	NZ,RBWDD2
E246 2A 08 EC       	LD	HL,(STABLE+2*4)
E249                RBWDD2:
E249 FE 43          	CP	'C'
E24B 20 03          	JR	NZ,RBWDD3
E24D 2A 04 EC       	LD	HL,(STABLE+2*2)
E250                RBWDD3:
E250 FE 50          	CP	'P'
E252 20 03          	JR	NZ,RBWDD4
E254 2A 0A EC       	LD	HL,(STABLE+2*5)
E257                RBWDD4:
E257 22 65 E2       	LD	(RBWDDP+1),HL
E25A 2A 8A EC       	LD	HL,(_DTA)
E25D                RBWDD1:
E25D 78             	LD	A,B
E25E B1             	OR	C
E25F                RBWDD5:
E25F CA 13 E3       	JP	Z,RBW1
E262 5E             	LD	E,(HL)
E263 23             	INC	HL
E264 CD 5F D7       RBWDDP:	CALL	_SYS02
E267 DA 2F E3       	JP	C,RBRERR
E26A 3E 1A          	LD	A,01AH
E26C BB             	CP	E
E26D 28 F0          	JR	Z,RBWDD5
E26F 0B             	DEC	BC
E270 18 EB          	JR	RBWDD1
E272                
E272                				;Write random block
E272                _SYS26:		;(BDOS)ランダムブロック書き込み
E272 AF             	XOR	A
E273 32 0F E5       	LD	(DRDN1),A	;NOP
E276 22 D0 E4       	LD	(LEFT+1),HL	;HL←書き込むレコード数
E279 22 5D EB       	LD	(LEFTX),HL
E27C CD 3B DD       	CALL	SETDRV
E27F                
E27F CD 38 E4       	CALL	RBX0
E282 DA 1A E3       	JP	C,RBWERR
E285 28 B5          	JR	Z,RBWDD		;デバイスデスクプリタ
E287 CD DD E0       	CALL	WOPEN
E28A DA 1A E3       	JP	C,RBWERR
E28D 7C             	LD	A,H
E28E B5             	OR	L
E28F CA 13 E3       	JP	Z,RBW1
E292                
E292 2B             	DEC	HL
E293                
E293 CD E8 E4       	CALL	GET_RR_CDE	;CDE=Random record
E296                
E296 AF             	XOR	A	;AHL=HL+CDE
E297 19             	ADD	HL,DE
E298 89             	ADC	A,C
E299                
E299 47             	LD	B,A
E29A 4C             	LD	C,H
E29B                
E29B CD 42 E1       	CALL	RWXR
E29E DC EE E0       	CALL	C,WRDFX
E2A1 DA 1A E3       	JP	C,RBWERR
E2A4                
E2A4 CD 61 E4       	CALL	RBX2
E2A7 28 1A          	JR	Z,RBWB		;NZ=セクタ以下の端数がある
E2A9 CD 75 E4       	CALL	RBXA
E2AC 38 6C          	JR	C,RBWERR
E2AE EB             	EX	DE,HL
E2AF C5             	PUSH	BC
E2B0 ED B0          	LDIR
E2B2 22 5F EB       	LD	(DTAX),HL
E2B5                
E2B5 CD 82 E0       	CALL	SWTDBF		;バッファデータは更新された
E2B8                
E2B8 2A 5D EB       	LD	HL,(LEFTX)
E2BB D1             	POP	DE
E2BC ED 52          	SBC	HL,DE
E2BE 22 5D EB       	LD	(LEFTX),HL
E2C1 28 30          	JR	Z,RBWEND
E2C3                
E2C3                RBWB:
E2C3 CD AB E4       	CALL	RBXB
E2C6 28 13          	JR	Z,RBWC
E2C8                RBWB1:
E2C8 C5             	PUSH	BC
E2C9 D5             	PUSH	DE
E2CA CD 4D DF       	CALL	CLUSTX
E2CD CD E4 E7       	CALL	DWT24
E2D0 D1             	POP	DE
E2D1 C1             	POP	BC
E2D2 38 46          	JR	C,RBWERR
E2D4 CD 7B E6       	CALL	GNCLX
E2D7 38 41          	JR	C,RBWERR
E2D9 10 ED          	DJNZ	RBWB1
E2DB                RBWC:
E2DB CD C3 E4       	CALL	RBXC
E2DE 28 13          	JR	Z,RBWEND
E2E0 C5             	PUSH	BC
E2E1 CD 4D DF       	CALL	CLUSTX
E2E4 CD 0E E5       	CALL	DRDN
E2E7 C1             	POP	BC
E2E8 38 30          	JR	C,RBWERR
E2EA ED 5B 7E EC    	LD	DE,(_DTBUF)
E2EE ED B0          	LDIR
E2F0 CD 82 E0       	CALL	SWTDBF		;バッファデータは更新された
E2F3                RBWEND:
E2F3 CD CF E4       	CALL	RBXEND
E2F6                
E2F6 CD 47 E4       	CALL	RBX1
E2F9 30 18          	JR	NC,RBW1
E2FB 2A D0 E4       	LD	HL,(LEFT+1)
E2FE FD 5E 10       	LD	E,(IY+16)	;(FCB)ファイルのサイズ(バイト単位)
E301 FD 56 11       	LD	D,(IY+17)	;CDE=File size
E304 FD 4E 12       	LD	C,(IY+18)
E307 AF             	XOR	A
E308 19             	ADD	HL,DE
E309 89             	ADC	A,C
E30A FD 75 10       	LD	(IY+16),L	;(FCB)ファイルのサイズ(バイト単位)
E30D FD 74 11       	LD	(IY+17),H
E310 FD 77 12       	LD	(IY+18),A
E313                RBW1:
E313 FD E1          	POP	IY
E315 C1             	POP	BC
E316 D1             	POP	DE
E317 E1             	POP	HL
E318                NUL:
E318 AF             	XOR	A
E319 C9             	RET
E31A                
E31A                RBWERR:
E31A FD E5          	PUSH	IY
E31C D1             	POP	DE
E31D 2A 20 EC       	LD	HL,(STABLE+2*010H)
E320 CD 0F 00       	CALL	JP_HL
E323                RBRERR1:
E323 3E 01          	LD	A,001H
E325                RBRERR2:
E325 FD E1          	POP	IY
E327 C1             	POP	BC
E328 D1             	POP	DE
E329 E1             	POP	HL
E32A 37             	SCF
E32B 21 00 00       	LD	HL,0
E32E C9             	RET
E32F                
E32F                RBRERR:
E32F 3E FF          	LD	A,0FFH
E331 18 F2          	JR	RBRERR2
E333                
E333                RBRFL:
E333 3E 00          RBRFLP:	LD	A,000H
E335 FE 0D          	CP	00DH
E337 20 05          	JR	NZ,RBRFL1
E339 D5             	PUSH	DE
E33A 1E 0A          	LD	E,00AH
E33C 18 05          	JR	RBRFL2
E33E                RBRFL1:
E33E D5             	PUSH	DE
E33F CD 09 EB       	CALL	_SYS07
E342 5F             	LD	E,A
E343                RBRFL2:
E343 CD CD EC       	CALL	_PRINT
E346 7B             	LD	A,E
E347 D1             	POP	DE
E348 32 34 E3       	LD	(RBRFLP+1),A
E34B C9             	RET
E34C                DDX:
E34C FD 7E 01       	LD	A,(IY+1)	;(FCB)主ファイル名
E34F CD 72 DF       	CALL	CAP
E352 FE 41          	CP	'A'
E354 C9             	RET
E355                
E355                RBRDD:
E355 E5             	PUSH	HL
E356 C1             	POP	BC
E357 21 33 E3       	LD	HL,RBRFL
E35A CD 4C E3       	CALL	DDX
E35D 20 05          	JR	NZ,RBRDD2
E35F 2A 06 EC       	LD	HL,(STABLE+2*3)
E362 18 04          	JR	RBRDD3
E364                RBRDD2:
E364 FE 43          	CP	'C'
E366 20 2C          	JR	NZ,RBRDERR
E368                RBRDD3:
E368 22 78 E3       	LD	(RBRDDP+1),HL
E36B                
E36B ED 5B 8A EC    	LD	DE,(_DTA)
E36F 21 00 00       	LD	HL,0
E372                RBRDD1:
E372 78             	LD	A,B
E373 B1             	OR	C
E374 28 18          	JR	Z,RBRDDE1
E376 23             	INC	HL
E377 CD 33 E3       RBRDDP:	CALL	RBRFL
E37A 38 0D          	JR	C,RBRDDE
E37C FE 1A          	CP	01AH
E37E 28 09          	JR	Z,RBRDDE
E380 FE 03          	CP	3
E382 28 05          	JR	Z,RBRDDE
E384 12             	LD	(DE),A
E385 13             	INC	DE
E386 0B             	DEC	BC
E387 18 E9          	JR	RBRDD1
E389                
E389                RBRDDE:
E389 3E 1A          	LD	A,01AH
E38B 12             	LD	(DE),A
E38C                RBRDDE2:
E38C AF             	XOR	A
E38D 3C             	INC	A
E38E                RBRDDE1:
E38E 32 24 E4       	LD	(RBRAP+1),A
E391 C3 1D E4       	JP	RBREND0
E394                RBRDERR:
E394 21 00 00       	LD	HL,0
E397 18 F3          	JR	RBRDDE2
E399                
E399                				;Read random block
E399                _SYS27:		;(BDOS)ランダムブロック読み込み
E399 22 5D EB       	LD	(LEFTX),HL
E39C CD 3B DD       	CALL	SETDRV
E39F                
E39F FD CB 0D 66    	BIT	4,(IY+13)	;(FCB)属性(アトリビュート)
E3A3 C2 26 E4       	JP	NZ,RBRDIR	;ディレクトリ
E3A6 CD 38 E4       	CALL	RBX0
E3A9 DA 2F E3       	JP	C,RBRERR
E3AC 28 A7          	JR	Z,RBRDD
E3AE CD 47 E4       	CALL	RBX1
E3B1 DA 23 E3       	JP	C,RBRERR1
E3B4 79             	LD	A,C
E3B5 EB             	EX	DE,HL
E3B6 ED 52          	SBC	HL,DE		;CP 0HL,CDE
E3B8 19             	ADD	HL,DE
E3B9 DE 00          	SBC	A,000H
E3BB 38 01          	JR	C,RBR1
E3BD EB             	EX	DE,HL
E3BE                RBR1:
E3BE 9F             	SBC	A,A
E3BF E6 01          	AND	1
E3C1 32 24 E4       	LD	(RBRAP+1),A
E3C4                
E3C4 7C             	LD	A,H
E3C5 B5             	OR	L
E3C6 CA 1D E4       	JP	Z,RBREND0
E3C9                
E3C9 22 D0 E4       	LD	(LEFT+1),HL	;Read record byte
E3CC 22 5D EB       	LD	(LEFTX),HL
E3CF                
E3CF CD 61 E4       	CALL	RBX2
E3D2 28 19          	JR	Z,RBRB
E3D4 CD 75 E4       	CALL	RBXA
E3D7 DA 2F E3       	JP	C,RBRERR
E3DA C5             	PUSH	BC
E3DB ED B0          	LDIR
E3DD ED 53 5F EB    	LD	(DTAX),DE
E3E1 2A 5D EB       	LD	HL,(LEFTX)
E3E4 D1             	POP	DE
E3E5 A7             	AND	A
E3E6 ED 52          	SBC	HL,DE
E3E8 22 5D EB       	LD	(LEFTX),HL
E3EB 28 2D          	JR	Z,RBREND
E3ED                
E3ED                RBRB:
E3ED CD AB E4       	CALL	RBXB
E3F0 28 12          	JR	Z,RBRC
E3F2                RBRB1:
E3F2 C5             	PUSH	BC
E3F3 D5             	PUSH	DE
E3F4 CD 4D DF       	CALL	CLUSTX
E3F7 CD D4 E7       	CALL	DRD24
E3FA D1             	POP	DE
E3FB C1             	POP	BC
E3FC D4 7B E6       	CALL	NC,GNCLX
E3FF DA 2F E3       	JP	C,RBRERR
E402 10 EE          	DJNZ	RBRB1
E404                RBRC:
E404 CD C3 E4       	CALL	RBXC
E407 28 11          	JR	Z,RBREND
E409 C5             	PUSH	BC
E40A CD 4D DF       	CALL	CLUSTX
E40D CD F2 E4       	CALL	DRDX
E410 C1             	POP	BC
E411 DA 2F E3       	JP	C,RBRERR
E414 EB             	EX	DE,HL
E415 2A 7E EC       	LD	HL,(_DTBUF)
E418 ED B0          	LDIR
E41A                RBREND:
E41A CD CF E4       	CALL	RBXEND
E41D                RBREND0:
E41D FD E1          	POP	IY
E41F C1             	POP	BC
E420 D1             	POP	DE
E421 F1             	POP	AF	;(HL)
E422 AF             	XOR	A
E423 3E 00          RBRAP:	LD	A,000H
E425 C9             	RET
E426                
E426                RBRDIR:
E426 FD 6E 1A       	LD	L,(IY+26)	;(FCB)ファイルの先頭クラスタ
E429 FD 66 1B       	LD	H,(IY+27)
E42C CD 8D DF       	CALL	CHDIR
E42F AF             	XOR	A
E430 67             	LD	H,A
E431 6F             	LD	L,A
E432 3C             	INC	A
E433 32 24 E4       	LD	(RBRAP+1),A
E436 18 E5          	JR	RBREND0
E438                
E438                RBX0:
E438 2A 8A EC       	LD	HL,(_DTA)
E43B 22 5F EB       	LD	(DTAX),HL
E43E 2A 5D EB       	LD	HL,(LEFTX)
E441 FD 7E 1C       	LD	A,(IY+28)	;(FCB)オープンモード
E444 D6 FD          	SUB	0FDH
E446 C9             	RET
E447                
E447                RBX1:
E447 E5             	PUSH	HL		;Record byte
E448                				;AHL=File size
E448 FD 6E 10       	LD	L,(IY+16)	;ファイルのサイズ(バイト単位)
E44B FD 66 11       	LD	H,(IY+17)
E44E FD 7E 12       	LD	A,(IY+18)
E451                
E451 CD E8 E4       	CALL	GET_RR_CDE	;CDE=Random record
E454                
E454 A7             	AND	A
E455 ED 52          	SBC	HL,DE
E457 99             	SBC	A,C
E458 D1             	POP	DE
E459                
E459 D8             	RET	C
E45A 4F             	LD	C,A
E45B EB             	EX	DE,HL	;CDE=File byte	HL=Record byte
E45C B2             	OR	D
E45D B3             	OR	E
E45E C0             	RET	NZ
E45F 37             	SCF
E460 C9             	RET
E461                
E461                RBX2:				;Cluster settings
E461 FD 4E 22       	LD	C,(IY+34)	;(+33)(FCB)ランダムレコード
E464 FD 46 23       	LD	B,(IY+35)
E467 CD 42 E1       	CALL	RWXR
E46A 3A 8D E4       	LD	A,(SECSZ+2)	;1024=4 / 512=2 / 256=1
E46D 3D             	DEC	A
E46E FD A6 22       	AND	(IY+34)
E471 FD B6 21       	OR	(IY+33)
E474 C9             	RET
E475                
E475                RBXA:
E475 C5             	PUSH	BC
E476 D5             	PUSH	DE
E477 CD 4D DF       	CALL	CLUSTX
E47A CD F2 E4       	CALL	DRDX
E47D D1             	POP	DE
E47E C1             	POP	BC
E47F D8             	RET	C
E480 CD 7B E6       	CALL	GNCLX
E483 D8             	RET	C
E484 ED 53 FE EB    	LD	(_CLPS),DE
E488                
E488 FD 4E 21       	LD	C,(IY+33)	;(FCB)ランダムレコード
E48B 21 00 04       SECSZ:	LD	HL,0400H	;自己書き換え 1024=0400H / 512=0200H ここに1セクタのサイズが格納される
E48E 7C             	LD	A,H
E48F 3D             	DEC	A		;1024=3 / 512=1
E490 FD A6 22       	AND	(IY+34)		;(FCB)ランダムレコード
E493 47             	LD	B,A		;BCに1セクタ以下の端数が入る
E494 ED 42          	SBC	HL,BC		;残りを計算
E496                
E496 ED 5B 5D EB    	LD	DE,(LEFTX)
E49A ED 52          	SBC	HL,DE		;CP HL,DE
E49C 19             	ADD	HL,DE		;
E49D 38 01          	JR	C,RBXA1		;DEとHLを比較して大きい方をHLに
E49F EB             	EX	DE,HL
E4A0                RBXA1:
E4A0 E5             	PUSH	HL
E4A1 2A 7E EC       	LD	HL,(_DTBUF)
E4A4 09             	ADD	HL,BC
E4A5 ED 5B 5F EB    	LD	DE,(DTAX)
E4A9 C1             	POP	BC
E4AA C9             	RET
E4AB                
E4AB                RBXB:
E4AB 2A 5F EB       	LD	HL,(DTAX)
E4AE ED 5B FE EB    	LD	DE,(_CLPS)
E4B2 3A 5E EB       	LD	A,(LEFTX+1)
E4B5 47             	LD	B,A
E4B6 3A 8D E4       	LD	A,(SECSZ+2)	;1024=4 / 512=2 / 256=1
E4B9                RBXB1:
E4B9 1F             	RRA		;->CF
E4BA 38 04          	JR	C,RBXB2
E4BC CB 38          	SRL	B	;B=B/2
E4BE 18 F9          	JR	RBXB1
E4C0                RBXB2:
E4C0 78             	LD	A,B
E4C1 B7             	OR	A
E4C2 C9             	RET
E4C3                
E4C3                RBXC:
E4C3 ED 4B 5D EB    	LD	BC,(LEFTX)
E4C7 3A 8D E4       	LD	A,(SECSZ+2)	;1024=4 / 512=2 / 256=1
E4CA 3D             	DEC	A
E4CB A0             	AND	B
E4CC 47             	LD	B,A		;1セクタ以下の端数がない場合はZ
E4CD B1             	OR	C
E4CE C9             	RET
E4CF                
E4CF                RBXEND:
E4CF 11 00 00       LEFT:	LD	DE,0
E4D2 AF             	XOR	A
E4D3 FD 6E 21       	LD	L,(IY+33)	;(FCB)ランダムレコード
E4D6 FD 66 22       	LD	H,(IY+34)
E4D9 19             	ADD	HL,DE
E4DA FD 8E 23       	ADC	A,(IY+35)
E4DD FD 75 21       	LD	(IY+33),L	;(FCB)ランダムレコード
E4E0 FD 74 22       	LD	(IY+34),H
E4E3 FD 77 23       	LD	(IY+35),A
E4E6 EB             	EX	DE,HL		;HL=Read byte
E4E7 C9             	RET
E4E8                
E4E8                GET_RR_CDE:			;CDE=Random record
E4E8 FD 5E 21       	LD	E,(IY+33)	;(FCB)ランダムレコード
E4EB FD 56 22       	LD	D,(IY+34)
E4EE FD 4E 23       	LD	C,(IY+35)
E4F1 C9             	RET
E4F2                
E4F2                	INCLUDE	"LDDIO.ASM"
E4F2                
E4F2                ;	LSX-Dodgers DIO
E4F2                
E4F2                DRDX:
E4F2 CD 30 E5       	CALL	DRDY
E4F5 C8             	RET	Z
E4F6 CD 16 E5       	CALL	DRDX1		;データバッファの情報を保存
E4F9 D8             	RET	C
E4FA E5             	PUSH	HL
E4FB C5             	PUSH	BC
E4FC D5             	PUSH	DE
E4FD 2A 7E EC       	LD	HL,(_DTBUF)
E500 3A 59 E5       	LD	A,(_DBS24+1)
E503 4F             	LD	C,A
E504 CD D4 E7       	CALL	DRD24
E507 DC 2B E5       	CALL	C,DRDNE
E50A                POP_DE_BC_HL_RET:
E50A D1             	POP	DE
E50B C1             	POP	BC
E50C E1             	POP	HL
E50D C9             	RET
E50E                
E50E                ;	CDE:セクタ番号
E50E                DRDN:
E50E AF             	XOR	A
E50F 00             DRDN1:	NOP			;自己書き換え NOP / SCF
E510 30 E0          	JR	NC,DRDX
E512                DRDNX:
E512 CD 30 E5       	CALL	DRDY
E515 C8             	RET	Z
E516                DRDX1:
E516 CD 46 E5       	CALL	DWTX
E519                				;データバッファの読み込んだドライブ・セクタ情報を保存
E519 ED 53 A6 EC    	LD	(_DBSEC),DE
E51D 79             	LD	A,C
E51E 32 59 E5       	LD	(_DBS24+1),A
E521                
E521 3A 88 EC       	LD	A,(_DRV)
E524 32 A5 EC       	LD	(_DBDRV),A
E527 CD D9 EC       	CALL	_CHGDRV
E52A D0             	RET	NC
E52B                DRDNE:
E52B 9F             	SBC	A,A		;CF=1ならばA=0FFH
E52C 32 A5 EC       	LD	(_DBDRV),A
E52F C9             	RET
E530                
E530                ;	CDE:セクタ番号
E530                DRDY:
E530 3A 59 E5       	LD	A,(_DBS24+1)
E533 B9             	CP	C
E534 C0             	RET	NZ
E535                
E535 E5             	PUSH	HL
E536 3A 88 EC       	LD	A,(_DRV)
E539 21 A5 EC       	LD	HL,_DBDRV
E53C AE             	XOR	(HL)
E53D 20 05          	JR	NZ,POP_HL_RET
E53F                
E53F 2A A6 EC       	LD	HL,(_DBSEC)
E542 ED 52          	SBC	HL,DE		;CF=0
E544                POP_HL_RET:
E544 E1             	POP	HL
E545 C9             	RET
E546                
E546                DWTX:
E546 3A A4 EC       	LD	A,(_WTDBF)
E549 B7             	OR	A
E54A C8             	RET	Z
E54B AF             	XOR	A
E54C 32 A4 EC       	LD	(_WTDBF),A
E54F                
E54F E5             	PUSH	HL
E550 C5             	PUSH	BC
E551 D5             	PUSH	DE
E552 3A A5 EC       	LD	A,(_DBDRV)
E555 CD D9 EC       	CALL	_CHGDRV
E558 0E 00          _DBS24:	LD	C,0
E55A ED 5B A6 EC    	LD	DE,(_DBSEC)
E55E 2A 7E EC       	LD	HL,(_DTBUF)
E561 D4 E4 E7       	CALL	NC,DWT24
E564                POP_DE_BC_HL_RET2:
E564 18 A4          	JR	POP_DE_BC_HL_RET
E566                
E566                RDFATX:
E566 E5             	PUSH	HL
E567 3A 88 EC       	LD	A,(_DRV)
E56A 21 AA EC       	LD	HL,_FATDRV
E56D AE             	XOR	(HL)
E56E 28 D4          	JR	Z,POP_HL_RET
E570                
E570 C5             	PUSH	BC
E571 D5             	PUSH	DE
E572 DD E5          	PUSH	IX
E574 CD 90 E5       	CALL	WTFATX
E577 38 13          	JR	C,POP_IX_DE_BC_HL_RET
E579                
E579 AF             	XOR	A
E57A 32 AB EC       	LD	(_FATIX),A
E57D 3A 88 EC       	LD	A,(_DRV)
E580 32 AA EC       	LD	(_FATDRV),A
E583 CD E5 EC       	CALL	_RDFAT
E586                RDFATE2:
E586 30 04          	JR	NC,POP_IX_DE_BC_HL_RET
E588 9F             	SBC	A,A		;A=0xFF
E589 32 AA EC       	LD	(_FATDRV),A
E58C                POP_IX_DE_BC_HL_RET:
E58C DD E1          	POP	IX
E58E 18 D4          	JR	POP_DE_BC_HL_RET2
E590                
E590                WTFATX:
E590 3A A2 EC       	LD	A,(_WTFATF)
E593 B7             	OR	A
E594 C8             	RET	Z
E595 E5             	PUSH	HL
E596 3A AA EC       	LD	A,(_FATDRV)
E599 21 A5 EC       	LD	HL,_DBDRV
E59C AE             	XOR	(HL)
E59D CC 46 E5       	CALL	Z,DWTX
E5A0 38 A2          	JR	C,POP_HL_RET
E5A2 C5             	PUSH	BC
E5A3 D5             	PUSH	DE
E5A4 DD E5          	PUSH	IX
E5A6 CD F1 E7       	CALL	WTFAT
E5A9 AF             	XOR	A
E5AA 32 A2 EC       	LD	(_WTFATF),A
E5AD 18 DD          	JR	POP_IX_DE_BC_HL_RET
E5AF                
E5AF                NCL1:
E5AF 7A             	LD	A,D
E5B0 B3             	OR	E
E5B1 37             	SCF
E5B2 C8             	RET	Z
E5B3                
E5B3 7A             	LD	A,D
E5B4 E6 08          	AND	8		;DE(targetCluster >= 0x800)
E5B6                N16CL1X:
E5B6 E5             	PUSH	HL
E5B7 32 D6 E5       	LD	(NCLPAT+2),A	;_FATIX
E5BA 2A AA EC       	LD	HL,(_FATDRV)	;L=_FATDRV H=_FATIX
E5BD BC             	CP	H
E5BE 3A 88 EC       	LD	A,(_DRV)	;この間でフラグは変化しない
E5C1 32 D5 E5       	LD	(NCLPAT+1),A	;_FATDRV
E5C4 20 05          	JR	NZ,NCL2		;FATIXが違う
E5C6 BD             	CP	L
E5C7 20 02          	JR	NZ,NCL2		;ドライブが違う
E5C9 E1             	POP	HL
E5CA C9             	RET
E5CB                NCL2:
E5CB C5             	PUSH	BC
E5CC D5             	PUSH	DE
E5CD DD E5          	PUSH	IX
E5CF CD 90 E5       	CALL	WTFATX
E5D2 38 B8          	JR	C,POP_IX_DE_BC_HL_RET
E5D4 01 00 00       NCLPAT:	LD	BC,0		;自己書き換え C=_FATDRV B=_FATIX
E5D7 ED 43 AA EC    	LD	(_FATDRV),BC
E5DB CD C1 E7       	CALL	RDFATS
E5DE 18 A6          	JR	RDFATE2
E5E0                
E5E0                NCL3:
E5E0 CB 9A          	RES	3,D
E5E2 6B             	LD	L,E
E5E3 62             	LD	H,D
E5E4 CB 3C          	SRL	H	;
E5E6 CB 1D          	RR	L	;HLA=HLA/2
E5E8 1F             	RRA		;
E5E9 ED 4B 7C EC    	LD	BC,(_FATBF)
E5ED 19             	ADD	HL,DE
E5EE 09             	ADD	HL,BC
E5EF 17             	RLA
E5F0 C9             	RET
E5F1                
E5F1                N16CL1:
E5F1 7A             	LD	A,D
E5F2 B3             	OR	E
E5F3 37             	SCF
E5F4 C8             	RET	Z
E5F5                
E5F5 7A             	LD	A,D
E5F6 CB 3F          	SRL	A	;/2
E5F8 CB 3F          	SRL	A	;/2
E5FA 18 BA          	JR	N16CL1X
E5FC                
E5FC                GNCL:
E5FC CD AF E5       	CALL	NCL1		;GET NEXT CLUSTER
E5FF D8             	RET	C
E600 C5             	PUSH	BC
E601 E5             	PUSH	HL
E602 CD E0 E5       	CALL	NCL3
E605 38 09          	JR	C,GNC1
E607 5E             	LD	E,(HL)
E608 23             	INC	HL
E609 7E             	LD	A,(HL)
E60A E6 0F          	AND	00FH
E60C 57             	LD	D,A
E60D E1             	POP	HL
E60E C1             	POP	BC
E60F C9             	RET
E610                GNC1:
E610 7E             	LD	A,(HL)
E611 23             	INC	HL
E612 56             	LD	D,(HL)
E613 06 04          	LD	B,4
E615                GNC1L:
E615 CB 3A          	SRL	D	;DA=DA/2
E617 1F             	RRA		;
E618 10 FB          	DJNZ	GNC1L
E61A                
E61A 5F             	LD	E,A
E61B E1             	POP	HL
E61C C1             	POP	BC
E61D A7             	AND	A
E61E C9             	RET
E61F                
E61F                SNCL:
E61F CD AF E5       	CALL	NCL1
E622 D8             	RET	C
E623                ;				SET NEXT CLUSTER
E623 E5             	PUSH	HL
E624 C5             	PUSH	BC
E625 D5             	PUSH	DE
E626 E5             	PUSH	HL
E627 CD E0 E5       	CALL	NCL3
E62A D1             	POP	DE
E62B                ;CF=ODD
E62B 7E             	LD	A,(HL)
E62C 73             	LD	(HL),E
E62D 38 06          	JR	C,SNC1
E62F                ;EVEN
E62F                ;M[0] = E
E62F                ;M[1] = (M[1] & 0xF0) | (D & 0x0F)
E62F 23             	INC	HL
E630 ED 67          	RRD		;M={A[3:0],E[3:0]}
E632 7A             	LD	A,D
E633 18 04          	JR	SNC11
E635                SNC1:
E635                ;ODD
E635                ;HL[0] = (HL[0]&0x0F) | (E<<4)
E635                ;HL[1] = DE>>4
E635 ED 6F          	RLD		;M={D[3:0],E[7:4]}
E637 23             	INC	HL
E638 72             	LD	(HL),D	;M={D[3:0],E[7:4]}
E639                SNC11:
E639 ED 6F          	RLD		;M={M[7:4],D[3:0]}
E63B B7             	OR	A
E63C D1             	POP	DE
E63D C1             	POP	BC
E63E E1             	POP	HL
E63F                FAT_CHANGED:
E63F 3E 01          	LD	A,1
E641 32 A2 EC       	LD	(_WTFATF),A
E644 C9             	RET
E645                
E645                N16CL3:
E645 C5             	PUSH	BC
E646 6B             	LD	L,E
E647 7A             	LD	A,D
E648 E6 03          	AND	3
E64A 67             	LD	H,A
E64B 29             	ADD	HL,HL
E64C ED 4B 7C EC    	LD	BC,(_FATBF)
E650 09             	ADD	HL,BC
E651 C1             	POP	BC
E652 C9             	RET
E653                
E653                GNCL16:
E653 CD F1 E5       	CALL	N16CL1		;GET NEXT CLUSTER for FAT16
E656 D8             	RET	C
E657 E5             	PUSH	HL
E658 CD 45 E6       	CALL	N16CL3
E65B 5E             	LD	E,(HL)
E65C 23             	INC	HL
E65D 56             	LD	D,(HL)
E65E E1             	POP	HL
E65F C9             	RET
E660                
E660                SNCL16:
E660 CD F1 E5       	CALL	N16CL1		;GET NEXT CLUSTER for FAT16
E663 D8             	RET	C
E664 D5             	PUSH	DE
E665 E5             	PUSH	HL
E666 CD 45 E6       	CALL	N16CL3
E669 D1             	POP	DE		;HL
E66A 73             	LD	(HL),E
E66B 23             	INC	HL
E66C 72             	LD	(HL),D
E66D 6B             	LD	L,E
E66E 62             	LD	H,D
E66F D1             	POP	DE
E670 18 CD          	JR	FAT_CHANGED
E672                
E672                ;------------------------
E672                ;次のセクタを探す際に_SECPSの値をチェック
E672                ;in
E672                ;	DE : セクタ番号
E672                ;out
E672                ;	DE : 次のセクタ番号
E672                ;note
E672                ;
E672                ;------------------------
E672                NEXTX:
E672 3E 00          _SECPS:	LD	A,0
E674 3C             	INC	A
E675 E6 00          NCPAT:	AND	0	;自己書き換え　1クラスタの論理セクタ数-1
E677 32 73 E6       	LD	(_SECPS+1),A
E67A C9             	RET
E67B                
E67B                GNCLX:
E67B CD 72 E6       	CALL	NEXTX
E67E C0             	RET	NZ	;1クラスタのセクタ未満の場合は戻る
E67F C3 F7 EC       	JP	_GNCL	;次のクラスタを探す
E682                
E682                RDFAT:
E682 3E 80          	LD	A,080H
E684 32 70 EB       	LD	(CHECK),A
E687                RDFAT1:
E687 3A 88 EC       	LD	A,(_DRV)
E68A CD 3C E9       	CALL	CHGDRVR
E68D D8             	RET	C
E68E DD 7E 12       	LD	A,(IX+012H)	;DPB_12_DEVICE
E691 CB 6F          	BIT	5,A
E693 28 43          	JR	Z,RDFAT0X
E695 21 70 EB       	LD	HL,CHECK
E698 A6             	AND	(HL)
E699 77             	LD	(HL),A
E69A 11 00 00       	LD	DE,0		;BPB
E69D 2A 7C EC       	LD	HL,(_FATBF)
E6A0 CD D2 E7       	CALL	DRD16
E6A3 30 24          	JR	NC,GETBPB
E6A5 21 70 EB       	LD	HL,CHECK
E6A8 CB 06          	RLC	(HL)
E6AA 3F             	CCF
E6AB D8             	RET	C
E6AC DD CB 0A 1E    	RR	(IX+00AH)	;DPB_0A_FDMODE
E6B0 3F             	CCF			;フロッピーディスクのMFMモードを切り替える
E6B1 DD CB 0A 16    	RL	(IX+00AH)	;DPB_0A_FDMODE
E6B5 3E FF          	LD	A,0FFH
E6B7 32 89 EC       	LD	(_DSK),A
E6BA 3A 84 EC       	LD	A,(_DRIVE)
E6BD E6 03          	AND	3
E6BF F6 80          	OR	080H
E6C1 6F             	LD	L,A
E6C2 26 EC          	LD	H,_CYL0/256
E6C4 3E FF          	LD	A,0FFH
E6C6 77             	LD	(HL),A
E6C7 18 BE          	JR	RDFAT1
E6C9                GETBPB:
E6C9 FD E5          	PUSH	IY
E6CB FD 2A 7C EC    	LD	IY,(_FATBF)	;BPB
E6CF CD F1 EC       	CALL	_BPB2DPB
E6D2 FD E1          	POP	IY
E6D4 D8             	RET	C
E6D5 CD 8E E8       	CALL	CHGDRV2
E6D8                RDFAT0X:
E6D8 CD C1 E7       	CALL	RDFATS
E6DB D8             	RET	C
E6DC DD BE 06       	CP	(IX+6)		;DPB_06_FATID
E6DF C8             	RET	Z
E6E0 DD CB 12 6E    	BIT	5,(IX+012H)	;DPB_12_DEVICE
E6E4 C0             	RET	NZ		;BPBを取得している場合はFATIDをチェックしない
E6E5 37             	SCF
E6E6 C9             	RET
E6E7                
E6E7                BPB2DPB:
E6E7 FD 7E 00       	LD	A,(IY+0)	;BS_JmpBoot
E6EA FE EB          	CP	0EBH		;Short jump
E6EC 28 08          	JR	Z,BPBOK
E6EE FE E9          	CP	0E9H		;Near jump
E6F0 28 04          	JR	Z,BPBOK
E6F2 FE 60          	CP	060H		;X68k
E6F4 37             	SCF
E6F5 C0             	RET	NZ
E6F6                BPBOK:
E6F6 FD 7E 0D       	LD	A,(IY+13)	;BPB_SecPerClus
E6F9 DD 77 07       	LD	(IX+7),A	;DPB_07_SECPCL
E6FC                
E6FC FD 7E 16       	LD	A,(IY+22)	;BPB_FATSz16
E6FF DD 77 00       	LD	(IX+0),A	;DPB_00_FATLN
E702 FD 7E 17       	LD	A,(IY+23)	;BPB_FATSz16
E705 DD 77 01       	LD	(IX+1),A	;DPB_00_FATLN
E708                
E708 FD 6E 0E       	LD	L,(IY+14)	;BPB_RsvdSecCnt
E70B FD 66 0F       	LD	H,(IY+15)
E70E DD 75 0E       	LD	(IX+00EH),L	;DPB_0E_FATPS
E711 FD 5E 16       	LD	E,(IY+22)	;BPB_FATSz16
E714 FD 56 17       	LD	D,(IY+23)
E717 FD 46 10       	LD	B,(IY+16)	;BPB_NumFATs
E71A                BPBDP1:				;BPB_FATSz16 * BPB_NumFATs
E71A 19             	ADD	HL,DE
E71B 10 FD          	DJNZ	BPBDP1
E71D                BPBDP2:
E71D DD 75 10       	LD	(IX+010H),L	;DPB_10_DIRPS
E720 DD 74 11       	LD	(IX+011H),H
E723 E5             	PUSH	HL
E724                
E724 FD 6E 11       	LD	L,(IY+17)	;BPB_RootEntCnt
E727 FD 66 12       	LD	H,(IY+18)
E72A FD 7E 0C       	LD	A,(IY+12)	;BPB_BytsPerSec
E72D 06 06          	LD	B,6
E72F                BPBBPS1:
E72F 05             	DEC	B
E730 0F             	RRCA
E731 30 FC          	JR	NC,BPBBPS1
E733                BPBDE1:
E733 29             	ADD	HL,HL
E734 10 FD          	DJNZ	BPBDE1
E736                
E736 7C             	LD	A,H
E737 DD 77 0B       	LD	(IX+00BH),A	;DPB_0B_DIRSCNT
E73A                
E73A D1             	POP	DE		;DPB_10_DIRPS
E73B 6C             	LD	L,H
E73C 26 00          	LD	H,0
E73E 19             	ADD	HL,DE		;MAXDIR
E73F E5             	PUSH	HL
E740 FD 4E 0D       	LD	C,(IY+13)	;BPB_SecPerClus
E743 CB 21          	SLA	C		;*2
E745 AF             	XOR	A
E746 47             	LD	B,A
E747 ED 42          	SBC	HL,BC
E749 DD 75 14       	LD	(IX+014H),L	;DPB_14_ADDCL16
E74C DD 74 15       	LD	(IX+015H),H
E74F                
E74F D1             	POP	DE		;DE=DPB_0B_MAXDIR
E750 FD 6E 13       	LD	L,(IY+19)	;BPB_TotSec16
E753 FD 66 14       	LD	H,(IY+20)
E756 7C             	LD	A,H
E757 B5             	OR	L
E758 3E 00          	LD	A,0		;LDでフラグは変化しない。BPB_TotSec16を AHL で扱う為、Aに0を入れる
E75A 20 10          	JR	NZ,BPB16BIT
E75C FD 7E 23       	LD	A,(IY+35)	;BPB_TotSec16が「0」の場合はBPB_TotSec32で計算
E75F B7             	OR	A
E760 37             	SCF
E761 C0             	RET	NZ		;念のため(総セクタ数が24ビットを超える場合)
E762 FD 6E 20       	LD	L,(IY+32)	;BPB_TotSec32 は AHL の24ビットで扱う
E765 FD 66 21       	LD	H,(IY+33)	;1クラスタの論理セクタ数(DPB_07_SECPCL)が最大128なので
E768 FD 7E 22       	LD	A,(IY+34)	;24ビットを超えると必ずクラスタ数が16ビットを超えてしまうのでこれで十分
E76B A7             	AND	A		;CF=0
E76C                BPB16BIT:
E76C ED 52          	SBC	HL,DE
E76E DE 00          	SBC	A,0
E770 FD 46 0D       	LD	B,(IY+13)	;BPB_SecPerClus
E773                BPBTC1:				;総クラスタ数(AHL) = 総セクタ数(AHL) / セクタサイズ(B)
E773 CB 18          	RR	B		;->CY
E775 38 08          	JR	C,BPBTC2
E777 CB 3F          	SRL	A
E779 CB 1C          	RR	H		;AHL=AHL/2
E77B CB 1D          	RR	L
E77D 18 F4          	JR	BPBTC1
E77F                BPBTC2:
E77F B7             	OR	A
E780 37             	SCF
E781 C0             	RET	NZ		;念のため(クラスタ数が16ビットを超える場合)
E782 23             	INC	HL
E783 23             	INC	HL
E784 DD 75 08       	LD	(IX+8),L	;DPB_08_MAXCL
E787 DD 74 09       	LD	(IX+9),H
E78A                
E78A FD 7E 15       	LD	A,(IY+21)	;BPB_Media
E78D DD 77 06       	LD	(IX+6),A	;DPB_06_FATID
E790                
E790 DD CB 0A 7E    	BIT	7,(IX+00AH)	;DPB_0A_FDMODE
E794 28 17          	JR	Z,NOT_FD
E796 2E 28          	LD	L,40		;MAXCYLの設定（要検討）ここから下はフロッピーのみ書き換える
E798 FE FD          	CP	0FDH	;2D
E79A 28 08          	JR	Z,SETCYL
E79C 2E 4D          	LD	L,77
E79E FE FE          	CP	0FEH	;2HD
E7A0 28 02          	JR	Z,SETCYL
E7A2 2E 50          	LD	L,80	;その他2DD等
E7A4                SETCYL:
E7A4 DD 75 0C       	LD	(IX+00CH),L	;DPB_0C_MAXCYL
E7A7 FD 7E 18       	LD	A,(IY+24)	;BPB_SecPerTr
E7AA DD 77 0D       	LD	(IX+00DH),A	;DPB_0D_MAXSEC	;ここまでフロッピー専用
E7AD                NOT_FD:
E7AD FD 7E 10       	LD	A,(IY+16)	;BPB_NumFATs
E7B0 FE 02          	CP	2		;>2:NC
E7B2 FD 7E 0C       	LD	A,(IY+12)	;BPB_BytsPerSec
E7B5 38 02          	JR	C,BPBFAT1
E7B7 F6 80          	OR	080H
E7B9                BPBFAT1:
E7B9 DD 77 0F       	LD	(IX+00FH),A	;DPB_0F_BPS
E7BC                
E7BC E6 7F          	AND	07FH		;セクタバッファが1KBしかないので1KBを超える場合はCF=1でエラーにする
E7BE C6 FB          	ADD	A,0-5		;0-4:NC 5以上:C
E7C0 C9             	RET
E7C1                
E7C1                RDFATS:
E7C1 CD 13 E8       	CALL	FATSETUP
E7C4 D8             	RET	C
E7C5                RDFATL:
E7C5 C5             	PUSH	BC
E7C6 CD D2 E7       	CALL	DRD16
E7C9 C1             	POP	BC
E7CA D8             	RET	C
E7CB 10 F8          	DJNZ	RDFATL
E7CD 2A 7C EC       	LD	HL,(_FATBF)
E7D0 7E             	LD	A,(HL)
E7D1 C9             	RET
E7D2                
E7D2                DRD16:
E7D2 0E 00          	LD	C,0
E7D4                DRD24:
E7D4 06 01          	LD	B,1
E7D6 DD E5          	PUSH	IX
E7D8 DD 2A A8 EC    	LD	IX,(_DPB)
E7DC CD 5B EA       DRDPAT:	CALL	FDRD		;自己書き換え（ディスク読み込み）
E7DF                POP_IX_RET:
E7DF DD E1          	POP	IX
E7E1 C9             	RET
E7E2                
E7E2                DWT16:
E7E2 0E 00          	LD	C,0
E7E4                DWT24:
E7E4 06 01          	LD	B,1
E7E6 DD E5          	PUSH	IX
E7E8 DD 2A A8 EC    	LD	IX,(_DPB)
E7EC CD 4D EA       DWTPAT:	CALL	FDWT		;自己書き換え（ディスク書き込み）
E7EF 18 EE          	JR	POP_IX_RET
E7F1                
E7F1                WTFAT:
E7F1 CD 13 E8       	CALL	FATSETUP
E7F4 D4 0A E8       	CALL	NC,WTFATL
E7F7 D8             	RET	C
E7F8 DD CB 0F 7E    	BIT	7,(IX+00FH)	;DPB_0F_BPS
E7FC C8             	RET	Z		;予備FATが無い
E7FD CD 1A E8       	CALL	FATS2
E800 E5             	PUSH	HL		;予備FAT
E801 DD 6E 00       	LD	L,(IX+0)	;DPB_00_FATLN
E804 DD 66 01       	LD	H,(IX+1)
E807 19             	ADD	HL,DE
E808 EB             	EX	DE,HL
E809 E1             	POP	HL
E80A                WTFATL:
E80A C5             	PUSH	BC
E80B CD E2 E7       	CALL	DWT16
E80E C1             	POP	BC
E80F D8             	RET	C
E810 10 F8          	DJNZ	WTFATL
E812 C9             	RET
E813                ;------------------------
E813                ;FATのセットアップ
E813                ;out
E813                ;	B  : FATセクタ数
E813                ;	DE : FAT先頭セクタ番号
E813                ;	HL : FATバッファポインタ
E813                ;	CF : 1=ドライブ切り替えエラー
E813                ;note
E813                ;	FATサイズがFATバッファを超える場合は
E813                ;	対象クラスタ領域==(_FATIX)によって
E813                ;	FAT12:FATの前半3KBと後半3KBを切り替える
E813                ;	FAT16:対象クラスタ1024毎に2KBを切り替える
E813                ;------------------------
E813                FATSETUP:
E813 3A AA EC       	LD	A,(_FATDRV)
E816 CD 3C E9       	CALL	CHGDRVR		;ドライブ切り替え
E819 D8             	RET	C
E81A                FATS2:
E81A ED 5B FA EB    	LD	DE,(_FATPS)	;fat sector pos
E81E C3 21 E8       FATSX:	JP	FATSETUP12	;自己書き換え
E821                
E821                FATSETUP12:
E821 2A 7C EC       	LD	HL,(_FATBF)
E824 3E 18          	LD	A,24		;3072 / 256 FATバッファに読み込めるセクタ数
E826 DD 46 0F       	LD	B,(IX+00FH)	;DPB_0F_BPS
E829                L_FATS2:
E829 1F             	RRA			;CF=0 なので A=A/2
E82A CB 18          	RR	B		;->CF
E82C 30 FB          	JR	NC,L_FATS2
E82E                
E82E DD 46 00       	LD	B,(IX+0)	;DPB_00_FATLN
E831 B8             	CP	B
E832 D0             	RET	NC		;DPB_00_FATLN x sectorSize < fatBufSize
E833                ;targetCluster
E833 4F             	LD	C,A		;C = skipCount
E834 3A AB EC       	LD	A,(_FATIX)	;(targetCluster >= 0x800)
E837 B7             	OR	A
E838 28 06          	JR	Z,FATS3
E83A                ;(targerCluster>=0x800)
E83A                FAT_SKP:
E83A 13             	INC	DE		;FATPS++
E83B 05             	DEC	B		;FATSIZE--
E83C 0D             	DEC	C		;skipCnt--
E83D 20 FB          	JR	NZ,FAT_SKP
E83F 48             	LD	C,B
E840                FATS3:
E840 41             	LD	B,C		;3 or 6 or 12
E841 AF             	XOR	A
E842 C9             	RET
E843                
E843                FATSETUP16:
E843 DD 7E 0F       	LD	A,(IX+00FH)	;DPB_0F_BPS 512=2 1024=4
E846 06 10          	LD	B,16		;2048 / 256 FATバッファに読み込むセクタ数 512=4/1024=2
E848 67             	LD	H,A		;DPB_0F_BPS
E849                L_F16S2:
E849 CB 38          	SRL	B		;/2
E84B 1F             	RRA			;->CF
E84C 30 FB          	JR	NC,L_F16S2
E84E                
E84E 7C             	LD	A,H		;DPB_0F_BPS
E84F 2A AB EC       	LD	HL,(_FATIX)	;範囲は0-63(0-03FH):65535*2/2048
E852 26 00          	LD	H,0
E854 4D             	LD	C,L		;_FATIX
E855                L_F16S3:
E855 29             	ADD	HL,HL
E856 87             	ADD	A,A
E857 CB 5F          	BIT	3,A
E859 28 FA          	JR	Z,L_F16S3
E85B                
E85B 19             	ADD	HL,DE
E85C EB             	EX	DE,HL
E85D                
E85D 79             	LD	A,C		;_FATIX
E85E DD 6E 00       	LD	L,(IX+0)	;DPB_00_FATLN
E861 2D             	DEC	L		;DPB_00_FATLN-1
E862 AD             	XOR	L		;Lと同じか比較してCFを0に
E863 20 05          	JR	NZ,F16E		;FATバッファが最後の場合はFATセクタ数を調整
E865 7D             	LD	A,L		;DPB_00_FATLN-1
E866 05             	DEC	B
E867 A0             	AND	B
E868 47             	LD	B,A
E869 04             	INC	B
E86A                F16E:
E86A 2A 7C EC       	LD	HL,(_FATBF)
E86D C9             	RET
E86E                
E86E                CHGDRV:
E86E E5             	PUSH	HL
E86F 21 89 EC       	LD	HL,_DSK
E872 BE             	CP	(HL)
E873 28 0A          	JR	Z,CHGDRVE
E875                CHGDRV1:
E875 DD E5          	PUSH	IX
E877 CD 81 E8       	CALL	CHGDRV0
E87A 3A 89 EC       	LD	A,(_DSK)
E87D DD E1          	POP	IX
E87F                CHGDRVE:
E87F E1             	POP	HL
E880 C9             	RET
E881                
E881                CHGDRV0:
E881 6F             	LD	L,A
E882 CD DC EC       	CALL	_GETDPB
E885 D8             	RET	C
E886 DD 22 A8 EC    	LD	(_DPB),IX
E88A 7D             	LD	A,L
E88B 32 89 EC       	LD	(_DSK),A
E88E                CHGDRV2:
E88E F3             	DI
E88F C5             	PUSH	BC
E890 D5             	PUSH	DE
E891 ED 73 F1 E8    	LD	(SPPAT2+1),SP
E895                
E895 DD F9          	LD	SP,IX
E897                
E897 E1             	POP	HL		;DPB_00_FATLN
E898 E1             	POP	HL		;DPB_02_DRD
E899 22 DD E7       	LD	(DRDPAT+1),HL
E89C                
E89C E1             	POP	HL
E89D 22 ED E7       	LD	(DWTPAT+1),HL	;DPB_04_DWT
E8A0                
E8A0 E1             	POP	HL		;L=DPB_06_FATID H=DPB_07_SECPCL
E8A1 7C             	LD	A,H
E8A2 32 51 DF       	LD	(SPCPAT+1),A	;1クラスタの論理セクタ数
E8A5 3D             	DEC	A
E8A6 32 76 E6       	LD	(NCPAT+1),A
E8A9                
E8A9 E1             	POP	HL		;DPB_08_MAXCL
E8AA 7D             	LD	A,L
E8AB 32 70 DF       	LD	(CLPAT2+1),A
E8AE 7C             	LD	A,H
E8AF 32 6C DF       	LD	(CLPAT1+1),A
E8B2 2B             	DEC	HL
E8B3 22 70 E1       	LD	(MAXCLP+1),HL
E8B6                
E8B6 E1             	POP	HL		;L=DPB_0A_FDMODE H=DPB_0B_DIRSCNT
E8B7 7D             	LD	A,L
E8B8 F6 FE          	OR	0FEH
E8BA 32 F6 E9       	LD	(FDMODE+1),A
E8BD 07             	RLCA
E8BE E6 03          	AND	3
E8C0 32 DE E9       	LD	(FSPAT+1),A
E8C3 4C             	LD	C,H
E8C4                
E8C4 E1             	POP	HL		;L=DPB_0C_MAXCYL H=DPB_0D_MAXSEC
E8C5 7D             	LD	A,L
E8C6 32 A1 EC       	LD	(_MAXCYL),A
E8C9 7C             	LD	A,H
E8CA 32 87 E9       	LD	(MAXSEC+1),A
E8CD                
E8CD E1             	POP	HL		;L=DPB_0E_FATPS H=DPB_0F_BPS
E8CE 7C             	LD	A,H		;DPB_0F_BPS
E8CF E6 07          	AND	7
E8D1 32 8D E4       	LD	(SECSZ+2),A	;1セクタのサイズの上位1バイト 0x400 - 0x200 - 0x100
E8D4                				;1セクタ512 2D/2DD/2HC/2HQ(2HD1.44MB)等
E8D4                				;1セクタ1024 2HD/EMM/BRAM
E8D4                				;1セクタ256 GRAM等
E8D4                				;1024	512	256
E8D4                				;4	2	1
E8D4 87             	ADD	A,A		;8	4	2
E8D5 87             	ADD	A,A		;010H	8	4
E8D6 87             	ADD	A,A		;020H	010H	8
E8D7 32 C0 DD       	LD	(SDECPAT+1),A	;1セクタ辺りのディレクトリエントリ数
E8DA 3D             	DEC	A		;01FH	00FH	7
E8DB 32 38 D4       	LD	(SDECM1+1),A	;1セクタ辺りのディレクトリエントリ数-1
E8DE                
E8DE 26 00          	LD	H,0
E8E0 22 FA EB       	LD	(_FATPS),HL
E8E3                
E8E3 E1             	POP	HL		;L=DPB_10_DIRPS
E8E4 22 FC EB       	LD	(_DIRPS),HL
E8E7                
E8E7 E1             	POP	HL		;L=DPB_12_DEVICE H=DPB_13_UNITNO
E8E8 7C             	LD	A,H
E8E9 32 84 EC       	LD	(_DRIVE),A
E8EC                
E8EC E1             	POP	HL		;DPB_14_ADDCL16
E8ED 22 61 DF       	LD	(CLSPAT+1),HL
E8F0                
E8F0 31 00 00       SPPAT2:	LD	SP,0		;元のSPを復元
E8F3 FB             	EI
E8F4 2A FC EB       	LD	HL,(_DIRPS)
E8F7 06 00          	LD	B,0
E8F9 09             	ADD	HL,BC
E8FA 22 DB DD       	LD	(MD_PAT+1),HL
E8FD                
E8FD 2A 70 E1       	LD	HL,(MAXCLP+1);
E900 11 F6 0F       	LD	DE,4086
E903 B7             	OR	A
E904 ED 52          	SBC	HL,DE
E906 30 0F          	JR	NC,SETFAT16
E908 21 FC E5       	LD	HL,GNCL		;FAT12
E90B 11 1F E6       	LD	DE,SNCL
E90E 01 21 E8       	LD	BC,FATSETUP12
E911 DD CB 0F AE    	RES	5,(IX+00FH)	;DPB_0F_BPS(FAT12)
E915 18 0D          	JR	EXTRA1
E917                SETFAT16:
E917 21 53 E6       	LD	HL,GNCL16	;FAT16
E91A 11 60 E6       	LD	DE,SNCL16
E91D 01 43 E8       	LD	BC,FATSETUP16
E920 DD CB 0F EE    	SET	5,(IX+00FH)	;DPB_0F_BPS(FAT16)
E924                EXTRA1:
E924 22 F8 EC       	LD	(GNCPAT+1),HL
E927 ED 53 FB EC    	LD	(SNCPAT+1),DE
E92B ED 43 1F E8    	LD	(FATSX+1),BC
E92F D1             	POP	DE
E930 C1             	POP	BC
E931 AF             	XOR	A
E932 C9             	RET
E933                
E933                GETDPBD:
E933 DD E3          	EX	(SP),IX
E935 DD E5          	PUSH	IX
E937 3A 88 EC       	LD	A,(_DRV)
E93A 18 07          	JR	GETDPB1
E93C                
E93C                CHGDRVR:
E93C CD D9 EC       	CALL	_CHGDRV
E93F D8             	RET	C
E940 3A 89 EC       	LD	A,(_DSK)
E943                GETDPB1:
E943 C3 DC EC       	JP	_GETDPB
E946                
E946                GETDPB:
E946 FE 08          	CP	8
E948 3F             	CCF
E949 D8             	RET	C
E94A 0F             	RRCA
E94B 0F             	RRCA
E94C 0F             	RRCA
E94D DD             	DB	0DDH		;Z80未定義命令
E94E 6F             	LD	L,A		;LD	IXL,A
E94F DD             	DB	0DDH		;Z80未定義命令
E950 26 ED          	LD	H,DEVICE/256	;LD	IXH,DEVICE/256
E952 DD 7E 00       	LD	A,(IX+0)	;DPB_00_FATLN
E955 B7             	OR	A		;CF=0の為
E956 DD CB 0F 76    	BIT	6,(IX+00FH)	;DPB_0F_BPS
E95A C0             	RET	NZ		;FAT16
E95B DD CB 12 6E    	BIT	5,(IX+012H)	;DPB_12_DEVICE
E95F C0             	RET	NZ		;BPB
E960 FE 01          	CP	001H		;A=0 THEN CF=1
E962 C9             	RET
E963                
E963                FFLUSH:
E963 F5             	PUSH	AF
E964 3E FF          	LD	A,0FFH
E966 32 39 EB       	LD	(SFILE),A
E969 CD 46 E5       	CALL	DWTX
E96C 3E FF          	LD	A,0FFH
E96E 32 A5 EC       	LD	(_DBDRV),A
E971 CD 90 E5       	CALL	WTFATX
E974 AF             	XOR	A
E975 32 AB EC       	LD	(_FATIX),A
E978 2F             	CPL
E979 32 AA EC       	LD	(_FATDRV),A
E97C F1             	POP	AF
E97D C9             	RET
E97E                
E97E                	INCLUDE	"LDDISK.ASM"
E97E                
E97E                ;	LSX-Dodgers DISK
E97E                
E97E                
E97E                SEEK:
E97E 7A             	LD	A,D
E97F B3             	OR	E
E980 3E 01          	LD	A,001H
E982 28 11          	JR	Z,DIV3
E984                
E984 06 10          	LD	B,16
E986 0E 00          MAXSEC:	LD	C,000H
E988 AF             	XOR	A
E989 EB             	EX	DE,HL
E98A                DIV1:
E98A 29             	ADD	HL,HL
E98B 8F             	ADC	A,A
E98C B9             	CP	C
E98D 38 02          	JR	C,DIV2
E98F 91             	SUB	C
E990 2C             	INC	L
E991                DIV2:
E991 10 F7          	DJNZ	DIV1
E993                
E993 3C             	INC	A	;最小のセクタは１固定
E994 55             	LD	D,L	;Quotient(TRACK)
E995                DIV3:
E995 5F             	LD	E,A	;Remainder
E996 CB 3A          	SRL	D	;CYLINDER
E998 9F             	SBC	A,A
E999 E6 10          	AND	010H	;SIDE
E99B 4F             	LD	C,A
E99C                
E99C 3A 84 EC       	LD	A,(_DRIVE)
E99F FE 04          	CP	4
E9A1 3F             	CCF
E9A2 D8             	RET	C
E9A3 B1             	OR	C
E9A4 32 22 EA       	LD	(MOPAT+1),A	;Motor off data
E9A7 01 FC 0F       	LD	BC,00FFCH
E9AA F6 80          	OR	080H		;Mortor on
E9AC ED 79          	OUT	(C),A
E9AE                
E9AE CD F4 E9       	CALL	SETMODE
E9B1 D8             	RET	C
E9B2                
E9B2 CD 37 EA       	CALL	DRIVE
E9B5 FE FF          	CP	0FFH		;A=0FFH Unknown CYLINDER
E9B7 CC 16 EA       	CALL	Z,FDCRES	;Restore
E9BA 0E F9          	LD	C,0F9H
E9BC ED 79          	OUT	(C),A		;Currrent CYLINDER
E9BE 92             	SUB	D
E9BF C8             	RET	Z		;No seek
E9C0                
E9C0 3A 86 EC       	LD	A,(_ISEEK)
E9C3 4F             	LD	C,A
E9C4                
E9C4 3A A1 EC       	LD	A,(_MAXCYL)	;Max CYLINDER
E9C7 3D             	DEC	A
E9C8 BA             	CP	D		;Over CYLINDER
E9C9 D8             	RET	C
E9CA                
E9CA B9             	CP	C		;for Built-in 2DD
E9CB 38 03          	JR	C,SETM2
E9CD 78             	LD	A,B		;B=00FH
E9CE DB FE          	IN	A,(0FEH)		;2HD mode for 2DD seek
E9D0                SETM2:
E9D0 78             	LD	A,B
E9D1 DB FD          	IN	A,(0FDH)		;MFM mode
E9D3                
E9D3 0E FB          	LD	C,0FBH
E9D5 ED 51          	OUT	(C),D
E9D7 72             	LD	(HL),D
E9D8 0E 18          	LD	C,018H		;Seek
E9DA                FDCCMD2:
E9DA 3A 85 EC       	LD	A,(_SEEKSP)
E9DD E6 FF          FSPAT:	AND	0FFH
E9DF B1             	OR	C
E9E0                
E9E0                FDCCMD:
E9E0 CD 2D EA       	CALL	COMSET
E9E3                
E9E3 3E 80          FDCPAT:	LD	A,080H		;FDC COMMAND(Self-rewriting)
E9E5 E6 20          	AND	020H		;Write data Write track
E9E7 3C             	INC	A
E9E8                
E9E8                SST:
E9E8 0E 00          	LD	C,0
E9EA                SST1:
E9EA 0D             	DEC	C		; 4
E9EB 20 FD          	JR	NZ,SST1		;12 * 256 / 4 = About 1ms
E9ED 3D             	DEC	A
E9EE 20 FA          	JR	NZ,SST1
E9F0                
E9F0 3C             	INC	A		;A=1
E9F1 CD FF E9       	CALL	READY
E9F4                SETMODE:
E9F4 78             	LD	A,B		;B=00FH
E9F5 DB FF          FDMODE:	IN	A,(0FFH)		;Floppy mode(2D/2HD) (Self-rewriting)
E9F7                
E9F7 78             	LD	A,B
E9F8 DB FD          	IN	A,(0FDH)		;MFM mode
E9FA                
E9FA CD 31 EA       	CALL	DELAY0		;Head select time
E9FD 3E 81          	LD	A,081H
E9FF                READY:
E9FF 32 09 EA       	LD	(WAITA+1),A
EA02 E5             	PUSH	HL
EA03 0E F8          	LD	C,0F8H
EA05 61             	LD	H,C
EA06                READY2:
EA06 ED 78          	IN	A,(C)
EA08 E6 81          WAITA:	AND	081H		;NOT READY,BUSY
EA0A 28 08          	JR	Z,READYE
EA0C E3             	EX	(SP),HL		;wait 19clock
EA0D E3             	EX	(SP),HL		; //
EA0E 2B             	DEC	HL
EA0F 7C             	LD	A,H
EA10 B5             	OR	L
EA11 20 F3          	JR	NZ,READY2
EA13 37             	SCF
EA14                READYE:
EA14 E1             	POP	HL
EA15 C9             	RET
EA16                
EA16                FDCRES:
EA16 36 00          	LD	(HL),0
EA18 0E 08          	LD	C,8
EA1A 18 BE          	JR	FDCCMD2
EA1C                
EA1C                FDMOFF:
EA1C F5             	PUSH	AF
EA1D C5             	PUSH	BC
EA1E 01 FC 0F       	LD	BC,00FFCH	;Motor off
EA21 3E 00          MOPAT:	LD	A,000H		;(Self-rewriting)
EA23 ED 79          	OUT	(C),A
EA25 C1             	POP	BC
EA26 F1             	POP	AF
EA27 C9             	RET
EA28                
EA28                SECSET:
EA28 01 FA 0F       	LD	BC,00FFAH
EA2B ED 59          	OUT	(C),E
EA2D                COMSET:
EA2D 0E F8          	LD	C,0F8H
EA2F ED 79          	OUT	(C),A
EA31                DELAY0:
EA31 3E 1A          	LD	A,26
EA33                DELAY:
EA33 3D             	DEC	A
EA34 20 FD          	JR	NZ,DELAY
EA36 C9             	RET
EA37                
EA37                DRIVE:
EA37 2A 84 EC       	LD	HL,(_DRIVE)
EA3A 26 EC          	LD	H,_CYL0/256
EA3C CB FD          	SET	7,L
EA3E 7E             	LD	A,(HL)
EA3F C9             	RET
EA40                
EA40                RNF:
EA40 CD 37 EA       	CALL	DRIVE
EA43 36 FF          	LD	(HL),0FFH
EA45 C9             	RET
EA46                
EA46 02             RETRY:	DB	2
EA47                
EA47                
EA47                ;	FLOPPY DISK DRIVER(DMA)
EA47                
EA47                
EA47                WTTRK:
EA47 06 01          	LD	B,1
EA49 3E F4          	LD	A,0F4H
EA4B 18 02          	JR	WTTRK1
EA4D                FDWT:
EA4D 3E A0          	LD	A,0A0H
EA4F                WTTRK1:
EA4F 32 E4 E9       	LD	(FDCPAT+1),A
EA52 3E 10          	LD	A,16
EA54 18 0C          	JR	DISK
EA56                
EA56                DISKOK:
EA56 06 01          FDCNT:	LD	B,1
EA58 10 0B          	DJNZ	DISK1
EA5A C9             	RET
EA5B                
EA5B                FDRD:
EA5B 3E 80          	LD	A,080H
EA5D 32 E4 E9       	LD	(FDCPAT+1),A
EA60 3E 0E          	LD	A,14
EA62                
EA62                DISK:
EA62 32 79 EA       	LD	(DMAPAT+1),A
EA65                DISK1:
EA65 78             	LD	A,B
EA66 32 57 EA       	LD	(FDCNT+1),A
EA69 22 FB EA       	LD	(DMAD+11),HL
EA6C                DISKR:
EA6C 3E 02          	LD	A,2		;Retry count
EA6E 32 46 EA       	LD	(RETRY),A
EA71                DISK2:
EA71 D5             	PUSH	DE
EA72 CD 7E E9       	CALL	SEEK
EA75 38 43          	JR	C,ERRF
EA77 F3             	DI
EA78                
EA78 3E 0E          DMAPAT:	LD	A,14		;自己書き換え
EA7A 21 F0 EA       	LD	HL,DMAD
EA7D CD 2E DB       	CALL	SETDMA
EA80 ED 49          	OUT	(C),C		;OUT 01F87H,087H WR6 イネーブル
EA82 3A E4 E9       	LD	A,(FDCPAT+1)
EA85 C5             	PUSH	BC
EA86 CD 28 EA       	CALL	SECSET
EA89 2A FB EA       	LD	HL,(DMAHL)
EA8C 23             	INC	HL
EA8D 11 06 BB       	LD	DE,0BB06H	;READ DMA
EA90                
EA90 3E 03          	LD	A,3
EA92 CD FF E9       	CALL	READY
EA95 ED 78          	IN	A,(C)
EA97                
EA97 C1             	POP	BC
EA98 ED 51          	OUT	(C),D		;読み出しマスク設定
EA9A ED 59          	OUT	(C),E		;バイトカウンタ(LH)
EA9C ED 58          	IN	E,(C)
EA9E ED 50          	IN	D,(C)
EAA0 19             	ADD	HL,DE
EAA1 D1             	POP	DE
EAA2 13             	INC	DE
EAA3 FB             	EI
EAA4 CD 1C EA       	CALL	FDMOFF
EAA7 B7             	OR	A
EAA8 28 AC          	JR	Z,DISKOK
EAAA 1B             	DEC	DE
EAAB CB 67          	BIT	4,A
EAAD C4 40 EA       	CALL	NZ,RNF
EAB0                DISKE2:
EAB0 21 46 EA       	LD	HL,RETRY
EAB3 35             	DEC	(HL)
EAB4 20 BB          	JR	NZ,DISK2
EAB6 B7             	OR	A
EAB7 28 34          	JR	Z,ERR
EAB9 D5             	PUSH	DE
EABA                ERRF:
EABA D1             	POP	DE
EABB                DELP:
EABB CD 40 EA       	CALL	RNF
EABE CD 1C EA       	CALL	FDMOFF
EAC1 3A 85 EC       	LD	A,(_SEEKSP)
EAC4 87             	ADD	A,A
EAC5 9F             	SBC	A,A
EAC6 38 25          	JR	C,ERR
EAC8                DELP1:
EAC8 D5             	PUSH	DE
EAC9 21 C0 EB       	LD	HL,DEMES
EACC CD 84 D3       	CALL	MSX
EACF CD 1F D7       	CALL	KEYBC
EAD2                DELP2:
EAD2 CD CA EC       	CALL	_INKEY
EAD5 28 FB          	JR	Z,DELP2
EAD7                
EAD7 D1             	POP	DE
EAD8 CD 72 DF       	CALL	CAP
EADB FE 52          	CP	'R'		;Retry
EADD CA 6C EA       	JP	Z,DISKR
EAE0 FE 49          	CP	'I'		;Ignore
EAE2 28 07          	JR	Z,IGNORE
EAE4 FE 41          	CP	'A'		;Abort
EAE6 20 E0          	JR	NZ,DELP1
EAE8 C3 00 EB       	JP	BOOT
EAEB                IGNORE:
EAEB 3E FF          	LD	A,0FFH
EAED                ERR:
EAED BF             	CP	A
EAEE 37             	SCF
EAEF C9             	RET
EAF0                
EAF0                			;X1turbo DISK DMA
EAF0 C3             DMAD:	DB	0C3H	;WR6 リセット
EAF1 7D             	DB	07DH	;WR0 ポートA→ポートB 転送
EAF2 FB 0F          	DW	00FFBH	;ポートA開始アドレス FDC データレジスタ
EAF4 FF FF          	DW	0FFFFH	;ブロック長(転送サイズ-1)
EAF6 2C             	DB	02CH	;WR1 ポートAアドレス固定 I/O
EAF7 10             	DB	010H	;WR2 ポートBインクリメント
EAF8 80             	DB	080H	;WR3
EAF9 92             	DB	092H	;WR5 WAIT RDY:LOW
EAFA 8D             	DB	08DH	;WR4 バイト ポートB開始アドレス(LH)
EAFB 00 00          DMAHL:	DW	0	;ポートB開始アドレス
EAFD CF             	DB	0CFH	;WR6 ロード
EAFE 01             	DB	001H	;WR0 ポートB←ポートB 転送
EAFF CF             	DB	0CFH	;WR6 ロード
EB00                
EB00                DMAE:
EB00                
EB00 00 00 1F 84    AT_R	EQU	WTTRK-AT_WTTRK
EB00                
EB00                	INCLUDE	"LDCALL.ASM"
EB00                
EB00                ;	LSX-Dodgers TABLES
EB00                ;
EB00                ;	CP/M互換BIOS
EB00                ;	BOOT:アドレス下位1バイトが0になるように
EB00                BOOT:
EB00 C3 00 00       	JP	0
EB03                _SYS00:		;(BDOS)プログラム終了
EB03                WBOOT:
EB03 C3 22 CC       	JP	WBOOT1
EB06                CONST_:
EB06 C3 D9 D7       	JP	CONSTX
EB09                _SYS07:		;(BDOS)コンソール直接入力
EB09                CONIN:
EB09 C3 80 D7       	JP	FLGET
EB0C                CONOUT:
EB0C C3 1F DA       	JP	CONOUT1
EB0F                
EB0F                DECBF:
EB0F                	DS	5
EB14 00             FDRV	DB	0
EB15                FNAME	DS	36
EB39                SFILE:	DS	33		;DRV FILENAME
EB5A                HLBUF:	DS	3		;Random record buffer
EB5D                
EB5D 00 00          LEFTX:	DW	0
EB5F 00 00          DTAX:	DW	0
EB61                
EB61 00 8E 01 00    BEEPD:	DB	0,08EH,1,0,00BH,0,00CH,010H
EB65 0B 00 0C 10
EB69 07 3E 08 10    	DB	007H,03EH,008H,010H,00DH,0,0FFH
EB6D 0D 00 FF
EB70                
EB70 00             CHECK:	DB	0
EB71                
EB71 4F 4B 24       OK:	DB	"OK$"
EB74 53 6B 69 70    SKIP:	DB	"Skip$"
EB78 24
EB79 45 72 72 6F    COMERM:	DB	"Error!$"
EB7D 72 21 24
EB80                
EB80                ;	CTRLTB:アドレス下位1バイトが080Hになるように
EB80                
EB80                CTRLTB:
EB80 5E D9 F8 D9    	DW	PRINTE,CTRL01,CTRL02,CTRL03
EB84 96 D9 E0 DA
EB88 DA DA C1 D9    	DW	CTRL04,CTRL05,CTRL06,CTRL07
EB8C B9 DA 40 DA
EB90 6A D9 87 D9    	DW	CTRL08,CTRL09,CTRL0A,CTRL0B
EB94 E3 DA FE D9
EB98 B6 DA E5 D9    	DW	CTRL0C,CTRL0D,CTRL0E,PRINTE
EB9C F8 DA 5E D9
EBA0 5E D9 5E D9    	DW	PRINTE,PRINTE,CTRL01,PRINTE
EBA4 F8 D9 5E D9
EBA8 5E D9 5E D9    	DW	PRINTE,PRINTE,PRINTE,PRINTE
EBAC 5E D9 5E D9
EBB0 5E D9 5E D9    	DW	PRINTE,PRINTE,CTRL0C,CTRL1B
EBB4 B6 DA 05 DA
EBB8 81 D9 6A D9    	DW	CTRL1C,CTRL1D,CTRL1E,CTRL1F
EBBC 74 D9 E3 DA
EBC0                
EBC0 03 07          DEMES:	DB	3,7
EBC2 44 65 76 69    	DB	"Device I/O Error",5,3
EBC6 63 65 20 49
EBCA 2F 4F 20 45
EBCE 72 72 6F 72
EBD2 05 03
EBD4 41 62 6F 72    	DB	"Abort Retry Ignore?",5,3,0
EBD8 74 20 52 65
EBDC 74 72 79 20
EBE0 49 67 6E 6F
EBE4 72 65 3F 05
EBE8 03 00
EBEA                
EBEA 16 17          SDDATA:	DB	22,23		;(FCB)ファイルを最後に変更した時刻
EBEC 14 15          	DB	20,21		;(FCB)ファイルを最後に変更した日付
EBEE 1A 1B          	DB	26,27		;(FCB)ファイルの先頭クラスタ
EBF0 10 11 12 13    	DB	16,17,18,19	;(FCB)ファイルのサイズ(バイト単位)
EBF4                SDDATAE:
EBF4                
EBF4                SCDIR:	DS	2		;+14 +15
EBF6                SFBPS:	DS	2		;FBPS
EBF8                SFNDF:	DS	2		;FILEN DIRF
EBFA                
EBFA 00 00          _FATPS:	DW	0
EBFC 00 00          _DIRPS:	DW	0
EBFE 00 00          _CLPS:	DW	0
EC00                
EC00                _PE:
EC00                
EC00                ;	LSX-Dodgers SYSTEM CALL
EC00                ;	STABLE:アドレス下位1バイトが0になるように
EC00                
EC00                STABLE:
EC00                ;0
EC00 03 EB 53 D7    	DW	_SYS00,_SYS01,_SYS02,_SYS03
EC04 5F D7 ED DD
EC08 73 D3 73 D3    	DW	_SYS04,_SYS05,_SYS06,_SYS07
EC0C 64 D7 09 EB
EC10 6C D7 75 D3    	DW	_SYS08,_SYS09,_SYS0A,_SYS0B
EC14 A5 D7 D1 D7
EC18 8A D3 90 D3    	DW	_SYS0C,_SYS0D,_SYS0E,_SYS0F
EC1C 9F D3 B2 D3
EC20                ;1
EC20 06 D4 58 D4    	DW	_SYS10,_SYS11,_SYS12,_SYS13
EC24 BE D4 F4 D4
EC28 FC D4 1A D5    	DW	_SYS14,_SYS15,_SYS16,_SYS17
EC2C 37 D5 2F D5
EC30 98 D5 9D D5    	DW	_SYS18,_SYS19,_SYS1A,_SYS1B
EC34 A2 D5 A8 D5
EC38 73 D3 CE D5    	DW	_SYS1C,_SYS1D,_SYS1E,_SYS1F
EC3C 73 D3 D2 D5
EC40                ;2
EC40 73 D3 6E D5    	DW	_SYS20,_SYS21,_SYS22,_SYS23
EC44 83 D5 D9 D5
EC48 F8 D5 73 D3    	DW	_SYS24,_ERROR,_SYS26,_SYS27
EC4C 72 E2 99 E3
EC50 83 D5 01 D6    	DW	_SYS28,_SYS29,_SYS2A,_SYS2B
EC54 E7 D7 ED DD
EC58 1B D8 ED DD    	DW	_SYS2C,_SYS2D,_SYS2E,_SYS2F
EC5C 73 D3 24 D6
EC60                ;3
EC60 1E D6          	DW	_SYS30
EC62                	INCLUDE	"LDWORK.ASM"
EC62                
EC62                ;	LSX-Dodgers WORK
EC62                
EC62 00 00 00 04    DDS	EQU	4
EC62                DDTB:
EC62 43 4F 4E 20    	DB	"CON "
EC66 4B D4          	DW	OPENDD
EC68 41 55 58 20    	DB	"AUX "
EC6C 4B D4          	DW	OPENDD
EC6E 50 52 4E 20    	DB	"PRN "
EC72 4B D4          	DW	OPENDD
EC74 4E 55 4C 20    	DB	"NUL "
EC78 4B D4          	DW	OPENDD
EC7A                
EC7A                	DS	2
EC7C 00 EE          _FATBF:	DW	FATBF
EC7E 00 FA          _DTBUF:	DW	DTBUF
EC80                
EC80                ;	_CYL0:アドレス下位1バイトが080Hになるように
EC80 FF             _CYL0:	DB	0FFH	;Cylinder
EC81 FF             _CYL1:	DB	0FFH	;Cylinder
EC82 FF             _CYL2:	DB	0FFH	;Cylinder
EC83 FF             _CYL3:	DB	0FFH	;Cylinder
EC84 00             _DRIVE:	DB	0	;unit number
EC85 00             _SEEKSP:DB	0	;Seek speed
EC86 FF             _ISEEK:	DB	0FFH	;
EC87 00             _DVSW:	DB	0
EC88 00             _DRV:	DB	0
EC89 FF             _DSK:	DB	0FFH
EC8A 80 00          _DTA:	DW	00080H
EC8C 00 00          _CTC:	DW	0
EC8E 00 00          _TXADR:	DW	0
EC90 00 00          _KEYPS	DW	0
EC92 00 FF          _KEYD	DW	0FF00H
EC94 C2 10          _KEYSP:	DW	010C2H
EC96 07             _COLORF:DB	7
EC97 18             _LINE:	DB	LINE
EC98                
EC98 00 00          _FCB:	DW	0
EC9A 00 00          _FBPS:	DW	0	;SEARCH FILES
EC9C 00 00          _FBAD:	DW	0	;    //
EC9E 00             _FBCNT:	DB	0	;    //
EC9F 00             _FILEN:	DB	0
ECA0 00             _DIRF:	DB	0	;bit7:ディレクトリ bit0-6:セクタインデックス 
ECA1 00             _MAXCYL:DB	0
ECA2 00             _WTFATF:DB	0	;FATバッファの更新フラグ
ECA3                		DS	1
ECA4 00             _WTDBF:	DB	0	;データバッファの更新フラグ
ECA5 FF             _DBDRV:	DB	0FFH	;データバッファにあるデータを読み込んだドライブ
ECA6 00 00          _DBSEC:	DW	0	;データバッファにあるデータを読み込んだセクタ番号
ECA8 00 00          _DPB:	DW	0
ECAA FF             _FATDRV:DB	0FFH	;FATバッファに読み込んでいるドライブ
ECAB 00             _FATIX:	DB	0	;FATバッファに読み込んでいるインデックス
ECAC 00 00          _FAKEFREE:	DW	0	;偽の残量（FATサイズが大きくなると重くなるのでその対策）
ECAE                
ECAE                	DS	2
ECB0                
ECB0 6F 50 59 38    CRTCD:	DB	06FH,050H,059H,038H,01FH,002H,019H,01CH
ECB4 1F 02 19 1C
ECB8 00 07          	DB	000H,007H
ECBA 80 F8 B0 FF    	DW	0-80*LINE,0-80
ECBE 0C             	DB	00CH
ECBF A0             WK1FD0:	DB	0A0H
ECC0                
ECC0 89 D6          CTC0:	DW	INTCTCE
ECC2 89 D6          CTC1:	DW	INTCTCE
ECC4 AB D6          CTC2:	DW	INTCTC2
ECC6 89 D6          CTC3:	DW	INTCTCE
ECC8 6D D6          INTVEC:	DW	INT
ECCA                
ECCA                ;	JUMP
ECCA                
ECCA C3 32 DC       _INKEY:	JP	INKEY
ECCD C3 A7 D8       _PRINT:	JP	PRINT
ECD0 C3 7E DB       _SCRN:	JP	SCRN
ECD3 C3 A6 DB       _POS:	JP	POS
ECD6 C3 EA D9       _LOC:	JP	LOC
ECD9                _CHGDRV:
ECD9 C3 6E E8       	JP	CHGDRV
ECDC                _GETDPB:
ECDC C3 46 E9       	JP	GETDPB
ECDF                _FFLUSH:
ECDF C3 63 E9       	JP	FFLUSH
ECE2                _RDFATX:
ECE2 C3 66 E5       	JP	RDFATX
ECE5 C3 82 E6       _RDFAT:	JP	RDFAT
ECE8 C3 47 EA       _WTTRK:	JP	WTTRK
ECEB C3 5B EA       _FDRD:	JP	FDRD
ECEE C3 4D EA       _FDWT:	JP	FDWT
ECF1                _BPB2DPB:
ECF1 C3 E7 E6       	JP	BPB2DPB
ECF4                	DS	3
ECF7                _GNCL:
ECF7 C3 FC E5       GNCPAT:	JP	GNCL		;自己書き換え
ECFA                _SNCL:
ECFA C3 1F E6       SNCPAT:	JP	SNCL		;自己書き換え
ECFD C3 A9 CC       _COMANL:JP	COMANL
ED00                
ED00                WE:
ED00                	INCLUDE	"LDDPB.ASM"
ED00                
ED00                ;	LSX-Dodgers DPB
ED00                
ED00                DEVICE:
ED00                
ED00                ;	A:
ED00                
ED00 02 00          	DW	2	;DPB_00_FATLN
ED02 EB EC          	DW	_FDRD	;DPB_02_DRD
ED04 EE EC          	DW	_FDWT	;DPB_04_DWT
ED06 FD             	DB	0FDH	;DPB_06_FATID
ED07 02             	DB	2	;DPB_07_SECPCL
ED08 64 01          	DW	356	;DPB_08_MAXCL
ED0A FF             	DB	0FFH	;DPB_0A_FDMODE	0FFH=2D / 0FEH=2HD
ED0B 07             	DB	7	;DPB_0B_DIRSCNT
ED0C 28             	DB	40	;DPB_0C_MAXCYL
ED0D 09             	DB	9	;DPB_0D_MAXSEC	Number of sectors
ED0E 01             	DB	1	;DPB_0E_FATPS
ED0F 82             	DB	082H	;DPB_0F_BPS
ED10 05 00          	DW	5	;DPB_10_DIRPS
ED12 A7             	DB	0A7H	;DPB_12_DEVICE	Device Number
ED13 00             	DB	0	;DPB_13_UNITNO
ED14 08 00          	DW	8	;DPB_14_ADDCL16
ED16 00 00          	DW	0	;DPB_16
ED18 00 00          	DW	0	;DPB_18
ED1A 00 00          	DW	0	;DPB_1A_SDIR
ED1C 46 44 44 30    	DB	"FDD0"	;DPB_1C_NAME
ED20                
ED20                ;	B:
ED20                
ED20 02 00          	DW	2	;DPB_00_FATLN
ED22 EB EC          	DW	_FDRD	;DPB_02_DRD
ED24 EE EC          	DW	_FDWT	;DPB_04_DWT
ED26 FD             	DB	0FDH	;DPB_06_FATID
ED27 02             	DB	2	;DPB_07_SECPCL
ED28 64 01          	DW	356	;DPB_08_MAXCL
ED2A FF             	DB	0FFH	;DPB_0A_FDMODE	0FFH=2D / 0FEH=2HD
ED2B 07             	DB	7	;DPB_0B_DIRSCNT
ED2C 28             	DB	40	;DPB_0C_MAXCYL
ED2D 09             	DB	9	;DPB_0D_MAXSEC	Number of sectors
ED2E 01             	DB	1	;DPB_0E_FATPS
ED2F 82             	DB	082H	;DPB_0F_BPS
ED30 05 00          	DW	5	;DPB_10_DIRPS
ED32 A7             	DB	0A7H	;DPB_12_DEVICE	Device Number
ED33 01             	DB	1	;DPB_13_UNITNO
ED34 08 00          	DW	8	;DPB_14_ADDCL16
ED36 00 00          	DW	0	;DPB_16
ED38 00 00          	DW	0	;DPB_18
ED3A 00 00          	DW	0	;DPB_1A_SDIR
ED3C 46 44 44 31    	DB	"FDD1"	;DPB_1C_NAME
ED40                
ED40                ;	C:
ED40                
ED40 02 00          	DW	2	;DPB_00_FATLN
ED42 EB EC          	DW	_FDRD	;DPB_02_DRD
ED44 EE EC          	DW	_FDWT	;DPB_04_DWT
ED46 FD             	DB	0FDH	;DPB_06_FATID
ED47 02             	DB	2	;DPB_07_SECPCL
ED48 64 01          	DW	356	;DPB_08_MAXCL
ED4A FF             	DB	0FFH	;DPB_0A_FDMODE	0FFH=2D / 0FEH=2HD
ED4B 07             	DB	7	;DPB_0B_DIRSCNT
ED4C 28             	DB	40	;DPB_0C_MAXCYL
ED4D 09             	DB	9	;DPB_0D_MAXSEC	Number of sectors
ED4E 01             	DB	1	;DPB_0E_FATPS
ED4F 82             	DB	082H	;DPB_0F_BPS
ED50 05 00          	DW	5	;DPB_10_DIRPS
ED52 A7             	DB	0A7H	;DPB_12_DEVICE	Device Number
ED53 02             	DB	2	;DPB_13_UNITNO
ED54 08 00          	DW	8	;DPB_14_ADDCL16
ED56 00 00          	DW	0	;DPB_16
ED58 00 00          	DW	0	;DPB_18
ED5A 00 00          	DW	0	;DPB_1A_SDIR
ED5C 46 44 44 32    	DB	"FDD2"	;DPB_1C_NAME
ED60                
ED60                ;	D:
ED60                
ED60 02 00          	DW	2	;DPB_00_FATLN
ED62 EB EC          	DW	_FDRD	;DPB_02_DRD
ED64 EE EC          	DW	_FDWT	;DPB_04_DWT
ED66 FD             	DB	0FDH	;DPB_06_FATID
ED67 02             	DB	2	;DPB_07_SECPCL
ED68 64 01          	DW	356	;DPB_08_MAXCL
ED6A FF             	DB	0FFH	;DPB_0A_FDMODE	0FFH=2D / 0FEH=2HD
ED6B 07             	DB	7	;DPB_0B_DIRSCNT
ED6C 28             	DB	40	;DPB_0C_MAXCYL
ED6D 09             	DB	9	;DPB_0D_MAXSEC	Number of sectors
ED6E 01             	DB	1	;DPB_0E_FATPS
ED6F 82             	DB	082H	;DPB_0F_BPS
ED70 05 00          	DW	5	;DPB_10_DIRPS
ED72 A7             	DB	0A7H	;DPB_12_DEVICE
ED73 03             	DB	3	;DPB_13_UNITNO
ED74 08 00          	DW	8	;DPB_14_ADDCL16
ED76 00 00          	DW	0	;DPB_16
ED78 00 00          	DW	0	;DPB_18
ED7A 00 00          	DW	0	;DPB_1A_SDIR
ED7C 46 44 44 33    	DB	"FDD3"	;DPB_1C_NAME
ED80                
ED80                ;	E:
ED80                
ED80 00 00          EMMFL:	DW	0	;DPB_00_FATLN
ED82 FA D2          EMMRD:	DW	EDRD	;DPB_02_DRD
ED84 F6 D2          EMMWR:	DW	EDWT	;DPB_04_DWT
ED86 FE             	DB	0FEH	;DPB_06_FATID
ED87 02             	DB	2	;DPB_07_SECPCL
ED88 00 00          EMMCL:	DW	0	;DPB_08_MAXCL
ED8A 00             	DB	0	;DPB_0A_FDMODE
ED8B 0C             	DB	12	;DPB_0B_DIRSCNT
ED8C 00             EMMBL:	DB	0	;DPB_0C_MAXCYL
ED8D 01             	DB	1	;DPB_0D_MAXSEC
ED8E 02             	DB	2	;DPB_0E_FATPS
ED8F 02             	DB	2	;DPB_0F_BPS
ED90 0A 00          	DW	10	;DPB_10_DIRPS
ED92 06             	DB	6	;DPB_12_DEVICE
ED93 00             EMMDV:	DB	0	;DPB_13_UNITNO
ED94 12 00          	DW	18	;DPB_14_ADDCL16
ED96 00 00          	DW	0	;DPB_16
ED98 00 00          	DW	0	;DPB_18
ED9A 00 00          	DW	0	;DPB_1A_SDIR
ED9C 45 4D 4D 30    	DB	"EMM0"	;DPB_1C_NAME
EDA0                
EDA0                ;	F:
EDA0                
EDA0 00 00          BANKFL:	DW	0	;DPB_00_FATLN
EDA2 91 D2          	DW	BDRD	;DPB_02_DRD
EDA4 8D D2          	DW	BDWT	;DPB_04_DWT
EDA6 F9             	DB	0F9H	;DPB_06_FATID
EDA7 02             	DB	2	;DPB_07_SECPCL
EDA8 00 00          BANKCL:	DW	0	;DPB_08_MAXCL
EDAA 00             	DB	0	;DPB_0A_FDMODE
EDAB 08             	DB	8	;DPB_0B_DIRSCNT
EDAC 00             	DB	0	;DPB_0C_MAXCYL
EDAD 01             	DB	1	;DPB_0D_MAXSEC
EDAE 00             	DB	0	;DPB_0E_FATPS
EDAF 02             	DB	2	;DPB_0F_BPS
EDB0 02 00          	DW	2	;DPB_10_DIRPS
EDB2 0B             	DB	00BH	;DPB_12_DEVICE
EDB3 00             	DB	0	;DPB_13_UNITNO
EDB4 06 00          	DW	6	;DPB_14_ADDCL16
EDB6 00 00          	DW	0	;DPB_16
EDB8 00 00          	DW	0	;DPB_18
EDBA 00 00          	DW	0	;DPB_1A_SDIR
EDBC 42 52 41 4D    	DB	"BRAM"	;DPB_1C_NAME
EDC0                
EDC0                ;	G:
EDC0                
EDC0 01 00          	DW	1	;DPB_00_FATLN
EDC2 4E D2          	DW	GDRD	;DPB_02_DRD
EDC4 65 D2          	DW	GDWT	;DPB_04_DWT
EDC6 F9             	DB	0F9H	;DPB_06_FATID
EDC7 04             	DB	4	;DPB_07_SECPCL
EDC8 30 00          	DW	48	;DPB_08_MAXCL
EDCA 00             	DB	0	;DPB_0A_FDMODE
EDCB 04             	DB	4	;DPB_0B_DIRSCNT
EDCC 00             	DB	0	;DPB_0C_MAXCYL
EDCD 01             	DB	1	;DPB_0D_MAXSEC
EDCE 00             	DB	0	;DPB_0E_FATPS
EDCF 01             	DB	1	;DPB_0F_BPS
EDD0 04 00          	DW	4	;DPB_10_DIRPS
EDD2 05             	DB	5	;DPB_12_DEVICE
EDD3 01             	DB	1	;DPB_13_UNITNO
EDD4 00 00          	DW	0	;DPB_14_ADDCL16
EDD6 00 00          	DW	0	;DPB_16
EDD8 00 00          	DW	0	;DPB_18
EDDA 00 00          	DW	0	;DPB_1A_SDIR
EDDC 47 52 41 4D    	DB	"GRAM"	;DPB_1C_NAME
EDE0                
EDE0                
EDE0 00             LDEND:	DB	0
EDE1                
EDE1                	END
EDE1                
