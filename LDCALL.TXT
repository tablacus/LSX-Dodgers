・LSX-Dodgers  MSX-DOS  CP/M80
・システム・コール一覧


	システム・コールは
	Cレジスタにファンクション番号を入れ
	$0005番地を呼び出すことにより実行されます。


ファンクション
 番号

$00	プログラム終了

	設  定:なし

	戻り値:--

	備  考:実行中のプログラムを終了させ、システムの再立ち上げを行なう
		0番地へのジャンプによるプログラム終了と同じ


$01	コンソール入力

	設  定:なし

	戻り値:A←コンソールから入力した1文字

	備  考:入力なき場合入力待ち。入力文字はコンソールに表示する
		[CTRL]+[C]、[CTRL]+[S]の入力があれば処理を行う


$02	コンソール出力

	設  定:E←コンソールに出力する文字コード

	戻り値:なし

	備  考:[CTRL]+[C]、[CTRL]+[S]の入力があれば処理を行う


$03	外部入力

	設  定:なし

	戻り値:A←AUXデバイスから読み込んだ1文字


$04	外部出力

	設  定:E←AUXデバイスに出力する1文字

	戻り値:なし


$05	プリンタ出力

	設  定:E←プリンタに出力する1文字

	戻り値:なし


$06	コンソール直接入出力

	設  定:E←$FF  コンソール入力
		E←$FF以外  その値を文字コードとしてコンソール出力

	戻り値:入力の場合  A←入力した1文字(入力のない場合  A←0)
		出力の場合  なし

	備  考:[CTRL]+[C]、[CTRL]+[S]の処理やエコーバックは行わない


$07	コンソール直接入力	*1

	設  定:なし

	戻り値:A←コンソールから入力した1文字

	備  考:入力なき場合入力待ち。コンソールにエコーバックしない
		[CTRL]+[C]、[CTRL]+[S]の処理は行わない

		CP/M80の場合、I/Oバイトの読み出し
		戻り値:A←I/Oバイト


$08	エコーなしコンソール入力	*1

	設  定:なし

	戻り値:A←コンソールから入力した1文字

	備  考:入力なき場合入力待ち。コンソールにエコーバックしない
		[CTRL]+[C]、[CTRL]+[S]の入力があれば処理を行う

		CP/M80の場合、I/Oバイトの設定
		設  定:E←I/Oバイト


$09	文字列出力

	設  定:DE←メモリ上に用意した、コンソールに出力する文字列の先頭アド
		レス

	戻り値:なし

	備  考:文字列の最後に$を付ける。$は表示しない


$0A  文字列入力

	設  定:DE←最大入力文字数(1～$FF)をセットしたメモリのアドレス

	戻り値:DEにセットしたアドレス+1←実際に入力された文字列

	備  考:入力文字数が指定した最大に満たない場合、$0Dを入力の終端とみ
		なす。入力時にスクリーンエディットによる編集可
		[CTRL]+[C]の入力があれば処理を行う


$0B	コンソール状態のチェック

	設  定:なし

	戻り値:キーが押されている場合、A←$FF
		押されていない場合、A←0


$0C	バージョン番号の獲得

	設  定:なし

	戻り値:HL←$0022

	備  考:CP/M用


$0D	ディスク・リセット

	設  定:なし

	戻り値:なし

	備  考:変更されたがまだディスクに書き込まれていないデータがあれば書き
		込み、カレント・ドライブをドライブAに設定しDTAを$0080
		にセットする。ファイルの大きさに変更がある場合はファイルのクロー
		ズも必要


$0E	カレント・ドライブの設定

	設  定:E←カレント・ドライブ番号
		(A:0,B:1,……H:7)

	戻り値:なし


$0F	ファイルのオープン

	設  定:DE←オープンされていないファイルのFCBの先頭アドレス

	戻り値:成功した場合  A←0(～3)
			      指定のFCB←各フィールドの設定
		失敗した場合  A←$FF


$10	ファイルのクローズ

	設  定:DE←オープンされたファイルのFCBの先頭アドレス

	戻り値:成功した場合  A←0
		失敗した場合  A←$FF


$11	最初のファイルの検索

	設  定:DE←オープンされていないファイルのFCBの先頭アドレス

	戻り値:見つかった場合  A←0
				DTAで示される領域←そのファイルの
				ドライブ番号とディレクトリエントリ
				FCBにドライブ番号をセット
		失敗した場合  A←$FF


$12	次のファイルの検索

	設  定:なし

	戻り値:見つかった場合  A←0
				DTAで示される領域←そのファイルのドライブ番
				号とディレクトリエントリ
		失敗した場合  A←$FF


$13	ファイルの削除

	設  定:DE←削除するファイルのFCBの先頭アドレス

	戻り値:成功した場合  A←0
		失敗した場合  A←$FF

	備  考:ワイルドカード指定可


$14	シーケンシャルな読み出し

	設  定:DE←オープンされたファイルのFCBの先頭アドレス
		FCBのカレント・ブロック←読み出し開始ブロック
		FCBのカレント・レコード←読み出し開始レコード

	戻り値:成功した場合  A←0
			      DTAで示される領域←読み込んだ1レコード
		EOFの場合  A←1
		失敗した場合  A←$FF

	備  考:1レコードの大きさは128バイト


$15	シーケンシャルな書き込み

	設  定:DE←オープンされたファイルのFCBの先頭アドレス
		FCBのカレント・ブロック←書き込み開始ブロック
		FCBのカレント・レコード←書き込み開始レコード
		DTAで以降のメモリ領域←書き込むデータ

	戻り値:成功した場合  A←0
		失敗した場合  A←1

	備  考:1レコードの大きさは128バイト


$16	ファイルの作成

	設  定:DE←オープンされていないファイルのFCBの先頭アドレス

	戻り値:成功した場合  A←0(～3)
		失敗した場合  A←$FF


$17	ファイル名の変更

	設  定:DE←ファイル名を変更したいファイルのFCBの先頭アドレス
		FCBの先頭アドレス+$11←新ファイル名

	戻り値:成功した場合  A←0
		失敗した場合  A←$FF

	備  考:ワイルドカード指定不可(MSX-DOSではワイルドカード指定可)


$18	ログイン・ベクトルの獲得

	設  定:なし

	戻り値:HL←オンライン・ドライブ情報

	備  考:戻り値のうち、Lレジスタの各ビットがドライブ番号に対応、1なら
		オンライン、0ならオフライン
		LSX-DodgersではHL←$00FF(簡易処理)


$19	カレント・ドライブ番号の獲得

	設  定:なし

	戻り値:A←カレントドライブ番号
		(A:0,B:1,……H:7)


$1A  DTAの設定

	設  定:DE←転送先アドレス(DTAアドレス)

	戻り値:なし


$1B	ディスク情報の獲得	*1

	設  定:E←目的のディスクが入っているドライブ番号
		(カレント・ドライブ:0,A:1,B:2,……H:8)

	戻り値:A←1クラスタ辺りの論理セクタ数
		BC←論理セクタのサイズ
		DE←クラスタの総数
		HL←未使用クラスタの総数
		IX←DPBの先頭アドレス
		IY←メモリ上のFATの先頭アドレス
		A←1クラスタのセクタ数

		失敗した場合  A←$FF

	備  考:CP/M80の場合、ファイル割り当て情報の読み出し
		戻り値:HL←カレント・ディスクのどの領域がファイルに割り当てられているか
			を示すメモリ領域の先頭アドレス


$1C	ディスクの書き込み禁止化	*2

	備  考:このシステム・コール発行以降、再びシステムがブートされるまで、
		カレントディスクへの書き込みを禁止する


$1D	書き込みが禁止されているディスクの調査

	設  定:なし

	戻り値:HL←書き込み禁止ドライブ情報

	備  考:戻り値のうち、Lレジスタの各ビットがドライブ番号に対応、1なら
		書き込み禁止、0なら書き込み可
		LSX-DodgersではHL←$0000(簡易処理)


$1E	ファイル属性の設定	*2

	設  定:FCBの拡張子の1文字目と2文字目の最上位ビット←ファイルの
		属性情報

	備  考:拡張子の1文字目の最上位ビットが0→読み書き可能
				〃		1→読み込み専用
		拡張子の2文字目の最上位ビットが0→通常ファイル
						1→システムファイル


$1F	ディスク装置のパラメータの読み出し

	設  定:なし

	戻り値:HL←DPBの先頭アドレス(ドライブA:)
		IX←最後アクセスドライブのDPBの先頭アドレス
		A←最後アクセスドライブのFAT領域のセクタ単位でのサイズ

	備  考:LSX-DodgersのDPBの構造はCP/M80ともMSX-DOSとも異なる


$20	利用者番号の設定と読み出し

	設  定:E←$FF  利用者番号の読み出し
		E←$FF以外  その値の下位5ビットを利用者番号として設定

	戻り値:入力の場合  A←現在の利用者番号
		出力の場合  なし

	備  考:LSX-Dodgersでは利用者番号の設定は無視され読み出しの処理はA←0


$21	ランダムな読み出し

	設  定:DE←オープンされたファイルのFCBの先頭アドレス
		FCBのランダムレコード←読み出し開始レコード

	戻り値:成功した場合  A←0
			      DTAで示される領域←読み込んだ1レコード
		失敗した場合  A←1

	備  考:1レコードの大きさは128バイト


$22	ランダムな書き込み

	設  定:DE←オープンされたファイルのFCBの先頭アドレス
		FCBのランダムレコード←書き込み開始レコード
		DTA以降のメモリ領域←書き込むデータ

	戻り値:成功した場合  A←0
		失敗した場合  A←1

	備  考:1レコードの大きさは128バイト


$23	ファイル・サイズの獲得

	設  定:DE←オープンしていないファイルのFCBの先頭アドレス

	戻り値:成功した場合  A←0
		FCBのランダムレコードフィールド←指定されたファイルのサイズ
		失敗した場合  A←$FF

	備  考:ファイル・サイズは128バイト単位で計算する。127バイトなら
		1で300バイトなら3となる


$24	ランダム・レコード・フィールドの設定

	設  定:DE←オープンされたファイルのFCBの先頭アドレス
		FCBのカレント・ブロック←目的のブロック
		FCBのカレント・レコード←目的のレコード

	戻り値:FCBのランダム・レコード・フィールド←指定されたファイルのカ
		レント・ブロック・フィールド及びカレント・レコード・フィールド
		から計算したレコード・ポジション


$26	ランダム・ブロック・ライト	*1

	設  定:DE←オープンされたファイルのFCBの先頭アドレス
		FCBのランダムレコード←書き込み開始レコード
		FCBのレコードサイズ←1(MSX-DOSでは自由に設定できる)
		HL←書き込むレコード数
		DTA以降のメモリ領域←書き込むデータ

	戻り値:成功した場合  A←0
		失敗した場合  A←1

	備  考:1レコードの大きさは1バイト(MSX-DOSでは自由に設定できる)


$27	ランダム・ブロック・リード	*1

	設  定:DE←オープンされたファイルのFCBの先頭アドレス
		FCBのランダム・レコード←読み出し開始レコード
		FCBのレコード・サイズ←1(MSX-DOSでは自由に設定できる)
		HL←読み込むレコード数

	戻り値:成功した場合  A←0
			      HL←実際に読み込んだレコード数
			      DTAで示される領域←読み込んだデータ
		指定したレコード数読み込めなかった場合
			      A←1
			      HL←実際に読み込んだレコード数
			      DTAで示される領域←読み込んだデータ
		失敗した場合  A←$FF

	備  考:1レコードの大きさは1バイト(MSX-DOSでは自由に設定できる)


$28	ランダムな書き込み・その2	*2

	設  定:DE←オープンされたファイルのFCBの先頭アドレス
		FCBのランダム・レコード←書き込み開始レコード
		DTA以降のメモリ領域←書き込むデータ

	戻り値:成功した場合  A←0
		失敗した場合  A←1

	備  考:1レコードの大きさは128バイト


$29	ファイル名の解析	*3

	設 定:DE←解析するファイル名の入っている先頭アドレス
		HL←解析それたファイルを格納するFCBの先頭アドレス


$2A	日付の獲得	*1

	設  定:なし

	戻り値:HL←年  D←月  E←日  A←曜日(0:日～6:土)


$2B	日付の設定	*1 *2

	設  定:HL←年  D←月  E←日

	戻り値:成功した場合  A←0
		失敗した場合  A←$FF


$2C	時刻の獲得	*1

	設  定:なし

	戻り値:H←時  L←分  D←秒  E←1/100秒

	備  考:X1の仕様によりE←0


$2D	時刻の設定	*1 *2

	設  定:H←時  L←分  D←秒  E=1/100秒

	戻り値:成功した場合  A←0
		失敗した場合  A←$FF


$2E	ベリファイ・フラグの設定	*1 *2

	設  定:E←0      ベリファイ・フラグをセット
		E←$FF  ベリファイ・フラグをリセット

	戻り値:なし


$2F	論理セクタを用いた読み出し	*1

	設  定:DE←読み出しを開始する論理セクタ番号
		H←読み出す論理セクタの数
		L←読み出すディスクドライブの番号
		(A:0,B:1,……H:7)

	戻り値:成功した場合  A←0
			      DTAで示される領域←読み込んだデータ
		失敗した場合  A←$FF


$30	論理セクタを用いた書き込み	*1

	設  定:DE←書き込みを開始する論理セクタ番号
		H←書き込む論理セクタの数
		L←書き込むディスクドライブの番号
		(A:0,B:1,……H:7)
		DTAで示される領域←書き込むデータ

	戻り値:成功した場合  A←0
		失敗した場合  A←$FF


*1	CP/M80と互換性がないもの
*2	標準のLSX-Dodgersでサポートしていないもの
*3	LSX-Dodgersオリジナル機能

	※システムコール備考

	[CTRL]+[C]は[SHIFT]+[BREAK]と同じ
	[CTRL]+[S]は[BREAK]と同じ

	LSX-Dodgersでは戻り値として使用するレジスタとAレジスタ、フラグ以外は保存する。
	CP/M80やMSX-DOSの中にはすべてのレジスタを破壊する仕様のものがある。
	CP/M80やMSX-DOSで動くように作るためにはシステム・コールの際、
	必要なレジスタは保存するように作る。

eof
