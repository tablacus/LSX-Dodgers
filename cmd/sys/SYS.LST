                                ;*** AILZ80ASM *** Z-80 Assembler, version 1.0.0.0, LST:Full:4
                                ;   SYS by Gaku
                                
       0005                     SYSTEM  EQU 0005H
       005C                     FCB1    EQU 005CH
                                
       000D                     CR  EQU 0DH
       000A                     LF  EQU 0AH
                                
       0000                     DTBUF   EQU 0000H
       D000                     FATBF   EQU 0D000H
       FE00                     IPL EQU 0FE00H
                                
000000 0100                         ORG 0100H
000000 0100 C37001          10      JP  START
       0103                     TITLE:
000003 0103 5831207379737465        DB  "X1 systemcopy v1.03"
            6D636F7079207631    
            2E3033              
000016 0116 0D0A24                  DB  CR,LF,"$"
       0119                     USAGE:
000019 0119 75736167653A            DB  "usage:"
00001F 011F 2053595320C4DED7        DB  " SYS ﾄﾞﾗｲﾌﾞ:",CR,LF,"$"
            B2CCDE3A0D0A24      
       012E                     OK:
00002E 012E 204F6B0D0A24            DB  " Ok",CR,LF,"$"
       0134                     ERROR:
000034 0134 204572726F720D0A        DB  " Error",CR,LF,"$"
            24                  
       013D                     SKIP:
00003D 013D 20536B69700D0A24        DB  " Skip",CR,LF,"$"
       0145                     LSX:
000045 0145 4C44202020202020        DB  "LD      .BIN$"
            2E42494E24          
       0152                     WIPL:
000052 0152 5772697465204950        DB  "Write IPL $"
            4C2024              
       015D                     M2D:
00005D 015D 324424                  DB  "2D$"
       0160                     M2HD:
000060 0160 32484424                DB  "2HD$"
       0164                     M2HS:
000064 0164 32485324                DB  "2HS$"
       0168                     M2HC:
000068 0168 32484324                DB  "2HC$"
       016C                     MEMM:
00006C 016C 454D4D24                DB  "EMM$"
                                
       0170                     START:
000070 0170 110301          10      LD  DE,TITLE
000073 0173 0E09             7      LD  C,9
000075 0175 CD0500          17      CALL    SYSTEM
                                
000078 0178 115A07          10      LD  DE,DATA
00007B 017B 0E1A             7      LD  C,1AH
00007D 017D CD0500          17      CALL    SYSTEM
                                
000080 0180 3A5C00          13      LD  A,(FCB1)
000083 0183 B7               4      OR  A
000084 0184 200B            12      JR  NZ,INIT
                                
000086 0186 111901          10      LD  DE,USAGE
000089 0189 0E09             7      LD  C,9
00008B 018B CD0500          17      CALL    SYSTEM
00008E 018E C30000          10      JP  0
       0191                     INIT:
000091 0191 323107          13      LD  (FCB3),A
                                
000094 0194 114501          10      LD  DE,LSX
000097 0197 0E09             7      LD  C,9
000099 0199 CD0500          17      CALL    SYSTEM
                                
00009C 019C 110C07          10      LD  DE,FCB2
00009F 019F 0E0F             7      LD  C,0FH
0000A1 01A1 CD0500          17      CALL    SYSTEM
0000A4 01A4 B7               4      OR  A
0000A5 01A5 2077            12      JR  NZ,CCHECK
                                
0000A7 01A7 2A1A07          16      LD  HL,(FCB2+14)
0000AA 01AA 225607          16      LD  (SDIR),HL
0000AD 01AD 210100          10      LD  HL,1
0000B0 01B0 221A07          16      LD  (FCB2+14),HL
0000B3 01B3 223F07          16      LD  (FCB3+14),HL
                                
0000B6 01B6 2A0600          16      LD  HL,(SYSTEM+1)
0000B9 01B9 25               4      DEC H
0000BA 01BA 25               4      DEC H
0000BB 01BB 115A07          10      LD  DE,DATA
0000BE 01BE ED52            15      SBC HL,DE
0000C0 01C0 110C07          10      LD  DE,FCB2
0000C3 01C3 0E27             7      LD  C,27H
0000C5 01C5 CD0500          17      CALL    SYSTEM
0000C8 01C8 3D               4      DEC A
0000C9 01C9 2053            12      JR  NZ,CCHECK
0000CB 01CB 225807          16      LD  (SIZE),HL
                                
0000CE 01CE 110C07          10      LD  DE,FCB2
0000D1 01D1 0E10             7      LD  C,10H
0000D3 01D3 CD0500          17      CALL    SYSTEM
0000D6 01D6 B7               4      OR  A
0000D7 01D7 2045            12      JR  NZ,CCHECK
                                
0000D9 01D9 3A0C07          13      LD  A,(FCB2)
0000DC 01DC 213107          10      LD  HL,FCB3
0000DF 01DF BE               7      CP  (HL)
0000E0 01E0 200A            12      JR  NZ,CREATE
                                
0000E2 01E2 113D01          10      LD  DE,SKIP
0000E5 01E5 0E09             7      LD  C,9
0000E7 01E7 CD0500          17      CALL    SYSTEM
0000EA 01EA 1835            12      JR  WTIPL
                                
       01EC                     CREATE:
0000EC 01EC 113107          10      LD  DE,FCB3
0000EF 01EF 0E16             7      LD  C,16H
0000F1 01F1 CD0500          17      CALL    SYSTEM
0000F4 01F4 B7               4      OR  A
0000F5 01F5 2027            12      JR  NZ,CCHECK
                                
0000F7 01F7 210100          10      LD  HL,1
0000FA 01FA 223F07          16      LD  (FCB3+14),HL
                                
0000FD 01FD 113107          10      LD  DE,FCB3
000100 0200 2A5807          16      LD  HL,(SIZE)
000103 0203 0E26             7      LD  C,26H
000105 0205 CD0500          17      CALL    SYSTEM
000108 0208 B7               4      OR  A
000109 0209 2013            12      JR  NZ,CCHECK
                                
00010B 020B 212007          10      LD  HL,FCB2+20
00010E 020E 114507          10      LD  DE,FCB3+20
000111 0211 010400          10      LD  BC,4
000114 0214 EDB0                    LDIR
                                
000116 0216 113107          10      LD  DE,FCB3
000119 0219 0E10             7      LD  C,10H
00011B 021B CD0500          17      CALL    SYSTEM
                                
       021E                     CCHECK:
00011E 021E CDC702          17      CALL    CHECK
       0221                     WTIPL:
000121 0221 3A3107          13      LD  A,(FCB3)
000124 0224 5F               4      LD  E,A
000125 0225 0E1B             7      LD  C,1BH
000127 0227 CD0500          17      CALL    SYSTEM
00012A 022A 3C               4      INC A
00012B 022B CA0000          10      JP  Z,0
                                
00012E 022E 216201          10      LD  HL,354
000131 0231 A7               4      AND A
000132 0232 ED52            15      SBC HL,DE
000134 0234 283F            12      JR  Z,W2D
                                
000136 0236 21C504          10      LD  HL,1221
000139 0239 A7               4      AND A
00013A 023A ED52            15      SBC HL,DE
00013C 023C CAD602          10      JP  Z,W2HD
                                
00013F 023F 219605          10      LD  HL,1430
000142 0242 37               4      SCF
000143 0243 ED52            15      SBC HL,DE
000145 0245 3008            12      JR  NC,WTIPL1
                                
000147 0247 FD7E00          19      LD  A,(IY+0)
00014A 024A FEFB             7      CP  0FBH
00014C 024C CA1003          10      JP  Z,W2HS
       024F                     WTIPL1:
00014F 024F 214309          10      LD  HL,2371
000152 0252 A7               4      AND A
000153 0253 ED52            15      SBC HL,DE
000155 0255 CA3A03          10      JP  Z,W2HC
                                
000158 0258 CDE003          17      CALL    IS_X1
00015B 025B C20000          10      JP  NZ,0
                                
00015E 025E 3A3107          13      LD  A,(FCB3)
000161 0261 3D               4      DEC A
000162 0262 5F               4      LD  E,A
000163 0263 DA1F00          10      JP  C,01FH      ;ディスク装置のパラメータの読み出し
000166 0266 CD0500          17      CALL    SYSTEM
000169 0269 D8              11      RET C
                                
00016A 026A DD7E12          19      LD  A,(IX+12H)
00016D 026D FE06             7      CP  6
00016F 026F CA6403          10      JP  Z,WEMM
                                
000172 0272 C30000          10      JP  0
                                
       0275                     W2D:
000175 0275 115201          10      LD  DE,WIPL
000178 0278 0E09             7      LD  C,9
00017A 027A CD0500          17      CALL    SYSTEM
00017D 027D 115D01          10      LD  DE,M2D
000180 0280 0E09             7      LD  C,9
000182 0282 CD0500          17      CALL    SYSTEM
                                
000185 0285 215A07          10      LD  HL,DATA
000188 0288 115B07          10      LD  DE,DATA+1
00018B 028B 01FF03          10      LD  BC,1023
00018E 028E 3600            10      LD  (HL),0
000190 0290 EDB0                    LDIR
                                
000192 0292 21FC05          10      LD  HL,LIPL
000195 0295 115A07          10      LD  DE,DATA
000198 0298 013000          10      LD  BC,30H
00019B 029B EDB0                    LDIR
                                
00019D 029D 21ED03          10      LD  HL,MAIN
0001A0 02A0 017801          10      LD  BC,RDDLE-MAIN
0001A3 02A3 EDB0                    LDIR
                                
       02A5                     WJUMP:
0001A5 02A5 21EC06          10      LD  HL,JUMP
0001A8 02A8 113A09          10      LD  DE,DATA+01E0H
0001AB 02AB 012000          10      LD  BC,32
0001AE 02AE EDB0                    LDIR
                                
0001B0 02B0 CDC303          17      CALL    EAREA
                                
0001B3 02B3 110000          10      LD  DE,0
0001B6 02B6 2A3107          16      LD  HL,(FCB3)
0001B9 02B9 2D               4      DEC L
0001BA 02BA 2601             7      LD  H,1
0001BC 02BC 0E30             7      LD  C,30H
0001BE 02BE CD0500          17      CALL    SYSTEM
                                
0001C1 02C1 CDC702          17      CALL    CHECK
0001C4 02C4 C30000          10      JP  0
       02C7                     CHECK:
0001C7 02C7 B7               4      OR  A
0001C8 02C8 112E01          10      LD  DE,OK
0001CB 02CB 2803            12      JR  Z,CHECK2
       02CD                     DISERR:
0001CD 02CD 113401          10      LD  DE,ERROR
       02D0                     CHECK2:
0001D0 02D0 0E09             7      LD  C,9
0001D2 02D2 CD0500          17      CALL    SYSTEM
0001D5 02D5 C9              10      RET
                                
       02D6                     W2HD:
0001D6 02D6 115201          10      LD  DE,WIPL
0001D9 02D9 0E09             7      LD  C,9
0001DB 02DB CD0500          17      CALL    SYSTEM
0001DE 02DE 116001          10      LD  DE,M2HD
0001E1 02E1 0E09             7      LD  C,9
0001E3 02E3 CD0500          17      CALL    SYSTEM
                                
0001E6 02E6 215A07          10      LD  HL,DATA
0001E9 02E9 115B07          10      LD  DE,DATA+1
0001EC 02EC 01FF03          10      LD  BC,1023
0001EF 02EF 3600            10      LD  (HL),0
0001F1 02F1 EDB0                    LDIR
                                
0001F3 02F3 212C06          10      LD  HL,HIPL
0001F6 02F6 115A07          10      LD  DE,DATA
0001F9 02F9 013000          10      LD  BC,30H
0001FC 02FC EDB0                    LDIR
       02FE                     WMAIN:
0001FE 02FE 21ED03          10      LD  HL,MAIN
000201 0301 013601          10      LD  BC,MAINE-MAIN
000204 0304 EDB0                    LDIR
                                
000206 0306 216505          10      LD  HL,RDDH
000209 0309 015300          10      LD  BC,RDDHE-RDDH
00020C 030C EDB0                    LDIR
                                
00020E 030E 1895            12      JR  WJUMP
                                
       0310                     W2HS:
000210 0310 115201          10      LD  DE,WIPL
000213 0313 0E09             7      LD  C,9
000215 0315 CD0500          17      CALL    SYSTEM
000218 0318 116401          10      LD  DE,M2HS
00021B 031B 0E09             7      LD  C,9
00021D 031D CD0500          17      CALL    SYSTEM
                                
000220 0320 215A07          10      LD  HL,DATA
000223 0323 115B07          10      LD  DE,DATA+1
000226 0326 01FF03          10      LD  BC,1023
000229 0329 3600            10      LD  (HL),0
00022B 032B EDB0                    LDIR
                                
00022D 032D 215C06          10      LD  HL,SIPL
000230 0330 115A07          10      LD  DE,DATA
000233 0333 013000          10      LD  BC,30H
000236 0336 EDB0                    LDIR
000238 0338 18C4            12      JR  WMAIN
                                
       033A                     W2HC:
00023A 033A 115201          10      LD  DE,WIPL
00023D 033D 0E09             7      LD  C,9
00023F 033F CD0500          17      CALL    SYSTEM
000242 0342 116801          10      LD  DE,M2HC
000245 0345 0E09             7      LD  C,9
000247 0347 CD0500          17      CALL    SYSTEM
                                
00024A 034A 215A07          10      LD  HL,DATA
00024D 034D 115B07          10      LD  DE,DATA+1
000250 0350 01FF03          10      LD  BC,1023
000253 0353 3600            10      LD  (HL),0
000255 0355 EDB0                    LDIR
                                
000257 0357 218C06          10      LD  HL,CIPL
00025A 035A 115A07          10      LD  DE,DATA
00025D 035D 013000          10      LD  BC,30H
000260 0360 EDB0                    LDIR
000262 0362 189A            12      JR  WMAIN
                                
       0364                     WEMM:
000264 0364 115201          10      LD  DE,WIPL
000267 0367 0E09             7      LD  C,9
000269 0369 CD0500          17      CALL    SYSTEM
00026C 036C 116C01          10      LD  DE,MEMM
00026F 036F 0E09             7      LD  C,9
000271 0371 CD0500          17      CALL    SYSTEM
                                
000274 0374 215A07          10      LD  HL,DATA
000277 0377 115B07          10      LD  DE,DATA+1
00027A 037A 01FF03          10      LD  BC,1023
00027D 037D 3600            10      LD  (HL),0
00027F 037F EDB0                    LDIR
                                
000281 0381 21BC06          10      LD  HL,EIPL
000284 0384 115A07          10      LD  DE,DATA
000287 0387 013000          10      LD  BC,30H
00028A 038A EDB0                    LDIR
                                
00028C 038C 21ED03          10      LD  HL,MAIN
00028F 038F 013601          10      LD  BC,MAINE-MAIN
000292 0392 EDB0                    LDIR
                                
000294 0394 21B805          10      LD  HL,RDDE
000297 0397 014400          10      LD  BC,RDDEE-RDDE
00029A 039A EDB0                    LDIR
                                
00029C 039C CDC303          17      CALL    EAREA
                                
00029F 039F AF               4      XOR A
0002A0 03A0 01000D          10      LD  BC,0D00H
0002A3 03A3 ED79            12      OUT (C),A
0002A5 03A5 0C               4      INC C
0002A6 03A6 ED79            12      OUT (C),A
0002A8 03A8 0C               4      INC C
0002A9 03A9 ED79            12      OUT (C),A
0002AB 03AB 0C               4      INC C
                                
0002AC 03AC 215A07          10      LD  HL,DATA
       03AF                     EMML:
0002AF 03AF 04               4      INC B
0002B0 03B0 EDA3            16      OUTI
0002B2 03B2 04               4      INC B
0002B3 03B3 EDA3            16      OUTI
0002B5 03B5 3D               4      DEC A
0002B6 03B6 20F7            12      JR  NZ,EMML
                                
0002B8 03B8 112E01          10      LD  DE,OK
0002BB 03BB 0E09             7      LD  C,9
0002BD 03BD CD0500          17      CALL    SYSTEM
0002C0 03C0 C30000          10      JP  0
                                
       03C3                     EAREA:
0002C3 03C3 CDE003          17      CALL    IS_X1
0002C6 03C6 C0              11      RET NZ
                                
0002C7 03C7 3A3107          13      LD  A,(FCB3)
0002CA 03CA 3D               4      DEC A
0002CB 03CB 5F               4      LD  E,A
0002CC 03CC DA1F00          10      JP  C,01FH      ;ディスク装置のパラメータの読み出し
0002CF 03CF CD0500          17      CALL    SYSTEM
0002D2 03D2 D8              11      RET C
                                
0002D3 03D3 DD7E12          19      LD  A,(IX+12H)
0002D6 03D6 FE06             7      CP  6
0002D8 03D8 C0              11      RET NZ
                                
0002D9 03D9 DD7E0C          19      LD  A,(IX+0CH)
0002DC 03DC 328107          13      LD  (DATA+27H),A
0002DF 03DF C9              10      RET
                                
       03E0                     IS_X1:
0002E0 03E0 0E6F             7      LD  C,06FH      ;MSX-DOS のバージョン番号の獲得(_DOSVER)
0002E2 03E2 CD0500          17      CALL    SYSTEM
0002E5 03E5 79               4      LD  A,C
0002E6 03E6 FE1D             7      CP  01DH        ;LSX-Dodgersの場合、01DH
0002E8 03E8 C0              11      RET NZ
0002E9 03E9 7D               4      LD  A,L     ;機種ID
0002EA 03EA FE00             7      CP  0       ;X1
0002EC 03EC C9              10      RET
                                
       03ED                     MAIN:
0002ED FE30                         ORG IPL+30H,MAIN-100H
       FE30                     FNAME:
0002ED FE30 4C44202020202020        DB  "LD",20H,20H,20H,20H,20H,20H
0002F5 FE38 42494E                  DB  "BIN"
                                
       FE3B                     SA:
0002F8 FE3B F3               4      DI
0002F9 FE3C 310000          10      LD  SP,0
0002FC FE3F DD2100FE        14      LD  IX,IPL
000300 FE43 3E1E             7      LD  A,1EH
000302 FE45 D300            11      OUT (0),A
000304 FE47 012430          10      LD  BC,3000H+36
000307 FE4A ED78            12      IN  A,(C)
000309 FE4C E603             7      AND 3
00030B FE4E 3236FF          13      LD  (DRIVE+1),A
00030E FE51 CD94FE          17      CALL    FILE
000311 FE54 382A            12      JR  C,IPLERR
000313 FE56 2A0300          16      LD  HL,(DTBUF+3)
000316 FE59 ED5B0100        20      LD  DE,(DTBUF+1)
00031A FE5D ED52            15      SBC HL,DE
00031C FE5F 44               4      LD  B,H
00031D FE60 4D               4      LD  C,L
00031E FE61 03               6      INC BC
00031F FE62 210700          10      LD  HL,DTBUF+7
000322 FE65 EDB0                    LDIR
000324 FE67 3A36FF          13      LD  A,(DRIVE+1)
000327 FE6A 3287FF          13      LD  (0FF87H),A
00032A FE6D DD7E27          19      LD  A,(IX+27H)
00032D FE70 328CFF          13      LD  (0FF8CH),A
                                
000330 FE73 01031A          10      LD  BC,1A03H
000333 FE76 3E82             7      LD  A,82H
000335 FE78 ED79            12      OUT (C),A
000337 FE7A ED5E             8      IM  2
000339 FE7C 2A0500          16      LD  HL,(0005H)
00033C FE7F E9               4      JP  (HL)
       FE80                     IPLERR:
00033D FE80 3A36FF          13      LD  A,(DRIVE+1)
000340 FE83 01FC0F          10      LD  BC,0FFCH
000343 FE86 ED79            12      OUT (C),A
000345 FE88 3E1D             7      LD  A,1DH
000347 FE8A D300            11      OUT (0),A
000349 FE8C 3E07             7      LD  A,7
00034B FE8E 3286FF          13      LD  (0FF86H),A
00034E FE91 C3F500          10      JP  00F5H
                                
       FE94                     FILE:
000351 FE94 1600             7      LD  D,0
000353 FE96 DD5E29          19      LD  E,(IX+29H)  ;FAT
000356 FE99 2100D0          10      LD  HL,FATBF
000359 FE9C DD462A          19      LD  B,(IX+2AH)  ;FAT
00035C FE9F CD0FFF          17      CALL    DRDSB
00035F FEA2 D8              11      RET C
                                
000360 FEA3 210000          10      LD  HL,DTBUF
000363 FEA6 1600             7      LD  D,0
000365 FEA8 DD5E2B          19      LD  E,(IX+2BH)  ;ディレクトリ
000368 FEAB E5              11      PUSH    HL
000369 FEAC DD462C          19      LD  B,(IX+2CH)  ;ディレクトリ
00036C FEAF CD0FFF          17      CALL    DRDSB
00036F FEB2 E1              10      POP HL
000370 FEB3 D8              11      RET C
                                
000371 FEB4 DD4E2D          19      LD  C,(IX+2DH)  ;ディレクトリ
       FEB7                     FILE1:
000374 FEB7 060B             7      LD  B,11
000376 FEB9 1130FE          10      LD  DE,FNAME
000379 FEBC E5              11      PUSH    HL
       FEBD                     COMP:
00037A FEBD 1A               7      LD  A,(DE)
00037B FEBE BE               7      CP  (HL)
00037C FEBF 2004            12      JR  NZ,COMP1
00037E FEC1 13               6      INC DE
00037F FEC2 23               6      INC HL
000380 FEC3 10F8            13      DJNZ    COMP
       FEC5                     COMP1:
000382 FEC5 E1              10      POP HL
000383 FEC6 2809            12      JR  Z,FILE2
000385 FEC8 112000          10      LD  DE,20H
000388 FECB 19              11      ADD HL,DE
000389 FECC 0D               4      DEC C
00038A FECD 20E8            12      JR  NZ,FILE1
00038C FECF 37               4      SCF
00038D FED0 C9              10      RET
                                
       FED1                     FILE2:
00038E FED1 111A00          10      LD  DE,1AH
000391 FED4 19              11      ADD HL,DE
000392 FED5 5E               7      LD  E,(HL)
000393 FED6 23               6      INC HL
000394 FED7 56               7      LD  D,(HL)
                                
000395 FED8 210000          10      LD  HL,DTBUF
       FEDB                     RDD1:
000398 FEDB D5              11      PUSH    DE
000399 FEDC CD68FF          17      CALL    DRDC
00039C FEDF D1              10      POP DE
00039D FEE0 D8              11      RET C
00039E FEE1 E5              11      PUSH    HL
00039F FEE2 CDECFE          17      CALL    GNCL
0003A2 FEE5 E1              10      POP HL
0003A3 FEE6 7A               4      LD  A,D
0003A4 FEE7 FE0F             7      CP  0FH
0003A6 FEE9 38F0            12      JR  C,RDD1
0003A8 FEEB C9              10      RET
                                
       FEEC                     GNCL:
0003A9 FEEC 6B               4      LD  L,E     ;GET NEXT CLUSTER
0003AA FEED 62               4      LD  H,D
0003AB FEEE CB3C             8      SRL H
0003AD FEF0 CB1D             8      RR  L
0003AF FEF2 0100D0          10      LD  BC,FATBF
0003B2 FEF5 3809            12      JR  C,GNC1
0003B4 FEF7 19              11      ADD HL,DE
0003B5 FEF8 09              11      ADD HL,BC
0003B6 FEF9 5E               7      LD  E,(HL)
0003B7 FEFA 23               6      INC HL
0003B8 FEFB 7E               7      LD  A,(HL)
0003B9 FEFC E60F             7      AND 0FH
0003BB FEFE 57               4      LD  D,A
0003BC FEFF C9              10      RET
       FF00                     GNC1:
0003BD FF00 19              11      ADD HL,DE
0003BE FF01 09              11      ADD HL,BC
0003BF FF02 7E               7      LD  A,(HL)
0003C0 FF03 23               6      INC HL
0003C1 FF04 56               7      LD  D,(HL)
0003C2 FF05 0604             7      LD  B,4
       FF07                     GNC1L:
0003C4 FF07 CB3A             8      SRL D
0003C6 FF09 1F               4      RRA
0003C7 FF0A 10FB            13      DJNZ    GNC1L
                                
0003C9 FF0C 5F               4      LD  E,A
0003CA FF0D A7               4      AND A
0003CB FF0E C9              10      RET
                                
       FF0F                     DRDSB:
0003CC FF0F C5              11      PUSH    BC
0003CD FF10 D5              11      PUSH    DE
0003CE FF11 CD66FF          17      CALL    DRD
0003D1 FF14 D1              10      POP DE
0003D2 FF15 C1              10      POP BC
0003D3 FF16 D8              11      RET C
0003D4 FF17 13               6      INC DE
0003D5 FF18 10F5            13      DJNZ    DRDSB
0003D7 FF1A C9              10      RET
       FF1B                     SEEK:
0003D8 FF1B 0610             7      LD  B,16
0003DA FF1D DD4E28          19      LD  C,(IX+28H)      ;MAX SECTOR
0003DD FF20 AF               4      XOR A
0003DE FF21 EB               4      EX  DE,HL
       FF22                     DIV1:
0003DF FF22 29              11      ADD HL,HL
0003E0 FF23 8F               4      ADC A,A
0003E1 FF24 B9               4      CP  C
0003E2 FF25 3802            12      JR  C,DIV2
0003E4 FF27 91               4      SUB C
0003E5 FF28 2C               4      INC L
       FF29                     DIV2:
0003E6 FF29 10F7            13      DJNZ    DIV1
                                
0003E8 FF2B DD862F          19      ADD A,(IX+2FH)
0003EB FF2E 5F               4      LD  E,A     ;余り
                                
0003EC FF2F 55               4      LD  D,L     ;商
0003ED FF30 CB3A             8      SRL D
0003EF FF32 9F               4      SBC A,A
0003F0 FF33 E610             7      AND 10H
0003F2 FF35 F600             7  DRIVE:  OR  00H
0003F4 FF37 01FC0F          10      LD  BC,0FFCH
0003F7 FF3A F680             7      OR  80H     ;モーターオン
0003F9 FF3C ED79            12      OUT (C),A
0003FB FF3E CD50FF          17      CALL    BUSY
0003FE FF41 D8              11      RET C
                                
0003FF FF42 0EFB             7      LD  C,0FBH
000401 FF44 ED51            12      OUT (C),D
000403 FF46 7A               4      LD  A,D
000404 FF47 C6FF             7      ADD A,0FFH
000406 FF49 9F               4      SBC A,A
000407 FF4A E618             7      AND 18H     ;シーク/リストア
000409 FF4C 0EF8             7      LD  C,0F8H
00040B FF4E ED79            12      OUT (C),A
                                
       FF50                     BUSY:
00040D FF50 3E12             7      LD  A,18
       FF52                     BUSY1:
00040F FF52 3D               4      DEC A
000410 FF53 20FD            12      JR  NZ,BUSY1
000412 FF55 0EF8             7      LD  C,0F8H
000414 FF57 61               4      LD  H,C
       FF58                     BUSY2:
000415 FF58 ED78            12      IN  A,(C)
000417 FF5A E681             7      AND 81H
000419 FF5C C8              11      RET Z
00041A FF5D E3              19      EX  (SP),HL
00041B FF5E E3              19      EX  (SP),HL
00041C FF5F 2B               6      DEC HL
00041D FF60 7C               4      LD  A,H
00041E FF61 B5               4      OR  L
00041F FF62 20F4            12      JR  NZ,BUSY2
000421 FF64 37               4      SCF
000422 FF65 C9              10      RET
                                
       FF66                     DRD:
       FF68                     DRDC    EQU DRD+2
000423 0523                         ORG $$+0100H    ;$DEPHASE
       0523                     MAINE:
                                
       0523                     RDDL:
000423 FF66                         ORG DRD,RDDL-100H
       FF66                     __RDDL:
000423 FF66 1812            12      JR  DRDL
       FF68                     DRDCL:
000425 FF68 EB               4      EX  DE,HL
000426 FF69 DD7E2E          19      LD  A,(IX+2EH)  ;DE=DE+8 (2D)  !ADDCL 自己書き換え
000429 FF6C 29              11      ADD HL,HL       ;DE=DE*2 (512) !DBLCL 自己書き換え
00042A FF6D EB               4      EX  DE,HL
00042B FF6E 83               4      ADD A,E
00042C FF6F 5F               4      LD  E,A
00042D FF70 8A               4      ADC A,D
00042E FF71 93               4      SUB E
00042F FF72 57               4      LD  D,A
                                
000430 FF73 D5              11      PUSH    DE
000431 FF74 CD7AFF          17      CALL    DRDL
000434 FF77 D1              10      POP DE
000435 FF78 D8              11      RET C
000436 FF79 13               6      INC DE
       FF7A                     DRDL:
000437 FF7A E5              11      PUSH    HL
000438 FF7B CD1BFF          17      CALL    SEEK        ;ディスクリード
00043B FF7E E1              10      POP HL
00043C FF7F D8              11      RET C
00043D FF80 3E80             7      LD  A,80H
00043F FF82 01FA0F          10      LD  BC,0FFAH
000442 FF85 1803            12      JR  SKIPBUF
000444 FF87 00                      DB  0       ;0FF87H ドライブ(IPL READ)
000445 FF88 3BFE                    DW  SA      ;0FF88H スタックオーバーライド(IPL READ)
       FF8A                     SKIPBUF:
000447 FF8A ED59            12      OUT (C),E
000449 FF8C 0EF8             7      LD  C,0F8H
00044B FF8E ED79            12      OUT (C),A
00044D FF90 3E12             7      LD  A,18
       FF92                     DELAY:
00044F FF92 3D               4      DEC A
000450 FF93 20FD            12      JR  NZ,DELAY
                                
000452 FF95 0EFB             7      LD  C,0FBH
       FF97                     DRD1:
000454 FF97 78               4      LD  A,B
000455 FF98 DBF8            11      IN  A,(0F8H)
000457 FF9A 0F               4      RRCA
000458 FF9B 3008            12      JR  NC,DRD3
00045A FF9D 0F               4      RRCA
00045B FF9E 30F7            12      JR  NC,DRD1
00045D FFA0 EDA2            16      INI
00045F FFA2 04               4      INC B
000460 FFA3 18F2            12      JR  DRD1
                                
       FFA5                     DRD3:
000462 FFA5 C6FF             7      ADD A,0FFH
000464 FFA7 C9              10      RET
000465 0565                         ORG $$+0100H    ;$DEPHASE
       0565                     RDDLE:
                                
       0565                     RDDH:
000465 FF66                         ORG DRD,RDDH-100H
       FF66                     __DRDCH:
000465 FF66 1808            12      JR  DRDH
       FF68                     DRDCH:
000467 FF68 DD7E2E          19      LD  A,(IX+2EH)
00046A FF6B 83               4      ADD A,E
00046B FF6C 5F               4      LD  E,A
00046C FF6D 8A               4      ADC A,D
00046D FF6E 93               4      SUB E
00046E FF6F 57               4      LD  D,A
       FF70                     DRDH:
00046F FF70 22B5FF          16      LD  (DMAD+11),HL
000472 FF73 CD1BFF          17      CALL    SEEK
000475 FF76 D8              11      RET C
                                
000476 FF77 3E0F             7      LD  A,15
000478 FF79 21AAFF          10      LD  HL,DMAD
                                
00047B FF7C 01871F          10      LD  BC,$1F87
       FF7F                     SDMA:
00047E FF7F 04               4      INC B
00047F FF80 EDA3            16      OUTI
000481 FF82 3D               4      DEC A
000482 FF83 20FA            12      JR  NZ,SDMA
                                
000484 FF85 3E80             7      LD  A,80H
000486 FF87 C5              11      PUSH    BC
000487 FF88 01FA0F          10      LD  BC,0FFAH
00048A FF8B ED59            12      OUT (C),E
00048C FF8D 0EF8             7      LD  C,0F8H
00048E FF8F ED79            12      OUT (C),A
                                
000490 FF91 CD50FF          17      CALL    BUSY
000493 FF94 ED78            12      IN  A,(C)
                                
000495 FF96 2AB5FF          16      LD  HL,(DMAD+11)
000498 FF99 23               6      INC HL
000499 FF9A 1106BB          10      LD  DE,0BB06H   ;READ DMA
                                
00049C FF9D C1              10      POP BC
00049D FF9E ED51            12      OUT (C),D
00049F FFA0 ED59            12      OUT (C),E
0004A1 FFA2 ED58            12      IN  E,(C)
0004A3 FFA4 ED50            12      IN  D,(C)
0004A5 FFA6 19              11      ADD HL,DE
0004A6 FFA7 C6FF             7      ADD A,0FFH
0004A8 FFA9 C9              10      RET
                                
       FFAA                     DMAD:
0004A9 FFAA C37DFB0FFFFF2C10        DB  0C3H,7DH,0FBH,0FH,0FFH,0FFH,2CH,10H ;X1turbo
0004B1 FFB2 80928D0000CF87          DB  80H,92H,8DH,00H,00H,0CFH,87H        ;DISK DMA
0004B8 05B8                         ORG $$+0100H    ;$DEPHASE
       05B8                     RDDHE:
                                
       05B8                     RDDE:
0004B8 FF66                         ORG DRD,RDDE-100H
0004B8 FF66 180D            12      JR  DRDE
       FF68                     DRDCE:
0004BA FF68 3E04             7      LD  A,4
0004BC FF6A 3236FF          13      LD  (DRIVE+1),A
0004BF FF6D DD7E2E          19      LD  A,(IX+2EH)
0004C2 FF70 83               4      ADD A,E
0004C3 FF71 5F               4      LD  E,A
0004C4 FF72 8A               4      ADC A,D
0004C5 FF73 93               4      SUB E
0004C6 FF74 57               4      LD  D,A
       FF75                     DRDE:
0004C7 FF75 EB               4      EX  DE,HL
0004C8 FF76 29              11      ADD HL,HL
0004C9 FF77 29              11      ADD HL,HL
0004CA FF78 DD4620          19      LD  B,(IX+20H)
0004CD FF7B 0E00             7      LD  C,0
0004CF FF7D 09              11      ADD HL,BC
0004D0 FF7E 060D             7      LD  B,0DH
0004D2 FF80 ED49            12      OUT (C),C
0004D4 FF82 0C               4      INC C
0004D5 FF83 ED69            12      OUT (C),L
0004D7 FF85 0C               4      INC C
0004D8 FF86 ED61            12      OUT (C),H
0004DA FF88 0C               4      INC C
0004DB FF89 EB               4      EX  DE,HL
0004DC FF8A AF               4      XOR A
       FF8B                     EDRDC1:
0004DD FF8B EDA2            16      INI
0004DF FF8D 04               4      INC B
0004E0 FF8E EDA2            16      INI
0004E2 FF90 04               4      INC B
0004E3 FF91 EDA2            16      INI
0004E5 FF93 04               4      INC B
0004E6 FF94 EDA2            16      INI
0004E8 FF96 04               4      INC B
0004E9 FF97 3D               4      DEC A
0004EA FF98 20F1            12      JR  NZ,EDRDC1
0004EC FF9A AF               4      XOR A
0004ED FF9B C9              10      RET
       FF9C                     ESA:
0004EE FF9C 2100FC          10      LD  HL,0FC00H
0004F1 FF9F 1100FE          10      LD  DE,IPL
0004F4 FFA2 019C01          10      LD  BC,ESA-IPL
0004F7 FFA5 EDB0                    LDIR
0004F9 FFA7 C33BFE          10      JP  SA
       FFAA                     EED:
0004FC 05FC                         ORG $$+0100H    ;$DEPHASE
       05FC                     RDDEE:
                                
       05FC                     LIPL:
0004FC 05FC EBFE904C44202020        DB  0EBH,0FEH,90H,"LD",20H,20H,20H
000504 0604 2020200002020100        DB  20H,20H,20H,00H,02H,02H,01H,00H
00050C 060C 027000D002FD0200        DB  02H,70H,00H,0D0H,02H,0FDH,02H,00H
000514 0614 09000200000018FE        DB  09H,00H,02H,00H,00H,00H,18H,0FEH
00051C 061C 0000000000000000        DB  0,0,0,0,0,0,0,0
000524 0624 0901020507700801        DB  9,1,2,5,7,112,8,1
                                
       062C                     HIPL:
00052C 062C EBFE904C44202020        DB  0EBH,0FEH,90H,"LD",20H,20H,20H
000534 0634 2020200004010100        DB  20H,20H,20H,00H,04H,01H,01H,00H
00053C 063C 02C000D004FE0200        DB  02H,0C0H,00H,0D0H,04H,0FEH,02H,00H
000544 0644 08000200000018FE        DB  08H,00H,02H,00H,00H,00H,18H,0FEH
00054C 064C 0000000000000000        DB  0,0,0,0,0,0,0,0
000554 0654 0801020506C00901        DB  8,1,2,5,6,192,9,1
                                
       065C                     SIPL:
00055C 065C EB1E904C44202020        DB  0EBH,1EH,90H,"LD",20H,20H,20H
000564 0664 2020203248532020        DB  20H,20H,20H,"2","H","S",20H,20H
00056C 066C 2020040001030001        DB  20H,20H,04H,00H,01H,03H,00H,01H
000574 0674 00C005A0FB0118FE        DB  00H,0C0H,05H,0A0H,0FBH,01H,18H,0FEH
00057C 067C EBFE000000000000        DB  0EBH,0FEH,0,0,0,0,0,0
000584 0684 0901030406C0080A        DB  9,1,3,4,6,192,8,10
                                
       068C                     CIPL:
00058C 068C EBFE904C44202020        DB  0EBH,0FEH,90H,"LD",20H,20H,20H
000594 0694 2020200002010100        DB  20H,20H,20H,00H,02H,01H,01H,00H
00059C 069C 02E0006009F90700        DB  02H,0E0H,00H,060H,09H,0F9H,07H,00H
0005A4 06A4 0F000200000018FE        DB  0FH,00H,02H,00H,00H,00H,18H,0FEH
0005AC 06AC 0000000000000000        DB  0,0,0,0,0,0,0,0
0005B4 06B4 0F01070F0EE01B01        DB  15,1,7,15,14,224,27,1
                                
       06BC                     EIPL:
0005BC 06BC 014C53582D446F64        DB  01H,"LSX-Dodgers  Sy"
            6765727320205379    
0005CC 06CC 7320AA0100FC9CFD        DB  "s",20H,EED,01H,00H,0FCH,ESA,ESA/256-2
0005D4 06D4 0000000000000000        DB  00H,00H,00H,00H,00H,00H,00H,00H
0005DC 06DC 0000000000000000        DB  00H,00H,00H,00H,00H,00H,00H,00H
0005E4 06E4 0801020506C00901        DB  8,1,2,5,6,192,9,1
                                
       06EC                     JUMP:
0005EC 06EC 3BFE3BFE3BFE3BFE        DW  SA,SA,SA,SA,SA,SA,SA,SA
            3BFE3BFE3BFE3BFE    
0005FC 06FC 3BFE3BFE3BFE3BFE        DW  SA,SA,SA,SA,SA,SA,SA,SA
            3BFE3BFE3BFE3BFE    
                                
       070C                     FCB2:
00060C 070C 004C442020202020        DB  0,"LD      BIN"
            2042494E            
000618 0718                         DS  25,0
                                
       0731                     FCB3:
000631 0731 004C442020202020        DB  0,"LD      BIN"
            2042494E            
00063D 073D                         DS  25,0
                                
       0756                     SDIR:
000656 0756 0000                    DW  0
       0758                     SIZE:
000658 0758 0000                    DW  0
       075A                     DATA:
[EOF:SYS.ASM:SHIFT_JIS]
