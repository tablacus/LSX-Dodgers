                                ;*** AILZ80ASM *** Z-80 Assembler, version 1.0.0.0, LST:Full:4
                                
                                ;   VIEW    by Gaku
                                
       0050                     WIDTH   EQU 80
       0005                     SYSTEM  EQU 0005H
       005C                     FCB1    EQU 005CH
       0080                     DTA EQU 0080H
       2F81                     _SFTJIS EQU 2F81H
       2FC3                     _JISVRM EQU 2FC3H
       EC96                     _COLORF EQU 0EC96H
                                
000000 0100                         ORG 0100H
000000 0100 C36701          10      JP  START
       0103                     TITLE:
000003 0103 766965772076312E        DB  "view v1.01",0DH,0AH
            30310D0A            
00000F 010F 8E67977096403A          DB  "使用法:"
000016 0116 2056494557208374        DB  " VIEW ファイル名",0DH,0AH
            83408343838B96BC    
            0D0A                
000028 0128 24                      DB  "$"
       0129                     EMES1:
000029 0129 837483408343838B        DB  "ファイルが見つかりません$"
            82AA8CA982C282A9    
            82E882DC82B982F1    
            24                  
       0142                     EMES2:
000042 0142 837483408343838B        DB  "ファイルの読み込みに失敗しました$"
            82CC93C782DD8D9E    
            82DD82C98EB89473    
            82B582DC82B582BD    
            24                  
       0163                     EMES:
000063 0163 070D0A24                DB  7,0DH,0AH,"$"
                                
       0167                     START:
000067 0167 3A0B00          13      LD  A,(000BH)
00006A 016A 322902          13      LD  (SMC01+2),A
00006D 016D 322F02          13      LD  (SMC02+2),A
000070 0170 326302          13      LD  (SMC03+2),A
                                ;               Read File
000073 0173 3A5D00          13      LD  A,(FCB1+1)
000076 0176 FE21             7      CP  21H
000078 0178 DA4904          10      JP  C,USAGE
                                
00007B 017B 118000          10      LD  DE,DTA
00007E 017E 0E1A             7      LD  C,1AH
000080 0180 CD0500          17      CALL    SYSTEM
                                
000083 0183 115C00          10      LD  DE,FCB1
000086 0186 0E11             7      LD  C,11H
000088 0188 CD0500          17      CALL    SYSTEM
00008B 018B B7               4      OR  A
00008C 018C C25404          10      JP  NZ,ERROR1
       018F                     FILES:
00008F 018F 118000          10      LD  DE,DTA
000092 0192 0E0F             7      LD  C,0FH
000094 0194 CD0500          17      CALL    SYSTEM
000097 0197 B7               4      OR  A
000098 0198 C25404          10      JP  NZ,ERROR1
                                
00009B 019B 210000          10      LD  HL,0
00009E 019E 22A100          16      LD  (DTA+33),HL
0000A1 01A1 22A300          16      LD  (DTA+35),HL
0000A4 01A4 2C               4      INC L
0000A5 01A5 228E00          16      LD  (DTA+14),HL
                                
0000A8 01A8 118F08          10      LD  DE,DATA2
0000AB 01AB 0E1A             7      LD  C,1AH
0000AD 01AD CD0500          17      CALL    SYSTEM
                                
0000B0 01B0 2A0600          16      LD  HL,(SYSTEM+1)
0000B3 01B3 118F08          10      LD  DE,DATA2
0000B6 01B6 ED52            15      SBC HL,DE
0000B8 01B8 118000          10      LD  DE,DTA
0000BB 01BB 0E27             7      LD  C,27H
0000BD 01BD CD0500          17      CALL    SYSTEM
0000C0 01C0 C6FE             7      ADD A,0FEH
0000C2 01C2 DA5904          10      JP  C,ERROR2
                                ;               Change Data
0000C5 01C5 EB               4      EX  DE,HL       ;DE=SIZE
0000C6 01C6 13               6      INC DE
0000C7 01C7 218F04          10      LD  HL,DATA
0000CA 01CA FD218F08        14      LD  IY,DATA2
0000CE 01CE AF               4      XOR A
0000CF 01CF CD1F03          17      CALL    WRITE
       01D2                     CHG1:
0000D2 01D2 0650             7      LD  B,WIDTH
       01D4                     CHG2:
0000D4 01D4 1B               6      DEC DE
0000D5 01D5 7A               4      LD  A,D
0000D6 01D6 B3               4      OR  E
0000D7 01D7 284C            12      JR  Z,CHGE
                                
0000D9 01D9 FD7E00          19      LD  A,(IY+0)
0000DC 01DC FD23            10      INC IY
0000DE 01DE FE0A             7      CP  0AH
0000E0 01E0 28F2            12      JR  Z,CHG2
0000E2 01E2 FE0D             7      CP  0DH
0000E4 01E4 2838            12      JR  Z,CHG4
                                
0000E6 01E6 FE80             7      CP  80H
0000E8 01E8 381E            12      JR  C,CHGA
0000EA 01EA FEA0             7      CP  0A0H
0000EC 01EC 3804            12      JR  C,CHGK
0000EE 01EE FEE0             7      CP  0E0H
0000F0 01F0 3816            12      JR  C,CHGA
       01F2                     CHGK:
0000F2 01F2 13               6      INC DE
0000F3 01F3 FD2B            10      DEC IY
0000F5 01F5 05               4      DEC B
0000F6 01F6 2826            12      JR  Z,CHG4
0000F8 01F8 FD23            10      INC IY
                                
0000FA 01FA CD1F03          17      CALL    WRITE
                                
0000FD 01FD 1B               6      DEC DE
0000FE 01FE 1B               6      DEC DE
0000FF 01FF 7A               4      LD  A,D
000100 0200 B3               4      OR  E
000101 0201 2822            12      JR  Z,CHGE
000103 0203 FD7E00          19      LD  A,(IY+0)
000106 0206 FD23            10      INC IY
       0208                     CHGA:
000108 0208 CD1F03          17      CALL    WRITE
00010B 020B FE09             7      CP  9
00010D 020D 2006            12      JR  NZ,CHG3
                                
00010F 020F 78               4      LD  A,B
000110 0210 3D               4      DEC A
000111 0211 E6F8             7      AND 0F8H
000113 0213 3C               4      INC A
000114 0214 47               4      LD  B,A
       0215                     CHG3:
000115 0215 10BD            13      DJNZ    CHG2
                                
000117 0217 FD7E00          19      LD  A,(IY+0)
00011A 021A FE0D             7      CP  0DH
00011C 021C 28B6            12      JR  Z,CHG2
       021E                     CHG4:
00011E 021E 3E0D             7      LD  A,0DH
000120 0220 CD1F03          17      CALL    WRITE
000123 0223 18AD            12      JR  CHG1
       0225                     CHGE:
000125 0225 3600            10      LD  (HL),0
                                
000127 0227 3A96EC          13  SMC01:  LD  A,(_COLORF)
00012A 022A F5              11      PUSH    AF
00012B 022B 3E0E             7      LD  A,0EH
00012D 022D 3296EC          13  SMC02:  LD  (_COLORF),A
                                
000130 0230 1E0B             7      LD  E,11
000132 0232 0E06             7      LD  C,6
000134 0234 CD0500          17      CALL    SYSTEM
000137 0237 1E20             7      LD  E,20H
000139 0239 CD0500          17      CALL    SYSTEM
                                
00013C 023C 218100          10      LD  HL,DTA+1
00013F 023F 010608          10      LD  BC,8*256+6
       0242                     NAME:
000142 0242 5E               7      LD  E,(HL)
000143 0243 23               6      INC HL
000144 0244 C5              11      PUSH    BC
000145 0245 CD0500          17      CALL    SYSTEM
000148 0248 C1              10      POP BC
000149 0249 10F7            13      DJNZ    NAME
                                
00014B 024B 1E2E             7      LD  E,"."
00014D 024D CD0500          17      CALL    SYSTEM
                                
000150 0250 0603             7      LD  B,3
       0252                     EXT:
000152 0252 5E               7      LD  E,(HL)
000153 0253 23               6      INC HL
000154 0254 C5              11      PUSH    BC
000155 0255 CD0500          17      CALL    SYSTEM
000158 0258 C1              10      POP BC
000159 0259 10F7            13      DJNZ    EXT
                                
00015B 025B 1E05             7      LD  E,5
00015D 025D CD0500          17      CALL    SYSTEM
                                
000160 0260 F1              10      POP AF
000161 0261 3296EC          13  SMC03:  LD  (_COLORF),A
                                
       0264                     KBUF:
000164 0264 1EFF             7      LD  E,0FFH
000166 0266 CD0500          17      CALL    SYSTEM
000169 0269 B7               4      OR  A
00016A 026A 20F8            12      JR  NZ,KBUF
                                
00016C 026C 219004          10      LD  HL,DATA+1
       026F                     MAIN:
00016F 026F CD4903          17      CALL    PAGE
       0272                     MAIN1:
000172 0272 1EFF             7      LD  E,0FFH
000174 0274 0E06             7      LD  C,6
000176 0276 CD0500          17      CALL    SYSTEM
000179 0279 FE03             7      CP  3
00017B 027B CA7704          10      JP  Z,QUIT
00017E 027E FE1B             7      CP  1BH
000180 0280 CA6C04          10      JP  Z,ESC
                                
000183 0283 FE1F             7      CP  1FH
000185 0285 2812            12      JR  Z,DOWN
000187 0287 FE1E             7      CP  1EH
000189 0289 282E            12      JR  Z,UP
00018B 028B FE1D             7      CP  1DH
00018D 028D 286F            12      JR  Z,PGUP
00018F 028F FE1C             7      CP  1CH
000191 0291 284B            12      JR  Z,PGDW
000193 0293 FE20             7      CP  20H
000195 0295 2874            12      JR  Z,NFILES
000197 0297 18D9            12      JR  MAIN1
                                
       0299                     DOWN:
000199 0299 2A8D04          16      LD  HL,(TEXT2)
00019C 029C 7E               7      LD  A,(HL)
00019D 029D B7               4      OR  A
00019E 029E 28D2            12      JR  Z,MAIN1
                                
0001A0 02A0 E5              11      PUSH    HL
0001A1 02A1 CDD703          17      CALL    SCRUP
0001A4 02A4 E1              10      POP HL
0001A5 02A5 013037          10      LD  BC,3000H+80*23
0001A8 02A8 CD5B03          17      CALL    PRINT
0001AB 02AB 228D04          16      LD  (TEXT2),HL
                                
0001AE 02AE 2A8B04          16      LD  HL,(TEXT)
0001B1 02B1 CD3303          17      CALL    NEXT
0001B4 02B4 228B04          16      LD  (TEXT),HL
0001B7 02B7 18B9            12      JR  MAIN1
       02B9                     UP:
0001B9 02B9 2A8B04          16      LD  HL,(TEXT)
0001BC 02BC 2B               6      DEC HL
0001BD 02BD 7E               7      LD  A,(HL)
0001BE 02BE B7               4      OR  A
0001BF 02BF 28B1            12      JR  Z,MAIN1
                                
0001C1 02C1 CDF003          17      CALL    SCRDW
0001C4 02C4 2A8B04          16      LD  HL,(TEXT)
0001C7 02C7 CD3C03          17      CALL    BACK
0001CA 02CA 228B04          16      LD  (TEXT),HL
0001CD 02CD 015030          10      LD  BC,3000H+80
0001D0 02D0 CD5B03          17      CALL    PRINT
                                
0001D3 02D3 2A8D04          16      LD  HL,(TEXT2)
0001D6 02D6 CD3C03          17      CALL    BACK
0001D9 02D9 228D04          16      LD  (TEXT2),HL
0001DC 02DC 1894            12      JR  MAIN1
       02DE                     PGDW:
0001DE 02DE 0616             7      LD  B,22
       02E0                     PGDW1:
0001E0 02E0 2A8D04          16      LD  HL,(TEXT2)
0001E3 02E3 7E               7      LD  A,(HL)
0001E4 02E4 B7               4      OR  A
0001E5 02E5 2811            12      JR  Z,PGDW2
                                
0001E7 02E7 CD3303          17      CALL    NEXT
0001EA 02EA 228D04          16      LD  (TEXT2),HL
                                
0001ED 02ED 2A8B04          16      LD  HL,(TEXT)
0001F0 02F0 CD3303          17      CALL    NEXT
0001F3 02F3 228B04          16      LD  (TEXT),HL
0001F6 02F6 10E8            13      DJNZ    PGDW1
       02F8                     PGDW2:
0001F8 02F8 2A8B04          16      LD  HL,(TEXT)
0001FB 02FB C36F02          10      JP  MAIN
                                
       02FE                     PGUP:
0001FE 02FE 2A8B04          16      LD  HL,(TEXT)
000201 0301 0616             7      LD  B,22
       0303                     PGUP1:
000203 0303 CD3C03          17      CALL    BACK
000206 0306 10FB            13      DJNZ    PGUP1
000208 0308 C36F02          10      JP  MAIN
                                
       030B                     NFILES:
00020B 030B 118000          10      LD  DE,DTA
00020E 030E 0E1A             7      LD  C,1AH
000210 0310 CD0500          17      CALL    SYSTEM
                                
000213 0313 0E12             7      LD  C,12H
000215 0315 CD0500          17      CALL    SYSTEM
000218 0318 B7               4      OR  A
000219 0319 C27704          10      JP  NZ,QUIT
00021C 031C C38F01          10      JP  FILES
                                
       031F                     WRITE:
00021F 031F D5              11      PUSH    DE
000220 0320 ED5B0600        20      LD  DE,(SYSTEM+1)
000224 0324 15               4      DEC D
000225 0325 A7               4      AND A
000226 0326 ED52            15      SBC HL,DE
000228 0328 19              11      ADD HL,DE
000229 0329 D1              10      POP DE
00022A 032A 3003            12      JR  NC,WRITE1
00022C 032C 77               7      LD  (HL),A
00022D 032D 23               6      INC HL
00022E 032E C9              10      RET
       032F                     WRITE1:
00022F 032F F1              10      POP AF
000230 0330 C32502          10      JP  CHGE
                                
       0333                     NEXT:
000233 0333 7E               7      LD  A,(HL)
000234 0334 B7               4      OR  A
000235 0335 C8              11      RET Z
000236 0336 23               6      INC HL
000237 0337 FE0D             7      CP  0DH
000239 0339 20F8            12      JR  NZ,NEXT
00023B 033B C9              10      RET
                                
       033C                     BACK:
00023C 033C 2B               6      DEC HL
00023D 033D 7E               7      LD  A,(HL)
       033E                     BACK1:
00023E 033E B7               4      OR  A
00023F 033F 2806            12      JR  Z,BACKE
000241 0341 2B               6      DEC HL
000242 0342 7E               7      LD  A,(HL)
000243 0343 FE0D             7      CP  0DH
000245 0345 20F7            12      JR  NZ,BACK1
       0347                     BACKE:
000247 0347 23               6      INC HL
000248 0348 C9              10      RET
                                
       0349                     PAGE:
000249 0349 228B04          16      LD  (TEXT),HL
00024C 034C 015030          10      LD  BC,3000H+80
00024F 034F 1617             7      LD  D,23
       0351                     PAGE1:
000251 0351 CD5B03          17      CALL    PRINT
000254 0354 15               4      DEC D
000255 0355 20FA            12      JR  NZ,PAGE1
000257 0357 228D04          16      LD  (TEXT2),HL
00025A 035A C9              10      RET
                                
       035B                     PRINT:
00025B 035B 1E50             7      LD  E,80
       035D                     PRINT1:
00025D 035D 7E               7      LD  A,(HL)
00025E 035E B7               4      OR  A
00025F 035F 284D            12      JR  Z,PRINTE2
000261 0361 23               6      INC HL
000262 0362 FE0D             7      CP  0DH
000264 0364 2848            12      JR  Z,PRINTE2
                                
000266 0366 FE80             7      CP  80H
000268 0368 382B            12      JR  C,ANK
00026A 036A FEA0             7  KANFLG: CP  0A0H
00026C 036C 3804            12      JR  C,KANJI
00026E 036E FEE0             7      CP  0E0H
000270 0370 3823            12      JR  C,ANK
       0372                     KANJI:
000272 0372 D5              11      PUSH    DE
000273 0373 C5              11      PUSH    BC
000274 0374 57               4      LD  D,A
000275 0375 5E               7      LD  E,(HL)
000276 0376 23               6      INC HL
000277 0377 01812F          10      LD  BC,_SFTJIS
00027A 037A DF              12      RST 18H
00027B 037B 01C32F          10      LD  BC,_JISVRM
00027E 037E DF              12      RST 18H
00027F 037F C1              10      POP BC
000280 0380 ED59            12      OUT (C),E
000282 0382 03               6      INC BC
000283 0383 ED59            12      OUT (C),E
000285 0385 0B               6      DEC BC
000286 0386 CBD8             8      SET 3,B
000288 0388 ED51            12      OUT (C),D
00028A 038A 03               6      INC BC
00028B 038B CBF2             8      SET 6,D
00028D 038D ED51            12      OUT (C),D
00028F 038F CB98             8      RES 3,B
000291 0391 D1              10      POP DE
000292 0392 1D               4      DEC E
000293 0393 180C            12      JR  PRINTL
       0395                     ANK:
000295 0395 FE09             7      CP  9
000297 0397 2825            12      JR  Z,TAB
000299 0399 ED79            12      OUT (C),A
00029B 039B CBD8             8      SET 3,B
00029D 039D ED71                    DB  0EDH,71H
00029F 039F CB98             8      RES 3,B
       03A1                     PRINTL:
0002A1 03A1 03               6      INC BC
       03A2                     PRINTL1:
0002A2 03A2 1D               4      DEC E
0002A3 03A3 20B8            12      JR  NZ,PRINT1
       03A5                     PRINTE:
0002A5 03A5 7E               7      LD  A,(HL)
0002A6 03A6 B7               4      OR  A
0002A7 03A7 2805            12      JR  Z,PRINTE2
0002A9 03A9 23               6      INC HL
0002AA 03AA FE0D             7      CP  0DH
0002AC 03AC 20F7            12      JR  NZ,PRINTE
       03AE                     PRINTE2:
0002AE 03AE 3E20             7      LD  A,20H
0002B0 03B0 1C               4      INC E
       03B1                     PRINTE3:
0002B1 03B1 1D               4      DEC E
0002B2 03B2 C8              11      RET Z
0002B3 03B3 ED79            12      OUT (C),A
0002B5 03B5 CBD8             8      SET 3,B
0002B7 03B7 ED71                    DB  0EDH,71H
0002B9 03B9 CB98             8      RES 3,B
0002BB 03BB 03               6      INC BC
0002BC 03BC 18F3            12      JR  PRINTE3
       03BE                     TAB:
0002BE 03BE 7B               4      LD  A,E
0002BF 03BF 3D               4      DEC A
0002C0 03C0 E6F8             7      AND 0F8H
0002C2 03C2 93               4      SUB E
       03C3                     TAB1:
0002C3 03C3 F5              11      PUSH    AF
0002C4 03C4 3E20             7      LD  A,20H
0002C6 03C6 ED79            12      OUT (C),A
0002C8 03C8 CBD8             8      SET 3,B
0002CA 03CA ED71                    DB  0EDH,71H
0002CC 03CC CB98             8      RES 3,B
0002CE 03CE 03               6      INC BC
0002CF 03CF F1              10      POP AF
0002D0 03D0 1D               4      DEC E
0002D1 03D1 3C               4      INC A
0002D2 03D2 20EF            12      JR  NZ,TAB1
0002D4 03D4 1C               4      INC E
0002D5 03D5 18CB            12      JR  PRINTL1
                                
       03D7                     SCRUP:
0002D7 03D7 215030          10      LD  HL,3000H+80
0002DA 03DA CD0904          17      CALL    SCR1
                                
       03DD                     SCRUP1:
0002DD 03DD B7               4      OR  A
0002DE 03DE C8              11      RET Z
0002DF 03DF F5              11      PUSH    AF
0002E0 03E0 CD2D04          17      CALL    UPSUB       ;テキスト
0002E3 03E3 11B007          10      LD  DE,800H-80
0002E6 03E6 19              11      ADD HL,DE
0002E7 03E7 CD2D04          17      CALL    UPSUB       ;漢字
0002EA 03EA CB9C             8      RES 3,H
0002EC 03EC F1              10      POP AF
0002ED 03ED 3D               4      DEC A
0002EE 03EE 18ED            12      JR  SCRUP1
                                
       03F0                     SCRDW:
0002F0 03F0 213037          10      LD  HL,3000H+80*23
0002F3 03F3 CD0904          17      CALL    SCR1
       03F6                     SCRDW1:
0002F6 03F6 B7               4      OR  A
0002F7 03F7 C8              11      RET Z
0002F8 03F8 F5              11      PUSH    AF
0002F9 03F9 CD2804          17      CALL    DWSUB       ;テキスト
0002FC 03FC 115008          10      LD  DE,800H+80
0002FF 03FF 19              11      ADD HL,DE
000300 0400 CD2804          17      CALL    DWSUB       ;漢字
000303 0403 CB9C             8      RES 3,H
000305 0405 F1              10      POP AF
000306 0406 3D               4      DEC A
000307 0407 18ED            12      JR  SCRDW1
       0409                     SCR1:
000309 0409 3E16             7      LD  A,22
00030B 040B 01801F          10      LD  BC,1F80H    ;DMA
00030E 040E 1EC3             7      LD  E,0C3H
000310 0410 ED59            12      OUT (C),E
000312 0412 119A65          10      LD  DE,659AH
000315 0415 ED59            12      OUT (C),E
000317 0417 ED51            12      OUT (C),D
000319 0419 114F00          10      LD  DE,79
00031C 041C ED59            12      OUT (C),E
00031E 041E ED51            12      OUT (C),D
                                
000320 0420 11181C          10      LD  DE,1C18H
000323 0423 ED51            12      OUT (C),D
000325 0425 ED59            12      OUT (C),E
000327 0427 C9              10      RET
       0428                     DWSUB:
000328 0428 11B0FF          10      LD  DE,-80
00032B 042B 1803            12      JR  DWSUB1
       042D                     UPSUB:
00032D 042D 115000          10      LD  DE,80
       0430                     DWSUB1:
000330 0430 3ECD             7      LD  A,0CDH
000332 0432 ED79            12      OUT (C),A
000334 0434 ED69            12      OUT (C),L       ;SOURCE
000336 0436 ED61            12      OUT (C),H
000338 0438 19              11      ADD HL,DE
000339 0439 3E1D             7      LD  A,1DH
00033B 043B ED79            12      OUT (C),A       ;DIST
00033D 043D ED69            12      OUT (C),L
00033F 043F ED61            12      OUT (C),H
000341 0441 1187CF          10      LD  DE,0CF87H
000344 0444 ED51            12      OUT (C),D
000346 0446 ED59            12      OUT (C),E
000348 0448 C9              10      RET
                                
       0449                     USAGE:
000349 0449 110301          10      LD  DE,TITLE
00034C 044C 0E09             7      LD  C,9
00034E 044E CD0500          17      CALL    SYSTEM
000351 0451 C30000          10      JP  0
                                
       0454                     ERROR1:
000354 0454 112901          10      LD  DE,EMES1
000357 0457 1803            12      JR  ERROR
       0459                     ERROR2:
000359 0459 114201          10      LD  DE,EMES2
       045C                     ERROR:
00035C 045C 0E09             7      LD  C,9
00035E 045E CD0500          17      CALL    SYSTEM
                                
000361 0461 116301          10      LD  DE,EMES
000364 0464 0E09             7      LD  C,9
000366 0466 CD0500          17      CALL    SYSTEM
000369 0469 C30000          10      JP  0
                                
       046C                     ESC:
00036C 046C 1EFF             7      LD  E,0FFH
00036E 046E 0E06             7      LD  C,6
000370 0470 CD0500          17      CALL    SYSTEM
000373 0473 B7               4      OR  A
000374 0474 C27202          10      JP  NZ,MAIN1
                                
       0477                     QUIT:
000377 0477 1EFF             7      LD  E,0FFH
000379 0479 0E06             7      LD  C,6
00037B 047B CD0500          17      CALL    SYSTEM
00037E 047E B7               4      OR  A
00037F 047F 20F6            12      JR  NZ,QUIT
                                
000381 0481 1E0C             7      LD  E,0CH
000383 0483 0E06             7      LD  C,6
000385 0485 CD0500          17      CALL    SYSTEM
000388 0488 C30000          10      JP  0
                                
00038B 048B 8F04                TEXT:   DW  DATA
00038D 048D 8F04                TEXT2:  DW  DATA
                                
       048F                     DATA:
       088F                     DATA2   EQU DATA+1024
                                
[EOF:VIEW.ASM:SHIFT_JIS]
