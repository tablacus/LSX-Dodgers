                                ;*** AILZ80ASM *** Z-80 Assembler, version 1.0.0.0, LST:Full:4
                                ;
                                ;   MAG  by Gaku
                                ;
       000B                     THOLD   EQU 11
       0050                     WIDTH   EQU 80
                                ;
       0003                     OSFLG   EQU $0003
       0005                     SYSTEM  EQU $0005
       000F                     JP_HL   EQU $000F
       0018                     BIOS    EQU $0018
       005C                     FCB1    EQU $005C
       0080                     DTA EQU $0080
                                
       1000                     FLAGBF  EQU $1000       ;256
       1100                     LINEBF  EQU FLAGBF+256  ;16*512 リングバッファ
                                
       3100                     KWABF1: EQU LINEBF+16*512
       3900                     KWABF2: EQU KWABF1+2048
                                
       1000                     BUFSIZ  EQU 4*1024
       4100                     DTBUF   EQU KWABF2+2048
       5100                     DTBUFE  EQU DTBUF+BUFSIZ
                                
       2000                     PDSIZE  EQU 8*1024
       5100                     PDBUF   EQU DTBUFE
       7100                     PDBUFE  EQU PDBUF+PDSIZE
                                
       7100                     HEADBF  EQU PDBUFE
       7120                     PALBF   EQU HEADBF+32
                                
000000 0100                         ORG $0100
000000 0100 C30301          10      JP  START
       0103                     START:
000003 0103 3A0B00          13      LD  A,(000BH)
000006 0106 328603          13      LD  (SMC01+2),A
000009 0109 32A903          13      LD  (SMC02+2),A
00000C 010C 32AF03          13      LD  (SMC03+2),A
00000F 010F 323F04          13      LD  (SMC04+2),A
000012 0112 324404          13      LD  (SMC05+2),A
000015 0115 326004          13      LD  (SMC06+2),A
000018 0118 326504          13      LD  (SMC07+2),A
00001B 011B 320C05          13      LD  (SMC08+2),A
00001E 011E 328F07          13      LD  (SMC09+2),A
000021 0121 329407          13      LD  (SMC10+2),A
000024 0124 32A207          13      LD  (SMC11+2),A
000027 0127 32DC07          13      LD  (SMC12+2),A
00002A 012A 32E107          13      LD  (SMC13+2),A
00002D 012D 32EF07          13      LD  (SMC14+2),A
000030 0130 320508          13      LD  (SMC15+2),A
000033 0133 321808          13      LD  (SMC16+2),A
000036 0136 322008          13      LD  (SMC17+2),A
000039 0139 322A08          13      LD  (SMC18+2),A
00003C 013C 328D08          13      LD  (SMC19+2),A
00003F 013F 32F60A          13      LD  (SMC20+2),A
000042 0142 32FC0A          13      LD  (SMC21+2),A
000045 0145 11980C          10      LD  DE,TITLE
000048 0148 0E09             7      LD  C,9
00004A 014A CD0500          17      CALL    SYSTEM
00004D 014D 3A5C00          13      LD  A,(FCB1)
000050 0150 B7               4      OR  A
000051 0151 2010            12      JR  NZ,MAIN
000053 0153 3A5D00          13      LD  A,(FCB1+1)
000056 0156 FE20             7      CP  $20
000058 0158 2009            12      JR  NZ,MAIN
       015A                     USAGE:
00005A 015A 11B40C          10      LD  DE,MUSAGE
00005D 015D 0E09             7      LD  C,9
00005F 015F CD0500          17      CALL    SYSTEM
000062 0162 C7              12      RST 0
       0163                     MAIN:
000063 0163 2A0300          16      LD  HL,(OSFLG)
000066 0166 7C               4      LD  A,H
000067 0167 FE1D             7      CP  $1D
000069 0169 C0              11      RET NZ
00006A 016A 7D               4      LD  A,L
00006B 016B E67F             7      AND $7F
00006D 016D C0              11      RET NZ
                                
00006E 016E ED7B0600        20      LD  SP,(SYSTEM+1)
000072 0172 215D00          10      LD  HL,FCB1+1
000075 0175 7E               7      LD  A,(HL)
000076 0176 FE20             7      CP  $20
000078 0178 2007            12      JR  NZ,ALL2
00007A 017A 0608             7      LD  B,8
       017C                     ALL1:
00007C 017C 363F            10      LD  (HL),"?"
00007E 017E 23               6      INC HL
00007F 017F 10FB            13      DJNZ    ALL1
       0181                     ALL2:
                                                ;拡張子 MAG
000081 0181 3A6500          13      LD  A,(FCB1+9)
000084 0184 FE20             7      CP  $20
000086 0186 200B            12      JR  NZ,EXT1
000088 0188 214D41          10      LD  HL,"A"*256+"M"
00008B 018B 226500          16      LD  (FCB1+9),HL
00008E 018E 3E47             7      LD  A,"G"
000090 0190 326700          13      LD  (FCB1+11),A
       0193                     EXT1:
000093 0193 118100          10      LD  DE,DTA+1
       0196                     SW0:
000096 0196 CD3B08          17      CALL    SWITCH
000099 0199 FE21             7      CP  $21
00009B 019B DA3202          10      JP  C,LOAD
00009E 019E FE43             7      CP  "C"
0000A0 01A0 2005            12      JR  NZ,SW1
0000A2 01A2 32B702          13      LD  (CLSSW+1),A
0000A5 01A5 18EF            12      JR  SW0
       01A7                     SW1:
0000A7 01A7 FE52             7      CP  "R"
0000A9 01A9 2007            12      JR  NZ,SW2
0000AB 01AB 3E06             7      LD  A,6
0000AD 01AD 327603          13      LD  (RGBSW+1),A
0000B0 01B0 18E4            12      JR  SW0
       01B2                     SW2:
0000B2 01B2 FE53             7      CP  "S"
0000B4 01B4 2005            12      JR  NZ,SW3
0000B6 01B6 323302          13      LD  (SAVESW+1),A
0000B9 01B9 18DB            12      JR  SW0
       01BB                     SW3:
0000BB 01BB FE48             7      CP  "H"
0000BD 01BD 2038            12      JR  NZ,SW4
0000BF 01BF 323302          13      LD  (SAVESW+1),A
                                
0000C2 01C2 21C800          10      LD  HL,200
0000C5 01C5 22D108          16      LD  (L200X1+1),HL
0000C8 01C8 228309          16      LD  (L200X2+1),HL
0000CB 01CB 224B0A          16      LD  (L200X3+1),HL
0000CE 01CE 2B               6      DEC HL
0000CF 01CF 22520C          16      LD  (L200X4),HL
                                
0000D2 01D2 3E23             7      LD  A,$23       ;INC HL
0000D4 01D4 325A09          13      LD  (S200X1),A
0000D7 01D7 32AB0A          13      LD  (S200X2),A
                                
0000DA 01DA 21CF07          10      LD  HL,1999
0000DD 01DD 227509          16      LD  (M200X1+1),HL
0000E0 01E0 23               6      INC HL
0000E1 01E1 22080A          16      LD  (M200X2+1),HL
                                
0000E4 01E4 21060C          10      LD  HL,STABLE2-2
0000E7 01E7 225F0B          16      LD  (T200X1+1),HL
                                
0000EA 01EA 3E07             7      LD  A,7
0000EC 01EC 324B0C          13      LD  (SCMODE),A
                                
0000EF 01EF 212008          10      LD  HL,$0050+2000
0000F2 01F2 22580C          16      LD  (FBST),HL
0000F5 01F5 189F            12      JR  SW0
       01F7                     SW4:
0000F7 01F7 FE55             7      CP  "U"
0000F9 01F9 C25A01          10      JP  NZ,USAGE
0000FC 01FC 323302          13      LD  (SAVESW+1),A
0000FF 01FF 21340C          10      LD  HL,USER
000102 0202 0612             7      LD  B,18
000104 0204 1A               7      LD  A,(DE)
000105 0205 FE22             7      CP  $22
000107 0207 2002            12      JR  NZ,SW4X
000109 0209 13               6      INC DE
00010A 020A 1A               7      LD  A,(DE)
       020B                     SW4X:
00010B 020B FE27             7      CP  "'"
00010D 020D 2001            12      JR  NZ,SW4L
00010F 020F 13               6      INC DE
       0210                     SW4L:
000110 0210 1A               7      LD  A,(DE)
000111 0211 FE20             7      CP  $20
000113 0213 3814            12      JR  C,SW4E
000115 0215 FE2F             7      CP  "/"
000117 0217 2810            12      JR  Z,SW4E
000119 0219 13               6      INC DE
00011A 021A FE22             7      CP  $22
00011C 021C 280B            12      JR  Z,SW4E
00011E 021E FE27             7      CP  "'"
000120 0220 2807            12      JR  Z,SW4E
000122 0222 77               7      LD  (HL),A
000123 0223 23               6      INC HL
000124 0224 10EA            13      DJNZ    SW4L
000126 0226 C39601          10      JP  SW0
       0229                     SW4E:
000129 0229 3E20             7      LD  A,$20
00012B 022B 77               7      LD  (HL),A
00012C 022C 23               6      INC HL
00012D 022D 10FA            13      DJNZ    SW4E
00012F 022F C39601          10      JP  SW0
                                
       0232                     LOAD:
000132 0232 3E00             7  SAVESW: LD  A,$00
000134 0234 B7               4      OR  A
000135 0235 C29008          10      JP  NZ,SAVE
                                
000138 0238 113E0D          10      LD  DE,FILE
00013B 023B 0E1A             7      LD  C,$1A
00013D 023D CD0500          17      CALL    SYSTEM
                                
000140 0240 115C00          10      LD  DE,FCB1
000143 0243 0E11             7      LD  C,$11
000145 0245 CD0500          17      CALL    SYSTEM
000148 0248 B7               4      OR  A
000149 0249 C20000          10      JP  NZ,0
                                
00014C 024C CD6808          17      CALL    GRAPH1
       024F                     WILD:
00014F 024F 113E0D          10      LD  DE,FILE
000152 0252 0E0F             7      LD  C,$0F
000154 0254 CD0500          17      CALL    SYSTEM
000157 0257 B7               4      OR  A
000158 0258 C2D804          10      JP  NZ,END
                                
00015B 025B 210000          10      LD  HL,0
00015E 025E 225F0D          16      LD  (FILE+33),HL
000161 0261 22610D          16      LD  (FILE+35),HL
000164 0264 2C               4      INC L
000165 0265 224C0D          16      LD  (FILE+14),HL
                                
000168 0268 110041          10      LD  DE,DTBUF
00016B 026B 0E1A             7      LD  C,$1A
00016D 026D CD0500          17      CALL    SYSTEM
                                
000170 0270 210010          10      LD  HL,FLAGBF
000173 0273 110110          10      LD  DE,FLAGBF+1
000176 0276 01FF30          10      LD  BC,16*512+256+4096-1
000179 0279 3600            10      LD  (HL),0
00017B 027B EDB0                    LDIR
                                
00017D 027D 3E01             7      LD  A,1
00017F 027F 320B07          13      LD  (FLAGAX+1),A
000182 0282 210000          10      LD  HL,0
000185 0285 220E04          16      LD  (ZURI+1),HL
                                
000188 0288 210011          10      LD  HL,LINEBF
00018B 028B 22C806          16      LD  (LINEX+1),HL
                                
00018E 028E 21FFFF          10      LD  HL,$FFFF
000191 0291 11FFFF          10      LD  DE,$FFFF
000194 0294 010000          10      LD  BC,0
000197 0297 D9               4      EXX
                                
000198 0298 210071          10      LD  HL,HEADBF
00019B 029B 010800          10      LD  BC,8
00019E 029E CD4E07          17      CALL    READ
0001A1 02A1 210071          10      LD  HL,HEADBF
0001A4 02A4 11270C          10      LD  DE,MAGID
0001A7 02A7 0608             7      LD  B,8
0001A9 02A9 CD0E08          17      CALL    CPSTR
0001AC 02AC C2B804          10      JP  NZ,NEXT
                                
0001AF 02AF 1E0C             7      LD  E,$0C
0001B1 02B1 0E02             7      LD  C,2
0001B3 02B3 CD0500          17      CALL    SYSTEM
                                
0001B6 02B6 3E00             7  CLSSW:  LD  A,$00
0001B8 02B8 B7               4      OR  A
0001B9 02B9 C41608          17      CALL    NZ,CLS
                                
0001BC 02BC 010018          10      LD  BC,$1800
0001BF 02BF 3E0C             7      LD  A,12
0001C1 02C1 ED79            12      OUT (C),A
0001C3 02C3 0C               4      INC C
0001C4 02C4 ED71                    DB  $ED,$71
0001C6 02C6 0D               4      DEC C
0001C7 02C7 3C               4      INC A
0001C8 02C8 ED79            12      OUT (C),A
0001CA 02CA 0C               4      INC C
0001CB 02CB ED71                    DB  $ED,$71
0001CD 02CD 210800          10      LD  HL,8
       02D0                     COMMENT:
0001D0 02D0 23               6      INC HL
0001D1 02D1 CD6907          17      CALL    FGETC
0001D4 02D4 FE1A             7      CP  $1A
0001D6 02D6 2808            12      JR  Z,HEADER
0001D8 02D8 5F               4      LD  E,A
0001D9 02D9 0E02             7      LD  C,2
0001DB 02DB CD0500          17      CALL    SYSTEM
0001DE 02DE 18F0            12      JR  COMMENT
       02E0                     HEADER:
0001E0 02E0 224503          16      LD  (ADDHD+1),HL
0001E3 02E3 1E0D             7      LD  E,$0D
0001E5 02E5 0E02             7      LD  C,2
0001E7 02E7 CD0500          17      CALL    SYSTEM
0001EA 02EA 1E0A             7      LD  E,$0A
0001EC 02EC 0E02             7      LD  C,2
0001EE 02EE CD0500          17      CALL    SYSTEM
                                
0001F1 02F1 CD6907          17      CALL    FGETC
0001F4 02F4 B7               4      OR  A
0001F5 02F5 C2B804          10      JP  NZ,NEXT
0001F8 02F8 210071          10      LD  HL,HEADBF
0001FB 02FB 77               7      LD  (HL),A
0001FC 02FC 23               6      INC HL
0001FD 02FD 014F00          10      LD  BC,31+48    ;ヘッダ パレット
000200 0300 CD4E07          17      CALL    READ
000203 0303 E5              11      PUSH    HL
                                
000204 0304 212071          10      LD  HL,PALBF
000207 0307 11680C          10      LD  DE,DEGI8
00020A 030A 0630             7      LD  B,48
00020C 030C CD0E08          17      CALL    CPSTR
00020F 030F 3A0371          13      LD  A,(HEADBF+3)    ;スクリーンモード
000212 0312 2005            12      JR  NZ,NOTD
000214 0314 F606             7      OR  6
000216 0316 320371          13      LD  (HEADBF+3),A
       0319                     NOTD:
000219 0319 CB7F             8      BIT 7,A     ;256色
00021B 031B C2B804          10      JP  NZ,NEXT
00021E 031E E601             7      AND 1       ;200ライン
000220 0320 325204          13      LD  (L200+1),A
                                
000223 0323 2A1071          16      LD  HL,(HEADBF+16)
000226 0326 ED4B0C71        20      LD  BC,(HEADBF+12)
00022A 032A A7               4      AND A
00022B 032B ED42            15      SBC HL,BC
00022D 032D 44               4      LD  B,H
00022E 032E 4D               4      LD  C,L
00022F 032F E1              10      POP HL
000230 0330 CD4E07          17      CALL    READ        ;フラグA
                                                ;フラグB
000233 0333 213E0D          10      LD  HL,FILE
000236 0336 11630D          10      LD  DE,FILE2
000239 0339 012500          10      LD  BC,37
00023C 033C EDB0                    LDIR
                                
00023E 033E 3A1A71          13      LD  A,(HEADBF+26)
000241 0341 2A1871          16      LD  HL,(HEADBF+24)
000244 0344 110000          10  ADDHD:  LD  DE,0
000247 0347 19              11      ADD HL,DE
000248 0348 CE00             7      ADC A,0
00024A 034A 22840D          16      LD  (FILE2+33),HL
00024D 034D 32860D          13      LD  (FILE2+35),A
                                
000250 0350 2A0871          16      LD  HL,(HEADBF+8)
000253 0353 ED4B0471        20      LD  BC,(HEADBF+4)
000257 0357 A7               4      AND A
000258 0358 ED42            15      SBC HL,BC
00025A 035A 010800          10      LD  BC,8
00025D 035D 09              11      ADD HL,BC
00025E 035E 29              11      ADD HL,HL
00025F 035F 29              11      ADD HL,HL
000260 0360 29              11      ADD HL,HL
000261 0361 29              11      ADD HL,HL
000262 0362 29              11      ADD HL,HL
000263 0363 7C               4      LD  A,H
000264 0364 32CB06          13      LD  (XSIZE+1),A
                                
000267 0367 2A0A71          16      LD  HL,(HEADBF+10)
00026A 036A ED4B0671        20      LD  BC,(HEADBF+6)
00026E 036E A7               4      AND A
00026F 036F ED42            15      SBC HL,BC
000271 0371 23               6      INC HL
000272 0372 22CD06          16      LD  (YSIZE+1),HL
                                
000275 0375 0600             7  RGBSW:  LD  B,$00
000277 0377 3A0371          13      LD  A,(HEADBF+3)
00027A 037A B0               4      OR  B
00027B 037B 320371          13      LD  (HEADBF+3),A
                                
00027E 037E 216705          10      LD  HL,KUWANO
000281 0381 116705          10      LD  DE,KUWANO
                                
000284 0384 3ABFEC          13  SMC01:  LD  A,($ECBF)
000287 0387 0F               4      RRCA
000288 0388 302D            12      JR  NC,LOW
                                                ;High Reso
00028A 038A 3A0371          13      LD  A,(HEADBF+3)    ;スクリーンモード
00028D 038D 0600             7      LD  B,0
00028F 038F E606             7      AND 6
000291 0391 FE06             7      CP  6
000293 0393 2011            12      JR  NZ,HIGH3
                                                ;デジタル 8 色
000295 0395 3A0371          13      LD  A,(HEADBF+3)    ;スクリーンモード
000298 0398 111105          10      LD  DE,RGB
                                
00029B 039B 87               4      ADD A,A
00029C 039C E602             7      AND 2
00029E 039E 2803            12      JR  Z,HIGH2
                                
0002A0 03A0 112506          10      LD  DE,NUL
       03A3                     HIGH2:
0002A3 03A3 211105          10      LD  HL,RGB
       03A6                     HIGH3:
0002A6 03A6 47               4      LD  B,A
0002A7 03A7 3ABFEC          13  SMC02:  LD  A,($ECBF)
0002AA 03AA E6FD             7      AND $FD
0002AC 03AC B0               4      OR  B
0002AD 03AD 32BFEC          13  SMC03:  LD  ($ECBF),A
0002B0 03B0 01D01F          10      LD  BC,$1FD0
0002B3 03B3 ED79            12      OUT (C),A
                                
0002B5 03B5 1812            12      JR  FA
                                
       03B7                     LOW:
0002B7 03B7 212606          10      LD  HL,KUWANO2
0002BA 03BA 112506          10      LD  DE,NUL
                                
0002BD 03BD 3A0371          13      LD  A,(HEADBF+3)    ;スクリーンモード
0002C0 03C0 E607             7      AND 7
0002C2 03C2 FE07             7      CP  7
0002C4 03C4 2003            12      JR  NZ,FA
                                
0002C6 03C6 211105          10      LD  HL,RGB
       03C9                     FA:
0002C9 03C9 225C04          16      LD  (MODE1+1),HL
0002CC 03CC ED537004        20      LD  (MODE2+1),DE
                                ;
                                                ;パレット 8bit->4bit
0002D0 03D0 0630             7      LD  B,48
0002D2 03D2 212071          10      LD  HL,PALBF
       03D5                     PALI:
0002D5 03D5 7E               7      LD  A,(HL)
0002D6 03D6 0F               4      RRCA
0002D7 03D7 0F               4      RRCA
0002D8 03D8 0F               4      RRCA
0002D9 03D9 0F               4      RRCA
0002DA 03DA E60F             7      AND $0F
0002DC 03DC D604             7      SUB 4
0002DE 03DE 3001            12      JR  NC,PLUS
0002E0 03E0 AF               4      XOR A
       03E1                     PLUS:
0002E1 03E1 77               7      LD  (HL),A
0002E2 03E2 23               6      INC HL
0002E3 03E3 10F0            13      DJNZ    PALI
                                
0002E5 03E5 DD2A0C71        20      LD  IX,(HEADBF+12)  ;フラグA
0002E9 03E9 110071          10      LD  DE,HEADBF
0002EC 03EC DD19            15      ADD IX,DE
0002EE 03EE FD2A1071        20      LD  IY,(HEADBF+16)  ;フラグB
0002F2 03F2 FD19            15      ADD IY,DE
                                
0002F4 03F4 0619             7      LD  B,25
       03F6                     LOOP1:
0002F6 03F6 C5              11      PUSH    BC
                                
0002F7 03F7 1EFF             7      LD  E,$FF
0002F9 03F9 0E06             7      LD  C,6
0002FB 03FB CD0500          17      CALL    SYSTEM
0002FE 03FE FE1B             7      CP  $1B
000300 0400 CAB804          10      JP  Z,NEXT
000303 0403 FE03             7      CP  3
000305 0405 CAD804          10      JP  Z,END
000308 0408 FE13             7      CP  $13
00030A 040A CCDF04          17      CALL    Z,WAIT1
                                
00030D 040D 210000          10  ZURI:   LD  HL,0
000310 0410 7C               4      LD  A,H
000311 0411 B5               4      OR  L
000312 0412 2822            12      JR  Z,ZURI1
                                
000314 0414 010018          10      LD  BC,$1800
000317 0417 3E0C             7      LD  A,12
000319 0419 ED79            12      OUT (C),A
00031B 041B 0C               4      INC C
00031C 041C ED61            12      OUT (C),H
00031E 041E 0D               4      DEC C
00031F 041F 3C               4      INC A
000320 0420 ED79            12      OUT (C),A
000322 0422 0C               4      INC C
000323 0423 ED69            12      OUT (C),L
000325 0425 0D               4      DEC C
000326 0426 3E06             7      LD  A,6
000328 0428 ED79            12      OUT (C),A
00032A 042A 0C               4      INC C
00032B 042B 3E18             7      LD  A,24
00032D 042D ED79            12      OUT (C),A
00032F 042F 015000          10      LD  BC,WIDTH
000332 0432 09              11      ADD HL,BC
000333 0433 220E04          16      LD  (ZURI+1),HL
       0436                     ZURI1:
000336 0436 0608             7      LD  B,8
       0438                     LOOP2:
000338 0438 C5              11      PUSH    BC
000339 0439 D9               4      EXX
00033A 043A C5              11      PUSH    BC
00033B 043B C5              11      PUSH    BC
00033C 043C D9               4      EXX
00033D 043D 3ABFEC          13  SMC04:  LD  A,($ECBF)
000340 0440 E6EF             7      AND $EF
000342 0442 32BFEC          13  SMC05:  LD  ($ECBF),A
000345 0445 01D01F          10      LD  BC,$1FD0
000348 0448 ED79            12      OUT (C),A
                                
00034A 044A CDBB06          17      CALL    MAG
00034D 044D 2AC806          16      LD  HL,(LINEX+1)
000350 0450 E5              11      PUSH    HL
000351 0451 3E00             7  L200:   LD  A,$00
000353 0453 B7               4      OR  A
000354 0454 CCBB06          17      CALL    Z,MAG
000357 0457 2AC806          16      LD  HL,(LINEX+1)
00035A 045A E3              19      EX  (SP),HL
00035B 045B CD6705          17  MODE1:  CALL    KUWANO
                                
00035E 045E 3ABFEC          13  SMC06:  LD  A,($ECBF)
000361 0461 F610             7      OR  $10
000363 0463 32BFEC          13  SMC07:  LD  ($ECBF),A
000366 0466 01D01F          10      LD  BC,$1FD0
000369 0469 ED79            12      OUT (C),A
                                
00036B 046B E1              10      POP HL
00036C 046C D9               4      EXX
00036D 046D C1              10      POP BC
00036E 046E D9               4      EXX
00036F 046F CD6705          17  MODE2:  CALL    KUWANO
                                
000372 0472 D9               4      EXX
000373 0473 C1              10      POP BC
000374 0474 78               4      LD  A,B
000375 0475 C608             7      ADD A,8
000377 0477 47               4      LD  B,A
000378 0478 D9               4      EXX
                                
000379 0479 C1              10      POP BC
00037A 047A 05               4      DEC B
00037B 047B C23804          10      JP  NZ,LOOP2
                                
00037E 047E 2ACD06          16      LD  HL,(YSIZE+1)
000381 0481 7C               4      LD  A,H
000382 0482 B5               4      OR  L
000383 0483 2832            12      JR  Z,WAIT
                                
000385 0485 D9               4      EXX
000386 0486 E5              11      PUSH    HL
000387 0487 215000          10      LD  HL,WIDTH
00038A 048A 09              11      ADD HL,BC
00038B 048B 7C               4      LD  A,H
00038C 048C E607             7      AND 7
00038E 048E 47               4      LD  B,A
00038F 048F 4D               4      LD  C,L
000390 0490 E1              10      POP HL
000391 0491 D9               4      EXX
000392 0492 C1              10      POP BC
000393 0493 05               4      DEC B
000394 0494 C2F603          10      JP  NZ,LOOP1
                                
000397 0497 CDDF04          17      CALL    WAIT1
00039A 049A 2A0E04          16      LD  HL,(ZURI+1)
00039D 049D 015000          10      LD  BC,WIDTH
0003A0 04A0 09              11      ADD HL,BC
0003A1 04A1 220E04          16      LD  (ZURI+1),HL
                                
0003A4 04A4 010020          10      LD  BC,$2000
0003A7 04A7 210008          10      LD  HL,$800
       04AA                     CLRAT:
0003AA 04AA ED71                    DB  $ED,$71
0003AC 04AC 03               6      INC BC
0003AD 04AD 2B               6      DEC HL
0003AE 04AE 7C               4      LD  A,H
0003AF 04AF B5               4      OR  L
0003B0 04B0 20F8            12      JR  NZ,CLRAT
                                
0003B2 04B2 0619             7      LD  B,25
0003B4 04B4 C3F603          10      JP  LOOP1
                                
       04B7                     WAIT:
0003B7 04B7 3E                      DB  $3E
       04B8                     NEXT:
0003B8 04B8 AF               4      XOR A
0003B9 04B9 B7               4      OR  A
0003BA 04BA 08               4      EX  AF,AF'
0003BB 04BB ED7B0600        20      LD  SP,(SYSTEM+1)
                                
0003BF 04BF 113E0D          10      LD  DE,FILE
0003C2 04C2 0E1A             7      LD  C,$1A
0003C4 04C4 CD0500          17      CALL    SYSTEM
                                
0003C7 04C7 0E12             7      LD  C,$12
0003C9 04C9 CD0500          17      CALL    SYSTEM
0003CC 04CC B7               4      OR  A
0003CD 04CD 08               4      EX  AF,AF'
0003CE 04CE C4DF04          17      CALL    NZ,WAIT1
0003D1 04D1 CD0005          17      CALL    WAIT2
0003D4 04D4 08               4      EX  AF,AF'
0003D5 04D5 CA4F02          10      JP  Z,WILD
       04D8                     END:
0003D8 04D8 CD0308          17      CALL    MOTOFF
0003DB 04DB CD4F08          17      CALL    GRAPH0
0003DE 04DE C7              12      RST 0
                                
       04DF                     WAIT1:
0003DF 04DF CD0308          17      CALL    MOTOFF
0003E2 04E2 010018          10      LD  BC,$1800
0003E5 04E5 3E06             7      LD  A,6
0003E7 04E7 ED79            12      OUT (C),A
0003E9 04E9 0C               4      INC C
0003EA 04EA 3E19             7      LD  A,25
0003EC 04EC ED79            12      OUT (C),A
                                
0003EE 04EE CD0005          17      CALL    WAIT2
       04F1                     WAIT3:
0003F1 04F1 1EFF             7      LD  E,$FF
0003F3 04F3 0E06             7      LD  C,6
0003F5 04F5 CD0500          17      CALL    SYSTEM
0003F8 04F8 B7               4      OR  A
0003F9 04F9 28F6            12      JR  Z,WAIT3
0003FB 04FB FE03             7      CP  3
0003FD 04FD 28D9            12      JR  Z,END
0003FF 04FF C9              10      RET
                                
       0500                     WAIT2:
000400 0500 1EFF             7      LD  E,$FF
000402 0502 0E06             7      LD  C,6
000404 0504 CD0500          17      CALL    SYSTEM
000407 0507 B7               4      OR  A
000408 0508 20F6            12      JR  NZ,WAIT2
                                
00040A 050A 3A92EC          13  SMC08:  LD  A,($EC92)
00040D 050D B7               4      OR  A
00040E 050E 20F0            12      JR  NZ,WAIT2
000410 0510 C9              10      RET
                                
       0511                     RGB:
000411 0511 0E50             7      LD  C,WIDTH
       0513                     DIS1:
000413 0513 110440          10      LD  DE,$4004
000416 0516 CD4D05          17      CALL    DISS        ;G
000419 0519 D9               4      EXX
00041A 051A CBF8             8      SET 7,B
00041C 051C CBF0             8      SET 6,B
00041E 051E ED79            12      OUT (C),A
000420 0520 D9               4      EXX
000421 0521 110220          10      LD  DE,$2002
000424 0524 CD4D05          17      CALL    DISS        ;R
000427 0527 D9               4      EXX
000428 0528 CBB0             8      RES 6,B
00042A 052A ED79            12      OUT (C),A
00042C 052C D9               4      EXX
00042D 052D 110110          10      LD  DE,$1001
000430 0530 CD4D05          17      CALL    DISS        ;B
000433 0533 D9               4      EXX
000434 0534 CBB8             8      RES 7,B
000436 0536 CBF0             8      SET 6,B
000438 0538 ED79            12      OUT (C),A
00043A 053A 78               4      LD  A,B
00043B 053B 03               6      INC BC
00043C 053C A8               4      XOR B
00043D 053D E608             7      AND 8
00043F 053F 2804            12      JR  Z,INCXX
000441 0541 78               4      LD  A,B
000442 0542 D608             7      SUB 8
000444 0544 47               4      LD  B,A
       0545                     INCXX:
000445 0545 D9               4      EXX
000446 0546 23               6      INC HL
000447 0547 23               6      INC HL
000448 0548 23               6      INC HL
000449 0549 23               6      INC HL
00044A 054A 0D               4      DEC C
00044B 054B 20C6            12      JR  NZ,DIS1
                                
       054D                     DISS:
00044D 054D C5              11      PUSH    BC
00044E 054E E5              11      PUSH    HL
00044F 054F 010004          10      LD  BC,$0400
       0552                     DISS1:
000452 0552 7E               7      LD  A,(HL)
000453 0553 A2               4      AND D
000454 0554 2801            12      JR  Z,DISS2
000456 0556 37               4      SCF
       0557                     DISS2:
000457 0557 CB11             8      RL  C
000459 0559 7E               7      LD  A,(HL)
00045A 055A A3               4      AND E
00045B 055B 2801            12      JR  Z,DISS3
00045D 055D 37               4      SCF
       055E                     DISS3:
00045E 055E CB11             8      RL  C
                                
000460 0560 23               6      INC HL
000461 0561 10EF            13      DJNZ    DISS1
                                
000463 0563 79               4      LD  A,C
000464 0564 E1              10      POP HL
000465 0565 C1              10      POP BC
000466 0566 C9              10      RET
                                
       0567                     KUWANO:
000467 0567 DDE5            15      PUSH    IX
000469 0569 FDE5            15      PUSH    IY
                                
00046B 056B DD210431        14  KLINE1: LD  IX,KWABF1+4
00046F 056F FD210439        14  KLINE2: LD  IY,KWABF2+4
                                
000473 0573 0650             7      LD  B,80
       0575                     KUWA1:
000475 0575 C5              11      PUSH    BC
                                
000476 0576 0604             7      LD  B,4
       0578                     KUWA2:
000478 0578 C5              11      PUSH    BC
                                
000479 0579 7E               7      LD  A,(HL)
00047A 057A 23               6      INC HL
00047B 057B E5              11      PUSH    HL
                                
00047C 057C F5              11      PUSH    AF
00047D 057D 0F               4      RRCA
00047E 057E 0F               4      RRCA
00047F 057F 0F               4      RRCA
000480 0580 0F               4      RRCA
000481 0581 CDC805          17      CALL    PALET1
000484 0584 F1              10      POP AF
000485 0585 CDC805          17      CALL    PALET1
                                
000488 0588 E1              10      POP HL
000489 0589 C1              10      POP BC
00048A 058A 10EC            13      DJNZ    KUWA2
                                
00048C 058C D9               4      EXX
00048D 058D CBF8             8      SET 7,B
00048F 058F CBF0             8      SET 6,B
000491 0591 3A880D          13      LD  A,(GREEN)
000494 0594 ED79            12      OUT (C),A
000496 0596 CBB0             8      RES 6,B
000498 0598 3A890D          13      LD  A,(RED)
00049B 059B ED79            12      OUT (C),A
00049D 059D CBB8             8      RES 7,B
00049F 059F CBF0             8      SET 6,B
0004A1 05A1 3A8A0D          13      LD  A,(BLUE)
0004A4 05A4 ED79            12      OUT (C),A
0004A6 05A6 78               4      LD  A,B
0004A7 05A7 03               6      INC BC
0004A8 05A8 A8               4      XOR B
0004A9 05A9 E608             7      AND 8
0004AB 05AB 2804            12      JR  Z,INCX
0004AD 05AD 78               4      LD  A,B
0004AE 05AE D608             7      SUB 8
0004B0 05B0 47               4      LD  B,A
       05B1                     INCX:
0004B1 05B1 D9               4      EXX
0004B2 05B2 C1              10      POP BC
0004B3 05B3 10C0            13      DJNZ    KUWA1
       05B5                     KUWAE:
0004B5 05B5 2A6D05          16      LD  HL,(KLINE1+2)
0004B8 05B8 DD2A7105        20      LD  IX,(KLINE2+2)
0004BC 05BC 227105          16      LD  (KLINE2+2),HL
0004BF 05BF DD226D05        20      LD  (KLINE1+2),IX
                                
0004C3 05C3 FDE1            14      POP IY
0004C5 05C5 DDE1            14      POP IX
0004C7 05C7 C9              10      RET
                                
       05C8                     PALET1:
                                                ;C=GREEN D=RED E=BLUE
0004C8 05C8 E60F             7      AND $0F
0004CA 05CA 5F               4      LD  E,A
0004CB 05CB 87               4      ADD A,A
0004CC 05CC 83               4      ADD A,E
0004CD 05CD 5F               4      LD  E,A
0004CE 05CE 1600             7      LD  D,0
0004D0 05D0 212071          10      LD  HL,PALBF
0004D3 05D3 19              11      ADD HL,DE
0004D4 05D4 7E               7      LD  A,(HL)
0004D5 05D5 23               6      INC HL
0004D6 05D6 56               7      LD  D,(HL)
0004D7 05D7 23               6      INC HL
0004D8 05D8 5E               7      LD  E,(HL)
       05D9                     PALETX:
0004D9 05D9 21880D          10      LD  HL,GREEN
0004DC 05DC CDEA05          17      CALL    KUWANO1
0004DF 05DF 7A               4      LD  A,D
0004E0 05E0 21890D          10      LD  HL,RED      ;RED
0004E3 05E3 CDEA05          17      CALL    KUWANO1
0004E6 05E6 7B               4      LD  A,E
0004E7 05E7 218A0D          10      LD  HL,BLUE     ;BLUE
       05EA                     KUWANO1:
0004EA 05EA DD8600          19      ADD A,(IX+0)        ;桑野
0004ED 05ED DD360000        19      LD  (IX+0),0
0004F1 05F1 C6F5             7      ADD A,-THOLD
0004F3 05F3 3802            12      JR  C,PSET
0004F5 05F5 D6F5             7      SUB -THOLD
       05F7                     PSET:
0004F7 05F7 CB16            15      RL  (HL)
                                
0004F9 05F9 47               4      LD  B,A
0004FA 05FA CB38             8      SRL B
0004FC 05FC 90               4      SUB B
0004FD 05FD 48               4      LD  C,B     ;C=A/2
0004FE 05FE CB38             8      SRL B
000500 0600 90               4      SUB B
000501 0601 C5              11      PUSH    BC      ;B=A/4
000502 0602 CB38             8      SRL B
000504 0604 90               4      SUB B
000505 0605 C5              11      PUSH    BC      ;B=A/8
                                
000506 0606 FD8600          19      ADD A,(IY+0)        ;Y+1
000509 0609 FD7700          19      LD  (IY+0),A
                                
00050C 060C F1              10      POP AF      ;A=A/8
00050D 060D FD8603          19      ADD A,(IY+3*1)  ;Y+1 X+1
000510 0610 FD7703          19      LD  (IY+3*1),A
                                
000513 0613 F1              10      POP AF      ;A=A/4
000514 0614 FD86FD          19      ADD A,(IY-3*1)  ;Y+1 X-1
000517 0617 FD77FD          19      LD  (IY-3*1),A
                                
00051A 061A 79               4      LD  A,C     ;A=A/2
00051B 061B DD8603          19      ADD A,(IX+3*1)  ;X+1
00051E 061E DD7703          19      LD  (IX+3*1),A
                                
000521 0621 DD23            10      INC IX
000523 0623 FD23            10      INC IY
       0625                     NUL:
000525 0625 C9              10      RET
                                
       0626                     KUWANO2:
000526 0626 C1              10      POP BC
000527 0627 D1              10      POP DE
000528 0628 D5              11      PUSH    DE
000529 0629 C5              11      PUSH    BC
                                
00052A 062A DDE5            15      PUSH    IX
00052C 062C FDE5            15      PUSH    IY
                                
00052E 062E DD2A6D05        20      LD  IX,(KLINE1+2)
000532 0632 FD2A7105        20      LD  IY,(KLINE2+2)
                                
000536 0636 0650             7      LD  B,80
       0638                     LKUWA1:
000538 0638 C5              11      PUSH    BC
                                
000539 0639 0604             7      LD  B,4
       063B                     LKUWA2:
00053B 063B C5              11      PUSH    BC
                                
00053C 063C 1A               7      LD  A,(DE)
00053D 063D 13               6      INC DE
00053E 063E 46               7      LD  B,(HL)
00053F 063F 23               6      INC HL
000540 0640 D5              11      PUSH    DE
000541 0641 E5              11      PUSH    HL
                                
000542 0642 C5              11      PUSH    BC
000543 0643 F5              11      PUSH    AF
000544 0644 78               4      LD  A,B
000545 0645 0F               4      RRCA
000546 0646 0F               4      RRCA
000547 0647 0F               4      RRCA
000548 0648 0F               4      RRCA
000549 0649 47               4      LD  B,A
00054A 064A F1              10      POP AF
00054B 064B F5              11      PUSH    AF
00054C 064C 0F               4      RRCA
00054D 064D 0F               4      RRCA
00054E 064E 0F               4      RRCA
00054F 064F 0F               4      RRCA
000550 0650 CD8906          17      CALL    PALET2
000553 0653 F1              10      POP AF
000554 0654 C1              10      POP BC
000555 0655 CD8906          17      CALL    PALET2
                                
000558 0658 E1              10      POP HL
000559 0659 D1              10      POP DE
00055A 065A C1              10      POP BC
00055B 065B 10DE            13      DJNZ    LKUWA2
                                
00055D 065D D9               4      EXX
00055E 065E CBF8             8      SET 7,B
000560 0660 CBF0             8      SET 6,B
000562 0662 3A880D          13      LD  A,(GREEN)
000565 0665 ED79            12      OUT (C),A
000567 0667 CBB0             8      RES 6,B
000569 0669 3A890D          13      LD  A,(RED)
00056C 066C ED79            12      OUT (C),A
00056E 066E CBB8             8      RES 7,B
000570 0670 CBF0             8      SET 6,B
000572 0672 3A8A0D          13      LD  A,(BLUE)
000575 0675 ED79            12      OUT (C),A
000577 0677 78               4      LD  A,B
000578 0678 03               6      INC BC
000579 0679 A8               4      XOR B
00057A 067A E608             7      AND 8
00057C 067C 2804            12      JR  Z,LINCX
00057E 067E 78               4      LD  A,B
00057F 067F D608             7      SUB 8
000581 0681 47               4      LD  B,A
       0682                     LINCX:
000582 0682 D9               4      EXX
000583 0683 C1              10      POP BC
000584 0684 10B2            13      DJNZ    LKUWA1
000586 0686 C3B505          10      JP  KUWAE
                                
       0689                     PALET2:
                                                ;C=GREEN D=RED E=BLUE
000589 0689 E60F             7      AND $0F
00058B 068B 5F               4      LD  E,A
00058C 068C 87               4      ADD A,A
00058D 068D 83               4      ADD A,E
00058E 068E 5F               4      LD  E,A
00058F 068F 1600             7      LD  D,0
000591 0691 212071          10      LD  HL,PALBF
000594 0694 19              11      ADD HL,DE
000595 0695 4E               7      LD  C,(HL)
000596 0696 23               6      INC HL
000597 0697 56               7      LD  D,(HL)
000598 0698 23               6      INC HL
000599 0699 5E               7      LD  E,(HL)
                                
00059A 069A 78               4      LD  A,B
00059B 069B E60F             7      AND $0F
00059D 069D D5              11      PUSH    DE
00059E 069E 5F               4      LD  E,A
00059F 069F 87               4      ADD A,A
0005A0 06A0 83               4      ADD A,E
0005A1 06A1 5F               4      LD  E,A
0005A2 06A2 1600             7      LD  D,0
0005A4 06A4 212071          10      LD  HL,PALBF
0005A7 06A7 19              11      ADD HL,DE
0005A8 06A8 D1              10      POP DE
                                
0005A9 06A9 7E               7      LD  A,(HL)
0005AA 06AA 23               6      INC HL
0005AB 06AB 81               4      ADD A,C
0005AC 06AC 1F               4      RRA
0005AD 06AD 4F               4      LD  C,A
                                
0005AE 06AE 7E               7      LD  A,(HL)
0005AF 06AF 23               6      INC HL
0005B0 06B0 82               4      ADD A,D
0005B1 06B1 1F               4      RRA
0005B2 06B2 57               4      LD  D,A
                                
0005B3 06B3 7E               7      LD  A,(HL)
0005B4 06B4 83               4      ADD A,E
0005B5 06B5 1F               4      RRA
0005B6 06B6 5F               4      LD  E,A
                                
0005B7 06B7 79               4      LD  A,C
0005B8 06B8 C3D905          10      JP  PALETX
                                
                                ;               フラグ&ピクセル 展開
       06BB                     MAG:
0005BB 06BB 3AC906          13      LD  A,(LINEX+2)
0005BE 06BE D60F             7      SUB LINEBF/256-2
0005C0 06C0 E61F             7      AND $1F
0005C2 06C2 C611             7      ADD A,LINEBF/256
0005C4 06C4 32C906          13      LD  (LINEX+2),A
                                
0005C7 06C7 110011          10  LINEX:  LD  DE,LINEBF
0005CA 06CA 0650             7  XSIZE:  LD  B,80
0005CC 06CC 210000          10  YSIZE:  LD  HL,0
                                
0005CF 06CF 7C               4      LD  A,H
0005D0 06D0 B5               4      OR  L
0005D1 06D1 2844            12      JR  Z,CLEAR
0005D3 06D3 2B               6      DEC HL
0005D4 06D4 22CD06          16      LD  (YSIZE+1),HL
                                
0005D7 06D7 210010          10      LD  HL,FLAGBF
       06DA                     FLAGA1:
0005DA 06DA DDCB0006        23      RLC (IX+0)
0005DE 06DE 3803            12      JR  C,FLAGA3
0005E0 06E0 AF               4      XOR A
0005E1 06E1 1803            12      JR  FLAGA4
       06E3                     FLAGA3:
0005E3 06E3 CD6907          17      CALL    FGETC
       06E6                     FLAGA4:
0005E6 06E6 AE               7      XOR (HL)
0005E7 06E7 77               7      LD  (HL),A
0005E8 06E8 FE11             7      CP  $11
0005EA 06EA 2012            12      JR  NZ,FLAGA5
0005EC 06EC C5              11      PUSH    BC
0005ED 06ED E5              11      PUSH    HL
0005EE 06EE 62               4      LD  H,D
0005EF 06EF 6B               4      LD  L,E
0005F0 06F0 2B               6      DEC HL
0005F1 06F1 2B               6      DEC HL
0005F2 06F2 EDA0            16      LDI
0005F4 06F4 EDA0            16      LDI
0005F6 06F6 EDA0            16      LDI
0005F8 06F8 EDA0            16      LDI
0005FA 06FA E1              10      POP HL
0005FB 06FB C1              10      POP BC
0005FC 06FC 180B            12      JR  FLAGA6
       06FE                     FLAGA5:
0005FE 06FE 0F               4      RRCA
0005FF 06FF 0F               4      RRCA
000600 0700 0F               4      RRCA
000601 0701 CD2107          17      CALL    PIC
000604 0704 7E               7      LD  A,(HL)
000605 0705 87               4      ADD A,A
000606 0706 CD2107          17      CALL    PIC
       0709                     FLAGA6:
000609 0709 23               6      INC HL
00060A 070A 3E01             7  FLAGAX: LD  A,$01
00060C 070C 07               4      RLCA
00060D 070D 320B07          13      LD  (FLAGAX+1),A
000610 0710 3002            12      JR  NC,FLAGA2
000612 0712 DD23            10      INC IX
       0714                     FLAGA2:
000614 0714 10C4            13      DJNZ    FLAGA1
000616 0716 C9              10      RET
                                
       0717                     CLEAR:
000617 0717 0E04             7      LD  C,4
       0719                     CLEAR1:
000619 0719 12               7      LD  (DE),A
00061A 071A 13               6      INC DE
00061B 071B 10FC            13      DJNZ    CLEAR1
00061D 071D 0D               4      DEC C
00061E 071E 20F9            12      JR  NZ,CLEAR1
000620 0720 C9              10      RET
                                
       0721                     PIC:
000621 0721 E61E             7      AND $1E
000623 0723 200B            12      JR  NZ,PICT
                                
000625 0725 CDB607          17      CALL    FGETP
000628 0728 12               7      LD  (DE),A
000629 0729 13               6      INC DE
00062A 072A CDB607          17      CALL    FGETP
00062D 072D 12               7      LD  (DE),A
00062E 072E 13               6      INC DE
00062F 072F C9              10      RET
       0730                     PICT:
000630 0730 C5              11      PUSH    BC
000631 0731 E5              11      PUSH    HL
000632 0732 4F               4      LD  C,A
000633 0733 0600             7      LD  B,0
000635 0735 211E0D          10      LD  HL,TABLE
000638 0738 09              11      ADD HL,BC
                                
000639 0739 7B               4      LD  A,E
00063A 073A 96               7      SUB (HL)        ;1
00063B 073B 23               6      INC HL
00063C 073C 66               7      LD  H,(HL)
00063D 073D 6F               4      LD  L,A
00063E 073E 7A               4      LD  A,D
00063F 073F DE11             7      SBC A,LINEBF/256    ;2
000641 0741 94               4      SUB H
000642 0742 E61F             7      AND $1F
000644 0744 C611             7      ADD A,LINEBF/256
000646 0746 67               4      LD  H,A
                                
000647 0747 EDA0            16      LDI
000649 0749 EDA0            16      LDI
00064B 074B E1              10      POP HL
00064C 074C C1              10      POP BC
00064D 074D C9              10      RET
                                
       074E                     READ:
00064E 074E E5              11      PUSH    HL
00064F 074F 09              11      ADD HL,BC
000650 0750 DAD804          10      JP  C,END
000653 0753 ED5B0600        20      LD  DE,(SYSTEM+1)
000657 0757 15               4      DEC D
000658 0758 ED52            15      SBC HL,DE
00065A 075A D2B804          10      JP  NC,NEXT
00065D 075D E1              10      POP HL
       075E                     READ1:
00065E 075E 78               4      LD  A,B
00065F 075F B1               4      OR  C
000660 0760 C8              11      RET Z
000661 0761 CD6907          17      CALL    FGETC
000664 0764 77               7      LD  (HL),A
000665 0765 23               6      INC HL
000666 0766 0B               6      DEC BC
000667 0767 18F5            12      JR  READ1
                                
       0769                     FGETC:
000669 0769 D9               4      EXX
00066A 076A 7C               4      LD  A,H
00066B 076B FE51             7      CP  DTBUFE/$100
00066D 076D 3004            12      JR  NC,FGETC2
       076F                     FGETC1:
00066F 076F 7E               7      LD  A,(HL)
000670 0770 23               6      INC HL
000671 0771 D9               4      EXX
000672 0772 C9              10      RET
       0773                     FGETC2:
000673 0773 C5              11      PUSH    BC
000674 0774 D5              11      PUSH    DE
000675 0775 110041          10      LD  DE,DTBUF
000678 0778 0E1A             7      LD  C,$1A
00067A 077A CD0500          17      CALL    SYSTEM
00067D 077D 113E0D          10      LD  DE,FILE
000680 0780 210010          10      LD  HL,BUFSIZ
000683 0783 0E27             7      LD  C,$27
000685 0785 CD0500          17      CALL    SYSTEM
000688 0788 C6FE             7      ADD A,$FE
00068A 078A DAB804          10      JP  C,NEXT
                                
00068D 078D 3A88EC          13  SMC09:  LD  A,($EC88)
000690 0790 DDE5            15      PUSH    IX
000692 0792 CDDCEC          17  SMC10:  CALL    $ECDC
000695 0795 DD7E12          19      LD  A,(IX+$12)
000698 0798 DDE1            14      POP IX
00069A 079A E67F             7      AND $7F
00069C 079C FE07             7      CP  7
00069E 079E 200A            12      JR  NZ,FGETC3
0006A0 07A0 3A84EC          13  SMC11:  LD  A,($EC84)
0006A3 07A3 F680             7      OR  $80
0006A5 07A5 01FC0F          10      LD  BC,$FFC
0006A8 07A8 ED79            12      OUT (C),A
       07AA                     FGETC3:
0006AA 07AA 7C               4      LD  A,H
0006AB 07AB B5               4      OR  L
0006AC 07AC CAB704          10      JP  Z,WAIT
0006AF 07AF 210041          10      LD  HL,DTBUF
0006B2 07B2 D1              10      POP DE
0006B3 07B3 C1              10      POP BC
0006B4 07B4 18B9            12      JR  FGETC1
                                
       07B6                     FGETP:
0006B6 07B6 D9               4      EXX
0006B7 07B7 7A               4      LD  A,D
0006B8 07B8 FE71             7      CP  PDBUFE/$100
0006BA 07BA 3004            12      JR  NC,FGETP2
       07BC                     FGETP1:
0006BC 07BC 1A               7      LD  A,(DE)
0006BD 07BD 13               6      INC DE
0006BE 07BE D9               4      EXX
0006BF 07BF C9              10      RET
       07C0                     FGETP2:
0006C0 07C0 C5              11      PUSH    BC
0006C1 07C1 E5              11      PUSH    HL
0006C2 07C2 110051          10      LD  DE,PDBUF
0006C5 07C5 0E1A             7      LD  C,$1A
0006C7 07C7 CD0500          17      CALL    SYSTEM
0006CA 07CA 11630D          10      LD  DE,FILE2
0006CD 07CD 210020          10      LD  HL,PDSIZE
0006D0 07D0 0E27             7      LD  C,$27
0006D2 07D2 CD0500          17      CALL    SYSTEM
0006D5 07D5 C6FE             7      ADD A,$FE
0006D7 07D7 DAB804          10      JP  C,NEXT
                                
0006DA 07DA 3A88EC          13  SMC12:  LD  A,($EC88)
0006DD 07DD DDE5            15      PUSH    IX
0006DF 07DF CDDCEC          17  SMC13:  CALL    $ECDC
0006E2 07E2 DD7E12          19      LD  A,(IX+$12)
0006E5 07E5 DDE1            14      POP IX
0006E7 07E7 E67F             7      AND $7F
0006E9 07E9 FE07             7      CP  7
0006EB 07EB 200A            12      JR  NZ,FGETP3
0006ED 07ED 3A84EC          13  SMC14:  LD  A,($EC84)
0006F0 07F0 F680             7      OR  $80
0006F2 07F2 01FC0F          10      LD  BC,$FFC
0006F5 07F5 ED79            12      OUT (C),A
       07F7                     FGETP3:
0006F7 07F7 7C               4      LD  A,H
0006F8 07F8 B5               4      OR  L
0006F9 07F9 CAB704          10      JP  Z,WAIT
0006FC 07FC 110051          10      LD  DE,PDBUF
0006FF 07FF E1              10      POP HL
000700 0800 C1              10      POP BC
000701 0801 18B9            12      JR  FGETP1
                                
       0803                     MOTOFF:
000703 0803 3A84EC          13  SMC15:  LD  A,($EC84)
000706 0806 E67F             7      AND $7F
000708 0808 01FC0F          10      LD  BC,$FFC
00070B 080B ED79            12      OUT (C),A
00070D 080D C9              10      RET
                                
       080E                     CPSTR:
00070E 080E 1A               7      LD  A,(DE)
00070F 080F 13               6      INC DE
000710 0810 BE               7      CP  (HL)
000711 0811 23               6      INC HL
000712 0812 C0              11      RET NZ
000713 0813 10F9            13      DJNZ    CPSTR
000715 0815 C9              10      RET
                                
       0816                     CLS:
000716 0816 3ABFEC          13  SMC16:  LD  A,($ECBF)
000719 0819 CBA7             8      RES 4,A
00071B 081B CD2308          17      CALL    CLS0
00071E 081E 3ABFEC          13  SMC17:  LD  A,($ECBF)
000721 0821 CBE7             8      SET 4,A
       0823                     CLS0:
000723 0823 01D01F          10      LD  BC,$1FD0
000726 0826 ED79            12      OUT (C),A
000728 0828 32BFEC          13  SMC18:  LD  ($ECBF),A
00072B 082B AF               4      XOR A
00072C 082C 4F               4      LD  C,A
00072D 082D 210340          10      LD  HL,$4003
       0830                     CLS1:
000730 0830 44               4      LD  B,H
       0831                     CLS2:
000731 0831 ED71                    DB  $ED,$71
000733 0833 04               4      INC B
000734 0834 20FB            12      JR  NZ,CLS2
                                ;
000736 0836 85               4      ADD A,L
000737 0837 4F               4      LD  C,A
000738 0838 20F6            12      JR  NZ,CLS1
00073A 083A C9              10      RET
                                
       083B                     SWITCH:
00073B 083B 1A               7      LD  A,(DE)
00073C 083C FE20             7      CP  $20
00073E 083E D8              11      RET C
00073F 083F 13               6      INC DE
000740 0840 FE2F             7      CP  "/"
000742 0842 20F7            12      JR  NZ,SWITCH
000744 0844 1A               7      LD  A,(DE)
000745 0845 13               6      INC DE
       0846                     CAP:
000746 0846 FE61             7      CP  "a"
000748 0848 D8              11      RET C
000749 0849 FE7B             7      CP  "z"+1
00074B 084B D0              11      RET NC
00074C 084C D620             7      SUB $20
00074E 084E C9              10      RET
                                
       084F                     GRAPH0:
00074F 084F 0610             7      LD  B,$10
000751 0851 ED71                    DB  $ED,$71
000753 0853 04               4      INC B
000754 0854 ED71                    DB  $ED,$71
000756 0856 04               4      INC B
000757 0857 ED71                    DB  $ED,$71
000759 0859 04               4      INC B
00075A 085A ED71                    DB  $ED,$71
00075C 085C 3A1800          13      LD  A,(BIOS)
00075F 085F 3C               4      INC A
000760 0860 C8              11      RET Z
       0861                     GR1:
000761 0861 CD8B08          17      CALL    G1FD0
000764 0864 F680             7      OR  $80
000766 0866 181C            12      JR  GR3
       0868                     GRAPH1:
000768 0868 01B01F          10      LD  BC,$1FB0
00076B 086B ED71                    DB  $ED,$71
00076D 086D 01AA10          10      LD  BC,$10AA
000770 0870 ED49            12      OUT (C),C
000772 0872 01CC11          10      LD  BC,$11CC
000775 0875 ED49            12      OUT (C),C
000777 0877 01F012          10      LD  BC,$12F0
00077A 087A ED49            12      OUT (C),C
00077C 087C 04               4      INC B
00077D 087D ED71                    DB  $ED,$71
00077F 087F CD8B08          17      CALL    G1FD0
000782 0882 E677             7      AND $77
       0884                     GR3:
000784 0884 77               7      LD  (HL),A
000785 0885 01D01F          10      LD  BC,$1FD0
000788 0888 ED79            12      OUT (C),A
00078A 088A C9              10      RET
       088B                     G1FD0:
00078B 088B 21BFEC          10  SMC19:  LD  HL,$ECBF
00078E 088E 7E               7      LD  A,(HL)
00078F 088F C9              10      RET
                                
                                    INCLUDE "MAGS.ASM"
                                ;
                                ;   MAG save  by Gaku
                                ;
       0890                     SAVE:
000790 0890 2A0600          16      LD  HL,(SYSTEM+1)
000793 0893 0138AC          10      LD  BC,WBUF+$0200
000796 0896 37               4      SCF
000797 0897 ED42            15      SBC HL,BC
000799 0899 DA0000          10      JP  C,0
00079C 089C CA0000          10      JP  Z,0
                                
00079F 089F CB85             8      RES 0,L
0007A1 08A1 229E0B          16      LD  (WSIZEW+1),HL
0007A4 08A4 CB3C             8      SRL H
0007A6 08A6 CB1D             8      RR  L
0007A8 08A8 22B00B          16      LD  (WSIZE+1),HL
0007AB 08AB 44               4      LD  B,H
0007AC 08AC 4D               4      LD  C,L
0007AD 08AD 2138AA          10      LD  HL,WBUF
0007B0 08B0 D9               4      EXX
                                
0007B1 08B1 2AD108          16      LD  HL,(L200X1+1)
0007B4 08B4 1E2E             7      LD  E,"."
0007B6 08B6 E5              11      PUSH    HL
0007B7 08B7 CDB40B          17      CALL    PUTSTR
0007BA 08BA E1              10      POP HL
0007BB 08BB 1E08             7      LD  E,8
0007BD 08BD CDB40B          17      CALL    PUTSTR
                                
0007C0 08C0 2198A9          10      LD  HL,ZFLAGB
0007C3 08C3 1199A9          10      LD  DE,ZFLAGB+1
0007C6 08C6 019F00          10      LD  BC,159
0007C9 08C9 3600            10      LD  (HL),0
0007CB 08CB EDB0                    LDIR
                                
0007CD 08CD 210000          10      LD  HL,0
0007D0 08D0 019001          10  L200X1: LD  BC,400
       08D3                     SAVE1:
0007D3 08D3 C5              11      PUSH    BC
0007D4 08D4 22690B          16      LD  (LOCY+1),HL
                                
0007D7 08D7 DD2198A9        14      LD  IX,ZFLAGB
0007DB 08DB AF               4      XOR A
       08DC                     SAVE2:
0007DC 08DC 32630B          13      LD  (LOCX+1),A
0007DF 08DF 2A690B          16      LD  HL,(LOCY+1)
                                
0007E2 08E2 CDE50A          17      CALL    POINT
0007E5 08E5 EB               4      EX  DE,HL
                                
0007E6 08E6 DD7E00          19      LD  A,(IX+0)
0007E9 08E9 B7               4      OR  A
0007EA 08EA 2809            12      JR  Z,UPE
                                
0007EC 08EC 87               4      ADD A,A
0007ED 08ED 4F               4      LD  C,A
0007EE 08EE 0600             7      LD  B,0
0007F0 08F0 CD5E0B          17      CALL    MPOINT
0007F3 08F3 2817            12      JR  Z,HITU
                                
       08F5                     UPE:
0007F5 08F5 01000F          10      LD  BC,$0F00
       08F8                     SAVE3:
0007F8 08F8 C5              11      PUSH    BC
                                
0007F9 08F9 0600             7      LD  B,0
0007FB 08FB 21CC0B          10      LD  HL,STABLE0
0007FE 08FE 09              11      ADD HL,BC
0007FF 08FF 4E               7      LD  C,(HL)
000800 0900 CD5E0B          17      CALL    MPOINT
000803 0903 280C            12      JR  Z,HIT
       0905                     SKIP1:
000805 0905 C1              10      POP BC
000806 0906 0C               4      INC C
000807 0907 10EF            13      DJNZ    SAVE3
                                
000809 0909 AF               4      XOR A
00080A 090A 180D            12      JR  ZERO
       090C                     HITU:
00080C 090C DD7E00          19      LD  A,(IX+0)
00080F 090F 1808            12      JR  ZERO
       0911                     HIT:
000811 0911 C1              10      POP BC
000812 0912 0600             7      LD  B,0
000814 0914 21DB0B          10      LD  HL,STABLE1
000817 0917 09              11      ADD HL,BC
000818 0918 7E               7      LD  A,(HL)
       0919                     ZERO:
000819 0919 DD7700          19      LD  (IX+0),A
00081C 091C DD23            10      INC IX
00081E 091E 21982C          10  SAVEF:  LD  HL,ZFLAG
000821 0921 ED6F            18      RLD
000823 0923 3A630B          13      LD  A,(LOCX+1)
000826 0926 0F               4      RRCA
000827 0927 3004            12      JR  NC,SKIP2
000829 0929 23               6      INC HL
00082A 092A 221F09          16      LD  (SAVEF+1),HL
       092D                     SKIP2:
00082D 092D 3A630B          13      LD  A,(LOCX+1)
                                
000830 0930 0600             7      LD  B,0
000832 0932 87               4      ADD A,A
000833 0933 CB10             8      RL  B
000835 0935 4F               4      LD  C,A
                                
000836 0936 3A690B          13      LD  A,(LOCY+1)
000839 0939 E60F             7      AND 15
00083B 093B 87               4      ADD A,A
00083C 093C B0               4      OR  B
00083D 093D 47               4      LD  B,A
                                
00083E 093E 21980C          10      LD  HL,FABF
000841 0941 09              11      ADD HL,BC
000842 0942 73               7      LD  (HL),E
000843 0943 23               6      INC HL
000844 0944 72               7      LD  (HL),D
                                
000845 0945 3A630B          13      LD  A,(LOCX+1)
000848 0948 3C               4      INC A
000849 0949 FEA0             7      CP  160
00084B 094B DADC08          10      JP  C,SAVE2
                                
00084E 094E 1E6F             7      LD  E,"o"
000850 0950 0E02             7      LD  C,2
000852 0952 CD0500          17      CALL    SYSTEM
                                
000855 0955 C1              10      POP BC
000856 0956 2A690B          16      LD  HL,(LOCY+1)
000859 0959 23               6      INC HL
00085A 095A 00               4  S200X1: NOP
00085B 095B 0B               6      DEC BC
00085C 095C 78               4      LD  A,B
00085D 095D B1               4      OR  C
00085E 095E C2D308          10      JP  NZ,SAVE1
                                
000861 0961 2198A9          10      LD  HL,ZFLAGB
000864 0964 1199A9          10      LD  DE,ZFLAGB+1
000867 0967 014F00          10      LD  BC,79
00086A 096A 3600            10      LD  (HL),0
00086C 096C EDB0                    LDIR
                                
00086E 096E 21980C          10      LD  HL,FABF
000871 0971 11990C          10      LD  DE,FABF+1
000874 0974 019F0F          10  M200X1: LD  BC,3999
000877 0977 3601            10      LD  (HL),1
000879 0979 EDB0                    LDIR
                                
00087B 097B 21982C          10      LD  HL,ZFLAG
00087E 097E FD21982C        14      LD  IY,ZFLAG
000882 0982 019001          10  L200X2: LD  BC,400
000885 0985 110000          10      LD  DE,0
       0988                     SAVE4:
000888 0988 C5              11      PUSH    BC
000889 0989 0650             7      LD  B,80
00088B 098B DD2198A9        14      LD  IX,ZFLAGB
       098F                     SAVE5:
00088F 098F 7E               7      LD  A,(HL)
000890 0990 4F               4      LD  C,A
000891 0991 E6F0             7      AND $F0
000893 0993 2001            12      JR  NZ,SAVE6
000895 0995 13               6      INC DE
       0996                     SAVE6:
000896 0996 79               4      LD  A,C
000897 0997 E60F             7      AND $0F
000899 0999 2001            12      JR  NZ,SAVE7
00089B 099B 13               6      INC DE
       099C                     SAVE7:
00089C 099C 79               4      LD  A,C
00089D 099D DDAE00          19      XOR (IX+0)
0008A0 09A0 DD7100          19      LD  (IX+0),C
0008A3 09A3 2806            12      JR  Z,SAVE8
0008A5 09A5 FD7700          19      LD  (IY+0),A
0008A8 09A8 FD23            10      INC IY
0008AA 09AA 37               4      SCF
       09AB                     SAVE8:
0008AB 09AB E5              11      PUSH    HL
0008AC 09AC 21980C          10  FABFP:  LD  HL,FABF
0008AF 09AF CB16            15      RL  (HL)
0008B1 09B1 3004            12      JR  NC,SAVE9
0008B3 09B3 23               6      INC HL
0008B4 09B4 22AD09          16      LD  (FABFP+1),HL
       09B7                     SAVE9:
0008B7 09B7 E1              10      POP HL
0008B8 09B8 23               6      INC HL
0008B9 09B9 DD23            10      INC IX
0008BB 09BB 10D2            13      DJNZ    SAVE5
                                
0008BD 09BD C1              10      POP BC
0008BE 09BE 0B               6      DEC BC
0008BF 09BF 78               4      LD  A,B
0008C0 09C0 B1               4      OR  C
0008C1 09C1 20C5            12      JR  NZ,SAVE4
                                
0008C3 09C3 FDE5            15      PUSH    IY
0008C5 09C5 E1              10      POP HL
0008C6 09C6 01982C          10      LD  BC,ZFLAG
0008C9 09C9 AF               4      XOR A
0008CA 09CA ED42            15      SBC HL,BC
0008CC 09CC CB45             8      BIT 0,L
0008CE 09CE 2801            12      JR  Z,EVEN
0008D0 09D0 23               6      INC HL
       09D1                     EVEN:
0008D1 09D1 225C0C          16      LD  (FBSIZE),HL
                                
0008D4 09D4 ED4B580C        20      LD  BC,(FBST)
0008D8 09D8 09              11      ADD HL,BC
0008D9 09D9 22600C          16      LD  (PICST),HL
                                
0008DC 09DC AF               4      XOR A
0008DD 09DD EB               4      EX  DE,HL
0008DE 09DE 29              11      ADD HL,HL
0008DF 09DF 22640C          16      LD  (PICSIZE),HL
0008E2 09E2 8F               4      ADC A,A
0008E3 09E3 32660C          13      LD  (PICSIZE+2),A
                                
0008E6 09E6 115C00          10      LD  DE,FCB1
0008E9 09E9 0E16             7      LD  C,$16
0008EB 09EB CD0500          17      CALL    SYSTEM
0008EE 09EE B7               4      OR  A
0008EF 09EF C20000          10      JP  NZ,0
                                
0008F2 09F2 210000          10      LD  HL,0
0008F5 09F5 227D00          16      LD  (FCB1+33),HL
0008F8 09F8 227F00          16      LD  (FCB1+35),HL
0008FB 09FB 2C               4      INC L
0008FC 09FC 226A00          16      LD  (FCB1+14),HL
                                
0008FF 09FF 11270C          10      LD  DE,MAGID
000902 0A02 0E1A             7      LD  C,$1A
000904 0A04 CD0500          17      CALL    SYSTEM
                                
000907 0A07 21A00F          10  M200X2: LD  HL,4000
00090A 0A0A 117100          10      LD  DE,FABF-MAGID
00090D 0A0D 19              11      ADD HL,DE
00090E 0A0E 115C00          10      LD  DE,FCB1
000911 0A11 0E26             7      LD  C,$26
000913 0A13 CD0500          17      CALL    SYSTEM
000916 0A16 B7               4      OR  A
000917 0A17 C20000          10      JP  NZ,0
                                
00091A 0A1A 11982C          10      LD  DE,ZFLAG
00091D 0A1D 0E1A             7      LD  C,$1A
00091F 0A1F CD0500          17      CALL    SYSTEM
                                
000922 0A22 2A5C0C          16      LD  HL,(FBSIZE)
000925 0A25 115C00          10      LD  DE,FCB1
000928 0A28 0E26             7      LD  C,$26
00092A 0A2A CD0500          17      CALL    SYSTEM
00092D 0A2D B7               4      OR  A
00092E 0A2E C20000          10      JP  NZ,0
                                
000931 0A31 2198A9          10      LD  HL,ZFLAGB
000934 0A34 1199A9          10      LD  DE,ZFLAGB+1
000937 0A37 3600            10      LD  (HL),0
000939 0A39 014F00          10      LD  BC,79
00093C 0A3C EDB0                    LDIR
                                
00093E 0A3E 3E01             7      LD  A,1
000940 0A40 32260C          13      LD  (LOOP8),A
000943 0A43 FD21980C        14      LD  IY,FABF
000947 0A47 210000          10      LD  HL,0
00094A 0A4A 019001          10  L200X3: LD  BC,400
       0A4D                     PICS1:
00094D 0A4D C5              11      PUSH    BC
00094E 0A4E 22810A          16      LD  (PICY+1),HL
                                
000951 0A51 AF               4      XOR A
000952 0A52 DD2198A9        14      LD  IX,ZFLAGB
       0A56                     PICS2:
000956 0A56 327F0A          13      LD  (PICX+1),A
                                
000959 0A59 AF               4      XOR A
00095A 0A5A FDCB0016        23      RL  (IY+0)
00095E 0A5E 3008            12      JR  NC,YFLAG1
                                
000960 0A60 21982C          10  PICSF:  LD  HL,ZFLAG
000963 0A63 7E               7      LD  A,(HL)
000964 0A64 23               6      INC HL
000965 0A65 22610A          16      LD  (PICSF+1),HL
       0A68                     YFLAG1:
000968 0A68 DDAE00          19      XOR (IX+0)
00096B 0A6B DD7700          19      LD  (IX+0),A
                                
00096E 0A6E E5              11      PUSH    HL
00096F 0A6F 21260C          10      LD  HL,LOOP8
000972 0A72 CB06            15      RLC (HL)
000974 0A74 E1              10      POP HL
000975 0A75 3002            12      JR  NC,YFLAG2
000977 0A77 FD23            10      INC IY
       0A79                     YFLAG2:
000979 0A79 F5              11      PUSH    AF
00097A 0A7A E6F0             7      AND $F0
00097C 0A7C 200C            12      JR  NZ,PICS3
                                
00097E 0A7E 3E00             7  PICX:   LD  A,$00
000980 0A80 210000          10  PICY:   LD  HL,0
000983 0A83 87               4      ADD A,A
000984 0A84 CDE50A          17      CALL    POINT
000987 0A87 CD830B          17      CALL    FPUTW
       0A8A                     PICS3:
00098A 0A8A F1              10      POP AF
00098B 0A8B E60F             7      AND $0F
00098D 0A8D 200E            12      JR  NZ,PICS4
                                
00098F 0A8F 3A7F0A          13      LD  A,(PICX+1)
000992 0A92 2A810A          16      LD  HL,(PICY+1)
000995 0A95 87               4      ADD A,A
000996 0A96 3C               4      INC A
000997 0A97 CDE50A          17      CALL    POINT
00099A 0A9A CD830B          17      CALL    FPUTW
       0A9D                     PICS4:
00099D 0A9D DD23            10      INC IX
00099F 0A9F 3A7F0A          13      LD  A,(PICX+1)
0009A2 0AA2 3C               4      INC A
0009A3 0AA3 FE50             7      CP  80
0009A5 0AA5 38AF            12      JR  C,PICS2
                                
0009A7 0AA7 2A810A          16      LD  HL,(PICY+1)
0009AA 0AAA 23               6      INC HL
0009AB 0AAB 00               4  S200X2: NOP
0009AC 0AAC C1              10      POP BC
0009AD 0AAD 0B               6      DEC BC
0009AE 0AAE 78               4      LD  A,B
0009AF 0AAF B1               4      OR  C
0009B0 0AB0 C24D0A          10      JP  NZ,PICS1
                                
0009B3 0AB3 1138AA          10      LD  DE,WBUF
0009B6 0AB6 0E1A             7      LD  C,$1A
0009B8 0AB8 CD0500          17      CALL    SYSTEM
0009BB 0ABB D9               4      EXX
0009BC 0ABC 1138AA          10      LD  DE,WBUF
0009BF 0ABF A7               4      AND A
0009C0 0AC0 ED52            15      SBC HL,DE
0009C2 0AC2 115C00          10      LD  DE,FCB1
0009C5 0AC5 0E26             7      LD  C,$26
0009C7 0AC7 CD0500          17      CALL    SYSTEM
0009CA 0ACA B7               4      OR  A
0009CB 0ACB C20000          10      JP  NZ,0
                                
0009CE 0ACE 0E10             7      LD  C,$10
0009D0 0AD0 115C00          10      LD  DE,FCB1
0009D3 0AD3 CD0500          17      CALL    SYSTEM
0009D6 0AD6 B7               4      OR  A
0009D7 0AD7 C20000          10      JP  NZ,0
                                
0009DA 0ADA 11BF0B          10      LD  DE,COMPL
0009DD 0ADD 0E09             7      LD  C,9
0009DF 0ADF CD0500          17      CALL    SYSTEM
0009E2 0AE2 C30000          10      JP  0
                                
       0AE5                     POINT:          ;x=AF Y=HL
0009E5 0AE5 F5              11      PUSH    AF
0009E6 0AE6 7D               4      LD  A,L     ;ﾗｽﾀ(0-7)
0009E7 0AE7 E60E             7      AND $0E
0009E9 0AE9 87               4      ADD A,A
0009EA 0AEA 87               4      ADD A,A
0009EB 0AEB 57               4      LD  D,A
                                
0009EC 0AEC 7D               4      LD  A,L     ;ﾊﾞﾝｸ
0009ED 0AED 87               4      ADD A,A
0009EE 0AEE 87               4      ADD A,A
0009EF 0AEF 87               4      ADD A,A
0009F0 0AF0 87               4      ADD A,A
0009F1 0AF1 E610             7      AND $10
0009F3 0AF3 5F               4      LD  E,A
0009F4 0AF4 3ABFEC          13  SMC20:  LD  A,($ECBF)
0009F7 0AF7 E6EF             7      AND $EF
0009F9 0AF9 B3               4      OR  E
0009FA 0AFA 32BFEC          13  SMC21:  LD  ($ECBF),A
0009FD 0AFD 01D01F          10      LD  BC,$1FD0
000A00 0B00 ED79            12      OUT (C),A
                                
000A02 0B02 44               4      LD  B,H     ;ﾗｲﾝ
000A03 0B03 7D               4      LD  A,L
000A04 0B04 E6F0             7      AND $F0
000A06 0B06 6F               4      LD  L,A
000A07 0B07 4F               4      LD  C,A
000A08 0B08 29              11      ADD HL,HL       ;*2
000A09 0B09 29              11      ADD HL,HL       ;*4
000A0A 0B0A 09              11      ADD HL,BC       ;*5
                                
000A0B 0B0B 7C               4      LD  A,H     ;ﾗｲﾝ
000A0C 0B0C B2               4      OR  D       ;ﾗｽﾀ
000A0D 0B0D F6C0             7      OR  $C0
                                
000A0F 0B0F 47               4      LD  B,A
                                
000A10 0B10 F1              10      POP AF
000A11 0B11 CB3F             8      SRL A
000A13 0B13 381C            12      JR  C,POINT3
                                
000A15 0B15 85               4      ADD A,L
000A16 0B16 4F               4      LD  C,A
000A17 0B17 88               4      ADC A,B
000A18 0B18 91               4      SUB C
000A19 0B19 47               4      LD  B,A     ;BC=ｱﾄﾞﾚｽ
                                
000A1A 0B1A 210000          10      LD  HL,0
                                
000A1D 0B1D ED78            12      IN  A,(C)
000A1F 0B1F CD4D0B          17      CALL    POINT1
                                
000A22 0B22 CBB0             8      RES 6,B
000A24 0B24 ED78            12      IN  A,(C)
000A26 0B26 CD4D0B          17      CALL    POINT1
                                
000A29 0B29 CBB8             8      RES 7,B
000A2B 0B2B CBF0             8      SET 6,B
000A2D 0B2D ED78            12      IN  A,(C)
000A2F 0B2F 181C            12      JR  POINT1
       0B31                     POINT3:
000A31 0B31 85               4      ADD A,L
000A32 0B32 4F               4      LD  C,A
000A33 0B33 88               4      ADC A,B
000A34 0B34 91               4      SUB C
000A35 0B35 47               4      LD  B,A     ;BC=ｱﾄﾞﾚｽ
                                
000A36 0B36 210000          10      LD  HL,0
                                
000A39 0B39 ED78            12      IN  A,(C)
000A3B 0B3B CD470B          17      CALL    POINT2
                                
000A3E 0B3E CBB0             8      RES 6,B
000A40 0B40 CD470B          17      CALL    POINT2
                                
000A43 0B43 CBB8             8      RES 7,B
000A45 0B45 CBF0             8      SET 6,B
       0B47                     POINT2:
000A47 0B47 ED78            12      IN  A,(C)
000A49 0B49 87               4      ADD A,A
000A4A 0B4A 87               4      ADD A,A
000A4B 0B4B 87               4      ADD A,A
000A4C 0B4C 87               4      ADD A,A
       0B4D                     POINT1:
000A4D 0B4D 87               4      ADD A,A
000A4E 0B4E 3002            12      JR  NC,POI1
000A50 0B50 CBDD             8      SET 3,L
       0B52                     POI1:
000A52 0B52 87               4      ADD A,A
000A53 0B53 CB15             8      RL  L
                                
000A55 0B55 87               4      ADD A,A
000A56 0B56 3002            12      JR  NC,POI2
000A58 0B58 CBDC             8      SET 3,H
       0B5A                     POI2:
000A5A 0B5A 87               4      ADD A,A
000A5B 0B5B CB14             8      RL  H
000A5D 0B5D C9              10      RET
                                
       0B5E                     MPOINT:         ;x=AF y=HL
000A5E 0B5E 21E80B          10  T200X1: LD  HL,STABLE-2
000A61 0B61 09              11      ADD HL,BC
                                
000A62 0B62 3E00             7  LOCX:   LD  A,$00
000A64 0B64 96               7      SUB (HL)
000A65 0B65 D8              11      RET C
                                
000A66 0B66 23               6      INC HL
000A67 0B67 4E               7      LD  C,(HL)
                                
000A68 0B68 210000          10  LOCY:   LD  HL,0
000A6B 0B6B ED42            15      SBC HL,BC       ;CF=0 B=0
000A6D 0B6D D8              11      RET C
                                
000A6E 0B6E 87               4      ADD A,A
000A6F 0B6F CB10             8      RL  B
000A71 0B71 4F               4      LD  C,A
                                
000A72 0B72 7D               4      LD  A,L
000A73 0B73 E60F             7      AND 15
000A75 0B75 87               4      ADD A,A
000A76 0B76 B0               4      OR  B
000A77 0B77 47               4      LD  B,A
                                
000A78 0B78 21980C          10      LD  HL,FABF
000A7B 0B7B 09              11      ADD HL,BC
000A7C 0B7C 7E               7      LD  A,(HL)
000A7D 0B7D 23               6      INC HL
000A7E 0B7E 66               7      LD  H,(HL)
000A7F 0B7F 6F               4      LD  L,A
                                
000A80 0B80 ED52            15      SBC HL,DE
000A82 0B82 C9              10      RET
                                
       0B83                     FPUTW:
000A83 0B83 D9               4      EXX
000A84 0B84 78               4      LD  A,B
000A85 0B85 B1               4      OR  C
000A86 0B86 280D            12      JR  Z,FPUTW1
       0B88                     FPUTW2:
000A88 0B88 D9               4      EXX
000A89 0B89 7D               4      LD  A,L
000A8A 0B8A D9               4      EXX
000A8B 0B8B 77               7      LD  (HL),A
000A8C 0B8C 23               6      INC HL
000A8D 0B8D D9               4      EXX
000A8E 0B8E 7C               4      LD  A,H
000A8F 0B8F D9               4      EXX
000A90 0B90 77               7      LD  (HL),A
000A91 0B91 23               6      INC HL
000A92 0B92 0B               6      DEC BC
000A93 0B93 D9               4      EXX
000A94 0B94 C9              10      RET
       0B95                     FPUTW1:
000A95 0B95 1138AA          10      LD  DE,WBUF
000A98 0B98 0E1A             7      LD  C,$1A
000A9A 0B9A CD0500          17      CALL    SYSTEM
                                
000A9D 0B9D 210000          10  WSIZEW: LD  HL,0
000AA0 0BA0 115C00          10      LD  DE,FCB1
000AA3 0BA3 0E26             7      LD  C,$26
000AA5 0BA5 CD0500          17      CALL    SYSTEM
000AA8 0BA8 B7               4      OR  A
000AA9 0BA9 C20000          10      JP  NZ,0
                                
000AAC 0BAC 2138AA          10      LD  HL,WBUF
000AAF 0BAF 010000          10  WSIZE:  LD  BC,0
000AB2 0BB2 18D4            12      JR  FPUTW2
                                
       0BB4                     PUTSTR:
000AB4 0BB4 0E02             7      LD  C,2
000AB6 0BB6 CD0500          17      CALL    SYSTEM
000AB9 0BB9 2B               6      DEC HL
000ABA 0BBA 7C               4      LD  A,H
000ABB 0BBB B5               4      OR  L
000ABC 0BBC 20F6            12      JR  NZ,PUTSTR
000ABE 0BBE C9              10      RET
                                
       0BBF                     COMPL:
000ABF 0BBF 20636F6D706C6574        DB  " completed !$"
            6564202124          
                                
000ACC 0BCC 02080A0C0E121404    STABLE0:DB  1*2,4*2,5*2,6*2,7*2,9*2,10*2,2*2
000AD4 0BD4 1016181A1C061E          DB  8*2,11*2,12*2,13*2,14*2,3*2,15*2
                                
000ADB 0BDB 0104050607090A02    STABLE1:DB  1,4,5,6,7,9,10,2,8,11,12,13,14,3,15
            080B0C0D0E030F      
                                
       0BEA                     STABLE:
000AEA 0BEA 0100                    DB  1,0     ; 1
000AEC 0BEC 0200                    DB  2,0     ; 2
000AEE 0BEE 0400                    DB  4,0     ; 3
000AF0 0BF0 0001                    DB  0,1     ; 4
000AF2 0BF2 0101                    DB  1,1     ; 5
000AF4 0BF4 0002                    DB  0,2     ; 6
000AF6 0BF6 0102                    DB  1,2     ; 7
000AF8 0BF8 0202                    DB  2,2     ; 8
000AFA 0BFA 0004                    DB  0,4     ; 9
000AFC 0BFC 0104                    DB  1,4     ;10
000AFE 0BFE 0204                    DB  2,4     ;11
000B00 0C00 0008                    DB  0,8     ;12
000B02 0C02 0108                    DB  1,8     ;13
000B04 0C04 0208                    DB  2,8     ;14
000B06 0C06 0010                    DB  0,16        ;15
       0C08                     STABLE2:
000B08 0C08 0100                    DB  1,0     ; 1
000B0A 0C0A 0200                    DB  2,0     ; 2
000B0C 0C0C 0400                    DB  4,0     ; 3
000B0E 0C0E 0002                    DB  0,1*2       ; 4
000B10 0C10 0102                    DB  1,1*2       ; 5
000B12 0C12 0004                    DB  0,2*2       ; 6
000B14 0C14 0104                    DB  1,2*2       ; 7
000B16 0C16 0204                    DB  2,2*2       ; 8
000B18 0C18 0008                    DB  0,4*2       ; 9
000B1A 0C1A 0108                    DB  1,4*2       ;10
000B1C 0C1C 0208                    DB  2,4*2       ;11
000B1E 0C1E 0010                    DB  0,8*2       ;12
000B20 0C20 0110                    DB  1,8*2       ;13
000B22 0C22 0210                    DB  2,8*2       ;14
000B24 0C24 0020                    DB  0,16*2      ;15
                                
000B26 0C26 01                  LOOP8:  DB  1
                                
       0C27                     MAGID:
000B27 0C27 4D414B4930322020        DB  "MAKI02  "
000B2F 0C2F 2058312020              DB  " X1  "
000B34 0C34 3E93E43C            USER:   DB  ">",$93,$E4,"<"
000B38 0C38                         DS  15,$20
000B47 0C47 1A                      DB  $1A
       0C48                     SHEAD:
000B48 0C48 00                      DB  0
000B49 0C49 00                      DB  0
000B4A 0C4A 00                      DB  0
000B4B 0C4B 06                  SCMODE: DB  $06
000B4C 0C4C 0000                    DW  0
000B4E 0C4E 0000                    DW  0
000B50 0C50 7F02                    DW  639
000B52 0C52 8F01                L200X4: DW  399
000B54 0C54 50000000                DW  $0050,0     ;A
000B58 0C58 F00F0000            FBST:   DW  $0FF0,0     ;B
000B5C 0C5C 00000000            FBSIZE: DW  0,0
000B60 0C60 00000000            PICST:  DW  0,0     ;ﾋﾟｸｾﾙ
000B64 0C64 00000000            PICSIZE:DW  0,0
       0C68                     DEGI8:
000B68 0C68 000000                  DB  $00,$00,$00
000B6B 0C6B 0000FF                  DB  $00,$00,$FF
000B6E 0C6E 00FF00                  DB  $00,$FF,$00
000B71 0C71 00FFFF                  DB  $00,$FF,$FF
000B74 0C74 FF0000                  DB  $FF,$00,$00
000B77 0C77 FF00FF                  DB  $FF,$00,$FF
000B7A 0C7A FFFF00                  DB  $FF,$FF,$00
000B7D 0C7D FFFFFF                  DB  $FF,$FF,$FF
000B80 0C80 000000                  DB  $00,$00,$00
000B83 0C83 0000FF                  DB  $00,$00,$FF
000B86 0C86 00FF00                  DB  $00,$FF,$00
000B89 0C89 00FFFF                  DB  $00,$FF,$FF
000B8C 0C8C FF0000                  DB  $FF,$00,$00
000B8F 0C8F FF00FF                  DB  $FF,$00,$FF
000B92 0C92 FFFF00                  DB  $FF,$FF,$00
000B95 0C95 FFFFFF                  DB  $FF,$FF,$FF
       0C98                     FABF:
                                
       2C98                     ZFLAG:  EQU FABF+16*512
       A998                     ZFLAGB: EQU ZFLAG+80*400
       AA38                     WBUF:   EQU ZFLAGB+160
[EOF:MAGS.ASM:SHIFT_JIS]
                                
       0C98                     TITLE:
000B98 0C98 5831204D4147206C        DB  "X1 MAG loader/saver v1.01",$0D,$0A
            6F616465722F7361    
            7665722076312E30    
            310D0A              
000BB3 0CB3 24                      DB  "$"
       0CB4                     MUSAGE:
000BB4 0CB4 75736167653A204D        DB  "usage: MAG ﾌｧｲﾙﾈｰﾑ[.MAG][ｽｲｯﾁ]",$0D,$0A
            414720CCA7B2D9C8    
            B0D15B2E4D41475D    
            5BBDB2AFC15D0D0A    
000BD4 0CD4 DBB0C4DE3A              DB  "ﾛｰﾄﾞ:"
000BD9 0CD9 092F4320BDB8D8B0        DB  9,"/C ｽｸﾘｰﾝ･ｸﾘｱ",$0D,$0A
            DDA5B8D8B10D0A      
000BE8 0CE8 092F52205247420D        DB  9,"/R RGB",$0D,$0A
            0A                  
000BF1 0CF1 BEB0CCDE3A              DB  "ｾｰﾌﾞ:"
000BF6 0CF6 092F5320BEB0CCDE        DB  9,"/S ｾｰﾌﾞ",$0D,$0A
            0D0A                
000C00 0D00 092F4820323030D7        DB  9,"/H 200ﾗｲﾝ",$0D,$0A
            B2DD0D0A            
000C0C 0D0C 092F5520D5B0BBDE        DB  9,"/U ﾕｰｻﾞｰ",$0D,$0A
            B00D0A              
000C17 0D17 24                      DB  "$"
       0D18                     COMP:
000C18 0D18 204F6B0D0A24            DB  " Ok",$0D,$0A,"$"
                                
       0D1E                     TABLE:
000C1E 0D1E 0000                    DB  0  ,0       ; 0
000C20 0D20 0200                    DB  1*2,0       ; 1
000C22 0D22 0400                    DB  2*2,0       ; 2
000C24 0D24 0800                    DB  4*2,0       ; 3
000C26 0D26 0002                    DB  0  ,1*2     ; 4
000C28 0D28 0202                    DB  1*2,1*2     ; 5
000C2A 0D2A 0004                    DB  0  ,2*2     ; 6
000C2C 0D2C 0204                    DB  1*2,2*2     ; 7
000C2E 0D2E 0404                    DB  2*2,2*2     ; 8
000C30 0D30 0008                    DB  0  ,4*2     ; 9
000C32 0D32 0208                    DB  1*2,4*2     ;10
000C34 0D34 0408                    DB  2*2,4*2     ;11
000C36 0D36 0010                    DB  0  ,8*2     ;12
000C38 0D38 0210                    DB  1*2,8*2     ;13
000C3A 0D3A 0410                    DB  2*2,8*2     ;14
000C3C 0D3C 0000                    DB  0  ,0       ;15
                                
       0D3E                     FILE:
000C3E 0D3E                         DS  37
       0D63                     FILE2:
000C63 0D63                         DS  37
                                
000C88 0D88 00                  GREEN:  DB  0
000C89 0D89 00                  RED:    DB  0
000C8A 0D8A 00                  BLUE:   DB  0
[EOF:MAG.ASM:SHIFT_JIS]
