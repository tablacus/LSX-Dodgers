                                ;*** AILZ80ASM *** Z-80 Assembler, version 1.0.13.0, LST:Full:4
                                ;   LSX-Dodgers for MSX
                                ;   Programmed by
                                ;   Gaku (Lovers/Tablacus)
                                
                                    INCLUDE "MSXDEF.ASM"
                                
                                ;   LSX-Dodgers DEF
                                ;   MSX
                                
       0003                     MAC EQU 3   ;MSX
       0001                     DEV EQU 1
                                
       001D                     VER_6F  EQU 0001DH
                                
       4000                     RUN EQU 04000H
                                
       C700                     START2  EQU 0C700H
       CA06                     BDOS    EQU 0CA06H
       E500                     WORKAD  EQU 0E500H
       E800                     FATBF   EQU 0E800H
       EE00                     DTBUF   EQU 0EE00H
       0028                     WIDTH   EQU 40
       0019                     LINE    EQU 25
       0000                     COLORF  EQU 0
       0000                     KEYSP_H EQU 0
       0000                     KEYSP_L EQU 0
       0008                     COMS    EQU 8
       0002                     MAX_SEC_SZ_H    EQU 2       ;1セクタ1024バイトのサポート(2:off 4:on)
       8000                     BUFFER  EQU 08000H
       0100                     BUF_COM EQU 00100H
                                
       000C                     _RDSLT  EQU 0000CH
       0014                     _WRSLT  EQU 00014H
       001C                     _CALSLT EQU 0001CH
       0024                     _ENASLT EQU 00024H
       0030                     _CALLF  EQU 00030H
                                
       004A                     RDVRM   EQU 0004AH
       004D                     WRTVRM  EQU 0004DH
       006C                     INITXT  EQU 0006CH
       0078                     SETTXT  EQU 00078H
       009C                     CHSNS   EQU 0009CH
       009F                     CHGET   EQU 0009FH
       00A2                     CHPUT   EQU 000A2H
       00AE                     PINLIN  EQU 000AEH
       00B1                     INLIN   EQU 000B1H
       00B4                     QINLIN  EQU 000B4H
       00B7                     BREAKX  EQU 000B7H
       00C0                     BEEP    EQU 000C0H
       00C6                     POSIT   EQU 000C6H
       0138                     RSLREG  EQU 00138H
       0144                     PHYDIO  EQU 00144H  ;MAIN:BIOS:
       0156                     KILBUF  EQU 00156H
                                
       01F5                     REDCLK  EQU 001F5H  ;SUB
       01F9                     WRTCLK  EQU 001F9H  ;SUB
                                
       F341                     RAMAD0  EQU 0F341H
       F342                     RAMAD1  EQU 0F342H
       F343                     RAMAD2  EQU 0F343H
       F344                     RAMAD3  EQU 0F344H
                                
       FEDA                     H_STKE  EQU 0FEDAH
       FFA7                     H_PHYD  EQU 0FFA7H
                                
                                            ;ASCII-8K
       6000                     BANK0_SEL EQU 06000H
       6800                     BANK1_SEL EQU 06800H
       7000                     BANK2_SEL EQU 07000H
       7800                     BANK3_SEL EQU 07800H
                                            ;ASCII-16K
                                ;BANK0_SEL EQU 06000H
                                ;BANK1_SEL EQU 07000H
                                            ;KONAMI-8K
       8000                     KONAMI_BANK2_SEL EQU 08000H
       A000                     KONAMI_BANK3_SEL EQU 0A000H
[EOF:MSXDEF.ASM:UTF_8]
                                    INCLUDE "LDDEF.ASM"
                                
                                ;   LSX-Dodgers DEF
                                
       0001                     VER_1   EQU 1
       0006                     VER_2   EQU 6
       0001                     VER_3   EQU 1
       1D03                     MACW    EQU MAC + 01D00H    ;機種フラグとLD判別フラグ
       0103                     MACD    EQU MAC + DEV * 256 ;機種フラグとデバイスフラグ
       0161                     VER EQU VER_1 * 256 + VER_2 * 16 + VER_3
                                
       0004                     _DVSW   EQU 00004H
       0005                     SYSTEM  EQU 00005H
       000F                     JP_HL   EQU 0000FH
       005C                     FCB1    EQU 0005CH
       006C                     FCB2    EQU 0006CH
       005D                     FCB1FN  EQU FCB1+1
       006D                     FCB2FN  EQU FCB2+1
       0080                     DTA1    EQU 00080H
                                
       F323                     DISKVE  EQU 0F323H
       F325                     BREAKV  EQU 0F325H
       FFCA                     EXTBIO  EQU 0FFCAH
                                
       0000                     DPB_FATLN   EQU 00H
       0002                     DPB_DRD     EQU 02H
       0004                     DPB_DWT     EQU 04H
       0006                     DPB_FATID   EQU 06H
       0007                     DPB_SECPCL  EQU 07H
       0008                     DPB_MAXCL   EQU 08H
       000A                     DPB_FDMODE  EQU 0AH
       000B                     DPB_DIRSCNT EQU 0BH
       000C                     DPB_MAXCYL  EQU 0CH
       000D                     DPB_MAXSEC  EQU 0DH
       000E                     DPB_FATPS   EQU 0EH
       000F                     DPB_BPS     EQU 0FH
       0010                     DPB_DIRPS   EQU 10H
       0012                     DPB_DEVICE  EQU 12H
       0013                     DPB_UNITNO  EQU 13H
       0014                     DPB_ADDCL   EQU 14H
                                
       001A                     DPB_SDIR    EQU 1AH
       001C                     DPB_NAME    EQU 1CH
                                
[EOF:LDDEF.ASM:SHIFT_JIS]
000000 4000                         ORG RUN
                                
                                ; MSX ROM header
000000 4000 4142                    DB  "AB"   ; ID for auto-executable ROM
000002 4002 6B40                    DW  INIT_ROM   ; Main program execution address.
000004 4004 0000                    DW  0      ; STATEMENT
000006 4006 0000                    DW  0      ; DEVICE
000008 4008 0000                    DW  0      ; TEXT
00000A 400A 000000000000            DW  0,0,0  ; Reserved
                                    INCLUDE "MSXINIT.ASM"
                                
                                ;   LSX-Dodgers INIT
                                ;   MSX
       4010                     INIT_FDD_BOOT:
000010 4010 F3               4      DI
000011 4011 ED56             8      IM  1
000013 4013 3A42F3          13      LD  A,(RAMAD1)
000016 4016 2640             7      LD  H,040H
000018 4018 CD2400          17      CALL    _ENASLT
00001B 401B 21DC80          10      LD  HL,AT_START2+04000H
00001E 401E 1100C7          10      LD  DE,START2
000021 4021 010021          10      LD  BC,MSX_E-START2
000024 4024 EDB0                    LDIR
000026 4026 2180E7          10      LD  HL,_DEVICE+4*32     ;E
000029 4029 1100E7          10      LD  DE,_DEVICE      ;A
00002C 402C 018000          10      LD  BC,32*4
00002F 402F EDB0                    LDIR
000031 4031 21DFE7          10      LD  HL,_DEVICE+6*32+DPB_NAME+3
000034 4034 3E07             7      LD  A,7
       4036                     FDD_INIT1:
000036 4036 C62F             7      ADD A,'0'-1
000038 4038 77               7      LD  (HL),A
000039 4039 11F4FF          10      LD  DE,DPB_UNITNO-(DPB_NAME+3)
00003C 403C 19              11      ADD HL,DE
00003D 403D D630             7      SUB '0'
00003F 403F 77               7      LD  (HL),A
000040 4040 11ECFF          10      LD  DE,-DPB_UNITNO-1
000043 4043 19              11      ADD HL,DE       ;ここでZフラグは変化しない
000044 4044 20F0            12      JR  NZ,FDD_INIT1
000046 4046 211040          10      LD  HL,INIT_FDD_BOOT
                                
000049 4049 CD11C8          17      CALL    SET_BDOS
00004C 404C 21E9C7          10      LD  HL,ROMCHECKED
00004F 404F 2204C7          16      LD  (INIT_SWC),HL
000052 4052 C300C7          10      JP  START2
                                
       4055                     START:
000055 4055 F3               4      DI
000056 4056 ED56             8      IM  1
000058 4058 3E01             7      LD  A,1
00005A 405A 320068          13      LD  (BANK1_SEL),A
00005D 405D 21DC40          10      LD  HL,AT_START2
000060 4060 1100C7          10      LD  DE,START2
000063 4063 010021          10      LD  BC,MSX_E-START2
000066 4066 EDB0                    LDIR
000068 4068 C300C7          10      JP  START2
                                
       406B                     INIT_ROM:
00006B 406B 3E                      DB  03EH    ;LD A,??
00006C 406C F7              12      RST 30H
00006D 406D F3               4      DI
00006E 406E 32DAFE          13      LD  (H_STKE),A
000071 4071 CDB840          17      CALL    GTSL1_
000074 4074 21DBFE          10      LD  HL,H_STKE+1
000077 4077 77               7      LD  (HL),A
000078 4078 115540          10      LD  DE,START
00007B 407B 23               6      INC HL
00007C 407C 73               7      LD  (HL),E
00007D 407D 23               6      INC HL
00007E 407E 72               7      LD  (HL),D
                                
00007F 407F CD3801          17      CALL    RSLREG      ;read primary slot #
000082 4082 07               4      RLCA
000083 4083 07               4      RLCA
000084 4084 F5              11      PUSH    AF
000085 4085 1605             7      LD  D,4+1
000087 4087 CDBF40          17      CALL    GTSL2_
00008A 408A 3244F3          13      LD  (RAMAD3),A
00008D 408D 3A42F3          13      LD  A,(RAMAD1)
000090 4090 CDAA40          17      CALL    FIXRAMAD
000093 4093 3242F3          13      LD  (RAMAD1),A
000096 4096 3A41F3          13      LD  A,(RAMAD0)
000099 4099 CDAA40          17      CALL    FIXRAMAD
00009C 409C 3241F3          13      LD  (RAMAD0),A
00009F 409F F1              10      POP AF
0000A0 40A0 1603             7      LD  D,2+1
0000A2 40A2 CDBF40          17      CALL    GTSL2_
0000A5 40A5 3243F3          13      LD  (RAMAD2),A
                                
0000A8 40A8 FB               4      EI
0000A9 40A9 C9              10      RET
                                
       40AA                     FIXRAMAD:
0000AA 40AA B7               4      OR  A
0000AB 40AB 2807            12      JR  Z,FIXRAMAD1
0000AD 40AD FEC9             7      CP  0C9H
0000AF 40AF 2803            12      JR  Z,FIXRAMAD1
0000B1 40B1 FEFF             7      CP  0FFH
0000B3 40B3 C0              11      RET NZ
       40B4                     FIXRAMAD1:
0000B4 40B4 3A44F3          13      LD  A,(RAMAD3)
0000B7 40B7 C9              10      RET
                                
       40B8                     GTSL1_:             ;自分のいるスロットを知る
0000B8 40B8 CD3801          17      CALL    RSLREG      ;read primary slot #
0000BB 40BB 0F               4      RRCA
0000BC 40BC 0F               4      RRCA
0000BD 40BD 1601             7      LD  D,1
       40BF                     GTSL2_:
0000BF 40BF E603             7      AND 3       ;[A]=000000PP
0000C1 40C1 5F               4      LD  E,A     ;[E]=000000PP
0000C2 40C2 21C1FC          10      LD  HL,EXPTBL
0000C5 40C5 85               4      ADD A,L     ;桁上りは無い
0000C6 40C6 6F               4      LD  L,A     ;[HL]=EXPTBL+000000PP
0000C7 40C7 7B               4      LD  A,E     ;[A]=000000PP
0000C8 40C8 CB7E            13      BIT 7,(HL)
0000CA 40CA C8              11      RET Z
0000CB 40CB 7D               4      LD  A,L     ;point to SLTTBL entry
0000CC 40CC C604             7      ADD A,4     ;桁上りは無い
0000CE 40CE 6F               4      LD  L,A
0000CF 40CF 7E               7      LD  A,(HL)      ;get currently expansion slot register
       40D0                     GTSL3_:
0000D0 40D0 15               4      DEC D
0000D1 40D1 2803            12      JR  Z,GTSL4_:
0000D3 40D3 0F               4      RRCA
0000D4 40D4 18FA            12      JR  GTSL3_:
       40D6                     GTSL4_:
0000D6 40D6 E60C             7      AND 00CH        ;[A] = 0000SS00
0000D8 40D8 B3               4      OR  E       ;[A] = 0000SSPP
0000D9 40D9 F680             7      OR  080H        ;[A] = 1000SSPP
0000DB 40DB C9              10      RET
                                
       40DC                     AT_START2:
0000DC C700                         ORG START2,AT_START2-RUN
                                
0000DC C700 3100C7          10      LD  SP,START2
0000DF C703 CD11C7          17      CALL    INIT        ;NZならAUTOEXECを実行
       C704                     INIT_SWC    EQU $-2
0000E2 C706 210000          10      LD  HL,0
0000E5 C709 E5              11      PUSH    HL
0000E6 C70A C8              11      RET Z
0000E7 C70B 1106C9          10      LD  DE,AUTOD
0000EA C70E C3FDE5          10      JP  _COMANL
                                
       C711                     INIT:
0000ED C711 DD21900D        14      LD  IX,0D90H
0000F1 C715 0600             7      LD  B,0
       C717                     CHECK_CBIOS1:
0000F3 C717 DD7E00          19      LD  A,(IX+0)
0000F6 C71A FE43             7      CP  'C'
0000F8 C71C 202B            12      JR  NZ,CHECK_CBIOS2
0000FA C71E DD7E01          19      LD  A,(IX+1)
0000FD C721 FE2D             7      CP  '-'
0000FF C723 2024            12      JR  NZ,CHECK_CBIOS2
000101 C725 DD7E02          19      LD  A,(IX+2)
000104 C728 FE42             7      CP  'B'
000106 C72A 201D            12      JR  NZ,CHECK_CBIOS2
000108 C72C DD7E03          19      LD  A,(IX+3)
00010B C72F FE49             7      CP  'I'
00010D C731 2016            12      JR  NZ,CHECK_CBIOS2
00010F C733 DD7E04          19      LD  A,(IX+4)
000112 C736 FE4F             7      CP  'O'
000114 C738 200F            12      JR  NZ,CHECK_CBIOS2
000116 C73A DD7E05          19      LD  A,(IX+5)
000119 C73D EE53             7      XOR 'S'
00011B C73F 2008            12      JR  NZ,CHECK_CBIOS2
                                
00011D C741 3293D1          13      LD  (CBIOS_SWC1),A
000120 C744 32B7D1          13      LD  (CBIOS_SWC2),A
                                
000123 C747 1804            12      JR  CHECK_CBIOS3
       C749                     CHECK_CBIOS2:
000125 C749 DD23            10      INC IX
000127 C74B 10CA            13      DJNZ    CHECK_CBIOS1
       C74D                     CHECK_CBIOS3:
000129 C74D 3ADBFE          13      LD  A,(H_STKE+1)
00012C C750 3262E5          13      LD  (ROM_SLT),A
                                
       C753                     RAMCHK2:
00012F C753 3A42F3          13      LD  A,(RAMAD1)
000132 C756 2640             7      LD  H,040H
000134 C758 CD6AC8          17      CALL    CHK_RAM
000137 C75B 3242F3          13      LD  (RAMAD1),A
       C75E                     RAMCHK1:
00013A C75E 3A41F3          13      LD  A,(RAMAD0)
00013D C761 2600             7      LD  H,00H
00013F C763 CD6AC8          17      CALL    CHK_RAM
000142 C766 3241F3          13      LD  (RAMAD0),A
       C769                     RAMCHK0:
000145 C769 3A42F3          13      LD  A,(RAMAD1)
000148 C76C 2640             7      LD  H,040H
00014A C76E CDE2D4          17      CALL    ENASLT
                                
00014D C771 3A41F3          13      LD  A,(RAMAD0)
000150 C774 2600             7      LD  H,000H
000152 C776 CDE2D4          17      CALL    ENASLT
                                
000155 C779 210000          10      LD  HL,0
000158 C77C 065C             7      LD  B,05CH
00015A C77E 3E                      DB  03EH    ;LD A,??
00015B C77F EF              12      RST 28H
00015C C780 CD7BD6          17      CALL    FILL_MEMORY
00015F C783 06A4             7      LD  B,0A4H
000161 C785 AF               4      XOR A
000162 C786 320400          13      LD  (_DVSW),A
000165 C789 CD7BD6          17      CALL    FILL_MEMORY
                                
000168 C78C CD11C8          17      CALL    SET_BDOS
                                
                                                ;LSX-Dodgers
00016B C78F 3EE5             7      LD  A,CPM_BOOT/256
00016D C791 320B00          13      LD  (0000BH),A
                                
                                                ;MSXワークエリア
000170 C794 3E03             7      LD  A,3
000172 C796 329BFC          13      LD  (INTFLG),A
                                
                                                ;ROMタイプ判別(ASCII-8K/ASCII-16K)
000175 C799 1E00             7      LD  E,0
000177 C79B 3A62E5          13      LD  A,(ROM_SLT)
00017A C79E 210068          10      LD  HL,BANK1_SEL
00017D C7A1 CD6FD4          17      CALL    WRSLT
                                
000180 C7A4 210060          10      LD  HL,06000H
000183 C7A7 3A62E5          13      LD  A,(ROM_SLT)
000186 C7AA CD2ED4          17      CALL    RDSLT
000189 C7AD FE41             7      CP  'A'
00018B C7AF 280F            12      JR  Z,ROM8K
                                                ;ASCII-8K/Konami-8Kではない(ASCII-16K)
00018D C7B1 3E                      DB  03EH    ;LD A,??
00018E C7B2 00               4      NOP
00018F C7B3 3249E3          13      LD  (ASCII16K1),A
000192 C7B6 324DE3          13      LD  (ASCII16K2),A
000195 C7B9 3E3F             7      LD  A,03FH
000197 C7BB 3265E3          13      LD  (ASCII16K3),A
00019A C7BE 1829            12      JR  ROMCHECKED
       C7C0                     ROM8K:              ;Konami-8Kチェック
00019C C7C0 1E01             7      LD  E,1
00019E C7C2 3A62E5          13      LD  A,(ROM_SLT)
0001A1 C7C5 210070          10      LD  HL,BANK2_SEL
0001A4 C7C8 CD6FD4          17      CALL    WRSLT
                                
0001A7 C7CB 1E00             7      LD  E,0
0001A9 C7CD 3A62E5          13      LD  A,(ROM_SLT)
0001AC C7D0 210080          10      LD  HL,KONAMI_BANK2_SEL
0001AF C7D3 CD6FD4          17      CALL    WRSLT
                                
0001B2 C7D6 210080          10      LD  HL,08000H
0001B5 C7D9 3A62E5          13      LD  A,(ROM_SLT)
0001B8 C7DC CD2ED4          17      CALL    RDSLT
0001BB C7DF FE41             7      CP  'A'
0001BD C7E1 2006            12      JR  NZ,ROMCHECKED
                                                ;Konami-8K
0001BF C7E3 210080          10      LD  HL,KONAMI_BANK2_SEL
0001C2 C7E6 2254E3          16      LD  (ROM8000H),HL
       C7E9                     ROMCHECKED:
                                                ;MSX2判別
0001C5 C7E9 3AF8FA          13      LD  A,(EXBRSA)
0001C8 C7EC B7               4      OR  A
0001C9 C7ED 3E28             7      LD  A,40
0001CB C7EF 2802            12      JR  Z,ISMSX1
0001CD C7F1 3E50             7      LD  A,80        ;MSX2以降は80桁で起動
       C7F3                     ISMSX1:
0001CF C7F3 32AEF3          13      LD  (LINL40),A
0001D2 C7F6 32B1E5          13      LD  (_WIDTH),A
0001D5 C7F9 DD216C00        14      LD  IX,INITXT
0001D9 C7FD CD88D3          17      CALL    CALSLT_R
0001DC C800 DD217800        14      LD  IX,SETTXT
0001E0 C804 CD88D3          17      CALL    CALSLT_R
                                
0001E3 C807 2112C9          10      LD  HL,INIMES
0001E6 C80A CD82CE          17      CALL    MSX
       C80D                     INIT1:
0001E9 C80D AF               4      XOR A
0001EA C80E FE03             7      CP  3
0001EC C810 C9              10      RET
       C811                     SET_BDOS:
0001ED C811 3E                      DB  03EH    ;LD A,??
0001EE C812 E9               4      JP  (HL)
0001EF C813 320F00          13      LD  (0000FH),A
                                
0001F2 C816 3EC3             7      LD  A,0C3H      ;JP
0001F4 C818 2103E5          10      LD  HL,CPM_WBOOT
0001F7 C81B 320000          13      LD  (00000H),A
0001FA C81E 220100          16      LD  (00001H),HL ;IPL
                                
0001FD C821 2106CA          10      LD  HL,BDOS
000200 C824 320500          13      LD  (00005H),A
000203 C827 220600          16      LD  (00006H),HL ;BDOS
                                
000206 C82A 210000          10      LD  HL,0
000209 C82D 322800          13      LD  (00028H),A
00020C C830 222900          16      LD  (00029H),HL ;BDOS
                                                ;インタースロットコール
00020F C833 21E2D3          10      LD  HL,RDSLTR
000212 C836 320C00          13      LD  (_RDSLT),A
000215 C839 220D00          16      LD  (_RDSLT+1),HL
                                
000218 C83C 21EBD3          10      LD  HL,WRSLTR
00021B C83F 321400          13      LD  (_WRSLT),A
00021E C842 221500          16      LD  (_WRSLT+1),HL
                                
000221 C845 21A4D3          10      LD  HL,CALSLTR
000224 C848 321C00          13      LD  (_CALSLT),A
000227 C84B 221D00          16      LD  (_CALSLT+1),HL
                                
00022A C84E 21E2D4          10      LD  HL,ENASLT
00022D C851 322400          13      LD  (_ENASLT),A
000230 C854 222500          16      LD  (_ENASLT+1),HL
                                
000233 C857 2194D3          10      LD  HL,CALLF
000236 C85A 323000          13      LD  (_CALLF),A
000239 C85D 223100          16      LD  (_CALLF+1),HL
                                
00023C C860 21F4D3          10      LD  HL,INT38H
00023F C863 323800          13      LD  (00038H),A
000242 C866 223900          16      LD  (00038H+1),HL
000245 C869 C9              10      RET
       C86A                     CHK_RAM:
000246 C86A E5              11      PUSH    HL
000247 C86B CDBFC8          17      CALL    CHK_RAM0
00024A C86E E1              10      POP HL
00024B C86F C8              11      RET Z
00024C C870 3AC1FC          13      LD  A,(EXPTBL)      ;スロット#0
00024F C873 E680             7      AND 080H
000251 C875 CD96C8          17      CALL    CHK_RAM_SLT
000254 C878 C8              11      RET Z
000255 C879 3AC2FC          13      LD  A,(EXPTBL+1)        ;スロット#1
000258 C87C E680             7      AND 080H
00025A C87E C601             7      ADD A,1
00025C C880 CD96C8          17      CALL    CHK_RAM_SLT
00025F C883 C8              11      RET Z
000260 C884 3AC3FC          13      LD  A,(EXPTBL+2)        ;スロット#2
000263 C887 E680             7      AND 080H
000265 C889 C602             7      ADD A,2
000267 C88B CD96C8          17      CALL    CHK_RAM_SLT
00026A C88E C8              11      RET Z
00026B C88F 3AC4FC          13      LD  A,(EXPTBL+3)        ;スロット#3
00026E C892 E680             7      AND 080H
000270 C894 C603             7      ADD A,3
       C896                     CHK_RAM_SLT:
000272 C896 E5              11      PUSH    HL
000273 C897 CDBFC8          17      CALL    CHK_RAM0        ;スロット#X or X-0
000276 C89A E1              10      POP HL
000277 C89B C8              11      RET Z
000278 C89C CB79             8      BIT 7,C
00027A C89E 281A            12      JR  Z,CHK_RAM_E     ;スロットは拡張されていない
00027C C8A0 79               4      LD  A,C
00027D C8A1 C604             7      ADD A,4*1           ;スロット#X-1
00027F C8A3 E5              11      PUSH    HL
000280 C8A4 CDBFC8          17      CALL    CHK_RAM0
000283 C8A7 E1              10      POP HL
000284 C8A8 C8              11      RET Z
000285 C8A9 79               4      LD  A,C
000286 C8AA C608             7      ADD A,4*2           ;スロット#X-2
000288 C8AC E5              11      PUSH    HL
000289 C8AD CDBFC8          17      CALL    CHK_RAM0
00028C C8B0 E1              10      POP HL
00028D C8B1 C8              11      RET Z
00028E C8B2 79               4      LD  A,C
00028F C8B3 C60C             7      ADD A,4*3           ;スロット#X-3
000291 C8B5 E5              11      PUSH    HL
000292 C8B6 CDBFC8          17      CALL    CHK_RAM0
000295 C8B9 E1              10      POP HL
       C8BA                     CHK_RAM_E:
000296 C8BA AF               4      XOR A
000297 C8BB 3C               4      INC A           ;ZF=0にする
000298 C8BC 3E00             7      LD  A,0
00029A C8BE C9              10      RET
                                
       C8BF                     CHK_RAM0:
00029B C8BF 4F               4      LD  C,A
00029C C8C0 3A62E5          13      LD  A,(ROM_SLT)
00029F C8C3 B9               4      CP  C
0002A0 C8C4 28F4            12      JR  Z,CHK_RAM_E
0002A2 C8C6 2E00             7      LD  L,0
       C8C8                     CHK_RAM1:
0002A4 C8C8 79               4      LD  A,C
0002A5 C8C9 DD210C00        14      LD  IX,_RDSLT
0002A9 C8CD CDFAC8          17      CALL    CALSLT_RAM
0002AC C8D0 C6E5             7      ADD A,0E5H
0002AE C8D2 47               4      LD  B,A
0002AF C8D3 5F               4      LD  E,A
0002B0 C8D4 79               4      LD  A,C
0002B1 C8D5 DD211400        14      LD  IX,_WRSLT
0002B5 C8D9 CDFAC8          17      CALL    CALSLT_RAM
0002B8 C8DC 79               4      LD  A,C
0002B9 C8DD DD210C00        14      LD  IX,_RDSLT
0002BD C8E1 CDFAC8          17      CALL    CALSLT_RAM
0002C0 C8E4 B8               4      CP  B
0002C1 C8E5 C0              11      RET NZ
0002C2 C8E6 D6E5             7      SUB 0E5H
0002C4 C8E8 79               4      LD  A,C
0002C5 C8E9 5F               4      LD  E,A
0002C6 C8EA DD211400        14      LD  IX,_WRSLT
0002CA C8EE CDFAC8          17      CALL    CALSLT_RAM
0002CD C8F1 24               4      INC H
0002CE C8F2 7D               4      LD  A,L
0002CF C8F3 C604             7      ADD A,4
0002D1 C8F5 6F               4      LD  L,A
0002D2 C8F6 20D0            12      JR  NZ,CHK_RAM1
0002D4 C8F8 79               4      LD  A,C     ;ZF=1のハズ
0002D5 C8F9 C9              10      RET
                                
       C8FA                     CALSLT_RAM:
0002D6 C8FA C5              11      PUSH    BC
0002D7 C8FB E5              11      PUSH    HL
0002D8 C8FC FD2AC0FC        20      LD  IY,(EXPTBL-1) ;メインROMスロット
0002DC C900 CD1C00          17      CALL    _CALSLT
0002DF C903 E1              10      POP HL
0002E0 C904 C1              10      POP BC
0002E1 C905 C9              10      RET
                                
0002E2 C906 4155544F45584543    AUTOD:  DB  "AUTOEXEC "
            20                  
0002EB C90F 413A00              AUTODV: DB  "A:",0
                                
0002EE C912 0C4C53582D446F64    INIMES: DB  00CH,"LSX-Dodgers for MSX v"
            6765727320666F72    
            204D53582076        
000304 C928 312E                    DB  030H + VER_1, '.'
000306 C92A 3631                    DB  030H + VER_2 ,030H + VER_3
000308 C92C 63                      DB  'c'
000309 C92D 2047616B750D0A          DB  " Gaku",0DH,0AH
000310 C934 00                      DB  0
                                
000311 C935 0300                M2DD:   DW  3
000313 C937 F902                    DB  0F9H,2
000315 C939 CB02                    DW  715
000317 C93B FF0750090182            DB  0FFH,7,80,9,1,082H
00031D C941 0700A7000A00            DW  7,0A7H,10
       C947                     M2DDE:
[EOF:MSXINIT.ASM:SHIFT_JIS]
                                    INCLUDE "MSXCCP.ASM"
                                
                                ;   LSX-Dodgers CCP
                                ;   MSX
                                
       C947                     INITE:
000323 C947                         DS  BDOS-INITE
0003E2 CA06 C342CE          10      JP  BDOS0
       CA09                     S27BUF_COM:
0003E5 CA09 110001          10      LD  DE,BUF_COM
0003E8 CA0C CD46D0          17      CALL    _SYS1A      ;(BDOS)DTAの設定
0003EB CA0F 2100FE          10      LD  HL,0-BUF_COM-00100H ;バッファー+スタック予備(0100H)
0003EE CA12 C3E7CA          10      JP  S27BUF2
       CA15                     WBOOT1:
0003F1 CA15 ED7B0600        20      LD  SP,(SYSTEM+1)
0003F5 CA19 3E03             7      LD  A,3
0003F7 CA1B CD15D1          17      CALL    MSG_A
       CA1E                     WBOOT2:
[EOF:MSXCCP.ASM:UTF_8]
                                    INCLUDE "LDCCP.ASM"
                                
                                ;   LSX-Dodgers CCP
                                
       CA1E                     COMMAND:
0003FA CA1E 3AA3E4          13      LD  A,(FCB_BAT)
0003FD CA21 B7               4      OR  A
0003FE CA22 C260CB          10      JP  NZ,C_BAT1
000401 CA25 CDD4CA          17      CALL    SETDTA1
000404 CA28 3A0400          13      LD  A,(_DVSW)
000407 CA2B C641             7      ADD A,'A'
000409 CA2D CD15D1          17      CALL    MSG_A
00040C CA30 3E3E             7      LD  A,'>'
00040E CA32 CD15D1          17      CALL    MSG_A
000411 CA35 3E50             7      LD  A,80
000413 CA37 12               7      LD  (DE),A
000414 CA38 CDD5D1          17      CALL    _SYS0A      ;(BDOS)文字列入力
000417 CA3B CD55CC          17      CALL    LTNL
       CA3E                     COMMAND2:
00041A CA3E 118200          10      LD  DE,DTA1+2
00041D CA41 CDFDE5          17      CALL    _COMANL
000420 CA44 DC06D1          17      CALL    C,SHOW_ERROR
000423 CA47 18D5            12      JR  COMMAND
                                
       CA49                     COMANL:
000425 CA49 CDD0D5          17      CALL    FILE
000428 CA4C 3A19E5          13      LD  A,(FNAME+4)
00042B CA4F FE20             7      CP  020H
00042D CA51 201C            12      JR  NZ,COMB2
00042F CA53 D5              11      PUSH    DE
000430 CA54 1115E5          10      LD  DE,FNAME
000433 CA57 1A               7      LD  A,(DE)
000434 CA58 FE20             7      CP  020H
000436 CA5A 2844            12      JR  Z,SDVSW
000438 CA5C 1B               6      DEC DE
000439 CA5D 1A               7      LD  A,(DE)
00043A CA5E C6FF             7      ADD A,0FFH
00043C CA60 3809            12      JR  C,COMB
00043E CA62 13               6      INC DE
                                
00043F CA63 2112CE          10      LD  HL,COMTB
000442 CA66 0608             7      LD  B,COMS
000444 CA68 CD5DD8          17      CALL    CPNAME
       CA6B                     COMB:
000447 CA6B D1              10      POP DE
000448 CA6C D205D1          10      JP  NC,JPHL
       CA6F                     COMB2:
00044B CA6F EB               4      EX  DE,HL
00044C CA70 223DCB          16      LD  (COMSWC),HL
00044F CA73 F5              11      PUSH    AF
000450 CA74 CDF5CA          17      CALL    CEXE4
000453 CA77 F1              10      POP AF
000454 CA78 2115E5          10      LD  HL,FNAME
000457 CA7B 116D00          10      LD  DE,FCB2FN   ;COMMAND NAME
00045A CA7E 010B00          10      LD  BC,11
00045D CA81 EDB0                    LDIR
00045F CA83 1142E4          10      LD  DE,PATHD
       CA86                     CEX1:
000462 CA86 1A               7      LD  A,(DE)
000463 CA87 FE20             7      CP  020H
000465 CA89 D8              11      RET C
000466 CA8A CDC5D5          17      CALL    FILEC
000469 CA8D D5              11      PUSH    DE
00046A CA8E 216D00          10      LD  HL,FCB2FN   ;COMMAND NAME
00046D CA91 1115E5          10      LD  DE,FNAME
000470 CA94 010B00          10      LD  BC,11
000473 CA97 EDB0                    LDIR
000475 CA99 CDF5CA          17      CALL    CEXE4
000478 CA9C D1              10      POP DE
000479 CA9D 13               6      INC DE
00047A CA9E 18E6            12      JR  CEX1
                                
       CAA0                     SDVSW:
00047C CAA0 F1              10      POP AF
00047D CAA1 3A14E5          13      LD  A,(FDRV)
000480 CAA4 3D               4      DEC A
000481 CAA5 5F               4      LD  E,A
000482 CAA6 0E0E             7      LD  C,00EH      ;(BDOS)カレントドライブの設定
000484 CAA8 1831            12      JR  SYSTEM0
                                
       CAAA                     OPEN1:
000486 CAAA 2114E5          10      LD  HL,FDRV
       CAAD                     OPEN:
000489 CAAD 0E11             7      LD  C,011H      ;(BDOS)ファイルの検索
       CAAF                     OPEN3:
00048B CAAF D5              11      PUSH    DE
00048C CAB0 117EE4          10      LD  DE,DTA_CCP
00048F CAB3 CDD1CA          17      CALL    SETDTA
000492 CAB6 EB               4      EX  DE,HL
000493 CAB7 CDDBCA          17      CALL    SYSTEM0
000496 CABA D1              10      POP DE
000497 CABB C9              10      RET
                                
       CABC                     OPEN2:
000498 CABC 0E12             7      LD  C,012H
00049A CABE 18EF            12      JR  OPEN3
                                
       CAC0                     DEFCB:              ;Z=Ok NZ=Error
00049C CAC0 117EE4          10      LD  DE,DTA_CCP
00049F CAC3 CDD9CA          17      CALL    SYSC0F
                                
0004A2 CAC6 119FE4          10      LD  DE,DTA_CCP+33   ;(FCB)ランダムレコード
0004A5 CAC9 0604             7      LD  B,4
0004A7 CACB CD26CD          17      CALL    ZERO_MEMORY_DE
       CACE                     SETDTA100:
0004AA CACE 110080          10      LD  DE,BUFFER
       CAD1                     SETDTA:
0004AD CAD1 C346D0          10      JP  _SYS1A      ;(BDOS)DTAの設定
                                
       CAD4                     SETDTA1:
0004B0 CAD4 118000          10      LD  DE,DTA1
0004B3 CAD7 18F8            12      JR  SETDTA
                                
       CAD9                     SYSC0F:
0004B5 CAD9 0E0F             7      LD  C,00FH      ;(BDOS)ファイルのオープン
       CADB                     SYSTEM0:
0004B7 CADB CD0500          17      CALL    SYSTEM
0004BA CADE B7               4      OR  A
0004BB CADF C9              10      RET
                                
       CAE0                     C_CD:
0004BC CAE0 0E5A             7      LD  C,05AH
0004BE CAE2 18F7            12      JR  SYSTEM0
                                
       CAE4                     S27BUF:
0004C0 CAE4 21007F          10      LD  HL,0-BUFFER-00100H  ;バッファー+スタック予備(0100H)
       CAE7                     S27BUF2:
0004C3 CAE7 39              11      ADD HL,SP
0004C4 CAE8 2E00             7      LD  L,0
0004C6 CAEA 7C               4      LD  A,H
0004C7 CAEB E6F8             7      AND 0F8H
0004C9 CAED 67               4      LD  H,A
       CAEE                     S27DTA:
0004CA CAEE 117EE4          10      LD  DE,DTA_CCP
       CAF1                     S27:
0004CD CAF1 0E27             7      LD  C,027H      ;(BDOS)ランダムブロック読み込み
0004CF CAF3 18E6            12      JR  SYSTEM0
                                
       CAF5                     CEXE4:
0004D1 CAF5 211DE5          10      LD  HL,FNAME+8
0004D4 CAF8 7E               7      LD  A,(HL)
0004D5 CAF9 FE20             7      CP  020H
0004D7 CAFB 2007            12      JR  NZ,CEXE7
0004D9 CAFD 3E3F             7      LD  A,'?'
0004DB CAFF 77               7      LD  (HL),A
0004DC CB00 23               6      INC HL
0004DD CB01 77               7      LD  (HL),A
0004DE CB02 23               6      INC HL
0004DF CB03 77               7      LD  (HL),A
       CB04                     CEXE7:
0004E0 CB04 CDAACA          17      CALL    OPEN1
       CB07                     CEXE5:
0004E3 CB07 C0              11      RET NZ
0004E4 CB08 2A88E4          16      LD  HL,(DTA_CCP+1+9)
0004E7 CB0B 7C               4      LD  A,H
0004E8 CB0C CDECD8          17      CALL    CAP
0004EB CB0F 67               4      LD  H,A
0004EC CB10 7D               4      LD  A,L
0004ED CB11 CDECD8          17      CALL    CAP
0004F0 CB14 6F               4      LD  L,A
0004F1 CB15 3A87E4          13      LD  A,(DTA_CCP+1+8)
0004F4 CB18 CDECD8          17      CALL    CAP
0004F7 CB1B D642             7      SUB 'B'
0004F9 CB1D 282C            12      JR  Z,C_BAT
0004FB CB1F 3D               4      DEC A       ;'C'
0004FC CB20 2805            12      JR  Z,C_EXE
       CB22                     CEXE6:
0004FE CB22 CDBCCA          17      CALL    OPEN2
000501 CB25 18E0            12      JR  CEXE5
                                
       CB27                     C_EXE:
000503 CB27 7C               4      LD  A,H
000504 CB28 FE4D             7      CP  'M'
000506 CB2A 20F6            12      JR  NZ,CEXE6
                                
000508 CB2C CDC0CA          17      CALL    DEFCB
00050B CB2F CD09CA          17      CALL    S27BUF_COM
00050E CB32 3D               4      DEC A
00050F CB33 37               4      SCF
000510 CB34 C0              11      RET NZ
000511 CB35 7C               4      LD  A,H
000512 CB36 B5               4      OR  L
000513 CB37 37               4      SCF
000514 CB38 C8              11      RET Z
000515 CB39 CDD4CA          17      CALL    SETDTA1
000518 CB3C 110000          10      LD  DE,0                ; self-modifying code
       CB3D                     COMSWC  EQU $-2
00051B CB3F ED7B0600        20      LD  SP,(SYSTEM+1)
00051F CB43 67               4      LD  H,A             ; A=0 in SETDTA1(_SYS1A)
000520 CB44 6F               4      LD  L,A
000521 CB45 E5              11      PUSH    HL              ; push $0000 (reboot address)
000522 CB46 24               4      INC H
000523 CB47 E5              11      PUSH    HL              ; push $0100 (TPA address)
000524 CB48 C3F1CC          10      JP  SETFCB              ; and JP $0100
                                
       CB4B                     C_BAT:
000527 CB4B 114154          10      LD  DE,'A'+'T'*256
00052A CB4E ED52            15      SBC HL,DE
00052C CB50 20D0            12      JR  NZ,CEXE6
                                
00052E CB52 CDC0CA          17      CALL    DEFCB
                                
000531 CB55 217EE4          10      LD  HL,DTA_CCP
000534 CB58 11A3E4          10      LD  DE,FCB_BAT
000537 CB5B 012500          10      LD  BC,37
00053A CB5E EDB0                    LDIR
       CB60                     C_BAT1:
00053C CB60 CDCECA          17      CALL    SETDTA100
00053F CB63 CD97CB          17      CALL    FGETC_BAT
000542 CB66 218100          10      LD  HL,DTA1+1
000545 CB69 2025            12      JR  NZ,END_BATCH
000547 CB6B FE21             7      CP  021H        ;スペースや改行など制御文字を飛ばす
000549 CB6D 38F1            12      JR  C,C_BAT1
00054B CB6F 3620            10      LD  (HL),' '
00054D CB71 23               6      INC HL
       CB72                     C_BAT2:
00054E CB72 77               7      LD  (HL),A
00054F CB73 23               6      INC HL
000550 CB74 7D               4      LD  A,L
000551 CB75 3C               4      INC A       ;L==0FFH
000552 CB76 2809            12      JR  Z,RUN_BATCH
000554 CB78 CD97CB          17      CALL    FGETC_BAT
000557 CB7B 2004            12      JR  NZ,RUN_BATCH
000559 CB7D FE20             7      CP  020H
00055B CB7F 30F1            12      JR  NC,C_BAT2
       CB81                     RUN_BATCH:
00055D CB81 7D               4      LD  A,L
00055E CB82 D67F             7      SUB DTA1-1
000560 CB84 328000          13      LD  (DTA1),A
000563 CB87 FE04             7      CP  4
000565 CB89 3805            12      JR  C,END_BATCH
000567 CB8B 3600            10      LD  (HL),0
000569 CB8D C33ECA          10      JP  COMMAND2
       CB90                     END_BATCH:
00056C CB90 AF               4      XOR A       ;バッチファイルを閉じる
00056D CB91 32A3E4          13      LD  (FCB_BAT),A
000570 CB94 C300E5          10      JP  CPM_BOOT
                                
       CB97                     FGETC_BAT:
000573 CB97 11A3E4          10      LD  DE,FCB_BAT
       CB9A                     FGETC:              ;1文字ずつ読み込む
000576 CB9A E5              11      PUSH    HL      ;Z:成功
000577 CB9B 210100          10      LD  HL,1
00057A CB9E CDF1CA          17      CALL    S27
00057D CBA1 E1              10      POP HL
00057E CBA2 3A0080          13      LD  A,(BUFFER)
000581 CBA5 C9              10      RET
                                
       CBA6                     C_DEL:
000582 CBA6 CDF1CC          17      CALL    SETFCB
000585 CBA9 CD51D1          17      CALL    _SYS08      ;(BDOS)エコーなしコンソール入力
                                
000588 CBAC 0E13             7      LD  C,013H
00058A CBAE 180A            12      JR  CDEL1       ;(BDOS)ファイルの削除
                                
       CBB0                     C_REN:
00058C CBB0 CDF1CC          17      CALL    SETFCB
00058F CBB3 3E10             7      LD  A,010H      ;ディレクトリも対象にする
000591 CBB5 326900          13      LD  (FCB1+13),A ;属性
000594 CBB8 0E17             7      LD  C,017H      ;(BDOS)ファイル名の変更
       CBBA                     CDEL1:
000596 CBBA 115C00          10      LD  DE,FCB1
000599 CBBD CD0500          17      CALL    SYSTEM
00059C CBC0 C6FF             7      ADD A,0FFH
00059E CBC2 C9              10      RET
                                
       CBC3                     C_DIR:
00059F CBC3 CDC5D5          17      CALL    FILEC
0005A2 CBC6 2115E5          10      LD  HL,FDRV+1
0005A5 CBC9 CD07CE          17      CALL    CWILD1
0005A8 CBCC 3EF1             7      LD  A,0F1H
0005AA CBCE 3221E5          13      LD  (FDRV+13),A
0005AD CBD1 CDAACA          17      CALL    OPEN1
       CBD4                     CDIR1:
0005B0 CBD4 B7               4      OR  A
0005B1 CBD5 2008            12      JR  NZ,PDSKF
0005B3 CBD7 CD22CC          17      CALL    P_NAME
0005B6 CBDA CDBCCA          17      CALL    OPEN2
0005B9 CBDD 18F5            12      JR  CDIR1
       CBDF                     PDSKF:
0005BB CBDF 3A14E5          13      LD  A,(FDRV)
0005BE CBE2 5F               4      LD  E,A
0005BF CBE3 0E1B             7      LD  C,01BH      ;(BDOS)ディスク情報の獲得
0005C1 CBE5 CD0500          17      CALL    SYSTEM
0005C4 CBE8 4F               4      LD  C,A     ;C←1クラスタ辺りの論理セクタ数
0005C5 CBE9 C601             7      ADD A,001H
0005C7 CBEB D8              11      RET C       ;Aが0FFHだった場合
0005C8 CBEC 3E06             7      LD  A,8-2
       CBEE                     PDS1:               ;HL=未使用クラスタの総数
0005CA CBEE 3C               4      INC A
0005CB CBEF CB19             8      RR  C
0005CD CBF1 30FB            12      JR  NC,PDS1
       CBF3                     PDS2:               ;B←論理セクタのサイズの上位8ビット
0005CF CBF3 3C               4      INC A
0005D0 CBF4 CB18             8      RR  B
0005D2 CBF6 30FB            12      JR  NC,PDS2
0005D4 CBF8 47               4      LD  B,A
                                
0005D5 CBF9 110000          10      LD  DE,0
       CBFC                     PDS3:
0005D8 CBFC 29              11      ADD HL,HL
0005D9 CBFD EB               4      EX  DE,HL
0005DA CBFE ED6A            15      ADC HL,HL
0005DC CC00 EB               4      EX  DE,HL
0005DD CC01 10F9            13      DJNZ    PDS3
       CC03                     PDSKF1:
0005DF CC03 CD8FCC          17      CALL    PRDEC_DEHL
0005E2 CC06 11D3E4          10      LD  DE,FREE
0005E5 CC09 CD73CE          17      CALL    _SYS09      ;(BDOS)文字列出力
0005E8 CC0C CD7CCC          17      CALL    PUTDRV
0005EB CC0F 3E5C             7      LD  A,05CH      ;\
0005ED CC11 CD15D1          17      CALL    MSG_A
0005F0 CC14 2A22E5          16      LD  HL,(FDRV+14)    ;ディレクトリのクラスタ番号
0005F3 CC17 AF               4      XOR A
0005F4 CC18 11FEFF          10      LD  DE,0-2
0005F7 CC1B 19              11      ADD HL,DE
0005F8 CC1C 23               6      INC HL
0005F9 CC1D DC8CCC          17      CALL    C,PRDEC_HL
0005FC CC20 1833            12      JR  LTNL
                                
       CC22                     P_NAME:
0005FE CC22 3A7FE4          13      LD  A,(DTA_CCP+1)
000601 CC25 FE2E             7      CP  '.'
000603 CC27 C8              11      RET Z
                                
000604 CC28 3A8AE4          13      LD  A,(DTA_CCP+1+00BH)
000607 CC2B F5              11      PUSH    AF
000608 CC2C CB67             8      BIT 4,A
00060A CC2E 2808            12      JR  Z,DIR3
00060C CC30 11C8E4          10      LD  DE,DIRMES
00060F CC33 CD73CE          17      CALL    _SYS09      ;(BDOS)文字列出力
000612 CC36 180A            12      JR  DIR6
       CC38                     DIR3:
000614 CC38 ED5B9DE4        20      LD  DE,(DTA_CCP+1+01EH)
000618 CC3C 2A9BE4          16      LD  HL,(DTA_CCP+1+01CH)
00061B CC3F CD8FCC          17      CALL    PRDEC_DEHL
       CC42                     DIR6:
00061E CC42 F1              10      POP AF
00061F CC43 0F               4      RRCA
000620 CC44 9F               4      SBC A,A
000621 CC45 E60A             7      AND '*'-020H
000623 CC47 C620             7      ADD A,020H
000625 CC49 CD15D1          17      CALL    MSG_A
000628 CC4C CD7CCC          17      CALL    PUTDRV
00062B CC4F 217FE4          10      LD  HL,DTA_CCP+1
00062E CC52 CDCFCC          17      CALL    FPRNT
                                
       CC55                     LTNL:
000631 CC55 1E03             7      LD  E,3
000633 CC57 C3CDE5          10      JP  _PRINT
                                
       CC5A                     C_PATH:
000636 CC5A CDA6D6          17      CALL    SPCUT
000639 CC5D 2142E4          10      LD  HL,PATHD
00063C CC60 FE21             7      CP  021H
00063E CC62 300C            12      JR  NC,CPATH0
       CC64                     CPATHP:
000640 CC64 7E               7      LD  A,(HL)
000641 CC65 23               6      INC HL
000642 CC66 FE20             7      CP  020H
000644 CC68 3F               4      CCF
000645 CC69 30EA            12      JR  NC,LTNL
000647 CC6B CD15D1          17      CALL    MSG_A
00064A CC6E 18F4            12      JR  CPATHP
       CC70                     CPATH0:
00064C CC70 FE3B             7      CP  ';'
00064E CC72 2001            12      JR  NZ,CPATH1
000650 CC74 13               6      INC DE
       CC75                     CPATH1:
000651 CC75 EB               4      EX  DE,HL
000652 CC76 013B00          10      LD  BC,PATHX
000655 CC79 EDB0                    LDIR
000657 CC7B C9              10      RET
                                
       CC7C                     PUTDRV:
000658 CC7C 3A14E5          13      LD  A,(FDRV)
00065B CC7F CDD9D6          17      CALL    GETDRV1
00065E CC82 C641             7      ADD A,'A'
000660 CC84 CD15D1          17      CALL    MSG_A
000663 CC87 3E3A             7      LD  A,':'
       CC89                     MSG_AR:
000665 CC89 C315D1          10      JP  MSG_A
                                
       CC8C                     PRDEC_HL:
000668 CC8C AF               4      XOR A
000669 CC8D 5F               4      LD  E,A
00066A CC8E 57               4      LD  D,A
       CC8F                     PRDEC_DEHL:
00066B CC8F D5              11      PUSH    DE
00066C CC90 110FE5          10      LD  DE,DECBF
00066F CC93 0605             7      LD  B,5
000671 CC95 CD26CD          17      CALL    ZERO_MEMORY_DE  ;A=0
000674 CC98 D1              10      POP DE
                                
000675 CC99 0E20             7      LD  C,32
       CC9B                     DEC1:
000677 CC9B 29              11      ADD HL,HL
000678 CC9C EB               4      EX  DE,HL
000679 CC9D ED6A            15      ADC HL,HL
00067B CC9F EB               4      EX  DE,HL
00067C CCA0 E5              11      PUSH    HL
00067D CCA1 2113E5          10      LD  HL,DECBF+4
000680 CCA4 0605             7      LD  B,5
       CCA6                     DEC2:
000682 CCA6 7E               7      LD  A,(HL)
000683 CCA7 8F               4      ADC A,A
000684 CCA8 27               4      DAA
000685 CCA9 77               7      LD  (HL),A
000686 CCAA 2B               6      DEC HL
000687 CCAB 10F9            13      DJNZ    DEC2
000689 CCAD E1              10      POP HL
00068A CCAE 0D               4      DEC C
00068B CCAF 20EA            12      JR  NZ,DEC1
                                
00068D CCB1 210FE5          10      LD  HL,DECBF
000690 CCB4 3E20             7      LD  A,020H
000692 CCB6 0604             7      LD  B,4
       CCB8                     DEC3:
000694 CCB8 CDC5CC          17      CALL    DEC4
000697 CCBB CDC5CC          17      CALL    DEC4
00069A CCBE 23               6      INC HL
00069B CCBF 10F7            13      DJNZ    DEC3
       CCC1                     DECX:
00069D CCC1 CDC5CC          17      CALL    DEC4
0006A0 CCC4 AF               4      XOR A
       CCC5                     DEC4:
0006A1 CCC5 ED6F            18      RLD
0006A3 CCC7 FE20             7      CP  020H
0006A5 CCC9 2802            12      JR  Z,DEC5
0006A7 CCCB F630             7      OR  030H
       CCCD                     DEC5:
0006A9 CCCD 18BA            12      JR  MSG_AR
                                
       CCCF                     FPRNT:
0006AB CCCF 0608             7      LD  B,8 ;ファイル名を表示
0006AD CCD1 CDE0CC          17      CALL    P_N1
0006B0 CCD4 7E               7      LD  A,(HL)
0006B1 CCD5 CDF8D8          17      CALL    CAP3
0006B4 CCD8 D8              11      RET C   ;拡張子が無い
                                
0006B5 CCD9 3E2E             7      LD  A,'.'
0006B7 CCDB CD15D1          17      CALL    MSG_A
0006BA CCDE 0603             7      LD  B,3 ;拡張子を表示
       CCE0                     P_N1:
0006BC CCE0 7E               7      LD  A,(HL)
0006BD CCE1 CDF8D8          17      CALL    CAP3
0006C0 CCE4 3807            12      JR  C,P_N2
0006C2 CCE6 CD15D1          17      CALL    MSG_A
0006C5 CCE9 23               6      INC HL
0006C6 CCEA 10F4            13      DJNZ    P_N1
0006C8 CCEC C9              10      RET
       CCED                     P_N2:
0006C9 CCED 23               6      INC HL
0006CA CCEE 10FD            13      DJNZ    P_N2
0006CC CCF0 C9              10      RET
                                
       CCF1                     SETFCB:
0006CD CCF1 CDA6D6          17      CALL    SPCUT
0006D0 CCF4 1A               7      LD  A,(DE)
0006D1 CCF5 FE20             7      CP  020H
0006D3 CCF7 3801            12      JR  C,SETFCBA
0006D5 CCF9 1B               6      DEC DE
       CCFA                     SETFCBA:
0006D6 CCFA 0624             7      LD  B,36
0006D8 CCFC 215C00          10      LD  HL,FCB1
0006DB CCFF E5              11      PUSH    HL
0006DC CD00 AF               4      XOR A
0006DD CD01 CD7BD6          17      CALL    FILL_MEMORY
0006E0 CD04 E1              10      POP HL
0006E1 CD05 D5              11      PUSH    DE
0006E2 CD06 CDACD0          17      CALL    _SYS29      ;(BDOS)ファイル名の解析
0006E5 CD09 216C00          10      LD  HL,FCB2
0006E8 CD0C CDACD0          17      CALL    _SYS29      ;(BDOS)ファイル名の解析
0006EB CD0F E1              10      POP HL
0006EC CD10 010050          10      LD  BC,05000H
0006EF CD13 118100          10      LD  DE,00081H
       CD16                     SETFCB1:
0006F2 CD16 7E               7      LD  A,(HL)
0006F3 CD17 23               6      INC HL
0006F4 CD18 FE20             7      CP  020H
0006F6 CD1A 3805            12      JR  C,SETFCB2
0006F8 CD1C 12               7      LD  (DE),A
0006F9 CD1D 13               6      INC DE
0006FA CD1E 0C               4      INC C
0006FB CD1F 10F5            13      DJNZ    SETFCB1
       CD21                     SETFCB2:
0006FD CD21 79               4      LD  A,C
0006FE CD22 328000          13      LD  (DTA1),A
000701 CD25 04               4      INC B
       CD26                     ZERO_MEMORY_DE:
000702 CD26 AF               4      XOR A
       CD27                     FILL_MEMORY_DE:
000703 CD27 12               7      LD  (DE),A
000704 CD28 13               6      INC DE
000705 CD29 10FC            13      DJNZ    FILL_MEMORY_DE
000707 CD2B C9              10      RET
                                
       CD2C                     C_COPY:
000708 CD2C CDF1CC          17      CALL    SETFCB
                                
00070B CD2F 1161E5          10      LD  DE,ZERO
00070E CD32 CDC8D5          17      CALL    FILEC2
000711 CD35 216C00          10      LD  HL,FCB2
000714 CD38 CDB3D0          17      CALL    S29X1
                                
000717 CD3B 3E10             7      LD  A,010H
000719 CD3D 326900          13      LD  (FCB1+13),A
00071C CD40 216D00          10      LD  HL,FCB2FN
00071F CD43 CD07CE          17      CALL    CWILD1
       CD46                     COPY0:
000722 CD46 CD04CE          17      CALL    CWILD
000725 CD49 215C00          10      LD  HL,FCB1
000728 CD4C CDADCA          17      CALL    OPEN
00072B CD4F 37               4      SCF
       CD50                     COPY1:
00072C CD50 C0              11      RET NZ
00072D CD51 CDC0CA          17      CALL    DEFCB
                                
000730 CD54 3A8BE4          13      LD  A,(DTA_CCP+13)
000733 CD57 CB67             8      BIT 4,A
000735 CD59 2821            12      JR  Z,COPY1A
                                
000737 CD5B 215D00          10      LD  HL,FCB1FN
00073A CD5E CD0BDA          17      CALL    CHKWILD
00073D CD61 3814            12      JR  C,COPY9
                                
00073F CD63 3E20             7      LD  A,020H
000741 CD65 325D00          13      LD  (FCB1FN),A
000744 CD68 2A98E4          16      LD  HL,(DTA_CCP+26)
000747 CD6B 23               6      INC HL
000748 CD6C 226A00          16      LD  (FCB1+14),HL
00074B CD6F 18D5            12      JR  COPY0
                                
       CD71                     COPY8:
00074D CD71 CD73CE          17      CALL    _SYS09      ;(BDOS)文字列出力
000750 CD74 CD55CC          17      CALL    LTNL
       CD77                     COPY9:
000753 CD77 CDBCCA          17      CALL    OPEN2
000756 CD7A 18D4            12      JR  COPY1
                                
       CD7C                     COPY1A:
000758 CD7C 216C00          10      LD  HL,FCB2
00075B CD7F 1114E5          10      LD  DE,FDRV
00075E CD82 0180E4          10      LD  BC,DTA_CCP+2
000761 CD85 EDA0            16      LDI
000763 CD87 3E0B             7      LD  A,11
       CD89                     COPY2:
000765 CD89 F5              11      PUSH    AF
000766 CD8A 7E               7      LD  A,(HL)
000767 CD8B FE3F             7      CP  '?'
000769 CD8D 2001            12      JR  NZ,COPY3
00076B CD8F 0A               7      LD  A,(BC)
       CD90                     COPY3:
00076C CD90 12               7      LD  (DE),A
00076D CD91 03               6      INC BC
00076E CD92 13               6      INC DE
00076F CD93 23               6      INC HL
000770 CD94 F1              10      POP AF
000771 CD95 3D               4      DEC A
000772 CD96 20F1            12      JR  NZ,COPY2
000774 CD98 010500          10      LD  BC,16-11
000777 CD9B EDB0                    LDIR
       CD9D                     PUTNAME:
000779 CD9D 215D00          10      LD  HL,FCB1FN
00077C CDA0 CD0BDA          17      CALL    CHKWILD
00077F CDA3 300B            12      JR  NC,PUTN1
000781 CDA5 2115E5          10      LD  HL,FDRV+1
000784 CDA8 CDCFCC          17      CALL    FPRNT
000787 CDAB 3E20             7      LD  A,020H
000789 CDAD CD15D1          17      CALL    MSG_A
       CDB0                     PUTN1:
00078C CDB0 1114E5          10      LD  DE,FDRV
00078F CDB3 0E16             7      LD  C,016H      ;(BDOS)ファイルの作成
000791 CDB5 CDDBCA          17      CALL    SYSTEM0
000794 CDB8 2048            12      JR  NZ,COPYE2
000796 CDBA 67               4      LD  H,A     ;A=0
000797 CDBB 6F               4      LD  L,A
000798 CDBC 2235E5          16      LD  (FDRV+33),HL    ;(FCB)ランダムレコード
00079B CDBF 2237E5          16      LD  (FDRV+35),HL
       CDC2                     COPY6:
00079E CDC2 CDE4CA          17      CALL    S27BUF
0007A1 CDC5 47               4      LD  B,A
0007A2 CDC6 3C               4      INC A
0007A3 CDC7 2831            12      JR  Z,COPYE
0007A5 CDC9 7C               4      LD  A,H
0007A6 CDCA B5               4      OR  L
0007A7 CDCB 280C            12      JR  Z,COPY7
0007A9 CDCD 1114E5          10      LD  DE,FDRV
0007AC CDD0 0E26             7      LD  C,026H      ;(BDOS)ランダムブロック書き込み
0007AE CDD2 CDDBCA          17      CALL    SYSTEM0
0007B1 CDD5 2023            12      JR  NZ,COPYE
0007B3 CDD7 10E9            13      DJNZ    COPY6
       CDD9                     COPY7:
0007B5 CDD9 3A8BE4          13      LD  A,(DTA_CCP+13)  ;(FCB)属性
0007B8 CDDC 3221E5          13      LD  (FDRV+13),A
0007BB CDDF 2192E4          10      LD  HL,DTA_CCP+20   ;(FCB)タイムスタンプ
0007BE CDE2 1128E5          10      LD  DE,FDRV+20
0007C1 CDE5 010400          10      LD  BC,4
0007C4 CDE8 EDB0                    LDIR
                                
0007C6 CDEA 1114E5          10      LD  DE,FDRV
0007C9 CDED 0E10             7      LD  C,010H      ;(BDOS)ファイルのクローズ
0007CB CDEF CDDBCA          17      CALL    SYSTEM0
0007CE CDF2 2006            12      JR  NZ,COPYE
                                
0007D0 CDF4 1171E5          10      LD  DE,OK
0007D3 CDF7 C371CD          10      JP  COPY8
                                
       CDFA                     COPYE:
0007D6 CDFA 1114E5          10      LD  DE,FDRV
0007D9 CDFD 0E13             7      LD  C,013H      ;(BDOS)ファイルの削除
0007DB CDFF CD0500          17      CALL    SYSTEM
       CE02                     COPYE2:
0007DE CE02 37               4      SCF
0007DF CE03 C9              10      RET
                                
       CE04                     CWILD:
0007E0 CE04 215D00          10      LD  HL,FCB1FN
       CE07                     CWILD1:
0007E3 CE07 7E               7      LD  A,(HL)
0007E4 CE08 FE20             7      CP  020H
0007E6 CE0A C0              11      RET NZ
       CE0B                     CWILD2:
0007E7 CE0B 3E3F             7      LD  A,'?'
0007E9 CE0D 060B             7      LD  B,11
0007EB CE0F C37BD6          10      JP  FILL_MEMORY
                                
       CE12                     COMTB:
0007EE CE12 44202020                DB  "D   "  ;1
0007F2 CE16 C3CB                    DW  C_DIR
0007F4 CE18 44495220                DB  "DIR "  ;2
0007F8 CE1C C3CB                    DW  C_DIR
0007FA CE1E 434F5059                DB  "COPY"  ;3
0007FE CE22 2CCD                    DW  C_COPY
000800 CE24 43442020                DB  "CD  "  ;4
000804 CE28 E0CA                    DW  C_CD
000806 CE2A 44454C20                DB  "DEL "  ;5
00080A CE2E A6CB                    DW  C_DEL
00080C CE30 50415448                DB  "PATH"  ;6
000810 CE34 5ACC                    DW  C_PATH
000812 CE36 52454E20                DB  "REN "  ;7
000816 CE3A B0CB                    DW  C_REN
000818 CE3C 52454D20                DB  "REM "  ;8
00081C CE40 70CE                    DW  C_REM
[EOF:LDCCP.ASM:SHIFT_JIS]
                                    INCLUDE "LDOS.ASM"
                                
                                ;   LSX-Dodgers OS
                                
       CE42                     BDOS0:
00081E CE42 E5              11      PUSH    HL
00081F CE43 79               4      LD  A,C
000820 CE44 FE3C             7      CP  03CH
000822 CE46 3802            12      JR  C,DOS1
000824 CE48 3E3C             7      LD  A,03CH
       CE4A                     DOS1:
000826 CE4A 87               4      ADD A,A
000827 CE4B 324FCE          13      LD  (DOS1_SWC),A
00082A CE4E 2A00E6          16      LD  HL,(STABLE)
       CE4F                     DOS1_SWC    EQU $-2
00082D CE51 E3              19      EX  (SP),HL
00082E CE52 79               4      LD  A,C
                                ;確認用
                                ;   LD  (0050H),A
00082F CE53 C9              10      RET
       CE54                     _DOS2:
000830 CE54 FE5A             7      CP  05AH        ;(BDOS)カレントディレクトリの変更(_CHDIR)
000832 CE56 CAEED0          10      JP  Z,_SYS5A
000835 CE59 FE5C             7      CP  05CH        ;(BDOS)ファイル名の解析(_PFILE)
000837 CE5B CAABD0          10      JP  Z,_SYS5C
00083A CE5E FE5F             7      CP  05FH        ;(BDOS)ディスクバッファのフラッシュ(_FLUSH)
00083C CE60 CA08E3          10      JP  Z,_SYS5F
00083F CE63 FE6F             7      CP  06FH        ;(BDOS)MSX-DOS のバージョン番号の獲得(_DOSVER)
000841 CE65 200A            12      JR  NZ,_ERROR
000843 CE67 011D00          10      LD  BC,VER_6F
000846 CE6A 116101          10      LD  DE,VER
000849 CE6D 210301          10      LD  HL,MACD
       CE70                     C_REM:
00084C CE70 AF               4      XOR A
       CE71                     _ERROR:
00084D CE71 A7               4      AND A
00084E CE72 C9              10      RET
                                
       CE73                     _SYS09:     ;文字列出力
00084F CE73 D5              11      PUSH    DE
       CE74                     _SX09:
000850 CE74 1A               7      LD  A,(DE)
000851 CE75 13               6      INC DE
000852 CE76 FE24             7      CP  '$'
000854 CE78 2831            12      JR  Z,SX0E2
000856 CE7A CD15D1          17      CALL    MSG_A
000859 CE7D 18F5            12      JR  _SX09
                                
       CE7F                     MSX1:
00085B CE7F CD15D1          17      CALL    MSG_A
       CE82                     MSX:
00085E CE82 7E               7      LD  A,(HL)
00085F CE83 23               6      INC HL
000860 CE84 B7               4      OR  A
000861 CE85 20F8            12      JR  NZ,MSX1
000863 CE87 C9              10      RET
                                
       CE88                     _SYS0C:     ;(BDOS)バージョン番号の獲得
000864 CE88 212200          10      LD  HL,00022H
000867 CE8B 7D               4      LD  A,L
000868 CE8C C9              10      RET
                                
       CE8D                     _SYS0D:     ;(BDOS)ディスクリセット
000869 CE8D CDDFE5          17      CALL    _FFLUSH
00086C CE90 E5              11      PUSH    HL
00086D CE91 218000          10      LD  HL,00080H
000870 CE94 228AE5          16      LD  (_DTA),HL
000873 CE97 E1              10      POP HL
000874 CE98 D5              11      PUSH    DE
000875 CE99 1E00             7      LD  E,0
000877 CE9B 3E                      DB  03EH    ;次の PUSH DE をスキップ
                                
       CE9C                     _SYS0E:     ;(BDOS)カレントドライブの設定
000878 CE9C D5              11      PUSH    DE
000879 CE9D 7B               4      LD  A,E
00087A CE9E DDE5            15      PUSH    IX
00087C CEA0 CDDCE5          17      CALL    _GETDPB
00087F CEA3 DDE1            14      POP IX
000881 CEA5 3804            12      JR  C,SX0E2
000883 CEA7 7B               4      LD  A,E
000884 CEA8 320400          13      LD  (_DVSW),A
       CEAB                     SX0E2:
000887 CEAB D1              10      POP DE
000888 CEAC C9              10      RET
                                
       CEAD                     _SYS0F:     ;(BDOS)ファイルのオープン
000889 CEAD CDB8D6          17      CALL    SETDRV
00088C CEB0 FD7E1C          19      LD  A,(IY+28)   ;(FCB)オープンモード
00088F CEB3 C602             7      ADD A,002H      ;Write
000891 CEB5 2848            12      JR  Z,FEND0F
000893 CEB7 CD07DA          17      CALL    CHKWILDX
                                
000896 CEBA D4E2D6          17      CALL    NC,SOPENX
       CEBD                     _S16XX:
000899 CEBD 3840            12      JR  C,FEND0F
                                                ;Directory location
00089B CEBF 3A9FE5          13      LD  A,(_FILEN)
00089E CEC2 FD7719          19      LD  (IY+25),A   ;(FCB)ディレクトリロケーション
                                ;               _DIRF
0008A1 CEC5 3AA0E5          13      LD  A,(_DIRF)
0008A4 CEC8 FD771D          19      LD  (IY+29),A   ;(FCB)ディレクトリモード
                                ;               _FBPS
0008A7 CECB FD731E          19      LD  (IY+30),E   ;(FCB)ディレクトリポジション
0008AA CECE FD721F          19      LD  (IY+31),D
                                ;               Open(Read)
0008AD CED1 FD361CFF        19      LD  (IY+28),0FFH    ;(FCB)オープンモード
                                ;               FILENAME
0008B1 CED5 FDE5            15      PUSH    IY
0008B3 CED7 D1              10      POP DE
0008B4 CED8 13               6      INC DE
0008B5 CED9 010B00          10      LD  BC,11
0008B8 CEDC EDB0                    LDIR
                                ;               Attribute
0008BA CEDE 7E               7      LD  A,(HL)
0008BB CEDF FD770D          19      LD  (IY+13),A   ;(FCB)属性(アトリビュート)
0008BE CEE2 110B00          10      LD  DE,11       ;Reserved
0008C1 CEE5 19              11      ADD HL,DE
                                                    ;(FCB)ファイルを最後に変更した時刻
0008C2 CEE6 11E4E6          10      LD  DE,SDDATA       ;(FCB)ファイルを最後に変更した日付
0008C5 CEE9 060A             7      LD  B,SDDATAE-SDDATA    ;(FCB)ファイルの先頭クラスタ
       CEEB                     S16LOOP:                ;(FCB)ファイルのサイズ(バイト単位)
0008C7 CEEB 1A               7      LD  A,(DE)
0008C8 CEEC 13               6      INC DE
0008C9 CEED 32F4CE          13      LD  (S16PAT),A
0008CC CEF0 7E               7      LD  A,(HL)
0008CD CEF1 23               6      INC HL
0008CE CEF2 FD7700          19      LD  (IY+0),A
       CEF4                     S16PAT  EQU $-1
0008D1 CEF5 10F4            13      DJNZ    S16LOOP
                                
0008D3 CEF7 AF               4      XOR A
0008D4 CEF8 FD770C          19      LD  (IY+12),A   ;(FCB)カレントブロック
0008D7 CEFB FD229CCF        20      LD  (OFCB_SWC),IY
       CEFF                     FEND0F:
0008DB CEFF 1845            12      JR  FEND10
                                
       CF01                     _SYS10:     ;(BDOS)ファイルのクローズ
0008DD CF01 CDB8D6          17      CALL    SETDRV
0008E0 CF04 FD7E1C          19      LD  A,(IY+28)   ;(FCB)オープンモード
0008E3 CF07 D6FE             7      SUB 0FEH
0008E5 CF09 37               4      SCF
0008E6 CF0A 3F               4      CCF
0008E7 CF0B 2039            12      JR  NZ,FEND10
       CF0D                     _S10A:              ;Write
0008E9 CF0D FD770E          19      LD  (IY+14),A   ;(FCB)レコードサイズ/アクセスするディレクトリのクラスタ番号+1
0008EC CF10 FD770F          19      LD  (IY+15),A
                                
0008EF CF13 FD341C          23      INC (IY+28)     ;(FCB)オープンモード 0FEH->0FFH
0008F2 CF16 CD03DB          17      CALL    SETTMS
                                
0008F5 CF19 FD7E1D          19      LD  A,(IY+29)   ;(FCB)ディレクトリモード
0008F8 CF1C 32A0E5          13      LD  (_DIRF),A
0008FB CF1F E67F             7      AND 07FH
0008FD CF21 3228E0          13      LD  (_SECPS),A
000900 CF24 FD5E1E          19      LD  E,(IY+30)   ;(FCB)ディレクトリポジション
000903 CF27 FD561F          19      LD  D,(IY+31)
000906 CF2A CD16D8          17      CALL    READ_DIR
000909 CF2D 3817            12      JR  C,FEND10
                                
00090B CF2F 3A42D7          13  SDECM1: LD  A,(SDECPAT) ;1セクタ辺りのディレクトリエントリ数
00090E CF32 3D               4      DEC A       ;1024=01FH / 512=00FH / 256=7
00090F CF33 FDA619          19      AND (IY+25)     ;(FCB)ディレクトリロケーション
000912 CF36 6F               4      LD  L,A
000913 CF37 2600             7      LD  H,0
000915 CF39 29              11      ADD HL,HL       ;*2
000916 CF3A 29              11      ADD HL,HL       ;*4
000917 CF3B 29              11      ADD HL,HL       ;*8
000918 CF3C 29              11      ADD HL,HL       ;*16
000919 CF3D 29              11      ADD HL,HL       ;*32
00091A CF3E ED4B7EE6        20      LD  BC,(_DTBUF)
00091E CF42 09              11      ADD HL,BC
                                
00091F CF43 CD17DA          17      CALL    SDIRENT
       CF46                     FEND10:
000922 CF46 1842            12      JR  FEND
                                
       CF48                     _SYS11:     ;(BDOS)最初のファイルの検索
000924 CF48 CDB8D6          17      CALL    SETDRV
000927 CF4B CD11D7          17      CALL    SOPEN
       CF4E                     _S12X1:
00092A CF4E 383A            12      JR  C,FEND
00092C CF50 CDB0D7          17      CALL    SOPENE2
00092F CF53 ED5B8AE5        20      LD  DE,(_DTA)
000933 CF57 3A88E5          13      LD  A,(_DRV)
000936 CF5A 3C               4      INC A
000937 CF5B 12               7      LD  (DE),A
000938 CF5C D5              11      PUSH    DE
000939 CF5D 13               6      INC DE
00093A CF5E 012000          10      LD  BC,32
00093D CF61 EDB0                    LDIR
00093F CF63 FD6E0E          19      LD  L,(IY+14)   ;(FCB)レコードサイズ/アクセスするディレクトリのクラスタ番号+1
000942 CF66 FD660F          19      LD  H,(IY+15)
000945 CF69 22F4E6          16      LD  (SCDIR),HL
000948 CF6C 2A9AE5          16      LD  HL,(_FBPS)
00094B CF6F 22F6E6          16      LD  (SFBPS),HL
00094E CF72 2A9FE5          16      LD  HL,(_FILEN)
000951 CF75 7C               4      LD  A,H
000952 CF76 B7               4      OR  A
000953 CF77 2806            12      JR  Z,_S12DIR
000955 CF79 3A28E0          13      LD  A,(_SECPS)
000958 CF7C F680             7      OR  080H
00095A CF7E 67               4      LD  H,A
       CF7F                     _S12DIR:
00095B CF7F 22F8E6          16      LD  (SFNDF),HL  ;Directory position and Flags
00095E CF82 E1              10      POP HL
00095F CF83 1139E5          10      LD  DE,SFILE
000962 CF86 0E21             7      LD  C,33
       CF88                     _S11B:
000964 CF88 EDB0                    LDIR
       CF8A                     FEND:
000966 CF8A 9F               4      SBC A,A     ;CF=0 A=0 : CF=1 A=0FFH
       CF8B                     FENDE:
000967 CF8B FDE1            14      POP IY
000969 CF8D C1              10      POP BC
00096A CF8E D1              10      POP DE
00096B CF8F E1              10      POP HL
00096C CF90 C9              10      RET
                                
       CF91                     _SYS12:     ;(BDOS)次のファイルの検索
00096D CF91 E5              11      PUSH    HL
00096E CF92 D5              11      PUSH    DE
00096F CF93 C5              11      PUSH    BC
000970 CF94 FDE5            15      PUSH    IY
000972 CF96 CD75D7          17      CALL    NOPEN
000975 CF99 18B3            12      JR  _S12X1
                                
       CF9B                     _S16K:
000977 CF9B 110000          10      LD  DE,0
       CF9C                     OFCB_SWC    EQU $-2
00097A CF9E D5              11      PUSH    DE
00097B CF9F 061A             7      LD  B,26        ;First cluster
       CFA1                     S16K1:
00097D CFA1 13               6      INC DE
00097E CFA2 23               6      INC HL
00097F CFA3 10FC            13      DJNZ    S16K1
                                
000981 CFA5 1A               7      LD  A,(DE)
000982 CFA6 BE               7      CP  (HL)
000983 CFA7 2015            12      JR  NZ,S16K2
000985 CFA9 13               6      INC DE
000986 CFAA 23               6      INC HL
000987 CFAB 1A               7      LD  A,(DE)
000988 CFAC BE               7      CP  (HL)
000989 CFAD 200F            12      JR  NZ,S16K2
                                
00098B CFAF E1              10      POP HL
00098C CFB0 FDE5            15      PUSH    IY
00098E CFB2 D1              10      POP DE
00098F CFB3 7E               7      LD  A,(HL)
000990 CFB4 CDCDD6          17      CALL    IS_SAME_DRV_A_DE
000993 CFB7 2006            12      JR  NZ,S16K3
                                                ;ここはCFが必ず0
000995 CFB9 ED52            15      SBC HL,DE       ;CP HL,DE
000997 CFBB 37               4      SCF
000998 CFBC C0              11      RET NZ
000999 CFBD E5              11      PUSH    HL
       CFBE                     S16K2:
00099A CFBE E1              10      POP HL
       CFBF                     S16K3:
00099B CFBF FDE5            15      PUSH    IY
00099D CFC1 D1              10      POP DE
       CFC2                     _SYS13:     ;(BDOS)ファイルの削除
00099E CFC2 CDB8D6          17      CALL    SETDRV
0009A1 CFC5 CD3FD9          17      CALL    KILL
       CFC8                     FEND13:
0009A4 CFC8 18C0            12      JR  FEND
                                
       CFCA                     _SYS14:     ;(BDOS)シーケンシャルな読み出し
0009A6 CFCA CDB8D6          17      CALL    SETDRV
0009A9 CFCD CD7BDE          17      CALL    INIT_SEQ
       CFD0                     SREAD:
0009AC CFD0 CD4DDE          17      CALL    RB_READ
                                
0009AF CFD3 C601             7      ADD A,001H
0009B1 CFD5 38B3            12      JR  C,FEND
                                
0009B3 CFD7 7D               4      LD  A,L
0009B4 CFD8 D601             7      SUB 001H
       CFDA                     FENDX:
0009B6 CFDA 9F               4      SBC A,A
0009B7 CFDB E603             7      AND 3
0009B9 CFDD 1F               4      RRA
0009BA CFDE 18AB            12      JR  FENDE
                                
       CFE0                     _SYS15:     ;(BDOS)シーケンシャルな書き込み
0009BC CFE0 CDB8D6          17      CALL    SETDRV
0009BF CFE3 CD7BDE          17      CALL    INIT_SEQ
       CFE6                     SWRITE:
0009C2 CFE6 CD48DE          17      CALL    RB_WRITE
                                
0009C5 CFE9 C6FF             7      ADD A,0FFH
0009C7 CFEB 18ED            12      JR  FENDX
                                
       CFED                     _SYS17:     ;(BDOS)ファイル名の変更
0009C9 CFED CDB8D6          17      CALL    SETDRV
0009CC CFF0 CD95D9          17      CALL    NAME
0009CF CFF3 18D3            12      JR  FEND13
                                
       CFF5                     _SYS16:     ;(BDOS)ファイルの作成
0009D1 CFF5 CDB8D6          17      CALL    SETDRV
                                
0009D4 CFF8 CD07DA          17      CALL    CHKWILDX
0009D7 CFFB 38CB            12      JR  C,FEND13
0009D9 CFFD FD7E01          19      LD  A,(IY+1)    ;(FCB)主ファイル名
0009DC D000 FE05             7      CP  5
0009DE D002 2805            12      JR  Z,_S16X2
0009E0 D004 FE21             7      CP  021H
0009E2 D006 DAC8CF          10      JP  C,FEND13
       D009                     _S16X2:
                                ;               Clear FCB
0009E5 D009 FDE5            15      PUSH    IY
0009E7 D00B E1              10      POP HL
0009E8 D00C 011000          10      LD  BC,16
0009EB D00F 09              11      ADD HL,BC
       D010                     _S16X1:
0009EC D010 70               7      LD  (HL),B      ;B=0
0009ED D011 23               6      INC HL
0009EE D012 0D               4      DEC C
0009EF D013 20FB            12      JR  NZ,_S16X1
                                
0009F1 D015 CD08DB          17      CALL    SETTMSX
0009F4 D018 FD360DFF        19      LD  (IY+13),0FFH    ;(FCB)Attribute
0009F8 D01C CDE2D6          17      CALL    SOPENX
0009FB D01F 3F               4      CCF
0009FC D020 CC9BCF          17      CALL    Z,_S16K
0009FF D023 D4C1D7          17      CALL    NC,COPEN
000A02 D026 D417DA          17      CALL    NC,SDIRENT
000A05 D029 C3BDCE          10      JP  _S16XX
                                
       D02C                     _SYS21:     ;(BDOS)ランダムな読み出し
000A08 D02C CDB8D6          17      CALL    SETDRV
000A0B D02F CD53DB          17      CALL    INIT_RND
000A0E D032 189C            12      JR  SREAD
                                
       D034                     _SYS22:     ;(BDOS)ランダムな書き込み
       D034                     _SYS28:     ;(BDOS)ランダムな書き込み・その2
000A10 D034 CDB8D6          17      CALL    SETDRV
000A13 D037 CD53DB          17      CALL    INIT_RND
000A16 D03A 18AA            12      JR  SWRITE
                                
       D03C                     _SYS18:     ;(BDOS)ログインベクトルの獲得
000A18 D03C 21FF00          10      LD  HL,000FFH
000A1B D03F AF               4      XOR A
000A1C D040 C9              10      RET
                                
       D041                     _SYS19:     ;(BDOS)カレントドライブ番号の獲得
000A1D D041 3A0400          13      LD  A,(_DVSW)   ;from LDOS
000A20 D044 A7               4      AND A
000A21 D045 C9              10      RET
                                
       D046                     _SYS1A:     ;(BDOS)DTAの設定
000A22 D046 ED538AE5        20      LD  (_DTA),DE
000A26 D04A AF               4      XOR A
000A27 D04B C9              10      RET
                                
       D04C                     _SYS1B:     ;(BDOS)ディスク情報の獲得
000A28 D04C 7B               4      LD  A,E
000A29 D04D CDC6D6          17      CALL    GETDRV
000A2C D050 CDDCE5          17      CALL    _GETDPB
000A2F D053 D4E2E5          17      CALL    NC,_RDFATX
000A32 D056 210000          10      LD  HL,0
000A35 D059 D4E1DA          17      CALL    NC,DSKF
                                
000A38 D05C ED5BE2DA        20      LD  DE,(MAXCLP) ;DPB_MAXCL-1
000A3C D060 1B               6      DEC DE      ;DE←クラスタの総数
000A3D D061 FD2A7CE6        20      LD  IY,(_FATBF) ;IY←メモリ上のFATの先頭アドレス
000A41 D065 9F               4      SBC A,A
000A42 D066 D8              11      RET C
000A43 D067 4F               4      LD  C,A     ;C=0
000A44 D068 DD7E0F          19      LD  A,(IX+DPB_BPS)
000A47 D06B E607             7      AND 7
000A49 D06D 47               4      LD  B,A
000A4A D06E DD7E07          19      LD  A,(IX+DPB_SECPCL)
000A4D D071 C9              10      RET
                                
       D072                     _SYS1D:     ;(BDOS)書き込みが禁止されているディスクの調査
000A4E D072 AF               4      XOR A
000A4F D073 67               4      LD  H,A
000A50 D074 6F               4      LD  L,A
000A51 D075 C9              10      RET
                                
       D076                     _SYS1F:     ;(BDOS)ディスク装置のパラメータの読み出し
000A52 D076 2100E7          10      LD  HL,_DEVICE
000A55 D079 7B               4      LD  A,E
000A56 D07A C3DCE5          10      JP  _GETDPB
                                
       D07D                     _SYS23:     ;(BDOS)ファイルサイズの獲得
000A59 D07D E5              11      PUSH    HL
000A5A D07E 0E0F             7      LD  C,00FH      ;(BDOS)ファイルのオープン
000A5C D080 CD42CE          17      CALL    BDOS0
000A5F D083 381B            12      JR  C,_S23X1
                                
000A61 D085 D5              11      PUSH    DE      ;EX DE,IY
000A62 D086 FDE3            23      EX  (SP),IY     ;
                                ;   POP DE      ;
                                ;   PUSH    DE      ;DEを破壊しないように注意vv
000A64 D088 FD7E10          19      LD  A,(IY+16)   ;(FCB)ファイルのサイズ(バイト単位)
000A67 D08B FD6E11          19      LD  L,(IY+17)   ;
000A6A D08E FD6612          19      LD  H,(IY+18)   ;
000A6D D091 C5              11      PUSH    BC      ;
000A6E D092 FD4613          19      LD  B,(IY+19)   ;
000A71 D095 CD45DB          17      CALL    GET_CPM_R_SIZE
000A74 D098 C1              10      POP BC
       D099                     _S24X1:
000A75 D099 CD65DB          17      CALL    SET_RR_AHL
                                ;   POP DE      ;^^^^^^^^^^^^^^^^^^^^^^^^
                                ;   PUSH    DE      ;EX DE,IY
000A78 D09C FDE3            23      EX  (SP),IY     ;
000A7A D09E D1              10      POP DE      ;
                                
000A7B D09F AF               4      XOR A
       D0A0                     _S23X1:
000A7C D0A0 E1              10      POP HL
000A7D D0A1 C9              10      RET
                                
       D0A2                     _SYS24:     ;(BDOS)ランダムレコードフィールドの設定
000A7E D0A2 E5              11      PUSH    HL
000A7F D0A3 D5              11      PUSH    DE      ;EX DE,IY
000A80 D0A4 FDE3            23      EX  (SP),IY     ;
                                ;   POP DE      ;
                                ;   PUSH    DE      ;DEを破壊しないように注意vv
000A82 D0A6 CD83DE          17      CALL    GETSEQ
000A85 D0A9 18EE            12      JR  _S24X1      ;^^^^^^^^^^^^^^^^^^^^^^^^
                                
       D0AB                     _SYS5C:     ;(BDOS)ファイル名の解析(_PFILE)
000A87 D0AB 2B               6      DEC HL
       D0AC                     _SYS29:     ;(BDOS)ファイル名の解析(_PPATH)
000A88 D0AC C5              11      PUSH    BC
000A89 D0AD E5              11      PUSH    HL
000A8A D0AE CDD0D5          17      CALL    FILE
000A8D D0B1 E1              10      POP HL
000A8E D0B2 C1              10      POP BC
       D0B3                     S29X1:
000A8F D0B3 C5              11      PUSH    BC
000A90 D0B4 D5              11      PUSH    DE
000A91 D0B5 E5              11      PUSH    HL
000A92 D0B6 EB               4      EX  DE,HL
000A93 D0B7 AF               4      XOR A
000A94 D0B8 3221E5          13      LD  (FDRV+13),A
000A97 D0BB 2114E5          10      LD  HL,FDRV
000A9A D0BE 011000          10      LD  BC,16
000A9D D0C1 EDB0                    LDIR
000A9F D0C3 E1              10      POP HL
000AA0 D0C4 D1              10      POP DE
000AA1 D0C5 C1              10      POP BC
000AA2 D0C6 C9              10      RET
                                
       D0C7                     _SYS30:     ;(BDOS)論理セクタを用いた書き込み
000AA3 D0C7 C5              11      PUSH    BC
000AA4 D0C8 01C9E1          10      LD  BC,DWT24B
000AA7 D0CB 1804            12      JR  S2FX
       D0CD                     _SYS2F:
000AA9 D0CD C5              11      PUSH    BC
000AAA D0CE 01BBE1          10      LD  BC,DRD24B
       D0D1                     S2FX:
000AAD D0D1 ED43E7D0        20      LD  (S2F_SWC),BC
000AB1 D0D5 CDDFE5          17      CALL    _FFLUSH
                                
000AB4 D0D8 D5              11      PUSH    DE
000AB5 D0D9 E5              11      PUSH    HL
000AB6 D0DA 7D               4      LD  A,L     ;Drive
000AB7 D0DB CDD9E5          17      CALL    _CHGDRV
000ABA D0DE 3809            12      JR  C,POP_HL_DE_BC_SBCAA_RET
000ABC D0E0 44               4      LD  B,H     ;Number of clusters
000ABD D0E1 2A8AE5          16      LD  HL,(_DTA)
                                
000AC0 D0E4 0E00             7      LD  C,0
000AC2 D0E6 CDBBE1          17      CALL    DRD24B
       D0E7                     S2F_SWC EQU $-2
       D0E9                     POP_HL_DE_BC_SBCAA_RET:
000AC5 D0E9 E1              10      POP HL
000AC6 D0EA D1              10      POP DE
000AC7 D0EB C1              10      POP BC
000AC8 D0EC 9F               4      SBC A,A
000AC9 D0ED C9              10      RET
                                
       D0EE                     _SYS5A:     ;(BDOS)カレントディレクトリの変更
000ACA D0EE C5              11      PUSH    BC
000ACB D0EF D5              11      PUSH    DE
000ACC D0F0 E5              11      PUSH    HL
000ACD D0F1 CDC5D5          17      CALL    FILEC
000AD0 D0F4 21E9D0          10      LD  HL,POP_HL_DE_BC_SBCAA_RET
000AD3 D0F7 E5              11      PUSH    HL
000AD4 D0F8 3A21E5          13      LD  A,(FDRV+13) ;(FCB)属性(アトリビュート))
000AD7 D0FB E610             7      AND 010H        ;ディレクトリ
000AD9 D0FD 37               4      SCF
000ADA D0FE C8              11      RET Z
000ADB D0FF 1114E5          10      LD  DE,FDRV
000ADE D102 2A4EE6          16      LD  HL,(STABLE+2*027H)  ;(BDOS)ランダムブロック読み込み
       D105                     JPHL:
000AE1 D105 E9               4      JP  (HL)
                                
       D106                     SHOW_ERROR:         ;(9)
000AE2 D106 1179E5          10      LD  DE,COMERM
000AE5 D109 CD73CE          17      CALL    _SYS09      ;(BDOS)文字列出力
000AE8 D10C C300E5          10      JP  CPM_BOOT
[EOF:LDOS.ASM:SHIFT_JIS]
                                    INCLUDE "MSXIO.ASM"
                                
                                ;   LSX-Dodgers IO
                                ;   MSX
                                
       CE71                     _SYS04  EQU _ERROR      ;(BDOS)外部出力
       CE71                     _SYS05  EQU _ERROR      ;(BDOS)プリンタ出力
       CE71                     _SYS1C  EQU _ERROR      ;(BDOS)ディスクの書き込み禁止化
       CE71                     _SYS1E  EQU _ERROR      ;(BDOS)ファイル属性の設定
       CE71                     _SYS20  EQU _ERROR      ;(BDOS)利用者番号の設定と読み出し
       CE71                     _SYS2E  EQU _ERROR      ;(BDOS)ベリファイ・フラグの設定
                                
       0000                     INT EQU 0
       0000                     INTCTCE EQU 0
       0000                     INTCTC2 EQU 0
                                
       0000                     CTRL00  EQU 0
       0000                     CTRL03  EQU 0
       0000                     CTRL04  EQU 0
       0000                     CTRL05  EQU 0
       0000                     CTRL06  EQU 0
       0000                     CTRL07  EQU 0
       0000                     CTRL08  EQU 0
       0000                     CTRL09  EQU 0
       0000                     CTRL0A  EQU 0
       0000                     CTRL0B  EQU 0
       0000                     CTRL0C  EQU 0
       0000                     CTRL0D  EQU 0
       0000                     CTRL0E  EQU 0
       0000                     CTRL12  EQU 0
       0000                     CTRL1B  EQU 0
       0000                     CTRL1C  EQU 0
       0000                     CTRL1D  EQU 0
       0000                     CTRL1E  EQU 0
       0000                     CTRL1F  EQU 0
                                
       D10F                     PRINT:
000AEB D10F 7B               4      LD  A,E
000AEC D110 1803            12      JR  MSG_A
                                
       D112                     _SYS01:     ;(BDOS)コンソール入力
000AEE D112 CD09E5          17      CALL    _SYS07
       D115                     MSG_A:
000AF1 D115 FE03             7      CP  3
000AF3 D117 2814            12      JR  Z,MSG_BR
       D119                     MSGA1:
000AF5 D119 F5              11      PUSH    AF
000AF6 D11A C5              11      PUSH    BC
000AF7 D11B D5              11      PUSH    DE
000AF8 D11C E5              11      PUSH    HL
000AF9 D11D DDE5            15      PUSH    IX
000AFB D11F DD21A200        14      LD  IX,CHPUT
000AFF D123 CD88D3          17      CALL    CALSLT_R
000B02 D126 DDE1            14      POP IX
000B04 D128 E1              10      POP HL
000B05 D129 D1              10      POP DE
000B06 D12A C1              10      POP BC
       D12B                     MSGA2:
000B07 D12B F1              10      POP AF
000B08 D12C C9              10      RET
       D12D                     MSG_BR:
000B09 D12D F5              11      PUSH    AF
000B0A D12E 3ADDF3          13      LD  A,(CSRX)
000B0D D131 FE02             7      CP  2
000B0F D133 38F6            12      JR  C,MSGA2
000B11 D135 F1              10      POP AF
       D136                     MSG_CR:
000B12 D136 F5              11      PUSH    AF
000B13 D137 3E0D             7      LD  A,00DH
000B15 D139 CD19D1          17      CALL    MSGA1
000B18 D13C 3E0A             7      LD  A,00AH
000B1A D13E CD19D1          17      CALL    MSGA1
000B1D D141 F1              10      POP AF
000B1E D142 C9              10      RET
                                
       D143                     _SYS02:     ;(BDOS)コンソール出力
000B1F D143 CD5FD1          17      CALL    BREAK
000B22 D146 C3CDE5          10      JP  _PRINT
                                
       D149                     _SYS06:     ;(BDOS)コンソール直接入出力
000B25 D149 7B               4      LD  A,E
000B26 D14A 3C               4      INC A
000B27 D14B CACAE5          10      JP  Z,_INKEY
000B2A D14E C3CDE5          10      JP  _PRINT
                                
       D151                     _SYS08:     ;(BDOS)エコーなしコンソール入力
000B2D D151 CD09E5          17      CALL    _SYS07
000B30 D154 FE03             7      CP  3
000B32 D156 CCF4E5          17      CALL    Z,_BREAK
000B35 D159 FE13             7      CP  013H        ;CTRL+S
000B37 D15B C0              11      RET NZ
       D15C                     PAUSE:
000B38 D15C CD76D1          17      CALL    KEYBC
                                
       D15F                     BREAK:
000B3B D15F F5              11      PUSH    AF
000B3C D160 C5              11      PUSH    BC
000B3D D161 D5              11      PUSH    DE
000B3E D162 E5              11      PUSH    HL
000B3F D163 DDE5            15      PUSH    IX
000B41 D165 DD21B700        14      LD  IX,BREAKX
000B45 D169 CD88D3          17      CALL    CALSLT_R
000B48 D16C DDE1            14      POP IX
000B4A D16E E1              10      POP HL
000B4B D16F D1              10      POP DE
000B4C D170 C1              10      POP BC
000B4D D171 DCF4E5          17      CALL    C,_BREAK
000B50 D174 F1              10      POP AF
000B51 D175 C9              10      RET
       D176                     KEYBC:
000B52 D176 F5              11      PUSH    AF
000B53 D177 C5              11      PUSH    BC
000B54 D178 D5              11      PUSH    DE
000B55 D179 E5              11      PUSH    HL
000B56 D17A DDE5            15      PUSH    IX
000B58 D17C DD215601        14      LD  IX,KILBUF
000B5C D180 CD88D3          17      CALL    CALSLT_R
000B5F D183 DDE1            14      POP IX
000B61 D185 E1              10      POP HL
000B62 D186 D1              10      POP DE
000B63 D187 C1              10      POP BC
000B64 D188 F1              10      POP AF
000B65 D189 C9              10      RET
       D18A                     FLGET:
000B66 D18A C5              11      PUSH    BC
000B67 D18B D5              11      PUSH    DE
000B68 D18C E5              11      PUSH    HL
000B69 D18D DDE5            15      PUSH    IX
000B6B D18F CDDFE5          17      CALL    _FFLUSH
000B6E D192 181B            12      JR  FLGET1
       D193                     CBIOS_SWC1  EQU $-1
000B70 D194 CD70D3          17      CALL    GETVRAM
                                
000B73 D197 E5              11      PUSH    HL
000B74 D198 DD214A00        14      LD  IX,RDVRM
000B78 D19C CD88D3          17      CALL    CALSLT_R
000B7B D19F E1              10      POP HL
000B7C D1A0 32BBD1          13      LD  (SWCCHR),A
                                
000B7F D1A3 E5              11      PUSH    HL
000B80 D1A4 3EFF             7      LD  A,0FFH
000B82 D1A6 DD214D00        14      LD  IX,WRTVRM
000B86 D1AA CD88D3          17      CALL    CALSLT_R
000B89 D1AD E1              10      POP HL
                                
000B8A D1AE E5              11      PUSH    HL
       D1AF                     FLGET1:
000B8B D1AF DD219F00        14      LD  IX,CHGET
000B8F D1B3 CD88D3          17      CALL    CALSLT_R
000B92 D1B6 180C            12      JR  FLGET2
       D1B7                     CBIOS_SWC2  EQU $-1
000B94 D1B8 E1              10      POP HL
                                
000B95 D1B9 F5              11      PUSH    AF
000B96 D1BA 3E00             7      LD  A,0
       D1BB                     SWCCHR  EQU $-1
000B98 D1BC DD214D00        14      LD  IX,WRTVRM
000B9C D1C0 CD88D3          17      CALL    CALSLT_R
000B9F D1C3 F1              10      POP AF
       D1C4                     FLGET2:
000BA0 D1C4 DDE1            14      POP IX
000BA2 D1C6 E1              10      POP HL
000BA3 D1C7 D1              10      POP DE
000BA4 D1C8 C1              10      POP BC
000BA5 D1C9 FE03             7      CP  3
000BA7 D1CB C0              11      RET NZ
000BA8 D1CC C300E5          10      JP  CPM_BOOT
                                
       D1CF                     INKEY:
000BAB D1CF CD06E5          17      CALL    CPM_CONST
000BAE D1D2 C8              11      RET Z
000BAF D1D3 18B5            12      JR  FLGET
                                
       D1D5                     _SYS0A:     ;(BDOS)文字列入力
000BB1 D1D5 C5              11      PUSH    BC
000BB2 D1D6 E5              11      PUSH    HL
000BB3 D1D7 D5              11      PUSH    DE
000BB4 D1D8 CD01D2          17      CALL    GETL
000BB7 D1DB 111FF4          10      LD  DE,KBUF
000BBA D1DE E1              10      POP HL
000BBB D1DF E5              11      PUSH    HL
000BBC D1E0 0E00             7      LD  C,0
000BBE D1E2 3004            12      JR  NC,SAX0
000BC0 D1E4 23               6      INC HL
000BC1 D1E5 23               6      INC HL
000BC2 D1E6 1808            12      JR  SAX4
       D1E8                     SAX0:
000BC4 D1E8 46               7      LD  B,(HL)
000BC5 D1E9 23               6      INC HL
       D1EA                     SAX1:
000BC6 D1EA 23               6      INC HL
000BC7 D1EB 1A               7      LD  A,(DE)
000BC8 D1EC 13               6      INC DE
000BC9 D1ED B7               4      OR  A
000BCA D1EE 2004            12      JR  NZ,SAX2
       D1F0                     SAX4:
000BCC D1F0 360D            10      LD  (HL),00DH
000BCE D1F2 1804            12      JR  SAX3
       D1F4                     SAX2:
000BD0 D1F4 77               7      LD  (HL),A
000BD1 D1F5 0C               4      INC C
000BD2 D1F6 10F2            13      DJNZ    SAX1
       D1F8                     SAX3:
000BD4 D1F8 D1              10      POP DE
000BD5 D1F9 79               4      LD  A,C
000BD6 D1FA 13               6      INC DE
000BD7 D1FB 12               7      LD  (DE),A
000BD8 D1FC 1B               6      DEC DE
000BD9 D1FD E1              10      POP HL
000BDA D1FE C1              10      POP BC
000BDB D1FF A7               4      AND A
000BDC D200 C9              10      RET
       D201                     GETL:
000BDD D201 DDE5            15      PUSH    IX
000BDF D203 FDE5            15      PUSH    IY
                                
000BE1 D205 2ADCF3          16      LD  HL,(CSRY)
000BE4 D208 22CAFB          16      LD  (FSTPOS),HL
       D20B                     GETL1:
000BE7 D20B CD51D1          17      CALL    _SYS08
000BEA D20E FE09             7      CP  9
000BEC D210 2008            12      JR  NZ,GETL1V
000BEE D212 211FF4          10      LD  HL,KBUF
000BF1 D215 CD82CE          17      CALL    MSX
000BF4 D218 18F1            12      JR  GETL1
       D21A                     GETL1V:
000BF6 D21A 5F               4      LD  E,A
000BF7 D21B FE08             7      CP  8
000BF9 D21D CC16D3          17      CALL    Z,CTRL02
000BFC D220 FE20             7      CP  020H
000BFE D222 D442D3          17      CALL    NC,INSERT
000C01 D225 CD19D1          17      CALL    MSGA1
                                
000C04 D228 7B               4      LD  A,E
000C05 D229 FE0D             7      CP  00DH
000C07 D22B 20DE            12      JR  NZ,GETL1
                                
000C09 D22D 111FF4          10      LD  DE,KBUF
000C0C D230 3AB0F3          13      LD  A,(LINLEN)
000C0F D233 47               4      LD  B,A
000C10 D234 CD26CD          17      CALL    ZERO_MEMORY_DE
                                
000C13 D237 2ACAFB          16      LD  HL,(FSTPOS)
000C16 D23A 3ADCF3          13      LD  A,(CSRY)
000C19 D23D 6F               4      LD  L,A
000C1A D23E E5              11      PUSH    HL
000C1B D23F CD73D3          17      CALL    LOC0
000C1E D242 4D               4      LD  C,L
000C1F D243 44               4      LD  B,H
000C20 D244 E1              10      POP HL
000C21 D245 3AB0F3          13      LD  A,(LINLEN)
000C24 D248 94               4      SUB H
000C25 D249 3D               4      DEC A
000C26 D24A 5F               4      LD  E,A
000C27 D24B 211FF4          10      LD  HL,KBUF
       D24E                     GETL2:
000C2A D24E CDD0E5          17      CALL    _SCRN
000C2D D251 03               6      INC BC
000C2E D252 77               7      LD  (HL),A
000C2F D253 23               6      INC HL
000C30 D254 1D               4      DEC E
000C31 D255 20F7            12      JR  NZ,GETL2
000C33 D257 CD36D1          17      CALL    MSG_CR
                                
000C36 D25A FDE1            14      POP IY
000C38 D25C DDE1            14      POP IX
       D25E                     GETL3:
000C3A D25E 2B               6      DEC HL
000C3B D25F 7E               7      LD  A,(HL)
000C3C D260 FE21             7      CP  021H
000C3E D262 D0              11      RET NC
000C3F D263 3600            10      LD  (HL),0
000C41 D265 15               4      DEC D
000C42 D266 20F6            12      JR  NZ,GETL3
000C44 D268 C9              10      RET
                                
       D269                     _SYS0B:     ;(BDOS)コンソール状態のチェック
       D269                     CONSTX:
000C45 D269 C5              11      PUSH    BC
000C46 D26A D5              11      PUSH    DE
000C47 D26B E5              11      PUSH    HL
000C48 D26C DDE5            15      PUSH    IX
000C4A D26E DD219C00        14      LD  IX,CHSNS
000C4E D272 CD88D3          17      CALL    CALSLT_R
000C51 D275 DDE1            14      POP IX
000C53 D277 E1              10      POP HL
000C54 D278 D1              10      POP DE
000C55 D279 C1              10      POP BC
000C56 D27A C9              10      RET
                                
       D27B                     _SYS2A:     ;(BDOS)日付の獲得
000C57 D27B 0E0B             7      LD  C,11        ;年/Year→HL
000C59 D27D CDBCD2          17      CALL    RDCLK_BCD
000C5C D280 6F               4      LD  L,A
000C5D D281 2600             7      LD  H,0
000C5F D283 3AF8FA          13      LD  A,(EXBRSA)
000C62 D286 B7               4      OR  A
000C63 D287 2804            12      JR  Z,SX2A1
000C65 D289 11BC07          10      LD  DE,1980     ;1980年～2079年
000C68 D28C 19              11      ADD HL,DE
       D28D                     SX2A1:
000C69 D28D 0E09             7      LD  C,9     ;月/Month→D
000C6B D28F CDBCD2          17      CALL    RDCLK_BCD
000C6E D292 57               4      LD  D,A
                                
000C6F D293 0E07             7      LD  C,7     ;日/Day→E
000C71 D295 CDBCD2          17      CALL    RDCLK_BCD
000C74 D298 5F               4      LD  E,A
                                
000C75 D299 0E06             7      LD  C,6     ;曜日/Week→A
       D29B                     RDCLK:
000C77 D29B DDE5            15      PUSH    IX
000C79 D29D DD21F501        14      LD  IX,REDCLK
       D2A1                     WRCLK1:
000C7D D2A1 3AF8FA          13      LD  A,(EXBRSA)
000C80 D2A4 B7               4      OR  A
000C81 D2A5 280A            12      JR  Z,RDCLK1    ;MSX1
000C83 D2A7 FDE5            15      PUSH    IY
000C85 D2A9 FD67             9      LD  IYH,A
000C87 D2AB 78               4      LD  A,B
000C88 D2AC CDA4D3          17      CALL    CALSLTR
000C8B D2AF FDE1            14      POP IY
       D2B1                     RDCLK1:
000C8D D2B1 DDE1            14      POP IX
000C8F D2B3 C9              10      RET
       D2B4                     WRCLK:
000C90 D2B4 DDE5            15      PUSH    IX
000C92 D2B6 DD21F901        14      LD  IX,WRTCLK
000C96 D2BA 18E5            12      JR  WRCLK1
                                
       D2BC                     RDCLK_BCD:
000C98 D2BC CD9BD2          17      CALL    RDCLK       ;1の位
000C9B D2BF 47               4      LD  B,A
000C9C D2C0 0C               4      INC C
000C9D D2C1 CD9BD2          17      CALL    RDCLK       ;10の位
000CA0 D2C4 87               4      ADD A,A     ;*2
000CA1 D2C5 4F               4      LD  C,A
000CA2 D2C6 87               4      ADD A,A     ;*4
000CA3 D2C7 87               4      ADD A,A     ;*8
000CA4 D2C8 81               4      ADD A,C     ;*10(8+2)
000CA5 D2C9 80               4      ADD A,B     ;1の位
000CA6 D2CA C9              10      RET
                                
       D2CB                     _SYS2C:     ;(BDOS)時刻の獲得
000CA7 D2CB 011501          10      LD  BC,00115H       ;12時間計/24時間計の設定を24時間計に
000CAA D2CE CDB4D2          17      CALL    WRCLK
000CAD D2D1 0E04             7      LD  C,4     ;H=時/Hour
000CAF D2D3 CDBCD2          17      CALL    RDCLK_BCD
000CB2 D2D6 67               4      LD  H,A
000CB3 D2D7 0E02             7      LD  C,2     ;L=分/Minute
000CB5 D2D9 CDBCD2          17      CALL    RDCLK_BCD
000CB8 D2DC 6F               4      LD  L,A
000CB9 D2DD 0E00             7      LD  C,0     ;D=秒/Second
000CBB D2DF CDBCD2          17      CALL    RDCLK_BCD
000CBE D2E2 57               4      LD  D,A
000CBF D2E3 AF               4      XOR A       ;E=1/100秒
000CC0 D2E4 5F               4      LD  E,A
000CC1 D2E5 C9              10      RET
                                
       D2E6                     POS:
000CC2 D2E6 F5              11      PUSH    AF
000CC3 D2E7 2ADCF3          16      LD  HL,(CSRY)
000CC6 D2EA 7D               4      LD  A,L
000CC7 D2EB 6C               4      LD  L,H
000CC8 D2EC 67               4      LD  H,A
000CC9 D2ED 2C               4      INC L
000CCA D2EE 24               4      INC H
000CCB D2EF F1              10      POP AF
000CCC D2F0 C9              10      RET
                                
       D2F1                     LOC:
000CCD D2F1 F5              11      PUSH    AF
000CCE D2F2 E5              11      PUSH    HL
000CCF D2F3 7D               4      LD  A,L
000CD0 D2F4 6C               4      LD  L,H
000CD1 D2F5 67               4      LD  H,A
000CD2 D2F6 2D               4      DEC L
000CD3 D2F7 25               4      DEC H
000CD4 D2F8 DDE5            15      PUSH    IX
000CD6 D2FA DD21C600        14      LD  IX,POSIT
000CDA D2FE CD88D3          17      CALL    CALSLT_R
000CDD D301 DDE1            14      POP IX
000CDF D303 E1              10      POP HL
000CE0 D304 F1              10      POP AF
000CE1 D305 C9              10      RET
       D306                     SCRN:
000CE2 D306 E5              11      PUSH    HL
000CE3 D307 DDE5            15      PUSH    IX
                                
000CE5 D309 69               4      LD  L,C
000CE6 D30A 60               4      LD  H,B
000CE7 D30B DD214A00        14      LD  IX,RDVRM
000CEB D30F CD88D3          17      CALL    CALSLT_R
                                
000CEE D312 DDE1            14      POP IX
000CF0 D314 E1              10      POP HL
000CF1 D315 C9              10      RET
                                
       D316                     CTRL02:
000CF2 D316 F5              11      PUSH    AF
000CF3 D317 D5              11      PUSH    DE
000CF4 D318 2ADCF3          16      LD  HL,(CSRY)
000CF7 D31B 3AB0F3          13      LD  A,(LINLEN)
000CFA D31E 4F               4      LD  C,A
000CFB D31F 94               4      SUB H   ;CSRX
000CFC D320 C602             7      ADD A,2
000CFE D322 47               4      LD  B,A ;カーソルより右の文字数
000CFF D323 61               4      LD  H,C ;LINLEN
000D00 D324 C5              11      PUSH    BC
000D01 D325 CD73D3          17      CALL    LOC0
000D04 D328 C1              10      POP BC
                                
000D05 D329 1620             7      LD  D,020H
       D32B                     C8X1:
000D07 D32B DD214A00        14      LD  IX,RDVRM
000D0B D32F CD88D3          17      CALL    CALSLT_R
000D0E D332 4F               4      LD  C,A
000D0F D333 7A               4      LD  A,D
000D10 D334 DD214D00        14      LD  IX,WRTVRM
000D14 D338 CD88D3          17      CALL    CALSLT_R
000D17 D33B 2B               6      DEC HL
000D18 D33C 51               4      LD  D,C
000D19 D33D 10EC            13      DJNZ    C8X1
000D1B D33F D1              10      POP DE
000D1C D340 F1              10      POP AF
000D1D D341 C9              10      RET
                                
       D342                     INSERT:
000D1E D342 F5              11      PUSH    AF
000D1F D343 D5              11      PUSH    DE
000D20 D344 2ADCF3          16      LD  HL,(CSRY)
000D23 D347 3AB0F3          13      LD  A,(LINLEN)
000D26 D34A 4F               4      LD  C,A
000D27 D34B 94               4      SUB H   ;CSRX
000D28 D34C 3C               4      INC A
000D29 D34D 47               4      LD  B,A ;カーソルより右の文字数
000D2A D34E C5              11      PUSH    BC
000D2B D34F CD73D3          17      CALL    LOC0
000D2E D352 C1              10      POP BC
                                
000D2F D353 1620             7      LD  D,020H
       D355                     INS1:
000D31 D355 DD214A00        14      LD  IX,RDVRM
000D35 D359 CD88D3          17      CALL    CALSLT_R
000D38 D35C 4F               4      LD  C,A
000D39 D35D 7A               4      LD  A,D
000D3A D35E DD214D00        14      LD  IX,WRTVRM
000D3E D362 CD88D3          17      CALL    CALSLT_R
000D41 D365 23               6      INC HL
000D42 D366 51               4      LD  D,C
000D43 D367 10EC            13      DJNZ    INS1
000D45 D369 D1              10      POP DE
000D46 D36A F1              10      POP AF
000D47 D36B C9              10      RET
                                
       D36C                     CONOUT1:
000D48 D36C 59               4      LD  E,C
000D49 D36D C3CDE5          10      JP  _PRINT
                                
       D370                     GETVRAM:
000D4C D370 2ADCF3          16      LD  HL,(CSRY)
       D373                     LOC0:
000D4F D373 2D               4      DEC L
000D50 D374 25               4      DEC H
000D51 D375 4C               4      LD  C,H ;CSRX-1
000D52 D376 5D               4      LD  E,L ;CSRY-1
       D377                     LOC1:
000D53 D377 3AB0F3          13      LD  A,(LINLEN)
000D56 D37A 67               4      LD  H,A
000D57 D37B 1600             7      LD  D,0
000D59 D37D 6A               4      LD  L,D ;0
000D5A D37E 0608             7      LD  B,8
       D380                     LOC2:
000D5C D380 29              11      ADD HL,HL
000D5D D381 3001            12      JR  NC,LOC3
000D5F D383 19              11      ADD HL,DE
       D384                     LOC3:
000D60 D384 10FA            13      DJNZ    LOC2
000D62 D386 09              11      ADD HL,BC
000D63 D387 C9              10      RET
                                
       D388                     CALSLT_R:
000D64 D388 FDE5            15      PUSH    IY
000D66 D38A FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
000D6A D38E CDA4D3          17      CALL    CALSLTR
000D6D D391 FDE1            14      POP IY
000D6F D393 C9              10      RET
                                
       D394                     CALLF:
000D70 D394 08               4      EX  AF,AF'
000D71 D395 E3              19      EX  (SP),HL
000D72 D396 7E               7      LD  A,(HL)
000D73 D397 FD67             9      LD  IYH,A
000D75 D399 23               6      INC HL
000D76 D39A 7E               7      LD  A,(HL)
000D77 D39B DD6F             9      LD  IXL,A
000D79 D39D 23               6      INC HL
000D7A D39E 7E               7      LD  A,(HL)
000D7B D39F DD67             9      LD  IXH,A
000D7D D3A1 23               6      INC HL
000D7E D3A2 E3              19      EX  (SP),HL
000D7F D3A3 08               4      EX  AF,AF'
       D3A4                     CALSLTR:
000D80 D3A4 F3               4      DI
000D81 D3A5 ED73DED3        20      LD  (CSSP),SP
000D85 D3A9 F5              11      PUSH    AF
000D86 D3AA 3E1C             7      LD  A,_CALSLT
       D3AC                     SLTCALL:
000D88 D3AC 32CBD3          13      LD  (SLTCALLX),A
000D8B D3AF 3ADFD3          13      LD  A,(CSSP+1)
000D8E D3B2 FE41             7      CP  040H+1
000D90 D3B4 3005            12      JR  NC,CALSLTR1
000D92 D3B6 F1              10      POP AF
000D93 D3B7 315EF5          10      LD  SP,BUF
000D96 D3BA F5              11      PUSH    AF
       D3BB                     CALSLTR1:
000D97 D3BB C5              11      PUSH    BC
000D98 D3BC D5              11      PUSH    DE
000D99 D3BD E5              11      PUSH    HL
000D9A D3BE 2600             7      LD  H,0
000D9C D3C0 3AC1FC          13      LD  A,(EXPTBL)  ;メインROMに切り替える
000D9F D3C3 CDE2D4          17      CALL    ENASLT
000DA2 D3C6 E1              10      POP HL
000DA3 D3C7 D1              10      POP DE
000DA4 D3C8 C1              10      POP BC
000DA5 D3C9 F1              10      POP AF
000DA6 D3CA CD1C00          17      CALL    _CALSLT
       D3CB                     SLTCALLX    EQU $-2
000DA9 D3CD F5              11      PUSH    AF
000DAA D3CE C5              11      PUSH    BC
000DAB D3CF D5              11      PUSH    DE
000DAC D3D0 E5              11      PUSH    HL
000DAD D3D1 2600             7      LD  H,0
000DAF D3D3 3A41F3          13      LD  A,(0F341H)  ;メインRAMに戻す
000DB2 D3D6 CDE2D4          17      CALL    ENASLT
000DB5 D3D9 E1              10      POP HL
000DB6 D3DA D1              10      POP DE
000DB7 D3DB C1              10      POP BC
000DB8 D3DC F1              10      POP AF
000DB9 D3DD 310000          10      LD  SP,0
       D3DE                     CSSP    EQU $-2
000DBC D3E0 FB               4      EI
000DBD D3E1 C9              10      RET
                                
       D3E2                     RDSLTR:
000DBE D3E2 ED73DED3        20      LD  (CSSP),SP
000DC2 D3E6 F5              11      PUSH    AF
000DC3 D3E7 3E0C             7      LD  A,_RDSLT
000DC5 D3E9 18C1            12      JR  SLTCALL
                                
       D3EB                     WRSLTR:
000DC7 D3EB ED73DED3        20      LD  (CSSP),SP
000DCB D3EF F5              11      PUSH    AF
000DCC D3F0 3E14             7      LD  A,_WRSLT
000DCE D3F2 18B8            12      JR  SLTCALL
                                
       D3F4                     INT38H:
000DD0 D3F4 F5              11      PUSH    AF
000DD1 D3F5 E5              11      PUSH    HL          ;メインROMを呼び出すのでスタックが被っていないかチェック
000DD2 D3F6 2A20D4          16      LD  HL,(INTSP)
000DD5 D3F9 7C               4      LD  A,H
000DD6 D3FA B5               4      OR  L
000DD7 D3FB 202D            12      JR  NZ,INT38H2
000DD9 D3FD C5              11      PUSH    BC
000DDA D3FE D5              11      PUSH    DE
000DDB D3FF 2100BF          10      LD  HL,010000H-04100H   ;Page1
000DDE D402 39              11      ADD HL,SP
000DDF D403 ED7320D4        20      LD  (INTSP),SP
000DE3 D407 3803            12      JR  C,INT38H1
000DE5 D409 315EF5          10      LD  SP,BUF
       D40C                     INT38H1:
000DE8 D40C 2600             7      LD  H,0
000DEA D40E 3AC1FC          13      LD  A,(EXPTBL)  ;メインROMに切り替える
000DED D411 CDE2D4          17      CALL    ENASLT
000DF0 D414 CD3800          17      CALL    00038H
000DF3 D417 2600             7      LD  H,0
000DF5 D419 3A41F3          13      LD  A,(0F341H)  ;メインRAMに戻す
000DF8 D41C CDE2D4          17      CALL    ENASLT
000DFB D41F 310000          10      LD  SP,0
       D420                     INTSP   EQU $-2
000DFE D422 210000          10      LD  HL,0
000E01 D425 2220D4          16      LD  (INTSP),HL
000E04 D428 D1              10      POP DE
000E05 D429 C1              10      POP BC
       D42A                     INT38H2:
000E06 D42A E1              10      POP HL
000E07 D42B F1              10      POP AF
000E08 D42C FB               4      EI
000E09 D42D C9              10      RET
                                
[EOF:MSXIO.ASM:SHIFT_JIS]
                                    INCLUDE "LDFILE.ASM"
                                
                                ;   LSX-Dodgers FILE
                                
                                ;   【注意】バイナリサイズを下位1バイトを0丁度に調整する必要あり(X1/88)
       0000                     CHECK_FILE_SIZE EQU (FILEC-FILE_E) & 0FFH
       D5C5                     FILEC:
000FA1 D5C5 CDD0D5          17      CALL    FILE
       D5C8                     FILEC2:
000FA4 D5C8 3A15E5          13      LD  A,(FDRV+1)
000FA7 D5CB FE20             7      CP  020H
000FA9 D5CD C8              11      RET Z
000FAA D5CE 1839            12      JR  SETDIR1
                                
       D5D0                     FILE:
000FAC D5D0 AF               4      XOR A
000FAD D5D1 3214E5          13      LD  (FDRV),A
000FB0 D5D4 67               4      LD  H,A
000FB1 D5D5 6F               4      LD  L,A
000FB2 D5D6 2222E5          16      LD  (FDRV+14),HL
000FB5 D5D9 CDA6D6          17      CALL    SPCUT
000FB8 D5DC CD8BD6          17      CALL    CCHK3
000FBB D5DF 2812            12      JR  Z,DEVI1
000FBD D5E1 13               6      INC DE
000FBE D5E2 1A               7      LD  A,(DE)
000FBF D5E3 1B               6      DEC DE
000FC0 D5E4 FE3A             7      CP  ':'
000FC2 D5E6 200B            12      JR  NZ,DEVI1
000FC4 D5E8 1A               7      LD  A,(DE)      ;DRIVE
000FC5 D5E9 CDECD8          17      CALL    CAP
000FC8 D5EC D640             7      SUB '@'
000FCA D5EE 13               6      INC DE
000FCB D5EF 13               6      INC DE
000FCC D5F0 3214E5          13      LD  (FDRV),A
       D5F3                     DEVI1:
000FCF D5F3 1A               7      LD  A,(DE)
000FD0 D5F4 D65C             7      SUB 05CH        ;\
000FD2 D5F6 2009            12      JR  NZ,NOROOT
000FD4 D5F8 6F               4      LD  L,A     ;A=0でH=0のはずなのでHL=0
000FD5 D5F9 222EE5          16      LD  (FDRV+26),HL
000FD8 D5FC 2C               4      INC L
000FD9 D5FD 2222E5          16      LD  (FDRV+14),HL
000FDC D600 13               6      INC DE
       D601                     NOROOT:
                                
       D601                     SETDIR:
000FDD D601 CD2CD6          17      CALL    FILED
000FE0 D604 1A               7      LD  A,(DE)
000FE1 D605 FE5C             7      CP  05CH        ;\
000FE3 D607 C0              11      RET NZ
000FE4 D608 13               6      INC DE
       D609                     SETDIR1:
000FE5 D609 3E10             7      LD  A,010H      ;Directory
000FE7 D60B 3221E5          13      LD  (FDRV+13),A
000FEA D60E D5              11      PUSH    DE
000FEB D60F 1114E5          10      LD  DE,FDRV
000FEE D612 0E0F             7      LD  C,00FH      ;(BDOS)ファイルのオープン
000FF0 D614 CD42CE          17      CALL    BDOS0
000FF3 D617 D1              10      POP DE
000FF4 D618 B7               4      OR  A
000FF5 D619 C0              11      RET NZ
                                
000FF6 D61A 3A21E5          13      LD  A,(FDRV+13)
000FF9 D61D E610             7      AND 010H        ;ディレクトリ
000FFB D61F C8              11      RET Z
                                
000FFC D620 CD73D6          17      CALL    FILEI
000FFF D623 2A2EE5          16      LD  HL,(FDRV+26)
001002 D626 23               6      INC HL
001003 D627 2222E5          16      LD  (FDRV+14),HL
001006 D62A 18D5            12      JR  SETDIR
                                
       D62C                     FILED:
001008 D62C CD73D6          17      CALL    FILEI
00100B D62F 2115E5          10      LD  HL,FNAME
                                
00100E D632 0608             7      LD  B,8
       D634                     FILE2:
001010 D634 CD80D6          17      CALL    CCHKF
001013 D637 C8              11      RET Z
001014 D638 FE2A             7      CP  '*'
001016 D63A 282E            12      JR  Z,FILE9
001018 D63C FE2E             7      CP  '.'
00101A D63E 280C            12      JR  Z,FILE4
00101C D640 77               7      LD  (HL),A
00101D D641 23               6      INC HL
00101E D642 10F0            13      DJNZ    FILE2
                                
       D644                     FILE3:
001020 D644 CD80D6          17      CALL    CCHKF
001023 D647 C8              11      RET Z
001024 D648 FE2E             7      CP  '.'
001026 D64A 20F8            12      JR  NZ,FILE3
                                
       D64C                     FILE4:
001028 D64C 211DE5          10      LD  HL,FNAME+8
00102B D64F 0603             7      LD  B,3
                                
       D651                     FILE4L:
00102D D651 CD80D6          17      CALL    CCHKF
001030 D654 C8              11      RET Z
001031 D655 FE2E             7      CP  '.'
001033 D657 2008            12      JR  NZ,FILE12
001035 D659 3215E5          13      LD  (FNAME),A   ;Parent directory(..)
001038 D65C 3216E5          13      LD  (FNAME+1),A
00103B D65F 3E20             7      LD  A,020H
       D661                     FILE12:
00103D D661 FE2A             7      CP  '*'
00103F D663 280A            12      JR  Z,FILE10
001041 D665 77               7      LD  (HL),A
001042 D666 23               6      INC HL
001043 D667 10E8            13      DJNZ    FILE4L
001045 D669 C9              10      RET
                                
       D66A                     FILE9:              ;名前の*処理、名前の残りを?で埋める
001046 D66A CD6FD6          17      CALL    FILE10
001049 D66D 18D5            12      JR  FILE3
                                
       D66F                     FILE10:
00104B D66F 3E3F             7      LD  A,'?'
00104D D671 1808            12      JR  FILL_MEMORY
       D673                     FILEI:              ;名前＋拡張子をスペースで初期化
00104F D673 3E20             7      LD  A,020H
001051 D675 01000B          10      LD  BC,11*256   ;C=0にしておく
001054 D678 2115E5          10      LD  HL,FNAME
       D67B                     FILL_MEMORY:            ;HLからBバイトAで埋める
001057 D67B 77               7      LD  (HL),A
001058 D67C 23               6      INC HL
001059 D67D 10FC            13      DJNZ    FILL_MEMORY
00105B D67F C9              10      RET
                                
       D680                     CCHKF:
00105C D680 1A               7      LD  A,(DE)
00105D D681 CD88D6          17      CALL    CCHK2
001060 D684 C8              11      RET Z
001061 D685 C3F4D9          10      JP  FKAN
                                
       D688                     CCHK2:
001064 D688 0C               4      INC C
001065 D689 0D               4      DEC C
001066 D68A C0              11      RET NZ
       D68B                     CCHK3:              ;ZF=1 で使えない文字
001067 D68B FE2B             7      CP  '+'
001069 D68D C8              11      RET Z
00106A D68E FE2C             7      CP  ','
00106C D690 C8              11      RET Z
00106D D691 FE2F             7      CP  '/'
00106F D693 C8              11      RET Z
001070 D694 FE3A             7      CP  ':'
001072 D696 C8              11      RET Z
001073 D697 FE3B             7      CP  ';'
001075 D699 C8              11      RET Z
001076 D69A FE3D             7      CP  '='
001078 D69C C8              11      RET Z
001079 D69D FE5C             7      CP  05CH    ;\
00107B D69F C8              11      RET Z
00107C D6A0 FE20             7      CP  020H
00107E D6A2 D0              11      RET NC
00107F D6A3 BF               4      CP  A       ;Z=1
001080 D6A4 C9              10      RET
                                
       D6A5                     SS1:
001081 D6A5 13               6      INC DE
       D6A6                     SPCUT:              ;スペースをカット
001082 D6A6 1A               7      LD  A,(DE)
001083 D6A7 FE20             7      CP  020H
001085 D6A9 28FA            12      JR  Z,SS1
001087 D6AB C9              10      RET
                                
       D6AC                     SETDRVF:
001088 D6AC 1114E5          10      LD  DE,FDRV
       D6AF                     SETDRV0:
00108B D6AF CDB8D6          17      CALL    SETDRV
00108E D6B2 FDE1            14      POP IY
001090 D6B4 C1              10      POP BC
001091 D6B5 D1              10      POP DE
001092 D6B6 E1              10      POP HL
001093 D6B7 C9              10      RET
                                
       D6B8                     SETDRV:
001094 D6B8 E3              19      EX  (SP),HL     ;HL=RETRN ADDRESS
001095 D6B9 D5              11      PUSH    DE      ;PUSH HL/DE/BC/IY
001096 D6BA C5              11      PUSH    BC
001097 D6BB 1A               7      LD  A,(DE)
001098 D6BC D5              11      PUSH    DE
001099 D6BD FDE3            23      EX  (SP),IY
                                
00109B D6BF CDC6D6          17      CALL    GETDRV
00109E D6C2 CDD9E5          17      CALL    _CHGDRV
                                
0010A1 D6C5 E9               4      JP  (HL)
                                
       D6C6                     GETDRV:
0010A2 D6C6 CDD9D6          17      CALL    GETDRV1
0010A5 D6C9 3288E5          13      LD  (_DRV),A
0010A8 D6CC C9              10      RET
                                
       D6CD                     IS_SAME_DRV_A_DE:
                                ;   A と (DE) が同じドライブか調べる
                                ;   ZF=1ならば同じドライブ
0010A9 D6CD CDD9D6          17      CALL    GETDRV1
0010AC D6D0 C5              11      PUSH    BC
0010AD D6D1 4F               4      LD  C,A
0010AE D6D2 1A               7      LD  A,(DE)
0010AF D6D3 CDD9D6          17      CALL    GETDRV1
0010B2 D6D6 A9               4      XOR C
0010B3 D6D7 C1              10      POP BC
0010B4 D6D8 C9              10      RET
       D6D9                     GETDRV1:
0010B5 D6D9 E67F             7      AND 07FH
0010B7 D6DB D601             7      SUB 001H
0010B9 D6DD D0              11      RET NC
0010BA D6DE 3A0400          13      LD  A,(_DVSW)   ;Current Drive
0010BD D6E1 C9              10      RET
                                
       D6E2                     SOPENX:
0010BE D6E2 1139E5          10      LD  DE,SFILE
0010C1 D6E5 FD7E00          19      LD  A,(IY+0)        ;(FCB)ドライブ番号
0010C4 D6E8 CDCDD6          17      CALL    IS_SAME_DRV_A_DE
0010C7 D6EB 2024            12      JR  NZ,SOPEN
0010C9 D6ED 13               6      INC DE
0010CA D6EE FDE5            15      PUSH    IY
0010CC D6F0 E1              10      POP HL
0010CD D6F1 23               6      INC HL
0010CE D6F2 CD7DD8          17      CALL    CPFILE
0010D1 D6F5 201A            12      JR  NZ,SOPEN
                                
0010D3 D6F7 2AF4E6          16      LD  HL,(SCDIR)
0010D6 D6FA FD750E          19      LD  (IY+14),L   ;(FCB)アクセスするディレクトリのクラスタ番号+1
0010D9 D6FD FD740F          19      LD  (IY+15),H
                                
0010DC D700 2AF8E6          16      LD  HL,(SFNDF)  ;Direcroty location and Flags
0010DF D703 229FE5          16      LD  (_FILEN),HL
                                
0010E2 D706 ED5BF6E6        20      LD  DE,(SFBPS)
0010E6 D70A 2139E5          10      LD  HL,SFILE
0010E9 D70D 36FF            10      LD  (HL),0FFH
0010EB D70F 23               6      INC HL
0010EC D710 C9              10      RET
       D711                     SOPEN:
0010ED D711 2125D8          10      LD  HL,FILESE
       D714                     SOPENC:
0010F0 D714 224DD7          16      LD  (OPENPAT),HL
                                
0010F3 D717 CDE2E5          17      CALL    _RDFATX     ;Detect Media
0010F6 D71A 3856            12      JR  C,RDDERR
                                
0010F8 D71C AF               4      XOR A
0010F9 D71D 329FE5          13      LD  (_FILEN),A
0010FC D720 CD29D9          17      CALL    LDDIRX1     ;A=0で呼び出す
0010FF D723 2818            12      JR  Z,SDIRX1
                                
001101 D725 CD16D8          17      CALL    READ_DIR    ;Sub Directory
001104 D728 3808            12      JR  C,SDIRX0
001106 D72A 2A7EE6          16      LD  HL,(_DTBUF)
001109 D72D 7E               7      LD  A,(HL)
00110A D72E FE2E             7      CP  '.'
00110C D730 280F            12      JR  Z,SOPEN1
       D732                     SDIRX0:
00110E D732 AF               4      XOR A
00110F D733 32A0E5          13      LD  (_DIRF),A
001112 D736 FD360E01        19      LD  (IY+14),1   ;(FCB)レコードサイズ
001116 D73A FD770F          19      LD  (IY+15),A
       D73D                     SDIRX1:
001119 D73D ED5BFCE6        20      LD  DE,(_DIRPS) ;Root Directory
       D741                     SOPEN1:
00111D D741 0E20             7      LD  C,32        ;自己書き換え 1セクタ辺りのディレクトリエントリ数  1024=32 / 512=16 / 256=8
       D742                     SDECPAT EQU $-1
       D743                     SOPEN1X:
00111F D743 CD16D8          17      CALL    READ_DIR    ;FILE SEARCH
001122 D746 382A            12      JR  C,RDDERR
001124 D748 2A7EE6          16      LD  HL,(_DTBUF)
       D74B                     SOPEN2:
001127 D74B D5              11      PUSH    DE
001128 D74C CD25D8          17      CALL    FILESE      ;(self-modifying code)
       D74D                     OPENPAT EQU $-2
00112B D74F D1              10      POP DE
00112C D750 386D            12      JR  C,SOPENE
00112E D752 281B            12      JR  Z,SCF_FF_RET
       D754                     SOPEN3:
001130 D754 3AA0E5          13      LD  A,(_DIRF)   ;ディレクトリか判別
001133 D757 B7               4      OR  A
001134 D758 200C            12      JR  NZ,SOPEN5
001136 D75A 13               6      INC DE      ;ルートディレクトリ
001137 D75B E5              11      PUSH    HL
001138 D75C 210C00          10      LD  HL,12       ;(self-modifying code)MAXDIR
       D75D                     MD_PAT  EQU $-2
00113B D75F ED52            15      SBC HL,DE       ;CF=0 なので SUB HL,DE
00113D D761 E1              10      POP HL
00113E D762 20DD            12      JR  NZ,SOPEN1
001140 D764 1807            12      JR  SOPEN6
       D766                     SOPEN5:
001142 D766 CD30E0          17      CALL    GNCLX       ;END DIR
001145 D769 D8              11      RET C
001146 D76A CDDDD8          17      CALL    ENDCL
       D76D                     SOPEN6:
001149 D76D 38D2            12      JR  C,SOPEN1
       D76F                     SCF_FF_RET:
00114B D76F 37               4      SCF         ;CF=1
00114C D770 9F               4      SBC A,A     ;A=0FFH
00114D D771 C9              10      RET
                                
       D772                     RDDERR:
00114E D772 BF               4      CP  A       ;READ ERR CF=1 ZF=1
00114F D773 37               4      SCF
001150 D774 C9              10      RET
                                
       D775                     NOPEN:
001151 D775 2125D8          10      LD  HL,FILESE
001154 D778 224DD7          16      LD  (OPENPAT),HL
001157 D77B FD2A98E5        20      LD  IY,(_FCB)
00115B D77F CD07DA          17      CALL    CHKWILDX
00115E D782 30EB            12      JR  NC,SCF_FF_RET
001160 D784 FD7E00          19      LD  A,(IY+0)
001163 D787 CDC6D6          17      CALL    GETDRV
001166 D78A CDD9E5          17      CALL    _CHGDRV
001169 D78D D8              11      RET C
00116A D78E 2AF8E6          16      LD  HL,(SFNDF)  ;Direcroty location and Flags
00116D D791 229FE5          16      LD  (_FILEN),HL
                                
001170 D794 CD24D9          17      CALL    LDDIRX
001173 D797 ED5B9AE5        20      LD  DE,(_FBPS)
001177 D79B CD16D8          17      CALL    READ_DIR
00117A D79E 38D2            12      JR  C,RDDERR
00117C D7A0 3A9EE5          13      LD  A,(_FBCNT)
00117F D7A3 3D               4      DEC A
001180 D7A4 28AE            12      JR  Z,SOPEN3
       D7A6                     NOPEN2:
001182 D7A6 2A9CE5          16      LD  HL,(_FBAD)
001185 D7A9 012000          10      LD  BC,020H
001188 D7AC 09              11      ADD HL,BC
001189 D7AD 4F               4      LD  C,A
00118A D7AE 189B            12      JR  SOPEN2
                                
       D7B0                     SOPENE2:
00118C D7B0 229CE5          16      LD  (_FBAD),HL
00118F D7B3 79               4      LD  A,C
001190 D7B4 329EE5          13      LD  (_FBCNT),A
001193 D7B7 ED539AE5        20      LD  (_FBPS),DE
001197 D7BB FD2298E5        20      LD  (_FCB),IY
       D7BF                     SOPENE:
00119B D7BF AF               4      XOR A
00119C D7C0 C9              10      RET
                                
       D7C1                     COPEN:
00119D D7C1 FD360D20        19      LD  (IY+13),020H    ;(FCB)属性(アトリビュート)
                                
0011A1 D7C5 2142D8          10      LD  HL,NEXTSE
0011A4 D7C8 CD14D7          17      CALL    SOPENC
0011A7 D7CB D0              11      RET NC
0011A8 D7CC C8              11      RET Z
0011A9 D7CD 3AA0E5          13      LD  A,(_DIRF)   ;ディレクトリか判別
0011AC D7D0 B7               4      OR  A
0011AD D7D1 37               4      SCF
0011AE D7D2 C8              11      RET Z       ;ルートディレクトリ
0011AF D7D3 0601             7      LD  B,1
0011B1 D7D5 CD66DA          17      CALL    WRDF
0011B4 D7D8 D8              11      RET C
0011B5 D7D9 ED5BFEE6        20      LD  DE,(_CLPS)
0011B9 D7DD D5              11      PUSH    DE
0011BA D7DE CDA6D8          17      CALL    DCPAT
0011BD D7E1 CDB1DE          17      CALL    DRDNX
0011C0 D7E4 2A7EE6          16      LD  HL,(_DTBUF) ;ディレクトリエントリを0クリア
0011C3 D7E7 ED4B9CDD        20      LD  BC,(SECSZ)  ;1セクタのサイズ
0011C7 D7EB AF               4      XOR A
       D7EC                     COPENCL:
0011C8 D7EC 77               7      LD  (HL),A
0011C9 D7ED EDA1            16      CPI         ;HL=HL+1 BC=BC-1 BCが0の場合にP/V=0
0011CB D7EF EAECD7          10      JP  PE,COPENCL
                                
0011CE D7F2 3AC4D8          13      LD  A,(SPCPAT)  ;1クラスタの論理セクタ数
0011D1 D7F5 3D               4      DEC A
0011D2 D7F6 2819            12      JR  Z,COPENE
0011D4 D7F8 3E01             7      LD  A,1     ;1セクタ辺りのセクタ数が2以上の場合
0011D6 D7FA 3228E0          13      LD  (_SECPS),A
0011D9 D7FD D1              10      POP DE      ;DE=(_CLPS)
0011DA D7FE D5              11      PUSH    DE
       D7FF                     COPEN1:
0011DB D7FF D5              11      PUSH    DE      ;データバッファに入らないセクタもゼロクリア
0011DC D800 C5              11      PUSH    BC
0011DD D801 2A7EE6          16      LD  HL,(_DTBUF)
0011E0 D804 CDC0D8          17      CALL    CLUSTX
0011E3 D807 CDC7E1          17      CALL    DWT24
0011E6 D80A C1              10      POP BC
0011E7 D80B D1              10      POP DE
0011E8 D80C CD27E0          17      CALL    NEXTX
0011EB D80F 20EE            12      JR  NZ,COPEN1
       D811                     COPENE:
0011ED D811 2A7EE6          16      LD  HL,(_DTBUF)
0011F0 D814 D1              10      POP DE
0011F1 D815 C9              10      RET
                                
       D816                     READ_DIR:
0011F2 D816 ED53FEE6        20      LD  (_CLPS),DE
0011F6 D81A C5              11      PUSH    BC
0011F7 D81B D5              11      PUSH    DE
0011F8 D81C CDA6D8          17      CALL    DCPAT
0011FB D81F CD91DE          17      CALL    DRDX
0011FE D822 D1              10      POP DE
0011FF D823 C1              10      POP BC
001200 D824 C9              10      RET
                                
       D825                     FILESE:
001201 D825 7E               7      LD  A,(HL)
001202 D826 B7               4      OR  A
001203 D827 C8              11      RET Z       ;END:ZF=1 CF=0
001204 D828 FEE5             7      CP  0E5H
001206 D82A 280E            12      JR  Z,FILESE1
001208 D82C FDE5            15      PUSH    IY
00120A D82E D1              10      POP DE
00120B D82F 13               6      INC DE
00120C D830 E5              11      PUSH    HL
00120D D831 CD7DD8          17      CALL    CPFILE
001210 D834 CC9ED8          17      CALL    Z,CPFILE2
001213 D837 E1              10      POP HL
001214 D838 37               4      SCF
001215 D839 C8              11      RET Z       ;!!!:(ZF=1) CF=1
       D83A                     FILESE1:
001216 D83A CD51D8          17      CALL    FNEXT
001219 D83D 20E6            12      JR  NZ,FILESE
       D83F                     ZF0_CF0_AFF_RET:
00121B D83F F6FF             7      OR  0FFH        ;ZF=0 CF=0
00121D D841 C9              10      RET
                                
       D842                     NEXTSE:
00121E D842 7E               7      LD  A,(HL)
00121F D843 B7               4      OR  A
001220 D844 37               4      SCF
001221 D845 C8              11      RET Z       ;!!!:ZF=1 CF=1
001222 D846 FEE5             7      CP  0E5H
001224 D848 37               4      SCF
001225 D849 C8              11      RET Z       ;!!!:(ZF=1) CF=1
001226 D84A CD51D8          17      CALL    FNEXT
001229 D84D 20F3            12      JR  NZ,NEXTSE
00122B D84F 18EE            12      JR  ZF0_CF0_AFF_RET
                                
       D851                     FNEXT:
00122D D851 E5              11      PUSH    HL
00122E D852 219FE5          10      LD  HL,_FILEN
001231 D855 34              11      INC (HL)
001232 D856 E1              10      POP HL
001233 D857 112000          10      LD  DE,020H
001236 D85A 19              11      ADD HL,DE
001237 D85B 0D               4      DEC C
001238 D85C C9              10      RET
                                
       D85D                     CPNAME:
001239 D85D C5              11      PUSH    BC
00123A D85E D5              11      PUSH    DE
00123B D85F E5              11      PUSH    HL
00123C D860 CD77D8          17      CALL    CPFILE4
00123F D863 E1              10      POP HL
001240 D864 23               6      INC HL
001241 D865 23               6      INC HL
001242 D866 23               6      INC HL
001243 D867 23               6      INC HL
001244 D868 D1              10      POP DE
001245 D869 C1              10      POP BC
001246 D86A 2005            12      JR  NZ,CPNAME1
001248 D86C 7E               7      LD  A,(HL)
001249 D86D 23               6      INC HL
00124A D86E 66               7      LD  H,(HL)
00124B D86F 6F               4      LD  L,A
00124C D870 C9              10      RET
       D871                     CPNAME1:
00124D D871 23               6      INC HL
00124E D872 23               6      INC HL
00124F D873 10E8            13      DJNZ    CPNAME
001251 D875 37               4      SCF
001252 D876 C9              10      RET
                                
       D877                     CPFILE4:
001253 D877 C5              11      PUSH    BC
001254 D878 010004          10      LD  BC,00400H
001257 D87B 1804            12      JR  CPSTR1
       D87D                     CPFILE:
001259 D87D C5              11      PUSH    BC
00125A D87E 01000B          10      LD  BC,00B00H
       D881                     CPSTR1:
00125D D881 1A               7      LD  A,(DE)
00125E D882 FE3F             7      CP  '?'     ;Wild card
001260 D884 2812            12      JR  Z,CPSTR2
001262 D886 7E               7      LD  A,(HL)
001263 D887 CDEDD9          17      CALL    FKANC
001266 D88A E5              11      PUSH    HL
001267 D88B 67               4      LD  H,A
001268 D88C 1A               7      LD  A,(DE)
001269 D88D CB01             4      RLC C
00126B D88F CDEDD9          17      CALL    FKANC
00126E D892 CB09             4      RRC C
001270 D894 BC               4      CP  H       ;CP (HL),(DE)
001271 D895 E1              10      POP HL
001272 D896 2004            12      JR  NZ,CPSTR3
       D898                     CPSTR2:
001274 D898 13               6      INC DE
001275 D899 23               6      INC HL
001276 D89A 10E5            13      DJNZ    CPSTR1
       D89C                     CPSTR3:
001278 D89C C1              10      POP BC
001279 D89D C9              10      RET
                                
       D89E                     CPFILE2:
00127A D89E FD7E0D          19      LD  A,(IY+13)   ;(FCB)属性(アトリビュート)
00127D D8A1 F6E1             7      OR  0E1H
00127F D8A3 2F               4      CPL
001280 D8A4 A6               7      AND (HL)
001281 D8A5 C9              10      RET
                                
       D8A6                     DCPAT:
001282 D8A6 0E00             7      LD  C,0
001284 D8A8 2A7EE6          16      LD  HL,(_DTBUF)
001287 D8AB 3AA0E5          13      LD  A,(_DIRF)   ;ディレクトリか判別
00128A D8AE B7               4      OR  A
00128B D8AF C8              11      RET Z       ;ルートディレクトリの場合はCレジスタを0にしておく(CDEがセクタ番号)
00128C D8B0 3AC4D8          13      LD  A,(SPCPAT)
00128F D8B3 4F               4      LD  C,A
001290 D8B4 3A28E0          13      LD  A,(_SECPS)
001293 D8B7 B9               4      CP  C
001294 D8B8 3801            12      JR  C,DC1
001296 D8BA AF               4      XOR A
       D8BB                     DC1:
001297 D8BB F680             7      OR  080H
001299 D8BD 32A0E5          13      LD  (_DIRF),A   ;bit0-6:セクタインデックス
       D8C0                     CLUSTX:
00129C D8C0 E5              11      PUSH    HL
00129D D8C1 EB               4      EX  DE,HL
00129E D8C2 AF               4      XOR A
00129F D8C3 0E01             7      LD  C,1     ;自己書き換え（1クラスタの論理セクタ数）
       D8C4                     SPCPAT  EQU $-1
       D8C5                     L_CLDBL:
0012A1 D8C5 CB19             8      RR  C       ;->CF
0012A3 D8C7 3804            12      JR  C,E_CLDBL
0012A5 D8C9 29              11      ADD HL,HL       ;*2
0012A6 D8CA 8F               4      ADC A,A
0012A7 D8CB 18F8            12      JR  L_CLDBL
       D8CD                     E_CLDBL:
0012A9 D8CD 4F               4      LD  C,A
0012AA D8CE 3A28E0          13      LD  A,(_SECPS)
0012AD D8D1 B5               4      OR  L
0012AE D8D2 6F               4      LD  L,A
0012AF D8D3 110800          10      LD  DE,8    ;+8 (2D)  !ADDCL (self-modifying code)
       D8D4                     CLSPAT  EQU $-2
0012B2 D8D6 AF               4      XOR A
0012B3 D8D7 19              11      ADD HL,DE   ;データ格納領域の先頭論理セクタ番号
0012B4 D8D8 89               4      ADC A,C
0012B5 D8D9 4F               4      LD  C,A
0012B6 D8DA EB               4      EX  DE,HL
0012B7 D8DB E1              10      POP HL
0012B8 D8DC C9              10      RET
                                ;(8)
       D8DD                     ENDCL:
0012B9 D8DD 7A               4      LD  A,D ;END CLUSTER
0012BA D8DE FE01             7      CP  1   ;164=356    (self-modifying code)
       D8DF                     CLPAT1  EQU $-1
0012BC D8E0 C0              11      RET NZ
0012BD D8E1 7B               4      LD  A,E
0012BE D8E2 FE64             7      CP  064H    ;       (self-modifying code)
       D8E3                     CLPAT2  EQU $-1
0012C0 D8E4 C9              10      RET
                                ;(3)
       D8E5                     CAP4:
0012C1 D8E5 3EE5             7      LD  A,0E5H
0012C3 D8E7 C9              10      RET
                                                    ;for X1/88 ワークエリア
0012C4 D8E8 5BE5                    DW  _DISKE+1        ;DISKVE($F323)
0012C6 D8EA F5E5                    DW  _BREAK+1        ;BREAKV($F325)
                                
       D8EC                     CAP:            ;(9)
0012C8 D8EC FE61             7      CP  'a'
0012CA D8EE D8              11      RET C
0012CB D8EF FE7B             7      CP  'z'+1
0012CD D8F1 D0              11      RET NC
0012CE D8F2 D620             7      SUB 020H
0012D0 D8F4 C9              10      RET
                                ;(10)
       D8F5                     CAP2:
0012D1 D8F5 CDECD8          17      CALL    CAP
       D8F8                     CAP3:               ;
0012D4 D8F8 FE05             7      CP  5
0012D6 D8FA 28E9            12      JR  Z,CAP4
0012D8 D8FC FE21             7      CP  021H
0012DA D8FE C9              10      RET
                                                    ;
       D8FF                     CHDIR:
0012DB D8FF CDD8E2          17      CALL    GETDPBD
0012DE D902 381D            12      JR  C,CHDIR2
0012E0 D904 DD751A          19      LD  (IX+DPB_SDIR),L
0012E3 D907 DD741B          19      LD  (IX+DPB_SDIR+1),H
0012E6 D90A 1815            12      JR  CHDIR2      ;POP_IX_RET
                                
       D90C                     LDDIR:
0012E8 D90C CDD8E2          17      CALL    GETDPBD
0012EB D90F DD5E1A          19      LD  E,(IX+DPB_SDIR)
0012EE D912 DD561B          19      LD  D,(IX+DPB_SDIR+1)
0012F1 D915 13               6      INC DE
0012F2 D916 FD730E          19      LD  (IY+14),E   ;(FCB)アクセスするディレクトリのクラスタ番号+1
0012F5 D919 FD720F          19      LD  (IY+15),D
0012F8 D91C 1B               6      DEC DE
0012F9 D91D AF               4      XOR A
0012FA D91E 32A0E5          13      LD  (_DIRF),A
       D921                     CHDIR2:
0012FD D921 DDE1            14      POP IX
0012FF D923 C9              10      RET
                                
       D924                     LDDIRX:
001300 D924 3AA0E5          13      LD  A,(_DIRF)   ;(FCB)アクセスするディレクトリのセクタインデックス
001303 D927 E67F             7      AND 07FH
       D929                     LDDIRX1:
001305 D929 3228E0          13      LD  (_SECPS),A
001308 D92C FD5E0E          19      LD  E,(IY+14)   ;(FCB)アクセスするディレクトリのクラスタ番号+1
00130B D92F FD560F          19      LD  D,(IY+15)
00130E D932 1B               6      DEC DE
00130F D933 CDDDD8          17      CALL    ENDCL
001312 D936 D40CD9          17      CALL    NC,LDDIR
       D939                     LDDIRS:
001315 D939 7A               4      LD  A,D
001316 D93A B3               4      OR  E
001317 D93B 32A0E5          13      LD  (_DIRF),A   ;ディレクトリか判別
00131A D93E C9              10      RET
                                
       D93F                     KILL:
00131B D93F CD07DA          17      CALL    CHKWILDX
00131E D942 3834            12      JR  C,KILLW
001320 D944 CDE2D6          17      CALL    SOPENX
       D947                     KILLS:
001323 D947 3E1F             7      LD  A,01FH
001325 D949 D48BD9          17      CALL    NC,CHKATT
001328 D94C D8              11      RET C
       D94D                     KILLSX:
001329 D94D 36E5            10      LD  (HL),0E5H   ;DIR
00132B D94F CDE3D9          17      CALL    WTDB
00132E D952 111A00          10      LD  DE,01AH
001331 D955 19              11      ADD HL,DE
001332 D956 5E               7      LD  E,(HL)
001333 D957 23               6      INC HL
001334 D958 56               7      LD  D,(HL)
       D959                     KILLS1:
001335 D959 CDDDD8          17      CALL    ENDCL
001338 D95C D0              11      RET NC      ;CF=0
001339 D95D 21FEFF          10      LD  HL,0-2
00133C D960 19              11      ADD HL,DE
00133D D961 D0              11      RET NC      ;DE= 0 or 1
00133E D962 D5              11      PUSH    DE
00133F D963 CDF7E5          17      CALL    _GNCL
001342 D966 ED53FEE6        20      LD  (_CLPS),DE
001346 D96A D1              10      POP DE
001347 D96B 210000          10      LD  HL,0
00134A D96E D4FAE5          17      CALL    NC,_SNCL
00134D D971 D8              11      RET C
00134E D972 ED5BFEE6        20      LD  DE,(_CLPS)  ;FAT
001352 D976 18E1            12      JR  KILLS1
                                
       D978                     KILLW:
001354 D978 CD11D7          17      CALL    SOPEN
       D97B                     KILLW1:
001357 D97B 380B            12      JR  C,KILLW2
001359 D97D CDB0D7          17      CALL    SOPENE2
00135C D980 CD47D9          17      CALL    KILLS
00135F D983 CD75D7          17      CALL    NOPEN
001362 D986 18F3            12      JR  KILLW1
       D988                     KILLW2:
001364 D988 C8              11      RET Z
001365 D989 3F               4      CCF
001366 D98A C9              10      RET
                                
       D98B                     CHKATT:
001367 D98B E5              11      PUSH    HL
001368 D98C 110B00          10      LD  DE,00BH
00136B D98F 19              11      ADD HL,DE
00136C D990 A6               7      AND (HL)
00136D D991 E1              10      POP HL
00136E D992 C8              11      RET Z
00136F D993 37               4      SCF
001370 D994 C9              10      RET
                                
       D995                     NAME:
001371 D995 CD07DA          17      CALL    CHKWILDX
001374 D998 D8              11      RET C
001375 D999 110400          10      LD  DE,4
001378 D99C 19              11      ADD HL,DE
001379 D99D 22B2D9          16      LD  (NAMEP),HL
00137C D9A0 23               6      INC HL
00137D D9A1 CD0BDA          17      CALL    CHKWILD
001380 D9A4 D8              11      RET C
                                
001381 D9A5 CDE2D6          17      CALL    SOPENX
001384 D9A8 3E0F             7      LD  A,00FH
001386 D9AA D48BD9          17      CALL    NC,CHKATT
001389 D9AD D8              11      RET C
                                
00138A D9AE FDE5            15      PUSH    IY
00138C D9B0 FD210000        14      LD  IY,0        ;自己書き換え
       D9B2                     NAMEP   EQU $-2
001390 D9B4 CDE2D6          17      CALL    SOPENX
001393 D9B7 FDE3            23      EX  (SP),IY
001395 D9B9 3F               4      CCF
001396 D9BA D411D7          17      CALL    NC,SOPEN
001399 D9BD EB               4      EX  DE,HL
00139A D9BE E1              10      POP HL
00139B D9BF D8              11      RET C
                                
       D9C0                     SETNAME:
00139C D9C0 01000B          10      LD  BC,11*256
00139F D9C3 23               6      INC HL
0013A0 D9C4 7E               7      LD  A,(HL)
0013A1 D9C5 FEE5             7      CP  0E5H
0013A3 D9C7 2004            12      JR  NZ,SNAME1
0013A5 D9C9 3E05             7      LD  A,5
0013A7 D9CB 180E            12      JR  SNAME3
       D9CD                     SNAME1:
0013A9 D9CD 7E               7      LD  A,(HL)
0013AA D9CE 0C               4      INC C
0013AB D9CF 0D               4      DEC C
0013AC D9D0 2009            12      JR  NZ,SNAME3
0013AE D9D2 CDECD8          17      CALL    CAP
0013B1 D9D5 FEA0             7      CP  0A0H
0013B3 D9D7 2002            12      JR  NZ,SNAME3
0013B5 D9D9 3E20             7      LD  A,020H
       D9DB                     SNAME3:
0013B7 D9DB 12               7      LD  (DE),A
0013B8 D9DC 7E               7      LD  A,(HL)
0013B9 D9DD 23               6      INC HL
0013BA D9DE CDF4D9          17      CALL    FKAN
0013BD D9E1 10EA            13      DJNZ    SNAME1
       D9E3                     WTDB:               ;バッファデータが更新された
0013BF D9E3 3EFF             7      LD  A,0FFH
0013C1 D9E5 3239E5          13      LD  (SFILE),A
0013C4 D9E8 32A4E5          13      LD  (_WTDBF),A
0013C7 D9EB AF               4      XOR A
0013C8 D9EC C9              10      RET
                                
       D9ED                     FKANC:
0013C9 D9ED CB41             8      BIT 0,C
0013CB D9EF CCF5D8          17      CALL    Z,CAP2
0013CE D9F2 1801            12      JR  FKANX
       D9F4                     FKAN:           ;漢字チェック
0013D0 D9F4 13               6      INC DE
       D9F5                     FKANX:
0013D1 D9F5 CB41             8      BIT 0,C
0013D3 D9F7 CB81             8      RES 0,C
0013D5 D9F9 C0              11      RET NZ
0013D6 D9FA FE80             7      CP  080H
0013D8 D9FC D8              11      RET C
0013D9 D9FD FEA0             7      CP  0A0H
0013DB D9FF 3803            12      JR  C,FKAN1
0013DD DA01 FEE0             7      CP  0E0H
0013DF DA03 D8              11      RET C
       DA04                     FKAN1:
0013E0 DA04 0C               4      INC C
0013E1 DA05 A7               4      AND A
0013E2 DA06 C9              10      RET
                                
       DA07                     CHKWILDX:
0013E3 DA07 FDE5            15      PUSH    IY
0013E5 DA09 E1              10      POP HL
0013E6 DA0A 23               6      INC HL
       DA0B                     CHKWILD:
0013E7 DA0B 060B             7      LD  B,11
0013E9 DA0D 3E3F             7      LD  A,'?'
       DA0F                     CHKWIL1:
0013EB DA0F BE               7      CP  (HL)
0013EC DA10 23               6      INC HL
0013ED DA11 37               4      SCF
0013EE DA12 C8              11      RET Z
0013EF DA13 10FA            13      DJNZ    CHKWIL1
0013F1 DA15 AF               4      XOR A
0013F2 DA16 C9              10      RET
                                
       DA17                     SDIRENT:        ;IY=FCB HL=DIR
0013F3 DA17 D5              11      PUSH    DE
0013F4 DA18 E5              11      PUSH    HL
0013F5 DA19 FDE5            15      PUSH    IY
0013F7 DA1B D1              10      POP DE
0013F8 DA1C EB               4      EX  DE,HL
0013F9 DA1D CDC0D9          17      CALL    SETNAME
                                ;               Attribute
0013FC DA20 FD7E0D          19      LD  A,(IY+13)   ;(FCB)属性(アトリビュート)
0013FF DA23 12               7      LD  (DE),A
001400 DA24 13               6      INC DE
                                ;               Reserved
001401 DA25 AF               4      XOR A
001402 DA26 060A             7      LD  B,10
       DA28                     SDE1:
001404 DA28 12               7      LD  (DE),A
001405 DA29 13               6      INC DE
001406 DA2A 10FC            13      DJNZ    SDE1
                                                    ;(FCB)更新時刻
001408 DA2C 21E4E6          10      LD  HL,SDDATA       ;(FCB)更新年月日
00140B DA2F 060A             7      LD  B,SDDATAE-SDDATA    ;(FCB)ファイルの先頭クラスタ
       DA31                     SDLOOP:                 ;(FCB)ファイルのサイズ(バイト単位)
00140D DA31 7E               7      LD  A,(HL)
00140E DA32 23               6      INC HL
00140F DA33 3238DA          13      LD  (SDPAT),A
001412 DA36 FD7E00          19      LD  A,(IY+0)    ;LD A,(IY+A)
       DA38                     SDPAT   EQU $-1
001415 DA39 12               7      LD  (DE),A
001416 DA3A 13               6      INC DE
001417 DA3B 10F4            13      DJNZ    SDLOOP
                                
001419 DA3D AF               4      XOR A
00141A DA3E E1              10      POP HL
00141B DA3F D1              10      POP DE
00141C DA40 C9              10      RET
                                
       DA41                     WOPEN:
00141D DA41 FD7E0D          19      LD  A,(IY+13)   ;(FCB)属性(アトリビュート)
001420 DA44 E61F             7      AND 01FH
001422 DA46 37               4      SCF
001423 DA47 C0              11      RET NZ
001424 DA48 FD361CFE        19      LD  (IY+28),0FEH    ;(FCB)オープンモード
       DA4C                     TOPEN2:
001428 DA4C AF               4      XOR A
       DA4D                     TOPEN:              ;Initializes the time stamp
001429 DA4D FD3617FF        19      LD  (IY+23),0FFH    ;(FCB)更新時刻
00142D DA51 C9              10      RET
                                
       DA52                     WRDFX:
00142E DA52 3AC4D8          13      LD  A,(SPCPAT)  ;1クラスタの論理セクタ
       DA55                     L_WRFX:
001431 DA55 1F               4      RRA         ;->CF
001432 DA56 3806            12      JR  C,E_WRFX
001434 DA58 CB39             8      SRL C
001436 DA5A CB1C             8      RR  H       ;CH=CH/2
001438 DA5C 18F7            12      JR  L_WRFX
       DA5E                     E_WRFX:
00143A DA5E 41               4      LD  B,C
00143B DA5F 4C               4      LD  C,H
00143C DA60 03               6      INC BC
00143D DA61 3E37             7      LD  A,037H      ;SCF
00143F DA63 32AEDE          13      LD  (DRDN1),A
                                
       DA66                     WRDF:               ;BCクラスタ分FATを確保する
001442 DA66 110200          10      LD  DE,2
001445 DA69 AF               4      XOR A
001446 DA6A 3228E0          13      LD  (_SECPS),A
       DA6D                     WRDF1:
001449 DA6D C5              11      PUSH    BC
00144A DA6E D5              11      PUSH    DE
00144B DA6F CDF7E5          17      CALL    _GNCL
00144E DA72 381C            12      JR  C,WRDF3
001450 DA74 7A               4      LD  A,D     ;空いているかチェック
001451 DA75 B3               4      OR  E
001452 DA76 202A            12      JR  NZ,WRDF4
001454 DA78 E1              10      POP HL      ;HL=空いているクラスタ
001455 DA79 E5              11      PUSH    HL
001456 DA7A ED5BFEE6        20      LD  DE,(_CLPS)  ;DE=元の(_CLPS)
00145A DA7E 22FEE6          16      LD  (_CLPS),HL
00145D DA81 7A               4      LD  A,D     ;元の(_CLPS)が 0 か?
00145E DA82 B3               4      OR  E
00145F DA83 2008            12      JR  NZ,WRDF2
001461 DA85 FD751A          19      LD  (IY+26),L   ;(FCB)ファイルの先頭クラスタ
001464 DA88 FD741B          19      LD  (IY+27),H   ;元が空の場合はFCBにクラスタをセットする
001467 DA8B 1803            12      JR  WRDF3
       DA8D                     WRDF2:
001469 DA8D CDFAE5          17      CALL    _SNCL
       DA90                     WRDF3:
00146C DA90 D1              10      POP DE
00146D DA91 C1              10      POP BC
00146E DA92 D8              11      RET C
00146F DA93 0B               6      DEC BC
001470 DA94 78               4      LD  A,B
001471 DA95 B1               4      OR  C
001472 DA96 200C            12      JR  NZ,WRDF5    ;ここでループカウンタチェック
001474 DA98 ED5BFEE6        20      LD  DE,(_CLPS)
001478 DA9C 21FFFF          10      LD  HL,0FFFFH   ;FATエントリ終了(EOCマーク)
00147B DA9F C3FAE5          10      JP  _SNCL
                                
       DAA2                     WRDF4:              ;DEクラスタが空じゃないので次に移動する
00147E DAA2 D1              10      POP DE
00147F DAA3 C1              10      POP BC
       DAA4                     WRDF5:
001480 DAA4 13               6      INC DE
001481 DAA5 CDDDD8          17      CALL    ENDCL
001484 DAA8 38C3            12      JR  C,WRDF1
001486 DAAA 37               4      SCF
001487 DAAB C9              10      RET
                                
       DAAC                     RWXR:
001488 DAAC 3A9DDD          13      LD  A,(SECSZ_H) ;1024=4 / 512=2 / 256=1
       DAAF                     L_RWX:
00148B DAAF 1F               4      RRA     ;->CF
00148C DAB0 3808            12      JR  C,E_RWX
00148E DAB2 CB38             8      SRL B   ;BCH=BCH/2
001490 DAB4 CB19             8      RR  C   ;
001492 DAB6 CB1C             8      RR  H   ;
001494 DAB8 18F5            12      JR  L_RWX
       DABA                     E_RWX:
001496 DABA FD5E1A          19      LD  E,(IY+26)   ;(FCB)ファイルの先頭クラスタ
001499 DABD FD561B          19      LD  D,(IY+27)
00149C DAC0 AF               4      XOR A
00149D DAC1 3228E0          13      LD  (_SECPS),A
       DAC4                     RWX1:
0014A0 DAC4 ED53FEE6        20      LD  (_CLPS),DE
0014A4 DAC8 7A               4      LD  A,D
0014A5 DAC9 B3               4      OR  E
0014A6 DACA 2813            12      JR  Z,SCF_RET   ;RET DE==0 => CF=1
                                
0014A8 DACC 78               4      LD  A,B
0014A9 DACD B1               4      OR  C
0014AA DACE B4               4      OR  H
0014AB DACF C8              11      RET Z       ;RET BCH==0 => CF=0
                                
0014AC DAD0 CD30E0          17      CALL    GNCLX
0014AF DAD3 D8              11      RET C
0014B0 DAD4 7C               4      LD  A,H     ;
0014B1 DAD5 25               4      DEC H       ;
0014B2 DAD6 B7               4      OR  A       ;DEC BCH
0014B3 DAD7 2001            12      JR  NZ,RWX2     ;
0014B5 DAD9 0B               6      DEC BC      ;
       DADA                     RWX2:
0014B6 DADA CDDDD8          17      CALL    ENDCL
0014B9 DADD 38E5            12      JR  C,RWX1
       DADF                     SCF_RET:
0014BB DADF 37               4      SCF
0014BC DAE0 C9              10      RET
                                
       DAE1                     DSKF:
0014BD DAE1 110000          10      LD  DE,0
       DAE2                     MAXCLP  EQU $-2
0014C0 DAE4 2AACE5          16      LD  HL,(_FAKEFREE)
0014C3 DAE7 7C               4      LD  A,H
0014C4 DAE8 B5               4      OR  L
0014C5 DAE9 2803            12      JR  Z,DSKF1
0014C7 DAEB 110100          10      LD  DE,1
       DAEE                     DSKF1:
0014CA DAEE D5              11      PUSH    DE
0014CB DAEF CDF7E5          17      CALL    _GNCL
0014CE DAF2 380C            12      JR  C,POPSCF
0014D0 DAF4 7A               4      LD  A,D
0014D1 DAF5 B3               4      OR  E
0014D2 DAF6 2001            12      JR  NZ,DSKF2
0014D4 DAF8 23               6      INC HL
       DAF9                     DSKF2:
0014D5 DAF9 D1              10      POP DE
0014D6 DAFA 1B               6      DEC DE
0014D7 DAFB 7A               4      LD  A,D
0014D8 DAFC B3               4      OR  E
0014D9 DAFD 20EF            12      JR  NZ,DSKF1
0014DB DAFF C9              10      RET
                                
       DB00                     POPSCF:
0014DC DB00 F1              10      POP AF
0014DD DB01 37               4      SCF
0014DE DB02 C9              10      RET
                                
       DB03                     SETTMS:
0014DF DB03 FD7E17          19      LD  A,(IY+23)   ;(FCB)ファイルを最後に変更した時刻
0014E2 DB06 3C               4      INC A
0014E3 DB07 C0              11      RET NZ      ;ファイルが更新されていない
       DB08                     SETTMSX:            ;FCBに日付時刻をセットする
0014E4 DB08 CDCBD2          17      CALL    _SYS2C      ;(BDOS)時刻の獲得
                                                ;H←時  L←分  D←秒
0014E7 DB0B CB25             8      SLA L       ;   *2
0014E9 DB0D CB25             8      SLA L       ;   *4
0014EB DB0F 29              11      ADD HL,HL       ;*2 *8
0014EC DB10 29              11      ADD HL,HL       ;*4 *16
0014ED DB11 29              11      ADD HL,HL       ;*8 *32
0014EE DB12 7A               4      LD  A,D
0014EF DB13 0F               4      RRCA            ;bit.0->7->->->0->C
0014F0 DB14 E61F             7      AND 01FH
0014F2 DB16 B5               4      OR  L
0014F3 DB17 FD7716          19      LD  (IY+22),A   ;(FCB)ファイルを最後に変更した時刻
0014F6 DB1A FD7417          19      LD  (IY+23),H
                                
0014F9 DB1D CD7BD2          17      CALL    _SYS2A      ;(BDOS)日付の獲得
                                                ;HL←年  D←月  E←日
0014FC DB20 0144F8          10      LD  BC,0-1980
0014FF DB23 09              11      ADD HL,BC
001500 DB24 65               4      LD  H,L
                                
001501 DB25 7A               4      LD  A,D
001502 DB26 87               4      ADD A,A     ;*2
001503 DB27 87               4      ADD A,A     ;*4
001504 DB28 87               4      ADD A,A     ;*8
001505 DB29 87               4      ADD A,A     ;*16
001506 DB2A 6F               4      LD  L,A
001507 DB2B 29              11      ADD HL,HL       ;*32
001508 DB2C 7D               4      LD  A,L
001509 DB2D B3               4      OR  E
00150A DB2E FD7714          19      LD  (IY+20),A   ;(FCB)ファイルを最後に変更した日付
00150D DB31 FD7415          19      LD  (IY+21),H
001510 DB34 C9              10      RET
                                ;(16)
       DB35                     PUSHRR:
001511 DB35 3261DE          13      LD  (SETSEQ_SWC_RND),A
001514 DB38 2273DE          16      LD  (SETSEQ_SWC_SEQ_RR),HL
001517 DB3B CD5BDB          17      CALL    GET_RR_AHL
00151A DB3E 220FE5          16      LD  (RR_BUF_HL),HL
00151D DB41 3211E5          13      LD  (RR_BUF_A),A
001520 DB44 C9              10      RET
                                ;(14)
       DB45                     GET_CPM_R_SIZE:     ;バイト単位からCP/Mのレコード単位を求める（1レコード=128バイト）
001521 DB45 87               4      ADD A,A     ;in BHLA => out AHL
001522 DB46 ED6A            15      ADC HL,HL
001524 DB48 CB18             8      RR  B
001526 DB4A B7               4      OR  A
001527 DB4B 78               4      LD  A,B     ;ここでフラグは変化しない
001528 DB4C C8              11      RET Z
001529 DB4D 2C               4      INC L       ;INC AHL
00152A DB4E C0              11      RET NZ      ;
00152B DB4F 24               4      INC H       ;
00152C DB50 C0              11      RET NZ      ;
00152D DB51 3C               4      INC A       ;
00152E DB52 C9              10      RET
                                ;(18)
       DB53                     INIT_RND:
00152F DB53 3ECD             7      LD  A,0CDH      ;CALL ????
001531 DB55 2172DB          10      LD  HL,POPRR
001534 DB58 CD35DB          17      CALL    PUSHRR
       DB5B                     GET_RR_AHL:
001537 DB5B FD6E21          19      LD  L,(IY+33)   ;(FCB)Random record
00153A DB5E FD6622          19      LD  H,(IY+34)   ;
00153D DB61 FD7E23          19      LD  A,(IY+35)   ;
001540 DB64 C9              10      RET
                                ;(10)
       DB65                     SET_RR_AHL:
001541 DB65 FD7521          19      LD  (IY+33),L   ;(FCB)Random record
001544 DB68 FD7422          19      LD  (IY+34),H   ;
001547 DB6B FD7723          19      LD  (IY+35),A   ;
00154A DB6E C9              10      RET
                                ;(17)
       DB6F                     SETSEQ:
00154B DB6F CD94DB          17      CALL    SETSEQ1
       DB72                     POPRR:
00154E DB72 F5              11      PUSH    AF
00154F DB73 E5              11      PUSH    HL
001550 DB74 2A0FE5          16      LD  HL,(RR_BUF_HL)
001553 DB77 3A11E5          13      LD  A,(RR_BUF_A)
001556 DB7A CD65DB          17      CALL    SET_RR_AHL
001559 DB7D E1              10      POP HL
00155A DB7E F1              10      POP AF
00155B DB7F C9              10      RET
                                ;(20)
       DB80                     GET_RR_BCDE:            ;BCDE=Random record
00155C DB80 FD5E21          19      LD  E,(IY+33)   ;(FCB)ランダムレコード
00155F DB83 FD5622          19      LD  D,(IY+34)
001562 DB86 FD4E23          19      LD  C,(IY+35)
001565 DB89 0600             7      LD  B,0     ;CP/M互換のアクセスの場合はFCBは36バイト
001567 DB8B FDCB207E        20      BIT 7,(IY+32)   ;(FCB)カレントレコード
00156B DB8F C0              11      RET NZ
00156C DB90 FD4624          19      LD  B,(IY+36)
00156F DB93 C9              10      RET
                                
       DB94                     SETSEQ1:
001570 DB94 F5              11      PUSH    AF
001571 DB95 E5              11      PUSH    HL      ;AHL=Random record
001572 DB96 CD5BDB          17      CALL    GET_RR_AHL
001575 DB99 47               4      LD  B,A     ;AHL→HLA
001576 DB9A 7D               4      LD  A,L     ;(IY+33)(FCB)ランダムレコード
001577 DB9B 6C               4      LD  L,H     ;(IY+34)
001578 DB9C 60               4      LD  H,B     ;(IY+35)
001579 DB9D 0600             7      LD  B,0
                                
00157B DB9F CD45DB          17      CALL    GET_CPM_R_SIZE
                                
00157E DBA2 29              11      ADD HL,HL
00157F DBA3 CB3D             8      SRL L       ;L=L/2
001581 DBA5 FD7520          19      LD  (IY+32),L   ;(FCB)カレントレコード
001584 DBA8 FD740C          19      LD  (IY+12),H   ;(FCB)カレントブロック
001587 DBAB E1              10      POP HL
001588 DBAC F1              10      POP AF
001589 DBAD C9              10      RET
                                
                                ;(23)
       DBAE                     RBXEND:             ;レコード数だけランダムレコードを進める
00158A DBAE 110000          10      LD  DE,0        ;進めるレコード数(RBSIZE)
       DBAF                     RBSIZE  EQU $-2
00158D DBB1 CD5BDB          17      CALL    GET_RR_AHL
001590 DBB4 19              11      ADD HL,DE
001591 DBB5 CE00             7      ADC A,0
001593 DBB7 CD65DB          17      CALL    SET_RR_AHL
001596 DBBA EB               4      EX  DE,HL       ;HL=進めるレコード数
001597 DBBB D0              11      RET NC
001598 DBBC FDCB207E        20      BIT 7,(IY+32)   ;(FCB)カレントレコード
00159C DBC0 C0              11      RET NZ
00159D DBC1 FD3424          23      INC (IY+36)
0015A0 DBC4 C9              10      RET
       DBC5                     FILE_E:
                                
       D76F                     _SYS03  EQU SCF_FF_RET  ;(BDOS)外部入力
       D76F                     _SYS2B  EQU SCF_FF_RET  ;(BDOS)日付の設定
       D76F                     _SYS2D  EQU SCF_FF_RET  ;(BDOS)時刻の設定
       D76F                     _SYS39  EQU SCF_FF_RET  ;(BDOS)サブディレクトリの作成
       D76F                     _SYS3A  EQU SCF_FF_RET  ;(BDOS)サブディレクトリの削除
                                
[EOF:LDFILE.ASM:SHIFT_JIS]
                                    INCLUDE "LDFILE2.ASM"
                                
                                ;   LSX-Dodgers FILE2
                                
                                                ;Write random block
       DBC5                     _SYS26:     ;(BDOS)ランダムブロック書き込み
0015A1 DBC5 AF               4      XOR A
0015A2 DBC6 32AEDE          13      LD  (DRDN1),A   ;NOP
0015A5 DBC9 22AFDB          16      LD  (RBSIZE),HL ;HL←書き込むレコード数
0015A8 DBCC 225DE5          16      LD  (LEFTX),HL
0015AB DBCF CDB8D6          17      CALL    SETDRV
                                
0015AE DBD2 CD38DD          17      CALL    RBX0
0015B1 DBD5 DA62DC          10      JP  C,RBWERR
0015B4 DBD8 CD41DA          17      CALL    WOPEN
0015B7 DBDB DA62DC          10      JP  C,RBWERR
0015BA DBDE 7C               4      LD  A,H
0015BB DBDF B5               4      OR  L
0015BC DBE0 CA5BDC          10      JP  Z,RBW1
                                
0015BF DBE3 2B               6      DEC HL
                                
0015C0 DBE4 CD80DB          17      CALL    GET_RR_BCDE ;BCDE=Random record
                                
0015C3 DBE7 19              11      ADD HL,DE       ;BCHL=HL+BCDE
0015C4 DBE8 3001            12      JR  NC,S26X1    ;
0015C6 DBEA 03               6      INC BC      ;
       DBEB                     S26X1:
0015C7 DBEB CDACDA          17      CALL    RWXR
0015CA DBEE DC52DA          17      CALL    C,WRDFX
0015CD DBF1 DA62DC          10      JP  C,RBWERR
                                
0015D0 DBF4 CD67DD          17      CALL    RBX2
0015D3 DBF7 281A            12      JR  Z,RBWB      ;NZ=セクタ以下の端数がある
0015D5 DBF9 CD86DD          17      CALL    RBXA
0015D8 DBFC 3864            12      JR  C,RBWERR
0015DA DBFE EB               4      EX  DE,HL
0015DB DBFF C5              11      PUSH    BC
0015DC DC00 EDB0                    LDIR
0015DE DC02 225FE5          16      LD  (DTAX),HL
                                
0015E1 DC05 CDE3D9          17      CALL    WTDB        ;バッファデータは更新された
                                
0015E4 DC08 2A5DE5          16      LD  HL,(LEFTX)
0015E7 DC0B D1              10      POP DE
0015E8 DC0C ED52            15      SBC HL,DE
0015EA DC0E 225DE5          16      LD  (LEFTX),HL
0015ED DC11 2831            12      JR  Z,RBWEND
                                
       DC13                     RBWB:
0015EF DC13 CDBBDD          17      CALL    RBXB
0015F2 DC16 2814            12      JR  Z,RBWC
       DC18                     RBWB1:
0015F4 DC18 C5              11      PUSH    BC
0015F5 DC19 D5              11      PUSH    DE
0015F6 DC1A CDC0D8          17      CALL    CLUSTX
0015F9 DC1D CDDFDD          17      CALL    DWTC
0015FC DC20 D1              10      POP DE
0015FD DC21 C1              10      POP BC
0015FE DC22 D430E0          17      CALL    NC,GNCLX
001601 DC25 383B            12      JR  C,RBWERR
001603 DC27 10EF            13      DJNZ    RBWB1
001605 DC29 CD2FDE          17      CALL    DRW_FLUSH
       DC2C                     RBWC:
001608 DC2C CDD3DD          17      CALL    RBXC
00160B DC2F 2813            12      JR  Z,RBWEND
00160D DC31 C5              11      PUSH    BC
00160E DC32 CDC0D8          17      CALL    CLUSTX
001611 DC35 CDADDE          17      CALL    DRDN
001614 DC38 C1              10      POP BC
001615 DC39 3827            12      JR  C,RBWERR
001617 DC3B ED5B7EE6        20      LD  DE,(_DTBUF)
00161B DC3F EDB0                    LDIR
00161D DC41 CDE3D9          17      CALL    WTDB        ;バッファデータは更新された
       DC44                     RBWEND:
001620 DC44 CDAEDB          17      CALL    RBXEND
                                
001623 DC47 CD47DD          17      CALL    RBX1
001626 DC4A 300F            12      JR  NC,RBW1     ;ランダムレコードの方が大きい場合はサイズを合わせる
001628 DC4C CD80DB          17      CALL    GET_RR_BCDE ;BCDE=Random record
00162B DC4F FD7310          19      LD  (IY+16),E   ;ファイルのサイズ(バイト単位)
00162E DC52 FD7211          19      LD  (IY+17),D   ;
001631 DC55 FD7112          19      LD  (IY+18),C   ;
001634 DC58 FD7013          19      LD  (IY+19),B   ;
       DC5B                     RBW1:
001637 DC5B FDE1            14      POP IY
001639 DC5D C1              10      POP BC
00163A DC5E D1              10      POP DE
00163B DC5F E1              10      POP HL
       DC60                     DD_NUL:
00163C DC60 AF               4      XOR A
       DC61                     DRDF0:
       DC61                     DWTF0:
00163D DC61 C9              10      RET
                                
       DC62                     RBWERR:
00163E DC62 FDE5            15      PUSH    IY
001640 DC64 D1              10      POP DE
001641 DC65 0E10             7      LD  C,010H      ;(BDOS)ファイルのクローズ
001643 DC67 CD42CE          17      CALL    BDOS0
       DC6A                     RBRERR1:
001646 DC6A 3E01             7      LD  A,001H
       DC6C                     RBRERR2:
001648 DC6C FDE1            14      POP IY
00164A DC6E C1              10      POP BC
00164B DC6F D1              10      POP DE
00164C DC70 E1              10      POP HL
00164D DC71 37               4      SCF
00164E DC72 210000          10      LD  HL,0
001651 DC75 C9              10      RET
                                
       DC76                     RBRERR:
001652 DC76 3EFF             7      LD  A,0FFH
001654 DC78 18F2            12      JR  RBRERR2
                                
       DC7A                     RBRFL:
001656 DC7A 3E00             7  RBRFLP: LD  A,000H
001658 DC7C FE0D             7      CP  00DH
00165A DC7E 2005            12      JR  NZ,RBRFL1
00165C DC80 D5              11      PUSH    DE
00165D DC81 1E0A             7      LD  E,00AH
00165F DC83 1805            12      JR  RBRFL2
       DC85                     RBRFL1:
001661 DC85 D5              11      PUSH    DE
001662 DC86 CD09E5          17      CALL    _SYS07
001665 DC89 5F               4      LD  E,A
       DC8A                     RBRFL2:
001666 DC8A CDCDE5          17      CALL    _PRINT
001669 DC8D 7B               4      LD  A,E
00166A DC8E D1              10      POP DE
00166B DC8F 327BDC          13      LD  (RBRFLP+1),A
00166E DC92 C9              10      RET
                                
                                                ;Read random block
       DC93                     _SYS27:     ;(BDOS)ランダムブロック読み込み
00166F DC93 225DE5          16      LD  (LEFTX),HL
001672 DC96 CDB8D6          17      CALL    SETDRV
                                
001675 DC99 FDCB0D66        20      BIT 4,(IY+13)   ;(FCB)属性(アトリビュート)
001679 DC9D C226DD          10      JP  NZ,RBRDIR   ;ディレクトリ
00167C DCA0 CD38DD          17      CALL    RBX0
00167F DCA3 DA76DC          10      JP  C,RBRERR
001682 DCA6 CD47DD          17      CALL    RBX1
001685 DCA9 D45FDD          17      CALL    NC,RBX1R
001688 DCAC DA6ADC          10      JP  C,RBRERR1
00168B DCAF EB               4      EX  DE,HL
00168C DCB0 ED52            15      SBC HL,DE       ;CP 00HL,BCDE
00168E DCB2 19              11      ADD HL,DE
00168F DCB3 79               4      LD  A,C
001690 DCB4 DE00             7      SBC A,0
001692 DCB6 78               4      LD  A,B
001693 DCB7 DE00             7      SBC A,0
001695 DCB9 3801            12      JR  C,RBR1
001697 DCBB EB               4      EX  DE,HL
       DCBC                     RBR1:
001698 DCBC 9F               4      SBC A,A
001699 DCBD E601             7      AND 1
00169B DCBF 3224DD          13      LD  (RBRA_SWC),A
                                
00169E DCC2 7C               4      LD  A,H
00169F DCC3 B5               4      OR  L
0016A0 DCC4 2857            12      JR  Z,RBREND0
                                
0016A2 DCC6 22AFDB          16      LD  (RBSIZE),HL ;HL←読み込むレコード数
0016A5 DCC9 225DE5          16      LD  (LEFTX),HL
                                
0016A8 DCCC CD67DD          17      CALL    RBX2
0016AB DCCF 2819            12      JR  Z,RBRB
0016AD DCD1 CD86DD          17      CALL    RBXA
0016B0 DCD4 DA76DC          10      JP  C,RBRERR
0016B3 DCD7 C5              11      PUSH    BC
0016B4 DCD8 EDB0                    LDIR
0016B6 DCDA ED535FE5        20      LD  (DTAX),DE
0016BA DCDE 2A5DE5          16      LD  HL,(LEFTX)
0016BD DCE1 D1              10      POP DE
0016BE DCE2 A7               4      AND A
0016BF DCE3 ED52            15      SBC HL,DE
0016C1 DCE5 225DE5          16      LD  (LEFTX),HL
0016C4 DCE8 2830            12      JR  Z,RBREND
                                
       DCEA                     RBRB:
0016C6 DCEA CDBBDD          17      CALL    RBXB
0016C9 DCED 2815            12      JR  Z,RBRC
       DCEF                     RBRB1:
0016CB DCEF C5              11      PUSH    BC
0016CC DCF0 D5              11      PUSH    DE
0016CD DCF1 CDC0D8          17      CALL    CLUSTX
0016D0 DCF4 CDE5DD          17      CALL    DRDC
0016D3 DCF7 D1              10      POP DE
0016D4 DCF8 C1              10      POP BC
0016D5 DCF9 D430E0          17      CALL    NC,GNCLX
0016D8 DCFC DA76DC          10      JP  C,RBRERR
0016DB DCFF 10EE            13      DJNZ    RBRB1
0016DD DD01 CD2FDE          17      CALL    DRW_FLUSH
       DD04                     RBRC:
0016E0 DD04 CDD3DD          17      CALL    RBXC
0016E3 DD07 2811            12      JR  Z,RBREND
0016E5 DD09 C5              11      PUSH    BC
0016E6 DD0A CDC0D8          17      CALL    CLUSTX
0016E9 DD0D CD91DE          17      CALL    DRDX
0016EC DD10 C1              10      POP BC
0016ED DD11 DA76DC          10      JP  C,RBRERR
0016F0 DD14 EB               4      EX  DE,HL
0016F1 DD15 2A7EE6          16      LD  HL,(_DTBUF)
0016F4 DD18 EDB0                    LDIR
       DD1A                     RBREND:
0016F6 DD1A CDAEDB          17      CALL    RBXEND
       DD1D                     RBREND0:
0016F9 DD1D FDE1            14      POP IY
0016FB DD1F C1              10      POP BC
0016FC DD20 D1              10      POP DE
0016FD DD21 F1              10      POP AF  ;(HL)
0016FE DD22 AF               4      XOR A
0016FF DD23 3E00             7      LD  A,000H
       DD24                     RBRA_SWC    EQU $-1
001701 DD25 C9              10      RET
                                
       DD26                     RBRDIR:
001702 DD26 FD6E1A          19      LD  L,(IY+26)   ;(FCB)ファイルの先頭クラスタ
001705 DD29 FD661B          19      LD  H,(IY+27)
001708 DD2C CDFFD8          17      CALL    CHDIR
00170B DD2F AF               4      XOR A
00170C DD30 67               4      LD  H,A
00170D DD31 6F               4      LD  L,A
00170E DD32 3C               4      INC A
00170F DD33 3224DD          13      LD  (RBRA_SWC),A
001712 DD36 18E5            12      JR  RBREND0
                                ;(15)
       DD38                     RBX0:
001714 DD38 2A8AE5          16      LD  HL,(_DTA)
001717 DD3B 225FE5          16      LD  (DTAX),HL
00171A DD3E 2A5DE5          16      LD  HL,(LEFTX)
00171D DD41 FD7E1C          19      LD  A,(IY+28)   ;(FCB)オープンモード
001720 DD44 D6FD             7      SUB 0FDH
001722 DD46 C9              10      RET
                                
       DD47                     RBX1:               ;ファイルサイズとランダムレコードを比べる
001723 DD47 E5              11      PUSH    HL      ;Record byte
                                                ;AHL=File size
001724 DD48 FD6E10          19      LD  L,(IY+16)   ;ファイルのサイズ(バイト単位)
001727 DD4B FD6611          19      LD  H,(IY+17)   ;
00172A DD4E FD7E12          19      LD  A,(IY+18)   ;
                                
00172D DD51 CD80DB          17      CALL    GET_RR_BCDE ;BCDE=Random record
                                
001730 DD54 A7               4      AND A
001731 DD55 ED52            15      SBC HL,DE
001733 DD57 99               4      SBC A,C
001734 DD58 4F               4      LD  C,A
001735 DD59 FD7E13          19      LD  A,(IY+19)   ;ファイルのサイズ
001738 DD5C 98               4      SBC A,B
001739 DD5D D1              10      POP DE
00173A DD5E C9              10      RET
       DD5F                     RBX1R:              ;(8)
00173B DD5F 47               4      LD  B,A
00173C DD60 B1               4      OR  C
00173D DD61 EB               4      EX  DE,HL   ;BCDE=File byte HL=Record byte
00173E DD62 B2               4      OR  D
00173F DD63 B3               4      OR  E
001740 DD64 C0              11      RET NZ
001741 DD65 37               4      SCF
001742 DD66 C9              10      RET
                                
       DD67                     RBX2:               ;Cluster settings
001743 DD67 FD6622          19      LD  H,(IY+34)   ;(+33)(FCB)ランダムレコード
001746 DD6A FD4E23          19      LD  C,(IY+35)
001749 DD6D 0600             7      LD  B,0
00174B DD6F FDCB207E        20      BIT 7,(IY+32)   ;(FCB)カレントレコード
00174F DD73 2003            12      JR  NZ,RBX3
001751 DD75 FD4624          19      LD  B,(IY+36)
       DD78                     RBX3:
001754 DD78 CDACDA          17      CALL    RWXR
001757 DD7B 3A9DDD          13      LD  A,(SECSZ_H) ;1024=4 / 512=2 / 256=1
00175A DD7E 3D               4      DEC A
00175B DD7F FDA622          19      AND (IY+34)
00175E DD82 FDB621          19      OR  (IY+33)
001761 DD85 C9              10      RET
                                
       DD86                     RBXA:
001762 DD86 C5              11      PUSH    BC
001763 DD87 D5              11      PUSH    DE
001764 DD88 CDC0D8          17      CALL    CLUSTX
001767 DD8B CD91DE          17      CALL    DRDX
00176A DD8E D1              10      POP DE
00176B DD8F C1              10      POP BC
00176C DD90 D430E0          17      CALL    NC,GNCLX
00176F DD93 D8              11      RET C
001770 DD94 ED53FEE6        20      LD  (_CLPS),DE
                                
001774 DD98 FD4E21          19      LD  C,(IY+33)   ;(FCB)ランダムレコード
001777 DD9B 210004          10      LD  HL,0400H    ;自己書き換え 1024=0400H / 512=0200H ここに1セクタのサイズが格納される
       DD9C                     SECSZ   EQU $-2
       DD9D                     SECSZ_H EQU $-1
00177A DD9E 7C               4      LD  A,H
00177B DD9F 3D               4      DEC A       ;1024=3 / 512=1
00177C DDA0 FDA622          19      AND (IY+34)     ;(FCB)ランダムレコード
00177F DDA3 47               4      LD  B,A     ;BCに1セクタ以下の端数が入る
001780 DDA4 ED42            15      SBC HL,BC       ;残りを計算
                                
001782 DDA6 ED5B5DE5        20      LD  DE,(LEFTX)
001786 DDAA ED52            15      SBC HL,DE       ;CP HL,DE
001788 DDAC 19              11      ADD HL,DE       ;
001789 DDAD 3801            12      JR  C,RBXA1     ;DEとHLを比較して大きい方をHLに
00178B DDAF EB               4      EX  DE,HL
       DDB0                     RBXA1:
00178C DDB0 E5              11      PUSH    HL
00178D DDB1 2A7EE6          16      LD  HL,(_DTBUF)
001790 DDB4 09              11      ADD HL,BC
001791 DDB5 ED5B5FE5        20      LD  DE,(DTAX)
001795 DDB9 C1              10      POP BC
001796 DDBA C9              10      RET
                                
       DDBB                     RBXB:
001797 DDBB 2A5FE5          16      LD  HL,(DTAX)
00179A DDBE ED5BFEE6        20      LD  DE,(_CLPS)
00179E DDC2 3A5EE5          13      LD  A,(LEFTX+1)
0017A1 DDC5 47               4      LD  B,A
0017A2 DDC6 3A9DDD          13      LD  A,(SECSZ_H) ;1024=4 / 512=2 / 256=1
       DDC9                     RBXB1:
0017A5 DDC9 1F               4      RRA     ;->CF
0017A6 DDCA 3804            12      JR  C,RBXB2
0017A8 DDCC CB38             8      SRL B   ;B=B/2
0017AA DDCE 18F9            12      JR  RBXB1
       DDD0                     RBXB2:
0017AC DDD0 78               4      LD  A,B
0017AD DDD1 B7               4      OR  A
0017AE DDD2 C9              10      RET
                                ;(12)
       DDD3                     RBXC:
0017AF DDD3 ED4B5DE5        20      LD  BC,(LEFTX)
0017B3 DDD7 3A9DDD          13      LD  A,(SECSZ_H) ;1024=4 / 512=2 / 256=1
0017B6 DDDA 3D               4      DEC A
0017B7 DDDB A0               4      AND B
0017B8 DDDC 47               4      LD  B,A     ;1セクタ以下の端数がない場合はZ
0017B9 DDDD B1               4      OR  C
0017BA DDDE C9              10      RET
                                
                                ;   ランダムブロックアクセスの連続したセクタをまとめる
                                
       DDDF                     DWTC:
0017BB DDDF E5              11      PUSH    HL
0017BC DDE0 21C9E1          10      LD  HL,DWT24B
0017BF DDE3 1804            12      JR  DWTC1
       DDE5                     DRDC:
0017C1 DDE5 E5              11      PUSH    HL
0017C2 DDE6 21BBE1          10      LD  HL,DRD24B
       DDE9                     DWTC1:
0017C5 DDE9 2243DE          16      LD  (DRWF_MODE),HL
0017C8 DDEC E1              10      POP HL
0017C9 DDED 3A33DE          13      LD  A,(DRWF_B)
0017CC DDF0 B7               4      OR  A
0017CD DDF1 200F            12      JR  NZ,DRDC1
       DDF3                     SAVE_DRWC:
0017CF DDF3 0601             7      LD  B,1
0017D1 DDF5 ED4332DE        20      LD  (DRWF_C),BC
0017D5 DDF9 ED5339DE        20      LD  (DRWF_E),DE
0017D9 DDFD 223CDE          16      LD  (DRWF_HL),HL
0017DC DE00 1820            12      JR  INC_HL_DRWC
       DE02                     DRDC1:
0017DE DE02 E5              11      PUSH    HL
0017DF DE03 2139DE          10      LD  HL,DRWF_E
0017E2 DE06 86               7      ADD A,(HL)
0017E3 DE07 F5              11      PUSH    AF
0017E4 DE08 BB               4      CP  E
0017E5 DE09 201D            12      JR  NZ,DRDC2
0017E7 DE0B F1              10      POP AF
0017E8 DE0C 23               6      INC HL
0017E9 DE0D 7E               7      LD  A,(HL)
0017EA DE0E CE00             7      ADC A,0
0017EC DE10 F5              11      PUSH    AF
0017ED DE11 BA               4      CP  D
0017EE DE12 2014            12      JR  NZ,DRDC2
0017F0 DE14 F1              10      POP AF
0017F1 DE15 3A32DE          13      LD  A,(DRWF_C)
0017F4 DE18 CE00             7      ADC A,0
0017F6 DE1A B9               4      CP  C
0017F7 DE1B 200C            12      JR  NZ,DRDC3
0017F9 DE1D 2133DE          10      LD  HL,DRWF_B
0017FC DE20 34              11      INC (HL)
0017FD DE21 E1              10      POP HL
       DE22                     INC_HL_DRWC:
0017FE DE22 3A9DDD          13      LD  A,(SECSZ_H)     ;1セクタのサイズの上位1バイト
001801 DE25 84               4      ADD A,H
001802 DE26 67               4      LD  H,A
001803 DE27 C9              10      RET
       DE28                     DRDC2:
001804 DE28 F1              10      POP AF
       DE29                     DRDC3:
001805 DE29 CD2FDE          17      CALL    DRW_FLUSH
001808 DE2C E1              10      POP HL
001809 DE2D 18C4            12      JR  SAVE_DRWC
                                
                                ;   ランダムブロックアクセスの連続したセクタをまとめたものをフラッシュする
       DE2F                     DRW_FLUSH:
00180B DE2F C5              11      PUSH    BC
00180C DE30 D5              11      PUSH    DE
00180D DE31 010000          10      LD  BC,0
       DE32                     DRWF_C  EQU $-2
       DE33                     DRWF_B  EQU $-1
001810 DE34 78               4      LD  A,B
001811 DE35 B7               4      OR  A
001812 DE36 280D            12      JR  Z,DRDF1
001814 DE38 110000          10      LD  DE,0
       DE39                     DRWF_E  EQU $-2
       DE3A                     DRWF_D  EQU $-1
001817 DE3B 210000          10      LD  HL,0
       DE3C                     DRWF_HL EQU $-2
00181A DE3E AF               4      XOR A
00181B DE3F 3233DE          13      LD  (DRWF_B),A
00181E DE42 CDBBE1          17      CALL    DRD24B
       DE43                     DRWF_MODE   EQU $-2
       DE45                     DRDF1:
001821 DE45 D1              10      POP DE
001822 DE46 C1              10      POP BC
001823 DE47 C9              10      RET
                                
       DE48                     RB_WRITE:
001824 DE48 C5              11      PUSH    BC
001825 DE49 0E26             7      LD  C,026H      ;(BDOS)ランダムブロック書き込み
001827 DE4B 1803            12      JR  RBRW
       DE4D                     RB_READ:
001829 DE4D C5              11      PUSH    BC
00182A DE4E 0E27             7      LD  C,027H      ;(BDOS)ランダムブロック読み込み
       DE50                     RBRW:
00182C DE50 1F               4      RRA     ;AHL = AHL*128
00182D DE51 7C               4      LD  A,H ;AHL = AHL0/2
00182E DE52 1F               4      RRA     ;A
00182F DE53 65               4      LD  H,L ;
001830 DE54 CB1C             8      RR  H   ;H
001832 DE56 2E00             7      LD  L,0 ;
001834 DE58 CB1D             8      RR  L   ;L
001836 DE5A CD65DB          17      CALL    SET_RR_AHL
001839 DE5D 218000          10      LD  HL,128
00183C DE60 C5              11      PUSH    BC
       DE61                     SETSEQ_SWC_RND:
00183D DE61 CD94DB          17      CALL    SETSEQ1     ;CALL SETSEQ1 or LD BC,SETSEQ1
001840 DE64 C1              10      POP BC
001841 DE65 FDCB20FE        23      SET 7,(IY+32)   ;(FCB)カレントレコード
001845 DE69 FDE5            15      PUSH    IY
001847 DE6B D1              10      POP DE
001848 DE6C D5              11      PUSH    DE
001849 DE6D CD42CE          17      CALL    BDOS0
00184C DE70 FDE1            14      POP IY
00184E DE72 CD6FDB          17      CALL    SETSEQ      ;SETSEQ or POPRR
       DE73                     SETSEQ_SWC_SEQ_RR   EQU $-2
001851 DE75 FDCB20BE        23      RES 7,(IY+32)   ;(FCB)カレントレコード
                                
001855 DE79 C1              10      POP BC
001856 DE7A C9              10      RET
                                
                                ;(22)
       DE7B                     INIT_SEQ:
001857 DE7B 3E01             7      LD  A,1     ;LD BC,????
001859 DE7D 216FDB          10      LD  HL,SETSEQ
00185C DE80 CD35DB          17      CALL    PUSHRR
       DE83                     GETSEQ:
00185F DE83 FD6E20          19      LD  L,(IY+32)   ;(FCB)カレントレコード
001862 DE86 FD660C          19      LD  H,(IY+12)   ;(FCB)カレントブロック
001865 DE89 AF               4      XOR A
                                
001866 DE8A CB25             8      SLA L   ;L=L*2
                                
001868 DE8C CB3C             8      SRL H   ;HL=HL/2
00186A DE8E CB1D             8      RR  L   ;
00186C DE90 C9              10      RET
[EOF:LDFILE2.ASM:SHIFT_JIS]
                                    INCLUDE "LDDIO.ASM"
                                
                                ;   LSX-Dodgers DIO
                                
       DE91                     DRDX:
00186D DE91 CDCFDE          17      CALL    DRDY
001870 DE94 C8              11      RET Z
001871 DE95 CDB5DE          17      CALL    DRDX1       ;データバッファの情報を保存
001874 DE98 D8              11      RET C
001875 DE99 E5              11      PUSH    HL
001876 DE9A C5              11      PUSH    BC
001877 DE9B D5              11      PUSH    DE
001878 DE9C 2A7EE6          16      LD  HL,(_DTBUF)
00187B DE9F 3AF8DE          13      LD  A,(_DBS24)
00187E DEA2 4F               4      LD  C,A
00187F DEA3 CDB9E1          17      CALL    DRD24
001882 DEA6 DCCADE          17      CALL    C,DRDNE
       DEA9                     POP_DE_BC_HL_RET:
001885 DEA9 D1              10      POP DE
001886 DEAA C1              10      POP BC
001887 DEAB E1              10      POP HL
001888 DEAC C9              10      RET
                                
                                ;   CDE:セクタ番号
       DEAD                     DRDN:
001889 DEAD AF               4      XOR A
00188A DEAE 00               4  DRDN1:  NOP         ;自己書き換え NOP / SCF
00188B DEAF 30E0            12      JR  NC,DRDX
       DEB1                     DRDNX:
00188D DEB1 CDCFDE          17      CALL    DRDY
001890 DEB4 C8              11      RET Z
       DEB5                     DRDX1:
001891 DEB5 CDE5DE          17      CALL    DWTX
                                                ;データバッファの読み込んだドライブ・セクタ情報を保存
001894 DEB8 ED53A6E5        20      LD  (_DBSEC),DE
001898 DEBC 79               4      LD  A,C
001899 DEBD 32F8DE          13      LD  (_DBS24),A
                                
00189C DEC0 3A88E5          13      LD  A,(_DRV)
00189F DEC3 32A5E5          13      LD  (_DBDRV),A
0018A2 DEC6 CDD9E5          17      CALL    _CHGDRV
0018A5 DEC9 D0              11      RET NC
       DECA                     DRDNE:
0018A6 DECA 9F               4      SBC A,A     ;CF=1ならばA=0FFH
0018A7 DECB 32A5E5          13      LD  (_DBDRV),A
0018AA DECE C9              10      RET
                                
                                ;   CDE:セクタ番号
       DECF                     DRDY:
0018AB DECF 3AF8DE          13      LD  A,(_DBS24)
0018AE DED2 B9               4      CP  C
0018AF DED3 C0              11      RET NZ
                                
0018B0 DED4 E5              11      PUSH    HL
0018B1 DED5 3A88E5          13      LD  A,(_DRV)
0018B4 DED8 21A5E5          10      LD  HL,_DBDRV
0018B7 DEDB AE               7      XOR (HL)
0018B8 DEDC 2005            12      JR  NZ,POP_HL_RET
                                
0018BA DEDE 2AA6E5          16      LD  HL,(_DBSEC)
0018BD DEE1 ED52            15      SBC HL,DE       ;上でXORを使っているのでCF=0のはず
       DEE3                     POP_HL_RET:
0018BF DEE3 E1              10      POP HL
0018C0 DEE4 C9              10      RET
                                
       DEE5                     DWTX:
0018C1 DEE5 3AA4E5          13      LD  A,(_WTDBF)
0018C4 DEE8 B7               4      OR  A
0018C5 DEE9 C8              11      RET Z
0018C6 DEEA AF               4      XOR A
0018C7 DEEB 32A4E5          13      LD  (_WTDBF),A
                                
0018CA DEEE E5              11      PUSH    HL
0018CB DEEF C5              11      PUSH    BC
0018CC DEF0 D5              11      PUSH    DE
0018CD DEF1 3AA5E5          13      LD  A,(_DBDRV)
0018D0 DEF4 CDD9E5          17      CALL    _CHGDRV
0018D3 DEF7 0E00             7      LD  C,0
       DEF8                     _DBS24  EQU $-1
0018D5 DEF9 ED5BA6E5        20      LD  DE,(_DBSEC)
0018D9 DEFD 2A7EE6          16      LD  HL,(_DTBUF)
0018DC DF00 D4C7E1          17      CALL    NC,DWT24
       DF03                     POP_DE_BC_HL_RET2:
0018DF DF03 18A4            12      JR  POP_DE_BC_HL_RET
                                
       DF05                     RDFATX:
0018E1 DF05 E5              11      PUSH    HL
0018E2 DF06 3A88E5          13      LD  A,(_DRV)
0018E5 DF09 21AAE5          10      LD  HL,_FATDRV
0018E8 DF0C AE               7      XOR (HL)
0018E9 DF0D 28D4            12      JR  Z,POP_HL_RET
                                
0018EB DF0F C5              11      PUSH    BC
0018EC DF10 D5              11      PUSH    DE
0018ED DF11 DDE5            15      PUSH    IX
0018EF DF13 CD2FDF          17      CALL    WTFATX
0018F2 DF16 3813            12      JR  C,POP_IX_DE_BC_HL_RET
                                
0018F4 DF18 AF               4      XOR A
0018F5 DF19 32ABE5          13      LD  (_FATIX),A
0018F8 DF1C 3A88E5          13      LD  A,(_DRV)
0018FB DF1F 32AAE5          13      LD  (_FATDRV),A
0018FE DF22 CDE5E5          17      CALL    _RDFAT
       DF25                     RDFATE2:
001901 DF25 3004            12      JR  NC,POP_IX_DE_BC_HL_RET
001903 DF27 9F               4      SBC A,A     ;A=0xFF
001904 DF28 32AAE5          13      LD  (_FATDRV),A
       DF2B                     POP_IX_DE_BC_HL_RET:
001907 DF2B DDE1            14      POP IX
001909 DF2D 18D4            12      JR  POP_DE_BC_HL_RET2
                                
       DF2F                     WTFATX:
00190B DF2F 3AA2E5          13      LD  A,(_WTFATF)
00190E DF32 B7               4      OR  A
00190F DF33 C8              11      RET Z
001910 DF34 AF               4      XOR A
001911 DF35 32A2E5          13      LD  (_WTFATF),A
                                
001914 DF38 E5              11      PUSH    HL
001915 DF39 3AAAE5          13      LD  A,(_FATDRV)
001918 DF3C 21A5E5          10      LD  HL,_DBDRV
00191B DF3F AE               7      XOR (HL)
00191C DF40 CCE5DE          17      CALL    Z,DWTX
00191F DF43 389E            12      JR  C,POP_HL_RET
001921 DF45 C5              11      PUSH    BC
001922 DF46 D5              11      PUSH    DE
001923 DF47 DDE5            15      PUSH    IX
001925 DF49 CDD8E1          17      CALL    FATSETUP
001928 DF4C D4C9E1          17      CALL    NC,DWT24B
00192B DF4F 18DA            12      JR  POP_IX_DE_BC_HL_RET
                                
       DF51                     N16CL1:
00192D DF51 7A               4      LD  A,D
00192E DF52 B3               4      OR  E
00192F DF53 37               4      SCF
001930 DF54 C8              11      RET Z
                                
001931 DF55 7A               4      LD  A,D
001932 DF56 1807            12      JR  NCL1X
       DF58                     NCL1:
001934 DF58 7A               4      LD  A,D
001935 DF59 B3               4      OR  E
001936 DF5A 37               4      SCF
001937 DF5B C8              11      RET Z
                                
001938 DF5C 7A               4      LD  A,D
001939 DF5D CB3F             8      SRL A   ;/2
       DF5F                     NCL1X:
00193B DF5F CB3F             8      SRL A   ;/2
                                
00193D DF61 E5              11      PUSH    HL
00193E DF62 3281DF          13      LD  (NCLPAT_FATIX),A    ;_FATIX
001941 DF65 2AAAE5          16      LD  HL,(_FATDRV)    ;L=_FATDRV H=_FATIX
001944 DF68 BC               4      CP  H
001945 DF69 3A88E5          13      LD  A,(_DRV)    ;LDではフラグは変化しない
001948 DF6C 3280DF          13      LD  (NCLPAT_FATDRV),A   ;_FATDRV
00194B DF6F 2005            12      JR  NZ,NCL2     ;FATIXが違う
00194D DF71 BD               4      CP  L
00194E DF72 2002            12      JR  NZ,NCL2     ;ドライブが違う
001950 DF74 E1              10      POP HL
001951 DF75 C9              10      RET
       DF76                     NCL2:
001952 DF76 C5              11      PUSH    BC
001953 DF77 D5              11      PUSH    DE
001954 DF78 DDE5            15      PUSH    IX
001956 DF7A CD2FDF          17      CALL    WTFATX
001959 DF7D 38AC            12      JR  C,POP_IX_DE_BC_HL_RET
00195B DF7F 010000          10      LD  BC,0        ;自己書き換え C=_FATDRV B=_FATIX
       DF81                     NCLPAT_FATIX    EQU $-1
       DF80                     NCLPAT_FATDRV   EQU $-2
00195E DF82 ED43AAE5        20      LD  (_FATDRV),BC
001962 DF86 CDADE1          17      CALL    RDFATS
001965 DF89 189A            12      JR  RDFATE2
                                
       DF8B                     NCL3:
001967 DF8B CB9A             8      RES 3,D
001969 DF8D CB92             8      RES 2,D
00196B DF8F 6B               4      LD  L,E
00196C DF90 62               4      LD  H,D
00196D DF91 CB3C             8      SRL H   ;
00196F DF93 CB1D             8      RR  L   ;HLA=HLA/2
001971 DF95 1F               4      RRA     ;
001972 DF96 F5              11      PUSH    AF
001973 DF97 3AABE5          13      LD  A,(_FATIX)
001976 DF9A 0F               4      RRCA
001977 DF9B 300B            12      JR  NC,NCL3X1
001979 DF9D 3A9DDD          13      LD  A,(SECSZ_H)
00197C DFA0 FE04             7      CP  4       ;1セクタ1024バイトの場合は奇数インデックスの場合に先頭を512バイトずらす
00197E DFA2 2004            12      JR  NZ,NCL3X1
001980 DFA4 010002          10      LD  BC,512
001983 DFA7 09              11      ADD HL,BC
       DFA8                     NCL3X1:
001984 DFA8 F1              10      POP AF
001985 DFA9 ED4B7CE6        20      LD  BC,(_FATBF)
001989 DFAD 19              11      ADD HL,DE
00198A DFAE 09              11      ADD HL,BC
00198B DFAF 17               4      RLA
00198C DFB0 C9              10      RET
                                
       DFB1                     GNCL:
00198D DFB1 CD58DF          17      CALL    NCL1        ;GET NEXT CLUSTER
001990 DFB4 D8              11      RET C
001991 DFB5 C5              11      PUSH    BC
001992 DFB6 E5              11      PUSH    HL
001993 DFB7 CD8BDF          17      CALL    NCL3
001996 DFBA 3809            12      JR  C,GNC1
001998 DFBC 5E               7      LD  E,(HL)
001999 DFBD 23               6      INC HL
00199A DFBE 7E               7      LD  A,(HL)
00199B DFBF E60F             7      AND 00FH
00199D DFC1 57               4      LD  D,A
00199E DFC2 E1              10      POP HL
00199F DFC3 C1              10      POP BC
0019A0 DFC4 C9              10      RET
       DFC5                     GNC1:
0019A1 DFC5 7E               7      LD  A,(HL)
0019A2 DFC6 23               6      INC HL
0019A3 DFC7 56               7      LD  D,(HL)
0019A4 DFC8 0604             7      LD  B,4
       DFCA                     GNC1L:
0019A6 DFCA CB3A             8      SRL D   ;DA=DA/2
0019A8 DFCC 1F               4      RRA     ;
0019A9 DFCD 10FB            13      DJNZ    GNC1L
                                
0019AB DFCF 5F               4      LD  E,A
0019AC DFD0 E1              10      POP HL
0019AD DFD1 C1              10      POP BC
0019AE DFD2 A7               4      AND A
0019AF DFD3 C9              10      RET
                                
       DFD4                     SNCL:
0019B0 DFD4 CD58DF          17      CALL    NCL1
0019B3 DFD7 D8              11      RET C
                                ;               SET NEXT CLUSTER
0019B4 DFD8 E5              11      PUSH    HL
0019B5 DFD9 C5              11      PUSH    BC
0019B6 DFDA D5              11      PUSH    DE
0019B7 DFDB E5              11      PUSH    HL
0019B8 DFDC CD8BDF          17      CALL    NCL3
0019BB DFDF D1              10      POP DE
                                ;CF=ODD
0019BC DFE0 7E               7      LD  A,(HL)
0019BD DFE1 73               7      LD  (HL),E
0019BE DFE2 3806            12      JR  C,SNC1
                                ;EVEN
                                ;M[0] = E
                                ;M[1] = (M[1] & 0xF0) | (D & 0x0F)
0019C0 DFE4 23               6      INC HL
0019C1 DFE5 ED67            18      RRD     ;M={A[3:0],E[3:0]}
0019C3 DFE7 7A               4      LD  A,D
0019C4 DFE8 1804            12      JR  SNC11
       DFEA                     SNC1:
                                ;ODD
                                ;HL[0] = (HL[0]&0x0F) | (E<<4)
                                ;HL[1] = DE>>4
0019C6 DFEA ED6F            18      RLD     ;M={D[3:0],E[7:4]}
0019C8 DFEC 23               6      INC HL
0019C9 DFED 72               7      LD  (HL),D  ;M={D[3:0],E[7:4]}
       DFEE                     SNC11:
0019CA DFEE ED6F            18      RLD     ;M={M[7:4],D[3:0]}
0019CC DFF0 B7               4      OR  A
0019CD DFF1 D1              10      POP DE
0019CE DFF2 C1              10      POP BC
0019CF DFF3 E1              10      POP HL
       DFF4                     FAT_CHANGED:
0019D0 DFF4 3EFF             7      LD  A,0FFH
0019D2 DFF6 32A2E5          13      LD  (_WTFATF),A
0019D5 DFF9 C9              10      RET
                                
       DFFA                     N16CL3:
0019D6 DFFA C5              11      PUSH    BC
0019D7 DFFB 6B               4      LD  L,E
0019D8 DFFC 7A               4      LD  A,D
0019D9 DFFD E601             7      AND 1
0019DB DFFF 67               4      LD  H,A
0019DC E000 29              11      ADD HL,HL
0019DD E001 ED4B7CE6        20      LD  BC,(_FATBF)
0019E1 E005 09              11      ADD HL,BC
0019E2 E006 C1              10      POP BC
0019E3 E007 C9              10      RET
                                
       E008                     GNCL16:
0019E4 E008 CD51DF          17      CALL    N16CL1      ;GET NEXT CLUSTER for FAT16
0019E7 E00B D8              11      RET C
0019E8 E00C E5              11      PUSH    HL
0019E9 E00D CDFADF          17      CALL    N16CL3
0019EC E010 5E               7      LD  E,(HL)
0019ED E011 23               6      INC HL
0019EE E012 56               7      LD  D,(HL)
0019EF E013 E1              10      POP HL
0019F0 E014 C9              10      RET
                                
       E015                     SNCL16:
0019F1 E015 CD51DF          17      CALL    N16CL1      ;GET NEXT CLUSTER for FAT16
0019F4 E018 D8              11      RET C
0019F5 E019 D5              11      PUSH    DE
0019F6 E01A E5              11      PUSH    HL
0019F7 E01B CDFADF          17      CALL    N16CL3
0019FA E01E D1              10      POP DE      ;HL
0019FB E01F 73               7      LD  (HL),E
0019FC E020 23               6      INC HL
0019FD E021 72               7      LD  (HL),D
0019FE E022 6B               4      LD  L,E
0019FF E023 62               4      LD  H,D
001A00 E024 D1              10      POP DE
001A01 E025 18CD            12      JR  FAT_CHANGED
                                
                                ;------------------------
                                ;次のセクタを探す際に_SECPSの値をチェック
                                ;in
                                ;   DE : セクタ番号
                                ;out
                                ;   DE : 次のセクタ番号
                                ;note
                                ;
                                ;------------------------
       E027                     NEXTX:
001A03 E027 3E00             7      LD  A,0 ;自己書き換え
       E028                     _SECPS  EQU $-1
001A05 E029 3C               4      INC A
001A06 E02A E600             7      AND 0   ;自己書き換え　1クラスタの論理セクタ数-1
       E02B                     _NCPAT  EQU $-1
001A08 E02C 3228E0          13      LD  (_SECPS),A
001A0B E02F C9              10      RET
                                
       E030                     GNCLX:
001A0C E030 CD27E0          17      CALL    NEXTX
001A0F E033 C0              11      RET NZ  ;1クラスタのセクタ未満の場合は戻る
001A10 E034 C3F7E5          10      JP  _GNCL   ;次のクラスタを探す
                                
       E037                     RDFAT:
001A13 E037 3E80             7      LD  A,080H
001A15 E039 3270E5          13      LD  (CHECK),A
       E03C                     RDFAT1:
001A18 E03C 3A88E5          13      LD  A,(_DRV)
001A1B E03F CDE1E2          17      CALL    CHGDRVR
001A1E E042 D8              11      RET C
001A1F E043 DD7E12          19      LD  A,(IX+DPB_DEVICE)
001A22 E046 CB6F             8      BIT 5,A
001A24 E048 286E            12      JR  Z,RDFAT0X
001A26 E04A 2170E5          10      LD  HL,CHECK
001A29 E04D A6               7      AND (HL)
001A2A E04E 77               7      LD  (HL),A
001A2B E04F 110000          10      LD  DE,0        ;BPB
001A2E E052 2A7CE6          16      LD  HL,(_FATBF)
001A31 E055 0E00             7      LD  C,0
001A33 E057 CDB9E1          17      CALL    DRD24
001A36 E05A 3024            12      JR  NC,GETBPB
001A38 E05C 2170E5          10      LD  HL,CHECK
001A3B E05F CB06            15      RLC (HL)
001A3D E061 3F               4      CCF
001A3E E062 D8              11      RET C
001A3F E063 DDCB0A1E        23      RR  (IX+DPB_FDMODE)
001A43 E067 3F               4      CCF         ;フロッピーディスクのFDモードを切り替える
001A44 E068 DDCB0A16        23      RL  (IX+DPB_FDMODE)
001A48 E06C 3EFF             7      LD  A,0FFH
001A4A E06E 3289E5          13      LD  (_DSK),A
001A4D E071 3A84E5          13      LD  A,(_DRIVE)
001A50 E074 E603             7      AND 3
001A52 E076 F680             7      OR  080H
001A54 E078 6F               4      LD  L,A
001A55 E079 26E5             7      LD  H,_CYL0/256
001A57 E07B 3EFF             7      LD  A,0FFH
001A59 E07D 77               7      LD  (HL),A
001A5A E07E 18BC            12      JR  RDFAT1
       E080                     GETBPB:
001A5C E080 FDE5            15      PUSH    IY
001A5E E082 FD2A7CE6        20      LD  IY,(_FATBF) ;BPB
001A62 E086 CDF1E5          17      CALL    _BPB2DPB
001A65 E089 FDE1            14      POP IY
001A67 E08B DD7E12          19      LD  A,(IX+DPB_DEVICE)
001A6A E08E 3025            12      JR  NC,GETBPBOK
001A6C E090 E60F             7      AND 00FH
001A6E E092 FE07             7      CP  7
001A70 E094 37               4      SCF
001A71 E095 C0              11      RET NZ
001A72 E096 DDCB0A46        20      BIT 0,(IX+DPB_FDMODE)
001A76 E09A 21C0E6          10      LD  HL,M2D
001A79 E09D 2006            12      JR  NZ,SETFDMODE
001A7B E09F CD92E1          17      CALL    CHECK1024
001A7E E0A2 D8              11      RET C
001A7F E0A3 2ED2             7      LD  L,M2HD-STABLE
       E0A5                     SETFDMODE:
001A81 E0A5 DDE5            15      PUSH    IX
001A83 E0A7 D1              10      POP DE
001A84 E0A8 EDA0            16      LDI
001A86 E0AA EDA0            16      LDI
001A88 E0AC 13               6      INC DE
001A89 E0AD 13               6      INC DE
001A8A E0AE 13               6      INC DE
001A8B E0AF 13               6      INC DE
001A8C E0B0 010C00          10      LD  BC,12
001A8F E0B3 EDB0                    LDIR
       E0B5                     GETBPBOK:
001A91 E0B5 CD4DE2          17      CALL    CHGDRV2
       E0B8                     RDFAT0X:
001A94 E0B8 CDADE1          17      CALL    RDFATS
001A97 E0BB D8              11      RET C
001A98 E0BC DDAE06          19      XOR (IX+DPB_FATID)
001A9B E0BF C8              11      RET Z
001A9C E0C0 DD7E12          19      LD  A,(IX+DPB_DEVICE)
001A9F E0C3 CB5F             8      BIT 3,A
001AA1 E0C5 2803            12      JR  Z,RDFAT0X1
001AA3 E0C7 CB6F             8      BIT 5,A
001AA5 E0C9 C0              11      RET NZ      ;BPBを取得している場合はFATIDをチェックしない
       E0CA                     RDFAT0X1:
001AA6 E0CA 37               4      SCF
001AA7 E0CB C9              10      RET
                                
       E0CC                     POP_HL_SCF_RET:
001AA8 E0CC E1              10      POP HL
001AA9 E0CD 37               4      SCF
001AAA E0CE C9              10      RET
                                
       E0CF                     BPB2DPB:
001AAB E0CF FD7E0B          19      LD  A,(IY+11)   ;BPB_BytsPerSec
001AAE E0D2 B7               4      OR  A
001AAF E0D3 37               4      SCF
001AB0 E0D4 C0              11      RET NZ
       E0D5                     BPBOK:
001AB1 E0D5 FD7E0D          19      LD  A,(IY+13)   ;BPB_SecPerClus
001AB4 E0D8 DD7707          19      LD  (IX+DPB_SECPCL),A
                                
001AB7 E0DB FD7E16          19      LD  A,(IY+22)   ;BPB_FATSz16
001ABA E0DE DD7700          19      LD  (IX+DPB_FATLN),A
001ABD E0E1 FD7E17          19      LD  A,(IY+23)   ;BPB_FATSz16
001AC0 E0E4 DD7701          19      LD  (IX+DPB_FATLN+1),A
                                
001AC3 E0E7 FD6E0E          19      LD  L,(IY+14)   ;BPB_RsvdSecCnt
001AC6 E0EA FD660F          19      LD  H,(IY+15)
001AC9 E0ED DD750E          19      LD  (IX+DPB_FATPS),L
001ACC E0F0 FD5E16          19      LD  E,(IY+22)   ;BPB_FATSz16
001ACF E0F3 FD5617          19      LD  D,(IY+23)
001AD2 E0F6 FD4610          19      LD  B,(IY+16)   ;BPB_NumFATs
       E0F9                     BPBDP1:             ;BPB_FATSz16 * BPB_NumFATs
001AD5 E0F9 19              11      ADD HL,DE
001AD6 E0FA 10FD            13      DJNZ    BPBDP1
       E0FC                     BPBDP2:
001AD8 E0FC DD7510          19      LD  (IX+DPB_DIRPS),L
001ADB E0FF DD7411          19      LD  (IX+DPB_DIRPS+1),H
001ADE E102 E5              11      PUSH    HL
                                
001ADF E103 FD6E11          19      LD  L,(IY+17)   ;BPB_RootEntCnt
001AE2 E106 FD6612          19      LD  H,(IY+18)
001AE5 E109 FD7E0C          19      LD  A,(IY+12)   ;BPB_BytsPerSec
001AE8 E10C B7               4      OR  A
001AE9 E10D 28BD            12      JR  Z,POP_HL_SCF_RET
001AEB E10F 0606             7      LD  B,6
       E111                     BPBBPS1:
001AED E111 05               4      DEC B
001AEE E112 0F               4      RRCA
001AEF E113 30FC            12      JR  NC,BPBBPS1
       E115                     BPBDE1:
001AF1 E115 29              11      ADD HL,HL
001AF2 E116 10FD            13      DJNZ    BPBDE1
                                
001AF4 E118 7C               4      LD  A,H
001AF5 E119 DD770B          19      LD  (IX+DPB_DIRSCNT),A  ;
                                
001AF8 E11C D1              10      POP DE      ;DPB_DIRPS
001AF9 E11D 6C               4      LD  L,H
001AFA E11E 2600             7      LD  H,0
001AFC E120 19              11      ADD HL,DE       ;MAXDIR
001AFD E121 E5              11      PUSH    HL
001AFE E122 FD4E0D          19      LD  C,(IY+13)   ;BPB_SecPerClus
001B01 E125 CB21             8      SLA C       ;*2
001B03 E127 AF               4      XOR A
001B04 E128 47               4      LD  B,A
001B05 E129 ED42            15      SBC HL,BC
001B07 E12B DD7514          19      LD  (IX+DPB_ADDCL),L
001B0A E12E DD7415          19      LD  (IX+DPB_ADDCL+1),H
                                
001B0D E131 D1              10      POP DE      ;DE=DPB_MAXDIR
001B0E E132 FD6E13          19      LD  L,(IY+19)   ;BPB_TotSec16
001B11 E135 FD6614          19      LD  H,(IY+20)
                                
001B14 E138 DD7E12          19      LD  A,(IX+DPB_DEVICE)
001B17 E13B E60F             7      AND 00FH
001B19 E13D FE07             7      CP  7       ;フロッピー
001B1B E13F 2019            12      JR  NZ,NOT_FD
001B1D E141 E5              11      PUSH    HL
001B1E E142 FD4E18          19      LD  C,(IY+24)   ;BPB_SecPerTr
001B21 E145 DD710D          19      LD  (IX+DPB_MAXSEC),C
001B24 E148 AF               4      XOR A
001B25 E149 CB21             8      SLA C       ;両面なのでセクタ数を２倍
001B27 E14B 0610             7      LD  B,16
       E14D                     DIVSEC:             ;MAXCYL = BPB_TotSec16 / (BPB_SecPerTr * 2)
001B29 E14D 29              11      ADD HL,HL
001B2A E14E 17               4      RLA
001B2B E14F B9               4      CP  C
001B2C E150 3802            12      JR  C,DIVSEC1
001B2E E152 91               4      SUB C
001B2F E153 2C               4      INC L
       E154                     DIVSEC1:
001B30 E154 10F7            13      DJNZ    DIVSEC
001B32 E156 DD750C          19      LD  (IX+DPB_MAXCYL),L
001B35 E159 E1              10      POP HL  ;ここまでフロッピー専用
       E15A                     NOT_FD:
001B36 E15A 7C               4      LD  A,H
001B37 E15B B5               4      OR  L
001B38 E15C 3E00             7      LD  A,0     ;LDでフラグは変化しない。BPB_TotSec16を AHL で扱う為、Aに0を入れる
001B3A E15E 200E            12      JR  NZ,BPB16BIT ;BPB_TotSec16が「0」の場合はBPB_TotSec32で計算
001B3C E160 2F               4      CPL         ;A=0FFH
001B3D E161 FD8623          19      ADD A,(IY+35)   ;念のために総セクタ数が24ビットを超える場合はエラーを返す
001B40 E164 D8              11      RET C
001B41 E165 FD6E20          19      LD  L,(IY+32)   ;BPB_TotSec32 は AHL の24ビットで扱う
001B44 E168 FD6621          19      LD  H,(IY+33)   ;1クラスタの論理セクタ数(DPB_SECPCL)が最大128なので、
001B47 E16B FD7E22          19      LD  A,(IY+34)   ;FAT12,FAT16では総セクタ数が24ビットを超えることは無い
       E16E                     BPB16BIT:
001B4A E16E ED52            15      SBC HL,DE       ;DE=DPB_MAXDIR
001B4C E170 DE00             7      SBC A,0
001B4E E172 FD460D          19      LD  B,(IY+13)   ;BPB_SecPerClus
       E175                     BPBTC1:             ;総クラスタ数(AHL) = 総セクタ数(AHL) / セクタサイズ(B)
001B51 E175 CB18             8      RR  B       ;->CY
001B53 E177 3808            12      JR  C,BPBTC2
001B55 E179 CB3F             8      SRL A
001B57 E17B CB1C             8      RR  H       ;AHL=AHL/2
001B59 E17D CB1D             8      RR  L
001B5B E17F 18F4            12      JR  BPBTC1
       E181                     BPBTC2:
001B5D E181 C6FF             7      ADD A,0FFH
001B5F E183 D8              11      RET C       ;念のため(クラスタ数が16ビットを超える場合)
001B60 E184 23               6      INC HL
001B61 E185 23               6      INC HL
001B62 E186 DD7508          19      LD  (IX+DPB_MAXCL),L
001B65 E189 DD7409          19      LD  (IX+DPB_MAXCL+1),H
                                
001B68 E18C FD7E15          19      LD  A,(IY+21)   ;BPB_Media
001B6B E18F DD7706          19      LD  (IX+DPB_FATID),A
       E192                     CHECK1024:
001B6E E192 FD7E10          19      LD  A,(IY+16)   ;BPB_NumFATs
001B71 E195 C6FE             7      ADD A,0-2       ;>2:CF=1
001B73 E197 FD7E0C          19      LD  A,(IY+12)   ;BPB_BytsPerSec
001B76 E19A 6F               4      LD  L,A
001B77 E19B 3002            12      JR  NC,BPBFAT1
001B79 E19D F680             7      OR  080H
       E19F                     BPBFAT1:            ;ここではCF=0
001B7B E19F DD770F          19      LD  (IX+DPB_BPS),A
001B7E E1A2 3A7BE6          13      LD  A,(_MAX_SEC_SZ_H)
001B81 E1A5 BD               4      CP  L
001B82 E1A6 C8              11      RET Z       ;1セクタ1024バイト
001B83 E1A7 2D               4      DEC L       ;以下のセクタサイズに合致しない場合はCF=1でエラーにする
001B84 E1A8 C8              11      RET Z       ;1セクタ256バイト
001B85 E1A9 2D               4      DEC L
001B86 E1AA C8              11      RET Z       ;1セクタ512バイト
001B87 E1AB 37               4      SCF
001B88 E1AC C9              10      RET
                                
       E1AD                     RDFATS:
001B89 E1AD CDD8E1          17      CALL    FATSETUP
001B8C E1B0 D8              11      RET C
001B8D E1B1 CDBBE1          17      CALL    DRD24B
001B90 E1B4 2A7CE6          16      LD  HL,(_FATBF)
001B93 E1B7 7E               7      LD  A,(HL)
001B94 E1B8 C9              10      RET
                                
       E1B9                     DRD24:
001B95 E1B9 0601             7      LD  B,1
       E1BB                     DRD24B:
001B97 E1BB DDE5            15      PUSH    IX
001B99 E1BD DD2AA8E5        20      LD  IX,(_DPB)
001B9D E1C1 CD26E3          17      CALL    FDRD        ;自己書き換え（ディスク読み込み）
       E1C2                     DRDPAT  EQU $-2
001BA0 E1C4 DDE1            14      POP IX
001BA2 E1C6 C9              10      RET
                                
       E1C7                     DWT24:
001BA3 E1C7 0601             7      LD  B,1
       E1C9                     DWT24B:
001BA5 E1C9 DDE5            15      PUSH    IX
001BA7 E1CB DD2AA8E5        20      LD  IX,(_DPB)
001BAB E1CF CD24E3          17      CALL    FDWT        ;自己書き換え（ディスク書き込み）
       E1D0                     DWTPAT  EQU $-2
001BAE E1D2 DDE1            14      POP IX
001BB0 E1D4 D0              11      RET NC
001BB1 E1D5 C35AE5          10      JP  _DISKE
                                
                                ;------------------------
                                ;FATのセットアップ
                                ;out
                                ;   B  : FATセクタ数
                                ;   DE : FAT先頭セクタ番号
                                ;   HL : FATバッファポインタ
                                ;   CF : 1=ドライブ切り替えエラー
                                ;note
                                ;   FATサイズがFATバッファを超える場合は
                                ;   対象クラスタ領域==(_FATIX)によって
                                ;   FAT12:対象クラスタ1024毎に1.5KBを切り替える
                                ;   FAT16:対象クラスタ512毎に1KBを切り替える
                                ;------------------------
       E1D8                     FATSETUP:
001BB4 E1D8 3AAAE5          13      LD  A,(_FATDRV)
001BB7 E1DB CDE1E2          17      CALL    CHGDRVR     ;ドライブ切り替え
001BBA E1DE D8              11      RET C
       E1DF                     FATS2:
001BBB E1DF DD7E0F          19      LD  A,(IX+DPB_BPS)  ;512=2 1024=4
001BBE E1E2 0F               4      RRCA
001BBF E1E3 CD13E2          17      CALL    FATSETUP12  ;自己書き換え
       E1E4                     FATSX   EQU $-2
001BC2 E1E6 210000          10      LD  HL,0
001BC5 E1E9 4A               4      LD  C,D
001BC6 E1EA 54               4      LD  D,H
001BC7 E1EB 3AABE5          13      LD  A,(_FATIX)  ;範囲FAT12:0-3/FAT16:0-127(0-07FH):65535*2/1024
001BCA E1EE 47               4      LD  B,A
001BCB E1EF 04               4      INC B
001BCC E1F0 DD7E00          19      LD  A,(IX+DPB_FATLN)
       E1F3                     FAT_SKP:
001BCF E1F3 05               4      DEC B
001BD0 E1F4 2809            12      JR  Z,FAT1
001BD2 E1F6 19              11      ADD HL,DE
001BD3 E1F7 93               4      SUB E
001BD4 E1F8 30F9            12      JR  NC,FAT_SKP
001BD6 E1FA DDCB0146        20      BIT 0,(IX+DPB_FATLN+1)  ;FATサイズが0100H(256)の場合
001BDA E1FE C8              11      RET Z
       E1FF                     FAT1:
001BDB E1FF EB               4      EX  DE,HL
001BDC E200 B7               4      OR  A       ;0の場合は0100Hとして扱う
001BDD E201 2803            12      JR  Z,FAT3
001BDF E203 B9               4      CP  C       ;C=FATバッファに読み込めるセクタ数
001BE0 E204 3801            12      JR  C,FAT2
       E206                     FAT3:
001BE2 E206 79               4      LD  A,C
       E207                     FAT2:
001BE3 E207 47               4      LD  B,A
                                
001BE4 E208 2AFAE6          16      LD  HL,(_FATPS) ;fat sector pos
001BE7 E20B 19              11      ADD HL,DE
001BE8 E20C EB               4      EX  DE,HL
001BE9 E20D 2A7CE6          16      LD  HL,(_FATBF)
001BEC E210 AF               4      XOR A       ;CF=0
001BED E211 4F               4      LD  C,A
001BEE E212 C9              10      RET
                                ;
                                ;   FATバッファに読み込める最大のセクタ数と_FATIXで進めるセクタ数
                                ;   FATSETUP* (FAT12/FAT16)
                                ;out
                                ;   D : FATバッファに読み込める最大のセクタ数
                                ;   E : _FATIXで進めるセクタ数
       E213                     FATSETUP12:
001BEF E213 110606          10      LD  DE,0606H    ;256
001BF2 E216 D8              11      RET C
001BF3 E217 110303          10      LD  DE,0303H    ;512
001BF6 E21A 0F               4      RRCA
001BF7 E21B D8              11      RET C
001BF8 E21C 110102          10      LD  DE,0201H    ;1024
001BFB E21F C9              10      RET
                                
       E220                     FATSETUP16:
001BFC E220 110404          10      LD  DE,0404H    ;256
001BFF E223 D8              11      RET C
001C00 E224 110202          10      LD  DE,0202H    ;512
001C03 E227 0F               4      RRCA
001C04 E228 D8              11      RET C
001C05 E229 110101          10      LD  DE,0101H    ;1024
001C08 E22C C9              10      RET
                                
       E22D                     CHGDRV:
001C09 E22D E5              11      PUSH    HL
001C0A E22E 2189E5          10      LD  HL,_DSK
001C0D E231 BE               7      CP  (HL)
001C0E E232 280A            12      JR  Z,CHGDRVE
       E234                     CHGDRV1:
001C10 E234 DDE5            15      PUSH    IX
001C12 E236 CD40E2          17      CALL    CHGDRV0
001C15 E239 3A89E5          13      LD  A,(_DSK)
001C18 E23C DDE1            14      POP IX
       E23E                     CHGDRVE:
001C1A E23E E1              10      POP HL
001C1B E23F C9              10      RET
                                
       E240                     CHGDRV0:
001C1C E240 6F               4      LD  L,A
001C1D E241 CDDCE5          17      CALL    _GETDPB
001C20 E244 D8              11      RET C
001C21 E245 DD22A8E5        20      LD  (_DPB),IX
001C25 E249 7D               4      LD  A,L
001C26 E24A 3289E5          13      LD  (_DSK),A
       E24D                     CHGDRV2:
001C29 E24D C5              11      PUSH    BC
001C2A E24E D5              11      PUSH    DE
001C2B E24F ED7398E2        20      LD  (SPPAT2),SP
001C2F E253 F3               4      DI
001C30 E254 DDF9            10      LD  SP,IX
                                
001C32 E256 E1              10      POP HL      ;00:DPB_FATLN
001C33 E257 E1              10      POP HL      ;02:DPB_DRD
001C34 E258 22C2E1          16      LD  (DRDPAT),HL
                                
001C37 E25B E1              10      POP HL
001C38 E25C 22D0E1          16      LD  (DWTPAT),HL ;04:DPB_DWT
                                
001C3B E25F E1              10      POP HL      ;L=06:DPB_FATID H=07:DPB_SECPCL
001C3C E260 7C               4      LD  A,H
001C3D E261 32C4D8          13      LD  (SPCPAT),A  ;1クラスタの論理セクタ数
001C40 E264 3D               4      DEC A
001C41 E265 322BE0          13      LD  (_NCPAT),A
                                
001C44 E268 E1              10      POP HL      ;08:DPB_MAXCL
001C45 E269 7D               4      LD  A,L
001C46 E26A 32E3D8          13      LD  (CLPAT2),A
001C49 E26D 7C               4      LD  A,H
001C4A E26E 32DFD8          13      LD  (CLPAT1),A
001C4D E271 2B               6      DEC HL
001C4E E272 22E2DA          16      LD  (MAXCLP),HL
                                
001C51 E275 E1              10      POP HL      ;L=0A:DPB_FDMODE H=0B:DPB_DIRSCNT
001C52 E276 4C               4      LD  C,H
                                
001C53 E277 E1              10      POP HL      ;L=0C:DPB_MAXCYL H=0D:DPB_MAXSEC
                                
001C54 E278 E1              10      POP HL      ;L=0E:DPB_FATPS H=0F:DPB_BPS
001C55 E279 7C               4      LD  A,H     ;DPB_BPS
001C56 E27A E607             7      AND 7
001C58 E27C 329DDD          13      LD  (SECSZ_H),A ;1セクタのサイズの上位1バイト 0x400 - 0x200 - 0x100
                                                ;1セクタ512 2D/2DD/2HC/2HQ(2HD1.44MB)/EMM/BRAM/EMEM等
                                                ;1セクタ1024 2HD/2HDE98等
                                                ;1セクタ256 GRAM/RAMF/CMOS等
                                                ;1024   512 256
                                                ;4  2   1
001C5B E27F 87               4      ADD A,A     ;8  4   2
001C5C E280 87               4      ADD A,A     ;010H   8   4
001C5D E281 87               4      ADD A,A     ;020H   010H    8
001C5E E282 3242D7          13      LD  (SDECPAT),A ;1セクタ辺りのディレクトリエントリ数
                                
001C61 E285 2600             7      LD  H,0
001C63 E287 22FAE6          16      LD  (_FATPS),HL
                                
001C66 E28A E1              10      POP HL      ;10:DPB_DIRPS
001C67 E28B 22FCE6          16      LD  (_DIRPS),HL
                                
001C6A E28E E1              10      POP HL      ;L=12:DPB_DEVICE H=13:DPB_UNITNO
001C6B E28F 7C               4      LD  A,H
001C6C E290 3284E5          13      LD  (_DRIVE),A
                                
001C6F E293 E1              10      POP HL      ;14:DPB_ADDCL
001C70 E294 22D4D8          16      LD  (CLSPAT),HL
                                
001C73 E297 310000          10      LD  SP,0        ;元のSPを復元
       E298                     SPPAT2  EQU $-2
001C76 E29A FB               4      EI
001C77 E29B 2AFCE6          16      LD  HL,(_DIRPS)
001C7A E29E 0600             7      LD  B,0
001C7C E2A0 09              11      ADD HL,BC       ;C=DPB_DIRSCNT
001C7D E2A1 225DD7          16      LD  (MD_PAT),HL
                                
001C80 E2A4 2AE2DA          16      LD  HL,(MAXCLP)
001C83 E2A7 110AF0          10      LD  DE,0-4086   ;クラスタ数が4086未満:FAT12 4086以上:FAT16
001C86 E2AA 19              11      ADD HL,DE
001C87 E2AB 380F            12      JR  C,SETFAT16
001C89 E2AD 21B1DF          10      LD  HL,GNCL     ;FAT12
001C8C E2B0 11D4DF          10      LD  DE,SNCL
001C8F E2B3 0113E2          10      LD  BC,FATSETUP12
001C92 E2B6 DDCB0FAE        23      RES 5,(IX+DPB_BPS)  ;DPB_BPS(FAT12)
001C96 E2BA 180D            12      JR  EXTRA1
       E2BC                     SETFAT16:
001C98 E2BC 2108E0          10      LD  HL,GNCL16   ;FAT16
001C9B E2BF 1115E0          10      LD  DE,SNCL16
001C9E E2C2 0120E2          10      LD  BC,FATSETUP16
001CA1 E2C5 DDCB0FEE        23      SET 5,(IX+DPB_BPS)  ;DPB_BPS(FAT16)
       E2C9                     EXTRA1:
001CA5 E2C9 22F8E5          16      LD  (GNCPAT),HL
001CA8 E2CC ED53FBE5        20      LD  (SNCPAT),DE
001CAC E2D0 ED43E4E1        20      LD  (FATSX),BC
001CB0 E2D4 D1              10      POP DE
001CB1 E2D5 C1              10      POP BC
001CB2 E2D6 AF               4      XOR A
001CB3 E2D7 C9              10      RET
                                
       E2D8                     GETDPBD:
001CB4 E2D8 DDE3            23      EX  (SP),IX
001CB6 E2DA DDE5            15      PUSH    IX
001CB8 E2DC 3A88E5          13      LD  A,(_DRV)
001CBB E2DF 1807            12      JR  GETDPB1
                                
       E2E1                     CHGDRVR:
001CBD E2E1 CDD9E5          17      CALL    _CHGDRV
001CC0 E2E4 D8              11      RET C
001CC1 E2E5 3A89E5          13      LD  A,(_DSK)
       E2E8                     GETDPB1:
001CC4 E2E8 C3DCE5          10      JP  _GETDPB
                                
       E2EB                     GETDPB:
001CC7 E2EB FE08             7      CP  8
001CC9 E2ED 3F               4      CCF
001CCA E2EE D8              11      RET C
001CCB E2EF 0F               4      RRCA
001CCC E2F0 0F               4      RRCA
001CCD E2F1 0F               4      RRCA
001CCE E2F2 DD                      DB  0DDH        ;Z80未定義命令
001CCF E2F3 6F               4      LD  L,A     ;LD IXL,A
001CD0 E2F4 DD                      DB  0DDH        ;Z80未定義命令
001CD1 E2F5 26E7             7      LD  H,_DEVICE/256   ;LD IXH,_DEVICE/256
001CD3 E2F7 DD7E00          19      LD  A,(IX+DPB_FATLN)
001CD6 E2FA A7               4      AND A       ;CF=0の為
001CD7 E2FB DDCB0F6E        20      BIT 5,(IX+DPB_BPS)
001CDB E2FF C0              11      RET NZ      ;FAT16
001CDC E300 DDCB126E        20      BIT 5,(IX+DPB_DEVICE)
001CE0 E304 C0              11      RET NZ      ;BPB
001CE1 E305 FE01             7      CP  001H        ;A=0 THEN CF=1
001CE3 E307 C9              10      RET
                                
       E308                     _SYS5F:
001CE4 E308 AF               4      XOR A
       E309                     FFLUSH:
001CE5 E309 F5              11      PUSH    AF
001CE6 E30A CD2FDF          17      CALL    WTFATX
001CE9 E30D AF               4      XOR A
001CEA E30E 32ABE5          13      LD  (_FATIX),A
001CED E311 2F               4      CPL         ;0FFH
001CEE E312 32AAE5          13      LD  (_FATDRV),A
001CF1 E315 3E                      DB  03EH        ;次のPUSH AFをスキップ
       E316                     FFLUSHBUF:
001CF2 E316 F5              11      PUSH    AF
001CF3 E317 CDE5DE          17      CALL    DWTX
001CF6 E31A 3EFF             7      LD  A,0FFH
001CF8 E31C 3239E5          13      LD  (SFILE),A
001CFB E31F 32A5E5          13      LD  (_DBDRV),A
001CFE E322 F1              10      POP AF
001CFF E323 C9              10      RET
                                
[EOF:LDDIO.ASM:SHIFT_JIS]
                                    INCLUDE "MSXDISK.ASM"
                                
                                ;   LSX-Dodgers DISK
                                ;   MSX
                                
                                ;   ROM DISK DRIVER
                                ;   1セクタ可変(256/512/1024)
                                
       E324                     WTTRK:
       E324                     FDWT:
001D00 E324 37               4      SCF
001D01 E325 C9              10      RET
       E326                     FDRD:
001D02 E326 ED73B7E3        20      LD  (DRDSP),SP
001D06 E32A 3AB8E3          13      LD  A,(DRDSPH)  ;スタックがカートリッジと被っていないかチェック
001D09 E32D FE7F             7      CP  07FH
001D0B E32F 3807            12      JR  C,FDRD1
001D0D E331 FEC1             7      CP  0C1H
001D0F E333 3003            12      JR  NC,FDRD1
001D11 E335 315EF5          10      LD  SP,BUF
       E338                     FDRD1:
001D14 E338 C5              11      PUSH    BC
001D15 E339 D5              11      PUSH    DE
                                
001D16 E33A E5              11      PUSH    HL
001D17 E33B EB               4      EX  DE,HL
001D18 E33C DD460F          19      LD  B,(IX+DPB_BPS)
       E33F                     EADR1:
001D1B E33F CB18             8      RR  B
001D1D E341 3803            12      JR  C,EADR2
001D1F E343 29              11      ADD HL,HL
001D20 E344 18F9            12      JR  EADR1
       E346                     EADR2:
001D22 E346 E5              11      PUSH    HL  ;あとでDEで受け取る
001D23 E347 29              11      ADD HL,HL   ;64KB→32KB
001D24 E348 29              11      ADD HL,HL   ;32KB→16KB
       E349                     ASCII16K1:
001D25 E349 29              11      ADD HL,HL   ;16KB→8KB  ;ASCII-16Kの場合はここがNOPに置き換えられる
                                
001D26 E34A DD7E0C          19      LD  A,(IX+DPB_MAXCYL)   ;16KB単位でカートリッジ内のディスクが存在する位置を指定
       E34D                     ASCII16K2:
001D29 E34D 87               4      ADD A,A         ;ASCII-16Kの場合はここがNOPに置き換えられる
001D2A E34E 84               4      ADD A,H
001D2B E34F 5F               4      LD  E,A
001D2C E350 3A62E5          13      LD  A,(ROM_SLT)
001D2F E353 210070          10      LD  HL,BANK2_SEL
       E354                     ROM8000H    EQU $-2
001D32 E356 CD6FD4          17      CALL    WRSLT
                                
001D35 E359 2680             7      LD  H,080H
001D37 E35B 3A62E5          13      LD  A,(ROM_SLT) ;カートリッジROMに切り替える
001D3A E35E CDE2D4          17      CALL    ENASLT
                                
001D3D E361 D1              10      POP DE
001D3E E362 E1              10      POP HL      ;HLは読み出し先のメモリアドレス
                                
001D3F E363 7B               4      LD  A,E
001D40 E364 E61F             7      AND 01FH        ;セグメントのサイズでフィルタする(8K:1F/16K:3F)
       E365                     ASCII16K3   EQU $-1
001D42 E366 1E00             7      LD  E,0     ;DEはROMディスクから読み出すアドレス
001D44 E368 C680             7      ADD A,080H
001D46 E36A 57               4      LD  D,A
                                
001D47 E36B 3E                      DB  03EH
001D48 E36C A7               4      AND A
001D49 E36D 329AE3          13      LD  (DRD_SWC3),A
001D4C E370 7C               4      LD  A,H     ;読み出し先がカートリッジと被っていないかチェック
001D4D E371 FE7B             7      CP  07BH
001D4F E373 3812            12      JR  C,DRD2
001D51 E375 FEC1             7      CP  0C1H
001D53 E377 300E            12      JR  NC,DRD2
001D55 E379 22A1E3          16      LD  (DRD_SWC1),HL   ;被っている場合はデータバッファをフラッシュして一時的に使う
001D58 E37C 2A7EE6          16      LD  HL,(_DTBUF)
001D5B E37F 3E                      DB  03EH
001D5C E380 37               4      SCF
001D5D E381 329AE3          13      LD  (DRD_SWC3),A
001D60 E384 CD16E3          17      CALL    FFLUSHBUF
       E387                     DRD2:
001D63 E387 DD7E0F          19      LD  A,(IX+DPB_BPS)  ;BCは読み出すセクタサイズ
001D66 E38A E607             7      AND 7
001D68 E38C 47               4      LD  B,A
001D69 E38D 4B               4      LD  C,E ;E=0
                                
001D6A E38E EB               4      EX  DE,HL
001D6B E38F EDB0                    LDIR
001D6D E391 D5              11      PUSH    DE
001D6E E392 2680             7      LD  H,080H
001D70 E394 3A43F3          13      LD  A,(0F341H+2)    ;メインRAMに戻す
001D73 E397 CDE2D4          17      CALL    ENASLT
       E39A                     DRD_SWC3:
001D76 E39A A7               4      AND A       ;自己書き換え)被っている場合はSCFになる
001D77 E39B 3012            12      JR  NC,DRD3
                                
001D79 E39D 2A7EE6          16      LD  HL,(_DTBUF)
001D7C E3A0 110000          10      LD  DE,0
       E3A1                     DRD_SWC1    EQU $-2
001D7F E3A3 DD7E0F          19      LD  A,(IX+DPB_BPS)  ;BCは読み出すセクタサイズ
001D82 E3A6 E607             7      AND 7
001D84 E3A8 47               4      LD  B,A
001D85 E3A9 0E00             7      LD  C,0
001D87 E3AB EDB0                    LDIR
001D89 E3AD E1              10      POP HL
001D8A E3AE D5              11      PUSH    DE
       E3AF                     DRD3:
001D8B E3AF E1              10      POP HL
001D8C E3B0 D1              10      POP DE
001D8D E3B1 13               6      INC DE
001D8E E3B2 C1              10      POP BC
001D8F E3B3 1083            13      DJNZ    FDRD1
001D91 E3B5 AF               4      XOR A
001D92 E3B6 310000          10      LD  SP,0
       E3B7                     DRDSP   EQU $-2
       E3B8                     DRDSPH  EQU $-1
001D95 E3B9 FB               4      EI
001D96 E3BA C9              10      RET
                                
       E3BB                     PDWT:
001D97 E3BB 37               4      SCF
001D98 E3BC CB7C             8      BIT 7,H
001D9A E3BE 2058            12      JR  NZ,PDWX
001D9C E3C0 CD16E3          17      CALL    FFLUSHBUF
       E3C3                     PDWT1:
001D9F E3C3 C5              11      PUSH    BC
001DA0 E3C4 D5              11      PUSH    DE
001DA1 E3C5 ED5B7EE6        20      LD  DE,(_DTBUF)
001DA5 E3C9 DD7E0F          19      LD  A,(IX+DPB_BPS)  ;BCは読み出すセクタサイズ
001DA8 E3CC E607             7      AND 7
001DAA E3CE 47               4      LD  B,A
001DAB E3CF 0E00             7      LD  C,0
001DAD E3D1 EDB0                    LDIR
001DAF E3D3 E3              19      EX  (SP),HL
001DB0 E3D4 EB               4      EX  DE,HL
001DB1 E3D5 D5              11      PUSH    DE
001DB2 E3D6 2A7EE6          16      LD  HL,(_DTBUF)
001DB5 E3D9 0601             7      LD  B,1
001DB7 E3DB 37               4      SCF
001DB8 E3DC CD18E4          17      CALL    PDWX
001DBB E3DF 3832            12      JR  C,PDRWERR
001DBD E3E1 D1              10      POP DE
001DBE E3E2 13               6      INC DE
001DBF E3E3 E1              10      POP HL
001DC0 E3E4 C1              10      POP BC
001DC1 E3E5 10D4            13      DJNZ    PDWT
001DC3 E3E7 AF               4      XOR A
001DC4 E3E8 C9              10      RET
       E3E9                     PDRD:
001DC5 E3E9 CB7C             8      BIT 7,H
001DC7 E3EB 202A            12      JR  NZ,PDWXR
001DC9 E3ED CD16E3          17      CALL    FFLUSHBUF
       E3F0                     PDRD1:
001DCC E3F0 C5              11      PUSH    BC
001DCD E3F1 D5              11      PUSH    DE
001DCE E3F2 E5              11      PUSH    HL
001DCF E3F3 2A7EE6          16      LD  HL,(_DTBUF)
001DD2 E3F6 0601             7      LD  B,1
001DD4 E3F8 CD17E4          17      CALL    PDWXR
001DD7 E3FB 3816            12      JR  C,PDRWERR
001DD9 E3FD D1              10      POP DE
001DDA E3FE 2A7EE6          16      LD  HL,(_DTBUF)
001DDD E401 DD7E0F          19      LD  A,(IX+DPB_BPS)  ;BCは読み出すセクタサイズ
001DE0 E404 E607             7      AND 7
001DE2 E406 47               4      LD  B,A
001DE3 E407 0E00             7      LD  C,0
001DE5 E409 EDB0                    LDIR
001DE7 E40B EB               4      EX  DE,HL
001DE8 E40C D1              10      POP DE
001DE9 E40D 13               6      INC DE
001DEA E40E C1              10      POP BC
001DEB E40F 10D8            13      DJNZ    PDRD
001DED E411 AF               4      XOR A
001DEE E412 C9              10      RET
       E413                     PDRWERR:
001DEF E413 E1              10      POP HL
001DF0 E414 D1              10      POP DE
001DF1 E415 C1              10      POP BC
001DF2 E416 C9              10      RET
       E417                     PDWXR:
001DF3 E417 A7               4      AND A
       E418                     PDWX:                   ;CF=0 READ CF=1 WRITE
001DF4 E418 DDCB1266        20      BIT 4,(IX+DPB_DEVICE)   ;デバイス情報
001DF8 E41C 2003            12      JR  NZ,PDWX1
001DFA E41E DD4E06          19      LD  C,(IX+DPB_FATID)    ;メディアバイト
       E421                     PDWX1:
001DFD E421 DD7E13          19      LD  A,(IX+DPB_UNITNO)   ;デバイスドライバ内におけるユニット番号
001E00 E424 C5              11      PUSH    BC
001E01 E425 D5              11      PUSH    DE
001E02 E426 E5              11      PUSH    HL
001E03 E427 DDE5            15      PUSH    IX
001E05 E429 FDE5            15      PUSH    IY
001E07 E42B CDA7FF          17      CALL    H_PHYD
001E0A E42E FDE1            14      POP IY
                                ;   LD  IX,PHYDIO
                                ;   CALL    CALSLT_R
001E0C E430 DDE1            14      POP IX
001E0E E432 E1              10      POP HL
001E0F E433 D1              10      POP DE
001E10 E434 C1              10      POP BC
001E11 E435 D8              11      RET C
       E436                     PDWX2:
001E12 E436 13               6      INC DE
001E13 E437 DD7E0F          19      LD  A,(IX+DPB_BPS)  ;BCは読み出すセクタサイズ
001E16 E43A E607             7      AND 7
001E18 E43C 84               4      ADD A,H
001E19 E43D 67               4      LD  H,A
001E1A E43E 10F6            13      DJNZ    PDWX2
001E1C E440 AF               4      XOR A
001E1D E441 C9              10      RET
[EOF:MSXDISK.ASM:UTF_8]
                                    INCLUDE "LDCCPWK.ASM"
                                
                                ;   LSX-Dodgers CCP WORK
                                
       003B                     PATHX   EQU 59
001E1E E442                     PATHD:  DS  PATHX
001E59 E47D 00                  PATHE:  DB  0
                                
       E47E                     DTA_CCP:
001E5A E47E                         DS  37
                                
       E4A3                     FCB_BAT:
001E7F E4A3                         DS  37
                                
001EA4 E4C8 2020203C4449523E    DIRMES: DB  "   <DIR>  $"
            202024              
001EAF E4D3 20667265652024      FREE:   DB  " free $"
[EOF:LDCCPWK.ASM:UTF_8]
                                    INCLUDE "LDWORK.ASM"
                                
                                ;   LSX-Dodgers WORK0
                                ;
                                ;   CP/M互換BIOS
                                ;   BOOT:アドレス下位1バイトが0になるように
       E4DA                     AT_WORK:
001EB6 E4DA                         DS  WORKAD-AT_WORK
                                
       E500                     CPM_BOOT:
001EDC E500 C30000          10      JP  0
       E503                     _SYS00:     ;(BDOS)プログラム終了
       E503                     CPM_WBOOT:
001EDF E503 C315CA          10      JP  WBOOT1
       E506                     CPM_CONST:
001EE2 E506 C369D2          10      JP  CONSTX
       E509                     _SYS07:     ;(BDOS)コンソール直接入力
       E509                     CPM_CONIN:
001EE5 E509 C38AD1          10      JP  FLGET
       E50C                     CPM_CONOUT:
001EE8 E50C C36CD3          10      JP  CONOUT1
                                
       E50F                     DECBF:              ;10進数表示時のバッファ(5バイト)
001EEB E50F                         DS  5
       E50F                     RR_BUF_HL   EQU DECBF   ;CP/M互換ファイルアクセスの際のランダムレコードの一時的な保管場所
       E511                     RR_BUF_A    EQU DECBF+2 ;計3バイト
                                
       E514                     FDRV:
001EF0 E514 00                      DB  0
       E515                     FNAME:
001EF1 E515                         DS  36
       E539                     SFILE:
001F15 E539                         DS  33      ;DRV FILENAME
       E55A                     _DISKE:
001F36 E55A C306D1          10      JP  SHOW_ERROR
                                
001F39 E55D 0000                LEFTX:  DW  0
001F3B E55F 0000                DTAX:   DW  0
                                
       E561                     ZERO:
       E561                     BEEPD:
001F3D E561 008E01000B000C10        DB  0,08EH,1,0,00BH,0,00CH,010H
001F45 E569 073E08100D00FF          DB  007H,03EH,008H,010H,00DH,0,0FFH
       E562                     RTC_YY  EQU BEEPD+1
       E563                     RTC_MW  EQU BEEPD+2
       E564                     RTC_DD  EQU BEEPD+3
       E565                     RTC_TT  EQU BEEPD+4
       E566                     RTC_MM  EQU BEEPD+5
       E567                     RTC_SS  EQU BEEPD+6
       E562                     ROM_SLT EQU BEEPD+1
                                
       E570                     CHECK:
001F4C E570 00                      DB  0
                                
       E571                     OK:
001F4D E571 4F4B24                  DB  "OK$"
001F50 E574                         DS  5
       E579                     COMERM:
001F55 E579 4572726F722124          DB  "Error!$"
                                ;   システムワークエリア
                                ;   _CYL0:アドレス下位1バイトが080Hになるように
       E580                     _CYL0:
001F5C E580 FF                      DB  0FFH    ;Cylinder
       E581                     _CYL1:
001F5D E581 FF                      DB  0FFH    ;Cylinder
       E582                     _CYL2:
001F5E E582 FF                      DB  0FFH    ;Cylinder
       E583                     _CYL3:
001F5F E583 FF                      DB  0FFH    ;Cylinder
       E584                     _DRIVE:
001F60 E584 00                      DB  0   ;unit number
       E585                     _SEEKSP:
001F61 E585 00                      DB  0   ;Seek speed
       E586                     _ISEEK:
001F62 E586 32                      DB  50  ;
001F63 E587                         DS  1
       E588                     _DRV:
001F64 E588 00                      DB  0
       E589                     _DSK:
001F65 E589 FF                      DB  0FFH
       E58A                     _DTA:
001F66 E58A 8000                    DW  00080H
       E58C                     _CTC:
001F68 E58C 0000                    DW  0
       E58E                     _TXADR:
001F6A E58E 0000                    DW  0
       E590                     _KEYPS:
001F6C E590 0000                    DW  0
       E592                     _KEYD:
001F6E E592 00FF                    DW  0FF00H  ;キーデータ
       E594                     _KEYSP:
001F70 E594 0000                    DB  KEYSP_L,KEYSP_H ;オートリピートの速度
       E596                     _COLORF:
001F72 E596 00                      DB  COLORF  ;色
       E597                     _LINE:
001F73 E597 19                      DB  LINE
                                
       E598                     _FCB:
001F74 E598 0000                    DW  0   ;SEARCH FILES
       E59A                     _FBPS:
001F76 E59A 0000                    DW  0   ;    //
       E59C                     _FBAD:
001F78 E59C 0000                    DW  0   ;    //
       E59E                     _FBCNT:
001F7A E59E 00                      DB  0   ;    //
       E59F                     _FILEN:
001F7B E59F 00                      DB  0   ;    //
       E5A0                     _DIRF:
001F7C E5A0 00                      DB  0   ;bit7:ディレクトリ bit0-6:セクタインデックス
001F7D E5A1                         DS  1
       E5A2                     _WTFATF:
001F7E E5A2 00                      DB  0   ;FATバッファの更新フラグ
001F7F E5A3                         DS  1
       E5A4                     _WTDBF:
001F80 E5A4 00                      DB  0   ;データバッファの更新フラグ
       E5A5                     _DBDRV:
001F81 E5A5 FF                      DB  0FFH    ;データバッファにあるデータを読み込んだドライブ
       E5A6                     _DBSEC:
001F82 E5A6 0000                    DW  0   ;データバッファにあるデータを読み込んだセクタ番号
       E5A8                     _DPB:
001F84 E5A8 0000                    DW  0
       E5AA                     _FATDRV:
001F86 E5AA FF                      DB  0FFH    ;FATバッファに読み込んでいるドライブ
       E5AB                     _FATIX:
001F87 E5AB 00                      DB  0   ;FATバッファに読み込んでいるインデックス
       E5AC                     _FAKEFREE:
001F88 E5AC 0000                    DW  0   ;偽の残量（FATサイズが大きくなると重くなるのでその対策）
                                
001F8A E5AE                         DS  2
                                
       E5B0                     CRTCD:
001F8C E5B0 6F                      DB  06FH
       E5B1                     _WIDTH:
001F8D E5B1 28                      DB  WIDTH
       E5B2                     TVRAMTOP:
001F8E E5B2 5938                    DB  059H,038H
001F90 E5B4 1F02                    DB  01FH,002H
       E5B6                     _LINE2:
001F92 E5B6 19                      DB  019H
       E5B7                     WKE4:
001F93 E5B7 1C                      DB  01CH
       E5B8                     WKE6:
001F94 E5B8 00                      DB  000H
       E5B9                     WK40:
001F95 E5B9 07                      DB  007H
       E5BA                     _PAGE_MINUS:
001F96 E5BA 18FC                    DW  0-WIDTH*LINE
       E5BC                     _WIDTH_MINUS:
001F98 E5BC D8FF                    DW  0-WIDTH
       E5BE                     WK30:
001F9A E5BE 0C                      DB  00CH
       E5BF                     WK31:
       E5BF                     WK1FD0:
001F9B E5BF 20                      DB  020H
                                
001F9C E5C0 0000                CTC0:   DW  INTCTCE
001F9E E5C2 0000                CTC1:   DW  INTCTCE
001FA0 E5C4 0000                CTC2:   DW  INTCTCE
001FA2 E5C6 0000                CTC3:   DW  INTCTCE
001FA4 E5C8 0000                INTVEC: DW  INT
                                
                                ;   LSX-Dodgers 独自BIOS
                                
001FA6 E5CA C3CFD1          10  _INKEY: JP  INKEY
001FA9 E5CD C30FD1          10  _PRINT: JP  PRINT
001FAC E5D0 C306D3          10  _SCRN:  JP  SCRN
001FAF E5D3 C3E6D2          10  _POS:   JP  POS
001FB2 E5D6 C3F1D2          10  _LOC:   JP  LOC
       E5D9                     _CHGDRV:
001FB5 E5D9 C32DE2          10      JP  CHGDRV
       E5DC                     _GETDPB:
001FB8 E5DC C3EBE2          10      JP  GETDPB
       E5DF                     _FFLUSH:
001FBB E5DF C309E3          10      JP  FFLUSH
       E5E2                     _RDFATX:
001FBE E5E2 C305DF          10      JP  RDFATX
001FC1 E5E5 C337E0          10  _RDFAT: JP  RDFAT
001FC4 E5E8 C324E3          10  _WTTRK: JP  WTTRK
001FC7 E5EB C326E3          10  _FDRD:  JP  FDRD
001FCA E5EE C324E3          10  _FDWT:  JP  FDWT
       E5F1                     _BPB2DPB:
001FCD E5F1 C3CFE0          10      JP  BPB2DPB
       E5F4                     _BREAK:
001FD0 E5F4 C390CB          10      JP  END_BATCH
       E5F7                     _GNCL:
001FD3 E5F7 C3B1DF          10      JP  GNCL        ; self-modifying code
       E5F8                     GNCPAT  EQU $-2
       E5FA                     _SNCL:
001FD6 E5FA C3D4DF          10      JP  SNCL        ; self-modifying code
       E5FB                     SNCPAT  EQU $-2
       E5FD                     _COMANL:
001FD9 E5FD C349CA          10      JP  COMANL
                                
       E600                     _WE:
[EOF:LDWORK.ASM:SHIFT_JIS]
                                    INCLUDE "LDCALL.ASM"
                                
                                ;   LSX-Dodgers システムコール(BDOS)
                                ;
                                ;   LSX-Dodgers SYSTEM CALL
                                ;   STABLE:アドレス下位1バイトが0になるように
                                
       E600                     STABLE:
                                ;0
001FDC E600 03E512D143D16FD7        DW  _SYS00,_SYS01,_SYS02,_SYS03
001FE4 E608 71CE71CE49D109E5        DW  _SYS04,_SYS05,_SYS06,_SYS07
001FEC E610 51D173CED5D169D2        DW  _SYS08,_SYS09,_SYS0A,_SYS0B
001FF4 E618 88CE8DCE9CCEADCE        DW  _SYS0C,_SYS0D,_SYS0E,_SYS0F
                                ;1
001FFC E620 01CF48CF91CFC2CF        DW  _SYS10,_SYS11,_SYS12,_SYS13
002004 E628 CACFE0CFF5CFEDCF        DW  _SYS14,_SYS15,_SYS16,_SYS17
00200C E630 3CD041D046D04CD0        DW  _SYS18,_SYS19,_SYS1A,_SYS1B
002014 E638 71CE72D071CE76D0        DW  _SYS1C,_SYS1D,_SYS1E,_SYS1F
                                ;2
00201C E640 71CE2CD034D07DD0        DW  _SYS20,_SYS21,_SYS22,_SYS23
002024 E648 A2D071CEC5DB93DC        DW  _SYS24,_ERROR,_SYS26,_SYS27
00202C E650 34D0ACD07BD26FD7        DW  _SYS28,_SYS29,_SYS2A,_SYS2B
002034 E658 CBD26FD771CECDD0        DW  _SYS2C,_SYS2D,_SYS2E,_SYS2F
                                ;3
00203C E660 C7D071CE71CE71CE        DW  _SYS30,_ERROR,_ERROR,_ERROR
002044 E668 71CE71CE71CE71CE        DW  _ERROR,_ERROR,_ERROR,_ERROR
00204C E670 71CE6FD76FD7EED0        DW  _ERROR,_SYS39,_SYS3A,_SYS5A
                                ;DOS2
002054 E678 54CE                    DW  _DOS2
                                
002056 E67A                         DS  1
       E67B                     _MAX_SEC_SZ_H:
002057 E67B 02                      DB  MAX_SEC_SZ_H
       E67C                     _FATBF:
002058 E67C 00E8                    DW  FATBF
       E67E                     _DTBUF:
00205A E67E 00EE                    DW  DTBUF
                                
                                ;   コントロールコードテーブル
                                ;   CTRLTB:アドレス下位1バイトが080Hになるように
                                
       E680                     CTRLTB:
00205C E680 0000000016D30000        DW  CTRL00,CTRL00,CTRL02,CTRL03 ;  A,B,C
002064 E688 0000000000000000        DW  CTRL04,CTRL05,CTRL06,CTRL07 ;D,E,F,G
00206C E690 0000000000000000        DW  CTRL08,CTRL09,CTRL0A,CTRL0B ;H,I,J,K
002074 E698 0000000000000000        DW  CTRL0C,CTRL0D,CTRL0E,CTRL00 ;L,M,N,O
00207C E6A0 0000000000000000        DW  CTRL00,CTRL00,CTRL12,CTRL00 ;P,Q,R,S
002084 E6A8 0000000000000000        DW  CTRL00,CTRL00,CTRL00,CTRL00 ;T,U,V,W
00208C E6B0 0000000000000000        DW  CTRL00,CTRL00,CTRL0C,CTRL1B ;X,Y,Z,ESC
002094 E6B8 0000000000000000        DW  CTRL1C,CTRL1D,CTRL1E,CTRL1F ;→,←,↑,↓
                                
00209C E6C0 0200                M2D:    DW  2
00209E E6C2 FD02                    DB  0FDH,2
0020A0 E6C4 6401                    DW  356
0020A2 E6C6 FF0728090182            DB  0FFH,7,40,9,1,082H
0020A8 E6CC 0500A7000800            DW  5,0A7H,8
                                
0020AE E6D2 0200                M2HD:   DW  2
0020B0 E6D4 FE01                    DB  0FEH,1
0020B2 E6D6 C704                    DW  1223
0020B4 E6D8 FE064D080184            DB  0FEH,6,77,8,1,084H
0020BA E6DE 0500A7000900            DW  5,0A7H,9
                                
0020C0 E6E4 1617                SDDATA: DB  22,23       ;(FCB)ファイルを最後に変更した時刻
0020C2 E6E6 1415                    DB  20,21       ;(FCB)ファイルを最後に変更した日付
0020C4 E6E8 1A1B                    DB  26,27       ;(FCB)ファイルの先頭クラスタ
0020C6 E6EA 10111213                DB  16,17,18,19 ;(FCB)ファイルのサイズ(バイト単位)
       E6EE                     SDDATAE:
                                
0020CA E6EE                         DS  2
       E6F0                     _FCB_BAT:
0020CC E6F0 A3E4                    DW  FCB_BAT
       E6F2                     _PATH:
0020CE E6F2 42E4                    DW  PATHD
                                
0020D0 E6F4                     SCDIR:  DS  2       ;+14 +15
0020D2 E6F6                     SFBPS:  DS  2       ;FBPS
0020D4 E6F8                     SFNDF:  DS  2       ;FILEN DIRF
                                
0020D6 E6FA 0000                _FATPS: DW  0
0020D8 E6FC 0000                _DIRPS: DW  0
0020DA E6FE 0000                _CLPS:  DW  0
                                
       E700                     _PE:
[EOF:LDCALL.ASM:SHIFT_JIS]
                                    INCLUDE "MSXDPB.ASM"
                                
                                ;   LSX-Dodgers DPB
                                ;   MSX
                                
       E700                     _DEVICE:
                                
                                ;   A:
                                
0020DC E700 0300                    DW  3   ;DPB_FATLN
0020DE E702 EBE5                    DW  _FDRD   ;DPB_DRD
0020E0 E704 EEE5                    DW  _FDWT   ;DPB_DWT
0020E2 E706 F9                      DB  0F9H    ;DPB_FATID
0020E3 E707 03                      DB  3   ;DPB_SECPCL
0020E4 E708 CB02                    DW  715 ;DPB_MAXCL
0020E6 E70A 00                      DB  0   ;DPB_FDMODE
0020E7 E70B 07                      DB  7   ;DPB_DIRSCNT
0020E8 E70C 01                      DB  1   ;DPB_MAXCYL ROMディスクではBPPが格納されている先頭BANK
0020E9 E70D 00                      DB  0   ;DPB_MAXSEC
0020EA E70E 01                      DB  1   ;DPB_FATPS
0020EB E70F 82                      DB  082H    ;DPB_BPS
0020EC E710 0700                    DW  7   ;DPB_DIRPS
0020EE E712 2E                      DB  02EH    ;DPB_DEVICE
0020EF E713 00                      DB  0   ;DPB_UNITNO
0020F0 E714 0A00                    DW  10  ;DPB_ADDCL
0020F2 E716 0000                    DW  0   ;DPB_16
0020F4 E718 0000                    DW  0   ;DPB_18
0020F6 E71A 0000                    DW  0   ;DPB_SDIR
0020F8 E71C 524F4D30                DB  "ROM0"  ;DPB_NAME
                                
                                ;   B:
                                
0020FC E720 0300                    DW  3   ;DPB_FATLN
0020FE E722 EBE5                    DW  _FDRD   ;DPB_DRD
002100 E724 EEE5                    DW  _FDWT   ;DPB_DWT
002102 E726 F9                      DB  0F9H    ;DPB_FATID
002103 E727 03                      DB  3   ;DPB_SECPCL
002104 E728 CB02                    DW  715 ;DPB_MAXCL
002106 E72A 00                      DB  0   ;DPB_FDMODE
002107 E72B 07                      DB  7   ;DPB_DIRSCNT
002108 E72C 2E                      DB  46  ;DPB_MAXCYL ROMディスクではBPPが格納されている先頭BANK
002109 E72D 00                      DB  0   ;DPB_MAXSEC
00210A E72E 01                      DB  1   ;DPB_FATPS
00210B E72F 82                      DB  082H    ;DPB_BPS
00210C E730 0700                    DW  7   ;DPB_DIRPS
00210E E732 2E                      DB  02EH    ;DPB_DEVICE
00210F E733 01                      DB  1   ;DPB_UNITNO
002110 E734 0A00                    DW  10  ;DPB_ADDCL
002112 E736 0000                    DW  0   ;DPB_16
002114 E738 0000                    DW  0   ;DPB_18
002116 E73A 0000                    DW  0   ;DPB_SDIR
002118 E73C 524F4D31                DB  "ROM1"  ;DPB_NAME
                                
                                ;   C:
                                
00211C E740                         DS  32
                                
                                ;   D:
                                
00213C E760                         DS  32
                                
                                ;   E:
                                
00215C E780 0300                    DW  3   ;DPB_FATLN
00215E E782 E9E3                    DW  PDRD    ;DPB_DRD
002160 E784 BBE3                    DW  PDWT    ;DPB_DWT
002162 E786 F9                      DB  0F9H    ;DPB_FATID
002163 E787 03                      DB  3   ;DPB_SECPCL
002164 E788 CB02                    DW  715 ;DPB_MAXCL
002166 E78A FF                      DB  0FFH    ;DPB_FDMODE
002167 E78B 07                      DB  7   ;DPB_DIRSCNT
002168 E78C 50                      DB  80  ;DPB_MAXCYL ROMディスクではBPPが格納されている先頭BANK
002169 E78D 09                      DB  9   ;DPB_MAXSEC
00216A E78E 01                      DB  1   ;DPB_FATPS
00216B E78F 82                      DB  082H    ;DPB_BPS
00216C E790 0700                    DW  7   ;DPB_DIRPS
00216E E792 2D                      DB  02DH    ;DPB_DEVICE
00216F E793 00                      DB  0   ;DPB_UNITNO
002170 E794 0A00                    DW  10  ;DPB_ADDCL
002172 E796 0000                    DW  0   ;DPB_16
002174 E798 0000                    DW  0   ;DPB_18
002176 E79A 0000                    DW  0   ;DPB_SDIR
002178 E79C 44534B30                DB  "DSK0"  ;DPB_NAME
                                
                                ;   F:
                                
00217C E7A0 0300                    DW  3   ;DPB_FATLN
00217E E7A2 E9E3                    DW  PDRD    ;DPB_DRD
002180 E7A4 BBE3                    DW  PDWT    ;DPB_DWT
002182 E7A6 F9                      DB  0F9H    ;DPB_FATID
002183 E7A7 03                      DB  3   ;DPB_SECPCL
002184 E7A8 CB02                    DW  715 ;DPB_MAXCL
002186 E7AA FF                      DB  0FFH    ;DPB_FDMODE
002187 E7AB 07                      DB  7   ;DPB_DIRSCNT
002188 E7AC 50                      DB  80  ;DPB_MAXCYL ROMディスクではBPPが格納されている先頭BANK
002189 E7AD 09                      DB  9   ;DPB_MAXSEC
00218A E7AE 01                      DB  1   ;DPB_FATPS
00218B E7AF 82                      DB  082H    ;DPB_BPS
00218C E7B0 0700                    DW  7   ;DPB_DIRPS
00218E E7B2 2D                      DB  02DH    ;DPB_DEVICE
00218F E7B3 01                      DB  1   ;DPB_UNITNO
002190 E7B4 0A00                    DW  10  ;DPB_ADDCL
002192 E7B6 0000                    DW  0   ;DPB_16
002194 E7B8 0000                    DW  0   ;DPB_18
002196 E7BA 0000                    DW  0   ;DPB_SDIR
002198 E7BC 44534B31                DB  "DSK1"  ;DPB_NAME
                                
                                ;   G:
                                
00219C E7C0 0300                    DW  3   ;DPB_FATLN
00219E E7C2 E9E3                    DW  PDRD    ;DPB_DRD
0021A0 E7C4 BBE3                    DW  PDWT    ;DPB_DWT
0021A2 E7C6 F9                      DB  0F9H    ;DPB_FATID
0021A3 E7C7 03                      DB  3   ;DPB_SECPCL
0021A4 E7C8 CB02                    DW  715 ;DPB_MAXCL
0021A6 E7CA FF                      DB  0FFH    ;DPB_FDMODE
0021A7 E7CB 07                      DB  7   ;DPB_DIRSCNT
0021A8 E7CC 50                      DB  80  ;DPB_MAXCYL ROMディスクではBPPが格納されている先頭BANK
0021A9 E7CD 09                      DB  9   ;DPB_MAXSEC
0021AA E7CE 01                      DB  1   ;DPB_FATPS
0021AB E7CF 82                      DB  082H    ;DPB_BPS
0021AC E7D0 0700                    DW  7   ;DPB_DIRPS
0021AE E7D2 2D                      DB  02DH    ;DPB_DEVICE
0021AF E7D3 02                      DB  2   ;DPB_UNITNO
0021B0 E7D4 0A00                    DW  10  ;DPB_ADDCL
0021B2 E7D6 0000                    DW  0   ;DPB_16
0021B4 E7D8 0000                    DW  0   ;DPB_18
0021B6 E7DA 0000                    DW  0   ;DPB_SDIR
0021B8 E7DC 44534B32                DB  "DSK2"  ;DPB_NAME
                                
                                ;   H:
0021BC E7E0 0300                    DW  3   ;DPB_FATLN
0021BE E7E2 E9E3                    DW  PDRD    ;DPB_DRD
0021C0 E7E4 BBE3                    DW  PDWT    ;DPB_DWT
0021C2 E7E6 F9                      DB  0F9H    ;DPB_FATID
0021C3 E7E7 03                      DB  3   ;DPB_SECPCL
0021C4 E7E8 CB02                    DW  715 ;DPB_MAXCL
0021C6 E7EA FF                      DB  0FFH    ;DPB_FDMODE
0021C7 E7EB 07                      DB  7   ;DPB_DIRSCNT
0021C8 E7EC 50                      DB  80  ;DPB_MAXCYL ROMディスクではBPPが格納されている先頭BANK
0021C9 E7ED 09                      DB  9   ;DPB_MAXSEC
0021CA E7EE 01                      DB  1   ;DPB_FATPS
0021CB E7EF 82                      DB  082H    ;DPB_BPS
0021CC E7F0 0700                    DW  7   ;DPB_DIRPS
0021CE E7F2 2D                      DB  02DH    ;DPB_DEVICE
0021CF E7F3 07                      DB  7   ;DPB_UNITNO
0021D0 E7F4 0A00                    DW  10  ;DPB_ADDCL
0021D2 E7F6 0000                    DW  0   ;DPB_16
0021D4 E7F8 0000                    DW  0   ;DPB_18
0021D6 E7FA 0000                    DW  0   ;DPB_SDIR
0021D8 E7FC 44534B37                DB  "DSK7"  ;DPB_NAME
       E800                     MSX_E:
[EOF:MSXDPB.ASM:UTF_8]
                                
0021DC E800                         DS  03FFFH - $$
003FFF 0623 00                      DB  0
       0624                     LAST_ADR:
                                
                                    END
[EOF:MSX.ASM:UTF_8]
