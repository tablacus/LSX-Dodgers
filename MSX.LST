                                ;*** AILZ80ASM *** Z-80 Assembler, version 1.0.13.0, LST:Full:4
                                ;   LSX-Dodgers for MSX
                                ;   Programmed by
                                ;   Gaku (Lovers/Tablacus)
                                
                                    INCLUDE "MSXDEF.ASM"
                                
                                ;   LSX-Dodgers DEF
                                ;   MSX
                                
       0003                     MAC EQU 3   ;MSX
       0001                     DEV EQU 1
                                
       001D                     VER_6F  EQU 0001DH
                                
       4000                     RUN EQU 04000H
                                
       C700                     START2  EQU 0C700H
       CA06                     BDOS    EQU 0CA06H
       E500                     WORKAD  EQU 0E500H
       E800                     FATBF   EQU 0E800H
       EE00                     DTBUF   EQU 0EE00H
       0028                     WIDTH   EQU 40
       0019                     LINE    EQU 25
       0000                     COLORF  EQU 0
       0000                     KEYSP_H EQU 0
       0000                     KEYSP_L EQU 0
       0008                     COMS    EQU 8
       0002                     MAX_SEC_SZ_H    EQU 2       ;1セクタ1024バイトのサポート(2:off 4:on)
       8000                     BUFFER  EQU 08000H
       0100                     BUF_COM EQU 00100H
                                
       000C                     _RDSLT  EQU 0000CH
       0014                     _WRSLT  EQU 00014H
       001C                     _CALSLT EQU 0001CH
       0024                     _ENASLT EQU 00024H
       0030                     _CALLF  EQU 00030H
                                
       004A                     RDVRM   EQU 0004AH
       004D                     WRTVRM  EQU 0004DH
       006C                     INITXT  EQU 0006CH
       0078                     SETTXT  EQU 00078H
       009C                     CHSNS   EQU 0009CH
       009F                     CHGET   EQU 0009FH
       00A2                     CHPUT   EQU 000A2H
       00AE                     PINLIN  EQU 000AEH
       00B1                     INLIN   EQU 000B1H
       00B4                     QINLIN  EQU 000B4H
       00B7                     BREAKX  EQU 000B7H
       00C0                     BEEP    EQU 000C0H
       00C6                     POSIT   EQU 000C6H
       0138                     RSLREG  EQU 00138H
       0144                     PHYDIO  EQU 00144H  ;MAIN:BIOS:
       0156                     KILBUF  EQU 00156H
                                
       01F5                     REDCLK  EQU 001F5H  ;SUB
       01F9                     WRTCLK  EQU 001F9H  ;SUB
                                
       F341                     RAMAD0  EQU 0F341H
       F342                     RAMAD1  EQU 0F342H
       F343                     RAMAD2  EQU 0F343H
       F344                     RAMAD3  EQU 0F344H
                                
       FEDA                     H_STKE  EQU 0FEDAH
       FFA7                     H_PHYD  EQU 0FFA7H
                                
                                            ;ASCII-8K
       6000                     BANK0_SEL EQU 06000H
       6800                     BANK1_SEL EQU 06800H
       7000                     BANK2_SEL EQU 07000H
       7800                     BANK3_SEL EQU 07800H
                                            ;ASCII-16K
                                ;BANK0_SEL EQU 06000H
                                ;BANK1_SEL EQU 07000H
                                            ;KONAMI-8K
       8000                     KONAMI_BANK2_SEL EQU 08000H
       A000                     KONAMI_BANK3_SEL EQU 0A000H
[EOF:MSXDEF.ASM:UTF_8]
                                    INCLUDE "LDDEF.ASM"
                                
                                ;   LSX-Dodgers DEF
                                
       0001                     VER_1   EQU 1
       0006                     VER_2   EQU 6
       0001                     VER_3   EQU 1
       1D03                     MACW    EQU MAC + 01D00H    ;機種フラグとLD判別フラグ
       0103                     MACD    EQU MAC + DEV * 256 ;機種フラグとデバイスフラグ
       0161                     VER EQU VER_1 * 256 + VER_2 * 16 + VER_3
                                
       0004                     _DVSW   EQU 00004H
       0005                     SYSTEM  EQU 00005H
       000F                     JP_HL   EQU 0000FH
       005C                     FCB1    EQU 0005CH
       006C                     FCB2    EQU 0006CH
       005D                     FCB1FN  EQU FCB1+1
       006D                     FCB2FN  EQU FCB2+1
       0080                     DTA1    EQU 00080H
                                
       FFCA                     EXTBIO  EQU 0FFCAH
                                
       0000                     DPB_FATLN   EQU 00H
       0002                     DPB_DRD     EQU 02H
       0004                     DPB_DWT     EQU 04H
       0006                     DPB_FATID   EQU 06H
       0007                     DPB_SECPCL  EQU 07H
       0008                     DPB_MAXCL   EQU 08H
       000A                     DPB_FDMODE  EQU 0AH
       000B                     DPB_DIRSCNT EQU 0BH
       000C                     DPB_MAXCYL  EQU 0CH
       000D                     DPB_MAXSEC  EQU 0DH
       000E                     DPB_FATPS   EQU 0EH
       000F                     DPB_BPS     EQU 0FH
       0010                     DPB_DIRPS   EQU 10H
       0012                     DPB_DEVICE  EQU 12H
       0013                     DPB_UNITNO  EQU 13H
       0014                     DPB_ADDCL   EQU 14H
                                
       001A                     DPB_SDIR    EQU 1AH
       001C                     DPB_NAME    EQU 1CH
                                
[EOF:LDDEF.ASM:SHIFT_JIS]
000000 4000                         ORG RUN
                                
                                ; MSX ROM header
000000 4000 4142                    DB  "AB"   ; ID for auto-executable ROM
000002 4002 6B40                    DW  INIT_ROM   ; Main program execution address.
000004 4004 0000                    DW  0      ; STATEMENT
000006 4006 0000                    DW  0      ; DEVICE
000008 4008 0000                    DW  0      ; TEXT
00000A 400A 000000000000            DW  0,0,0  ; Reserved
                                    INCLUDE "MSXINIT.ASM"
                                
                                ;   LSX-Dodgers INIT
                                ;   MSX
       4010                     INIT_FDD_BOOT:
000010 4010 F3               4      DI
000011 4011 ED56             8      IM  1
000013 4013 3A42F3          13      LD  A,(RAMAD1)
000016 4016 2640             7      LD  H,040H
000018 4018 CD2400          17      CALL    _ENASLT
00001B 401B 21DC80          10      LD  HL,AT_START2+04000H
00001E 401E 1100C7          10      LD  DE,START2
000021 4021 010021          10      LD  BC,MSX_E-START2
000024 4024 EDB0                    LDIR
000026 4026 2180E7          10      LD  HL,_DEVICE+4*32     ;E
000029 4029 1100E7          10      LD  DE,_DEVICE      ;A
00002C 402C 018000          10      LD  BC,32*4
00002F 402F EDB0                    LDIR
000031 4031 21DFE7          10      LD  HL,_DEVICE+6*32+DPB_NAME+3
000034 4034 3E07             7      LD  A,7
       4036                     FDD_INIT1:
000036 4036 C62F             7      ADD A,'0'-1
000038 4038 77               7      LD  (HL),A
000039 4039 11F4FF          10      LD  DE,DPB_UNITNO-(DPB_NAME+3)
00003C 403C 19              11      ADD HL,DE
00003D 403D D630             7      SUB '0'
00003F 403F 77               7      LD  (HL),A
000040 4040 11ECFF          10      LD  DE,-DPB_UNITNO-1
000043 4043 19              11      ADD HL,DE       ;ここでZフラグは変化しない
000044 4044 20F0            12      JR  NZ,FDD_INIT1
000046 4046 211040          10      LD  HL,INIT_FDD_BOOT
                                
000049 4049 CD11C8          17      CALL    SET_BDOS
00004C 404C 21E9C7          10      LD  HL,ROMCHECKED
00004F 404F 2204C7          16      LD  (INIT_SWC),HL
000052 4052 C300C7          10      JP  START2
                                
       4055                     START:
000055 4055 F3               4      DI
000056 4056 ED56             8      IM  1
000058 4058 3E01             7      LD  A,1
00005A 405A 320068          13      LD  (BANK1_SEL),A
00005D 405D 21DC40          10      LD  HL,AT_START2
000060 4060 1100C7          10      LD  DE,START2
000063 4063 010021          10      LD  BC,MSX_E-START2
000066 4066 EDB0                    LDIR
000068 4068 C300C7          10      JP  START2
                                
       406B                     INIT_ROM:
00006B 406B 3E                      DB  03EH    ;LD A,??
00006C 406C F7              12      RST 30H
00006D 406D F3               4      DI
00006E 406E 32DAFE          13      LD  (H_STKE),A
000071 4071 CDB840          17      CALL    GTSL1_
000074 4074 21DBFE          10      LD  HL,H_STKE+1
000077 4077 77               7      LD  (HL),A
000078 4078 115540          10      LD  DE,START
00007B 407B 23               6      INC HL
00007C 407C 73               7      LD  (HL),E
00007D 407D 23               6      INC HL
00007E 407E 72               7      LD  (HL),D
                                
00007F 407F CD3801          17      CALL    RSLREG      ;read primary slot #
000082 4082 07               4      RLCA
000083 4083 07               4      RLCA
000084 4084 F5              11      PUSH    AF
000085 4085 1605             7      LD  D,4+1
000087 4087 CDBF40          17      CALL    GTSL2_
00008A 408A 3244F3          13      LD  (RAMAD3),A
00008D 408D 3A42F3          13      LD  A,(RAMAD1)
000090 4090 CDAA40          17      CALL    FIXRAMAD
000093 4093 3242F3          13      LD  (RAMAD1),A
000096 4096 3A41F3          13      LD  A,(RAMAD0)
000099 4099 CDAA40          17      CALL    FIXRAMAD
00009C 409C 3241F3          13      LD  (RAMAD0),A
00009F 409F F1              10      POP AF
0000A0 40A0 1603             7      LD  D,2+1
0000A2 40A2 CDBF40          17      CALL    GTSL2_
0000A5 40A5 3243F3          13      LD  (RAMAD2),A
                                
0000A8 40A8 FB               4      EI
0000A9 40A9 C9              10      RET
                                
       40AA                     FIXRAMAD:
0000AA 40AA B7               4      OR  A
0000AB 40AB 2807            12      JR  Z,FIXRAMAD1
0000AD 40AD FEC9             7      CP  0C9H
0000AF 40AF 2803            12      JR  Z,FIXRAMAD1
0000B1 40B1 FEFF             7      CP  0FFH
0000B3 40B3 C0              11      RET NZ
       40B4                     FIXRAMAD1:
0000B4 40B4 3A44F3          13      LD  A,(RAMAD3)
0000B7 40B7 C9              10      RET
                                
       40B8                     GTSL1_:             ;自分のいるスロットを知る
0000B8 40B8 CD3801          17      CALL    RSLREG      ;read primary slot #
0000BB 40BB 0F               4      RRCA
0000BC 40BC 0F               4      RRCA
0000BD 40BD 1601             7      LD  D,1
       40BF                     GTSL2_:
0000BF 40BF E603             7      AND 3       ;[A]=000000PP
0000C1 40C1 5F               4      LD  E,A     ;[E]=000000PP
0000C2 40C2 21C1FC          10      LD  HL,EXPTBL
0000C5 40C5 85               4      ADD A,L     ;桁上りは無い
0000C6 40C6 6F               4      LD  L,A     ;[HL]=EXPTBL+000000PP
0000C7 40C7 7B               4      LD  A,E     ;[A]=000000PP
0000C8 40C8 CB7E            13      BIT 7,(HL)
0000CA 40CA C8              11      RET Z
0000CB 40CB 7D               4      LD  A,L     ;point to SLTTBL entry
0000CC 40CC C604             7      ADD A,4     ;桁上りは無い
0000CE 40CE 6F               4      LD  L,A
0000CF 40CF 7E               7      LD  A,(HL)      ;get currently expansion slot register
       40D0                     GTSL3_:
0000D0 40D0 15               4      DEC D
0000D1 40D1 2803            12      JR  Z,GTSL4_:
0000D3 40D3 0F               4      RRCA
0000D4 40D4 18FA            12      JR  GTSL3_:
       40D6                     GTSL4_:
0000D6 40D6 E60C             7      AND 00CH        ;[A] = 0000SS00
0000D8 40D8 B3               4      OR  E       ;[A] = 0000SSPP
0000D9 40D9 F680             7      OR  080H        ;[A] = 1000SSPP
0000DB 40DB C9              10      RET
                                
       40DC                     AT_START2:
0000DC C700                         ORG START2,AT_START2-RUN
                                
0000DC C700 3100C7          10      LD  SP,START2
0000DF C703 CD11C7          17      CALL    INIT        ;NZならAUTOEXECを実行
       C704                     INIT_SWC    EQU $-2
0000E2 C706 210000          10      LD  HL,0
0000E5 C709 E5              11      PUSH    HL
0000E6 C70A C8              11      RET Z
0000E7 C70B 1106C9          10      LD  DE,AUTOD
0000EA C70E C3FDE5          10      JP  _COMANL
                                
       C711                     INIT:
0000ED C711 DD21900D        14      LD  IX,0D90H
0000F1 C715 0600             7      LD  B,0
       C717                     CHECK_CBIOS1:
0000F3 C717 DD7E00          19      LD  A,(IX+0)
0000F6 C71A FE43             7      CP  'C'
0000F8 C71C 202B            12      JR  NZ,CHECK_CBIOS2
0000FA C71E DD7E01          19      LD  A,(IX+1)
0000FD C721 FE2D             7      CP  '-'
0000FF C723 2024            12      JR  NZ,CHECK_CBIOS2
000101 C725 DD7E02          19      LD  A,(IX+2)
000104 C728 FE42             7      CP  'B'
000106 C72A 201D            12      JR  NZ,CHECK_CBIOS2
000108 C72C DD7E03          19      LD  A,(IX+3)
00010B C72F FE49             7      CP  'I'
00010D C731 2016            12      JR  NZ,CHECK_CBIOS2
00010F C733 DD7E04          19      LD  A,(IX+4)
000112 C736 FE4F             7      CP  'O'
000114 C738 200F            12      JR  NZ,CHECK_CBIOS2
000116 C73A DD7E05          19      LD  A,(IX+5)
000119 C73D EE53             7      XOR 'S'
00011B C73F 2008            12      JR  NZ,CHECK_CBIOS2
                                
00011D C741 328ED1          13      LD  (CBIOS_SWC1),A
000120 C744 32B2D1          13      LD  (CBIOS_SWC2),A
                                
000123 C747 1804            12      JR  CHECK_CBIOS3
       C749                     CHECK_CBIOS2:
000125 C749 DD23            10      INC IX
000127 C74B 10CA            13      DJNZ    CHECK_CBIOS1
       C74D                     CHECK_CBIOS3:
000129 C74D 3ADBFE          13      LD  A,(H_STKE+1)
00012C C750 3262E5          13      LD  (ROM_SLT),A
                                
       C753                     RAMCHK2:
00012F C753 3A42F3          13      LD  A,(RAMAD1)
000132 C756 2640             7      LD  H,040H
000134 C758 CD6AC8          17      CALL    CHK_RAM
000137 C75B 3242F3          13      LD  (RAMAD1),A
       C75E                     RAMCHK1:
00013A C75E 3A41F3          13      LD  A,(RAMAD0)
00013D C761 2600             7      LD  H,00H
00013F C763 CD6AC8          17      CALL    CHK_RAM
000142 C766 3241F3          13      LD  (RAMAD0),A
       C769                     RAMCHK0:
000145 C769 3A42F3          13      LD  A,(RAMAD1)
000148 C76C 2640             7      LD  H,040H
00014A C76E CDDDD4          17      CALL    ENASLT
                                
00014D C771 3A41F3          13      LD  A,(RAMAD0)
000150 C774 2600             7      LD  H,000H
000152 C776 CDDDD4          17      CALL    ENASLT
                                
000155 C779 210000          10      LD  HL,0
000158 C77C 065C             7      LD  B,05CH
00015A C77E 3E                      DB  03EH    ;LD A,??
00015B C77F EF              12      RST 28H
00015C C780 CD77D6          17      CALL    FILL_MEMORY
00015F C783 06A4             7      LD  B,0A4H
000161 C785 AF               4      XOR A
000162 C786 320400          13      LD  (_DVSW),A
000165 C789 CD77D6          17      CALL    FILL_MEMORY
                                
000168 C78C CD11C8          17      CALL    SET_BDOS
                                
                                                ;LSX-Dodgers
00016B C78F 3EE5             7      LD  A,CPM_BOOT/256
00016D C791 320B00          13      LD  (0000BH),A
                                
                                                ;MSXワークエリア
000170 C794 3E03             7      LD  A,3
000172 C796 329BFC          13      LD  (INTFLG),A
                                
                                                ;ROMタイプ判別(ASCII-8K/ASCII-16K)
000175 C799 1E00             7      LD  E,0
000177 C79B 3A62E5          13      LD  A,(ROM_SLT)
00017A C79E 210068          10      LD  HL,BANK1_SEL
00017D C7A1 CD6AD4          17      CALL    WRSLT
                                
000180 C7A4 210060          10      LD  HL,06000H
000183 C7A7 3A62E5          13      LD  A,(ROM_SLT)
000186 C7AA CD29D4          17      CALL    RDSLT
000189 C7AD FE41             7      CP  'A'
00018B C7AF 280F            12      JR  Z,ROM8K
                                                ;ASCII-8K/Konami-8Kではない(ASCII-16K)
00018D C7B1 3E                      DB  03EH    ;LD A,??
00018E C7B2 00               4      NOP
00018F C7B3 3255E3          13      LD  (ASCII16K1),A
000192 C7B6 3259E3          13      LD  (ASCII16K2),A
000195 C7B9 3E3F             7      LD  A,03FH
000197 C7BB 3271E3          13      LD  (ASCII16K3),A
00019A C7BE 1829            12      JR  ROMCHECKED
       C7C0                     ROM8K:              ;Konami-8Kチェック
00019C C7C0 1E01             7      LD  E,1
00019E C7C2 3A62E5          13      LD  A,(ROM_SLT)
0001A1 C7C5 210070          10      LD  HL,BANK2_SEL
0001A4 C7C8 CD6AD4          17      CALL    WRSLT
                                
0001A7 C7CB 1E00             7      LD  E,0
0001A9 C7CD 3A62E5          13      LD  A,(ROM_SLT)
0001AC C7D0 210080          10      LD  HL,KONAMI_BANK2_SEL
0001AF C7D3 CD6AD4          17      CALL    WRSLT
                                
0001B2 C7D6 210080          10      LD  HL,08000H
0001B5 C7D9 3A62E5          13      LD  A,(ROM_SLT)
0001B8 C7DC CD29D4          17      CALL    RDSLT
0001BB C7DF FE41             7      CP  'A'
0001BD C7E1 2006            12      JR  NZ,ROMCHECKED
                                                ;Konami-8K
0001BF C7E3 210080          10      LD  HL,KONAMI_BANK2_SEL
0001C2 C7E6 2260E3          16      LD  (ROM8000H),HL
       C7E9                     ROMCHECKED:
                                                ;MSX2判別
0001C5 C7E9 3AF8FA          13      LD  A,(EXBRSA)
0001C8 C7EC B7               4      OR  A
0001C9 C7ED 3E28             7      LD  A,40
0001CB C7EF 2802            12      JR  Z,ISMSX1
0001CD C7F1 3E50             7      LD  A,80        ;MSX2以降は80桁で起動
       C7F3                     ISMSX1:
0001CF C7F3 32AEF3          13      LD  (LINL40),A
0001D2 C7F6 32B1E5          13      LD  (_WIDTH),A
0001D5 C7F9 DD216C00        14      LD  IX,INITXT
0001D9 C7FD CD83D3          17      CALL    CALSLT_R
0001DC C800 DD217800        14      LD  IX,SETTXT
0001E0 C804 CD83D3          17      CALL    CALSLT_R
                                
0001E3 C807 2112C9          10      LD  HL,INIMES
0001E6 C80A CD86CE          17      CALL    MSX
       C80D                     INIT1:
0001E9 C80D AF               4      XOR A
0001EA C80E FE03             7      CP  3
0001EC C810 C9              10      RET
       C811                     SET_BDOS:
0001ED C811 3E                      DB  03EH    ;LD A,??
0001EE C812 E9               4      JP  (HL)
0001EF C813 320F00          13      LD  (0000FH),A
                                
0001F2 C816 3EC3             7      LD  A,0C3H      ;JP
0001F4 C818 2103E5          10      LD  HL,CPM_WBOOT
0001F7 C81B 320000          13      LD  (00000H),A
0001FA C81E 220100          16      LD  (00001H),HL ;IPL
                                
0001FD C821 2106CA          10      LD  HL,BDOS
000200 C824 320500          13      LD  (00005H),A
000203 C827 220600          16      LD  (00006H),HL ;BDOS
                                
000206 C82A 210000          10      LD  HL,0
000209 C82D 322800          13      LD  (00028H),A
00020C C830 222900          16      LD  (00029H),HL ;BDOS
                                                ;インタースロットコール
00020F C833 21DDD3          10      LD  HL,RDSLTR
000212 C836 320C00          13      LD  (_RDSLT),A
000215 C839 220D00          16      LD  (_RDSLT+1),HL
                                
000218 C83C 21E6D3          10      LD  HL,WRSLTR
00021B C83F 321400          13      LD  (_WRSLT),A
00021E C842 221500          16      LD  (_WRSLT+1),HL
                                
000221 C845 219FD3          10      LD  HL,CALSLTR
000224 C848 321C00          13      LD  (_CALSLT),A
000227 C84B 221D00          16      LD  (_CALSLT+1),HL
                                
00022A C84E 21DDD4          10      LD  HL,ENASLT
00022D C851 322400          13      LD  (_ENASLT),A
000230 C854 222500          16      LD  (_ENASLT+1),HL
                                
000233 C857 218FD3          10      LD  HL,CALLF
000236 C85A 323000          13      LD  (_CALLF),A
000239 C85D 223100          16      LD  (_CALLF+1),HL
                                
00023C C860 21EFD3          10      LD  HL,INT38H
00023F C863 323800          13      LD  (00038H),A
000242 C866 223900          16      LD  (00038H+1),HL
000245 C869 C9              10      RET
       C86A                     CHK_RAM:
000246 C86A E5              11      PUSH    HL
000247 C86B CDBFC8          17      CALL    CHK_RAM0
00024A C86E E1              10      POP HL
00024B C86F C8              11      RET Z
00024C C870 3AC1FC          13      LD  A,(EXPTBL)      ;スロット#0
00024F C873 E680             7      AND 080H
000251 C875 CD96C8          17      CALL    CHK_RAM_SLT
000254 C878 C8              11      RET Z
000255 C879 3AC2FC          13      LD  A,(EXPTBL+1)        ;スロット#1
000258 C87C E680             7      AND 080H
00025A C87E C601             7      ADD A,1
00025C C880 CD96C8          17      CALL    CHK_RAM_SLT
00025F C883 C8              11      RET Z
000260 C884 3AC3FC          13      LD  A,(EXPTBL+2)        ;スロット#2
000263 C887 E680             7      AND 080H
000265 C889 C602             7      ADD A,2
000267 C88B CD96C8          17      CALL    CHK_RAM_SLT
00026A C88E C8              11      RET Z
00026B C88F 3AC4FC          13      LD  A,(EXPTBL+3)        ;スロット#3
00026E C892 E680             7      AND 080H
000270 C894 C603             7      ADD A,3
       C896                     CHK_RAM_SLT:
000272 C896 E5              11      PUSH    HL
000273 C897 CDBFC8          17      CALL    CHK_RAM0        ;スロット#X or X-0
000276 C89A E1              10      POP HL
000277 C89B C8              11      RET Z
000278 C89C CB79             8      BIT 7,C
00027A C89E 281A            12      JR  Z,CHK_RAM_E     ;スロットは拡張されていない
00027C C8A0 79               4      LD  A,C
00027D C8A1 C604             7      ADD A,4*1           ;スロット#X-1
00027F C8A3 E5              11      PUSH    HL
000280 C8A4 CDBFC8          17      CALL    CHK_RAM0
000283 C8A7 E1              10      POP HL
000284 C8A8 C8              11      RET Z
000285 C8A9 79               4      LD  A,C
000286 C8AA C608             7      ADD A,4*2           ;スロット#X-2
000288 C8AC E5              11      PUSH    HL
000289 C8AD CDBFC8          17      CALL    CHK_RAM0
00028C C8B0 E1              10      POP HL
00028D C8B1 C8              11      RET Z
00028E C8B2 79               4      LD  A,C
00028F C8B3 C60C             7      ADD A,4*3           ;スロット#X-3
000291 C8B5 E5              11      PUSH    HL
000292 C8B6 CDBFC8          17      CALL    CHK_RAM0
000295 C8B9 E1              10      POP HL
       C8BA                     CHK_RAM_E:
000296 C8BA AF               4      XOR A
000297 C8BB 3C               4      INC A           ;ZF=0にする
000298 C8BC 3E00             7      LD  A,0
00029A C8BE C9              10      RET
                                
       C8BF                     CHK_RAM0:
00029B C8BF 4F               4      LD  C,A
00029C C8C0 3A62E5          13      LD  A,(ROM_SLT)
00029F C8C3 B9               4      CP  C
0002A0 C8C4 28F4            12      JR  Z,CHK_RAM_E
0002A2 C8C6 2E00             7      LD  L,0
       C8C8                     CHK_RAM1:
0002A4 C8C8 79               4      LD  A,C
0002A5 C8C9 DD210C00        14      LD  IX,_RDSLT
0002A9 C8CD CDFAC8          17      CALL    CALSLT_RAM
0002AC C8D0 C6E5             7      ADD A,0E5H
0002AE C8D2 47               4      LD  B,A
0002AF C8D3 5F               4      LD  E,A
0002B0 C8D4 79               4      LD  A,C
0002B1 C8D5 DD211400        14      LD  IX,_WRSLT
0002B5 C8D9 CDFAC8          17      CALL    CALSLT_RAM
0002B8 C8DC 79               4      LD  A,C
0002B9 C8DD DD210C00        14      LD  IX,_RDSLT
0002BD C8E1 CDFAC8          17      CALL    CALSLT_RAM
0002C0 C8E4 B8               4      CP  B
0002C1 C8E5 C0              11      RET NZ
0002C2 C8E6 D6E5             7      SUB 0E5H
0002C4 C8E8 79               4      LD  A,C
0002C5 C8E9 5F               4      LD  E,A
0002C6 C8EA DD211400        14      LD  IX,_WRSLT
0002CA C8EE CDFAC8          17      CALL    CALSLT_RAM
0002CD C8F1 24               4      INC H
0002CE C8F2 7D               4      LD  A,L
0002CF C8F3 C604             7      ADD A,4
0002D1 C8F5 6F               4      LD  L,A
0002D2 C8F6 20D0            12      JR  NZ,CHK_RAM1
0002D4 C8F8 79               4      LD  A,C     ;ZF=1のハズ
0002D5 C8F9 C9              10      RET
                                
       C8FA                     CALSLT_RAM:
0002D6 C8FA C5              11      PUSH    BC
0002D7 C8FB E5              11      PUSH    HL
0002D8 C8FC FD2AC0FC        20      LD  IY,(EXPTBL-1) ;メインROMスロット
0002DC C900 CD1C00          17      CALL    _CALSLT
0002DF C903 E1              10      POP HL
0002E0 C904 C1              10      POP BC
0002E1 C905 C9              10      RET
                                
0002E2 C906 4155544F45584543    AUTOD:  DB  "AUTOEXEC "
            20                  
0002EB C90F 413A00              AUTODV: DB  "A:",0
                                
0002EE C912 0C4C53582D446F64    INIMES: DB  00CH,"LSX-Dodgers for MSX v"
            6765727320666F72    
            204D53582076        
000304 C928 312E                    DB  030H + VER_1, '.'
000306 C92A 3631                    DB  030H + VER_2 ,030H + VER_3
000308 C92C 62                      DB  'b'
000309 C92D 2047616B750D0A          DB  " Gaku",0DH,0AH
000310 C934 00                      DB  0
                                
000311 C935 0300                M2DD:   DW  3
000313 C937 F902                    DB  0F9H,2
000315 C939 CB02                    DW  715
000317 C93B FF0750090182            DB  0FFH,7,80,9,1,082H
00031D C941 0700A7000A00            DW  7,0A7H,10
       C947                     M2DDE:
[EOF:MSXINIT.ASM:SHIFT_JIS]
                                    INCLUDE "MSXCCP.ASM"
                                
                                ;   LSX-Dodgers CCP
                                ;   MSX
                                
       C947                     INITE:
000323 C947                         DS  BDOS-INITE
0003E2 CA06 C346CE          10      JP  BDOS0
       CA09                     S27BUF_COM:
0003E5 CA09 110001          10      LD  DE,BUF_COM
0003E8 CA0C CD4AD0          17      CALL    _SYS1A      ;(BDOS)DTAの設定
0003EB CA0F 2100FE          10      LD  HL,0-BUF_COM-00100H ;バッファー+スタック予備(0100H)
0003EE CA12 C3EBCA          10      JP  S27BUF2
       CA15                     WBOOT1:
0003F1 CA15 ED7B0600        20      LD  SP,(SYSTEM+1)
0003F5 CA19 3E03             7      LD  A,3
0003F7 CA1B CD10D1          17      CALL    MSG_A
       CA1E                     WBOOT2:
[EOF:MSXCCP.ASM:UTF_8]
                                    INCLUDE "LDCCP.ASM"
                                
                                ;   LSX-Dodgers CCP
                                
       CA1E                     COMMAND:
0003FA CA1E 3AAFE4          13      LD  A,(FCB_BAT)
0003FD CA21 B7               4      OR  A
0003FE CA22 C264CB          10      JP  NZ,C_BAT1
000401 CA25 CDD8CA          17      CALL    SETDTA1
000404 CA28 3A0400          13      LD  A,(_DVSW)
000407 CA2B C641             7      ADD A,'A'
000409 CA2D CD10D1          17      CALL    MSG_A
00040C CA30 3E3E             7      LD  A,'>'
00040E CA32 CD10D1          17      CALL    MSG_A
000411 CA35 3E50             7      LD  A,80
000413 CA37 12               7      LD  (DE),A
000414 CA38 CDD0D1          17      CALL    _SYS0A      ;(BDOS)文字列入力
000417 CA3B CD59CC          17      CALL    LTNL
       CA3E                     COMMAND2:
00041A CA3E 118200          10      LD  DE,DTA1+2
00041D CA41 CDFDE5          17      CALL    _COMANL
000420 CA44 30D8            12      JR  NC,COMMAND
000422 CA46 1179E5          10      LD  DE,COMERM
000425 CA49 CD77CE          17      CALL    _SYS09      ;(BDOS)文字列出力
000428 CA4C C7              12      RST 0
                                
       CA4D                     COMANL:
000429 CA4D CDCBD5          17      CALL    FILE
00042C CA50 3A19E5          13      LD  A,(FNAME+4)
00042F CA53 FE20             7      CP  020H
000431 CA55 201C            12      JR  NZ,COMB2
000433 CA57 D5              11      PUSH    DE
000434 CA58 1115E5          10      LD  DE,FNAME
000437 CA5B 1A               7      LD  A,(DE)
000438 CA5C FE20             7      CP  020H
00043A CA5E 2844            12      JR  Z,SDVSW
00043C CA60 1B               6      DEC DE
00043D CA61 1A               7      LD  A,(DE)
00043E CA62 C6FF             7      ADD A,0FFH
000440 CA64 3809            12      JR  C,COMB
000442 CA66 13               6      INC DE
                                
000443 CA67 2116CE          10      LD  HL,COMTB
000446 CA6A 0608             7      LD  B,COMS
000448 CA6C CD5AD8          17      CALL    CPNAME
       CA6F                     COMB:
00044B CA6F D1              10      POP DE
00044C CA70 D20F00          10      JP  NC,JP_HL
       CA73                     COMB2:
00044F CA73 EB               4      EX  DE,HL
000450 CA74 2241CB          16      LD  (COMSWC),HL
000453 CA77 F5              11      PUSH    AF
000454 CA78 CDF9CA          17      CALL    CEXE4
000457 CA7B F1              10      POP AF
000458 CA7C 2115E5          10      LD  HL,FNAME
00045B CA7F 116D00          10      LD  DE,FCB2FN   ;COMMAND NAME
00045E CA82 010B00          10      LD  BC,11
000461 CA85 EDB0                    LDIR
000463 CA87 114EE4          10      LD  DE,PATHD
       CA8A                     CEX1:
000466 CA8A 1A               7      LD  A,(DE)
000467 CA8B FE20             7      CP  020H
000469 CA8D D8              11      RET C
00046A CA8E CDC0D5          17      CALL    FILEC
00046D CA91 D5              11      PUSH    DE
00046E CA92 216D00          10      LD  HL,FCB2FN   ;COMMAND NAME
000471 CA95 1115E5          10      LD  DE,FNAME
000474 CA98 010B00          10      LD  BC,11
000477 CA9B EDB0                    LDIR
000479 CA9D CDF9CA          17      CALL    CEXE4
00047C CAA0 D1              10      POP DE
00047D CAA1 13               6      INC DE
00047E CAA2 18E6            12      JR  CEX1
                                
       CAA4                     SDVSW:
000480 CAA4 F1              10      POP AF
000481 CAA5 3A14E5          13      LD  A,(FDRV)
000484 CAA8 3D               4      DEC A
000485 CAA9 5F               4      LD  E,A
000486 CAAA 0E0E             7      LD  C,00EH      ;(BDOS)カレントドライブの設定
000488 CAAC 1831            12      JR  SYSTEM0
                                
       CAAE                     OPEN1:
00048A CAAE 2114E5          10      LD  HL,FDRV
       CAB1                     OPEN:
00048D CAB1 0E11             7      LD  C,011H      ;(BDOS)ファイルの検索
       CAB3                     OPEN3:
00048F CAB3 D5              11      PUSH    DE
000490 CAB4 118AE4          10      LD  DE,DTA_CCP
000493 CAB7 CDD5CA          17      CALL    SETDTA
000496 CABA EB               4      EX  DE,HL
000497 CABB CDDFCA          17      CALL    SYSTEM0
00049A CABE D1              10      POP DE
00049B CABF C9              10      RET
                                
       CAC0                     OPEN2:
00049C CAC0 0E12             7      LD  C,012H
00049E CAC2 18EF            12      JR  OPEN3
                                
       CAC4                     DEFCB:              ;Z=Ok NZ=Error
0004A0 CAC4 118AE4          10      LD  DE,DTA_CCP
0004A3 CAC7 CDDDCA          17      CALL    SYSC0F
                                
0004A6 CACA 11ABE4          10      LD  DE,DTA_CCP+33   ;(FCB)ランダムレコード
0004A9 CACD 0604             7      LD  B,4
0004AB CACF CD2ACD          17      CALL    ZERO_MEMORY_DE
       CAD2                     SETDTA100:
0004AE CAD2 110080          10      LD  DE,BUFFER
       CAD5                     SETDTA:
0004B1 CAD5 C34AD0          10      JP  _SYS1A      ;(BDOS)DTAの設定
                                
       CAD8                     SETDTA1:
0004B4 CAD8 118000          10      LD  DE,DTA1
0004B7 CADB 18F8            12      JR  SETDTA
                                
       CADD                     SYSC0F:
0004B9 CADD 0E0F             7      LD  C,00FH      ;(BDOS)ファイルのオープン
       CADF                     SYSTEM0:
0004BB CADF CD0500          17      CALL    SYSTEM
0004BE CAE2 B7               4      OR  A
0004BF CAE3 C9              10      RET
                                
       CAE4                     C_CD:
0004C0 CAE4 0E5A             7      LD  C,05AH
0004C2 CAE6 18F7            12      JR  SYSTEM0
                                
       CAE8                     S27BUF:
0004C4 CAE8 21007F          10      LD  HL,0-BUFFER-00100H  ;バッファー+スタック予備(0100H)
       CAEB                     S27BUF2:
0004C7 CAEB 39              11      ADD HL,SP
0004C8 CAEC 2E00             7      LD  L,0
0004CA CAEE 7C               4      LD  A,H
0004CB CAEF E6F8             7      AND 0F8H
0004CD CAF1 67               4      LD  H,A
       CAF2                     S27DTA:
0004CE CAF2 118AE4          10      LD  DE,DTA_CCP
       CAF5                     S27:
0004D1 CAF5 0E27             7      LD  C,027H      ;(BDOS)ランダムブロック読み込み
0004D3 CAF7 18E6            12      JR  SYSTEM0
                                
       CAF9                     CEXE4:
0004D5 CAF9 211DE5          10      LD  HL,FNAME+8
0004D8 CAFC 7E               7      LD  A,(HL)
0004D9 CAFD FE20             7      CP  020H
0004DB CAFF 2007            12      JR  NZ,CEXE7
0004DD CB01 3E3F             7      LD  A,'?'
0004DF CB03 77               7      LD  (HL),A
0004E0 CB04 23               6      INC HL
0004E1 CB05 77               7      LD  (HL),A
0004E2 CB06 23               6      INC HL
0004E3 CB07 77               7      LD  (HL),A
       CB08                     CEXE7:
0004E4 CB08 CDAECA          17      CALL    OPEN1
       CB0B                     CEXE5:
0004E7 CB0B C0              11      RET NZ
0004E8 CB0C 2A94E4          16      LD  HL,(DTA_CCP+1+9)
0004EB CB0F 7C               4      LD  A,H
0004EC CB10 CDE2D8          17      CALL    CAP
0004EF CB13 67               4      LD  H,A
0004F0 CB14 7D               4      LD  A,L
0004F1 CB15 CDE2D8          17      CALL    CAP
0004F4 CB18 6F               4      LD  L,A
0004F5 CB19 3A93E4          13      LD  A,(DTA_CCP+1+8)
0004F8 CB1C CDE2D8          17      CALL    CAP
0004FB CB1F D642             7      SUB 'B'
0004FD CB21 282C            12      JR  Z,C_BAT
0004FF CB23 3D               4      DEC A       ;'C'
000500 CB24 2805            12      JR  Z,C_EXE
       CB26                     CEXE6:
000502 CB26 CDC0CA          17      CALL    OPEN2
000505 CB29 18E0            12      JR  CEXE5
                                
       CB2B                     C_EXE:
000507 CB2B 7C               4      LD  A,H
000508 CB2C FE4D             7      CP  'M'
00050A CB2E 20F6            12      JR  NZ,CEXE6
                                
00050C CB30 CDC4CA          17      CALL    DEFCB
00050F CB33 CD09CA          17      CALL    S27BUF_COM
000512 CB36 3D               4      DEC A
000513 CB37 37               4      SCF
000514 CB38 C0              11      RET NZ
000515 CB39 7C               4      LD  A,H
000516 CB3A B5               4      OR  L
000517 CB3B 37               4      SCF
000518 CB3C C8              11      RET Z
000519 CB3D CDD8CA          17      CALL    SETDTA1
00051C CB40 110000          10      LD  DE,0                ; self-modifying code
       CB41                     COMSWC  EQU $-2
00051F CB43 ED7B0600        20      LD  SP,(SYSTEM+1)
000523 CB47 67               4      LD  H,A             ; A=0 in SETDTA1(_SYS1A)
000524 CB48 6F               4      LD  L,A
000525 CB49 E5              11      PUSH    HL              ; push $0000 (reboot address)
000526 CB4A 24               4      INC H
000527 CB4B E5              11      PUSH    HL              ; push $0100 (TPA address)
000528 CB4C C3F5CC          10      JP  SETFCB              ; and JP $0100
                                
       CB4F                     C_BAT:
00052B CB4F 114154          10      LD  DE,'A'+'T'*256
00052E CB52 ED52            15      SBC HL,DE
000530 CB54 20D0            12      JR  NZ,CEXE6
                                
000532 CB56 CDC4CA          17      CALL    DEFCB
                                
000535 CB59 218AE4          10      LD  HL,DTA_CCP
000538 CB5C 11AFE4          10      LD  DE,FCB_BAT
00053B CB5F 012500          10      LD  BC,37
00053E CB62 EDB0                    LDIR
       CB64                     C_BAT1:
000540 CB64 CDD2CA          17      CALL    SETDTA100
000543 CB67 CD9BCB          17      CALL    FGETC_BAT
000546 CB6A 218100          10      LD  HL,DTA1+1
000549 CB6D 2025            12      JR  NZ,END_BATCH
00054B CB6F FE21             7      CP  021H        ;スペースや改行など制御文字を飛ばす
00054D CB71 38F1            12      JR  C,C_BAT1
00054F CB73 3620            10      LD  (HL),' '
000551 CB75 23               6      INC HL
       CB76                     C_BAT2:
000552 CB76 77               7      LD  (HL),A
000553 CB77 23               6      INC HL
000554 CB78 7D               4      LD  A,L
000555 CB79 3C               4      INC A       ;L==0FFH
000556 CB7A 2809            12      JR  Z,RUN_BATCH
000558 CB7C CD9BCB          17      CALL    FGETC_BAT
00055B CB7F 2004            12      JR  NZ,RUN_BATCH
00055D CB81 FE20             7      CP  020H
00055F CB83 30F1            12      JR  NC,C_BAT2
       CB85                     RUN_BATCH:
000561 CB85 7D               4      LD  A,L
000562 CB86 D67F             7      SUB DTA1-1
000564 CB88 328000          13      LD  (DTA1),A
000567 CB8B FE04             7      CP  4
000569 CB8D 3805            12      JR  C,END_BATCH
00056B CB8F 3600            10      LD  (HL),0
00056D CB91 C33ECA          10      JP  COMMAND2
       CB94                     END_BATCH:
000570 CB94 AF               4      XOR A       ;バッチファイルを閉じる
000571 CB95 32AFE4          13      LD  (FCB_BAT),A
000574 CB98 C300E5          10      JP  CPM_BOOT
                                
       CB9B                     FGETC_BAT:
000577 CB9B 11AFE4          10      LD  DE,FCB_BAT
       CB9E                     FGETC:              ;1文字ずつ読み込む
00057A CB9E E5              11      PUSH    HL      ;Z:成功
00057B CB9F 210100          10      LD  HL,1
00057E CBA2 CDF5CA          17      CALL    S27
000581 CBA5 E1              10      POP HL
000582 CBA6 3A0080          13      LD  A,(BUFFER)
000585 CBA9 C9              10      RET
                                
       CBAA                     C_DEL:
000586 CBAA CDF5CC          17      CALL    SETFCB
000589 CBAD CD4CD1          17      CALL    _SYS08      ;(BDOS)エコーなしコンソール入力
                                
00058C CBB0 0E13             7      LD  C,013H
00058E CBB2 180A            12      JR  CDEL1       ;(BDOS)ファイルの削除
                                
       CBB4                     C_REN:
000590 CBB4 CDF5CC          17      CALL    SETFCB
000593 CBB7 3E10             7      LD  A,010H      ;ディレクトリも対象にする
000595 CBB9 326900          13      LD  (FCB1+13),A ;属性
000598 CBBC 0E17             7      LD  C,017H      ;(BDOS)ファイル名の変更
       CBBE                     CDEL1:
00059A CBBE 115C00          10      LD  DE,FCB1
00059D CBC1 CD0500          17      CALL    SYSTEM
0005A0 CBC4 C6FF             7      ADD A,0FFH
0005A2 CBC6 C9              10      RET
                                
       CBC7                     C_DIR:
0005A3 CBC7 CDC0D5          17      CALL    FILEC
0005A6 CBCA 2115E5          10      LD  HL,FDRV+1
0005A9 CBCD CD0BCE          17      CALL    CWILD1
0005AC CBD0 3EF1             7      LD  A,0F1H
0005AE CBD2 3221E5          13      LD  (FDRV+13),A
0005B1 CBD5 CDAECA          17      CALL    OPEN1
       CBD8                     CDIR1:
0005B4 CBD8 B7               4      OR  A
0005B5 CBD9 2008            12      JR  NZ,PDSKF
0005B7 CBDB CD26CC          17      CALL    P_NAME
0005BA CBDE CDC0CA          17      CALL    OPEN2
0005BD CBE1 18F5            12      JR  CDIR1
       CBE3                     PDSKF:
0005BF CBE3 3A14E5          13      LD  A,(FDRV)
0005C2 CBE6 5F               4      LD  E,A
0005C3 CBE7 0E1B             7      LD  C,01BH      ;(BDOS)ディスク情報の獲得
0005C5 CBE9 CD0500          17      CALL    SYSTEM
0005C8 CBEC 4F               4      LD  C,A     ;C←1クラスタ辺りの論理セクタ数
0005C9 CBED C601             7      ADD A,001H
0005CB CBEF D8              11      RET C       ;Aが0FFHだった場合
0005CC CBF0 3E06             7      LD  A,8-2
       CBF2                     PDS1:               ;HL=未使用クラスタの総数
0005CE CBF2 3C               4      INC A
0005CF CBF3 CB19             8      RR  C
0005D1 CBF5 30FB            12      JR  NC,PDS1
       CBF7                     PDS2:               ;B←論理セクタのサイズの上位8ビット
0005D3 CBF7 3C               4      INC A
0005D4 CBF8 CB18             8      RR  B
0005D6 CBFA 30FB            12      JR  NC,PDS2
0005D8 CBFC 47               4      LD  B,A
                                
0005D9 CBFD 110000          10      LD  DE,0
       CC00                     PDS3:
0005DC CC00 29              11      ADD HL,HL
0005DD CC01 EB               4      EX  DE,HL
0005DE CC02 ED6A            15      ADC HL,HL
0005E0 CC04 EB               4      EX  DE,HL
0005E1 CC05 10F9            13      DJNZ    PDS3
       CC07                     PDSKF1:
0005E3 CC07 CD93CC          17      CALL    PRDEC_DEHL
0005E6 CC0A 11DFE4          10      LD  DE,FREE
0005E9 CC0D CD77CE          17      CALL    _SYS09      ;(BDOS)文字列出力
0005EC CC10 CD80CC          17      CALL    PUTDRV
0005EF CC13 3E5C             7      LD  A,05CH      ;\
0005F1 CC15 CD10D1          17      CALL    MSG_A
0005F4 CC18 2A22E5          16      LD  HL,(FDRV+14)    ;ディレクトリのクラスタ番号
0005F7 CC1B AF               4      XOR A
0005F8 CC1C 11FEFF          10      LD  DE,0-2
0005FB CC1F 19              11      ADD HL,DE
0005FC CC20 23               6      INC HL
0005FD CC21 DC90CC          17      CALL    C,PRDEC_HL
000600 CC24 1833            12      JR  LTNL
                                
       CC26                     P_NAME:
000602 CC26 3A8BE4          13      LD  A,(DTA_CCP+1)
000605 CC29 FE2E             7      CP  '.'
000607 CC2B C8              11      RET Z
                                
000608 CC2C 3A96E4          13      LD  A,(DTA_CCP+1+00BH)
00060B CC2F F5              11      PUSH    AF
00060C CC30 CB67             8      BIT 4,A
00060E CC32 2808            12      JR  Z,DIR3
000610 CC34 11D4E4          10      LD  DE,DIRMES
000613 CC37 CD77CE          17      CALL    _SYS09      ;(BDOS)文字列出力
000616 CC3A 180A            12      JR  DIR6
       CC3C                     DIR3:
000618 CC3C ED5BA9E4        20      LD  DE,(DTA_CCP+1+01EH)
00061C CC40 2AA7E4          16      LD  HL,(DTA_CCP+1+01CH)
00061F CC43 CD93CC          17      CALL    PRDEC_DEHL
       CC46                     DIR6:
000622 CC46 F1              10      POP AF
000623 CC47 0F               4      RRCA
000624 CC48 9F               4      SBC A,A
000625 CC49 E60A             7      AND '*'-020H
000627 CC4B C620             7      ADD A,020H
000629 CC4D CD10D1          17      CALL    MSG_A
00062C CC50 CD80CC          17      CALL    PUTDRV
00062F CC53 218BE4          10      LD  HL,DTA_CCP+1
000632 CC56 CDD3CC          17      CALL    FPRNT
                                
       CC59                     LTNL:
000635 CC59 1E03             7      LD  E,3
000637 CC5B C3CDE5          10      JP  _PRINT
                                
       CC5E                     C_PATH:
00063A CC5E CDA2D6          17      CALL    SPCUT
00063D CC61 214EE4          10      LD  HL,PATHD
000640 CC64 FE21             7      CP  021H
000642 CC66 300C            12      JR  NC,CPATH0
       CC68                     CPATHP:
000644 CC68 7E               7      LD  A,(HL)
000645 CC69 23               6      INC HL
000646 CC6A FE20             7      CP  020H
000648 CC6C 3F               4      CCF
000649 CC6D 30EA            12      JR  NC,LTNL
00064B CC6F CD10D1          17      CALL    MSG_A
00064E CC72 18F4            12      JR  CPATHP
       CC74                     CPATH0:
000650 CC74 FE3B             7      CP  ';'
000652 CC76 2001            12      JR  NZ,CPATH1
000654 CC78 13               6      INC DE
       CC79                     CPATH1:
000655 CC79 EB               4      EX  DE,HL
000656 CC7A 013B00          10      LD  BC,PATHX
000659 CC7D EDB0                    LDIR
00065B CC7F C9              10      RET
                                
       CC80                     PUTDRV:
00065C CC80 3A14E5          13      LD  A,(FDRV)
00065F CC83 CDD5D6          17      CALL    GETDRV1
000662 CC86 C641             7      ADD A,'A'
000664 CC88 CD10D1          17      CALL    MSG_A
000667 CC8B 3E3A             7      LD  A,':'
       CC8D                     MSG_AR:
000669 CC8D C310D1          10      JP  MSG_A
                                
       CC90                     PRDEC_HL:
00066C CC90 AF               4      XOR A
00066D CC91 5F               4      LD  E,A
00066E CC92 57               4      LD  D,A
       CC93                     PRDEC_DEHL:
00066F CC93 D5              11      PUSH    DE
000670 CC94 110FE5          10      LD  DE,DECBF
000673 CC97 0605             7      LD  B,5
000675 CC99 CD2ACD          17      CALL    ZERO_MEMORY_DE  ;A=0
000678 CC9C D1              10      POP DE
                                
000679 CC9D 0E20             7      LD  C,32
       CC9F                     DEC1:
00067B CC9F 29              11      ADD HL,HL
00067C CCA0 EB               4      EX  DE,HL
00067D CCA1 ED6A            15      ADC HL,HL
00067F CCA3 EB               4      EX  DE,HL
000680 CCA4 E5              11      PUSH    HL
000681 CCA5 2113E5          10      LD  HL,DECBF+4
000684 CCA8 0605             7      LD  B,5
       CCAA                     DEC2:
000686 CCAA 7E               7      LD  A,(HL)
000687 CCAB 8F               4      ADC A,A
000688 CCAC 27               4      DAA
000689 CCAD 77               7      LD  (HL),A
00068A CCAE 2B               6      DEC HL
00068B CCAF 10F9            13      DJNZ    DEC2
00068D CCB1 E1              10      POP HL
00068E CCB2 0D               4      DEC C
00068F CCB3 20EA            12      JR  NZ,DEC1
                                
000691 CCB5 210FE5          10      LD  HL,DECBF
000694 CCB8 3E20             7      LD  A,020H
000696 CCBA 0604             7      LD  B,4
       CCBC                     DEC3:
000698 CCBC CDC9CC          17      CALL    DEC4
00069B CCBF CDC9CC          17      CALL    DEC4
00069E CCC2 23               6      INC HL
00069F CCC3 10F7            13      DJNZ    DEC3
       CCC5                     DECX:
0006A1 CCC5 CDC9CC          17      CALL    DEC4
0006A4 CCC8 AF               4      XOR A
       CCC9                     DEC4:
0006A5 CCC9 ED6F            18      RLD
0006A7 CCCB FE20             7      CP  020H
0006A9 CCCD 2802            12      JR  Z,DEC5
0006AB CCCF F630             7      OR  030H
       CCD1                     DEC5:
0006AD CCD1 18BA            12      JR  MSG_AR
                                
       CCD3                     FPRNT:
0006AF CCD3 0608             7      LD  B,8 ;ファイル名を表示
0006B1 CCD5 CDE4CC          17      CALL    P_N1
0006B4 CCD8 7E               7      LD  A,(HL)
0006B5 CCD9 CDEED8          17      CALL    CAP3
0006B8 CCDC D8              11      RET C   ;拡張子が無い
                                
0006B9 CCDD 3E2E             7      LD  A,'.'
0006BB CCDF CD10D1          17      CALL    MSG_A
0006BE CCE2 0603             7      LD  B,3 ;拡張子を表示
       CCE4                     P_N1:
0006C0 CCE4 7E               7      LD  A,(HL)
0006C1 CCE5 CDEED8          17      CALL    CAP3
0006C4 CCE8 3807            12      JR  C,P_N2
0006C6 CCEA CD10D1          17      CALL    MSG_A
0006C9 CCED 23               6      INC HL
0006CA CCEE 10F4            13      DJNZ    P_N1
0006CC CCF0 C9              10      RET
       CCF1                     P_N2:
0006CD CCF1 23               6      INC HL
0006CE CCF2 10FD            13      DJNZ    P_N2
0006D0 CCF4 C9              10      RET
                                
       CCF5                     SETFCB:
0006D1 CCF5 CDA2D6          17      CALL    SPCUT
0006D4 CCF8 1A               7      LD  A,(DE)
0006D5 CCF9 FE20             7      CP  020H
0006D7 CCFB 3801            12      JR  C,SETFCBA
0006D9 CCFD 1B               6      DEC DE
       CCFE                     SETFCBA:
0006DA CCFE 0624             7      LD  B,36
0006DC CD00 215C00          10      LD  HL,FCB1
0006DF CD03 E5              11      PUSH    HL
0006E0 CD04 AF               4      XOR A
0006E1 CD05 CD77D6          17      CALL    FILL_MEMORY
0006E4 CD08 E1              10      POP HL
0006E5 CD09 D5              11      PUSH    DE
0006E6 CD0A CDB1D0          17      CALL    _SYS29      ;(BDOS)ファイル名の解析
0006E9 CD0D 216C00          10      LD  HL,FCB2
0006EC CD10 CDB1D0          17      CALL    _SYS29      ;(BDOS)ファイル名の解析
0006EF CD13 E1              10      POP HL
0006F0 CD14 010050          10      LD  BC,05000H
0006F3 CD17 118100          10      LD  DE,00081H
       CD1A                     SETFCB1:
0006F6 CD1A 7E               7      LD  A,(HL)
0006F7 CD1B 23               6      INC HL
0006F8 CD1C FE20             7      CP  020H
0006FA CD1E 3805            12      JR  C,SETFCB2
0006FC CD20 12               7      LD  (DE),A
0006FD CD21 13               6      INC DE
0006FE CD22 0C               4      INC C
0006FF CD23 10F5            13      DJNZ    SETFCB1
       CD25                     SETFCB2:
000701 CD25 79               4      LD  A,C
000702 CD26 328000          13      LD  (DTA1),A
000705 CD29 04               4      INC B
       CD2A                     ZERO_MEMORY_DE:
000706 CD2A AF               4      XOR A
       CD2B                     FILL_MEMORY_DE:
000707 CD2B 12               7      LD  (DE),A
000708 CD2C 13               6      INC DE
000709 CD2D 10FC            13      DJNZ    FILL_MEMORY_DE
00070B CD2F C9              10      RET
                                
       CD30                     C_COPY:
00070C CD30 CDF5CC          17      CALL    SETFCB
                                
00070F CD33 1161E5          10      LD  DE,ZERO
000712 CD36 CDC3D5          17      CALL    FILEC2
000715 CD39 216C00          10      LD  HL,FCB2
000718 CD3C CDB8D0          17      CALL    S29X1
                                
00071B CD3F 3E10             7      LD  A,010H
00071D CD41 326900          13      LD  (FCB1+13),A
000720 CD44 216D00          10      LD  HL,FCB2FN
000723 CD47 CD0BCE          17      CALL    CWILD1
       CD4A                     COPY0:
000726 CD4A CD08CE          17      CALL    CWILD
000729 CD4D 215C00          10      LD  HL,FCB1
00072C CD50 CDB1CA          17      CALL    OPEN
00072F CD53 37               4      SCF
       CD54                     COPY1:
000730 CD54 C0              11      RET NZ
000731 CD55 CDC4CA          17      CALL    DEFCB
                                
000734 CD58 3A97E4          13      LD  A,(DTA_CCP+13)
000737 CD5B CB67             8      BIT 4,A
000739 CD5D 2821            12      JR  Z,COPY1A
                                
00073B CD5F 215D00          10      LD  HL,FCB1FN
00073E CD62 CD06DA          17      CALL    CHKWILD
000741 CD65 3814            12      JR  C,COPY9
                                
000743 CD67 3E20             7      LD  A,020H
000745 CD69 325D00          13      LD  (FCB1FN),A
000748 CD6C 2AA4E4          16      LD  HL,(DTA_CCP+26)
00074B CD6F 23               6      INC HL
00074C CD70 226A00          16      LD  (FCB1+14),HL
00074F CD73 18D5            12      JR  COPY0
                                
       CD75                     COPY8:
000751 CD75 CD77CE          17      CALL    _SYS09      ;(BDOS)文字列出力
000754 CD78 CD59CC          17      CALL    LTNL
       CD7B                     COPY9:
000757 CD7B CDC0CA          17      CALL    OPEN2
00075A CD7E 18D4            12      JR  COPY1
                                
       CD80                     COPY1A:
00075C CD80 216C00          10      LD  HL,FCB2
00075F CD83 1114E5          10      LD  DE,FDRV
000762 CD86 018CE4          10      LD  BC,DTA_CCP+2
000765 CD89 EDA0            16      LDI
000767 CD8B 3E0B             7      LD  A,11
       CD8D                     COPY2:
000769 CD8D F5              11      PUSH    AF
00076A CD8E 7E               7      LD  A,(HL)
00076B CD8F FE3F             7      CP  '?'
00076D CD91 2001            12      JR  NZ,COPY3
00076F CD93 0A               7      LD  A,(BC)
       CD94                     COPY3:
000770 CD94 12               7      LD  (DE),A
000771 CD95 03               6      INC BC
000772 CD96 13               6      INC DE
000773 CD97 23               6      INC HL
000774 CD98 F1              10      POP AF
000775 CD99 3D               4      DEC A
000776 CD9A 20F1            12      JR  NZ,COPY2
000778 CD9C 010500          10      LD  BC,16-11
00077B CD9F EDB0                    LDIR
       CDA1                     PUTNAME:
00077D CDA1 215D00          10      LD  HL,FCB1FN
000780 CDA4 CD06DA          17      CALL    CHKWILD
000783 CDA7 300B            12      JR  NC,PUTN1
000785 CDA9 2115E5          10      LD  HL,FDRV+1
000788 CDAC CDD3CC          17      CALL    FPRNT
00078B CDAF 3E20             7      LD  A,020H
00078D CDB1 CD10D1          17      CALL    MSG_A
       CDB4                     PUTN1:
000790 CDB4 1114E5          10      LD  DE,FDRV
000793 CDB7 0E16             7      LD  C,016H      ;(BDOS)ファイルの作成
000795 CDB9 CDDFCA          17      CALL    SYSTEM0
000798 CDBC 2048            12      JR  NZ,COPYE2
00079A CDBE 67               4      LD  H,A     ;A=0
00079B CDBF 6F               4      LD  L,A
00079C CDC0 2235E5          16      LD  (FDRV+33),HL    ;(FCB)ランダムレコード
00079F CDC3 2237E5          16      LD  (FDRV+35),HL
       CDC6                     COPY6:
0007A2 CDC6 CDE8CA          17      CALL    S27BUF
0007A5 CDC9 47               4      LD  B,A
0007A6 CDCA 3C               4      INC A
0007A7 CDCB 2831            12      JR  Z,COPYE
0007A9 CDCD 7C               4      LD  A,H
0007AA CDCE B5               4      OR  L
0007AB CDCF 280C            12      JR  Z,COPY7
0007AD CDD1 1114E5          10      LD  DE,FDRV
0007B0 CDD4 0E26             7      LD  C,026H      ;(BDOS)ランダムブロック書き込み
0007B2 CDD6 CDDFCA          17      CALL    SYSTEM0
0007B5 CDD9 2023            12      JR  NZ,COPYE
0007B7 CDDB 10E9            13      DJNZ    COPY6
       CDDD                     COPY7:
0007B9 CDDD 3A97E4          13      LD  A,(DTA_CCP+13)  ;(FCB)属性
0007BC CDE0 3221E5          13      LD  (FDRV+13),A
0007BF CDE3 219EE4          10      LD  HL,DTA_CCP+20   ;(FCB)タイムスタンプ
0007C2 CDE6 1128E5          10      LD  DE,FDRV+20
0007C5 CDE9 010400          10      LD  BC,4
0007C8 CDEC EDB0                    LDIR
                                
0007CA CDEE 1114E5          10      LD  DE,FDRV
0007CD CDF1 0E10             7      LD  C,010H      ;(BDOS)ファイルのクローズ
0007CF CDF3 CDDFCA          17      CALL    SYSTEM0
0007D2 CDF6 2006            12      JR  NZ,COPYE
                                
0007D4 CDF8 1171E5          10      LD  DE,OK
0007D7 CDFB C375CD          10      JP  COPY8
                                
       CDFE                     COPYE:
0007DA CDFE 1114E5          10      LD  DE,FDRV
0007DD CE01 0E13             7      LD  C,013H      ;(BDOS)ファイルの削除
0007DF CE03 CD0500          17      CALL    SYSTEM
       CE06                     COPYE2:
0007E2 CE06 37               4      SCF
0007E3 CE07 C9              10      RET
                                
       CE08                     CWILD:
0007E4 CE08 215D00          10      LD  HL,FCB1FN
       CE0B                     CWILD1:
0007E7 CE0B 7E               7      LD  A,(HL)
0007E8 CE0C FE20             7      CP  020H
0007EA CE0E C0              11      RET NZ
       CE0F                     CWILD2:
0007EB CE0F 3E3F             7      LD  A,'?'
0007ED CE11 060B             7      LD  B,11
0007EF CE13 C377D6          10      JP  FILL_MEMORY
                                
       CE16                     COMTB:
0007F2 CE16 44202020                DB  "D   "  ;1
0007F6 CE1A C7CB                    DW  C_DIR
0007F8 CE1C 44495220                DB  "DIR "  ;2
0007FC CE20 C7CB                    DW  C_DIR
0007FE CE22 434F5059                DB  "COPY"  ;3
000802 CE26 30CD                    DW  C_COPY
000804 CE28 43442020                DB  "CD  "  ;4
000808 CE2C E4CA                    DW  C_CD
00080A CE2E 44454C20                DB  "DEL "  ;5
00080E CE32 AACB                    DW  C_DEL
000810 CE34 50415448                DB  "PATH"  ;6
000814 CE38 5ECC                    DW  C_PATH
000816 CE3A 52454E20                DB  "REN "  ;7
00081A CE3E B4CB                    DW  C_REN
00081C CE40 52454D20                DB  "REM "  ;8
000820 CE44 74CE                    DW  C_REM
[EOF:LDCCP.ASM:SHIFT_JIS]
                                    INCLUDE "LDOS.ASM"
                                
                                ;   LSX-Dodgers OS
                                
       CE46                     BDOS0:
000822 CE46 E5              11      PUSH    HL
000823 CE47 79               4      LD  A,C
000824 CE48 FE3C             7      CP  03CH
000826 CE4A 3802            12      JR  C,DOS1
000828 CE4C 3E3C             7      LD  A,03CH
       CE4E                     DOS1:
00082A CE4E 87               4      ADD A,A
00082B CE4F 3253CE          13      LD  (DOS1_SWC),A
00082E CE52 2A00E6          16      LD  HL,(STABLE)
       CE53                     DOS1_SWC    EQU $-2
000831 CE55 E3              19      EX  (SP),HL
000832 CE56 79               4      LD  A,C
                                ;確認用
                                ;   LD  (0050H),A
000833 CE57 C9              10      RET
       CE58                     _DOS2:
000834 CE58 FE5A             7      CP  05AH        ;(BDOS)カレントディレクトリの変更(_CHDIR)
000836 CE5A CAF3D0          10      JP  Z,_SYS5A
000839 CE5D FE5C             7      CP  05CH        ;(BDOS)ファイル名の解析(_PFILE)
00083B CE5F CAB0D0          10      JP  Z,_SYS5C
00083E CE62 FE5F             7      CP  05FH        ;(BDOS)ディスクバッファのフラッシュ(_FLUSH)
000840 CE64 CA14E3          10      JP  Z,_SYS5F
000843 CE67 FE6F             7      CP  06FH        ;(BDOS)MSX-DOS のバージョン番号の獲得(_DOSVER)
000845 CE69 200A            12      JR  NZ,_ERROR
000847 CE6B 011D00          10      LD  BC,VER_6F
00084A CE6E 116101          10      LD  DE,VER
00084D CE71 210301          10      LD  HL,MACD
       CE74                     C_REM:
000850 CE74 AF               4      XOR A
       CE75                     _ERROR:
000851 CE75 A7               4      AND A
000852 CE76 C9              10      RET
                                
       CE77                     _SYS09:     ;文字列出力
000853 CE77 D5              11      PUSH    DE
       CE78                     _SX09:
000854 CE78 1A               7      LD  A,(DE)
000855 CE79 13               6      INC DE
000856 CE7A FE24             7      CP  '$'
000858 CE7C 2831            12      JR  Z,SX0E2
00085A CE7E CD10D1          17      CALL    MSG_A
00085D CE81 18F5            12      JR  _SX09
                                
       CE83                     MSX1:
00085F CE83 CD10D1          17      CALL    MSG_A
       CE86                     MSX:
000862 CE86 7E               7      LD  A,(HL)
000863 CE87 23               6      INC HL
000864 CE88 B7               4      OR  A
000865 CE89 20F8            12      JR  NZ,MSX1
000867 CE8B C9              10      RET
                                
       CE8C                     _SYS0C:     ;(BDOS)バージョン番号の獲得
000868 CE8C 212200          10      LD  HL,00022H
00086B CE8F 7D               4      LD  A,L
00086C CE90 C9              10      RET
                                
       CE91                     _SYS0D:     ;(BDOS)ディスクリセット
00086D CE91 CDDFE5          17      CALL    _FFLUSH
000870 CE94 E5              11      PUSH    HL
000871 CE95 218000          10      LD  HL,00080H
000874 CE98 228AE5          16      LD  (_DTA),HL
000877 CE9B E1              10      POP HL
000878 CE9C D5              11      PUSH    DE
000879 CE9D 1E00             7      LD  E,0
00087B CE9F 3E                      DB  03EH    ;次の PUSH DE をスキップ
                                
       CEA0                     _SYS0E:     ;(BDOS)カレントドライブの設定
00087C CEA0 D5              11      PUSH    DE
00087D CEA1 7B               4      LD  A,E
00087E CEA2 DDE5            15      PUSH    IX
000880 CEA4 CDDCE5          17      CALL    _GETDPB
000883 CEA7 DDE1            14      POP IX
000885 CEA9 3804            12      JR  C,SX0E2
000887 CEAB 7B               4      LD  A,E
000888 CEAC 320400          13      LD  (_DVSW),A
       CEAF                     SX0E2:
00088B CEAF D1              10      POP DE
00088C CEB0 C9              10      RET
                                
       CEB1                     _SYS0F:     ;(BDOS)ファイルのオープン
00088D CEB1 CDB4D6          17      CALL    SETDRV
000890 CEB4 FD7E1C          19      LD  A,(IY+28)   ;(FCB)オープンモード
000893 CEB7 C602             7      ADD A,002H      ;Write
000895 CEB9 2848            12      JR  Z,FEND0F
000897 CEBB CD02DA          17      CALL    CHKWILDX
                                
00089A CEBE D4DED6          17      CALL    NC,SOPENX
       CEC1                     _S16XX:
00089D CEC1 3840            12      JR  C,FEND0F
                                                ;Directory location
00089F CEC3 3A9FE5          13      LD  A,(_FILEN)
0008A2 CEC6 FD7719          19      LD  (IY+25),A   ;(FCB)ディレクトリロケーション
                                ;               _DIRF
0008A5 CEC9 3AA0E5          13      LD  A,(_DIRF)
0008A8 CECC FD771D          19      LD  (IY+29),A   ;(FCB)ディレクトリモード
                                ;               _FBPS
0008AB CECF FD731E          19      LD  (IY+30),E   ;(FCB)ディレクトリポジション
0008AE CED2 FD721F          19      LD  (IY+31),D
                                ;               Open(Read)
0008B1 CED5 FD361CFF        19      LD  (IY+28),0FFH    ;(FCB)オープンモード
                                ;               FILENAME
0008B5 CED9 FDE5            15      PUSH    IY
0008B7 CEDB D1              10      POP DE
0008B8 CEDC 13               6      INC DE
0008B9 CEDD 010B00          10      LD  BC,11
0008BC CEE0 EDB0                    LDIR
                                ;               Attribute
0008BE CEE2 7E               7      LD  A,(HL)
0008BF CEE3 FD770D          19      LD  (IY+13),A   ;(FCB)属性(アトリビュート)
0008C2 CEE6 110B00          10      LD  DE,11       ;Reserved
0008C5 CEE9 19              11      ADD HL,DE
                                                    ;(FCB)ファイルを最後に変更した時刻
0008C6 CEEA 11E4E6          10      LD  DE,SDDATA       ;(FCB)ファイルを最後に変更した日付
0008C9 CEED 060A             7      LD  B,SDDATAE-SDDATA    ;(FCB)ファイルの先頭クラスタ
       CEEF                     S16LOOP:                ;(FCB)ファイルのサイズ(バイト単位)
0008CB CEEF 1A               7      LD  A,(DE)
0008CC CEF0 13               6      INC DE
0008CD CEF1 32F8CE          13      LD  (S16PAT),A
0008D0 CEF4 7E               7      LD  A,(HL)
0008D1 CEF5 23               6      INC HL
0008D2 CEF6 FD7700          19      LD  (IY+0),A
       CEF8                     S16PAT  EQU $-1
0008D5 CEF9 10F4            13      DJNZ    S16LOOP
                                
0008D7 CEFB AF               4      XOR A
0008D8 CEFC FD770C          19      LD  (IY+12),A   ;(FCB)カレントブロック
0008DB CEFF FD22A0CF        20      LD  (OFCB_SWC),IY
       CF03                     FEND0F:
0008DF CF03 1845            12      JR  FEND10
                                
       CF05                     _SYS10:     ;(BDOS)ファイルのクローズ
0008E1 CF05 CDB4D6          17      CALL    SETDRV
0008E4 CF08 FD7E1C          19      LD  A,(IY+28)   ;(FCB)オープンモード
0008E7 CF0B D6FE             7      SUB 0FEH
0008E9 CF0D 37               4      SCF
0008EA CF0E 3F               4      CCF
0008EB CF0F 2039            12      JR  NZ,FEND10
       CF11                     _S10A:              ;Write
0008ED CF11 FD770E          19      LD  (IY+14),A   ;(FCB)レコードサイズ/アクセスするディレクトリのクラスタ番号+1
0008F0 CF14 FD770F          19      LD  (IY+15),A
                                
0008F3 CF17 FD341C          23      INC (IY+28)     ;(FCB)オープンモード 0FEH->0FFH
0008F6 CF1A CDFEDA          17      CALL    SETTMS
                                
0008F9 CF1D FD7E1D          19      LD  A,(IY+29)   ;(FCB)ディレクトリモード
0008FC CF20 32A0E5          13      LD  (_DIRF),A
0008FF CF23 E67F             7      AND 07FH
000901 CF25 3230E0          13      LD  (_SECPS),A
000904 CF28 FD5E1E          19      LD  E,(IY+30)   ;(FCB)ディレクトリポジション
000907 CF2B FD561F          19      LD  D,(IY+31)
00090A CF2E CD13D8          17      CALL    READ_DIR
00090D CF31 3817            12      JR  C,FEND10
                                
00090F CF33 3A3ED7          13  SDECM1: LD  A,(SDECPAT) ;1セクタ辺りのディレクトリエントリ数
000912 CF36 3D               4      DEC A       ;1024=01FH / 512=00FH / 256=7
000913 CF37 FDA619          19      AND (IY+25)     ;(FCB)ディレクトリロケーション
000916 CF3A 6F               4      LD  L,A
000917 CF3B 2600             7      LD  H,0
000919 CF3D 29              11      ADD HL,HL       ;*2
00091A CF3E 29              11      ADD HL,HL       ;*4
00091B CF3F 29              11      ADD HL,HL       ;*8
00091C CF40 29              11      ADD HL,HL       ;*16
00091D CF41 29              11      ADD HL,HL       ;*32
00091E CF42 ED4B7EE6        20      LD  BC,(_DTBUF)
000922 CF46 09              11      ADD HL,BC
                                
000923 CF47 CD12DA          17      CALL    SDIRENT
       CF4A                     FEND10:
000926 CF4A 1842            12      JR  FEND
                                
       CF4C                     _SYS11:     ;(BDOS)最初のファイルの検索
000928 CF4C CDB4D6          17      CALL    SETDRV
00092B CF4F CD0DD7          17      CALL    SOPEN
       CF52                     _S12X1:
00092E CF52 383A            12      JR  C,FEND
000930 CF54 CDACD7          17      CALL    SOPENE2
000933 CF57 ED5B8AE5        20      LD  DE,(_DTA)
000937 CF5B 3A88E5          13      LD  A,(_DRV)
00093A CF5E 3C               4      INC A
00093B CF5F 12               7      LD  (DE),A
00093C CF60 D5              11      PUSH    DE
00093D CF61 13               6      INC DE
00093E CF62 012000          10      LD  BC,32
000941 CF65 EDB0                    LDIR
000943 CF67 FD6E0E          19      LD  L,(IY+14)   ;(FCB)レコードサイズ/アクセスするディレクトリのクラスタ番号+1
000946 CF6A FD660F          19      LD  H,(IY+15)
000949 CF6D 22F4E6          16      LD  (SCDIR),HL
00094C CF70 2A9AE5          16      LD  HL,(_FBPS)
00094F CF73 22F6E6          16      LD  (SFBPS),HL
000952 CF76 2A9FE5          16      LD  HL,(_FILEN)
000955 CF79 7C               4      LD  A,H
000956 CF7A B7               4      OR  A
000957 CF7B 2806            12      JR  Z,_S12DIR
000959 CF7D 3A30E0          13      LD  A,(_SECPS)
00095C CF80 F680             7      OR  080H
00095E CF82 67               4      LD  H,A
       CF83                     _S12DIR:
00095F CF83 22F8E6          16      LD  (SFNDF),HL  ;Directory position and Flags
000962 CF86 E1              10      POP HL
000963 CF87 1139E5          10      LD  DE,SFILE
000966 CF8A 0E21             7      LD  C,33
       CF8C                     _S11B:
000968 CF8C EDB0                    LDIR
       CF8E                     FEND:
00096A CF8E 9F               4      SBC A,A     ;CF=0 A=0 : CF=1 A=0FFH
       CF8F                     FENDE:
00096B CF8F FDE1            14      POP IY
00096D CF91 C1              10      POP BC
00096E CF92 D1              10      POP DE
00096F CF93 E1              10      POP HL
000970 CF94 C9              10      RET
                                
       CF95                     _SYS12:     ;(BDOS)次のファイルの検索
000971 CF95 E5              11      PUSH    HL
000972 CF96 D5              11      PUSH    DE
000973 CF97 C5              11      PUSH    BC
000974 CF98 FDE5            15      PUSH    IY
000976 CF9A CD71D7          17      CALL    NOPEN
000979 CF9D 18B3            12      JR  _S12X1
                                
       CF9F                     _S16K:
00097B CF9F 110000          10      LD  DE,0
       CFA0                     OFCB_SWC    EQU $-2
00097E CFA2 D5              11      PUSH    DE
00097F CFA3 061A             7      LD  B,26        ;First cluster
       CFA5                     S16K1:
000981 CFA5 13               6      INC DE
000982 CFA6 23               6      INC HL
000983 CFA7 10FC            13      DJNZ    S16K1
                                
000985 CFA9 1A               7      LD  A,(DE)
000986 CFAA BE               7      CP  (HL)
000987 CFAB 2015            12      JR  NZ,S16K2
000989 CFAD 13               6      INC DE
00098A CFAE 23               6      INC HL
00098B CFAF 1A               7      LD  A,(DE)
00098C CFB0 BE               7      CP  (HL)
00098D CFB1 200F            12      JR  NZ,S16K2
                                
00098F CFB3 E1              10      POP HL
000990 CFB4 FDE5            15      PUSH    IY
000992 CFB6 D1              10      POP DE
000993 CFB7 7E               7      LD  A,(HL)
000994 CFB8 CDC9D6          17      CALL    IS_SAME_DRV_A_DE
000997 CFBB 2006            12      JR  NZ,S16K3
                                                ;ここはCFが必ず0
000999 CFBD ED52            15      SBC HL,DE       ;CP HL,DE
00099B CFBF 37               4      SCF
00099C CFC0 C0              11      RET NZ
00099D CFC1 E5              11      PUSH    HL
       CFC2                     S16K2:
00099E CFC2 E1              10      POP HL
       CFC3                     S16K3:
00099F CFC3 FDE5            15      PUSH    IY
0009A1 CFC5 D1              10      POP DE
       CFC6                     _SYS13:     ;(BDOS)ファイルの削除
0009A2 CFC6 CDB4D6          17      CALL    SETDRV
0009A5 CFC9 CD38D9          17      CALL    KILL
       CFCC                     FEND13:
0009A8 CFCC 18C0            12      JR  FEND
                                
       CFCE                     _SYS14:     ;(BDOS)シーケンシャルな読み出し
0009AA CFCE CDB4D6          17      CALL    SETDRV
0009AD CFD1 CD60DB          17      CALL    INIT_SEQ
       CFD4                     SREAD:
0009B0 CFD4 CD8EDB          17      CALL    RB_READ
                                
0009B3 CFD7 C601             7      ADD A,001H
0009B5 CFD9 38B3            12      JR  C,FEND
                                
0009B7 CFDB 7D               4      LD  A,L
0009B8 CFDC D601             7      SUB 001H
       CFDE                     FENDX:
0009BA CFDE 9F               4      SBC A,A
0009BB CFDF E603             7      AND 3
0009BD CFE1 1F               4      RRA
0009BE CFE2 18AB            12      JR  FENDE
                                
       CFE4                     _SYS15:     ;(BDOS)シーケンシャルな書き込み
0009C0 CFE4 CDB4D6          17      CALL    SETDRV
0009C3 CFE7 CD60DB          17      CALL    INIT_SEQ
       CFEA                     SWRITE:
0009C6 CFEA CD87DB          17      CALL    RB_WRITE
                                
0009C9 CFED C6FF             7      ADD A,0FFH
0009CB CFEF 18ED            12      JR  FENDX
                                
       CFF1                     _SYS17:     ;(BDOS)ファイル名の変更
0009CD CFF1 CDB4D6          17      CALL    SETDRV
0009D0 CFF4 CD8ED9          17      CALL    NAME
0009D3 CFF7 18D3            12      JR  FEND13
                                
       CFF9                     _SYS16:     ;(BDOS)ファイルの作成
0009D5 CFF9 CDB4D6          17      CALL    SETDRV
                                
0009D8 CFFC CD02DA          17      CALL    CHKWILDX
0009DB CFFF 38CB            12      JR  C,FEND13
0009DD D001 FD7E01          19      LD  A,(IY+1)    ;(FCB)主ファイル名
0009E0 D004 FE05             7      CP  5
0009E2 D006 2805            12      JR  Z,_S16X2
0009E4 D008 FE21             7      CP  021H
0009E6 D00A DACCCF          10      JP  C,FEND13
       D00D                     _S16X2:
                                ;               Clear FCB
0009E9 D00D FDE5            15      PUSH    IY
0009EB D00F E1              10      POP HL
0009EC D010 011000          10      LD  BC,16
0009EF D013 09              11      ADD HL,BC
       D014                     _S16X1:
0009F0 D014 70               7      LD  (HL),B      ;B=0
0009F1 D015 23               6      INC HL
0009F2 D016 0D               4      DEC C
0009F3 D017 20FB            12      JR  NZ,_S16X1
                                
0009F5 D019 CD03DB          17      CALL    SETTMSX
0009F8 D01C FD360DFF        19      LD  (IY+13),0FFH    ;(FCB)Attribute
0009FC D020 CDDED6          17      CALL    SOPENX
0009FF D023 3F               4      CCF
000A00 D024 CC9FCF          17      CALL    Z,_S16K
000A03 D027 D4BDD7          17      CALL    NC,COPEN
000A06 D02A D412DA          17      CALL    NC,SDIRENT
000A09 D02D C3C1CE          10      JP  _S16XX
                                
       D030                     _SYS21:     ;(BDOS)ランダムな読み出し
000A0C D030 CDB4D6          17      CALL    SETDRV
000A0F D033 CD4EDB          17      CALL    INIT_RND
000A12 D036 189C            12      JR  SREAD
                                
       D038                     _SYS22:     ;(BDOS)ランダムな書き込み
       D038                     _SYS28:     ;(BDOS)ランダムな書き込み・その2
000A14 D038 CDB4D6          17      CALL    SETDRV
000A17 D03B CD4EDB          17      CALL    INIT_RND
000A1A D03E 18AA            12      JR  SWRITE
                                
       D040                     _SYS18:     ;(BDOS)ログインベクトルの獲得
000A1C D040 21FF00          10      LD  HL,000FFH
000A1F D043 AF               4      XOR A
000A20 D044 C9              10      RET
                                
       D045                     _SYS19:     ;(BDOS)カレントドライブ番号の獲得
000A21 D045 3A0400          13      LD  A,(_DVSW)
000A24 D048 A7               4      AND A
000A25 D049 C9              10      RET
                                
       D04A                     _SYS1A:     ;(BDOS)DTAの設定
000A26 D04A ED538AE5        20      LD  (_DTA),DE
000A2A D04E AF               4      XOR A
000A2B D04F C9              10      RET
                                
       D050                     _SYS1B:     ;(BDOS)ディスク情報の獲得
000A2C D050 7B               4      LD  A,E
000A2D D051 CDC2D6          17      CALL    GETDRV
000A30 D054 CDDCE5          17      CALL    _GETDPB
000A33 D057 D4E2E5          17      CALL    NC,_RDFATX
000A36 D05A 210000          10      LD  HL,0
000A39 D05D D4DCDA          17      CALL    NC,DSKF
                                
000A3C D060 ED5BDDDA        20      LD  DE,(MAXCLP) ;DPB_MAXCL-1
000A40 D064 1B               6      DEC DE      ;DE←クラスタの総数
000A41 D065 FD2A7CE6        20      LD  IY,(_FATBF) ;IY←メモリ上のFATの先頭アドレス
000A45 D069 9F               4      SBC A,A
000A46 D06A D8              11      RET C
000A47 D06B 4F               4      LD  C,A     ;C=0
000A48 D06C DD7E0F          19      LD  A,(IX+DPB_BPS)
000A4B D06F E607             7      AND 7
000A4D D071 47               4      LD  B,A
000A4E D072 DD7E07          19      LD  A,(IX+DPB_SECPCL)
000A51 D075 C9              10      RET
                                
       D076                     _SYS1D:     ;(BDOS)書き込みが禁止されているディスクの調査
000A52 D076 AF               4      XOR A
000A53 D077 67               4      LD  H,A
000A54 D078 6F               4      LD  L,A
000A55 D079 C9              10      RET
                                
       D07A                     _SYS1F:     ;(BDOS)ディスク装置のパラメータの読み出し
000A56 D07A 2100E7          10      LD  HL,_DEVICE
000A59 D07D 7B               4      LD  A,E
000A5A D07E C3DCE5          10      JP  _GETDPB
                                
       D081                     _SYS23:     ;(BDOS)ファイルサイズの獲得
000A5D D081 E5              11      PUSH    HL
000A5E D082 2A1EE6          16      LD  HL,(STABLE+2*00FH)  ;ファイルのオープン
000A61 D085 CD0F00          17      CALL    JP_HL
000A64 D088 381B            12      JR  C,_S23X1
                                
000A66 D08A D5              11      PUSH    DE      ;EX DE,IY
000A67 D08B FDE3            23      EX  (SP),IY     ;
                                ;   POP DE      ;
                                ;   PUSH    DE      ;DEを破壊しないように注意vv
000A69 D08D FD7E10          19      LD  A,(IY+16)   ;(FCB)ファイルのサイズ(バイト単位)
000A6C D090 FD6E11          19      LD  L,(IY+17)   ;
000A6F D093 FD6612          19      LD  H,(IY+18)   ;
000A72 D096 C5              11      PUSH    BC      ;
000A73 D097 FD4613          19      LD  B,(IY+19)   ;
000A76 D09A CD40DB          17      CALL    GET_CPM_R_SIZE
000A79 D09D C1              10      POP BC
       D09E                     _S24X1:
000A7A D09E CD78DE          17      CALL    SET_RR_AHL
                                ;   POP DE      ;^^^^^^^^^^^^^^^^^^^^^^^^
                                ;   PUSH    DE      ;EX DE,IY
000A7D D0A1 FDE3            23      EX  (SP),IY     ;
000A7F D0A3 D1              10      POP DE      ;
                                
000A80 D0A4 AF               4      XOR A
       D0A5                     _S23X1:
000A81 D0A5 E1              10      POP HL
000A82 D0A6 C9              10      RET
                                
       D0A7                     _SYS24:     ;(BDOS)ランダムレコードフィールドの設定
000A83 D0A7 E5              11      PUSH    HL
000A84 D0A8 D5              11      PUSH    DE      ;EX DE,IY
000A85 D0A9 FDE3            23      EX  (SP),IY     ;
                                ;   POP DE      ;
                                ;   PUSH    DE      ;DEを破壊しないように注意vv
000A87 D0AB CD68DB          17      CALL    GETSEQ
000A8A D0AE 18EE            12      JR  _S24X1      ;^^^^^^^^^^^^^^^^^^^^^^^^
                                
       D0B0                     _SYS5C:     ;(BDOS)ファイル名の解析(_PFILE)
000A8C D0B0 2B               6      DEC HL
       D0B1                     _SYS29:     ;(BDOS)ファイル名の解析(_PPATH)
000A8D D0B1 C5              11      PUSH    BC
000A8E D0B2 E5              11      PUSH    HL
000A8F D0B3 CDCBD5          17      CALL    FILE
000A92 D0B6 E1              10      POP HL
000A93 D0B7 C1              10      POP BC
       D0B8                     S29X1:
000A94 D0B8 C5              11      PUSH    BC
000A95 D0B9 D5              11      PUSH    DE
000A96 D0BA E5              11      PUSH    HL
000A97 D0BB EB               4      EX  DE,HL
000A98 D0BC AF               4      XOR A
000A99 D0BD 3221E5          13      LD  (FDRV+13),A
000A9C D0C0 2114E5          10      LD  HL,FDRV
000A9F D0C3 011000          10      LD  BC,16
000AA2 D0C6 EDB0                    LDIR
000AA4 D0C8 E1              10      POP HL
000AA5 D0C9 D1              10      POP DE
000AA6 D0CA C1              10      POP BC
000AA7 D0CB C9              10      RET
                                
       D0CC                     _SYS30:     ;(BDOS)論理セクタを用いた書き込み
000AA8 D0CC C5              11      PUSH    BC
000AA9 D0CD 01D3E1          10      LD  BC,DWT24B
000AAC D0D0 1804            12      JR  S2FX
       D0D2                     _SYS2F:
000AAE D0D2 C5              11      PUSH    BC
000AAF D0D3 01C3E1          10      LD  BC,DRD24B
       D0D6                     S2FX:
000AB2 D0D6 ED43ECD0        20      LD  (S2F_SWC),BC
000AB6 D0DA CDDFE5          17      CALL    _FFLUSH
                                
000AB9 D0DD D5              11      PUSH    DE
000ABA D0DE E5              11      PUSH    HL
000ABB D0DF 7D               4      LD  A,L     ;Drive
000ABC D0E0 CDD9E5          17      CALL    _CHGDRV
000ABF D0E3 3809            12      JR  C,S30X2
000AC1 D0E5 44               4      LD  B,H     ;Number of clusters
000AC2 D0E6 2A8AE5          16      LD  HL,(_DTA)
                                
000AC5 D0E9 0E00             7      LD  C,0
000AC7 D0EB CDC3E1          17      CALL    DRD24B
       D0EC                     S2F_SWC EQU $-2
       D0EE                     S30X2:
000ACA D0EE E1              10      POP HL
000ACB D0EF D1              10      POP DE
000ACC D0F0 C1              10      POP BC
000ACD D0F1 9F               4      SBC A,A
000ACE D0F2 C9              10      RET
                                
       D0F3                     _SYS5A:     ;(BDOS)カレントディレクトリの変更
000ACF D0F3 C5              11      PUSH    BC
000AD0 D0F4 D5              11      PUSH    DE
000AD1 D0F5 E5              11      PUSH    HL
000AD2 D0F6 CDC0D5          17      CALL    FILEC
000AD5 D0F9 21EED0          10      LD  HL,S30X2
000AD8 D0FC E5              11      PUSH    HL
000AD9 D0FD 3A21E5          13      LD  A,(FDRV+13) ;(FCB)属性(アトリビュート))
000ADC D100 E610             7      AND 010H        ;ディレクトリ
000ADE D102 C8              11      RET Z
000ADF D103 1114E5          10      LD  DE,FDRV
000AE2 D106 2A4EE6          16      LD  HL,(STABLE+2*027H)  ;ランダムブロック読み込み
000AE5 D109 E9               4      JP  (HL)
[EOF:LDOS.ASM:SHIFT_JIS]
                                    INCLUDE "MSXIO.ASM"
                                
                                ;   LSX-Dodgers IO
                                ;   MSX
                                
       CE75                     _SYS04  EQU _ERROR      ;(BDOS)外部出力
       CE75                     _SYS05  EQU _ERROR      ;(BDOS)プリンタ出力
       CE75                     _SYS1C  EQU _ERROR      ;(BDOS)ディスクの書き込み禁止化
       CE75                     _SYS1E  EQU _ERROR      ;(BDOS)ファイル属性の設定
       CE75                     _SYS20  EQU _ERROR      ;(BDOS)利用者番号の設定と読み出し
       CE75                     _SYS2E  EQU _ERROR      ;(BDOS)ベリファイ・フラグの設定
                                
       0000                     INT EQU 0
       0000                     INTCTCE EQU 0
       0000                     INTCTC2 EQU 0
                                
       0000                     CTRL00  EQU 0
       0000                     CTRL03  EQU 0
       0000                     CTRL04  EQU 0
       0000                     CTRL05  EQU 0
       0000                     CTRL06  EQU 0
       0000                     CTRL07  EQU 0
       0000                     CTRL08  EQU 0
       0000                     CTRL09  EQU 0
       0000                     CTRL0A  EQU 0
       0000                     CTRL0B  EQU 0
       0000                     CTRL0C  EQU 0
       0000                     CTRL0D  EQU 0
       0000                     CTRL0E  EQU 0
       0000                     CTRL12  EQU 0
       0000                     CTRL1B  EQU 0
       0000                     CTRL1C  EQU 0
       0000                     CTRL1D  EQU 0
       0000                     CTRL1E  EQU 0
       0000                     CTRL1F  EQU 0
                                
       D10A                     PRINT:
000AE6 D10A 7B               4      LD  A,E
000AE7 D10B 1803            12      JR  MSG_A
                                
       D10D                     _SYS01:     ;(BDOS)コンソール入力
000AE9 D10D CD09E5          17      CALL    _SYS07
       D110                     MSG_A:
000AEC D110 FE03             7      CP  3
000AEE D112 2814            12      JR  Z,MSG_BR
       D114                     MSGA1:
000AF0 D114 F5              11      PUSH    AF
000AF1 D115 C5              11      PUSH    BC
000AF2 D116 D5              11      PUSH    DE
000AF3 D117 E5              11      PUSH    HL
000AF4 D118 DDE5            15      PUSH    IX
000AF6 D11A DD21A200        14      LD  IX,CHPUT
000AFA D11E CD83D3          17      CALL    CALSLT_R
000AFD D121 DDE1            14      POP IX
000AFF D123 E1              10      POP HL
000B00 D124 D1              10      POP DE
000B01 D125 C1              10      POP BC
       D126                     MSGA2:
000B02 D126 F1              10      POP AF
000B03 D127 C9              10      RET
       D128                     MSG_BR:
000B04 D128 F5              11      PUSH    AF
000B05 D129 3ADDF3          13      LD  A,(CSRX)
000B08 D12C FE02             7      CP  2
000B0A D12E 38F6            12      JR  C,MSGA2
000B0C D130 F1              10      POP AF
       D131                     MSG_CR:
000B0D D131 F5              11      PUSH    AF
000B0E D132 3E0D             7      LD  A,00DH
000B10 D134 CD14D1          17      CALL    MSGA1
000B13 D137 3E0A             7      LD  A,00AH
000B15 D139 CD14D1          17      CALL    MSGA1
000B18 D13C F1              10      POP AF
000B19 D13D C9              10      RET
                                
       D13E                     _SYS02:     ;(BDOS)コンソール出力
000B1A D13E CD5AD1          17      CALL    BREAK
000B1D D141 C3CDE5          10      JP  _PRINT
                                
       D144                     _SYS06:     ;(BDOS)コンソール直接入出力
000B20 D144 7B               4      LD  A,E
000B21 D145 3C               4      INC A
000B22 D146 CACAE5          10      JP  Z,_INKEY
000B25 D149 C3CDE5          10      JP  _PRINT
                                
       D14C                     _SYS08:     ;(BDOS)エコーなしコンソール入力
000B28 D14C CD09E5          17      CALL    _SYS07
000B2B D14F FE03             7      CP  3
000B2D D151 CCF4E5          17      CALL    Z,_BREAK
000B30 D154 FE13             7      CP  013H        ;CTRL+S
000B32 D156 C0              11      RET NZ
       D157                     PAUSE:
000B33 D157 CD71D1          17      CALL    KEYBC
                                
       D15A                     BREAK:
000B36 D15A F5              11      PUSH    AF
000B37 D15B C5              11      PUSH    BC
000B38 D15C D5              11      PUSH    DE
000B39 D15D E5              11      PUSH    HL
000B3A D15E DDE5            15      PUSH    IX
000B3C D160 DD21B700        14      LD  IX,BREAKX
000B40 D164 CD83D3          17      CALL    CALSLT_R
000B43 D167 DDE1            14      POP IX
000B45 D169 E1              10      POP HL
000B46 D16A D1              10      POP DE
000B47 D16B C1              10      POP BC
000B48 D16C DCF4E5          17      CALL    C,_BREAK
000B4B D16F F1              10      POP AF
000B4C D170 C9              10      RET
       D171                     KEYBC:
000B4D D171 F5              11      PUSH    AF
000B4E D172 C5              11      PUSH    BC
000B4F D173 D5              11      PUSH    DE
000B50 D174 E5              11      PUSH    HL
000B51 D175 DDE5            15      PUSH    IX
000B53 D177 DD215601        14      LD  IX,KILBUF
000B57 D17B CD83D3          17      CALL    CALSLT_R
000B5A D17E DDE1            14      POP IX
000B5C D180 E1              10      POP HL
000B5D D181 D1              10      POP DE
000B5E D182 C1              10      POP BC
000B5F D183 F1              10      POP AF
000B60 D184 C9              10      RET
       D185                     FLGET:
000B61 D185 C5              11      PUSH    BC
000B62 D186 D5              11      PUSH    DE
000B63 D187 E5              11      PUSH    HL
000B64 D188 DDE5            15      PUSH    IX
000B66 D18A CDDFE5          17      CALL    _FFLUSH
000B69 D18D 181B            12      JR  FLGET1
       D18E                     CBIOS_SWC1  EQU $-1
000B6B D18F CD6BD3          17      CALL    GETVRAM
                                
000B6E D192 E5              11      PUSH    HL
000B6F D193 DD214A00        14      LD  IX,RDVRM
000B73 D197 CD83D3          17      CALL    CALSLT_R
000B76 D19A E1              10      POP HL
000B77 D19B 32B6D1          13      LD  (SWCCHR),A
                                
000B7A D19E E5              11      PUSH    HL
000B7B D19F 3EFF             7      LD  A,0FFH
000B7D D1A1 DD214D00        14      LD  IX,WRTVRM
000B81 D1A5 CD83D3          17      CALL    CALSLT_R
000B84 D1A8 E1              10      POP HL
                                
000B85 D1A9 E5              11      PUSH    HL
       D1AA                     FLGET1:
000B86 D1AA DD219F00        14      LD  IX,CHGET
000B8A D1AE CD83D3          17      CALL    CALSLT_R
000B8D D1B1 180C            12      JR  FLGET2
       D1B2                     CBIOS_SWC2  EQU $-1
000B8F D1B3 E1              10      POP HL
                                
000B90 D1B4 F5              11      PUSH    AF
000B91 D1B5 3E00             7      LD  A,0
       D1B6                     SWCCHR  EQU $-1
000B93 D1B7 DD214D00        14      LD  IX,WRTVRM
000B97 D1BB CD83D3          17      CALL    CALSLT_R
000B9A D1BE F1              10      POP AF
       D1BF                     FLGET2:
000B9B D1BF DDE1            14      POP IX
000B9D D1C1 E1              10      POP HL
000B9E D1C2 D1              10      POP DE
000B9F D1C3 C1              10      POP BC
000BA0 D1C4 FE03             7      CP  3
000BA2 D1C6 C0              11      RET NZ
000BA3 D1C7 C300E5          10      JP  CPM_BOOT
                                
       D1CA                     INKEY:
000BA6 D1CA CD06E5          17      CALL    CPM_CONST
000BA9 D1CD C8              11      RET Z
000BAA D1CE 18B5            12      JR  FLGET
                                
       D1D0                     _SYS0A:     ;(BDOS)文字列入力
000BAC D1D0 C5              11      PUSH    BC
000BAD D1D1 E5              11      PUSH    HL
000BAE D1D2 D5              11      PUSH    DE
000BAF D1D3 CDFCD1          17      CALL    GETL
000BB2 D1D6 111FF4          10      LD  DE,KBUF
000BB5 D1D9 E1              10      POP HL
000BB6 D1DA E5              11      PUSH    HL
000BB7 D1DB 0E00             7      LD  C,0
000BB9 D1DD 3004            12      JR  NC,SAX0
000BBB D1DF 23               6      INC HL
000BBC D1E0 23               6      INC HL
000BBD D1E1 1808            12      JR  SAX4
       D1E3                     SAX0:
000BBF D1E3 46               7      LD  B,(HL)
000BC0 D1E4 23               6      INC HL
       D1E5                     SAX1:
000BC1 D1E5 23               6      INC HL
000BC2 D1E6 1A               7      LD  A,(DE)
000BC3 D1E7 13               6      INC DE
000BC4 D1E8 B7               4      OR  A
000BC5 D1E9 2004            12      JR  NZ,SAX2
       D1EB                     SAX4:
000BC7 D1EB 360D            10      LD  (HL),00DH
000BC9 D1ED 1804            12      JR  SAX3
       D1EF                     SAX2:
000BCB D1EF 77               7      LD  (HL),A
000BCC D1F0 0C               4      INC C
000BCD D1F1 10F2            13      DJNZ    SAX1
       D1F3                     SAX3:
000BCF D1F3 D1              10      POP DE
000BD0 D1F4 79               4      LD  A,C
000BD1 D1F5 13               6      INC DE
000BD2 D1F6 12               7      LD  (DE),A
000BD3 D1F7 1B               6      DEC DE
000BD4 D1F8 E1              10      POP HL
000BD5 D1F9 C1              10      POP BC
000BD6 D1FA A7               4      AND A
000BD7 D1FB C9              10      RET
       D1FC                     GETL:
000BD8 D1FC DDE5            15      PUSH    IX
000BDA D1FE FDE5            15      PUSH    IY
                                
000BDC D200 2ADCF3          16      LD  HL,(CSRY)
000BDF D203 22CAFB          16      LD  (FSTPOS),HL
       D206                     GETL1:
000BE2 D206 CD4CD1          17      CALL    _SYS08
000BE5 D209 FE09             7      CP  9
000BE7 D20B 2008            12      JR  NZ,GETL1V
000BE9 D20D 211FF4          10      LD  HL,KBUF
000BEC D210 CD86CE          17      CALL    MSX
000BEF D213 18F1            12      JR  GETL1
       D215                     GETL1V:
000BF1 D215 5F               4      LD  E,A
000BF2 D216 FE08             7      CP  8
000BF4 D218 CC11D3          17      CALL    Z,CTRL02
000BF7 D21B FE20             7      CP  020H
000BF9 D21D D43DD3          17      CALL    NC,INSERT
000BFC D220 CD14D1          17      CALL    MSGA1
                                
000BFF D223 7B               4      LD  A,E
000C00 D224 FE0D             7      CP  00DH
000C02 D226 20DE            12      JR  NZ,GETL1
                                
000C04 D228 111FF4          10      LD  DE,KBUF
000C07 D22B 3AB0F3          13      LD  A,(LINLEN)
000C0A D22E 47               4      LD  B,A
000C0B D22F CD2ACD          17      CALL    ZERO_MEMORY_DE
                                
000C0E D232 2ACAFB          16      LD  HL,(FSTPOS)
000C11 D235 3ADCF3          13      LD  A,(CSRY)
000C14 D238 6F               4      LD  L,A
000C15 D239 E5              11      PUSH    HL
000C16 D23A CD6ED3          17      CALL    LOC0
000C19 D23D 4D               4      LD  C,L
000C1A D23E 44               4      LD  B,H
000C1B D23F E1              10      POP HL
000C1C D240 3AB0F3          13      LD  A,(LINLEN)
000C1F D243 94               4      SUB H
000C20 D244 3D               4      DEC A
000C21 D245 5F               4      LD  E,A
000C22 D246 211FF4          10      LD  HL,KBUF
       D249                     GETL2:
000C25 D249 CDD0E5          17      CALL    _SCRN
000C28 D24C 03               6      INC BC
000C29 D24D 77               7      LD  (HL),A
000C2A D24E 23               6      INC HL
000C2B D24F 1D               4      DEC E
000C2C D250 20F7            12      JR  NZ,GETL2
000C2E D252 CD31D1          17      CALL    MSG_CR
                                
000C31 D255 FDE1            14      POP IY
000C33 D257 DDE1            14      POP IX
       D259                     GETL3:
000C35 D259 2B               6      DEC HL
000C36 D25A 7E               7      LD  A,(HL)
000C37 D25B FE21             7      CP  021H
000C39 D25D D0              11      RET NC
000C3A D25E 3600            10      LD  (HL),0
000C3C D260 15               4      DEC D
000C3D D261 20F6            12      JR  NZ,GETL3
000C3F D263 C9              10      RET
                                
       D264                     _SYS0B:     ;(BDOS)コンソール状態のチェック
       D264                     CONSTX:
000C40 D264 C5              11      PUSH    BC
000C41 D265 D5              11      PUSH    DE
000C42 D266 E5              11      PUSH    HL
000C43 D267 DDE5            15      PUSH    IX
000C45 D269 DD219C00        14      LD  IX,CHSNS
000C49 D26D CD83D3          17      CALL    CALSLT_R
000C4C D270 DDE1            14      POP IX
000C4E D272 E1              10      POP HL
000C4F D273 D1              10      POP DE
000C50 D274 C1              10      POP BC
000C51 D275 C9              10      RET
                                
       D276                     _SYS2A:     ;(BDOS)日付の獲得
000C52 D276 0E0B             7      LD  C,11        ;年/Year→HL
000C54 D278 CDB7D2          17      CALL    RDCLK_BCD
000C57 D27B 6F               4      LD  L,A
000C58 D27C 2600             7      LD  H,0
000C5A D27E 3AF8FA          13      LD  A,(EXBRSA)
000C5D D281 B7               4      OR  A
000C5E D282 2804            12      JR  Z,SX2A1
000C60 D284 11BC07          10      LD  DE,1980     ;1980年～2079年
000C63 D287 19              11      ADD HL,DE
       D288                     SX2A1:
000C64 D288 0E09             7      LD  C,9     ;月/Month→D
000C66 D28A CDB7D2          17      CALL    RDCLK_BCD
000C69 D28D 57               4      LD  D,A
                                
000C6A D28E 0E07             7      LD  C,7     ;日/Day→E
000C6C D290 CDB7D2          17      CALL    RDCLK_BCD
000C6F D293 5F               4      LD  E,A
                                
000C70 D294 0E06             7      LD  C,6     ;曜日/Week→A
       D296                     RDCLK:
000C72 D296 DDE5            15      PUSH    IX
000C74 D298 DD21F501        14      LD  IX,REDCLK
       D29C                     WRCLK1:
000C78 D29C 3AF8FA          13      LD  A,(EXBRSA)
000C7B D29F B7               4      OR  A
000C7C D2A0 280A            12      JR  Z,RDCLK1    ;MSX1
000C7E D2A2 FDE5            15      PUSH    IY
000C80 D2A4 FD67             9      LD  IYH,A
000C82 D2A6 78               4      LD  A,B
000C83 D2A7 CD9FD3          17      CALL    CALSLTR
000C86 D2AA FDE1            14      POP IY
       D2AC                     RDCLK1:
000C88 D2AC DDE1            14      POP IX
000C8A D2AE C9              10      RET
       D2AF                     WRCLK:
000C8B D2AF DDE5            15      PUSH    IX
000C8D D2B1 DD21F901        14      LD  IX,WRTCLK
000C91 D2B5 18E5            12      JR  WRCLK1
                                
       D2B7                     RDCLK_BCD:
000C93 D2B7 CD96D2          17      CALL    RDCLK       ;1の位
000C96 D2BA 47               4      LD  B,A
000C97 D2BB 0C               4      INC C
000C98 D2BC CD96D2          17      CALL    RDCLK       ;10の位
000C9B D2BF 87               4      ADD A,A     ;*2
000C9C D2C0 4F               4      LD  C,A
000C9D D2C1 87               4      ADD A,A     ;*4
000C9E D2C2 87               4      ADD A,A     ;*8
000C9F D2C3 81               4      ADD A,C     ;*10(8+2)
000CA0 D2C4 80               4      ADD A,B     ;1の位
000CA1 D2C5 C9              10      RET
                                
       D2C6                     _SYS2C:     ;(BDOS)時刻の獲得
000CA2 D2C6 011501          10      LD  BC,00115H       ;12時間計/24時間計の設定を24時間計に
000CA5 D2C9 CDAFD2          17      CALL    WRCLK
000CA8 D2CC 0E04             7      LD  C,4     ;H=時/Hour
000CAA D2CE CDB7D2          17      CALL    RDCLK_BCD
000CAD D2D1 67               4      LD  H,A
000CAE D2D2 0E02             7      LD  C,2     ;L=分/Minute
000CB0 D2D4 CDB7D2          17      CALL    RDCLK_BCD
000CB3 D2D7 6F               4      LD  L,A
000CB4 D2D8 0E00             7      LD  C,0     ;D=秒/Second
000CB6 D2DA CDB7D2          17      CALL    RDCLK_BCD
000CB9 D2DD 57               4      LD  D,A
000CBA D2DE AF               4      XOR A       ;E=1/100秒
000CBB D2DF 5F               4      LD  E,A
000CBC D2E0 C9              10      RET
                                
       D2E1                     POS:
000CBD D2E1 F5              11      PUSH    AF
000CBE D2E2 2ADCF3          16      LD  HL,(CSRY)
000CC1 D2E5 7D               4      LD  A,L
000CC2 D2E6 6C               4      LD  L,H
000CC3 D2E7 67               4      LD  H,A
000CC4 D2E8 2C               4      INC L
000CC5 D2E9 24               4      INC H
000CC6 D2EA F1              10      POP AF
000CC7 D2EB C9              10      RET
                                
       D2EC                     LOC:
000CC8 D2EC F5              11      PUSH    AF
000CC9 D2ED E5              11      PUSH    HL
000CCA D2EE 7D               4      LD  A,L
000CCB D2EF 6C               4      LD  L,H
000CCC D2F0 67               4      LD  H,A
000CCD D2F1 2D               4      DEC L
000CCE D2F2 25               4      DEC H
000CCF D2F3 DDE5            15      PUSH    IX
000CD1 D2F5 DD21C600        14      LD  IX,POSIT
000CD5 D2F9 CD83D3          17      CALL    CALSLT_R
000CD8 D2FC DDE1            14      POP IX
000CDA D2FE E1              10      POP HL
000CDB D2FF F1              10      POP AF
000CDC D300 C9              10      RET
       D301                     SCRN:
000CDD D301 E5              11      PUSH    HL
000CDE D302 DDE5            15      PUSH    IX
                                
000CE0 D304 69               4      LD  L,C
000CE1 D305 60               4      LD  H,B
000CE2 D306 DD214A00        14      LD  IX,RDVRM
000CE6 D30A CD83D3          17      CALL    CALSLT_R
                                
000CE9 D30D DDE1            14      POP IX
000CEB D30F E1              10      POP HL
000CEC D310 C9              10      RET
                                
       D311                     CTRL02:
000CED D311 F5              11      PUSH    AF
000CEE D312 D5              11      PUSH    DE
000CEF D313 2ADCF3          16      LD  HL,(CSRY)
000CF2 D316 3AB0F3          13      LD  A,(LINLEN)
000CF5 D319 4F               4      LD  C,A
000CF6 D31A 94               4      SUB H   ;CSRX
000CF7 D31B C602             7      ADD A,2
000CF9 D31D 47               4      LD  B,A ;カーソルより右の文字数
000CFA D31E 61               4      LD  H,C ;LINLEN
000CFB D31F C5              11      PUSH    BC
000CFC D320 CD6ED3          17      CALL    LOC0
000CFF D323 C1              10      POP BC
                                
000D00 D324 1620             7      LD  D,020H
       D326                     C8X1:
000D02 D326 DD214A00        14      LD  IX,RDVRM
000D06 D32A CD83D3          17      CALL    CALSLT_R
000D09 D32D 4F               4      LD  C,A
000D0A D32E 7A               4      LD  A,D
000D0B D32F DD214D00        14      LD  IX,WRTVRM
000D0F D333 CD83D3          17      CALL    CALSLT_R
000D12 D336 2B               6      DEC HL
000D13 D337 51               4      LD  D,C
000D14 D338 10EC            13      DJNZ    C8X1
000D16 D33A D1              10      POP DE
000D17 D33B F1              10      POP AF
000D18 D33C C9              10      RET
                                
       D33D                     INSERT:
000D19 D33D F5              11      PUSH    AF
000D1A D33E D5              11      PUSH    DE
000D1B D33F 2ADCF3          16      LD  HL,(CSRY)
000D1E D342 3AB0F3          13      LD  A,(LINLEN)
000D21 D345 4F               4      LD  C,A
000D22 D346 94               4      SUB H   ;CSRX
000D23 D347 3C               4      INC A
000D24 D348 47               4      LD  B,A ;カーソルより右の文字数
000D25 D349 C5              11      PUSH    BC
000D26 D34A CD6ED3          17      CALL    LOC0
000D29 D34D C1              10      POP BC
                                
000D2A D34E 1620             7      LD  D,020H
       D350                     INS1:
000D2C D350 DD214A00        14      LD  IX,RDVRM
000D30 D354 CD83D3          17      CALL    CALSLT_R
000D33 D357 4F               4      LD  C,A
000D34 D358 7A               4      LD  A,D
000D35 D359 DD214D00        14      LD  IX,WRTVRM
000D39 D35D CD83D3          17      CALL    CALSLT_R
000D3C D360 23               6      INC HL
000D3D D361 51               4      LD  D,C
000D3E D362 10EC            13      DJNZ    INS1
000D40 D364 D1              10      POP DE
000D41 D365 F1              10      POP AF
000D42 D366 C9              10      RET
                                
       D367                     CONOUT1:
000D43 D367 59               4      LD  E,C
000D44 D368 C3CDE5          10      JP  _PRINT
                                
       D36B                     GETVRAM:
000D47 D36B 2ADCF3          16      LD  HL,(CSRY)
       D36E                     LOC0:
000D4A D36E 2D               4      DEC L
000D4B D36F 25               4      DEC H
000D4C D370 4C               4      LD  C,H ;CSRX-1
000D4D D371 5D               4      LD  E,L ;CSRY-1
       D372                     LOC1:
000D4E D372 3AB0F3          13      LD  A,(LINLEN)
000D51 D375 67               4      LD  H,A
000D52 D376 1600             7      LD  D,0
000D54 D378 6A               4      LD  L,D ;0
000D55 D379 0608             7      LD  B,8
       D37B                     LOC2:
000D57 D37B 29              11      ADD HL,HL
000D58 D37C 3001            12      JR  NC,LOC3
000D5A D37E 19              11      ADD HL,DE
       D37F                     LOC3:
000D5B D37F 10FA            13      DJNZ    LOC2
000D5D D381 09              11      ADD HL,BC
000D5E D382 C9              10      RET
                                
       D383                     CALSLT_R:
000D5F D383 FDE5            15      PUSH    IY
000D61 D385 FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
000D65 D389 CD9FD3          17      CALL    CALSLTR
000D68 D38C FDE1            14      POP IY
000D6A D38E C9              10      RET
                                
       D38F                     CALLF:
000D6B D38F 08               4      EX  AF,AF'
000D6C D390 E3              19      EX  (SP),HL
000D6D D391 7E               7      LD  A,(HL)
000D6E D392 FD67             9      LD  IYH,A
000D70 D394 23               6      INC HL
000D71 D395 7E               7      LD  A,(HL)
000D72 D396 DD6F             9      LD  IXL,A
000D74 D398 23               6      INC HL
000D75 D399 7E               7      LD  A,(HL)
000D76 D39A DD67             9      LD  IXH,A
000D78 D39C 23               6      INC HL
000D79 D39D E3              19      EX  (SP),HL
000D7A D39E 08               4      EX  AF,AF'
       D39F                     CALSLTR:
000D7B D39F F3               4      DI
000D7C D3A0 ED73D9D3        20      LD  (CSSP),SP
000D80 D3A4 F5              11      PUSH    AF
000D81 D3A5 3E1C             7      LD  A,_CALSLT
       D3A7                     SLTCALL:
000D83 D3A7 32C6D3          13      LD  (SLTCALLX),A
000D86 D3AA 3ADAD3          13      LD  A,(CSSP+1)
000D89 D3AD FE41             7      CP  040H+1
000D8B D3AF 3005            12      JR  NC,CALSLTR1
000D8D D3B1 F1              10      POP AF
000D8E D3B2 315EF5          10      LD  SP,BUF
000D91 D3B5 F5              11      PUSH    AF
       D3B6                     CALSLTR1:
000D92 D3B6 C5              11      PUSH    BC
000D93 D3B7 D5              11      PUSH    DE
000D94 D3B8 E5              11      PUSH    HL
000D95 D3B9 2600             7      LD  H,0
000D97 D3BB 3AC1FC          13      LD  A,(EXPTBL)  ;メインROMに切り替える
000D9A D3BE CDDDD4          17      CALL    ENASLT
000D9D D3C1 E1              10      POP HL
000D9E D3C2 D1              10      POP DE
000D9F D3C3 C1              10      POP BC
000DA0 D3C4 F1              10      POP AF
000DA1 D3C5 CD1C00          17      CALL    _CALSLT
       D3C6                     SLTCALLX    EQU $-2
000DA4 D3C8 F5              11      PUSH    AF
000DA5 D3C9 C5              11      PUSH    BC
000DA6 D3CA D5              11      PUSH    DE
000DA7 D3CB E5              11      PUSH    HL
000DA8 D3CC 2600             7      LD  H,0
000DAA D3CE 3A41F3          13      LD  A,(0F341H)  ;メインRAMに戻す
000DAD D3D1 CDDDD4          17      CALL    ENASLT
000DB0 D3D4 E1              10      POP HL
000DB1 D3D5 D1              10      POP DE
000DB2 D3D6 C1              10      POP BC
000DB3 D3D7 F1              10      POP AF
000DB4 D3D8 310000          10      LD  SP,0
       D3D9                     CSSP    EQU $-2
000DB7 D3DB FB               4      EI
000DB8 D3DC C9              10      RET
                                
       D3DD                     RDSLTR:
000DB9 D3DD ED73D9D3        20      LD  (CSSP),SP
000DBD D3E1 F5              11      PUSH    AF
000DBE D3E2 3E0C             7      LD  A,_RDSLT
000DC0 D3E4 18C1            12      JR  SLTCALL
                                
       D3E6                     WRSLTR:
000DC2 D3E6 ED73D9D3        20      LD  (CSSP),SP
000DC6 D3EA F5              11      PUSH    AF
000DC7 D3EB 3E14             7      LD  A,_WRSLT
000DC9 D3ED 18B8            12      JR  SLTCALL
                                
       D3EF                     INT38H:
000DCB D3EF F5              11      PUSH    AF
000DCC D3F0 E5              11      PUSH    HL          ;メインROMを呼び出すのでスタックが被っていないかチェック
000DCD D3F1 2A1BD4          16      LD  HL,(INTSP)
000DD0 D3F4 7C               4      LD  A,H
000DD1 D3F5 B5               4      OR  L
000DD2 D3F6 202D            12      JR  NZ,INT38H2
000DD4 D3F8 C5              11      PUSH    BC
000DD5 D3F9 D5              11      PUSH    DE
000DD6 D3FA 2100BF          10      LD  HL,010000H-04100H   ;Page1
000DD9 D3FD 39              11      ADD HL,SP
000DDA D3FE ED731BD4        20      LD  (INTSP),SP
000DDE D402 3803            12      JR  C,INT38H1
000DE0 D404 315EF5          10      LD  SP,BUF
       D407                     INT38H1:
000DE3 D407 2600             7      LD  H,0
000DE5 D409 3AC1FC          13      LD  A,(EXPTBL)  ;メインROMに切り替える
000DE8 D40C CDDDD4          17      CALL    ENASLT
000DEB D40F CD3800          17      CALL    00038H
000DEE D412 2600             7      LD  H,0
000DF0 D414 3A41F3          13      LD  A,(0F341H)  ;メインRAMに戻す
000DF3 D417 CDDDD4          17      CALL    ENASLT
000DF6 D41A 310000          10      LD  SP,0
       D41B                     INTSP   EQU $-2
000DF9 D41D 210000          10      LD  HL,0
000DFC D420 221BD4          16      LD  (INTSP),HL
000DFF D423 D1              10      POP DE
000E00 D424 C1              10      POP BC
       D425                     INT38H2:
000E01 D425 E1              10      POP HL
000E02 D426 F1              10      POP AF
000E03 D427 FB               4      EI
000E04 D428 C9              10      RET
                                
[EOF:MSXIO.ASM:SHIFT_JIS]
                                    INCLUDE "LDFILE.ASM"
                                
                                ;   LSX-Dodgers FILE
                                
                                ;   【注意】バイナリサイズを下位1バイトを0丁度に調整する必要あり
                                
       D5C0                     FILEC:
000F9C D5C0 CDCBD5          17      CALL    FILE
       D5C3                     FILEC2:
000F9F D5C3 3A15E5          13      LD  A,(FDRV+1)
000FA2 D5C6 FE20             7      CP  020H
000FA4 D5C8 C8              11      RET Z
000FA5 D5C9 1839            12      JR  SETDIR1
                                
       D5CB                     FILE:
000FA7 D5CB AF               4      XOR A
000FA8 D5CC 3214E5          13      LD  (FDRV),A
000FAB D5CF 67               4      LD  H,A
000FAC D5D0 6F               4      LD  L,A
000FAD D5D1 2222E5          16      LD  (FDRV+14),HL
000FB0 D5D4 CDA2D6          17      CALL    SPCUT
000FB3 D5D7 CD87D6          17      CALL    CCHK3
000FB6 D5DA 2812            12      JR  Z,DEVI1
000FB8 D5DC 13               6      INC DE
000FB9 D5DD 1A               7      LD  A,(DE)
000FBA D5DE 1B               6      DEC DE
000FBB D5DF FE3A             7      CP  ':'
000FBD D5E1 200B            12      JR  NZ,DEVI1
000FBF D5E3 1A               7      LD  A,(DE)      ;DRIVE
000FC0 D5E4 CDE2D8          17      CALL    CAP
000FC3 D5E7 D640             7      SUB '@'
000FC5 D5E9 13               6      INC DE
000FC6 D5EA 13               6      INC DE
000FC7 D5EB 3214E5          13      LD  (FDRV),A
       D5EE                     DEVI1:
000FCA D5EE 1A               7      LD  A,(DE)
000FCB D5EF D65C             7      SUB 05CH        ;\
000FCD D5F1 2009            12      JR  NZ,NOROOT
000FCF D5F3 6F               4      LD  L,A     ;A=0でH=0のはずなのでHL=0
000FD0 D5F4 222EE5          16      LD  (FDRV+26),HL
000FD3 D5F7 2C               4      INC L
000FD4 D5F8 2222E5          16      LD  (FDRV+14),HL
000FD7 D5FB 13               6      INC DE
       D5FC                     NOROOT:
                                
       D5FC                     SETDIR:
000FD8 D5FC CD28D6          17      CALL    FILED
000FDB D5FF 1A               7      LD  A,(DE)
000FDC D600 FE5C             7      CP  05CH        ;\
000FDE D602 C0              11      RET NZ
000FDF D603 13               6      INC DE
       D604                     SETDIR1:
000FE0 D604 3E10             7      LD  A,010H      ;Directory
000FE2 D606 3221E5          13      LD  (FDRV+13),A
000FE5 D609 D5              11      PUSH    DE
000FE6 D60A 1114E5          10      LD  DE,FDRV
000FE9 D60D 2A1EE6          16      LD  HL,(STABLE+2*00FH)
000FEC D610 CD0F00          17      CALL    JP_HL
000FEF D613 D1              10      POP DE
000FF0 D614 B7               4      OR  A
000FF1 D615 C0              11      RET NZ
                                
000FF2 D616 3A21E5          13      LD  A,(FDRV+13)
000FF5 D619 CB67             8      BIT 4,A
000FF7 D61B C8              11      RET Z
                                
000FF8 D61C CD6FD6          17      CALL    FILEI
000FFB D61F 2A2EE5          16      LD  HL,(FDRV+26)
000FFE D622 23               6      INC HL
000FFF D623 2222E5          16      LD  (FDRV+14),HL
001002 D626 18D4            12      JR  SETDIR
                                
       D628                     FILED:
001004 D628 CD6FD6          17      CALL    FILEI
001007 D62B 2115E5          10      LD  HL,FNAME
                                
00100A D62E 0608             7      LD  B,8
       D630                     FILE2:
00100C D630 CD7CD6          17      CALL    CCHKF
00100F D633 C8              11      RET Z
001010 D634 FE2A             7      CP  '*'
001012 D636 282E            12      JR  Z,FILE9
001014 D638 FE2E             7      CP  '.'
001016 D63A 280C            12      JR  Z,FILE4
001018 D63C 77               7      LD  (HL),A
001019 D63D 23               6      INC HL
00101A D63E 10F0            13      DJNZ    FILE2
                                
       D640                     FILE3:
00101C D640 CD7CD6          17      CALL    CCHKF
00101F D643 C8              11      RET Z
001020 D644 FE2E             7      CP  '.'
001022 D646 20F8            12      JR  NZ,FILE3
                                
       D648                     FILE4:
001024 D648 211DE5          10      LD  HL,FNAME+8
001027 D64B 0603             7      LD  B,3
                                
       D64D                     FILE4L:
001029 D64D CD7CD6          17      CALL    CCHKF
00102C D650 C8              11      RET Z
00102D D651 FE2E             7      CP  '.'
00102F D653 2008            12      JR  NZ,FILE12
001031 D655 3215E5          13      LD  (FNAME),A   ;Parent directory(..)
001034 D658 3216E5          13      LD  (FNAME+1),A
001037 D65B 3E20             7      LD  A,020H
       D65D                     FILE12:
001039 D65D FE2A             7      CP  '*'
00103B D65F 280A            12      JR  Z,FILE10
00103D D661 77               7      LD  (HL),A
00103E D662 23               6      INC HL
00103F D663 10E8            13      DJNZ    FILE4L
001041 D665 C9              10      RET
                                
       D666                     FILE9:              ;名前の*処理、名前の残りを?で埋める
001042 D666 CD6BD6          17      CALL    FILE10
001045 D669 18D5            12      JR  FILE3
                                
       D66B                     FILE10:
001047 D66B 3E3F             7      LD  A,'?'
001049 D66D 1808            12      JR  FILL_MEMORY
       D66F                     FILEI:              ;名前＋拡張子をスペースで初期化
00104B D66F 3E20             7      LD  A,020H
00104D D671 01000B          10      LD  BC,11*256   ;C=0にしておく
001050 D674 2115E5          10      LD  HL,FNAME
       D677                     FILL_MEMORY:            ;HLからBバイトAで埋める
001053 D677 77               7      LD  (HL),A
001054 D678 23               6      INC HL
001055 D679 10FC            13      DJNZ    FILL_MEMORY
001057 D67B C9              10      RET
                                
       D67C                     CCHKF:
001058 D67C 1A               7      LD  A,(DE)
001059 D67D CD84D6          17      CALL    CCHK2
00105C D680 C8              11      RET Z
00105D D681 C3EFD9          10      JP  FKAN
                                
       D684                     CCHK2:
001060 D684 0C               4      INC C
001061 D685 0D               4      DEC C
001062 D686 C0              11      RET NZ
       D687                     CCHK3:              ;ZF=1 で使えない文字
001063 D687 FE2B             7      CP  '+'
001065 D689 C8              11      RET Z
001066 D68A FE2C             7      CP  ','
001068 D68C C8              11      RET Z
001069 D68D FE2F             7      CP  '/'
00106B D68F C8              11      RET Z
00106C D690 FE3A             7      CP  ':'
00106E D692 C8              11      RET Z
00106F D693 FE3B             7      CP  ';'
001071 D695 C8              11      RET Z
001072 D696 FE3D             7      CP  '='
001074 D698 C8              11      RET Z
001075 D699 FE5C             7      CP  05CH    ;\
001077 D69B C8              11      RET Z
001078 D69C FE20             7      CP  020H
00107A D69E D0              11      RET NC
00107B D69F BF               4      CP  A       ;Z=1
00107C D6A0 C9              10      RET
                                
       D6A1                     SS1:
00107D D6A1 13               6      INC DE
       D6A2                     SPCUT:              ;スペースをカット
00107E D6A2 1A               7      LD  A,(DE)
00107F D6A3 FE20             7      CP  020H
001081 D6A5 28FA            12      JR  Z,SS1
001083 D6A7 C9              10      RET
                                
       D6A8                     SETDRVF:
001084 D6A8 1114E5          10      LD  DE,FDRV
       D6AB                     SETDRV0:
001087 D6AB CDB4D6          17      CALL    SETDRV
00108A D6AE FDE1            14      POP IY
00108C D6B0 C1              10      POP BC
00108D D6B1 D1              10      POP DE
00108E D6B2 E1              10      POP HL
00108F D6B3 C9              10      RET
                                
       D6B4                     SETDRV:
001090 D6B4 E3              19      EX  (SP),HL     ;HL=RETRN ADDRESS
001091 D6B5 D5              11      PUSH    DE      ;PUSH HL/DE/BC/IY
001092 D6B6 C5              11      PUSH    BC
001093 D6B7 1A               7      LD  A,(DE)
001094 D6B8 D5              11      PUSH    DE
001095 D6B9 FDE3            23      EX  (SP),IY
                                
001097 D6BB CDC2D6          17      CALL    GETDRV
00109A D6BE CDD9E5          17      CALL    _CHGDRV
                                
00109D D6C1 E9               4      JP  (HL)
                                
       D6C2                     GETDRV:
00109E D6C2 CDD5D6          17      CALL    GETDRV1
0010A1 D6C5 3288E5          13      LD  (_DRV),A
0010A4 D6C8 C9              10      RET
                                
       D6C9                     IS_SAME_DRV_A_DE:
                                ;   A と (DE) が同じドライブか調べる
                                ;   ZF=1ならば同じドライブ
0010A5 D6C9 CDD5D6          17      CALL    GETDRV1
0010A8 D6CC C5              11      PUSH    BC
0010A9 D6CD 4F               4      LD  C,A
0010AA D6CE 1A               7      LD  A,(DE)
0010AB D6CF CDD5D6          17      CALL    GETDRV1
0010AE D6D2 A9               4      XOR C
0010AF D6D3 C1              10      POP BC
0010B0 D6D4 C9              10      RET
       D6D5                     GETDRV1:
0010B1 D6D5 E67F             7      AND 07FH
0010B3 D6D7 D601             7      SUB 001H
0010B5 D6D9 D0              11      RET NC
0010B6 D6DA 3A0400          13      LD  A,(_DVSW)   ;Current Drive
0010B9 D6DD C9              10      RET
                                
       D6DE                     SOPENX:
0010BA D6DE 1139E5          10      LD  DE,SFILE
0010BD D6E1 FD7E00          19      LD  A,(IY+0)        ;(FCB)ドライブ番号
0010C0 D6E4 CDC9D6          17      CALL    IS_SAME_DRV_A_DE
0010C3 D6E7 2024            12      JR  NZ,SOPEN
0010C5 D6E9 13               6      INC DE
0010C6 D6EA FDE5            15      PUSH    IY
0010C8 D6EC E1              10      POP HL
0010C9 D6ED 23               6      INC HL
0010CA D6EE CD7AD8          17      CALL    CPFILE
0010CD D6F1 201A            12      JR  NZ,SOPEN
                                
0010CF D6F3 2AF4E6          16      LD  HL,(SCDIR)
0010D2 D6F6 FD750E          19      LD  (IY+14),L   ;(FCB)アクセスするディレクトリのクラスタ番号+1
0010D5 D6F9 FD740F          19      LD  (IY+15),H
                                
0010D8 D6FC 2AF8E6          16      LD  HL,(SFNDF)  ;Direcroty location and Flags
0010DB D6FF 229FE5          16      LD  (_FILEN),HL
                                
0010DE D702 ED5BF6E6        20      LD  DE,(SFBPS)
0010E2 D706 2139E5          10      LD  HL,SFILE
0010E5 D709 36FF            10      LD  (HL),0FFH
0010E7 D70B 23               6      INC HL
0010E8 D70C C9              10      RET
       D70D                     SOPEN:
0010E9 D70D 2122D8          10      LD  HL,FILESE
       D710                     SOPENC:
0010EC D710 2249D7          16      LD  (OPENPAT),HL
                                
0010EF D713 CDE2E5          17      CALL    _RDFATX     ;Detect Media
0010F2 D716 3856            12      JR  C,RDDERR
                                
0010F4 D718 AF               4      XOR A
0010F5 D719 329FE5          13      LD  (_FILEN),A
0010F8 D71C CD22D9          17      CALL    LDDIRX1     ;A=0で呼び出す
0010FB D71F 2818            12      JR  Z,SDIRX1
                                
0010FD D721 CD13D8          17      CALL    READ_DIR    ;Sub Directory
001100 D724 3808            12      JR  C,SDIRX0
001102 D726 2A7EE6          16      LD  HL,(_DTBUF)
001105 D729 7E               7      LD  A,(HL)
001106 D72A FE2E             7      CP  '.'
001108 D72C 280F            12      JR  Z,SOPEN1
       D72E                     SDIRX0:
00110A D72E AF               4      XOR A
00110B D72F 32A0E5          13      LD  (_DIRF),A
00110E D732 FD360E01        19      LD  (IY+14),1   ;(FCB)レコードサイズ
001112 D736 FD770F          19      LD  (IY+15),A
       D739                     SDIRX1:
001115 D739 ED5BFCE6        20      LD  DE,(_DIRPS) ;Root Directory
       D73D                     SOPEN1:
001119 D73D 0E20             7      LD  C,32        ;自己書き換え 1セクタ辺りのディレクトリエントリ数  1024=32 / 512=16 / 256=8
       D73E                     SDECPAT EQU $-1
       D73F                     SOPEN1X:
00111B D73F CD13D8          17      CALL    READ_DIR    ;FILE SEARCH
00111E D742 382A            12      JR  C,RDDERR
001120 D744 2A7EE6          16      LD  HL,(_DTBUF)
       D747                     SOPEN2:
001123 D747 D5              11      PUSH    DE
001124 D748 CD22D8          17      CALL    FILESE      ;(self-modifying code)
       D749                     OPENPAT EQU $-2
001127 D74B D1              10      POP DE
001128 D74C 386D            12      JR  C,SOPENE
00112A D74E 281B            12      JR  Z,SCF_FF_RET
       D750                     SOPEN3:
00112C D750 3AA0E5          13      LD  A,(_DIRF)   ;ディレクトリか判別
00112F D753 B7               4      OR  A
001130 D754 200C            12      JR  NZ,SOPEN5
001132 D756 13               6      INC DE      ;ルートディレクトリ
001133 D757 E5              11      PUSH    HL
001134 D758 210C00          10      LD  HL,12       ;(self-modifying code)MAXDIR
       D759                     MD_PAT  EQU $-2
001137 D75B ED52            15      SBC HL,DE       ;CF=0 なので SUB HL,DE
001139 D75D E1              10      POP HL
00113A D75E 20DD            12      JR  NZ,SOPEN1
00113C D760 1807            12      JR  SOPEN6
       D762                     SOPEN5:
00113E D762 CD38E0          17      CALL    GNCLX       ;END DIR
001141 D765 D8              11      RET C
001142 D766 CDDAD8          17      CALL    ENDCL
       D769                     SOPEN6:
001145 D769 38D2            12      JR  C,SOPEN1
       D76B                     SCF_FF_RET:
001147 D76B 37               4      SCF         ;CF=1
001148 D76C 9F               4      SBC A,A     ;A=0FFH
001149 D76D C9              10      RET
                                
       D76E                     RDDERR:
00114A D76E BF               4      CP  A       ;READ ERR CF=1 ZF=1
00114B D76F 37               4      SCF
00114C D770 C9              10      RET
                                
       D771                     NOPEN:
00114D D771 2122D8          10      LD  HL,FILESE
001150 D774 2249D7          16      LD  (OPENPAT),HL
001153 D777 FD2A98E5        20      LD  IY,(_FCB)
001157 D77B CD02DA          17      CALL    CHKWILDX
00115A D77E 30EB            12      JR  NC,SCF_FF_RET
00115C D780 FD7E00          19      LD  A,(IY+0)
00115F D783 CDC2D6          17      CALL    GETDRV
001162 D786 CDD9E5          17      CALL    _CHGDRV
001165 D789 D8              11      RET C
001166 D78A 2AF8E6          16      LD  HL,(SFNDF)  ;Direcroty location and Flags
001169 D78D 229FE5          16      LD  (_FILEN),HL
                                
00116C D790 CD1DD9          17      CALL    LDDIRX
00116F D793 ED5B9AE5        20      LD  DE,(_FBPS)
001173 D797 CD13D8          17      CALL    READ_DIR
001176 D79A 38D2            12      JR  C,RDDERR
001178 D79C 3A9EE5          13      LD  A,(_FBCNT)
00117B D79F 3D               4      DEC A
00117C D7A0 28AE            12      JR  Z,SOPEN3
       D7A2                     NOPEN2:
00117E D7A2 2A9CE5          16      LD  HL,(_FBAD)
001181 D7A5 012000          10      LD  BC,020H
001184 D7A8 09              11      ADD HL,BC
001185 D7A9 4F               4      LD  C,A
001186 D7AA 189B            12      JR  SOPEN2
                                
       D7AC                     SOPENE2:
001188 D7AC 229CE5          16      LD  (_FBAD),HL
00118B D7AF 79               4      LD  A,C
00118C D7B0 329EE5          13      LD  (_FBCNT),A
00118F D7B3 ED539AE5        20      LD  (_FBPS),DE
001193 D7B7 FD2298E5        20      LD  (_FCB),IY
       D7BB                     SOPENE:
001197 D7BB AF               4      XOR A
001198 D7BC C9              10      RET
                                
       D7BD                     COPEN:
001199 D7BD FD360D20        19      LD  (IY+13),020H    ;(FCB)属性(アトリビュート)
                                
00119D D7C1 213FD8          10      LD  HL,NEXTSE
0011A0 D7C4 CD10D7          17      CALL    SOPENC
0011A3 D7C7 D0              11      RET NC
0011A4 D7C8 C8              11      RET Z
0011A5 D7C9 3AA0E5          13      LD  A,(_DIRF)   ;ディレクトリか判別
0011A8 D7CC B7               4      OR  A
0011A9 D7CD 37               4      SCF
0011AA D7CE C8              11      RET Z       ;ルートディレクトリ
0011AB D7CF 0601             7      LD  B,1
0011AD D7D1 CD61DA          17      CALL    WRDF
0011B0 D7D4 D8              11      RET C
0011B1 D7D5 ED5BFEE6        20      LD  DE,(_CLPS)
0011B5 D7D9 D5              11      PUSH    DE
0011B6 D7DA CDA3D8          17      CALL    DCPAT
0011B9 D7DD CDBCDE          17      CALL    DRDNX
0011BC D7E0 2A7EE6          16      LD  HL,(_DTBUF) ;ディレクトリエントリを0クリア
0011BF D7E3 3AA2DD          13      LD  A,(SECSZ+2) ;1024=4 / 512=2 / 256=1
0011C2 D7E6 47               4      LD  B,A
0011C3 D7E7 AF               4      XOR A
0011C4 D7E8 4F               4      LD  C,A
       D7E9                     COPENCL:
0011C5 D7E9 77               7      LD  (HL),A
0011C6 D7EA EDA1            16      CPI         ;HL=HL+1 BC=BC-1 BCが0の場合にP/V=0
0011C8 D7EC EAE9D7          10      JP  PE,COPENCL
                                
0011CB D7EF 3AC1D8          13      LD  A,(SPCPAT)  ;1クラスタの論理セクタ数
0011CE D7F2 3D               4      DEC A
0011CF D7F3 2819            12      JR  Z,COPENE
0011D1 D7F5 3E01             7      LD  A,1     ;1セクタ辺りのセクタ数が2以上の場合
0011D3 D7F7 3230E0          13      LD  (_SECPS),A
0011D6 D7FA D1              10      POP DE      ;DE=(_CLPS)
0011D7 D7FB D5              11      PUSH    DE
       D7FC                     COPEN1:
0011D8 D7FC D5              11      PUSH    DE      ;データバッファに入らないセクタもゼロクリア
0011D9 D7FD C5              11      PUSH    BC
0011DA D7FE 2A7EE6          16      LD  HL,(_DTBUF)
0011DD D801 CDBDD8          17      CALL    CLUSTX
0011E0 D804 CDD1E1          17      CALL    DWT24
0011E3 D807 C1              10      POP BC
0011E4 D808 D1              10      POP DE
0011E5 D809 CD2FE0          17      CALL    NEXTX
0011E8 D80C 20EE            12      JR  NZ,COPEN1
       D80E                     COPENE:
0011EA D80E 2A7EE6          16      LD  HL,(_DTBUF)
0011ED D811 D1              10      POP DE
0011EE D812 C9              10      RET
                                
       D813                     READ_DIR:
0011EF D813 ED53FEE6        20      LD  (_CLPS),DE
0011F3 D817 C5              11      PUSH    BC
0011F4 D818 D5              11      PUSH    DE
0011F5 D819 CDA3D8          17      CALL    DCPAT
0011F8 D81C CD9CDE          17      CALL    DRDX
0011FB D81F D1              10      POP DE
0011FC D820 C1              10      POP BC
0011FD D821 C9              10      RET
                                
       D822                     FILESE:
0011FE D822 7E               7      LD  A,(HL)
0011FF D823 B7               4      OR  A
001200 D824 C8              11      RET Z       ;END:ZF=1 CF=0
001201 D825 FEE5             7      CP  0E5H
001203 D827 280E            12      JR  Z,FILESE1
001205 D829 FDE5            15      PUSH    IY
001207 D82B D1              10      POP DE
001208 D82C 13               6      INC DE
001209 D82D E5              11      PUSH    HL
00120A D82E CD7AD8          17      CALL    CPFILE
00120D D831 CC9BD8          17      CALL    Z,CPFILE2
001210 D834 E1              10      POP HL
001211 D835 37               4      SCF
001212 D836 C8              11      RET Z       ;!!!:(ZF=1) CF=1
       D837                     FILESE1:
001213 D837 CD4ED8          17      CALL    FNEXT
001216 D83A 20E6            12      JR  NZ,FILESE
       D83C                     ZF0_CF0_AFF_RET:
001218 D83C F6FF             7      OR  0FFH        ;ZF=0 CF=0
00121A D83E C9              10      RET
                                
       D83F                     NEXTSE:
00121B D83F 7E               7      LD  A,(HL)
00121C D840 B7               4      OR  A
00121D D841 37               4      SCF
00121E D842 C8              11      RET Z       ;!!!:ZF=1 CF=1
00121F D843 FEE5             7      CP  0E5H
001221 D845 37               4      SCF
001222 D846 C8              11      RET Z       ;!!!:(ZF=1) CF=1
001223 D847 CD4ED8          17      CALL    FNEXT
001226 D84A 20F3            12      JR  NZ,NEXTSE
001228 D84C 18EE            12      JR  ZF0_CF0_AFF_RET
                                
       D84E                     FNEXT:
00122A D84E E5              11      PUSH    HL
00122B D84F 219FE5          10      LD  HL,_FILEN
00122E D852 34              11      INC (HL)
00122F D853 E1              10      POP HL
001230 D854 112000          10      LD  DE,020H
001233 D857 19              11      ADD HL,DE
001234 D858 0D               4      DEC C
001235 D859 C9              10      RET
                                
       D85A                     CPNAME:
001236 D85A C5              11      PUSH    BC
001237 D85B D5              11      PUSH    DE
001238 D85C E5              11      PUSH    HL
001239 D85D CD74D8          17      CALL    CPFILE4
00123C D860 E1              10      POP HL
00123D D861 23               6      INC HL
00123E D862 23               6      INC HL
00123F D863 23               6      INC HL
001240 D864 23               6      INC HL
001241 D865 D1              10      POP DE
001242 D866 C1              10      POP BC
001243 D867 2005            12      JR  NZ,CPNAME1
001245 D869 7E               7      LD  A,(HL)
001246 D86A 23               6      INC HL
001247 D86B 66               7      LD  H,(HL)
001248 D86C 6F               4      LD  L,A
001249 D86D C9              10      RET
       D86E                     CPNAME1:
00124A D86E 23               6      INC HL
00124B D86F 23               6      INC HL
00124C D870 10E8            13      DJNZ    CPNAME
00124E D872 37               4      SCF
00124F D873 C9              10      RET
                                
       D874                     CPFILE4:
001250 D874 C5              11      PUSH    BC
001251 D875 010004          10      LD  BC,00400H
001254 D878 1804            12      JR  CPSTR1
       D87A                     CPFILE:
001256 D87A C5              11      PUSH    BC
001257 D87B 01000B          10      LD  BC,00B00H
       D87E                     CPSTR1:
00125A D87E 1A               7      LD  A,(DE)
00125B D87F FE3F             7      CP  '?'     ;Wild card
00125D D881 2812            12      JR  Z,CPSTR2
00125F D883 7E               7      LD  A,(HL)
001260 D884 CDE8D9          17      CALL    FKANC
001263 D887 E5              11      PUSH    HL
001264 D888 67               4      LD  H,A
001265 D889 1A               7      LD  A,(DE)
001266 D88A CB01             4      RLC C
001268 D88C CDE8D9          17      CALL    FKANC
00126B D88F CB09             4      RRC C
00126D D891 BC               4      CP  H       ;CP (HL),(DE)
00126E D892 E1              10      POP HL
00126F D893 2004            12      JR  NZ,CPSTR3
       D895                     CPSTR2:
001271 D895 13               6      INC DE
001272 D896 23               6      INC HL
001273 D897 10E5            13      DJNZ    CPSTR1
       D899                     CPSTR3:
001275 D899 C1              10      POP BC
001276 D89A C9              10      RET
                                
       D89B                     CPFILE2:
001277 D89B FD7E0D          19      LD  A,(IY+13)   ;(FCB)属性(アトリビュート)
00127A D89E F6E1             7      OR  0E1H
00127C D8A0 2F               4      CPL
00127D D8A1 A6               7      AND (HL)
00127E D8A2 C9              10      RET
                                
       D8A3                     DCPAT:
00127F D8A3 0E00             7      LD  C,0
001281 D8A5 2A7EE6          16      LD  HL,(_DTBUF)
001284 D8A8 3AA0E5          13      LD  A,(_DIRF)   ;ディレクトリか判別
001287 D8AB B7               4      OR  A
001288 D8AC C8              11      RET Z       ;ルートディレクトリの場合はCレジスタを0にしておく(CDEがセクタ番号)
001289 D8AD 3AC1D8          13      LD  A,(SPCPAT)
00128C D8B0 4F               4      LD  C,A
00128D D8B1 3A30E0          13      LD  A,(_SECPS)
001290 D8B4 B9               4      CP  C
001291 D8B5 3801            12      JR  C,DC1
001293 D8B7 AF               4      XOR A
       D8B8                     DC1:
001294 D8B8 F680             7      OR  080H
001296 D8BA 32A0E5          13      LD  (_DIRF),A   ;bit0-6:セクタインデックス
       D8BD                     CLUSTX:
001299 D8BD E5              11      PUSH    HL
00129A D8BE EB               4      EX  DE,HL
00129B D8BF AF               4      XOR A
00129C D8C0 0E01             7      LD  C,1     ;自己書き換え（1クラスタの論理セクタ数）
       D8C1                     SPCPAT  EQU $-1
       D8C2                     L_CLDBL:
00129E D8C2 CB19             8      RR  C       ;->CF
0012A0 D8C4 3804            12      JR  C,E_CLDBL
0012A2 D8C6 29              11      ADD HL,HL       ;*2
0012A3 D8C7 8F               4      ADC A,A
0012A4 D8C8 18F8            12      JR  L_CLDBL
       D8CA                     E_CLDBL:
0012A6 D8CA 4F               4      LD  C,A
0012A7 D8CB 3A30E0          13      LD  A,(_SECPS)
0012AA D8CE B5               4      OR  L
0012AB D8CF 6F               4      LD  L,A
0012AC D8D0 110800          10      LD  DE,8    ;+8 (2D)  !ADDCL (self-modifying code)
       D8D1                     CLSPAT  EQU $-2
0012AF D8D3 AF               4      XOR A
0012B0 D8D4 19              11      ADD HL,DE   ;データ格納領域の先頭論理セクタ番号
0012B1 D8D5 89               4      ADC A,C
0012B2 D8D6 4F               4      LD  C,A
0012B3 D8D7 EB               4      EX  DE,HL
0012B4 D8D8 E1              10      POP HL
0012B5 D8D9 C9              10      RET
                                
       D8DA                     ENDCL:
0012B6 D8DA 7A               4      LD  A,D ;END CLUSTER
0012B7 D8DB FE01             7      CP  1   ;164=356    (self-modifying code)
       D8DC                     CLPAT1  EQU $-1
0012B9 D8DD C0              11      RET NZ
0012BA D8DE 7B               4      LD  A,E
0012BB D8DF FE64             7      CP  064H    ;       (self-modifying code)
       D8E0                     CLPAT2  EQU $-1
0012BD D8E1 C9              10      RET
                                
       D8E2                     CAP:
0012BE D8E2 FE61             7      CP  'a'
0012C0 D8E4 D8              11      RET C
0012C1 D8E5 FE7B             7      CP  'z'+1
0012C3 D8E7 D0              11      RET NC
0012C4 D8E8 D620             7      SUB 020H
0012C6 D8EA C9              10      RET
       D8EB                     CAP2:
0012C7 D8EB CDE2D8          17      CALL    CAP
       D8EE                     CAP3:               ;
0012CA D8EE FE05             7      CP  5
0012CC D8F0 2803            12      JR  Z,CAP4
0012CE D8F2 FE21             7      CP  021H
0012D0 D8F4 C9              10      RET
       D8F5                     CAP4:
0012D1 D8F5 3EE5             7      LD  A,0E5H
0012D3 D8F7 C9              10      RET
                                
       D8F8                     CHDIR:
0012D4 D8F8 CDE4E2          17      CALL    GETDPBD
0012D7 D8FB 381D            12      JR  C,CHDIR2
0012D9 D8FD DD751A          19      LD  (IX+DPB_SDIR),L
0012DC D900 DD741B          19      LD  (IX+DPB_SDIR+1),H
0012DF D903 1815            12      JR  CHDIR2      ;POP_IX_RET
                                
       D905                     LDDIR:
0012E1 D905 CDE4E2          17      CALL    GETDPBD
0012E4 D908 DD5E1A          19      LD  E,(IX+DPB_SDIR)
0012E7 D90B DD561B          19      LD  D,(IX+DPB_SDIR+1)
0012EA D90E 13               6      INC DE
0012EB D90F FD730E          19      LD  (IY+14),E   ;(FCB)アクセスするディレクトリのクラスタ番号+1
0012EE D912 FD720F          19      LD  (IY+15),D
0012F1 D915 1B               6      DEC DE
0012F2 D916 AF               4      XOR A
0012F3 D917 32A0E5          13      LD  (_DIRF),A
       D91A                     CHDIR2:
0012F6 D91A DDE1            14      POP IX
0012F8 D91C C9              10      RET
                                
       D91D                     LDDIRX:
0012F9 D91D 3AA0E5          13      LD  A,(_DIRF)   ;(FCB)アクセスするディレクトリのセクタインデックス
0012FC D920 E67F             7      AND 07FH
       D922                     LDDIRX1:
0012FE D922 3230E0          13      LD  (_SECPS),A
001301 D925 FD5E0E          19      LD  E,(IY+14)   ;(FCB)アクセスするディレクトリのクラスタ番号+1
001304 D928 FD560F          19      LD  D,(IY+15)
001307 D92B 1B               6      DEC DE
001308 D92C CDDAD8          17      CALL    ENDCL
00130B D92F D405D9          17      CALL    NC,LDDIR
       D932                     LDDIRS:
00130E D932 7A               4      LD  A,D
00130F D933 B3               4      OR  E
001310 D934 32A0E5          13      LD  (_DIRF),A   ;ディレクトリか判別
001313 D937 C9              10      RET
                                
       D938                     KILL:
001314 D938 CD02DA          17      CALL    CHKWILDX
001317 D93B 3834            12      JR  C,KILLW
001319 D93D CDDED6          17      CALL    SOPENX
       D940                     KILLS:
00131C D940 3E1F             7      LD  A,01FH
00131E D942 D484D9          17      CALL    NC,CHKATT
001321 D945 D8              11      RET C
       D946                     KILLSX:
001322 D946 36E5            10      LD  (HL),0E5H   ;DIR
001324 D948 CDDCD9          17      CALL    WTDB
001327 D94B 111A00          10      LD  DE,01AH
00132A D94E 19              11      ADD HL,DE
00132B D94F 5E               7      LD  E,(HL)
00132C D950 23               6      INC HL
00132D D951 56               7      LD  D,(HL)
       D952                     KILLS1:
00132E D952 CDDAD8          17      CALL    ENDCL
001331 D955 D0              11      RET NC      ;CF=0
001332 D956 21FEFF          10      LD  HL,0-2
001335 D959 19              11      ADD HL,DE
001336 D95A D0              11      RET NC      ;DE= 0 or 1
001337 D95B D5              11      PUSH    DE
001338 D95C CDF7E5          17      CALL    _GNCL
00133B D95F ED53FEE6        20      LD  (_CLPS),DE
00133F D963 D1              10      POP DE
001340 D964 210000          10      LD  HL,0
001343 D967 D4FAE5          17      CALL    NC,_SNCL
001346 D96A D8              11      RET C
001347 D96B ED5BFEE6        20      LD  DE,(_CLPS)  ;FAT
00134B D96F 18E1            12      JR  KILLS1
                                
       D971                     KILLW:
00134D D971 CD0DD7          17      CALL    SOPEN
       D974                     KILLW1:
001350 D974 380B            12      JR  C,KILLW2
001352 D976 CDACD7          17      CALL    SOPENE2
001355 D979 CD40D9          17      CALL    KILLS
001358 D97C CD71D7          17      CALL    NOPEN
00135B D97F 18F3            12      JR  KILLW1
       D981                     KILLW2:
00135D D981 C8              11      RET Z
00135E D982 3F               4      CCF
00135F D983 C9              10      RET
                                
       D984                     CHKATT:
001360 D984 E5              11      PUSH    HL
001361 D985 110B00          10      LD  DE,00BH
001364 D988 19              11      ADD HL,DE
001365 D989 A6               7      AND (HL)
001366 D98A E1              10      POP HL
001367 D98B C8              11      RET Z
001368 D98C 37               4      SCF
001369 D98D C9              10      RET
                                
       D98E                     NAME:
00136A D98E CD02DA          17      CALL    CHKWILDX
00136D D991 D8              11      RET C
00136E D992 110400          10      LD  DE,4
001371 D995 19              11      ADD HL,DE
001372 D996 22ABD9          16      LD  (NAMEP),HL
001375 D999 23               6      INC HL
001376 D99A CD06DA          17      CALL    CHKWILD
001379 D99D D8              11      RET C
                                
00137A D99E CDDED6          17      CALL    SOPENX
00137D D9A1 3E0F             7      LD  A,00FH
00137F D9A3 D484D9          17      CALL    NC,CHKATT
001382 D9A6 D8              11      RET C
                                
001383 D9A7 FDE5            15      PUSH    IY
001385 D9A9 FD210000        14      LD  IY,0        ;自己書き換え
       D9AB                     NAMEP   EQU $-2
001389 D9AD CDDED6          17      CALL    SOPENX
00138C D9B0 FDE3            23      EX  (SP),IY
00138E D9B2 3F               4      CCF
00138F D9B3 D40DD7          17      CALL    NC,SOPEN
001392 D9B6 EB               4      EX  DE,HL
001393 D9B7 E1              10      POP HL
001394 D9B8 D8              11      RET C
                                
       D9B9                     SETNAME:
001395 D9B9 01000B          10      LD  BC,11*256
001398 D9BC 23               6      INC HL
001399 D9BD 7E               7      LD  A,(HL)
00139A D9BE FEE5             7      CP  0E5H
00139C D9C0 2004            12      JR  NZ,SNAME1
00139E D9C2 3E05             7      LD  A,5
0013A0 D9C4 180E            12      JR  SNAME3
       D9C6                     SNAME1:
0013A2 D9C6 7E               7      LD  A,(HL)
0013A3 D9C7 0C               4      INC C
0013A4 D9C8 0D               4      DEC C
0013A5 D9C9 2009            12      JR  NZ,SNAME3
0013A7 D9CB CDE2D8          17      CALL    CAP
0013AA D9CE FEA0             7      CP  0A0H
0013AC D9D0 2002            12      JR  NZ,SNAME3
0013AE D9D2 3E20             7      LD  A,020H
       D9D4                     SNAME3:
0013B0 D9D4 12               7      LD  (DE),A
0013B1 D9D5 7E               7      LD  A,(HL)
0013B2 D9D6 23               6      INC HL
0013B3 D9D7 CDEFD9          17      CALL    FKAN
0013B6 D9DA 10EA            13      DJNZ    SNAME1
       D9DC                     WTDB:
0013B8 D9DC 3EFF             7      LD  A,0FFH
0013BA D9DE 3239E5          13      LD  (SFILE),A
0013BD D9E1 3E01             7      LD  A,1
0013BF D9E3 32A4E5          13      LD  (_WTDBF),A
0013C2 D9E6 AF               4      XOR A
0013C3 D9E7 C9              10      RET
                                
       D9E8                     FKANC:
0013C4 D9E8 CB41             8      BIT 0,C
0013C6 D9EA CCEBD8          17      CALL    Z,CAP2
0013C9 D9ED 1801            12      JR  FKANX
       D9EF                     FKAN:           ;漢字チェック
0013CB D9EF 13               6      INC DE
       D9F0                     FKANX:
0013CC D9F0 CB41             8      BIT 0,C
0013CE D9F2 CB81             8      RES 0,C
0013D0 D9F4 C0              11      RET NZ
0013D1 D9F5 FE80             7      CP  080H
0013D3 D9F7 D8              11      RET C
0013D4 D9F8 FEA0             7      CP  0A0H
0013D6 D9FA 3803            12      JR  C,FKAN1
0013D8 D9FC FEE0             7      CP  0E0H
0013DA D9FE D8              11      RET C
       D9FF                     FKAN1:
0013DB D9FF 0C               4      INC C
0013DC DA00 A7               4      AND A
0013DD DA01 C9              10      RET
                                
       DA02                     CHKWILDX:
0013DE DA02 FDE5            15      PUSH    IY
0013E0 DA04 E1              10      POP HL
0013E1 DA05 23               6      INC HL
       DA06                     CHKWILD:
0013E2 DA06 060B             7      LD  B,11
0013E4 DA08 3E3F             7      LD  A,'?'
       DA0A                     CHKWIL1:
0013E6 DA0A BE               7      CP  (HL)
0013E7 DA0B 23               6      INC HL
0013E8 DA0C 37               4      SCF
0013E9 DA0D C8              11      RET Z
0013EA DA0E 10FA            13      DJNZ    CHKWIL1
0013EC DA10 AF               4      XOR A
0013ED DA11 C9              10      RET
                                
       DA12                     SDIRENT:        ;IY=FCB HL=DIR
0013EE DA12 D5              11      PUSH    DE
0013EF DA13 E5              11      PUSH    HL
0013F0 DA14 FDE5            15      PUSH    IY
0013F2 DA16 D1              10      POP DE
0013F3 DA17 EB               4      EX  DE,HL
0013F4 DA18 CDB9D9          17      CALL    SETNAME
                                ;               Attribute
0013F7 DA1B FD7E0D          19      LD  A,(IY+13)   ;(FCB)属性(アトリビュート)
0013FA DA1E 12               7      LD  (DE),A
0013FB DA1F 13               6      INC DE
                                ;               Reserved
0013FC DA20 AF               4      XOR A
0013FD DA21 060A             7      LD  B,10
       DA23                     SDE1:
0013FF DA23 12               7      LD  (DE),A
001400 DA24 13               6      INC DE
001401 DA25 10FC            13      DJNZ    SDE1
                                                    ;(FCB)更新時刻
001403 DA27 21E4E6          10      LD  HL,SDDATA       ;(FCB)更新年月日
001406 DA2A 060A             7      LD  B,SDDATAE-SDDATA    ;(FCB)ファイルの先頭クラスタ
       DA2C                     SDLOOP:                 ;(FCB)ファイルのサイズ(バイト単位)
001408 DA2C 7E               7      LD  A,(HL)
001409 DA2D 23               6      INC HL
00140A DA2E 3233DA          13      LD  (SDPAT),A
00140D DA31 FD7E00          19      LD  A,(IY+0)    ;LD A,(IY+A)
       DA33                     SDPAT   EQU $-1
001410 DA34 12               7      LD  (DE),A
001411 DA35 13               6      INC DE
001412 DA36 10F4            13      DJNZ    SDLOOP
                                
001414 DA38 AF               4      XOR A
001415 DA39 E1              10      POP HL
001416 DA3A D1              10      POP DE
001417 DA3B C9              10      RET
                                
       DA3C                     WOPEN:
001418 DA3C FD7E0D          19      LD  A,(IY+13)   ;(FCB)属性(アトリビュート)
00141B DA3F E61F             7      AND 01FH
00141D DA41 37               4      SCF
00141E DA42 C0              11      RET NZ
00141F DA43 FD361CFE        19      LD  (IY+28),0FEH    ;(FCB)オープンモード
       DA47                     TOPEN2:
001423 DA47 AF               4      XOR A
       DA48                     TOPEN:              ;Initializes the time stamp
001424 DA48 FD3617FF        19      LD  (IY+23),0FFH    ;(FCB)更新時刻
001428 DA4C C9              10      RET
                                
       DA4D                     WRDFX:
001429 DA4D 3AC1D8          13      LD  A,(SPCPAT)  ;1クラスタの論理セクタ
       DA50                     L_WRFX:
00142C DA50 1F               4      RRA         ;->CF
00142D DA51 3806            12      JR  C,E_WRFX
00142F DA53 CB39             8      SRL C
001431 DA55 CB1C             8      RR  H       ;CH=CH/2
001433 DA57 18F7            12      JR  L_WRFX
       DA59                     E_WRFX:
001435 DA59 41               4      LD  B,C
001436 DA5A 4C               4      LD  C,H
001437 DA5B 03               6      INC BC
001438 DA5C 3E37             7      LD  A,037H      ;SCF
00143A DA5E 32B9DE          13      LD  (DRDN1),A
                                
       DA61                     WRDF:               ;BCクラスタ分FATを確保する
00143D DA61 110200          10      LD  DE,2
001440 DA64 AF               4      XOR A
001441 DA65 3230E0          13      LD  (_SECPS),A
       DA68                     WRDF1:
001444 DA68 C5              11      PUSH    BC
001445 DA69 D5              11      PUSH    DE
001446 DA6A CDF7E5          17      CALL    _GNCL
001449 DA6D 381C            12      JR  C,WRDF3
00144B DA6F 7A               4      LD  A,D     ;空いているかチェック
00144C DA70 B3               4      OR  E
00144D DA71 202A            12      JR  NZ,WRDF4
00144F DA73 E1              10      POP HL      ;HL=空いているクラスタ
001450 DA74 E5              11      PUSH    HL
001451 DA75 ED5BFEE6        20      LD  DE,(_CLPS)  ;DE=元の(_CLPS)
001455 DA79 22FEE6          16      LD  (_CLPS),HL
001458 DA7C 7A               4      LD  A,D     ;元の(_CLPS)が 0 か?
001459 DA7D B3               4      OR  E
00145A DA7E 2008            12      JR  NZ,WRDF2
00145C DA80 FD751A          19      LD  (IY+26),L   ;(FCB)ファイルの先頭クラスタ
00145F DA83 FD741B          19      LD  (IY+27),H   ;元が空の場合はFCBにクラスタをセットする
001462 DA86 1803            12      JR  WRDF3
       DA88                     WRDF2:
001464 DA88 CDFAE5          17      CALL    _SNCL
       DA8B                     WRDF3:
001467 DA8B D1              10      POP DE
001468 DA8C C1              10      POP BC
001469 DA8D D8              11      RET C
00146A DA8E 0B               6      DEC BC
00146B DA8F 78               4      LD  A,B
00146C DA90 B1               4      OR  C
00146D DA91 200C            12      JR  NZ,WRDF5    ;ここでループカウンタチェック
00146F DA93 ED5BFEE6        20      LD  DE,(_CLPS)
001473 DA97 21FFFF          10      LD  HL,0FFFFH   ;FATエントリ終了(EOCマーク)
001476 DA9A C3FAE5          10      JP  _SNCL
                                
       DA9D                     WRDF4:              ;DEクラスタが空じゃないので次に移動する
001479 DA9D D1              10      POP DE
00147A DA9E C1              10      POP BC
       DA9F                     WRDF5:
00147B DA9F 13               6      INC DE
00147C DAA0 CDDAD8          17      CALL    ENDCL
00147F DAA3 38C3            12      JR  C,WRDF1
001481 DAA5 37               4      SCF
001482 DAA6 C9              10      RET
                                
       DAA7                     RWXR:
001483 DAA7 3AA2DD          13      LD  A,(SECSZ+2) ;1024=4 / 512=2 / 256=1
       DAAA                     L_RWX:
001486 DAAA 1F               4      RRA     ;->CF
001487 DAAB 3808            12      JR  C,E_RWX
001489 DAAD CB38             8      SRL B   ;BCH=BCH/2
00148B DAAF CB19             8      RR  C   ;
00148D DAB1 CB1C             8      RR  H   ;
00148F DAB3 18F5            12      JR  L_RWX
       DAB5                     E_RWX:
001491 DAB5 FD5E1A          19      LD  E,(IY+26)   ;(FCB)ファイルの先頭クラスタ
001494 DAB8 FD561B          19      LD  D,(IY+27)
001497 DABB AF               4      XOR A
001498 DABC 3230E0          13      LD  (_SECPS),A
       DABF                     RWX1:
00149B DABF ED53FEE6        20      LD  (_CLPS),DE
00149F DAC3 7A               4      LD  A,D
0014A0 DAC4 B3               4      OR  E
0014A1 DAC5 2813            12      JR  Z,SCF_RET   ;RET DE==0 => CF=1
                                
0014A3 DAC7 78               4      LD  A,B
0014A4 DAC8 B1               4      OR  C
0014A5 DAC9 B4               4      OR  H
0014A6 DACA C8              11      RET Z       ;RET BCH==0 => CF=0
                                
0014A7 DACB CD38E0          17      CALL    GNCLX
0014AA DACE D8              11      RET C
0014AB DACF 7C               4      LD  A,H     ;
0014AC DAD0 25               4      DEC H       ;
0014AD DAD1 B7               4      OR  A       ;DEC BCH
0014AE DAD2 2001            12      JR  NZ,RWX2     ;
0014B0 DAD4 0B               6      DEC BC      ;
       DAD5                     RWX2:
0014B1 DAD5 CDDAD8          17      CALL    ENDCL
0014B4 DAD8 38E5            12      JR  C,RWX1
       DADA                     SCF_RET:
0014B6 DADA 37               4      SCF
0014B7 DADB C9              10      RET
                                
       DADC                     DSKF:
0014B8 DADC 110000          10      LD  DE,0
       DADD                     MAXCLP  EQU $-2
0014BB DADF 2AACE5          16      LD  HL,(_FAKEFREE)
0014BE DAE2 7C               4      LD  A,H
0014BF DAE3 B5               4      OR  L
0014C0 DAE4 2803            12      JR  Z,DSKF1
0014C2 DAE6 110100          10      LD  DE,1
       DAE9                     DSKF1:
0014C5 DAE9 D5              11      PUSH    DE
0014C6 DAEA CDF7E5          17      CALL    _GNCL
0014C9 DAED 380C            12      JR  C,POPSCF
0014CB DAEF 7A               4      LD  A,D
0014CC DAF0 B3               4      OR  E
0014CD DAF1 2001            12      JR  NZ,DSKF2
0014CF DAF3 23               6      INC HL
       DAF4                     DSKF2:
0014D0 DAF4 D1              10      POP DE
0014D1 DAF5 1B               6      DEC DE
0014D2 DAF6 7A               4      LD  A,D
0014D3 DAF7 B3               4      OR  E
0014D4 DAF8 20EF            12      JR  NZ,DSKF1
0014D6 DAFA C9              10      RET
                                
       DAFB                     POPSCF:
0014D7 DAFB F1              10      POP AF
0014D8 DAFC 37               4      SCF
0014D9 DAFD C9              10      RET
                                
       DAFE                     SETTMS:
0014DA DAFE FD7E17          19      LD  A,(IY+23)   ;(FCB)ファイルを最後に変更した時刻
0014DD DB01 3C               4      INC A
0014DE DB02 C0              11      RET NZ      ;ファイルが更新されていない
       DB03                     SETTMSX:            ;FCBに日付時刻をセットする
0014DF DB03 CDC6D2          17      CALL    _SYS2C      ;(BDOS)時刻の獲得
                                                ;H←時  L←分  D←秒
0014E2 DB06 CB25             8      SLA L       ;   *2
0014E4 DB08 CB25             8      SLA L       ;   *4
0014E6 DB0A 29              11      ADD HL,HL       ;*2 *8
0014E7 DB0B 29              11      ADD HL,HL       ;*4 *16
0014E8 DB0C 29              11      ADD HL,HL       ;*8 *32
0014E9 DB0D 7A               4      LD  A,D
0014EA DB0E 0F               4      RRCA            ;bit.0->7->->->0->C
0014EB DB0F E61F             7      AND 01FH
0014ED DB11 B5               4      OR  L
0014EE DB12 FD7716          19      LD  (IY+22),A   ;(FCB)ファイルを最後に変更した時刻
0014F1 DB15 FD7417          19      LD  (IY+23),H
                                
0014F4 DB18 CD76D2          17      CALL    _SYS2A      ;(BDOS)日付の獲得
                                                ;HL←年  D←月  E←日
0014F7 DB1B 0144F8          10      LD  BC,0-1980
0014FA DB1E 09              11      ADD HL,BC
0014FB DB1F 65               4      LD  H,L
                                
0014FC DB20 7A               4      LD  A,D
0014FD DB21 87               4      ADD A,A     ;*2
0014FE DB22 87               4      ADD A,A     ;*4
0014FF DB23 87               4      ADD A,A     ;*8
001500 DB24 87               4      ADD A,A     ;*16
001501 DB25 6F               4      LD  L,A
001502 DB26 29              11      ADD HL,HL       ;*32
001503 DB27 7D               4      LD  A,L
001504 DB28 B3               4      OR  E
001505 DB29 FD7714          19      LD  (IY+20),A   ;(FCB)ファイルを最後に変更した日付
001508 DB2C FD7415          19      LD  (IY+21),H
00150B DB2F C9              10      RET
                                
       DB30                     PUSHRR:
00150C DB30 32A4DB          13      LD  (SETSEQ_SWC_RND),A
00150F DB33 22B6DB          16      LD  (SETSEQ_SWC_SEQ_RR),HL
001512 DB36 CD56DB          17      CALL    GET_RR_AHL
001515 DB39 220FE5          16      LD  (RR_BUF_HL),HL
001518 DB3C 3211E5          13      LD  (RR_BUF_A),A
00151B DB3F C9              10      RET
                                
       DB40                     GET_CPM_R_SIZE:     ;バイト単位からCP/Mのレコード単位を求める（1レコード=128バイト）
00151C DB40 87               4      ADD A,A     ;in BHLA => out AHL
00151D DB41 ED6A            15      ADC HL,HL
00151F DB43 CB18             8      RR  B
001521 DB45 B7               4      OR  A
001522 DB46 78               4      LD  A,B     ;ここでフラグは変化しない
001523 DB47 C8              11      RET Z
001524 DB48 2C               4      INC L       ;INC AHL
001525 DB49 C0              11      RET NZ      ;
001526 DB4A 24               4      INC H       ;
001527 DB4B C0              11      RET NZ      ;
001528 DB4C 3C               4      INC A       ;
001529 DB4D C9              10      RET
                                
       DB4E                     INIT_RND:
00152A DB4E 3ECD             7      LD  A,0CDH      ;CALL ????
00152C DB50 2179DB          10      LD  HL,POPRR
00152F DB53 CD30DB          17      CALL    PUSHRR
       DB56                     GET_RR_AHL:
001532 DB56 FD6E21          19      LD  L,(IY+33)   ;(FCB)Random record
001535 DB59 FD6622          19      LD  H,(IY+34)   ;
001538 DB5C FD7E23          19      LD  A,(IY+35)   ;
00153B DB5F C9              10      RET
       DB60                     INIT_SEQ:
00153C DB60 3E01             7      LD  A,1     ;LD BC,????
00153E DB62 2176DB          10      LD  HL,SETSEQ
001541 DB65 CD30DB          17      CALL    PUSHRR
       DB68                     GETSEQ:
001544 DB68 FD6E20          19      LD  L,(IY+32)   ;(FCB)カレントレコード
001547 DB6B FD660C          19      LD  H,(IY+12)   ;(FCB)カレントブロック
00154A DB6E AF               4      XOR A
                                
00154B DB6F CB25             8      SLA L   ;L=L*2
                                
00154D DB71 CB3C             8      SRL H   ;HL=HL/2
00154F DB73 CB1D             8      RR  L   ;
001551 DB75 C9              10      RET
                                
       DB76                     SETSEQ:
001552 DB76 CD82DE          17      CALL    SETSEQ1
       DB79                     POPRR:
001555 DB79 F5              11      PUSH    AF
001556 DB7A E5              11      PUSH    HL
001557 DB7B 2A0FE5          16      LD  HL,(RR_BUF_HL)
00155A DB7E 3A11E5          13      LD  A,(RR_BUF_A)
00155D DB81 CD78DE          17      CALL    SET_RR_AHL
001560 DB84 E1              10      POP HL
001561 DB85 F1              10      POP AF
001562 DB86 C9              10      RET
                                
       DB87                     RB_WRITE:
001563 DB87 C5              11      PUSH    BC
001564 DB88 ED4B4CE6        20      LD  BC,(STABLE+2*026H)  ;(BDOS)ランダムブロック書き込み
001568 DB8C 1805            12      JR  RBRW
       DB8E                     RB_READ:
00156A DB8E C5              11      PUSH    BC
00156B DB8F ED4B4EE6        20      LD  BC,(STABLE+2*027H)  ;(BDOS)ランダムブロック読み込み
       DB93                     RBRW:
00156F DB93 1F               4      RRA     ;AHL = AHL*128
001570 DB94 7C               4      LD  A,H ;AHL = AHL0/2
001571 DB95 1F               4      RRA     ;A
001572 DB96 65               4      LD  H,L ;
001573 DB97 CB1C             8      RR  H   ;H
001575 DB99 2E00             7      LD  L,0 ;
001577 DB9B CB1D             8      RR  L   ;L
001579 DB9D CD78DE          17      CALL    SET_RR_AHL
00157C DBA0 218000          10      LD  HL,128
00157F DBA3 C5              11      PUSH    BC
       DBA4                     SETSEQ_SWC_RND:
001580 DBA4 CD82DE          17      CALL    SETSEQ1
001583 DBA7 C1              10      POP BC
001584 DBA8 FDCB20FE        23      SET 7,(IY+32)   ;(FCB)カレントレコード
001588 DBAC FDE5            15      PUSH    IY
00158A DBAE D1              10      POP DE
00158B DBAF D5              11      PUSH    DE
00158C DBB0 CDBEDB          17      CALL    JP_BC
00158F DBB3 FDE1            14      POP IY
001591 DBB5 CD76DB          17      CALL    SETSEQ
       DBB6                     SETSEQ_SWC_SEQ_RR   EQU $-2
001594 DBB8 FDCB20BE        23      RES 7,(IY+32)   ;(FCB)カレントレコード
                                
001598 DBBC C1              10      POP BC
001599 DBBD C9              10      RET
       DBBE                     JP_BC:
00159A DBBE C5              11      PUSH    BC
00159B DBBF C9              10      RET
                                
       D76B                     _SYS03  EQU SCF_FF_RET  ;(BDOS)外部入力
       D76B                     _SYS2B  EQU SCF_FF_RET  ;(BDOS)日付の設定
       D76B                     _SYS2D  EQU SCF_FF_RET  ;(BDOS)時刻の設定
       D76B                     _SYS39  EQU SCF_FF_RET  ;(BDOS)サブディレクトリの作成
       D76B                     _SYS3A  EQU SCF_FF_RET  ;(BDOS)サブディレクトリの削除
                                
[EOF:LDFILE.ASM:SHIFT_JIS]
                                    INCLUDE "LDFILE2.ASM"
                                
                                ;   LSX-Dodgers FILE2
                                
                                                ;Write random block
       DBC0                     _SYS26:     ;(BDOS)ランダムブロック書き込み
00159C DBC0 AF               4      XOR A
00159D DBC1 32B9DE          13      LD  (DRDN1),A   ;NOP
0015A0 DBC4 22E5DD          16      LD  (RBSIZE),HL ;HL←書き込むレコード数
0015A3 DBC7 225DE5          16      LD  (LEFTX),HL
0015A6 DBCA CDB4D6          17      CALL    SETDRV
                                
0015A9 DBCD CD3DDD          17      CALL    RBX0
0015AC DBD0 DA5DDC          10      JP  C,RBWERR
0015AF DBD3 CD3CDA          17      CALL    WOPEN
0015B2 DBD6 DA5DDC          10      JP  C,RBWERR
0015B5 DBD9 7C               4      LD  A,H
0015B6 DBDA B5               4      OR  L
0015B7 DBDB CA56DC          10      JP  Z,RBW1
                                
0015BA DBDE 2B               6      DEC HL
                                
0015BB DBDF CDFBDD          17      CALL    GET_RR_BCDE ;BCDE=Random record
                                
0015BE DBE2 19              11      ADD HL,DE       ;BCHL=HL+BCDE
0015BF DBE3 3001            12      JR  NC,S26X1    ;
0015C1 DBE5 03               6      INC BC      ;
       DBE6                     S26X1:
0015C2 DBE6 CDA7DA          17      CALL    RWXR
0015C5 DBE9 DC4DDA          17      CALL    C,WRDFX
0015C8 DBEC DA5DDC          10      JP  C,RBWERR
                                
0015CB DBEF CD6CDD          17      CALL    RBX2
0015CE DBF2 281A            12      JR  Z,RBWB      ;NZ=セクタ以下の端数がある
0015D0 DBF4 CD8BDD          17      CALL    RBXA
0015D3 DBF7 3864            12      JR  C,RBWERR
0015D5 DBF9 EB               4      EX  DE,HL
0015D6 DBFA C5              11      PUSH    BC
0015D7 DBFB EDB0                    LDIR
0015D9 DBFD 225FE5          16      LD  (DTAX),HL
                                
0015DC DC00 CDDCD9          17      CALL    WTDB        ;バッファデータは更新された
                                
0015DF DC03 2A5DE5          16      LD  HL,(LEFTX)
0015E2 DC06 D1              10      POP DE
0015E3 DC07 ED52            15      SBC HL,DE
0015E5 DC09 225DE5          16      LD  (LEFTX),HL
0015E8 DC0C 2831            12      JR  Z,RBWEND
                                
       DC0E                     RBWB:
0015EA DC0E CDC0DD          17      CALL    RBXB
0015ED DC11 2814            12      JR  Z,RBWC
       DC13                     RBWB1:
0015EF DC13 C5              11      PUSH    BC
0015F0 DC14 D5              11      PUSH    DE
0015F1 DC15 CDBDD8          17      CALL    CLUSTX
0015F4 DC18 CD0FDE          17      CALL    DWTC
0015F7 DC1B D1              10      POP DE
0015F8 DC1C C1              10      POP BC
0015F9 DC1D D438E0          17      CALL    NC,GNCLX
0015FC DC20 383B            12      JR  C,RBWERR
0015FE DC22 10EF            13      DJNZ    RBWB1
001600 DC24 CD5FDE          17      CALL    DRW_FLUSH
       DC27                     RBWC:
001603 DC27 CDD8DD          17      CALL    RBXC
001606 DC2A 2813            12      JR  Z,RBWEND
001608 DC2C C5              11      PUSH    BC
001609 DC2D CDBDD8          17      CALL    CLUSTX
00160C DC30 CDB8DE          17      CALL    DRDN
00160F DC33 C1              10      POP BC
001610 DC34 3827            12      JR  C,RBWERR
001612 DC36 ED5B7EE6        20      LD  DE,(_DTBUF)
001616 DC3A EDB0                    LDIR
001618 DC3C CDDCD9          17      CALL    WTDB        ;バッファデータは更新された
       DC3F                     RBWEND:
00161B DC3F CDE4DD          17      CALL    RBXEND
                                
00161E DC42 CD4CDD          17      CALL    RBX1
001621 DC45 300F            12      JR  NC,RBW1     ;ランダムレコードの方が大きい場合はサイズを合わせる
001623 DC47 CDFBDD          17      CALL    GET_RR_BCDE ;BCDE=Random record
001626 DC4A FD7310          19      LD  (IY+16),E   ;ファイルのサイズ(バイト単位)
001629 DC4D FD7211          19      LD  (IY+17),D   ;
00162C DC50 FD7112          19      LD  (IY+18),C   ;
00162F DC53 FD7013          19      LD  (IY+19),B   ;
       DC56                     RBW1:
001632 DC56 FDE1            14      POP IY
001634 DC58 C1              10      POP BC
001635 DC59 D1              10      POP DE
001636 DC5A E1              10      POP HL
       DC5B                     DD_NUL:
001637 DC5B AF               4      XOR A
       DC5C                     DRDF0:
       DC5C                     DWTF0:
001638 DC5C C9              10      RET
                                
       DC5D                     RBWERR:
001639 DC5D FDE5            15      PUSH    IY
00163B DC5F D1              10      POP DE
00163C DC60 2A20E6          16      LD  HL,(STABLE+2*010H)
00163F DC63 CD0F00          17      CALL    JP_HL
       DC66                     RBRERR1:
001642 DC66 3E01             7      LD  A,001H
       DC68                     RBRERR2:
001644 DC68 FDE1            14      POP IY
001646 DC6A C1              10      POP BC
001647 DC6B D1              10      POP DE
001648 DC6C E1              10      POP HL
001649 DC6D 37               4      SCF
00164A DC6E 210000          10      LD  HL,0
00164D DC71 C9              10      RET
                                
       DC72                     RBRERR:
00164E DC72 3EFF             7      LD  A,0FFH
001650 DC74 18F2            12      JR  RBRERR2
                                
       DC76                     RBRFL:
001652 DC76 3E00             7  RBRFLP: LD  A,000H
001654 DC78 FE0D             7      CP  00DH
001656 DC7A 2005            12      JR  NZ,RBRFL1
001658 DC7C D5              11      PUSH    DE
001659 DC7D 1E0A             7      LD  E,00AH
00165B DC7F 1805            12      JR  RBRFL2
       DC81                     RBRFL1:
00165D DC81 D5              11      PUSH    DE
00165E DC82 CD09E5          17      CALL    _SYS07
001661 DC85 5F               4      LD  E,A
       DC86                     RBRFL2:
001662 DC86 CDCDE5          17      CALL    _PRINT
001665 DC89 7B               4      LD  A,E
001666 DC8A D1              10      POP DE
001667 DC8B 3277DC          13      LD  (RBRFLP+1),A
00166A DC8E C9              10      RET
       DC8F                     DDX:
00166B DC8F FD7E01          19      LD  A,(IY+1)    ;(FCB)主ファイル名
00166E DC92 CDE2D8          17      CALL    CAP
001671 DC95 FE41             7      CP  'A'
001673 DC97 C9              10      RET
                                
                                                ;Read random block
       DC98                     _SYS27:     ;(BDOS)ランダムブロック読み込み
001674 DC98 225DE5          16      LD  (LEFTX),HL
001677 DC9B CDB4D6          17      CALL    SETDRV
                                
00167A DC9E FDCB0D66        20      BIT 4,(IY+13)   ;(FCB)属性(アトリビュート)
00167E DCA2 C22BDD          10      JP  NZ,RBRDIR   ;ディレクトリ
001681 DCA5 CD3DDD          17      CALL    RBX0
001684 DCA8 DA72DC          10      JP  C,RBRERR
001687 DCAB CD4CDD          17      CALL    RBX1
00168A DCAE D464DD          17      CALL    NC,RBX1R
00168D DCB1 DA66DC          10      JP  C,RBRERR1
001690 DCB4 EB               4      EX  DE,HL
001691 DCB5 ED52            15      SBC HL,DE       ;CP 00HL,BCDE
001693 DCB7 19              11      ADD HL,DE
001694 DCB8 79               4      LD  A,C
001695 DCB9 DE00             7      SBC A,0
001697 DCBB 78               4      LD  A,B
001698 DCBC DE00             7      SBC A,0
00169A DCBE 3801            12      JR  C,RBR1
00169C DCC0 EB               4      EX  DE,HL
       DCC1                     RBR1:
00169D DCC1 9F               4      SBC A,A
00169E DCC2 E601             7      AND 1
0016A0 DCC4 3229DD          13      LD  (RBRA_SWC),A
                                
0016A3 DCC7 7C               4      LD  A,H
0016A4 DCC8 B5               4      OR  L
0016A5 DCC9 2857            12      JR  Z,RBREND0
                                
0016A7 DCCB 22E5DD          16      LD  (RBSIZE),HL ;HL←読み込むレコード数
0016AA DCCE 225DE5          16      LD  (LEFTX),HL
                                
0016AD DCD1 CD6CDD          17      CALL    RBX2
0016B0 DCD4 2819            12      JR  Z,RBRB
0016B2 DCD6 CD8BDD          17      CALL    RBXA
0016B5 DCD9 DA72DC          10      JP  C,RBRERR
0016B8 DCDC C5              11      PUSH    BC
0016B9 DCDD EDB0                    LDIR
0016BB DCDF ED535FE5        20      LD  (DTAX),DE
0016BF DCE3 2A5DE5          16      LD  HL,(LEFTX)
0016C2 DCE6 D1              10      POP DE
0016C3 DCE7 A7               4      AND A
0016C4 DCE8 ED52            15      SBC HL,DE
0016C6 DCEA 225DE5          16      LD  (LEFTX),HL
0016C9 DCED 2830            12      JR  Z,RBREND
                                
       DCEF                     RBRB:
0016CB DCEF CDC0DD          17      CALL    RBXB
0016CE DCF2 2815            12      JR  Z,RBRC
       DCF4                     RBRB1:
0016D0 DCF4 C5              11      PUSH    BC
0016D1 DCF5 D5              11      PUSH    DE
0016D2 DCF6 CDBDD8          17      CALL    CLUSTX
0016D5 DCF9 CD15DE          17      CALL    DRDC
0016D8 DCFC D1              10      POP DE
0016D9 DCFD C1              10      POP BC
0016DA DCFE D438E0          17      CALL    NC,GNCLX
0016DD DD01 DA72DC          10      JP  C,RBRERR
0016E0 DD04 10EE            13      DJNZ    RBRB1
0016E2 DD06 CD5FDE          17      CALL    DRW_FLUSH
       DD09                     RBRC:
0016E5 DD09 CDD8DD          17      CALL    RBXC
0016E8 DD0C 2811            12      JR  Z,RBREND
0016EA DD0E C5              11      PUSH    BC
0016EB DD0F CDBDD8          17      CALL    CLUSTX
0016EE DD12 CD9CDE          17      CALL    DRDX
0016F1 DD15 C1              10      POP BC
0016F2 DD16 DA72DC          10      JP  C,RBRERR
0016F5 DD19 EB               4      EX  DE,HL
0016F6 DD1A 2A7EE6          16      LD  HL,(_DTBUF)
0016F9 DD1D EDB0                    LDIR
       DD1F                     RBREND:
0016FB DD1F CDE4DD          17      CALL    RBXEND
       DD22                     RBREND0:
0016FE DD22 FDE1            14      POP IY
001700 DD24 C1              10      POP BC
001701 DD25 D1              10      POP DE
001702 DD26 F1              10      POP AF  ;(HL)
001703 DD27 AF               4      XOR A
001704 DD28 3E00             7      LD  A,000H
       DD29                     RBRA_SWC    EQU $-1
001706 DD2A C9              10      RET
                                
       DD2B                     RBRDIR:
001707 DD2B FD6E1A          19      LD  L,(IY+26)   ;(FCB)ファイルの先頭クラスタ
00170A DD2E FD661B          19      LD  H,(IY+27)
00170D DD31 CDF8D8          17      CALL    CHDIR
001710 DD34 AF               4      XOR A
001711 DD35 67               4      LD  H,A
001712 DD36 6F               4      LD  L,A
001713 DD37 3C               4      INC A
001714 DD38 3229DD          13      LD  (RBRA_SWC),A
001717 DD3B 18E5            12      JR  RBREND0
                                
       DD3D                     RBX0:
001719 DD3D 2A8AE5          16      LD  HL,(_DTA)
00171C DD40 225FE5          16      LD  (DTAX),HL
00171F DD43 2A5DE5          16      LD  HL,(LEFTX)
001722 DD46 FD7E1C          19      LD  A,(IY+28)   ;(FCB)オープンモード
001725 DD49 D6FD             7      SUB 0FDH
001727 DD4B C9              10      RET
                                
       DD4C                     RBX1:               ;ファイルサイズとランダムレコードを比べる
001728 DD4C E5              11      PUSH    HL      ;Record byte
                                                ;AHL=File size
001729 DD4D FD6E10          19      LD  L,(IY+16)   ;ファイルのサイズ(バイト単位)
00172C DD50 FD6611          19      LD  H,(IY+17)   ;
00172F DD53 FD7E12          19      LD  A,(IY+18)   ;
                                
001732 DD56 CDFBDD          17      CALL    GET_RR_BCDE ;BCDE=Random record
                                
001735 DD59 A7               4      AND A
001736 DD5A ED52            15      SBC HL,DE
001738 DD5C 99               4      SBC A,C
001739 DD5D 4F               4      LD  C,A
00173A DD5E FD7E13          19      LD  A,(IY+19)   ;ファイルのサイズ
00173D DD61 98               4      SBC A,B
00173E DD62 D1              10      POP DE
00173F DD63 C9              10      RET
       DD64                     RBX1R:
001740 DD64 47               4      LD  B,A
001741 DD65 B1               4      OR  C
001742 DD66 EB               4      EX  DE,HL   ;BCDE=File byte HL=Record byte
001743 DD67 B2               4      OR  D
001744 DD68 B3               4      OR  E
001745 DD69 C0              11      RET NZ
001746 DD6A 37               4      SCF
001747 DD6B C9              10      RET
                                
       DD6C                     RBX2:               ;Cluster settings
001748 DD6C FD6622          19      LD  H,(IY+34)   ;(+33)(FCB)ランダムレコード
00174B DD6F FD4E23          19      LD  C,(IY+35)
00174E DD72 0600             7      LD  B,0
001750 DD74 FDCB207E        20      BIT 7,(IY+32)   ;(FCB)カレントレコード
001754 DD78 2003            12      JR  NZ,RBX3
001756 DD7A FD4624          19      LD  B,(IY+36)
       DD7D                     RBX3:
001759 DD7D CDA7DA          17      CALL    RWXR
00175C DD80 3AA2DD          13      LD  A,(SECSZ+2) ;1024=4 / 512=2 / 256=1
00175F DD83 3D               4      DEC A
001760 DD84 FDA622          19      AND (IY+34)
001763 DD87 FDB621          19      OR  (IY+33)
001766 DD8A C9              10      RET
                                
       DD8B                     RBXA:
001767 DD8B C5              11      PUSH    BC
001768 DD8C D5              11      PUSH    DE
001769 DD8D CDBDD8          17      CALL    CLUSTX
00176C DD90 CD9CDE          17      CALL    DRDX
00176F DD93 D1              10      POP DE
001770 DD94 C1              10      POP BC
001771 DD95 D438E0          17      CALL    NC,GNCLX
001774 DD98 D8              11      RET C
001775 DD99 ED53FEE6        20      LD  (_CLPS),DE
                                
001779 DD9D FD4E21          19      LD  C,(IY+33)   ;(FCB)ランダムレコード
00177C DDA0 210004          10  SECSZ:  LD  HL,0400H    ;自己書き換え 1024=0400H / 512=0200H ここに1セクタのサイズが格納される
00177F DDA3 7C               4      LD  A,H
001780 DDA4 3D               4      DEC A       ;1024=3 / 512=1
001781 DDA5 FDA622          19      AND (IY+34)     ;(FCB)ランダムレコード
001784 DDA8 47               4      LD  B,A     ;BCに1セクタ以下の端数が入る
001785 DDA9 ED42            15      SBC HL,BC       ;残りを計算
                                
001787 DDAB ED5B5DE5        20      LD  DE,(LEFTX)
00178B DDAF ED52            15      SBC HL,DE       ;CP HL,DE
00178D DDB1 19              11      ADD HL,DE       ;
00178E DDB2 3801            12      JR  C,RBXA1     ;DEとHLを比較して大きい方をHLに
001790 DDB4 EB               4      EX  DE,HL
       DDB5                     RBXA1:
001791 DDB5 E5              11      PUSH    HL
001792 DDB6 2A7EE6          16      LD  HL,(_DTBUF)
001795 DDB9 09              11      ADD HL,BC
001796 DDBA ED5B5FE5        20      LD  DE,(DTAX)
00179A DDBE C1              10      POP BC
00179B DDBF C9              10      RET
                                
       DDC0                     RBXB:
00179C DDC0 2A5FE5          16      LD  HL,(DTAX)
00179F DDC3 ED5BFEE6        20      LD  DE,(_CLPS)
0017A3 DDC7 3A5EE5          13      LD  A,(LEFTX+1)
0017A6 DDCA 47               4      LD  B,A
0017A7 DDCB 3AA2DD          13      LD  A,(SECSZ+2) ;1024=4 / 512=2 / 256=1
       DDCE                     RBXB1:
0017AA DDCE 1F               4      RRA     ;->CF
0017AB DDCF 3804            12      JR  C,RBXB2
0017AD DDD1 CB38             8      SRL B   ;B=B/2
0017AF DDD3 18F9            12      JR  RBXB1
       DDD5                     RBXB2:
0017B1 DDD5 78               4      LD  A,B
0017B2 DDD6 B7               4      OR  A
0017B3 DDD7 C9              10      RET
                                
       DDD8                     RBXC:
0017B4 DDD8 ED4B5DE5        20      LD  BC,(LEFTX)
0017B8 DDDC 3AA2DD          13      LD  A,(SECSZ+2) ;1024=4 / 512=2 / 256=1
0017BB DDDF 3D               4      DEC A
0017BC DDE0 A0               4      AND B
0017BD DDE1 47               4      LD  B,A     ;1セクタ以下の端数がない場合はZ
0017BE DDE2 B1               4      OR  C
0017BF DDE3 C9              10      RET
                                
       DDE4                     RBXEND:             ;レコード数だけランダムレコードを進める
0017C0 DDE4 110000          10      LD  DE,0        ;進めるレコード数(RBSIZE)
       DDE5                     RBSIZE  EQU $-2
0017C3 DDE7 CD56DB          17      CALL    GET_RR_AHL
0017C6 DDEA 19              11      ADD HL,DE
0017C7 DDEB CE00             7      ADC A,0
0017C9 DDED CD78DE          17      CALL    SET_RR_AHL
0017CC DDF0 EB               4      EX  DE,HL       ;HL=進めるレコード数
0017CD DDF1 D0              11      RET NC
0017CE DDF2 FDCB207E        20      BIT 7,(IY+32)   ;(FCB)カレントレコード
0017D2 DDF6 C0              11      RET NZ
0017D3 DDF7 FD3424          23      INC (IY+36)
0017D6 DDFA C9              10      RET
                                
       DDFB                     GET_RR_BCDE:            ;BCDE=Random record
0017D7 DDFB FD5E21          19      LD  E,(IY+33)   ;(FCB)ランダムレコード
0017DA DDFE FD5622          19      LD  D,(IY+34)
0017DD DE01 FD4E23          19      LD  C,(IY+35)
0017E0 DE04 0600             7      LD  B,0     ;CP/M互換のアクセスの場合はFCBは36バイト
0017E2 DE06 FDCB207E        20      BIT 7,(IY+32)   ;(FCB)カレントレコード
0017E6 DE0A C0              11      RET NZ
0017E7 DE0B FD4624          19      LD  B,(IY+36)
0017EA DE0E C9              10      RET
                                
                                ;   ランダムブロックアクセスの連続したセクタをまとめる
                                
       DE0F                     DWTC:
0017EB DE0F E5              11      PUSH    HL
0017EC DE10 21D3E1          10      LD  HL,DWT24B
0017EF DE13 1804            12      JR  DWTC1
       DE15                     DRDC:
0017F1 DE15 E5              11      PUSH    HL
0017F2 DE16 21C3E1          10      LD  HL,DRD24B
       DE19                     DWTC1:
0017F5 DE19 2273DE          16      LD  (DRWF_MODE),HL
0017F8 DE1C E1              10      POP HL
0017F9 DE1D 3A63DE          13      LD  A,(DRWF_B)
0017FC DE20 B7               4      OR  A
0017FD DE21 200F            12      JR  NZ,DRDC1
       DE23                     SAVE_DRWC:
0017FF DE23 0601             7      LD  B,1
001801 DE25 ED4362DE        20      LD  (DRWF_C),BC
001805 DE29 ED5369DE        20      LD  (DRWF_E),DE
001809 DE2D 226CDE          16      LD  (DRWF_HL),HL
00180C DE30 1820            12      JR  INC_HL_DRWC
       DE32                     DRDC1:
00180E DE32 E5              11      PUSH    HL
00180F DE33 2169DE          10      LD  HL,DRWF_E
001812 DE36 86               7      ADD A,(HL)
001813 DE37 F5              11      PUSH    AF
001814 DE38 BB               4      CP  E
001815 DE39 201D            12      JR  NZ,DRDC2
001817 DE3B F1              10      POP AF
001818 DE3C 23               6      INC HL
001819 DE3D 7E               7      LD  A,(HL)
00181A DE3E CE00             7      ADC A,0
00181C DE40 F5              11      PUSH    AF
00181D DE41 BA               4      CP  D
00181E DE42 2014            12      JR  NZ,DRDC2
001820 DE44 F1              10      POP AF
001821 DE45 3A62DE          13      LD  A,(DRWF_C)
001824 DE48 CE00             7      ADC A,0
001826 DE4A B9               4      CP  C
001827 DE4B 200C            12      JR  NZ,DRDC3
001829 DE4D 2163DE          10      LD  HL,DRWF_B
00182C DE50 34              11      INC (HL)
00182D DE51 E1              10      POP HL
       DE52                     INC_HL_DRWC:
00182E DE52 3AA2DD          13      LD  A,(SECSZ+2)     ;1セクタのサイズの上位1バイト
001831 DE55 84               4      ADD A,H
001832 DE56 67               4      LD  H,A
001833 DE57 C9              10      RET
       DE58                     DRDC2:
001834 DE58 F1              10      POP AF
       DE59                     DRDC3:
001835 DE59 CD5FDE          17      CALL    DRW_FLUSH
001838 DE5C E1              10      POP HL
001839 DE5D 18C4            12      JR  SAVE_DRWC
                                
                                ;   ランダムブロックアクセスの連続したセクタをまとめたものをフラッシュする
       DE5F                     DRW_FLUSH:
00183B DE5F C5              11      PUSH    BC
00183C DE60 D5              11      PUSH    DE
00183D DE61 010000          10      LD  BC,0
       DE62                     DRWF_C  EQU $-2
       DE63                     DRWF_B  EQU $-1
001840 DE64 78               4      LD  A,B
001841 DE65 B7               4      OR  A
001842 DE66 280D            12      JR  Z,DRDF1
001844 DE68 110000          10      LD  DE,0
       DE69                     DRWF_E  EQU $-2
       DE6A                     DRWF_D  EQU $-1
001847 DE6B 210000          10      LD  HL,0
       DE6C                     DRWF_HL EQU $-2
00184A DE6E AF               4      XOR A
00184B DE6F 3263DE          13      LD  (DRWF_B),A
00184E DE72 CDC3E1          17      CALL    DRD24B
       DE73                     DRWF_MODE   EQU $-2
       DE75                     DRDF1:
001851 DE75 D1              10      POP DE
001852 DE76 C1              10      POP BC
001853 DE77 C9              10      RET
                                
       DE78                     SET_RR_AHL:
001854 DE78 FD7521          19      LD  (IY+33),L   ;(FCB)Random record
001857 DE7B FD7422          19      LD  (IY+34),H
00185A DE7E FD7723          19      LD  (IY+35),A
00185D DE81 C9              10      RET
                                
       DE82                     SETSEQ1:
00185E DE82 F5              11      PUSH    AF
00185F DE83 E5              11      PUSH    HL      ;AHL=Random record
001860 DE84 CD56DB          17      CALL    GET_RR_AHL
001863 DE87 47               4      LD  B,A     ;AHL→HLA
001864 DE88 7D               4      LD  A,L     ;(IY+33)(FCB)ランダムレコード
001865 DE89 6C               4      LD  L,H     ;(IY+34)
001866 DE8A 60               4      LD  H,B     ;(IY+35)
001867 DE8B 0600             7      LD  B,0
                                
001869 DE8D CD40DB          17      CALL    GET_CPM_R_SIZE
                                
00186C DE90 29              11      ADD HL,HL
00186D DE91 CB3D             8      SRL L       ;L=L/2
00186F DE93 FD7520          19      LD  (IY+32),L   ;(FCB)カレントレコード
001872 DE96 FD740C          19      LD  (IY+12),H   ;(FCB)カレントブロック
001875 DE99 E1              10      POP HL
001876 DE9A F1              10      POP AF
001877 DE9B C9              10      RET
[EOF:LDFILE2.ASM:SHIFT_JIS]
                                    INCLUDE "LDDIO.ASM"
                                
                                ;   LSX-Dodgers DIO
                                
       DE9C                     DRDX:
001878 DE9C CDDADE          17      CALL    DRDY
00187B DE9F C8              11      RET Z
00187C DEA0 CDC0DE          17      CALL    DRDX1       ;データバッファの情報を保存
00187F DEA3 D8              11      RET C
001880 DEA4 E5              11      PUSH    HL
001881 DEA5 C5              11      PUSH    BC
001882 DEA6 D5              11      PUSH    DE
001883 DEA7 2A7EE6          16      LD  HL,(_DTBUF)
001886 DEAA 3A03DF          13      LD  A,(_DBS24)
001889 DEAD 4F               4      LD  C,A
00188A DEAE CDC1E1          17      CALL    DRD24
00188D DEB1 DCD5DE          17      CALL    C,DRDNE
       DEB4                     POP_DE_BC_HL_RET:
001890 DEB4 D1              10      POP DE
001891 DEB5 C1              10      POP BC
001892 DEB6 E1              10      POP HL
001893 DEB7 C9              10      RET
                                
                                ;   CDE:セクタ番号
       DEB8                     DRDN:
001894 DEB8 AF               4      XOR A
001895 DEB9 00               4  DRDN1:  NOP         ;自己書き換え NOP / SCF
001896 DEBA 30E0            12      JR  NC,DRDX
       DEBC                     DRDNX:
001898 DEBC CDDADE          17      CALL    DRDY
00189B DEBF C8              11      RET Z
       DEC0                     DRDX1:
00189C DEC0 CDF0DE          17      CALL    DWTX
                                                ;データバッファの読み込んだドライブ・セクタ情報を保存
00189F DEC3 ED53A6E5        20      LD  (_DBSEC),DE
0018A3 DEC7 79               4      LD  A,C
0018A4 DEC8 3203DF          13      LD  (_DBS24),A
                                
0018A7 DECB 3A88E5          13      LD  A,(_DRV)
0018AA DECE 32A5E5          13      LD  (_DBDRV),A
0018AD DED1 CDD9E5          17      CALL    _CHGDRV
0018B0 DED4 D0              11      RET NC
       DED5                     DRDNE:
0018B1 DED5 9F               4      SBC A,A     ;CF=1ならばA=0FFH
0018B2 DED6 32A5E5          13      LD  (_DBDRV),A
0018B5 DED9 C9              10      RET
                                
                                ;   CDE:セクタ番号
       DEDA                     DRDY:
0018B6 DEDA 3A03DF          13      LD  A,(_DBS24)
0018B9 DEDD B9               4      CP  C
0018BA DEDE C0              11      RET NZ
                                
0018BB DEDF E5              11      PUSH    HL
0018BC DEE0 3A88E5          13      LD  A,(_DRV)
0018BF DEE3 21A5E5          10      LD  HL,_DBDRV
0018C2 DEE6 AE               7      XOR (HL)
0018C3 DEE7 2005            12      JR  NZ,POP_HL_RET
                                
0018C5 DEE9 2AA6E5          16      LD  HL,(_DBSEC)
0018C8 DEEC ED52            15      SBC HL,DE       ;上でXORを使っているのでCF=0のはず
       DEEE                     POP_HL_RET:
0018CA DEEE E1              10      POP HL
0018CB DEEF C9              10      RET
                                
       DEF0                     DWTX:
0018CC DEF0 3AA4E5          13      LD  A,(_WTDBF)
0018CF DEF3 B7               4      OR  A
0018D0 DEF4 C8              11      RET Z
0018D1 DEF5 AF               4      XOR A
0018D2 DEF6 32A4E5          13      LD  (_WTDBF),A
                                
0018D5 DEF9 E5              11      PUSH    HL
0018D6 DEFA C5              11      PUSH    BC
0018D7 DEFB D5              11      PUSH    DE
0018D8 DEFC 3AA5E5          13      LD  A,(_DBDRV)
0018DB DEFF CDD9E5          17      CALL    _CHGDRV
0018DE DF02 0E00             7      LD  C,0
       DF03                     _DBS24  EQU $-1
0018E0 DF04 ED5BA6E5        20      LD  DE,(_DBSEC)
0018E4 DF08 2A7EE6          16      LD  HL,(_DTBUF)
0018E7 DF0B D4D1E1          17      CALL    NC,DWT24
       DF0E                     POP_DE_BC_HL_RET2:
0018EA DF0E 18A4            12      JR  POP_DE_BC_HL_RET
                                
       DF10                     RDFATX:
0018EC DF10 E5              11      PUSH    HL
0018ED DF11 3A88E5          13      LD  A,(_DRV)
0018F0 DF14 21AAE5          10      LD  HL,_FATDRV
0018F3 DF17 AE               7      XOR (HL)
0018F4 DF18 28D4            12      JR  Z,POP_HL_RET
                                
0018F6 DF1A C5              11      PUSH    BC
0018F7 DF1B D5              11      PUSH    DE
0018F8 DF1C DDE5            15      PUSH    IX
0018FA DF1E CD3ADF          17      CALL    WTFATX
0018FD DF21 3813            12      JR  C,POP_IX_DE_BC_HL_RET
                                
0018FF DF23 AF               4      XOR A
001900 DF24 32ABE5          13      LD  (_FATIX),A
001903 DF27 3A88E5          13      LD  A,(_DRV)
001906 DF2A 32AAE5          13      LD  (_FATDRV),A
001909 DF2D CDE5E5          17      CALL    _RDFAT
       DF30                     RDFATE2:
00190C DF30 3004            12      JR  NC,POP_IX_DE_BC_HL_RET
00190E DF32 9F               4      SBC A,A     ;A=0xFF
00190F DF33 32AAE5          13      LD  (_FATDRV),A
       DF36                     POP_IX_DE_BC_HL_RET:
001912 DF36 DDE1            14      POP IX
001914 DF38 18D4            12      JR  POP_DE_BC_HL_RET2
                                
       DF3A                     WTFATX:
001916 DF3A 3AA2E5          13      LD  A,(_WTFATF)
001919 DF3D B7               4      OR  A
00191A DF3E C8              11      RET Z
00191B DF3F E5              11      PUSH    HL
00191C DF40 3AAAE5          13      LD  A,(_FATDRV)
00191F DF43 21A5E5          10      LD  HL,_DBDRV
001922 DF46 AE               7      XOR (HL)
001923 DF47 CCF0DE          17      CALL    Z,DWTX
001926 DF4A 38A2            12      JR  C,POP_HL_RET
001928 DF4C C5              11      PUSH    BC
001929 DF4D D5              11      PUSH    DE
00192A DF4E DDE5            15      PUSH    IX
00192C DF50 CDDEE1          17      CALL    WTFAT
00192F DF53 AF               4      XOR A
001930 DF54 32A2E5          13      LD  (_WTFATF),A
001933 DF57 18DD            12      JR  POP_IX_DE_BC_HL_RET
                                
       DF59                     N16CL1:
001935 DF59 7A               4      LD  A,D
001936 DF5A B3               4      OR  E
001937 DF5B 37               4      SCF
001938 DF5C C8              11      RET Z
                                
001939 DF5D 7A               4      LD  A,D
00193A DF5E 1807            12      JR  NCL1X
       DF60                     NCL1:
00193C DF60 7A               4      LD  A,D
00193D DF61 B3               4      OR  E
00193E DF62 37               4      SCF
00193F DF63 C8              11      RET Z
                                
001940 DF64 7A               4      LD  A,D
001941 DF65 CB3F             8      SRL A   ;/2
       DF67                     NCL1X:
001943 DF67 CB3F             8      SRL A   ;/2
                                
001945 DF69 E5              11      PUSH    HL
001946 DF6A 3289DF          13      LD  (NCLPAT_FATIX),A    ;_FATIX
001949 DF6D 2AAAE5          16      LD  HL,(_FATDRV)    ;L=_FATDRV H=_FATIX
00194C DF70 BC               4      CP  H
00194D DF71 3A88E5          13      LD  A,(_DRV)    ;LDではフラグは変化しない
001950 DF74 3288DF          13      LD  (NCLPAT_FATDRV),A   ;_FATDRV
001953 DF77 2005            12      JR  NZ,NCL2     ;FATIXが違う
001955 DF79 BD               4      CP  L
001956 DF7A 2002            12      JR  NZ,NCL2     ;ドライブが違う
001958 DF7C E1              10      POP HL
001959 DF7D C9              10      RET
       DF7E                     NCL2:
00195A DF7E C5              11      PUSH    BC
00195B DF7F D5              11      PUSH    DE
00195C DF80 DDE5            15      PUSH    IX
00195E DF82 CD3ADF          17      CALL    WTFATX
001961 DF85 38AF            12      JR  C,POP_IX_DE_BC_HL_RET
001963 DF87 010000          10      LD  BC,0        ;自己書き換え C=_FATDRV B=_FATIX
       DF89                     NCLPAT_FATIX    EQU $-1
       DF88                     NCLPAT_FATDRV   EQU $-2
001966 DF8A ED43AAE5        20      LD  (_FATDRV),BC
00196A DF8E CDB3E1          17      CALL    RDFATS
00196D DF91 189D            12      JR  RDFATE2
                                
       DF93                     NCL3:
00196F DF93 CB9A             8      RES 3,D
001971 DF95 CB92             8      RES 2,D
001973 DF97 6B               4      LD  L,E
001974 DF98 62               4      LD  H,D
001975 DF99 CB3C             8      SRL H   ;
001977 DF9B CB1D             8      RR  L   ;HLA=HLA/2
001979 DF9D 1F               4      RRA     ;
00197A DF9E F5              11      PUSH    AF
00197B DF9F 3AABE5          13      LD  A,(_FATIX)
00197E DFA2 0F               4      RRCA
00197F DFA3 300B            12      JR  NC,NCL3X1
001981 DFA5 3AA2DD          13      LD  A,(SECSZ+2)
001984 DFA8 FE04             7      CP  4       ;1セクタ1024バイトの場合は奇数インデックスの場合に先頭を512バイトずらす
001986 DFAA 2004            12      JR  NZ,NCL3X1
001988 DFAC 010002          10      LD  BC,512
00198B DFAF 09              11      ADD HL,BC
       DFB0                     NCL3X1:
00198C DFB0 F1              10      POP AF
00198D DFB1 ED4B7CE6        20      LD  BC,(_FATBF)
001991 DFB5 19              11      ADD HL,DE
001992 DFB6 09              11      ADD HL,BC
001993 DFB7 17               4      RLA
001994 DFB8 C9              10      RET
                                
       DFB9                     GNCL:
001995 DFB9 CD60DF          17      CALL    NCL1        ;GET NEXT CLUSTER
001998 DFBC D8              11      RET C
001999 DFBD C5              11      PUSH    BC
00199A DFBE E5              11      PUSH    HL
00199B DFBF CD93DF          17      CALL    NCL3
00199E DFC2 3809            12      JR  C,GNC1
0019A0 DFC4 5E               7      LD  E,(HL)
0019A1 DFC5 23               6      INC HL
0019A2 DFC6 7E               7      LD  A,(HL)
0019A3 DFC7 E60F             7      AND 00FH
0019A5 DFC9 57               4      LD  D,A
0019A6 DFCA E1              10      POP HL
0019A7 DFCB C1              10      POP BC
0019A8 DFCC C9              10      RET
       DFCD                     GNC1:
0019A9 DFCD 7E               7      LD  A,(HL)
0019AA DFCE 23               6      INC HL
0019AB DFCF 56               7      LD  D,(HL)
0019AC DFD0 0604             7      LD  B,4
       DFD2                     GNC1L:
0019AE DFD2 CB3A             8      SRL D   ;DA=DA/2
0019B0 DFD4 1F               4      RRA     ;
0019B1 DFD5 10FB            13      DJNZ    GNC1L
                                
0019B3 DFD7 5F               4      LD  E,A
0019B4 DFD8 E1              10      POP HL
0019B5 DFD9 C1              10      POP BC
0019B6 DFDA A7               4      AND A
0019B7 DFDB C9              10      RET
                                
       DFDC                     SNCL:
0019B8 DFDC CD60DF          17      CALL    NCL1
0019BB DFDF D8              11      RET C
                                ;               SET NEXT CLUSTER
0019BC DFE0 E5              11      PUSH    HL
0019BD DFE1 C5              11      PUSH    BC
0019BE DFE2 D5              11      PUSH    DE
0019BF DFE3 E5              11      PUSH    HL
0019C0 DFE4 CD93DF          17      CALL    NCL3
0019C3 DFE7 D1              10      POP DE
                                ;CF=ODD
0019C4 DFE8 7E               7      LD  A,(HL)
0019C5 DFE9 73               7      LD  (HL),E
0019C6 DFEA 3806            12      JR  C,SNC1
                                ;EVEN
                                ;M[0] = E
                                ;M[1] = (M[1] & 0xF0) | (D & 0x0F)
0019C8 DFEC 23               6      INC HL
0019C9 DFED ED67            18      RRD     ;M={A[3:0],E[3:0]}
0019CB DFEF 7A               4      LD  A,D
0019CC DFF0 1804            12      JR  SNC11
       DFF2                     SNC1:
                                ;ODD
                                ;HL[0] = (HL[0]&0x0F) | (E<<4)
                                ;HL[1] = DE>>4
0019CE DFF2 ED6F            18      RLD     ;M={D[3:0],E[7:4]}
0019D0 DFF4 23               6      INC HL
0019D1 DFF5 72               7      LD  (HL),D  ;M={D[3:0],E[7:4]}
       DFF6                     SNC11:
0019D2 DFF6 ED6F            18      RLD     ;M={M[7:4],D[3:0]}
0019D4 DFF8 B7               4      OR  A
0019D5 DFF9 D1              10      POP DE
0019D6 DFFA C1              10      POP BC
0019D7 DFFB E1              10      POP HL
       DFFC                     FAT_CHANGED:
0019D8 DFFC 3E01             7      LD  A,1
0019DA DFFE 32A2E5          13      LD  (_WTFATF),A
0019DD E001 C9              10      RET
                                
       E002                     N16CL3:
0019DE E002 C5              11      PUSH    BC
0019DF E003 6B               4      LD  L,E
0019E0 E004 7A               4      LD  A,D
0019E1 E005 E601             7      AND 1
0019E3 E007 67               4      LD  H,A
0019E4 E008 29              11      ADD HL,HL
0019E5 E009 ED4B7CE6        20      LD  BC,(_FATBF)
0019E9 E00D 09              11      ADD HL,BC
0019EA E00E C1              10      POP BC
0019EB E00F C9              10      RET
                                
       E010                     GNCL16:
0019EC E010 CD59DF          17      CALL    N16CL1      ;GET NEXT CLUSTER for FAT16
0019EF E013 D8              11      RET C
0019F0 E014 E5              11      PUSH    HL
0019F1 E015 CD02E0          17      CALL    N16CL3
0019F4 E018 5E               7      LD  E,(HL)
0019F5 E019 23               6      INC HL
0019F6 E01A 56               7      LD  D,(HL)
0019F7 E01B E1              10      POP HL
0019F8 E01C C9              10      RET
                                
       E01D                     SNCL16:
0019F9 E01D CD59DF          17      CALL    N16CL1      ;GET NEXT CLUSTER for FAT16
0019FC E020 D8              11      RET C
0019FD E021 D5              11      PUSH    DE
0019FE E022 E5              11      PUSH    HL
0019FF E023 CD02E0          17      CALL    N16CL3
001A02 E026 D1              10      POP DE      ;HL
001A03 E027 73               7      LD  (HL),E
001A04 E028 23               6      INC HL
001A05 E029 72               7      LD  (HL),D
001A06 E02A 6B               4      LD  L,E
001A07 E02B 62               4      LD  H,D
001A08 E02C D1              10      POP DE
001A09 E02D 18CD            12      JR  FAT_CHANGED
                                
                                ;------------------------
                                ;次のセクタを探す際に_SECPSの値をチェック
                                ;in
                                ;   DE : セクタ番号
                                ;out
                                ;   DE : 次のセクタ番号
                                ;note
                                ;
                                ;------------------------
       E02F                     NEXTX:
001A0B E02F 3E00             7      LD  A,0 ;自己書き換え
       E030                     _SECPS  EQU $-1
001A0D E031 3C               4      INC A
001A0E E032 E600             7      AND 0   ;自己書き換え　1クラスタの論理セクタ数-1
       E033                     _NCPAT  EQU $-1
001A10 E034 3230E0          13      LD  (_SECPS),A
001A13 E037 C9              10      RET
                                
       E038                     GNCLX:
001A14 E038 CD2FE0          17      CALL    NEXTX
001A17 E03B C0              11      RET NZ  ;1クラスタのセクタ未満の場合は戻る
001A18 E03C C3F7E5          10      JP  _GNCL   ;次のクラスタを探す
                                
       E03F                     RDFAT:
001A1B E03F 3E80             7      LD  A,080H
001A1D E041 3270E5          13      LD  (CHECK),A
       E044                     RDFAT1:
001A20 E044 3A88E5          13      LD  A,(_DRV)
001A23 E047 CDEDE2          17      CALL    CHGDRVR
001A26 E04A D8              11      RET C
001A27 E04B DD7E12          19      LD  A,(IX+DPB_DEVICE)
001A2A E04E CB6F             8      BIT 5,A
001A2C E050 286C            12      JR  Z,RDFAT0X
001A2E E052 2170E5          10      LD  HL,CHECK
001A31 E055 A6               7      AND (HL)
001A32 E056 77               7      LD  (HL),A
001A33 E057 110000          10      LD  DE,0        ;BPB
001A36 E05A 2A7CE6          16      LD  HL,(_FATBF)
001A39 E05D CDBFE1          17      CALL    DRD16
001A3C E060 3024            12      JR  NC,GETBPB
001A3E E062 2170E5          10      LD  HL,CHECK
001A41 E065 CB06            15      RLC (HL)
001A43 E067 3F               4      CCF
001A44 E068 D8              11      RET C
001A45 E069 DDCB0A1E        23      RR  (IX+DPB_FDMODE)
001A49 E06D 3F               4      CCF         ;フロッピーディスクのFDモードを切り替える
001A4A E06E DDCB0A16        23      RL  (IX+DPB_FDMODE)
001A4E E072 3EFF             7      LD  A,0FFH
001A50 E074 3289E5          13      LD  (_DSK),A
001A53 E077 3A84E5          13      LD  A,(_DRIVE)
001A56 E07A E603             7      AND 3
001A58 E07C F680             7      OR  080H
001A5A E07E 6F               4      LD  L,A
001A5B E07F 26E5             7      LD  H,_CYL0/256
001A5D E081 3EFF             7      LD  A,0FFH
001A5F E083 77               7      LD  (HL),A
001A60 E084 18BE            12      JR  RDFAT1
       E086                     GETBPB:
001A62 E086 FDE5            15      PUSH    IY
001A64 E088 FD2A7CE6        20      LD  IY,(_FATBF) ;BPB
001A68 E08C CDF1E5          17      CALL    _BPB2DPB
001A6B E08F FDE1            14      POP IY
001A6D E091 DD7E12          19      LD  A,(IX+DPB_DEVICE)
001A70 E094 3025            12      JR  NC,GETBPBOK
001A72 E096 E60F             7      AND 00FH
001A74 E098 FE07             7      CP  7
001A76 E09A 37               4      SCF
001A77 E09B C0              11      RET NZ
001A78 E09C DDCB0A46        20      BIT 0,(IX+DPB_FDMODE)
001A7C E0A0 21C0E6          10      LD  HL,M2D
001A7F E0A3 2006            12      JR  NZ,SETFDMODE
001A81 E0A5 CD98E1          17      CALL    CHECK1024
001A84 E0A8 D8              11      RET C
001A85 E0A9 2ED2             7      LD  L,M2HD-STABLE
       E0AB                     SETFDMODE:
001A87 E0AB DDE5            15      PUSH    IX
001A89 E0AD D1              10      POP DE
001A8A E0AE EDA0            16      LDI
001A8C E0B0 EDA0            16      LDI
001A8E E0B2 13               6      INC DE
001A8F E0B3 13               6      INC DE
001A90 E0B4 13               6      INC DE
001A91 E0B5 13               6      INC DE
001A92 E0B6 010C00          10      LD  BC,12
001A95 E0B9 EDB0                    LDIR
       E0BB                     GETBPBOK:
001A97 E0BB CD59E2          17      CALL    CHGDRV2
       E0BE                     RDFAT0X:
001A9A E0BE CDB3E1          17      CALL    RDFATS
001A9D E0C1 D8              11      RET C
001A9E E0C2 DDAE06          19      XOR (IX+DPB_FATID)
001AA1 E0C5 C8              11      RET Z
001AA2 E0C6 DD7E12          19      LD  A,(IX+DPB_DEVICE)
001AA5 E0C9 CB5F             8      BIT 3,A
001AA7 E0CB 2803            12      JR  Z,RDFAT0X1
001AA9 E0CD CB6F             8      BIT 5,A
001AAB E0CF C0              11      RET NZ      ;BPBを取得している場合はFATIDをチェックしない
       E0D0                     RDFAT0X1:
001AAC E0D0 37               4      SCF
001AAD E0D1 C9              10      RET
                                
       E0D2                     POP_HL_SCF_RET:
001AAE E0D2 E1              10      POP HL
001AAF E0D3 37               4      SCF
001AB0 E0D4 C9              10      RET
                                
       E0D5                     BPB2DPB:
001AB1 E0D5 FD7E0B          19      LD  A,(IY+11)   ;BPB_BytsPerSec
001AB4 E0D8 B7               4      OR  A
001AB5 E0D9 37               4      SCF
001AB6 E0DA C0              11      RET NZ
       E0DB                     BPBOK:
001AB7 E0DB FD7E0D          19      LD  A,(IY+13)   ;BPB_SecPerClus
001ABA E0DE DD7707          19      LD  (IX+DPB_SECPCL),A
                                
001ABD E0E1 FD7E16          19      LD  A,(IY+22)   ;BPB_FATSz16
001AC0 E0E4 DD7700          19      LD  (IX+DPB_FATLN),A
001AC3 E0E7 FD7E17          19      LD  A,(IY+23)   ;BPB_FATSz16
001AC6 E0EA DD7701          19      LD  (IX+DPB_FATLN+1),A
                                
001AC9 E0ED FD6E0E          19      LD  L,(IY+14)   ;BPB_RsvdSecCnt
001ACC E0F0 FD660F          19      LD  H,(IY+15)
001ACF E0F3 DD750E          19      LD  (IX+DPB_FATPS),L
001AD2 E0F6 FD5E16          19      LD  E,(IY+22)   ;BPB_FATSz16
001AD5 E0F9 FD5617          19      LD  D,(IY+23)
001AD8 E0FC FD4610          19      LD  B,(IY+16)   ;BPB_NumFATs
       E0FF                     BPBDP1:             ;BPB_FATSz16 * BPB_NumFATs
001ADB E0FF 19              11      ADD HL,DE
001ADC E100 10FD            13      DJNZ    BPBDP1
       E102                     BPBDP2:
001ADE E102 DD7510          19      LD  (IX+DPB_DIRPS),L
001AE1 E105 DD7411          19      LD  (IX+DPB_DIRPS+1),H
001AE4 E108 E5              11      PUSH    HL
                                
001AE5 E109 FD6E11          19      LD  L,(IY+17)   ;BPB_RootEntCnt
001AE8 E10C FD6612          19      LD  H,(IY+18)
001AEB E10F FD7E0C          19      LD  A,(IY+12)   ;BPB_BytsPerSec
001AEE E112 B7               4      OR  A
001AEF E113 28BD            12      JR  Z,POP_HL_SCF_RET
001AF1 E115 0606             7      LD  B,6
       E117                     BPBBPS1:
001AF3 E117 05               4      DEC B
001AF4 E118 0F               4      RRCA
001AF5 E119 30FC            12      JR  NC,BPBBPS1
       E11B                     BPBDE1:
001AF7 E11B 29              11      ADD HL,HL
001AF8 E11C 10FD            13      DJNZ    BPBDE1
                                
001AFA E11E 7C               4      LD  A,H
001AFB E11F DD770B          19      LD  (IX+DPB_DIRSCNT),A  ;
                                
001AFE E122 D1              10      POP DE      ;DPB_DIRPS
001AFF E123 6C               4      LD  L,H
001B00 E124 2600             7      LD  H,0
001B02 E126 19              11      ADD HL,DE       ;MAXDIR
001B03 E127 E5              11      PUSH    HL
001B04 E128 FD4E0D          19      LD  C,(IY+13)   ;BPB_SecPerClus
001B07 E12B CB21             8      SLA C       ;*2
001B09 E12D AF               4      XOR A
001B0A E12E 47               4      LD  B,A
001B0B E12F ED42            15      SBC HL,BC
001B0D E131 DD7514          19      LD  (IX+DPB_ADDCL),L
001B10 E134 DD7415          19      LD  (IX+DPB_ADDCL+1),H
                                
001B13 E137 D1              10      POP DE      ;DE=DPB_MAXDIR
001B14 E138 FD6E13          19      LD  L,(IY+19)   ;BPB_TotSec16
001B17 E13B FD6614          19      LD  H,(IY+20)
                                
001B1A E13E DD7E12          19      LD  A,(IX+DPB_DEVICE)
001B1D E141 E60F             7      AND 00FH
001B1F E143 FE07             7      CP  7       ;フロッピー
001B21 E145 2019            12      JR  NZ,NOT_FD
001B23 E147 E5              11      PUSH    HL
001B24 E148 FD4E18          19      LD  C,(IY+24)   ;BPB_SecPerTr
001B27 E14B DD710D          19      LD  (IX+DPB_MAXSEC),C
001B2A E14E AF               4      XOR A
001B2B E14F CB21             8      SLA C       ;両面なのでセクタ数を２倍
001B2D E151 0610             7      LD  B,16
       E153                     DIVSEC:             ;MAXCYL = BPB_TotSec16 / (BPB_SecPerTr * 2)
001B2F E153 29              11      ADD HL,HL
001B30 E154 17               4      RLA
001B31 E155 B9               4      CP  C
001B32 E156 3802            12      JR  C,DIVSEC1
001B34 E158 91               4      SUB C
001B35 E159 2C               4      INC L
       E15A                     DIVSEC1:
001B36 E15A 10F7            13      DJNZ    DIVSEC
001B38 E15C DD750C          19      LD  (IX+DPB_MAXCYL),L
001B3B E15F E1              10      POP HL  ;ここまでフロッピー専用
       E160                     NOT_FD:
001B3C E160 7C               4      LD  A,H
001B3D E161 B5               4      OR  L
001B3E E162 3E00             7      LD  A,0     ;LDでフラグは変化しない。BPB_TotSec16を AHL で扱う為、Aに0を入れる
001B40 E164 200E            12      JR  NZ,BPB16BIT ;BPB_TotSec16が「0」の場合はBPB_TotSec32で計算
001B42 E166 2F               4      CPL         ;A=0FFH
001B43 E167 FD8623          19      ADD A,(IY+35)   ;念のために総セクタ数が24ビットを超える場合はエラーを返す
001B46 E16A D8              11      RET C
001B47 E16B FD6E20          19      LD  L,(IY+32)   ;BPB_TotSec32 は AHL の24ビットで扱う
001B4A E16E FD6621          19      LD  H,(IY+33)   ;1クラスタの論理セクタ数(DPB_SECPCL)が最大128なので、
001B4D E171 FD7E22          19      LD  A,(IY+34)   ;FAT12,FAT16では総セクタ数が24ビットを超えることは無い
       E174                     BPB16BIT:
001B50 E174 ED52            15      SBC HL,DE       ;DE=DPB_MAXDIR
001B52 E176 DE00             7      SBC A,0
001B54 E178 FD460D          19      LD  B,(IY+13)   ;BPB_SecPerClus
       E17B                     BPBTC1:             ;総クラスタ数(AHL) = 総セクタ数(AHL) / セクタサイズ(B)
001B57 E17B CB18             8      RR  B       ;->CY
001B59 E17D 3808            12      JR  C,BPBTC2
001B5B E17F CB3F             8      SRL A
001B5D E181 CB1C             8      RR  H       ;AHL=AHL/2
001B5F E183 CB1D             8      RR  L
001B61 E185 18F4            12      JR  BPBTC1
       E187                     BPBTC2:
001B63 E187 C6FF             7      ADD A,0FFH
001B65 E189 D8              11      RET C       ;念のため(クラスタ数が16ビットを超える場合)
001B66 E18A 23               6      INC HL
001B67 E18B 23               6      INC HL
001B68 E18C DD7508          19      LD  (IX+DPB_MAXCL),L
001B6B E18F DD7409          19      LD  (IX+DPB_MAXCL+1),H
                                
001B6E E192 FD7E15          19      LD  A,(IY+21)   ;BPB_Media
001B71 E195 DD7706          19      LD  (IX+DPB_FATID),A
       E198                     CHECK1024:
001B74 E198 FD7E10          19      LD  A,(IY+16)   ;BPB_NumFATs
001B77 E19B C6FE             7      ADD A,0-2       ;>2:CF=1
001B79 E19D FD7E0C          19      LD  A,(IY+12)   ;BPB_BytsPerSec
001B7C E1A0 6F               4      LD  L,A
001B7D E1A1 3002            12      JR  NC,BPBFAT1
001B7F E1A3 F680             7      OR  080H
       E1A5                     BPBFAT1:            ;ここではCF=0
001B81 E1A5 DD770F          19      LD  (IX+DPB_BPS),A
001B84 E1A8 3A7BE6          13      LD  A,(_MAX_SEC_SZ_H)
001B87 E1AB BD               4      CP  L
001B88 E1AC C8              11      RET Z       ;1セクタ1024バイト
001B89 E1AD 2D               4      DEC L       ;以下のセクタサイズに合致しない場合はCF=1でエラーにする
001B8A E1AE C8              11      RET Z       ;1セクタ256バイト
001B8B E1AF 2D               4      DEC L
001B8C E1B0 C8              11      RET Z       ;1セクタ512バイト
001B8D E1B1 37               4      SCF
001B8E E1B2 C9              10      RET
                                
       E1B3                     RDFATS:
001B8F E1B3 CDE4E1          17      CALL    FATSETUP
001B92 E1B6 D8              11      RET C
001B93 E1B7 CDC3E1          17      CALL    DRD24B
001B96 E1BA 2A7CE6          16      LD  HL,(_FATBF)
001B99 E1BD 7E               7      LD  A,(HL)
001B9A E1BE C9              10      RET
                                
       E1BF                     DRD16:
001B9B E1BF 0E00             7      LD  C,0
       E1C1                     DRD24:
001B9D E1C1 0601             7      LD  B,1
       E1C3                     DRD24B:
001B9F E1C3 DDE5            15      PUSH    IX
001BA1 E1C5 DD2AA8E5        20      LD  IX,(_DPB)
001BA5 E1C9 CD32E3          17      CALL    FDRD        ;自己書き換え（ディスク読み込み）
       E1CA                     DRDPAT  EQU $-2
       E1CC                     POP_IX_RET:
001BA8 E1CC DDE1            14      POP IX
001BAA E1CE C9              10      RET
                                
       E1CF                     DWT16:
001BAB E1CF 0E00             7      LD  C,0
       E1D1                     DWT24:
001BAD E1D1 0601             7      LD  B,1
       E1D3                     DWT24B:
001BAF E1D3 DDE5            15      PUSH    IX
001BB1 E1D5 DD2AA8E5        20      LD  IX,(_DPB)
001BB5 E1D9 CD30E3          17      CALL    FDWT        ;自己書き換え（ディスク書き込み）
       E1DA                     DWTPAT  EQU $-2
001BB8 E1DC 18EE            12      JR  POP_IX_RET
                                
       E1DE                     WTFAT:
001BBA E1DE CDE4E1          17      CALL    FATSETUP
001BBD E1E1 30F0            12      JR  NC,DWT24B
001BBF E1E3 C9              10      RET
                                ;   CALL    NC,DWT24B   ;予備FATの保存ルーチン
                                ;   RET C
                                ;   BIT 7,(IX+DPB_BPS)
                                ;   RET Z       ;予備FATが無い
                                ;   CALL    FATS2
                                ;   PUSH    HL      ;予備FAT
                                ;   LD  L,(IX+DPB_FATLN)
                                ;   LD  H,(IX+DPB_FATLN+1)
                                ;   ADD HL,DE
                                ;   EX  DE,HL
                                ;   POP HL
                                ;   JR  DWT24B
                                ;------------------------
                                ;FATのセットアップ
                                ;out
                                ;   B  : FATセクタ数
                                ;   DE : FAT先頭セクタ番号
                                ;   HL : FATバッファポインタ
                                ;   CF : 1=ドライブ切り替えエラー
                                ;note
                                ;   FATサイズがFATバッファを超える場合は
                                ;   対象クラスタ領域==(_FATIX)によって
                                ;   FAT12:対象クラスタ1024毎に1.5KBを切り替える
                                ;   FAT16:対象クラスタ512毎に1KBを切り替える
                                ;------------------------
       E1E4                     FATSETUP:
001BC0 E1E4 3AAAE5          13      LD  A,(_FATDRV)
001BC3 E1E7 CDEDE2          17      CALL    CHGDRVR     ;ドライブ切り替え
001BC6 E1EA D8              11      RET C
       E1EB                     FATS2:
001BC7 E1EB DD7E0F          19      LD  A,(IX+DPB_BPS)  ;512=2 1024=4
001BCA E1EE 0F               4      RRCA
001BCB E1EF CD1FE2          17      CALL    FATSETUP12  ;自己書き換え
       E1F0                     FATSX   EQU $-2
001BCE E1F2 210000          10      LD  HL,0
001BD1 E1F5 4A               4      LD  C,D
001BD2 E1F6 54               4      LD  D,H
001BD3 E1F7 3AABE5          13      LD  A,(_FATIX)  ;範囲FAT12:0-3/FAT16:0-127(0-07FH):65535*2/1024
001BD6 E1FA 47               4      LD  B,A
001BD7 E1FB 04               4      INC B
001BD8 E1FC DD7E00          19      LD  A,(IX+DPB_FATLN)
       E1FF                     FAT_SKP:
001BDB E1FF 05               4      DEC B
001BDC E200 2809            12      JR  Z,FAT1
001BDE E202 19              11      ADD HL,DE
001BDF E203 93               4      SUB E
001BE0 E204 30F9            12      JR  NC,FAT_SKP
001BE2 E206 DDCB0146        20      BIT 0,(IX+DPB_FATLN+1)  ;FATサイズが0100H(256)の場合
001BE6 E20A C8              11      RET Z
       E20B                     FAT1:
001BE7 E20B EB               4      EX  DE,HL
001BE8 E20C B7               4      OR  A       ;0の場合は0100Hとして扱う
001BE9 E20D 2803            12      JR  Z,FAT3
001BEB E20F B9               4      CP  C       ;C=FATバッファに読み込めるセクタ数
001BEC E210 3801            12      JR  C,FAT2
       E212                     FAT3:
001BEE E212 79               4      LD  A,C
       E213                     FAT2:
001BEF E213 47               4      LD  B,A
                                
001BF0 E214 2AFAE6          16      LD  HL,(_FATPS) ;fat sector pos
001BF3 E217 19              11      ADD HL,DE
001BF4 E218 EB               4      EX  DE,HL
001BF5 E219 2A7CE6          16      LD  HL,(_FATBF)
001BF8 E21C AF               4      XOR A       ;CF=0
001BF9 E21D 4F               4      LD  C,A
001BFA E21E C9              10      RET
                                ;
                                ;   FATバッファに読み込める最大のセクタ数と_FATIXで進めるセクタ数
                                ;   FATSETUP* (FAT12/FAT16)
                                ;out
                                ;   D : FATバッファに読み込める最大のセクタ数
                                ;   E : _FATIXで進めるセクタ数
       E21F                     FATSETUP12:
001BFB E21F 110606          10      LD  DE,0606H    ;256
001BFE E222 D8              11      RET C
001BFF E223 110303          10      LD  DE,0303H    ;512
001C02 E226 0F               4      RRCA
001C03 E227 D8              11      RET C
001C04 E228 110102          10      LD  DE,0201H    ;1024
001C07 E22B C9              10      RET
                                
       E22C                     FATSETUP16:
001C08 E22C 110404          10      LD  DE,0404H    ;256
001C0B E22F D8              11      RET C
001C0C E230 110202          10      LD  DE,0202H    ;512
001C0F E233 0F               4      RRCA
001C10 E234 D8              11      RET C
001C11 E235 110101          10      LD  DE,0101H    ;1024
001C14 E238 C9              10      RET
                                
       E239                     CHGDRV:
001C15 E239 E5              11      PUSH    HL
001C16 E23A 2189E5          10      LD  HL,_DSK
001C19 E23D BE               7      CP  (HL)
001C1A E23E 280A            12      JR  Z,CHGDRVE
       E240                     CHGDRV1:
001C1C E240 DDE5            15      PUSH    IX
001C1E E242 CD4CE2          17      CALL    CHGDRV0
001C21 E245 3A89E5          13      LD  A,(_DSK)
001C24 E248 DDE1            14      POP IX
       E24A                     CHGDRVE:
001C26 E24A E1              10      POP HL
001C27 E24B C9              10      RET
                                
       E24C                     CHGDRV0:
001C28 E24C 6F               4      LD  L,A
001C29 E24D CDDCE5          17      CALL    _GETDPB
001C2C E250 D8              11      RET C
001C2D E251 DD22A8E5        20      LD  (_DPB),IX
001C31 E255 7D               4      LD  A,L
001C32 E256 3289E5          13      LD  (_DSK),A
       E259                     CHGDRV2:
001C35 E259 C5              11      PUSH    BC
001C36 E25A D5              11      PUSH    DE
001C37 E25B ED73A4E2        20      LD  (SPPAT2),SP
001C3B E25F F3               4      DI
001C3C E260 DDF9            10      LD  SP,IX
                                
001C3E E262 E1              10      POP HL      ;00:DPB_FATLN
001C3F E263 E1              10      POP HL      ;02:DPB_DRD
001C40 E264 22CAE1          16      LD  (DRDPAT),HL
                                
001C43 E267 E1              10      POP HL
001C44 E268 22DAE1          16      LD  (DWTPAT),HL ;04:DPB_DWT
                                
001C47 E26B E1              10      POP HL      ;L=06:DPB_FATID H=07:DPB_SECPCL
001C48 E26C 7C               4      LD  A,H
001C49 E26D 32C1D8          13      LD  (SPCPAT),A  ;1クラスタの論理セクタ数
001C4C E270 3D               4      DEC A
001C4D E271 3233E0          13      LD  (_NCPAT),A
                                
001C50 E274 E1              10      POP HL      ;08:DPB_MAXCL
001C51 E275 7D               4      LD  A,L
001C52 E276 32E0D8          13      LD  (CLPAT2),A
001C55 E279 7C               4      LD  A,H
001C56 E27A 32DCD8          13      LD  (CLPAT1),A
001C59 E27D 2B               6      DEC HL
001C5A E27E 22DDDA          16      LD  (MAXCLP),HL
                                
001C5D E281 E1              10      POP HL      ;L=0A:DPB_FDMODE H=0B:DPB_DIRSCNT
001C5E E282 4C               4      LD  C,H
                                
001C5F E283 E1              10      POP HL      ;L=0C:DPB_MAXCYL H=0D:DPB_MAXSEC
                                
001C60 E284 E1              10      POP HL      ;L=0E:DPB_FATPS H=0F:DPB_BPS
001C61 E285 7C               4      LD  A,H     ;DPB_BPS
001C62 E286 E607             7      AND 7
001C64 E288 32A2DD          13      LD  (SECSZ+2),A ;1セクタのサイズの上位1バイト 0x400 - 0x200 - 0x100
                                                ;1セクタ512 2D/2DD/2HC/2HQ(2HD1.44MB)/EMM/BRAM/EMEM等
                                                ;1セクタ1024 2HD/2HDE98等
                                                ;1セクタ256 GRAM/RAMF/CMOS等
                                                ;1024   512 256
                                                ;4  2   1
001C67 E28B 87               4      ADD A,A     ;8  4   2
001C68 E28C 87               4      ADD A,A     ;010H   8   4
001C69 E28D 87               4      ADD A,A     ;020H   010H    8
001C6A E28E 323ED7          13      LD  (SDECPAT),A ;1セクタ辺りのディレクトリエントリ数
                                
001C6D E291 2600             7      LD  H,0
001C6F E293 22FAE6          16      LD  (_FATPS),HL
                                
001C72 E296 E1              10      POP HL      ;10:DPB_DIRPS
001C73 E297 22FCE6          16      LD  (_DIRPS),HL
                                
001C76 E29A E1              10      POP HL      ;L=12:DPB_DEVICE H=13:DPB_UNITNO
001C77 E29B 7C               4      LD  A,H
001C78 E29C 3284E5          13      LD  (_DRIVE),A
                                
001C7B E29F E1              10      POP HL      ;14:DPB_ADDCL
001C7C E2A0 22D1D8          16      LD  (CLSPAT),HL
                                
001C7F E2A3 310000          10      LD  SP,0        ;元のSPを復元
       E2A4                     SPPAT2  EQU $-2
001C82 E2A6 FB               4      EI
001C83 E2A7 2AFCE6          16      LD  HL,(_DIRPS)
001C86 E2AA 0600             7      LD  B,0
001C88 E2AC 09              11      ADD HL,BC       ;C=DPB_DIRSCNT
001C89 E2AD 2259D7          16      LD  (MD_PAT),HL
                                
001C8C E2B0 2ADDDA          16      LD  HL,(MAXCLP)
001C8F E2B3 110AF0          10      LD  DE,0-4086   ;クラスタ数が4086未満:FAT12 4086以上:FAT16
001C92 E2B6 19              11      ADD HL,DE
001C93 E2B7 380F            12      JR  C,SETFAT16
001C95 E2B9 21B9DF          10      LD  HL,GNCL     ;FAT12
001C98 E2BC 11DCDF          10      LD  DE,SNCL
001C9B E2BF 011FE2          10      LD  BC,FATSETUP12
001C9E E2C2 DDCB0FAE        23      RES 5,(IX+DPB_BPS)  ;DPB_BPS(FAT12)
001CA2 E2C6 180D            12      JR  EXTRA1
       E2C8                     SETFAT16:
001CA4 E2C8 2110E0          10      LD  HL,GNCL16   ;FAT16
001CA7 E2CB 111DE0          10      LD  DE,SNCL16
001CAA E2CE 012CE2          10      LD  BC,FATSETUP16
001CAD E2D1 DDCB0FEE        23      SET 5,(IX+DPB_BPS)  ;DPB_BPS(FAT16)
       E2D5                     EXTRA1:
001CB1 E2D5 22F8E5          16      LD  (GNCPAT),HL
001CB4 E2D8 ED53FBE5        20      LD  (SNCPAT),DE
001CB8 E2DC ED43F0E1        20      LD  (FATSX),BC
001CBC E2E0 D1              10      POP DE
001CBD E2E1 C1              10      POP BC
001CBE E2E2 AF               4      XOR A
001CBF E2E3 C9              10      RET
                                
       E2E4                     GETDPBD:
001CC0 E2E4 DDE3            23      EX  (SP),IX
001CC2 E2E6 DDE5            15      PUSH    IX
001CC4 E2E8 3A88E5          13      LD  A,(_DRV)
001CC7 E2EB 1807            12      JR  GETDPB1
                                
       E2ED                     CHGDRVR:
001CC9 E2ED CDD9E5          17      CALL    _CHGDRV
001CCC E2F0 D8              11      RET C
001CCD E2F1 3A89E5          13      LD  A,(_DSK)
       E2F4                     GETDPB1:
001CD0 E2F4 C3DCE5          10      JP  _GETDPB
                                
       E2F7                     GETDPB:
001CD3 E2F7 FE08             7      CP  8
001CD5 E2F9 3F               4      CCF
001CD6 E2FA D8              11      RET C
001CD7 E2FB 0F               4      RRCA
001CD8 E2FC 0F               4      RRCA
001CD9 E2FD 0F               4      RRCA
001CDA E2FE DD                      DB  0DDH        ;Z80未定義命令
001CDB E2FF 6F               4      LD  L,A     ;LD IXL,A
001CDC E300 DD                      DB  0DDH        ;Z80未定義命令
001CDD E301 26E7             7      LD  H,_DEVICE/256   ;LD IXH,_DEVICE/256
001CDF E303 DD7E00          19      LD  A,(IX+DPB_FATLN)
001CE2 E306 A7               4      AND A       ;CF=0の為
001CE3 E307 DDCB0F6E        20      BIT 5,(IX+DPB_BPS)
001CE7 E30B C0              11      RET NZ      ;FAT16
001CE8 E30C DDCB126E        20      BIT 5,(IX+DPB_DEVICE)
001CEC E310 C0              11      RET NZ      ;BPB
001CED E311 FE01             7      CP  001H        ;A=0 THEN CF=1
001CEF E313 C9              10      RET
                                
       E314                     _SYS5F:
001CF0 E314 AF               4      XOR A
       E315                     FFLUSH:
001CF1 E315 F5              11      PUSH    AF
001CF2 E316 CD3ADF          17      CALL    WTFATX
001CF5 E319 AF               4      XOR A
001CF6 E31A 32ABE5          13      LD  (_FATIX),A
001CF9 E31D 2F               4      CPL         ;0FFH
001CFA E31E 32AAE5          13      LD  (_FATDRV),A
001CFD E321 3E                      DB  03EH        ;次のPUSH AFをスキップ
       E322                     FFLUSHBUF:
001CFE E322 F5              11      PUSH    AF
001CFF E323 CDF0DE          17      CALL    DWTX
001D02 E326 3EFF             7      LD  A,0FFH
001D04 E328 3239E5          13      LD  (SFILE),A
001D07 E32B 32A5E5          13      LD  (_DBDRV),A
001D0A E32E F1              10      POP AF
001D0B E32F C9              10      RET
                                
[EOF:LDDIO.ASM:SHIFT_JIS]
                                    INCLUDE "MSXDISK.ASM"
                                
                                ;   LSX-Dodgers DISK
                                ;   MSX
                                
                                ;   ROM DISK DRIVER
                                ;   1セクタ可変(256/512/1024)
                                
       E330                     WTTRK:
       E330                     FDWT:
001D0C E330 37               4      SCF
001D0D E331 C9              10      RET
       E332                     FDRD:
001D0E E332 ED73C3E3        20      LD  (DRDSP),SP
001D12 E336 3AC4E3          13      LD  A,(DRDSPH)  ;スタックがカートリッジと被っていないかチェック
001D15 E339 FE7F             7      CP  07FH
001D17 E33B 3807            12      JR  C,FDRD1
001D19 E33D FEC1             7      CP  0C1H
001D1B E33F 3003            12      JR  NC,FDRD1
001D1D E341 315EF5          10      LD  SP,BUF
       E344                     FDRD1:
001D20 E344 C5              11      PUSH    BC
001D21 E345 D5              11      PUSH    DE
                                
001D22 E346 E5              11      PUSH    HL
001D23 E347 EB               4      EX  DE,HL
001D24 E348 DD460F          19      LD  B,(IX+DPB_BPS)
       E34B                     EADR1:
001D27 E34B CB18             8      RR  B
001D29 E34D 3803            12      JR  C,EADR2
001D2B E34F 29              11      ADD HL,HL
001D2C E350 18F9            12      JR  EADR1
       E352                     EADR2:
001D2E E352 E5              11      PUSH    HL  ;あとでDEで受け取る
001D2F E353 29              11      ADD HL,HL   ;64KB→32KB
001D30 E354 29              11      ADD HL,HL   ;32KB→16KB
       E355                     ASCII16K1:
001D31 E355 29              11      ADD HL,HL   ;16KB→8KB  ;ASCII-16Kの場合はここがNOPに置き換えられる
                                
001D32 E356 DD7E0C          19      LD  A,(IX+DPB_MAXCYL)   ;16KB単位でカートリッジ内のディスクが存在する位置を指定
       E359                     ASCII16K2:
001D35 E359 87               4      ADD A,A         ;ASCII-16Kの場合はここがNOPに置き換えられる
001D36 E35A 84               4      ADD A,H
001D37 E35B 5F               4      LD  E,A
001D38 E35C 3A62E5          13      LD  A,(ROM_SLT)
001D3B E35F 210070          10      LD  HL,BANK2_SEL
       E360                     ROM8000H    EQU $-2
001D3E E362 CD6AD4          17      CALL    WRSLT
                                
001D41 E365 2680             7      LD  H,080H
001D43 E367 3A62E5          13      LD  A,(ROM_SLT) ;カートリッジROMに切り替える
001D46 E36A CDDDD4          17      CALL    ENASLT
                                
001D49 E36D D1              10      POP DE
001D4A E36E E1              10      POP HL      ;HLは読み出し先のメモリアドレス
                                
001D4B E36F 7B               4      LD  A,E
001D4C E370 E61F             7      AND 01FH        ;セグメントのサイズでフィルタする(8K:1F/16K:3F)
       E371                     ASCII16K3   EQU $-1
001D4E E372 1E00             7      LD  E,0     ;DEはROMディスクから読み出すアドレス
001D50 E374 C680             7      ADD A,080H
001D52 E376 57               4      LD  D,A
                                
001D53 E377 3E                      DB  03EH
001D54 E378 A7               4      AND A
001D55 E379 32A6E3          13      LD  (DRD_SWC3),A
001D58 E37C 7C               4      LD  A,H     ;読み出し先がカートリッジと被っていないかチェック
001D59 E37D FE7B             7      CP  07BH
001D5B E37F 3812            12      JR  C,DRD2
001D5D E381 FEC1             7      CP  0C1H
001D5F E383 300E            12      JR  NC,DRD2
001D61 E385 22ADE3          16      LD  (DRD_SWC1),HL   ;被っている場合はデータバッファをフラッシュして一時的に使う
001D64 E388 2A7EE6          16      LD  HL,(_DTBUF)
001D67 E38B 3E                      DB  03EH
001D68 E38C 37               4      SCF
001D69 E38D 32A6E3          13      LD  (DRD_SWC3),A
001D6C E390 CD22E3          17      CALL    FFLUSHBUF
       E393                     DRD2:
001D6F E393 DD7E0F          19      LD  A,(IX+DPB_BPS)  ;BCは読み出すセクタサイズ
001D72 E396 E607             7      AND 7
001D74 E398 47               4      LD  B,A
001D75 E399 4B               4      LD  C,E ;E=0
                                
001D76 E39A EB               4      EX  DE,HL
001D77 E39B EDB0                    LDIR
001D79 E39D D5              11      PUSH    DE
001D7A E39E 2680             7      LD  H,080H
001D7C E3A0 3A43F3          13      LD  A,(0F341H+2)    ;メインRAMに戻す
001D7F E3A3 CDDDD4          17      CALL    ENASLT
       E3A6                     DRD_SWC3:
001D82 E3A6 A7               4      AND A       ;自己書き換え)被っている場合はSCFになる
001D83 E3A7 3012            12      JR  NC,DRD3
                                
001D85 E3A9 2A7EE6          16      LD  HL,(_DTBUF)
001D88 E3AC 110000          10      LD  DE,0
       E3AD                     DRD_SWC1    EQU $-2
001D8B E3AF DD7E0F          19      LD  A,(IX+DPB_BPS)  ;BCは読み出すセクタサイズ
001D8E E3B2 E607             7      AND 7
001D90 E3B4 47               4      LD  B,A
001D91 E3B5 0E00             7      LD  C,0
001D93 E3B7 EDB0                    LDIR
001D95 E3B9 E1              10      POP HL
001D96 E3BA D5              11      PUSH    DE
       E3BB                     DRD3:
001D97 E3BB E1              10      POP HL
001D98 E3BC D1              10      POP DE
001D99 E3BD 13               6      INC DE
001D9A E3BE C1              10      POP BC
001D9B E3BF 1083            13      DJNZ    FDRD1
001D9D E3C1 AF               4      XOR A
001D9E E3C2 310000          10      LD  SP,0
       E3C3                     DRDSP   EQU $-2
       E3C4                     DRDSPH  EQU $-1
001DA1 E3C5 FB               4      EI
001DA2 E3C6 C9              10      RET
                                
       E3C7                     PDWT:
001DA3 E3C7 37               4      SCF
001DA4 E3C8 CB7C             8      BIT 7,H
001DA6 E3CA 2058            12      JR  NZ,PDWX
001DA8 E3CC CD22E3          17      CALL    FFLUSHBUF
       E3CF                     PDWT1:
001DAB E3CF C5              11      PUSH    BC
001DAC E3D0 D5              11      PUSH    DE
001DAD E3D1 ED5B7EE6        20      LD  DE,(_DTBUF)
001DB1 E3D5 DD7E0F          19      LD  A,(IX+DPB_BPS)  ;BCは読み出すセクタサイズ
001DB4 E3D8 E607             7      AND 7
001DB6 E3DA 47               4      LD  B,A
001DB7 E3DB 0E00             7      LD  C,0
001DB9 E3DD EDB0                    LDIR
001DBB E3DF E3              19      EX  (SP),HL
001DBC E3E0 EB               4      EX  DE,HL
001DBD E3E1 D5              11      PUSH    DE
001DBE E3E2 2A7EE6          16      LD  HL,(_DTBUF)
001DC1 E3E5 0601             7      LD  B,1
001DC3 E3E7 37               4      SCF
001DC4 E3E8 CD24E4          17      CALL    PDWX
001DC7 E3EB 3832            12      JR  C,PDRWERR
001DC9 E3ED D1              10      POP DE
001DCA E3EE 13               6      INC DE
001DCB E3EF E1              10      POP HL
001DCC E3F0 C1              10      POP BC
001DCD E3F1 10D4            13      DJNZ    PDWT
001DCF E3F3 AF               4      XOR A
001DD0 E3F4 C9              10      RET
       E3F5                     PDRD:
001DD1 E3F5 CB7C             8      BIT 7,H
001DD3 E3F7 202A            12      JR  NZ,PDWXR
001DD5 E3F9 CD22E3          17      CALL    FFLUSHBUF
       E3FC                     PDRD1:
001DD8 E3FC C5              11      PUSH    BC
001DD9 E3FD D5              11      PUSH    DE
001DDA E3FE E5              11      PUSH    HL
001DDB E3FF 2A7EE6          16      LD  HL,(_DTBUF)
001DDE E402 0601             7      LD  B,1
001DE0 E404 CD23E4          17      CALL    PDWXR
001DE3 E407 3816            12      JR  C,PDRWERR
001DE5 E409 D1              10      POP DE
001DE6 E40A 2A7EE6          16      LD  HL,(_DTBUF)
001DE9 E40D DD7E0F          19      LD  A,(IX+DPB_BPS)  ;BCは読み出すセクタサイズ
001DEC E410 E607             7      AND 7
001DEE E412 47               4      LD  B,A
001DEF E413 0E00             7      LD  C,0
001DF1 E415 EDB0                    LDIR
001DF3 E417 EB               4      EX  DE,HL
001DF4 E418 D1              10      POP DE
001DF5 E419 13               6      INC DE
001DF6 E41A C1              10      POP BC
001DF7 E41B 10D8            13      DJNZ    PDRD
001DF9 E41D AF               4      XOR A
001DFA E41E C9              10      RET
       E41F                     PDRWERR:
001DFB E41F E1              10      POP HL
001DFC E420 D1              10      POP DE
001DFD E421 C1              10      POP BC
001DFE E422 C9              10      RET
       E423                     PDWXR:
001DFF E423 A7               4      AND A
       E424                     PDWX:                   ;CF=0 READ CF=1 WRITE
001E00 E424 DDCB1266        20      BIT 4,(IX+DPB_DEVICE)   ;デバイス情報
001E04 E428 2003            12      JR  NZ,PDWX1
001E06 E42A DD4E06          19      LD  C,(IX+DPB_FATID)    ;メディアバイト
       E42D                     PDWX1:
001E09 E42D DD7E13          19      LD  A,(IX+DPB_UNITNO)   ;デバイスドライバ内におけるユニット番号
001E0C E430 C5              11      PUSH    BC
001E0D E431 D5              11      PUSH    DE
001E0E E432 E5              11      PUSH    HL
001E0F E433 DDE5            15      PUSH    IX
001E11 E435 FDE5            15      PUSH    IY
001E13 E437 CDA7FF          17      CALL    H_PHYD
001E16 E43A FDE1            14      POP IY
                                ;   LD  IX,PHYDIO
                                ;   CALL    CALSLT_R
001E18 E43C DDE1            14      POP IX
001E1A E43E E1              10      POP HL
001E1B E43F D1              10      POP DE
001E1C E440 C1              10      POP BC
001E1D E441 D8              11      RET C
       E442                     PDWX2:
001E1E E442 13               6      INC DE
001E1F E443 DD7E0F          19      LD  A,(IX+DPB_BPS)  ;BCは読み出すセクタサイズ
001E22 E446 E607             7      AND 7
001E24 E448 84               4      ADD A,H
001E25 E449 67               4      LD  H,A
001E26 E44A 10F6            13      DJNZ    PDWX2
001E28 E44C AF               4      XOR A
001E29 E44D C9              10      RET
[EOF:MSXDISK.ASM:UTF_8]
                                    INCLUDE "LDCCPWK.ASM"
                                
                                ;   LSX-Dodgers CCP WORK
                                
       003B                     PATHX   EQU 59
001E2A E44E                     PATHD:  DS  PATHX
001E65 E489 00                  PATHE:  DB  0
                                
       E48A                     DTA_CCP:
001E66 E48A                         DS  37
                                
       E4AF                     FCB_BAT:
001E8B E4AF                         DS  37
                                
001EB0 E4D4 2020203C4449523E    DIRMES: DB  "   <DIR>  $"
            202024              
001EBB E4DF 20667265652024      FREE:   DB  " free $"
[EOF:LDCCPWK.ASM:UTF_8]
                                    INCLUDE "LDWORK.ASM"
                                
                                ;   LSX-Dodgers WORK0
                                ;
                                ;   CP/M互換BIOS
                                ;   BOOT:アドレス下位1バイトが0になるように
       E4E6                     AT_WORK:
001EC2 E4E6                         DS  WORKAD-AT_WORK
                                
       E500                     CPM_BOOT:
001EDC E500 C30000          10      JP  0
       E503                     _SYS00:     ;(BDOS)プログラム終了
       E503                     CPM_WBOOT:
001EDF E503 C315CA          10      JP  WBOOT1
       E506                     CPM_CONST:
001EE2 E506 C364D2          10      JP  CONSTX
       E509                     _SYS07:     ;(BDOS)コンソール直接入力
       E509                     CPM_CONIN:
001EE5 E509 C385D1          10      JP  FLGET
       E50C                     CPM_CONOUT:
001EE8 E50C C367D3          10      JP  CONOUT1
                                
       E50F                     DECBF:              ;10進数表示時のバッファ(5バイト)
001EEB E50F                         DS  5
       E50F                     RR_BUF_HL   EQU DECBF   ;CP/M互換ファイルアクセスの際のランダムレコードの一時的な保管場所
       E511                     RR_BUF_A    EQU DECBF+2 ;計3バイト
                                
001EF0 E514 00                  FDRV:   DB  0
001EF1 E515                     FNAME:  DS  36
001F15 E539                     SFILE:  DS  33      ;DRV FILENAME
                                
001F36 E55A                         DS  3
                                
001F39 E55D 0000                LEFTX:  DW  0
001F3B E55F 0000                DTAX:   DW  0
                                
       E561                     ZERO:
       E561                     BEEPD:
001F3D E561 008E01000B000C10        DB  0,08EH,1,0,00BH,0,00CH,010H
001F45 E569 073E08100D00FF          DB  007H,03EH,008H,010H,00DH,0,0FFH
       E562                     RTC_YY  EQU BEEPD+1
       E563                     RTC_MW  EQU BEEPD+2
       E564                     RTC_DD  EQU BEEPD+3
       E565                     RTC_TT  EQU BEEPD+4
       E566                     RTC_MM  EQU BEEPD+5
       E567                     RTC_SS  EQU BEEPD+6
       E562                     ROM_SLT EQU BEEPD+1
                                
001F4C E570 00                  CHECK:  DB  0
                                
001F4D E571 4F4B24              OK: DB  "OK$"
001F50 E574                         DS  5
001F55 E579 4572726F722124      COMERM: DB  "Error!$"
                                ;   システムワークエリア
                                ;   _CYL0:アドレス下位1バイトが080Hになるように
001F5C E580 FF                  _CYL0:  DB  0FFH    ;Cylinder
001F5D E581 FF                  _CYL1:  DB  0FFH    ;Cylinder
001F5E E582 FF                  _CYL2:  DB  0FFH    ;Cylinder
001F5F E583 FF                  _CYL3:  DB  0FFH    ;Cylinder
001F60 E584 00                  _DRIVE: DB  0   ;unit number
       E585                     _SEEKSP:
001F61 E585 00                      DB  0   ;Seek speed
001F62 E586 32                  _ISEEK: DB  50  ;
001F63 E587                         DS  1
001F64 E588 00                  _DRV:   DB  0
001F65 E589 FF                  _DSK:   DB  0FFH
001F66 E58A 8000                _DTA:   DW  00080H
001F68 E58C 0000                _CTC:   DW  0
001F6A E58E 0000                _TXADR: DW  0
001F6C E590 0000                _KEYPS: DW  0
001F6E E592 00FF                _KEYD:  DW  0FF00H  ;キーデータ
001F70 E594 0000                _KEYSP: DB  KEYSP_L,KEYSP_H ;オートリピートの速度
       E596                     _COLORF:
001F72 E596 00                      DB  COLORF  ;色
001F73 E597 19                  _LINE:  DB  LINE
                                
001F74 E598 0000                _FCB:   DW  0   ;SEARCH FILES
001F76 E59A 0000                _FBPS:  DW  0   ;    //
001F78 E59C 0000                _FBAD:  DW  0   ;    //
001F7A E59E 00                  _FBCNT: DB  0   ;    //
001F7B E59F 00                  _FILEN: DB  0   ;    //
001F7C E5A0 00                  _DIRF:  DB  0   ;bit7:ディレクトリ bit0-6:セクタインデックス
001F7D E5A1                         DS  1
       E5A2                     _WTFATF:
001F7E E5A2 00                      DB  0   ;FATバッファの更新フラグ
001F7F E5A3                         DS  1
001F80 E5A4 00                  _WTDBF: DB  0   ;データバッファの更新フラグ
001F81 E5A5 FF                  _DBDRV: DB  0FFH    ;データバッファにあるデータを読み込んだドライブ
001F82 E5A6 0000                _DBSEC: DW  0   ;データバッファにあるデータを読み込んだセクタ番号
001F84 E5A8 0000                _DPB:   DW  0
       E5AA                     _FATDRV:
001F86 E5AA FF                      DB  0FFH    ;FATバッファに読み込んでいるドライブ
001F87 E5AB 00                  _FATIX: DB  0   ;FATバッファに読み込んでいるインデックス
       E5AC                     _FAKEFREE:
001F88 E5AC 0000                    DW  0   ;偽の残量（FATサイズが大きくなると重くなるのでその対策）
                                
001F8A E5AE                         DS  2
                                
       E5B0                     CRTCD:
001F8C E5B0 6F                      DB  06FH
       E5B1                     _WIDTH:
001F8D E5B1 28                      DB  WIDTH
       E5B2                     TVRAMTOP:
001F8E E5B2 5938                    DB  059H,038H
001F90 E5B4 1F02                    DB  01FH,002H
       E5B6                     _LINE2:
001F92 E5B6 19                      DB  019H
       E5B7                     WKE4:
001F93 E5B7 1C                      DB  01CH
       E5B8                     WKE6:
001F94 E5B8 00                      DB  000H
       E5B9                     WK40:
001F95 E5B9 07                      DB  007H
       E5BA                     _PAGE_MINUS:
001F96 E5BA 18FC                    DW  0-WIDTH*LINE
       E5BC                     _WIDTH_MINUS:
001F98 E5BC D8FF                    DW  0-WIDTH
       E5BE                     WK30:
001F9A E5BE 0C                      DB  00CH
       E5BF                     WK31:
       E5BF                     WK1FD0:
001F9B E5BF 20                      DB  020H
                                
001F9C E5C0 0000                CTC0:   DW  INTCTCE
001F9E E5C2 0000                CTC1:   DW  INTCTCE
001FA0 E5C4 0000                CTC2:   DW  INTCTCE
001FA2 E5C6 0000                CTC3:   DW  INTCTCE
001FA4 E5C8 0000                INTVEC: DW  INT
                                
                                ;   LSX-Dodgers 独自BIOS
                                
001FA6 E5CA C3CAD1          10  _INKEY: JP  INKEY
001FA9 E5CD C30AD1          10  _PRINT: JP  PRINT
001FAC E5D0 C301D3          10  _SCRN:  JP  SCRN
001FAF E5D3 C3E1D2          10  _POS:   JP  POS
001FB2 E5D6 C3ECD2          10  _LOC:   JP  LOC
       E5D9                     _CHGDRV:
001FB5 E5D9 C339E2          10      JP  CHGDRV
       E5DC                     _GETDPB:
001FB8 E5DC C3F7E2          10      JP  GETDPB
       E5DF                     _FFLUSH:
001FBB E5DF C315E3          10      JP  FFLUSH
       E5E2                     _RDFATX:
001FBE E5E2 C310DF          10      JP  RDFATX
001FC1 E5E5 C33FE0          10  _RDFAT: JP  RDFAT
001FC4 E5E8 C330E3          10  _WTTRK: JP  WTTRK
001FC7 E5EB C332E3          10  _FDRD:  JP  FDRD
001FCA E5EE C330E3          10  _FDWT:  JP  FDWT
       E5F1                     _BPB2DPB:
001FCD E5F1 C3D5E0          10      JP  BPB2DPB
       E5F4                     _BREAK:
001FD0 E5F4 C394CB          10      JP  END_BATCH
       E5F7                     _GNCL:
001FD3 E5F7 C3B9DF          10      JP  GNCL        ; self-modifying code
       E5F8                     GNCPAT  EQU $-2
       E5FA                     _SNCL:
001FD6 E5FA C3DCDF          10      JP  SNCL        ; self-modifying code
       E5FB                     SNCPAT  EQU $-2
       E5FD                     _COMANL:
001FD9 E5FD C34DCA          10      JP  COMANL
                                
       E600                     _WE:
[EOF:LDWORK.ASM:SHIFT_JIS]
                                    INCLUDE "LDCALL.ASM"
                                
                                ;   LSX-Dodgers システムコール(BDOS)
                                ;
                                ;   LSX-Dodgers SYSTEM CALL
                                ;   STABLE:アドレス下位1バイトが0になるように
                                
       E600                     STABLE:
                                ;0
001FDC E600 03E50DD13ED16BD7        DW  _SYS00,_SYS01,_SYS02,_SYS03
001FE4 E608 75CE75CE44D109E5        DW  _SYS04,_SYS05,_SYS06,_SYS07
001FEC E610 4CD177CED0D164D2        DW  _SYS08,_SYS09,_SYS0A,_SYS0B
001FF4 E618 8CCE91CEA0CEB1CE        DW  _SYS0C,_SYS0D,_SYS0E,_SYS0F
                                ;1
001FFC E620 05CF4CCF95CFC6CF        DW  _SYS10,_SYS11,_SYS12,_SYS13
002004 E628 CECFE4CFF9CFF1CF        DW  _SYS14,_SYS15,_SYS16,_SYS17
00200C E630 40D045D04AD050D0        DW  _SYS18,_SYS19,_SYS1A,_SYS1B
002014 E638 75CE76D075CE7AD0        DW  _SYS1C,_SYS1D,_SYS1E,_SYS1F
                                ;2
00201C E640 75CE30D038D081D0        DW  _SYS20,_SYS21,_SYS22,_SYS23
002024 E648 A7D075CEC0DB98DC        DW  _SYS24,_ERROR,_SYS26,_SYS27
00202C E650 38D0B1D076D26BD7        DW  _SYS28,_SYS29,_SYS2A,_SYS2B
002034 E658 C6D26BD775CED2D0        DW  _SYS2C,_SYS2D,_SYS2E,_SYS2F
                                ;3
00203C E660 CCD075CE75CE75CE        DW  _SYS30,_ERROR,_ERROR,_ERROR
002044 E668 75CE75CE75CE75CE        DW  _ERROR,_ERROR,_ERROR,_ERROR
00204C E670 75CE6BD76BD7F3D0        DW  _ERROR,_SYS39,_SYS3A,_SYS5A
                                ;DOS2
002054 E678 58CE                    DW  _DOS2
                                
002056 E67A                         DS  1
       E67B                     _MAX_SEC_SZ_H:
002057 E67B 02                      DB  MAX_SEC_SZ_H
       E67C                     _FATBF:
002058 E67C 00E8                    DW  FATBF
       E67E                     _DTBUF:
00205A E67E 00EE                    DW  DTBUF
                                
                                ;   コントロールコードテーブル
                                ;   CTRLTB:アドレス下位1バイトが080Hになるように
                                
       E680                     CTRLTB:
00205C E680 0000000011D30000        DW  CTRL00,CTRL00,CTRL02,CTRL03 ;  A,B,C
002064 E688 0000000000000000        DW  CTRL04,CTRL05,CTRL06,CTRL07 ;D,E,F,G
00206C E690 0000000000000000        DW  CTRL08,CTRL09,CTRL0A,CTRL0B ;H,I,J,K
002074 E698 0000000000000000        DW  CTRL0C,CTRL0D,CTRL0E,CTRL00 ;L,M,N,O
00207C E6A0 0000000000000000        DW  CTRL00,CTRL00,CTRL12,CTRL00 ;P,Q,R,S
002084 E6A8 0000000000000000        DW  CTRL00,CTRL00,CTRL00,CTRL00 ;T,U,V,W
00208C E6B0 0000000000000000        DW  CTRL00,CTRL00,CTRL0C,CTRL1B ;X,Y,Z,ESC
002094 E6B8 0000000000000000        DW  CTRL1C,CTRL1D,CTRL1E,CTRL1F ;→,←,↑,↓
                                
00209C E6C0 0200                M2D:    DW  2
00209E E6C2 FD02                    DB  0FDH,2
0020A0 E6C4 6401                    DW  356
0020A2 E6C6 FF0728090182            DB  0FFH,7,40,9,1,082H
0020A8 E6CC 0500A7000800            DW  5,0A7H,8
                                
0020AE E6D2 0200                M2HD:   DW  2
0020B0 E6D4 FE01                    DB  0FEH,1
0020B2 E6D6 C704                    DW  1223
0020B4 E6D8 FE064D080184            DB  0FEH,6,77,8,1,084H
0020BA E6DE 0500A7000900            DW  5,0A7H,9
                                
0020C0 E6E4 1617                SDDATA: DB  22,23       ;(FCB)ファイルを最後に変更した時刻
0020C2 E6E6 1415                    DB  20,21       ;(FCB)ファイルを最後に変更した日付
0020C4 E6E8 1A1B                    DB  26,27       ;(FCB)ファイルの先頭クラスタ
0020C6 E6EA 10111213                DB  16,17,18,19 ;(FCB)ファイルのサイズ(バイト単位)
       E6EE                     SDDATAE:
                                
0020CA E6EE                         DS  2
       E6F0                     _FCB_BAT:
0020CC E6F0 AFE4                    DW  FCB_BAT
       E6F2                     _PATH:
0020CE E6F2 4EE4                    DW  PATHD
                                
0020D0 E6F4                     SCDIR:  DS  2       ;+14 +15
0020D2 E6F6                     SFBPS:  DS  2       ;FBPS
0020D4 E6F8                     SFNDF:  DS  2       ;FILEN DIRF
                                
0020D6 E6FA 0000                _FATPS: DW  0
0020D8 E6FC 0000                _DIRPS: DW  0
0020DA E6FE 0000                _CLPS:  DW  0
                                
       E700                     _PE:
[EOF:LDCALL.ASM:SHIFT_JIS]
                                    INCLUDE "MSXDPB.ASM"
                                
                                ;   LSX-Dodgers DPB
                                ;   MSX
                                
       E700                     _DEVICE:
                                
                                ;   A:
                                
0020DC E700 0300                    DW  3   ;DPB_FATLN
0020DE E702 EBE5                    DW  _FDRD   ;DPB_DRD
0020E0 E704 EEE5                    DW  _FDWT   ;DPB_DWT
0020E2 E706 F9                      DB  0F9H    ;DPB_FATID
0020E3 E707 03                      DB  3   ;DPB_SECPCL
0020E4 E708 CB02                    DW  715 ;DPB_MAXCL
0020E6 E70A 00                      DB  0   ;DPB_FDMODE
0020E7 E70B 07                      DB  7   ;DPB_DIRSCNT
0020E8 E70C 01                      DB  1   ;DPB_MAXCYL ROMディスクではBPPが格納されている先頭BANK
0020E9 E70D 00                      DB  0   ;DPB_MAXSEC
0020EA E70E 01                      DB  1   ;DPB_FATPS
0020EB E70F 82                      DB  082H    ;DPB_BPS
0020EC E710 0700                    DW  7   ;DPB_DIRPS
0020EE E712 2E                      DB  02EH    ;DPB_DEVICE
0020EF E713 00                      DB  0   ;DPB_UNITNO
0020F0 E714 0A00                    DW  10  ;DPB_ADDCL
0020F2 E716 0000                    DW  0   ;DPB_16
0020F4 E718 0000                    DW  0   ;DPB_18
0020F6 E71A 0000                    DW  0   ;DPB_SDIR
0020F8 E71C 524F4D30                DB  "ROM0"  ;DPB_NAME
                                
                                ;   B:
                                
0020FC E720 0300                    DW  3   ;DPB_FATLN
0020FE E722 EBE5                    DW  _FDRD   ;DPB_DRD
002100 E724 EEE5                    DW  _FDWT   ;DPB_DWT
002102 E726 F9                      DB  0F9H    ;DPB_FATID
002103 E727 03                      DB  3   ;DPB_SECPCL
002104 E728 CB02                    DW  715 ;DPB_MAXCL
002106 E72A 00                      DB  0   ;DPB_FDMODE
002107 E72B 07                      DB  7   ;DPB_DIRSCNT
002108 E72C 2E                      DB  46  ;DPB_MAXCYL ROMディスクではBPPが格納されている先頭BANK
002109 E72D 00                      DB  0   ;DPB_MAXSEC
00210A E72E 01                      DB  1   ;DPB_FATPS
00210B E72F 82                      DB  082H    ;DPB_BPS
00210C E730 0700                    DW  7   ;DPB_DIRPS
00210E E732 2E                      DB  02EH    ;DPB_DEVICE
00210F E733 01                      DB  1   ;DPB_UNITNO
002110 E734 0A00                    DW  10  ;DPB_ADDCL
002112 E736 0000                    DW  0   ;DPB_16
002114 E738 0000                    DW  0   ;DPB_18
002116 E73A 0000                    DW  0   ;DPB_SDIR
002118 E73C 524F4D31                DB  "ROM1"  ;DPB_NAME
                                
                                ;   C:
                                
00211C E740                         DS  32
                                
                                ;   D:
                                
00213C E760                         DS  32
                                
                                ;   E:
                                
00215C E780 0300                    DW  3   ;DPB_FATLN
00215E E782 F5E3                    DW  PDRD    ;DPB_DRD
002160 E784 C7E3                    DW  PDWT    ;DPB_DWT
002162 E786 F9                      DB  0F9H    ;DPB_FATID
002163 E787 03                      DB  3   ;DPB_SECPCL
002164 E788 CB02                    DW  715 ;DPB_MAXCL
002166 E78A FF                      DB  0FFH    ;DPB_FDMODE
002167 E78B 07                      DB  7   ;DPB_DIRSCNT
002168 E78C 50                      DB  80  ;DPB_MAXCYL ROMディスクではBPPが格納されている先頭BANK
002169 E78D 09                      DB  9   ;DPB_MAXSEC
00216A E78E 01                      DB  1   ;DPB_FATPS
00216B E78F 82                      DB  082H    ;DPB_BPS
00216C E790 0700                    DW  7   ;DPB_DIRPS
00216E E792 2D                      DB  02DH    ;DPB_DEVICE
00216F E793 00                      DB  0   ;DPB_UNITNO
002170 E794 0A00                    DW  10  ;DPB_ADDCL
002172 E796 0000                    DW  0   ;DPB_16
002174 E798 0000                    DW  0   ;DPB_18
002176 E79A 0000                    DW  0   ;DPB_SDIR
002178 E79C 44534B30                DB  "DSK0"  ;DPB_NAME
                                
                                ;   F:
                                
00217C E7A0 0300                    DW  3   ;DPB_FATLN
00217E E7A2 F5E3                    DW  PDRD    ;DPB_DRD
002180 E7A4 C7E3                    DW  PDWT    ;DPB_DWT
002182 E7A6 F9                      DB  0F9H    ;DPB_FATID
002183 E7A7 03                      DB  3   ;DPB_SECPCL
002184 E7A8 CB02                    DW  715 ;DPB_MAXCL
002186 E7AA FF                      DB  0FFH    ;DPB_FDMODE
002187 E7AB 07                      DB  7   ;DPB_DIRSCNT
002188 E7AC 50                      DB  80  ;DPB_MAXCYL ROMディスクではBPPが格納されている先頭BANK
002189 E7AD 09                      DB  9   ;DPB_MAXSEC
00218A E7AE 01                      DB  1   ;DPB_FATPS
00218B E7AF 82                      DB  082H    ;DPB_BPS
00218C E7B0 0700                    DW  7   ;DPB_DIRPS
00218E E7B2 2D                      DB  02DH    ;DPB_DEVICE
00218F E7B3 01                      DB  1   ;DPB_UNITNO
002190 E7B4 0A00                    DW  10  ;DPB_ADDCL
002192 E7B6 0000                    DW  0   ;DPB_16
002194 E7B8 0000                    DW  0   ;DPB_18
002196 E7BA 0000                    DW  0   ;DPB_SDIR
002198 E7BC 44534B31                DB  "DSK1"  ;DPB_NAME
                                
                                ;   G:
                                
00219C E7C0 0300                    DW  3   ;DPB_FATLN
00219E E7C2 F5E3                    DW  PDRD    ;DPB_DRD
0021A0 E7C4 C7E3                    DW  PDWT    ;DPB_DWT
0021A2 E7C6 F9                      DB  0F9H    ;DPB_FATID
0021A3 E7C7 03                      DB  3   ;DPB_SECPCL
0021A4 E7C8 CB02                    DW  715 ;DPB_MAXCL
0021A6 E7CA FF                      DB  0FFH    ;DPB_FDMODE
0021A7 E7CB 07                      DB  7   ;DPB_DIRSCNT
0021A8 E7CC 50                      DB  80  ;DPB_MAXCYL ROMディスクではBPPが格納されている先頭BANK
0021A9 E7CD 09                      DB  9   ;DPB_MAXSEC
0021AA E7CE 01                      DB  1   ;DPB_FATPS
0021AB E7CF 82                      DB  082H    ;DPB_BPS
0021AC E7D0 0700                    DW  7   ;DPB_DIRPS
0021AE E7D2 2D                      DB  02DH    ;DPB_DEVICE
0021AF E7D3 02                      DB  2   ;DPB_UNITNO
0021B0 E7D4 0A00                    DW  10  ;DPB_ADDCL
0021B2 E7D6 0000                    DW  0   ;DPB_16
0021B4 E7D8 0000                    DW  0   ;DPB_18
0021B6 E7DA 0000                    DW  0   ;DPB_SDIR
0021B8 E7DC 44534B32                DB  "DSK2"  ;DPB_NAME
                                
                                ;   H:
0021BC E7E0 0300                    DW  3   ;DPB_FATLN
0021BE E7E2 F5E3                    DW  PDRD    ;DPB_DRD
0021C0 E7E4 C7E3                    DW  PDWT    ;DPB_DWT
0021C2 E7E6 F9                      DB  0F9H    ;DPB_FATID
0021C3 E7E7 03                      DB  3   ;DPB_SECPCL
0021C4 E7E8 CB02                    DW  715 ;DPB_MAXCL
0021C6 E7EA FF                      DB  0FFH    ;DPB_FDMODE
0021C7 E7EB 07                      DB  7   ;DPB_DIRSCNT
0021C8 E7EC 50                      DB  80  ;DPB_MAXCYL ROMディスクではBPPが格納されている先頭BANK
0021C9 E7ED 09                      DB  9   ;DPB_MAXSEC
0021CA E7EE 01                      DB  1   ;DPB_FATPS
0021CB E7EF 82                      DB  082H    ;DPB_BPS
0021CC E7F0 0700                    DW  7   ;DPB_DIRPS
0021CE E7F2 2D                      DB  02DH    ;DPB_DEVICE
0021CF E7F3 07                      DB  7   ;DPB_UNITNO
0021D0 E7F4 0A00                    DW  10  ;DPB_ADDCL
0021D2 E7F6 0000                    DW  0   ;DPB_16
0021D4 E7F8 0000                    DW  0   ;DPB_18
0021D6 E7FA 0000                    DW  0   ;DPB_SDIR
0021D8 E7FC 44534B37                DB  "DSK7"  ;DPB_NAME
       E800                     MSX_E:
[EOF:MSXDPB.ASM:UTF_8]
                                
0021DC E800                         DS  03FFFH - $$
003FFF 0623 00                      DB  0
       0624                     LAST_ADR:
                                
                                    END
[EOF:MSX.ASM:UTF_8]
