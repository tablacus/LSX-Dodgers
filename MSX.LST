                                ;*** AILZ80ASM *** Z-80 Assembler, version 1.0.21.0, LST:Full:4
                                ;   LSX-Dodgers for MSX
                                ;   Programmed by
                                ;   Gaku (Lovers/Tablacus)
                                
                                    INCLUDE "MSXDEF.ASM"
                                
                                ;   LSX-Dodgers DEF
                                ;   MSX
                                
       0003                     MAC EQU 3   ;MSX
       0001                     DEV EQU 1
                                
       001D                     VER_6F  EQU 0001DH
                                
       4000                     RUN EQU 04000H
                                
       C700                     START2  EQU 0C700H
       CA06                     BDOS    EQU 0CA06H
       E500                     WORKAD  EQU 0E500H
       E800                     FATBF   EQU 0E800H
       EE00                     DTBUF   EQU 0EE00H
       0028                     WIDTH   EQU 40
       0019                     LINE    EQU 25
       0000                     COLORF  EQU 0
       0000                     KEYSP_H EQU 0
       0000                     KEYSP_L EQU 0
       0008                     COMS    EQU 8
       0002                     MAX_SEC_SZ_H    EQU 2       ;1セクタ1024バイトのサポート(2:off 4:on)
       8000                     BUFFER  EQU 08000H
       0100                     BUF_COM EQU 00100H
                                
       000C                     _RDSLT  EQU 0000CH
       0014                     _WRSLT  EQU 00014H
       001C                     _CALSLT EQU 0001CH
       0024                     _ENASLT EQU 00024H
       0030                     _CALLF  EQU 00030H
                                
       004A                     RDVRM   EQU 0004AH
       004D                     WRTVRM  EQU 0004DH
       006C                     INITXT  EQU 0006CH
       0078                     SETTXT  EQU 00078H
       009C                     CHSNS   EQU 0009CH
       009F                     CHGET   EQU 0009FH
       00A2                     CHPUT   EQU 000A2H
       00AE                     PINLIN  EQU 000AEH
       00B1                     INLIN   EQU 000B1H
       00B4                     QINLIN  EQU 000B4H
       00B7                     BREAKX  EQU 000B7H
       00C0                     BEEP    EQU 000C0H
       00C6                     POSIT   EQU 000C6H
       0138                     RSLREG  EQU 00138H
       0144                     PHYDIO  EQU 00144H  ;MAIN:BIOS:
       0156                     KILBUF  EQU 00156H
                                
       01F5                     REDCLK  EQU 001F5H  ;SUB
       01F9                     WRTCLK  EQU 001F9H  ;SUB
                                
       F341                     RAMAD0  EQU 0F341H
       F342                     RAMAD1  EQU 0F342H
       F343                     RAMAD2  EQU 0F343H
       F344                     RAMAD3  EQU 0F344H
                                
       FEDA                     H_STKE  EQU 0FEDAH
       FFA7                     H_PHYD  EQU 0FFA7H
                                
                                            ;ASCII-8K
       6000                     BANK0_SEL EQU 06000H
       6800                     BANK1_SEL EQU 06800H
       7000                     BANK2_SEL EQU 07000H
       7800                     BANK3_SEL EQU 07800H
                                            ;ASCII-16K
                                ;BANK0_SEL EQU 06000H
                                ;BANK1_SEL EQU 07000H
                                            ;KONAMI-8K
       8000                     KONAMI_BANK2_SEL EQU 08000H
       A000                     KONAMI_BANK3_SEL EQU 0A000H
[EOF:MSXDEF.ASM:UTF_8]
                                    INCLUDE "LDDEF.ASM"
                                
                                ;   LSX-Dodgers DEF
                                
       0001                     VER_1   EQU 1
       0006                     VER_2   EQU 6
       0001                     VER_3   EQU 1
       1D03                     MACW    EQU MAC + 01D00H    ;機種フラグとLD判別フラグ
       0103                     MACD    EQU MAC + DEV * 256 ;機種フラグとデバイスフラグ
       0161                     VER EQU VER_1 * 256 + VER_2 * 16 + VER_3
                                
       0004                     _DVSW   EQU 00004H
       0005                     SYSTEM  EQU 00005H
       000F                     JP_HL   EQU 0000FH
       005C                     FCB1    EQU 0005CH
       006C                     FCB2    EQU 0006CH
       005D                     FCB1FN  EQU FCB1+1
       006D                     FCB2FN  EQU FCB2+1
       0080                     DTA1    EQU 00080H
                                
       F323                     DISKVE  EQU 0F323H
       F325                     BREAKV  EQU 0F325H
       FFCA                     EXTBIO  EQU 0FFCAH
                                
       0000                     DPB_FATLN   EQU 00H
       0002                     DPB_DRD     EQU 02H
       0004                     DPB_DWT     EQU 04H
       0006                     DPB_FATID   EQU 06H
       0007                     DPB_SECPCL  EQU 07H
       0008                     DPB_MAXCL   EQU 08H
       000A                     DPB_FDMODE  EQU 0AH
       000B                     DPB_DIRSCNT EQU 0BH
       000C                     DPB_MAXCYL  EQU 0CH
       000D                     DPB_MAXSEC  EQU 0DH
       000E                     DPB_FATPS   EQU 0EH
       000F                     DPB_BPS     EQU 0FH
       0010                     DPB_DIRPS   EQU 10H
       0012                     DPB_DEVICE  EQU 12H
       0013                     DPB_UNITNO  EQU 13H
       0014                     DPB_ADDCL   EQU 14H
                                
       001A                     DPB_SDIR    EQU 1AH
       001C                     DPB_NAME    EQU 1CH
                                
[EOF:LDDEF.ASM:SHIFT_JIS]
000000 4000                         ORG RUN
                                
                                ; MSX ROM header
000000 4000 4142                    DB  "AB"   ; ID for auto-executable ROM
000002 4002 6E40                    DW  INIT_ROM   ; Main program execution address.
000004 4004 0000                    DW  0      ; STATEMENT
000006 4006 0000                    DW  0      ; DEVICE
000008 4008 0000                    DW  0      ; TEXT
00000A 400A 000000000000            DW  0,0,0  ; Reserved
                                    INCLUDE "MSXINIT.ASM"
                                
                                ;   LSX-Dodgers INIT
                                ;   MSX
       4010                     INIT_FDD_BOOT:
000010 4010 F3               4      DI
000011 4011 ED56             8      IM  1
000013 4013 3A42F3          13      LD  A,(RAMAD1)
000016 4016 2640             7      LD  H,040H
000018 4018 CD2400          17      CALL    _ENASLT
00001B 401B 21DF80          10      LD  HL,AT_START2+04000H
00001E 401E 1100C7          10      LD  DE,START2
000021 4021 010021          10      LD  BC,MSX_E-START2
000024 4024 EDB0                    LDIR
000026 4026 2180E7          10      LD  HL,_DEVICE+4*32     ;E
000029 4029 1100E7          10      LD  DE,_DEVICE      ;A
00002C 402C 018000          10      LD  BC,32*4
00002F 402F EDB0                    LDIR
000031 4031 21DFE7          10      LD  HL,_DEVICE+6*32+DPB_NAME+3
000034 4034 3E07             7      LD  A,7
       4036                     FDD_INIT1:
000036 4036 C62F             7      ADD A,'0'-1
000038 4038 77               7      LD  (HL),A
000039 4039 11F4FF          10      LD  DE,DPB_UNITNO-(DPB_NAME+3)
00003C 403C 19              11      ADD HL,DE
00003D 403D D630             7      SUB '0'
00003F 403F 77               7      LD  (HL),A
000040 4040 11ECFF          10      LD  DE,-DPB_UNITNO-1
000043 4043 19              11      ADD HL,DE       ;ここでZフラグは変化しない
000044 4044 20F0            12      JR  NZ,FDD_INIT1
000046 4046 211040          10      LD  HL,INIT_FDD_BOOT
                                
000049 4049 CD11C8          17      CALL    SET_BDOS
00004C 404C 21E9C7          10      LD  HL,ROMCHECKED
00004F 404F 2204C7          16      LD  (INIT_SWC),HL
000052 4052 C300C7          10      JP  START2
                                
       4055                     START:
000055 4055 F3               4      DI
000056 4056 ED56             8      IM  1
000058 4058 AF               4      XOR A               ;A=0
000059 4059 320060          13      LD  (BANK0_SEL),A           ;似非RAM対策でバンク0を設定
00005C 405C 3C               4      INC A               ;A=1
00005D 405D 320068          13      LD  (BANK1_SEL),A
000060 4060 21DF40          10      LD  HL,AT_START2
000063 4063 1100C7          10      LD  DE,START2
000066 4066 010021          10      LD  BC,MSX_E-START2
000069 4069 EDB0                    LDIR
00006B 406B C300C7          10      JP  START2
                                
       406E                     INIT_ROM:
00006E 406E 3E                      DB  03EH    ;LD A,??
00006F 406F F7              12      RST 30H
000070 4070 F3               4      DI
000071 4071 32DAFE          13      LD  (H_STKE),A
000074 4074 CDBB40          17      CALL    GTSL1_
000077 4077 21DBFE          10      LD  HL,H_STKE+1
00007A 407A 77               7      LD  (HL),A
00007B 407B 115540          10      LD  DE,START
00007E 407E 23               6      INC HL
00007F 407F 73               7      LD  (HL),E
000080 4080 23               6      INC HL
000081 4081 72               7      LD  (HL),D
                                
000082 4082 CD3801          17      CALL    RSLREG      ;read primary slot #
000085 4085 07               4      RLCA
000086 4086 07               4      RLCA
000087 4087 F5              11      PUSH    AF
000088 4088 1605             7      LD  D,4+1
00008A 408A CDC240          17      CALL    GTSL2_
00008D 408D 3244F3          13      LD  (RAMAD3),A
000090 4090 3A42F3          13      LD  A,(RAMAD1)
000093 4093 CDAD40          17      CALL    FIXRAMAD
000096 4096 3242F3          13      LD  (RAMAD1),A
000099 4099 3A41F3          13      LD  A,(RAMAD0)
00009C 409C CDAD40          17      CALL    FIXRAMAD
00009F 409F 3241F3          13      LD  (RAMAD0),A
0000A2 40A2 F1              10      POP AF
0000A3 40A3 1603             7      LD  D,2+1
0000A5 40A5 CDC240          17      CALL    GTSL2_
0000A8 40A8 3243F3          13      LD  (RAMAD2),A
                                
0000AB 40AB FB               4      EI
0000AC 40AC C9              10      RET
                                
       40AD                     FIXRAMAD:
0000AD 40AD B7               4      OR  A
0000AE 40AE 2807            12      JR  Z,FIXRAMAD1
0000B0 40B0 FEC9             7      CP  0C9H
0000B2 40B2 2803            12      JR  Z,FIXRAMAD1
0000B4 40B4 FEFF             7      CP  0FFH
0000B6 40B6 C0              11      RET NZ
       40B7                     FIXRAMAD1:
0000B7 40B7 3A44F3          13      LD  A,(RAMAD3)
0000BA 40BA C9              10      RET
                                
       40BB                     GTSL1_:             ;自分のいるスロットを知る
0000BB 40BB CD3801          17      CALL    RSLREG      ;read primary slot #
0000BE 40BE 0F               4      RRCA
0000BF 40BF 0F               4      RRCA
0000C0 40C0 1601             7      LD  D,1
       40C2                     GTSL2_:
0000C2 40C2 E603             7      AND 3       ;[A]=000000PP
0000C4 40C4 5F               4      LD  E,A     ;[E]=000000PP
0000C5 40C5 21C1FC          10      LD  HL,EXPTBL
0000C8 40C8 85               4      ADD A,L     ;桁上りは無い
0000C9 40C9 6F               4      LD  L,A     ;[HL]=EXPTBL+000000PP
0000CA 40CA 7B               4      LD  A,E     ;[A]=000000PP
0000CB 40CB CB7E            13      BIT 7,(HL)
0000CD 40CD C8              11      RET Z
0000CE 40CE 7D               4      LD  A,L     ;point to SLTTBL entry
0000CF 40CF C604             7      ADD A,4     ;桁上りは無い
0000D1 40D1 6F               4      LD  L,A
0000D2 40D2 7E               7      LD  A,(HL)      ;get currently expansion slot register
       40D3                     GTSL3_:
0000D3 40D3 15               4      DEC D
0000D4 40D4 2803            12      JR  Z,GTSL4_:
0000D6 40D6 0F               4      RRCA
0000D7 40D7 18FA            12      JR  GTSL3_:
       40D9                     GTSL4_:
0000D9 40D9 E60C             7      AND 00CH        ;[A] = 0000SS00
0000DB 40DB B3               4      OR  E       ;[A] = 0000SSPP
0000DC 40DC F680             7      OR  080H        ;[A] = 1000SSPP
0000DE 40DE C9              10      RET
                                
       40DF                     AT_START2:
0000DF C700                         ORG START2,AT_START2-RUN
                                
0000DF C700 3100C7          10      LD  SP,START2
0000E2 C703 CD11C7          17      CALL    INIT        ;NZならAUTOEXECを実行
       C704                     INIT_SWC    EQU $-2
0000E5 C706 210000          10      LD  HL,0
0000E8 C709 E5              11      PUSH    HL
0000E9 C70A C8              11      RET Z
0000EA C70B 1106C9          10      LD  DE,AUTOD
0000ED C70E C3FDE5          10      JP  _COMANL
                                
       C711                     INIT:
0000F0 C711 DD21900D        14      LD  IX,0D90H
0000F4 C715 0600             7      LD  B,0
       C717                     CHECK_CBIOS1:
0000F6 C717 DD7E00          19      LD  A,(IX+0)
0000F9 C71A FE43             7      CP  'C'
0000FB C71C 202B            12      JR  NZ,CHECK_CBIOS2
0000FD C71E DD7E01          19      LD  A,(IX+1)
000100 C721 FE2D             7      CP  '-'
000102 C723 2024            12      JR  NZ,CHECK_CBIOS2
000104 C725 DD7E02          19      LD  A,(IX+2)
000107 C728 FE42             7      CP  'B'
000109 C72A 201D            12      JR  NZ,CHECK_CBIOS2
00010B C72C DD7E03          19      LD  A,(IX+3)
00010E C72F FE49             7      CP  'I'
000110 C731 2016            12      JR  NZ,CHECK_CBIOS2
000112 C733 DD7E04          19      LD  A,(IX+4)
000115 C736 FE4F             7      CP  'O'
000117 C738 200F            12      JR  NZ,CHECK_CBIOS2
000119 C73A DD7E05          19      LD  A,(IX+5)
00011C C73D EE53             7      XOR 'S'
00011E C73F 2008            12      JR  NZ,CHECK_CBIOS2
                                
000120 C741 3293D1          13      LD  (CBIOS_SWC1),A
000123 C744 32B7D1          13      LD  (CBIOS_SWC2),A
                                
000126 C747 1804            12      JR  CHECK_CBIOS3
       C749                     CHECK_CBIOS2:
000128 C749 DD23            10      INC IX
00012A C74B 10CA            13      DJNZ    CHECK_CBIOS1
       C74D                     CHECK_CBIOS3:
00012C C74D 3ADBFE          13      LD  A,(H_STKE+1)
00012F C750 3262E5          13      LD  (ROM_SLT),A
                                
       C753                     RAMCHK2:
000132 C753 3A42F3          13      LD  A,(RAMAD1)
000135 C756 2640             7      LD  H,040H
000137 C758 CD6AC8          17      CALL    CHK_RAM
00013A C75B 3242F3          13      LD  (RAMAD1),A
       C75E                     RAMCHK1:
00013D C75E 3A41F3          13      LD  A,(RAMAD0)
000140 C761 2600             7      LD  H,00H
000142 C763 CD6AC8          17      CALL    CHK_RAM
000145 C766 3241F3          13      LD  (RAMAD0),A
       C769                     RAMCHK0:
000148 C769 3A42F3          13      LD  A,(RAMAD1)
00014B C76C 2640             7      LD  H,040H
00014D C76E CDE2D4          17      CALL    ENASLT
                                
000150 C771 3A41F3          13      LD  A,(RAMAD0)
000153 C774 2600             7      LD  H,000H
000155 C776 CDE2D4          17      CALL    ENASLT
                                
000158 C779 210000          10      LD  HL,0
00015B C77C 065C             7      LD  B,05CH
00015D C77E 3E                      DB  03EH    ;LD A,??
00015E C77F EF              12      RST 28H
00015F C780 CD7BD6          17      CALL    FILL_MEMORY
000162 C783 06A4             7      LD  B,0A4H
000164 C785 AF               4      XOR A
000165 C786 320400          13      LD  (_DVSW),A
000168 C789 CD7BD6          17      CALL    FILL_MEMORY
                                
00016B C78C CD11C8          17      CALL    SET_BDOS
                                
                                                ;LSX-Dodgers
00016E C78F 3EE5             7      LD  A,CPM_BOOT/256
000170 C791 320B00          13      LD  (0000BH),A
                                
                                                ;MSXワークエリア
000173 C794 3E03             7      LD  A,3
000175 C796 329BFC          13      LD  (INTFLG),A
                                
                                                ;ROMタイプ判別(ASCII-8K/ASCII-16K)
000178 C799 1E00             7      LD  E,0
00017A C79B 3A62E5          13      LD  A,(ROM_SLT)
00017D C79E 210068          10      LD  HL,BANK1_SEL
000180 C7A1 CD6FD4          17      CALL    WRSLT
                                
000183 C7A4 210060          10      LD  HL,06000H
000186 C7A7 3A62E5          13      LD  A,(ROM_SLT)
000189 C7AA CD2ED4          17      CALL    RDSLT
00018C C7AD FE41             7      CP  'A'
00018E C7AF 280F            12      JR  Z,ROM8K
                                                ;ASCII-8K/Konami-8Kではない(ASCII-16K)
000190 C7B1 3E                      DB  03EH    ;LD A,??
000191 C7B2 00               4      NOP
000192 C7B3 3249E3          13      LD  (ASCII16K1),A
000195 C7B6 324DE3          13      LD  (ASCII16K2),A
000198 C7B9 3E3F             7      LD  A,03FH
00019A C7BB 3265E3          13      LD  (ASCII16K3),A
00019D C7BE 1829            12      JR  ROMCHECKED
       C7C0                     ROM8K:              ;Konami-8Kチェック
00019F C7C0 1E01             7      LD  E,1
0001A1 C7C2 3A62E5          13      LD  A,(ROM_SLT)
0001A4 C7C5 210070          10      LD  HL,BANK2_SEL
0001A7 C7C8 CD6FD4          17      CALL    WRSLT
                                
0001AA C7CB 1E00             7      LD  E,0
0001AC C7CD 3A62E5          13      LD  A,(ROM_SLT)
0001AF C7D0 210080          10      LD  HL,KONAMI_BANK2_SEL
0001B2 C7D3 CD6FD4          17      CALL    WRSLT
                                
0001B5 C7D6 210080          10      LD  HL,08000H
0001B8 C7D9 3A62E5          13      LD  A,(ROM_SLT)
0001BB C7DC CD2ED4          17      CALL    RDSLT
0001BE C7DF FE41             7      CP  'A'
0001C0 C7E1 2006            12      JR  NZ,ROMCHECKED
                                                ;Konami-8K
0001C2 C7E3 210080          10      LD  HL,KONAMI_BANK2_SEL
0001C5 C7E6 2254E3          16      LD  (ROM8000H),HL
       C7E9                     ROMCHECKED:
                                                ;MSX2判別
0001C8 C7E9 3AF8FA          13      LD  A,(EXBRSA)
0001CB C7EC B7               4      OR  A
0001CC C7ED 3E28             7      LD  A,40
0001CE C7EF 2802            12      JR  Z,ISMSX1
0001D0 C7F1 3E50             7      LD  A,80        ;MSX2以降は80桁で起動
       C7F3                     ISMSX1:
0001D2 C7F3 32AEF3          13      LD  (LINL40),A
0001D5 C7F6 32B1E5          13      LD  (_WIDTH),A
0001D8 C7F9 DD216C00        14      LD  IX,INITXT
0001DC C7FD CD88D3          17      CALL    CALSLT_R
0001DF C800 DD217800        14      LD  IX,SETTXT
0001E3 C804 CD88D3          17      CALL    CALSLT_R
                                
0001E6 C807 2112C9          10      LD  HL,INIMES
0001E9 C80A CD82CE          17      CALL    MSX
       C80D                     INIT1:
0001EC C80D AF               4      XOR A
0001ED C80E FE03             7      CP  3
0001EF C810 C9              10      RET
       C811                     SET_BDOS:
0001F0 C811 3E                      DB  03EH    ;LD A,??
0001F1 C812 E9               4      JP  (HL)
0001F2 C813 320F00          13      LD  (0000FH),A
                                
0001F5 C816 3EC3             7      LD  A,0C3H      ;JP
0001F7 C818 2103E5          10      LD  HL,CPM_WBOOT
0001FA C81B 320000          13      LD  (00000H),A
0001FD C81E 220100          16      LD  (00001H),HL ;IPL
                                
000200 C821 2106CA          10      LD  HL,BDOS
000203 C824 320500          13      LD  (00005H),A
000206 C827 220600          16      LD  (00006H),HL ;BDOS
                                
000209 C82A 210000          10      LD  HL,0
00020C C82D 322800          13      LD  (00028H),A
00020F C830 222900          16      LD  (00029H),HL ;BDOS
                                                ;インタースロットコール
000212 C833 21E2D3          10      LD  HL,RDSLTR
000215 C836 320C00          13      LD  (_RDSLT),A
000218 C839 220D00          16      LD  (_RDSLT+1),HL
                                
00021B C83C 21EBD3          10      LD  HL,WRSLTR
00021E C83F 321400          13      LD  (_WRSLT),A
000221 C842 221500          16      LD  (_WRSLT+1),HL
                                
000224 C845 21A4D3          10      LD  HL,CALSLTR
000227 C848 321C00          13      LD  (_CALSLT),A
00022A C84B 221D00          16      LD  (_CALSLT+1),HL
                                
00022D C84E 21E2D4          10      LD  HL,ENASLT
000230 C851 322400          13      LD  (_ENASLT),A
000233 C854 222500          16      LD  (_ENASLT+1),HL
                                
000236 C857 2194D3          10      LD  HL,CALLF
000239 C85A 323000          13      LD  (_CALLF),A
00023C C85D 223100          16      LD  (_CALLF+1),HL
                                
00023F C860 21F4D3          10      LD  HL,INT38H
000242 C863 323800          13      LD  (00038H),A
000245 C866 223900          16      LD  (00038H+1),HL
000248 C869 C9              10      RET
       C86A                     CHK_RAM:
000249 C86A E5              11      PUSH    HL
00024A C86B CDBFC8          17      CALL    CHK_RAM0
00024D C86E E1              10      POP HL
00024E C86F C8              11      RET Z
00024F C870 3AC1FC          13      LD  A,(EXPTBL)      ;スロット#0
000252 C873 E680             7      AND 080H
000254 C875 CD96C8          17      CALL    CHK_RAM_SLT
000257 C878 C8              11      RET Z
000258 C879 3AC2FC          13      LD  A,(EXPTBL+1)        ;スロット#1
00025B C87C E680             7      AND 080H
00025D C87E C601             7      ADD A,1
00025F C880 CD96C8          17      CALL    CHK_RAM_SLT
000262 C883 C8              11      RET Z
000263 C884 3AC3FC          13      LD  A,(EXPTBL+2)        ;スロット#2
000266 C887 E680             7      AND 080H
000268 C889 C602             7      ADD A,2
00026A C88B CD96C8          17      CALL    CHK_RAM_SLT
00026D C88E C8              11      RET Z
00026E C88F 3AC4FC          13      LD  A,(EXPTBL+3)        ;スロット#3
000271 C892 E680             7      AND 080H
000273 C894 C603             7      ADD A,3
       C896                     CHK_RAM_SLT:
000275 C896 E5              11      PUSH    HL
000276 C897 CDBFC8          17      CALL    CHK_RAM0        ;スロット#X or X-0
000279 C89A E1              10      POP HL
00027A C89B C8              11      RET Z
00027B C89C CB79             8      BIT 7,C
00027D C89E 281A            12      JR  Z,CHK_RAM_E     ;スロットは拡張されていない
00027F C8A0 79               4      LD  A,C
000280 C8A1 C604             7      ADD A,4*1           ;スロット#X-1
000282 C8A3 E5              11      PUSH    HL
000283 C8A4 CDBFC8          17      CALL    CHK_RAM0
000286 C8A7 E1              10      POP HL
000287 C8A8 C8              11      RET Z
000288 C8A9 79               4      LD  A,C
000289 C8AA C608             7      ADD A,4*2           ;スロット#X-2
00028B C8AC E5              11      PUSH    HL
00028C C8AD CDBFC8          17      CALL    CHK_RAM0
00028F C8B0 E1              10      POP HL
000290 C8B1 C8              11      RET Z
000291 C8B2 79               4      LD  A,C
000292 C8B3 C60C             7      ADD A,4*3           ;スロット#X-3
000294 C8B5 E5              11      PUSH    HL
000295 C8B6 CDBFC8          17      CALL    CHK_RAM0
000298 C8B9 E1              10      POP HL
       C8BA                     CHK_RAM_E:
000299 C8BA AF               4      XOR A
00029A C8BB 3C               4      INC A           ;ZF=0にする
00029B C8BC 3E00             7      LD  A,0
00029D C8BE C9              10      RET
                                
       C8BF                     CHK_RAM0:
00029E C8BF 4F               4      LD  C,A
00029F C8C0 3A62E5          13      LD  A,(ROM_SLT)
0002A2 C8C3 B9               4      CP  C
0002A3 C8C4 28F4            12      JR  Z,CHK_RAM_E
0002A5 C8C6 2E00             7      LD  L,0
       C8C8                     CHK_RAM1:
0002A7 C8C8 79               4      LD  A,C
0002A8 C8C9 DD210C00        14      LD  IX,_RDSLT
0002AC C8CD CDFAC8          17      CALL    CALSLT_RAM
0002AF C8D0 C6E5             7      ADD A,0E5H
0002B1 C8D2 47               4      LD  B,A
0002B2 C8D3 5F               4      LD  E,A
0002B3 C8D4 79               4      LD  A,C
0002B4 C8D5 DD211400        14      LD  IX,_WRSLT
0002B8 C8D9 CDFAC8          17      CALL    CALSLT_RAM
0002BB C8DC 79               4      LD  A,C
0002BC C8DD DD210C00        14      LD  IX,_RDSLT
0002C0 C8E1 CDFAC8          17      CALL    CALSLT_RAM
0002C3 C8E4 B8               4      CP  B
0002C4 C8E5 C0              11      RET NZ
0002C5 C8E6 D6E5             7      SUB 0E5H
0002C7 C8E8 79               4      LD  A,C
0002C8 C8E9 5F               4      LD  E,A
0002C9 C8EA DD211400        14      LD  IX,_WRSLT
0002CD C8EE CDFAC8          17      CALL    CALSLT_RAM
0002D0 C8F1 24               4      INC H
0002D1 C8F2 7D               4      LD  A,L
0002D2 C8F3 C604             7      ADD A,4
0002D4 C8F5 6F               4      LD  L,A
0002D5 C8F6 20D0            12      JR  NZ,CHK_RAM1
0002D7 C8F8 79               4      LD  A,C     ;ZF=1のハズ
0002D8 C8F9 C9              10      RET
                                
       C8FA                     CALSLT_RAM:
0002D9 C8FA C5              11      PUSH    BC
0002DA C8FB E5              11      PUSH    HL
0002DB C8FC FD2AC0FC        20      LD  IY,(EXPTBL-1) ;メインROMスロット
0002DF C900 CD1C00          17      CALL    _CALSLT
0002E2 C903 E1              10      POP HL
0002E3 C904 C1              10      POP BC
0002E4 C905 C9              10      RET
                                
0002E5 C906 4155544F45584543    AUTOD:  DB  "AUTOEXEC "
            20                  
0002EE C90F 413A00              AUTODV: DB  "A:",0
                                
0002F1 C912 0C4C53582D446F64    INIMES: DB  00CH,"LSX-Dodgers for MSX v"
            6765727320666F72    
            204D53582076        
000307 C928 312E                    DB  030H + VER_1, '.'
000309 C92A 3631                    DB  030H + VER_2 ,030H + VER_3
00030B C92C 66                      DB  'f'
00030C C92D 2047616B750D0A          DB  " Gaku",0DH,0AH
000313 C934 00                      DB  0
                                
000314 C935 0300                M2DD:   DW  3
000316 C937 F902                    DB  0F9H,2
000318 C939 CB02                    DW  715
00031A C93B FF0750090182            DB  0FFH,7,80,9,1,082H
000320 C941 0700A7000A00            DW  7,0A7H,10
       C947                     M2DDE:
[EOF:MSXINIT.ASM:SHIFT_JIS]
                                    INCLUDE "MSXCCP.ASM"
                                
                                ;   LSX-Dodgers CCP
                                ;   MSX
                                
       C947                     INITE:
000326 C947                         DS  BDOS-INITE
0003E5 CA06 C342CE          10      JP  BDOS0
       CA09                     S27BUF_COM:
0003E8 CA09 110001          10      LD  DE,BUF_COM
0003EB CA0C CD46D0          17      CALL    _SYS1A      ;(BDOS)DTAの設定
0003EE CA0F 2100FE          10      LD  HL,0-BUF_COM-00100H ;バッファー+スタック予備(0100H)
0003F1 CA12 C3E7CA          10      JP  S27BUF2
       CA15                     WBOOT1:
0003F4 CA15 ED7B0600        20      LD  SP,(SYSTEM+1)
0003F8 CA19 3E03             7      LD  A,3
0003FA CA1B CD15D1          17      CALL    MSG_A
       CA1E                     WBOOT2:
[EOF:MSXCCP.ASM:UTF_8]
                                    INCLUDE "LDCCP.ASM"
                                
                                ;   LSX-Dodgers CCP
                                
       CA1E                     COMMAND:
0003FD CA1E 3AA3E4          13      LD  A,(FCB_BAT)
000400 CA21 B7               4      OR  A
000401 CA22 C260CB          10      JP  NZ,C_BAT1
000404 CA25 CDD4CA          17      CALL    SETDTA1
000407 CA28 3A0400          13      LD  A,(_DVSW)
00040A CA2B C641             7      ADD A,'A'
00040C CA2D CD15D1          17      CALL    MSG_A
00040F CA30 3E3E             7      LD  A,'>'
000411 CA32 CD15D1          17      CALL    MSG_A
000414 CA35 3E50             7      LD  A,80
000416 CA37 12               7      LD  (DE),A
000417 CA38 CDD5D1          17      CALL    _SYS0A      ;(BDOS)文字列入力
00041A CA3B CD55CC          17      CALL    LTNL
       CA3E                     COMMAND2:
00041D CA3E 118200          10      LD  DE,DTA1+2
000420 CA41 CDFDE5          17      CALL    _COMANL
000423 CA44 DC06D1          17      CALL    C,SHOW_ERROR
000426 CA47 18D5            12      JR  COMMAND
                                
       CA49                     COMANL:
000428 CA49 CDD0D5          17      CALL    FILE
00042B CA4C 3A19E5          13      LD  A,(FNAME+4)
00042E CA4F FE20             7      CP  020H
000430 CA51 201C            12      JR  NZ,COMB2
000432 CA53 D5              11      PUSH    DE
000433 CA54 1115E5          10      LD  DE,FNAME
000436 CA57 1A               7      LD  A,(DE)
000437 CA58 FE20             7      CP  020H
000439 CA5A 2844            12      JR  Z,SDVSW
00043B CA5C 1B               6      DEC DE
00043C CA5D 1A               7      LD  A,(DE)
00043D CA5E C6FF             7      ADD A,0FFH
00043F CA60 3809            12      JR  C,COMB
000441 CA62 13               6      INC DE
                                
000442 CA63 2112CE          10      LD  HL,COMTB
000445 CA66 0608             7      LD  B,COMS
000447 CA68 CD5DD8          17      CALL    CPNAME
       CA6B                     COMB:
00044A CA6B D1              10      POP DE
00044B CA6C D205D1          10      JP  NC,JPHL
       CA6F                     COMB2:
00044E CA6F EB               4      EX  DE,HL
00044F CA70 223DCB          16      LD  (COMSWC),HL
000452 CA73 F5              11      PUSH    AF
000453 CA74 CDF5CA          17      CALL    CEXE4
000456 CA77 F1              10      POP AF
000457 CA78 2115E5          10      LD  HL,FNAME
00045A CA7B 116D00          10      LD  DE,FCB2FN   ;COMMAND NAME
00045D CA7E 010B00          10      LD  BC,11
000460 CA81 EDB0                    LDIR
000462 CA83 1142E4          10      LD  DE,PATHD
       CA86                     CEX1:
000465 CA86 1A               7      LD  A,(DE)
000466 CA87 FE20             7      CP  020H
000468 CA89 D8              11      RET C
000469 CA8A CDC5D5          17      CALL    FILEC
00046C CA8D D5              11      PUSH    DE
00046D CA8E 216D00          10      LD  HL,FCB2FN   ;COMMAND NAME
000470 CA91 1115E5          10      LD  DE,FNAME
000473 CA94 010B00          10      LD  BC,11
000476 CA97 EDB0                    LDIR
000478 CA99 CDF5CA          17      CALL    CEXE4
00047B CA9C D1              10      POP DE
00047C CA9D 13               6      INC DE
00047D CA9E 18E6            12      JR  CEX1
                                
       CAA0                     SDVSW:
00047F CAA0 F1              10      POP AF
000480 CAA1 3A14E5          13      LD  A,(FDRV)
000483 CAA4 3D               4      DEC A
000484 CAA5 5F               4      LD  E,A
000485 CAA6 0E0E             7      LD  C,00EH      ;(BDOS)カレントドライブの設定
000487 CAA8 1831            12      JR  SYSTEM0
                                
       CAAA                     OPEN1:
000489 CAAA 2114E5          10      LD  HL,FDRV
       CAAD                     OPEN:
00048C CAAD 0E11             7      LD  C,011H      ;(BDOS)ファイルの検索
       CAAF                     OPEN3:
00048E CAAF D5              11      PUSH    DE
00048F CAB0 117EE4          10      LD  DE,DTA_CCP
000492 CAB3 CDD1CA          17      CALL    SETDTA
000495 CAB6 EB               4      EX  DE,HL
000496 CAB7 CDDBCA          17      CALL    SYSTEM0
000499 CABA D1              10      POP DE
00049A CABB C9              10      RET
                                
       CABC                     OPEN2:
00049B CABC 0E12             7      LD  C,012H
00049D CABE 18EF            12      JR  OPEN3
                                
       CAC0                     DEFCB:              ;Z=Ok NZ=Error
00049F CAC0 117EE4          10      LD  DE,DTA_CCP
0004A2 CAC3 CDD9CA          17      CALL    SYSC0F
                                
0004A5 CAC6 119FE4          10      LD  DE,DTA_CCP+33   ;(FCB)ランダムレコード
0004A8 CAC9 0604             7      LD  B,4
0004AA CACB CD26CD          17      CALL    ZERO_MEMORY_DE
       CACE                     SETDTA100:
0004AD CACE 110080          10      LD  DE,BUFFER
       CAD1                     SETDTA:
0004B0 CAD1 C346D0          10      JP  _SYS1A      ;(BDOS)DTAの設定
                                
       CAD4                     SETDTA1:
0004B3 CAD4 118000          10      LD  DE,DTA1
0004B6 CAD7 18F8            12      JR  SETDTA
                                
       CAD9                     SYSC0F:
0004B8 CAD9 0E0F             7      LD  C,00FH      ;(BDOS)ファイルのオープン
       CADB                     SYSTEM0:
0004BA CADB CD0500          17      CALL    SYSTEM
0004BD CADE B7               4      OR  A
0004BE CADF C9              10      RET
                                
       CAE0                     C_CD:
0004BF CAE0 0E5A             7      LD  C,05AH
0004C1 CAE2 18F7            12      JR  SYSTEM0
                                
       CAE4                     S27BUF:
0004C3 CAE4 21007F          10      LD  HL,0-BUFFER-00100H  ;バッファー+スタック予備(0100H)
       CAE7                     S27BUF2:
0004C6 CAE7 39              11      ADD HL,SP
0004C7 CAE8 2E00             7      LD  L,0
0004C9 CAEA 7C               4      LD  A,H
0004CA CAEB E6F8             7      AND 0F8H
0004CC CAED 67               4      LD  H,A
       CAEE                     S27DTA:
0004CD CAEE 117EE4          10      LD  DE,DTA_CCP
       CAF1                     S27:
0004D0 CAF1 0E27             7      LD  C,027H      ;(BDOS)ランダムブロック読み込み
0004D2 CAF3 18E6            12      JR  SYSTEM0
                                
       CAF5                     CEXE4:
0004D4 CAF5 211DE5          10      LD  HL,FNAME+8
0004D7 CAF8 7E               7      LD  A,(HL)
0004D8 CAF9 FE20             7      CP  020H
0004DA CAFB 2007            12      JR  NZ,CEXE7
0004DC CAFD 3E3F             7      LD  A,'?'
0004DE CAFF 77               7      LD  (HL),A
0004DF CB00 23               6      INC HL
0004E0 CB01 77               7      LD  (HL),A
0004E1 CB02 23               6      INC HL
0004E2 CB03 77               7      LD  (HL),A
       CB04                     CEXE7:
0004E3 CB04 CDAACA          17      CALL    OPEN1
       CB07                     CEXE5:
0004E6 CB07 C0              11      RET NZ
0004E7 CB08 2A88E4          16      LD  HL,(DTA_CCP+1+9)
0004EA CB0B 7C               4      LD  A,H
0004EB CB0C CDECD8          17      CALL    CAP
0004EE CB0F 67               4      LD  H,A
0004EF CB10 7D               4      LD  A,L
0004F0 CB11 CDECD8          17      CALL    CAP
0004F3 CB14 6F               4      LD  L,A
0004F4 CB15 3A87E4          13      LD  A,(DTA_CCP+1+8)
0004F7 CB18 CDECD8          17      CALL    CAP
0004FA CB1B D642             7      SUB 'B'
0004FC CB1D 282C            12      JR  Z,C_BAT
0004FE CB1F 3D               4      DEC A       ;'C'
0004FF CB20 2805            12      JR  Z,C_EXE
       CB22                     CEXE6:
000501 CB22 CDBCCA          17      CALL    OPEN2
000504 CB25 18E0            12      JR  CEXE5
                                
       CB27                     C_EXE:
000506 CB27 7C               4      LD  A,H
000507 CB28 FE4D             7      CP  'M'
000509 CB2A 20F6            12      JR  NZ,CEXE6
                                
00050B CB2C CDC0CA          17      CALL    DEFCB
00050E CB2F CD09CA          17      CALL    S27BUF_COM
000511 CB32 3D               4      DEC A
000512 CB33 37               4      SCF
000513 CB34 C0              11      RET NZ
000514 CB35 7C               4      LD  A,H
000515 CB36 B5               4      OR  L
000516 CB37 37               4      SCF
000517 CB38 C8              11      RET Z
000518 CB39 CDD4CA          17      CALL    SETDTA1
00051B CB3C 110000          10      LD  DE,0                ; self-modifying code
       CB3D                     COMSWC  EQU $-2
00051E CB3F ED7B0600        20      LD  SP,(SYSTEM+1)
000522 CB43 67               4      LD  H,A             ; A=0 in SETDTA1(_SYS1A)
000523 CB44 6F               4      LD  L,A
000524 CB45 E5              11      PUSH    HL              ; push $0000 (reboot address)
000525 CB46 24               4      INC H
000526 CB47 E5              11      PUSH    HL              ; push $0100 (TPA address)
000527 CB48 C3F1CC          10      JP  SETFCB              ; and JP $0100
                                
       CB4B                     C_BAT:
00052A CB4B 114154          10      LD  DE,'A'+'T'*256
00052D CB4E ED52            15      SBC HL,DE
00052F CB50 20D0            12      JR  NZ,CEXE6
                                
000531 CB52 CDC0CA          17      CALL    DEFCB
                                
000534 CB55 217EE4          10      LD  HL,DTA_CCP
000537 CB58 11A3E4          10      LD  DE,FCB_BAT
00053A CB5B 012500          10      LD  BC,37
00053D CB5E EDB0                    LDIR
       CB60                     C_BAT1:
00053F CB60 CDCECA          17      CALL    SETDTA100
000542 CB63 CD97CB          17      CALL    FGETC_BAT
000545 CB66 218100          10      LD  HL,DTA1+1
000548 CB69 2025            12      JR  NZ,END_BATCH
00054A CB6B FE21             7      CP  021H        ;スペースや改行など制御文字を飛ばす
00054C CB6D 38F1            12      JR  C,C_BAT1
00054E CB6F 3620            10      LD  (HL),' '
000550 CB71 23               6      INC HL
       CB72                     C_BAT2:
000551 CB72 77               7      LD  (HL),A
000552 CB73 23               6      INC HL
000553 CB74 7D               4      LD  A,L
000554 CB75 3C               4      INC A       ;L==0FFH
000555 CB76 2809            12      JR  Z,RUN_BATCH
000557 CB78 CD97CB          17      CALL    FGETC_BAT
00055A CB7B 2004            12      JR  NZ,RUN_BATCH
00055C CB7D FE20             7      CP  020H
00055E CB7F 30F1            12      JR  NC,C_BAT2
       CB81                     RUN_BATCH:
000560 CB81 7D               4      LD  A,L
000561 CB82 D67F             7      SUB DTA1-1
000563 CB84 328000          13      LD  (DTA1),A
000566 CB87 FE04             7      CP  4
000568 CB89 3805            12      JR  C,END_BATCH
00056A CB8B 3600            10      LD  (HL),0
00056C CB8D C33ECA          10      JP  COMMAND2
       CB90                     END_BATCH:
00056F CB90 AF               4      XOR A       ;バッチファイルを閉じる
000570 CB91 32A3E4          13      LD  (FCB_BAT),A
000573 CB94 C300E5          10      JP  CPM_BOOT
                                
       CB97                     FGETC_BAT:
000576 CB97 11A3E4          10      LD  DE,FCB_BAT
       CB9A                     FGETC:              ;1文字ずつ読み込む
000579 CB9A E5              11      PUSH    HL      ;Z:成功
00057A CB9B 210100          10      LD  HL,1
00057D CB9E CDF1CA          17      CALL    S27
000580 CBA1 E1              10      POP HL
000581 CBA2 3A0080          13      LD  A,(BUFFER)
000584 CBA5 C9              10      RET
                                
       CBA6                     C_DEL:
000585 CBA6 CDF1CC          17      CALL    SETFCB
000588 CBA9 CD51D1          17      CALL    _SYS08      ;(BDOS)エコーなしコンソール入力
                                
00058B CBAC 0E13             7      LD  C,013H
00058D CBAE 180A            12      JR  CDEL1       ;(BDOS)ファイルの削除
                                
       CBB0                     C_REN:
00058F CBB0 CDF1CC          17      CALL    SETFCB
000592 CBB3 3E10             7      LD  A,010H      ;ディレクトリも対象にする
000594 CBB5 326900          13      LD  (FCB1+13),A ;属性
000597 CBB8 0E17             7      LD  C,017H      ;(BDOS)ファイル名の変更
       CBBA                     CDEL1:
000599 CBBA 115C00          10      LD  DE,FCB1
00059C CBBD CD0500          17      CALL    SYSTEM
00059F CBC0 C6FF             7      ADD A,0FFH
0005A1 CBC2 C9              10      RET
                                
       CBC3                     C_DIR:
0005A2 CBC3 CDC5D5          17      CALL    FILEC
0005A5 CBC6 2115E5          10      LD  HL,FDRV+1
0005A8 CBC9 CD07CE          17      CALL    CWILD1
0005AB CBCC 3EF1             7      LD  A,0F1H
0005AD CBCE 3221E5          13      LD  (FDRV+13),A
0005B0 CBD1 CDAACA          17      CALL    OPEN1
       CBD4                     CDIR1:
0005B3 CBD4 B7               4      OR  A
0005B4 CBD5 2008            12      JR  NZ,PDSKF
0005B6 CBD7 CD22CC          17      CALL    P_NAME
0005B9 CBDA CDBCCA          17      CALL    OPEN2
0005BC CBDD 18F5            12      JR  CDIR1
       CBDF                     PDSKF:
0005BE CBDF 3A14E5          13      LD  A,(FDRV)
0005C1 CBE2 5F               4      LD  E,A
0005C2 CBE3 0E1B             7      LD  C,01BH      ;(BDOS)ディスク情報の獲得
0005C4 CBE5 CD0500          17      CALL    SYSTEM
0005C7 CBE8 4F               4      LD  C,A     ;C←1クラスタ辺りの論理セクタ数
0005C8 CBE9 C601             7      ADD A,001H
0005CA CBEB D8              11      RET C       ;Aが0FFHだった場合
0005CB CBEC 3E06             7      LD  A,8-2
       CBEE                     PDS1:               ;HL=未使用クラスタの総数
0005CD CBEE 3C               4      INC A
0005CE CBEF CB19             8      RR  C
0005D0 CBF1 30FB            12      JR  NC,PDS1
       CBF3                     PDS2:               ;B←論理セクタのサイズの上位8ビット
0005D2 CBF3 3C               4      INC A
0005D3 CBF4 CB18             8      RR  B
0005D5 CBF6 30FB            12      JR  NC,PDS2
0005D7 CBF8 47               4      LD  B,A
                                
0005D8 CBF9 110000          10      LD  DE,0
       CBFC                     PDS3:
0005DB CBFC 29              11      ADD HL,HL
0005DC CBFD EB               4      EX  DE,HL
0005DD CBFE ED6A            15      ADC HL,HL
0005DF CC00 EB               4      EX  DE,HL
0005E0 CC01 10F9            13      DJNZ    PDS3
       CC03                     PDSKF1:
0005E2 CC03 CD8FCC          17      CALL    PRDEC_DEHL
0005E5 CC06 11D3E4          10      LD  DE,FREE
0005E8 CC09 CD73CE          17      CALL    _SYS09      ;(BDOS)文字列出力
0005EB CC0C CD7CCC          17      CALL    PUTDRV
0005EE CC0F 3E5C             7      LD  A,05CH      ;\
0005F0 CC11 CD15D1          17      CALL    MSG_A
0005F3 CC14 2A22E5          16      LD  HL,(FDRV+14)    ;ディレクトリのクラスタ番号
0005F6 CC17 AF               4      XOR A
0005F7 CC18 11FEFF          10      LD  DE,0-2
0005FA CC1B 19              11      ADD HL,DE
0005FB CC1C 23               6      INC HL
0005FC CC1D DC8CCC          17      CALL    C,PRDEC_HL
0005FF CC20 1833            12      JR  LTNL
                                
       CC22                     P_NAME:
000601 CC22 3A7FE4          13      LD  A,(DTA_CCP+1)
000604 CC25 FE2E             7      CP  '.'
000606 CC27 C8              11      RET Z
                                
000607 CC28 3A8AE4          13      LD  A,(DTA_CCP+1+00BH)
00060A CC2B F5              11      PUSH    AF
00060B CC2C CB67             8      BIT 4,A
00060D CC2E 2808            12      JR  Z,DIR3
00060F CC30 11C8E4          10      LD  DE,DIRMES
000612 CC33 CD73CE          17      CALL    _SYS09      ;(BDOS)文字列出力
000615 CC36 180A            12      JR  DIR6
       CC38                     DIR3:
000617 CC38 ED5B9DE4        20      LD  DE,(DTA_CCP+1+01EH)
00061B CC3C 2A9BE4          16      LD  HL,(DTA_CCP+1+01CH)
00061E CC3F CD8FCC          17      CALL    PRDEC_DEHL
       CC42                     DIR6:
000621 CC42 F1              10      POP AF
000622 CC43 0F               4      RRCA
000623 CC44 9F               4      SBC A,A
000624 CC45 E60A             7      AND '*'-020H
000626 CC47 C620             7      ADD A,020H
000628 CC49 CD15D1          17      CALL    MSG_A
00062B CC4C CD7CCC          17      CALL    PUTDRV
00062E CC4F 217FE4          10      LD  HL,DTA_CCP+1
000631 CC52 CDCFCC          17      CALL    FPRNT
                                
       CC55                     LTNL:
000634 CC55 1E03             7      LD  E,3
000636 CC57 C3CDE5          10      JP  _PRINT
                                
       CC5A                     C_PATH:
000639 CC5A CDA6D6          17      CALL    SPCUT
00063C CC5D 2142E4          10      LD  HL,PATHD
00063F CC60 FE21             7      CP  021H
000641 CC62 300C            12      JR  NC,CPATH0
       CC64                     CPATHP:
000643 CC64 7E               7      LD  A,(HL)
000644 CC65 23               6      INC HL
000645 CC66 FE20             7      CP  020H
000647 CC68 3F               4      CCF
000648 CC69 30EA            12      JR  NC,LTNL
00064A CC6B CD15D1          17      CALL    MSG_A
00064D CC6E 18F4            12      JR  CPATHP
       CC70                     CPATH0:
00064F CC70 FE3B             7      CP  ';'
000651 CC72 2001            12      JR  NZ,CPATH1
000653 CC74 13               6      INC DE
       CC75                     CPATH1:
000654 CC75 EB               4      EX  DE,HL
000655 CC76 013B00          10      LD  BC,PATHX
000658 CC79 EDB0                    LDIR
00065A CC7B C9              10      RET
                                
       CC7C                     PUTDRV:
00065B CC7C 3A14E5          13      LD  A,(FDRV)
00065E CC7F CDD9D6          17      CALL    GETDRV1
000661 CC82 C641             7      ADD A,'A'
000663 CC84 CD15D1          17      CALL    MSG_A
000666 CC87 3E3A             7      LD  A,':'
       CC89                     MSG_AR:
000668 CC89 C315D1          10      JP  MSG_A
                                
       CC8C                     PRDEC_HL:
00066B CC8C AF               4      XOR A
00066C CC8D 5F               4      LD  E,A
00066D CC8E 57               4      LD  D,A
       CC8F                     PRDEC_DEHL:
00066E CC8F D5              11      PUSH    DE
00066F CC90 110FE5          10      LD  DE,DECBF
000672 CC93 0605             7      LD  B,5
000674 CC95 CD26CD          17      CALL    ZERO_MEMORY_DE  ;A=0
000677 CC98 D1              10      POP DE
                                
000678 CC99 0E20             7      LD  C,32
       CC9B                     DEC1:
00067A CC9B 29              11      ADD HL,HL
00067B CC9C EB               4      EX  DE,HL
00067C CC9D ED6A            15      ADC HL,HL
00067E CC9F EB               4      EX  DE,HL
00067F CCA0 E5              11      PUSH    HL
000680 CCA1 2113E5          10      LD  HL,DECBF+4
000683 CCA4 0605             7      LD  B,5
       CCA6                     DEC2:
000685 CCA6 7E               7      LD  A,(HL)
000686 CCA7 8F               4      ADC A,A
000687 CCA8 27               4      DAA
000688 CCA9 77               7      LD  (HL),A
000689 CCAA 2B               6      DEC HL
00068A CCAB 10F9            13      DJNZ    DEC2
00068C CCAD E1              10      POP HL
00068D CCAE 0D               4      DEC C
00068E CCAF 20EA            12      JR  NZ,DEC1
                                
000690 CCB1 210FE5          10      LD  HL,DECBF
000693 CCB4 3E20             7      LD  A,020H
000695 CCB6 0604             7      LD  B,4
       CCB8                     DEC3:
000697 CCB8 CDC5CC          17      CALL    DEC4
00069A CCBB CDC5CC          17      CALL    DEC4
00069D CCBE 23               6      INC HL
00069E CCBF 10F7            13      DJNZ    DEC3
       CCC1                     DECX:
0006A0 CCC1 CDC5CC          17      CALL    DEC4
0006A3 CCC4 AF               4      XOR A
       CCC5                     DEC4:
0006A4 CCC5 ED6F            18      RLD
0006A6 CCC7 FE20             7      CP  020H
0006A8 CCC9 2802            12      JR  Z,DEC5
0006AA CCCB F630             7      OR  030H
       CCCD                     DEC5:
0006AC CCCD 18BA            12      JR  MSG_AR
                                
       CCCF                     FPRNT:
0006AE CCCF 0608             7      LD  B,8 ;ファイル名を表示
0006B0 CCD1 CDE0CC          17      CALL    P_N1
0006B3 CCD4 7E               7      LD  A,(HL)
0006B4 CCD5 CDF8D8          17      CALL    CAP3
0006B7 CCD8 D8              11      RET C   ;拡張子が無い
                                
0006B8 CCD9 3E2E             7      LD  A,'.'
0006BA CCDB CD15D1          17      CALL    MSG_A
0006BD CCDE 0603             7      LD  B,3 ;拡張子を表示
       CCE0                     P_N1:
0006BF CCE0 7E               7      LD  A,(HL)
0006C0 CCE1 CDF8D8          17      CALL    CAP3
0006C3 CCE4 3807            12      JR  C,P_N2
0006C5 CCE6 CD15D1          17      CALL    MSG_A
0006C8 CCE9 23               6      INC HL
0006C9 CCEA 10F4            13      DJNZ    P_N1
0006CB CCEC C9              10      RET
       CCED                     P_N2:
0006CC CCED 23               6      INC HL
0006CD CCEE 10FD            13      DJNZ    P_N2
0006CF CCF0 C9              10      RET
                                
       CCF1                     SETFCB:
0006D0 CCF1 CDA6D6          17      CALL    SPCUT
0006D3 CCF4 1A               7      LD  A,(DE)
0006D4 CCF5 FE20             7      CP  020H
0006D6 CCF7 3801            12      JR  C,SETFCBA
0006D8 CCF9 1B               6      DEC DE
       CCFA                     SETFCBA:
0006D9 CCFA 0624             7      LD  B,36
0006DB CCFC 215C00          10      LD  HL,FCB1
0006DE CCFF E5              11      PUSH    HL
0006DF CD00 AF               4      XOR A
0006E0 CD01 CD7BD6          17      CALL    FILL_MEMORY
0006E3 CD04 E1              10      POP HL
0006E4 CD05 D5              11      PUSH    DE
0006E5 CD06 CDACD0          17      CALL    _SYS29      ;(BDOS)ファイル名の解析
0006E8 CD09 216C00          10      LD  HL,FCB2
0006EB CD0C CDACD0          17      CALL    _SYS29      ;(BDOS)ファイル名の解析
0006EE CD0F E1              10      POP HL
0006EF CD10 010050          10      LD  BC,05000H
0006F2 CD13 118100          10      LD  DE,00081H
       CD16                     SETFCB1:
0006F5 CD16 7E               7      LD  A,(HL)
0006F6 CD17 23               6      INC HL
0006F7 CD18 FE20             7      CP  020H
0006F9 CD1A 3805            12      JR  C,SETFCB2
0006FB CD1C 12               7      LD  (DE),A
0006FC CD1D 13               6      INC DE
0006FD CD1E 0C               4      INC C
0006FE CD1F 10F5            13      DJNZ    SETFCB1
       CD21                     SETFCB2:
000700 CD21 79               4      LD  A,C
000701 CD22 328000          13      LD  (DTA1),A
000704 CD25 04               4      INC B
       CD26                     ZERO_MEMORY_DE:
000705 CD26 AF               4      XOR A
       CD27                     FILL_MEMORY_DE:
000706 CD27 12               7      LD  (DE),A
000707 CD28 13               6      INC DE
000708 CD29 10FC            13      DJNZ    FILL_MEMORY_DE
00070A CD2B C9              10      RET
                                
       CD2C                     C_COPY:
00070B CD2C CDF1CC          17      CALL    SETFCB
                                
00070E CD2F 1161E5          10      LD  DE,ZERO
000711 CD32 CDC8D5          17      CALL    FILEC2
000714 CD35 216C00          10      LD  HL,FCB2
000717 CD38 CDB3D0          17      CALL    S29X1
                                
00071A CD3B 3E10             7      LD  A,010H
00071C CD3D 326900          13      LD  (FCB1+13),A
00071F CD40 216D00          10      LD  HL,FCB2FN
000722 CD43 CD07CE          17      CALL    CWILD1
       CD46                     COPY0:
000725 CD46 CD04CE          17      CALL    CWILD
000728 CD49 215C00          10      LD  HL,FCB1
00072B CD4C CDADCA          17      CALL    OPEN
00072E CD4F 37               4      SCF
       CD50                     COPY1:
00072F CD50 C0              11      RET NZ
000730 CD51 CDC0CA          17      CALL    DEFCB
                                
000733 CD54 3A8BE4          13      LD  A,(DTA_CCP+13)
000736 CD57 CB67             8      BIT 4,A
000738 CD59 2821            12      JR  Z,COPY1A
                                
00073A CD5B 215D00          10      LD  HL,FCB1FN
00073D CD5E CD0BDA          17      CALL    CHKWILD
000740 CD61 3814            12      JR  C,COPY9
                                
000742 CD63 3E20             7      LD  A,020H
000744 CD65 325D00          13      LD  (FCB1FN),A
000747 CD68 2A98E4          16      LD  HL,(DTA_CCP+26)
00074A CD6B 23               6      INC HL
00074B CD6C 226A00          16      LD  (FCB1+14),HL
00074E CD6F 18D5            12      JR  COPY0
                                
       CD71                     COPY8:
000750 CD71 CD73CE          17      CALL    _SYS09      ;(BDOS)文字列出力
000753 CD74 CD55CC          17      CALL    LTNL
       CD77                     COPY9:
000756 CD77 CDBCCA          17      CALL    OPEN2
000759 CD7A 18D4            12      JR  COPY1
                                
       CD7C                     COPY1A:
00075B CD7C 216C00          10      LD  HL,FCB2
00075E CD7F 1114E5          10      LD  DE,FDRV
000761 CD82 0180E4          10      LD  BC,DTA_CCP+2
000764 CD85 EDA0            16      LDI
000766 CD87 3E0B             7      LD  A,11
       CD89                     COPY2:
000768 CD89 F5              11      PUSH    AF
000769 CD8A 7E               7      LD  A,(HL)
00076A CD8B FE3F             7      CP  '?'
00076C CD8D 2001            12      JR  NZ,COPY3
00076E CD8F 0A               7      LD  A,(BC)
       CD90                     COPY3:
00076F CD90 12               7      LD  (DE),A
000770 CD91 03               6      INC BC
000771 CD92 13               6      INC DE
000772 CD93 23               6      INC HL
000773 CD94 F1              10      POP AF
000774 CD95 3D               4      DEC A
000775 CD96 20F1            12      JR  NZ,COPY2
000777 CD98 010500          10      LD  BC,16-11
00077A CD9B EDB0                    LDIR
       CD9D                     PUTNAME:
00077C CD9D 215D00          10      LD  HL,FCB1FN
00077F CDA0 CD0BDA          17      CALL    CHKWILD
000782 CDA3 300B            12      JR  NC,PUTN1
000784 CDA5 2115E5          10      LD  HL,FDRV+1
000787 CDA8 CDCFCC          17      CALL    FPRNT
00078A CDAB 3E20             7      LD  A,020H
00078C CDAD CD15D1          17      CALL    MSG_A
       CDB0                     PUTN1:
00078F CDB0 1114E5          10      LD  DE,FDRV
000792 CDB3 0E16             7      LD  C,016H      ;(BDOS)ファイルの作成
000794 CDB5 CDDBCA          17      CALL    SYSTEM0
000797 CDB8 2048            12      JR  NZ,COPYE2
000799 CDBA 67               4      LD  H,A     ;A=0
00079A CDBB 6F               4      LD  L,A
00079B CDBC 2235E5          16      LD  (FDRV+33),HL    ;(FCB)ランダムレコード
00079E CDBF 2237E5          16      LD  (FDRV+35),HL
       CDC2                     COPY6:
0007A1 CDC2 CDE4CA          17      CALL    S27BUF
0007A4 CDC5 47               4      LD  B,A
0007A5 CDC6 3C               4      INC A
0007A6 CDC7 2831            12      JR  Z,COPYE
0007A8 CDC9 7C               4      LD  A,H
0007A9 CDCA B5               4      OR  L
0007AA CDCB 280C            12      JR  Z,COPY7
0007AC CDCD 1114E5          10      LD  DE,FDRV
0007AF CDD0 0E26             7      LD  C,026H      ;(BDOS)ランダムブロック書き込み
0007B1 CDD2 CDDBCA          17      CALL    SYSTEM0
0007B4 CDD5 2023            12      JR  NZ,COPYE
0007B6 CDD7 10E9            13      DJNZ    COPY6
       CDD9                     COPY7:
0007B8 CDD9 3A8BE4          13      LD  A,(DTA_CCP+13)  ;(FCB)属性
0007BB CDDC 3221E5          13      LD  (FDRV+13),A
0007BE CDDF 2192E4          10      LD  HL,DTA_CCP+20   ;(FCB)タイムスタンプ
0007C1 CDE2 1128E5          10      LD  DE,FDRV+20
0007C4 CDE5 010400          10      LD  BC,4
0007C7 CDE8 EDB0                    LDIR
                                
0007C9 CDEA 1114E5          10      LD  DE,FDRV
0007CC CDED 0E10             7      LD  C,010H      ;(BDOS)ファイルのクローズ
0007CE CDEF CDDBCA          17      CALL    SYSTEM0
0007D1 CDF2 2006            12      JR  NZ,COPYE
                                
0007D3 CDF4 1171E5          10      LD  DE,OK
0007D6 CDF7 C371CD          10      JP  COPY8
                                
       CDFA                     COPYE:
0007D9 CDFA 1114E5          10      LD  DE,FDRV
0007DC CDFD 0E13             7      LD  C,013H      ;(BDOS)ファイルの削除
0007DE CDFF CD0500          17      CALL    SYSTEM
       CE02                     COPYE2:
0007E1 CE02 37               4      SCF
0007E2 CE03 C9              10      RET
                                
       CE04                     CWILD:
0007E3 CE04 215D00          10      LD  HL,FCB1FN
       CE07                     CWILD1:
0007E6 CE07 7E               7      LD  A,(HL)
0007E7 CE08 FE20             7      CP  020H
0007E9 CE0A C0              11      RET NZ
       CE0B                     CWILD2:
0007EA CE0B 3E3F             7      LD  A,'?'
0007EC CE0D 060B             7      LD  B,11
0007EE CE0F C37BD6          10      JP  FILL_MEMORY
                                
       CE12                     COMTB:
0007F1 CE12 44202020                DB  "D   "  ;1
0007F5 CE16 C3CB                    DW  C_DIR
0007F7 CE18 44495220                DB  "DIR "  ;2
0007FB CE1C C3CB                    DW  C_DIR
0007FD CE1E 434F5059                DB  "COPY"  ;3
000801 CE22 2CCD                    DW  C_COPY
000803 CE24 43442020                DB  "CD  "  ;4
000807 CE28 E0CA                    DW  C_CD
000809 CE2A 44454C20                DB  "DEL "  ;5
00080D CE2E A6CB                    DW  C_DEL
00080F CE30 50415448                DB  "PATH"  ;6
000813 CE34 5ACC                    DW  C_PATH
000815 CE36 52454E20                DB  "REN "  ;7
000819 CE3A B0CB                    DW  C_REN
00081B CE3C 52454D20                DB  "REM "  ;8
00081F CE40 70CE                    DW  C_REM
[EOF:LDCCP.ASM:SHIFT_JIS]
                                    INCLUDE "LDOS.ASM"
                                
                                ;   LSX-Dodgers OS
                                
       CE42                     BDOS0:
000821 CE42 E5              11      PUSH    HL
000822 CE43 79               4      LD  A,C
000823 CE44 FE3C             7      CP  03CH
000825 CE46 3802            12      JR  C,DOS1
000827 CE48 3E3C             7      LD  A,03CH
       CE4A                     DOS1:
000829 CE4A 87               4      ADD A,A
00082A CE4B 324FCE          13      LD  (DOS1_SWC),A
00082D CE4E 2A00E6          16      LD  HL,(STABLE)
       CE4F                     DOS1_SWC    EQU $-2
000830 CE51 E3              19      EX  (SP),HL
000831 CE52 79               4      LD  A,C
                                ;確認用
                                ;   LD  (0050H),A
000832 CE53 C9              10      RET
       CE54                     _DOS2:
000833 CE54 FE5A             7      CP  05AH        ;(BDOS)カレントディレクトリの変更(_CHDIR)
000835 CE56 CAEED0          10      JP  Z,_SYS5A
000838 CE59 FE5C             7      CP  05CH        ;(BDOS)ファイル名の解析(_PFILE)
00083A CE5B CAABD0          10      JP  Z,_SYS5C
00083D CE5E FE5F             7      CP  05FH        ;(BDOS)ディスクバッファのフラッシュ(_FLUSH)
00083F CE60 CA08E3          10      JP  Z,_SYS5F
000842 CE63 FE6F             7      CP  06FH        ;(BDOS)MSX-DOS のバージョン番号の獲得(_DOSVER)
000844 CE65 200A            12      JR  NZ,_ERROR
000846 CE67 011D00          10      LD  BC,VER_6F
000849 CE6A 116101          10      LD  DE,VER
00084C CE6D 210301          10      LD  HL,MACD
       CE70                     C_REM:
00084F CE70 AF               4      XOR A
       CE71                     _ERROR:
000850 CE71 A7               4      AND A
000851 CE72 C9              10      RET
                                
       CE73                     _SYS09:     ;文字列出力
000852 CE73 D5              11      PUSH    DE
       CE74                     _SX09:
000853 CE74 1A               7      LD  A,(DE)
000854 CE75 13               6      INC DE
000855 CE76 FE24             7      CP  '$'
000857 CE78 2831            12      JR  Z,SX0E2
000859 CE7A CD15D1          17      CALL    MSG_A
00085C CE7D 18F5            12      JR  _SX09
                                
       CE7F                     MSX1:
00085E CE7F CD15D1          17      CALL    MSG_A
       CE82                     MSX:
000861 CE82 7E               7      LD  A,(HL)
000862 CE83 23               6      INC HL
000863 CE84 B7               4      OR  A
000864 CE85 20F8            12      JR  NZ,MSX1
000866 CE87 C9              10      RET
                                
       CE88                     _SYS0C:     ;(BDOS)バージョン番号の獲得
000867 CE88 212200          10      LD  HL,00022H
00086A CE8B 7D               4      LD  A,L
00086B CE8C C9              10      RET
                                
       CE8D                     _SYS0D:     ;(BDOS)ディスクリセット
00086C CE8D CDDFE5          17      CALL    _FFLUSH
00086F CE90 E5              11      PUSH    HL
000870 CE91 218000          10      LD  HL,00080H
000873 CE94 228AE5          16      LD  (_DTA),HL
000876 CE97 E1              10      POP HL
000877 CE98 D5              11      PUSH    DE
000878 CE99 1E00             7      LD  E,0
00087A CE9B 3E                      DB  03EH    ;次の PUSH DE をスキップ
                                
       CE9C                     _SYS0E:     ;(BDOS)カレントドライブの設定
00087B CE9C D5              11      PUSH    DE
00087C CE9D 7B               4      LD  A,E
00087D CE9E DDE5            15      PUSH    IX
00087F CEA0 CDDCE5          17      CALL    _GETDPB
000882 CEA3 DDE1            14      POP IX
000884 CEA5 3804            12      JR  C,SX0E2
000886 CEA7 7B               4      LD  A,E
000887 CEA8 320400          13      LD  (_DVSW),A
       CEAB                     SX0E2:
00088A CEAB D1              10      POP DE
00088B CEAC C9              10      RET
                                
       CEAD                     _SYS0F:     ;(BDOS)ファイルのオープン
00088C CEAD CDB8D6          17      CALL    SETDRV
00088F CEB0 FD7E1C          19      LD  A,(IY+28)   ;(FCB)オープンモード
000892 CEB3 C602             7      ADD A,002H      ;Write
000894 CEB5 2848            12      JR  Z,FEND0F
000896 CEB7 CD07DA          17      CALL    CHKWILDX
                                
000899 CEBA D4E2D6          17      CALL    NC,SOPENX
       CEBD                     _S16XX:
00089C CEBD 3840            12      JR  C,FEND0F
                                                ;Directory location
00089E CEBF 3A9FE5          13      LD  A,(_FILEN)
0008A1 CEC2 FD7719          19      LD  (IY+25),A   ;(FCB)ディレクトリロケーション
                                ;               _DIRF
0008A4 CEC5 3AA0E5          13      LD  A,(_DIRF)
0008A7 CEC8 FD771D          19      LD  (IY+29),A   ;(FCB)ディレクトリモード
                                ;               _FBPS
0008AA CECB FD731E          19      LD  (IY+30),E   ;(FCB)ディレクトリポジション
0008AD CECE FD721F          19      LD  (IY+31),D
                                ;               Open(Read)
0008B0 CED1 FD361CFF        19      LD  (IY+28),0FFH    ;(FCB)オープンモード
                                ;               FILENAME
0008B4 CED5 FDE5            15      PUSH    IY
0008B6 CED7 D1              10      POP DE
0008B7 CED8 13               6      INC DE
0008B8 CED9 010B00          10      LD  BC,11
0008BB CEDC EDB0                    LDIR
                                ;               Attribute
0008BD CEDE 7E               7      LD  A,(HL)
0008BE CEDF FD770D          19      LD  (IY+13),A   ;(FCB)属性(アトリビュート)
0008C1 CEE2 110B00          10      LD  DE,11       ;Reserved
0008C4 CEE5 19              11      ADD HL,DE
                                                    ;(FCB)ファイルを最後に変更した時刻
0008C5 CEE6 11E4E6          10      LD  DE,SDDATA       ;(FCB)ファイルを最後に変更した日付
0008C8 CEE9 060A             7      LD  B,SDDATAE-SDDATA    ;(FCB)ファイルの先頭クラスタ
       CEEB                     S16LOOP:                ;(FCB)ファイルのサイズ(バイト単位)
0008CA CEEB 1A               7      LD  A,(DE)
0008CB CEEC 13               6      INC DE
0008CC CEED 32F4CE          13      LD  (S16PAT),A
0008CF CEF0 7E               7      LD  A,(HL)
0008D0 CEF1 23               6      INC HL
0008D1 CEF2 FD7700          19      LD  (IY+0),A
       CEF4                     S16PAT  EQU $-1
0008D4 CEF5 10F4            13      DJNZ    S16LOOP
                                
0008D6 CEF7 AF               4      XOR A
0008D7 CEF8 FD770C          19      LD  (IY+12),A   ;(FCB)カレントブロック
0008DA CEFB FD229CCF        20      LD  (OFCB_SWC),IY
       CEFF                     FEND0F:
0008DE CEFF 1845            12      JR  FEND10
                                
       CF01                     _SYS10:     ;(BDOS)ファイルのクローズ
0008E0 CF01 CDB8D6          17      CALL    SETDRV
0008E3 CF04 FD7E1C          19      LD  A,(IY+28)   ;(FCB)オープンモード
0008E6 CF07 D6FE             7      SUB 0FEH
0008E8 CF09 37               4      SCF
0008E9 CF0A 3F               4      CCF
0008EA CF0B 2039            12      JR  NZ,FEND10
       CF0D                     _S10A:              ;Write
0008EC CF0D FD770E          19      LD  (IY+14),A   ;(FCB)レコードサイズ/アクセスするディレクトリのクラスタ番号+1
0008EF CF10 FD770F          19      LD  (IY+15),A
                                
0008F2 CF13 FD341C          23      INC (IY+28)     ;(FCB)オープンモード 0FEH->0FFH
0008F5 CF16 CD03DB          17      CALL    SETTMS
                                
0008F8 CF19 FD7E1D          19      LD  A,(IY+29)   ;(FCB)ディレクトリモード
0008FB CF1C 32A0E5          13      LD  (_DIRF),A
0008FE CF1F E67F             7      AND 07FH
000900 CF21 3228E0          13      LD  (_SECPS),A
000903 CF24 FD5E1E          19      LD  E,(IY+30)   ;(FCB)ディレクトリポジション
000906 CF27 FD561F          19      LD  D,(IY+31)
000909 CF2A CD16D8          17      CALL    READ_DIR
00090C CF2D 3817            12      JR  C,FEND10
                                
00090E CF2F 3A42D7          13  SDECM1: LD  A,(SDECPAT) ;1セクタ辺りのディレクトリエントリ数
000911 CF32 3D               4      DEC A       ;1024=01FH / 512=00FH / 256=7
000912 CF33 FDA619          19      AND (IY+25)     ;(FCB)ディレクトリロケーション
000915 CF36 6F               4      LD  L,A
000916 CF37 2600             7      LD  H,0
000918 CF39 29              11      ADD HL,HL       ;*2
000919 CF3A 29              11      ADD HL,HL       ;*4
00091A CF3B 29              11      ADD HL,HL       ;*8
00091B CF3C 29              11      ADD HL,HL       ;*16
00091C CF3D 29              11      ADD HL,HL       ;*32
00091D CF3E ED4B7EE6        20      LD  BC,(_DTBUF)
000921 CF42 09              11      ADD HL,BC
                                
000922 CF43 CD17DA          17      CALL    SDIRENT
       CF46                     FEND10:
000925 CF46 1842            12      JR  FEND
                                
       CF48                     _SYS11:     ;(BDOS)最初のファイルの検索
000927 CF48 CDB8D6          17      CALL    SETDRV
00092A CF4B CD11D7          17      CALL    SOPEN
       CF4E                     _S12X1:
00092D CF4E 383A            12      JR  C,FEND
00092F CF50 CDB0D7          17      CALL    SOPENE2
000932 CF53 ED5B8AE5        20      LD  DE,(_DTA)
000936 CF57 3A88E5          13      LD  A,(_DRV)
000939 CF5A 3C               4      INC A
00093A CF5B 12               7      LD  (DE),A
00093B CF5C D5              11      PUSH    DE
00093C CF5D 13               6      INC DE
00093D CF5E 012000          10      LD  BC,32
000940 CF61 EDB0                    LDIR
000942 CF63 FD6E0E          19      LD  L,(IY+14)   ;(FCB)レコードサイズ/アクセスするディレクトリのクラスタ番号+1
000945 CF66 FD660F          19      LD  H,(IY+15)
000948 CF69 22F4E6          16      LD  (SCDIR),HL
00094B CF6C 2A9AE5          16      LD  HL,(_FBPS)
00094E CF6F 22F6E6          16      LD  (SFBPS),HL
000951 CF72 2A9FE5          16      LD  HL,(_FILEN)
000954 CF75 7C               4      LD  A,H
000955 CF76 B7               4      OR  A
000956 CF77 2806            12      JR  Z,_S12DIR
000958 CF79 3A28E0          13      LD  A,(_SECPS)
00095B CF7C F680             7      OR  080H
00095D CF7E 67               4      LD  H,A
       CF7F                     _S12DIR:
00095E CF7F 22F8E6          16      LD  (SFNDF),HL  ;Directory position and Flags
000961 CF82 E1              10      POP HL
000962 CF83 1139E5          10      LD  DE,SFILE
000965 CF86 0E21             7      LD  C,33
       CF88                     _S11B:
000967 CF88 EDB0                    LDIR
       CF8A                     FEND:
000969 CF8A 9F               4      SBC A,A     ;CF=0 A=0 : CF=1 A=0FFH
       CF8B                     FENDE:
00096A CF8B FDE1            14      POP IY
00096C CF8D C1              10      POP BC
00096D CF8E D1              10      POP DE
00096E CF8F E1              10      POP HL
00096F CF90 C9              10      RET
                                
       CF91                     _SYS12:     ;(BDOS)次のファイルの検索
000970 CF91 E5              11      PUSH    HL
000971 CF92 D5              11      PUSH    DE
000972 CF93 C5              11      PUSH    BC
000973 CF94 FDE5            15      PUSH    IY
000975 CF96 CD75D7          17      CALL    NOPEN
000978 CF99 18B3            12      JR  _S12X1
                                
       CF9B                     _S16K:
00097A CF9B 110000          10      LD  DE,0
       CF9C                     OFCB_SWC    EQU $-2
00097D CF9E D5              11      PUSH    DE
00097E CF9F 061A             7      LD  B,26        ;First cluster
       CFA1                     S16K1:
000980 CFA1 13               6      INC DE
000981 CFA2 23               6      INC HL
000982 CFA3 10FC            13      DJNZ    S16K1
                                
000984 CFA5 1A               7      LD  A,(DE)
000985 CFA6 BE               7      CP  (HL)
000986 CFA7 2015            12      JR  NZ,S16K2
000988 CFA9 13               6      INC DE
000989 CFAA 23               6      INC HL
00098A CFAB 1A               7      LD  A,(DE)
00098B CFAC BE               7      CP  (HL)
00098C CFAD 200F            12      JR  NZ,S16K2
                                
00098E CFAF E1              10      POP HL
00098F CFB0 FDE5            15      PUSH    IY
000991 CFB2 D1              10      POP DE
000992 CFB3 7E               7      LD  A,(HL)
000993 CFB4 CDCDD6          17      CALL    IS_SAME_DRV_A_DE
000996 CFB7 2006            12      JR  NZ,S16K3
                                                ;ここはCFが必ず0
000998 CFB9 ED52            15      SBC HL,DE       ;CP HL,DE
00099A CFBB 37               4      SCF
00099B CFBC C0              11      RET NZ
00099C CFBD E5              11      PUSH    HL
       CFBE                     S16K2:
00099D CFBE E1              10      POP HL
       CFBF                     S16K3:
00099E CFBF FDE5            15      PUSH    IY
0009A0 CFC1 D1              10      POP DE
       CFC2                     _SYS13:     ;(BDOS)ファイルの削除
0009A1 CFC2 CDB8D6          17      CALL    SETDRV
0009A4 CFC5 CD3FD9          17      CALL    KILL
       CFC8                     FEND13:
0009A7 CFC8 18C0            12      JR  FEND
                                
       CFCA                     _SYS14:     ;(BDOS)シーケンシャルな読み出し
0009A9 CFCA CDB8D6          17      CALL    SETDRV
0009AC CFCD CD7BDE          17      CALL    INIT_SEQ
       CFD0                     SREAD:
0009AF CFD0 CD4DDE          17      CALL    RB_READ
                                
0009B2 CFD3 C601             7      ADD A,001H
0009B4 CFD5 38B3            12      JR  C,FEND
                                
0009B6 CFD7 7D               4      LD  A,L
0009B7 CFD8 D601             7      SUB 001H
       CFDA                     FENDX:
0009B9 CFDA 9F               4      SBC A,A
0009BA CFDB E603             7      AND 3
0009BC CFDD 1F               4      RRA
0009BD CFDE 18AB            12      JR  FENDE
                                
       CFE0                     _SYS15:     ;(BDOS)シーケンシャルな書き込み
0009BF CFE0 CDB8D6          17      CALL    SETDRV
0009C2 CFE3 CD7BDE          17      CALL    INIT_SEQ
       CFE6                     SWRITE:
0009C5 CFE6 CD48DE          17      CALL    RB_WRITE
                                
0009C8 CFE9 C6FF             7      ADD A,0FFH
0009CA CFEB 18ED            12      JR  FENDX
                                
       CFED                     _SYS17:     ;(BDOS)ファイル名の変更
0009CC CFED CDB8D6          17      CALL    SETDRV
0009CF CFF0 CD95D9          17      CALL    NAME
0009D2 CFF3 18D3            12      JR  FEND13
                                
       CFF5                     _SYS16:     ;(BDOS)ファイルの作成
0009D4 CFF5 CDB8D6          17      CALL    SETDRV
                                
0009D7 CFF8 CD07DA          17      CALL    CHKWILDX
0009DA CFFB 38CB            12      JR  C,FEND13
0009DC CFFD FD7E01          19      LD  A,(IY+1)    ;(FCB)主ファイル名
0009DF D000 FE05             7      CP  5
0009E1 D002 2805            12      JR  Z,_S16X2
0009E3 D004 FE21             7      CP  021H
0009E5 D006 DAC8CF          10      JP  C,FEND13
       D009                     _S16X2:
                                ;               Clear FCB
0009E8 D009 FDE5            15      PUSH    IY
0009EA D00B E1              10      POP HL
0009EB D00C 011000          10      LD  BC,16
0009EE D00F 09              11      ADD HL,BC
       D010                     _S16X1:
0009EF D010 70               7      LD  (HL),B      ;B=0
0009F0 D011 23               6      INC HL
0009F1 D012 0D               4      DEC C
0009F2 D013 20FB            12      JR  NZ,_S16X1
                                
0009F4 D015 CD08DB          17      CALL    SETTMSX
0009F7 D018 FD360DFF        19      LD  (IY+13),0FFH    ;(FCB)Attribute
0009FB D01C CDE2D6          17      CALL    SOPENX
0009FE D01F 3F               4      CCF
0009FF D020 CC9BCF          17      CALL    Z,_S16K
000A02 D023 D4C1D7          17      CALL    NC,COPEN
000A05 D026 D417DA          17      CALL    NC,SDIRENT
000A08 D029 C3BDCE          10      JP  _S16XX
                                
       D02C                     _SYS21:     ;(BDOS)ランダムな読み出し
000A0B D02C CDB8D6          17      CALL    SETDRV
000A0E D02F CD53DB          17      CALL    INIT_RND
000A11 D032 189C            12      JR  SREAD
                                
       D034                     _SYS22:     ;(BDOS)ランダムな書き込み
       D034                     _SYS28:     ;(BDOS)ランダムな書き込み・その2
000A13 D034 CDB8D6          17      CALL    SETDRV
000A16 D037 CD53DB          17      CALL    INIT_RND
000A19 D03A 18AA            12      JR  SWRITE
                                
       D03C                     _SYS18:     ;(BDOS)ログインベクトルの獲得
000A1B D03C 21FF00          10      LD  HL,000FFH
000A1E D03F AF               4      XOR A
000A1F D040 C9              10      RET
                                
       D041                     _SYS19:     ;(BDOS)カレントドライブ番号の獲得
000A20 D041 3A0400          13      LD  A,(_DVSW)   ;from LDOS
000A23 D044 A7               4      AND A
000A24 D045 C9              10      RET
                                
       D046                     _SYS1A:     ;(BDOS)DTAの設定
000A25 D046 ED538AE5        20      LD  (_DTA),DE
000A29 D04A AF               4      XOR A
000A2A D04B C9              10      RET
                                
       D04C                     _SYS1B:     ;(BDOS)ディスク情報の獲得
000A2B D04C 7B               4      LD  A,E
000A2C D04D CDC6D6          17      CALL    GETDRV
000A2F D050 CDDCE5          17      CALL    _GETDPB
000A32 D053 D4E2E5          17      CALL    NC,_RDFATX
000A35 D056 210000          10      LD  HL,0
000A38 D059 D4E1DA          17      CALL    NC,DSKF
                                
000A3B D05C ED5BE2DA        20      LD  DE,(MAXCLP) ;DPB_MAXCL-1
000A3F D060 1B               6      DEC DE      ;DE←クラスタの総数
000A40 D061 FD2A7CE6        20      LD  IY,(_FATBF) ;IY←メモリ上のFATの先頭アドレス
000A44 D065 9F               4      SBC A,A
000A45 D066 D8              11      RET C
000A46 D067 4F               4      LD  C,A     ;C=0
000A47 D068 DD7E0F          19      LD  A,(IX+DPB_BPS)
000A4A D06B E607             7      AND 7
000A4C D06D 47               4      LD  B,A
000A4D D06E DD7E07          19      LD  A,(IX+DPB_SECPCL)
000A50 D071 C9              10      RET
                                
       D072                     _SYS1D:     ;(BDOS)書き込みが禁止されているディスクの調査
000A51 D072 AF               4      XOR A
000A52 D073 67               4      LD  H,A
000A53 D074 6F               4      LD  L,A
000A54 D075 C9              10      RET
                                
       D076                     _SYS1F:     ;(BDOS)ディスク装置のパラメータの読み出し
000A55 D076 2100E7          10      LD  HL,_DEVICE
000A58 D079 7B               4      LD  A,E
000A59 D07A C3DCE5          10      JP  _GETDPB
                                
       D07D                     _SYS23:     ;(BDOS)ファイルサイズの獲得
000A5C D07D E5              11      PUSH    HL
000A5D D07E 0E0F             7      LD  C,00FH      ;(BDOS)ファイルのオープン
000A5F D080 CD42CE          17      CALL    BDOS0
000A62 D083 381B            12      JR  C,_S23X1
                                
000A64 D085 D5              11      PUSH    DE      ;EX DE,IY
000A65 D086 FDE3            23      EX  (SP),IY     ;
                                ;   POP DE      ;
                                ;   PUSH    DE      ;DEを破壊しないように注意vv
000A67 D088 FD7E10          19      LD  A,(IY+16)   ;(FCB)ファイルのサイズ(バイト単位)
000A6A D08B FD6E11          19      LD  L,(IY+17)   ;
000A6D D08E FD6612          19      LD  H,(IY+18)   ;
000A70 D091 C5              11      PUSH    BC      ;
000A71 D092 FD4613          19      LD  B,(IY+19)   ;
000A74 D095 CD45DB          17      CALL    GET_CPM_R_SIZE
000A77 D098 C1              10      POP BC
       D099                     _S24X1:
000A78 D099 CD65DB          17      CALL    SET_RR_AHL
                                ;   POP DE      ;^^^^^^^^^^^^^^^^^^^^^^^^
                                ;   PUSH    DE      ;EX DE,IY
000A7B D09C FDE3            23      EX  (SP),IY     ;
000A7D D09E D1              10      POP DE      ;
                                
000A7E D09F AF               4      XOR A
       D0A0                     _S23X1:
000A7F D0A0 E1              10      POP HL
000A80 D0A1 C9              10      RET
                                
       D0A2                     _SYS24:     ;(BDOS)ランダムレコードフィールドの設定
000A81 D0A2 E5              11      PUSH    HL
000A82 D0A3 D5              11      PUSH    DE      ;EX DE,IY
000A83 D0A4 FDE3            23      EX  (SP),IY     ;
                                ;   POP DE      ;
                                ;   PUSH    DE      ;DEを破壊しないように注意vv
000A85 D0A6 CD83DE          17      CALL    GETSEQ
000A88 D0A9 18EE            12      JR  _S24X1      ;^^^^^^^^^^^^^^^^^^^^^^^^
                                
       D0AB                     _SYS5C:     ;(BDOS)ファイル名の解析(_PFILE)
000A8A D0AB 2B               6      DEC HL
       D0AC                     _SYS29:     ;(BDOS)ファイル名の解析(_PPATH)
000A8B D0AC C5              11      PUSH    BC
000A8C D0AD E5              11      PUSH    HL
000A8D D0AE CDD0D5          17      CALL    FILE
000A90 D0B1 E1              10      POP HL
000A91 D0B2 C1              10      POP BC
       D0B3                     S29X1:
000A92 D0B3 C5              11      PUSH    BC
000A93 D0B4 D5              11      PUSH    DE
000A94 D0B5 E5              11      PUSH    HL
000A95 D0B6 EB               4      EX  DE,HL
000A96 D0B7 AF               4      XOR A
000A97 D0B8 3221E5          13      LD  (FDRV+13),A
000A9A D0BB 2114E5          10      LD  HL,FDRV
000A9D D0BE 011000          10      LD  BC,16
000AA0 D0C1 EDB0                    LDIR
000AA2 D0C3 E1              10      POP HL
000AA3 D0C4 D1              10      POP DE
000AA4 D0C5 C1              10      POP BC
000AA5 D0C6 C9              10      RET
                                
       D0C7                     _SYS30:     ;(BDOS)論理セクタを用いた書き込み
000AA6 D0C7 C5              11      PUSH    BC
000AA7 D0C8 01C9E1          10      LD  BC,DWT24B
000AAA D0CB 1804            12      JR  S2FX
       D0CD                     _SYS2F:
000AAC D0CD C5              11      PUSH    BC
000AAD D0CE 01BBE1          10      LD  BC,DRD24B
       D0D1                     S2FX:
000AB0 D0D1 ED43E7D0        20      LD  (S2F_SWC),BC
000AB4 D0D5 CDDFE5          17      CALL    _FFLUSH
                                
000AB7 D0D8 D5              11      PUSH    DE
000AB8 D0D9 E5              11      PUSH    HL
000AB9 D0DA 7D               4      LD  A,L     ;Drive
000ABA D0DB CDD9E5          17      CALL    _CHGDRV
000ABD D0DE 3809            12      JR  C,POP_HL_DE_BC_SBCAA_RET
000ABF D0E0 44               4      LD  B,H     ;Number of clusters
000AC0 D0E1 2A8AE5          16      LD  HL,(_DTA)
                                
000AC3 D0E4 0E00             7      LD  C,0
000AC5 D0E6 CDBBE1          17      CALL    DRD24B
       D0E7                     S2F_SWC EQU $-2
       D0E9                     POP_HL_DE_BC_SBCAA_RET:
000AC8 D0E9 E1              10      POP HL
000AC9 D0EA D1              10      POP DE
000ACA D0EB C1              10      POP BC
000ACB D0EC 9F               4      SBC A,A
000ACC D0ED C9              10      RET
                                
       D0EE                     _SYS5A:     ;(BDOS)カレントディレクトリの変更
000ACD D0EE C5              11      PUSH    BC
000ACE D0EF D5              11      PUSH    DE
000ACF D0F0 E5              11      PUSH    HL
000AD0 D0F1 CDC5D5          17      CALL    FILEC
000AD3 D0F4 21E9D0          10      LD  HL,POP_HL_DE_BC_SBCAA_RET
000AD6 D0F7 E5              11      PUSH    HL
000AD7 D0F8 3A21E5          13      LD  A,(FDRV+13) ;(FCB)属性(アトリビュート))
000ADA D0FB E610             7      AND 010H        ;ディレクトリ
000ADC D0FD 37               4      SCF
000ADD D0FE C8              11      RET Z
000ADE D0FF 1114E5          10      LD  DE,FDRV
000AE1 D102 2A4EE6          16      LD  HL,(STABLE+2*027H)  ;(BDOS)ランダムブロック読み込み
       D105                     JPHL:
000AE4 D105 E9               4      JP  (HL)
                                
       D106                     SHOW_ERROR:         ;(9)
000AE5 D106 1179E5          10      LD  DE,COMERM
000AE8 D109 CD73CE          17      CALL    _SYS09      ;(BDOS)文字列出力
000AEB D10C C300E5          10      JP  CPM_BOOT
[EOF:LDOS.ASM:SHIFT_JIS]
                                    INCLUDE "MSXIO.ASM"
                                
                                ;   LSX-Dodgers IO
                                ;   MSX
                                
       CE71                     _SYS04  EQU _ERROR      ;(BDOS)外部出力
       CE71                     _SYS05  EQU _ERROR      ;(BDOS)プリンタ出力
       CE71                     _SYS1C  EQU _ERROR      ;(BDOS)ディスクの書き込み禁止化
       CE71                     _SYS1E  EQU _ERROR      ;(BDOS)ファイル属性の設定
       CE71                     _SYS20  EQU _ERROR      ;(BDOS)利用者番号の設定と読み出し
       CE71                     _SYS2E  EQU _ERROR      ;(BDOS)ベリファイ・フラグの設定
                                
       0000                     INT EQU 0
       0000                     INTCTCE EQU 0
       0000                     INTCTC2 EQU 0
                                
       0000                     CTRL00  EQU 0
       0000                     CTRL03  EQU 0
       0000                     CTRL04  EQU 0
       0000                     CTRL05  EQU 0
       0000                     CTRL06  EQU 0
       0000                     CTRL07  EQU 0
       0000                     CTRL08  EQU 0
       0000                     CTRL09  EQU 0
       0000                     CTRL0A  EQU 0
       0000                     CTRL0B  EQU 0
       0000                     CTRL0C  EQU 0
       0000                     CTRL0D  EQU 0
       0000                     CTRL0E  EQU 0
       0000                     CTRL12  EQU 0
       0000                     CTRL1B  EQU 0
       0000                     CTRL1C  EQU 0
       0000                     CTRL1D  EQU 0
       0000                     CTRL1E  EQU 0
       0000                     CTRL1F  EQU 0
                                
       D10F                     PRINT:
000AEE D10F 7B               4      LD  A,E
000AEF D110 1803            12      JR  MSG_A
                                
       D112                     _SYS01:     ;(BDOS)コンソール入力
000AF1 D112 CD09E5          17      CALL    _SYS07
       D115                     MSG_A:
000AF4 D115 FE03             7      CP  3
000AF6 D117 2814            12      JR  Z,MSG_BR
       D119                     MSGA1:
000AF8 D119 F5              11      PUSH    AF
000AF9 D11A C5              11      PUSH    BC
000AFA D11B D5              11      PUSH    DE
000AFB D11C E5              11      PUSH    HL
000AFC D11D DDE5            15      PUSH    IX
000AFE D11F DD21A200        14      LD  IX,CHPUT
000B02 D123 CD88D3          17      CALL    CALSLT_R
000B05 D126 DDE1            14      POP IX
000B07 D128 E1              10      POP HL
000B08 D129 D1              10      POP DE
000B09 D12A C1              10      POP BC
       D12B                     MSGA2:
000B0A D12B F1              10      POP AF
000B0B D12C C9              10      RET
       D12D                     MSG_BR:
000B0C D12D F5              11      PUSH    AF
000B0D D12E 3ADDF3          13      LD  A,(CSRX)
000B10 D131 FE02             7      CP  2
000B12 D133 38F6            12      JR  C,MSGA2
000B14 D135 F1              10      POP AF
       D136                     MSG_CR:
000B15 D136 F5              11      PUSH    AF
000B16 D137 3E0D             7      LD  A,00DH
000B18 D139 CD19D1          17      CALL    MSGA1
000B1B D13C 3E0A             7      LD  A,00AH
000B1D D13E CD19D1          17      CALL    MSGA1
000B20 D141 F1              10      POP AF
000B21 D142 C9              10      RET
                                
       D143                     _SYS02:     ;(BDOS)コンソール出力
000B22 D143 CD5FD1          17      CALL    BREAK
000B25 D146 C3CDE5          10      JP  _PRINT
                                
       D149                     _SYS06:     ;(BDOS)コンソール直接入出力
000B28 D149 7B               4      LD  A,E
000B29 D14A 3C               4      INC A
000B2A D14B CACAE5          10      JP  Z,_INKEY
000B2D D14E C3CDE5          10      JP  _PRINT
                                
       D151                     _SYS08:     ;(BDOS)エコーなしコンソール入力
000B30 D151 CD09E5          17      CALL    _SYS07
000B33 D154 FE03             7      CP  3
000B35 D156 CCF4E5          17      CALL    Z,_BREAK
000B38 D159 FE13             7      CP  013H        ;CTRL+S
000B3A D15B C0              11      RET NZ
       D15C                     PAUSE:
000B3B D15C CD76D1          17      CALL    KEYBC
                                
       D15F                     BREAK:
000B3E D15F F5              11      PUSH    AF
000B3F D160 C5              11      PUSH    BC
000B40 D161 D5              11      PUSH    DE
000B41 D162 E5              11      PUSH    HL
000B42 D163 DDE5            15      PUSH    IX
000B44 D165 DD21B700        14      LD  IX,BREAKX
000B48 D169 CD88D3          17      CALL    CALSLT_R
000B4B D16C DDE1            14      POP IX
000B4D D16E E1              10      POP HL
000B4E D16F D1              10      POP DE
000B4F D170 C1              10      POP BC
000B50 D171 DCF4E5          17      CALL    C,_BREAK
000B53 D174 F1              10      POP AF
000B54 D175 C9              10      RET
       D176                     KEYBC:
000B55 D176 F5              11      PUSH    AF
000B56 D177 C5              11      PUSH    BC
000B57 D178 D5              11      PUSH    DE
000B58 D179 E5              11      PUSH    HL
000B59 D17A DDE5            15      PUSH    IX
000B5B D17C DD215601        14      LD  IX,KILBUF
000B5F D180 CD88D3          17      CALL    CALSLT_R
000B62 D183 DDE1            14      POP IX
000B64 D185 E1              10      POP HL
000B65 D186 D1              10      POP DE
000B66 D187 C1              10      POP BC
000B67 D188 F1              10      POP AF
000B68 D189 C9              10      RET
       D18A                     FLGET:
000B69 D18A C5              11      PUSH    BC
000B6A D18B D5              11      PUSH    DE
000B6B D18C E5              11      PUSH    HL
000B6C D18D DDE5            15      PUSH    IX
000B6E D18F CDDFE5          17      CALL    _FFLUSH
000B71 D192 181B            12      JR  FLGET1
       D193                     CBIOS_SWC1  EQU $-1
000B73 D194 CD70D3          17      CALL    GETVRAM
                                
000B76 D197 E5              11      PUSH    HL
000B77 D198 DD214A00        14      LD  IX,RDVRM
000B7B D19C CD88D3          17      CALL    CALSLT_R
000B7E D19F E1              10      POP HL
000B7F D1A0 32BBD1          13      LD  (SWCCHR),A
                                
000B82 D1A3 E5              11      PUSH    HL
000B83 D1A4 3EFF             7      LD  A,0FFH
000B85 D1A6 DD214D00        14      LD  IX,WRTVRM
000B89 D1AA CD88D3          17      CALL    CALSLT_R
000B8C D1AD E1              10      POP HL
                                
000B8D D1AE E5              11      PUSH    HL
       D1AF                     FLGET1:
000B8E D1AF DD219F00        14      LD  IX,CHGET
000B92 D1B3 CD88D3          17      CALL    CALSLT_R
000B95 D1B6 180C            12      JR  FLGET2
       D1B7                     CBIOS_SWC2  EQU $-1
000B97 D1B8 E1              10      POP HL
                                
000B98 D1B9 F5              11      PUSH    AF
000B99 D1BA 3E00             7      LD  A,0
       D1BB                     SWCCHR  EQU $-1
000B9B D1BC DD214D00        14      LD  IX,WRTVRM
000B9F D1C0 CD88D3          17      CALL    CALSLT_R
000BA2 D1C3 F1              10      POP AF
       D1C4                     FLGET2:
000BA3 D1C4 DDE1            14      POP IX
000BA5 D1C6 E1              10      POP HL
000BA6 D1C7 D1              10      POP DE
000BA7 D1C8 C1              10      POP BC
000BA8 D1C9 FE03             7      CP  3
000BAA D1CB C0              11      RET NZ
000BAB D1CC C300E5          10      JP  CPM_BOOT
                                
       D1CF                     INKEY:
000BAE D1CF CD06E5          17      CALL    CPM_CONST
000BB1 D1D2 C8              11      RET Z
000BB2 D1D3 18B5            12      JR  FLGET
                                
       D1D5                     _SYS0A:     ;(BDOS)文字列入力
000BB4 D1D5 C5              11      PUSH    BC
000BB5 D1D6 E5              11      PUSH    HL
000BB6 D1D7 D5              11      PUSH    DE
000BB7 D1D8 CD01D2          17      CALL    GETL
000BBA D1DB 111FF4          10      LD  DE,KBUF
000BBD D1DE E1              10      POP HL
000BBE D1DF E5              11      PUSH    HL
000BBF D1E0 0E00             7      LD  C,0
000BC1 D1E2 3004            12      JR  NC,SAX0
000BC3 D1E4 23               6      INC HL
000BC4 D1E5 23               6      INC HL
000BC5 D1E6 1808            12      JR  SAX4
       D1E8                     SAX0:
000BC7 D1E8 46               7      LD  B,(HL)
000BC8 D1E9 23               6      INC HL
       D1EA                     SAX1:
000BC9 D1EA 23               6      INC HL
000BCA D1EB 1A               7      LD  A,(DE)
000BCB D1EC 13               6      INC DE
000BCC D1ED B7               4      OR  A
000BCD D1EE 2004            12      JR  NZ,SAX2
       D1F0                     SAX4:
000BCF D1F0 360D            10      LD  (HL),00DH
000BD1 D1F2 1804            12      JR  SAX3
       D1F4                     SAX2:
000BD3 D1F4 77               7      LD  (HL),A
000BD4 D1F5 0C               4      INC C
000BD5 D1F6 10F2            13      DJNZ    SAX1
       D1F8                     SAX3:
000BD7 D1F8 D1              10      POP DE
000BD8 D1F9 79               4      LD  A,C
000BD9 D1FA 13               6      INC DE
000BDA D1FB 12               7      LD  (DE),A
000BDB D1FC 1B               6      DEC DE
000BDC D1FD E1              10      POP HL
000BDD D1FE C1              10      POP BC
000BDE D1FF A7               4      AND A
000BDF D200 C9              10      RET
       D201                     GETL:
000BE0 D201 DDE5            15      PUSH    IX
000BE2 D203 FDE5            15      PUSH    IY
                                
000BE4 D205 2ADCF3          16      LD  HL,(CSRY)
000BE7 D208 22CAFB          16      LD  (FSTPOS),HL
       D20B                     GETL1:
000BEA D20B CD51D1          17      CALL    _SYS08
000BED D20E FE09             7      CP  9
000BEF D210 2008            12      JR  NZ,GETL1V
000BF1 D212 211FF4          10      LD  HL,KBUF
000BF4 D215 CD82CE          17      CALL    MSX
000BF7 D218 18F1            12      JR  GETL1
       D21A                     GETL1V:
000BF9 D21A 5F               4      LD  E,A
000BFA D21B FE08             7      CP  8
000BFC D21D CC16D3          17      CALL    Z,CTRL02
000BFF D220 FE20             7      CP  020H
000C01 D222 D442D3          17      CALL    NC,INSERT
000C04 D225 CD19D1          17      CALL    MSGA1
                                
000C07 D228 7B               4      LD  A,E
000C08 D229 FE0D             7      CP  00DH
000C0A D22B 20DE            12      JR  NZ,GETL1
                                
000C0C D22D 111FF4          10      LD  DE,KBUF
000C0F D230 3AB0F3          13      LD  A,(LINLEN)
000C12 D233 47               4      LD  B,A
000C13 D234 CD26CD          17      CALL    ZERO_MEMORY_DE
                                
000C16 D237 2ACAFB          16      LD  HL,(FSTPOS)
000C19 D23A 3ADCF3          13      LD  A,(CSRY)
000C1C D23D 6F               4      LD  L,A
000C1D D23E E5              11      PUSH    HL
000C1E D23F CD73D3          17      CALL    LOC0
000C21 D242 4D               4      LD  C,L
000C22 D243 44               4      LD  B,H
000C23 D244 E1              10      POP HL
000C24 D245 3AB0F3          13      LD  A,(LINLEN)
000C27 D248 94               4      SUB H
000C28 D249 3D               4      DEC A
000C29 D24A 5F               4      LD  E,A
000C2A D24B 211FF4          10      LD  HL,KBUF
       D24E                     GETL2:
000C2D D24E CDD0E5          17      CALL    _SCRN
000C30 D251 03               6      INC BC
000C31 D252 77               7      LD  (HL),A
000C32 D253 23               6      INC HL
000C33 D254 1D               4      DEC E
000C34 D255 20F7            12      JR  NZ,GETL2
000C36 D257 CD36D1          17      CALL    MSG_CR
                                
000C39 D25A FDE1            14      POP IY
000C3B D25C DDE1            14      POP IX
       D25E                     GETL3:
000C3D D25E 2B               6      DEC HL
000C3E D25F 7E               7      LD  A,(HL)
000C3F D260 FE21             7      CP  021H
000C41 D262 D0              11      RET NC
000C42 D263 3600            10      LD  (HL),0
000C44 D265 15               4      DEC D
000C45 D266 20F6            12      JR  NZ,GETL3
000C47 D268 C9              10      RET
                                
       D269                     _SYS0B:     ;(BDOS)コンソール状態のチェック
       D269                     CONSTX:
000C48 D269 C5              11      PUSH    BC
000C49 D26A D5              11      PUSH    DE
000C4A D26B E5              11      PUSH    HL
000C4B D26C DDE5            15      PUSH    IX
000C4D D26E DD219C00        14      LD  IX,CHSNS
000C51 D272 CD88D3          17      CALL    CALSLT_R
000C54 D275 DDE1            14      POP IX
000C56 D277 E1              10      POP HL
000C57 D278 D1              10      POP DE
000C58 D279 C1              10      POP BC
000C59 D27A C9              10      RET
                                
       D27B                     _SYS2A:     ;(BDOS)日付の獲得
000C5A D27B 0E0B             7      LD  C,11        ;年/Year→HL
000C5C D27D CDBCD2          17      CALL    RDCLK_BCD
000C5F D280 6F               4      LD  L,A
000C60 D281 2600             7      LD  H,0
000C62 D283 3AF8FA          13      LD  A,(EXBRSA)
000C65 D286 B7               4      OR  A
000C66 D287 2804            12      JR  Z,SX2A1
000C68 D289 11BC07          10      LD  DE,1980     ;1980年～2079年
000C6B D28C 19              11      ADD HL,DE
       D28D                     SX2A1:
000C6C D28D 0E09             7      LD  C,9     ;月/Month→D
000C6E D28F CDBCD2          17      CALL    RDCLK_BCD
000C71 D292 57               4      LD  D,A
                                
000C72 D293 0E07             7      LD  C,7     ;日/Day→E
000C74 D295 CDBCD2          17      CALL    RDCLK_BCD
000C77 D298 5F               4      LD  E,A
                                
000C78 D299 0E06             7      LD  C,6     ;曜日/Week→A
       D29B                     RDCLK:
000C7A D29B DDE5            15      PUSH    IX
000C7C D29D DD21F501        14      LD  IX,REDCLK
       D2A1                     WRCLK1:
000C80 D2A1 3AF8FA          13      LD  A,(EXBRSA)
000C83 D2A4 B7               4      OR  A
000C84 D2A5 280A            12      JR  Z,RDCLK1    ;MSX1
000C86 D2A7 FDE5            15      PUSH    IY
000C88 D2A9 FD67             9      LD  IYH,A
000C8A D2AB 78               4      LD  A,B
000C8B D2AC CDA4D3          17      CALL    CALSLTR
000C8E D2AF FDE1            14      POP IY
       D2B1                     RDCLK1:
000C90 D2B1 DDE1            14      POP IX
000C92 D2B3 C9              10      RET
       D2B4                     WRCLK:
000C93 D2B4 DDE5            15      PUSH    IX
000C95 D2B6 DD21F901        14      LD  IX,WRTCLK
000C99 D2BA 18E5            12      JR  WRCLK1
                                
       D2BC                     RDCLK_BCD:
000C9B D2BC CD9BD2          17      CALL    RDCLK       ;1の位
000C9E D2BF 47               4      LD  B,A
000C9F D2C0 0C               4      INC C
000CA0 D2C1 CD9BD2          17      CALL    RDCLK       ;10の位
000CA3 D2C4 87               4      ADD A,A     ;*2
000CA4 D2C5 4F               4      LD  C,A
000CA5 D2C6 87               4      ADD A,A     ;*4
000CA6 D2C7 87               4      ADD A,A     ;*8
000CA7 D2C8 81               4      ADD A,C     ;*10(8+2)
000CA8 D2C9 80               4      ADD A,B     ;1の位
000CA9 D2CA C9              10      RET
                                
       D2CB                     _SYS2C:     ;(BDOS)時刻の獲得
000CAA D2CB 011501          10      LD  BC,00115H       ;12時間計/24時間計の設定を24時間計に
000CAD D2CE CDB4D2          17      CALL    WRCLK
000CB0 D2D1 0E04             7      LD  C,4     ;H=時/Hour
000CB2 D2D3 CDBCD2          17      CALL    RDCLK_BCD
000CB5 D2D6 67               4      LD  H,A
000CB6 D2D7 0E02             7      LD  C,2     ;L=分/Minute
000CB8 D2D9 CDBCD2          17      CALL    RDCLK_BCD
000CBB D2DC 6F               4      LD  L,A
000CBC D2DD 0E00             7      LD  C,0     ;D=秒/Second
000CBE D2DF CDBCD2          17      CALL    RDCLK_BCD
000CC1 D2E2 57               4      LD  D,A
000CC2 D2E3 AF               4      XOR A       ;E=1/100秒
000CC3 D2E4 5F               4      LD  E,A
000CC4 D2E5 C9              10      RET
                                
       D2E6                     POS:
000CC5 D2E6 F5              11      PUSH    AF
000CC6 D2E7 2ADCF3          16      LD  HL,(CSRY)
000CC9 D2EA 7D               4      LD  A,L
000CCA D2EB 6C               4      LD  L,H
000CCB D2EC 67               4      LD  H,A
000CCC D2ED 2C               4      INC L
000CCD D2EE 24               4      INC H
000CCE D2EF F1              10      POP AF
000CCF D2F0 C9              10      RET
                                
       D2F1                     LOC:
000CD0 D2F1 F5              11      PUSH    AF
000CD1 D2F2 E5              11      PUSH    HL
000CD2 D2F3 7D               4      LD  A,L
000CD3 D2F4 6C               4      LD  L,H
000CD4 D2F5 67               4      LD  H,A
000CD5 D2F6 2D               4      DEC L
000CD6 D2F7 25               4      DEC H
000CD7 D2F8 DDE5            15      PUSH    IX
000CD9 D2FA DD21C600        14      LD  IX,POSIT
000CDD D2FE CD88D3          17      CALL    CALSLT_R
000CE0 D301 DDE1            14      POP IX
000CE2 D303 E1              10      POP HL
000CE3 D304 F1              10      POP AF
000CE4 D305 C9              10      RET
       D306                     SCRN:
000CE5 D306 E5              11      PUSH    HL
000CE6 D307 DDE5            15      PUSH    IX
                                
000CE8 D309 69               4      LD  L,C
000CE9 D30A 60               4      LD  H,B
000CEA D30B DD214A00        14      LD  IX,RDVRM
000CEE D30F CD88D3          17      CALL    CALSLT_R
                                
000CF1 D312 DDE1            14      POP IX
000CF3 D314 E1              10      POP HL
000CF4 D315 C9              10      RET
                                
       D316                     CTRL02:
000CF5 D316 F5              11      PUSH    AF
000CF6 D317 D5              11      PUSH    DE
000CF7 D318 2ADCF3          16      LD  HL,(CSRY)
000CFA D31B 3AB0F3          13      LD  A,(LINLEN)
000CFD D31E 4F               4      LD  C,A
000CFE D31F 94               4      SUB H   ;CSRX
000CFF D320 C602             7      ADD A,2
000D01 D322 47               4      LD  B,A ;カーソルより右の文字数
000D02 D323 61               4      LD  H,C ;LINLEN
000D03 D324 C5              11      PUSH    BC
000D04 D325 CD73D3          17      CALL    LOC0
000D07 D328 C1              10      POP BC
                                
000D08 D329 1620             7      LD  D,020H
       D32B                     C8X1:
000D0A D32B DD214A00        14      LD  IX,RDVRM
000D0E D32F CD88D3          17      CALL    CALSLT_R
000D11 D332 4F               4      LD  C,A
000D12 D333 7A               4      LD  A,D
000D13 D334 DD214D00        14      LD  IX,WRTVRM
000D17 D338 CD88D3          17      CALL    CALSLT_R
000D1A D33B 2B               6      DEC HL
000D1B D33C 51               4      LD  D,C
000D1C D33D 10EC            13      DJNZ    C8X1
000D1E D33F D1              10      POP DE
000D1F D340 F1              10      POP AF
000D20 D341 C9              10      RET
                                
       D342                     INSERT:
000D21 D342 F5              11      PUSH    AF
000D22 D343 D5              11      PUSH    DE
000D23 D344 2ADCF3          16      LD  HL,(CSRY)
000D26 D347 3AB0F3          13      LD  A,(LINLEN)
000D29 D34A 4F               4      LD  C,A
000D2A D34B 94               4      SUB H   ;CSRX
000D2B D34C 3C               4      INC A
000D2C D34D 47               4      LD  B,A ;カーソルより右の文字数
000D2D D34E C5              11      PUSH    BC
000D2E D34F CD73D3          17      CALL    LOC0
000D31 D352 C1              10      POP BC
                                
000D32 D353 1620             7      LD  D,020H
       D355                     INS1:
000D34 D355 DD214A00        14      LD  IX,RDVRM
000D38 D359 CD88D3          17      CALL    CALSLT_R
000D3B D35C 4F               4      LD  C,A
000D3C D35D 7A               4      LD  A,D
000D3D D35E DD214D00        14      LD  IX,WRTVRM
000D41 D362 CD88D3          17      CALL    CALSLT_R
000D44 D365 23               6      INC HL
000D45 D366 51               4      LD  D,C
000D46 D367 10EC            13      DJNZ    INS1
000D48 D369 D1              10      POP DE
000D49 D36A F1              10      POP AF
000D4A D36B C9              10      RET
                                
       D36C                     CONOUT1:
000D4B D36C 59               4      LD  E,C
000D4C D36D C3CDE5          10      JP  _PRINT
                                
       D370                     GETVRAM:
000D4F D370 2ADCF3          16      LD  HL,(CSRY)
       D373                     LOC0:
000D52 D373 2D               4      DEC L
000D53 D374 25               4      DEC H
000D54 D375 4C               4      LD  C,H ;CSRX-1
000D55 D376 5D               4      LD  E,L ;CSRY-1
       D377                     LOC1:
000D56 D377 3AB0F3          13      LD  A,(LINLEN)
000D59 D37A 67               4      LD  H,A
000D5A D37B 1600             7      LD  D,0
000D5C D37D 6A               4      LD  L,D ;0
000D5D D37E 0608             7      LD  B,8
       D380                     LOC2:
000D5F D380 29              11      ADD HL,HL
000D60 D381 3001            12      JR  NC,LOC3
000D62 D383 19              11      ADD HL,DE
       D384                     LOC3:
000D63 D384 10FA            13      DJNZ    LOC2
000D65 D386 09              11      ADD HL,BC
000D66 D387 C9              10      RET
                                
       D388                     CALSLT_R:
000D67 D388 FDE5            15      PUSH    IY
000D69 D38A FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
000D6D D38E CDA4D3          17      CALL    CALSLTR
000D70 D391 FDE1            14      POP IY
000D72 D393 C9              10      RET
                                
       D394                     CALLF:
000D73 D394 08               4      EX  AF,AF'
000D74 D395 E3              19      EX  (SP),HL
000D75 D396 7E               7      LD  A,(HL)
000D76 D397 FD67             9      LD  IYH,A
000D78 D399 23               6      INC HL
000D79 D39A 7E               7      LD  A,(HL)
000D7A D39B DD6F             9      LD  IXL,A
000D7C D39D 23               6      INC HL
000D7D D39E 7E               7      LD  A,(HL)
000D7E D39F DD67             9      LD  IXH,A
000D80 D3A1 23               6      INC HL
000D81 D3A2 E3              19      EX  (SP),HL
000D82 D3A3 08               4      EX  AF,AF'
       D3A4                     CALSLTR:
000D83 D3A4 F3               4      DI
000D84 D3A5 ED73DED3        20      LD  (CSSP),SP
000D88 D3A9 F5              11      PUSH    AF
000D89 D3AA 3E1C             7      LD  A,_CALSLT
       D3AC                     SLTCALL:
000D8B D3AC 32CBD3          13      LD  (SLTCALLX),A
000D8E D3AF 3ADFD3          13      LD  A,(CSSP+1)
000D91 D3B2 FE41             7      CP  040H+1
000D93 D3B4 3005            12      JR  NC,CALSLTR1
000D95 D3B6 F1              10      POP AF
000D96 D3B7 315EF5          10      LD  SP,BUF
000D99 D3BA F5              11      PUSH    AF
       D3BB                     CALSLTR1:
000D9A D3BB C5              11      PUSH    BC
000D9B D3BC D5              11      PUSH    DE
000D9C D3BD E5              11      PUSH    HL
000D9D D3BE 2600             7      LD  H,0
000D9F D3C0 3AC1FC          13      LD  A,(EXPTBL)  ;メインROMに切り替える
000DA2 D3C3 CDE2D4          17      CALL    ENASLT
000DA5 D3C6 E1              10      POP HL
000DA6 D3C7 D1              10      POP DE
000DA7 D3C8 C1              10      POP BC
000DA8 D3C9 F1              10      POP AF
000DA9 D3CA CD1C00          17      CALL    _CALSLT
       D3CB                     SLTCALLX    EQU $-2
000DAC D3CD F5              11      PUSH    AF
000DAD D3CE C5              11      PUSH    BC
000DAE D3CF D5              11      PUSH    DE
000DAF D3D0 E5              11      PUSH    HL
000DB0 D3D1 2600             7      LD  H,0
000DB2 D3D3 3A41F3          13      LD  A,(0F341H)  ;メインRAMに戻す
000DB5 D3D6 CDE2D4          17      CALL    ENASLT
000DB8 D3D9 E1              10      POP HL
000DB9 D3DA D1              10      POP DE
000DBA D3DB C1              10      POP BC
000DBB D3DC F1              10      POP AF
000DBC D3DD 310000          10      LD  SP,0
       D3DE                     CSSP    EQU $-2
000DBF D3E0 FB               4      EI
000DC0 D3E1 C9              10      RET
                                
       D3E2                     RDSLTR:
000DC1 D3E2 ED73DED3        20      LD  (CSSP),SP
000DC5 D3E6 F5              11      PUSH    AF
000DC6 D3E7 3E0C             7      LD  A,_RDSLT
000DC8 D3E9 18C1            12      JR  SLTCALL
                                
       D3EB                     WRSLTR:
000DCA D3EB ED73DED3        20      LD  (CSSP),SP
000DCE D3EF F5              11      PUSH    AF
000DCF D3F0 3E14             7      LD  A,_WRSLT
000DD1 D3F2 18B8            12      JR  SLTCALL
                                
       D3F4                     INT38H:
000DD3 D3F4 F5              11      PUSH    AF
000DD4 D3F5 E5              11      PUSH    HL          ;メインROMを呼び出すのでスタックが被っていないかチェック
000DD5 D3F6 2A20D4          16      LD  HL,(INTSP)
000DD8 D3F9 7C               4      LD  A,H
000DD9 D3FA B5               4      OR  L
000DDA D3FB 202D            12      JR  NZ,INT38H2
000DDC D3FD C5              11      PUSH    BC
000DDD D3FE D5              11      PUSH    DE
000DDE D3FF 2100BF          10      LD  HL,010000H-04100H   ;Page1
000DE1 D402 39              11      ADD HL,SP
000DE2 D403 ED7320D4        20      LD  (INTSP),SP
000DE6 D407 3803            12      JR  C,INT38H1
000DE8 D409 315EF5          10      LD  SP,BUF
       D40C                     INT38H1:
000DEB D40C 2600             7      LD  H,0
000DED D40E 3AC1FC          13      LD  A,(EXPTBL)  ;メインROMに切り替える
000DF0 D411 CDE2D4          17      CALL    ENASLT
000DF3 D414 CD3800          17      CALL    00038H
000DF6 D417 2600             7      LD  H,0
000DF8 D419 3A41F3          13      LD  A,(0F341H)  ;メインRAMに戻す
000DFB D41C CDE2D4          17      CALL    ENASLT
000DFE D41F 310000          10      LD  SP,0
       D420                     INTSP   EQU $-2
000E01 D422 210000          10      LD  HL,0
000E04 D425 2220D4          16      LD  (INTSP),HL
000E07 D428 D1              10      POP DE
000E08 D429 C1              10      POP BC
       D42A                     INT38H2:
000E09 D42A E1              10      POP HL
000E0A D42B F1              10      POP AF
000E0B D42C FB               4      EI
000E0C D42D C9              10      RET
                                
[EOF:MSXIO.ASM:SHIFT_JIS]
                                    INCLUDE "LDFILE.ASM"
                                
                                ;   LSX-Dodgers FILE
                                
                                ;   【注意】バイナリサイズを下位1バイトを0丁度に調整する必要あり(X1/88)
       0000                     CHECK_FILE_SIZE EQU (FILEC-FILE_E) & 0FFH
       D5C5                     FILEC:
000FA4 D5C5 CDD0D5          17      CALL    FILE
       D5C8                     FILEC2:
000FA7 D5C8 3A15E5          13      LD  A,(FDRV+1)
000FAA D5CB FE20             7      CP  020H
000FAC D5CD C8              11      RET Z
000FAD D5CE 1839            12      JR  SETDIR1
                                
       D5D0                     FILE:
000FAF D5D0 AF               4      XOR A
000FB0 D5D1 3214E5          13      LD  (FDRV),A
000FB3 D5D4 67               4      LD  H,A
000FB4 D5D5 6F               4      LD  L,A
000FB5 D5D6 2222E5          16      LD  (FDRV+14),HL
000FB8 D5D9 CDA6D6          17      CALL    SPCUT
000FBB D5DC CD8BD6          17      CALL    CCHK3
000FBE D5DF 2812            12      JR  Z,DEVI1
000FC0 D5E1 13               6      INC DE
000FC1 D5E2 1A               7      LD  A,(DE)
000FC2 D5E3 1B               6      DEC DE
000FC3 D5E4 FE3A             7      CP  ':'
000FC5 D5E6 200B            12      JR  NZ,DEVI1
000FC7 D5E8 1A               7      LD  A,(DE)      ;DRIVE
000FC8 D5E9 CDECD8          17      CALL    CAP
000FCB D5EC D640             7      SUB '@'
000FCD D5EE 13               6      INC DE
000FCE D5EF 13               6      INC DE
000FCF D5F0 3214E5          13      LD  (FDRV),A
       D5F3                     DEVI1:
000FD2 D5F3 1A               7      LD  A,(DE)
000FD3 D5F4 D65C             7      SUB 05CH        ;\
000FD5 D5F6 2009            12      JR  NZ,NOROOT
000FD7 D5F8 6F               4      LD  L,A     ;A=0でH=0のはずなのでHL=0
000FD8 D5F9 222EE5          16      LD  (FDRV+26),HL
000FDB D5FC 2C               4      INC L
000FDC D5FD 2222E5          16      LD  (FDRV+14),HL
000FDF D600 13               6      INC DE
       D601                     NOROOT:
                                
       D601                     SETDIR:
000FE0 D601 CD2CD6          17      CALL    FILED
000FE3 D604 1A               7      LD  A,(DE)
000FE4 D605 FE5C             7      CP  05CH        ;\
000FE6 D607 C0              11      RET NZ
000FE7 D608 13               6      INC DE
       D609                     SETDIR1:
000FE8 D609 3E10             7      LD  A,010H      ;Directory
000FEA D60B 3221E5          13      LD  (FDRV+13),A
000FED D60E D5              11      PUSH    DE
000FEE D60F 1114E5          10      LD  DE,FDRV
000FF1 D612 0E0F             7      LD  C,00FH      ;(BDOS)ファイルのオープン
000FF3 D614 CD42CE          17      CALL    BDOS0
000FF6 D617 D1              10      POP DE
000FF7 D618 B7               4      OR  A
000FF8 D619 C0              11      RET NZ
                                
000FF9 D61A 3A21E5          13      LD  A,(FDRV+13)
000FFC D61D E610             7      AND 010H        ;ディレクトリ
000FFE D61F C8              11      RET Z
                                
000FFF D620 CD73D6          17      CALL    FILEI
001002 D623 2A2EE5          16      LD  HL,(FDRV+26)
001005 D626 23               6      INC HL
001006 D627 2222E5          16      LD  (FDRV+14),HL
001009 D62A 18D5            12      JR  SETDIR
                                
       D62C                     FILED:
00100B D62C CD73D6          17      CALL    FILEI
00100E D62F 2115E5          10      LD  HL,FNAME
                                
001011 D632 0608             7      LD  B,8
       D634                     FILE2:
001013 D634 CD80D6          17      CALL    CCHKF
001016 D637 C8              11      RET Z
001017 D638 FE2A             7      CP  '*'
001019 D63A 282E            12      JR  Z,FILE9
00101B D63C FE2E             7      CP  '.'
00101D D63E 280C            12      JR  Z,FILE4
00101F D640 77               7      LD  (HL),A
001020 D641 23               6      INC HL
001021 D642 10F0            13      DJNZ    FILE2
                                
       D644                     FILE3:
001023 D644 CD80D6          17      CALL    CCHKF
001026 D647 C8              11      RET Z
001027 D648 FE2E             7      CP  '.'
001029 D64A 20F8            12      JR  NZ,FILE3
                                
       D64C                     FILE4:
00102B D64C 211DE5          10      LD  HL,FNAME+8
00102E D64F 0603             7      LD  B,3
                                
       D651                     FILE4L:
001030 D651 CD80D6          17      CALL    CCHKF
001033 D654 C8              11      RET Z
001034 D655 FE2E             7      CP  '.'
001036 D657 2008            12      JR  NZ,FILE12
001038 D659 3215E5          13      LD  (FNAME),A   ;Parent directory(..)
00103B D65C 3216E5          13      LD  (FNAME+1),A
00103E D65F 3E20             7      LD  A,020H
       D661                     FILE12:
001040 D661 FE2A             7      CP  '*'
001042 D663 280A            12      JR  Z,FILE10
001044 D665 77               7      LD  (HL),A
001045 D666 23               6      INC HL
001046 D667 10E8            13      DJNZ    FILE4L
001048 D669 C9              10      RET
                                
       D66A                     FILE9:              ;名前の*処理、名前の残りを?で埋める
001049 D66A CD6FD6          17      CALL    FILE10
00104C D66D 18D5            12      JR  FILE3
                                
       D66F                     FILE10:
00104E D66F 3E3F             7      LD  A,'?'
001050 D671 1808            12      JR  FILL_MEMORY
       D673                     FILEI:              ;名前＋拡張子をスペースで初期化
001052 D673 3E20             7      LD  A,020H
001054 D675 01000B          10      LD  BC,11*256   ;C=0にしておく
001057 D678 2115E5          10      LD  HL,FNAME
       D67B                     FILL_MEMORY:            ;HLからBバイトAで埋める
00105A D67B 77               7      LD  (HL),A
00105B D67C 23               6      INC HL
00105C D67D 10FC            13      DJNZ    FILL_MEMORY
00105E D67F C9              10      RET
                                
       D680                     CCHKF:
00105F D680 1A               7      LD  A,(DE)
001060 D681 CD88D6          17      CALL    CCHK2
001063 D684 C8              11      RET Z
001064 D685 C3F4D9          10      JP  FKAN
                                
       D688                     CCHK2:
001067 D688 0C               4      INC C
001068 D689 0D               4      DEC C
001069 D68A C0              11      RET NZ
       D68B                     CCHK3:              ;ZF=1 で使えない文字
00106A D68B FE2B             7      CP  '+'
00106C D68D C8              11      RET Z
00106D D68E FE2C             7      CP  ','
00106F D690 C8              11      RET Z
001070 D691 FE2F             7      CP  '/'
001072 D693 C8              11      RET Z
001073 D694 FE3A             7      CP  ':'
001075 D696 C8              11      RET Z
001076 D697 FE3B             7      CP  ';'
001078 D699 C8              11      RET Z
001079 D69A FE3D             7      CP  '='
00107B D69C C8              11      RET Z
00107C D69D FE5C             7      CP  05CH    ;\
00107E D69F C8              11      RET Z
00107F D6A0 FE20             7      CP  020H
001081 D6A2 D0              11      RET NC
001082 D6A3 BF               4      CP  A       ;Z=1
001083 D6A4 C9              10      RET
                                
       D6A5                     SS1:
001084 D6A5 13               6      INC DE
       D6A6                     SPCUT:              ;スペースをカット
001085 D6A6 1A               7      LD  A,(DE)
001086 D6A7 FE20             7      CP  020H
001088 D6A9 28FA            12      JR  Z,SS1
00108A D6AB C9              10      RET
                                
       D6AC                     SETDRVF:
00108B D6AC 1114E5          10      LD  DE,FDRV
       D6AF                     SETDRV0:
00108E D6AF CDB8D6          17      CALL    SETDRV
001091 D6B2 FDE1            14      POP IY
001093 D6B4 C1              10      POP BC
001094 D6B5 D1              10      POP DE
001095 D6B6 E1              10      POP HL
001096 D6B7 C9              10      RET
                                
       D6B8                     SETDRV:
001097 D6B8 E3              19      EX  (SP),HL     ;HL=RETRN ADDRESS
001098 D6B9 D5              11      PUSH    DE      ;PUSH HL/DE/BC/IY
001099 D6BA C5              11      PUSH    BC
00109A D6BB 1A               7      LD  A,(DE)
00109B D6BC D5              11      PUSH    DE
00109C D6BD FDE3            23      EX  (SP),IY
                                
00109E D6BF CDC6D6          17      CALL    GETDRV
0010A1 D6C2 CDD9E5          17      CALL    _CHGDRV
                                
0010A4 D6C5 E9               4      JP  (HL)
                                
       D6C6                     GETDRV:
0010A5 D6C6 CDD9D6          17      CALL    GETDRV1
0010A8 D6C9 3288E5          13      LD  (_DRV),A
0010AB D6CC C9              10      RET
                                
       D6CD                     IS_SAME_DRV_A_DE:
                                ;   A と (DE) が同じドライブか調べる
                                ;   ZF=1ならば同じドライブ
0010AC D6CD CDD9D6          17      CALL    GETDRV1
0010AF D6D0 C5              11      PUSH    BC
0010B0 D6D1 4F               4      LD  C,A
0010B1 D6D2 1A               7      LD  A,(DE)
0010B2 D6D3 CDD9D6          17      CALL    GETDRV1
0010B5 D6D6 A9               4      XOR C
0010B6 D6D7 C1              10      POP BC
0010B7 D6D8 C9              10      RET
       D6D9                     GETDRV1:
0010B8 D6D9 E67F             7      AND 07FH
0010BA D6DB D601             7      SUB 001H
0010BC D6DD D0              11      RET NC
0010BD D6DE 3A0400          13      LD  A,(_DVSW)   ;Current Drive
0010C0 D6E1 C9              10      RET
                                
       D6E2                     SOPENX:
0010C1 D6E2 1139E5          10      LD  DE,SFILE
0010C4 D6E5 FD7E00          19      LD  A,(IY+0)        ;(FCB)ドライブ番号
0010C7 D6E8 CDCDD6          17      CALL    IS_SAME_DRV_A_DE
0010CA D6EB 2024            12      JR  NZ,SOPEN
0010CC D6ED 13               6      INC DE
0010CD D6EE FDE5            15      PUSH    IY
0010CF D6F0 E1              10      POP HL
0010D0 D6F1 23               6      INC HL
0010D1 D6F2 CD7DD8          17      CALL    CPFILE
0010D4 D6F5 201A            12      JR  NZ,SOPEN
                                
0010D6 D6F7 2AF4E6          16      LD  HL,(SCDIR)
0010D9 D6FA FD750E          19      LD  (IY+14),L   ;(FCB)アクセスするディレクトリのクラスタ番号+1
0010DC D6FD FD740F          19      LD  (IY+15),H
                                
0010DF D700 2AF8E6          16      LD  HL,(SFNDF)  ;Direcroty location and Flags
0010E2 D703 229FE5          16      LD  (_FILEN),HL
                                
0010E5 D706 ED5BF6E6        20      LD  DE,(SFBPS)
0010E9 D70A 2139E5          10      LD  HL,SFILE
0010EC D70D 36FF            10      LD  (HL),0FFH
0010EE D70F 23               6      INC HL
0010EF D710 C9              10      RET
       D711                     SOPEN:
0010F0 D711 2125D8          10      LD  HL,FILESE
       D714                     SOPENC:
0010F3 D714 224DD7          16      LD  (OPENPAT),HL
                                
0010F6 D717 CDE2E5          17      CALL    _RDFATX     ;Detect Media
0010F9 D71A 3856            12      JR  C,RDDERR
                                
0010FB D71C AF               4      XOR A
0010FC D71D 329FE5          13      LD  (_FILEN),A
0010FF D720 CD29D9          17      CALL    LDDIRX1     ;A=0で呼び出す
001102 D723 2818            12      JR  Z,SDIRX1
                                
001104 D725 CD16D8          17      CALL    READ_DIR    ;Sub Directory
001107 D728 3808            12      JR  C,SDIRX0
001109 D72A 2A7EE6          16      LD  HL,(_DTBUF)
00110C D72D 7E               7      LD  A,(HL)
00110D D72E FE2E             7      CP  '.'
00110F D730 280F            12      JR  Z,SOPEN1
       D732                     SDIRX0:
001111 D732 AF               4      XOR A
001112 D733 32A0E5          13      LD  (_DIRF),A
001115 D736 FD360E01        19      LD  (IY+14),1   ;(FCB)レコードサイズ
001119 D73A FD770F          19      LD  (IY+15),A
       D73D                     SDIRX1:
00111C D73D ED5BFCE6        20      LD  DE,(_DIRPS) ;Root Directory
       D741                     SOPEN1:
001120 D741 0E20             7      LD  C,32        ;自己書き換え 1セクタ辺りのディレクトリエントリ数  1024=32 / 512=16 / 256=8
       D742                     SDECPAT EQU $-1
       D743                     SOPEN1X:
001122 D743 CD16D8          17      CALL    READ_DIR    ;FILE SEARCH
001125 D746 382A            12      JR  C,RDDERR
001127 D748 2A7EE6          16      LD  HL,(_DTBUF)
       D74B                     SOPEN2:
00112A D74B D5              11      PUSH    DE
00112B D74C CD25D8          17      CALL    FILESE      ;(self-modifying code)
       D74D                     OPENPAT EQU $-2
00112E D74F D1              10      POP DE
00112F D750 386D            12      JR  C,SOPENE
001131 D752 281B            12      JR  Z,SCF_FF_RET
       D754                     SOPEN3:
001133 D754 3AA0E5          13      LD  A,(_DIRF)   ;ディレクトリか判別
001136 D757 B7               4      OR  A
001137 D758 200C            12      JR  NZ,SOPEN5
001139 D75A 13               6      INC DE      ;ルートディレクトリ
00113A D75B E5              11      PUSH    HL
00113B D75C 210C00          10      LD  HL,12       ;(self-modifying code)MAXDIR
       D75D                     MD_PAT  EQU $-2
00113E D75F ED52            15      SBC HL,DE       ;CF=0 なので SUB HL,DE
001140 D761 E1              10      POP HL
001141 D762 20DD            12      JR  NZ,SOPEN1
001143 D764 1807            12      JR  SOPEN6
       D766                     SOPEN5:
001145 D766 CD30E0          17      CALL    GNCLX       ;END DIR
001148 D769 D8              11      RET C
001149 D76A CDDDD8          17      CALL    ENDCL
       D76D                     SOPEN6:
00114C D76D 38D2            12      JR  C,SOPEN1
       D76F                     SCF_FF_RET:
00114E D76F 37               4      SCF         ;CF=1
00114F D770 9F               4      SBC A,A     ;A=0FFH
001150 D771 C9              10      RET
                                
       D772                     RDDERR:
001151 D772 BF               4      CP  A       ;READ ERR CF=1 ZF=1
001152 D773 37               4      SCF
001153 D774 C9              10      RET
                                
       D775                     NOPEN:
001154 D775 2125D8          10      LD  HL,FILESE
001157 D778 224DD7          16      LD  (OPENPAT),HL
00115A D77B FD2A98E5        20      LD  IY,(_FCB)
00115E D77F CD07DA          17      CALL    CHKWILDX
001161 D782 30EB            12      JR  NC,SCF_FF_RET
001163 D784 FD7E00          19      LD  A,(IY+0)
001166 D787 CDC6D6          17      CALL    GETDRV
001169 D78A CDD9E5          17      CALL    _CHGDRV
00116C D78D D8              11      RET C
00116D D78E 2AF8E6          16      LD  HL,(SFNDF)  ;Direcroty location and Flags
001170 D791 229FE5          16      LD  (_FILEN),HL
                                
001173 D794 CD24D9          17      CALL    LDDIRX
001176 D797 ED5B9AE5        20      LD  DE,(_FBPS)
00117A D79B CD16D8          17      CALL    READ_DIR
00117D D79E 38D2            12      JR  C,RDDERR
00117F D7A0 3A9EE5          13      LD  A,(_FBCNT)
001182 D7A3 3D               4      DEC A
001183 D7A4 28AE            12      JR  Z,SOPEN3
       D7A6                     NOPEN2:
001185 D7A6 2A9CE5          16      LD  HL,(_FBAD)
001188 D7A9 012000          10      LD  BC,020H
00118B D7AC 09              11      ADD HL,BC
00118C D7AD 4F               4      LD  C,A
00118D D7AE 189B            12      JR  SOPEN2
                                
       D7B0                     SOPENE2:
00118F D7B0 229CE5          16      LD  (_FBAD),HL
001192 D7B3 79               4      LD  A,C
001193 D7B4 329EE5          13      LD  (_FBCNT),A
001196 D7B7 ED539AE5        20      LD  (_FBPS),DE
00119A D7BB FD2298E5        20      LD  (_FCB),IY
       D7BF                     SOPENE:
00119E D7BF AF               4      XOR A
00119F D7C0 C9              10      RET
                                
       D7C1                     COPEN:
0011A0 D7C1 FD360D20        19      LD  (IY+13),020H    ;(FCB)属性(アトリビュート)
                                
0011A4 D7C5 2142D8          10      LD  HL,NEXTSE
0011A7 D7C8 CD14D7          17      CALL    SOPENC
0011AA D7CB D0              11      RET NC
0011AB D7CC C8              11      RET Z
0011AC D7CD 3AA0E5          13      LD  A,(_DIRF)   ;ディレクトリか判別
0011AF D7D0 B7               4      OR  A
0011B0 D7D1 37               4      SCF
0011B1 D7D2 C8              11      RET Z       ;ルートディレクトリ
0011B2 D7D3 0601             7      LD  B,1
0011B4 D7D5 CD66DA          17      CALL    WRDF
0011B7 D7D8 D8              11      RET C
0011B8 D7D9 ED5BFEE6        20      LD  DE,(_CLPS)
0011BC D7DD D5              11      PUSH    DE
0011BD D7DE CDA6D8          17      CALL    DCPAT
0011C0 D7E1 CDB1DE          17      CALL    DRDNX
0011C3 D7E4 2A7EE6          16      LD  HL,(_DTBUF) ;ディレクトリエントリを0クリア
0011C6 D7E7 ED4B9CDD        20      LD  BC,(SECSZ)  ;1セクタのサイズ
0011CA D7EB AF               4      XOR A
       D7EC                     COPENCL:
0011CB D7EC 77               7      LD  (HL),A
0011CC D7ED EDA1            16      CPI         ;HL=HL+1 BC=BC-1 BCが0の場合にP/V=0
0011CE D7EF EAECD7          10      JP  PE,COPENCL
                                
0011D1 D7F2 3AC4D8          13      LD  A,(SPCPAT)  ;1クラスタの論理セクタ数
0011D4 D7F5 3D               4      DEC A
0011D5 D7F6 2819            12      JR  Z,COPENE
0011D7 D7F8 3E01             7      LD  A,1     ;1セクタ辺りのセクタ数が2以上の場合
0011D9 D7FA 3228E0          13      LD  (_SECPS),A
0011DC D7FD D1              10      POP DE      ;DE=(_CLPS)
0011DD D7FE D5              11      PUSH    DE
       D7FF                     COPEN1:
0011DE D7FF D5              11      PUSH    DE      ;データバッファに入らないセクタもゼロクリア
0011DF D800 C5              11      PUSH    BC
0011E0 D801 2A7EE6          16      LD  HL,(_DTBUF)
0011E3 D804 CDC0D8          17      CALL    CLUSTX
0011E6 D807 CDC7E1          17      CALL    DWT24
0011E9 D80A C1              10      POP BC
0011EA D80B D1              10      POP DE
0011EB D80C CD27E0          17      CALL    NEXTX
0011EE D80F 20EE            12      JR  NZ,COPEN1
       D811                     COPENE:
0011F0 D811 2A7EE6          16      LD  HL,(_DTBUF)
0011F3 D814 D1              10      POP DE
0011F4 D815 C9              10      RET
                                
       D816                     READ_DIR:
0011F5 D816 ED53FEE6        20      LD  (_CLPS),DE
0011F9 D81A C5              11      PUSH    BC
0011FA D81B D5              11      PUSH    DE
0011FB D81C CDA6D8          17      CALL    DCPAT
0011FE D81F CD91DE          17      CALL    DRDX
001201 D822 D1              10      POP DE
001202 D823 C1              10      POP BC
001203 D824 C9              10      RET
                                
       D825                     FILESE:
001204 D825 7E               7      LD  A,(HL)
001205 D826 B7               4      OR  A
001206 D827 C8              11      RET Z       ;END:ZF=1 CF=0
001207 D828 FEE5             7      CP  0E5H
001209 D82A 280E            12      JR  Z,FILESE1
00120B D82C FDE5            15      PUSH    IY
00120D D82E D1              10      POP DE
00120E D82F 13               6      INC DE
00120F D830 E5              11      PUSH    HL
001210 D831 CD7DD8          17      CALL    CPFILE
001213 D834 CC9ED8          17      CALL    Z,CPFILE2
001216 D837 E1              10      POP HL
001217 D838 37               4      SCF
001218 D839 C8              11      RET Z       ;!!!:(ZF=1) CF=1
       D83A                     FILESE1:
001219 D83A CD51D8          17      CALL    FNEXT
00121C D83D 20E6            12      JR  NZ,FILESE
       D83F                     ZF0_CF0_AFF_RET:
00121E D83F F6FF             7      OR  0FFH        ;ZF=0 CF=0
001220 D841 C9              10      RET
                                
       D842                     NEXTSE:
001221 D842 7E               7      LD  A,(HL)
001222 D843 B7               4      OR  A
001223 D844 37               4      SCF
001224 D845 C8              11      RET Z       ;!!!:ZF=1 CF=1
001225 D846 FEE5             7      CP  0E5H
001227 D848 37               4      SCF
001228 D849 C8              11      RET Z       ;!!!:(ZF=1) CF=1
001229 D84A CD51D8          17      CALL    FNEXT
00122C D84D 20F3            12      JR  NZ,NEXTSE
00122E D84F 18EE            12      JR  ZF0_CF0_AFF_RET
                                
       D851                     FNEXT:
001230 D851 E5              11      PUSH    HL
001231 D852 219FE5          10      LD  HL,_FILEN
001234 D855 34              11      INC (HL)
001235 D856 E1              10      POP HL
001236 D857 112000          10      LD  DE,020H
001239 D85A 19              11      ADD HL,DE
00123A D85B 0D               4      DEC C
00123B D85C C9              10      RET
                                
       D85D                     CPNAME:
00123C D85D C5              11      PUSH    BC
00123D D85E D5              11      PUSH    DE
00123E D85F E5              11      PUSH    HL
00123F D860 CD77D8          17      CALL    CPFILE4
001242 D863 E1              10      POP HL
001243 D864 23               6      INC HL
001244 D865 23               6      INC HL
001245 D866 23               6      INC HL
001246 D867 23               6      INC HL
001247 D868 D1              10      POP DE
001248 D869 C1              10      POP BC
001249 D86A 2005            12      JR  NZ,CPNAME1
00124B D86C 7E               7      LD  A,(HL)
00124C D86D 23               6      INC HL
00124D D86E 66               7      LD  H,(HL)
00124E D86F 6F               4      LD  L,A
00124F D870 C9              10      RET
       D871                     CPNAME1:
001250 D871 23               6      INC HL
001251 D872 23               6      INC HL
001252 D873 10E8            13      DJNZ    CPNAME
001254 D875 37               4      SCF
001255 D876 C9              10      RET
                                
       D877                     CPFILE4:
001256 D877 C5              11      PUSH    BC
001257 D878 010004          10      LD  BC,00400H
00125A D87B 1804            12      JR  CPSTR1
       D87D                     CPFILE:
00125C D87D C5              11      PUSH    BC
00125D D87E 01000B          10      LD  BC,00B00H
       D881                     CPSTR1:
001260 D881 1A               7      LD  A,(DE)
001261 D882 FE3F             7      CP  '?'     ;Wild card
001263 D884 2812            12      JR  Z,CPSTR2
001265 D886 7E               7      LD  A,(HL)
001266 D887 CDEDD9          17      CALL    FKANC
001269 D88A E5              11      PUSH    HL
00126A D88B 67               4      LD  H,A
00126B D88C 1A               7      LD  A,(DE)
00126C D88D CB01             8      RLC C
00126E D88F CDEDD9          17      CALL    FKANC
001271 D892 CB09             8      RRC C
001273 D894 BC               4      CP  H       ;CP (HL),(DE)
001274 D895 E1              10      POP HL
001275 D896 2004            12      JR  NZ,CPSTR3
       D898                     CPSTR2:
001277 D898 13               6      INC DE
001278 D899 23               6      INC HL
001279 D89A 10E5            13      DJNZ    CPSTR1
       D89C                     CPSTR3:
00127B D89C C1              10      POP BC
00127C D89D C9              10      RET
                                
       D89E                     CPFILE2:
00127D D89E FD7E0D          19      LD  A,(IY+13)   ;(FCB)属性(アトリビュート)
001280 D8A1 F6E1             7      OR  0E1H
001282 D8A3 2F               4      CPL
001283 D8A4 A6               7      AND (HL)
001284 D8A5 C9              10      RET
                                
       D8A6                     DCPAT:
001285 D8A6 0E00             7      LD  C,0
001287 D8A8 2A7EE6          16      LD  HL,(_DTBUF)
00128A D8AB 3AA0E5          13      LD  A,(_DIRF)   ;ディレクトリか判別
00128D D8AE B7               4      OR  A
00128E D8AF C8              11      RET Z       ;ルートディレクトリの場合はCレジスタを0にしておく(CDEがセクタ番号)
00128F D8B0 3AC4D8          13      LD  A,(SPCPAT)
001292 D8B3 4F               4      LD  C,A
001293 D8B4 3A28E0          13      LD  A,(_SECPS)
001296 D8B7 B9               4      CP  C
001297 D8B8 3801            12      JR  C,DC1
001299 D8BA AF               4      XOR A
       D8BB                     DC1:
00129A D8BB F680             7      OR  080H
00129C D8BD 32A0E5          13      LD  (_DIRF),A   ;bit0-6:セクタインデックス
       D8C0                     CLUSTX:
00129F D8C0 E5              11      PUSH    HL
0012A0 D8C1 EB               4      EX  DE,HL
0012A1 D8C2 AF               4      XOR A
0012A2 D8C3 0E01             7      LD  C,1     ;自己書き換え（1クラスタの論理セクタ数）
       D8C4                     SPCPAT  EQU $-1
       D8C5                     L_CLDBL:
0012A4 D8C5 CB19             8      RR  C       ;->CF
0012A6 D8C7 3804            12      JR  C,E_CLDBL
0012A8 D8C9 29              11      ADD HL,HL       ;*2
0012A9 D8CA 8F               4      ADC A,A
0012AA D8CB 18F8            12      JR  L_CLDBL
       D8CD                     E_CLDBL:
0012AC D8CD 4F               4      LD  C,A
0012AD D8CE 3A28E0          13      LD  A,(_SECPS)
0012B0 D8D1 B5               4      OR  L
0012B1 D8D2 6F               4      LD  L,A
0012B2 D8D3 110800          10      LD  DE,8    ;+8 (2D)  !ADDCL (self-modifying code)
       D8D4                     CLSPAT  EQU $-2
0012B5 D8D6 AF               4      XOR A
0012B6 D8D7 19              11      ADD HL,DE   ;データ格納領域の先頭論理セクタ番号
0012B7 D8D8 89               4      ADC A,C
0012B8 D8D9 4F               4      LD  C,A
0012B9 D8DA EB               4      EX  DE,HL
0012BA D8DB E1              10      POP HL
0012BB D8DC C9              10      RET
                                ;(8)
       D8DD                     ENDCL:
0012BC D8DD 7A               4      LD  A,D ;END CLUSTER
0012BD D8DE FE01             7      CP  1   ;164=356    (self-modifying code)
       D8DF                     CLPAT1  EQU $-1
0012BF D8E0 C0              11      RET NZ
0012C0 D8E1 7B               4      LD  A,E
0012C1 D8E2 FE64             7      CP  064H    ;       (self-modifying code)
       D8E3                     CLPAT2  EQU $-1
0012C3 D8E4 C9              10      RET
                                ;(3)
       D8E5                     CAP4:
0012C4 D8E5 3EE5             7      LD  A,0E5H
0012C6 D8E7 C9              10      RET
                                                    ;for X1/88 ワークエリア
0012C7 D8E8 5BE5                    DW  _DISKE+1        ;DISKVE($F323)
0012C9 D8EA F5E5                    DW  _BREAK+1        ;BREAKV($F325)
                                
       D8EC                     CAP:            ;(9)
0012CB D8EC FE61             7      CP  'a'
0012CD D8EE D8              11      RET C
0012CE D8EF FE7B             7      CP  'z'+1
0012D0 D8F1 D0              11      RET NC
0012D1 D8F2 D620             7      SUB 020H
0012D3 D8F4 C9              10      RET
                                ;(10)
       D8F5                     CAP2:
0012D4 D8F5 CDECD8          17      CALL    CAP
       D8F8                     CAP3:               ;
0012D7 D8F8 FE05             7      CP  5
0012D9 D8FA 28E9            12      JR  Z,CAP4
0012DB D8FC FE21             7      CP  021H
0012DD D8FE C9              10      RET
                                                    ;
       D8FF                     CHDIR:
0012DE D8FF CDD8E2          17      CALL    GETDPBD
0012E1 D902 381D            12      JR  C,CHDIR2
0012E3 D904 DD751A          19      LD  (IX+DPB_SDIR),L
0012E6 D907 DD741B          19      LD  (IX+DPB_SDIR+1),H
0012E9 D90A 1815            12      JR  CHDIR2      ;POP_IX_RET
                                
       D90C                     LDDIR:
0012EB D90C CDD8E2          17      CALL    GETDPBD
0012EE D90F DD5E1A          19      LD  E,(IX+DPB_SDIR)
0012F1 D912 DD561B          19      LD  D,(IX+DPB_SDIR+1)
0012F4 D915 13               6      INC DE
0012F5 D916 FD730E          19      LD  (IY+14),E   ;(FCB)アクセスするディレクトリのクラスタ番号+1
0012F8 D919 FD720F          19      LD  (IY+15),D
0012FB D91C 1B               6      DEC DE
0012FC D91D AF               4      XOR A
0012FD D91E 32A0E5          13      LD  (_DIRF),A
       D921                     CHDIR2:
001300 D921 DDE1            14      POP IX
001302 D923 C9              10      RET
                                
       D924                     LDDIRX:
001303 D924 3AA0E5          13      LD  A,(_DIRF)   ;(FCB)アクセスするディレクトリのセクタインデックス
001306 D927 E67F             7      AND 07FH
       D929                     LDDIRX1:
001308 D929 3228E0          13      LD  (_SECPS),A
00130B D92C FD5E0E          19      LD  E,(IY+14)   ;(FCB)アクセスするディレクトリのクラスタ番号+1
00130E D92F FD560F          19      LD  D,(IY+15)
001311 D932 1B               6      DEC DE
001312 D933 CDDDD8          17      CALL    ENDCL
001315 D936 D40CD9          17      CALL    NC,LDDIR
       D939                     LDDIRS:
001318 D939 7A               4      LD  A,D
001319 D93A B3               4      OR  E
00131A D93B 32A0E5          13      LD  (_DIRF),A   ;ディレクトリか判別
00131D D93E C9              10      RET
                                
       D93F                     KILL:
00131E D93F CD07DA          17      CALL    CHKWILDX
001321 D942 3834            12      JR  C,KILLW
001323 D944 CDE2D6          17      CALL    SOPENX
       D947                     KILLS:
001326 D947 3E1F             7      LD  A,01FH
001328 D949 D48BD9          17      CALL    NC,CHKATT
00132B D94C D8              11      RET C
       D94D                     KILLSX:
00132C D94D 36E5            10      LD  (HL),0E5H   ;DIR
00132E D94F CDE3D9          17      CALL    WTDB
001331 D952 111A00          10      LD  DE,01AH
001334 D955 19              11      ADD HL,DE
001335 D956 5E               7      LD  E,(HL)
001336 D957 23               6      INC HL
001337 D958 56               7      LD  D,(HL)
       D959                     KILLS1:
001338 D959 CDDDD8          17      CALL    ENDCL
00133B D95C D0              11      RET NC      ;CF=0
00133C D95D 21FEFF          10      LD  HL,0-2
00133F D960 19              11      ADD HL,DE
001340 D961 D0              11      RET NC      ;DE= 0 or 1
001341 D962 D5              11      PUSH    DE
001342 D963 CDF7E5          17      CALL    _GNCL
001345 D966 ED53FEE6        20      LD  (_CLPS),DE
001349 D96A D1              10      POP DE
00134A D96B 210000          10      LD  HL,0
00134D D96E D4FAE5          17      CALL    NC,_SNCL
001350 D971 D8              11      RET C
001351 D972 ED5BFEE6        20      LD  DE,(_CLPS)  ;FAT
001355 D976 18E1            12      JR  KILLS1
                                
       D978                     KILLW:
001357 D978 CD11D7          17      CALL    SOPEN
       D97B                     KILLW1:
00135A D97B 380B            12      JR  C,KILLW2
00135C D97D CDB0D7          17      CALL    SOPENE2
00135F D980 CD47D9          17      CALL    KILLS
001362 D983 CD75D7          17      CALL    NOPEN
001365 D986 18F3            12      JR  KILLW1
       D988                     KILLW2:
001367 D988 C8              11      RET Z
001368 D989 3F               4      CCF
001369 D98A C9              10      RET
                                
       D98B                     CHKATT:
00136A D98B E5              11      PUSH    HL
00136B D98C 110B00          10      LD  DE,00BH
00136E D98F 19              11      ADD HL,DE
00136F D990 A6               7      AND (HL)
001370 D991 E1              10      POP HL
001371 D992 C8              11      RET Z
001372 D993 37               4      SCF
001373 D994 C9              10      RET
                                
       D995                     NAME:
001374 D995 CD07DA          17      CALL    CHKWILDX
001377 D998 D8              11      RET C
001378 D999 110400          10      LD  DE,4
00137B D99C 19              11      ADD HL,DE
00137C D99D 22B2D9          16      LD  (NAMEP),HL
00137F D9A0 23               6      INC HL
001380 D9A1 CD0BDA          17      CALL    CHKWILD
001383 D9A4 D8              11      RET C
                                
001384 D9A5 CDE2D6          17      CALL    SOPENX
001387 D9A8 3E0F             7      LD  A,00FH
001389 D9AA D48BD9          17      CALL    NC,CHKATT
00138C D9AD D8              11      RET C
                                
00138D D9AE FDE5            15      PUSH    IY
00138F D9B0 FD210000        14      LD  IY,0        ;自己書き換え
       D9B2                     NAMEP   EQU $-2
001393 D9B4 CDE2D6          17      CALL    SOPENX
001396 D9B7 FDE3            23      EX  (SP),IY
001398 D9B9 3F               4      CCF
001399 D9BA D411D7          17      CALL    NC,SOPEN
00139C D9BD EB               4      EX  DE,HL
00139D D9BE E1              10      POP HL
00139E D9BF D8              11      RET C
                                
       D9C0                     SETNAME:
00139F D9C0 01000B          10      LD  BC,11*256
0013A2 D9C3 23               6      INC HL
0013A3 D9C4 7E               7      LD  A,(HL)
0013A4 D9C5 FEE5             7      CP  0E5H
0013A6 D9C7 2004            12      JR  NZ,SNAME1
0013A8 D9C9 3E05             7      LD  A,5
0013AA D9CB 180E            12      JR  SNAME3
       D9CD                     SNAME1:
0013AC D9CD 7E               7      LD  A,(HL)
0013AD D9CE 0C               4      INC C
0013AE D9CF 0D               4      DEC C
0013AF D9D0 2009            12      JR  NZ,SNAME3
0013B1 D9D2 CDECD8          17      CALL    CAP
0013B4 D9D5 FEA0             7      CP  0A0H
0013B6 D9D7 2002            12      JR  NZ,SNAME3
0013B8 D9D9 3E20             7      LD  A,020H
       D9DB                     SNAME3:
0013BA D9DB 12               7      LD  (DE),A
0013BB D9DC 7E               7      LD  A,(HL)
0013BC D9DD 23               6      INC HL
0013BD D9DE CDF4D9          17      CALL    FKAN
0013C0 D9E1 10EA            13      DJNZ    SNAME1
       D9E3                     WTDB:               ;バッファデータが更新された
0013C2 D9E3 3EFF             7      LD  A,0FFH
0013C4 D9E5 3239E5          13      LD  (SFILE),A
0013C7 D9E8 32A4E5          13      LD  (_WTDBF),A
0013CA D9EB AF               4      XOR A
0013CB D9EC C9              10      RET
                                
       D9ED                     FKANC:
0013CC D9ED CB41             8      BIT 0,C
0013CE D9EF CCF5D8          17      CALL    Z,CAP2
0013D1 D9F2 1801            12      JR  FKANX
       D9F4                     FKAN:           ;漢字チェック
0013D3 D9F4 13               6      INC DE
       D9F5                     FKANX:
0013D4 D9F5 CB41             8      BIT 0,C
0013D6 D9F7 CB81             8      RES 0,C
0013D8 D9F9 C0              11      RET NZ
0013D9 D9FA FE80             7      CP  080H
0013DB D9FC D8              11      RET C
0013DC D9FD FEA0             7      CP  0A0H
0013DE D9FF 3803            12      JR  C,FKAN1
0013E0 DA01 FEE0             7      CP  0E0H
0013E2 DA03 D8              11      RET C
       DA04                     FKAN1:
0013E3 DA04 0C               4      INC C
0013E4 DA05 A7               4      AND A
0013E5 DA06 C9              10      RET
                                
       DA07                     CHKWILDX:
0013E6 DA07 FDE5            15      PUSH    IY
0013E8 DA09 E1              10      POP HL
0013E9 DA0A 23               6      INC HL
       DA0B                     CHKWILD:
0013EA DA0B 060B             7      LD  B,11
0013EC DA0D 3E3F             7      LD  A,'?'
       DA0F                     CHKWIL1:
0013EE DA0F BE               7      CP  (HL)
0013EF DA10 23               6      INC HL
0013F0 DA11 37               4      SCF
0013F1 DA12 C8              11      RET Z
0013F2 DA13 10FA            13      DJNZ    CHKWIL1
0013F4 DA15 AF               4      XOR A
0013F5 DA16 C9              10      RET
                                
       DA17                     SDIRENT:        ;IY=FCB HL=DIR
0013F6 DA17 D5              11      PUSH    DE
0013F7 DA18 E5              11      PUSH    HL
0013F8 DA19 FDE5            15      PUSH    IY
0013FA DA1B D1              10      POP DE
0013FB DA1C EB               4      EX  DE,HL
0013FC DA1D CDC0D9          17      CALL    SETNAME
                                ;               Attribute
0013FF DA20 FD7E0D          19      LD  A,(IY+13)   ;(FCB)属性(アトリビュート)
001402 DA23 12               7      LD  (DE),A
001403 DA24 13               6      INC DE
                                ;               Reserved
001404 DA25 AF               4      XOR A
001405 DA26 060A             7      LD  B,10
       DA28                     SDE1:
001407 DA28 12               7      LD  (DE),A
001408 DA29 13               6      INC DE
001409 DA2A 10FC            13      DJNZ    SDE1
                                                    ;(FCB)更新時刻
00140B DA2C 21E4E6          10      LD  HL,SDDATA       ;(FCB)更新年月日
00140E DA2F 060A             7      LD  B,SDDATAE-SDDATA    ;(FCB)ファイルの先頭クラスタ
       DA31                     SDLOOP:                 ;(FCB)ファイルのサイズ(バイト単位)
001410 DA31 7E               7      LD  A,(HL)
001411 DA32 23               6      INC HL
001412 DA33 3238DA          13      LD  (SDPAT),A
001415 DA36 FD7E00          19      LD  A,(IY+0)    ;LD A,(IY+A)
       DA38                     SDPAT   EQU $-1
001418 DA39 12               7      LD  (DE),A
001419 DA3A 13               6      INC DE
00141A DA3B 10F4            13      DJNZ    SDLOOP
                                
00141C DA3D AF               4      XOR A
00141D DA3E E1              10      POP HL
00141E DA3F D1              10      POP DE
00141F DA40 C9              10      RET
                                
       DA41                     WOPEN:
001420 DA41 FD7E0D          19      LD  A,(IY+13)   ;(FCB)属性(アトリビュート)
001423 DA44 E61F             7      AND 01FH
001425 DA46 37               4      SCF
001426 DA47 C0              11      RET NZ
001427 DA48 FD361CFE        19      LD  (IY+28),0FEH    ;(FCB)オープンモード
       DA4C                     TOPEN2:
00142B DA4C AF               4      XOR A
       DA4D                     TOPEN:              ;Initializes the time stamp
00142C DA4D FD3617FF        19      LD  (IY+23),0FFH    ;(FCB)更新時刻
001430 DA51 C9              10      RET
                                
       DA52                     WRDFX:
001431 DA52 3AC4D8          13      LD  A,(SPCPAT)  ;1クラスタの論理セクタ
       DA55                     L_WRFX:
001434 DA55 1F               4      RRA         ;->CF
001435 DA56 3806            12      JR  C,E_WRFX
001437 DA58 CB39             8      SRL C
001439 DA5A CB1C             8      RR  H       ;CH=CH/2
00143B DA5C 18F7            12      JR  L_WRFX
       DA5E                     E_WRFX:
00143D DA5E 41               4      LD  B,C
00143E DA5F 4C               4      LD  C,H
00143F DA60 03               6      INC BC
001440 DA61 3E37             7      LD  A,037H      ;SCF
001442 DA63 32AEDE          13      LD  (DRDN1),A
                                
       DA66                     WRDF:               ;BCクラスタ分FATを確保する
001445 DA66 110200          10      LD  DE,2
001448 DA69 AF               4      XOR A
001449 DA6A 3228E0          13      LD  (_SECPS),A
       DA6D                     WRDF1:
00144C DA6D C5              11      PUSH    BC
00144D DA6E D5              11      PUSH    DE
00144E DA6F CDF7E5          17      CALL    _GNCL
001451 DA72 381C            12      JR  C,WRDF3
001453 DA74 7A               4      LD  A,D     ;空いているかチェック
001454 DA75 B3               4      OR  E
001455 DA76 202A            12      JR  NZ,WRDF4
001457 DA78 E1              10      POP HL      ;HL=空いているクラスタ
001458 DA79 E5              11      PUSH    HL
001459 DA7A ED5BFEE6        20      LD  DE,(_CLPS)  ;DE=元の(_CLPS)
00145D DA7E 22FEE6          16      LD  (_CLPS),HL
001460 DA81 7A               4      LD  A,D     ;元の(_CLPS)が 0 か?
001461 DA82 B3               4      OR  E
001462 DA83 2008            12      JR  NZ,WRDF2
001464 DA85 FD751A          19      LD  (IY+26),L   ;(FCB)ファイルの先頭クラスタ
001467 DA88 FD741B          19      LD  (IY+27),H   ;元が空の場合はFCBにクラスタをセットする
00146A DA8B 1803            12      JR  WRDF3
       DA8D                     WRDF2:
00146C DA8D CDFAE5          17      CALL    _SNCL
       DA90                     WRDF3:
00146F DA90 D1              10      POP DE
001470 DA91 C1              10      POP BC
001471 DA92 D8              11      RET C
001472 DA93 0B               6      DEC BC
001473 DA94 78               4      LD  A,B
001474 DA95 B1               4      OR  C
001475 DA96 200C            12      JR  NZ,WRDF5    ;ここでループカウンタチェック
001477 DA98 ED5BFEE6        20      LD  DE,(_CLPS)
00147B DA9C 21FFFF          10      LD  HL,0FFFFH   ;FATエントリ終了(EOCマーク)
00147E DA9F C3FAE5          10      JP  _SNCL
                                
       DAA2                     WRDF4:              ;DEクラスタが空じゃないので次に移動する
001481 DAA2 D1              10      POP DE
001482 DAA3 C1              10      POP BC
       DAA4                     WRDF5:
001483 DAA4 13               6      INC DE
001484 DAA5 CDDDD8          17      CALL    ENDCL
001487 DAA8 38C3            12      JR  C,WRDF1
001489 DAAA 37               4      SCF
00148A DAAB C9              10      RET
                                
       DAAC                     RWXR:
00148B DAAC 3A9DDD          13      LD  A,(SECSZ_H) ;1024=4 / 512=2 / 256=1
       DAAF                     L_RWX:
00148E DAAF 1F               4      RRA     ;->CF
00148F DAB0 3808            12      JR  C,E_RWX
001491 DAB2 CB38             8      SRL B   ;BCH=BCH/2
001493 DAB4 CB19             8      RR  C   ;
001495 DAB6 CB1C             8      RR  H   ;
001497 DAB8 18F5            12      JR  L_RWX
       DABA                     E_RWX:
001499 DABA FD5E1A          19      LD  E,(IY+26)   ;(FCB)ファイルの先頭クラスタ
00149C DABD FD561B          19      LD  D,(IY+27)
00149F DAC0 AF               4      XOR A
0014A0 DAC1 3228E0          13      LD  (_SECPS),A
       DAC4                     RWX1:
0014A3 DAC4 ED53FEE6        20      LD  (_CLPS),DE
0014A7 DAC8 7A               4      LD  A,D
0014A8 DAC9 B3               4      OR  E
0014A9 DACA 2813            12      JR  Z,SCF_RET   ;RET DE==0 => CF=1
                                
0014AB DACC 78               4      LD  A,B
0014AC DACD B1               4      OR  C
0014AD DACE B4               4      OR  H
0014AE DACF C8              11      RET Z       ;RET BCH==0 => CF=0
                                
0014AF DAD0 CD30E0          17      CALL    GNCLX
0014B2 DAD3 D8              11      RET C
0014B3 DAD4 7C               4      LD  A,H     ;
0014B4 DAD5 25               4      DEC H       ;
0014B5 DAD6 B7               4      OR  A       ;DEC BCH
0014B6 DAD7 2001            12      JR  NZ,RWX2     ;
0014B8 DAD9 0B               6      DEC BC      ;
       DADA                     RWX2:
0014B9 DADA CDDDD8          17      CALL    ENDCL
0014BC DADD 38E5            12      JR  C,RWX1
       DADF                     SCF_RET:
0014BE DADF 37               4      SCF
0014BF DAE0 C9              10      RET
                                
       DAE1                     DSKF:
0014C0 DAE1 110000          10      LD  DE,0
       DAE2                     MAXCLP  EQU $-2
0014C3 DAE4 2AACE5          16      LD  HL,(_FAKEFREE)
0014C6 DAE7 7C               4      LD  A,H
0014C7 DAE8 B5               4      OR  L
0014C8 DAE9 2803            12      JR  Z,DSKF1
0014CA DAEB 110100          10      LD  DE,1
       DAEE                     DSKF1:
0014CD DAEE D5              11      PUSH    DE
0014CE DAEF CDF7E5          17      CALL    _GNCL
0014D1 DAF2 380C            12      JR  C,POPSCF
0014D3 DAF4 7A               4      LD  A,D
0014D4 DAF5 B3               4      OR  E
0014D5 DAF6 2001            12      JR  NZ,DSKF2
0014D7 DAF8 23               6      INC HL
       DAF9                     DSKF2:
0014D8 DAF9 D1              10      POP DE
0014D9 DAFA 1B               6      DEC DE
0014DA DAFB 7A               4      LD  A,D
0014DB DAFC B3               4      OR  E
0014DC DAFD 20EF            12      JR  NZ,DSKF1
0014DE DAFF C9              10      RET
                                
       DB00                     POPSCF:
0014DF DB00 F1              10      POP AF
0014E0 DB01 37               4      SCF
0014E1 DB02 C9              10      RET
                                
       DB03                     SETTMS:
0014E2 DB03 FD7E17          19      LD  A,(IY+23)   ;(FCB)ファイルを最後に変更した時刻
0014E5 DB06 3C               4      INC A
0014E6 DB07 C0              11      RET NZ      ;ファイルが更新されていない
       DB08                     SETTMSX:            ;FCBに日付時刻をセットする
0014E7 DB08 CDCBD2          17      CALL    _SYS2C      ;(BDOS)時刻の獲得
                                                ;H←時  L←分  D←秒
0014EA DB0B CB25             8      SLA L       ;   *2
0014EC DB0D CB25             8      SLA L       ;   *4
0014EE DB0F 29              11      ADD HL,HL       ;*2 *8
0014EF DB10 29              11      ADD HL,HL       ;*4 *16
0014F0 DB11 29              11      ADD HL,HL       ;*8 *32
0014F1 DB12 7A               4      LD  A,D
0014F2 DB13 0F               4      RRCA            ;bit.0->7->->->0->C
0014F3 DB14 E61F             7      AND 01FH
0014F5 DB16 B5               4      OR  L
0014F6 DB17 FD7716          19      LD  (IY+22),A   ;(FCB)ファイルを最後に変更した時刻
0014F9 DB1A FD7417          19      LD  (IY+23),H
                                
0014FC DB1D CD7BD2          17      CALL    _SYS2A      ;(BDOS)日付の獲得
                                                ;HL←年  D←月  E←日
0014FF DB20 0144F8          10      LD  BC,0-1980
001502 DB23 09              11      ADD HL,BC
001503 DB24 65               4      LD  H,L
                                
001504 DB25 7A               4      LD  A,D
001505 DB26 87               4      ADD A,A     ;*2
001506 DB27 87               4      ADD A,A     ;*4
001507 DB28 87               4      ADD A,A     ;*8
001508 DB29 87               4      ADD A,A     ;*16
001509 DB2A 6F               4      LD  L,A
00150A DB2B 29              11      ADD HL,HL       ;*32
00150B DB2C 7D               4      LD  A,L
00150C DB2D B3               4      OR  E
00150D DB2E FD7714          19      LD  (IY+20),A   ;(FCB)ファイルを最後に変更した日付
001510 DB31 FD7415          19      LD  (IY+21),H
001513 DB34 C9              10      RET
                                ;(16)
       DB35                     PUSHRR:
001514 DB35 3261DE          13      LD  (SETSEQ_SWC_RND),A
001517 DB38 2273DE          16      LD  (SETSEQ_SWC_SEQ_RR),HL
00151A DB3B CD5BDB          17      CALL    GET_RR_AHL
00151D DB3E 220FE5          16      LD  (RR_BUF_HL),HL
001520 DB41 3211E5          13      LD  (RR_BUF_A),A
001523 DB44 C9              10      RET
                                ;(14)
       DB45                     GET_CPM_R_SIZE:     ;バイト単位からCP/Mのレコード単位を求める（1レコード=128バイト）
001524 DB45 87               4      ADD A,A     ;in BHLA => out AHL
001525 DB46 ED6A            15      ADC HL,HL
001527 DB48 CB18             8      RR  B
001529 DB4A B7               4      OR  A
00152A DB4B 78               4      LD  A,B     ;ここでフラグは変化しない
00152B DB4C C8              11      RET Z
00152C DB4D 2C               4      INC L       ;INC AHL
00152D DB4E C0              11      RET NZ      ;
00152E DB4F 24               4      INC H       ;
00152F DB50 C0              11      RET NZ      ;
001530 DB51 3C               4      INC A       ;
001531 DB52 C9              10      RET
                                ;(18)
       DB53                     INIT_RND:
001532 DB53 3ECD             7      LD  A,0CDH      ;CALL ????
001534 DB55 2172DB          10      LD  HL,POPRR
001537 DB58 CD35DB          17      CALL    PUSHRR
       DB5B                     GET_RR_AHL:
00153A DB5B FD6E21          19      LD  L,(IY+33)   ;(FCB)Random record
00153D DB5E FD6622          19      LD  H,(IY+34)   ;
001540 DB61 FD7E23          19      LD  A,(IY+35)   ;
001543 DB64 C9              10      RET
                                ;(10)
       DB65                     SET_RR_AHL:
001544 DB65 FD7521          19      LD  (IY+33),L   ;(FCB)Random record
001547 DB68 FD7422          19      LD  (IY+34),H   ;
00154A DB6B FD7723          19      LD  (IY+35),A   ;
00154D DB6E C9              10      RET
                                ;(17)
       DB6F                     SETSEQ:
00154E DB6F CD94DB          17      CALL    SETSEQ1
       DB72                     POPRR:
001551 DB72 F5              11      PUSH    AF
001552 DB73 E5              11      PUSH    HL
001553 DB74 2A0FE5          16      LD  HL,(RR_BUF_HL)
001556 DB77 3A11E5          13      LD  A,(RR_BUF_A)
001559 DB7A CD65DB          17      CALL    SET_RR_AHL
00155C DB7D E1              10      POP HL
00155D DB7E F1              10      POP AF
00155E DB7F C9              10      RET
                                ;(20)
       DB80                     GET_RR_BCDE:            ;BCDE=Random record
00155F DB80 FD5E21          19      LD  E,(IY+33)   ;(FCB)ランダムレコード
001562 DB83 FD5622          19      LD  D,(IY+34)
001565 DB86 FD4E23          19      LD  C,(IY+35)
001568 DB89 0600             7      LD  B,0     ;CP/M互換のアクセスの場合はFCBは36バイト
00156A DB8B FDCB207E        20      BIT 7,(IY+32)   ;(FCB)カレントレコード
00156E DB8F C0              11      RET NZ
00156F DB90 FD4624          19      LD  B,(IY+36)
001572 DB93 C9              10      RET
                                
       DB94                     SETSEQ1:
001573 DB94 F5              11      PUSH    AF
001574 DB95 E5              11      PUSH    HL      ;AHL=Random record
001575 DB96 CD5BDB          17      CALL    GET_RR_AHL
001578 DB99 47               4      LD  B,A     ;AHL→HLA
001579 DB9A 7D               4      LD  A,L     ;(IY+33)(FCB)ランダムレコード
00157A DB9B 6C               4      LD  L,H     ;(IY+34)
00157B DB9C 60               4      LD  H,B     ;(IY+35)
00157C DB9D 0600             7      LD  B,0
                                
00157E DB9F CD45DB          17      CALL    GET_CPM_R_SIZE
                                
001581 DBA2 29              11      ADD HL,HL
001582 DBA3 CB3D             8      SRL L       ;L=L/2
001584 DBA5 FD7520          19      LD  (IY+32),L   ;(FCB)カレントレコード
001587 DBA8 FD740C          19      LD  (IY+12),H   ;(FCB)カレントブロック
00158A DBAB E1              10      POP HL
00158B DBAC F1              10      POP AF
00158C DBAD C9              10      RET
                                
                                ;(23)
       DBAE                     RBXEND:             ;レコード数だけランダムレコードを進める
00158D DBAE 110000          10      LD  DE,0        ;進めるレコード数(RBSIZE)
       DBAF                     RBSIZE  EQU $-2
001590 DBB1 CD5BDB          17      CALL    GET_RR_AHL
001593 DBB4 19              11      ADD HL,DE
001594 DBB5 CE00             7      ADC A,0
001596 DBB7 CD65DB          17      CALL    SET_RR_AHL
001599 DBBA EB               4      EX  DE,HL       ;HL=進めるレコード数
00159A DBBB D0              11      RET NC
00159B DBBC FDCB207E        20      BIT 7,(IY+32)   ;(FCB)カレントレコード
00159F DBC0 C0              11      RET NZ
0015A0 DBC1 FD3424          23      INC (IY+36)
0015A3 DBC4 C9              10      RET
       DBC5                     FILE_E:
                                
       D76F                     _SYS03  EQU SCF_FF_RET  ;(BDOS)外部入力
       D76F                     _SYS2B  EQU SCF_FF_RET  ;(BDOS)日付の設定
       D76F                     _SYS2D  EQU SCF_FF_RET  ;(BDOS)時刻の設定
       D76F                     _SYS39  EQU SCF_FF_RET  ;(BDOS)サブディレクトリの作成
       D76F                     _SYS3A  EQU SCF_FF_RET  ;(BDOS)サブディレクトリの削除
                                
[EOF:LDFILE.ASM:SHIFT_JIS]
                                    INCLUDE "LDFILE2.ASM"
                                
                                ;   LSX-Dodgers FILE2
                                
                                                ;Write random block
       DBC5                     _SYS26:     ;(BDOS)ランダムブロック書き込み
0015A4 DBC5 AF               4      XOR A
0015A5 DBC6 32AEDE          13      LD  (DRDN1),A   ;NOP
0015A8 DBC9 22AFDB          16      LD  (RBSIZE),HL ;HL←書き込むレコード数
0015AB DBCC 225DE5          16      LD  (LEFTX),HL
0015AE DBCF CDB8D6          17      CALL    SETDRV
                                
0015B1 DBD2 CD38DD          17      CALL    RBX0
0015B4 DBD5 DA62DC          10      JP  C,RBWERR
0015B7 DBD8 CD41DA          17      CALL    WOPEN
0015BA DBDB DA62DC          10      JP  C,RBWERR
0015BD DBDE 7C               4      LD  A,H
0015BE DBDF B5               4      OR  L
0015BF DBE0 CA5BDC          10      JP  Z,RBW1
                                
0015C2 DBE3 2B               6      DEC HL
                                
0015C3 DBE4 CD80DB          17      CALL    GET_RR_BCDE ;BCDE=Random record
                                
0015C6 DBE7 19              11      ADD HL,DE       ;BCHL=HL+BCDE
0015C7 DBE8 3001            12      JR  NC,S26X1    ;
0015C9 DBEA 03               6      INC BC      ;
       DBEB                     S26X1:
0015CA DBEB CDACDA          17      CALL    RWXR
0015CD DBEE DC52DA          17      CALL    C,WRDFX
0015D0 DBF1 DA62DC          10      JP  C,RBWERR
                                
0015D3 DBF4 CD67DD          17      CALL    RBX2
0015D6 DBF7 281A            12      JR  Z,RBWB      ;NZ=セクタ以下の端数がある
0015D8 DBF9 CD86DD          17      CALL    RBXA
0015DB DBFC 3864            12      JR  C,RBWERR
0015DD DBFE EB               4      EX  DE,HL
0015DE DBFF C5              11      PUSH    BC
0015DF DC00 EDB0                    LDIR
0015E1 DC02 225FE5          16      LD  (DTAX),HL
                                
0015E4 DC05 CDE3D9          17      CALL    WTDB        ;バッファデータは更新された
                                
0015E7 DC08 2A5DE5          16      LD  HL,(LEFTX)
0015EA DC0B D1              10      POP DE
0015EB DC0C ED52            15      SBC HL,DE
0015ED DC0E 225DE5          16      LD  (LEFTX),HL
0015F0 DC11 2831            12      JR  Z,RBWEND
                                
       DC13                     RBWB:
0015F2 DC13 CDBBDD          17      CALL    RBXB
0015F5 DC16 2814            12      JR  Z,RBWC
       DC18                     RBWB1:
0015F7 DC18 C5              11      PUSH    BC
0015F8 DC19 D5              11      PUSH    DE
0015F9 DC1A CDC0D8          17      CALL    CLUSTX
0015FC DC1D CDDFDD          17      CALL    DWTC
0015FF DC20 D1              10      POP DE
001600 DC21 C1              10      POP BC
001601 DC22 D430E0          17      CALL    NC,GNCLX
001604 DC25 383B            12      JR  C,RBWERR
001606 DC27 10EF            13      DJNZ    RBWB1
001608 DC29 CD2FDE          17      CALL    DRW_FLUSH
       DC2C                     RBWC:
00160B DC2C CDD3DD          17      CALL    RBXC
00160E DC2F 2813            12      JR  Z,RBWEND
001610 DC31 C5              11      PUSH    BC
001611 DC32 CDC0D8          17      CALL    CLUSTX
001614 DC35 CDADDE          17      CALL    DRDN
001617 DC38 C1              10      POP BC
001618 DC39 3827            12      JR  C,RBWERR
00161A DC3B ED5B7EE6        20      LD  DE,(_DTBUF)
00161E DC3F EDB0                    LDIR
001620 DC41 CDE3D9          17      CALL    WTDB        ;バッファデータは更新された
       DC44                     RBWEND:
001623 DC44 CDAEDB          17      CALL    RBXEND
                                
001626 DC47 CD47DD          17      CALL    RBX1
001629 DC4A 300F            12      JR  NC,RBW1     ;ランダムレコードの方が大きい場合はサイズを合わせる
00162B DC4C CD80DB          17      CALL    GET_RR_BCDE ;BCDE=Random record
00162E DC4F FD7310          19      LD  (IY+16),E   ;ファイルのサイズ(バイト単位)
001631 DC52 FD7211          19      LD  (IY+17),D   ;
001634 DC55 FD7112          19      LD  (IY+18),C   ;
001637 DC58 FD7013          19      LD  (IY+19),B   ;
       DC5B                     RBW1:
00163A DC5B FDE1            14      POP IY
00163C DC5D C1              10      POP BC
00163D DC5E D1              10      POP DE
00163E DC5F E1              10      POP HL
       DC60                     DD_NUL:
00163F DC60 AF               4      XOR A
       DC61                     DRDF0:
       DC61                     DWTF0:
001640 DC61 C9              10      RET
                                
       DC62                     RBWERR:
001641 DC62 FDE5            15      PUSH    IY
001643 DC64 D1              10      POP DE
001644 DC65 0E10             7      LD  C,010H      ;(BDOS)ファイルのクローズ
001646 DC67 CD42CE          17      CALL    BDOS0
       DC6A                     RBRERR1:
001649 DC6A 3E01             7      LD  A,001H
       DC6C                     RBRERR2:
00164B DC6C FDE1            14      POP IY
00164D DC6E C1              10      POP BC
00164E DC6F D1              10      POP DE
00164F DC70 E1              10      POP HL
001650 DC71 37               4      SCF
001651 DC72 210000          10      LD  HL,0
001654 DC75 C9              10      RET
                                
       DC76                     RBRERR:
001655 DC76 3EFF             7      LD  A,0FFH
001657 DC78 18F2            12      JR  RBRERR2
                                
       DC7A                     RBRFL:
001659 DC7A 3E00             7  RBRFLP: LD  A,000H
00165B DC7C FE0D             7      CP  00DH
00165D DC7E 2005            12      JR  NZ,RBRFL1
00165F DC80 D5              11      PUSH    DE
001660 DC81 1E0A             7      LD  E,00AH
001662 DC83 1805            12      JR  RBRFL2
       DC85                     RBRFL1:
001664 DC85 D5              11      PUSH    DE
001665 DC86 CD09E5          17      CALL    _SYS07
001668 DC89 5F               4      LD  E,A
       DC8A                     RBRFL2:
001669 DC8A CDCDE5          17      CALL    _PRINT
00166C DC8D 7B               4      LD  A,E
00166D DC8E D1              10      POP DE
00166E DC8F 327BDC          13      LD  (RBRFLP+1),A
001671 DC92 C9              10      RET
                                
                                                ;Read random block
       DC93                     _SYS27:     ;(BDOS)ランダムブロック読み込み
001672 DC93 225DE5          16      LD  (LEFTX),HL
001675 DC96 CDB8D6          17      CALL    SETDRV
                                
001678 DC99 FDCB0D66        20      BIT 4,(IY+13)   ;(FCB)属性(アトリビュート)
00167C DC9D C226DD          10      JP  NZ,RBRDIR   ;ディレクトリ
00167F DCA0 CD38DD          17      CALL    RBX0
001682 DCA3 DA76DC          10      JP  C,RBRERR
001685 DCA6 CD47DD          17      CALL    RBX1
001688 DCA9 D45FDD          17      CALL    NC,RBX1R
00168B DCAC DA6ADC          10      JP  C,RBRERR1
00168E DCAF EB               4      EX  DE,HL
00168F DCB0 ED52            15      SBC HL,DE       ;CP 00HL,BCDE
001691 DCB2 19              11      ADD HL,DE
001692 DCB3 79               4      LD  A,C
001693 DCB4 DE00             7      SBC A,0
001695 DCB6 78               4      LD  A,B
001696 DCB7 DE00             7      SBC A,0
001698 DCB9 3801            12      JR  C,RBR1
00169A DCBB EB               4      EX  DE,HL
       DCBC                     RBR1:
00169B DCBC 9F               4      SBC A,A
00169C DCBD E601             7      AND 1
00169E DCBF 3224DD          13      LD  (RBRA_SWC),A
                                
0016A1 DCC2 7C               4      LD  A,H
0016A2 DCC3 B5               4      OR  L
0016A3 DCC4 2857            12      JR  Z,RBREND0
                                
0016A5 DCC6 22AFDB          16      LD  (RBSIZE),HL ;HL←読み込むレコード数
0016A8 DCC9 225DE5          16      LD  (LEFTX),HL
                                
0016AB DCCC CD67DD          17      CALL    RBX2
0016AE DCCF 2819            12      JR  Z,RBRB
0016B0 DCD1 CD86DD          17      CALL    RBXA
0016B3 DCD4 DA76DC          10      JP  C,RBRERR
0016B6 DCD7 C5              11      PUSH    BC
0016B7 DCD8 EDB0                    LDIR
0016B9 DCDA ED535FE5        20      LD  (DTAX),DE
0016BD DCDE 2A5DE5          16      LD  HL,(LEFTX)
0016C0 DCE1 D1              10      POP DE
0016C1 DCE2 A7               4      AND A
0016C2 DCE3 ED52            15      SBC HL,DE
0016C4 DCE5 225DE5          16      LD  (LEFTX),HL
0016C7 DCE8 2830            12      JR  Z,RBREND
                                
       DCEA                     RBRB:
0016C9 DCEA CDBBDD          17      CALL    RBXB
0016CC DCED 2815            12      JR  Z,RBRC
       DCEF                     RBRB1:
0016CE DCEF C5              11      PUSH    BC
0016CF DCF0 D5              11      PUSH    DE
0016D0 DCF1 CDC0D8          17      CALL    CLUSTX
0016D3 DCF4 CDE5DD          17      CALL    DRDC
0016D6 DCF7 D1              10      POP DE
0016D7 DCF8 C1              10      POP BC
0016D8 DCF9 D430E0          17      CALL    NC,GNCLX
0016DB DCFC DA76DC          10      JP  C,RBRERR
0016DE DCFF 10EE            13      DJNZ    RBRB1
0016E0 DD01 CD2FDE          17      CALL    DRW_FLUSH
       DD04                     RBRC:
0016E3 DD04 CDD3DD          17      CALL    RBXC
0016E6 DD07 2811            12      JR  Z,RBREND
0016E8 DD09 C5              11      PUSH    BC
0016E9 DD0A CDC0D8          17      CALL    CLUSTX
0016EC DD0D CD91DE          17      CALL    DRDX
0016EF DD10 C1              10      POP BC
0016F0 DD11 DA76DC          10      JP  C,RBRERR
0016F3 DD14 EB               4      EX  DE,HL
0016F4 DD15 2A7EE6          16      LD  HL,(_DTBUF)
0016F7 DD18 EDB0                    LDIR
       DD1A                     RBREND:
0016F9 DD1A CDAEDB          17      CALL    RBXEND
       DD1D                     RBREND0:
0016FC DD1D FDE1            14      POP IY
0016FE DD1F C1              10      POP BC
0016FF DD20 D1              10      POP DE
001700 DD21 F1              10      POP AF  ;(HL)
001701 DD22 AF               4      XOR A
001702 DD23 3E00             7      LD  A,000H
       DD24                     RBRA_SWC    EQU $-1
001704 DD25 C9              10      RET
                                
       DD26                     RBRDIR:
001705 DD26 FD6E1A          19      LD  L,(IY+26)   ;(FCB)ファイルの先頭クラスタ
001708 DD29 FD661B          19      LD  H,(IY+27)
00170B DD2C CDFFD8          17      CALL    CHDIR
00170E DD2F AF               4      XOR A
00170F DD30 67               4      LD  H,A
001710 DD31 6F               4      LD  L,A
001711 DD32 3C               4      INC A
001712 DD33 3224DD          13      LD  (RBRA_SWC),A
001715 DD36 18E5            12      JR  RBREND0
                                ;(15)
       DD38                     RBX0:
001717 DD38 2A8AE5          16      LD  HL,(_DTA)
00171A DD3B 225FE5          16      LD  (DTAX),HL
00171D DD3E 2A5DE5          16      LD  HL,(LEFTX)
001720 DD41 FD7E1C          19      LD  A,(IY+28)   ;(FCB)オープンモード
001723 DD44 D6FD             7      SUB 0FDH
001725 DD46 C9              10      RET
                                
       DD47                     RBX1:               ;ファイルサイズとランダムレコードを比べる
001726 DD47 E5              11      PUSH    HL      ;Record byte
                                                ;AHL=File size
001727 DD48 FD6E10          19      LD  L,(IY+16)   ;ファイルのサイズ(バイト単位)
00172A DD4B FD6611          19      LD  H,(IY+17)   ;
00172D DD4E FD7E12          19      LD  A,(IY+18)   ;
                                
001730 DD51 CD80DB          17      CALL    GET_RR_BCDE ;BCDE=Random record
                                
001733 DD54 A7               4      AND A
001734 DD55 ED52            15      SBC HL,DE
001736 DD57 99               4      SBC A,C
001737 DD58 4F               4      LD  C,A
001738 DD59 FD7E13          19      LD  A,(IY+19)   ;ファイルのサイズ
00173B DD5C 98               4      SBC A,B
00173C DD5D D1              10      POP DE
00173D DD5E C9              10      RET
       DD5F                     RBX1R:              ;(8)
00173E DD5F 47               4      LD  B,A
00173F DD60 B1               4      OR  C
001740 DD61 EB               4      EX  DE,HL   ;BCDE=File byte HL=Record byte
001741 DD62 B2               4      OR  D
001742 DD63 B3               4      OR  E
001743 DD64 C0              11      RET NZ
001744 DD65 37               4      SCF
001745 DD66 C9              10      RET
                                
       DD67                     RBX2:               ;Cluster settings
001746 DD67 FD6622          19      LD  H,(IY+34)   ;(+33)(FCB)ランダムレコード
001749 DD6A FD4E23          19      LD  C,(IY+35)
00174C DD6D 0600             7      LD  B,0
00174E DD6F FDCB207E        20      BIT 7,(IY+32)   ;(FCB)カレントレコード
001752 DD73 2003            12      JR  NZ,RBX3
001754 DD75 FD4624          19      LD  B,(IY+36)
       DD78                     RBX3:
001757 DD78 CDACDA          17      CALL    RWXR
00175A DD7B 3A9DDD          13      LD  A,(SECSZ_H) ;1024=4 / 512=2 / 256=1
00175D DD7E 3D               4      DEC A
00175E DD7F FDA622          19      AND (IY+34)
001761 DD82 FDB621          19      OR  (IY+33)
001764 DD85 C9              10      RET
                                
       DD86                     RBXA:
001765 DD86 C5              11      PUSH    BC
001766 DD87 D5              11      PUSH    DE
001767 DD88 CDC0D8          17      CALL    CLUSTX
00176A DD8B CD91DE          17      CALL    DRDX
00176D DD8E D1              10      POP DE
00176E DD8F C1              10      POP BC
00176F DD90 D430E0          17      CALL    NC,GNCLX
001772 DD93 D8              11      RET C
001773 DD94 ED53FEE6        20      LD  (_CLPS),DE
                                
001777 DD98 FD4E21          19      LD  C,(IY+33)   ;(FCB)ランダムレコード
00177A DD9B 210004          10      LD  HL,0400H    ;自己書き換え 1024=0400H / 512=0200H ここに1セクタのサイズが格納される
       DD9C                     SECSZ   EQU $-2
       DD9D                     SECSZ_H EQU $-1
00177D DD9E 7C               4      LD  A,H
00177E DD9F 3D               4      DEC A       ;1024=3 / 512=1
00177F DDA0 FDA622          19      AND (IY+34)     ;(FCB)ランダムレコード
001782 DDA3 47               4      LD  B,A     ;BCに1セクタ以下の端数が入る
001783 DDA4 ED42            15      SBC HL,BC       ;残りを計算
                                
001785 DDA6 ED5B5DE5        20      LD  DE,(LEFTX)
001789 DDAA ED52            15      SBC HL,DE       ;CP HL,DE
00178B DDAC 19              11      ADD HL,DE       ;
00178C DDAD 3801            12      JR  C,RBXA1     ;DEとHLを比較して大きい方をHLに
00178E DDAF EB               4      EX  DE,HL
       DDB0                     RBXA1:
00178F DDB0 E5              11      PUSH    HL
001790 DDB1 2A7EE6          16      LD  HL,(_DTBUF)
001793 DDB4 09              11      ADD HL,BC
001794 DDB5 ED5B5FE5        20      LD  DE,(DTAX)
001798 DDB9 C1              10      POP BC
001799 DDBA C9              10      RET
                                
       DDBB                     RBXB:
00179A DDBB 2A5FE5          16      LD  HL,(DTAX)
00179D DDBE ED5BFEE6        20      LD  DE,(_CLPS)
0017A1 DDC2 3A5EE5          13      LD  A,(LEFTX+1)
0017A4 DDC5 47               4      LD  B,A
0017A5 DDC6 3A9DDD          13      LD  A,(SECSZ_H) ;1024=4 / 512=2 / 256=1
       DDC9                     RBXB1:
0017A8 DDC9 1F               4      RRA     ;->CF
0017A9 DDCA 3804            12      JR  C,RBXB2
0017AB DDCC CB38             8      SRL B   ;B=B/2
0017AD DDCE 18F9            12      JR  RBXB1
       DDD0                     RBXB2:
0017AF DDD0 78               4      LD  A,B
0017B0 DDD1 B7               4      OR  A
0017B1 DDD2 C9              10      RET
                                ;(12)
       DDD3                     RBXC:
0017B2 DDD3 ED4B5DE5        20      LD  BC,(LEFTX)
0017B6 DDD7 3A9DDD          13      LD  A,(SECSZ_H) ;1024=4 / 512=2 / 256=1
0017B9 DDDA 3D               4      DEC A
0017BA DDDB A0               4      AND B
0017BB DDDC 47               4      LD  B,A     ;1セクタ以下の端数がない場合はZ
0017BC DDDD B1               4      OR  C
0017BD DDDE C9              10      RET
                                
                                ;   ランダムブロックアクセスの連続したセクタをまとめる
                                
       DDDF                     DWTC:
0017BE DDDF E5              11      PUSH    HL
0017BF DDE0 21C9E1          10      LD  HL,DWT24B
0017C2 DDE3 1804            12      JR  DWTC1
       DDE5                     DRDC:
0017C4 DDE5 E5              11      PUSH    HL
0017C5 DDE6 21BBE1          10      LD  HL,DRD24B
       DDE9                     DWTC1:
0017C8 DDE9 2243DE          16      LD  (DRWF_MODE),HL
0017CB DDEC E1              10      POP HL
0017CC DDED 3A33DE          13      LD  A,(DRWF_B)
0017CF DDF0 B7               4      OR  A
0017D0 DDF1 200F            12      JR  NZ,DRDC1
       DDF3                     SAVE_DRWC:
0017D2 DDF3 0601             7      LD  B,1
0017D4 DDF5 ED4332DE        20      LD  (DRWF_C),BC
0017D8 DDF9 ED5339DE        20      LD  (DRWF_E),DE
0017DC DDFD 223CDE          16      LD  (DRWF_HL),HL
0017DF DE00 1820            12      JR  INC_HL_DRWC
       DE02                     DRDC1:
0017E1 DE02 E5              11      PUSH    HL
0017E2 DE03 2139DE          10      LD  HL,DRWF_E
0017E5 DE06 86               7      ADD A,(HL)
0017E6 DE07 F5              11      PUSH    AF
0017E7 DE08 BB               4      CP  E
0017E8 DE09 201D            12      JR  NZ,DRDC2
0017EA DE0B F1              10      POP AF
0017EB DE0C 23               6      INC HL
0017EC DE0D 7E               7      LD  A,(HL)
0017ED DE0E CE00             7      ADC A,0
0017EF DE10 F5              11      PUSH    AF
0017F0 DE11 BA               4      CP  D
0017F1 DE12 2014            12      JR  NZ,DRDC2
0017F3 DE14 F1              10      POP AF
0017F4 DE15 3A32DE          13      LD  A,(DRWF_C)
0017F7 DE18 CE00             7      ADC A,0
0017F9 DE1A B9               4      CP  C
0017FA DE1B 200C            12      JR  NZ,DRDC3
0017FC DE1D 2133DE          10      LD  HL,DRWF_B
0017FF DE20 34              11      INC (HL)
001800 DE21 E1              10      POP HL
       DE22                     INC_HL_DRWC:
001801 DE22 3A9DDD          13      LD  A,(SECSZ_H)     ;1セクタのサイズの上位1バイト
001804 DE25 84               4      ADD A,H
001805 DE26 67               4      LD  H,A
001806 DE27 C9              10      RET
       DE28                     DRDC2:
001807 DE28 F1              10      POP AF
       DE29                     DRDC3:
001808 DE29 CD2FDE          17      CALL    DRW_FLUSH
00180B DE2C E1              10      POP HL
00180C DE2D 18C4            12      JR  SAVE_DRWC
                                
                                ;   ランダムブロックアクセスの連続したセクタをまとめたものをフラッシュする
       DE2F                     DRW_FLUSH:
00180E DE2F C5              11      PUSH    BC
00180F DE30 D5              11      PUSH    DE
001810 DE31 010000          10      LD  BC,0
       DE32                     DRWF_C  EQU $-2
       DE33                     DRWF_B  EQU $-1
001813 DE34 78               4      LD  A,B
001814 DE35 B7               4      OR  A
001815 DE36 280D            12      JR  Z,DRDF1
001817 DE38 110000          10      LD  DE,0
       DE39                     DRWF_E  EQU $-2
       DE3A                     DRWF_D  EQU $-1
00181A DE3B 210000          10      LD  HL,0
       DE3C                     DRWF_HL EQU $-2
00181D DE3E AF               4      XOR A
00181E DE3F 3233DE          13      LD  (DRWF_B),A
001821 DE42 CDBBE1          17      CALL    DRD24B
       DE43                     DRWF_MODE   EQU $-2
       DE45                     DRDF1:
001824 DE45 D1              10      POP DE
001825 DE46 C1              10      POP BC
001826 DE47 C9              10      RET
                                
       DE48                     RB_WRITE:
001827 DE48 C5              11      PUSH    BC
001828 DE49 0E26             7      LD  C,026H      ;(BDOS)ランダムブロック書き込み
00182A DE4B 1803            12      JR  RBRW
       DE4D                     RB_READ:
00182C DE4D C5              11      PUSH    BC
00182D DE4E 0E27             7      LD  C,027H      ;(BDOS)ランダムブロック読み込み
       DE50                     RBRW:
00182F DE50 1F               4      RRA     ;AHL = AHL*128
001830 DE51 7C               4      LD  A,H ;AHL = AHL0/2
001831 DE52 1F               4      RRA     ;A
001832 DE53 65               4      LD  H,L ;
001833 DE54 CB1C             8      RR  H   ;H
001835 DE56 2E00             7      LD  L,0 ;
001837 DE58 CB1D             8      RR  L   ;L
001839 DE5A CD65DB          17      CALL    SET_RR_AHL
00183C DE5D 218000          10      LD  HL,128
00183F DE60 C5              11      PUSH    BC
       DE61                     SETSEQ_SWC_RND:
001840 DE61 CD94DB          17      CALL    SETSEQ1     ;CALL SETSEQ1 or LD BC,SETSEQ1
001843 DE64 C1              10      POP BC
001844 DE65 FDCB20FE        23      SET 7,(IY+32)   ;(FCB)カレントレコード
001848 DE69 FDE5            15      PUSH    IY
00184A DE6B D1              10      POP DE
00184B DE6C D5              11      PUSH    DE
00184C DE6D CD42CE          17      CALL    BDOS0
00184F DE70 FDE1            14      POP IY
001851 DE72 CD6FDB          17      CALL    SETSEQ      ;SETSEQ or POPRR
       DE73                     SETSEQ_SWC_SEQ_RR   EQU $-2
001854 DE75 FDCB20BE        23      RES 7,(IY+32)   ;(FCB)カレントレコード
                                
001858 DE79 C1              10      POP BC
001859 DE7A C9              10      RET
                                
                                ;(22)
       DE7B                     INIT_SEQ:
00185A DE7B 3E01             7      LD  A,1     ;LD BC,????
00185C DE7D 216FDB          10      LD  HL,SETSEQ
00185F DE80 CD35DB          17      CALL    PUSHRR
       DE83                     GETSEQ:
001862 DE83 FD6E20          19      LD  L,(IY+32)   ;(FCB)カレントレコード
001865 DE86 FD660C          19      LD  H,(IY+12)   ;(FCB)カレントブロック
001868 DE89 AF               4      XOR A
                                
001869 DE8A CB25             8      SLA L   ;L=L*2
                                
00186B DE8C CB3C             8      SRL H   ;HL=HL/2
00186D DE8E CB1D             8      RR  L   ;
00186F DE90 C9              10      RET
[EOF:LDFILE2.ASM:SHIFT_JIS]
                                    INCLUDE "LDDIO.ASM"
                                
                                ;   LSX-Dodgers DIO
                                
       DE91                     DRDX:
001870 DE91 CDCFDE          17      CALL    DRDY
001873 DE94 C8              11      RET Z
001874 DE95 CDB5DE          17      CALL    DRDX1       ;データバッファの情報を保存
001877 DE98 D8              11      RET C
001878 DE99 E5              11      PUSH    HL
001879 DE9A C5              11      PUSH    BC
00187A DE9B D5              11      PUSH    DE
00187B DE9C 2A7EE6          16      LD  HL,(_DTBUF)
00187E DE9F 3AF8DE          13      LD  A,(_DBS24)
001881 DEA2 4F               4      LD  C,A
001882 DEA3 CDB9E1          17      CALL    DRD24
001885 DEA6 DCCADE          17      CALL    C,DRDNE
       DEA9                     POP_DE_BC_HL_RET:
001888 DEA9 D1              10      POP DE
001889 DEAA C1              10      POP BC
00188A DEAB E1              10      POP HL
00188B DEAC C9              10      RET
                                
                                ;   CDE:セクタ番号
       DEAD                     DRDN:
00188C DEAD AF               4      XOR A
00188D DEAE 00               4  DRDN1:  NOP         ;自己書き換え NOP / SCF
00188E DEAF 30E0            12      JR  NC,DRDX
       DEB1                     DRDNX:
001890 DEB1 CDCFDE          17      CALL    DRDY
001893 DEB4 C8              11      RET Z
       DEB5                     DRDX1:
001894 DEB5 CDE5DE          17      CALL    DWTX
                                                ;データバッファの読み込んだドライブ・セクタ情報を保存
001897 DEB8 ED53A6E5        20      LD  (_DBSEC),DE
00189B DEBC 79               4      LD  A,C
00189C DEBD 32F8DE          13      LD  (_DBS24),A
                                
00189F DEC0 3A88E5          13      LD  A,(_DRV)
0018A2 DEC3 32A5E5          13      LD  (_DBDRV),A
0018A5 DEC6 CDD9E5          17      CALL    _CHGDRV
0018A8 DEC9 D0              11      RET NC
       DECA                     DRDNE:
0018A9 DECA 9F               4      SBC A,A     ;CF=1ならばA=0FFH
0018AA DECB 32A5E5          13      LD  (_DBDRV),A
0018AD DECE C9              10      RET
                                
                                ;   CDE:セクタ番号
       DECF                     DRDY:
0018AE DECF 3AF8DE          13      LD  A,(_DBS24)
0018B1 DED2 B9               4      CP  C
0018B2 DED3 C0              11      RET NZ
                                
0018B3 DED4 E5              11      PUSH    HL
0018B4 DED5 3A88E5          13      LD  A,(_DRV)
0018B7 DED8 21A5E5          10      LD  HL,_DBDRV
0018BA DEDB AE               7      XOR (HL)
0018BB DEDC 2005            12      JR  NZ,POP_HL_RET
                                
0018BD DEDE 2AA6E5          16      LD  HL,(_DBSEC)
0018C0 DEE1 ED52            15      SBC HL,DE       ;上でXORを使っているのでCF=0のはず
       DEE3                     POP_HL_RET:
0018C2 DEE3 E1              10      POP HL
0018C3 DEE4 C9              10      RET
                                
       DEE5                     DWTX:
0018C4 DEE5 3AA4E5          13      LD  A,(_WTDBF)
0018C7 DEE8 B7               4      OR  A
0018C8 DEE9 C8              11      RET Z
0018C9 DEEA AF               4      XOR A
0018CA DEEB 32A4E5          13      LD  (_WTDBF),A
                                
0018CD DEEE E5              11      PUSH    HL
0018CE DEEF C5              11      PUSH    BC
0018CF DEF0 D5              11      PUSH    DE
0018D0 DEF1 3AA5E5          13      LD  A,(_DBDRV)
0018D3 DEF4 CDD9E5          17      CALL    _CHGDRV
0018D6 DEF7 0E00             7      LD  C,0
       DEF8                     _DBS24  EQU $-1
0018D8 DEF9 ED5BA6E5        20      LD  DE,(_DBSEC)
0018DC DEFD 2A7EE6          16      LD  HL,(_DTBUF)
0018DF DF00 D4C7E1          17      CALL    NC,DWT24
       DF03                     POP_DE_BC_HL_RET2:
0018E2 DF03 18A4            12      JR  POP_DE_BC_HL_RET
                                
       DF05                     RDFATX:
0018E4 DF05 E5              11      PUSH    HL
0018E5 DF06 3A88E5          13      LD  A,(_DRV)
0018E8 DF09 21AAE5          10      LD  HL,_FATDRV
0018EB DF0C AE               7      XOR (HL)
0018EC DF0D 28D4            12      JR  Z,POP_HL_RET
                                
0018EE DF0F C5              11      PUSH    BC
0018EF DF10 D5              11      PUSH    DE
0018F0 DF11 DDE5            15      PUSH    IX
0018F2 DF13 CD2FDF          17      CALL    WTFATX
0018F5 DF16 3813            12      JR  C,POP_IX_DE_BC_HL_RET
                                
0018F7 DF18 AF               4      XOR A
0018F8 DF19 32ABE5          13      LD  (_FATIX),A
0018FB DF1C 3A88E5          13      LD  A,(_DRV)
0018FE DF1F 32AAE5          13      LD  (_FATDRV),A
001901 DF22 CDE5E5          17      CALL    _RDFAT
       DF25                     RDFATE2:
001904 DF25 3004            12      JR  NC,POP_IX_DE_BC_HL_RET
001906 DF27 9F               4      SBC A,A     ;A=0xFF
001907 DF28 32AAE5          13      LD  (_FATDRV),A
       DF2B                     POP_IX_DE_BC_HL_RET:
00190A DF2B DDE1            14      POP IX
00190C DF2D 18D4            12      JR  POP_DE_BC_HL_RET2
                                
       DF2F                     WTFATX:
00190E DF2F 3AA2E5          13      LD  A,(_WTFATF)
001911 DF32 B7               4      OR  A
001912 DF33 C8              11      RET Z
001913 DF34 AF               4      XOR A
001914 DF35 32A2E5          13      LD  (_WTFATF),A
                                
001917 DF38 E5              11      PUSH    HL
001918 DF39 3AAAE5          13      LD  A,(_FATDRV)
00191B DF3C 21A5E5          10      LD  HL,_DBDRV
00191E DF3F AE               7      XOR (HL)
00191F DF40 CCE5DE          17      CALL    Z,DWTX
001922 DF43 389E            12      JR  C,POP_HL_RET
001924 DF45 C5              11      PUSH    BC
001925 DF46 D5              11      PUSH    DE
001926 DF47 DDE5            15      PUSH    IX
001928 DF49 CDD8E1          17      CALL    FATSETUP
00192B DF4C D4C9E1          17      CALL    NC,DWT24B
00192E DF4F 18DA            12      JR  POP_IX_DE_BC_HL_RET
                                
       DF51                     N16CL1:
001930 DF51 7A               4      LD  A,D
001931 DF52 B3               4      OR  E
001932 DF53 37               4      SCF
001933 DF54 C8              11      RET Z
                                
001934 DF55 7A               4      LD  A,D
001935 DF56 1807            12      JR  NCL1X
       DF58                     NCL1:
001937 DF58 7A               4      LD  A,D
001938 DF59 B3               4      OR  E
001939 DF5A 37               4      SCF
00193A DF5B C8              11      RET Z
                                
00193B DF5C 7A               4      LD  A,D
00193C DF5D CB3F             8      SRL A   ;/2
       DF5F                     NCL1X:
00193E DF5F CB3F             8      SRL A   ;/2
                                
001940 DF61 E5              11      PUSH    HL
001941 DF62 3281DF          13      LD  (NCLPAT_FATIX),A    ;_FATIX
001944 DF65 2AAAE5          16      LD  HL,(_FATDRV)    ;L=_FATDRV H=_FATIX
001947 DF68 BC               4      CP  H
001948 DF69 3A88E5          13      LD  A,(_DRV)    ;LDではフラグは変化しない
00194B DF6C 3280DF          13      LD  (NCLPAT_FATDRV),A   ;_FATDRV
00194E DF6F 2005            12      JR  NZ,NCL2     ;FATIXが違う
001950 DF71 BD               4      CP  L
001951 DF72 2002            12      JR  NZ,NCL2     ;ドライブが違う
001953 DF74 E1              10      POP HL
001954 DF75 C9              10      RET
       DF76                     NCL2:
001955 DF76 C5              11      PUSH    BC
001956 DF77 D5              11      PUSH    DE
001957 DF78 DDE5            15      PUSH    IX
001959 DF7A CD2FDF          17      CALL    WTFATX
00195C DF7D 38AC            12      JR  C,POP_IX_DE_BC_HL_RET
00195E DF7F 010000          10      LD  BC,0        ;自己書き換え C=_FATDRV B=_FATIX
       DF81                     NCLPAT_FATIX    EQU $-1
       DF80                     NCLPAT_FATDRV   EQU $-2
001961 DF82 ED43AAE5        20      LD  (_FATDRV),BC
001965 DF86 CDADE1          17      CALL    RDFATS
001968 DF89 189A            12      JR  RDFATE2
                                
       DF8B                     NCL3:
00196A DF8B CB9A             8      RES 3,D
00196C DF8D CB92             8      RES 2,D
00196E DF8F 6B               4      LD  L,E
00196F DF90 62               4      LD  H,D
001970 DF91 CB3C             8      SRL H   ;
001972 DF93 CB1D             8      RR  L   ;HLA=HLA/2
001974 DF95 1F               4      RRA     ;
001975 DF96 F5              11      PUSH    AF
001976 DF97 3AABE5          13      LD  A,(_FATIX)
001979 DF9A 0F               4      RRCA
00197A DF9B 300B            12      JR  NC,NCL3X1
00197C DF9D 3A9DDD          13      LD  A,(SECSZ_H)
00197F DFA0 FE04             7      CP  4       ;1セクタ1024バイトの場合は奇数インデックスの場合に先頭を512バイトずらす
001981 DFA2 2004            12      JR  NZ,NCL3X1
001983 DFA4 010002          10      LD  BC,512
001986 DFA7 09              11      ADD HL,BC
       DFA8                     NCL3X1:
001987 DFA8 F1              10      POP AF
001988 DFA9 ED4B7CE6        20      LD  BC,(_FATBF)
00198C DFAD 19              11      ADD HL,DE
00198D DFAE 09              11      ADD HL,BC
00198E DFAF 17               4      RLA
00198F DFB0 C9              10      RET
                                
       DFB1                     GNCL:
001990 DFB1 CD58DF          17      CALL    NCL1        ;GET NEXT CLUSTER
001993 DFB4 D8              11      RET C
001994 DFB5 C5              11      PUSH    BC
001995 DFB6 E5              11      PUSH    HL
001996 DFB7 CD8BDF          17      CALL    NCL3
001999 DFBA 3809            12      JR  C,GNC1
00199B DFBC 5E               7      LD  E,(HL)
00199C DFBD 23               6      INC HL
00199D DFBE 7E               7      LD  A,(HL)
00199E DFBF E60F             7      AND 00FH
0019A0 DFC1 57               4      LD  D,A
0019A1 DFC2 E1              10      POP HL
0019A2 DFC3 C1              10      POP BC
0019A3 DFC4 C9              10      RET
       DFC5                     GNC1:
0019A4 DFC5 7E               7      LD  A,(HL)
0019A5 DFC6 23               6      INC HL
0019A6 DFC7 56               7      LD  D,(HL)
0019A7 DFC8 0604             7      LD  B,4
       DFCA                     GNC1L:
0019A9 DFCA CB3A             8      SRL D   ;DA=DA/2
0019AB DFCC 1F               4      RRA     ;
0019AC DFCD 10FB            13      DJNZ    GNC1L
                                
0019AE DFCF 5F               4      LD  E,A
0019AF DFD0 E1              10      POP HL
0019B0 DFD1 C1              10      POP BC
0019B1 DFD2 A7               4      AND A
0019B2 DFD3 C9              10      RET
                                
       DFD4                     SNCL:
0019B3 DFD4 CD58DF          17      CALL    NCL1
0019B6 DFD7 D8              11      RET C
                                ;               SET NEXT CLUSTER
0019B7 DFD8 E5              11      PUSH    HL
0019B8 DFD9 C5              11      PUSH    BC
0019B9 DFDA D5              11      PUSH    DE
0019BA DFDB E5              11      PUSH    HL
0019BB DFDC CD8BDF          17      CALL    NCL3
0019BE DFDF D1              10      POP DE
                                ;CF=ODD
0019BF DFE0 7E               7      LD  A,(HL)
0019C0 DFE1 73               7      LD  (HL),E
0019C1 DFE2 3806            12      JR  C,SNC1
                                ;EVEN
                                ;M[0] = E
                                ;M[1] = (M[1] & 0xF0) | (D & 0x0F)
0019C3 DFE4 23               6      INC HL
0019C4 DFE5 ED67            18      RRD     ;M={A[3:0],E[3:0]}
0019C6 DFE7 7A               4      LD  A,D
0019C7 DFE8 1804            12      JR  SNC11
       DFEA                     SNC1:
                                ;ODD
                                ;HL[0] = (HL[0]&0x0F) | (E<<4)
                                ;HL[1] = DE>>4
0019C9 DFEA ED6F            18      RLD     ;M={D[3:0],E[7:4]}
0019CB DFEC 23               6      INC HL
0019CC DFED 72               7      LD  (HL),D  ;M={D[3:0],E[7:4]}
       DFEE                     SNC11:
0019CD DFEE ED6F            18      RLD     ;M={M[7:4],D[3:0]}
0019CF DFF0 B7               4      OR  A
0019D0 DFF1 D1              10      POP DE
0019D1 DFF2 C1              10      POP BC
0019D2 DFF3 E1              10      POP HL
       DFF4                     FAT_CHANGED:
0019D3 DFF4 3EFF             7      LD  A,0FFH
0019D5 DFF6 32A2E5          13      LD  (_WTFATF),A
0019D8 DFF9 C9              10      RET
                                
       DFFA                     N16CL3:
0019D9 DFFA C5              11      PUSH    BC
0019DA DFFB 6B               4      LD  L,E
0019DB DFFC 7A               4      LD  A,D
0019DC DFFD E601             7      AND 1
0019DE DFFF 67               4      LD  H,A
0019DF E000 29              11      ADD HL,HL
0019E0 E001 ED4B7CE6        20      LD  BC,(_FATBF)
0019E4 E005 09              11      ADD HL,BC
0019E5 E006 C1              10      POP BC
0019E6 E007 C9              10      RET
                                
       E008                     GNCL16:
0019E7 E008 CD51DF          17      CALL    N16CL1      ;GET NEXT CLUSTER for FAT16
0019EA E00B D8              11      RET C
0019EB E00C E5              11      PUSH    HL
0019EC E00D CDFADF          17      CALL    N16CL3
0019EF E010 5E               7      LD  E,(HL)
0019F0 E011 23               6      INC HL
0019F1 E012 56               7      LD  D,(HL)
0019F2 E013 E1              10      POP HL
0019F3 E014 C9              10      RET
                                
       E015                     SNCL16:
0019F4 E015 CD51DF          17      CALL    N16CL1      ;SET NEXT CLUSTER for FAT16
0019F7 E018 D8              11      RET C
0019F8 E019 D5              11      PUSH    DE
0019F9 E01A E5              11      PUSH    HL
0019FA E01B CDFADF          17      CALL    N16CL3
0019FD E01E D1              10      POP DE      ;HL
0019FE E01F 73               7      LD  (HL),E
0019FF E020 23               6      INC HL
001A00 E021 72               7      LD  (HL),D
001A01 E022 6B               4      LD  L,E
001A02 E023 62               4      LD  H,D
001A03 E024 D1              10      POP DE
001A04 E025 18CD            12      JR  FAT_CHANGED
                                
                                ;------------------------
                                ;次のセクタを探す際に_SECPSの値をチェック
                                ;in
                                ;   DE : セクタ番号
                                ;out
                                ;   DE : 次のセクタ番号
                                ;note
                                ;
                                ;------------------------
       E027                     NEXTX:
001A06 E027 3E00             7      LD  A,0 ;自己書き換え
       E028                     _SECPS  EQU $-1
001A08 E029 3C               4      INC A
001A09 E02A E600             7      AND 0   ;自己書き換え　1クラスタの論理セクタ数-1
       E02B                     _NCPAT  EQU $-1
001A0B E02C 3228E0          13      LD  (_SECPS),A
001A0E E02F C9              10      RET
                                
       E030                     GNCLX:
001A0F E030 CD27E0          17      CALL    NEXTX
001A12 E033 C0              11      RET NZ  ;1クラスタのセクタ未満の場合は戻る
001A13 E034 C3F7E5          10      JP  _GNCL   ;次のクラスタを探す
                                
       E037                     RDFAT:
001A16 E037 3E80             7      LD  A,080H
001A18 E039 3270E5          13      LD  (CHECK),A
       E03C                     RDFAT1:
001A1B E03C 3A88E5          13      LD  A,(_DRV)
001A1E E03F CDE1E2          17      CALL    CHGDRVR
001A21 E042 D8              11      RET C
001A22 E043 DD7E12          19      LD  A,(IX+DPB_DEVICE)
001A25 E046 CB6F             8      BIT 5,A
001A27 E048 286E            12      JR  Z,RDFAT0X
001A29 E04A 2170E5          10      LD  HL,CHECK
001A2C E04D A6               7      AND (HL)
001A2D E04E 77               7      LD  (HL),A
001A2E E04F 110000          10      LD  DE,0        ;BPB
001A31 E052 2A7CE6          16      LD  HL,(_FATBF)
001A34 E055 0E00             7      LD  C,0
001A36 E057 CDB9E1          17      CALL    DRD24
001A39 E05A 3024            12      JR  NC,GETBPB
001A3B E05C 2170E5          10      LD  HL,CHECK
001A3E E05F CB06            15      RLC (HL)
001A40 E061 3F               4      CCF
001A41 E062 D8              11      RET C
001A42 E063 DDCB0A1E        23      RR  (IX+DPB_FDMODE)
001A46 E067 3F               4      CCF         ;フロッピーディスクのFDモードを切り替える
001A47 E068 DDCB0A16        23      RL  (IX+DPB_FDMODE)
001A4B E06C 3EFF             7      LD  A,0FFH
001A4D E06E 3289E5          13      LD  (_DSK),A
001A50 E071 3A84E5          13      LD  A,(_DRIVE)
001A53 E074 E603             7      AND 3
001A55 E076 F680             7      OR  080H
001A57 E078 6F               4      LD  L,A
001A58 E079 26E5             7      LD  H,_CYL0/256
001A5A E07B 3EFF             7      LD  A,0FFH
001A5C E07D 77               7      LD  (HL),A
001A5D E07E 18BC            12      JR  RDFAT1
       E080                     GETBPB:
001A5F E080 FDE5            15      PUSH    IY
001A61 E082 FD2A7CE6        20      LD  IY,(_FATBF) ;BPB
001A65 E086 CDF1E5          17      CALL    _BPB2DPB
001A68 E089 FDE1            14      POP IY
001A6A E08B DD7E12          19      LD  A,(IX+DPB_DEVICE)
001A6D E08E 3025            12      JR  NC,GETBPBOK
001A6F E090 E60F             7      AND 00FH
001A71 E092 FE07             7      CP  7
001A73 E094 37               4      SCF
001A74 E095 C0              11      RET NZ
001A75 E096 DDCB0A46        20      BIT 0,(IX+DPB_FDMODE)
001A79 E09A 21C0E6          10      LD  HL,M2D
001A7C E09D 2006            12      JR  NZ,SETFDMODE
001A7E E09F CD92E1          17      CALL    CHECK1024
001A81 E0A2 D8              11      RET C
001A82 E0A3 2ED2             7      LD  L,M2HD-STABLE
       E0A5                     SETFDMODE:
001A84 E0A5 DDE5            15      PUSH    IX
001A86 E0A7 D1              10      POP DE
001A87 E0A8 EDA0            16      LDI
001A89 E0AA EDA0            16      LDI
001A8B E0AC 13               6      INC DE
001A8C E0AD 13               6      INC DE
001A8D E0AE 13               6      INC DE
001A8E E0AF 13               6      INC DE
001A8F E0B0 010C00          10      LD  BC,12
001A92 E0B3 EDB0                    LDIR
       E0B5                     GETBPBOK:
001A94 E0B5 CD4DE2          17      CALL    CHGDRV2
       E0B8                     RDFAT0X:
001A97 E0B8 CDADE1          17      CALL    RDFATS
001A9A E0BB D8              11      RET C
001A9B E0BC DDAE06          19      XOR (IX+DPB_FATID)
001A9E E0BF C8              11      RET Z
001A9F E0C0 DD7E12          19      LD  A,(IX+DPB_DEVICE)
001AA2 E0C3 CB5F             8      BIT 3,A
001AA4 E0C5 2803            12      JR  Z,RDFAT0X1
001AA6 E0C7 CB6F             8      BIT 5,A
001AA8 E0C9 C0              11      RET NZ      ;BPBを取得している場合はFATIDをチェックしない
       E0CA                     RDFAT0X1:
001AA9 E0CA 37               4      SCF
001AAA E0CB C9              10      RET
                                
       E0CC                     POP_HL_SCF_RET:
001AAB E0CC E1              10      POP HL
001AAC E0CD 37               4      SCF
001AAD E0CE C9              10      RET
                                
       E0CF                     BPB2DPB:
001AAE E0CF FD7E0B          19      LD  A,(IY+11)   ;BPB_BytsPerSec
001AB1 E0D2 B7               4      OR  A
001AB2 E0D3 37               4      SCF
001AB3 E0D4 C0              11      RET NZ
       E0D5                     BPBOK:
001AB4 E0D5 FD7E0D          19      LD  A,(IY+13)   ;BPB_SecPerClus
001AB7 E0D8 DD7707          19      LD  (IX+DPB_SECPCL),A
                                
001ABA E0DB FD7E16          19      LD  A,(IY+22)   ;BPB_FATSz16
001ABD E0DE DD7700          19      LD  (IX+DPB_FATLN),A
001AC0 E0E1 FD7E17          19      LD  A,(IY+23)   ;BPB_FATSz16
001AC3 E0E4 DD7701          19      LD  (IX+DPB_FATLN+1),A
                                
001AC6 E0E7 FD6E0E          19      LD  L,(IY+14)   ;BPB_RsvdSecCnt
001AC9 E0EA FD660F          19      LD  H,(IY+15)
001ACC E0ED DD750E          19      LD  (IX+DPB_FATPS),L
001ACF E0F0 FD5E16          19      LD  E,(IY+22)   ;BPB_FATSz16
001AD2 E0F3 FD5617          19      LD  D,(IY+23)
001AD5 E0F6 FD4610          19      LD  B,(IY+16)   ;BPB_NumFATs
       E0F9                     BPBDP1:             ;BPB_FATSz16 * BPB_NumFATs
001AD8 E0F9 19              11      ADD HL,DE
001AD9 E0FA 10FD            13      DJNZ    BPBDP1
       E0FC                     BPBDP2:
001ADB E0FC DD7510          19      LD  (IX+DPB_DIRPS),L
001ADE E0FF DD7411          19      LD  (IX+DPB_DIRPS+1),H
001AE1 E102 E5              11      PUSH    HL
                                
001AE2 E103 FD6E11          19      LD  L,(IY+17)   ;BPB_RootEntCnt
001AE5 E106 FD6612          19      LD  H,(IY+18)
001AE8 E109 FD7E0C          19      LD  A,(IY+12)   ;BPB_BytsPerSec
001AEB E10C B7               4      OR  A
001AEC E10D 28BD            12      JR  Z,POP_HL_SCF_RET
001AEE E10F 0606             7      LD  B,6
       E111                     BPBBPS1:
001AF0 E111 05               4      DEC B
001AF1 E112 0F               4      RRCA
001AF2 E113 30FC            12      JR  NC,BPBBPS1
       E115                     BPBDE1:
001AF4 E115 29              11      ADD HL,HL
001AF5 E116 10FD            13      DJNZ    BPBDE1
                                
001AF7 E118 7C               4      LD  A,H
001AF8 E119 DD770B          19      LD  (IX+DPB_DIRSCNT),A  ;
                                
001AFB E11C D1              10      POP DE      ;DPB_DIRPS
001AFC E11D 6C               4      LD  L,H
001AFD E11E 2600             7      LD  H,0
001AFF E120 19              11      ADD HL,DE       ;MAXDIR
001B00 E121 E5              11      PUSH    HL
001B01 E122 FD4E0D          19      LD  C,(IY+13)   ;BPB_SecPerClus
001B04 E125 CB21             8      SLA C       ;*2
001B06 E127 AF               4      XOR A
001B07 E128 47               4      LD  B,A
001B08 E129 ED42            15      SBC HL,BC
001B0A E12B DD7514          19      LD  (IX+DPB_ADDCL),L
001B0D E12E DD7415          19      LD  (IX+DPB_ADDCL+1),H
                                
001B10 E131 D1              10      POP DE      ;DE=DPB_MAXDIR
001B11 E132 FD6E13          19      LD  L,(IY+19)   ;BPB_TotSec16
001B14 E135 FD6614          19      LD  H,(IY+20)
                                
001B17 E138 DD7E12          19      LD  A,(IX+DPB_DEVICE)
001B1A E13B E60F             7      AND 00FH
001B1C E13D FE07             7      CP  7       ;フロッピー
001B1E E13F 2019            12      JR  NZ,NOT_FD
001B20 E141 E5              11      PUSH    HL
001B21 E142 FD4E18          19      LD  C,(IY+24)   ;BPB_SecPerTr
001B24 E145 DD710D          19      LD  (IX+DPB_MAXSEC),C
001B27 E148 AF               4      XOR A
001B28 E149 CB21             8      SLA C       ;両面なのでセクタ数を２倍
001B2A E14B 0610             7      LD  B,16
       E14D                     DIVSEC:             ;MAXCYL = BPB_TotSec16 / (BPB_SecPerTr * 2)
001B2C E14D 29              11      ADD HL,HL
001B2D E14E 17               4      RLA
001B2E E14F B9               4      CP  C
001B2F E150 3802            12      JR  C,DIVSEC1
001B31 E152 91               4      SUB C
001B32 E153 2C               4      INC L
       E154                     DIVSEC1:
001B33 E154 10F7            13      DJNZ    DIVSEC
001B35 E156 DD750C          19      LD  (IX+DPB_MAXCYL),L
001B38 E159 E1              10      POP HL  ;ここまでフロッピー専用
       E15A                     NOT_FD:
001B39 E15A 7C               4      LD  A,H
001B3A E15B B5               4      OR  L
001B3B E15C 3E00             7      LD  A,0     ;LDでフラグは変化しない。BPB_TotSec16を AHL で扱う為、Aに0を入れる
001B3D E15E 200E            12      JR  NZ,BPB16BIT ;BPB_TotSec16が「0」の場合はBPB_TotSec32で計算
001B3F E160 2F               4      CPL         ;A=0FFH
001B40 E161 FD8623          19      ADD A,(IY+35)   ;念のために総セクタ数が24ビットを超える場合はエラーを返す
001B43 E164 D8              11      RET C
001B44 E165 FD6E20          19      LD  L,(IY+32)   ;BPB_TotSec32 は AHL の24ビットで扱う
001B47 E168 FD6621          19      LD  H,(IY+33)   ;1クラスタの論理セクタ数(DPB_SECPCL)が最大128なので、
001B4A E16B FD7E22          19      LD  A,(IY+34)   ;FAT12,FAT16では総セクタ数が24ビットを超えることは無い
       E16E                     BPB16BIT:
001B4D E16E ED52            15      SBC HL,DE       ;DE=DPB_MAXDIR
001B4F E170 DE00             7      SBC A,0
001B51 E172 FD460D          19      LD  B,(IY+13)   ;BPB_SecPerClus
       E175                     BPBTC1:             ;総クラスタ数(AHL) = 総セクタ数(AHL) / セクタサイズ(B)
001B54 E175 CB18             8      RR  B       ;->CY
001B56 E177 3808            12      JR  C,BPBTC2
001B58 E179 CB3F             8      SRL A
001B5A E17B CB1C             8      RR  H       ;AHL=AHL/2
001B5C E17D CB1D             8      RR  L
001B5E E17F 18F4            12      JR  BPBTC1
       E181                     BPBTC2:
001B60 E181 C6FF             7      ADD A,0FFH
001B62 E183 D8              11      RET C       ;念のため(クラスタ数が16ビットを超える場合)
001B63 E184 23               6      INC HL
001B64 E185 23               6      INC HL
001B65 E186 DD7508          19      LD  (IX+DPB_MAXCL),L
001B68 E189 DD7409          19      LD  (IX+DPB_MAXCL+1),H
                                
001B6B E18C FD7E15          19      LD  A,(IY+21)   ;BPB_Media
001B6E E18F DD7706          19      LD  (IX+DPB_FATID),A
       E192                     CHECK1024:
001B71 E192 FD7E10          19      LD  A,(IY+16)   ;BPB_NumFATs
001B74 E195 C6FE             7      ADD A,0-2       ;>2:CF=1
001B76 E197 FD7E0C          19      LD  A,(IY+12)   ;BPB_BytsPerSec
001B79 E19A 6F               4      LD  L,A
001B7A E19B 3002            12      JR  NC,BPBFAT1
001B7C E19D F680             7      OR  080H
       E19F                     BPBFAT1:            ;ここではCF=0
001B7E E19F DD770F          19      LD  (IX+DPB_BPS),A
001B81 E1A2 3A7BE6          13      LD  A,(_MAX_SEC_SZ_H)
001B84 E1A5 BD               4      CP  L
001B85 E1A6 C8              11      RET Z       ;1セクタ1024バイト
001B86 E1A7 2D               4      DEC L       ;以下のセクタサイズに合致しない場合はCF=1でエラーにする
001B87 E1A8 C8              11      RET Z       ;1セクタ256バイト
001B88 E1A9 2D               4      DEC L
001B89 E1AA C8              11      RET Z       ;1セクタ512バイト
001B8A E1AB 37               4      SCF
001B8B E1AC C9              10      RET
                                
       E1AD                     RDFATS:
001B8C E1AD CDD8E1          17      CALL    FATSETUP
001B8F E1B0 D8              11      RET C
001B90 E1B1 CDBBE1          17      CALL    DRD24B
001B93 E1B4 2A7CE6          16      LD  HL,(_FATBF)
001B96 E1B7 7E               7      LD  A,(HL)
001B97 E1B8 C9              10      RET
                                
       E1B9                     DRD24:
001B98 E1B9 0601             7      LD  B,1
       E1BB                     DRD24B:
001B9A E1BB DDE5            15      PUSH    IX
001B9C E1BD DD2AA8E5        20      LD  IX,(_DPB)
001BA0 E1C1 CD26E3          17      CALL    FDRD        ;自己書き換え（ディスク読み込み）
       E1C2                     DRDPAT  EQU $-2
001BA3 E1C4 DDE1            14      POP IX
001BA5 E1C6 C9              10      RET
                                
       E1C7                     DWT24:
001BA6 E1C7 0601             7      LD  B,1
       E1C9                     DWT24B:
001BA8 E1C9 DDE5            15      PUSH    IX
001BAA E1CB DD2AA8E5        20      LD  IX,(_DPB)
001BAE E1CF CD24E3          17      CALL    FDWT        ;自己書き換え（ディスク書き込み）
       E1D0                     DWTPAT  EQU $-2
001BB1 E1D2 DDE1            14      POP IX
001BB3 E1D4 D0              11      RET NC
001BB4 E1D5 C35AE5          10      JP  _DISKE
                                
                                ;------------------------
                                ;FATのセットアップ
                                ;out
                                ;   B  : FATセクタ数
                                ;   DE : FAT先頭セクタ番号
                                ;   HL : FATバッファポインタ
                                ;   CF : 1=ドライブ切り替えエラー
                                ;note
                                ;   FATサイズがFATバッファを超える場合は
                                ;   対象クラスタ領域==(_FATIX)によって
                                ;   FAT12:対象クラスタ1024毎に1.5KBを切り替える
                                ;   FAT16:対象クラスタ512毎に1KBを切り替える
                                ;------------------------
       E1D8                     FATSETUP:
001BB7 E1D8 3AAAE5          13      LD  A,(_FATDRV)
001BBA E1DB CDE1E2          17      CALL    CHGDRVR     ;ドライブ切り替え
001BBD E1DE D8              11      RET C
       E1DF                     FATS2:
001BBE E1DF DD7E0F          19      LD  A,(IX+DPB_BPS)  ;512=2 1024=4
001BC1 E1E2 0F               4      RRCA
001BC2 E1E3 CD13E2          17      CALL    FATSETUP12  ;自己書き換え
       E1E4                     FATSX   EQU $-2
001BC5 E1E6 210000          10      LD  HL,0
001BC8 E1E9 4A               4      LD  C,D
001BC9 E1EA 54               4      LD  D,H
001BCA E1EB 3AABE5          13      LD  A,(_FATIX)  ;範囲FAT12:0-3/FAT16:0-127(0-07FH):65535*2/1024
001BCD E1EE 47               4      LD  B,A
001BCE E1EF 04               4      INC B
001BCF E1F0 DD7E00          19      LD  A,(IX+DPB_FATLN)
       E1F3                     FAT_SKP:
001BD2 E1F3 05               4      DEC B
001BD3 E1F4 2809            12      JR  Z,FAT1
001BD5 E1F6 19              11      ADD HL,DE
001BD6 E1F7 93               4      SUB E
001BD7 E1F8 30F9            12      JR  NC,FAT_SKP
001BD9 E1FA DDCB0146        20      BIT 0,(IX+DPB_FATLN+1)  ;FATサイズが0100H(256)の場合
001BDD E1FE C8              11      RET Z
       E1FF                     FAT1:
001BDE E1FF EB               4      EX  DE,HL
001BDF E200 B7               4      OR  A       ;0の場合は0100Hとして扱う
001BE0 E201 2803            12      JR  Z,FAT3
001BE2 E203 B9               4      CP  C       ;C=FATバッファに読み込めるセクタ数
001BE3 E204 3801            12      JR  C,FAT2
       E206                     FAT3:
001BE5 E206 79               4      LD  A,C
       E207                     FAT2:
001BE6 E207 47               4      LD  B,A
                                
001BE7 E208 2AFAE6          16      LD  HL,(_FATPS) ;fat sector pos
001BEA E20B 19              11      ADD HL,DE
001BEB E20C EB               4      EX  DE,HL
001BEC E20D 2A7CE6          16      LD  HL,(_FATBF)
001BEF E210 AF               4      XOR A       ;CF=0
001BF0 E211 4F               4      LD  C,A
001BF1 E212 C9              10      RET
                                ;
                                ;   FATバッファに読み込める最大のセクタ数と_FATIXで進めるセクタ数
                                ;   FATSETUP* (FAT12/FAT16)
                                ;out
                                ;   D : FATバッファに読み込める最大のセクタ数
                                ;   E : _FATIXで進めるセクタ数
       E213                     FATSETUP12:
001BF2 E213 110606          10      LD  DE,0606H    ;256
001BF5 E216 D8              11      RET C
001BF6 E217 110303          10      LD  DE,0303H    ;512
001BF9 E21A 0F               4      RRCA
001BFA E21B D8              11      RET C
001BFB E21C 110102          10      LD  DE,0201H    ;1024
001BFE E21F C9              10      RET
                                
       E220                     FATSETUP16:
001BFF E220 110404          10      LD  DE,0404H    ;256
001C02 E223 D8              11      RET C
001C03 E224 110202          10      LD  DE,0202H    ;512
001C06 E227 0F               4      RRCA
001C07 E228 D8              11      RET C
001C08 E229 110101          10      LD  DE,0101H    ;1024
001C0B E22C C9              10      RET
                                
       E22D                     CHGDRV:
001C0C E22D E5              11      PUSH    HL
001C0D E22E 2189E5          10      LD  HL,_DSK
001C10 E231 BE               7      CP  (HL)
001C11 E232 280A            12      JR  Z,CHGDRVE
       E234                     CHGDRV1:
001C13 E234 DDE5            15      PUSH    IX
001C15 E236 CD40E2          17      CALL    CHGDRV0
001C18 E239 3A89E5          13      LD  A,(_DSK)
001C1B E23C DDE1            14      POP IX
       E23E                     CHGDRVE:
001C1D E23E E1              10      POP HL
001C1E E23F C9              10      RET
                                
       E240                     CHGDRV0:
001C1F E240 6F               4      LD  L,A
001C20 E241 CDDCE5          17      CALL    _GETDPB
001C23 E244 D8              11      RET C
001C24 E245 DD22A8E5        20      LD  (_DPB),IX
001C28 E249 7D               4      LD  A,L
001C29 E24A 3289E5          13      LD  (_DSK),A
       E24D                     CHGDRV2:
001C2C E24D C5              11      PUSH    BC
001C2D E24E D5              11      PUSH    DE
001C2E E24F ED7398E2        20      LD  (SPPAT2),SP
001C32 E253 F3               4      DI
001C33 E254 DDF9            10      LD  SP,IX
                                
001C35 E256 E1              10      POP HL      ;00:DPB_FATLN
001C36 E257 E1              10      POP HL      ;02:DPB_DRD
001C37 E258 22C2E1          16      LD  (DRDPAT),HL
                                
001C3A E25B E1              10      POP HL
001C3B E25C 22D0E1          16      LD  (DWTPAT),HL ;04:DPB_DWT
                                
001C3E E25F E1              10      POP HL      ;L=06:DPB_FATID H=07:DPB_SECPCL
001C3F E260 7C               4      LD  A,H
001C40 E261 32C4D8          13      LD  (SPCPAT),A  ;1クラスタの論理セクタ数
001C43 E264 3D               4      DEC A
001C44 E265 322BE0          13      LD  (_NCPAT),A
                                
001C47 E268 E1              10      POP HL      ;08:DPB_MAXCL
001C48 E269 7D               4      LD  A,L
001C49 E26A 32E3D8          13      LD  (CLPAT2),A
001C4C E26D 7C               4      LD  A,H
001C4D E26E 32DFD8          13      LD  (CLPAT1),A
001C50 E271 2B               6      DEC HL
001C51 E272 22E2DA          16      LD  (MAXCLP),HL
                                
001C54 E275 E1              10      POP HL      ;L=0A:DPB_FDMODE H=0B:DPB_DIRSCNT
001C55 E276 4C               4      LD  C,H
                                
001C56 E277 E1              10      POP HL      ;L=0C:DPB_MAXCYL H=0D:DPB_MAXSEC
                                
001C57 E278 E1              10      POP HL      ;L=0E:DPB_FATPS H=0F:DPB_BPS
001C58 E279 7C               4      LD  A,H     ;DPB_BPS
001C59 E27A E607             7      AND 7
001C5B E27C 329DDD          13      LD  (SECSZ_H),A ;1セクタのサイズの上位1バイト 0x400 - 0x200 - 0x100
                                                ;1セクタ512 2D/2DD/2HC/2HQ(2HD1.44MB)/EMM/BRAM/EMEM等
                                                ;1セクタ1024 2HD/2HDE98等
                                                ;1セクタ256 GRAM/RAMF/CMOS等
                                                ;1024   512 256
                                                ;4  2   1
001C5E E27F 87               4      ADD A,A     ;8  4   2
001C5F E280 87               4      ADD A,A     ;010H   8   4
001C60 E281 87               4      ADD A,A     ;020H   010H    8
001C61 E282 3242D7          13      LD  (SDECPAT),A ;1セクタ辺りのディレクトリエントリ数
                                
001C64 E285 2600             7      LD  H,0
001C66 E287 22FAE6          16      LD  (_FATPS),HL
                                
001C69 E28A E1              10      POP HL      ;10:DPB_DIRPS
001C6A E28B 22FCE6          16      LD  (_DIRPS),HL
                                
001C6D E28E E1              10      POP HL      ;L=12:DPB_DEVICE H=13:DPB_UNITNO
001C6E E28F 7C               4      LD  A,H
001C6F E290 3284E5          13      LD  (_DRIVE),A
                                
001C72 E293 E1              10      POP HL      ;14:DPB_ADDCL
001C73 E294 22D4D8          16      LD  (CLSPAT),HL
                                
001C76 E297 310000          10      LD  SP,0        ;元のSPを復元
       E298                     SPPAT2  EQU $-2
001C79 E29A FB               4      EI
001C7A E29B 2AFCE6          16      LD  HL,(_DIRPS)
001C7D E29E 0600             7      LD  B,0
001C7F E2A0 09              11      ADD HL,BC       ;C=DPB_DIRSCNT
001C80 E2A1 225DD7          16      LD  (MD_PAT),HL
                                
001C83 E2A4 2AE2DA          16      LD  HL,(MAXCLP)
001C86 E2A7 110AF0          10      LD  DE,0-4086   ;クラスタ数が4086未満:FAT12 4086以上:FAT16
001C89 E2AA 19              11      ADD HL,DE
001C8A E2AB 380F            12      JR  C,SETFAT16
001C8C E2AD 21B1DF          10      LD  HL,GNCL     ;FAT12
001C8F E2B0 11D4DF          10      LD  DE,SNCL
001C92 E2B3 0113E2          10      LD  BC,FATSETUP12
001C95 E2B6 DDCB0FAE        23      RES 5,(IX+DPB_BPS)  ;DPB_BPS(FAT12)
001C99 E2BA 180D            12      JR  EXTRA1
       E2BC                     SETFAT16:
001C9B E2BC 2108E0          10      LD  HL,GNCL16   ;FAT16
001C9E E2BF 1115E0          10      LD  DE,SNCL16
001CA1 E2C2 0120E2          10      LD  BC,FATSETUP16
001CA4 E2C5 DDCB0FEE        23      SET 5,(IX+DPB_BPS)  ;DPB_BPS(FAT16)
       E2C9                     EXTRA1:
001CA8 E2C9 22F8E5          16      LD  (GNCPAT),HL
001CAB E2CC ED53FBE5        20      LD  (SNCPAT),DE
001CAF E2D0 ED43E4E1        20      LD  (FATSX),BC
001CB3 E2D4 D1              10      POP DE
001CB4 E2D5 C1              10      POP BC
001CB5 E2D6 AF               4      XOR A
001CB6 E2D7 C9              10      RET
                                
       E2D8                     GETDPBD:
001CB7 E2D8 DDE3            23      EX  (SP),IX
001CB9 E2DA DDE5            15      PUSH    IX
001CBB E2DC 3A88E5          13      LD  A,(_DRV)
001CBE E2DF 1807            12      JR  GETDPB1
                                
       E2E1                     CHGDRVR:
001CC0 E2E1 CDD9E5          17      CALL    _CHGDRV
001CC3 E2E4 D8              11      RET C
001CC4 E2E5 3A89E5          13      LD  A,(_DSK)
       E2E8                     GETDPB1:
001CC7 E2E8 C3DCE5          10      JP  _GETDPB
                                
       E2EB                     GETDPB:
001CCA E2EB FE08             7      CP  8
001CCC E2ED 3F               4      CCF
001CCD E2EE D8              11      RET C
001CCE E2EF 0F               4      RRCA
001CCF E2F0 0F               4      RRCA
001CD0 E2F1 0F               4      RRCA
001CD1 E2F2 DD                      DB  0DDH        ;Z80未定義命令
001CD2 E2F3 6F               4      LD  L,A     ;LD IXL,A
001CD3 E2F4 DD                      DB  0DDH        ;Z80未定義命令
001CD4 E2F5 26E7             7      LD  H,_DEVICE/256   ;LD IXH,_DEVICE/256
001CD6 E2F7 DD7E00          19      LD  A,(IX+DPB_FATLN)
001CD9 E2FA A7               4      AND A       ;CF=0の為
001CDA E2FB DDCB0F6E        20      BIT 5,(IX+DPB_BPS)
001CDE E2FF C0              11      RET NZ      ;FAT16
001CDF E300 DDCB126E        20      BIT 5,(IX+DPB_DEVICE)
001CE3 E304 C0              11      RET NZ      ;BPB
001CE4 E305 FE01             7      CP  001H        ;A=0 THEN CF=1
001CE6 E307 C9              10      RET
                                
       E308                     _SYS5F:
001CE7 E308 AF               4      XOR A
       E309                     FFLUSH:
001CE8 E309 F5              11      PUSH    AF
001CE9 E30A CD2FDF          17      CALL    WTFATX
001CEC E30D AF               4      XOR A
001CED E30E 32ABE5          13      LD  (_FATIX),A
001CF0 E311 2F               4      CPL         ;0FFH
001CF1 E312 32AAE5          13      LD  (_FATDRV),A
001CF4 E315 3E                      DB  03EH        ;次のPUSH AFをスキップ
       E316                     FFLUSHBUF:
001CF5 E316 F5              11      PUSH    AF
001CF6 E317 CDE5DE          17      CALL    DWTX
001CF9 E31A 3EFF             7      LD  A,0FFH
001CFB E31C 3239E5          13      LD  (SFILE),A
001CFE E31F 32A5E5          13      LD  (_DBDRV),A
001D01 E322 F1              10      POP AF
001D02 E323 C9              10      RET
                                
[EOF:LDDIO.ASM:SHIFT_JIS]
                                    INCLUDE "MSXDISK.ASM"
                                
                                ;   LSX-Dodgers DISK
                                ;   MSX
                                
                                ;   ROM DISK DRIVER
                                ;   1セクタ可変(256/512/1024)
                                
       E324                     WTTRK:
       E324                     FDWT:
001D03 E324 37               4      SCF
001D04 E325 C9              10      RET
       E326                     FDRD:
001D05 E326 ED73B7E3        20      LD  (DRDSP),SP
001D09 E32A 3AB8E3          13      LD  A,(DRDSPH)  ;スタックがカートリッジと被っていないかチェック
001D0C E32D FE7F             7      CP  07FH
001D0E E32F 3807            12      JR  C,FDRD1
001D10 E331 FEC1             7      CP  0C1H
001D12 E333 3003            12      JR  NC,FDRD1
001D14 E335 315EF5          10      LD  SP,BUF
       E338                     FDRD1:
001D17 E338 C5              11      PUSH    BC
001D18 E339 D5              11      PUSH    DE
                                
001D19 E33A E5              11      PUSH    HL
001D1A E33B EB               4      EX  DE,HL
001D1B E33C DD460F          19      LD  B,(IX+DPB_BPS)
       E33F                     EADR1:
001D1E E33F CB18             8      RR  B
001D20 E341 3803            12      JR  C,EADR2
001D22 E343 29              11      ADD HL,HL
001D23 E344 18F9            12      JR  EADR1
       E346                     EADR2:
001D25 E346 E5              11      PUSH    HL  ;あとでDEで受け取る
001D26 E347 29              11      ADD HL,HL   ;64KB→32KB
001D27 E348 29              11      ADD HL,HL   ;32KB→16KB
       E349                     ASCII16K1:
001D28 E349 29              11      ADD HL,HL   ;16KB→8KB  ;ASCII-16Kの場合はここがNOPに置き換えられる
                                
001D29 E34A DD7E0C          19      LD  A,(IX+DPB_MAXCYL)   ;16KB単位でカートリッジ内のディスクが存在する位置を指定
       E34D                     ASCII16K2:
001D2C E34D 87               4      ADD A,A         ;ASCII-16Kの場合はここがNOPに置き換えられる
001D2D E34E 84               4      ADD A,H
001D2E E34F 5F               4      LD  E,A
001D2F E350 3A62E5          13      LD  A,(ROM_SLT)
001D32 E353 210070          10      LD  HL,BANK2_SEL
       E354                     ROM8000H    EQU $-2
001D35 E356 CD6FD4          17      CALL    WRSLT
                                
001D38 E359 2680             7      LD  H,080H
001D3A E35B 3A62E5          13      LD  A,(ROM_SLT) ;カートリッジROMに切り替える
001D3D E35E CDE2D4          17      CALL    ENASLT
                                
001D40 E361 D1              10      POP DE
001D41 E362 E1              10      POP HL      ;HLは読み出し先のメモリアドレス
                                
001D42 E363 7B               4      LD  A,E
001D43 E364 E61F             7      AND 01FH        ;セグメントのサイズでフィルタする(8K:1F/16K:3F)
       E365                     ASCII16K3   EQU $-1
001D45 E366 1E00             7      LD  E,0     ;DEはROMディスクから読み出すアドレス
001D47 E368 C680             7      ADD A,080H
001D49 E36A 57               4      LD  D,A
                                
001D4A E36B 3E                      DB  03EH
001D4B E36C A7               4      AND A
001D4C E36D 329AE3          13      LD  (DRD_SWC3),A
001D4F E370 7C               4      LD  A,H     ;読み出し先がカートリッジと被っていないかチェック
001D50 E371 FE7B             7      CP  07BH
001D52 E373 3812            12      JR  C,DRD2
001D54 E375 FEC1             7      CP  0C1H
001D56 E377 300E            12      JR  NC,DRD2
001D58 E379 22A1E3          16      LD  (DRD_SWC1),HL   ;被っている場合はデータバッファをフラッシュして一時的に使う
001D5B E37C 2A7EE6          16      LD  HL,(_DTBUF)
001D5E E37F 3E                      DB  03EH
001D5F E380 37               4      SCF
001D60 E381 329AE3          13      LD  (DRD_SWC3),A
001D63 E384 CD16E3          17      CALL    FFLUSHBUF
       E387                     DRD2:
001D66 E387 DD7E0F          19      LD  A,(IX+DPB_BPS)  ;BCは読み出すセクタサイズ
001D69 E38A E607             7      AND 7
001D6B E38C 47               4      LD  B,A
001D6C E38D 4B               4      LD  C,E ;E=0
                                
001D6D E38E EB               4      EX  DE,HL
001D6E E38F EDB0                    LDIR
001D70 E391 D5              11      PUSH    DE
001D71 E392 2680             7      LD  H,080H
001D73 E394 3A43F3          13      LD  A,(0F341H+2)    ;メインRAMに戻す
001D76 E397 CDE2D4          17      CALL    ENASLT
       E39A                     DRD_SWC3:
001D79 E39A A7               4      AND A       ;自己書き換え)被っている場合はSCFになる
001D7A E39B 3012            12      JR  NC,DRD3
                                
001D7C E39D 2A7EE6          16      LD  HL,(_DTBUF)
001D7F E3A0 110000          10      LD  DE,0
       E3A1                     DRD_SWC1    EQU $-2
001D82 E3A3 DD7E0F          19      LD  A,(IX+DPB_BPS)  ;BCは読み出すセクタサイズ
001D85 E3A6 E607             7      AND 7
001D87 E3A8 47               4      LD  B,A
001D88 E3A9 0E00             7      LD  C,0
001D8A E3AB EDB0                    LDIR
001D8C E3AD E1              10      POP HL
001D8D E3AE D5              11      PUSH    DE
       E3AF                     DRD3:
001D8E E3AF E1              10      POP HL
001D8F E3B0 D1              10      POP DE
001D90 E3B1 13               6      INC DE
001D91 E3B2 C1              10      POP BC
001D92 E3B3 1083            13      DJNZ    FDRD1
001D94 E3B5 AF               4      XOR A
001D95 E3B6 310000          10      LD  SP,0
       E3B7                     DRDSP   EQU $-2
       E3B8                     DRDSPH  EQU $-1
001D98 E3B9 FB               4      EI
001D99 E3BA C9              10      RET
                                
       E3BB                     PDWT:
001D9A E3BB 37               4      SCF
001D9B E3BC CB7C             8      BIT 7,H
001D9D E3BE 2058            12      JR  NZ,PDWX
001D9F E3C0 CD16E3          17      CALL    FFLUSHBUF
       E3C3                     PDWT1:
001DA2 E3C3 C5              11      PUSH    BC
001DA3 E3C4 D5              11      PUSH    DE
001DA4 E3C5 ED5B7EE6        20      LD  DE,(_DTBUF)
001DA8 E3C9 DD7E0F          19      LD  A,(IX+DPB_BPS)  ;BCは読み出すセクタサイズ
001DAB E3CC E607             7      AND 7
001DAD E3CE 47               4      LD  B,A
001DAE E3CF 0E00             7      LD  C,0
001DB0 E3D1 EDB0                    LDIR
001DB2 E3D3 E3              19      EX  (SP),HL
001DB3 E3D4 EB               4      EX  DE,HL
001DB4 E3D5 D5              11      PUSH    DE
001DB5 E3D6 2A7EE6          16      LD  HL,(_DTBUF)
001DB8 E3D9 0601             7      LD  B,1
001DBA E3DB 37               4      SCF
001DBB E3DC CD18E4          17      CALL    PDWX
001DBE E3DF 3832            12      JR  C,PDRWERR
001DC0 E3E1 D1              10      POP DE
001DC1 E3E2 13               6      INC DE
001DC2 E3E3 E1              10      POP HL
001DC3 E3E4 C1              10      POP BC
001DC4 E3E5 10D4            13      DJNZ    PDWT
001DC6 E3E7 AF               4      XOR A
001DC7 E3E8 C9              10      RET
       E3E9                     PDRD:
001DC8 E3E9 CB7C             8      BIT 7,H
001DCA E3EB 202A            12      JR  NZ,PDWXR
001DCC E3ED CD16E3          17      CALL    FFLUSHBUF
       E3F0                     PDRD1:
001DCF E3F0 C5              11      PUSH    BC
001DD0 E3F1 D5              11      PUSH    DE
001DD1 E3F2 E5              11      PUSH    HL
001DD2 E3F3 2A7EE6          16      LD  HL,(_DTBUF)
001DD5 E3F6 0601             7      LD  B,1
001DD7 E3F8 CD17E4          17      CALL    PDWXR
001DDA E3FB 3816            12      JR  C,PDRWERR
001DDC E3FD D1              10      POP DE
001DDD E3FE 2A7EE6          16      LD  HL,(_DTBUF)
001DE0 E401 DD7E0F          19      LD  A,(IX+DPB_BPS)  ;BCは読み出すセクタサイズ
001DE3 E404 E607             7      AND 7
001DE5 E406 47               4      LD  B,A
001DE6 E407 0E00             7      LD  C,0
001DE8 E409 EDB0                    LDIR
001DEA E40B EB               4      EX  DE,HL
001DEB E40C D1              10      POP DE
001DEC E40D 13               6      INC DE
001DED E40E C1              10      POP BC
001DEE E40F 10D8            13      DJNZ    PDRD
001DF0 E411 AF               4      XOR A
001DF1 E412 C9              10      RET
       E413                     PDRWERR:
001DF2 E413 E1              10      POP HL
001DF3 E414 D1              10      POP DE
001DF4 E415 C1              10      POP BC
001DF5 E416 C9              10      RET
       E417                     PDWXR:
001DF6 E417 A7               4      AND A
       E418                     PDWX:                   ;CF=0 READ CF=1 WRITE
001DF7 E418 DDCB1266        20      BIT 4,(IX+DPB_DEVICE)   ;デバイス情報
001DFB E41C 2003            12      JR  NZ,PDWX1
001DFD E41E DD4E06          19      LD  C,(IX+DPB_FATID)    ;メディアバイト
       E421                     PDWX1:
001E00 E421 DD7E13          19      LD  A,(IX+DPB_UNITNO)   ;デバイスドライバ内におけるユニット番号
001E03 E424 C5              11      PUSH    BC
001E04 E425 D5              11      PUSH    DE
001E05 E426 E5              11      PUSH    HL
001E06 E427 DDE5            15      PUSH    IX
001E08 E429 FDE5            15      PUSH    IY
001E0A E42B CDA7FF          17      CALL    H_PHYD
001E0D E42E FDE1            14      POP IY
                                ;   LD  IX,PHYDIO
                                ;   CALL    CALSLT_R
001E0F E430 DDE1            14      POP IX
001E11 E432 E1              10      POP HL
001E12 E433 D1              10      POP DE
001E13 E434 C1              10      POP BC
001E14 E435 D8              11      RET C
       E436                     PDWX2:
001E15 E436 13               6      INC DE
001E16 E437 DD7E0F          19      LD  A,(IX+DPB_BPS)  ;BCは読み出すセクタサイズ
001E19 E43A E607             7      AND 7
001E1B E43C 84               4      ADD A,H
001E1C E43D 67               4      LD  H,A
001E1D E43E 10F6            13      DJNZ    PDWX2
001E1F E440 AF               4      XOR A
001E20 E441 C9              10      RET
[EOF:MSXDISK.ASM:UTF_8]
                                    INCLUDE "LDCCPWK.ASM"
                                
                                ;   LSX-Dodgers CCP WORK
                                
       003B                     PATHX   EQU 59
001E21 E442                     PATHD:  DS  PATHX
001E5C E47D 00                  PATHE:  DB  0
                                
       E47E                     DTA_CCP:
001E5D E47E                         DS  37
                                
       E4A3                     FCB_BAT:
001E82 E4A3                         DS  37
                                
001EA7 E4C8 2020203C4449523E    DIRMES: DB  "   <DIR>  $"
            202024              
001EB2 E4D3 20667265652024      FREE:   DB  " free $"
[EOF:LDCCPWK.ASM:UTF_8]
                                    INCLUDE "LDWORK.ASM"
                                
                                ;   LSX-Dodgers WORK0
                                ;
                                ;   CP/M互換BIOS
                                ;   BOOT:アドレス下位1バイトが0になるように
       E4DA                     AT_WORK:
001EB9 E4DA                         DS  WORKAD-AT_WORK
                                
       E500                     CPM_BOOT:
001EDF E500 C30000          10      JP  0
       E503                     _SYS00:     ;(BDOS)プログラム終了
       E503                     CPM_WBOOT:
001EE2 E503 C315CA          10      JP  WBOOT1
       E506                     CPM_CONST:
001EE5 E506 C369D2          10      JP  CONSTX
       E509                     _SYS07:     ;(BDOS)コンソール直接入力
       E509                     CPM_CONIN:
001EE8 E509 C38AD1          10      JP  FLGET
       E50C                     CPM_CONOUT:
001EEB E50C C36CD3          10      JP  CONOUT1
                                
       E50F                     DECBF:              ;10進数表示時のバッファ(5バイト)
001EEE E50F                         DS  5
       E50F                     RR_BUF_HL   EQU DECBF   ;CP/M互換ファイルアクセスの際のランダムレコードの一時的な保管場所
       E511                     RR_BUF_A    EQU DECBF+2 ;計3バイト
                                
       E514                     FDRV:
001EF3 E514 00                      DB  0
       E515                     FNAME:
001EF4 E515                         DS  36
       E539                     SFILE:
001F18 E539                         DS  33      ;DRV FILENAME
       E55A                     _DISKE:
001F39 E55A C306D1          10      JP  SHOW_ERROR
                                
001F3C E55D 0000                LEFTX:  DW  0
001F3E E55F 0000                DTAX:   DW  0
                                
       E561                     ZERO:
       E561                     BEEPD:
001F40 E561 008E01000B000C10        DB  0,08EH,1,0,00BH,0,00CH,010H
001F48 E569 073E08100D00FF          DB  007H,03EH,008H,010H,00DH,0,0FFH
       E562                     RTC_YY  EQU BEEPD+1
       E563                     RTC_MW  EQU BEEPD+2
       E564                     RTC_DD  EQU BEEPD+3
       E565                     RTC_TT  EQU BEEPD+4
       E566                     RTC_MM  EQU BEEPD+5
       E567                     RTC_SS  EQU BEEPD+6
       E562                     ROM_SLT EQU BEEPD+1
                                
       E570                     CHECK:
001F4F E570 00                      DB  0
                                
       E571                     OK:
001F50 E571 4F4B24                  DB  "OK$"
001F53 E574                         DS  5
       E579                     COMERM:
001F58 E579 4572726F722124          DB  "Error!$"
                                ;   システムワークエリア
                                ;   _CYL0:アドレス下位1バイトが080Hになるように
       E580                     _CYL0:
001F5F E580 FF                      DB  0FFH    ;Cylinder
       E581                     _CYL1:
001F60 E581 FF                      DB  0FFH    ;Cylinder
       E582                     _CYL2:
001F61 E582 FF                      DB  0FFH    ;Cylinder
       E583                     _CYL3:
001F62 E583 FF                      DB  0FFH    ;Cylinder
       E584                     _DRIVE:
001F63 E584 00                      DB  0   ;unit number
       E585                     _SEEKSP:
001F64 E585 00                      DB  0   ;Seek speed
       E586                     _ISEEK:
001F65 E586 32                      DB  50  ;
001F66 E587                         DS  1
       E588                     _DRV:
001F67 E588 00                      DB  0
       E589                     _DSK:
001F68 E589 FF                      DB  0FFH
       E58A                     _DTA:
001F69 E58A 8000                    DW  00080H
       E58C                     _CTC:
001F6B E58C 0000                    DW  0
       E58E                     _TXADR:
001F6D E58E 0000                    DW  0
       E590                     _KEYPS:
001F6F E590 0000                    DW  0
       E592                     _KEYD:
001F71 E592 00FF                    DW  0FF00H  ;キーデータ
       E594                     _KEYSP:
001F73 E594 0000                    DB  KEYSP_L,KEYSP_H ;オートリピートの速度
       E596                     _COLORF:
001F75 E596 00                      DB  COLORF  ;色
       E597                     _LINE:
001F76 E597 19                      DB  LINE
                                
       E598                     _FCB:
001F77 E598 0000                    DW  0   ;SEARCH FILES
       E59A                     _FBPS:
001F79 E59A 0000                    DW  0   ;    //
       E59C                     _FBAD:
001F7B E59C 0000                    DW  0   ;    //
       E59E                     _FBCNT:
001F7D E59E 00                      DB  0   ;    //
       E59F                     _FILEN:
001F7E E59F 00                      DB  0   ;    //
       E5A0                     _DIRF:
001F7F E5A0 00                      DB  0   ;bit7:ディレクトリ bit0-6:セクタインデックス
001F80 E5A1                         DS  1
       E5A2                     _WTFATF:
001F81 E5A2 00                      DB  0   ;FATバッファの更新フラグ
001F82 E5A3                         DS  1
       E5A4                     _WTDBF:
001F83 E5A4 00                      DB  0   ;データバッファの更新フラグ
       E5A5                     _DBDRV:
001F84 E5A5 FF                      DB  0FFH    ;データバッファにあるデータを読み込んだドライブ
       E5A6                     _DBSEC:
001F85 E5A6 0000                    DW  0   ;データバッファにあるデータを読み込んだセクタ番号
       E5A8                     _DPB:
001F87 E5A8 0000                    DW  0
       E5AA                     _FATDRV:
001F89 E5AA FF                      DB  0FFH    ;FATバッファに読み込んでいるドライブ
       E5AB                     _FATIX:
001F8A E5AB 00                      DB  0   ;FATバッファに読み込んでいるインデックス
       E5AC                     _FAKEFREE:
001F8B E5AC 0000                    DW  0   ;偽の残量（FATサイズが大きくなると重くなるのでその対策）
                                
001F8D E5AE                         DS  2
                                
       E5B0                     CRTCD:
001F8F E5B0 6F                      DB  06FH
       E5B1                     _WIDTH:
001F90 E5B1 28                      DB  WIDTH
       E5B2                     TVRAMTOP:
001F91 E5B2 5938                    DB  059H,038H
001F93 E5B4 1F02                    DB  01FH,002H
       E5B6                     _LINE2:
001F95 E5B6 19                      DB  019H
       E5B7                     WKE4:
001F96 E5B7 1C                      DB  01CH
       E5B8                     WKE6:
001F97 E5B8 00                      DB  000H
       E5B9                     WK40:
001F98 E5B9 07                      DB  007H
       E5BA                     _PAGE_MINUS:
001F99 E5BA 18FC                    DW  0-WIDTH*LINE
       E5BC                     _WIDTH_MINUS:
001F9B E5BC D8FF                    DW  0-WIDTH
       E5BE                     WK30:
001F9D E5BE 0C                      DB  00CH
       E5BF                     WK31:
       E5BF                     WK1FD0:
001F9E E5BF 20                      DB  020H
                                
001F9F E5C0 0000                CTC0:   DW  INTCTCE
001FA1 E5C2 0000                CTC1:   DW  INTCTCE
001FA3 E5C4 0000                CTC2:   DW  INTCTCE
001FA5 E5C6 0000                CTC3:   DW  INTCTCE
001FA7 E5C8 0000                INTVEC: DW  INT
                                
                                ;   LSX-Dodgers 独自BIOS
                                
001FA9 E5CA C3CFD1          10  _INKEY: JP  INKEY
001FAC E5CD C30FD1          10  _PRINT: JP  PRINT
001FAF E5D0 C306D3          10  _SCRN:  JP  SCRN
001FB2 E5D3 C3E6D2          10  _POS:   JP  POS
001FB5 E5D6 C3F1D2          10  _LOC:   JP  LOC
       E5D9                     _CHGDRV:
001FB8 E5D9 C32DE2          10      JP  CHGDRV
       E5DC                     _GETDPB:
001FBB E5DC C3EBE2          10      JP  GETDPB
       E5DF                     _FFLUSH:
001FBE E5DF C309E3          10      JP  FFLUSH
       E5E2                     _RDFATX:
001FC1 E5E2 C305DF          10      JP  RDFATX
001FC4 E5E5 C337E0          10  _RDFAT: JP  RDFAT
001FC7 E5E8 C324E3          10  _WTTRK: JP  WTTRK
001FCA E5EB C326E3          10  _FDRD:  JP  FDRD
001FCD E5EE C324E3          10  _FDWT:  JP  FDWT
       E5F1                     _BPB2DPB:
001FD0 E5F1 C3CFE0          10      JP  BPB2DPB
       E5F4                     _BREAK:
001FD3 E5F4 C390CB          10      JP  END_BATCH
       E5F7                     _GNCL:
001FD6 E5F7 C3B1DF          10      JP  GNCL        ; self-modifying code
       E5F8                     GNCPAT  EQU $-2
       E5FA                     _SNCL:
001FD9 E5FA C3D4DF          10      JP  SNCL        ; self-modifying code
       E5FB                     SNCPAT  EQU $-2
       E5FD                     _COMANL:
001FDC E5FD C349CA          10      JP  COMANL
                                
       E600                     _WE:
[EOF:LDWORK.ASM:SHIFT_JIS]
                                    INCLUDE "LDCALL.ASM"
                                
                                ;   LSX-Dodgers システムコール(BDOS)
                                ;
                                ;   LSX-Dodgers SYSTEM CALL
                                ;   STABLE:アドレス下位1バイトが0になるように
                                
       E600                     STABLE:
                                ;0
001FDF E600 03E512D143D16FD7        DW  _SYS00,_SYS01,_SYS02,_SYS03
001FE7 E608 71CE71CE49D109E5        DW  _SYS04,_SYS05,_SYS06,_SYS07
001FEF E610 51D173CED5D169D2        DW  _SYS08,_SYS09,_SYS0A,_SYS0B
001FF7 E618 88CE8DCE9CCEADCE        DW  _SYS0C,_SYS0D,_SYS0E,_SYS0F
                                ;1
001FFF E620 01CF48CF91CFC2CF        DW  _SYS10,_SYS11,_SYS12,_SYS13
002007 E628 CACFE0CFF5CFEDCF        DW  _SYS14,_SYS15,_SYS16,_SYS17
00200F E630 3CD041D046D04CD0        DW  _SYS18,_SYS19,_SYS1A,_SYS1B
002017 E638 71CE72D071CE76D0        DW  _SYS1C,_SYS1D,_SYS1E,_SYS1F
                                ;2
00201F E640 71CE2CD034D07DD0        DW  _SYS20,_SYS21,_SYS22,_SYS23
002027 E648 A2D071CEC5DB93DC        DW  _SYS24,_ERROR,_SYS26,_SYS27
00202F E650 34D0ACD07BD26FD7        DW  _SYS28,_SYS29,_SYS2A,_SYS2B
002037 E658 CBD26FD771CECDD0        DW  _SYS2C,_SYS2D,_SYS2E,_SYS2F
                                ;3
00203F E660 C7D071CE71CE71CE        DW  _SYS30,_ERROR,_ERROR,_ERROR
002047 E668 71CE71CE71CE71CE        DW  _ERROR,_ERROR,_ERROR,_ERROR
00204F E670 71CE6FD76FD7EED0        DW  _ERROR,_SYS39,_SYS3A,_SYS5A
                                ;DOS2
002057 E678 54CE                    DW  _DOS2
                                
002059 E67A                         DS  1
       E67B                     _MAX_SEC_SZ_H:
00205A E67B 02                      DB  MAX_SEC_SZ_H
       E67C                     _FATBF:
00205B E67C 00E8                    DW  FATBF
       E67E                     _DTBUF:
00205D E67E 00EE                    DW  DTBUF
                                
                                ;   コントロールコードテーブル
                                ;   CTRLTB:アドレス下位1バイトが080Hになるように
                                
       E680                     CTRLTB:
00205F E680 0000000016D30000        DW  CTRL00,CTRL00,CTRL02,CTRL03 ;  A,B,C
002067 E688 0000000000000000        DW  CTRL04,CTRL05,CTRL06,CTRL07 ;D,E,F,G
00206F E690 0000000000000000        DW  CTRL08,CTRL09,CTRL0A,CTRL0B ;H,I,J,K
002077 E698 0000000000000000        DW  CTRL0C,CTRL0D,CTRL0E,CTRL00 ;L,M,N,O
00207F E6A0 0000000000000000        DW  CTRL00,CTRL00,CTRL12,CTRL00 ;P,Q,R,S
002087 E6A8 0000000000000000        DW  CTRL00,CTRL00,CTRL00,CTRL00 ;T,U,V,W
00208F E6B0 0000000000000000        DW  CTRL00,CTRL00,CTRL0C,CTRL1B ;X,Y,Z,ESC
002097 E6B8 0000000000000000        DW  CTRL1C,CTRL1D,CTRL1E,CTRL1F ;→,←,↑,↓
                                
00209F E6C0 0200                M2D:    DW  2
0020A1 E6C2 FD02                    DB  0FDH,2
0020A3 E6C4 6401                    DW  356
0020A5 E6C6 FF0728090182            DB  0FFH,7,40,9,1,082H
0020AB E6CC 0500A7000800            DW  5,0A7H,8
                                
0020B1 E6D2 0200                M2HD:   DW  2
0020B3 E6D4 FE01                    DB  0FEH,1
0020B5 E6D6 C704                    DW  1223
0020B7 E6D8 FE064D080184            DB  0FEH,6,77,8,1,084H
0020BD E6DE 0500A7000900            DW  5,0A7H,9
                                
0020C3 E6E4 1617                SDDATA: DB  22,23       ;(FCB)ファイルを最後に変更した時刻
0020C5 E6E6 1415                    DB  20,21       ;(FCB)ファイルを最後に変更した日付
0020C7 E6E8 1A1B                    DB  26,27       ;(FCB)ファイルの先頭クラスタ
0020C9 E6EA 10111213                DB  16,17,18,19 ;(FCB)ファイルのサイズ(バイト単位)
       E6EE                     SDDATAE:
                                
0020CD E6EE                         DS  2
       E6F0                     _FCB_BAT:
0020CF E6F0 A3E4                    DW  FCB_BAT
       E6F2                     _PATH:
0020D1 E6F2 42E4                    DW  PATHD
                                
0020D3 E6F4                     SCDIR:  DS  2       ;+14 +15
0020D5 E6F6                     SFBPS:  DS  2       ;FBPS
0020D7 E6F8                     SFNDF:  DS  2       ;FILEN DIRF
                                
0020D9 E6FA 0000                _FATPS: DW  0
0020DB E6FC 0000                _DIRPS: DW  0
0020DD E6FE 0000                _CLPS:  DW  0
                                
       E700                     _PE:
[EOF:LDCALL.ASM:SHIFT_JIS]
                                    INCLUDE "MSXDPB.ASM"
                                
                                ;   LSX-Dodgers DPB
                                ;   MSX
                                
       E700                     _DEVICE:
                                
                                ;   A:
                                
0020DF E700 0300                    DW  3   ;DPB_FATLN
0020E1 E702 EBE5                    DW  _FDRD   ;DPB_DRD
0020E3 E704 EEE5                    DW  _FDWT   ;DPB_DWT
0020E5 E706 F9                      DB  0F9H    ;DPB_FATID
0020E6 E707 03                      DB  3   ;DPB_SECPCL
0020E7 E708 CB02                    DW  715 ;DPB_MAXCL
0020E9 E70A 00                      DB  0   ;DPB_FDMODE
0020EA E70B 07                      DB  7   ;DPB_DIRSCNT
0020EB E70C 01                      DB  1   ;DPB_MAXCYL ROMディスクではBPPが格納されている先頭BANK
0020EC E70D 00                      DB  0   ;DPB_MAXSEC
0020ED E70E 01                      DB  1   ;DPB_FATPS
0020EE E70F 82                      DB  082H    ;DPB_BPS
0020EF E710 0700                    DW  7   ;DPB_DIRPS
0020F1 E712 2E                      DB  02EH    ;DPB_DEVICE
0020F2 E713 00                      DB  0   ;DPB_UNITNO
0020F3 E714 0A00                    DW  10  ;DPB_ADDCL
0020F5 E716 0000                    DW  0   ;DPB_16
0020F7 E718 0000                    DW  0   ;DPB_18
0020F9 E71A 0000                    DW  0   ;DPB_SDIR
0020FB E71C 524F4D30                DB  "ROM0"  ;DPB_NAME
                                
                                ;   B:
                                
0020FF E720 0300                    DW  3   ;DPB_FATLN
002101 E722 EBE5                    DW  _FDRD   ;DPB_DRD
002103 E724 EEE5                    DW  _FDWT   ;DPB_DWT
002105 E726 F9                      DB  0F9H    ;DPB_FATID
002106 E727 03                      DB  3   ;DPB_SECPCL
002107 E728 CB02                    DW  715 ;DPB_MAXCL
002109 E72A 00                      DB  0   ;DPB_FDMODE
00210A E72B 07                      DB  7   ;DPB_DIRSCNT
00210B E72C 2E                      DB  46  ;DPB_MAXCYL ROMディスクではBPPが格納されている先頭BANK
00210C E72D 00                      DB  0   ;DPB_MAXSEC
00210D E72E 01                      DB  1   ;DPB_FATPS
00210E E72F 82                      DB  082H    ;DPB_BPS
00210F E730 0700                    DW  7   ;DPB_DIRPS
002111 E732 2E                      DB  02EH    ;DPB_DEVICE
002112 E733 01                      DB  1   ;DPB_UNITNO
002113 E734 0A00                    DW  10  ;DPB_ADDCL
002115 E736 0000                    DW  0   ;DPB_16
002117 E738 0000                    DW  0   ;DPB_18
002119 E73A 0000                    DW  0   ;DPB_SDIR
00211B E73C 524F4D31                DB  "ROM1"  ;DPB_NAME
                                
                                ;   C:
                                
00211F E740                         DS  32
                                
                                ;   D:
                                
00213F E760                         DS  32
                                
                                ;   E:
                                
00215F E780 0300                    DW  3   ;DPB_FATLN
002161 E782 E9E3                    DW  PDRD    ;DPB_DRD
002163 E784 BBE3                    DW  PDWT    ;DPB_DWT
002165 E786 F9                      DB  0F9H    ;DPB_FATID
002166 E787 03                      DB  3   ;DPB_SECPCL
002167 E788 CB02                    DW  715 ;DPB_MAXCL
002169 E78A FF                      DB  0FFH    ;DPB_FDMODE
00216A E78B 07                      DB  7   ;DPB_DIRSCNT
00216B E78C 50                      DB  80  ;DPB_MAXCYL ROMディスクではBPPが格納されている先頭BANK
00216C E78D 09                      DB  9   ;DPB_MAXSEC
00216D E78E 01                      DB  1   ;DPB_FATPS
00216E E78F 82                      DB  082H    ;DPB_BPS
00216F E790 0700                    DW  7   ;DPB_DIRPS
002171 E792 2D                      DB  02DH    ;DPB_DEVICE
002172 E793 00                      DB  0   ;DPB_UNITNO
002173 E794 0A00                    DW  10  ;DPB_ADDCL
002175 E796 0000                    DW  0   ;DPB_16
002177 E798 0000                    DW  0   ;DPB_18
002179 E79A 0000                    DW  0   ;DPB_SDIR
00217B E79C 44534B30                DB  "DSK0"  ;DPB_NAME
                                
                                ;   F:
                                
00217F E7A0 0300                    DW  3   ;DPB_FATLN
002181 E7A2 E9E3                    DW  PDRD    ;DPB_DRD
002183 E7A4 BBE3                    DW  PDWT    ;DPB_DWT
002185 E7A6 F9                      DB  0F9H    ;DPB_FATID
002186 E7A7 03                      DB  3   ;DPB_SECPCL
002187 E7A8 CB02                    DW  715 ;DPB_MAXCL
002189 E7AA FF                      DB  0FFH    ;DPB_FDMODE
00218A E7AB 07                      DB  7   ;DPB_DIRSCNT
00218B E7AC 50                      DB  80  ;DPB_MAXCYL ROMディスクではBPPが格納されている先頭BANK
00218C E7AD 09                      DB  9   ;DPB_MAXSEC
00218D E7AE 01                      DB  1   ;DPB_FATPS
00218E E7AF 82                      DB  082H    ;DPB_BPS
00218F E7B0 0700                    DW  7   ;DPB_DIRPS
002191 E7B2 2D                      DB  02DH    ;DPB_DEVICE
002192 E7B3 01                      DB  1   ;DPB_UNITNO
002193 E7B4 0A00                    DW  10  ;DPB_ADDCL
002195 E7B6 0000                    DW  0   ;DPB_16
002197 E7B8 0000                    DW  0   ;DPB_18
002199 E7BA 0000                    DW  0   ;DPB_SDIR
00219B E7BC 44534B31                DB  "DSK1"  ;DPB_NAME
                                
                                ;   G:
                                
00219F E7C0 0300                    DW  3   ;DPB_FATLN
0021A1 E7C2 E9E3                    DW  PDRD    ;DPB_DRD
0021A3 E7C4 BBE3                    DW  PDWT    ;DPB_DWT
0021A5 E7C6 F9                      DB  0F9H    ;DPB_FATID
0021A6 E7C7 03                      DB  3   ;DPB_SECPCL
0021A7 E7C8 CB02                    DW  715 ;DPB_MAXCL
0021A9 E7CA FF                      DB  0FFH    ;DPB_FDMODE
0021AA E7CB 07                      DB  7   ;DPB_DIRSCNT
0021AB E7CC 50                      DB  80  ;DPB_MAXCYL ROMディスクではBPPが格納されている先頭BANK
0021AC E7CD 09                      DB  9   ;DPB_MAXSEC
0021AD E7CE 01                      DB  1   ;DPB_FATPS
0021AE E7CF 82                      DB  082H    ;DPB_BPS
0021AF E7D0 0700                    DW  7   ;DPB_DIRPS
0021B1 E7D2 2D                      DB  02DH    ;DPB_DEVICE
0021B2 E7D3 02                      DB  2   ;DPB_UNITNO
0021B3 E7D4 0A00                    DW  10  ;DPB_ADDCL
0021B5 E7D6 0000                    DW  0   ;DPB_16
0021B7 E7D8 0000                    DW  0   ;DPB_18
0021B9 E7DA 0000                    DW  0   ;DPB_SDIR
0021BB E7DC 44534B32                DB  "DSK2"  ;DPB_NAME
                                
                                ;   H:
0021BF E7E0 0300                    DW  3   ;DPB_FATLN
0021C1 E7E2 E9E3                    DW  PDRD    ;DPB_DRD
0021C3 E7E4 BBE3                    DW  PDWT    ;DPB_DWT
0021C5 E7E6 F9                      DB  0F9H    ;DPB_FATID
0021C6 E7E7 03                      DB  3   ;DPB_SECPCL
0021C7 E7E8 CB02                    DW  715 ;DPB_MAXCL
0021C9 E7EA FF                      DB  0FFH    ;DPB_FDMODE
0021CA E7EB 07                      DB  7   ;DPB_DIRSCNT
0021CB E7EC 50                      DB  80  ;DPB_MAXCYL ROMディスクではBPPが格納されている先頭BANK
0021CC E7ED 09                      DB  9   ;DPB_MAXSEC
0021CD E7EE 01                      DB  1   ;DPB_FATPS
0021CE E7EF 82                      DB  082H    ;DPB_BPS
0021CF E7F0 0700                    DW  7   ;DPB_DIRPS
0021D1 E7F2 2D                      DB  02DH    ;DPB_DEVICE
0021D2 E7F3 07                      DB  7   ;DPB_UNITNO
0021D3 E7F4 0A00                    DW  10  ;DPB_ADDCL
0021D5 E7F6 0000                    DW  0   ;DPB_16
0021D7 E7F8 0000                    DW  0   ;DPB_18
0021D9 E7FA 0000                    DW  0   ;DPB_SDIR
0021DB E7FC 44534B37                DB  "DSK7"  ;DPB_NAME
       E800                     MSX_E:
[EOF:MSXDPB.ASM:UTF_8]
                                
0021DF E800                         DS  03FFFH - $$
003FFF 0620 00                      DB  0
       0621                     LAST_ADR:
                                
                                    END
[EOF:MSX.ASM:UTF_8]
