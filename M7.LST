                                ;*** AILZ80ASM *** Z-80 Assembler, version 1.0.0.0, LST:Full:4
                                ;   LSX-Dodgers for MZ-700/1500
                                ;   Programmed by
                                ;   Gaku (Lovers/Tablacus)
                                
                                    INCLUDE "M7DEF.ASM"
                                
                                ;   LSX-Dodgers DEF
                                ;   MZ-700/1500
                                
       0001                     MAC EQU 1   ;MZ-700/1500
       0000                     DEV EQU 0
                                
       011D                     VER_6F  EQU 0011DH
                                
       8080                     RUN EQU 08080H
       8000                     OFFSET  EQU RUN-128
       CF06                     BDOS    EQU 0CF06H
       ED40                     TABLEAD EQU 0ED40H
       F000                     WORKAD  EQU 0F000H
       F300                     FATBF   EQU 0F300H
       FB00                     DTBUF   EQU 0FB00H
       FF00                     KEYBF   EQU 0FF00H
       FF20                     KBUF    EQU 0FF20H
       FFD9                     TRAP38  EQU 0FFD9H
       0028                     WIDTH   EQU 40
       0019                     LINE    EQU 25
       0070                     COLORF  EQU 070H
       0010                     KEYSP_H EQU 16
       0083                     KEYSP_L EQU 131
       0009                     COMS    EQU 9
       0004                     MAX_SEC_SZ_H    EQU 4       ;1セクタ1024バイトのサポート(2:off 4:on)
[EOF:M7DEF.ASM:UTF_8]
                                    INCLUDE "LDDEF.ASM"
                                
                                ;   LSX-Dodgers DEF
                                
       0001                     VER_1   EQU 1
       0006                     VER_2   EQU 6
       0001                     VER_3   EQU 1
       1D01                     MACW    EQU MAC + 01D00H    ;機種フラグとLD判別フラグ
       0001                     MACD    EQU MAC + DEV * 256 ;機種フラグとデバイスフラグ
       0161                     VER EQU VER_1 * 256 + VER_2 * 16 + VER_3
                                
       0004                     _DVSW   EQU 00004H
       0005                     SYSTEM  EQU 00005H
       000F                     JP_HL   EQU 0000FH
       005C                     FCB1    EQU 0005CH
       006C                     FCB2    EQU 0006CH
       005D                     FCB1FN  EQU FCB1+1
       006D                     FCB2FN  EQU FCB2+1
       0080                     DTA1    EQU 00080H
                                
       FFCA                     EXTBIO  EQU 0FFCAH
                                
       0000                     DPB_FATLN   EQU 00H
       0002                     DPB_DRD     EQU 02H
       0004                     DPB_DWT     EQU 04H
       0006                     DPB_FATID   EQU 06H
       0007                     DPB_SECPCL  EQU 07H
       0008                     DPB_MAXCL   EQU 08H
       000A                     DPB_FDMODE  EQU 0AH
       000B                     DPB_DIRSCNT EQU 0BH
       000C                     DPB_MAXCYL  EQU 0CH
       000D                     DPB_MAXSEC  EQU 0DH
       000E                     DPB_FATPS   EQU 0EH
       000F                     DPB_BPS     EQU 0FH
       0010                     DPB_DIRPS   EQU 10H
       0012                     DPB_DEVICE  EQU 12H
       0013                     DPB_UNITNO  EQU 13H
       0014                     DPB_ADDCL   EQU 14H
                                
       001A                     DPB_SDIR    EQU 1AH
       001C                     DPB_NAME    EQU 1CH
                                
[EOF:LDDEF.ASM:SHIFT_JIS]
                                
000000 8000                         ORG OFFSET
                                                    ;MZTヘッダ128バイト
000000 8000 01                      DB  1           ;ファイルモード
000001 8001 4C44202020202020        DB  "LD           "     ;ファイル名(13)
            2020202020          
00000E 800E 535953                  DB  "SYS"           ;拡張子(3)
000011 8011 0D                      DB  $0D
000012 8012 3025                    DW  LAST_ADR-RUN        ;サイズ
000014 8014 8080                    DW  RUN         ;開始アドレス
000016 8016 8080                    DW  RUN         ;実行アドレス
000018 8018                         DS  104
                                
                                    INCLUDE "M7INIT.ASM"
                                
                                ;   LSX-Dodgers INIT
                                ;   MZ-700/1500
                                
000080 8080 C38780          10      JP  START
000083 8083 011D                    DW  MACW
000085 8085 6101                    DW  VER
                                
       8087                     START:
000087 8087 F3               4      DI
000088 8088 ED56             8      IM  1
00008A 808A 318780          10      LD  SP,START
00008D 808D CD9B80          17      CALL    INIT        ;NZならAUTOEXECを実行
000090 8090 210000          10      LD  HL,0
000093 8093 E5              11      PUSH    HL
000094 8094 C8              11      RET Z
000095 8095 116D81          10      LD  DE,AUTOD
000098 8098 C3FDF0          10      JP  _COMANL
                                
       809B                     INIT:
00009B 809B D3E0            11      OUT (0E0H),A    ;DRAM(0000H-0FFFH)
00009D 809D D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
00009F 809F 21D281          10      LD  HL,INITE
0000A2 80A2 1106CF          10      LD  DE,BDOS
0000A5 80A5 01DE23          10      LD  BC,LAST_ADR-INITE
0000A8 80A8 EDB0                    LDIR
0000AA 80AA 21A381          10      LD  HL,M7BEEPD
0000AD 80AD 1162F0          10      LD  DE,BEEPD+1
0000B0 80B0 010800          10      LD  BC,M7BEEPE-M7BEEPD
0000B3 80B3 EDB0                    LDIR
                                
0000B5 80B5 210000          10      LD  HL,0
0000B8 80B8 065C             7      LD  B,05CH
0000BA 80BA 3E                      DB  03EH    ;LD A,??
0000BB 80BB EF              12      RST 28H
0000BC 80BC CDECDB          17      CALL    FILL_MEMORY
0000BF 80BF 06A4             7      LD  B,0A4H
0000C1 80C1 AF               4      XOR A
0000C2 80C2 320400          13      LD  (_DVSW),A
0000C5 80C5 CDECDB          17      CALL    FILL_MEMORY
                                
0000C8 80C8 3EC3             7      LD  A,0C3H      ;JP
0000CA 80CA 2103F0          10      LD  HL,CPM_WBOOT
0000CD 80CD 320000          13      LD  (00000H),A
0000D0 80D0 220100          16      LD  (00001H),HL ;IPL
                                
0000D3 80D3 2106CF          10      LD  HL,BDOS
0000D6 80D6 320500          13      LD  (00005H),A
0000D9 80D9 220600          16      LD  (00006H),HL ;BDOS
                                
0000DC 80DC 21D9FF          10      LD  HL,TRAP38   ;TRAP38
0000DF 80DF 322800          13      LD  (00028H),A
0000E2 80E2 222900          16      LD  (00029H),HL ;RST 028H
                                
0000E5 80E5 323800          13      LD  (00038H),A
0000E8 80E8 211ACF          10      LD  HL,IO_INT8253
0000EB 80EB 223900          16      LD  (00039H),HL
                                
0000EE 80EE 3EF0             7      LD  A,CPM_BOOT/256
0000F0 80F0 320B00          13      LD  (0000BH),A
                                
0000F3 80F3 3EE9             7      LD  A,0E9H      ;JP (HL)
0000F5 80F5 320F00          13      LD  (0000FH),A
                                                    ;CHECK PCG(MZ-1500)
0000F8 80F8 2100E8          10      LD  HL,0E800H
0000FB 80FB 46               7      LD  B,(HL)
0000FC 80FC F3               4      DI
0000FD 80FD 3E01             7      LD  A,1
0000FF 80FF D3E5            11      OUT (0E5H),A    ;MZ-1500: PCGバンク切り替え
000101 8101 4E               7      LD  C,(HL)
000102 8102 79               4      LD  A,C
000103 8103 C6A5             7      ADD A,0A5H
000105 8105 5F               4      LD  E,A
000106 8106 73               7      LD  (HL),E
000107 8107 D3E6            11      OUT (0E6H),A    ;MZ-1500: PCGバンクを閉じる
000109 8109 71               7      LD  (HL),C
00010A 810A 3E01             7      LD  A,1
00010C 810C D3E5            11      OUT (0E5H),A    ;MZ-1500: PCGバンク切り替え
00010E 810E 7E               7      LD  A,(HL)
00010F 810F BB               4      CP  E
000110 8110 D3E6            11      OUT (0E6H),A    ;MZ-1500: PCGバンクを閉じる
000112 8112 70               7      LD  (HL),B
000113 8113 FB               4      EI
000114 8114 2804            12      JR  Z,MZ1500
000116 8116 AF               4      XOR A       ;MZ-700はPCGバンクが存在しない
000117 8117 32C0F2          13      LD  (GRAMFL),A
       811A                     MZ1500:
00011A 811A DD2180F2        14      LD  IX,EMMFL
00011E 811E CD6281          17      CALL    CHECK_EMM_BPB
000121 8121 FEEB             7      CP  0EBH
000123 8123 2810            12      JR  Z,EMM_BPB
000125 8125 DD360D02        19      LD  (IX+DPB_MAXSEC),2   ;BPBが512バイト目から始まる場合を調べる
000129 8129 CD6281          17      CALL    CHECK_EMM_BPB
00012C 812C DDBE06           7      CP  (IX+DPB_FATID)
00012F 812F 2004            12      JR  NZ,EMM_BPB
000131 8131 DD360D00        19      LD  (IX+DPB_MAXSEC),0   ;BPBが先頭の場合に戻す
       8135                     EMM_BPB:
000135 8135 217981          10      LD  HL,INIMES
000138 8138 CD89D4          17      CALL    MSX
       813B                     INIT1:
00013B 813B F3               4      DI
00013C 813C 1100FF          10      LD  DE,0FF00H
00013F 813F 0600             7      LD  B,0
000141 8141 CD27D3          17      CALL    ZERO_MEMORY_DE
000144 8144 21CAFF          10      LD  HL,EXTBIO
000147 8147 36C9            10      LD  (HL),0C9H   ;RET
000149 8149 23               6      INC HL
00014A 814A 060E             7      LD  B,TRAP38-EXTBIO-1
00014C 814C 3E                      DB  03EH    ;LD A,??
00014D 814D EF              12      RST 28H
00014E 814E CDECDB          17      CALL    FILL_MEMORY
000151 8151 21AB81          10      LD  HL,AT_TRAP38
000154 8154 11D9FF          10      LD  DE,TRAP38
000157 8157 012700          10      LD  BC,AT_TRAPE-AT_TRAP38
00015A 815A EDB0                    LDIR
                                
00015C 815C CDC7DA          17      CALL    CHKEY
00015F 815F FE03             7      CP  3
000161 8161 C9              10      RET
                                
       8162                     CHECK_EMM_BPB:
000162 8162 D5              11      PUSH    DE
000163 8163 110000          10      LD  DE,0
000166 8166 CD27EA          17      CALL    EADR
000169 8169 D1              10      POP DE
00016A 816A ED78            12      IN  A,(C)
00016C 816C C9              10      RET
                                
00016D 816D 4155544F45584543    AUTOD:  DB  "AUTOEXEC "
            20                  
000176 8176 413A00              AUTODV: DB  "A:",0
                                
000179 8179 0C4C53582D446F64    INIMES: DB  00CH,"LSX-Dodgers for MZ-700/1500 v"
            6765727320666F72    
            204D5A2D3730302F    
            313530302076        
000197 8197 312E                    DB  030H + VER_1, '.'
000199 8199 3631                    DB  030H + VER_2 ,030H + VER_3
00019B 819B                         DB  ''
00019B 819B 2047616B750D0A          DB  " Gaku",0DH,0AH
0001A2 81A2 00                      DB  0
                                
       81A3                     M7BEEPD:
0001A3 81A3 0801                    DB  8,1
0001A5 81A5 0736                    DB  7,036H
0001A7 81A7 04F9                    DB  4,0F9H
0001A9 81A9 0403                    DB  4,3
       81AB                     M7BEEPE:
                                
       81AB                     AT_TRAP38:
0001AB FFD9                         ORG TRAP38,AT_TRAP38-OFFSET
0001AB FFD9 210000          10      LD  HL,0
0001AE FFDC E3              19      EX  (SP),HL
0001AF FFDD 3E24             7      LD  A,'$'
0001B1 FFDF CD14D7          17      CALL    MSG_A
0001B4 FFE2 2B               6      DEC HL
0001B5 FFE3 7C               4      LD  A,H
0001B6 FFE4 CDE8FF          17      CALL    PRHX
0001B9 FFE7 7D               4      LD  A,L
       FFE8                     PRHX:
0001BA FFE8 F5              11      PUSH    AF
0001BB FFE9 07               4      RLCA
0001BC FFEA 07               4      RLCA
0001BD FFEB 07               4      RLCA
0001BE FFEC 07               4      RLCA
0001BF FFED CDF1FF          17      CALL    PRHX2
0001C2 FFF0 F1              10      POP AF
       FFF1                     PRHX2:
0001C3 FFF1 E60F             7      AND 00FH
0001C5 FFF3 FE0A             7      CP  10
0001C7 FFF5 3F               4      CCF
0001C8 FFF6 CE30             7      ADC A,'0'
0001CA FFF8 27               4      DAA
0001CB FFF9 C314D7          10      JP  MSG_A
0001CE FFFC                         DS  4
       81D2                         ORG $$+OFFSET   ;$DEPHASE
       81D2                     AT_TRAPE:
                                
       81D2                     INITE:
0001D2 CF06                         ORG BDOS,INITE-OFFSET
                                
0001D2 CF06 C309CF          10      JP  IO_BDOS
[EOF:M7INIT.ASM:SHIFT_JIS]
                                    INCLUDE "M7BANK.ASM"
                                
                                ;   LSX-Dodgers IO
                                ;   MZ-700/1500
                                ;   VRAM/KEY/TIMER(0D000H-0EFFFH)にアクセスするので0D000H-0FFFFHに置けない部分
                                ;
                                
       CF09                     IO_BDOS:
0001D5 CF09 D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
0001D7 CF0B C349D4          10      JP  BDOS0
                                
       CF0E                     RDKEYDATA:
0001DA CF0E F3               4      DI
0001DB CF0F D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
0001DD CF11 3200E0          13      LD  (0E000H),A
0001E0 CF14 3A01E0          13      LD  A,(E001H)
0001E3 CF17 D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
0001E5 CF19 FB               4      EI
       CF1A                     IO_INT8253:
0001E6 CF1A C9              10      RET
                                
       CF1B                     RD556VSYNC:
0001E7 CF1B F3               4      DI
0001E8 CF1C D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
0001EA CF1E 3A02E0          13      LD  A,(0E002H)
0001ED CF21 D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
0001EF CF23 FB               4      EI
0001F0 CF24 C9              10      RET
                                
       CF25                     RDMMIO:
0001F1 CF25 F3               4      DI
0001F2 CF26 D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
0001F4 CF28 7E               7      LD  A,(HL)
0001F5 CF29 D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
0001F7 CF2B FB               4      EI
0001F8 CF2C C9              10      RET
                                
       CF2D                     WRMMIO:
0001F9 CF2D F3               4      DI
0001FA CF2E D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
0001FC CF30 77               7      LD  (HL),A
0001FD CF31 D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
0001FF CF33 FB               4      EI
000200 CF34 C9              10      RET
                                
       CF35                     RDMMIO_BC:
000201 CF35 F3               4      DI
000202 CF36 D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
000204 CF38 0A               7      LD  A,(BC)
000205 CF39 D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
000207 CF3B FB               4      EI
000208 CF3C C9              10      RET
                                
       CF3D                     WRMMIO_BC:
000209 CF3D F3               4      DI
00020A CF3E D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
00020C CF40 02               7      LD  (BC),A
00020D CF41 D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
00020F CF43 FB               4      EI
000210 CF44 C9              10      RET
                                
       CF45                     IO_PRINT:
000211 CF45 F3               4      DI
000212 CF46 D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
000214 CF48 77               7      LD  (HL),A
000215 CF49 CBDC             8      SET 3,H
000217 CF4B 71               7      LD  (HL),C
000218 CF4C D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
00021A CF4E FB               4      EI
00021B CF4F C9              10      RET
                                
       CF50                     IO_CLR:
00021C CF50 F3               4      DI
00021D CF51 D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
       CF53                     C1AX1:
00021F CF53 7A               4      LD  A,D
000220 CF54 C6D0             7      ADD A,0D0H
000222 CF56 57               4      LD  D,A
000223 CF57 AF               4      XOR A
000224 CF58 12               7      LD  (DE),A      ;Text
000225 CF59 CBDA             8      SET 3,D
       CF5C                     ICSMC   EQU $+1
000227 CF5B 3E00             7      LD  A,0     ;自己書き換え
000229 CF5D 12               7      LD  (DE),A      ;Color
00022A CF5E 13               6      INC DE
00022B CF5F 7A               4      LD  A,D
00022C CF60 D6D8             7      SUB 0D8H
00022E CF62 57               4      LD  D,A
00022F CF63 2118FC          10      LD  HL,0-WIDTH*LINE
000232 CF66 19              11      ADD HL,DE
000233 CF67 30EA            12      JR  NC,C1AX1
000235 CF69 E1              10      POP HL
000236 CF6A D1              10      POP DE
000237 CF6B D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
000239 CF6D FB               4      EI
00023A CF6E C9              10      RET
                                
       CF6F                     IO_CLLINE:
00023B CF6F F3               4      DI
00023C CF70 D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
       CF72                     CLLINE1:
00023E CF72 CB9C             8      RES 3,H
000240 CF74 77               7      LD  (HL),A      ;Text
000241 CF75 CBDC             8      SET 3,H
000243 CF77 71               7      LD  (HL),C      ;Color
000244 CF78 23               6      INC HL
000245 CF79 10F7            13      DJNZ    CLLINE1
000247 CF7B D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
000249 CF7D FB               4      EI
00024A CF7E C9              10      RET
                                
       CF7F                     IO_INS:
00024B CF7F F3               4      DI
00024C CF80 D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
       CF82                     IO_INS1:
00024E CF82 CD99CF          17      CALL    C12S
000251 CF85 23               6      INC HL
000252 CF86 10FA            13      DJNZ    IO_INS1
000254 CF88 D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
000256 CF8A FB               4      EI
000257 CF8B C9              10      RET
                                
       CF8C                     IO_BS:
000258 CF8C F3               4      DI
000259 CF8D D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
       CF8F                     IO_BS1:
00025B CF8F CD99CF          17      CALL    C12S
00025E CF92 2B               6      DEC HL
00025F CF93 10F7            13      DJNZ    IO_BS
000261 CF95 D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
000263 CF97 FB               4      EI
000264 CF98 C9              10      RET
                                
       CF99                     C12S:
000265 CF99 CB9C             8      RES 3,H
000267 CF9B 5E               7      LD  E,(HL)
000268 CF9C 77               7      LD  (HL),A
000269 CF9D 7B               4      LD  A,E
00026A CF9E CBDC             8      SET 3,H
00026C CFA0 5E               7      LD  E,(HL)
00026D CFA1 71               7      LD  (HL),C
00026E CFA2 4B               4      LD  C,E
00026F CFA3 C9              10      RET
                                
       CFA4                     IO_SCRUP:
000270 CFA4 F3               4      DI
000271 CFA5 D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
       CFA7                     SCRUP1:
000273 CFA7 2815            12      JR  Z,SCRCL
000275 CFA9 D5              11      PUSH    DE
000276 CFAA E5              11      PUSH    HL
000277 CFAB CBDA             8      SET 3,D
000279 CFAD CBDC             8      SET 3,H
00027B CFAF 012800          10      LD  BC,WIDTH
00027E CFB2 EDB0                    LDIR
000280 CFB4 E1              10      POP HL
000281 CFB5 D1              10      POP DE
000282 CFB6 012800          10      LD  BC,WIDTH
000285 CFB9 EDB0                    LDIR
000287 CFBB 3D               4      DEC A
000288 CFBC 18E9            12      JR  SCRUP1
                                
       CFBE                     SCRCL:
00028A CFBE 0628             7      LD  B,WIDTH
00028C CFC0 EB               4      EX  DE,HL
00028D CFC1 D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
00028F CFC3 CD05D9          17      CALL    CLLINE
000292 CFC6 E1              10      POP HL
000293 CFC7 D1              10      POP DE
000294 CFC8 C1              10      POP BC
000295 CFC9 C9              10      RET
                                
       CFCA                     RD_PCG:
000296 CFCA F3               4      DI
000297 CFCB D3E5            11      OUT (0E5H),A    ;MZ-1500: PCGバンク切り替え
000299 CFCD 4E               7      LD  C,(HL)
       CFCE                     RW_PCG:
00029A CFCE D3E6            11      OUT (0E6H),A    ;MZ-1500: PCGバンクを閉じる
00029C CFD0 FB               4      EI
00029D CFD1 C9              10      RET
                                
       CFD2                     WR_PCG:
00029E CFD2 F3               4      DI
00029F CFD3 D3E5            11      OUT (0E5H),A    ;MZ-1500: PCGバンク切り替え
0002A1 CFD5 71               7      LD  (HL),C
0002A2 CFD6 18F6            12      JR  RW_PCG
                                
       CFD8                     C_MON:
0002A4 CFD8 D3E4            11      OUT (0E4H),A    ;MONITOR ROM(0000H-0FFFH) & VRAM/KEY/TIMER(D000H-FFFFH)
0002A6 CFDA C7              12      RST 0
                                
       CFDB                     BANKE:
0002A7 CFDB                         DS  0CFFEH-BANKE
[EOF:M7BANK.ASM:SHIFT_JIS]
                                    INCLUDE "M7CCP.ASM"
                                
                                ;   LSX-Dodgers CCP
                                ;   MZ-700/1500
                                
       CFFE                     WBOOT1:
0002CA CFFE D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)　ここは0CFFEH
0002CC D000 D3E0            11      OUT (0E0H),A    ;DRAM(0000H-0FFHH)
0002CE D002 F3               4      DI
0002CF D003 3A94F0          13      LD  A,(_KEYSP)
0002D2 D006 ED7B0600        20      LD  SP,(SYSTEM+1)
0002D6 D00A FB               4      EI
0002D7 D00B 2192F0          10      LD  HL,_KEYD
0002DA D00E 3600            10      LD  (HL),0
0002DC D010 CDC7DA          17      CALL    CHKEY
0002DF D013 CD10D7          17      CALL    KEYBC_IFBREAK
0002E2 D016 3E04             7      LD  A,4
0002E4 D018 CD14D7          17      CALL    MSG_A
[EOF:M7CCP.ASM:UTF_8]
                                    INCLUDE "LDCCP.ASM"
                                
                                ;   LSX-Dodgers CCP
                                
       D01B                     COMMAND:
0002E7 D01B 3A25EB          13      LD  A,(FCB_BAT)
0002EA D01E B7               4      OR  A
0002EB D01F C261D1          10      JP  NZ,C_BAT1
0002EE D022 CDD5D0          17      CALL    SETDTA1
0002F1 D025 3A0400          13      LD  A,(_DVSW)
0002F4 D028 C641             7      ADD A,'A'
0002F6 D02A CD14D7          17      CALL    MSG_A
0002F9 D02D 3E3E             7      LD  A,'>'
0002FB D02F CD14D7          17      CALL    MSG_A
0002FE D032 3E50             7      LD  A,80
000300 D034 12               7      LD  (DE),A
000301 D035 CD70D7          17      CALL    _SYS0A      ;(BDOS)文字列入力
000304 D038 CD56D2          17      CALL    LTNL
       D03B                     COMMAND2:
000307 D03B 118200          10      LD  DE,DTA1+2
00030A D03E CDFDF0          17      CALL    _COMANL
00030D D041 30D8            12      JR  NC,COMMAND
00030F D043 1179F0          10      LD  DE,COMERM
000312 D046 CD7AD4          17      CALL    _SYS09      ;(BDOS)文字列出力
000315 D049 C7              12      RST 0
                                
       D04A                     COMANL:
000316 D04A CD40DB          17      CALL    FILE
000319 D04D 3A19F0          13      LD  A,(FNAME+4)
00031C D050 FE20             7      CP  020H
00031E D052 201C            12      JR  NZ,COMB2
000320 D054 D5              11      PUSH    DE
000321 D055 1115F0          10      LD  DE,FNAME
000324 D058 1A               7      LD  A,(DE)
000325 D059 FE20             7      CP  020H
000327 D05B 2844            12      JR  Z,SDVSW
000329 D05D 1B               6      DEC DE
00032A D05E 1A               7      LD  A,(DE)
00032B D05F C6FF             7      ADD A,0FFH
00032D D061 3809            12      JR  C,COMB
00032F D063 13               6      INC DE
                                
000330 D064 2113D4          10      LD  HL,COMTB
000333 D067 0609             7      LD  B,COMS
000335 D069 CDCFDD          17      CALL    CPNAME
       D06C                     COMB:
000338 D06C D1              10      POP DE
000339 D06D D20F00          10      JP  NC,JP_HL
       D070                     COMB2:
00033C D070 EB               4      EX  DE,HL
00033D D071 223ED1          16      LD  (COMSWC),HL
000340 D074 F5              11      PUSH    AF
000341 D075 CDF6D0          17      CALL    CEXE4
000344 D078 F1              10      POP AF
000345 D079 2115F0          10      LD  HL,FNAME
000348 D07C 116D00          10      LD  DE,FCB2FN   ;COMMAND NAME
00034B D07F 010B00          10      LD  BC,11
00034E D082 EDB0                    LDIR
000350 D084 11C4EA          10      LD  DE,PATHD
       D087                     CEX1:
000353 D087 1A               7      LD  A,(DE)
000354 D088 FE20             7      CP  020H
000356 D08A D8              11      RET C
000357 D08B CD35DB          17      CALL    FILEC
00035A D08E D5              11      PUSH    DE
00035B D08F 216D00          10      LD  HL,FCB2FN   ;COMMAND NAME
00035E D092 1115F0          10      LD  DE,FNAME
000361 D095 010B00          10      LD  BC,11
000364 D098 EDB0                    LDIR
000366 D09A CDF6D0          17      CALL    CEXE4
000369 D09D D1              10      POP DE
00036A D09E 13               6      INC DE
00036B D09F 18E6            12      JR  CEX1
                                
       D0A1                     SDVSW:
00036D D0A1 F1              10      POP AF
00036E D0A2 3A14F0          13      LD  A,(FDRV)
000371 D0A5 3D               4      DEC A
000372 D0A6 5F               4      LD  E,A
000373 D0A7 0E0E             7      LD  C,00EH      ;(BDOS)カレントドライブの設定
000375 D0A9 1831            12      JR  SYSTEM0
                                
       D0AB                     OPEN1:
000377 D0AB 2114F0          10      LD  HL,FDRV
       D0AE                     OPEN:
00037A D0AE 0E11             7      LD  C,011H      ;(BDOS)ファイルの検索
       D0B0                     OPEN3:
00037C D0B0 D5              11      PUSH    DE
00037D D0B1 1100EB          10      LD  DE,DTA_CCP
000380 D0B4 CDD2D0          17      CALL    SETDTA
000383 D0B7 EB               4      EX  DE,HL
000384 D0B8 CDDCD0          17      CALL    SYSTEM0
000387 D0BB D1              10      POP DE
000388 D0BC C9              10      RET
                                
       D0BD                     OPEN2:
000389 D0BD 0E12             7      LD  C,012H
00038B D0BF 18EF            12      JR  OPEN3
                                
       D0C1                     DEFCB:              ;Z=Ok NZ=Error
00038D D0C1 1100EB          10      LD  DE,DTA_CCP
000390 D0C4 CDDAD0          17      CALL    SYSC0F
                                
000393 D0C7 1121EB          10      LD  DE,DTA_CCP+33   ;(FCB)ランダムレコード
000396 D0CA 0604             7      LD  B,4
000398 D0CC CD27D3          17      CALL    ZERO_MEMORY_DE
       D0CF                     SETDTA100:
00039B D0CF 110001          10      LD  DE,00100H
       D0D2                     SETDTA:
00039E D0D2 C34DD6          10      JP  _SYS1A      ;(BDOS)DTAの設定
                                
       D0D5                     SETDTA1:
0003A1 D0D5 118000          10      LD  DE,DTA1
0003A4 D0D8 18F8            12      JR  SETDTA
                                
       D0DA                     SYSC0F:
0003A6 D0DA 0E0F             7      LD  C,00FH      ;(BDOS)ファイルのオープン
       D0DC                     SYSTEM0:
0003A8 D0DC CD0500          17      CALL    SYSTEM
0003AB D0DF B7               4      OR  A
0003AC D0E0 C9              10      RET
                                
       D0E1                     C_CD:
0003AD D0E1 0E5A             7      LD  C,05AH
0003AF D0E3 18F7            12      JR  SYSTEM0
                                
       D0E5                     S27BUF:
0003B1 D0E5 2100FE          10      LD  HL,0-00200H ;スクラッチエリア(0100H)+スタック予備(0100H)
0003B4 D0E8 39              11      ADD HL,SP
0003B5 D0E9 2E00             7      LD  L,0
0003B7 D0EB 7C               4      LD  A,H
0003B8 D0EC E6F8             7      AND 0F8H
0003BA D0EE 67               4      LD  H,A
       D0EF                     S27DTA:
0003BB D0EF 1100EB          10      LD  DE,DTA_CCP
       D0F2                     S27:
0003BE D0F2 0E27             7      LD  C,027H      ;(BDOS)ランダムブロック読み込み
0003C0 D0F4 18E6            12      JR  SYSTEM0
                                
       D0F6                     CEXE4:
0003C2 D0F6 211DF0          10      LD  HL,FNAME+8
0003C5 D0F9 7E               7      LD  A,(HL)
0003C6 D0FA FE20             7      CP  020H
0003C8 D0FC 2007            12      JR  NZ,CEXE7
0003CA D0FE 3E3F             7      LD  A,'?'
0003CC D100 77               7      LD  (HL),A
0003CD D101 23               6      INC HL
0003CE D102 77               7      LD  (HL),A
0003CF D103 23               6      INC HL
0003D0 D104 77               7      LD  (HL),A
       D105                     CEXE7:
0003D1 D105 CDABD0          17      CALL    OPEN1
       D108                     CEXE5:
0003D4 D108 C0              11      RET NZ
0003D5 D109 2A0AEB          16      LD  HL,(DTA_CCP+1+9)
0003D8 D10C 7C               4      LD  A,H
0003D9 D10D CD57DE          17      CALL    CAP
0003DC D110 67               4      LD  H,A
0003DD D111 7D               4      LD  A,L
0003DE D112 CD57DE          17      CALL    CAP
0003E1 D115 6F               4      LD  L,A
0003E2 D116 3A09EB          13      LD  A,(DTA_CCP+1+8)
0003E5 D119 CD57DE          17      CALL    CAP
0003E8 D11C D642             7      SUB 'B'
0003EA D11E 282C            12      JR  Z,C_BAT
0003EC D120 3D               4      DEC A       ;'C'
0003ED D121 2805            12      JR  Z,C_EXE
       D123                     CEXE6:
0003EF D123 CDBDD0          17      CALL    OPEN2
0003F2 D126 18E0            12      JR  CEXE5
                                
       D128                     C_EXE:
0003F4 D128 7C               4      LD  A,H
0003F5 D129 FE4D             7      CP  'M'
0003F7 D12B 20F6            12      JR  NZ,CEXE6
                                
0003F9 D12D CDC1D0          17      CALL    DEFCB
0003FC D130 CDE5D0          17      CALL    S27BUF
0003FF D133 3D               4      DEC A
000400 D134 37               4      SCF
000401 D135 C0              11      RET NZ
000402 D136 7C               4      LD  A,H
000403 D137 B5               4      OR  L
000404 D138 37               4      SCF
000405 D139 C8              11      RET Z
000406 D13A CDD5D0          17      CALL    SETDTA1
000409 D13D 110000          10      LD  DE,0                ; self-modifying code
       D13E                     COMSWC  EQU $-2
00040C D140 ED7B0600        20      LD  SP,(SYSTEM+1)
000410 D144 67               4      LD  H,A             ; A=0 in SETDTA1(_SYS1A)
000411 D145 6F               4      LD  L,A
000412 D146 E5              11      PUSH    HL              ; push $0000 (reboot address)
000413 D147 24               4      INC H
000414 D148 E5              11      PUSH    HL              ; push $0100 (TPA address)
000415 D149 C3F2D2          10      JP  SETFCB              ; and JP $0100
                                
       D14C                     C_BAT:
000418 D14C 114154          10      LD  DE,'A'+'T'*256
00041B D14F ED52            15      SBC HL,DE
00041D D151 20D0            12      JR  NZ,CEXE6
                                
00041F D153 CDC1D0          17      CALL    DEFCB
                                
000422 D156 2100EB          10      LD  HL,DTA_CCP
000425 D159 1125EB          10      LD  DE,FCB_BAT
000428 D15C 012500          10      LD  BC,37
00042B D15F EDB0                    LDIR
       D161                     C_BAT1:
00042D D161 CDCFD0          17      CALL    SETDTA100
000430 D164 CD98D1          17      CALL    FGETC_BAT
000433 D167 218100          10      LD  HL,DTA1+1
000436 D16A 2025            12      JR  NZ,END_BATCH
000438 D16C FE21             7      CP  021H        ;スペースや改行など制御文字を飛ばす
00043A D16E 38F1            12      JR  C,C_BAT1
00043C D170 3620            10      LD  (HL),' '
00043E D172 23               6      INC HL
       D173                     C_BAT2:
00043F D173 77               7      LD  (HL),A
000440 D174 23               6      INC HL
000441 D175 7D               4      LD  A,L
000442 D176 3C               4      INC A       ;L==0FFH
000443 D177 2809            12      JR  Z,RUN_BATCH
000445 D179 CD98D1          17      CALL    FGETC_BAT
000448 D17C 2004            12      JR  NZ,RUN_BATCH
00044A D17E FE20             7      CP  020H
00044C D180 30F1            12      JR  NC,C_BAT2
       D182                     RUN_BATCH:
00044E D182 7D               4      LD  A,L
00044F D183 D67F             7      SUB DTA1-1
000451 D185 328000          13      LD  (DTA1),A
000454 D188 FE04             7      CP  4
000456 D18A 3805            12      JR  C,END_BATCH
000458 D18C 3600            10      LD  (HL),0
00045A D18E C33BD0          10      JP  COMMAND2
       D191                     END_BATCH:
00045D D191 AF               4      XOR A       ;バッチファイルを閉じる
00045E D192 3225EB          13      LD  (FCB_BAT),A
000461 D195 C300F0          10      JP  CPM_BOOT
                                
       D198                     FGETC_BAT:
000464 D198 1125EB          10      LD  DE,FCB_BAT
       D19B                     FGETC:              ;1文字ずつ読み込む
000467 D19B E5              11      PUSH    HL      ;Z:成功
000468 D19C 210100          10      LD  HL,1
00046B D19F CDF2D0          17      CALL    S27
00046E D1A2 E1              10      POP HL
00046F D1A3 3A0001          13      LD  A,(00100H)
000472 D1A6 C9              10      RET
                                
       D1A7                     C_DEL:
000473 D1A7 CDF2D2          17      CALL    SETFCB
000476 D1AA CD2AD7          17      CALL    _SYS08      ;(BDOS)エコーなしコンソール入力
                                
000479 D1AD 0E13             7      LD  C,013H
00047B D1AF 180A            12      JR  CDEL1       ;(BDOS)ファイルの削除
                                
       D1B1                     C_REN:
00047D D1B1 CDF2D2          17      CALL    SETFCB
000480 D1B4 3E10             7      LD  A,010H      ;ディレクトリも対象にする
000482 D1B6 326900          13      LD  (FCB1+13),A ;属性
000485 D1B9 0E17             7      LD  C,017H      ;(BDOS)ファイル名の変更
       D1BB                     CDEL1:
000487 D1BB 115C00          10      LD  DE,FCB1
00048A D1BE CD0500          17      CALL    SYSTEM
00048D D1C1 C6FF             7      ADD A,0FFH
00048F D1C3 C9              10      RET
                                
       D1C4                     C_DIR:
000490 D1C4 CD35DB          17      CALL    FILEC
000493 D1C7 2115F0          10      LD  HL,FDRV+1
000496 D1CA CD08D4          17      CALL    CWILD1
000499 D1CD 3EF1             7      LD  A,0F1H
00049B D1CF 3221F0          13      LD  (FDRV+13),A
00049E D1D2 CDABD0          17      CALL    OPEN1
       D1D5                     CDIR1:
0004A1 D1D5 B7               4      OR  A
0004A2 D1D6 2008            12      JR  NZ,PDSKF
0004A4 D1D8 CD23D2          17      CALL    P_NAME
0004A7 D1DB CDBDD0          17      CALL    OPEN2
0004AA D1DE 18F5            12      JR  CDIR1
       D1E0                     PDSKF:
0004AC D1E0 3A14F0          13      LD  A,(FDRV)
0004AF D1E3 5F               4      LD  E,A
0004B0 D1E4 0E1B             7      LD  C,01BH      ;(BDOS)ディスク情報の獲得
0004B2 D1E6 CD0500          17      CALL    SYSTEM
0004B5 D1E9 4F               4      LD  C,A     ;C←1クラスタ辺りの論理セクタ数
0004B6 D1EA C601             7      ADD A,001H
0004B8 D1EC D8              11      RET C       ;Aが0FFHだった場合
0004B9 D1ED 3E06             7      LD  A,8-2
       D1EF                     PDS1:               ;HL=未使用クラスタの総数
0004BB D1EF 3C               4      INC A
0004BC D1F0 CB19             8      RR  C
0004BE D1F2 30FB            12      JR  NC,PDS1
       D1F4                     PDS2:               ;B←論理セクタのサイズの上位8ビット
0004C0 D1F4 3C               4      INC A
0004C1 D1F5 CB18             8      RR  B
0004C3 D1F7 30FB            12      JR  NC,PDS2
0004C5 D1F9 47               4      LD  B,A
                                
0004C6 D1FA 110000          10      LD  DE,0
       D1FD                     PDS3:
0004C9 D1FD 29              11      ADD HL,HL
0004CA D1FE EB               4      EX  DE,HL
0004CB D1FF ED6A            15      ADC HL,HL
0004CD D201 EB               4      EX  DE,HL
0004CE D202 10F9            13      DJNZ    PDS3
       D204                     PDSKF1:
0004D0 D204 CD90D2          17      CALL    PRDEC_DEHL
0004D3 D207 1155EB          10      LD  DE,FREE
0004D6 D20A CD7AD4          17      CALL    _SYS09      ;(BDOS)文字列出力
0004D9 D20D CD7DD2          17      CALL    PUTDRV
0004DC D210 3E5C             7      LD  A,05CH      ;\
0004DE D212 CD14D7          17      CALL    MSG_A
0004E1 D215 2A22F0          16      LD  HL,(FDRV+14)    ;ディレクトリのクラスタ番号
0004E4 D218 AF               4      XOR A
0004E5 D219 11FEFF          10      LD  DE,0-2
0004E8 D21C 19              11      ADD HL,DE
0004E9 D21D 23               6      INC HL
0004EA D21E DC8DD2          17      CALL    C,PRDEC_HL
0004ED D221 1833            12      JR  LTNL
                                
       D223                     P_NAME:
0004EF D223 3A01EB          13      LD  A,(DTA_CCP+1)
0004F2 D226 FE2E             7      CP  '.'
0004F4 D228 C8              11      RET Z
                                
0004F5 D229 3A0CEB          13      LD  A,(DTA_CCP+1+00BH)
0004F8 D22C F5              11      PUSH    AF
0004F9 D22D CB67             8      BIT 4,A
0004FB D22F 2808            12      JR  Z,DIR3
0004FD D231 114AEB          10      LD  DE,DIRMES
000500 D234 CD7AD4          17      CALL    _SYS09      ;(BDOS)文字列出力
000503 D237 180A            12      JR  DIR6
       D239                     DIR3:
000505 D239 ED5B1FEB        20      LD  DE,(DTA_CCP+1+01EH)
000509 D23D 2A1DEB          16      LD  HL,(DTA_CCP+1+01CH)
00050C D240 CD90D2          17      CALL    PRDEC_DEHL
       D243                     DIR6:
00050F D243 F1              10      POP AF
000510 D244 0F               4      RRCA
000511 D245 9F               4      SBC A,A
000512 D246 E60A             7      AND '*'-020H
000514 D248 C620             7      ADD A,020H
000516 D24A CD14D7          17      CALL    MSG_A
000519 D24D CD7DD2          17      CALL    PUTDRV
00051C D250 2101EB          10      LD  HL,DTA_CCP+1
00051F D253 CDD0D2          17      CALL    FPRNT
                                
       D256                     LTNL:
000522 D256 1E03             7      LD  E,3
000524 D258 C3CDF0          10      JP  _PRINT
                                
       D25B                     C_PATH:
000527 D25B CD17DC          17      CALL    SPCUT
00052A D25E 21C4EA          10      LD  HL,PATHD
00052D D261 FE21             7      CP  021H
00052F D263 300C            12      JR  NC,CPATH0
       D265                     CPATHP:
000531 D265 7E               7      LD  A,(HL)
000532 D266 23               6      INC HL
000533 D267 FE20             7      CP  020H
000535 D269 3F               4      CCF
000536 D26A 30EA            12      JR  NC,LTNL
000538 D26C CD14D7          17      CALL    MSG_A
00053B D26F 18F4            12      JR  CPATHP
       D271                     CPATH0:
00053D D271 FE3B             7      CP  ';'
00053F D273 2001            12      JR  NZ,CPATH1
000541 D275 13               6      INC DE
       D276                     CPATH1:
000542 D276 EB               4      EX  DE,HL
000543 D277 013B00          10      LD  BC,PATHX
000546 D27A EDB0                    LDIR
000548 D27C C9              10      RET
                                
       D27D                     PUTDRV:
000549 D27D 3A14F0          13      LD  A,(FDRV)
00054C D280 CD4ADC          17      CALL    GETDRV1
00054F D283 C641             7      ADD A,'A'
000551 D285 CD14D7          17      CALL    MSG_A
000554 D288 3E3A             7      LD  A,':'
       D28A                     MSG_AR:
000556 D28A C314D7          10      JP  MSG_A
                                
       D28D                     PRDEC_HL:
000559 D28D AF               4      XOR A
00055A D28E 5F               4      LD  E,A
00055B D28F 57               4      LD  D,A
       D290                     PRDEC_DEHL:
00055C D290 D5              11      PUSH    DE
00055D D291 110FF0          10      LD  DE,DECBF
000560 D294 0605             7      LD  B,5
000562 D296 CD27D3          17      CALL    ZERO_MEMORY_DE  ;A=0
000565 D299 D1              10      POP DE
                                
000566 D29A 0E20             7      LD  C,32
       D29C                     DEC1:
000568 D29C 29              11      ADD HL,HL
000569 D29D EB               4      EX  DE,HL
00056A D29E ED6A            15      ADC HL,HL
00056C D2A0 EB               4      EX  DE,HL
00056D D2A1 E5              11      PUSH    HL
00056E D2A2 2113F0          10      LD  HL,DECBF+4
000571 D2A5 0605             7      LD  B,5
       D2A7                     DEC2:
000573 D2A7 7E               7      LD  A,(HL)
000574 D2A8 8F               4      ADC A,A
000575 D2A9 27               4      DAA
000576 D2AA 77               7      LD  (HL),A
000577 D2AB 2B               6      DEC HL
000578 D2AC 10F9            13      DJNZ    DEC2
00057A D2AE E1              10      POP HL
00057B D2AF 0D               4      DEC C
00057C D2B0 20EA            12      JR  NZ,DEC1
                                
00057E D2B2 210FF0          10      LD  HL,DECBF
000581 D2B5 3E20             7      LD  A,020H
000583 D2B7 0604             7      LD  B,4
       D2B9                     DEC3:
000585 D2B9 CDC6D2          17      CALL    DEC4
000588 D2BC CDC6D2          17      CALL    DEC4
00058B D2BF 23               6      INC HL
00058C D2C0 10F7            13      DJNZ    DEC3
       D2C2                     DECX:
00058E D2C2 CDC6D2          17      CALL    DEC4
000591 D2C5 AF               4      XOR A
       D2C6                     DEC4:
000592 D2C6 ED6F            18      RLD
000594 D2C8 FE20             7      CP  020H
000596 D2CA 2802            12      JR  Z,DEC5
000598 D2CC F630             7      OR  030H
       D2CE                     DEC5:
00059A D2CE 18BA            12      JR  MSG_AR
                                
       D2D0                     FPRNT:
00059C D2D0 0608             7      LD  B,8 ;ファイル名を表示
00059E D2D2 CDE1D2          17      CALL    P_N1
0005A1 D2D5 7E               7      LD  A,(HL)
0005A2 D2D6 CD63DE          17      CALL    CAP3
0005A5 D2D9 D8              11      RET C   ;拡張子が無い
                                
0005A6 D2DA 3E2E             7      LD  A,'.'
0005A8 D2DC CD14D7          17      CALL    MSG_A
0005AB D2DF 0603             7      LD  B,3 ;拡張子を表示
       D2E1                     P_N1:
0005AD D2E1 7E               7      LD  A,(HL)
0005AE D2E2 CD63DE          17      CALL    CAP3
0005B1 D2E5 3807            12      JR  C,P_N2
0005B3 D2E7 CD14D7          17      CALL    MSG_A
0005B6 D2EA 23               6      INC HL
0005B7 D2EB 10F4            13      DJNZ    P_N1
0005B9 D2ED C9              10      RET
       D2EE                     P_N2:
0005BA D2EE 23               6      INC HL
0005BB D2EF 10FD            13      DJNZ    P_N2
0005BD D2F1 C9              10      RET
                                
       D2F2                     SETFCB:
0005BE D2F2 CD17DC          17      CALL    SPCUT
0005C1 D2F5 1A               7      LD  A,(DE)
0005C2 D2F6 FE20             7      CP  020H
0005C4 D2F8 3801            12      JR  C,SETFCBA
0005C6 D2FA 1B               6      DEC DE
       D2FB                     SETFCBA:
0005C7 D2FB 0624             7      LD  B,36
0005C9 D2FD 215C00          10      LD  HL,FCB1
0005CC D300 E5              11      PUSH    HL
0005CD D301 AF               4      XOR A
0005CE D302 CDECDB          17      CALL    FILL_MEMORY
0005D1 D305 E1              10      POP HL
0005D2 D306 D5              11      PUSH    DE
0005D3 D307 CDB4D6          17      CALL    _SYS29      ;(BDOS)ファイル名の解析
0005D6 D30A 216C00          10      LD  HL,FCB2
0005D9 D30D CDB4D6          17      CALL    _SYS29      ;(BDOS)ファイル名の解析
0005DC D310 E1              10      POP HL
0005DD D311 010050          10      LD  BC,05000H
0005E0 D314 118100          10      LD  DE,00081H
       D317                     SETFCB1:
0005E3 D317 7E               7      LD  A,(HL)
0005E4 D318 23               6      INC HL
0005E5 D319 FE20             7      CP  020H
0005E7 D31B 3805            12      JR  C,SETFCB2
0005E9 D31D 12               7      LD  (DE),A
0005EA D31E 13               6      INC DE
0005EB D31F 0C               4      INC C
0005EC D320 10F5            13      DJNZ    SETFCB1
       D322                     SETFCB2:
0005EE D322 79               4      LD  A,C
0005EF D323 328000          13      LD  (DTA1),A
0005F2 D326 04               4      INC B
       D327                     ZERO_MEMORY_DE:
0005F3 D327 AF               4      XOR A
       D328                     FILL_MEMORY_DE:
0005F4 D328 12               7      LD  (DE),A
0005F5 D329 13               6      INC DE
0005F6 D32A 10FC            13      DJNZ    FILL_MEMORY_DE
0005F8 D32C C9              10      RET
                                
       D32D                     C_COPY:
0005F9 D32D CDF2D2          17      CALL    SETFCB
                                
0005FC D330 1161F0          10      LD  DE,ZERO
0005FF D333 CD38DB          17      CALL    FILEC2
000602 D336 216C00          10      LD  HL,FCB2
000605 D339 CDBBD6          17      CALL    S29X1
                                
000608 D33C 3E10             7      LD  A,010H
00060A D33E 326900          13      LD  (FCB1+13),A
00060D D341 216D00          10      LD  HL,FCB2FN
000610 D344 CD08D4          17      CALL    CWILD1
       D347                     COPY0:
000613 D347 CD05D4          17      CALL    CWILD
000616 D34A 215C00          10      LD  HL,FCB1
000619 D34D CDAED0          17      CALL    OPEN
00061C D350 37               4      SCF
       D351                     COPY1:
00061D D351 C0              11      RET NZ
00061E D352 CDC1D0          17      CALL    DEFCB
                                
000621 D355 3A0DEB          13      LD  A,(DTA_CCP+13)
000624 D358 CB67             8      BIT 4,A
000626 D35A 2821            12      JR  Z,COPY1A
                                
000628 D35C 215D00          10      LD  HL,FCB1FN
00062B D35F CD7BDF          17      CALL    CHKWILD
00062E D362 3814            12      JR  C,COPY9
                                
000630 D364 3E20             7      LD  A,020H
000632 D366 325D00          13      LD  (FCB1FN),A
000635 D369 2A1AEB          16      LD  HL,(DTA_CCP+26)
000638 D36C 23               6      INC HL
000639 D36D 226A00          16      LD  (FCB1+14),HL
00063C D370 18D5            12      JR  COPY0
                                
       D372                     COPY8:
00063E D372 CD7AD4          17      CALL    _SYS09      ;(BDOS)文字列出力
000641 D375 CD56D2          17      CALL    LTNL
       D378                     COPY9:
000644 D378 CDBDD0          17      CALL    OPEN2
000647 D37B 18D4            12      JR  COPY1
                                
       D37D                     COPY1A:
000649 D37D 216C00          10      LD  HL,FCB2
00064C D380 1114F0          10      LD  DE,FDRV
00064F D383 0102EB          10      LD  BC,DTA_CCP+2
000652 D386 EDA0            16      LDI
000654 D388 3E0B             7      LD  A,11
       D38A                     COPY2:
000656 D38A F5              11      PUSH    AF
000657 D38B 7E               7      LD  A,(HL)
000658 D38C FE3F             7      CP  '?'
00065A D38E 2001            12      JR  NZ,COPY3
00065C D390 0A               7      LD  A,(BC)
       D391                     COPY3:
00065D D391 12               7      LD  (DE),A
00065E D392 03               6      INC BC
00065F D393 13               6      INC DE
000660 D394 23               6      INC HL
000661 D395 F1              10      POP AF
000662 D396 3D               4      DEC A
000663 D397 20F1            12      JR  NZ,COPY2
000665 D399 010500          10      LD  BC,16-11
000668 D39C EDB0                    LDIR
       D39E                     PUTNAME:
00066A D39E 215D00          10      LD  HL,FCB1FN
00066D D3A1 CD7BDF          17      CALL    CHKWILD
000670 D3A4 300B            12      JR  NC,PUTN1
000672 D3A6 2115F0          10      LD  HL,FDRV+1
000675 D3A9 CDD0D2          17      CALL    FPRNT
000678 D3AC 3E20             7      LD  A,020H
00067A D3AE CD14D7          17      CALL    MSG_A
       D3B1                     PUTN1:
00067D D3B1 1114F0          10      LD  DE,FDRV
000680 D3B4 0E16             7      LD  C,016H      ;(BDOS)ファイルの作成
000682 D3B6 CDDCD0          17      CALL    SYSTEM0
000685 D3B9 2048            12      JR  NZ,COPYE2
000687 D3BB 67               4      LD  H,A     ;A=0
000688 D3BC 6F               4      LD  L,A
000689 D3BD 2235F0          16      LD  (FDRV+33),HL    ;(FCB)ランダムレコード
00068C D3C0 2237F0          16      LD  (FDRV+35),HL
       D3C3                     COPY6:
00068F D3C3 CDE5D0          17      CALL    S27BUF
000692 D3C6 47               4      LD  B,A
000693 D3C7 3C               4      INC A
000694 D3C8 2831            12      JR  Z,COPYE
000696 D3CA 7C               4      LD  A,H
000697 D3CB B5               4      OR  L
000698 D3CC 280C            12      JR  Z,COPY7
00069A D3CE 1114F0          10      LD  DE,FDRV
00069D D3D1 0E26             7      LD  C,026H      ;(BDOS)ランダムブロック書き込み
00069F D3D3 CDDCD0          17      CALL    SYSTEM0
0006A2 D3D6 2023            12      JR  NZ,COPYE
0006A4 D3D8 10E9            13      DJNZ    COPY6
       D3DA                     COPY7:
0006A6 D3DA 3A0DEB          13      LD  A,(DTA_CCP+13)  ;(FCB)属性
0006A9 D3DD 3221F0          13      LD  (FDRV+13),A
0006AC D3E0 2114EB          10      LD  HL,DTA_CCP+20   ;(FCB)タイムスタンプ
0006AF D3E3 1128F0          10      LD  DE,FDRV+20
0006B2 D3E6 010400          10      LD  BC,4
0006B5 D3E9 EDB0                    LDIR
                                
0006B7 D3EB 1114F0          10      LD  DE,FDRV
0006BA D3EE 0E10             7      LD  C,010H      ;(BDOS)ファイルのクローズ
0006BC D3F0 CDDCD0          17      CALL    SYSTEM0
0006BF D3F3 2006            12      JR  NZ,COPYE
                                
0006C1 D3F5 1171F0          10      LD  DE,OK
0006C4 D3F8 C372D3          10      JP  COPY8
                                
       D3FB                     COPYE:
0006C7 D3FB 1114F0          10      LD  DE,FDRV
0006CA D3FE 0E13             7      LD  C,013H      ;(BDOS)ファイルの削除
0006CC D400 CD0500          17      CALL    SYSTEM
       D403                     COPYE2:
0006CF D403 37               4      SCF
0006D0 D404 C9              10      RET
                                
       D405                     CWILD:
0006D1 D405 215D00          10      LD  HL,FCB1FN
       D408                     CWILD1:
0006D4 D408 7E               7      LD  A,(HL)
0006D5 D409 FE20             7      CP  020H
0006D7 D40B C0              11      RET NZ
       D40C                     CWILD2:
0006D8 D40C 3E3F             7      LD  A,'?'
0006DA D40E 060B             7      LD  B,11
0006DC D410 C3ECDB          10      JP  FILL_MEMORY
                                
       D413                     COMTB:
0006DF D413 44202020                DB  "D   "  ;1
0006E3 D417 C4D1                    DW  C_DIR
0006E5 D419 44495220                DB  "DIR "  ;2
0006E9 D41D C4D1                    DW  C_DIR
0006EB D41F 434F5059                DB  "COPY"  ;3
0006EF D423 2DD3                    DW  C_COPY
0006F1 D425 43442020                DB  "CD  "  ;4
0006F5 D429 E1D0                    DW  C_CD
0006F7 D42B 44454C20                DB  "DEL "  ;5
0006FB D42F A7D1                    DW  C_DEL
0006FD D431 50415448                DB  "PATH"  ;6
000701 D435 5BD2                    DW  C_PATH
000703 D437 52454E20                DB  "REN "  ;7
000707 D43B B1D1                    DW  C_REN
000709 D43D 52454D20                DB  "REM "  ;8
00070D D441 77D4                    DW  C_REM
[EOF:LDCCP.ASM:SHIFT_JIS]
                                    INCLUDE "M7CCP2.ASM"
                                
                                ;   LSX-Dodgers CCP2
                                ;   MZ-700/1500
                                
00070F D443 4D4F4E20                DB  "MON "  ;10
000713 D447 D8CF                    DW  C_MON
[EOF:M7CCP2.ASM:UTF_8]
                                    INCLUDE "LDOS.ASM"
                                
                                ;   LSX-Dodgers OS
                                
       D449                     BDOS0:
000715 D449 E5              11      PUSH    HL
000716 D44A 79               4      LD  A,C
000717 D44B FE3C             7      CP  03CH
000719 D44D 3802            12      JR  C,DOS1
00071B D44F 3E3C             7      LD  A,03CH
       D451                     DOS1:
00071D D451 87               4      ADD A,A
00071E D452 3256D4          13      LD  (DOS1_SWC),A
000721 D455 2A00F1          16      LD  HL,(STABLE)
       D456                     DOS1_SWC    EQU $-2
000724 D458 E3              19      EX  (SP),HL
000725 D459 79               4      LD  A,C
                                ;確認用
                                ;   LD  (0050H),A
000726 D45A C9              10      RET
       D45B                     _DOS2:
000727 D45B FE5A             7      CP  05AH        ;(BDOS)カレントディレクトリの変更(_CHDIR)
000729 D45D CAF6D6          10      JP  Z,_SYS5A
00072C D460 FE5C             7      CP  05CH        ;(BDOS)ファイル名の解析(_PFILE)
00072E D462 CAB3D6          10      JP  Z,_SYS5C
000731 D465 FE5F             7      CP  05FH        ;(BDOS)ディスクバッファのフラッシュ(_FLUSH)
000733 D467 CA84E8          10      JP  Z,_SYS5F
000736 D46A FE6F             7      CP  06FH        ;(BDOS)MSX-DOS のバージョン番号の獲得(_DOSVER)
000738 D46C 200A            12      JR  NZ,_ERROR
00073A D46E 011D01          10      LD  BC,VER_6F
00073D D471 116101          10      LD  DE,VER
000740 D474 210100          10      LD  HL,MACD
       D477                     C_REM:
000743 D477 AF               4      XOR A
       D478                     _ERROR:
000744 D478 A7               4      AND A
000745 D479 C9              10      RET
                                
       D47A                     _SYS09:     ;文字列出力
000746 D47A D5              11      PUSH    DE
       D47B                     _SX09:
000747 D47B 1A               7      LD  A,(DE)
000748 D47C 13               6      INC DE
000749 D47D FE24             7      CP  '$'
00074B D47F 2831            12      JR  Z,SX0E2
00074D D481 CD14D7          17      CALL    MSG_A
000750 D484 18F5            12      JR  _SX09
                                
       D486                     MSX1:
000752 D486 CD14D7          17      CALL    MSG_A
       D489                     MSX:
000755 D489 7E               7      LD  A,(HL)
000756 D48A 23               6      INC HL
000757 D48B B7               4      OR  A
000758 D48C 20F8            12      JR  NZ,MSX1
00075A D48E C9              10      RET
                                
       D48F                     _SYS0C:     ;(BDOS)バージョン番号の獲得
00075B D48F 212200          10      LD  HL,00022H
00075E D492 7D               4      LD  A,L
00075F D493 C9              10      RET
                                
       D494                     _SYS0D:     ;(BDOS)ディスクリセット
000760 D494 CDDFF0          17      CALL    _FFLUSH
000763 D497 E5              11      PUSH    HL
000764 D498 218000          10      LD  HL,00080H
000767 D49B 228AF0          16      LD  (_DTA),HL
00076A D49E E1              10      POP HL
00076B D49F D5              11      PUSH    DE
00076C D4A0 1E00             7      LD  E,0
00076E D4A2 3E                      DB  03EH    ;次の PUSH DE をスキップ
                                
       D4A3                     _SYS0E:     ;(BDOS)カレントドライブの設定
00076F D4A3 D5              11      PUSH    DE
000770 D4A4 7B               4      LD  A,E
000771 D4A5 DDE5            15      PUSH    IX
000773 D4A7 CDDCF0          17      CALL    _GETDPB
000776 D4AA DDE1            14      POP IX
000778 D4AC 3804            12      JR  C,SX0E2
00077A D4AE 7B               4      LD  A,E
00077B D4AF 320400          13      LD  (_DVSW),A
       D4B2                     SX0E2:
00077E D4B2 D1              10      POP DE
00077F D4B3 C9              10      RET
                                
       D4B4                     _SYS0F:     ;(BDOS)ファイルのオープン
000780 D4B4 CD29DC          17      CALL    SETDRV
000783 D4B7 FD7E1C          19      LD  A,(IY+28)   ;(FCB)オープンモード
000786 D4BA C602             7      ADD A,002H      ;Write
000788 D4BC 2848            12      JR  Z,FEND0F
00078A D4BE CD77DF          17      CALL    CHKWILDX
                                
00078D D4C1 D453DC          17      CALL    NC,SOPENX
       D4C4                     _S16XX:
000790 D4C4 3840            12      JR  C,FEND0F
                                                ;Directory location
000792 D4C6 3A9FF0          13      LD  A,(_FILEN)
000795 D4C9 FD7719          19      LD  (IY+25),A   ;(FCB)ディレクトリロケーション
                                ;               _DIRF
000798 D4CC 3AA0F0          13      LD  A,(_DIRF)
00079B D4CF FD771D          19      LD  (IY+29),A   ;(FCB)ディレクトリモード
                                ;               _FBPS
00079E D4D2 FD731E          19      LD  (IY+30),E   ;(FCB)ディレクトリポジション
0007A1 D4D5 FD721F          19      LD  (IY+31),D
                                ;               Open(Read)
0007A4 D4D8 FD361CFF        19      LD  (IY+28),0FFH    ;(FCB)オープンモード
                                ;               FILENAME
0007A8 D4DC FDE5            15      PUSH    IY
0007AA D4DE D1              10      POP DE
0007AB D4DF 13               6      INC DE
0007AC D4E0 010B00          10      LD  BC,11
0007AF D4E3 EDB0                    LDIR
                                ;               Attribute
0007B1 D4E5 7E               7      LD  A,(HL)
0007B2 D4E6 FD770D          19      LD  (IY+13),A   ;(FCB)属性(アトリビュート)
0007B5 D4E9 110B00          10      LD  DE,11       ;Reserved
0007B8 D4EC 19              11      ADD HL,DE
                                                    ;(FCB)ファイルを最後に変更した時刻
0007B9 D4ED 11E4F1          10      LD  DE,SDDATA       ;(FCB)ファイルを最後に変更した日付
0007BC D4F0 060A             7      LD  B,SDDATAE-SDDATA    ;(FCB)ファイルの先頭クラスタ
       D4F2                     S16LOOP:                ;(FCB)ファイルのサイズ(バイト単位)
0007BE D4F2 1A               7      LD  A,(DE)
0007BF D4F3 13               6      INC DE
0007C0 D4F4 32FBD4          13      LD  (S16PAT),A
0007C3 D4F7 7E               7      LD  A,(HL)
0007C4 D4F8 23               6      INC HL
0007C5 D4F9 FD7700          19      LD  (IY+0),A
       D4FB                     S16PAT  EQU $-1
0007C8 D4FC 10F4            13      DJNZ    S16LOOP
                                
0007CA D4FE AF               4      XOR A
0007CB D4FF FD770C          19      LD  (IY+12),A   ;(FCB)カレントブロック
0007CE D502 FD22A3D5        20      LD  (OFCB_SWC),IY
       D506                     FEND0F:
0007D2 D506 1845            12      JR  FEND10
                                
       D508                     _SYS10:     ;(BDOS)ファイルのクローズ
0007D4 D508 CD29DC          17      CALL    SETDRV
0007D7 D50B FD7E1C          19      LD  A,(IY+28)   ;(FCB)オープンモード
0007DA D50E D6FE             7      SUB 0FEH
0007DC D510 37               4      SCF
0007DD D511 3F               4      CCF
0007DE D512 2039            12      JR  NZ,FEND10
       D514                     _S10A:              ;Write
0007E0 D514 FD770E          19      LD  (IY+14),A   ;(FCB)レコードサイズ/アクセスするディレクトリのクラスタ番号+1
0007E3 D517 FD770F          19      LD  (IY+15),A
                                
0007E6 D51A FD341C          23      INC (IY+28)     ;(FCB)オープンモード 0FEH->0FFH
0007E9 D51D CD73E0          17      CALL    SETTMS
                                
0007EC D520 FD7E1D          19      LD  A,(IY+29)   ;(FCB)ディレクトリモード
0007EF D523 32A0F0          13      LD  (_DIRF),A
0007F2 D526 E67F             7      AND 07FH
0007F4 D528 32A5E5          13      LD  (_SECPS),A
0007F7 D52B FD5E1E          19      LD  E,(IY+30)   ;(FCB)ディレクトリポジション
0007FA D52E FD561F          19      LD  D,(IY+31)
0007FD D531 CD88DD          17      CALL    READ_DIR
000800 D534 3817            12      JR  C,FEND10
                                
000802 D536 3AB3DC          13  SDECM1: LD  A,(SDECPAT) ;1セクタ辺りのディレクトリエントリ数
000805 D539 3D               4      DEC A       ;1024=01FH / 512=00FH / 256=7
000806 D53A FDA619          19      AND (IY+25)     ;(FCB)ディレクトリロケーション
000809 D53D 6F               4      LD  L,A
00080A D53E 2600             7      LD  H,0
00080C D540 29              11      ADD HL,HL       ;*2
00080D D541 29              11      ADD HL,HL       ;*4
00080E D542 29              11      ADD HL,HL       ;*8
00080F D543 29              11      ADD HL,HL       ;*16
000810 D544 29              11      ADD HL,HL       ;*32
000811 D545 ED4B7EF1        20      LD  BC,(_DTBUF)
000815 D549 09              11      ADD HL,BC
                                
000816 D54A CD87DF          17      CALL    SDIRENT
       D54D                     FEND10:
000819 D54D 1842            12      JR  FEND
                                
       D54F                     _SYS11:     ;(BDOS)最初のファイルの検索
00081B D54F CD29DC          17      CALL    SETDRV
00081E D552 CD82DC          17      CALL    SOPEN
       D555                     _S12X1:
000821 D555 383A            12      JR  C,FEND
000823 D557 CD21DD          17      CALL    SOPENE2
000826 D55A ED5B8AF0        20      LD  DE,(_DTA)
00082A D55E 3A88F0          13      LD  A,(_DRV)
00082D D561 3C               4      INC A
00082E D562 12               7      LD  (DE),A
00082F D563 D5              11      PUSH    DE
000830 D564 13               6      INC DE
000831 D565 012000          10      LD  BC,32
000834 D568 EDB0                    LDIR
000836 D56A FD6E0E          19      LD  L,(IY+14)   ;(FCB)レコードサイズ/アクセスするディレクトリのクラスタ番号+1
000839 D56D FD660F          19      LD  H,(IY+15)
00083C D570 22F4F1          16      LD  (SCDIR),HL
00083F D573 2A9AF0          16      LD  HL,(_FBPS)
000842 D576 22F6F1          16      LD  (SFBPS),HL
000845 D579 2A9FF0          16      LD  HL,(_FILEN)
000848 D57C 7C               4      LD  A,H
000849 D57D B7               4      OR  A
00084A D57E 2806            12      JR  Z,_S12DIR
00084C D580 3AA5E5          13      LD  A,(_SECPS)
00084F D583 F680             7      OR  080H
000851 D585 67               4      LD  H,A
       D586                     _S12DIR:
000852 D586 22F8F1          16      LD  (SFNDF),HL  ;Directory position and Flags
000855 D589 E1              10      POP HL
000856 D58A 1139F0          10      LD  DE,SFILE
000859 D58D 0E21             7      LD  C,33
       D58F                     _S11B:
00085B D58F EDB0                    LDIR
       D591                     FEND:
00085D D591 9F               4      SBC A,A     ;CF=0 A=0 : CF=1 A=0FFH
       D592                     FENDE:
00085E D592 FDE1            14      POP IY
000860 D594 C1              10      POP BC
000861 D595 D1              10      POP DE
000862 D596 E1              10      POP HL
000863 D597 C9              10      RET
                                
       D598                     _SYS12:     ;(BDOS)次のファイルの検索
000864 D598 E5              11      PUSH    HL
000865 D599 D5              11      PUSH    DE
000866 D59A C5              11      PUSH    BC
000867 D59B FDE5            15      PUSH    IY
000869 D59D CDE6DC          17      CALL    NOPEN
00086C D5A0 18B3            12      JR  _S12X1
                                
       D5A2                     _S16K:
00086E D5A2 110000          10      LD  DE,0
       D5A3                     OFCB_SWC    EQU $-2
000871 D5A5 D5              11      PUSH    DE
000872 D5A6 061A             7      LD  B,26        ;First cluster
       D5A8                     S16K1:
000874 D5A8 13               6      INC DE
000875 D5A9 23               6      INC HL
000876 D5AA 10FC            13      DJNZ    S16K1
                                
000878 D5AC 1A               7      LD  A,(DE)
000879 D5AD BE               7      CP  (HL)
00087A D5AE 2015            12      JR  NZ,S16K2
00087C D5B0 13               6      INC DE
00087D D5B1 23               6      INC HL
00087E D5B2 1A               7      LD  A,(DE)
00087F D5B3 BE               7      CP  (HL)
000880 D5B4 200F            12      JR  NZ,S16K2
                                
000882 D5B6 E1              10      POP HL
000883 D5B7 FDE5            15      PUSH    IY
000885 D5B9 D1              10      POP DE
000886 D5BA 7E               7      LD  A,(HL)
000887 D5BB CD3EDC          17      CALL    IS_SAME_DRV_A_DE
00088A D5BE 2006            12      JR  NZ,S16K3
                                                ;ここはCFが必ず0
00088C D5C0 ED52            15      SBC HL,DE       ;CP HL,DE
00088E D5C2 37               4      SCF
00088F D5C3 C0              11      RET NZ
000890 D5C4 E5              11      PUSH    HL
       D5C5                     S16K2:
000891 D5C5 E1              10      POP HL
       D5C6                     S16K3:
000892 D5C6 FDE5            15      PUSH    IY
000894 D5C8 D1              10      POP DE
       D5C9                     _SYS13:     ;(BDOS)ファイルの削除
000895 D5C9 CD29DC          17      CALL    SETDRV
000898 D5CC CDADDE          17      CALL    KILL
       D5CF                     FEND13:
00089B D5CF 18C0            12      JR  FEND
                                
       D5D1                     _SYS14:     ;(BDOS)シーケンシャルな読み出し
00089D D5D1 CD29DC          17      CALL    SETDRV
0008A0 D5D4 CDD5E0          17      CALL    INIT_SEQ
       D5D7                     SREAD:
0008A3 D5D7 CD03E1          17      CALL    RB_READ
                                
0008A6 D5DA C601             7      ADD A,001H
0008A8 D5DC 38B3            12      JR  C,FEND
                                
0008AA D5DE 7D               4      LD  A,L
0008AB D5DF D601             7      SUB 001H
       D5E1                     FENDX:
0008AD D5E1 9F               4      SBC A,A
0008AE D5E2 E603             7      AND 3
0008B0 D5E4 1F               4      RRA
0008B1 D5E5 18AB            12      JR  FENDE
                                
       D5E7                     _SYS15:     ;(BDOS)シーケンシャルな書き込み
0008B3 D5E7 CD29DC          17      CALL    SETDRV
0008B6 D5EA CDD5E0          17      CALL    INIT_SEQ
       D5ED                     SWRITE:
0008B9 D5ED CDFCE0          17      CALL    RB_WRITE
                                
0008BC D5F0 C6FF             7      ADD A,0FFH
0008BE D5F2 18ED            12      JR  FENDX
                                
       D5F4                     _SYS17:     ;(BDOS)ファイル名の変更
0008C0 D5F4 CD29DC          17      CALL    SETDRV
0008C3 D5F7 CD03DF          17      CALL    NAME
0008C6 D5FA 18D3            12      JR  FEND13
                                
       D5FC                     _SYS16:     ;(BDOS)ファイルの作成
0008C8 D5FC CD29DC          17      CALL    SETDRV
                                
0008CB D5FF CD77DF          17      CALL    CHKWILDX
0008CE D602 38CB            12      JR  C,FEND13
0008D0 D604 FD7E01          19      LD  A,(IY+1)    ;(FCB)主ファイル名
0008D3 D607 FE05             7      CP  5
0008D5 D609 2805            12      JR  Z,_S16X2
0008D7 D60B FE21             7      CP  021H
0008D9 D60D DACFD5          10      JP  C,FEND13
       D610                     _S16X2:
                                ;               Clear FCB
0008DC D610 FDE5            15      PUSH    IY
0008DE D612 E1              10      POP HL
0008DF D613 011000          10      LD  BC,16
0008E2 D616 09              11      ADD HL,BC
       D617                     _S16X1:
0008E3 D617 70               7      LD  (HL),B      ;B=0
0008E4 D618 23               6      INC HL
0008E5 D619 0D               4      DEC C
0008E6 D61A 20FB            12      JR  NZ,_S16X1
                                
0008E8 D61C CD78E0          17      CALL    SETTMSX
0008EB D61F FD360DFF        19      LD  (IY+13),0FFH    ;(FCB)Attribute
0008EF D623 CD53DC          17      CALL    SOPENX
0008F2 D626 3F               4      CCF
0008F3 D627 CCA2D5          17      CALL    Z,_S16K
0008F6 D62A D432DD          17      CALL    NC,COPEN
0008F9 D62D D487DF          17      CALL    NC,SDIRENT
0008FC D630 C3C4D4          10      JP  _S16XX
                                
       D633                     _SYS21:     ;(BDOS)ランダムな読み出し
0008FF D633 CD29DC          17      CALL    SETDRV
000902 D636 CDC3E0          17      CALL    INIT_RND
000905 D639 189C            12      JR  SREAD
                                
       D63B                     _SYS22:     ;(BDOS)ランダムな書き込み
       D63B                     _SYS28:     ;(BDOS)ランダムな書き込み・その2
000907 D63B CD29DC          17      CALL    SETDRV
00090A D63E CDC3E0          17      CALL    INIT_RND
00090D D641 18AA            12      JR  SWRITE
                                
       D643                     _SYS18:     ;(BDOS)ログインベクトルの獲得
00090F D643 21FF00          10      LD  HL,000FFH
000912 D646 AF               4      XOR A
000913 D647 C9              10      RET
                                
       D648                     _SYS19:     ;(BDOS)カレントドライブ番号の獲得
000914 D648 3A0400          13      LD  A,(_DVSW)
000917 D64B A7               4      AND A
000918 D64C C9              10      RET
                                
       D64D                     _SYS1A:     ;(BDOS)DTAの設定
000919 D64D ED538AF0        20      LD  (_DTA),DE
00091D D651 AF               4      XOR A
00091E D652 C9              10      RET
                                
       D653                     _SYS1B:     ;(BDOS)ディスク情報の獲得
00091F D653 7B               4      LD  A,E
000920 D654 CD37DC          17      CALL    GETDRV
000923 D657 CDDCF0          17      CALL    _GETDPB
000926 D65A D4E2F0          17      CALL    NC,_RDFATX
000929 D65D 210000          10      LD  HL,0
00092C D660 D451E0          17      CALL    NC,DSKF
                                
00092F D663 ED5B52E0        20      LD  DE,(MAXCLP) ;DPB_MAXCL-1
000933 D667 1B               6      DEC DE      ;DE←クラスタの総数
000934 D668 FD2A7CF1        20      LD  IY,(_FATBF) ;IY←メモリ上のFATの先頭アドレス
000938 D66C 9F               4      SBC A,A
000939 D66D D8              11      RET C
00093A D66E 4F               4      LD  C,A     ;C=0
00093B D66F DD7E0F          19      LD  A,(IX+DPB_BPS)
00093E D672 E607             7      AND 7
000940 D674 47               4      LD  B,A
000941 D675 DD7E07          19      LD  A,(IX+DPB_SECPCL)
000944 D678 C9              10      RET
                                
       D679                     _SYS1D:     ;(BDOS)書き込みが禁止されているディスクの調査
000945 D679 AF               4      XOR A
000946 D67A 67               4      LD  H,A
000947 D67B 6F               4      LD  L,A
000948 D67C C9              10      RET
                                
       D67D                     _SYS1F:     ;(BDOS)ディスク装置のパラメータの読み出し
000949 D67D 2100F2          10      LD  HL,_DEVICE
00094C D680 7B               4      LD  A,E
00094D D681 C3DCF0          10      JP  _GETDPB
                                
       D684                     _SYS23:     ;(BDOS)ファイルサイズの獲得
000950 D684 E5              11      PUSH    HL
000951 D685 2A1EF1          16      LD  HL,(STABLE+2*00FH)  ;ファイルのオープン
000954 D688 CD0F00          17      CALL    JP_HL
000957 D68B 381B            12      JR  C,_S23X1
                                
000959 D68D D5              11      PUSH    DE      ;EX DE,IY
00095A D68E FDE3            23      EX  (SP),IY     ;
                                ;   POP DE      ;
                                ;   PUSH    DE      ;DEを破壊しないように注意vv
00095C D690 FD7E10          19      LD  A,(IY+16)   ;(FCB)ファイルのサイズ(バイト単位)
00095F D693 FD6E11          19      LD  L,(IY+17)   ;
000962 D696 FD6612          19      LD  H,(IY+18)   ;
000965 D699 C5              11      PUSH    BC      ;
000966 D69A FD4613          19      LD  B,(IY+19)   ;
000969 D69D CDB5E0          17      CALL    GET_CPM_R_SIZE
00096C D6A0 C1              10      POP BC
       D6A1                     _S24X1:
00096D D6A1 CDEDE3          17      CALL    SET_RR_AHL
                                ;   POP DE      ;^^^^^^^^^^^^^^^^^^^^^^^^
                                ;   PUSH    DE      ;EX DE,IY
000970 D6A4 FDE3            23      EX  (SP),IY     ;
000972 D6A6 D1              10      POP DE      ;
                                
000973 D6A7 AF               4      XOR A
       D6A8                     _S23X1:
000974 D6A8 E1              10      POP HL
000975 D6A9 C9              10      RET
                                
       D6AA                     _SYS24:     ;(BDOS)ランダムレコードフィールドの設定
000976 D6AA E5              11      PUSH    HL
000977 D6AB D5              11      PUSH    DE      ;EX DE,IY
000978 D6AC FDE3            23      EX  (SP),IY     ;
                                ;   POP DE      ;
                                ;   PUSH    DE      ;DEを破壊しないように注意vv
00097A D6AE CDDDE0          17      CALL    GETSEQ
00097D D6B1 18EE            12      JR  _S24X1      ;^^^^^^^^^^^^^^^^^^^^^^^^
                                
       D6B3                     _SYS5C:     ;(BDOS)ファイル名の解析(_PFILE)
00097F D6B3 2B               6      DEC HL
       D6B4                     _SYS29:     ;(BDOS)ファイル名の解析(_PPATH)
000980 D6B4 C5              11      PUSH    BC
000981 D6B5 E5              11      PUSH    HL
000982 D6B6 CD40DB          17      CALL    FILE
000985 D6B9 E1              10      POP HL
000986 D6BA C1              10      POP BC
       D6BB                     S29X1:
000987 D6BB C5              11      PUSH    BC
000988 D6BC D5              11      PUSH    DE
000989 D6BD E5              11      PUSH    HL
00098A D6BE EB               4      EX  DE,HL
00098B D6BF AF               4      XOR A
00098C D6C0 3221F0          13      LD  (FDRV+13),A
00098F D6C3 2114F0          10      LD  HL,FDRV
000992 D6C6 011000          10      LD  BC,16
000995 D6C9 EDB0                    LDIR
000997 D6CB E1              10      POP HL
000998 D6CC D1              10      POP DE
000999 D6CD C1              10      POP BC
00099A D6CE C9              10      RET
                                
       D6CF                     _SYS30:     ;(BDOS)論理セクタを用いた書き込み
00099B D6CF C5              11      PUSH    BC
00099C D6D0 0143E7          10      LD  BC,DWT24B
00099F D6D3 1804            12      JR  S2FX
       D6D5                     _SYS2F:
0009A1 D6D5 C5              11      PUSH    BC
0009A2 D6D6 0133E7          10      LD  BC,DRD24B
       D6D9                     S2FX:
0009A5 D6D9 ED43EFD6        20      LD  (S2F_SWC),BC
0009A9 D6DD CDDFF0          17      CALL    _FFLUSH
                                
0009AC D6E0 D5              11      PUSH    DE
0009AD D6E1 E5              11      PUSH    HL
0009AE D6E2 7D               4      LD  A,L     ;Drive
0009AF D6E3 CDD9F0          17      CALL    _CHGDRV
0009B2 D6E6 3809            12      JR  C,S30X2
0009B4 D6E8 44               4      LD  B,H     ;Number of clusters
0009B5 D6E9 2A8AF0          16      LD  HL,(_DTA)
                                
0009B8 D6EC 0E00             7      LD  C,0
0009BA D6EE CD33E7          17      CALL    DRD24B
       D6EF                     S2F_SWC EQU $-2
       D6F1                     S30X2:
0009BD D6F1 E1              10      POP HL
0009BE D6F2 D1              10      POP DE
0009BF D6F3 C1              10      POP BC
0009C0 D6F4 9F               4      SBC A,A
0009C1 D6F5 C9              10      RET
                                
       D6F6                     _SYS5A:     ;(BDOS)カレントディレクトリの変更
0009C2 D6F6 C5              11      PUSH    BC
0009C3 D6F7 D5              11      PUSH    DE
0009C4 D6F8 E5              11      PUSH    HL
0009C5 D6F9 CD35DB          17      CALL    FILEC
0009C8 D6FC 21F1D6          10      LD  HL,S30X2
0009CB D6FF E5              11      PUSH    HL
0009CC D700 3A21F0          13      LD  A,(FDRV+13) ;(FCB)属性(アトリビュート))
0009CF D703 E610             7      AND 010H        ;ディレクトリ
0009D1 D705 C8              11      RET Z
0009D2 D706 1114F0          10      LD  DE,FDRV
0009D5 D709 2A4EF1          16      LD  HL,(STABLE+2*027H)  ;ランダムブロック読み込み
0009D8 D70C E9               4      JP  (HL)
[EOF:LDOS.ASM:SHIFT_JIS]
                                    INCLUDE "M7IO.ASM"
                                
                                ;   LSX-Dodgers IO
                                ;   MZ-700/1500
                                
       D478                     _SYS04  EQU _ERROR      ;(BDOS)外部出力
       D478                     _SYS05  EQU _ERROR      ;(BDOS)プリンタ出力
       D478                     _SYS1C  EQU _ERROR      ;(BDOS)ディスクの書き込み禁止化
       D478                     _SYS1E  EQU _ERROR      ;(BDOS)ファイル属性の設定
       D478                     _SYS20  EQU _ERROR      ;(BDOS)利用者番号の設定と読み出し
       D478                     _SYS2E  EQU _ERROR      ;(BDOS)ベリファイ・フラグの設定
                                
       0000                     INT EQU 0
       0000                     INTCTCE EQU 0
       0000                     INTCTC2 EQU 0
                                
       D70D                     POP_AF_HL_SCF_RET:
0009D9 D70D F1              10      POP AF
0009DA D70E E1              10      POP HL
0009DB D70F 37               4      SCF
       D710                     KEYBC_IFBREAK:
0009DC D710 C9              10      RET
                                
       D711                     _SYS01:     ;(BDOS)コンソール入力
0009DD D711 CD09F0          17      CALL    _SYS07
       D714                     MSG_A:
0009E0 D714 F5              11      PUSH    AF
0009E1 D715 D5              11      PUSH    DE
0009E2 D716 5F               4      LD  E,A
0009E3 D717 CD1DD7          17      CALL    _SYS02
0009E6 D71A D1              10      POP DE
0009E7 D71B F1              10      POP AF
0009E8 D71C C9              10      RET
                                
       D71D                     _SYS02:     ;(BDOS)コンソール出力
0009E9 D71D CD2FD7          17      CALL    BREAK
0009EC D720 1805            12      JR  PRINTX
                                
       D722                     _SYS06:     ;(BDOS)コンソール直接入出力
0009EE D722 7B               4      LD  A,E
0009EF D723 3C               4      INC A
0009F0 D724 CACAF0          10      JP  Z,_INKEY
       D727                     PRINTX:
0009F3 D727 C3CDF0          10      JP  _PRINT
                                
       D72A                     _SYS08:     ;(BDOS)エコーなしコンソール入力
0009F6 D72A CD09F0          17      CALL    _SYS07
0009F9 D72D 1803            12      JR  BREAK1
       D72F                     BREAK:
0009FB D72F CDC7DA          17      CALL    CHKEY
       D732                     BREAK1:
0009FE D732 FE03             7      CP  3       ;CTRL+C
000A00 D734 CA00F0          10      JP  Z,CPM_BOOT
000A03 D737 FE13             7      CP  013H        ;CTRL+S
000A05 D739 C0              11      RET NZ
                                
       D73A                     PAUSE:
       D73A                     FLGET:
000A06 D73A CDDFF0          17      CALL    _FFLUSH
000A09 D73D E5              11      PUSH    HL
000A0A D73E 2A8EF0          16      LD  HL,(_TXADR)
000A0D D741 7C               4      LD  A,H
000A0E D742 C6D0             7      ADD A,0D0H
000A10 D744 67               4      LD  H,A
000A11 D745 CD25CF          17      CALL    RDMMIO
000A14 D748 325DD7          13      LD  (FLSMC),A
       D74B                     FLGET1:
000A17 D74B CD1BCF          17      CALL    RD556VSYNC
000A1A D74E CB77             8      BIT 6,A
000A1C D750 3EEF             7      LD  A,0EFH      ;カーソル
000A1E D752 200A            12      JR  NZ,FLGET2
000A20 D754 3A92F0          13      LD  A,(_KEYD)
000A23 D757 B7               4      OR  A
000A24 D758 3EEF             7      LD  A,0EFH      ;カーソル
000A26 D75A 2002            12      JR  NZ,FLGET2
000A28 D75C 3E00             7      LD  A,0     ;自己書き換え
       D75D                     FLSMC   EQU $-1
       D75E                     FLGET2:
000A2A D75E CD2DCF          17      CALL    WRMMIO
000A2D D761 CDCAF0          17      CALL    _INKEY
000A30 D764 28E5            12      JR  Z,FLGET1
000A32 D766 F5              11      PUSH    AF
000A33 D767 3A5DD7          13      LD  A,(FLSMC)
000A36 D76A CD2DCF          17      CALL    WRMMIO
000A39 D76D F1              10      POP AF
000A3A D76E E1              10      POP HL
000A3B D76F C9              10      RET
                                
       D770                     _SYS0A:     ;(BDOS)文字列入力
000A3C D770 C5              11      PUSH    BC
000A3D D771 E5              11      PUSH    HL
000A3E D772 D5              11      PUSH    DE
000A3F D773 CD00DA          17      CALL    GETL
000A42 D776 1120FF          10      LD  DE,KBUF
000A45 D779 E1              10      POP HL
000A46 D77A E5              11      PUSH    HL
000A47 D77B 0E00             7      LD  C,0
000A49 D77D 3004            12      JR  NC,SAX0
000A4B D77F 23               6      INC HL
000A4C D780 23               6      INC HL
000A4D D781 1808            12      JR  SAX4
       D783                     SAX0:
000A4F D783 46               7      LD  B,(HL)
000A50 D784 23               6      INC HL
       D785                     SAX1:
000A51 D785 23               6      INC HL
000A52 D786 1A               7      LD  A,(DE)
000A53 D787 13               6      INC DE
000A54 D788 B7               4      OR  A
000A55 D789 2004            12      JR  NZ,SAX2
       D78B                     SAX4:
000A57 D78B 360D            10      LD  (HL),00DH
000A59 D78D 1804            12      JR  SAX3
       D78F                     SAX2:
000A5B D78F 77               7      LD  (HL),A
000A5C D790 0C               4      INC C
000A5D D791 10F2            13      DJNZ    SAX1
       D793                     SAX3:
000A5F D793 D1              10      POP DE
000A60 D794 79               4      LD  A,C
000A61 D795 13               6      INC DE
000A62 D796 12               7      LD  (DE),A
000A63 D797 1B               6      DEC DE
000A64 D798 E1              10      POP HL
000A65 D799 C1              10      POP BC
000A66 D79A A7               4      AND A
000A67 D79B C9              10      RET
                                
       D79C                     _SYS0B:     ;(BDOS)コンソール状態のチェック
000A68 D79C CD2FD7          17      CALL    BREAK
       D79F                     CONSTX:
000A6B D79F AF               4      XOR A
000A6C D7A0 3294DA          13      LD  (SKIP_KEYWAIT),A
000A6F D7A3 CDC7DA          17      CALL    CHKEY
000A72 D7A6 C8              11      RET Z
000A73 D7A7 CDDFF0          17      CALL    _FFLUSH
000A76 D7AA 37               4      SCF
000A77 D7AB 9F               4      SBC A,A
000A78 D7AC C9              10      RET
                                
       D7AD                     _SYS2A:     ;(BDOS)日付の獲得
000A79 D7AD AF               4      XOR A
000A7A D7AE 57               4      LD  D,A
000A7B D7AF 5F               4      LD  E,A
000A7C D7B0 67               4      LD  H,A
000A7D D7B1 6F               4      LD  L,A
000A7E D7B2 C9              10      RET
                                
       D7B3                     _SYS2C:     ;(BDOS)時刻の獲得
000A7F D7B3 AF               4      XOR A
000A80 D7B4 57               4      LD  D,A
000A81 D7B5 5F               4      LD  E,A
000A82 D7B6 67               4      LD  H,A
000A83 D7B7 6F               4      LD  L,A
000A84 D7B8 C9              10      RET
                                
       D7B9                     ESC1:
000A85 D7B9 7B               4      LD  A,E
000A86 D7BA FE41             7      CP  'A'
000A88 D7BC CAB1D8          10      JP  Z,CTRL1E
000A8B D7BF FE42             7      CP  'B'
000A8D D7C1 CAC3D9          10      JP  Z,CTRL1F
000A90 D7C4 FE43             7      CP  'C'
000A92 D7C6 CA84D8          10      JP  Z,CTRL1C
000A95 D7C9 FE44             7      CP  'D'
000A97 D7CB CAA8D8          10      JP  Z,CTRL1D
000A9A D7CE FE45             7      CP  'E'
000A9C D7D0 2802            12      JR  Z,CT0CX
000A9E D7D2 FE6A             7      CP  'j'
       D7D4                     CT0CX:
000AA0 D7D4 CAA8D9          10      JP  Z,CTRL0C
000AA3 D7D7 FE48             7      CP  'H'
000AA5 D7D9 CA25D9          10      JP  Z,CTRL0B
000AA8 D7DC FE4A             7      CP  'J'
000AAA D7DE CAABD9          10      JP  Z,CTRL06
000AAD D7E1 FE4B             7      CP  'K'
000AAF D7E3 CAF7D8          10      JP  Z,CTRL05
000AB2 D7E6 FE4C             7      CP  'L'
000AB4 D7E8 CAD5D9          10      JP  Z,CTRL0E
000AB7 D7EB FE54             7      CP  'T'
000AB9 D7ED CAF7D8          10      JP  Z,CTRL05
000ABC D7F0 FE78             7      CP  'x'
000ABE D7F2 2804            12      JR  Z,ESC1X
000AC0 D7F4 FE79             7      CP  'y'
000AC2 D7F6 2002            12      JR  NZ,ESC1Y
       D7F8                     ESC1X:
000AC4 D7F8 3601            10      LD  (HL),1
       D7FA                     ESC1Y:
000AC6 D7FA FE3D             7      CP  '='
000AC8 D7FC 2804            12      JR  Z,ESC1W
000ACA D7FE FE59             7      CP  'Y'
000ACC D800 2002            12      JR  NZ,ESC1Z
       D802                     ESC1W:
000ACE D802 3602            10      LD  (HL),2
       D804                     ESC1Z:
000AD0 D804 FE20             7      CP  020H
000AD2 D806 3802            12      JR  C,ESC1C
000AD4 D808 87               4      ADD A,A
000AD5 D809 D0              11      RET NC
       D80A                     ESC1C:
000AD6 D80A E1              10      POP HL
000AD7 D80B 1832            12      JR  ANK
                                
       D80D                     ESC:
000AD9 D80D 2170D8          10      LD  HL,PRINTE5
000ADC D810 E5              11      PUSH    HL
000ADD D811 2133D8          10      LD  HL,ESCFLG
000AE0 D814 3600            10      LD  (HL),0
000AE2 D816 3D               4      DEC A
000AE3 D817 28A0            12      JR  Z,ESC1
000AE5 D819 3D               4      DEC A
000AE6 D81A 2009            12      JR  NZ,ESC2
000AE8 D81C 3603            10      LD  (HL),3
000AEA D81E 7B               4      LD  A,E
000AEB D81F D620             7      SUB 020H
000AED D821 3228D8          13      LD  (ESCYP+1),A
000AF0 D824 C9              10      RET
       D825                     ESC2:
000AF1 D825 3D               4      DEC A
000AF2 D826 C0              11      RET NZ
000AF3 D827 2600             7  ESCYP:  LD  H,0
000AF5 D829 7B               4      LD  A,E
000AF6 D82A D620             7      SUB 020H
000AF8 D82C 6F               4      LD  L,A
000AF9 D82D C3D6F0          10      JP  _LOC
                                
       D830                     PRINT:
000AFC D830 C5              11      PUSH    BC
000AFD D831 E5              11      PUSH    HL
000AFE D832 3E00             7      LD  A,000H      ;自己書き換え
       D833                     ESCFLG  EQU $-1
000B00 D834 B7               4      OR  A
000B01 D835 20D6            12      JR  NZ,ESC
                                
000B03 D837 3E1F             7      LD  A,01FH
000B05 D839 BB               4      CP  E
000B06 D83A 3038            12      JR  NC,CTRL
       D83C                     INSFLG  EQU $
000B08 D83C 017DD9          10      LD  BC,INSERT   ;自己書き換え
       D83F                     ANK:
000B0B D83F 3A96F0          13      LD  A,(_COLORF)
000B0E D842 4F               4      LD  C,A
000B0F D843 7B               4      LD  A,E
000B10 D844 FE61             7      CP  'a'     ;英小文字
000B12 D846 3806            12      JR  C,PRT1
000B14 D848 FE7B             7      CP  'z'+1
000B16 D84A 3002            12      JR  NC,PRT1
000B18 D84C CBF9             8      SET 7,C
       D84E                     PRT1:
000B1A D84E FE86             7      CP  $86     ;ひらがな1(を－そ)
000B1C D850 3806            12      JR  C,PRT2
000B1E D852 FEA0             7      CP  $A0
000B20 D854 3002            12      JR  NC,PRT2
000B22 D856 CBF9             8      SET 7,C
       D858                     PRT2:
000B24 D858 FEE0             7      CP  $E0     ;ひらがな2(たーん)
000B26 D85A 3802            12      JR  C,PRT3
000B28 D85C CBF9             8      SET 7,C
       D85E                     PRT3:
000B2A D85E 2A8EF0          16      LD  HL,(_TXADR)
000B2D D861 7C               4      LD  A,H
000B2E D862 C6D0             7      ADD A,0D0H
000B30 D864 67               4      LD  H,A
000B31 D865 42               4      LD  B,D
000B32 D866 16EE             7      LD  D,CD_TABLE/256
000B34 D868 1A               7      LD  A,(DE)
000B35 D869 50               4      LD  D,B
000B36 D86A CD45CF          17      CALL    IO_PRINT
000B39 D86D CD84D8          17      CALL    CTRL1C
       D870                     PRINTE5:
000B3C D870 E1              10      POP HL
000B3D D871 C1              10      POP BC
000B3E D872 AF               4      XOR A
000B3F D873 C9              10      RET
                                
       D874                     CTRL:
000B40 D874 7B               4      LD  A,E
000B41 D875 87               4      ADD A,A
000B42 D876 F680             7      OR  080H
000B44 D878 6F               4      LD  L,A
000B45 D879 26F1             7      LD  H,CTRLTB/256
000B47 D87B 7E               7      LD  A,(HL)
000B48 D87C 2C               4      INC L
000B49 D87D 66               7      LD  H,(HL)
000B4A D87E 6F               4      LD  L,A
000B4B D87F CD0F00          17      CALL    JP_HL
000B4E D882 18EC            12      JR  PRINTE5
                                
       D884                     CTRL1C:
000B50 D884 ED4B8EF0        20      LD  BC,(_TXADR)
000B54 D888 03               6      INC BC
       D889                     PRINTE3:
000B55 D889 2118FC          10      LD  HL,0-WIDTH*LINE
000B58 D88C A7               4      AND A
000B59 D88D ED4A            15      ADC HL,BC
       D88F                     PRINTE8:
000B5B D88F 2805            12      JR  Z,PRINT2
000B5D D891 ED438EF0        20      LD  (_TXADR),BC
       D895                     CTRL00:
000B61 D895 C9              10      RET
                                
       D896                     PRINT2:
000B62 D896 CDDBD9          17      CALL    SCR
000B65 D899 21D8FF          10      LD  HL,0-WIDTH
000B68 D89C 09              11      ADD HL,BC
       D89D                     SET_TXADR_HL:
000B69 D89D 228EF0          16      LD  (_TXADR),HL
000B6C D8A0 C9              10      RET
                                
       D8A1                     CTRL08:
000B6D D8A1 3A3CD8          13      LD  A,(INSFLG)
000B70 D8A4 FECD             7      CP  0CDH        ;CALL ????
000B72 D8A6 2823            12      JR  Z,CTRL02
       D8A8                     CTRL1D:
000B74 D8A8 2A8EF0          16      LD  HL,(_TXADR)
000B77 D8AB 7C               4      LD  A,H
000B78 D8AC B5               4      OR  L
000B79 D8AD C8              11      RET Z
000B7A D8AE 2B               6      DEC HL
000B7B D8AF 18EC            12      JR  SET_TXADR_HL
                                
       D8B1                     CTRL1E:
000B7D D8B1 ED4B8EF0        20      LD  BC,(_TXADR)
000B81 D8B5 21D8FF          10      LD  HL,0-WIDTH
000B84 D8B8 09              11      ADD HL,BC
000B85 D8B9 D0              11      RET NC
000B86 D8BA 18E1            12      JR  SET_TXADR_HL
                                
       D8BC                     CTRL09:
000B88 D8BC ED4B8EF0        20      LD  BC,(_TXADR)
000B8C D8C0 79               4      LD  A,C
000B8D D8C1 E6F8             7      AND 0F8H
000B8F D8C3 C608             7      ADD A,8
000B91 D8C5 4F               4      LD  C,A
000B92 D8C6 88               4      ADC A,B
000B93 D8C7 91               4      SUB C
000B94 D8C8 47               4      LD  B,A
000B95 D8C9 18BE            12      JR  PRINTE3
                                
       D8CB                     CTRL02:
000B97 D8CB CDA8D8          17      CALL    CTRL1D
000B9A D8CE C8              11      RET Z
000B9B D8CF D5              11      PUSH    DE
000B9C D8D0 CDD3F0          17      CALL    _POS
000B9F D8D3 54               4      LD  D,H
000BA0 D8D4 3E28             7      LD  A,WIDTH
000BA2 D8D6 95               4      SUB L
000BA3 D8D7 4F               4      LD  C,A
000BA4 D8D8 0D               4      DEC C
000BA5 D8D9 06D0             7      LD  B,0D0H
000BA7 D8DB 2A8EF0          16      LD  HL,(_TXADR)
000BAA D8DE 09              11      ADD HL,BC
000BAB D8DF 47               4      LD  B,A
                                
000BAC D8E0 3A99D9          13      LD  A,(MULINE)
000BAF D8E3 BA               4      CP  D
000BB0 D8E4 2007            12      JR  NZ,C02X1
000BB2 D8E6 112800          10      LD  DE,WIDTH
000BB5 D8E9 19              11      ADD HL,DE
000BB6 D8EA 78               4      LD  A,B
000BB7 D8EB 83               4      ADD A,E
000BB8 D8EC 47               4      LD  B,A
       D8ED                     C02X1:
000BB9 D8ED 3A96F0          13      LD  A,(_COLORF) ;C:Color
000BBC D8F0 4F               4      LD  C,A
000BBD D8F1 AF               4      XOR A       ;A:Text
000BBE D8F2 CD8CCF          17      CALL    IO_BS
000BC1 D8F5 D1              10      POP DE
000BC2 D8F6 C9              10      RET
                                
       D8F7                     CTRL05:
000BC3 D8F7 CDD3F0          17      CALL    _POS
000BC6 D8FA 3E28             7      LD  A,WIDTH
000BC8 D8FC 95               4      SUB L
000BC9 D8FD 47               4      LD  B,A
       D8FE                     C08X1:
000BCA D8FE 2A8EF0          16      LD  HL,(_TXADR)
000BCD D901 7C               4      LD  A,H
000BCE D902 C6D0             7      ADD A,0D0H
000BD0 D904 67               4      LD  H,A
       D905                     CLLINE:
000BD1 D905 3A96F0          13      LD  A,(_COLORF)
000BD4 D908 4F               4      LD  C,A
000BD5 D909 AF               4      XOR A
000BD6 D90A C36FCF          10      JP  IO_CLLINE
                                
       D90D                     CTRL0D:
000BD9 D90D CDD3F0          17      CALL    _POS
000BDC D910 2E00             7      LD  L,0
       D912                     LOC:
000BDE D912 C5              11      PUSH    BC
000BDF D913 E5              11      PUSH    HL
000BE0 D914 CD32D9          17      CALL    LOC1
000BE3 D917 228EF0          16      LD  (_TXADR),HL
000BE6 D91A E1              10      POP HL
000BE7 D91B C1              10      POP BC
000BE8 D91C C9              10      RET
                                
       D91D                     CTRL12:
000BE9 D91D 213CD8          10      LD  HL,INSFLG
000BEC D920 7E               7      LD  A,(HL)
000BED D921 EECC             7      XOR 0CCH        ;CD:CALL ???? 1:LD BC,????
000BEF D923 77               7      LD  (HL),A
000BF0 D924 C9              10      RET
                                
       D925                     CTRL0B:
000BF1 D925 210000          10      LD  HL,0
000BF4 D928 228EF0          16      LD  (_TXADR),HL
000BF7 D92B C9              10      RET
                                
       D92C                     CTRL1B:
000BF8 D92C 3E01             7      LD  A,1
000BFA D92E 3233D8          13      LD  (ESCFLG),A
000BFD D931 C9              10      RET
                                
       D932                     LOC1:
000BFE D932 D5              11      PUSH    DE
000BFF D933 4D               4      LD  C,L
000C00 D934 0608             7      LD  B,8
000C02 D936 5C               4      LD  E,H
000C03 D937 210028          10      LD  HL,WIDTH*256
000C06 D93A 55               4      LD  D,L ;L=0
       D93B                     LOC2:
000C07 D93B 29              11      ADD HL,HL
000C08 D93C 3001            12      JR  NC,LOC3
000C0A D93E 19              11      ADD HL,DE
       D93F                     LOC3:
000C0B D93F 10FA            13      DJNZ    LOC2
000C0D D941 09              11      ADD HL,BC
000C0E D942 D1              10      POP DE
000C0F D943 C9              10      RET
                                
       D944                     CONOUT1:
                                ;   CALL    CURSOR
000C10 D944 59               4      LD  E,C
000C11 D945 CDCDF0          17      CALL    _PRINT
000C14 D948 7B               4      LD  A,E
000C15 D949 FE0A             7      CP  00AH
000C17 D94B 2006            12      JR  NZ,CURSOR
000C19 D94D CD0DD9          17      CALL    CTRL0D
000C1C D950 CDF7D8          17      CALL    CTRL05
       D953                     CURSOR:
000C1F D953 C9              10      RET
                                
       D954                     CTRL07:
000C20 D954 06E0             7      LD  B,0E0H
000C22 D956 2162F0          10      LD  HL,BEEPD+1
       D959                     C07X0:
000C25 D959 4E               7      LD  C,(HL)
000C26 D95A 23               6      INC HL
000C27 D95B 7E               7      LD  A,(HL)
000C28 D95C 23               6      INC HL
000C29 D95D CD3DCF          17      CALL    WRMMIO_BC
000C2C D960 7D               4      LD  A,L
000C2D D961 FE6A             7      CP  (BEEPD+1+M7BEEPE-M7BEEPD)&255
000C2F D963 20F4            12      JR  NZ,C07X0
000C31 D965 0610             7      LD  B,16
       D967                     C07X1:
000C33 D967 CD1BCF          17      CALL    RD556VSYNC
000C36 D96A 87               4      ADD A,A
000C37 D96B 30FA            12      JR  NC,C07X1
       D96D                     C07X2:
000C39 D96D CD1BCF          17      CALL    RD556VSYNC
000C3C D970 87               4      ADD A,A
000C3D D971 38FA            12      JR  C,C07X2
000C3F D973 10F2            13      DJNZ    C07X1
                                
000C41 D975 AF               4      XOR A
000C42 D976 2108E0          10      LD  HL,0E008H
000C45 D979 CD2DCF          17      CALL    WRMMIO
000C48 D97C C9              10      RET
                                
       D97D                     INSERT:
000C49 D97D D5              11      PUSH    DE
000C4A D97E CDD3F0          17      CALL    _POS
000C4D D981 54               4      LD  D,H
000C4E D982 3E28             7      LD  A,WIDTH
000C50 D984 95               4      SUB L
000C51 D985 47               4      LD  B,A
000C52 D986 2A8EF0          16      LD  HL,(_TXADR)
000C55 D989 7C               4      LD  A,H
000C56 D98A C6D0             7      ADD A,0D0H
000C58 D98C 67               4      LD  H,A
000C59 D98D 3A96F0          13      LD  A,(_COLORF) ;C:Color
000C5C D990 4F               4      LD  C,A
000C5D D991 AF               4      XOR A       ;A:Text
000C5E D992 CD7FCF          17      CALL    IO_INS
000C61 D995 B7               4      OR  A
000C62 D996 2005            12      JR  NZ,INS1
       D999                     MULINE  EQU $+1
000C64 D998 3EFF             7      LD  A,-1
000C66 D99A 92               4      SUB D
000C67 D99B 2009            12      JR  NZ,INS2
       D99D                     INS1:
000C69 D99D 0628             7      LD  B,WIDTH
000C6B D99F CD7FCF          17      CALL    IO_INS
000C6E D9A2 7A               4      LD  A,D
000C6F D9A3 3299D9          13      LD  (MULINE),A
       D9A6                     INS2:
000C72 D9A6 D1              10      POP DE
000C73 D9A7 C9              10      RET
                                
       D9A8                     CTRL0C:
000C74 D9A8 CD25D9          17      CALL    CTRL0B
       D9AB                     CTRL06:
000C77 D9AB D5              11      PUSH    DE
000C78 D9AC E5              11      PUSH    HL
000C79 D9AD ED5B8EF0        20      LD  DE,(_TXADR)
000C7D D9B1 3A96F0          13      LD  A,(_COLORF)
000C80 D9B4 325CCF          13      LD  (ICSMC),A
000C83 D9B7 C350CF          10      JP  IO_CLR
                                
       D9BA                     CTRL04:
000C86 D9BA CDD3F0          17      CALL    _POS
000C89 D9BD 7D               4      LD  A,L
000C8A D9BE B7               4      OR  A
000C8B D9BF C8              11      RET Z
       D9C0                     CTRL03:
000C8C D9C0 CD0DD9          17      CALL    CTRL0D
       D9C3                     CTRL0A:
       D9C3                     CTRL1F:
000C8F D9C3 2A8EF0          16      LD  HL,(_TXADR)
000C92 D9C6 012800          10      LD  BC,WIDTH
000C95 D9C9 09              11      ADD HL,BC
000C96 D9CA 44               4      LD  B,H
000C97 D9CB 4D               4      LD  C,L
000C98 D9CC 2118FC          10      LD  HL,0-WIDTH*LINE
000C9B D9CF 09              11      ADD HL,BC
000C9C D9D0 3F               4      CCF
000C9D D9D1 9F               4      SBC A,A
000C9E D9D2 C38FD8          10      JP  PRINTE8
                                
       D9D5                     CTRL0E:
000CA1 D9D5 CDD3F0          17      CALL    _POS
000CA4 D9D8 7C               4      LD  A,H
000CA5 D9D9 1804            12      JR  SCR1
       D9DB                     SCR:
000CA7 D9DB 3A97F0          13      LD  A,(_LINE)
000CAA D9DE 3D               4      DEC A
       D9DF                     SCR1:
000CAB D9DF C5              11      PUSH    BC
000CAC D9E0 D5              11      PUSH    DE
000CAD D9E1 E5              11      PUSH    HL
000CAE D9E2 1100D0          10      LD  DE,0D000H
000CB1 D9E5 2128D0          10      LD  HL,0D000H+WIDTH
                                
000CB4 D9E8 47               4      LD  B,A
000CB5 D9E9 B7               4      OR  A
000CB6 D9EA C3A4CF          10      JP  IO_SCRUP
                                
       D9ED                     POS:
000CB9 D9ED 2A8EF0          16      LD  HL,(_TXADR)
000CBC D9F0 C5              11      PUSH    BC
000CBD D9F1 01D8FF          10      LD  BC,0-WIDTH
000CC0 D9F4 AF               4      XOR A
       D9F5                     POS1:
000CC1 D9F5 09              11      ADD HL,BC
000CC2 D9F6 3C               4      INC A
000CC3 D9F7 38FC            12      JR  C,POS1
000CC5 D9F9 ED42            15      SBC HL,BC
000CC7 D9FB 3D               4      DEC A
000CC8 D9FC 67               4      LD  H,A
000CC9 D9FD C1              10      POP BC
000CCA D9FE A7               4      AND A
000CCB D9FF C9              10      RET
                                
       DA00                     GETL:
000CCC DA00 CDD3F0          17      CALL    _POS
000CCF DA03 E5              11      PUSH    HL
000CD0 DA04 3ECD             7      LD  A,0CDH      ;CALL ????
000CD2 DA06 323CD8          13      LD  (INSFLG),A
       DA09                     GETL1:
000CD5 DA09 CD2AD7          17      CALL    _SYS08
000CD8 DA0C FE09             7      CP  9
000CDA DA0E 2008            12      JR  NZ,GETL1V
000CDC DA10 2120FF          10      LD  HL,KBUF
000CDF DA13 CD89D4          17      CALL    MSX
000CE2 DA16 18F1            12      JR  GETL1
       DA18                     GETL1V:
000CE4 DA18 5F               4      LD  E,A
000CE5 DA19 CDD3F0          17      CALL    _POS
000CE8 DA1C CDCDF0          17      CALL    _PRINT
000CEB DA1F 7B               4      LD  A,E
000CEC DA20 FE20             7      CP  $20
000CEE DA22 3809            12      JR  C,GETL1V1
000CF0 DA24 7D               4      LD  A,L
000CF1 DA25 FE27             7      CP  WIDTH-1
000CF3 DA27 2004            12      JR  NZ,GETL1V1
000CF5 DA29 7C               4      LD  A,H
000CF6 DA2A 3299D9          13      LD  (MULINE),A
       DA2D                     GETL1V1:
000CF9 DA2D 7B               4      LD  A,E
000CFA DA2E FE0D             7      CP  00DH
000CFC DA30 20D7            12      JR  NZ,GETL1
000CFE DA32 3E01             7      LD  A,1     ;LD BC,????
000D00 DA34 323CD8          13      LD  (INSFLG),A
000D03 DA37 1120FF          10      LD  DE,KBUF
000D06 DA3A 0628             7      LD  B,WIDTH
000D08 DA3C CD27D3          17      CALL    ZERO_MEMORY_DE
                                
000D0B DA3F D1              10      POP DE
000D0C DA40 CDD3F0          17      CALL    _POS
000D0F DA43 6B               4      LD  L,E
000D10 DA44 3E28             7      LD  A,WIDTH
000D12 DA46 95               4      SUB L
000D13 DA47 57               4      LD  D,A
                                
000D14 DA48 3A99D9          13      LD  A,(MULINE)
000D17 DA4B 94               4      SUB H
000D18 DA4C 2806            12      JR  Z,GL2X
000D1A DA4E 3C               4      INC A
000D1B DA4F 200C            12      JR  NZ,GL3X
000D1D DA51 25               4      DEC H
000D1E DA52 1805            12      JR  GL4X
       DA54                     GL2X:
000D20 DA54 3E1F             7      LD  A,$1F
000D22 DA56 CD14D7          17      CALL    MSG_A
       DA59                     GL4X:
000D25 DA59 7A               4      LD  A,D
000D26 DA5A C628             7      ADD A,WIDTH
000D28 DA5C 57               4      LD  D,A
       DA5D                     GL3X:
000D29 DA5D CD32D9          17      CALL    LOC1
000D2C DA60 4D               4      LD  C,L
000D2D DA61 7C               4      LD  A,H
000D2E DA62 C6D0             7      ADD A,0D0H
000D30 DA64 47               4      LD  B,A
000D31 DA65 5A               4      LD  E,D
000D32 DA66 2120FF          10      LD  HL,KBUF
       DA69                     GETL2:
000D35 DA69 CDD0F0          17      CALL    _SCRN
000D38 DA6C 03               6      INC BC
000D39 DA6D 77               7      LD  (HL),A
000D3A DA6E 23               6      INC HL
000D3B DA6F 1D               4      DEC E
000D3C DA70 20F7            12      JR  NZ,GETL2
       DA72                     GETL3:
000D3E DA72 2B               6      DEC HL
000D3F DA73 7E               7      LD  A,(HL)
000D40 DA74 FE21             7      CP  021H
000D42 DA76 D0              11      RET NC
000D43 DA77 3600            10      LD  (HL),0
000D45 DA79 15               4      DEC D
000D46 DA7A 20F6            12      JR  NZ,GETL3
000D48 DA7C C9              10      RET
                                
       DA7D                     INKEYB:
000D49 DA7D C1              10      POP BC
000D4A DA7E CB47             8      BIT 0,A
000D4C DA80 3E08             7      LD  A,8
000D4E DA82 2002            12      JR  NZ,INKEYD
000D50 DA84 3E03             7      LD  A,3
       DA86                     INKEYD:
000D52 DA86 3292F0          13      LD  (_KEYD),A
000D55 DA89 B7               4      OR  A
000D56 DA8A C9              10      RET
       DA8B                     INKEY:
000D57 DA8B E5              11      PUSH    HL
       DA8C                     GETKEY:
000D58 DA8C 3A92F0          13      LD  A,(_KEYD)
000D5B DA8F B7               4      OR  A
000D5C DA90 6F               4      LD  L,A
000D5D DA91 2610             7      LD  H,16
       DA92                     GKSMC   EQU $-1
       DA93                     GETKEY1:
000D5F DA93 3E01             7      LD  A,1
       DA94                     SKIP_KEYWAIT:   EQU $-1
000D61 DA95 B7               4      OR  A
000D62 DA96 C4C7DA          17      CALL    NZ,CHKEY    ;キーを離すまで待つ
000D65 DA99 281E            12      JR  Z,GETKEY2
000D67 DA9B BD               4      CP  L
000D68 DA9C 201B            12      JR  NZ,GETKEY2
000D6A DA9E CD1BCF          17      CALL    RD556VSYNC
000D6D DAA1 87               4      ADD A,A
000D6E DAA2 30EF            12      JR  NC,GETKEY1
       DAA4                     GETKEY1X:
000D70 DAA4 CDC7DA          17      CALL    CHKEY       ;キーを離すまで待つ
000D73 DAA7 2810            12      JR  Z,GETKEY2
000D75 DAA9 BD               4      CP  L
000D76 DAAA 200D            12      JR  NZ,GETKEY2
000D78 DAAC CD1BCF          17      CALL    RD556VSYNC
000D7B DAAF 87               4      ADD A,A
000D7C DAB0 38F2            12      JR  C,GETKEY1X
000D7E DAB2 25               4      DEC H
000D7F DAB3 20DE            12      JR  NZ,GETKEY1
000D81 DAB5 3E01             7      LD  A,1
000D83 DAB7 1805            12      JR  GETKEY3
       DAB9                     GETKEY2:
000D85 DAB9 3E10             7      LD  A,16
000D87 DABB 3294DA          13      LD  (SKIP_KEYWAIT),A
       DABE                     GETKEY3:
000D8A DABE 3292DA          13      LD  (GKSMC),A
000D8D DAC1 3A92F0          13      LD  A,(_KEYD)
000D90 DAC4 B7               4      OR  A
000D91 DAC5 E1              10      POP HL
000D92 DAC6 C0              11      RET NZ
       DAC7                     CHKEY:
000D93 DAC7 C5              11      PUSH    BC
000D94 DAC8 3E08             7      LD  A,8
000D96 DACA CD0ECF          17      CALL    RDKEYDATA
000D99 DACD 3293F0          13      LD  (_KEYD+1),A
000D9C DAD0 CB7F             8      BIT 7,A
000D9E DAD2 28A9            12      JR  Z,INKEYB
000DA0 DAD4 E5              11      PUSH    HL
000DA1 DAD5 0E07             7      LD  C,7
000DA3 DAD7 2140ED          10      LD  HL,KEY_TABLE
000DA6 DADA CB47             8      BIT 0,A
000DA8 DADC 2003            12      JR  NZ,CHKEY0
000DAA DADE 2180ED          10      LD  HL,SHIFT_TABLE
       DAE1                     CHKEY0:
000DAD DAE1 CB77             8      BIT 6,A
000DAF DAE3 2003            12      JR  NZ,CHKEY1
000DB1 DAE5 21C0ED          10      LD  HL,CTRL_TABLE
       DAE8                     CHKEY1:
000DB4 DAE8 79               4      LD  A,C
000DB5 DAE9 CD0ECF          17      CALL    RDKEYDATA
000DB8 DAEC 0608             7      LD  B,8
       DAEE                     CHKEY2:
000DBA DAEE 87               4      ADD A,A
000DBB DAEF 3009            12      JR  NC,CHKEY3
000DBD DAF1 23               6      INC HL
000DBE DAF2 10FA            13      DJNZ    CHKEY2
000DC0 DAF4 0D               4      DEC C
000DC1 DAF5 79               4      LD  A,C
000DC2 DAF6 3C               4      INC A
000DC3 DAF7 20EF            12      JR  NZ,CHKEY1
000DC5 DAF9 06                      DB  $06     ;LD B,?? 次の1バイトを飛ばす
       DAFA                     CHKEY3:
000DC6 DAFA 7E               7      LD  A,(HL)
000DC7 DAFB E1              10      POP HL
000DC8 DAFC C1              10      POP BC
000DC9 DAFD 1887            12      JR  INKEYD
                                
       DAFF                     SCRN:
000DCB DAFF E5              11      PUSH    HL
000DCC DB00 CD35CF          17      CALL    RDMMIO_BC
000DCF DB03 6F               4      LD  L,A
000DD0 DB04 26EF             7      LD  H,DC_TABLE/256
000DD2 DB06 7E               7      LD  A,(HL)
000DD3 DB07 FE41             7      CP  'A'     ;英小文字チェック
000DD5 DB09 380E            12      JR  C,SCRN1
000DD7 DB0B FE5B             7      CP  'Z'+1
000DD9 DB0D DC1BDB          17      CALL    C,SCRNC
000DDC DB10 FEA6             7      CP  $A6     ;ひらがなチェック
000DDE DB12 3805            12      JR  C,SCRN1
000DE0 DB14 FEE0             7      CP  $E0
000DE2 DB16 DC1BDB          17      CALL    C,SCRNC
       DB19                     SCRN1:
000DE5 DB19 E1              10      POP HL
000DE6 DB1A C9              10      RET
                                
       DB1B                     SCRNC:
000DE7 DB1B 6F               4      LD  L,A
000DE8 DB1C 60               4      LD  H,B
000DE9 DB1D CBD8             8      SET 3,B
000DEB DB1F CD35CF          17      CALL    RDMMIO_BC
000DEE DB22 44               4      LD  B,H
000DEF DB23 CB7F             8      BIT 7,A
000DF1 DB25 7D               4      LD  A,L
000DF2 DB26 C8              11      RET Z
000DF3 DB27 FE5B             7      CP  'Z'+1
000DF5 DB29 3804            12      JR  C,SCRNC_ADD
000DF7 DB2B FEC0             7      CP  $C0
000DF9 DB2D 3803            12      JR  C,SCRNC_SUB
       DB2F                     SCRNC_ADD:
000DFB DB2F C620             7      ADD A,$20
000DFD DB31 C9              10      RET
       DB32                     SCRNC_SUB:
000DFE DB32 D620             7      SUB $20
000E00 DB34 C9              10      RET
[EOF:M7IO.ASM:SHIFT_JIS]
                                    INCLUDE "LDFILE.ASM"
                                
                                ;   LSX-Dodgers FILE
                                
                                ;   【注意】バイナリサイズを下位1バイトを0丁度に調整する必要あり
                                
       DB35                     FILEC:
000E01 DB35 CD40DB          17      CALL    FILE
       DB38                     FILEC2:
000E04 DB38 3A15F0          13      LD  A,(FDRV+1)
000E07 DB3B FE20             7      CP  020H
000E09 DB3D C8              11      RET Z
000E0A DB3E 1839            12      JR  SETDIR1
                                
       DB40                     FILE:
000E0C DB40 AF               4      XOR A
000E0D DB41 3214F0          13      LD  (FDRV),A
000E10 DB44 67               4      LD  H,A
000E11 DB45 6F               4      LD  L,A
000E12 DB46 2222F0          16      LD  (FDRV+14),HL
000E15 DB49 CD17DC          17      CALL    SPCUT
000E18 DB4C CDFCDB          17      CALL    CCHK3
000E1B DB4F 2812            12      JR  Z,DEVI1
000E1D DB51 13               6      INC DE
000E1E DB52 1A               7      LD  A,(DE)
000E1F DB53 1B               6      DEC DE
000E20 DB54 FE3A             7      CP  ':'
000E22 DB56 200B            12      JR  NZ,DEVI1
000E24 DB58 1A               7      LD  A,(DE)      ;DRIVE
000E25 DB59 CD57DE          17      CALL    CAP
000E28 DB5C D640             7      SUB '@'
000E2A DB5E 13               6      INC DE
000E2B DB5F 13               6      INC DE
000E2C DB60 3214F0          13      LD  (FDRV),A
       DB63                     DEVI1:
000E2F DB63 1A               7      LD  A,(DE)
000E30 DB64 D65C             7      SUB 05CH        ;\
000E32 DB66 2009            12      JR  NZ,NOROOT
000E34 DB68 6F               4      LD  L,A     ;A=0でH=0のはずなのでHL=0
000E35 DB69 222EF0          16      LD  (FDRV+26),HL
000E38 DB6C 2C               4      INC L
000E39 DB6D 2222F0          16      LD  (FDRV+14),HL
000E3C DB70 13               6      INC DE
       DB71                     NOROOT:
                                
       DB71                     SETDIR:
000E3D DB71 CD9DDB          17      CALL    FILED
000E40 DB74 1A               7      LD  A,(DE)
000E41 DB75 FE5C             7      CP  05CH        ;\
000E43 DB77 C0              11      RET NZ
000E44 DB78 13               6      INC DE
       DB79                     SETDIR1:
000E45 DB79 3E10             7      LD  A,010H      ;Directory
000E47 DB7B 3221F0          13      LD  (FDRV+13),A
000E4A DB7E D5              11      PUSH    DE
000E4B DB7F 1114F0          10      LD  DE,FDRV
000E4E DB82 2A1EF1          16      LD  HL,(STABLE+2*00FH)
000E51 DB85 CD0F00          17      CALL    JP_HL
000E54 DB88 D1              10      POP DE
000E55 DB89 B7               4      OR  A
000E56 DB8A C0              11      RET NZ
                                
000E57 DB8B 3A21F0          13      LD  A,(FDRV+13)
000E5A DB8E CB67             8      BIT 4,A
000E5C DB90 C8              11      RET Z
                                
000E5D DB91 CDE4DB          17      CALL    FILEI
000E60 DB94 2A2EF0          16      LD  HL,(FDRV+26)
000E63 DB97 23               6      INC HL
000E64 DB98 2222F0          16      LD  (FDRV+14),HL
000E67 DB9B 18D4            12      JR  SETDIR
                                
       DB9D                     FILED:
000E69 DB9D CDE4DB          17      CALL    FILEI
000E6C DBA0 2115F0          10      LD  HL,FNAME
                                
000E6F DBA3 0608             7      LD  B,8
       DBA5                     FILE2:
000E71 DBA5 CDF1DB          17      CALL    CCHKF
000E74 DBA8 C8              11      RET Z
000E75 DBA9 FE2A             7      CP  '*'
000E77 DBAB 282E            12      JR  Z,FILE9
000E79 DBAD FE2E             7      CP  '.'
000E7B DBAF 280C            12      JR  Z,FILE4
000E7D DBB1 77               7      LD  (HL),A
000E7E DBB2 23               6      INC HL
000E7F DBB3 10F0            13      DJNZ    FILE2
                                
       DBB5                     FILE3:
000E81 DBB5 CDF1DB          17      CALL    CCHKF
000E84 DBB8 C8              11      RET Z
000E85 DBB9 FE2E             7      CP  '.'
000E87 DBBB 20F8            12      JR  NZ,FILE3
                                
       DBBD                     FILE4:
000E89 DBBD 211DF0          10      LD  HL,FNAME+8
000E8C DBC0 0603             7      LD  B,3
                                
       DBC2                     FILE4L:
000E8E DBC2 CDF1DB          17      CALL    CCHKF
000E91 DBC5 C8              11      RET Z
000E92 DBC6 FE2E             7      CP  '.'
000E94 DBC8 2008            12      JR  NZ,FILE12
000E96 DBCA 3215F0          13      LD  (FNAME),A   ;Parent directory(..)
000E99 DBCD 3216F0          13      LD  (FNAME+1),A
000E9C DBD0 3E20             7      LD  A,020H
       DBD2                     FILE12:
000E9E DBD2 FE2A             7      CP  '*'
000EA0 DBD4 280A            12      JR  Z,FILE10
000EA2 DBD6 77               7      LD  (HL),A
000EA3 DBD7 23               6      INC HL
000EA4 DBD8 10E8            13      DJNZ    FILE4L
000EA6 DBDA C9              10      RET
                                
       DBDB                     FILE9:              ;名前の*処理、名前の残りを?で埋める
000EA7 DBDB CDE0DB          17      CALL    FILE10
000EAA DBDE 18D5            12      JR  FILE3
                                
       DBE0                     FILE10:
000EAC DBE0 3E3F             7      LD  A,'?'
000EAE DBE2 1808            12      JR  FILL_MEMORY
       DBE4                     FILEI:              ;名前＋拡張子をスペースで初期化
000EB0 DBE4 3E20             7      LD  A,020H
000EB2 DBE6 01000B          10      LD  BC,11*256   ;C=0にしておく
000EB5 DBE9 2115F0          10      LD  HL,FNAME
       DBEC                     FILL_MEMORY:            ;HLからBバイトAで埋める
000EB8 DBEC 77               7      LD  (HL),A
000EB9 DBED 23               6      INC HL
000EBA DBEE 10FC            13      DJNZ    FILL_MEMORY
000EBC DBF0 C9              10      RET
                                
       DBF1                     CCHKF:
000EBD DBF1 1A               7      LD  A,(DE)
000EBE DBF2 CDF9DB          17      CALL    CCHK2
000EC1 DBF5 C8              11      RET Z
000EC2 DBF6 C364DF          10      JP  FKAN
                                
       DBF9                     CCHK2:
000EC5 DBF9 0C               4      INC C
000EC6 DBFA 0D               4      DEC C
000EC7 DBFB C0              11      RET NZ
       DBFC                     CCHK3:              ;ZF=1 で使えない文字
000EC8 DBFC FE2B             7      CP  '+'
000ECA DBFE C8              11      RET Z
000ECB DBFF FE2C             7      CP  ','
000ECD DC01 C8              11      RET Z
000ECE DC02 FE2F             7      CP  '/'
000ED0 DC04 C8              11      RET Z
000ED1 DC05 FE3A             7      CP  ':'
000ED3 DC07 C8              11      RET Z
000ED4 DC08 FE3B             7      CP  ';'
000ED6 DC0A C8              11      RET Z
000ED7 DC0B FE3D             7      CP  '='
000ED9 DC0D C8              11      RET Z
000EDA DC0E FE5C             7      CP  05CH    ;\
000EDC DC10 C8              11      RET Z
000EDD DC11 FE20             7      CP  020H
000EDF DC13 D0              11      RET NC
000EE0 DC14 BF               4      CP  A       ;Z=1
000EE1 DC15 C9              10      RET
                                
       DC16                     SS1:
000EE2 DC16 13               6      INC DE
       DC17                     SPCUT:              ;スペースをカット
000EE3 DC17 1A               7      LD  A,(DE)
000EE4 DC18 FE20             7      CP  020H
000EE6 DC1A 28FA            12      JR  Z,SS1
000EE8 DC1C C9              10      RET
                                
       DC1D                     SETDRVF:
000EE9 DC1D 1114F0          10      LD  DE,FDRV
       DC20                     SETDRV0:
000EEC DC20 CD29DC          17      CALL    SETDRV
000EEF DC23 FDE1            14      POP IY
000EF1 DC25 C1              10      POP BC
000EF2 DC26 D1              10      POP DE
000EF3 DC27 E1              10      POP HL
000EF4 DC28 C9              10      RET
                                
       DC29                     SETDRV:
000EF5 DC29 E3              19      EX  (SP),HL     ;HL=RETRN ADDRESS
000EF6 DC2A D5              11      PUSH    DE      ;PUSH HL/DE/BC/IY
000EF7 DC2B C5              11      PUSH    BC
000EF8 DC2C 1A               7      LD  A,(DE)
000EF9 DC2D D5              11      PUSH    DE
000EFA DC2E FDE3            23      EX  (SP),IY
                                
000EFC DC30 CD37DC          17      CALL    GETDRV
000EFF DC33 CDD9F0          17      CALL    _CHGDRV
                                
000F02 DC36 E9               4      JP  (HL)
                                
       DC37                     GETDRV:
000F03 DC37 CD4ADC          17      CALL    GETDRV1
000F06 DC3A 3288F0          13      LD  (_DRV),A
000F09 DC3D C9              10      RET
                                
       DC3E                     IS_SAME_DRV_A_DE:
                                ;   A と (DE) が同じドライブか調べる
                                ;   ZF=1ならば同じドライブ
000F0A DC3E CD4ADC          17      CALL    GETDRV1
000F0D DC41 C5              11      PUSH    BC
000F0E DC42 4F               4      LD  C,A
000F0F DC43 1A               7      LD  A,(DE)
000F10 DC44 CD4ADC          17      CALL    GETDRV1
000F13 DC47 A9               4      XOR C
000F14 DC48 C1              10      POP BC
000F15 DC49 C9              10      RET
       DC4A                     GETDRV1:
000F16 DC4A E67F             7      AND 07FH
000F18 DC4C D601             7      SUB 001H
000F1A DC4E D0              11      RET NC
000F1B DC4F 3A0400          13      LD  A,(_DVSW)   ;Current Drive
000F1E DC52 C9              10      RET
                                
       DC53                     SOPENX:
000F1F DC53 1139F0          10      LD  DE,SFILE
000F22 DC56 FD7E00          19      LD  A,(IY+0)        ;(FCB)ドライブ番号
000F25 DC59 CD3EDC          17      CALL    IS_SAME_DRV_A_DE
000F28 DC5C 2024            12      JR  NZ,SOPEN
000F2A DC5E 13               6      INC DE
000F2B DC5F FDE5            15      PUSH    IY
000F2D DC61 E1              10      POP HL
000F2E DC62 23               6      INC HL
000F2F DC63 CDEFDD          17      CALL    CPFILE
000F32 DC66 201A            12      JR  NZ,SOPEN
                                
000F34 DC68 2AF4F1          16      LD  HL,(SCDIR)
000F37 DC6B FD750E          19      LD  (IY+14),L   ;(FCB)アクセスするディレクトリのクラスタ番号+1
000F3A DC6E FD740F          19      LD  (IY+15),H
                                
000F3D DC71 2AF8F1          16      LD  HL,(SFNDF)  ;Direcroty location and Flags
000F40 DC74 229FF0          16      LD  (_FILEN),HL
                                
000F43 DC77 ED5BF6F1        20      LD  DE,(SFBPS)
000F47 DC7B 2139F0          10      LD  HL,SFILE
000F4A DC7E 36FF            10      LD  (HL),0FFH
000F4C DC80 23               6      INC HL
000F4D DC81 C9              10      RET
       DC82                     SOPEN:
000F4E DC82 2197DD          10      LD  HL,FILESE
       DC85                     SOPENC:
000F51 DC85 22BEDC          16      LD  (OPENPAT),HL
                                
000F54 DC88 CDE2F0          17      CALL    _RDFATX     ;Detect Media
000F57 DC8B 3856            12      JR  C,RDDERR
                                
000F59 DC8D AF               4      XOR A
000F5A DC8E 329FF0          13      LD  (_FILEN),A
000F5D DC91 CD97DE          17      CALL    LDDIRX1     ;A=0で呼び出す
000F60 DC94 2818            12      JR  Z,SDIRX1
                                
000F62 DC96 CD88DD          17      CALL    READ_DIR    ;Sub Directory
000F65 DC99 3808            12      JR  C,SDIRX0
000F67 DC9B 2A7EF1          16      LD  HL,(_DTBUF)
000F6A DC9E 7E               7      LD  A,(HL)
000F6B DC9F FE2E             7      CP  '.'
000F6D DCA1 280F            12      JR  Z,SOPEN1
       DCA3                     SDIRX0:
000F6F DCA3 AF               4      XOR A
000F70 DCA4 32A0F0          13      LD  (_DIRF),A
000F73 DCA7 FD360E01        19      LD  (IY+14),1   ;(FCB)レコードサイズ
000F77 DCAB FD770F          19      LD  (IY+15),A
       DCAE                     SDIRX1:
000F7A DCAE ED5BFCF1        20      LD  DE,(_DIRPS) ;Root Directory
       DCB2                     SOPEN1:
000F7E DCB2 0E20             7      LD  C,32        ;自己書き換え 1セクタ辺りのディレクトリエントリ数  1024=32 / 512=16 / 256=8
       DCB3                     SDECPAT EQU $-1
       DCB4                     SOPEN1X:
000F80 DCB4 CD88DD          17      CALL    READ_DIR    ;FILE SEARCH
000F83 DCB7 382A            12      JR  C,RDDERR
000F85 DCB9 2A7EF1          16      LD  HL,(_DTBUF)
       DCBC                     SOPEN2:
000F88 DCBC D5              11      PUSH    DE
000F89 DCBD CD97DD          17      CALL    FILESE      ;(self-modifying code)
       DCBE                     OPENPAT EQU $-2
000F8C DCC0 D1              10      POP DE
000F8D DCC1 386D            12      JR  C,SOPENE
000F8F DCC3 281B            12      JR  Z,SCF_FF_RET
       DCC5                     SOPEN3:
000F91 DCC5 3AA0F0          13      LD  A,(_DIRF)   ;ディレクトリか判別
000F94 DCC8 B7               4      OR  A
000F95 DCC9 200C            12      JR  NZ,SOPEN5
000F97 DCCB 13               6      INC DE      ;ルートディレクトリ
000F98 DCCC E5              11      PUSH    HL
000F99 DCCD 210C00          10      LD  HL,12       ;(self-modifying code)MAXDIR
       DCCE                     MD_PAT  EQU $-2
000F9C DCD0 ED52            15      SBC HL,DE       ;CF=0 なので SUB HL,DE
000F9E DCD2 E1              10      POP HL
000F9F DCD3 20DD            12      JR  NZ,SOPEN1
000FA1 DCD5 1807            12      JR  SOPEN6
       DCD7                     SOPEN5:
000FA3 DCD7 CDADE5          17      CALL    GNCLX       ;END DIR
000FA6 DCDA D8              11      RET C
000FA7 DCDB CD4FDE          17      CALL    ENDCL
       DCDE                     SOPEN6:
000FAA DCDE 38D2            12      JR  C,SOPEN1
       DCE0                     SCF_FF_RET:
000FAC DCE0 37               4      SCF         ;CF=1
000FAD DCE1 9F               4      SBC A,A     ;A=0FFH
000FAE DCE2 C9              10      RET
                                
       DCE3                     RDDERR:
000FAF DCE3 BF               4      CP  A       ;READ ERR CF=1 ZF=1
000FB0 DCE4 37               4      SCF
000FB1 DCE5 C9              10      RET
                                
       DCE6                     NOPEN:
000FB2 DCE6 2197DD          10      LD  HL,FILESE
000FB5 DCE9 22BEDC          16      LD  (OPENPAT),HL
000FB8 DCEC FD2A98F0        20      LD  IY,(_FCB)
000FBC DCF0 CD77DF          17      CALL    CHKWILDX
000FBF DCF3 30EB            12      JR  NC,SCF_FF_RET
000FC1 DCF5 FD7E00          19      LD  A,(IY+0)
000FC4 DCF8 CD37DC          17      CALL    GETDRV
000FC7 DCFB CDD9F0          17      CALL    _CHGDRV
000FCA DCFE D8              11      RET C
000FCB DCFF 2AF8F1          16      LD  HL,(SFNDF)  ;Direcroty location and Flags
000FCE DD02 229FF0          16      LD  (_FILEN),HL
                                
000FD1 DD05 CD92DE          17      CALL    LDDIRX
000FD4 DD08 ED5B9AF0        20      LD  DE,(_FBPS)
000FD8 DD0C CD88DD          17      CALL    READ_DIR
000FDB DD0F 38D2            12      JR  C,RDDERR
000FDD DD11 3A9EF0          13      LD  A,(_FBCNT)
000FE0 DD14 3D               4      DEC A
000FE1 DD15 28AE            12      JR  Z,SOPEN3
       DD17                     NOPEN2:
000FE3 DD17 2A9CF0          16      LD  HL,(_FBAD)
000FE6 DD1A 012000          10      LD  BC,020H
000FE9 DD1D 09              11      ADD HL,BC
000FEA DD1E 4F               4      LD  C,A
000FEB DD1F 189B            12      JR  SOPEN2
                                
       DD21                     SOPENE2:
000FED DD21 229CF0          16      LD  (_FBAD),HL
000FF0 DD24 79               4      LD  A,C
000FF1 DD25 329EF0          13      LD  (_FBCNT),A
000FF4 DD28 ED539AF0        20      LD  (_FBPS),DE
000FF8 DD2C FD2298F0        20      LD  (_FCB),IY
       DD30                     SOPENE:
000FFC DD30 AF               4      XOR A
000FFD DD31 C9              10      RET
                                
       DD32                     COPEN:
000FFE DD32 FD360D20        19      LD  (IY+13),020H    ;(FCB)属性(アトリビュート)
                                
001002 DD36 21B4DD          10      LD  HL,NEXTSE
001005 DD39 CD85DC          17      CALL    SOPENC
001008 DD3C D0              11      RET NC
001009 DD3D C8              11      RET Z
00100A DD3E 3AA0F0          13      LD  A,(_DIRF)   ;ディレクトリか判別
00100D DD41 B7               4      OR  A
00100E DD42 37               4      SCF
00100F DD43 C8              11      RET Z       ;ルートディレクトリ
001010 DD44 0601             7      LD  B,1
001012 DD46 CDD6DF          17      CALL    WRDF
001015 DD49 D8              11      RET C
001016 DD4A ED5BFEF1        20      LD  DE,(_CLPS)
00101A DD4E D5              11      PUSH    DE
00101B DD4F CD18DE          17      CALL    DCPAT
00101E DD52 CD31E4          17      CALL    DRDNX
001021 DD55 2A7EF1          16      LD  HL,(_DTBUF) ;ディレクトリエントリを0クリア
001024 DD58 3A17E3          13      LD  A,(SECSZ+2) ;1024=4 / 512=2 / 256=1
001027 DD5B 47               4      LD  B,A
001028 DD5C AF               4      XOR A
001029 DD5D 4F               4      LD  C,A
       DD5E                     COPENCL:
00102A DD5E 77               7      LD  (HL),A
00102B DD5F EDA1            16      CPI         ;HL=HL+1 BC=BC-1 BCが0の場合にP/V=0
00102D DD61 EA5EDD          10      JP  PE,COPENCL
                                
001030 DD64 3A36DE          13      LD  A,(SPCPAT)  ;1クラスタの論理セクタ数
001033 DD67 3D               4      DEC A
001034 DD68 2819            12      JR  Z,COPENE
001036 DD6A 3E01             7      LD  A,1     ;1セクタ辺りのセクタ数が2以上の場合
001038 DD6C 32A5E5          13      LD  (_SECPS),A
00103B DD6F D1              10      POP DE      ;DE=(_CLPS)
00103C DD70 D5              11      PUSH    DE
       DD71                     COPEN1:
00103D DD71 D5              11      PUSH    DE      ;データバッファに入らないセクタもゼロクリア
00103E DD72 C5              11      PUSH    BC
00103F DD73 2A7EF1          16      LD  HL,(_DTBUF)
001042 DD76 CD32DE          17      CALL    CLUSTX
001045 DD79 CD41E7          17      CALL    DWT24
001048 DD7C C1              10      POP BC
001049 DD7D D1              10      POP DE
00104A DD7E CDA4E5          17      CALL    NEXTX
00104D DD81 20EE            12      JR  NZ,COPEN1
       DD83                     COPENE:
00104F DD83 2A7EF1          16      LD  HL,(_DTBUF)
001052 DD86 D1              10      POP DE
001053 DD87 C9              10      RET
                                
       DD88                     READ_DIR:
001054 DD88 ED53FEF1        20      LD  (_CLPS),DE
001058 DD8C C5              11      PUSH    BC
001059 DD8D D5              11      PUSH    DE
00105A DD8E CD18DE          17      CALL    DCPAT
00105D DD91 CD11E4          17      CALL    DRDX
001060 DD94 D1              10      POP DE
001061 DD95 C1              10      POP BC
001062 DD96 C9              10      RET
                                
       DD97                     FILESE:
001063 DD97 7E               7      LD  A,(HL)
001064 DD98 B7               4      OR  A
001065 DD99 C8              11      RET Z       ;END:ZF=1 CF=0
001066 DD9A FEE5             7      CP  0E5H
001068 DD9C 280E            12      JR  Z,FILESE1
00106A DD9E FDE5            15      PUSH    IY
00106C DDA0 D1              10      POP DE
00106D DDA1 13               6      INC DE
00106E DDA2 E5              11      PUSH    HL
00106F DDA3 CDEFDD          17      CALL    CPFILE
001072 DDA6 CC10DE          17      CALL    Z,CPFILE2
001075 DDA9 E1              10      POP HL
001076 DDAA 37               4      SCF
001077 DDAB C8              11      RET Z       ;!!!:(ZF=1) CF=1
       DDAC                     FILESE1:
001078 DDAC CDC3DD          17      CALL    FNEXT
00107B DDAF 20E6            12      JR  NZ,FILESE
       DDB1                     ZF0_CF0_AFF_RET:
00107D DDB1 F6FF             7      OR  0FFH        ;ZF=0 CF=0
00107F DDB3 C9              10      RET
                                
       DDB4                     NEXTSE:
001080 DDB4 7E               7      LD  A,(HL)
001081 DDB5 B7               4      OR  A
001082 DDB6 37               4      SCF
001083 DDB7 C8              11      RET Z       ;!!!:ZF=1 CF=1
001084 DDB8 FEE5             7      CP  0E5H
001086 DDBA 37               4      SCF
001087 DDBB C8              11      RET Z       ;!!!:(ZF=1) CF=1
001088 DDBC CDC3DD          17      CALL    FNEXT
00108B DDBF 20F3            12      JR  NZ,NEXTSE
00108D DDC1 18EE            12      JR  ZF0_CF0_AFF_RET
                                
       DDC3                     FNEXT:
00108F DDC3 E5              11      PUSH    HL
001090 DDC4 219FF0          10      LD  HL,_FILEN
001093 DDC7 34              11      INC (HL)
001094 DDC8 E1              10      POP HL
001095 DDC9 112000          10      LD  DE,020H
001098 DDCC 19              11      ADD HL,DE
001099 DDCD 0D               4      DEC C
00109A DDCE C9              10      RET
                                
       DDCF                     CPNAME:
00109B DDCF C5              11      PUSH    BC
00109C DDD0 D5              11      PUSH    DE
00109D DDD1 E5              11      PUSH    HL
00109E DDD2 CDE9DD          17      CALL    CPFILE4
0010A1 DDD5 E1              10      POP HL
0010A2 DDD6 23               6      INC HL
0010A3 DDD7 23               6      INC HL
0010A4 DDD8 23               6      INC HL
0010A5 DDD9 23               6      INC HL
0010A6 DDDA D1              10      POP DE
0010A7 DDDB C1              10      POP BC
0010A8 DDDC 2005            12      JR  NZ,CPNAME1
0010AA DDDE 7E               7      LD  A,(HL)
0010AB DDDF 23               6      INC HL
0010AC DDE0 66               7      LD  H,(HL)
0010AD DDE1 6F               4      LD  L,A
0010AE DDE2 C9              10      RET
       DDE3                     CPNAME1:
0010AF DDE3 23               6      INC HL
0010B0 DDE4 23               6      INC HL
0010B1 DDE5 10E8            13      DJNZ    CPNAME
0010B3 DDE7 37               4      SCF
0010B4 DDE8 C9              10      RET
                                
       DDE9                     CPFILE4:
0010B5 DDE9 C5              11      PUSH    BC
0010B6 DDEA 010004          10      LD  BC,00400H
0010B9 DDED 1804            12      JR  CPSTR1
       DDEF                     CPFILE:
0010BB DDEF C5              11      PUSH    BC
0010BC DDF0 01000B          10      LD  BC,00B00H
       DDF3                     CPSTR1:
0010BF DDF3 1A               7      LD  A,(DE)
0010C0 DDF4 FE3F             7      CP  '?'     ;Wild card
0010C2 DDF6 2812            12      JR  Z,CPSTR2
0010C4 DDF8 7E               7      LD  A,(HL)
0010C5 DDF9 CD5DDF          17      CALL    FKANC
0010C8 DDFC E5              11      PUSH    HL
0010C9 DDFD 67               4      LD  H,A
0010CA DDFE 1A               7      LD  A,(DE)
0010CB DDFF CB01             4      RLC C
0010CD DE01 CD5DDF          17      CALL    FKANC
0010D0 DE04 CB09             4      RRC C
0010D2 DE06 BC               4      CP  H       ;CP (HL),(DE)
0010D3 DE07 E1              10      POP HL
0010D4 DE08 2004            12      JR  NZ,CPSTR3
       DE0A                     CPSTR2:
0010D6 DE0A 13               6      INC DE
0010D7 DE0B 23               6      INC HL
0010D8 DE0C 10E5            13      DJNZ    CPSTR1
       DE0E                     CPSTR3:
0010DA DE0E C1              10      POP BC
0010DB DE0F C9              10      RET
                                
       DE10                     CPFILE2:
0010DC DE10 FD7E0D          19      LD  A,(IY+13)   ;(FCB)属性(アトリビュート)
0010DF DE13 F6E1             7      OR  0E1H
0010E1 DE15 2F               4      CPL
0010E2 DE16 A6               7      AND (HL)
0010E3 DE17 C9              10      RET
                                
       DE18                     DCPAT:
0010E4 DE18 0E00             7      LD  C,0
0010E6 DE1A 2A7EF1          16      LD  HL,(_DTBUF)
0010E9 DE1D 3AA0F0          13      LD  A,(_DIRF)   ;ディレクトリか判別
0010EC DE20 B7               4      OR  A
0010ED DE21 C8              11      RET Z       ;ルートディレクトリの場合はCレジスタを0にしておく(CDEがセクタ番号)
0010EE DE22 3A36DE          13      LD  A,(SPCPAT)
0010F1 DE25 4F               4      LD  C,A
0010F2 DE26 3AA5E5          13      LD  A,(_SECPS)
0010F5 DE29 B9               4      CP  C
0010F6 DE2A 3801            12      JR  C,DC1
0010F8 DE2C AF               4      XOR A
       DE2D                     DC1:
0010F9 DE2D F680             7      OR  080H
0010FB DE2F 32A0F0          13      LD  (_DIRF),A   ;bit0-6:セクタインデックス
       DE32                     CLUSTX:
0010FE DE32 E5              11      PUSH    HL
0010FF DE33 EB               4      EX  DE,HL
001100 DE34 AF               4      XOR A
001101 DE35 0E01             7      LD  C,1     ;自己書き換え（1クラスタの論理セクタ数）
       DE36                     SPCPAT  EQU $-1
       DE37                     L_CLDBL:
001103 DE37 CB19             8      RR  C       ;->CF
001105 DE39 3804            12      JR  C,E_CLDBL
001107 DE3B 29              11      ADD HL,HL       ;*2
001108 DE3C 8F               4      ADC A,A
001109 DE3D 18F8            12      JR  L_CLDBL
       DE3F                     E_CLDBL:
00110B DE3F 4F               4      LD  C,A
00110C DE40 3AA5E5          13      LD  A,(_SECPS)
00110F DE43 B5               4      OR  L
001110 DE44 6F               4      LD  L,A
001111 DE45 110800          10      LD  DE,8    ;+8 (2D)  !ADDCL (self-modifying code)
       DE46                     CLSPAT  EQU $-2
001114 DE48 AF               4      XOR A
001115 DE49 19              11      ADD HL,DE   ;データ格納領域の先頭論理セクタ番号
001116 DE4A 89               4      ADC A,C
001117 DE4B 4F               4      LD  C,A
001118 DE4C EB               4      EX  DE,HL
001119 DE4D E1              10      POP HL
00111A DE4E C9              10      RET
                                
       DE4F                     ENDCL:
00111B DE4F 7A               4      LD  A,D ;END CLUSTER
00111C DE50 FE01             7      CP  1   ;164=356    (self-modifying code)
       DE51                     CLPAT1  EQU $-1
00111E DE52 C0              11      RET NZ
00111F DE53 7B               4      LD  A,E
001120 DE54 FE64             7      CP  064H    ;       (self-modifying code)
       DE55                     CLPAT2  EQU $-1
001122 DE56 C9              10      RET
                                
       DE57                     CAP:
001123 DE57 FE61             7      CP  'a'
001125 DE59 D8              11      RET C
001126 DE5A FE7B             7      CP  'z'+1
001128 DE5C D0              11      RET NC
001129 DE5D D620             7      SUB 020H
00112B DE5F C9              10      RET
       DE60                     CAP2:
00112C DE60 CD57DE          17      CALL    CAP
       DE63                     CAP3:               ;
00112F DE63 FE05             7      CP  5
001131 DE65 2803            12      JR  Z,CAP4
001133 DE67 FE21             7      CP  021H
001135 DE69 C9              10      RET
       DE6A                     CAP4:
001136 DE6A 3EE5             7      LD  A,0E5H
001138 DE6C C9              10      RET
                                
       DE6D                     CHDIR:
001139 DE6D CD54E8          17      CALL    GETDPBD
00113C DE70 381D            12      JR  C,CHDIR2
00113E DE72 DD751A          19      LD  (IX+DPB_SDIR),L
001141 DE75 DD741B          19      LD  (IX+DPB_SDIR+1),H
001144 DE78 1815            12      JR  CHDIR2      ;POP_IX_RET
                                
       DE7A                     LDDIR:
001146 DE7A CD54E8          17      CALL    GETDPBD
001149 DE7D DD5E1A          19      LD  E,(IX+DPB_SDIR)
00114C DE80 DD561B          19      LD  D,(IX+DPB_SDIR+1)
00114F DE83 13               6      INC DE
001150 DE84 FD730E          19      LD  (IY+14),E   ;(FCB)アクセスするディレクトリのクラスタ番号+1
001153 DE87 FD720F          19      LD  (IY+15),D
001156 DE8A 1B               6      DEC DE
001157 DE8B AF               4      XOR A
001158 DE8C 32A0F0          13      LD  (_DIRF),A
       DE8F                     CHDIR2:
00115B DE8F DDE1            14      POP IX
00115D DE91 C9              10      RET
                                
       DE92                     LDDIRX:
00115E DE92 3AA0F0          13      LD  A,(_DIRF)   ;(FCB)アクセスするディレクトリのセクタインデックス
001161 DE95 E67F             7      AND 07FH
       DE97                     LDDIRX1:
001163 DE97 32A5E5          13      LD  (_SECPS),A
001166 DE9A FD5E0E          19      LD  E,(IY+14)   ;(FCB)アクセスするディレクトリのクラスタ番号+1
001169 DE9D FD560F          19      LD  D,(IY+15)
00116C DEA0 1B               6      DEC DE
00116D DEA1 CD4FDE          17      CALL    ENDCL
001170 DEA4 D47ADE          17      CALL    NC,LDDIR
       DEA7                     LDDIRS:
001173 DEA7 7A               4      LD  A,D
001174 DEA8 B3               4      OR  E
001175 DEA9 32A0F0          13      LD  (_DIRF),A   ;ディレクトリか判別
001178 DEAC C9              10      RET
                                
       DEAD                     KILL:
001179 DEAD CD77DF          17      CALL    CHKWILDX
00117C DEB0 3834            12      JR  C,KILLW
00117E DEB2 CD53DC          17      CALL    SOPENX
       DEB5                     KILLS:
001181 DEB5 3E1F             7      LD  A,01FH
001183 DEB7 D4F9DE          17      CALL    NC,CHKATT
001186 DEBA D8              11      RET C
       DEBB                     KILLSX:
001187 DEBB 36E5            10      LD  (HL),0E5H   ;DIR
001189 DEBD CD51DF          17      CALL    WTDB
00118C DEC0 111A00          10      LD  DE,01AH
00118F DEC3 19              11      ADD HL,DE
001190 DEC4 5E               7      LD  E,(HL)
001191 DEC5 23               6      INC HL
001192 DEC6 56               7      LD  D,(HL)
       DEC7                     KILLS1:
001193 DEC7 CD4FDE          17      CALL    ENDCL
001196 DECA D0              11      RET NC      ;CF=0
001197 DECB 21FEFF          10      LD  HL,0-2
00119A DECE 19              11      ADD HL,DE
00119B DECF D0              11      RET NC      ;DE= 0 or 1
00119C DED0 D5              11      PUSH    DE
00119D DED1 CDF7F0          17      CALL    _GNCL
0011A0 DED4 ED53FEF1        20      LD  (_CLPS),DE
0011A4 DED8 D1              10      POP DE
0011A5 DED9 210000          10      LD  HL,0
0011A8 DEDC D4FAF0          17      CALL    NC,_SNCL
0011AB DEDF D8              11      RET C
0011AC DEE0 ED5BFEF1        20      LD  DE,(_CLPS)  ;FAT
0011B0 DEE4 18E1            12      JR  KILLS1
                                
       DEE6                     KILLW:
0011B2 DEE6 CD82DC          17      CALL    SOPEN
       DEE9                     KILLW1:
0011B5 DEE9 380B            12      JR  C,KILLW2
0011B7 DEEB CD21DD          17      CALL    SOPENE2
0011BA DEEE CDB5DE          17      CALL    KILLS
0011BD DEF1 CDE6DC          17      CALL    NOPEN
0011C0 DEF4 18F3            12      JR  KILLW1
       DEF6                     KILLW2:
0011C2 DEF6 C8              11      RET Z
0011C3 DEF7 3F               4      CCF
0011C4 DEF8 C9              10      RET
                                
       DEF9                     CHKATT:
0011C5 DEF9 E5              11      PUSH    HL
0011C6 DEFA 110B00          10      LD  DE,00BH
0011C9 DEFD 19              11      ADD HL,DE
0011CA DEFE A6               7      AND (HL)
0011CB DEFF E1              10      POP HL
0011CC DF00 C8              11      RET Z
0011CD DF01 37               4      SCF
0011CE DF02 C9              10      RET
                                
       DF03                     NAME:
0011CF DF03 CD77DF          17      CALL    CHKWILDX
0011D2 DF06 D8              11      RET C
0011D3 DF07 110400          10      LD  DE,4
0011D6 DF0A 19              11      ADD HL,DE
0011D7 DF0B 2220DF          16      LD  (NAMEP),HL
0011DA DF0E 23               6      INC HL
0011DB DF0F CD7BDF          17      CALL    CHKWILD
0011DE DF12 D8              11      RET C
                                
0011DF DF13 CD53DC          17      CALL    SOPENX
0011E2 DF16 3E0F             7      LD  A,00FH
0011E4 DF18 D4F9DE          17      CALL    NC,CHKATT
0011E7 DF1B D8              11      RET C
                                
0011E8 DF1C FDE5            15      PUSH    IY
0011EA DF1E FD210000        14      LD  IY,0        ;自己書き換え
       DF20                     NAMEP   EQU $-2
0011EE DF22 CD53DC          17      CALL    SOPENX
0011F1 DF25 FDE3            23      EX  (SP),IY
0011F3 DF27 3F               4      CCF
0011F4 DF28 D482DC          17      CALL    NC,SOPEN
0011F7 DF2B EB               4      EX  DE,HL
0011F8 DF2C E1              10      POP HL
0011F9 DF2D D8              11      RET C
                                
       DF2E                     SETNAME:
0011FA DF2E 01000B          10      LD  BC,11*256
0011FD DF31 23               6      INC HL
0011FE DF32 7E               7      LD  A,(HL)
0011FF DF33 FEE5             7      CP  0E5H
001201 DF35 2004            12      JR  NZ,SNAME1
001203 DF37 3E05             7      LD  A,5
001205 DF39 180E            12      JR  SNAME3
       DF3B                     SNAME1:
001207 DF3B 7E               7      LD  A,(HL)
001208 DF3C 0C               4      INC C
001209 DF3D 0D               4      DEC C
00120A DF3E 2009            12      JR  NZ,SNAME3
00120C DF40 CD57DE          17      CALL    CAP
00120F DF43 FEA0             7      CP  0A0H
001211 DF45 2002            12      JR  NZ,SNAME3
001213 DF47 3E20             7      LD  A,020H
       DF49                     SNAME3:
001215 DF49 12               7      LD  (DE),A
001216 DF4A 7E               7      LD  A,(HL)
001217 DF4B 23               6      INC HL
001218 DF4C CD64DF          17      CALL    FKAN
00121B DF4F 10EA            13      DJNZ    SNAME1
       DF51                     WTDB:
00121D DF51 3EFF             7      LD  A,0FFH
00121F DF53 3239F0          13      LD  (SFILE),A
001222 DF56 3E01             7      LD  A,1
001224 DF58 32A4F0          13      LD  (_WTDBF),A
001227 DF5B AF               4      XOR A
001228 DF5C C9              10      RET
                                
       DF5D                     FKANC:
001229 DF5D CB41             8      BIT 0,C
00122B DF5F CC60DE          17      CALL    Z,CAP2
00122E DF62 1801            12      JR  FKANX
       DF64                     FKAN:           ;漢字チェック
001230 DF64 13               6      INC DE
       DF65                     FKANX:
001231 DF65 CB41             8      BIT 0,C
001233 DF67 CB81             8      RES 0,C
001235 DF69 C0              11      RET NZ
001236 DF6A FE80             7      CP  080H
001238 DF6C D8              11      RET C
001239 DF6D FEA0             7      CP  0A0H
00123B DF6F 3803            12      JR  C,FKAN1
00123D DF71 FEE0             7      CP  0E0H
00123F DF73 D8              11      RET C
       DF74                     FKAN1:
001240 DF74 0C               4      INC C
001241 DF75 A7               4      AND A
001242 DF76 C9              10      RET
                                
       DF77                     CHKWILDX:
001243 DF77 FDE5            15      PUSH    IY
001245 DF79 E1              10      POP HL
001246 DF7A 23               6      INC HL
       DF7B                     CHKWILD:
001247 DF7B 060B             7      LD  B,11
001249 DF7D 3E3F             7      LD  A,'?'
       DF7F                     CHKWIL1:
00124B DF7F BE               7      CP  (HL)
00124C DF80 23               6      INC HL
00124D DF81 37               4      SCF
00124E DF82 C8              11      RET Z
00124F DF83 10FA            13      DJNZ    CHKWIL1
001251 DF85 AF               4      XOR A
001252 DF86 C9              10      RET
                                
       DF87                     SDIRENT:        ;IY=FCB HL=DIR
001253 DF87 D5              11      PUSH    DE
001254 DF88 E5              11      PUSH    HL
001255 DF89 FDE5            15      PUSH    IY
001257 DF8B D1              10      POP DE
001258 DF8C EB               4      EX  DE,HL
001259 DF8D CD2EDF          17      CALL    SETNAME
                                ;               Attribute
00125C DF90 FD7E0D          19      LD  A,(IY+13)   ;(FCB)属性(アトリビュート)
00125F DF93 12               7      LD  (DE),A
001260 DF94 13               6      INC DE
                                ;               Reserved
001261 DF95 AF               4      XOR A
001262 DF96 060A             7      LD  B,10
       DF98                     SDE1:
001264 DF98 12               7      LD  (DE),A
001265 DF99 13               6      INC DE
001266 DF9A 10FC            13      DJNZ    SDE1
                                                    ;(FCB)更新時刻
001268 DF9C 21E4F1          10      LD  HL,SDDATA       ;(FCB)更新年月日
00126B DF9F 060A             7      LD  B,SDDATAE-SDDATA    ;(FCB)ファイルの先頭クラスタ
       DFA1                     SDLOOP:                 ;(FCB)ファイルのサイズ(バイト単位)
00126D DFA1 7E               7      LD  A,(HL)
00126E DFA2 23               6      INC HL
00126F DFA3 32A8DF          13      LD  (SDPAT),A
001272 DFA6 FD7E00          19      LD  A,(IY+0)    ;LD A,(IY+A)
       DFA8                     SDPAT   EQU $-1
001275 DFA9 12               7      LD  (DE),A
001276 DFAA 13               6      INC DE
001277 DFAB 10F4            13      DJNZ    SDLOOP
                                
001279 DFAD AF               4      XOR A
00127A DFAE E1              10      POP HL
00127B DFAF D1              10      POP DE
00127C DFB0 C9              10      RET
                                
       DFB1                     WOPEN:
00127D DFB1 FD7E0D          19      LD  A,(IY+13)   ;(FCB)属性(アトリビュート)
001280 DFB4 E61F             7      AND 01FH
001282 DFB6 37               4      SCF
001283 DFB7 C0              11      RET NZ
001284 DFB8 FD361CFE        19      LD  (IY+28),0FEH    ;(FCB)オープンモード
       DFBC                     TOPEN2:
001288 DFBC AF               4      XOR A
       DFBD                     TOPEN:              ;Initializes the time stamp
001289 DFBD FD3617FF        19      LD  (IY+23),0FFH    ;(FCB)更新時刻
00128D DFC1 C9              10      RET
                                
       DFC2                     WRDFX:
00128E DFC2 3A36DE          13      LD  A,(SPCPAT)  ;1クラスタの論理セクタ
       DFC5                     L_WRFX:
001291 DFC5 1F               4      RRA         ;->CF
001292 DFC6 3806            12      JR  C,E_WRFX
001294 DFC8 CB39             8      SRL C
001296 DFCA CB1C             8      RR  H       ;CH=CH/2
001298 DFCC 18F7            12      JR  L_WRFX
       DFCE                     E_WRFX:
00129A DFCE 41               4      LD  B,C
00129B DFCF 4C               4      LD  C,H
00129C DFD0 03               6      INC BC
00129D DFD1 3E37             7      LD  A,037H      ;SCF
00129F DFD3 322EE4          13      LD  (DRDN1),A
                                
       DFD6                     WRDF:               ;BCクラスタ分FATを確保する
0012A2 DFD6 110200          10      LD  DE,2
0012A5 DFD9 AF               4      XOR A
0012A6 DFDA 32A5E5          13      LD  (_SECPS),A
       DFDD                     WRDF1:
0012A9 DFDD C5              11      PUSH    BC
0012AA DFDE D5              11      PUSH    DE
0012AB DFDF CDF7F0          17      CALL    _GNCL
0012AE DFE2 381C            12      JR  C,WRDF3
0012B0 DFE4 7A               4      LD  A,D     ;空いているかチェック
0012B1 DFE5 B3               4      OR  E
0012B2 DFE6 202A            12      JR  NZ,WRDF4
0012B4 DFE8 E1              10      POP HL      ;HL=空いているクラスタ
0012B5 DFE9 E5              11      PUSH    HL
0012B6 DFEA ED5BFEF1        20      LD  DE,(_CLPS)  ;DE=元の(_CLPS)
0012BA DFEE 22FEF1          16      LD  (_CLPS),HL
0012BD DFF1 7A               4      LD  A,D     ;元の(_CLPS)が 0 か?
0012BE DFF2 B3               4      OR  E
0012BF DFF3 2008            12      JR  NZ,WRDF2
0012C1 DFF5 FD751A          19      LD  (IY+26),L   ;(FCB)ファイルの先頭クラスタ
0012C4 DFF8 FD741B          19      LD  (IY+27),H   ;元が空の場合はFCBにクラスタをセットする
0012C7 DFFB 1803            12      JR  WRDF3
       DFFD                     WRDF2:
0012C9 DFFD CDFAF0          17      CALL    _SNCL
       E000                     WRDF3:
0012CC E000 D1              10      POP DE
0012CD E001 C1              10      POP BC
0012CE E002 D8              11      RET C
0012CF E003 0B               6      DEC BC
0012D0 E004 78               4      LD  A,B
0012D1 E005 B1               4      OR  C
0012D2 E006 200C            12      JR  NZ,WRDF5    ;ここでループカウンタチェック
0012D4 E008 ED5BFEF1        20      LD  DE,(_CLPS)
0012D8 E00C 21FFFF          10      LD  HL,0FFFFH   ;FATエントリ終了(EOCマーク)
0012DB E00F C3FAF0          10      JP  _SNCL
                                
       E012                     WRDF4:              ;DEクラスタが空じゃないので次に移動する
0012DE E012 D1              10      POP DE
0012DF E013 C1              10      POP BC
       E014                     WRDF5:
0012E0 E014 13               6      INC DE
0012E1 E015 CD4FDE          17      CALL    ENDCL
0012E4 E018 38C3            12      JR  C,WRDF1
0012E6 E01A 37               4      SCF
0012E7 E01B C9              10      RET
                                
       E01C                     RWXR:
0012E8 E01C 3A17E3          13      LD  A,(SECSZ+2) ;1024=4 / 512=2 / 256=1
       E01F                     L_RWX:
0012EB E01F 1F               4      RRA     ;->CF
0012EC E020 3808            12      JR  C,E_RWX
0012EE E022 CB38             8      SRL B   ;BCH=BCH/2
0012F0 E024 CB19             8      RR  C   ;
0012F2 E026 CB1C             8      RR  H   ;
0012F4 E028 18F5            12      JR  L_RWX
       E02A                     E_RWX:
0012F6 E02A FD5E1A          19      LD  E,(IY+26)   ;(FCB)ファイルの先頭クラスタ
0012F9 E02D FD561B          19      LD  D,(IY+27)
0012FC E030 AF               4      XOR A
0012FD E031 32A5E5          13      LD  (_SECPS),A
       E034                     RWX1:
001300 E034 ED53FEF1        20      LD  (_CLPS),DE
001304 E038 7A               4      LD  A,D
001305 E039 B3               4      OR  E
001306 E03A 2813            12      JR  Z,SCF_RET   ;RET DE==0 => CF=1
                                
001308 E03C 78               4      LD  A,B
001309 E03D B1               4      OR  C
00130A E03E B4               4      OR  H
00130B E03F C8              11      RET Z       ;RET BCH==0 => CF=0
                                
00130C E040 CDADE5          17      CALL    GNCLX
00130F E043 D8              11      RET C
001310 E044 7C               4      LD  A,H     ;
001311 E045 25               4      DEC H       ;
001312 E046 B7               4      OR  A       ;DEC BCH
001313 E047 2001            12      JR  NZ,RWX2     ;
001315 E049 0B               6      DEC BC      ;
       E04A                     RWX2:
001316 E04A CD4FDE          17      CALL    ENDCL
001319 E04D 38E5            12      JR  C,RWX1
       E04F                     SCF_RET:
00131B E04F 37               4      SCF
00131C E050 C9              10      RET
                                
       E051                     DSKF:
00131D E051 110000          10      LD  DE,0
       E052                     MAXCLP  EQU $-2
001320 E054 2AACF0          16      LD  HL,(_FAKEFREE)
001323 E057 7C               4      LD  A,H
001324 E058 B5               4      OR  L
001325 E059 2803            12      JR  Z,DSKF1
001327 E05B 110100          10      LD  DE,1
       E05E                     DSKF1:
00132A E05E D5              11      PUSH    DE
00132B E05F CDF7F0          17      CALL    _GNCL
00132E E062 380C            12      JR  C,POPSCF
001330 E064 7A               4      LD  A,D
001331 E065 B3               4      OR  E
001332 E066 2001            12      JR  NZ,DSKF2
001334 E068 23               6      INC HL
       E069                     DSKF2:
001335 E069 D1              10      POP DE
001336 E06A 1B               6      DEC DE
001337 E06B 7A               4      LD  A,D
001338 E06C B3               4      OR  E
001339 E06D 20EF            12      JR  NZ,DSKF1
00133B E06F C9              10      RET
                                
       E070                     POPSCF:
00133C E070 F1              10      POP AF
00133D E071 37               4      SCF
00133E E072 C9              10      RET
                                
       E073                     SETTMS:
00133F E073 FD7E17          19      LD  A,(IY+23)   ;(FCB)ファイルを最後に変更した時刻
001342 E076 3C               4      INC A
001343 E077 C0              11      RET NZ      ;ファイルが更新されていない
       E078                     SETTMSX:            ;FCBに日付時刻をセットする
001344 E078 CDB3D7          17      CALL    _SYS2C      ;(BDOS)時刻の獲得
                                                ;H←時  L←分  D←秒
001347 E07B CB25             8      SLA L       ;   *2
001349 E07D CB25             8      SLA L       ;   *4
00134B E07F 29              11      ADD HL,HL       ;*2 *8
00134C E080 29              11      ADD HL,HL       ;*4 *16
00134D E081 29              11      ADD HL,HL       ;*8 *32
00134E E082 7A               4      LD  A,D
00134F E083 0F               4      RRCA            ;bit.0->7->->->0->C
001350 E084 E61F             7      AND 01FH
001352 E086 B5               4      OR  L
001353 E087 FD7716          19      LD  (IY+22),A   ;(FCB)ファイルを最後に変更した時刻
001356 E08A FD7417          19      LD  (IY+23),H
                                
001359 E08D CDADD7          17      CALL    _SYS2A      ;(BDOS)日付の獲得
                                                ;HL←年  D←月  E←日
00135C E090 0144F8          10      LD  BC,0-1980
00135F E093 09              11      ADD HL,BC
001360 E094 65               4      LD  H,L
                                
001361 E095 7A               4      LD  A,D
001362 E096 87               4      ADD A,A     ;*2
001363 E097 87               4      ADD A,A     ;*4
001364 E098 87               4      ADD A,A     ;*8
001365 E099 87               4      ADD A,A     ;*16
001366 E09A 6F               4      LD  L,A
001367 E09B 29              11      ADD HL,HL       ;*32
001368 E09C 7D               4      LD  A,L
001369 E09D B3               4      OR  E
00136A E09E FD7714          19      LD  (IY+20),A   ;(FCB)ファイルを最後に変更した日付
00136D E0A1 FD7415          19      LD  (IY+21),H
001370 E0A4 C9              10      RET
                                
       E0A5                     PUSHRR:
001371 E0A5 3219E1          13      LD  (SETSEQ_SWC_RND),A
001374 E0A8 222BE1          16      LD  (SETSEQ_SWC_SEQ_RR),HL
001377 E0AB CDCBE0          17      CALL    GET_RR_AHL
00137A E0AE 220FF0          16      LD  (RR_BUF_HL),HL
00137D E0B1 3211F0          13      LD  (RR_BUF_A),A
001380 E0B4 C9              10      RET
                                
       E0B5                     GET_CPM_R_SIZE:     ;バイト単位からCP/Mのレコード単位を求める（1レコード=128バイト）
001381 E0B5 87               4      ADD A,A     ;in BHLA => out AHL
001382 E0B6 ED6A            15      ADC HL,HL
001384 E0B8 CB18             8      RR  B
001386 E0BA B7               4      OR  A
001387 E0BB 78               4      LD  A,B     ;ここでフラグは変化しない
001388 E0BC C8              11      RET Z
001389 E0BD 2C               4      INC L       ;INC AHL
00138A E0BE C0              11      RET NZ      ;
00138B E0BF 24               4      INC H       ;
00138C E0C0 C0              11      RET NZ      ;
00138D E0C1 3C               4      INC A       ;
00138E E0C2 C9              10      RET
                                
       E0C3                     INIT_RND:
00138F E0C3 3ECD             7      LD  A,0CDH      ;CALL ????
001391 E0C5 21EEE0          10      LD  HL,POPRR
001394 E0C8 CDA5E0          17      CALL    PUSHRR
       E0CB                     GET_RR_AHL:
001397 E0CB FD6E21          19      LD  L,(IY+33)   ;(FCB)Random record
00139A E0CE FD6622          19      LD  H,(IY+34)   ;
00139D E0D1 FD7E23          19      LD  A,(IY+35)   ;
0013A0 E0D4 C9              10      RET
       E0D5                     INIT_SEQ:
0013A1 E0D5 3E01             7      LD  A,1     ;LD BC,????
0013A3 E0D7 21EBE0          10      LD  HL,SETSEQ
0013A6 E0DA CDA5E0          17      CALL    PUSHRR
       E0DD                     GETSEQ:
0013A9 E0DD FD6E20          19      LD  L,(IY+32)   ;(FCB)カレントレコード
0013AC E0E0 FD660C          19      LD  H,(IY+12)   ;(FCB)カレントブロック
0013AF E0E3 AF               4      XOR A
                                
0013B0 E0E4 CB25             8      SLA L   ;L=L*2
                                
0013B2 E0E6 CB3C             8      SRL H   ;HL=HL/2
0013B4 E0E8 CB1D             8      RR  L   ;
0013B6 E0EA C9              10      RET
                                
       E0EB                     SETSEQ:
0013B7 E0EB CDF7E3          17      CALL    SETSEQ1
       E0EE                     POPRR:
0013BA E0EE F5              11      PUSH    AF
0013BB E0EF E5              11      PUSH    HL
0013BC E0F0 2A0FF0          16      LD  HL,(RR_BUF_HL)
0013BF E0F3 3A11F0          13      LD  A,(RR_BUF_A)
0013C2 E0F6 CDEDE3          17      CALL    SET_RR_AHL
0013C5 E0F9 E1              10      POP HL
0013C6 E0FA F1              10      POP AF
0013C7 E0FB C9              10      RET
                                
       E0FC                     RB_WRITE:
0013C8 E0FC C5              11      PUSH    BC
0013C9 E0FD ED4B4CF1        20      LD  BC,(STABLE+2*026H)  ;(BDOS)ランダムブロック書き込み
0013CD E101 1805            12      JR  RBRW
       E103                     RB_READ:
0013CF E103 C5              11      PUSH    BC
0013D0 E104 ED4B4EF1        20      LD  BC,(STABLE+2*027H)  ;(BDOS)ランダムブロック読み込み
       E108                     RBRW:
0013D4 E108 1F               4      RRA     ;AHL = AHL*128
0013D5 E109 7C               4      LD  A,H ;AHL = AHL0/2
0013D6 E10A 1F               4      RRA     ;A
0013D7 E10B 65               4      LD  H,L ;
0013D8 E10C CB1C             8      RR  H   ;H
0013DA E10E 2E00             7      LD  L,0 ;
0013DC E110 CB1D             8      RR  L   ;L
0013DE E112 CDEDE3          17      CALL    SET_RR_AHL
0013E1 E115 218000          10      LD  HL,128
0013E4 E118 C5              11      PUSH    BC
       E119                     SETSEQ_SWC_RND:
0013E5 E119 CDF7E3          17      CALL    SETSEQ1
0013E8 E11C C1              10      POP BC
0013E9 E11D FDCB20FE        23      SET 7,(IY+32)   ;(FCB)カレントレコード
0013ED E121 FDE5            15      PUSH    IY
0013EF E123 D1              10      POP DE
0013F0 E124 D5              11      PUSH    DE
0013F1 E125 CD33E1          17      CALL    JP_BC
0013F4 E128 FDE1            14      POP IY
0013F6 E12A CDEBE0          17      CALL    SETSEQ
       E12B                     SETSEQ_SWC_SEQ_RR   EQU $-2
0013F9 E12D FDCB20BE        23      RES 7,(IY+32)   ;(FCB)カレントレコード
                                
0013FD E131 C1              10      POP BC
0013FE E132 C9              10      RET
       E133                     JP_BC:
0013FF E133 C5              11      PUSH    BC
001400 E134 C9              10      RET
                                
       DCE0                     _SYS03  EQU SCF_FF_RET  ;(BDOS)外部入力
       DCE0                     _SYS2B  EQU SCF_FF_RET  ;(BDOS)日付の設定
       DCE0                     _SYS2D  EQU SCF_FF_RET  ;(BDOS)時刻の設定
       DCE0                     _SYS39  EQU SCF_FF_RET  ;(BDOS)サブディレクトリの作成
       DCE0                     _SYS3A  EQU SCF_FF_RET  ;(BDOS)サブディレクトリの削除
                                
[EOF:LDFILE.ASM:SHIFT_JIS]
                                    INCLUDE "LDFILE2.ASM"
                                
                                ;   LSX-Dodgers FILE2
                                
                                                ;Write random block
       E135                     _SYS26:     ;(BDOS)ランダムブロック書き込み
001401 E135 AF               4      XOR A
001402 E136 322EE4          13      LD  (DRDN1),A   ;NOP
001405 E139 225AE3          16      LD  (RBSIZE),HL ;HL←書き込むレコード数
001408 E13C 225DF0          16      LD  (LEFTX),HL
00140B E13F CD29DC          17      CALL    SETDRV
                                
00140E E142 CDB2E2          17      CALL    RBX0
001411 E145 DAD2E1          10      JP  C,RBWERR
001414 E148 CDB1DF          17      CALL    WOPEN
001417 E14B DAD2E1          10      JP  C,RBWERR
00141A E14E 7C               4      LD  A,H
00141B E14F B5               4      OR  L
00141C E150 CACBE1          10      JP  Z,RBW1
                                
00141F E153 2B               6      DEC HL
                                
001420 E154 CD70E3          17      CALL    GET_RR_BCDE ;BCDE=Random record
                                
001423 E157 19              11      ADD HL,DE       ;BCHL=HL+BCDE
001424 E158 3001            12      JR  NC,S26X1    ;
001426 E15A 03               6      INC BC      ;
       E15B                     S26X1:
001427 E15B CD1CE0          17      CALL    RWXR
00142A E15E DCC2DF          17      CALL    C,WRDFX
00142D E161 DAD2E1          10      JP  C,RBWERR
                                
001430 E164 CDE1E2          17      CALL    RBX2
001433 E167 281A            12      JR  Z,RBWB      ;NZ=セクタ以下の端数がある
001435 E169 CD00E3          17      CALL    RBXA
001438 E16C 3864            12      JR  C,RBWERR
00143A E16E EB               4      EX  DE,HL
00143B E16F C5              11      PUSH    BC
00143C E170 EDB0                    LDIR
00143E E172 225FF0          16      LD  (DTAX),HL
                                
001441 E175 CD51DF          17      CALL    WTDB        ;バッファデータは更新された
                                
001444 E178 2A5DF0          16      LD  HL,(LEFTX)
001447 E17B D1              10      POP DE
001448 E17C ED52            15      SBC HL,DE
00144A E17E 225DF0          16      LD  (LEFTX),HL
00144D E181 2831            12      JR  Z,RBWEND
                                
       E183                     RBWB:
00144F E183 CD35E3          17      CALL    RBXB
001452 E186 2814            12      JR  Z,RBWC
       E188                     RBWB1:
001454 E188 C5              11      PUSH    BC
001455 E189 D5              11      PUSH    DE
001456 E18A CD32DE          17      CALL    CLUSTX
001459 E18D CD84E3          17      CALL    DWTC
00145C E190 D1              10      POP DE
00145D E191 C1              10      POP BC
00145E E192 D4ADE5          17      CALL    NC,GNCLX
001461 E195 383B            12      JR  C,RBWERR
001463 E197 10EF            13      DJNZ    RBWB1
001465 E199 CDD4E3          17      CALL    DRW_FLUSH
       E19C                     RBWC:
001468 E19C CD4DE3          17      CALL    RBXC
00146B E19F 2813            12      JR  Z,RBWEND
00146D E1A1 C5              11      PUSH    BC
00146E E1A2 CD32DE          17      CALL    CLUSTX
001471 E1A5 CD2DE4          17      CALL    DRDN
001474 E1A8 C1              10      POP BC
001475 E1A9 3827            12      JR  C,RBWERR
001477 E1AB ED5B7EF1        20      LD  DE,(_DTBUF)
00147B E1AF EDB0                    LDIR
00147D E1B1 CD51DF          17      CALL    WTDB        ;バッファデータは更新された
       E1B4                     RBWEND:
001480 E1B4 CD59E3          17      CALL    RBXEND
                                
001483 E1B7 CDC1E2          17      CALL    RBX1
001486 E1BA 300F            12      JR  NC,RBW1     ;ランダムレコードの方が大きい場合はサイズを合わせる
001488 E1BC CD70E3          17      CALL    GET_RR_BCDE ;BCDE=Random record
00148B E1BF FD7310          19      LD  (IY+16),E   ;ファイルのサイズ(バイト単位)
00148E E1C2 FD7211          19      LD  (IY+17),D   ;
001491 E1C5 FD7112          19      LD  (IY+18),C   ;
001494 E1C8 FD7013          19      LD  (IY+19),B   ;
       E1CB                     RBW1:
001497 E1CB FDE1            14      POP IY
001499 E1CD C1              10      POP BC
00149A E1CE D1              10      POP DE
00149B E1CF E1              10      POP HL
       E1D0                     DD_NUL:
00149C E1D0 AF               4      XOR A
       E1D1                     DRDF0:
       E1D1                     DWTF0:
00149D E1D1 C9              10      RET
                                
       E1D2                     RBWERR:
00149E E1D2 FDE5            15      PUSH    IY
0014A0 E1D4 D1              10      POP DE
0014A1 E1D5 2A20F1          16      LD  HL,(STABLE+2*010H)
0014A4 E1D8 CD0F00          17      CALL    JP_HL
       E1DB                     RBRERR1:
0014A7 E1DB 3E01             7      LD  A,001H
       E1DD                     RBRERR2:
0014A9 E1DD FDE1            14      POP IY
0014AB E1DF C1              10      POP BC
0014AC E1E0 D1              10      POP DE
0014AD E1E1 E1              10      POP HL
0014AE E1E2 37               4      SCF
0014AF E1E3 210000          10      LD  HL,0
0014B2 E1E6 C9              10      RET
                                
       E1E7                     RBRERR:
0014B3 E1E7 3EFF             7      LD  A,0FFH
0014B5 E1E9 18F2            12      JR  RBRERR2
                                
       E1EB                     RBRFL:
0014B7 E1EB 3E00             7  RBRFLP: LD  A,000H
0014B9 E1ED FE0D             7      CP  00DH
0014BB E1EF 2005            12      JR  NZ,RBRFL1
0014BD E1F1 D5              11      PUSH    DE
0014BE E1F2 1E0A             7      LD  E,00AH
0014C0 E1F4 1805            12      JR  RBRFL2
       E1F6                     RBRFL1:
0014C2 E1F6 D5              11      PUSH    DE
0014C3 E1F7 CD09F0          17      CALL    _SYS07
0014C6 E1FA 5F               4      LD  E,A
       E1FB                     RBRFL2:
0014C7 E1FB CDCDF0          17      CALL    _PRINT
0014CA E1FE 7B               4      LD  A,E
0014CB E1FF D1              10      POP DE
0014CC E200 32ECE1          13      LD  (RBRFLP+1),A
0014CF E203 C9              10      RET
       E204                     DDX:
0014D0 E204 FD7E01          19      LD  A,(IY+1)    ;(FCB)主ファイル名
0014D3 E207 CD57DE          17      CALL    CAP
0014D6 E20A FE41             7      CP  'A'
0014D8 E20C C9              10      RET
                                
                                                ;Read random block
       E20D                     _SYS27:     ;(BDOS)ランダムブロック読み込み
0014D9 E20D 225DF0          16      LD  (LEFTX),HL
0014DC E210 CD29DC          17      CALL    SETDRV
                                
0014DF E213 FDCB0D66        20      BIT 4,(IY+13)   ;(FCB)属性(アトリビュート)
0014E3 E217 C2A0E2          10      JP  NZ,RBRDIR   ;ディレクトリ
0014E6 E21A CDB2E2          17      CALL    RBX0
0014E9 E21D DAE7E1          10      JP  C,RBRERR
0014EC E220 CDC1E2          17      CALL    RBX1
0014EF E223 D4D9E2          17      CALL    NC,RBX1R
0014F2 E226 DADBE1          10      JP  C,RBRERR1
0014F5 E229 EB               4      EX  DE,HL
0014F6 E22A ED52            15      SBC HL,DE       ;CP 00HL,BCDE
0014F8 E22C 19              11      ADD HL,DE
0014F9 E22D 79               4      LD  A,C
0014FA E22E DE00             7      SBC A,0
0014FC E230 78               4      LD  A,B
0014FD E231 DE00             7      SBC A,0
0014FF E233 3801            12      JR  C,RBR1
001501 E235 EB               4      EX  DE,HL
       E236                     RBR1:
001502 E236 9F               4      SBC A,A
001503 E237 E601             7      AND 1
001505 E239 329EE2          13      LD  (RBRA_SWC),A
                                
001508 E23C 7C               4      LD  A,H
001509 E23D B5               4      OR  L
00150A E23E 2857            12      JR  Z,RBREND0
                                
00150C E240 225AE3          16      LD  (RBSIZE),HL ;HL←読み込むレコード数
00150F E243 225DF0          16      LD  (LEFTX),HL
                                
001512 E246 CDE1E2          17      CALL    RBX2
001515 E249 2819            12      JR  Z,RBRB
001517 E24B CD00E3          17      CALL    RBXA
00151A E24E DAE7E1          10      JP  C,RBRERR
00151D E251 C5              11      PUSH    BC
00151E E252 EDB0                    LDIR
001520 E254 ED535FF0        20      LD  (DTAX),DE
001524 E258 2A5DF0          16      LD  HL,(LEFTX)
001527 E25B D1              10      POP DE
001528 E25C A7               4      AND A
001529 E25D ED52            15      SBC HL,DE
00152B E25F 225DF0          16      LD  (LEFTX),HL
00152E E262 2830            12      JR  Z,RBREND
                                
       E264                     RBRB:
001530 E264 CD35E3          17      CALL    RBXB
001533 E267 2815            12      JR  Z,RBRC
       E269                     RBRB1:
001535 E269 C5              11      PUSH    BC
001536 E26A D5              11      PUSH    DE
001537 E26B CD32DE          17      CALL    CLUSTX
00153A E26E CD8AE3          17      CALL    DRDC
00153D E271 D1              10      POP DE
00153E E272 C1              10      POP BC
00153F E273 D4ADE5          17      CALL    NC,GNCLX
001542 E276 DAE7E1          10      JP  C,RBRERR
001545 E279 10EE            13      DJNZ    RBRB1
001547 E27B CDD4E3          17      CALL    DRW_FLUSH
       E27E                     RBRC:
00154A E27E CD4DE3          17      CALL    RBXC
00154D E281 2811            12      JR  Z,RBREND
00154F E283 C5              11      PUSH    BC
001550 E284 CD32DE          17      CALL    CLUSTX
001553 E287 CD11E4          17      CALL    DRDX
001556 E28A C1              10      POP BC
001557 E28B DAE7E1          10      JP  C,RBRERR
00155A E28E EB               4      EX  DE,HL
00155B E28F 2A7EF1          16      LD  HL,(_DTBUF)
00155E E292 EDB0                    LDIR
       E294                     RBREND:
001560 E294 CD59E3          17      CALL    RBXEND
       E297                     RBREND0:
001563 E297 FDE1            14      POP IY
001565 E299 C1              10      POP BC
001566 E29A D1              10      POP DE
001567 E29B F1              10      POP AF  ;(HL)
001568 E29C AF               4      XOR A
001569 E29D 3E00             7      LD  A,000H
       E29E                     RBRA_SWC    EQU $-1
00156B E29F C9              10      RET
                                
       E2A0                     RBRDIR:
00156C E2A0 FD6E1A          19      LD  L,(IY+26)   ;(FCB)ファイルの先頭クラスタ
00156F E2A3 FD661B          19      LD  H,(IY+27)
001572 E2A6 CD6DDE          17      CALL    CHDIR
001575 E2A9 AF               4      XOR A
001576 E2AA 67               4      LD  H,A
001577 E2AB 6F               4      LD  L,A
001578 E2AC 3C               4      INC A
001579 E2AD 329EE2          13      LD  (RBRA_SWC),A
00157C E2B0 18E5            12      JR  RBREND0
                                
       E2B2                     RBX0:
00157E E2B2 2A8AF0          16      LD  HL,(_DTA)
001581 E2B5 225FF0          16      LD  (DTAX),HL
001584 E2B8 2A5DF0          16      LD  HL,(LEFTX)
001587 E2BB FD7E1C          19      LD  A,(IY+28)   ;(FCB)オープンモード
00158A E2BE D6FD             7      SUB 0FDH
00158C E2C0 C9              10      RET
                                
       E2C1                     RBX1:               ;ファイルサイズとランダムレコードを比べる
00158D E2C1 E5              11      PUSH    HL      ;Record byte
                                                ;AHL=File size
00158E E2C2 FD6E10          19      LD  L,(IY+16)   ;ファイルのサイズ(バイト単位)
001591 E2C5 FD6611          19      LD  H,(IY+17)   ;
001594 E2C8 FD7E12          19      LD  A,(IY+18)   ;
                                
001597 E2CB CD70E3          17      CALL    GET_RR_BCDE ;BCDE=Random record
                                
00159A E2CE A7               4      AND A
00159B E2CF ED52            15      SBC HL,DE
00159D E2D1 99               4      SBC A,C
00159E E2D2 4F               4      LD  C,A
00159F E2D3 FD7E13          19      LD  A,(IY+19)   ;ファイルのサイズ
0015A2 E2D6 98               4      SBC A,B
0015A3 E2D7 D1              10      POP DE
0015A4 E2D8 C9              10      RET
       E2D9                     RBX1R:
0015A5 E2D9 47               4      LD  B,A
0015A6 E2DA B1               4      OR  C
0015A7 E2DB EB               4      EX  DE,HL   ;BCDE=File byte HL=Record byte
0015A8 E2DC B2               4      OR  D
0015A9 E2DD B3               4      OR  E
0015AA E2DE C0              11      RET NZ
0015AB E2DF 37               4      SCF
0015AC E2E0 C9              10      RET
                                
       E2E1                     RBX2:               ;Cluster settings
0015AD E2E1 FD6622          19      LD  H,(IY+34)   ;(+33)(FCB)ランダムレコード
0015B0 E2E4 FD4E23          19      LD  C,(IY+35)
0015B3 E2E7 0600             7      LD  B,0
0015B5 E2E9 FDCB207E        20      BIT 7,(IY+32)   ;(FCB)カレントレコード
0015B9 E2ED 2003            12      JR  NZ,RBX3
0015BB E2EF FD4624          19      LD  B,(IY+36)
       E2F2                     RBX3:
0015BE E2F2 CD1CE0          17      CALL    RWXR
0015C1 E2F5 3A17E3          13      LD  A,(SECSZ+2) ;1024=4 / 512=2 / 256=1
0015C4 E2F8 3D               4      DEC A
0015C5 E2F9 FDA622          19      AND (IY+34)
0015C8 E2FC FDB621          19      OR  (IY+33)
0015CB E2FF C9              10      RET
                                
       E300                     RBXA:
0015CC E300 C5              11      PUSH    BC
0015CD E301 D5              11      PUSH    DE
0015CE E302 CD32DE          17      CALL    CLUSTX
0015D1 E305 CD11E4          17      CALL    DRDX
0015D4 E308 D1              10      POP DE
0015D5 E309 C1              10      POP BC
0015D6 E30A D4ADE5          17      CALL    NC,GNCLX
0015D9 E30D D8              11      RET C
0015DA E30E ED53FEF1        20      LD  (_CLPS),DE
                                
0015DE E312 FD4E21          19      LD  C,(IY+33)   ;(FCB)ランダムレコード
0015E1 E315 210004          10  SECSZ:  LD  HL,0400H    ;自己書き換え 1024=0400H / 512=0200H ここに1セクタのサイズが格納される
0015E4 E318 7C               4      LD  A,H
0015E5 E319 3D               4      DEC A       ;1024=3 / 512=1
0015E6 E31A FDA622          19      AND (IY+34)     ;(FCB)ランダムレコード
0015E9 E31D 47               4      LD  B,A     ;BCに1セクタ以下の端数が入る
0015EA E31E ED42            15      SBC HL,BC       ;残りを計算
                                
0015EC E320 ED5B5DF0        20      LD  DE,(LEFTX)
0015F0 E324 ED52            15      SBC HL,DE       ;CP HL,DE
0015F2 E326 19              11      ADD HL,DE       ;
0015F3 E327 3801            12      JR  C,RBXA1     ;DEとHLを比較して大きい方をHLに
0015F5 E329 EB               4      EX  DE,HL
       E32A                     RBXA1:
0015F6 E32A E5              11      PUSH    HL
0015F7 E32B 2A7EF1          16      LD  HL,(_DTBUF)
0015FA E32E 09              11      ADD HL,BC
0015FB E32F ED5B5FF0        20      LD  DE,(DTAX)
0015FF E333 C1              10      POP BC
001600 E334 C9              10      RET
                                
       E335                     RBXB:
001601 E335 2A5FF0          16      LD  HL,(DTAX)
001604 E338 ED5BFEF1        20      LD  DE,(_CLPS)
001608 E33C 3A5EF0          13      LD  A,(LEFTX+1)
00160B E33F 47               4      LD  B,A
00160C E340 3A17E3          13      LD  A,(SECSZ+2) ;1024=4 / 512=2 / 256=1
       E343                     RBXB1:
00160F E343 1F               4      RRA     ;->CF
001610 E344 3804            12      JR  C,RBXB2
001612 E346 CB38             8      SRL B   ;B=B/2
001614 E348 18F9            12      JR  RBXB1
       E34A                     RBXB2:
001616 E34A 78               4      LD  A,B
001617 E34B B7               4      OR  A
001618 E34C C9              10      RET
                                
       E34D                     RBXC:
001619 E34D ED4B5DF0        20      LD  BC,(LEFTX)
00161D E351 3A17E3          13      LD  A,(SECSZ+2) ;1024=4 / 512=2 / 256=1
001620 E354 3D               4      DEC A
001621 E355 A0               4      AND B
001622 E356 47               4      LD  B,A     ;1セクタ以下の端数がない場合はZ
001623 E357 B1               4      OR  C
001624 E358 C9              10      RET
                                
       E359                     RBXEND:             ;レコード数だけランダムレコードを進める
001625 E359 110000          10      LD  DE,0        ;進めるレコード数(RBSIZE)
       E35A                     RBSIZE  EQU $-2
001628 E35C CDCBE0          17      CALL    GET_RR_AHL
00162B E35F 19              11      ADD HL,DE
00162C E360 CE00             7      ADC A,0
00162E E362 CDEDE3          17      CALL    SET_RR_AHL
001631 E365 EB               4      EX  DE,HL       ;HL=進めるレコード数
001632 E366 D0              11      RET NC
001633 E367 FDCB207E        20      BIT 7,(IY+32)   ;(FCB)カレントレコード
001637 E36B C0              11      RET NZ
001638 E36C FD3424          23      INC (IY+36)
00163B E36F C9              10      RET
                                
       E370                     GET_RR_BCDE:            ;BCDE=Random record
00163C E370 FD5E21          19      LD  E,(IY+33)   ;(FCB)ランダムレコード
00163F E373 FD5622          19      LD  D,(IY+34)
001642 E376 FD4E23          19      LD  C,(IY+35)
001645 E379 0600             7      LD  B,0     ;CP/M互換のアクセスの場合はFCBは36バイト
001647 E37B FDCB207E        20      BIT 7,(IY+32)   ;(FCB)カレントレコード
00164B E37F C0              11      RET NZ
00164C E380 FD4624          19      LD  B,(IY+36)
00164F E383 C9              10      RET
                                
                                ;   ランダムブロックアクセスの連続したセクタをまとめる
                                
       E384                     DWTC:
001650 E384 E5              11      PUSH    HL
001651 E385 2143E7          10      LD  HL,DWT24B
001654 E388 1804            12      JR  DWTC1
       E38A                     DRDC:
001656 E38A E5              11      PUSH    HL
001657 E38B 2133E7          10      LD  HL,DRD24B
       E38E                     DWTC1:
00165A E38E 22E8E3          16      LD  (DRWF_MODE),HL
00165D E391 E1              10      POP HL
00165E E392 3AD8E3          13      LD  A,(DRWF_B)
001661 E395 B7               4      OR  A
001662 E396 200F            12      JR  NZ,DRDC1
       E398                     SAVE_DRWC:
001664 E398 0601             7      LD  B,1
001666 E39A ED43D7E3        20      LD  (DRWF_C),BC
00166A E39E ED53DEE3        20      LD  (DRWF_E),DE
00166E E3A2 22E1E3          16      LD  (DRWF_HL),HL
001671 E3A5 1820            12      JR  INC_HL_DRWC
       E3A7                     DRDC1:
001673 E3A7 E5              11      PUSH    HL
001674 E3A8 21DEE3          10      LD  HL,DRWF_E
001677 E3AB 86               7      ADD A,(HL)
001678 E3AC F5              11      PUSH    AF
001679 E3AD BB               4      CP  E
00167A E3AE 201D            12      JR  NZ,DRDC2
00167C E3B0 F1              10      POP AF
00167D E3B1 23               6      INC HL
00167E E3B2 7E               7      LD  A,(HL)
00167F E3B3 CE00             7      ADC A,0
001681 E3B5 F5              11      PUSH    AF
001682 E3B6 BA               4      CP  D
001683 E3B7 2014            12      JR  NZ,DRDC2
001685 E3B9 F1              10      POP AF
001686 E3BA 3AD7E3          13      LD  A,(DRWF_C)
001689 E3BD CE00             7      ADC A,0
00168B E3BF B9               4      CP  C
00168C E3C0 200C            12      JR  NZ,DRDC3
00168E E3C2 21D8E3          10      LD  HL,DRWF_B
001691 E3C5 34              11      INC (HL)
001692 E3C6 E1              10      POP HL
       E3C7                     INC_HL_DRWC:
001693 E3C7 3A17E3          13      LD  A,(SECSZ+2)     ;1セクタのサイズの上位1バイト
001696 E3CA 84               4      ADD A,H
001697 E3CB 67               4      LD  H,A
001698 E3CC C9              10      RET
       E3CD                     DRDC2:
001699 E3CD F1              10      POP AF
       E3CE                     DRDC3:
00169A E3CE CDD4E3          17      CALL    DRW_FLUSH
00169D E3D1 E1              10      POP HL
00169E E3D2 18C4            12      JR  SAVE_DRWC
                                
                                ;   ランダムブロックアクセスの連続したセクタをまとめたものをフラッシュする
       E3D4                     DRW_FLUSH:
0016A0 E3D4 C5              11      PUSH    BC
0016A1 E3D5 D5              11      PUSH    DE
0016A2 E3D6 010000          10      LD  BC,0
       E3D7                     DRWF_C  EQU $-2
       E3D8                     DRWF_B  EQU $-1
0016A5 E3D9 78               4      LD  A,B
0016A6 E3DA B7               4      OR  A
0016A7 E3DB 280D            12      JR  Z,DRDF1
0016A9 E3DD 110000          10      LD  DE,0
       E3DE                     DRWF_E  EQU $-2
       E3DF                     DRWF_D  EQU $-1
0016AC E3E0 210000          10      LD  HL,0
       E3E1                     DRWF_HL EQU $-2
0016AF E3E3 AF               4      XOR A
0016B0 E3E4 32D8E3          13      LD  (DRWF_B),A
0016B3 E3E7 CD33E7          17      CALL    DRD24B
       E3E8                     DRWF_MODE   EQU $-2
       E3EA                     DRDF1:
0016B6 E3EA D1              10      POP DE
0016B7 E3EB C1              10      POP BC
0016B8 E3EC C9              10      RET
                                
       E3ED                     SET_RR_AHL:
0016B9 E3ED FD7521          19      LD  (IY+33),L   ;(FCB)Random record
0016BC E3F0 FD7422          19      LD  (IY+34),H
0016BF E3F3 FD7723          19      LD  (IY+35),A
0016C2 E3F6 C9              10      RET
                                
       E3F7                     SETSEQ1:
0016C3 E3F7 F5              11      PUSH    AF
0016C4 E3F8 E5              11      PUSH    HL      ;AHL=Random record
0016C5 E3F9 CDCBE0          17      CALL    GET_RR_AHL
0016C8 E3FC 47               4      LD  B,A     ;AHL→HLA
0016C9 E3FD 7D               4      LD  A,L     ;(IY+33)(FCB)ランダムレコード
0016CA E3FE 6C               4      LD  L,H     ;(IY+34)
0016CB E3FF 60               4      LD  H,B     ;(IY+35)
0016CC E400 0600             7      LD  B,0
                                
0016CE E402 CDB5E0          17      CALL    GET_CPM_R_SIZE
                                
0016D1 E405 29              11      ADD HL,HL
0016D2 E406 CB3D             8      SRL L       ;L=L/2
0016D4 E408 FD7520          19      LD  (IY+32),L   ;(FCB)カレントレコード
0016D7 E40B FD740C          19      LD  (IY+12),H   ;(FCB)カレントブロック
0016DA E40E E1              10      POP HL
0016DB E40F F1              10      POP AF
0016DC E410 C9              10      RET
[EOF:LDFILE2.ASM:SHIFT_JIS]
                                    INCLUDE "LDDIO.ASM"
                                
                                ;   LSX-Dodgers DIO
                                
       E411                     DRDX:
0016DD E411 CD4FE4          17      CALL    DRDY
0016E0 E414 C8              11      RET Z
0016E1 E415 CD35E4          17      CALL    DRDX1       ;データバッファの情報を保存
0016E4 E418 D8              11      RET C
0016E5 E419 E5              11      PUSH    HL
0016E6 E41A C5              11      PUSH    BC
0016E7 E41B D5              11      PUSH    DE
0016E8 E41C 2A7EF1          16      LD  HL,(_DTBUF)
0016EB E41F 3A78E4          13      LD  A,(_DBS24)
0016EE E422 4F               4      LD  C,A
0016EF E423 CD31E7          17      CALL    DRD24
0016F2 E426 DC4AE4          17      CALL    C,DRDNE
       E429                     POP_DE_BC_HL_RET:
0016F5 E429 D1              10      POP DE
0016F6 E42A C1              10      POP BC
0016F7 E42B E1              10      POP HL
0016F8 E42C C9              10      RET
                                
                                ;   CDE:セクタ番号
       E42D                     DRDN:
0016F9 E42D AF               4      XOR A
0016FA E42E 00               4  DRDN1:  NOP         ;自己書き換え NOP / SCF
0016FB E42F 30E0            12      JR  NC,DRDX
       E431                     DRDNX:
0016FD E431 CD4FE4          17      CALL    DRDY
001700 E434 C8              11      RET Z
       E435                     DRDX1:
001701 E435 CD65E4          17      CALL    DWTX
                                                ;データバッファの読み込んだドライブ・セクタ情報を保存
001704 E438 ED53A6F0        20      LD  (_DBSEC),DE
001708 E43C 79               4      LD  A,C
001709 E43D 3278E4          13      LD  (_DBS24),A
                                
00170C E440 3A88F0          13      LD  A,(_DRV)
00170F E443 32A5F0          13      LD  (_DBDRV),A
001712 E446 CDD9F0          17      CALL    _CHGDRV
001715 E449 D0              11      RET NC
       E44A                     DRDNE:
001716 E44A 9F               4      SBC A,A     ;CF=1ならばA=0FFH
001717 E44B 32A5F0          13      LD  (_DBDRV),A
00171A E44E C9              10      RET
                                
                                ;   CDE:セクタ番号
       E44F                     DRDY:
00171B E44F 3A78E4          13      LD  A,(_DBS24)
00171E E452 B9               4      CP  C
00171F E453 C0              11      RET NZ
                                
001720 E454 E5              11      PUSH    HL
001721 E455 3A88F0          13      LD  A,(_DRV)
001724 E458 21A5F0          10      LD  HL,_DBDRV
001727 E45B AE               7      XOR (HL)
001728 E45C 2005            12      JR  NZ,POP_HL_RET
                                
00172A E45E 2AA6F0          16      LD  HL,(_DBSEC)
00172D E461 ED52            15      SBC HL,DE       ;上でXORを使っているのでCF=0のはず
       E463                     POP_HL_RET:
00172F E463 E1              10      POP HL
001730 E464 C9              10      RET
                                
       E465                     DWTX:
001731 E465 3AA4F0          13      LD  A,(_WTDBF)
001734 E468 B7               4      OR  A
001735 E469 C8              11      RET Z
001736 E46A AF               4      XOR A
001737 E46B 32A4F0          13      LD  (_WTDBF),A
                                
00173A E46E E5              11      PUSH    HL
00173B E46F C5              11      PUSH    BC
00173C E470 D5              11      PUSH    DE
00173D E471 3AA5F0          13      LD  A,(_DBDRV)
001740 E474 CDD9F0          17      CALL    _CHGDRV
001743 E477 0E00             7      LD  C,0
       E478                     _DBS24  EQU $-1
001745 E479 ED5BA6F0        20      LD  DE,(_DBSEC)
001749 E47D 2A7EF1          16      LD  HL,(_DTBUF)
00174C E480 D441E7          17      CALL    NC,DWT24
       E483                     POP_DE_BC_HL_RET2:
00174F E483 18A4            12      JR  POP_DE_BC_HL_RET
                                
       E485                     RDFATX:
001751 E485 E5              11      PUSH    HL
001752 E486 3A88F0          13      LD  A,(_DRV)
001755 E489 21AAF0          10      LD  HL,_FATDRV
001758 E48C AE               7      XOR (HL)
001759 E48D 28D4            12      JR  Z,POP_HL_RET
                                
00175B E48F C5              11      PUSH    BC
00175C E490 D5              11      PUSH    DE
00175D E491 DDE5            15      PUSH    IX
00175F E493 CDAFE4          17      CALL    WTFATX
001762 E496 3813            12      JR  C,POP_IX_DE_BC_HL_RET
                                
001764 E498 AF               4      XOR A
001765 E499 32ABF0          13      LD  (_FATIX),A
001768 E49C 3A88F0          13      LD  A,(_DRV)
00176B E49F 32AAF0          13      LD  (_FATDRV),A
00176E E4A2 CDE5F0          17      CALL    _RDFAT
       E4A5                     RDFATE2:
001771 E4A5 3004            12      JR  NC,POP_IX_DE_BC_HL_RET
001773 E4A7 9F               4      SBC A,A     ;A=0xFF
001774 E4A8 32AAF0          13      LD  (_FATDRV),A
       E4AB                     POP_IX_DE_BC_HL_RET:
001777 E4AB DDE1            14      POP IX
001779 E4AD 18D4            12      JR  POP_DE_BC_HL_RET2
                                
       E4AF                     WTFATX:
00177B E4AF 3AA2F0          13      LD  A,(_WTFATF)
00177E E4B2 B7               4      OR  A
00177F E4B3 C8              11      RET Z
001780 E4B4 E5              11      PUSH    HL
001781 E4B5 3AAAF0          13      LD  A,(_FATDRV)
001784 E4B8 21A5F0          10      LD  HL,_DBDRV
001787 E4BB AE               7      XOR (HL)
001788 E4BC CC65E4          17      CALL    Z,DWTX
00178B E4BF 38A2            12      JR  C,POP_HL_RET
00178D E4C1 C5              11      PUSH    BC
00178E E4C2 D5              11      PUSH    DE
00178F E4C3 DDE5            15      PUSH    IX
001791 E4C5 CD4EE7          17      CALL    WTFAT
001794 E4C8 AF               4      XOR A
001795 E4C9 32A2F0          13      LD  (_WTFATF),A
001798 E4CC 18DD            12      JR  POP_IX_DE_BC_HL_RET
                                
       E4CE                     N16CL1:
00179A E4CE 7A               4      LD  A,D
00179B E4CF B3               4      OR  E
00179C E4D0 37               4      SCF
00179D E4D1 C8              11      RET Z
                                
00179E E4D2 7A               4      LD  A,D
00179F E4D3 1807            12      JR  NCL1X
       E4D5                     NCL1:
0017A1 E4D5 7A               4      LD  A,D
0017A2 E4D6 B3               4      OR  E
0017A3 E4D7 37               4      SCF
0017A4 E4D8 C8              11      RET Z
                                
0017A5 E4D9 7A               4      LD  A,D
0017A6 E4DA CB3F             8      SRL A   ;/2
       E4DC                     NCL1X:
0017A8 E4DC CB3F             8      SRL A   ;/2
                                
0017AA E4DE E5              11      PUSH    HL
0017AB E4DF 32FEE4          13      LD  (NCLPAT_FATIX),A    ;_FATIX
0017AE E4E2 2AAAF0          16      LD  HL,(_FATDRV)    ;L=_FATDRV H=_FATIX
0017B1 E4E5 BC               4      CP  H
0017B2 E4E6 3A88F0          13      LD  A,(_DRV)    ;LDではフラグは変化しない
0017B5 E4E9 32FDE4          13      LD  (NCLPAT_FATDRV),A   ;_FATDRV
0017B8 E4EC 2005            12      JR  NZ,NCL2     ;FATIXが違う
0017BA E4EE BD               4      CP  L
0017BB E4EF 2002            12      JR  NZ,NCL2     ;ドライブが違う
0017BD E4F1 E1              10      POP HL
0017BE E4F2 C9              10      RET
       E4F3                     NCL2:
0017BF E4F3 C5              11      PUSH    BC
0017C0 E4F4 D5              11      PUSH    DE
0017C1 E4F5 DDE5            15      PUSH    IX
0017C3 E4F7 CDAFE4          17      CALL    WTFATX
0017C6 E4FA 38AF            12      JR  C,POP_IX_DE_BC_HL_RET
0017C8 E4FC 010000          10      LD  BC,0        ;自己書き換え C=_FATDRV B=_FATIX
       E4FE                     NCLPAT_FATIX    EQU $-1
       E4FD                     NCLPAT_FATDRV   EQU $-2
0017CB E4FF ED43AAF0        20      LD  (_FATDRV),BC
0017CF E503 CD23E7          17      CALL    RDFATS
0017D2 E506 189D            12      JR  RDFATE2
                                
       E508                     NCL3:
0017D4 E508 CB9A             8      RES 3,D
0017D6 E50A CB92             8      RES 2,D
0017D8 E50C 6B               4      LD  L,E
0017D9 E50D 62               4      LD  H,D
0017DA E50E CB3C             8      SRL H   ;
0017DC E510 CB1D             8      RR  L   ;HLA=HLA/2
0017DE E512 1F               4      RRA     ;
0017DF E513 F5              11      PUSH    AF
0017E0 E514 3AABF0          13      LD  A,(_FATIX)
0017E3 E517 0F               4      RRCA
0017E4 E518 300B            12      JR  NC,NCL3X1
0017E6 E51A 3A17E3          13      LD  A,(SECSZ+2)
0017E9 E51D FE04             7      CP  4       ;1セクタ1024バイトの場合は奇数インデックスの場合に先頭を512バイトずらす
0017EB E51F 2004            12      JR  NZ,NCL3X1
0017ED E521 010002          10      LD  BC,512
0017F0 E524 09              11      ADD HL,BC
       E525                     NCL3X1:
0017F1 E525 F1              10      POP AF
0017F2 E526 ED4B7CF1        20      LD  BC,(_FATBF)
0017F6 E52A 19              11      ADD HL,DE
0017F7 E52B 09              11      ADD HL,BC
0017F8 E52C 17               4      RLA
0017F9 E52D C9              10      RET
                                
       E52E                     GNCL:
0017FA E52E CDD5E4          17      CALL    NCL1        ;GET NEXT CLUSTER
0017FD E531 D8              11      RET C
0017FE E532 C5              11      PUSH    BC
0017FF E533 E5              11      PUSH    HL
001800 E534 CD08E5          17      CALL    NCL3
001803 E537 3809            12      JR  C,GNC1
001805 E539 5E               7      LD  E,(HL)
001806 E53A 23               6      INC HL
001807 E53B 7E               7      LD  A,(HL)
001808 E53C E60F             7      AND 00FH
00180A E53E 57               4      LD  D,A
00180B E53F E1              10      POP HL
00180C E540 C1              10      POP BC
00180D E541 C9              10      RET
       E542                     GNC1:
00180E E542 7E               7      LD  A,(HL)
00180F E543 23               6      INC HL
001810 E544 56               7      LD  D,(HL)
001811 E545 0604             7      LD  B,4
       E547                     GNC1L:
001813 E547 CB3A             8      SRL D   ;DA=DA/2
001815 E549 1F               4      RRA     ;
001816 E54A 10FB            13      DJNZ    GNC1L
                                
001818 E54C 5F               4      LD  E,A
001819 E54D E1              10      POP HL
00181A E54E C1              10      POP BC
00181B E54F A7               4      AND A
00181C E550 C9              10      RET
                                
       E551                     SNCL:
00181D E551 CDD5E4          17      CALL    NCL1
001820 E554 D8              11      RET C
                                ;               SET NEXT CLUSTER
001821 E555 E5              11      PUSH    HL
001822 E556 C5              11      PUSH    BC
001823 E557 D5              11      PUSH    DE
001824 E558 E5              11      PUSH    HL
001825 E559 CD08E5          17      CALL    NCL3
001828 E55C D1              10      POP DE
                                ;CF=ODD
001829 E55D 7E               7      LD  A,(HL)
00182A E55E 73               7      LD  (HL),E
00182B E55F 3806            12      JR  C,SNC1
                                ;EVEN
                                ;M[0] = E
                                ;M[1] = (M[1] & 0xF0) | (D & 0x0F)
00182D E561 23               6      INC HL
00182E E562 ED67            18      RRD     ;M={A[3:0],E[3:0]}
001830 E564 7A               4      LD  A,D
001831 E565 1804            12      JR  SNC11
       E567                     SNC1:
                                ;ODD
                                ;HL[0] = (HL[0]&0x0F) | (E<<4)
                                ;HL[1] = DE>>4
001833 E567 ED6F            18      RLD     ;M={D[3:0],E[7:4]}
001835 E569 23               6      INC HL
001836 E56A 72               7      LD  (HL),D  ;M={D[3:0],E[7:4]}
       E56B                     SNC11:
001837 E56B ED6F            18      RLD     ;M={M[7:4],D[3:0]}
001839 E56D B7               4      OR  A
00183A E56E D1              10      POP DE
00183B E56F C1              10      POP BC
00183C E570 E1              10      POP HL
       E571                     FAT_CHANGED:
00183D E571 3E01             7      LD  A,1
00183F E573 32A2F0          13      LD  (_WTFATF),A
001842 E576 C9              10      RET
                                
       E577                     N16CL3:
001843 E577 C5              11      PUSH    BC
001844 E578 6B               4      LD  L,E
001845 E579 7A               4      LD  A,D
001846 E57A E601             7      AND 1
001848 E57C 67               4      LD  H,A
001849 E57D 29              11      ADD HL,HL
00184A E57E ED4B7CF1        20      LD  BC,(_FATBF)
00184E E582 09              11      ADD HL,BC
00184F E583 C1              10      POP BC
001850 E584 C9              10      RET
                                
       E585                     GNCL16:
001851 E585 CDCEE4          17      CALL    N16CL1      ;GET NEXT CLUSTER for FAT16
001854 E588 D8              11      RET C
001855 E589 E5              11      PUSH    HL
001856 E58A CD77E5          17      CALL    N16CL3
001859 E58D 5E               7      LD  E,(HL)
00185A E58E 23               6      INC HL
00185B E58F 56               7      LD  D,(HL)
00185C E590 E1              10      POP HL
00185D E591 C9              10      RET
                                
       E592                     SNCL16:
00185E E592 CDCEE4          17      CALL    N16CL1      ;GET NEXT CLUSTER for FAT16
001861 E595 D8              11      RET C
001862 E596 D5              11      PUSH    DE
001863 E597 E5              11      PUSH    HL
001864 E598 CD77E5          17      CALL    N16CL3
001867 E59B D1              10      POP DE      ;HL
001868 E59C 73               7      LD  (HL),E
001869 E59D 23               6      INC HL
00186A E59E 72               7      LD  (HL),D
00186B E59F 6B               4      LD  L,E
00186C E5A0 62               4      LD  H,D
00186D E5A1 D1              10      POP DE
00186E E5A2 18CD            12      JR  FAT_CHANGED
                                
                                ;------------------------
                                ;次のセクタを探す際に_SECPSの値をチェック
                                ;in
                                ;   DE : セクタ番号
                                ;out
                                ;   DE : 次のセクタ番号
                                ;note
                                ;
                                ;------------------------
       E5A4                     NEXTX:
001870 E5A4 3E00             7      LD  A,0 ;自己書き換え
       E5A5                     _SECPS  EQU $-1
001872 E5A6 3C               4      INC A
001873 E5A7 E600             7      AND 0   ;自己書き換え　1クラスタの論理セクタ数-1
       E5A8                     _NCPAT  EQU $-1
001875 E5A9 32A5E5          13      LD  (_SECPS),A
001878 E5AC C9              10      RET
                                
       E5AD                     GNCLX:
001879 E5AD CDA4E5          17      CALL    NEXTX
00187C E5B0 C0              11      RET NZ  ;1クラスタのセクタ未満の場合は戻る
00187D E5B1 C3F7F0          10      JP  _GNCL   ;次のクラスタを探す
                                
       E5B4                     RDFAT:
001880 E5B4 3E80             7      LD  A,080H
001882 E5B6 3270F0          13      LD  (CHECK),A
       E5B9                     RDFAT1:
001885 E5B9 3A88F0          13      LD  A,(_DRV)
001888 E5BC CD5DE8          17      CALL    CHGDRVR
00188B E5BF D8              11      RET C
00188C E5C0 DD7E12          19      LD  A,(IX+DPB_DEVICE)
00188F E5C3 CB6F             8      BIT 5,A
001891 E5C5 286C            12      JR  Z,RDFAT0X
001893 E5C7 2170F0          10      LD  HL,CHECK
001896 E5CA A6               7      AND (HL)
001897 E5CB 77               7      LD  (HL),A
001898 E5CC 110000          10      LD  DE,0        ;BPB
00189B E5CF 2A7CF1          16      LD  HL,(_FATBF)
00189E E5D2 CD2FE7          17      CALL    DRD16
0018A1 E5D5 3024            12      JR  NC,GETBPB
0018A3 E5D7 2170F0          10      LD  HL,CHECK
0018A6 E5DA CB06            15      RLC (HL)
0018A8 E5DC 3F               4      CCF
0018A9 E5DD D8              11      RET C
0018AA E5DE DDCB0A1E        23      RR  (IX+DPB_FDMODE)
0018AE E5E2 3F               4      CCF         ;フロッピーディスクのFDモードを切り替える
0018AF E5E3 DDCB0A16        23      RL  (IX+DPB_FDMODE)
0018B3 E5E7 3EFF             7      LD  A,0FFH
0018B5 E5E9 3289F0          13      LD  (_DSK),A
0018B8 E5EC 3A84F0          13      LD  A,(_DRIVE)
0018BB E5EF E603             7      AND 3
0018BD E5F1 F680             7      OR  080H
0018BF E5F3 6F               4      LD  L,A
0018C0 E5F4 26F0             7      LD  H,_CYL0/256
0018C2 E5F6 3EFF             7      LD  A,0FFH
0018C4 E5F8 77               7      LD  (HL),A
0018C5 E5F9 18BE            12      JR  RDFAT1
       E5FB                     GETBPB:
0018C7 E5FB FDE5            15      PUSH    IY
0018C9 E5FD FD2A7CF1        20      LD  IY,(_FATBF) ;BPB
0018CD E601 CDF1F0          17      CALL    _BPB2DPB
0018D0 E604 FDE1            14      POP IY
0018D2 E606 DD7E12          19      LD  A,(IX+DPB_DEVICE)
0018D5 E609 3025            12      JR  NC,GETBPBOK
0018D7 E60B E60F             7      AND 00FH
0018D9 E60D FE07             7      CP  7
0018DB E60F 37               4      SCF
0018DC E610 C0              11      RET NZ
0018DD E611 DDCB0A46        20      BIT 0,(IX+DPB_FDMODE)
0018E1 E615 21C0F1          10      LD  HL,M2D
0018E4 E618 2006            12      JR  NZ,SETFDMODE
0018E6 E61A CD08E7          17      CALL    CHECK1024
0018E9 E61D D8              11      RET C
0018EA E61E 2ED2             7      LD  L,M2HD-STABLE
       E620                     SETFDMODE:
0018EC E620 DDE5            15      PUSH    IX
0018EE E622 D1              10      POP DE
0018EF E623 EDA0            16      LDI
0018F1 E625 EDA0            16      LDI
0018F3 E627 13               6      INC DE
0018F4 E628 13               6      INC DE
0018F5 E629 13               6      INC DE
0018F6 E62A 13               6      INC DE
0018F7 E62B 010C00          10      LD  BC,12
0018FA E62E EDB0                    LDIR
       E630                     GETBPBOK:
0018FC E630 CDC9E7          17      CALL    CHGDRV2
       E633                     RDFAT0X:
0018FF E633 CD23E7          17      CALL    RDFATS
001902 E636 D8              11      RET C
001903 E637 DDAE06          19      XOR (IX+DPB_FATID)
001906 E63A C8              11      RET Z
001907 E63B DDCB126E        20      BIT 5,(IX+DPB_DEVICE)
00190B E63F C0              11      RET NZ      ;BPBを取得している場合はFATIDをチェックしない
00190C E640 37               4      SCF
00190D E641 C9              10      RET
                                
       E642                     POP_HL_SCF_RET:
00190E E642 E1              10      POP HL
00190F E643 37               4      SCF
001910 E644 C9              10      RET
                                
       E645                     BPB2DPB:
001911 E645 FD7E0B          19      LD  A,(IY+11)   ;BPB_BytsPerSec
001914 E648 B7               4      OR  A
001915 E649 37               4      SCF
001916 E64A C0              11      RET NZ
       E64B                     BPBOK:
001917 E64B FD7E0D          19      LD  A,(IY+13)   ;BPB_SecPerClus
00191A E64E DD7707          19      LD  (IX+DPB_SECPCL),A
                                
00191D E651 FD7E16          19      LD  A,(IY+22)   ;BPB_FATSz16
001920 E654 DD7700          19      LD  (IX+DPB_FATLN),A
001923 E657 FD7E17          19      LD  A,(IY+23)   ;BPB_FATSz16
001926 E65A DD7701          19      LD  (IX+DPB_FATLN+1),A
                                
001929 E65D FD6E0E          19      LD  L,(IY+14)   ;BPB_RsvdSecCnt
00192C E660 FD660F          19      LD  H,(IY+15)
00192F E663 DD750E          19      LD  (IX+DPB_FATPS),L
001932 E666 FD5E16          19      LD  E,(IY+22)   ;BPB_FATSz16
001935 E669 FD5617          19      LD  D,(IY+23)
001938 E66C FD4610          19      LD  B,(IY+16)   ;BPB_NumFATs
       E66F                     BPBDP1:             ;BPB_FATSz16 * BPB_NumFATs
00193B E66F 19              11      ADD HL,DE
00193C E670 10FD            13      DJNZ    BPBDP1
       E672                     BPBDP2:
00193E E672 DD7510          19      LD  (IX+DPB_DIRPS),L
001941 E675 DD7411          19      LD  (IX+DPB_DIRPS+1),H
001944 E678 E5              11      PUSH    HL
                                
001945 E679 FD6E11          19      LD  L,(IY+17)   ;BPB_RootEntCnt
001948 E67C FD6612          19      LD  H,(IY+18)
00194B E67F FD7E0C          19      LD  A,(IY+12)   ;BPB_BytsPerSec
00194E E682 B7               4      OR  A
00194F E683 28BD            12      JR  Z,POP_HL_SCF_RET
001951 E685 0606             7      LD  B,6
       E687                     BPBBPS1:
001953 E687 05               4      DEC B
001954 E688 0F               4      RRCA
001955 E689 30FC            12      JR  NC,BPBBPS1
       E68B                     BPBDE1:
001957 E68B 29              11      ADD HL,HL
001958 E68C 10FD            13      DJNZ    BPBDE1
                                
00195A E68E 7C               4      LD  A,H
00195B E68F DD770B          19      LD  (IX+DPB_DIRSCNT),A  ;
                                
00195E E692 D1              10      POP DE      ;DPB_DIRPS
00195F E693 6C               4      LD  L,H
001960 E694 2600             7      LD  H,0
001962 E696 19              11      ADD HL,DE       ;MAXDIR
001963 E697 E5              11      PUSH    HL
001964 E698 FD4E0D          19      LD  C,(IY+13)   ;BPB_SecPerClus
001967 E69B CB21             8      SLA C       ;*2
001969 E69D AF               4      XOR A
00196A E69E 47               4      LD  B,A
00196B E69F ED42            15      SBC HL,BC
00196D E6A1 DD7514          19      LD  (IX+DPB_ADDCL),L
001970 E6A4 DD7415          19      LD  (IX+DPB_ADDCL+1),H
                                
001973 E6A7 D1              10      POP DE      ;DE=DPB_MAXDIR
001974 E6A8 FD6E13          19      LD  L,(IY+19)   ;BPB_TotSec16
001977 E6AB FD6614          19      LD  H,(IY+20)
                                
00197A E6AE DD7E12          19      LD  A,(IX+DPB_DEVICE)
00197D E6B1 E60F             7      AND 00FH
00197F E6B3 FE07             7      CP  7       ;フロッピー
001981 E6B5 2019            12      JR  NZ,NOT_FD
001983 E6B7 E5              11      PUSH    HL
001984 E6B8 FD4E18          19      LD  C,(IY+24)   ;BPB_SecPerTr
001987 E6BB DD710D          19      LD  (IX+DPB_MAXSEC),C
00198A E6BE AF               4      XOR A
00198B E6BF CB21             8      SLA C       ;両面なのでセクタ数を２倍
00198D E6C1 0610             7      LD  B,16
       E6C3                     DIVSEC:             ;MAXCYL = BPB_TotSec16 / (BPB_SecPerTr * 2)
00198F E6C3 29              11      ADD HL,HL
001990 E6C4 17               4      RLA
001991 E6C5 B9               4      CP  C
001992 E6C6 3802            12      JR  C,DIVSEC1
001994 E6C8 91               4      SUB C
001995 E6C9 2C               4      INC L
       E6CA                     DIVSEC1:
001996 E6CA 10F7            13      DJNZ    DIVSEC
001998 E6CC DD750C          19      LD  (IX+DPB_MAXCYL),L
00199B E6CF E1              10      POP HL  ;ここまでフロッピー専用
       E6D0                     NOT_FD:
00199C E6D0 7C               4      LD  A,H
00199D E6D1 B5               4      OR  L
00199E E6D2 3E00             7      LD  A,0     ;LDでフラグは変化しない。BPB_TotSec16を AHL で扱う為、Aに0を入れる
0019A0 E6D4 200E            12      JR  NZ,BPB16BIT ;BPB_TotSec16が「0」の場合はBPB_TotSec32で計算
0019A2 E6D6 2F               4      CPL         ;A=0FFH
0019A3 E6D7 FD8623          19      ADD A,(IY+35)   ;念のために総セクタ数が24ビットを超える場合はエラーを返す
0019A6 E6DA D8              11      RET C
0019A7 E6DB FD6E20          19      LD  L,(IY+32)   ;BPB_TotSec32 は AHL の24ビットで扱う
0019AA E6DE FD6621          19      LD  H,(IY+33)   ;1クラスタの論理セクタ数(DPB_SECPCL)が最大128なので、
0019AD E6E1 FD7E22          19      LD  A,(IY+34)   ;FAT12,FAT16では総セクタ数が24ビットを超えることは無い
       E6E4                     BPB16BIT:
0019B0 E6E4 ED52            15      SBC HL,DE       ;DE=DPB_MAXDIR
0019B2 E6E6 DE00             7      SBC A,0
0019B4 E6E8 FD460D          19      LD  B,(IY+13)   ;BPB_SecPerClus
       E6EB                     BPBTC1:             ;総クラスタ数(AHL) = 総セクタ数(AHL) / セクタサイズ(B)
0019B7 E6EB CB18             8      RR  B       ;->CY
0019B9 E6ED 3808            12      JR  C,BPBTC2
0019BB E6EF CB3F             8      SRL A
0019BD E6F1 CB1C             8      RR  H       ;AHL=AHL/2
0019BF E6F3 CB1D             8      RR  L
0019C1 E6F5 18F4            12      JR  BPBTC1
       E6F7                     BPBTC2:
0019C3 E6F7 C6FF             7      ADD A,0FFH
0019C5 E6F9 D8              11      RET C       ;念のため(クラスタ数が16ビットを超える場合)
0019C6 E6FA 23               6      INC HL
0019C7 E6FB 23               6      INC HL
0019C8 E6FC DD7508          19      LD  (IX+DPB_MAXCL),L
0019CB E6FF DD7409          19      LD  (IX+DPB_MAXCL+1),H
                                
0019CE E702 FD7E15          19      LD  A,(IY+21)   ;BPB_Media
0019D1 E705 DD7706          19      LD  (IX+DPB_FATID),A
       E708                     CHECK1024:
0019D4 E708 FD7E10          19      LD  A,(IY+16)   ;BPB_NumFATs
0019D7 E70B C6FE             7      ADD A,0-2       ;>2:CF=1
0019D9 E70D FD7E0C          19      LD  A,(IY+12)   ;BPB_BytsPerSec
0019DC E710 6F               4      LD  L,A
0019DD E711 3002            12      JR  NC,BPBFAT1
0019DF E713 F680             7      OR  080H
       E715                     BPBFAT1:            ;ここではCF=0
0019E1 E715 DD770F          19      LD  (IX+DPB_BPS),A
0019E4 E718 3A7BF1          13      LD  A,(_MAX_SEC_SZ_H)
0019E7 E71B BD               4      CP  L
0019E8 E71C C8              11      RET Z       ;1セクタ1024バイト
0019E9 E71D 2D               4      DEC L       ;以下のセクタサイズに合致しない場合はCF=1でエラーにする
0019EA E71E C8              11      RET Z       ;1セクタ256バイト
0019EB E71F 2D               4      DEC L
0019EC E720 C8              11      RET Z       ;1セクタ512バイト
0019ED E721 37               4      SCF
0019EE E722 C9              10      RET
                                
       E723                     RDFATS:
0019EF E723 CD54E7          17      CALL    FATSETUP
0019F2 E726 D8              11      RET C
0019F3 E727 CD33E7          17      CALL    DRD24B
0019F6 E72A 2A7CF1          16      LD  HL,(_FATBF)
0019F9 E72D 7E               7      LD  A,(HL)
0019FA E72E C9              10      RET
                                
       E72F                     DRD16:
0019FB E72F 0E00             7      LD  C,0
       E731                     DRD24:
0019FD E731 0601             7      LD  B,1
       E733                     DRD24B:
0019FF E733 DDE5            15      PUSH    IX
001A01 E735 DD2AA8F0        20      LD  IX,(_DPB)
001A05 E739 CDA1E9          17      CALL    FDRD        ;自己書き換え（ディスク読み込み）
       E73A                     DRDPAT  EQU $-2
       E73C                     POP_IX_RET:
001A08 E73C DDE1            14      POP IX
001A0A E73E C9              10      RET
                                
       E73F                     DWT16:
001A0B E73F 0E00             7      LD  C,0
       E741                     DWT24:
001A0D E741 0601             7      LD  B,1
       E743                     DWT24B:
001A0F E743 DDE5            15      PUSH    IX
001A11 E745 DD2AA8F0        20      LD  IX,(_DPB)
001A15 E749 CD4AE9          17      CALL    FDWT        ;自己書き換え（ディスク書き込み）
       E74A                     DWTPAT  EQU $-2
001A18 E74C 18EE            12      JR  POP_IX_RET
                                
       E74E                     WTFAT:
001A1A E74E CD54E7          17      CALL    FATSETUP
001A1D E751 30F0            12      JR  NC,DWT24B
001A1F E753 C9              10      RET
                                ;   CALL    NC,DWT24B   ;予備FATの保存ルーチン
                                ;   RET C
                                ;   BIT 7,(IX+DPB_BPS)
                                ;   RET Z       ;予備FATが無い
                                ;   CALL    FATS2
                                ;   PUSH    HL      ;予備FAT
                                ;   LD  L,(IX+DPB_FATLN)
                                ;   LD  H,(IX+DPB_FATLN+1)
                                ;   ADD HL,DE
                                ;   EX  DE,HL
                                ;   POP HL
                                ;   JR  DWT24B
                                ;------------------------
                                ;FATのセットアップ
                                ;out
                                ;   B  : FATセクタ数
                                ;   DE : FAT先頭セクタ番号
                                ;   HL : FATバッファポインタ
                                ;   CF : 1=ドライブ切り替えエラー
                                ;note
                                ;   FATサイズがFATバッファを超える場合は
                                ;   対象クラスタ領域==(_FATIX)によって
                                ;   FAT12:対象クラスタ1024毎に1.5KBを切り替える
                                ;   FAT16:対象クラスタ512毎に1KBを切り替える
                                ;------------------------
       E754                     FATSETUP:
001A20 E754 3AAAF0          13      LD  A,(_FATDRV)
001A23 E757 CD5DE8          17      CALL    CHGDRVR     ;ドライブ切り替え
001A26 E75A D8              11      RET C
       E75B                     FATS2:
001A27 E75B DD7E0F          19      LD  A,(IX+DPB_BPS)  ;512=2 1024=4
001A2A E75E 0F               4      RRCA
001A2B E75F CD8FE7          17      CALL    FATSETUP12  ;自己書き換え
       E760                     FATSX   EQU $-2
001A2E E762 210000          10      LD  HL,0
001A31 E765 4A               4      LD  C,D
001A32 E766 54               4      LD  D,H
001A33 E767 3AABF0          13      LD  A,(_FATIX)  ;範囲FAT12:0-3/FAT16:0-127(0-07FH):65535*2/1024
001A36 E76A 47               4      LD  B,A
001A37 E76B 04               4      INC B
001A38 E76C DD7E00          19      LD  A,(IX+DPB_FATLN)
       E76F                     FAT_SKP:
001A3B E76F 05               4      DEC B
001A3C E770 2809            12      JR  Z,FAT1
001A3E E772 19              11      ADD HL,DE
001A3F E773 93               4      SUB E
001A40 E774 30F9            12      JR  NC,FAT_SKP
001A42 E776 DDCB0146        20      BIT 0,(IX+DPB_FATLN+1)  ;FATサイズが0100H(256)の場合
001A46 E77A C8              11      RET Z
       E77B                     FAT1:
001A47 E77B EB               4      EX  DE,HL
001A48 E77C B7               4      OR  A       ;0の場合は0100Hとして扱う
001A49 E77D 2803            12      JR  Z,FAT3
001A4B E77F B9               4      CP  C       ;C=FATバッファに読み込めるセクタ数
001A4C E780 3801            12      JR  C,FAT2
       E782                     FAT3:
001A4E E782 79               4      LD  A,C
       E783                     FAT2:
001A4F E783 47               4      LD  B,A
                                
001A50 E784 2AFAF1          16      LD  HL,(_FATPS) ;fat sector pos
001A53 E787 19              11      ADD HL,DE
001A54 E788 EB               4      EX  DE,HL
001A55 E789 2A7CF1          16      LD  HL,(_FATBF)
001A58 E78C AF               4      XOR A       ;CF=0
001A59 E78D 4F               4      LD  C,A
001A5A E78E C9              10      RET
                                ;
                                ;   FATバッファに読み込める最大のセクタ数と_FATIXで進めるセクタ数
                                ;   FATSETUP* (FAT12/FAT16)
                                ;out
                                ;   D : FATバッファに読み込める最大のセクタ数
                                ;   E : _FATIXで進めるセクタ数
       E78F                     FATSETUP12:
001A5B E78F 110606          10      LD  DE,0606H    ;256
001A5E E792 D8              11      RET C
001A5F E793 110303          10      LD  DE,0303H    ;512
001A62 E796 0F               4      RRCA
001A63 E797 D8              11      RET C
001A64 E798 110102          10      LD  DE,0201H    ;1024
001A67 E79B C9              10      RET
                                
       E79C                     FATSETUP16:
001A68 E79C 110404          10      LD  DE,0404H    ;256
001A6B E79F D8              11      RET C
001A6C E7A0 110202          10      LD  DE,0202H    ;512
001A6F E7A3 0F               4      RRCA
001A70 E7A4 D8              11      RET C
001A71 E7A5 110101          10      LD  DE,0101H    ;1024
001A74 E7A8 C9              10      RET
                                
       E7A9                     CHGDRV:
001A75 E7A9 E5              11      PUSH    HL
001A76 E7AA 2189F0          10      LD  HL,_DSK
001A79 E7AD BE               7      CP  (HL)
001A7A E7AE 280A            12      JR  Z,CHGDRVE
       E7B0                     CHGDRV1:
001A7C E7B0 DDE5            15      PUSH    IX
001A7E E7B2 CDBCE7          17      CALL    CHGDRV0
001A81 E7B5 3A89F0          13      LD  A,(_DSK)
001A84 E7B8 DDE1            14      POP IX
       E7BA                     CHGDRVE:
001A86 E7BA E1              10      POP HL
001A87 E7BB C9              10      RET
                                
       E7BC                     CHGDRV0:
001A88 E7BC 6F               4      LD  L,A
001A89 E7BD CDDCF0          17      CALL    _GETDPB
001A8C E7C0 D8              11      RET C
001A8D E7C1 DD22A8F0        20      LD  (_DPB),IX
001A91 E7C5 7D               4      LD  A,L
001A92 E7C6 3289F0          13      LD  (_DSK),A
       E7C9                     CHGDRV2:
001A95 E7C9 C5              11      PUSH    BC
001A96 E7CA D5              11      PUSH    DE
001A97 E7CB ED7314E8        20      LD  (SPPAT2),SP
001A9B E7CF F3               4      DI
001A9C E7D0 DDF9            10      LD  SP,IX
                                
001A9E E7D2 E1              10      POP HL      ;00:DPB_FATLN
001A9F E7D3 E1              10      POP HL      ;02:DPB_DRD
001AA0 E7D4 223AE7          16      LD  (DRDPAT),HL
                                
001AA3 E7D7 E1              10      POP HL
001AA4 E7D8 224AE7          16      LD  (DWTPAT),HL ;04:DPB_DWT
                                
001AA7 E7DB E1              10      POP HL      ;L=06:DPB_FATID H=07:DPB_SECPCL
001AA8 E7DC 7C               4      LD  A,H
001AA9 E7DD 3236DE          13      LD  (SPCPAT),A  ;1クラスタの論理セクタ数
001AAC E7E0 3D               4      DEC A
001AAD E7E1 32A8E5          13      LD  (_NCPAT),A
                                
001AB0 E7E4 E1              10      POP HL      ;08:DPB_MAXCL
001AB1 E7E5 7D               4      LD  A,L
001AB2 E7E6 3255DE          13      LD  (CLPAT2),A
001AB5 E7E9 7C               4      LD  A,H
001AB6 E7EA 3251DE          13      LD  (CLPAT1),A
001AB9 E7ED 2B               6      DEC HL
001ABA E7EE 2252E0          16      LD  (MAXCLP),HL
                                
001ABD E7F1 E1              10      POP HL      ;L=0A:DPB_FDMODE H=0B:DPB_DIRSCNT
001ABE E7F2 4C               4      LD  C,H
                                
001ABF E7F3 E1              10      POP HL      ;L=0C:DPB_MAXCYL H=0D:DPB_MAXSEC
                                
001AC0 E7F4 E1              10      POP HL      ;L=0E:DPB_FATPS H=0F:DPB_BPS
001AC1 E7F5 7C               4      LD  A,H     ;DPB_BPS
001AC2 E7F6 E607             7      AND 7
001AC4 E7F8 3217E3          13      LD  (SECSZ+2),A ;1セクタのサイズの上位1バイト 0x400 - 0x200 - 0x100
                                                ;1セクタ512 2D/2DD/2HC/2HQ(2HD1.44MB)/EMM/BRAM/EMEM等
                                                ;1セクタ1024 2HD/2HDE98等
                                                ;1セクタ256 GRAM/RAMF/CMOS等
                                                ;1024   512 256
                                                ;4  2   1
001AC7 E7FB 87               4      ADD A,A     ;8  4   2
001AC8 E7FC 87               4      ADD A,A     ;010H   8   4
001AC9 E7FD 87               4      ADD A,A     ;020H   010H    8
001ACA E7FE 32B3DC          13      LD  (SDECPAT),A ;1セクタ辺りのディレクトリエントリ数
                                
001ACD E801 2600             7      LD  H,0
001ACF E803 22FAF1          16      LD  (_FATPS),HL
                                
001AD2 E806 E1              10      POP HL      ;10:DPB_DIRPS
001AD3 E807 22FCF1          16      LD  (_DIRPS),HL
                                
001AD6 E80A E1              10      POP HL      ;L=12:DPB_DEVICE H=13:DPB_UNITNO
001AD7 E80B 7C               4      LD  A,H
001AD8 E80C 3284F0          13      LD  (_DRIVE),A
                                
001ADB E80F E1              10      POP HL      ;14:DPB_ADDCL
001ADC E810 2246DE          16      LD  (CLSPAT),HL
                                
001ADF E813 310000          10      LD  SP,0        ;元のSPを復元
       E814                     SPPAT2  EQU $-2
001AE2 E816 FB               4      EI
001AE3 E817 2AFCF1          16      LD  HL,(_DIRPS)
001AE6 E81A 0600             7      LD  B,0
001AE8 E81C 09              11      ADD HL,BC       ;C=DPB_DIRSCNT
001AE9 E81D 22CEDC          16      LD  (MD_PAT),HL
                                
001AEC E820 2A52E0          16      LD  HL,(MAXCLP)
001AEF E823 110AF0          10      LD  DE,0-4086   ;クラスタ数が4086未満:FAT12 4086以上:FAT16
001AF2 E826 19              11      ADD HL,DE
001AF3 E827 380F            12      JR  C,SETFAT16
001AF5 E829 212EE5          10      LD  HL,GNCL     ;FAT12
001AF8 E82C 1151E5          10      LD  DE,SNCL
001AFB E82F 018FE7          10      LD  BC,FATSETUP12
001AFE E832 DDCB0FAE        23      RES 5,(IX+DPB_BPS)  ;DPB_BPS(FAT12)
001B02 E836 180D            12      JR  EXTRA1
       E838                     SETFAT16:
001B04 E838 2185E5          10      LD  HL,GNCL16   ;FAT16
001B07 E83B 1192E5          10      LD  DE,SNCL16
001B0A E83E 019CE7          10      LD  BC,FATSETUP16
001B0D E841 DDCB0FEE        23      SET 5,(IX+DPB_BPS)  ;DPB_BPS(FAT16)
       E845                     EXTRA1:
001B11 E845 22F8F0          16      LD  (GNCPAT),HL
001B14 E848 ED53FBF0        20      LD  (SNCPAT),DE
001B18 E84C ED4360E7        20      LD  (FATSX),BC
001B1C E850 D1              10      POP DE
001B1D E851 C1              10      POP BC
001B1E E852 AF               4      XOR A
001B1F E853 C9              10      RET
                                
       E854                     GETDPBD:
001B20 E854 DDE3            23      EX  (SP),IX
001B22 E856 DDE5            15      PUSH    IX
001B24 E858 3A88F0          13      LD  A,(_DRV)
001B27 E85B 1807            12      JR  GETDPB1
                                
       E85D                     CHGDRVR:
001B29 E85D CDD9F0          17      CALL    _CHGDRV
001B2C E860 D8              11      RET C
001B2D E861 3A89F0          13      LD  A,(_DSK)
       E864                     GETDPB1:
001B30 E864 C3DCF0          10      JP  _GETDPB
                                
       E867                     GETDPB:
001B33 E867 FE08             7      CP  8
001B35 E869 3F               4      CCF
001B36 E86A D8              11      RET C
001B37 E86B 0F               4      RRCA
001B38 E86C 0F               4      RRCA
001B39 E86D 0F               4      RRCA
001B3A E86E DD                      DB  0DDH        ;Z80未定義命令
001B3B E86F 6F               4      LD  L,A     ;LD IXL,A
001B3C E870 DD                      DB  0DDH        ;Z80未定義命令
001B3D E871 26F2             7      LD  H,_DEVICE/256   ;LD IXH,_DEVICE/256
001B3F E873 DD7E00          19      LD  A,(IX+DPB_FATLN)
001B42 E876 A7               4      AND A       ;CF=0の為
001B43 E877 DDCB0F6E        20      BIT 5,(IX+DPB_BPS)
001B47 E87B C0              11      RET NZ      ;FAT16
001B48 E87C DDCB126E        20      BIT 5,(IX+DPB_DEVICE)
001B4C E880 C0              11      RET NZ      ;BPB
001B4D E881 FE01             7      CP  001H        ;A=0 THEN CF=1
001B4F E883 C9              10      RET
                                
       E884                     _SYS5F:
001B50 E884 AF               4      XOR A
       E885                     FFLUSH:
001B51 E885 F5              11      PUSH    AF
001B52 E886 CDAFE4          17      CALL    WTFATX
001B55 E889 AF               4      XOR A
001B56 E88A 32ABF0          13      LD  (_FATIX),A
001B59 E88D 2F               4      CPL         ;0FFH
001B5A E88E 32AAF0          13      LD  (_FATDRV),A
001B5D E891 3E                      DB  03EH        ;次のPUSH AFをスキップ
       E892                     FFLUSHBUF:
001B5E E892 F5              11      PUSH    AF
001B5F E893 CD65E4          17      CALL    DWTX
001B62 E896 3EFF             7      LD  A,0FFH
001B64 E898 3239F0          13      LD  (SFILE),A
001B67 E89B 32A5F0          13      LD  (_DBDRV),A
001B6A E89E F1              10      POP AF
001B6B E89F C9              10      RET
                                
[EOF:LDDIO.ASM:SHIFT_JIS]
                                    INCLUDE "M7DISK.ASM"
                                
                                ;   LSX-Dodgers DISK
                                ;   MZ-700/1500
                                
       E8A0                     SEEK:
001B6C E8A0 0610             7      LD  B,16
001B6E E8A2 DD4E0D          19      LD  C,(IX+DPB_MAXSEC)
001B71 E8A5 AF               4      XOR A
001B72 E8A6 EB               4      EX  DE,HL
       E8A7                     DIV1:
001B73 E8A7 29              11      ADD HL,HL
001B74 E8A8 8F               4      ADC A,A
001B75 E8A9 B9               4      CP  C
001B76 E8AA 3802            12      JR  C,DIV2
001B78 E8AC 91               4      SUB C
001B79 E8AD 2C               4      INC L
       E8AE                     DIV2:
001B7A E8AE 10F7            13      DJNZ    DIV1
                                
001B7C E8B0 3C               4      INC A   ;最小のセクタは１固定
001B7D E8B1 55               4      LD  D,L ;TRACK
001B7E E8B2 5F               4      LD  E,A ;SECTOR
                                
001B7F E8B3 3A84F0          13      LD  A,(_DRIVE)
001B82 E8B6 FE04             7      CP  4
001B84 E8B8 3F               4      CCF
001B85 E8B9 D8              11      RET C
001B86 E8BA F684             7      OR  084H        ;Motor on + ドライブセレクト有効
001B88 E8BC D3DC            11      OUT (0DCH),A    ;モータ/ドライブセレクト制御レジスタ
001B8A E8BE CB3A             8      SRL D       ;CYLINDER
001B8C E8C0 9F               4      SBC A,A
001B8D E8C1 D3DD            11      OUT (0DDH),A    ;ヘッドセレクト制御レジスタ
                                
001B8F E8C3 CDFFE8          17      CALL    SETMODE
001B92 E8C6 D8              11      RET C
                                
001B93 E8C7 CD34E9          17      CALL    DRIVE
001B96 E8CA FEFF             7      CP  0FFH        ;A=0FFH Unknown CYLINDER
001B98 E8CC CC16E9          17      CALL    Z,FDCRES    ;Restore
001B9B E8CF 2F               4      CPL         ;データバスが負論理
001B9C E8D0 D3D9            11      OUT (0D9H),A    ;MB8876 トラックレジスタ
001B9E E8D2 2F               4      CPL         ;データバスが負論理
001B9F E8D3 92               4      SUB D
001BA0 E8D4 C8              11      RET Z       ;No seek
                                
001BA1 E8D5 3A86F0          13      LD  A,(_ISEEK)
001BA4 E8D8 4F               4      LD  C,A
                                
001BA5 E8D9 DD7E0C          19      LD  A,(IX+DPB_MAXCYL)
001BA8 E8DC 3D               4      DEC A
001BA9 E8DD BA               4      CP  D       ;Over CYLINDER
001BAA E8DE D8              11      RET C
                                
001BAB E8DF 7A               4      LD  A,D
001BAC E8E0 2F               4      CPL         ;データバスが負論理
001BAD E8E1 D3DB            11      OUT (0DBH),A    ;MB8876 データレジスタ
001BAF E8E3 72               7      LD  (HL),D
                                
001BB0 E8E4 0E18             7      LD  C,018H      ;FDC TypeIコマンド Seek
       E8E6                     FDCCMD2:
001BB2 E8E6 3A85F0          13      LD  A,(_SEEKSP)
001BB5 E8E9 B1               4      OR  C
                                
       E8EA                     FDCCMD:
001BB6 E8EA CD2BE9          17      CALL    COMSET
001BB9 E8ED 3E80             7      LD  A,080H      ;FDC COMMAND(Self-modifying code)
       E8EE                     FDCSMC  EQU $-1
001BBB E8EF E620             7      AND 020H        ;Write data Write track
001BBD E8F1 3C               4      INC A
                                
       E8F2                     SST:
001BBE E8F2 0E00             7      LD  C,0
       E8F4                     SST1:
001BC0 E8F4 0D               4      DEC C       ; 4
001BC1 E8F5 20FD            12      JR  NZ,SST1     ;12 * 256 / 4 = About 1ms
001BC3 E8F7 3D               4      DEC A
001BC4 E8F8 20FA            12      JR  NZ,SST1
                                
001BC6 E8FA 0E01             7      LD  C,1
001BC8 E8FC CD04E9          17      CALL    READY
       E8FF                     SETMODE:
001BCB E8FF CD2EE9          17      CALL    DELAY0      ;Head select time
001BCE E902 0E81             7      LD  C,081H
       E904                     READY:
001BD0 E904 0680             7      LD  B,128
       E906                     READY2:
001BD2 E906 DBD8            11      IN  A,(0D8H)    ;MB8876 ステータス/コマンドレジスタ
001BD4 E908 2F               4      CPL         ;データバスが負論理
001BD5 E909 A1               4      AND C       ;NOT READY,BUSY
001BD6 E90A C8              11      RET Z
001BD7 E90B CD1BCF          17      CALL    RD556VSYNC
001BDA E90E 07               4      RLCA
001BDB E90F A8               4      XOR B
001BDC E910 0F               4      RRCA
001BDD E911 30F3            12      JR  NC,READY2
001BDF E913 10F1            13      DJNZ    READY2
001BE1 E915 C9              10      RET
                                
       E916                     FDCRES:
001BE2 E916 3600            10      LD  (HL),0
001BE4 E918 0E08             7      LD  C,8
001BE6 E91A 18CA            12      JR  FDCCMD2
                                
       E91C                     FDMOFF:
001BE8 E91C F5              11      PUSH    AF
001BE9 E91D AF               4      XOR A       ;Motor off(ドライブセレクト無効)
001BEA E91E D3DC            11      OUT (0DCH),A    ;モータ/ドライブセレクト制御レジスタ
001BEC E920 F1              10      POP AF
001BED E921 C9              10      RET
                                
       E922                     SECSET_FDCCMD:
001BEE E922 3AEEE8          13      LD  A,(FDCSMC)
       E925                     SECSET:
001BF1 E925 F5              11      PUSH    AF
001BF2 E926 7B               4      LD  A,E
001BF3 E927 2F               4      CPL         ;データバスが負論理
001BF4 E928 D3DA            11      OUT (0DAH),A    ;MB8876 セクタレジスタ
001BF6 E92A F1              10      POP AF
       E92B                     COMSET:
001BF7 E92B 2F               4      CPL         ;データバスが負論理
001BF8 E92C D3D8            11      OUT (0D8H),A    ;MB8876 ステータス/コマンドレジスタ
       E92E                     DELAY0:
001BFA E92E 3E1A             7      LD  A,26
       E930                     DELAY:
001BFC E930 3D               4      DEC A
001BFD E931 20FD            12      JR  NZ,DELAY
001BFF E933 C9              10      RET
                                
       E934                     DRIVE:
001C00 E934 2A84F0          16      LD  HL,(_DRIVE)
001C03 E937 26F0             7      LD  H,_CYL0/256
001C05 E939 CBFD             8      SET 7,L
001C07 E93B 7E               7      LD  A,(HL)
001C08 E93C C9              10      RET
                                
       E93D                     RNF:
001C09 E93D CD34E9          17      CALL    DRIVE
001C0C E940 36FF            10      LD  (HL),0FFH
001C0E E942 C9              10      RET
                                
001C0F E943 02                  RETRY:  DB  2
                                
                                
                                ;   FLOPPY DISK DRIVER
                                
       E944                     WTTRK:
001C10 E944 0601             7      LD  B,1
001C12 E946 3EF4             7      LD  A,0F4H      ;FDC TypeIIIコマンド Write Track
001C14 E948 1802            12      JR  WTTRK1
       E94A                     FDWT:
001C16 E94A 3EA0             7      LD  A,0A0H      ;FDC TypeIIコマンド Write Sector
       E94C                     WTTRK1:
001C18 E94C 32EEE8          13      LD  (FDCSMC),A
       E94F                     DWTBL:
001C1B E94F 78               4      LD  A,B
001C1C E950 328CE9          13      LD  (WTBSMC),A
001C1F E953 3E02             7      LD  A,2     ;Retry count
001C21 E955 3243E9          13      LD  (RETRY),A
                                
       E958                     DWT0:
001C24 E958 D5              11      PUSH    DE
001C25 E959 E5              11      PUSH    HL
001C26 E95A CDA0E8          17      CALL    SEEK        ;Write disk
001C29 E95D E1              10      POP HL
001C2A E95E 3837            12      JR  C,ERRDW
001C2C E960 F3               4      DI
001C2D E961 CD22E9          17      CALL    SECSET_FDCCMD
001C30 E964 0EDB             7      LD  C,0DBH      ;MB8876 データレジスタ
       E966                     DWT1:
001C32 E966 7E               7      LD  A,(HL)
001C33 E967 2F               4      CPL         ;データバスが負論理
001C34 E968 57               4      LD  D,A
                                
       E969                     DWT2:
001C35 E969 DBD8            11      IN  A,(0D8H)    ;MB8876 ステータス/コマンドレジスタ
001C37 E96B 2F               4      CPL         ;データバスが負論理
001C38 E96C 0F               4      RRCA
001C39 E96D 3008            12      JR  NC,DWT4
001C3B E96F 0F               4      RRCA
001C3C E970 30F7            12      JR  NC,DWT2
       E972                     DWT3:
001C3E E972 ED51            12      OUT (C),D       ;MB8876 データレジスタ
001C40 E974 23               6      INC HL
001C41 E975 18EF            12      JR  DWT1
                                
       E977                     DWT4:
001C43 E977 3D               4      DEC A
001C44 E978 28F8            12      JR  Z,DWT3
001C46 E97A 3C               4      INC A
001C47 E97B FB               4      EI
001C48 E97C D1              10      POP DE
001C49 E97D 13               6      INC DE
001C4A E97E CD1CE9          17      CALL    FDMOFF
001C4D E981 2808            12      JR  Z,DISKOK_WT
001C4F E983 CDEBE9          17      CALL    DISKC
001C52 E986 20D0            12      JR  NZ,DWT0
001C54 E988 B7               4      OR  A
001C55 E989 2005            12      JR  NZ,ERRW
                                
       E98B                     DISKOK_WT:
001C57 E98B 0601             7      LD  B,1
       E98C                     WTBSMC  EQU $-1
001C59 E98D 10C0            13      DJNZ    DWTBL
001C5B E98F C9              10      RET
                                
       E990                     ERRW:
001C5C E990 3EFF             7      LD  A,0FFH
       E992                     ERRZ:
001C5E E992 BF               4      CP  A       ;ZF=1
001C5F E993 37               4      SCF
001C60 E994 C31CE9          10      JP  FDMOFF
                                
       E997                     ERRDW:
001C63 E997 D1              10      POP DE
001C64 E998 CDFCE9          17      CALL    DELP
001C67 E99B 20BB            12      JR  NZ,DWT0
001C69 E99D B7               4      OR  A
001C6A E99E 20F0            12      JR  NZ,ERRW
001C6C E9A0 C9              10      RET
                                
       E9A1                     FDRD:
001C6D E9A1 3E80             7      LD  A,080H      ;FDC TypeIIコマンド Read Sector
001C6F E9A3 32EEE8          13      LD  (FDCSMC),A
       E9A6                     DRDBL:
001C72 E9A6 78               4      LD  A,B
001C73 E9A7 32DDE9          13      LD  (RDBSMC),A
001C76 E9AA 3E02             7      LD  A,2     ;Retry count
001C78 E9AC 3243E9          13      LD  (RETRY),A
       E9AF                     DRD0:
001C7B E9AF D5              11      PUSH    DE
001C7C E9B0 E5              11      PUSH    HL
001C7D E9B1 CDA0E8          17      CALL    SEEK        ;Read disk
001C80 E9B4 E1              10      POP HL
001C81 E9B5 382A            12      JR  C,ERRDR
001C83 E9B7 F3               4      DI
001C84 E9B8 CD22E9          17      CALL    SECSET_FDCCMD
       E9BB                     DRD1:
001C87 E9BB DBD8            11      IN  A,(0D8H)    ;MB8876 ステータス/コマンドレジスタ
001C89 E9BD 2F               4      CPL         ;データバスが負論理
001C8A E9BE 0F               4      RRCA
001C8B E9BF 300A            12      JR  NC,DRD3
001C8D E9C1 0F               4      RRCA
001C8E E9C2 30F7            12      JR  NC,DRD1
001C90 E9C4 DBDB            11      IN  A,(0DBH)    ;MB8876 データレジスタ
001C92 E9C6 2F               4      CPL         ;データバスが負論理
001C93 E9C7 77               7      LD  (HL),A
001C94 E9C8 23               6      INC HL
001C95 E9C9 18F0            12      JR  DRD1
                                
       E9CB                     DRD3:
001C97 E9CB B7               4      OR  A
001C98 E9CC FB               4      EI
001C99 E9CD D1              10      POP DE
001C9A E9CE 13               6      INC DE
001C9B E9CF CD1CE9          17      CALL    FDMOFF
001C9E E9D2 2808            12      JR  Z,DISKOK_RD
001CA0 E9D4 CDEBE9          17      CALL    DISKC
001CA3 E9D7 20D6            12      JR  NZ,DRD0
001CA5 E9D9 B7               4      OR  A
001CA6 E9DA 20B4            12      JR  NZ,ERRW
                                
       E9DC                     DISKOK_RD:
001CA8 E9DC 0601             7      LD  B,1
       E9DD                     RDBSMC  EQU $-1
001CAA E9DE 10C6            13      DJNZ    DRDBL
001CAC E9E0 C9              10      RET
                                
       E9E1                     ERRDR:
001CAD E9E1 D1              10      POP DE
001CAE E9E2 CDFCE9          17      CALL    DELP
001CB1 E9E5 20C8            12      JR  NZ,DRD0
001CB3 E9E7 B7               4      OR  A
001CB4 E9E8 20A6            12      JR  NZ,ERRW
001CB6 E9EA C9              10      RET
       E9EB                     DISKC:
001CB7 E9EB 1B               6      DEC DE
001CB8 E9EC CB5F             8      BIT 3,A
001CBA E9EE C43DE9          17      CALL    NZ,RNF
       E9F1                     DISKD:
001CBD E9F1 E5              11      PUSH    HL
001CBE E9F2 2143E9          10      LD  HL,RETRY
001CC1 E9F5 35              11      DEC (HL)
001CC2 E9F6 E1              10      POP HL
001CC3 E9F7 200C            12      JR  NZ,ERR      ;Retry
001CC5 E9F9 B7               4      OR  A
001CC6 E9FA 2809            12      JR  Z,ERR       ;Error
                                
       E9FC                     DELP:
001CC8 E9FC CD3DE9          17      CALL    RNF
001CCB E9FF CD1CE9          17      CALL    FDMOFF
001CCE EA02 3EFF             7      LD  A,0FFH
       EA04                     AERRZ:
001CD0 EA04 BF               4      CP  A
       EA05                     ERR:
001CD1 EA05 3EFF             7      LD  A,0FFH
001CD3 EA07 C9              10      RET
[EOF:M7DISK.ASM:SHIFT_JIS]
                                    INCLUDE "M7DISK2.ASM"
                                
                                ;   LSX-Dodgers DISK2
                                ;   MZ-700/1500
                                
                                ;   EMM DRIVER
                                ;   1セクタ可変(256/512/1024)
                                
       EA08                     EDWT:
001CD4 EA08 F5              11      PUSH    AF
001CD5 EA09 CD27EA          17      CALL    EADR
001CD8 EA0C 0600             7      LD  B,0
       EA0E                     EDWT1:
001CDA EA0E EDB3                    OTIR
001CDC EA10 3D               4      DEC A
001CDD EA11 20FB            12      JR  NZ,EDWT1
001CDF EA13 180B            12      JR  EDRW1
                                
       EA15                     EDRD:
001CE1 EA15 C5              11      PUSH    BC
001CE2 EA16 CD27EA          17      CALL    EADR
001CE5 EA19 0600             7      LD  B,0
       EA1B                     EDRD1:
001CE7 EA1B EDB2                    INIR
001CE9 EA1D 3D               4      DEC A
001CEA EA1E 20FB            12      JR  NZ,EDRD1
       EA20                     EDRW1:
001CEC EA20 F1              10      POP AF
001CED EA21 83               4      ADD A,E ;セクタを進める
001CEE EA22 5F               4      LD  E,A
001CEF EA23 8A               4      ADC A,D
001CF0 EA24 93               4      SUB E
001CF1 EA25 57               4      LD  D,A
001CF2 EA26 C9              10      RET
                                
       EA27                     EADR:
001CF3 EA27 D5              11      PUSH    DE
001CF4 EA28 EB               4      EX  DE,HL
001CF5 EA29 78               4      LD  A,B
001CF6 EA2A DD460F          19      LD  B,(IX+DPB_BPS)
       EA2D                     EADR1:              ;読み込むセクタ数と1クラスタのセクタ数を掛ける
001CF9 EA2D CB18             8      RR  B
001CFB EA2F 3804            12      JR  C,EADR2
001CFD EA31 87               4      ADD A,A
001CFE EA32 29              11      ADD HL,HL
001CFF EA33 18F8            12      JR  EADR1
       EA35                     EADR2:
001D01 EA35 DD4E0D          19      LD  C,(IX+DPB_MAXSEC)
001D04 EA38 DD460C          19      LD  B,(IX+DPB_MAXCYL)
001D07 EA3B 09              11      ADD HL,BC
001D08 EA3C DD4E13          19      LD  C,(IX+DPB_UNITNO)
001D0B EA3F ED71                    DB  0EDH,071H   ;OUT (C),0  Z80未定義命令
001D0D EA41 0C               4      INC C
001D0E EA42 ED69            12      OUT (C),L
001D10 EA44 0C               4      INC C
001D11 EA45 ED61            12      OUT (C),H
001D13 EA47 0C               4      INC C
001D14 EA48 EB               4      EX  DE,HL
001D15 EA49 D1              10      POP DE
001D16 EA4A C9              10      RET
                                
                                ;   CMOS BACKUP MEMORY DRIVER(32KB)
                                ;   1セクタ256
                                
       EA4B                     CDWT:
001D17 EA4B 78               4      LD  A,B
001D18 EA4C DD4E13          19      LD  C,(IX+DPB_UNITNO)
001D1B EA4F ED40            12      IN  B,(C)       ;アドレスカウンタを0000にリセット
001D1D EA51 ED59            12      OUT (C),E       ;W)アドレスカウンタ上位
001D1F EA53 01FA00          10      LD  BC,000FAH
       EA56                     CDWT1:
001D22 EA56 EDB3                    OTIR            ;W)データ書き込み・アドレスカウンタ+1
001D24 EA58 13               6      INC DE
001D25 EA59 3D               4      DEC A
001D26 EA5A 20FA            12      JR  NZ,CDWT1
001D28 EA5C A7               4      AND A
001D29 EA5D C9              10      RET
                                
       EA5E                     CDRD:
001D2A EA5E 78               4      LD  A,B
001D2B EA5F DD4E13          19      LD  C,(IX+DPB_UNITNO)
001D2E EA62 ED40            12      IN  B,(C)       ;アドレスカウンタを0000にリセット
001D30 EA64 ED59            12      OUT (C),E       ;W)アドレスカウンタ上位
001D32 EA66 01F900          10      LD  BC,000F9H
       EA69                     CDRD1:
001D35 EA69 EDB2                    INIR            ;R)データ読み出し・アドレスカウンタ+1
001D37 EA6B 13               6      INC DE
001D38 EA6C 3D               4      DEC A
001D39 EA6D 20FA            12      JR  NZ,CDRD1
001D3B EA6F A7               4      AND A
001D3C EA70 C9              10      RET
                                
                                ;   RAM DISK DRIVER (64KB)
                                ;   1セクタ256
                                
       EA71                     RDWT:
001D3D EA71 3EB3             7      LD  A,0B3H      ;OTIR
001D3F EA73 1802            12      JR  RDRW
       EA75                     RDRD:
001D41 EA75 3EB2             7      LD  A,0B2H      ;INIR
       EA77                     RDRW:
001D43 EA77 3284EA          13      LD  (RDRW1+1),A
                                
001D46 EA7A 78               4      LD  A,B
001D47 EA7B 43               4      LD  B,E     ;B=アドレスカウンタ上位(X1の様な16bitのI/Oアクセス)
001D48 EA7C 0EEB             7      LD  C,0EBH
001D4A EA7E ED71            12      OUT (C),0       ;0=アドレスカウンタ下位
001D4C EA80 0D               4      DEC C       ;EA(R)データ読み出し・アドレスカウンタ+1
001D4D EA81 0600             7      LD  B,0
       EA83                     RDRW1:
001D4F EA83 EDB2                    INIR            ;自己書き換え(INIR/OTIR)
001D51 EA85 13               6      INC DE
001D52 EA86 3D               4      DEC A
001D53 EA87 20FA            12      JR  NZ,RDRW1
001D55 EA89 A7               4      AND A
001D56 EA8A C9              10      RET
                                
                                ;   G-RAM(PCG) DISK DRIVER (24KB)
                                ;   1セクタ256
                                
       EA8B                     GDWT:
001D57 EA8B C5              11      PUSH    BC
001D58 EA8C D5              11      PUSH    DE
001D59 EA8D CDB5EA          17      CALL    GADR
       EA90                     GDWT2:
001D5C EA90 4E               7      LD  C,(HL)
001D5D EA91 23               6      INC HL
001D5E EA92 EB               4      EX  DE,HL   ;HL=PCG,DE=メモリ
001D5F EA93 CDD2CF          17      CALL    WR_PCG
001D62 EA96 23               6      INC HL
001D63 EA97 EB               4      EX  DE,HL   ;HL=メモリ,DE=PCG
001D64 EA98 10F6            13      DJNZ    GDWT2
001D66 EA9A D1              10      POP DE
001D67 EA9B 1C               4      INC E
001D68 EA9C C1              10      POP BC
001D69 EA9D 10EC            13      DJNZ    GDWT
001D6B EA9F C9              10      RET
       EAA0                     GDRD:
001D6C EAA0 C5              11      PUSH    BC
001D6D EAA1 D5              11      PUSH    DE
001D6E EAA2 CDB5EA          17      CALL    GADR
       EAA5                     GDRD2:
001D71 EAA5 EB               4      EX  DE,HL   ;HL=PCG,DE=メモリ
001D72 EAA6 CDCACF          17      CALL    RD_PCG
001D75 EAA9 23               6      INC HL
001D76 EAAA EB               4      EX  DE,HL   ;HL=メモリ,DE=PCG
001D77 EAAB 71               7      LD  (HL),C
001D78 EAAC 23               6      INC HL
001D79 EAAD 10F6            13      DJNZ    GDRD2
001D7B EAAF D1              10      POP DE
001D7C EAB0 1C               4      INC E
001D7D EAB1 C1              10      POP BC
001D7E EAB2 10EC            13      DJNZ    GDRD
001D80 EAB4 C9              10      RET
                                
       EAB5                     GADR:
001D81 EAB5 7B               4      LD  A,E
001D82 EAB6 E61F             7      AND 01FH
001D84 EAB8 C6D0             7      ADD A,0D0H
001D86 EABA 57               4      LD  D,A
001D87 EABB 7B               4      LD  A,E
001D88 EABC 07               4      RLCA
001D89 EABD 07               4      RLCA
001D8A EABE 07               4      RLCA
001D8B EABF 3C               4      INC A
001D8C EAC0 0600             7      LD  B,0
001D8E EAC2 58               4      LD  E,B
001D8F EAC3 C9              10      RET
[EOF:M7DISK2.ASM:UTF_8]
                                    INCLUDE "LDCCPWK.ASM"
                                
                                ;   LSX-Dodgers CCP WORK
                                
       003B                     PATHX   EQU 59
001D90 EAC4                     PATHD:  DS  PATHX
001DCB EAFF 00                  PATHE:  DB  0
                                
       EB00                     DTA_CCP:
001DCC EB00                         DS  37
                                
       EB25                     FCB_BAT:
001DF1 EB25                         DS  37
                                
001E16 EB4A 2020203C4449523E    DIRMES: DB  "   <DIR>  $"
            202024              
001E21 EB55 20667265652024      FREE:   DB  " free $"
[EOF:LDCCPWK.ASM:UTF_8]
                                    INCLUDE "M7TABLE.ASM"
                                
                                ;   LSX-Dodgers TABLE 表示関連のテーブル
                                ;   MZ-700/1500
                                
       EB5C                     AT_TABLE:
001E28 EB5C                         DS  TABLEAD-AT_TABLE
                                
       ED40                     KEY_TABLE:
00200C ED40 12081E1F1C1D5C2F        DB  12H,08H,1EH,1FH,1CH,1DH,5CH,'/'
002014 ED48 5C5E2D2030392C2E        DB  5CH,'^','-',20H,'0','9',',','.'
00201C ED50 3132333435363738        DB  '1','2','3','4','5','6','7','8'
002024 ED58 6162636465666768        DB  'a','b','c','d','e','f','g','h'
00202C ED60 696A6B6C6D6E6F70        DB  'i','j','k','l','m','n','o','p'
002034 ED68 7172737475767778        DB  'q','r','s','t','u','v','w','x'
00203C ED70 797A405B5D000000        DB  'y','z','@','[',']',00H,00H,00H
002044 ED78 001B3D09003B3A0D        DB  00H,1BH,'=',09H,00H,';',':',0DH
       ED80                     SHIFT_TABLE:
00204C ED80 12081E1F1C1D5F3F        DB  12H,08H,1EH,1FH,1CH,1DH,'_','?'
002054 ED88 7C7E3D2030293C3E        DB  '|','~','=',20H,'0',')','<','>'
00205C ED90 2122232425262728        DB  '!','"','#','$','%','&',27H,'('
002064 ED98 4142434445464748        DB  'A','B','C','D','E','F','G','H'
00206C EDA0 494A4B4C4D4E4F50        DB  'I','J','K','L','M','N','O','P'
002074 EDA8 5152535455565758        DB  'Q','R','S','T','U','V','W','X'
00207C EDB0 595A607B7D000000        DB  'Y','Z','`','{','}',00H,00H,00H
002084 EDB8 00003D09002B2A0D        DB  00H,00H,'=',09H,00H,'+','*',0DH
       EDC0                     CTRL_TABLE:
00208C EDC0 12081E1F1C1D3F2F        DB  12H,08H,1EH,1FH,1CH,1DH,'?','/'
002094 EDC8 2A2B2D2030392C2E        DB  '*','+','-',20H,'0','9',',','.'
00209C EDD0 3132333435363738        DB  '1','2','3','4','5','6','7','8'
0020A4 EDD8 0102030405060708        DB  01H,02H,03H,04H,05H,06H,07H,08H
0020AC EDE0 090A0B0C0D0E0F10        DB  09H,0AH,0BH,0CH,0DH,0EH,0FH,10H
0020B4 EDE8 1112131415161718        DB  11H,12H,13H,14H,15H,16H,17H,18H
0020BC EDF0 191A1B5B5D000000        DB  19H,1AH,1BH,'[',']',00H,00H,00H
0020C4 EDF8 00003D09003B3A0D        DB  00H,00H,'=',09H,00H,';',':',0DH
                                
                                ;   アドレス下位1バイトが0になるように
       EE00                     CD_TABLE:
0020CC EE00 00D1D2D3D4D5D6D0        DB  $00,$D1,$D2,$D3,$D4,$D5,$D6,$D0 ;月火水木金土日
0020D4 EE08 D8DCD9DADBD7CFCE        DB  $D8,$DC,$D9,$DA,$DB,$D7,$CF,$CE ;年円時分秒
0020DC EE10 601F5F5E1E1B7978        DB  $60,$1F,$5F,$5E,$1E,$1B,$79,$78 ;
0020E4 EE18 5C5D1C1D6DCACDC7        DB  $5C,$5D,$1C,$1D,$6D,$CA,$CD,$C7 ;
0020EC EE20 0061626364656667        DB  $00,$61,$62,$63,$64,$65,$66,$67 ; !"#$%&'
0020F4 EE28 68696B6A2F2A2E2D        DB  $68,$69,$6B,$6A,$2F,$2A,$2E,$2D ;()*+,-./
0020FC EE30 2021222324252627        DB  $20,$21,$22,$23,$24,$25,$26,$27 ;01234567
002104 EE38 28294F2C512B5749        DB  $28,$29,$4F,$2C,$51,$2B,$57,$49 ;89:;<=>?
00210C EE40 5501020304050607        DB  $55,$01,$02,$03,$04,$05,$06,$07 ;@ABCDEFG
002114 EE48 08090A0B0C0D0E0F        DB  $08,$09,$0A,$0B,$0C,$0D,$0E,$0F ;HIJKLMNO
00211C EE50 1011121314151617        DB  $10,$11,$12,$13,$14,$15,$16,$17 ;PQRSTUVW
002124 EE58 18191A52DD54507C        DB  $18,$19,$1A,$52,$DD,$54,$50,$7C ;XYZ[\]^_
00212C EE60 5901020304050607        DB  $59,$01,$02,$03,$04,$05,$06,$07 ;`abcdefg   ATB:1
002134 EE68 08090A0B0C0D0E0F        DB  $08,$09,$0A,$0B,$0C,$0D,$0E,$0F ;hijklmno   ATB:1
00213C EE70 1011121314151617        DB  $10,$11,$12,$13,$14,$15,$16,$17 ;pqrstuvw   ATB:1
002144 EE78 18191ACB35CC705A        DB  $18,$19,$1A,$CB,$35,$CC,$70,$5A ;xyz{|}~    ATB:1
00214C EE80 415346444847B49E        DB  $41,$53,$46,$44,$48,$47,$B4,$9E ;トランプ〇●をぁ   ATB:1
002154 EE88 B2B6BABE9FB3B7BB        DB  $B2,$B6,$BA,$BE,$9F,$B3,$B7,$BB ;ぃぅぇぉゃゅょっ   ATB:1
00215C EE90 BFA385A4A5A69487        DB  $BF,$A3,$85,$A4,$A5,$A6,$94,$87 ;ーあいうえおかき   ATB:1
002164 EE98 889C829884929083        DB  $88,$9C,$82,$98,$84,$92,$90,$83 ;くけこさしすせそ   ATB:1
00216C EEA0 F0BD9DB1B5B9B49E        DB  $F0,$BD,$9D,$B1,$B5,$B9,$B4,$9E ;　。「」、・ヲァ
002174 EEA8 B2B6BABE9FB3B7BB        DB  $B2,$B6,$BA,$BE,$9F,$B3,$B7,$BB ;ィゥェォャョュッ
00217C EEB0 BFA385A4A5A69487        DB  $BF,$A3,$85,$A4,$A5,$A6,$94,$87 ;ーアイウエオカキ
002184 EEB8 889C829884929083        DB  $88,$9C,$82,$98,$84,$92,$90,$83 ;クケコサシスセソ
00218C EEC0 91819A97939589A1        DB  $91,$81,$9A,$97,$93,$95,$89,$A1 ;タチツテトナニヌ
002194 EEC8 AF8B8696A2ABAA8A        DB  $AF,$8B,$86,$96,$A2,$AB,$AA,$8A ;ネノハヒフヘホマ
00219C EED0 8EB0AD8DA7A8A98F        DB  $8E,$B0,$AD,$8D,$A7,$A8,$A9,$8F ;ミムメモヤユヨラ
0021A4 EED8 8CAEAC9BA099BCB8        DB  $8C,$AE,$AC,$9B,$A0,$99,$BC,$B8 ;リルレロワン゛゜
0021AC EEE0 91819A97939589A1        DB  $91,$81,$9A,$97,$93,$95,$89,$A1 ;たちつてとねにぬ   ATB:1
0021B4 EEE8 AF8B8696A2ABAA8A        DB  $AF,$8B,$86,$96,$A2,$AB,$AA,$8A ;ねのはひふへほま   ATB:1
0021BC EEF0 8EB0AD8DA7A8A98F        DB  $8E,$B0,$AD,$8D,$A7,$A8,$A9,$8F ;みむめもやゆよら   ATB:1
0021C4 EEF8 8CAEAC9BA099BCB8        DB  $8C,$AE,$AC,$9B,$A0,$99,$BC,$B8 ;りるれろわん゛゜   ATB:1
       EF00                     DC_TABLE:
0021CC EF00 2041424344454647        DB  $20,$41,$42,$43,$44,$45,$46,$47 ;0
0021D4 EF08 48494A4B4C4D4E4F        DB  $48,$49,$4A,$4B,$4C,$4D,$4E,$4F
0021DC EF10 5051525354555657        DB  $50,$51,$52,$53,$54,$55,$56,$57 ;1
0021E4 EF18 58595A151A1B1411        DB  $58,$59,$5A,$15,$1A,$1B,$14,$11
0021EC EF20 3031323334353637        DB  $30,$31,$32,$33,$34,$35,$36,$37 ;2
0021F4 EF28 38392D3D3B2F2E2C        DB  $38,$39,$2D,$3D,$3B,$2F,$2E,$2C
0021FC EF30 00000000007C0000        DB  $00,$00,$00,$00,$00,$7C,$00,$00 ;3
002204 EF38 0000000000000000        DB  $00,$00,$00,$00,$00,$00,$00,$00
00220C EF40 0080000083008285        DB  $00,$80,$00,$00,$83,$00,$82,$85 ;4
002214 EF48 843F00000000003A        DB  $84,$3F,$00,$00,$00,$00,$00,$3A
00221C EF50 5E3C5B815D40003E        DB  $5E,$3C,$5B,$81,$5D,$40,$00,$3E ;5
002224 EF58 00607F0018191312        DB  $00,$60,$7F,$00,$18,$19,$13,$12
00222C EF60 1021222324252627        DB  $10,$21,$22,$23,$24,$25,$26,$27 ;6
002234 EF68 28292B2A001C0000        DB  $28,$29,$2B,$2A,$00,$1C,$00,$00
00223C EF70 7E00000000000000        DB  $7E,$00,$00,$00,$00,$00,$00,$00 ;7
002244 EF78 171600005F000000        DB  $17,$16,$00,$00,$5F,$00,$00,$00
00224C EF80 00C19A9F9C92CA97        DB  $00,$C1,$9A,$9F,$9C,$92,$CA,$97 ;8
002254 EF88 98C6CFC9D8D3D0D7        DB  $98,$C6,$CF,$C9,$D8,$D3,$D0,$D7
00225C EF90 9EC09DC496C5CBC3        DB  $9E,$C0,$9D,$C4,$96,$C5,$CB,$C3 ;9
002264 EF98 9BDDC2DB99A2878C        DB  $9B,$DD,$C2,$DB,$99,$A2,$87,$8C
00226C EFA0 DCC7CC91939495D4        DB  $DC,$C7,$CC,$91,$93,$94,$95,$D4 ;A
002274 EFA8 D5D6CECDDAD2D9C8        DB  $D5,$D6,$CE,$CD,$DA,$D2,$D9,$C8
00227C EFB0 D1A3888D86A4898E        DB  $D1,$A3,$88,$8D,$86,$A4,$89,$8E ;B
002284 EFB8 DFA58A8FDEA18B90        DB  $DF,$A5,$8A,$8F,$DE,$A1,$8B,$90
00228C EFC0 000000000000001F        DB  $00,$00,$00,$00,$00,$00,$00,$1F ;C
002294 EFC8 00001D7B7D1E0F0E        DB  $00,$00,$1D,$7B,$7D,$1E,$0F,$0E
00229C EFD0 070102030405060D        DB  $07,$01,$02,$03,$04,$05,$06,$0D ;D
0022A4 EFD8 080A0B0C095C0000        DB  $08,$0A,$0B,$0C,$09,$5C,$00,$00
0022AC EFE0 0000000000000000        DB  $00,$00,$00,$00,$00,$00,$00,$00 ;E
0022B4 EFE8 0000000000000000        DB  $00,$00,$00,$00,$00,$00,$00,$00
0022BC EFF0 A000000000000000        DB  $A0,$00,$00,$00,$00,$00,$00,$00 ;F
0022C4 EFF8 0000000000000000        DB  $00,$00,$00,$00,$00,$00,$00,$00
[EOF:M7TABLE.ASM:SHIFT_JIS]
                                    INCLUDE "LDWORK.ASM"
                                
                                ;   LSX-Dodgers WORK0
                                ;
                                ;   CP/M互換BIOS
                                ;   BOOT:アドレス下位1バイトが0になるように
       F000                     AT_WORK:
0022CC F000                         DS  WORKAD-AT_WORK
                                
       F000                     CPM_BOOT:
0022CC F000 C30000          10      JP  0
       F003                     _SYS00:     ;(BDOS)プログラム終了
       F003                     CPM_WBOOT:
0022CF F003 C3FECF          10      JP  WBOOT1
       F006                     CPM_CONST:
0022D2 F006 C39FD7          10      JP  CONSTX
       F009                     _SYS07:     ;(BDOS)コンソール直接入力
       F009                     CPM_CONIN:
0022D5 F009 C33AD7          10      JP  FLGET
       F00C                     CPM_CONOUT:
0022D8 F00C C344D9          10      JP  CONOUT1
                                
       F00F                     DECBF:              ;10進数表示時のバッファ(5バイト)
0022DB F00F                         DS  5
       F00F                     RR_BUF_HL   EQU DECBF   ;CP/M互換ファイルアクセスの際のランダムレコードの一時的な保管場所
       F011                     RR_BUF_A    EQU DECBF+2 ;計3バイト
                                
0022E0 F014 00                  FDRV:   DB  0
0022E1 F015                     FNAME:  DS  36
002305 F039                     SFILE:  DS  33      ;DRV FILENAME
                                
002326 F05A                         DS  3
                                
002329 F05D 0000                LEFTX:  DW  0
00232B F05F 0000                DTAX:   DW  0
                                
       F061                     ZERO:
       F061                     BEEPD:
00232D F061 008E01000B000C10        DB  0,08EH,1,0,00BH,0,00CH,010H
002335 F069 073E08100D00FF          DB  007H,03EH,008H,010H,00DH,0,0FFH
       F062                     RTC_YY  EQU BEEPD+1
       F063                     RTC_MW  EQU BEEPD+2
       F064                     RTC_DD  EQU BEEPD+3
       F065                     RTC_TT  EQU BEEPD+4
       F066                     RTC_MM  EQU BEEPD+5
       F067                     RTC_SS  EQU BEEPD+6
       F062                     ROM_SLT EQU BEEPD+1
                                
00233C F070 00                  CHECK:  DB  0
                                
00233D F071 4F4B24              OK: DB  "OK$"
002340 F074                         DS  5
002345 F079 4572726F722124      COMERM: DB  "Error!$"
                                ;   システムワークエリア
                                ;   _CYL0:アドレス下位1バイトが080Hになるように
00234C F080 FF                  _CYL0:  DB  0FFH    ;Cylinder
00234D F081 FF                  _CYL1:  DB  0FFH    ;Cylinder
00234E F082 FF                  _CYL2:  DB  0FFH    ;Cylinder
00234F F083 FF                  _CYL3:  DB  0FFH    ;Cylinder
002350 F084 00                  _DRIVE: DB  0   ;unit number
       F085                     _SEEKSP:
002351 F085 00                      DB  0   ;Seek speed
002352 F086 FF                  _ISEEK: DB  0FFH    ;
002353 F087                         DS  1
002354 F088 00                  _DRV:   DB  0
002355 F089 FF                  _DSK:   DB  0FFH
002356 F08A 8000                _DTA:   DW  00080H
002358 F08C 0000                _CTC:   DW  0
00235A F08E 0000                _TXADR: DW  0
00235C F090 0000                _KEYPS: DW  0
00235E F092 00FF                _KEYD:  DW  0FF00H  ;キーデータ
002360 F094 8310                _KEYSP: DB  KEYSP_L,KEYSP_H ;オートリピートの速度
       F096                     _COLORF:
002362 F096 70                      DB  COLORF  ;色
002363 F097 19                  _LINE:  DB  LINE
                                
002364 F098 0000                _FCB:   DW  0   ;SEARCH FILES
002366 F09A 0000                _FBPS:  DW  0   ;    //
002368 F09C 0000                _FBAD:  DW  0   ;    //
00236A F09E 00                  _FBCNT: DB  0   ;    //
00236B F09F 00                  _FILEN: DB  0   ;    //
00236C F0A0 00                  _DIRF:  DB  0   ;bit7:ディレクトリ bit0-6:セクタインデックス
00236D F0A1                         DS  1
       F0A2                     _WTFATF:
00236E F0A2 00                      DB  0   ;FATバッファの更新フラグ
00236F F0A3                         DS  1
002370 F0A4 00                  _WTDBF: DB  0   ;データバッファの更新フラグ
002371 F0A5 FF                  _DBDRV: DB  0FFH    ;データバッファにあるデータを読み込んだドライブ
002372 F0A6 0000                _DBSEC: DW  0   ;データバッファにあるデータを読み込んだセクタ番号
002374 F0A8 0000                _DPB:   DW  0
       F0AA                     _FATDRV:
002376 F0AA FF                      DB  0FFH    ;FATバッファに読み込んでいるドライブ
002377 F0AB 00                  _FATIX: DB  0   ;FATバッファに読み込んでいるインデックス
       F0AC                     _FAKEFREE:
002378 F0AC 0000                    DW  0   ;偽の残量（FATサイズが大きくなると重くなるのでその対策）
                                
00237A F0AE                         DS  2
                                
       F0B0                     CRTCD:
00237C F0B0 6F                      DB  06FH
       F0B1                     _WIDTH:
00237D F0B1 28                      DB  WIDTH
       F0B2                     TVRAMTOP:
00237E F0B2 5938                    DB  059H,038H
002380 F0B4 1F02                    DB  01FH,002H
       F0B6                     _LINE2:
002382 F0B6 19                      DB  019H
       F0B7                     WKE4:
002383 F0B7 1C                      DB  01CH
       F0B8                     WKE6:
002384 F0B8 00                      DB  000H
       F0B9                     WK40:
002385 F0B9 07                      DB  007H
       F0BA                     _PAGE_MINUS:
002386 F0BA 18FC                    DW  0-WIDTH*LINE
       F0BC                     _WIDTH_MINUS:
002388 F0BC D8FF                    DW  0-WIDTH
       F0BE                     WK30:
00238A F0BE 0C                      DB  00CH
       F0BF                     WK31:
       F0BF                     WK1FD0:
00238B F0BF 20                      DB  020H
                                
00238C F0C0 0000                CTC0:   DW  INTCTCE
00238E F0C2 0000                CTC1:   DW  INTCTCE
002390 F0C4 0000                CTC2:   DW  INTCTCE
002392 F0C6 0000                CTC3:   DW  INTCTCE
002394 F0C8 0000                INTVEC: DW  INT
                                
                                ;   LSX-Dodgers 独自BIOS
                                
002396 F0CA C38BDA          10  _INKEY: JP  INKEY
002399 F0CD C330D8          10  _PRINT: JP  PRINT
00239C F0D0 C3FFDA          10  _SCRN:  JP  SCRN
00239F F0D3 C3EDD9          10  _POS:   JP  POS
0023A2 F0D6 C312D9          10  _LOC:   JP  LOC
       F0D9                     _CHGDRV:
0023A5 F0D9 C3A9E7          10      JP  CHGDRV
       F0DC                     _GETDPB:
0023A8 F0DC C367E8          10      JP  GETDPB
       F0DF                     _FFLUSH:
0023AB F0DF C385E8          10      JP  FFLUSH
       F0E2                     _RDFATX:
0023AE F0E2 C385E4          10      JP  RDFATX
0023B1 F0E5 C3B4E5          10  _RDFAT: JP  RDFAT
0023B4 F0E8 C344E9          10  _WTTRK: JP  WTTRK
0023B7 F0EB C3A1E9          10  _FDRD:  JP  FDRD
0023BA F0EE C34AE9          10  _FDWT:  JP  FDWT
       F0F1                     _BPB2DPB:
0023BD F0F1 C345E6          10      JP  BPB2DPB
       F0F4                     _BREAK:
0023C0 F0F4 C391D1          10      JP  END_BATCH
       F0F7                     _GNCL:
0023C3 F0F7 C32EE5          10      JP  GNCL        ; self-modifying code
       F0F8                     GNCPAT  EQU $-2
       F0FA                     _SNCL:
0023C6 F0FA C351E5          10      JP  SNCL        ; self-modifying code
       F0FB                     SNCPAT  EQU $-2
       F0FD                     _COMANL:
0023C9 F0FD C34AD0          10      JP  COMANL
                                
       F100                     _WE:
[EOF:LDWORK.ASM:SHIFT_JIS]
                                    INCLUDE "LDCALL.ASM"
                                
                                ;   LSX-Dodgers システムコール(BDOS)
                                ;
                                ;   LSX-Dodgers SYSTEM CALL
                                ;   STABLE:アドレス下位1バイトが0になるように
                                
       F100                     STABLE:
                                ;0
0023CC F100 03F011D71DD7E0DC        DW  _SYS00,_SYS01,_SYS02,_SYS03
0023D4 F108 78D478D422D709F0        DW  _SYS04,_SYS05,_SYS06,_SYS07
0023DC F110 2AD77AD470D79CD7        DW  _SYS08,_SYS09,_SYS0A,_SYS0B
0023E4 F118 8FD494D4A3D4B4D4        DW  _SYS0C,_SYS0D,_SYS0E,_SYS0F
                                ;1
0023EC F120 08D54FD598D5C9D5        DW  _SYS10,_SYS11,_SYS12,_SYS13
0023F4 F128 D1D5E7D5FCD5F4D5        DW  _SYS14,_SYS15,_SYS16,_SYS17
0023FC F130 43D648D64DD653D6        DW  _SYS18,_SYS19,_SYS1A,_SYS1B
002404 F138 78D479D678D47DD6        DW  _SYS1C,_SYS1D,_SYS1E,_SYS1F
                                ;2
00240C F140 78D433D63BD684D6        DW  _SYS20,_SYS21,_SYS22,_SYS23
002414 F148 AAD678D435E10DE2        DW  _SYS24,_ERROR,_SYS26,_SYS27
00241C F150 3BD6B4D6ADD7E0DC        DW  _SYS28,_SYS29,_SYS2A,_SYS2B
002424 F158 B3D7E0DC78D4D5D6        DW  _SYS2C,_SYS2D,_SYS2E,_SYS2F
                                ;3
00242C F160 CFD678D478D478D4        DW  _SYS30,_ERROR,_ERROR,_ERROR
002434 F168 78D478D478D478D4        DW  _ERROR,_ERROR,_ERROR,_ERROR
00243C F170 78D4E0DCE0DCF6D6        DW  _ERROR,_SYS39,_SYS3A,_SYS5A
                                ;DOS2
002444 F178 5BD4                    DW  _DOS2
                                
002446 F17A                         DS  1
       F17B                     _MAX_SEC_SZ_H:
002447 F17B 04                      DB  MAX_SEC_SZ_H
       F17C                     _FATBF:
002448 F17C 00F3                    DW  FATBF
       F17E                     _DTBUF:
00244A F17E 00FB                    DW  DTBUF
                                
                                ;   コントロールコードテーブル
                                ;   CTRLTB:アドレス下位1バイトが080Hになるように
                                
       F180                     CTRLTB:
00244C F180 95D895D8CBD8C0D9        DW  CTRL00,CTRL00,CTRL02,CTRL03 ;  A,B,C
002454 F188 BAD9F7D8ABD954D9        DW  CTRL04,CTRL05,CTRL06,CTRL07 ;D,E,F,G
00245C F190 A1D8BCD8C3D925D9        DW  CTRL08,CTRL09,CTRL0A,CTRL0B ;H,I,J,K
002464 F198 A8D90DD9D5D995D8        DW  CTRL0C,CTRL0D,CTRL0E,CTRL00 ;L,M,N,O
00246C F1A0 95D895D81DD995D8        DW  CTRL00,CTRL00,CTRL12,CTRL00 ;P,Q,R,S
002474 F1A8 95D895D895D895D8        DW  CTRL00,CTRL00,CTRL00,CTRL00 ;T,U,V,W
00247C F1B0 95D895D8A8D92CD9        DW  CTRL00,CTRL00,CTRL0C,CTRL1B ;X,Y,Z,ESC
002484 F1B8 84D8A8D8B1D8C3D9        DW  CTRL1C,CTRL1D,CTRL1E,CTRL1F ;→,←,↑,↓
                                
00248C F1C0 0200                M2D:    DW  2
00248E F1C2 FD02                    DB  0FDH,2
002490 F1C4 6401                    DW  356
002492 F1C6 FF0728090182            DB  0FFH,7,40,9,1,082H
002498 F1CC 0500A7000800            DW  5,0A7H,8
                                
00249E F1D2 0200                M2HD:   DW  2
0024A0 F1D4 FE01                    DB  0FEH,1
0024A2 F1D6 C704                    DW  1223
0024A4 F1D8 FE064D080184            DB  0FEH,6,77,8,1,084H
0024AA F1DE 0500A7000900            DW  5,0A7H,9
                                
0024B0 F1E4 1617                SDDATA: DB  22,23       ;(FCB)ファイルを最後に変更した時刻
0024B2 F1E6 1415                    DB  20,21       ;(FCB)ファイルを最後に変更した日付
0024B4 F1E8 1A1B                    DB  26,27       ;(FCB)ファイルの先頭クラスタ
0024B6 F1EA 10111213                DB  16,17,18,19 ;(FCB)ファイルのサイズ(バイト単位)
       F1EE                     SDDATAE:
                                
0024BA F1EE                         DS  2
       F1F0                     _FCB_BAT:
0024BC F1F0 25EB                    DW  FCB_BAT
       F1F2                     _PATH:
0024BE F1F2 C4EA                    DW  PATHD
                                
0024C0 F1F4                     SCDIR:  DS  2       ;+14 +15
0024C2 F1F6                     SFBPS:  DS  2       ;FBPS
0024C4 F1F8                     SFNDF:  DS  2       ;FILEN DIRF
                                
0024C6 F1FA 0000                _FATPS: DW  0
0024C8 F1FC 0000                _DIRPS: DW  0
0024CA F1FE 0000                _CLPS:  DW  0
                                
       F200                     _PE:
[EOF:LDCALL.ASM:SHIFT_JIS]
                                    INCLUDE "M7DPB.ASM"
                                
                                ;   LSX-Dodgers DPB
                                ;   MZ-700/1500
                                
       F200                     _DEVICE:
                                
                                ;   A:
                                
0024CC F200 0200                    DW  2   ;DPB_FATLN
0024CE F202 EBF0                    DW  _FDRD   ;DPB_DRD
0024D0 F204 EEF0                    DW  _FDWT   ;DPB_DWT
0024D2 F206 FD                      DB  0FDH    ;DPB_FATID
0024D3 F207 02                      DB  2   ;DPB_SECPCL
0024D4 F208 6401                    DW  356 ;DPB_MAXCL
0024D6 F20A FF                      DB  0FFH    ;DPB_FDMODE 0FFH=2D / 0FEH=2HD
0024D7 F20B 07                      DB  7   ;DPB_DIRSCNT
0024D8 F20C 28                      DB  40  ;DPB_MAXCYL
0024D9 F20D 09                      DB  9   ;DPB_MAXSEC Number of sectors
0024DA F20E 01                      DB  1   ;DPB_FATPS
0024DB F20F 82                      DB  082H    ;DPB_BPS
0024DC F210 0500                    DW  5   ;DPB_DIRPS
0024DE F212 27                      DB  027H    ;DPB_DEVICE Device Number
0024DF F213 00                      DB  0   ;DPB_UNITNO
0024E0 F214 0800                    DW  8   ;DPB_ADDCL
0024E2 F216 0000                    DW  0   ;DPB_16
0024E4 F218 0000                    DW  0   ;DPB_18
0024E6 F21A 0000                    DW  0   ;DPB_SDIR
0024E8 F21C 46444430                DB  "FDD0"  ;DPB_NAME
                                
                                ;   B:
                                
0024EC F220 0200                    DW  2   ;DPB_FATLN
0024EE F222 EBF0                    DW  _FDRD   ;DPB_DRD
0024F0 F224 EEF0                    DW  _FDWT   ;DPB_DWT
0024F2 F226 FD                      DB  0FDH    ;DPB_FATID
0024F3 F227 02                      DB  2   ;DPB_SECPCL
0024F4 F228 6401                    DW  356 ;DPB_MAXCL
0024F6 F22A FF                      DB  0FFH    ;DPB_FDMODE 0FFH=2D / 0FEH=2HD
0024F7 F22B 07                      DB  7   ;DPB_DIRSCNT
0024F8 F22C 28                      DB  40  ;DPB_MAXCYL
0024F9 F22D 09                      DB  9   ;DPB_MAXSEC Number of sectors
0024FA F22E 01                      DB  1   ;DPB_FATPS
0024FB F22F 82                      DB  082H    ;DPB_BPS
0024FC F230 0500                    DW  5   ;DPB_DIRPS
0024FE F232 27                      DB  027H    ;DPB_DEVICE Device Number
0024FF F233 01                      DB  1   ;DPB_UNITNO
002500 F234 0800                    DW  8   ;DPB_ADDCL
002502 F236 0000                    DW  0   ;DPB_16
002504 F238 0000                    DW  0   ;DPB_18
002506 F23A 0000                    DW  0   ;DPB_SDIR
002508 F23C 46444431                DB  "FDD1"  ;DPB_NAME
                                
                                ;   C:
                                
00250C F240 0100                    DW  1   ;DPB_FATLN
00250E F242 5EEA                    DW  CDRD    ;DPB_DRD
002510 F244 4BEA                    DW  CDWT    ;DPB_DWT
002512 F246 FA                      DB  0FAH    ;DPB_FATID
002513 F247 01                      DB  1   ;DPB_SECPCL
002514 F248 7A00                    DW  122 ;DPB_MAXCL
002516 F24A 00                      DB  0   ;DPB_FDMODE
002517 F24B 06                      DB  6   ;DPB_DIRSCNT
002518 F24C 00                      DB  0   ;DPB_MAXCYL
002519 F24D 00                      DB  0   ;DPB_MAXSEC
00251A F24E 01                      DB  1   ;DPB_FATPS
00251B F24F 01                      DB  1   ;DPB_BPS
00251C F250 0200                    DW  2   ;DPB_DIRPS
00251E F252 0C                      DB  00CH    ;DPB_DEVICE
00251F F253 F8                      DB  0F8H    ;DPB_UNITNO
002520 F254 0600                    DW  6   ;DPB_ADDCL
002522 F256 0000                    DW  0   ;DPB_16
002524 F258 0000                    DW  0   ;DPB_18
002526 F25A 0000                    DW  0   ;DPB_SDIR
002528 F25C 434D4F53                DB  "CMOS"  ;DPB_NAME
                                
                                ;   D:
                                
00252C F260                         DS  32
                                
                                ;   E:
                                
       F280                     EMMFL:
00254C F280 0000                    DW  0   ;DPB_FATLN
00254E F282 15EA                    DW  EDRD    ;DPB_DRD
002550 F284 08EA                    DW  EDWT    ;DPB_DWT
002552 F286 FA                      DB  0FAH    ;DPB_FATID
002553 F287 02                      DB  2   ;DPB_SECPCL
002554 F288 0000                    DW  0   ;DPB_MAXCL
002556 F28A 00                      DB  0   ;DPB_FDMODE
002557 F28B 10                      DB  16  ;DPB_DIRSCNT
002558 F28C 00                      DB  0   ;DPB_MAXCYL
002559 F28D 00                      DB  0   ;DPB_MAXSEC
00255A F28E 01                      DB  1   ;DPB_FATPS
00255B F28F 01                      DB  1   ;DPB_BPS
00255C F290 0000                    DW  0   ;DPB_DIRPS
00255E F292 26                      DB  026H    ;DPB_DEVICE
00255F F293 00                      DB  0   ;DPB_UNITNO
002560 F294 0000                    DW  0   ;DPB_ADDCL
002562 F296 0000                    DW  0   ;DPB_16
002564 F298 0000                    DW  0   ;DPB_18
002566 F29A 0000                    DW  0   ;DPB_SDIR
002568 F29C 454D4D30                DB  "EMM0"  ;DPB_NAME
                                
                                ;   F:
                                
00256C F2A0 0200                    DW  2   ;DPB_FATLN
00256E F2A2 75EA                    DW  RDRD    ;DPB_DRD
002570 F2A4 71EA                    DW  RDWT    ;DPB_DWT
002572 F2A6 FA                      DB  0FAH    ;DPB_FATID
002573 F2A7 01                      DB  1   ;DPB_SECPCL
002574 F2A8 F600                    DW  246 ;DPB_MAXCL
002576 F2AA 00                      DB  0   ;DPB_FDMODE
002577 F2AB 09                      DB  9   ;DPB_DIRSCNT
002578 F2AC 00                      DB  0   ;DPB_MAXCYL
002579 F2AD 00                      DB  0   ;DPB_MAXSEC
00257A F2AE 01                      DB  1   ;DPB_FATPS
00257B F2AF 01                      DB  1   ;DPB_BPS
00257C F2B0 0300                    DW  3   ;DPB_DIRPS
00257E F2B2 0F                      DB  00FH    ;DPB_DEVICE
00257F F2B3 00                      DB  0   ;DPB_UNITNO
002580 F2B4 0A00                    DW  10  ;DPB_ADDCL
002582 F2B6 0000                    DW  0   ;DPB_16
002584 F2B8 0000                    DW  0   ;DPB_18
002586 F2BA 0000                    DW  0   ;DPB_SDIR
002588 F2BC 52414D46                DB  "RAMF"  ;DPB_NAME
                                
                                ;   G:
       F2C0                     GRAMFL:
00258C F2C0 0100                    DW  1   ;DPB_FATLN
00258E F2C2 A0EA                    DW  GDRD    ;DPB_DRD
002590 F2C4 8BEA                    DW  GDWT    ;DPB_DWT
002592 F2C6 FA                      DB  0FAH    ;DPB_FATID
002593 F2C7 01                      DB  1   ;DPB_SECPCL
002594 F2C8 5A00                    DW  90  ;DPB_MAXCL
002596 F2CA 00                      DB  0   ;DPB_FDMODE
002597 F2CB 06                      DB  6   ;DPB_DIRSCNT
002598 F2CC 00                      DB  0   ;DPB_MAXCYL
002599 F2CD 00                      DB  0   ;DPB_MAXSEC
00259A F2CE 01                      DB  1   ;DPB_FATPS
00259B F2CF 01                      DB  1   ;DPB_BPS
00259C F2D0 0200                    DW  2   ;DPB_DIRPS
00259E F2D2 05                      DB  005H    ;DPB_DEVICE
00259F F2D3 F8                      DB  0F8H    ;DPB_UNITNO
0025A0 F2D4 0600                    DW  6   ;DPB_ADDCL
0025A2 F2D6 0000                    DW  0   ;DPB_16
0025A4 F2D8 0000                    DW  0   ;DPB_18
0025A6 F2DA 0000                    DW  0   ;DPB_SDIR
0025A8 F2DC 4752414D                DB  "GRAM"  ;DPB_NAME
                                
                                ;   H:
0025AC F2E0                         DS  3
0025AF F2E3 00                      DB  0
[EOF:M7DPB.ASM:UTF_8]
                                
       A5B0                         ORG $$+OFFSET   ;$DEPHASE
       A5B0                     LAST_ADR:
                                
                                    END
[EOF:M7.ASM:UTF_8]
