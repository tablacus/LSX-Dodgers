                                ;*** AILZ80ASM *** Z-80 Assembler, version 1.0.0.0, LST:Full:4
                                ;   LSX-Dodgers for MZ-700/1500
                                ;   Programmed by
                                ;   Gaku (Lovers/Tablacus)
                                
                                    INCLUDE "M7DEF.ASM"
                                
                                ;   LSX-Dodgers DEF
                                ;   MZ-700/1500
                                
       0001                     MAC EQU 1   ;MZ-700/1500
       0000                     DEV EQU 0
                                
       011D                     VER_6F  EQU 0011DH
                                
       8080                     RUN EQU 08080H
       8000                     OFFSET  EQU RUN-128
       CF06                     BDOS    EQU 0CF06H
       ED40                     TABLEAD EQU 0ED40H
       F000                     WORKAD  EQU 0F000H
       F300                     FATBF   EQU 0F300H
       FB00                     DTBUF   EQU 0FB00H
       FF00                     KEYBF   EQU 0FF00H
       FF20                     KBUF    EQU 0FF20H
       FFD9                     TRAP38  EQU 0FFD9H
       0028                     WIDTH   EQU 40
       0019                     LINE    EQU 25
       0070                     COLORF  EQU 070H
       0010                     KEYSP_H EQU 16
       0083                     KEYSP_L EQU 131
       0009                     COMS    EQU 9
[EOF:M7DEF.ASM:UTF_8]
                                    INCLUDE "LDDEF.ASM"
                                
                                ;   LSX-Dodgers DEF
                                
       0001                     VER_1   EQU 1
       0006                     VER_2   EQU 6
       0000                     VER_3   EQU 0
       1D01                     MACW    EQU MAC + 01D00H    ;機種フラグとLD判別フラグ
       0001                     MACD    EQU MAC + DEV * 256 ;機種フラグとデバイスフラグ
       0160                     VER EQU VER_1 * 256 + VER_2 * 16 + VER_3
                                
       0005                     SYSTEM  EQU 00005H
       000F                     JP_HL   EQU 0000FH
       005C                     FCB1    EQU 0005CH
       006C                     FCB2    EQU 0006CH
       005D                     FCB1FN  EQU FCB1+1
       006D                     FCB2FN  EQU FCB2+1
       0080                     DTA1    EQU 00080H
                                
       FFCA                     EXTBIO  EQU 0FFCAH
                                
       0000                     DPB_FATLN   EQU 00H
       0002                     DPB_DRD     EQU 02H
       0004                     DPB_DWT     EQU 04H
       0006                     DPB_FATID   EQU 06H
       0007                     DPB_SECPCL  EQU 07H
       0008                     DPB_MAXCL   EQU 08H
       000A                     DPB_FDMODE  EQU 0AH
       000B                     DPB_DIRSCNT EQU 0BH
       000C                     DPB_MAXCYL  EQU 0CH
       000D                     DPB_MAXSEC  EQU 0DH
       000E                     DPB_FATPS   EQU 0EH
       000F                     DPB_BPS     EQU 0FH
       0010                     DPB_DIRPS   EQU 10H
       0012                     DPB_DEVICE  EQU 12H
       0013                     DPB_UNITNO  EQU 13H
       0014                     DPB_ADDCL   EQU 14H
                                
       001A                     DPB_SDIR    EQU 1AH
       001C                     DPB_NAME    EQU 1CH
                                
[EOF:LDDEF.ASM:SHIFT_JIS]
                                
000000 8000                         ORG OFFSET
                                                    ;MZTヘッダ128バイト
000000 8000 01                      DB  1           ;ファイルモード
000001 8001 4C44202020202020        DB  "LD           "     ;ファイル名(13)
            2020202020          
00000E 800E 535953                  DB  "SYS"           ;拡張子(3)
000011 8011 0D                      DB  $0D
000012 8012 3425                    DW  LAST_ADR-RUN        ;サイズ
000014 8014 8080                    DW  RUN         ;開始アドレス
000016 8016 8080                    DW  RUN         ;実行アドレス
000018 8018                         DS  104
                                
                                    INCLUDE "M7INIT.ASM"
                                
                                ;   LSX-Dodgers INIT
                                ;   MZ-700/1500
                                
000080 8080 C38780          10      JP  START
000083 8083 011D                    DW  MACW
000085 8085 6001                    DW  VER
                                
       8087                     START:
000087 8087 F3               4      DI
000088 8088 ED56             8      IM  1
00008A 808A 318780          10      LD  SP,START
00008D 808D CD9B80          17      CALL    INIT        ;NZならAUTOEXECを実行
000090 8090 210000          10      LD  HL,0
000093 8093 E5              11      PUSH    HL
000094 8094 C8              11      RET Z
000095 8095 117081          10      LD  DE,AUTOD
000098 8098 C3FDF0          10      JP  _COMANL
                                
       809B                     INIT:
00009B 809B D3E0            11      OUT (0E0H),A    ;DRAM(0000H-0FFFH)
00009D 809D D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
00009F 809F 21D681          10      LD  HL,INITE
0000A2 80A2 1106CF          10      LD  DE,BDOS
0000A5 80A5 01DE23          10      LD  BC,LAST_ADR-INITE
0000A8 80A8 EDB0                    LDIR
0000AA 80AA 21A781          10      LD  HL,M7BEEPD
0000AD 80AD 1162F0          10      LD  DE,BEEPD+1
0000B0 80B0 010800          10      LD  BC,M7BEEPE-M7BEEPD
0000B3 80B3 EDB0                    LDIR
                                
0000B5 80B5 210000          10      LD  HL,0
0000B8 80B8 065C             7      LD  B,05CH
0000BA 80BA 3E                      DB  03EH    ;LD A,??
0000BB 80BB EF              12      RST 28H
0000BC 80BC CDE9DB          17      CALL    FILL_MEMORY
0000BF 80BF 06A4             7      LD  B,0A4H
0000C1 80C1 AF               4      XOR A
0000C2 80C2 CDE9DB          17      CALL    FILL_MEMORY
                                
0000C5 80C5 3EC3             7      LD  A,0C3H      ;JP
0000C7 80C7 2103F0          10      LD  HL,CPM_WBOOT
0000CA 80CA 320000          13      LD  (00000H),A
0000CD 80CD 220100          16      LD  (00001H),HL ;IPL
                                
0000D0 80D0 21011D          10      LD  HL,MACW     ;3 bit7  DPB Compatible LA(1)
0000D3 80D3 220300          16      LD  (00003H),HL ;  bit6-0 Machine
                                ;               ;4 LSX-Dodgers(01DH)
0000D6 80D6 2106CF          10      LD  HL,BDOS
0000D9 80D9 320500          13      LD  (00005H),A
0000DC 80DC 220600          16      LD  (00006H),HL ;BDOS
                                
0000DF 80DF 21D9FF          10      LD  HL,TRAP38   ;TRAP38
0000E2 80E2 322800          13      LD  (00028H),A
0000E5 80E5 222900          16      LD  (00029H),HL ;RST 028H
                                
0000E8 80E8 323800          13      LD  (00038H),A
0000EB 80EB 211ACF          10      LD  HL,IO_INT8253
0000EE 80EE 223900          16      LD  (00039H),HL
                                
0000F1 80F1 3EF0             7      LD  A,CPM_BOOT/256
0000F3 80F3 320B00          13      LD  (0000BH),A
                                
0000F6 80F6 3EE9             7      LD  A,0E9H      ;JP (HL)
0000F8 80F8 320F00          13      LD  (0000FH),A
                                                    ;CHECK PCG(MZ-1500)
0000FB 80FB 2100E8          10      LD  HL,0E800H
0000FE 80FE 46               7      LD  B,(HL)
0000FF 80FF F3               4      DI
000100 8100 3E01             7      LD  A,1
000102 8102 D3E5            11      OUT (0E5H),A    ;MZ-1500: PCGバンク切り替え
000104 8104 4E               7      LD  C,(HL)
000105 8105 79               4      LD  A,C
000106 8106 C6A5             7      ADD A,0A5H
000108 8108 5F               4      LD  E,A
000109 8109 73               7      LD  (HL),E
00010A 810A D3E6            11      OUT (0E6H),A    ;MZ-1500: PCGバンクを閉じる
00010C 810C 71               7      LD  (HL),C
00010D 810D 3E01             7      LD  A,1
00010F 810F D3E5            11      OUT (0E5H),A    ;MZ-1500: PCGバンク切り替え
000111 8111 7E               7      LD  A,(HL)
000112 8112 BB               4      CP  E
000113 8113 D3E6            11      OUT (0E6H),A    ;MZ-1500: PCGバンクを閉じる
000115 8115 70               7      LD  (HL),B
000116 8116 FB               4      EI
000117 8117 2804            12      JR  Z,MZ1500
000119 8119 AF               4      XOR A       ;MZ-700はPCGバンクが存在しない
00011A 811A 32C0F2          13      LD  (GRAMFL),A
       811D                     MZ1500:
00011D 811D DD2180F2        14      LD  IX,EMMFL
000121 8121 CD6581          17      CALL    CHECK_EMM_BPB
000124 8124 FEEB             7      CP  0EBH
000126 8126 2810            12      JR  Z,EMM_BPB
000128 8128 DD360D02        19      LD  (IX+DPB_MAXSEC),2   ;BPBが512バイト目から始まる場合を調べる
00012C 812C CD6581          17      CALL    CHECK_EMM_BPB
00012F 812F DDBE06           7      CP  (IX+DPB_FATID)
000132 8132 2004            12      JR  NZ,EMM_BPB
000134 8134 DD360D00        19      LD  (IX+DPB_MAXSEC),0   ;BPBが先頭の場合に戻す
       8138                     EMM_BPB:
000138 8138 217C81          10      LD  HL,INIMES
00013B 813B CD8AD4          17      CALL    MSX
       813E                     INIT1:
00013E 813E F3               4      DI
00013F 813F 1100FF          10      LD  DE,0FF00H
000142 8142 0600             7      LD  B,0
000144 8144 CD27D3          17      CALL    ZERO_MEMORY_DE
000147 8147 21CAFF          10      LD  HL,EXTBIO
00014A 814A 36C9            10      LD  (HL),0C9H   ;RET
00014C 814C 23               6      INC HL
00014D 814D 060E             7      LD  B,TRAP38-EXTBIO-1
00014F 814F 3E                      DB  03EH    ;LD A,??
000150 8150 EF              12      RST 28H
000151 8151 CDE9DB          17      CALL    FILL_MEMORY
000154 8154 21AF81          10      LD  HL,AT_TRAP38
000157 8157 11D9FF          10      LD  DE,TRAP38
00015A 815A 012700          10      LD  BC,AT_TRAPE-AT_TRAP38
00015D 815D EDB0                    LDIR
                                
00015F 815F CDC4DA          17      CALL    CHKEY
000162 8162 FE03             7      CP  3
000164 8164 C9              10      RET
                                
       8165                     CHECK_EMM_BPB:
000165 8165 D5              11      PUSH    DE
000166 8166 110000          10      LD  DE,0
000169 8169 CD24EA          17      CALL    EADR
00016C 816C D1              10      POP DE
00016D 816D ED78            12      IN  A,(C)
00016F 816F C9              10      RET
                                
000170 8170 4155544F45584543    AUTOD:  DB  "AUTOEXEC "
            20                  
000179 8179 413A00              AUTODV: DB  "A:",0
                                
00017C 817C 0C4C53582D446F64    INIMES: DB  00CH,"LSX-Dodgers for MZ-700/1500 v"
            6765727320666F72    
            204D5A2D3730302F    
            313530302076        
00019A 819A 312E                    DB  030H + VER_1, '.'
00019C 819C 3630                    DB  030H + VER_2 ,030H + VER_3
00019E 819E 45                      DB  "E"
00019F 819F 2047616B750D0A          DB  ' Gaku',0DH,0AH
0001A6 81A6 00                      DB  0
                                
       81A7                     M7BEEPD:
0001A7 81A7 0801                    DB  8,1
0001A9 81A9 0736                    DB  7,036H
0001AB 81AB 04F9                    DB  4,0F9H
0001AD 81AD 0403                    DB  4,3
       81AF                     M7BEEPE:
                                
       81AF                     AT_TRAP38:
0001AF FFD9                         ORG TRAP38,AT_TRAP38-OFFSET
0001AF FFD9 210000          10      LD  HL,0
0001B2 FFDC E3              19      EX  (SP),HL
0001B3 FFDD 3E24             7      LD  A,'$'
0001B5 FFDF CD11D7          17      CALL    MSG_A
0001B8 FFE2 2B               6      DEC HL
0001B9 FFE3 7C               4      LD  A,H
0001BA FFE4 CDE8FF          17      CALL    PRHX
0001BD FFE7 7D               4      LD  A,L
       FFE8                     PRHX:
0001BE FFE8 F5              11      PUSH    AF
0001BF FFE9 07               4      RLCA
0001C0 FFEA 07               4      RLCA
0001C1 FFEB 07               4      RLCA
0001C2 FFEC 07               4      RLCA
0001C3 FFED CDF1FF          17      CALL    PRHX2
0001C6 FFF0 F1              10      POP AF
       FFF1                     PRHX2:
0001C7 FFF1 E60F             7      AND 00FH
0001C9 FFF3 FE0A             7      CP  10
0001CB FFF5 3F               4      CCF
0001CC FFF6 CE30             7      ADC A,'0'
0001CE FFF8 27               4      DAA
0001CF FFF9 C311D7          10      JP  MSG_A
0001D2 FFFC                         DS  4
       81D6                         ORG $$+OFFSET   ;$DEPHASE
       81D6                     AT_TRAPE:
                                
       81D6                     INITE:
0001D6 CF06                         ORG BDOS,INITE-OFFSET
                                
0001D6 CF06 C309CF          10      JP  IO_BDOS
[EOF:M7INIT.ASM:SHIFT_JIS]
                                    INCLUDE "M7BANK.ASM"
                                
                                ;   LSX-Dodgers IO
                                ;   MZ-700/1500
                                ;   VRAM/KEY/TIMER(0D000H-0EFFFH)にアクセスするので0D000H-0FFFFHに置けない部分
                                ;
                                
       CF09                     IO_BDOS:
0001D9 CF09 D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
0001DB CF0B C349D4          10      JP  BDOS0
                                
       CF0E                     RDKEYDATA:
0001DE CF0E F3               4      DI
0001DF CF0F D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
0001E1 CF11 3200E0          13      LD  (0E000H),A
0001E4 CF14 3A01E0          13      LD  A,(E001H)
0001E7 CF17 D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
0001E9 CF19 FB               4      EI
       CF1A                     IO_INT8253:
0001EA CF1A C9              10      RET
                                
       CF1B                     RD556VSYNC:
0001EB CF1B F3               4      DI
0001EC CF1C D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
0001EE CF1E 3A02E0          13      LD  A,(0E002H)
0001F1 CF21 D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
0001F3 CF23 FB               4      EI
0001F4 CF24 C9              10      RET
                                
       CF25                     RDMMIO:
0001F5 CF25 F3               4      DI
0001F6 CF26 D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
0001F8 CF28 7E               7      LD  A,(HL)
0001F9 CF29 D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
0001FB CF2B FB               4      EI
0001FC CF2C C9              10      RET
                                
       CF2D                     WRMMIO:
0001FD CF2D F3               4      DI
0001FE CF2E D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
000200 CF30 77               7      LD  (HL),A
000201 CF31 D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
000203 CF33 FB               4      EI
000204 CF34 C9              10      RET
                                
       CF35                     RDMMIO_BC:
000205 CF35 F3               4      DI
000206 CF36 D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
000208 CF38 0A               7      LD  A,(BC)
000209 CF39 D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
00020B CF3B FB               4      EI
00020C CF3C C9              10      RET
                                
       CF3D                     WRMMIO_BC:
00020D CF3D F3               4      DI
00020E CF3E D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
000210 CF40 02               7      LD  (BC),A
000211 CF41 D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
000213 CF43 FB               4      EI
000214 CF44 C9              10      RET
                                
       CF45                     IO_PRINT:
000215 CF45 F3               4      DI
000216 CF46 D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
000218 CF48 77               7      LD  (HL),A
000219 CF49 CBDC             8      SET 3,H
00021B CF4B 71               7      LD  (HL),C
00021C CF4C D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
00021E CF4E FB               4      EI
00021F CF4F C9              10      RET
                                
       CF50                     IO_CLR:
000220 CF50 F3               4      DI
000221 CF51 D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
       CF53                     C1AX1:
000223 CF53 7A               4      LD  A,D
000224 CF54 C6D0             7      ADD A,0D0H
000226 CF56 57               4      LD  D,A
000227 CF57 AF               4      XOR A
000228 CF58 12               7      LD  (DE),A      ;Text
000229 CF59 CBDA             8      SET 3,D
       CF5C                     ICSMC   EQU $+1
00022B CF5B 3E00             7      LD  A,0     ;自己書き換え
00022D CF5D 12               7      LD  (DE),A      ;Color
00022E CF5E 13               6      INC DE
00022F CF5F 7A               4      LD  A,D
000230 CF60 D6D8             7      SUB 0D8H
000232 CF62 57               4      LD  D,A
000233 CF63 2118FC          10      LD  HL,0-WIDTH*LINE
000236 CF66 19              11      ADD HL,DE
000237 CF67 30EA            12      JR  NC,C1AX1
000239 CF69 E1              10      POP HL
00023A CF6A D1              10      POP DE
00023B CF6B D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
00023D CF6D FB               4      EI
00023E CF6E C9              10      RET
                                
       CF6F                     IO_CLLINE:
00023F CF6F F3               4      DI
000240 CF70 D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
       CF72                     CLLINE1:
000242 CF72 CB9C             8      RES 3,H
000244 CF74 77               7      LD  (HL),A      ;Text
000245 CF75 CBDC             8      SET 3,H
000247 CF77 71               7      LD  (HL),C      ;Color
000248 CF78 23               6      INC HL
000249 CF79 10F7            13      DJNZ    CLLINE1
00024B CF7B D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
00024D CF7D FB               4      EI
00024E CF7E C9              10      RET
                                
       CF7F                     IO_INS:
00024F CF7F F3               4      DI
000250 CF80 D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
       CF82                     IO_INS1:
000252 CF82 CD99CF          17      CALL    C12S
000255 CF85 23               6      INC HL
000256 CF86 10FA            13      DJNZ    IO_INS1
000258 CF88 D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
00025A CF8A FB               4      EI
00025B CF8B C9              10      RET
                                
       CF8C                     IO_BS:
00025C CF8C F3               4      DI
00025D CF8D D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
       CF8F                     IO_BS1:
00025F CF8F CD99CF          17      CALL    C12S
000262 CF92 2B               6      DEC HL
000263 CF93 10F7            13      DJNZ    IO_BS
000265 CF95 D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
000267 CF97 FB               4      EI
000268 CF98 C9              10      RET
                                
       CF99                     C12S:
000269 CF99 CB9C             8      RES 3,H
00026B CF9B 5E               7      LD  E,(HL)
00026C CF9C 77               7      LD  (HL),A
00026D CF9D 7B               4      LD  A,E
00026E CF9E CBDC             8      SET 3,H
000270 CFA0 5E               7      LD  E,(HL)
000271 CFA1 71               7      LD  (HL),C
000272 CFA2 4B               4      LD  C,E
000273 CFA3 C9              10      RET
                                
       CFA4                     IO_SCRUP:
000274 CFA4 F3               4      DI
000275 CFA5 D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
       CFA7                     SCRUP1:
000277 CFA7 2815            12      JR  Z,SCRCL
000279 CFA9 D5              11      PUSH    DE
00027A CFAA E5              11      PUSH    HL
00027B CFAB CBDA             8      SET 3,D
00027D CFAD CBDC             8      SET 3,H
00027F CFAF 012800          10      LD  BC,WIDTH
000282 CFB2 EDB0                    LDIR
000284 CFB4 E1              10      POP HL
000285 CFB5 D1              10      POP DE
000286 CFB6 012800          10      LD  BC,WIDTH
000289 CFB9 EDB0                    LDIR
00028B CFBB 3D               4      DEC A
00028C CFBC 18E9            12      JR  SCRUP1
                                
       CFBE                     SCRCL:
00028E CFBE 0628             7      LD  B,WIDTH
000290 CFC0 EB               4      EX  DE,HL
000291 CFC1 D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
000293 CFC3 CD02D9          17      CALL    CLLINE
000296 CFC6 E1              10      POP HL
000297 CFC7 D1              10      POP DE
000298 CFC8 C1              10      POP BC
000299 CFC9 C9              10      RET
                                
       CFCA                     RD_PCG:
00029A CFCA F3               4      DI
00029B CFCB D3E5            11      OUT (0E5H),A    ;MZ-1500: PCGバンク切り替え
00029D CFCD 4E               7      LD  C,(HL)
       CFCE                     RW_PCG:
00029E CFCE D3E6            11      OUT (0E6H),A    ;MZ-1500: PCGバンクを閉じる
0002A0 CFD0 FB               4      EI
0002A1 CFD1 C9              10      RET
                                
       CFD2                     WR_PCG:
0002A2 CFD2 F3               4      DI
0002A3 CFD3 D3E5            11      OUT (0E5H),A    ;MZ-1500: PCGバンク切り替え
0002A5 CFD5 71               7      LD  (HL),C
0002A6 CFD6 18F6            12      JR  RW_PCG
                                
       CFD8                     C_MON:
0002A8 CFD8 D3E4            11      OUT (0E4H),A    ;MONITOR ROM(0000H-0FFFH) & VRAM/KEY/TIMER(D000H-FFFFH)
0002AA CFDA C7              12      RST 0
                                
       CFDB                     BANKE:
0002AB CFDB                         DS  0CFFEH-BANKE
[EOF:M7BANK.ASM:SHIFT_JIS]
                                    INCLUDE "M7CCP.ASM"
                                
                                ;   LSX-Dodgers CCP
                                ;   MZ-700/1500
                                
       CFFE                     WBOOT1:
0002CE CFFE D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)　ここは0CFFEH
0002D0 D000 D3E0            11      OUT (0E0H),A    ;DRAM(0000H-0FFHH)
0002D2 D002 F3               4      DI
0002D3 D003 3A94F0          13      LD  A,(_KEYSP)
0002D6 D006 ED7B0600        20      LD  SP,(SYSTEM+1)
0002DA D00A FB               4      EI
0002DB D00B 2192F0          10      LD  HL,_KEYD
0002DE D00E 3600            10      LD  (HL),0
0002E0 D010 CDC4DA          17      CALL    CHKEY
0002E3 D013 CD0DD7          17      CALL    KEYBC_IFBREAK
0002E6 D016 3E04             7      LD  A,4
0002E8 D018 CD11D7          17      CALL    MSG_A
[EOF:M7CCP.ASM:UTF_8]
                                    INCLUDE "LDCCP.ASM"
                                
                                ;   LSX-Dodgers CCP
                                
       D01B                     COMMAND:
0002EB D01B 3A22EB          13      LD  A,(FCB_BAT)
0002EE D01E B7               4      OR  A
0002EF D01F C261D1          10      JP  NZ,C_BAT1
0002F2 D022 CDD5D0          17      CALL    SETDTA1
0002F5 D025 3A87F0          13      LD  A,(_DVSW)
0002F8 D028 C641             7      ADD A,'A'
0002FA D02A CD11D7          17      CALL    MSG_A
0002FD D02D 3E3E             7      LD  A,'>'
0002FF D02F CD11D7          17      CALL    MSG_A
000302 D032 3E50             7      LD  A,80
000304 D034 12               7      LD  (DE),A
000305 D035 CD6DD7          17      CALL    _SYS0A      ;(BDOS)文字列入力
000308 D038 CD56D2          17      CALL    LTNL
       D03B                     COMMAND2:
00030B D03B 118200          10      LD  DE,DTA1+2
00030E D03E CDFDF0          17      CALL    _COMANL
000311 D041 30D8            12      JR  NC,COMMAND
000313 D043 1179F0          10      LD  DE,COMERM
000316 D046 CD7BD4          17      CALL    _SYS09      ;(BDOS)文字列出力
000319 D049 C7              12      RST 0
                                
       D04A                     COMANL:
00031A D04A CD3DDB          17      CALL    FILE
00031D D04D 3A19F0          13      LD  A,(FNAME+4)
000320 D050 FE20             7      CP  020H
000322 D052 201C            12      JR  NZ,COMB2
000324 D054 D5              11      PUSH    DE
000325 D055 1115F0          10      LD  DE,FNAME
000328 D058 1A               7      LD  A,(DE)
000329 D059 FE20             7      CP  020H
00032B D05B 2844            12      JR  Z,SDVSW
00032D D05D 1B               6      DEC DE
00032E D05E 1A               7      LD  A,(DE)
00032F D05F C6FF             7      ADD A,0FFH
000331 D061 3809            12      JR  C,COMB
000333 D063 13               6      INC DE
                                
000334 D064 2113D4          10      LD  HL,COMTB
000337 D067 0609             7      LD  B,COMS
000339 D069 CDCCDD          17      CALL    CPNAME
       D06C                     COMB:
00033C D06C D1              10      POP DE
00033D D06D D20F00          10      JP  NC,JP_HL
       D070                     COMB2:
000340 D070 EB               4      EX  DE,HL
000341 D071 223ED1          16      LD  (COMSWC),HL
000344 D074 F5              11      PUSH    AF
000345 D075 CDF6D0          17      CALL    CEXE4
000348 D078 F1              10      POP AF
000349 D079 2115F0          10      LD  HL,FNAME
00034C D07C 116D00          10      LD  DE,FCB2+1   ;COMMAND NAME
00034F D07F 010B00          10      LD  BC,11
000352 D082 EDB0                    LDIR
000354 D084 11C1EA          10      LD  DE,PATHD
       D087                     CEX1:
000357 D087 1A               7      LD  A,(DE)
000358 D088 FE20             7      CP  020H
00035A D08A D8              11      RET C
00035B D08B CD32DB          17      CALL    FILEC
00035E D08E D5              11      PUSH    DE
00035F D08F 216D00          10      LD  HL,FCB2+1   ;COMMAND NAME
000362 D092 1115F0          10      LD  DE,FNAME
000365 D095 010B00          10      LD  BC,11
000368 D098 EDB0                    LDIR
00036A D09A CDF6D0          17      CALL    CEXE4
00036D D09D D1              10      POP DE
00036E D09E 13               6      INC DE
00036F D09F 18E6            12      JR  CEX1
                                
       D0A1                     SDVSW:
000371 D0A1 F1              10      POP AF
000372 D0A2 3A14F0          13      LD  A,(FDRV)
000375 D0A5 3D               4      DEC A
000376 D0A6 5F               4      LD  E,A
000377 D0A7 0E0E             7      LD  C,00EH      ;(BDOS)カレントドライブの設定
000379 D0A9 1831            12      JR  SYSTEM0
                                
       D0AB                     OPEN1:
00037B D0AB 2114F0          10      LD  HL,FDRV
       D0AE                     OPEN:
00037E D0AE 0E11             7      LD  C,011H      ;(BDOS)ファイルの検索
       D0B0                     OPEN3:
000380 D0B0 D5              11      PUSH    DE
000381 D0B1 11FDEA          10      LD  DE,DTA_CCP
000384 D0B4 CDD2D0          17      CALL    SETDTA
000387 D0B7 EB               4      EX  DE,HL
000388 D0B8 CDDCD0          17      CALL    SYSTEM0
00038B D0BB D1              10      POP DE
00038C D0BC C9              10      RET
                                
       D0BD                     OPEN2:
00038D D0BD 0E12             7      LD  C,012H
00038F D0BF 18EF            12      JR  OPEN3
                                
       D0C1                     DEFCB:              ;Z=Ok NZ=Error
000391 D0C1 11FDEA          10      LD  DE,DTA_CCP
000394 D0C4 CDDAD0          17      CALL    SYSC0F
                                
000397 D0C7 111EEB          10      LD  DE,DTA_CCP+33   ;(FCB)ランダムレコード
00039A D0CA 0604             7      LD  B,4
00039C D0CC CD27D3          17      CALL    ZERO_MEMORY_DE
       D0CF                     SETDTA100:
00039F D0CF 110001          10      LD  DE,00100H
       D0D2                     SETDTA:
0003A2 D0D2 C34ED6          10      JP  _SYS1A      ;(BDOS)DTAの設定
                                
       D0D5                     SETDTA1:
0003A5 D0D5 118000          10      LD  DE,DTA1
0003A8 D0D8 18F8            12      JR  SETDTA
                                
       D0DA                     SYSC0F:
0003AA D0DA 0E0F             7      LD  C,00FH      ;(BDOS)ファイルのオープン
       D0DC                     SYSTEM0:
0003AC D0DC CD0500          17      CALL    SYSTEM
0003AF D0DF B7               4      OR  A
0003B0 D0E0 C9              10      RET
                                
       D0E1                     C_CD:
0003B1 D0E1 0E5A             7      LD  C,05AH
0003B3 D0E3 18F7            12      JR  SYSTEM0
                                
       D0E5                     S27BUF:
0003B5 D0E5 2100FE          10      LD  HL,-00200H  ;スクラッチエリア(0100H)+スタック予備(0100H)
0003B8 D0E8 39              11      ADD HL,SP
0003B9 D0E9 2E00             7      LD  L,0
0003BB D0EB 7C               4      LD  A,H
0003BC D0EC E6F8             7      AND 0F8H
0003BE D0EE 67               4      LD  H,A
       D0EF                     S27DTA:
0003BF D0EF 11FDEA          10      LD  DE,DTA_CCP
       D0F2                     S27:
0003C2 D0F2 0E27             7      LD  C,027H      ;(BDOS)ランダムブロック読み込み
0003C4 D0F4 18E6            12      JR  SYSTEM0
                                
       D0F6                     CEXE4:
0003C6 D0F6 211DF0          10      LD  HL,FNAME+8
0003C9 D0F9 7E               7      LD  A,(HL)
0003CA D0FA FE20             7      CP  020H
0003CC D0FC 2007            12      JR  NZ,CEXE7
0003CE D0FE 3E3F             7      LD  A,'?'
0003D0 D100 77               7      LD  (HL),A
0003D1 D101 23               6      INC HL
0003D2 D102 77               7      LD  (HL),A
0003D3 D103 23               6      INC HL
0003D4 D104 77               7      LD  (HL),A
       D105                     CEXE7:
0003D5 D105 CDABD0          17      CALL    OPEN1
       D108                     CEXE5:
0003D8 D108 C0              11      RET NZ
0003D9 D109 2A07EB          16      LD  HL,(DTA_CCP+1+9)
0003DC D10C 7C               4      LD  A,H
0003DD D10D CD54DE          17      CALL    CAP
0003E0 D110 67               4      LD  H,A
0003E1 D111 7D               4      LD  A,L
0003E2 D112 CD54DE          17      CALL    CAP
0003E5 D115 6F               4      LD  L,A
0003E6 D116 3A06EB          13      LD  A,(DTA_CCP+1+8)
0003E9 D119 CD54DE          17      CALL    CAP
0003EC D11C D642             7      SUB 'B'
0003EE D11E 282C            12      JR  Z,C_BAT
0003F0 D120 3D               4      DEC A       ;'C'
0003F1 D121 2805            12      JR  Z,C_EXE
       D123                     CEXE6:
0003F3 D123 CDBDD0          17      CALL    OPEN2
0003F6 D126 18E0            12      JR  CEXE5
                                
       D128                     C_EXE:
0003F8 D128 7C               4      LD  A,H
0003F9 D129 FE4D             7      CP  'M'
0003FB D12B 20F6            12      JR  NZ,CEXE6
                                
0003FD D12D CDC1D0          17      CALL    DEFCB
000400 D130 CDE5D0          17      CALL    S27BUF
000403 D133 3D               4      DEC A
000404 D134 37               4      SCF
000405 D135 C0              11      RET NZ
000406 D136 7C               4      LD  A,H
000407 D137 B5               4      OR  L
000408 D138 37               4      SCF
000409 D139 C8              11      RET Z
00040A D13A CDD5D0          17      CALL    SETDTA1
00040D D13D 110000          10      LD  DE,0                ; self-modifying code
       D13E                     COMSWC  EQU $-2
000410 D140 ED7B0600        20      LD  SP,(SYSTEM+1)
000414 D144 67               4      LD  H,A             ; A=0 in SETDTA1(_SYS1A)
000415 D145 6F               4      LD  L,A
000416 D146 E5              11      PUSH    HL              ; push $0000 (reboot address)
000417 D147 24               4      INC H
000418 D148 E5              11      PUSH    HL              ; push $0100 (TPA address)
000419 D149 C3F2D2          10      JP  SETFCB              ; and JP $0100
                                
       D14C                     C_BAT:
00041C D14C 114154          10      LD  DE,'A'+'T'*256
00041F D14F ED52            15      SBC HL,DE
000421 D151 20D0            12      JR  NZ,CEXE6
                                
000423 D153 CDC1D0          17      CALL    DEFCB
                                
000426 D156 21FDEA          10      LD  HL,DTA_CCP
000429 D159 1122EB          10      LD  DE,FCB_BAT
00042C D15C 012500          10      LD  BC,37
00042F D15F EDB0                    LDIR
       D161                     C_BAT1:
000431 D161 CDCFD0          17      CALL    SETDTA100
000434 D164 CD98D1          17      CALL    FGETC_BAT
000437 D167 218100          10      LD  HL,DTA1+1
00043A D16A 2025            12      JR  NZ,END_BATCH
00043C D16C FE21             7      CP  021H        ;スペースや改行など制御文字を飛ばす
00043E D16E 38F1            12      JR  C,C_BAT1
000440 D170 3620            10      LD  (HL),' '
000442 D172 23               6      INC HL
       D173                     C_BAT2:
000443 D173 77               7      LD  (HL),A
000444 D174 23               6      INC HL
000445 D175 7D               4      LD  A,L
000446 D176 3C               4      INC A       ;L==0FFH
000447 D177 2809            12      JR  Z,RUN_BATCH
000449 D179 CD98D1          17      CALL    FGETC_BAT
00044C D17C 2004            12      JR  NZ,RUN_BATCH
00044E D17E FE20             7      CP  020H
000450 D180 30F1            12      JR  NC,C_BAT2
       D182                     RUN_BATCH:
000452 D182 7D               4      LD  A,L
000453 D183 D67F             7      SUB DTA1-1
000455 D185 328000          13      LD  (DTA1),A
000458 D188 FE04             7      CP  4
00045A D18A 3805            12      JR  C,END_BATCH
00045C D18C 3600            10      LD  (HL),0
00045E D18E C33BD0          10      JP  COMMAND2
       D191                     END_BATCH:
000461 D191 AF               4      XOR A       ;バッチファイルを閉じる
000462 D192 3222EB          13      LD  (FCB_BAT),A
000465 D195 C300F0          10      JP  CPM_BOOT
                                
       D198                     FGETC_BAT:
000468 D198 1122EB          10      LD  DE,FCB_BAT
       D19B                     FGETC:              ;1文字ずつ読み込む
00046B D19B E5              11      PUSH    HL      ;Z:成功
00046C D19C 210100          10      LD  HL,1
00046F D19F CDF2D0          17      CALL    S27
000472 D1A2 E1              10      POP HL
000473 D1A3 3A0001          13      LD  A,(00100H)
000476 D1A6 C9              10      RET
                                
       D1A7                     C_DEL:
000477 D1A7 CDF2D2          17      CALL    SETFCB
00047A D1AA CD27D7          17      CALL    _SYS08      ;(BDOS)エコーなしコンソール入力
                                
00047D D1AD 0E13             7      LD  C,013H
00047F D1AF 180A            12      JR  CDEL1       ;(BDOS)ファイルの削除
                                
       D1B1                     C_REN:
000481 D1B1 CDF2D2          17      CALL    SETFCB
000484 D1B4 3E10             7      LD  A,010H      ;ディレクトリも対象にする
000486 D1B6 326900          13      LD  (FCB1+13),A ;属性
000489 D1B9 0E17             7      LD  C,017H      ;(BDOS)ファイル名の変更
       D1BB                     CDEL1:
00048B D1BB 115C00          10      LD  DE,FCB1
00048E D1BE CD0500          17      CALL    SYSTEM
000491 D1C1 C6FF             7      ADD A,0FFH
000493 D1C3 C9              10      RET
                                
       D1C4                     C_DIR:
000494 D1C4 CD32DB          17      CALL    FILEC
000497 D1C7 2115F0          10      LD  HL,FDRV+1
00049A D1CA CD08D4          17      CALL    CWILD1
00049D D1CD 3EF1             7      LD  A,0F1H
00049F D1CF 3221F0          13      LD  (FDRV+13),A
0004A2 D1D2 CDABD0          17      CALL    OPEN1
       D1D5                     CDIR1:
0004A5 D1D5 B7               4      OR  A
0004A6 D1D6 2008            12      JR  NZ,PDSKF
0004A8 D1D8 CD23D2          17      CALL    P_NAME
0004AB D1DB CDBDD0          17      CALL    OPEN2
0004AE D1DE 18F5            12      JR  CDIR1
       D1E0                     PDSKF:
0004B0 D1E0 3A14F0          13      LD  A,(FDRV)
0004B3 D1E3 5F               4      LD  E,A
0004B4 D1E4 0E1B             7      LD  C,01BH      ;(BDOS)ディスク情報の獲得
0004B6 D1E6 CD0500          17      CALL    SYSTEM
0004B9 D1E9 4F               4      LD  C,A     ;C←1クラスタ辺りの論理セクタ数
0004BA D1EA C601             7      ADD A,001H
0004BC D1EC D8              11      RET C       ;Aが0FFHだった場合
0004BD D1ED 3E06             7      LD  A,8-2
       D1EF                     PDS1:               ;HL=未使用クラスタの総数
0004BF D1EF 3C               4      INC A
0004C0 D1F0 CB19             8      RR  C
0004C2 D1F2 30FB            12      JR  NC,PDS1
       D1F4                     PDS2:               ;B←論理セクタのサイズの上位8ビット
0004C4 D1F4 3C               4      INC A
0004C5 D1F5 CB18             8      RR  B
0004C7 D1F7 30FB            12      JR  NC,PDS2
0004C9 D1F9 47               4      LD  B,A
                                
0004CA D1FA 110000          10      LD  DE,0
       D1FD                     PDS3:
0004CD D1FD 29              11      ADD HL,HL
0004CE D1FE EB               4      EX  DE,HL
0004CF D1FF ED6A            15      ADC HL,HL
0004D1 D201 EB               4      EX  DE,HL
0004D2 D202 10F9            13      DJNZ    PDS3
       D204                     PDSKF1:
0004D4 D204 CD90D2          17      CALL    PRDEC_DEHL
0004D7 D207 1152EB          10      LD  DE,FREE
0004DA D20A CD7BD4          17      CALL    _SYS09      ;(BDOS)文字列出力
0004DD D20D CD7DD2          17      CALL    PUTDRV
0004E0 D210 3E5C             7      LD  A,05CH      ;\
0004E2 D212 CD11D7          17      CALL    MSG_A
0004E5 D215 2A22F0          16      LD  HL,(FDRV+14)    ;ディレクトリのクラスタ番号
0004E8 D218 AF               4      XOR A
0004E9 D219 11FEFF          10      LD  DE,0-2
0004EC D21C 19              11      ADD HL,DE
0004ED D21D 23               6      INC HL
0004EE D21E DC8DD2          17      CALL    C,PRDEC_HL
0004F1 D221 1833            12      JR  LTNL
                                
       D223                     P_NAME:
0004F3 D223 3AFEEA          13      LD  A,(DTA_CCP+1)
0004F6 D226 FE2E             7      CP  '.'
0004F8 D228 C8              11      RET Z
                                
0004F9 D229 3A09EB          13      LD  A,(DTA_CCP+1+00BH)
0004FC D22C F5              11      PUSH    AF
0004FD D22D CB67             8      BIT 4,A
0004FF D22F 2808            12      JR  Z,DIR3
000501 D231 1147EB          10      LD  DE,DIRMES
000504 D234 CD7BD4          17      CALL    _SYS09      ;(BDOS)文字列出力
000507 D237 180A            12      JR  DIR6
       D239                     DIR3:
000509 D239 ED5B1CEB        20      LD  DE,(DTA_CCP+1+01EH)
00050D D23D 2A1AEB          16      LD  HL,(DTA_CCP+1+01CH)
000510 D240 CD90D2          17      CALL    PRDEC_DEHL
       D243                     DIR6:
000513 D243 F1              10      POP AF
000514 D244 0F               4      RRCA
000515 D245 9F               4      SBC A,A
000516 D246 E60A             7      AND '*'-020H
000518 D248 C620             7      ADD A,020H
00051A D24A CD11D7          17      CALL    MSG_A
00051D D24D CD7DD2          17      CALL    PUTDRV
000520 D250 21FEEA          10      LD  HL,DTA_CCP+1
000523 D253 CDD0D2          17      CALL    FPRNT
                                
       D256                     LTNL:
000526 D256 1E03             7      LD  E,3
000528 D258 C3CDF0          10      JP  _PRINT
                                
       D25B                     C_PATH:
00052B D25B CD14DC          17      CALL    SPCUT
00052E D25E 21C1EA          10      LD  HL,PATHD
000531 D261 FE21             7      CP  021H
000533 D263 300C            12      JR  NC,CPATH0
       D265                     CPATHP:
000535 D265 7E               7      LD  A,(HL)
000536 D266 23               6      INC HL
000537 D267 FE20             7      CP  020H
000539 D269 3F               4      CCF
00053A D26A 30EA            12      JR  NC,LTNL
00053C D26C CD11D7          17      CALL    MSG_A
00053F D26F 18F4            12      JR  CPATHP
       D271                     CPATH0:
000541 D271 FE3B             7      CP  ';'
000543 D273 2001            12      JR  NZ,CPATH1
000545 D275 13               6      INC DE
       D276                     CPATH1:
000546 D276 EB               4      EX  DE,HL
000547 D277 013B00          10      LD  BC,PATHX
00054A D27A EDB0                    LDIR
00054C D27C C9              10      RET
                                
       D27D                     PUTDRV:
00054D D27D 3A14F0          13      LD  A,(FDRV)
000550 D280 CD47DC          17      CALL    GETDRV1
000553 D283 C641             7      ADD A,'A'
000555 D285 CD11D7          17      CALL    MSG_A
000558 D288 3E3A             7      LD  A,':'
       D28A                     MSG_AR:
00055A D28A C311D7          10      JP  MSG_A
                                
       D28D                     PRDEC_HL:
00055D D28D AF               4      XOR A
00055E D28E 5F               4      LD  E,A
00055F D28F 57               4      LD  D,A
       D290                     PRDEC_DEHL:
000560 D290 D5              11      PUSH    DE
000561 D291 110FF0          10      LD  DE,DECBF
000564 D294 0605             7      LD  B,5
000566 D296 CD27D3          17      CALL    ZERO_MEMORY_DE  ;A=0
000569 D299 D1              10      POP DE
                                
00056A D29A 0E20             7      LD  C,32
       D29C                     DEC1:
00056C D29C 29              11      ADD HL,HL
00056D D29D EB               4      EX  DE,HL
00056E D29E ED6A            15      ADC HL,HL
000570 D2A0 EB               4      EX  DE,HL
000571 D2A1 E5              11      PUSH    HL
000572 D2A2 2113F0          10      LD  HL,DECBF+4
000575 D2A5 0605             7      LD  B,5
       D2A7                     DEC2:
000577 D2A7 7E               7      LD  A,(HL)
000578 D2A8 8F               4      ADC A,A
000579 D2A9 27               4      DAA
00057A D2AA 77               7      LD  (HL),A
00057B D2AB 2B               6      DEC HL
00057C D2AC 10F9            13      DJNZ    DEC2
00057E D2AE E1              10      POP HL
00057F D2AF 0D               4      DEC C
000580 D2B0 20EA            12      JR  NZ,DEC1
                                
000582 D2B2 210FF0          10      LD  HL,DECBF
000585 D2B5 3E20             7      LD  A,020H
000587 D2B7 0604             7      LD  B,4
       D2B9                     DEC3:
000589 D2B9 CDC6D2          17      CALL    DEC4
00058C D2BC CDC6D2          17      CALL    DEC4
00058F D2BF 23               6      INC HL
000590 D2C0 10F7            13      DJNZ    DEC3
       D2C2                     DECX:
000592 D2C2 CDC6D2          17      CALL    DEC4
000595 D2C5 AF               4      XOR A
       D2C6                     DEC4:
000596 D2C6 ED6F            18      RLD
000598 D2C8 FE20             7      CP  020H
00059A D2CA 2802            12      JR  Z,DEC5
00059C D2CC F630             7      OR  030H
       D2CE                     DEC5:
00059E D2CE 18BA            12      JR  MSG_AR
                                
       D2D0                     FPRNT:
0005A0 D2D0 0608             7      LD  B,8 ;ファイル名を表示
0005A2 D2D2 CDE1D2          17      CALL    P_N1
0005A5 D2D5 7E               7      LD  A,(HL)
0005A6 D2D6 CD60DE          17      CALL    CAP3
0005A9 D2D9 D8              11      RET C   ;拡張子が無い
                                
0005AA D2DA 3E2E             7      LD  A,'.'
0005AC D2DC CD11D7          17      CALL    MSG_A
0005AF D2DF 0603             7      LD  B,3 ;拡張子を表示
       D2E1                     P_N1:
0005B1 D2E1 7E               7      LD  A,(HL)
0005B2 D2E2 CD60DE          17      CALL    CAP3
0005B5 D2E5 3807            12      JR  C,P_N2
0005B7 D2E7 CD11D7          17      CALL    MSG_A
0005BA D2EA 23               6      INC HL
0005BB D2EB 10F4            13      DJNZ    P_N1
0005BD D2ED C9              10      RET
       D2EE                     P_N2:
0005BE D2EE 23               6      INC HL
0005BF D2EF 10FD            13      DJNZ    P_N2
0005C1 D2F1 C9              10      RET
                                
       D2F2                     SETFCB:
0005C2 D2F2 CD14DC          17      CALL    SPCUT
0005C5 D2F5 1A               7      LD  A,(DE)
0005C6 D2F6 FE20             7      CP  020H
0005C8 D2F8 3801            12      JR  C,SETFCBA
0005CA D2FA 1B               6      DEC DE
       D2FB                     SETFCBA:
0005CB D2FB 0624             7      LD  B,36
0005CD D2FD 215C00          10      LD  HL,FCB1
0005D0 D300 E5              11      PUSH    HL
0005D1 D301 AF               4      XOR A
0005D2 D302 CDE9DB          17      CALL    FILL_MEMORY
0005D5 D305 E1              10      POP HL
0005D6 D306 D5              11      PUSH    DE
0005D7 D307 CDB4D6          17      CALL    _SYS29      ;(BDOS)ファイル名の解析
0005DA D30A 216C00          10      LD  HL,FCB2
0005DD D30D CDB4D6          17      CALL    _SYS29      ;(BDOS)ファイル名の解析
0005E0 D310 E1              10      POP HL
0005E1 D311 010050          10      LD  BC,05000H
0005E4 D314 118100          10      LD  DE,00081H
       D317                     SETFCB1:
0005E7 D317 7E               7      LD  A,(HL)
0005E8 D318 23               6      INC HL
0005E9 D319 FE20             7      CP  020H
0005EB D31B 3805            12      JR  C,SETFCB2
0005ED D31D 12               7      LD  (DE),A
0005EE D31E 13               6      INC DE
0005EF D31F 0C               4      INC C
0005F0 D320 10F5            13      DJNZ    SETFCB1
       D322                     SETFCB2:
0005F2 D322 79               4      LD  A,C
0005F3 D323 328000          13      LD  (DTA1),A
0005F6 D326 04               4      INC B
       D327                     ZERO_MEMORY_DE:
0005F7 D327 AF               4      XOR A
       D328                     FILL_MEMORY_DE:
0005F8 D328 12               7      LD  (DE),A
0005F9 D329 13               6      INC DE
0005FA D32A 10FC            13      DJNZ    FILL_MEMORY_DE
0005FC D32C C9              10      RET
                                
       D32D                     C_COPY:
0005FD D32D CDF2D2          17      CALL    SETFCB
                                
000600 D330 1161F0          10      LD  DE,ZERO
000603 D333 CD35DB          17      CALL    FILEC2
000606 D336 216C00          10      LD  HL,FCB2
000609 D339 CDBBD6          17      CALL    S29X1
                                
00060C D33C 3E10             7      LD  A,010H
00060E D33E 326900          13      LD  (FCB1+13),A
000611 D341 216D00          10      LD  HL,FCB2+1
000614 D344 CD08D4          17      CALL    CWILD1
       D347                     COPY0:
000617 D347 CD05D4          17      CALL    CWILD
00061A D34A 215C00          10      LD  HL,FCB1
00061D D34D CDAED0          17      CALL    OPEN
000620 D350 37               4      SCF
       D351                     COPY1:
000621 D351 C0              11      RET NZ
000622 D352 CDC1D0          17      CALL    DEFCB
                                
000625 D355 3A0AEB          13      LD  A,(DTA_CCP+13)
000628 D358 CB67             8      BIT 4,A
00062A D35A 2821            12      JR  Z,COPY1A
                                
00062C D35C 215D00          10      LD  HL,FCB1+1
00062F D35F CD78DF          17      CALL    CHKWILD
000632 D362 3814            12      JR  C,COPY9
                                
000634 D364 3E20             7      LD  A,020H
000636 D366 325D00          13      LD  (FCB1+1),A
000639 D369 2A17EB          16      LD  HL,(DTA_CCP+26)
00063C D36C 23               6      INC HL
00063D D36D 226A00          16      LD  (FCB1+14),HL
000640 D370 18D5            12      JR  COPY0
                                
       D372                     COPY8:
000642 D372 CD7BD4          17      CALL    _SYS09      ;(BDOS)文字列出力
000645 D375 CD56D2          17      CALL    LTNL
       D378                     COPY9:
000648 D378 CDBDD0          17      CALL    OPEN2
00064B D37B 18D4            12      JR  COPY1
                                
       D37D                     COPY1A:
00064D D37D 216C00          10      LD  HL,FCB2
000650 D380 1114F0          10      LD  DE,FDRV
000653 D383 01FFEA          10      LD  BC,DTA_CCP+2
000656 D386 EDA0            16      LDI
000658 D388 3E0B             7      LD  A,11
       D38A                     COPY2:
00065A D38A F5              11      PUSH    AF
00065B D38B 7E               7      LD  A,(HL)
00065C D38C FE3F             7      CP  '?'
00065E D38E 2001            12      JR  NZ,COPY3
000660 D390 0A               7      LD  A,(BC)
       D391                     COPY3:
000661 D391 12               7      LD  (DE),A
000662 D392 03               6      INC BC
000663 D393 13               6      INC DE
000664 D394 23               6      INC HL
000665 D395 F1              10      POP AF
000666 D396 3D               4      DEC A
000667 D397 20F1            12      JR  NZ,COPY2
000669 D399 010500          10      LD  BC,16-11
00066C D39C EDB0                    LDIR
       D39E                     PUTNAME:
00066E D39E 215D00          10      LD  HL,FCB1+1
000671 D3A1 CD78DF          17      CALL    CHKWILD
000674 D3A4 300B            12      JR  NC,PUTN1
000676 D3A6 2115F0          10      LD  HL,FDRV+1
000679 D3A9 CDD0D2          17      CALL    FPRNT
00067C D3AC 3E20             7      LD  A,020H
00067E D3AE CD11D7          17      CALL    MSG_A
       D3B1                     PUTN1:
000681 D3B1 1114F0          10      LD  DE,FDRV
000684 D3B4 0E16             7      LD  C,016H      ;(BDOS)ファイルの作成
000686 D3B6 CDDCD0          17      CALL    SYSTEM0
000689 D3B9 2048            12      JR  NZ,COPYE2
00068B D3BB 67               4      LD  H,A     ;A=0
00068C D3BC 6F               4      LD  L,A
00068D D3BD 2235F0          16      LD  (FDRV+33),HL    ;(FCB)ランダムレコード
000690 D3C0 2237F0          16      LD  (FDRV+35),HL
       D3C3                     COPY6:
000693 D3C3 CDE5D0          17      CALL    S27BUF
000696 D3C6 47               4      LD  B,A
000697 D3C7 3C               4      INC A
000698 D3C8 2831            12      JR  Z,COPYE
00069A D3CA 7C               4      LD  A,H
00069B D3CB B5               4      OR  L
00069C D3CC 280C            12      JR  Z,COPY7
00069E D3CE 1114F0          10      LD  DE,FDRV
0006A1 D3D1 0E26             7      LD  C,026H      ;(BDOS)ランダムブロック書き込み
0006A3 D3D3 CDDCD0          17      CALL    SYSTEM0
0006A6 D3D6 2023            12      JR  NZ,COPYE
0006A8 D3D8 10E9            13      DJNZ    COPY6
       D3DA                     COPY7:
0006AA D3DA 3A0AEB          13      LD  A,(DTA_CCP+13)  ;(FCB)属性
0006AD D3DD 3221F0          13      LD  (FDRV+13),A
0006B0 D3E0 2111EB          10      LD  HL,DTA_CCP+20   ;(FCB)タイムスタンプ
0006B3 D3E3 1128F0          10      LD  DE,FDRV+20
0006B6 D3E6 010400          10      LD  BC,4
0006B9 D3E9 EDB0                    LDIR
                                
0006BB D3EB 1114F0          10      LD  DE,FDRV
0006BE D3EE 0E10             7      LD  C,010H      ;(BDOS)ファイルのクローズ
0006C0 D3F0 CDDCD0          17      CALL    SYSTEM0
0006C3 D3F3 2006            12      JR  NZ,COPYE
                                
0006C5 D3F5 1171F0          10      LD  DE,OK
0006C8 D3F8 C372D3          10      JP  COPY8
                                
       D3FB                     COPYE:
0006CB D3FB 1114F0          10      LD  DE,FDRV
0006CE D3FE 0E13             7      LD  C,013H      ;(BDOS)ファイルの削除
0006D0 D400 CD0500          17      CALL    SYSTEM
       D403                     COPYE2:
0006D3 D403 37               4      SCF
0006D4 D404 C9              10      RET
                                
       D405                     CWILD:
0006D5 D405 215D00          10      LD  HL,FCB1+1
       D408                     CWILD1:
0006D8 D408 7E               7      LD  A,(HL)
0006D9 D409 FE20             7      CP  020H
0006DB D40B C0              11      RET NZ
       D40C                     CWILD2:
0006DC D40C 3E3F             7      LD  A,'?'
0006DE D40E 060B             7      LD  B,11
0006E0 D410 C3E9DB          10      JP  FILL_MEMORY
                                
       D413                     COMTB:
0006E3 D413 44202020                DB  "D   "  ;1
0006E7 D417 C4D1                    DW  C_DIR
0006E9 D419 44495220                DB  "DIR "  ;2
0006ED D41D C4D1                    DW  C_DIR
0006EF D41F 434F5059                DB  "COPY"  ;3
0006F3 D423 2DD3                    DW  C_COPY
0006F5 D425 43442020                DB  "CD  "  ;4
0006F9 D429 E1D0                    DW  C_CD
0006FB D42B 44454C20                DB  "DEL "  ;5
0006FF D42F A7D1                    DW  C_DEL
000701 D431 50415448                DB  "PATH"  ;6
000705 D435 5BD2                    DW  C_PATH
000707 D437 52454E20                DB  "REN "  ;7
00070B D43B B1D1                    DW  C_REN
00070D D43D 52454D20                DB  "REM "  ;8
000711 D441 78D4                    DW  C_REM
[EOF:LDCCP.ASM:SHIFT_JIS]
                                    INCLUDE "M7CCP2.ASM"
                                
                                ;   LSX-Dodgers CCP2
                                ;   MZ-700/1500
                                
000713 D443 4D4F4E20                DB  "MON "  ;10
000717 D447 D8CF                    DW  C_MON
[EOF:M7CCP2.ASM:UTF_8]
                                    INCLUDE "LDOS.ASM"
                                
                                ;   LSX-Dodgers OS
                                
       D449                     BDOS0:
000719 D449 E5              11      PUSH    HL
00071A D44A 79               4      LD  A,C
00071B D44B FE3C             7      CP  03CH
00071D D44D 3802            12      JR  C,DOS1
00071F D44F 3E3C             7      LD  A,03CH
       D451                     DOS1:
000721 D451 87               4      ADD A,A
000722 D452 6F               4      LD  L,A
000723 D453 26F1             7      LD  H,STABLE/256
000725 D455 7E               7      LD  A,(HL)
000726 D456 2C               4      INC L
000727 D457 66               7      LD  H,(HL)
000728 D458 6F               4      LD  L,A
000729 D459 E3              19      EX  (SP),HL
00072A D45A 79               4      LD  A,C
                                ;確認用
                                ;   LD  (0050H),A
00072B D45B C9              10      RET
       D45C                     _DOS2:
00072C D45C FE5A             7      CP  05AH        ;(BDOS)カレントディレクトリの変更(_CHDIR)
00072E D45E CAF6D6          10      JP  Z,_SYS5A
000731 D461 FE5C             7      CP  05CH        ;(BDOS)ファイル名の解析(_PFILE)
000733 D463 CAB4D6          10      JP  Z,_SYS29
000736 D466 FE5F             7      CP  05FH        ;(BDOS)ディスクバッファのフラッシュ(_FLUSH)
000738 D468 CA74E8          10      JP  Z,_SYS5F
00073B D46B FE6F             7      CP  06FH        ;(BDOS)MSX-DOS のバージョン番号の獲得(_DOSVER)
00073D D46D 200A            12      JR  NZ,_ERROR
00073F D46F 011D01          10      LD  BC,VER_6F
000742 D472 116001          10      LD  DE,VER
000745 D475 210100          10      LD  HL,MACD
       D478                     C_REM:
000748 D478 AF               4      XOR A
       D479                     _ERROR:
000749 D479 A7               4      AND A
00074A D47A C9              10      RET
                                
       D47B                     _SYS09:     ;文字列出力
00074B D47B D5              11      PUSH    DE
       D47C                     _SX09:
00074C D47C 1A               7      LD  A,(DE)
00074D D47D 13               6      INC DE
00074E D47E FE24             7      CP  '$'
000750 D480 2831            12      JR  Z,SX0E2
000752 D482 CD11D7          17      CALL    MSG_A
000755 D485 18F5            12      JR  _SX09
                                
       D487                     MSX1:
000757 D487 CD11D7          17      CALL    MSG_A
       D48A                     MSX:
00075A D48A 7E               7      LD  A,(HL)
00075B D48B 23               6      INC HL
00075C D48C B7               4      OR  A
00075D D48D 20F8            12      JR  NZ,MSX1
00075F D48F C9              10      RET
                                
       D490                     _SYS0C:     ;(BDOS)バージョン番号の獲得
000760 D490 212200          10      LD  HL,00022H
000763 D493 7D               4      LD  A,L
000764 D494 C9              10      RET
                                
       D495                     _SYS0D:     ;(BDOS)ディスクリセット
000765 D495 CDDFF0          17      CALL    _FFLUSH
000768 D498 E5              11      PUSH    HL
000769 D499 218000          10      LD  HL,00080H
00076C D49C 228AF0          16      LD  (_DTA),HL
00076F D49F E1              10      POP HL
000770 D4A0 D5              11      PUSH    DE
000771 D4A1 1E00             7      LD  E,0
000773 D4A3 3E                      DB  03EH    ;次の PUSH DE をスキップ
                                
       D4A4                     _SYS0E:     ;(BDOS)カレントドライブの設定
000774 D4A4 D5              11      PUSH    DE
000775 D4A5 7B               4      LD  A,E
000776 D4A6 DDE5            15      PUSH    IX
000778 D4A8 CDDCF0          17      CALL    _GETDPB
00077B D4AB DDE1            14      POP IX
00077D D4AD 3804            12      JR  C,SX0E2
00077F D4AF 7B               4      LD  A,E
000780 D4B0 3287F0          13      LD  (_DVSW),A
       D4B3                     SX0E2:
000783 D4B3 D1              10      POP DE
000784 D4B4 C9              10      RET
                                
       D4B5                     _SYS0F:     ;(BDOS)ファイルのオープン
000785 D4B5 CD26DC          17      CALL    SETDRV
000788 D4B8 FD7E1C          19      LD  A,(IY+28)   ;(FCB)オープンモード
00078B D4BB C602             7      ADD A,002H      ;Write
00078D D4BD 2848            12      JR  Z,FEND0F
00078F D4BF CD74DF          17      CALL    CHKWILDX
                                
000792 D4C2 D450DC          17      CALL    NC,SOPENX
       D4C5                     _S16XX:
000795 D4C5 3840            12      JR  C,FEND0F
                                                ;Directory location
000797 D4C7 3A9FF0          13      LD  A,(_FILEN)
00079A D4CA FD7719          19      LD  (IY+25),A   ;(FCB)ディレクトリロケーション
                                ;               _DIRF
00079D D4CD 3AA0F0          13      LD  A,(_DIRF)
0007A0 D4D0 FD771D          19      LD  (IY+29),A   ;(FCB)ディレクトリモード
                                ;               _FBPS
0007A3 D4D3 FD731E          19      LD  (IY+30),E   ;(FCB)ディレクトリポジション
0007A6 D4D6 FD721F          19      LD  (IY+31),D
                                ;               Open(Read)
0007A9 D4D9 FD361CFF        19      LD  (IY+28),0FFH    ;(FCB)オープンモード
                                ;               FILENAME
0007AD D4DD FDE5            15      PUSH    IY
0007AF D4DF D1              10      POP DE
0007B0 D4E0 13               6      INC DE
0007B1 D4E1 010B00          10      LD  BC,11
0007B4 D4E4 EDB0                    LDIR
                                ;               Attribute
0007B6 D4E6 7E               7      LD  A,(HL)
0007B7 D4E7 FD770D          19      LD  (IY+13),A   ;(FCB)属性(アトリビュート)
0007BA D4EA 110B00          10      LD  DE,11       ;Reserved
0007BD D4ED 19              11      ADD HL,DE
                                                    ;(FCB)ファイルを最後に変更した時刻
0007BE D4EE 11E4F1          10      LD  DE,SDDATA       ;(FCB)ファイルを最後に変更した日付
0007C1 D4F1 060A             7      LD  B,SDDATAE-SDDATA    ;(FCB)ファイルの先頭クラスタ
       D4F3                     S16LOOP:                ;(FCB)ファイルのサイズ(バイト単位)
0007C3 D4F3 1A               7      LD  A,(DE)
0007C4 D4F4 13               6      INC DE
0007C5 D4F5 32FCD4          13      LD  (S16PAT),A
0007C8 D4F8 7E               7      LD  A,(HL)
0007C9 D4F9 23               6      INC HL
0007CA D4FA FD7700          19      LD  (IY+0),A
       D4FC                     S16PAT  EQU $-1
0007CD D4FD 10F4            13      DJNZ    S16LOOP
                                
0007CF D4FF AF               4      XOR A
0007D0 D500 FD770C          19      LD  (IY+12),A   ;(FCB)カレントブロック
0007D3 D503 FD22A4D5        20      LD  (OFCB_SWC),IY
       D507                     FEND0F:
0007D7 D507 1845            12      JR  FEND10
                                
       D509                     _SYS10:     ;(BDOS)ファイルのクローズ
0007D9 D509 CD26DC          17      CALL    SETDRV
0007DC D50C FD7E1C          19      LD  A,(IY+28)   ;(FCB)オープンモード
0007DF D50F D6FE             7      SUB 0FEH
0007E1 D511 37               4      SCF
0007E2 D512 3F               4      CCF
0007E3 D513 2039            12      JR  NZ,FEND10
       D515                     _S10A:              ;Write
0007E5 D515 FD770E          19      LD  (IY+14),A   ;(FCB)レコードサイズ/アクセスするディレクトリのクラスタ番号+1
0007E8 D518 FD770F          19      LD  (IY+15),A
                                
0007EB D51B FD341C          23      INC (IY+28)     ;(FCB)オープンモード 0FEH->0FFH
0007EE D51E CD70E0          17      CALL    SETTMS
                                
0007F1 D521 FD7E1D          19      LD  A,(IY+29)   ;(FCB)ディレクトリモード
0007F4 D524 32A0F0          13      LD  (_DIRF),A
0007F7 D527 E67F             7      AND 07FH
0007F9 D529 329BE5          13      LD  (_SECPS),A
0007FC D52C FD5E1E          19      LD  E,(IY+30)   ;(FCB)ディレクトリポジション
0007FF D52F FD561F          19      LD  D,(IY+31)
000802 D532 CD85DD          17      CALL    READ_DIR
000805 D535 3817            12      JR  C,FEND10
                                
000807 D537 3AB0DC          13  SDECM1: LD  A,(SDECPAT) ;1セクタ辺りのディレクトリエントリ数
00080A D53A 3D               4      DEC A       ;1024=01FH / 512=00FH / 256=7
00080B D53B FDA619          19      AND (IY+25)     ;(FCB)ディレクトリロケーション
00080E D53E 6F               4      LD  L,A
00080F D53F 2600             7      LD  H,0
000811 D541 29              11      ADD HL,HL       ;*2
000812 D542 29              11      ADD HL,HL       ;*4
000813 D543 29              11      ADD HL,HL       ;*8
000814 D544 29              11      ADD HL,HL       ;*16
000815 D545 29              11      ADD HL,HL       ;*32
000816 D546 ED4B7EF1        20      LD  BC,(_DTBUF)
00081A D54A 09              11      ADD HL,BC
                                
00081B D54B CD84DF          17      CALL    SDIRENT
       D54E                     FEND10:
00081E D54E 1842            12      JR  FEND
                                
       D550                     _SYS11:     ;(BDOS)最初のファイルの検索
000820 D550 CD26DC          17      CALL    SETDRV
000823 D553 CD7FDC          17      CALL    SOPEN
       D556                     _S12X1:
000826 D556 383A            12      JR  C,FEND
000828 D558 CD1EDD          17      CALL    SOPENE2
00082B D55B ED5B8AF0        20      LD  DE,(_DTA)
00082F D55F 3A88F0          13      LD  A,(_DRV)
000832 D562 3C               4      INC A
000833 D563 12               7      LD  (DE),A
000834 D564 D5              11      PUSH    DE
000835 D565 13               6      INC DE
000836 D566 012000          10      LD  BC,32
000839 D569 EDB0                    LDIR
00083B D56B FD6E0E          19      LD  L,(IY+14)   ;(FCB)レコードサイズ/アクセスするディレクトリのクラスタ番号+1
00083E D56E FD660F          19      LD  H,(IY+15)
000841 D571 22F4F1          16      LD  (SCDIR),HL
000844 D574 2A9AF0          16      LD  HL,(_FBPS)
000847 D577 22F6F1          16      LD  (SFBPS),HL
00084A D57A 2A9FF0          16      LD  HL,(_FILEN)
00084D D57D 7C               4      LD  A,H
00084E D57E B7               4      OR  A
00084F D57F 2806            12      JR  Z,_S12DIR
000851 D581 3A9BE5          13      LD  A,(_SECPS)
000854 D584 F680             7      OR  080H
000856 D586 67               4      LD  H,A
       D587                     _S12DIR:
000857 D587 22F8F1          16      LD  (SFNDF),HL  ;Directory position and Flags
00085A D58A E1              10      POP HL
00085B D58B 1139F0          10      LD  DE,SFILE
00085E D58E 0E21             7      LD  C,33
       D590                     _S11B:
000860 D590 EDB0                    LDIR
       D592                     FEND:
000862 D592 9F               4      SBC A,A     ;CF=0 A=0 : CF=1 A=0FFH
       D593                     FENDE:
000863 D593 FDE1            14      POP IY
000865 D595 C1              10      POP BC
000866 D596 D1              10      POP DE
000867 D597 E1              10      POP HL
000868 D598 C9              10      RET
                                
       D599                     _SYS12:     ;(BDOS)次のファイルの検索
000869 D599 E5              11      PUSH    HL
00086A D59A D5              11      PUSH    DE
00086B D59B C5              11      PUSH    BC
00086C D59C FDE5            15      PUSH    IY
00086E D59E CDE3DC          17      CALL    NOPEN
000871 D5A1 18B3            12      JR  _S12X1
                                
       D5A3                     _S16K:
000873 D5A3 110000          10      LD  DE,0
       D5A4                     OFCB_SWC    EQU $-2
000876 D5A6 D5              11      PUSH    DE
000877 D5A7 061A             7      LD  B,26        ;First cluster
       D5A9                     S16K1:
000879 D5A9 13               6      INC DE
00087A D5AA 23               6      INC HL
00087B D5AB 10FC            13      DJNZ    S16K1
                                
00087D D5AD 1A               7      LD  A,(DE)
00087E D5AE BE               7      CP  (HL)
00087F D5AF 2015            12      JR  NZ,S16K2
000881 D5B1 13               6      INC DE
000882 D5B2 23               6      INC HL
000883 D5B3 1A               7      LD  A,(DE)
000884 D5B4 BE               7      CP  (HL)
000885 D5B5 200F            12      JR  NZ,S16K2
                                
000887 D5B7 E1              10      POP HL
000888 D5B8 FDE5            15      PUSH    IY
00088A D5BA D1              10      POP DE
00088B D5BB 7E               7      LD  A,(HL)
00088C D5BC CD3BDC          17      CALL    IS_SAME_DRV_A_DE
00088F D5BF 2006            12      JR  NZ,S16K3
                                                ;ここはCFが必ず0
000891 D5C1 ED52            15      SBC HL,DE       ;CP HL,DE
000893 D5C3 37               4      SCF
000894 D5C4 C0              11      RET NZ
000895 D5C5 E5              11      PUSH    HL
       D5C6                     S16K2:
000896 D5C6 E1              10      POP HL
       D5C7                     S16K3:
000897 D5C7 FDE5            15      PUSH    IY
000899 D5C9 D1              10      POP DE
       D5CA                     _SYS13:     ;(BDOS)ファイルの削除
00089A D5CA CD26DC          17      CALL    SETDRV
00089D D5CD CDAADE          17      CALL    KILL
       D5D0                     FEND13:
0008A0 D5D0 18C0            12      JR  FEND
                                
       D5D2                     _SYS14:     ;(BDOS)シーケンシャルな読み出し
0008A2 D5D2 CD26DC          17      CALL    SETDRV
0008A5 D5D5 CDDCE0          17      CALL    INIT_SEQ
       D5D8                     SREAD:
0008A8 D5D8 CD24E1          17      CALL    RB_READ
                                
0008AB D5DB C601             7      ADD A,001H
0008AD D5DD 38B3            12      JR  C,FEND
                                
0008AF D5DF 7D               4      LD  A,L
0008B0 D5E0 D601             7      SUB 001H
       D5E2                     FENDX:
0008B2 D5E2 9F               4      SBC A,A
0008B3 D5E3 E603             7      AND 3
0008B5 D5E5 1F               4      RRA
0008B6 D5E6 18AB            12      JR  FENDE
                                
       D5E8                     _SYS15:     ;(BDOS)シーケンシャルな書き込み
0008B8 D5E8 CD26DC          17      CALL    SETDRV
0008BB D5EB CDDCE0          17      CALL    INIT_SEQ
       D5EE                     SWRITE:
0008BE D5EE CD1DE1          17      CALL    RB_WRITE
                                
0008C1 D5F1 C6FF             7      ADD A,0FFH
0008C3 D5F3 18ED            12      JR  FENDX
                                
       D5F5                     _SYS17:     ;(BDOS)ファイル名の変更
0008C5 D5F5 CD26DC          17      CALL    SETDRV
0008C8 D5F8 CD00DF          17      CALL    NAME
0008CB D5FB 18D3            12      JR  FEND13
                                
       D5FD                     _SYS16:     ;(BDOS)ファイルの作成
0008CD D5FD CD26DC          17      CALL    SETDRV
                                
0008D0 D600 CD74DF          17      CALL    CHKWILDX
0008D3 D603 38CB            12      JR  C,FEND13
0008D5 D605 FD7E01          19      LD  A,(IY+1)    ;(FCB)主ファイル名
0008D8 D608 FE05             7      CP  5
0008DA D60A 2805            12      JR  Z,_S16X2
0008DC D60C FE21             7      CP  021H
0008DE D60E DAD0D5          10      JP  C,FEND13
       D611                     _S16X2:
                                ;               Clear FCB
0008E1 D611 FDE5            15      PUSH    IY
0008E3 D613 E1              10      POP HL
0008E4 D614 011000          10      LD  BC,16
0008E7 D617 09              11      ADD HL,BC
       D618                     _S16X1:
0008E8 D618 70               7      LD  (HL),B      ;B=0
0008E9 D619 23               6      INC HL
0008EA D61A 0D               4      DEC C
0008EB D61B 20FB            12      JR  NZ,_S16X1
                                
0008ED D61D CD75E0          17      CALL    SETTMSX
0008F0 D620 FD360DFF        19      LD  (IY+13),0FFH    ;(FCB)Attribute
0008F4 D624 CD50DC          17      CALL    SOPENX
0008F7 D627 3F               4      CCF
0008F8 D628 CCA3D5          17      CALL    Z,_S16K
0008FB D62B D42FDD          17      CALL    NC,COPEN
0008FE D62E D484DF          17      CALL    NC,SDIRENT
000901 D631 C3C5D4          10      JP  _S16XX
                                
       D634                     _SYS21:     ;(BDOS)ランダムな読み出し
000904 D634 CD26DC          17      CALL    SETDRV
000907 D637 CDC0E0          17      CALL    INIT_RND
00090A D63A 189C            12      JR  SREAD
                                
       D63C                     _SYS22:     ;(BDOS)ランダムな書き込み
       D63C                     _SYS28:     ;(BDOS)ランダムな書き込み・その2
00090C D63C CD26DC          17      CALL    SETDRV
00090F D63F CDC0E0          17      CALL    INIT_RND
000912 D642 18AA            12      JR  SWRITE
                                
       D644                     _SYS18:     ;(BDOS)ログインベクトルの獲得
000914 D644 21FF00          10      LD  HL,000FFH
000917 D647 AF               4      XOR A
000918 D648 C9              10      RET
                                
       D649                     _SYS19:     ;(BDOS)カレントドライブ番号の獲得
000919 D649 3A87F0          13      LD  A,(_DVSW)
00091C D64C A7               4      AND A
00091D D64D C9              10      RET
                                
       D64E                     _SYS1A:     ;(BDOS)DTAの設定
00091E D64E ED538AF0        20      LD  (_DTA),DE
000922 D652 AF               4      XOR A
000923 D653 C9              10      RET
                                
       D654                     _SYS1B:     ;(BDOS)ディスク情報の獲得
000924 D654 7B               4      LD  A,E
000925 D655 CD34DC          17      CALL    GETDRV
000928 D658 CDDCF0          17      CALL    _GETDPB
00092B D65B D4E2F0          17      CALL    NC,_RDFATX
00092E D65E 210000          10      LD  HL,0
000931 D661 D44EE0          17      CALL    NC,DSKF
                                
000934 D664 ED5B4FE0        20      LD  DE,(MAXCLP) ;DPB_MAXCL-1
000938 D668 1B               6      DEC DE      ;DE←クラスタの総数
000939 D669 FD2A7CF1        20      LD  IY,(_FATBF) ;IY←メモリ上のFATの先頭アドレス
00093D D66D 9F               4      SBC A,A
00093E D66E D8              11      RET C
00093F D66F 4F               4      LD  C,A     ;C=0
000940 D670 DD7E0F          19      LD  A,(IX+DPB_BPS)
000943 D673 E607             7      AND 7
000945 D675 47               4      LD  B,A
000946 D676 DD7E07          19      LD  A,(IX+DPB_SECPCL)
000949 D679 C9              10      RET
                                
       D67A                     _SYS1D:     ;(BDOS)書き込みが禁止されているディスクの調査
00094A D67A AF               4      XOR A
00094B D67B 67               4      LD  H,A
00094C D67C 6F               4      LD  L,A
00094D D67D C9              10      RET
                                
       D67E                     _SYS1F:     ;(BDOS)ディスク装置のパラメータの読み出し
00094E D67E 2100F2          10      LD  HL,_DEVICE
000951 D681 7B               4      LD  A,E
000952 D682 C3DCF0          10      JP  _GETDPB
                                
       D685                     _SYS23:     ;(BDOS)ファイルサイズの獲得
000955 D685 E5              11      PUSH    HL
000956 D686 2A1EF1          16      LD  HL,(STABLE+2*00FH)  ;ファイルのオープン
000959 D689 CD0F00          17      CALL    JP_HL
00095C D68C 381B            12      JR  C,_S23X1
                                
00095E D68E D5              11      PUSH    DE      ;EX DE,IY
00095F D68F FDE3            23      EX  (SP),IY     ;
                                ;   POP DE      ;
                                ;   PUSH    DE      ;DEを破壊しないように注意vv
000961 D691 FD7E10          19      LD  A,(IY+16)   ;(FCB)ファイルのサイズ(バイト単位)
000964 D694 FD6E11          19      LD  L,(IY+17)   ;
000967 D697 FD6612          19      LD  H,(IY+18)   ;
00096A D69A C5              11      PUSH    BC      ;
00096B D69B FD4613          19      LD  B,(IY+19)   ;
00096E D69E CDB2E0          17      CALL    GET_CPM_R_SIZE
000971 D6A1 C1              10      POP BC
       D6A2                     _S24X1:
000972 D6A2 CDD2E0          17      CALL    SET_RR_AHL
                                ;   POP DE      ;^^^^^^^^^^^^^^^^^^^^^^^^
                                ;   PUSH    DE      ;EX DE,IY
000975 D6A5 FDE3            23      EX  (SP),IY     ;
000977 D6A7 D1              10      POP DE      ;
                                
000978 D6A8 AF               4      XOR A
       D6A9                     _S23X1:
000979 D6A9 E1              10      POP HL
00097A D6AA C9              10      RET
                                
       D6AB                     _SYS24:     ;(BDOS)ランダムレコードフィールドの設定
00097B D6AB E5              11      PUSH    HL
00097C D6AC D5              11      PUSH    DE      ;EX DE,IY
00097D D6AD FDE3            23      EX  (SP),IY     ;
                                ;   POP DE      ;
                                ;   PUSH    DE      ;DEを破壊しないように注意vv
00097F D6AF CDE4E0          17      CALL    GETSEQ
000982 D6B2 18EE            12      JR  _S24X1      ;^^^^^^^^^^^^^^^^^^^^^^^^
                                
       D6B4                     _SYS29:     ;(BDOS)ファイル名の解析(_PPATH)
000984 D6B4 C5              11      PUSH    BC
000985 D6B5 E5              11      PUSH    HL
000986 D6B6 CD3DDB          17      CALL    FILE
000989 D6B9 E1              10      POP HL
00098A D6BA C1              10      POP BC
       D6BB                     S29X1:
00098B D6BB C5              11      PUSH    BC
00098C D6BC D5              11      PUSH    DE
00098D D6BD E5              11      PUSH    HL
00098E D6BE EB               4      EX  DE,HL
00098F D6BF AF               4      XOR A
000990 D6C0 3221F0          13      LD  (FDRV+13),A
000993 D6C3 2114F0          10      LD  HL,FDRV
000996 D6C6 011000          10      LD  BC,16
000999 D6C9 EDB0                    LDIR
00099B D6CB E1              10      POP HL
00099C D6CC D1              10      POP DE
00099D D6CD C1              10      POP BC
00099E D6CE C9              10      RET
                                
       D6CF                     _SYS30:     ;(BDOS)論理セクタを用いた書き込み
00099F D6CF C5              11      PUSH    BC
0009A0 D6D0 0133E7          10      LD  BC,DWT24B
0009A3 D6D3 1804            12      JR  S2FX
       D6D5                     _SYS2F:
0009A5 D6D5 C5              11      PUSH    BC
0009A6 D6D6 0123E7          10      LD  BC,DRD24B
       D6D9                     S2FX:
0009A9 D6D9 ED43EFD6        20      LD  (S2FPAT+1),BC
0009AD D6DD CDDFF0          17      CALL    _FFLUSH
                                
0009B0 D6E0 D5              11      PUSH    DE
0009B1 D6E1 E5              11      PUSH    HL
0009B2 D6E2 7D               4      LD  A,L     ;Drive
0009B3 D6E3 CDD9F0          17      CALL    _CHGDRV
0009B6 D6E6 3809            12      JR  C,S30X2
0009B8 D6E8 44               4      LD  B,H     ;Number of clusters
0009B9 D6E9 2A8AF0          16      LD  HL,(_DTA)
                                
0009BC D6EC 0E00             7      LD  C,0
0009BE D6EE CD23E7          17  S2FPAT: CALL    DRD24B
       D6F1                     S30X2:
0009C1 D6F1 E1              10      POP HL
0009C2 D6F2 D1              10      POP DE
0009C3 D6F3 C1              10      POP BC
0009C4 D6F4 9F               4      SBC A,A
0009C5 D6F5 C9              10      RET
                                
       D6F6                     _SYS5A:     ;(BDOS)カレントディレクトリの変更
0009C6 D6F6 C5              11      PUSH    BC
0009C7 D6F7 D5              11      PUSH    DE
0009C8 D6F8 E5              11      PUSH    HL
0009C9 D6F9 CD32DB          17      CALL    FILEC
0009CC D6FC 210000          10      LD  HL,0
0009CF D6FF 1114F0          10      LD  DE,FDRV
0009D2 D702 2A4EF1          16      LD  HL,(STABLE+2*027H)  ;ランダムブロック読み込み
0009D5 D705 CD0F00          17      CALL    JP_HL
0009D8 D708 18E7            12      JR  S30X2
[EOF:LDOS.ASM:SHIFT_JIS]
                                    INCLUDE "M7IO.ASM"
                                
                                ;   LSX-Dodgers IO
                                ;   MZ-700/1500
                                
       D479                     _SYS04  EQU _ERROR      ;(BDOS)外部出力
       D479                     _SYS05  EQU _ERROR      ;(BDOS)プリンタ出力
       D479                     _SYS1C  EQU _ERROR      ;(BDOS)ディスクの書き込み禁止化
       D479                     _SYS1E  EQU _ERROR      ;(BDOS)ファイル属性の設定
       D479                     _SYS20  EQU _ERROR      ;(BDOS)利用者番号の設定と読み出し
       D479                     _SYS2E  EQU _ERROR      ;(BDOS)ベリファイ・フラグの設定
                                
       0000                     INT EQU 0
       0000                     INTCTCE EQU 0
       0000                     INTCTC2 EQU 0
                                
       D70A                     POP_AF_HL_SCF_RET:
0009DA D70A F1              10      POP AF
0009DB D70B E1              10      POP HL
0009DC D70C 37               4      SCF
       D70D                     KEYBC_IFBREAK:
0009DD D70D C9              10      RET
                                
       D70E                     _SYS01:     ;(BDOS)コンソール入力
0009DE D70E CD09F0          17      CALL    _SYS07
       D711                     MSG_A:
0009E1 D711 F5              11      PUSH    AF
0009E2 D712 D5              11      PUSH    DE
0009E3 D713 5F               4      LD  E,A
0009E4 D714 CD1AD7          17      CALL    _SYS02
0009E7 D717 D1              10      POP DE
0009E8 D718 F1              10      POP AF
0009E9 D719 C9              10      RET
                                
       D71A                     _SYS02:     ;(BDOS)コンソール出力
0009EA D71A CD2CD7          17      CALL    BREAK
0009ED D71D 1805            12      JR  PRINTX
                                
       D71F                     _SYS06:     ;(BDOS)コンソール直接入出力
0009EF D71F 7B               4      LD  A,E
0009F0 D720 3C               4      INC A
0009F1 D721 CACAF0          10      JP  Z,_INKEY
       D724                     PRINTX:
0009F4 D724 C3CDF0          10      JP  _PRINT
                                
       D727                     _SYS08:     ;(BDOS)エコーなしコンソール入力
0009F7 D727 CD09F0          17      CALL    _SYS07
0009FA D72A 1803            12      JR  BREAK1
       D72C                     BREAK:
0009FC D72C CDC4DA          17      CALL    CHKEY
       D72F                     BREAK1:
0009FF D72F FE03             7      CP  3       ;CTRL+C
000A01 D731 CA00F0          10      JP  Z,CPM_BOOT
000A04 D734 FE13             7      CP  013H        ;CTRL+S
000A06 D736 C0              11      RET NZ
                                
       D737                     PAUSE:
       D737                     FLGET:
000A07 D737 CDDFF0          17      CALL    _FFLUSH
000A0A D73A E5              11      PUSH    HL
000A0B D73B 2A8EF0          16      LD  HL,(_TXADR)
000A0E D73E 7C               4      LD  A,H
000A0F D73F C6D0             7      ADD A,0D0H
000A11 D741 67               4      LD  H,A
000A12 D742 CD25CF          17      CALL    RDMMIO
000A15 D745 325AD7          13      LD  (FLSMC),A
       D748                     FLGET1:
000A18 D748 CD1BCF          17      CALL    RD556VSYNC
000A1B D74B CB77             8      BIT 6,A
000A1D D74D 3EEF             7      LD  A,0EFH      ;カーソル
000A1F D74F 200A            12      JR  NZ,FLGET2
000A21 D751 3A92F0          13      LD  A,(_KEYD)
000A24 D754 B7               4      OR  A
000A25 D755 3EEF             7      LD  A,0EFH      ;カーソル
000A27 D757 2002            12      JR  NZ,FLGET2
000A29 D759 3E00             7      LD  A,0     ;自己書き換え
       D75A                     FLSMC   EQU $-1
       D75B                     FLGET2:
000A2B D75B CD2DCF          17      CALL    WRMMIO
000A2E D75E CDCAF0          17      CALL    _INKEY
000A31 D761 28E5            12      JR  Z,FLGET1
000A33 D763 F5              11      PUSH    AF
000A34 D764 3A5AD7          13      LD  A,(FLSMC)
000A37 D767 CD2DCF          17      CALL    WRMMIO
000A3A D76A F1              10      POP AF
000A3B D76B E1              10      POP HL
000A3C D76C C9              10      RET
                                
       D76D                     _SYS0A:     ;(BDOS)文字列入力
000A3D D76D C5              11      PUSH    BC
000A3E D76E E5              11      PUSH    HL
000A3F D76F D5              11      PUSH    DE
000A40 D770 CDFDD9          17      CALL    GETL
000A43 D773 1120FF          10      LD  DE,KBUF
000A46 D776 E1              10      POP HL
000A47 D777 E5              11      PUSH    HL
000A48 D778 0E00             7      LD  C,0
000A4A D77A 3004            12      JR  NC,SAX0
000A4C D77C 23               6      INC HL
000A4D D77D 23               6      INC HL
000A4E D77E 1808            12      JR  SAX4
       D780                     SAX0:
000A50 D780 46               7      LD  B,(HL)
000A51 D781 23               6      INC HL
       D782                     SAX1:
000A52 D782 23               6      INC HL
000A53 D783 1A               7      LD  A,(DE)
000A54 D784 13               6      INC DE
000A55 D785 B7               4      OR  A
000A56 D786 2004            12      JR  NZ,SAX2
       D788                     SAX4:
000A58 D788 360D            10      LD  (HL),00DH
000A5A D78A 1804            12      JR  SAX3
       D78C                     SAX2:
000A5C D78C 77               7      LD  (HL),A
000A5D D78D 0C               4      INC C
000A5E D78E 10F2            13      DJNZ    SAX1
       D790                     SAX3:
000A60 D790 D1              10      POP DE
000A61 D791 79               4      LD  A,C
000A62 D792 13               6      INC DE
000A63 D793 12               7      LD  (DE),A
000A64 D794 1B               6      DEC DE
000A65 D795 E1              10      POP HL
000A66 D796 C1              10      POP BC
000A67 D797 A7               4      AND A
000A68 D798 C9              10      RET
                                
       D799                     _SYS0B:     ;(BDOS)コンソール状態のチェック
000A69 D799 CD2CD7          17      CALL    BREAK
       D79C                     CONSTX:
000A6C D79C AF               4      XOR A
000A6D D79D 3291DA          13      LD  (SKIP_KEYWAIT),A
000A70 D7A0 CDC4DA          17      CALL    CHKEY
000A73 D7A3 C8              11      RET Z
000A74 D7A4 CDDFF0          17      CALL    _FFLUSH
000A77 D7A7 37               4      SCF
000A78 D7A8 9F               4      SBC A,A
000A79 D7A9 C9              10      RET
                                
       D7AA                     _SYS2A:     ;(BDOS)日付の獲得
000A7A D7AA AF               4      XOR A
000A7B D7AB 57               4      LD  D,A
000A7C D7AC 5F               4      LD  E,A
000A7D D7AD 67               4      LD  H,A
000A7E D7AE 6F               4      LD  L,A
000A7F D7AF C9              10      RET
                                
       D7B0                     _SYS2C:     ;(BDOS)時刻の獲得
000A80 D7B0 AF               4      XOR A
000A81 D7B1 57               4      LD  D,A
000A82 D7B2 5F               4      LD  E,A
000A83 D7B3 67               4      LD  H,A
000A84 D7B4 6F               4      LD  L,A
000A85 D7B5 C9              10      RET
                                
       D7B6                     ESC1:
000A86 D7B6 7B               4      LD  A,E
000A87 D7B7 FE41             7      CP  'A'
000A89 D7B9 CAAED8          10      JP  Z,CTRL1E
000A8C D7BC FE42             7      CP  'B'
000A8E D7BE CAC0D9          10      JP  Z,CTRL1F
000A91 D7C1 FE43             7      CP  'C'
000A93 D7C3 CA81D8          10      JP  Z,CTRL1C
000A96 D7C6 FE44             7      CP  'D'
000A98 D7C8 CAA5D8          10      JP  Z,CTRL1D
000A9B D7CB FE45             7      CP  'E'
000A9D D7CD 2802            12      JR  Z,CT0CX
000A9F D7CF FE6A             7      CP  'j'
       D7D1                     CT0CX:
000AA1 D7D1 CAA5D9          10      JP  Z,CTRL0C
000AA4 D7D4 FE48             7      CP  'H'
000AA6 D7D6 CA22D9          10      JP  Z,CTRL0B
000AA9 D7D9 FE4A             7      CP  'J'
000AAB D7DB CAA8D9          10      JP  Z,CTRL06
000AAE D7DE FE4B             7      CP  'K'
000AB0 D7E0 CAF4D8          10      JP  Z,CTRL05
000AB3 D7E3 FE4C             7      CP  'L'
000AB5 D7E5 CAD2D9          10      JP  Z,CTRL0E
000AB8 D7E8 FE54             7      CP  'T'
000ABA D7EA CAF4D8          10      JP  Z,CTRL05
000ABD D7ED FE78             7      CP  'x'
000ABF D7EF 2804            12      JR  Z,ESC1X
000AC1 D7F1 FE79             7      CP  'y'
000AC3 D7F3 2002            12      JR  NZ,ESC1Y
       D7F5                     ESC1X:
000AC5 D7F5 3601            10      LD  (HL),1
       D7F7                     ESC1Y:
000AC7 D7F7 FE3D             7      CP  '='
000AC9 D7F9 2804            12      JR  Z,ESC1W
000ACB D7FB FE59             7      CP  'Y'
000ACD D7FD 2002            12      JR  NZ,ESC1Z
       D7FF                     ESC1W:
000ACF D7FF 3602            10      LD  (HL),2
       D801                     ESC1Z:
000AD1 D801 FE20             7      CP  020H
000AD3 D803 3802            12      JR  C,ESC1C
000AD5 D805 87               4      ADD A,A
000AD6 D806 D0              11      RET NC
       D807                     ESC1C:
000AD7 D807 E1              10      POP HL
000AD8 D808 1832            12      JR  ANK
                                
       D80A                     ESC:
000ADA D80A 216DD8          10      LD  HL,PRINTE5
000ADD D80D E5              11      PUSH    HL
000ADE D80E 2130D8          10      LD  HL,ESCFLG
000AE1 D811 3600            10      LD  (HL),0
000AE3 D813 3D               4      DEC A
000AE4 D814 28A0            12      JR  Z,ESC1
000AE6 D816 3D               4      DEC A
000AE7 D817 2009            12      JR  NZ,ESC2
000AE9 D819 3603            10      LD  (HL),3
000AEB D81B 7B               4      LD  A,E
000AEC D81C D620             7      SUB 020H
000AEE D81E 3225D8          13      LD  (ESCYP+1),A
000AF1 D821 C9              10      RET
       D822                     ESC2:
000AF2 D822 3D               4      DEC A
000AF3 D823 C0              11      RET NZ
000AF4 D824 2600             7  ESCYP:  LD  H,0
000AF6 D826 7B               4      LD  A,E
000AF7 D827 D620             7      SUB 020H
000AF9 D829 6F               4      LD  L,A
000AFA D82A C3D6F0          10      JP  _LOC
                                
       D82D                     PRINT:
000AFD D82D C5              11      PUSH    BC
000AFE D82E E5              11      PUSH    HL
000AFF D82F 3E00             7      LD  A,000H      ;自己書き換え
       D830                     ESCFLG  EQU $-1
000B01 D831 B7               4      OR  A
000B02 D832 20D6            12      JR  NZ,ESC
                                
000B04 D834 3E1F             7      LD  A,01FH
000B06 D836 BB               4      CP  E
000B07 D837 3038            12      JR  NC,CTRL
       D839                     INSFLG  EQU $
000B09 D839 017AD9          10      LD  BC,INSERT   ;自己書き換え
       D83C                     ANK:
000B0C D83C 3A96F0          13      LD  A,(_COLORF)
000B0F D83F 4F               4      LD  C,A
000B10 D840 7B               4      LD  A,E
000B11 D841 FE61             7      CP  'a'     ;英小文字
000B13 D843 3806            12      JR  C,PRT1
000B15 D845 FE7B             7      CP  'z'+1
000B17 D847 3002            12      JR  NC,PRT1
000B19 D849 CBF9             8      SET 7,C
       D84B                     PRT1:
000B1B D84B FE86             7      CP  $86     ;ひらがな1(を－そ)
000B1D D84D 3806            12      JR  C,PRT2
000B1F D84F FEA0             7      CP  $A0
000B21 D851 3002            12      JR  NC,PRT2
000B23 D853 CBF9             8      SET 7,C
       D855                     PRT2:
000B25 D855 FEE0             7      CP  $E0     ;ひらがな2(たーん)
000B27 D857 3802            12      JR  C,PRT3
000B29 D859 CBF9             8      SET 7,C
       D85B                     PRT3:
000B2B D85B 2A8EF0          16      LD  HL,(_TXADR)
000B2E D85E 7C               4      LD  A,H
000B2F D85F C6D0             7      ADD A,0D0H
000B31 D861 67               4      LD  H,A
000B32 D862 42               4      LD  B,D
000B33 D863 16EE             7      LD  D,CD_TABLE/256
000B35 D865 1A               7      LD  A,(DE)
000B36 D866 50               4      LD  D,B
000B37 D867 CD45CF          17      CALL    IO_PRINT
000B3A D86A CD81D8          17      CALL    CTRL1C
       D86D                     PRINTE5:
000B3D D86D E1              10      POP HL
000B3E D86E C1              10      POP BC
000B3F D86F AF               4      XOR A
000B40 D870 C9              10      RET
                                
       D871                     CTRL:
000B41 D871 7B               4      LD  A,E
000B42 D872 87               4      ADD A,A
000B43 D873 F680             7      OR  080H
000B45 D875 6F               4      LD  L,A
000B46 D876 26F1             7      LD  H,CTRLTB/256
000B48 D878 7E               7      LD  A,(HL)
000B49 D879 2C               4      INC L
000B4A D87A 66               7      LD  H,(HL)
000B4B D87B 6F               4      LD  L,A
000B4C D87C CD0F00          17      CALL    JP_HL
000B4F D87F 18EC            12      JR  PRINTE5
                                
       D881                     CTRL1C:
000B51 D881 ED4B8EF0        20      LD  BC,(_TXADR)
000B55 D885 03               6      INC BC
       D886                     PRINTE3:
000B56 D886 2118FC          10      LD  HL,0-WIDTH*LINE
000B59 D889 A7               4      AND A
000B5A D88A ED4A            15      ADC HL,BC
       D88C                     PRINTE8:
000B5C D88C 2805            12      JR  Z,PRINT2
000B5E D88E ED438EF0        20      LD  (_TXADR),BC
       D892                     CTRL00:
000B62 D892 C9              10      RET
                                
       D893                     PRINT2:
000B63 D893 CDD8D9          17      CALL    SCR
000B66 D896 21D8FF          10      LD  HL,0-WIDTH
000B69 D899 09              11      ADD HL,BC
       D89A                     SET_TXADR_HL:
000B6A D89A 228EF0          16      LD  (_TXADR),HL
000B6D D89D C9              10      RET
                                
       D89E                     CTRL08:
000B6E D89E 3A39D8          13      LD  A,(INSFLG)
000B71 D8A1 FECD             7      CP  0CDH        ;CALL ????
000B73 D8A3 2823            12      JR  Z,CTRL02
       D8A5                     CTRL1D:
000B75 D8A5 2A8EF0          16      LD  HL,(_TXADR)
000B78 D8A8 7C               4      LD  A,H
000B79 D8A9 B5               4      OR  L
000B7A D8AA C8              11      RET Z
000B7B D8AB 2B               6      DEC HL
000B7C D8AC 18EC            12      JR  SET_TXADR_HL
                                
       D8AE                     CTRL1E:
000B7E D8AE ED4B8EF0        20      LD  BC,(_TXADR)
000B82 D8B2 21D8FF          10      LD  HL,0-WIDTH
000B85 D8B5 09              11      ADD HL,BC
000B86 D8B6 D0              11      RET NC
000B87 D8B7 18E1            12      JR  SET_TXADR_HL
                                
       D8B9                     CTRL09:
000B89 D8B9 ED4B8EF0        20      LD  BC,(_TXADR)
000B8D D8BD 79               4      LD  A,C
000B8E D8BE E6F8             7      AND 0F8H
000B90 D8C0 C608             7      ADD A,8
000B92 D8C2 4F               4      LD  C,A
000B93 D8C3 88               4      ADC A,B
000B94 D8C4 91               4      SUB C
000B95 D8C5 47               4      LD  B,A
000B96 D8C6 18BE            12      JR  PRINTE3
                                
       D8C8                     CTRL02:
000B98 D8C8 CDA5D8          17      CALL    CTRL1D
000B9B D8CB C8              11      RET Z
000B9C D8CC D5              11      PUSH    DE
000B9D D8CD CDD3F0          17      CALL    _POS
000BA0 D8D0 54               4      LD  D,H
000BA1 D8D1 3E28             7      LD  A,WIDTH
000BA3 D8D3 95               4      SUB L
000BA4 D8D4 4F               4      LD  C,A
000BA5 D8D5 0D               4      DEC C
000BA6 D8D6 06D0             7      LD  B,0D0H
000BA8 D8D8 2A8EF0          16      LD  HL,(_TXADR)
000BAB D8DB 09              11      ADD HL,BC
000BAC D8DC 47               4      LD  B,A
                                
000BAD D8DD 3A96D9          13      LD  A,(MULINE)
000BB0 D8E0 BA               4      CP  D
000BB1 D8E1 2007            12      JR  NZ,C02X1
000BB3 D8E3 112800          10      LD  DE,WIDTH
000BB6 D8E6 19              11      ADD HL,DE
000BB7 D8E7 78               4      LD  A,B
000BB8 D8E8 83               4      ADD A,E
000BB9 D8E9 47               4      LD  B,A
       D8EA                     C02X1:
000BBA D8EA 3A96F0          13      LD  A,(_COLORF) ;C:Color
000BBD D8ED 4F               4      LD  C,A
000BBE D8EE AF               4      XOR A       ;A:Text
000BBF D8EF CD8CCF          17      CALL    IO_BS
000BC2 D8F2 D1              10      POP DE
000BC3 D8F3 C9              10      RET
                                
       D8F4                     CTRL05:
000BC4 D8F4 CDD3F0          17      CALL    _POS
000BC7 D8F7 3E28             7      LD  A,WIDTH
000BC9 D8F9 95               4      SUB L
000BCA D8FA 47               4      LD  B,A
       D8FB                     C08X1:
000BCB D8FB 2A8EF0          16      LD  HL,(_TXADR)
000BCE D8FE 7C               4      LD  A,H
000BCF D8FF C6D0             7      ADD A,0D0H
000BD1 D901 67               4      LD  H,A
       D902                     CLLINE:
000BD2 D902 3A96F0          13      LD  A,(_COLORF)
000BD5 D905 4F               4      LD  C,A
000BD6 D906 AF               4      XOR A
000BD7 D907 C36FCF          10      JP  IO_CLLINE
                                
       D90A                     CTRL0D:
000BDA D90A CDD3F0          17      CALL    _POS
000BDD D90D 2E00             7      LD  L,0
       D90F                     LOC:
000BDF D90F C5              11      PUSH    BC
000BE0 D910 E5              11      PUSH    HL
000BE1 D911 CD2FD9          17      CALL    LOC1
000BE4 D914 228EF0          16      LD  (_TXADR),HL
000BE7 D917 E1              10      POP HL
000BE8 D918 C1              10      POP BC
000BE9 D919 C9              10      RET
                                
       D91A                     CTRL12:
000BEA D91A 2139D8          10      LD  HL,INSFLG
000BED D91D 7E               7      LD  A,(HL)
000BEE D91E EECC             7      XOR 0CCH        ;CD:CALL ???? 1:LD BC,????
000BF0 D920 77               7      LD  (HL),A
000BF1 D921 C9              10      RET
                                
       D922                     CTRL0B:
000BF2 D922 210000          10      LD  HL,0
000BF5 D925 228EF0          16      LD  (_TXADR),HL
000BF8 D928 C9              10      RET
                                
       D929                     CTRL1B:
000BF9 D929 3E01             7      LD  A,1
000BFB D92B 3230D8          13      LD  (ESCFLG),A
000BFE D92E C9              10      RET
                                
       D92F                     LOC1:
000BFF D92F D5              11      PUSH    DE
000C00 D930 4D               4      LD  C,L
000C01 D931 0608             7      LD  B,8
000C03 D933 5C               4      LD  E,H
000C04 D934 210028          10      LD  HL,WIDTH*256
000C07 D937 55               4      LD  D,L ;L=0
       D938                     LOC2:
000C08 D938 29              11      ADD HL,HL
000C09 D939 3001            12      JR  NC,LOC3
000C0B D93B 19              11      ADD HL,DE
       D93C                     LOC3:
000C0C D93C 10FA            13      DJNZ    LOC2
000C0E D93E 09              11      ADD HL,BC
000C0F D93F D1              10      POP DE
000C10 D940 C9              10      RET
                                
       D941                     CONOUT1:
                                ;   CALL    CURSOR
000C11 D941 59               4      LD  E,C
000C12 D942 CDCDF0          17      CALL    _PRINT
000C15 D945 7B               4      LD  A,E
000C16 D946 FE0A             7      CP  00AH
000C18 D948 2006            12      JR  NZ,CURSOR
000C1A D94A CD0AD9          17      CALL    CTRL0D
000C1D D94D CDF4D8          17      CALL    CTRL05
       D950                     CURSOR:
000C20 D950 C9              10      RET
                                
       D951                     CTRL07:
000C21 D951 06E0             7      LD  B,0E0H
000C23 D953 2162F0          10      LD  HL,BEEPD+1
       D956                     C07X0:
000C26 D956 4E               7      LD  C,(HL)
000C27 D957 23               6      INC HL
000C28 D958 7E               7      LD  A,(HL)
000C29 D959 23               6      INC HL
000C2A D95A CD3DCF          17      CALL    WRMMIO_BC
000C2D D95D 7D               4      LD  A,L
000C2E D95E FE6A             7      CP  (BEEPD+1+M7BEEPE-M7BEEPD)&255
000C30 D960 20F4            12      JR  NZ,C07X0
000C32 D962 0610             7      LD  B,16
       D964                     C07X1:
000C34 D964 CD1BCF          17      CALL    RD556VSYNC
000C37 D967 87               4      ADD A,A
000C38 D968 30FA            12      JR  NC,C07X1
       D96A                     C07X2:
000C3A D96A CD1BCF          17      CALL    RD556VSYNC
000C3D D96D 87               4      ADD A,A
000C3E D96E 38FA            12      JR  C,C07X2
000C40 D970 10F2            13      DJNZ    C07X1
                                
000C42 D972 AF               4      XOR A
000C43 D973 2108E0          10      LD  HL,0E008H
000C46 D976 CD2DCF          17      CALL    WRMMIO
000C49 D979 C9              10      RET
                                
       D97A                     INSERT:
000C4A D97A D5              11      PUSH    DE
000C4B D97B CDD3F0          17      CALL    _POS
000C4E D97E 54               4      LD  D,H
000C4F D97F 3E28             7      LD  A,WIDTH
000C51 D981 95               4      SUB L
000C52 D982 47               4      LD  B,A
000C53 D983 2A8EF0          16      LD  HL,(_TXADR)
000C56 D986 7C               4      LD  A,H
000C57 D987 C6D0             7      ADD A,0D0H
000C59 D989 67               4      LD  H,A
000C5A D98A 3A96F0          13      LD  A,(_COLORF) ;C:Color
000C5D D98D 4F               4      LD  C,A
000C5E D98E AF               4      XOR A       ;A:Text
000C5F D98F CD7FCF          17      CALL    IO_INS
000C62 D992 B7               4      OR  A
000C63 D993 2005            12      JR  NZ,INS1
       D996                     MULINE  EQU $+1
000C65 D995 3EFF             7      LD  A,-1
000C67 D997 92               4      SUB D
000C68 D998 2009            12      JR  NZ,INS2
       D99A                     INS1:
000C6A D99A 0628             7      LD  B,WIDTH
000C6C D99C CD7FCF          17      CALL    IO_INS
000C6F D99F 7A               4      LD  A,D
000C70 D9A0 3296D9          13      LD  (MULINE),A
       D9A3                     INS2:
000C73 D9A3 D1              10      POP DE
000C74 D9A4 C9              10      RET
                                
       D9A5                     CTRL0C:
000C75 D9A5 CD22D9          17      CALL    CTRL0B
       D9A8                     CTRL06:
000C78 D9A8 D5              11      PUSH    DE
000C79 D9A9 E5              11      PUSH    HL
000C7A D9AA ED5B8EF0        20      LD  DE,(_TXADR)
000C7E D9AE 3A96F0          13      LD  A,(_COLORF)
000C81 D9B1 325CCF          13      LD  (ICSMC),A
000C84 D9B4 C350CF          10      JP  IO_CLR
                                
       D9B7                     CTRL04:
000C87 D9B7 CDD3F0          17      CALL    _POS
000C8A D9BA 7D               4      LD  A,L
000C8B D9BB B7               4      OR  A
000C8C D9BC C8              11      RET Z
       D9BD                     CTRL03:
000C8D D9BD CD0AD9          17      CALL    CTRL0D
       D9C0                     CTRL0A:
       D9C0                     CTRL1F:
000C90 D9C0 2A8EF0          16      LD  HL,(_TXADR)
000C93 D9C3 012800          10      LD  BC,WIDTH
000C96 D9C6 09              11      ADD HL,BC
000C97 D9C7 44               4      LD  B,H
000C98 D9C8 4D               4      LD  C,L
000C99 D9C9 2118FC          10      LD  HL,0-WIDTH*LINE
000C9C D9CC 09              11      ADD HL,BC
000C9D D9CD 3F               4      CCF
000C9E D9CE 9F               4      SBC A,A
000C9F D9CF C38CD8          10      JP  PRINTE8
                                
       D9D2                     CTRL0E:
000CA2 D9D2 CDD3F0          17      CALL    _POS
000CA5 D9D5 7C               4      LD  A,H
000CA6 D9D6 1804            12      JR  SCR1
       D9D8                     SCR:
000CA8 D9D8 3A97F0          13      LD  A,(_LINE)
000CAB D9DB 3D               4      DEC A
       D9DC                     SCR1:
000CAC D9DC C5              11      PUSH    BC
000CAD D9DD D5              11      PUSH    DE
000CAE D9DE E5              11      PUSH    HL
000CAF D9DF 1100D0          10      LD  DE,0D000H
000CB2 D9E2 2128D0          10      LD  HL,0D000H+WIDTH
                                
000CB5 D9E5 47               4      LD  B,A
000CB6 D9E6 B7               4      OR  A
000CB7 D9E7 C3A4CF          10      JP  IO_SCRUP
                                
       D9EA                     POS:
000CBA D9EA 2A8EF0          16      LD  HL,(_TXADR)
000CBD D9ED C5              11      PUSH    BC
000CBE D9EE 01D8FF          10      LD  BC,0-WIDTH
000CC1 D9F1 AF               4      XOR A
       D9F2                     POS1:
000CC2 D9F2 09              11      ADD HL,BC
000CC3 D9F3 3C               4      INC A
000CC4 D9F4 38FC            12      JR  C,POS1
000CC6 D9F6 ED42            15      SBC HL,BC
000CC8 D9F8 3D               4      DEC A
000CC9 D9F9 67               4      LD  H,A
000CCA D9FA C1              10      POP BC
000CCB D9FB A7               4      AND A
000CCC D9FC C9              10      RET
                                
       D9FD                     GETL:
000CCD D9FD CDD3F0          17      CALL    _POS
000CD0 DA00 E5              11      PUSH    HL
000CD1 DA01 3ECD             7      LD  A,0CDH      ;CALL ????
000CD3 DA03 3239D8          13      LD  (INSFLG),A
       DA06                     GETL1:
000CD6 DA06 CD27D7          17      CALL    _SYS08
000CD9 DA09 FE09             7      CP  9
000CDB DA0B 2008            12      JR  NZ,GETL1V
000CDD DA0D 2120FF          10      LD  HL,KBUF
000CE0 DA10 CD8AD4          17      CALL    MSX
000CE3 DA13 18F1            12      JR  GETL1
       DA15                     GETL1V:
000CE5 DA15 5F               4      LD  E,A
000CE6 DA16 CDD3F0          17      CALL    _POS
000CE9 DA19 CDCDF0          17      CALL    _PRINT
000CEC DA1C 7B               4      LD  A,E
000CED DA1D FE20             7      CP  $20
000CEF DA1F 3809            12      JR  C,GETL1V1
000CF1 DA21 7D               4      LD  A,L
000CF2 DA22 FE27             7      CP  WIDTH-1
000CF4 DA24 2004            12      JR  NZ,GETL1V1
000CF6 DA26 7C               4      LD  A,H
000CF7 DA27 3296D9          13      LD  (MULINE),A
       DA2A                     GETL1V1:
000CFA DA2A 7B               4      LD  A,E
000CFB DA2B FE0D             7      CP  00DH
000CFD DA2D 20D7            12      JR  NZ,GETL1
000CFF DA2F 3E01             7      LD  A,1     ;LD BC,????
000D01 DA31 3239D8          13      LD  (INSFLG),A
000D04 DA34 1120FF          10      LD  DE,KBUF
000D07 DA37 0628             7      LD  B,WIDTH
000D09 DA39 CD27D3          17      CALL    ZERO_MEMORY_DE
                                
000D0C DA3C D1              10      POP DE
000D0D DA3D CDD3F0          17      CALL    _POS
000D10 DA40 6B               4      LD  L,E
000D11 DA41 3E28             7      LD  A,WIDTH
000D13 DA43 95               4      SUB L
000D14 DA44 57               4      LD  D,A
                                
000D15 DA45 3A96D9          13      LD  A,(MULINE)
000D18 DA48 94               4      SUB H
000D19 DA49 2806            12      JR  Z,GL2X
000D1B DA4B 3C               4      INC A
000D1C DA4C 200C            12      JR  NZ,GL3X
000D1E DA4E 25               4      DEC H
000D1F DA4F 1805            12      JR  GL4X
       DA51                     GL2X:
000D21 DA51 3E1F             7      LD  A,$1F
000D23 DA53 CD11D7          17      CALL    MSG_A
       DA56                     GL4X:
000D26 DA56 7A               4      LD  A,D
000D27 DA57 C628             7      ADD A,WIDTH
000D29 DA59 57               4      LD  D,A
       DA5A                     GL3X:
000D2A DA5A CD2FD9          17      CALL    LOC1
000D2D DA5D 4D               4      LD  C,L
000D2E DA5E 7C               4      LD  A,H
000D2F DA5F C6D0             7      ADD A,0D0H
000D31 DA61 47               4      LD  B,A
000D32 DA62 5A               4      LD  E,D
000D33 DA63 2120FF          10      LD  HL,KBUF
       DA66                     GETL2:
000D36 DA66 CDD0F0          17      CALL    _SCRN
000D39 DA69 03               6      INC BC
000D3A DA6A 77               7      LD  (HL),A
000D3B DA6B 23               6      INC HL
000D3C DA6C 1D               4      DEC E
000D3D DA6D 20F7            12      JR  NZ,GETL2
       DA6F                     GETL3:
000D3F DA6F 2B               6      DEC HL
000D40 DA70 7E               7      LD  A,(HL)
000D41 DA71 FE21             7      CP  021H
000D43 DA73 D0              11      RET NC
000D44 DA74 3600            10      LD  (HL),0
000D46 DA76 15               4      DEC D
000D47 DA77 20F6            12      JR  NZ,GETL3
000D49 DA79 C9              10      RET
                                
       DA7A                     INKEYB:
000D4A DA7A C1              10      POP BC
000D4B DA7B CB47             8      BIT 0,A
000D4D DA7D 3E08             7      LD  A,8
000D4F DA7F 2002            12      JR  NZ,INKEYD
000D51 DA81 3E03             7      LD  A,3
       DA83                     INKEYD:
000D53 DA83 3292F0          13      LD  (_KEYD),A
000D56 DA86 B7               4      OR  A
000D57 DA87 C9              10      RET
       DA88                     INKEY:
000D58 DA88 E5              11      PUSH    HL
       DA89                     GETKEY:
000D59 DA89 3A92F0          13      LD  A,(_KEYD)
000D5C DA8C B7               4      OR  A
000D5D DA8D 6F               4      LD  L,A
000D5E DA8E 2610             7      LD  H,16
       DA8F                     GKSMC   EQU $-1
       DA90                     GETKEY1:
000D60 DA90 3E01             7      LD  A,1
       DA91                     SKIP_KEYWAIT:   EQU $-1
000D62 DA92 B7               4      OR  A
000D63 DA93 C4C4DA          17      CALL    NZ,CHKEY    ;キーを離すまで待つ
000D66 DA96 281E            12      JR  Z,GETKEY2
000D68 DA98 BD               4      CP  L
000D69 DA99 201B            12      JR  NZ,GETKEY2
000D6B DA9B CD1BCF          17      CALL    RD556VSYNC
000D6E DA9E 87               4      ADD A,A
000D6F DA9F 30EF            12      JR  NC,GETKEY1
       DAA1                     GETKEY1X:
000D71 DAA1 CDC4DA          17      CALL    CHKEY       ;キーを離すまで待つ
000D74 DAA4 2810            12      JR  Z,GETKEY2
000D76 DAA6 BD               4      CP  L
000D77 DAA7 200D            12      JR  NZ,GETKEY2
000D79 DAA9 CD1BCF          17      CALL    RD556VSYNC
000D7C DAAC 87               4      ADD A,A
000D7D DAAD 38F2            12      JR  C,GETKEY1X
000D7F DAAF 25               4      DEC H
000D80 DAB0 20DE            12      JR  NZ,GETKEY1
000D82 DAB2 3E01             7      LD  A,1
000D84 DAB4 1805            12      JR  GETKEY3
       DAB6                     GETKEY2:
000D86 DAB6 3E10             7      LD  A,16
000D88 DAB8 3291DA          13      LD  (SKIP_KEYWAIT),A
       DABB                     GETKEY3:
000D8B DABB 328FDA          13      LD  (GKSMC),A
000D8E DABE 3A92F0          13      LD  A,(_KEYD)
000D91 DAC1 B7               4      OR  A
000D92 DAC2 E1              10      POP HL
000D93 DAC3 C0              11      RET NZ
       DAC4                     CHKEY:
000D94 DAC4 C5              11      PUSH    BC
000D95 DAC5 3E08             7      LD  A,8
000D97 DAC7 CD0ECF          17      CALL    RDKEYDATA
000D9A DACA 3293F0          13      LD  (_KEYD+1),A
000D9D DACD CB7F             8      BIT 7,A
000D9F DACF 28A9            12      JR  Z,INKEYB
000DA1 DAD1 E5              11      PUSH    HL
000DA2 DAD2 0E07             7      LD  C,7
000DA4 DAD4 2140ED          10      LD  HL,KEY_TABLE
000DA7 DAD7 CB47             8      BIT 0,A
000DA9 DAD9 2003            12      JR  NZ,CHKEY0
000DAB DADB 2180ED          10      LD  HL,SHIFT_TABLE
       DADE                     CHKEY0:
000DAE DADE CB77             8      BIT 6,A
000DB0 DAE0 2003            12      JR  NZ,CHKEY1
000DB2 DAE2 21C0ED          10      LD  HL,CTRL_TABLE
       DAE5                     CHKEY1:
000DB5 DAE5 79               4      LD  A,C
000DB6 DAE6 CD0ECF          17      CALL    RDKEYDATA
000DB9 DAE9 0608             7      LD  B,8
       DAEB                     CHKEY2:
000DBB DAEB 87               4      ADD A,A
000DBC DAEC 3009            12      JR  NC,CHKEY3
000DBE DAEE 23               6      INC HL
000DBF DAEF 10FA            13      DJNZ    CHKEY2
000DC1 DAF1 0D               4      DEC C
000DC2 DAF2 79               4      LD  A,C
000DC3 DAF3 3C               4      INC A
000DC4 DAF4 20EF            12      JR  NZ,CHKEY1
000DC6 DAF6 06                      DB  $06     ;LD B,?? 次の1バイトを飛ばす
       DAF7                     CHKEY3:
000DC7 DAF7 7E               7      LD  A,(HL)
000DC8 DAF8 E1              10      POP HL
000DC9 DAF9 C1              10      POP BC
000DCA DAFA 1887            12      JR  INKEYD
                                
       DAFC                     SCRN:
000DCC DAFC E5              11      PUSH    HL
000DCD DAFD CD35CF          17      CALL    RDMMIO_BC
000DD0 DB00 6F               4      LD  L,A
000DD1 DB01 26EF             7      LD  H,DC_TABLE/256
000DD3 DB03 7E               7      LD  A,(HL)
000DD4 DB04 FE41             7      CP  'A'     ;英小文字チェック
000DD6 DB06 380E            12      JR  C,SCRN1
000DD8 DB08 FE5B             7      CP  'Z'+1
000DDA DB0A DC18DB          17      CALL    C,SCRNC
000DDD DB0D FEA6             7      CP  $A6     ;ひらがなチェック
000DDF DB0F 3805            12      JR  C,SCRN1
000DE1 DB11 FEE0             7      CP  $E0
000DE3 DB13 DC18DB          17      CALL    C,SCRNC
       DB16                     SCRN1:
000DE6 DB16 E1              10      POP HL
000DE7 DB17 C9              10      RET
                                
       DB18                     SCRNC:
000DE8 DB18 6F               4      LD  L,A
000DE9 DB19 60               4      LD  H,B
000DEA DB1A CBD8             8      SET 3,B
000DEC DB1C CD35CF          17      CALL    RDMMIO_BC
000DEF DB1F 44               4      LD  B,H
000DF0 DB20 CB7F             8      BIT 7,A
000DF2 DB22 7D               4      LD  A,L
000DF3 DB23 C8              11      RET Z
000DF4 DB24 FE5B             7      CP  'Z'+1
000DF6 DB26 3804            12      JR  C,SCRNC_ADD
000DF8 DB28 FEC0             7      CP  $C0
000DFA DB2A 3803            12      JR  C,SCRNC_SUB
       DB2C                     SCRNC_ADD:
000DFC DB2C C620             7      ADD A,$20
000DFE DB2E C9              10      RET
       DB2F                     SCRNC_SUB:
000DFF DB2F D620             7      SUB $20
000E01 DB31 C9              10      RET
[EOF:M7IO.ASM:SHIFT_JIS]
                                    INCLUDE "LDFILE.ASM"
                                
                                ;   LSX-Dodgers FILE
                                
       DB32                     FILEC:
000E02 DB32 CD3DDB          17      CALL    FILE
       DB35                     FILEC2:
000E05 DB35 3A15F0          13      LD  A,(FDRV+1)
000E08 DB38 FE20             7      CP  020H
000E0A DB3A C8              11      RET Z
000E0B DB3B 1839            12      JR  SETDIR1
                                
       DB3D                     FILE:
000E0D DB3D AF               4      XOR A
000E0E DB3E 3214F0          13      LD  (FDRV),A
000E11 DB41 67               4      LD  H,A
000E12 DB42 6F               4      LD  L,A
000E13 DB43 2222F0          16      LD  (FDRV+14),HL
000E16 DB46 CD14DC          17      CALL    SPCUT
000E19 DB49 CDF9DB          17      CALL    CCHK3
000E1C DB4C 2812            12      JR  Z,DEVI1
000E1E DB4E 13               6      INC DE
000E1F DB4F 1A               7      LD  A,(DE)
000E20 DB50 1B               6      DEC DE
000E21 DB51 FE3A             7      CP  ':'
000E23 DB53 200B            12      JR  NZ,DEVI1
000E25 DB55 1A               7      LD  A,(DE)      ;DRIVE
000E26 DB56 CD54DE          17      CALL    CAP
000E29 DB59 D640             7      SUB '@'
000E2B DB5B 13               6      INC DE
000E2C DB5C 13               6      INC DE
000E2D DB5D 3214F0          13      LD  (FDRV),A
       DB60                     DEVI1:
000E30 DB60 1A               7      LD  A,(DE)
000E31 DB61 D65C             7      SUB 05CH        ;\
000E33 DB63 2009            12      JR  NZ,NOROOT
000E35 DB65 6F               4      LD  L,A     ;A=0でH=0のはずなのでHL=0
000E36 DB66 222EF0          16      LD  (FDRV+26),HL
000E39 DB69 2C               4      INC L
000E3A DB6A 2222F0          16      LD  (FDRV+14),HL
000E3D DB6D 13               6      INC DE
       DB6E                     NOROOT:
                                
       DB6E                     SETDIR:
000E3E DB6E CD9ADB          17      CALL    FILED
000E41 DB71 1A               7      LD  A,(DE)
000E42 DB72 FE5C             7      CP  05CH        ;\
000E44 DB74 C0              11      RET NZ
000E45 DB75 13               6      INC DE
       DB76                     SETDIR1:
000E46 DB76 3E10             7      LD  A,010H      ;Directory
000E48 DB78 3221F0          13      LD  (FDRV+13),A
000E4B DB7B D5              11      PUSH    DE
000E4C DB7C 1114F0          10      LD  DE,FDRV
000E4F DB7F 2A1EF1          16      LD  HL,(STABLE+2*00FH)
000E52 DB82 CD0F00          17      CALL    JP_HL
000E55 DB85 D1              10      POP DE
000E56 DB86 B7               4      OR  A
000E57 DB87 C0              11      RET NZ
                                
000E58 DB88 3A21F0          13      LD  A,(FDRV+13)
000E5B DB8B CB67             8      BIT 4,A
000E5D DB8D C8              11      RET Z
                                
000E5E DB8E CDE1DB          17      CALL    FILEI
000E61 DB91 2A2EF0          16      LD  HL,(FDRV+26)
000E64 DB94 23               6      INC HL
000E65 DB95 2222F0          16      LD  (FDRV+14),HL
000E68 DB98 18D4            12      JR  SETDIR
                                
       DB9A                     FILED:
000E6A DB9A CDE1DB          17      CALL    FILEI
000E6D DB9D 2115F0          10      LD  HL,FNAME
                                
000E70 DBA0 0608             7      LD  B,8
       DBA2                     FILE2:
000E72 DBA2 CDEEDB          17      CALL    CCHKF
000E75 DBA5 C8              11      RET Z
000E76 DBA6 FE2A             7      CP  '*'
000E78 DBA8 282E            12      JR  Z,FILE9
000E7A DBAA FE2E             7      CP  '.'
000E7C DBAC 280C            12      JR  Z,FILE4
000E7E DBAE 77               7      LD  (HL),A
000E7F DBAF 23               6      INC HL
000E80 DBB0 10F0            13      DJNZ    FILE2
                                
       DBB2                     FILE3:
000E82 DBB2 CDEEDB          17      CALL    CCHKF
000E85 DBB5 C8              11      RET Z
000E86 DBB6 FE2E             7      CP  '.'
000E88 DBB8 20F8            12      JR  NZ,FILE3
                                
       DBBA                     FILE4:
000E8A DBBA 211DF0          10      LD  HL,FNAME+8
000E8D DBBD 0603             7      LD  B,3
                                
       DBBF                     FILE4L:
000E8F DBBF CDEEDB          17      CALL    CCHKF
000E92 DBC2 C8              11      RET Z
000E93 DBC3 FE2E             7      CP  '.'
000E95 DBC5 2008            12      JR  NZ,FILE12
000E97 DBC7 3215F0          13      LD  (FNAME),A   ;Parent directory(..)
000E9A DBCA 3216F0          13      LD  (FNAME+1),A
000E9D DBCD 3E20             7      LD  A,020H
       DBCF                     FILE12:
000E9F DBCF FE2A             7      CP  '*'
000EA1 DBD1 280A            12      JR  Z,FILE10
000EA3 DBD3 77               7      LD  (HL),A
000EA4 DBD4 23               6      INC HL
000EA5 DBD5 10E8            13      DJNZ    FILE4L
000EA7 DBD7 C9              10      RET
                                
       DBD8                     FILE9:              ;名前の*処理、名前の残りを?で埋める
000EA8 DBD8 CDDDDB          17      CALL    FILE10
000EAB DBDB 18D5            12      JR  FILE3
                                
       DBDD                     FILE10:
000EAD DBDD 3E3F             7      LD  A,'?'
000EAF DBDF 1808            12      JR  FILL_MEMORY
       DBE1                     FILEI:              ;名前＋拡張子をスペースで初期化
000EB1 DBE1 3E20             7      LD  A,020H
000EB3 DBE3 01000B          10      LD  BC,11*256   ;C=0にしておく
000EB6 DBE6 2115F0          10      LD  HL,FNAME
       DBE9                     FILL_MEMORY:            ;HLからBバイトAで埋める
000EB9 DBE9 77               7      LD  (HL),A
000EBA DBEA 23               6      INC HL
000EBB DBEB 10FC            13      DJNZ    FILL_MEMORY
000EBD DBED C9              10      RET
                                
       DBEE                     CCHKF:
000EBE DBEE 1A               7      LD  A,(DE)
000EBF DBEF CDF6DB          17      CALL    CCHK2
000EC2 DBF2 C8              11      RET Z
000EC3 DBF3 C361DF          10      JP  FKAN
                                
       DBF6                     CCHK2:
000EC6 DBF6 0C               4      INC C
000EC7 DBF7 0D               4      DEC C
000EC8 DBF8 C0              11      RET NZ
       DBF9                     CCHK3:              ;ZF=1 で使えない文字
000EC9 DBF9 FE2B             7      CP  '+'
000ECB DBFB C8              11      RET Z
000ECC DBFC FE2C             7      CP  ','
000ECE DBFE C8              11      RET Z
000ECF DBFF FE2F             7      CP  '/'
000ED1 DC01 C8              11      RET Z
000ED2 DC02 FE3A             7      CP  ':'
000ED4 DC04 C8              11      RET Z
000ED5 DC05 FE3B             7      CP  ';'
000ED7 DC07 C8              11      RET Z
000ED8 DC08 FE3D             7      CP  '='
000EDA DC0A C8              11      RET Z
000EDB DC0B FE5C             7      CP  05CH    ;\
000EDD DC0D C8              11      RET Z
000EDE DC0E FE20             7      CP  020H
000EE0 DC10 D0              11      RET NC
000EE1 DC11 BF               4      CP  A       ;Z=1
000EE2 DC12 C9              10      RET
                                
       DC13                     SS1:
000EE3 DC13 13               6      INC DE
       DC14                     SPCUT:              ;スペースをカット
000EE4 DC14 1A               7      LD  A,(DE)
000EE5 DC15 FE20             7      CP  020H
000EE7 DC17 28FA            12      JR  Z,SS1
000EE9 DC19 C9              10      RET
                                
       DC1A                     SETDRVF:
000EEA DC1A 1114F0          10      LD  DE,FDRV
       DC1D                     SETDRV0:
000EED DC1D CD26DC          17      CALL    SETDRV
000EF0 DC20 FDE1            14      POP IY
000EF2 DC22 C1              10      POP BC
000EF3 DC23 D1              10      POP DE
000EF4 DC24 E1              10      POP HL
000EF5 DC25 C9              10      RET
                                
       DC26                     SETDRV:
000EF6 DC26 E3              19      EX  (SP),HL     ;HL=RETRN ADDRESS
000EF7 DC27 D5              11      PUSH    DE      ;PUSH HL/DE/BC/IY
000EF8 DC28 C5              11      PUSH    BC
000EF9 DC29 1A               7      LD  A,(DE)
000EFA DC2A D5              11      PUSH    DE
000EFB DC2B FDE3            23      EX  (SP),IY
                                
000EFD DC2D CD34DC          17      CALL    GETDRV
000F00 DC30 CDD9F0          17      CALL    _CHGDRV
                                
000F03 DC33 E9               4      JP  (HL)
                                
       DC34                     GETDRV:
000F04 DC34 CD47DC          17      CALL    GETDRV1
000F07 DC37 3288F0          13      LD  (_DRV),A
000F0A DC3A C9              10      RET
                                
       DC3B                     IS_SAME_DRV_A_DE:
                                ;   A と (DE) が同じドライブか調べる
                                ;   ZF=1ならば同じドライブ
000F0B DC3B CD47DC          17      CALL    GETDRV1
000F0E DC3E C5              11      PUSH    BC
000F0F DC3F 4F               4      LD  C,A
000F10 DC40 1A               7      LD  A,(DE)
000F11 DC41 CD47DC          17      CALL    GETDRV1
000F14 DC44 A9               4      XOR C
000F15 DC45 C1              10      POP BC
000F16 DC46 C9              10      RET
       DC47                     GETDRV1:
000F17 DC47 E67F             7      AND 07FH
000F19 DC49 D601             7      SUB 001H
000F1B DC4B D0              11      RET NC
000F1C DC4C 3A87F0          13      LD  A,(_DVSW)   ;Current Drive
000F1F DC4F C9              10      RET
                                
       DC50                     SOPENX:
000F20 DC50 1139F0          10      LD  DE,SFILE
000F23 DC53 FD7E00          19      LD  A,(IY+0)        ;(FCB)ドライブ番号
000F26 DC56 CD3BDC          17      CALL    IS_SAME_DRV_A_DE
000F29 DC59 2024            12      JR  NZ,SOPEN
000F2B DC5B 13               6      INC DE
000F2C DC5C FDE5            15      PUSH    IY
000F2E DC5E E1              10      POP HL
000F2F DC5F 23               6      INC HL
000F30 DC60 CDECDD          17      CALL    CPFILE
000F33 DC63 201A            12      JR  NZ,SOPEN
                                
000F35 DC65 2AF4F1          16      LD  HL,(SCDIR)
000F38 DC68 FD750E          19      LD  (IY+14),L   ;(FCB)アクセスするディレクトリのクラスタ番号+1
000F3B DC6B FD740F          19      LD  (IY+15),H
                                
000F3E DC6E 2AF8F1          16      LD  HL,(SFNDF)  ;Direcroty location and Flags
000F41 DC71 229FF0          16      LD  (_FILEN),HL
                                
000F44 DC74 ED5BF6F1        20      LD  DE,(SFBPS)
000F48 DC78 2139F0          10      LD  HL,SFILE
000F4B DC7B 36FF            10      LD  (HL),0FFH
000F4D DC7D 23               6      INC HL
000F4E DC7E C9              10      RET
       DC7F                     SOPEN:
000F4F DC7F 2194DD          10      LD  HL,FILESE
       DC82                     SOPENC:
000F52 DC82 22BBDC          16      LD  (OPENPAT),HL
                                
000F55 DC85 CDE2F0          17      CALL    _RDFATX     ;Detect Media
000F58 DC88 3856            12      JR  C,RDDERR
                                
000F5A DC8A AF               4      XOR A
000F5B DC8B 329FF0          13      LD  (_FILEN),A
000F5E DC8E CD94DE          17      CALL    LDDIRX1     ;A=0で呼び出す
000F61 DC91 2818            12      JR  Z,SDIRX1
                                
000F63 DC93 CD85DD          17      CALL    READ_DIR    ;Sub Directory
000F66 DC96 3808            12      JR  C,SDIRX0
000F68 DC98 2A7EF1          16      LD  HL,(_DTBUF)
000F6B DC9B 7E               7      LD  A,(HL)
000F6C DC9C FE2E             7      CP  '.'
000F6E DC9E 280F            12      JR  Z,SOPEN1
       DCA0                     SDIRX0:
000F70 DCA0 AF               4      XOR A
000F71 DCA1 32A0F0          13      LD  (_DIRF),A
000F74 DCA4 FD360E01        19      LD  (IY+14),1   ;(FCB)レコードサイズ
000F78 DCA8 FD770F          19      LD  (IY+15),A
       DCAB                     SDIRX1:
000F7B DCAB ED5BFCF1        20      LD  DE,(_DIRPS) ;Root Directory
       DCAF                     SOPEN1:
000F7F DCAF 0E20             7      LD  C,32        ;自己書き換え 1セクタ辺りのディレクトリエントリ数  1024=32 / 512=16 / 256=8
       DCB0                     SDECPAT EQU $-1
       DCB1                     SOPEN1X:
000F81 DCB1 CD85DD          17      CALL    READ_DIR    ;FILE SEARCH
000F84 DCB4 382A            12      JR  C,RDDERR
000F86 DCB6 2A7EF1          16      LD  HL,(_DTBUF)
       DCB9                     SOPEN2:
000F89 DCB9 D5              11      PUSH    DE
000F8A DCBA CD94DD          17      CALL    FILESE      ;(self-modifying code)
       DCBB                     OPENPAT EQU $-2
000F8D DCBD D1              10      POP DE
000F8E DCBE 386D            12      JR  C,SOPENE
000F90 DCC0 281B            12      JR  Z,SCF_FF_RET
       DCC2                     SOPEN3:
000F92 DCC2 3AA0F0          13      LD  A,(_DIRF)   ;ディレクトリか判別
000F95 DCC5 B7               4      OR  A
000F96 DCC6 200C            12      JR  NZ,SOPEN5
000F98 DCC8 13               6      INC DE      ;ルートディレクトリ
000F99 DCC9 E5              11      PUSH    HL
000F9A DCCA 210C00          10      LD  HL,12       ;(self-modifying code)MAXDIR
       DCCB                     MD_PAT  EQU $-2
000F9D DCCD ED52            15      SBC HL,DE       ;CF=0 なので SUB HL,DE
000F9F DCCF E1              10      POP HL
000FA0 DCD0 20DD            12      JR  NZ,SOPEN1
000FA2 DCD2 1807            12      JR  SOPEN6
       DCD4                     SOPEN5:
000FA4 DCD4 CDA3E5          17      CALL    GNCLX       ;END DIR
000FA7 DCD7 D8              11      RET C
000FA8 DCD8 CD4CDE          17      CALL    ENDCL
       DCDB                     SOPEN6:
000FAB DCDB 38D2            12      JR  C,SOPEN1
       DCDD                     SCF_FF_RET:
000FAD DCDD 37               4      SCF         ;CF=1
000FAE DCDE 9F               4      SBC A,A     ;A=0FFH
000FAF DCDF C9              10      RET
                                
       DCE0                     RDDERR:
000FB0 DCE0 BF               4      CP  A       ;READ ERR CF=1 ZF=1
000FB1 DCE1 37               4      SCF
000FB2 DCE2 C9              10      RET
                                
       DCE3                     NOPEN:
000FB3 DCE3 2194DD          10      LD  HL,FILESE
000FB6 DCE6 22BBDC          16      LD  (OPENPAT),HL
000FB9 DCE9 FD2A98F0        20      LD  IY,(_FCB)
000FBD DCED CD74DF          17      CALL    CHKWILDX
000FC0 DCF0 30EB            12      JR  NC,SCF_FF_RET
000FC2 DCF2 FD7E00          19      LD  A,(IY+0)
000FC5 DCF5 CD34DC          17      CALL    GETDRV
000FC8 DCF8 CDD9F0          17      CALL    _CHGDRV
000FCB DCFB D8              11      RET C
000FCC DCFC 2AF8F1          16      LD  HL,(SFNDF)  ;Direcroty location and Flags
000FCF DCFF 229FF0          16      LD  (_FILEN),HL
                                
000FD2 DD02 CD8FDE          17      CALL    LDDIRX
000FD5 DD05 ED5B9AF0        20      LD  DE,(_FBPS)
000FD9 DD09 CD85DD          17      CALL    READ_DIR
000FDC DD0C 38D2            12      JR  C,RDDERR
000FDE DD0E 3A9EF0          13      LD  A,(_FBCNT)
000FE1 DD11 3D               4      DEC A
000FE2 DD12 28AE            12      JR  Z,SOPEN3
       DD14                     NOPEN2:
000FE4 DD14 2A9CF0          16      LD  HL,(_FBAD)
000FE7 DD17 012000          10      LD  BC,020H
000FEA DD1A 09              11      ADD HL,BC
000FEB DD1B 4F               4      LD  C,A
000FEC DD1C 189B            12      JR  SOPEN2
                                
       DD1E                     SOPENE2:
000FEE DD1E 229CF0          16      LD  (_FBAD),HL
000FF1 DD21 79               4      LD  A,C
000FF2 DD22 329EF0          13      LD  (_FBCNT),A
000FF5 DD25 ED539AF0        20      LD  (_FBPS),DE
000FF9 DD29 FD2298F0        20      LD  (_FCB),IY
       DD2D                     SOPENE:
000FFD DD2D AF               4      XOR A
000FFE DD2E C9              10      RET
                                
       DD2F                     COPEN:
000FFF DD2F FD360D20        19      LD  (IY+13),020H    ;(FCB)属性(アトリビュート)
                                
001003 DD33 21B1DD          10      LD  HL,NEXTSE
001006 DD36 CD82DC          17      CALL    SOPENC
001009 DD39 D0              11      RET NC
00100A DD3A C8              11      RET Z
00100B DD3B 3AA0F0          13      LD  A,(_DIRF)   ;ディレクトリか判別
00100E DD3E B7               4      OR  A
00100F DD3F 37               4      SCF
001010 DD40 C8              11      RET Z       ;ルートディレクトリ
001011 DD41 0601             7      LD  B,1
001013 DD43 CDD3DF          17      CALL    WRDF
001016 DD46 D8              11      RET C
001017 DD47 ED5BFEF1        20      LD  DE,(_CLPS)
00101B DD4B D5              11      PUSH    DE
00101C DD4C CD15DE          17      CALL    DCPAT
00101F DD4F CD2EE4          17      CALL    DRDNX
001022 DD52 2A7EF1          16      LD  HL,(_DTBUF) ;ディレクトリエントリを0クリア
001025 DD55 3A38E3          13      LD  A,(SECSZ+2) ;1024=4 / 512=2 / 256=1
001028 DD58 47               4      LD  B,A
001029 DD59 AF               4      XOR A
00102A DD5A 4F               4      LD  C,A
       DD5B                     COPENCL:
00102B DD5B 77               7      LD  (HL),A
00102C DD5C EDA1            16      CPI         ;HL=HL+1 BC=BC-1 BCが0の場合にP/V=0
00102E DD5E EA5BDD          10      JP  PE,COPENCL
                                
001031 DD61 3A33DE          13      LD  A,(SPCPAT)  ;1クラスタの論理セクタ数
001034 DD64 3D               4      DEC A
001035 DD65 2819            12      JR  Z,COPENE
001037 DD67 3E01             7      LD  A,1     ;1セクタ辺りのセクタ数が2以上の場合
001039 DD69 329BE5          13      LD  (_SECPS),A
00103C DD6C D1              10      POP DE      ;DE=(_CLPS)
00103D DD6D D5              11      PUSH    DE
       DD6E                     COPEN1:
00103E DD6E D5              11      PUSH    DE      ;データバッファに入らないセクタもゼロクリア
00103F DD6F C5              11      PUSH    BC
001040 DD70 2A7EF1          16      LD  HL,(_DTBUF)
001043 DD73 CD2FDE          17      CALL    CLUSTX
001046 DD76 CD31E7          17      CALL    DWT24
001049 DD79 C1              10      POP BC
00104A DD7A D1              10      POP DE
00104B DD7B CD9AE5          17      CALL    NEXTX
00104E DD7E 20EE            12      JR  NZ,COPEN1
       DD80                     COPENE:
001050 DD80 2A7EF1          16      LD  HL,(_DTBUF)
001053 DD83 D1              10      POP DE
001054 DD84 C9              10      RET
                                
       DD85                     READ_DIR:
001055 DD85 ED53FEF1        20      LD  (_CLPS),DE
001059 DD89 C5              11      PUSH    BC
00105A DD8A D5              11      PUSH    DE
00105B DD8B CD15DE          17      CALL    DCPAT
00105E DD8E CD0EE4          17      CALL    DRDX
001061 DD91 D1              10      POP DE
001062 DD92 C1              10      POP BC
001063 DD93 C9              10      RET
                                
       DD94                     FILESE:
001064 DD94 7E               7      LD  A,(HL)
001065 DD95 B7               4      OR  A
001066 DD96 C8              11      RET Z       ;END:ZF=1 CF=0
001067 DD97 FEE5             7      CP  0E5H
001069 DD99 280E            12      JR  Z,FILESE1
00106B DD9B FDE5            15      PUSH    IY
00106D DD9D D1              10      POP DE
00106E DD9E 13               6      INC DE
00106F DD9F E5              11      PUSH    HL
001070 DDA0 CDECDD          17      CALL    CPFILE
001073 DDA3 CC0DDE          17      CALL    Z,CPFILE2
001076 DDA6 E1              10      POP HL
001077 DDA7 37               4      SCF
001078 DDA8 C8              11      RET Z       ;!!!:(ZF=1) CF=1
       DDA9                     FILESE1:
001079 DDA9 CDC0DD          17      CALL    FNEXT
00107C DDAC 20E6            12      JR  NZ,FILESE
       DDAE                     ZF0_CF0_AFF_RET:
00107E DDAE F6FF             7      OR  0FFH        ;ZF=0 CF=0
001080 DDB0 C9              10      RET
                                
       DDB1                     NEXTSE:
001081 DDB1 7E               7      LD  A,(HL)
001082 DDB2 B7               4      OR  A
001083 DDB3 37               4      SCF
001084 DDB4 C8              11      RET Z       ;!!!:ZF=1 CF=1
001085 DDB5 FEE5             7      CP  0E5H
001087 DDB7 37               4      SCF
001088 DDB8 C8              11      RET Z       ;!!!:(ZF=1) CF=1
001089 DDB9 CDC0DD          17      CALL    FNEXT
00108C DDBC 20F3            12      JR  NZ,NEXTSE
00108E DDBE 18EE            12      JR  ZF0_CF0_AFF_RET
                                
       DDC0                     FNEXT:
001090 DDC0 E5              11      PUSH    HL
001091 DDC1 219FF0          10      LD  HL,_FILEN
001094 DDC4 34              11      INC (HL)
001095 DDC5 E1              10      POP HL
001096 DDC6 112000          10      LD  DE,020H
001099 DDC9 19              11      ADD HL,DE
00109A DDCA 0D               4      DEC C
00109B DDCB C9              10      RET
                                
       DDCC                     CPNAME:
00109C DDCC C5              11      PUSH    BC
00109D DDCD D5              11      PUSH    DE
00109E DDCE E5              11      PUSH    HL
00109F DDCF CDE6DD          17      CALL    CPFILE4
0010A2 DDD2 E1              10      POP HL
0010A3 DDD3 23               6      INC HL
0010A4 DDD4 23               6      INC HL
0010A5 DDD5 23               6      INC HL
0010A6 DDD6 23               6      INC HL
0010A7 DDD7 D1              10      POP DE
0010A8 DDD8 C1              10      POP BC
0010A9 DDD9 2005            12      JR  NZ,CPNAME1
0010AB DDDB 7E               7      LD  A,(HL)
0010AC DDDC 23               6      INC HL
0010AD DDDD 66               7      LD  H,(HL)
0010AE DDDE 6F               4      LD  L,A
0010AF DDDF C9              10      RET
       DDE0                     CPNAME1:
0010B0 DDE0 23               6      INC HL
0010B1 DDE1 23               6      INC HL
0010B2 DDE2 10E8            13      DJNZ    CPNAME
0010B4 DDE4 37               4      SCF
0010B5 DDE5 C9              10      RET
                                
       DDE6                     CPFILE4:
0010B6 DDE6 C5              11      PUSH    BC
0010B7 DDE7 010004          10      LD  BC,00400H
0010BA DDEA 1804            12      JR  CPSTR1
       DDEC                     CPFILE:
0010BC DDEC C5              11      PUSH    BC
0010BD DDED 01000B          10      LD  BC,00B00H
       DDF0                     CPSTR1:
0010C0 DDF0 1A               7      LD  A,(DE)
0010C1 DDF1 FE3F             7      CP  '?'     ;Wild card
0010C3 DDF3 2812            12      JR  Z,CPSTR2
0010C5 DDF5 7E               7      LD  A,(HL)
0010C6 DDF6 CD5ADF          17      CALL    FKANC
0010C9 DDF9 E5              11      PUSH    HL
0010CA DDFA 67               4      LD  H,A
0010CB DDFB 1A               7      LD  A,(DE)
0010CC DDFC CB01             4      RLC C
0010CE DDFE CD5ADF          17      CALL    FKANC
0010D1 DE01 CB09             4      RRC C
0010D3 DE03 BC               4      CP  H       ;CP (HL),(DE)
0010D4 DE04 E1              10      POP HL
0010D5 DE05 2004            12      JR  NZ,CPSTR3
       DE07                     CPSTR2:
0010D7 DE07 13               6      INC DE
0010D8 DE08 23               6      INC HL
0010D9 DE09 10E5            13      DJNZ    CPSTR1
       DE0B                     CPSTR3:
0010DB DE0B C1              10      POP BC
0010DC DE0C C9              10      RET
                                
       DE0D                     CPFILE2:
0010DD DE0D FD7E0D          19      LD  A,(IY+13)   ;(FCB)属性(アトリビュート)
0010E0 DE10 F6E1             7      OR  0E1H
0010E2 DE12 2F               4      CPL
0010E3 DE13 A6               7      AND (HL)
0010E4 DE14 C9              10      RET
                                
       DE15                     DCPAT:
0010E5 DE15 0E00             7      LD  C,0
0010E7 DE17 2A7EF1          16      LD  HL,(_DTBUF)
0010EA DE1A 3AA0F0          13      LD  A,(_DIRF)   ;ディレクトリか判別
0010ED DE1D B7               4      OR  A
0010EE DE1E C8              11      RET Z       ;ルートディレクトリの場合はCレジスタを0にしておく(CDEがセクタ番号)
0010EF DE1F 3A33DE          13      LD  A,(SPCPAT)
0010F2 DE22 4F               4      LD  C,A
0010F3 DE23 3A9BE5          13      LD  A,(_SECPS)
0010F6 DE26 B9               4      CP  C
0010F7 DE27 3801            12      JR  C,DC1
0010F9 DE29 AF               4      XOR A
       DE2A                     DC1:
0010FA DE2A F680             7      OR  080H
0010FC DE2C 32A0F0          13      LD  (_DIRF),A   ;bit0-6:セクタインデックス
       DE2F                     CLUSTX:
0010FF DE2F E5              11      PUSH    HL
001100 DE30 EB               4      EX  DE,HL
001101 DE31 AF               4      XOR A
001102 DE32 0E01             7      LD  C,1     ;自己書き換え（1クラスタの論理セクタ数）
       DE33                     SPCPAT  EQU $-1
       DE34                     L_CLDBL:
001104 DE34 CB19             8      RR  C       ;->CF
001106 DE36 3804            12      JR  C,E_CLDBL
001108 DE38 29              11      ADD HL,HL       ;*2
001109 DE39 8F               4      ADC A,A
00110A DE3A 18F8            12      JR  L_CLDBL
       DE3C                     E_CLDBL:
00110C DE3C 4F               4      LD  C,A
00110D DE3D 3A9BE5          13      LD  A,(_SECPS)
001110 DE40 B5               4      OR  L
001111 DE41 6F               4      LD  L,A
001112 DE42 110800          10      LD  DE,8    ;+8 (2D)  !ADDCL (self-modifying code)
       DE43                     CLSPAT  EQU $-2
001115 DE45 AF               4      XOR A
001116 DE46 19              11      ADD HL,DE   ;データ格納領域の先頭論理セクタ番号
001117 DE47 89               4      ADC A,C
001118 DE48 4F               4      LD  C,A
001119 DE49 EB               4      EX  DE,HL
00111A DE4A E1              10      POP HL
00111B DE4B C9              10      RET
                                
       DE4C                     ENDCL:
00111C DE4C 7A               4      LD  A,D ;END CLUSTER
00111D DE4D FE01             7      CP  1   ;164=356    (self-modifying code)
       DE4E                     CLPAT1  EQU $-1
00111F DE4F C0              11      RET NZ
001120 DE50 7B               4      LD  A,E
001121 DE51 FE64             7      CP  064H    ;       (self-modifying code)
       DE52                     CLPAT2  EQU $-1
001123 DE53 C9              10      RET
                                
       DE54                     CAP:
001124 DE54 FE61             7      CP  'a'
001126 DE56 D8              11      RET C
001127 DE57 FE7B             7      CP  'z'+1
001129 DE59 D0              11      RET NC
00112A DE5A D620             7      SUB 020H
00112C DE5C C9              10      RET
       DE5D                     CAP2:
00112D DE5D CD54DE          17      CALL    CAP
       DE60                     CAP3:               ;
001130 DE60 FE05             7      CP  5
001132 DE62 2803            12      JR  Z,CAP4
001134 DE64 FE21             7      CP  021H
001136 DE66 C9              10      RET
       DE67                     CAP4:
001137 DE67 3EE5             7      LD  A,0E5H
001139 DE69 C9              10      RET
                                
       DE6A                     CHDIR:
00113A DE6A CD44E8          17      CALL    GETDPBD
00113D DE6D 381D            12      JR  C,CHDIR2
00113F DE6F DD751A          19      LD  (IX+DPB_SDIR),L
001142 DE72 DD741B          19      LD  (IX+DPB_SDIR+1),H
001145 DE75 1815            12      JR  CHDIR2      ;POP_IX_RET
                                
       DE77                     LDDIR:
001147 DE77 CD44E8          17      CALL    GETDPBD
00114A DE7A DD5E1A          19      LD  E,(IX+DPB_SDIR)
00114D DE7D DD561B          19      LD  D,(IX+DPB_SDIR+1)
001150 DE80 13               6      INC DE
001151 DE81 FD730E          19      LD  (IY+14),E   ;(FCB)アクセスするディレクトリのクラスタ番号+1
001154 DE84 FD720F          19      LD  (IY+15),D
001157 DE87 1B               6      DEC DE
001158 DE88 AF               4      XOR A
001159 DE89 32A0F0          13      LD  (_DIRF),A
       DE8C                     CHDIR2:
00115C DE8C DDE1            14      POP IX
00115E DE8E C9              10      RET
                                
       DE8F                     LDDIRX:
00115F DE8F 3AA0F0          13      LD  A,(_DIRF)   ;(FCB)アクセスするディレクトリのセクタインデックス
001162 DE92 E67F             7      AND 07FH
       DE94                     LDDIRX1:
001164 DE94 329BE5          13      LD  (_SECPS),A
001167 DE97 FD5E0E          19      LD  E,(IY+14)   ;(FCB)アクセスするディレクトリのクラスタ番号+1
00116A DE9A FD560F          19      LD  D,(IY+15)
00116D DE9D 1B               6      DEC DE
00116E DE9E CD4CDE          17      CALL    ENDCL
001171 DEA1 D477DE          17      CALL    NC,LDDIR
       DEA4                     LDDIRS:
001174 DEA4 7A               4      LD  A,D
001175 DEA5 B3               4      OR  E
001176 DEA6 32A0F0          13      LD  (_DIRF),A   ;ディレクトリか判別
001179 DEA9 C9              10      RET
                                
       DEAA                     KILL:
00117A DEAA CD74DF          17      CALL    CHKWILDX
00117D DEAD 3834            12      JR  C,KILLW
00117F DEAF CD50DC          17      CALL    SOPENX
       DEB2                     KILLS:
001182 DEB2 3E1F             7      LD  A,01FH
001184 DEB4 D4F6DE          17      CALL    NC,CHKATT
001187 DEB7 D8              11      RET C
       DEB8                     KILLSX:
001188 DEB8 36E5            10      LD  (HL),0E5H   ;DIR
00118A DEBA CD4EDF          17      CALL    WTDB
00118D DEBD 111A00          10      LD  DE,01AH
001190 DEC0 19              11      ADD HL,DE
001191 DEC1 5E               7      LD  E,(HL)
001192 DEC2 23               6      INC HL
001193 DEC3 56               7      LD  D,(HL)
       DEC4                     KILLS1:
001194 DEC4 CD4CDE          17      CALL    ENDCL
001197 DEC7 D0              11      RET NC      ;CF=0
001198 DEC8 21FEFF          10      LD  HL,0-2
00119B DECB 19              11      ADD HL,DE
00119C DECC D0              11      RET NC      ;DE= 0 or 1
00119D DECD D5              11      PUSH    DE
00119E DECE CDF7F0          17      CALL    _GNCL
0011A1 DED1 ED53FEF1        20      LD  (_CLPS),DE
0011A5 DED5 D1              10      POP DE
0011A6 DED6 210000          10      LD  HL,0
0011A9 DED9 D4FAF0          17      CALL    NC,_SNCL
0011AC DEDC D8              11      RET C
0011AD DEDD ED5BFEF1        20      LD  DE,(_CLPS)  ;FAT
0011B1 DEE1 18E1            12      JR  KILLS1
                                
       DEE3                     KILLW:
0011B3 DEE3 CD7FDC          17      CALL    SOPEN
       DEE6                     KILLW1:
0011B6 DEE6 380B            12      JR  C,KILLW2
0011B8 DEE8 CD1EDD          17      CALL    SOPENE2
0011BB DEEB CDB2DE          17      CALL    KILLS
0011BE DEEE CDE3DC          17      CALL    NOPEN
0011C1 DEF1 18F3            12      JR  KILLW1
       DEF3                     KILLW2:
0011C3 DEF3 C8              11      RET Z
0011C4 DEF4 3F               4      CCF
0011C5 DEF5 C9              10      RET
                                
       DEF6                     CHKATT:
0011C6 DEF6 E5              11      PUSH    HL
0011C7 DEF7 110B00          10      LD  DE,00BH
0011CA DEFA 19              11      ADD HL,DE
0011CB DEFB A6               7      AND (HL)
0011CC DEFC E1              10      POP HL
0011CD DEFD C8              11      RET Z
0011CE DEFE 37               4      SCF
0011CF DEFF C9              10      RET
                                
       DF00                     NAME:
0011D0 DF00 CD74DF          17      CALL    CHKWILDX
0011D3 DF03 D8              11      RET C
0011D4 DF04 110400          10      LD  DE,4
0011D7 DF07 19              11      ADD HL,DE
0011D8 DF08 221DDF          16      LD  (NAMEP),HL
0011DB DF0B 23               6      INC HL
0011DC DF0C CD78DF          17      CALL    CHKWILD
0011DF DF0F D8              11      RET C
                                
0011E0 DF10 CD50DC          17      CALL    SOPENX
0011E3 DF13 3E0F             7      LD  A,00FH
0011E5 DF15 D4F6DE          17      CALL    NC,CHKATT
0011E8 DF18 D8              11      RET C
                                
0011E9 DF19 FDE5            15      PUSH    IY
0011EB DF1B FD210000        14      LD  IY,0        ;自己書き換え
       DF1D                     NAMEP   EQU $-2
0011EF DF1F CD50DC          17      CALL    SOPENX
0011F2 DF22 FDE3            23      EX  (SP),IY
0011F4 DF24 3F               4      CCF
0011F5 DF25 D47FDC          17      CALL    NC,SOPEN
0011F8 DF28 EB               4      EX  DE,HL
0011F9 DF29 E1              10      POP HL
0011FA DF2A D8              11      RET C
                                
       DF2B                     SETNAME:
0011FB DF2B 01000B          10      LD  BC,11*256
0011FE DF2E 23               6      INC HL
0011FF DF2F 7E               7      LD  A,(HL)
001200 DF30 FEE5             7      CP  0E5H
001202 DF32 2004            12      JR  NZ,SNAME1
001204 DF34 3E05             7      LD  A,5
001206 DF36 180E            12      JR  SNAME3
       DF38                     SNAME1:
001208 DF38 7E               7      LD  A,(HL)
001209 DF39 0C               4      INC C
00120A DF3A 0D               4      DEC C
00120B DF3B 2009            12      JR  NZ,SNAME3
00120D DF3D CD54DE          17      CALL    CAP
001210 DF40 FEA0             7      CP  0A0H
001212 DF42 2002            12      JR  NZ,SNAME3
001214 DF44 3E20             7      LD  A,020H
       DF46                     SNAME3:
001216 DF46 12               7      LD  (DE),A
001217 DF47 7E               7      LD  A,(HL)
001218 DF48 23               6      INC HL
001219 DF49 CD61DF          17      CALL    FKAN
00121C DF4C 10EA            13      DJNZ    SNAME1
       DF4E                     WTDB:
00121E DF4E 3EFF             7      LD  A,0FFH
001220 DF50 3239F0          13      LD  (SFILE),A
       DF53                     SWTDBF:
001223 DF53 3E01             7      LD  A,1
001225 DF55 32A4F0          13      LD  (_WTDBF),A
001228 DF58 AF               4      XOR A
001229 DF59 C9              10      RET
                                
       DF5A                     FKANC:
00122A DF5A CB41             8      BIT 0,C
00122C DF5C CC5DDE          17      CALL    Z,CAP2
00122F DF5F 1801            12      JR  FKANX
       DF61                     FKAN:           ;漢字チェック
001231 DF61 13               6      INC DE
       DF62                     FKANX:
001232 DF62 CB41             8      BIT 0,C
001234 DF64 CB81             8      RES 0,C
001236 DF66 C0              11      RET NZ
001237 DF67 FE80             7      CP  080H
001239 DF69 D8              11      RET C
00123A DF6A FEA0             7      CP  0A0H
00123C DF6C 3803            12      JR  C,FKAN1
00123E DF6E FEE0             7      CP  0E0H
001240 DF70 D8              11      RET C
       DF71                     FKAN1:
001241 DF71 0C               4      INC C
001242 DF72 A7               4      AND A
001243 DF73 C9              10      RET
                                
       DF74                     CHKWILDX:
001244 DF74 FDE5            15      PUSH    IY
001246 DF76 E1              10      POP HL
001247 DF77 23               6      INC HL
       DF78                     CHKWILD:
001248 DF78 060B             7      LD  B,11
00124A DF7A 3E3F             7      LD  A,'?'
       DF7C                     CHKWIL1:
00124C DF7C BE               7      CP  (HL)
00124D DF7D 23               6      INC HL
00124E DF7E 37               4      SCF
00124F DF7F C8              11      RET Z
001250 DF80 10FA            13      DJNZ    CHKWIL1
001252 DF82 AF               4      XOR A
001253 DF83 C9              10      RET
                                
       DF84                     SDIRENT:        ;IY=FCB HL=DIR
001254 DF84 D5              11      PUSH    DE
001255 DF85 E5              11      PUSH    HL
001256 DF86 FDE5            15      PUSH    IY
001258 DF88 D1              10      POP DE
001259 DF89 EB               4      EX  DE,HL
00125A DF8A CD2BDF          17      CALL    SETNAME
                                ;               Attribute
00125D DF8D FD7E0D          19      LD  A,(IY+13)   ;(FCB)属性(アトリビュート)
001260 DF90 12               7      LD  (DE),A
001261 DF91 13               6      INC DE
                                ;               Reserved
001262 DF92 AF               4      XOR A
001263 DF93 060A             7      LD  B,10
       DF95                     SDE1:
001265 DF95 12               7      LD  (DE),A
001266 DF96 13               6      INC DE
001267 DF97 10FC            13      DJNZ    SDE1
                                                    ;(FCB)更新時刻
001269 DF99 21E4F1          10      LD  HL,SDDATA       ;(FCB)更新年月日
00126C DF9C 060A             7      LD  B,SDDATAE-SDDATA    ;(FCB)ファイルの先頭クラスタ
       DF9E                     SDLOOP:                 ;(FCB)ファイルのサイズ(バイト単位)
00126E DF9E 7E               7      LD  A,(HL)
00126F DF9F 23               6      INC HL
001270 DFA0 32A5DF          13      LD  (SDPAT),A
001273 DFA3 FD7E00          19      LD  A,(IY+0)    ;LD A,(IY+A)
       DFA5                     SDPAT   EQU $-1
001276 DFA6 12               7      LD  (DE),A
001277 DFA7 13               6      INC DE
001278 DFA8 10F4            13      DJNZ    SDLOOP
                                
00127A DFAA AF               4      XOR A
00127B DFAB E1              10      POP HL
00127C DFAC D1              10      POP DE
00127D DFAD C9              10      RET
                                
       DFAE                     WOPEN:
00127E DFAE FD7E0D          19      LD  A,(IY+13)   ;(FCB)属性(アトリビュート)
001281 DFB1 E61F             7      AND 01FH
001283 DFB3 37               4      SCF
001284 DFB4 C0              11      RET NZ
001285 DFB5 FD361CFE        19      LD  (IY+28),0FEH    ;(FCB)オープンモード
       DFB9                     TOPEN2:
001289 DFB9 AF               4      XOR A
       DFBA                     TOPEN:              ;Initializes the time stamp
00128A DFBA FD3617FF        19      LD  (IY+23),0FFH    ;(FCB)更新時刻
00128E DFBE C9              10      RET
                                
       DFBF                     WRDFX:
00128F DFBF 3A33DE          13      LD  A,(SPCPAT)  ;1クラスタの論理セクタ
       DFC2                     L_WRFX:
001292 DFC2 1F               4      RRA         ;->CF
001293 DFC3 3806            12      JR  C,E_WRFX
001295 DFC5 CB39             8      SRL C
001297 DFC7 CB1C             8      RR  H       ;CH=CH/2
001299 DFC9 18F7            12      JR  L_WRFX
       DFCB                     E_WRFX:
00129B DFCB 41               4      LD  B,C
00129C DFCC 4C               4      LD  C,H
00129D DFCD 03               6      INC BC
00129E DFCE 3E37             7      LD  A,037H      ;SCF
0012A0 DFD0 322BE4          13      LD  (DRDN1),A
                                
       DFD3                     WRDF:               ;BCクラスタ分FATを確保する
0012A3 DFD3 110200          10      LD  DE,2
0012A6 DFD6 AF               4      XOR A
0012A7 DFD7 329BE5          13      LD  (_SECPS),A
       DFDA                     WRDF1:
0012AA DFDA C5              11      PUSH    BC
0012AB DFDB D5              11      PUSH    DE
0012AC DFDC CDF7F0          17      CALL    _GNCL
0012AF DFDF 381C            12      JR  C,WRDF3
0012B1 DFE1 7A               4      LD  A,D     ;空いているかチェック
0012B2 DFE2 B3               4      OR  E
0012B3 DFE3 202A            12      JR  NZ,WRDF4
0012B5 DFE5 E1              10      POP HL      ;HL=空いているクラスタ
0012B6 DFE6 E5              11      PUSH    HL
0012B7 DFE7 ED5BFEF1        20      LD  DE,(_CLPS)  ;DE=元の(_CLPS)
0012BB DFEB 22FEF1          16      LD  (_CLPS),HL
0012BE DFEE 7A               4      LD  A,D     ;元の(_CLPS)が 0 か?
0012BF DFEF B3               4      OR  E
0012C0 DFF0 2008            12      JR  NZ,WRDF2
0012C2 DFF2 FD751A          19      LD  (IY+26),L   ;(FCB)ファイルの先頭クラスタ
0012C5 DFF5 FD741B          19      LD  (IY+27),H   ;元が空の場合はFCBにクラスタをセットする
0012C8 DFF8 1803            12      JR  WRDF3
       DFFA                     WRDF2:
0012CA DFFA CDFAF0          17      CALL    _SNCL
       DFFD                     WRDF3:
0012CD DFFD D1              10      POP DE
0012CE DFFE C1              10      POP BC
0012CF DFFF D8              11      RET C
0012D0 E000 0B               6      DEC BC
0012D1 E001 78               4      LD  A,B
0012D2 E002 B1               4      OR  C
0012D3 E003 200C            12      JR  NZ,WRDF5    ;ここでループカウンタチェック
0012D5 E005 ED5BFEF1        20      LD  DE,(_CLPS)
0012D9 E009 21FFFF          10      LD  HL,0FFFFH   ;FATエントリ終了(EOCマーク)
0012DC E00C C3FAF0          10      JP  _SNCL
                                
       E00F                     WRDF4:              ;DEクラスタが空じゃないので次に移動する
0012DF E00F D1              10      POP DE
0012E0 E010 C1              10      POP BC
       E011                     WRDF5:
0012E1 E011 13               6      INC DE
0012E2 E012 CD4CDE          17      CALL    ENDCL
0012E5 E015 38C3            12      JR  C,WRDF1
0012E7 E017 37               4      SCF
0012E8 E018 C9              10      RET
                                
       E019                     RWXR:
0012E9 E019 3A38E3          13      LD  A,(SECSZ+2) ;1024=4 / 512=2 / 256=1
       E01C                     L_RWX:
0012EC E01C 1F               4      RRA     ;->CF
0012ED E01D 3808            12      JR  C,E_RWX
0012EF E01F CB38             8      SRL B   ;BCH=BCH/2
0012F1 E021 CB19             8      RR  C   ;
0012F3 E023 CB1C             8      RR  H   ;
0012F5 E025 18F5            12      JR  L_RWX
       E027                     E_RWX:
0012F7 E027 FD5E1A          19      LD  E,(IY+26)   ;(FCB)ファイルの先頭クラスタ
0012FA E02A FD561B          19      LD  D,(IY+27)
0012FD E02D AF               4      XOR A
0012FE E02E 329BE5          13      LD  (_SECPS),A
       E031                     RWX1:
001301 E031 ED53FEF1        20      LD  (_CLPS),DE
001305 E035 7A               4      LD  A,D
001306 E036 B3               4      OR  E
001307 E037 2813            12      JR  Z,SCF_RET   ;RET DE==0 => CF=1
                                
001309 E039 78               4      LD  A,B
00130A E03A B1               4      OR  C
00130B E03B B4               4      OR  H
00130C E03C C8              11      RET Z       ;RET BCH==0 => CF=0
                                
00130D E03D CDA3E5          17      CALL    GNCLX
001310 E040 D8              11      RET C
001311 E041 7C               4      LD  A,H     ;
001312 E042 25               4      DEC H       ;
001313 E043 B7               4      OR  A       ;DEC BCH
001314 E044 2001            12      JR  NZ,RWX2     ;
001316 E046 0B               6      DEC BC      ;
       E047                     RWX2:
001317 E047 CD4CDE          17      CALL    ENDCL
00131A E04A 38E5            12      JR  C,RWX1
       E04C                     SCF_RET:
00131C E04C 37               4      SCF
00131D E04D C9              10      RET
                                
       E04E                     DSKF:
00131E E04E 110000          10      LD  DE,0
       E04F                     MAXCLP  EQU $-2
001321 E051 2AACF0          16      LD  HL,(_FAKEFREE)
001324 E054 7C               4      LD  A,H
001325 E055 B5               4      OR  L
001326 E056 2803            12      JR  Z,DSKF1
001328 E058 110100          10      LD  DE,1
       E05B                     DSKF1:
00132B E05B D5              11      PUSH    DE
00132C E05C CDF7F0          17      CALL    _GNCL
00132F E05F 380C            12      JR  C,POPSCF
001331 E061 7A               4      LD  A,D
001332 E062 B3               4      OR  E
001333 E063 2001            12      JR  NZ,DSKF2
001335 E065 23               6      INC HL
       E066                     DSKF2:
001336 E066 D1              10      POP DE
001337 E067 1B               6      DEC DE
001338 E068 7A               4      LD  A,D
001339 E069 B3               4      OR  E
00133A E06A 20EF            12      JR  NZ,DSKF1
00133C E06C C9              10      RET
                                
       E06D                     POPSCF:
00133D E06D F1              10      POP AF
00133E E06E 37               4      SCF
00133F E06F C9              10      RET
                                
       E070                     SETTMS:
001340 E070 FD7E17          19      LD  A,(IY+23)   ;(FCB)ファイルを最後に変更した時刻
001343 E073 3C               4      INC A
001344 E074 C0              11      RET NZ      ;ファイルが更新されていない
       E075                     SETTMSX:            ;FCBに日付時刻をセットする
001345 E075 CDB0D7          17      CALL    _SYS2C      ;(BDOS)時刻の獲得
                                                ;H←時  L←分  D←秒
001348 E078 CB25             8      SLA L       ;   *2
00134A E07A CB25             8      SLA L       ;   *4
00134C E07C 29              11      ADD HL,HL       ;*2 *8
00134D E07D 29              11      ADD HL,HL       ;*4 *16
00134E E07E 29              11      ADD HL,HL       ;*8 *32
00134F E07F 7A               4      LD  A,D
001350 E080 0F               4      RRCA            ;bit.0->7->->->0->C
001351 E081 E61F             7      AND 01FH
001353 E083 B5               4      OR  L
001354 E084 FD7716          19      LD  (IY+22),A   ;(FCB)ファイルを最後に変更した時刻
001357 E087 FD7417          19      LD  (IY+23),H
                                
00135A E08A CDAAD7          17      CALL    _SYS2A      ;(BDOS)日付の獲得
                                                ;HL←年  D←月  E←日
00135D E08D 0144F8          10      LD  BC,0-1980
001360 E090 09              11      ADD HL,BC
001361 E091 65               4      LD  H,L
                                
001362 E092 7A               4      LD  A,D
001363 E093 87               4      ADD A,A     ;*2
001364 E094 87               4      ADD A,A     ;*4
001365 E095 87               4      ADD A,A     ;*8
001366 E096 87               4      ADD A,A     ;*16
001367 E097 6F               4      LD  L,A
001368 E098 29              11      ADD HL,HL       ;*32
001369 E099 7D               4      LD  A,L
00136A E09A B3               4      OR  E
00136B E09B FD7714          19      LD  (IY+20),A   ;(FCB)ファイルを最後に変更した日付
00136E E09E FD7415          19      LD  (IY+21),H
001371 E0A1 C9              10      RET
                                
       E0A2                     PUSHRR:
001372 E0A2 323AE1          13      LD  (SETSEQ_SWC_RND),A
001375 E0A5 224CE1          16      LD  (SETSEQ_SWC_SEQ_RR),HL
001378 E0A8 CDC8E0          17      CALL    GET_RR_AHL
00137B E0AB 220FF0          16      LD  (RR_BUF_HL),HL
00137E E0AE 3211F0          13      LD  (RR_BUF_A),A
001381 E0B1 C9              10      RET
                                
       E0B2                     GET_CPM_R_SIZE:     ;バイト単位からCP/Mのレコード単位を求める（1レコード=128バイト）
001382 E0B2 87               4      ADD A,A     ;in BHLA => out AHL
001383 E0B3 ED6A            15      ADC HL,HL
001385 E0B5 CB18             8      RR  B
001387 E0B7 B7               4      OR  A
001388 E0B8 78               4      LD  A,B     ;ここでフラグは変化しない
001389 E0B9 C8              11      RET Z
00138A E0BA 2C               4      INC L       ;INC AHL
00138B E0BB C0              11      RET NZ      ;
00138C E0BC 24               4      INC H       ;
00138D E0BD C0              11      RET NZ      ;
00138E E0BE 3C               4      INC A       ;
00138F E0BF C9              10      RET
                                
       E0C0                     INIT_RND:
001390 E0C0 3ECD             7      LD  A,0CDH      ;CALL ????
001392 E0C2 210FE1          10      LD  HL,POPRR
001395 E0C5 CDA2E0          17      CALL    PUSHRR
       E0C8                     GET_RR_AHL:
001398 E0C8 FD6E21          19      LD  L,(IY+33)   ;(FCB)Random record
00139B E0CB FD6622          19      LD  H,(IY+34)   ;
00139E E0CE FD7E23          19      LD  A,(IY+35)   ;
0013A1 E0D1 C9              10      RET
       E0D2                     SET_RR_AHL:
0013A2 E0D2 FD7521          19      LD  (IY+33),L   ;(FCB)Random record
0013A5 E0D5 FD7422          19      LD  (IY+34),H
0013A8 E0D8 FD7723          19      LD  (IY+35),A
0013AB E0DB C9              10      RET
       E0DC                     INIT_SEQ:
0013AC E0DC 3E01             7      LD  A,1     ;LD BC,????
0013AE E0DE 210CE1          10      LD  HL,SETSEQ
0013B1 E0E1 CDA2E0          17      CALL    PUSHRR
       E0E4                     GETSEQ:
0013B4 E0E4 FD6E20          19      LD  L,(IY+32)   ;(FCB)カレントレコード
0013B7 E0E7 FD660C          19      LD  H,(IY+12)   ;(FCB)カレントブロック
0013BA E0EA AF               4      XOR A
                                
0013BB E0EB CB25             8      SLA L   ;L=L*2
                                
0013BD E0ED CB3C             8      SRL H   ;HL=HL/2
0013BF E0EF CB1D             8      RR  L   ;
0013C1 E0F1 C9              10      RET
                                
       E0F2                     SETSEQ1:
0013C2 E0F2 F5              11      PUSH    AF
0013C3 E0F3 E5              11      PUSH    HL      ;AHL=Random record
0013C4 E0F4 CDC8E0          17      CALL    GET_RR_AHL
0013C7 E0F7 47               4      LD  B,A     ;AHL→HLA
0013C8 E0F8 7D               4      LD  A,L     ;(IY+33)(FCB)ランダムレコード
0013C9 E0F9 6C               4      LD  L,H     ;(IY+34)
0013CA E0FA 60               4      LD  H,B     ;(IY+35)
0013CB E0FB 0600             7      LD  B,0
                                
0013CD E0FD CDB2E0          17      CALL    GET_CPM_R_SIZE
                                
0013D0 E100 29              11      ADD HL,HL
0013D1 E101 CB3D             8      SRL L       ;L=L/2
0013D3 E103 FD7520          19      LD  (IY+32),L   ;(FCB)カレントレコード
0013D6 E106 FD740C          19      LD  (IY+12),H   ;(FCB)カレントブロック
0013D9 E109 E1              10      POP HL
0013DA E10A F1              10      POP AF
0013DB E10B C9              10      RET
       E10C                     SETSEQ:
0013DC E10C CDF2E0          17      CALL    SETSEQ1
       E10F                     POPRR:
0013DF E10F F5              11      PUSH    AF
0013E0 E110 E5              11      PUSH    HL
0013E1 E111 2A0FF0          16      LD  HL,(RR_BUF_HL)
0013E4 E114 3A11F0          13      LD  A,(RR_BUF_A)
0013E7 E117 CDD2E0          17      CALL    SET_RR_AHL
0013EA E11A E1              10      POP HL
0013EB E11B F1              10      POP AF
0013EC E11C C9              10      RET
                                
       E11D                     RB_WRITE:
0013ED E11D C5              11      PUSH    BC
0013EE E11E ED4B4CF1        20      LD  BC,(STABLE+2*026H)  ;(BDOS)ランダムブロック書き込み
0013F2 E122 1805            12      JR  RBRW
       E124                     RB_READ:
0013F4 E124 C5              11      PUSH    BC
0013F5 E125 ED4B4EF1        20      LD  BC,(STABLE+2*027H)  ;(BDOS)ランダムブロック読み込み
       E129                     RBRW:
0013F9 E129 1F               4      RRA     ;AHL = AHL*128
0013FA E12A 7C               4      LD  A,H ;AHL = AHL0/2
0013FB E12B 1F               4      RRA     ;A
0013FC E12C 65               4      LD  H,L ;
0013FD E12D CB1C             8      RR  H   ;H
0013FF E12F 2E00             7      LD  L,0 ;
001401 E131 CB1D             8      RR  L   ;L
001403 E133 CDD2E0          17      CALL    SET_RR_AHL
001406 E136 218000          10      LD  HL,128
001409 E139 C5              11      PUSH    BC
       E13A                     SETSEQ_SWC_RND:
00140A E13A CDF2E0          17      CALL    SETSEQ1
00140D E13D C1              10      POP BC
00140E E13E FDCB20FE        23      SET 7,(IY+32)   ;(FCB)カレントレコード
001412 E142 FDE5            15      PUSH    IY
001414 E144 D1              10      POP DE
001415 E145 D5              11      PUSH    DE
001416 E146 CD54E1          17      CALL    JP_BC
001419 E149 FDE1            14      POP IY
00141B E14B CD0CE1          17      CALL    SETSEQ
       E14C                     SETSEQ_SWC_SEQ_RR   EQU $-2
00141E E14E FDCB20BE        23      RES 7,(IY+32)   ;(FCB)カレントレコード
                                
001422 E152 C1              10      POP BC
001423 E153 C9              10      RET
       E154                     JP_BC:
001424 E154 C5              11      PUSH    BC
001425 E155 C9              10      RET
                                
       DCDD                     _SYS03  EQU SCF_FF_RET  ;(BDOS)外部入力
       DCDD                     _SYS2B  EQU SCF_FF_RET  ;(BDOS)日付の設定
       DCDD                     _SYS2D  EQU SCF_FF_RET  ;(BDOS)時刻の設定
       DCDD                     _SYS39  EQU SCF_FF_RET  ;(BDOS)サブディレクトリの作成
       DCDD                     _SYS3A  EQU SCF_FF_RET  ;(BDOS)サブディレクトリの削除
                                
[EOF:LDFILE.ASM:SHIFT_JIS]
                                    INCLUDE "LDFILE2.ASM"
                                
                                ;   LSX-Dodgers FILE2
                                
                                                ;Write random block
       E156                     _SYS26:     ;(BDOS)ランダムブロック書き込み
001426 E156 AF               4      XOR A
001427 E157 322BE4          13      LD  (DRDN1),A   ;NOP
00142A E15A 227BE3          16      LD  (RBSIZE),HL ;HL←書き込むレコード数
00142D E15D 225DF0          16      LD  (LEFTX),HL
001430 E160 CD26DC          17      CALL    SETDRV
                                
001433 E163 CDD3E2          17      CALL    RBX0
001436 E166 DAF3E1          10      JP  C,RBWERR
001439 E169 CDAEDF          17      CALL    WOPEN
00143C E16C DAF3E1          10      JP  C,RBWERR
00143F E16F 7C               4      LD  A,H
001440 E170 B5               4      OR  L
001441 E171 CAECE1          10      JP  Z,RBW1
                                
001444 E174 2B               6      DEC HL
                                
001445 E175 CD91E3          17      CALL    GET_RR_BCDE ;BCDE=Random record
                                
001448 E178 19              11      ADD HL,DE       ;BCHL=HL+BCDE
001449 E179 3001            12      JR  NC,S26X1    ;
00144B E17B 03               6      INC BC      ;
       E17C                     S26X1:
00144C E17C CD19E0          17      CALL    RWXR
00144F E17F DCBFDF          17      CALL    C,WRDFX
001452 E182 DAF3E1          10      JP  C,RBWERR
                                
001455 E185 CD02E3          17      CALL    RBX2
001458 E188 281A            12      JR  Z,RBWB      ;NZ=セクタ以下の端数がある
00145A E18A CD21E3          17      CALL    RBXA
00145D E18D 3864            12      JR  C,RBWERR
00145F E18F EB               4      EX  DE,HL
001460 E190 C5              11      PUSH    BC
001461 E191 EDB0                    LDIR
001463 E193 225FF0          16      LD  (DTAX),HL
                                
001466 E196 CD53DF          17      CALL    SWTDBF      ;バッファデータは更新された
                                
001469 E199 2A5DF0          16      LD  HL,(LEFTX)
00146C E19C D1              10      POP DE
00146D E19D ED52            15      SBC HL,DE
00146F E19F 225DF0          16      LD  (LEFTX),HL
001472 E1A2 2831            12      JR  Z,RBWEND
                                
       E1A4                     RBWB:
001474 E1A4 CD56E3          17      CALL    RBXB
001477 E1A7 2814            12      JR  Z,RBWC
       E1A9                     RBWB1:
001479 E1A9 C5              11      PUSH    BC
00147A E1AA D5              11      PUSH    DE
00147B E1AB CD2FDE          17      CALL    CLUSTX
00147E E1AE CDA5E3          17      CALL    DWTC
001481 E1B1 D1              10      POP DE
001482 E1B2 C1              10      POP BC
001483 E1B3 D4A3E5          17      CALL    NC,GNCLX
001486 E1B6 383B            12      JR  C,RBWERR
001488 E1B8 10EF            13      DJNZ    RBWB1
00148A E1BA CDF5E3          17      CALL    DRW_FLUSH
       E1BD                     RBWC:
00148D E1BD CD6EE3          17      CALL    RBXC
001490 E1C0 2813            12      JR  Z,RBWEND
001492 E1C2 C5              11      PUSH    BC
001493 E1C3 CD2FDE          17      CALL    CLUSTX
001496 E1C6 CD2AE4          17      CALL    DRDN
001499 E1C9 C1              10      POP BC
00149A E1CA 3827            12      JR  C,RBWERR
00149C E1CC ED5B7EF1        20      LD  DE,(_DTBUF)
0014A0 E1D0 EDB0                    LDIR
0014A2 E1D2 CD53DF          17      CALL    SWTDBF      ;バッファデータは更新された
       E1D5                     RBWEND:
0014A5 E1D5 CD7AE3          17      CALL    RBXEND
                                
0014A8 E1D8 CDE2E2          17      CALL    RBX1
0014AB E1DB 300F            12      JR  NC,RBW1     ;ランダムレコードの方が大きい場合はサイズを合わせる
0014AD E1DD CD91E3          17      CALL    GET_RR_BCDE ;BCDE=Random record
0014B0 E1E0 FD7310          19      LD  (IY+16),E   ;ファイルのサイズ(バイト単位)
0014B3 E1E3 FD7211          19      LD  (IY+17),D   ;
0014B6 E1E6 FD7112          19      LD  (IY+18),C   ;
0014B9 E1E9 FD7013          19      LD  (IY+19),B   ;
       E1EC                     RBW1:
0014BC E1EC FDE1            14      POP IY
0014BE E1EE C1              10      POP BC
0014BF E1EF D1              10      POP DE
0014C0 E1F0 E1              10      POP HL
       E1F1                     DD_NUL:
0014C1 E1F1 AF               4      XOR A
       E1F2                     DRDF0:
       E1F2                     DWTF0:
0014C2 E1F2 C9              10      RET
                                
       E1F3                     RBWERR:
0014C3 E1F3 FDE5            15      PUSH    IY
0014C5 E1F5 D1              10      POP DE
0014C6 E1F6 2A20F1          16      LD  HL,(STABLE+2*010H)
0014C9 E1F9 CD0F00          17      CALL    JP_HL
       E1FC                     RBRERR1:
0014CC E1FC 3E01             7      LD  A,001H
       E1FE                     RBRERR2:
0014CE E1FE FDE1            14      POP IY
0014D0 E200 C1              10      POP BC
0014D1 E201 D1              10      POP DE
0014D2 E202 E1              10      POP HL
0014D3 E203 37               4      SCF
0014D4 E204 210000          10      LD  HL,0
0014D7 E207 C9              10      RET
                                
       E208                     RBRERR:
0014D8 E208 3EFF             7      LD  A,0FFH
0014DA E20A 18F2            12      JR  RBRERR2
                                
       E20C                     RBRFL:
0014DC E20C 3E00             7  RBRFLP: LD  A,000H
0014DE E20E FE0D             7      CP  00DH
0014E0 E210 2005            12      JR  NZ,RBRFL1
0014E2 E212 D5              11      PUSH    DE
0014E3 E213 1E0A             7      LD  E,00AH
0014E5 E215 1805            12      JR  RBRFL2
       E217                     RBRFL1:
0014E7 E217 D5              11      PUSH    DE
0014E8 E218 CD09F0          17      CALL    _SYS07
0014EB E21B 5F               4      LD  E,A
       E21C                     RBRFL2:
0014EC E21C CDCDF0          17      CALL    _PRINT
0014EF E21F 7B               4      LD  A,E
0014F0 E220 D1              10      POP DE
0014F1 E221 320DE2          13      LD  (RBRFLP+1),A
0014F4 E224 C9              10      RET
       E225                     DDX:
0014F5 E225 FD7E01          19      LD  A,(IY+1)    ;(FCB)主ファイル名
0014F8 E228 CD54DE          17      CALL    CAP
0014FB E22B FE41             7      CP  'A'
0014FD E22D C9              10      RET
                                
                                                ;Read random block
       E22E                     _SYS27:     ;(BDOS)ランダムブロック読み込み
0014FE E22E 225DF0          16      LD  (LEFTX),HL
001501 E231 CD26DC          17      CALL    SETDRV
                                
001504 E234 FDCB0D66        20      BIT 4,(IY+13)   ;(FCB)属性(アトリビュート)
001508 E238 C2C1E2          10      JP  NZ,RBRDIR   ;ディレクトリ
00150B E23B CDD3E2          17      CALL    RBX0
00150E E23E DA08E2          10      JP  C,RBRERR
001511 E241 CDE2E2          17      CALL    RBX1
001514 E244 D4FAE2          17      CALL    NC,RBX1R
001517 E247 DAFCE1          10      JP  C,RBRERR1
00151A E24A EB               4      EX  DE,HL
00151B E24B ED52            15      SBC HL,DE       ;CP 00HL,BCDE
00151D E24D 19              11      ADD HL,DE
00151E E24E 79               4      LD  A,C
00151F E24F DE00             7      SBC A,0
001521 E251 78               4      LD  A,B
001522 E252 DE00             7      SBC A,0
001524 E254 3801            12      JR  C,RBR1
001526 E256 EB               4      EX  DE,HL
       E257                     RBR1:
001527 E257 9F               4      SBC A,A
001528 E258 E601             7      AND 1
00152A E25A 32BFE2          13      LD  (RBRAP+1),A
                                
00152D E25D 7C               4      LD  A,H
00152E E25E B5               4      OR  L
00152F E25F 2857            12      JR  Z,RBREND0
                                
001531 E261 227BE3          16      LD  (RBSIZE),HL ;HL←読み込むレコード数
001534 E264 225DF0          16      LD  (LEFTX),HL
                                
001537 E267 CD02E3          17      CALL    RBX2
00153A E26A 2819            12      JR  Z,RBRB
00153C E26C CD21E3          17      CALL    RBXA
00153F E26F DA08E2          10      JP  C,RBRERR
001542 E272 C5              11      PUSH    BC
001543 E273 EDB0                    LDIR
001545 E275 ED535FF0        20      LD  (DTAX),DE
001549 E279 2A5DF0          16      LD  HL,(LEFTX)
00154C E27C D1              10      POP DE
00154D E27D A7               4      AND A
00154E E27E ED52            15      SBC HL,DE
001550 E280 225DF0          16      LD  (LEFTX),HL
001553 E283 2830            12      JR  Z,RBREND
                                
       E285                     RBRB:
001555 E285 CD56E3          17      CALL    RBXB
001558 E288 2815            12      JR  Z,RBRC
       E28A                     RBRB1:
00155A E28A C5              11      PUSH    BC
00155B E28B D5              11      PUSH    DE
00155C E28C CD2FDE          17      CALL    CLUSTX
00155F E28F CDABE3          17      CALL    DRDC
001562 E292 D1              10      POP DE
001563 E293 C1              10      POP BC
001564 E294 D4A3E5          17      CALL    NC,GNCLX
001567 E297 DA08E2          10      JP  C,RBRERR
00156A E29A 10EE            13      DJNZ    RBRB1
00156C E29C CDF5E3          17      CALL    DRW_FLUSH
       E29F                     RBRC:
00156F E29F CD6EE3          17      CALL    RBXC
001572 E2A2 2811            12      JR  Z,RBREND
001574 E2A4 C5              11      PUSH    BC
001575 E2A5 CD2FDE          17      CALL    CLUSTX
001578 E2A8 CD0EE4          17      CALL    DRDX
00157B E2AB C1              10      POP BC
00157C E2AC DA08E2          10      JP  C,RBRERR
00157F E2AF EB               4      EX  DE,HL
001580 E2B0 2A7EF1          16      LD  HL,(_DTBUF)
001583 E2B3 EDB0                    LDIR
       E2B5                     RBREND:
001585 E2B5 CD7AE3          17      CALL    RBXEND
       E2B8                     RBREND0:
001588 E2B8 FDE1            14      POP IY
00158A E2BA C1              10      POP BC
00158B E2BB D1              10      POP DE
00158C E2BC F1              10      POP AF  ;(HL)
00158D E2BD AF               4      XOR A
00158E E2BE 3E00             7  RBRAP:  LD  A,000H
001590 E2C0 C9              10      RET
                                
       E2C1                     RBRDIR:
001591 E2C1 FD6E1A          19      LD  L,(IY+26)   ;(FCB)ファイルの先頭クラスタ
001594 E2C4 FD661B          19      LD  H,(IY+27)
001597 E2C7 CD6ADE          17      CALL    CHDIR
00159A E2CA AF               4      XOR A
00159B E2CB 67               4      LD  H,A
00159C E2CC 6F               4      LD  L,A
00159D E2CD 3C               4      INC A
00159E E2CE 32BFE2          13      LD  (RBRAP+1),A
0015A1 E2D1 18E5            12      JR  RBREND0
                                
       E2D3                     RBX0:
0015A3 E2D3 2A8AF0          16      LD  HL,(_DTA)
0015A6 E2D6 225FF0          16      LD  (DTAX),HL
0015A9 E2D9 2A5DF0          16      LD  HL,(LEFTX)
0015AC E2DC FD7E1C          19      LD  A,(IY+28)   ;(FCB)オープンモード
0015AF E2DF D6FD             7      SUB 0FDH
0015B1 E2E1 C9              10      RET
                                
       E2E2                     RBX1:               ;ファイルサイズとランダムレコードを比べる
0015B2 E2E2 E5              11      PUSH    HL      ;Record byte
                                                ;AHL=File size
0015B3 E2E3 FD6E10          19      LD  L,(IY+16)   ;ファイルのサイズ(バイト単位)
0015B6 E2E6 FD6611          19      LD  H,(IY+17)   ;
0015B9 E2E9 FD7E12          19      LD  A,(IY+18)   ;
                                
0015BC E2EC CD91E3          17      CALL    GET_RR_BCDE ;BCDE=Random record
                                
0015BF E2EF A7               4      AND A
0015C0 E2F0 ED52            15      SBC HL,DE
0015C2 E2F2 99               4      SBC A,C
0015C3 E2F3 4F               4      LD  C,A
0015C4 E2F4 FD7E13          19      LD  A,(IY+19)   ;ファイルのサイズ
0015C7 E2F7 98               4      SBC A,B
0015C8 E2F8 D1              10      POP DE
0015C9 E2F9 C9              10      RET
       E2FA                     RBX1R:
0015CA E2FA 47               4      LD  B,A
0015CB E2FB B1               4      OR  C
0015CC E2FC EB               4      EX  DE,HL   ;BCDE=File byte HL=Record byte
0015CD E2FD B2               4      OR  D
0015CE E2FE B3               4      OR  E
0015CF E2FF C0              11      RET NZ
0015D0 E300 37               4      SCF
0015D1 E301 C9              10      RET
                                
       E302                     RBX2:               ;Cluster settings
0015D2 E302 FD6622          19      LD  H,(IY+34)   ;(+33)(FCB)ランダムレコード
0015D5 E305 FD4E23          19      LD  C,(IY+35)
0015D8 E308 0600             7      LD  B,0
0015DA E30A FDCB207E        20      BIT 7,(IY+32)   ;(FCB)カレントレコード
0015DE E30E 2003            12      JR  NZ,RBX3
0015E0 E310 FD4624          19      LD  B,(IY+36)
       E313                     RBX3:
0015E3 E313 CD19E0          17      CALL    RWXR
0015E6 E316 3A38E3          13      LD  A,(SECSZ+2) ;1024=4 / 512=2 / 256=1
0015E9 E319 3D               4      DEC A
0015EA E31A FDA622          19      AND (IY+34)
0015ED E31D FDB621          19      OR  (IY+33)
0015F0 E320 C9              10      RET
                                
       E321                     RBXA:
0015F1 E321 C5              11      PUSH    BC
0015F2 E322 D5              11      PUSH    DE
0015F3 E323 CD2FDE          17      CALL    CLUSTX
0015F6 E326 CD0EE4          17      CALL    DRDX
0015F9 E329 D1              10      POP DE
0015FA E32A C1              10      POP BC
0015FB E32B D4A3E5          17      CALL    NC,GNCLX
0015FE E32E D8              11      RET C
0015FF E32F ED53FEF1        20      LD  (_CLPS),DE
                                
001603 E333 FD4E21          19      LD  C,(IY+33)   ;(FCB)ランダムレコード
001606 E336 210004          10  SECSZ:  LD  HL,0400H    ;自己書き換え 1024=0400H / 512=0200H ここに1セクタのサイズが格納される
001609 E339 7C               4      LD  A,H
00160A E33A 3D               4      DEC A       ;1024=3 / 512=1
00160B E33B FDA622          19      AND (IY+34)     ;(FCB)ランダムレコード
00160E E33E 47               4      LD  B,A     ;BCに1セクタ以下の端数が入る
00160F E33F ED42            15      SBC HL,BC       ;残りを計算
                                
001611 E341 ED5B5DF0        20      LD  DE,(LEFTX)
001615 E345 ED52            15      SBC HL,DE       ;CP HL,DE
001617 E347 19              11      ADD HL,DE       ;
001618 E348 3801            12      JR  C,RBXA1     ;DEとHLを比較して大きい方をHLに
00161A E34A EB               4      EX  DE,HL
       E34B                     RBXA1:
00161B E34B E5              11      PUSH    HL
00161C E34C 2A7EF1          16      LD  HL,(_DTBUF)
00161F E34F 09              11      ADD HL,BC
001620 E350 ED5B5FF0        20      LD  DE,(DTAX)
001624 E354 C1              10      POP BC
001625 E355 C9              10      RET
                                
       E356                     RBXB:
001626 E356 2A5FF0          16      LD  HL,(DTAX)
001629 E359 ED5BFEF1        20      LD  DE,(_CLPS)
00162D E35D 3A5EF0          13      LD  A,(LEFTX+1)
001630 E360 47               4      LD  B,A
001631 E361 3A38E3          13      LD  A,(SECSZ+2) ;1024=4 / 512=2 / 256=1
       E364                     RBXB1:
001634 E364 1F               4      RRA     ;->CF
001635 E365 3804            12      JR  C,RBXB2
001637 E367 CB38             8      SRL B   ;B=B/2
001639 E369 18F9            12      JR  RBXB1
       E36B                     RBXB2:
00163B E36B 78               4      LD  A,B
00163C E36C B7               4      OR  A
00163D E36D C9              10      RET
                                
       E36E                     RBXC:
00163E E36E ED4B5DF0        20      LD  BC,(LEFTX)
001642 E372 3A38E3          13      LD  A,(SECSZ+2) ;1024=4 / 512=2 / 256=1
001645 E375 3D               4      DEC A
001646 E376 A0               4      AND B
001647 E377 47               4      LD  B,A     ;1セクタ以下の端数がない場合はZ
001648 E378 B1               4      OR  C
001649 E379 C9              10      RET
                                
       E37A                     RBXEND:             ;レコード数だけランダムレコードを進める
00164A E37A 110000          10      LD  DE,0        ;進めるレコード数(RBSIZE)
       E37B                     RBSIZE  EQU $-2
00164D E37D CDC8E0          17      CALL    GET_RR_AHL
001650 E380 19              11      ADD HL,DE
001651 E381 CE00             7      ADC A,0
001653 E383 CDD2E0          17      CALL    SET_RR_AHL
001656 E386 EB               4      EX  DE,HL       ;HL=進めるレコード数
001657 E387 D0              11      RET NC
001658 E388 FDCB207E        20      BIT 7,(IY+32)   ;(FCB)カレントレコード
00165C E38C C0              11      RET NZ
00165D E38D FD3424          23      INC (IY+36)
001660 E390 C9              10      RET
                                
       E391                     GET_RR_BCDE:            ;BCDE=Random record
001661 E391 FD5E21          19      LD  E,(IY+33)   ;(FCB)ランダムレコード
001664 E394 FD5622          19      LD  D,(IY+34)
001667 E397 FD4E23          19      LD  C,(IY+35)
00166A E39A 0600             7      LD  B,0     ;CP/M互換のアクセスの場合はFCBは36バイト
00166C E39C FDCB207E        20      BIT 7,(IY+32)   ;(FCB)カレントレコード
001670 E3A0 C0              11      RET NZ
001671 E3A1 FD4624          19      LD  B,(IY+36)
001674 E3A4 C9              10      RET
                                
                                ;   ランダムブロックアクセスの連続したセクタをまとめる
                                
       E3A5                     DWTC:
001675 E3A5 E5              11      PUSH    HL
001676 E3A6 2133E7          10      LD  HL,DWT24B
001679 E3A9 1804            12      JR  DWTC1
       E3AB                     DRDC:
00167B E3AB E5              11      PUSH    HL
00167C E3AC 2123E7          10      LD  HL,DRD24B
       E3AF                     DWTC1:
00167F E3AF 2209E4          16      LD  (DRWF_MODE),HL
001682 E3B2 E1              10      POP HL
001683 E3B3 3AF9E3          13      LD  A,(DRWF_B)
001686 E3B6 B7               4      OR  A
001687 E3B7 200F            12      JR  NZ,DRDC1
       E3B9                     SAVE_DRWC:
001689 E3B9 0601             7      LD  B,1
00168B E3BB ED43F8E3        20      LD  (DRWF_C),BC
00168F E3BF ED53FFE3        20      LD  (DRWF_E),DE
001693 E3C3 2202E4          16      LD  (DRWF_HL),HL
001696 E3C6 1820            12      JR  INC_HL_DRWC
       E3C8                     DRDC1:
001698 E3C8 E5              11      PUSH    HL
001699 E3C9 21FFE3          10      LD  HL,DRWF_E
00169C E3CC 86               7      ADD A,(HL)
00169D E3CD F5              11      PUSH    AF
00169E E3CE BB               4      CP  E
00169F E3CF 201D            12      JR  NZ,DRDC2
0016A1 E3D1 F1              10      POP AF
0016A2 E3D2 23               6      INC HL
0016A3 E3D3 7E               7      LD  A,(HL)
0016A4 E3D4 CE00             7      ADC A,0
0016A6 E3D6 F5              11      PUSH    AF
0016A7 E3D7 BA               4      CP  D
0016A8 E3D8 2014            12      JR  NZ,DRDC2
0016AA E3DA F1              10      POP AF
0016AB E3DB 3AF8E3          13      LD  A,(DRWF_C)
0016AE E3DE CE00             7      ADC A,0
0016B0 E3E0 B9               4      CP  C
0016B1 E3E1 200C            12      JR  NZ,DRDC3
0016B3 E3E3 21F9E3          10      LD  HL,DRWF_B
0016B6 E3E6 34              11      INC (HL)
0016B7 E3E7 E1              10      POP HL
       E3E8                     INC_HL_DRWC:
0016B8 E3E8 3A38E3          13      LD  A,(SECSZ+2)     ;1セクタのサイズの上位1バイト
0016BB E3EB 84               4      ADD A,H
0016BC E3EC 67               4      LD  H,A
0016BD E3ED C9              10      RET
       E3EE                     DRDC2:
0016BE E3EE F1              10      POP AF
       E3EF                     DRDC3:
0016BF E3EF CDF5E3          17      CALL    DRW_FLUSH
0016C2 E3F2 E1              10      POP HL
0016C3 E3F3 18C4            12      JR  SAVE_DRWC
                                
                                ;   ランダムブロックアクセスの連続したセクタをまとめたものをフラッシュする
       E3F5                     DRW_FLUSH:
0016C5 E3F5 C5              11      PUSH    BC
0016C6 E3F6 D5              11      PUSH    DE
0016C7 E3F7 010000          10      LD  BC,0
       E3F8                     DRWF_C  EQU $-2
       E3F9                     DRWF_B  EQU $-1
0016CA E3FA 78               4      LD  A,B
0016CB E3FB B7               4      OR  A
0016CC E3FC 280D            12      JR  Z,DRDF1
0016CE E3FE 110000          10      LD  DE,0
       E3FF                     DRWF_E  EQU $-2
       E400                     DRWF_D  EQU $-1
0016D1 E401 210000          10      LD  HL,0
       E402                     DRWF_HL EQU $-2
0016D4 E404 AF               4      XOR A
0016D5 E405 32F9E3          13      LD  (DRWF_B),A
0016D8 E408 CD23E7          17      CALL    DRD24B
       E409                     DRWF_MODE   EQU $-2
       E40B                     DRDF1:
0016DB E40B D1              10      POP DE
0016DC E40C C1              10      POP BC
0016DD E40D C9              10      RET
[EOF:LDFILE2.ASM:SHIFT_JIS]
                                    INCLUDE "LDDIO.ASM"
                                
                                ;   LSX-Dodgers DIO
                                
       E40E                     DRDX:
0016DE E40E CD4CE4          17      CALL    DRDY
0016E1 E411 C8              11      RET Z
0016E2 E412 CD32E4          17      CALL    DRDX1       ;データバッファの情報を保存
0016E5 E415 D8              11      RET C
0016E6 E416 E5              11      PUSH    HL
0016E7 E417 C5              11      PUSH    BC
0016E8 E418 D5              11      PUSH    DE
0016E9 E419 2A7EF1          16      LD  HL,(_DTBUF)
0016EC E41C 3A75E4          13      LD  A,(_DBS24)
0016EF E41F 4F               4      LD  C,A
0016F0 E420 CD21E7          17      CALL    DRD24
0016F3 E423 DC47E4          17      CALL    C,DRDNE
       E426                     POP_DE_BC_HL_RET:
0016F6 E426 D1              10      POP DE
0016F7 E427 C1              10      POP BC
0016F8 E428 E1              10      POP HL
0016F9 E429 C9              10      RET
                                
                                ;   CDE:セクタ番号
       E42A                     DRDN:
0016FA E42A AF               4      XOR A
0016FB E42B 00               4  DRDN1:  NOP         ;自己書き換え NOP / SCF
0016FC E42C 30E0            12      JR  NC,DRDX
       E42E                     DRDNX:
0016FE E42E CD4CE4          17      CALL    DRDY
001701 E431 C8              11      RET Z
       E432                     DRDX1:
001702 E432 CD62E4          17      CALL    DWTX
                                                ;データバッファの読み込んだドライブ・セクタ情報を保存
001705 E435 ED53A6F0        20      LD  (_DBSEC),DE
001709 E439 79               4      LD  A,C
00170A E43A 3275E4          13      LD  (_DBS24),A
                                
00170D E43D 3A88F0          13      LD  A,(_DRV)
001710 E440 32A5F0          13      LD  (_DBDRV),A
001713 E443 CDD9F0          17      CALL    _CHGDRV
001716 E446 D0              11      RET NC
       E447                     DRDNE:
001717 E447 9F               4      SBC A,A     ;CF=1ならばA=0FFH
001718 E448 32A5F0          13      LD  (_DBDRV),A
00171B E44B C9              10      RET
                                
                                ;   CDE:セクタ番号
       E44C                     DRDY:
00171C E44C 3A75E4          13      LD  A,(_DBS24)
00171F E44F B9               4      CP  C
001720 E450 C0              11      RET NZ
                                
001721 E451 E5              11      PUSH    HL
001722 E452 3A88F0          13      LD  A,(_DRV)
001725 E455 21A5F0          10      LD  HL,_DBDRV
001728 E458 AE               7      XOR (HL)
001729 E459 2005            12      JR  NZ,POP_HL_RET
                                
00172B E45B 2AA6F0          16      LD  HL,(_DBSEC)
00172E E45E ED52            15      SBC HL,DE       ;上でXORを使っているのでCF=0のはず
       E460                     POP_HL_RET:
001730 E460 E1              10      POP HL
001731 E461 C9              10      RET
                                
       E462                     DWTX:
001732 E462 3AA4F0          13      LD  A,(_WTDBF)
001735 E465 B7               4      OR  A
001736 E466 C8              11      RET Z
001737 E467 AF               4      XOR A
001738 E468 32A4F0          13      LD  (_WTDBF),A
                                
00173B E46B E5              11      PUSH    HL
00173C E46C C5              11      PUSH    BC
00173D E46D D5              11      PUSH    DE
00173E E46E 3AA5F0          13      LD  A,(_DBDRV)
001741 E471 CDD9F0          17      CALL    _CHGDRV
001744 E474 0E00             7      LD  C,0
       E475                     _DBS24  EQU $-1
001746 E476 ED5BA6F0        20      LD  DE,(_DBSEC)
00174A E47A 2A7EF1          16      LD  HL,(_DTBUF)
00174D E47D D431E7          17      CALL    NC,DWT24
       E480                     POP_DE_BC_HL_RET2:
001750 E480 18A4            12      JR  POP_DE_BC_HL_RET
                                
       E482                     RDFATX:
001752 E482 E5              11      PUSH    HL
001753 E483 3A88F0          13      LD  A,(_DRV)
001756 E486 21AAF0          10      LD  HL,_FATDRV
001759 E489 AE               7      XOR (HL)
00175A E48A 28D4            12      JR  Z,POP_HL_RET
                                
00175C E48C C5              11      PUSH    BC
00175D E48D D5              11      PUSH    DE
00175E E48E DDE5            15      PUSH    IX
001760 E490 CDACE4          17      CALL    WTFATX
001763 E493 3813            12      JR  C,POP_IX_DE_BC_HL_RET
                                
001765 E495 AF               4      XOR A
001766 E496 32ABF0          13      LD  (_FATIX),A
001769 E499 3A88F0          13      LD  A,(_DRV)
00176C E49C 32AAF0          13      LD  (_FATDRV),A
00176F E49F CDE5F0          17      CALL    _RDFAT
       E4A2                     RDFATE2:
001772 E4A2 3004            12      JR  NC,POP_IX_DE_BC_HL_RET
001774 E4A4 9F               4      SBC A,A     ;A=0xFF
001775 E4A5 32AAF0          13      LD  (_FATDRV),A
       E4A8                     POP_IX_DE_BC_HL_RET:
001778 E4A8 DDE1            14      POP IX
00177A E4AA 18D4            12      JR  POP_DE_BC_HL_RET2
                                
       E4AC                     WTFATX:
00177C E4AC 3AA2F0          13      LD  A,(_WTFATF)
00177F E4AF B7               4      OR  A
001780 E4B0 C8              11      RET Z
001781 E4B1 E5              11      PUSH    HL
001782 E4B2 3AAAF0          13      LD  A,(_FATDRV)
001785 E4B5 21A5F0          10      LD  HL,_DBDRV
001788 E4B8 AE               7      XOR (HL)
001789 E4B9 CC62E4          17      CALL    Z,DWTX
00178C E4BC 38A2            12      JR  C,POP_HL_RET
00178E E4BE C5              11      PUSH    BC
00178F E4BF D5              11      PUSH    DE
001790 E4C0 DDE5            15      PUSH    IX
001792 E4C2 CD3EE7          17      CALL    WTFAT
001795 E4C5 AF               4      XOR A
001796 E4C6 32A2F0          13      LD  (_WTFATF),A
001799 E4C9 18DD            12      JR  POP_IX_DE_BC_HL_RET
                                
       E4CB                     NCL1:
00179B E4CB 7A               4      LD  A,D
00179C E4CC B3               4      OR  E
00179D E4CD 37               4      SCF
00179E E4CE C8              11      RET Z
                                
00179F E4CF 7A               4      LD  A,D
0017A0 E4D0 CB3F             8      SRL A   ;/2
0017A2 E4D2 CB3F             8      SRL A   ;/2
                                
0017A4 E4D4 E5              11      PUSH    HL
0017A5 E4D5 32F4E4          13      LD  (NCLPAT_FATIX),A    ;_FATIX
0017A8 E4D8 2AAAF0          16      LD  HL,(_FATDRV)    ;L=_FATDRV H=_FATIX
0017AB E4DB BC               4      CP  H
0017AC E4DC 3A88F0          13      LD  A,(_DRV)    ;LDではフラグは変化しない
0017AF E4DF 32F3E4          13      LD  (NCLPAT_FATDRV),A   ;_FATDRV
0017B2 E4E2 2005            12      JR  NZ,NCL2     ;FATIXが違う
0017B4 E4E4 BD               4      CP  L
0017B5 E4E5 2002            12      JR  NZ,NCL2     ;ドライブが違う
0017B7 E4E7 E1              10      POP HL
0017B8 E4E8 C9              10      RET
       E4E9                     NCL2:
0017B9 E4E9 C5              11      PUSH    BC
0017BA E4EA D5              11      PUSH    DE
0017BB E4EB DDE5            15      PUSH    IX
0017BD E4ED CDACE4          17      CALL    WTFATX
0017C0 E4F0 38B6            12      JR  C,POP_IX_DE_BC_HL_RET
0017C2 E4F2 010000          10      LD  BC,0        ;自己書き換え C=_FATDRV B=_FATIX
       E4F4                     NCLPAT_FATIX    EQU $-1
       E4F3                     NCLPAT_FATDRV   EQU $-2
0017C5 E4F5 ED43AAF0        20      LD  (_FATDRV),BC
0017C9 E4F9 CD13E7          17      CALL    RDFATS
0017CC E4FC 18A4            12      JR  RDFATE2
                                
       E4FE                     NCL3:
0017CE E4FE CB9A             8      RES 3,D
0017D0 E500 CB92             8      RES 2,D
0017D2 E502 6B               4      LD  L,E
0017D3 E503 62               4      LD  H,D
0017D4 E504 CB3C             8      SRL H   ;
0017D6 E506 CB1D             8      RR  L   ;HLA=HLA/2
0017D8 E508 1F               4      RRA     ;
0017D9 E509 F5              11      PUSH    AF
0017DA E50A 3AABF0          13      LD  A,(_FATIX)
0017DD E50D 0F               4      RRCA
0017DE E50E 300B            12      JR  NC,NCL3X1
0017E0 E510 3A38E3          13      LD  A,(SECSZ+2)
0017E3 E513 FE04             7      CP  4       ;1セクタ1024バイトの場合は奇数インデックスの場合に先頭を512バイトずらす
0017E5 E515 2004            12      JR  NZ,NCL3X1
0017E7 E517 010002          10      LD  BC,512
0017EA E51A 09              11      ADD HL,BC
       E51B                     NCL3X1:
0017EB E51B F1              10      POP AF
0017EC E51C ED4B7CF1        20      LD  BC,(_FATBF)
0017F0 E520 19              11      ADD HL,DE
0017F1 E521 09              11      ADD HL,BC
0017F2 E522 17               4      RLA
0017F3 E523 C9              10      RET
                                
       E524                     GNCL:
0017F4 E524 CDCBE4          17      CALL    NCL1        ;GET NEXT CLUSTER
0017F7 E527 D8              11      RET C
0017F8 E528 C5              11      PUSH    BC
0017F9 E529 E5              11      PUSH    HL
0017FA E52A CDFEE4          17      CALL    NCL3
0017FD E52D 3809            12      JR  C,GNC1
0017FF E52F 5E               7      LD  E,(HL)
001800 E530 23               6      INC HL
001801 E531 7E               7      LD  A,(HL)
001802 E532 E60F             7      AND 00FH
001804 E534 57               4      LD  D,A
001805 E535 E1              10      POP HL
001806 E536 C1              10      POP BC
001807 E537 C9              10      RET
       E538                     GNC1:
001808 E538 7E               7      LD  A,(HL)
001809 E539 23               6      INC HL
00180A E53A 56               7      LD  D,(HL)
00180B E53B 0604             7      LD  B,4
       E53D                     GNC1L:
00180D E53D CB3A             8      SRL D   ;DA=DA/2
00180F E53F 1F               4      RRA     ;
001810 E540 10FB            13      DJNZ    GNC1L
                                
001812 E542 5F               4      LD  E,A
001813 E543 E1              10      POP HL
001814 E544 C1              10      POP BC
001815 E545 A7               4      AND A
001816 E546 C9              10      RET
                                
       E547                     SNCL:
001817 E547 CDCBE4          17      CALL    NCL1
00181A E54A D8              11      RET C
                                ;               SET NEXT CLUSTER
00181B E54B E5              11      PUSH    HL
00181C E54C C5              11      PUSH    BC
00181D E54D D5              11      PUSH    DE
00181E E54E E5              11      PUSH    HL
00181F E54F CDFEE4          17      CALL    NCL3
001822 E552 D1              10      POP DE
                                ;CF=ODD
001823 E553 7E               7      LD  A,(HL)
001824 E554 73               7      LD  (HL),E
001825 E555 3806            12      JR  C,SNC1
                                ;EVEN
                                ;M[0] = E
                                ;M[1] = (M[1] & 0xF0) | (D & 0x0F)
001827 E557 23               6      INC HL
001828 E558 ED67            18      RRD     ;M={A[3:0],E[3:0]}
00182A E55A 7A               4      LD  A,D
00182B E55B 1804            12      JR  SNC11
       E55D                     SNC1:
                                ;ODD
                                ;HL[0] = (HL[0]&0x0F) | (E<<4)
                                ;HL[1] = DE>>4
00182D E55D ED6F            18      RLD     ;M={D[3:0],E[7:4]}
00182F E55F 23               6      INC HL
001830 E560 72               7      LD  (HL),D  ;M={D[3:0],E[7:4]}
       E561                     SNC11:
001831 E561 ED6F            18      RLD     ;M={M[7:4],D[3:0]}
001833 E563 B7               4      OR  A
001834 E564 D1              10      POP DE
001835 E565 C1              10      POP BC
001836 E566 E1              10      POP HL
       E567                     FAT_CHANGED:
001837 E567 3E01             7      LD  A,1
001839 E569 32A2F0          13      LD  (_WTFATF),A
00183C E56C C9              10      RET
                                
       E56D                     N16CL3:
00183D E56D C5              11      PUSH    BC
00183E E56E 6B               4      LD  L,E
00183F E56F 7A               4      LD  A,D
001840 E570 E603             7      AND 3
001842 E572 67               4      LD  H,A
001843 E573 29              11      ADD HL,HL
001844 E574 ED4B7CF1        20      LD  BC,(_FATBF)
001848 E578 09              11      ADD HL,BC
001849 E579 C1              10      POP BC
00184A E57A C9              10      RET
                                
       E57B                     GNCL16:
00184B E57B CDCBE4          17      CALL    NCL1        ;GET NEXT CLUSTER for FAT16
00184E E57E D8              11      RET C
00184F E57F E5              11      PUSH    HL
001850 E580 CD6DE5          17      CALL    N16CL3
001853 E583 5E               7      LD  E,(HL)
001854 E584 23               6      INC HL
001855 E585 56               7      LD  D,(HL)
001856 E586 E1              10      POP HL
001857 E587 C9              10      RET
                                
       E588                     SNCL16:
001858 E588 CDCBE4          17      CALL    NCL1        ;GET NEXT CLUSTER for FAT16
00185B E58B D8              11      RET C
00185C E58C D5              11      PUSH    DE
00185D E58D E5              11      PUSH    HL
00185E E58E CD6DE5          17      CALL    N16CL3
001861 E591 D1              10      POP DE      ;HL
001862 E592 73               7      LD  (HL),E
001863 E593 23               6      INC HL
001864 E594 72               7      LD  (HL),D
001865 E595 6B               4      LD  L,E
001866 E596 62               4      LD  H,D
001867 E597 D1              10      POP DE
001868 E598 18CD            12      JR  FAT_CHANGED
                                
                                ;------------------------
                                ;次のセクタを探す際に_SECPSの値をチェック
                                ;in
                                ;   DE : セクタ番号
                                ;out
                                ;   DE : 次のセクタ番号
                                ;note
                                ;
                                ;------------------------
       E59A                     NEXTX:
00186A E59A 3E00             7      LD  A,0 ;自己書き換え
       E59B                     _SECPS  EQU $-1
00186C E59C 3C               4      INC A
00186D E59D E600             7      AND 0   ;自己書き換え　1クラスタの論理セクタ数-1
       E59E                     _NCPAT  EQU $-1
00186F E59F 329BE5          13      LD  (_SECPS),A
001872 E5A2 C9              10      RET
                                
       E5A3                     GNCLX:
001873 E5A3 CD9AE5          17      CALL    NEXTX
001876 E5A6 C0              11      RET NZ  ;1クラスタのセクタ未満の場合は戻る
001877 E5A7 C3F7F0          10      JP  _GNCL   ;次のクラスタを探す
                                
       E5AA                     RDFAT:
00187A E5AA 3E80             7      LD  A,080H
00187C E5AC 3270F0          13      LD  (CHECK),A
       E5AF                     RDFAT1:
00187F E5AF 3A88F0          13      LD  A,(_DRV)
001882 E5B2 CD4DE8          17      CALL    CHGDRVR
001885 E5B5 D8              11      RET C
001886 E5B6 DD7E12          19      LD  A,(IX+DPB_DEVICE)
001889 E5B9 CB6F             8      BIT 5,A
00188B E5BB 2868            12      JR  Z,RDFAT0X
00188D E5BD 2170F0          10      LD  HL,CHECK
001890 E5C0 A6               7      AND (HL)
001891 E5C1 77               7      LD  (HL),A
001892 E5C2 110000          10      LD  DE,0        ;BPB
001895 E5C5 2A7CF1          16      LD  HL,(_FATBF)
001898 E5C8 CD1FE7          17      CALL    DRD16
00189B E5CB 3024            12      JR  NC,GETBPB
00189D E5CD 2170F0          10      LD  HL,CHECK
0018A0 E5D0 CB06            15      RLC (HL)
0018A2 E5D2 3F               4      CCF
0018A3 E5D3 D8              11      RET C
0018A4 E5D4 DDCB0A1E        23      RR  (IX+DPB_FDMODE)
0018A8 E5D8 3F               4      CCF         ;フロッピーディスクのFDモードを切り替える
0018A9 E5D9 DDCB0A16        23      RL  (IX+DPB_FDMODE)
0018AD E5DD 3EFF             7      LD  A,0FFH
0018AF E5DF 3289F0          13      LD  (_DSK),A
0018B2 E5E2 3A84F0          13      LD  A,(_DRIVE)
0018B5 E5E5 E603             7      AND 3
0018B7 E5E7 F680             7      OR  080H
0018B9 E5E9 6F               4      LD  L,A
0018BA E5EA 26F0             7      LD  H,_CYL0/256
0018BC E5EC 3EFF             7      LD  A,0FFH
0018BE E5EE 77               7      LD  (HL),A
0018BF E5EF 18BE            12      JR  RDFAT1
       E5F1                     GETBPB:
0018C1 E5F1 FDE5            15      PUSH    IY
0018C3 E5F3 FD2A7CF1        20      LD  IY,(_FATBF) ;BPB
0018C7 E5F7 CDF1F0          17      CALL    _BPB2DPB
0018CA E5FA FDE1            14      POP IY
0018CC E5FC DD7E12          19      LD  A,(IX+DPB_DEVICE)
0018CF E5FF 3021            12      JR  NC,GETBPBOK
0018D1 E601 E60F             7      AND 00FH
0018D3 E603 FE07             7      CP  7
0018D5 E605 37               4      SCF
0018D6 E606 C0              11      RET NZ
0018D7 E607 DDCB0A46        20      BIT 0,(IX+DPB_FDMODE)
0018DB E60B 21C0F1          10      LD  HL,M2D
0018DE E60E 2002            12      JR  NZ,SETFDMODE
0018E0 E610 2ED2             7      LD  L,M2HD-STABLE
       E612                     SETFDMODE:
0018E2 E612 DDE5            15      PUSH    IX
0018E4 E614 D1              10      POP DE
0018E5 E615 EDA0            16      LDI
0018E7 E617 EDA0            16      LDI
0018E9 E619 13               6      INC DE
0018EA E61A 13               6      INC DE
0018EB E61B 13               6      INC DE
0018EC E61C 13               6      INC DE
0018ED E61D 010C00          10      LD  BC,12
0018F0 E620 EDB0                    LDIR
       E622                     GETBPBOK:
0018F2 E622 CDB9E7          17      CALL    CHGDRV2
       E625                     RDFAT0X:
0018F5 E625 CD13E7          17      CALL    RDFATS
0018F8 E628 D8              11      RET C
0018F9 E629 DDAE06          19      XOR (IX+DPB_FATID)
0018FC E62C C8              11      RET Z
0018FD E62D DDCB126E        20      BIT 5,(IX+DPB_DEVICE)
001901 E631 C0              11      RET NZ      ;BPBを取得している場合はFATIDをチェックしない
001902 E632 37               4      SCF
001903 E633 C9              10      RET
                                
       E634                     POP_HL_SCF_RET:
001904 E634 E1              10      POP HL
001905 E635 37               4      SCF
001906 E636 C9              10      RET
                                
       E637                     BPB2DPB:
001907 E637 FD7E0B          19      LD  A,(IY+11)   ;BPB_BytsPerSec
00190A E63A B7               4      OR  A
00190B E63B 37               4      SCF
00190C E63C C0              11      RET NZ
       E63D                     BPBOK:
00190D E63D FD7E0D          19      LD  A,(IY+13)   ;BPB_SecPerClus
001910 E640 DD7707          19      LD  (IX+DPB_SECPCL),A
                                
001913 E643 FD7E16          19      LD  A,(IY+22)   ;BPB_FATSz16
001916 E646 DD7700          19      LD  (IX+DPB_FATLN),A
001919 E649 FD7E17          19      LD  A,(IY+23)   ;BPB_FATSz16
00191C E64C DD7701          19      LD  (IX+DPB_FATLN+1),A
                                
00191F E64F FD6E0E          19      LD  L,(IY+14)   ;BPB_RsvdSecCnt
001922 E652 FD660F          19      LD  H,(IY+15)
001925 E655 DD750E          19      LD  (IX+DPB_FATPS),L
001928 E658 FD5E16          19      LD  E,(IY+22)   ;BPB_FATSz16
00192B E65B FD5617          19      LD  D,(IY+23)
00192E E65E FD4610          19      LD  B,(IY+16)   ;BPB_NumFATs
       E661                     BPBDP1:             ;BPB_FATSz16 * BPB_NumFATs
001931 E661 19              11      ADD HL,DE
001932 E662 10FD            13      DJNZ    BPBDP1
       E664                     BPBDP2:
001934 E664 DD7510          19      LD  (IX+DPB_DIRPS),L
001937 E667 DD7411          19      LD  (IX+DPB_DIRPS+1),H
00193A E66A E5              11      PUSH    HL
                                
00193B E66B FD6E11          19      LD  L,(IY+17)   ;BPB_RootEntCnt
00193E E66E FD6612          19      LD  H,(IY+18)
001941 E671 FD7E0C          19      LD  A,(IY+12)   ;BPB_BytsPerSec
001944 E674 B7               4      OR  A
001945 E675 28BD            12      JR  Z,POP_HL_SCF_RET
001947 E677 0606             7      LD  B,6
       E679                     BPBBPS1:
001949 E679 05               4      DEC B
00194A E67A 0F               4      RRCA
00194B E67B 30FC            12      JR  NC,BPBBPS1
       E67D                     BPBDE1:
00194D E67D 29              11      ADD HL,HL
00194E E67E 10FD            13      DJNZ    BPBDE1
                                
001950 E680 7C               4      LD  A,H
001951 E681 DD770B          19      LD  (IX+DPB_DIRSCNT),A  ;
                                
001954 E684 D1              10      POP DE      ;DPB_DIRPS
001955 E685 6C               4      LD  L,H
001956 E686 2600             7      LD  H,0
001958 E688 19              11      ADD HL,DE       ;MAXDIR
001959 E689 E5              11      PUSH    HL
00195A E68A FD4E0D          19      LD  C,(IY+13)   ;BPB_SecPerClus
00195D E68D CB21             8      SLA C       ;*2
00195F E68F AF               4      XOR A
001960 E690 47               4      LD  B,A
001961 E691 ED42            15      SBC HL,BC
001963 E693 DD7514          19      LD  (IX+DPB_ADDCL),L
001966 E696 DD7415          19      LD  (IX+DPB_ADDCL+1),H
                                
001969 E699 D1              10      POP DE      ;DE=DPB_MAXDIR
00196A E69A FD6E13          19      LD  L,(IY+19)   ;BPB_TotSec16
00196D E69D FD6614          19      LD  H,(IY+20)
                                
001970 E6A0 DD7E12          19      LD  A,(IX+DPB_DEVICE)
001973 E6A3 E60F             7      AND 00FH
001975 E6A5 FE07             7      CP  7       ;フロッピー
001977 E6A7 2019            12      JR  NZ,NOT_FD
001979 E6A9 E5              11      PUSH    HL
00197A E6AA FD4E18          19      LD  C,(IY+24)   ;BPB_SecPerTr
00197D E6AD DD710D          19      LD  (IX+DPB_MAXSEC),C
001980 E6B0 AF               4      XOR A
001981 E6B1 CB21             8      SLA C       ;両面なのでセクタ数を２倍
001983 E6B3 0610             7      LD  B,16
       E6B5                     DIVSEC:             ;MAXCYL = BPB_TotSec16 / (BPB_SecPerTr * 2)
001985 E6B5 29              11      ADD HL,HL
001986 E6B6 17               4      RLA
001987 E6B7 B9               4      CP  C
001988 E6B8 3802            12      JR  C,DIVSEC1
00198A E6BA 91               4      SUB C
00198B E6BB 2C               4      INC L
       E6BC                     DIVSEC1:
00198C E6BC 10F7            13      DJNZ    DIVSEC
00198E E6BE DD750C          19      LD  (IX+DPB_MAXCYL),L
001991 E6C1 E1              10      POP HL  ;ここまでフロッピー専用
       E6C2                     NOT_FD:
001992 E6C2 7C               4      LD  A,H
001993 E6C3 B5               4      OR  L
001994 E6C4 3E00             7      LD  A,0     ;LDでフラグは変化しない。BPB_TotSec16を AHL で扱う為、Aに0を入れる
001996 E6C6 200E            12      JR  NZ,BPB16BIT ;BPB_TotSec16が「0」の場合はBPB_TotSec32で計算
001998 E6C8 2F               4      CPL         ;A=0FFH
001999 E6C9 FD8623          19      ADD A,(IY+35)   ;念のために総セクタ数が24ビットを超える場合はエラーを返す
00199C E6CC D8              11      RET C
00199D E6CD FD6E20          19      LD  L,(IY+32)   ;BPB_TotSec32 は AHL の24ビットで扱う
0019A0 E6D0 FD6621          19      LD  H,(IY+33)   ;1クラスタの論理セクタ数(DPB_SECPCL)が最大128なので、
0019A3 E6D3 FD7E22          19      LD  A,(IY+34)   ;FAT12,FAT16では総セクタ数が24ビットを超えることは無い
       E6D6                     BPB16BIT:
0019A6 E6D6 ED52            15      SBC HL,DE       ;DE=DPB_MAXDIR
0019A8 E6D8 DE00             7      SBC A,0
0019AA E6DA FD460D          19      LD  B,(IY+13)   ;BPB_SecPerClus
       E6DD                     BPBTC1:             ;総クラスタ数(AHL) = 総セクタ数(AHL) / セクタサイズ(B)
0019AD E6DD CB18             8      RR  B       ;->CY
0019AF E6DF 3808            12      JR  C,BPBTC2
0019B1 E6E1 CB3F             8      SRL A
0019B3 E6E3 CB1C             8      RR  H       ;AHL=AHL/2
0019B5 E6E5 CB1D             8      RR  L
0019B7 E6E7 18F4            12      JR  BPBTC1
       E6E9                     BPBTC2:
0019B9 E6E9 C6FF             7      ADD A,0FFH
0019BB E6EB D8              11      RET C       ;念のため(クラスタ数が16ビットを超える場合)
0019BC E6EC 23               6      INC HL
0019BD E6ED 23               6      INC HL
0019BE E6EE DD7508          19      LD  (IX+DPB_MAXCL),L
0019C1 E6F1 DD7409          19      LD  (IX+DPB_MAXCL+1),H
                                
0019C4 E6F4 FD7E15          19      LD  A,(IY+21)   ;BPB_Media
0019C7 E6F7 DD7706          19      LD  (IX+DPB_FATID),A
                                
0019CA E6FA FD7E10          19      LD  A,(IY+16)   ;BPB_NumFATs
0019CD E6FD C6FE             7      ADD A,0-2       ;>2:CF=1
0019CF E6FF FD7E0C          19      LD  A,(IY+12)   ;BPB_BytsPerSec
0019D2 E702 6F               4      LD  L,A
0019D3 E703 3002            12      JR  NC,BPBFAT1
0019D5 E705 F680             7      OR  080H
       E707                     BPBFAT1:            ;ここではCF=0
0019D7 E707 DD770F          19      LD  (IX+DPB_BPS),A
0019DA E70A 2D               4      DEC L       ;以下のセクタサイズに合致しない場合はCF=1でエラーにする
0019DB E70B C8              11      RET Z       ;1セクタ256バイト
0019DC E70C 2D               4      DEC L
0019DD E70D C8              11      RET Z       ;1セクタ512バイト
0019DE E70E 2D               4      DEC L
0019DF E70F 2D               4      DEC L
0019E0 E710 C8              11      RET Z       ;1セクタ1024バイト
0019E1 E711 37               4      SCF
0019E2 E712 C9              10      RET
                                
       E713                     RDFATS:
0019E3 E713 CD44E7          17      CALL    FATSETUP
0019E6 E716 D8              11      RET C
0019E7 E717 CD23E7          17      CALL    DRD24B
0019EA E71A 2A7CF1          16      LD  HL,(_FATBF)
0019ED E71D 7E               7      LD  A,(HL)
0019EE E71E C9              10      RET
                                
       E71F                     DRD16:
0019EF E71F 0E00             7      LD  C,0
       E721                     DRD24:
0019F1 E721 0601             7      LD  B,1
       E723                     DRD24B:
0019F3 E723 DDE5            15      PUSH    IX
0019F5 E725 DD2AA8F0        20      LD  IX,(_DPB)
0019F9 E729 CD9BE9          17      CALL    FDRD        ;自己書き換え（ディスク読み込み）
       E72A                     DRDPAT  EQU $-2
       E72C                     POP_IX_RET:
0019FC E72C DDE1            14      POP IX
0019FE E72E C9              10      RET
                                
       E72F                     DWT16:
0019FF E72F 0E00             7      LD  C,0
       E731                     DWT24:
001A01 E731 0601             7      LD  B,1
       E733                     DWT24B:
001A03 E733 DDE5            15      PUSH    IX
001A05 E735 DD2AA8F0        20      LD  IX,(_DPB)
001A09 E739 CD41E9          17      CALL    FDWT        ;自己書き換え（ディスク書き込み）
       E73A                     DWTPAT  EQU $-2
001A0C E73C 18EE            12      JR  POP_IX_RET
                                
       E73E                     WTFAT:
001A0E E73E CD44E7          17      CALL    FATSETUP
001A11 E741 30F0            12      JR  NC,DWT24B
001A13 E743 C9              10      RET
                                ;   CALL    NC,DWT24B   ;予備FATの保存ルーチン
                                ;   RET C
                                ;   BIT 7,(IX+DPB_BPS)
                                ;   RET Z       ;予備FATが無い
                                ;   CALL    FATS2
                                ;   PUSH    HL      ;予備FAT
                                ;   LD  L,(IX+DPB_FATLN)
                                ;   LD  H,(IX+DPB_FATLN+1)
                                ;   ADD HL,DE
                                ;   EX  DE,HL
                                ;   POP HL
                                ;   JR  DWT24B
                                ;------------------------
                                ;FATのセットアップ
                                ;out
                                ;   B  : FATセクタ数
                                ;   DE : FAT先頭セクタ番号
                                ;   HL : FATバッファポインタ
                                ;   CF : 1=ドライブ切り替えエラー
                                ;note
                                ;   FATサイズがFATバッファを超える場合は
                                ;   対象クラスタ領域==(_FATIX)によって
                                ;   FAT12:対象クラスタ1024毎に1.5KBを切り替える
                                ;   FAT16:対象クラスタ1024毎に2KBを切り替える
                                ;------------------------
       E744                     FATSETUP:
001A14 E744 3AAAF0          13      LD  A,(_FATDRV)
001A17 E747 CD4DE8          17      CALL    CHGDRVR     ;ドライブ切り替え
001A1A E74A D8              11      RET C
       E74B                     FATS2:
001A1B E74B DD7E0F          19      LD  A,(IX+DPB_BPS)  ;512=2 1024=4
001A1E E74E 0F               4      RRCA
001A1F E74F CD7FE7          17      CALL    FATSETUP12  ;自己書き換え
       E750                     FATSX   EQU $-2
001A22 E752 210000          10      LD  HL,0
001A25 E755 4A               4      LD  C,D
001A26 E756 54               4      LD  D,H
001A27 E757 3AABF0          13      LD  A,(_FATIX)  ;範囲FAT12:0-3/FAT16:0-63(0-03FH):65535*2/2048
001A2A E75A 47               4      LD  B,A
001A2B E75B 04               4      INC B
001A2C E75C DD7E00          19      LD  A,(IX+DPB_FATLN)
       E75F                     FAT_SKP:
001A2F E75F 05               4      DEC B
001A30 E760 2809            12      JR  Z,FAT1
001A32 E762 19              11      ADD HL,DE
001A33 E763 93               4      SUB E
001A34 E764 30F9            12      JR  NC,FAT_SKP
001A36 E766 DDCB0146        20      BIT 0,(IX+DPB_FATLN+1)  ;FATサイズが0100H(256)の場合
001A3A E76A C8              11      RET Z
       E76B                     FAT1:
001A3B E76B EB               4      EX  DE,HL
001A3C E76C B7               4      OR  A       ;0の場合は0100Hとして扱う
001A3D E76D 2803            12      JR  Z,FAT3
001A3F E76F B9               4      CP  C       ;C=FATバッファに読み込めるセクタ数
001A40 E770 3801            12      JR  C,FAT2
       E772                     FAT3:
001A42 E772 79               4      LD  A,C
       E773                     FAT2:
001A43 E773 47               4      LD  B,A
                                
001A44 E774 2AFAF1          16      LD  HL,(_FATPS) ;fat sector pos
001A47 E777 19              11      ADD HL,DE
001A48 E778 EB               4      EX  DE,HL
001A49 E779 2A7CF1          16      LD  HL,(_FATBF)
001A4C E77C AF               4      XOR A       ;CF=0
001A4D E77D 4F               4      LD  C,A
001A4E E77E C9              10      RET
                                ;
                                ;   FATバッファに読み込める最大のセクタ数と_FATIXで進めるセクタ数
                                ;   FATSETUP* (FAT12/FAT16)
                                ;out
                                ;   D : FATバッファに読み込める最大のセクタ数
                                ;   E : _FATIXで進めるセクタ数
       E77F                     FATSETUP12:
001A4F E77F 110606          10      LD  DE,0606H    ;256
001A52 E782 D8              11      RET C
001A53 E783 110303          10      LD  DE,0303H    ;512
001A56 E786 0F               4      RRCA
001A57 E787 D8              11      RET C
001A58 E788 110102          10      LD  DE,0201H    ;1024
001A5B E78B C9              10      RET
                                
       E78C                     FATSETUP16:
001A5C E78C 110808          10      LD  DE,0808H    ;256
001A5F E78F D8              11      RET C
001A60 E790 110404          10      LD  DE,0404H
001A63 E793 0F               4      RRCA            ;512
001A64 E794 D8              11      RET C
001A65 E795 110202          10      LD  DE,0202H    ;1024
001A68 E798 C9              10      RET
                                
       E799                     CHGDRV:
001A69 E799 E5              11      PUSH    HL
001A6A E79A 2189F0          10      LD  HL,_DSK
001A6D E79D BE               7      CP  (HL)
001A6E E79E 280A            12      JR  Z,CHGDRVE
       E7A0                     CHGDRV1:
001A70 E7A0 DDE5            15      PUSH    IX
001A72 E7A2 CDACE7          17      CALL    CHGDRV0
001A75 E7A5 3A89F0          13      LD  A,(_DSK)
001A78 E7A8 DDE1            14      POP IX
       E7AA                     CHGDRVE:
001A7A E7AA E1              10      POP HL
001A7B E7AB C9              10      RET
                                
       E7AC                     CHGDRV0:
001A7C E7AC 6F               4      LD  L,A
001A7D E7AD CDDCF0          17      CALL    _GETDPB
001A80 E7B0 D8              11      RET C
001A81 E7B1 DD22A8F0        20      LD  (_DPB),IX
001A85 E7B5 7D               4      LD  A,L
001A86 E7B6 3289F0          13      LD  (_DSK),A
       E7B9                     CHGDRV2:
001A89 E7B9 C5              11      PUSH    BC
001A8A E7BA D5              11      PUSH    DE
001A8B E7BB ED7304E8        20      LD  (SPPAT2),SP
001A8F E7BF F3               4      DI
001A90 E7C0 DDF9            10      LD  SP,IX
                                
001A92 E7C2 E1              10      POP HL      ;00:DPB_FATLN
001A93 E7C3 E1              10      POP HL      ;02:DPB_DRD
001A94 E7C4 222AE7          16      LD  (DRDPAT),HL
                                
001A97 E7C7 E1              10      POP HL
001A98 E7C8 223AE7          16      LD  (DWTPAT),HL ;04:DPB_DWT
                                
001A9B E7CB E1              10      POP HL      ;L=06:DPB_FATID H=07:DPB_SECPCL
001A9C E7CC 7C               4      LD  A,H
001A9D E7CD 3233DE          13      LD  (SPCPAT),A  ;1クラスタの論理セクタ数
001AA0 E7D0 3D               4      DEC A
001AA1 E7D1 329EE5          13      LD  (_NCPAT),A
                                
001AA4 E7D4 E1              10      POP HL      ;08:DPB_MAXCL
001AA5 E7D5 7D               4      LD  A,L
001AA6 E7D6 3252DE          13      LD  (CLPAT2),A
001AA9 E7D9 7C               4      LD  A,H
001AAA E7DA 324EDE          13      LD  (CLPAT1),A
001AAD E7DD 2B               6      DEC HL
001AAE E7DE 224FE0          16      LD  (MAXCLP),HL
                                
001AB1 E7E1 E1              10      POP HL      ;L=0A:DPB_FDMODE H=0B:DPB_DIRSCNT
001AB2 E7E2 4C               4      LD  C,H
                                
001AB3 E7E3 E1              10      POP HL      ;L=0C:DPB_MAXCYL H=0D:DPB_MAXSEC
                                
001AB4 E7E4 E1              10      POP HL      ;L=0E:DPB_FATPS H=0F:DPB_BPS
001AB5 E7E5 7C               4      LD  A,H     ;DPB_BPS
001AB6 E7E6 E607             7      AND 7
001AB8 E7E8 3238E3          13      LD  (SECSZ+2),A ;1セクタのサイズの上位1バイト 0x400 - 0x200 - 0x100
                                                ;1セクタ512 2D/2DD/2HC/2HQ(2HD1.44MB)/EMM/BRAM/EMEM等
                                                ;1セクタ1024 2HD/2HDE98
                                                ;1セクタ256 GRAM/RAMF/CMOS/等
                                                ;1024   512 256
                                                ;4  2   1
001ABB E7EB 87               4      ADD A,A     ;8  4   2
001ABC E7EC 87               4      ADD A,A     ;010H   8   4
001ABD E7ED 87               4      ADD A,A     ;020H   010H    8
001ABE E7EE 32B0DC          13      LD  (SDECPAT),A ;1セクタ辺りのディレクトリエントリ数
                                
001AC1 E7F1 2600             7      LD  H,0
001AC3 E7F3 22FAF1          16      LD  (_FATPS),HL
                                
001AC6 E7F6 E1              10      POP HL      ;10:DPB_DIRPS
001AC7 E7F7 22FCF1          16      LD  (_DIRPS),HL
                                
001ACA E7FA E1              10      POP HL      ;L=12:DPB_DEVICE H=13:DPB_UNITNO
001ACB E7FB 7C               4      LD  A,H
001ACC E7FC 3284F0          13      LD  (_DRIVE),A
                                
001ACF E7FF E1              10      POP HL      ;14:DPB_ADDCL
001AD0 E800 2243DE          16      LD  (CLSPAT),HL
                                
001AD3 E803 310000          10      LD  SP,0        ;元のSPを復元
       E804                     SPPAT2  EQU $-2
001AD6 E806 FB               4      EI
001AD7 E807 2AFCF1          16      LD  HL,(_DIRPS)
001ADA E80A 0600             7      LD  B,0
001ADC E80C 09              11      ADD HL,BC       ;C=DPB_DIRSCNT
001ADD E80D 22CBDC          16      LD  (MD_PAT),HL
                                
001AE0 E810 2A4FE0          16      LD  HL,(MAXCLP)
001AE3 E813 110AF0          10      LD  DE,-4086    ;クラスタ数が4086未満:FAT12 4086以上:FAT16
001AE6 E816 19              11      ADD HL,DE
001AE7 E817 380F            12      JR  C,SETFAT16
001AE9 E819 2124E5          10      LD  HL,GNCL     ;FAT12
001AEC E81C 1147E5          10      LD  DE,SNCL
001AEF E81F 017FE7          10      LD  BC,FATSETUP12
001AF2 E822 DDCB0FAE        23      RES 5,(IX+DPB_BPS)  ;DPB_BPS(FAT12)
001AF6 E826 180D            12      JR  EXTRA1
       E828                     SETFAT16:
001AF8 E828 217BE5          10      LD  HL,GNCL16   ;FAT16
001AFB E82B 1188E5          10      LD  DE,SNCL16
001AFE E82E 018CE7          10      LD  BC,FATSETUP16
001B01 E831 DDCB0FEE        23      SET 5,(IX+DPB_BPS)  ;DPB_BPS(FAT16)
       E835                     EXTRA1:
001B05 E835 22F8F0          16      LD  (GNCPAT),HL
001B08 E838 ED53FBF0        20      LD  (SNCPAT),DE
001B0C E83C ED4350E7        20      LD  (FATSX),BC
001B10 E840 D1              10      POP DE
001B11 E841 C1              10      POP BC
001B12 E842 AF               4      XOR A
001B13 E843 C9              10      RET
                                
       E844                     GETDPBD:
001B14 E844 DDE3            23      EX  (SP),IX
001B16 E846 DDE5            15      PUSH    IX
001B18 E848 3A88F0          13      LD  A,(_DRV)
001B1B E84B 1807            12      JR  GETDPB1
                                
       E84D                     CHGDRVR:
001B1D E84D CDD9F0          17      CALL    _CHGDRV
001B20 E850 D8              11      RET C
001B21 E851 3A89F0          13      LD  A,(_DSK)
       E854                     GETDPB1:
001B24 E854 C3DCF0          10      JP  _GETDPB
                                
       E857                     GETDPB:
001B27 E857 FE08             7      CP  8
001B29 E859 3F               4      CCF
001B2A E85A D8              11      RET C
001B2B E85B 0F               4      RRCA
001B2C E85C 0F               4      RRCA
001B2D E85D 0F               4      RRCA
001B2E E85E DD                      DB  0DDH        ;Z80未定義命令
001B2F E85F 6F               4      LD  L,A     ;LD IXL,A
001B30 E860 DD                      DB  0DDH        ;Z80未定義命令
001B31 E861 26F2             7      LD  H,_DEVICE/256   ;LD IXH,_DEVICE/256
001B33 E863 DD7E00          19      LD  A,(IX+DPB_FATLN)
001B36 E866 A7               4      AND A       ;CF=0の為
001B37 E867 DDCB0F6E        20      BIT 5,(IX+DPB_BPS)
001B3B E86B C0              11      RET NZ      ;FAT16
001B3C E86C DDCB126E        20      BIT 5,(IX+DPB_DEVICE)
001B40 E870 C0              11      RET NZ      ;BPB
001B41 E871 FE01             7      CP  001H        ;A=0 THEN CF=1
001B43 E873 C9              10      RET
                                
       E874                     _SYS5F:
001B44 E874 AF               4      XOR A
       E875                     FFLUSH:
001B45 E875 F5              11      PUSH    AF
001B46 E876 CDACE4          17      CALL    WTFATX
001B49 E879 AF               4      XOR A
001B4A E87A 32ABF0          13      LD  (_FATIX),A
001B4D E87D 2F               4      CPL         ;0FFH
001B4E E87E 32AAF0          13      LD  (_FATDRV),A
001B51 E881 3E                      DB  03EH        ;次のPUSH AFをスキップ
       E882                     FFLUSHBUF:
001B52 E882 F5              11      PUSH    AF
001B53 E883 CD62E4          17      CALL    DWTX
001B56 E886 3EFF             7      LD  A,0FFH
001B58 E888 3239F0          13      LD  (SFILE),A
001B5B E88B 32A5F0          13      LD  (_DBDRV),A
001B5E E88E F1              10      POP AF
001B5F E88F C9              10      RET
                                
[EOF:LDDIO.ASM:SHIFT_JIS]
                                    INCLUDE "M7DISK.ASM"
                                
                                ;   LSX-Dodgers DISK
                                ;   MZ-700/1500
                                
       E890                     SEEK:
001B60 E890 0610             7      LD  B,16
001B62 E892 DD4E0D          19      LD  C,(IX+DPB_MAXSEC)
001B65 E895 AF               4      XOR A
001B66 E896 EB               4      EX  DE,HL
       E897                     DIV1:
001B67 E897 29              11      ADD HL,HL
001B68 E898 8F               4      ADC A,A
001B69 E899 B9               4      CP  C
001B6A E89A 3802            12      JR  C,DIV2
001B6C E89C 91               4      SUB C
001B6D E89D 2C               4      INC L
       E89E                     DIV2:
001B6E E89E 10F7            13      DJNZ    DIV1
                                
001B70 E8A0 3C               4      INC A   ;最小のセクタは１固定
001B71 E8A1 55               4      LD  D,L ;TRACK
001B72 E8A2 5F               4      LD  E,A ;SECTOR
                                
001B73 E8A3 3A84F0          13      LD  A,(_DRIVE)
001B76 E8A6 FE04             7      CP  4
001B78 E8A8 3F               4      CCF
001B79 E8A9 D8              11      RET C
001B7A E8AA F684             7      OR  084H        ;Motor on + ドライブセレクト有効
001B7C E8AC D3DC            11      OUT (0DCH),A
001B7E E8AE CB3A             8      SRL D       ;CYLINDER
001B80 E8B0 9F               4      SBC A,A
001B81 E8B1 D3DD            11      OUT (0DDH),A    ;SIDE
                                
001B83 E8B3 CDEFE8          17      CALL    SETMODE
001B86 E8B6 D8              11      RET C
                                
001B87 E8B7 CD2BE9          17      CALL    DRIVE
001B8A E8BA FEFF             7      CP  0FFH        ;A=0FFH Unknown CYLINDER
001B8C E8BC CC10E9          17      CALL    Z,FDCRES    ;Restore
001B8F E8BF 2F               4      CPL         ;データバスが負論理
001B90 E8C0 D3D9            11      OUT (0D9H),A    ;Currrent CYLINDER
001B92 E8C2 2F               4      CPL         ;データバスが負論理
001B93 E8C3 92               4      SUB D
001B94 E8C4 C8              11      RET Z       ;No seek
                                
001B95 E8C5 3A86F0          13      LD  A,(_ISEEK)
001B98 E8C8 4F               4      LD  C,A
                                
001B99 E8C9 DD7E0C          19      LD  A,(IX+DPB_MAXCYL)
001B9C E8CC 3D               4      DEC A
001B9D E8CD BA               4      CP  D       ;Over CYLINDER
001B9E E8CE D8              11      RET C
                                
001B9F E8CF 7A               4      LD  A,D
001BA0 E8D0 2F               4      CPL         ;データバスが負論理
001BA1 E8D1 D3DB            11      OUT (0DBH),A
001BA3 E8D3 72               7      LD  (HL),D
                                
001BA4 E8D4 0E18             7      LD  C,018H      ;Seek
       E8D6                     FDCCMD2:
001BA6 E8D6 3A85F0          13      LD  A,(_SEEKSP)
001BA9 E8D9 B1               4      OR  C
                                
       E8DA                     FDCCMD:
001BAA E8DA CD22E9          17      CALL    COMSET
       E8DE                     FDCSMC  EQU $+1
001BAD E8DD 3E80             7      LD  A,080H      ;FDC COMMAND(Self-modifying code)
001BAF E8DF E620             7      AND 020H        ;Write data Write track
001BB1 E8E1 3C               4      INC A
                                
       E8E2                     SST:
001BB2 E8E2 0E00             7      LD  C,0
       E8E4                     SST1:
001BB4 E8E4 0D               4      DEC C       ; 4
001BB5 E8E5 20FD            12      JR  NZ,SST1     ;12 * 256 / 4 = About 1ms
001BB7 E8E7 3D               4      DEC A
001BB8 E8E8 20FA            12      JR  NZ,SST1
                                
001BBA E8EA 0E01             7      LD  C,1
001BBC E8EC CDF4E8          17      CALL    READY
       E8EF                     SETMODE:
001BBF E8EF CD25E9          17      CALL    DELAY0      ;Head select time
001BC2 E8F2 0E81             7      LD  C,081H
       E8F4                     READY:
001BC4 E8F4 0680             7      LD  B,128
       E8F6                     READY2:
001BC6 E8F6 DBD8            11      IN  A,(0D8H)
001BC8 E8F8 2F               4      CPL         ;データバスが負論理
001BC9 E8F9 A1               4      AND C       ;NOT READY,BUSY
001BCA E8FA C8              11      RET Z
001BCB E8FB CD1BCF          17      CALL    RD556VSYNC
001BCE E8FE 87               4      ADD A,A
001BCF E8FF 30F5            12      JR  NC,READY2
       E901                     READY3:
001BD1 E901 DBD8            11      IN  A,(0D8H)
001BD3 E903 2F               4      CPL         ;データバスが負論理
001BD4 E904 A1               4      AND C       ;NOT READY,BUSY
001BD5 E905 C8              11      RET Z
001BD6 E906 CD1BCF          17      CALL    RD556VSYNC
001BD9 E909 87               4      ADD A,A
001BDA E90A 38F5            12      JR  C,READY3
001BDC E90C 10E8            13      DJNZ    READY2
001BDE E90E 37               4      SCF
001BDF E90F C9              10      RET
                                
       E910                     FDCRES:
001BE0 E910 3600            10      LD  (HL),0
001BE2 E912 0E08             7      LD  C,8
001BE4 E914 18C0            12      JR  FDCCMD2
                                
       E916                     FDMOFF:
001BE6 E916 F5              11      PUSH    AF
001BE7 E917 AF               4      XOR A       ;Motor off(ドライブセレクト無効)
001BE8 E918 D3DC            11      OUT (0DCH),A
001BEA E91A F1              10      POP AF
001BEB E91B C9              10      RET
                                
       E91C                     SECSET:
001BEC E91C F5              11      PUSH    AF
001BED E91D 7B               4      LD  A,E
001BEE E91E 2F               4      CPL         ;データバスが負論理
001BEF E91F D3DA            11      OUT (0DAH),A
001BF1 E921 F1              10      POP AF
       E922                     COMSET:
001BF2 E922 2F               4      CPL         ;データバスが負論理
001BF3 E923 D3D8            11      OUT (0D8H),A
       E925                     DELAY0:
001BF5 E925 3E1A             7      LD  A,26
       E927                     DELAY:
001BF7 E927 3D               4      DEC A
001BF8 E928 20FD            12      JR  NZ,DELAY
001BFA E92A C9              10      RET
                                
       E92B                     DRIVE:
001BFB E92B 2A84F0          16      LD  HL,(_DRIVE)
001BFE E92E 26F0             7      LD  H,_CYL0/256
001C00 E930 CBFD             8      SET 7,L
001C02 E932 7E               7      LD  A,(HL)
001C03 E933 C9              10      RET
                                
       E934                     RNF:
001C04 E934 CD2BE9          17      CALL    DRIVE
001C07 E937 36FF            10      LD  (HL),0FFH
001C09 E939 C9              10      RET
                                
001C0A E93A 02                  RETRY:  DB  2
                                
                                
                                ;   FLOPPY DISK DRIVER
                                
       E93B                     WTTRK:
001C0B E93B 0601             7      LD  B,1
001C0D E93D 3EF4             7      LD  A,0F4H
001C0F E93F 1802            12      JR  WTTRK1
       E941                     FDWT:
001C11 E941 3EA0             7      LD  A,0A0H
       E943                     WTTRK1:
001C13 E943 32DEE8          13      LD  (FDCSMC),A
       E946                     DWTBL:
001C16 E946 78               4      LD  A,B
001C17 E947 3286E9          13      LD  (WTBSMC),A
001C1A E94A 3E02             7      LD  A,2     ;Retry count
001C1C E94C 323AE9          13      LD  (RETRY),A
                                
       E94F                     DWT0:
001C1F E94F D5              11      PUSH    DE
001C20 E950 E5              11      PUSH    HL
001C21 E951 CD90E8          17      CALL    SEEK        ;Write disk
001C24 E954 E1              10      POP HL
001C25 E955 383A            12      JR  C,ERRDW
001C27 E957 F3               4      DI
001C28 E958 3ADEE8          13      LD  A,(FDCSMC)
001C2B E95B CD1CE9          17      CALL    SECSET
001C2E E95E 0EDB             7      LD  C,0DBH
       E960                     DWT1:
001C30 E960 7E               7      LD  A,(HL)
001C31 E961 2F               4      CPL         ;データバスが負論理
001C32 E962 57               4      LD  D,A
                                
       E963                     DWT2:
001C33 E963 DBD8            11      IN  A,(0D8H)
001C35 E965 2F               4      CPL         ;データバスが負論理
001C36 E966 0F               4      RRCA
001C37 E967 3008            12      JR  NC,DWT4
001C39 E969 0F               4      RRCA
001C3A E96A 30F7            12      JR  NC,DWT2
       E96C                     DWT3:
001C3C E96C ED51            12      OUT (C),D
001C3E E96E 23               6      INC HL
001C3F E96F 18EF            12      JR  DWT1
                                
       E971                     DWT4:
001C41 E971 3D               4      DEC A
001C42 E972 28F8            12      JR  Z,DWT3
001C44 E974 3C               4      INC A
001C45 E975 FB               4      EI
001C46 E976 D1              10      POP DE
001C47 E977 13               6      INC DE
001C48 E978 CD16E9          17      CALL    FDMOFF
001C4B E97B 2808            12      JR  Z,DISKOK_WT
001C4D E97D CDE8E9          17      CALL    DISKC
001C50 E980 20CD            12      JR  NZ,DWT0
001C52 E982 B7               4      OR  A
001C53 E983 2005            12      JR  NZ,ERRW
                                
       E985                     DISKOK_WT:
       E986                     WTBSMC  EQU $+1
001C55 E985 0601             7      LD  B,1
001C57 E987 10BD            13      DJNZ    DWTBL
001C59 E989 C9              10      RET
                                
       E98A                     ERRW:
001C5A E98A 3EFF             7      LD  A,0FFH
       E98C                     ERRZ:
001C5C E98C BF               4      CP  A
001C5D E98D 37               4      SCF
001C5E E98E C316E9          10      JP  FDMOFF
                                
       E991                     ERRDW:
001C61 E991 D1              10      POP DE
001C62 E992 CDF9E9          17      CALL    DELP
001C65 E995 20B8            12      JR  NZ,DWT0
001C67 E997 B7               4      OR  A
001C68 E998 20F0            12      JR  NZ,ERRW
001C6A E99A C9              10      RET
                                
       E99B                     FDRD:
001C6B E99B 3E80             7      LD  A,080H
001C6D E99D 32DEE8          13      LD  (FDCSMC),A
       E9A0                     DRDBL:
001C70 E9A0 78               4      LD  A,B
001C71 E9A1 32DAE9          13      LD  (RDBSMC),A
001C74 E9A4 3E02             7      LD  A,2     ;Retry count
001C76 E9A6 323AE9          13      LD  (RETRY),A
       E9A9                     DRD0:
001C79 E9A9 D5              11      PUSH    DE
001C7A E9AA E5              11      PUSH    HL
001C7B E9AB CD90E8          17      CALL    SEEK        ;Read disk
001C7E E9AE E1              10      POP HL
001C7F E9AF 382D            12      JR  C,ERRDR
001C81 E9B1 F3               4      DI
001C82 E9B2 3ADEE8          13      LD  A,(FDCSMC)
001C85 E9B5 CD1CE9          17      CALL    SECSET
       E9B8                     DRD1:
001C88 E9B8 DBD8            11      IN  A,(0D8H)
001C8A E9BA 2F               4      CPL         ;データバスが負論理
001C8B E9BB 0F               4      RRCA
001C8C E9BC 300A            12      JR  NC,DRD3
001C8E E9BE 0F               4      RRCA
001C8F E9BF 30F7            12      JR  NC,DRD1
001C91 E9C1 DBDB            11      IN  A,(0DBH)
001C93 E9C3 2F               4      CPL         ;データバスが負論理
001C94 E9C4 77               7      LD  (HL),A
001C95 E9C5 23               6      INC HL
001C96 E9C6 18F0            12      JR  DRD1
                                
       E9C8                     DRD3:
001C98 E9C8 B7               4      OR  A
001C99 E9C9 FB               4      EI
001C9A E9CA D1              10      POP DE
001C9B E9CB 13               6      INC DE
001C9C E9CC CD16E9          17      CALL    FDMOFF
001C9F E9CF 2808            12      JR  Z,DISKOK_RD
001CA1 E9D1 CDE8E9          17      CALL    DISKC
001CA4 E9D4 20D3            12      JR  NZ,DRD0
001CA6 E9D6 B7               4      OR  A
001CA7 E9D7 20B1            12      JR  NZ,ERRW
                                
       E9D9                     DISKOK_RD:
       E9DA                     RDBSMC  EQU $+1
001CA9 E9D9 0601             7      LD  B,1
001CAB E9DB 10C3            13      DJNZ    DRDBL
001CAD E9DD C9              10      RET
                                
       E9DE                     ERRDR:
001CAE E9DE D1              10      POP DE
001CAF E9DF CDF9E9          17      CALL    DELP
001CB2 E9E2 20C5            12      JR  NZ,DRD0
001CB4 E9E4 B7               4      OR  A
001CB5 E9E5 20A3            12      JR  NZ,ERRW
001CB7 E9E7 C9              10      RET
       E9E8                     DISKC:
001CB8 E9E8 1B               6      DEC DE
001CB9 E9E9 CB5F             8      BIT 3,A
001CBB E9EB C434E9          17      CALL    NZ,RNF
       E9EE                     DISKD:
001CBE E9EE E5              11      PUSH    HL
001CBF E9EF 213AE9          10      LD  HL,RETRY
001CC2 E9F2 35              11      DEC (HL)
001CC3 E9F3 E1              10      POP HL
001CC4 E9F4 200C            12      JR  NZ,ERR      ;Retry
001CC6 E9F6 B7               4      OR  A
001CC7 E9F7 2809            12      JR  Z,ERR       ;Error
                                
       E9F9                     DELP:
001CC9 E9F9 CD34E9          17      CALL    RNF
001CCC E9FC CD16E9          17      CALL    FDMOFF
001CCF E9FF 3EFF             7      LD  A,0FFH
       EA01                     AERRZ:
001CD1 EA01 BF               4      CP  A
       EA02                     ERR:
001CD2 EA02 3EFF             7      LD  A,0FFH
001CD4 EA04 C9              10      RET
[EOF:M7DISK.ASM:SHIFT_JIS]
                                    INCLUDE "M7DISK2.ASM"
                                
                                ;   LSX-Dodgers DISK2
                                ;   MZ-700/1500
                                
                                ;   EMM DRIVER
                                ;   1セクタ可変(256/512/1024)
                                
       EA05                     EDWT:
001CD5 EA05 F5              11      PUSH    AF
001CD6 EA06 CD24EA          17      CALL    EADR
001CD9 EA09 0600             7      LD  B,0
       EA0B                     EDWT1:
001CDB EA0B EDB3                    OTIR
001CDD EA0D 3D               4      DEC A
001CDE EA0E 20FB            12      JR  NZ,EDWT1
001CE0 EA10 180B            12      JR  EDRW1
                                
       EA12                     EDRD:
001CE2 EA12 C5              11      PUSH    BC
001CE3 EA13 CD24EA          17      CALL    EADR
001CE6 EA16 0600             7      LD  B,0
       EA18                     EDRD1:
001CE8 EA18 EDB2                    INIR
001CEA EA1A 3D               4      DEC A
001CEB EA1B 20FB            12      JR  NZ,EDRD1
       EA1D                     EDRW1:
001CED EA1D F1              10      POP AF
001CEE EA1E 83               4      ADD A,E ;セクタを進める
001CEF EA1F 5F               4      LD  E,A
001CF0 EA20 8A               4      ADC A,D
001CF1 EA21 93               4      SUB E
001CF2 EA22 57               4      LD  D,A
001CF3 EA23 C9              10      RET
                                
       EA24                     EADR:
001CF4 EA24 D5              11      PUSH    DE
001CF5 EA25 EB               4      EX  DE,HL
001CF6 EA26 78               4      LD  A,B
001CF7 EA27 DD460F          19      LD  B,(IX+DPB_BPS)
       EA2A                     EADR1:              ;読み込むセクタ数と1クラスタのセクタ数を掛ける
001CFA EA2A CB18             8      RR  B
001CFC EA2C 3804            12      JR  C,EADR2
001CFE EA2E 87               4      ADD A,A
001CFF EA2F 29              11      ADD HL,HL
001D00 EA30 18F8            12      JR  EADR1
       EA32                     EADR2:
001D02 EA32 DD4E0D          19      LD  C,(IX+DPB_MAXSEC)
001D05 EA35 DD460C          19      LD  B,(IX+DPB_MAXCYL)
001D08 EA38 09              11      ADD HL,BC
001D09 EA39 DD4E13          19      LD  C,(IX+DPB_UNITNO)
001D0C EA3C ED71                    DB  0EDH,071H   ;OUT (C),0  Z80未定義命令
001D0E EA3E 0C               4      INC C
001D0F EA3F ED69            12      OUT (C),L
001D11 EA41 0C               4      INC C
001D12 EA42 ED61            12      OUT (C),H
001D14 EA44 0C               4      INC C
001D15 EA45 EB               4      EX  DE,HL
001D16 EA46 D1              10      POP DE
001D17 EA47 C9              10      RET
                                
                                ;   CMOS BACKUP MEMORY DRIVER(32KB)
                                ;   1セクタ256
                                
       EA48                     CDWT:
001D18 EA48 78               4      LD  A,B
001D19 EA49 DD4E13          19      LD  C,(IX+DPB_UNITNO)
001D1C EA4C ED40            12      IN  B,(C)       ;アドレスカウンタを0000にリセット
001D1E EA4E ED59            12      OUT (C),E       ;W)アドレスカウンタ上位
001D20 EA50 01FA00          10      LD  BC,000FAH
       EA53                     CDWT1:
001D23 EA53 EDB3                    OTIR            ;W)データ書き込み・アドレスカウンタ+1
001D25 EA55 13               6      INC DE
001D26 EA56 3D               4      DEC A
001D27 EA57 20FA            12      JR  NZ,CDWT1
001D29 EA59 A7               4      AND A
001D2A EA5A C9              10      RET
                                
       EA5B                     CDRD:
001D2B EA5B 78               4      LD  A,B
001D2C EA5C DD4E13          19      LD  C,(IX+DPB_UNITNO)
001D2F EA5F ED40            12      IN  B,(C)       ;アドレスカウンタを0000にリセット
001D31 EA61 ED59            12      OUT (C),E       ;W)アドレスカウンタ上位
001D33 EA63 01F900          10      LD  BC,000F9H
       EA66                     CDRD1:
001D36 EA66 EDB2                    INIR            ;R)データ読み出し・アドレスカウンタ+1
001D38 EA68 13               6      INC DE
001D39 EA69 3D               4      DEC A
001D3A EA6A 20FA            12      JR  NZ,CDRD1
001D3C EA6C A7               4      AND A
001D3D EA6D C9              10      RET
                                
                                ;   RAM DISK DRIVER (64KB)
                                ;   1セクタ256
                                
       EA6E                     RDWT:
001D3E EA6E 3EB3             7      LD  A,0B3H      ;OTIR
001D40 EA70 1802            12      JR  RDRW
       EA72                     RDRD:
001D42 EA72 3EB2             7      LD  A,0B2H      ;INIR
       EA74                     RDRW:
001D44 EA74 3281EA          13      LD  (RDRW1+1),A
                                
001D47 EA77 78               4      LD  A,B
001D48 EA78 43               4      LD  B,E     ;B=アドレスカウンタ上位(X1の様な16bitのI/Oアクセス)
001D49 EA79 0EEB             7      LD  C,0EBH
001D4B EA7B ED71            12      OUT (C),0       ;0=アドレスカウンタ下位
001D4D EA7D 0D               4      DEC C       ;EA(R)データ読み出し・アドレスカウンタ+1
001D4E EA7E 0600             7      LD  B,0
       EA80                     RDRW1:
001D50 EA80 EDB2                    INIR            ;自己書き換え(INIR/OTIR)
001D52 EA82 13               6      INC DE
001D53 EA83 3D               4      DEC A
001D54 EA84 20FA            12      JR  NZ,RDRW1
001D56 EA86 A7               4      AND A
001D57 EA87 C9              10      RET
                                
                                ;   G-RAM(PCG) DISK DRIVER (24KB)
                                ;   1セクタ256
                                
       EA88                     GDWT:
001D58 EA88 C5              11      PUSH    BC
001D59 EA89 D5              11      PUSH    DE
001D5A EA8A CDB2EA          17      CALL    GADR
       EA8D                     GDWT2:
001D5D EA8D 4E               7      LD  C,(HL)
001D5E EA8E 23               6      INC HL
001D5F EA8F EB               4      EX  DE,HL   ;HL=PCG,DE=メモリ
001D60 EA90 CDD2CF          17      CALL    WR_PCG
001D63 EA93 23               6      INC HL
001D64 EA94 EB               4      EX  DE,HL   ;HL=メモリ,DE=PCG
001D65 EA95 10F6            13      DJNZ    GDWT2
001D67 EA97 D1              10      POP DE
001D68 EA98 1C               4      INC E
001D69 EA99 C1              10      POP BC
001D6A EA9A 10EC            13      DJNZ    GDWT
001D6C EA9C C9              10      RET
       EA9D                     GDRD:
001D6D EA9D C5              11      PUSH    BC
001D6E EA9E D5              11      PUSH    DE
001D6F EA9F CDB2EA          17      CALL    GADR
       EAA2                     GDRD2:
001D72 EAA2 EB               4      EX  DE,HL   ;HL=PCG,DE=メモリ
001D73 EAA3 CDCACF          17      CALL    RD_PCG
001D76 EAA6 23               6      INC HL
001D77 EAA7 EB               4      EX  DE,HL   ;HL=メモリ,DE=PCG
001D78 EAA8 71               7      LD  (HL),C
001D79 EAA9 23               6      INC HL
001D7A EAAA 10F6            13      DJNZ    GDRD2
001D7C EAAC D1              10      POP DE
001D7D EAAD 1C               4      INC E
001D7E EAAE C1              10      POP BC
001D7F EAAF 10EC            13      DJNZ    GDRD
001D81 EAB1 C9              10      RET
                                
       EAB2                     GADR:
001D82 EAB2 7B               4      LD  A,E
001D83 EAB3 E61F             7      AND 01FH
001D85 EAB5 C6D0             7      ADD A,0D0H
001D87 EAB7 57               4      LD  D,A
001D88 EAB8 7B               4      LD  A,E
001D89 EAB9 07               4      RLCA
001D8A EABA 07               4      RLCA
001D8B EABB 07               4      RLCA
001D8C EABC 3C               4      INC A
001D8D EABD 0600             7      LD  B,0
001D8F EABF 58               4      LD  E,B
001D90 EAC0 C9              10      RET
[EOF:M7DISK2.ASM:UTF_8]
                                    INCLUDE "LDCCPWK.ASM"
                                
                                ;   LSX-Dodgers CCP WORK
                                
       003B                     PATHX   EQU 59
001D91 EAC1                     PATHD:  DS  PATHX
001DCC EAFC 00                  PATHE:  DB  0
                                
       EAFD                     DTA_CCP:
001DCD EAFD                         DS  37
                                
       EB22                     FCB_BAT:
001DF2 EB22                         DS  37
                                
001E17 EB47 2020203C4449523E    DIRMES: DB  "   <DIR>  $"
            202024              
001E22 EB52 20667265652024      FREE:   DB  " free $"
[EOF:LDCCPWK.ASM:UTF_8]
                                    INCLUDE "M7TABLE.ASM"
                                
                                ;   LSX-Dodgers TABLE 表示関連のテーブル
                                ;   MZ-700/1500
                                
       EB59                     AT_TABLE:
001E29 EB59                         DS  TABLEAD-AT_TABLE
                                
       ED40                     KEY_TABLE:
002010 ED40 12081E1F1C1D5C2F        DB  12H,08H,1EH,1FH,1CH,1DH,5CH,'/'
002018 ED48 5C5E2D2030392C2E        DB  5CH,'^','-',20H,'0','9',',','.'
002020 ED50 3132333435363738        DB  '1','2','3','4','5','6','7','8'
002028 ED58 6162636465666768        DB  'a','b','c','d','e','f','g','h'
002030 ED60 696A6B6C6D6E6F70        DB  'i','j','k','l','m','n','o','p'
002038 ED68 7172737475767778        DB  'q','r','s','t','u','v','w','x'
002040 ED70 797A405B5D000000        DB  'y','z','@','[',']',00H,00H,00H
002048 ED78 001B3D09003B3A0D        DB  00H,1BH,'=',09H,00H,';',':',0DH
       ED80                     SHIFT_TABLE:
002050 ED80 12081E1F1C1D5F3F        DB  12H,08H,1EH,1FH,1CH,1DH,'_','?'
002058 ED88 7C7E3D2030293C3E        DB  '|','~','=',20H,'0',')','<','>'
002060 ED90 2122232425262728        DB  '!','"','#','$','%','&',27H,'('
002068 ED98 4142434445464748        DB  'A','B','C','D','E','F','G','H'
002070 EDA0 494A4B4C4D4E4F50        DB  'I','J','K','L','M','N','O','P'
002078 EDA8 5152535455565758        DB  'Q','R','S','T','U','V','W','X'
002080 EDB0 595A607B7D000000        DB  'Y','Z','`','{','}',00H,00H,00H
002088 EDB8 00003D09002B2A0D        DB  00H,00H,'=',09H,00H,'+','*',0DH
       EDC0                     CTRL_TABLE:
002090 EDC0 12081E1F1C1D3F2F        DB  12H,08H,1EH,1FH,1CH,1DH,'?','/'
002098 EDC8 2A2B2D2030392C2E        DB  '*','+','-',20H,'0','9',',','.'
0020A0 EDD0 3132333435363738        DB  '1','2','3','4','5','6','7','8'
0020A8 EDD8 0102030405060708        DB  01H,02H,03H,04H,05H,06H,07H,08H
0020B0 EDE0 090A0B0C0D0E0F10        DB  09H,0AH,0BH,0CH,0DH,0EH,0FH,10H
0020B8 EDE8 1112131415161718        DB  11H,12H,13H,14H,15H,16H,17H,18H
0020C0 EDF0 191A1B5B5D000000        DB  19H,1AH,1BH,'[',']',00H,00H,00H
0020C8 EDF8 00003D09003B3A0D        DB  00H,00H,'=',09H,00H,';',':',0DH
                                
                                ;   アドレス下位1バイトが0になるように
       EE00                     CD_TABLE:
0020D0 EE00 00D1D2D3D4D5D6D0        DB  $00,$D1,$D2,$D3,$D4,$D5,$D6,$D0 ;月火水木金土日
0020D8 EE08 D8DCD9DADBD7CFCE        DB  $D8,$DC,$D9,$DA,$DB,$D7,$CF,$CE ;年円時分秒
0020E0 EE10 601F5F5E1E1B7978        DB  $60,$1F,$5F,$5E,$1E,$1B,$79,$78 ;
0020E8 EE18 5C5D1C1D6DCACDC7        DB  $5C,$5D,$1C,$1D,$6D,$CA,$CD,$C7 ;
0020F0 EE20 0061626364656667        DB  $00,$61,$62,$63,$64,$65,$66,$67 ; !"#$%&'
0020F8 EE28 68696B6A2F2A2E2D        DB  $68,$69,$6B,$6A,$2F,$2A,$2E,$2D ;()*+,-./
002100 EE30 2021222324252627        DB  $20,$21,$22,$23,$24,$25,$26,$27 ;01234567
002108 EE38 28294F2C512B5749        DB  $28,$29,$4F,$2C,$51,$2B,$57,$49 ;89:;<=>?
002110 EE40 5501020304050607        DB  $55,$01,$02,$03,$04,$05,$06,$07 ;@ABCDEFG
002118 EE48 08090A0B0C0D0E0F        DB  $08,$09,$0A,$0B,$0C,$0D,$0E,$0F ;HIJKLMNO
002120 EE50 1011121314151617        DB  $10,$11,$12,$13,$14,$15,$16,$17 ;PQRSTUVW
002128 EE58 18191A52DD54507C        DB  $18,$19,$1A,$52,$DD,$54,$50,$7C ;XYZ[\]^_
002130 EE60 5901020304050607        DB  $59,$01,$02,$03,$04,$05,$06,$07 ;`abcdefg   ATB:1
002138 EE68 08090A0B0C0D0E0F        DB  $08,$09,$0A,$0B,$0C,$0D,$0E,$0F ;hijklmno   ATB:1
002140 EE70 1011121314151617        DB  $10,$11,$12,$13,$14,$15,$16,$17 ;pqrstuvw   ATB:1
002148 EE78 18191ACB35CC705A        DB  $18,$19,$1A,$CB,$35,$CC,$70,$5A ;xyz{|}~    ATB:1
002150 EE80 415346444847B49E        DB  $41,$53,$46,$44,$48,$47,$B4,$9E ;トランプ〇●をぁ   ATB:1
002158 EE88 B2B6BABE9FB3B7BB        DB  $B2,$B6,$BA,$BE,$9F,$B3,$B7,$BB ;ぃぅぇぉゃゅょっ   ATB:1
002160 EE90 BFA385A4A5A69487        DB  $BF,$A3,$85,$A4,$A5,$A6,$94,$87 ;ーあいうえおかき   ATB:1
002168 EE98 889C829884929083        DB  $88,$9C,$82,$98,$84,$92,$90,$83 ;くけこさしすせそ   ATB:1
002170 EEA0 F0BD9DB1B5B9B49E        DB  $F0,$BD,$9D,$B1,$B5,$B9,$B4,$9E ;　。「」、・ヲァ
002178 EEA8 B2B6BABE9FB3B7BB        DB  $B2,$B6,$BA,$BE,$9F,$B3,$B7,$BB ;ィゥェォャョュッ
002180 EEB0 BFA385A4A5A69487        DB  $BF,$A3,$85,$A4,$A5,$A6,$94,$87 ;ーアイウエオカキ
002188 EEB8 889C829884929083        DB  $88,$9C,$82,$98,$84,$92,$90,$83 ;クケコサシスセソ
002190 EEC0 91819A97939589A1        DB  $91,$81,$9A,$97,$93,$95,$89,$A1 ;タチツテトナニヌ
002198 EEC8 AF8B8696A2ABAA8A        DB  $AF,$8B,$86,$96,$A2,$AB,$AA,$8A ;ネノハヒフヘホマ
0021A0 EED0 8EB0AD8DA7A8A98F        DB  $8E,$B0,$AD,$8D,$A7,$A8,$A9,$8F ;ミムメモヤユヨラ
0021A8 EED8 8CAEAC9BA099BCB8        DB  $8C,$AE,$AC,$9B,$A0,$99,$BC,$B8 ;リルレロワン゛゜
0021B0 EEE0 91819A97939589A1        DB  $91,$81,$9A,$97,$93,$95,$89,$A1 ;たちつてとねにぬ   ATB:1
0021B8 EEE8 AF8B8696A2ABAA8A        DB  $AF,$8B,$86,$96,$A2,$AB,$AA,$8A ;ねのはひふへほま   ATB:1
0021C0 EEF0 8EB0AD8DA7A8A98F        DB  $8E,$B0,$AD,$8D,$A7,$A8,$A9,$8F ;みむめもやゆよら   ATB:1
0021C8 EEF8 8CAEAC9BA099BCB8        DB  $8C,$AE,$AC,$9B,$A0,$99,$BC,$B8 ;りるれろわん゛゜   ATB:1
       EF00                     DC_TABLE:
0021D0 EF00 2041424344454647        DB  $20,$41,$42,$43,$44,$45,$46,$47 ;0
0021D8 EF08 48494A4B4C4D4E4F        DB  $48,$49,$4A,$4B,$4C,$4D,$4E,$4F
0021E0 EF10 5051525354555657        DB  $50,$51,$52,$53,$54,$55,$56,$57 ;1
0021E8 EF18 58595A151A1B1411        DB  $58,$59,$5A,$15,$1A,$1B,$14,$11
0021F0 EF20 3031323334353637        DB  $30,$31,$32,$33,$34,$35,$36,$37 ;2
0021F8 EF28 38392D3D3B2F2E2C        DB  $38,$39,$2D,$3D,$3B,$2F,$2E,$2C
002200 EF30 00000000007C0000        DB  $00,$00,$00,$00,$00,$7C,$00,$00 ;3
002208 EF38 0000000000000000        DB  $00,$00,$00,$00,$00,$00,$00,$00
002210 EF40 0080000083008285        DB  $00,$80,$00,$00,$83,$00,$82,$85 ;4
002218 EF48 843F00000000003A        DB  $84,$3F,$00,$00,$00,$00,$00,$3A
002220 EF50 5E3C5B815D40003E        DB  $5E,$3C,$5B,$81,$5D,$40,$00,$3E ;5
002228 EF58 00607F0018191312        DB  $00,$60,$7F,$00,$18,$19,$13,$12
002230 EF60 1021222324252627        DB  $10,$21,$22,$23,$24,$25,$26,$27 ;6
002238 EF68 28292B2A001C0000        DB  $28,$29,$2B,$2A,$00,$1C,$00,$00
002240 EF70 7E00000000000000        DB  $7E,$00,$00,$00,$00,$00,$00,$00 ;7
002248 EF78 171600005F000000        DB  $17,$16,$00,$00,$5F,$00,$00,$00
002250 EF80 00C19A9F9C92CA97        DB  $00,$C1,$9A,$9F,$9C,$92,$CA,$97 ;8
002258 EF88 98C6CFC9D8D3D0D7        DB  $98,$C6,$CF,$C9,$D8,$D3,$D0,$D7
002260 EF90 9EC09DC496C5CBC3        DB  $9E,$C0,$9D,$C4,$96,$C5,$CB,$C3 ;9
002268 EF98 9BDDC2DB99A2878C        DB  $9B,$DD,$C2,$DB,$99,$A2,$87,$8C
002270 EFA0 DCC7CC91939495D4        DB  $DC,$C7,$CC,$91,$93,$94,$95,$D4 ;A
002278 EFA8 D5D6CECDDAD2D9C8        DB  $D5,$D6,$CE,$CD,$DA,$D2,$D9,$C8
002280 EFB0 D1A3888D86A4898E        DB  $D1,$A3,$88,$8D,$86,$A4,$89,$8E ;B
002288 EFB8 DFA58A8FDEA18B90        DB  $DF,$A5,$8A,$8F,$DE,$A1,$8B,$90
002290 EFC0 000000000000001F        DB  $00,$00,$00,$00,$00,$00,$00,$1F ;C
002298 EFC8 00001D7B7D1E0F0E        DB  $00,$00,$1D,$7B,$7D,$1E,$0F,$0E
0022A0 EFD0 070102030405060D        DB  $07,$01,$02,$03,$04,$05,$06,$0D ;D
0022A8 EFD8 080A0B0C095C0000        DB  $08,$0A,$0B,$0C,$09,$5C,$00,$00
0022B0 EFE0 0000000000000000        DB  $00,$00,$00,$00,$00,$00,$00,$00 ;E
0022B8 EFE8 0000000000000000        DB  $00,$00,$00,$00,$00,$00,$00,$00
0022C0 EFF0 A000000000000000        DB  $A0,$00,$00,$00,$00,$00,$00,$00 ;F
0022C8 EFF8 0000000000000000        DB  $00,$00,$00,$00,$00,$00,$00,$00
[EOF:M7TABLE.ASM:SHIFT_JIS]
                                    INCLUDE "LDWORK.ASM"
                                
                                ;   LSX-Dodgers WORK0
                                ;
                                ;   CP/M互換BIOS
                                ;   BOOT:アドレス下位1バイトが0になるように
       F000                     AT_WORK:
0022D0 F000                         DS  WORKAD-AT_WORK
                                
       F000                     CPM_BOOT:
0022D0 F000 C30000          10      JP  0
       F003                     _SYS00:     ;(BDOS)プログラム終了
       F003                     CPM_WBOOT:
0022D3 F003 C3FECF          10      JP  WBOOT1
       F006                     CPM_CONST:
0022D6 F006 C39CD7          10      JP  CONSTX
       F009                     _SYS07:     ;(BDOS)コンソール直接入力
       F009                     CPM_CONIN:
0022D9 F009 C337D7          10      JP  FLGET
       F00C                     CPM_CONOUT:
0022DC F00C C341D9          10      JP  CONOUT1
                                
       F00F                     DECBF:              ;10進数表示時のバッファ(5バイト)
0022DF F00F                         DS  5
       F00F                     RR_BUF_HL   EQU DECBF   ;CP/M互換ファイルアクセスの際のランダムレコードの一時的な保管場所
       F011                     RR_BUF_A    EQU DECBF+2 ;計3バイト
                                
0022E4 F014 00                  FDRV:   DB  0
0022E5 F015                     FNAME:  DS  36
002309 F039                     SFILE:  DS  33      ;DRV FILENAME
                                
00232A F05A                         DS  3
                                
00232D F05D 0000                LEFTX:  DW  0
00232F F05F 0000                DTAX:   DW  0
                                
       F061                     ZERO:
       F061                     BEEPD:
002331 F061 008E01000B000C10        DB  0,08EH,1,0,00BH,0,00CH,010H
002339 F069 073E08100D00FF          DB  007H,03EH,008H,010H,00DH,0,0FFH
       F062                     RTC_YY  EQU BEEPD+1
       F063                     RTC_MW  EQU BEEPD+2
       F064                     RTC_DD  EQU BEEPD+3
       F065                     RTC_TT  EQU BEEPD+4
       F066                     RTC_MM  EQU BEEPD+5
       F067                     RTC_SS  EQU BEEPD+6
       F062                     ROM_SLT EQU BEEPD+1
                                
002340 F070 00                  CHECK:  DB  0
                                
002341 F071 4F4B24              OK: DB  "OK$"
002344 F074                         DS  5
002349 F079 4572726F722124      COMERM: DB  "Error!$"
                                ;   システムワークエリア
                                ;   _CYL0:アドレス下位1バイトが080Hになるように
002350 F080 FF                  _CYL0:  DB  0FFH    ;Cylinder
002351 F081 FF                  _CYL1:  DB  0FFH    ;Cylinder
002352 F082 FF                  _CYL2:  DB  0FFH    ;Cylinder
002353 F083 FF                  _CYL3:  DB  0FFH    ;Cylinder
002354 F084 00                  _DRIVE: DB  0   ;unit number
002355 F085 00                  _SEEKSP:DB  0   ;Seek speed
002356 F086 FF                  _ISEEK: DB  0FFH    ;
002357 F087 00                  _DVSW:  DB  0
002358 F088 00                  _DRV:   DB  0
002359 F089 FF                  _DSK:   DB  0FFH
00235A F08A 8000                _DTA:   DW  00080H
00235C F08C 0000                _CTC:   DW  0
00235E F08E 0000                _TXADR: DW  0
002360 F090 0000                _KEYPS: DW  0
002362 F092 00FF                _KEYD:  DW  0FF00H  ;キーデータ
002364 F094 8310                _KEYSP: DB  KEYSP_L,KEYSP_H ;オートリピートの速度
002366 F096 70                  _COLORF:DB  COLORF  ;色
002367 F097 19                  _LINE:  DB  LINE
                                
002368 F098 0000                _FCB:   DW  0   ;SEARCH FILES
00236A F09A 0000                _FBPS:  DW  0   ;    //
00236C F09C 0000                _FBAD:  DW  0   ;    //
00236E F09E 00                  _FBCNT: DB  0   ;    //
00236F F09F 00                  _FILEN: DB  0   ;    //
002370 F0A0 00                  _DIRF:  DB  0   ;bit7:ディレクトリ bit0-6:セクタインデックス
002371 F0A1                         DS  1
002372 F0A2 00                  _WTFATF:DB  0   ;FATバッファの更新フラグ
002373 F0A3                         DS  1
002374 F0A4 00                  _WTDBF: DB  0   ;データバッファの更新フラグ
002375 F0A5 FF                  _DBDRV: DB  0FFH    ;データバッファにあるデータを読み込んだドライブ
002376 F0A6 0000                _DBSEC: DW  0   ;データバッファにあるデータを読み込んだセクタ番号
002378 F0A8 0000                _DPB:   DW  0
       F0AA                     _FATDRV:
00237A F0AA FF                      DB  0FFH    ;FATバッファに読み込んでいるドライブ
00237B F0AB 00                  _FATIX: DB  0   ;FATバッファに読み込んでいるインデックス
       F0AC                     _FAKEFREE:
00237C F0AC 0000                    DW  0   ;偽の残量（FATサイズが大きくなると重くなるのでその対策）
                                
00237E F0AE                         DS  2
                                
       F0B0                     CRTCD:
002380 F0B0 6F                      DB  06FH
       F0B1                     _WIDTH:
002381 F0B1 28                      DB  WIDTH
       F0B2                     TVRAMTOP:
002382 F0B2 5938                    DB  059H,038H
002384 F0B4 1F02                    DB  01FH,002H
       F0B6                     _LINE2:
002386 F0B6 19                      DB  019H
       F0B7                     WKE4:
002387 F0B7 1C                      DB  01CH
       F0B8                     WKE6:
002388 F0B8 00                      DB  000H
       F0B9                     WK40:
002389 F0B9 07                      DB  007H
       F0BA                     _PAGE_MINUS:
00238A F0BA 18FC                    DW  0-WIDTH*LINE
       F0BC                     _WIDTH_MINUS:
00238C F0BC D8FF                    DW  0-WIDTH
       F0BE                     WK30:
00238E F0BE 0C                      DB  00CH
       F0BF                     WK31:
       F0BF                     WK1FD0:
00238F F0BF 20                      DB  020H
                                
002390 F0C0 0000                CTC0:   DW  INTCTCE
002392 F0C2 0000                CTC1:   DW  INTCTCE
002394 F0C4 0000                CTC2:   DW  INTCTCE
002396 F0C6 0000                CTC3:   DW  INTCTCE
002398 F0C8 0000                INTVEC: DW  INT
                                
                                ;   LSX-Dodgers 独自BIOS
                                
00239A F0CA C388DA          10  _INKEY: JP  INKEY
00239D F0CD C32DD8          10  _PRINT: JP  PRINT
0023A0 F0D0 C3FCDA          10  _SCRN:  JP  SCRN
0023A3 F0D3 C3EAD9          10  _POS:   JP  POS
0023A6 F0D6 C30FD9          10  _LOC:   JP  LOC
       F0D9                     _CHGDRV:
0023A9 F0D9 C399E7          10      JP  CHGDRV
       F0DC                     _GETDPB:
0023AC F0DC C357E8          10      JP  GETDPB
       F0DF                     _FFLUSH:
0023AF F0DF C375E8          10      JP  FFLUSH
       F0E2                     _RDFATX:
0023B2 F0E2 C382E4          10      JP  RDFATX
0023B5 F0E5 C3AAE5          10  _RDFAT: JP  RDFAT
0023B8 F0E8 C33BE9          10  _WTTRK: JP  WTTRK
0023BB F0EB C39BE9          10  _FDRD:  JP  FDRD
0023BE F0EE C341E9          10  _FDWT:  JP  FDWT
       F0F1                     _BPB2DPB:
0023C1 F0F1 C337E6          10      JP  BPB2DPB
       F0F4                     _BREAK:
0023C4 F0F4 C391D1          10      JP  END_BATCH
       F0F7                     _GNCL:
0023C7 F0F7 C324E5          10      JP  GNCL        ; self-modifying code
       F0F8                     GNCPAT  EQU $-2
       F0FA                     _SNCL:
0023CA F0FA C347E5          10      JP  SNCL        ; self-modifying code
       F0FB                     SNCPAT  EQU $-2
0023CD F0FD C34AD0          10  _COMANL:JP  COMANL
                                
       F100                     _WE:
[EOF:LDWORK.ASM:SHIFT_JIS]
                                    INCLUDE "LDCALL.ASM"
                                
                                ;   LSX-Dodgers システムコール(BDOS)
                                ;
                                ;   LSX-Dodgers SYSTEM CALL
                                ;   STABLE:アドレス下位1バイトが0になるように
                                
       F100                     STABLE:
                                ;0
0023D0 F100 03F00ED71AD7DDDC        DW  _SYS00,_SYS01,_SYS02,_SYS03
0023D8 F108 79D479D41FD709F0        DW  _SYS04,_SYS05,_SYS06,_SYS07
0023E0 F110 27D77BD46DD799D7        DW  _SYS08,_SYS09,_SYS0A,_SYS0B
0023E8 F118 90D495D4A4D4B5D4        DW  _SYS0C,_SYS0D,_SYS0E,_SYS0F
                                ;1
0023F0 F120 09D550D599D5CAD5        DW  _SYS10,_SYS11,_SYS12,_SYS13
0023F8 F128 D2D5E8D5FDD5F5D5        DW  _SYS14,_SYS15,_SYS16,_SYS17
002400 F130 44D649D64ED654D6        DW  _SYS18,_SYS19,_SYS1A,_SYS1B
002408 F138 79D47AD679D47ED6        DW  _SYS1C,_SYS1D,_SYS1E,_SYS1F
                                ;2
002410 F140 79D434D63CD685D6        DW  _SYS20,_SYS21,_SYS22,_SYS23
002418 F148 ABD679D456E12EE2        DW  _SYS24,_ERROR,_SYS26,_SYS27
002420 F150 3CD6B4D6AAD7DDDC        DW  _SYS28,_SYS29,_SYS2A,_SYS2B
002428 F158 B0D7DDDC79D4D5D6        DW  _SYS2C,_SYS2D,_SYS2E,_SYS2F
                                ;3
002430 F160 CFD679D479D479D4        DW  _SYS30,_ERROR,_ERROR,_ERROR
002438 F168 79D479D479D479D4        DW  _ERROR,_ERROR,_ERROR,_ERROR
002440 F170 79D4DDDCDDDCF6D6        DW  _ERROR,_SYS39,_SYS3A,_SYS5A
                                ;DOS2
002448 F178 5CD4                    DW  _DOS2
                                
00244A F17A                         DS  2
00244C F17C 00F3                _FATBF: DW  FATBF
00244E F17E 00FB                _DTBUF: DW  DTBUF
                                
                                ;   コントロールコードテーブル
                                ;   CTRLTB:アドレス下位1バイトが080Hになるように
                                
       F180                     CTRLTB:
002450 F180 92D892D8C8D8BDD9        DW  CTRL00,CTRL00,CTRL02,CTRL03 ;  A,B,C
002458 F188 B7D9F4D8A8D951D9        DW  CTRL04,CTRL05,CTRL06,CTRL07 ;D,E,F,G
002460 F190 9ED8B9D8C0D922D9        DW  CTRL08,CTRL09,CTRL0A,CTRL0B ;H,I,J,K
002468 F198 A5D90AD9D2D992D8        DW  CTRL0C,CTRL0D,CTRL0E,CTRL00 ;L,M,N,O
002470 F1A0 92D892D81AD992D8        DW  CTRL00,CTRL00,CTRL12,CTRL00 ;P,Q,R,S
002478 F1A8 92D892D892D892D8        DW  CTRL00,CTRL00,CTRL00,CTRL00 ;T,U,V,W
002480 F1B0 92D892D8A5D929D9        DW  CTRL00,CTRL00,CTRL0C,CTRL1B ;X,Y,Z,ESC
002488 F1B8 81D8A5D8AED8C0D9        DW  CTRL1C,CTRL1D,CTRL1E,CTRL1F ;→,←,↑,↓
                                
002490 F1C0 0200                M2D:    DW  2
002492 F1C2 FD02                    DB  0FDH,2
002494 F1C4 6401                    DW  356
002496 F1C6 FF0728090182            DB  0FFH,7,40,9,1,082H
00249C F1CC 0500A7000800            DW  5,0A7H,8
                                
0024A2 F1D2 0200                M2HD:   DW  2
0024A4 F1D4 FE01                    DB  0FEH,1
0024A6 F1D6 C704                    DW  1223
0024A8 F1D8 FE064D080184            DB  0FEH,6,77,8,1,084H
0024AE F1DE 0500A7000900            DW  5,0A7H,9
                                
0024B4 F1E4 1617                SDDATA: DB  22,23       ;(FCB)ファイルを最後に変更した時刻
0024B6 F1E6 1415                    DB  20,21       ;(FCB)ファイルを最後に変更した日付
0024B8 F1E8 1A1B                    DB  26,27       ;(FCB)ファイルの先頭クラスタ
0024BA F1EA 10111213                DB  16,17,18,19 ;(FCB)ファイルのサイズ(バイト単位)
       F1EE                     SDDATAE:
                                
0024BE F1EE                         DS  2
       F1F0                     _FCB_BAT:
0024C0 F1F0 22EB                    DW  FCB_BAT
       F1F2                     _PATH:
0024C2 F1F2 C1EA                    DW  PATHD
                                
0024C4 F1F4                     SCDIR:  DS  2       ;+14 +15
0024C6 F1F6                     SFBPS:  DS  2       ;FBPS
0024C8 F1F8                     SFNDF:  DS  2       ;FILEN DIRF
                                
0024CA F1FA 0000                _FATPS: DW  0
0024CC F1FC 0000                _DIRPS: DW  0
0024CE F1FE 0000                _CLPS:  DW  0
                                
       F200                     _PE:
[EOF:LDCALL.ASM:SHIFT_JIS]
                                    INCLUDE "M7DPB.ASM"
                                
                                ;   LSX-Dodgers DPB
                                ;   MZ-700/1500
                                
       F200                     _DEVICE:
                                
                                ;   A:
                                
0024D0 F200 0200                    DW  2   ;DPB_FATLN
0024D2 F202 EBF0                    DW  _FDRD   ;DPB_DRD
0024D4 F204 EEF0                    DW  _FDWT   ;DPB_DWT
0024D6 F206 FD                      DB  0FDH    ;DPB_FATID
0024D7 F207 02                      DB  2   ;DPB_SECPCL
0024D8 F208 6401                    DW  356 ;DPB_MAXCL
0024DA F20A FF                      DB  0FFH    ;DPB_FDMODE 0FFH=2D / 0FEH=2HD
0024DB F20B 07                      DB  7   ;DPB_DIRSCNT
0024DC F20C 28                      DB  40  ;DPB_MAXCYL
0024DD F20D 09                      DB  9   ;DPB_MAXSEC Number of sectors
0024DE F20E 01                      DB  1   ;DPB_FATPS
0024DF F20F 82                      DB  082H    ;DPB_BPS
0024E0 F210 0500                    DW  5   ;DPB_DIRPS
0024E2 F212 27                      DB  027H    ;DPB_DEVICE Device Number
0024E3 F213 00                      DB  0   ;DPB_UNITNO
0024E4 F214 0800                    DW  8   ;DPB_ADDCL
0024E6 F216 0000                    DW  0   ;DPB_16
0024E8 F218 0000                    DW  0   ;DPB_18
0024EA F21A 0000                    DW  0   ;DPB_SDIR
0024EC F21C 46444430                DB  "FDD0"  ;DPB_NAME
                                
                                ;   B:
                                
0024F0 F220 0200                    DW  2   ;DPB_FATLN
0024F2 F222 EBF0                    DW  _FDRD   ;DPB_DRD
0024F4 F224 EEF0                    DW  _FDWT   ;DPB_DWT
0024F6 F226 FD                      DB  0FDH    ;DPB_FATID
0024F7 F227 02                      DB  2   ;DPB_SECPCL
0024F8 F228 6401                    DW  356 ;DPB_MAXCL
0024FA F22A FF                      DB  0FFH    ;DPB_FDMODE 0FFH=2D / 0FEH=2HD
0024FB F22B 07                      DB  7   ;DPB_DIRSCNT
0024FC F22C 28                      DB  40  ;DPB_MAXCYL
0024FD F22D 09                      DB  9   ;DPB_MAXSEC Number of sectors
0024FE F22E 01                      DB  1   ;DPB_FATPS
0024FF F22F 82                      DB  082H    ;DPB_BPS
002500 F230 0500                    DW  5   ;DPB_DIRPS
002502 F232 27                      DB  027H    ;DPB_DEVICE Device Number
002503 F233 01                      DB  1   ;DPB_UNITNO
002504 F234 0800                    DW  8   ;DPB_ADDCL
002506 F236 0000                    DW  0   ;DPB_16
002508 F238 0000                    DW  0   ;DPB_18
00250A F23A 0000                    DW  0   ;DPB_SDIR
00250C F23C 46444431                DB  "FDD1"  ;DPB_NAME
                                
                                ;   C:
                                
002510 F240 0100                    DW  1   ;DPB_FATLN
002512 F242 5BEA                    DW  CDRD    ;DPB_DRD
002514 F244 48EA                    DW  CDWT    ;DPB_DWT
002516 F246 FA                      DB  0FAH    ;DPB_FATID
002517 F247 01                      DB  1   ;DPB_SECPCL
002518 F248 7A00                    DW  122 ;DPB_MAXCL
00251A F24A 00                      DB  0   ;DPB_FDMODE
00251B F24B 06                      DB  6   ;DPB_DIRSCNT
00251C F24C 00                      DB  0   ;DPB_MAXCYL
00251D F24D 00                      DB  0   ;DPB_MAXSEC
00251E F24E 01                      DB  1   ;DPB_FATPS
00251F F24F 01                      DB  1   ;DPB_BPS
002520 F250 0200                    DW  2   ;DPB_DIRPS
002522 F252 0C                      DB  00CH    ;DPB_DEVICE
002523 F253 F8                      DB  0F8H    ;DPB_UNITNO
002524 F254 0600                    DW  6   ;DPB_ADDCL
002526 F256 0000                    DW  0   ;DPB_16
002528 F258 0000                    DW  0   ;DPB_18
00252A F25A 0000                    DW  0   ;DPB_SDIR
00252C F25C 434D4F53                DB  "CMOS"  ;DPB_NAME
                                
                                ;   D:
                                
002530 F260                         DS  32
                                
                                ;   E:
                                
       F280                     EMMFL:
002550 F280 0000                    DW  0   ;DPB_FATLN
002552 F282 12EA                    DW  EDRD    ;DPB_DRD
002554 F284 05EA                    DW  EDWT    ;DPB_DWT
002556 F286 FA                      DB  0FAH    ;DPB_FATID
002557 F287 02                      DB  2   ;DPB_SECPCL
002558 F288 0000                    DW  0   ;DPB_MAXCL
00255A F28A 00                      DB  0   ;DPB_FDMODE
00255B F28B 10                      DB  16  ;DPB_DIRSCNT
00255C F28C 00                      DB  0   ;DPB_MAXCYL
00255D F28D 00                      DB  0   ;DPB_MAXSEC
00255E F28E 01                      DB  1   ;DPB_FATPS
00255F F28F 01                      DB  1   ;DPB_BPS
002560 F290 0000                    DW  0   ;DPB_DIRPS
002562 F292 26                      DB  026H    ;DPB_DEVICE
002563 F293 00                      DB  0   ;DPB_UNITNO
002564 F294 0000                    DW  0   ;DPB_ADDCL
002566 F296 0000                    DW  0   ;DPB_16
002568 F298 0000                    DW  0   ;DPB_18
00256A F29A 0000                    DW  0   ;DPB_SDIR
00256C F29C 454D4D30                DB  "EMM0"  ;DPB_NAME
                                
                                ;   F:
                                
002570 F2A0 0200                    DW  2   ;DPB_FATLN
002572 F2A2 72EA                    DW  RDRD    ;DPB_DRD
002574 F2A4 6EEA                    DW  RDWT    ;DPB_DWT
002576 F2A6 FA                      DB  0FAH    ;DPB_FATID
002577 F2A7 01                      DB  1   ;DPB_SECPCL
002578 F2A8 F600                    DW  246 ;DPB_MAXCL
00257A F2AA 00                      DB  0   ;DPB_FDMODE
00257B F2AB 09                      DB  9   ;DPB_DIRSCNT
00257C F2AC 00                      DB  0   ;DPB_MAXCYL
00257D F2AD 00                      DB  0   ;DPB_MAXSEC
00257E F2AE 01                      DB  1   ;DPB_FATPS
00257F F2AF 01                      DB  1   ;DPB_BPS
002580 F2B0 0300                    DW  3   ;DPB_DIRPS
002582 F2B2 0F                      DB  00FH    ;DPB_DEVICE
002583 F2B3 00                      DB  0   ;DPB_UNITNO
002584 F2B4 0A00                    DW  10  ;DPB_ADDCL
002586 F2B6 0000                    DW  0   ;DPB_16
002588 F2B8 0000                    DW  0   ;DPB_18
00258A F2BA 0000                    DW  0   ;DPB_SDIR
00258C F2BC 52414D46                DB  "RAMF"  ;DPB_NAME
                                
                                ;   G:
       F2C0                     GRAMFL:
002590 F2C0 0100                    DW  1   ;DPB_FATLN
002592 F2C2 9DEA                    DW  GDRD    ;DPB_DRD
002594 F2C4 88EA                    DW  GDWT    ;DPB_DWT
002596 F2C6 FA                      DB  0FAH    ;DPB_FATID
002597 F2C7 01                      DB  1   ;DPB_SECPCL
002598 F2C8 5A00                    DW  90  ;DPB_MAXCL
00259A F2CA 00                      DB  0   ;DPB_FDMODE
00259B F2CB 06                      DB  6   ;DPB_DIRSCNT
00259C F2CC 00                      DB  0   ;DPB_MAXCYL
00259D F2CD 00                      DB  0   ;DPB_MAXSEC
00259E F2CE 01                      DB  1   ;DPB_FATPS
00259F F2CF 01                      DB  1   ;DPB_BPS
0025A0 F2D0 0200                    DW  2   ;DPB_DIRPS
0025A2 F2D2 05                      DB  005H    ;DPB_DEVICE
0025A3 F2D3 F8                      DB  0F8H    ;DPB_UNITNO
0025A4 F2D4 0600                    DW  6   ;DPB_ADDCL
0025A6 F2D6 0000                    DW  0   ;DPB_16
0025A8 F2D8 0000                    DW  0   ;DPB_18
0025AA F2DA 0000                    DW  0   ;DPB_SDIR
0025AC F2DC 4752414D                DB  "GRAM"  ;DPB_NAME
                                
                                ;   H:
0025B0 F2E0                         DS  3
0025B3 F2E3 00                      DB  0
[EOF:M7DPB.ASM:UTF_8]
                                
       A5B4                         ORG $$+OFFSET   ;$DEPHASE
       A5B4                     LAST_ADR:
                                
                                    END
[EOF:M7.ASM:UTF_8]
