                                ;*** AILZ80ASM *** Z-80 Assembler, version 1.0.0.0, LST:Full:4
                                ;   LSX-Dodgers for MZ-700/1500
                                ;   Programmed by
                                ;   Gaku (Lovers/Tablacus)
                                
                                    INCLUDE "M7DEF.ASM"
                                
                                ;   LSX-Dodgers DEF
                                ;   MZ-700/1500
                                
       0001                     MAC EQU 1   ;MZ-700/1500
       0000                     DEV EQU 0
                                
       011D                     VER_6F  EQU 0011DH
                                
       8080                     RUN EQU 08080H
       8000                     OFFSET  EQU RUN-128
       CF06                     BDOS    EQU 0CF06H
       ED40                     TABLEAD EQU 0ED40H
       F000                     WORKAD  EQU 0F000H
       F300                     FATBF   EQU 0F300H
       FB00                     DTBUF   EQU 0FB00H
       FF00                     KEYBF   EQU 0FF00H
       FF20                     KBUF    EQU 0FF20H
       FFD9                     TRAP38  EQU 0FFD9H
       0028                     WIDTH   EQU 40
       0019                     LINE    EQU 25
       0070                     COLORF  EQU 070H
       0010                     KEYSP_H EQU 16
       0083                     KEYSP_L EQU 131
       0009                     COMS    EQU 9
[EOF:M7DEF.ASM:UTF_8]
                                    INCLUDE "LDDEF.ASM"
                                
                                ;   LSX-Dodgers DEF
                                
       0001                     VER_1   EQU 1
       0006                     VER_2   EQU 6
       0000                     VER_3   EQU 0
       1D01                     MACW    EQU MAC + 01D00H    ;機種フラグとLD判別フラグ
       0001                     MACD    EQU MAC + DEV * 256 ;機種フラグとデバイスフラグ
       0160                     VER EQU VER_1 * 256 + VER_2 * 16 + VER_3
                                
       0005                     SYSTEM  EQU 00005H
       000F                     JP_HL   EQU 0000FH
       005C                     FCB1    EQU 0005CH
       006C                     FCB2    EQU 0006CH
       005D                     FCB1FN  EQU FCB1+1
       006D                     FCB2FN  EQU FCB2+1
       0080                     DTA1    EQU 00080H
                                
       FFCA                     EXTBIO  EQU 0FFCAH
                                
       0000                     DPB_FATLN   EQU 00H
       0002                     DPB_DRD     EQU 02H
       0004                     DPB_DWT     EQU 04H
       0006                     DPB_FATID   EQU 06H
       0007                     DPB_SECPCL  EQU 07H
       0008                     DPB_MAXCL   EQU 08H
       000A                     DPB_FDMODE  EQU 0AH
       000B                     DPB_DIRSCNT EQU 0BH
       000C                     DPB_MAXCYL  EQU 0CH
       000D                     DPB_MAXSEC  EQU 0DH
       000E                     DPB_FATPS   EQU 0EH
       000F                     DPB_BPS     EQU 0FH
       0010                     DPB_DIRPS   EQU 10H
       0012                     DPB_DEVICE  EQU 12H
       0013                     DPB_UNITNO  EQU 13H
       0014                     DPB_ADDCL   EQU 14H
                                
       001A                     DPB_SDIR    EQU 1AH
       001C                     DPB_NAME    EQU 1CH
                                
[EOF:LDDEF.ASM:SHIFT_JIS]
                                
000000 8000                         ORG OFFSET
                                                    ;MZTヘッダ128バイト
000000 8000 01                      DB  1           ;ファイルモード
000001 8001 4C44202020202020        DB  "LD           "     ;ファイル名(13)
            2020202020          
00000E 800E 535953                  DB  "SYS"           ;拡張子(3)
000011 8011 0D                      DB  $0D
000012 8012 3325                    DW  LAST_ADR-RUN        ;サイズ
000014 8014 8080                    DW  RUN         ;開始アドレス
000016 8016 8080                    DW  RUN         ;実行アドレス
000018 8018                         DS  104
                                
                                    INCLUDE "M7INIT.ASM"
                                
                                ;   LSX-Dodgers INIT
                                ;   MZ-700/1500
                                
000080 8080 C38780          10      JP  START
000083 8083 011D                    DW  MACW
000085 8085 6001                    DW  VER
                                
       8087                     START:
000087 8087 F3               4      DI
000088 8088 ED56             8      IM  1
00008A 808A 318780          10      LD  SP,START
00008D 808D CD9B80          17      CALL    INIT        ;NZならAUTOEXECを実行
000090 8090 210000          10      LD  HL,0
000093 8093 E5              11      PUSH    HL
000094 8094 C8              11      RET Z
000095 8095 117081          10      LD  DE,AUTOD
000098 8098 C3FDF0          10      JP  _COMANL
                                
       809B                     INIT:
00009B 809B D3E0            11      OUT (0E0H),A    ;DRAM(0000H-0FFFH)
00009D 809D D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
00009F 809F 21D581          10      LD  HL,INITE
0000A2 80A2 1106CF          10      LD  DE,BDOS
0000A5 80A5 01DE23          10      LD  BC,LAST_ADR-INITE
0000A8 80A8 EDB0                    LDIR
0000AA 80AA 21A681          10      LD  HL,M7BEEPD
0000AD 80AD 1162F0          10      LD  DE,BEEPD+1
0000B0 80B0 010800          10      LD  BC,M7BEEPE-M7BEEPD
0000B3 80B3 EDB0                    LDIR
                                
0000B5 80B5 210000          10      LD  HL,0
0000B8 80B8 065C             7      LD  B,05CH
0000BA 80BA 3E                      DB  03EH    ;LD A,??
0000BB 80BB EF              12      RST 28H
0000BC 80BC CDEEDB          17      CALL    FILL_MEMORY
0000BF 80BF 06A4             7      LD  B,0A4H
0000C1 80C1 AF               4      XOR A
0000C2 80C2 CDEEDB          17      CALL    FILL_MEMORY
                                
0000C5 80C5 3EC3             7      LD  A,0C3H      ;JP
0000C7 80C7 2103F0          10      LD  HL,CPM_WBOOT
0000CA 80CA 320000          13      LD  (00000H),A
0000CD 80CD 220100          16      LD  (00001H),HL ;IPL
                                
0000D0 80D0 21011D          10      LD  HL,MACW     ;3 bit7  DPB Compatible LA(1)
0000D3 80D3 220300          16      LD  (00003H),HL ;  bit6-0 Machine
                                ;               ;4 LSX-Dodgers(01DH)
0000D6 80D6 2106CF          10      LD  HL,BDOS
0000D9 80D9 320500          13      LD  (00005H),A
0000DC 80DC 220600          16      LD  (00006H),HL ;BDOS
                                
0000DF 80DF 21D9FF          10      LD  HL,TRAP38   ;TRAP38
0000E2 80E2 322800          13      LD  (00028H),A
0000E5 80E5 222900          16      LD  (00029H),HL ;RST 028H
                                
0000E8 80E8 323800          13      LD  (00038H),A
0000EB 80EB 211ACF          10      LD  HL,IO_INT8253
0000EE 80EE 223900          16      LD  (00039H),HL
                                
0000F1 80F1 3EF0             7      LD  A,CPM_BOOT/256
0000F3 80F3 320B00          13      LD  (0000BH),A
                                
0000F6 80F6 3EE9             7      LD  A,0E9H      ;JP (HL)
0000F8 80F8 320F00          13      LD  (0000FH),A
                                                    ;CHECK PCG(MZ-1500)
0000FB 80FB 2100E8          10      LD  HL,0E800H
0000FE 80FE 46               7      LD  B,(HL)
0000FF 80FF F3               4      DI
000100 8100 3E01             7      LD  A,1
000102 8102 D3E5            11      OUT (0E5H),A    ;MZ-1500: PCGバンク切り替え
000104 8104 4E               7      LD  C,(HL)
000105 8105 79               4      LD  A,C
000106 8106 C6A5             7      ADD A,0A5H
000108 8108 5F               4      LD  E,A
000109 8109 73               7      LD  (HL),E
00010A 810A D3E6            11      OUT (0E6H),A    ;MZ-1500: PCGバンクを閉じる
00010C 810C 71               7      LD  (HL),C
00010D 810D 3E01             7      LD  A,1
00010F 810F D3E5            11      OUT (0E5H),A    ;MZ-1500: PCGバンク切り替え
000111 8111 7E               7      LD  A,(HL)
000112 8112 BB               4      CP  E
000113 8113 D3E6            11      OUT (0E6H),A    ;MZ-1500: PCGバンクを閉じる
000115 8115 70               7      LD  (HL),B
000116 8116 FB               4      EI
000117 8117 2804            12      JR  Z,MZ1500
000119 8119 AF               4      XOR A       ;MZ-700はPCGバンクが存在しない
00011A 811A 32C0F2          13      LD  (GRAMFL),A
       811D                     MZ1500:
00011D 811D DD2180F2        14      LD  IX,EMMFL
000121 8121 CD6581          17      CALL    CHECK_EMM_BPB
000124 8124 FEEB             7      CP  0EBH
000126 8126 2810            12      JR  Z,EMM_BPB
000128 8128 DD360D02        19      LD  (IX+DPB_MAXSEC),2   ;BPBが512バイト目から始まる場合を調べる
00012C 812C CD6581          17      CALL    CHECK_EMM_BPB
00012F 812F DDBE06           7      CP  (IX+DPB_FATID)
000132 8132 2004            12      JR  NZ,EMM_BPB
000134 8134 DD360D00        19      LD  (IX+DPB_MAXSEC),0   ;BPBが先頭の場合に戻す
       8138                     EMM_BPB:
000138 8138 217C81          10      LD  HL,INIMES
00013B 813B CD8AD4          17      CALL    MSX
       813E                     INIT1:
00013E 813E F3               4      DI
00013F 813F 1100FF          10      LD  DE,0FF00H
000142 8142 0600             7      LD  B,0
000144 8144 CD27D3          17      CALL    ZERO_MEMORY_DE
000147 8147 21CAFF          10      LD  HL,EXTBIO
00014A 814A 36C9            10      LD  (HL),0C9H   ;RET
00014C 814C 23               6      INC HL
00014D 814D 060E             7      LD  B,TRAP38-EXTBIO-1
00014F 814F 3E                      DB  03EH    ;LD A,??
000150 8150 EF              12      RST 28H
000151 8151 CDEEDB          17      CALL    FILL_MEMORY
000154 8154 21AE81          10      LD  HL,AT_TRAP38
000157 8157 11D9FF          10      LD  DE,TRAP38
00015A 815A 012700          10      LD  BC,AT_TRAPE-AT_TRAP38
00015D 815D EDB0                    LDIR
                                
00015F 815F CDC9DA          17      CALL    CHKEY
000162 8162 FE03             7      CP  3
000164 8164 C9              10      RET
                                
       8165                     CHECK_EMM_BPB:
000165 8165 D5              11      PUSH    DE
000166 8166 110000          10      LD  DE,0
000169 8169 CD3AEA          17      CALL    EADR
00016C 816C D1              10      POP DE
00016D 816D ED78            12      IN  A,(C)
00016F 816F C9              10      RET
                                
000170 8170 4155544F45584543    AUTOD:  DB  "AUTOEXEC "
            20                  
000179 8179 413A00              AUTODV: DB  "A:",0
                                
00017C 817C 0C4C53582D446F64    INIMES: DB  00CH,"LSX-Dodgers for MZ-700/1500 v"
            6765727320666F72    
            204D5A2D3730302F    
            313530302076        
00019A 819A 312E                    DB  030H + VER_1, '.'
00019C 819C 3630                    DB  030H + VER_2 ,030H + VER_3
                                ;   DB  ""
00019E 819E 2047616B750D0A          DB  ' Gaku',0DH,0AH
0001A5 81A5 00                      DB  0
                                
       81A6                     M7BEEPD:
0001A6 81A6 0801                    DB  8,1
0001A8 81A8 0736                    DB  7,036H
0001AA 81AA 04F9                    DB  4,0F9H
0001AC 81AC 0403                    DB  4,3
       81AE                     M7BEEPE:
                                
       81AE                     AT_TRAP38:
0001AE FFD9                         ORG TRAP38,AT_TRAP38-OFFSET
0001AE FFD9 210000          10      LD  HL,0
0001B1 FFDC E3              19      EX  (SP),HL
0001B2 FFDD 3E24             7      LD  A,'$'
0001B4 FFDF CD11D7          17      CALL    MSG_A
0001B7 FFE2 2B               6      DEC HL
0001B8 FFE3 7C               4      LD  A,H
0001B9 FFE4 CDE8FF          17      CALL    PRHX
0001BC FFE7 7D               4      LD  A,L
       FFE8                     PRHX:
0001BD FFE8 F5              11      PUSH    AF
0001BE FFE9 07               4      RLCA
0001BF FFEA 07               4      RLCA
0001C0 FFEB 07               4      RLCA
0001C1 FFEC 07               4      RLCA
0001C2 FFED CDF1FF          17      CALL    PRHX2
0001C5 FFF0 F1              10      POP AF
       FFF1                     PRHX2:
0001C6 FFF1 E60F             7      AND 00FH
0001C8 FFF3 FE0A             7      CP  10
0001CA FFF5 3F               4      CCF
0001CB FFF6 CE30             7      ADC A,'0'
0001CD FFF8 27               4      DAA
0001CE FFF9 C311D7          10      JP  MSG_A
0001D1 FFFC                         DS  4
       81D5                         ORG $$+OFFSET   ;$DEPHASE
       81D5                     AT_TRAPE:
                                
       81D5                     INITE:
0001D5 CF06                         ORG BDOS,INITE-OFFSET
                                
0001D5 CF06 C309CF          10      JP  IO_BDOS
[EOF:M7INIT.ASM:SHIFT_JIS]
                                    INCLUDE "M7BANK.ASM"
                                
                                ;   LSX-Dodgers IO
                                ;   MZ-700/1500
                                ;   VRAM/KEY/TIMER(0D000H-0EFFFH)にアクセスするので0D000H-0FFFFHに置けない部分
                                ;
                                
       CF09                     IO_BDOS:
0001D8 CF09 D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
0001DA CF0B C349D4          10      JP  BDOS0
                                
       CF0E                     RDKEYDATA:
0001DD CF0E F3               4      DI
0001DE CF0F D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
0001E0 CF11 3200E0          13      LD  (0E000H),A
0001E3 CF14 3A01E0          13      LD  A,(E001H)
0001E6 CF17 D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
0001E8 CF19 FB               4      EI
       CF1A                     IO_INT8253:
0001E9 CF1A C9              10      RET
                                
       CF1B                     RD556VSYNC:
0001EA CF1B F3               4      DI
0001EB CF1C D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
0001ED CF1E 3A02E0          13      LD  A,(0E002H)
0001F0 CF21 D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
0001F2 CF23 FB               4      EI
0001F3 CF24 C9              10      RET
                                
       CF25                     RDMMIO:
0001F4 CF25 F3               4      DI
0001F5 CF26 D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
0001F7 CF28 7E               7      LD  A,(HL)
0001F8 CF29 D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
0001FA CF2B FB               4      EI
0001FB CF2C C9              10      RET
                                
       CF2D                     WRMMIO:
0001FC CF2D F3               4      DI
0001FD CF2E D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
0001FF CF30 77               7      LD  (HL),A
000200 CF31 D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
000202 CF33 FB               4      EI
000203 CF34 C9              10      RET
                                
       CF35                     RDMMIO_BC:
000204 CF35 F3               4      DI
000205 CF36 D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
000207 CF38 0A               7      LD  A,(BC)
000208 CF39 D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
00020A CF3B FB               4      EI
00020B CF3C C9              10      RET
                                
       CF3D                     WRMMIO_BC:
00020C CF3D F3               4      DI
00020D CF3E D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
00020F CF40 02               7      LD  (BC),A
000210 CF41 D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
000212 CF43 FB               4      EI
000213 CF44 C9              10      RET
                                
       CF45                     IO_PRINT:
000214 CF45 F3               4      DI
000215 CF46 D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
000217 CF48 77               7      LD  (HL),A
000218 CF49 CBDC             8      SET 3,H
00021A CF4B 71               7      LD  (HL),C
00021B CF4C D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
00021D CF4E FB               4      EI
00021E CF4F C9              10      RET
                                
       CF50                     IO_CLR:
00021F CF50 F3               4      DI
000220 CF51 D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
       CF53                     C1AX1:
000222 CF53 7A               4      LD  A,D
000223 CF54 C6D0             7      ADD A,0D0H
000225 CF56 57               4      LD  D,A
000226 CF57 AF               4      XOR A
000227 CF58 12               7      LD  (DE),A      ;Text
000228 CF59 CBDA             8      SET 3,D
       CF5C                     ICSMC   EQU $+1
00022A CF5B 3E00             7      LD  A,0     ;自己書き換え
00022C CF5D 12               7      LD  (DE),A      ;Color
00022D CF5E 13               6      INC DE
00022E CF5F 7A               4      LD  A,D
00022F CF60 D6D8             7      SUB 0D8H
000231 CF62 57               4      LD  D,A
000232 CF63 2118FC          10      LD  HL,0-WIDTH*LINE
000235 CF66 19              11      ADD HL,DE
000236 CF67 30EA            12      JR  NC,C1AX1
000238 CF69 E1              10      POP HL
000239 CF6A D1              10      POP DE
00023A CF6B D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
00023C CF6D FB               4      EI
00023D CF6E C9              10      RET
                                
       CF6F                     IO_CLLINE:
00023E CF6F F3               4      DI
00023F CF70 D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
       CF72                     CLLINE1:
000241 CF72 CB9C             8      RES 3,H
000243 CF74 77               7      LD  (HL),A      ;Text
000244 CF75 CBDC             8      SET 3,H
000246 CF77 71               7      LD  (HL),C      ;Color
000247 CF78 23               6      INC HL
000248 CF79 10F7            13      DJNZ    CLLINE1
00024A CF7B D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
00024C CF7D FB               4      EI
00024D CF7E C9              10      RET
                                
       CF7F                     IO_INS:
00024E CF7F F3               4      DI
00024F CF80 D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
       CF82                     IO_INS1:
000251 CF82 CD99CF          17      CALL    C12S
000254 CF85 23               6      INC HL
000255 CF86 10FA            13      DJNZ    IO_INS1
000257 CF88 D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
000259 CF8A FB               4      EI
00025A CF8B C9              10      RET
                                
       CF8C                     IO_BS:
00025B CF8C F3               4      DI
00025C CF8D D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
       CF8F                     IO_BS1:
00025E CF8F CD99CF          17      CALL    C12S
000261 CF92 2B               6      DEC HL
000262 CF93 10F7            13      DJNZ    IO_BS
000264 CF95 D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
000266 CF97 FB               4      EI
000267 CF98 C9              10      RET
                                
       CF99                     C12S:
000268 CF99 CB9C             8      RES 3,H
00026A CF9B 5E               7      LD  E,(HL)
00026B CF9C 77               7      LD  (HL),A
00026C CF9D 7B               4      LD  A,E
00026D CF9E CBDC             8      SET 3,H
00026F CFA0 5E               7      LD  E,(HL)
000270 CFA1 71               7      LD  (HL),C
000271 CFA2 4B               4      LD  C,E
000272 CFA3 C9              10      RET
                                
       CFA4                     IO_SCRUP:
000273 CFA4 F3               4      DI
000274 CFA5 D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
       CFA7                     SCRUP1:
000276 CFA7 2815            12      JR  Z,SCRCL
000278 CFA9 D5              11      PUSH    DE
000279 CFAA E5              11      PUSH    HL
00027A CFAB CBDA             8      SET 3,D
00027C CFAD CBDC             8      SET 3,H
00027E CFAF 012800          10      LD  BC,WIDTH
000281 CFB2 EDB0                    LDIR
000283 CFB4 E1              10      POP HL
000284 CFB5 D1              10      POP DE
000285 CFB6 012800          10      LD  BC,WIDTH
000288 CFB9 EDB0                    LDIR
00028A CFBB 3D               4      DEC A
00028B CFBC 18E9            12      JR  SCRUP1
                                
       CFBE                     SCRCL:
00028D CFBE 0628             7      LD  B,WIDTH
00028F CFC0 EB               4      EX  DE,HL
000290 CFC1 D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
000292 CFC3 CD07D9          17      CALL    CLLINE
000295 CFC6 E1              10      POP HL
000296 CFC7 D1              10      POP DE
000297 CFC8 C1              10      POP BC
000298 CFC9 C9              10      RET
                                
       CFCA                     RD_PCG:
000299 CFCA F3               4      DI
00029A CFCB D3E5            11      OUT (0E5H),A    ;MZ-1500: PCGバンク切り替え
00029C CFCD 4E               7      LD  C,(HL)
       CFCE                     RW_PCG:
00029D CFCE D3E6            11      OUT (0E6H),A    ;MZ-1500: PCGバンクを閉じる
00029F CFD0 FB               4      EI
0002A0 CFD1 C9              10      RET
                                
       CFD2                     WR_PCG:
0002A1 CFD2 F3               4      DI
0002A2 CFD3 D3E5            11      OUT (0E5H),A    ;MZ-1500: PCGバンク切り替え
0002A4 CFD5 71               7      LD  (HL),C
0002A5 CFD6 18F6            12      JR  RW_PCG
                                
       CFD8                     C_MON:
0002A7 CFD8 D3E4            11      OUT (0E4H),A    ;MONITOR ROM(0000H-0FFFH) & VRAM/KEY/TIMER(D000H-FFFFH)
0002A9 CFDA C7              12      RST 0
                                
       CFDB                     BANKE:
0002AA CFDB                         DS  0CFFEH-BANKE
[EOF:M7BANK.ASM:SHIFT_JIS]
                                    INCLUDE "M7CCP.ASM"
                                
                                ;   LSX-Dodgers CCP
                                ;   MZ-700/1500
                                
       CFFE                     WBOOT1:
0002CD CFFE D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)　ここは0CFFEH
0002CF D000 D3E0            11      OUT (0E0H),A    ;DRAM(0000H-0FFHH)
0002D1 D002 F3               4      DI
0002D2 D003 3A94F0          13      LD  A,(_KEYSP)
0002D5 D006 ED7B0600        20      LD  SP,(SYSTEM+1)
0002D9 D00A FB               4      EI
0002DA D00B 2192F0          10      LD  HL,_KEYD
0002DD D00E 3600            10      LD  (HL),0
0002DF D010 CDC9DA          17      CALL    CHKEY
0002E2 D013 CD0DD7          17      CALL    KEYBC_IFBREAK
0002E5 D016 3E04             7      LD  A,4
0002E7 D018 CD11D7          17      CALL    MSG_A
[EOF:M7CCP.ASM:UTF_8]
                                    INCLUDE "LDCCP.ASM"
                                
                                ;   LSX-Dodgers CCP
                                
       D01B                     COMMAND:
0002EA D01B 3A38EB          13      LD  A,(FCB_BAT)
0002ED D01E B7               4      OR  A
0002EE D01F C261D1          10      JP  NZ,C_BAT1
0002F1 D022 CDD5D0          17      CALL    SETDTA1
0002F4 D025 3A87F0          13      LD  A,(_DVSW)
0002F7 D028 C641             7      ADD A,'A'
0002F9 D02A CD11D7          17      CALL    MSG_A
0002FC D02D 3E3E             7      LD  A,'>'
0002FE D02F CD11D7          17      CALL    MSG_A
000301 D032 3E50             7      LD  A,80
000303 D034 12               7      LD  (DE),A
000304 D035 CD6DD7          17      CALL    _SYS0A      ;(BDOS)文字列入力
000307 D038 CD56D2          17      CALL    LTNL
       D03B                     COMMAND2:
00030A D03B 118200          10      LD  DE,DTA1+2
00030D D03E CDFDF0          17      CALL    _COMANL
000310 D041 30D8            12      JR  NC,COMMAND
000312 D043 1179F0          10      LD  DE,COMERM
000315 D046 CD7BD4          17      CALL    _SYS09      ;(BDOS)文字列出力
000318 D049 C7              12      RST 0
                                
       D04A                     COMANL:
000319 D04A CD42DB          17      CALL    FILE
00031C D04D 3A19F0          13      LD  A,(FNAME+4)
00031F D050 FE20             7      CP  020H
000321 D052 201C            12      JR  NZ,COMB2
000323 D054 D5              11      PUSH    DE
000324 D055 1115F0          10      LD  DE,FNAME
000327 D058 1A               7      LD  A,(DE)
000328 D059 FE20             7      CP  020H
00032A D05B 2844            12      JR  Z,SDVSW
00032C D05D 1B               6      DEC DE
00032D D05E 1A               7      LD  A,(DE)
00032E D05F C6FF             7      ADD A,0FFH
000330 D061 3809            12      JR  C,COMB
000332 D063 13               6      INC DE
                                
000333 D064 2113D4          10      LD  HL,COMTB
000336 D067 0609             7      LD  B,COMS
000338 D069 CDD1DD          17      CALL    CPNAME
       D06C                     COMB:
00033B D06C D1              10      POP DE
00033C D06D D20F00          10      JP  NC,JP_HL
       D070                     COMB2:
00033F D070 EB               4      EX  DE,HL
000340 D071 223ED1          16      LD  (COMSWC),HL
000343 D074 F5              11      PUSH    AF
000344 D075 CDF6D0          17      CALL    CEXE4
000347 D078 F1              10      POP AF
000348 D079 2115F0          10      LD  HL,FNAME
00034B D07C 116D00          10      LD  DE,FCB2+1   ;COMMAND NAME
00034E D07F 010B00          10      LD  BC,11
000351 D082 EDB0                    LDIR
000353 D084 11D7EA          10      LD  DE,PATHD
       D087                     CEX1:
000356 D087 1A               7      LD  A,(DE)
000357 D088 FE20             7      CP  020H
000359 D08A D8              11      RET C
00035A D08B CD37DB          17      CALL    FILEC
00035D D08E D5              11      PUSH    DE
00035E D08F 216D00          10      LD  HL,FCB2+1   ;COMMAND NAME
000361 D092 1115F0          10      LD  DE,FNAME
000364 D095 010B00          10      LD  BC,11
000367 D098 EDB0                    LDIR
000369 D09A CDF6D0          17      CALL    CEXE4
00036C D09D D1              10      POP DE
00036D D09E 13               6      INC DE
00036E D09F 18E6            12      JR  CEX1
                                
       D0A1                     SDVSW:
000370 D0A1 F1              10      POP AF
000371 D0A2 3A14F0          13      LD  A,(FDRV)
000374 D0A5 3D               4      DEC A
000375 D0A6 5F               4      LD  E,A
000376 D0A7 0E0E             7      LD  C,00EH      ;(BDOS)カレントドライブの設定
000378 D0A9 1831            12      JR  SYSTEM0
                                
       D0AB                     OPEN1:
00037A D0AB 2114F0          10      LD  HL,FDRV
       D0AE                     OPEN:
00037D D0AE 0E11             7      LD  C,011H      ;(BDOS)ファイルの検索
       D0B0                     OPEN3:
00037F D0B0 D5              11      PUSH    DE
000380 D0B1 1113EB          10      LD  DE,DTA_CCP
000383 D0B4 CDD2D0          17      CALL    SETDTA
000386 D0B7 EB               4      EX  DE,HL
000387 D0B8 CDDCD0          17      CALL    SYSTEM0
00038A D0BB D1              10      POP DE
00038B D0BC C9              10      RET
                                
       D0BD                     OPEN2:
00038C D0BD 0E12             7      LD  C,012H
00038E D0BF 18EF            12      JR  OPEN3
                                
       D0C1                     DEFCB:              ;Z=Ok NZ=Error
000390 D0C1 1113EB          10      LD  DE,DTA_CCP
000393 D0C4 CDDAD0          17      CALL    SYSC0F
                                
000396 D0C7 1134EB          10      LD  DE,DTA_CCP+33   ;(FCB)ランダムレコード
000399 D0CA 0604             7      LD  B,4
00039B D0CC CD27D3          17      CALL    ZERO_MEMORY_DE
       D0CF                     SETDTA100:
00039E D0CF 110001          10      LD  DE,00100H
       D0D2                     SETDTA:
0003A1 D0D2 C34ED6          10      JP  _SYS1A      ;(BDOS)DTAの設定
                                
       D0D5                     SETDTA1:
0003A4 D0D5 118000          10      LD  DE,DTA1
0003A7 D0D8 18F8            12      JR  SETDTA
                                
       D0DA                     SYSC0F:
0003A9 D0DA 0E0F             7      LD  C,00FH      ;(BDOS)ファイルのオープン
       D0DC                     SYSTEM0:
0003AB D0DC CD0500          17      CALL    SYSTEM
0003AE D0DF B7               4      OR  A
0003AF D0E0 C9              10      RET
                                
       D0E1                     C_CD:
0003B0 D0E1 0E5A             7      LD  C,05AH
0003B2 D0E3 18F7            12      JR  SYSTEM0
                                
       D0E5                     S27BUF:
0003B4 D0E5 2100FE          10      LD  HL,-00200H  ;スクラッチエリア(0100H)+スタック予備(0100H)
0003B7 D0E8 39              11      ADD HL,SP
0003B8 D0E9 2E00             7      LD  L,0
0003BA D0EB 7C               4      LD  A,H
0003BB D0EC E6F8             7      AND 0F8H
0003BD D0EE 67               4      LD  H,A
       D0EF                     S27DTA:
0003BE D0EF 1113EB          10      LD  DE,DTA_CCP
       D0F2                     S27:
0003C1 D0F2 0E27             7      LD  C,027H      ;(BDOS)ランダムブロック読み込み
0003C3 D0F4 18E6            12      JR  SYSTEM0
                                
       D0F6                     CEXE4:
0003C5 D0F6 211DF0          10      LD  HL,FNAME+8
0003C8 D0F9 7E               7      LD  A,(HL)
0003C9 D0FA FE20             7      CP  020H
0003CB D0FC 2007            12      JR  NZ,CEXE7
0003CD D0FE 3E3F             7      LD  A,'?'
0003CF D100 77               7      LD  (HL),A
0003D0 D101 23               6      INC HL
0003D1 D102 77               7      LD  (HL),A
0003D2 D103 23               6      INC HL
0003D3 D104 77               7      LD  (HL),A
       D105                     CEXE7:
0003D4 D105 CDABD0          17      CALL    OPEN1
       D108                     CEXE5:
0003D7 D108 C0              11      RET NZ
0003D8 D109 2A1DEB          16      LD  HL,(DTA_CCP+1+9)
0003DB D10C 7C               4      LD  A,H
0003DC D10D CD59DE          17      CALL    CAP
0003DF D110 67               4      LD  H,A
0003E0 D111 7D               4      LD  A,L
0003E1 D112 CD59DE          17      CALL    CAP
0003E4 D115 6F               4      LD  L,A
0003E5 D116 3A1CEB          13      LD  A,(DTA_CCP+1+8)
0003E8 D119 CD59DE          17      CALL    CAP
0003EB D11C D642             7      SUB 'B'
0003ED D11E 282C            12      JR  Z,C_BAT
0003EF D120 3D               4      DEC A       ;'C'
0003F0 D121 2805            12      JR  Z,C_EXE
       D123                     CEXE6:
0003F2 D123 CDBDD0          17      CALL    OPEN2
0003F5 D126 18E0            12      JR  CEXE5
                                
       D128                     C_EXE:
0003F7 D128 7C               4      LD  A,H
0003F8 D129 FE4D             7      CP  'M'
0003FA D12B 20F6            12      JR  NZ,CEXE6
                                
0003FC D12D CDC1D0          17      CALL    DEFCB
0003FF D130 CDE5D0          17      CALL    S27BUF
000402 D133 3D               4      DEC A
000403 D134 37               4      SCF
000404 D135 C0              11      RET NZ
000405 D136 7C               4      LD  A,H
000406 D137 B5               4      OR  L
000407 D138 37               4      SCF
000408 D139 C8              11      RET Z
000409 D13A CDD5D0          17      CALL    SETDTA1
00040C D13D 110000          10      LD  DE,0                ; self-modifying code
       D13E                     COMSWC  EQU $-2
00040F D140 ED7B0600        20      LD  SP,(SYSTEM+1)
000413 D144 67               4      LD  H,A             ; A=0 in SETDTA1(_SYS1A)
000414 D145 6F               4      LD  L,A
000415 D146 E5              11      PUSH    HL              ; push $0000 (reboot address)
000416 D147 24               4      INC H
000417 D148 E5              11      PUSH    HL              ; push $0100 (TPA address)
000418 D149 C3F2D2          10      JP  SETFCB              ; and JP $0100
                                
       D14C                     C_BAT:
00041B D14C 114154          10      LD  DE,'A'+'T'*256
00041E D14F ED52            15      SBC HL,DE
000420 D151 20D0            12      JR  NZ,CEXE6
                                
000422 D153 CDC1D0          17      CALL    DEFCB
                                
000425 D156 2113EB          10      LD  HL,DTA_CCP
000428 D159 1138EB          10      LD  DE,FCB_BAT
00042B D15C 012500          10      LD  BC,37
00042E D15F EDB0                    LDIR
       D161                     C_BAT1:
000430 D161 CDCFD0          17      CALL    SETDTA100
000433 D164 CD98D1          17      CALL    FGETC_BAT
000436 D167 218100          10      LD  HL,DTA1+1
000439 D16A 2025            12      JR  NZ,END_BATCH
00043B D16C FE21             7      CP  021H        ;スペースや改行など制御文字を飛ばす
00043D D16E 38F1            12      JR  C,C_BAT1
00043F D170 3620            10      LD  (HL),' '
000441 D172 23               6      INC HL
       D173                     C_BAT2:
000442 D173 77               7      LD  (HL),A
000443 D174 23               6      INC HL
000444 D175 7D               4      LD  A,L
000445 D176 3C               4      INC A       ;L==0FFH
000446 D177 2809            12      JR  Z,RUN_BATCH
000448 D179 CD98D1          17      CALL    FGETC_BAT
00044B D17C 2004            12      JR  NZ,RUN_BATCH
00044D D17E FE20             7      CP  020H
00044F D180 30F1            12      JR  NC,C_BAT2
       D182                     RUN_BATCH:
000451 D182 7D               4      LD  A,L
000452 D183 D67F             7      SUB DTA1-1
000454 D185 328000          13      LD  (DTA1),A
000457 D188 FE04             7      CP  4
000459 D18A 3805            12      JR  C,END_BATCH
00045B D18C 3600            10      LD  (HL),0
00045D D18E C33BD0          10      JP  COMMAND2
       D191                     END_BATCH:
000460 D191 AF               4      XOR A       ;バッチファイルを閉じる
000461 D192 3238EB          13      LD  (FCB_BAT),A
000464 D195 C300F0          10      JP  CPM_BOOT
                                
       D198                     FGETC_BAT:
000467 D198 1138EB          10      LD  DE,FCB_BAT
       D19B                     FGETC:              ;1文字ずつ読み込む
00046A D19B E5              11      PUSH    HL      ;Z:成功
00046B D19C 210100          10      LD  HL,1
00046E D19F CDF2D0          17      CALL    S27
000471 D1A2 E1              10      POP HL
000472 D1A3 3A0001          13      LD  A,(00100H)
000475 D1A6 C9              10      RET
                                
       D1A7                     C_DEL:
000476 D1A7 CDF2D2          17      CALL    SETFCB
000479 D1AA CD27D7          17      CALL    _SYS08      ;(BDOS)エコーなしコンソール入力
                                
00047C D1AD 0E13             7      LD  C,013H
00047E D1AF 180A            12      JR  CDEL1       ;(BDOS)ファイルの削除
                                
       D1B1                     C_REN:
000480 D1B1 CDF2D2          17      CALL    SETFCB
000483 D1B4 3E10             7      LD  A,010H      ;ディレクトリも対象にする
000485 D1B6 326900          13      LD  (FCB1+13),A ;属性
000488 D1B9 0E17             7      LD  C,017H      ;(BDOS)ファイル名の変更
       D1BB                     CDEL1:
00048A D1BB 115C00          10      LD  DE,FCB1
00048D D1BE CD0500          17      CALL    SYSTEM
000490 D1C1 C6FF             7      ADD A,0FFH
000492 D1C3 C9              10      RET
                                
       D1C4                     C_DIR:
000493 D1C4 CD37DB          17      CALL    FILEC
000496 D1C7 2115F0          10      LD  HL,FDRV+1
000499 D1CA CD08D4          17      CALL    CWILD1
00049C D1CD 3EF1             7      LD  A,0F1H
00049E D1CF 3221F0          13      LD  (FDRV+13),A
0004A1 D1D2 CDABD0          17      CALL    OPEN1
       D1D5                     CDIR1:
0004A4 D1D5 B7               4      OR  A
0004A5 D1D6 2008            12      JR  NZ,PDSKF
0004A7 D1D8 CD23D2          17      CALL    P_NAME
0004AA D1DB CDBDD0          17      CALL    OPEN2
0004AD D1DE 18F5            12      JR  CDIR1
       D1E0                     PDSKF:
0004AF D1E0 3A14F0          13      LD  A,(FDRV)
0004B2 D1E3 5F               4      LD  E,A
0004B3 D1E4 0E1B             7      LD  C,01BH      ;(BDOS)ディスク情報の獲得
0004B5 D1E6 CD0500          17      CALL    SYSTEM
0004B8 D1E9 4F               4      LD  C,A     ;C←1クラスタ辺りの論理セクタ数
0004B9 D1EA C601             7      ADD A,001H
0004BB D1EC D8              11      RET C       ;Aが0FFHだった場合
0004BC D1ED 3E06             7      LD  A,8-2
       D1EF                     PDS1:               ;HL=未使用クラスタの総数
0004BE D1EF 3C               4      INC A
0004BF D1F0 CB19             8      RR  C
0004C1 D1F2 30FB            12      JR  NC,PDS1
       D1F4                     PDS2:               ;B←論理セクタのサイズの上位8ビット
0004C3 D1F4 3C               4      INC A
0004C4 D1F5 CB18             8      RR  B
0004C6 D1F7 30FB            12      JR  NC,PDS2
0004C8 D1F9 47               4      LD  B,A
                                
0004C9 D1FA 110000          10      LD  DE,0
       D1FD                     PDS3:
0004CC D1FD 29              11      ADD HL,HL
0004CD D1FE EB               4      EX  DE,HL
0004CE D1FF ED6A            15      ADC HL,HL
0004D0 D201 EB               4      EX  DE,HL
0004D1 D202 10F9            13      DJNZ    PDS3
       D204                     PDSKF1:
0004D3 D204 CD90D2          17      CALL    PRDEC_DEHL
0004D6 D207 1168EB          10      LD  DE,FREE
0004D9 D20A CD7BD4          17      CALL    _SYS09      ;(BDOS)文字列出力
0004DC D20D CD7DD2          17      CALL    PUTDRV
0004DF D210 3E5C             7      LD  A,05CH      ;\
0004E1 D212 CD11D7          17      CALL    MSG_A
0004E4 D215 2A22F0          16      LD  HL,(FDRV+14)    ;ディレクトリのクラスタ番号
0004E7 D218 AF               4      XOR A
0004E8 D219 11FEFF          10      LD  DE,0-2
0004EB D21C 19              11      ADD HL,DE
0004EC D21D 23               6      INC HL
0004ED D21E DC8DD2          17      CALL    C,PRDEC_HL
0004F0 D221 1833            12      JR  LTNL
                                
       D223                     P_NAME:
0004F2 D223 3A14EB          13      LD  A,(DTA_CCP+1)
0004F5 D226 FE2E             7      CP  '.'
0004F7 D228 C8              11      RET Z
                                
0004F8 D229 3A1FEB          13      LD  A,(DTA_CCP+1+00BH)
0004FB D22C F5              11      PUSH    AF
0004FC D22D CB67             8      BIT 4,A
0004FE D22F 2808            12      JR  Z,DIR3
000500 D231 115DEB          10      LD  DE,DIRMES
000503 D234 CD7BD4          17      CALL    _SYS09      ;(BDOS)文字列出力
000506 D237 180A            12      JR  DIR6
       D239                     DIR3:
000508 D239 ED5B32EB        20      LD  DE,(DTA_CCP+1+01EH)
00050C D23D 2A30EB          16      LD  HL,(DTA_CCP+1+01CH)
00050F D240 CD90D2          17      CALL    PRDEC_DEHL
       D243                     DIR6:
000512 D243 F1              10      POP AF
000513 D244 0F               4      RRCA
000514 D245 9F               4      SBC A,A
000515 D246 E60A             7      AND '*'-020H
000517 D248 C620             7      ADD A,020H
000519 D24A CD11D7          17      CALL    MSG_A
00051C D24D CD7DD2          17      CALL    PUTDRV
00051F D250 2114EB          10      LD  HL,DTA_CCP+1
000522 D253 CDD0D2          17      CALL    FPRNT
                                
       D256                     LTNL:
000525 D256 1E03             7      LD  E,3
000527 D258 C3CDF0          10      JP  _PRINT
                                
       D25B                     C_PATH:
00052A D25B CD19DC          17      CALL    SPCUT
00052D D25E 21D7EA          10      LD  HL,PATHD
000530 D261 FE21             7      CP  021H
000532 D263 300C            12      JR  NC,CPATH0
       D265                     CPATHP:
000534 D265 7E               7      LD  A,(HL)
000535 D266 23               6      INC HL
000536 D267 FE20             7      CP  020H
000538 D269 3F               4      CCF
000539 D26A 30EA            12      JR  NC,LTNL
00053B D26C CD11D7          17      CALL    MSG_A
00053E D26F 18F4            12      JR  CPATHP
       D271                     CPATH0:
000540 D271 FE3B             7      CP  ';'
000542 D273 2001            12      JR  NZ,CPATH1
000544 D275 13               6      INC DE
       D276                     CPATH1:
000545 D276 EB               4      EX  DE,HL
000546 D277 013B00          10      LD  BC,PATHX
000549 D27A EDB0                    LDIR
00054B D27C C9              10      RET
                                
       D27D                     PUTDRV:
00054C D27D 3A14F0          13      LD  A,(FDRV)
00054F D280 CD4CDC          17      CALL    GETDRV1
000552 D283 C641             7      ADD A,'A'
000554 D285 CD11D7          17      CALL    MSG_A
000557 D288 3E3A             7      LD  A,':'
       D28A                     MSG_AR:
000559 D28A C311D7          10      JP  MSG_A
                                
       D28D                     PRDEC_HL:
00055C D28D AF               4      XOR A
00055D D28E 5F               4      LD  E,A
00055E D28F 57               4      LD  D,A
       D290                     PRDEC_DEHL:
00055F D290 D5              11      PUSH    DE
000560 D291 110FF0          10      LD  DE,DECBF
000563 D294 0605             7      LD  B,5
000565 D296 CD27D3          17      CALL    ZERO_MEMORY_DE  ;A=0
000568 D299 D1              10      POP DE
                                
000569 D29A 0E20             7      LD  C,32
       D29C                     DEC1:
00056B D29C 29              11      ADD HL,HL
00056C D29D EB               4      EX  DE,HL
00056D D29E ED6A            15      ADC HL,HL
00056F D2A0 EB               4      EX  DE,HL
000570 D2A1 E5              11      PUSH    HL
000571 D2A2 2113F0          10      LD  HL,DECBF+4
000574 D2A5 0605             7      LD  B,5
       D2A7                     DEC2:
000576 D2A7 7E               7      LD  A,(HL)
000577 D2A8 8F               4      ADC A,A
000578 D2A9 27               4      DAA
000579 D2AA 77               7      LD  (HL),A
00057A D2AB 2B               6      DEC HL
00057B D2AC 10F9            13      DJNZ    DEC2
00057D D2AE E1              10      POP HL
00057E D2AF 0D               4      DEC C
00057F D2B0 20EA            12      JR  NZ,DEC1
                                
000581 D2B2 210FF0          10      LD  HL,DECBF
000584 D2B5 3E20             7      LD  A,020H
000586 D2B7 0604             7      LD  B,4
       D2B9                     DEC3:
000588 D2B9 CDC6D2          17      CALL    DEC4
00058B D2BC CDC6D2          17      CALL    DEC4
00058E D2BF 23               6      INC HL
00058F D2C0 10F7            13      DJNZ    DEC3
       D2C2                     DECX:
000591 D2C2 CDC6D2          17      CALL    DEC4
000594 D2C5 AF               4      XOR A
       D2C6                     DEC4:
000595 D2C6 ED6F            18      RLD
000597 D2C8 FE20             7      CP  020H
000599 D2CA 2802            12      JR  Z,DEC5
00059B D2CC F630             7      OR  030H
       D2CE                     DEC5:
00059D D2CE 18BA            12      JR  MSG_AR
                                
       D2D0                     FPRNT:
00059F D2D0 0608             7      LD  B,8 ;ファイル名を表示
0005A1 D2D2 CDE1D2          17      CALL    P_N1
0005A4 D2D5 7E               7      LD  A,(HL)
0005A5 D2D6 CD65DE          17      CALL    CAP3
0005A8 D2D9 D8              11      RET C   ;拡張子が無い
                                
0005A9 D2DA 3E2E             7      LD  A,'.'
0005AB D2DC CD11D7          17      CALL    MSG_A
0005AE D2DF 0603             7      LD  B,3 ;拡張子を表示
       D2E1                     P_N1:
0005B0 D2E1 7E               7      LD  A,(HL)
0005B1 D2E2 CD65DE          17      CALL    CAP3
0005B4 D2E5 3807            12      JR  C,P_N2
0005B6 D2E7 CD11D7          17      CALL    MSG_A
0005B9 D2EA 23               6      INC HL
0005BA D2EB 10F4            13      DJNZ    P_N1
0005BC D2ED C9              10      RET
       D2EE                     P_N2:
0005BD D2EE 23               6      INC HL
0005BE D2EF 10FD            13      DJNZ    P_N2
0005C0 D2F1 C9              10      RET
                                
       D2F2                     SETFCB:
0005C1 D2F2 CD19DC          17      CALL    SPCUT
0005C4 D2F5 1A               7      LD  A,(DE)
0005C5 D2F6 FE20             7      CP  020H
0005C7 D2F8 3801            12      JR  C,SETFCBA
0005C9 D2FA 1B               6      DEC DE
       D2FB                     SETFCBA:
0005CA D2FB 0624             7      LD  B,36
0005CC D2FD 215C00          10      LD  HL,FCB1
0005CF D300 E5              11      PUSH    HL
0005D0 D301 AF               4      XOR A
0005D1 D302 CDEEDB          17      CALL    FILL_MEMORY
0005D4 D305 E1              10      POP HL
0005D5 D306 D5              11      PUSH    DE
0005D6 D307 CDB4D6          17      CALL    _SYS29      ;(BDOS)ファイル名の解析
0005D9 D30A 216C00          10      LD  HL,FCB2
0005DC D30D CDB4D6          17      CALL    _SYS29      ;(BDOS)ファイル名の解析
0005DF D310 E1              10      POP HL
0005E0 D311 010050          10      LD  BC,05000H
0005E3 D314 118100          10      LD  DE,00081H
       D317                     SETFCB1:
0005E6 D317 7E               7      LD  A,(HL)
0005E7 D318 23               6      INC HL
0005E8 D319 FE20             7      CP  020H
0005EA D31B 3805            12      JR  C,SETFCB2
0005EC D31D 12               7      LD  (DE),A
0005ED D31E 13               6      INC DE
0005EE D31F 0C               4      INC C
0005EF D320 10F5            13      DJNZ    SETFCB1
       D322                     SETFCB2:
0005F1 D322 79               4      LD  A,C
0005F2 D323 328000          13      LD  (DTA1),A
0005F5 D326 04               4      INC B
       D327                     ZERO_MEMORY_DE:
0005F6 D327 AF               4      XOR A
       D328                     FILL_MEMORY_DE:
0005F7 D328 12               7      LD  (DE),A
0005F8 D329 13               6      INC DE
0005F9 D32A 10FC            13      DJNZ    FILL_MEMORY_DE
0005FB D32C C9              10      RET
                                
       D32D                     C_COPY:
0005FC D32D CDF2D2          17      CALL    SETFCB
                                
0005FF D330 1161F0          10      LD  DE,ZERO
000602 D333 CD3ADB          17      CALL    FILEC2
000605 D336 216C00          10      LD  HL,FCB2
000608 D339 CDBBD6          17      CALL    S29X1
                                
00060B D33C 3E10             7      LD  A,010H
00060D D33E 326900          13      LD  (FCB1+13),A
000610 D341 216D00          10      LD  HL,FCB2+1
000613 D344 CD08D4          17      CALL    CWILD1
       D347                     COPY0:
000616 D347 CD05D4          17      CALL    CWILD
000619 D34A 215C00          10      LD  HL,FCB1
00061C D34D CDAED0          17      CALL    OPEN
00061F D350 37               4      SCF
       D351                     COPY1:
000620 D351 C0              11      RET NZ
000621 D352 CDC1D0          17      CALL    DEFCB
                                
000624 D355 3A20EB          13      LD  A,(DTA_CCP+13)
000627 D358 CB67             8      BIT 4,A
000629 D35A 2821            12      JR  Z,COPY1A
                                
00062B D35C 215D00          10      LD  HL,FCB1+1
00062E D35F CD7DDF          17      CALL    CHKWILD
000631 D362 3814            12      JR  C,COPY9
                                
000633 D364 3E20             7      LD  A,020H
000635 D366 325D00          13      LD  (FCB1+1),A
000638 D369 2A2DEB          16      LD  HL,(DTA_CCP+26)
00063B D36C 23               6      INC HL
00063C D36D 226A00          16      LD  (FCB1+14),HL
00063F D370 18D5            12      JR  COPY0
                                
       D372                     COPY8:
000641 D372 CD7BD4          17      CALL    _SYS09      ;(BDOS)文字列出力
000644 D375 CD56D2          17      CALL    LTNL
       D378                     COPY9:
000647 D378 CDBDD0          17      CALL    OPEN2
00064A D37B 18D4            12      JR  COPY1
                                
       D37D                     COPY1A:
00064C D37D 216C00          10      LD  HL,FCB2
00064F D380 1114F0          10      LD  DE,FDRV
000652 D383 0115EB          10      LD  BC,DTA_CCP+2
000655 D386 EDA0            16      LDI
000657 D388 3E0B             7      LD  A,11
       D38A                     COPY2:
000659 D38A F5              11      PUSH    AF
00065A D38B 7E               7      LD  A,(HL)
00065B D38C FE3F             7      CP  '?'
00065D D38E 2001            12      JR  NZ,COPY3
00065F D390 0A               7      LD  A,(BC)
       D391                     COPY3:
000660 D391 12               7      LD  (DE),A
000661 D392 03               6      INC BC
000662 D393 13               6      INC DE
000663 D394 23               6      INC HL
000664 D395 F1              10      POP AF
000665 D396 3D               4      DEC A
000666 D397 20F1            12      JR  NZ,COPY2
000668 D399 010500          10      LD  BC,16-11
00066B D39C EDB0                    LDIR
       D39E                     PUTNAME:
00066D D39E 215D00          10      LD  HL,FCB1+1
000670 D3A1 CD7DDF          17      CALL    CHKWILD
000673 D3A4 300B            12      JR  NC,PUTN1
000675 D3A6 2115F0          10      LD  HL,FDRV+1
000678 D3A9 CDD0D2          17      CALL    FPRNT
00067B D3AC 3E20             7      LD  A,020H
00067D D3AE CD11D7          17      CALL    MSG_A
       D3B1                     PUTN1:
000680 D3B1 1114F0          10      LD  DE,FDRV
000683 D3B4 0E16             7      LD  C,016H      ;(BDOS)ファイルの作成
000685 D3B6 CDDCD0          17      CALL    SYSTEM0
000688 D3B9 2048            12      JR  NZ,COPYE2
00068A D3BB 67               4      LD  H,A     ;A=0
00068B D3BC 6F               4      LD  L,A
00068C D3BD 2235F0          16      LD  (FDRV+33),HL    ;(FCB)ランダムレコード
00068F D3C0 2237F0          16      LD  (FDRV+35),HL
       D3C3                     COPY6:
000692 D3C3 CDE5D0          17      CALL    S27BUF
000695 D3C6 47               4      LD  B,A
000696 D3C7 3C               4      INC A
000697 D3C8 2831            12      JR  Z,COPYE
000699 D3CA 7C               4      LD  A,H
00069A D3CB B5               4      OR  L
00069B D3CC 280C            12      JR  Z,COPY7
00069D D3CE 1114F0          10      LD  DE,FDRV
0006A0 D3D1 0E26             7      LD  C,026H      ;(BDOS)ランダムブロック書き込み
0006A2 D3D3 CDDCD0          17      CALL    SYSTEM0
0006A5 D3D6 2023            12      JR  NZ,COPYE
0006A7 D3D8 10E9            13      DJNZ    COPY6
       D3DA                     COPY7:
0006A9 D3DA 3A20EB          13      LD  A,(DTA_CCP+13)  ;(FCB)属性
0006AC D3DD 3221F0          13      LD  (FDRV+13),A
0006AF D3E0 2127EB          10      LD  HL,DTA_CCP+20   ;(FCB)タイムスタンプ
0006B2 D3E3 1128F0          10      LD  DE,FDRV+20
0006B5 D3E6 010400          10      LD  BC,4
0006B8 D3E9 EDB0                    LDIR
                                
0006BA D3EB 1114F0          10      LD  DE,FDRV
0006BD D3EE 0E10             7      LD  C,010H      ;(BDOS)ファイルのクローズ
0006BF D3F0 CDDCD0          17      CALL    SYSTEM0
0006C2 D3F3 2006            12      JR  NZ,COPYE
                                
0006C4 D3F5 1171F0          10      LD  DE,OK
0006C7 D3F8 C372D3          10      JP  COPY8
                                
       D3FB                     COPYE:
0006CA D3FB 1114F0          10      LD  DE,FDRV
0006CD D3FE 0E13             7      LD  C,013H      ;(BDOS)ファイルの削除
0006CF D400 CD0500          17      CALL    SYSTEM
       D403                     COPYE2:
0006D2 D403 37               4      SCF
0006D3 D404 C9              10      RET
                                
       D405                     CWILD:
0006D4 D405 215D00          10      LD  HL,FCB1+1
       D408                     CWILD1:
0006D7 D408 7E               7      LD  A,(HL)
0006D8 D409 FE20             7      CP  020H
0006DA D40B C0              11      RET NZ
       D40C                     CWILD2:
0006DB D40C 3E3F             7      LD  A,'?'
0006DD D40E 060B             7      LD  B,11
0006DF D410 C3EEDB          10      JP  FILL_MEMORY
                                
       D413                     COMTB:
0006E2 D413 44202020                DB  "D   "  ;1
0006E6 D417 C4D1                    DW  C_DIR
0006E8 D419 44495220                DB  "DIR "  ;2
0006EC D41D C4D1                    DW  C_DIR
0006EE D41F 434F5059                DB  "COPY"  ;3
0006F2 D423 2DD3                    DW  C_COPY
0006F4 D425 43442020                DB  "CD  "  ;4
0006F8 D429 E1D0                    DW  C_CD
0006FA D42B 44454C20                DB  "DEL "  ;5
0006FE D42F A7D1                    DW  C_DEL
000700 D431 50415448                DB  "PATH"  ;6
000704 D435 5BD2                    DW  C_PATH
000706 D437 52454E20                DB  "REN "  ;7
00070A D43B B1D1                    DW  C_REN
00070C D43D 52454D20                DB  "REM "  ;8
000710 D441 78D4                    DW  C_REM
[EOF:LDCCP.ASM:SHIFT_JIS]
                                    INCLUDE "M7CCP2.ASM"
                                
                                ;   LSX-Dodgers CCP2
                                ;   MZ-700/1500
                                
000712 D443 4D4F4E20                DB  "MON "  ;10
000716 D447 D8CF                    DW  C_MON
[EOF:M7CCP2.ASM:UTF_8]
                                    INCLUDE "LDOS.ASM"
                                
                                ;   LSX-Dodgers OS
                                
       D449                     BDOS0:
000718 D449 E5              11      PUSH    HL
000719 D44A 79               4      LD  A,C
00071A D44B FE3C             7      CP  03CH
00071C D44D 3802            12      JR  C,DOS1
00071E D44F 3E3C             7      LD  A,03CH
       D451                     DOS1:
000720 D451 87               4      ADD A,A
000721 D452 6F               4      LD  L,A
000722 D453 26F1             7      LD  H,STABLE/256
000724 D455 7E               7      LD  A,(HL)
000725 D456 2C               4      INC L
000726 D457 66               7      LD  H,(HL)
000727 D458 6F               4      LD  L,A
000728 D459 E3              19      EX  (SP),HL
000729 D45A 79               4      LD  A,C
                                ;確認用
                                ;   LD  (0050H),A
00072A D45B C9              10      RET
       D45C                     _DOS2:
00072B D45C FE5A             7      CP  05AH        ;(BDOS)カレントディレクトリの変更(_CHDIR)
00072D D45E CAF6D6          10      JP  Z,_SYS5A
000730 D461 FE5C             7      CP  05CH        ;(BDOS)ファイル名の解析(_PFILE)
000732 D463 CAB4D6          10      JP  Z,_SYS29
000735 D466 FE5F             7      CP  05FH        ;(BDOS)ディスクバッファのフラッシュ(_FLUSH)
000737 D468 CA8AE8          10      JP  Z,_SYS5F
00073A D46B FE6F             7      CP  06FH        ;(BDOS)MSX-DOS のバージョン番号の獲得(_DOSVER)
00073C D46D 200A            12      JR  NZ,_ERROR
00073E D46F 011D01          10      LD  BC,VER_6F
000741 D472 116001          10      LD  DE,VER
000744 D475 210100          10      LD  HL,MACD
       D478                     C_REM:
000747 D478 AF               4      XOR A
       D479                     _ERROR:
000748 D479 A7               4      AND A
000749 D47A C9              10      RET
                                
       D47B                     _SYS09:     ;文字列出力
00074A D47B D5              11      PUSH    DE
       D47C                     _SX09:
00074B D47C 1A               7      LD  A,(DE)
00074C D47D 13               6      INC DE
00074D D47E FE24             7      CP  '$'
00074F D480 2831            12      JR  Z,SX0E2
000751 D482 CD11D7          17      CALL    MSG_A
000754 D485 18F5            12      JR  _SX09
                                
       D487                     MSX1:
000756 D487 CD11D7          17      CALL    MSG_A
       D48A                     MSX:
000759 D48A 7E               7      LD  A,(HL)
00075A D48B 23               6      INC HL
00075B D48C B7               4      OR  A
00075C D48D 20F8            12      JR  NZ,MSX1
00075E D48F C9              10      RET
                                
       D490                     _SYS0C:     ;(BDOS)バージョン番号の獲得
00075F D490 212200          10      LD  HL,00022H
000762 D493 7D               4      LD  A,L
000763 D494 C9              10      RET
                                
       D495                     _SYS0D:     ;(BDOS)ディスクリセット
000764 D495 CDDFF0          17      CALL    _FFLUSH
000767 D498 E5              11      PUSH    HL
000768 D499 218000          10      LD  HL,00080H
00076B D49C 228AF0          16      LD  (_DTA),HL
00076E D49F E1              10      POP HL
00076F D4A0 D5              11      PUSH    DE
000770 D4A1 1E00             7      LD  E,0
000772 D4A3 3E                      DB  03EH    ;次の PUSH DE をスキップ
                                
       D4A4                     _SYS0E:     ;(BDOS)カレントドライブの設定
000773 D4A4 D5              11      PUSH    DE
000774 D4A5 7B               4      LD  A,E
000775 D4A6 DDE5            15      PUSH    IX
000777 D4A8 CDDCF0          17      CALL    _GETDPB
00077A D4AB DDE1            14      POP IX
00077C D4AD 3804            12      JR  C,SX0E2
00077E D4AF 7B               4      LD  A,E
00077F D4B0 3287F0          13      LD  (_DVSW),A
       D4B3                     SX0E2:
000782 D4B3 D1              10      POP DE
000783 D4B4 C9              10      RET
                                
       D4B5                     _SYS0F:     ;(BDOS)ファイルのオープン
000784 D4B5 CD2BDC          17      CALL    SETDRV
000787 D4B8 FD7E1C          19      LD  A,(IY+28)   ;(FCB)オープンモード
00078A D4BB C602             7      ADD A,002H      ;Write
00078C D4BD 2848            12      JR  Z,FEND0F
00078E D4BF CD79DF          17      CALL    CHKWILDX
                                
000791 D4C2 D455DC          17      CALL    NC,SOPENX
       D4C5                     _S16XX:
000794 D4C5 3840            12      JR  C,FEND0F
                                                ;Directory location
000796 D4C7 3A9FF0          13      LD  A,(_FILEN)
000799 D4CA FD7719          19      LD  (IY+25),A   ;(FCB)ディレクトリロケーション
                                ;               _DIRF
00079C D4CD 3AA0F0          13      LD  A,(_DIRF)
00079F D4D0 FD771D          19      LD  (IY+29),A   ;(FCB)ディレクトリモード
                                ;               _FBPS
0007A2 D4D3 FD731E          19      LD  (IY+30),E   ;(FCB)ディレクトリポジション
0007A5 D4D6 FD721F          19      LD  (IY+31),D
                                ;               Open(Read)
0007A8 D4D9 FD361CFF        19      LD  (IY+28),0FFH    ;(FCB)オープンモード
                                ;               FILENAME
0007AC D4DD FDE5            15      PUSH    IY
0007AE D4DF D1              10      POP DE
0007AF D4E0 13               6      INC DE
0007B0 D4E1 010B00          10      LD  BC,11
0007B3 D4E4 EDB0                    LDIR
                                ;               Attribute
0007B5 D4E6 7E               7      LD  A,(HL)
0007B6 D4E7 FD770D          19      LD  (IY+13),A   ;(FCB)属性(アトリビュート)
0007B9 D4EA 110B00          10      LD  DE,11       ;Reserved
0007BC D4ED 19              11      ADD HL,DE
                                                    ;(FCB)ファイルを最後に変更した時刻
0007BD D4EE 11E4F1          10      LD  DE,SDDATA       ;(FCB)ファイルを最後に変更した日付
0007C0 D4F1 060A             7      LD  B,SDDATAE-SDDATA    ;(FCB)ファイルの先頭クラスタ
       D4F3                     S16LOOP:                ;(FCB)ファイルのサイズ(バイト単位)
0007C2 D4F3 1A               7      LD  A,(DE)
0007C3 D4F4 13               6      INC DE
0007C4 D4F5 32FCD4          13      LD  (S16PAT),A
0007C7 D4F8 7E               7      LD  A,(HL)
0007C8 D4F9 23               6      INC HL
0007C9 D4FA FD7700          19      LD  (IY+0),A
       D4FC                     S16PAT  EQU $-1
0007CC D4FD 10F4            13      DJNZ    S16LOOP
                                
0007CE D4FF AF               4      XOR A
0007CF D500 FD770C          19      LD  (IY+12),A   ;(FCB)カレントブロック
0007D2 D503 FD22A4D5        20      LD  (OFCB_SWC),IY
       D507                     FEND0F:
0007D6 D507 1845            12      JR  FEND10
                                
       D509                     _SYS10:     ;(BDOS)ファイルのクローズ
0007D8 D509 CD2BDC          17      CALL    SETDRV
0007DB D50C FD7E1C          19      LD  A,(IY+28)   ;(FCB)オープンモード
0007DE D50F D6FE             7      SUB 0FEH
0007E0 D511 37               4      SCF
0007E1 D512 3F               4      CCF
0007E2 D513 2039            12      JR  NZ,FEND10
       D515                     _S10A:              ;Write
0007E4 D515 FD770E          19      LD  (IY+14),A   ;(FCB)レコードサイズ/アクセスするディレクトリのクラスタ番号+1
0007E7 D518 FD770F          19      LD  (IY+15),A
                                
0007EA D51B FD341C          23      INC (IY+28)     ;(FCB)オープンモード 0FEH->0FFH
0007ED D51E CD75E0          17      CALL    SETTMS
                                
0007F0 D521 FD7E1D          19      LD  A,(IY+29)   ;(FCB)ディレクトリモード
0007F3 D524 32A0F0          13      LD  (_DIRF),A
0007F6 D527 E67F             7      AND 07FH
0007F8 D529 32A0E5          13      LD  (_SECPS),A
0007FB D52C FD5E1E          19      LD  E,(IY+30)   ;(FCB)ディレクトリポジション
0007FE D52F FD561F          19      LD  D,(IY+31)
000801 D532 CD8ADD          17      CALL    READ_DIR
000804 D535 3817            12      JR  C,FEND10
                                
000806 D537 3AB5DC          13  SDECM1: LD  A,(SDECPAT) ;1セクタ辺りのディレクトリエントリ数
000809 D53A 3D               4      DEC A       ;1024=01FH / 512=00FH / 256=7
00080A D53B FDA619          19      AND (IY+25)     ;(FCB)ディレクトリロケーション
00080D D53E 6F               4      LD  L,A
00080E D53F 2600             7      LD  H,0
000810 D541 29              11      ADD HL,HL       ;*2
000811 D542 29              11      ADD HL,HL       ;*4
000812 D543 29              11      ADD HL,HL       ;*8
000813 D544 29              11      ADD HL,HL       ;*16
000814 D545 29              11      ADD HL,HL       ;*32
000815 D546 ED4B7EF1        20      LD  BC,(_DTBUF)
000819 D54A 09              11      ADD HL,BC
                                
00081A D54B CD89DF          17      CALL    SDIRENT
       D54E                     FEND10:
00081D D54E 1842            12      JR  FEND
                                
       D550                     _SYS11:     ;(BDOS)最初のファイルの検索
00081F D550 CD2BDC          17      CALL    SETDRV
000822 D553 CD84DC          17      CALL    SOPEN
       D556                     _S12X1:
000825 D556 383A            12      JR  C,FEND
000827 D558 CD23DD          17      CALL    SOPENE2
00082A D55B ED5B8AF0        20      LD  DE,(_DTA)
00082E D55F 3A88F0          13      LD  A,(_DRV)
000831 D562 3C               4      INC A
000832 D563 12               7      LD  (DE),A
000833 D564 D5              11      PUSH    DE
000834 D565 13               6      INC DE
000835 D566 012000          10      LD  BC,32
000838 D569 EDB0                    LDIR
00083A D56B FD6E0E          19      LD  L,(IY+14)   ;(FCB)レコードサイズ/アクセスするディレクトリのクラスタ番号+1
00083D D56E FD660F          19      LD  H,(IY+15)
000840 D571 22F4F1          16      LD  (SCDIR),HL
000843 D574 2A9AF0          16      LD  HL,(_FBPS)
000846 D577 22F6F1          16      LD  (SFBPS),HL
000849 D57A 2A9FF0          16      LD  HL,(_FILEN)
00084C D57D 7C               4      LD  A,H
00084D D57E B7               4      OR  A
00084E D57F 2806            12      JR  Z,_S12DIR
000850 D581 3AA0E5          13      LD  A,(_SECPS)
000853 D584 F680             7      OR  080H
000855 D586 67               4      LD  H,A
       D587                     _S12DIR:
000856 D587 22F8F1          16      LD  (SFNDF),HL  ;Directory position and Flags
000859 D58A E1              10      POP HL
00085A D58B 1139F0          10      LD  DE,SFILE
00085D D58E 0E21             7      LD  C,33
       D590                     _S11B:
00085F D590 EDB0                    LDIR
       D592                     FEND:
000861 D592 9F               4      SBC A,A     ;CF=0 A=0 : CF=1 A=0FFH
       D593                     FENDE:
000862 D593 FDE1            14      POP IY
000864 D595 C1              10      POP BC
000865 D596 D1              10      POP DE
000866 D597 E1              10      POP HL
000867 D598 C9              10      RET
                                
       D599                     _SYS12:     ;(BDOS)次のファイルの検索
000868 D599 E5              11      PUSH    HL
000869 D59A D5              11      PUSH    DE
00086A D59B C5              11      PUSH    BC
00086B D59C FDE5            15      PUSH    IY
00086D D59E CDE8DC          17      CALL    NOPEN
000870 D5A1 18B3            12      JR  _S12X1
                                
       D5A3                     _S16K:
000872 D5A3 110000          10      LD  DE,0
       D5A4                     OFCB_SWC    EQU $-2
000875 D5A6 D5              11      PUSH    DE
000876 D5A7 061A             7      LD  B,26        ;First cluster
       D5A9                     S16K1:
000878 D5A9 13               6      INC DE
000879 D5AA 23               6      INC HL
00087A D5AB 10FC            13      DJNZ    S16K1
                                
00087C D5AD 1A               7      LD  A,(DE)
00087D D5AE BE               7      CP  (HL)
00087E D5AF 2015            12      JR  NZ,S16K2
000880 D5B1 13               6      INC DE
000881 D5B2 23               6      INC HL
000882 D5B3 1A               7      LD  A,(DE)
000883 D5B4 BE               7      CP  (HL)
000884 D5B5 200F            12      JR  NZ,S16K2
                                
000886 D5B7 E1              10      POP HL
000887 D5B8 FDE5            15      PUSH    IY
000889 D5BA D1              10      POP DE
00088A D5BB 7E               7      LD  A,(HL)
00088B D5BC CD40DC          17      CALL    IS_SAME_DRV_A_DE
00088E D5BF 2006            12      JR  NZ,S16K3
                                                ;ここはCFが必ず0
000890 D5C1 ED52            15      SBC HL,DE       ;CP HL,DE
000892 D5C3 37               4      SCF
000893 D5C4 C0              11      RET NZ
000894 D5C5 E5              11      PUSH    HL
       D5C6                     S16K2:
000895 D5C6 E1              10      POP HL
       D5C7                     S16K3:
000896 D5C7 FDE5            15      PUSH    IY
000898 D5C9 D1              10      POP DE
       D5CA                     _SYS13:     ;(BDOS)ファイルの削除
000899 D5CA CD2BDC          17      CALL    SETDRV
00089C D5CD CDAFDE          17      CALL    KILL
       D5D0                     FEND13:
00089F D5D0 18C0            12      JR  FEND
                                
       D5D2                     _SYS14:     ;(BDOS)シーケンシャルな読み出し
0008A1 D5D2 CD2BDC          17      CALL    SETDRV
0008A4 D5D5 CDE1E0          17      CALL    INIT_SEQ
       D5D8                     SREAD:
0008A7 D5D8 CD29E1          17      CALL    RB_READ
                                
0008AA D5DB C601             7      ADD A,001H
0008AC D5DD 38B3            12      JR  C,FEND
                                
0008AE D5DF 7D               4      LD  A,L
0008AF D5E0 D601             7      SUB 001H
       D5E2                     FENDX:
0008B1 D5E2 9F               4      SBC A,A
0008B2 D5E3 E603             7      AND 3
0008B4 D5E5 1F               4      RRA
0008B5 D5E6 18AB            12      JR  FENDE
                                
       D5E8                     _SYS15:     ;(BDOS)シーケンシャルな書き込み
0008B7 D5E8 CD2BDC          17      CALL    SETDRV
0008BA D5EB CDE1E0          17      CALL    INIT_SEQ
       D5EE                     SWRITE:
0008BD D5EE CD22E1          17      CALL    RB_WRITE
                                
0008C0 D5F1 C6FF             7      ADD A,0FFH
0008C2 D5F3 18ED            12      JR  FENDX
                                
       D5F5                     _SYS17:     ;(BDOS)ファイル名の変更
0008C4 D5F5 CD2BDC          17      CALL    SETDRV
0008C7 D5F8 CD05DF          17      CALL    NAME
0008CA D5FB 18D3            12      JR  FEND13
                                
       D5FD                     _SYS16:     ;(BDOS)ファイルの作成
0008CC D5FD CD2BDC          17      CALL    SETDRV
                                
0008CF D600 CD79DF          17      CALL    CHKWILDX
0008D2 D603 38CB            12      JR  C,FEND13
0008D4 D605 FD7E01          19      LD  A,(IY+1)    ;(FCB)主ファイル名
0008D7 D608 FE05             7      CP  5
0008D9 D60A 2805            12      JR  Z,_S16X2
0008DB D60C FE21             7      CP  021H
0008DD D60E DAD0D5          10      JP  C,FEND13
       D611                     _S16X2:
                                ;               Clear FCB
0008E0 D611 FDE5            15      PUSH    IY
0008E2 D613 E1              10      POP HL
0008E3 D614 011000          10      LD  BC,16
0008E6 D617 09              11      ADD HL,BC
       D618                     _S16X1:
0008E7 D618 70               7      LD  (HL),B      ;B=0
0008E8 D619 23               6      INC HL
0008E9 D61A 0D               4      DEC C
0008EA D61B 20FB            12      JR  NZ,_S16X1
                                
0008EC D61D CD7AE0          17      CALL    SETTMSX
0008EF D620 FD360DFF        19      LD  (IY+13),0FFH    ;(FCB)Attribute
0008F3 D624 CD55DC          17      CALL    SOPENX
0008F6 D627 3F               4      CCF
0008F7 D628 CCA3D5          17      CALL    Z,_S16K
0008FA D62B D434DD          17      CALL    NC,COPEN
0008FD D62E D489DF          17      CALL    NC,SDIRENT
000900 D631 C3C5D4          10      JP  _S16XX
                                
       D634                     _SYS21:     ;(BDOS)ランダムな読み出し
000903 D634 CD2BDC          17      CALL    SETDRV
000906 D637 CDC5E0          17      CALL    INIT_RND
000909 D63A 189C            12      JR  SREAD
                                
       D63C                     _SYS22:     ;(BDOS)ランダムな書き込み
       D63C                     _SYS28:     ;(BDOS)ランダムな書き込み・その2
00090B D63C CD2BDC          17      CALL    SETDRV
00090E D63F CDC5E0          17      CALL    INIT_RND
000911 D642 18AA            12      JR  SWRITE
                                
       D644                     _SYS18:     ;(BDOS)ログインベクトルの獲得
000913 D644 21FF00          10      LD  HL,000FFH
000916 D647 AF               4      XOR A
000917 D648 C9              10      RET
                                
       D649                     _SYS19:     ;(BDOS)カレントドライブ番号の獲得
000918 D649 3A87F0          13      LD  A,(_DVSW)
00091B D64C A7               4      AND A
00091C D64D C9              10      RET
                                
       D64E                     _SYS1A:     ;(BDOS)DTAの設定
00091D D64E ED538AF0        20      LD  (_DTA),DE
000921 D652 AF               4      XOR A
000922 D653 C9              10      RET
                                
       D654                     _SYS1B:     ;(BDOS)ディスク情報の獲得
000923 D654 7B               4      LD  A,E
000924 D655 CD39DC          17      CALL    GETDRV
000927 D658 CDDCF0          17      CALL    _GETDPB
00092A D65B D4E2F0          17      CALL    NC,_RDFATX
00092D D65E 210000          10      LD  HL,0
000930 D661 D453E0          17      CALL    NC,DSKF
                                
000933 D664 ED5B54E0        20      LD  DE,(MAXCLP) ;DPB_MAXCL-1
000937 D668 1B               6      DEC DE      ;DE←クラスタの総数
000938 D669 FD2A7CF1        20      LD  IY,(_FATBF) ;IY←メモリ上のFATの先頭アドレス
00093C D66D 9F               4      SBC A,A
00093D D66E D8              11      RET C
00093E D66F 4F               4      LD  C,A     ;C=0
00093F D670 DD7E0F          19      LD  A,(IX+DPB_BPS)
000942 D673 E607             7      AND 7
000944 D675 47               4      LD  B,A
000945 D676 DD7E07          19      LD  A,(IX+DPB_SECPCL)
000948 D679 C9              10      RET
                                
       D67A                     _SYS1D:     ;(BDOS)書き込みが禁止されているディスクの調査
000949 D67A AF               4      XOR A
00094A D67B 67               4      LD  H,A
00094B D67C 6F               4      LD  L,A
00094C D67D C9              10      RET
                                
       D67E                     _SYS1F:     ;(BDOS)ディスク装置のパラメータの読み出し
00094D D67E 2100F2          10      LD  HL,_DEVICE
000950 D681 7B               4      LD  A,E
000951 D682 C3DCF0          10      JP  _GETDPB
                                
       D685                     _SYS23:     ;(BDOS)ファイルサイズの獲得
000954 D685 E5              11      PUSH    HL
000955 D686 2A1EF1          16      LD  HL,(STABLE+2*00FH)  ;ファイルのオープン
000958 D689 CD0F00          17      CALL    JP_HL
00095B D68C 381B            12      JR  C,_S23X1
                                
00095D D68E D5              11      PUSH    DE      ;EX DE,IY
00095E D68F FDE3            23      EX  (SP),IY     ;
                                ;   POP DE      ;
                                ;   PUSH    DE      ;DEを破壊しないように注意vv
000960 D691 FD7E10          19      LD  A,(IY+16)   ;(FCB)ファイルのサイズ(バイト単位)
000963 D694 FD6E11          19      LD  L,(IY+17)   ;
000966 D697 FD6612          19      LD  H,(IY+18)   ;
000969 D69A C5              11      PUSH    BC      ;
00096A D69B FD4613          19      LD  B,(IY+19)   ;
00096D D69E CDB7E0          17      CALL    GET_CPM_R_SIZE
000970 D6A1 C1              10      POP BC
       D6A2                     _S24X1:
000971 D6A2 CDD7E0          17      CALL    SET_RR_AHL
                                ;   POP DE      ;^^^^^^^^^^^^^^^^^^^^^^^^
                                ;   PUSH    DE      ;EX DE,IY
000974 D6A5 FDE3            23      EX  (SP),IY     ;
000976 D6A7 D1              10      POP DE      ;
                                
000977 D6A8 AF               4      XOR A
       D6A9                     _S23X1:
000978 D6A9 E1              10      POP HL
000979 D6AA C9              10      RET
                                
       D6AB                     _SYS24:     ;(BDOS)ランダムレコードフィールドの設定
00097A D6AB E5              11      PUSH    HL
00097B D6AC D5              11      PUSH    DE      ;EX DE,IY
00097C D6AD FDE3            23      EX  (SP),IY     ;
                                ;   POP DE      ;
                                ;   PUSH    DE      ;DEを破壊しないように注意vv
00097E D6AF CDE9E0          17      CALL    GETSEQ
000981 D6B2 18EE            12      JR  _S24X1      ;^^^^^^^^^^^^^^^^^^^^^^^^
                                
       D6B4                     _SYS29:     ;(BDOS)ファイル名の解析(_PPATH)
000983 D6B4 C5              11      PUSH    BC
000984 D6B5 E5              11      PUSH    HL
000985 D6B6 CD42DB          17      CALL    FILE
000988 D6B9 E1              10      POP HL
000989 D6BA C1              10      POP BC
       D6BB                     S29X1:
00098A D6BB C5              11      PUSH    BC
00098B D6BC D5              11      PUSH    DE
00098C D6BD E5              11      PUSH    HL
00098D D6BE EB               4      EX  DE,HL
00098E D6BF AF               4      XOR A
00098F D6C0 3221F0          13      LD  (FDRV+13),A
000992 D6C3 2114F0          10      LD  HL,FDRV
000995 D6C6 011000          10      LD  BC,16
000998 D6C9 EDB0                    LDIR
00099A D6CB E1              10      POP HL
00099B D6CC D1              10      POP DE
00099C D6CD C1              10      POP BC
00099D D6CE C9              10      RET
                                
       D6CF                     _SYS30:     ;(BDOS)論理セクタを用いた書き込み
00099E D6CF C5              11      PUSH    BC
00099F D6D0 013AE7          10      LD  BC,DWT24B
0009A2 D6D3 1804            12      JR  S2FX
       D6D5                     _SYS2F:
0009A4 D6D5 C5              11      PUSH    BC
0009A5 D6D6 012AE7          10      LD  BC,DRD24B
       D6D9                     S2FX:
0009A8 D6D9 ED43EFD6        20      LD  (S2FPAT+1),BC
0009AC D6DD CDDFF0          17      CALL    _FFLUSH
                                
0009AF D6E0 D5              11      PUSH    DE
0009B0 D6E1 E5              11      PUSH    HL
0009B1 D6E2 7D               4      LD  A,L     ;Drive
0009B2 D6E3 CDD9F0          17      CALL    _CHGDRV
0009B5 D6E6 3809            12      JR  C,S30X2
0009B7 D6E8 44               4      LD  B,H     ;Number of clusters
0009B8 D6E9 2A8AF0          16      LD  HL,(_DTA)
                                
0009BB D6EC 0E00             7      LD  C,0
0009BD D6EE CD2AE7          17  S2FPAT: CALL    DRD24B
       D6F1                     S30X2:
0009C0 D6F1 E1              10      POP HL
0009C1 D6F2 D1              10      POP DE
0009C2 D6F3 C1              10      POP BC
0009C3 D6F4 9F               4      SBC A,A
0009C4 D6F5 C9              10      RET
                                
       D6F6                     _SYS5A:     ;(BDOS)カレントディレクトリの変更
0009C5 D6F6 C5              11      PUSH    BC
0009C6 D6F7 D5              11      PUSH    DE
0009C7 D6F8 E5              11      PUSH    HL
0009C8 D6F9 CD37DB          17      CALL    FILEC
0009CB D6FC 210000          10      LD  HL,0
0009CE D6FF 1114F0          10      LD  DE,FDRV
0009D1 D702 2A4EF1          16      LD  HL,(STABLE+2*027H)  ;ランダムブロック読み込み
0009D4 D705 CD0F00          17      CALL    JP_HL
0009D7 D708 18E7            12      JR  S30X2
[EOF:LDOS.ASM:SHIFT_JIS]
                                    INCLUDE "M7IO.ASM"
                                
                                ;   LSX-Dodgers IO
                                ;   MZ-700/1500
                                
       D479                     _SYS04  EQU _ERROR      ;(BDOS)外部出力
       D479                     _SYS05  EQU _ERROR      ;(BDOS)プリンタ出力
       D479                     _SYS1C  EQU _ERROR      ;(BDOS)ディスクの書き込み禁止化
       D479                     _SYS1E  EQU _ERROR      ;(BDOS)ファイル属性の設定
       D479                     _SYS20  EQU _ERROR      ;(BDOS)利用者番号の設定と読み出し
       D479                     _SYS2E  EQU _ERROR      ;(BDOS)ベリファイ・フラグの設定
                                
       0000                     INT EQU 0
       0000                     INTCTCE EQU 0
       0000                     INTCTC2 EQU 0
                                
       D70A                     POP_AF_HL_SCF_RET:
0009D9 D70A F1              10      POP AF
0009DA D70B E1              10      POP HL
0009DB D70C 37               4      SCF
       D70D                     KEYBC_IFBREAK:
0009DC D70D C9              10      RET
                                
       D70E                     _SYS01:     ;(BDOS)コンソール入力
0009DD D70E CD09F0          17      CALL    _SYS07
       D711                     MSG_A:
0009E0 D711 F5              11      PUSH    AF
0009E1 D712 D5              11      PUSH    DE
0009E2 D713 5F               4      LD  E,A
0009E3 D714 CD1AD7          17      CALL    _SYS02
0009E6 D717 D1              10      POP DE
0009E7 D718 F1              10      POP AF
0009E8 D719 C9              10      RET
                                
       D71A                     _SYS02:     ;(BDOS)コンソール出力
0009E9 D71A CD2CD7          17      CALL    BREAK
0009EC D71D 1805            12      JR  PRINTX
                                
       D71F                     _SYS06:     ;(BDOS)コンソール直接入出力
0009EE D71F 7B               4      LD  A,E
0009EF D720 3C               4      INC A
0009F0 D721 CACAF0          10      JP  Z,_INKEY
       D724                     PRINTX:
0009F3 D724 C3CDF0          10      JP  _PRINT
                                
       D727                     _SYS08:     ;(BDOS)エコーなしコンソール入力
0009F6 D727 CD09F0          17      CALL    _SYS07
0009F9 D72A 1803            12      JR  BREAK1
       D72C                     BREAK:
0009FB D72C CDC9DA          17      CALL    CHKEY
       D72F                     BREAK1:
0009FE D72F FE03             7      CP  3       ;CTRL+C
000A00 D731 CA00F0          10      JP  Z,CPM_BOOT
000A03 D734 FE13             7      CP  013H        ;CTRL+S
000A05 D736 C0              11      RET NZ
                                
       D737                     PAUSE:
       D737                     FLGET:
000A06 D737 CDDFF0          17      CALL    _FFLUSH
000A09 D73A E5              11      PUSH    HL
000A0A D73B 2A8EF0          16      LD  HL,(_TXADR)
000A0D D73E 7C               4      LD  A,H
000A0E D73F C6D0             7      ADD A,0D0H
000A10 D741 67               4      LD  H,A
000A11 D742 CD25CF          17      CALL    RDMMIO
000A14 D745 325AD7          13      LD  (FLSMC),A
       D748                     FLGET1:
000A17 D748 CD1BCF          17      CALL    RD556VSYNC
000A1A D74B CB77             8      BIT 6,A
000A1C D74D 3EEF             7      LD  A,0EFH      ;カーソル
000A1E D74F 200A            12      JR  NZ,FLGET2
000A20 D751 3A92F0          13      LD  A,(_KEYD)
000A23 D754 B7               4      OR  A
000A24 D755 3EEF             7      LD  A,0EFH      ;カーソル
000A26 D757 2002            12      JR  NZ,FLGET2
000A28 D759 3E00             7      LD  A,0     ;自己書き換え
       D75A                     FLSMC   EQU $-1
       D75B                     FLGET2:
000A2A D75B CD2DCF          17      CALL    WRMMIO
000A2D D75E CDCAF0          17      CALL    _INKEY
000A30 D761 28E5            12      JR  Z,FLGET1
000A32 D763 F5              11      PUSH    AF
000A33 D764 3A5AD7          13      LD  A,(FLSMC)
000A36 D767 CD2DCF          17      CALL    WRMMIO
000A39 D76A F1              10      POP AF
000A3A D76B E1              10      POP HL
000A3B D76C C9              10      RET
                                
       D76D                     _SYS0A:     ;(BDOS)文字列入力
000A3C D76D C5              11      PUSH    BC
000A3D D76E E5              11      PUSH    HL
000A3E D76F D5              11      PUSH    DE
000A3F D770 CD02DA          17      CALL    GETL
000A42 D773 1120FF          10      LD  DE,KBUF
000A45 D776 E1              10      POP HL
000A46 D777 E5              11      PUSH    HL
000A47 D778 0E00             7      LD  C,0
000A49 D77A 3004            12      JR  NC,SAX0
000A4B D77C 23               6      INC HL
000A4C D77D 23               6      INC HL
000A4D D77E 1808            12      JR  SAX4
       D780                     SAX0:
000A4F D780 46               7      LD  B,(HL)
000A50 D781 23               6      INC HL
       D782                     SAX1:
000A51 D782 23               6      INC HL
000A52 D783 1A               7      LD  A,(DE)
000A53 D784 13               6      INC DE
000A54 D785 B7               4      OR  A
000A55 D786 2004            12      JR  NZ,SAX2
       D788                     SAX4:
000A57 D788 360D            10      LD  (HL),00DH
000A59 D78A 1804            12      JR  SAX3
       D78C                     SAX2:
000A5B D78C 77               7      LD  (HL),A
000A5C D78D 0C               4      INC C
000A5D D78E 10F2            13      DJNZ    SAX1
       D790                     SAX3:
000A5F D790 D1              10      POP DE
000A60 D791 79               4      LD  A,C
000A61 D792 13               6      INC DE
000A62 D793 12               7      LD  (DE),A
000A63 D794 1B               6      DEC DE
000A64 D795 E1              10      POP HL
000A65 D796 C1              10      POP BC
000A66 D797 A7               4      AND A
000A67 D798 C9              10      RET
                                
       D799                     _SYS0B:     ;(BDOS)コンソール状態のチェック
000A68 D799 CD2CD7          17      CALL    BREAK
000A6B D79C AF               4      XOR A
000A6C D79D 3296DA          13      LD  (SKIP_KEYWAIT),A
000A6F D7A0 3A92F0          13      LD  A,(_KEYD)
000A72 D7A3 B7               4      OR  A
000A73 D7A4 C8              11      RET Z
       D7A5                     CONSTX:
000A74 D7A5 CDDFF0          17      CALL    _FFLUSH
000A77 D7A8 CDC9DA          17      CALL    CHKEY
000A7A D7AB C6FF             7      ADD A,0FFH
000A7C D7AD 9F               4      SBC A,A
000A7D D7AE C9              10      RET
                                
       D7AF                     _SYS2A:     ;(BDOS)日付の獲得
000A7E D7AF AF               4      XOR A
000A7F D7B0 57               4      LD  D,A
000A80 D7B1 5F               4      LD  E,A
000A81 D7B2 67               4      LD  H,A
000A82 D7B3 6F               4      LD  L,A
000A83 D7B4 C9              10      RET
                                
       D7B5                     _SYS2C:     ;(BDOS)時刻の獲得
000A84 D7B5 AF               4      XOR A
000A85 D7B6 57               4      LD  D,A
000A86 D7B7 5F               4      LD  E,A
000A87 D7B8 67               4      LD  H,A
000A88 D7B9 6F               4      LD  L,A
000A89 D7BA C9              10      RET
                                
       D7BB                     ESC1:
000A8A D7BB 7B               4      LD  A,E
000A8B D7BC FE41             7      CP  'A'
000A8D D7BE CAB3D8          10      JP  Z,CTRL1E
000A90 D7C1 FE42             7      CP  'B'
000A92 D7C3 CAC5D9          10      JP  Z,CTRL1F
000A95 D7C6 FE43             7      CP  'C'
000A97 D7C8 CA86D8          10      JP  Z,CTRL1C
000A9A D7CB FE44             7      CP  'D'
000A9C D7CD CAAAD8          10      JP  Z,CTRL1D
000A9F D7D0 FE45             7      CP  'E'
000AA1 D7D2 2802            12      JR  Z,CT0CX
000AA3 D7D4 FE6A             7      CP  'j'
       D7D6                     CT0CX:
000AA5 D7D6 CAAAD9          10      JP  Z,CTRL0C
000AA8 D7D9 FE48             7      CP  'H'
000AAA D7DB CA27D9          10      JP  Z,CTRL0B
000AAD D7DE FE4A             7      CP  'J'
000AAF D7E0 CAADD9          10      JP  Z,CTRL06
000AB2 D7E3 FE4B             7      CP  'K'
000AB4 D7E5 CAF9D8          10      JP  Z,CTRL05
000AB7 D7E8 FE4C             7      CP  'L'
000AB9 D7EA CAD7D9          10      JP  Z,CTRL0E
000ABC D7ED FE54             7      CP  'T'
000ABE D7EF CAF9D8          10      JP  Z,CTRL05
000AC1 D7F2 FE78             7      CP  'x'
000AC3 D7F4 2804            12      JR  Z,ESC1X
000AC5 D7F6 FE79             7      CP  'y'
000AC7 D7F8 2002            12      JR  NZ,ESC1Y
       D7FA                     ESC1X:
000AC9 D7FA 3601            10      LD  (HL),1
       D7FC                     ESC1Y:
000ACB D7FC FE3D             7      CP  '='
000ACD D7FE 2804            12      JR  Z,ESC1W
000ACF D800 FE59             7      CP  'Y'
000AD1 D802 2002            12      JR  NZ,ESC1Z
       D804                     ESC1W:
000AD3 D804 3602            10      LD  (HL),2
       D806                     ESC1Z:
000AD5 D806 FE20             7      CP  020H
000AD7 D808 3802            12      JR  C,ESC1C
000AD9 D80A 87               4      ADD A,A
000ADA D80B D0              11      RET NC
       D80C                     ESC1C:
000ADB D80C E1              10      POP HL
000ADC D80D 1832            12      JR  ANK
                                
       D80F                     ESC:
000ADE D80F 2172D8          10      LD  HL,PRINTE5
000AE1 D812 E5              11      PUSH    HL
000AE2 D813 2135D8          10      LD  HL,ESCFLG
000AE5 D816 3600            10      LD  (HL),0
000AE7 D818 3D               4      DEC A
000AE8 D819 28A0            12      JR  Z,ESC1
000AEA D81B 3D               4      DEC A
000AEB D81C 2009            12      JR  NZ,ESC2
000AED D81E 3603            10      LD  (HL),3
000AEF D820 7B               4      LD  A,E
000AF0 D821 D620             7      SUB 020H
000AF2 D823 322AD8          13      LD  (ESCYP+1),A
000AF5 D826 C9              10      RET
       D827                     ESC2:
000AF6 D827 3D               4      DEC A
000AF7 D828 C0              11      RET NZ
000AF8 D829 2600             7  ESCYP:  LD  H,0
000AFA D82B 7B               4      LD  A,E
000AFB D82C D620             7      SUB 020H
000AFD D82E 6F               4      LD  L,A
000AFE D82F C3D6F0          10      JP  _LOC
                                
       D832                     PRINT:
000B01 D832 C5              11      PUSH    BC
000B02 D833 E5              11      PUSH    HL
000B03 D834 3E00             7      LD  A,000H      ;自己書き換え
       D835                     ESCFLG  EQU $-1
000B05 D836 B7               4      OR  A
000B06 D837 20D6            12      JR  NZ,ESC
                                
000B08 D839 3E1F             7      LD  A,01FH
000B0A D83B BB               4      CP  E
000B0B D83C 3038            12      JR  NC,CTRL
       D83E                     INSFLG  EQU $
000B0D D83E 017FD9          10      LD  BC,INSERT   ;自己書き換え
       D841                     ANK:
000B10 D841 3A96F0          13      LD  A,(_COLORF)
000B13 D844 4F               4      LD  C,A
000B14 D845 7B               4      LD  A,E
000B15 D846 FE61             7      CP  'a'     ;英小文字
000B17 D848 3806            12      JR  C,PRT1
000B19 D84A FE7B             7      CP  'z'+1
000B1B D84C 3002            12      JR  NC,PRT1
000B1D D84E CBF9             8      SET 7,C
       D850                     PRT1:
000B1F D850 FE86             7      CP  $86     ;ひらがな1(を－そ)
000B21 D852 3806            12      JR  C,PRT2
000B23 D854 FEA0             7      CP  $A0
000B25 D856 3002            12      JR  NC,PRT2
000B27 D858 CBF9             8      SET 7,C
       D85A                     PRT2:
000B29 D85A FEE0             7      CP  $E0     ;ひらがな2(たーん)
000B2B D85C 3802            12      JR  C,PRT3
000B2D D85E CBF9             8      SET 7,C
       D860                     PRT3:
000B2F D860 2A8EF0          16      LD  HL,(_TXADR)
000B32 D863 7C               4      LD  A,H
000B33 D864 C6D0             7      ADD A,0D0H
000B35 D866 67               4      LD  H,A
000B36 D867 42               4      LD  B,D
000B37 D868 16EE             7      LD  D,CD_TABLE/256
000B39 D86A 1A               7      LD  A,(DE)
000B3A D86B 50               4      LD  D,B
000B3B D86C CD45CF          17      CALL    IO_PRINT
000B3E D86F CD86D8          17      CALL    CTRL1C
       D872                     PRINTE5:
000B41 D872 E1              10      POP HL
000B42 D873 C1              10      POP BC
000B43 D874 AF               4      XOR A
000B44 D875 C9              10      RET
                                
       D876                     CTRL:
000B45 D876 7B               4      LD  A,E
000B46 D877 87               4      ADD A,A
000B47 D878 F680             7      OR  080H
000B49 D87A 6F               4      LD  L,A
000B4A D87B 26F1             7      LD  H,CTRLTB/256
000B4C D87D 7E               7      LD  A,(HL)
000B4D D87E 2C               4      INC L
000B4E D87F 66               7      LD  H,(HL)
000B4F D880 6F               4      LD  L,A
000B50 D881 CD0F00          17      CALL    JP_HL
000B53 D884 18EC            12      JR  PRINTE5
                                
       D886                     CTRL1C:
000B55 D886 ED4B8EF0        20      LD  BC,(_TXADR)
000B59 D88A 03               6      INC BC
       D88B                     PRINTE3:
000B5A D88B 2118FC          10      LD  HL,0-WIDTH*LINE
000B5D D88E A7               4      AND A
000B5E D88F ED4A            15      ADC HL,BC
       D891                     PRINTE8:
000B60 D891 2805            12      JR  Z,PRINT2
000B62 D893 ED438EF0        20      LD  (_TXADR),BC
       D897                     CTRL00:
000B66 D897 C9              10      RET
                                
       D898                     PRINT2:
000B67 D898 CDDDD9          17      CALL    SCR
000B6A D89B 21D8FF          10      LD  HL,0-WIDTH
000B6D D89E 09              11      ADD HL,BC
       D89F                     SET_TXADR_HL:
000B6E D89F 228EF0          16      LD  (_TXADR),HL
000B71 D8A2 C9              10      RET
                                
       D8A3                     CTRL08:
000B72 D8A3 3A3ED8          13      LD  A,(INSFLG)
000B75 D8A6 FECD             7      CP  0CDH        ;CALL ????
000B77 D8A8 2823            12      JR  Z,CTRL02
       D8AA                     CTRL1D:
000B79 D8AA 2A8EF0          16      LD  HL,(_TXADR)
000B7C D8AD 7C               4      LD  A,H
000B7D D8AE B5               4      OR  L
000B7E D8AF C8              11      RET Z
000B7F D8B0 2B               6      DEC HL
000B80 D8B1 18EC            12      JR  SET_TXADR_HL
                                
       D8B3                     CTRL1E:
000B82 D8B3 ED4B8EF0        20      LD  BC,(_TXADR)
000B86 D8B7 21D8FF          10      LD  HL,0-WIDTH
000B89 D8BA 09              11      ADD HL,BC
000B8A D8BB D0              11      RET NC
000B8B D8BC 18E1            12      JR  SET_TXADR_HL
                                
       D8BE                     CTRL09:
000B8D D8BE ED4B8EF0        20      LD  BC,(_TXADR)
000B91 D8C2 79               4      LD  A,C
000B92 D8C3 E6F8             7      AND 0F8H
000B94 D8C5 C608             7      ADD A,8
000B96 D8C7 4F               4      LD  C,A
000B97 D8C8 88               4      ADC A,B
000B98 D8C9 91               4      SUB C
000B99 D8CA 47               4      LD  B,A
000B9A D8CB 18BE            12      JR  PRINTE3
                                
       D8CD                     CTRL02:
000B9C D8CD CDAAD8          17      CALL    CTRL1D
000B9F D8D0 C8              11      RET Z
000BA0 D8D1 D5              11      PUSH    DE
000BA1 D8D2 CDD3F0          17      CALL    _POS
000BA4 D8D5 54               4      LD  D,H
000BA5 D8D6 3E28             7      LD  A,WIDTH
000BA7 D8D8 95               4      SUB L
000BA8 D8D9 4F               4      LD  C,A
000BA9 D8DA 0D               4      DEC C
000BAA D8DB 06D0             7      LD  B,0D0H
000BAC D8DD 2A8EF0          16      LD  HL,(_TXADR)
000BAF D8E0 09              11      ADD HL,BC
000BB0 D8E1 47               4      LD  B,A
                                
000BB1 D8E2 3A9BD9          13      LD  A,(MULINE)
000BB4 D8E5 BA               4      CP  D
000BB5 D8E6 2007            12      JR  NZ,C02X1
000BB7 D8E8 112800          10      LD  DE,WIDTH
000BBA D8EB 19              11      ADD HL,DE
000BBB D8EC 78               4      LD  A,B
000BBC D8ED 83               4      ADD A,E
000BBD D8EE 47               4      LD  B,A
       D8EF                     C02X1:
000BBE D8EF 3A96F0          13      LD  A,(_COLORF) ;C:Color
000BC1 D8F2 4F               4      LD  C,A
000BC2 D8F3 AF               4      XOR A       ;A:Text
000BC3 D8F4 CD8CCF          17      CALL    IO_BS
000BC6 D8F7 D1              10      POP DE
000BC7 D8F8 C9              10      RET
                                
       D8F9                     CTRL05:
000BC8 D8F9 CDD3F0          17      CALL    _POS
000BCB D8FC 3E28             7      LD  A,WIDTH
000BCD D8FE 95               4      SUB L
000BCE D8FF 47               4      LD  B,A
       D900                     C08X1:
000BCF D900 2A8EF0          16      LD  HL,(_TXADR)
000BD2 D903 7C               4      LD  A,H
000BD3 D904 C6D0             7      ADD A,0D0H
000BD5 D906 67               4      LD  H,A
       D907                     CLLINE:
000BD6 D907 3A96F0          13      LD  A,(_COLORF)
000BD9 D90A 4F               4      LD  C,A
000BDA D90B AF               4      XOR A
000BDB D90C C36FCF          10      JP  IO_CLLINE
                                
       D90F                     CTRL0D:
000BDE D90F CDD3F0          17      CALL    _POS
000BE1 D912 2E00             7      LD  L,0
       D914                     LOC:
000BE3 D914 C5              11      PUSH    BC
000BE4 D915 E5              11      PUSH    HL
000BE5 D916 CD34D9          17      CALL    LOC1
000BE8 D919 228EF0          16      LD  (_TXADR),HL
000BEB D91C E1              10      POP HL
000BEC D91D C1              10      POP BC
000BED D91E C9              10      RET
                                
       D91F                     CTRL12:
000BEE D91F 213ED8          10      LD  HL,INSFLG
000BF1 D922 7E               7      LD  A,(HL)
000BF2 D923 EECC             7      XOR 0CCH        ;CD:CALL ???? 1:LD BC,????
000BF4 D925 77               7      LD  (HL),A
000BF5 D926 C9              10      RET
                                
       D927                     CTRL0B:
000BF6 D927 210000          10      LD  HL,0
000BF9 D92A 228EF0          16      LD  (_TXADR),HL
000BFC D92D C9              10      RET
                                
       D92E                     CTRL1B:
000BFD D92E 3E01             7      LD  A,1
000BFF D930 3235D8          13      LD  (ESCFLG),A
000C02 D933 C9              10      RET
                                
       D934                     LOC1:
000C03 D934 D5              11      PUSH    DE
000C04 D935 4D               4      LD  C,L
000C05 D936 0608             7      LD  B,8
000C07 D938 5C               4      LD  E,H
000C08 D939 210028          10      LD  HL,WIDTH*256
000C0B D93C 55               4      LD  D,L ;L=0
       D93D                     LOC2:
000C0C D93D 29              11      ADD HL,HL
000C0D D93E 3001            12      JR  NC,LOC3
000C0F D940 19              11      ADD HL,DE
       D941                     LOC3:
000C10 D941 10FA            13      DJNZ    LOC2
000C12 D943 09              11      ADD HL,BC
000C13 D944 D1              10      POP DE
000C14 D945 C9              10      RET
                                
       D946                     CONOUT1:
                                ;   CALL    CURSOR
000C15 D946 59               4      LD  E,C
000C16 D947 CDCDF0          17      CALL    _PRINT
000C19 D94A 7B               4      LD  A,E
000C1A D94B FE0A             7      CP  00AH
000C1C D94D 2006            12      JR  NZ,CURSOR
000C1E D94F CD0FD9          17      CALL    CTRL0D
000C21 D952 CDF9D8          17      CALL    CTRL05
       D955                     CURSOR:
000C24 D955 C9              10      RET
                                
       D956                     CTRL07:
000C25 D956 06E0             7      LD  B,0E0H
000C27 D958 2162F0          10      LD  HL,BEEPD+1
       D95B                     C07X0:
000C2A D95B 4E               7      LD  C,(HL)
000C2B D95C 23               6      INC HL
000C2C D95D 7E               7      LD  A,(HL)
000C2D D95E 23               6      INC HL
000C2E D95F CD3DCF          17      CALL    WRMMIO_BC
000C31 D962 7D               4      LD  A,L
000C32 D963 FE6A             7      CP  (BEEPD+1+M7BEEPE-M7BEEPD)&255
000C34 D965 20F4            12      JR  NZ,C07X0
000C36 D967 0610             7      LD  B,16
       D969                     C07X1:
000C38 D969 CD1BCF          17      CALL    RD556VSYNC
000C3B D96C 87               4      ADD A,A
000C3C D96D 30FA            12      JR  NC,C07X1
       D96F                     C07X2:
000C3E D96F CD1BCF          17      CALL    RD556VSYNC
000C41 D972 87               4      ADD A,A
000C42 D973 38FA            12      JR  C,C07X2
000C44 D975 10F2            13      DJNZ    C07X1
                                
000C46 D977 AF               4      XOR A
000C47 D978 2108E0          10      LD  HL,0E008H
000C4A D97B CD2DCF          17      CALL    WRMMIO
000C4D D97E C9              10      RET
                                
       D97F                     INSERT:
000C4E D97F D5              11      PUSH    DE
000C4F D980 CDD3F0          17      CALL    _POS
000C52 D983 54               4      LD  D,H
000C53 D984 3E28             7      LD  A,WIDTH
000C55 D986 95               4      SUB L
000C56 D987 47               4      LD  B,A
000C57 D988 2A8EF0          16      LD  HL,(_TXADR)
000C5A D98B 7C               4      LD  A,H
000C5B D98C C6D0             7      ADD A,0D0H
000C5D D98E 67               4      LD  H,A
000C5E D98F 3A96F0          13      LD  A,(_COLORF) ;C:Color
000C61 D992 4F               4      LD  C,A
000C62 D993 AF               4      XOR A       ;A:Text
000C63 D994 CD7FCF          17      CALL    IO_INS
000C66 D997 B7               4      OR  A
000C67 D998 2005            12      JR  NZ,INS1
       D99B                     MULINE  EQU $+1
000C69 D99A 3EFF             7      LD  A,-1
000C6B D99C 92               4      SUB D
000C6C D99D 2009            12      JR  NZ,INS2
       D99F                     INS1:
000C6E D99F 0628             7      LD  B,WIDTH
000C70 D9A1 CD7FCF          17      CALL    IO_INS
000C73 D9A4 7A               4      LD  A,D
000C74 D9A5 329BD9          13      LD  (MULINE),A
       D9A8                     INS2:
000C77 D9A8 D1              10      POP DE
000C78 D9A9 C9              10      RET
                                
       D9AA                     CTRL0C:
000C79 D9AA CD27D9          17      CALL    CTRL0B
       D9AD                     CTRL06:
000C7C D9AD D5              11      PUSH    DE
000C7D D9AE E5              11      PUSH    HL
000C7E D9AF ED5B8EF0        20      LD  DE,(_TXADR)
000C82 D9B3 3A96F0          13      LD  A,(_COLORF)
000C85 D9B6 325CCF          13      LD  (ICSMC),A
000C88 D9B9 C350CF          10      JP  IO_CLR
                                
       D9BC                     CTRL04:
000C8B D9BC CDD3F0          17      CALL    _POS
000C8E D9BF 7D               4      LD  A,L
000C8F D9C0 B7               4      OR  A
000C90 D9C1 C8              11      RET Z
       D9C2                     CTRL03:
000C91 D9C2 CD0FD9          17      CALL    CTRL0D
       D9C5                     CTRL0A:
       D9C5                     CTRL1F:
000C94 D9C5 2A8EF0          16      LD  HL,(_TXADR)
000C97 D9C8 012800          10      LD  BC,WIDTH
000C9A D9CB 09              11      ADD HL,BC
000C9B D9CC 44               4      LD  B,H
000C9C D9CD 4D               4      LD  C,L
000C9D D9CE 2118FC          10      LD  HL,0-WIDTH*LINE
000CA0 D9D1 09              11      ADD HL,BC
000CA1 D9D2 3F               4      CCF
000CA2 D9D3 9F               4      SBC A,A
000CA3 D9D4 C391D8          10      JP  PRINTE8
                                
       D9D7                     CTRL0E:
000CA6 D9D7 CDD3F0          17      CALL    _POS
000CA9 D9DA 7C               4      LD  A,H
000CAA D9DB 1804            12      JR  SCR1
       D9DD                     SCR:
000CAC D9DD 3A97F0          13      LD  A,(_LINE)
000CAF D9E0 3D               4      DEC A
       D9E1                     SCR1:
000CB0 D9E1 C5              11      PUSH    BC
000CB1 D9E2 D5              11      PUSH    DE
000CB2 D9E3 E5              11      PUSH    HL
000CB3 D9E4 1100D0          10      LD  DE,0D000H
000CB6 D9E7 2128D0          10      LD  HL,0D000H+WIDTH
                                
000CB9 D9EA 47               4      LD  B,A
000CBA D9EB B7               4      OR  A
000CBB D9EC C3A4CF          10      JP  IO_SCRUP
                                
       D9EF                     POS:
000CBE D9EF 2A8EF0          16      LD  HL,(_TXADR)
000CC1 D9F2 C5              11      PUSH    BC
000CC2 D9F3 01D8FF          10      LD  BC,0-WIDTH
000CC5 D9F6 AF               4      XOR A
       D9F7                     POS1:
000CC6 D9F7 09              11      ADD HL,BC
000CC7 D9F8 3C               4      INC A
000CC8 D9F9 38FC            12      JR  C,POS1
000CCA D9FB ED42            15      SBC HL,BC
000CCC D9FD 3D               4      DEC A
000CCD D9FE 67               4      LD  H,A
000CCE D9FF C1              10      POP BC
000CCF DA00 A7               4      AND A
000CD0 DA01 C9              10      RET
                                
       DA02                     GETL:
000CD1 DA02 CDD3F0          17      CALL    _POS
000CD4 DA05 E5              11      PUSH    HL
000CD5 DA06 3ECD             7      LD  A,0CDH      ;CALL ????
000CD7 DA08 323ED8          13      LD  (INSFLG),A
       DA0B                     GETL1:
000CDA DA0B CD27D7          17      CALL    _SYS08
000CDD DA0E FE09             7      CP  9
000CDF DA10 2008            12      JR  NZ,GETL1V
000CE1 DA12 2120FF          10      LD  HL,KBUF
000CE4 DA15 CD8AD4          17      CALL    MSX
000CE7 DA18 18F1            12      JR  GETL1
       DA1A                     GETL1V:
000CE9 DA1A 5F               4      LD  E,A
000CEA DA1B CDD3F0          17      CALL    _POS
000CED DA1E CDCDF0          17      CALL    _PRINT
000CF0 DA21 7B               4      LD  A,E
000CF1 DA22 FE20             7      CP  $20
000CF3 DA24 3809            12      JR  C,GETL1V1
000CF5 DA26 7D               4      LD  A,L
000CF6 DA27 FE27             7      CP  WIDTH-1
000CF8 DA29 2004            12      JR  NZ,GETL1V1
000CFA DA2B 7C               4      LD  A,H
000CFB DA2C 329BD9          13      LD  (MULINE),A
       DA2F                     GETL1V1:
000CFE DA2F 7B               4      LD  A,E
000CFF DA30 FE0D             7      CP  00DH
000D01 DA32 20D7            12      JR  NZ,GETL1
000D03 DA34 3E01             7      LD  A,1     ;LD BC,????
000D05 DA36 323ED8          13      LD  (INSFLG),A
000D08 DA39 1120FF          10      LD  DE,KBUF
000D0B DA3C 0628             7      LD  B,WIDTH
000D0D DA3E CD27D3          17      CALL    ZERO_MEMORY_DE
                                
000D10 DA41 D1              10      POP DE
000D11 DA42 CDD3F0          17      CALL    _POS
000D14 DA45 6B               4      LD  L,E
000D15 DA46 3E28             7      LD  A,WIDTH
000D17 DA48 95               4      SUB L
000D18 DA49 57               4      LD  D,A
                                
000D19 DA4A 3A9BD9          13      LD  A,(MULINE)
000D1C DA4D 94               4      SUB H
000D1D DA4E 2806            12      JR  Z,GL2X
000D1F DA50 3C               4      INC A
000D20 DA51 200C            12      JR  NZ,GL3X
000D22 DA53 25               4      DEC H
000D23 DA54 1805            12      JR  GL4X
       DA56                     GL2X:
000D25 DA56 3E1F             7      LD  A,$1F
000D27 DA58 CD11D7          17      CALL    MSG_A
       DA5B                     GL4X:
000D2A DA5B 7A               4      LD  A,D
000D2B DA5C C628             7      ADD A,WIDTH
000D2D DA5E 57               4      LD  D,A
       DA5F                     GL3X:
000D2E DA5F CD34D9          17      CALL    LOC1
000D31 DA62 4D               4      LD  C,L
000D32 DA63 7C               4      LD  A,H
000D33 DA64 C6D0             7      ADD A,0D0H
000D35 DA66 47               4      LD  B,A
000D36 DA67 5A               4      LD  E,D
000D37 DA68 2120FF          10      LD  HL,KBUF
       DA6B                     GETL2:
000D3A DA6B CDD0F0          17      CALL    _SCRN
000D3D DA6E 03               6      INC BC
000D3E DA6F 77               7      LD  (HL),A
000D3F DA70 23               6      INC HL
000D40 DA71 1D               4      DEC E
000D41 DA72 20F7            12      JR  NZ,GETL2
       DA74                     GETL3:
000D43 DA74 2B               6      DEC HL
000D44 DA75 7E               7      LD  A,(HL)
000D45 DA76 FE21             7      CP  021H
000D47 DA78 D0              11      RET NC
000D48 DA79 3600            10      LD  (HL),0
000D4A DA7B 15               4      DEC D
000D4B DA7C 20F6            12      JR  NZ,GETL3
000D4D DA7E C9              10      RET
                                
       DA7F                     INKEYB:
000D4E DA7F C1              10      POP BC
000D4F DA80 CB47             8      BIT 0,A
000D51 DA82 3E08             7      LD  A,8
000D53 DA84 2002            12      JR  NZ,INKEYD
000D55 DA86 3E03             7      LD  A,3
       DA88                     INKEYD:
000D57 DA88 3292F0          13      LD  (_KEYD),A
000D5A DA8B B7               4      OR  A
000D5B DA8C C9              10      RET
       DA8D                     INKEY:
000D5C DA8D E5              11      PUSH    HL
       DA8E                     GETKEY:
000D5D DA8E 3A92F0          13      LD  A,(_KEYD)
000D60 DA91 B7               4      OR  A
000D61 DA92 6F               4      LD  L,A
000D62 DA93 2610             7  GKSMC:  LD  H,16
       DA95                     GETKEY1:
000D64 DA95 3E01             7      LD  A,1
       DA96                     SKIP_KEYWAIT:   EQU $-1
000D66 DA97 B7               4      OR  A
000D67 DA98 C4C9DA          17      CALL    NZ,CHKEY    ;キーを離すまで待つ
000D6A DA9B 281E            12      JR  Z,GETKEY2
000D6C DA9D BD               4      CP  L
000D6D DA9E 201B            12      JR  NZ,GETKEY2
000D6F DAA0 CD1BCF          17      CALL    RD556VSYNC
000D72 DAA3 87               4      ADD A,A
000D73 DAA4 30EF            12      JR  NC,GETKEY1
       DAA6                     GETKEY1X:
000D75 DAA6 CDC9DA          17      CALL    CHKEY       ;キーを離すまで待つ
000D78 DAA9 2810            12      JR  Z,GETKEY2
000D7A DAAB BD               4      CP  L
000D7B DAAC 200D            12      JR  NZ,GETKEY2
000D7D DAAE CD1BCF          17      CALL    RD556VSYNC
000D80 DAB1 87               4      ADD A,A
000D81 DAB2 38F2            12      JR  C,GETKEY1X
000D83 DAB4 25               4      DEC H
000D84 DAB5 20DE            12      JR  NZ,GETKEY1
000D86 DAB7 3E01             7      LD  A,1
000D88 DAB9 1805            12      JR  GETKEY3
       DABB                     GETKEY2:
000D8A DABB 3E10             7      LD  A,16
000D8C DABD 3296DA          13      LD  (SKIP_KEYWAIT),A
       DAC0                     GETKEY3:
000D8F DAC0 3294DA          13      LD  (GKSMC+1),A
000D92 DAC3 3A92F0          13      LD  A,(_KEYD)
000D95 DAC6 B7               4      OR  A
000D96 DAC7 E1              10      POP HL
000D97 DAC8 C0              11      RET NZ
       DAC9                     CHKEY:
000D98 DAC9 C5              11      PUSH    BC
000D99 DACA 3E08             7      LD  A,8
000D9B DACC CD0ECF          17      CALL    RDKEYDATA
000D9E DACF 3293F0          13      LD  (_KEYD+1),A
000DA1 DAD2 CB7F             8      BIT 7,A
000DA3 DAD4 28A9            12      JR  Z,INKEYB
000DA5 DAD6 E5              11      PUSH    HL
000DA6 DAD7 0E07             7      LD  C,7
000DA8 DAD9 2140ED          10      LD  HL,KEY_TABLE
000DAB DADC CB47             8      BIT 0,A
000DAD DADE 2003            12      JR  NZ,CHKEY0
000DAF DAE0 2180ED          10      LD  HL,SHIFT_TABLE
       DAE3                     CHKEY0:
000DB2 DAE3 CB77             8      BIT 6,A
000DB4 DAE5 2003            12      JR  NZ,CHKEY1
000DB6 DAE7 21C0ED          10      LD  HL,CTRL_TABLE
       DAEA                     CHKEY1:
000DB9 DAEA 79               4      LD  A,C
000DBA DAEB CD0ECF          17      CALL    RDKEYDATA
000DBD DAEE 0608             7      LD  B,8
       DAF0                     CHKEY2:
000DBF DAF0 87               4      ADD A,A
000DC0 DAF1 3009            12      JR  NC,CHKEY3
000DC2 DAF3 23               6      INC HL
000DC3 DAF4 10FA            13      DJNZ    CHKEY2
000DC5 DAF6 0D               4      DEC C
000DC6 DAF7 79               4      LD  A,C
000DC7 DAF8 3C               4      INC A
000DC8 DAF9 20EF            12      JR  NZ,CHKEY1
000DCA DAFB 06                      DB  $06     ;LD B,?? 次の1バイトを飛ばす
       DAFC                     CHKEY3:
000DCB DAFC 7E               7      LD  A,(HL)
000DCC DAFD E1              10      POP HL
000DCD DAFE C1              10      POP BC
000DCE DAFF 1887            12      JR  INKEYD
                                
       DB01                     SCRN:
000DD0 DB01 E5              11      PUSH    HL
000DD1 DB02 CD35CF          17      CALL    RDMMIO_BC
000DD4 DB05 6F               4      LD  L,A
000DD5 DB06 26EF             7      LD  H,DC_TABLE/256
000DD7 DB08 7E               7      LD  A,(HL)
000DD8 DB09 FE41             7      CP  'A'     ;英小文字チェック
000DDA DB0B 380E            12      JR  C,SCRN1
000DDC DB0D FE5B             7      CP  'Z'+1
000DDE DB0F DC1DDB          17      CALL    C,SCRNC
000DE1 DB12 FEA6             7      CP  $A6     ;ひらがなチェック
000DE3 DB14 3805            12      JR  C,SCRN1
000DE5 DB16 FEE0             7      CP  $E0
000DE7 DB18 DC1DDB          17      CALL    C,SCRNC
       DB1B                     SCRN1:
000DEA DB1B E1              10      POP HL
000DEB DB1C C9              10      RET
                                
       DB1D                     SCRNC:
000DEC DB1D 6F               4      LD  L,A
000DED DB1E 60               4      LD  H,B
000DEE DB1F CBD8             8      SET 3,B
000DF0 DB21 CD35CF          17      CALL    RDMMIO_BC
000DF3 DB24 44               4      LD  B,H
000DF4 DB25 CB7F             8      BIT 7,A
000DF6 DB27 7D               4      LD  A,L
000DF7 DB28 C8              11      RET Z
000DF8 DB29 FE5B             7      CP  'Z'+1
000DFA DB2B 3804            12      JR  C,SCRNC_ADD
000DFC DB2D FEC0             7      CP  $C0
000DFE DB2F 3803            12      JR  C,SCRNC_SUB
       DB31                     SCRNC_ADD:
000E00 DB31 C620             7      ADD A,$20
000E02 DB33 C9              10      RET
       DB34                     SCRNC_SUB:
000E03 DB34 D620             7      SUB $20
000E05 DB36 C9              10      RET
[EOF:M7IO.ASM:SHIFT_JIS]
                                    INCLUDE "LDFILE.ASM"
                                
                                ;   LSX-Dodgers FILE
                                
       DB37                     FILEC:
000E06 DB37 CD42DB          17      CALL    FILE
       DB3A                     FILEC2:
000E09 DB3A 3A15F0          13      LD  A,(FDRV+1)
000E0C DB3D FE20             7      CP  020H
000E0E DB3F C8              11      RET Z
000E0F DB40 1839            12      JR  SETDIR1
                                
       DB42                     FILE:
000E11 DB42 AF               4      XOR A
000E12 DB43 3214F0          13      LD  (FDRV),A
000E15 DB46 67               4      LD  H,A
000E16 DB47 6F               4      LD  L,A
000E17 DB48 2222F0          16      LD  (FDRV+14),HL
000E1A DB4B CD19DC          17      CALL    SPCUT
000E1D DB4E CDFEDB          17      CALL    CCHK3
000E20 DB51 2812            12      JR  Z,DEVI1
000E22 DB53 13               6      INC DE
000E23 DB54 1A               7      LD  A,(DE)
000E24 DB55 1B               6      DEC DE
000E25 DB56 FE3A             7      CP  ':'
000E27 DB58 200B            12      JR  NZ,DEVI1
000E29 DB5A 1A               7      LD  A,(DE)      ;DRIVE
000E2A DB5B CD59DE          17      CALL    CAP
000E2D DB5E D640             7      SUB '@'
000E2F DB60 13               6      INC DE
000E30 DB61 13               6      INC DE
000E31 DB62 3214F0          13      LD  (FDRV),A
       DB65                     DEVI1:
000E34 DB65 1A               7      LD  A,(DE)
000E35 DB66 D65C             7      SUB 05CH        ;\
000E37 DB68 2009            12      JR  NZ,NOROOT
000E39 DB6A 6F               4      LD  L,A     ;A=0でH=0のはずなのでHL=0
000E3A DB6B 222EF0          16      LD  (FDRV+26),HL
000E3D DB6E 2C               4      INC L
000E3E DB6F 2222F0          16      LD  (FDRV+14),HL
000E41 DB72 13               6      INC DE
       DB73                     NOROOT:
                                
       DB73                     SETDIR:
000E42 DB73 CD9FDB          17      CALL    FILED
000E45 DB76 1A               7      LD  A,(DE)
000E46 DB77 FE5C             7      CP  05CH        ;\
000E48 DB79 C0              11      RET NZ
000E49 DB7A 13               6      INC DE
       DB7B                     SETDIR1:
000E4A DB7B 3E10             7      LD  A,010H      ;Directory
000E4C DB7D 3221F0          13      LD  (FDRV+13),A
000E4F DB80 D5              11      PUSH    DE
000E50 DB81 1114F0          10      LD  DE,FDRV
000E53 DB84 2A1EF1          16      LD  HL,(STABLE+2*00FH)
000E56 DB87 CD0F00          17      CALL    JP_HL
000E59 DB8A D1              10      POP DE
000E5A DB8B B7               4      OR  A
000E5B DB8C C0              11      RET NZ
                                
000E5C DB8D 3A21F0          13      LD  A,(FDRV+13)
000E5F DB90 CB67             8      BIT 4,A
000E61 DB92 C8              11      RET Z
                                
000E62 DB93 CDE6DB          17      CALL    FILEI
000E65 DB96 2A2EF0          16      LD  HL,(FDRV+26)
000E68 DB99 23               6      INC HL
000E69 DB9A 2222F0          16      LD  (FDRV+14),HL
000E6C DB9D 18D4            12      JR  SETDIR
                                
       DB9F                     FILED:
000E6E DB9F CDE6DB          17      CALL    FILEI
000E71 DBA2 2115F0          10      LD  HL,FNAME
                                
000E74 DBA5 0608             7      LD  B,8
       DBA7                     FILE2:
000E76 DBA7 CDF3DB          17      CALL    CCHKF
000E79 DBAA C8              11      RET Z
000E7A DBAB FE2A             7      CP  '*'
000E7C DBAD 282E            12      JR  Z,FILE9
000E7E DBAF FE2E             7      CP  '.'
000E80 DBB1 280C            12      JR  Z,FILE4
000E82 DBB3 77               7      LD  (HL),A
000E83 DBB4 23               6      INC HL
000E84 DBB5 10F0            13      DJNZ    FILE2
                                
       DBB7                     FILE3:
000E86 DBB7 CDF3DB          17      CALL    CCHKF
000E89 DBBA C8              11      RET Z
000E8A DBBB FE2E             7      CP  '.'
000E8C DBBD 20F8            12      JR  NZ,FILE3
                                
       DBBF                     FILE4:
000E8E DBBF 211DF0          10      LD  HL,FNAME+8
000E91 DBC2 0603             7      LD  B,3
                                
       DBC4                     FILE4L:
000E93 DBC4 CDF3DB          17      CALL    CCHKF
000E96 DBC7 C8              11      RET Z
000E97 DBC8 FE2E             7      CP  '.'
000E99 DBCA 2008            12      JR  NZ,FILE12
000E9B DBCC 3215F0          13      LD  (FNAME),A   ;Parent directory(..)
000E9E DBCF 3216F0          13      LD  (FNAME+1),A
000EA1 DBD2 3E20             7      LD  A,020H
       DBD4                     FILE12:
000EA3 DBD4 FE2A             7      CP  '*'
000EA5 DBD6 280A            12      JR  Z,FILE10
000EA7 DBD8 77               7      LD  (HL),A
000EA8 DBD9 23               6      INC HL
000EA9 DBDA 10E8            13      DJNZ    FILE4L
000EAB DBDC C9              10      RET
                                
       DBDD                     FILE9:              ;名前の*処理、名前の残りを?で埋める
000EAC DBDD CDE2DB          17      CALL    FILE10
000EAF DBE0 18D5            12      JR  FILE3
                                
       DBE2                     FILE10:
000EB1 DBE2 3E3F             7      LD  A,'?'
000EB3 DBE4 1808            12      JR  FILL_MEMORY
       DBE6                     FILEI:              ;名前＋拡張子をスペースで初期化
000EB5 DBE6 3E20             7      LD  A,020H
000EB7 DBE8 01000B          10      LD  BC,11*256   ;C=0にしておく
000EBA DBEB 2115F0          10      LD  HL,FNAME
       DBEE                     FILL_MEMORY:            ;HLからBバイトAで埋める
000EBD DBEE 77               7      LD  (HL),A
000EBE DBEF 23               6      INC HL
000EBF DBF0 10FC            13      DJNZ    FILL_MEMORY
000EC1 DBF2 C9              10      RET
                                
       DBF3                     CCHKF:
000EC2 DBF3 1A               7      LD  A,(DE)
000EC3 DBF4 CDFBDB          17      CALL    CCHK2
000EC6 DBF7 C8              11      RET Z
000EC7 DBF8 C366DF          10      JP  FKAN
                                
       DBFB                     CCHK2:
000ECA DBFB 0C               4      INC C
000ECB DBFC 0D               4      DEC C
000ECC DBFD C0              11      RET NZ
       DBFE                     CCHK3:              ;ZF=1 で使えない文字
000ECD DBFE FE2B             7      CP  '+'
000ECF DC00 C8              11      RET Z
000ED0 DC01 FE2C             7      CP  ','
000ED2 DC03 C8              11      RET Z
000ED3 DC04 FE2F             7      CP  '/'
000ED5 DC06 C8              11      RET Z
000ED6 DC07 FE3A             7      CP  ':'
000ED8 DC09 C8              11      RET Z
000ED9 DC0A FE3B             7      CP  ';'
000EDB DC0C C8              11      RET Z
000EDC DC0D FE3D             7      CP  '='
000EDE DC0F C8              11      RET Z
000EDF DC10 FE5C             7      CP  05CH    ;\
000EE1 DC12 C8              11      RET Z
000EE2 DC13 FE20             7      CP  020H
000EE4 DC15 D0              11      RET NC
000EE5 DC16 BF               4      CP  A       ;Z=1
000EE6 DC17 C9              10      RET
                                
       DC18                     SS1:
000EE7 DC18 13               6      INC DE
       DC19                     SPCUT:              ;スペースをカット
000EE8 DC19 1A               7      LD  A,(DE)
000EE9 DC1A FE20             7      CP  020H
000EEB DC1C 28FA            12      JR  Z,SS1
000EED DC1E C9              10      RET
                                
       DC1F                     SETDRVF:
000EEE DC1F 1114F0          10      LD  DE,FDRV
       DC22                     SETDRV0:
000EF1 DC22 CD2BDC          17      CALL    SETDRV
000EF4 DC25 FDE1            14      POP IY
000EF6 DC27 C1              10      POP BC
000EF7 DC28 D1              10      POP DE
000EF8 DC29 E1              10      POP HL
000EF9 DC2A C9              10      RET
                                
       DC2B                     SETDRV:
000EFA DC2B E3              19      EX  (SP),HL     ;HL=RETRN ADDRESS
000EFB DC2C D5              11      PUSH    DE      ;PUSH HL/DE/BC/IY
000EFC DC2D C5              11      PUSH    BC
000EFD DC2E 1A               7      LD  A,(DE)
000EFE DC2F D5              11      PUSH    DE
000EFF DC30 FDE3            23      EX  (SP),IY
                                
000F01 DC32 CD39DC          17      CALL    GETDRV
000F04 DC35 CDD9F0          17      CALL    _CHGDRV
                                
000F07 DC38 E9               4      JP  (HL)
                                
       DC39                     GETDRV:
000F08 DC39 CD4CDC          17      CALL    GETDRV1
000F0B DC3C 3288F0          13      LD  (_DRV),A
000F0E DC3F C9              10      RET
                                
       DC40                     IS_SAME_DRV_A_DE:
                                ;   A と (DE) が同じドライブか調べる
                                ;   ZF=1ならば同じドライブ
000F0F DC40 CD4CDC          17      CALL    GETDRV1
000F12 DC43 C5              11      PUSH    BC
000F13 DC44 4F               4      LD  C,A
000F14 DC45 1A               7      LD  A,(DE)
000F15 DC46 CD4CDC          17      CALL    GETDRV1
000F18 DC49 A9               4      XOR C
000F19 DC4A C1              10      POP BC
000F1A DC4B C9              10      RET
       DC4C                     GETDRV1:
000F1B DC4C E67F             7      AND 07FH
000F1D DC4E D601             7      SUB 001H
000F1F DC50 D0              11      RET NC
000F20 DC51 3A87F0          13      LD  A,(_DVSW)   ;Current Drive
000F23 DC54 C9              10      RET
                                
       DC55                     SOPENX:
000F24 DC55 1139F0          10      LD  DE,SFILE
000F27 DC58 FD7E00          19      LD  A,(IY+0)        ;(FCB)ドライブ番号
000F2A DC5B CD40DC          17      CALL    IS_SAME_DRV_A_DE
000F2D DC5E 2024            12      JR  NZ,SOPEN
000F2F DC60 13               6      INC DE
000F30 DC61 FDE5            15      PUSH    IY
000F32 DC63 E1              10      POP HL
000F33 DC64 23               6      INC HL
000F34 DC65 CDF1DD          17      CALL    CPFILE
000F37 DC68 201A            12      JR  NZ,SOPEN
                                
000F39 DC6A 2AF4F1          16      LD  HL,(SCDIR)
000F3C DC6D FD750E          19      LD  (IY+14),L   ;(FCB)アクセスするディレクトリのクラスタ番号+1
000F3F DC70 FD740F          19      LD  (IY+15),H
                                
000F42 DC73 2AF8F1          16      LD  HL,(SFNDF)  ;Direcroty location and Flags
000F45 DC76 229FF0          16      LD  (_FILEN),HL
                                
000F48 DC79 ED5BF6F1        20      LD  DE,(SFBPS)
000F4C DC7D 2139F0          10      LD  HL,SFILE
000F4F DC80 36FF            10      LD  (HL),0FFH
000F51 DC82 23               6      INC HL
000F52 DC83 C9              10      RET
       DC84                     SOPEN:
000F53 DC84 2199DD          10      LD  HL,FILESE
       DC87                     SOPENC:
000F56 DC87 22C0DC          16      LD  (OPENPAT),HL
                                
000F59 DC8A CDE2F0          17      CALL    _RDFATX     ;Detect Media
000F5C DC8D 3856            12      JR  C,RDDERR
                                
000F5E DC8F AF               4      XOR A
000F5F DC90 329FF0          13      LD  (_FILEN),A
000F62 DC93 CD99DE          17      CALL    LDDIRX1     ;A=0で呼び出す
000F65 DC96 2818            12      JR  Z,SDIRX1
                                
000F67 DC98 CD8ADD          17      CALL    READ_DIR    ;Sub Directory
000F6A DC9B 3808            12      JR  C,SDIRX0
000F6C DC9D 2A7EF1          16      LD  HL,(_DTBUF)
000F6F DCA0 7E               7      LD  A,(HL)
000F70 DCA1 FE2E             7      CP  '.'
000F72 DCA3 280F            12      JR  Z,SOPEN1
       DCA5                     SDIRX0:
000F74 DCA5 AF               4      XOR A
000F75 DCA6 32A0F0          13      LD  (_DIRF),A
000F78 DCA9 FD360E01        19      LD  (IY+14),1   ;(FCB)レコードサイズ
000F7C DCAD FD770F          19      LD  (IY+15),A
       DCB0                     SDIRX1:
000F7F DCB0 ED5BFCF1        20      LD  DE,(_DIRPS) ;Root Directory
       DCB4                     SOPEN1:
000F83 DCB4 0E20             7      LD  C,32        ;自己書き換え 1セクタ辺りのディレクトリエントリ数  1024=32 / 512=16 / 256=8
       DCB5                     SDECPAT EQU $-1
       DCB6                     SOPEN1X:
000F85 DCB6 CD8ADD          17      CALL    READ_DIR    ;FILE SEARCH
000F88 DCB9 382A            12      JR  C,RDDERR
000F8A DCBB 2A7EF1          16      LD  HL,(_DTBUF)
       DCBE                     SOPEN2:
000F8D DCBE D5              11      PUSH    DE
000F8E DCBF CD99DD          17      CALL    FILESE      ;(self-modifying code)
       DCC0                     OPENPAT EQU $-2
000F91 DCC2 D1              10      POP DE
000F92 DCC3 386D            12      JR  C,SOPENE
000F94 DCC5 281B            12      JR  Z,SCF_FF_RET
       DCC7                     SOPEN3:
000F96 DCC7 3AA0F0          13      LD  A,(_DIRF)   ;ディレクトリか判別
000F99 DCCA B7               4      OR  A
000F9A DCCB 200C            12      JR  NZ,SOPEN5
000F9C DCCD 13               6      INC DE      ;ルートディレクトリ
000F9D DCCE E5              11      PUSH    HL
000F9E DCCF 210C00          10      LD  HL,12       ;(self-modifying code)MAXDIR
       DCD0                     MD_PAT  EQU $-2
000FA1 DCD2 ED52            15      SBC HL,DE       ;CF=0 なので SUB HL,DE
000FA3 DCD4 E1              10      POP HL
000FA4 DCD5 20DD            12      JR  NZ,SOPEN1
000FA6 DCD7 1807            12      JR  SOPEN6
       DCD9                     SOPEN5:
000FA8 DCD9 CDA8E5          17      CALL    GNCLX       ;END DIR
000FAB DCDC D8              11      RET C
000FAC DCDD CD51DE          17      CALL    ENDCL
       DCE0                     SOPEN6:
000FAF DCE0 38D2            12      JR  C,SOPEN1
       DCE2                     SCF_FF_RET:
000FB1 DCE2 37               4      SCF         ;CF=1
000FB2 DCE3 9F               4      SBC A,A     ;A=0FFH
000FB3 DCE4 C9              10      RET
                                
       DCE5                     RDDERR:
000FB4 DCE5 BF               4      CP  A       ;READ ERR CF=1 ZF=1
000FB5 DCE6 37               4      SCF
000FB6 DCE7 C9              10      RET
                                
       DCE8                     NOPEN:
000FB7 DCE8 2199DD          10      LD  HL,FILESE
000FBA DCEB 22C0DC          16      LD  (OPENPAT),HL
000FBD DCEE FD2A98F0        20      LD  IY,(_FCB)
000FC1 DCF2 CD79DF          17      CALL    CHKWILDX
000FC4 DCF5 30EB            12      JR  NC,SCF_FF_RET
000FC6 DCF7 FD7E00          19      LD  A,(IY+0)
000FC9 DCFA CD39DC          17      CALL    GETDRV
000FCC DCFD CDD9F0          17      CALL    _CHGDRV
000FCF DD00 D8              11      RET C
000FD0 DD01 2AF8F1          16      LD  HL,(SFNDF)  ;Direcroty location and Flags
000FD3 DD04 229FF0          16      LD  (_FILEN),HL
                                
000FD6 DD07 CD94DE          17      CALL    LDDIRX
000FD9 DD0A ED5B9AF0        20      LD  DE,(_FBPS)
000FDD DD0E CD8ADD          17      CALL    READ_DIR
000FE0 DD11 38D2            12      JR  C,RDDERR
000FE2 DD13 3A9EF0          13      LD  A,(_FBCNT)
000FE5 DD16 3D               4      DEC A
000FE6 DD17 28AE            12      JR  Z,SOPEN3
       DD19                     NOPEN2:
000FE8 DD19 2A9CF0          16      LD  HL,(_FBAD)
000FEB DD1C 012000          10      LD  BC,020H
000FEE DD1F 09              11      ADD HL,BC
000FEF DD20 4F               4      LD  C,A
000FF0 DD21 189B            12      JR  SOPEN2
                                
       DD23                     SOPENE2:
000FF2 DD23 229CF0          16      LD  (_FBAD),HL
000FF5 DD26 79               4      LD  A,C
000FF6 DD27 329EF0          13      LD  (_FBCNT),A
000FF9 DD2A ED539AF0        20      LD  (_FBPS),DE
000FFD DD2E FD2298F0        20      LD  (_FCB),IY
       DD32                     SOPENE:
001001 DD32 AF               4      XOR A
001002 DD33 C9              10      RET
                                
       DD34                     COPEN:
001003 DD34 FD360D20        19      LD  (IY+13),020H    ;(FCB)属性(アトリビュート)
                                
001007 DD38 21B6DD          10      LD  HL,NEXTSE
00100A DD3B CD87DC          17      CALL    SOPENC
00100D DD3E D0              11      RET NC
00100E DD3F C8              11      RET Z
00100F DD40 3AA0F0          13      LD  A,(_DIRF)   ;ディレクトリか判別
001012 DD43 B7               4      OR  A
001013 DD44 37               4      SCF
001014 DD45 C8              11      RET Z       ;ルートディレクトリ
001015 DD46 0601             7      LD  B,1
001017 DD48 CDD8DF          17      CALL    WRDF
00101A DD4B D8              11      RET C
00101B DD4C ED5BFEF1        20      LD  DE,(_CLPS)
00101F DD50 D5              11      PUSH    DE
001020 DD51 CD1ADE          17      CALL    DCPAT
001023 DD54 CD33E4          17      CALL    DRDNX
001026 DD57 2A7EF1          16      LD  HL,(_DTBUF) ;ディレクトリエントリを0クリア
001029 DD5A 3A3DE3          13      LD  A,(SECSZ+2) ;1024=4 / 512=2 / 256=1
00102C DD5D 47               4      LD  B,A
00102D DD5E AF               4      XOR A
00102E DD5F 4F               4      LD  C,A
       DD60                     COPENCL:
00102F DD60 77               7      LD  (HL),A
001030 DD61 EDA1            16      CPI         ;HL=HL+1 BC=BC-1 BCが0の場合にP/V=0
001032 DD63 EA60DD          10      JP  PE,COPENCL
                                
001035 DD66 3A38DE          13      LD  A,(SPCPAT)  ;1クラスタの論理セクタ数
001038 DD69 3D               4      DEC A
001039 DD6A 2819            12      JR  Z,COPENE
00103B DD6C 3E01             7      LD  A,1     ;1セクタ辺りのセクタ数が2以上の場合
00103D DD6E 32A0E5          13      LD  (_SECPS),A
001040 DD71 D1              10      POP DE      ;DE=(_CLPS)
001041 DD72 D5              11      PUSH    DE
       DD73                     COPEN1:
001042 DD73 D5              11      PUSH    DE      ;データバッファに入らないセクタもゼロクリア
001043 DD74 C5              11      PUSH    BC
001044 DD75 2A7EF1          16      LD  HL,(_DTBUF)
001047 DD78 CD34DE          17      CALL    CLUSTX
00104A DD7B CD38E7          17      CALL    DWT24
00104D DD7E C1              10      POP BC
00104E DD7F D1              10      POP DE
00104F DD80 CD9FE5          17      CALL    NEXTX
001052 DD83 20EE            12      JR  NZ,COPEN1
       DD85                     COPENE:
001054 DD85 2A7EF1          16      LD  HL,(_DTBUF)
001057 DD88 D1              10      POP DE
001058 DD89 C9              10      RET
                                
       DD8A                     READ_DIR:
001059 DD8A ED53FEF1        20      LD  (_CLPS),DE
00105D DD8E C5              11      PUSH    BC
00105E DD8F D5              11      PUSH    DE
00105F DD90 CD1ADE          17      CALL    DCPAT
001062 DD93 CD13E4          17      CALL    DRDX
001065 DD96 D1              10      POP DE
001066 DD97 C1              10      POP BC
001067 DD98 C9              10      RET
                                
       DD99                     FILESE:
001068 DD99 7E               7      LD  A,(HL)
001069 DD9A B7               4      OR  A
00106A DD9B C8              11      RET Z       ;END:ZF=1 CF=0
00106B DD9C FEE5             7      CP  0E5H
00106D DD9E 280E            12      JR  Z,FILESE1
00106F DDA0 FDE5            15      PUSH    IY
001071 DDA2 D1              10      POP DE
001072 DDA3 13               6      INC DE
001073 DDA4 E5              11      PUSH    HL
001074 DDA5 CDF1DD          17      CALL    CPFILE
001077 DDA8 CC12DE          17      CALL    Z,CPFILE2
00107A DDAB E1              10      POP HL
00107B DDAC 37               4      SCF
00107C DDAD C8              11      RET Z       ;!!!:(ZF=1) CF=1
       DDAE                     FILESE1:
00107D DDAE CDC5DD          17      CALL    FNEXT
001080 DDB1 20E6            12      JR  NZ,FILESE
       DDB3                     ZF0_CF0_AFF_RET:
001082 DDB3 F6FF             7      OR  0FFH        ;ZF=0 CF=0
001084 DDB5 C9              10      RET
                                
       DDB6                     NEXTSE:
001085 DDB6 7E               7      LD  A,(HL)
001086 DDB7 B7               4      OR  A
001087 DDB8 37               4      SCF
001088 DDB9 C8              11      RET Z       ;!!!:ZF=1 CF=1
001089 DDBA FEE5             7      CP  0E5H
00108B DDBC 37               4      SCF
00108C DDBD C8              11      RET Z       ;!!!:(ZF=1) CF=1
00108D DDBE CDC5DD          17      CALL    FNEXT
001090 DDC1 20F3            12      JR  NZ,NEXTSE
001092 DDC3 18EE            12      JR  ZF0_CF0_AFF_RET
                                
       DDC5                     FNEXT:
001094 DDC5 E5              11      PUSH    HL
001095 DDC6 219FF0          10      LD  HL,_FILEN
001098 DDC9 34              11      INC (HL)
001099 DDCA E1              10      POP HL
00109A DDCB 112000          10      LD  DE,020H
00109D DDCE 19              11      ADD HL,DE
00109E DDCF 0D               4      DEC C
00109F DDD0 C9              10      RET
                                
       DDD1                     CPNAME:
0010A0 DDD1 C5              11      PUSH    BC
0010A1 DDD2 D5              11      PUSH    DE
0010A2 DDD3 E5              11      PUSH    HL
0010A3 DDD4 CDEBDD          17      CALL    CPFILE4
0010A6 DDD7 E1              10      POP HL
0010A7 DDD8 23               6      INC HL
0010A8 DDD9 23               6      INC HL
0010A9 DDDA 23               6      INC HL
0010AA DDDB 23               6      INC HL
0010AB DDDC D1              10      POP DE
0010AC DDDD C1              10      POP BC
0010AD DDDE 2005            12      JR  NZ,CPNAME1
0010AF DDE0 7E               7      LD  A,(HL)
0010B0 DDE1 23               6      INC HL
0010B1 DDE2 66               7      LD  H,(HL)
0010B2 DDE3 6F               4      LD  L,A
0010B3 DDE4 C9              10      RET
       DDE5                     CPNAME1:
0010B4 DDE5 23               6      INC HL
0010B5 DDE6 23               6      INC HL
0010B6 DDE7 10E8            13      DJNZ    CPNAME
0010B8 DDE9 37               4      SCF
0010B9 DDEA C9              10      RET
                                
       DDEB                     CPFILE4:
0010BA DDEB C5              11      PUSH    BC
0010BB DDEC 010004          10      LD  BC,00400H
0010BE DDEF 1804            12      JR  CPSTR1
       DDF1                     CPFILE:
0010C0 DDF1 C5              11      PUSH    BC
0010C1 DDF2 01000B          10      LD  BC,00B00H
       DDF5                     CPSTR1:
0010C4 DDF5 1A               7      LD  A,(DE)
0010C5 DDF6 FE3F             7      CP  '?'     ;Wild card
0010C7 DDF8 2812            12      JR  Z,CPSTR2
0010C9 DDFA 7E               7      LD  A,(HL)
0010CA DDFB CD5FDF          17      CALL    FKANC
0010CD DDFE E5              11      PUSH    HL
0010CE DDFF 67               4      LD  H,A
0010CF DE00 1A               7      LD  A,(DE)
0010D0 DE01 CB01             4      RLC C
0010D2 DE03 CD5FDF          17      CALL    FKANC
0010D5 DE06 CB09             4      RRC C
0010D7 DE08 BC               4      CP  H       ;CP (HL),(DE)
0010D8 DE09 E1              10      POP HL
0010D9 DE0A 2004            12      JR  NZ,CPSTR3
       DE0C                     CPSTR2:
0010DB DE0C 13               6      INC DE
0010DC DE0D 23               6      INC HL
0010DD DE0E 10E5            13      DJNZ    CPSTR1
       DE10                     CPSTR3:
0010DF DE10 C1              10      POP BC
0010E0 DE11 C9              10      RET
                                
       DE12                     CPFILE2:
0010E1 DE12 FD7E0D          19      LD  A,(IY+13)   ;(FCB)属性(アトリビュート)
0010E4 DE15 F6E1             7      OR  0E1H
0010E6 DE17 2F               4      CPL
0010E7 DE18 A6               7      AND (HL)
0010E8 DE19 C9              10      RET
                                
       DE1A                     DCPAT:
0010E9 DE1A 0E00             7      LD  C,0
0010EB DE1C 2A7EF1          16      LD  HL,(_DTBUF)
0010EE DE1F 3AA0F0          13      LD  A,(_DIRF)   ;ディレクトリか判別
0010F1 DE22 B7               4      OR  A
0010F2 DE23 C8              11      RET Z       ;ルートディレクトリの場合はCレジスタを0にしておく(CDEがセクタ番号)
0010F3 DE24 3A38DE          13      LD  A,(SPCPAT)
0010F6 DE27 4F               4      LD  C,A
0010F7 DE28 3AA0E5          13      LD  A,(_SECPS)
0010FA DE2B B9               4      CP  C
0010FB DE2C 3801            12      JR  C,DC1
0010FD DE2E AF               4      XOR A
       DE2F                     DC1:
0010FE DE2F F680             7      OR  080H
001100 DE31 32A0F0          13      LD  (_DIRF),A   ;bit0-6:セクタインデックス
       DE34                     CLUSTX:
001103 DE34 E5              11      PUSH    HL
001104 DE35 EB               4      EX  DE,HL
001105 DE36 AF               4      XOR A
001106 DE37 0E01             7      LD  C,1     ;自己書き換え（1クラスタの論理セクタ数）
       DE38                     SPCPAT  EQU $-1
       DE39                     L_CLDBL:
001108 DE39 CB19             8      RR  C       ;->CF
00110A DE3B 3804            12      JR  C,E_CLDBL
00110C DE3D 29              11      ADD HL,HL       ;*2
00110D DE3E 8F               4      ADC A,A
00110E DE3F 18F8            12      JR  L_CLDBL
       DE41                     E_CLDBL:
001110 DE41 4F               4      LD  C,A
001111 DE42 3AA0E5          13      LD  A,(_SECPS)
001114 DE45 B5               4      OR  L
001115 DE46 6F               4      LD  L,A
001116 DE47 110800          10      LD  DE,8    ;+8 (2D)  !ADDCL (self-modifying code)
       DE48                     CLSPAT  EQU $-2
001119 DE4A AF               4      XOR A
00111A DE4B 19              11      ADD HL,DE   ;データ格納領域の先頭論理セクタ番号
00111B DE4C 89               4      ADC A,C
00111C DE4D 4F               4      LD  C,A
00111D DE4E EB               4      EX  DE,HL
00111E DE4F E1              10      POP HL
00111F DE50 C9              10      RET
                                
       DE51                     ENDCL:
001120 DE51 7A               4      LD  A,D ;END CLUSTER
001121 DE52 FE01             7      CP  1   ;164=356    (self-modifying code)
       DE53                     CLPAT1  EQU $-1
001123 DE54 C0              11      RET NZ
001124 DE55 7B               4      LD  A,E
001125 DE56 FE64             7      CP  064H    ;       (self-modifying code)
       DE57                     CLPAT2  EQU $-1
001127 DE58 C9              10      RET
                                
       DE59                     CAP:
001128 DE59 FE61             7      CP  'a'
00112A DE5B D8              11      RET C
00112B DE5C FE7B             7      CP  'z'+1
00112D DE5E D0              11      RET NC
00112E DE5F D620             7      SUB 020H
001130 DE61 C9              10      RET
       DE62                     CAP2:
001131 DE62 CD59DE          17      CALL    CAP
       DE65                     CAP3:               ;
001134 DE65 FE05             7      CP  5
001136 DE67 2803            12      JR  Z,CAP4
001138 DE69 FE21             7      CP  021H
00113A DE6B C9              10      RET
       DE6C                     CAP4:
00113B DE6C 3EE5             7      LD  A,0E5H
00113D DE6E C9              10      RET
                                
       DE6F                     CHDIR:
00113E DE6F CD5AE8          17      CALL    GETDPBD
001141 DE72 381D            12      JR  C,CHDIR2
001143 DE74 DD751A          19      LD  (IX+DPB_SDIR),L
001146 DE77 DD741B          19      LD  (IX+DPB_SDIR+1),H
001149 DE7A 1815            12      JR  CHDIR2      ;POP_IX_RET
                                
       DE7C                     LDDIR:
00114B DE7C CD5AE8          17      CALL    GETDPBD
00114E DE7F DD5E1A          19      LD  E,(IX+DPB_SDIR)
001151 DE82 DD561B          19      LD  D,(IX+DPB_SDIR+1)
001154 DE85 13               6      INC DE
001155 DE86 FD730E          19      LD  (IY+14),E   ;(FCB)アクセスするディレクトリのクラスタ番号+1
001158 DE89 FD720F          19      LD  (IY+15),D
00115B DE8C 1B               6      DEC DE
00115C DE8D AF               4      XOR A
00115D DE8E 32A0F0          13      LD  (_DIRF),A
       DE91                     CHDIR2:
001160 DE91 DDE1            14      POP IX
001162 DE93 C9              10      RET
                                
       DE94                     LDDIRX:
001163 DE94 3AA0F0          13      LD  A,(_DIRF)   ;(FCB)アクセスするディレクトリのセクタインデックス
001166 DE97 E67F             7      AND 07FH
       DE99                     LDDIRX1:
001168 DE99 32A0E5          13      LD  (_SECPS),A
00116B DE9C FD5E0E          19      LD  E,(IY+14)   ;(FCB)アクセスするディレクトリのクラスタ番号+1
00116E DE9F FD560F          19      LD  D,(IY+15)
001171 DEA2 1B               6      DEC DE
001172 DEA3 CD51DE          17      CALL    ENDCL
001175 DEA6 D47CDE          17      CALL    NC,LDDIR
       DEA9                     LDDIRS:
001178 DEA9 7A               4      LD  A,D
001179 DEAA B3               4      OR  E
00117A DEAB 32A0F0          13      LD  (_DIRF),A   ;ディレクトリか判別
00117D DEAE C9              10      RET
                                
       DEAF                     KILL:
00117E DEAF CD79DF          17      CALL    CHKWILDX
001181 DEB2 3834            12      JR  C,KILLW
001183 DEB4 CD55DC          17      CALL    SOPENX
       DEB7                     KILLS:
001186 DEB7 3E1F             7      LD  A,01FH
001188 DEB9 D4FBDE          17      CALL    NC,CHKATT
00118B DEBC D8              11      RET C
       DEBD                     KILLSX:
00118C DEBD 36E5            10      LD  (HL),0E5H   ;DIR
00118E DEBF CD53DF          17      CALL    WTDB
001191 DEC2 111A00          10      LD  DE,01AH
001194 DEC5 19              11      ADD HL,DE
001195 DEC6 5E               7      LD  E,(HL)
001196 DEC7 23               6      INC HL
001197 DEC8 56               7      LD  D,(HL)
       DEC9                     KILLS1:
001198 DEC9 CD51DE          17      CALL    ENDCL
00119B DECC D0              11      RET NC      ;CF=0
00119C DECD 21FEFF          10      LD  HL,0-2
00119F DED0 19              11      ADD HL,DE
0011A0 DED1 D0              11      RET NC      ;DE= 0 or 1
0011A1 DED2 D5              11      PUSH    DE
0011A2 DED3 CDF7F0          17      CALL    _GNCL
0011A5 DED6 ED53FEF1        20      LD  (_CLPS),DE
0011A9 DEDA D1              10      POP DE
0011AA DEDB 210000          10      LD  HL,0
0011AD DEDE D4FAF0          17      CALL    NC,_SNCL
0011B0 DEE1 D8              11      RET C
0011B1 DEE2 ED5BFEF1        20      LD  DE,(_CLPS)  ;FAT
0011B5 DEE6 18E1            12      JR  KILLS1
                                
       DEE8                     KILLW:
0011B7 DEE8 CD84DC          17      CALL    SOPEN
       DEEB                     KILLW1:
0011BA DEEB 380B            12      JR  C,KILLW2
0011BC DEED CD23DD          17      CALL    SOPENE2
0011BF DEF0 CDB7DE          17      CALL    KILLS
0011C2 DEF3 CDE8DC          17      CALL    NOPEN
0011C5 DEF6 18F3            12      JR  KILLW1
       DEF8                     KILLW2:
0011C7 DEF8 C8              11      RET Z
0011C8 DEF9 3F               4      CCF
0011C9 DEFA C9              10      RET
                                
       DEFB                     CHKATT:
0011CA DEFB E5              11      PUSH    HL
0011CB DEFC 110B00          10      LD  DE,00BH
0011CE DEFF 19              11      ADD HL,DE
0011CF DF00 A6               7      AND (HL)
0011D0 DF01 E1              10      POP HL
0011D1 DF02 C8              11      RET Z
0011D2 DF03 37               4      SCF
0011D3 DF04 C9              10      RET
                                
       DF05                     NAME:
0011D4 DF05 CD79DF          17      CALL    CHKWILDX
0011D7 DF08 D8              11      RET C
0011D8 DF09 110400          10      LD  DE,4
0011DB DF0C 19              11      ADD HL,DE
0011DC DF0D 2222DF          16      LD  (NAMEP),HL
0011DF DF10 23               6      INC HL
0011E0 DF11 CD7DDF          17      CALL    CHKWILD
0011E3 DF14 D8              11      RET C
                                
0011E4 DF15 CD55DC          17      CALL    SOPENX
0011E7 DF18 3E0F             7      LD  A,00FH
0011E9 DF1A D4FBDE          17      CALL    NC,CHKATT
0011EC DF1D D8              11      RET C
                                
0011ED DF1E FDE5            15      PUSH    IY
0011EF DF20 FD210000        14      LD  IY,0        ;自己書き換え
       DF22                     NAMEP   EQU $-2
0011F3 DF24 CD55DC          17      CALL    SOPENX
0011F6 DF27 FDE3            23      EX  (SP),IY
0011F8 DF29 3F               4      CCF
0011F9 DF2A D484DC          17      CALL    NC,SOPEN
0011FC DF2D EB               4      EX  DE,HL
0011FD DF2E E1              10      POP HL
0011FE DF2F D8              11      RET C
                                
       DF30                     SETNAME:
0011FF DF30 01000B          10      LD  BC,11*256
001202 DF33 23               6      INC HL
001203 DF34 7E               7      LD  A,(HL)
001204 DF35 FEE5             7      CP  0E5H
001206 DF37 2004            12      JR  NZ,SNAME1
001208 DF39 3E05             7      LD  A,5
00120A DF3B 180E            12      JR  SNAME3
       DF3D                     SNAME1:
00120C DF3D 7E               7      LD  A,(HL)
00120D DF3E 0C               4      INC C
00120E DF3F 0D               4      DEC C
00120F DF40 2009            12      JR  NZ,SNAME3
001211 DF42 CD59DE          17      CALL    CAP
001214 DF45 FEA0             7      CP  0A0H
001216 DF47 2002            12      JR  NZ,SNAME3
001218 DF49 3E20             7      LD  A,020H
       DF4B                     SNAME3:
00121A DF4B 12               7      LD  (DE),A
00121B DF4C 7E               7      LD  A,(HL)
00121C DF4D 23               6      INC HL
00121D DF4E CD66DF          17      CALL    FKAN
001220 DF51 10EA            13      DJNZ    SNAME1
       DF53                     WTDB:
001222 DF53 3EFF             7      LD  A,0FFH
001224 DF55 3239F0          13      LD  (SFILE),A
       DF58                     SWTDBF:
001227 DF58 3E01             7      LD  A,1
001229 DF5A 32A4F0          13      LD  (_WTDBF),A
00122C DF5D AF               4      XOR A
00122D DF5E C9              10      RET
                                
       DF5F                     FKANC:
00122E DF5F CB41             8      BIT 0,C
001230 DF61 CC62DE          17      CALL    Z,CAP2
001233 DF64 1801            12      JR  FKANX
       DF66                     FKAN:           ;漢字チェック
001235 DF66 13               6      INC DE
       DF67                     FKANX:
001236 DF67 CB41             8      BIT 0,C
001238 DF69 CB81             8      RES 0,C
00123A DF6B C0              11      RET NZ
00123B DF6C FE80             7      CP  080H
00123D DF6E D8              11      RET C
00123E DF6F FEA0             7      CP  0A0H
001240 DF71 3803            12      JR  C,FKAN1
001242 DF73 FEE0             7      CP  0E0H
001244 DF75 D8              11      RET C
       DF76                     FKAN1:
001245 DF76 0C               4      INC C
001246 DF77 A7               4      AND A
001247 DF78 C9              10      RET
                                
       DF79                     CHKWILDX:
001248 DF79 FDE5            15      PUSH    IY
00124A DF7B E1              10      POP HL
00124B DF7C 23               6      INC HL
       DF7D                     CHKWILD:
00124C DF7D 060B             7      LD  B,11
00124E DF7F 3E3F             7      LD  A,'?'
       DF81                     CHKWIL1:
001250 DF81 BE               7      CP  (HL)
001251 DF82 23               6      INC HL
001252 DF83 37               4      SCF
001253 DF84 C8              11      RET Z
001254 DF85 10FA            13      DJNZ    CHKWIL1
001256 DF87 AF               4      XOR A
001257 DF88 C9              10      RET
                                
       DF89                     SDIRENT:        ;IY=FCB HL=DIR
001258 DF89 D5              11      PUSH    DE
001259 DF8A E5              11      PUSH    HL
00125A DF8B FDE5            15      PUSH    IY
00125C DF8D D1              10      POP DE
00125D DF8E EB               4      EX  DE,HL
00125E DF8F CD30DF          17      CALL    SETNAME
                                ;               Attribute
001261 DF92 FD7E0D          19      LD  A,(IY+13)   ;(FCB)属性(アトリビュート)
001264 DF95 12               7      LD  (DE),A
001265 DF96 13               6      INC DE
                                ;               Reserved
001266 DF97 AF               4      XOR A
001267 DF98 060A             7      LD  B,10
       DF9A                     SDE1:
001269 DF9A 12               7      LD  (DE),A
00126A DF9B 13               6      INC DE
00126B DF9C 10FC            13      DJNZ    SDE1
                                                    ;(FCB)更新時刻
00126D DF9E 21E4F1          10      LD  HL,SDDATA       ;(FCB)更新年月日
001270 DFA1 060A             7      LD  B,SDDATAE-SDDATA    ;(FCB)ファイルの先頭クラスタ
       DFA3                     SDLOOP:                 ;(FCB)ファイルのサイズ(バイト単位)
001272 DFA3 7E               7      LD  A,(HL)
001273 DFA4 23               6      INC HL
001274 DFA5 32AADF          13      LD  (SDPAT),A
001277 DFA8 FD7E00          19      LD  A,(IY+0)    ;LD A,(IY+A)
       DFAA                     SDPAT   EQU $-1
00127A DFAB 12               7      LD  (DE),A
00127B DFAC 13               6      INC DE
00127C DFAD 10F4            13      DJNZ    SDLOOP
                                
00127E DFAF AF               4      XOR A
00127F DFB0 E1              10      POP HL
001280 DFB1 D1              10      POP DE
001281 DFB2 C9              10      RET
                                
       DFB3                     WOPEN:
001282 DFB3 FD7E0D          19      LD  A,(IY+13)   ;(FCB)属性(アトリビュート)
001285 DFB6 E61F             7      AND 01FH
001287 DFB8 37               4      SCF
001288 DFB9 C0              11      RET NZ
001289 DFBA FD361CFE        19      LD  (IY+28),0FEH    ;(FCB)オープンモード
       DFBE                     TOPEN2:
00128D DFBE AF               4      XOR A
       DFBF                     TOPEN:              ;Initializes the time stamp
00128E DFBF FD3617FF        19      LD  (IY+23),0FFH    ;(FCB)更新時刻
001292 DFC3 C9              10      RET
                                
       DFC4                     WRDFX:
001293 DFC4 3A38DE          13      LD  A,(SPCPAT)  ;1クラスタの論理セクタ
       DFC7                     L_WRFX:
001296 DFC7 1F               4      RRA         ;->CF
001297 DFC8 3806            12      JR  C,E_WRFX
001299 DFCA CB39             8      SRL C
00129B DFCC CB1C             8      RR  H       ;CH=CH/2
00129D DFCE 18F7            12      JR  L_WRFX
       DFD0                     E_WRFX:
00129F DFD0 41               4      LD  B,C
0012A0 DFD1 4C               4      LD  C,H
0012A1 DFD2 03               6      INC BC
0012A2 DFD3 3E37             7      LD  A,037H      ;SCF
0012A4 DFD5 3230E4          13      LD  (DRDN1),A
                                
       DFD8                     WRDF:               ;BCクラスタ分FATを確保する
0012A7 DFD8 110200          10      LD  DE,2
0012AA DFDB AF               4      XOR A
0012AB DFDC 32A0E5          13      LD  (_SECPS),A
       DFDF                     WRDF1:
0012AE DFDF C5              11      PUSH    BC
0012AF DFE0 D5              11      PUSH    DE
0012B0 DFE1 CDF7F0          17      CALL    _GNCL
0012B3 DFE4 381C            12      JR  C,WRDF3
0012B5 DFE6 7A               4      LD  A,D     ;空いているかチェック
0012B6 DFE7 B3               4      OR  E
0012B7 DFE8 202A            12      JR  NZ,WRDF4
0012B9 DFEA E1              10      POP HL      ;HL=空いているクラスタ
0012BA DFEB E5              11      PUSH    HL
0012BB DFEC ED5BFEF1        20      LD  DE,(_CLPS)  ;DE=元の(_CLPS)
0012BF DFF0 22FEF1          16      LD  (_CLPS),HL
0012C2 DFF3 7A               4      LD  A,D     ;元の(_CLPS)が 0 か?
0012C3 DFF4 B3               4      OR  E
0012C4 DFF5 2008            12      JR  NZ,WRDF2
0012C6 DFF7 FD751A          19      LD  (IY+26),L   ;(FCB)ファイルの先頭クラスタ
0012C9 DFFA FD741B          19      LD  (IY+27),H   ;元が空の場合はFCBにクラスタをセットする
0012CC DFFD 1803            12      JR  WRDF3
       DFFF                     WRDF2:
0012CE DFFF CDFAF0          17      CALL    _SNCL
       E002                     WRDF3:
0012D1 E002 D1              10      POP DE
0012D2 E003 C1              10      POP BC
0012D3 E004 D8              11      RET C
0012D4 E005 0B               6      DEC BC
0012D5 E006 78               4      LD  A,B
0012D6 E007 B1               4      OR  C
0012D7 E008 200C            12      JR  NZ,WRDF5    ;ここでループカウンタチェック
0012D9 E00A ED5BFEF1        20      LD  DE,(_CLPS)
0012DD E00E 21FFFF          10      LD  HL,0FFFFH   ;FATエントリ終了(EOCマーク)
0012E0 E011 C3FAF0          10      JP  _SNCL
                                
       E014                     WRDF4:              ;DEクラスタが空じゃないので次に移動する
0012E3 E014 D1              10      POP DE
0012E4 E015 C1              10      POP BC
       E016                     WRDF5:
0012E5 E016 13               6      INC DE
0012E6 E017 CD51DE          17      CALL    ENDCL
0012E9 E01A 38C3            12      JR  C,WRDF1
0012EB E01C 37               4      SCF
0012EC E01D C9              10      RET
                                
       E01E                     RWXR:
0012ED E01E 3A3DE3          13      LD  A,(SECSZ+2) ;1024=4 / 512=2 / 256=1
       E021                     L_RWX:
0012F0 E021 1F               4      RRA     ;->CF
0012F1 E022 3808            12      JR  C,E_RWX
0012F3 E024 CB38             8      SRL B   ;BCH=BCH/2
0012F5 E026 CB19             8      RR  C   ;
0012F7 E028 CB1C             8      RR  H   ;
0012F9 E02A 18F5            12      JR  L_RWX
       E02C                     E_RWX:
0012FB E02C FD5E1A          19      LD  E,(IY+26)   ;(FCB)ファイルの先頭クラスタ
0012FE E02F FD561B          19      LD  D,(IY+27)
001301 E032 AF               4      XOR A
001302 E033 32A0E5          13      LD  (_SECPS),A
       E036                     RWX1:
001305 E036 ED53FEF1        20      LD  (_CLPS),DE
001309 E03A 7A               4      LD  A,D
00130A E03B B3               4      OR  E
00130B E03C 2813            12      JR  Z,SCF_RET   ;RET DE==0 => CF=1
                                
00130D E03E 78               4      LD  A,B
00130E E03F B1               4      OR  C
00130F E040 B4               4      OR  H
001310 E041 C8              11      RET Z       ;RET BCH==0 => CF=0
                                
001311 E042 CDA8E5          17      CALL    GNCLX
001314 E045 D8              11      RET C
001315 E046 7C               4      LD  A,H     ;
001316 E047 25               4      DEC H       ;
001317 E048 B7               4      OR  A       ;DEC BCH
001318 E049 2001            12      JR  NZ,RWX2     ;
00131A E04B 0B               6      DEC BC      ;
       E04C                     RWX2:
00131B E04C CD51DE          17      CALL    ENDCL
00131E E04F 38E5            12      JR  C,RWX1
       E051                     SCF_RET:
001320 E051 37               4      SCF
001321 E052 C9              10      RET
                                
       E053                     DSKF:
001322 E053 110000          10      LD  DE,0
       E054                     MAXCLP  EQU $-2
001325 E056 2AACF0          16      LD  HL,(_FAKEFREE)
001328 E059 7C               4      LD  A,H
001329 E05A B5               4      OR  L
00132A E05B 2803            12      JR  Z,DSKF1
00132C E05D 110100          10      LD  DE,1
       E060                     DSKF1:
00132F E060 D5              11      PUSH    DE
001330 E061 CDF7F0          17      CALL    _GNCL
001333 E064 380C            12      JR  C,POPSCF
001335 E066 7A               4      LD  A,D
001336 E067 B3               4      OR  E
001337 E068 2001            12      JR  NZ,DSKF2
001339 E06A 23               6      INC HL
       E06B                     DSKF2:
00133A E06B D1              10      POP DE
00133B E06C 1B               6      DEC DE
00133C E06D 7A               4      LD  A,D
00133D E06E B3               4      OR  E
00133E E06F 20EF            12      JR  NZ,DSKF1
001340 E071 C9              10      RET
                                
       E072                     POPSCF:
001341 E072 F1              10      POP AF
001342 E073 37               4      SCF
001343 E074 C9              10      RET
                                
       E075                     SETTMS:
001344 E075 FD7E17          19      LD  A,(IY+23)   ;(FCB)ファイルを最後に変更した時刻
001347 E078 3C               4      INC A
001348 E079 C0              11      RET NZ      ;ファイルが更新されていない
       E07A                     SETTMSX:            ;FCBに日付時刻をセットする
001349 E07A CDB5D7          17      CALL    _SYS2C      ;(BDOS)時刻の獲得
                                                ;H←時  L←分  D←秒
00134C E07D CB25             8      SLA L       ;   *2
00134E E07F CB25             8      SLA L       ;   *4
001350 E081 29              11      ADD HL,HL       ;*2 *8
001351 E082 29              11      ADD HL,HL       ;*4 *16
001352 E083 29              11      ADD HL,HL       ;*8 *32
001353 E084 7A               4      LD  A,D
001354 E085 0F               4      RRCA            ;bit.0->7->->->0->C
001355 E086 E61F             7      AND 01FH
001357 E088 B5               4      OR  L
001358 E089 FD7716          19      LD  (IY+22),A   ;(FCB)ファイルを最後に変更した時刻
00135B E08C FD7417          19      LD  (IY+23),H
                                
00135E E08F CDAFD7          17      CALL    _SYS2A      ;(BDOS)日付の獲得
                                                ;HL←年  D←月  E←日
001361 E092 0144F8          10      LD  BC,0-1980
001364 E095 09              11      ADD HL,BC
001365 E096 65               4      LD  H,L
                                
001366 E097 7A               4      LD  A,D
001367 E098 87               4      ADD A,A     ;*2
001368 E099 87               4      ADD A,A     ;*4
001369 E09A 87               4      ADD A,A     ;*8
00136A E09B 87               4      ADD A,A     ;*16
00136B E09C 6F               4      LD  L,A
00136C E09D 29              11      ADD HL,HL       ;*32
00136D E09E 7D               4      LD  A,L
00136E E09F B3               4      OR  E
00136F E0A0 FD7714          19      LD  (IY+20),A   ;(FCB)ファイルを最後に変更した日付
001372 E0A3 FD7415          19      LD  (IY+21),H
001375 E0A6 C9              10      RET
                                
       E0A7                     PUSHRR:
001376 E0A7 323FE1          13      LD  (SETSEQ_SWC_RND),A
001379 E0AA 2251E1          16      LD  (SETSEQ_SWC_SEQ_RR),HL
00137C E0AD CDCDE0          17      CALL    GET_RR_AHL
00137F E0B0 220FF0          16      LD  (RR_BUF_HL),HL
001382 E0B3 3211F0          13      LD  (RR_BUF_A),A
001385 E0B6 C9              10      RET
                                
       E0B7                     GET_CPM_R_SIZE:     ;バイト単位からCP/Mのレコード単位を求める（1レコード=128バイト）
001386 E0B7 87               4      ADD A,A     ;in BHLA => out AHL
001387 E0B8 ED6A            15      ADC HL,HL
001389 E0BA CB18             8      RR  B
00138B E0BC B7               4      OR  A
00138C E0BD 78               4      LD  A,B     ;ここでフラグは変化しない
00138D E0BE C8              11      RET Z
00138E E0BF 2C               4      INC L       ;INC AHL
00138F E0C0 C0              11      RET NZ      ;
001390 E0C1 24               4      INC H       ;
001391 E0C2 C0              11      RET NZ      ;
001392 E0C3 3C               4      INC A       ;
001393 E0C4 C9              10      RET
                                
       E0C5                     INIT_RND:
001394 E0C5 3ECD             7      LD  A,0CDH      ;CALL ????
001396 E0C7 2114E1          10      LD  HL,POPRR
001399 E0CA CDA7E0          17      CALL    PUSHRR
       E0CD                     GET_RR_AHL:
00139C E0CD FD6E21          19      LD  L,(IY+33)   ;(FCB)Random record
00139F E0D0 FD6622          19      LD  H,(IY+34)   ;
0013A2 E0D3 FD7E23          19      LD  A,(IY+35)   ;
0013A5 E0D6 C9              10      RET
       E0D7                     SET_RR_AHL:
0013A6 E0D7 FD7521          19      LD  (IY+33),L   ;(FCB)Random record
0013A9 E0DA FD7422          19      LD  (IY+34),H
0013AC E0DD FD7723          19      LD  (IY+35),A
0013AF E0E0 C9              10      RET
       E0E1                     INIT_SEQ:
0013B0 E0E1 3E01             7      LD  A,1     ;LD BC,????
0013B2 E0E3 2111E1          10      LD  HL,SETSEQ
0013B5 E0E6 CDA7E0          17      CALL    PUSHRR
       E0E9                     GETSEQ:
0013B8 E0E9 FD6E20          19      LD  L,(IY+32)   ;(FCB)カレントレコード
0013BB E0EC FD660C          19      LD  H,(IY+12)   ;(FCB)カレントブロック
0013BE E0EF AF               4      XOR A
                                
0013BF E0F0 CB25             8      SLA L   ;L=L*2
                                
0013C1 E0F2 CB3C             8      SRL H   ;HL=HL/2
0013C3 E0F4 CB1D             8      RR  L   ;
0013C5 E0F6 C9              10      RET
                                
       E0F7                     SETSEQ1:
0013C6 E0F7 F5              11      PUSH    AF
0013C7 E0F8 E5              11      PUSH    HL      ;AHL=Random record
0013C8 E0F9 CDCDE0          17      CALL    GET_RR_AHL
0013CB E0FC 47               4      LD  B,A     ;AHL→HLA
0013CC E0FD 7D               4      LD  A,L     ;(IY+33)(FCB)ランダムレコード
0013CD E0FE 6C               4      LD  L,H     ;(IY+34)
0013CE E0FF 60               4      LD  H,B     ;(IY+35)
0013CF E100 0600             7      LD  B,0
                                
0013D1 E102 CDB7E0          17      CALL    GET_CPM_R_SIZE
                                
0013D4 E105 29              11      ADD HL,HL
0013D5 E106 CB3D             8      SRL L       ;L=L/2
0013D7 E108 FD7520          19      LD  (IY+32),L   ;(FCB)カレントレコード
0013DA E10B FD740C          19      LD  (IY+12),H   ;(FCB)カレントブロック
0013DD E10E E1              10      POP HL
0013DE E10F F1              10      POP AF
0013DF E110 C9              10      RET
       E111                     SETSEQ:
0013E0 E111 CDF7E0          17      CALL    SETSEQ1
       E114                     POPRR:
0013E3 E114 F5              11      PUSH    AF
0013E4 E115 E5              11      PUSH    HL
0013E5 E116 2A0FF0          16      LD  HL,(RR_BUF_HL)
0013E8 E119 3A11F0          13      LD  A,(RR_BUF_A)
0013EB E11C CDD7E0          17      CALL    SET_RR_AHL
0013EE E11F E1              10      POP HL
0013EF E120 F1              10      POP AF
0013F0 E121 C9              10      RET
                                
       E122                     RB_WRITE:
0013F1 E122 C5              11      PUSH    BC
0013F2 E123 ED4B4CF1        20      LD  BC,(STABLE+2*026H)  ;(BDOS)ランダムブロック書き込み
0013F6 E127 1805            12      JR  RBRW
       E129                     RB_READ:
0013F8 E129 C5              11      PUSH    BC
0013F9 E12A ED4B4EF1        20      LD  BC,(STABLE+2*027H)  ;(BDOS)ランダムブロック読み込み
       E12E                     RBRW:
0013FD E12E 1F               4      RRA     ;AHL = AHL*128
0013FE E12F 7C               4      LD  A,H ;AHL = AHL0/2
0013FF E130 1F               4      RRA     ;A
001400 E131 65               4      LD  H,L ;
001401 E132 CB1C             8      RR  H   ;H
001403 E134 2E00             7      LD  L,0 ;
001405 E136 CB1D             8      RR  L   ;L
001407 E138 CDD7E0          17      CALL    SET_RR_AHL
00140A E13B 218000          10      LD  HL,128
00140D E13E C5              11      PUSH    BC
       E13F                     SETSEQ_SWC_RND:
00140E E13F CDF7E0          17      CALL    SETSEQ1
001411 E142 C1              10      POP BC
001412 E143 FDCB20FE        23      SET 7,(IY+32)   ;(FCB)カレントレコード
001416 E147 FDE5            15      PUSH    IY
001418 E149 D1              10      POP DE
001419 E14A D5              11      PUSH    DE
00141A E14B CD59E1          17      CALL    JP_BC
00141D E14E FDE1            14      POP IY
00141F E150 CD11E1          17      CALL    SETSEQ
       E151                     SETSEQ_SWC_SEQ_RR   EQU $-2
001422 E153 FDCB20BE        23      RES 7,(IY+32)   ;(FCB)カレントレコード
                                
001426 E157 C1              10      POP BC
001427 E158 C9              10      RET
       E159                     JP_BC:
001428 E159 C5              11      PUSH    BC
001429 E15A C9              10      RET
                                
       DCE2                     _SYS03  EQU SCF_FF_RET  ;(BDOS)外部入力
       DCE2                     _SYS2B  EQU SCF_FF_RET  ;(BDOS)日付の設定
       DCE2                     _SYS2D  EQU SCF_FF_RET  ;(BDOS)時刻の設定
       DCE2                     _SYS39  EQU SCF_FF_RET  ;(BDOS)サブディレクトリの作成
       DCE2                     _SYS3A  EQU SCF_FF_RET  ;(BDOS)サブディレクトリの削除
                                
[EOF:LDFILE.ASM:SHIFT_JIS]
                                    INCLUDE "LDFILE2.ASM"
                                
                                ;   LSX-Dodgers FILE2
                                
                                                ;Write random block
       E15B                     _SYS26:     ;(BDOS)ランダムブロック書き込み
00142A E15B AF               4      XOR A
00142B E15C 3230E4          13      LD  (DRDN1),A   ;NOP
00142E E15F 2280E3          16      LD  (RBSIZE),HL ;HL←書き込むレコード数
001431 E162 225DF0          16      LD  (LEFTX),HL
001434 E165 CD2BDC          17      CALL    SETDRV
                                
001437 E168 CDD8E2          17      CALL    RBX0
00143A E16B DAF8E1          10      JP  C,RBWERR
00143D E16E CDB3DF          17      CALL    WOPEN
001440 E171 DAF8E1          10      JP  C,RBWERR
001443 E174 7C               4      LD  A,H
001444 E175 B5               4      OR  L
001445 E176 CAF1E1          10      JP  Z,RBW1
                                
001448 E179 2B               6      DEC HL
                                
001449 E17A CD96E3          17      CALL    GET_RR_BCDE ;BCDE=Random record
                                
00144C E17D 19              11      ADD HL,DE       ;BCHL=HL+BCDE
00144D E17E 3001            12      JR  NC,S26X1    ;
00144F E180 03               6      INC BC      ;
       E181                     S26X1:
001450 E181 CD1EE0          17      CALL    RWXR
001453 E184 DCC4DF          17      CALL    C,WRDFX
001456 E187 DAF8E1          10      JP  C,RBWERR
                                
001459 E18A CD07E3          17      CALL    RBX2
00145C E18D 281A            12      JR  Z,RBWB      ;NZ=セクタ以下の端数がある
00145E E18F CD26E3          17      CALL    RBXA
001461 E192 3864            12      JR  C,RBWERR
001463 E194 EB               4      EX  DE,HL
001464 E195 C5              11      PUSH    BC
001465 E196 EDB0                    LDIR
001467 E198 225FF0          16      LD  (DTAX),HL
                                
00146A E19B CD58DF          17      CALL    SWTDBF      ;バッファデータは更新された
                                
00146D E19E 2A5DF0          16      LD  HL,(LEFTX)
001470 E1A1 D1              10      POP DE
001471 E1A2 ED52            15      SBC HL,DE
001473 E1A4 225DF0          16      LD  (LEFTX),HL
001476 E1A7 2831            12      JR  Z,RBWEND
                                
       E1A9                     RBWB:
001478 E1A9 CD5BE3          17      CALL    RBXB
00147B E1AC 2814            12      JR  Z,RBWC
       E1AE                     RBWB1:
00147D E1AE C5              11      PUSH    BC
00147E E1AF D5              11      PUSH    DE
00147F E1B0 CD34DE          17      CALL    CLUSTX
001482 E1B3 CDAAE3          17      CALL    DWTC
001485 E1B6 D1              10      POP DE
001486 E1B7 C1              10      POP BC
001487 E1B8 D4A8E5          17      CALL    NC,GNCLX
00148A E1BB 383B            12      JR  C,RBWERR
00148C E1BD 10EF            13      DJNZ    RBWB1
00148E E1BF CDFAE3          17      CALL    DRW_FLUSH
       E1C2                     RBWC:
001491 E1C2 CD73E3          17      CALL    RBXC
001494 E1C5 2813            12      JR  Z,RBWEND
001496 E1C7 C5              11      PUSH    BC
001497 E1C8 CD34DE          17      CALL    CLUSTX
00149A E1CB CD2FE4          17      CALL    DRDN
00149D E1CE C1              10      POP BC
00149E E1CF 3827            12      JR  C,RBWERR
0014A0 E1D1 ED5B7EF1        20      LD  DE,(_DTBUF)
0014A4 E1D5 EDB0                    LDIR
0014A6 E1D7 CD58DF          17      CALL    SWTDBF      ;バッファデータは更新された
       E1DA                     RBWEND:
0014A9 E1DA CD7FE3          17      CALL    RBXEND
                                
0014AC E1DD CDE7E2          17      CALL    RBX1
0014AF E1E0 300F            12      JR  NC,RBW1     ;ランダムレコードの方が大きい場合はサイズを合わせる
0014B1 E1E2 CD96E3          17      CALL    GET_RR_BCDE ;BCDE=Random record
0014B4 E1E5 FD7310          19      LD  (IY+16),E   ;ファイルのサイズ(バイト単位)
0014B7 E1E8 FD7211          19      LD  (IY+17),D   ;
0014BA E1EB FD7112          19      LD  (IY+18),C   ;
0014BD E1EE FD7013          19      LD  (IY+19),B   ;
       E1F1                     RBW1:
0014C0 E1F1 FDE1            14      POP IY
0014C2 E1F3 C1              10      POP BC
0014C3 E1F4 D1              10      POP DE
0014C4 E1F5 E1              10      POP HL
       E1F6                     DD_NUL:
0014C5 E1F6 AF               4      XOR A
       E1F7                     DRDF0:
       E1F7                     DWTF0:
0014C6 E1F7 C9              10      RET
                                
       E1F8                     RBWERR:
0014C7 E1F8 FDE5            15      PUSH    IY
0014C9 E1FA D1              10      POP DE
0014CA E1FB 2A20F1          16      LD  HL,(STABLE+2*010H)
0014CD E1FE CD0F00          17      CALL    JP_HL
       E201                     RBRERR1:
0014D0 E201 3E01             7      LD  A,001H
       E203                     RBRERR2:
0014D2 E203 FDE1            14      POP IY
0014D4 E205 C1              10      POP BC
0014D5 E206 D1              10      POP DE
0014D6 E207 E1              10      POP HL
0014D7 E208 37               4      SCF
0014D8 E209 210000          10      LD  HL,0
0014DB E20C C9              10      RET
                                
       E20D                     RBRERR:
0014DC E20D 3EFF             7      LD  A,0FFH
0014DE E20F 18F2            12      JR  RBRERR2
                                
       E211                     RBRFL:
0014E0 E211 3E00             7  RBRFLP: LD  A,000H
0014E2 E213 FE0D             7      CP  00DH
0014E4 E215 2005            12      JR  NZ,RBRFL1
0014E6 E217 D5              11      PUSH    DE
0014E7 E218 1E0A             7      LD  E,00AH
0014E9 E21A 1805            12      JR  RBRFL2
       E21C                     RBRFL1:
0014EB E21C D5              11      PUSH    DE
0014EC E21D CD09F0          17      CALL    _SYS07
0014EF E220 5F               4      LD  E,A
       E221                     RBRFL2:
0014F0 E221 CDCDF0          17      CALL    _PRINT
0014F3 E224 7B               4      LD  A,E
0014F4 E225 D1              10      POP DE
0014F5 E226 3212E2          13      LD  (RBRFLP+1),A
0014F8 E229 C9              10      RET
       E22A                     DDX:
0014F9 E22A FD7E01          19      LD  A,(IY+1)    ;(FCB)主ファイル名
0014FC E22D CD59DE          17      CALL    CAP
0014FF E230 FE41             7      CP  'A'
001501 E232 C9              10      RET
                                
                                                ;Read random block
       E233                     _SYS27:     ;(BDOS)ランダムブロック読み込み
001502 E233 225DF0          16      LD  (LEFTX),HL
001505 E236 CD2BDC          17      CALL    SETDRV
                                
001508 E239 FDCB0D66        20      BIT 4,(IY+13)   ;(FCB)属性(アトリビュート)
00150C E23D C2C6E2          10      JP  NZ,RBRDIR   ;ディレクトリ
00150F E240 CDD8E2          17      CALL    RBX0
001512 E243 DA0DE2          10      JP  C,RBRERR
001515 E246 CDE7E2          17      CALL    RBX1
001518 E249 D4FFE2          17      CALL    NC,RBX1R
00151B E24C DA01E2          10      JP  C,RBRERR1
00151E E24F EB               4      EX  DE,HL
00151F E250 ED52            15      SBC HL,DE       ;CP 00HL,BCDE
001521 E252 19              11      ADD HL,DE
001522 E253 79               4      LD  A,C
001523 E254 DE00             7      SBC A,0
001525 E256 78               4      LD  A,B
001526 E257 DE00             7      SBC A,0
001528 E259 3801            12      JR  C,RBR1
00152A E25B EB               4      EX  DE,HL
       E25C                     RBR1:
00152B E25C 9F               4      SBC A,A
00152C E25D E601             7      AND 1
00152E E25F 32C4E2          13      LD  (RBRAP+1),A
                                
001531 E262 7C               4      LD  A,H
001532 E263 B5               4      OR  L
001533 E264 2857            12      JR  Z,RBREND0
                                
001535 E266 2280E3          16      LD  (RBSIZE),HL ;HL←読み込むレコード数
001538 E269 225DF0          16      LD  (LEFTX),HL
                                
00153B E26C CD07E3          17      CALL    RBX2
00153E E26F 2819            12      JR  Z,RBRB
001540 E271 CD26E3          17      CALL    RBXA
001543 E274 DA0DE2          10      JP  C,RBRERR
001546 E277 C5              11      PUSH    BC
001547 E278 EDB0                    LDIR
001549 E27A ED535FF0        20      LD  (DTAX),DE
00154D E27E 2A5DF0          16      LD  HL,(LEFTX)
001550 E281 D1              10      POP DE
001551 E282 A7               4      AND A
001552 E283 ED52            15      SBC HL,DE
001554 E285 225DF0          16      LD  (LEFTX),HL
001557 E288 2830            12      JR  Z,RBREND
                                
       E28A                     RBRB:
001559 E28A CD5BE3          17      CALL    RBXB
00155C E28D 2815            12      JR  Z,RBRC
       E28F                     RBRB1:
00155E E28F C5              11      PUSH    BC
00155F E290 D5              11      PUSH    DE
001560 E291 CD34DE          17      CALL    CLUSTX
001563 E294 CDB0E3          17      CALL    DRDC
001566 E297 D1              10      POP DE
001567 E298 C1              10      POP BC
001568 E299 D4A8E5          17      CALL    NC,GNCLX
00156B E29C DA0DE2          10      JP  C,RBRERR
00156E E29F 10EE            13      DJNZ    RBRB1
001570 E2A1 CDFAE3          17      CALL    DRW_FLUSH
       E2A4                     RBRC:
001573 E2A4 CD73E3          17      CALL    RBXC
001576 E2A7 2811            12      JR  Z,RBREND
001578 E2A9 C5              11      PUSH    BC
001579 E2AA CD34DE          17      CALL    CLUSTX
00157C E2AD CD13E4          17      CALL    DRDX
00157F E2B0 C1              10      POP BC
001580 E2B1 DA0DE2          10      JP  C,RBRERR
001583 E2B4 EB               4      EX  DE,HL
001584 E2B5 2A7EF1          16      LD  HL,(_DTBUF)
001587 E2B8 EDB0                    LDIR
       E2BA                     RBREND:
001589 E2BA CD7FE3          17      CALL    RBXEND
       E2BD                     RBREND0:
00158C E2BD FDE1            14      POP IY
00158E E2BF C1              10      POP BC
00158F E2C0 D1              10      POP DE
001590 E2C1 F1              10      POP AF  ;(HL)
001591 E2C2 AF               4      XOR A
001592 E2C3 3E00             7  RBRAP:  LD  A,000H
001594 E2C5 C9              10      RET
                                
       E2C6                     RBRDIR:
001595 E2C6 FD6E1A          19      LD  L,(IY+26)   ;(FCB)ファイルの先頭クラスタ
001598 E2C9 FD661B          19      LD  H,(IY+27)
00159B E2CC CD6FDE          17      CALL    CHDIR
00159E E2CF AF               4      XOR A
00159F E2D0 67               4      LD  H,A
0015A0 E2D1 6F               4      LD  L,A
0015A1 E2D2 3C               4      INC A
0015A2 E2D3 32C4E2          13      LD  (RBRAP+1),A
0015A5 E2D6 18E5            12      JR  RBREND0
                                
       E2D8                     RBX0:
0015A7 E2D8 2A8AF0          16      LD  HL,(_DTA)
0015AA E2DB 225FF0          16      LD  (DTAX),HL
0015AD E2DE 2A5DF0          16      LD  HL,(LEFTX)
0015B0 E2E1 FD7E1C          19      LD  A,(IY+28)   ;(FCB)オープンモード
0015B3 E2E4 D6FD             7      SUB 0FDH
0015B5 E2E6 C9              10      RET
                                
       E2E7                     RBX1:               ;ファイルサイズとランダムレコードを比べる
0015B6 E2E7 E5              11      PUSH    HL      ;Record byte
                                                ;AHL=File size
0015B7 E2E8 FD6E10          19      LD  L,(IY+16)   ;ファイルのサイズ(バイト単位)
0015BA E2EB FD6611          19      LD  H,(IY+17)   ;
0015BD E2EE FD7E12          19      LD  A,(IY+18)   ;
                                
0015C0 E2F1 CD96E3          17      CALL    GET_RR_BCDE ;BCDE=Random record
                                
0015C3 E2F4 A7               4      AND A
0015C4 E2F5 ED52            15      SBC HL,DE
0015C6 E2F7 99               4      SBC A,C
0015C7 E2F8 4F               4      LD  C,A
0015C8 E2F9 FD7E13          19      LD  A,(IY+19)   ;ファイルのサイズ
0015CB E2FC 98               4      SBC A,B
0015CC E2FD D1              10      POP DE
0015CD E2FE C9              10      RET
       E2FF                     RBX1R:
0015CE E2FF 47               4      LD  B,A
0015CF E300 B1               4      OR  C
0015D0 E301 EB               4      EX  DE,HL   ;BCDE=File byte HL=Record byte
0015D1 E302 B2               4      OR  D
0015D2 E303 B3               4      OR  E
0015D3 E304 C0              11      RET NZ
0015D4 E305 37               4      SCF
0015D5 E306 C9              10      RET
                                
       E307                     RBX2:               ;Cluster settings
0015D6 E307 FD6622          19      LD  H,(IY+34)   ;(+33)(FCB)ランダムレコード
0015D9 E30A FD4E23          19      LD  C,(IY+35)
0015DC E30D 0600             7      LD  B,0
0015DE E30F FDCB207E        20      BIT 7,(IY+32)   ;(FCB)カレントレコード
0015E2 E313 2003            12      JR  NZ,RBX3
0015E4 E315 FD4624          19      LD  B,(IY+36)
       E318                     RBX3:
0015E7 E318 CD1EE0          17      CALL    RWXR
0015EA E31B 3A3DE3          13      LD  A,(SECSZ+2) ;1024=4 / 512=2 / 256=1
0015ED E31E 3D               4      DEC A
0015EE E31F FDA622          19      AND (IY+34)
0015F1 E322 FDB621          19      OR  (IY+33)
0015F4 E325 C9              10      RET
                                
       E326                     RBXA:
0015F5 E326 C5              11      PUSH    BC
0015F6 E327 D5              11      PUSH    DE
0015F7 E328 CD34DE          17      CALL    CLUSTX
0015FA E32B CD13E4          17      CALL    DRDX
0015FD E32E D1              10      POP DE
0015FE E32F C1              10      POP BC
0015FF E330 D4A8E5          17      CALL    NC,GNCLX
001602 E333 D8              11      RET C
001603 E334 ED53FEF1        20      LD  (_CLPS),DE
                                
001607 E338 FD4E21          19      LD  C,(IY+33)   ;(FCB)ランダムレコード
00160A E33B 210004          10  SECSZ:  LD  HL,0400H    ;自己書き換え 1024=0400H / 512=0200H ここに1セクタのサイズが格納される
00160D E33E 7C               4      LD  A,H
00160E E33F 3D               4      DEC A       ;1024=3 / 512=1
00160F E340 FDA622          19      AND (IY+34)     ;(FCB)ランダムレコード
001612 E343 47               4      LD  B,A     ;BCに1セクタ以下の端数が入る
001613 E344 ED42            15      SBC HL,BC       ;残りを計算
                                
001615 E346 ED5B5DF0        20      LD  DE,(LEFTX)
001619 E34A ED52            15      SBC HL,DE       ;CP HL,DE
00161B E34C 19              11      ADD HL,DE       ;
00161C E34D 3801            12      JR  C,RBXA1     ;DEとHLを比較して大きい方をHLに
00161E E34F EB               4      EX  DE,HL
       E350                     RBXA1:
00161F E350 E5              11      PUSH    HL
001620 E351 2A7EF1          16      LD  HL,(_DTBUF)
001623 E354 09              11      ADD HL,BC
001624 E355 ED5B5FF0        20      LD  DE,(DTAX)
001628 E359 C1              10      POP BC
001629 E35A C9              10      RET
                                
       E35B                     RBXB:
00162A E35B 2A5FF0          16      LD  HL,(DTAX)
00162D E35E ED5BFEF1        20      LD  DE,(_CLPS)
001631 E362 3A5EF0          13      LD  A,(LEFTX+1)
001634 E365 47               4      LD  B,A
001635 E366 3A3DE3          13      LD  A,(SECSZ+2) ;1024=4 / 512=2 / 256=1
       E369                     RBXB1:
001638 E369 1F               4      RRA     ;->CF
001639 E36A 3804            12      JR  C,RBXB2
00163B E36C CB38             8      SRL B   ;B=B/2
00163D E36E 18F9            12      JR  RBXB1
       E370                     RBXB2:
00163F E370 78               4      LD  A,B
001640 E371 B7               4      OR  A
001641 E372 C9              10      RET
                                
       E373                     RBXC:
001642 E373 ED4B5DF0        20      LD  BC,(LEFTX)
001646 E377 3A3DE3          13      LD  A,(SECSZ+2) ;1024=4 / 512=2 / 256=1
001649 E37A 3D               4      DEC A
00164A E37B A0               4      AND B
00164B E37C 47               4      LD  B,A     ;1セクタ以下の端数がない場合はZ
00164C E37D B1               4      OR  C
00164D E37E C9              10      RET
                                
       E37F                     RBXEND:             ;レコード数だけランダムレコードを進める
00164E E37F 110000          10      LD  DE,0        ;進めるレコード数(RBSIZE)
       E380                     RBSIZE  EQU $-2
001651 E382 CDCDE0          17      CALL    GET_RR_AHL
001654 E385 19              11      ADD HL,DE
001655 E386 CE00             7      ADC A,0
001657 E388 CDD7E0          17      CALL    SET_RR_AHL
00165A E38B EB               4      EX  DE,HL       ;HL=進めるレコード数
00165B E38C D0              11      RET NC
00165C E38D FDCB207E        20      BIT 7,(IY+32)   ;(FCB)カレントレコード
001660 E391 C0              11      RET NZ
001661 E392 FD3424          23      INC (IY+36)
001664 E395 C9              10      RET
                                
       E396                     GET_RR_BCDE:            ;BCDE=Random record
001665 E396 FD5E21          19      LD  E,(IY+33)   ;(FCB)ランダムレコード
001668 E399 FD5622          19      LD  D,(IY+34)
00166B E39C FD4E23          19      LD  C,(IY+35)
00166E E39F 0600             7      LD  B,0     ;CP/M互換のアクセスの場合はFCBは36バイト
001670 E3A1 FDCB207E        20      BIT 7,(IY+32)   ;(FCB)カレントレコード
001674 E3A5 C0              11      RET NZ
001675 E3A6 FD4624          19      LD  B,(IY+36)
001678 E3A9 C9              10      RET
                                
                                ;   ランダムブロックアクセスの連続したセクタをまとめる
                                
       E3AA                     DWTC:
001679 E3AA E5              11      PUSH    HL
00167A E3AB 213AE7          10      LD  HL,DWT24B
00167D E3AE 1804            12      JR  DWTC1
       E3B0                     DRDC:
00167F E3B0 E5              11      PUSH    HL
001680 E3B1 212AE7          10      LD  HL,DRD24B
       E3B4                     DWTC1:
001683 E3B4 220EE4          16      LD  (DRWF_MODE),HL
001686 E3B7 E1              10      POP HL
001687 E3B8 3AFEE3          13      LD  A,(DRWF_B)
00168A E3BB B7               4      OR  A
00168B E3BC 200F            12      JR  NZ,DRDC1
       E3BE                     SAVE_DRWC:
00168D E3BE 0601             7      LD  B,1
00168F E3C0 ED43FDE3        20      LD  (DRWF_C),BC
001693 E3C4 ED5304E4        20      LD  (DRWF_E),DE
001697 E3C8 2207E4          16      LD  (DRWF_HL),HL
00169A E3CB 1820            12      JR  INC_HL_DRWC
       E3CD                     DRDC1:
00169C E3CD E5              11      PUSH    HL
00169D E3CE 2104E4          10      LD  HL,DRWF_E
0016A0 E3D1 86               7      ADD A,(HL)
0016A1 E3D2 F5              11      PUSH    AF
0016A2 E3D3 BB               4      CP  E
0016A3 E3D4 201D            12      JR  NZ,DRDC2
0016A5 E3D6 F1              10      POP AF
0016A6 E3D7 23               6      INC HL
0016A7 E3D8 7E               7      LD  A,(HL)
0016A8 E3D9 CE00             7      ADC A,0
0016AA E3DB F5              11      PUSH    AF
0016AB E3DC BA               4      CP  D
0016AC E3DD 2014            12      JR  NZ,DRDC2
0016AE E3DF F1              10      POP AF
0016AF E3E0 3AFDE3          13      LD  A,(DRWF_C)
0016B2 E3E3 CE00             7      ADC A,0
0016B4 E3E5 B9               4      CP  C
0016B5 E3E6 200C            12      JR  NZ,DRDC3
0016B7 E3E8 21FEE3          10      LD  HL,DRWF_B
0016BA E3EB 34              11      INC (HL)
0016BB E3EC E1              10      POP HL
       E3ED                     INC_HL_DRWC:
0016BC E3ED 3A3DE3          13      LD  A,(SECSZ+2)     ;1セクタのサイズの上位1バイト
0016BF E3F0 84               4      ADD A,H
0016C0 E3F1 67               4      LD  H,A
0016C1 E3F2 C9              10      RET
       E3F3                     DRDC2:
0016C2 E3F3 F1              10      POP AF
       E3F4                     DRDC3:
0016C3 E3F4 CDFAE3          17      CALL    DRW_FLUSH
0016C6 E3F7 E1              10      POP HL
0016C7 E3F8 18C4            12      JR  SAVE_DRWC
                                
                                ;   ランダムブロックアクセスの連続したセクタをまとめたものをフラッシュする
       E3FA                     DRW_FLUSH:
0016C9 E3FA C5              11      PUSH    BC
0016CA E3FB D5              11      PUSH    DE
0016CB E3FC 010000          10      LD  BC,0
       E3FD                     DRWF_C  EQU $-2
       E3FE                     DRWF_B  EQU $-1
0016CE E3FF 78               4      LD  A,B
0016CF E400 B7               4      OR  A
0016D0 E401 280D            12      JR  Z,DRDF1
0016D2 E403 110000          10      LD  DE,0
       E404                     DRWF_E  EQU $-2
       E405                     DRWF_D  EQU $-1
0016D5 E406 210000          10      LD  HL,0
       E407                     DRWF_HL EQU $-2
0016D8 E409 AF               4      XOR A
0016D9 E40A 32FEE3          13      LD  (DRWF_B),A
0016DC E40D CD2AE7          17      CALL    DRD24B
       E40E                     DRWF_MODE   EQU $-2
       E410                     DRDF1:
0016DF E410 D1              10      POP DE
0016E0 E411 C1              10      POP BC
0016E1 E412 C9              10      RET
[EOF:LDFILE2.ASM:SHIFT_JIS]
                                    INCLUDE "LDDIO.ASM"
                                
                                ;   LSX-Dodgers DIO
                                
       E413                     DRDX:
0016E2 E413 CD51E4          17      CALL    DRDY
0016E5 E416 C8              11      RET Z
0016E6 E417 CD37E4          17      CALL    DRDX1       ;データバッファの情報を保存
0016E9 E41A D8              11      RET C
0016EA E41B E5              11      PUSH    HL
0016EB E41C C5              11      PUSH    BC
0016EC E41D D5              11      PUSH    DE
0016ED E41E 2A7EF1          16      LD  HL,(_DTBUF)
0016F0 E421 3A7AE4          13      LD  A,(_DBS24)
0016F3 E424 4F               4      LD  C,A
0016F4 E425 CD28E7          17      CALL    DRD24
0016F7 E428 DC4CE4          17      CALL    C,DRDNE
       E42B                     POP_DE_BC_HL_RET:
0016FA E42B D1              10      POP DE
0016FB E42C C1              10      POP BC
0016FC E42D E1              10      POP HL
0016FD E42E C9              10      RET
                                
                                ;   CDE:セクタ番号
       E42F                     DRDN:
0016FE E42F AF               4      XOR A
0016FF E430 00               4  DRDN1:  NOP         ;自己書き換え NOP / SCF
001700 E431 30E0            12      JR  NC,DRDX
       E433                     DRDNX:
001702 E433 CD51E4          17      CALL    DRDY
001705 E436 C8              11      RET Z
       E437                     DRDX1:
001706 E437 CD67E4          17      CALL    DWTX
                                                ;データバッファの読み込んだドライブ・セクタ情報を保存
001709 E43A ED53A6F0        20      LD  (_DBSEC),DE
00170D E43E 79               4      LD  A,C
00170E E43F 327AE4          13      LD  (_DBS24),A
                                
001711 E442 3A88F0          13      LD  A,(_DRV)
001714 E445 32A5F0          13      LD  (_DBDRV),A
001717 E448 CDD9F0          17      CALL    _CHGDRV
00171A E44B D0              11      RET NC
       E44C                     DRDNE:
00171B E44C 9F               4      SBC A,A     ;CF=1ならばA=0FFH
00171C E44D 32A5F0          13      LD  (_DBDRV),A
00171F E450 C9              10      RET
                                
                                ;   CDE:セクタ番号
       E451                     DRDY:
001720 E451 3A7AE4          13      LD  A,(_DBS24)
001723 E454 B9               4      CP  C
001724 E455 C0              11      RET NZ
                                
001725 E456 E5              11      PUSH    HL
001726 E457 3A88F0          13      LD  A,(_DRV)
001729 E45A 21A5F0          10      LD  HL,_DBDRV
00172C E45D AE               7      XOR (HL)
00172D E45E 2005            12      JR  NZ,POP_HL_RET
                                
00172F E460 2AA6F0          16      LD  HL,(_DBSEC)
001732 E463 ED52            15      SBC HL,DE       ;上でXORを使っているのでCF=0のはず
       E465                     POP_HL_RET:
001734 E465 E1              10      POP HL
001735 E466 C9              10      RET
                                
       E467                     DWTX:
001736 E467 3AA4F0          13      LD  A,(_WTDBF)
001739 E46A B7               4      OR  A
00173A E46B C8              11      RET Z
00173B E46C AF               4      XOR A
00173C E46D 32A4F0          13      LD  (_WTDBF),A
                                
00173F E470 E5              11      PUSH    HL
001740 E471 C5              11      PUSH    BC
001741 E472 D5              11      PUSH    DE
001742 E473 3AA5F0          13      LD  A,(_DBDRV)
001745 E476 CDD9F0          17      CALL    _CHGDRV
001748 E479 0E00             7      LD  C,0
       E47A                     _DBS24  EQU $-1
00174A E47B ED5BA6F0        20      LD  DE,(_DBSEC)
00174E E47F 2A7EF1          16      LD  HL,(_DTBUF)
001751 E482 D438E7          17      CALL    NC,DWT24
       E485                     POP_DE_BC_HL_RET2:
001754 E485 18A4            12      JR  POP_DE_BC_HL_RET
                                
       E487                     RDFATX:
001756 E487 E5              11      PUSH    HL
001757 E488 3A88F0          13      LD  A,(_DRV)
00175A E48B 21AAF0          10      LD  HL,_FATDRV
00175D E48E AE               7      XOR (HL)
00175E E48F 28D4            12      JR  Z,POP_HL_RET
                                
001760 E491 C5              11      PUSH    BC
001761 E492 D5              11      PUSH    DE
001762 E493 DDE5            15      PUSH    IX
001764 E495 CDB1E4          17      CALL    WTFATX
001767 E498 3813            12      JR  C,POP_IX_DE_BC_HL_RET
                                
001769 E49A AF               4      XOR A
00176A E49B 32ABF0          13      LD  (_FATIX),A
00176D E49E 3A88F0          13      LD  A,(_DRV)
001770 E4A1 32AAF0          13      LD  (_FATDRV),A
001773 E4A4 CDE5F0          17      CALL    _RDFAT
       E4A7                     RDFATE2:
001776 E4A7 3004            12      JR  NC,POP_IX_DE_BC_HL_RET
001778 E4A9 9F               4      SBC A,A     ;A=0xFF
001779 E4AA 32AAF0          13      LD  (_FATDRV),A
       E4AD                     POP_IX_DE_BC_HL_RET:
00177C E4AD DDE1            14      POP IX
00177E E4AF 18D4            12      JR  POP_DE_BC_HL_RET2
                                
       E4B1                     WTFATX:
001780 E4B1 3AA2F0          13      LD  A,(_WTFATF)
001783 E4B4 B7               4      OR  A
001784 E4B5 C8              11      RET Z
001785 E4B6 E5              11      PUSH    HL
001786 E4B7 3AAAF0          13      LD  A,(_FATDRV)
001789 E4BA 21A5F0          10      LD  HL,_DBDRV
00178C E4BD AE               7      XOR (HL)
00178D E4BE CC67E4          17      CALL    Z,DWTX
001790 E4C1 38A2            12      JR  C,POP_HL_RET
001792 E4C3 C5              11      PUSH    BC
001793 E4C4 D5              11      PUSH    DE
001794 E4C5 DDE5            15      PUSH    IX
001796 E4C7 CD45E7          17      CALL    WTFAT
001799 E4CA AF               4      XOR A
00179A E4CB 32A2F0          13      LD  (_WTFATF),A
00179D E4CE 18DD            12      JR  POP_IX_DE_BC_HL_RET
                                
       E4D0                     NCL1:
00179F E4D0 7A               4      LD  A,D
0017A0 E4D1 B3               4      OR  E
0017A1 E4D2 37               4      SCF
0017A2 E4D3 C8              11      RET Z
                                
0017A3 E4D4 7A               4      LD  A,D
0017A4 E4D5 CB3F             8      SRL A   ;/2
0017A6 E4D7 CB3F             8      SRL A   ;/2
                                
0017A8 E4D9 E5              11      PUSH    HL
0017A9 E4DA 32F9E4          13      LD  (NCLPAT_FATIX),A    ;_FATIX
0017AC E4DD 2AAAF0          16      LD  HL,(_FATDRV)    ;L=_FATDRV H=_FATIX
0017AF E4E0 BC               4      CP  H
0017B0 E4E1 3A88F0          13      LD  A,(_DRV)    ;LDではフラグは変化しない
0017B3 E4E4 32F8E4          13      LD  (NCLPAT_FATDRV),A   ;_FATDRV
0017B6 E4E7 2005            12      JR  NZ,NCL2     ;FATIXが違う
0017B8 E4E9 BD               4      CP  L
0017B9 E4EA 2002            12      JR  NZ,NCL2     ;ドライブが違う
0017BB E4EC E1              10      POP HL
0017BC E4ED C9              10      RET
       E4EE                     NCL2:
0017BD E4EE C5              11      PUSH    BC
0017BE E4EF D5              11      PUSH    DE
0017BF E4F0 DDE5            15      PUSH    IX
0017C1 E4F2 CDB1E4          17      CALL    WTFATX
0017C4 E4F5 38B6            12      JR  C,POP_IX_DE_BC_HL_RET
0017C6 E4F7 010000          10      LD  BC,0        ;自己書き換え C=_FATDRV B=_FATIX
       E4F9                     NCLPAT_FATIX    EQU $-1
       E4F8                     NCLPAT_FATDRV   EQU $-2
0017C9 E4FA ED43AAF0        20      LD  (_FATDRV),BC
0017CD E4FE CD1AE7          17      CALL    RDFATS
0017D0 E501 18A4            12      JR  RDFATE2
                                
       E503                     NCL3:
0017D2 E503 CB9A             8      RES 3,D
0017D4 E505 CB92             8      RES 2,D
0017D6 E507 6B               4      LD  L,E
0017D7 E508 62               4      LD  H,D
0017D8 E509 CB3C             8      SRL H   ;
0017DA E50B CB1D             8      RR  L   ;HLA=HLA/2
0017DC E50D 1F               4      RRA     ;
0017DD E50E F5              11      PUSH    AF
0017DE E50F 3AABF0          13      LD  A,(_FATIX)
0017E1 E512 0F               4      RRCA
0017E2 E513 300B            12      JR  NC,NCL3X1
0017E4 E515 3A3DE3          13      LD  A,(SECSZ+2)
0017E7 E518 FE04             7      CP  4       ;1セクタ1024バイトの場合は奇数インデックスの場合に先頭を512バイトずらす
0017E9 E51A 2004            12      JR  NZ,NCL3X1
0017EB E51C 010002          10      LD  BC,512
0017EE E51F 09              11      ADD HL,BC
       E520                     NCL3X1:
0017EF E520 F1              10      POP AF
0017F0 E521 ED4B7CF1        20      LD  BC,(_FATBF)
0017F4 E525 19              11      ADD HL,DE
0017F5 E526 09              11      ADD HL,BC
0017F6 E527 17               4      RLA
0017F7 E528 C9              10      RET
                                
       E529                     GNCL:
0017F8 E529 CDD0E4          17      CALL    NCL1        ;GET NEXT CLUSTER
0017FB E52C D8              11      RET C
0017FC E52D C5              11      PUSH    BC
0017FD E52E E5              11      PUSH    HL
0017FE E52F CD03E5          17      CALL    NCL3
001801 E532 3809            12      JR  C,GNC1
001803 E534 5E               7      LD  E,(HL)
001804 E535 23               6      INC HL
001805 E536 7E               7      LD  A,(HL)
001806 E537 E60F             7      AND 00FH
001808 E539 57               4      LD  D,A
001809 E53A E1              10      POP HL
00180A E53B C1              10      POP BC
00180B E53C C9              10      RET
       E53D                     GNC1:
00180C E53D 7E               7      LD  A,(HL)
00180D E53E 23               6      INC HL
00180E E53F 56               7      LD  D,(HL)
00180F E540 0604             7      LD  B,4
       E542                     GNC1L:
001811 E542 CB3A             8      SRL D   ;DA=DA/2
001813 E544 1F               4      RRA     ;
001814 E545 10FB            13      DJNZ    GNC1L
                                
001816 E547 5F               4      LD  E,A
001817 E548 E1              10      POP HL
001818 E549 C1              10      POP BC
001819 E54A A7               4      AND A
00181A E54B C9              10      RET
                                
       E54C                     SNCL:
00181B E54C CDD0E4          17      CALL    NCL1
00181E E54F D8              11      RET C
                                ;               SET NEXT CLUSTER
00181F E550 E5              11      PUSH    HL
001820 E551 C5              11      PUSH    BC
001821 E552 D5              11      PUSH    DE
001822 E553 E5              11      PUSH    HL
001823 E554 CD03E5          17      CALL    NCL3
001826 E557 D1              10      POP DE
                                ;CF=ODD
001827 E558 7E               7      LD  A,(HL)
001828 E559 73               7      LD  (HL),E
001829 E55A 3806            12      JR  C,SNC1
                                ;EVEN
                                ;M[0] = E
                                ;M[1] = (M[1] & 0xF0) | (D & 0x0F)
00182B E55C 23               6      INC HL
00182C E55D ED67            18      RRD     ;M={A[3:0],E[3:0]}
00182E E55F 7A               4      LD  A,D
00182F E560 1804            12      JR  SNC11
       E562                     SNC1:
                                ;ODD
                                ;HL[0] = (HL[0]&0x0F) | (E<<4)
                                ;HL[1] = DE>>4
001831 E562 ED6F            18      RLD     ;M={D[3:0],E[7:4]}
001833 E564 23               6      INC HL
001834 E565 72               7      LD  (HL),D  ;M={D[3:0],E[7:4]}
       E566                     SNC11:
001835 E566 ED6F            18      RLD     ;M={M[7:4],D[3:0]}
001837 E568 B7               4      OR  A
001838 E569 D1              10      POP DE
001839 E56A C1              10      POP BC
00183A E56B E1              10      POP HL
       E56C                     FAT_CHANGED:
00183B E56C 3E01             7      LD  A,1
00183D E56E 32A2F0          13      LD  (_WTFATF),A
001840 E571 C9              10      RET
                                
       E572                     N16CL3:
001841 E572 C5              11      PUSH    BC
001842 E573 6B               4      LD  L,E
001843 E574 7A               4      LD  A,D
001844 E575 E603             7      AND 3
001846 E577 67               4      LD  H,A
001847 E578 29              11      ADD HL,HL
001848 E579 ED4B7CF1        20      LD  BC,(_FATBF)
00184C E57D 09              11      ADD HL,BC
00184D E57E C1              10      POP BC
00184E E57F C9              10      RET
                                
       E580                     GNCL16:
00184F E580 CDD0E4          17      CALL    NCL1        ;GET NEXT CLUSTER for FAT16
001852 E583 D8              11      RET C
001853 E584 E5              11      PUSH    HL
001854 E585 CD72E5          17      CALL    N16CL3
001857 E588 5E               7      LD  E,(HL)
001858 E589 23               6      INC HL
001859 E58A 56               7      LD  D,(HL)
00185A E58B E1              10      POP HL
00185B E58C C9              10      RET
                                
       E58D                     SNCL16:
00185C E58D CDD0E4          17      CALL    NCL1        ;GET NEXT CLUSTER for FAT16
00185F E590 D8              11      RET C
001860 E591 D5              11      PUSH    DE
001861 E592 E5              11      PUSH    HL
001862 E593 CD72E5          17      CALL    N16CL3
001865 E596 D1              10      POP DE      ;HL
001866 E597 73               7      LD  (HL),E
001867 E598 23               6      INC HL
001868 E599 72               7      LD  (HL),D
001869 E59A 6B               4      LD  L,E
00186A E59B 62               4      LD  H,D
00186B E59C D1              10      POP DE
00186C E59D 18CD            12      JR  FAT_CHANGED
                                
                                ;------------------------
                                ;次のセクタを探す際に_SECPSの値をチェック
                                ;in
                                ;   DE : セクタ番号
                                ;out
                                ;   DE : 次のセクタ番号
                                ;note
                                ;
                                ;------------------------
       E59F                     NEXTX:
00186E E59F 3E00             7      LD  A,0 ;自己書き換え
       E5A0                     _SECPS  EQU $-1
001870 E5A1 3C               4      INC A
001871 E5A2 E600             7      AND 0   ;自己書き換え　1クラスタの論理セクタ数-1
       E5A3                     _NCPAT  EQU $-1
001873 E5A4 32A0E5          13      LD  (_SECPS),A
001876 E5A7 C9              10      RET
                                
       E5A8                     GNCLX:
001877 E5A8 CD9FE5          17      CALL    NEXTX
00187A E5AB C0              11      RET NZ  ;1クラスタのセクタ未満の場合は戻る
00187B E5AC C3F7F0          10      JP  _GNCL   ;次のクラスタを探す
                                
       E5AF                     RDFAT:
00187E E5AF 3E80             7      LD  A,080H
001880 E5B1 3270F0          13      LD  (CHECK),A
       E5B4                     RDFAT1:
001883 E5B4 3A88F0          13      LD  A,(_DRV)
001886 E5B7 CD63E8          17      CALL    CHGDRVR
001889 E5BA D8              11      RET C
00188A E5BB DD7E12          19      LD  A,(IX+DPB_DEVICE)
00188D E5BE CB6F             8      BIT 5,A
00188F E5C0 2868            12      JR  Z,RDFAT0X
001891 E5C2 2170F0          10      LD  HL,CHECK
001894 E5C5 A6               7      AND (HL)
001895 E5C6 77               7      LD  (HL),A
001896 E5C7 110000          10      LD  DE,0        ;BPB
001899 E5CA 2A7CF1          16      LD  HL,(_FATBF)
00189C E5CD CD26E7          17      CALL    DRD16
00189F E5D0 3024            12      JR  NC,GETBPB
0018A1 E5D2 2170F0          10      LD  HL,CHECK
0018A4 E5D5 CB06            15      RLC (HL)
0018A6 E5D7 3F               4      CCF
0018A7 E5D8 D8              11      RET C
0018A8 E5D9 DDCB0A1E        23      RR  (IX+DPB_FDMODE)
0018AC E5DD 3F               4      CCF         ;フロッピーディスクのFDモードを切り替える
0018AD E5DE DDCB0A16        23      RL  (IX+DPB_FDMODE)
0018B1 E5E2 3EFF             7      LD  A,0FFH
0018B3 E5E4 3289F0          13      LD  (_DSK),A
0018B6 E5E7 3A84F0          13      LD  A,(_DRIVE)
0018B9 E5EA E603             7      AND 3
0018BB E5EC F680             7      OR  080H
0018BD E5EE 6F               4      LD  L,A
0018BE E5EF 26F0             7      LD  H,_CYL0/256
0018C0 E5F1 3EFF             7      LD  A,0FFH
0018C2 E5F3 77               7      LD  (HL),A
0018C3 E5F4 18BE            12      JR  RDFAT1
       E5F6                     GETBPB:
0018C5 E5F6 FDE5            15      PUSH    IY
0018C7 E5F8 FD2A7CF1        20      LD  IY,(_FATBF) ;BPB
0018CB E5FC CDF1F0          17      CALL    _BPB2DPB
0018CE E5FF FDE1            14      POP IY
0018D0 E601 DD7E12          19      LD  A,(IX+DPB_DEVICE)
0018D3 E604 3021            12      JR  NC,GETBPBOK
0018D5 E606 E60F             7      AND 00FH
0018D7 E608 FE07             7      CP  7
0018D9 E60A 37               4      SCF
0018DA E60B C0              11      RET NZ
0018DB E60C DDCB0A46        20      BIT 0,(IX+DPB_FDMODE)
0018DF E610 21C0F1          10      LD  HL,M2D
0018E2 E613 2002            12      JR  NZ,SETFDMODE
0018E4 E615 2ED2             7      LD  L,M2HD-STABLE
       E617                     SETFDMODE:
0018E6 E617 DDE5            15      PUSH    IX
0018E8 E619 D1              10      POP DE
0018E9 E61A EDA0            16      LDI
0018EB E61C EDA0            16      LDI
0018ED E61E 13               6      INC DE
0018EE E61F 13               6      INC DE
0018EF E620 13               6      INC DE
0018F0 E621 13               6      INC DE
0018F1 E622 010C00          10      LD  BC,12
0018F4 E625 EDB0                    LDIR
       E627                     GETBPBOK:
0018F6 E627 CDCEE7          17      CALL    CHGDRV2
       E62A                     RDFAT0X:
0018F9 E62A CD1AE7          17      CALL    RDFATS
0018FC E62D D8              11      RET C
0018FD E62E DDAE06          19      XOR (IX+DPB_FATID)
001900 E631 C8              11      RET Z
001901 E632 DDCB126E        20      BIT 5,(IX+DPB_DEVICE)
001905 E636 C0              11      RET NZ      ;BPBを取得している場合はFATIDをチェックしない
001906 E637 37               4      SCF
001907 E638 C9              10      RET
                                
       E639                     POP_HL_SCF_RET:
001908 E639 E1              10      POP HL
001909 E63A 37               4      SCF
00190A E63B C9              10      RET
                                
       E63C                     BPB2DPB:
00190B E63C FD7E0B          19      LD  A,(IY+11)   ;BPB_BytsPerSec
00190E E63F B7               4      OR  A
00190F E640 37               4      SCF
001910 E641 C0              11      RET NZ
       E642                     BPBOK:
001911 E642 FD7E0D          19      LD  A,(IY+13)   ;BPB_SecPerClus
001914 E645 DD7707          19      LD  (IX+DPB_SECPCL),A
                                
001917 E648 FD7E16          19      LD  A,(IY+22)   ;BPB_FATSz16
00191A E64B DD7700          19      LD  (IX+DPB_FATLN),A
00191D E64E FD7E17          19      LD  A,(IY+23)   ;BPB_FATSz16
001920 E651 DD7701          19      LD  (IX+DPB_FATLN+1),A
                                
001923 E654 FD6E0E          19      LD  L,(IY+14)   ;BPB_RsvdSecCnt
001926 E657 FD660F          19      LD  H,(IY+15)
001929 E65A DD750E          19      LD  (IX+DPB_FATPS),L
00192C E65D FD5E16          19      LD  E,(IY+22)   ;BPB_FATSz16
00192F E660 FD5617          19      LD  D,(IY+23)
001932 E663 FD4610          19      LD  B,(IY+16)   ;BPB_NumFATs
       E666                     BPBDP1:             ;BPB_FATSz16 * BPB_NumFATs
001935 E666 19              11      ADD HL,DE
001936 E667 10FD            13      DJNZ    BPBDP1
       E669                     BPBDP2:
001938 E669 DD7510          19      LD  (IX+DPB_DIRPS),L
00193B E66C DD7411          19      LD  (IX+DPB_DIRPS+1),H
00193E E66F E5              11      PUSH    HL
                                
00193F E670 FD6E11          19      LD  L,(IY+17)   ;BPB_RootEntCnt
001942 E673 FD6612          19      LD  H,(IY+18)
001945 E676 FD7E0C          19      LD  A,(IY+12)   ;BPB_BytsPerSec
001948 E679 B7               4      OR  A
001949 E67A 28BD            12      JR  Z,POP_HL_SCF_RET
00194B E67C 0606             7      LD  B,6
       E67E                     BPBBPS1:
00194D E67E 05               4      DEC B
00194E E67F 0F               4      RRCA
00194F E680 30FC            12      JR  NC,BPBBPS1
       E682                     BPBDE1:
001951 E682 29              11      ADD HL,HL
001952 E683 10FD            13      DJNZ    BPBDE1
                                
001954 E685 7C               4      LD  A,H
001955 E686 DD770B          19      LD  (IX+DPB_DIRSCNT),A  ;
                                
001958 E689 D1              10      POP DE      ;DPB_DIRPS
001959 E68A 6C               4      LD  L,H
00195A E68B 2600             7      LD  H,0
00195C E68D 19              11      ADD HL,DE       ;MAXDIR
00195D E68E E5              11      PUSH    HL
00195E E68F FD4E0D          19      LD  C,(IY+13)   ;BPB_SecPerClus
001961 E692 CB21             8      SLA C       ;*2
001963 E694 AF               4      XOR A
001964 E695 47               4      LD  B,A
001965 E696 ED42            15      SBC HL,BC
001967 E698 DD7514          19      LD  (IX+DPB_ADDCL),L
00196A E69B DD7415          19      LD  (IX+DPB_ADDCL+1),H
                                
00196D E69E D1              10      POP DE      ;DE=DPB_MAXDIR
00196E E69F FD6E13          19      LD  L,(IY+19)   ;BPB_TotSec16
001971 E6A2 FD6614          19      LD  H,(IY+20)
                                
001974 E6A5 DD7E12          19      LD  A,(IX+DPB_DEVICE)
001977 E6A8 E60F             7      AND 00FH
001979 E6AA FE07             7      CP  7       ;フロッピー
00197B E6AC 2019            12      JR  NZ,NOT_FD
00197D E6AE E5              11      PUSH    HL
00197E E6AF FD4E18          19      LD  C,(IY+24)   ;BPB_SecPerTr
001981 E6B2 DD710D          19      LD  (IX+DPB_MAXSEC),C
001984 E6B5 AF               4      XOR A
001985 E6B6 CB21             8      SLA C       ;両面なのでセクタ数を２倍
001987 E6B8 0610             7      LD  B,16
       E6BA                     DIVSEC:             ;MAXCYL = BPB_TotSec16 / (BPB_SecPerTr * 2)
001989 E6BA 29              11      ADD HL,HL
00198A E6BB 17               4      RLA
00198B E6BC B9               4      CP  C
00198C E6BD 3802            12      JR  C,DIVSEC1
00198E E6BF 91               4      SUB C
00198F E6C0 2C               4      INC L
       E6C1                     DIVSEC1:
001990 E6C1 10F7            13      DJNZ    DIVSEC
001992 E6C3 DD750C          19      LD  (IX+DPB_MAXCYL),L
001995 E6C6 E1              10      POP HL  ;ここまでフロッピー専用
       E6C7                     NOT_FD:
001996 E6C7 7C               4      LD  A,H
001997 E6C8 B5               4      OR  L
001998 E6C9 3E00             7      LD  A,0     ;LDでフラグは変化しない。BPB_TotSec16を AHL で扱う為、Aに0を入れる
00199A E6CB 2010            12      JR  NZ,BPB16BIT ;BPB_TotSec16が「0」の場合はBPB_TotSec32で計算
00199C E6CD FD7E23          19      LD  A,(IY+35)   ;念のために総セクタ数が24ビットを超える場合はエラーを返す
00199F E6D0 B7               4      OR  A
0019A0 E6D1 37               4      SCF
0019A1 E6D2 C0              11      RET NZ
0019A2 E6D3 FD6E20          19      LD  L,(IY+32)   ;BPB_TotSec32 は AHL の24ビットで扱う
0019A5 E6D6 FD6621          19      LD  H,(IY+33)   ;1クラスタの論理セクタ数(DPB_SECPCL)が最大128なので
0019A8 E6D9 FD7E22          19      LD  A,(IY+34)   ;24ビットを超えると必ずクラスタ数が16ビットを超えてしまうのでこれで十分
0019AB E6DC A7               4      AND A       ;CF=0
       E6DD                     BPB16BIT:
0019AC E6DD ED52            15      SBC HL,DE
0019AE E6DF DE00             7      SBC A,0
0019B0 E6E1 FD460D          19      LD  B,(IY+13)   ;BPB_SecPerClus
       E6E4                     BPBTC1:             ;総クラスタ数(AHL) = 総セクタ数(AHL) / セクタサイズ(B)
0019B3 E6E4 CB18             8      RR  B       ;->CY
0019B5 E6E6 3808            12      JR  C,BPBTC2
0019B7 E6E8 CB3F             8      SRL A
0019B9 E6EA CB1C             8      RR  H       ;AHL=AHL/2
0019BB E6EC CB1D             8      RR  L
0019BD E6EE 18F4            12      JR  BPBTC1
       E6F0                     BPBTC2:
0019BF E6F0 B7               4      OR  A
0019C0 E6F1 37               4      SCF
0019C1 E6F2 C0              11      RET NZ      ;念のため(クラスタ数が16ビットを超える場合)
0019C2 E6F3 23               6      INC HL
0019C3 E6F4 23               6      INC HL
0019C4 E6F5 DD7508          19      LD  (IX+DPB_MAXCL),L
0019C7 E6F8 DD7409          19      LD  (IX+DPB_MAXCL+1),H
                                
0019CA E6FB FD7E15          19      LD  A,(IY+21)   ;BPB_Media
0019CD E6FE DD7706          19      LD  (IX+DPB_FATID),A
                                
0019D0 E701 FD7E10          19      LD  A,(IY+16)   ;BPB_NumFATs
0019D3 E704 C6FE             7      ADD A,0-2       ;>2:CF=1
0019D5 E706 FD7E0C          19      LD  A,(IY+12)   ;BPB_BytsPerSec
0019D8 E709 6F               4      LD  L,A
0019D9 E70A 3002            12      JR  NC,BPBFAT1
0019DB E70C F680             7      OR  080H
       E70E                     BPBFAT1:            ;ここではCF=0
0019DD E70E DD770F          19      LD  (IX+DPB_BPS),A
0019E0 E711 2D               4      DEC L       ;以下のセクタサイズに合致しない場合はCF=1でエラーにする
0019E1 E712 C8              11      RET Z       ;1セクタ256バイト
0019E2 E713 2D               4      DEC L
0019E3 E714 C8              11      RET Z       ;1セクタ512バイト
0019E4 E715 2D               4      DEC L
0019E5 E716 2D               4      DEC L
0019E6 E717 C8              11      RET Z       ;1セクタ1024バイト
0019E7 E718 37               4      SCF
0019E8 E719 C9              10      RET
                                
       E71A                     RDFATS:
0019E9 E71A CD60E7          17      CALL    FATSETUP
0019EC E71D D8              11      RET C
0019ED E71E CD2AE7          17      CALL    DRD24B
0019F0 E721 2A7CF1          16      LD  HL,(_FATBF)
0019F3 E724 7E               7      LD  A,(HL)
0019F4 E725 C9              10      RET
                                
       E726                     DRD16:
0019F5 E726 0E00             7      LD  C,0
       E728                     DRD24:
0019F7 E728 0601             7      LD  B,1
       E72A                     DRD24B:
0019F9 E72A DDE5            15      PUSH    IX
0019FB E72C DD2AA8F0        20      LD  IX,(_DPB)
0019FF E730 CDB1E9          17      CALL    FDRD        ;自己書き換え（ディスク読み込み）
       E731                     DRDPAT  EQU $-2
       E733                     POP_IX_RET:
001A02 E733 DDE1            14      POP IX
001A04 E735 C9              10      RET
                                
       E736                     DWT16:
001A05 E736 0E00             7      LD  C,0
       E738                     DWT24:
001A07 E738 0601             7      LD  B,1
       E73A                     DWT24B:
001A09 E73A DDE5            15      PUSH    IX
001A0B E73C DD2AA8F0        20      LD  IX,(_DPB)
001A0F E740 CD57E9          17      CALL    FDWT        ;自己書き換え（ディスク書き込み）
       E741                     DWTPAT  EQU $-2
001A12 E743 18EE            12      JR  POP_IX_RET
                                
       E745                     WTFAT:
001A14 E745 CD60E7          17      CALL    FATSETUP
001A17 E748 D43AE7          17      CALL    NC,DWT24B
001A1A E74B D8              11      RET C
001A1B E74C DDCB0F7E        20      BIT 7,(IX+DPB_BPS)
001A1F E750 C8              11      RET Z       ;予備FATが無い
001A20 E751 CD67E7          17      CALL    FATS2
001A23 E754 E5              11      PUSH    HL      ;予備FAT
001A24 E755 DD6E00          19      LD  L,(IX+DPB_FATLN)
001A27 E758 DD6601          19      LD  H,(IX+DPB_FATLN+1)
001A2A E75B 19              11      ADD HL,DE
001A2B E75C EB               4      EX  DE,HL
001A2C E75D E1              10      POP HL
001A2D E75E 18DA            12      JR  DWT24B
                                ;------------------------
                                ;FATのセットアップ
                                ;out
                                ;   B  : FATセクタ数
                                ;   DE : FAT先頭セクタ番号
                                ;   HL : FATバッファポインタ
                                ;   CF : 1=ドライブ切り替えエラー
                                ;note
                                ;   FATサイズがFATバッファを超える場合は
                                ;   対象クラスタ領域==(_FATIX)によって
                                ;   FAT12:対象クラスタ1024毎に1.5KBを切り替える
                                ;   FAT16:対象クラスタ1024毎に2KBを切り替える
                                ;------------------------
       E760                     FATSETUP:
001A2F E760 3AAAF0          13      LD  A,(_FATDRV)
001A32 E763 CD63E8          17      CALL    CHGDRVR     ;ドライブ切り替え
001A35 E766 D8              11      RET C
       E767                     FATS2:
001A36 E767 DD7E0F          19      LD  A,(IX+DPB_BPS)  ;512=2 1024=4
001A39 E76A 0F               4      RRCA
001A3A E76B CD94E7          17      CALL    FATSETUP12  ;自己書き換え
       E76C                     FATSX   EQU $-2
001A3D E76E 210000          10      LD  HL,0
001A40 E771 4A               4      LD  C,D
001A41 E772 54               4      LD  D,H
001A42 E773 3AABF0          13      LD  A,(_FATIX)  ;範囲FAT12:0-3/FAT16:0-63(0-03FH):65535*2/2048
001A45 E776 47               4      LD  B,A
001A46 E777 04               4      INC B
001A47 E778 DD7E00          19      LD  A,(IX+DPB_FATLN)
       E77B                     FAT_SKP:
001A4A E77B 05               4      DEC B
001A4B E77C 2805            12      JR  Z,FAT1
001A4D E77E 19              11      ADD HL,DE
001A4E E77F 93               4      SUB E
001A4F E780 30F9            12      JR  NC,FAT_SKP
001A51 E782 C9              10      RET
       E783                     FAT1:
001A52 E783 EB               4      EX  DE,HL
001A53 E784 B9               4      CP  C       ;C=FATバッファに読み込めるセクタ数
001A54 E785 3801            12      JR  C,FAT2
001A56 E787 79               4      LD  A,C
       E788                     FAT2:
001A57 E788 47               4      LD  B,A
                                
001A58 E789 2AFAF1          16      LD  HL,(_FATPS) ;fat sector pos
001A5B E78C 19              11      ADD HL,DE
001A5C E78D EB               4      EX  DE,HL
001A5D E78E 2A7CF1          16      LD  HL,(_FATBF)
001A60 E791 AF               4      XOR A       ;CF=0
001A61 E792 4F               4      LD  C,A
001A62 E793 C9              10      RET
                                ;
                                ;   FATバッファに読み込める最大のセクタ数と_FATIXで進めるセクタ数
                                ;   FATSETUP* (FAT12/FAT16)
                                ;out
                                ;   D : FATバッファに読み込める最大のセクタ数
                                ;   E : _FATIXで進めるセクタ数
       E794                     FATSETUP12:
001A63 E794 110606          10      LD  DE,0606H    ;256
001A66 E797 D8              11      RET C
001A67 E798 110303          10      LD  DE,0303H    ;512
001A6A E79B 0F               4      RRCA
001A6B E79C D8              11      RET C
001A6C E79D 110102          10      LD  DE,0201H    ;1024
001A6F E7A0 C9              10      RET
                                
       E7A1                     FATSETUP16:
001A70 E7A1 110808          10      LD  DE,0808H    ;256
001A73 E7A4 D8              11      RET C
001A74 E7A5 110404          10      LD  DE,0404H
001A77 E7A8 0F               4      RRCA            ;512
001A78 E7A9 D8              11      RET C
001A79 E7AA 110202          10      LD  DE,0202H    ;1024
001A7C E7AD C9              10      RET
                                
       E7AE                     CHGDRV:
001A7D E7AE E5              11      PUSH    HL
001A7E E7AF 2189F0          10      LD  HL,_DSK
001A81 E7B2 BE               7      CP  (HL)
001A82 E7B3 280A            12      JR  Z,CHGDRVE
       E7B5                     CHGDRV1:
001A84 E7B5 DDE5            15      PUSH    IX
001A86 E7B7 CDC1E7          17      CALL    CHGDRV0
001A89 E7BA 3A89F0          13      LD  A,(_DSK)
001A8C E7BD DDE1            14      POP IX
       E7BF                     CHGDRVE:
001A8E E7BF E1              10      POP HL
001A8F E7C0 C9              10      RET
                                
       E7C1                     CHGDRV0:
001A90 E7C1 6F               4      LD  L,A
001A91 E7C2 CDDCF0          17      CALL    _GETDPB
001A94 E7C5 D8              11      RET C
001A95 E7C6 DD22A8F0        20      LD  (_DPB),IX
001A99 E7CA 7D               4      LD  A,L
001A9A E7CB 3289F0          13      LD  (_DSK),A
       E7CE                     CHGDRV2:
001A9D E7CE C5              11      PUSH    BC
001A9E E7CF D5              11      PUSH    DE
001A9F E7D0 ED7319E8        20      LD  (SPPAT2),SP
001AA3 E7D4 F3               4      DI
001AA4 E7D5 DDF9            10      LD  SP,IX
                                
001AA6 E7D7 E1              10      POP HL      ;00:DPB_FATLN
001AA7 E7D8 E1              10      POP HL      ;02:DPB_DRD
001AA8 E7D9 2231E7          16      LD  (DRDPAT),HL
                                
001AAB E7DC E1              10      POP HL
001AAC E7DD 2241E7          16      LD  (DWTPAT),HL ;04:DPB_DWT
                                
001AAF E7E0 E1              10      POP HL      ;L=06:DPB_FATID H=07:DPB_SECPCL
001AB0 E7E1 7C               4      LD  A,H
001AB1 E7E2 3238DE          13      LD  (SPCPAT),A  ;1クラスタの論理セクタ数
001AB4 E7E5 3D               4      DEC A
001AB5 E7E6 32A3E5          13      LD  (_NCPAT),A
                                
001AB8 E7E9 E1              10      POP HL      ;08:DPB_MAXCL
001AB9 E7EA 7D               4      LD  A,L
001ABA E7EB 3257DE          13      LD  (CLPAT2),A
001ABD E7EE 7C               4      LD  A,H
001ABE E7EF 3253DE          13      LD  (CLPAT1),A
001AC1 E7F2 2B               6      DEC HL
001AC2 E7F3 2254E0          16      LD  (MAXCLP),HL
                                
001AC5 E7F6 E1              10      POP HL      ;L=0A:DPB_FDMODE H=0B:DPB_DIRSCNT
001AC6 E7F7 4C               4      LD  C,H
                                
001AC7 E7F8 E1              10      POP HL      ;L=0C:DPB_MAXCYL H=0D:DPB_MAXSEC
                                
001AC8 E7F9 E1              10      POP HL      ;L=0E:DPB_FATPS H=0F:DPB_BPS
001AC9 E7FA 7C               4      LD  A,H     ;DPB_BPS
001ACA E7FB E607             7      AND 7
001ACC E7FD 323DE3          13      LD  (SECSZ+2),A ;1セクタのサイズの上位1バイト 0x400 - 0x200 - 0x100
                                                ;1セクタ512 2D/2DD/2HC/2HQ(2HD1.44MB)/EMM/BRAM/EMEM等
                                                ;1セクタ1024 2HD/2HDE98
                                                ;1セクタ256 GRAM/RAMF/CMOS/等
                                                ;1024   512 256
                                                ;4  2   1
001ACF E800 87               4      ADD A,A     ;8  4   2
001AD0 E801 87               4      ADD A,A     ;010H   8   4
001AD1 E802 87               4      ADD A,A     ;020H   010H    8
001AD2 E803 32B5DC          13      LD  (SDECPAT),A ;1セクタ辺りのディレクトリエントリ数
                                
001AD5 E806 2600             7      LD  H,0
001AD7 E808 22FAF1          16      LD  (_FATPS),HL
                                
001ADA E80B E1              10      POP HL      ;10:DPB_DIRPS
001ADB E80C 22FCF1          16      LD  (_DIRPS),HL
                                
001ADE E80F E1              10      POP HL      ;L=12:DPB_DEVICE H=13:DPB_UNITNO
001ADF E810 7C               4      LD  A,H
001AE0 E811 3284F0          13      LD  (_DRIVE),A
                                
001AE3 E814 E1              10      POP HL      ;14:DPB_ADDCL
001AE4 E815 2248DE          16      LD  (CLSPAT),HL
                                
001AE7 E818 310000          10      LD  SP,0        ;元のSPを復元
       E819                     SPPAT2  EQU $-2
001AEA E81B FB               4      EI
001AEB E81C 2AFCF1          16      LD  HL,(_DIRPS)
001AEE E81F 0600             7      LD  B,0
001AF0 E821 09              11      ADD HL,BC       ;C=DPB_DIRSCNT
001AF1 E822 22D0DC          16      LD  (MD_PAT),HL
                                
001AF4 E825 2A54E0          16      LD  HL,(MAXCLP);
001AF7 E828 11F60F          10      LD  DE,4086     ;クラスタ数が4086未満:FAT12 4086以上:FAT16
001AFA E82B ED52            15      SBC HL,DE       ;CF=0のはず
001AFC E82D 300F            12      JR  NC,SETFAT16
001AFE E82F 2129E5          10      LD  HL,GNCL     ;FAT12
001B01 E832 114CE5          10      LD  DE,SNCL
001B04 E835 0194E7          10      LD  BC,FATSETUP12
001B07 E838 DDCB0FAE        23      RES 5,(IX+DPB_BPS)  ;DPB_BPS(FAT12)
001B0B E83C 180D            12      JR  EXTRA1
       E83E                     SETFAT16:
001B0D E83E 2180E5          10      LD  HL,GNCL16   ;FAT16
001B10 E841 118DE5          10      LD  DE,SNCL16
001B13 E844 01A1E7          10      LD  BC,FATSETUP16
001B16 E847 DDCB0FEE        23      SET 5,(IX+DPB_BPS)  ;DPB_BPS(FAT16)
       E84B                     EXTRA1:
001B1A E84B 22F8F0          16      LD  (GNCPAT),HL
001B1D E84E ED53FBF0        20      LD  (SNCPAT),DE
001B21 E852 ED436CE7        20      LD  (FATSX),BC
001B25 E856 D1              10      POP DE
001B26 E857 C1              10      POP BC
001B27 E858 AF               4      XOR A
001B28 E859 C9              10      RET
                                
       E85A                     GETDPBD:
001B29 E85A DDE3            23      EX  (SP),IX
001B2B E85C DDE5            15      PUSH    IX
001B2D E85E 3A88F0          13      LD  A,(_DRV)
001B30 E861 1807            12      JR  GETDPB1
                                
       E863                     CHGDRVR:
001B32 E863 CDD9F0          17      CALL    _CHGDRV
001B35 E866 D8              11      RET C
001B36 E867 3A89F0          13      LD  A,(_DSK)
       E86A                     GETDPB1:
001B39 E86A C3DCF0          10      JP  _GETDPB
                                
       E86D                     GETDPB:
001B3C E86D FE08             7      CP  8
001B3E E86F 3F               4      CCF
001B3F E870 D8              11      RET C
001B40 E871 0F               4      RRCA
001B41 E872 0F               4      RRCA
001B42 E873 0F               4      RRCA
001B43 E874 DD                      DB  0DDH        ;Z80未定義命令
001B44 E875 6F               4      LD  L,A     ;LD IXL,A
001B45 E876 DD                      DB  0DDH        ;Z80未定義命令
001B46 E877 26F2             7      LD  H,_DEVICE/256   ;LD IXH,_DEVICE/256
001B48 E879 DD7E00          19      LD  A,(IX+DPB_FATLN)
001B4B E87C A7               4      AND A       ;CF=0の為
001B4C E87D DDCB0F6E        20      BIT 5,(IX+DPB_BPS)
001B50 E881 C0              11      RET NZ      ;FAT16
001B51 E882 DDCB126E        20      BIT 5,(IX+DPB_DEVICE)
001B55 E886 C0              11      RET NZ      ;BPB
001B56 E887 FE01             7      CP  001H        ;A=0 THEN CF=1
001B58 E889 C9              10      RET
                                
       E88A                     _SYS5F:
001B59 E88A AF               4      XOR A
       E88B                     FFLUSH:
001B5A E88B F5              11      PUSH    AF
001B5B E88C CDB1E4          17      CALL    WTFATX
001B5E E88F AF               4      XOR A
001B5F E890 32ABF0          13      LD  (_FATIX),A
001B62 E893 2F               4      CPL         ;0FFH
001B63 E894 32AAF0          13      LD  (_FATDRV),A
001B66 E897 3E                      DB  03EH        ;次のPUSH AFをスキップ
       E898                     FFLUSHBUF:
001B67 E898 F5              11      PUSH    AF
001B68 E899 CD67E4          17      CALL    DWTX
001B6B E89C 3EFF             7      LD  A,0FFH
001B6D E89E 3239F0          13      LD  (SFILE),A
001B70 E8A1 32A5F0          13      LD  (_DBDRV),A
001B73 E8A4 F1              10      POP AF
001B74 E8A5 C9              10      RET
                                
[EOF:LDDIO.ASM:SHIFT_JIS]
                                    INCLUDE "M7DISK.ASM"
                                
                                ;   LSX-Dodgers DISK
                                ;   MZ-700/1500
                                
       E8A6                     SEEK:
001B75 E8A6 0610             7      LD  B,16
001B77 E8A8 DD4E0D          19      LD  C,(IX+DPB_MAXSEC)
001B7A E8AB AF               4      XOR A
001B7B E8AC EB               4      EX  DE,HL
       E8AD                     DIV1:
001B7C E8AD 29              11      ADD HL,HL
001B7D E8AE 8F               4      ADC A,A
001B7E E8AF B9               4      CP  C
001B7F E8B0 3802            12      JR  C,DIV2
001B81 E8B2 91               4      SUB C
001B82 E8B3 2C               4      INC L
       E8B4                     DIV2:
001B83 E8B4 10F7            13      DJNZ    DIV1
                                
001B85 E8B6 3C               4      INC A   ;最小のセクタは１固定
001B86 E8B7 55               4      LD  D,L ;TRACK
001B87 E8B8 5F               4      LD  E,A ;SECTOR
                                
001B88 E8B9 3A84F0          13      LD  A,(_DRIVE)
001B8B E8BC FE04             7      CP  4
001B8D E8BE 3F               4      CCF
001B8E E8BF D8              11      RET C
001B8F E8C0 F684             7      OR  084H        ;Motor on + ドライブセレクト有効
001B91 E8C2 D3DC            11      OUT (0DCH),A
001B93 E8C4 CB3A             8      SRL D       ;CYLINDER
001B95 E8C6 9F               4      SBC A,A
001B96 E8C7 D3DD            11      OUT (0DDH),A    ;SIDE
                                
001B98 E8C9 CD05E9          17      CALL    SETMODE
001B9B E8CC D8              11      RET C
                                
001B9C E8CD CD41E9          17      CALL    DRIVE
001B9F E8D0 FEFF             7      CP  0FFH        ;A=0FFH Unknown CYLINDER
001BA1 E8D2 CC26E9          17      CALL    Z,FDCRES    ;Restore
001BA4 E8D5 2F               4      CPL         ;データバスが負論理
001BA5 E8D6 D3D9            11      OUT (0D9H),A    ;Currrent CYLINDER
001BA7 E8D8 2F               4      CPL         ;データバスが負論理
001BA8 E8D9 92               4      SUB D
001BA9 E8DA C8              11      RET Z       ;No seek
                                
001BAA E8DB 3A86F0          13      LD  A,(_ISEEK)
001BAD E8DE 4F               4      LD  C,A
                                
001BAE E8DF DD7E0C          19      LD  A,(IX+DPB_MAXCYL)
001BB1 E8E2 3D               4      DEC A
001BB2 E8E3 BA               4      CP  D       ;Over CYLINDER
001BB3 E8E4 D8              11      RET C
                                
001BB4 E8E5 7A               4      LD  A,D
001BB5 E8E6 2F               4      CPL         ;データバスが負論理
001BB6 E8E7 D3DB            11      OUT (0DBH),A
001BB8 E8E9 72               7      LD  (HL),D
                                
001BB9 E8EA 0E18             7      LD  C,018H      ;Seek
       E8EC                     FDCCMD2:
001BBB E8EC 3A85F0          13      LD  A,(_SEEKSP)
001BBE E8EF B1               4      OR  C
                                
       E8F0                     FDCCMD:
001BBF E8F0 CD38E9          17      CALL    COMSET
       E8F4                     FDCSMC  EQU $+1
001BC2 E8F3 3E80             7      LD  A,080H      ;FDC COMMAND(Self-modifying code)
001BC4 E8F5 E620             7      AND 020H        ;Write data Write track
001BC6 E8F7 3C               4      INC A
                                
       E8F8                     SST:
001BC7 E8F8 0E00             7      LD  C,0
       E8FA                     SST1:
001BC9 E8FA 0D               4      DEC C       ; 4
001BCA E8FB 20FD            12      JR  NZ,SST1     ;12 * 256 / 4 = About 1ms
001BCC E8FD 3D               4      DEC A
001BCD E8FE 20FA            12      JR  NZ,SST1
                                
001BCF E900 0E01             7      LD  C,1
001BD1 E902 CD0AE9          17      CALL    READY
       E905                     SETMODE:
001BD4 E905 CD3BE9          17      CALL    DELAY0      ;Head select time
001BD7 E908 0E81             7      LD  C,081H
       E90A                     READY:
001BD9 E90A 0680             7      LD  B,128
       E90C                     READY2:
001BDB E90C DBD8            11      IN  A,(0D8H)
001BDD E90E 2F               4      CPL         ;データバスが負論理
001BDE E90F A1               4      AND C       ;NOT READY,BUSY
001BDF E910 C8              11      RET Z
001BE0 E911 CD1BCF          17      CALL    RD556VSYNC
001BE3 E914 87               4      ADD A,A
001BE4 E915 30F5            12      JR  NC,READY2
       E917                     READY3:
001BE6 E917 DBD8            11      IN  A,(0D8H)
001BE8 E919 2F               4      CPL         ;データバスが負論理
001BE9 E91A A1               4      AND C       ;NOT READY,BUSY
001BEA E91B C8              11      RET Z
001BEB E91C CD1BCF          17      CALL    RD556VSYNC
001BEE E91F 87               4      ADD A,A
001BEF E920 38F5            12      JR  C,READY3
001BF1 E922 10E8            13      DJNZ    READY2
001BF3 E924 37               4      SCF
001BF4 E925 C9              10      RET
                                
       E926                     FDCRES:
001BF5 E926 3600            10      LD  (HL),0
001BF7 E928 0E08             7      LD  C,8
001BF9 E92A 18C0            12      JR  FDCCMD2
                                
       E92C                     FDMOFF:
001BFB E92C F5              11      PUSH    AF
001BFC E92D AF               4      XOR A       ;Motor off(ドライブセレクト無効)
001BFD E92E D3DC            11      OUT (0DCH),A
001BFF E930 F1              10      POP AF
001C00 E931 C9              10      RET
                                
       E932                     SECSET:
001C01 E932 F5              11      PUSH    AF
001C02 E933 7B               4      LD  A,E
001C03 E934 2F               4      CPL         ;データバスが負論理
001C04 E935 D3DA            11      OUT (0DAH),A
001C06 E937 F1              10      POP AF
       E938                     COMSET:
001C07 E938 2F               4      CPL         ;データバスが負論理
001C08 E939 D3D8            11      OUT (0D8H),A
       E93B                     DELAY0:
001C0A E93B 3E1A             7      LD  A,26
       E93D                     DELAY:
001C0C E93D 3D               4      DEC A
001C0D E93E 20FD            12      JR  NZ,DELAY
001C0F E940 C9              10      RET
                                
       E941                     DRIVE:
001C10 E941 2A84F0          16      LD  HL,(_DRIVE)
001C13 E944 26F0             7      LD  H,_CYL0/256
001C15 E946 CBFD             8      SET 7,L
001C17 E948 7E               7      LD  A,(HL)
001C18 E949 C9              10      RET
                                
       E94A                     RNF:
001C19 E94A CD41E9          17      CALL    DRIVE
001C1C E94D 36FF            10      LD  (HL),0FFH
001C1E E94F C9              10      RET
                                
001C1F E950 02                  RETRY:  DB  2
                                
                                
                                ;   FLOPPY DISK DRIVER
                                
       E951                     WTTRK:
001C20 E951 0601             7      LD  B,1
001C22 E953 3EF4             7      LD  A,0F4H
001C24 E955 1802            12      JR  WTTRK1
       E957                     FDWT:
001C26 E957 3EA0             7      LD  A,0A0H
       E959                     WTTRK1:
001C28 E959 32F4E8          13      LD  (FDCSMC),A
       E95C                     DWTBL:
001C2B E95C 78               4      LD  A,B
001C2C E95D 329CE9          13      LD  (WTBSMC),A
001C2F E960 3E02             7      LD  A,2     ;Retry count
001C31 E962 3250E9          13      LD  (RETRY),A
                                
       E965                     DWT0:
001C34 E965 D5              11      PUSH    DE
001C35 E966 E5              11      PUSH    HL
001C36 E967 CDA6E8          17      CALL    SEEK        ;Write disk
001C39 E96A E1              10      POP HL
001C3A E96B 383A            12      JR  C,ERRDW
001C3C E96D F3               4      DI
001C3D E96E 3AF4E8          13      LD  A,(FDCSMC)
001C40 E971 CD32E9          17      CALL    SECSET
001C43 E974 0EDB             7      LD  C,0DBH
       E976                     DWT1:
001C45 E976 7E               7      LD  A,(HL)
001C46 E977 2F               4      CPL         ;データバスが負論理
001C47 E978 57               4      LD  D,A
                                
       E979                     DWT2:
001C48 E979 DBD8            11      IN  A,(0D8H)
001C4A E97B 2F               4      CPL         ;データバスが負論理
001C4B E97C 0F               4      RRCA
001C4C E97D 3008            12      JR  NC,DWT4
001C4E E97F 0F               4      RRCA
001C4F E980 30F7            12      JR  NC,DWT2
       E982                     DWT3:
001C51 E982 ED51            12      OUT (C),D
001C53 E984 23               6      INC HL
001C54 E985 18EF            12      JR  DWT1
                                
       E987                     DWT4:
001C56 E987 3D               4      DEC A
001C57 E988 28F8            12      JR  Z,DWT3
001C59 E98A 3C               4      INC A
001C5A E98B FB               4      EI
001C5B E98C D1              10      POP DE
001C5C E98D 13               6      INC DE
001C5D E98E CD2CE9          17      CALL    FDMOFF
001C60 E991 2808            12      JR  Z,DISKOK_WT
001C62 E993 CDFEE9          17      CALL    DISKC
001C65 E996 20CD            12      JR  NZ,DWT0
001C67 E998 B7               4      OR  A
001C68 E999 2005            12      JR  NZ,ERRW
                                
       E99B                     DISKOK_WT:
       E99C                     WTBSMC  EQU $+1
001C6A E99B 0601             7      LD  B,1
001C6C E99D 10BD            13      DJNZ    DWTBL
001C6E E99F C9              10      RET
                                
       E9A0                     ERRW:
001C6F E9A0 3EFF             7      LD  A,0FFH
       E9A2                     ERRZ:
001C71 E9A2 BF               4      CP  A
001C72 E9A3 37               4      SCF
001C73 E9A4 C32CE9          10      JP  FDMOFF
                                
       E9A7                     ERRDW:
001C76 E9A7 D1              10      POP DE
001C77 E9A8 CD0FEA          17      CALL    DELP
001C7A E9AB 20B8            12      JR  NZ,DWT0
001C7C E9AD B7               4      OR  A
001C7D E9AE 20F0            12      JR  NZ,ERRW
001C7F E9B0 C9              10      RET
                                
       E9B1                     FDRD:
001C80 E9B1 3E80             7      LD  A,080H
001C82 E9B3 32F4E8          13      LD  (FDCSMC),A
       E9B6                     DRDBL:
001C85 E9B6 78               4      LD  A,B
001C86 E9B7 32F0E9          13      LD  (RDBSMC),A
001C89 E9BA 3E02             7      LD  A,2     ;Retry count
001C8B E9BC 3250E9          13      LD  (RETRY),A
       E9BF                     DRD0:
001C8E E9BF D5              11      PUSH    DE
001C8F E9C0 E5              11      PUSH    HL
001C90 E9C1 CDA6E8          17      CALL    SEEK        ;Read disk
001C93 E9C4 E1              10      POP HL
001C94 E9C5 382D            12      JR  C,ERRDR
001C96 E9C7 F3               4      DI
001C97 E9C8 3AF4E8          13      LD  A,(FDCSMC)
001C9A E9CB CD32E9          17      CALL    SECSET
       E9CE                     DRD1:
001C9D E9CE DBD8            11      IN  A,(0D8H)
001C9F E9D0 2F               4      CPL         ;データバスが負論理
001CA0 E9D1 0F               4      RRCA
001CA1 E9D2 300A            12      JR  NC,DRD3
001CA3 E9D4 0F               4      RRCA
001CA4 E9D5 30F7            12      JR  NC,DRD1
001CA6 E9D7 DBDB            11      IN  A,(0DBH)
001CA8 E9D9 2F               4      CPL         ;データバスが負論理
001CA9 E9DA 77               7      LD  (HL),A
001CAA E9DB 23               6      INC HL
001CAB E9DC 18F0            12      JR  DRD1
                                
       E9DE                     DRD3:
001CAD E9DE B7               4      OR  A
001CAE E9DF FB               4      EI
001CAF E9E0 D1              10      POP DE
001CB0 E9E1 13               6      INC DE
001CB1 E9E2 CD2CE9          17      CALL    FDMOFF
001CB4 E9E5 2808            12      JR  Z,DISKOK_RD
001CB6 E9E7 CDFEE9          17      CALL    DISKC
001CB9 E9EA 20D3            12      JR  NZ,DRD0
001CBB E9EC B7               4      OR  A
001CBC E9ED 20B1            12      JR  NZ,ERRW
                                
       E9EF                     DISKOK_RD:
       E9F0                     RDBSMC  EQU $+1
001CBE E9EF 0601             7      LD  B,1
001CC0 E9F1 10C3            13      DJNZ    DRDBL
001CC2 E9F3 C9              10      RET
                                
       E9F4                     ERRDR:
001CC3 E9F4 D1              10      POP DE
001CC4 E9F5 CD0FEA          17      CALL    DELP
001CC7 E9F8 20C5            12      JR  NZ,DRD0
001CC9 E9FA B7               4      OR  A
001CCA E9FB 20A3            12      JR  NZ,ERRW
001CCC E9FD C9              10      RET
       E9FE                     DISKC:
001CCD E9FE 1B               6      DEC DE
001CCE E9FF CB5F             8      BIT 3,A
001CD0 EA01 C44AE9          17      CALL    NZ,RNF
       EA04                     DISKD:
001CD3 EA04 E5              11      PUSH    HL
001CD4 EA05 2150E9          10      LD  HL,RETRY
001CD7 EA08 35              11      DEC (HL)
001CD8 EA09 E1              10      POP HL
001CD9 EA0A 200C            12      JR  NZ,ERR      ;Retry
001CDB EA0C B7               4      OR  A
001CDC EA0D 2809            12      JR  Z,ERR       ;Error
                                
       EA0F                     DELP:
001CDE EA0F CD4AE9          17      CALL    RNF
001CE1 EA12 CD2CE9          17      CALL    FDMOFF
001CE4 EA15 3EFF             7      LD  A,0FFH
       EA17                     AERRZ:
001CE6 EA17 BF               4      CP  A
       EA18                     ERR:
001CE7 EA18 3EFF             7      LD  A,0FFH
001CE9 EA1A C9              10      RET
[EOF:M7DISK.ASM:SHIFT_JIS]
                                    INCLUDE "M7DISK2.ASM"
                                
                                ;   LSX-Dodgers DISK2
                                ;   MZ-700/1500
                                
                                ;   EMM DRIVER
                                ;   1セクタ可変(256/512/1024)
                                
       EA1B                     EDWT:
001CEA EA1B F5              11      PUSH    AF
001CEB EA1C CD3AEA          17      CALL    EADR
001CEE EA1F 0600             7      LD  B,0
       EA21                     EDWT1:
001CF0 EA21 EDB3                    OTIR
001CF2 EA23 3D               4      DEC A
001CF3 EA24 20FB            12      JR  NZ,EDWT1
001CF5 EA26 180B            12      JR  EDRW1
                                
       EA28                     EDRD:
001CF7 EA28 C5              11      PUSH    BC
001CF8 EA29 CD3AEA          17      CALL    EADR
001CFB EA2C 0600             7      LD  B,0
       EA2E                     EDRD1:
001CFD EA2E EDB2                    INIR
001CFF EA30 3D               4      DEC A
001D00 EA31 20FB            12      JR  NZ,EDRD1
       EA33                     EDRW1:
001D02 EA33 F1              10      POP AF
001D03 EA34 83               4      ADD A,E ;セクタを進める
001D04 EA35 5F               4      LD  E,A
001D05 EA36 8A               4      ADC A,D
001D06 EA37 93               4      SUB E
001D07 EA38 57               4      LD  D,A
001D08 EA39 C9              10      RET
                                
       EA3A                     EADR:
001D09 EA3A D5              11      PUSH    DE
001D0A EA3B EB               4      EX  DE,HL
001D0B EA3C 78               4      LD  A,B
001D0C EA3D DD460F          19      LD  B,(IX+DPB_BPS)
       EA40                     EADR1:              ;読み込むセクタ数と1クラスタのセクタ数を掛ける
001D0F EA40 CB18             8      RR  B
001D11 EA42 3804            12      JR  C,EADR2
001D13 EA44 87               4      ADD A,A
001D14 EA45 29              11      ADD HL,HL
001D15 EA46 18F8            12      JR  EADR1
       EA48                     EADR2:
001D17 EA48 DD4E0D          19      LD  C,(IX+DPB_MAXSEC)
001D1A EA4B DD460C          19      LD  B,(IX+DPB_MAXCYL)
001D1D EA4E 09              11      ADD HL,BC
001D1E EA4F DD4E13          19      LD  C,(IX+DPB_UNITNO)
001D21 EA52 ED71                    DB  0EDH,071H   ;OUT (C),0  Z80未定義命令
001D23 EA54 0C               4      INC C
001D24 EA55 ED69            12      OUT (C),L
001D26 EA57 0C               4      INC C
001D27 EA58 ED61            12      OUT (C),H
001D29 EA5A 0C               4      INC C
001D2A EA5B EB               4      EX  DE,HL
001D2B EA5C D1              10      POP DE
001D2C EA5D C9              10      RET
                                
                                ;   CMOS BACKUP MEMORY DRIVER(32KB)
                                ;   1セクタ256
                                
       EA5E                     CDWT:
001D2D EA5E 78               4      LD  A,B
001D2E EA5F DD4E13          19      LD  C,(IX+DPB_UNITNO)
001D31 EA62 ED40            12      IN  B,(C)       ;アドレスカウンタを0000にリセット
001D33 EA64 ED59            12      OUT (C),E       ;W)アドレスカウンタ上位
001D35 EA66 01FA00          10      LD  BC,000FAH
       EA69                     CDWT1:
001D38 EA69 EDB3                    OTIR            ;W)データ書き込み・アドレスカウンタ+1
001D3A EA6B 13               6      INC DE
001D3B EA6C 3D               4      DEC A
001D3C EA6D 20FA            12      JR  NZ,CDWT1
001D3E EA6F A7               4      AND A
001D3F EA70 C9              10      RET
                                
       EA71                     CDRD:
001D40 EA71 78               4      LD  A,B
001D41 EA72 DD4E13          19      LD  C,(IX+DPB_UNITNO)
001D44 EA75 ED40            12      IN  B,(C)       ;アドレスカウンタを0000にリセット
001D46 EA77 ED59            12      OUT (C),E       ;W)アドレスカウンタ上位
001D48 EA79 01F900          10      LD  BC,000F9H
       EA7C                     CDRD1:
001D4B EA7C EDB2                    INIR            ;R)データ読み出し・アドレスカウンタ+1
001D4D EA7E 13               6      INC DE
001D4E EA7F 3D               4      DEC A
001D4F EA80 20FA            12      JR  NZ,CDRD1
001D51 EA82 A7               4      AND A
001D52 EA83 C9              10      RET
                                
                                ;   RAM DISK DRIVER (64KB)
                                ;   1セクタ256
                                
       EA84                     RDWT:
001D53 EA84 3EB3             7      LD  A,0B3H      ;OTIR
001D55 EA86 1802            12      JR  RDRW
       EA88                     RDRD:
001D57 EA88 3EB2             7      LD  A,0B2H      ;INIR
       EA8A                     RDRW:
001D59 EA8A 3297EA          13      LD  (RDRW1+1),A
                                
001D5C EA8D 78               4      LD  A,B
001D5D EA8E 43               4      LD  B,E     ;B=アドレスカウンタ上位(X1の様な16bitのI/Oアクセス)
001D5E EA8F 0EEB             7      LD  C,0EBH
001D60 EA91 ED71            12      OUT (C),0       ;0=アドレスカウンタ下位
001D62 EA93 0D               4      DEC C       ;EA(R)データ読み出し・アドレスカウンタ+1
001D63 EA94 0600             7      LD  B,0
       EA96                     RDRW1:
001D65 EA96 EDB2                    INIR            ;自己書き換え(INIR/OTIR)
001D67 EA98 13               6      INC DE
001D68 EA99 3D               4      DEC A
001D69 EA9A 20FA            12      JR  NZ,RDRW1
001D6B EA9C A7               4      AND A
001D6C EA9D C9              10      RET
                                
                                ;   G-RAM(PCG) DISK DRIVER (24KB)
                                ;   1セクタ256
                                
       EA9E                     GDWT:
001D6D EA9E C5              11      PUSH    BC
001D6E EA9F D5              11      PUSH    DE
001D6F EAA0 CDC8EA          17      CALL    GADR
       EAA3                     GDWT2:
001D72 EAA3 4E               7      LD  C,(HL)
001D73 EAA4 23               6      INC HL
001D74 EAA5 EB               4      EX  DE,HL   ;HL=PCG,DE=メモリ
001D75 EAA6 CDD2CF          17      CALL    WR_PCG
001D78 EAA9 23               6      INC HL
001D79 EAAA EB               4      EX  DE,HL   ;HL=メモリ,DE=PCG
001D7A EAAB 10F6            13      DJNZ    GDWT2
001D7C EAAD D1              10      POP DE
001D7D EAAE 1C               4      INC E
001D7E EAAF C1              10      POP BC
001D7F EAB0 10EC            13      DJNZ    GDWT
001D81 EAB2 C9              10      RET
       EAB3                     GDRD:
001D82 EAB3 C5              11      PUSH    BC
001D83 EAB4 D5              11      PUSH    DE
001D84 EAB5 CDC8EA          17      CALL    GADR
       EAB8                     GDRD2:
001D87 EAB8 EB               4      EX  DE,HL   ;HL=PCG,DE=メモリ
001D88 EAB9 CDCACF          17      CALL    RD_PCG
001D8B EABC 23               6      INC HL
001D8C EABD EB               4      EX  DE,HL   ;HL=メモリ,DE=PCG
001D8D EABE 71               7      LD  (HL),C
001D8E EABF 23               6      INC HL
001D8F EAC0 10F6            13      DJNZ    GDRD2
001D91 EAC2 D1              10      POP DE
001D92 EAC3 1C               4      INC E
001D93 EAC4 C1              10      POP BC
001D94 EAC5 10EC            13      DJNZ    GDRD
001D96 EAC7 C9              10      RET
                                
       EAC8                     GADR:
001D97 EAC8 7B               4      LD  A,E
001D98 EAC9 E61F             7      AND 01FH
001D9A EACB C6D0             7      ADD A,0D0H
001D9C EACD 57               4      LD  D,A
001D9D EACE 7B               4      LD  A,E
001D9E EACF 07               4      RLCA
001D9F EAD0 07               4      RLCA
001DA0 EAD1 07               4      RLCA
001DA1 EAD2 3C               4      INC A
001DA2 EAD3 0600             7      LD  B,0
001DA4 EAD5 58               4      LD  E,B
001DA5 EAD6 C9              10      RET
[EOF:M7DISK2.ASM:UTF_8]
                                    INCLUDE "LDCCPWK.ASM"
                                
                                ;   LSX-Dodgers CCP WORK
                                
       003B                     PATHX   EQU 59
001DA6 EAD7                     PATHD:  DS  PATHX
001DE1 EB12 00                  PATHE:  DB  0
                                
       EB13                     DTA_CCP:
001DE2 EB13                         DS  37
                                
       EB38                     FCB_BAT:
001E07 EB38                         DS  37
                                
001E2C EB5D 2020203C4449523E    DIRMES: DB  "   <DIR>  $"
            202024              
001E37 EB68 20667265652024      FREE:   DB  " free $"
[EOF:LDCCPWK.ASM:UTF_8]
                                    INCLUDE "M7TABLE.ASM"
                                
                                ;   LSX-Dodgers TABLE 表示関連のテーブル
                                ;   MZ-700/1500
                                
       EB6F                     AT_TABLE:
001E3E EB6F                         DS  TABLEAD-AT_TABLE
                                
       ED40                     KEY_TABLE:
00200F ED40 12081E1F1C1D5C2F        DB  12H,08H,1EH,1FH,1CH,1DH,5CH,'/'
002017 ED48 5C5E2D2030392C2E        DB  5CH,'^','-',20H,'0','9',',','.'
00201F ED50 3132333435363738        DB  '1','2','3','4','5','6','7','8'
002027 ED58 6162636465666768        DB  'a','b','c','d','e','f','g','h'
00202F ED60 696A6B6C6D6E6F70        DB  'i','j','k','l','m','n','o','p'
002037 ED68 7172737475767778        DB  'q','r','s','t','u','v','w','x'
00203F ED70 797A405B5D000000        DB  'y','z','@','[',']',00H,00H,00H
002047 ED78 001B3D09003B3A0D        DB  00H,1BH,'=',09H,00H,';',':',0DH
       ED80                     SHIFT_TABLE:
00204F ED80 12081E1F1C1D5F3F        DB  12H,08H,1EH,1FH,1CH,1DH,'_','?'
002057 ED88 7C7E3D2030293C3E        DB  '|','~','=',20H,'0',')','<','>'
00205F ED90 2122232425262728        DB  '!','"','#','$','%','&',27H,'('
002067 ED98 4142434445464748        DB  'A','B','C','D','E','F','G','H'
00206F EDA0 494A4B4C4D4E4F50        DB  'I','J','K','L','M','N','O','P'
002077 EDA8 5152535455565758        DB  'Q','R','S','T','U','V','W','X'
00207F EDB0 595A607B7D000000        DB  'Y','Z','`','{','}',00H,00H,00H
002087 EDB8 00003D09002B2A0D        DB  00H,00H,'=',09H,00H,'+','*',0DH
       EDC0                     CTRL_TABLE:
00208F EDC0 12081E1F1C1D3F2F        DB  12H,08H,1EH,1FH,1CH,1DH,'?','/'
002097 EDC8 2A2B2D2030392C2E        DB  '*','+','-',20H,'0','9',',','.'
00209F EDD0 3132333435363738        DB  '1','2','3','4','5','6','7','8'
0020A7 EDD8 0102030405060708        DB  01H,02H,03H,04H,05H,06H,07H,08H
0020AF EDE0 090A0B0C0D0E0F10        DB  09H,0AH,0BH,0CH,0DH,0EH,0FH,10H
0020B7 EDE8 1112131415161718        DB  11H,12H,13H,14H,15H,16H,17H,18H
0020BF EDF0 191A1B5B5D000000        DB  19H,1AH,1BH,'[',']',00H,00H,00H
0020C7 EDF8 00003D09003B3A0D        DB  00H,00H,'=',09H,00H,';',':',0DH
                                
                                ;   アドレス下位1バイトが0になるように
       EE00                     CD_TABLE:
0020CF EE00 00D1D2D3D4D5D6D0        DB  $00,$D1,$D2,$D3,$D4,$D5,$D6,$D0 ;月火水木金土日
0020D7 EE08 D8DCD9DADBD7CFCE        DB  $D8,$DC,$D9,$DA,$DB,$D7,$CF,$CE ;年円時分秒
0020DF EE10 601F5F5E1E1B7978        DB  $60,$1F,$5F,$5E,$1E,$1B,$79,$78 ;
0020E7 EE18 5C5D1C1D6DCACDC7        DB  $5C,$5D,$1C,$1D,$6D,$CA,$CD,$C7 ;
0020EF EE20 0061626364656667        DB  $00,$61,$62,$63,$64,$65,$66,$67 ; !"#$%&'
0020F7 EE28 68696B6A2F2A2E2D        DB  $68,$69,$6B,$6A,$2F,$2A,$2E,$2D ;()*+,-./
0020FF EE30 2021222324252627        DB  $20,$21,$22,$23,$24,$25,$26,$27 ;01234567
002107 EE38 28294F2C512B5749        DB  $28,$29,$4F,$2C,$51,$2B,$57,$49 ;89:;<=>?
00210F EE40 5501020304050607        DB  $55,$01,$02,$03,$04,$05,$06,$07 ;@ABCDEFG
002117 EE48 08090A0B0C0D0E0F        DB  $08,$09,$0A,$0B,$0C,$0D,$0E,$0F ;HIJKLMNO
00211F EE50 1011121314151617        DB  $10,$11,$12,$13,$14,$15,$16,$17 ;PQRSTUVW
002127 EE58 18191A52DD54507C        DB  $18,$19,$1A,$52,$DD,$54,$50,$7C ;XYZ[\]^_
00212F EE60 5901020304050607        DB  $59,$01,$02,$03,$04,$05,$06,$07 ;`abcdefg   ATB:1
002137 EE68 08090A0B0C0D0E0F        DB  $08,$09,$0A,$0B,$0C,$0D,$0E,$0F ;hijklmno   ATB:1
00213F EE70 1011121314151617        DB  $10,$11,$12,$13,$14,$15,$16,$17 ;pqrstuvw   ATB:1
002147 EE78 18191ACB35CC705A        DB  $18,$19,$1A,$CB,$35,$CC,$70,$5A ;xyz{|}~    ATB:1
00214F EE80 415346444847B49E        DB  $41,$53,$46,$44,$48,$47,$B4,$9E ;トランプ〇●をぁ   ATB:1
002157 EE88 B2B6BABE9FB3B7BB        DB  $B2,$B6,$BA,$BE,$9F,$B3,$B7,$BB ;ぃぅぇぉゃゅょっ   ATB:1
00215F EE90 BFA385A4A5A69487        DB  $BF,$A3,$85,$A4,$A5,$A6,$94,$87 ;ーあいうえおかき   ATB:1
002167 EE98 889C829884929083        DB  $88,$9C,$82,$98,$84,$92,$90,$83 ;くけこさしすせそ   ATB:1
00216F EEA0 F0BD9DB1B5B9B49E        DB  $F0,$BD,$9D,$B1,$B5,$B9,$B4,$9E ;　。「」、・ヲァ
002177 EEA8 B2B6BABE9FB3B7BB        DB  $B2,$B6,$BA,$BE,$9F,$B3,$B7,$BB ;ィゥェォャョュッ
00217F EEB0 BFA385A4A5A69487        DB  $BF,$A3,$85,$A4,$A5,$A6,$94,$87 ;ーアイウエオカキ
002187 EEB8 889C829884929083        DB  $88,$9C,$82,$98,$84,$92,$90,$83 ;クケコサシスセソ
00218F EEC0 91819A97939589A1        DB  $91,$81,$9A,$97,$93,$95,$89,$A1 ;タチツテトナニヌ
002197 EEC8 AF8B8696A2ABAA8A        DB  $AF,$8B,$86,$96,$A2,$AB,$AA,$8A ;ネノハヒフヘホマ
00219F EED0 8EB0AD8DA7A8A98F        DB  $8E,$B0,$AD,$8D,$A7,$A8,$A9,$8F ;ミムメモヤユヨラ
0021A7 EED8 8CAEAC9BA099BCB8        DB  $8C,$AE,$AC,$9B,$A0,$99,$BC,$B8 ;リルレロワン゛゜
0021AF EEE0 91819A97939589A1        DB  $91,$81,$9A,$97,$93,$95,$89,$A1 ;たちつてとねにぬ   ATB:1
0021B7 EEE8 AF8B8696A2ABAA8A        DB  $AF,$8B,$86,$96,$A2,$AB,$AA,$8A ;ねのはひふへほま   ATB:1
0021BF EEF0 8EB0AD8DA7A8A98F        DB  $8E,$B0,$AD,$8D,$A7,$A8,$A9,$8F ;みむめもやゆよら   ATB:1
0021C7 EEF8 8CAEAC9BA099BCB8        DB  $8C,$AE,$AC,$9B,$A0,$99,$BC,$B8 ;りるれろわん゛゜   ATB:1
       EF00                     DC_TABLE:
0021CF EF00 2041424344454647        DB  $20,$41,$42,$43,$44,$45,$46,$47 ;0
0021D7 EF08 48494A4B4C4D4E4F        DB  $48,$49,$4A,$4B,$4C,$4D,$4E,$4F
0021DF EF10 5051525354555657        DB  $50,$51,$52,$53,$54,$55,$56,$57 ;1
0021E7 EF18 58595A151A1B1411        DB  $58,$59,$5A,$15,$1A,$1B,$14,$11
0021EF EF20 3031323334353637        DB  $30,$31,$32,$33,$34,$35,$36,$37 ;2
0021F7 EF28 38392D3D3B2F2E2C        DB  $38,$39,$2D,$3D,$3B,$2F,$2E,$2C
0021FF EF30 00000000007C0000        DB  $00,$00,$00,$00,$00,$7C,$00,$00 ;3
002207 EF38 0000000000000000        DB  $00,$00,$00,$00,$00,$00,$00,$00
00220F EF40 0080000083008285        DB  $00,$80,$00,$00,$83,$00,$82,$85 ;4
002217 EF48 843F00000000003A        DB  $84,$3F,$00,$00,$00,$00,$00,$3A
00221F EF50 5E3C5B815D40003E        DB  $5E,$3C,$5B,$81,$5D,$40,$00,$3E ;5
002227 EF58 00607F0018191312        DB  $00,$60,$7F,$00,$18,$19,$13,$12
00222F EF60 1021222324252627        DB  $10,$21,$22,$23,$24,$25,$26,$27 ;6
002237 EF68 28292B2A001C0000        DB  $28,$29,$2B,$2A,$00,$1C,$00,$00
00223F EF70 7E00000000000000        DB  $7E,$00,$00,$00,$00,$00,$00,$00 ;7
002247 EF78 171600005F000000        DB  $17,$16,$00,$00,$5F,$00,$00,$00
00224F EF80 00C19A9F9C92CA97        DB  $00,$C1,$9A,$9F,$9C,$92,$CA,$97 ;8
002257 EF88 98C6CFC9D8D3D0D7        DB  $98,$C6,$CF,$C9,$D8,$D3,$D0,$D7
00225F EF90 9EC09DC496C5CBC3        DB  $9E,$C0,$9D,$C4,$96,$C5,$CB,$C3 ;9
002267 EF98 9BDDC2DB99A2878C        DB  $9B,$DD,$C2,$DB,$99,$A2,$87,$8C
00226F EFA0 DCC7CC91939495D4        DB  $DC,$C7,$CC,$91,$93,$94,$95,$D4 ;A
002277 EFA8 D5D6CECDDAD2D9C8        DB  $D5,$D6,$CE,$CD,$DA,$D2,$D9,$C8
00227F EFB0 D1A3888D86A4898E        DB  $D1,$A3,$88,$8D,$86,$A4,$89,$8E ;B
002287 EFB8 DFA58A8FDEA18B90        DB  $DF,$A5,$8A,$8F,$DE,$A1,$8B,$90
00228F EFC0 000000000000001F        DB  $00,$00,$00,$00,$00,$00,$00,$1F ;C
002297 EFC8 00001D7B7D1E0F0E        DB  $00,$00,$1D,$7B,$7D,$1E,$0F,$0E
00229F EFD0 070102030405060D        DB  $07,$01,$02,$03,$04,$05,$06,$0D ;D
0022A7 EFD8 080A0B0C095C0000        DB  $08,$0A,$0B,$0C,$09,$5C,$00,$00
0022AF EFE0 0000000000000000        DB  $00,$00,$00,$00,$00,$00,$00,$00 ;E
0022B7 EFE8 0000000000000000        DB  $00,$00,$00,$00,$00,$00,$00,$00
0022BF EFF0 A000000000000000        DB  $A0,$00,$00,$00,$00,$00,$00,$00 ;F
0022C7 EFF8 0000000000000000        DB  $00,$00,$00,$00,$00,$00,$00,$00
[EOF:M7TABLE.ASM:SHIFT_JIS]
                                    INCLUDE "LDWORK.ASM"
                                
                                ;   LSX-Dodgers WORK0
                                ;
                                ;   CP/M互換BIOS
                                ;   BOOT:アドレス下位1バイトが0になるように
       F000                     AT_WORK:
0022CF F000                         DS  WORKAD-AT_WORK
                                
       F000                     CPM_BOOT:
0022CF F000 C30000          10      JP  0
       F003                     _SYS00:     ;(BDOS)プログラム終了
       F003                     CPM_WBOOT:
0022D2 F003 C3FECF          10      JP  WBOOT1
       F006                     CPM_CONST:
0022D5 F006 C3A5D7          10      JP  CONSTX
       F009                     _SYS07:     ;(BDOS)コンソール直接入力
       F009                     CPM_CONIN:
0022D8 F009 C337D7          10      JP  FLGET
       F00C                     CPM_CONOUT:
0022DB F00C C346D9          10      JP  CONOUT1
                                
       F00F                     DECBF:              ;10進数表示時のバッファ(5バイト)
0022DE F00F                         DS  5
       F00F                     RR_BUF_HL   EQU DECBF   ;CP/M互換ファイルアクセスの際のランダムレコードの一時的な保管場所
       F011                     RR_BUF_A    EQU DECBF+2 ;計3バイト
                                
0022E3 F014 00                  FDRV:   DB  0
0022E4 F015                     FNAME:  DS  36
002308 F039                     SFILE:  DS  33      ;DRV FILENAME
                                
002329 F05A                         DS  3
                                
00232C F05D 0000                LEFTX:  DW  0
00232E F05F 0000                DTAX:   DW  0
                                
       F061                     ZERO:
       F061                     BEEPD:
002330 F061 008E01000B000C10        DB  0,08EH,1,0,00BH,0,00CH,010H
002338 F069 073E08100D00FF          DB  007H,03EH,008H,010H,00DH,0,0FFH
       F062                     RTC_YY  EQU BEEPD+1
       F063                     RTC_MW  EQU BEEPD+2
       F064                     RTC_DD  EQU BEEPD+3
       F065                     RTC_TT  EQU BEEPD+4
       F066                     RTC_MM  EQU BEEPD+5
       F067                     RTC_SS  EQU BEEPD+6
       F062                     ROM_SLT EQU BEEPD+1
                                
00233F F070 00                  CHECK:  DB  0
                                
002340 F071 4F4B24              OK: DB  "OK$"
002343 F074                         DS  5
002348 F079 4572726F722124      COMERM: DB  "Error!$"
                                ;   システムワークエリア
                                ;   _CYL0:アドレス下位1バイトが080Hになるように
00234F F080 FF                  _CYL0:  DB  0FFH    ;Cylinder
002350 F081 FF                  _CYL1:  DB  0FFH    ;Cylinder
002351 F082 FF                  _CYL2:  DB  0FFH    ;Cylinder
002352 F083 FF                  _CYL3:  DB  0FFH    ;Cylinder
002353 F084 00                  _DRIVE: DB  0   ;unit number
002354 F085 00                  _SEEKSP:DB  0   ;Seek speed
002355 F086 FF                  _ISEEK: DB  0FFH    ;
002356 F087 00                  _DVSW:  DB  0
002357 F088 00                  _DRV:   DB  0
002358 F089 FF                  _DSK:   DB  0FFH
002359 F08A 8000                _DTA:   DW  00080H
00235B F08C 0000                _CTC:   DW  0
00235D F08E 0000                _TXADR: DW  0
00235F F090 0000                _KEYPS: DW  0
002361 F092 00FF                _KEYD:  DW  0FF00H  ;キーデータ
002363 F094 8310                _KEYSP: DB  KEYSP_L,KEYSP_H ;オートリピートの速度
002365 F096 70                  _COLORF:DB  COLORF  ;色
002366 F097 19                  _LINE:  DB  LINE
                                
002367 F098 0000                _FCB:   DW  0   ;SEARCH FILES
002369 F09A 0000                _FBPS:  DW  0   ;    //
00236B F09C 0000                _FBAD:  DW  0   ;    //
00236D F09E 00                  _FBCNT: DB  0   ;    //
00236E F09F 00                  _FILEN: DB  0   ;    //
00236F F0A0 00                  _DIRF:  DB  0   ;bit7:ディレクトリ bit0-6:セクタインデックス
002370 F0A1                         DS  1
002371 F0A2 00                  _WTFATF:DB  0   ;FATバッファの更新フラグ
002372 F0A3                         DS  1
002373 F0A4 00                  _WTDBF: DB  0   ;データバッファの更新フラグ
002374 F0A5 FF                  _DBDRV: DB  0FFH    ;データバッファにあるデータを読み込んだドライブ
002375 F0A6 0000                _DBSEC: DW  0   ;データバッファにあるデータを読み込んだセクタ番号
002377 F0A8 0000                _DPB:   DW  0
       F0AA                     _FATDRV:
002379 F0AA FF                      DB  0FFH    ;FATバッファに読み込んでいるドライブ
00237A F0AB 00                  _FATIX: DB  0   ;FATバッファに読み込んでいるインデックス
       F0AC                     _FAKEFREE:
00237B F0AC 0000                    DW  0   ;偽の残量（FATサイズが大きくなると重くなるのでその対策）
                                
00237D F0AE                         DS  2
                                
       F0B0                     CRTCD:
00237F F0B0 6F                      DB  06FH
       F0B1                     _WIDTH:
002380 F0B1 28                      DB  WIDTH
       F0B2                     TVRAMTOP:
002381 F0B2 5938                    DB  059H,038H
002383 F0B4 1F02                    DB  01FH,002H
       F0B6                     _LINE2:
002385 F0B6 19                      DB  019H
       F0B7                     WKE4:
002386 F0B7 1C                      DB  01CH
       F0B8                     WKE6:
002387 F0B8 00                      DB  000H
       F0B9                     WK40:
002388 F0B9 07                      DB  007H
       F0BA                     _PAGE_MINUS:
002389 F0BA 18FC                    DW  0-WIDTH*LINE
       F0BC                     _WIDTH_MINUS:
00238B F0BC D8FF                    DW  0-WIDTH
       F0BE                     WK30:
00238D F0BE 0C                      DB  00CH
       F0BF                     WK31:
       F0BF                     WK1FD0:
00238E F0BF 20                      DB  020H
                                
00238F F0C0 0000                CTC0:   DW  INTCTCE
002391 F0C2 0000                CTC1:   DW  INTCTCE
002393 F0C4 0000                CTC2:   DW  INTCTCE
002395 F0C6 0000                CTC3:   DW  INTCTCE
002397 F0C8 0000                INTVEC: DW  INT
                                
                                ;   LSX-Dodgers 独自BIOS
                                
002399 F0CA C38DDA          10  _INKEY: JP  INKEY
00239C F0CD C332D8          10  _PRINT: JP  PRINT
00239F F0D0 C301DB          10  _SCRN:  JP  SCRN
0023A2 F0D3 C3EFD9          10  _POS:   JP  POS
0023A5 F0D6 C314D9          10  _LOC:   JP  LOC
       F0D9                     _CHGDRV:
0023A8 F0D9 C3AEE7          10      JP  CHGDRV
       F0DC                     _GETDPB:
0023AB F0DC C36DE8          10      JP  GETDPB
       F0DF                     _FFLUSH:
0023AE F0DF C38BE8          10      JP  FFLUSH
       F0E2                     _RDFATX:
0023B1 F0E2 C387E4          10      JP  RDFATX
0023B4 F0E5 C3AFE5          10  _RDFAT: JP  RDFAT
0023B7 F0E8 C351E9          10  _WTTRK: JP  WTTRK
0023BA F0EB C3B1E9          10  _FDRD:  JP  FDRD
0023BD F0EE C357E9          10  _FDWT:  JP  FDWT
       F0F1                     _BPB2DPB:
0023C0 F0F1 C33CE6          10      JP  BPB2DPB
       F0F4                     _BREAK:
0023C3 F0F4 C391D1          10      JP  END_BATCH
       F0F7                     _GNCL:
0023C6 F0F7 C329E5          10      JP  GNCL        ; self-modifying code
       F0F8                     GNCPAT  EQU $-2
       F0FA                     _SNCL:
0023C9 F0FA C34CE5          10      JP  SNCL        ; self-modifying code
       F0FB                     SNCPAT  EQU $-2
0023CC F0FD C34AD0          10  _COMANL:JP  COMANL
                                
       F100                     _WE:
[EOF:LDWORK.ASM:SHIFT_JIS]
                                    INCLUDE "LDCALL.ASM"
                                
                                ;   LSX-Dodgers システムコール(BDOS)
                                ;
                                ;   LSX-Dodgers SYSTEM CALL
                                ;   STABLE:アドレス下位1バイトが0になるように
                                
       F100                     STABLE:
                                ;0
0023CF F100 03F00ED71AD7E2DC        DW  _SYS00,_SYS01,_SYS02,_SYS03
0023D7 F108 79D479D41FD709F0        DW  _SYS04,_SYS05,_SYS06,_SYS07
0023DF F110 27D77BD46DD799D7        DW  _SYS08,_SYS09,_SYS0A,_SYS0B
0023E7 F118 90D495D4A4D4B5D4        DW  _SYS0C,_SYS0D,_SYS0E,_SYS0F
                                ;1
0023EF F120 09D550D599D5CAD5        DW  _SYS10,_SYS11,_SYS12,_SYS13
0023F7 F128 D2D5E8D5FDD5F5D5        DW  _SYS14,_SYS15,_SYS16,_SYS17
0023FF F130 44D649D64ED654D6        DW  _SYS18,_SYS19,_SYS1A,_SYS1B
002407 F138 79D47AD679D47ED6        DW  _SYS1C,_SYS1D,_SYS1E,_SYS1F
                                ;2
00240F F140 79D434D63CD685D6        DW  _SYS20,_SYS21,_SYS22,_SYS23
002417 F148 ABD679D45BE133E2        DW  _SYS24,_ERROR,_SYS26,_SYS27
00241F F150 3CD6B4D6AFD7E2DC        DW  _SYS28,_SYS29,_SYS2A,_SYS2B
002427 F158 B5D7E2DC79D4D5D6        DW  _SYS2C,_SYS2D,_SYS2E,_SYS2F
                                ;3
00242F F160 CFD679D479D479D4        DW  _SYS30,_ERROR,_ERROR,_ERROR
002437 F168 79D479D479D479D4        DW  _ERROR,_ERROR,_ERROR,_ERROR
00243F F170 79D4E2DCE2DCF6D6        DW  _ERROR,_SYS39,_SYS3A,_SYS5A
                                ;DOS2
002447 F178 5CD4                    DW  _DOS2
                                
002449 F17A                         DS  2
00244B F17C 00F3                _FATBF: DW  FATBF
00244D F17E 00FB                _DTBUF: DW  DTBUF
                                
                                ;   コントロールコードテーブル
                                ;   CTRLTB:アドレス下位1バイトが080Hになるように
                                
       F180                     CTRLTB:
00244F F180 97D897D8CDD8C2D9        DW  CTRL00,CTRL00,CTRL02,CTRL03 ;  A,B,C
002457 F188 BCD9F9D8ADD956D9        DW  CTRL04,CTRL05,CTRL06,CTRL07 ;D,E,F,G
00245F F190 A3D8BED8C5D927D9        DW  CTRL08,CTRL09,CTRL0A,CTRL0B ;H,I,J,K
002467 F198 AAD90FD9D7D997D8        DW  CTRL0C,CTRL0D,CTRL0E,CTRL00 ;L,M,N,O
00246F F1A0 97D897D81FD997D8        DW  CTRL00,CTRL00,CTRL12,CTRL00 ;P,Q,R,S
002477 F1A8 97D897D897D897D8        DW  CTRL00,CTRL00,CTRL00,CTRL00 ;T,U,V,W
00247F F1B0 97D897D8AAD92ED9        DW  CTRL00,CTRL00,CTRL0C,CTRL1B ;X,Y,Z,ESC
002487 F1B8 86D8AAD8B3D8C5D9        DW  CTRL1C,CTRL1D,CTRL1E,CTRL1F ;→,←,↑,↓
                                
00248F F1C0 0200                M2D:    DW  2
002491 F1C2 FD02                    DB  0FDH,2
002493 F1C4 6401                    DW  356
002495 F1C6 FF0728090182            DB  0FFH,7,40,9,1,082H
00249B F1CC 0500A7000800            DW  5,0A7H,8
                                
0024A1 F1D2 0200                M2HD:   DW  2
0024A3 F1D4 FE01                    DB  0FEH,1
0024A5 F1D6 C704                    DW  1223
0024A7 F1D8 FE064D080184            DB  0FEH,6,77,8,1,084H
0024AD F1DE 0500A7000900            DW  5,0A7H,9
                                
0024B3 F1E4 1617                SDDATA: DB  22,23       ;(FCB)ファイルを最後に変更した時刻
0024B5 F1E6 1415                    DB  20,21       ;(FCB)ファイルを最後に変更した日付
0024B7 F1E8 1A1B                    DB  26,27       ;(FCB)ファイルの先頭クラスタ
0024B9 F1EA 10111213                DB  16,17,18,19 ;(FCB)ファイルのサイズ(バイト単位)
       F1EE                     SDDATAE:
                                
0024BD F1EE                         DS  2
       F1F0                     _FCB_BAT:
0024BF F1F0 38EB                    DW  FCB_BAT
       F1F2                     _PATH:
0024C1 F1F2 D7EA                    DW  PATHD
                                
0024C3 F1F4                     SCDIR:  DS  2       ;+14 +15
0024C5 F1F6                     SFBPS:  DS  2       ;FBPS
0024C7 F1F8                     SFNDF:  DS  2       ;FILEN DIRF
                                
0024C9 F1FA 0000                _FATPS: DW  0
0024CB F1FC 0000                _DIRPS: DW  0
0024CD F1FE 0000                _CLPS:  DW  0
                                
       F200                     _PE:
[EOF:LDCALL.ASM:SHIFT_JIS]
                                    INCLUDE "M7DPB.ASM"
                                
                                ;   LSX-Dodgers DPB
                                ;   MZ-700/1500
                                
       F200                     _DEVICE:
                                
                                ;   A:
                                
0024CF F200 0200                    DW  2   ;DPB_FATLN
0024D1 F202 EBF0                    DW  _FDRD   ;DPB_DRD
0024D3 F204 EEF0                    DW  _FDWT   ;DPB_DWT
0024D5 F206 FD                      DB  0FDH    ;DPB_FATID
0024D6 F207 02                      DB  2   ;DPB_SECPCL
0024D7 F208 6401                    DW  356 ;DPB_MAXCL
0024D9 F20A FF                      DB  0FFH    ;DPB_FDMODE 0FFH=2D / 0FEH=2HD
0024DA F20B 07                      DB  7   ;DPB_DIRSCNT
0024DB F20C 28                      DB  40  ;DPB_MAXCYL
0024DC F20D 09                      DB  9   ;DPB_MAXSEC Number of sectors
0024DD F20E 01                      DB  1   ;DPB_FATPS
0024DE F20F 82                      DB  082H    ;DPB_BPS
0024DF F210 0500                    DW  5   ;DPB_DIRPS
0024E1 F212 27                      DB  027H    ;DPB_DEVICE Device Number
0024E2 F213 00                      DB  0   ;DPB_UNITNO
0024E3 F214 0800                    DW  8   ;DPB_ADDCL
0024E5 F216 0000                    DW  0   ;DPB_16
0024E7 F218 0000                    DW  0   ;DPB_18
0024E9 F21A 0000                    DW  0   ;DPB_SDIR
0024EB F21C 46444430                DB  "FDD0"  ;DPB_NAME
                                
                                ;   B:
                                
0024EF F220 0200                    DW  2   ;DPB_FATLN
0024F1 F222 EBF0                    DW  _FDRD   ;DPB_DRD
0024F3 F224 EEF0                    DW  _FDWT   ;DPB_DWT
0024F5 F226 FD                      DB  0FDH    ;DPB_FATID
0024F6 F227 02                      DB  2   ;DPB_SECPCL
0024F7 F228 6401                    DW  356 ;DPB_MAXCL
0024F9 F22A FF                      DB  0FFH    ;DPB_FDMODE 0FFH=2D / 0FEH=2HD
0024FA F22B 07                      DB  7   ;DPB_DIRSCNT
0024FB F22C 28                      DB  40  ;DPB_MAXCYL
0024FC F22D 09                      DB  9   ;DPB_MAXSEC Number of sectors
0024FD F22E 01                      DB  1   ;DPB_FATPS
0024FE F22F 82                      DB  082H    ;DPB_BPS
0024FF F230 0500                    DW  5   ;DPB_DIRPS
002501 F232 27                      DB  027H    ;DPB_DEVICE Device Number
002502 F233 01                      DB  1   ;DPB_UNITNO
002503 F234 0800                    DW  8   ;DPB_ADDCL
002505 F236 0000                    DW  0   ;DPB_16
002507 F238 0000                    DW  0   ;DPB_18
002509 F23A 0000                    DW  0   ;DPB_SDIR
00250B F23C 46444431                DB  "FDD1"  ;DPB_NAME
                                
                                ;   C:
                                
00250F F240 0100                    DW  1   ;DPB_FATLN
002511 F242 71EA                    DW  CDRD    ;DPB_DRD
002513 F244 5EEA                    DW  CDWT    ;DPB_DWT
002515 F246 FA                      DB  0FAH    ;DPB_FATID
002516 F247 01                      DB  1   ;DPB_SECPCL
002517 F248 7A00                    DW  122 ;DPB_MAXCL
002519 F24A 00                      DB  0   ;DPB_FDMODE
00251A F24B 06                      DB  6   ;DPB_DIRSCNT
00251B F24C 00                      DB  0   ;DPB_MAXCYL
00251C F24D 00                      DB  0   ;DPB_MAXSEC
00251D F24E 01                      DB  1   ;DPB_FATPS
00251E F24F 01                      DB  1   ;DPB_BPS
00251F F250 0200                    DW  2   ;DPB_DIRPS
002521 F252 0C                      DB  00CH    ;DPB_DEVICE
002522 F253 F8                      DB  0F8H    ;DPB_UNITNO
002523 F254 0600                    DW  6   ;DPB_ADDCL
002525 F256 0000                    DW  0   ;DPB_16
002527 F258 0000                    DW  0   ;DPB_18
002529 F25A 0000                    DW  0   ;DPB_SDIR
00252B F25C 434D4F53                DB  "CMOS"  ;DPB_NAME
                                
                                ;   D:
                                
00252F F260                         DS  32
                                
                                ;   E:
                                
       F280                     EMMFL:
00254F F280 0000                    DW  0   ;DPB_FATLN
002551 F282 28EA                    DW  EDRD    ;DPB_DRD
002553 F284 1BEA                    DW  EDWT    ;DPB_DWT
002555 F286 FA                      DB  0FAH    ;DPB_FATID
002556 F287 02                      DB  2   ;DPB_SECPCL
002557 F288 0000                    DW  0   ;DPB_MAXCL
002559 F28A 00                      DB  0   ;DPB_FDMODE
00255A F28B 10                      DB  16  ;DPB_DIRSCNT
00255B F28C 00                      DB  0   ;DPB_MAXCYL
00255C F28D 00                      DB  0   ;DPB_MAXSEC
00255D F28E 01                      DB  1   ;DPB_FATPS
00255E F28F 01                      DB  1   ;DPB_BPS
00255F F290 0000                    DW  0   ;DPB_DIRPS
002561 F292 26                      DB  026H    ;DPB_DEVICE
002562 F293 00                      DB  0   ;DPB_UNITNO
002563 F294 0000                    DW  0   ;DPB_ADDCL
002565 F296 0000                    DW  0   ;DPB_16
002567 F298 0000                    DW  0   ;DPB_18
002569 F29A 0000                    DW  0   ;DPB_SDIR
00256B F29C 454D4D30                DB  "EMM0"  ;DPB_NAME
                                
                                ;   F:
                                
00256F F2A0 0200                    DW  2   ;DPB_FATLN
002571 F2A2 88EA                    DW  RDRD    ;DPB_DRD
002573 F2A4 84EA                    DW  RDWT    ;DPB_DWT
002575 F2A6 FA                      DB  0FAH    ;DPB_FATID
002576 F2A7 01                      DB  1   ;DPB_SECPCL
002577 F2A8 F600                    DW  246 ;DPB_MAXCL
002579 F2AA 00                      DB  0   ;DPB_FDMODE
00257A F2AB 09                      DB  9   ;DPB_DIRSCNT
00257B F2AC 00                      DB  0   ;DPB_MAXCYL
00257C F2AD 00                      DB  0   ;DPB_MAXSEC
00257D F2AE 01                      DB  1   ;DPB_FATPS
00257E F2AF 01                      DB  1   ;DPB_BPS
00257F F2B0 0300                    DW  3   ;DPB_DIRPS
002581 F2B2 0F                      DB  00FH    ;DPB_DEVICE
002582 F2B3 00                      DB  0   ;DPB_UNITNO
002583 F2B4 0A00                    DW  10  ;DPB_ADDCL
002585 F2B6 0000                    DW  0   ;DPB_16
002587 F2B8 0000                    DW  0   ;DPB_18
002589 F2BA 0000                    DW  0   ;DPB_SDIR
00258B F2BC 52414D46                DB  "RAMF"  ;DPB_NAME
                                
                                ;   G:
       F2C0                     GRAMFL:
00258F F2C0 0100                    DW  1   ;DPB_FATLN
002591 F2C2 B3EA                    DW  GDRD    ;DPB_DRD
002593 F2C4 9EEA                    DW  GDWT    ;DPB_DWT
002595 F2C6 FA                      DB  0FAH    ;DPB_FATID
002596 F2C7 01                      DB  1   ;DPB_SECPCL
002597 F2C8 5A00                    DW  90  ;DPB_MAXCL
002599 F2CA 00                      DB  0   ;DPB_FDMODE
00259A F2CB 06                      DB  6   ;DPB_DIRSCNT
00259B F2CC 00                      DB  0   ;DPB_MAXCYL
00259C F2CD 00                      DB  0   ;DPB_MAXSEC
00259D F2CE 01                      DB  1   ;DPB_FATPS
00259E F2CF 01                      DB  1   ;DPB_BPS
00259F F2D0 0200                    DW  2   ;DPB_DIRPS
0025A1 F2D2 05                      DB  005H    ;DPB_DEVICE
0025A2 F2D3 F8                      DB  0F8H    ;DPB_UNITNO
0025A3 F2D4 0600                    DW  6   ;DPB_ADDCL
0025A5 F2D6 0000                    DW  0   ;DPB_16
0025A7 F2D8 0000                    DW  0   ;DPB_18
0025A9 F2DA 0000                    DW  0   ;DPB_SDIR
0025AB F2DC 4752414D                DB  "GRAM"  ;DPB_NAME
                                
                                ;   H:
0025AF F2E0                         DS  3
0025B2 F2E3 00                      DB  0
[EOF:M7DPB.ASM:UTF_8]
                                
       A5B3                         ORG $$+OFFSET   ;$DEPHASE
       A5B3                     LAST_ADR:
                                
                                    END
[EOF:M7.ASM:UTF_8]
