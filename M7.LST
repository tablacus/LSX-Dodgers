                                ;*** AILZ80ASM *** Z-80 Assembler, version 1.0.0.0, LST:Full:4
                                ;   LSX-Dodgers for MZ-700/1500
                                ;   Programmed by
                                ;   Gaku (Lovers/Tablacus)
                                
                                    INCLUDE "M7DEF.ASM"
                                
                                ;   LSX-Dodgers DEF
                                ;   MZ-700/1500
                                
       0001                     MAC EQU 1   ;MZ-700/1500
       0000                     DEV EQU 0
                                
       8080                     RUN EQU 08080H
       8000                     OFFSET  EQU RUN-128
       CF06                     BDOS    EQU 0CF06H
       EC40                     TABLEAD EQU 0EC40H
       EF00                     WORKAD  EQU 0EF00H
       F200                     FATBF   EQU 0F200H
       FA00                     DTBUF   EQU 0FA00H
       FE00                     KEYBF   EQU 0FE00H
       FF00                     KBUF    EQU 0FF00H
       FFD9                     TRAP38  EQU 0FFD9H
       0028                     WIDTH   EQU 40
       0019                     LINE    EQU 25
       0071                     COLORF  EQU 071H
       000A                     COMS    EQU 10
[EOF:M7DEF.ASM:UTF_8]
                                    INCLUDE "LDDEF.ASM"
                                
                                ;   LSX-Dodgers DEF
                                
       0001                     VER_1   EQU 1
       0004                     VER_2   EQU 4
       0008                     VER_3   EQU 8
       1D01                     MACW    EQU MAC + 01D00H    ;機種フラグとLD判別フラグ
       0001                     MACD    EQU MAC + DEV * 256 ;機種フラグとデバイスフラグ
       0148                     VER EQU VER_1 * 256 + VER_2 * 16 + VER_3
                                
       0005                     SYSTEM  EQU 00005H
       000F                     JP_HL   EQU 0000FH
       005C                     FCB1    EQU 0005CH
       006C                     FCB2    EQU 0006CH
       005D                     FCB1FN  EQU FCB1+1
       006D                     FCB2FN  EQU FCB2+1
       0080                     DTA1    EQU 00080H
                                
       FFCA                     EXTBIO  EQU 0FFCAH
                                
[EOF:LDDEF.ASM:SHIFT_JIS]
                                
000000 8000                         ORG OFFSET
                                                    ;MZTヘッダ128バイト
000000 8000 01                      DB  1           ;ファイルモード
000001 8001 4C44202020202020        DB  "LD           "     ;ファイル名(13)
            2020202020          
00000E 800E 535953                  DB  "SYS"           ;拡張子(3)
000011 8011 0D                      DB  $0D
000012 8012 0024                    DW  LAST_ADR-RUN        ;サイズ
000014 8014 8080                    DW  RUN         ;開始アドレス
000016 8016 8080                    DW  RUN         ;実行アドレス
000018 8018                         DS  104
                                
                                    INCLUDE "M7INIT.ASM"
                                
                                ;   LSX-Dodgers INIT
                                ;   MZ-700/1500
                                
000080 8080 C38780          10      JP  START
000083 8083 011D                    DW  MACW
000085 8085 4801                    DW  VER
                                
       8087                     START:
000087 8087 F3               4      DI
000088 8088 ED56             8      IM  1
00008A 808A 318780          10      LD  SP,START
00008D 808D CD9B80          17      CALL    INIT        ;NZならAUTOEXECを実行
000090 8090 210000          10      LD  HL,0
000093 8093 E5              11      PUSH    HL
000094 8094 C8              11      RET Z
000095 8095 113D81          10      LD  DE,AUTOD
000098 8098 C3FDEF          10      JP  _COMANL
                                
       809B                     INIT:
00009B 809B D3E0            11      OUT (0E0H),A    ;DRAM(0000H-0FFHH)
00009D 809D D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
00009F 809F 21A281          10      LD  HL,INITE
0000A2 80A2 1106CF          10      LD  DE,BDOS
0000A5 80A5 01DE22          10      LD  BC,LAST_ADR-INITE
0000A8 80A8 EDB0                    LDIR
0000AA 80AA 217381          10      LD  HL,M7BEEPD
0000AD 80AD 1162EF          10      LD  DE,BEEPD+1
0000B0 80B0 010800          10      LD  BC,M7BEEPE-M7BEEPD
0000B3 80B3 EDB0                    LDIR
                                
0000B5 80B5 210000          10      LD  HL,0
0000B8 80B8 065C             7      LD  B,05CH
0000BA 80BA 3EEF             7      LD  A,0EFH      ;RST 28H
0000BC 80BC CD8EDD          17      CALL    FILL_MEMORY
0000BF 80BF 06A4             7      LD  B,0A4H
0000C1 80C1 AF               4      XOR A
0000C2 80C2 CD8EDD          17      CALL    FILL_MEMORY
                                
0000C5 80C5 3EC3             7      LD  A,0C3H      ;JP
0000C7 80C7 2103EF          10      LD  HL,CPM_WBOOT
0000CA 80CA 320000          13      LD  (00000H),A
0000CD 80CD 220100          16      LD  (00001H),HL ;IPL
                                
0000D0 80D0 21011D          10      LD  HL,MACW     ;3 bit7  DPB Compatible LA(1)
0000D3 80D3 220300          16      LD  (00003H),HL ;  bit6-0 Machine
                                ;               ;4 LSX-Dodgers(01DH)
0000D6 80D6 2106CF          10      LD  HL,BDOS
0000D9 80D9 320500          13      LD  (00005H),A
0000DC 80DC 220600          16      LD  (00006H),HL ;BDOS
                                
0000DF 80DF 21D9FF          10      LD  HL,TRAP38   ;TRAP38
0000E2 80E2 322800          13      LD  (00028H),A
0000E5 80E5 222900          16      LD  (00029H),HL ;RST 028H
                                
0000E8 80E8 3EC9             7      LD  A,0C9H      ;モード1割り込み
0000EA 80EA 323800          13      LD  (00038H),A
                                
0000ED 80ED 3EEF             7      LD  A,CPM_BOOT/256
0000EF 80EF 320B00          13      LD  (0000BH),A
                                
0000F2 80F2 3EE9             7      LD  A,0E9H      ;JP (HL)
0000F4 80F4 320F00          13      LD  (0000FH),A
                                
0000F7 80F7 3A7DF0          13      LD  A,(_FATBF+1)
0000FA 80FA 321300          13      LD  (00013H),A
                                
0000FD 80FD 3A7FF0          13      LD  A,(_DTBUF+1)
000100 8100 321700          13      LD  (00017H),A
                                
000103 8103 3EFE             7      LD  A,KEYBF/256
000105 8105 321B00          13      LD  (0001BH),A
                                
000108 8108 3EFF             7      LD  A,KBUF/256
00010A 810A 321F00          13      LD  (0001FH),A
                                
00010D 810D 214801          10      LD  HL,VER
000110 8110 225A00          16      LD  (0005AH),HL
                                
000113 8113 214981          10      LD  HL,INIMES
000116 8116 CDEAD5          17      CALL    MSX
       8119                     INIT1:
000119 8119 F3               4      DI
00011A 811A 1100FF          10      LD  DE,0FF00H
00011D 811D 0600             7      LD  B,0
00011F 811F CDB2D3          17      CALL    ZERO_MEMORY_DE
000122 8122 21CAFF          10      LD  HL,EXTBIO
000125 8125 060F             7      LD  B,TRAP38-EXTBIO
000127 8127 3EEF             7      LD  A,0EFH      ;RST 28H
000129 8129 CD8EDD          17      CALL    FILL_MEMORY
00012C 812C 217B81          10      LD  HL,AT_TRAP38
00012F 812F 11D9FF          10      LD  DE,TRAP38
000132 8132 012700          10      LD  BC,AT_TRAPE-AT_TRAP38
000135 8135 EDB0                    LDIR
                                
000137 8137 CD69DC          17      CALL    CHKEY
00013A 813A FE03             7      CP  3
00013C 813C C9              10      RET
                                
00013D 813D 4155544F45584543    AUTOD:  DB  "AUTOEXEC "
            20                  
000146 8146 413A00              AUTODV: DB  "A:",0
                                
000149 8149 0C4C53582D446F64    INIMES: DB  00CH,"LSX-Dodgers for MZ-700/1500 v"
            6765727320666F72    
            204D5A2D3730302F    
            313530302076        
000167 8167 312E                    DB  030H + VER_1, '.'
000169 8169 3438                    DB  030H + VER_2 ,030H + VER_3
                                ;   DB  "PR3"
00016B 816B 2047616B750D0A          DB  ' Gaku',0DH,0AH
000172 8172 00                      DB  0
                                
       8173                     M7BEEPD:
000173 8173 0801                    DB  8,1
000175 8175 0736                    DB  7,036H
000177 8177 04F9                    DB  4,0F9H
000179 8179 0403                    DB  4,3
       817B                     M7BEEPE:
                                
       817B                     AT_TRAP38:
00017B FFD9                         ORG TRAP38,AT_TRAP38-OFFSET
00017B FFD9 210000          10      LD  HL,0
00017E FFDC E3              19      EX  (SP),HL
00017F FFDD 3E24             7      LD  A,'$'
000181 FFDF CD9ED8          17      CALL    MSG_A
000184 FFE2 2B               6      DEC HL
000185 FFE3 7C               4      LD  A,H
000186 FFE4 CDE8FF          17      CALL    PRHX
000189 FFE7 7D               4      LD  A,L
       FFE8                     PRHX:
00018A FFE8 F5              11      PUSH    AF
00018B FFE9 07               4      RLCA
00018C FFEA 07               4      RLCA
00018D FFEB 07               4      RLCA
00018E FFEC 07               4      RLCA
00018F FFED CDF1FF          17      CALL    PRHX2
000192 FFF0 F1              10      POP AF
       FFF1                     PRHX2:
000193 FFF1 E60F             7      AND 00FH
000195 FFF3 FE0A             7      CP  10
000197 FFF5 3F               4      CCF
000198 FFF6 CE30             7      ADC A,'0'
00019A FFF8 27               4      DAA
00019B FFF9 C39ED8          10      JP  MSG_A
00019E FFFC                         DS  4
       81A2                         ORG $$+OFFSET   ;$DEPHASE
       81A2                     AT_TRAPE:
                                
       81A2                     INITE:
0001A2 CF06                         ORG BDOS,INITE-OFFSET
                                
0001A2 CF06 C309CF          10      JP  IO_BDOS
[EOF:M7INIT.ASM:SHIFT_JIS]
                                    INCLUDE "M7BANK.ASM"
                                
                                ;   LSX-Dodgers IO
                                ;   MZ-700/1500
                                ;   VRAM/KEY/TIMER(0D000H-0EFFFH)にアクセスするので0D000H-0FFFFHに置けない部分
                                ;
                                
       CF09                     IO_BDOS:
0001A5 CF09 D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
0001A7 CF0B C391D5          10      JP  BDOS0
                                
       CF0E                     RDKEYDATA:
0001AA CF0E D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
0001AC CF10 3200E0          13      LD  (0E000H),A
0001AF CF13 3A01E0          13      LD  A,(E001H)
0001B2 CF16 D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
0001B4 CF18 C9              10      RET
                                
       CF19                     RD556VSYNC:
0001B5 CF19 D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
0001B7 CF1B 3A02E0          13      LD  A,(0E002H)
0001BA CF1E D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
0001BC CF20 C9              10      RET
                                
       CF21                     RDMMIO:
0001BD CF21 D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
0001BF CF23 7E               7      LD  A,(HL)
0001C0 CF24 D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
0001C2 CF26 C9              10      RET
                                
       CF27                     WRMMIO:
0001C3 CF27 D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
0001C5 CF29 77               7      LD  (HL),A
0001C6 CF2A D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
0001C8 CF2C C9              10      RET
                                
       CF2D                     RDMMIO_BC:
0001C9 CF2D D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
0001CB CF2F 0A               7      LD  A,(BC)
0001CC CF30 D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
0001CE CF32 C9              10      RET
                                
       CF33                     WRMMIO_BC:
0001CF CF33 D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
0001D1 CF35 02               7      LD  (BC),A
0001D2 CF36 D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
0001D4 CF38 C9              10      RET
                                
       CF39                     IO_PRINT:
0001D5 CF39 D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
0001D7 CF3B 77               7      LD  (HL),A
0001D8 CF3C CBDC             8      SET 3,H
0001DA CF3E 71               7      LD  (HL),C
0001DB CF3F D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
0001DD CF41 C9              10      RET
                                
       CF42                     IO_CLR:
0001DE CF42 D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
       CF44                     C1AX1:
0001E0 CF44 7A               4      LD  A,D
0001E1 CF45 C6D0             7      ADD A,0D0H
0001E3 CF47 57               4      LD  D,A
0001E4 CF48 AF               4      XOR A
0001E5 CF49 12               7      LD  (DE),A      ;Text
0001E6 CF4A CBDA             8      SET 3,D
       CF4D                     ICSMC   EQU $+1
0001E8 CF4C 3E00             7      LD  A,0     ;自己書き換え
0001EA CF4E 12               7      LD  (DE),A      ;Color
0001EB CF4F 13               6      INC DE
0001EC CF50 7A               4      LD  A,D
0001ED CF51 D6D8             7      SUB 0D8H
0001EF CF53 57               4      LD  D,A
0001F0 CF54 2118FC          10      LD  HL,0-WIDTH*LINE
0001F3 CF57 19              11      ADD HL,DE
0001F4 CF58 30EA            12      JR  NC,C1AX1
0001F6 CF5A E1              10      POP HL
0001F7 CF5B D1              10      POP DE
0001F8 CF5C D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
0001FA CF5E C9              10      RET
                                
       CF5F                     IO_CLLINE:
0001FB CF5F D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
       CF61                     CLLINE1:
0001FD CF61 CB9C             8      RES 3,H
0001FF CF63 77               7      LD  (HL),A      ;Text
000200 CF64 CBDC             8      SET 3,H
000202 CF66 71               7      LD  (HL),C      ;Color
000203 CF67 23               6      INC HL
000204 CF68 10F7            13      DJNZ    CLLINE1
000206 CF6A D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
000208 CF6C C9              10      RET
                                
       CF6D                     IO_INS:
000209 CF6D D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
       CF6F                     IO_INS1:
00020B CF6F CD83CF          17      CALL    C12S
00020E CF72 23               6      INC HL
00020F CF73 10FA            13      DJNZ    IO_INS1
000211 CF75 D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
000213 CF77 C9              10      RET
                                
       CF78                     IO_BS:
000214 CF78 D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
       CF7A                     IO_BS1:
000216 CF7A CD83CF          17      CALL    C12S
000219 CF7D 2B               6      DEC HL
00021A CF7E 10F8            13      DJNZ    IO_BS
00021C CF80 D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
00021E CF82 C9              10      RET
                                
       CF83                     C12S:
00021F CF83 CB9C             8      RES 3,H
000221 CF85 5E               7      LD  E,(HL)
000222 CF86 77               7      LD  (HL),A
000223 CF87 7B               4      LD  A,E
000224 CF88 CBDC             8      SET 3,H
000226 CF8A 5E               7      LD  E,(HL)
000227 CF8B 71               7      LD  (HL),C
000228 CF8C 4B               4      LD  C,E
000229 CF8D C9              10      RET
                                
       CF8E                     IO_SCRUP:
00022A CF8E D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
       CF90                     SCRUP1:
00022C CF90 2815            12      JR  Z,SCRCL
00022E CF92 D5              11      PUSH    DE
00022F CF93 E5              11      PUSH    HL
000230 CF94 CBDA             8      SET 3,D
000232 CF96 CBDC             8      SET 3,H
000234 CF98 012800          10      LD  BC,WIDTH
000237 CF9B EDB0                    LDIR
000239 CF9D E1              10      POP HL
00023A CF9E D1              10      POP DE
00023B CF9F 012800          10      LD  BC,WIDTH
00023E CFA2 EDB0                    LDIR
000240 CFA4 3D               4      DEC A
000241 CFA5 18E9            12      JR  SCRUP1
                                
       CFA7                     SCRCL:
000243 CFA7 0628             7      LD  B,WIDTH
000245 CFA9 EB               4      EX  DE,HL
000246 CFAA D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
000248 CFAC CD9ADA          17      CALL    CLLINE
00024B CFAF E1              10      POP HL
00024C CFB0 D1              10      POP DE
00024D CFB1 C1              10      POP BC
00024E CFB2 C9              10      RET
                                
       CFB3                     C_MON:
00024F CFB3 D3E4            11      OUT (0E4H),A    ;MONITOR ROM(0000H-0FFFH) & VRAM/KEY/TIMER(D000H-FFFFH)
000251 CFB5 C7              12      RST 0
                                
       CFB6                     BANKE:
000252 CFB6                         DS  0CFFEH-BANKE        ;スタックエリア
       CFFE                     EXTSP:
[EOF:M7BANK.ASM:SHIFT_JIS]
                                    INCLUDE "M7CCP.ASM"
                                
                                ;   LSX-Dodgers CCP
                                ;   MZ-700/1500
                                
       CFFE                     WBOOT1:
00029A CFFE D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)　ここは0CFFEH
00029C D000 D3E0            11      OUT (0E0H),A    ;DRAM(0000H-0FFHH)
00029E D002 ED7B0600        20      LD  SP,(SYSTEM+1)
0002A2 D006 FB               4      EI
0002A3 D007 2192EF          10      LD  HL,_KEYD
0002A6 D00A 3600            10      LD  (HL),0
0002A8 D00C CD69DC          17      CALL    CHKEY
0002AB D00F CD8BD8          17      CALL    KEYBC_IFBREAK
0002AE D012 3E04             7      LD  A,4
0002B0 D014 CD9ED8          17      CALL    MSG_A
[EOF:M7CCP.ASM:UTF_8]
                                    INCLUDE "LDCCP.ASM"
                                
                                ;   LSX-Dodgers CCP
                                
       D017                     COMMAND:
0002B3 D017 CDCAD0          17      CALL    SETDTA1
0002B6 D01A 3A87EF          13      LD  A,(_DVSW)
0002B9 D01D C641             7      ADD A,'A'
0002BB D01F CD9ED8          17      CALL    MSG_A
0002BE D022 3E3E             7      LD  A,'>'
0002C0 D024 CD9ED8          17      CALL    MSG_A
0002C3 D027 3E50             7      LD  A,80
0002C5 D029 12               7      LD  (DE),A
0002C6 D02A CDFDD8          17      CALL    _SYS0A      ;(BDOS)文字列入力
0002C9 D02D CD74D2          17      CALL    LTNL
                                
0002CC D030 118200          10      LD  DE,DTA1+2
0002CF D033 CDFDEF          17      CALL    _COMANL
0002D2 D036 30DF            12      JR  NC,COMMAND
0002D4 D038 1179EF          10      LD  DE,COMERM
0002D7 D03B CDDBD5          17      CALL    _SYS09      ;(BDOS)文字列出力
0002DA D03E C7              12      RST 0
                                
       D03F                     COMANL:
0002DB D03F CDE2DC          17      CALL    FILE
0002DE D042 3A19EF          13      LD  A,(FNAME+4)
0002E1 D045 FE20             7      CP  020H
0002E3 D047 201C            12      JR  NZ,COMB2
0002E5 D049 D5              11      PUSH    DE
0002E6 D04A 1115EF          10      LD  DE,FNAME
0002E9 D04D 1A               7      LD  A,(DE)
0002EA D04E FE20             7      CP  020H
0002EC D050 2844            12      JR  Z,SDVSW
0002EE D052 1B               6      DEC DE
0002EF D053 1A               7      LD  A,(DE)
0002F0 D054 C6FF             7      ADD A,0FFH
0002F2 D056 3809            12      JR  C,COMB
0002F4 D058 13               6      INC DE
                                
0002F5 D059 2155D5          10      LD  HL,COMTB
0002F8 D05C 060A             7      LD  B,COMS
0002FA D05E CD66DF          17      CALL    CPNAME
       D061                     COMB:
0002FD D061 D1              10      POP DE
0002FE D062 D20F00          10      JP  NC,JP_HL
       D065                     COMB2:
000301 D065 EB               4      EX  DE,HL
000302 D066 223ED1          16      LD  (COMPAT+1),HL
000305 D069 F5              11      PUSH    AF
000306 D06A CDEAD0          17      CALL    CEXE4
000309 D06D F1              10      POP AF
00030A D06E 2115EF          10      LD  HL,FNAME
00030D D071 116D00          10      LD  DE,FCB2+1   ;COMMAND NAME
000310 D074 010B00          10      LD  BC,11
000313 D077 EDB0                    LDIR
000315 D079 11F8D4          10      LD  DE,PATHD
       D07C                     CEX1:
000318 D07C 1A               7      LD  A,(DE)
000319 D07D FE20             7      CP  020H
00031B D07F D8              11      RET C
00031C D080 CDD7DC          17      CALL    FILEC
00031F D083 D5              11      PUSH    DE
000320 D084 216D00          10      LD  HL,FCB2+1   ;COMMAND NAME
000323 D087 1115EF          10      LD  DE,FNAME
000326 D08A 010B00          10      LD  BC,11
000329 D08D EDB0                    LDIR
00032B D08F CDEAD0          17      CALL    CEXE4
00032E D092 D1              10      POP DE
00032F D093 13               6      INC DE
000330 D094 18E6            12      JR  CEX1
                                
       D096                     SDVSW:
000332 D096 F1              10      POP AF
000333 D097 3A14EF          13      LD  A,(FDRV)
000336 D09A 3D               4      DEC A
000337 D09B 5F               4      LD  E,A
000338 D09C 0E0E             7      LD  C,00EH      ;(BDOS)カレントドライブの設定
00033A D09E 1831            12      JR  SYSTEM0
                                
       D0A0                     OPEN1:
00033C D0A0 2114EF          10      LD  HL,FDRV
       D0A3                     OPEN:
00033F D0A3 0E11             7      LD  C,011H      ;(BDOS)ファイルの検索
       D0A5                     OPEN3:
000341 D0A5 D5              11      PUSH    DE
000342 D0A6 11D3D4          10      LD  DE,DTA_CCP
000345 D0A9 CDC7D0          17      CALL    SETDTA
000348 D0AC EB               4      EX  DE,HL
000349 D0AD CDD1D0          17      CALL    SYSTEM0
00034C D0B0 D1              10      POP DE
00034D D0B1 C9              10      RET
                                
       D0B2                     OPEN2:
00034E D0B2 0E12             7      LD  C,012H
000350 D0B4 18EF            12      JR  OPEN3
                                
       D0B6                     DEFCB:              ;Z=Ok NZ=Error
000352 D0B6 11D3D4          10      LD  DE,DTA_CCP
000355 D0B9 CDCFD0          17      CALL    SYSC0F
                                
000358 D0BC 11F4D4          10      LD  DE,DTA_CCP+33   ;(FCB)ランダムレコード
00035B D0BF 0604             7      LD  B,4
00035D D0C1 CDB2D3          17      CALL    ZERO_MEMORY_DE
000360 D0C4 110001          10      LD  DE,00100H
       D0C7                     SETDTA:
000363 D0C7 C3B5D7          10      JP  _SYS1A      ;(BDOS)DTAの設定
                                
       D0CA                     SETDTA1:
000366 D0CA 118000          10      LD  DE,DTA1
000369 D0CD 18F8            12      JR  SETDTA
                                
       D0CF                     SYSC0F:
00036B D0CF 0E0F             7      LD  C,00FH      ;(BDOS)ファイルのオープン
       D0D1                     SYSTEM0:
00036D D0D1 CD0500          17      CALL    SYSTEM
000370 D0D4 B7               4      OR  A
000371 D0D5 C9              10      RET
                                
       D0D6                     C_CD:
000372 D0D6 0E5A             7      LD  C,5AH
000374 D0D8 18F7            12      JR  SYSTEM0
                                
       D0DA                     S27BUF:
000376 D0DA 3A0700          13      LD  A,(SYSTEM+2)
000379 D0DD 3D               4      DEC A
00037A D0DE E6F8             7      AND 0F8H
00037C D0E0 67               4      LD  H,A
00037D D0E1 2E00             7      LD  L,0
       D0E3                     S27DTA:
00037F D0E3 11D3D4          10      LD  DE,DTA_CCP
       D0E6                     S27:
000382 D0E6 0E27             7      LD  C,027H      ;(BDOS)ランダムブロック読み込み
000384 D0E8 18E7            12      JR  SYSTEM0
                                
       D0EA                     CEXE4:
000386 D0EA 3A14EF          13      LD  A,(FDRV)
000389 D0ED 325700          13      LD  (00057H),A
00038C D0F0 2A22EF          16      LD  HL,(FDRV+14)
00038F D0F3 225800          16      LD  (00058H),HL
                                
000392 D0F6 211DEF          10      LD  HL,FNAME+8
000395 D0F9 7E               7      LD  A,(HL)
000396 D0FA FE20             7      CP  020H
000398 D0FC 2007            12      JR  NZ,CEXE7
00039A D0FE 3E3F             7      LD  A,'?'
00039C D100 77               7      LD  (HL),A
00039D D101 23               6      INC HL
00039E D102 77               7      LD  (HL),A
00039F D103 23               6      INC HL
0003A0 D104 77               7      LD  (HL),A
       D105                     CEXE7:
0003A1 D105 CDA0D0          17      CALL    OPEN1
       D108                     CEXE5:
0003A4 D108 C0              11      RET NZ
0003A5 D109 2ADDD4          16      LD  HL,(DTA_CCP+1+9)
0003A8 D10C 7C               4      LD  A,H
0003A9 D10D CDEEDF          17      CALL    CAP
0003AC D110 67               4      LD  H,A
0003AD D111 7D               4      LD  A,L
0003AE D112 CDEEDF          17      CALL    CAP
0003B1 D115 6F               4      LD  L,A
0003B2 D116 3ADCD4          13      LD  A,(DTA_CCP+1+8)
0003B5 D119 CDEEDF          17      CALL    CAP
0003B8 D11C D642             7      SUB 'B'
0003BA D11E 282C            12      JR  Z,C_BAT
0003BC D120 3D               4      DEC A       ;'C'
0003BD D121 2805            12      JR  Z,C_EXE
       D123                     CEXE6:
0003BF D123 CDB2D0          17      CALL    OPEN2
0003C2 D126 18E0            12      JR  CEXE5
                                
       D128                     C_EXE:
0003C4 D128 7C               4      LD  A,H
0003C5 D129 FE4D             7      CP  'M'
0003C7 D12B 20F6            12      JR  NZ,CEXE6
                                
0003C9 D12D CDB6D0          17      CALL    DEFCB
0003CC D130 CDDAD0          17      CALL    S27BUF
0003CF D133 3D               4      DEC A
0003D0 D134 37               4      SCF
0003D1 D135 C0              11      RET NZ
0003D2 D136 7C               4      LD  A,H
0003D3 D137 B5               4      OR  L
0003D4 D138 37               4      SCF
0003D5 D139 C8              11      RET Z
0003D6 D13A CDCAD0          17      CALL    SETDTA1
0003D9 D13D 110000          10  COMPAT: LD  DE,0                ; self-modifying code
0003DC D140 ED7B0600        20      LD  SP,(SYSTEM+1)
0003E0 D144 67               4      LD  H,A             ; A=0 in SETDTA1(_SYS1A)
0003E1 D145 6F               4      LD  L,A
0003E2 D146 E5              11      PUSH    HL              ; push $0000 (reboot address)
0003E3 D147 24               4      INC H
0003E4 D148 E5              11      PUSH    HL              ; push $0100 (TPA address)
0003E5 D149 C37DD3          10      JP  SETFCB              ; and JP $0100
                                
       D14C                     C_BAT:
0003E8 D14C 114154          10      LD  DE,'A'+'T'*256
0003EB D14F ED52            15      SBC HL,DE
0003ED D151 20D0            12      JR  NZ,CEXE6
                                
0003EF D153 F1              10      POP AF
0003F0 D154 F1              10      POP AF
0003F1 D155 CDB6D0          17      CALL    DEFCB
0003F4 D158 210002          10      LD  HL,00200H
0003F7 D15B CDE3D0          17      CALL    S27DTA
0003FA D15E C6FE             7      ADD A,0FEH
0003FC D160 D8              11      RET C
0003FD D161 7D               4      LD  A,L
0003FE D162 B7               4      OR  A
0003FF D163 37               4      SCF
000400 D164 C8              11      RET Z
000401 D165 3C               4      INC A
000402 D166 F5              11      PUSH    AF
                                
000403 D167 CD8ED8          17      CALL    KEYBC
000406 D16A 3E06             7      LD  A,6
000408 D16C CD9ED8          17      CALL    MSG_A
00040B D16F C1              10      POP BC
00040C D170 210001          10      LD  HL,00100H
       D173                     BAT1:
00040F D173 A7               4      AND A
000410 D174 05               4      DEC B
000411 D175 C8              11      RET Z
000412 D176 7E               7      LD  A,(HL)
000413 D177 FE25             7      CP  '%'
000415 D179 280C            12      JR  Z,BAT2
       D17B                     BAT1X:
000417 D17B 7E               7      LD  A,(HL)
000418 D17C 23               6      INC HL
000419 D17D FE1A             7      CP  01AH
00041B D17F C8              11      RET Z
00041C D180 FE0A             7      CP  00AH
00041E D182 C473D8          17      CALL    NZ,KEYBS
000421 D185 18EC            12      JR  BAT1
                                
       D187                     BAT2:
000423 D187 23               6      INC HL
000424 D188 7E               7      LD  A,(HL)
000425 D189 2B               6      DEC HL
000426 D18A D631             7      SUB '1'
000428 D18C 38ED            12      JR  C,BAT1X
00042A D18E FE09             7      CP  9
00042C D190 30E9            12      JR  NC,BAT1X
00042E D192 23               6      INC HL
00042F D193 23               6      INC HL
000430 D194 3C               4      INC A
000431 D195 4F               4      LD  C,A
000432 D196 ED5B3ED1        20      LD  DE,(COMPAT+1)
       D19A                     BAT3:
000436 D19A 1A               7      LD  A,(DE)
000437 D19B B7               4      OR  A
000438 D19C 28D5            12      JR  Z,BAT1
00043A D19E CDB9DD          17      CALL    SPCUT
00043D D1A1 0D               4      DEC C
00043E D1A2 2808            12      JR  Z,BAT5
       D1A4                     BAT4:
000440 D1A4 1A               7      LD  A,(DE)
000441 D1A5 FE21             7      CP  021H
000443 D1A7 38F1            12      JR  C,BAT3
000445 D1A9 13               6      INC DE
000446 D1AA 18F8            12      JR  BAT4
       D1AC                     BAT5:
000448 D1AC 1A               7      LD  A,(DE)
000449 D1AD FE21             7      CP  021H
00044B D1AF 38C2            12      JR  C,BAT1
00044D D1B1 13               6      INC DE
00044E D1B2 CD73D8          17      CALL    KEYBS
000451 D1B5 18F5            12      JR  BAT5
                                
       D1B7                     C_DEL:
000453 D1B7 CD7DD3          17      CALL    SETFCB
000456 D1BA CDB4D8          17      CALL    _SYS08      ;(BDOS)エコーなしコンソール入力
                                
000459 D1BD 0E13             7      LD  C,013H
00045B D1BF 180A            12      JR  CDEL1       ;(BDOS)ファイルの削除
                                
       D1C1                     C_REN:
00045D D1C1 CD7DD3          17      CALL    SETFCB
000460 D1C4 3E10             7      LD  A,010H      ;ディレクトリも対象にする
000462 D1C6 326900          13      LD  (FCB1+13),A ;属性
000465 D1C9 0E17             7      LD  C,017H      ;(BDOS)ファイル名の変更
       D1CB                     CDEL1:
000467 D1CB 115C00          10      LD  DE,FCB1
00046A D1CE CD0500          17      CALL    SYSTEM
00046D D1D1 C6FF             7      ADD A,0FFH
00046F D1D3 C9              10      RET
                                
       D1D4                     C_DIR:
000470 D1D4 CDD7DC          17      CALL    FILEC
000473 D1D7 2115EF          10      LD  HL,FDRV+1
000476 D1DA CDC8D4          17      CALL    CWILD1
000479 D1DD 3EF1             7      LD  A,0F1H
00047B D1DF 3221EF          13      LD  (FDRV+13),A
00047E D1E2 CDA0D0          17      CALL    OPEN1
       D1E5                     CDIR1:
000481 D1E5 B7               4      OR  A
000482 D1E6 2008            12      JR  NZ,PDSKF
000484 D1E8 CD33D2          17      CALL    P_NAME
000487 D1EB CDB2D0          17      CALL    OPEN2
00048A D1EE 18F5            12      JR  CDIR1
                                
       D1F0                     PDSKF:
00048C D1F0 3A14EF          13      LD  A,(FDRV)
00048F D1F3 5F               4      LD  E,A
000490 D1F4 0E1B             7      LD  C,01BH      ;(BDOS)ディスク情報の獲得
000492 D1F6 CD0500          17      CALL    SYSTEM
000495 D1F9 4F               4      LD  C,A     ;C←1クラスタ辺りの論理セクタ数
000496 D1FA C601             7      ADD A,001H
000498 D1FC D8              11      RET C       ;Aが0FFHだった場合
000499 D1FD 3E06             7      LD  A,8-2
       D1FF                     PDS1:               ;HL=未使用クラスタの総数
00049B D1FF 3C               4      INC A
00049C D200 CB19             8      RR  C
00049E D202 30FB            12      JR  NC,PDS1
       D204                     PDS2:               ;B←論理セクタのサイズの上位8ビット
0004A0 D204 3C               4      INC A
0004A1 D205 CB18             8      RR  B
0004A3 D207 30FB            12      JR  NC,PDS2
0004A5 D209 47               4      LD  B,A
                                
0004A6 D20A 110000          10      LD  DE,0
       D20D                     PDS3:
0004A9 D20D 29              11      ADD HL,HL
0004AA D20E EB               4      EX  DE,HL
0004AB D20F ED6A            15      ADC HL,HL
0004AD D211 EB               4      EX  DE,HL
0004AE D212 10F9            13      DJNZ    PDS3
       D214                     PDSKF1:
0004B0 D214 CDACD2          17      CALL    PRDEC_DEHL
0004B3 D217 1139D5          10      LD  DE,FREE
0004B6 D21A CDDBD5          17      CALL    _SYS09      ;(BDOS)文字列出力
0004B9 D21D CD9BD2          17      CALL    PUTDRV
0004BC D220 3E5C             7      LD  A,05CH      ;\
0004BE D222 CD9ED8          17      CALL    MSG_A
0004C1 D225 2A22EF          16      LD  HL,(FDRV+14)    ;ディレクトリのクラスタ番号
0004C4 D228 AF               4      XOR A
0004C5 D229 11FEFF          10      LD  DE,0-2
0004C8 D22C 19              11      ADD HL,DE
0004C9 D22D 23               6      INC HL
0004CA D22E DCA8D2          17      CALL    C,PRDEC_HL
0004CD D231 1841            12      JR  LTNL
                                
       D233                     P_NAME:
0004CF D233 3AD4D4          13      LD  A,(DTA_CCP+1)
0004D2 D236 FE2E             7      CP  '.'
0004D4 D238 C8              11      RET Z
0004D5 D239 1151D5          10      LD  DE,DIRHD
0004D8 D23C CDDBD5          17      CALL    _SYS09      ;(BDOS)文字列出力
0004DB D23F 3ADFD4          13      LD  A,(DTA_CCP+1+00BH)
0004DE D242 F5              11      PUSH    AF
0004DF D243 0F               4      RRCA
0004E0 D244 9F               4      SBC A,A
0004E1 D245 E60A             7      AND '*'-020H
0004E3 D247 C620             7      ADD A,020H
0004E5 D249 CD9ED8          17      CALL    MSG_A
0004E8 D24C CD9BD2          17      CALL    PUTDRV
0004EB D24F 21D4D4          10      LD  HL,DTA_CCP+1
0004EE D252 CDECD2          17      CALL    FPRNT
                                
0004F1 D255 F1              10      POP AF
0004F2 D256 CB67             8      BIT 4,A
0004F4 D258 2808            12      JR  Z,DIR3
0004F6 D25A 1146D5          10      LD  DE,DIRMES
0004F9 D25D CDDBD5          17      CALL    _SYS09      ;(BDOS)文字列出力
0004FC D260 180A            12      JR  DIR6
       D262                     DIR3:
0004FE D262 ED5BF2D4        20      LD  DE,(DTA_CCP+1+01EH)
000502 D266 2AF0D4          16      LD  HL,(DTA_CCP+1+01CH)
000505 D269 CDACD2          17      CALL    PRDEC_DEHL
       D26C                     DIR6:
000508 D26C 3AB1EF          13      LD  A,(_WIDTH)
00050B D26F FE29             7      CP  40+1
00050D D271 D40ED3          17      CALL    NC,PRTTMS
                                
       D274                     LTNL:
000510 D274 1E03             7      LD  E,3
000512 D276 C3CDEF          10      JP  _PRINT
                                
       D279                     C_PATH:
000515 D279 CDB9DD          17      CALL    SPCUT
000518 D27C 21F8D4          10      LD  HL,PATHD
00051B D27F FE21             7      CP  021H
00051D D281 300C            12      JR  NC,CPATH0
       D283                     CPATHP:
00051F D283 7E               7      LD  A,(HL)
000520 D284 23               6      INC HL
000521 D285 FE20             7      CP  020H
000523 D287 3F               4      CCF
000524 D288 30EA            12      JR  NC,LTNL
000526 D28A CD9ED8          17      CALL    MSG_A
000529 D28D 18F4            12      JR  CPATHP
       D28F                     CPATH0:
00052B D28F FE3B             7      CP  ';'
00052D D291 2001            12      JR  NZ,CPATH1
00052F D293 13               6      INC DE
       D294                     CPATH1:
000530 D294 EB               4      EX  DE,HL
000531 D295 014000          10      LD  BC,PATHX
000534 D298 EDB0                    LDIR
000536 D29A C9              10      RET
                                
       D29B                     PUTDRV:
000537 D29B 3A14EF          13      LD  A,(FDRV)
00053A D29E C640             7      ADD A,'A'-1
00053C D2A0 CD9ED8          17      CALL    MSG_A
00053F D2A3 3E3A             7      LD  A,':'
       D2A5                     MSG_AR:
000541 D2A5 C39ED8          10      JP  MSG_A
                                
       D2A8                     PRDEC_HL:
000544 D2A8 AF               4      XOR A
       D2A9                     PRDEC_AHL:
000545 D2A9 5F               4      LD  E,A
000546 D2AA 1600             7      LD  D,0
       D2AC                     PRDEC_DEHL:
000548 D2AC D5              11      PUSH    DE
000549 D2AD 110FEF          10      LD  DE,DECBF
00054C D2B0 0605             7      LD  B,5
00054E D2B2 CDB2D3          17      CALL    ZERO_MEMORY_DE  ;A=0
000551 D2B5 D1              10      POP DE
                                
000552 D2B6 0E20             7      LD  C,32
       D2B8                     DEC1:
000554 D2B8 29              11      ADD HL,HL
000555 D2B9 EB               4      EX  DE,HL
000556 D2BA ED6A            15      ADC HL,HL
000558 D2BC EB               4      EX  DE,HL
000559 D2BD E5              11      PUSH    HL
00055A D2BE 2113EF          10      LD  HL,DECBF+4
00055D D2C1 0605             7      LD  B,5
       D2C3                     DEC2:
00055F D2C3 7E               7      LD  A,(HL)
000560 D2C4 8F               4      ADC A,A
000561 D2C5 27               4      DAA
000562 D2C6 77               7      LD  (HL),A
000563 D2C7 2B               6      DEC HL
000564 D2C8 10F9            13      DJNZ    DEC2
000566 D2CA E1              10      POP HL
000567 D2CB 0D               4      DEC C
000568 D2CC 20EA            12      JR  NZ,DEC1
                                
00056A D2CE 210FEF          10      LD  HL,DECBF
00056D D2D1 3E20             7      LD  A,020H
00056F D2D3 0604             7      LD  B,4
       D2D5                     DEC3:
000571 D2D5 CDE2D2          17      CALL    DEC4
000574 D2D8 CDE2D2          17      CALL    DEC4
000577 D2DB 23               6      INC HL
000578 D2DC 10F7            13      DJNZ    DEC3
       D2DE                     DECX:
00057A D2DE CDE2D2          17      CALL    DEC4
00057D D2E1 AF               4      XOR A
       D2E2                     DEC4:
00057E D2E2 ED6F            18      RLD
000580 D2E4 FE20             7      CP  020H
000582 D2E6 2802            12      JR  Z,DEC5
000584 D2E8 F630             7      OR  030H
       D2EA                     DEC5:
000586 D2EA 18B9            12      JR  MSG_AR
                                
       D2EC                     FPRNT:
000588 D2EC 0608             7      LD  B,8
00058A D2EE CDFFD2          17      CALL    P_N1
00058D D2F1 7E               7      LD  A,(HL)
00058E D2F2 C680             7      ADD A,0A0H-020H
000590 D2F4 FEA0             7      CP  0A0H
000592 D2F6 2802            12      JR  Z,FPR1
000594 D2F8 3E2E             7      LD  A,'.'
       D2FA                     FPR1:
000596 D2FA CD9ED8          17      CALL    MSG_A
000599 D2FD 0603             7      LD  B,3
                                
       D2FF                     P_N1:
00059B D2FF C5              11      PUSH    BC
00059C D300 E5              11      PUSH    HL
00059D D301 7E               7      LD  A,(HL)
00059E D302 CDFADF          17      CALL    CAP3
0005A1 D305 CD9ED8          17      CALL    MSG_A
0005A4 D308 E1              10      POP HL
0005A5 D309 C1              10      POP BC
0005A6 D30A 23               6      INC HL
0005A7 D30B 10F2            13      DJNZ    P_N1
0005A9 D30D C9              10      RET
                                
       D30E                     PRTTMS:
0005AA D30E 3E20             7      LD  A,020H
0005AC D310 CD9ED8          17      CALL    MSG_A
                                
0005AF D313 2AECD4          16      LD  HL,(DTA_CCP+1+24)
0005B2 D316 7D               4      LD  A,L
0005B3 D317 B7               4      OR  A
0005B4 D318 C8              11      RET Z
0005B5 D319 CB3C             8      SRL H
0005B7 D31B 17               4      RLA
0005B8 D31C 17               4      RLA
0005B9 D31D 17               4      RLA
0005BA D31E 17               4      RLA
0005BB D31F E60F             7      AND 00FH
0005BD D321 57               4      LD  D,A
0005BE D322 7C               4      LD  A,H
0005BF D323 C650             7      ADD A,80
0005C1 D325 CD68D3          17      CALL    PRDEC_A
0005C4 D328 3E2D             7      LD  A,'-'
0005C6 D32A CD9ED8          17      CALL    MSG_A
0005C9 D32D 7A               4      LD  A,D
0005CA D32E CD68D3          17      CALL    PRDEC_A
0005CD D331 3E2D             7      LD  A,'-'
0005CF D333 CD9ED8          17      CALL    MSG_A
0005D2 D336 7D               4      LD  A,L
0005D3 D337 E61F             7      AND 01FH
0005D5 D339 CD68D3          17      CALL    PRDEC_A
                                
0005D8 D33C 2AEAD4          16      LD  HL,(DTA_CCP+1+22)
                                
0005DB D33F 3E20             7      LD  A,020H
0005DD D341 CD9ED8          17      CALL    MSG_A
0005E0 D344 7C               4      LD  A,H
0005E1 D345 65               4      LD  H,L
0005E2 D346 0603             7      LD  B,3
       D348                     PRTTMS1:
0005E4 D348 1F               4      RRA
0005E5 D349 CB1D             8      RR  L
0005E7 D34B 10FB            13      DJNZ    PRTTMS1
0005E9 D34D E61F             7      AND 01FH
0005EB D34F CD68D3          17      CALL    PRDEC_A
0005EE D352 3E3A             7      LD  A,':'
0005F0 D354 CD9ED8          17      CALL    MSG_A
0005F3 D357 7D               4      LD  A,L
0005F4 D358 0F               4      RRCA
0005F5 D359 0F               4      RRCA
0005F6 D35A E63F             7      AND 03FH
0005F8 D35C CD68D3          17      CALL    PRDEC_A
0005FB D35F 3E3A             7      LD  A,':'
0005FD D361 CD9ED8          17      CALL    MSG_A
000600 D364 7C               4      LD  A,H
000601 D365 E61F             7      AND 01FH
000603 D367 87               4      ADD A,A
                                
                                ;   PRINT10
                                
       D368                     PRDEC_A:
000604 D368 E5              11      PUSH    HL
000605 D369 0608             7      LD  B,8
000607 D36B 4F               4      LD  C,A
000608 D36C AF               4      XOR A
       D36D                     PRTA1:
000609 D36D CB01             4      RLC C
00060B D36F 8F               4      ADC A,A
00060C D370 27               4      DAA
00060D D371 10FA            13      DJNZ    PRTA1
00060F D373 210FEF          10      LD  HL,DECBF
000612 D376 77               7      LD  (HL),A
000613 D377 AF               4      XOR A
000614 D378 CDDED2          17      CALL    DECX
000617 D37B E1              10      POP HL
000618 D37C C9              10      RET
                                
       D37D                     SETFCB:
000619 D37D CDB9DD          17      CALL    SPCUT
00061C D380 1A               7      LD  A,(DE)
00061D D381 FE20             7      CP  020H
00061F D383 3801            12      JR  C,SETFCBA
000621 D385 1B               6      DEC DE
       D386                     SETFCBA:
000622 D386 0624             7      LD  B,36
000624 D388 215C00          10      LD  HL,FCB1
000627 D38B E5              11      PUSH    HL
000628 D38C AF               4      XOR A
000629 D38D CD8EDD          17      CALL    FILL_MEMORY
00062C D390 E1              10      POP HL
00062D D391 D5              11      PUSH    DE
00062E D392 CD1BD8          17      CALL    _SYS5C      ;(BDOS)ファイル名の解析
000631 D395 216C00          10      LD  HL,FCB2
000634 D398 CD1BD8          17      CALL    _SYS5C      ;(BDOS)ファイル名の解析
000637 D39B E1              10      POP HL
000638 D39C 010050          10      LD  BC,05000H
00063B D39F 118100          10      LD  DE,00081H
       D3A2                     SETFCB1:
00063E D3A2 7E               7      LD  A,(HL)
00063F D3A3 23               6      INC HL
000640 D3A4 FE20             7      CP  020H
000642 D3A6 3805            12      JR  C,SETFCB2
000644 D3A8 12               7      LD  (DE),A
000645 D3A9 13               6      INC DE
000646 D3AA 0C               4      INC C
000647 D3AB 10F5            13      DJNZ    SETFCB1
       D3AD                     SETFCB2:
000649 D3AD 79               4      LD  A,C
00064A D3AE 328000          13      LD  (DTA1),A
00064D D3B1 04               4      INC B
       D3B2                     ZERO_MEMORY_DE:
00064E D3B2 AF               4      XOR A
       D3B3                     FILL_MEMORY_DE:
00064F D3B3 12               7      LD  (DE),A
000650 D3B4 13               6      INC DE
000651 D3B5 10FC            13      DJNZ    FILL_MEMORY_DE
000653 D3B7 C9              10      RET
                                
       D3B8                     C_COPY:
000654 D3B8 CD7DD3          17      CALL    SETFCB
                                
000657 D3BB 1161EF          10      LD  DE,ZERO
00065A D3BE CDDADC          17      CALL    FILEC2
00065D D3C1 216C00          10      LD  HL,FCB2
000660 D3C4 CD22D8          17      CALL    S29X1
                                
000663 D3C7 3E10             7      LD  A,010H
000665 D3C9 326900          13      LD  (FCB1+13),A
000668 D3CC 216D00          10      LD  HL,FCB2+1
00066B D3CF CDC8D4          17      CALL    CWILD1
       D3D2                     COPY0:
00066E D3D2 CDC5D4          17      CALL    CWILD
000671 D3D5 215C00          10      LD  HL,FCB1
000674 D3D8 CDA3D0          17      CALL    OPEN
000677 D3DB 37               4      SCF
       D3DC                     COPY1:
000678 D3DC C0              11      RET NZ
000679 D3DD CDB6D0          17      CALL    DEFCB
                                
00067C D3E0 3AE0D4          13      LD  A,(DTA_CCP+13)
00067F D3E3 CB67             8      BIT 4,A
000681 D3E5 2821            12      JR  Z,COPY1A
                                
000683 D3E7 215D00          10      LD  HL,FCB1+1
000686 D3EA CD1DE1          17      CALL    CHKWILD
000689 D3ED 3814            12      JR  C,COPY9
                                
00068B D3EF 3E20             7      LD  A,020H
00068D D3F1 325D00          13      LD  (FCB1+1),A
000690 D3F4 2AEDD4          16      LD  HL,(DTA_CCP+26)
000693 D3F7 23               6      INC HL
000694 D3F8 226A00          16      LD  (FCB1+14),HL
000697 D3FB 18D5            12      JR  COPY0
                                
       D3FD                     COPY8:
000699 D3FD CDDBD5          17      CALL    _SYS09      ;(BDOS)文字列出力
00069C D400 CD74D2          17      CALL    LTNL
       D403                     COPY9:
00069F D403 CDB2D0          17      CALL    OPEN2
0006A2 D406 18D4            12      JR  COPY1
                                
       D408                     COPY1A:
0006A4 D408 216C00          10      LD  HL,FCB2
0006A7 D40B 1114EF          10      LD  DE,FDRV
0006AA D40E 01D5D4          10      LD  BC,DTA_CCP+2
0006AD D411 EDA0            16      LDI
0006AF D413 3E0B             7      LD  A,11
       D415                     COPY2:
0006B1 D415 F5              11      PUSH    AF
0006B2 D416 7E               7      LD  A,(HL)
0006B3 D417 FE3F             7      CP  '?'
0006B5 D419 2001            12      JR  NZ,COPY3
0006B7 D41B 0A               7      LD  A,(BC)
       D41C                     COPY3:
0006B8 D41C 12               7      LD  (DE),A
0006B9 D41D 03               6      INC BC
0006BA D41E 13               6      INC DE
0006BB D41F 23               6      INC HL
0006BC D420 F1              10      POP AF
0006BD D421 3D               4      DEC A
0006BE D422 20F1            12      JR  NZ,COPY2
0006C0 D424 010500          10      LD  BC,16-11
0006C3 D427 EDB0                    LDIR
       D429                     PUTNAME:
0006C5 D429 215D00          10      LD  HL,FCB1+1
0006C8 D42C CD1DE1          17      CALL    CHKWILD
0006CB D42F 300B            12      JR  NC,PUTN1
0006CD D431 2115EF          10      LD  HL,FDRV+1
0006D0 D434 CDECD2          17      CALL    FPRNT
0006D3 D437 3E20             7      LD  A,020H
0006D5 D439 CD9ED8          17      CALL    MSG_A
       D43C                     PUTN1:
0006D8 D43C 1114EF          10      LD  DE,FDRV
0006DB D43F 0E16             7      LD  C,016H      ;(BDOS)ファイルの作成
0006DD D441 CDD1D0          17      CALL    SYSTEM0
0006E0 D444 2048            12      JR  NZ,COPYE2
0006E2 D446 67               4      LD  H,A     ;A=0
0006E3 D447 6F               4      LD  L,A
0006E4 D448 2235EF          16      LD  (FDRV+33),HL    ;(FCB)ランダムレコード
0006E7 D44B 2237EF          16      LD  (FDRV+35),HL
       D44E                     COPY6:
0006EA D44E CDDAD0          17      CALL    S27BUF
0006ED D451 47               4      LD  B,A
0006EE D452 3C               4      INC A
0006EF D453 2831            12      JR  Z,COPYE
0006F1 D455 7C               4      LD  A,H
0006F2 D456 B5               4      OR  L
0006F3 D457 280C            12      JR  Z,COPY7
0006F5 D459 1114EF          10      LD  DE,FDRV
0006F8 D45C 0E26             7      LD  C,026H      ;(BDOS)ランダムブロック書き込み
0006FA D45E CDD1D0          17      CALL    SYSTEM0
0006FD D461 2023            12      JR  NZ,COPYE
0006FF D463 10E9            13      DJNZ    COPY6
       D465                     COPY7:
000701 D465 3AE0D4          13      LD  A,(DTA_CCP+13)  ;(FCB)属性
000704 D468 3221EF          13      LD  (FDRV+13),A
000707 D46B 21E7D4          10      LD  HL,DTA_CCP+20   ;(FCB)タイムスタンプ
00070A D46E 1128EF          10      LD  DE,FDRV+20
00070D D471 010400          10      LD  BC,4
000710 D474 EDB0                    LDIR
                                
000712 D476 1114EF          10      LD  DE,FDRV
000715 D479 0E10             7      LD  C,010H      ;(BDOS)ファイルのクローズ
000717 D47B CDD1D0          17      CALL    SYSTEM0
00071A D47E 2006            12      JR  NZ,COPYE
                                
00071C D480 1171EF          10      LD  DE,OK
00071F D483 C3FDD3          10      JP  COPY8
                                
       D486                     COPYE:
000722 D486 1114EF          10      LD  DE,FDRV
000725 D489 0E13             7      LD  C,013H      ;(BDOS)ファイルの削除
000727 D48B CD0500          17      CALL    SYSTEM
       D48E                     COPYE2:
00072A D48E 37               4      SCF
00072B D48F C9              10      RET
                                
       D490                     C_TYPE:
00072C D490 CD7DD3          17      CALL    SETFCB
00072F D493 215C00          10      LD  HL,FCB1
000732 D496 CDA3D0          17      CALL    OPEN
000735 D499 37               4      SCF
       D49A                     TYPE1:
000736 D49A C0              11      RET NZ
000737 D49B CDB6D0          17      CALL    DEFCB
00073A D49E 3E06             7      LD  A,6
00073C D4A0 CD9ED8          17      CALL    MSG_A
       D4A3                     TYPE2:
00073F D4A3 CDDAD0          17      CALL    S27BUF
000742 D4A6 C6FE             7      ADD A,0FEH
000744 D4A8 D8              11      RET C
000745 D4A9 7C               4      LD  A,H
000746 D4AA B5               4      OR  L
000747 D4AB 2813            12      JR  Z,TYPEE
000749 D4AD 010001          10      LD  BC,00100H
       D4B0                     TYPE3:
00074C D4B0 0A               7      LD  A,(BC)
00074D D4B1 03               6      INC BC
00074E D4B2 FE1A             7      CP  01AH
000750 D4B4 280A            12      JR  Z,TYPEE
000752 D4B6 CD9ED8          17      CALL    MSG_A
000755 D4B9 2B               6      DEC HL
000756 D4BA 7C               4      LD  A,H
000757 D4BB B5               4      OR  L
000758 D4BC 20F2            12      JR  NZ,TYPE3
00075A D4BE 18E3            12      JR  TYPE2
       D4C0                     TYPEE:
00075C D4C0 CDB2D0          17      CALL    OPEN2
00075F D4C3 18D5            12      JR  TYPE1
                                
       D4C5                     CWILD:
000761 D4C5 215D00          10      LD  HL,FCB1+1
       D4C8                     CWILD1:
000764 D4C8 7E               7      LD  A,(HL)
000765 D4C9 FE20             7      CP  020H
000767 D4CB C0              11      RET NZ
       D4CC                     CWILD2:
000768 D4CC 3E3F             7      LD  A,'?'
00076A D4CE 060B             7      LD  B,11
00076C D4D0 C38EDD          10      JP  FILL_MEMORY
                                
       D4D3                     DTA_CCP:
00076F D4D3                         DS  37
                                
       0040                     PATHX   EQU 64
000794 D4F8                     PATHD:  DS  PATHX
0007D4 D538 00                  PATHE:  DB  0
                                
0007D5 D539 2062797465732066    FREE:   DB  " bytes free",9,'$'
            7265650924          
0007E2 D546 20202020203C4449    DIRMES: DB  "     <DIR>$"
            523E24              
0007ED D551 20203A24            DIRHD:  DB  "  :$"
                                
       D555                     COMTB:
0007F1 D555 44202020                DB  "D   "  ;1
0007F5 D559 D4D1                    DW  C_DIR
0007F7 D55B 44495220                DB  "DIR "  ;2
0007FB D55F D4D1                    DW  C_DIR
0007FD D561 434F5059                DB  "COPY"  ;3
000801 D565 B8D3                    DW  C_COPY
000803 D567 43442020                DB  "CD  "  ;4
000807 D56B D6D0                    DW  C_CD
000809 D56D 44454C20                DB  "DEL "  ;5
00080D D571 B7D1                    DW  C_DEL
00080F D573 50415448                DB  "PATH"  ;6
000813 D577 79D2                    DW  C_PATH
000815 D579 52454E20                DB  "REN "  ;7
000819 D57D C1D1                    DW  C_REN
00081B D57F 54595045                DB  "TYPE"  ;8
00081F D583 90D4                    DW  C_TYPE
000821 D585 52454D20                DB  "REM "  ;9
000825 D589 D8D5                    DW  C_REM
[EOF:LDCCP.ASM:SHIFT_JIS]
                                    INCLUDE "M7CCP2.ASM"
                                
                                ;   LSX-Dodgers CCP2
                                ;   MZ-700/1500
                                
000827 D58B 4D4F4E20                DB  "MON "  ;10
00082B D58F B3CF                    DW  C_MON
[EOF:M7CCP2.ASM:UTF_8]
                                    INCLUDE "LDOS.ASM"
                                
                                ;   LSX-Dodgers OS
                                
       D591                     BDOS0:
00082D D591 ED73A5D5        20      LD  (BDSP+1),SP
000831 D595 F5              11      PUSH    AF
000832 D596 3AA6D5          13      LD  A,(BDSP+2)
000835 D599 FECF             7      CP  EXTSP/256
000837 D59B 280B            12      JR  Z,BDOS1X
       D59D                     BDOS2:
000839 D59D F1              10      POP AF
00083A D59E 31FECF          10      LD  SP,EXTSP
00083D D5A1 CDA9D5          17      CALL    BDOS1
000840 D5A4 310000          10  BDSP:   LD  SP,0
000843 D5A7 C9              10      RET
       D5A8                     BDOS1X:
000844 D5A8 F1              10      POP AF
       D5A9                     BDOS1:
000845 D5A9 E5              11      PUSH    HL
000846 D5AA 79               4      LD  A,C
000847 D5AB FE3C             7      CP  03CH
000849 D5AD 3802            12      JR  C,DOS1
00084B D5AF 3E3C             7      LD  A,03CH
       D5B1                     DOS1:
00084D D5B1 87               4      ADD A,A
00084E D5B2 6F               4      LD  L,A
00084F D5B3 26F0             7      LD  H,STABLE/256
000851 D5B5 7E               7      LD  A,(HL)
000852 D5B6 2C               4      INC L
000853 D5B7 66               7      LD  H,(HL)
000854 D5B8 6F               4      LD  L,A
000855 D5B9 E3              19      EX  (SP),HL
000856 D5BA 79               4      LD  A,C
000857 D5BB C9              10      RET
       D5BC                     _DOS2:
000858 D5BC FE5A             7      CP  05AH        ;(BDOS)カレントディレクトリの変更(_CHDIR)
00085A D5BE CA5FD8          10      JP  Z,_SYS5A
00085D D5C1 FE5C             7      CP  05CH        ;(BDOS)ファイル名の解析(_PFILE)
00085F D5C3 CA1BD8          10      JP  Z,_SYS5C
000862 D5C6 FE5F             7      CP  05FH        ;(BDOS)ディスクバッファのフラッシュ(_FLUSH)
000864 D5C8 CA24EA          10      JP  Z,_SYS5F
000867 D5CB FE6F             7      CP  06FH        ;(BDOS)MSX-DOS のバージョン番号の獲得(_DOSVER)
000869 D5CD 200A            12      JR  NZ,_ERROR
00086B D5CF 011D01          10      LD  BC,011DH
00086E D5D2 114801          10      LD  DE,VER
000871 D5D5 210100          10      LD  HL,MACD
       D5D8                     C_REM:
000874 D5D8 AF               4      XOR A
       D5D9                     _ERROR:
000875 D5D9 A7               4      AND A
000876 D5DA C9              10      RET
                                
       D5DB                     _SYS09:     ;文字列出力
000877 D5DB D5              11      PUSH    DE
       D5DC                     _SX09:
000878 D5DC 1A               7      LD  A,(DE)
000879 D5DD 13               6      INC DE
00087A D5DE FE24             7      CP  '$'
00087C D5E0 2831            12      JR  Z,SX0E2
00087E D5E2 CD9ED8          17      CALL    MSG_A
000881 D5E5 18F5            12      JR  _SX09
                                
       D5E7                     MSX1:
000883 D5E7 CD9ED8          17      CALL    MSG_A
       D5EA                     MSX:
000886 D5EA 7E               7      LD  A,(HL)
000887 D5EB 23               6      INC HL
000888 D5EC B7               4      OR  A
000889 D5ED 20F8            12      JR  NZ,MSX1
00088B D5EF C9              10      RET
                                
       D5F0                     _SYS0C:     ;(BDOS)バージョン番号の獲得
00088C D5F0 212200          10      LD  HL,00022H
00088F D5F3 7D               4      LD  A,L
000890 D5F4 C9              10      RET
                                
       D5F5                     _SYS0D:     ;(BDOS)ディスクリセット
000891 D5F5 CDDFEF          17      CALL    _FFLUSH
000894 D5F8 E5              11      PUSH    HL
000895 D5F9 218000          10      LD  HL,00080H
000898 D5FC 228AEF          16      LD  (_DTA),HL
00089B D5FF E1              10      POP HL
00089C D600 D5              11      PUSH    DE
00089D D601 1E00             7      LD  E,0
00089F D603 3E                      DB  03EH
                                
       D604                     _SYS0E:     ;(BDOS)カレントドライブの設定
0008A0 D604 D5              11      PUSH    DE
0008A1 D605 7B               4      LD  A,E
0008A2 D606 DDE5            15      PUSH    IX
0008A4 D608 CDDCEF          17      CALL    _GETDPB
0008A7 D60B DDE1            14      POP IX
0008A9 D60D 3804            12      JR  C,SX0E2
0008AB D60F 7B               4      LD  A,E
0008AC D610 3287EF          13      LD  (_DVSW),A
       D613                     SX0E2:
0008AF D613 3E08             7      LD  A,8
0008B1 D615 D1              10      POP DE
0008B2 D616 C9              10      RET
                                
       D617                     _SYS0F:     ;(BDOS)ファイルのオープン
0008B3 D617 CDCBDD          17      CALL    SETDRV
0008B6 D61A FD7E1C          19      LD  A,(IY+28)   ;(FCB)オープンモード
0008B9 D61D C602             7      ADD A,002H      ;Write
0008BB D61F 2848            12      JR  Z,FEND0F
0008BD D621 CD19E1          17      CALL    CHKWILDX
                                
0008C0 D624 D4EBDD          17      CALL    NC,SOPENX
       D627                     _S16XX:
0008C3 D627 3840            12      JR  C,FEND0F
                                                ;Directory location
0008C5 D629 3A9FEF          13      LD  A,(_FILEN)
0008C8 D62C FD7719          19      LD  (IY+25),A   ;(FCB)ディレクトリロケーション
                                ;               _DIRF
0008CB D62F 3AA0EF          13      LD  A,(_DIRF)
0008CE D632 FD771D          19      LD  (IY+29),A   ;(FCB)ディレクトリモード
                                ;               _FBPS
0008D1 D635 FD731E          19      LD  (IY+30),E   ;(FCB)ディレクトリポジション
0008D4 D638 FD721F          19      LD  (IY+31),D
                                ;               Open(Read)
0008D7 D63B FD361CFF        19      LD  (IY+28),0FFH    ;(FCB)オープンモード
                                ;               FILENAME
0008DB D63F FDE5            15      PUSH    IY
0008DD D641 D1              10      POP DE
0008DE D642 13               6      INC DE
0008DF D643 010B00          10      LD  BC,11
0008E2 D646 EDB0                    LDIR
                                ;               Attribute
0008E4 D648 7E               7      LD  A,(HL)
0008E5 D649 FD770D          19      LD  (IY+13),A   ;(FCB)属性(アトリビュート)
0008E8 D64C 110B00          10      LD  DE,11       ;Reserved
0008EB D64F 19              11      ADD HL,DE
                                                    ;(FCB)ファイルを最後に変更した時刻
0008EC D650 11EAF0          10      LD  DE,SDDATA       ;(FCB)ファイルを最後に変更した日付
0008EF D653 060A             7      LD  B,SDDATAE-SDDATA    ;(FCB)ファイルの先頭クラスタ
       D655                     S16LOOP:                ;(FCB)ファイルのサイズ(バイト単位)
0008F1 D655 1A               7      LD  A,(DE)
0008F2 D656 13               6      INC DE
0008F3 D657 325ED6          13      LD  (S16PAT+2),A
0008F6 D65A 7E               7      LD  A,(HL)
0008F7 D65B 23               6      INC HL
0008F8 D65C FD7700          19  S16PAT: LD  (IY+0),A
0008FB D65F 10F4            13      DJNZ    S16LOOP
                                
0008FD D661 AF               4      XOR A
0008FE D662 FD770C          19      LD  (IY+12),A   ;(FCB)カレントブロック
000901 D665 FD220DD7        20      LD  (OFCB+1),IY
       D669                     FEND0F:
000905 D669 1845            12      JR  FEND10
                                
       D66B                     _SYS10:     ;(BDOS)ファイルのクローズ
000907 D66B CDCBDD          17      CALL    SETDRV
00090A D66E FD7E1C          19      LD  A,(IY+28)   ;(FCB)オープンモード
00090D D671 D6FE             7      SUB 0FEH
00090F D673 37               4      SCF
000910 D674 3F               4      CCF
000911 D675 2039            12      JR  NZ,FEND10
       D677                     _S10A:              ;Write
000913 D677 FD770E          19      LD  (IY+14),A   ;(FCB)レコードサイズ/アクセスするディレクトリのクラスタ番号+1
000916 D67A FD770F          19      LD  (IY+15),A
                                
000919 D67D FD341C          23      INC (IY+28)     ;0FEH->0FFH ;オープンモード
00091C D680 CD11E2          17      CALL    SETTMS
                                
00091F D683 FD7E1D          19      LD  A,(IY+29)   ;(FCB)ディレクトリモード
000922 D686 32A0EF          13      LD  (_DIRF),A
000925 D689 E67F             7      AND 07FH
000927 D68B 325AE7          13      LD  (_SECPS+1),A
00092A D68E FD5E1E          19      LD  E,(IY+30)   ;(FCB)ディレクトリポジション
00092D D691 FD561F          19      LD  D,(IY+31)
000930 D694 CD1FDF          17      CALL    READ_DIR
000933 D697 3817            12      JR  C,FEND10
                                
000935 D699 3A49DE          13  SDECM1: LD  A,(SDECPAT+1)   ;1セクタ辺りのディレクトリエントリ数
000938 D69C 3D               4      DEC A       ;1024=01FH / 512=00FH / 256=7
000939 D69D FDA619          19      AND (IY+25)     ;(FCB)ディレクトリロケーション
00093C D6A0 6F               4      LD  L,A
00093D D6A1 2600             7      LD  H,0
00093F D6A3 29              11      ADD HL,HL       ;*2
000940 D6A4 29              11      ADD HL,HL       ;*4
000941 D6A5 29              11      ADD HL,HL       ;*8
000942 D6A6 29              11      ADD HL,HL       ;*16
000943 D6A7 29              11      ADD HL,HL       ;*32
000944 D6A8 ED4B7EF0        20      LD  BC,(_DTBUF)
000948 D6AC 09              11      ADD HL,BC
                                
000949 D6AD CD29E1          17      CALL    SDIRENT
       D6B0                     FEND10:
00094C D6B0 1842            12      JR  FEND
                                
       D6B2                     _SYS11:     ;(BDOS)最初のファイルの検索
00094E D6B2 CDCBDD          17      CALL    SETDRV
000951 D6B5 CD18DE          17      CALL    SOPEN
       D6B8                     _S12X1:
000954 D6B8 383A            12      JR  C,FEND
000956 D6BA CDB8DE          17      CALL    SOPENE2
000959 D6BD ED5B8AEF        20      LD  DE,(_DTA)
00095D D6C1 3A88EF          13      LD  A,(_DRV)
000960 D6C4 3C               4      INC A
000961 D6C5 12               7      LD  (DE),A
000962 D6C6 D5              11      PUSH    DE
000963 D6C7 13               6      INC DE
000964 D6C8 012000          10      LD  BC,32
000967 D6CB EDB0                    LDIR
000969 D6CD FD6E0E          19      LD  L,(IY+14)   ;(FCB)レコードサイズ/アクセスするディレクトリのクラスタ番号+1
00096C D6D0 FD660F          19      LD  H,(IY+15)
00096F D6D3 22F4F0          16      LD  (SCDIR),HL
000972 D6D6 2A9AEF          16      LD  HL,(_FBPS)
000975 D6D9 22F6F0          16      LD  (SFBPS),HL
000978 D6DC 2A9FEF          16      LD  HL,(_FILEN)
00097B D6DF 7C               4      LD  A,H
00097C D6E0 B7               4      OR  A
00097D D6E1 2806            12      JR  Z,_S12DIR
00097F D6E3 3A5AE7          13      LD  A,(_SECPS+1)
000982 D6E6 F680             7      OR  080H
000984 D6E8 67               4      LD  H,A
       D6E9                     _S12DIR:
000985 D6E9 22F8F0          16      LD  (SFNDF),HL  ;Directory position and Flags
000988 D6EC E1              10      POP HL
000989 D6ED 1139EF          10      LD  DE,SFILE
00098C D6F0 0E21             7      LD  C,33
       D6F2                     _S11B:
00098E D6F2 EDB0                    LDIR
       D6F4                     FEND:
000990 D6F4 9F               4      SBC A,A     ;CF=0 A=0 : CF=1 A=0FFH
       D6F5                     FENDE:
000991 D6F5 FDE1            14      POP IY
000993 D6F7 C1              10      POP BC
000994 D6F8 D1              10      POP DE
000995 D6F9 E1              10      POP HL
000996 D6FA C9              10      RET
                                
       D6FB                     _SYS12:     ;(BDOS)次のファイルの検索
000997 D6FB E5              11      PUSH    HL
000998 D6FC D5              11      PUSH    DE
000999 D6FD C5              11      PUSH    BC
00099A D6FE FDE5            15      PUSH    IY
00099C D700 CD7CDE          17      CALL    NOPEN
00099F D703 18B3            12      JR  _S12X1
                                
       D705                     _S16K:
0009A1 D705 FD7E1C          19      LD  A,(IY+28)   ;(FCB)オープンモード
0009A4 D708 FEFD             7      CP  0FDH        ;Device(0FDH)
0009A6 D70A 37               4      SCF
0009A7 D70B C8              11      RET Z
                                
0009A8 D70C 110000          10  OFCB:   LD  DE,0
0009AB D70F D5              11      PUSH    DE
0009AC D710 061A             7      LD  B,26        ;First cluster
       D712                     S16K1:
0009AE D712 13               6      INC DE
0009AF D713 23               6      INC HL
0009B0 D714 10FC            13      DJNZ    S16K1
                                
0009B2 D716 1A               7      LD  A,(DE)
0009B3 D717 BE               7      CP  (HL)
0009B4 D718 2013            12      JR  NZ,S16K2
0009B6 D71A 13               6      INC DE
0009B7 D71B 23               6      INC HL
0009B8 D71C 1A               7      LD  A,(DE)
0009B9 D71D BE               7      CP  (HL)
0009BA D71E 200D            12      JR  NZ,S16K2
                                
0009BC D720 E1              10      POP HL
0009BD D721 FDE5            15      PUSH    IY
0009BF D723 D1              10      POP DE
0009C0 D724 1A               7      LD  A,(DE)      ;Drive
0009C1 D725 BE               7      CP  (HL)
0009C2 D726 2006            12      JR  NZ,S16K3
                                                ;ここはCFが必ず0
0009C4 D728 ED52            15      SBC HL,DE       ;CP HL,DE
0009C6 D72A 37               4      SCF
0009C7 D72B C0              11      RET NZ
0009C8 D72C E5              11      PUSH    HL
       D72D                     S16K2:
0009C9 D72D E1              10      POP HL
       D72E                     S16K3:
0009CA D72E FDE5            15      PUSH    IY
0009CC D730 D1              10      POP DE
       D731                     _SYS13:     ;(BDOS)ファイルの削除
0009CD D731 CDCBDD          17      CALL    SETDRV
0009D0 D734 CD49E0          17      CALL    KILL
       D737                     FEND13:
0009D3 D737 18BB            12      JR  FEND
                                
       D739                     _SYS14:     ;(BDOS)シーケンシャルな読み出し
0009D5 D739 CDCBDD          17      CALL    SETDRV
0009D8 D73C CD7DE2          17      CALL    INIT_SEQ
       D73F                     SREAD:
0009DB D73F CDC7E2          17      CALL    RB_READ
                                
0009DE D742 C601             7      ADD A,001H
0009E0 D744 38AE            12      JR  C,FEND
                                
0009E2 D746 7D               4      LD  A,L
0009E3 D747 D601             7      SUB 001H
       D749                     FENDX:
0009E5 D749 9F               4      SBC A,A
0009E6 D74A E603             7      AND 3
0009E8 D74C 1F               4      RRA
0009E9 D74D 18A6            12      JR  FENDE
                                
       D74F                     _SYS15:     ;(BDOS)シーケンシャルな書き込み
0009EB D74F CDCBDD          17      CALL    SETDRV
0009EE D752 CD7DE2          17      CALL    INIT_SEQ
       D755                     SWRITE:
0009F1 D755 CDC0E2          17      CALL    RB_WRITE
                                
0009F4 D758 C6FF             7      ADD A,0FFH
0009F6 D75A 18ED            12      JR  FENDX
                                
       D75C                     _SYS17:     ;(BDOS)ファイル名の変更
0009F8 D75C CDCBDD          17      CALL    SETDRV
0009FB D75F CD9FE0          17      CALL    NAME
0009FE D762 18D3            12      JR  FEND13
                                
       D764                     _SYS16:     ;(BDOS)ファイルの作成
000A00 D764 CDCBDD          17      CALL    SETDRV
                                
000A03 D767 CD19E1          17      CALL    CHKWILDX
000A06 D76A 38CB            12      JR  C,FEND13
000A08 D76C FD7E01          19      LD  A,(IY+1)    ;(FCB)主ファイル名
000A0B D76F FE05             7      CP  5
000A0D D771 2805            12      JR  Z,_S16X2
000A0F D773 FE21             7      CP  021H
000A11 D775 DA37D7          10      JP  C,FEND13
       D778                     _S16X2:
                                ;               Clear FCB
000A14 D778 FDE5            15      PUSH    IY
000A16 D77A E1              10      POP HL
000A17 D77B 011000          10      LD  BC,16
000A1A D77E 09              11      ADD HL,BC
       D77F                     _S16X1:
000A1B D77F 70               7      LD  (HL),B      ;B=0
000A1C D780 23               6      INC HL
000A1D D781 0D               4      DEC C
000A1E D782 20FB            12      JR  NZ,_S16X1
                                
000A20 D784 CD16E2          17      CALL    SETTMSX
000A23 D787 FD360DFF        19      LD  (IY+13),0FFH    ;(FCB)Attribute
000A27 D78B CDEBDD          17      CALL    SOPENX
000A2A D78E 3F               4      CCF
000A2B D78F CC05D7          17      CALL    Z,_S16K
000A2E D792 D4C9DE          17      CALL    NC,COPEN
000A31 D795 D429E1          17      CALL    NC,SDIRENT
000A34 D798 C327D6          10      JP  _S16XX
                                
       D79B                     _SYS21:     ;(BDOS)ランダムな読み出し
000A37 D79B CDCBDD          17      CALL    SETDRV
000A3A D79E CD61E2          17      CALL    INIT_RND
000A3D D7A1 189C            12      JR  SREAD
                                
       D7A3                     _SYS22:     ;(BDOS)ランダムな書き込み
       D7A3                     _SYS28:     ;(BDOS)ランダムな書き込み・その2
000A3F D7A3 CDCBDD          17      CALL    SETDRV
000A42 D7A6 CD61E2          17      CALL    INIT_RND
000A45 D7A9 18AA            12      JR  SWRITE
                                
       D7AB                     _SYS18:     ;(BDOS)ログインベクトルの獲得
000A47 D7AB 21FF00          10      LD  HL,000FFH
000A4A D7AE AF               4      XOR A
000A4B D7AF C9              10      RET
                                
       D7B0                     _SYS19:     ;(BDOS)カレントドライブ番号の獲得
000A4C D7B0 3A87EF          13      LD  A,(_DVSW)
000A4F D7B3 A7               4      AND A
000A50 D7B4 C9              10      RET
                                
       D7B5                     _SYS1A:     ;(BDOS)DTAの設定
000A51 D7B5 ED538AEF        20      LD  (_DTA),DE
000A55 D7B9 AF               4      XOR A
000A56 D7BA C9              10      RET
                                
       D7BB                     _SYS1B:     ;(BDOS)ディスク情報の獲得
000A57 D7BB 7B               4      LD  A,E
000A58 D7BC CDDEDD          17      CALL    GETDRV
000A5B D7BF CDDCEF          17      CALL    _GETDPB
000A5E D7C2 D4E2EF          17      CALL    NC,_RDFATX
000A61 D7C5 210000          10      LD  HL,0
000A64 D7C8 D4EFE1          17      CALL    NC,DSKF
                                
000A67 D7CB ED5BF0E1        20      LD  DE,(MAXCLP+1)   ;DPB_08_MAXCL-1
000A6B D7CF 1B               6      DEC DE      ;DE←クラスタの総数
000A6C D7D0 FD2A7CF0        20      LD  IY,(_FATBF) ;IY←メモリ上のFATの先頭アドレス
000A70 D7D4 9F               4      SBC A,A
000A71 D7D5 D8              11      RET C
000A72 D7D6 4F               4      LD  C,A     ;C=0
000A73 D7D7 DD7E0F          19      LD  A,(IX+00FH) ;DPB_0F_BPS
000A76 D7DA E60F             7      AND 00FH
000A78 D7DC 47               4      LD  B,A
000A79 D7DD DD7E07          19      LD  A,(IX+7)    ;DPB_07_SECPCL
000A7C D7E0 C9              10      RET
                                
       D7E1                     _SYS1D:     ;(BDOS)書き込みが禁止されているディスクの調査
000A7D D7E1 AF               4      XOR A
000A7E D7E2 67               4      LD  H,A
000A7F D7E3 6F               4      LD  L,A
000A80 D7E4 C9              10      RET
                                
       D7E5                     _SYS1F:     ;(BDOS)ディスク装置のパラメータの読み出し
000A81 D7E5 2100F1          10      LD  HL,DEVICE
000A84 D7E8 7B               4      LD  A,E
000A85 D7E9 C3DCEF          10      JP  _GETDPB
                                
       D7EC                     _SYS23:     ;(BDOS)ファイルサイズの獲得
000A88 D7EC E5              11      PUSH    HL
000A89 D7ED 2A1EF0          16      LD  HL,(STABLE+2*00FH)  ;ファイルのオープン
000A8C D7F0 CD0F00          17      CALL    JP_HL
000A8F D7F3 381B            12      JR  C,_S23X1
                                
000A91 D7F5 D5              11      PUSH    DE      ;EX DE,IY
000A92 D7F6 FDE3            23      EX  (SP),IY     ;
                                ;   POP DE      ;
                                ;   PUSH    DE      ;DEを破壊しないように注意vv
000A94 D7F8 FD7E10          19      LD  A,(IY+16)   ;(FCB)ファイルのサイズ(バイト単位)
000A97 D7FB FD6E11          19      LD  L,(IY+17)   ;
000A9A D7FE FD6612          19      LD  H,(IY+18)   ;
000A9D D801 C5              11      PUSH    BC      ;
000A9E D802 FD4613          19      LD  B,(IY+19)   ;
000AA1 D805 CD53E2          17      CALL    GET_CPM_R_SIZE
000AA4 D808 C1              10      POP BC
       D809                     _S24X1:
000AA5 D809 CD73E2          17      CALL    SET_RR_AHL
                                ;   POP DE      ;^^^^^^^^^^^^^^^^^^^^^^^^
                                ;   PUSH    DE      ;EX DE,IY
000AA8 D80C FDE3            23      EX  (SP),IY     ;
000AAA D80E D1              10      POP DE      ;
                                
000AAB D80F AF               4      XOR A
       D810                     _S23X1:
000AAC D810 E1              10      POP HL
000AAD D811 C9              10      RET
                                
       D812                     _SYS24:     ;(BDOS)ランダムレコードフィールドの設定
000AAE D812 E5              11      PUSH    HL
000AAF D813 D5              11      PUSH    DE      ;EX DE,IY
000AB0 D814 FDE3            23      EX  (SP),IY     ;
                                ;   POP DE      ;
                                ;   PUSH    DE      ;DEを破壊しないように注意vv
000AB2 D816 CD85E2          17      CALL    GETSEQ
000AB5 D819 18EE            12      JR  _S24X1      ;^^^^^^^^^^^^^^^^^^^^^^^^
                                
       D81B                     _SYS5C:     ;(BDOS)ファイル名の解析
000AB7 D81B C5              11      PUSH    BC
000AB8 D81C E5              11      PUSH    HL
000AB9 D81D CDE2DC          17      CALL    FILE
000ABC D820 E1              10      POP HL
000ABD D821 C1              10      POP BC
       D822                     S29X1:
000ABE D822 C5              11      PUSH    BC
000ABF D823 D5              11      PUSH    DE
000AC0 D824 E5              11      PUSH    HL
000AC1 D825 EB               4      EX  DE,HL
000AC2 D826 2114EF          10      LD  HL,FDRV
000AC5 D829 010D00          10      LD  BC,13
000AC8 D82C EDB0                    LDIR
000ACA D82E 70               7      LD  (HL),B      ;B=0
000ACB D82F 0E03             7      LD  C,3
000ACD D831 EDB0                    LDIR
000ACF D833 E1              10      POP HL
000AD0 D834 D1              10      POP DE
000AD1 D835 C1              10      POP BC
000AD2 D836 AF               4      XOR A
000AD3 D837 C9              10      RET
                                
       D838                     _SYS30:     ;(BDOS)論理セクタを用いた書き込み
000AD4 D838 C5              11      PUSH    BC
000AD5 D839 01C7E8          10      LD  BC,DWT24B
000AD8 D83C 1804            12      JR  S2FX
       D83E                     _SYS2F:
000ADA D83E C5              11      PUSH    BC
000ADB D83F 01B7E8          10      LD  BC,DRD24B
       D842                     S2FX:
000ADE D842 ED4358D8        20      LD  (S2FPAT+1),BC
000AE2 D846 CDDFEF          17      CALL    _FFLUSH
                                
000AE5 D849 D5              11      PUSH    DE
000AE6 D84A E5              11      PUSH    HL
000AE7 D84B 7D               4      LD  A,L     ;Drive
000AE8 D84C CDD9EF          17      CALL    _CHGDRV
000AEB D84F 3809            12      JR  C,S30X2
000AED D851 44               4      LD  B,H     ;Number of clusters
000AEE D852 2A8AEF          16      LD  HL,(_DTA)
                                
000AF1 D855 0E00             7      LD  C,0
000AF3 D857 CDB7E8          17  S2FPAT: CALL    DRD24B
       D85A                     S30X2:
000AF6 D85A E1              10      POP HL
000AF7 D85B D1              10      POP DE
000AF8 D85C C1              10      POP BC
000AF9 D85D 9F               4      SBC A,A
000AFA D85E C9              10      RET
                                
       D85F                     _SYS5A:     ;(BDOS)カレントディレクトリの変更
000AFB D85F C5              11      PUSH    BC
000AFC D860 D5              11      PUSH    DE
000AFD D861 E5              11      PUSH    HL
000AFE D862 CDD7DC          17      CALL    FILEC
000B01 D865 210000          10      LD  HL,0
000B04 D868 1114EF          10      LD  DE,FDRV
000B07 D86B 2A4EF0          16      LD  HL,(STABLE+2*027H)  ;ランダムブロック読み込み
000B0A D86E CD0F00          17      CALL    JP_HL
000B0D D871 18E7            12      JR  S30X2
[EOF:LDOS.ASM:SHIFT_JIS]
                                    INCLUDE "M7IO.ASM"
                                
                                ;   LSX-Dodgers IO
                                ;   MZ-700/1500
                                
       D5D9                     _SYS04  EQU _ERROR      ;(BDOS)外部出力
       D5D9                     _SYS05  EQU _ERROR      ;(BDOS)プリンタ出力
       D5D9                     _SYS1C  EQU _ERROR      ;(BDOS)ディスクの書き込み禁止化
       D5D9                     _SYS1E  EQU _ERROR      ;(BDOS)ファイル属性の設定
       D5D9                     _SYS20  EQU _ERROR      ;(BDOS)利用者番号の設定と読み出し
       D5D9                     _SYS2E  EQU _ERROR      ;(BDOS)ベリファイ・フラグの設定
                                
       0000                     INT EQU 0
       0000                     INTCTCE EQU 0
       0000                     INTCTC2 EQU 0
                                
       D873                     KEYSET:
       D873                     KEYBS:
000B0F D873 B7               4      OR  A
000B10 D874 C8              11      RET Z
       D875                     KEYBS1:
000B11 D875 CD8BD8          17      CALL    KEYBC_IFBREAK
000B14 D878 E5              11      PUSH    HL
000B15 D879 F5              11      PUSH    AF
000B16 D87A 2A90EF          16      LD  HL,(_KEYPS)
000B19 D87D 2C               4      INC L
000B1A D87E 7D               4      LD  A,L
000B1B D87F BC               4      CP  H
000B1C D880 2815            12      JR  Z,POP_AF_HL_SCF_RET
000B1E D882 3290EF          13      LD  (_KEYPS),A
000B21 D885 26FE             7      LD  H,KEYBF/256
000B23 D887 F1              10      POP AF
000B24 D888 77               7      LD  (HL),A
000B25 D889 E1              10      POP HL
000B26 D88A C9              10      RET
       D88B                     KEYBC_IFBREAK:
000B27 D88B FE03             7      CP  3
000B29 D88D C0              11      RET NZ
       D88E                     KEYBC:
000B2A D88E E5              11      PUSH    HL
000B2B D88F 210000          10      LD  HL,0
000B2E D892 2290EF          16      LD  (_KEYPS),HL
000B31 D895 E1              10      POP HL
000B32 D896 C9              10      RET
                                
       D897                     POP_AF_HL_SCF_RET:
000B33 D897 F1              10      POP AF
000B34 D898 E1              10      POP HL
000B35 D899 37               4      SCF
000B36 D89A C9              10      RET
                                
       D89B                     _SYS01:     ;(BDOS)コンソール入力
000B37 D89B CD09EF          17      CALL    _SYS07
       D89E                     MSG_A:
000B3A D89E F5              11      PUSH    AF
000B3B D89F D5              11      PUSH    DE
000B3C D8A0 5F               4      LD  E,A
000B3D D8A1 CDA7D8          17      CALL    _SYS02
000B40 D8A4 D1              10      POP DE
000B41 D8A5 F1              10      POP AF
000B42 D8A6 C9              10      RET
                                
       D8A7                     _SYS02:     ;(BDOS)コンソール出力
000B43 D8A7 CDB9D8          17      CALL    BREAK
000B46 D8AA 1805            12      JR  PRINTX
                                
       D8AC                     _SYS06:     ;(BDOS)コンソール直接入出力
000B48 D8AC 7B               4      LD  A,E
000B49 D8AD 3C               4      INC A
000B4A D8AE CACAEF          10      JP  Z,_INKEY
       D8B1                     PRINTX:
000B4D D8B1 C3CDEF          10      JP  _PRINT
                                
       D8B4                     _SYS08:     ;(BDOS)エコーなしコンソール入力
000B50 D8B4 CD09EF          17      CALL    _SYS07
000B53 D8B7 1803            12      JR  BREAK1
       D8B9                     BREAK:
000B55 D8B9 CD69DC          17      CALL    CHKEY
       D8BC                     BREAK1:
000B58 D8BC FE03             7      CP  3       ;CTRL+C
000B5A D8BE CA00EF          10      JP  Z,CPM_BOOT
000B5D D8C1 FE13             7      CP  013H        ;CTRL+S
000B5F D8C3 C0              11      RET NZ
                                
       D8C4                     PAUSE:
000B60 D8C4 CD8ED8          17      CALL    KEYBC
                                
       D8C7                     FLGET:
000B63 D8C7 CDDFEF          17      CALL    _FFLUSH
000B66 D8CA E5              11      PUSH    HL
000B67 D8CB 2A8EEF          16      LD  HL,(_TXADR)
000B6A D8CE 7C               4      LD  A,H
000B6B D8CF C6D0             7      ADD A,0D0H
000B6D D8D1 67               4      LD  H,A
000B6E D8D2 CD21CF          17      CALL    RDMMIO
000B71 D8D5 32EAD8          13      LD  (FLSMC),A
       D8D8                     FLGET1:
000B74 D8D8 CD19CF          17      CALL    RD556VSYNC
000B77 D8DB CB77             8      BIT 6,A
000B79 D8DD 3EEF             7      LD  A,0EFH      ;カーソル
000B7B D8DF 200A            12      JR  NZ,FLGET2
000B7D D8E1 3A92EF          13      LD  A,(_KEYD)
000B80 D8E4 B7               4      OR  A
000B81 D8E5 3EEF             7      LD  A,0EFH      ;カーソル
000B83 D8E7 2002            12      JR  NZ,FLGET2
       D8EA                     FLSMC   EQU $+1
000B85 D8E9 3E00             7      LD  A,0     ;自己書き換え
       D8EB                     FLGET2:
000B87 D8EB CD27CF          17      CALL    WRMMIO
000B8A D8EE CDCAEF          17      CALL    _INKEY
000B8D D8F1 28E5            12      JR  Z,FLGET1
000B8F D8F3 F5              11      PUSH    AF
000B90 D8F4 3AEAD8          13      LD  A,(FLSMC)
000B93 D8F7 CD27CF          17      CALL    WRMMIO
000B96 D8FA F1              10      POP AF
000B97 D8FB E1              10      POP HL
000B98 D8FC C9              10      RET
                                
       D8FD                     _SYS0A:     ;(BDOS)文字列入力
000B99 D8FD C5              11      PUSH    BC
000B9A D8FE E5              11      PUSH    HL
000B9B D8FF D5              11      PUSH    DE
000B9C D900 CD95DB          17      CALL    GETL
000B9F D903 1100FF          10      LD  DE,KBUF
000BA2 D906 E1              10      POP HL
000BA3 D907 E5              11      PUSH    HL
000BA4 D908 0E00             7      LD  C,0
000BA6 D90A 3004            12      JR  NC,SAX0
000BA8 D90C 23               6      INC HL
000BA9 D90D 23               6      INC HL
000BAA D90E 1808            12      JR  SAX4
       D910                     SAX0:
000BAC D910 46               7      LD  B,(HL)
000BAD D911 23               6      INC HL
       D912                     SAX1:
000BAE D912 23               6      INC HL
000BAF D913 1A               7      LD  A,(DE)
000BB0 D914 13               6      INC DE
000BB1 D915 B7               4      OR  A
000BB2 D916 2004            12      JR  NZ,SAX2
       D918                     SAX4:
000BB4 D918 360D            10      LD  (HL),00DH
000BB6 D91A 1804            12      JR  SAX3
       D91C                     SAX2:
000BB8 D91C 77               7      LD  (HL),A
000BB9 D91D 0C               4      INC C
000BBA D91E 10F2            13      DJNZ    SAX1
       D920                     SAX3:
000BBC D920 D1              10      POP DE
000BBD D921 79               4      LD  A,C
000BBE D922 13               6      INC DE
000BBF D923 12               7      LD  (DE),A
000BC0 D924 1B               6      DEC DE
000BC1 D925 E1              10      POP HL
000BC2 D926 C1              10      POP BC
000BC3 D927 A7               4      AND A
000BC4 D928 C9              10      RET
                                
       D929                     _SYS0B:     ;(BDOS)コンソール状態のチェック
000BC5 D929 CDB9D8          17      CALL    BREAK
000BC8 D92C 3A92EF          13      LD  A,(_KEYD)
000BCB D92F B7               4      OR  A
000BCC D930 C8              11      RET Z
       D931                     CONSTX:
000BCD D931 CDDFEF          17      CALL    _FFLUSH
000BD0 D934 E5              11      PUSH    HL
000BD1 D935 2A90EF          16      LD  HL,(_KEYPS)
000BD4 D938 7C               4      LD  A,H
000BD5 D939 AD               4      XOR L
000BD6 D93A E1              10      POP HL
000BD7 D93B CC69DC          17      CALL    Z,CHKEY
000BDA D93E C6FF             7      ADD A,0FFH
000BDC D940 9F               4      SBC A,A
000BDD D941 C9              10      RET
                                
       D942                     _SYS2A:     ;(BDOS)日付の獲得
000BDE D942 AF               4      XOR A
000BDF D943 57               4      LD  D,A
000BE0 D944 5F               4      LD  E,A
000BE1 D945 67               4      LD  H,A
000BE2 D946 6F               4      LD  L,A
000BE3 D947 C9              10      RET
                                
       D948                     _SYS2C:     ;(BDOS)時刻の獲得
000BE4 D948 AF               4      XOR A
000BE5 D949 57               4      LD  D,A
000BE6 D94A 5F               4      LD  E,A
000BE7 D94B 67               4      LD  H,A
000BE8 D94C 6F               4      LD  L,A
000BE9 D94D C9              10      RET
                                
       D94E                     ESC1:
000BEA D94E 7B               4      LD  A,E
000BEB D94F FE41             7      CP  'A'
000BED D951 CA46DA          10      JP  Z,CTRL1E
000BF0 D954 FE42             7      CP  'B'
000BF2 D956 CA58DB          10      JP  Z,CTRL1F
000BF5 D959 FE43             7      CP  'C'
000BF7 D95B CA19DA          10      JP  Z,CTRL1C
000BFA D95E FE44             7      CP  'D'
000BFC D960 CA3DDA          10      JP  Z,CTRL1D
000BFF D963 FE45             7      CP  'E'
000C01 D965 2802            12      JR  Z,CT0CX
000C03 D967 FE6A             7      CP  'j'
       D969                     CT0CX:
000C05 D969 CA3DDB          10      JP  Z,CTRL0C
000C08 D96C FE48             7      CP  'H'
000C0A D96E CABADA          10      JP  Z,CTRL0B
000C0D D971 FE4A             7      CP  'J'
000C0F D973 CA40DB          10      JP  Z,CTRL06
000C12 D976 FE4B             7      CP  'K'
000C14 D978 CA8CDA          10      JP  Z,CTRL05
000C17 D97B FE4C             7      CP  'L'
000C19 D97D CA6ADB          10      JP  Z,CTRL0E
000C1C D980 FE54             7      CP  'T'
000C1E D982 CA8CDA          10      JP  Z,CTRL05
000C21 D985 FE78             7      CP  'x'
000C23 D987 2804            12      JR  Z,ESC1X
000C25 D989 FE79             7      CP  'y'
000C27 D98B 2002            12      JR  NZ,ESC1Y
       D98D                     ESC1X:
000C29 D98D 3601            10      LD  (HL),1
       D98F                     ESC1Y:
000C2B D98F FE3D             7      CP  '='
000C2D D991 2804            12      JR  Z,ESC1W
000C2F D993 FE59             7      CP  'Y'
000C31 D995 2002            12      JR  NZ,ESC1Z
       D997                     ESC1W:
000C33 D997 3602            10      LD  (HL),2
       D999                     ESC1Z:
000C35 D999 FE20             7      CP  020H
000C37 D99B 3802            12      JR  C,ESC1C
000C39 D99D 87               4      ADD A,A
000C3A D99E D0              11      RET NC
       D99F                     ESC1C:
000C3B D99F E1              10      POP HL
000C3C D9A0 1832            12      JR  ANK
                                
       D9A2                     ESC:
000C3E D9A2 2105DA          10      LD  HL,PRINTE5
000C41 D9A5 E5              11      PUSH    HL
000C42 D9A6 21C8D9          10      LD  HL,ESCFLG
000C45 D9A9 3600            10      LD  (HL),0
000C47 D9AB 3D               4      DEC A
000C48 D9AC 28A0            12      JR  Z,ESC1
000C4A D9AE 3D               4      DEC A
000C4B D9AF 2009            12      JR  NZ,ESC2
000C4D D9B1 3603            10      LD  (HL),3
000C4F D9B3 7B               4      LD  A,E
000C50 D9B4 D620             7      SUB 020H
000C52 D9B6 32BDD9          13      LD  (ESCYP+1),A
000C55 D9B9 C9              10      RET
       D9BA                     ESC2:
000C56 D9BA 3D               4      DEC A
000C57 D9BB C0              11      RET NZ
000C58 D9BC 2600             7  ESCYP:  LD  H,0
000C5A D9BE 7B               4      LD  A,E
000C5B D9BF D620             7      SUB 020H
000C5D D9C1 6F               4      LD  L,A
000C5E D9C2 C3D6EF          10      JP  _LOC
                                
       D9C5                     PRINT:
000C61 D9C5 C5              11      PUSH    BC
000C62 D9C6 E5              11      PUSH    HL
       D9C8                     ESCFLG  EQU $+1
000C63 D9C7 3E00             7      LD  A,000H      ;自己書き換え
000C65 D9C9 B7               4      OR  A
000C66 D9CA 20D6            12      JR  NZ,ESC
                                
000C68 D9CC 3E1F             7      LD  A,01FH
000C6A D9CE BB               4      CP  E
000C6B D9CF 3038            12      JR  NC,CTRL
       D9D1                     INSFLG  EQU $
000C6D D9D1 0112DB          10      LD  BC,INSERT   ;自己書き換え
       D9D4                     ANK:
000C70 D9D4 3A96EF          13      LD  A,(_COLORF)
000C73 D9D7 4F               4      LD  C,A
000C74 D9D8 7B               4      LD  A,E
000C75 D9D9 FE61             7      CP  'a'     ;英小文字
000C77 D9DB 3806            12      JR  C,PRT1
000C79 D9DD FE7B             7      CP  'z'+1
000C7B D9DF 3002            12      JR  NC,PRT1
000C7D D9E1 CBF9             8      SET 7,C
       D9E3                     PRT1:
000C7F D9E3 FE86             7      CP  $86     ;ひらがな1(を－そ)
000C81 D9E5 3806            12      JR  C,PRT2
000C83 D9E7 FEA0             7      CP  $A0
000C85 D9E9 3002            12      JR  NC,PRT2
000C87 D9EB CBF9             8      SET 7,C
       D9ED                     PRT2:
000C89 D9ED FEE0             7      CP  $E0     ;ひらがな2(たーん)
000C8B D9EF 3802            12      JR  C,PRT3
000C8D D9F1 CBF9             8      SET 7,C
       D9F3                     PRT3:
000C8F D9F3 2A8EEF          16      LD  HL,(_TXADR)
000C92 D9F6 7C               4      LD  A,H
000C93 D9F7 C6D0             7      ADD A,0D0H
000C95 D9F9 67               4      LD  H,A
000C96 D9FA 42               4      LD  B,D
000C97 D9FB 16ED             7      LD  D,CD_TABLE/256
000C99 D9FD 1A               7      LD  A,(DE)
000C9A D9FE 50               4      LD  D,B
000C9B D9FF CD39CF          17      CALL    IO_PRINT
000C9E DA02 CD19DA          17      CALL    CTRL1C
       DA05                     PRINTE5:
000CA1 DA05 E1              10      POP HL
000CA2 DA06 C1              10      POP BC
000CA3 DA07 AF               4      XOR A
000CA4 DA08 C9              10      RET
                                
       DA09                     CTRL:
000CA5 DA09 7B               4      LD  A,E
000CA6 DA0A 87               4      ADD A,A
000CA7 DA0B F680             7      OR  080H
000CA9 DA0D 6F               4      LD  L,A
000CAA DA0E 26F0             7      LD  H,CTRLTB/256
000CAC DA10 7E               7      LD  A,(HL)
000CAD DA11 2C               4      INC L
000CAE DA12 66               7      LD  H,(HL)
000CAF DA13 6F               4      LD  L,A
000CB0 DA14 CD0F00          17      CALL    JP_HL
000CB3 DA17 18EC            12      JR  PRINTE5
                                
       DA19                     CTRL1C:
000CB5 DA19 ED4B8EEF        20      LD  BC,(_TXADR)
000CB9 DA1D 03               6      INC BC
       DA1E                     PRINTE3:
000CBA DA1E 2118FC          10      LD  HL,0-WIDTH*LINE
000CBD DA21 A7               4      AND A
000CBE DA22 ED4A            15      ADC HL,BC
       DA24                     PRINTE8:
000CC0 DA24 2805            12      JR  Z,PRINT2
000CC2 DA26 ED438EEF        20      LD  (_TXADR),BC
       DA2A                     CTRL00:
000CC6 DA2A C9              10      RET
                                
       DA2B                     PRINT2:
000CC7 DA2B CD70DB          17      CALL    SCR
000CCA DA2E 21D8FF          10      LD  HL,0-WIDTH
000CCD DA31 09              11      ADD HL,BC
       DA32                     SET_TXADR_HL:
000CCE DA32 228EEF          16      LD  (_TXADR),HL
000CD1 DA35 C9              10      RET
                                
       DA36                     CTRL08:
000CD2 DA36 3AD1D9          13      LD  A,(INSFLG)
000CD5 DA39 FECD             7      CP  0CDH        ;CALL ????
000CD7 DA3B 2823            12      JR  Z,CTRL02
       DA3D                     CTRL1D:
000CD9 DA3D 2A8EEF          16      LD  HL,(_TXADR)
000CDC DA40 7C               4      LD  A,H
000CDD DA41 B5               4      OR  L
000CDE DA42 C8              11      RET Z
000CDF DA43 2B               6      DEC HL
000CE0 DA44 18EC            12      JR  SET_TXADR_HL
                                
       DA46                     CTRL1E:
000CE2 DA46 ED4B8EEF        20      LD  BC,(_TXADR)
000CE6 DA4A 21D8FF          10      LD  HL,0-WIDTH
000CE9 DA4D 09              11      ADD HL,BC
000CEA DA4E D0              11      RET NC
000CEB DA4F 18E1            12      JR  SET_TXADR_HL
                                
       DA51                     CTRL09:
000CED DA51 ED4B8EEF        20      LD  BC,(_TXADR)
000CF1 DA55 79               4      LD  A,C
000CF2 DA56 E6F8             7      AND 0F8H
000CF4 DA58 C608             7      ADD A,8
000CF6 DA5A 4F               4      LD  C,A
000CF7 DA5B 88               4      ADC A,B
000CF8 DA5C 91               4      SUB C
000CF9 DA5D 47               4      LD  B,A
000CFA DA5E 18BE            12      JR  PRINTE3
                                
       DA60                     CTRL02:
000CFC DA60 CD3DDA          17      CALL    CTRL1D
000CFF DA63 C8              11      RET Z
000D00 DA64 D5              11      PUSH    DE
000D01 DA65 CDD3EF          17      CALL    _POS
000D04 DA68 54               4      LD  D,H
000D05 DA69 3E28             7      LD  A,WIDTH
000D07 DA6B 95               4      SUB L
000D08 DA6C 4F               4      LD  C,A
000D09 DA6D 0D               4      DEC C
000D0A DA6E 06D0             7      LD  B,0D0H
000D0C DA70 2A8EEF          16      LD  HL,(_TXADR)
000D0F DA73 09              11      ADD HL,BC
000D10 DA74 47               4      LD  B,A
                                
000D11 DA75 3A2EDB          13      LD  A,(MULINE)
000D14 DA78 BA               4      CP  D
000D15 DA79 2007            12      JR  NZ,C02X1
000D17 DA7B 112800          10      LD  DE,WIDTH
000D1A DA7E 19              11      ADD HL,DE
000D1B DA7F 78               4      LD  A,B
000D1C DA80 83               4      ADD A,E
000D1D DA81 47               4      LD  B,A
       DA82                     C02X1:
000D1E DA82 3A96EF          13      LD  A,(_COLORF) ;C:Color
000D21 DA85 4F               4      LD  C,A
000D22 DA86 AF               4      XOR A       ;A:Text
000D23 DA87 CD78CF          17      CALL    IO_BS
000D26 DA8A D1              10      POP DE
000D27 DA8B C9              10      RET
                                
       DA8C                     CTRL05:
000D28 DA8C CDD3EF          17      CALL    _POS
000D2B DA8F 3E28             7      LD  A,WIDTH
000D2D DA91 95               4      SUB L
000D2E DA92 47               4      LD  B,A
       DA93                     C08X1:
000D2F DA93 2A8EEF          16      LD  HL,(_TXADR)
000D32 DA96 7C               4      LD  A,H
000D33 DA97 C6D0             7      ADD A,0D0H
000D35 DA99 67               4      LD  H,A
       DA9A                     CLLINE:
000D36 DA9A 3A96EF          13      LD  A,(_COLORF)
000D39 DA9D 4F               4      LD  C,A
000D3A DA9E AF               4      XOR A
000D3B DA9F C35FCF          10      JP  IO_CLLINE
                                
       DAA2                     CTRL0D:
000D3E DAA2 CDD3EF          17      CALL    _POS
000D41 DAA5 2E00             7      LD  L,0
       DAA7                     LOC:
000D43 DAA7 C5              11      PUSH    BC
000D44 DAA8 E5              11      PUSH    HL
000D45 DAA9 CDC7DA          17      CALL    LOC1
000D48 DAAC 228EEF          16      LD  (_TXADR),HL
000D4B DAAF E1              10      POP HL
000D4C DAB0 C1              10      POP BC
000D4D DAB1 C9              10      RET
                                
       DAB2                     CTRL12:
000D4E DAB2 21D1D9          10      LD  HL,INSFLG
000D51 DAB5 7E               7      LD  A,(HL)
000D52 DAB6 EECC             7      XOR 0CCH        ;CD:CALL ???? 1:LD BC,????
000D54 DAB8 77               7      LD  (HL),A
000D55 DAB9 C9              10      RET
                                
       DABA                     CTRL0B:
000D56 DABA 210000          10      LD  HL,0
000D59 DABD 228EEF          16      LD  (_TXADR),HL
000D5C DAC0 C9              10      RET
                                
       DAC1                     CTRL1B:
000D5D DAC1 3E01             7      LD  A,1
000D5F DAC3 32C8D9          13      LD  (ESCFLG),A
000D62 DAC6 C9              10      RET
                                
       DAC7                     LOC1:
000D63 DAC7 D5              11      PUSH    DE
000D64 DAC8 4D               4      LD  C,L
000D65 DAC9 0608             7      LD  B,8
000D67 DACB 5C               4      LD  E,H
000D68 DACC 210028          10      LD  HL,WIDTH*256
000D6B DACF 55               4      LD  D,L ;L=0
       DAD0                     LOC2:
000D6C DAD0 29              11      ADD HL,HL
000D6D DAD1 3001            12      JR  NC,LOC3
000D6F DAD3 19              11      ADD HL,DE
       DAD4                     LOC3:
000D70 DAD4 10FA            13      DJNZ    LOC2
000D72 DAD6 09              11      ADD HL,BC
000D73 DAD7 D1              10      POP DE
000D74 DAD8 C9              10      RET
                                
       DAD9                     CONOUT1:
                                ;   CALL    CURSOR
000D75 DAD9 59               4      LD  E,C
000D76 DADA CDCDEF          17      CALL    _PRINT
000D79 DADD 7B               4      LD  A,E
000D7A DADE FE0A             7      CP  00AH
000D7C DAE0 2006            12      JR  NZ,CURSOR
000D7E DAE2 CDA2DA          17      CALL    CTRL0D
000D81 DAE5 CD8CDA          17      CALL    CTRL05
       DAE8                     CURSOR:
000D84 DAE8 C9              10      RET
                                
       DAE9                     CTRL07:
000D85 DAE9 06E0             7      LD  B,0E0H
000D87 DAEB 2162EF          10      LD  HL,BEEPD+1
       DAEE                     C07X0:
000D8A DAEE 4E               7      LD  C,(HL)
000D8B DAEF 23               6      INC HL
000D8C DAF0 7E               7      LD  A,(HL)
000D8D DAF1 23               6      INC HL
000D8E DAF2 CD33CF          17      CALL    WRMMIO_BC
000D91 DAF5 7D               4      LD  A,L
000D92 DAF6 FE6A             7      CP  (BEEPD+1+M7BEEPE-M7BEEPD)&255
000D94 DAF8 20F4            12      JR  NZ,C07X0
000D96 DAFA 0610             7      LD  B,16
       DAFC                     C07X1:
000D98 DAFC CD19CF          17      CALL    RD556VSYNC
000D9B DAFF 87               4      ADD A,A
000D9C DB00 30FA            12      JR  NC,C07X1
       DB02                     C07X2:
000D9E DB02 CD19CF          17      CALL    RD556VSYNC
000DA1 DB05 87               4      ADD A,A
000DA2 DB06 38FA            12      JR  C,C07X2
000DA4 DB08 10F2            13      DJNZ    C07X1
                                
000DA6 DB0A AF               4      XOR A
000DA7 DB0B 2108E0          10      LD  HL,0E008H
000DAA DB0E CD27CF          17      CALL    WRMMIO
000DAD DB11 C9              10      RET
                                
       DB12                     INSERT:
000DAE DB12 D5              11      PUSH    DE
000DAF DB13 CDD3EF          17      CALL    _POS
000DB2 DB16 54               4      LD  D,H
000DB3 DB17 3E28             7      LD  A,WIDTH
000DB5 DB19 95               4      SUB L
000DB6 DB1A 47               4      LD  B,A
000DB7 DB1B 2A8EEF          16      LD  HL,(_TXADR)
000DBA DB1E 7C               4      LD  A,H
000DBB DB1F C6D0             7      ADD A,0D0H
000DBD DB21 67               4      LD  H,A
000DBE DB22 3A96EF          13      LD  A,(_COLORF) ;C:Color
000DC1 DB25 4F               4      LD  C,A
000DC2 DB26 AF               4      XOR A       ;A:Text
000DC3 DB27 CD6DCF          17      CALL    IO_INS
000DC6 DB2A B7               4      OR  A
000DC7 DB2B 2005            12      JR  NZ,INS1
       DB2E                     MULINE  EQU $+1
000DC9 DB2D 3EFF             7      LD  A,-1
000DCB DB2F 92               4      SUB D
000DCC DB30 2009            12      JR  NZ,INS2
       DB32                     INS1:
000DCE DB32 0628             7      LD  B,WIDTH
000DD0 DB34 CD6DCF          17      CALL    IO_INS
000DD3 DB37 7A               4      LD  A,D
000DD4 DB38 322EDB          13      LD  (MULINE),A
       DB3B                     INS2:
000DD7 DB3B D1              10      POP DE
000DD8 DB3C C9              10      RET
                                
       DB3D                     CTRL0C:
000DD9 DB3D CDBADA          17      CALL    CTRL0B
       DB40                     CTRL06:
000DDC DB40 D5              11      PUSH    DE
000DDD DB41 E5              11      PUSH    HL
000DDE DB42 ED5B8EEF        20      LD  DE,(_TXADR)
000DE2 DB46 3A96EF          13      LD  A,(_COLORF)
000DE5 DB49 324DCF          13      LD  (ICSMC),A
000DE8 DB4C C342CF          10      JP  IO_CLR
                                
       DB4F                     CTRL04:
000DEB DB4F CDD3EF          17      CALL    _POS
000DEE DB52 7D               4      LD  A,L
000DEF DB53 B7               4      OR  A
000DF0 DB54 C8              11      RET Z
       DB55                     CTRL03:
000DF1 DB55 CDA2DA          17      CALL    CTRL0D
       DB58                     CTRL0A:
       DB58                     CTRL1F:
000DF4 DB58 2A8EEF          16      LD  HL,(_TXADR)
000DF7 DB5B 012800          10      LD  BC,WIDTH
000DFA DB5E 09              11      ADD HL,BC
000DFB DB5F 44               4      LD  B,H
000DFC DB60 4D               4      LD  C,L
000DFD DB61 2118FC          10      LD  HL,0-WIDTH*LINE
000E00 DB64 09              11      ADD HL,BC
000E01 DB65 3F               4      CCF
000E02 DB66 9F               4      SBC A,A
000E03 DB67 C324DA          10      JP  PRINTE8
                                
       DB6A                     CTRL0E:
000E06 DB6A CDD3EF          17      CALL    _POS
000E09 DB6D 7C               4      LD  A,H
000E0A DB6E 1804            12      JR  SCR1
       DB70                     SCR:
000E0C DB70 3A97EF          13      LD  A,(_LINE)
000E0F DB73 3D               4      DEC A
       DB74                     SCR1:
000E10 DB74 C5              11      PUSH    BC
000E11 DB75 D5              11      PUSH    DE
000E12 DB76 E5              11      PUSH    HL
000E13 DB77 1100D0          10      LD  DE,0D000H
000E16 DB7A 2128D0          10      LD  HL,0D000H+WIDTH
                                
000E19 DB7D 47               4      LD  B,A
000E1A DB7E B7               4      OR  A
000E1B DB7F C38ECF          10      JP  IO_SCRUP
                                
       DB82                     POS:
000E1E DB82 2A8EEF          16      LD  HL,(_TXADR)
000E21 DB85 C5              11      PUSH    BC
000E22 DB86 01D8FF          10      LD  BC,0-WIDTH
000E25 DB89 AF               4      XOR A
       DB8A                     POS1:
000E26 DB8A 09              11      ADD HL,BC
000E27 DB8B 3C               4      INC A
000E28 DB8C 38FC            12      JR  C,POS1
000E2A DB8E ED42            15      SBC HL,BC
000E2C DB90 3D               4      DEC A
000E2D DB91 67               4      LD  H,A
000E2E DB92 C1              10      POP BC
000E2F DB93 A7               4      AND A
000E30 DB94 C9              10      RET
                                
       DB95                     GETL:
000E31 DB95 CDD3EF          17      CALL    _POS
000E34 DB98 E5              11      PUSH    HL
000E35 DB99 3ECD             7      LD  A,0CDH      ;CALL ????
000E37 DB9B 32D1D9          13      LD  (INSFLG),A
       DB9E                     GETL1:
000E3A DB9E CDB4D8          17      CALL    _SYS08
000E3D DBA1 FE09             7      CP  9
000E3F DBA3 2008            12      JR  NZ,GETL1V
000E41 DBA5 2100FF          10      LD  HL,KBUF
000E44 DBA8 CDEAD5          17      CALL    MSX
000E47 DBAB 18F1            12      JR  GETL1
       DBAD                     GETL1V:
000E49 DBAD 5F               4      LD  E,A
000E4A DBAE CDD3EF          17      CALL    _POS
000E4D DBB1 CDCDEF          17      CALL    _PRINT
000E50 DBB4 7B               4      LD  A,E
000E51 DBB5 FE20             7      CP  $20
000E53 DBB7 3809            12      JR  C,GETL1V1
000E55 DBB9 7D               4      LD  A,L
000E56 DBBA FE27             7      CP  WIDTH-1
000E58 DBBC 2004            12      JR  NZ,GETL1V1
000E5A DBBE 7C               4      LD  A,H
000E5B DBBF 322EDB          13      LD  (MULINE),A
       DBC2                     GETL1V1:
000E5E DBC2 7B               4      LD  A,E
000E5F DBC3 FE0D             7      CP  00DH
000E61 DBC5 20D7            12      JR  NZ,GETL1
000E63 DBC7 3E01             7      LD  A,1     ;LD BC,????
000E65 DBC9 32D1D9          13      LD  (INSFLG),A
000E68 DBCC 1100FF          10      LD  DE,KBUF
000E6B DBCF 0628             7      LD  B,WIDTH
000E6D DBD1 CDB2D3          17      CALL    ZERO_MEMORY_DE
                                
000E70 DBD4 D1              10      POP DE
000E71 DBD5 CDD3EF          17      CALL    _POS
000E74 DBD8 6B               4      LD  L,E
000E75 DBD9 3E28             7      LD  A,WIDTH
000E77 DBDB 95               4      SUB L
000E78 DBDC 57               4      LD  D,A
                                
000E79 DBDD 3A2EDB          13      LD  A,(MULINE)
000E7C DBE0 94               4      SUB H
000E7D DBE1 2806            12      JR  Z,GL2X
000E7F DBE3 3C               4      INC A
000E80 DBE4 200C            12      JR  NZ,GL3X
000E82 DBE6 25               4      DEC H
000E83 DBE7 1805            12      JR  GL4X
       DBE9                     GL2X:
000E85 DBE9 3E1F             7      LD  A,$1F
000E87 DBEB CD9ED8          17      CALL    MSG_A
       DBEE                     GL4X:
000E8A DBEE 7A               4      LD  A,D
000E8B DBEF C628             7      ADD A,WIDTH
000E8D DBF1 57               4      LD  D,A
       DBF2                     GL3X:
000E8E DBF2 CDC7DA          17      CALL    LOC1
000E91 DBF5 4D               4      LD  C,L
000E92 DBF6 7C               4      LD  A,H
000E93 DBF7 C6D0             7      ADD A,0D0H
000E95 DBF9 47               4      LD  B,A
000E96 DBFA 5A               4      LD  E,D
000E97 DBFB 2100FF          10      LD  HL,KBUF
       DBFE                     GETL2:
000E9A DBFE CDD0EF          17      CALL    _SCRN
000E9D DC01 03               6      INC BC
000E9E DC02 77               7      LD  (HL),A
000E9F DC03 23               6      INC HL
000EA0 DC04 1D               4      DEC E
000EA1 DC05 20F7            12      JR  NZ,GETL2
       DC07                     GETL3:
000EA3 DC07 2B               6      DEC HL
000EA4 DC08 7E               7      LD  A,(HL)
000EA5 DC09 FE21             7      CP  021H
000EA7 DC0B D0              11      RET NC
000EA8 DC0C 3600            10      LD  (HL),0
000EAA DC0E 15               4      DEC D
000EAB DC0F 20F6            12      JR  NZ,GETL3
000EAD DC11 C9              10      RET
                                
       DC12                     INKEYB:
000EAE DC12 C1              10      POP BC
000EAF DC13 CB47             8      BIT 0,A
000EB1 DC15 3E08             7      LD  A,8
000EB3 DC17 2016            12      JR  NZ,INKEYD
000EB5 DC19 3E03             7      LD  A,3
000EB7 DC1B 1812            12      JR  INKEYD
       DC1D                     INKEY:
000EB9 DC1D E5              11      PUSH    HL
000EBA DC1E 2A90EF          16      LD  HL,(_KEYPS)
000EBD DC21 7C               4      LD  A,H
000EBE DC22 AD               4      XOR L
000EBF DC23 280F            12      JR  Z,GETKEY
000EC1 DC25 7C               4      LD  A,H
000EC2 DC26 3C               4      INC A
000EC3 DC27 3291EF          13      LD  (_KEYPS+1),A
000EC6 DC2A 6F               4      LD  L,A
000EC7 DC2B 26FE             7      LD  H,KEYBF/256
000EC9 DC2D 7E               7      LD  A,(HL)
000ECA DC2E E1              10      POP HL
       DC2F                     INKEYD:
000ECB DC2F B7               4      OR  A
000ECC DC30 3292EF          13      LD  (_KEYD),A
000ECF DC33 C9              10      RET
       DC34                     GETKEY:
000ED0 DC34 3A92EF          13      LD  A,(_KEYD)
000ED3 DC37 B7               4      OR  A
000ED4 DC38 6F               4      LD  L,A
000ED5 DC39 2610             7  GKSMC:  LD  H,16
       DC3B                     GETKEY1:
000ED7 DC3B CD69DC          17      CALL    CHKEY       ;キーを離すまで待つ
000EDA DC3E 281E            12      JR  Z,GETKEY2
000EDC DC40 BD               4      CP  L
000EDD DC41 201B            12      JR  NZ,GETKEY2
000EDF DC43 CD19CF          17      CALL    RD556VSYNC
000EE2 DC46 87               4      ADD A,A
000EE3 DC47 30F2            12      JR  NC,GETKEY1
       DC49                     GETKEY1X:
000EE5 DC49 CD69DC          17      CALL    CHKEY       ;キーを離すまで待つ
000EE8 DC4C 2810            12      JR  Z,GETKEY2
000EEA DC4E BD               4      CP  L
000EEB DC4F 200D            12      JR  NZ,GETKEY2
000EED DC51 CD19CF          17      CALL    RD556VSYNC
000EF0 DC54 87               4      ADD A,A
000EF1 DC55 38F2            12      JR  C,GETKEY1X
000EF3 DC57 25               4      DEC H
000EF4 DC58 20E1            12      JR  NZ,GETKEY1
000EF6 DC5A 3E01             7      LD  A,1
000EF8 DC5C 1802            12      JR  GETKEY3
       DC5E                     GETKEY2:
000EFA DC5E 3E10             7      LD  A,16
       DC60                     GETKEY3:
000EFC DC60 323ADC          13      LD  (GKSMC+1),A
000EFF DC63 3A92EF          13      LD  A,(_KEYD)
000F02 DC66 B7               4      OR  A
000F03 DC67 E1              10      POP HL
000F04 DC68 C0              11      RET NZ
       DC69                     CHKEY:
000F05 DC69 C5              11      PUSH    BC
000F06 DC6A 3E08             7      LD  A,8
000F08 DC6C CD0ECF          17      CALL    RDKEYDATA
000F0B DC6F 3293EF          13      LD  (_KEYD+1),A
000F0E DC72 CB7F             8      BIT 7,A
000F10 DC74 289C            12      JR  Z,INKEYB
000F12 DC76 E5              11      PUSH    HL
000F13 DC77 0E07             7      LD  C,7
000F15 DC79 2140EC          10      LD  HL,KEY_TABLE
000F18 DC7C CB47             8      BIT 0,A
000F1A DC7E 2003            12      JR  NZ,INKEY0
000F1C DC80 2180EC          10      LD  HL,SHIFT_TABLE
       DC83                     INKEY0:
000F1F DC83 CB77             8      BIT 6,A
000F21 DC85 2003            12      JR  NZ,INKEY1
000F23 DC87 21C0EC          10      LD  HL,CTRL_TABLE
       DC8A                     INKEY1:
000F26 DC8A 79               4      LD  A,C
000F27 DC8B CD0ECF          17      CALL    RDKEYDATA
000F2A DC8E 0608             7      LD  B,8
       DC90                     INKEY2:
000F2C DC90 87               4      ADD A,A
000F2D DC91 3009            12      JR  NC,INKEY3
000F2F DC93 23               6      INC HL
000F30 DC94 10FA            13      DJNZ    INKEY2
000F32 DC96 0D               4      DEC C
000F33 DC97 79               4      LD  A,C
000F34 DC98 3C               4      INC A
000F35 DC99 20EF            12      JR  NZ,INKEY1
000F37 DC9B 06                      DB  $06     ;LD B,?? 次の1バイトを飛ばす
       DC9C                     INKEY3:
000F38 DC9C 7E               7      LD  A,(HL)
000F39 DC9D E1              10      POP HL
000F3A DC9E C1              10      POP BC
000F3B DC9F 188E            12      JR  INKEYD
                                
       DCA1                     SCRN:
000F3D DCA1 E5              11      PUSH    HL
000F3E DCA2 CD2DCF          17      CALL    RDMMIO_BC
000F41 DCA5 6F               4      LD  L,A
000F42 DCA6 26EE             7      LD  H,DC_TABLE/256
000F44 DCA8 7E               7      LD  A,(HL)
000F45 DCA9 FE41             7      CP  'A'     ;英小文字チェック
000F47 DCAB 380E            12      JR  C,SCRN1
000F49 DCAD FE5B             7      CP  'Z'+1
000F4B DCAF DCBDDC          17      CALL    C,SCRNC
000F4E DCB2 FEA6             7      CP  $A6     ;ひらがなチェック
000F50 DCB4 3805            12      JR  C,SCRN1
000F52 DCB6 FEE0             7      CP  $E0
000F54 DCB8 DCBDDC          17      CALL    C,SCRNC
       DCBB                     SCRN1:
000F57 DCBB E1              10      POP HL
000F58 DCBC C9              10      RET
                                
       DCBD                     SCRNC:
000F59 DCBD 6F               4      LD  L,A
000F5A DCBE 60               4      LD  H,B
000F5B DCBF CBD8             8      SET 3,B
000F5D DCC1 CD2DCF          17      CALL    RDMMIO_BC
000F60 DCC4 44               4      LD  B,H
000F61 DCC5 CB7F             8      BIT 7,A
000F63 DCC7 7D               4      LD  A,L
000F64 DCC8 C8              11      RET Z
000F65 DCC9 FE5B             7      CP  'Z'+1
000F67 DCCB 3804            12      JR  C,SCRNC_ADD
000F69 DCCD FEC0             7      CP  $C0
000F6B DCCF 3803            12      JR  C,SCRNC_SUB
       DCD1                     SCRNC_ADD:
000F6D DCD1 C620             7      ADD A,$20
000F6F DCD3 C9              10      RET
       DCD4                     SCRNC_SUB:
000F70 DCD4 D620             7      SUB $20
000F72 DCD6 C9              10      RET
[EOF:M7IO.ASM:SHIFT_JIS]
                                    INCLUDE "LDFILE.ASM"
                                
                                ;   LSX-Dodgers FILE
                                
       DCD7                     FILEC:
000F73 DCD7 CDE2DC          17      CALL    FILE
       DCDA                     FILEC2:
000F76 DCDA 3A15EF          13      LD  A,(FDRV+1)
000F79 DCDD FE20             7      CP  020H
000F7B DCDF C8              11      RET Z
000F7C DCE0 1839            12      JR  SETDIR1
                                
       DCE2                     FILE:
000F7E DCE2 AF               4      XOR A
000F7F DCE3 3214EF          13      LD  (FDRV),A
000F82 DCE6 67               4      LD  H,A
000F83 DCE7 6F               4      LD  L,A
000F84 DCE8 2222EF          16      LD  (FDRV+14),HL
000F87 DCEB CDB9DD          17      CALL    SPCUT
000F8A DCEE CD9EDD          17      CALL    CCHK3
000F8D DCF1 2812            12      JR  Z,DEVI1
000F8F DCF3 13               6      INC DE
000F90 DCF4 1A               7      LD  A,(DE)
000F91 DCF5 1B               6      DEC DE
000F92 DCF6 FE3A             7      CP  ':'
000F94 DCF8 200B            12      JR  NZ,DEVI1
000F96 DCFA 1A               7      LD  A,(DE)      ;DRIVE
000F97 DCFB CDEEDF          17      CALL    CAP
000F9A DCFE D640             7      SUB '@'
000F9C DD00 13               6      INC DE
000F9D DD01 13               6      INC DE
000F9E DD02 3214EF          13      LD  (FDRV),A
       DD05                     DEVI1:
000FA1 DD05 1A               7      LD  A,(DE)
000FA2 DD06 D65C             7      SUB 05CH        ;\
000FA4 DD08 2009            12      JR  NZ,NOROOT
000FA6 DD0A 6F               4      LD  L,A     ;A=0でH=0のはずなのでHL=0
000FA7 DD0B 222EEF          16      LD  (FDRV+26),HL
000FAA DD0E 2C               4      INC L
000FAB DD0F 2222EF          16      LD  (FDRV+14),HL
000FAE DD12 13               6      INC DE
       DD13                     NOROOT:
                                
       DD13                     SETDIR:
000FAF DD13 CD3FDD          17      CALL    FILED
000FB2 DD16 1A               7      LD  A,(DE)
000FB3 DD17 FE5C             7      CP  05CH        ;\
000FB5 DD19 C0              11      RET NZ
000FB6 DD1A 13               6      INC DE
       DD1B                     SETDIR1:
000FB7 DD1B 3E10             7      LD  A,010H      ;Directory
000FB9 DD1D 3221EF          13      LD  (FDRV+13),A
000FBC DD20 D5              11      PUSH    DE
000FBD DD21 1114EF          10      LD  DE,FDRV
000FC0 DD24 2A1EF0          16      LD  HL,(STABLE+2*00FH)
000FC3 DD27 CD0F00          17      CALL    JP_HL
000FC6 DD2A D1              10      POP DE
000FC7 DD2B B7               4      OR  A
000FC8 DD2C C0              11      RET NZ
                                
000FC9 DD2D 3A21EF          13      LD  A,(FDRV+13)
000FCC DD30 CB67             8      BIT 4,A
000FCE DD32 C8              11      RET Z
                                
000FCF DD33 CD86DD          17      CALL    FILEI
000FD2 DD36 2A2EEF          16      LD  HL,(FDRV+26)
000FD5 DD39 23               6      INC HL
000FD6 DD3A 2222EF          16      LD  (FDRV+14),HL
000FD9 DD3D 18D4            12      JR  SETDIR
                                
       DD3F                     FILED:
000FDB DD3F CD86DD          17      CALL    FILEI
000FDE DD42 2115EF          10      LD  HL,FNAME
                                
000FE1 DD45 0608             7      LD  B,8
       DD47                     FILE2:
000FE3 DD47 CD93DD          17      CALL    CCHKF
000FE6 DD4A C8              11      RET Z
000FE7 DD4B FE2A             7      CP  '*'
000FE9 DD4D 282E            12      JR  Z,FILE9
000FEB DD4F FE2E             7      CP  '.'
000FED DD51 280C            12      JR  Z,FILE4
000FEF DD53 77               7      LD  (HL),A
000FF0 DD54 23               6      INC HL
000FF1 DD55 10F0            13      DJNZ    FILE2
                                
       DD57                     FILE3:
000FF3 DD57 CD93DD          17      CALL    CCHKF
000FF6 DD5A C8              11      RET Z
000FF7 DD5B FE2E             7      CP  '.'
000FF9 DD5D 20F8            12      JR  NZ,FILE3
                                
       DD5F                     FILE4:
000FFB DD5F 211DEF          10      LD  HL,FNAME+8
000FFE DD62 0603             7      LD  B,3
                                
       DD64                     FILE4L:
001000 DD64 CD93DD          17      CALL    CCHKF
001003 DD67 C8              11      RET Z
001004 DD68 FE2E             7      CP  '.'
001006 DD6A 2008            12      JR  NZ,FILE12
001008 DD6C 3215EF          13      LD  (FNAME),A   ;Parent directory(..)
00100B DD6F 3216EF          13      LD  (FNAME+1),A
00100E DD72 3E20             7      LD  A,020H
       DD74                     FILE12:
001010 DD74 FE2A             7      CP  '*'
001012 DD76 280A            12      JR  Z,FILE10
001014 DD78 77               7      LD  (HL),A
001015 DD79 23               6      INC HL
001016 DD7A 10E8            13      DJNZ    FILE4L
001018 DD7C C9              10      RET
                                
       DD7D                     FILE9:              ;名前の*処理、名前の残りを?で埋める
001019 DD7D CD82DD          17      CALL    FILE10
00101C DD80 18D5            12      JR  FILE3
                                
       DD82                     FILE10:
00101E DD82 3E3F             7      LD  A,'?'
001020 DD84 1808            12      JR  FILL_MEMORY
       DD86                     FILEI:              ;名前＋拡張子をスペースで初期化
001022 DD86 3E20             7      LD  A,020H
001024 DD88 01000B          10      LD  BC,11*256   ;C=0にしておく
001027 DD8B 2115EF          10      LD  HL,FNAME
       DD8E                     FILL_MEMORY:            ;HLからBバイトAで埋める
00102A DD8E 77               7      LD  (HL),A
00102B DD8F 23               6      INC HL
00102C DD90 10FC            13      DJNZ    FILL_MEMORY
00102E DD92 C9              10      RET
                                
       DD93                     CCHKF:
00102F DD93 1A               7      LD  A,(DE)
001030 DD94 CD9BDD          17      CALL    CCHK2
001033 DD97 C8              11      RET Z
001034 DD98 C306E1          10      JP  FKAN
                                
       DD9B                     CCHK2:
001037 DD9B 0C               4      INC C
001038 DD9C 0D               4      DEC C
001039 DD9D C0              11      RET NZ
       DD9E                     CCHK3:              ;ZF=1 で使えない文字
00103A DD9E FE2B             7      CP  '+'
00103C DDA0 C8              11      RET Z
00103D DDA1 FE2C             7      CP  ','
00103F DDA3 C8              11      RET Z
001040 DDA4 FE2F             7      CP  '/'
001042 DDA6 C8              11      RET Z
001043 DDA7 FE3A             7      CP  ':'
001045 DDA9 C8              11      RET Z
001046 DDAA FE3B             7      CP  ';'
001048 DDAC C8              11      RET Z
001049 DDAD FE3D             7      CP  '='
00104B DDAF C8              11      RET Z
00104C DDB0 FE5C             7      CP  05CH    ;\
00104E DDB2 C8              11      RET Z
00104F DDB3 FE20             7      CP  020H
001051 DDB5 D0              11      RET NC
001052 DDB6 BF               4      CP  A       ;Z=1
001053 DDB7 C9              10      RET
                                
       DDB8                     SS1:
001054 DDB8 13               6      INC DE
       DDB9                     SPCUT:              ;スペースをカット
001055 DDB9 1A               7      LD  A,(DE)
001056 DDBA FE20             7      CP  020H
001058 DDBC 28FA            12      JR  Z,SS1
00105A DDBE C9              10      RET
                                
       DDBF                     SETDRVF:
00105B DDBF 1114EF          10      LD  DE,FDRV
       DDC2                     SETDRV0:
00105E DDC2 CDCBDD          17      CALL    SETDRV
001061 DDC5 FDE1            14      POP IY
001063 DDC7 C1              10      POP BC
001064 DDC8 D1              10      POP DE
001065 DDC9 E1              10      POP HL
001066 DDCA C9              10      RET
                                
       DDCB                     SETDRV:
001067 DDCB E3              19      EX  (SP),HL     ;HL=RETRN ADDRESS
001068 DDCC D5              11      PUSH    DE      ;PUSH HL/DE/BC/IY
001069 DDCD C5              11      PUSH    BC
00106A DDCE 1A               7      LD  A,(DE)
00106B DDCF D5              11      PUSH    DE
00106C DDD0 FDE3            23      EX  (SP),IY
                                
00106E DDD2 CDDEDD          17      CALL    GETDRV
001071 DDD5 3C               4      INC A
001072 DDD6 FD7700          19      LD  (IY+0),A    ;(FCB)ドライブ番号
001075 DDD9 3D               4      DEC A
001076 DDDA CDD9EF          17      CALL    _CHGDRV
                                
001079 DDDD E9               4      JP  (HL)
                                
       DDDE                     GETDRV:
00107A DDDE E67F             7      AND 07FH
00107C DDE0 D601             7      SUB 001H
00107E DDE2 3003            12      JR  NC,GETDRV1
001080 DDE4 3A87EF          13      LD  A,(_DVSW)   ;Current Drive
       DDE7                     GETDRV1:
001083 DDE7 3288EF          13      LD  (_DRV),A
001086 DDEA C9              10      RET
                                
       DDEB                     SOPENX:
001087 DDEB 1139EF          10      LD  DE,SFILE
00108A DDEE 1A               7      LD  A,(DE)
00108B DDEF FDBE00           7      CP  (IY+0)      ;(FCB)ドライブ番号
00108E DDF2 2024            12      JR  NZ,SOPEN
001090 DDF4 13               6      INC DE
001091 DDF5 FDE5            15      PUSH    IY
001093 DDF7 E1              10      POP HL
001094 DDF8 23               6      INC HL
001095 DDF9 CD86DF          17      CALL    CPFILE
001098 DDFC 201A            12      JR  NZ,SOPEN
                                
00109A DDFE 2AF4F0          16      LD  HL,(SCDIR)
00109D DE01 FD750E          19      LD  (IY+14),L   ;(FCB)アクセスするディレクトリのクラスタ番号+1
0010A0 DE04 FD740F          19      LD  (IY+15),H
                                
0010A3 DE07 2AF8F0          16      LD  HL,(SFNDF)  ;Direcroty location and Flags
0010A6 DE0A 229FEF          16      LD  (_FILEN),HL
                                
0010A9 DE0D ED5BF6F0        20      LD  DE,(SFBPS)
0010AD DE11 2139EF          10      LD  HL,SFILE
0010B0 DE14 36FF            10      LD  (HL),0FFH
0010B2 DE16 23               6      INC HL
0010B3 DE17 C9              10      RET
       DE18                     SOPEN:
0010B4 DE18 212EDF          10      LD  HL,FILESE
       DE1B                     SOPENC:
0010B7 DE1B 2254DE          16      LD  (OPENPAT+1),HL
                                
0010BA DE1E CDE2EF          17      CALL    _RDFATX     ;Detect Media
0010BD DE21 3856            12      JR  C,RDDERR
                                
0010BF DE23 AF               4      XOR A
0010C0 DE24 329FEF          13      LD  (_FILEN),A
0010C3 DE27 CD33E0          17      CALL    LDDIRX1     ;A=0で呼び出す
0010C6 DE2A 2818            12      JR  Z,SDIRX1
                                
0010C8 DE2C CD1FDF          17      CALL    READ_DIR    ;Sub Directory
0010CB DE2F 3808            12      JR  C,SDIRX0
0010CD DE31 2A7EF0          16      LD  HL,(_DTBUF)
0010D0 DE34 7E               7      LD  A,(HL)
0010D1 DE35 FE2E             7      CP  '.'
0010D3 DE37 280F            12      JR  Z,SOPEN1
       DE39                     SDIRX0:
0010D5 DE39 AF               4      XOR A
0010D6 DE3A 32A0EF          13      LD  (_DIRF),A
0010D9 DE3D FD360E01        19      LD  (IY+14),1   ;(FCB)レコードサイズ
0010DD DE41 FD770F          19      LD  (IY+15),A
       DE44                     SDIRX1:
0010E0 DE44 ED5BFCF0        20      LD  DE,(_DIRPS) ;Root Directory
       DE48                     SOPEN1:
0010E4 DE48 0E20             7  SDECPAT:LD  C,32        ;自己書き換え 1セクタ辺りのディレクトリエントリ数  1024=32 / 512=16 / 256=8
       DE4A                     SOPEN1X:
0010E6 DE4A CD1FDF          17      CALL    READ_DIR    ;FILE SEARCH
0010E9 DE4D 382A            12      JR  C,RDDERR
0010EB DE4F 2A7EF0          16      LD  HL,(_DTBUF)
       DE52                     SOPEN2:
0010EE DE52 D5              11      PUSH    DE
0010EF DE53 CD2EDF          17  OPENPAT:CALL    FILESE      ;(self-modifying code)
0010F2 DE56 D1              10      POP DE
0010F3 DE57 386E            12      JR  C,SOPENE
0010F5 DE59 281B            12      JR  Z,SCF_FF_RET
       DE5B                     SOPEN3:
0010F7 DE5B 3AA0EF          13      LD  A,(_DIRF)   ;ディレクトリか判別
0010FA DE5E B7               4      OR  A
0010FB DE5F 200C            12      JR  NZ,SOPEN5
0010FD DE61 13               6      INC DE      ;ルートディレクトリ
0010FE DE62 E5              11      PUSH    HL
0010FF DE63 210C00          10  MD_PAT: LD  HL,12       ;(self-modifying code)MAXDIR
001102 DE66 ED52            15      SBC HL,DE       ;CF=0 なので SUB HL,DE
001104 DE68 E1              10      POP HL
001105 DE69 20DD            12      JR  NZ,SOPEN1
001107 DE6B 1807            12      JR  SOPEN6
       DE6D                     SOPEN5:
001109 DE6D CD62E7          17      CALL    GNCLX       ;END DIR
00110C DE70 D8              11      RET C
00110D DE71 CDE6DF          17      CALL    ENDCL
       DE74                     SOPEN6:
001110 DE74 38D2            12      JR  C,SOPEN1
       DE76                     SCF_FF_RET:
001112 DE76 37               4      SCF         ;CF=1
001113 DE77 9F               4      SBC A,A     ;A=0FFH
001114 DE78 C9              10      RET
                                
       DE79                     RDDERR:
001115 DE79 BF               4      CP  A       ;READ ERR CF=1 ZF=1
001116 DE7A 37               4      SCF
001117 DE7B C9              10      RET
                                
       DE7C                     NOPEN:
001118 DE7C 212EDF          10      LD  HL,FILESE
00111B DE7F 2254DE          16      LD  (OPENPAT+1),HL
00111E DE82 FD2A98EF        20      LD  IY,(_FCB)
001122 DE86 CD19E1          17      CALL    CHKWILDX
001125 DE89 30EB            12      JR  NC,SCF_FF_RET
001127 DE8B FD7E00          19      LD  A,(IY+0)    ;(FCB)ドライブ番号
00112A DE8E 3D               4      DEC A
00112B DE8F 3288EF          13      LD  (_DRV),A
00112E DE92 CDD9EF          17      CALL    _CHGDRV
001131 DE95 D8              11      RET C
001132 DE96 2AF8F0          16      LD  HL,(SFNDF)  ;Direcroty location and Flags
001135 DE99 229FEF          16      LD  (_FILEN),HL
                                
001138 DE9C CD2EE0          17      CALL    LDDIRX
00113B DE9F ED5B9AEF        20      LD  DE,(_FBPS)
00113F DEA3 CD1FDF          17      CALL    READ_DIR
001142 DEA6 38D1            12      JR  C,RDDERR
001144 DEA8 3A9EEF          13      LD  A,(_FBCNT)
001147 DEAB 3D               4      DEC A
001148 DEAC 28AD            12      JR  Z,SOPEN3
       DEAE                     NOPEN2:
00114A DEAE 2A9CEF          16      LD  HL,(_FBAD)
00114D DEB1 012000          10      LD  BC,020H
001150 DEB4 09              11      ADD HL,BC
001151 DEB5 4F               4      LD  C,A
001152 DEB6 189A            12      JR  SOPEN2
                                
       DEB8                     SOPENE2:
001154 DEB8 229CEF          16      LD  (_FBAD),HL
001157 DEBB 79               4      LD  A,C
001158 DEBC 329EEF          13      LD  (_FBCNT),A
00115B DEBF ED539AEF        20      LD  (_FBPS),DE
00115F DEC3 FD2298EF        20      LD  (_FCB),IY
       DEC7                     SOPENE:
001163 DEC7 AF               4      XOR A
001164 DEC8 C9              10      RET
                                
       DEC9                     COPEN:
001165 DEC9 FD360D20        19      LD  (IY+13),020H    ;(FCB)属性(アトリビュート)
                                
001169 DECD 214BDF          10      LD  HL,NEXTSE
00116C DED0 CD1BDE          17      CALL    SOPENC
00116F DED3 D0              11      RET NC
001170 DED4 C8              11      RET Z
001171 DED5 3AA0EF          13      LD  A,(_DIRF)   ;ディレクトリか判別
001174 DED8 B7               4      OR  A
001175 DED9 37               4      SCF
001176 DEDA C8              11      RET Z       ;ルートディレクトリ
001177 DEDB 0601             7      LD  B,1
001179 DEDD CD77E1          17      CALL    WRDF
00117C DEE0 D8              11      RET C
00117D DEE1 ED5BFEF0        20      LD  DE,(_CLPS)
001181 DEE5 D5              11      PUSH    DE
001182 DEE6 CDAFDF          17      CALL    DCPAT
001185 DEE9 CDEDE5          17      CALL    DRDNX
001188 DEEC 2A7EF0          16      LD  HL,(_DTBUF) ;ディレクトリエントリを0クリア
00118B DEEF 3AEBE4          13      LD  A,(SECSZ+2) ;1024=4 / 512=2 / 256=1
00118E DEF2 47               4      LD  B,A
00118F DEF3 AF               4      XOR A
001190 DEF4 4F               4      LD  C,A
       DEF5                     COPENCL:
001191 DEF5 77               7      LD  (HL),A
001192 DEF6 EDA1            16      CPI         ;HL=HL+1 BC=BC-1 BCが0の場合にP/V=0
001194 DEF8 EAF5DE          10      JP  PE,COPENCL
                                
001197 DEFB 3ACDDF          13      LD  A,(SPCPAT+1)    ;1クラスタの論理セクタ数
00119A DEFE 3D               4      DEC A
00119B DEFF 2819            12      JR  Z,COPENE
00119D DF01 3E01             7      LD  A,1     ;1セクタ辺りのセクタ数が2以上の場合
00119F DF03 325AE7          13      LD  (_SECPS+1),A
0011A2 DF06 D1              10      POP DE      ;DE=(_CLPS)
0011A3 DF07 D5              11      PUSH    DE
       DF08                     COPEN1:
0011A4 DF08 D5              11      PUSH    DE      ;データバッファに入らないセクタもゼロクリア
0011A5 DF09 C5              11      PUSH    BC
0011A6 DF0A 2A7EF0          16      LD  HL,(_DTBUF)
0011A9 DF0D CDC9DF          17      CALL    CLUSTX
0011AC DF10 CDC5E8          17      CALL    DWT24
0011AF DF13 C1              10      POP BC
0011B0 DF14 D1              10      POP DE
0011B1 DF15 CD59E7          17      CALL    NEXTX
0011B4 DF18 20EE            12      JR  NZ,COPEN1
       DF1A                     COPENE:
0011B6 DF1A 2A7EF0          16      LD  HL,(_DTBUF)
0011B9 DF1D D1              10      POP DE
0011BA DF1E C9              10      RET
                                
       DF1F                     READ_DIR:
0011BB DF1F ED53FEF0        20      LD  (_CLPS),DE
0011BF DF23 C5              11      PUSH    BC
0011C0 DF24 D5              11      PUSH    DE
0011C1 DF25 CDAFDF          17      CALL    DCPAT
0011C4 DF28 CDCDE5          17      CALL    DRDX
0011C7 DF2B D1              10      POP DE
0011C8 DF2C C1              10      POP BC
0011C9 DF2D C9              10      RET
                                
       DF2E                     FILESE:
0011CA DF2E 7E               7      LD  A,(HL)
0011CB DF2F B7               4      OR  A
0011CC DF30 C8              11      RET Z       ;END:ZF=1 CF=0
0011CD DF31 FEE5             7      CP  0E5H
0011CF DF33 280E            12      JR  Z,FILESE1
0011D1 DF35 FDE5            15      PUSH    IY
0011D3 DF37 D1              10      POP DE
0011D4 DF38 13               6      INC DE
0011D5 DF39 E5              11      PUSH    HL
0011D6 DF3A CD86DF          17      CALL    CPFILE
0011D9 DF3D CCA7DF          17      CALL    Z,CPFILE2
0011DC DF40 E1              10      POP HL
0011DD DF41 37               4      SCF
0011DE DF42 C8              11      RET Z       ;!!!:(ZF=1) CF=1
       DF43                     FILESE1:
0011DF DF43 CD5ADF          17      CALL    FNEXT
0011E2 DF46 20E6            12      JR  NZ,FILESE
       DF48                     ZF0_CF0_AFF_RET:
0011E4 DF48 F6FF             7      OR  0FFH        ;ZF=0 CF=0
0011E6 DF4A C9              10      RET
                                
       DF4B                     NEXTSE:
0011E7 DF4B 7E               7      LD  A,(HL)
0011E8 DF4C B7               4      OR  A
0011E9 DF4D 37               4      SCF
0011EA DF4E C8              11      RET Z       ;!!!:ZF=1 CF=1
0011EB DF4F FEE5             7      CP  0E5H
0011ED DF51 37               4      SCF
0011EE DF52 C8              11      RET Z       ;!!!:(ZF=1) CF=1
0011EF DF53 CD5ADF          17      CALL    FNEXT
0011F2 DF56 20F3            12      JR  NZ,NEXTSE
0011F4 DF58 18EE            12      JR  ZF0_CF0_AFF_RET
                                
       DF5A                     FNEXT:
0011F6 DF5A E5              11      PUSH    HL
0011F7 DF5B 219FEF          10      LD  HL,_FILEN
0011FA DF5E 34              11      INC (HL)
0011FB DF5F E1              10      POP HL
0011FC DF60 112000          10      LD  DE,020H
0011FF DF63 19              11      ADD HL,DE
001200 DF64 0D               4      DEC C
001201 DF65 C9              10      RET
                                
       DF66                     CPNAME:
001202 DF66 C5              11      PUSH    BC
001203 DF67 D5              11      PUSH    DE
001204 DF68 E5              11      PUSH    HL
001205 DF69 CD80DF          17      CALL    CPFILE4
001208 DF6C E1              10      POP HL
001209 DF6D 23               6      INC HL
00120A DF6E 23               6      INC HL
00120B DF6F 23               6      INC HL
00120C DF70 23               6      INC HL
00120D DF71 D1              10      POP DE
00120E DF72 C1              10      POP BC
00120F DF73 2005            12      JR  NZ,CPNAME1
001211 DF75 7E               7      LD  A,(HL)
001212 DF76 23               6      INC HL
001213 DF77 66               7      LD  H,(HL)
001214 DF78 6F               4      LD  L,A
001215 DF79 C9              10      RET
       DF7A                     CPNAME1:
001216 DF7A 23               6      INC HL
001217 DF7B 23               6      INC HL
001218 DF7C 10E8            13      DJNZ    CPNAME
00121A DF7E 37               4      SCF
00121B DF7F C9              10      RET
                                
       DF80                     CPFILE4:
00121C DF80 C5              11      PUSH    BC
00121D DF81 010004          10      LD  BC,00400H
001220 DF84 1804            12      JR  CPSTR1
       DF86                     CPFILE:
001222 DF86 C5              11      PUSH    BC
001223 DF87 01000B          10      LD  BC,00B00H
       DF8A                     CPSTR1:
001226 DF8A 1A               7      LD  A,(DE)
001227 DF8B FE3F             7      CP  '?'     ;Wild card
001229 DF8D 2812            12      JR  Z,CPSTR2
00122B DF8F 7E               7      LD  A,(HL)
00122C DF90 CDFFE0          17      CALL    FKANC
00122F DF93 E5              11      PUSH    HL
001230 DF94 67               4      LD  H,A
001231 DF95 1A               7      LD  A,(DE)
001232 DF96 CB01             4      RLC C
001234 DF98 CDFFE0          17      CALL    FKANC
001237 DF9B CB09             4      RRC C
001239 DF9D BC               4      CP  H       ;CP (HL),(DE)
00123A DF9E E1              10      POP HL
00123B DF9F 2004            12      JR  NZ,CPSTR3
       DFA1                     CPSTR2:
00123D DFA1 13               6      INC DE
00123E DFA2 23               6      INC HL
00123F DFA3 10E5            13      DJNZ    CPSTR1
       DFA5                     CPSTR3:
001241 DFA5 C1              10      POP BC
001242 DFA6 C9              10      RET
                                
       DFA7                     CPFILE2:
001243 DFA7 FD7E0D          19      LD  A,(IY+13)   ;(FCB)属性(アトリビュート)
001246 DFAA F6E1             7      OR  0E1H
001248 DFAC 2F               4      CPL
001249 DFAD A6               7      AND (HL)
00124A DFAE C9              10      RET
                                
       DFAF                     DCPAT:
00124B DFAF 0E00             7      LD  C,0
00124D DFB1 2A7EF0          16      LD  HL,(_DTBUF)
001250 DFB4 3AA0EF          13      LD  A,(_DIRF)   ;ディレクトリか判別
001253 DFB7 B7               4      OR  A
001254 DFB8 C8              11      RET Z       ;ルートディレクトリの場合はCレジスタを0にしておく(CDEがセクタ番号)
001255 DFB9 3ACDDF          13      LD  A,(SPCPAT+1)
001258 DFBC 4F               4      LD  C,A
001259 DFBD 3A5AE7          13      LD  A,(_SECPS+1)
00125C DFC0 B9               4      CP  C
00125D DFC1 3801            12      JR  C,DC1
00125F DFC3 AF               4      XOR A
       DFC4                     DC1:
001260 DFC4 F680             7      OR  080H
001262 DFC6 32A0EF          13      LD  (_DIRF),A   ;bit0-6:セクタインデックス
       DFC9                     CLUSTX:
001265 DFC9 E5              11      PUSH    HL
001266 DFCA EB               4      EX  DE,HL
001267 DFCB AF               4      XOR A
001268 DFCC 0E01             7  SPCPAT: LD  C,1     ;自己書き換え（1クラスタの論理セクタ数）
       DFCE                     L_CLDBL:
00126A DFCE CB19             8      RR  C       ;->CF
00126C DFD0 3804            12      JR  C,E_CLDBL
00126E DFD2 29              11      ADD HL,HL       ;*2
00126F DFD3 8F               4      ADC A,A
001270 DFD4 18F8            12      JR  L_CLDBL
       DFD6                     E_CLDBL:
001272 DFD6 4F               4      LD  C,A
001273 DFD7 3A5AE7          13      LD  A,(_SECPS+1)
001276 DFDA B5               4      OR  L
001277 DFDB 6F               4      LD  L,A
001278 DFDC 110800          10  CLSPAT: LD  DE,8    ;+8 (2D)  !ADDCL (self-modifying code)
00127B DFDF AF               4      XOR A
00127C DFE0 19              11      ADD HL,DE   ;データ格納領域の先頭論理セクタ番号
00127D DFE1 89               4      ADC A,C
00127E DFE2 4F               4      LD  C,A
00127F DFE3 EB               4      EX  DE,HL
001280 DFE4 E1              10      POP HL
001281 DFE5 C9              10      RET
                                
       DFE6                     ENDCL:
001282 DFE6 7A               4      LD  A,D ;END CLUSTER
001283 DFE7 FE01             7  CLPAT1: CP  1   ;164=356    (self-modifying code)
001285 DFE9 C0              11      RET NZ
001286 DFEA 7B               4      LD  A,E
001287 DFEB FE64             7  CLPAT2: CP  064H    ;       (self-modifying code)
001289 DFED C9              10      RET
                                
       DFEE                     CAP:
00128A DFEE FE61             7      CP  'a'
00128C DFF0 D8              11      RET C
00128D DFF1 FE7B             7      CP  'z'+1
00128F DFF3 D0              11      RET NC
001290 DFF4 D620             7      SUB 020H
001292 DFF6 C9              10      RET
       DFF7                     CAP2:
001293 DFF7 CDEEDF          17      CALL    CAP
       DFFA                     CAP3:
001296 DFFA CD03E0          17      CALL    CAP4
001299 DFFD FE21             7      CP  021H
00129B DFFF D0              11      RET NC
00129C E000 3EA0             7      LD  A,0A0H
00129E E002 C9              10      RET
       E003                     CAP4:
00129F E003 FE05             7      CP  5
0012A1 E005 C0              11      RET NZ
0012A2 E006 3EE5             7      LD  A,0E5H
0012A4 E008 C9              10      RET
                                
       E009                     CHDIR:
0012A5 E009 CDF4E9          17      CALL    GETDPBD
0012A8 E00C 381D            12      JR  C,CHDIR2
0012AA E00E DD751A          19      LD  (IX+01AH),L     ;_SDIR_
0012AD E011 DD741B          19      LD  (IX+01BH),H     ;_SDIR_+1
0012B0 E014 1815            12      JR  CHDIR2      ;POP_IX_RET
                                
       E016                     LDDIR:
0012B2 E016 CDF4E9          17      CALL    GETDPBD
0012B5 E019 DD5E1A          19      LD  E,(IX+01AH)     ;_SDIR_
0012B8 E01C DD561B          19      LD  D,(IX+01BH)     ;_SDIR_+1
0012BB E01F 13               6      INC DE
0012BC E020 FD730E          19      LD  (IY+14),E   ;(FCB)アクセスするディレクトリのクラスタ番号+1
0012BF E023 FD720F          19      LD  (IY+15),D
0012C2 E026 1B               6      DEC DE
0012C3 E027 AF               4      XOR A
0012C4 E028 32A0EF          13      LD  (_DIRF),A
       E02B                     CHDIR2:
0012C7 E02B DDE1            14      POP IX
0012C9 E02D C9              10      RET
                                
       E02E                     LDDIRX:
0012CA E02E 3AA0EF          13      LD  A,(_DIRF)   ;(FCB)アクセスするディレクトリのセクタインデックス
0012CD E031 E67F             7      AND 07FH
       E033                     LDDIRX1:
0012CF E033 325AE7          13      LD  (_SECPS+1),A
0012D2 E036 FD5E0E          19      LD  E,(IY+14)   ;(FCB)アクセスするディレクトリのクラスタ番号+1
0012D5 E039 FD560F          19      LD  D,(IY+15)
0012D8 E03C 1B               6      DEC DE
0012D9 E03D CDE6DF          17      CALL    ENDCL
0012DC E040 D416E0          17      CALL    NC,LDDIR
       E043                     LDDIRS:
0012DF E043 7A               4      LD  A,D
0012E0 E044 B3               4      OR  E
0012E1 E045 32A0EF          13      LD  (_DIRF),A   ;ディレクトリか判別
0012E4 E048 C9              10      RET
                                
       E049                     KILL:
0012E5 E049 CD19E1          17      CALL    CHKWILDX
0012E8 E04C 3834            12      JR  C,KILLW
0012EA E04E CDEBDD          17      CALL    SOPENX
       E051                     KILLS:
0012ED E051 3E1F             7      LD  A,01FH
0012EF E053 D495E0          17      CALL    NC,CHKATT
0012F2 E056 D8              11      RET C
       E057                     KILLSX:
0012F3 E057 36E5            10      LD  (HL),0E5H   ;DIR
0012F5 E059 CDF3E0          17      CALL    WTDB
0012F8 E05C 111A00          10      LD  DE,01AH
0012FB E05F 19              11      ADD HL,DE
0012FC E060 5E               7      LD  E,(HL)
0012FD E061 23               6      INC HL
0012FE E062 56               7      LD  D,(HL)
       E063                     KILLS1:
0012FF E063 CDE6DF          17      CALL    ENDCL
001302 E066 D0              11      RET NC      ;CF=0
001303 E067 21FEFF          10      LD  HL,0-2
001306 E06A 19              11      ADD HL,DE
001307 E06B D0              11      RET NC      ;DE= 0 or 1
001308 E06C D5              11      PUSH    DE
001309 E06D CDF7EF          17      CALL    _GNCL
00130C E070 ED53FEF0        20      LD  (_CLPS),DE
001310 E074 D1              10      POP DE
001311 E075 210000          10      LD  HL,0
001314 E078 D4FAEF          17      CALL    NC,_SNCL
001317 E07B D8              11      RET C
001318 E07C ED5BFEF0        20      LD  DE,(_CLPS)  ;FAT
00131C E080 18E1            12      JR  KILLS1
                                
       E082                     KILLW:
00131E E082 CD18DE          17      CALL    SOPEN
       E085                     KILLW1:
001321 E085 380B            12      JR  C,KILLW2
001323 E087 CDB8DE          17      CALL    SOPENE2
001326 E08A CD51E0          17      CALL    KILLS
001329 E08D CD7CDE          17      CALL    NOPEN
00132C E090 18F3            12      JR  KILLW1
       E092                     KILLW2:
00132E E092 C8              11      RET Z
00132F E093 3F               4      CCF
001330 E094 C9              10      RET
                                
       E095                     CHKATT:
001331 E095 E5              11      PUSH    HL
001332 E096 110B00          10      LD  DE,00BH
001335 E099 19              11      ADD HL,DE
001336 E09A A6               7      AND (HL)
001337 E09B E1              10      POP HL
001338 E09C C8              11      RET Z
001339 E09D 37               4      SCF
00133A E09E C9              10      RET
                                
       E09F                     NAME:
00133B E09F CD19E1          17      CALL    CHKWILDX
00133E E0A2 D8              11      RET C
00133F E0A3 110400          10      LD  DE,4
001342 E0A6 19              11      ADD HL,DE
001343 E0A7 22BFE0          16      LD  (NAMEP+2),HL
001346 E0AA 23               6      INC HL
001347 E0AB CD1DE1          17      CALL    CHKWILD
00134A E0AE D8              11      RET C
                                
00134B E0AF CDEBDD          17      CALL    SOPENX
00134E E0B2 3E0F             7      LD  A,00FH
001350 E0B4 D495E0          17      CALL    NC,CHKATT
001353 E0B7 D8              11      RET C
                                
001354 E0B8 FD7E00          19      LD  A,(IY+0)
001357 E0BB FDE5            15      PUSH    IY
001359 E0BD FD210000        14  NAMEP:  LD  IY,0        ;自己書き換え
00135D E0C1 FD7700          19      LD  (IY+0),A
001360 E0C4 CDEBDD          17      CALL    SOPENX
001363 E0C7 FDE3            23      EX  (SP),IY
001365 E0C9 3F               4      CCF
001366 E0CA D418DE          17      CALL    NC,SOPEN
001369 E0CD EB               4      EX  DE,HL
00136A E0CE E1              10      POP HL
00136B E0CF D8              11      RET C
                                
       E0D0                     SETNAME:
00136C E0D0 01000B          10      LD  BC,11*256
00136F E0D3 23               6      INC HL
001370 E0D4 7E               7      LD  A,(HL)
001371 E0D5 FEE5             7      CP  0E5H
001373 E0D7 2004            12      JR  NZ,SNAME1
001375 E0D9 3E05             7      LD  A,5
001377 E0DB 180E            12      JR  SNAME3
       E0DD                     SNAME1:
001379 E0DD 7E               7      LD  A,(HL)
00137A E0DE 0C               4      INC C
00137B E0DF 0D               4      DEC C
00137C E0E0 2009            12      JR  NZ,SNAME3
00137E E0E2 CDEEDF          17      CALL    CAP
001381 E0E5 FEA0             7      CP  0A0H
001383 E0E7 2002            12      JR  NZ,SNAME3
001385 E0E9 3E20             7      LD  A,020H
       E0EB                     SNAME3:
001387 E0EB 12               7      LD  (DE),A
001388 E0EC 7E               7      LD  A,(HL)
001389 E0ED 23               6      INC HL
00138A E0EE CD06E1          17      CALL    FKAN
00138D E0F1 10EA            13      DJNZ    SNAME1
       E0F3                     WTDB:
00138F E0F3 3EFF             7      LD  A,0FFH
001391 E0F5 3239EF          13      LD  (SFILE),A
       E0F8                     SWTDBF:
001394 E0F8 3E01             7      LD  A,1
001396 E0FA 32A4EF          13      LD  (_WTDBF),A
001399 E0FD AF               4      XOR A
00139A E0FE C9              10      RET
                                
       E0FF                     FKANC:
00139B E0FF CB41             8      BIT 0,C
00139D E101 CCF7DF          17      CALL    Z,CAP2
0013A0 E104 1801            12      JR  FKANX
       E106                     FKAN:           ;漢字チェック
0013A2 E106 13               6      INC DE
       E107                     FKANX:
0013A3 E107 CB41             8      BIT 0,C
0013A5 E109 CB81             8      RES 0,C
0013A7 E10B C0              11      RET NZ
0013A8 E10C FE80             7      CP  080H
0013AA E10E D8              11      RET C
0013AB E10F FEA0             7      CP  0A0H
0013AD E111 3803            12      JR  C,FKAN1
0013AF E113 FEE0             7      CP  0E0H
0013B1 E115 D8              11      RET C
       E116                     FKAN1:
0013B2 E116 0C               4      INC C
0013B3 E117 A7               4      AND A
0013B4 E118 C9              10      RET
                                
       E119                     CHKWILDX:
0013B5 E119 FDE5            15      PUSH    IY
0013B7 E11B E1              10      POP HL
0013B8 E11C 23               6      INC HL
       E11D                     CHKWILD:
0013B9 E11D 060B             7      LD  B,11
0013BB E11F 3E3F             7      LD  A,'?'
       E121                     CHKWIL1:
0013BD E121 BE               7      CP  (HL)
0013BE E122 23               6      INC HL
0013BF E123 37               4      SCF
0013C0 E124 C8              11      RET Z
0013C1 E125 10FA            13      DJNZ    CHKWIL1
0013C3 E127 AF               4      XOR A
0013C4 E128 C9              10      RET
                                
       E129                     SDIRENT:        ;IY=FCB HL=DIR
0013C5 E129 D5              11      PUSH    DE
0013C6 E12A E5              11      PUSH    HL
0013C7 E12B FDE5            15      PUSH    IY
0013C9 E12D D1              10      POP DE
0013CA E12E EB               4      EX  DE,HL
0013CB E12F CDD0E0          17      CALL    SETNAME
                                ;               Attribute
0013CE E132 FD7E0D          19      LD  A,(IY+13)   ;(FCB)属性(アトリビュート)
0013D1 E135 12               7      LD  (DE),A
0013D2 E136 13               6      INC DE
                                ;               Reserved
0013D3 E137 AF               4      XOR A
0013D4 E138 060A             7      LD  B,10
       E13A                     SDE1:
0013D6 E13A 12               7      LD  (DE),A
0013D7 E13B 13               6      INC DE
0013D8 E13C 10FC            13      DJNZ    SDE1
                                                    ;(FCB)更新時刻
0013DA E13E 21EAF0          10      LD  HL,SDDATA       ;(FCB)更新年月日
0013DD E141 060A             7      LD  B,SDDATAE-SDDATA    ;(FCB)ファイルの先頭クラスタ
       E143                     SDLOOP:                 ;(FCB)ファイルのサイズ(バイト単位)
0013DF E143 7E               7      LD  A,(HL)
0013E0 E144 23               6      INC HL
0013E1 E145 324AE1          13      LD  (SDPAT+2),A
0013E4 E148 FD7E00          19  SDPAT:  LD  A,(IY+0)    ;LD A,(IY+A)
0013E7 E14B 12               7      LD  (DE),A
0013E8 E14C 13               6      INC DE
0013E9 E14D 10F4            13      DJNZ    SDLOOP
                                
0013EB E14F AF               4      XOR A
0013EC E150 E1              10      POP HL
0013ED E151 D1              10      POP DE
0013EE E152 C9              10      RET
                                
       E153                     WOPEN:
0013EF E153 FD7E0D          19      LD  A,(IY+13)   ;(FCB)属性(アトリビュート)
0013F2 E156 E61F             7      AND 01FH
0013F4 E158 37               4      SCF
0013F5 E159 C0              11      RET NZ
0013F6 E15A FD361CFE        19      LD  (IY+28),0FEH    ;(FCB)オープンモード
       E15E                     TOPEN2:
0013FA E15E AF               4      XOR A
       E15F                     TOPEN:              ;Initializes the time stamp
0013FB E15F FD3617FF        19      LD  (IY+23),0FFH    ;(FCB)更新時刻
0013FF E163 C9              10      RET
                                
       E164                     WRDFX:
001400 E164 3ACDDF          13      LD  A,(SPCPAT+1)    ;1クラスタの論理セクタ
       E167                     L_WRFX:
001403 E167 1F               4      RRA         ;->CF
001404 E168 3806            12      JR  C,E_WRFX
001406 E16A CB39             8      SRL C
001408 E16C CB1C             8      RR  H       ;CH=CH/2
00140A E16E 18F7            12      JR  L_WRFX
       E170                     E_WRFX:
00140C E170 44               4      LD  B,H
00140D E171 04               4      INC B
00140E E172 3E37             7      LD  A,037H      ;SCF
001410 E174 32EAE5          13      LD  (DRDN1),A
                                
       E177                     WRDF:               ;Bクラスタ分FATを確保する
001413 E177 110200          10      LD  DE,2
001416 E17A AF               4      XOR A
001417 E17B 325AE7          13      LD  (_SECPS+1),A
       E17E                     WRDF1:
00141A E17E C5              11      PUSH    BC
00141B E17F D5              11      PUSH    DE
00141C E180 CDF7EF          17      CALL    _GNCL
00141F E183 381C            12      JR  C,WRDF3
001421 E185 7A               4      LD  A,D     ;空いているかチェック
001422 E186 B3               4      OR  E
001423 E187 2027            12      JR  NZ,WRDF4
001425 E189 E1              10      POP HL      ;HL=空いているクラスタ
001426 E18A E5              11      PUSH    HL
001427 E18B ED5BFEF0        20      LD  DE,(_CLPS)  ;DE=元の(_CLPS)
00142B E18F 22FEF0          16      LD  (_CLPS),HL
00142E E192 7A               4      LD  A,D     ;元の(_CLPS)が 0 か?
00142F E193 B3               4      OR  E
001430 E194 2008            12      JR  NZ,WRDF2
001432 E196 FD751A          19      LD  (IY+26),L   ;(FCB)ファイルの先頭クラスタ
001435 E199 FD741B          19      LD  (IY+27),H   ;元が空の場合はFCBにクラスタをセットする
001438 E19C 1803            12      JR  WRDF3
       E19E                     WRDF2:
00143A E19E CDFAEF          17      CALL    _SNCL
       E1A1                     WRDF3:
00143D E1A1 D1              10      POP DE
00143E E1A2 C1              10      POP BC
00143F E1A3 D8              11      RET C
001440 E1A4 100C            13      DJNZ    WRDF5       ;ここでループカウンタチェック
001442 E1A6 ED5BFEF0        20      LD  DE,(_CLPS)
001446 E1AA 21FFFF          10      LD  HL,0FFFFH   ;FATエントリ終了(EOCマーク)
001449 E1AD C3FAEF          10      JP  _SNCL
                                
       E1B0                     WRDF4:              ;DEクラスタが空じゃないので次に移動する
00144C E1B0 D1              10      POP DE
00144D E1B1 C1              10      POP BC
       E1B2                     WRDF5:
00144E E1B2 13               6      INC DE
00144F E1B3 CDE6DF          17      CALL    ENDCL
001452 E1B6 38C6            12      JR  C,WRDF1
001454 E1B8 37               4      SCF
001455 E1B9 C9              10      RET
                                
       E1BA                     RWXR:
001456 E1BA 3AEBE4          13      LD  A,(SECSZ+2) ;1024=4 / 512=2 / 256=1
       E1BD                     L_RWX:
001459 E1BD 1F               4      RRA     ;->CF
00145A E1BE 3808            12      JR  C,E_RWX
00145C E1C0 CB38             8      SRL B   ;BCH=BCH/2
00145E E1C2 CB19             8      RR  C   ;
001460 E1C4 CB1C             8      RR  H   ;
001462 E1C6 18F5            12      JR  L_RWX
       E1C8                     E_RWX:
001464 E1C8 FD5E1A          19      LD  E,(IY+26)   ;(FCB)ファイルの先頭クラスタ
001467 E1CB FD561B          19      LD  D,(IY+27)
00146A E1CE AF               4      XOR A
00146B E1CF 325AE7          13      LD  (_SECPS+1),A
       E1D2                     RWX1:
00146E E1D2 ED53FEF0        20      LD  (_CLPS),DE
001472 E1D6 7A               4      LD  A,D
001473 E1D7 B3               4      OR  E
001474 E1D8 2813            12      JR  Z,SCF_RET   ;RET DE==0 => CF=1
                                
001476 E1DA 78               4      LD  A,B
001477 E1DB B1               4      OR  C
001478 E1DC B4               4      OR  H
001479 E1DD C8              11      RET Z       ;RET BCH==0 => CF=0
                                
00147A E1DE CD62E7          17      CALL    GNCLX
00147D E1E1 D8              11      RET C
00147E E1E2 7C               4      LD  A,H     ;
00147F E1E3 25               4      DEC H       ;
001480 E1E4 B7               4      OR  A       ;DEC BCH
001481 E1E5 2001            12      JR  NZ,RWX2     ;
001483 E1E7 0B               6      DEC BC      ;
       E1E8                     RWX2:
001484 E1E8 CDE6DF          17      CALL    ENDCL
001487 E1EB 38E5            12      JR  C,RWX1
       E1ED                     SCF_RET:
001489 E1ED 37               4      SCF
00148A E1EE C9              10      RET
                                
       E1EF                     DSKF:
00148B E1EF 110000          10  MAXCLP: LD  DE,0
00148E E1F2 2AACEF          16      LD  HL,(_FAKEFREE)
001491 E1F5 7C               4      LD  A,H
001492 E1F6 B5               4      OR  L
001493 E1F7 2803            12      JR  Z,DSKF1
001495 E1F9 110100          10      LD  DE,1
       E1FC                     DSKF1:
001498 E1FC D5              11      PUSH    DE
001499 E1FD CDF7EF          17      CALL    _GNCL
00149C E200 380C            12      JR  C,POPSCF
00149E E202 7A               4      LD  A,D
00149F E203 B3               4      OR  E
0014A0 E204 2001            12      JR  NZ,DSKF2
0014A2 E206 23               6      INC HL
       E207                     DSKF2:
0014A3 E207 D1              10      POP DE
0014A4 E208 1B               6      DEC DE
0014A5 E209 7A               4      LD  A,D
0014A6 E20A B3               4      OR  E
0014A7 E20B 20EF            12      JR  NZ,DSKF1
0014A9 E20D C9              10      RET
                                
       E20E                     POPSCF:
0014AA E20E F1              10      POP AF
0014AB E20F 37               4      SCF
0014AC E210 C9              10      RET
                                
       E211                     SETTMS:
0014AD E211 FD7E17          19      LD  A,(IY+23)   ;(FCB)ファイルを最後に変更した時刻
0014B0 E214 3C               4      INC A
0014B1 E215 C0              11      RET NZ      ;ファイルが更新されていない
       E216                     SETTMSX:            ;FCBに日付時刻をセットする
0014B2 E216 CD48D9          17      CALL    _SYS2C      ;(BDOS)時刻の獲得
                                                ;H←時  L←分  D←秒
0014B5 E219 CB25             8      SLA L       ;   *2
0014B7 E21B CB25             8      SLA L       ;   *4
0014B9 E21D 29              11      ADD HL,HL       ;*2 *8
0014BA E21E 29              11      ADD HL,HL       ;*4 *16
0014BB E21F 29              11      ADD HL,HL       ;*8 *32
0014BC E220 7A               4      LD  A,D
0014BD E221 0F               4      RRCA            ;bit.0->7->->->0->C
0014BE E222 E61F             7      AND 01FH
0014C0 E224 B5               4      OR  L
0014C1 E225 FD7716          19      LD  (IY+22),A   ;(FCB)ファイルを最後に変更した時刻
0014C4 E228 FD7417          19      LD  (IY+23),H
                                
0014C7 E22B CD42D9          17      CALL    _SYS2A      ;(BDOS)日付の獲得
                                                ;HL←年  D←月  E←日
0014CA E22E 0144F8          10      LD  BC,0-1980
0014CD E231 09              11      ADD HL,BC
0014CE E232 65               4      LD  H,L
                                
0014CF E233 7A               4      LD  A,D
0014D0 E234 87               4      ADD A,A     ;*2
0014D1 E235 87               4      ADD A,A     ;*4
0014D2 E236 87               4      ADD A,A     ;*8
0014D3 E237 87               4      ADD A,A     ;*16
0014D4 E238 6F               4      LD  L,A
0014D5 E239 29              11      ADD HL,HL       ;*32
0014D6 E23A 7D               4      LD  A,L
0014D7 E23B B3               4      OR  E
0014D8 E23C FD7714          19      LD  (IY+20),A   ;(FCB)ファイルを最後に変更した日付
0014DB E23F FD7415          19      LD  (IY+21),H
0014DE E242 C9              10      RET
                                
       E243                     PUSHRR:
0014DF E243 32E2E2          13      LD  (SETSEQ_SWC_RND),A
0014E2 E246 22F4E2          16      LD  (SETSEQ_SWC_SEQ_RR),HL
0014E5 E249 CD69E2          17      CALL    GET_RR_AHL
0014E8 E24C 225AEF          16      LD  (HLBUF),HL
0014EB E24F 325CEF          13      LD  (HLBUF+2),A
0014EE E252 C9              10      RET
                                
       E253                     GET_CPM_R_SIZE:     ;バイト単位からCP/Mのレコード単位を求める（1レコード=128バイト）
0014EF E253 87               4      ADD A,A     ;in BHLA => out AHL
0014F0 E254 ED6A            15      ADC HL,HL
0014F2 E256 CB18             8      RR  B
0014F4 E258 B7               4      OR  A
0014F5 E259 78               4      LD  A,B     ;ここでフラグは変化しない
0014F6 E25A C8              11      RET Z
0014F7 E25B 2C               4      INC L       ;INC AHL
0014F8 E25C C0              11      RET NZ      ;
0014F9 E25D 24               4      INC H       ;
0014FA E25E C0              11      RET NZ      ;
0014FB E25F 3C               4      INC A       ;
0014FC E260 C9              10      RET
                                
       E261                     INIT_RND:
0014FD E261 3ECD             7      LD  A,0CDH      ;CALL ????
0014FF E263 21B2E2          10      LD  HL,POPRR
001502 E266 CD43E2          17      CALL    PUSHRR
       E269                     GET_RR_AHL:
001505 E269 FD6E21          19      LD  L,(IY+33)   ;(FCB)Random record
001508 E26C FD6622          19      LD  H,(IY+34)   ;
00150B E26F FD7E23          19      LD  A,(IY+35)   ;
00150E E272 C9              10      RET
       E273                     SET_RR_AHL:
00150F E273 FD7521          19      LD  (IY+33),L   ;(FCB)Random record
001512 E276 FD7422          19      LD  (IY+34),H
001515 E279 FD7723          19      LD  (IY+35),A
001518 E27C C9              10      RET
       E27D                     INIT_SEQ:
001519 E27D 3E01             7      LD  A,1     ;LD BC,????
00151B E27F 21AFE2          10      LD  HL,SETSEQ
00151E E282 CD43E2          17      CALL    PUSHRR
       E285                     GETSEQ:
001521 E285 FD6E20          19      LD  L,(IY+32)   ;(FCB)カレントレコード
001524 E288 FD660C          19      LD  H,(IY+12)   ;(FCB)カレントブロック
001527 E28B AF               4      XOR A
                                
001528 E28C CB25             8      SLA L   ;L=L*2
                                
00152A E28E CB3C             8      SRL H   ;HL=HL/2
00152C E290 CB1D             8      RR  L   ;
00152E E292 C9              10      RET
                                
       E293                     SETSEQ1:
00152F E293 F5              11      PUSH    AF      
001530 E294 E5              11      PUSH    HL      ;AHL=Random record
001531 E295 FD7E21          19      LD  A,(IY+33)   ;(FCB)ランダムレコード
001534 E298 FD6E22          19      LD  L,(IY+34)
001537 E29B FD6623          19      LD  H,(IY+35)
00153A E29E 0600             7      LD  B,0
                                
00153C E2A0 CD53E2          17      CALL    GET_CPM_R_SIZE
                                
00153F E2A3 29              11      ADD HL,HL
001540 E2A4 CB3D             8      SRL L       ;L=L/2
001542 E2A6 FD7520          19      LD  (IY+32),L   ;(FCB)カレントレコード
001545 E2A9 FD740C          19      LD  (IY+12),H   ;(FCB)カレントブロック
001548 E2AC E1              10      POP HL
001549 E2AD F1              10      POP AF
00154A E2AE C9              10      RET
       E2AF                     SETSEQ:
00154B E2AF CD93E2          17      CALL    SETSEQ1
       E2B2                     POPRR:
00154E E2B2 F5              11      PUSH    AF
00154F E2B3 E5              11      PUSH    HL
001550 E2B4 2A5AEF          16      LD  HL,(HLBUF)
001553 E2B7 3A5CEF          13      LD  A,(HLBUF+2)
001556 E2BA CD73E2          17      CALL    SET_RR_AHL
001559 E2BD E1              10      POP HL
00155A E2BE F1              10      POP AF
00155B E2BF C9              10      RET
                                
       E2C0                     RB_WRITE:
00155C E2C0 C5              11      PUSH    BC
00155D E2C1 ED4B4CF0        20      LD  BC,(STABLE+2*026H)  ;(BDOS)ランダムブロック書き込み
001561 E2C5 1805            12      JR  RBRW
       E2C7                     RB_READ:
001563 E2C7 C5              11      PUSH    BC
001564 E2C8 ED4B4EF0        20      LD  BC,(STABLE+2*027H)  ;(BDOS)ランダムブロック読み込み
       E2CC                     RBRW:
001568 E2CC CB3F             8      SRL A   ;AHLA' = HL*128
00156A E2CE CB1C             8      RR  H   ;AHL=AHL/2
00156C E2D0 CB1D             8      RR  L   ;
00156E E2D2 3E00             7      LD  A,0
001570 E2D4 1F               4      RRA     ;A'HLA
001571 E2D5 FD7721          19      LD  (IY+33),A   ;(FCB)ランダムレコード
001574 E2D8 FD7522          19      LD  (IY+34),L
001577 E2DB FD7423          19      LD  (IY+35),H
00157A E2DE 218000          10      LD  HL,128
00157D E2E1 C5              11      PUSH    BC
       E2E2                     SETSEQ_SWC_RND:
00157E E2E2 CD93E2          17      CALL    SETSEQ1
001581 E2E5 C1              10      POP BC
001582 E2E6 FDCB20FE        23      SET 7,(IY+32)   ;(FCB)カレントレコード
001586 E2EA FDE5            15      PUSH    IY
001588 E2EC D1              10      POP DE
001589 E2ED D5              11      PUSH    DE
00158A E2EE CDFCE2          17      CALL    JP_BC
00158D E2F1 FDE1            14      POP IY
       E2F4                     SETSEQ_SWC_SEQ_RR   EQU $+1
00158F E2F3 CDAFE2          17      CALL    SETSEQ
001592 E2F6 FDCB20BE        23      RES 7,(IY+32)   ;(FCB)カレントレコード
                                
001596 E2FA C1              10      POP BC
001597 E2FB C9              10      RET
       E2FC                     JP_BC:
001598 E2FC C5              11      PUSH    BC
001599 E2FD C9              10      RET
                                
       DE76                     _SYS03  EQU SCF_FF_RET  ;(BDOS)外部入力
       DE76                     _SYS2B  EQU SCF_FF_RET  ;(BDOS)日付の設定
       DE76                     _SYS2D  EQU SCF_FF_RET  ;(BDOS)時刻の設定
       DE76                     _SYS39  EQU SCF_FF_RET  ;(BDOS)サブディレクトリの作成
       DE76                     _SYS3A  EQU SCF_FF_RET  ;(BDOS)サブディレクトリの削除
                                
[EOF:LDFILE.ASM:SHIFT_JIS]
                                    INCLUDE "LDFILE2.ASM"
                                
                                ;   LSX-Dodgers FILE2
                                
                                                ;Write random block
       E2FE                     _SYS26:     ;(BDOS)ランダムブロック書き込み
00159A E2FE AF               4      XOR A
00159B E2FF 32EAE5          13      LD  (DRDN1),A   ;NOP
00159E E302 222EE5          16      LD  (LEFT+1),HL ;HL←書き込むレコード数
0015A1 E305 225DEF          16      LD  (LEFTX),HL
0015A4 E308 CDCBDD          17      CALL    SETDRV
                                
0015A7 E30B CD85E4          17      CALL    RBX0
0015AA E30E DAA8E3          10      JP  C,RBWERR
0015AD E311 CD53E1          17      CALL    WOPEN
0015B0 E314 DAA8E3          10      JP  C,RBWERR
0015B3 E317 7C               4      LD  A,H
0015B4 E318 B5               4      OR  L
0015B5 E319 CAA1E3          10      JP  Z,RBW1
                                
0015B8 E31C 2B               6      DEC HL
                                
0015B9 E31D CD50E5          17      CALL    GET_RR_BCDE ;BCDE=Random record
                                
0015BC E320 19              11      ADD HL,DE       ;BCHL=HL+BCDE
0015BD E321 3001            12      JR  NC,S26X1    ;
0015BF E323 03               6      INC BC      ;
       E324                     S26X1:
0015C0 E324 CDBAE1          17      CALL    RWXR
0015C3 E327 DC64E1          17      CALL    C,WRDFX
0015C6 E32A DAA8E3          10      JP  C,RBWERR
                                
0015C9 E32D CDB4E4          17      CALL    RBX2
0015CC E330 281A            12      JR  Z,RBWB      ;NZ=セクタ以下の端数がある
0015CE E332 CDD3E4          17      CALL    RBXA
0015D1 E335 3871            12      JR  C,RBWERR
0015D3 E337 EB               4      EX  DE,HL
0015D4 E338 C5              11      PUSH    BC
0015D5 E339 EDB0                    LDIR
0015D7 E33B 225FEF          16      LD  (DTAX),HL
                                
0015DA E33E CDF8E0          17      CALL    SWTDBF      ;バッファデータは更新された
                                
0015DD E341 2A5DEF          16      LD  HL,(LEFTX)
0015E0 E344 D1              10      POP DE
0015E1 E345 ED52            15      SBC HL,DE
0015E3 E347 225DEF          16      LD  (LEFTX),HL
0015E6 E34A 2833            12      JR  Z,RBWEND
                                
       E34C                     RBWB:
0015E8 E34C CD09E5          17      CALL    RBXB
0015EB E34F 2816            12      JR  Z,RBWC
       E351                     RBWB1:
0015ED E351 C5              11      PUSH    BC
0015EE E352 D5              11      PUSH    DE
0015EF E353 CDC9DF          17      CALL    CLUSTX
0015F2 E356 CD64E5          17      CALL    DWTC
0015F5 E359 D1              10      POP DE
0015F6 E35A C1              10      POP BC
0015F7 E35B 384B            12      JR  C,RBWERR
0015F9 E35D CD62E7          17      CALL    GNCLX
0015FC E360 3846            12      JR  C,RBWERR
0015FE E362 10ED            13      DJNZ    RBWB1
001600 E364 CDB4E5          17      CALL    DRW_FLUSH
       E367                     RBWC:
001603 E367 CD21E5          17      CALL    RBXC
001606 E36A 2813            12      JR  Z,RBWEND
001608 E36C C5              11      PUSH    BC
001609 E36D CDC9DF          17      CALL    CLUSTX
00160C E370 CDE9E5          17      CALL    DRDN
00160F E373 C1              10      POP BC
001610 E374 3832            12      JR  C,RBWERR
001612 E376 ED5B7EF0        20      LD  DE,(_DTBUF)
001616 E37A EDB0                    LDIR
001618 E37C CDF8E0          17      CALL    SWTDBF      ;バッファデータは更新された
       E37F                     RBWEND:
00161B E37F CD2DE5          17      CALL    RBXEND
                                
00161E E382 CD94E4          17      CALL    RBX1
001621 E385 301A            12      JR  NC,RBW1
001623 E387 2A2EE5          16      LD  HL,(LEFT+1)
001626 E38A FD5E10          19      LD  E,(IY+16)   ;(FCB)ファイルのサイズ(バイト単位)
001629 E38D FD5611          19      LD  D,(IY+17)   ;DE=File size
00162C E390 19              11      ADD HL,DE
00162D E391 FD7510          19      LD  (IY+16),L   ;(FCB)ファイルのサイズ(バイト単位)
001630 E394 FD7411          19      LD  (IY+17),H
001633 E397 3008            12      JR  NC,RBW1
001635 E399 FD3412          23      INC (IY+18)
001638 E39C 2003            12      JR  NZ,RBW1
00163A E39E FD3413          23      INC (IY+19)
       E3A1                     RBW1:
00163D E3A1 FDE1            14      POP IY
00163F E3A3 C1              10      POP BC
001640 E3A4 D1              10      POP DE
001641 E3A5 E1              10      POP HL
       E3A6                     DD_NUL:
001642 E3A6 AF               4      XOR A
       E3A7                     DRDF0:
       E3A7                     DWTF0:
001643 E3A7 C9              10      RET
                                
       E3A8                     RBWERR:
001644 E3A8 FDE5            15      PUSH    IY
001646 E3AA D1              10      POP DE
001647 E3AB 2A20F0          16      LD  HL,(STABLE+2*010H)
00164A E3AE CD0F00          17      CALL    JP_HL
       E3B1                     RBRERR1:
00164D E3B1 3E01             7      LD  A,001H
       E3B3                     RBRERR2:
00164F E3B3 FDE1            14      POP IY
001651 E3B5 C1              10      POP BC
001652 E3B6 D1              10      POP DE
001653 E3B7 E1              10      POP HL
001654 E3B8 37               4      SCF
001655 E3B9 210000          10      LD  HL,0
001658 E3BC C9              10      RET
                                
       E3BD                     RBRERR:
001659 E3BD 3EFF             7      LD  A,0FFH
00165B E3BF 18F2            12      JR  RBRERR2
                                
       E3C1                     RBRFL:
00165D E3C1 3E00             7  RBRFLP: LD  A,000H
00165F E3C3 FE0D             7      CP  00DH
001661 E3C5 2005            12      JR  NZ,RBRFL1
001663 E3C7 D5              11      PUSH    DE
001664 E3C8 1E0A             7      LD  E,00AH
001666 E3CA 1805            12      JR  RBRFL2
       E3CC                     RBRFL1:
001668 E3CC D5              11      PUSH    DE
001669 E3CD CD09EF          17      CALL    _SYS07
00166C E3D0 5F               4      LD  E,A
       E3D1                     RBRFL2:
00166D E3D1 CDCDEF          17      CALL    _PRINT
001670 E3D4 7B               4      LD  A,E
001671 E3D5 D1              10      POP DE
001672 E3D6 32C2E3          13      LD  (RBRFLP+1),A
001675 E3D9 C9              10      RET
       E3DA                     DDX:
001676 E3DA FD7E01          19      LD  A,(IY+1)    ;(FCB)主ファイル名
001679 E3DD CDEEDF          17      CALL    CAP
00167C E3E0 FE41             7      CP  'A'
00167E E3E2 C9              10      RET
                                
                                                ;Read random block
       E3E3                     _SYS27:     ;(BDOS)ランダムブロック読み込み
00167F E3E3 225DEF          16      LD  (LEFTX),HL
001682 E3E6 CDCBDD          17      CALL    SETDRV
                                
001685 E3E9 FDCB0D66        20      BIT 4,(IY+13)   ;(FCB)属性(アトリビュート)
001689 E3ED C273E4          10      JP  NZ,RBRDIR   ;ディレクトリ
00168C E3F0 CD85E4          17      CALL    RBX0
00168F E3F3 DABDE3          10      JP  C,RBRERR
001692 E3F6 CD94E4          17      CALL    RBX1
001695 E3F9 DAB1E3          10      JP  C,RBRERR1
001698 E3FC EB               4      EX  DE,HL
001699 E3FD ED52            15      SBC HL,DE       ;CP 00HL,BCDE
00169B E3FF 19              11      ADD HL,DE
00169C E400 79               4      LD  A,C
00169D E401 DE00             7      SBC A,0
00169F E403 78               4      LD  A,B
0016A0 E404 DE00             7      SBC A,0
0016A2 E406 3801            12      JR  C,RBR1
0016A4 E408 EB               4      EX  DE,HL
       E409                     RBR1:
0016A5 E409 9F               4      SBC A,A
0016A6 E40A E601             7      AND 1
0016A8 E40C 3271E4          13      LD  (RBRAP+1),A
                                
0016AB E40F 7C               4      LD  A,H
0016AC E410 B5               4      OR  L
0016AD E411 2857            12      JR  Z,RBREND0
                                
0016AF E413 222EE5          16      LD  (LEFT+1),HL ;Read record byte
0016B2 E416 225DEF          16      LD  (LEFTX),HL
                                
0016B5 E419 CDB4E4          17      CALL    RBX2
0016B8 E41C 2819            12      JR  Z,RBRB
0016BA E41E CDD3E4          17      CALL    RBXA
0016BD E421 DABDE3          10      JP  C,RBRERR
0016C0 E424 C5              11      PUSH    BC
0016C1 E425 EDB0                    LDIR
0016C3 E427 ED535FEF        20      LD  (DTAX),DE
0016C7 E42B 2A5DEF          16      LD  HL,(LEFTX)
0016CA E42E D1              10      POP DE
0016CB E42F A7               4      AND A
0016CC E430 ED52            15      SBC HL,DE
0016CE E432 225DEF          16      LD  (LEFTX),HL
0016D1 E435 2830            12      JR  Z,RBREND
                                
       E437                     RBRB:
0016D3 E437 CD09E5          17      CALL    RBXB
0016D6 E43A 2815            12      JR  Z,RBRC
       E43C                     RBRB1:
0016D8 E43C C5              11      PUSH    BC
0016D9 E43D D5              11      PUSH    DE
0016DA E43E CDC9DF          17      CALL    CLUSTX
0016DD E441 CD6AE5          17      CALL    DRDC
0016E0 E444 D1              10      POP DE
0016E1 E445 C1              10      POP BC
0016E2 E446 D462E7          17      CALL    NC,GNCLX
0016E5 E449 DABDE3          10      JP  C,RBRERR
0016E8 E44C 10EE            13      DJNZ    RBRB1
0016EA E44E CDB4E5          17      CALL    DRW_FLUSH
       E451                     RBRC:
0016ED E451 CD21E5          17      CALL    RBXC
0016F0 E454 2811            12      JR  Z,RBREND
0016F2 E456 C5              11      PUSH    BC
0016F3 E457 CDC9DF          17      CALL    CLUSTX
0016F6 E45A CDCDE5          17      CALL    DRDX
0016F9 E45D C1              10      POP BC
0016FA E45E DABDE3          10      JP  C,RBRERR
0016FD E461 EB               4      EX  DE,HL
0016FE E462 2A7EF0          16      LD  HL,(_DTBUF)
001701 E465 EDB0                    LDIR
       E467                     RBREND:
001703 E467 CD2DE5          17      CALL    RBXEND
       E46A                     RBREND0:
001706 E46A FDE1            14      POP IY
001708 E46C C1              10      POP BC
001709 E46D D1              10      POP DE
00170A E46E F1              10      POP AF  ;(HL)
00170B E46F AF               4      XOR A
00170C E470 3E00             7  RBRAP:  LD  A,000H
00170E E472 C9              10      RET
                                
       E473                     RBRDIR:
00170F E473 FD6E1A          19      LD  L,(IY+26)   ;(FCB)ファイルの先頭クラスタ
001712 E476 FD661B          19      LD  H,(IY+27)
001715 E479 CD09E0          17      CALL    CHDIR
001718 E47C AF               4      XOR A
001719 E47D 67               4      LD  H,A
00171A E47E 6F               4      LD  L,A
00171B E47F 3C               4      INC A
00171C E480 3271E4          13      LD  (RBRAP+1),A
00171F E483 18E5            12      JR  RBREND0
                                
       E485                     RBX0:
001721 E485 2A8AEF          16      LD  HL,(_DTA)
001724 E488 225FEF          16      LD  (DTAX),HL
001727 E48B 2A5DEF          16      LD  HL,(LEFTX)
00172A E48E FD7E1C          19      LD  A,(IY+28)   ;(FCB)オープンモード
00172D E491 D6FD             7      SUB 0FDH
00172F E493 C9              10      RET
                                
       E494                     RBX1:
001730 E494 E5              11      PUSH    HL      ;Record byte
                                                ;AHL=File size
001731 E495 FD6E10          19      LD  L,(IY+16)   ;ファイルのサイズ(バイト単位)
001734 E498 FD6611          19      LD  H,(IY+17)   ;
001737 E49B FD7E12          19      LD  A,(IY+18)   ;
                                
00173A E49E CD50E5          17      CALL    GET_RR_BCDE ;BCDE=Random record
                                
00173D E4A1 A7               4      AND A
00173E E4A2 ED52            15      SBC HL,DE
001740 E4A4 99               4      SBC A,C
001741 E4A5 4F               4      LD  C,A
001742 E4A6 FD7E13          19      LD  A,(IY+19)   ;ファイルのサイズ
001745 E4A9 98               4      SBC A,B
001746 E4AA D1              10      POP DE
                                
001747 E4AB D8              11      RET C
001748 E4AC 47               4      LD  B,A
001749 E4AD B1               4      OR  C
00174A E4AE EB               4      EX  DE,HL   ;BCDE=File byte HL=Record byte
00174B E4AF B2               4      OR  D
00174C E4B0 B3               4      OR  E
00174D E4B1 C0              11      RET NZ
00174E E4B2 37               4      SCF
00174F E4B3 C9              10      RET
                                
       E4B4                     RBX2:               ;Cluster settings
001750 E4B4 FD6622          19      LD  H,(IY+34)   ;(+33)(FCB)ランダムレコード
001753 E4B7 FD4E23          19      LD  C,(IY+35)
001756 E4BA 0600             7      LD  B,0
001758 E4BC FDCB207E        20      BIT 7,(IY+32)   ;(FCB)カレントレコード
00175C E4C0 2003            12      JR  NZ,RBX3
00175E E4C2 FD4624          19      LD  B,(IY+36)
       E4C5                     RBX3:
001761 E4C5 CDBAE1          17      CALL    RWXR
001764 E4C8 3AEBE4          13      LD  A,(SECSZ+2) ;1024=4 / 512=2 / 256=1
001767 E4CB 3D               4      DEC A
001768 E4CC FDA622          19      AND (IY+34)
00176B E4CF FDB621          19      OR  (IY+33)
00176E E4D2 C9              10      RET
                                
       E4D3                     RBXA:
00176F E4D3 C5              11      PUSH    BC
001770 E4D4 D5              11      PUSH    DE
001771 E4D5 CDC9DF          17      CALL    CLUSTX
001774 E4D8 CDCDE5          17      CALL    DRDX
001777 E4DB D1              10      POP DE
001778 E4DC C1              10      POP BC
001779 E4DD D8              11      RET C
00177A E4DE CD62E7          17      CALL    GNCLX
00177D E4E1 D8              11      RET C
00177E E4E2 ED53FEF0        20      LD  (_CLPS),DE
                                
001782 E4E6 FD4E21          19      LD  C,(IY+33)   ;(FCB)ランダムレコード
001785 E4E9 210004          10  SECSZ:  LD  HL,0400H    ;自己書き換え 1024=0400H / 512=0200H ここに1セクタのサイズが格納される
001788 E4EC 7C               4      LD  A,H
001789 E4ED 3D               4      DEC A       ;1024=3 / 512=1
00178A E4EE FDA622          19      AND (IY+34)     ;(FCB)ランダムレコード
00178D E4F1 47               4      LD  B,A     ;BCに1セクタ以下の端数が入る
00178E E4F2 ED42            15      SBC HL,BC       ;残りを計算
                                
001790 E4F4 ED5B5DEF        20      LD  DE,(LEFTX)
001794 E4F8 ED52            15      SBC HL,DE       ;CP HL,DE
001796 E4FA 19              11      ADD HL,DE       ;
001797 E4FB 3801            12      JR  C,RBXA1     ;DEとHLを比較して大きい方をHLに
001799 E4FD EB               4      EX  DE,HL
       E4FE                     RBXA1:
00179A E4FE E5              11      PUSH    HL
00179B E4FF 2A7EF0          16      LD  HL,(_DTBUF)
00179E E502 09              11      ADD HL,BC
00179F E503 ED5B5FEF        20      LD  DE,(DTAX)
0017A3 E507 C1              10      POP BC
0017A4 E508 C9              10      RET
                                
       E509                     RBXB:
0017A5 E509 2A5FEF          16      LD  HL,(DTAX)
0017A8 E50C ED5BFEF0        20      LD  DE,(_CLPS)
0017AC E510 3A5EEF          13      LD  A,(LEFTX+1)
0017AF E513 47               4      LD  B,A
0017B0 E514 3AEBE4          13      LD  A,(SECSZ+2) ;1024=4 / 512=2 / 256=1
       E517                     RBXB1:
0017B3 E517 1F               4      RRA     ;->CF
0017B4 E518 3804            12      JR  C,RBXB2
0017B6 E51A CB38             8      SRL B   ;B=B/2
0017B8 E51C 18F9            12      JR  RBXB1
       E51E                     RBXB2:
0017BA E51E 78               4      LD  A,B
0017BB E51F B7               4      OR  A
0017BC E520 C9              10      RET
                                
       E521                     RBXC:
0017BD E521 ED4B5DEF        20      LD  BC,(LEFTX)
0017C1 E525 3AEBE4          13      LD  A,(SECSZ+2) ;1024=4 / 512=2 / 256=1
0017C4 E528 3D               4      DEC A
0017C5 E529 A0               4      AND B
0017C6 E52A 47               4      LD  B,A     ;1セクタ以下の端数がない場合はZ
0017C7 E52B B1               4      OR  C
0017C8 E52C C9              10      RET
                                
       E52D                     RBXEND:
0017C9 E52D 110000          10  LEFT:   LD  DE,0
0017CC E530 AF               4      XOR A
0017CD E531 FD6E21          19      LD  L,(IY+33)   ;(FCB)ランダムレコード
0017D0 E534 FD6622          19      LD  H,(IY+34)
0017D3 E537 19              11      ADD HL,DE
0017D4 E538 FD7521          19      LD  (IY+33),L   ;(FCB)ランダムレコード
0017D7 E53B FD7422          19      LD  (IY+34),H
0017DA E53E 300E            12      JR  NC,RBXEND1
0017DC E540 FD3423          23      INC (IY+35)
0017DF E543 2009            12      JR  NZ,RBXEND1
0017E1 E545 FDCB207E        20      BIT 7,(IY+32)   ;(FCB)カレントレコード
0017E5 E549 2003            12      JR  NZ,RBXEND1
0017E7 E54B FD3424          23      INC (IY+36)
       E54E                     RBXEND1:
0017EA E54E EB               4      EX  DE,HL       ;HL=Read byte
0017EB E54F C9              10      RET
                                
       E550                     GET_RR_BCDE:            ;BCDE=Random record
0017EC E550 FD5E21          19      LD  E,(IY+33)   ;(FCB)ランダムレコード
0017EF E553 FD5622          19      LD  D,(IY+34)
0017F2 E556 FD4E23          19      LD  C,(IY+35)
0017F5 E559 FD4624          19      LD  B,(IY+36)
0017F8 E55C FDCB207E        20      BIT 7,(IY+32)   ;(FCB)カレントレコード
0017FC E560 C8              11      RET Z
0017FD E561 0600             7      LD  B,0     ;CP/M互換のアクセスの場合はFCBは36バイト
0017FF E563 C9              10      RET
                                
                                ;   ランダムブロックアクセスの連続したセクタをまとめる
                                
       E564                     DWTC:
001800 E564 E5              11      PUSH    HL
001801 E565 21C7E8          10      LD  HL,DWT24B
001804 E568 1804            12      JR  DWTC1
       E56A                     DRDC:
001806 E56A E5              11      PUSH    HL
001807 E56B 21B7E8          10      LD  HL,DRD24B
       E56E                     DWTC1:
00180A E56E 22C8E5          16      LD  (DRWF_MODE),HL
00180D E571 E1              10      POP HL
00180E E572 3AB8E5          13      LD  A,(DRWF_B)
001811 E575 B7               4      OR  A
001812 E576 200F            12      JR  NZ,DRDC1
       E578                     SAVE_DRWC:
001814 E578 0601             7      LD  B,1
001816 E57A ED43B7E5        20      LD  (DRWF_C),BC
00181A E57E ED53BEE5        20      LD  (DRWF_E),DE
00181E E582 22C1E5          16      LD  (DRWF_HL),HL
001821 E585 1820            12      JR  INC_HL_DRWC
       E587                     DRDC1:
001823 E587 E5              11      PUSH    HL
001824 E588 21BEE5          10      LD  HL,DRWF_E
001827 E58B 86               7      ADD A,(HL)
001828 E58C F5              11      PUSH    AF
001829 E58D BB               4      CP  E
00182A E58E 201D            12      JR  NZ,DRDC2
00182C E590 F1              10      POP AF
00182D E591 23               6      INC HL
00182E E592 7E               7      LD  A,(HL)
00182F E593 CE00             7      ADC A,0
001831 E595 F5              11      PUSH    AF
001832 E596 BA               4      CP  D
001833 E597 2014            12      JR  NZ,DRDC2
001835 E599 F1              10      POP AF
001836 E59A 3AB7E5          13      LD  A,(DRWF_C)
001839 E59D CE00             7      ADC A,0
00183B E59F B9               4      CP  C
00183C E5A0 200C            12      JR  NZ,DRDC3
00183E E5A2 21B8E5          10      LD  HL,DRWF_B
001841 E5A5 34              11      INC (HL)
001842 E5A6 E1              10      POP HL
       E5A7                     INC_HL_DRWC:
001843 E5A7 3AEBE4          13      LD  A,(SECSZ+2)     ;1セクタのサイズの上位1バイト
001846 E5AA 84               4      ADD A,H
001847 E5AB 67               4      LD  H,A
001848 E5AC C9              10      RET
       E5AD                     DRDC2:
001849 E5AD F1              10      POP AF
       E5AE                     DRDC3:
00184A E5AE CDB4E5          17      CALL    DRW_FLUSH
00184D E5B1 E1              10      POP HL
00184E E5B2 18C4            12      JR  SAVE_DRWC
                                
                                ;   ランダムブロックアクセスの連続したセクタをまとめたものをフラッシュする
       E5B4                     DRW_FLUSH:
001850 E5B4 C5              11      PUSH    BC
001851 E5B5 D5              11      PUSH    DE
       E5B7                     DRWF_C  EQU $+1
       E5B8                     DRWF_B  EQU $+2
001852 E5B6 010000          10      LD  BC,0
001855 E5B9 78               4      LD  A,B
001856 E5BA B7               4      OR  A
001857 E5BB 280D            12      JR  Z,DRDF1
       E5BE                     DRWF_E  EQU $+1
       E5BF                     DRWF_D  EQU $+2
001859 E5BD 110000          10      LD  DE,0
       E5C1                     DRWF_HL EQU $+1
00185C E5C0 210000          10      LD  HL,0
00185F E5C3 AF               4      XOR A
001860 E5C4 32B8E5          13      LD  (DRWF_B),A
       E5C8                     DRWF_MODE   EQU $+1
001863 E5C7 CDB7E8          17      CALL    DRD24B
       E5CA                     DRDF1:
001866 E5CA D1              10      POP DE
001867 E5CB C1              10      POP BC
001868 E5CC C9              10      RET
[EOF:LDFILE2.ASM:SHIFT_JIS]
                                    INCLUDE "LDDIO.ASM"
                                
                                ;   LSX-Dodgers DIO
                                
       E5CD                     DRDX:
001869 E5CD CD0BE6          17      CALL    DRDY
00186C E5D0 C8              11      RET Z
00186D E5D1 CDF1E5          17      CALL    DRDX1       ;データバッファの情報を保存
001870 E5D4 D8              11      RET C
001871 E5D5 E5              11      PUSH    HL
001872 E5D6 C5              11      PUSH    BC
001873 E5D7 D5              11      PUSH    DE
001874 E5D8 2A7EF0          16      LD  HL,(_DTBUF)
001877 E5DB 3A34E6          13      LD  A,(_DBS24+1)
00187A E5DE 4F               4      LD  C,A
00187B E5DF CDB5E8          17      CALL    DRD24
00187E E5E2 DC06E6          17      CALL    C,DRDNE
       E5E5                     POP_DE_BC_HL_RET:
001881 E5E5 D1              10      POP DE
001882 E5E6 C1              10      POP BC
001883 E5E7 E1              10      POP HL
001884 E5E8 C9              10      RET
                                
                                ;   CDE:セクタ番号
       E5E9                     DRDN:
001885 E5E9 AF               4      XOR A
001886 E5EA 00               4  DRDN1:  NOP         ;自己書き換え NOP / SCF
001887 E5EB 30E0            12      JR  NC,DRDX
       E5ED                     DRDNX:
001889 E5ED CD0BE6          17      CALL    DRDY
00188C E5F0 C8              11      RET Z
       E5F1                     DRDX1:
00188D E5F1 CD21E6          17      CALL    DWTX
                                                ;データバッファの読み込んだドライブ・セクタ情報を保存
001890 E5F4 ED53A6EF        20      LD  (_DBSEC),DE
001894 E5F8 79               4      LD  A,C
001895 E5F9 3234E6          13      LD  (_DBS24+1),A
                                
001898 E5FC 3A88EF          13      LD  A,(_DRV)
00189B E5FF 32A5EF          13      LD  (_DBDRV),A
00189E E602 CDD9EF          17      CALL    _CHGDRV
0018A1 E605 D0              11      RET NC
       E606                     DRDNE:
0018A2 E606 9F               4      SBC A,A     ;CF=1ならばA=0FFH
0018A3 E607 32A5EF          13      LD  (_DBDRV),A
0018A6 E60A C9              10      RET
                                
                                ;   CDE:セクタ番号
       E60B                     DRDY:
0018A7 E60B 3A34E6          13      LD  A,(_DBS24+1)
0018AA E60E B9               4      CP  C
0018AB E60F C0              11      RET NZ
                                
0018AC E610 E5              11      PUSH    HL
0018AD E611 3A88EF          13      LD  A,(_DRV)
0018B0 E614 21A5EF          10      LD  HL,_DBDRV
0018B3 E617 AE               7      XOR (HL)
0018B4 E618 2005            12      JR  NZ,POP_HL_RET
                                
0018B6 E61A 2AA6EF          16      LD  HL,(_DBSEC)
0018B9 E61D ED52            15      SBC HL,DE       ;CF=0
       E61F                     POP_HL_RET:
0018BB E61F E1              10      POP HL
0018BC E620 C9              10      RET
                                
       E621                     DWTX:
0018BD E621 3AA4EF          13      LD  A,(_WTDBF)
0018C0 E624 B7               4      OR  A
0018C1 E625 C8              11      RET Z
0018C2 E626 AF               4      XOR A
0018C3 E627 32A4EF          13      LD  (_WTDBF),A
                                
0018C6 E62A E5              11      PUSH    HL
0018C7 E62B C5              11      PUSH    BC
0018C8 E62C D5              11      PUSH    DE
0018C9 E62D 3AA5EF          13      LD  A,(_DBDRV)
0018CC E630 CDD9EF          17      CALL    _CHGDRV
0018CF E633 0E00             7  _DBS24: LD  C,0
0018D1 E635 ED5BA6EF        20      LD  DE,(_DBSEC)
0018D5 E639 2A7EF0          16      LD  HL,(_DTBUF)
0018D8 E63C D4C5E8          17      CALL    NC,DWT24
       E63F                     POP_DE_BC_HL_RET2:
0018DB E63F 18A4            12      JR  POP_DE_BC_HL_RET
                                
       E641                     RDFATX:
0018DD E641 E5              11      PUSH    HL
0018DE E642 3A88EF          13      LD  A,(_DRV)
0018E1 E645 21AAEF          10      LD  HL,_FATDRV
0018E4 E648 AE               7      XOR (HL)
0018E5 E649 28D4            12      JR  Z,POP_HL_RET
                                
0018E7 E64B C5              11      PUSH    BC
0018E8 E64C D5              11      PUSH    DE
0018E9 E64D DDE5            15      PUSH    IX
0018EB E64F CD6BE6          17      CALL    WTFATX
0018EE E652 3813            12      JR  C,POP_IX_DE_BC_HL_RET
                                
0018F0 E654 AF               4      XOR A
0018F1 E655 32ABEF          13      LD  (_FATIX),A
0018F4 E658 3A88EF          13      LD  A,(_DRV)
0018F7 E65B 32AAEF          13      LD  (_FATDRV),A
0018FA E65E CDE5EF          17      CALL    _RDFAT
       E661                     RDFATE2:
0018FD E661 3004            12      JR  NC,POP_IX_DE_BC_HL_RET
0018FF E663 9F               4      SBC A,A     ;A=0xFF
001900 E664 32AAEF          13      LD  (_FATDRV),A
       E667                     POP_IX_DE_BC_HL_RET:
001903 E667 DDE1            14      POP IX
001905 E669 18D4            12      JR  POP_DE_BC_HL_RET2
                                
       E66B                     WTFATX:
001907 E66B 3AA2EF          13      LD  A,(_WTFATF)
00190A E66E B7               4      OR  A
00190B E66F C8              11      RET Z
00190C E670 E5              11      PUSH    HL
00190D E671 3AAAEF          13      LD  A,(_FATDRV)
001910 E674 21A5EF          10      LD  HL,_DBDRV
001913 E677 AE               7      XOR (HL)
001914 E678 CC21E6          17      CALL    Z,DWTX
001917 E67B 38A2            12      JR  C,POP_HL_RET
001919 E67D C5              11      PUSH    BC
00191A E67E D5              11      PUSH    DE
00191B E67F DDE5            15      PUSH    IX
00191D E681 CDD2E8          17      CALL    WTFAT
001920 E684 AF               4      XOR A
001921 E685 32A2EF          13      LD  (_WTFATF),A
001924 E688 18DD            12      JR  POP_IX_DE_BC_HL_RET
                                
       E68A                     NCL1:
001926 E68A 7A               4      LD  A,D
001927 E68B B3               4      OR  E
001928 E68C 37               4      SCF
001929 E68D C8              11      RET Z
                                
00192A E68E 7A               4      LD  A,D
00192B E68F CB3F             8      SRL A   ;/2
00192D E691 CB3F             8      SRL A   ;/2
                                
00192F E693 E5              11      PUSH    HL
001930 E694 32B3E6          13      LD  (NCLPAT+2),A    ;_FATIX
001933 E697 2AAAEF          16      LD  HL,(_FATDRV)    ;L=_FATDRV H=_FATIX
001936 E69A BC               4      CP  H
001937 E69B 3A88EF          13      LD  A,(_DRV)    ;この間でフラグは変化しない
00193A E69E 32B2E6          13      LD  (NCLPAT+1),A    ;_FATDRV
00193D E6A1 2005            12      JR  NZ,NCL2     ;FATIXが違う
00193F E6A3 BD               4      CP  L
001940 E6A4 2002            12      JR  NZ,NCL2     ;ドライブが違う
001942 E6A6 E1              10      POP HL
001943 E6A7 C9              10      RET
       E6A8                     NCL2:
001944 E6A8 C5              11      PUSH    BC
001945 E6A9 D5              11      PUSH    DE
001946 E6AA DDE5            15      PUSH    IX
001948 E6AC CD6BE6          17      CALL    WTFATX
00194B E6AF 38B6            12      JR  C,POP_IX_DE_BC_HL_RET
00194D E6B1 010000          10  NCLPAT: LD  BC,0        ;自己書き換え C=_FATDRV B=_FATIX
001950 E6B4 ED43AAEF        20      LD  (_FATDRV),BC
001954 E6B8 CDA7E8          17      CALL    RDFATS
001957 E6BB 18A4            12      JR  RDFATE2
                                
       E6BD                     NCL3:
001959 E6BD CB9A             8      RES 3,D
00195B E6BF CB92             8      RES 2,D
00195D E6C1 6B               4      LD  L,E
00195E E6C2 62               4      LD  H,D
00195F E6C3 CB3C             8      SRL H   ;
001961 E6C5 CB1D             8      RR  L   ;HLA=HLA/2
001963 E6C7 1F               4      RRA     ;
001964 E6C8 F5              11      PUSH    AF
001965 E6C9 3AABEF          13      LD  A,(_FATIX)
001968 E6CC 0F               4      RRCA
001969 E6CD 300B            12      JR  NC,NCL3X1
00196B E6CF 3AEBE4          13      LD  A,(SECSZ+2)
00196E E6D2 FE04             7      CP  4       ;1セクタ1024バイトの場合は奇数インデックスの場合に先頭を512バイトずらす
001970 E6D4 2004            12      JR  NZ,NCL3X1
001972 E6D6 010002          10      LD  BC,512
001975 E6D9 09              11      ADD HL,BC
       E6DA                     NCL3X1:
001976 E6DA F1              10      POP AF
001977 E6DB ED4B7CF0        20      LD  BC,(_FATBF)
00197B E6DF 19              11      ADD HL,DE
00197C E6E0 09              11      ADD HL,BC
00197D E6E1 17               4      RLA
00197E E6E2 C9              10      RET
                                
       E6E3                     GNCL:
00197F E6E3 CD8AE6          17      CALL    NCL1        ;GET NEXT CLUSTER
001982 E6E6 D8              11      RET C
001983 E6E7 C5              11      PUSH    BC
001984 E6E8 E5              11      PUSH    HL
001985 E6E9 CDBDE6          17      CALL    NCL3
001988 E6EC 3809            12      JR  C,GNC1
00198A E6EE 5E               7      LD  E,(HL)
00198B E6EF 23               6      INC HL
00198C E6F0 7E               7      LD  A,(HL)
00198D E6F1 E60F             7      AND 00FH
00198F E6F3 57               4      LD  D,A
001990 E6F4 E1              10      POP HL
001991 E6F5 C1              10      POP BC
001992 E6F6 C9              10      RET
       E6F7                     GNC1:
001993 E6F7 7E               7      LD  A,(HL)
001994 E6F8 23               6      INC HL
001995 E6F9 56               7      LD  D,(HL)
001996 E6FA 0604             7      LD  B,4
       E6FC                     GNC1L:
001998 E6FC CB3A             8      SRL D   ;DA=DA/2
00199A E6FE 1F               4      RRA     ;
00199B E6FF 10FB            13      DJNZ    GNC1L
                                
00199D E701 5F               4      LD  E,A
00199E E702 E1              10      POP HL
00199F E703 C1              10      POP BC
0019A0 E704 A7               4      AND A
0019A1 E705 C9              10      RET
                                
       E706                     SNCL:
0019A2 E706 CD8AE6          17      CALL    NCL1
0019A5 E709 D8              11      RET C
                                ;               SET NEXT CLUSTER
0019A6 E70A E5              11      PUSH    HL
0019A7 E70B C5              11      PUSH    BC
0019A8 E70C D5              11      PUSH    DE
0019A9 E70D E5              11      PUSH    HL
0019AA E70E CDBDE6          17      CALL    NCL3
0019AD E711 D1              10      POP DE
                                ;CF=ODD
0019AE E712 7E               7      LD  A,(HL)
0019AF E713 73               7      LD  (HL),E
0019B0 E714 3806            12      JR  C,SNC1
                                ;EVEN
                                ;M[0] = E
                                ;M[1] = (M[1] & 0xF0) | (D & 0x0F)
0019B2 E716 23               6      INC HL
0019B3 E717 ED67            18      RRD     ;M={A[3:0],E[3:0]}
0019B5 E719 7A               4      LD  A,D
0019B6 E71A 1804            12      JR  SNC11
       E71C                     SNC1:
                                ;ODD
                                ;HL[0] = (HL[0]&0x0F) | (E<<4)
                                ;HL[1] = DE>>4
0019B8 E71C ED6F            18      RLD     ;M={D[3:0],E[7:4]}
0019BA E71E 23               6      INC HL
0019BB E71F 72               7      LD  (HL),D  ;M={D[3:0],E[7:4]}
       E720                     SNC11:
0019BC E720 ED6F            18      RLD     ;M={M[7:4],D[3:0]}
0019BE E722 B7               4      OR  A
0019BF E723 D1              10      POP DE
0019C0 E724 C1              10      POP BC
0019C1 E725 E1              10      POP HL
       E726                     FAT_CHANGED:
0019C2 E726 3E01             7      LD  A,1
0019C4 E728 32A2EF          13      LD  (_WTFATF),A
0019C7 E72B C9              10      RET
                                
       E72C                     N16CL3:
0019C8 E72C C5              11      PUSH    BC
0019C9 E72D 6B               4      LD  L,E
0019CA E72E 7A               4      LD  A,D
0019CB E72F E603             7      AND 3
0019CD E731 67               4      LD  H,A
0019CE E732 29              11      ADD HL,HL
0019CF E733 ED4B7CF0        20      LD  BC,(_FATBF)
0019D3 E737 09              11      ADD HL,BC
0019D4 E738 C1              10      POP BC
0019D5 E739 C9              10      RET
                                
       E73A                     GNCL16:
0019D6 E73A CD8AE6          17      CALL    NCL1        ;GET NEXT CLUSTER for FAT16
0019D9 E73D D8              11      RET C
0019DA E73E E5              11      PUSH    HL
0019DB E73F CD2CE7          17      CALL    N16CL3
0019DE E742 5E               7      LD  E,(HL)
0019DF E743 23               6      INC HL
0019E0 E744 56               7      LD  D,(HL)
0019E1 E745 E1              10      POP HL
0019E2 E746 C9              10      RET
                                
       E747                     SNCL16:
0019E3 E747 CD8AE6          17      CALL    NCL1        ;GET NEXT CLUSTER for FAT16
0019E6 E74A D8              11      RET C
0019E7 E74B D5              11      PUSH    DE
0019E8 E74C E5              11      PUSH    HL
0019E9 E74D CD2CE7          17      CALL    N16CL3
0019EC E750 D1              10      POP DE      ;HL
0019ED E751 73               7      LD  (HL),E
0019EE E752 23               6      INC HL
0019EF E753 72               7      LD  (HL),D
0019F0 E754 6B               4      LD  L,E
0019F1 E755 62               4      LD  H,D
0019F2 E756 D1              10      POP DE
0019F3 E757 18CD            12      JR  FAT_CHANGED
                                
                                ;------------------------
                                ;次のセクタを探す際に_SECPSの値をチェック
                                ;in
                                ;   DE : セクタ番号
                                ;out
                                ;   DE : 次のセクタ番号
                                ;note
                                ;
                                ;------------------------
       E759                     NEXTX:
0019F5 E759 3E00             7  _SECPS: LD  A,0 ;自己書き換え
0019F7 E75B 3C               4      INC A
0019F8 E75C E600             7  NCPAT:  AND 0   ;自己書き換え　1クラスタの論理セクタ数-1
0019FA E75E 325AE7          13      LD  (_SECPS+1),A
0019FD E761 C9              10      RET
                                
       E762                     GNCLX:
0019FE E762 CD59E7          17      CALL    NEXTX
001A01 E765 C0              11      RET NZ  ;1クラスタのセクタ未満の場合は戻る
001A02 E766 C3F7EF          10      JP  _GNCL   ;次のクラスタを探す
                                
       E769                     RDFAT:
001A05 E769 3E80             7      LD  A,080H
001A07 E76B 3270EF          13      LD  (CHECK),A
       E76E                     RDFAT1:
001A0A E76E 3A88EF          13      LD  A,(_DRV)
001A0D E771 CDFDE9          17      CALL    CHGDRVR
001A10 E774 D8              11      RET C
001A11 E775 DD7E12          19      LD  A,(IX+012H) ;DPB_12_DEVICE
001A14 E778 CB6F             8      BIT 5,A
001A16 E77A 2843            12      JR  Z,RDFAT0X
001A18 E77C 2170EF          10      LD  HL,CHECK
001A1B E77F A6               7      AND (HL)
001A1C E780 77               7      LD  (HL),A
001A1D E781 110000          10      LD  DE,0        ;BPB
001A20 E784 2A7CF0          16      LD  HL,(_FATBF)
001A23 E787 CDB3E8          17      CALL    DRD16
001A26 E78A 3024            12      JR  NC,GETBPB
001A28 E78C 2170EF          10      LD  HL,CHECK
001A2B E78F CB06            15      RLC (HL)
001A2D E791 3F               4      CCF
001A2E E792 D8              11      RET C
001A2F E793 DDCB0A1E        23      RR  (IX+00AH)   ;DPB_0A_FDMODE
001A33 E797 3F               4      CCF         ;フロッピーディスクのMFMモードを切り替える
001A34 E798 DDCB0A16        23      RL  (IX+00AH)   ;DPB_0A_FDMODE
001A38 E79C 3EFF             7      LD  A,0FFH
001A3A E79E 3289EF          13      LD  (_DSK),A
001A3D E7A1 3A84EF          13      LD  A,(_DRIVE)
001A40 E7A4 E603             7      AND 3
001A42 E7A6 F680             7      OR  080H
001A44 E7A8 6F               4      LD  L,A
001A45 E7A9 26EF             7      LD  H,_CYL0/256
001A47 E7AB 3EFF             7      LD  A,0FFH
001A49 E7AD 77               7      LD  (HL),A
001A4A E7AE 18BE            12      JR  RDFAT1
       E7B0                     GETBPB:
001A4C E7B0 FDE5            15      PUSH    IY
001A4E E7B2 FD2A7CF0        20      LD  IY,(_FATBF) ;BPB
001A52 E7B6 CDF1EF          17      CALL    _BPB2DPB
001A55 E7B9 FDE1            14      POP IY
001A57 E7BB D8              11      RET C
001A58 E7BC CD5BE9          17      CALL    CHGDRV2
       E7BF                     RDFAT0X:
001A5B E7BF CDA7E8          17      CALL    RDFATS
001A5E E7C2 D8              11      RET C
001A5F E7C3 DDBE06           7      CP  (IX+6)      ;DPB_06_FATID
001A62 E7C6 C8              11      RET Z
001A63 E7C7 DDCB126E        20      BIT 5,(IX+012H) ;DPB_12_DEVICE
001A67 E7CB C0              11      RET NZ      ;BPBを取得している場合はFATIDをチェックしない
001A68 E7CC 37               4      SCF
001A69 E7CD C9              10      RET
                                
       E7CE                     BPB2DPB:
001A6A E7CE FD7E0B          19      LD  A,(IY+11)   ;BPB_BytsPerSec
001A6D E7D1 B7               4      OR  A
001A6E E7D2 37               4      SCF
001A6F E7D3 C0              11      RET NZ
       E7D4                     BPBOK:
001A70 E7D4 FD7E0D          19      LD  A,(IY+13)   ;BPB_SecPerClus
001A73 E7D7 DD7707          19      LD  (IX+7),A    ;DPB_07_SECPCL
                                
001A76 E7DA FD7E16          19      LD  A,(IY+22)   ;BPB_FATSz16
001A79 E7DD DD7700          19      LD  (IX+0),A    ;DPB_00_FATLN
001A7C E7E0 FD7E17          19      LD  A,(IY+23)   ;BPB_FATSz16
001A7F E7E3 DD7701          19      LD  (IX+1),A    ;DPB_00_FATLN
                                
001A82 E7E6 FD6E0E          19      LD  L,(IY+14)   ;BPB_RsvdSecCnt
001A85 E7E9 FD660F          19      LD  H,(IY+15)
001A88 E7EC DD750E          19      LD  (IX+00EH),L ;DPB_0E_FATPS
001A8B E7EF FD5E16          19      LD  E,(IY+22)   ;BPB_FATSz16
001A8E E7F2 FD5617          19      LD  D,(IY+23)
001A91 E7F5 FD4610          19      LD  B,(IY+16)   ;BPB_NumFATs
       E7F8                     BPBDP1:             ;BPB_FATSz16 * BPB_NumFATs
001A94 E7F8 19              11      ADD HL,DE
001A95 E7F9 10FD            13      DJNZ    BPBDP1
       E7FB                     BPBDP2:
001A97 E7FB DD7510          19      LD  (IX+010H),L ;DPB_10_DIRPS
001A9A E7FE DD7411          19      LD  (IX+011H),H
001A9D E801 E5              11      PUSH    HL
                                
001A9E E802 FD6E11          19      LD  L,(IY+17)   ;BPB_RootEntCnt
001AA1 E805 FD6612          19      LD  H,(IY+18)
001AA4 E808 FD7E0C          19      LD  A,(IY+12)   ;BPB_BytsPerSec
001AA7 E80B B7               4      OR  A
001AA8 E80C 37               4      SCF
001AA9 E80D C8              11      RET Z
001AAA E80E 0606             7      LD  B,6
       E810                     BPBBPS1:
001AAC E810 05               4      DEC B
001AAD E811 0F               4      RRCA
001AAE E812 30FC            12      JR  NC,BPBBPS1
       E814                     BPBDE1:
001AB0 E814 29              11      ADD HL,HL
001AB1 E815 10FD            13      DJNZ    BPBDE1
                                
001AB3 E817 7C               4      LD  A,H
001AB4 E818 DD770B          19      LD  (IX+00BH),A ;DPB_0B_DIRSCNT
                                
001AB7 E81B D1              10      POP DE      ;DPB_10_DIRPS
001AB8 E81C 6C               4      LD  L,H
001AB9 E81D 2600             7      LD  H,0
001ABB E81F 19              11      ADD HL,DE       ;MAXDIR
001ABC E820 E5              11      PUSH    HL
001ABD E821 FD4E0D          19      LD  C,(IY+13)   ;BPB_SecPerClus
001AC0 E824 CB21             8      SLA C       ;*2
001AC2 E826 AF               4      XOR A
001AC3 E827 47               4      LD  B,A
001AC4 E828 ED42            15      SBC HL,BC
001AC6 E82A DD7514          19      LD  (IX+014H),L ;DPB_14_ADDCL16
001AC9 E82D DD7415          19      LD  (IX+015H),H
                                
001ACC E830 D1              10      POP DE      ;DE=DPB_0B_MAXDIR
001ACD E831 FD6E13          19      LD  L,(IY+19)   ;BPB_TotSec16
001AD0 E834 FD6614          19      LD  H,(IY+20)
                                
001AD3 E837 DDCB0A7E        20      BIT 7,(IX+00AH) ;DPB_0A_FDMODE
001AD7 E83B 2817            12      JR  Z,NOT_FD
001AD9 E83D E5              11      PUSH    HL
001ADA E83E FD4E18          19      LD  C,(IY+24)   ;BPB_SecPerTr
001ADD E841 DD710D          19      LD  (IX+00DH),C ;DPB_0D_MAXSEC
001AE0 E844 AF               4      XOR A
001AE1 E845 47               4      LD  B,A
001AE2 E846 CB21             8      SLA C       ;両面なのでセクタ数を２倍
001AE4 E848 2B               6      DEC HL
       E849                     CNTSEC:             ;MAXCYL = BPB_TotSec16 / (BPB_SecPerTr * 2)
001AE5 E849 3C               4      INC A
001AE6 E84A 2804            12      JR  Z,CNTSECE
001AE8 E84C ED42            15      SBC HL,BC
001AEA E84E 30F9            12      JR  NC,CNTSEC
       E850                     CNTSECE:
001AEC E850 DD770C          19      LD  (IX+00CH),A ;DPB_0C_MAXCYL
001AEF E853 E1              10      POP HL  ;ここまでフロッピー専用
       E854                     NOT_FD:
001AF0 E854 7C               4      LD  A,H
001AF1 E855 B5               4      OR  L
001AF2 E856 3E00             7      LD  A,0     ;LDでフラグは変化しない。BPB_TotSec16を AHL で扱う為、Aに0を入れる
001AF4 E858 2010            12      JR  NZ,BPB16BIT ;BPB_TotSec16が「0」の場合はBPB_TotSec32で計算
001AF6 E85A FD7E23          19      LD  A,(IY+35)   ;念のために総セクタ数が24ビットを超える場合はエラーを返す
001AF9 E85D B7               4      OR  A
001AFA E85E 37               4      SCF
001AFB E85F C0              11      RET NZ
001AFC E860 FD6E20          19      LD  L,(IY+32)   ;BPB_TotSec32 は AHL の24ビットで扱う
001AFF E863 FD6621          19      LD  H,(IY+33)   ;1クラスタの論理セクタ数(DPB_07_SECPCL)が最大128なので
001B02 E866 FD7E22          19      LD  A,(IY+34)   ;24ビットを超えると必ずクラスタ数が16ビットを超えてしまうのでこれで十分
001B05 E869 A7               4      AND A       ;CF=0
       E86A                     BPB16BIT:
001B06 E86A ED52            15      SBC HL,DE
001B08 E86C DE00             7      SBC A,0
001B0A E86E FD460D          19      LD  B,(IY+13)   ;BPB_SecPerClus
       E871                     BPBTC1:             ;総クラスタ数(AHL) = 総セクタ数(AHL) / セクタサイズ(B)
001B0D E871 CB18             8      RR  B       ;->CY
001B0F E873 3808            12      JR  C,BPBTC2
001B11 E875 CB3F             8      SRL A
001B13 E877 CB1C             8      RR  H       ;AHL=AHL/2
001B15 E879 CB1D             8      RR  L
001B17 E87B 18F4            12      JR  BPBTC1
       E87D                     BPBTC2:
001B19 E87D B7               4      OR  A
001B1A E87E 37               4      SCF
001B1B E87F C0              11      RET NZ      ;念のため(クラスタ数が16ビットを超える場合)
001B1C E880 23               6      INC HL
001B1D E881 23               6      INC HL
001B1E E882 DD7508          19      LD  (IX+8),L    ;DPB_08_MAXCL
001B21 E885 DD7409          19      LD  (IX+9),H
                                
001B24 E888 FD7E15          19      LD  A,(IY+21)   ;BPB_Media
001B27 E88B DD7706          19      LD  (IX+6),A    ;DPB_06_FATID
                                
001B2A E88E FD7E10          19      LD  A,(IY+16)   ;BPB_NumFATs
001B2D E891 C6FE             7      ADD A,0-2       ;>2:CF=1
001B2F E893 FD7E0C          19      LD  A,(IY+12)   ;BPB_BytsPerSec
001B32 E896 6F               4      LD  L,A
001B33 E897 3002            12      JR  NC,BPBFAT1
001B35 E899 F680             7      OR  080H
       E89B                     BPBFAT1:
001B37 E89B DD770F          19      LD  (IX+00FH),A ;DPB_0F_BPS
001B3A E89E 2D               4      DEC L       ;以下のセクタサイズに合致しない場合はCF=1でエラーにする
001B3B E89F C8              11      RET Z       ;1セクタ256バイト
001B3C E8A0 2D               4      DEC L
001B3D E8A1 C8              11      RET Z       ;1セクタ512バイト
001B3E E8A2 2D               4      DEC L
001B3F E8A3 2D               4      DEC L
001B40 E8A4 C8              11      RET Z       ;1セクタ1024バイト
001B41 E8A5 37               4      SCF
001B42 E8A6 C9              10      RET
                                
       E8A7                     RDFATS:
001B43 E8A7 CDEDE8          17      CALL    FATSETUP
001B46 E8AA D8              11      RET C
001B47 E8AB CDB7E8          17      CALL    DRD24B
001B4A E8AE 2A7CF0          16      LD  HL,(_FATBF)
001B4D E8B1 7E               7      LD  A,(HL)
001B4E E8B2 C9              10      RET
                                
       E8B3                     DRD16:
001B4F E8B3 0E00             7      LD  C,0
       E8B5                     DRD24:
001B51 E8B5 0601             7      LD  B,1
       E8B7                     DRD24B:
001B53 E8B7 DDE5            15      PUSH    IX
001B55 E8B9 DD2AA8EF        20      LD  IX,(_DPB)
001B59 E8BD CD45EB          17  DRDPAT: CALL    FDRD        ;自己書き換え（ディスク読み込み）
       E8C0                     POP_IX_RET:
001B5C E8C0 DDE1            14      POP IX
001B5E E8C2 C9              10      RET
                                
       E8C3                     DWT16:
001B5F E8C3 0E00             7      LD  C,0
       E8C5                     DWT24:
001B61 E8C5 0601             7      LD  B,1
       E8C7                     DWT24B:
001B63 E8C7 DDE5            15      PUSH    IX
001B65 E8C9 DD2AA8EF        20      LD  IX,(_DPB)
001B69 E8CD CDEBEA          17  DWTPAT: CALL    FDWT        ;自己書き換え（ディスク書き込み）
001B6C E8D0 18EE            12      JR  POP_IX_RET
                                
       E8D2                     WTFAT:
001B6E E8D2 CDEDE8          17      CALL    FATSETUP
001B71 E8D5 D4C7E8          17      CALL    NC,DWT24B
001B74 E8D8 D8              11      RET C
001B75 E8D9 DDCB0F7E        20      BIT 7,(IX+00FH) ;DPB_0F_BPS
001B79 E8DD C8              11      RET Z       ;予備FATが無い
001B7A E8DE CDF4E8          17      CALL    FATS2
001B7D E8E1 E5              11      PUSH    HL      ;予備FAT
001B7E E8E2 DD6E00          19      LD  L,(IX+0)    ;DPB_00_FATLN
001B81 E8E5 DD6601          19      LD  H,(IX+1)
001B84 E8E8 19              11      ADD HL,DE
001B85 E8E9 EB               4      EX  DE,HL
001B86 E8EA E1              10      POP HL
001B87 E8EB 18DA            12      JR  DWT24B
                                ;------------------------
                                ;FATのセットアップ
                                ;out
                                ;   B  : FATセクタ数
                                ;   DE : FAT先頭セクタ番号
                                ;   HL : FATバッファポインタ
                                ;   CF : 1=ドライブ切り替えエラー
                                ;note
                                ;   FATサイズがFATバッファを超える場合は
                                ;   対象クラスタ領域==(_FATIX)によって
                                ;   FAT12:対象クラスタ1024毎に1.5KBを切り替える
                                ;   FAT16:対象クラスタ1024毎に2KBを切り替える
                                ;------------------------
       E8ED                     FATSETUP:
001B89 E8ED 3AAAEF          13      LD  A,(_FATDRV)
001B8C E8F0 CDFDE9          17      CALL    CHGDRVR     ;ドライブ切り替え
001B8F E8F3 D8              11      RET C
       E8F4                     FATS2:
001B90 E8F4 DD7E0F          19      LD  A,(IX+00FH) ;DPB_0F_BPS 512=2 1024=4
001B93 E8F7 0F               4      RRCA
001B94 E8F8 CD21E9          17  FATSX:  CALL    FATSETUP12  ;自己書き換え
001B97 E8FB 210000          10      LD  HL,0
001B9A E8FE 4A               4      LD  C,D
001B9B E8FF 54               4      LD  D,H
001B9C E900 3AABEF          13      LD  A,(_FATIX)  ;範囲FAT12:0-3/FAT16:0-63(0-03FH):65535*2/2048
001B9F E903 47               4      LD  B,A
001BA0 E904 04               4      INC B
001BA1 E905 DD7E00          19      LD  A,(IX+0)    ;DPB_00_FATLN
       E908                     FAT_SKP:
001BA4 E908 05               4      DEC B
001BA5 E909 2805            12      JR  Z,FAT1
001BA7 E90B 19              11      ADD HL,DE
001BA8 E90C 93               4      SUB E
001BA9 E90D 30F9            12      JR  NC,FAT_SKP
001BAB E90F C9              10      RET
       E910                     FAT1:
001BAC E910 EB               4      EX  DE,HL
001BAD E911 B9               4      CP  C       ;C=FATバッファに読み込めるセクタ数
001BAE E912 3801            12      JR  C,FAT2
001BB0 E914 79               4      LD  A,C
       E915                     FAT2:
001BB1 E915 47               4      LD  B,A
                                
001BB2 E916 2AFAF0          16      LD  HL,(_FATPS) ;fat sector pos
001BB5 E919 19              11      ADD HL,DE
001BB6 E91A EB               4      EX  DE,HL
001BB7 E91B 2A7CF0          16      LD  HL,(_FATBF)
001BBA E91E AF               4      XOR A       ;CF=0
001BBB E91F 4F               4      LD  C,A
001BBC E920 C9              10      RET
                                ;
                                ;   FATバッファに読み込める最大のセクタ数と_FATIXで進めるセクタ数
                                ;   FATSETUP* (FAT12/FAT16)
                                ;out
                                ;   D : FATバッファに読み込める最大のセクタ数
                                ;   E : _FATIXで進めるセクタ数
       E921                     FATSETUP12:
001BBD E921 110606          10      LD  DE,0606H    ;256
001BC0 E924 D8              11      RET C
001BC1 E925 110303          10      LD  DE,0303H    ;512
001BC4 E928 0F               4      RRCA
001BC5 E929 D8              11      RET C
001BC6 E92A 110102          10      LD  DE,0201H    ;1024
001BC9 E92D C9              10      RET
                                
       E92E                     FATSETUP16:
001BCA E92E 110808          10      LD  DE,0808H    ;256
001BCD E931 D8              11      RET C
001BCE E932 110404          10      LD  DE,0404H
001BD1 E935 0F               4      RRCA            ;512
001BD2 E936 D8              11      RET C
001BD3 E937 110202          10      LD  DE,0202H    ;1024
001BD6 E93A C9              10      RET
                                
       E93B                     CHGDRV:
001BD7 E93B E5              11      PUSH    HL
001BD8 E93C 2189EF          10      LD  HL,_DSK
001BDB E93F BE               7      CP  (HL)
001BDC E940 280A            12      JR  Z,CHGDRVE
       E942                     CHGDRV1:
001BDE E942 DDE5            15      PUSH    IX
001BE0 E944 CD4EE9          17      CALL    CHGDRV0
001BE3 E947 3A89EF          13      LD  A,(_DSK)
001BE6 E94A DDE1            14      POP IX
       E94C                     CHGDRVE:
001BE8 E94C E1              10      POP HL
001BE9 E94D C9              10      RET
                                
       E94E                     CHGDRV0:
001BEA E94E 6F               4      LD  L,A
001BEB E94F CDDCEF          17      CALL    _GETDPB
001BEE E952 D8              11      RET C
001BEF E953 DD22A8EF        20      LD  (_DPB),IX
001BF3 E957 7D               4      LD  A,L
001BF4 E958 3289EF          13      LD  (_DSK),A
       E95B                     CHGDRV2:
001BF7 E95B C5              11      PUSH    BC
001BF8 E95C D5              11      PUSH    DE
001BF9 E95D ED73B2E9        20      LD  (SPPAT2+1),SP
001BFD E961 F3               4      DI
001BFE E962 DDF9            10      LD  SP,IX
                                
001C00 E964 E1              10      POP HL      ;DPB_00_FATLN
001C01 E965 E1              10      POP HL      ;DPB_02_DRD
001C02 E966 22BEE8          16      LD  (DRDPAT+1),HL
                                
001C05 E969 E1              10      POP HL
001C06 E96A 22CEE8          16      LD  (DWTPAT+1),HL   ;DPB_04_DWT
                                
001C09 E96D E1              10      POP HL      ;L=DPB_06_FATID H=DPB_07_SECPCL
001C0A E96E 7C               4      LD  A,H
001C0B E96F 32CDDF          13      LD  (SPCPAT+1),A    ;1クラスタの論理セクタ数
001C0E E972 3D               4      DEC A
001C0F E973 325DE7          13      LD  (NCPAT+1),A
                                
001C12 E976 E1              10      POP HL      ;DPB_08_MAXCL
001C13 E977 7D               4      LD  A,L
001C14 E978 32ECDF          13      LD  (CLPAT2+1),A
001C17 E97B 7C               4      LD  A,H
001C18 E97C 32E8DF          13      LD  (CLPAT1+1),A
001C1B E97F 2B               6      DEC HL
001C1C E980 22F0E1          16      LD  (MAXCLP+1),HL
                                
001C1F E983 E1              10      POP HL      ;L=DPB_0A_FDMODE H=DPB_0B_DIRSCNT
001C20 E984 7D               4      LD  A,L
001C21 E985 F6FE             7      OR  0FEH
001C23 E987 32B3EF          13      LD  (FDMODE+1),A
001C26 E98A 07               4      RLCA
001C27 E98B E603             7      AND 3
001C29 E98D 328AEA          13      LD  (FSPAT+1),A
001C2C E990 4C               4      LD  C,H
                                
001C2D E991 E1              10      POP HL      ;L=DPB_0C_MAXCYL H=DPB_0D_MAXSEC
                                
001C2E E992 E1              10      POP HL      ;L=DPB_0E_FATPS H=DPB_0F_BPS
001C2F E993 7C               4      LD  A,H     ;DPB_0F_BPS
001C30 E994 E607             7      AND 7
001C32 E996 32EBE4          13      LD  (SECSZ+2),A ;1セクタのサイズの上位1バイト 0x400 - 0x200 - 0x100
                                                ;1セクタ512 2D/2DD/2HC/2HQ(2HD1.44MB)/EMM/BRAM等
                                                ;1セクタ1024 2HD/2HDE98
                                                ;1セクタ256 GRAM/RAMF/CMOS/等
                                                ;1024   512 256
                                                ;4  2   1
001C35 E999 87               4      ADD A,A     ;8  4   2
001C36 E99A 87               4      ADD A,A     ;010H   8   4
001C37 E99B 87               4      ADD A,A     ;020H   010H    8
001C38 E99C 3249DE          13      LD  (SDECPAT+1),A   ;1セクタ辺りのディレクトリエントリ数
                                
001C3B E99F 2600             7      LD  H,0
001C3D E9A1 22FAF0          16      LD  (_FATPS),HL
                                
001C40 E9A4 E1              10      POP HL      ;L=DPB_10_DIRPS
001C41 E9A5 22FCF0          16      LD  (_DIRPS),HL
                                
001C44 E9A8 E1              10      POP HL      ;L=DPB_12_DEVICE H=DPB_13_UNITNO
001C45 E9A9 7C               4      LD  A,H
001C46 E9AA 3284EF          13      LD  (_DRIVE),A
                                
001C49 E9AD E1              10      POP HL      ;DPB_14_ADDCL16
001C4A E9AE 22DDDF          16      LD  (CLSPAT+1),HL
                                
001C4D E9B1 310000          10  SPPAT2: LD  SP,0        ;元のSPを復元
001C50 E9B4 FB               4      EI
001C51 E9B5 2AFCF0          16      LD  HL,(_DIRPS)
001C54 E9B8 0600             7      LD  B,0
001C56 E9BA 09              11      ADD HL,BC
001C57 E9BB 2264DE          16      LD  (MD_PAT+1),HL
                                
001C5A E9BE 2AF0E1          16      LD  HL,(MAXCLP+1);
001C5D E9C1 11F60F          10      LD  DE,4086
001C60 E9C4 B7               4      OR  A
001C61 E9C5 ED52            15      SBC HL,DE
001C63 E9C7 300F            12      JR  NC,SETFAT16
001C65 E9C9 21E3E6          10      LD  HL,GNCL     ;FAT12
001C68 E9CC 1106E7          10      LD  DE,SNCL
001C6B E9CF 0121E9          10      LD  BC,FATSETUP12
001C6E E9D2 DDCB0FAE        23      RES 5,(IX+00FH) ;DPB_0F_BPS(FAT12)
001C72 E9D6 180D            12      JR  EXTRA1
       E9D8                     SETFAT16:
001C74 E9D8 213AE7          10      LD  HL,GNCL16   ;FAT16
001C77 E9DB 1147E7          10      LD  DE,SNCL16
001C7A E9DE 012EE9          10      LD  BC,FATSETUP16
001C7D E9E1 DDCB0FEE        23      SET 5,(IX+00FH) ;DPB_0F_BPS(FAT16)
       E9E5                     EXTRA1:
001C81 E9E5 22F8EF          16      LD  (GNCPAT+1),HL
001C84 E9E8 ED53FBEF        20      LD  (SNCPAT+1),DE
001C88 E9EC ED43F9E8        20      LD  (FATSX+1),BC
001C8C E9F0 D1              10      POP DE
001C8D E9F1 C1              10      POP BC
001C8E E9F2 AF               4      XOR A
001C8F E9F3 C9              10      RET
                                
       E9F4                     GETDPBD:
001C90 E9F4 DDE3            23      EX  (SP),IX
001C92 E9F6 DDE5            15      PUSH    IX
001C94 E9F8 3A88EF          13      LD  A,(_DRV)
001C97 E9FB 1807            12      JR  GETDPB1
                                
       E9FD                     CHGDRVR:
001C99 E9FD CDD9EF          17      CALL    _CHGDRV
001C9C EA00 D8              11      RET C
001C9D EA01 3A89EF          13      LD  A,(_DSK)
       EA04                     GETDPB1:
001CA0 EA04 C3DCEF          10      JP  _GETDPB
                                
       EA07                     GETDPB:
001CA3 EA07 FE08             7      CP  8
001CA5 EA09 3F               4      CCF
001CA6 EA0A D8              11      RET C
001CA7 EA0B 0F               4      RRCA
001CA8 EA0C 0F               4      RRCA
001CA9 EA0D 0F               4      RRCA
001CAA EA0E DD                      DB  0DDH        ;Z80未定義命令
001CAB EA0F 6F               4      LD  L,A     ;LD IXL,A
001CAC EA10 DD                      DB  0DDH        ;Z80未定義命令
001CAD EA11 26F1             7      LD  H,DEVICE/256    ;LD IXH,DEVICE/256
001CAF EA13 DD7E00          19      LD  A,(IX+0)    ;DPB_00_FATLN
001CB2 EA16 B7               4      OR  A       ;CF=0の為
001CB3 EA17 DDCB0F6E        20      BIT 5,(IX+00FH) ;DPB_0F_BPS
001CB7 EA1B C0              11      RET NZ      ;FAT16
001CB8 EA1C DDCB126E        20      BIT 5,(IX+012H) ;DPB_12_DEVICE
001CBC EA20 C0              11      RET NZ      ;BPB
001CBD EA21 FE01             7      CP  001H        ;A=0 THEN CF=1
001CBF EA23 C9              10      RET
                                
       EA24                     _SYS5F:
001CC0 EA24 AF               4      XOR A
       EA25                     FFLUSH:
001CC1 EA25 F5              11      PUSH    AF
001CC2 EA26 3EFF             7      LD  A,0FFH
001CC4 EA28 3239EF          13      LD  (SFILE),A
001CC7 EA2B CD21E6          17      CALL    DWTX
001CCA EA2E 3EFF             7      LD  A,0FFH
001CCC EA30 32A5EF          13      LD  (_DBDRV),A
001CCF EA33 CD6BE6          17      CALL    WTFATX
001CD2 EA36 AF               4      XOR A
001CD3 EA37 32ABEF          13      LD  (_FATIX),A
001CD6 EA3A 2F               4      CPL
001CD7 EA3B 32AAEF          13      LD  (_FATDRV),A
001CDA EA3E F1              10      POP AF
001CDB EA3F C9              10      RET
                                
[EOF:LDDIO.ASM:SHIFT_JIS]
                                    INCLUDE "M7DISK.ASM"
                                
                                ;   LSX-Dodgers DISK
                                ;   MZ-700/1500
                                
       EA40                     SEEK:
001CDC EA40 0610             7      LD  B,16
001CDE EA42 DD4E0D          19  MAXSEC: LD  C,(IX+0DH)  ;DPB_0D_MAXSEC
001CE1 EA45 AF               4      XOR A
001CE2 EA46 EB               4      EX  DE,HL
       EA47                     DIV1:
001CE3 EA47 29              11      ADD HL,HL
001CE4 EA48 8F               4      ADC A,A
001CE5 EA49 B9               4      CP  C
001CE6 EA4A 3802            12      JR  C,DIV2
001CE8 EA4C 91               4      SUB C
001CE9 EA4D 2C               4      INC L
       EA4E                     DIV2:
001CEA EA4E 10F7            13      DJNZ    DIV1
                                
001CEC EA50 3C               4      INC A   ;最小のセクタは１固定
001CED EA51 55               4      LD  D,L ;TRACK
001CEE EA52 5F               4      LD  E,A ;SECTOR
                                
001CEF EA53 3A84EF          13      LD  A,(_DRIVE)
001CF2 EA56 FE04             7      CP  4
001CF4 EA58 3F               4      CCF
001CF5 EA59 D8              11      RET C
001CF6 EA5A F684             7      OR  084H        ;Motor on + ドライブセレクト有効
001CF8 EA5C D3DC            11      OUT (0DCH),A
001CFA EA5E CB3A             8      SRL D       ;CYLINDER
001CFC EA60 9F               4      SBC A,A
001CFD EA61 D3DD            11      OUT (0DDH),A    ;SIDE
                                
001CFF EA63 CDA0EA          17      CALL    SETMODE
001D02 EA66 D8              11      RET C
                                
001D03 EA67 CDD5EA          17      CALL    DRIVE
001D06 EA6A FEFF             7      CP  0FFH        ;A=0FFH Unknown CYLINDER
001D08 EA6C CCBCEA          17      CALL    Z,FDCRES    ;Restore
001D0B EA6F 2F               4      CPL         ;データバスが負論理
001D0C EA70 D3D9            11      OUT (0D9H),A    ;Currrent CYLINDER
001D0E EA72 2F               4      CPL         ;データバスが負論理
001D0F EA73 92               4      SUB D
001D10 EA74 C8              11      RET Z       ;No seek
                                
001D11 EA75 3A86EF          13      LD  A,(_ISEEK)
001D14 EA78 4F               4      LD  C,A
                                
001D15 EA79 DD7E0C          19      LD  A,(IX+00CH) ;DPB_0C_MAXCYL
001D18 EA7C 3D               4      DEC A
001D19 EA7D BA               4      CP  D       ;Over CYLINDER
001D1A EA7E D8              11      RET C
                                
001D1B EA7F 7A               4      LD  A,D
001D1C EA80 2F               4      CPL         ;データバスが負論理
001D1D EA81 D3DB            11      OUT (0DBH),A
001D1F EA83 72               7      LD  (HL),D
                                
001D20 EA84 0E18             7      LD  C,018H      ;Seek
       EA86                     FDCCMD2:
001D22 EA86 3A85EF          13      LD  A,(_SEEKSP)
001D25 EA89 E6FF             7  FSPAT:  AND 0FFH
001D27 EA8B B1               4      OR  C
                                
       EA8C                     FDCCMD:
001D28 EA8C CDCCEA          17      CALL    COMSET
       EA90                     FDCSMC  EQU $+1
001D2B EA8F 3E80             7      LD  A,080H      ;FDC COMMAND(Self-modifying code)
001D2D EA91 E620             7      AND 020H        ;Write data Write track
001D2F EA93 3C               4      INC A
                                
       EA94                     SST:
001D30 EA94 0E00             7      LD  C,0
       EA96                     SST1:
001D32 EA96 0D               4      DEC C       ; 4
001D33 EA97 20FD            12      JR  NZ,SST1     ;12 * 256 / 4 = About 1ms
001D35 EA99 3D               4      DEC A
001D36 EA9A 20FA            12      JR  NZ,SST1
                                
001D38 EA9C 3C               4      INC A       ;A=1
001D39 EA9D CDA5EA          17      CALL    READY
       EAA0                     SETMODE:
001D3C EAA0 CDCFEA          17      CALL    DELAY0      ;Head select time
001D3F EAA3 3E81             7      LD  A,081H
       EAA5                     READY:
001D41 EAA5 32AFEA          13      LD  (WAITA),A
001D44 EAA8 E5              11      PUSH    HL
001D45 EAA9 26F8             7      LD  H,0F8H
       EAAB                     READY2:
001D47 EAAB DBD8            11      IN  A,(0D8H)
001D49 EAAD 2F               4      CPL         ;データバスが負論理
       EAAF                     WAITA   EQU $+1
001D4A EAAE E681             7      AND 081H        ;NOT READY,BUSY
001D4C EAB0 2808            12      JR  Z,READYE
001D4E EAB2 E3              19      EX  (SP),HL     ;wait 19clock
001D4F EAB3 E3              19      EX  (SP),HL     ; //
001D50 EAB4 2B               6      DEC HL
001D51 EAB5 7C               4      LD  A,H
001D52 EAB6 B5               4      OR  L
001D53 EAB7 20F2            12      JR  NZ,READY2
001D55 EAB9 37               4      SCF
       EABA                     READYE:
001D56 EABA E1              10      POP HL
001D57 EABB C9              10      RET
                                
       EABC                     FDCRES:
001D58 EABC 3600            10      LD  (HL),0
001D5A EABE 0E08             7      LD  C,8
001D5C EAC0 18C4            12      JR  FDCCMD2
                                
       EAC2                     FDMOFF:
001D5E EAC2 AF               4      XOR A       ;Motor off(ドライブセレクト無効)
001D5F EAC3 D3DC            11      OUT (0DCH),A
001D61 EAC5 C9              10      RET
                                
       EAC6                     SECSET:
001D62 EAC6 F5              11      PUSH    AF
001D63 EAC7 7B               4      LD  A,E
001D64 EAC8 2F               4      CPL         ;データバスが負論理
001D65 EAC9 D3DA            11      OUT (0DAH),A
001D67 EACB F1              10      POP AF
       EACC                     COMSET:
001D68 EACC 2F               4      CPL         ;データバスが負論理
001D69 EACD D3D8            11      OUT (0D8H),A
       EACF                     DELAY0:
001D6B EACF 3E1A             7      LD  A,26
       EAD1                     DELAY:
001D6D EAD1 3D               4      DEC A
001D6E EAD2 20FD            12      JR  NZ,DELAY
001D70 EAD4 C9              10      RET
                                
       EAD5                     DRIVE:
001D71 EAD5 2A84EF          16      LD  HL,(_DRIVE)
001D74 EAD8 26EF             7      LD  H,_CYL0/256
001D76 EADA CBFD             8      SET 7,L
001D78 EADC 7E               7      LD  A,(HL)
001D79 EADD C9              10      RET
                                
       EADE                     RNF:
001D7A EADE CDD5EA          17      CALL    DRIVE
001D7D EAE1 36FF            10      LD  (HL),0FFH
001D7F EAE3 C9              10      RET
                                
001D80 EAE4 02                  RETRY:  DB  2
                                
                                
                                ;   FLOPPY DISK DRIVER
                                
       EAE5                     WTTRK:
001D81 EAE5 0601             7      LD  B,1
001D83 EAE7 3EF4             7      LD  A,0F4H
001D85 EAE9 1802            12      JR  WTTRK1
       EAEB                     FDWT:
001D87 EAEB 3EA0             7      LD  A,0A0H
       EAED                     WTTRK1:
001D89 EAED 3290EA          13      LD  (FDCSMC),A
       EAF0                     DWTBL:
001D8C EAF0 78               4      LD  A,B
001D8D EAF1 3230EB          13      LD  (WTBSMC),A
001D90 EAF4 3E02             7      LD  A,2     ;Retry count
001D92 EAF6 32E4EA          13      LD  (RETRY),A
                                
       EAF9                     DWT0:
001D95 EAF9 D5              11      PUSH    DE
001D96 EAFA E5              11      PUSH    HL
001D97 EAFB CD40EA          17      CALL    SEEK        ;Write disk
001D9A EAFE E1              10      POP HL
001D9B EAFF 383A            12      JR  C,ERRDW
001D9D EB01 F3               4      DI
001D9E EB02 3A90EA          13      LD  A,(FDCSMC)
001DA1 EB05 CDC6EA          17      CALL    SECSET
001DA4 EB08 0EDB             7      LD  C,0DBH
       EB0A                     DWT1:
001DA6 EB0A 7E               7      LD  A,(HL)
001DA7 EB0B 2F               4      CPL         ;データバスが負論理
001DA8 EB0C 57               4      LD  D,A
                                
       EB0D                     DWT2:
001DA9 EB0D DBD8            11      IN  A,(0D8H)
001DAB EB0F 2F               4      CPL         ;データバスが負論理
001DAC EB10 0F               4      RRCA
001DAD EB11 3008            12      JR  NC,DWT4
001DAF EB13 0F               4      RRCA
001DB0 EB14 30F7            12      JR  NC,DWT2
       EB16                     DWT3:
001DB2 EB16 ED51            12      OUT (C),D
001DB4 EB18 23               6      INC HL
001DB5 EB19 18EF            12      JR  DWT1
                                
       EB1B                     DWT4:
001DB7 EB1B 3D               4      DEC A
001DB8 EB1C 28F8            12      JR  Z,DWT3
001DBA EB1E 3C               4      INC A
001DBB EB1F FB               4      EI
001DBC EB20 D1              10      POP DE
001DBD EB21 13               6      INC DE
001DBE EB22 CDC2EA          17      CALL    FDMOFF
001DC1 EB25 2808            12      JR  Z,DISKOK_WT
001DC3 EB27 CD92EB          17      CALL    DISKC
001DC6 EB2A 20CD            12      JR  NZ,DWT0
001DC8 EB2C B7               4      OR  A
001DC9 EB2D 2005            12      JR  NZ,ERRW
                                
       EB2F                     DISKOK_WT:
       EB30                     WTBSMC  EQU $+1
001DCB EB2F 0601             7      LD  B,1
001DCD EB31 10BD            13      DJNZ    DWTBL
001DCF EB33 C9              10      RET
                                
       EB34                     ERRW:
001DD0 EB34 3EFF             7      LD  A,0FFH
       EB36                     ERRZ:
001DD2 EB36 BF               4      CP  A
001DD3 EB37 37               4      SCF
001DD4 EB38 C3C2EA          10      JP  FDMOFF
                                
       EB3B                     ERRDW:
001DD7 EB3B D1              10      POP DE
001DD8 EB3C CDA3EB          17      CALL    DELP
001DDB EB3F 20B8            12      JR  NZ,DWT0
001DDD EB41 B7               4      OR  A
001DDE EB42 20F0            12      JR  NZ,ERRW
001DE0 EB44 C9              10      RET
                                
       EB45                     FDRD:
001DE1 EB45 3E80             7      LD  A,080H
001DE3 EB47 3290EA          13      LD  (FDCSMC),A
       EB4A                     DRDBL:
001DE6 EB4A 78               4      LD  A,B
001DE7 EB4B 3284EB          13      LD  (RDBSMC),A
001DEA EB4E 3E02             7      LD  A,2     ;Retry count
001DEC EB50 32E4EA          13      LD  (RETRY),A
       EB53                     DRD0:
001DEF EB53 D5              11      PUSH    DE
001DF0 EB54 E5              11      PUSH    HL
001DF1 EB55 CD40EA          17      CALL    SEEK        ;Read disk
001DF4 EB58 E1              10      POP HL
001DF5 EB59 382D            12      JR  C,ERRDR
001DF7 EB5B F3               4      DI
001DF8 EB5C 3A90EA          13      LD  A,(FDCSMC)
001DFB EB5F CDC6EA          17      CALL    SECSET
       EB62                     DRD1:
001DFE EB62 DBD8            11      IN  A,(0D8H)
001E00 EB64 2F               4      CPL         ;データバスが負論理
001E01 EB65 0F               4      RRCA
001E02 EB66 300A            12      JR  NC,DRD3
001E04 EB68 0F               4      RRCA
001E05 EB69 30F7            12      JR  NC,DRD1
001E07 EB6B DBDB            11      IN  A,(0DBH)
001E09 EB6D 2F               4      CPL         ;データバスが負論理
001E0A EB6E 77               7      LD  (HL),A
001E0B EB6F 23               6      INC HL
001E0C EB70 18F0            12      JR  DRD1
                                
       EB72                     DRD3:
001E0E EB72 B7               4      OR  A
001E0F EB73 FB               4      EI
001E10 EB74 D1              10      POP DE
001E11 EB75 13               6      INC DE
001E12 EB76 CDC2EA          17      CALL    FDMOFF
001E15 EB79 2808            12      JR  Z,DISKOK_RD
001E17 EB7B CD92EB          17      CALL    DISKC
001E1A EB7E 20D3            12      JR  NZ,DRD0
001E1C EB80 B7               4      OR  A
001E1D EB81 20B1            12      JR  NZ,ERRW
                                
       EB83                     DISKOK_RD:
       EB84                     RDBSMC  EQU $+1
001E1F EB83 0601             7      LD  B,1
001E21 EB85 10C3            13      DJNZ    DRDBL
001E23 EB87 C9              10      RET
                                
       EB88                     ERRDR:
001E24 EB88 D1              10      POP DE
001E25 EB89 CDA3EB          17      CALL    DELP
001E28 EB8C 20C5            12      JR  NZ,DRD0
001E2A EB8E B7               4      OR  A
001E2B EB8F 20A3            12      JR  NZ,ERRW
001E2D EB91 C9              10      RET
       EB92                     DISKC:
001E2E EB92 1B               6      DEC DE
001E2F EB93 CB5F             8      BIT 3,A
001E31 EB95 C4DEEA          17      CALL    NZ,RNF
       EB98                     DISKD:
001E34 EB98 E5              11      PUSH    HL
001E35 EB99 21E4EA          10      LD  HL,RETRY
001E38 EB9C 35              11      DEC (HL)
001E39 EB9D E1              10      POP HL
001E3A EB9E 200C            12      JR  NZ,ERR      ;Retry
001E3C EBA0 B7               4      OR  A
001E3D EBA1 2809            12      JR  Z,ERR       ;Error
                                
       EBA3                     DELP:
001E3F EBA3 CDDEEA          17      CALL    RNF
001E42 EBA6 CDC2EA          17      CALL    FDMOFF
001E45 EBA9 3EFF             7      LD  A,0FFH
       EBAB                     AERRZ:
001E47 EBAB BF               4      CP  A
       EBAC                     ERR:
001E48 EBAC 3EFF             7      LD  A,0FFH
001E4A EBAE C9              10      RET
                                
       EFB2                     FDMODE  EQU TVRAMTOP
[EOF:M7DISK.ASM:SHIFT_JIS]
                                    INCLUDE "M7DISK2.ASM"
                                
                                ;   LSX-Dodgers DISK2
                                ;   MZ-700/1500
                                
                                ;   EMM DRIVER
                                ;   1セクタ可変(256/512/1024)
                                
       EBAF                     EDWT:
001E4B EBAF F5              11      PUSH    AF
001E4C EBB0 CDCEEB          17      CALL    EADR
001E4F EBB3 0600             7      LD  B,0
       EBB5                     EDWT1:
001E51 EBB5 EDB3                    OTIR
001E53 EBB7 3D               4      DEC A
001E54 EBB8 20FB            12      JR  NZ,EDWT1
001E56 EBBA 180B            12      JR  EDRW1
                                
       EBBC                     EDRD:
001E58 EBBC C5              11      PUSH    BC
001E59 EBBD CDCEEB          17      CALL    EADR
001E5C EBC0 0600             7      LD  B,0
       EBC2                     EDRD1:
001E5E EBC2 EDB2                    INIR
001E60 EBC4 3D               4      DEC A
001E61 EBC5 20FB            12      JR  NZ,EDRD1
       EBC7                     EDRW1:
001E63 EBC7 F1              10      POP AF
001E64 EBC8 83               4      ADD A,E ;セクタを進める
001E65 EBC9 5F               4      LD  E,A
001E66 EBCA 8A               4      ADC A,D
001E67 EBCB 93               4      SUB E
001E68 EBCC 57               4      LD  D,A
001E69 EBCD C9              10      RET
                                
       EBCE                     EADR:
001E6A EBCE C5              11      PUSH    BC
001E6B EBCF D5              11      PUSH    DE
001E6C EBD0 EB               4      EX  DE,HL
001E6D EBD1 29              11      ADD HL,HL
001E6E EBD2 DD4E0D          19      LD  C,(IX+00DH) ;DPB_0D_MAXSEC
001E71 EBD5 DD460C          19      LD  B,(IX+00CH) ;DPB_0C_MAXCYL
001E74 EBD8 09              11      ADD HL,BC
001E75 EBD9 DD4E13          19      LD  C,(IX+013H) ;DPB_13_UNITNO
001E78 EBDC ED49            12      OUT (C),C
001E7A EBDE 0C               4      INC C
001E7B EBDF ED69            12      OUT (C),L
001E7D EBE1 0C               4      INC C
001E7E EBE2 ED61            12      OUT (C),H
001E80 EBE4 0C               4      INC C
001E81 EBE5 EB               4      EX  DE,HL
001E82 EBE6 D1              10      POP DE
001E83 EBE7 DD460F          19      LD  B,(IX+00FH) ;DPB_0F_BPS
001E86 EBEA F1              10      POP AF
       EBEB                     EADR1:              ;読み込むセクタ数と1クラスタのセクタ数を掛ける
001E87 EBEB CB18             8      RR  B
001E89 EBED D8              11      RET C
001E8A EBEE 87               4      ADD A,A
001E8B EBEF 18FA            12      JR  EADR1
                                
                                ;   CMOS BACKUP MEMORY DRIVER(32KB)
                                ;   1セクタ256
                                
       EBF1                     CDWT:
001E8D EBF1 78               4      LD  A,B
001E8E EBF2 DD4E13          19      LD  C,(IX+013H) ;DPB_13_UNITNO
001E91 EBF5 ED40            12      IN  B,(C)       ;アドレスカウンタを0000にリセット
001E93 EBF7 ED59            12      OUT (C),E       ;W)アドレスカウンタ上位
001E95 EBF9 0C               4      INC C       ;C=F9
001E96 EBFA 0C               4      INC C       ;C=FA
001E97 EBFB 0600             7      LD  B,0
       EBFD                     CDWT1:
001E99 EBFD EDB3                    OTIR            ;W)データ書き込み・アドレスカウンタ+1
001E9B EBFF 13               6      INC DE
001E9C EC00 3D               4      DEC A
001E9D EC01 20FA            12      JR  NZ,CDWT1
001E9F EC03 A7               4      AND A
001EA0 EC04 C9              10      RET
                                
       EC05                     CDRD:
001EA1 EC05 78               4      LD  A,B
001EA2 EC06 DD4E13          19      LD  C,(IX+013H) ;DPB_13_UNITNO
001EA5 EC09 ED40            12      IN  B,(C)       ;アドレスカウンタを0000にリセット
001EA7 EC0B ED59            12      OUT (C),E       ;W)アドレスカウンタ上位
001EA9 EC0D 0C               4      INC C       ;C=F9
001EAA EC0E 0600             7      LD  B,0
       EC10                     CDRD1:
001EAC EC10 EDB2                    INIR            ;R)データ読み出し・アドレスカウンタ+1
001EAE EC12 13               6      INC DE
001EAF EC13 3D               4      DEC A
001EB0 EC14 20FA            12      JR  NZ,CDRD1
001EB2 EC16 A7               4      AND A
001EB3 EC17 C9              10      RET
                                
                                ;   RAM DISK DRIVER (64KB)
                                ;   1セクタ256
                                
       EC18                     RDWT:
001EB4 EC18 78               4      LD  A,B
001EB5 EC19 43               4      LD  B,E     ;B=アドレスカウンタ上位
001EB6 EC1A 0EEB             7      LD  C,0EBH
001EB8 EC1C ED71            12      OUT (C),0       ;0=アドレスカウンタ下位
001EBA EC1E 0D               4      DEC C       ;EA(W)データ書き込み・アドレスカウンタ+1
001EBB EC1F 0600             7      LD  B,0
       EC21                     RDWT1:
001EBD EC21 EDB3                    OTIR
001EBF EC23 13               6      INC DE
001EC0 EC24 3D               4      DEC A
001EC1 EC25 20FA            12      JR  NZ,RDWT1
001EC3 EC27 A7               4      AND A
001EC4 EC28 C9              10      RET
                                
       EC29                     RDRD:
001EC5 EC29 78               4      LD  A,B
001EC6 EC2A 43               4      LD  B,E     ;B=アドレスカウンタ上位
001EC7 EC2B 0EEB             7      LD  C,0EBH
001EC9 EC2D ED71            12      OUT (C),0       ;0=アドレスカウンタ下位
001ECB EC2F 0D               4      DEC C       ;EA(R)データ読み出し・アドレスカウンタ+1
001ECC EC30 0600             7      LD  B,0
       EC32                     RDRD1:
001ECE EC32 EDB2                    INIR
001ED0 EC34 13               6      INC DE
001ED1 EC35 3D               4      DEC A
001ED2 EC36 20FA            12      JR  NZ,RDRD1
001ED4 EC38 A7               4      AND A
001ED5 EC39 C9              10      RET
[EOF:M7DISK2.ASM:UTF_8]
                                
                                    INCLUDE "M7TABLE.ASM"
                                
                                ;   LSX-Dodgers TABLE 表示関連のテーブル
                                ;   MZ-700/1500
                                
       EC3A                     AT_TABLE:
001ED6 EC3A                         DS  TABLEAD-AT_TABLE
                                
       EC40                     KEY_TABLE:
001EDC EC40 12081E1F1C1D5C2F        DB  12H,08H,1EH,1FH,1CH,1DH,5CH,'/'
001EE4 EC48 5C5E2D2030392C2E        DB  5CH,'^','-',20H,'0','9',',','.'
001EEC EC50 3132333435363738        DB  '1','2','3','4','5','6','7','8'
001EF4 EC58 6162636465666768        DB  'a','b','c','d','e','f','g','h'
001EFC EC60 696A6B6C6D6E6F70        DB  'i','j','k','l','m','n','o','p'
001F04 EC68 7172737475767778        DB  'q','r','s','t','u','v','w','x'
001F0C EC70 797A405B5D000000        DB  'y','z','@','[',']',00H,00H,00H
001F14 EC78 001B3D09003B3A0D        DB  00H,1BH,'=',09H,00H,';',':',0DH
       EC80                     SHIFT_TABLE:
001F1C EC80 12081E1F1C1D5F3F        DB  12H,08H,1EH,1FH,1CH,1DH,'_','?'
001F24 EC88 7C7E3D2030293C3E        DB  '|','~','=',20H,'0',')','<','>'
001F2C EC90 2122232425262728        DB  '!','"','#','$','%','&',27H,'('
001F34 EC98 4142434445464748        DB  'A','B','C','D','E','F','G','H'
001F3C ECA0 494A4B4C4D4E4F50        DB  'I','J','K','L','M','N','O','P'
001F44 ECA8 5152535455565758        DB  'Q','R','S','T','U','V','W','X'
001F4C ECB0 595A607B7D000000        DB  'Y','Z','`','{','}',00H,00H,00H
001F54 ECB8 00003D09002B2A0D        DB  00H,00H,'=',09H,00H,'+','*',0DH
       ECC0                     CTRL_TABLE:
001F5C ECC0 12081E1F1C1D3F2F        DB  12H,08H,1EH,1FH,1CH,1DH,'?','/'
001F64 ECC8 2A2B2D2030392C2E        DB  '*','+','-',20H,'0','9',',','.'
001F6C ECD0 3132333435363738        DB  '1','2','3','4','5','6','7','8'
001F74 ECD8 0102030405060708        DB  01H,02H,03H,04H,05H,06H,07H,08H
001F7C ECE0 090A0B0C0D0E0F10        DB  09H,0AH,0BH,0CH,0DH,0EH,0FH,10H
001F84 ECE8 1112131415161718        DB  11H,12H,13H,14H,15H,16H,17H,18H
001F8C ECF0 191A1B5B5D000000        DB  19H,1AH,1BH,'[',']',00H,00H,00H
001F94 ECF8 00003D09003B3A0D        DB  00H,00H,'=',09H,00H,';',':',0DH
                                
                                ;   アドレス下位1バイトが0になるように
       ED00                     CD_TABLE:
001F9C ED00 00D1D2D3D4D5D6D0        DB  $00,$D1,$D2,$D3,$D4,$D5,$D6,$D0 ;月火水木金土日
001FA4 ED08 D8DCD9DADBD7CFCE        DB  $D8,$DC,$D9,$DA,$DB,$D7,$CF,$CE ;年円時分秒
001FAC ED10 601F5F5E1E1B7978        DB  $60,$1F,$5F,$5E,$1E,$1B,$79,$78 ;
001FB4 ED18 5C5D1C1D6DCACDC7        DB  $5C,$5D,$1C,$1D,$6D,$CA,$CD,$C7 ;
001FBC ED20 0061626364656667        DB  $00,$61,$62,$63,$64,$65,$66,$67 ; !"#$%&'
001FC4 ED28 68696B6A2F2A2E2D        DB  $68,$69,$6B,$6A,$2F,$2A,$2E,$2D ;()*+,-./
001FCC ED30 2021222324252627        DB  $20,$21,$22,$23,$24,$25,$26,$27 ;01234567
001FD4 ED38 28294F2C512B5749        DB  $28,$29,$4F,$2C,$51,$2B,$57,$49 ;89:;<=>?
001FDC ED40 5501020304050607        DB  $55,$01,$02,$03,$04,$05,$06,$07 ;@ABCDEFG
001FE4 ED48 08090A0B0C0D0E0F        DB  $08,$09,$0A,$0B,$0C,$0D,$0E,$0F ;HIJKLMNO
001FEC ED50 1011121314151617        DB  $10,$11,$12,$13,$14,$15,$16,$17 ;PQRSTUVW
001FF4 ED58 18191A52DD54507C        DB  $18,$19,$1A,$52,$DD,$54,$50,$7C ;XYZ[\]^_
001FFC ED60 5901020304050607        DB  $59,$01,$02,$03,$04,$05,$06,$07 ;`abcdefg   ATB:1
002004 ED68 08090A0B0C0D0E0F        DB  $08,$09,$0A,$0B,$0C,$0D,$0E,$0F ;hijklmno   ATB:1
00200C ED70 1011121314151617        DB  $10,$11,$12,$13,$14,$15,$16,$17 ;pqrstuvw   ATB:1
002014 ED78 18191ACB35CC705A        DB  $18,$19,$1A,$CB,$35,$CC,$70,$5A ;xyz{|}~    ATB:1
00201C ED80 415346444847B49E        DB  $41,$53,$46,$44,$48,$47,$B4,$9E ;トランプ〇●をぁ   ATB:1
002024 ED88 B2B6BABE9FB3B7BB        DB  $B2,$B6,$BA,$BE,$9F,$B3,$B7,$BB ;ぃぅぇぉゃゅょっ   ATB:1
00202C ED90 BFA385A4A5A69487        DB  $BF,$A3,$85,$A4,$A5,$A6,$94,$87 ;ーあいうえおかき   ATB:1
002034 ED98 889C829884929083        DB  $88,$9C,$82,$98,$84,$92,$90,$83 ;くけこさしすせそ   ATB:1
00203C EDA0 F0BD9DB1B5B9B49E        DB  $F0,$BD,$9D,$B1,$B5,$B9,$B4,$9E ;　。「」、・ヲァ
002044 EDA8 B2B6BABE9FB3B7BB        DB  $B2,$B6,$BA,$BE,$9F,$B3,$B7,$BB ;ィゥェォャョュッ
00204C EDB0 BFA385A4A5A69487        DB  $BF,$A3,$85,$A4,$A5,$A6,$94,$87 ;ーアイウエオカキ
002054 EDB8 889C829884929083        DB  $88,$9C,$82,$98,$84,$92,$90,$83 ;クケコサシスセソ
00205C EDC0 91819A97939589A1        DB  $91,$81,$9A,$97,$93,$95,$89,$A1 ;タチツテトナニヌ
002064 EDC8 AF8B8696A2ABAA8A        DB  $AF,$8B,$86,$96,$A2,$AB,$AA,$8A ;ネノハヒフヘホマ
00206C EDD0 8EB0AD8DA7A8A98F        DB  $8E,$B0,$AD,$8D,$A7,$A8,$A9,$8F ;ミムメモヤユヨラ
002074 EDD8 8CAEAC9BA099BCB8        DB  $8C,$AE,$AC,$9B,$A0,$99,$BC,$B8 ;リルレロワン゛゜
00207C EDE0 91819A97939589A1        DB  $91,$81,$9A,$97,$93,$95,$89,$A1 ;たちつてとねにぬ   ATB:1
002084 EDE8 AF8B8696A2ABAA8A        DB  $AF,$8B,$86,$96,$A2,$AB,$AA,$8A ;ねのはひふへほま   ATB:1
00208C EDF0 8EB0AD8DA7A8A98F        DB  $8E,$B0,$AD,$8D,$A7,$A8,$A9,$8F ;みむめもやゆよら   ATB:1
002094 EDF8 8CAEAC9BA099BCB8        DB  $8C,$AE,$AC,$9B,$A0,$99,$BC,$B8 ;りるれろわん゛゜   ATB:1
       EE00                     DC_TABLE:
00209C EE00 2041424344454647        DB  $20,$41,$42,$43,$44,$45,$46,$47 ;0
0020A4 EE08 48494A4B4C4D4E4F        DB  $48,$49,$4A,$4B,$4C,$4D,$4E,$4F
0020AC EE10 5051525354555657        DB  $50,$51,$52,$53,$54,$55,$56,$57 ;1
0020B4 EE18 58595A151A1B1411        DB  $58,$59,$5A,$15,$1A,$1B,$14,$11
0020BC EE20 3031323334353637        DB  $30,$31,$32,$33,$34,$35,$36,$37 ;2
0020C4 EE28 38392D3D3B2F2E2C        DB  $38,$39,$2D,$3D,$3B,$2F,$2E,$2C
0020CC EE30 00000000007C0000        DB  $00,$00,$00,$00,$00,$7C,$00,$00 ;3
0020D4 EE38 0000000000000000        DB  $00,$00,$00,$00,$00,$00,$00,$00
0020DC EE40 0080000083008285        DB  $00,$80,$00,$00,$83,$00,$82,$85 ;4
0020E4 EE48 843F00000000003A        DB  $84,$3F,$00,$00,$00,$00,$00,$3A
0020EC EE50 5E3C5B815D40003E        DB  $5E,$3C,$5B,$81,$5D,$40,$00,$3E ;5
0020F4 EE58 00607F0018191312        DB  $00,$60,$7F,$00,$18,$19,$13,$12
0020FC EE60 1021222324252627        DB  $10,$21,$22,$23,$24,$25,$26,$27 ;6
002104 EE68 28292B2A001C0000        DB  $28,$29,$2B,$2A,$00,$1C,$00,$00
00210C EE70 7E00000000000000        DB  $7E,$00,$00,$00,$00,$00,$00,$00 ;7
002114 EE78 171600005F000000        DB  $17,$16,$00,$00,$5F,$00,$00,$00
00211C EE80 00C19A9F9C92CA97        DB  $00,$C1,$9A,$9F,$9C,$92,$CA,$97 ;8
002124 EE88 98C6CFC9D8D3D0D7        DB  $98,$C6,$CF,$C9,$D8,$D3,$D0,$D7
00212C EE90 9EC09DC496C5CBC3        DB  $9E,$C0,$9D,$C4,$96,$C5,$CB,$C3 ;9
002134 EE98 9BDDC2DB99A2878C        DB  $9B,$DD,$C2,$DB,$99,$A2,$87,$8C
00213C EEA0 DCC7CC91939495D4        DB  $DC,$C7,$CC,$91,$93,$94,$95,$D4 ;A
002144 EEA8 D5D6CECDDAD2D9C8        DB  $D5,$D6,$CE,$CD,$DA,$D2,$D9,$C8
00214C EEB0 D1A3888D86A4898E        DB  $D1,$A3,$88,$8D,$86,$A4,$89,$8E ;B
002154 EEB8 DFA58A8FDEA18B90        DB  $DF,$A5,$8A,$8F,$DE,$A1,$8B,$90
00215C EEC0 000000000000001F        DB  $00,$00,$00,$00,$00,$00,$00,$1F ;C
002164 EEC8 00001D7B7D1E0F0E        DB  $00,$00,$1D,$7B,$7D,$1E,$0F,$0E
00216C EED0 070102030405060D        DB  $07,$01,$02,$03,$04,$05,$06,$0D ;D
002174 EED8 080A0B0C095C0000        DB  $08,$0A,$0B,$0C,$09,$5C,$00,$00
00217C EEE0 0000000000000000        DB  $00,$00,$00,$00,$00,$00,$00,$00 ;E
002184 EEE8 0000000000000000        DB  $00,$00,$00,$00,$00,$00,$00,$00
00218C EEF0 A000000000000000        DB  $A0,$00,$00,$00,$00,$00,$00,$00 ;F
002194 EEF8 0000000000000000        DB  $00,$00,$00,$00,$00,$00,$00,$00
[EOF:M7TABLE.ASM:SHIFT_JIS]
                                    INCLUDE "LDWORK.ASM"
                                
                                ;   LSX-Dodgers WORK0
                                ;
                                ;   CP/M互換BIOS
                                ;   BOOT:アドレス下位1バイトが0になるように
       EF00                     AT_WORK:
00219C EF00                         DS  WORKAD-AT_WORK
                                
       EF00                     CPM_BOOT:
00219C EF00 C30000          10      JP  0
       EF03                     _SYS00:     ;(BDOS)プログラム終了
       EF03                     CPM_WBOOT:
00219F EF03 C3FECF          10      JP  WBOOT1
       EF06                     CPM_CONST:
0021A2 EF06 C331D9          10      JP  CONSTX
       EF09                     _SYS07:     ;(BDOS)コンソール直接入力
       EF09                     CPM_CONIN:
0021A5 EF09 C3C7D8          10      JP  FLGET
       EF0C                     CPM_CONOUT:
0021A8 EF0C C3D9DA          10      JP  CONOUT1
                                
       EF0F                     DECBF:
0021AB EF0F                         DS  5
0021B0 EF14 00                  FDRV    DB  0
0021B1 EF15                     FNAME   DS  36
0021D5 EF39                     SFILE:  DS  33      ;DRV FILENAME
0021F6 EF5A                     HLBUF:  DS  3       ;Random record buffer
                                
0021F9 EF5D 0000                LEFTX:  DW  0
0021FB EF5F 0000                DTAX:   DW  0
                                
       EF61                     ZERO:
       EF61                     BEEPD:
0021FD EF61 008E01000B000C10        DB  0,08EH,1,0,00BH,0,00CH,010H
002205 EF69 073E08100D00FF          DB  007H,03EH,008H,010H,00DH,0,0FFH
       EF62                     RTC_YY  EQU BEEPD+1
       EF63                     RTC_MW  EQU BEEPD+2
       EF64                     RTC_DD  EQU BEEPD+3
       EF65                     RTC_TT  EQU BEEPD+4
       EF66                     RTC_MM  EQU BEEPD+5
       EF67                     RTC_SS  EQU BEEPD+6
                                
00220C EF70 00                  CHECK:  DB  0
                                
00220D EF71 4F4B24              OK: DB  "OK$"
002210 EF74                         DS  5
002215 EF79 4572726F722124      COMERM: DB  "Error!$"
                                ;   システムワークエリア
                                ;   _CYL0:アドレス下位1バイトが080Hになるように
00221C EF80 FF                  _CYL0:  DB  0FFH    ;Cylinder
00221D EF81 FF                  _CYL1:  DB  0FFH    ;Cylinder
00221E EF82 FF                  _CYL2:  DB  0FFH    ;Cylinder
00221F EF83 FF                  _CYL3:  DB  0FFH    ;Cylinder
002220 EF84 00                  _DRIVE: DB  0   ;unit number
002221 EF85 00                  _SEEKSP:DB  0   ;Seek speed
002222 EF86 FF                  _ISEEK: DB  0FFH    ;
002223 EF87 00                  _DVSW:  DB  0
002224 EF88 00                  _DRV:   DB  0
002225 EF89 FF                  _DSK:   DB  0FFH
002226 EF8A 8000                _DTA:   DW  00080H
002228 EF8C 0000                _CTC:   DW  0
00222A EF8E 0000                _TXADR: DW  0
00222C EF90 0000                _KEYPS: DW  0
00222E EF92 00FF                _KEYD:  DW  0FF00H  ;キーデータ
002230 EF94 C210                _KEYSP: DW  010C2H
002232 EF96 71                  _COLORF:DB  COLORF  ;色
002233 EF97 19                  _LINE:  DB  LINE
                                
002234 EF98 0000                _FCB:   DW  0
002236 EF9A 0000                _FBPS:  DW  0   ;SEARCH FILES
002238 EF9C 0000                _FBAD:  DW  0   ;    //
00223A EF9E 00                  _FBCNT: DB  0   ;    //
00223B EF9F 00                  _FILEN: DB  0
00223C EFA0 00                  _DIRF:  DB  0   ;bit7:ディレクトリ bit0-6:セクタインデックス
00223D EFA1                         DS  1
00223E EFA2 00                  _WTFATF:DB  0   ;FATバッファの更新フラグ
00223F EFA3                         DS  1
002240 EFA4 00                  _WTDBF: DB  0   ;データバッファの更新フラグ
002241 EFA5 FF                  _DBDRV: DB  0FFH    ;データバッファにあるデータを読み込んだドライブ
002242 EFA6 0000                _DBSEC: DW  0   ;データバッファにあるデータを読み込んだセクタ番号
002244 EFA8 0000                _DPB:   DW  0
       EFAA                     _FATDRV:
002246 EFAA FF                      DB  0FFH    ;FATバッファに読み込んでいるドライブ
002247 EFAB 00                  _FATIX: DB  0   ;FATバッファに読み込んでいるインデックス
       EFAC                     _FAKEFREE:
002248 EFAC 0000                    DW  0   ;偽の残量（FATサイズが大きくなると重くなるのでその対策）
                                
00224A EFAE                         DS  2
                                
       EFB0                     CRTCD:  
00224C EFB0 6F                      DB  06FH
       EFB1                     _WIDTH: 
00224D EFB1 28                      DB  WIDTH
       EFB2                     TVRAMTOP:
00224E EFB2 5938                    DB  059H,038H
002250 EFB4 1F02                    DB  01FH,002H
       EFB6                     _LINE2:
002252 EFB6 19                      DB  019H
002253 EFB7 1C                      DB  01CH
       EFB8                     WKE4:
002254 EFB8 00                      DB  000H
       EFB9                     WK40:
002255 EFB9 07                      DB  007H
       EFBA                     _PAGE_MINUS:
002256 EFBA 18FC                    DW  0-WIDTH*LINE
       EFBC                     _WIDTH_MINUS:
002258 EFBC D8FF                    DW  0-WIDTH
       EFBE                     WK30:
00225A EFBE 0C                      DB  00CH
       EFBF                     WK31:
       EFBF                     WK1FD0:
00225B EFBF 20                      DB  020H
                                
00225C EFC0 0000                CTC0:   DW  INTCTCE
00225E EFC2 0000                CTC1:   DW  INTCTCE
002260 EFC4 0000                CTC2:   DW  INTCTC2
002262 EFC6 0000                CTC3:   DW  INTCTCE
002264 EFC8 0000                INTVEC: DW  INT
                                
                                ;   LSX-Dodgers 独自BIOS
                                
002266 EFCA C31DDC          10  _INKEY: JP  INKEY
002269 EFCD C3C5D9          10  _PRINT: JP  PRINT
00226C EFD0 C3A1DC          10  _SCRN:  JP  SCRN
00226F EFD3 C382DB          10  _POS:   JP  POS
002272 EFD6 C3A7DA          10  _LOC:   JP  LOC
       EFD9                     _CHGDRV:
002275 EFD9 C33BE9          10      JP  CHGDRV
       EFDC                     _GETDPB:
002278 EFDC C307EA          10      JP  GETDPB
       EFDF                     _FFLUSH:
00227B EFDF C325EA          10      JP  FFLUSH
       EFE2                     _RDFATX:
00227E EFE2 C341E6          10      JP  RDFATX
002281 EFE5 C369E7          10  _RDFAT: JP  RDFAT
002284 EFE8 C3E5EA          10  _WTTRK: JP  WTTRK
002287 EFEB C345EB          10  _FDRD:  JP  FDRD
00228A EFEE C3EBEA          10  _FDWT:  JP  FDWT
       EFF1                     _BPB2DPB:
00228D EFF1 C3CEE7          10      JP  BPB2DPB
002290 EFF4                         DS  3
       EFF7                     _GNCL:
002293 EFF7 C3E3E6          10  GNCPAT: JP  GNCL        ; self-modifying code
       EFFA                     _SNCL:
002296 EFFA C306E7          10  SNCPAT: JP  SNCL        ; self-modifying code
002299 EFFD C33FD0          10  _COMANL:JP  COMANL
                                
       F000                     _WE:
[EOF:LDWORK.ASM:SHIFT_JIS]
                                    INCLUDE "LDCALL.ASM"
                                
                                ;   LSX-Dodgers システムコール(BDOS)
                                ;
                                ;   LSX-Dodgers SYSTEM CALL
                                ;   STABLE:アドレス下位1バイトが0になるように
                                
       F000                     STABLE:
                                ;0
00229C F000 03EF9BD8A7D876DE        DW  _SYS00,_SYS01,_SYS02,_SYS03
0022A4 F008 D9D5D9D5ACD809EF        DW  _SYS04,_SYS05,_SYS06,_SYS07
0022AC F010 B4D8DBD5FDD829D9        DW  _SYS08,_SYS09,_SYS0A,_SYS0B
0022B4 F018 F0D5F5D504D617D6        DW  _SYS0C,_SYS0D,_SYS0E,_SYS0F
                                ;1
0022BC F020 6BD6B2D6FBD631D7        DW  _SYS10,_SYS11,_SYS12,_SYS13
0022C4 F028 39D74FD764D75CD7        DW  _SYS14,_SYS15,_SYS16,_SYS17
0022CC F030 ABD7B0D7B5D7BBD7        DW  _SYS18,_SYS19,_SYS1A,_SYS1B
0022D4 F038 D9D5E1D7D9D5E5D7        DW  _SYS1C,_SYS1D,_SYS1E,_SYS1F
                                ;2
0022DC F040 D9D59BD7A3D7ECD7        DW  _SYS20,_SYS21,_SYS22,_SYS23
0022E4 F048 12D8D9D5FEE2E3E3        DW  _SYS24,_ERROR,_SYS26,_SYS27
0022EC F050 A3D71BD842D976DE        DW  _SYS28,_SYS5C,_SYS2A,_SYS2B
0022F4 F058 48D976DED9D53ED8        DW  _SYS2C,_SYS2D,_SYS2E,_SYS2F
                                ;3
0022FC F060 38D8D9D5D9D5D9D5        DW  _SYS30,_ERROR,_ERROR,_ERROR
002304 F068 D9D5D9D5D9D5D9D5        DW  _ERROR,_ERROR,_ERROR,_ERROR
00230C F070 D9D576DE76DE5FD8        DW  _ERROR,_SYS39,_SYS3A,_SYS5A
                                ;DOS2
002314 F078 BCD5                    DW  _DOS2
                                
002316 F07A                         DS  2
002318 F07C 00F2                _FATBF: DW  FATBF
00231A F07E 00FA                _DTBUF: DW  DTBUF
                                
                                ;   コントロールコードテーブル
                                ;   CTRLTB:アドレス下位1バイトが080Hになるように
                                
       F080                     CTRLTB:
00231C F080 2ADA2ADA60DA55DB        DW  CTRL00,CTRL00,CTRL02,CTRL03 ;  A,B,C
002324 F088 4FDB8CDA40DBE9DA        DW  CTRL04,CTRL05,CTRL06,CTRL07 ;D,E,F,G
00232C F090 36DA51DA58DBBADA        DW  CTRL08,CTRL09,CTRL0A,CTRL0B ;H,I,J,K
002334 F098 3DDBA2DA6ADB2ADA        DW  CTRL0C,CTRL0D,CTRL0E,CTRL00 ;L,M,N,O
00233C F0A0 2ADA2ADAB2DA2ADA        DW  CTRL00,CTRL00,CTRL12,CTRL00 ;P,Q,R,S
002344 F0A8 2ADA2ADA2ADA2ADA        DW  CTRL00,CTRL00,CTRL00,CTRL00 ;T,U,V,W
00234C F0B0 2ADA2ADA3DDBC1DA        DW  CTRL00,CTRL00,CTRL0C,CTRL1B ;X,Y,Z,ESC
002354 F0B8 19DA3DDA46DA58DB        DW  CTRL1C,CTRL1D,CTRL1E,CTRL1F ;→,←,↑,↓
                                
00235C F0C0                         DS  02AH
                                
002386 F0EA 1617                SDDATA: DB  22,23       ;(FCB)ファイルを最後に変更した時刻
002388 F0EC 1415                    DB  20,21       ;(FCB)ファイルを最後に変更した日付
00238A F0EE 1A1B                    DB  26,27       ;(FCB)ファイルの先頭クラスタ
00238C F0F0 10111213                DB  16,17,18,19 ;(FCB)ファイルのサイズ(バイト単位)
       F0F4                     SDDATAE:
                                
002390 F0F4                     SCDIR:  DS  2       ;+14 +15
002392 F0F6                     SFBPS:  DS  2       ;FBPS
002394 F0F8                     SFNDF:  DS  2       ;FILEN DIRF
                                
002396 F0FA 0000                _FATPS: DW  0
002398 F0FC 0000                _DIRPS: DW  0
00239A F0FE 0000                _CLPS:  DW  0
                                
       F100                     _PE:
[EOF:LDCALL.ASM:SHIFT_JIS]
                                    INCLUDE "M7DPB.ASM"
                                
                                ;   LSX-Dodgers DPB
                                ;   MZ-700/1500
                                
       F100                     DEVICE:
                                
                                ;   A:
                                
00239C F100 0200                    DW  2   ;DPB_00_FATLN
00239E F102 EBEF                    DW  _FDRD   ;DPB_02_DRD
0023A0 F104 EEEF                    DW  _FDWT   ;DPB_04_DWT
0023A2 F106 FD                      DB  0FDH    ;DPB_06_FATID
0023A3 F107 02                      DB  2   ;DPB_07_SECPCL
0023A4 F108 6401                    DW  356 ;DPB_08_MAXCL
0023A6 F10A FF                      DB  0FFH    ;DPB_0A_FDMODE  0FFH=2D / 0FEH=2HD
0023A7 F10B 07                      DB  7   ;DPB_0B_DIRSCNT
0023A8 F10C 28                      DB  40  ;DPB_0C_MAXCYL
0023A9 F10D 09                      DB  9   ;DPB_0D_MAXSEC  Number of sectors
0023AA F10E 01                      DB  1   ;DPB_0E_FATPS
0023AB F10F 82                      DB  082H    ;DPB_0F_BPS
0023AC F110 0500                    DW  5   ;DPB_10_DIRPS
0023AE F112 27                      DB  027H    ;DPB_12_DEVICE  Device Number
0023AF F113 00                      DB  0   ;DPB_13_UNITNO
0023B0 F114 0800                    DW  8   ;DPB_14_ADDCL16
0023B2 F116 0000                    DW  0   ;DPB_16
0023B4 F118 0000                    DW  0   ;DPB_18
0023B6 F11A 0000                    DW  0   ;DPB_1A_SDIR
0023B8 F11C 46444430                DB  "FDD0"  ;DPB_1C_NAME
                                
                                ;   B:
                                
0023BC F120 0200                    DW  2   ;DPB_00_FATLN
0023BE F122 EBEF                    DW  _FDRD   ;DPB_02_DRD
0023C0 F124 EEEF                    DW  _FDWT   ;DPB_04_DWT
0023C2 F126 FD                      DB  0FDH    ;DPB_06_FATID
0023C3 F127 02                      DB  2   ;DPB_07_SECPCL
0023C4 F128 6401                    DW  356 ;DPB_08_MAXCL
0023C6 F12A FF                      DB  0FFH    ;DPB_0A_FDMODE  0FFH=2D / 0FEH=2HD
0023C7 F12B 07                      DB  7   ;DPB_0B_DIRSCNT
0023C8 F12C 28                      DB  40  ;DPB_0C_MAXCYL
0023C9 F12D 09                      DB  9   ;DPB_0D_MAXSEC  Number of sectors
0023CA F12E 01                      DB  1   ;DPB_0E_FATPS
0023CB F12F 82                      DB  082H    ;DPB_0F_BPS
0023CC F130 0500                    DW  5   ;DPB_10_DIRPS
0023CE F132 27                      DB  027H    ;DPB_12_DEVICE  Device Number
0023CF F133 01                      DB  1   ;DPB_13_UNITNO
0023D0 F134 0800                    DW  8   ;DPB_14_ADDCL16
0023D2 F136 0000                    DW  0   ;DPB_16
0023D4 F138 0000                    DW  0   ;DPB_18
0023D6 F13A 0000                    DW  0   ;DPB_1A_SDIR
0023D8 F13C 46444431                DB  "FDD1"  ;DPB_1C_NAME
                                
                                ;   C:
                                
0023DC F140 0100                    DW  1   ;DPB_00_FATLN
0023DE F142 05EC                    DW  CDRD    ;DPB_02_DRD
0023E0 F144 F1EB                    DW  CDWT    ;DPB_04_DWT
0023E2 F146 FA                      DB  0FAH    ;DPB_06_FATID
0023E3 F147 01                      DB  1   ;DPB_07_SECPCL
0023E4 F148 7A00                    DW  122 ;DPB_08_MAXCL
0023E6 F14A 00                      DB  0   ;DPB_0A_FDMODE
0023E7 F14B 06                      DB  6   ;DPB_0B_DIRSCNT
0023E8 F14C 00                      DB  0   ;DPB_0C_MAXCYL
0023E9 F14D 00                      DB  0   ;DPB_0D_MAXSEC
0023EA F14E 01                      DB  1   ;DPB_0E_FATPS
0023EB F14F 01                      DB  1   ;DPB_0F_BPS
0023EC F150 0200                    DW  2   ;DPB_10_DIRPS
0023EE F152 0C                      DB  00CH    ;DPB_12_DEVICE
0023EF F153 F8                      DB  0F8H    ;DPB_13_UNITNO
0023F0 F154 0600                    DW  6   ;DPB_14_ADDCL16
0023F2 F156 0000                    DW  0   ;DPB_16
0023F4 F158 0000                    DW  0   ;DPB_18
0023F6 F15A 0000                    DW  0   ;DPB_1A_SDIR
0023F8 F15C 434D4F53                DB  "CMOS"  ;DPB_1C_NAME
                                
                                ;   D:
                                
0023FC F160                         DS  32
                                
                                ;   E:
                                
00241C F180 0000                    DW  0   ;DPB_00_FATLN
00241E F182 BCEB                    DW  EDRD    ;DPB_02_DRD
002420 F184 AFEB                    DW  EDWT    ;DPB_04_DWT
002422 F186 FA                      DB  0FAH    ;DPB_06_FATID
002423 F187 02                      DB  2   ;DPB_07_SECPCL
002424 F188 0000                    DW  0   ;DPB_08_MAXCL
002426 F18A 00                      DB  0   ;DPB_0A_FDMODE
002427 F18B 10                      DB  16  ;DPB_0B_DIRSCNT
002428 F18C 00                      DB  0   ;DPB_0C_MAXCYL
002429 F18D 00                      DB  0   ;DPB_0D_MAXSEC
00242A F18E 01                      DB  1   ;DPB_0E_FATPS
00242B F18F 01                      DB  1   ;DPB_0F_BPS
00242C F190 0000                    DW  0   ;DPB_10_DIRPS
00242E F192 26                      DB  026H    ;DPB_12_DEVICE
00242F F193 00                      DB  0   ;DPB_13_UNITNO
002430 F194 0000                    DW  0   ;DPB_14_ADDCL16
002432 F196 0000                    DW  0   ;DPB_16
002434 F198 0000                    DW  0   ;DPB_18
002436 F19A 0000                    DW  0   ;DPB_1A_SDIR
002438 F19C 454D4D30                DB  "EMM0"  ;DPB_1C_NAME
                                
                                ;   F:
                                
00243C F1A0 0200                    DW  2   ;DPB_00_FATLN
00243E F1A2 29EC                    DW  RDRD    ;DPB_02_DRD
002440 F1A4 18EC                    DW  RDWT    ;DPB_04_DWT
002442 F1A6 FA                      DB  0FAH    ;DPB_06_FATID
002443 F1A7 01                      DB  1   ;DPB_07_SECPCL
002444 F1A8 F600                    DW  246 ;DPB_08_MAXCL
002446 F1AA 00                      DB  0   ;DPB_0A_FDMODE
002447 F1AB 09                      DB  9   ;DPB_0B_DIRSCNT
002448 F1AC 00                      DB  0   ;DPB_0C_MAXCYL
002449 F1AD 00                      DB  0   ;DPB_0D_MAXSEC
00244A F1AE 01                      DB  1   ;DPB_0E_FATPS
00244B F1AF 01                      DB  1   ;DPB_0F_BPS
00244C F1B0 0300                    DW  3   ;DPB_10_DIRPS
00244E F1B2 0F                      DB  00FH    ;DPB_12_DEVICE
00244F F1B3 00                      DB  0   ;DPB_13_UNITNO
002450 F1B4 0A00                    DW  10  ;DPB_14_ADDCL16
002452 F1B6 0000                    DW  0   ;DPB_16
002454 F1B8 0000                    DW  0   ;DPB_18
002456 F1BA 0000                    DW  0   ;DPB_1A_SDIR
002458 F1BC 52414D46                DB  "RAMF"  ;DPB_1C_NAME
                                
                                ;   G:
                                
00245C F1C0                         DS  32
                                
                                ;   H:
00247C F1E0                         DS  3
00247F F1E3 00                      DB  0
[EOF:M7DPB.ASM:UTF_8]
                                
       A480                         ORG $$+OFFSET   ;$DEPHASE
       A480                     LAST_ADR:
                                
                                    END
[EOF:M7.ASM:UTF_8]
