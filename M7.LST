                                ;*** AILZ80ASM *** Z-80 Assembler, version 1.0.0.0, LST:Full:4
                                ;   LSX-Dodgers for MZ-700/1500
                                ;   Programmed by
                                ;   Gaku (Lovers/Tablacus)
                                
                                    INCLUDE "M7DEF.ASM"
                                
                                ;   LSX-Dodgers DEF
                                ;   MZ-700/1500
                                
       0001                     MAC EQU 1   ;MZ-700/1500
       0000                     DEV EQU 0
                                
       8080                     RUN EQU 08080H
       8000                     OFFSET  EQU RUN-128
       CF06                     BDOS    EQU 0CF06H
       ED40                     TABLEAD EQU 0ED40H
       F000                     WORKAD  EQU 0F000H
       F300                     FATBF   EQU 0F300H
       FB00                     DTBUF   EQU 0FB00H
       FF00                     KEYBF   EQU 0FF00H
       FF20                     KBUF    EQU 0FF20H
       FFD9                     TRAP38  EQU 0FFD9H
       0028                     WIDTH   EQU 40
       0019                     LINE    EQU 25
       0070                     COLORF  EQU 070H
       0010                     KEYSP_H EQU 16
       0083                     KEYSP_L EQU 131
       000A                     COMS    EQU 10
[EOF:M7DEF.ASM:UTF_8]
                                    INCLUDE "LDDEF.ASM"
                                
                                ;   LSX-Dodgers DEF
                                
       0001                     VER_1   EQU 1
       0005                     VER_2   EQU 5
       0005                     VER_3   EQU 5
       1D01                     MACW    EQU MAC + 01D00H    ;機種フラグとLD判別フラグ
       0001                     MACD    EQU MAC + DEV * 256 ;機種フラグとデバイスフラグ
       0155                     VER EQU VER_1 * 256 + VER_2 * 16 + VER_3
                                
       0005                     SYSTEM  EQU 00005H
       000F                     JP_HL   EQU 0000FH
       005C                     FCB1    EQU 0005CH
       006C                     FCB2    EQU 0006CH
       005D                     FCB1FN  EQU FCB1+1
       006D                     FCB2FN  EQU FCB2+1
       0080                     DTA1    EQU 00080H
                                
       FFCA                     EXTBIO  EQU 0FFCAH
                                
[EOF:LDDEF.ASM:SHIFT_JIS]
                                
000000 8000                         ORG OFFSET
                                                    ;MZTヘッダ128バイト
000000 8000 01                      DB  1           ;ファイルモード
000001 8001 4C44202020202020        DB  "LD           "     ;ファイル名(13)
            2020202020          
00000E 800E 535953                  DB  "SYS"           ;拡張子(3)
000011 8011 0D                      DB  $0D
000012 8012 EB24                    DW  LAST_ADR-RUN        ;サイズ
000014 8014 8080                    DW  RUN         ;開始アドレス
000016 8016 8080                    DW  RUN         ;実行アドレス
000018 8018                         DS  104
                                
                                    INCLUDE "M7INIT.ASM"
                                
                                ;   LSX-Dodgers INIT
                                ;   MZ-700/1500
                                
000080 8080 C38780          10      JP  START
000083 8083 011D                    DW  MACW
000085 8085 5501                    DW  VER
                                
       8087                     START:
000087 8087 F3               4      DI
000088 8088 ED56             8      IM  1
00008A 808A 318780          10      LD  SP,START
00008D 808D CD9B80          17      CALL    INIT        ;NZならAUTOEXECを実行
000090 8090 210000          10      LD  HL,0
000093 8093 E5              11      PUSH    HL
000094 8094 C8              11      RET Z
000095 8095 112881          10      LD  DE,AUTOD
000098 8098 C3FDF0          10      JP  _COMANL
                                
       809B                     INIT:
00009B 809B D3E0            11      OUT (0E0H),A    ;DRAM(0000H-0FFFH)
00009D 809D D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
00009F 809F 218D81          10      LD  HL,INITE
0000A2 80A2 1106CF          10      LD  DE,BDOS
0000A5 80A5 01DE23          10      LD  BC,LAST_ADR-INITE
0000A8 80A8 EDB0                    LDIR
0000AA 80AA 215E81          10      LD  HL,M7BEEPD
0000AD 80AD 1162F0          10      LD  DE,BEEPD+1
0000B0 80B0 010800          10      LD  BC,M7BEEPE-M7BEEPD
0000B3 80B3 EDB0                    LDIR
                                
0000B5 80B5 210000          10      LD  HL,0
0000B8 80B8 065C             7      LD  B,05CH
0000BA 80BA 3EEF             7      LD  A,0EFH      ;RST 28H
0000BC 80BC CDE3DC          17      CALL    FILL_MEMORY
0000BF 80BF 06A4             7      LD  B,0A4H
0000C1 80C1 AF               4      XOR A
0000C2 80C2 CDE3DC          17      CALL    FILL_MEMORY
                                
0000C5 80C5 3EC3             7      LD  A,0C3H      ;JP
0000C7 80C7 2103F0          10      LD  HL,CPM_WBOOT
0000CA 80CA 320000          13      LD  (00000H),A
0000CD 80CD 220100          16      LD  (00001H),HL ;IPL
                                
0000D0 80D0 21011D          10      LD  HL,MACW     ;3 bit7  DPB Compatible LA(1)
0000D3 80D3 220300          16      LD  (00003H),HL ;  bit6-0 Machine
                                ;               ;4 LSX-Dodgers(01DH)
0000D6 80D6 2106CF          10      LD  HL,BDOS
0000D9 80D9 320500          13      LD  (00005H),A
0000DC 80DC 220600          16      LD  (00006H),HL ;BDOS
                                
0000DF 80DF 21D9FF          10      LD  HL,TRAP38   ;TRAP38
0000E2 80E2 322800          13      LD  (00028H),A
0000E5 80E5 222900          16      LD  (00029H),HL ;RST 028H
                                
0000E8 80E8 323800          13      LD  (00038H),A
0000EB 80EB 210ECF          10      LD  HL,IO_INT8253
0000EE 80EE 223900          16      LD  (00039H),HL
                                
0000F1 80F1 3EF0             7      LD  A,CPM_BOOT/256
0000F3 80F3 320B00          13      LD  (0000BH),A
                                
0000F6 80F6 3EE9             7      LD  A,0E9H      ;JP (HL)
0000F8 80F8 320F00          13      LD  (0000FH),A
                                
0000FB 80FB 213481          10      LD  HL,INIMES
0000FE 80FE CD51D5          17      CALL    MSX
       8101                     INIT1:
000101 8101 F3               4      DI
000102 8102 1100FF          10      LD  DE,0FF00H
000105 8105 0600             7      LD  B,0
000107 8107 CDA4D3          17      CALL    ZERO_MEMORY_DE
00010A 810A 21CAFF          10      LD  HL,EXTBIO
00010D 810D 36C9            10      LD  (HL),0C9H   ;RET
00010F 810F 23               6      INC HL
000110 8110 060E             7      LD  B,TRAP38-EXTBIO-1
000112 8112 3EEF             7      LD  A,0EFH      ;RST 28H
000114 8114 CDE3DC          17      CALL    FILL_MEMORY
000117 8117 216681          10      LD  HL,AT_TRAP38
00011A 811A 11D9FF          10      LD  DE,TRAP38
00011D 811D 012700          10      LD  BC,AT_TRAPE-AT_TRAP38
000120 8120 EDB0                    LDIR
                                
000122 8122 CDBEDB          17      CALL    CHKEY
000125 8125 FE03             7      CP  3
000127 8127 C9              10      RET
                                
000128 8128 4155544F45584543    AUTOD:  DB  "AUTOEXEC "
            20                  
000131 8131 413A00              AUTODV: DB  "A:",0
                                
000134 8134 0C4C53582D446F64    INIMES: DB  00CH,"LSX-Dodgers for MZ-700/1500 v"
            6765727320666F72    
            204D5A2D3730302F    
            313530302076        
000152 8152 312E                    DB  030H + VER_1, '.'
000154 8154 3535                    DB  030H + VER_2 ,030H + VER_3
                                ;   DB  ""
000156 8156 2047616B750D0A          DB  ' Gaku',0DH,0AH
00015D 815D 00                      DB  0
                                
       815E                     M7BEEPD:
00015E 815E 0801                    DB  8,1
000160 8160 0736                    DB  7,036H
000162 8162 04F9                    DB  4,0F9H
000164 8164 0403                    DB  4,3
       8166                     M7BEEPE:
                                
       8166                     AT_TRAP38:
000166 FFD9                         ORG TRAP38,AT_TRAP38-OFFSET
000166 FFD9 210000          10      LD  HL,0
000169 FFDC E3              19      EX  (SP),HL
00016A FFDD 3E24             7      LD  A,'$'
00016C FFDF CD29D8          17      CALL    MSG_A
00016F FFE2 2B               6      DEC HL
000170 FFE3 7C               4      LD  A,H
000171 FFE4 CDE8FF          17      CALL    PRHX
000174 FFE7 7D               4      LD  A,L
       FFE8                     PRHX:
000175 FFE8 F5              11      PUSH    AF
000176 FFE9 07               4      RLCA
000177 FFEA 07               4      RLCA
000178 FFEB 07               4      RLCA
000179 FFEC 07               4      RLCA
00017A FFED CDF1FF          17      CALL    PRHX2
00017D FFF0 F1              10      POP AF
       FFF1                     PRHX2:
00017E FFF1 E60F             7      AND 00FH
000180 FFF3 FE0A             7      CP  10
000182 FFF5 3F               4      CCF
000183 FFF6 CE30             7      ADC A,'0'
000185 FFF8 27               4      DAA
000186 FFF9 C329D8          10      JP  MSG_A
000189 FFFC                         DS  4
       818D                         ORG $$+OFFSET   ;$DEPHASE
       818D                     AT_TRAPE:
                                
       818D                     INITE:
00018D CF06                         ORG BDOS,INITE-OFFSET
                                
00018D CF06 C309CF          10      JP  IO_BDOS
[EOF:M7INIT.ASM:SHIFT_JIS]
                                    INCLUDE "M7BANK.ASM"
                                
                                ;   LSX-Dodgers IO
                                ;   MZ-700/1500
                                ;   VRAM/KEY/TIMER(0D000H-0EFFFH)にアクセスするので0D000H-0FFFFHに置けない部分
                                ;
                                
       CF09                     IO_BDOS:
000190 CF09 D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
000192 CF0B C310D5          10      JP  BDOS0
                                
       CF0E                     IO_INT8253:
000195 CF0E F3               4      DI
000196 CF0F F5              11      PUSH    AF
000197 CF10 D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
000199 CF12 3E01             7      LD  A,1
00019B CF14 3206E0          13      LD  (0E006H),A  ;8253 Ch.2 カウンタ
00019E CF17 AF               4      XOR A
00019F CF18 3206E0          13      LD  (0E006H),A  ;8253 Ch.2 カウンタ
0001A2 CF1B D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
0001A4 CF1D C3E3D7          10      JP  INT8253 
                                
       CF20                     RDKEYDATA:
0001A7 CF20 F3               4      DI
0001A8 CF21 D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
0001AA CF23 3200E0          13      LD  (0E000H),A
0001AD CF26 3A01E0          13      LD  A,(E001H)
0001B0 CF29 D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
0001B2 CF2B FB               4      EI
0001B3 CF2C C9              10      RET
                                
       CF2D                     RD556VSYNC:
0001B4 CF2D F3               4      DI
0001B5 CF2E D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
0001B7 CF30 3A02E0          13      LD  A,(0E002H)
0001BA CF33 D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
0001BC CF35 FB               4      EI
0001BD CF36 C9              10      RET
                                
       CF37                     RDMMIO:
0001BE CF37 F3               4      DI
0001BF CF38 D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
0001C1 CF3A 7E               7      LD  A,(HL)
0001C2 CF3B D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
0001C4 CF3D FB               4      EI
0001C5 CF3E C9              10      RET
                                
       CF3F                     WRMMIO:
0001C6 CF3F F3               4      DI
0001C7 CF40 D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
0001C9 CF42 77               7      LD  (HL),A
0001CA CF43 D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
0001CC CF45 FB               4      EI
0001CD CF46 C9              10      RET
                                
       CF47                     RDMMIO_BC:
0001CE CF47 F3               4      DI
0001CF CF48 D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
0001D1 CF4A 0A               7      LD  A,(BC)
0001D2 CF4B D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
0001D4 CF4D FB               4      EI
0001D5 CF4E C9              10      RET
                                
       CF4F                     WRMMIO_BC:
0001D6 CF4F F3               4      DI
0001D7 CF50 D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
0001D9 CF52 02               7      LD  (BC),A
0001DA CF53 D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
0001DC CF55 FB               4      EI
0001DD CF56 C9              10      RET
                                
       CF57                     IO_PRINT:
0001DE CF57 F3               4      DI
0001DF CF58 D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
0001E1 CF5A 77               7      LD  (HL),A
0001E2 CF5B CBDC             8      SET 3,H
0001E4 CF5D 71               7      LD  (HL),C
0001E5 CF5E D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
0001E7 CF60 FB               4      EI
0001E8 CF61 C9              10      RET
                                
       CF62                     IO_CLR:
0001E9 CF62 F3               4      DI
0001EA CF63 D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
       CF65                     C1AX1:
0001EC CF65 7A               4      LD  A,D
0001ED CF66 C6D0             7      ADD A,0D0H
0001EF CF68 57               4      LD  D,A
0001F0 CF69 AF               4      XOR A
0001F1 CF6A 12               7      LD  (DE),A      ;Text
0001F2 CF6B CBDA             8      SET 3,D
       CF6E                     ICSMC   EQU $+1
0001F4 CF6D 3E00             7      LD  A,0     ;自己書き換え
0001F6 CF6F 12               7      LD  (DE),A      ;Color
0001F7 CF70 13               6      INC DE
0001F8 CF71 7A               4      LD  A,D
0001F9 CF72 D6D8             7      SUB 0D8H
0001FB CF74 57               4      LD  D,A
0001FC CF75 2118FC          10      LD  HL,0-WIDTH*LINE
0001FF CF78 19              11      ADD HL,DE
000200 CF79 30EA            12      JR  NC,C1AX1
000202 CF7B E1              10      POP HL
000203 CF7C D1              10      POP DE
000204 CF7D D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
000206 CF7F FB               4      EI
000207 CF80 C9              10      RET
                                
       CF81                     IO_CLLINE:
000208 CF81 F3               4      DI
000209 CF82 D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
       CF84                     CLLINE1:
00020B CF84 CB9C             8      RES 3,H
00020D CF86 77               7      LD  (HL),A      ;Text
00020E CF87 CBDC             8      SET 3,H
000210 CF89 71               7      LD  (HL),C      ;Color
000211 CF8A 23               6      INC HL
000212 CF8B 10F7            13      DJNZ    CLLINE1
000214 CF8D D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
000216 CF8F FB               4      EI
000217 CF90 C9              10      RET
                                
       CF91                     IO_INS:
000218 CF91 F3               4      DI
000219 CF92 D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
       CF94                     IO_INS1:
00021B CF94 CDABCF          17      CALL    C12S
00021E CF97 23               6      INC HL
00021F CF98 10FA            13      DJNZ    IO_INS1
000221 CF9A D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
000223 CF9C FB               4      EI
000224 CF9D C9              10      RET
                                
       CF9E                     IO_BS:
000225 CF9E F3               4      DI
000226 CF9F D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
       CFA1                     IO_BS1:
000228 CFA1 CDABCF          17      CALL    C12S
00022B CFA4 2B               6      DEC HL
00022C CFA5 10F7            13      DJNZ    IO_BS
00022E CFA7 D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
000230 CFA9 FB               4      EI
000231 CFAA C9              10      RET
                                
       CFAB                     C12S:
000232 CFAB CB9C             8      RES 3,H
000234 CFAD 5E               7      LD  E,(HL)
000235 CFAE 77               7      LD  (HL),A
000236 CFAF 7B               4      LD  A,E
000237 CFB0 CBDC             8      SET 3,H
000239 CFB2 5E               7      LD  E,(HL)
00023A CFB3 71               7      LD  (HL),C
00023B CFB4 4B               4      LD  C,E
00023C CFB5 C9              10      RET
                                
       CFB6                     IO_SCRUP:
00023D CFB6 F3               4      DI
00023E CFB7 D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
       CFB9                     SCRUP1:
000240 CFB9 2815            12      JR  Z,SCRCL
000242 CFBB D5              11      PUSH    DE
000243 CFBC E5              11      PUSH    HL
000244 CFBD CBDA             8      SET 3,D
000246 CFBF CBDC             8      SET 3,H
000248 CFC1 012800          10      LD  BC,WIDTH
00024B CFC4 EDB0                    LDIR
00024D CFC6 E1              10      POP HL
00024E CFC7 D1              10      POP DE
00024F CFC8 012800          10      LD  BC,WIDTH
000252 CFCB EDB0                    LDIR
000254 CFCD 3D               4      DEC A
000255 CFCE 18E9            12      JR  SCRUP1
                                
       CFD0                     SCRCL:
000257 CFD0 0628             7      LD  B,WIDTH
000259 CFD2 EB               4      EX  DE,HL
00025A CFD3 D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
00025C CFD5 CD23DA          17      CALL    CLLINE
00025F CFD8 E1              10      POP HL
000260 CFD9 D1              10      POP DE
000261 CFDA C1              10      POP BC
000262 CFDB C9              10      RET
                                
       CFDC                     C_MON:
000263 CFDC D3E4            11      OUT (0E4H),A    ;MONITOR ROM(0000H-0FFFH) & VRAM/KEY/TIMER(D000H-FFFFH)
000265 CFDE C7              12      RST 0
                                
       CFDF                     INITINT:
000266 CFDF D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
000268 CFE1 2107E0          10      LD  HL,0E007H   ;HL=0E007H 8253 コントロール
00026B CFE4 36B0            10      LD  (HL),0B0H   ;Ch.2 カウンタの下位バイト→上位バイトの順に連続してアクセス Mode 0 16ビットバイナリ
00026D CFE6 3674            10      LD  (HL),074H   ;Ch.1 カウンタの下位バイト→上位バイトの順に連続してアクセス Mode 2 16ビットバイナリ
00026F CFE8 2D               4      DEC L       ;0E006H 8253 Ch.2 カウンタ
000270 CFE9 3602            10      LD  (HL),2
000272 CFEB 3600            10      LD  (HL),0
000274 CFED 2D               4      DEC L       ;0E005H 8253 Ch.1 カウンタ
000275 CFEE 77               7      LD  (HL),A
000276 CFEF 3600            10      LD  (HL),0
000278 CFF1 3E05             7      LD  A,5
00027A CFF3 3203E0          13      LD  (0E003H),A  ;8255 コントロールポートでポートC(0E002H)のINTMSKを1にする
00027D CFF6 D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
00027F CFF8 C9              10      RET
                                
       CFF9                     BANKE:
000280 CFF9                         DS  0CFFEH-BANKE
[EOF:M7BANK.ASM:SHIFT_JIS]
                                    INCLUDE "M7CCP.ASM"
                                
                                ;   LSX-Dodgers CCP
                                ;   MZ-700/1500
                                
       CFFE                     WBOOT1:
000285 CFFE D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)　ここは0CFFEH
000287 D000 D3E0            11      OUT (0E0H),A    ;DRAM(0000H-0FFHH)
000289 D002 F3               4      DI
00028A D003 3A94F0          13      LD  A,(_KEYSP)
00028D D006 CDDFCF          17      CALL    INITINT
000290 D009 ED7B0600        20      LD  SP,(SYSTEM+1)
000294 D00D FB               4      EI
000295 D00E 2192F0          10      LD  HL,_KEYD
000298 D011 3600            10      LD  (HL),0
00029A D013 CDBEDB          17      CALL    CHKEY
00029D D016 CD16D8          17      CALL    KEYBC_IFBREAK
0002A0 D019 3E04             7      LD  A,4
0002A2 D01B CD29D8          17      CALL    MSG_A
[EOF:M7CCP.ASM:UTF_8]
                                    INCLUDE "LDCCP.ASM"
                                
                                ;   LSX-Dodgers CCP
                                
       D01E                     COMMAND:
0002A5 D01E 3A00EC          13      LD  A,(FCB_BAT)
0002A8 D021 B7               4      OR  A
0002A9 D022 C263D1          10      JP  NZ,C_BAT1
0002AC D025 CDD8D0          17      CALL    SETDTA1
0002AF D028 3A87F0          13      LD  A,(_DVSW)
0002B2 D02B C641             7      ADD A,'A'
0002B4 D02D CD29D8          17      CALL    MSG_A
0002B7 D030 3E3E             7      LD  A,'>'
0002B9 D032 CD29D8          17      CALL    MSG_A
0002BC D035 3E50             7      LD  A,80
0002BE D037 12               7      LD  (DE),A
0002BF D038 CD89D8          17      CALL    _SYS0A      ;(BDOS)文字列入力
0002C2 D03B CD66D2          17      CALL    LTNL
       D03E                     COMMAND2:
0002C5 D03E 118200          10      LD  DE,DTA1+2
0002C8 D041 CDFDF0          17      CALL    _COMANL
0002CB D044 30D8            12      JR  NC,COMMAND
0002CD D046 1179F0          10      LD  DE,COMERM
0002D0 D049 CD42D5          17      CALL    _SYS09      ;(BDOS)文字列出力
0002D3 D04C C7              12      RST 0
                                
       D04D                     COMANL:
0002D4 D04D CD37DC          17      CALL    FILE
0002D7 D050 3A19F0          13      LD  A,(FNAME+4)
0002DA D053 FE20             7      CP  020H
0002DC D055 201C            12      JR  NZ,COMB2
0002DE D057 D5              11      PUSH    DE
0002DF D058 1115F0          10      LD  DE,FNAME
0002E2 D05B 1A               7      LD  A,(DE)
0002E3 D05C FE20             7      CP  020H
0002E5 D05E 2844            12      JR  Z,SDVSW
0002E7 D060 1B               6      DEC DE
0002E8 D061 1A               7      LD  A,(DE)
0002E9 D062 C6FF             7      ADD A,0FFH
0002EB D064 3809            12      JR  C,COMB
0002ED D066 13               6      INC DE
                                
0002EE D067 21D4D4          10      LD  HL,COMTB
0002F1 D06A 060A             7      LD  B,COMS
0002F3 D06C CDBBDE          17      CALL    CPNAME
       D06F                     COMB:
0002F6 D06F D1              10      POP DE
0002F7 D070 D20F00          10      JP  NC,JP_HL
       D073                     COMB2:
0002FA D073 EB               4      EX  DE,HL
0002FB D074 2240D1          16      LD  (COMPAT+1),HL
0002FE D077 F5              11      PUSH    AF
0002FF D078 CDF8D0          17      CALL    CEXE4
000302 D07B F1              10      POP AF
000303 D07C 2115F0          10      LD  HL,FNAME
000306 D07F 116D00          10      LD  DE,FCB2+1   ;COMMAND NAME
000309 D082 010B00          10      LD  BC,11
00030C D085 EDB0                    LDIR
00030E D087 119AEB          10      LD  DE,PATHD
       D08A                     CEX1:
000311 D08A 1A               7      LD  A,(DE)
000312 D08B FE20             7      CP  020H
000314 D08D D8              11      RET C
000315 D08E CD2CDC          17      CALL    FILEC
000318 D091 D5              11      PUSH    DE
000319 D092 216D00          10      LD  HL,FCB2+1   ;COMMAND NAME
00031C D095 1115F0          10      LD  DE,FNAME
00031F D098 010B00          10      LD  BC,11
000322 D09B EDB0                    LDIR
000324 D09D CDF8D0          17      CALL    CEXE4
000327 D0A0 D1              10      POP DE
000328 D0A1 13               6      INC DE
000329 D0A2 18E6            12      JR  CEX1
                                
       D0A4                     SDVSW:
00032B D0A4 F1              10      POP AF
00032C D0A5 3A14F0          13      LD  A,(FDRV)
00032F D0A8 3D               4      DEC A
000330 D0A9 5F               4      LD  E,A
000331 D0AA 0E0E             7      LD  C,00EH      ;(BDOS)カレントドライブの設定
000333 D0AC 1831            12      JR  SYSTEM0
                                
       D0AE                     OPEN1:
000335 D0AE 2114F0          10      LD  HL,FDRV
       D0B1                     OPEN:
000338 D0B1 0E11             7      LD  C,011H      ;(BDOS)ファイルの検索
       D0B3                     OPEN3:
00033A D0B3 D5              11      PUSH    DE
00033B D0B4 11DBEB          10      LD  DE,DTA_CCP
00033E D0B7 CDD5D0          17      CALL    SETDTA
000341 D0BA EB               4      EX  DE,HL
000342 D0BB CDDFD0          17      CALL    SYSTEM0
000345 D0BE D1              10      POP DE
000346 D0BF C9              10      RET
                                
       D0C0                     OPEN2:
000347 D0C0 0E12             7      LD  C,012H
000349 D0C2 18EF            12      JR  OPEN3
                                
       D0C4                     DEFCB:              ;Z=Ok NZ=Error
00034B D0C4 11DBEB          10      LD  DE,DTA_CCP
00034E D0C7 CDDDD0          17      CALL    SYSC0F
                                
000351 D0CA 11FCEB          10      LD  DE,DTA_CCP+33   ;(FCB)ランダムレコード
000354 D0CD 0604             7      LD  B,4
000356 D0CF CDA4D3          17      CALL    ZERO_MEMORY_DE
       D0D2                     SETDTA100:
000359 D0D2 110001          10      LD  DE,00100H
       D0D5                     SETDTA:
00035C D0D5 C31AD7          10      JP  _SYS1A      ;(BDOS)DTAの設定
                                
       D0D8                     SETDTA1:
00035F D0D8 118000          10      LD  DE,DTA1
000362 D0DB 18F8            12      JR  SETDTA
                                
       D0DD                     SYSC0F:
000364 D0DD 0E0F             7      LD  C,00FH      ;(BDOS)ファイルのオープン
       D0DF                     SYSTEM0:
000366 D0DF CD0500          17      CALL    SYSTEM
000369 D0E2 B7               4      OR  A
00036A D0E3 C9              10      RET
                                
       D0E4                     C_CD:
00036B D0E4 0E5A             7      LD  C,5AH
00036D D0E6 18F7            12      JR  SYSTEM0
                                
       D0E8                     S27BUF:
00036F D0E8 3A0700          13      LD  A,(SYSTEM+2)
000372 D0EB 3D               4      DEC A
000373 D0EC E6F8             7      AND 0F8H
000375 D0EE 67               4      LD  H,A
000376 D0EF 2E00             7      LD  L,0
       D0F1                     S27DTA:
000378 D0F1 11DBEB          10      LD  DE,DTA_CCP
       D0F4                     S27:
00037B D0F4 0E27             7      LD  C,027H      ;(BDOS)ランダムブロック読み込み
00037D D0F6 18E7            12      JR  SYSTEM0
                                
       D0F8                     CEXE4:
00037F D0F8 211DF0          10      LD  HL,FNAME+8
000382 D0FB 7E               7      LD  A,(HL)
000383 D0FC FE20             7      CP  020H
000385 D0FE 2007            12      JR  NZ,CEXE7
000387 D100 3E3F             7      LD  A,'?'
000389 D102 77               7      LD  (HL),A
00038A D103 23               6      INC HL
00038B D104 77               7      LD  (HL),A
00038C D105 23               6      INC HL
00038D D106 77               7      LD  (HL),A
       D107                     CEXE7:
00038E D107 CDAED0          17      CALL    OPEN1
       D10A                     CEXE5:
000391 D10A C0              11      RET NZ
000392 D10B 2AE5EB          16      LD  HL,(DTA_CCP+1+9)
000395 D10E 7C               4      LD  A,H
000396 D10F CD43DF          17      CALL    CAP
000399 D112 67               4      LD  H,A
00039A D113 7D               4      LD  A,L
00039B D114 CD43DF          17      CALL    CAP
00039E D117 6F               4      LD  L,A
00039F D118 3AE4EB          13      LD  A,(DTA_CCP+1+8)
0003A2 D11B CD43DF          17      CALL    CAP
0003A5 D11E D642             7      SUB 'B'
0003A7 D120 282C            12      JR  Z,C_BAT
0003A9 D122 3D               4      DEC A       ;'C'
0003AA D123 2805            12      JR  Z,C_EXE
       D125                     CEXE6:
0003AC D125 CDC0D0          17      CALL    OPEN2
0003AF D128 18E0            12      JR  CEXE5
                                
       D12A                     C_EXE:
0003B1 D12A 7C               4      LD  A,H
0003B2 D12B FE4D             7      CP  'M'
0003B4 D12D 20F6            12      JR  NZ,CEXE6
                                
0003B6 D12F CDC4D0          17      CALL    DEFCB
0003B9 D132 CDE8D0          17      CALL    S27BUF
0003BC D135 3D               4      DEC A
0003BD D136 37               4      SCF
0003BE D137 C0              11      RET NZ
0003BF D138 7C               4      LD  A,H
0003C0 D139 B5               4      OR  L
0003C1 D13A 37               4      SCF
0003C2 D13B C8              11      RET Z
0003C3 D13C CDD8D0          17      CALL    SETDTA1
0003C6 D13F 110000          10  COMPAT: LD  DE,0                ; self-modifying code
0003C9 D142 ED7B0600        20      LD  SP,(SYSTEM+1)
0003CD D146 67               4      LD  H,A             ; A=0 in SETDTA1(_SYS1A)
0003CE D147 6F               4      LD  L,A
0003CF D148 E5              11      PUSH    HL              ; push $0000 (reboot address)
0003D0 D149 24               4      INC H
0003D1 D14A E5              11      PUSH    HL              ; push $0100 (TPA address)
0003D2 D14B C36FD3          10      JP  SETFCB              ; and JP $0100
                                
       D14E                     C_BAT:
0003D5 D14E 114154          10      LD  DE,'A'+'T'*256
0003D8 D151 ED52            15      SBC HL,DE
0003DA D153 20D0            12      JR  NZ,CEXE6
                                
0003DC D155 CDC4D0          17      CALL    DEFCB
                                
0003DF D158 21DBEB          10      LD  HL,DTA_CCP
0003E2 D15B 1100EC          10      LD  DE,FCB_BAT
0003E5 D15E 012500          10      LD  BC,37
0003E8 D161 EDB0                    LDIR
       D163                     C_BAT1:
0003EA D163 CDD2D0          17      CALL    SETDTA100
0003ED D166 CD9AD1          17      CALL    FGETC_BAT
0003F0 D169 218100          10      LD  HL,DTA1+1
0003F3 D16C 2025            12      JR  NZ,END_BATCH
0003F5 D16E FE21             7      CP  021H        ;スペースや改行など制御文字を飛ばす
0003F7 D170 38F1            12      JR  C,C_BAT1
0003F9 D172 3620            10      LD  (HL),' '
0003FB D174 23               6      INC HL
       D175                     C_BAT2:
0003FC D175 77               7      LD  (HL),A
0003FD D176 23               6      INC HL
0003FE D177 7D               4      LD  A,L
0003FF D178 3C               4      INC A       ;L==0FFH
000400 D179 2809            12      JR  Z,RUN_BATCH
000402 D17B CD9AD1          17      CALL    FGETC_BAT
000405 D17E 2004            12      JR  NZ,RUN_BATCH
000407 D180 FE20             7      CP  020H
000409 D182 30F1            12      JR  NC,C_BAT2
       D184                     RUN_BATCH:
00040B D184 7D               4      LD  A,L
00040C D185 D67F             7      SUB DTA1-1
00040E D187 328000          13      LD  (DTA1),A
000411 D18A FE04             7      CP  4
000413 D18C 3805            12      JR  C,END_BATCH
000415 D18E 3600            10      LD  (HL),0
000417 D190 C33ED0          10      JP  COMMAND2
       D193                     END_BATCH:
00041A D193 AF               4      XOR A       ;バッチファイルを閉じる
00041B D194 3200EC          13      LD  (FCB_BAT),A
00041E D197 C300F0          10      JP  CPM_BOOT
                                
       D19A                     FGETC_BAT:
000421 D19A 1100EC          10      LD  DE,FCB_BAT
       D19D                     FGETC:              ;1文字ずつ読み込む
000424 D19D E5              11      PUSH    HL      ;Z:成功
000425 D19E 210100          10      LD  HL,1
000428 D1A1 CDF4D0          17      CALL    S27
00042B D1A4 E1              10      POP HL
00042C D1A5 3A0001          13      LD  A,(00100H)
00042F D1A8 C9              10      RET
                                
       D1A9                     C_DEL:
000430 D1A9 CD6FD3          17      CALL    SETFCB
000433 D1AC CD3FD8          17      CALL    _SYS08      ;(BDOS)エコーなしコンソール入力
                                
000436 D1AF 0E13             7      LD  C,013H
000438 D1B1 180A            12      JR  CDEL1       ;(BDOS)ファイルの削除
                                
       D1B3                     C_REN:
00043A D1B3 CD6FD3          17      CALL    SETFCB
00043D D1B6 3E10             7      LD  A,010H      ;ディレクトリも対象にする
00043F D1B8 326900          13      LD  (FCB1+13),A ;属性
000442 D1BB 0E17             7      LD  C,017H      ;(BDOS)ファイル名の変更
       D1BD                     CDEL1:
000444 D1BD 115C00          10      LD  DE,FCB1
000447 D1C0 CD0500          17      CALL    SYSTEM
00044A D1C3 C6FF             7      ADD A,0FFH
00044C D1C5 C9              10      RET
                                
       D1C6                     C_DIR:
00044D D1C6 CD2CDC          17      CALL    FILEC
000450 D1C9 2115F0          10      LD  HL,FDRV+1
000453 D1CC CDBAD4          17      CALL    CWILD1
000456 D1CF 3EF1             7      LD  A,0F1H
000458 D1D1 3221F0          13      LD  (FDRV+13),A
00045B D1D4 CDAED0          17      CALL    OPEN1
       D1D7                     CDIR1:
00045E D1D7 B7               4      OR  A
00045F D1D8 2008            12      JR  NZ,PDSKF
000461 D1DA CD25D2          17      CALL    P_NAME
000464 D1DD CDC0D0          17      CALL    OPEN2
000467 D1E0 18F5            12      JR  CDIR1
                                
       D1E2                     PDSKF:
000469 D1E2 3A14F0          13      LD  A,(FDRV)
00046C D1E5 5F               4      LD  E,A
00046D D1E6 0E1B             7      LD  C,01BH      ;(BDOS)ディスク情報の獲得
00046F D1E8 CD0500          17      CALL    SYSTEM
000472 D1EB 4F               4      LD  C,A     ;C←1クラスタ辺りの論理セクタ数
000473 D1EC C601             7      ADD A,001H
000475 D1EE D8              11      RET C       ;Aが0FFHだった場合
000476 D1EF 3E06             7      LD  A,8-2
       D1F1                     PDS1:               ;HL=未使用クラスタの総数
000478 D1F1 3C               4      INC A
000479 D1F2 CB19             8      RR  C
00047B D1F4 30FB            12      JR  NC,PDS1
       D1F6                     PDS2:               ;B←論理セクタのサイズの上位8ビット
00047D D1F6 3C               4      INC A
00047E D1F7 CB18             8      RR  B
000480 D1F9 30FB            12      JR  NC,PDS2
000482 D1FB 47               4      LD  B,A
                                
000483 D1FC 110000          10      LD  DE,0
       D1FF                     PDS3:
000486 D1FF 29              11      ADD HL,HL
000487 D200 EB               4      EX  DE,HL
000488 D201 ED6A            15      ADC HL,HL
00048A D203 EB               4      EX  DE,HL
00048B D204 10F9            13      DJNZ    PDS3
       D206                     PDSKF1:
00048D D206 CD9ED2          17      CALL    PRDEC_DEHL
000490 D209 1125EC          10      LD  DE,FREE
000493 D20C CD42D5          17      CALL    _SYS09      ;(BDOS)文字列出力
000496 D20F CD8DD2          17      CALL    PUTDRV
000499 D212 3E5C             7      LD  A,05CH      ;\
00049B D214 CD29D8          17      CALL    MSG_A
00049E D217 2A22F0          16      LD  HL,(FDRV+14)    ;ディレクトリのクラスタ番号
0004A1 D21A AF               4      XOR A
0004A2 D21B 11FEFF          10      LD  DE,0-2
0004A5 D21E 19              11      ADD HL,DE
0004A6 D21F 23               6      INC HL
0004A7 D220 DC9AD2          17      CALL    C,PRDEC_HL
0004AA D223 1841            12      JR  LTNL
                                
       D225                     P_NAME:
0004AC D225 3ADCEB          13      LD  A,(DTA_CCP+1)
0004AF D228 FE2E             7      CP  '.'
0004B1 D22A C8              11      RET Z
0004B2 D22B 11D0D4          10      LD  DE,DIRHD
0004B5 D22E CD42D5          17      CALL    _SYS09      ;(BDOS)文字列出力
0004B8 D231 3AE7EB          13      LD  A,(DTA_CCP+1+00BH)
0004BB D234 F5              11      PUSH    AF
0004BC D235 0F               4      RRCA
0004BD D236 9F               4      SBC A,A
0004BE D237 E60A             7      AND '*'-020H
0004C0 D239 C620             7      ADD A,020H
0004C2 D23B CD29D8          17      CALL    MSG_A
0004C5 D23E CD8DD2          17      CALL    PUTDRV
0004C8 D241 21DCEB          10      LD  HL,DTA_CCP+1
0004CB D244 CDDED2          17      CALL    FPRNT
                                
0004CE D247 F1              10      POP AF
0004CF D248 CB67             8      BIT 4,A
0004D1 D24A 2808            12      JR  Z,DIR3
0004D3 D24C 11C5D4          10      LD  DE,DIRMES
0004D6 D24F CD42D5          17      CALL    _SYS09      ;(BDOS)文字列出力
0004D9 D252 180A            12      JR  DIR6
       D254                     DIR3:
0004DB D254 ED5BFAEB        20      LD  DE,(DTA_CCP+1+01EH)
0004DF D258 2AF8EB          16      LD  HL,(DTA_CCP+1+01CH)
0004E2 D25B CD9ED2          17      CALL    PRDEC_DEHL
       D25E                     DIR6:
0004E5 D25E 3AB1F0          13      LD  A,(_WIDTH)
0004E8 D261 FE29             7      CP  40+1
0004EA D263 D400D3          17      CALL    NC,PRTTMS
                                
       D266                     LTNL:
0004ED D266 1E03             7      LD  E,3
0004EF D268 C3CDF0          10      JP  _PRINT
                                
       D26B                     C_PATH:
0004F2 D26B CD0EDD          17      CALL    SPCUT
0004F5 D26E 219AEB          10      LD  HL,PATHD
0004F8 D271 FE21             7      CP  021H
0004FA D273 300C            12      JR  NC,CPATH0
       D275                     CPATHP:
0004FC D275 7E               7      LD  A,(HL)
0004FD D276 23               6      INC HL
0004FE D277 FE20             7      CP  020H
000500 D279 3F               4      CCF
000501 D27A 30EA            12      JR  NC,LTNL
000503 D27C CD29D8          17      CALL    MSG_A
000506 D27F 18F4            12      JR  CPATHP
       D281                     CPATH0:
000508 D281 FE3B             7      CP  ';'
00050A D283 2001            12      JR  NZ,CPATH1
00050C D285 13               6      INC DE
       D286                     CPATH1:
00050D D286 EB               4      EX  DE,HL
00050E D287 014000          10      LD  BC,PATHX
000511 D28A EDB0                    LDIR
000513 D28C C9              10      RET
                                
       D28D                     PUTDRV:
000514 D28D 3A14F0          13      LD  A,(FDRV)
000517 D290 C640             7      ADD A,'A'-1
000519 D292 CD29D8          17      CALL    MSG_A
00051C D295 3E3A             7      LD  A,':'
       D297                     MSG_AR:
00051E D297 C329D8          10      JP  MSG_A
                                
       D29A                     PRDEC_HL:
000521 D29A AF               4      XOR A
       D29B                     PRDEC_AHL:
000522 D29B 5F               4      LD  E,A
000523 D29C 1600             7      LD  D,0
       D29E                     PRDEC_DEHL:
000525 D29E D5              11      PUSH    DE
000526 D29F 110FF0          10      LD  DE,DECBF
000529 D2A2 0605             7      LD  B,5
00052B D2A4 CDA4D3          17      CALL    ZERO_MEMORY_DE  ;A=0
00052E D2A7 D1              10      POP DE
                                
00052F D2A8 0E20             7      LD  C,32
       D2AA                     DEC1:
000531 D2AA 29              11      ADD HL,HL
000532 D2AB EB               4      EX  DE,HL
000533 D2AC ED6A            15      ADC HL,HL
000535 D2AE EB               4      EX  DE,HL
000536 D2AF E5              11      PUSH    HL
000537 D2B0 2113F0          10      LD  HL,DECBF+4
00053A D2B3 0605             7      LD  B,5
       D2B5                     DEC2:
00053C D2B5 7E               7      LD  A,(HL)
00053D D2B6 8F               4      ADC A,A
00053E D2B7 27               4      DAA
00053F D2B8 77               7      LD  (HL),A
000540 D2B9 2B               6      DEC HL
000541 D2BA 10F9            13      DJNZ    DEC2
000543 D2BC E1              10      POP HL
000544 D2BD 0D               4      DEC C
000545 D2BE 20EA            12      JR  NZ,DEC1
                                
000547 D2C0 210FF0          10      LD  HL,DECBF
00054A D2C3 3E20             7      LD  A,020H
00054C D2C5 0604             7      LD  B,4
       D2C7                     DEC3:
00054E D2C7 CDD4D2          17      CALL    DEC4
000551 D2CA CDD4D2          17      CALL    DEC4
000554 D2CD 23               6      INC HL
000555 D2CE 10F7            13      DJNZ    DEC3
       D2D0                     DECX:
000557 D2D0 CDD4D2          17      CALL    DEC4
00055A D2D3 AF               4      XOR A
       D2D4                     DEC4:
00055B D2D4 ED6F            18      RLD
00055D D2D6 FE20             7      CP  020H
00055F D2D8 2802            12      JR  Z,DEC5
000561 D2DA F630             7      OR  030H
       D2DC                     DEC5:
000563 D2DC 18B9            12      JR  MSG_AR
                                
       D2DE                     FPRNT:
000565 D2DE 0608             7      LD  B,8
000567 D2E0 CDF1D2          17      CALL    P_N1
00056A D2E3 7E               7      LD  A,(HL)
00056B D2E4 C680             7      ADD A,0A0H-020H
00056D D2E6 FEA0             7      CP  0A0H
00056F D2E8 2802            12      JR  Z,FPR1
000571 D2EA 3E2E             7      LD  A,'.'
       D2EC                     FPR1:
000573 D2EC CD29D8          17      CALL    MSG_A
000576 D2EF 0603             7      LD  B,3
                                
       D2F1                     P_N1:
000578 D2F1 C5              11      PUSH    BC
000579 D2F2 E5              11      PUSH    HL
00057A D2F3 7E               7      LD  A,(HL)
00057B D2F4 CD4FDF          17      CALL    CAP3
00057E D2F7 CD29D8          17      CALL    MSG_A
000581 D2FA E1              10      POP HL
000582 D2FB C1              10      POP BC
000583 D2FC 23               6      INC HL
000584 D2FD 10F2            13      DJNZ    P_N1
000586 D2FF C9              10      RET
                                
       D300                     PRTTMS:
000587 D300 3E20             7      LD  A,020H
000589 D302 CD29D8          17      CALL    MSG_A
                                
00058C D305 2AF4EB          16      LD  HL,(DTA_CCP+1+24)
00058F D308 7D               4      LD  A,L
000590 D309 B7               4      OR  A
000591 D30A C8              11      RET Z
000592 D30B CB3C             8      SRL H
000594 D30D 17               4      RLA
000595 D30E 17               4      RLA
000596 D30F 17               4      RLA
000597 D310 17               4      RLA
000598 D311 E60F             7      AND 00FH
00059A D313 57               4      LD  D,A
00059B D314 7C               4      LD  A,H
00059C D315 C650             7      ADD A,80
00059E D317 CD5AD3          17      CALL    PRDEC_A
0005A1 D31A 3E2D             7      LD  A,'-'
0005A3 D31C CD29D8          17      CALL    MSG_A
0005A6 D31F 7A               4      LD  A,D
0005A7 D320 CD5AD3          17      CALL    PRDEC_A
0005AA D323 3E2D             7      LD  A,'-'
0005AC D325 CD29D8          17      CALL    MSG_A
0005AF D328 7D               4      LD  A,L
0005B0 D329 E61F             7      AND 01FH
0005B2 D32B CD5AD3          17      CALL    PRDEC_A
                                
0005B5 D32E 2AF2EB          16      LD  HL,(DTA_CCP+1+22)
                                
0005B8 D331 3E20             7      LD  A,020H
0005BA D333 CD29D8          17      CALL    MSG_A
0005BD D336 7C               4      LD  A,H
0005BE D337 65               4      LD  H,L
0005BF D338 0603             7      LD  B,3
       D33A                     PRTTMS1:
0005C1 D33A 1F               4      RRA
0005C2 D33B CB1D             8      RR  L
0005C4 D33D 10FB            13      DJNZ    PRTTMS1
0005C6 D33F E61F             7      AND 01FH
0005C8 D341 CD5AD3          17      CALL    PRDEC_A
0005CB D344 3E3A             7      LD  A,':'
0005CD D346 CD29D8          17      CALL    MSG_A
0005D0 D349 7D               4      LD  A,L
0005D1 D34A 0F               4      RRCA
0005D2 D34B 0F               4      RRCA
0005D3 D34C E63F             7      AND 03FH
0005D5 D34E CD5AD3          17      CALL    PRDEC_A
0005D8 D351 3E3A             7      LD  A,':'
0005DA D353 CD29D8          17      CALL    MSG_A
0005DD D356 7C               4      LD  A,H
0005DE D357 E61F             7      AND 01FH
0005E0 D359 87               4      ADD A,A
                                
                                ;   PRINT10
                                
       D35A                     PRDEC_A:
0005E1 D35A E5              11      PUSH    HL
0005E2 D35B 0608             7      LD  B,8
0005E4 D35D 4F               4      LD  C,A
0005E5 D35E AF               4      XOR A
       D35F                     PRTA1:
0005E6 D35F CB01             4      RLC C
0005E8 D361 8F               4      ADC A,A
0005E9 D362 27               4      DAA
0005EA D363 10FA            13      DJNZ    PRTA1
0005EC D365 210FF0          10      LD  HL,DECBF
0005EF D368 77               7      LD  (HL),A
0005F0 D369 AF               4      XOR A
0005F1 D36A CDD0D2          17      CALL    DECX
0005F4 D36D E1              10      POP HL
0005F5 D36E C9              10      RET
                                
       D36F                     SETFCB:
0005F6 D36F CD0EDD          17      CALL    SPCUT
0005F9 D372 1A               7      LD  A,(DE)
0005FA D373 FE20             7      CP  020H
0005FC D375 3801            12      JR  C,SETFCBA
0005FE D377 1B               6      DEC DE
       D378                     SETFCBA:
0005FF D378 0624             7      LD  B,36
000601 D37A 215C00          10      LD  HL,FCB1
000604 D37D E5              11      PUSH    HL
000605 D37E AF               4      XOR A
000606 D37F CDE3DC          17      CALL    FILL_MEMORY
000609 D382 E1              10      POP HL
00060A D383 D5              11      PUSH    DE
00060B D384 CD80D7          17      CALL    _SYS29      ;(BDOS)ファイル名の解析
00060E D387 216C00          10      LD  HL,FCB2
000611 D38A CD80D7          17      CALL    _SYS29      ;(BDOS)ファイル名の解析
000614 D38D E1              10      POP HL
000615 D38E 010050          10      LD  BC,05000H
000618 D391 118100          10      LD  DE,00081H
       D394                     SETFCB1:
00061B D394 7E               7      LD  A,(HL)
00061C D395 23               6      INC HL
00061D D396 FE20             7      CP  020H
00061F D398 3805            12      JR  C,SETFCB2
000621 D39A 12               7      LD  (DE),A
000622 D39B 13               6      INC DE
000623 D39C 0C               4      INC C
000624 D39D 10F5            13      DJNZ    SETFCB1
       D39F                     SETFCB2:
000626 D39F 79               4      LD  A,C
000627 D3A0 328000          13      LD  (DTA1),A
00062A D3A3 04               4      INC B
       D3A4                     ZERO_MEMORY_DE:
00062B D3A4 AF               4      XOR A
       D3A5                     FILL_MEMORY_DE:
00062C D3A5 12               7      LD  (DE),A
00062D D3A6 13               6      INC DE
00062E D3A7 10FC            13      DJNZ    FILL_MEMORY_DE
000630 D3A9 C9              10      RET
                                
       D3AA                     C_COPY:
000631 D3AA CD6FD3          17      CALL    SETFCB
                                
000634 D3AD 1161F0          10      LD  DE,ZERO
000637 D3B0 CD2FDC          17      CALL    FILEC2
00063A D3B3 216C00          10      LD  HL,FCB2
00063D D3B6 CD87D7          17      CALL    S29X1
                                
000640 D3B9 3E10             7      LD  A,010H
000642 D3BB 326900          13      LD  (FCB1+13),A
000645 D3BE 216D00          10      LD  HL,FCB2+1
000648 D3C1 CDBAD4          17      CALL    CWILD1
       D3C4                     COPY0:
00064B D3C4 CDB7D4          17      CALL    CWILD
00064E D3C7 215C00          10      LD  HL,FCB1
000651 D3CA CDB1D0          17      CALL    OPEN
000654 D3CD 37               4      SCF
       D3CE                     COPY1:
000655 D3CE C0              11      RET NZ
000656 D3CF CDC4D0          17      CALL    DEFCB
                                
000659 D3D2 3AE8EB          13      LD  A,(DTA_CCP+13)
00065C D3D5 CB67             8      BIT 4,A
00065E D3D7 2821            12      JR  Z,COPY1A
                                
000660 D3D9 215D00          10      LD  HL,FCB1+1
000663 D3DC CD72E0          17      CALL    CHKWILD
000666 D3DF 3814            12      JR  C,COPY9
                                
000668 D3E1 3E20             7      LD  A,020H
00066A D3E3 325D00          13      LD  (FCB1+1),A
00066D D3E6 2AF5EB          16      LD  HL,(DTA_CCP+26)
000670 D3E9 23               6      INC HL
000671 D3EA 226A00          16      LD  (FCB1+14),HL
000674 D3ED 18D5            12      JR  COPY0
                                
       D3EF                     COPY8:
000676 D3EF CD42D5          17      CALL    _SYS09      ;(BDOS)文字列出力
000679 D3F2 CD66D2          17      CALL    LTNL
       D3F5                     COPY9:
00067C D3F5 CDC0D0          17      CALL    OPEN2
00067F D3F8 18D4            12      JR  COPY1
                                
       D3FA                     COPY1A:
000681 D3FA 216C00          10      LD  HL,FCB2
000684 D3FD 1114F0          10      LD  DE,FDRV
000687 D400 01DDEB          10      LD  BC,DTA_CCP+2
00068A D403 EDA0            16      LDI
00068C D405 3E0B             7      LD  A,11
       D407                     COPY2:
00068E D407 F5              11      PUSH    AF
00068F D408 7E               7      LD  A,(HL)
000690 D409 FE3F             7      CP  '?'
000692 D40B 2001            12      JR  NZ,COPY3
000694 D40D 0A               7      LD  A,(BC)
       D40E                     COPY3:
000695 D40E 12               7      LD  (DE),A
000696 D40F 03               6      INC BC
000697 D410 13               6      INC DE
000698 D411 23               6      INC HL
000699 D412 F1              10      POP AF
00069A D413 3D               4      DEC A
00069B D414 20F1            12      JR  NZ,COPY2
00069D D416 010500          10      LD  BC,16-11
0006A0 D419 EDB0                    LDIR
       D41B                     PUTNAME:
0006A2 D41B 215D00          10      LD  HL,FCB1+1
0006A5 D41E CD72E0          17      CALL    CHKWILD
0006A8 D421 300B            12      JR  NC,PUTN1
0006AA D423 2115F0          10      LD  HL,FDRV+1
0006AD D426 CDDED2          17      CALL    FPRNT
0006B0 D429 3E20             7      LD  A,020H
0006B2 D42B CD29D8          17      CALL    MSG_A
       D42E                     PUTN1:
0006B5 D42E 1114F0          10      LD  DE,FDRV
0006B8 D431 0E16             7      LD  C,016H      ;(BDOS)ファイルの作成
0006BA D433 CDDFD0          17      CALL    SYSTEM0
0006BD D436 2048            12      JR  NZ,COPYE2
0006BF D438 67               4      LD  H,A     ;A=0
0006C0 D439 6F               4      LD  L,A
0006C1 D43A 2235F0          16      LD  (FDRV+33),HL    ;(FCB)ランダムレコード
0006C4 D43D 2237F0          16      LD  (FDRV+35),HL
       D440                     COPY6:
0006C7 D440 CDE8D0          17      CALL    S27BUF
0006CA D443 47               4      LD  B,A
0006CB D444 3C               4      INC A
0006CC D445 2831            12      JR  Z,COPYE
0006CE D447 7C               4      LD  A,H
0006CF D448 B5               4      OR  L
0006D0 D449 280C            12      JR  Z,COPY7
0006D2 D44B 1114F0          10      LD  DE,FDRV
0006D5 D44E 0E26             7      LD  C,026H      ;(BDOS)ランダムブロック書き込み
0006D7 D450 CDDFD0          17      CALL    SYSTEM0
0006DA D453 2023            12      JR  NZ,COPYE
0006DC D455 10E9            13      DJNZ    COPY6
       D457                     COPY7:
0006DE D457 3AE8EB          13      LD  A,(DTA_CCP+13)  ;(FCB)属性
0006E1 D45A 3221F0          13      LD  (FDRV+13),A
0006E4 D45D 21EFEB          10      LD  HL,DTA_CCP+20   ;(FCB)タイムスタンプ
0006E7 D460 1128F0          10      LD  DE,FDRV+20
0006EA D463 010400          10      LD  BC,4
0006ED D466 EDB0                    LDIR
                                
0006EF D468 1114F0          10      LD  DE,FDRV
0006F2 D46B 0E10             7      LD  C,010H      ;(BDOS)ファイルのクローズ
0006F4 D46D CDDFD0          17      CALL    SYSTEM0
0006F7 D470 2006            12      JR  NZ,COPYE
                                
0006F9 D472 1171F0          10      LD  DE,OK
0006FC D475 C3EFD3          10      JP  COPY8
                                
       D478                     COPYE:
0006FF D478 1114F0          10      LD  DE,FDRV
000702 D47B 0E13             7      LD  C,013H      ;(BDOS)ファイルの削除
000704 D47D CD0500          17      CALL    SYSTEM
       D480                     COPYE2:
000707 D480 37               4      SCF
000708 D481 C9              10      RET
                                
       D482                     C_TYPE:
000709 D482 CD6FD3          17      CALL    SETFCB
00070C D485 215C00          10      LD  HL,FCB1
00070F D488 CDB1D0          17      CALL    OPEN
000712 D48B 37               4      SCF
       D48C                     TYPE1:
000713 D48C C0              11      RET NZ
000714 D48D CDC4D0          17      CALL    DEFCB
000717 D490 3E06             7      LD  A,6
000719 D492 CD29D8          17      CALL    MSG_A
       D495                     TYPE2:
00071C D495 CDE8D0          17      CALL    S27BUF
00071F D498 C6FE             7      ADD A,0FEH
000721 D49A D8              11      RET C
000722 D49B 7C               4      LD  A,H
000723 D49C B5               4      OR  L
000724 D49D 2813            12      JR  Z,TYPEE
000726 D49F 010001          10      LD  BC,00100H
       D4A2                     TYPE3:
000729 D4A2 0A               7      LD  A,(BC)
00072A D4A3 03               6      INC BC
00072B D4A4 FE1A             7      CP  01AH
00072D D4A6 280A            12      JR  Z,TYPEE
00072F D4A8 CD29D8          17      CALL    MSG_A
000732 D4AB 2B               6      DEC HL
000733 D4AC 7C               4      LD  A,H
000734 D4AD B5               4      OR  L
000735 D4AE 20F2            12      JR  NZ,TYPE3
000737 D4B0 18E3            12      JR  TYPE2
       D4B2                     TYPEE:
000739 D4B2 CDC0D0          17      CALL    OPEN2
00073C D4B5 18D5            12      JR  TYPE1
                                
       D4B7                     CWILD:
00073E D4B7 215D00          10      LD  HL,FCB1+1
       D4BA                     CWILD1:
000741 D4BA 7E               7      LD  A,(HL)
000742 D4BB FE20             7      CP  020H
000744 D4BD C0              11      RET NZ
       D4BE                     CWILD2:
000745 D4BE 3E3F             7      LD  A,'?'
000747 D4C0 060B             7      LD  B,11
000749 D4C2 C3E3DC          10      JP  FILL_MEMORY
                                
00074C D4C5 20202020203C4449    DIRMES: DB  "     <DIR>$"
            523E24              
000757 D4D0 20203A24            DIRHD:  DB  "  :$"
                                
       D4D4                     COMTB:
00075B D4D4 44202020                DB  "D   "  ;1
00075F D4D8 C6D1                    DW  C_DIR
000761 D4DA 44495220                DB  "DIR "  ;2
000765 D4DE C6D1                    DW  C_DIR
000767 D4E0 434F5059                DB  "COPY"  ;3
00076B D4E4 AAD3                    DW  C_COPY
00076D D4E6 43442020                DB  "CD  "  ;4
000771 D4EA E4D0                    DW  C_CD
000773 D4EC 44454C20                DB  "DEL "  ;5
000777 D4F0 A9D1                    DW  C_DEL
000779 D4F2 50415448                DB  "PATH"  ;6
00077D D4F6 6BD2                    DW  C_PATH
00077F D4F8 52454E20                DB  "REN "  ;7
000783 D4FC B3D1                    DW  C_REN
000785 D4FE 54595045                DB  "TYPE"  ;8
000789 D502 82D4                    DW  C_TYPE
00078B D504 52454D20                DB  "REM "  ;9
00078F D508 3FD5                    DW  C_REM
[EOF:LDCCP.ASM:SHIFT_JIS]
                                    INCLUDE "M7CCP2.ASM"
                                
                                ;   LSX-Dodgers CCP2
                                ;   MZ-700/1500
                                
000791 D50A 4D4F4E20                DB  "MON "  ;10
000795 D50E DCCF                    DW  C_MON
[EOF:M7CCP2.ASM:UTF_8]
                                    INCLUDE "LDOS.ASM"
                                
                                ;   LSX-Dodgers OS
                                
       D510                     BDOS0:
000797 D510 E5              11      PUSH    HL
000798 D511 79               4      LD  A,C
000799 D512 FE3C             7      CP  03CH
00079B D514 3802            12      JR  C,DOS1
00079D D516 3E3C             7      LD  A,03CH
       D518                     DOS1:
00079F D518 87               4      ADD A,A
0007A0 D519 6F               4      LD  L,A
0007A1 D51A 26F1             7      LD  H,STABLE/256
0007A3 D51C 7E               7      LD  A,(HL)
0007A4 D51D 2C               4      INC L
0007A5 D51E 66               7      LD  H,(HL)
0007A6 D51F 6F               4      LD  L,A
0007A7 D520 E3              19      EX  (SP),HL
0007A8 D521 79               4      LD  A,C
                                ;確認用
                                ;   LD  (0050H),A
0007A9 D522 C9              10      RET
       D523                     _DOS2:
0007AA D523 FE5A             7      CP  05AH        ;(BDOS)カレントディレクトリの変更(_CHDIR)
0007AC D525 CAC4D7          10      JP  Z,_SYS5A
0007AF D528 FE5C             7      CP  05CH        ;(BDOS)ファイル名の解析(_PFILE)
0007B1 D52A CA80D7          10      JP  Z,_SYS29
0007B4 D52D FE5F             7      CP  05FH        ;(BDOS)ディスクバッファのフラッシュ(_FLUSH)
0007B6 D52F CA8BE9          10      JP  Z,_SYS5F
0007B9 D532 FE6F             7      CP  06FH        ;(BDOS)MSX-DOS のバージョン番号の獲得(_DOSVER)
0007BB D534 200A            12      JR  NZ,_ERROR
0007BD D536 011D01          10      LD  BC,011DH
0007C0 D539 115501          10      LD  DE,VER
0007C3 D53C 210100          10      LD  HL,MACD
       D53F                     C_REM:
0007C6 D53F AF               4      XOR A
       D540                     _ERROR:
0007C7 D540 A7               4      AND A
0007C8 D541 C9              10      RET
                                
       D542                     _SYS09:     ;文字列出力
0007C9 D542 D5              11      PUSH    DE
       D543                     _SX09:
0007CA D543 1A               7      LD  A,(DE)
0007CB D544 13               6      INC DE
0007CC D545 FE24             7      CP  '$'
0007CE D547 2831            12      JR  Z,SX0E2
0007D0 D549 CD29D8          17      CALL    MSG_A
0007D3 D54C 18F5            12      JR  _SX09
                                
       D54E                     MSX1:
0007D5 D54E CD29D8          17      CALL    MSG_A
       D551                     MSX:
0007D8 D551 7E               7      LD  A,(HL)
0007D9 D552 23               6      INC HL
0007DA D553 B7               4      OR  A
0007DB D554 20F8            12      JR  NZ,MSX1
0007DD D556 C9              10      RET
                                
       D557                     _SYS0C:     ;(BDOS)バージョン番号の獲得
0007DE D557 212200          10      LD  HL,00022H
0007E1 D55A 7D               4      LD  A,L
0007E2 D55B C9              10      RET
                                
       D55C                     _SYS0D:     ;(BDOS)ディスクリセット
0007E3 D55C CDDFF0          17      CALL    _FFLUSH
0007E6 D55F E5              11      PUSH    HL
0007E7 D560 218000          10      LD  HL,00080H
0007EA D563 228AF0          16      LD  (_DTA),HL
0007ED D566 E1              10      POP HL
0007EE D567 D5              11      PUSH    DE
0007EF D568 1E00             7      LD  E,0
0007F1 D56A 3E                      DB  03EH
                                
       D56B                     _SYS0E:     ;(BDOS)カレントドライブの設定
0007F2 D56B D5              11      PUSH    DE
0007F3 D56C 7B               4      LD  A,E
0007F4 D56D DDE5            15      PUSH    IX
0007F6 D56F CDDCF0          17      CALL    _GETDPB
0007F9 D572 DDE1            14      POP IX
0007FB D574 3804            12      JR  C,SX0E2
0007FD D576 7B               4      LD  A,E
0007FE D577 3287F0          13      LD  (_DVSW),A
       D57A                     SX0E2:
000801 D57A D1              10      POP DE
000802 D57B C9              10      RET
                                
       D57C                     _SYS0F:     ;(BDOS)ファイルのオープン
000803 D57C CD20DD          17      CALL    SETDRV
000806 D57F FD7E1C          19      LD  A,(IY+28)   ;(FCB)オープンモード
000809 D582 C602             7      ADD A,002H      ;Write
00080B D584 2848            12      JR  Z,FEND0F
00080D D586 CD6EE0          17      CALL    CHKWILDX
                                
000810 D589 D440DD          17      CALL    NC,SOPENX
       D58C                     _S16XX:
000813 D58C 3840            12      JR  C,FEND0F
                                                ;Directory location
000815 D58E 3A9FF0          13      LD  A,(_FILEN)
000818 D591 FD7719          19      LD  (IY+25),A   ;(FCB)ディレクトリロケーション
                                ;               _DIRF
00081B D594 3AA0F0          13      LD  A,(_DIRF)
00081E D597 FD771D          19      LD  (IY+29),A   ;(FCB)ディレクトリモード
                                ;               _FBPS
000821 D59A FD731E          19      LD  (IY+30),E   ;(FCB)ディレクトリポジション
000824 D59D FD721F          19      LD  (IY+31),D
                                ;               Open(Read)
000827 D5A0 FD361CFF        19      LD  (IY+28),0FFH    ;(FCB)オープンモード
                                ;               FILENAME
00082B D5A4 FDE5            15      PUSH    IY
00082D D5A6 D1              10      POP DE
00082E D5A7 13               6      INC DE
00082F D5A8 010B00          10      LD  BC,11
000832 D5AB EDB0                    LDIR
                                ;               Attribute
000834 D5AD 7E               7      LD  A,(HL)
000835 D5AE FD770D          19      LD  (IY+13),A   ;(FCB)属性(アトリビュート)
000838 D5B1 110B00          10      LD  DE,11       ;Reserved
00083B D5B4 19              11      ADD HL,DE
                                                    ;(FCB)ファイルを最後に変更した時刻
00083C D5B5 11EAF1          10      LD  DE,SDDATA       ;(FCB)ファイルを最後に変更した日付
00083F D5B8 060A             7      LD  B,SDDATAE-SDDATA    ;(FCB)ファイルの先頭クラスタ
       D5BA                     S16LOOP:                ;(FCB)ファイルのサイズ(バイト単位)
000841 D5BA 1A               7      LD  A,(DE)
000842 D5BB 13               6      INC DE
000843 D5BC 32C3D5          13      LD  (S16PAT+2),A
000846 D5BF 7E               7      LD  A,(HL)
000847 D5C0 23               6      INC HL
000848 D5C1 FD7700          19  S16PAT: LD  (IY+0),A
00084B D5C4 10F4            13      DJNZ    S16LOOP
                                
00084D D5C6 AF               4      XOR A
00084E D5C7 FD770C          19      LD  (IY+12),A   ;(FCB)カレントブロック
000851 D5CA FD2272D6        20      LD  (OFCB+1),IY
       D5CE                     FEND0F:
000855 D5CE 1845            12      JR  FEND10
                                
       D5D0                     _SYS10:     ;(BDOS)ファイルのクローズ
000857 D5D0 CD20DD          17      CALL    SETDRV
00085A D5D3 FD7E1C          19      LD  A,(IY+28)   ;(FCB)オープンモード
00085D D5D6 D6FE             7      SUB 0FEH
00085F D5D8 37               4      SCF
000860 D5D9 3F               4      CCF
000861 D5DA 2039            12      JR  NZ,FEND10
       D5DC                     _S10A:              ;Write
000863 D5DC FD770E          19      LD  (IY+14),A   ;(FCB)レコードサイズ/アクセスするディレクトリのクラスタ番号+1
000866 D5DF FD770F          19      LD  (IY+15),A
                                
000869 D5E2 FD341C          23      INC (IY+28)     ;0FEH->0FFH ;オープンモード
00086C D5E5 CD6AE1          17      CALL    SETTMS
                                
00086F D5E8 FD7E1D          19      LD  A,(IY+29)   ;(FCB)ディレクトリモード
000872 D5EB 32A0F0          13      LD  (_DIRF),A
000875 D5EE E67F             7      AND 07FH
000877 D5F0 3295E6          13      LD  (_SECPS+1),A
00087A D5F3 FD5E1E          19      LD  E,(IY+30)   ;(FCB)ディレクトリポジション
00087D D5F6 FD561F          19      LD  D,(IY+31)
000880 D5F9 CD74DE          17      CALL    READ_DIR
000883 D5FC 3817            12      JR  C,FEND10
                                
000885 D5FE 3A9EDD          13  SDECM1: LD  A,(SDECPAT+1)   ;1セクタ辺りのディレクトリエントリ数
000888 D601 3D               4      DEC A       ;1024=01FH / 512=00FH / 256=7
000889 D602 FDA619          19      AND (IY+25)     ;(FCB)ディレクトリロケーション
00088C D605 6F               4      LD  L,A
00088D D606 2600             7      LD  H,0
00088F D608 29              11      ADD HL,HL       ;*2
000890 D609 29              11      ADD HL,HL       ;*4
000891 D60A 29              11      ADD HL,HL       ;*8
000892 D60B 29              11      ADD HL,HL       ;*16
000893 D60C 29              11      ADD HL,HL       ;*32
000894 D60D ED4B7EF1        20      LD  BC,(_DTBUF)
000898 D611 09              11      ADD HL,BC
                                
000899 D612 CD7EE0          17      CALL    SDIRENT
       D615                     FEND10:
00089C D615 1842            12      JR  FEND
                                
       D617                     _SYS11:     ;(BDOS)最初のファイルの検索
00089E D617 CD20DD          17      CALL    SETDRV
0008A1 D61A CD6DDD          17      CALL    SOPEN
       D61D                     _S12X1:
0008A4 D61D 383A            12      JR  C,FEND
0008A6 D61F CD0DDE          17      CALL    SOPENE2
0008A9 D622 ED5B8AF0        20      LD  DE,(_DTA)
0008AD D626 3A88F0          13      LD  A,(_DRV)
0008B0 D629 3C               4      INC A
0008B1 D62A 12               7      LD  (DE),A
0008B2 D62B D5              11      PUSH    DE
0008B3 D62C 13               6      INC DE
0008B4 D62D 012000          10      LD  BC,32
0008B7 D630 EDB0                    LDIR
0008B9 D632 FD6E0E          19      LD  L,(IY+14)   ;(FCB)レコードサイズ/アクセスするディレクトリのクラスタ番号+1
0008BC D635 FD660F          19      LD  H,(IY+15)
0008BF D638 22F4F1          16      LD  (SCDIR),HL
0008C2 D63B 2A9AF0          16      LD  HL,(_FBPS)
0008C5 D63E 22F6F1          16      LD  (SFBPS),HL
0008C8 D641 2A9FF0          16      LD  HL,(_FILEN)
0008CB D644 7C               4      LD  A,H
0008CC D645 B7               4      OR  A
0008CD D646 2806            12      JR  Z,_S12DIR
0008CF D648 3A95E6          13      LD  A,(_SECPS+1)
0008D2 D64B F680             7      OR  080H
0008D4 D64D 67               4      LD  H,A
       D64E                     _S12DIR:
0008D5 D64E 22F8F1          16      LD  (SFNDF),HL  ;Directory position and Flags
0008D8 D651 E1              10      POP HL
0008D9 D652 1139F0          10      LD  DE,SFILE
0008DC D655 0E21             7      LD  C,33
       D657                     _S11B:
0008DE D657 EDB0                    LDIR
       D659                     FEND:
0008E0 D659 9F               4      SBC A,A     ;CF=0 A=0 : CF=1 A=0FFH
       D65A                     FENDE:
0008E1 D65A FDE1            14      POP IY
0008E3 D65C C1              10      POP BC
0008E4 D65D D1              10      POP DE
0008E5 D65E E1              10      POP HL
0008E6 D65F C9              10      RET
                                
       D660                     _SYS12:     ;(BDOS)次のファイルの検索
0008E7 D660 E5              11      PUSH    HL
0008E8 D661 D5              11      PUSH    DE
0008E9 D662 C5              11      PUSH    BC
0008EA D663 FDE5            15      PUSH    IY
0008EC D665 CDD1DD          17      CALL    NOPEN
0008EF D668 18B3            12      JR  _S12X1
                                
       D66A                     _S16K:
0008F1 D66A FD7E1C          19      LD  A,(IY+28)   ;(FCB)オープンモード
0008F4 D66D FEFD             7      CP  0FDH        ;Device(0FDH)
0008F6 D66F 37               4      SCF
0008F7 D670 C8              11      RET Z
                                
0008F8 D671 110000          10  OFCB:   LD  DE,0
0008FB D674 D5              11      PUSH    DE
0008FC D675 061A             7      LD  B,26        ;First cluster
       D677                     S16K1:
0008FE D677 13               6      INC DE
0008FF D678 23               6      INC HL
000900 D679 10FC            13      DJNZ    S16K1
                                
000902 D67B 1A               7      LD  A,(DE)
000903 D67C BE               7      CP  (HL)
000904 D67D 2013            12      JR  NZ,S16K2
000906 D67F 13               6      INC DE
000907 D680 23               6      INC HL
000908 D681 1A               7      LD  A,(DE)
000909 D682 BE               7      CP  (HL)
00090A D683 200D            12      JR  NZ,S16K2
                                
00090C D685 E1              10      POP HL
00090D D686 FDE5            15      PUSH    IY
00090F D688 D1              10      POP DE
000910 D689 1A               7      LD  A,(DE)      ;Drive
000911 D68A BE               7      CP  (HL)
000912 D68B 2006            12      JR  NZ,S16K3
                                                ;ここはCFが必ず0
000914 D68D ED52            15      SBC HL,DE       ;CP HL,DE
000916 D68F 37               4      SCF
000917 D690 C0              11      RET NZ
000918 D691 E5              11      PUSH    HL
       D692                     S16K2:
000919 D692 E1              10      POP HL
       D693                     S16K3:
00091A D693 FDE5            15      PUSH    IY
00091C D695 D1              10      POP DE
       D696                     _SYS13:     ;(BDOS)ファイルの削除
00091D D696 CD20DD          17      CALL    SETDRV
000920 D699 CD9EDF          17      CALL    KILL
       D69C                     FEND13:
000923 D69C 18BB            12      JR  FEND
                                
       D69E                     _SYS14:     ;(BDOS)シーケンシャルな読み出し
000925 D69E CD20DD          17      CALL    SETDRV
000928 D6A1 CDD6E1          17      CALL    INIT_SEQ
       D6A4                     SREAD:
00092B D6A4 CD1EE2          17      CALL    RB_READ
                                
00092E D6A7 C601             7      ADD A,001H
000930 D6A9 38AE            12      JR  C,FEND
                                
000932 D6AB 7D               4      LD  A,L
000933 D6AC D601             7      SUB 001H
       D6AE                     FENDX:
000935 D6AE 9F               4      SBC A,A
000936 D6AF E603             7      AND 3
000938 D6B1 1F               4      RRA
000939 D6B2 18A6            12      JR  FENDE
                                
       D6B4                     _SYS15:     ;(BDOS)シーケンシャルな書き込み
00093B D6B4 CD20DD          17      CALL    SETDRV
00093E D6B7 CDD6E1          17      CALL    INIT_SEQ
       D6BA                     SWRITE:
000941 D6BA CD17E2          17      CALL    RB_WRITE
                                
000944 D6BD C6FF             7      ADD A,0FFH
000946 D6BF 18ED            12      JR  FENDX
                                
       D6C1                     _SYS17:     ;(BDOS)ファイル名の変更
000948 D6C1 CD20DD          17      CALL    SETDRV
00094B D6C4 CDF4DF          17      CALL    NAME
00094E D6C7 18D3            12      JR  FEND13
                                
       D6C9                     _SYS16:     ;(BDOS)ファイルの作成
000950 D6C9 CD20DD          17      CALL    SETDRV
                                
000953 D6CC CD6EE0          17      CALL    CHKWILDX
000956 D6CF 38CB            12      JR  C,FEND13
000958 D6D1 FD7E01          19      LD  A,(IY+1)    ;(FCB)主ファイル名
00095B D6D4 FE05             7      CP  5
00095D D6D6 2805            12      JR  Z,_S16X2
00095F D6D8 FE21             7      CP  021H
000961 D6DA DA9CD6          10      JP  C,FEND13
       D6DD                     _S16X2:
                                ;               Clear FCB
000964 D6DD FDE5            15      PUSH    IY
000966 D6DF E1              10      POP HL
000967 D6E0 011000          10      LD  BC,16
00096A D6E3 09              11      ADD HL,BC
       D6E4                     _S16X1:
00096B D6E4 70               7      LD  (HL),B      ;B=0
00096C D6E5 23               6      INC HL
00096D D6E6 0D               4      DEC C
00096E D6E7 20FB            12      JR  NZ,_S16X1
                                
000970 D6E9 CD6FE1          17      CALL    SETTMSX
000973 D6EC FD360DFF        19      LD  (IY+13),0FFH    ;(FCB)Attribute
000977 D6F0 CD40DD          17      CALL    SOPENX
00097A D6F3 3F               4      CCF
00097B D6F4 CC6AD6          17      CALL    Z,_S16K
00097E D6F7 D41EDE          17      CALL    NC,COPEN
000981 D6FA D47EE0          17      CALL    NC,SDIRENT
000984 D6FD C38CD5          10      JP  _S16XX
                                
       D700                     _SYS21:     ;(BDOS)ランダムな読み出し
000987 D700 CD20DD          17      CALL    SETDRV
00098A D703 CDBAE1          17      CALL    INIT_RND
00098D D706 189C            12      JR  SREAD
                                
       D708                     _SYS22:     ;(BDOS)ランダムな書き込み
       D708                     _SYS28:     ;(BDOS)ランダムな書き込み・その2
00098F D708 CD20DD          17      CALL    SETDRV
000992 D70B CDBAE1          17      CALL    INIT_RND
000995 D70E 18AA            12      JR  SWRITE
                                
       D710                     _SYS18:     ;(BDOS)ログインベクトルの獲得
000997 D710 21FF00          10      LD  HL,000FFH
00099A D713 AF               4      XOR A
00099B D714 C9              10      RET
                                
       D715                     _SYS19:     ;(BDOS)カレントドライブ番号の獲得
00099C D715 3A87F0          13      LD  A,(_DVSW)
00099F D718 A7               4      AND A
0009A0 D719 C9              10      RET
                                
       D71A                     _SYS1A:     ;(BDOS)DTAの設定
0009A1 D71A ED538AF0        20      LD  (_DTA),DE
0009A5 D71E AF               4      XOR A
0009A6 D71F C9              10      RET
                                
       D720                     _SYS1B:     ;(BDOS)ディスク情報の獲得
0009A7 D720 7B               4      LD  A,E
0009A8 D721 CD33DD          17      CALL    GETDRV
0009AB D724 CDDCF0          17      CALL    _GETDPB
0009AE D727 D4E2F0          17      CALL    NC,_RDFATX
0009B1 D72A 210000          10      LD  HL,0
0009B4 D72D D448E1          17      CALL    NC,DSKF
                                
0009B7 D730 ED5B49E1        20      LD  DE,(MAXCLP+1)   ;DPB_08_MAXCL-1
0009BB D734 1B               6      DEC DE      ;DE←クラスタの総数
0009BC D735 FD2A7CF1        20      LD  IY,(_FATBF) ;IY←メモリ上のFATの先頭アドレス
0009C0 D739 9F               4      SBC A,A
0009C1 D73A D8              11      RET C
0009C2 D73B 4F               4      LD  C,A     ;C=0
0009C3 D73C DD7E0F          19      LD  A,(IX+00FH) ;DPB_0F_BPS
0009C6 D73F E60F             7      AND 00FH
0009C8 D741 47               4      LD  B,A
0009C9 D742 DD7E07          19      LD  A,(IX+7)    ;DPB_07_SECPCL
0009CC D745 C9              10      RET
                                
       D746                     _SYS1D:     ;(BDOS)書き込みが禁止されているディスクの調査
0009CD D746 AF               4      XOR A
0009CE D747 67               4      LD  H,A
0009CF D748 6F               4      LD  L,A
0009D0 D749 C9              10      RET
                                
       D74A                     _SYS1F:     ;(BDOS)ディスク装置のパラメータの読み出し
0009D1 D74A 2100F2          10      LD  HL,DEVICE
0009D4 D74D 7B               4      LD  A,E
0009D5 D74E C3DCF0          10      JP  _GETDPB
                                
       D751                     _SYS23:     ;(BDOS)ファイルサイズの獲得
0009D8 D751 E5              11      PUSH    HL
0009D9 D752 2A1EF1          16      LD  HL,(STABLE+2*00FH)  ;ファイルのオープン
0009DC D755 CD0F00          17      CALL    JP_HL
0009DF D758 381B            12      JR  C,_S23X1
                                
0009E1 D75A D5              11      PUSH    DE      ;EX DE,IY
0009E2 D75B FDE3            23      EX  (SP),IY     ;
                                ;   POP DE      ;
                                ;   PUSH    DE      ;DEを破壊しないように注意vv
0009E4 D75D FD7E10          19      LD  A,(IY+16)   ;(FCB)ファイルのサイズ(バイト単位)
0009E7 D760 FD6E11          19      LD  L,(IY+17)   ;
0009EA D763 FD6612          19      LD  H,(IY+18)   ;
0009ED D766 C5              11      PUSH    BC      ;
0009EE D767 FD4613          19      LD  B,(IY+19)   ;
0009F1 D76A CDACE1          17      CALL    GET_CPM_R_SIZE
0009F4 D76D C1              10      POP BC
       D76E                     _S24X1:
0009F5 D76E CDCCE1          17      CALL    SET_RR_AHL
                                ;   POP DE      ;^^^^^^^^^^^^^^^^^^^^^^^^
                                ;   PUSH    DE      ;EX DE,IY
0009F8 D771 FDE3            23      EX  (SP),IY     ;
0009FA D773 D1              10      POP DE      ;
                                
0009FB D774 AF               4      XOR A
       D775                     _S23X1:
0009FC D775 E1              10      POP HL
0009FD D776 C9              10      RET
                                
       D777                     _SYS24:     ;(BDOS)ランダムレコードフィールドの設定
0009FE D777 E5              11      PUSH    HL
0009FF D778 D5              11      PUSH    DE      ;EX DE,IY
000A00 D779 FDE3            23      EX  (SP),IY     ;
                                ;   POP DE      ;
                                ;   PUSH    DE      ;DEを破壊しないように注意vv
000A02 D77B CDDEE1          17      CALL    GETSEQ
000A05 D77E 18EE            12      JR  _S24X1      ;^^^^^^^^^^^^^^^^^^^^^^^^
                                
       D780                     _SYS29:     ;(BDOS)ファイル名の解析(_PPATH)
000A07 D780 C5              11      PUSH    BC
000A08 D781 E5              11      PUSH    HL
000A09 D782 CD37DC          17      CALL    FILE
000A0C D785 E1              10      POP HL
000A0D D786 C1              10      POP BC
       D787                     S29X1:
000A0E D787 C5              11      PUSH    BC
000A0F D788 D5              11      PUSH    DE
000A10 D789 E5              11      PUSH    HL
000A11 D78A EB               4      EX  DE,HL
000A12 D78B 2114F0          10      LD  HL,FDRV
000A15 D78E 010D00          10      LD  BC,13
000A18 D791 EDB0                    LDIR
000A1A D793 70               7      LD  (HL),B      ;B=0
000A1B D794 0E03             7      LD  C,3
000A1D D796 EDB0                    LDIR
000A1F D798 E1              10      POP HL
000A20 D799 D1              10      POP DE
000A21 D79A C1              10      POP BC
000A22 D79B AF               4      XOR A
000A23 D79C C9              10      RET
                                
       D79D                     _SYS30:     ;(BDOS)論理セクタを用いた書き込み
000A24 D79D C5              11      PUSH    BC
000A25 D79E 012FE8          10      LD  BC,DWT24B
000A28 D7A1 1804            12      JR  S2FX
       D7A3                     _SYS2F:
000A2A D7A3 C5              11      PUSH    BC
000A2B D7A4 011FE8          10      LD  BC,DRD24B
       D7A7                     S2FX:
000A2E D7A7 ED43BDD7        20      LD  (S2FPAT+1),BC
000A32 D7AB CDDFF0          17      CALL    _FFLUSH
                                
000A35 D7AE D5              11      PUSH    DE
000A36 D7AF E5              11      PUSH    HL
000A37 D7B0 7D               4      LD  A,L     ;Drive
000A38 D7B1 CDD9F0          17      CALL    _CHGDRV
000A3B D7B4 3809            12      JR  C,S30X2
000A3D D7B6 44               4      LD  B,H     ;Number of clusters
000A3E D7B7 2A8AF0          16      LD  HL,(_DTA)
                                
000A41 D7BA 0E00             7      LD  C,0
000A43 D7BC CD1FE8          17  S2FPAT: CALL    DRD24B
       D7BF                     S30X2:
000A46 D7BF E1              10      POP HL
000A47 D7C0 D1              10      POP DE
000A48 D7C1 C1              10      POP BC
000A49 D7C2 9F               4      SBC A,A
000A4A D7C3 C9              10      RET
                                
       D7C4                     _SYS5A:     ;(BDOS)カレントディレクトリの変更
000A4B D7C4 C5              11      PUSH    BC
000A4C D7C5 D5              11      PUSH    DE
000A4D D7C6 E5              11      PUSH    HL
000A4E D7C7 CD2CDC          17      CALL    FILEC
000A51 D7CA 210000          10      LD  HL,0
000A54 D7CD 1114F0          10      LD  DE,FDRV
000A57 D7D0 2A4EF1          16      LD  HL,(STABLE+2*027H)  ;ランダムブロック読み込み
000A5A D7D3 CD0F00          17      CALL    JP_HL
000A5D D7D6 18E7            12      JR  S30X2
[EOF:LDOS.ASM:SHIFT_JIS]
                                    INCLUDE "M7IO.ASM"
                                
                                ;   LSX-Dodgers IO
                                ;   MZ-700/1500
                                
       D540                     _SYS04  EQU _ERROR      ;(BDOS)外部出力
       D540                     _SYS05  EQU _ERROR      ;(BDOS)プリンタ出力
       D540                     _SYS1C  EQU _ERROR      ;(BDOS)ディスクの書き込み禁止化
       D540                     _SYS1E  EQU _ERROR      ;(BDOS)ファイル属性の設定
       D540                     _SYS20  EQU _ERROR      ;(BDOS)利用者番号の設定と読み出し
       D540                     _SYS2E  EQU _ERROR      ;(BDOS)ベリファイ・フラグの設定
                                
       0000                     INT EQU 0
       0000                     INTCTCE EQU 0
       0000                     INTCTC2 EQU 0
                                
       D7D8                     ARWKEY:
000A5F D7D8 3D               4      DEC A
000A60 D7D9 32EBD7          13      LD  (KEYAR),A
000A63 D7DC 181D            12      JR  INT8253E
       D7DE                     SETKEY1:
000A65 D7DE 3A95F0          13      LD  A,(_KEYSP+1)
000A68 D7E1 180C            12      JR  SETKEY
       D7E3                     INT8253:
000A6A D7E3 CDBEDB          17      CALL    CHKEY
       D7E7                     KEYDT   EQU $+1
000A6D D7E6 FE00             7      CP  0
000A6F D7E8 20F4            12      JR  NZ,SETKEY1
       D7EB                     KEYAR   EQU $+1
000A71 D7EA 3E00             7      LD  A,0
000A73 D7EC B7               4      OR  A
000A74 D7ED 20E9            12      JR  NZ,ARWKEY
       D7EF                     SETKEY:
000A76 D7EF 32EBD7          13      LD  (KEYAR),A
000A79 D7F2 3A92F0          13      LD  A,(_KEYD)
000A7C D7F5 32E7D7          13      LD  (KEYDT),A
000A7F D7F8 CDFED7          17      CALL    KEYSET
       D7FB                     INT8253E:
000A82 D7FB F1              10      POP AF
000A83 D7FC FB               4      EI
000A84 D7FD C9              10      RET
       D7FE                     KEYSET:
       D7FE                     KEYBS:
000A85 D7FE B7               4      OR  A
000A86 D7FF C8              11      RET Z
       D800                     KEYBS1:
000A87 D800 CD16D8          17      CALL    KEYBC_IFBREAK
000A8A D803 E5              11      PUSH    HL
000A8B D804 F5              11      PUSH    AF
000A8C D805 2A90F0          16      LD  HL,(_KEYPS)
000A8F D808 2C               4      INC L
000A90 D809 7D               4      LD  A,L
000A91 D80A BC               4      CP  H
000A92 D80B 2815            12      JR  Z,POP_AF_HL_SCF_RET
000A94 D80D 3290F0          13      LD  (_KEYPS),A
000A97 D810 26FF             7      LD  H,KEYBF/256
000A99 D812 F1              10      POP AF
000A9A D813 77               7      LD  (HL),A
000A9B D814 E1              10      POP HL
000A9C D815 C9              10      RET
       D816                     KEYBC_IFBREAK:
000A9D D816 FE03             7      CP  3
000A9F D818 C0              11      RET NZ
       D819                     KEYBC:
000AA0 D819 E5              11      PUSH    HL
000AA1 D81A 210000          10      LD  HL,0
000AA4 D81D 2290F0          16      LD  (_KEYPS),HL
000AA7 D820 E1              10      POP HL
000AA8 D821 C9              10      RET
                                
       D822                     POP_AF_HL_SCF_RET:
000AA9 D822 F1              10      POP AF
000AAA D823 E1              10      POP HL
000AAB D824 37               4      SCF
000AAC D825 C9              10      RET
                                
       D826                     _SYS01:     ;(BDOS)コンソール入力
000AAD D826 CD09F0          17      CALL    _SYS07
       D829                     MSG_A:
000AB0 D829 F5              11      PUSH    AF
000AB1 D82A D5              11      PUSH    DE
000AB2 D82B 5F               4      LD  E,A
000AB3 D82C CD32D8          17      CALL    _SYS02
000AB6 D82F D1              10      POP DE
000AB7 D830 F1              10      POP AF
000AB8 D831 C9              10      RET
                                
       D832                     _SYS02:     ;(BDOS)コンソール出力
000AB9 D832 CD44D8          17      CALL    BREAK
000ABC D835 1805            12      JR  PRINTX
                                
       D837                     _SYS06:     ;(BDOS)コンソール直接入出力
000ABE D837 7B               4      LD  A,E
000ABF D838 3C               4      INC A
000AC0 D839 CACAF0          10      JP  Z,_INKEY
       D83C                     PRINTX:
000AC3 D83C C3CDF0          10      JP  _PRINT
                                
       D83F                     _SYS08:     ;(BDOS)エコーなしコンソール入力
000AC6 D83F CD09F0          17      CALL    _SYS07
000AC9 D842 1804            12      JR  BREAK1
       D844                     BREAK:
000ACB D844 FB               4      EI
000ACC D845 3A92F0          13      LD  A,(_KEYD)
       D848                     BREAK1:
000ACF D848 FE03             7      CP  3       ;CTRL+C
000AD1 D84A CA00F0          10      JP  Z,CPM_BOOT
000AD4 D84D FE13             7      CP  013H        ;CTRL+S
000AD6 D84F C0              11      RET NZ
                                
       D850                     PAUSE:
000AD7 D850 CD19D8          17      CALL    KEYBC
                                
       D853                     FLGET:
000ADA D853 CDDFF0          17      CALL    _FFLUSH
000ADD D856 E5              11      PUSH    HL
000ADE D857 2A8EF0          16      LD  HL,(_TXADR)
000AE1 D85A 7C               4      LD  A,H
000AE2 D85B C6D0             7      ADD A,0D0H
000AE4 D85D 67               4      LD  H,A
000AE5 D85E CD37CF          17      CALL    RDMMIO
000AE8 D861 3276D8          13      LD  (FLSMC),A
       D864                     FLGET1:
000AEB D864 CD2DCF          17      CALL    RD556VSYNC
000AEE D867 CB77             8      BIT 6,A
000AF0 D869 3EEF             7      LD  A,0EFH      ;カーソル
000AF2 D86B 200A            12      JR  NZ,FLGET2
000AF4 D86D 3A92F0          13      LD  A,(_KEYD)
000AF7 D870 B7               4      OR  A
000AF8 D871 3EEF             7      LD  A,0EFH      ;カーソル
000AFA D873 2002            12      JR  NZ,FLGET2
       D876                     FLSMC   EQU $+1
000AFC D875 3E00             7      LD  A,0     ;自己書き換え
       D877                     FLGET2:
000AFE D877 CD3FCF          17      CALL    WRMMIO
000B01 D87A CDCAF0          17      CALL    _INKEY
000B04 D87D 28E5            12      JR  Z,FLGET1
000B06 D87F F5              11      PUSH    AF
000B07 D880 3A76D8          13      LD  A,(FLSMC)
000B0A D883 CD3FCF          17      CALL    WRMMIO
000B0D D886 F1              10      POP AF
000B0E D887 E1              10      POP HL
000B0F D888 C9              10      RET
                                
       D889                     _SYS0A:     ;(BDOS)文字列入力
000B10 D889 C5              11      PUSH    BC
000B11 D88A E5              11      PUSH    HL
000B12 D88B D5              11      PUSH    DE
000B13 D88C CD1EDB          17      CALL    GETL
000B16 D88F 1120FF          10      LD  DE,KBUF
000B19 D892 E1              10      POP HL
000B1A D893 E5              11      PUSH    HL
000B1B D894 0E00             7      LD  C,0
000B1D D896 3004            12      JR  NC,SAX0
000B1F D898 23               6      INC HL
000B20 D899 23               6      INC HL
000B21 D89A 1808            12      JR  SAX4
       D89C                     SAX0:
000B23 D89C 46               7      LD  B,(HL)
000B24 D89D 23               6      INC HL
       D89E                     SAX1:
000B25 D89E 23               6      INC HL
000B26 D89F 1A               7      LD  A,(DE)
000B27 D8A0 13               6      INC DE
000B28 D8A1 B7               4      OR  A
000B29 D8A2 2004            12      JR  NZ,SAX2
       D8A4                     SAX4:
000B2B D8A4 360D            10      LD  (HL),00DH
000B2D D8A6 1804            12      JR  SAX3
       D8A8                     SAX2:
000B2F D8A8 77               7      LD  (HL),A
000B30 D8A9 0C               4      INC C
000B31 D8AA 10F2            13      DJNZ    SAX1
       D8AC                     SAX3:
000B33 D8AC D1              10      POP DE
000B34 D8AD 79               4      LD  A,C
000B35 D8AE 13               6      INC DE
000B36 D8AF 12               7      LD  (DE),A
000B37 D8B0 1B               6      DEC DE
000B38 D8B1 E1              10      POP HL
000B39 D8B2 C1              10      POP BC
000B3A D8B3 A7               4      AND A
000B3B D8B4 C9              10      RET
                                
       D8B5                     _SYS0B:     ;(BDOS)コンソール状態のチェック
000B3C D8B5 CD44D8          17      CALL    BREAK
000B3F D8B8 3A92F0          13      LD  A,(_KEYD)
000B42 D8BB B7               4      OR  A
000B43 D8BC C8              11      RET Z
       D8BD                     CONSTX:
000B44 D8BD CDDFF0          17      CALL    _FFLUSH
000B47 D8C0 E5              11      PUSH    HL
000B48 D8C1 2A90F0          16      LD  HL,(_KEYPS)
000B4B D8C4 7C               4      LD  A,H
000B4C D8C5 AD               4      XOR L
000B4D D8C6 E1              10      POP HL
000B4E D8C7 C6FF             7      ADD A,0FFH
000B50 D8C9 9F               4      SBC A,A
000B51 D8CA C9              10      RET
                                
       D8CB                     _SYS2A:     ;(BDOS)日付の獲得
000B52 D8CB AF               4      XOR A
000B53 D8CC 57               4      LD  D,A
000B54 D8CD 5F               4      LD  E,A
000B55 D8CE 67               4      LD  H,A
000B56 D8CF 6F               4      LD  L,A
000B57 D8D0 C9              10      RET
                                
       D8D1                     _SYS2C:     ;(BDOS)時刻の獲得
000B58 D8D1 AF               4      XOR A
000B59 D8D2 57               4      LD  D,A
000B5A D8D3 5F               4      LD  E,A
000B5B D8D4 67               4      LD  H,A
000B5C D8D5 6F               4      LD  L,A
000B5D D8D6 C9              10      RET
                                
       D8D7                     ESC1:
000B5E D8D7 7B               4      LD  A,E
000B5F D8D8 FE41             7      CP  'A'
000B61 D8DA CACFD9          10      JP  Z,CTRL1E
000B64 D8DD FE42             7      CP  'B'
000B66 D8DF CAE1DA          10      JP  Z,CTRL1F
000B69 D8E2 FE43             7      CP  'C'
000B6B D8E4 CAA2D9          10      JP  Z,CTRL1C
000B6E D8E7 FE44             7      CP  'D'
000B70 D8E9 CAC6D9          10      JP  Z,CTRL1D
000B73 D8EC FE45             7      CP  'E'
000B75 D8EE 2802            12      JR  Z,CT0CX
000B77 D8F0 FE6A             7      CP  'j'
       D8F2                     CT0CX:
000B79 D8F2 CAC6DA          10      JP  Z,CTRL0C
000B7C D8F5 FE48             7      CP  'H'
000B7E D8F7 CA43DA          10      JP  Z,CTRL0B
000B81 D8FA FE4A             7      CP  'J'
000B83 D8FC CAC9DA          10      JP  Z,CTRL06
000B86 D8FF FE4B             7      CP  'K'
000B88 D901 CA15DA          10      JP  Z,CTRL05
000B8B D904 FE4C             7      CP  'L'
000B8D D906 CAF3DA          10      JP  Z,CTRL0E
000B90 D909 FE54             7      CP  'T'
000B92 D90B CA15DA          10      JP  Z,CTRL05
000B95 D90E FE78             7      CP  'x'
000B97 D910 2804            12      JR  Z,ESC1X
000B99 D912 FE79             7      CP  'y'
000B9B D914 2002            12      JR  NZ,ESC1Y
       D916                     ESC1X:
000B9D D916 3601            10      LD  (HL),1
       D918                     ESC1Y:
000B9F D918 FE3D             7      CP  '='
000BA1 D91A 2804            12      JR  Z,ESC1W
000BA3 D91C FE59             7      CP  'Y'
000BA5 D91E 2002            12      JR  NZ,ESC1Z
       D920                     ESC1W:
000BA7 D920 3602            10      LD  (HL),2
       D922                     ESC1Z:
000BA9 D922 FE20             7      CP  020H
000BAB D924 3802            12      JR  C,ESC1C
000BAD D926 87               4      ADD A,A
000BAE D927 D0              11      RET NC
       D928                     ESC1C:
000BAF D928 E1              10      POP HL
000BB0 D929 1832            12      JR  ANK
                                
       D92B                     ESC:
000BB2 D92B 218ED9          10      LD  HL,PRINTE5
000BB5 D92E E5              11      PUSH    HL
000BB6 D92F 2151D9          10      LD  HL,ESCFLG
000BB9 D932 3600            10      LD  (HL),0
000BBB D934 3D               4      DEC A
000BBC D935 28A0            12      JR  Z,ESC1
000BBE D937 3D               4      DEC A
000BBF D938 2009            12      JR  NZ,ESC2
000BC1 D93A 3603            10      LD  (HL),3
000BC3 D93C 7B               4      LD  A,E
000BC4 D93D D620             7      SUB 020H
000BC6 D93F 3246D9          13      LD  (ESCYP+1),A
000BC9 D942 C9              10      RET
       D943                     ESC2:
000BCA D943 3D               4      DEC A
000BCB D944 C0              11      RET NZ
000BCC D945 2600             7  ESCYP:  LD  H,0
000BCE D947 7B               4      LD  A,E
000BCF D948 D620             7      SUB 020H
000BD1 D94A 6F               4      LD  L,A
000BD2 D94B C3D6F0          10      JP  _LOC
                                
       D94E                     PRINT:
000BD5 D94E C5              11      PUSH    BC
000BD6 D94F E5              11      PUSH    HL
       D951                     ESCFLG  EQU $+1
000BD7 D950 3E00             7      LD  A,000H      ;自己書き換え
000BD9 D952 B7               4      OR  A
000BDA D953 20D6            12      JR  NZ,ESC
                                
000BDC D955 3E1F             7      LD  A,01FH
000BDE D957 BB               4      CP  E
000BDF D958 3038            12      JR  NC,CTRL
       D95A                     INSFLG  EQU $
000BE1 D95A 019BDA          10      LD  BC,INSERT   ;自己書き換え
       D95D                     ANK:
000BE4 D95D 3A96F0          13      LD  A,(_COLORF)
000BE7 D960 4F               4      LD  C,A
000BE8 D961 7B               4      LD  A,E
000BE9 D962 FE61             7      CP  'a'     ;英小文字
000BEB D964 3806            12      JR  C,PRT1
000BED D966 FE7B             7      CP  'z'+1
000BEF D968 3002            12      JR  NC,PRT1
000BF1 D96A CBF9             8      SET 7,C
       D96C                     PRT1:
000BF3 D96C FE86             7      CP  $86     ;ひらがな1(を－そ)
000BF5 D96E 3806            12      JR  C,PRT2
000BF7 D970 FEA0             7      CP  $A0
000BF9 D972 3002            12      JR  NC,PRT2
000BFB D974 CBF9             8      SET 7,C
       D976                     PRT2:
000BFD D976 FEE0             7      CP  $E0     ;ひらがな2(たーん)
000BFF D978 3802            12      JR  C,PRT3
000C01 D97A CBF9             8      SET 7,C
       D97C                     PRT3:
000C03 D97C 2A8EF0          16      LD  HL,(_TXADR)
000C06 D97F 7C               4      LD  A,H
000C07 D980 C6D0             7      ADD A,0D0H
000C09 D982 67               4      LD  H,A
000C0A D983 42               4      LD  B,D
000C0B D984 16EE             7      LD  D,CD_TABLE/256
000C0D D986 1A               7      LD  A,(DE)
000C0E D987 50               4      LD  D,B
000C0F D988 CD57CF          17      CALL    IO_PRINT
000C12 D98B CDA2D9          17      CALL    CTRL1C
       D98E                     PRINTE5:
000C15 D98E E1              10      POP HL
000C16 D98F C1              10      POP BC
000C17 D990 AF               4      XOR A
000C18 D991 C9              10      RET
                                
       D992                     CTRL:
000C19 D992 7B               4      LD  A,E
000C1A D993 87               4      ADD A,A
000C1B D994 F680             7      OR  080H
000C1D D996 6F               4      LD  L,A
000C1E D997 26F1             7      LD  H,CTRLTB/256
000C20 D999 7E               7      LD  A,(HL)
000C21 D99A 2C               4      INC L
000C22 D99B 66               7      LD  H,(HL)
000C23 D99C 6F               4      LD  L,A
000C24 D99D CD0F00          17      CALL    JP_HL
000C27 D9A0 18EC            12      JR  PRINTE5
                                
       D9A2                     CTRL1C:
000C29 D9A2 ED4B8EF0        20      LD  BC,(_TXADR)
000C2D D9A6 03               6      INC BC
       D9A7                     PRINTE3:
000C2E D9A7 2118FC          10      LD  HL,0-WIDTH*LINE
000C31 D9AA A7               4      AND A
000C32 D9AB ED4A            15      ADC HL,BC
       D9AD                     PRINTE8:
000C34 D9AD 2805            12      JR  Z,PRINT2
000C36 D9AF ED438EF0        20      LD  (_TXADR),BC
       D9B3                     CTRL00:
000C3A D9B3 C9              10      RET
                                
       D9B4                     PRINT2:
000C3B D9B4 CDF9DA          17      CALL    SCR
000C3E D9B7 21D8FF          10      LD  HL,0-WIDTH
000C41 D9BA 09              11      ADD HL,BC
       D9BB                     SET_TXADR_HL:
000C42 D9BB 228EF0          16      LD  (_TXADR),HL
000C45 D9BE C9              10      RET
                                
       D9BF                     CTRL08:
000C46 D9BF 3A5AD9          13      LD  A,(INSFLG)
000C49 D9C2 FECD             7      CP  0CDH        ;CALL ????
000C4B D9C4 2823            12      JR  Z,CTRL02
       D9C6                     CTRL1D:
000C4D D9C6 2A8EF0          16      LD  HL,(_TXADR)
000C50 D9C9 7C               4      LD  A,H
000C51 D9CA B5               4      OR  L
000C52 D9CB C8              11      RET Z
000C53 D9CC 2B               6      DEC HL
000C54 D9CD 18EC            12      JR  SET_TXADR_HL
                                
       D9CF                     CTRL1E:
000C56 D9CF ED4B8EF0        20      LD  BC,(_TXADR)
000C5A D9D3 21D8FF          10      LD  HL,0-WIDTH
000C5D D9D6 09              11      ADD HL,BC
000C5E D9D7 D0              11      RET NC
000C5F D9D8 18E1            12      JR  SET_TXADR_HL
                                
       D9DA                     CTRL09:
000C61 D9DA ED4B8EF0        20      LD  BC,(_TXADR)
000C65 D9DE 79               4      LD  A,C
000C66 D9DF E6F8             7      AND 0F8H
000C68 D9E1 C608             7      ADD A,8
000C6A D9E3 4F               4      LD  C,A
000C6B D9E4 88               4      ADC A,B
000C6C D9E5 91               4      SUB C
000C6D D9E6 47               4      LD  B,A
000C6E D9E7 18BE            12      JR  PRINTE3
                                
       D9E9                     CTRL02:
000C70 D9E9 CDC6D9          17      CALL    CTRL1D
000C73 D9EC C8              11      RET Z
000C74 D9ED D5              11      PUSH    DE
000C75 D9EE CDD3F0          17      CALL    _POS
000C78 D9F1 54               4      LD  D,H
000C79 D9F2 3E28             7      LD  A,WIDTH
000C7B D9F4 95               4      SUB L
000C7C D9F5 4F               4      LD  C,A
000C7D D9F6 0D               4      DEC C
000C7E D9F7 06D0             7      LD  B,0D0H
000C80 D9F9 2A8EF0          16      LD  HL,(_TXADR)
000C83 D9FC 09              11      ADD HL,BC
000C84 D9FD 47               4      LD  B,A
                                
000C85 D9FE 3AB7DA          13      LD  A,(MULINE)
000C88 DA01 BA               4      CP  D
000C89 DA02 2007            12      JR  NZ,C02X1
000C8B DA04 112800          10      LD  DE,WIDTH
000C8E DA07 19              11      ADD HL,DE
000C8F DA08 78               4      LD  A,B
000C90 DA09 83               4      ADD A,E
000C91 DA0A 47               4      LD  B,A
       DA0B                     C02X1:
000C92 DA0B 3A96F0          13      LD  A,(_COLORF) ;C:Color
000C95 DA0E 4F               4      LD  C,A
000C96 DA0F AF               4      XOR A       ;A:Text
000C97 DA10 CD9ECF          17      CALL    IO_BS
000C9A DA13 D1              10      POP DE
000C9B DA14 C9              10      RET
                                
       DA15                     CTRL05:
000C9C DA15 CDD3F0          17      CALL    _POS
000C9F DA18 3E28             7      LD  A,WIDTH
000CA1 DA1A 95               4      SUB L
000CA2 DA1B 47               4      LD  B,A
       DA1C                     C08X1:
000CA3 DA1C 2A8EF0          16      LD  HL,(_TXADR)
000CA6 DA1F 7C               4      LD  A,H
000CA7 DA20 C6D0             7      ADD A,0D0H
000CA9 DA22 67               4      LD  H,A
       DA23                     CLLINE:
000CAA DA23 3A96F0          13      LD  A,(_COLORF)
000CAD DA26 4F               4      LD  C,A
000CAE DA27 AF               4      XOR A
000CAF DA28 C381CF          10      JP  IO_CLLINE
                                
       DA2B                     CTRL0D:
000CB2 DA2B CDD3F0          17      CALL    _POS
000CB5 DA2E 2E00             7      LD  L,0
       DA30                     LOC:
000CB7 DA30 C5              11      PUSH    BC
000CB8 DA31 E5              11      PUSH    HL
000CB9 DA32 CD50DA          17      CALL    LOC1
000CBC DA35 228EF0          16      LD  (_TXADR),HL
000CBF DA38 E1              10      POP HL
000CC0 DA39 C1              10      POP BC
000CC1 DA3A C9              10      RET
                                
       DA3B                     CTRL12:
000CC2 DA3B 215AD9          10      LD  HL,INSFLG
000CC5 DA3E 7E               7      LD  A,(HL)
000CC6 DA3F EECC             7      XOR 0CCH        ;CD:CALL ???? 1:LD BC,????
000CC8 DA41 77               7      LD  (HL),A
000CC9 DA42 C9              10      RET
                                
       DA43                     CTRL0B:
000CCA DA43 210000          10      LD  HL,0
000CCD DA46 228EF0          16      LD  (_TXADR),HL
000CD0 DA49 C9              10      RET
                                
       DA4A                     CTRL1B:
000CD1 DA4A 3E01             7      LD  A,1
000CD3 DA4C 3251D9          13      LD  (ESCFLG),A
000CD6 DA4F C9              10      RET
                                
       DA50                     LOC1:
000CD7 DA50 D5              11      PUSH    DE
000CD8 DA51 4D               4      LD  C,L
000CD9 DA52 0608             7      LD  B,8
000CDB DA54 5C               4      LD  E,H
000CDC DA55 210028          10      LD  HL,WIDTH*256
000CDF DA58 55               4      LD  D,L ;L=0
       DA59                     LOC2:
000CE0 DA59 29              11      ADD HL,HL
000CE1 DA5A 3001            12      JR  NC,LOC3
000CE3 DA5C 19              11      ADD HL,DE
       DA5D                     LOC3:
000CE4 DA5D 10FA            13      DJNZ    LOC2
000CE6 DA5F 09              11      ADD HL,BC
000CE7 DA60 D1              10      POP DE
000CE8 DA61 C9              10      RET
                                
       DA62                     CONOUT1:
                                ;   CALL    CURSOR
000CE9 DA62 59               4      LD  E,C
000CEA DA63 CDCDF0          17      CALL    _PRINT
000CED DA66 7B               4      LD  A,E
000CEE DA67 FE0A             7      CP  00AH
000CF0 DA69 2006            12      JR  NZ,CURSOR
000CF2 DA6B CD2BDA          17      CALL    CTRL0D
000CF5 DA6E CD15DA          17      CALL    CTRL05
       DA71                     CURSOR:
000CF8 DA71 C9              10      RET
                                
       DA72                     CTRL07:
000CF9 DA72 06E0             7      LD  B,0E0H
000CFB DA74 2162F0          10      LD  HL,BEEPD+1
       DA77                     C07X0:
000CFE DA77 4E               7      LD  C,(HL)
000CFF DA78 23               6      INC HL
000D00 DA79 7E               7      LD  A,(HL)
000D01 DA7A 23               6      INC HL
000D02 DA7B CD4FCF          17      CALL    WRMMIO_BC
000D05 DA7E 7D               4      LD  A,L
000D06 DA7F FE6A             7      CP  (BEEPD+1+M7BEEPE-M7BEEPD)&255
000D08 DA81 20F4            12      JR  NZ,C07X0
000D0A DA83 0610             7      LD  B,16
       DA85                     C07X1:
000D0C DA85 CD2DCF          17      CALL    RD556VSYNC
000D0F DA88 87               4      ADD A,A
000D10 DA89 30FA            12      JR  NC,C07X1
       DA8B                     C07X2:
000D12 DA8B CD2DCF          17      CALL    RD556VSYNC
000D15 DA8E 87               4      ADD A,A
000D16 DA8F 38FA            12      JR  C,C07X2
000D18 DA91 10F2            13      DJNZ    C07X1
                                
000D1A DA93 AF               4      XOR A
000D1B DA94 2108E0          10      LD  HL,0E008H
000D1E DA97 CD3FCF          17      CALL    WRMMIO
000D21 DA9A C9              10      RET
                                
       DA9B                     INSERT:
000D22 DA9B D5              11      PUSH    DE
000D23 DA9C CDD3F0          17      CALL    _POS
000D26 DA9F 54               4      LD  D,H
000D27 DAA0 3E28             7      LD  A,WIDTH
000D29 DAA2 95               4      SUB L
000D2A DAA3 47               4      LD  B,A
000D2B DAA4 2A8EF0          16      LD  HL,(_TXADR)
000D2E DAA7 7C               4      LD  A,H
000D2F DAA8 C6D0             7      ADD A,0D0H
000D31 DAAA 67               4      LD  H,A
000D32 DAAB 3A96F0          13      LD  A,(_COLORF) ;C:Color
000D35 DAAE 4F               4      LD  C,A
000D36 DAAF AF               4      XOR A       ;A:Text
000D37 DAB0 CD91CF          17      CALL    IO_INS
000D3A DAB3 B7               4      OR  A
000D3B DAB4 2005            12      JR  NZ,INS1
       DAB7                     MULINE  EQU $+1
000D3D DAB6 3EFF             7      LD  A,-1
000D3F DAB8 92               4      SUB D
000D40 DAB9 2009            12      JR  NZ,INS2
       DABB                     INS1:
000D42 DABB 0628             7      LD  B,WIDTH
000D44 DABD CD91CF          17      CALL    IO_INS
000D47 DAC0 7A               4      LD  A,D
000D48 DAC1 32B7DA          13      LD  (MULINE),A
       DAC4                     INS2:
000D4B DAC4 D1              10      POP DE
000D4C DAC5 C9              10      RET
                                
       DAC6                     CTRL0C:
000D4D DAC6 CD43DA          17      CALL    CTRL0B
       DAC9                     CTRL06:
000D50 DAC9 D5              11      PUSH    DE
000D51 DACA E5              11      PUSH    HL
000D52 DACB ED5B8EF0        20      LD  DE,(_TXADR)
000D56 DACF 3A96F0          13      LD  A,(_COLORF)
000D59 DAD2 326ECF          13      LD  (ICSMC),A
000D5C DAD5 C362CF          10      JP  IO_CLR
                                
       DAD8                     CTRL04:
000D5F DAD8 CDD3F0          17      CALL    _POS
000D62 DADB 7D               4      LD  A,L
000D63 DADC B7               4      OR  A
000D64 DADD C8              11      RET Z
       DADE                     CTRL03:
000D65 DADE CD2BDA          17      CALL    CTRL0D
       DAE1                     CTRL0A:
       DAE1                     CTRL1F:
000D68 DAE1 2A8EF0          16      LD  HL,(_TXADR)
000D6B DAE4 012800          10      LD  BC,WIDTH
000D6E DAE7 09              11      ADD HL,BC
000D6F DAE8 44               4      LD  B,H
000D70 DAE9 4D               4      LD  C,L
000D71 DAEA 2118FC          10      LD  HL,0-WIDTH*LINE
000D74 DAED 09              11      ADD HL,BC
000D75 DAEE 3F               4      CCF
000D76 DAEF 9F               4      SBC A,A
000D77 DAF0 C3ADD9          10      JP  PRINTE8
                                
       DAF3                     CTRL0E:
000D7A DAF3 CDD3F0          17      CALL    _POS
000D7D DAF6 7C               4      LD  A,H
000D7E DAF7 1804            12      JR  SCR1
       DAF9                     SCR:
000D80 DAF9 3A97F0          13      LD  A,(_LINE)
000D83 DAFC 3D               4      DEC A
       DAFD                     SCR1:
000D84 DAFD C5              11      PUSH    BC
000D85 DAFE D5              11      PUSH    DE
000D86 DAFF E5              11      PUSH    HL
000D87 DB00 1100D0          10      LD  DE,0D000H
000D8A DB03 2128D0          10      LD  HL,0D000H+WIDTH
                                
000D8D DB06 47               4      LD  B,A
000D8E DB07 B7               4      OR  A
000D8F DB08 C3B6CF          10      JP  IO_SCRUP
                                
       DB0B                     POS:
000D92 DB0B 2A8EF0          16      LD  HL,(_TXADR)
000D95 DB0E C5              11      PUSH    BC
000D96 DB0F 01D8FF          10      LD  BC,0-WIDTH
000D99 DB12 AF               4      XOR A
       DB13                     POS1:
000D9A DB13 09              11      ADD HL,BC
000D9B DB14 3C               4      INC A
000D9C DB15 38FC            12      JR  C,POS1
000D9E DB17 ED42            15      SBC HL,BC
000DA0 DB19 3D               4      DEC A
000DA1 DB1A 67               4      LD  H,A
000DA2 DB1B C1              10      POP BC
000DA3 DB1C A7               4      AND A
000DA4 DB1D C9              10      RET
                                
       DB1E                     GETL:
000DA5 DB1E CDD3F0          17      CALL    _POS
000DA8 DB21 E5              11      PUSH    HL
000DA9 DB22 3ECD             7      LD  A,0CDH      ;CALL ????
000DAB DB24 325AD9          13      LD  (INSFLG),A
       DB27                     GETL1:
000DAE DB27 CD3FD8          17      CALL    _SYS08
000DB1 DB2A FE09             7      CP  9
000DB3 DB2C 2008            12      JR  NZ,GETL1V
000DB5 DB2E 2120FF          10      LD  HL,KBUF
000DB8 DB31 CD51D5          17      CALL    MSX
000DBB DB34 18F1            12      JR  GETL1
       DB36                     GETL1V:
000DBD DB36 5F               4      LD  E,A
000DBE DB37 CDD3F0          17      CALL    _POS
000DC1 DB3A CDCDF0          17      CALL    _PRINT
000DC4 DB3D 7B               4      LD  A,E
000DC5 DB3E FE20             7      CP  $20
000DC7 DB40 3809            12      JR  C,GETL1V1
000DC9 DB42 7D               4      LD  A,L
000DCA DB43 FE27             7      CP  WIDTH-1
000DCC DB45 2004            12      JR  NZ,GETL1V1
000DCE DB47 7C               4      LD  A,H
000DCF DB48 32B7DA          13      LD  (MULINE),A
       DB4B                     GETL1V1:
000DD2 DB4B 7B               4      LD  A,E
000DD3 DB4C FE0D             7      CP  00DH
000DD5 DB4E 20D7            12      JR  NZ,GETL1
000DD7 DB50 3E01             7      LD  A,1     ;LD BC,????
000DD9 DB52 325AD9          13      LD  (INSFLG),A
000DDC DB55 1120FF          10      LD  DE,KBUF
000DDF DB58 0628             7      LD  B,WIDTH
000DE1 DB5A CDA4D3          17      CALL    ZERO_MEMORY_DE
                                
000DE4 DB5D D1              10      POP DE
000DE5 DB5E CDD3F0          17      CALL    _POS
000DE8 DB61 6B               4      LD  L,E
000DE9 DB62 3E28             7      LD  A,WIDTH
000DEB DB64 95               4      SUB L
000DEC DB65 57               4      LD  D,A
                                
000DED DB66 3AB7DA          13      LD  A,(MULINE)
000DF0 DB69 94               4      SUB H
000DF1 DB6A 2806            12      JR  Z,GL2X
000DF3 DB6C 3C               4      INC A
000DF4 DB6D 200C            12      JR  NZ,GL3X
000DF6 DB6F 25               4      DEC H
000DF7 DB70 1805            12      JR  GL4X
       DB72                     GL2X:
000DF9 DB72 3E1F             7      LD  A,$1F
000DFB DB74 CD29D8          17      CALL    MSG_A
       DB77                     GL4X:
000DFE DB77 7A               4      LD  A,D
000DFF DB78 C628             7      ADD A,WIDTH
000E01 DB7A 57               4      LD  D,A
       DB7B                     GL3X:
000E02 DB7B CD50DA          17      CALL    LOC1
000E05 DB7E 4D               4      LD  C,L
000E06 DB7F 7C               4      LD  A,H
000E07 DB80 C6D0             7      ADD A,0D0H
000E09 DB82 47               4      LD  B,A
000E0A DB83 5A               4      LD  E,D
000E0B DB84 2120FF          10      LD  HL,KBUF
       DB87                     GETL2:
000E0E DB87 CDD0F0          17      CALL    _SCRN
000E11 DB8A 03               6      INC BC
000E12 DB8B 77               7      LD  (HL),A
000E13 DB8C 23               6      INC HL
000E14 DB8D 1D               4      DEC E
000E15 DB8E 20F7            12      JR  NZ,GETL2
       DB90                     GETL3:
000E17 DB90 2B               6      DEC HL
000E18 DB91 7E               7      LD  A,(HL)
000E19 DB92 FE21             7      CP  021H
000E1B DB94 D0              11      RET NC
000E1C DB95 3600            10      LD  (HL),0
000E1E DB97 15               4      DEC D
000E1F DB98 20F6            12      JR  NZ,GETL3
000E21 DB9A C9              10      RET
                                
       DB9B                     INKEY:
000E22 DB9B FB               4      EI
000E23 DB9C E5              11      PUSH    HL
000E24 DB9D 2A90F0          16      LD  HL,(_KEYPS)
000E27 DBA0 7C               4      LD  A,H
000E28 DBA1 AD               4      XOR L
000E29 DBA2 2809            12      JR  Z,INKEY1
000E2B DBA4 7C               4      LD  A,H
000E2C DBA5 3C               4      INC A
000E2D DBA6 3291F0          13      LD  (_KEYPS+1),A
000E30 DBA9 6F               4      LD  L,A
000E31 DBAA 26FF             7      LD  H,KEYBF/256
000E33 DBAC 7E               7      LD  A,(HL)
       DBAD                     INKEY1:
000E34 DBAD E1              10      POP HL
000E35 DBAE B7               4      OR  A
000E36 DBAF C9              10      RET
                                
       DBB0                     INKEYB:
000E37 DBB0 C1              10      POP BC
000E38 DBB1 CB47             8      BIT 0,A
000E3A DBB3 3E08             7      LD  A,8
000E3C DBB5 2002            12      JR  NZ,INKEYD
000E3E DBB7 3E03             7      LD  A,3
       DBB9                     INKEYD:
000E40 DBB9 B7               4      OR  A
000E41 DBBA 3292F0          13      LD  (_KEYD),A
000E44 DBBD C9              10      RET
       DBBE                     CHKEY:
000E45 DBBE C5              11      PUSH    BC
000E46 DBBF 3E08             7      LD  A,8
000E48 DBC1 CD20CF          17      CALL    RDKEYDATA
000E4B DBC4 3293F0          13      LD  (_KEYD+1),A
000E4E DBC7 CB7F             8      BIT 7,A
000E50 DBC9 28E5            12      JR  Z,INKEYB
000E52 DBCB E5              11      PUSH    HL
000E53 DBCC 0E07             7      LD  C,7
000E55 DBCE 2140ED          10      LD  HL,KEY_TABLE
000E58 DBD1 CB47             8      BIT 0,A
000E5A DBD3 2003            12      JR  NZ,CHKEY0
000E5C DBD5 2180ED          10      LD  HL,SHIFT_TABLE
       DBD8                     CHKEY0:
000E5F DBD8 CB77             8      BIT 6,A
000E61 DBDA 2003            12      JR  NZ,CHKEY1
000E63 DBDC 21C0ED          10      LD  HL,CTRL_TABLE
       DBDF                     CHKEY1:
000E66 DBDF 79               4      LD  A,C
000E67 DBE0 CD20CF          17      CALL    RDKEYDATA
000E6A DBE3 0608             7      LD  B,8
       DBE5                     CHKEY2:
000E6C DBE5 87               4      ADD A,A
000E6D DBE6 3009            12      JR  NC,CHKEY3
000E6F DBE8 23               6      INC HL
000E70 DBE9 10FA            13      DJNZ    CHKEY2
000E72 DBEB 0D               4      DEC C
000E73 DBEC 79               4      LD  A,C
000E74 DBED 3C               4      INC A
000E75 DBEE 20EF            12      JR  NZ,CHKEY1
000E77 DBF0 06                      DB  $06     ;LD B,?? 次の1バイトを飛ばす
       DBF1                     CHKEY3:
000E78 DBF1 7E               7      LD  A,(HL)
000E79 DBF2 E1              10      POP HL
000E7A DBF3 C1              10      POP BC
000E7B DBF4 18C3            12      JR  INKEYD
                                
       DBF6                     SCRN:
000E7D DBF6 E5              11      PUSH    HL
000E7E DBF7 CD47CF          17      CALL    RDMMIO_BC
000E81 DBFA 6F               4      LD  L,A
000E82 DBFB 26EF             7      LD  H,DC_TABLE/256
000E84 DBFD 7E               7      LD  A,(HL)
000E85 DBFE FE41             7      CP  'A'     ;英小文字チェック
000E87 DC00 380E            12      JR  C,SCRN1
000E89 DC02 FE5B             7      CP  'Z'+1
000E8B DC04 DC12DC          17      CALL    C,SCRNC
000E8E DC07 FEA6             7      CP  $A6     ;ひらがなチェック
000E90 DC09 3805            12      JR  C,SCRN1
000E92 DC0B FEE0             7      CP  $E0
000E94 DC0D DC12DC          17      CALL    C,SCRNC
       DC10                     SCRN1:
000E97 DC10 E1              10      POP HL
000E98 DC11 C9              10      RET
                                
       DC12                     SCRNC:
000E99 DC12 6F               4      LD  L,A
000E9A DC13 60               4      LD  H,B
000E9B DC14 CBD8             8      SET 3,B
000E9D DC16 CD47CF          17      CALL    RDMMIO_BC
000EA0 DC19 44               4      LD  B,H
000EA1 DC1A CB7F             8      BIT 7,A
000EA3 DC1C 7D               4      LD  A,L
000EA4 DC1D C8              11      RET Z
000EA5 DC1E FE5B             7      CP  'Z'+1
000EA7 DC20 3804            12      JR  C,SCRNC_ADD
000EA9 DC22 FEC0             7      CP  $C0
000EAB DC24 3803            12      JR  C,SCRNC_SUB
       DC26                     SCRNC_ADD:
000EAD DC26 C620             7      ADD A,$20
000EAF DC28 C9              10      RET
       DC29                     SCRNC_SUB:
000EB0 DC29 D620             7      SUB $20
000EB2 DC2B C9              10      RET
[EOF:M7IO.ASM:SHIFT_JIS]
                                    INCLUDE "LDFILE.ASM"
                                
                                ;   LSX-Dodgers FILE
                                
       DC2C                     FILEC:
000EB3 DC2C CD37DC          17      CALL    FILE
       DC2F                     FILEC2:
000EB6 DC2F 3A15F0          13      LD  A,(FDRV+1)
000EB9 DC32 FE20             7      CP  020H
000EBB DC34 C8              11      RET Z
000EBC DC35 1839            12      JR  SETDIR1
                                
       DC37                     FILE:
000EBE DC37 AF               4      XOR A
000EBF DC38 3214F0          13      LD  (FDRV),A
000EC2 DC3B 67               4      LD  H,A
000EC3 DC3C 6F               4      LD  L,A
000EC4 DC3D 2222F0          16      LD  (FDRV+14),HL
000EC7 DC40 CD0EDD          17      CALL    SPCUT
000ECA DC43 CDF3DC          17      CALL    CCHK3
000ECD DC46 2812            12      JR  Z,DEVI1
000ECF DC48 13               6      INC DE
000ED0 DC49 1A               7      LD  A,(DE)
000ED1 DC4A 1B               6      DEC DE
000ED2 DC4B FE3A             7      CP  ':'
000ED4 DC4D 200B            12      JR  NZ,DEVI1
000ED6 DC4F 1A               7      LD  A,(DE)      ;DRIVE
000ED7 DC50 CD43DF          17      CALL    CAP
000EDA DC53 D640             7      SUB '@'
000EDC DC55 13               6      INC DE
000EDD DC56 13               6      INC DE
000EDE DC57 3214F0          13      LD  (FDRV),A
       DC5A                     DEVI1:
000EE1 DC5A 1A               7      LD  A,(DE)
000EE2 DC5B D65C             7      SUB 05CH        ;\
000EE4 DC5D 2009            12      JR  NZ,NOROOT
000EE6 DC5F 6F               4      LD  L,A     ;A=0でH=0のはずなのでHL=0
000EE7 DC60 222EF0          16      LD  (FDRV+26),HL
000EEA DC63 2C               4      INC L
000EEB DC64 2222F0          16      LD  (FDRV+14),HL
000EEE DC67 13               6      INC DE
       DC68                     NOROOT:
                                
       DC68                     SETDIR:
000EEF DC68 CD94DC          17      CALL    FILED
000EF2 DC6B 1A               7      LD  A,(DE)
000EF3 DC6C FE5C             7      CP  05CH        ;\
000EF5 DC6E C0              11      RET NZ
000EF6 DC6F 13               6      INC DE
       DC70                     SETDIR1:
000EF7 DC70 3E10             7      LD  A,010H      ;Directory
000EF9 DC72 3221F0          13      LD  (FDRV+13),A
000EFC DC75 D5              11      PUSH    DE
000EFD DC76 1114F0          10      LD  DE,FDRV
000F00 DC79 2A1EF1          16      LD  HL,(STABLE+2*00FH)
000F03 DC7C CD0F00          17      CALL    JP_HL
000F06 DC7F D1              10      POP DE
000F07 DC80 B7               4      OR  A
000F08 DC81 C0              11      RET NZ
                                
000F09 DC82 3A21F0          13      LD  A,(FDRV+13)
000F0C DC85 CB67             8      BIT 4,A
000F0E DC87 C8              11      RET Z
                                
000F0F DC88 CDDBDC          17      CALL    FILEI
000F12 DC8B 2A2EF0          16      LD  HL,(FDRV+26)
000F15 DC8E 23               6      INC HL
000F16 DC8F 2222F0          16      LD  (FDRV+14),HL
000F19 DC92 18D4            12      JR  SETDIR
                                
       DC94                     FILED:
000F1B DC94 CDDBDC          17      CALL    FILEI
000F1E DC97 2115F0          10      LD  HL,FNAME
                                
000F21 DC9A 0608             7      LD  B,8
       DC9C                     FILE2:
000F23 DC9C CDE8DC          17      CALL    CCHKF
000F26 DC9F C8              11      RET Z
000F27 DCA0 FE2A             7      CP  '*'
000F29 DCA2 282E            12      JR  Z,FILE9
000F2B DCA4 FE2E             7      CP  '.'
000F2D DCA6 280C            12      JR  Z,FILE4
000F2F DCA8 77               7      LD  (HL),A
000F30 DCA9 23               6      INC HL
000F31 DCAA 10F0            13      DJNZ    FILE2
                                
       DCAC                     FILE3:
000F33 DCAC CDE8DC          17      CALL    CCHKF
000F36 DCAF C8              11      RET Z
000F37 DCB0 FE2E             7      CP  '.'
000F39 DCB2 20F8            12      JR  NZ,FILE3
                                
       DCB4                     FILE4:
000F3B DCB4 211DF0          10      LD  HL,FNAME+8
000F3E DCB7 0603             7      LD  B,3
                                
       DCB9                     FILE4L:
000F40 DCB9 CDE8DC          17      CALL    CCHKF
000F43 DCBC C8              11      RET Z
000F44 DCBD FE2E             7      CP  '.'
000F46 DCBF 2008            12      JR  NZ,FILE12
000F48 DCC1 3215F0          13      LD  (FNAME),A   ;Parent directory(..)
000F4B DCC4 3216F0          13      LD  (FNAME+1),A
000F4E DCC7 3E20             7      LD  A,020H
       DCC9                     FILE12:
000F50 DCC9 FE2A             7      CP  '*'
000F52 DCCB 280A            12      JR  Z,FILE10
000F54 DCCD 77               7      LD  (HL),A
000F55 DCCE 23               6      INC HL
000F56 DCCF 10E8            13      DJNZ    FILE4L
000F58 DCD1 C9              10      RET
                                
       DCD2                     FILE9:              ;名前の*処理、名前の残りを?で埋める
000F59 DCD2 CDD7DC          17      CALL    FILE10
000F5C DCD5 18D5            12      JR  FILE3
                                
       DCD7                     FILE10:
000F5E DCD7 3E3F             7      LD  A,'?'
000F60 DCD9 1808            12      JR  FILL_MEMORY
       DCDB                     FILEI:              ;名前＋拡張子をスペースで初期化
000F62 DCDB 3E20             7      LD  A,020H
000F64 DCDD 01000B          10      LD  BC,11*256   ;C=0にしておく
000F67 DCE0 2115F0          10      LD  HL,FNAME
       DCE3                     FILL_MEMORY:            ;HLからBバイトAで埋める
000F6A DCE3 77               7      LD  (HL),A
000F6B DCE4 23               6      INC HL
000F6C DCE5 10FC            13      DJNZ    FILL_MEMORY
000F6E DCE7 C9              10      RET
                                
       DCE8                     CCHKF:
000F6F DCE8 1A               7      LD  A,(DE)
000F70 DCE9 CDF0DC          17      CALL    CCHK2
000F73 DCEC C8              11      RET Z
000F74 DCED C35BE0          10      JP  FKAN
                                
       DCF0                     CCHK2:
000F77 DCF0 0C               4      INC C
000F78 DCF1 0D               4      DEC C
000F79 DCF2 C0              11      RET NZ
       DCF3                     CCHK3:              ;ZF=1 で使えない文字
000F7A DCF3 FE2B             7      CP  '+'
000F7C DCF5 C8              11      RET Z
000F7D DCF6 FE2C             7      CP  ','
000F7F DCF8 C8              11      RET Z
000F80 DCF9 FE2F             7      CP  '/'
000F82 DCFB C8              11      RET Z
000F83 DCFC FE3A             7      CP  ':'
000F85 DCFE C8              11      RET Z
000F86 DCFF FE3B             7      CP  ';'
000F88 DD01 C8              11      RET Z
000F89 DD02 FE3D             7      CP  '='
000F8B DD04 C8              11      RET Z
000F8C DD05 FE5C             7      CP  05CH    ;\
000F8E DD07 C8              11      RET Z
000F8F DD08 FE20             7      CP  020H
000F91 DD0A D0              11      RET NC
000F92 DD0B BF               4      CP  A       ;Z=1
000F93 DD0C C9              10      RET
                                
       DD0D                     SS1:
000F94 DD0D 13               6      INC DE
       DD0E                     SPCUT:              ;スペースをカット
000F95 DD0E 1A               7      LD  A,(DE)
000F96 DD0F FE20             7      CP  020H
000F98 DD11 28FA            12      JR  Z,SS1
000F9A DD13 C9              10      RET
                                
       DD14                     SETDRVF:
000F9B DD14 1114F0          10      LD  DE,FDRV
       DD17                     SETDRV0:
000F9E DD17 CD20DD          17      CALL    SETDRV
000FA1 DD1A FDE1            14      POP IY
000FA3 DD1C C1              10      POP BC
000FA4 DD1D D1              10      POP DE
000FA5 DD1E E1              10      POP HL
000FA6 DD1F C9              10      RET
                                
       DD20                     SETDRV:
000FA7 DD20 E3              19      EX  (SP),HL     ;HL=RETRN ADDRESS
000FA8 DD21 D5              11      PUSH    DE      ;PUSH HL/DE/BC/IY
000FA9 DD22 C5              11      PUSH    BC
000FAA DD23 1A               7      LD  A,(DE)
000FAB DD24 D5              11      PUSH    DE
000FAC DD25 FDE3            23      EX  (SP),IY
                                
000FAE DD27 CD33DD          17      CALL    GETDRV
000FB1 DD2A 3C               4      INC A
000FB2 DD2B FD7700          19      LD  (IY+0),A    ;(FCB)ドライブ番号
000FB5 DD2E 3D               4      DEC A
000FB6 DD2F CDD9F0          17      CALL    _CHGDRV
                                
000FB9 DD32 E9               4      JP  (HL)
                                
       DD33                     GETDRV:
000FBA DD33 E67F             7      AND 07FH
000FBC DD35 D601             7      SUB 001H
000FBE DD37 3003            12      JR  NC,GETDRV1
000FC0 DD39 3A87F0          13      LD  A,(_DVSW)   ;Current Drive
       DD3C                     GETDRV1:
000FC3 DD3C 3288F0          13      LD  (_DRV),A
000FC6 DD3F C9              10      RET
                                
       DD40                     SOPENX:
000FC7 DD40 1139F0          10      LD  DE,SFILE
000FCA DD43 1A               7      LD  A,(DE)
000FCB DD44 FDBE00           7      CP  (IY+0)      ;(FCB)ドライブ番号
000FCE DD47 2024            12      JR  NZ,SOPEN
000FD0 DD49 13               6      INC DE
000FD1 DD4A FDE5            15      PUSH    IY
000FD3 DD4C E1              10      POP HL
000FD4 DD4D 23               6      INC HL
000FD5 DD4E CDDBDE          17      CALL    CPFILE
000FD8 DD51 201A            12      JR  NZ,SOPEN
                                
000FDA DD53 2AF4F1          16      LD  HL,(SCDIR)
000FDD DD56 FD750E          19      LD  (IY+14),L   ;(FCB)アクセスするディレクトリのクラスタ番号+1
000FE0 DD59 FD740F          19      LD  (IY+15),H
                                
000FE3 DD5C 2AF8F1          16      LD  HL,(SFNDF)  ;Direcroty location and Flags
000FE6 DD5F 229FF0          16      LD  (_FILEN),HL
                                
000FE9 DD62 ED5BF6F1        20      LD  DE,(SFBPS)
000FED DD66 2139F0          10      LD  HL,SFILE
000FF0 DD69 36FF            10      LD  (HL),0FFH
000FF2 DD6B 23               6      INC HL
000FF3 DD6C C9              10      RET
       DD6D                     SOPEN:
000FF4 DD6D 2183DE          10      LD  HL,FILESE
       DD70                     SOPENC:
000FF7 DD70 22A9DD          16      LD  (OPENPAT+1),HL
                                
000FFA DD73 CDE2F0          17      CALL    _RDFATX     ;Detect Media
000FFD DD76 3856            12      JR  C,RDDERR
                                
000FFF DD78 AF               4      XOR A
001000 DD79 329FF0          13      LD  (_FILEN),A
001003 DD7C CD88DF          17      CALL    LDDIRX1     ;A=0で呼び出す
001006 DD7F 2818            12      JR  Z,SDIRX1
                                
001008 DD81 CD74DE          17      CALL    READ_DIR    ;Sub Directory
00100B DD84 3808            12      JR  C,SDIRX0
00100D DD86 2A7EF1          16      LD  HL,(_DTBUF)
001010 DD89 7E               7      LD  A,(HL)
001011 DD8A FE2E             7      CP  '.'
001013 DD8C 280F            12      JR  Z,SOPEN1
       DD8E                     SDIRX0:
001015 DD8E AF               4      XOR A
001016 DD8F 32A0F0          13      LD  (_DIRF),A
001019 DD92 FD360E01        19      LD  (IY+14),1   ;(FCB)レコードサイズ
00101D DD96 FD770F          19      LD  (IY+15),A
       DD99                     SDIRX1:
001020 DD99 ED5BFCF1        20      LD  DE,(_DIRPS) ;Root Directory
       DD9D                     SOPEN1:
001024 DD9D 0E20             7  SDECPAT:LD  C,32        ;自己書き換え 1セクタ辺りのディレクトリエントリ数  1024=32 / 512=16 / 256=8
       DD9F                     SOPEN1X:
001026 DD9F CD74DE          17      CALL    READ_DIR    ;FILE SEARCH
001029 DDA2 382A            12      JR  C,RDDERR
00102B DDA4 2A7EF1          16      LD  HL,(_DTBUF)
       DDA7                     SOPEN2:
00102E DDA7 D5              11      PUSH    DE
00102F DDA8 CD83DE          17  OPENPAT:CALL    FILESE      ;(self-modifying code)
001032 DDAB D1              10      POP DE
001033 DDAC 386E            12      JR  C,SOPENE
001035 DDAE 281B            12      JR  Z,SCF_FF_RET
       DDB0                     SOPEN3:
001037 DDB0 3AA0F0          13      LD  A,(_DIRF)   ;ディレクトリか判別
00103A DDB3 B7               4      OR  A
00103B DDB4 200C            12      JR  NZ,SOPEN5
00103D DDB6 13               6      INC DE      ;ルートディレクトリ
00103E DDB7 E5              11      PUSH    HL
00103F DDB8 210C00          10  MD_PAT: LD  HL,12       ;(self-modifying code)MAXDIR
001042 DDBB ED52            15      SBC HL,DE       ;CF=0 なので SUB HL,DE
001044 DDBD E1              10      POP HL
001045 DDBE 20DD            12      JR  NZ,SOPEN1
001047 DDC0 1807            12      JR  SOPEN6
       DDC2                     SOPEN5:
001049 DDC2 CD9DE6          17      CALL    GNCLX       ;END DIR
00104C DDC5 D8              11      RET C
00104D DDC6 CD3BDF          17      CALL    ENDCL
       DDC9                     SOPEN6:
001050 DDC9 38D2            12      JR  C,SOPEN1
       DDCB                     SCF_FF_RET:
001052 DDCB 37               4      SCF         ;CF=1
001053 DDCC 9F               4      SBC A,A     ;A=0FFH
001054 DDCD C9              10      RET
                                
       DDCE                     RDDERR:
001055 DDCE BF               4      CP  A       ;READ ERR CF=1 ZF=1
001056 DDCF 37               4      SCF
001057 DDD0 C9              10      RET
                                
       DDD1                     NOPEN:
001058 DDD1 2183DE          10      LD  HL,FILESE
00105B DDD4 22A9DD          16      LD  (OPENPAT+1),HL
00105E DDD7 FD2A98F0        20      LD  IY,(_FCB)
001062 DDDB CD6EE0          17      CALL    CHKWILDX
001065 DDDE 30EB            12      JR  NC,SCF_FF_RET
001067 DDE0 FD7E00          19      LD  A,(IY+0)    ;(FCB)ドライブ番号
00106A DDE3 3D               4      DEC A
00106B DDE4 3288F0          13      LD  (_DRV),A
00106E DDE7 CDD9F0          17      CALL    _CHGDRV
001071 DDEA D8              11      RET C
001072 DDEB 2AF8F1          16      LD  HL,(SFNDF)  ;Direcroty location and Flags
001075 DDEE 229FF0          16      LD  (_FILEN),HL
                                
001078 DDF1 CD83DF          17      CALL    LDDIRX
00107B DDF4 ED5B9AF0        20      LD  DE,(_FBPS)
00107F DDF8 CD74DE          17      CALL    READ_DIR
001082 DDFB 38D1            12      JR  C,RDDERR
001084 DDFD 3A9EF0          13      LD  A,(_FBCNT)
001087 DE00 3D               4      DEC A
001088 DE01 28AD            12      JR  Z,SOPEN3
       DE03                     NOPEN2:
00108A DE03 2A9CF0          16      LD  HL,(_FBAD)
00108D DE06 012000          10      LD  BC,020H
001090 DE09 09              11      ADD HL,BC
001091 DE0A 4F               4      LD  C,A
001092 DE0B 189A            12      JR  SOPEN2
                                
       DE0D                     SOPENE2:
001094 DE0D 229CF0          16      LD  (_FBAD),HL
001097 DE10 79               4      LD  A,C
001098 DE11 329EF0          13      LD  (_FBCNT),A
00109B DE14 ED539AF0        20      LD  (_FBPS),DE
00109F DE18 FD2298F0        20      LD  (_FCB),IY
       DE1C                     SOPENE:
0010A3 DE1C AF               4      XOR A
0010A4 DE1D C9              10      RET
                                
       DE1E                     COPEN:
0010A5 DE1E FD360D20        19      LD  (IY+13),020H    ;(FCB)属性(アトリビュート)
                                
0010A9 DE22 21A0DE          10      LD  HL,NEXTSE
0010AC DE25 CD70DD          17      CALL    SOPENC
0010AF DE28 D0              11      RET NC
0010B0 DE29 C8              11      RET Z
0010B1 DE2A 3AA0F0          13      LD  A,(_DIRF)   ;ディレクトリか判別
0010B4 DE2D B7               4      OR  A
0010B5 DE2E 37               4      SCF
0010B6 DE2F C8              11      RET Z       ;ルートディレクトリ
0010B7 DE30 0601             7      LD  B,1
0010B9 DE32 CDCDE0          17      CALL    WRDF
0010BC DE35 D8              11      RET C
0010BD DE36 ED5BFEF1        20      LD  DE,(_CLPS)
0010C1 DE3A D5              11      PUSH    DE
0010C2 DE3B CD04DF          17      CALL    DCPAT
0010C5 DE3E CD28E5          17      CALL    DRDNX
0010C8 DE41 2A7EF1          16      LD  HL,(_DTBUF) ;ディレクトリエントリを0クリア
0010CB DE44 3A32E4          13      LD  A,(SECSZ+2) ;1024=4 / 512=2 / 256=1
0010CE DE47 47               4      LD  B,A
0010CF DE48 AF               4      XOR A
0010D0 DE49 4F               4      LD  C,A
       DE4A                     COPENCL:
0010D1 DE4A 77               7      LD  (HL),A
0010D2 DE4B EDA1            16      CPI         ;HL=HL+1 BC=BC-1 BCが0の場合にP/V=0
0010D4 DE4D EA4ADE          10      JP  PE,COPENCL
                                
0010D7 DE50 3A22DF          13      LD  A,(SPCPAT+1)    ;1クラスタの論理セクタ数
0010DA DE53 3D               4      DEC A
0010DB DE54 2819            12      JR  Z,COPENE
0010DD DE56 3E01             7      LD  A,1     ;1セクタ辺りのセクタ数が2以上の場合
0010DF DE58 3295E6          13      LD  (_SECPS+1),A
0010E2 DE5B D1              10      POP DE      ;DE=(_CLPS)
0010E3 DE5C D5              11      PUSH    DE
       DE5D                     COPEN1:
0010E4 DE5D D5              11      PUSH    DE      ;データバッファに入らないセクタもゼロクリア
0010E5 DE5E C5              11      PUSH    BC
0010E6 DE5F 2A7EF1          16      LD  HL,(_DTBUF)
0010E9 DE62 CD1EDF          17      CALL    CLUSTX
0010EC DE65 CD2DE8          17      CALL    DWT24
0010EF DE68 C1              10      POP BC
0010F0 DE69 D1              10      POP DE
0010F1 DE6A CD94E6          17      CALL    NEXTX
0010F4 DE6D 20EE            12      JR  NZ,COPEN1
       DE6F                     COPENE:
0010F6 DE6F 2A7EF1          16      LD  HL,(_DTBUF)
0010F9 DE72 D1              10      POP DE
0010FA DE73 C9              10      RET
                                
       DE74                     READ_DIR:
0010FB DE74 ED53FEF1        20      LD  (_CLPS),DE
0010FF DE78 C5              11      PUSH    BC
001100 DE79 D5              11      PUSH    DE
001101 DE7A CD04DF          17      CALL    DCPAT
001104 DE7D CD08E5          17      CALL    DRDX
001107 DE80 D1              10      POP DE
001108 DE81 C1              10      POP BC
001109 DE82 C9              10      RET
                                
       DE83                     FILESE:
00110A DE83 7E               7      LD  A,(HL)
00110B DE84 B7               4      OR  A
00110C DE85 C8              11      RET Z       ;END:ZF=1 CF=0
00110D DE86 FEE5             7      CP  0E5H
00110F DE88 280E            12      JR  Z,FILESE1
001111 DE8A FDE5            15      PUSH    IY
001113 DE8C D1              10      POP DE
001114 DE8D 13               6      INC DE
001115 DE8E E5              11      PUSH    HL
001116 DE8F CDDBDE          17      CALL    CPFILE
001119 DE92 CCFCDE          17      CALL    Z,CPFILE2
00111C DE95 E1              10      POP HL
00111D DE96 37               4      SCF
00111E DE97 C8              11      RET Z       ;!!!:(ZF=1) CF=1
       DE98                     FILESE1:
00111F DE98 CDAFDE          17      CALL    FNEXT
001122 DE9B 20E6            12      JR  NZ,FILESE
       DE9D                     ZF0_CF0_AFF_RET:
001124 DE9D F6FF             7      OR  0FFH        ;ZF=0 CF=0
001126 DE9F C9              10      RET
                                
       DEA0                     NEXTSE:
001127 DEA0 7E               7      LD  A,(HL)
001128 DEA1 B7               4      OR  A
001129 DEA2 37               4      SCF
00112A DEA3 C8              11      RET Z       ;!!!:ZF=1 CF=1
00112B DEA4 FEE5             7      CP  0E5H
00112D DEA6 37               4      SCF
00112E DEA7 C8              11      RET Z       ;!!!:(ZF=1) CF=1
00112F DEA8 CDAFDE          17      CALL    FNEXT
001132 DEAB 20F3            12      JR  NZ,NEXTSE
001134 DEAD 18EE            12      JR  ZF0_CF0_AFF_RET
                                
       DEAF                     FNEXT:
001136 DEAF E5              11      PUSH    HL
001137 DEB0 219FF0          10      LD  HL,_FILEN
00113A DEB3 34              11      INC (HL)
00113B DEB4 E1              10      POP HL
00113C DEB5 112000          10      LD  DE,020H
00113F DEB8 19              11      ADD HL,DE
001140 DEB9 0D               4      DEC C
001141 DEBA C9              10      RET
                                
       DEBB                     CPNAME:
001142 DEBB C5              11      PUSH    BC
001143 DEBC D5              11      PUSH    DE
001144 DEBD E5              11      PUSH    HL
001145 DEBE CDD5DE          17      CALL    CPFILE4
001148 DEC1 E1              10      POP HL
001149 DEC2 23               6      INC HL
00114A DEC3 23               6      INC HL
00114B DEC4 23               6      INC HL
00114C DEC5 23               6      INC HL
00114D DEC6 D1              10      POP DE
00114E DEC7 C1              10      POP BC
00114F DEC8 2005            12      JR  NZ,CPNAME1
001151 DECA 7E               7      LD  A,(HL)
001152 DECB 23               6      INC HL
001153 DECC 66               7      LD  H,(HL)
001154 DECD 6F               4      LD  L,A
001155 DECE C9              10      RET
       DECF                     CPNAME1:
001156 DECF 23               6      INC HL
001157 DED0 23               6      INC HL
001158 DED1 10E8            13      DJNZ    CPNAME
00115A DED3 37               4      SCF
00115B DED4 C9              10      RET
                                
       DED5                     CPFILE4:
00115C DED5 C5              11      PUSH    BC
00115D DED6 010004          10      LD  BC,00400H
001160 DED9 1804            12      JR  CPSTR1
       DEDB                     CPFILE:
001162 DEDB C5              11      PUSH    BC
001163 DEDC 01000B          10      LD  BC,00B00H
       DEDF                     CPSTR1:
001166 DEDF 1A               7      LD  A,(DE)
001167 DEE0 FE3F             7      CP  '?'     ;Wild card
001169 DEE2 2812            12      JR  Z,CPSTR2
00116B DEE4 7E               7      LD  A,(HL)
00116C DEE5 CD54E0          17      CALL    FKANC
00116F DEE8 E5              11      PUSH    HL
001170 DEE9 67               4      LD  H,A
001171 DEEA 1A               7      LD  A,(DE)
001172 DEEB CB01             4      RLC C
001174 DEED CD54E0          17      CALL    FKANC
001177 DEF0 CB09             4      RRC C
001179 DEF2 BC               4      CP  H       ;CP (HL),(DE)
00117A DEF3 E1              10      POP HL
00117B DEF4 2004            12      JR  NZ,CPSTR3
       DEF6                     CPSTR2:
00117D DEF6 13               6      INC DE
00117E DEF7 23               6      INC HL
00117F DEF8 10E5            13      DJNZ    CPSTR1
       DEFA                     CPSTR3:
001181 DEFA C1              10      POP BC
001182 DEFB C9              10      RET
                                
       DEFC                     CPFILE2:
001183 DEFC FD7E0D          19      LD  A,(IY+13)   ;(FCB)属性(アトリビュート)
001186 DEFF F6E1             7      OR  0E1H
001188 DF01 2F               4      CPL
001189 DF02 A6               7      AND (HL)
00118A DF03 C9              10      RET
                                
       DF04                     DCPAT:
00118B DF04 0E00             7      LD  C,0
00118D DF06 2A7EF1          16      LD  HL,(_DTBUF)
001190 DF09 3AA0F0          13      LD  A,(_DIRF)   ;ディレクトリか判別
001193 DF0C B7               4      OR  A
001194 DF0D C8              11      RET Z       ;ルートディレクトリの場合はCレジスタを0にしておく(CDEがセクタ番号)
001195 DF0E 3A22DF          13      LD  A,(SPCPAT+1)
001198 DF11 4F               4      LD  C,A
001199 DF12 3A95E6          13      LD  A,(_SECPS+1)
00119C DF15 B9               4      CP  C
00119D DF16 3801            12      JR  C,DC1
00119F DF18 AF               4      XOR A
       DF19                     DC1:
0011A0 DF19 F680             7      OR  080H
0011A2 DF1B 32A0F0          13      LD  (_DIRF),A   ;bit0-6:セクタインデックス
       DF1E                     CLUSTX:
0011A5 DF1E E5              11      PUSH    HL
0011A6 DF1F EB               4      EX  DE,HL
0011A7 DF20 AF               4      XOR A
0011A8 DF21 0E01             7  SPCPAT: LD  C,1     ;自己書き換え（1クラスタの論理セクタ数）
       DF23                     L_CLDBL:
0011AA DF23 CB19             8      RR  C       ;->CF
0011AC DF25 3804            12      JR  C,E_CLDBL
0011AE DF27 29              11      ADD HL,HL       ;*2
0011AF DF28 8F               4      ADC A,A
0011B0 DF29 18F8            12      JR  L_CLDBL
       DF2B                     E_CLDBL:
0011B2 DF2B 4F               4      LD  C,A
0011B3 DF2C 3A95E6          13      LD  A,(_SECPS+1)
0011B6 DF2F B5               4      OR  L
0011B7 DF30 6F               4      LD  L,A
0011B8 DF31 110800          10  CLSPAT: LD  DE,8    ;+8 (2D)  !ADDCL (self-modifying code)
0011BB DF34 AF               4      XOR A
0011BC DF35 19              11      ADD HL,DE   ;データ格納領域の先頭論理セクタ番号
0011BD DF36 89               4      ADC A,C
0011BE DF37 4F               4      LD  C,A
0011BF DF38 EB               4      EX  DE,HL
0011C0 DF39 E1              10      POP HL
0011C1 DF3A C9              10      RET
                                
       DF3B                     ENDCL:
0011C2 DF3B 7A               4      LD  A,D ;END CLUSTER
0011C3 DF3C FE01             7  CLPAT1: CP  1   ;164=356    (self-modifying code)
0011C5 DF3E C0              11      RET NZ
0011C6 DF3F 7B               4      LD  A,E
0011C7 DF40 FE64             7  CLPAT2: CP  064H    ;       (self-modifying code)
0011C9 DF42 C9              10      RET
                                
       DF43                     CAP:
0011CA DF43 FE61             7      CP  'a'
0011CC DF45 D8              11      RET C
0011CD DF46 FE7B             7      CP  'z'+1
0011CF DF48 D0              11      RET NC
0011D0 DF49 D620             7      SUB 020H
0011D2 DF4B C9              10      RET
       DF4C                     CAP2:
0011D3 DF4C CD43DF          17      CALL    CAP
       DF4F                     CAP3:
0011D6 DF4F CD58DF          17      CALL    CAP4
0011D9 DF52 FE21             7      CP  021H
0011DB DF54 D0              11      RET NC
0011DC DF55 3EA0             7      LD  A,0A0H
0011DE DF57 C9              10      RET
       DF58                     CAP4:
0011DF DF58 FE05             7      CP  5
0011E1 DF5A C0              11      RET NZ
0011E2 DF5B 3EE5             7      LD  A,0E5H
0011E4 DF5D C9              10      RET
                                
       DF5E                     CHDIR:
0011E5 DF5E CD5BE9          17      CALL    GETDPBD
0011E8 DF61 381D            12      JR  C,CHDIR2
0011EA DF63 DD751A          19      LD  (IX+01AH),L     ;_SDIR_
0011ED DF66 DD741B          19      LD  (IX+01BH),H     ;_SDIR_+1
0011F0 DF69 1815            12      JR  CHDIR2      ;POP_IX_RET
                                
       DF6B                     LDDIR:
0011F2 DF6B CD5BE9          17      CALL    GETDPBD
0011F5 DF6E DD5E1A          19      LD  E,(IX+01AH)     ;_SDIR_
0011F8 DF71 DD561B          19      LD  D,(IX+01BH)     ;_SDIR_+1
0011FB DF74 13               6      INC DE
0011FC DF75 FD730E          19      LD  (IY+14),E   ;(FCB)アクセスするディレクトリのクラスタ番号+1
0011FF DF78 FD720F          19      LD  (IY+15),D
001202 DF7B 1B               6      DEC DE
001203 DF7C AF               4      XOR A
001204 DF7D 32A0F0          13      LD  (_DIRF),A
       DF80                     CHDIR2:
001207 DF80 DDE1            14      POP IX
001209 DF82 C9              10      RET
                                
       DF83                     LDDIRX:
00120A DF83 3AA0F0          13      LD  A,(_DIRF)   ;(FCB)アクセスするディレクトリのセクタインデックス
00120D DF86 E67F             7      AND 07FH
       DF88                     LDDIRX1:
00120F DF88 3295E6          13      LD  (_SECPS+1),A
001212 DF8B FD5E0E          19      LD  E,(IY+14)   ;(FCB)アクセスするディレクトリのクラスタ番号+1
001215 DF8E FD560F          19      LD  D,(IY+15)
001218 DF91 1B               6      DEC DE
001219 DF92 CD3BDF          17      CALL    ENDCL
00121C DF95 D46BDF          17      CALL    NC,LDDIR
       DF98                     LDDIRS:
00121F DF98 7A               4      LD  A,D
001220 DF99 B3               4      OR  E
001221 DF9A 32A0F0          13      LD  (_DIRF),A   ;ディレクトリか判別
001224 DF9D C9              10      RET
                                
       DF9E                     KILL:
001225 DF9E CD6EE0          17      CALL    CHKWILDX
001228 DFA1 3834            12      JR  C,KILLW
00122A DFA3 CD40DD          17      CALL    SOPENX
       DFA6                     KILLS:
00122D DFA6 3E1F             7      LD  A,01FH
00122F DFA8 D4EADF          17      CALL    NC,CHKATT
001232 DFAB D8              11      RET C
       DFAC                     KILLSX:
001233 DFAC 36E5            10      LD  (HL),0E5H   ;DIR
001235 DFAE CD48E0          17      CALL    WTDB
001238 DFB1 111A00          10      LD  DE,01AH
00123B DFB4 19              11      ADD HL,DE
00123C DFB5 5E               7      LD  E,(HL)
00123D DFB6 23               6      INC HL
00123E DFB7 56               7      LD  D,(HL)
       DFB8                     KILLS1:
00123F DFB8 CD3BDF          17      CALL    ENDCL
001242 DFBB D0              11      RET NC      ;CF=0
001243 DFBC 21FEFF          10      LD  HL,0-2
001246 DFBF 19              11      ADD HL,DE
001247 DFC0 D0              11      RET NC      ;DE= 0 or 1
001248 DFC1 D5              11      PUSH    DE
001249 DFC2 CDF7F0          17      CALL    _GNCL
00124C DFC5 ED53FEF1        20      LD  (_CLPS),DE
001250 DFC9 D1              10      POP DE
001251 DFCA 210000          10      LD  HL,0
001254 DFCD D4FAF0          17      CALL    NC,_SNCL
001257 DFD0 D8              11      RET C
001258 DFD1 ED5BFEF1        20      LD  DE,(_CLPS)  ;FAT
00125C DFD5 18E1            12      JR  KILLS1
                                
       DFD7                     KILLW:
00125E DFD7 CD6DDD          17      CALL    SOPEN
       DFDA                     KILLW1:
001261 DFDA 380B            12      JR  C,KILLW2
001263 DFDC CD0DDE          17      CALL    SOPENE2
001266 DFDF CDA6DF          17      CALL    KILLS
001269 DFE2 CDD1DD          17      CALL    NOPEN
00126C DFE5 18F3            12      JR  KILLW1
       DFE7                     KILLW2:
00126E DFE7 C8              11      RET Z
00126F DFE8 3F               4      CCF
001270 DFE9 C9              10      RET
                                
       DFEA                     CHKATT:
001271 DFEA E5              11      PUSH    HL
001272 DFEB 110B00          10      LD  DE,00BH
001275 DFEE 19              11      ADD HL,DE
001276 DFEF A6               7      AND (HL)
001277 DFF0 E1              10      POP HL
001278 DFF1 C8              11      RET Z
001279 DFF2 37               4      SCF
00127A DFF3 C9              10      RET
                                
       DFF4                     NAME:
00127B DFF4 CD6EE0          17      CALL    CHKWILDX
00127E DFF7 D8              11      RET C
00127F DFF8 110400          10      LD  DE,4
001282 DFFB 19              11      ADD HL,DE
001283 DFFC 2214E0          16      LD  (NAMEP+2),HL
001286 DFFF 23               6      INC HL
001287 E000 CD72E0          17      CALL    CHKWILD
00128A E003 D8              11      RET C
                                
00128B E004 CD40DD          17      CALL    SOPENX
00128E E007 3E0F             7      LD  A,00FH
001290 E009 D4EADF          17      CALL    NC,CHKATT
001293 E00C D8              11      RET C
                                
001294 E00D FD7E00          19      LD  A,(IY+0)
001297 E010 FDE5            15      PUSH    IY
001299 E012 FD210000        14  NAMEP:  LD  IY,0        ;自己書き換え
00129D E016 FD7700          19      LD  (IY+0),A
0012A0 E019 CD40DD          17      CALL    SOPENX
0012A3 E01C FDE3            23      EX  (SP),IY
0012A5 E01E 3F               4      CCF
0012A6 E01F D46DDD          17      CALL    NC,SOPEN
0012A9 E022 EB               4      EX  DE,HL
0012AA E023 E1              10      POP HL
0012AB E024 D8              11      RET C
                                
       E025                     SETNAME:
0012AC E025 01000B          10      LD  BC,11*256
0012AF E028 23               6      INC HL
0012B0 E029 7E               7      LD  A,(HL)
0012B1 E02A FEE5             7      CP  0E5H
0012B3 E02C 2004            12      JR  NZ,SNAME1
0012B5 E02E 3E05             7      LD  A,5
0012B7 E030 180E            12      JR  SNAME3
       E032                     SNAME1:
0012B9 E032 7E               7      LD  A,(HL)
0012BA E033 0C               4      INC C
0012BB E034 0D               4      DEC C
0012BC E035 2009            12      JR  NZ,SNAME3
0012BE E037 CD43DF          17      CALL    CAP
0012C1 E03A FEA0             7      CP  0A0H
0012C3 E03C 2002            12      JR  NZ,SNAME3
0012C5 E03E 3E20             7      LD  A,020H
       E040                     SNAME3:
0012C7 E040 12               7      LD  (DE),A
0012C8 E041 7E               7      LD  A,(HL)
0012C9 E042 23               6      INC HL
0012CA E043 CD5BE0          17      CALL    FKAN
0012CD E046 10EA            13      DJNZ    SNAME1
       E048                     WTDB:
0012CF E048 3EFF             7      LD  A,0FFH
0012D1 E04A 3239F0          13      LD  (SFILE),A
       E04D                     SWTDBF:
0012D4 E04D 3E01             7      LD  A,1
0012D6 E04F 32A4F0          13      LD  (_WTDBF),A
0012D9 E052 AF               4      XOR A
0012DA E053 C9              10      RET
                                
       E054                     FKANC:
0012DB E054 CB41             8      BIT 0,C
0012DD E056 CC4CDF          17      CALL    Z,CAP2
0012E0 E059 1801            12      JR  FKANX
       E05B                     FKAN:           ;漢字チェック
0012E2 E05B 13               6      INC DE
       E05C                     FKANX:
0012E3 E05C CB41             8      BIT 0,C
0012E5 E05E CB81             8      RES 0,C
0012E7 E060 C0              11      RET NZ
0012E8 E061 FE80             7      CP  080H
0012EA E063 D8              11      RET C
0012EB E064 FEA0             7      CP  0A0H
0012ED E066 3803            12      JR  C,FKAN1
0012EF E068 FEE0             7      CP  0E0H
0012F1 E06A D8              11      RET C
       E06B                     FKAN1:
0012F2 E06B 0C               4      INC C
0012F3 E06C A7               4      AND A
0012F4 E06D C9              10      RET
                                
       E06E                     CHKWILDX:
0012F5 E06E FDE5            15      PUSH    IY
0012F7 E070 E1              10      POP HL
0012F8 E071 23               6      INC HL
       E072                     CHKWILD:
0012F9 E072 060B             7      LD  B,11
0012FB E074 3E3F             7      LD  A,'?'
       E076                     CHKWIL1:
0012FD E076 BE               7      CP  (HL)
0012FE E077 23               6      INC HL
0012FF E078 37               4      SCF
001300 E079 C8              11      RET Z
001301 E07A 10FA            13      DJNZ    CHKWIL1
001303 E07C AF               4      XOR A
001304 E07D C9              10      RET
                                
       E07E                     SDIRENT:        ;IY=FCB HL=DIR
001305 E07E D5              11      PUSH    DE
001306 E07F E5              11      PUSH    HL
001307 E080 FDE5            15      PUSH    IY
001309 E082 D1              10      POP DE
00130A E083 EB               4      EX  DE,HL
00130B E084 CD25E0          17      CALL    SETNAME
                                ;               Attribute
00130E E087 FD7E0D          19      LD  A,(IY+13)   ;(FCB)属性(アトリビュート)
001311 E08A 12               7      LD  (DE),A
001312 E08B 13               6      INC DE
                                ;               Reserved
001313 E08C AF               4      XOR A
001314 E08D 060A             7      LD  B,10
       E08F                     SDE1:
001316 E08F 12               7      LD  (DE),A
001317 E090 13               6      INC DE
001318 E091 10FC            13      DJNZ    SDE1
                                                    ;(FCB)更新時刻
00131A E093 21EAF1          10      LD  HL,SDDATA       ;(FCB)更新年月日
00131D E096 060A             7      LD  B,SDDATAE-SDDATA    ;(FCB)ファイルの先頭クラスタ
       E098                     SDLOOP:                 ;(FCB)ファイルのサイズ(バイト単位)
00131F E098 7E               7      LD  A,(HL)
001320 E099 23               6      INC HL
001321 E09A 329FE0          13      LD  (SDPAT+2),A
001324 E09D FD7E00          19  SDPAT:  LD  A,(IY+0)    ;LD A,(IY+A)
001327 E0A0 12               7      LD  (DE),A
001328 E0A1 13               6      INC DE
001329 E0A2 10F4            13      DJNZ    SDLOOP
                                
00132B E0A4 AF               4      XOR A
00132C E0A5 E1              10      POP HL
00132D E0A6 D1              10      POP DE
00132E E0A7 C9              10      RET
                                
       E0A8                     WOPEN:
00132F E0A8 FD7E0D          19      LD  A,(IY+13)   ;(FCB)属性(アトリビュート)
001332 E0AB E61F             7      AND 01FH
001334 E0AD 37               4      SCF
001335 E0AE C0              11      RET NZ
001336 E0AF FD361CFE        19      LD  (IY+28),0FEH    ;(FCB)オープンモード
       E0B3                     TOPEN2:
00133A E0B3 AF               4      XOR A
       E0B4                     TOPEN:              ;Initializes the time stamp
00133B E0B4 FD3617FF        19      LD  (IY+23),0FFH    ;(FCB)更新時刻
00133F E0B8 C9              10      RET
                                
       E0B9                     WRDFX:
001340 E0B9 3A22DF          13      LD  A,(SPCPAT+1)    ;1クラスタの論理セクタ
       E0BC                     L_WRFX:
001343 E0BC 1F               4      RRA         ;->CF
001344 E0BD 3806            12      JR  C,E_WRFX
001346 E0BF CB39             8      SRL C
001348 E0C1 CB1C             8      RR  H       ;CH=CH/2
00134A E0C3 18F7            12      JR  L_WRFX
       E0C5                     E_WRFX:
00134C E0C5 41               4      LD  B,C
00134D E0C6 4C               4      LD  C,H
00134E E0C7 03               6      INC BC
00134F E0C8 3E37             7      LD  A,037H      ;SCF
001351 E0CA 3225E5          13      LD  (DRDN1),A
                                
       E0CD                     WRDF:               ;BCクラスタ分FATを確保する
001354 E0CD 110200          10      LD  DE,2
001357 E0D0 AF               4      XOR A
001358 E0D1 3295E6          13      LD  (_SECPS+1),A
       E0D4                     WRDF1:
00135B E0D4 C5              11      PUSH    BC
00135C E0D5 D5              11      PUSH    DE
00135D E0D6 CDF7F0          17      CALL    _GNCL
001360 E0D9 381C            12      JR  C,WRDF3
001362 E0DB 7A               4      LD  A,D     ;空いているかチェック
001363 E0DC B3               4      OR  E
001364 E0DD 202A            12      JR  NZ,WRDF4
001366 E0DF E1              10      POP HL      ;HL=空いているクラスタ
001367 E0E0 E5              11      PUSH    HL
001368 E0E1 ED5BFEF1        20      LD  DE,(_CLPS)  ;DE=元の(_CLPS)
00136C E0E5 22FEF1          16      LD  (_CLPS),HL
00136F E0E8 7A               4      LD  A,D     ;元の(_CLPS)が 0 か?
001370 E0E9 B3               4      OR  E
001371 E0EA 2008            12      JR  NZ,WRDF2
001373 E0EC FD751A          19      LD  (IY+26),L   ;(FCB)ファイルの先頭クラスタ
001376 E0EF FD741B          19      LD  (IY+27),H   ;元が空の場合はFCBにクラスタをセットする
001379 E0F2 1803            12      JR  WRDF3
       E0F4                     WRDF2:
00137B E0F4 CDFAF0          17      CALL    _SNCL
       E0F7                     WRDF3:
00137E E0F7 D1              10      POP DE
00137F E0F8 C1              10      POP BC
001380 E0F9 D8              11      RET C
001381 E0FA 0B               6      DEC BC
001382 E0FB 78               4      LD  A,B
001383 E0FC B1               4      OR  C
001384 E0FD 200C            12      JR  NZ,WRDF5    ;ここでループカウンタチェック
001386 E0FF ED5BFEF1        20      LD  DE,(_CLPS)
00138A E103 21FFFF          10      LD  HL,0FFFFH   ;FATエントリ終了(EOCマーク)
00138D E106 C3FAF0          10      JP  _SNCL
                                
       E109                     WRDF4:              ;DEクラスタが空じゃないので次に移動する
001390 E109 D1              10      POP DE
001391 E10A C1              10      POP BC
       E10B                     WRDF5:
001392 E10B 13               6      INC DE
001393 E10C CD3BDF          17      CALL    ENDCL
001396 E10F 38C3            12      JR  C,WRDF1
001398 E111 37               4      SCF
001399 E112 C9              10      RET
                                
       E113                     RWXR:
00139A E113 3A32E4          13      LD  A,(SECSZ+2) ;1024=4 / 512=2 / 256=1
       E116                     L_RWX:
00139D E116 1F               4      RRA     ;->CF
00139E E117 3808            12      JR  C,E_RWX
0013A0 E119 CB38             8      SRL B   ;BCH=BCH/2
0013A2 E11B CB19             8      RR  C   ;
0013A4 E11D CB1C             8      RR  H   ;
0013A6 E11F 18F5            12      JR  L_RWX
       E121                     E_RWX:
0013A8 E121 FD5E1A          19      LD  E,(IY+26)   ;(FCB)ファイルの先頭クラスタ
0013AB E124 FD561B          19      LD  D,(IY+27)
0013AE E127 AF               4      XOR A
0013AF E128 3295E6          13      LD  (_SECPS+1),A
       E12B                     RWX1:
0013B2 E12B ED53FEF1        20      LD  (_CLPS),DE
0013B6 E12F 7A               4      LD  A,D
0013B7 E130 B3               4      OR  E
0013B8 E131 2813            12      JR  Z,SCF_RET   ;RET DE==0 => CF=1
                                
0013BA E133 78               4      LD  A,B
0013BB E134 B1               4      OR  C
0013BC E135 B4               4      OR  H
0013BD E136 C8              11      RET Z       ;RET BCH==0 => CF=0
                                
0013BE E137 CD9DE6          17      CALL    GNCLX
0013C1 E13A D8              11      RET C
0013C2 E13B 7C               4      LD  A,H     ;
0013C3 E13C 25               4      DEC H       ;
0013C4 E13D B7               4      OR  A       ;DEC BCH
0013C5 E13E 2001            12      JR  NZ,RWX2     ;
0013C7 E140 0B               6      DEC BC      ;
       E141                     RWX2:
0013C8 E141 CD3BDF          17      CALL    ENDCL
0013CB E144 38E5            12      JR  C,RWX1
       E146                     SCF_RET:
0013CD E146 37               4      SCF
0013CE E147 C9              10      RET
                                
       E148                     DSKF:
0013CF E148 110000          10  MAXCLP: LD  DE,0
0013D2 E14B 2AACF0          16      LD  HL,(_FAKEFREE)
0013D5 E14E 7C               4      LD  A,H
0013D6 E14F B5               4      OR  L
0013D7 E150 2803            12      JR  Z,DSKF1
0013D9 E152 110100          10      LD  DE,1
       E155                     DSKF1:
0013DC E155 D5              11      PUSH    DE
0013DD E156 CDF7F0          17      CALL    _GNCL
0013E0 E159 380C            12      JR  C,POPSCF
0013E2 E15B 7A               4      LD  A,D
0013E3 E15C B3               4      OR  E
0013E4 E15D 2001            12      JR  NZ,DSKF2
0013E6 E15F 23               6      INC HL
       E160                     DSKF2:
0013E7 E160 D1              10      POP DE
0013E8 E161 1B               6      DEC DE
0013E9 E162 7A               4      LD  A,D
0013EA E163 B3               4      OR  E
0013EB E164 20EF            12      JR  NZ,DSKF1
0013ED E166 C9              10      RET
                                
       E167                     POPSCF:
0013EE E167 F1              10      POP AF
0013EF E168 37               4      SCF
0013F0 E169 C9              10      RET
                                
       E16A                     SETTMS:
0013F1 E16A FD7E17          19      LD  A,(IY+23)   ;(FCB)ファイルを最後に変更した時刻
0013F4 E16D 3C               4      INC A
0013F5 E16E C0              11      RET NZ      ;ファイルが更新されていない
       E16F                     SETTMSX:            ;FCBに日付時刻をセットする
0013F6 E16F CDD1D8          17      CALL    _SYS2C      ;(BDOS)時刻の獲得
                                                ;H←時  L←分  D←秒
0013F9 E172 CB25             8      SLA L       ;   *2
0013FB E174 CB25             8      SLA L       ;   *4
0013FD E176 29              11      ADD HL,HL       ;*2 *8
0013FE E177 29              11      ADD HL,HL       ;*4 *16
0013FF E178 29              11      ADD HL,HL       ;*8 *32
001400 E179 7A               4      LD  A,D
001401 E17A 0F               4      RRCA            ;bit.0->7->->->0->C
001402 E17B E61F             7      AND 01FH
001404 E17D B5               4      OR  L
001405 E17E FD7716          19      LD  (IY+22),A   ;(FCB)ファイルを最後に変更した時刻
001408 E181 FD7417          19      LD  (IY+23),H
                                
00140B E184 CDCBD8          17      CALL    _SYS2A      ;(BDOS)日付の獲得
                                                ;HL←年  D←月  E←日
00140E E187 0144F8          10      LD  BC,0-1980
001411 E18A 09              11      ADD HL,BC
001412 E18B 65               4      LD  H,L
                                
001413 E18C 7A               4      LD  A,D
001414 E18D 87               4      ADD A,A     ;*2
001415 E18E 87               4      ADD A,A     ;*4
001416 E18F 87               4      ADD A,A     ;*8
001417 E190 87               4      ADD A,A     ;*16
001418 E191 6F               4      LD  L,A
001419 E192 29              11      ADD HL,HL       ;*32
00141A E193 7D               4      LD  A,L
00141B E194 B3               4      OR  E
00141C E195 FD7714          19      LD  (IY+20),A   ;(FCB)ファイルを最後に変更した日付
00141F E198 FD7415          19      LD  (IY+21),H
001422 E19B C9              10      RET
                                
       E19C                     PUSHRR:
001423 E19C 3234E2          13      LD  (SETSEQ_SWC_RND),A
001426 E19F 2246E2          16      LD  (SETSEQ_SWC_SEQ_RR),HL
001429 E1A2 CDC2E1          17      CALL    GET_RR_AHL
00142C E1A5 225AF0          16      LD  (RR_BUF_HL),HL
00142F E1A8 325CF0          13      LD  (RR_BUF_A),A
001432 E1AB C9              10      RET
                                
       E1AC                     GET_CPM_R_SIZE:     ;バイト単位からCP/Mのレコード単位を求める（1レコード=128バイト）
001433 E1AC 87               4      ADD A,A     ;in BHLA => out AHL
001434 E1AD ED6A            15      ADC HL,HL
001436 E1AF CB18             8      RR  B
001438 E1B1 B7               4      OR  A
001439 E1B2 78               4      LD  A,B     ;ここでフラグは変化しない
00143A E1B3 C8              11      RET Z
00143B E1B4 2C               4      INC L       ;INC AHL
00143C E1B5 C0              11      RET NZ      ;
00143D E1B6 24               4      INC H       ;
00143E E1B7 C0              11      RET NZ      ;
00143F E1B8 3C               4      INC A       ;
001440 E1B9 C9              10      RET
                                
       E1BA                     INIT_RND:
001441 E1BA 3ECD             7      LD  A,0CDH      ;CALL ????
001443 E1BC 2109E2          10      LD  HL,POPRR
001446 E1BF CD9CE1          17      CALL    PUSHRR
       E1C2                     GET_RR_AHL:
001449 E1C2 FD6E21          19      LD  L,(IY+33)   ;(FCB)Random record
00144C E1C5 FD6622          19      LD  H,(IY+34)   ;
00144F E1C8 FD7E23          19      LD  A,(IY+35)   ;
001452 E1CB C9              10      RET
       E1CC                     SET_RR_AHL:
001453 E1CC FD7521          19      LD  (IY+33),L   ;(FCB)Random record
001456 E1CF FD7422          19      LD  (IY+34),H
001459 E1D2 FD7723          19      LD  (IY+35),A
00145C E1D5 C9              10      RET
       E1D6                     INIT_SEQ:
00145D E1D6 3E01             7      LD  A,1     ;LD BC,????
00145F E1D8 2106E2          10      LD  HL,SETSEQ
001462 E1DB CD9CE1          17      CALL    PUSHRR
       E1DE                     GETSEQ:
001465 E1DE FD6E20          19      LD  L,(IY+32)   ;(FCB)カレントレコード
001468 E1E1 FD660C          19      LD  H,(IY+12)   ;(FCB)カレントブロック
00146B E1E4 AF               4      XOR A
                                
00146C E1E5 CB25             8      SLA L   ;L=L*2
                                
00146E E1E7 CB3C             8      SRL H   ;HL=HL/2
001470 E1E9 CB1D             8      RR  L   ;
001472 E1EB C9              10      RET
                                
       E1EC                     SETSEQ1:
001473 E1EC F5              11      PUSH    AF
001474 E1ED E5              11      PUSH    HL      ;AHL=Random record
001475 E1EE CDC2E1          17      CALL    GET_RR_AHL
001478 E1F1 47               4      LD  B,A     ;AHL→HLA
001479 E1F2 7D               4      LD  A,L     ;(IY+33)(FCB)ランダムレコード
00147A E1F3 6C               4      LD  L,H     ;(IY+34)
00147B E1F4 60               4      LD  H,B     ;(IY+35)
00147C E1F5 0600             7      LD  B,0
                                
00147E E1F7 CDACE1          17      CALL    GET_CPM_R_SIZE
                                
001481 E1FA 29              11      ADD HL,HL
001482 E1FB CB3D             8      SRL L       ;L=L/2
001484 E1FD FD7520          19      LD  (IY+32),L   ;(FCB)カレントレコード
001487 E200 FD740C          19      LD  (IY+12),H   ;(FCB)カレントブロック
00148A E203 E1              10      POP HL
00148B E204 F1              10      POP AF
00148C E205 C9              10      RET
       E206                     SETSEQ:
00148D E206 CDECE1          17      CALL    SETSEQ1
       E209                     POPRR:
001490 E209 F5              11      PUSH    AF
001491 E20A E5              11      PUSH    HL
001492 E20B 2A5AF0          16      LD  HL,(RR_BUF_HL)
001495 E20E 3A5CF0          13      LD  A,(RR_BUF_A)
001498 E211 CDCCE1          17      CALL    SET_RR_AHL
00149B E214 E1              10      POP HL
00149C E215 F1              10      POP AF
00149D E216 C9              10      RET
                                
       E217                     RB_WRITE:
00149E E217 C5              11      PUSH    BC
00149F E218 ED4B4CF1        20      LD  BC,(STABLE+2*026H)  ;(BDOS)ランダムブロック書き込み
0014A3 E21C 1805            12      JR  RBRW
       E21E                     RB_READ:
0014A5 E21E C5              11      PUSH    BC
0014A6 E21F ED4B4EF1        20      LD  BC,(STABLE+2*027H)  ;(BDOS)ランダムブロック読み込み
       E223                     RBRW:
0014AA E223 1F               4      RRA     ;AHL = AHL*128
0014AB E224 7C               4      LD  A,H ;AHL = AHL0/2
0014AC E225 1F               4      RRA     ;A
0014AD E226 65               4      LD  H,L ;
0014AE E227 CB1C             8      RR  H   ;H
0014B0 E229 2E00             7      LD  L,0 ;
0014B2 E22B CB1D             8      RR  L   ;L
0014B4 E22D CDCCE1          17      CALL    SET_RR_AHL
0014B7 E230 218000          10      LD  HL,128
0014BA E233 C5              11      PUSH    BC
       E234                     SETSEQ_SWC_RND:
0014BB E234 CDECE1          17      CALL    SETSEQ1
0014BE E237 C1              10      POP BC
0014BF E238 FDCB20FE        23      SET 7,(IY+32)   ;(FCB)カレントレコード
0014C3 E23C FDE5            15      PUSH    IY
0014C5 E23E D1              10      POP DE
0014C6 E23F D5              11      PUSH    DE
0014C7 E240 CD4EE2          17      CALL    JP_BC
0014CA E243 FDE1            14      POP IY
0014CC E245 CD06E2          17      CALL    SETSEQ
       E246                     SETSEQ_SWC_SEQ_RR   EQU $-2
0014CF E248 FDCB20BE        23      RES 7,(IY+32)   ;(FCB)カレントレコード
                                
0014D3 E24C C1              10      POP BC
0014D4 E24D C9              10      RET
       E24E                     JP_BC:
0014D5 E24E C5              11      PUSH    BC
0014D6 E24F C9              10      RET
                                
       DDCB                     _SYS03  EQU SCF_FF_RET  ;(BDOS)外部入力
       DDCB                     _SYS2B  EQU SCF_FF_RET  ;(BDOS)日付の設定
       DDCB                     _SYS2D  EQU SCF_FF_RET  ;(BDOS)時刻の設定
       DDCB                     _SYS39  EQU SCF_FF_RET  ;(BDOS)サブディレクトリの作成
       DDCB                     _SYS3A  EQU SCF_FF_RET  ;(BDOS)サブディレクトリの削除
                                
[EOF:LDFILE.ASM:SHIFT_JIS]
                                    INCLUDE "LDFILE2.ASM"
                                
                                ;   LSX-Dodgers FILE2
                                
                                                ;Write random block
       E250                     _SYS26:     ;(BDOS)ランダムブロック書き込み
0014D7 E250 AF               4      XOR A
0014D8 E251 3225E5          13      LD  (DRDN1),A   ;NOP
0014DB E254 2275E4          16      LD  (RBSIZE),HL ;HL←書き込むレコード数
0014DE E257 225DF0          16      LD  (LEFTX),HL
0014E1 E25A CD20DD          17      CALL    SETDRV
                                
0014E4 E25D CDCDE3          17      CALL    RBX0
0014E7 E260 DAEDE2          10      JP  C,RBWERR
0014EA E263 CDA8E0          17      CALL    WOPEN
0014ED E266 DAEDE2          10      JP  C,RBWERR
0014F0 E269 7C               4      LD  A,H
0014F1 E26A B5               4      OR  L
0014F2 E26B CAE6E2          10      JP  Z,RBW1
                                
0014F5 E26E 2B               6      DEC HL
                                
0014F6 E26F CD8BE4          17      CALL    GET_RR_BCDE ;BCDE=Random record
                                
0014F9 E272 19              11      ADD HL,DE       ;BCHL=HL+BCDE
0014FA E273 3001            12      JR  NC,S26X1    ;
0014FC E275 03               6      INC BC      ;
       E276                     S26X1:
0014FD E276 CD13E1          17      CALL    RWXR
001500 E279 DCB9E0          17      CALL    C,WRDFX
001503 E27C DAEDE2          10      JP  C,RBWERR
                                
001506 E27F CDFCE3          17      CALL    RBX2
001509 E282 281A            12      JR  Z,RBWB      ;NZ=セクタ以下の端数がある
00150B E284 CD1BE4          17      CALL    RBXA
00150E E287 3864            12      JR  C,RBWERR
001510 E289 EB               4      EX  DE,HL
001511 E28A C5              11      PUSH    BC
001512 E28B EDB0                    LDIR
001514 E28D 225FF0          16      LD  (DTAX),HL
                                
001517 E290 CD4DE0          17      CALL    SWTDBF      ;バッファデータは更新された
                                
00151A E293 2A5DF0          16      LD  HL,(LEFTX)
00151D E296 D1              10      POP DE
00151E E297 ED52            15      SBC HL,DE
001520 E299 225DF0          16      LD  (LEFTX),HL
001523 E29C 2831            12      JR  Z,RBWEND
                                
       E29E                     RBWB:
001525 E29E CD50E4          17      CALL    RBXB
001528 E2A1 2814            12      JR  Z,RBWC
       E2A3                     RBWB1:
00152A E2A3 C5              11      PUSH    BC
00152B E2A4 D5              11      PUSH    DE
00152C E2A5 CD1EDF          17      CALL    CLUSTX
00152F E2A8 CD9FE4          17      CALL    DWTC
001532 E2AB D1              10      POP DE
001533 E2AC C1              10      POP BC
001534 E2AD D49DE6          17      CALL    NC,GNCLX
001537 E2B0 383B            12      JR  C,RBWERR
001539 E2B2 10EF            13      DJNZ    RBWB1
00153B E2B4 CDEFE4          17      CALL    DRW_FLUSH
       E2B7                     RBWC:
00153E E2B7 CD68E4          17      CALL    RBXC
001541 E2BA 2813            12      JR  Z,RBWEND
001543 E2BC C5              11      PUSH    BC
001544 E2BD CD1EDF          17      CALL    CLUSTX
001547 E2C0 CD24E5          17      CALL    DRDN
00154A E2C3 C1              10      POP BC
00154B E2C4 3827            12      JR  C,RBWERR
00154D E2C6 ED5B7EF1        20      LD  DE,(_DTBUF)
001551 E2CA EDB0                    LDIR
001553 E2CC CD4DE0          17      CALL    SWTDBF      ;バッファデータは更新された
       E2CF                     RBWEND:
001556 E2CF CD74E4          17      CALL    RBXEND
                                
001559 E2D2 CDDCE3          17      CALL    RBX1
00155C E2D5 300F            12      JR  NC,RBW1     ;ランダムレコードの方が大きい場合はサイズを合わせる
00155E E2D7 CD8BE4          17      CALL    GET_RR_BCDE ;BCDE=Random record
001561 E2DA FD7310          19      LD  (IY+16),E   ;ファイルのサイズ(バイト単位)
001564 E2DD FD7211          19      LD  (IY+17),D   ;
001567 E2E0 FD7112          19      LD  (IY+18),C   ;
00156A E2E3 FD7013          19      LD  (IY+19),B   ;
       E2E6                     RBW1:
00156D E2E6 FDE1            14      POP IY
00156F E2E8 C1              10      POP BC
001570 E2E9 D1              10      POP DE
001571 E2EA E1              10      POP HL
       E2EB                     DD_NUL:
001572 E2EB AF               4      XOR A
       E2EC                     DRDF0:
       E2EC                     DWTF0:
001573 E2EC C9              10      RET
                                
       E2ED                     RBWERR:
001574 E2ED FDE5            15      PUSH    IY
001576 E2EF D1              10      POP DE
001577 E2F0 2A20F1          16      LD  HL,(STABLE+2*010H)
00157A E2F3 CD0F00          17      CALL    JP_HL
       E2F6                     RBRERR1:
00157D E2F6 3E01             7      LD  A,001H
       E2F8                     RBRERR2:
00157F E2F8 FDE1            14      POP IY
001581 E2FA C1              10      POP BC
001582 E2FB D1              10      POP DE
001583 E2FC E1              10      POP HL
001584 E2FD 37               4      SCF
001585 E2FE 210000          10      LD  HL,0
001588 E301 C9              10      RET
                                
       E302                     RBRERR:
001589 E302 3EFF             7      LD  A,0FFH
00158B E304 18F2            12      JR  RBRERR2
                                
       E306                     RBRFL:
00158D E306 3E00             7  RBRFLP: LD  A,000H
00158F E308 FE0D             7      CP  00DH
001591 E30A 2005            12      JR  NZ,RBRFL1
001593 E30C D5              11      PUSH    DE
001594 E30D 1E0A             7      LD  E,00AH
001596 E30F 1805            12      JR  RBRFL2
       E311                     RBRFL1:
001598 E311 D5              11      PUSH    DE
001599 E312 CD09F0          17      CALL    _SYS07
00159C E315 5F               4      LD  E,A
       E316                     RBRFL2:
00159D E316 CDCDF0          17      CALL    _PRINT
0015A0 E319 7B               4      LD  A,E
0015A1 E31A D1              10      POP DE
0015A2 E31B 3207E3          13      LD  (RBRFLP+1),A
0015A5 E31E C9              10      RET
       E31F                     DDX:
0015A6 E31F FD7E01          19      LD  A,(IY+1)    ;(FCB)主ファイル名
0015A9 E322 CD43DF          17      CALL    CAP
0015AC E325 FE41             7      CP  'A'
0015AE E327 C9              10      RET
                                
                                                ;Read random block
       E328                     _SYS27:     ;(BDOS)ランダムブロック読み込み
0015AF E328 225DF0          16      LD  (LEFTX),HL
0015B2 E32B CD20DD          17      CALL    SETDRV
                                
0015B5 E32E FDCB0D66        20      BIT 4,(IY+13)   ;(FCB)属性(アトリビュート)
0015B9 E332 C2BBE3          10      JP  NZ,RBRDIR   ;ディレクトリ
0015BC E335 CDCDE3          17      CALL    RBX0
0015BF E338 DA02E3          10      JP  C,RBRERR
0015C2 E33B CDDCE3          17      CALL    RBX1
0015C5 E33E D4F4E3          17      CALL    NC,RBX1R
0015C8 E341 DAF6E2          10      JP  C,RBRERR1
0015CB E344 EB               4      EX  DE,HL
0015CC E345 ED52            15      SBC HL,DE       ;CP 00HL,BCDE
0015CE E347 19              11      ADD HL,DE
0015CF E348 79               4      LD  A,C
0015D0 E349 DE00             7      SBC A,0
0015D2 E34B 78               4      LD  A,B
0015D3 E34C DE00             7      SBC A,0
0015D5 E34E 3801            12      JR  C,RBR1
0015D7 E350 EB               4      EX  DE,HL
       E351                     RBR1:
0015D8 E351 9F               4      SBC A,A
0015D9 E352 E601             7      AND 1
0015DB E354 32B9E3          13      LD  (RBRAP+1),A
                                
0015DE E357 7C               4      LD  A,H
0015DF E358 B5               4      OR  L
0015E0 E359 2857            12      JR  Z,RBREND0
                                
0015E2 E35B 2275E4          16      LD  (RBSIZE),HL ;HL←読み込むレコード数
0015E5 E35E 225DF0          16      LD  (LEFTX),HL
                                
0015E8 E361 CDFCE3          17      CALL    RBX2
0015EB E364 2819            12      JR  Z,RBRB
0015ED E366 CD1BE4          17      CALL    RBXA
0015F0 E369 DA02E3          10      JP  C,RBRERR
0015F3 E36C C5              11      PUSH    BC
0015F4 E36D EDB0                    LDIR
0015F6 E36F ED535FF0        20      LD  (DTAX),DE
0015FA E373 2A5DF0          16      LD  HL,(LEFTX)
0015FD E376 D1              10      POP DE
0015FE E377 A7               4      AND A
0015FF E378 ED52            15      SBC HL,DE
001601 E37A 225DF0          16      LD  (LEFTX),HL
001604 E37D 2830            12      JR  Z,RBREND
                                
       E37F                     RBRB:
001606 E37F CD50E4          17      CALL    RBXB
001609 E382 2815            12      JR  Z,RBRC
       E384                     RBRB1:
00160B E384 C5              11      PUSH    BC
00160C E385 D5              11      PUSH    DE
00160D E386 CD1EDF          17      CALL    CLUSTX
001610 E389 CDA5E4          17      CALL    DRDC
001613 E38C D1              10      POP DE
001614 E38D C1              10      POP BC
001615 E38E D49DE6          17      CALL    NC,GNCLX
001618 E391 DA02E3          10      JP  C,RBRERR
00161B E394 10EE            13      DJNZ    RBRB1
00161D E396 CDEFE4          17      CALL    DRW_FLUSH
       E399                     RBRC:
001620 E399 CD68E4          17      CALL    RBXC
001623 E39C 2811            12      JR  Z,RBREND
001625 E39E C5              11      PUSH    BC
001626 E39F CD1EDF          17      CALL    CLUSTX
001629 E3A2 CD08E5          17      CALL    DRDX
00162C E3A5 C1              10      POP BC
00162D E3A6 DA02E3          10      JP  C,RBRERR
001630 E3A9 EB               4      EX  DE,HL
001631 E3AA 2A7EF1          16      LD  HL,(_DTBUF)
001634 E3AD EDB0                    LDIR
       E3AF                     RBREND:
001636 E3AF CD74E4          17      CALL    RBXEND
       E3B2                     RBREND0:
001639 E3B2 FDE1            14      POP IY
00163B E3B4 C1              10      POP BC
00163C E3B5 D1              10      POP DE
00163D E3B6 F1              10      POP AF  ;(HL)
00163E E3B7 AF               4      XOR A
00163F E3B8 3E00             7  RBRAP:  LD  A,000H
001641 E3BA C9              10      RET
                                
       E3BB                     RBRDIR:
001642 E3BB FD6E1A          19      LD  L,(IY+26)   ;(FCB)ファイルの先頭クラスタ
001645 E3BE FD661B          19      LD  H,(IY+27)
001648 E3C1 CD5EDF          17      CALL    CHDIR
00164B E3C4 AF               4      XOR A
00164C E3C5 67               4      LD  H,A
00164D E3C6 6F               4      LD  L,A
00164E E3C7 3C               4      INC A
00164F E3C8 32B9E3          13      LD  (RBRAP+1),A
001652 E3CB 18E5            12      JR  RBREND0
                                
       E3CD                     RBX0:
001654 E3CD 2A8AF0          16      LD  HL,(_DTA)
001657 E3D0 225FF0          16      LD  (DTAX),HL
00165A E3D3 2A5DF0          16      LD  HL,(LEFTX)
00165D E3D6 FD7E1C          19      LD  A,(IY+28)   ;(FCB)オープンモード
001660 E3D9 D6FD             7      SUB 0FDH
001662 E3DB C9              10      RET
                                
       E3DC                     RBX1:               ;ファイルサイズとランダムレコードを比べる
001663 E3DC E5              11      PUSH    HL      ;Record byte
                                                ;AHL=File size
001664 E3DD FD6E10          19      LD  L,(IY+16)   ;ファイルのサイズ(バイト単位)
001667 E3E0 FD6611          19      LD  H,(IY+17)   ;
00166A E3E3 FD7E12          19      LD  A,(IY+18)   ;
                                
00166D E3E6 CD8BE4          17      CALL    GET_RR_BCDE ;BCDE=Random record
                                
001670 E3E9 A7               4      AND A
001671 E3EA ED52            15      SBC HL,DE
001673 E3EC 99               4      SBC A,C
001674 E3ED 4F               4      LD  C,A
001675 E3EE FD7E13          19      LD  A,(IY+19)   ;ファイルのサイズ
001678 E3F1 98               4      SBC A,B
001679 E3F2 D1              10      POP DE
00167A E3F3 C9              10      RET
       E3F4                     RBX1R:
00167B E3F4 47               4      LD  B,A
00167C E3F5 B1               4      OR  C
00167D E3F6 EB               4      EX  DE,HL   ;BCDE=File byte HL=Record byte
00167E E3F7 B2               4      OR  D
00167F E3F8 B3               4      OR  E
001680 E3F9 C0              11      RET NZ
001681 E3FA 37               4      SCF
001682 E3FB C9              10      RET
                                
       E3FC                     RBX2:               ;Cluster settings
001683 E3FC FD6622          19      LD  H,(IY+34)   ;(+33)(FCB)ランダムレコード
001686 E3FF FD4E23          19      LD  C,(IY+35)
001689 E402 0600             7      LD  B,0
00168B E404 FDCB207E        20      BIT 7,(IY+32)   ;(FCB)カレントレコード
00168F E408 2003            12      JR  NZ,RBX3
001691 E40A FD4624          19      LD  B,(IY+36)
       E40D                     RBX3:
001694 E40D CD13E1          17      CALL    RWXR
001697 E410 3A32E4          13      LD  A,(SECSZ+2) ;1024=4 / 512=2 / 256=1
00169A E413 3D               4      DEC A
00169B E414 FDA622          19      AND (IY+34)
00169E E417 FDB621          19      OR  (IY+33)
0016A1 E41A C9              10      RET
                                
       E41B                     RBXA:
0016A2 E41B C5              11      PUSH    BC
0016A3 E41C D5              11      PUSH    DE
0016A4 E41D CD1EDF          17      CALL    CLUSTX
0016A7 E420 CD08E5          17      CALL    DRDX
0016AA E423 D1              10      POP DE
0016AB E424 C1              10      POP BC
0016AC E425 D49DE6          17      CALL    NC,GNCLX
0016AF E428 D8              11      RET C
0016B0 E429 ED53FEF1        20      LD  (_CLPS),DE
                                
0016B4 E42D FD4E21          19      LD  C,(IY+33)   ;(FCB)ランダムレコード
0016B7 E430 210004          10  SECSZ:  LD  HL,0400H    ;自己書き換え 1024=0400H / 512=0200H ここに1セクタのサイズが格納される
0016BA E433 7C               4      LD  A,H
0016BB E434 3D               4      DEC A       ;1024=3 / 512=1
0016BC E435 FDA622          19      AND (IY+34)     ;(FCB)ランダムレコード
0016BF E438 47               4      LD  B,A     ;BCに1セクタ以下の端数が入る
0016C0 E439 ED42            15      SBC HL,BC       ;残りを計算
                                
0016C2 E43B ED5B5DF0        20      LD  DE,(LEFTX)
0016C6 E43F ED52            15      SBC HL,DE       ;CP HL,DE
0016C8 E441 19              11      ADD HL,DE       ;
0016C9 E442 3801            12      JR  C,RBXA1     ;DEとHLを比較して大きい方をHLに
0016CB E444 EB               4      EX  DE,HL
       E445                     RBXA1:
0016CC E445 E5              11      PUSH    HL
0016CD E446 2A7EF1          16      LD  HL,(_DTBUF)
0016D0 E449 09              11      ADD HL,BC
0016D1 E44A ED5B5FF0        20      LD  DE,(DTAX)
0016D5 E44E C1              10      POP BC
0016D6 E44F C9              10      RET
                                
       E450                     RBXB:
0016D7 E450 2A5FF0          16      LD  HL,(DTAX)
0016DA E453 ED5BFEF1        20      LD  DE,(_CLPS)
0016DE E457 3A5EF0          13      LD  A,(LEFTX+1)
0016E1 E45A 47               4      LD  B,A
0016E2 E45B 3A32E4          13      LD  A,(SECSZ+2) ;1024=4 / 512=2 / 256=1
       E45E                     RBXB1:
0016E5 E45E 1F               4      RRA     ;->CF
0016E6 E45F 3804            12      JR  C,RBXB2
0016E8 E461 CB38             8      SRL B   ;B=B/2
0016EA E463 18F9            12      JR  RBXB1
       E465                     RBXB2:
0016EC E465 78               4      LD  A,B
0016ED E466 B7               4      OR  A
0016EE E467 C9              10      RET
                                
       E468                     RBXC:
0016EF E468 ED4B5DF0        20      LD  BC,(LEFTX)
0016F3 E46C 3A32E4          13      LD  A,(SECSZ+2) ;1024=4 / 512=2 / 256=1
0016F6 E46F 3D               4      DEC A
0016F7 E470 A0               4      AND B
0016F8 E471 47               4      LD  B,A     ;1セクタ以下の端数がない場合はZ
0016F9 E472 B1               4      OR  C
0016FA E473 C9              10      RET
                                
       E474                     RBXEND:             ;レコード数だけランダムレコードを進める
0016FB E474 110000          10      LD  DE,0        ;進めるレコード数(RBSIZE)
       E475                     RBSIZE  EQU $-2
0016FE E477 CDC2E1          17      CALL    GET_RR_AHL
001701 E47A 19              11      ADD HL,DE
001702 E47B CE00             7      ADC A,0
001704 E47D CDCCE1          17      CALL    SET_RR_AHL
001707 E480 EB               4      EX  DE,HL       ;HL=進めるレコード数
001708 E481 D0              11      RET NC
001709 E482 FDCB207E        20      BIT 7,(IY+32)   ;(FCB)カレントレコード
00170D E486 C0              11      RET NZ
00170E E487 FD3424          23      INC (IY+36)
001711 E48A C9              10      RET
                                
       E48B                     GET_RR_BCDE:            ;BCDE=Random record
001712 E48B FD5E21          19      LD  E,(IY+33)   ;(FCB)ランダムレコード
001715 E48E FD5622          19      LD  D,(IY+34)
001718 E491 FD4E23          19      LD  C,(IY+35)
00171B E494 0600             7      LD  B,0     ;CP/M互換のアクセスの場合はFCBは36バイト
00171D E496 FDCB207E        20      BIT 7,(IY+32)   ;(FCB)カレントレコード
001721 E49A C0              11      RET NZ
001722 E49B FD4624          19      LD  B,(IY+36)
001725 E49E C9              10      RET
                                
                                ;   ランダムブロックアクセスの連続したセクタをまとめる
                                
       E49F                     DWTC:
001726 E49F E5              11      PUSH    HL
001727 E4A0 212FE8          10      LD  HL,DWT24B
00172A E4A3 1804            12      JR  DWTC1
       E4A5                     DRDC:
00172C E4A5 E5              11      PUSH    HL
00172D E4A6 211FE8          10      LD  HL,DRD24B
       E4A9                     DWTC1:
001730 E4A9 2203E5          16      LD  (DRWF_MODE),HL
001733 E4AC E1              10      POP HL
001734 E4AD 3AF3E4          13      LD  A,(DRWF_B)
001737 E4B0 B7               4      OR  A
001738 E4B1 200F            12      JR  NZ,DRDC1
       E4B3                     SAVE_DRWC:
00173A E4B3 0601             7      LD  B,1
00173C E4B5 ED43F2E4        20      LD  (DRWF_C),BC
001740 E4B9 ED53F9E4        20      LD  (DRWF_E),DE
001744 E4BD 22FCE4          16      LD  (DRWF_HL),HL
001747 E4C0 1820            12      JR  INC_HL_DRWC
       E4C2                     DRDC1:
001749 E4C2 E5              11      PUSH    HL
00174A E4C3 21F9E4          10      LD  HL,DRWF_E
00174D E4C6 86               7      ADD A,(HL)
00174E E4C7 F5              11      PUSH    AF
00174F E4C8 BB               4      CP  E
001750 E4C9 201D            12      JR  NZ,DRDC2
001752 E4CB F1              10      POP AF
001753 E4CC 23               6      INC HL
001754 E4CD 7E               7      LD  A,(HL)
001755 E4CE CE00             7      ADC A,0
001757 E4D0 F5              11      PUSH    AF
001758 E4D1 BA               4      CP  D
001759 E4D2 2014            12      JR  NZ,DRDC2
00175B E4D4 F1              10      POP AF
00175C E4D5 3AF2E4          13      LD  A,(DRWF_C)
00175F E4D8 CE00             7      ADC A,0
001761 E4DA B9               4      CP  C
001762 E4DB 200C            12      JR  NZ,DRDC3
001764 E4DD 21F3E4          10      LD  HL,DRWF_B
001767 E4E0 34              11      INC (HL)
001768 E4E1 E1              10      POP HL
       E4E2                     INC_HL_DRWC:
001769 E4E2 3A32E4          13      LD  A,(SECSZ+2)     ;1セクタのサイズの上位1バイト
00176C E4E5 84               4      ADD A,H
00176D E4E6 67               4      LD  H,A
00176E E4E7 C9              10      RET
       E4E8                     DRDC2:
00176F E4E8 F1              10      POP AF
       E4E9                     DRDC3:
001770 E4E9 CDEFE4          17      CALL    DRW_FLUSH
001773 E4EC E1              10      POP HL
001774 E4ED 18C4            12      JR  SAVE_DRWC
                                
                                ;   ランダムブロックアクセスの連続したセクタをまとめたものをフラッシュする
       E4EF                     DRW_FLUSH:
001776 E4EF C5              11      PUSH    BC
001777 E4F0 D5              11      PUSH    DE
001778 E4F1 010000          10      LD  BC,0
       E4F2                     DRWF_C  EQU $-2
       E4F3                     DRWF_B  EQU $-1
00177B E4F4 78               4      LD  A,B
00177C E4F5 B7               4      OR  A
00177D E4F6 280D            12      JR  Z,DRDF1
00177F E4F8 110000          10      LD  DE,0
       E4F9                     DRWF_E  EQU $-2
       E4FA                     DRWF_D  EQU $-1
001782 E4FB 210000          10      LD  HL,0
       E4FC                     DRWF_HL EQU $-2
001785 E4FE AF               4      XOR A
001786 E4FF 32F3E4          13      LD  (DRWF_B),A
001789 E502 CD1FE8          17      CALL    DRD24B
       E503                     DRWF_MODE   EQU $-2
       E505                     DRDF1:
00178C E505 D1              10      POP DE
00178D E506 C1              10      POP BC
00178E E507 C9              10      RET
[EOF:LDFILE2.ASM:SHIFT_JIS]
                                    INCLUDE "LDDIO.ASM"
                                
                                ;   LSX-Dodgers DIO
                                
       E508                     DRDX:
00178F E508 CD46E5          17      CALL    DRDY
001792 E50B C8              11      RET Z
001793 E50C CD2CE5          17      CALL    DRDX1       ;データバッファの情報を保存
001796 E50F D8              11      RET C
001797 E510 E5              11      PUSH    HL
001798 E511 C5              11      PUSH    BC
001799 E512 D5              11      PUSH    DE
00179A E513 2A7EF1          16      LD  HL,(_DTBUF)
00179D E516 3A6FE5          13      LD  A,(_DBS24+1)
0017A0 E519 4F               4      LD  C,A
0017A1 E51A CD1DE8          17      CALL    DRD24
0017A4 E51D DC41E5          17      CALL    C,DRDNE
       E520                     POP_DE_BC_HL_RET:
0017A7 E520 D1              10      POP DE
0017A8 E521 C1              10      POP BC
0017A9 E522 E1              10      POP HL
0017AA E523 C9              10      RET
                                
                                ;   CDE:セクタ番号
       E524                     DRDN:
0017AB E524 AF               4      XOR A
0017AC E525 00               4  DRDN1:  NOP         ;自己書き換え NOP / SCF
0017AD E526 30E0            12      JR  NC,DRDX
       E528                     DRDNX:
0017AF E528 CD46E5          17      CALL    DRDY
0017B2 E52B C8              11      RET Z
       E52C                     DRDX1:
0017B3 E52C CD5CE5          17      CALL    DWTX
                                                ;データバッファの読み込んだドライブ・セクタ情報を保存
0017B6 E52F ED53A6F0        20      LD  (_DBSEC),DE
0017BA E533 79               4      LD  A,C
0017BB E534 326FE5          13      LD  (_DBS24+1),A
                                
0017BE E537 3A88F0          13      LD  A,(_DRV)
0017C1 E53A 32A5F0          13      LD  (_DBDRV),A
0017C4 E53D CDD9F0          17      CALL    _CHGDRV
0017C7 E540 D0              11      RET NC
       E541                     DRDNE:
0017C8 E541 9F               4      SBC A,A     ;CF=1ならばA=0FFH
0017C9 E542 32A5F0          13      LD  (_DBDRV),A
0017CC E545 C9              10      RET
                                
                                ;   CDE:セクタ番号
       E546                     DRDY:
0017CD E546 3A6FE5          13      LD  A,(_DBS24+1)
0017D0 E549 B9               4      CP  C
0017D1 E54A C0              11      RET NZ
                                
0017D2 E54B E5              11      PUSH    HL
0017D3 E54C 3A88F0          13      LD  A,(_DRV)
0017D6 E54F 21A5F0          10      LD  HL,_DBDRV
0017D9 E552 AE               7      XOR (HL)
0017DA E553 2005            12      JR  NZ,POP_HL_RET
                                
0017DC E555 2AA6F0          16      LD  HL,(_DBSEC)
0017DF E558 ED52            15      SBC HL,DE       ;CF=0
       E55A                     POP_HL_RET:
0017E1 E55A E1              10      POP HL
0017E2 E55B C9              10      RET
                                
       E55C                     DWTX:
0017E3 E55C 3AA4F0          13      LD  A,(_WTDBF)
0017E6 E55F B7               4      OR  A
0017E7 E560 C8              11      RET Z
0017E8 E561 AF               4      XOR A
0017E9 E562 32A4F0          13      LD  (_WTDBF),A
                                
0017EC E565 E5              11      PUSH    HL
0017ED E566 C5              11      PUSH    BC
0017EE E567 D5              11      PUSH    DE
0017EF E568 3AA5F0          13      LD  A,(_DBDRV)
0017F2 E56B CDD9F0          17      CALL    _CHGDRV
0017F5 E56E 0E00             7  _DBS24: LD  C,0
0017F7 E570 ED5BA6F0        20      LD  DE,(_DBSEC)
0017FB E574 2A7EF1          16      LD  HL,(_DTBUF)
0017FE E577 D42DE8          17      CALL    NC,DWT24
       E57A                     POP_DE_BC_HL_RET2:
001801 E57A 18A4            12      JR  POP_DE_BC_HL_RET
                                
       E57C                     RDFATX:
001803 E57C E5              11      PUSH    HL
001804 E57D 3A88F0          13      LD  A,(_DRV)
001807 E580 21AAF0          10      LD  HL,_FATDRV
00180A E583 AE               7      XOR (HL)
00180B E584 28D4            12      JR  Z,POP_HL_RET
                                
00180D E586 C5              11      PUSH    BC
00180E E587 D5              11      PUSH    DE
00180F E588 DDE5            15      PUSH    IX
001811 E58A CDA6E5          17      CALL    WTFATX
001814 E58D 3813            12      JR  C,POP_IX_DE_BC_HL_RET
                                
001816 E58F AF               4      XOR A
001817 E590 32ABF0          13      LD  (_FATIX),A
00181A E593 3A88F0          13      LD  A,(_DRV)
00181D E596 32AAF0          13      LD  (_FATDRV),A
001820 E599 CDE5F0          17      CALL    _RDFAT
       E59C                     RDFATE2:
001823 E59C 3004            12      JR  NC,POP_IX_DE_BC_HL_RET
001825 E59E 9F               4      SBC A,A     ;A=0xFF
001826 E59F 32AAF0          13      LD  (_FATDRV),A
       E5A2                     POP_IX_DE_BC_HL_RET:
001829 E5A2 DDE1            14      POP IX
00182B E5A4 18D4            12      JR  POP_DE_BC_HL_RET2
                                
       E5A6                     WTFATX:
00182D E5A6 3AA2F0          13      LD  A,(_WTFATF)
001830 E5A9 B7               4      OR  A
001831 E5AA C8              11      RET Z
001832 E5AB E5              11      PUSH    HL
001833 E5AC 3AAAF0          13      LD  A,(_FATDRV)
001836 E5AF 21A5F0          10      LD  HL,_DBDRV
001839 E5B2 AE               7      XOR (HL)
00183A E5B3 CC5CE5          17      CALL    Z,DWTX
00183D E5B6 38A2            12      JR  C,POP_HL_RET
00183F E5B8 C5              11      PUSH    BC
001840 E5B9 D5              11      PUSH    DE
001841 E5BA DDE5            15      PUSH    IX
001843 E5BC CD3AE8          17      CALL    WTFAT
001846 E5BF AF               4      XOR A
001847 E5C0 32A2F0          13      LD  (_WTFATF),A
00184A E5C3 18DD            12      JR  POP_IX_DE_BC_HL_RET
                                
       E5C5                     NCL1:
00184C E5C5 7A               4      LD  A,D
00184D E5C6 B3               4      OR  E
00184E E5C7 37               4      SCF
00184F E5C8 C8              11      RET Z
                                
001850 E5C9 7A               4      LD  A,D
001851 E5CA CB3F             8      SRL A   ;/2
001853 E5CC CB3F             8      SRL A   ;/2
                                
001855 E5CE E5              11      PUSH    HL
001856 E5CF 32EEE5          13      LD  (NCLPAT+2),A    ;_FATIX
001859 E5D2 2AAAF0          16      LD  HL,(_FATDRV)    ;L=_FATDRV H=_FATIX
00185C E5D5 BC               4      CP  H
00185D E5D6 3A88F0          13      LD  A,(_DRV)    ;この間でフラグは変化しない
001860 E5D9 32EDE5          13      LD  (NCLPAT+1),A    ;_FATDRV
001863 E5DC 2005            12      JR  NZ,NCL2     ;FATIXが違う
001865 E5DE BD               4      CP  L
001866 E5DF 2002            12      JR  NZ,NCL2     ;ドライブが違う
001868 E5E1 E1              10      POP HL
001869 E5E2 C9              10      RET
       E5E3                     NCL2:
00186A E5E3 C5              11      PUSH    BC
00186B E5E4 D5              11      PUSH    DE
00186C E5E5 DDE5            15      PUSH    IX
00186E E5E7 CDA6E5          17      CALL    WTFATX
001871 E5EA 38B6            12      JR  C,POP_IX_DE_BC_HL_RET
001873 E5EC 010000          10  NCLPAT: LD  BC,0        ;自己書き換え C=_FATDRV B=_FATIX
001876 E5EF ED43AAF0        20      LD  (_FATDRV),BC
00187A E5F3 CD0FE8          17      CALL    RDFATS
00187D E5F6 18A4            12      JR  RDFATE2
                                
       E5F8                     NCL3:
00187F E5F8 CB9A             8      RES 3,D
001881 E5FA CB92             8      RES 2,D
001883 E5FC 6B               4      LD  L,E
001884 E5FD 62               4      LD  H,D
001885 E5FE CB3C             8      SRL H   ;
001887 E600 CB1D             8      RR  L   ;HLA=HLA/2
001889 E602 1F               4      RRA     ;
00188A E603 F5              11      PUSH    AF
00188B E604 3AABF0          13      LD  A,(_FATIX)
00188E E607 0F               4      RRCA
00188F E608 300B            12      JR  NC,NCL3X1
001891 E60A 3A32E4          13      LD  A,(SECSZ+2)
001894 E60D FE04             7      CP  4       ;1セクタ1024バイトの場合は奇数インデックスの場合に先頭を512バイトずらす
001896 E60F 2004            12      JR  NZ,NCL3X1
001898 E611 010002          10      LD  BC,512
00189B E614 09              11      ADD HL,BC
       E615                     NCL3X1:
00189C E615 F1              10      POP AF
00189D E616 ED4B7CF1        20      LD  BC,(_FATBF)
0018A1 E61A 19              11      ADD HL,DE
0018A2 E61B 09              11      ADD HL,BC
0018A3 E61C 17               4      RLA
0018A4 E61D C9              10      RET
                                
       E61E                     GNCL:
0018A5 E61E CDC5E5          17      CALL    NCL1        ;GET NEXT CLUSTER
0018A8 E621 D8              11      RET C
0018A9 E622 C5              11      PUSH    BC
0018AA E623 E5              11      PUSH    HL
0018AB E624 CDF8E5          17      CALL    NCL3
0018AE E627 3809            12      JR  C,GNC1
0018B0 E629 5E               7      LD  E,(HL)
0018B1 E62A 23               6      INC HL
0018B2 E62B 7E               7      LD  A,(HL)
0018B3 E62C E60F             7      AND 00FH
0018B5 E62E 57               4      LD  D,A
0018B6 E62F E1              10      POP HL
0018B7 E630 C1              10      POP BC
0018B8 E631 C9              10      RET
       E632                     GNC1:
0018B9 E632 7E               7      LD  A,(HL)
0018BA E633 23               6      INC HL
0018BB E634 56               7      LD  D,(HL)
0018BC E635 0604             7      LD  B,4
       E637                     GNC1L:
0018BE E637 CB3A             8      SRL D   ;DA=DA/2
0018C0 E639 1F               4      RRA     ;
0018C1 E63A 10FB            13      DJNZ    GNC1L
                                
0018C3 E63C 5F               4      LD  E,A
0018C4 E63D E1              10      POP HL
0018C5 E63E C1              10      POP BC
0018C6 E63F A7               4      AND A
0018C7 E640 C9              10      RET
                                
       E641                     SNCL:
0018C8 E641 CDC5E5          17      CALL    NCL1
0018CB E644 D8              11      RET C
                                ;               SET NEXT CLUSTER
0018CC E645 E5              11      PUSH    HL
0018CD E646 C5              11      PUSH    BC
0018CE E647 D5              11      PUSH    DE
0018CF E648 E5              11      PUSH    HL
0018D0 E649 CDF8E5          17      CALL    NCL3
0018D3 E64C D1              10      POP DE
                                ;CF=ODD
0018D4 E64D 7E               7      LD  A,(HL)
0018D5 E64E 73               7      LD  (HL),E
0018D6 E64F 3806            12      JR  C,SNC1
                                ;EVEN
                                ;M[0] = E
                                ;M[1] = (M[1] & 0xF0) | (D & 0x0F)
0018D8 E651 23               6      INC HL
0018D9 E652 ED67            18      RRD     ;M={A[3:0],E[3:0]}
0018DB E654 7A               4      LD  A,D
0018DC E655 1804            12      JR  SNC11
       E657                     SNC1:
                                ;ODD
                                ;HL[0] = (HL[0]&0x0F) | (E<<4)
                                ;HL[1] = DE>>4
0018DE E657 ED6F            18      RLD     ;M={D[3:0],E[7:4]}
0018E0 E659 23               6      INC HL
0018E1 E65A 72               7      LD  (HL),D  ;M={D[3:0],E[7:4]}
       E65B                     SNC11:
0018E2 E65B ED6F            18      RLD     ;M={M[7:4],D[3:0]}
0018E4 E65D B7               4      OR  A
0018E5 E65E D1              10      POP DE
0018E6 E65F C1              10      POP BC
0018E7 E660 E1              10      POP HL
       E661                     FAT_CHANGED:
0018E8 E661 3E01             7      LD  A,1
0018EA E663 32A2F0          13      LD  (_WTFATF),A
0018ED E666 C9              10      RET
                                
       E667                     N16CL3:
0018EE E667 C5              11      PUSH    BC
0018EF E668 6B               4      LD  L,E
0018F0 E669 7A               4      LD  A,D
0018F1 E66A E603             7      AND 3
0018F3 E66C 67               4      LD  H,A
0018F4 E66D 29              11      ADD HL,HL
0018F5 E66E ED4B7CF1        20      LD  BC,(_FATBF)
0018F9 E672 09              11      ADD HL,BC
0018FA E673 C1              10      POP BC
0018FB E674 C9              10      RET
                                
       E675                     GNCL16:
0018FC E675 CDC5E5          17      CALL    NCL1        ;GET NEXT CLUSTER for FAT16
0018FF E678 D8              11      RET C
001900 E679 E5              11      PUSH    HL
001901 E67A CD67E6          17      CALL    N16CL3
001904 E67D 5E               7      LD  E,(HL)
001905 E67E 23               6      INC HL
001906 E67F 56               7      LD  D,(HL)
001907 E680 E1              10      POP HL
001908 E681 C9              10      RET
                                
       E682                     SNCL16:
001909 E682 CDC5E5          17      CALL    NCL1        ;GET NEXT CLUSTER for FAT16
00190C E685 D8              11      RET C
00190D E686 D5              11      PUSH    DE
00190E E687 E5              11      PUSH    HL
00190F E688 CD67E6          17      CALL    N16CL3
001912 E68B D1              10      POP DE      ;HL
001913 E68C 73               7      LD  (HL),E
001914 E68D 23               6      INC HL
001915 E68E 72               7      LD  (HL),D
001916 E68F 6B               4      LD  L,E
001917 E690 62               4      LD  H,D
001918 E691 D1              10      POP DE
001919 E692 18CD            12      JR  FAT_CHANGED
                                
                                ;------------------------
                                ;次のセクタを探す際に_SECPSの値をチェック
                                ;in
                                ;   DE : セクタ番号
                                ;out
                                ;   DE : 次のセクタ番号
                                ;note
                                ;
                                ;------------------------
       E694                     NEXTX:
00191B E694 3E00             7  _SECPS: LD  A,0 ;自己書き換え
00191D E696 3C               4      INC A
00191E E697 E600             7  NCPAT:  AND 0   ;自己書き換え　1クラスタの論理セクタ数-1
001920 E699 3295E6          13      LD  (_SECPS+1),A
001923 E69C C9              10      RET
                                
       E69D                     GNCLX:
001924 E69D CD94E6          17      CALL    NEXTX
001927 E6A0 C0              11      RET NZ  ;1クラスタのセクタ未満の場合は戻る
001928 E6A1 C3F7F0          10      JP  _GNCL   ;次のクラスタを探す
                                
       E6A4                     RDFAT:
00192B E6A4 3E80             7      LD  A,080H
00192D E6A6 3270F0          13      LD  (CHECK),A
       E6A9                     RDFAT1:
001930 E6A9 3A88F0          13      LD  A,(_DRV)
001933 E6AC CD64E9          17      CALL    CHGDRVR
001936 E6AF D8              11      RET C
001937 E6B0 DD7E12          19      LD  A,(IX+012H) ;DPB_12_DEVICE
00193A E6B3 CB6F             8      BIT 5,A
00193C E6B5 286B            12      JR  Z,RDFAT0X
00193E E6B7 2170F0          10      LD  HL,CHECK
001941 E6BA A6               7      AND (HL)
001942 E6BB 77               7      LD  (HL),A
001943 E6BC 110000          10      LD  DE,0        ;BPB
001946 E6BF 2A7CF1          16      LD  HL,(_FATBF)
001949 E6C2 CD1BE8          17      CALL    DRD16
00194C E6C5 3024            12      JR  NC,GETBPB
00194E E6C7 2170F0          10      LD  HL,CHECK
001951 E6CA CB06            15      RLC (HL)
001953 E6CC 3F               4      CCF
001954 E6CD D8              11      RET C
001955 E6CE DDCB0A1E        23      RR  (IX+00AH)   ;DPB_0A_FDMODE
001959 E6D2 3F               4      CCF         ;フロッピーディスクのFDモードを切り替える
00195A E6D3 DDCB0A16        23      RL  (IX+00AH)   ;DPB_0A_FDMODE
00195E E6D7 3EFF             7      LD  A,0FFH
001960 E6D9 3289F0          13      LD  (_DSK),A
001963 E6DC 3A84F0          13      LD  A,(_DRIVE)
001966 E6DF E603             7      AND 3
001968 E6E1 F680             7      OR  080H
00196A E6E3 6F               4      LD  L,A
00196B E6E4 26F0             7      LD  H,_CYL0/256
00196D E6E6 3EFF             7      LD  A,0FFH
00196F E6E8 77               7      LD  (HL),A
001970 E6E9 18BE            12      JR  RDFAT1
       E6EB                     GETBPB:
001972 E6EB FDE5            15      PUSH    IY
001974 E6ED FD2A7CF1        20      LD  IY,(_FATBF) ;BPB
001978 E6F1 CDF1F0          17      CALL    _BPB2DPB
00197B E6F4 FDE1            14      POP IY
00197D E6F6 DD7E12          19      LD  A,(IX+012H) ;DPB_12_DEVICE
001980 E6F9 3021            12      JR  NC,GETBPBOK
001982 E6FB E60F             7      AND 00FH
001984 E6FD FE07             7      CP  7
001986 E6FF 37               4      SCF
001987 E700 C0              11      RET NZ
001988 E701 DDCB0A46        20      BIT 0,(IX+00AH) ;DPB_0A_FDMODE
00198C E705 21C0F1          10      LD  HL,M2D
00198F E708 2002            12      JR  NZ,SETFDMODE
001991 E70A 2ED2             7      LD  L,M2HD-STABLE
       E70C                     SETFDMODE:
001993 E70C DDE5            15      PUSH    IX
001995 E70E D1              10      POP DE
001996 E70F EDA0            16      LDI
001998 E711 EDA0            16      LDI
00199A E713 13               6      INC DE
00199B E714 13               6      INC DE
00199C E715 13               6      INC DE
00199D E716 13               6      INC DE
00199E E717 010C00          10      LD  BC,12
0019A1 E71A EDB0                    LDIR
       E71C                     GETBPBOK:
0019A3 E71C 322BE7          13      LD  (DEVSWC),A
0019A6 E71F CDC3E8          17      CALL    CHGDRV2
       E722                     RDFAT0X:
0019A9 E722 CD0FE8          17      CALL    RDFATS
0019AC E725 D8              11      RET C
0019AD E726 DDAE06          19      XOR (IX+6)      ;DPB_06_FATID
0019B0 E729 C8              11      RET Z
0019B1 E72A 3E00             7      LD  A,0     ;DPB_12_DEVICE
       E72B                     DEVSWC  EQU $-1
0019B3 E72C CB6F             8      BIT 5,A
0019B5 E72E C0              11      RET NZ      ;BPBを取得している場合はFATIDをチェックしない
0019B6 E72F 37               4      SCF
0019B7 E730 C9              10      RET
                                
       E731                     BPB2DPB:
0019B8 E731 FD7E0B          19      LD  A,(IY+11)   ;BPB_BytsPerSec
0019BB E734 B7               4      OR  A
0019BC E735 37               4      SCF
0019BD E736 C0              11      RET NZ
       E737                     BPBOK:
0019BE E737 FD7E0D          19      LD  A,(IY+13)   ;BPB_SecPerClus
0019C1 E73A DD7707          19      LD  (IX+7),A    ;DPB_07_SECPCL
                                
0019C4 E73D FD7E16          19      LD  A,(IY+22)   ;BPB_FATSz16
0019C7 E740 DD7700          19      LD  (IX+0),A    ;DPB_00_FATLN
0019CA E743 FD7E17          19      LD  A,(IY+23)   ;BPB_FATSz16
0019CD E746 DD7701          19      LD  (IX+1),A    ;DPB_00_FATLN
                                
0019D0 E749 FD6E0E          19      LD  L,(IY+14)   ;BPB_RsvdSecCnt
0019D3 E74C FD660F          19      LD  H,(IY+15)
0019D6 E74F DD750E          19      LD  (IX+00EH),L ;DPB_0E_FATPS
0019D9 E752 FD5E16          19      LD  E,(IY+22)   ;BPB_FATSz16
0019DC E755 FD5617          19      LD  D,(IY+23)
0019DF E758 FD4610          19      LD  B,(IY+16)   ;BPB_NumFATs
       E75B                     BPBDP1:             ;BPB_FATSz16 * BPB_NumFATs
0019E2 E75B 19              11      ADD HL,DE
0019E3 E75C 10FD            13      DJNZ    BPBDP1
       E75E                     BPBDP2:
0019E5 E75E DD7510          19      LD  (IX+010H),L ;DPB_10_DIRPS
0019E8 E761 DD7411          19      LD  (IX+011H),H
0019EB E764 E5              11      PUSH    HL
                                
0019EC E765 FD6E11          19      LD  L,(IY+17)   ;BPB_RootEntCnt
0019EF E768 FD6612          19      LD  H,(IY+18)
0019F2 E76B FD7E0C          19      LD  A,(IY+12)   ;BPB_BytsPerSec
0019F5 E76E B7               4      OR  A
0019F6 E76F 37               4      SCF
0019F7 E770 C8              11      RET Z
0019F8 E771 0606             7      LD  B,6
       E773                     BPBBPS1:
0019FA E773 05               4      DEC B
0019FB E774 0F               4      RRCA
0019FC E775 30FC            12      JR  NC,BPBBPS1
       E777                     BPBDE1:
0019FE E777 29              11      ADD HL,HL
0019FF E778 10FD            13      DJNZ    BPBDE1
                                
001A01 E77A 7C               4      LD  A,H
001A02 E77B DD770B          19      LD  (IX+00BH),A ;DPB_0B_DIRSCNT
                                
001A05 E77E D1              10      POP DE      ;DPB_10_DIRPS
001A06 E77F 6C               4      LD  L,H
001A07 E780 2600             7      LD  H,0
001A09 E782 19              11      ADD HL,DE       ;MAXDIR
001A0A E783 E5              11      PUSH    HL
001A0B E784 FD4E0D          19      LD  C,(IY+13)   ;BPB_SecPerClus
001A0E E787 CB21             8      SLA C       ;*2
001A10 E789 AF               4      XOR A
001A11 E78A 47               4      LD  B,A
001A12 E78B ED42            15      SBC HL,BC
001A14 E78D DD7514          19      LD  (IX+014H),L ;DPB_14_ADDCL16
001A17 E790 DD7415          19      LD  (IX+015H),H
                                
001A1A E793 D1              10      POP DE      ;DE=DPB_0B_MAXDIR
001A1B E794 FD6E13          19      LD  L,(IY+19)   ;BPB_TotSec16
001A1E E797 FD6614          19      LD  H,(IY+20)
                                
001A21 E79A DD7E12          19      LD  A,(IX+012H) ;DPB_12_DEVICE
001A24 E79D E60F             7      AND 00FH
001A26 E79F FE07             7      CP  7       ;フロッピー
001A28 E7A1 2019            12      JR  NZ,NOT_FD
001A2A E7A3 E5              11      PUSH    HL
001A2B E7A4 FD4E18          19      LD  C,(IY+24)   ;BPB_SecPerTr
001A2E E7A7 DD710D          19      LD  (IX+00DH),C ;DPB_0D_MAXSEC
001A31 E7AA AF               4      XOR A
001A32 E7AB CB21             8      SLA C       ;両面なのでセクタ数を２倍
001A34 E7AD 0610             7      LD  B,16
       E7AF                     DIVSEC:             ;MAXCYL = BPB_TotSec16 / (BPB_SecPerTr * 2)
001A36 E7AF 29              11      ADD HL,HL
001A37 E7B0 17               4      RLA
001A38 E7B1 B9               4      CP  C
001A39 E7B2 3802            12      JR  C,DIVSEC1
001A3B E7B4 91               4      SUB C
001A3C E7B5 2C               4      INC L
       E7B6                     DIVSEC1:
001A3D E7B6 10F7            13      DJNZ    DIVSEC
001A3F E7B8 DD750C          19      LD  (IX+00CH),L ;DPB_0C_MAXCYL
001A42 E7BB E1              10      POP HL  ;ここまでフロッピー専用
       E7BC                     NOT_FD:
001A43 E7BC 7C               4      LD  A,H
001A44 E7BD B5               4      OR  L
001A45 E7BE 3E00             7      LD  A,0     ;LDでフラグは変化しない。BPB_TotSec16を AHL で扱う為、Aに0を入れる
001A47 E7C0 2010            12      JR  NZ,BPB16BIT ;BPB_TotSec16が「0」の場合はBPB_TotSec32で計算
001A49 E7C2 FD7E23          19      LD  A,(IY+35)   ;念のために総セクタ数が24ビットを超える場合はエラーを返す
001A4C E7C5 B7               4      OR  A
001A4D E7C6 37               4      SCF
001A4E E7C7 C0              11      RET NZ
001A4F E7C8 FD6E20          19      LD  L,(IY+32)   ;BPB_TotSec32 は AHL の24ビットで扱う
001A52 E7CB FD6621          19      LD  H,(IY+33)   ;1クラスタの論理セクタ数(DPB_07_SECPCL)が最大128なので
001A55 E7CE FD7E22          19      LD  A,(IY+34)   ;24ビットを超えると必ずクラスタ数が16ビットを超えてしまうのでこれで十分
001A58 E7D1 A7               4      AND A       ;CF=0
       E7D2                     BPB16BIT:
001A59 E7D2 ED52            15      SBC HL,DE
001A5B E7D4 DE00             7      SBC A,0
001A5D E7D6 FD460D          19      LD  B,(IY+13)   ;BPB_SecPerClus
       E7D9                     BPBTC1:             ;総クラスタ数(AHL) = 総セクタ数(AHL) / セクタサイズ(B)
001A60 E7D9 CB18             8      RR  B       ;->CY
001A62 E7DB 3808            12      JR  C,BPBTC2
001A64 E7DD CB3F             8      SRL A
001A66 E7DF CB1C             8      RR  H       ;AHL=AHL/2
001A68 E7E1 CB1D             8      RR  L
001A6A E7E3 18F4            12      JR  BPBTC1
       E7E5                     BPBTC2:
001A6C E7E5 B7               4      OR  A
001A6D E7E6 37               4      SCF
001A6E E7E7 C0              11      RET NZ      ;念のため(クラスタ数が16ビットを超える場合)
001A6F E7E8 23               6      INC HL
001A70 E7E9 23               6      INC HL
001A71 E7EA DD7508          19      LD  (IX+8),L    ;DPB_08_MAXCL
001A74 E7ED DD7409          19      LD  (IX+9),H
                                
001A77 E7F0 FD7E15          19      LD  A,(IY+21)   ;BPB_Media
001A7A E7F3 DD7706          19      LD  (IX+6),A    ;DPB_06_FATID
                                
001A7D E7F6 FD7E10          19      LD  A,(IY+16)   ;BPB_NumFATs
001A80 E7F9 C6FE             7      ADD A,0-2       ;>2:CF=1
001A82 E7FB FD7E0C          19      LD  A,(IY+12)   ;BPB_BytsPerSec
001A85 E7FE 6F               4      LD  L,A
001A86 E7FF 3002            12      JR  NC,BPBFAT1
001A88 E801 F680             7      OR  080H
       E803                     BPBFAT1:
001A8A E803 DD770F          19      LD  (IX+00FH),A ;DPB_0F_BPS
001A8D E806 2D               4      DEC L       ;以下のセクタサイズに合致しない場合はCF=1でエラーにする
001A8E E807 C8              11      RET Z       ;1セクタ256バイト
001A8F E808 2D               4      DEC L
001A90 E809 C8              11      RET Z       ;1セクタ512バイト
001A91 E80A 2D               4      DEC L
001A92 E80B 2D               4      DEC L
001A93 E80C C8              11      RET Z       ;1セクタ1024バイト
001A94 E80D 37               4      SCF
001A95 E80E C9              10      RET
                                
       E80F                     RDFATS:
001A96 E80F CD55E8          17      CALL    FATSETUP
001A99 E812 D8              11      RET C
001A9A E813 CD1FE8          17      CALL    DRD24B
001A9D E816 2A7CF1          16      LD  HL,(_FATBF)
001AA0 E819 7E               7      LD  A,(HL)
001AA1 E81A C9              10      RET
                                
       E81B                     DRD16:
001AA2 E81B 0E00             7      LD  C,0
       E81D                     DRD24:
001AA4 E81D 0601             7      LD  B,1
       E81F                     DRD24B:
001AA6 E81F DDE5            15      PUSH    IX
001AA8 E821 DD2AA8F0        20      LD  IX,(_DPB)
001AAC E825 CDAEEA          17  DRDPAT: CALL    FDRD        ;自己書き換え（ディスク読み込み）
       E828                     POP_IX_RET:
001AAF E828 DDE1            14      POP IX
001AB1 E82A C9              10      RET
                                
       E82B                     DWT16:
001AB2 E82B 0E00             7      LD  C,0
       E82D                     DWT24:
001AB4 E82D 0601             7      LD  B,1
       E82F                     DWT24B:
001AB6 E82F DDE5            15      PUSH    IX
001AB8 E831 DD2AA8F0        20      LD  IX,(_DPB)
001ABC E835 CD54EA          17  DWTPAT: CALL    FDWT        ;自己書き換え（ディスク書き込み）
001ABF E838 18EE            12      JR  POP_IX_RET
                                
       E83A                     WTFAT:
001AC1 E83A CD55E8          17      CALL    FATSETUP
001AC4 E83D D42FE8          17      CALL    NC,DWT24B
001AC7 E840 D8              11      RET C
001AC8 E841 DDCB0F7E        20      BIT 7,(IX+00FH) ;DPB_0F_BPS
001ACC E845 C8              11      RET Z       ;予備FATが無い
001ACD E846 CD5CE8          17      CALL    FATS2
001AD0 E849 E5              11      PUSH    HL      ;予備FAT
001AD1 E84A DD6E00          19      LD  L,(IX+0)    ;DPB_00_FATLN
001AD4 E84D DD6601          19      LD  H,(IX+1)
001AD7 E850 19              11      ADD HL,DE
001AD8 E851 EB               4      EX  DE,HL
001AD9 E852 E1              10      POP HL
001ADA E853 18DA            12      JR  DWT24B
                                ;------------------------
                                ;FATのセットアップ
                                ;out
                                ;   B  : FATセクタ数
                                ;   DE : FAT先頭セクタ番号
                                ;   HL : FATバッファポインタ
                                ;   CF : 1=ドライブ切り替えエラー
                                ;note
                                ;   FATサイズがFATバッファを超える場合は
                                ;   対象クラスタ領域==(_FATIX)によって
                                ;   FAT12:対象クラスタ1024毎に1.5KBを切り替える
                                ;   FAT16:対象クラスタ1024毎に2KBを切り替える
                                ;------------------------
       E855                     FATSETUP:
001ADC E855 3AAAF0          13      LD  A,(_FATDRV)
001ADF E858 CD64E9          17      CALL    CHGDRVR     ;ドライブ切り替え
001AE2 E85B D8              11      RET C
       E85C                     FATS2:
001AE3 E85C DD7E0F          19      LD  A,(IX+00FH) ;DPB_0F_BPS 512=2 1024=4
001AE6 E85F 0F               4      RRCA
001AE7 E860 CD89E8          17  FATSX:  CALL    FATSETUP12  ;自己書き換え
001AEA E863 210000          10      LD  HL,0
001AED E866 4A               4      LD  C,D
001AEE E867 54               4      LD  D,H
001AEF E868 3AABF0          13      LD  A,(_FATIX)  ;範囲FAT12:0-3/FAT16:0-63(0-03FH):65535*2/2048
001AF2 E86B 47               4      LD  B,A
001AF3 E86C 04               4      INC B
001AF4 E86D DD7E00          19      LD  A,(IX+0)    ;DPB_00_FATLN
       E870                     FAT_SKP:
001AF7 E870 05               4      DEC B
001AF8 E871 2805            12      JR  Z,FAT1
001AFA E873 19              11      ADD HL,DE
001AFB E874 93               4      SUB E
001AFC E875 30F9            12      JR  NC,FAT_SKP
001AFE E877 C9              10      RET
       E878                     FAT1:
001AFF E878 EB               4      EX  DE,HL
001B00 E879 B9               4      CP  C       ;C=FATバッファに読み込めるセクタ数
001B01 E87A 3801            12      JR  C,FAT2
001B03 E87C 79               4      LD  A,C
       E87D                     FAT2:
001B04 E87D 47               4      LD  B,A
                                
001B05 E87E 2AFAF1          16      LD  HL,(_FATPS) ;fat sector pos
001B08 E881 19              11      ADD HL,DE
001B09 E882 EB               4      EX  DE,HL
001B0A E883 2A7CF1          16      LD  HL,(_FATBF)
001B0D E886 AF               4      XOR A       ;CF=0
001B0E E887 4F               4      LD  C,A
001B0F E888 C9              10      RET
                                ;
                                ;   FATバッファに読み込める最大のセクタ数と_FATIXで進めるセクタ数
                                ;   FATSETUP* (FAT12/FAT16)
                                ;out
                                ;   D : FATバッファに読み込める最大のセクタ数
                                ;   E : _FATIXで進めるセクタ数
       E889                     FATSETUP12:
001B10 E889 110606          10      LD  DE,0606H    ;256
001B13 E88C D8              11      RET C
001B14 E88D 110303          10      LD  DE,0303H    ;512
001B17 E890 0F               4      RRCA
001B18 E891 D8              11      RET C
001B19 E892 110102          10      LD  DE,0201H    ;1024
001B1C E895 C9              10      RET
                                
       E896                     FATSETUP16:
001B1D E896 110808          10      LD  DE,0808H    ;256
001B20 E899 D8              11      RET C
001B21 E89A 110404          10      LD  DE,0404H
001B24 E89D 0F               4      RRCA            ;512
001B25 E89E D8              11      RET C
001B26 E89F 110202          10      LD  DE,0202H    ;1024
001B29 E8A2 C9              10      RET
                                
       E8A3                     CHGDRV:
001B2A E8A3 E5              11      PUSH    HL
001B2B E8A4 2189F0          10      LD  HL,_DSK
001B2E E8A7 BE               7      CP  (HL)
001B2F E8A8 280A            12      JR  Z,CHGDRVE
       E8AA                     CHGDRV1:
001B31 E8AA DDE5            15      PUSH    IX
001B33 E8AC CDB6E8          17      CALL    CHGDRV0
001B36 E8AF 3A89F0          13      LD  A,(_DSK)
001B39 E8B2 DDE1            14      POP IX
       E8B4                     CHGDRVE:
001B3B E8B4 E1              10      POP HL
001B3C E8B5 C9              10      RET
                                
       E8B6                     CHGDRV0:
001B3D E8B6 6F               4      LD  L,A
001B3E E8B7 CDDCF0          17      CALL    _GETDPB
001B41 E8BA D8              11      RET C
001B42 E8BB DD22A8F0        20      LD  (_DPB),IX
001B46 E8BF 7D               4      LD  A,L
001B47 E8C0 3289F0          13      LD  (_DSK),A
       E8C3                     CHGDRV2:
001B4A E8C3 C5              11      PUSH    BC
001B4B E8C4 D5              11      PUSH    DE
001B4C E8C5 ED731AE9        20      LD  (SPPAT2+1),SP
001B50 E8C9 F3               4      DI
001B51 E8CA DDF9            10      LD  SP,IX
                                
001B53 E8CC E1              10      POP HL      ;DPB_00_FATLN
001B54 E8CD E1              10      POP HL      ;DPB_02_DRD
001B55 E8CE 2226E8          16      LD  (DRDPAT+1),HL
                                
001B58 E8D1 E1              10      POP HL
001B59 E8D2 2236E8          16      LD  (DWTPAT+1),HL   ;DPB_04_DWT
                                
001B5C E8D5 E1              10      POP HL      ;L=DPB_06_FATID H=DPB_07_SECPCL
001B5D E8D6 7C               4      LD  A,H
001B5E E8D7 3222DF          13      LD  (SPCPAT+1),A    ;1クラスタの論理セクタ数
001B61 E8DA 3D               4      DEC A
001B62 E8DB 3298E6          13      LD  (NCPAT+1),A
                                
001B65 E8DE E1              10      POP HL      ;DPB_08_MAXCL
001B66 E8DF 7D               4      LD  A,L
001B67 E8E0 3241DF          13      LD  (CLPAT2+1),A
001B6A E8E3 7C               4      LD  A,H
001B6B E8E4 323DDF          13      LD  (CLPAT1+1),A
001B6E E8E7 2B               6      DEC HL
001B6F E8E8 2249E1          16      LD  (MAXCLP+1),HL
                                
001B72 E8EB E1              10      POP HL      ;L=DPB_0A_FDMODE H=DPB_0B_DIRSCNT
001B73 E8EC 7D               4      LD  A,L
001B74 E8ED F6FE             7      OR  0FEH
001B76 E8EF 32B3F0          13      LD  (FDMODE+1),A
001B79 E8F2 07               4      RLCA
001B7A E8F3 E603             7      AND 3
001B7C E8F5 32F1E9          13      LD  (FSPAT+1),A
001B7F E8F8 4C               4      LD  C,H
                                
001B80 E8F9 E1              10      POP HL      ;L=DPB_0C_MAXCYL H=DPB_0D_MAXSEC
                                
001B81 E8FA E1              10      POP HL      ;L=DPB_0E_FATPS H=DPB_0F_BPS
001B82 E8FB 7C               4      LD  A,H     ;DPB_0F_BPS
001B83 E8FC E607             7      AND 7
001B85 E8FE 3232E4          13      LD  (SECSZ+2),A ;1セクタのサイズの上位1バイト 0x400 - 0x200 - 0x100
                                                ;1セクタ512 2D/2DD/2HC/2HQ(2HD1.44MB)/EMM/BRAM/EMEM等
                                                ;1セクタ1024 2HD/2HDE98
                                                ;1セクタ256 GRAM/RAMF/CMOS/等
                                                ;1024   512 256
                                                ;4  2   1
001B88 E901 87               4      ADD A,A     ;8  4   2
001B89 E902 87               4      ADD A,A     ;010H   8   4
001B8A E903 87               4      ADD A,A     ;020H   010H    8
001B8B E904 329EDD          13      LD  (SDECPAT+1),A   ;1セクタ辺りのディレクトリエントリ数
                                
001B8E E907 2600             7      LD  H,0
001B90 E909 22FAF1          16      LD  (_FATPS),HL
                                
001B93 E90C E1              10      POP HL      ;DPB_10_DIRPS
001B94 E90D 22FCF1          16      LD  (_DIRPS),HL
                                
001B97 E910 E1              10      POP HL      ;L=DPB_12_DEVICE H=DPB_13_UNITNO
001B98 E911 7C               4      LD  A,H
001B99 E912 3284F0          13      LD  (_DRIVE),A
                                
001B9C E915 E1              10      POP HL      ;DPB_14_ADDCL16
001B9D E916 2232DF          16      LD  (CLSPAT+1),HL
                                
001BA0 E919 310000          10  SPPAT2: LD  SP,0        ;元のSPを復元
001BA3 E91C FB               4      EI
001BA4 E91D 2AFCF1          16      LD  HL,(_DIRPS)
001BA7 E920 0600             7      LD  B,0
001BA9 E922 09              11      ADD HL,BC       ;C=DPB_0B_DIRSCNT
001BAA E923 22B9DD          16      LD  (MD_PAT+1),HL
                                
001BAD E926 2A49E1          16      LD  HL,(MAXCLP+1);
001BB0 E929 11F60F          10      LD  DE,4086     ;クラスタ数が4086未満:FAT12 4086以上:FAT16
001BB3 E92C ED52            15      SBC HL,DE       ;CF=0のはず
001BB5 E92E 300F            12      JR  NC,SETFAT16
001BB7 E930 211EE6          10      LD  HL,GNCL     ;FAT12
001BBA E933 1141E6          10      LD  DE,SNCL
001BBD E936 0189E8          10      LD  BC,FATSETUP12
001BC0 E939 DDCB0FAE        23      RES 5,(IX+00FH) ;DPB_0F_BPS(FAT12)
001BC4 E93D 180D            12      JR  EXTRA1
       E93F                     SETFAT16:
001BC6 E93F 2175E6          10      LD  HL,GNCL16   ;FAT16
001BC9 E942 1182E6          10      LD  DE,SNCL16
001BCC E945 0196E8          10      LD  BC,FATSETUP16
001BCF E948 DDCB0FEE        23      SET 5,(IX+00FH) ;DPB_0F_BPS(FAT16)
       E94C                     EXTRA1:
001BD3 E94C 22F8F0          16      LD  (GNCPAT+1),HL
001BD6 E94F ED53FBF0        20      LD  (SNCPAT+1),DE
001BDA E953 ED4361E8        20      LD  (FATSX+1),BC
001BDE E957 D1              10      POP DE
001BDF E958 C1              10      POP BC
001BE0 E959 AF               4      XOR A
001BE1 E95A C9              10      RET
                                
       E95B                     GETDPBD:
001BE2 E95B DDE3            23      EX  (SP),IX
001BE4 E95D DDE5            15      PUSH    IX
001BE6 E95F 3A88F0          13      LD  A,(_DRV)
001BE9 E962 1807            12      JR  GETDPB1
                                
       E964                     CHGDRVR:
001BEB E964 CDD9F0          17      CALL    _CHGDRV
001BEE E967 D8              11      RET C
001BEF E968 3A89F0          13      LD  A,(_DSK)
       E96B                     GETDPB1:
001BF2 E96B C3DCF0          10      JP  _GETDPB
                                
       E96E                     GETDPB:
001BF5 E96E FE08             7      CP  8
001BF7 E970 3F               4      CCF
001BF8 E971 D8              11      RET C
001BF9 E972 0F               4      RRCA
001BFA E973 0F               4      RRCA
001BFB E974 0F               4      RRCA
001BFC E975 DD                      DB  0DDH        ;Z80未定義命令
001BFD E976 6F               4      LD  L,A     ;LD IXL,A
001BFE E977 DD                      DB  0DDH        ;Z80未定義命令
001BFF E978 26F2             7      LD  H,DEVICE/256    ;LD IXH,DEVICE/256
001C01 E97A DD7E00          19      LD  A,(IX+0)    ;DPB_00_FATLN
001C04 E97D A7               4      AND A       ;CF=0の為
001C05 E97E DDCB0F6E        20      BIT 5,(IX+00FH) ;DPB_0F_BPS
001C09 E982 C0              11      RET NZ      ;FAT16
001C0A E983 DDCB126E        20      BIT 5,(IX+012H) ;DPB_12_DEVICE
001C0E E987 C0              11      RET NZ      ;BPB
001C0F E988 FE01             7      CP  001H        ;A=0 THEN CF=1
001C11 E98A C9              10      RET
                                
       E98B                     _SYS5F:
001C12 E98B AF               4      XOR A
       E98C                     FFLUSH:
001C13 E98C F5              11      PUSH    AF
001C14 E98D 3EFF             7      LD  A,0FFH
001C16 E98F 3239F0          13      LD  (SFILE),A
001C19 E992 CD5CE5          17      CALL    DWTX
001C1C E995 3EFF             7      LD  A,0FFH
001C1E E997 32A5F0          13      LD  (_DBDRV),A
001C21 E99A CDA6E5          17      CALL    WTFATX
001C24 E99D AF               4      XOR A
001C25 E99E 32ABF0          13      LD  (_FATIX),A
001C28 E9A1 2F               4      CPL         ;0FFH
001C29 E9A2 32AAF0          13      LD  (_FATDRV),A
001C2C E9A5 F1              10      POP AF
001C2D E9A6 C9              10      RET
                                
[EOF:LDDIO.ASM:SHIFT_JIS]
                                    INCLUDE "M7DISK.ASM"
                                
                                ;   LSX-Dodgers DISK
                                ;   MZ-700/1500
                                
       E9A7                     SEEK:
001C2E E9A7 0610             7      LD  B,16
001C30 E9A9 DD4E0D          19  MAXSEC: LD  C,(IX+0DH)  ;DPB_0D_MAXSEC
001C33 E9AC AF               4      XOR A
001C34 E9AD EB               4      EX  DE,HL
       E9AE                     DIV1:
001C35 E9AE 29              11      ADD HL,HL
001C36 E9AF 8F               4      ADC A,A
001C37 E9B0 B9               4      CP  C
001C38 E9B1 3802            12      JR  C,DIV2
001C3A E9B3 91               4      SUB C
001C3B E9B4 2C               4      INC L
       E9B5                     DIV2:
001C3C E9B5 10F7            13      DJNZ    DIV1
                                
001C3E E9B7 3C               4      INC A   ;最小のセクタは１固定
001C3F E9B8 55               4      LD  D,L ;TRACK
001C40 E9B9 5F               4      LD  E,A ;SECTOR
                                
001C41 E9BA 3A84F0          13      LD  A,(_DRIVE)
001C44 E9BD FE04             7      CP  4
001C46 E9BF 3F               4      CCF
001C47 E9C0 D8              11      RET C
001C48 E9C1 F684             7      OR  084H        ;Motor on + ドライブセレクト有効
001C4A E9C3 D3DC            11      OUT (0DCH),A
001C4C E9C5 CB3A             8      SRL D       ;CYLINDER
001C4E E9C7 9F               4      SBC A,A
001C4F E9C8 D3DD            11      OUT (0DDH),A    ;SIDE
                                
001C51 E9CA CD07EA          17      CALL    SETMODE
001C54 E9CD D8              11      RET C
                                
001C55 E9CE CD3EEA          17      CALL    DRIVE
001C58 E9D1 FEFF             7      CP  0FFH        ;A=0FFH Unknown CYLINDER
001C5A E9D3 CC23EA          17      CALL    Z,FDCRES    ;Restore
001C5D E9D6 2F               4      CPL         ;データバスが負論理
001C5E E9D7 D3D9            11      OUT (0D9H),A    ;Currrent CYLINDER
001C60 E9D9 2F               4      CPL         ;データバスが負論理
001C61 E9DA 92               4      SUB D
001C62 E9DB C8              11      RET Z       ;No seek
                                
001C63 E9DC 3A86F0          13      LD  A,(_ISEEK)
001C66 E9DF 4F               4      LD  C,A
                                
001C67 E9E0 DD7E0C          19      LD  A,(IX+00CH) ;DPB_0C_MAXCYL
001C6A E9E3 3D               4      DEC A
001C6B E9E4 BA               4      CP  D       ;Over CYLINDER
001C6C E9E5 D8              11      RET C
                                
001C6D E9E6 7A               4      LD  A,D
001C6E E9E7 2F               4      CPL         ;データバスが負論理
001C6F E9E8 D3DB            11      OUT (0DBH),A
001C71 E9EA 72               7      LD  (HL),D
                                
001C72 E9EB 0E18             7      LD  C,018H      ;Seek
       E9ED                     FDCCMD2:
001C74 E9ED 3A85F0          13      LD  A,(_SEEKSP)
001C77 E9F0 E6FF             7  FSPAT:  AND 0FFH
001C79 E9F2 B1               4      OR  C
                                
       E9F3                     FDCCMD:
001C7A E9F3 CD35EA          17      CALL    COMSET
       E9F7                     FDCSMC  EQU $+1
001C7D E9F6 3E80             7      LD  A,080H      ;FDC COMMAND(Self-modifying code)
001C7F E9F8 E620             7      AND 020H        ;Write data Write track
001C81 E9FA 3C               4      INC A
                                
       E9FB                     SST:
001C82 E9FB 0E00             7      LD  C,0
       E9FD                     SST1:
001C84 E9FD 0D               4      DEC C       ; 4
001C85 E9FE 20FD            12      JR  NZ,SST1     ;12 * 256 / 4 = About 1ms
001C87 EA00 3D               4      DEC A
001C88 EA01 20FA            12      JR  NZ,SST1
                                
001C8A EA03 3C               4      INC A       ;A=1
001C8B EA04 CD0CEA          17      CALL    READY
       EA07                     SETMODE:
001C8E EA07 CD38EA          17      CALL    DELAY0      ;Head select time
001C91 EA0A 3E81             7      LD  A,081H
       EA0C                     READY:
001C93 EA0C 3216EA          13      LD  (WAITA),A
001C96 EA0F E5              11      PUSH    HL
001C97 EA10 26F8             7      LD  H,0F8H
       EA12                     READY2:
001C99 EA12 DBD8            11      IN  A,(0D8H)
001C9B EA14 2F               4      CPL         ;データバスが負論理
       EA16                     WAITA   EQU $+1
001C9C EA15 E681             7      AND 081H        ;NOT READY,BUSY
001C9E EA17 2808            12      JR  Z,READYE
001CA0 EA19 E3              19      EX  (SP),HL     ;wait 19clock
001CA1 EA1A E3              19      EX  (SP),HL     ; //
001CA2 EA1B 2B               6      DEC HL
001CA3 EA1C 7C               4      LD  A,H
001CA4 EA1D B5               4      OR  L
001CA5 EA1E 20F2            12      JR  NZ,READY2
001CA7 EA20 37               4      SCF
       EA21                     READYE:
001CA8 EA21 E1              10      POP HL
001CA9 EA22 C9              10      RET
                                
       EA23                     FDCRES:
001CAA EA23 3600            10      LD  (HL),0
001CAC EA25 0E08             7      LD  C,8
001CAE EA27 18C4            12      JR  FDCCMD2
                                
       EA29                     FDMOFF:
001CB0 EA29 F5              11      PUSH    AF
001CB1 EA2A AF               4      XOR A       ;Motor off(ドライブセレクト無効)
001CB2 EA2B D3DC            11      OUT (0DCH),A
001CB4 EA2D F1              10      POP AF
001CB5 EA2E C9              10      RET
                                
       EA2F                     SECSET:
001CB6 EA2F F5              11      PUSH    AF
001CB7 EA30 7B               4      LD  A,E
001CB8 EA31 2F               4      CPL         ;データバスが負論理
001CB9 EA32 D3DA            11      OUT (0DAH),A
001CBB EA34 F1              10      POP AF
       EA35                     COMSET:
001CBC EA35 2F               4      CPL         ;データバスが負論理
001CBD EA36 D3D8            11      OUT (0D8H),A
       EA38                     DELAY0:
001CBF EA38 3E1A             7      LD  A,26
       EA3A                     DELAY:
001CC1 EA3A 3D               4      DEC A
001CC2 EA3B 20FD            12      JR  NZ,DELAY
001CC4 EA3D C9              10      RET
                                
       EA3E                     DRIVE:
001CC5 EA3E 2A84F0          16      LD  HL,(_DRIVE)
001CC8 EA41 26F0             7      LD  H,_CYL0/256
001CCA EA43 CBFD             8      SET 7,L
001CCC EA45 7E               7      LD  A,(HL)
001CCD EA46 C9              10      RET
                                
       EA47                     RNF:
001CCE EA47 CD3EEA          17      CALL    DRIVE
001CD1 EA4A 36FF            10      LD  (HL),0FFH
001CD3 EA4C C9              10      RET
                                
001CD4 EA4D 02                  RETRY:  DB  2
                                
                                
                                ;   FLOPPY DISK DRIVER
                                
       EA4E                     WTTRK:
001CD5 EA4E 0601             7      LD  B,1
001CD7 EA50 3EF4             7      LD  A,0F4H
001CD9 EA52 1802            12      JR  WTTRK1
       EA54                     FDWT:
001CDB EA54 3EA0             7      LD  A,0A0H
       EA56                     WTTRK1:
001CDD EA56 32F7E9          13      LD  (FDCSMC),A
       EA59                     DWTBL:
001CE0 EA59 78               4      LD  A,B
001CE1 EA5A 3299EA          13      LD  (WTBSMC),A
001CE4 EA5D 3E02             7      LD  A,2     ;Retry count
001CE6 EA5F 324DEA          13      LD  (RETRY),A
                                
       EA62                     DWT0:
001CE9 EA62 D5              11      PUSH    DE
001CEA EA63 E5              11      PUSH    HL
001CEB EA64 CDA7E9          17      CALL    SEEK        ;Write disk
001CEE EA67 E1              10      POP HL
001CEF EA68 383A            12      JR  C,ERRDW
001CF1 EA6A F3               4      DI
001CF2 EA6B 3AF7E9          13      LD  A,(FDCSMC)
001CF5 EA6E CD2FEA          17      CALL    SECSET
001CF8 EA71 0EDB             7      LD  C,0DBH
       EA73                     DWT1:
001CFA EA73 7E               7      LD  A,(HL)
001CFB EA74 2F               4      CPL         ;データバスが負論理
001CFC EA75 57               4      LD  D,A
                                
       EA76                     DWT2:
001CFD EA76 DBD8            11      IN  A,(0D8H)
001CFF EA78 2F               4      CPL         ;データバスが負論理
001D00 EA79 0F               4      RRCA
001D01 EA7A 3008            12      JR  NC,DWT4
001D03 EA7C 0F               4      RRCA
001D04 EA7D 30F7            12      JR  NC,DWT2
       EA7F                     DWT3:
001D06 EA7F ED51            12      OUT (C),D
001D08 EA81 23               6      INC HL
001D09 EA82 18EF            12      JR  DWT1
                                
       EA84                     DWT4:
001D0B EA84 3D               4      DEC A
001D0C EA85 28F8            12      JR  Z,DWT3
001D0E EA87 3C               4      INC A
001D0F EA88 FB               4      EI
001D10 EA89 D1              10      POP DE
001D11 EA8A 13               6      INC DE
001D12 EA8B CD29EA          17      CALL    FDMOFF
001D15 EA8E 2808            12      JR  Z,DISKOK_WT
001D17 EA90 CDFBEA          17      CALL    DISKC
001D1A EA93 20CD            12      JR  NZ,DWT0
001D1C EA95 B7               4      OR  A
001D1D EA96 2005            12      JR  NZ,ERRW
                                
       EA98                     DISKOK_WT:
       EA99                     WTBSMC  EQU $+1
001D1F EA98 0601             7      LD  B,1
001D21 EA9A 10BD            13      DJNZ    DWTBL
001D23 EA9C C9              10      RET
                                
       EA9D                     ERRW:
001D24 EA9D 3EFF             7      LD  A,0FFH
       EA9F                     ERRZ:
001D26 EA9F BF               4      CP  A
001D27 EAA0 37               4      SCF
001D28 EAA1 C329EA          10      JP  FDMOFF
                                
       EAA4                     ERRDW:
001D2B EAA4 D1              10      POP DE
001D2C EAA5 CD0CEB          17      CALL    DELP
001D2F EAA8 20B8            12      JR  NZ,DWT0
001D31 EAAA B7               4      OR  A
001D32 EAAB 20F0            12      JR  NZ,ERRW
001D34 EAAD C9              10      RET
                                
       EAAE                     FDRD:
001D35 EAAE 3E80             7      LD  A,080H
001D37 EAB0 32F7E9          13      LD  (FDCSMC),A
       EAB3                     DRDBL:
001D3A EAB3 78               4      LD  A,B
001D3B EAB4 32EDEA          13      LD  (RDBSMC),A
001D3E EAB7 3E02             7      LD  A,2     ;Retry count
001D40 EAB9 324DEA          13      LD  (RETRY),A
       EABC                     DRD0:
001D43 EABC D5              11      PUSH    DE
001D44 EABD E5              11      PUSH    HL
001D45 EABE CDA7E9          17      CALL    SEEK        ;Read disk
001D48 EAC1 E1              10      POP HL
001D49 EAC2 382D            12      JR  C,ERRDR
001D4B EAC4 F3               4      DI
001D4C EAC5 3AF7E9          13      LD  A,(FDCSMC)
001D4F EAC8 CD2FEA          17      CALL    SECSET
       EACB                     DRD1:
001D52 EACB DBD8            11      IN  A,(0D8H)
001D54 EACD 2F               4      CPL         ;データバスが負論理
001D55 EACE 0F               4      RRCA
001D56 EACF 300A            12      JR  NC,DRD3
001D58 EAD1 0F               4      RRCA
001D59 EAD2 30F7            12      JR  NC,DRD1
001D5B EAD4 DBDB            11      IN  A,(0DBH)
001D5D EAD6 2F               4      CPL         ;データバスが負論理
001D5E EAD7 77               7      LD  (HL),A
001D5F EAD8 23               6      INC HL
001D60 EAD9 18F0            12      JR  DRD1
                                
       EADB                     DRD3:
001D62 EADB B7               4      OR  A
001D63 EADC FB               4      EI
001D64 EADD D1              10      POP DE
001D65 EADE 13               6      INC DE
001D66 EADF CD29EA          17      CALL    FDMOFF
001D69 EAE2 2808            12      JR  Z,DISKOK_RD
001D6B EAE4 CDFBEA          17      CALL    DISKC
001D6E EAE7 20D3            12      JR  NZ,DRD0
001D70 EAE9 B7               4      OR  A
001D71 EAEA 20B1            12      JR  NZ,ERRW
                                
       EAEC                     DISKOK_RD:
       EAED                     RDBSMC  EQU $+1
001D73 EAEC 0601             7      LD  B,1
001D75 EAEE 10C3            13      DJNZ    DRDBL
001D77 EAF0 C9              10      RET
                                
       EAF1                     ERRDR:
001D78 EAF1 D1              10      POP DE
001D79 EAF2 CD0CEB          17      CALL    DELP
001D7C EAF5 20C5            12      JR  NZ,DRD0
001D7E EAF7 B7               4      OR  A
001D7F EAF8 20A3            12      JR  NZ,ERRW
001D81 EAFA C9              10      RET
       EAFB                     DISKC:
001D82 EAFB 1B               6      DEC DE
001D83 EAFC CB5F             8      BIT 3,A
001D85 EAFE C447EA          17      CALL    NZ,RNF
       EB01                     DISKD:
001D88 EB01 E5              11      PUSH    HL
001D89 EB02 214DEA          10      LD  HL,RETRY
001D8C EB05 35              11      DEC (HL)
001D8D EB06 E1              10      POP HL
001D8E EB07 200C            12      JR  NZ,ERR      ;Retry
001D90 EB09 B7               4      OR  A
001D91 EB0A 2809            12      JR  Z,ERR       ;Error
                                
       EB0C                     DELP:
001D93 EB0C CD47EA          17      CALL    RNF
001D96 EB0F CD29EA          17      CALL    FDMOFF
001D99 EB12 3EFF             7      LD  A,0FFH
       EB14                     AERRZ:
001D9B EB14 BF               4      CP  A
       EB15                     ERR:
001D9C EB15 3EFF             7      LD  A,0FFH
001D9E EB17 C9              10      RET
                                
       F0B2                     FDMODE  EQU TVRAMTOP
[EOF:M7DISK.ASM:SHIFT_JIS]
                                    INCLUDE "M7DISK2.ASM"
                                
                                ;   LSX-Dodgers DISK2
                                ;   MZ-700/1500
                                
                                ;   EMM DRIVER
                                ;   1セクタ可変(256/512/1024)
                                
       EB18                     EDWT:
001D9F EB18 F5              11      PUSH    AF
001DA0 EB19 CD37EB          17      CALL    EADR
001DA3 EB1C 0600             7      LD  B,0
       EB1E                     EDWT1:
001DA5 EB1E EDB3                    OTIR
001DA7 EB20 3D               4      DEC A
001DA8 EB21 20FB            12      JR  NZ,EDWT1
001DAA EB23 180B            12      JR  EDRW1
                                
       EB25                     EDRD:
001DAC EB25 C5              11      PUSH    BC
001DAD EB26 CD37EB          17      CALL    EADR
001DB0 EB29 0600             7      LD  B,0
       EB2B                     EDRD1:
001DB2 EB2B EDB2                    INIR
001DB4 EB2D 3D               4      DEC A
001DB5 EB2E 20FB            12      JR  NZ,EDRD1
       EB30                     EDRW1:
001DB7 EB30 F1              10      POP AF
001DB8 EB31 83               4      ADD A,E ;セクタを進める
001DB9 EB32 5F               4      LD  E,A
001DBA EB33 8A               4      ADC A,D
001DBB EB34 93               4      SUB E
001DBC EB35 57               4      LD  D,A
001DBD EB36 C9              10      RET
                                
       EB37                     EADR:
001DBE EB37 C5              11      PUSH    BC
001DBF EB38 D5              11      PUSH    DE
001DC0 EB39 EB               4      EX  DE,HL
001DC1 EB3A 29              11      ADD HL,HL
001DC2 EB3B DD4E0D          19      LD  C,(IX+00DH) ;DPB_0D_MAXSEC
001DC5 EB3E DD460C          19      LD  B,(IX+00CH) ;DPB_0C_MAXCYL
001DC8 EB41 09              11      ADD HL,BC
001DC9 EB42 DD4E13          19      LD  C,(IX+013H) ;DPB_13_UNITNO
001DCC EB45 ED49            12      OUT (C),C
001DCE EB47 0C               4      INC C
001DCF EB48 ED69            12      OUT (C),L
001DD1 EB4A 0C               4      INC C
001DD2 EB4B ED61            12      OUT (C),H
001DD4 EB4D 0C               4      INC C
001DD5 EB4E EB               4      EX  DE,HL
001DD6 EB4F D1              10      POP DE
001DD7 EB50 DD460F          19      LD  B,(IX+00FH) ;DPB_0F_BPS
001DDA EB53 F1              10      POP AF
       EB54                     EADR1:              ;読み込むセクタ数と1クラスタのセクタ数を掛ける
001DDB EB54 CB18             8      RR  B
001DDD EB56 D8              11      RET C
001DDE EB57 87               4      ADD A,A
001DDF EB58 18FA            12      JR  EADR1
                                
                                ;   CMOS BACKUP MEMORY DRIVER(32KB)
                                ;   1セクタ256
                                
       EB5A                     CDWT:
001DE1 EB5A 78               4      LD  A,B
001DE2 EB5B DD4E13          19      LD  C,(IX+013H) ;DPB_13_UNITNO
001DE5 EB5E ED40            12      IN  B,(C)       ;アドレスカウンタを0000にリセット
001DE7 EB60 ED59            12      OUT (C),E       ;W)アドレスカウンタ上位
001DE9 EB62 01FA00          10      LD  BC,000FAH
       EB65                     CDWT1:
001DEC EB65 EDB3                    OTIR            ;W)データ書き込み・アドレスカウンタ+1
001DEE EB67 13               6      INC DE
001DEF EB68 3D               4      DEC A
001DF0 EB69 20FA            12      JR  NZ,CDWT1
001DF2 EB6B A7               4      AND A
001DF3 EB6C C9              10      RET
                                
       EB6D                     CDRD:
001DF4 EB6D 78               4      LD  A,B
001DF5 EB6E DD4E13          19      LD  C,(IX+013H) ;DPB_13_UNITNO
001DF8 EB71 ED40            12      IN  B,(C)       ;アドレスカウンタを0000にリセット
001DFA EB73 ED59            12      OUT (C),E       ;W)アドレスカウンタ上位
001DFC EB75 01F900          10      LD  BC,000F9H
       EB78                     CDRD1:
001DFF EB78 EDB2                    INIR            ;R)データ読み出し・アドレスカウンタ+1
001E01 EB7A 13               6      INC DE
001E02 EB7B 3D               4      DEC A
001E03 EB7C 20FA            12      JR  NZ,CDRD1
001E05 EB7E A7               4      AND A
001E06 EB7F C9              10      RET
                                
                                ;   RAM DISK DRIVER (64KB)
                                ;   1セクタ256
                                
       EB80                     RDWT:
001E07 EB80 3EB3             7      LD  A,0B3H      ;OTIR
001E09 EB82 1802            12      JR  RDRW
       EB84                     RDRD:
001E0B EB84 3EB2             7      LD  A,0B2H      ;INIR
       EB86                     RDRW:
001E0D EB86 3293EB          13      LD  (RDRW1+1),A
                                
001E10 EB89 78               4      LD  A,B
001E11 EB8A 43               4      LD  B,E     ;B=アドレスカウンタ上位(X1の様な16bitのI/Oアクセス)
001E12 EB8B 0EEB             7      LD  C,0EBH
001E14 EB8D ED71            12      OUT (C),0       ;0=アドレスカウンタ下位
001E16 EB8F 0D               4      DEC C       ;EA(R)データ読み出し・アドレスカウンタ+1
001E17 EB90 0600             7      LD  B,0
       EB92                     RDRW1:
001E19 EB92 EDB2                    INIR            ;自己書き換え(INIR/OTIR)
001E1B EB94 13               6      INC DE
001E1C EB95 3D               4      DEC A
001E1D EB96 20FA            12      JR  NZ,RDRW1
001E1F EB98 A7               4      AND A
001E20 EB99 C9              10      RET
[EOF:M7DISK2.ASM:UTF_8]
                                    INCLUDE "LDCCPWK.ASM"
                                
                                ;   LSX-Dodgers CCP WORK
                                
       0040                     PATHX   EQU 64
001E21 EB9A                     PATHD:  DS  PATHX
001E61 EBDA 00                  PATHE:  DB  0
                                
       EBDB                     DTA_CCP:
001E62 EBDB                         DS  37
                                
       EC00                     FCB_BAT:
001E87 EC00                         DS  37
                                
                                
001EAC EC25 2062797465732066    FREE:   DB  " bytes free",9,'$'
            7265650924          
[EOF:LDCCPWK.ASM:UTF_8]
                                    INCLUDE "M7TABLE.ASM"
                                
                                ;   LSX-Dodgers TABLE 表示関連のテーブル
                                ;   MZ-700/1500
                                
       EC32                     AT_TABLE:
001EB9 EC32                         DS  TABLEAD-AT_TABLE
                                
       ED40                     KEY_TABLE:
001FC7 ED40 12081E1F1C1D5C2F        DB  12H,08H,1EH,1FH,1CH,1DH,5CH,'/'
001FCF ED48 5C5E2D2030392C2E        DB  5CH,'^','-',20H,'0','9',',','.'
001FD7 ED50 3132333435363738        DB  '1','2','3','4','5','6','7','8'
001FDF ED58 6162636465666768        DB  'a','b','c','d','e','f','g','h'
001FE7 ED60 696A6B6C6D6E6F70        DB  'i','j','k','l','m','n','o','p'
001FEF ED68 7172737475767778        DB  'q','r','s','t','u','v','w','x'
001FF7 ED70 797A405B5D000000        DB  'y','z','@','[',']',00H,00H,00H
001FFF ED78 001B3D09003B3A0D        DB  00H,1BH,'=',09H,00H,';',':',0DH
       ED80                     SHIFT_TABLE:
002007 ED80 12081E1F1C1D5F3F        DB  12H,08H,1EH,1FH,1CH,1DH,'_','?'
00200F ED88 7C7E3D2030293C3E        DB  '|','~','=',20H,'0',')','<','>'
002017 ED90 2122232425262728        DB  '!','"','#','$','%','&',27H,'('
00201F ED98 4142434445464748        DB  'A','B','C','D','E','F','G','H'
002027 EDA0 494A4B4C4D4E4F50        DB  'I','J','K','L','M','N','O','P'
00202F EDA8 5152535455565758        DB  'Q','R','S','T','U','V','W','X'
002037 EDB0 595A607B7D000000        DB  'Y','Z','`','{','}',00H,00H,00H
00203F EDB8 00003D09002B2A0D        DB  00H,00H,'=',09H,00H,'+','*',0DH
       EDC0                     CTRL_TABLE:
002047 EDC0 12081E1F1C1D3F2F        DB  12H,08H,1EH,1FH,1CH,1DH,'?','/'
00204F EDC8 2A2B2D2030392C2E        DB  '*','+','-',20H,'0','9',',','.'
002057 EDD0 3132333435363738        DB  '1','2','3','4','5','6','7','8'
00205F EDD8 0102030405060708        DB  01H,02H,03H,04H,05H,06H,07H,08H
002067 EDE0 090A0B0C0D0E0F10        DB  09H,0AH,0BH,0CH,0DH,0EH,0FH,10H
00206F EDE8 1112131415161718        DB  11H,12H,13H,14H,15H,16H,17H,18H
002077 EDF0 191A1B5B5D000000        DB  19H,1AH,1BH,'[',']',00H,00H,00H
00207F EDF8 00003D09003B3A0D        DB  00H,00H,'=',09H,00H,';',':',0DH
                                
                                ;   アドレス下位1バイトが0になるように
       EE00                     CD_TABLE:
002087 EE00 00D1D2D3D4D5D6D0        DB  $00,$D1,$D2,$D3,$D4,$D5,$D6,$D0 ;月火水木金土日
00208F EE08 D8DCD9DADBD7CFCE        DB  $D8,$DC,$D9,$DA,$DB,$D7,$CF,$CE ;年円時分秒
002097 EE10 601F5F5E1E1B7978        DB  $60,$1F,$5F,$5E,$1E,$1B,$79,$78 ;
00209F EE18 5C5D1C1D6DCACDC7        DB  $5C,$5D,$1C,$1D,$6D,$CA,$CD,$C7 ;
0020A7 EE20 0061626364656667        DB  $00,$61,$62,$63,$64,$65,$66,$67 ; !"#$%&'
0020AF EE28 68696B6A2F2A2E2D        DB  $68,$69,$6B,$6A,$2F,$2A,$2E,$2D ;()*+,-./
0020B7 EE30 2021222324252627        DB  $20,$21,$22,$23,$24,$25,$26,$27 ;01234567
0020BF EE38 28294F2C512B5749        DB  $28,$29,$4F,$2C,$51,$2B,$57,$49 ;89:;<=>?
0020C7 EE40 5501020304050607        DB  $55,$01,$02,$03,$04,$05,$06,$07 ;@ABCDEFG
0020CF EE48 08090A0B0C0D0E0F        DB  $08,$09,$0A,$0B,$0C,$0D,$0E,$0F ;HIJKLMNO
0020D7 EE50 1011121314151617        DB  $10,$11,$12,$13,$14,$15,$16,$17 ;PQRSTUVW
0020DF EE58 18191A52DD54507C        DB  $18,$19,$1A,$52,$DD,$54,$50,$7C ;XYZ[\]^_
0020E7 EE60 5901020304050607        DB  $59,$01,$02,$03,$04,$05,$06,$07 ;`abcdefg   ATB:1
0020EF EE68 08090A0B0C0D0E0F        DB  $08,$09,$0A,$0B,$0C,$0D,$0E,$0F ;hijklmno   ATB:1
0020F7 EE70 1011121314151617        DB  $10,$11,$12,$13,$14,$15,$16,$17 ;pqrstuvw   ATB:1
0020FF EE78 18191ACB35CC705A        DB  $18,$19,$1A,$CB,$35,$CC,$70,$5A ;xyz{|}~    ATB:1
002107 EE80 415346444847B49E        DB  $41,$53,$46,$44,$48,$47,$B4,$9E ;トランプ〇●をぁ   ATB:1
00210F EE88 B2B6BABE9FB3B7BB        DB  $B2,$B6,$BA,$BE,$9F,$B3,$B7,$BB ;ぃぅぇぉゃゅょっ   ATB:1
002117 EE90 BFA385A4A5A69487        DB  $BF,$A3,$85,$A4,$A5,$A6,$94,$87 ;ーあいうえおかき   ATB:1
00211F EE98 889C829884929083        DB  $88,$9C,$82,$98,$84,$92,$90,$83 ;くけこさしすせそ   ATB:1
002127 EEA0 F0BD9DB1B5B9B49E        DB  $F0,$BD,$9D,$B1,$B5,$B9,$B4,$9E ;　。「」、・ヲァ
00212F EEA8 B2B6BABE9FB3B7BB        DB  $B2,$B6,$BA,$BE,$9F,$B3,$B7,$BB ;ィゥェォャョュッ
002137 EEB0 BFA385A4A5A69487        DB  $BF,$A3,$85,$A4,$A5,$A6,$94,$87 ;ーアイウエオカキ
00213F EEB8 889C829884929083        DB  $88,$9C,$82,$98,$84,$92,$90,$83 ;クケコサシスセソ
002147 EEC0 91819A97939589A1        DB  $91,$81,$9A,$97,$93,$95,$89,$A1 ;タチツテトナニヌ
00214F EEC8 AF8B8696A2ABAA8A        DB  $AF,$8B,$86,$96,$A2,$AB,$AA,$8A ;ネノハヒフヘホマ
002157 EED0 8EB0AD8DA7A8A98F        DB  $8E,$B0,$AD,$8D,$A7,$A8,$A9,$8F ;ミムメモヤユヨラ
00215F EED8 8CAEAC9BA099BCB8        DB  $8C,$AE,$AC,$9B,$A0,$99,$BC,$B8 ;リルレロワン゛゜
002167 EEE0 91819A97939589A1        DB  $91,$81,$9A,$97,$93,$95,$89,$A1 ;たちつてとねにぬ   ATB:1
00216F EEE8 AF8B8696A2ABAA8A        DB  $AF,$8B,$86,$96,$A2,$AB,$AA,$8A ;ねのはひふへほま   ATB:1
002177 EEF0 8EB0AD8DA7A8A98F        DB  $8E,$B0,$AD,$8D,$A7,$A8,$A9,$8F ;みむめもやゆよら   ATB:1
00217F EEF8 8CAEAC9BA099BCB8        DB  $8C,$AE,$AC,$9B,$A0,$99,$BC,$B8 ;りるれろわん゛゜   ATB:1
       EF00                     DC_TABLE:
002187 EF00 2041424344454647        DB  $20,$41,$42,$43,$44,$45,$46,$47 ;0
00218F EF08 48494A4B4C4D4E4F        DB  $48,$49,$4A,$4B,$4C,$4D,$4E,$4F
002197 EF10 5051525354555657        DB  $50,$51,$52,$53,$54,$55,$56,$57 ;1
00219F EF18 58595A151A1B1411        DB  $58,$59,$5A,$15,$1A,$1B,$14,$11
0021A7 EF20 3031323334353637        DB  $30,$31,$32,$33,$34,$35,$36,$37 ;2
0021AF EF28 38392D3D3B2F2E2C        DB  $38,$39,$2D,$3D,$3B,$2F,$2E,$2C
0021B7 EF30 00000000007C0000        DB  $00,$00,$00,$00,$00,$7C,$00,$00 ;3
0021BF EF38 0000000000000000        DB  $00,$00,$00,$00,$00,$00,$00,$00
0021C7 EF40 0080000083008285        DB  $00,$80,$00,$00,$83,$00,$82,$85 ;4
0021CF EF48 843F00000000003A        DB  $84,$3F,$00,$00,$00,$00,$00,$3A
0021D7 EF50 5E3C5B815D40003E        DB  $5E,$3C,$5B,$81,$5D,$40,$00,$3E ;5
0021DF EF58 00607F0018191312        DB  $00,$60,$7F,$00,$18,$19,$13,$12
0021E7 EF60 1021222324252627        DB  $10,$21,$22,$23,$24,$25,$26,$27 ;6
0021EF EF68 28292B2A001C0000        DB  $28,$29,$2B,$2A,$00,$1C,$00,$00
0021F7 EF70 7E00000000000000        DB  $7E,$00,$00,$00,$00,$00,$00,$00 ;7
0021FF EF78 171600005F000000        DB  $17,$16,$00,$00,$5F,$00,$00,$00
002207 EF80 00C19A9F9C92CA97        DB  $00,$C1,$9A,$9F,$9C,$92,$CA,$97 ;8
00220F EF88 98C6CFC9D8D3D0D7        DB  $98,$C6,$CF,$C9,$D8,$D3,$D0,$D7
002217 EF90 9EC09DC496C5CBC3        DB  $9E,$C0,$9D,$C4,$96,$C5,$CB,$C3 ;9
00221F EF98 9BDDC2DB99A2878C        DB  $9B,$DD,$C2,$DB,$99,$A2,$87,$8C
002227 EFA0 DCC7CC91939495D4        DB  $DC,$C7,$CC,$91,$93,$94,$95,$D4 ;A
00222F EFA8 D5D6CECDDAD2D9C8        DB  $D5,$D6,$CE,$CD,$DA,$D2,$D9,$C8
002237 EFB0 D1A3888D86A4898E        DB  $D1,$A3,$88,$8D,$86,$A4,$89,$8E ;B
00223F EFB8 DFA58A8FDEA18B90        DB  $DF,$A5,$8A,$8F,$DE,$A1,$8B,$90
002247 EFC0 000000000000001F        DB  $00,$00,$00,$00,$00,$00,$00,$1F ;C
00224F EFC8 00001D7B7D1E0F0E        DB  $00,$00,$1D,$7B,$7D,$1E,$0F,$0E
002257 EFD0 070102030405060D        DB  $07,$01,$02,$03,$04,$05,$06,$0D ;D
00225F EFD8 080A0B0C095C0000        DB  $08,$0A,$0B,$0C,$09,$5C,$00,$00
002267 EFE0 0000000000000000        DB  $00,$00,$00,$00,$00,$00,$00,$00 ;E
00226F EFE8 0000000000000000        DB  $00,$00,$00,$00,$00,$00,$00,$00
002277 EFF0 A000000000000000        DB  $A0,$00,$00,$00,$00,$00,$00,$00 ;F
00227F EFF8 0000000000000000        DB  $00,$00,$00,$00,$00,$00,$00,$00
[EOF:M7TABLE.ASM:SHIFT_JIS]
                                    INCLUDE "LDWORK.ASM"
                                
                                ;   LSX-Dodgers WORK0
                                ;
                                ;   CP/M互換BIOS
                                ;   BOOT:アドレス下位1バイトが0になるように
       F000                     AT_WORK:
002287 F000                         DS  WORKAD-AT_WORK
                                
       F000                     CPM_BOOT:
002287 F000 C30000          10      JP  0
       F003                     _SYS00:     ;(BDOS)プログラム終了
       F003                     CPM_WBOOT:
00228A F003 C3FECF          10      JP  WBOOT1
       F006                     CPM_CONST:
00228D F006 C3BDD8          10      JP  CONSTX
       F009                     _SYS07:     ;(BDOS)コンソール直接入力
       F009                     CPM_CONIN:
002290 F009 C353D8          10      JP  FLGET
       F00C                     CPM_CONOUT:
002293 F00C C362DA          10      JP  CONOUT1
                                
       F00F                     DECBF:
002296 F00F                         DS  5
00229B F014 00                  FDRV:   DB  0
00229C F015                     FNAME:  DS  36
0022C0 F039                     SFILE:  DS  33      ;DRV FILENAME
       F05A                     RR_BUF_HL:
0022E1 F05A                         DS  2       ;Random record buffer
       F05C                     RR_BUF_A:           ;CP/M互換ファイルアクセスの際のランダムレコードを一時的な保管場所
0022E3 F05C                         DS  1       ;計3バイト
0022E4 F05D 0000                LEFTX:  DW  0
0022E6 F05F 0000                DTAX:   DW  0
                                
       F061                     ZERO:
       F061                     BEEPD:
0022E8 F061 008E01000B000C10        DB  0,08EH,1,0,00BH,0,00CH,010H
0022F0 F069 073E08100D00FF          DB  007H,03EH,008H,010H,00DH,0,0FFH
       F062                     RTC_YY  EQU BEEPD+1
       F063                     RTC_MW  EQU BEEPD+2
       F064                     RTC_DD  EQU BEEPD+3
       F065                     RTC_TT  EQU BEEPD+4
       F066                     RTC_MM  EQU BEEPD+5
       F067                     RTC_SS  EQU BEEPD+6
                                
0022F7 F070 00                  CHECK:  DB  0
                                
0022F8 F071 4F4B24              OK: DB  "OK$"
0022FB F074                         DS  5
002300 F079 4572726F722124      COMERM: DB  "Error!$"
                                ;   システムワークエリア
                                ;   _CYL0:アドレス下位1バイトが080Hになるように
002307 F080 FF                  _CYL0:  DB  0FFH    ;Cylinder
002308 F081 FF                  _CYL1:  DB  0FFH    ;Cylinder
002309 F082 FF                  _CYL2:  DB  0FFH    ;Cylinder
00230A F083 FF                  _CYL3:  DB  0FFH    ;Cylinder
00230B F084 00                  _DRIVE: DB  0   ;unit number
00230C F085 00                  _SEEKSP:DB  0   ;Seek speed
00230D F086 FF                  _ISEEK: DB  0FFH    ;
00230E F087 00                  _DVSW:  DB  0
00230F F088 00                  _DRV:   DB  0
002310 F089 FF                  _DSK:   DB  0FFH
002311 F08A 8000                _DTA:   DW  00080H
002313 F08C 0000                _CTC:   DW  0
002315 F08E 0000                _TXADR: DW  0
002317 F090 0000                _KEYPS: DW  0
002319 F092 00FF                _KEYD:  DW  0FF00H  ;キーデータ
00231B F094 8310                _KEYSP: DB  KEYSP_L,KEYSP_H ;オートリピートの速度
00231D F096 70                  _COLORF:DB  COLORF  ;色
00231E F097 19                  _LINE:  DB  LINE
                                
00231F F098 0000                _FCB:   DW  0   ;SEARCH FILES
002321 F09A 0000                _FBPS:  DW  0   ;    //
002323 F09C 0000                _FBAD:  DW  0   ;    //
002325 F09E 00                  _FBCNT: DB  0   ;    //
002326 F09F 00                  _FILEN: DB  0   ;    //
002327 F0A0 00                  _DIRF:  DB  0   ;bit7:ディレクトリ bit0-6:セクタインデックス
002328 F0A1                         DS  1
002329 F0A2 00                  _WTFATF:DB  0   ;FATバッファの更新フラグ
00232A F0A3                         DS  1
00232B F0A4 00                  _WTDBF: DB  0   ;データバッファの更新フラグ
00232C F0A5 FF                  _DBDRV: DB  0FFH    ;データバッファにあるデータを読み込んだドライブ
00232D F0A6 0000                _DBSEC: DW  0   ;データバッファにあるデータを読み込んだセクタ番号
00232F F0A8 0000                _DPB:   DW  0
       F0AA                     _FATDRV:
002331 F0AA FF                      DB  0FFH    ;FATバッファに読み込んでいるドライブ
002332 F0AB 00                  _FATIX: DB  0   ;FATバッファに読み込んでいるインデックス
       F0AC                     _FAKEFREE:
002333 F0AC 0000                    DW  0   ;偽の残量（FATサイズが大きくなると重くなるのでその対策）
                                
002335 F0AE                         DS  2
                                
       F0B0                     CRTCD:
002337 F0B0 6F                      DB  06FH
       F0B1                     _WIDTH:
002338 F0B1 28                      DB  WIDTH
       F0B2                     TVRAMTOP:
002339 F0B2 5938                    DB  059H,038H
00233B F0B4 1F02                    DB  01FH,002H
       F0B6                     _LINE2:
00233D F0B6 19                      DB  019H
       F0B7                     WKE4:
00233E F0B7 1C                      DB  01CH
       F0B8                     WKE6:
00233F F0B8 00                      DB  000H
       F0B9                     WK40:
002340 F0B9 07                      DB  007H
       F0BA                     _PAGE_MINUS:
002341 F0BA 18FC                    DW  0-WIDTH*LINE
       F0BC                     _WIDTH_MINUS:
002343 F0BC D8FF                    DW  0-WIDTH
       F0BE                     WK30:
002345 F0BE 0C                      DB  00CH
       F0BF                     WK31:
       F0BF                     WK1FD0:
002346 F0BF 20                      DB  020H
                                
002347 F0C0 0000                CTC0:   DW  INTCTCE
002349 F0C2 0000                CTC1:   DW  INTCTCE
00234B F0C4 0000                CTC2:   DW  INTCTC2
00234D F0C6 0000                CTC3:   DW  INTCTCE
00234F F0C8 0000                INTVEC: DW  INT
                                
                                ;   LSX-Dodgers 独自BIOS
                                
002351 F0CA C39BDB          10  _INKEY: JP  INKEY
002354 F0CD C34ED9          10  _PRINT: JP  PRINT
002357 F0D0 C3F6DB          10  _SCRN:  JP  SCRN
00235A F0D3 C30BDB          10  _POS:   JP  POS
00235D F0D6 C330DA          10  _LOC:   JP  LOC
       F0D9                     _CHGDRV:
002360 F0D9 C3A3E8          10      JP  CHGDRV
       F0DC                     _GETDPB:
002363 F0DC C36EE9          10      JP  GETDPB
       F0DF                     _FFLUSH:
002366 F0DF C38CE9          10      JP  FFLUSH
       F0E2                     _RDFATX:
002369 F0E2 C37CE5          10      JP  RDFATX
00236C F0E5 C3A4E6          10  _RDFAT: JP  RDFAT
00236F F0E8 C34EEA          10  _WTTRK: JP  WTTRK
002372 F0EB C3AEEA          10  _FDRD:  JP  FDRD
002375 F0EE C354EA          10  _FDWT:  JP  FDWT
       F0F1                     _BPB2DPB:
002378 F0F1 C331E7          10      JP  BPB2DPB
       F0F4                     _BREAK:
00237B F0F4 C393D1          10      JP  END_BATCH
       F0F7                     _GNCL:
00237E F0F7 C31EE6          10  GNCPAT: JP  GNCL        ; self-modifying code
       F0FA                     _SNCL:
002381 F0FA C341E6          10  SNCPAT: JP  SNCL        ; self-modifying code
002384 F0FD C34DD0          10  _COMANL:JP  COMANL
                                
       F100                     _WE:
[EOF:LDWORK.ASM:SHIFT_JIS]
                                    INCLUDE "LDCALL.ASM"
                                
                                ;   LSX-Dodgers システムコール(BDOS)
                                ;
                                ;   LSX-Dodgers SYSTEM CALL
                                ;   STABLE:アドレス下位1バイトが0になるように
                                
       F100                     STABLE:
                                ;0
002387 F100 03F026D832D8CBDD        DW  _SYS00,_SYS01,_SYS02,_SYS03
00238F F108 40D540D537D809F0        DW  _SYS04,_SYS05,_SYS06,_SYS07
002397 F110 3FD842D589D8B5D8        DW  _SYS08,_SYS09,_SYS0A,_SYS0B
00239F F118 57D55CD56BD57CD5        DW  _SYS0C,_SYS0D,_SYS0E,_SYS0F
                                ;1
0023A7 F120 D0D517D660D696D6        DW  _SYS10,_SYS11,_SYS12,_SYS13
0023AF F128 9ED6B4D6C9D6C1D6        DW  _SYS14,_SYS15,_SYS16,_SYS17
0023B7 F130 10D715D71AD720D7        DW  _SYS18,_SYS19,_SYS1A,_SYS1B
0023BF F138 40D546D740D54AD7        DW  _SYS1C,_SYS1D,_SYS1E,_SYS1F
                                ;2
0023C7 F140 40D500D708D751D7        DW  _SYS20,_SYS21,_SYS22,_SYS23
0023CF F148 77D740D550E228E3        DW  _SYS24,_ERROR,_SYS26,_SYS27
0023D7 F150 08D780D7CBD8CBDD        DW  _SYS28,_SYS29,_SYS2A,_SYS2B
0023DF F158 D1D8CBDD40D5A3D7        DW  _SYS2C,_SYS2D,_SYS2E,_SYS2F
                                ;3
0023E7 F160 9DD740D540D540D5        DW  _SYS30,_ERROR,_ERROR,_ERROR
0023EF F168 40D540D540D540D5        DW  _ERROR,_ERROR,_ERROR,_ERROR
0023F7 F170 40D5CBDDCBDDC4D7        DW  _ERROR,_SYS39,_SYS3A,_SYS5A
                                ;DOS2
0023FF F178 23D5                    DW  _DOS2
                                
002401 F17A                         DS  2
002403 F17C 00F3                _FATBF: DW  FATBF
002405 F17E 00FB                _DTBUF: DW  DTBUF
                                
                                ;   コントロールコードテーブル
                                ;   CTRLTB:アドレス下位1バイトが080Hになるように
                                
       F180                     CTRLTB:
002407 F180 B3D9B3D9E9D9DEDA        DW  CTRL00,CTRL00,CTRL02,CTRL03 ;  A,B,C
00240F F188 D8DA15DAC9DA72DA        DW  CTRL04,CTRL05,CTRL06,CTRL07 ;D,E,F,G
002417 F190 BFD9DAD9E1DA43DA        DW  CTRL08,CTRL09,CTRL0A,CTRL0B ;H,I,J,K
00241F F198 C6DA2BDAF3DAB3D9        DW  CTRL0C,CTRL0D,CTRL0E,CTRL00 ;L,M,N,O
002427 F1A0 B3D9B3D93BDAB3D9        DW  CTRL00,CTRL00,CTRL12,CTRL00 ;P,Q,R,S
00242F F1A8 B3D9B3D9B3D9B3D9        DW  CTRL00,CTRL00,CTRL00,CTRL00 ;T,U,V,W
002437 F1B0 B3D9B3D9C6DA4ADA        DW  CTRL00,CTRL00,CTRL0C,CTRL1B ;X,Y,Z,ESC
00243F F1B8 A2D9C6D9CFD9E1DA        DW  CTRL1C,CTRL1D,CTRL1E,CTRL1F ;→,←,↑,↓
                                
002447 F1C0 0200                M2D:    DW  2
002449 F1C2 FD02                    DB  0FDH,2
00244B F1C4 6401                    DW  356
00244D F1C6 FF0728090182            DB  0FFH,7,40,9,1,082H
002453 F1CC 0500A7000800            DW  5,0A7H,8
                                
002459 F1D2 0200                M2HD:   DW  2
00245B F1D4 FE01                    DB  0FEH,1
00245D F1D6 C704                    DW  1223
00245F F1D8 FE064D080184            DB  0FEH,6,77,8,1,084H
002465 F1DE 0500A7000900            DW  5,0A7H,9
                                
00246B F1E4                         DS  6
                                
002471 F1EA 1617                SDDATA: DB  22,23       ;(FCB)ファイルを最後に変更した時刻
002473 F1EC 1415                    DB  20,21       ;(FCB)ファイルを最後に変更した日付
002475 F1EE 1A1B                    DB  26,27       ;(FCB)ファイルの先頭クラスタ
002477 F1F0 10111213                DB  16,17,18,19 ;(FCB)ファイルのサイズ(バイト単位)
       F1F4                     SDDATAE:
                                
00247B F1F4                     SCDIR:  DS  2       ;+14 +15
00247D F1F6                     SFBPS:  DS  2       ;FBPS
00247F F1F8                     SFNDF:  DS  2       ;FILEN DIRF
                                
002481 F1FA 0000                _FATPS: DW  0
002483 F1FC 0000                _DIRPS: DW  0
002485 F1FE 0000                _CLPS:  DW  0
                                
       F200                     _PE:
[EOF:LDCALL.ASM:SHIFT_JIS]
                                    INCLUDE "M7DPB.ASM"
                                
                                ;   LSX-Dodgers DPB
                                ;   MZ-700/1500
                                
       F200                     DEVICE:
                                
                                ;   A:
                                
002487 F200 0200                    DW  2   ;DPB_00_FATLN
002489 F202 EBF0                    DW  _FDRD   ;DPB_02_DRD
00248B F204 EEF0                    DW  _FDWT   ;DPB_04_DWT
00248D F206 FD                      DB  0FDH    ;DPB_06_FATID
00248E F207 02                      DB  2   ;DPB_07_SECPCL
00248F F208 6401                    DW  356 ;DPB_08_MAXCL
002491 F20A FF                      DB  0FFH    ;DPB_0A_FDMODE  0FFH=2D / 0FEH=2HD
002492 F20B 07                      DB  7   ;DPB_0B_DIRSCNT
002493 F20C 28                      DB  40  ;DPB_0C_MAXCYL
002494 F20D 09                      DB  9   ;DPB_0D_MAXSEC  Number of sectors
002495 F20E 01                      DB  1   ;DPB_0E_FATPS
002496 F20F 82                      DB  082H    ;DPB_0F_BPS
002497 F210 0500                    DW  5   ;DPB_10_DIRPS
002499 F212 27                      DB  027H    ;DPB_12_DEVICE  Device Number
00249A F213 00                      DB  0   ;DPB_13_UNITNO
00249B F214 0800                    DW  8   ;DPB_14_ADDCL16
00249D F216 0000                    DW  0   ;DPB_16
00249F F218 0000                    DW  0   ;DPB_18
0024A1 F21A 0000                    DW  0   ;DPB_1A_SDIR
0024A3 F21C 46444430                DB  "FDD0"  ;DPB_1C_NAME
                                
                                ;   B:
                                
0024A7 F220 0200                    DW  2   ;DPB_00_FATLN
0024A9 F222 EBF0                    DW  _FDRD   ;DPB_02_DRD
0024AB F224 EEF0                    DW  _FDWT   ;DPB_04_DWT
0024AD F226 FD                      DB  0FDH    ;DPB_06_FATID
0024AE F227 02                      DB  2   ;DPB_07_SECPCL
0024AF F228 6401                    DW  356 ;DPB_08_MAXCL
0024B1 F22A FF                      DB  0FFH    ;DPB_0A_FDMODE  0FFH=2D / 0FEH=2HD
0024B2 F22B 07                      DB  7   ;DPB_0B_DIRSCNT
0024B3 F22C 28                      DB  40  ;DPB_0C_MAXCYL
0024B4 F22D 09                      DB  9   ;DPB_0D_MAXSEC  Number of sectors
0024B5 F22E 01                      DB  1   ;DPB_0E_FATPS
0024B6 F22F 82                      DB  082H    ;DPB_0F_BPS
0024B7 F230 0500                    DW  5   ;DPB_10_DIRPS
0024B9 F232 27                      DB  027H    ;DPB_12_DEVICE  Device Number
0024BA F233 01                      DB  1   ;DPB_13_UNITNO
0024BB F234 0800                    DW  8   ;DPB_14_ADDCL16
0024BD F236 0000                    DW  0   ;DPB_16
0024BF F238 0000                    DW  0   ;DPB_18
0024C1 F23A 0000                    DW  0   ;DPB_1A_SDIR
0024C3 F23C 46444431                DB  "FDD1"  ;DPB_1C_NAME
                                
                                ;   C:
                                
0024C7 F240 0100                    DW  1   ;DPB_00_FATLN
0024C9 F242 6DEB                    DW  CDRD    ;DPB_02_DRD
0024CB F244 5AEB                    DW  CDWT    ;DPB_04_DWT
0024CD F246 FA                      DB  0FAH    ;DPB_06_FATID
0024CE F247 01                      DB  1   ;DPB_07_SECPCL
0024CF F248 7A00                    DW  122 ;DPB_08_MAXCL
0024D1 F24A 00                      DB  0   ;DPB_0A_FDMODE
0024D2 F24B 06                      DB  6   ;DPB_0B_DIRSCNT
0024D3 F24C 00                      DB  0   ;DPB_0C_MAXCYL
0024D4 F24D 00                      DB  0   ;DPB_0D_MAXSEC
0024D5 F24E 01                      DB  1   ;DPB_0E_FATPS
0024D6 F24F 01                      DB  1   ;DPB_0F_BPS
0024D7 F250 0200                    DW  2   ;DPB_10_DIRPS
0024D9 F252 0C                      DB  00CH    ;DPB_12_DEVICE
0024DA F253 F8                      DB  0F8H    ;DPB_13_UNITNO
0024DB F254 0600                    DW  6   ;DPB_14_ADDCL16
0024DD F256 0000                    DW  0   ;DPB_16
0024DF F258 0000                    DW  0   ;DPB_18
0024E1 F25A 0000                    DW  0   ;DPB_1A_SDIR
0024E3 F25C 434D4F53                DB  "CMOS"  ;DPB_1C_NAME
                                
                                ;   D:
                                
0024E7 F260                         DS  32
                                
                                ;   E:
                                
002507 F280 0000                    DW  0   ;DPB_00_FATLN
002509 F282 25EB                    DW  EDRD    ;DPB_02_DRD
00250B F284 18EB                    DW  EDWT    ;DPB_04_DWT
00250D F286 FA                      DB  0FAH    ;DPB_06_FATID
00250E F287 02                      DB  2   ;DPB_07_SECPCL
00250F F288 0000                    DW  0   ;DPB_08_MAXCL
002511 F28A 00                      DB  0   ;DPB_0A_FDMODE
002512 F28B 10                      DB  16  ;DPB_0B_DIRSCNT
002513 F28C 00                      DB  0   ;DPB_0C_MAXCYL
002514 F28D 00                      DB  0   ;DPB_0D_MAXSEC
002515 F28E 01                      DB  1   ;DPB_0E_FATPS
002516 F28F 01                      DB  1   ;DPB_0F_BPS
002517 F290 0000                    DW  0   ;DPB_10_DIRPS
002519 F292 26                      DB  026H    ;DPB_12_DEVICE
00251A F293 00                      DB  0   ;DPB_13_UNITNO
00251B F294 0000                    DW  0   ;DPB_14_ADDCL16
00251D F296 0000                    DW  0   ;DPB_16
00251F F298 0000                    DW  0   ;DPB_18
002521 F29A 0000                    DW  0   ;DPB_1A_SDIR
002523 F29C 454D4D30                DB  "EMM0"  ;DPB_1C_NAME
                                
                                ;   F:
                                
002527 F2A0 0200                    DW  2   ;DPB_00_FATLN
002529 F2A2 84EB                    DW  RDRD    ;DPB_02_DRD
00252B F2A4 80EB                    DW  RDWT    ;DPB_04_DWT
00252D F2A6 FA                      DB  0FAH    ;DPB_06_FATID
00252E F2A7 01                      DB  1   ;DPB_07_SECPCL
00252F F2A8 F600                    DW  246 ;DPB_08_MAXCL
002531 F2AA 00                      DB  0   ;DPB_0A_FDMODE
002532 F2AB 09                      DB  9   ;DPB_0B_DIRSCNT
002533 F2AC 00                      DB  0   ;DPB_0C_MAXCYL
002534 F2AD 00                      DB  0   ;DPB_0D_MAXSEC
002535 F2AE 01                      DB  1   ;DPB_0E_FATPS
002536 F2AF 01                      DB  1   ;DPB_0F_BPS
002537 F2B0 0300                    DW  3   ;DPB_10_DIRPS
002539 F2B2 0F                      DB  00FH    ;DPB_12_DEVICE
00253A F2B3 00                      DB  0   ;DPB_13_UNITNO
00253B F2B4 0A00                    DW  10  ;DPB_14_ADDCL16
00253D F2B6 0000                    DW  0   ;DPB_16
00253F F2B8 0000                    DW  0   ;DPB_18
002541 F2BA 0000                    DW  0   ;DPB_1A_SDIR
002543 F2BC 52414D46                DB  "RAMF"  ;DPB_1C_NAME
                                
                                ;   G:
                                
002547 F2C0                         DS  32
                                
                                ;   H:
002567 F2E0                         DS  3
00256A F2E3 00                      DB  0
[EOF:M7DPB.ASM:UTF_8]
                                
       A56B                         ORG $$+OFFSET   ;$DEPHASE
       A56B                     LAST_ADR:
                                
                                    END
[EOF:M7.ASM:UTF_8]
