                                ;*** AILZ80ASM *** Z-80 Assembler, version 1.0.0.0, LST:Full:4
                                ;   LSX-Dodgers for MZ-700/1500
                                ;   Programmed by
                                ;   Gaku (Lovers/Tablacus)
                                
                                    INCLUDE "M7DEF.ASM"
                                
                                ;   LSX-Dodgers DEF
                                ;   MZ-700/1500
                                
       0001                     MAC EQU 1   ;MZ-700/1500
       0000                     DEV EQU 0
                                
       8080                     RUN EQU 08080H
       8000                     OFFSET  EQU RUN-128
       CF06                     BDOS    EQU 0CF06H
       ED40                     TABLEAD EQU 0ED40H
       F000                     WORKAD  EQU 0F000H
       F300                     FATBF   EQU 0F300H
       FB00                     DTBUF   EQU 0FB00H
       FF00                     KEYBF   EQU 0FF00H
       FF20                     KBUF    EQU 0FF20H
       FFD9                     TRAP38  EQU 0FFD9H
       0028                     WIDTH   EQU 40
       0019                     LINE    EQU 25
       0071                     COLORF  EQU 071H
       0010                     KEYSP_H EQU 16
       0083                     KEYSP_L EQU 131
       000A                     COMS    EQU 10
[EOF:M7DEF.ASM:UTF_8]
                                    INCLUDE "LDDEF.ASM"
                                
                                ;   LSX-Dodgers DEF
                                
       0001                     VER_1   EQU 1
       0005                     VER_2   EQU 5
       0003                     VER_3   EQU 3
       1D01                     MACW    EQU MAC + 01D00H    ;機種フラグとLD判別フラグ
       0001                     MACD    EQU MAC + DEV * 256 ;機種フラグとデバイスフラグ
       0153                     VER EQU VER_1 * 256 + VER_2 * 16 + VER_3
                                
       0005                     SYSTEM  EQU 00005H
       000F                     JP_HL   EQU 0000FH
       005C                     FCB1    EQU 0005CH
       006C                     FCB2    EQU 0006CH
       005D                     FCB1FN  EQU FCB1+1
       006D                     FCB2FN  EQU FCB2+1
       0080                     DTA1    EQU 00080H
                                
       FFCA                     EXTBIO  EQU 0FFCAH
                                
[EOF:LDDEF.ASM:SHIFT_JIS]
                                
000000 8000                         ORG OFFSET
                                                    ;MZTヘッダ128バイト
000000 8000 01                      DB  1           ;ファイルモード
000001 8001 4C44202020202020        DB  "LD           "     ;ファイル名(13)
            2020202020          
00000E 800E 535953                  DB  "SYS"           ;拡張子(3)
000011 8011 0D                      DB  $0D
000012 8012 EB24                    DW  LAST_ADR-RUN        ;サイズ
000014 8014 8080                    DW  RUN         ;開始アドレス
000016 8016 8080                    DW  RUN         ;実行アドレス
000018 8018                         DS  104
                                
                                    INCLUDE "M7INIT.ASM"
                                
                                ;   LSX-Dodgers INIT
                                ;   MZ-700/1500
                                
000080 8080 C38780          10      JP  START
000083 8083 011D                    DW  MACW
000085 8085 5301                    DW  VER
                                
       8087                     START:
000087 8087 F3               4      DI
000088 8088 ED56             8      IM  1
00008A 808A 318780          10      LD  SP,START
00008D 808D CD9B80          17      CALL    INIT        ;NZならAUTOEXECを実行
000090 8090 210000          10      LD  HL,0
000093 8093 E5              11      PUSH    HL
000094 8094 C8              11      RET Z
000095 8095 112881          10      LD  DE,AUTOD
000098 8098 C3FDF0          10      JP  _COMANL
                                
       809B                     INIT:
00009B 809B D3E0            11      OUT (0E0H),A    ;DRAM(0000H-0FFFH)
00009D 809D D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
00009F 809F 218D81          10      LD  HL,INITE
0000A2 80A2 1106CF          10      LD  DE,BDOS
0000A5 80A5 01DE23          10      LD  BC,LAST_ADR-INITE
0000A8 80A8 EDB0                    LDIR
0000AA 80AA 215E81          10      LD  HL,M7BEEPD
0000AD 80AD 1162F0          10      LD  DE,BEEPD+1
0000B0 80B0 010800          10      LD  BC,M7BEEPE-M7BEEPD
0000B3 80B3 EDB0                    LDIR
                                
0000B5 80B5 210000          10      LD  HL,0
0000B8 80B8 065C             7      LD  B,05CH
0000BA 80BA 3EEF             7      LD  A,0EFH      ;RST 28H
0000BC 80BC CDE3DC          17      CALL    FILL_MEMORY
0000BF 80BF 06A4             7      LD  B,0A4H
0000C1 80C1 AF               4      XOR A
0000C2 80C2 CDE3DC          17      CALL    FILL_MEMORY
                                
0000C5 80C5 3EC3             7      LD  A,0C3H      ;JP
0000C7 80C7 2103F0          10      LD  HL,CPM_WBOOT
0000CA 80CA 320000          13      LD  (00000H),A
0000CD 80CD 220100          16      LD  (00001H),HL ;IPL
                                
0000D0 80D0 21011D          10      LD  HL,MACW     ;3 bit7  DPB Compatible LA(1)
0000D3 80D3 220300          16      LD  (00003H),HL ;  bit6-0 Machine
                                ;               ;4 LSX-Dodgers(01DH)
0000D6 80D6 2106CF          10      LD  HL,BDOS
0000D9 80D9 320500          13      LD  (00005H),A
0000DC 80DC 220600          16      LD  (00006H),HL ;BDOS
                                
0000DF 80DF 21D9FF          10      LD  HL,TRAP38   ;TRAP38
0000E2 80E2 322800          13      LD  (00028H),A
0000E5 80E5 222900          16      LD  (00029H),HL ;RST 028H
                                
0000E8 80E8 323800          13      LD  (00038H),A
0000EB 80EB 210ECF          10      LD  HL,IO_INT8253
0000EE 80EE 223900          16      LD  (00039H),HL
                                
0000F1 80F1 3EF0             7      LD  A,CPM_BOOT/256
0000F3 80F3 320B00          13      LD  (0000BH),A
                                
0000F6 80F6 3EE9             7      LD  A,0E9H      ;JP (HL)
0000F8 80F8 320F00          13      LD  (0000FH),A
                                
0000FB 80FB 213481          10      LD  HL,INIMES
0000FE 80FE CD51D5          17      CALL    MSX
       8101                     INIT1:
000101 8101 F3               4      DI
000102 8102 1100FF          10      LD  DE,0FF00H
000105 8105 0600             7      LD  B,0
000107 8107 CDA4D3          17      CALL    ZERO_MEMORY_DE
00010A 810A 21CAFF          10      LD  HL,EXTBIO
00010D 810D 36C9            10      LD  (HL),0C9H   ;RET
00010F 810F 23               6      INC HL
000110 8110 060E             7      LD  B,TRAP38-EXTBIO-1
000112 8112 3EEF             7      LD  A,0EFH      ;RST 28H
000114 8114 CDE3DC          17      CALL    FILL_MEMORY
000117 8117 216681          10      LD  HL,AT_TRAP38
00011A 811A 11D9FF          10      LD  DE,TRAP38
00011D 811D 012700          10      LD  BC,AT_TRAPE-AT_TRAP38
000120 8120 EDB0                    LDIR
                                
000122 8122 CDBEDB          17      CALL    CHKEY
000125 8125 FE03             7      CP  3
000127 8127 C9              10      RET
                                
000128 8128 4155544F45584543    AUTOD:  DB  "AUTOEXEC "
            20                  
000131 8131 413A00              AUTODV: DB  "A:",0
                                
000134 8134 0C4C53582D446F64    INIMES: DB  00CH,"LSX-Dodgers for MZ-700/1500 v"
            6765727320666F72    
            204D5A2D3730302F    
            313530302076        
000152 8152 312E                    DB  030H + VER_1, '.'
000154 8154 3533                    DB  030H + VER_2 ,030H + VER_3
                                ;   DB  ""
000156 8156 2047616B750D0A          DB  ' Gaku',0DH,0AH
00015D 815D 00                      DB  0
                                
       815E                     M7BEEPD:
00015E 815E 0801                    DB  8,1
000160 8160 0736                    DB  7,036H
000162 8162 04F9                    DB  4,0F9H
000164 8164 0403                    DB  4,3
       8166                     M7BEEPE:
                                
       8166                     AT_TRAP38:
000166 FFD9                         ORG TRAP38,AT_TRAP38-OFFSET
000166 FFD9 210000          10      LD  HL,0
000169 FFDC E3              19      EX  (SP),HL
00016A FFDD 3E24             7      LD  A,'$'
00016C FFDF CD29D8          17      CALL    MSG_A
00016F FFE2 2B               6      DEC HL
000170 FFE3 7C               4      LD  A,H
000171 FFE4 CDE8FF          17      CALL    PRHX
000174 FFE7 7D               4      LD  A,L
       FFE8                     PRHX:
000175 FFE8 F5              11      PUSH    AF
000176 FFE9 07               4      RLCA
000177 FFEA 07               4      RLCA
000178 FFEB 07               4      RLCA
000179 FFEC 07               4      RLCA
00017A FFED CDF1FF          17      CALL    PRHX2
00017D FFF0 F1              10      POP AF
       FFF1                     PRHX2:
00017E FFF1 E60F             7      AND 00FH
000180 FFF3 FE0A             7      CP  10
000182 FFF5 3F               4      CCF
000183 FFF6 CE30             7      ADC A,'0'
000185 FFF8 27               4      DAA
000186 FFF9 C329D8          10      JP  MSG_A
000189 FFFC                         DS  4
       818D                         ORG $$+OFFSET   ;$DEPHASE
       818D                     AT_TRAPE:
                                
       818D                     INITE:
00018D CF06                         ORG BDOS,INITE-OFFSET
                                
00018D CF06 C309CF          10      JP  IO_BDOS
[EOF:M7INIT.ASM:SHIFT_JIS]
                                    INCLUDE "M7BANK.ASM"
                                
                                ;   LSX-Dodgers IO
                                ;   MZ-700/1500
                                ;   VRAM/KEY/TIMER(0D000H-0EFFFH)にアクセスするので0D000H-0FFFFHに置けない部分
                                ;
                                
       CF09                     IO_BDOS:
000190 CF09 D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
000192 CF0B C310D5          10      JP  BDOS0
                                
       CF0E                     IO_INT8253:
000195 CF0E F3               4      DI
000196 CF0F F5              11      PUSH    AF
000197 CF10 D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
000199 CF12 3E01             7      LD  A,1
00019B CF14 3206E0          13      LD  (0E006H),A  ;8253 Ch.2 カウンタ
00019E CF17 AF               4      XOR A
00019F CF18 3206E0          13      LD  (0E006H),A  ;8253 Ch.2 カウンタ
0001A2 CF1B D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
0001A4 CF1D C3E3D7          10      JP  INT8253 
                                
       CF20                     RDKEYDATA:
0001A7 CF20 F3               4      DI
0001A8 CF21 D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
0001AA CF23 3200E0          13      LD  (0E000H),A
0001AD CF26 3A01E0          13      LD  A,(E001H)
0001B0 CF29 D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
0001B2 CF2B FB               4      EI
0001B3 CF2C C9              10      RET
                                
       CF2D                     RD556VSYNC:
0001B4 CF2D F3               4      DI
0001B5 CF2E D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
0001B7 CF30 3A02E0          13      LD  A,(0E002H)
0001BA CF33 D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
0001BC CF35 FB               4      EI
0001BD CF36 C9              10      RET
                                
       CF37                     RDMMIO:
0001BE CF37 F3               4      DI
0001BF CF38 D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
0001C1 CF3A 7E               7      LD  A,(HL)
0001C2 CF3B D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
0001C4 CF3D FB               4      EI
0001C5 CF3E C9              10      RET
                                
       CF3F                     WRMMIO:
0001C6 CF3F F3               4      DI
0001C7 CF40 D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
0001C9 CF42 77               7      LD  (HL),A
0001CA CF43 D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
0001CC CF45 FB               4      EI
0001CD CF46 C9              10      RET
                                
       CF47                     RDMMIO_BC:
0001CE CF47 F3               4      DI
0001CF CF48 D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
0001D1 CF4A 0A               7      LD  A,(BC)
0001D2 CF4B D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
0001D4 CF4D FB               4      EI
0001D5 CF4E C9              10      RET
                                
       CF4F                     WRMMIO_BC:
0001D6 CF4F F3               4      DI
0001D7 CF50 D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
0001D9 CF52 02               7      LD  (BC),A
0001DA CF53 D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
0001DC CF55 FB               4      EI
0001DD CF56 C9              10      RET
                                
       CF57                     IO_PRINT:
0001DE CF57 F3               4      DI
0001DF CF58 D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
0001E1 CF5A 77               7      LD  (HL),A
0001E2 CF5B CBDC             8      SET 3,H
0001E4 CF5D 71               7      LD  (HL),C
0001E5 CF5E D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
0001E7 CF60 FB               4      EI
0001E8 CF61 C9              10      RET
                                
       CF62                     IO_CLR:
0001E9 CF62 F3               4      DI
0001EA CF63 D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
       CF65                     C1AX1:
0001EC CF65 7A               4      LD  A,D
0001ED CF66 C6D0             7      ADD A,0D0H
0001EF CF68 57               4      LD  D,A
0001F0 CF69 AF               4      XOR A
0001F1 CF6A 12               7      LD  (DE),A      ;Text
0001F2 CF6B CBDA             8      SET 3,D
       CF6E                     ICSMC   EQU $+1
0001F4 CF6D 3E00             7      LD  A,0     ;自己書き換え
0001F6 CF6F 12               7      LD  (DE),A      ;Color
0001F7 CF70 13               6      INC DE
0001F8 CF71 7A               4      LD  A,D
0001F9 CF72 D6D8             7      SUB 0D8H
0001FB CF74 57               4      LD  D,A
0001FC CF75 2118FC          10      LD  HL,0-WIDTH*LINE
0001FF CF78 19              11      ADD HL,DE
000200 CF79 30EA            12      JR  NC,C1AX1
000202 CF7B E1              10      POP HL
000203 CF7C D1              10      POP DE
000204 CF7D D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
000206 CF7F FB               4      EI
000207 CF80 C9              10      RET
                                
       CF81                     IO_CLLINE:
000208 CF81 F3               4      DI
000209 CF82 D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
       CF84                     CLLINE1:
00020B CF84 CB9C             8      RES 3,H
00020D CF86 77               7      LD  (HL),A      ;Text
00020E CF87 CBDC             8      SET 3,H
000210 CF89 71               7      LD  (HL),C      ;Color
000211 CF8A 23               6      INC HL
000212 CF8B 10F7            13      DJNZ    CLLINE1
000214 CF8D D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
000216 CF8F FB               4      EI
000217 CF90 C9              10      RET
                                
       CF91                     IO_INS:
000218 CF91 F3               4      DI
000219 CF92 D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
       CF94                     IO_INS1:
00021B CF94 CDABCF          17      CALL    C12S
00021E CF97 23               6      INC HL
00021F CF98 10FA            13      DJNZ    IO_INS1
000221 CF9A D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
000223 CF9C FB               4      EI
000224 CF9D C9              10      RET
                                
       CF9E                     IO_BS:
000225 CF9E F3               4      DI
000226 CF9F D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
       CFA1                     IO_BS1:
000228 CFA1 CDABCF          17      CALL    C12S
00022B CFA4 2B               6      DEC HL
00022C CFA5 10F7            13      DJNZ    IO_BS
00022E CFA7 D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
000230 CFA9 FB               4      EI
000231 CFAA C9              10      RET
                                
       CFAB                     C12S:
000232 CFAB CB9C             8      RES 3,H
000234 CFAD 5E               7      LD  E,(HL)
000235 CFAE 77               7      LD  (HL),A
000236 CFAF 7B               4      LD  A,E
000237 CFB0 CBDC             8      SET 3,H
000239 CFB2 5E               7      LD  E,(HL)
00023A CFB3 71               7      LD  (HL),C
00023B CFB4 4B               4      LD  C,E
00023C CFB5 C9              10      RET
                                
       CFB6                     IO_SCRUP:
00023D CFB6 F3               4      DI
00023E CFB7 D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
       CFB9                     SCRUP1:
000240 CFB9 2815            12      JR  Z,SCRCL
000242 CFBB D5              11      PUSH    DE
000243 CFBC E5              11      PUSH    HL
000244 CFBD CBDA             8      SET 3,D
000246 CFBF CBDC             8      SET 3,H
000248 CFC1 012800          10      LD  BC,WIDTH
00024B CFC4 EDB0                    LDIR
00024D CFC6 E1              10      POP HL
00024E CFC7 D1              10      POP DE
00024F CFC8 012800          10      LD  BC,WIDTH
000252 CFCB EDB0                    LDIR
000254 CFCD 3D               4      DEC A
000255 CFCE 18E9            12      JR  SCRUP1
                                
       CFD0                     SCRCL:
000257 CFD0 0628             7      LD  B,WIDTH
000259 CFD2 EB               4      EX  DE,HL
00025A CFD3 D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
00025C CFD5 CD23DA          17      CALL    CLLINE
00025F CFD8 E1              10      POP HL
000260 CFD9 D1              10      POP DE
000261 CFDA C1              10      POP BC
000262 CFDB C9              10      RET
                                
       CFDC                     C_MON:
000263 CFDC D3E4            11      OUT (0E4H),A    ;MONITOR ROM(0000H-0FFFH) & VRAM/KEY/TIMER(D000H-FFFFH)
000265 CFDE C7              12      RST 0
                                
       CFDF                     INITINT:
000266 CFDF D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
000268 CFE1 2107E0          10      LD  HL,0E007H   ;HL=0E007H 8253 コントロール
00026B CFE4 36B0            10      LD  (HL),0B0H   ;Ch.2 カウンタの下位バイト→上位バイトの順に連続してアクセス Mode 0 16ビットバイナリ
00026D CFE6 3674            10      LD  (HL),074H   ;Ch.1 カウンタの下位バイト→上位バイトの順に連続してアクセス Mode 2 16ビットバイナリ
00026F CFE8 2D               4      DEC L       ;0E006H 8253 Ch.2 カウンタ
000270 CFE9 3602            10      LD  (HL),2
000272 CFEB 3600            10      LD  (HL),0
000274 CFED 2D               4      DEC L       ;0E005H 8253 Ch.1 カウンタ
000275 CFEE 77               7      LD  (HL),A
000276 CFEF 3600            10      LD  (HL),0
000278 CFF1 3E05             7      LD  A,5
00027A CFF3 3203E0          13      LD  (0E003H),A  ;8255 コントロールポートでポートC(0E002H)のINTMSKを1にする
00027D CFF6 D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
00027F CFF8 C9              10      RET
                                
       CFF9                     BANKE:
000280 CFF9                         DS  0CFFEH-BANKE
[EOF:M7BANK.ASM:SHIFT_JIS]
                                    INCLUDE "M7CCP.ASM"
                                
                                ;   LSX-Dodgers CCP
                                ;   MZ-700/1500
                                
       CFFE                     WBOOT1:
000285 CFFE D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)　ここは0CFFEH
000287 D000 D3E0            11      OUT (0E0H),A    ;DRAM(0000H-0FFHH)
000289 D002 F3               4      DI
00028A D003 3A94F0          13      LD  A,(_KEYSP)
00028D D006 CDDFCF          17      CALL    INITINT
000290 D009 ED7B0600        20      LD  SP,(SYSTEM+1)
000294 D00D FB               4      EI
000295 D00E 2192F0          10      LD  HL,_KEYD
000298 D011 3600            10      LD  (HL),0
00029A D013 CDBEDB          17      CALL    CHKEY
00029D D016 CD16D8          17      CALL    KEYBC_IFBREAK
0002A0 D019 3E04             7      LD  A,4
0002A2 D01B CD29D8          17      CALL    MSG_A
[EOF:M7CCP.ASM:UTF_8]
                                    INCLUDE "LDCCP.ASM"
                                
                                ;   LSX-Dodgers CCP
                                
       D01E                     COMMAND:
0002A5 D01E 3A1CEC          13      LD  A,(FCB_BAT)
0002A8 D021 B7               4      OR  A
0002A9 D022 C263D1          10      JP  NZ,C_BAT1
0002AC D025 CDD8D0          17      CALL    SETDTA1
0002AF D028 3A87F0          13      LD  A,(_DVSW)
0002B2 D02B C641             7      ADD A,'A'
0002B4 D02D CD29D8          17      CALL    MSG_A
0002B7 D030 3E3E             7      LD  A,'>'
0002B9 D032 CD29D8          17      CALL    MSG_A
0002BC D035 3E50             7      LD  A,80
0002BE D037 12               7      LD  (DE),A
0002BF D038 CD89D8          17      CALL    _SYS0A      ;(BDOS)文字列入力
0002C2 D03B CD66D2          17      CALL    LTNL
       D03E                     COMMAND2:
0002C5 D03E 118200          10      LD  DE,DTA1+2
0002C8 D041 CDFDF0          17      CALL    _COMANL
0002CB D044 30D8            12      JR  NC,COMMAND
0002CD D046 1179F0          10      LD  DE,COMERM
0002D0 D049 CD42D5          17      CALL    _SYS09      ;(BDOS)文字列出力
0002D3 D04C C7              12      RST 0
                                
       D04D                     COMANL:
0002D4 D04D CD37DC          17      CALL    FILE
0002D7 D050 3A19F0          13      LD  A,(FNAME+4)
0002DA D053 FE20             7      CP  020H
0002DC D055 201C            12      JR  NZ,COMB2
0002DE D057 D5              11      PUSH    DE
0002DF D058 1115F0          10      LD  DE,FNAME
0002E2 D05B 1A               7      LD  A,(DE)
0002E3 D05C FE20             7      CP  020H
0002E5 D05E 2844            12      JR  Z,SDVSW
0002E7 D060 1B               6      DEC DE
0002E8 D061 1A               7      LD  A,(DE)
0002E9 D062 C6FF             7      ADD A,0FFH
0002EB D064 3809            12      JR  C,COMB
0002ED D066 13               6      INC DE
                                
0002EE D067 21D4D4          10      LD  HL,COMTB
0002F1 D06A 060A             7      LD  B,COMS
0002F3 D06C CDBBDE          17      CALL    CPNAME
       D06F                     COMB:
0002F6 D06F D1              10      POP DE
0002F7 D070 D20F00          10      JP  NC,JP_HL
       D073                     COMB2:
0002FA D073 EB               4      EX  DE,HL
0002FB D074 2240D1          16      LD  (COMPAT+1),HL
0002FE D077 F5              11      PUSH    AF
0002FF D078 CDF8D0          17      CALL    CEXE4
000302 D07B F1              10      POP AF
000303 D07C 2115F0          10      LD  HL,FNAME
000306 D07F 116D00          10      LD  DE,FCB2+1   ;COMMAND NAME
000309 D082 010B00          10      LD  BC,11
00030C D085 EDB0                    LDIR
00030E D087 11B6EB          10      LD  DE,PATHD
       D08A                     CEX1:
000311 D08A 1A               7      LD  A,(DE)
000312 D08B FE20             7      CP  020H
000314 D08D D8              11      RET C
000315 D08E CD2CDC          17      CALL    FILEC
000318 D091 D5              11      PUSH    DE
000319 D092 216D00          10      LD  HL,FCB2+1   ;COMMAND NAME
00031C D095 1115F0          10      LD  DE,FNAME
00031F D098 010B00          10      LD  BC,11
000322 D09B EDB0                    LDIR
000324 D09D CDF8D0          17      CALL    CEXE4
000327 D0A0 D1              10      POP DE
000328 D0A1 13               6      INC DE
000329 D0A2 18E6            12      JR  CEX1
                                
       D0A4                     SDVSW:
00032B D0A4 F1              10      POP AF
00032C D0A5 3A14F0          13      LD  A,(FDRV)
00032F D0A8 3D               4      DEC A
000330 D0A9 5F               4      LD  E,A
000331 D0AA 0E0E             7      LD  C,00EH      ;(BDOS)カレントドライブの設定
000333 D0AC 1831            12      JR  SYSTEM0
                                
       D0AE                     OPEN1:
000335 D0AE 2114F0          10      LD  HL,FDRV
       D0B1                     OPEN:
000338 D0B1 0E11             7      LD  C,011H      ;(BDOS)ファイルの検索
       D0B3                     OPEN3:
00033A D0B3 D5              11      PUSH    DE
00033B D0B4 11F7EB          10      LD  DE,DTA_CCP
00033E D0B7 CDD5D0          17      CALL    SETDTA
000341 D0BA EB               4      EX  DE,HL
000342 D0BB CDDFD0          17      CALL    SYSTEM0
000345 D0BE D1              10      POP DE
000346 D0BF C9              10      RET
                                
       D0C0                     OPEN2:
000347 D0C0 0E12             7      LD  C,012H
000349 D0C2 18EF            12      JR  OPEN3
                                
       D0C4                     DEFCB:              ;Z=Ok NZ=Error
00034B D0C4 11F7EB          10      LD  DE,DTA_CCP
00034E D0C7 CDDDD0          17      CALL    SYSC0F
                                
000351 D0CA 1118EC          10      LD  DE,DTA_CCP+33   ;(FCB)ランダムレコード
000354 D0CD 0604             7      LD  B,4
000356 D0CF CDA4D3          17      CALL    ZERO_MEMORY_DE
       D0D2                     SETDTA100:
000359 D0D2 110001          10      LD  DE,00100H
       D0D5                     SETDTA:
00035C D0D5 C31AD7          10      JP  _SYS1A      ;(BDOS)DTAの設定
                                
       D0D8                     SETDTA1:
00035F D0D8 118000          10      LD  DE,DTA1
000362 D0DB 18F8            12      JR  SETDTA
                                
       D0DD                     SYSC0F:
000364 D0DD 0E0F             7      LD  C,00FH      ;(BDOS)ファイルのオープン
       D0DF                     SYSTEM0:
000366 D0DF CD0500          17      CALL    SYSTEM
000369 D0E2 B7               4      OR  A
00036A D0E3 C9              10      RET
                                
       D0E4                     C_CD:
00036B D0E4 0E5A             7      LD  C,5AH
00036D D0E6 18F7            12      JR  SYSTEM0
                                
       D0E8                     S27BUF:
00036F D0E8 3A0700          13      LD  A,(SYSTEM+2)
000372 D0EB 3D               4      DEC A
000373 D0EC E6F8             7      AND 0F8H
000375 D0EE 67               4      LD  H,A
000376 D0EF 2E00             7      LD  L,0
       D0F1                     S27DTA:
000378 D0F1 11F7EB          10      LD  DE,DTA_CCP
       D0F4                     S27:
00037B D0F4 0E27             7      LD  C,027H      ;(BDOS)ランダムブロック読み込み
00037D D0F6 18E7            12      JR  SYSTEM0
                                
       D0F8                     CEXE4:
00037F D0F8 211DF0          10      LD  HL,FNAME+8
000382 D0FB 7E               7      LD  A,(HL)
000383 D0FC FE20             7      CP  020H
000385 D0FE 2007            12      JR  NZ,CEXE7
000387 D100 3E3F             7      LD  A,'?'
000389 D102 77               7      LD  (HL),A
00038A D103 23               6      INC HL
00038B D104 77               7      LD  (HL),A
00038C D105 23               6      INC HL
00038D D106 77               7      LD  (HL),A
       D107                     CEXE7:
00038E D107 CDAED0          17      CALL    OPEN1
       D10A                     CEXE5:
000391 D10A C0              11      RET NZ
000392 D10B 2A01EC          16      LD  HL,(DTA_CCP+1+9)
000395 D10E 7C               4      LD  A,H
000396 D10F CD43DF          17      CALL    CAP
000399 D112 67               4      LD  H,A
00039A D113 7D               4      LD  A,L
00039B D114 CD43DF          17      CALL    CAP
00039E D117 6F               4      LD  L,A
00039F D118 3A00EC          13      LD  A,(DTA_CCP+1+8)
0003A2 D11B CD43DF          17      CALL    CAP
0003A5 D11E D642             7      SUB 'B'
0003A7 D120 282C            12      JR  Z,C_BAT
0003A9 D122 3D               4      DEC A       ;'C'
0003AA D123 2805            12      JR  Z,C_EXE
       D125                     CEXE6:
0003AC D125 CDC0D0          17      CALL    OPEN2
0003AF D128 18E0            12      JR  CEXE5
                                
       D12A                     C_EXE:
0003B1 D12A 7C               4      LD  A,H
0003B2 D12B FE4D             7      CP  'M'
0003B4 D12D 20F6            12      JR  NZ,CEXE6
                                
0003B6 D12F CDC4D0          17      CALL    DEFCB
0003B9 D132 CDE8D0          17      CALL    S27BUF
0003BC D135 3D               4      DEC A
0003BD D136 37               4      SCF
0003BE D137 C0              11      RET NZ
0003BF D138 7C               4      LD  A,H
0003C0 D139 B5               4      OR  L
0003C1 D13A 37               4      SCF
0003C2 D13B C8              11      RET Z
0003C3 D13C CDD8D0          17      CALL    SETDTA1
0003C6 D13F 110000          10  COMPAT: LD  DE,0                ; self-modifying code
0003C9 D142 ED7B0600        20      LD  SP,(SYSTEM+1)
0003CD D146 67               4      LD  H,A             ; A=0 in SETDTA1(_SYS1A)
0003CE D147 6F               4      LD  L,A
0003CF D148 E5              11      PUSH    HL              ; push $0000 (reboot address)
0003D0 D149 24               4      INC H
0003D1 D14A E5              11      PUSH    HL              ; push $0100 (TPA address)
0003D2 D14B C36FD3          10      JP  SETFCB              ; and JP $0100
                                
       D14E                     C_BAT:
0003D5 D14E 114154          10      LD  DE,'A'+'T'*256
0003D8 D151 ED52            15      SBC HL,DE
0003DA D153 20D0            12      JR  NZ,CEXE6
                                
0003DC D155 CDC4D0          17      CALL    DEFCB
                                
0003DF D158 21F7EB          10      LD  HL,DTA_CCP
0003E2 D15B 111CEC          10      LD  DE,FCB_BAT
0003E5 D15E 012500          10      LD  BC,37
0003E8 D161 EDB0                    LDIR
       D163                     C_BAT1:
0003EA D163 CDD2D0          17      CALL    SETDTA100
0003ED D166 CD9AD1          17      CALL    FGETC_BAT
0003F0 D169 218100          10      LD  HL,DTA1+1
0003F3 D16C 2025            12      JR  NZ,END_BATCH
0003F5 D16E FE21             7      CP  021H        ;スペースや改行など制御文字を飛ばす
0003F7 D170 38F1            12      JR  C,C_BAT1
0003F9 D172 3620            10      LD  (HL),' '
0003FB D174 23               6      INC HL
       D175                     C_BAT2:
0003FC D175 77               7      LD  (HL),A
0003FD D176 23               6      INC HL
0003FE D177 7D               4      LD  A,L
0003FF D178 3C               4      INC A       ;L==0FFH
000400 D179 2809            12      JR  Z,RUN_BATCH
000402 D17B CD9AD1          17      CALL    FGETC_BAT
000405 D17E 2004            12      JR  NZ,RUN_BATCH
000407 D180 FE20             7      CP  020H
000409 D182 30F1            12      JR  NC,C_BAT2
       D184                     RUN_BATCH:
00040B D184 7D               4      LD  A,L
00040C D185 D67F             7      SUB DTA1-1
00040E D187 328000          13      LD  (DTA1),A
000411 D18A FE04             7      CP  4
000413 D18C 3805            12      JR  C,END_BATCH
000415 D18E 3600            10      LD  (HL),0
000417 D190 C33ED0          10      JP  COMMAND2
       D193                     END_BATCH:
00041A D193 AF               4      XOR A       ;バッチファイルを閉じる
00041B D194 321CEC          13      LD  (FCB_BAT),A
00041E D197 C300F0          10      JP  CPM_BOOT
                                
       D19A                     FGETC_BAT:
000421 D19A 111CEC          10      LD  DE,FCB_BAT
       D19D                     FGETC:              ;1文字ずつ読み込む
000424 D19D E5              11      PUSH    HL      ;Z:成功
000425 D19E 210100          10      LD  HL,1
000428 D1A1 CDF4D0          17      CALL    S27
00042B D1A4 E1              10      POP HL
00042C D1A5 3A0001          13      LD  A,(00100H)
00042F D1A8 C9              10      RET
                                
       D1A9                     C_DEL:
000430 D1A9 CD6FD3          17      CALL    SETFCB
000433 D1AC CD3FD8          17      CALL    _SYS08      ;(BDOS)エコーなしコンソール入力
                                
000436 D1AF 0E13             7      LD  C,013H
000438 D1B1 180A            12      JR  CDEL1       ;(BDOS)ファイルの削除
                                
       D1B3                     C_REN:
00043A D1B3 CD6FD3          17      CALL    SETFCB
00043D D1B6 3E10             7      LD  A,010H      ;ディレクトリも対象にする
00043F D1B8 326900          13      LD  (FCB1+13),A ;属性
000442 D1BB 0E17             7      LD  C,017H      ;(BDOS)ファイル名の変更
       D1BD                     CDEL1:
000444 D1BD 115C00          10      LD  DE,FCB1
000447 D1C0 CD0500          17      CALL    SYSTEM
00044A D1C3 C6FF             7      ADD A,0FFH
00044C D1C5 C9              10      RET
                                
       D1C6                     C_DIR:
00044D D1C6 CD2CDC          17      CALL    FILEC
000450 D1C9 2115F0          10      LD  HL,FDRV+1
000453 D1CC CDBAD4          17      CALL    CWILD1
000456 D1CF 3EF1             7      LD  A,0F1H
000458 D1D1 3221F0          13      LD  (FDRV+13),A
00045B D1D4 CDAED0          17      CALL    OPEN1
       D1D7                     CDIR1:
00045E D1D7 B7               4      OR  A
00045F D1D8 2008            12      JR  NZ,PDSKF
000461 D1DA CD25D2          17      CALL    P_NAME
000464 D1DD CDC0D0          17      CALL    OPEN2
000467 D1E0 18F5            12      JR  CDIR1
                                
       D1E2                     PDSKF:
000469 D1E2 3A14F0          13      LD  A,(FDRV)
00046C D1E5 5F               4      LD  E,A
00046D D1E6 0E1B             7      LD  C,01BH      ;(BDOS)ディスク情報の獲得
00046F D1E8 CD0500          17      CALL    SYSTEM
000472 D1EB 4F               4      LD  C,A     ;C←1クラスタ辺りの論理セクタ数
000473 D1EC C601             7      ADD A,001H
000475 D1EE D8              11      RET C       ;Aが0FFHだった場合
000476 D1EF 3E06             7      LD  A,8-2
       D1F1                     PDS1:               ;HL=未使用クラスタの総数
000478 D1F1 3C               4      INC A
000479 D1F2 CB19             8      RR  C
00047B D1F4 30FB            12      JR  NC,PDS1
       D1F6                     PDS2:               ;B←論理セクタのサイズの上位8ビット
00047D D1F6 3C               4      INC A
00047E D1F7 CB18             8      RR  B
000480 D1F9 30FB            12      JR  NC,PDS2
000482 D1FB 47               4      LD  B,A
                                
000483 D1FC 110000          10      LD  DE,0
       D1FF                     PDS3:
000486 D1FF 29              11      ADD HL,HL
000487 D200 EB               4      EX  DE,HL
000488 D201 ED6A            15      ADC HL,HL
00048A D203 EB               4      EX  DE,HL
00048B D204 10F9            13      DJNZ    PDS3
       D206                     PDSKF1:
00048D D206 CD9ED2          17      CALL    PRDEC_DEHL
000490 D209 1141EC          10      LD  DE,FREE
000493 D20C CD42D5          17      CALL    _SYS09      ;(BDOS)文字列出力
000496 D20F CD8DD2          17      CALL    PUTDRV
000499 D212 3E5C             7      LD  A,05CH      ;\
00049B D214 CD29D8          17      CALL    MSG_A
00049E D217 2A22F0          16      LD  HL,(FDRV+14)    ;ディレクトリのクラスタ番号
0004A1 D21A AF               4      XOR A
0004A2 D21B 11FEFF          10      LD  DE,0-2
0004A5 D21E 19              11      ADD HL,DE
0004A6 D21F 23               6      INC HL
0004A7 D220 DC9AD2          17      CALL    C,PRDEC_HL
0004AA D223 1841            12      JR  LTNL
                                
       D225                     P_NAME:
0004AC D225 3AF8EB          13      LD  A,(DTA_CCP+1)
0004AF D228 FE2E             7      CP  '.'
0004B1 D22A C8              11      RET Z
0004B2 D22B 11D0D4          10      LD  DE,DIRHD
0004B5 D22E CD42D5          17      CALL    _SYS09      ;(BDOS)文字列出力
0004B8 D231 3A03EC          13      LD  A,(DTA_CCP+1+00BH)
0004BB D234 F5              11      PUSH    AF
0004BC D235 0F               4      RRCA
0004BD D236 9F               4      SBC A,A
0004BE D237 E60A             7      AND '*'-020H
0004C0 D239 C620             7      ADD A,020H
0004C2 D23B CD29D8          17      CALL    MSG_A
0004C5 D23E CD8DD2          17      CALL    PUTDRV
0004C8 D241 21F8EB          10      LD  HL,DTA_CCP+1
0004CB D244 CDDED2          17      CALL    FPRNT
                                
0004CE D247 F1              10      POP AF
0004CF D248 CB67             8      BIT 4,A
0004D1 D24A 2808            12      JR  Z,DIR3
0004D3 D24C 11C5D4          10      LD  DE,DIRMES
0004D6 D24F CD42D5          17      CALL    _SYS09      ;(BDOS)文字列出力
0004D9 D252 180A            12      JR  DIR6
       D254                     DIR3:
0004DB D254 ED5B16EC        20      LD  DE,(DTA_CCP+1+01EH)
0004DF D258 2A14EC          16      LD  HL,(DTA_CCP+1+01CH)
0004E2 D25B CD9ED2          17      CALL    PRDEC_DEHL
       D25E                     DIR6:
0004E5 D25E 3AB1F0          13      LD  A,(_WIDTH)
0004E8 D261 FE29             7      CP  40+1
0004EA D263 D400D3          17      CALL    NC,PRTTMS
                                
       D266                     LTNL:
0004ED D266 1E03             7      LD  E,3
0004EF D268 C3CDF0          10      JP  _PRINT
                                
       D26B                     C_PATH:
0004F2 D26B CD0EDD          17      CALL    SPCUT
0004F5 D26E 21B6EB          10      LD  HL,PATHD
0004F8 D271 FE21             7      CP  021H
0004FA D273 300C            12      JR  NC,CPATH0
       D275                     CPATHP:
0004FC D275 7E               7      LD  A,(HL)
0004FD D276 23               6      INC HL
0004FE D277 FE20             7      CP  020H
000500 D279 3F               4      CCF
000501 D27A 30EA            12      JR  NC,LTNL
000503 D27C CD29D8          17      CALL    MSG_A
000506 D27F 18F4            12      JR  CPATHP
       D281                     CPATH0:
000508 D281 FE3B             7      CP  ';'
00050A D283 2001            12      JR  NZ,CPATH1
00050C D285 13               6      INC DE
       D286                     CPATH1:
00050D D286 EB               4      EX  DE,HL
00050E D287 014000          10      LD  BC,PATHX
000511 D28A EDB0                    LDIR
000513 D28C C9              10      RET
                                
       D28D                     PUTDRV:
000514 D28D 3A14F0          13      LD  A,(FDRV)
000517 D290 C640             7      ADD A,'A'-1
000519 D292 CD29D8          17      CALL    MSG_A
00051C D295 3E3A             7      LD  A,':'
       D297                     MSG_AR:
00051E D297 C329D8          10      JP  MSG_A
                                
       D29A                     PRDEC_HL:
000521 D29A AF               4      XOR A
       D29B                     PRDEC_AHL:
000522 D29B 5F               4      LD  E,A
000523 D29C 1600             7      LD  D,0
       D29E                     PRDEC_DEHL:
000525 D29E D5              11      PUSH    DE
000526 D29F 110FF0          10      LD  DE,DECBF
000529 D2A2 0605             7      LD  B,5
00052B D2A4 CDA4D3          17      CALL    ZERO_MEMORY_DE  ;A=0
00052E D2A7 D1              10      POP DE
                                
00052F D2A8 0E20             7      LD  C,32
       D2AA                     DEC1:
000531 D2AA 29              11      ADD HL,HL
000532 D2AB EB               4      EX  DE,HL
000533 D2AC ED6A            15      ADC HL,HL
000535 D2AE EB               4      EX  DE,HL
000536 D2AF E5              11      PUSH    HL
000537 D2B0 2113F0          10      LD  HL,DECBF+4
00053A D2B3 0605             7      LD  B,5
       D2B5                     DEC2:
00053C D2B5 7E               7      LD  A,(HL)
00053D D2B6 8F               4      ADC A,A
00053E D2B7 27               4      DAA
00053F D2B8 77               7      LD  (HL),A
000540 D2B9 2B               6      DEC HL
000541 D2BA 10F9            13      DJNZ    DEC2
000543 D2BC E1              10      POP HL
000544 D2BD 0D               4      DEC C
000545 D2BE 20EA            12      JR  NZ,DEC1
                                
000547 D2C0 210FF0          10      LD  HL,DECBF
00054A D2C3 3E20             7      LD  A,020H
00054C D2C5 0604             7      LD  B,4
       D2C7                     DEC3:
00054E D2C7 CDD4D2          17      CALL    DEC4
000551 D2CA CDD4D2          17      CALL    DEC4
000554 D2CD 23               6      INC HL
000555 D2CE 10F7            13      DJNZ    DEC3
       D2D0                     DECX:
000557 D2D0 CDD4D2          17      CALL    DEC4
00055A D2D3 AF               4      XOR A
       D2D4                     DEC4:
00055B D2D4 ED6F            18      RLD
00055D D2D6 FE20             7      CP  020H
00055F D2D8 2802            12      JR  Z,DEC5
000561 D2DA F630             7      OR  030H
       D2DC                     DEC5:
000563 D2DC 18B9            12      JR  MSG_AR
                                
       D2DE                     FPRNT:
000565 D2DE 0608             7      LD  B,8
000567 D2E0 CDF1D2          17      CALL    P_N1
00056A D2E3 7E               7      LD  A,(HL)
00056B D2E4 C680             7      ADD A,0A0H-020H
00056D D2E6 FEA0             7      CP  0A0H
00056F D2E8 2802            12      JR  Z,FPR1
000571 D2EA 3E2E             7      LD  A,'.'
       D2EC                     FPR1:
000573 D2EC CD29D8          17      CALL    MSG_A
000576 D2EF 0603             7      LD  B,3
                                
       D2F1                     P_N1:
000578 D2F1 C5              11      PUSH    BC
000579 D2F2 E5              11      PUSH    HL
00057A D2F3 7E               7      LD  A,(HL)
00057B D2F4 CD4FDF          17      CALL    CAP3
00057E D2F7 CD29D8          17      CALL    MSG_A
000581 D2FA E1              10      POP HL
000582 D2FB C1              10      POP BC
000583 D2FC 23               6      INC HL
000584 D2FD 10F2            13      DJNZ    P_N1
000586 D2FF C9              10      RET
                                
       D300                     PRTTMS:
000587 D300 3E20             7      LD  A,020H
000589 D302 CD29D8          17      CALL    MSG_A
                                
00058C D305 2A10EC          16      LD  HL,(DTA_CCP+1+24)
00058F D308 7D               4      LD  A,L
000590 D309 B7               4      OR  A
000591 D30A C8              11      RET Z
000592 D30B CB3C             8      SRL H
000594 D30D 17               4      RLA
000595 D30E 17               4      RLA
000596 D30F 17               4      RLA
000597 D310 17               4      RLA
000598 D311 E60F             7      AND 00FH
00059A D313 57               4      LD  D,A
00059B D314 7C               4      LD  A,H
00059C D315 C650             7      ADD A,80
00059E D317 CD5AD3          17      CALL    PRDEC_A
0005A1 D31A 3E2D             7      LD  A,'-'
0005A3 D31C CD29D8          17      CALL    MSG_A
0005A6 D31F 7A               4      LD  A,D
0005A7 D320 CD5AD3          17      CALL    PRDEC_A
0005AA D323 3E2D             7      LD  A,'-'
0005AC D325 CD29D8          17      CALL    MSG_A
0005AF D328 7D               4      LD  A,L
0005B0 D329 E61F             7      AND 01FH
0005B2 D32B CD5AD3          17      CALL    PRDEC_A
                                
0005B5 D32E 2A0EEC          16      LD  HL,(DTA_CCP+1+22)
                                
0005B8 D331 3E20             7      LD  A,020H
0005BA D333 CD29D8          17      CALL    MSG_A
0005BD D336 7C               4      LD  A,H
0005BE D337 65               4      LD  H,L
0005BF D338 0603             7      LD  B,3
       D33A                     PRTTMS1:
0005C1 D33A 1F               4      RRA
0005C2 D33B CB1D             8      RR  L
0005C4 D33D 10FB            13      DJNZ    PRTTMS1
0005C6 D33F E61F             7      AND 01FH
0005C8 D341 CD5AD3          17      CALL    PRDEC_A
0005CB D344 3E3A             7      LD  A,':'
0005CD D346 CD29D8          17      CALL    MSG_A
0005D0 D349 7D               4      LD  A,L
0005D1 D34A 0F               4      RRCA
0005D2 D34B 0F               4      RRCA
0005D3 D34C E63F             7      AND 03FH
0005D5 D34E CD5AD3          17      CALL    PRDEC_A
0005D8 D351 3E3A             7      LD  A,':'
0005DA D353 CD29D8          17      CALL    MSG_A
0005DD D356 7C               4      LD  A,H
0005DE D357 E61F             7      AND 01FH
0005E0 D359 87               4      ADD A,A
                                
                                ;   PRINT10
                                
       D35A                     PRDEC_A:
0005E1 D35A E5              11      PUSH    HL
0005E2 D35B 0608             7      LD  B,8
0005E4 D35D 4F               4      LD  C,A
0005E5 D35E AF               4      XOR A
       D35F                     PRTA1:
0005E6 D35F CB01             4      RLC C
0005E8 D361 8F               4      ADC A,A
0005E9 D362 27               4      DAA
0005EA D363 10FA            13      DJNZ    PRTA1
0005EC D365 210FF0          10      LD  HL,DECBF
0005EF D368 77               7      LD  (HL),A
0005F0 D369 AF               4      XOR A
0005F1 D36A CDD0D2          17      CALL    DECX
0005F4 D36D E1              10      POP HL
0005F5 D36E C9              10      RET
                                
       D36F                     SETFCB:
0005F6 D36F CD0EDD          17      CALL    SPCUT
0005F9 D372 1A               7      LD  A,(DE)
0005FA D373 FE20             7      CP  020H
0005FC D375 3801            12      JR  C,SETFCBA
0005FE D377 1B               6      DEC DE
       D378                     SETFCBA:
0005FF D378 0624             7      LD  B,36
000601 D37A 215C00          10      LD  HL,FCB1
000604 D37D E5              11      PUSH    HL
000605 D37E AF               4      XOR A
000606 D37F CDE3DC          17      CALL    FILL_MEMORY
000609 D382 E1              10      POP HL
00060A D383 D5              11      PUSH    DE
00060B D384 CD80D7          17      CALL    _SYS5C      ;(BDOS)ファイル名の解析
00060E D387 216C00          10      LD  HL,FCB2
000611 D38A CD80D7          17      CALL    _SYS5C      ;(BDOS)ファイル名の解析
000614 D38D E1              10      POP HL
000615 D38E 010050          10      LD  BC,05000H
000618 D391 118100          10      LD  DE,00081H
       D394                     SETFCB1:
00061B D394 7E               7      LD  A,(HL)
00061C D395 23               6      INC HL
00061D D396 FE20             7      CP  020H
00061F D398 3805            12      JR  C,SETFCB2
000621 D39A 12               7      LD  (DE),A
000622 D39B 13               6      INC DE
000623 D39C 0C               4      INC C
000624 D39D 10F5            13      DJNZ    SETFCB1
       D39F                     SETFCB2:
000626 D39F 79               4      LD  A,C
000627 D3A0 328000          13      LD  (DTA1),A
00062A D3A3 04               4      INC B
       D3A4                     ZERO_MEMORY_DE:
00062B D3A4 AF               4      XOR A
       D3A5                     FILL_MEMORY_DE:
00062C D3A5 12               7      LD  (DE),A
00062D D3A6 13               6      INC DE
00062E D3A7 10FC            13      DJNZ    FILL_MEMORY_DE
000630 D3A9 C9              10      RET
                                
       D3AA                     C_COPY:
000631 D3AA CD6FD3          17      CALL    SETFCB
                                
000634 D3AD 1161F0          10      LD  DE,ZERO
000637 D3B0 CD2FDC          17      CALL    FILEC2
00063A D3B3 216C00          10      LD  HL,FCB2
00063D D3B6 CD87D7          17      CALL    S29X1
                                
000640 D3B9 3E10             7      LD  A,010H
000642 D3BB 326900          13      LD  (FCB1+13),A
000645 D3BE 216D00          10      LD  HL,FCB2+1
000648 D3C1 CDBAD4          17      CALL    CWILD1
       D3C4                     COPY0:
00064B D3C4 CDB7D4          17      CALL    CWILD
00064E D3C7 215C00          10      LD  HL,FCB1
000651 D3CA CDB1D0          17      CALL    OPEN
000654 D3CD 37               4      SCF
       D3CE                     COPY1:
000655 D3CE C0              11      RET NZ
000656 D3CF CDC4D0          17      CALL    DEFCB
                                
000659 D3D2 3A04EC          13      LD  A,(DTA_CCP+13)
00065C D3D5 CB67             8      BIT 4,A
00065E D3D7 2821            12      JR  Z,COPY1A
                                
000660 D3D9 215D00          10      LD  HL,FCB1+1
000663 D3DC CD72E0          17      CALL    CHKWILD
000666 D3DF 3814            12      JR  C,COPY9
                                
000668 D3E1 3E20             7      LD  A,020H
00066A D3E3 325D00          13      LD  (FCB1+1),A
00066D D3E6 2A11EC          16      LD  HL,(DTA_CCP+26)
000670 D3E9 23               6      INC HL
000671 D3EA 226A00          16      LD  (FCB1+14),HL
000674 D3ED 18D5            12      JR  COPY0
                                
       D3EF                     COPY8:
000676 D3EF CD42D5          17      CALL    _SYS09      ;(BDOS)文字列出力
000679 D3F2 CD66D2          17      CALL    LTNL
       D3F5                     COPY9:
00067C D3F5 CDC0D0          17      CALL    OPEN2
00067F D3F8 18D4            12      JR  COPY1
                                
       D3FA                     COPY1A:
000681 D3FA 216C00          10      LD  HL,FCB2
000684 D3FD 1114F0          10      LD  DE,FDRV
000687 D400 01F9EB          10      LD  BC,DTA_CCP+2
00068A D403 EDA0            16      LDI
00068C D405 3E0B             7      LD  A,11
       D407                     COPY2:
00068E D407 F5              11      PUSH    AF
00068F D408 7E               7      LD  A,(HL)
000690 D409 FE3F             7      CP  '?'
000692 D40B 2001            12      JR  NZ,COPY3
000694 D40D 0A               7      LD  A,(BC)
       D40E                     COPY3:
000695 D40E 12               7      LD  (DE),A
000696 D40F 03               6      INC BC
000697 D410 13               6      INC DE
000698 D411 23               6      INC HL
000699 D412 F1              10      POP AF
00069A D413 3D               4      DEC A
00069B D414 20F1            12      JR  NZ,COPY2
00069D D416 010500          10      LD  BC,16-11
0006A0 D419 EDB0                    LDIR
       D41B                     PUTNAME:
0006A2 D41B 215D00          10      LD  HL,FCB1+1
0006A5 D41E CD72E0          17      CALL    CHKWILD
0006A8 D421 300B            12      JR  NC,PUTN1
0006AA D423 2115F0          10      LD  HL,FDRV+1
0006AD D426 CDDED2          17      CALL    FPRNT
0006B0 D429 3E20             7      LD  A,020H
0006B2 D42B CD29D8          17      CALL    MSG_A
       D42E                     PUTN1:
0006B5 D42E 1114F0          10      LD  DE,FDRV
0006B8 D431 0E16             7      LD  C,016H      ;(BDOS)ファイルの作成
0006BA D433 CDDFD0          17      CALL    SYSTEM0
0006BD D436 2048            12      JR  NZ,COPYE2
0006BF D438 67               4      LD  H,A     ;A=0
0006C0 D439 6F               4      LD  L,A
0006C1 D43A 2235F0          16      LD  (FDRV+33),HL    ;(FCB)ランダムレコード
0006C4 D43D 2237F0          16      LD  (FDRV+35),HL
       D440                     COPY6:
0006C7 D440 CDE8D0          17      CALL    S27BUF
0006CA D443 47               4      LD  B,A
0006CB D444 3C               4      INC A
0006CC D445 2831            12      JR  Z,COPYE
0006CE D447 7C               4      LD  A,H
0006CF D448 B5               4      OR  L
0006D0 D449 280C            12      JR  Z,COPY7
0006D2 D44B 1114F0          10      LD  DE,FDRV
0006D5 D44E 0E26             7      LD  C,026H      ;(BDOS)ランダムブロック書き込み
0006D7 D450 CDDFD0          17      CALL    SYSTEM0
0006DA D453 2023            12      JR  NZ,COPYE
0006DC D455 10E9            13      DJNZ    COPY6
       D457                     COPY7:
0006DE D457 3A04EC          13      LD  A,(DTA_CCP+13)  ;(FCB)属性
0006E1 D45A 3221F0          13      LD  (FDRV+13),A
0006E4 D45D 210BEC          10      LD  HL,DTA_CCP+20   ;(FCB)タイムスタンプ
0006E7 D460 1128F0          10      LD  DE,FDRV+20
0006EA D463 010400          10      LD  BC,4
0006ED D466 EDB0                    LDIR
                                
0006EF D468 1114F0          10      LD  DE,FDRV
0006F2 D46B 0E10             7      LD  C,010H      ;(BDOS)ファイルのクローズ
0006F4 D46D CDDFD0          17      CALL    SYSTEM0
0006F7 D470 2006            12      JR  NZ,COPYE
                                
0006F9 D472 1171F0          10      LD  DE,OK
0006FC D475 C3EFD3          10      JP  COPY8
                                
       D478                     COPYE:
0006FF D478 1114F0          10      LD  DE,FDRV
000702 D47B 0E13             7      LD  C,013H      ;(BDOS)ファイルの削除
000704 D47D CD0500          17      CALL    SYSTEM
       D480                     COPYE2:
000707 D480 37               4      SCF
000708 D481 C9              10      RET
                                
       D482                     C_TYPE:
000709 D482 CD6FD3          17      CALL    SETFCB
00070C D485 215C00          10      LD  HL,FCB1
00070F D488 CDB1D0          17      CALL    OPEN
000712 D48B 37               4      SCF
       D48C                     TYPE1:
000713 D48C C0              11      RET NZ
000714 D48D CDC4D0          17      CALL    DEFCB
000717 D490 3E06             7      LD  A,6
000719 D492 CD29D8          17      CALL    MSG_A
       D495                     TYPE2:
00071C D495 CDE8D0          17      CALL    S27BUF
00071F D498 C6FE             7      ADD A,0FEH
000721 D49A D8              11      RET C
000722 D49B 7C               4      LD  A,H
000723 D49C B5               4      OR  L
000724 D49D 2813            12      JR  Z,TYPEE
000726 D49F 010001          10      LD  BC,00100H
       D4A2                     TYPE3:
000729 D4A2 0A               7      LD  A,(BC)
00072A D4A3 03               6      INC BC
00072B D4A4 FE1A             7      CP  01AH
00072D D4A6 280A            12      JR  Z,TYPEE
00072F D4A8 CD29D8          17      CALL    MSG_A
000732 D4AB 2B               6      DEC HL
000733 D4AC 7C               4      LD  A,H
000734 D4AD B5               4      OR  L
000735 D4AE 20F2            12      JR  NZ,TYPE3
000737 D4B0 18E3            12      JR  TYPE2
       D4B2                     TYPEE:
000739 D4B2 CDC0D0          17      CALL    OPEN2
00073C D4B5 18D5            12      JR  TYPE1
                                
       D4B7                     CWILD:
00073E D4B7 215D00          10      LD  HL,FCB1+1
       D4BA                     CWILD1:
000741 D4BA 7E               7      LD  A,(HL)
000742 D4BB FE20             7      CP  020H
000744 D4BD C0              11      RET NZ
       D4BE                     CWILD2:
000745 D4BE 3E3F             7      LD  A,'?'
000747 D4C0 060B             7      LD  B,11
000749 D4C2 C3E3DC          10      JP  FILL_MEMORY
                                
00074C D4C5 20202020203C4449    DIRMES: DB  "     <DIR>$"
            523E24              
000757 D4D0 20203A24            DIRHD:  DB  "  :$"
                                
       D4D4                     COMTB:
00075B D4D4 44202020                DB  "D   "  ;1
00075F D4D8 C6D1                    DW  C_DIR
000761 D4DA 44495220                DB  "DIR "  ;2
000765 D4DE C6D1                    DW  C_DIR
000767 D4E0 434F5059                DB  "COPY"  ;3
00076B D4E4 AAD3                    DW  C_COPY
00076D D4E6 43442020                DB  "CD  "  ;4
000771 D4EA E4D0                    DW  C_CD
000773 D4EC 44454C20                DB  "DEL "  ;5
000777 D4F0 A9D1                    DW  C_DEL
000779 D4F2 50415448                DB  "PATH"  ;6
00077D D4F6 6BD2                    DW  C_PATH
00077F D4F8 52454E20                DB  "REN "  ;7
000783 D4FC B3D1                    DW  C_REN
000785 D4FE 54595045                DB  "TYPE"  ;8
000789 D502 82D4                    DW  C_TYPE
00078B D504 52454D20                DB  "REM "  ;9
00078F D508 3FD5                    DW  C_REM
[EOF:LDCCP.ASM:SHIFT_JIS]
                                    INCLUDE "M7CCP2.ASM"
                                
                                ;   LSX-Dodgers CCP2
                                ;   MZ-700/1500
                                
000791 D50A 4D4F4E20                DB  "MON "  ;10
000795 D50E DCCF                    DW  C_MON
[EOF:M7CCP2.ASM:UTF_8]
                                    INCLUDE "LDOS.ASM"
                                
                                ;   LSX-Dodgers OS
                                
       D510                     BDOS0:
000797 D510 E5              11      PUSH    HL
000798 D511 79               4      LD  A,C
000799 D512 FE3C             7      CP  03CH
00079B D514 3802            12      JR  C,DOS1
00079D D516 3E3C             7      LD  A,03CH
       D518                     DOS1:
00079F D518 87               4      ADD A,A
0007A0 D519 6F               4      LD  L,A
0007A1 D51A 26F1             7      LD  H,STABLE/256
0007A3 D51C 7E               7      LD  A,(HL)
0007A4 D51D 2C               4      INC L
0007A5 D51E 66               7      LD  H,(HL)
0007A6 D51F 6F               4      LD  L,A
0007A7 D520 E3              19      EX  (SP),HL
0007A8 D521 79               4      LD  A,C
                                ;確認用
                                ;   LD  (0050H),A
0007A9 D522 C9              10      RET
       D523                     _DOS2:
0007AA D523 FE5A             7      CP  05AH        ;(BDOS)カレントディレクトリの変更(_CHDIR)
0007AC D525 CAC4D7          10      JP  Z,_SYS5A
0007AF D528 FE5C             7      CP  05CH        ;(BDOS)ファイル名の解析(_PFILE)
0007B1 D52A CA80D7          10      JP  Z,_SYS5C
0007B4 D52D FE5F             7      CP  05FH        ;(BDOS)ディスクバッファのフラッシュ(_FLUSH)
0007B6 D52F CAA7E9          10      JP  Z,_SYS5F
0007B9 D532 FE6F             7      CP  06FH        ;(BDOS)MSX-DOS のバージョン番号の獲得(_DOSVER)
0007BB D534 200A            12      JR  NZ,_ERROR
0007BD D536 011D01          10      LD  BC,011DH
0007C0 D539 115301          10      LD  DE,VER
0007C3 D53C 210100          10      LD  HL,MACD
       D53F                     C_REM:
0007C6 D53F AF               4      XOR A
       D540                     _ERROR:
0007C7 D540 A7               4      AND A
0007C8 D541 C9              10      RET
                                
       D542                     _SYS09:     ;文字列出力
0007C9 D542 D5              11      PUSH    DE
       D543                     _SX09:
0007CA D543 1A               7      LD  A,(DE)
0007CB D544 13               6      INC DE
0007CC D545 FE24             7      CP  '$'
0007CE D547 2831            12      JR  Z,SX0E2
0007D0 D549 CD29D8          17      CALL    MSG_A
0007D3 D54C 18F5            12      JR  _SX09
                                
       D54E                     MSX1:
0007D5 D54E CD29D8          17      CALL    MSG_A
       D551                     MSX:
0007D8 D551 7E               7      LD  A,(HL)
0007D9 D552 23               6      INC HL
0007DA D553 B7               4      OR  A
0007DB D554 20F8            12      JR  NZ,MSX1
0007DD D556 C9              10      RET
                                
       D557                     _SYS0C:     ;(BDOS)バージョン番号の獲得
0007DE D557 212200          10      LD  HL,00022H
0007E1 D55A 7D               4      LD  A,L
0007E2 D55B C9              10      RET
                                
       D55C                     _SYS0D:     ;(BDOS)ディスクリセット
0007E3 D55C CDDFF0          17      CALL    _FFLUSH
0007E6 D55F E5              11      PUSH    HL
0007E7 D560 218000          10      LD  HL,00080H
0007EA D563 228AF0          16      LD  (_DTA),HL
0007ED D566 E1              10      POP HL
0007EE D567 D5              11      PUSH    DE
0007EF D568 1E00             7      LD  E,0
0007F1 D56A 3E                      DB  03EH
                                
       D56B                     _SYS0E:     ;(BDOS)カレントドライブの設定
0007F2 D56B D5              11      PUSH    DE
0007F3 D56C 7B               4      LD  A,E
0007F4 D56D DDE5            15      PUSH    IX
0007F6 D56F CDDCF0          17      CALL    _GETDPB
0007F9 D572 DDE1            14      POP IX
0007FB D574 3804            12      JR  C,SX0E2
0007FD D576 7B               4      LD  A,E
0007FE D577 3287F0          13      LD  (_DVSW),A
       D57A                     SX0E2:
000801 D57A D1              10      POP DE
000802 D57B C9              10      RET
                                
       D57C                     _SYS0F:     ;(BDOS)ファイルのオープン
000803 D57C CD20DD          17      CALL    SETDRV
000806 D57F FD7E1C          19      LD  A,(IY+28)   ;(FCB)オープンモード
000809 D582 C602             7      ADD A,002H      ;Write
00080B D584 2848            12      JR  Z,FEND0F
00080D D586 CD6EE0          17      CALL    CHKWILDX
                                
000810 D589 D440DD          17      CALL    NC,SOPENX
       D58C                     _S16XX:
000813 D58C 3840            12      JR  C,FEND0F
                                                ;Directory location
000815 D58E 3A9FF0          13      LD  A,(_FILEN)
000818 D591 FD7719          19      LD  (IY+25),A   ;(FCB)ディレクトリロケーション
                                ;               _DIRF
00081B D594 3AA0F0          13      LD  A,(_DIRF)
00081E D597 FD771D          19      LD  (IY+29),A   ;(FCB)ディレクトリモード
                                ;               _FBPS
000821 D59A FD731E          19      LD  (IY+30),E   ;(FCB)ディレクトリポジション
000824 D59D FD721F          19      LD  (IY+31),D
                                ;               Open(Read)
000827 D5A0 FD361CFF        19      LD  (IY+28),0FFH    ;(FCB)オープンモード
                                ;               FILENAME
00082B D5A4 FDE5            15      PUSH    IY
00082D D5A6 D1              10      POP DE
00082E D5A7 13               6      INC DE
00082F D5A8 010B00          10      LD  BC,11
000832 D5AB EDB0                    LDIR
                                ;               Attribute
000834 D5AD 7E               7      LD  A,(HL)
000835 D5AE FD770D          19      LD  (IY+13),A   ;(FCB)属性(アトリビュート)
000838 D5B1 110B00          10      LD  DE,11       ;Reserved
00083B D5B4 19              11      ADD HL,DE
                                                    ;(FCB)ファイルを最後に変更した時刻
00083C D5B5 11EAF1          10      LD  DE,SDDATA       ;(FCB)ファイルを最後に変更した日付
00083F D5B8 060A             7      LD  B,SDDATAE-SDDATA    ;(FCB)ファイルの先頭クラスタ
       D5BA                     S16LOOP:                ;(FCB)ファイルのサイズ(バイト単位)
000841 D5BA 1A               7      LD  A,(DE)
000842 D5BB 13               6      INC DE
000843 D5BC 32C3D5          13      LD  (S16PAT+2),A
000846 D5BF 7E               7      LD  A,(HL)
000847 D5C0 23               6      INC HL
000848 D5C1 FD7700          19  S16PAT: LD  (IY+0),A
00084B D5C4 10F4            13      DJNZ    S16LOOP
                                
00084D D5C6 AF               4      XOR A
00084E D5C7 FD770C          19      LD  (IY+12),A   ;(FCB)カレントブロック
000851 D5CA FD2272D6        20      LD  (OFCB+1),IY
       D5CE                     FEND0F:
000855 D5CE 1845            12      JR  FEND10
                                
       D5D0                     _SYS10:     ;(BDOS)ファイルのクローズ
000857 D5D0 CD20DD          17      CALL    SETDRV
00085A D5D3 FD7E1C          19      LD  A,(IY+28)   ;(FCB)オープンモード
00085D D5D6 D6FE             7      SUB 0FEH
00085F D5D8 37               4      SCF
000860 D5D9 3F               4      CCF
000861 D5DA 2039            12      JR  NZ,FEND10
       D5DC                     _S10A:              ;Write
000863 D5DC FD770E          19      LD  (IY+14),A   ;(FCB)レコードサイズ/アクセスするディレクトリのクラスタ番号+1
000866 D5DF FD770F          19      LD  (IY+15),A
                                
000869 D5E2 FD341C          23      INC (IY+28)     ;0FEH->0FFH ;オープンモード
00086C D5E5 CD66E1          17      CALL    SETTMS
                                
00086F D5E8 FD7E1D          19      LD  A,(IY+29)   ;(FCB)ディレクトリモード
000872 D5EB 32A0F0          13      LD  (_DIRF),A
000875 D5EE E67F             7      AND 07FH
000877 D5F0 32B1E6          13      LD  (_SECPS+1),A
00087A D5F3 FD5E1E          19      LD  E,(IY+30)   ;(FCB)ディレクトリポジション
00087D D5F6 FD561F          19      LD  D,(IY+31)
000880 D5F9 CD74DE          17      CALL    READ_DIR
000883 D5FC 3817            12      JR  C,FEND10
                                
000885 D5FE 3A9EDD          13  SDECM1: LD  A,(SDECPAT+1)   ;1セクタ辺りのディレクトリエントリ数
000888 D601 3D               4      DEC A       ;1024=01FH / 512=00FH / 256=7
000889 D602 FDA619          19      AND (IY+25)     ;(FCB)ディレクトリロケーション
00088C D605 6F               4      LD  L,A
00088D D606 2600             7      LD  H,0
00088F D608 29              11      ADD HL,HL       ;*2
000890 D609 29              11      ADD HL,HL       ;*4
000891 D60A 29              11      ADD HL,HL       ;*8
000892 D60B 29              11      ADD HL,HL       ;*16
000893 D60C 29              11      ADD HL,HL       ;*32
000894 D60D ED4B7EF1        20      LD  BC,(_DTBUF)
000898 D611 09              11      ADD HL,BC
                                
000899 D612 CD7EE0          17      CALL    SDIRENT
       D615                     FEND10:
00089C D615 1842            12      JR  FEND
                                
       D617                     _SYS11:     ;(BDOS)最初のファイルの検索
00089E D617 CD20DD          17      CALL    SETDRV
0008A1 D61A CD6DDD          17      CALL    SOPEN
       D61D                     _S12X1:
0008A4 D61D 383A            12      JR  C,FEND
0008A6 D61F CD0DDE          17      CALL    SOPENE2
0008A9 D622 ED5B8AF0        20      LD  DE,(_DTA)
0008AD D626 3A88F0          13      LD  A,(_DRV)
0008B0 D629 3C               4      INC A
0008B1 D62A 12               7      LD  (DE),A
0008B2 D62B D5              11      PUSH    DE
0008B3 D62C 13               6      INC DE
0008B4 D62D 012000          10      LD  BC,32
0008B7 D630 EDB0                    LDIR
0008B9 D632 FD6E0E          19      LD  L,(IY+14)   ;(FCB)レコードサイズ/アクセスするディレクトリのクラスタ番号+1
0008BC D635 FD660F          19      LD  H,(IY+15)
0008BF D638 22F4F1          16      LD  (SCDIR),HL
0008C2 D63B 2A9AF0          16      LD  HL,(_FBPS)
0008C5 D63E 22F6F1          16      LD  (SFBPS),HL
0008C8 D641 2A9FF0          16      LD  HL,(_FILEN)
0008CB D644 7C               4      LD  A,H
0008CC D645 B7               4      OR  A
0008CD D646 2806            12      JR  Z,_S12DIR
0008CF D648 3AB1E6          13      LD  A,(_SECPS+1)
0008D2 D64B F680             7      OR  080H
0008D4 D64D 67               4      LD  H,A
       D64E                     _S12DIR:
0008D5 D64E 22F8F1          16      LD  (SFNDF),HL  ;Directory position and Flags
0008D8 D651 E1              10      POP HL
0008D9 D652 1139F0          10      LD  DE,SFILE
0008DC D655 0E21             7      LD  C,33
       D657                     _S11B:
0008DE D657 EDB0                    LDIR
       D659                     FEND:
0008E0 D659 9F               4      SBC A,A     ;CF=0 A=0 : CF=1 A=0FFH
       D65A                     FENDE:
0008E1 D65A FDE1            14      POP IY
0008E3 D65C C1              10      POP BC
0008E4 D65D D1              10      POP DE
0008E5 D65E E1              10      POP HL
0008E6 D65F C9              10      RET
                                
       D660                     _SYS12:     ;(BDOS)次のファイルの検索
0008E7 D660 E5              11      PUSH    HL
0008E8 D661 D5              11      PUSH    DE
0008E9 D662 C5              11      PUSH    BC
0008EA D663 FDE5            15      PUSH    IY
0008EC D665 CDD1DD          17      CALL    NOPEN
0008EF D668 18B3            12      JR  _S12X1
                                
       D66A                     _S16K:
0008F1 D66A FD7E1C          19      LD  A,(IY+28)   ;(FCB)オープンモード
0008F4 D66D FEFD             7      CP  0FDH        ;Device(0FDH)
0008F6 D66F 37               4      SCF
0008F7 D670 C8              11      RET Z
                                
0008F8 D671 110000          10  OFCB:   LD  DE,0
0008FB D674 D5              11      PUSH    DE
0008FC D675 061A             7      LD  B,26        ;First cluster
       D677                     S16K1:
0008FE D677 13               6      INC DE
0008FF D678 23               6      INC HL
000900 D679 10FC            13      DJNZ    S16K1
                                
000902 D67B 1A               7      LD  A,(DE)
000903 D67C BE               7      CP  (HL)
000904 D67D 2013            12      JR  NZ,S16K2
000906 D67F 13               6      INC DE
000907 D680 23               6      INC HL
000908 D681 1A               7      LD  A,(DE)
000909 D682 BE               7      CP  (HL)
00090A D683 200D            12      JR  NZ,S16K2
                                
00090C D685 E1              10      POP HL
00090D D686 FDE5            15      PUSH    IY
00090F D688 D1              10      POP DE
000910 D689 1A               7      LD  A,(DE)      ;Drive
000911 D68A BE               7      CP  (HL)
000912 D68B 2006            12      JR  NZ,S16K3
                                                ;ここはCFが必ず0
000914 D68D ED52            15      SBC HL,DE       ;CP HL,DE
000916 D68F 37               4      SCF
000917 D690 C0              11      RET NZ
000918 D691 E5              11      PUSH    HL
       D692                     S16K2:
000919 D692 E1              10      POP HL
       D693                     S16K3:
00091A D693 FDE5            15      PUSH    IY
00091C D695 D1              10      POP DE
       D696                     _SYS13:     ;(BDOS)ファイルの削除
00091D D696 CD20DD          17      CALL    SETDRV
000920 D699 CD9EDF          17      CALL    KILL
       D69C                     FEND13:
000923 D69C 18BB            12      JR  FEND
                                
       D69E                     _SYS14:     ;(BDOS)シーケンシャルな読み出し
000925 D69E CD20DD          17      CALL    SETDRV
000928 D6A1 CDD2E1          17      CALL    INIT_SEQ
       D6A4                     SREAD:
00092B D6A4 CD1CE2          17      CALL    RB_READ
                                
00092E D6A7 C601             7      ADD A,001H
000930 D6A9 38AE            12      JR  C,FEND
                                
000932 D6AB 7D               4      LD  A,L
000933 D6AC D601             7      SUB 001H
       D6AE                     FENDX:
000935 D6AE 9F               4      SBC A,A
000936 D6AF E603             7      AND 3
000938 D6B1 1F               4      RRA
000939 D6B2 18A6            12      JR  FENDE
                                
       D6B4                     _SYS15:     ;(BDOS)シーケンシャルな書き込み
00093B D6B4 CD20DD          17      CALL    SETDRV
00093E D6B7 CDD2E1          17      CALL    INIT_SEQ
       D6BA                     SWRITE:
000941 D6BA CD15E2          17      CALL    RB_WRITE
                                
000944 D6BD C6FF             7      ADD A,0FFH
000946 D6BF 18ED            12      JR  FENDX
                                
       D6C1                     _SYS17:     ;(BDOS)ファイル名の変更
000948 D6C1 CD20DD          17      CALL    SETDRV
00094B D6C4 CDF4DF          17      CALL    NAME
00094E D6C7 18D3            12      JR  FEND13
                                
       D6C9                     _SYS16:     ;(BDOS)ファイルの作成
000950 D6C9 CD20DD          17      CALL    SETDRV
                                
000953 D6CC CD6EE0          17      CALL    CHKWILDX
000956 D6CF 38CB            12      JR  C,FEND13
000958 D6D1 FD7E01          19      LD  A,(IY+1)    ;(FCB)主ファイル名
00095B D6D4 FE05             7      CP  5
00095D D6D6 2805            12      JR  Z,_S16X2
00095F D6D8 FE21             7      CP  021H
000961 D6DA DA9CD6          10      JP  C,FEND13
       D6DD                     _S16X2:
                                ;               Clear FCB
000964 D6DD FDE5            15      PUSH    IY
000966 D6DF E1              10      POP HL
000967 D6E0 011000          10      LD  BC,16
00096A D6E3 09              11      ADD HL,BC
       D6E4                     _S16X1:
00096B D6E4 70               7      LD  (HL),B      ;B=0
00096C D6E5 23               6      INC HL
00096D D6E6 0D               4      DEC C
00096E D6E7 20FB            12      JR  NZ,_S16X1
                                
000970 D6E9 CD6BE1          17      CALL    SETTMSX
000973 D6EC FD360DFF        19      LD  (IY+13),0FFH    ;(FCB)Attribute
000977 D6F0 CD40DD          17      CALL    SOPENX
00097A D6F3 3F               4      CCF
00097B D6F4 CC6AD6          17      CALL    Z,_S16K
00097E D6F7 D41EDE          17      CALL    NC,COPEN
000981 D6FA D47EE0          17      CALL    NC,SDIRENT
000984 D6FD C38CD5          10      JP  _S16XX
                                
       D700                     _SYS21:     ;(BDOS)ランダムな読み出し
000987 D700 CD20DD          17      CALL    SETDRV
00098A D703 CDB6E1          17      CALL    INIT_RND
00098D D706 189C            12      JR  SREAD
                                
       D708                     _SYS22:     ;(BDOS)ランダムな書き込み
       D708                     _SYS28:     ;(BDOS)ランダムな書き込み・その2
00098F D708 CD20DD          17      CALL    SETDRV
000992 D70B CDB6E1          17      CALL    INIT_RND
000995 D70E 18AA            12      JR  SWRITE
                                
       D710                     _SYS18:     ;(BDOS)ログインベクトルの獲得
000997 D710 21FF00          10      LD  HL,000FFH
00099A D713 AF               4      XOR A
00099B D714 C9              10      RET
                                
       D715                     _SYS19:     ;(BDOS)カレントドライブ番号の獲得
00099C D715 3A87F0          13      LD  A,(_DVSW)
00099F D718 A7               4      AND A
0009A0 D719 C9              10      RET
                                
       D71A                     _SYS1A:     ;(BDOS)DTAの設定
0009A1 D71A ED538AF0        20      LD  (_DTA),DE
0009A5 D71E AF               4      XOR A
0009A6 D71F C9              10      RET
                                
       D720                     _SYS1B:     ;(BDOS)ディスク情報の獲得
0009A7 D720 7B               4      LD  A,E
0009A8 D721 CD33DD          17      CALL    GETDRV
0009AB D724 CDDCF0          17      CALL    _GETDPB
0009AE D727 D4E2F0          17      CALL    NC,_RDFATX
0009B1 D72A 210000          10      LD  HL,0
0009B4 D72D D444E1          17      CALL    NC,DSKF
                                
0009B7 D730 ED5B45E1        20      LD  DE,(MAXCLP+1)   ;DPB_08_MAXCL-1
0009BB D734 1B               6      DEC DE      ;DE←クラスタの総数
0009BC D735 FD2A7CF1        20      LD  IY,(_FATBF) ;IY←メモリ上のFATの先頭アドレス
0009C0 D739 9F               4      SBC A,A
0009C1 D73A D8              11      RET C
0009C2 D73B 4F               4      LD  C,A     ;C=0
0009C3 D73C DD7E0F          19      LD  A,(IX+00FH) ;DPB_0F_BPS
0009C6 D73F E60F             7      AND 00FH
0009C8 D741 47               4      LD  B,A
0009C9 D742 DD7E07          19      LD  A,(IX+7)    ;DPB_07_SECPCL
0009CC D745 C9              10      RET
                                
       D746                     _SYS1D:     ;(BDOS)書き込みが禁止されているディスクの調査
0009CD D746 AF               4      XOR A
0009CE D747 67               4      LD  H,A
0009CF D748 6F               4      LD  L,A
0009D0 D749 C9              10      RET
                                
       D74A                     _SYS1F:     ;(BDOS)ディスク装置のパラメータの読み出し
0009D1 D74A 2100F2          10      LD  HL,DEVICE
0009D4 D74D 7B               4      LD  A,E
0009D5 D74E C3DCF0          10      JP  _GETDPB
                                
       D751                     _SYS23:     ;(BDOS)ファイルサイズの獲得
0009D8 D751 E5              11      PUSH    HL
0009D9 D752 2A1EF1          16      LD  HL,(STABLE+2*00FH)  ;ファイルのオープン
0009DC D755 CD0F00          17      CALL    JP_HL
0009DF D758 381B            12      JR  C,_S23X1
                                
0009E1 D75A D5              11      PUSH    DE      ;EX DE,IY
0009E2 D75B FDE3            23      EX  (SP),IY     ;
                                ;   POP DE      ;
                                ;   PUSH    DE      ;DEを破壊しないように注意vv
0009E4 D75D FD7E10          19      LD  A,(IY+16)   ;(FCB)ファイルのサイズ(バイト単位)
0009E7 D760 FD6E11          19      LD  L,(IY+17)   ;
0009EA D763 FD6612          19      LD  H,(IY+18)   ;
0009ED D766 C5              11      PUSH    BC      ;
0009EE D767 FD4613          19      LD  B,(IY+19)   ;
0009F1 D76A CDA8E1          17      CALL    GET_CPM_R_SIZE
0009F4 D76D C1              10      POP BC
       D76E                     _S24X1:
0009F5 D76E CDC8E1          17      CALL    SET_RR_AHL
                                ;   POP DE      ;^^^^^^^^^^^^^^^^^^^^^^^^
                                ;   PUSH    DE      ;EX DE,IY
0009F8 D771 FDE3            23      EX  (SP),IY     ;
0009FA D773 D1              10      POP DE      ;
                                
0009FB D774 AF               4      XOR A
       D775                     _S23X1:
0009FC D775 E1              10      POP HL
0009FD D776 C9              10      RET
                                
       D777                     _SYS24:     ;(BDOS)ランダムレコードフィールドの設定
0009FE D777 E5              11      PUSH    HL
0009FF D778 D5              11      PUSH    DE      ;EX DE,IY
000A00 D779 FDE3            23      EX  (SP),IY     ;
                                ;   POP DE      ;
                                ;   PUSH    DE      ;DEを破壊しないように注意vv
000A02 D77B CDDAE1          17      CALL    GETSEQ
000A05 D77E 18EE            12      JR  _S24X1      ;^^^^^^^^^^^^^^^^^^^^^^^^
                                
       D780                     _SYS5C:     ;(BDOS)ファイル名の解析
000A07 D780 C5              11      PUSH    BC
000A08 D781 E5              11      PUSH    HL
000A09 D782 CD37DC          17      CALL    FILE
000A0C D785 E1              10      POP HL
000A0D D786 C1              10      POP BC
       D787                     S29X1:
000A0E D787 C5              11      PUSH    BC
000A0F D788 D5              11      PUSH    DE
000A10 D789 E5              11      PUSH    HL
000A11 D78A EB               4      EX  DE,HL
000A12 D78B 2114F0          10      LD  HL,FDRV
000A15 D78E 010D00          10      LD  BC,13
000A18 D791 EDB0                    LDIR
000A1A D793 70               7      LD  (HL),B      ;B=0
000A1B D794 0E03             7      LD  C,3
000A1D D796 EDB0                    LDIR
000A1F D798 E1              10      POP HL
000A20 D799 D1              10      POP DE
000A21 D79A C1              10      POP BC
000A22 D79B AF               4      XOR A
000A23 D79C C9              10      RET
                                
       D79D                     _SYS30:     ;(BDOS)論理セクタを用いた書き込み
000A24 D79D C5              11      PUSH    BC
000A25 D79E 014BE8          10      LD  BC,DWT24B
000A28 D7A1 1804            12      JR  S2FX
       D7A3                     _SYS2F:
000A2A D7A3 C5              11      PUSH    BC
000A2B D7A4 013BE8          10      LD  BC,DRD24B
       D7A7                     S2FX:
000A2E D7A7 ED43BDD7        20      LD  (S2FPAT+1),BC
000A32 D7AB CDDFF0          17      CALL    _FFLUSH
                                
000A35 D7AE D5              11      PUSH    DE
000A36 D7AF E5              11      PUSH    HL
000A37 D7B0 7D               4      LD  A,L     ;Drive
000A38 D7B1 CDD9F0          17      CALL    _CHGDRV
000A3B D7B4 3809            12      JR  C,S30X2
000A3D D7B6 44               4      LD  B,H     ;Number of clusters
000A3E D7B7 2A8AF0          16      LD  HL,(_DTA)
                                
000A41 D7BA 0E00             7      LD  C,0
000A43 D7BC CD3BE8          17  S2FPAT: CALL    DRD24B
       D7BF                     S30X2:
000A46 D7BF E1              10      POP HL
000A47 D7C0 D1              10      POP DE
000A48 D7C1 C1              10      POP BC
000A49 D7C2 9F               4      SBC A,A
000A4A D7C3 C9              10      RET
                                
       D7C4                     _SYS5A:     ;(BDOS)カレントディレクトリの変更
000A4B D7C4 C5              11      PUSH    BC
000A4C D7C5 D5              11      PUSH    DE
000A4D D7C6 E5              11      PUSH    HL
000A4E D7C7 CD2CDC          17      CALL    FILEC
000A51 D7CA 210000          10      LD  HL,0
000A54 D7CD 1114F0          10      LD  DE,FDRV
000A57 D7D0 2A4EF1          16      LD  HL,(STABLE+2*027H)  ;ランダムブロック読み込み
000A5A D7D3 CD0F00          17      CALL    JP_HL
000A5D D7D6 18E7            12      JR  S30X2
[EOF:LDOS.ASM:SHIFT_JIS]
                                    INCLUDE "M7IO.ASM"
                                
                                ;   LSX-Dodgers IO
                                ;   MZ-700/1500
                                
       D540                     _SYS04  EQU _ERROR      ;(BDOS)外部出力
       D540                     _SYS05  EQU _ERROR      ;(BDOS)プリンタ出力
       D540                     _SYS1C  EQU _ERROR      ;(BDOS)ディスクの書き込み禁止化
       D540                     _SYS1E  EQU _ERROR      ;(BDOS)ファイル属性の設定
       D540                     _SYS20  EQU _ERROR      ;(BDOS)利用者番号の設定と読み出し
       D540                     _SYS2E  EQU _ERROR      ;(BDOS)ベリファイ・フラグの設定
                                
       0000                     INT EQU 0
       0000                     INTCTCE EQU 0
       0000                     INTCTC2 EQU 0
                                
       D7D8                     ARWKEY:
000A5F D7D8 3D               4      DEC A
000A60 D7D9 32EBD7          13      LD  (KEYAR),A
000A63 D7DC 181D            12      JR  INT8253E
       D7DE                     SETKEY1:
000A65 D7DE 3A95F0          13      LD  A,(_KEYSP+1)
000A68 D7E1 180C            12      JR  SETKEY
       D7E3                     INT8253:
000A6A D7E3 CDBEDB          17      CALL    CHKEY
       D7E7                     KEYDT   EQU $+1
000A6D D7E6 FE00             7      CP  0
000A6F D7E8 20F4            12      JR  NZ,SETKEY1
       D7EB                     KEYAR   EQU $+1
000A71 D7EA 3E00             7      LD  A,0
000A73 D7EC B7               4      OR  A
000A74 D7ED 20E9            12      JR  NZ,ARWKEY
       D7EF                     SETKEY:
000A76 D7EF 32EBD7          13      LD  (KEYAR),A
000A79 D7F2 3A92F0          13      LD  A,(_KEYD)
000A7C D7F5 32E7D7          13      LD  (KEYDT),A
000A7F D7F8 CDFED7          17      CALL    KEYSET
       D7FB                     INT8253E:
000A82 D7FB F1              10      POP AF
000A83 D7FC FB               4      EI
000A84 D7FD C9              10      RET
       D7FE                     KEYSET:
       D7FE                     KEYBS:
000A85 D7FE B7               4      OR  A
000A86 D7FF C8              11      RET Z
       D800                     KEYBS1:
000A87 D800 CD16D8          17      CALL    KEYBC_IFBREAK
000A8A D803 E5              11      PUSH    HL
000A8B D804 F5              11      PUSH    AF
000A8C D805 2A90F0          16      LD  HL,(_KEYPS)
000A8F D808 2C               4      INC L
000A90 D809 7D               4      LD  A,L
000A91 D80A BC               4      CP  H
000A92 D80B 2815            12      JR  Z,POP_AF_HL_SCF_RET
000A94 D80D 3290F0          13      LD  (_KEYPS),A
000A97 D810 26FF             7      LD  H,KEYBF/256
000A99 D812 F1              10      POP AF
000A9A D813 77               7      LD  (HL),A
000A9B D814 E1              10      POP HL
000A9C D815 C9              10      RET
       D816                     KEYBC_IFBREAK:
000A9D D816 FE03             7      CP  3
000A9F D818 C0              11      RET NZ
       D819                     KEYBC:
000AA0 D819 E5              11      PUSH    HL
000AA1 D81A 210000          10      LD  HL,0
000AA4 D81D 2290F0          16      LD  (_KEYPS),HL
000AA7 D820 E1              10      POP HL
000AA8 D821 C9              10      RET
                                
       D822                     POP_AF_HL_SCF_RET:
000AA9 D822 F1              10      POP AF
000AAA D823 E1              10      POP HL
000AAB D824 37               4      SCF
000AAC D825 C9              10      RET
                                
       D826                     _SYS01:     ;(BDOS)コンソール入力
000AAD D826 CD09F0          17      CALL    _SYS07
       D829                     MSG_A:
000AB0 D829 F5              11      PUSH    AF
000AB1 D82A D5              11      PUSH    DE
000AB2 D82B 5F               4      LD  E,A
000AB3 D82C CD32D8          17      CALL    _SYS02
000AB6 D82F D1              10      POP DE
000AB7 D830 F1              10      POP AF
000AB8 D831 C9              10      RET
                                
       D832                     _SYS02:     ;(BDOS)コンソール出力
000AB9 D832 CD44D8          17      CALL    BREAK
000ABC D835 1805            12      JR  PRINTX
                                
       D837                     _SYS06:     ;(BDOS)コンソール直接入出力
000ABE D837 7B               4      LD  A,E
000ABF D838 3C               4      INC A
000AC0 D839 CACAF0          10      JP  Z,_INKEY
       D83C                     PRINTX:
000AC3 D83C C3CDF0          10      JP  _PRINT
                                
       D83F                     _SYS08:     ;(BDOS)エコーなしコンソール入力
000AC6 D83F CD09F0          17      CALL    _SYS07
000AC9 D842 1804            12      JR  BREAK1
       D844                     BREAK:
000ACB D844 FB               4      EI
000ACC D845 3A92F0          13      LD  A,(_KEYD)
       D848                     BREAK1:
000ACF D848 FE03             7      CP  3       ;CTRL+C
000AD1 D84A CCF4F0          17      CALL    Z,_BREAK
000AD4 D84D FE13             7      CP  013H        ;CTRL+S
000AD6 D84F C0              11      RET NZ
                                
       D850                     PAUSE:
000AD7 D850 CD19D8          17      CALL    KEYBC
                                
       D853                     FLGET:
000ADA D853 CDDFF0          17      CALL    _FFLUSH
000ADD D856 E5              11      PUSH    HL
000ADE D857 2A8EF0          16      LD  HL,(_TXADR)
000AE1 D85A 7C               4      LD  A,H
000AE2 D85B C6D0             7      ADD A,0D0H
000AE4 D85D 67               4      LD  H,A
000AE5 D85E CD37CF          17      CALL    RDMMIO
000AE8 D861 3276D8          13      LD  (FLSMC),A
       D864                     FLGET1:
000AEB D864 CD2DCF          17      CALL    RD556VSYNC
000AEE D867 CB77             8      BIT 6,A
000AF0 D869 3EEF             7      LD  A,0EFH      ;カーソル
000AF2 D86B 200A            12      JR  NZ,FLGET2
000AF4 D86D 3A92F0          13      LD  A,(_KEYD)
000AF7 D870 B7               4      OR  A
000AF8 D871 3EEF             7      LD  A,0EFH      ;カーソル
000AFA D873 2002            12      JR  NZ,FLGET2
       D876                     FLSMC   EQU $+1
000AFC D875 3E00             7      LD  A,0     ;自己書き換え
       D877                     FLGET2:
000AFE D877 CD3FCF          17      CALL    WRMMIO
000B01 D87A CDCAF0          17      CALL    _INKEY
000B04 D87D 28E5            12      JR  Z,FLGET1
000B06 D87F F5              11      PUSH    AF
000B07 D880 3A76D8          13      LD  A,(FLSMC)
000B0A D883 CD3FCF          17      CALL    WRMMIO
000B0D D886 F1              10      POP AF
000B0E D887 E1              10      POP HL
000B0F D888 C9              10      RET
                                
       D889                     _SYS0A:     ;(BDOS)文字列入力
000B10 D889 C5              11      PUSH    BC
000B11 D88A E5              11      PUSH    HL
000B12 D88B D5              11      PUSH    DE
000B13 D88C CD1EDB          17      CALL    GETL
000B16 D88F 1120FF          10      LD  DE,KBUF
000B19 D892 E1              10      POP HL
000B1A D893 E5              11      PUSH    HL
000B1B D894 0E00             7      LD  C,0
000B1D D896 3004            12      JR  NC,SAX0
000B1F D898 23               6      INC HL
000B20 D899 23               6      INC HL
000B21 D89A 1808            12      JR  SAX4
       D89C                     SAX0:
000B23 D89C 46               7      LD  B,(HL)
000B24 D89D 23               6      INC HL
       D89E                     SAX1:
000B25 D89E 23               6      INC HL
000B26 D89F 1A               7      LD  A,(DE)
000B27 D8A0 13               6      INC DE
000B28 D8A1 B7               4      OR  A
000B29 D8A2 2004            12      JR  NZ,SAX2
       D8A4                     SAX4:
000B2B D8A4 360D            10      LD  (HL),00DH
000B2D D8A6 1804            12      JR  SAX3
       D8A8                     SAX2:
000B2F D8A8 77               7      LD  (HL),A
000B30 D8A9 0C               4      INC C
000B31 D8AA 10F2            13      DJNZ    SAX1
       D8AC                     SAX3:
000B33 D8AC D1              10      POP DE
000B34 D8AD 79               4      LD  A,C
000B35 D8AE 13               6      INC DE
000B36 D8AF 12               7      LD  (DE),A
000B37 D8B0 1B               6      DEC DE
000B38 D8B1 E1              10      POP HL
000B39 D8B2 C1              10      POP BC
000B3A D8B3 A7               4      AND A
000B3B D8B4 C9              10      RET
                                
       D8B5                     _SYS0B:     ;(BDOS)コンソール状態のチェック
000B3C D8B5 CD44D8          17      CALL    BREAK
000B3F D8B8 3A92F0          13      LD  A,(_KEYD)
000B42 D8BB B7               4      OR  A
000B43 D8BC C8              11      RET Z
       D8BD                     CONSTX:
000B44 D8BD CDDFF0          17      CALL    _FFLUSH
000B47 D8C0 E5              11      PUSH    HL
000B48 D8C1 2A90F0          16      LD  HL,(_KEYPS)
000B4B D8C4 7C               4      LD  A,H
000B4C D8C5 AD               4      XOR L
000B4D D8C6 E1              10      POP HL
000B4E D8C7 C6FF             7      ADD A,0FFH
000B50 D8C9 9F               4      SBC A,A
000B51 D8CA C9              10      RET
                                
       D8CB                     _SYS2A:     ;(BDOS)日付の獲得
000B52 D8CB AF               4      XOR A
000B53 D8CC 57               4      LD  D,A
000B54 D8CD 5F               4      LD  E,A
000B55 D8CE 67               4      LD  H,A
000B56 D8CF 6F               4      LD  L,A
000B57 D8D0 C9              10      RET
                                
       D8D1                     _SYS2C:     ;(BDOS)時刻の獲得
000B58 D8D1 AF               4      XOR A
000B59 D8D2 57               4      LD  D,A
000B5A D8D3 5F               4      LD  E,A
000B5B D8D4 67               4      LD  H,A
000B5C D8D5 6F               4      LD  L,A
000B5D D8D6 C9              10      RET
                                
       D8D7                     ESC1:
000B5E D8D7 7B               4      LD  A,E
000B5F D8D8 FE41             7      CP  'A'
000B61 D8DA CACFD9          10      JP  Z,CTRL1E
000B64 D8DD FE42             7      CP  'B'
000B66 D8DF CAE1DA          10      JP  Z,CTRL1F
000B69 D8E2 FE43             7      CP  'C'
000B6B D8E4 CAA2D9          10      JP  Z,CTRL1C
000B6E D8E7 FE44             7      CP  'D'
000B70 D8E9 CAC6D9          10      JP  Z,CTRL1D
000B73 D8EC FE45             7      CP  'E'
000B75 D8EE 2802            12      JR  Z,CT0CX
000B77 D8F0 FE6A             7      CP  'j'
       D8F2                     CT0CX:
000B79 D8F2 CAC6DA          10      JP  Z,CTRL0C
000B7C D8F5 FE48             7      CP  'H'
000B7E D8F7 CA43DA          10      JP  Z,CTRL0B
000B81 D8FA FE4A             7      CP  'J'
000B83 D8FC CAC9DA          10      JP  Z,CTRL06
000B86 D8FF FE4B             7      CP  'K'
000B88 D901 CA15DA          10      JP  Z,CTRL05
000B8B D904 FE4C             7      CP  'L'
000B8D D906 CAF3DA          10      JP  Z,CTRL0E
000B90 D909 FE54             7      CP  'T'
000B92 D90B CA15DA          10      JP  Z,CTRL05
000B95 D90E FE78             7      CP  'x'
000B97 D910 2804            12      JR  Z,ESC1X
000B99 D912 FE79             7      CP  'y'
000B9B D914 2002            12      JR  NZ,ESC1Y
       D916                     ESC1X:
000B9D D916 3601            10      LD  (HL),1
       D918                     ESC1Y:
000B9F D918 FE3D             7      CP  '='
000BA1 D91A 2804            12      JR  Z,ESC1W
000BA3 D91C FE59             7      CP  'Y'
000BA5 D91E 2002            12      JR  NZ,ESC1Z
       D920                     ESC1W:
000BA7 D920 3602            10      LD  (HL),2
       D922                     ESC1Z:
000BA9 D922 FE20             7      CP  020H
000BAB D924 3802            12      JR  C,ESC1C
000BAD D926 87               4      ADD A,A
000BAE D927 D0              11      RET NC
       D928                     ESC1C:
000BAF D928 E1              10      POP HL
000BB0 D929 1832            12      JR  ANK
                                
       D92B                     ESC:
000BB2 D92B 218ED9          10      LD  HL,PRINTE5
000BB5 D92E E5              11      PUSH    HL
000BB6 D92F 2151D9          10      LD  HL,ESCFLG
000BB9 D932 3600            10      LD  (HL),0
000BBB D934 3D               4      DEC A
000BBC D935 28A0            12      JR  Z,ESC1
000BBE D937 3D               4      DEC A
000BBF D938 2009            12      JR  NZ,ESC2
000BC1 D93A 3603            10      LD  (HL),3
000BC3 D93C 7B               4      LD  A,E
000BC4 D93D D620             7      SUB 020H
000BC6 D93F 3246D9          13      LD  (ESCYP+1),A
000BC9 D942 C9              10      RET
       D943                     ESC2:
000BCA D943 3D               4      DEC A
000BCB D944 C0              11      RET NZ
000BCC D945 2600             7  ESCYP:  LD  H,0
000BCE D947 7B               4      LD  A,E
000BCF D948 D620             7      SUB 020H
000BD1 D94A 6F               4      LD  L,A
000BD2 D94B C3D6F0          10      JP  _LOC
                                
       D94E                     PRINT:
000BD5 D94E C5              11      PUSH    BC
000BD6 D94F E5              11      PUSH    HL
       D951                     ESCFLG  EQU $+1
000BD7 D950 3E00             7      LD  A,000H      ;自己書き換え
000BD9 D952 B7               4      OR  A
000BDA D953 20D6            12      JR  NZ,ESC
                                
000BDC D955 3E1F             7      LD  A,01FH
000BDE D957 BB               4      CP  E
000BDF D958 3038            12      JR  NC,CTRL
       D95A                     INSFLG  EQU $
000BE1 D95A 019BDA          10      LD  BC,INSERT   ;自己書き換え
       D95D                     ANK:
000BE4 D95D 3A96F0          13      LD  A,(_COLORF)
000BE7 D960 4F               4      LD  C,A
000BE8 D961 7B               4      LD  A,E
000BE9 D962 FE61             7      CP  'a'     ;英小文字
000BEB D964 3806            12      JR  C,PRT1
000BED D966 FE7B             7      CP  'z'+1
000BEF D968 3002            12      JR  NC,PRT1
000BF1 D96A CBF9             8      SET 7,C
       D96C                     PRT1:
000BF3 D96C FE86             7      CP  $86     ;ひらがな1(を－そ)
000BF5 D96E 3806            12      JR  C,PRT2
000BF7 D970 FEA0             7      CP  $A0
000BF9 D972 3002            12      JR  NC,PRT2
000BFB D974 CBF9             8      SET 7,C
       D976                     PRT2:
000BFD D976 FEE0             7      CP  $E0     ;ひらがな2(たーん)
000BFF D978 3802            12      JR  C,PRT3
000C01 D97A CBF9             8      SET 7,C
       D97C                     PRT3:
000C03 D97C 2A8EF0          16      LD  HL,(_TXADR)
000C06 D97F 7C               4      LD  A,H
000C07 D980 C6D0             7      ADD A,0D0H
000C09 D982 67               4      LD  H,A
000C0A D983 42               4      LD  B,D
000C0B D984 16EE             7      LD  D,CD_TABLE/256
000C0D D986 1A               7      LD  A,(DE)
000C0E D987 50               4      LD  D,B
000C0F D988 CD57CF          17      CALL    IO_PRINT
000C12 D98B CDA2D9          17      CALL    CTRL1C
       D98E                     PRINTE5:
000C15 D98E E1              10      POP HL
000C16 D98F C1              10      POP BC
000C17 D990 AF               4      XOR A
000C18 D991 C9              10      RET
                                
       D992                     CTRL:
000C19 D992 7B               4      LD  A,E
000C1A D993 87               4      ADD A,A
000C1B D994 F680             7      OR  080H
000C1D D996 6F               4      LD  L,A
000C1E D997 26F1             7      LD  H,CTRLTB/256
000C20 D999 7E               7      LD  A,(HL)
000C21 D99A 2C               4      INC L
000C22 D99B 66               7      LD  H,(HL)
000C23 D99C 6F               4      LD  L,A
000C24 D99D CD0F00          17      CALL    JP_HL
000C27 D9A0 18EC            12      JR  PRINTE5
                                
       D9A2                     CTRL1C:
000C29 D9A2 ED4B8EF0        20      LD  BC,(_TXADR)
000C2D D9A6 03               6      INC BC
       D9A7                     PRINTE3:
000C2E D9A7 2118FC          10      LD  HL,0-WIDTH*LINE
000C31 D9AA A7               4      AND A
000C32 D9AB ED4A            15      ADC HL,BC
       D9AD                     PRINTE8:
000C34 D9AD 2805            12      JR  Z,PRINT2
000C36 D9AF ED438EF0        20      LD  (_TXADR),BC
       D9B3                     CTRL00:
000C3A D9B3 C9              10      RET
                                
       D9B4                     PRINT2:
000C3B D9B4 CDF9DA          17      CALL    SCR
000C3E D9B7 21D8FF          10      LD  HL,0-WIDTH
000C41 D9BA 09              11      ADD HL,BC
       D9BB                     SET_TXADR_HL:
000C42 D9BB 228EF0          16      LD  (_TXADR),HL
000C45 D9BE C9              10      RET
                                
       D9BF                     CTRL08:
000C46 D9BF 3A5AD9          13      LD  A,(INSFLG)
000C49 D9C2 FECD             7      CP  0CDH        ;CALL ????
000C4B D9C4 2823            12      JR  Z,CTRL02
       D9C6                     CTRL1D:
000C4D D9C6 2A8EF0          16      LD  HL,(_TXADR)
000C50 D9C9 7C               4      LD  A,H
000C51 D9CA B5               4      OR  L
000C52 D9CB C8              11      RET Z
000C53 D9CC 2B               6      DEC HL
000C54 D9CD 18EC            12      JR  SET_TXADR_HL
                                
       D9CF                     CTRL1E:
000C56 D9CF ED4B8EF0        20      LD  BC,(_TXADR)
000C5A D9D3 21D8FF          10      LD  HL,0-WIDTH
000C5D D9D6 09              11      ADD HL,BC
000C5E D9D7 D0              11      RET NC
000C5F D9D8 18E1            12      JR  SET_TXADR_HL
                                
       D9DA                     CTRL09:
000C61 D9DA ED4B8EF0        20      LD  BC,(_TXADR)
000C65 D9DE 79               4      LD  A,C
000C66 D9DF E6F8             7      AND 0F8H
000C68 D9E1 C608             7      ADD A,8
000C6A D9E3 4F               4      LD  C,A
000C6B D9E4 88               4      ADC A,B
000C6C D9E5 91               4      SUB C
000C6D D9E6 47               4      LD  B,A
000C6E D9E7 18BE            12      JR  PRINTE3
                                
       D9E9                     CTRL02:
000C70 D9E9 CDC6D9          17      CALL    CTRL1D
000C73 D9EC C8              11      RET Z
000C74 D9ED D5              11      PUSH    DE
000C75 D9EE CDD3F0          17      CALL    _POS
000C78 D9F1 54               4      LD  D,H
000C79 D9F2 3E28             7      LD  A,WIDTH
000C7B D9F4 95               4      SUB L
000C7C D9F5 4F               4      LD  C,A
000C7D D9F6 0D               4      DEC C
000C7E D9F7 06D0             7      LD  B,0D0H
000C80 D9F9 2A8EF0          16      LD  HL,(_TXADR)
000C83 D9FC 09              11      ADD HL,BC
000C84 D9FD 47               4      LD  B,A
                                
000C85 D9FE 3AB7DA          13      LD  A,(MULINE)
000C88 DA01 BA               4      CP  D
000C89 DA02 2007            12      JR  NZ,C02X1
000C8B DA04 112800          10      LD  DE,WIDTH
000C8E DA07 19              11      ADD HL,DE
000C8F DA08 78               4      LD  A,B
000C90 DA09 83               4      ADD A,E
000C91 DA0A 47               4      LD  B,A
       DA0B                     C02X1:
000C92 DA0B 3A96F0          13      LD  A,(_COLORF) ;C:Color
000C95 DA0E 4F               4      LD  C,A
000C96 DA0F AF               4      XOR A       ;A:Text
000C97 DA10 CD9ECF          17      CALL    IO_BS
000C9A DA13 D1              10      POP DE
000C9B DA14 C9              10      RET
                                
       DA15                     CTRL05:
000C9C DA15 CDD3F0          17      CALL    _POS
000C9F DA18 3E28             7      LD  A,WIDTH
000CA1 DA1A 95               4      SUB L
000CA2 DA1B 47               4      LD  B,A
       DA1C                     C08X1:
000CA3 DA1C 2A8EF0          16      LD  HL,(_TXADR)
000CA6 DA1F 7C               4      LD  A,H
000CA7 DA20 C6D0             7      ADD A,0D0H
000CA9 DA22 67               4      LD  H,A
       DA23                     CLLINE:
000CAA DA23 3A96F0          13      LD  A,(_COLORF)
000CAD DA26 4F               4      LD  C,A
000CAE DA27 AF               4      XOR A
000CAF DA28 C381CF          10      JP  IO_CLLINE
                                
       DA2B                     CTRL0D:
000CB2 DA2B CDD3F0          17      CALL    _POS
000CB5 DA2E 2E00             7      LD  L,0
       DA30                     LOC:
000CB7 DA30 C5              11      PUSH    BC
000CB8 DA31 E5              11      PUSH    HL
000CB9 DA32 CD50DA          17      CALL    LOC1
000CBC DA35 228EF0          16      LD  (_TXADR),HL
000CBF DA38 E1              10      POP HL
000CC0 DA39 C1              10      POP BC
000CC1 DA3A C9              10      RET
                                
       DA3B                     CTRL12:
000CC2 DA3B 215AD9          10      LD  HL,INSFLG
000CC5 DA3E 7E               7      LD  A,(HL)
000CC6 DA3F EECC             7      XOR 0CCH        ;CD:CALL ???? 1:LD BC,????
000CC8 DA41 77               7      LD  (HL),A
000CC9 DA42 C9              10      RET
                                
       DA43                     CTRL0B:
000CCA DA43 210000          10      LD  HL,0
000CCD DA46 228EF0          16      LD  (_TXADR),HL
000CD0 DA49 C9              10      RET
                                
       DA4A                     CTRL1B:
000CD1 DA4A 3E01             7      LD  A,1
000CD3 DA4C 3251D9          13      LD  (ESCFLG),A
000CD6 DA4F C9              10      RET
                                
       DA50                     LOC1:
000CD7 DA50 D5              11      PUSH    DE
000CD8 DA51 4D               4      LD  C,L
000CD9 DA52 0608             7      LD  B,8
000CDB DA54 5C               4      LD  E,H
000CDC DA55 210028          10      LD  HL,WIDTH*256
000CDF DA58 55               4      LD  D,L ;L=0
       DA59                     LOC2:
000CE0 DA59 29              11      ADD HL,HL
000CE1 DA5A 3001            12      JR  NC,LOC3
000CE3 DA5C 19              11      ADD HL,DE
       DA5D                     LOC3:
000CE4 DA5D 10FA            13      DJNZ    LOC2
000CE6 DA5F 09              11      ADD HL,BC
000CE7 DA60 D1              10      POP DE
000CE8 DA61 C9              10      RET
                                
       DA62                     CONOUT1:
                                ;   CALL    CURSOR
000CE9 DA62 59               4      LD  E,C
000CEA DA63 CDCDF0          17      CALL    _PRINT
000CED DA66 7B               4      LD  A,E
000CEE DA67 FE0A             7      CP  00AH
000CF0 DA69 2006            12      JR  NZ,CURSOR
000CF2 DA6B CD2BDA          17      CALL    CTRL0D
000CF5 DA6E CD15DA          17      CALL    CTRL05
       DA71                     CURSOR:
000CF8 DA71 C9              10      RET
                                
       DA72                     CTRL07:
000CF9 DA72 06E0             7      LD  B,0E0H
000CFB DA74 2162F0          10      LD  HL,BEEPD+1
       DA77                     C07X0:
000CFE DA77 4E               7      LD  C,(HL)
000CFF DA78 23               6      INC HL
000D00 DA79 7E               7      LD  A,(HL)
000D01 DA7A 23               6      INC HL
000D02 DA7B CD4FCF          17      CALL    WRMMIO_BC
000D05 DA7E 7D               4      LD  A,L
000D06 DA7F FE6A             7      CP  (BEEPD+1+M7BEEPE-M7BEEPD)&255
000D08 DA81 20F4            12      JR  NZ,C07X0
000D0A DA83 0610             7      LD  B,16
       DA85                     C07X1:
000D0C DA85 CD2DCF          17      CALL    RD556VSYNC
000D0F DA88 87               4      ADD A,A
000D10 DA89 30FA            12      JR  NC,C07X1
       DA8B                     C07X2:
000D12 DA8B CD2DCF          17      CALL    RD556VSYNC
000D15 DA8E 87               4      ADD A,A
000D16 DA8F 38FA            12      JR  C,C07X2
000D18 DA91 10F2            13      DJNZ    C07X1
                                
000D1A DA93 AF               4      XOR A
000D1B DA94 2108E0          10      LD  HL,0E008H
000D1E DA97 CD3FCF          17      CALL    WRMMIO
000D21 DA9A C9              10      RET
                                
       DA9B                     INSERT:
000D22 DA9B D5              11      PUSH    DE
000D23 DA9C CDD3F0          17      CALL    _POS
000D26 DA9F 54               4      LD  D,H
000D27 DAA0 3E28             7      LD  A,WIDTH
000D29 DAA2 95               4      SUB L
000D2A DAA3 47               4      LD  B,A
000D2B DAA4 2A8EF0          16      LD  HL,(_TXADR)
000D2E DAA7 7C               4      LD  A,H
000D2F DAA8 C6D0             7      ADD A,0D0H
000D31 DAAA 67               4      LD  H,A
000D32 DAAB 3A96F0          13      LD  A,(_COLORF) ;C:Color
000D35 DAAE 4F               4      LD  C,A
000D36 DAAF AF               4      XOR A       ;A:Text
000D37 DAB0 CD91CF          17      CALL    IO_INS
000D3A DAB3 B7               4      OR  A
000D3B DAB4 2005            12      JR  NZ,INS1
       DAB7                     MULINE  EQU $+1
000D3D DAB6 3EFF             7      LD  A,-1
000D3F DAB8 92               4      SUB D
000D40 DAB9 2009            12      JR  NZ,INS2
       DABB                     INS1:
000D42 DABB 0628             7      LD  B,WIDTH
000D44 DABD CD91CF          17      CALL    IO_INS
000D47 DAC0 7A               4      LD  A,D
000D48 DAC1 32B7DA          13      LD  (MULINE),A
       DAC4                     INS2:
000D4B DAC4 D1              10      POP DE
000D4C DAC5 C9              10      RET
                                
       DAC6                     CTRL0C:
000D4D DAC6 CD43DA          17      CALL    CTRL0B
       DAC9                     CTRL06:
000D50 DAC9 D5              11      PUSH    DE
000D51 DACA E5              11      PUSH    HL
000D52 DACB ED5B8EF0        20      LD  DE,(_TXADR)
000D56 DACF 3A96F0          13      LD  A,(_COLORF)
000D59 DAD2 326ECF          13      LD  (ICSMC),A
000D5C DAD5 C362CF          10      JP  IO_CLR
                                
       DAD8                     CTRL04:
000D5F DAD8 CDD3F0          17      CALL    _POS
000D62 DADB 7D               4      LD  A,L
000D63 DADC B7               4      OR  A
000D64 DADD C8              11      RET Z
       DADE                     CTRL03:
000D65 DADE CD2BDA          17      CALL    CTRL0D
       DAE1                     CTRL0A:
       DAE1                     CTRL1F:
000D68 DAE1 2A8EF0          16      LD  HL,(_TXADR)
000D6B DAE4 012800          10      LD  BC,WIDTH
000D6E DAE7 09              11      ADD HL,BC
000D6F DAE8 44               4      LD  B,H
000D70 DAE9 4D               4      LD  C,L
000D71 DAEA 2118FC          10      LD  HL,0-WIDTH*LINE
000D74 DAED 09              11      ADD HL,BC
000D75 DAEE 3F               4      CCF
000D76 DAEF 9F               4      SBC A,A
000D77 DAF0 C3ADD9          10      JP  PRINTE8
                                
       DAF3                     CTRL0E:
000D7A DAF3 CDD3F0          17      CALL    _POS
000D7D DAF6 7C               4      LD  A,H
000D7E DAF7 1804            12      JR  SCR1
       DAF9                     SCR:
000D80 DAF9 3A97F0          13      LD  A,(_LINE)
000D83 DAFC 3D               4      DEC A
       DAFD                     SCR1:
000D84 DAFD C5              11      PUSH    BC
000D85 DAFE D5              11      PUSH    DE
000D86 DAFF E5              11      PUSH    HL
000D87 DB00 1100D0          10      LD  DE,0D000H
000D8A DB03 2128D0          10      LD  HL,0D000H+WIDTH
                                
000D8D DB06 47               4      LD  B,A
000D8E DB07 B7               4      OR  A
000D8F DB08 C3B6CF          10      JP  IO_SCRUP
                                
       DB0B                     POS:
000D92 DB0B 2A8EF0          16      LD  HL,(_TXADR)
000D95 DB0E C5              11      PUSH    BC
000D96 DB0F 01D8FF          10      LD  BC,0-WIDTH
000D99 DB12 AF               4      XOR A
       DB13                     POS1:
000D9A DB13 09              11      ADD HL,BC
000D9B DB14 3C               4      INC A
000D9C DB15 38FC            12      JR  C,POS1
000D9E DB17 ED42            15      SBC HL,BC
000DA0 DB19 3D               4      DEC A
000DA1 DB1A 67               4      LD  H,A
000DA2 DB1B C1              10      POP BC
000DA3 DB1C A7               4      AND A
000DA4 DB1D C9              10      RET
                                
       DB1E                     GETL:
000DA5 DB1E CDD3F0          17      CALL    _POS
000DA8 DB21 E5              11      PUSH    HL
000DA9 DB22 3ECD             7      LD  A,0CDH      ;CALL ????
000DAB DB24 325AD9          13      LD  (INSFLG),A
       DB27                     GETL1:
000DAE DB27 CD3FD8          17      CALL    _SYS08
000DB1 DB2A FE09             7      CP  9
000DB3 DB2C 2008            12      JR  NZ,GETL1V
000DB5 DB2E 2120FF          10      LD  HL,KBUF
000DB8 DB31 CD51D5          17      CALL    MSX
000DBB DB34 18F1            12      JR  GETL1
       DB36                     GETL1V:
000DBD DB36 5F               4      LD  E,A
000DBE DB37 CDD3F0          17      CALL    _POS
000DC1 DB3A CDCDF0          17      CALL    _PRINT
000DC4 DB3D 7B               4      LD  A,E
000DC5 DB3E FE20             7      CP  $20
000DC7 DB40 3809            12      JR  C,GETL1V1
000DC9 DB42 7D               4      LD  A,L
000DCA DB43 FE27             7      CP  WIDTH-1
000DCC DB45 2004            12      JR  NZ,GETL1V1
000DCE DB47 7C               4      LD  A,H
000DCF DB48 32B7DA          13      LD  (MULINE),A
       DB4B                     GETL1V1:
000DD2 DB4B 7B               4      LD  A,E
000DD3 DB4C FE0D             7      CP  00DH
000DD5 DB4E 20D7            12      JR  NZ,GETL1
000DD7 DB50 3E01             7      LD  A,1     ;LD BC,????
000DD9 DB52 325AD9          13      LD  (INSFLG),A
000DDC DB55 1120FF          10      LD  DE,KBUF
000DDF DB58 0628             7      LD  B,WIDTH
000DE1 DB5A CDA4D3          17      CALL    ZERO_MEMORY_DE
                                
000DE4 DB5D D1              10      POP DE
000DE5 DB5E CDD3F0          17      CALL    _POS
000DE8 DB61 6B               4      LD  L,E
000DE9 DB62 3E28             7      LD  A,WIDTH
000DEB DB64 95               4      SUB L
000DEC DB65 57               4      LD  D,A
                                
000DED DB66 3AB7DA          13      LD  A,(MULINE)
000DF0 DB69 94               4      SUB H
000DF1 DB6A 2806            12      JR  Z,GL2X
000DF3 DB6C 3C               4      INC A
000DF4 DB6D 200C            12      JR  NZ,GL3X
000DF6 DB6F 25               4      DEC H
000DF7 DB70 1805            12      JR  GL4X
       DB72                     GL2X:
000DF9 DB72 3E1F             7      LD  A,$1F
000DFB DB74 CD29D8          17      CALL    MSG_A
       DB77                     GL4X:
000DFE DB77 7A               4      LD  A,D
000DFF DB78 C628             7      ADD A,WIDTH
000E01 DB7A 57               4      LD  D,A
       DB7B                     GL3X:
000E02 DB7B CD50DA          17      CALL    LOC1
000E05 DB7E 4D               4      LD  C,L
000E06 DB7F 7C               4      LD  A,H
000E07 DB80 C6D0             7      ADD A,0D0H
000E09 DB82 47               4      LD  B,A
000E0A DB83 5A               4      LD  E,D
000E0B DB84 2120FF          10      LD  HL,KBUF
       DB87                     GETL2:
000E0E DB87 CDD0F0          17      CALL    _SCRN
000E11 DB8A 03               6      INC BC
000E12 DB8B 77               7      LD  (HL),A
000E13 DB8C 23               6      INC HL
000E14 DB8D 1D               4      DEC E
000E15 DB8E 20F7            12      JR  NZ,GETL2
       DB90                     GETL3:
000E17 DB90 2B               6      DEC HL
000E18 DB91 7E               7      LD  A,(HL)
000E19 DB92 FE21             7      CP  021H
000E1B DB94 D0              11      RET NC
000E1C DB95 3600            10      LD  (HL),0
000E1E DB97 15               4      DEC D
000E1F DB98 20F6            12      JR  NZ,GETL3
000E21 DB9A C9              10      RET
                                
       DB9B                     INKEY:
000E22 DB9B FB               4      EI
000E23 DB9C E5              11      PUSH    HL
000E24 DB9D 2A90F0          16      LD  HL,(_KEYPS)
000E27 DBA0 7C               4      LD  A,H
000E28 DBA1 AD               4      XOR L
000E29 DBA2 2809            12      JR  Z,INKEY1
000E2B DBA4 7C               4      LD  A,H
000E2C DBA5 3C               4      INC A
000E2D DBA6 3291F0          13      LD  (_KEYPS+1),A
000E30 DBA9 6F               4      LD  L,A
000E31 DBAA 26FF             7      LD  H,KEYBF/256
000E33 DBAC 7E               7      LD  A,(HL)
       DBAD                     INKEY1:
000E34 DBAD E1              10      POP HL
000E35 DBAE B7               4      OR  A
000E36 DBAF C9              10      RET
                                
       DBB0                     INKEYB:
000E37 DBB0 C1              10      POP BC
000E38 DBB1 CB47             8      BIT 0,A
000E3A DBB3 3E08             7      LD  A,8
000E3C DBB5 2002            12      JR  NZ,INKEYD
000E3E DBB7 3E03             7      LD  A,3
       DBB9                     INKEYD:
000E40 DBB9 B7               4      OR  A
000E41 DBBA 3292F0          13      LD  (_KEYD),A
000E44 DBBD C9              10      RET
       DBBE                     CHKEY:
000E45 DBBE C5              11      PUSH    BC
000E46 DBBF 3E08             7      LD  A,8
000E48 DBC1 CD20CF          17      CALL    RDKEYDATA
000E4B DBC4 3293F0          13      LD  (_KEYD+1),A
000E4E DBC7 CB7F             8      BIT 7,A
000E50 DBC9 28E5            12      JR  Z,INKEYB
000E52 DBCB E5              11      PUSH    HL
000E53 DBCC 0E07             7      LD  C,7
000E55 DBCE 2140ED          10      LD  HL,KEY_TABLE
000E58 DBD1 CB47             8      BIT 0,A
000E5A DBD3 2003            12      JR  NZ,CHKEY0
000E5C DBD5 2180ED          10      LD  HL,SHIFT_TABLE
       DBD8                     CHKEY0:
000E5F DBD8 CB77             8      BIT 6,A
000E61 DBDA 2003            12      JR  NZ,CHKEY1
000E63 DBDC 21C0ED          10      LD  HL,CTRL_TABLE
       DBDF                     CHKEY1:
000E66 DBDF 79               4      LD  A,C
000E67 DBE0 CD20CF          17      CALL    RDKEYDATA
000E6A DBE3 0608             7      LD  B,8
       DBE5                     CHKEY2:
000E6C DBE5 87               4      ADD A,A
000E6D DBE6 3009            12      JR  NC,CHKEY3
000E6F DBE8 23               6      INC HL
000E70 DBE9 10FA            13      DJNZ    CHKEY2
000E72 DBEB 0D               4      DEC C
000E73 DBEC 79               4      LD  A,C
000E74 DBED 3C               4      INC A
000E75 DBEE 20EF            12      JR  NZ,CHKEY1
000E77 DBF0 06                      DB  $06     ;LD B,?? 次の1バイトを飛ばす
       DBF1                     CHKEY3:
000E78 DBF1 7E               7      LD  A,(HL)
000E79 DBF2 E1              10      POP HL
000E7A DBF3 C1              10      POP BC
000E7B DBF4 18C3            12      JR  INKEYD
                                
       DBF6                     SCRN:
000E7D DBF6 E5              11      PUSH    HL
000E7E DBF7 CD47CF          17      CALL    RDMMIO_BC
000E81 DBFA 6F               4      LD  L,A
000E82 DBFB 26EF             7      LD  H,DC_TABLE/256
000E84 DBFD 7E               7      LD  A,(HL)
000E85 DBFE FE41             7      CP  'A'     ;英小文字チェック
000E87 DC00 380E            12      JR  C,SCRN1
000E89 DC02 FE5B             7      CP  'Z'+1
000E8B DC04 DC12DC          17      CALL    C,SCRNC
000E8E DC07 FEA6             7      CP  $A6     ;ひらがなチェック
000E90 DC09 3805            12      JR  C,SCRN1
000E92 DC0B FEE0             7      CP  $E0
000E94 DC0D DC12DC          17      CALL    C,SCRNC
       DC10                     SCRN1:
000E97 DC10 E1              10      POP HL
000E98 DC11 C9              10      RET
                                
       DC12                     SCRNC:
000E99 DC12 6F               4      LD  L,A
000E9A DC13 60               4      LD  H,B
000E9B DC14 CBD8             8      SET 3,B
000E9D DC16 CD47CF          17      CALL    RDMMIO_BC
000EA0 DC19 44               4      LD  B,H
000EA1 DC1A CB7F             8      BIT 7,A
000EA3 DC1C 7D               4      LD  A,L
000EA4 DC1D C8              11      RET Z
000EA5 DC1E FE5B             7      CP  'Z'+1
000EA7 DC20 3804            12      JR  C,SCRNC_ADD
000EA9 DC22 FEC0             7      CP  $C0
000EAB DC24 3803            12      JR  C,SCRNC_SUB
       DC26                     SCRNC_ADD:
000EAD DC26 C620             7      ADD A,$20
000EAF DC28 C9              10      RET
       DC29                     SCRNC_SUB:
000EB0 DC29 D620             7      SUB $20
000EB2 DC2B C9              10      RET
[EOF:M7IO.ASM:SHIFT_JIS]
                                    INCLUDE "LDFILE.ASM"
                                
                                ;   LSX-Dodgers FILE
                                
       DC2C                     FILEC:
000EB3 DC2C CD37DC          17      CALL    FILE
       DC2F                     FILEC2:
000EB6 DC2F 3A15F0          13      LD  A,(FDRV+1)
000EB9 DC32 FE20             7      CP  020H
000EBB DC34 C8              11      RET Z
000EBC DC35 1839            12      JR  SETDIR1
                                
       DC37                     FILE:
000EBE DC37 AF               4      XOR A
000EBF DC38 3214F0          13      LD  (FDRV),A
000EC2 DC3B 67               4      LD  H,A
000EC3 DC3C 6F               4      LD  L,A
000EC4 DC3D 2222F0          16      LD  (FDRV+14),HL
000EC7 DC40 CD0EDD          17      CALL    SPCUT
000ECA DC43 CDF3DC          17      CALL    CCHK3
000ECD DC46 2812            12      JR  Z,DEVI1
000ECF DC48 13               6      INC DE
000ED0 DC49 1A               7      LD  A,(DE)
000ED1 DC4A 1B               6      DEC DE
000ED2 DC4B FE3A             7      CP  ':'
000ED4 DC4D 200B            12      JR  NZ,DEVI1
000ED6 DC4F 1A               7      LD  A,(DE)      ;DRIVE
000ED7 DC50 CD43DF          17      CALL    CAP
000EDA DC53 D640             7      SUB '@'
000EDC DC55 13               6      INC DE
000EDD DC56 13               6      INC DE
000EDE DC57 3214F0          13      LD  (FDRV),A
       DC5A                     DEVI1:
000EE1 DC5A 1A               7      LD  A,(DE)
000EE2 DC5B D65C             7      SUB 05CH        ;\
000EE4 DC5D 2009            12      JR  NZ,NOROOT
000EE6 DC5F 6F               4      LD  L,A     ;A=0でH=0のはずなのでHL=0
000EE7 DC60 222EF0          16      LD  (FDRV+26),HL
000EEA DC63 2C               4      INC L
000EEB DC64 2222F0          16      LD  (FDRV+14),HL
000EEE DC67 13               6      INC DE
       DC68                     NOROOT:
                                
       DC68                     SETDIR:
000EEF DC68 CD94DC          17      CALL    FILED
000EF2 DC6B 1A               7      LD  A,(DE)
000EF3 DC6C FE5C             7      CP  05CH        ;\
000EF5 DC6E C0              11      RET NZ
000EF6 DC6F 13               6      INC DE
       DC70                     SETDIR1:
000EF7 DC70 3E10             7      LD  A,010H      ;Directory
000EF9 DC72 3221F0          13      LD  (FDRV+13),A
000EFC DC75 D5              11      PUSH    DE
000EFD DC76 1114F0          10      LD  DE,FDRV
000F00 DC79 2A1EF1          16      LD  HL,(STABLE+2*00FH)
000F03 DC7C CD0F00          17      CALL    JP_HL
000F06 DC7F D1              10      POP DE
000F07 DC80 B7               4      OR  A
000F08 DC81 C0              11      RET NZ
                                
000F09 DC82 3A21F0          13      LD  A,(FDRV+13)
000F0C DC85 CB67             8      BIT 4,A
000F0E DC87 C8              11      RET Z
                                
000F0F DC88 CDDBDC          17      CALL    FILEI
000F12 DC8B 2A2EF0          16      LD  HL,(FDRV+26)
000F15 DC8E 23               6      INC HL
000F16 DC8F 2222F0          16      LD  (FDRV+14),HL
000F19 DC92 18D4            12      JR  SETDIR
                                
       DC94                     FILED:
000F1B DC94 CDDBDC          17      CALL    FILEI
000F1E DC97 2115F0          10      LD  HL,FNAME
                                
000F21 DC9A 0608             7      LD  B,8
       DC9C                     FILE2:
000F23 DC9C CDE8DC          17      CALL    CCHKF
000F26 DC9F C8              11      RET Z
000F27 DCA0 FE2A             7      CP  '*'
000F29 DCA2 282E            12      JR  Z,FILE9
000F2B DCA4 FE2E             7      CP  '.'
000F2D DCA6 280C            12      JR  Z,FILE4
000F2F DCA8 77               7      LD  (HL),A
000F30 DCA9 23               6      INC HL
000F31 DCAA 10F0            13      DJNZ    FILE2
                                
       DCAC                     FILE3:
000F33 DCAC CDE8DC          17      CALL    CCHKF
000F36 DCAF C8              11      RET Z
000F37 DCB0 FE2E             7      CP  '.'
000F39 DCB2 20F8            12      JR  NZ,FILE3
                                
       DCB4                     FILE4:
000F3B DCB4 211DF0          10      LD  HL,FNAME+8
000F3E DCB7 0603             7      LD  B,3
                                
       DCB9                     FILE4L:
000F40 DCB9 CDE8DC          17      CALL    CCHKF
000F43 DCBC C8              11      RET Z
000F44 DCBD FE2E             7      CP  '.'
000F46 DCBF 2008            12      JR  NZ,FILE12
000F48 DCC1 3215F0          13      LD  (FNAME),A   ;Parent directory(..)
000F4B DCC4 3216F0          13      LD  (FNAME+1),A
000F4E DCC7 3E20             7      LD  A,020H
       DCC9                     FILE12:
000F50 DCC9 FE2A             7      CP  '*'
000F52 DCCB 280A            12      JR  Z,FILE10
000F54 DCCD 77               7      LD  (HL),A
000F55 DCCE 23               6      INC HL
000F56 DCCF 10E8            13      DJNZ    FILE4L
000F58 DCD1 C9              10      RET
                                
       DCD2                     FILE9:              ;名前の*処理、名前の残りを?で埋める
000F59 DCD2 CDD7DC          17      CALL    FILE10
000F5C DCD5 18D5            12      JR  FILE3
                                
       DCD7                     FILE10:
000F5E DCD7 3E3F             7      LD  A,'?'
000F60 DCD9 1808            12      JR  FILL_MEMORY
       DCDB                     FILEI:              ;名前＋拡張子をスペースで初期化
000F62 DCDB 3E20             7      LD  A,020H
000F64 DCDD 01000B          10      LD  BC,11*256   ;C=0にしておく
000F67 DCE0 2115F0          10      LD  HL,FNAME
       DCE3                     FILL_MEMORY:            ;HLからBバイトAで埋める
000F6A DCE3 77               7      LD  (HL),A
000F6B DCE4 23               6      INC HL
000F6C DCE5 10FC            13      DJNZ    FILL_MEMORY
000F6E DCE7 C9              10      RET
                                
       DCE8                     CCHKF:
000F6F DCE8 1A               7      LD  A,(DE)
000F70 DCE9 CDF0DC          17      CALL    CCHK2
000F73 DCEC C8              11      RET Z
000F74 DCED C35BE0          10      JP  FKAN
                                
       DCF0                     CCHK2:
000F77 DCF0 0C               4      INC C
000F78 DCF1 0D               4      DEC C
000F79 DCF2 C0              11      RET NZ
       DCF3                     CCHK3:              ;ZF=1 で使えない文字
000F7A DCF3 FE2B             7      CP  '+'
000F7C DCF5 C8              11      RET Z
000F7D DCF6 FE2C             7      CP  ','
000F7F DCF8 C8              11      RET Z
000F80 DCF9 FE2F             7      CP  '/'
000F82 DCFB C8              11      RET Z
000F83 DCFC FE3A             7      CP  ':'
000F85 DCFE C8              11      RET Z
000F86 DCFF FE3B             7      CP  ';'
000F88 DD01 C8              11      RET Z
000F89 DD02 FE3D             7      CP  '='
000F8B DD04 C8              11      RET Z
000F8C DD05 FE5C             7      CP  05CH    ;\
000F8E DD07 C8              11      RET Z
000F8F DD08 FE20             7      CP  020H
000F91 DD0A D0              11      RET NC
000F92 DD0B BF               4      CP  A       ;Z=1
000F93 DD0C C9              10      RET
                                
       DD0D                     SS1:
000F94 DD0D 13               6      INC DE
       DD0E                     SPCUT:              ;スペースをカット
000F95 DD0E 1A               7      LD  A,(DE)
000F96 DD0F FE20             7      CP  020H
000F98 DD11 28FA            12      JR  Z,SS1
000F9A DD13 C9              10      RET
                                
       DD14                     SETDRVF:
000F9B DD14 1114F0          10      LD  DE,FDRV
       DD17                     SETDRV0:
000F9E DD17 CD20DD          17      CALL    SETDRV
000FA1 DD1A FDE1            14      POP IY
000FA3 DD1C C1              10      POP BC
000FA4 DD1D D1              10      POP DE
000FA5 DD1E E1              10      POP HL
000FA6 DD1F C9              10      RET
                                
       DD20                     SETDRV:
000FA7 DD20 E3              19      EX  (SP),HL     ;HL=RETRN ADDRESS
000FA8 DD21 D5              11      PUSH    DE      ;PUSH HL/DE/BC/IY
000FA9 DD22 C5              11      PUSH    BC
000FAA DD23 1A               7      LD  A,(DE)
000FAB DD24 D5              11      PUSH    DE
000FAC DD25 FDE3            23      EX  (SP),IY
                                
000FAE DD27 CD33DD          17      CALL    GETDRV
000FB1 DD2A 3C               4      INC A
000FB2 DD2B FD7700          19      LD  (IY+0),A    ;(FCB)ドライブ番号
000FB5 DD2E 3D               4      DEC A
000FB6 DD2F CDD9F0          17      CALL    _CHGDRV
                                
000FB9 DD32 E9               4      JP  (HL)
                                
       DD33                     GETDRV:
000FBA DD33 E67F             7      AND 07FH
000FBC DD35 D601             7      SUB 001H
000FBE DD37 3003            12      JR  NC,GETDRV1
000FC0 DD39 3A87F0          13      LD  A,(_DVSW)   ;Current Drive
       DD3C                     GETDRV1:
000FC3 DD3C 3288F0          13      LD  (_DRV),A
000FC6 DD3F C9              10      RET
                                
       DD40                     SOPENX:
000FC7 DD40 1139F0          10      LD  DE,SFILE
000FCA DD43 1A               7      LD  A,(DE)
000FCB DD44 FDBE00           7      CP  (IY+0)      ;(FCB)ドライブ番号
000FCE DD47 2024            12      JR  NZ,SOPEN
000FD0 DD49 13               6      INC DE
000FD1 DD4A FDE5            15      PUSH    IY
000FD3 DD4C E1              10      POP HL
000FD4 DD4D 23               6      INC HL
000FD5 DD4E CDDBDE          17      CALL    CPFILE
000FD8 DD51 201A            12      JR  NZ,SOPEN
                                
000FDA DD53 2AF4F1          16      LD  HL,(SCDIR)
000FDD DD56 FD750E          19      LD  (IY+14),L   ;(FCB)アクセスするディレクトリのクラスタ番号+1
000FE0 DD59 FD740F          19      LD  (IY+15),H
                                
000FE3 DD5C 2AF8F1          16      LD  HL,(SFNDF)  ;Direcroty location and Flags
000FE6 DD5F 229FF0          16      LD  (_FILEN),HL
                                
000FE9 DD62 ED5BF6F1        20      LD  DE,(SFBPS)
000FED DD66 2139F0          10      LD  HL,SFILE
000FF0 DD69 36FF            10      LD  (HL),0FFH
000FF2 DD6B 23               6      INC HL
000FF3 DD6C C9              10      RET
       DD6D                     SOPEN:
000FF4 DD6D 2183DE          10      LD  HL,FILESE
       DD70                     SOPENC:
000FF7 DD70 22A9DD          16      LD  (OPENPAT+1),HL
                                
000FFA DD73 CDE2F0          17      CALL    _RDFATX     ;Detect Media
000FFD DD76 3856            12      JR  C,RDDERR
                                
000FFF DD78 AF               4      XOR A
001000 DD79 329FF0          13      LD  (_FILEN),A
001003 DD7C CD88DF          17      CALL    LDDIRX1     ;A=0で呼び出す
001006 DD7F 2818            12      JR  Z,SDIRX1
                                
001008 DD81 CD74DE          17      CALL    READ_DIR    ;Sub Directory
00100B DD84 3808            12      JR  C,SDIRX0
00100D DD86 2A7EF1          16      LD  HL,(_DTBUF)
001010 DD89 7E               7      LD  A,(HL)
001011 DD8A FE2E             7      CP  '.'
001013 DD8C 280F            12      JR  Z,SOPEN1
       DD8E                     SDIRX0:
001015 DD8E AF               4      XOR A
001016 DD8F 32A0F0          13      LD  (_DIRF),A
001019 DD92 FD360E01        19      LD  (IY+14),1   ;(FCB)レコードサイズ
00101D DD96 FD770F          19      LD  (IY+15),A
       DD99                     SDIRX1:
001020 DD99 ED5BFCF1        20      LD  DE,(_DIRPS) ;Root Directory
       DD9D                     SOPEN1:
001024 DD9D 0E20             7  SDECPAT:LD  C,32        ;自己書き換え 1セクタ辺りのディレクトリエントリ数  1024=32 / 512=16 / 256=8
       DD9F                     SOPEN1X:
001026 DD9F CD74DE          17      CALL    READ_DIR    ;FILE SEARCH
001029 DDA2 382A            12      JR  C,RDDERR
00102B DDA4 2A7EF1          16      LD  HL,(_DTBUF)
       DDA7                     SOPEN2:
00102E DDA7 D5              11      PUSH    DE
00102F DDA8 CD83DE          17  OPENPAT:CALL    FILESE      ;(self-modifying code)
001032 DDAB D1              10      POP DE
001033 DDAC 386E            12      JR  C,SOPENE
001035 DDAE 281B            12      JR  Z,SCF_FF_RET
       DDB0                     SOPEN3:
001037 DDB0 3AA0F0          13      LD  A,(_DIRF)   ;ディレクトリか判別
00103A DDB3 B7               4      OR  A
00103B DDB4 200C            12      JR  NZ,SOPEN5
00103D DDB6 13               6      INC DE      ;ルートディレクトリ
00103E DDB7 E5              11      PUSH    HL
00103F DDB8 210C00          10  MD_PAT: LD  HL,12       ;(self-modifying code)MAXDIR
001042 DDBB ED52            15      SBC HL,DE       ;CF=0 なので SUB HL,DE
001044 DDBD E1              10      POP HL
001045 DDBE 20DD            12      JR  NZ,SOPEN1
001047 DDC0 1807            12      JR  SOPEN6
       DDC2                     SOPEN5:
001049 DDC2 CDB9E6          17      CALL    GNCLX       ;END DIR
00104C DDC5 D8              11      RET C
00104D DDC6 CD3BDF          17      CALL    ENDCL
       DDC9                     SOPEN6:
001050 DDC9 38D2            12      JR  C,SOPEN1
       DDCB                     SCF_FF_RET:
001052 DDCB 37               4      SCF         ;CF=1
001053 DDCC 9F               4      SBC A,A     ;A=0FFH
001054 DDCD C9              10      RET
                                
       DDCE                     RDDERR:
001055 DDCE BF               4      CP  A       ;READ ERR CF=1 ZF=1
001056 DDCF 37               4      SCF
001057 DDD0 C9              10      RET
                                
       DDD1                     NOPEN:
001058 DDD1 2183DE          10      LD  HL,FILESE
00105B DDD4 22A9DD          16      LD  (OPENPAT+1),HL
00105E DDD7 FD2A98F0        20      LD  IY,(_FCB)
001062 DDDB CD6EE0          17      CALL    CHKWILDX
001065 DDDE 30EB            12      JR  NC,SCF_FF_RET
001067 DDE0 FD7E00          19      LD  A,(IY+0)    ;(FCB)ドライブ番号
00106A DDE3 3D               4      DEC A
00106B DDE4 3288F0          13      LD  (_DRV),A
00106E DDE7 CDD9F0          17      CALL    _CHGDRV
001071 DDEA D8              11      RET C
001072 DDEB 2AF8F1          16      LD  HL,(SFNDF)  ;Direcroty location and Flags
001075 DDEE 229FF0          16      LD  (_FILEN),HL
                                
001078 DDF1 CD83DF          17      CALL    LDDIRX
00107B DDF4 ED5B9AF0        20      LD  DE,(_FBPS)
00107F DDF8 CD74DE          17      CALL    READ_DIR
001082 DDFB 38D1            12      JR  C,RDDERR
001084 DDFD 3A9EF0          13      LD  A,(_FBCNT)
001087 DE00 3D               4      DEC A
001088 DE01 28AD            12      JR  Z,SOPEN3
       DE03                     NOPEN2:
00108A DE03 2A9CF0          16      LD  HL,(_FBAD)
00108D DE06 012000          10      LD  BC,020H
001090 DE09 09              11      ADD HL,BC
001091 DE0A 4F               4      LD  C,A
001092 DE0B 189A            12      JR  SOPEN2
                                
       DE0D                     SOPENE2:
001094 DE0D 229CF0          16      LD  (_FBAD),HL
001097 DE10 79               4      LD  A,C
001098 DE11 329EF0          13      LD  (_FBCNT),A
00109B DE14 ED539AF0        20      LD  (_FBPS),DE
00109F DE18 FD2298F0        20      LD  (_FCB),IY
       DE1C                     SOPENE:
0010A3 DE1C AF               4      XOR A
0010A4 DE1D C9              10      RET
                                
       DE1E                     COPEN:
0010A5 DE1E FD360D20        19      LD  (IY+13),020H    ;(FCB)属性(アトリビュート)
                                
0010A9 DE22 21A0DE          10      LD  HL,NEXTSE
0010AC DE25 CD70DD          17      CALL    SOPENC
0010AF DE28 D0              11      RET NC
0010B0 DE29 C8              11      RET Z
0010B1 DE2A 3AA0F0          13      LD  A,(_DIRF)   ;ディレクトリか判別
0010B4 DE2D B7               4      OR  A
0010B5 DE2E 37               4      SCF
0010B6 DE2F C8              11      RET Z       ;ルートディレクトリ
0010B7 DE30 0601             7      LD  B,1
0010B9 DE32 CDCCE0          17      CALL    WRDF
0010BC DE35 D8              11      RET C
0010BD DE36 ED5BFEF1        20      LD  DE,(_CLPS)
0010C1 DE3A D5              11      PUSH    DE
0010C2 DE3B CD04DF          17      CALL    DCPAT
0010C5 DE3E CD44E5          17      CALL    DRDNX
0010C8 DE41 2A7EF1          16      LD  HL,(_DTBUF) ;ディレクトリエントリを0クリア
0010CB DE44 3A40E4          13      LD  A,(SECSZ+2) ;1024=4 / 512=2 / 256=1
0010CE DE47 47               4      LD  B,A
0010CF DE48 AF               4      XOR A
0010D0 DE49 4F               4      LD  C,A
       DE4A                     COPENCL:
0010D1 DE4A 77               7      LD  (HL),A
0010D2 DE4B EDA1            16      CPI         ;HL=HL+1 BC=BC-1 BCが0の場合にP/V=0
0010D4 DE4D EA4ADE          10      JP  PE,COPENCL
                                
0010D7 DE50 3A22DF          13      LD  A,(SPCPAT+1)    ;1クラスタの論理セクタ数
0010DA DE53 3D               4      DEC A
0010DB DE54 2819            12      JR  Z,COPENE
0010DD DE56 3E01             7      LD  A,1     ;1セクタ辺りのセクタ数が2以上の場合
0010DF DE58 32B1E6          13      LD  (_SECPS+1),A
0010E2 DE5B D1              10      POP DE      ;DE=(_CLPS)
0010E3 DE5C D5              11      PUSH    DE
       DE5D                     COPEN1:
0010E4 DE5D D5              11      PUSH    DE      ;データバッファに入らないセクタもゼロクリア
0010E5 DE5E C5              11      PUSH    BC
0010E6 DE5F 2A7EF1          16      LD  HL,(_DTBUF)
0010E9 DE62 CD1EDF          17      CALL    CLUSTX
0010EC DE65 CD49E8          17      CALL    DWT24
0010EF DE68 C1              10      POP BC
0010F0 DE69 D1              10      POP DE
0010F1 DE6A CDB0E6          17      CALL    NEXTX
0010F4 DE6D 20EE            12      JR  NZ,COPEN1
       DE6F                     COPENE:
0010F6 DE6F 2A7EF1          16      LD  HL,(_DTBUF)
0010F9 DE72 D1              10      POP DE
0010FA DE73 C9              10      RET
                                
       DE74                     READ_DIR:
0010FB DE74 ED53FEF1        20      LD  (_CLPS),DE
0010FF DE78 C5              11      PUSH    BC
001100 DE79 D5              11      PUSH    DE
001101 DE7A CD04DF          17      CALL    DCPAT
001104 DE7D CD24E5          17      CALL    DRDX
001107 DE80 D1              10      POP DE
001108 DE81 C1              10      POP BC
001109 DE82 C9              10      RET
                                
       DE83                     FILESE:
00110A DE83 7E               7      LD  A,(HL)
00110B DE84 B7               4      OR  A
00110C DE85 C8              11      RET Z       ;END:ZF=1 CF=0
00110D DE86 FEE5             7      CP  0E5H
00110F DE88 280E            12      JR  Z,FILESE1
001111 DE8A FDE5            15      PUSH    IY
001113 DE8C D1              10      POP DE
001114 DE8D 13               6      INC DE
001115 DE8E E5              11      PUSH    HL
001116 DE8F CDDBDE          17      CALL    CPFILE
001119 DE92 CCFCDE          17      CALL    Z,CPFILE2
00111C DE95 E1              10      POP HL
00111D DE96 37               4      SCF
00111E DE97 C8              11      RET Z       ;!!!:(ZF=1) CF=1
       DE98                     FILESE1:
00111F DE98 CDAFDE          17      CALL    FNEXT
001122 DE9B 20E6            12      JR  NZ,FILESE
       DE9D                     ZF0_CF0_AFF_RET:
001124 DE9D F6FF             7      OR  0FFH        ;ZF=0 CF=0
001126 DE9F C9              10      RET
                                
       DEA0                     NEXTSE:
001127 DEA0 7E               7      LD  A,(HL)
001128 DEA1 B7               4      OR  A
001129 DEA2 37               4      SCF
00112A DEA3 C8              11      RET Z       ;!!!:ZF=1 CF=1
00112B DEA4 FEE5             7      CP  0E5H
00112D DEA6 37               4      SCF
00112E DEA7 C8              11      RET Z       ;!!!:(ZF=1) CF=1
00112F DEA8 CDAFDE          17      CALL    FNEXT
001132 DEAB 20F3            12      JR  NZ,NEXTSE
001134 DEAD 18EE            12      JR  ZF0_CF0_AFF_RET
                                
       DEAF                     FNEXT:
001136 DEAF E5              11      PUSH    HL
001137 DEB0 219FF0          10      LD  HL,_FILEN
00113A DEB3 34              11      INC (HL)
00113B DEB4 E1              10      POP HL
00113C DEB5 112000          10      LD  DE,020H
00113F DEB8 19              11      ADD HL,DE
001140 DEB9 0D               4      DEC C
001141 DEBA C9              10      RET
                                
       DEBB                     CPNAME:
001142 DEBB C5              11      PUSH    BC
001143 DEBC D5              11      PUSH    DE
001144 DEBD E5              11      PUSH    HL
001145 DEBE CDD5DE          17      CALL    CPFILE4
001148 DEC1 E1              10      POP HL
001149 DEC2 23               6      INC HL
00114A DEC3 23               6      INC HL
00114B DEC4 23               6      INC HL
00114C DEC5 23               6      INC HL
00114D DEC6 D1              10      POP DE
00114E DEC7 C1              10      POP BC
00114F DEC8 2005            12      JR  NZ,CPNAME1
001151 DECA 7E               7      LD  A,(HL)
001152 DECB 23               6      INC HL
001153 DECC 66               7      LD  H,(HL)
001154 DECD 6F               4      LD  L,A
001155 DECE C9              10      RET
       DECF                     CPNAME1:
001156 DECF 23               6      INC HL
001157 DED0 23               6      INC HL
001158 DED1 10E8            13      DJNZ    CPNAME
00115A DED3 37               4      SCF
00115B DED4 C9              10      RET
                                
       DED5                     CPFILE4:
00115C DED5 C5              11      PUSH    BC
00115D DED6 010004          10      LD  BC,00400H
001160 DED9 1804            12      JR  CPSTR1
       DEDB                     CPFILE:
001162 DEDB C5              11      PUSH    BC
001163 DEDC 01000B          10      LD  BC,00B00H
       DEDF                     CPSTR1:
001166 DEDF 1A               7      LD  A,(DE)
001167 DEE0 FE3F             7      CP  '?'     ;Wild card
001169 DEE2 2812            12      JR  Z,CPSTR2
00116B DEE4 7E               7      LD  A,(HL)
00116C DEE5 CD54E0          17      CALL    FKANC
00116F DEE8 E5              11      PUSH    HL
001170 DEE9 67               4      LD  H,A
001171 DEEA 1A               7      LD  A,(DE)
001172 DEEB CB01             4      RLC C
001174 DEED CD54E0          17      CALL    FKANC
001177 DEF0 CB09             4      RRC C
001179 DEF2 BC               4      CP  H       ;CP (HL),(DE)
00117A DEF3 E1              10      POP HL
00117B DEF4 2004            12      JR  NZ,CPSTR3
       DEF6                     CPSTR2:
00117D DEF6 13               6      INC DE
00117E DEF7 23               6      INC HL
00117F DEF8 10E5            13      DJNZ    CPSTR1
       DEFA                     CPSTR3:
001181 DEFA C1              10      POP BC
001182 DEFB C9              10      RET
                                
       DEFC                     CPFILE2:
001183 DEFC FD7E0D          19      LD  A,(IY+13)   ;(FCB)属性(アトリビュート)
001186 DEFF F6E1             7      OR  0E1H
001188 DF01 2F               4      CPL
001189 DF02 A6               7      AND (HL)
00118A DF03 C9              10      RET
                                
       DF04                     DCPAT:
00118B DF04 0E00             7      LD  C,0
00118D DF06 2A7EF1          16      LD  HL,(_DTBUF)
001190 DF09 3AA0F0          13      LD  A,(_DIRF)   ;ディレクトリか判別
001193 DF0C B7               4      OR  A
001194 DF0D C8              11      RET Z       ;ルートディレクトリの場合はCレジスタを0にしておく(CDEがセクタ番号)
001195 DF0E 3A22DF          13      LD  A,(SPCPAT+1)
001198 DF11 4F               4      LD  C,A
001199 DF12 3AB1E6          13      LD  A,(_SECPS+1)
00119C DF15 B9               4      CP  C
00119D DF16 3801            12      JR  C,DC1
00119F DF18 AF               4      XOR A
       DF19                     DC1:
0011A0 DF19 F680             7      OR  080H
0011A2 DF1B 32A0F0          13      LD  (_DIRF),A   ;bit0-6:セクタインデックス
       DF1E                     CLUSTX:
0011A5 DF1E E5              11      PUSH    HL
0011A6 DF1F EB               4      EX  DE,HL
0011A7 DF20 AF               4      XOR A
0011A8 DF21 0E01             7  SPCPAT: LD  C,1     ;自己書き換え（1クラスタの論理セクタ数）
       DF23                     L_CLDBL:
0011AA DF23 CB19             8      RR  C       ;->CF
0011AC DF25 3804            12      JR  C,E_CLDBL
0011AE DF27 29              11      ADD HL,HL       ;*2
0011AF DF28 8F               4      ADC A,A
0011B0 DF29 18F8            12      JR  L_CLDBL
       DF2B                     E_CLDBL:
0011B2 DF2B 4F               4      LD  C,A
0011B3 DF2C 3AB1E6          13      LD  A,(_SECPS+1)
0011B6 DF2F B5               4      OR  L
0011B7 DF30 6F               4      LD  L,A
0011B8 DF31 110800          10  CLSPAT: LD  DE,8    ;+8 (2D)  !ADDCL (self-modifying code)
0011BB DF34 AF               4      XOR A
0011BC DF35 19              11      ADD HL,DE   ;データ格納領域の先頭論理セクタ番号
0011BD DF36 89               4      ADC A,C
0011BE DF37 4F               4      LD  C,A
0011BF DF38 EB               4      EX  DE,HL
0011C0 DF39 E1              10      POP HL
0011C1 DF3A C9              10      RET
                                
       DF3B                     ENDCL:
0011C2 DF3B 7A               4      LD  A,D ;END CLUSTER
0011C3 DF3C FE01             7  CLPAT1: CP  1   ;164=356    (self-modifying code)
0011C5 DF3E C0              11      RET NZ
0011C6 DF3F 7B               4      LD  A,E
0011C7 DF40 FE64             7  CLPAT2: CP  064H    ;       (self-modifying code)
0011C9 DF42 C9              10      RET
                                
       DF43                     CAP:
0011CA DF43 FE61             7      CP  'a'
0011CC DF45 D8              11      RET C
0011CD DF46 FE7B             7      CP  'z'+1
0011CF DF48 D0              11      RET NC
0011D0 DF49 D620             7      SUB 020H
0011D2 DF4B C9              10      RET
       DF4C                     CAP2:
0011D3 DF4C CD43DF          17      CALL    CAP
       DF4F                     CAP3:
0011D6 DF4F CD58DF          17      CALL    CAP4
0011D9 DF52 FE21             7      CP  021H
0011DB DF54 D0              11      RET NC
0011DC DF55 3EA0             7      LD  A,0A0H
0011DE DF57 C9              10      RET
       DF58                     CAP4:
0011DF DF58 FE05             7      CP  5
0011E1 DF5A C0              11      RET NZ
0011E2 DF5B 3EE5             7      LD  A,0E5H
0011E4 DF5D C9              10      RET
                                
       DF5E                     CHDIR:
0011E5 DF5E CD77E9          17      CALL    GETDPBD
0011E8 DF61 381D            12      JR  C,CHDIR2
0011EA DF63 DD751A          19      LD  (IX+01AH),L     ;_SDIR_
0011ED DF66 DD741B          19      LD  (IX+01BH),H     ;_SDIR_+1
0011F0 DF69 1815            12      JR  CHDIR2      ;POP_IX_RET
                                
       DF6B                     LDDIR:
0011F2 DF6B CD77E9          17      CALL    GETDPBD
0011F5 DF6E DD5E1A          19      LD  E,(IX+01AH)     ;_SDIR_
0011F8 DF71 DD561B          19      LD  D,(IX+01BH)     ;_SDIR_+1
0011FB DF74 13               6      INC DE
0011FC DF75 FD730E          19      LD  (IY+14),E   ;(FCB)アクセスするディレクトリのクラスタ番号+1
0011FF DF78 FD720F          19      LD  (IY+15),D
001202 DF7B 1B               6      DEC DE
001203 DF7C AF               4      XOR A
001204 DF7D 32A0F0          13      LD  (_DIRF),A
       DF80                     CHDIR2:
001207 DF80 DDE1            14      POP IX
001209 DF82 C9              10      RET
                                
       DF83                     LDDIRX:
00120A DF83 3AA0F0          13      LD  A,(_DIRF)   ;(FCB)アクセスするディレクトリのセクタインデックス
00120D DF86 E67F             7      AND 07FH
       DF88                     LDDIRX1:
00120F DF88 32B1E6          13      LD  (_SECPS+1),A
001212 DF8B FD5E0E          19      LD  E,(IY+14)   ;(FCB)アクセスするディレクトリのクラスタ番号+1
001215 DF8E FD560F          19      LD  D,(IY+15)
001218 DF91 1B               6      DEC DE
001219 DF92 CD3BDF          17      CALL    ENDCL
00121C DF95 D46BDF          17      CALL    NC,LDDIR
       DF98                     LDDIRS:
00121F DF98 7A               4      LD  A,D
001220 DF99 B3               4      OR  E
001221 DF9A 32A0F0          13      LD  (_DIRF),A   ;ディレクトリか判別
001224 DF9D C9              10      RET
                                
       DF9E                     KILL:
001225 DF9E CD6EE0          17      CALL    CHKWILDX
001228 DFA1 3834            12      JR  C,KILLW
00122A DFA3 CD40DD          17      CALL    SOPENX
       DFA6                     KILLS:
00122D DFA6 3E1F             7      LD  A,01FH
00122F DFA8 D4EADF          17      CALL    NC,CHKATT
001232 DFAB D8              11      RET C
       DFAC                     KILLSX:
001233 DFAC 36E5            10      LD  (HL),0E5H   ;DIR
001235 DFAE CD48E0          17      CALL    WTDB
001238 DFB1 111A00          10      LD  DE,01AH
00123B DFB4 19              11      ADD HL,DE
00123C DFB5 5E               7      LD  E,(HL)
00123D DFB6 23               6      INC HL
00123E DFB7 56               7      LD  D,(HL)
       DFB8                     KILLS1:
00123F DFB8 CD3BDF          17      CALL    ENDCL
001242 DFBB D0              11      RET NC      ;CF=0
001243 DFBC 21FEFF          10      LD  HL,0-2
001246 DFBF 19              11      ADD HL,DE
001247 DFC0 D0              11      RET NC      ;DE= 0 or 1
001248 DFC1 D5              11      PUSH    DE
001249 DFC2 CDF7F0          17      CALL    _GNCL
00124C DFC5 ED53FEF1        20      LD  (_CLPS),DE
001250 DFC9 D1              10      POP DE
001251 DFCA 210000          10      LD  HL,0
001254 DFCD D4FAF0          17      CALL    NC,_SNCL
001257 DFD0 D8              11      RET C
001258 DFD1 ED5BFEF1        20      LD  DE,(_CLPS)  ;FAT
00125C DFD5 18E1            12      JR  KILLS1
                                
       DFD7                     KILLW:
00125E DFD7 CD6DDD          17      CALL    SOPEN
       DFDA                     KILLW1:
001261 DFDA 380B            12      JR  C,KILLW2
001263 DFDC CD0DDE          17      CALL    SOPENE2
001266 DFDF CDA6DF          17      CALL    KILLS
001269 DFE2 CDD1DD          17      CALL    NOPEN
00126C DFE5 18F3            12      JR  KILLW1
       DFE7                     KILLW2:
00126E DFE7 C8              11      RET Z
00126F DFE8 3F               4      CCF
001270 DFE9 C9              10      RET
                                
       DFEA                     CHKATT:
001271 DFEA E5              11      PUSH    HL
001272 DFEB 110B00          10      LD  DE,00BH
001275 DFEE 19              11      ADD HL,DE
001276 DFEF A6               7      AND (HL)
001277 DFF0 E1              10      POP HL
001278 DFF1 C8              11      RET Z
001279 DFF2 37               4      SCF
00127A DFF3 C9              10      RET
                                
       DFF4                     NAME:
00127B DFF4 CD6EE0          17      CALL    CHKWILDX
00127E DFF7 D8              11      RET C
00127F DFF8 110400          10      LD  DE,4
001282 DFFB 19              11      ADD HL,DE
001283 DFFC 2214E0          16      LD  (NAMEP+2),HL
001286 DFFF 23               6      INC HL
001287 E000 CD72E0          17      CALL    CHKWILD
00128A E003 D8              11      RET C
                                
00128B E004 CD40DD          17      CALL    SOPENX
00128E E007 3E0F             7      LD  A,00FH
001290 E009 D4EADF          17      CALL    NC,CHKATT
001293 E00C D8              11      RET C
                                
001294 E00D FD7E00          19      LD  A,(IY+0)
001297 E010 FDE5            15      PUSH    IY
001299 E012 FD210000        14  NAMEP:  LD  IY,0        ;自己書き換え
00129D E016 FD7700          19      LD  (IY+0),A
0012A0 E019 CD40DD          17      CALL    SOPENX
0012A3 E01C FDE3            23      EX  (SP),IY
0012A5 E01E 3F               4      CCF
0012A6 E01F D46DDD          17      CALL    NC,SOPEN
0012A9 E022 EB               4      EX  DE,HL
0012AA E023 E1              10      POP HL
0012AB E024 D8              11      RET C
                                
       E025                     SETNAME:
0012AC E025 01000B          10      LD  BC,11*256
0012AF E028 23               6      INC HL
0012B0 E029 7E               7      LD  A,(HL)
0012B1 E02A FEE5             7      CP  0E5H
0012B3 E02C 2004            12      JR  NZ,SNAME1
0012B5 E02E 3E05             7      LD  A,5
0012B7 E030 180E            12      JR  SNAME3
       E032                     SNAME1:
0012B9 E032 7E               7      LD  A,(HL)
0012BA E033 0C               4      INC C
0012BB E034 0D               4      DEC C
0012BC E035 2009            12      JR  NZ,SNAME3
0012BE E037 CD43DF          17      CALL    CAP
0012C1 E03A FEA0             7      CP  0A0H
0012C3 E03C 2002            12      JR  NZ,SNAME3
0012C5 E03E 3E20             7      LD  A,020H
       E040                     SNAME3:
0012C7 E040 12               7      LD  (DE),A
0012C8 E041 7E               7      LD  A,(HL)
0012C9 E042 23               6      INC HL
0012CA E043 CD5BE0          17      CALL    FKAN
0012CD E046 10EA            13      DJNZ    SNAME1
       E048                     WTDB:
0012CF E048 3EFF             7      LD  A,0FFH
0012D1 E04A 3239F0          13      LD  (SFILE),A
       E04D                     SWTDBF:
0012D4 E04D 3E01             7      LD  A,1
0012D6 E04F 32A4F0          13      LD  (_WTDBF),A
0012D9 E052 AF               4      XOR A
0012DA E053 C9              10      RET
                                
       E054                     FKANC:
0012DB E054 CB41             8      BIT 0,C
0012DD E056 CC4CDF          17      CALL    Z,CAP2
0012E0 E059 1801            12      JR  FKANX
       E05B                     FKAN:           ;漢字チェック
0012E2 E05B 13               6      INC DE
       E05C                     FKANX:
0012E3 E05C CB41             8      BIT 0,C
0012E5 E05E CB81             8      RES 0,C
0012E7 E060 C0              11      RET NZ
0012E8 E061 FE80             7      CP  080H
0012EA E063 D8              11      RET C
0012EB E064 FEA0             7      CP  0A0H
0012ED E066 3803            12      JR  C,FKAN1
0012EF E068 FEE0             7      CP  0E0H
0012F1 E06A D8              11      RET C
       E06B                     FKAN1:
0012F2 E06B 0C               4      INC C
0012F3 E06C A7               4      AND A
0012F4 E06D C9              10      RET
                                
       E06E                     CHKWILDX:
0012F5 E06E FDE5            15      PUSH    IY
0012F7 E070 E1              10      POP HL
0012F8 E071 23               6      INC HL
       E072                     CHKWILD:
0012F9 E072 060B             7      LD  B,11
0012FB E074 3E3F             7      LD  A,'?'
       E076                     CHKWIL1:
0012FD E076 BE               7      CP  (HL)
0012FE E077 23               6      INC HL
0012FF E078 37               4      SCF
001300 E079 C8              11      RET Z
001301 E07A 10FA            13      DJNZ    CHKWIL1
001303 E07C AF               4      XOR A
001304 E07D C9              10      RET
                                
       E07E                     SDIRENT:        ;IY=FCB HL=DIR
001305 E07E D5              11      PUSH    DE
001306 E07F E5              11      PUSH    HL
001307 E080 FDE5            15      PUSH    IY
001309 E082 D1              10      POP DE
00130A E083 EB               4      EX  DE,HL
00130B E084 CD25E0          17      CALL    SETNAME
                                ;               Attribute
00130E E087 FD7E0D          19      LD  A,(IY+13)   ;(FCB)属性(アトリビュート)
001311 E08A 12               7      LD  (DE),A
001312 E08B 13               6      INC DE
                                ;               Reserved
001313 E08C AF               4      XOR A
001314 E08D 060A             7      LD  B,10
       E08F                     SDE1:
001316 E08F 12               7      LD  (DE),A
001317 E090 13               6      INC DE
001318 E091 10FC            13      DJNZ    SDE1
                                                    ;(FCB)更新時刻
00131A E093 21EAF1          10      LD  HL,SDDATA       ;(FCB)更新年月日
00131D E096 060A             7      LD  B,SDDATAE-SDDATA    ;(FCB)ファイルの先頭クラスタ
       E098                     SDLOOP:                 ;(FCB)ファイルのサイズ(バイト単位)
00131F E098 7E               7      LD  A,(HL)
001320 E099 23               6      INC HL
001321 E09A 329FE0          13      LD  (SDPAT+2),A
001324 E09D FD7E00          19  SDPAT:  LD  A,(IY+0)    ;LD A,(IY+A)
001327 E0A0 12               7      LD  (DE),A
001328 E0A1 13               6      INC DE
001329 E0A2 10F4            13      DJNZ    SDLOOP
                                
00132B E0A4 AF               4      XOR A
00132C E0A5 E1              10      POP HL
00132D E0A6 D1              10      POP DE
00132E E0A7 C9              10      RET
                                
       E0A8                     WOPEN:
00132F E0A8 FD7E0D          19      LD  A,(IY+13)   ;(FCB)属性(アトリビュート)
001332 E0AB E61F             7      AND 01FH
001334 E0AD 37               4      SCF
001335 E0AE C0              11      RET NZ
001336 E0AF FD361CFE        19      LD  (IY+28),0FEH    ;(FCB)オープンモード
       E0B3                     TOPEN2:
00133A E0B3 AF               4      XOR A
       E0B4                     TOPEN:              ;Initializes the time stamp
00133B E0B4 FD3617FF        19      LD  (IY+23),0FFH    ;(FCB)更新時刻
00133F E0B8 C9              10      RET
                                
       E0B9                     WRDFX:
001340 E0B9 3A22DF          13      LD  A,(SPCPAT+1)    ;1クラスタの論理セクタ
       E0BC                     L_WRFX:
001343 E0BC 1F               4      RRA         ;->CF
001344 E0BD 3806            12      JR  C,E_WRFX
001346 E0BF CB39             8      SRL C
001348 E0C1 CB1C             8      RR  H       ;CH=CH/2
00134A E0C3 18F7            12      JR  L_WRFX
       E0C5                     E_WRFX:
00134C E0C5 44               4      LD  B,H
00134D E0C6 04               4      INC B
00134E E0C7 3E37             7      LD  A,037H      ;SCF
001350 E0C9 3241E5          13      LD  (DRDN1),A
                                
       E0CC                     WRDF:               ;Bクラスタ分FATを確保する
001353 E0CC 110200          10      LD  DE,2
001356 E0CF AF               4      XOR A
001357 E0D0 32B1E6          13      LD  (_SECPS+1),A
       E0D3                     WRDF1:
00135A E0D3 C5              11      PUSH    BC
00135B E0D4 D5              11      PUSH    DE
00135C E0D5 CDF7F0          17      CALL    _GNCL
00135F E0D8 381C            12      JR  C,WRDF3
001361 E0DA 7A               4      LD  A,D     ;空いているかチェック
001362 E0DB B3               4      OR  E
001363 E0DC 2027            12      JR  NZ,WRDF4
001365 E0DE E1              10      POP HL      ;HL=空いているクラスタ
001366 E0DF E5              11      PUSH    HL
001367 E0E0 ED5BFEF1        20      LD  DE,(_CLPS)  ;DE=元の(_CLPS)
00136B E0E4 22FEF1          16      LD  (_CLPS),HL
00136E E0E7 7A               4      LD  A,D     ;元の(_CLPS)が 0 か?
00136F E0E8 B3               4      OR  E
001370 E0E9 2008            12      JR  NZ,WRDF2
001372 E0EB FD751A          19      LD  (IY+26),L   ;(FCB)ファイルの先頭クラスタ
001375 E0EE FD741B          19      LD  (IY+27),H   ;元が空の場合はFCBにクラスタをセットする
001378 E0F1 1803            12      JR  WRDF3
       E0F3                     WRDF2:
00137A E0F3 CDFAF0          17      CALL    _SNCL
       E0F6                     WRDF3:
00137D E0F6 D1              10      POP DE
00137E E0F7 C1              10      POP BC
00137F E0F8 D8              11      RET C
001380 E0F9 100C            13      DJNZ    WRDF5       ;ここでループカウンタチェック
001382 E0FB ED5BFEF1        20      LD  DE,(_CLPS)
001386 E0FF 21FFFF          10      LD  HL,0FFFFH   ;FATエントリ終了(EOCマーク)
001389 E102 C3FAF0          10      JP  _SNCL
                                
       E105                     WRDF4:              ;DEクラスタが空じゃないので次に移動する
00138C E105 D1              10      POP DE
00138D E106 C1              10      POP BC
       E107                     WRDF5:
00138E E107 13               6      INC DE
00138F E108 CD3BDF          17      CALL    ENDCL
001392 E10B 38C6            12      JR  C,WRDF1
001394 E10D 37               4      SCF
001395 E10E C9              10      RET
                                
       E10F                     RWXR:
001396 E10F 3A40E4          13      LD  A,(SECSZ+2) ;1024=4 / 512=2 / 256=1
       E112                     L_RWX:
001399 E112 1F               4      RRA     ;->CF
00139A E113 3808            12      JR  C,E_RWX
00139C E115 CB38             8      SRL B   ;BCH=BCH/2
00139E E117 CB19             8      RR  C   ;
0013A0 E119 CB1C             8      RR  H   ;
0013A2 E11B 18F5            12      JR  L_RWX
       E11D                     E_RWX:
0013A4 E11D FD5E1A          19      LD  E,(IY+26)   ;(FCB)ファイルの先頭クラスタ
0013A7 E120 FD561B          19      LD  D,(IY+27)
0013AA E123 AF               4      XOR A
0013AB E124 32B1E6          13      LD  (_SECPS+1),A
       E127                     RWX1:
0013AE E127 ED53FEF1        20      LD  (_CLPS),DE
0013B2 E12B 7A               4      LD  A,D
0013B3 E12C B3               4      OR  E
0013B4 E12D 2813            12      JR  Z,SCF_RET   ;RET DE==0 => CF=1
                                
0013B6 E12F 78               4      LD  A,B
0013B7 E130 B1               4      OR  C
0013B8 E131 B4               4      OR  H
0013B9 E132 C8              11      RET Z       ;RET BCH==0 => CF=0
                                
0013BA E133 CDB9E6          17      CALL    GNCLX
0013BD E136 D8              11      RET C
0013BE E137 7C               4      LD  A,H     ;
0013BF E138 25               4      DEC H       ;
0013C0 E139 B7               4      OR  A       ;DEC BCH
0013C1 E13A 2001            12      JR  NZ,RWX2     ;
0013C3 E13C 0B               6      DEC BC      ;
       E13D                     RWX2:
0013C4 E13D CD3BDF          17      CALL    ENDCL
0013C7 E140 38E5            12      JR  C,RWX1
       E142                     SCF_RET:
0013C9 E142 37               4      SCF
0013CA E143 C9              10      RET
                                
       E144                     DSKF:
0013CB E144 110000          10  MAXCLP: LD  DE,0
0013CE E147 2AACF0          16      LD  HL,(_FAKEFREE)
0013D1 E14A 7C               4      LD  A,H
0013D2 E14B B5               4      OR  L
0013D3 E14C 2803            12      JR  Z,DSKF1
0013D5 E14E 110100          10      LD  DE,1
       E151                     DSKF1:
0013D8 E151 D5              11      PUSH    DE
0013D9 E152 CDF7F0          17      CALL    _GNCL
0013DC E155 380C            12      JR  C,POPSCF
0013DE E157 7A               4      LD  A,D
0013DF E158 B3               4      OR  E
0013E0 E159 2001            12      JR  NZ,DSKF2
0013E2 E15B 23               6      INC HL
       E15C                     DSKF2:
0013E3 E15C D1              10      POP DE
0013E4 E15D 1B               6      DEC DE
0013E5 E15E 7A               4      LD  A,D
0013E6 E15F B3               4      OR  E
0013E7 E160 20EF            12      JR  NZ,DSKF1
0013E9 E162 C9              10      RET
                                
       E163                     POPSCF:
0013EA E163 F1              10      POP AF
0013EB E164 37               4      SCF
0013EC E165 C9              10      RET
                                
       E166                     SETTMS:
0013ED E166 FD7E17          19      LD  A,(IY+23)   ;(FCB)ファイルを最後に変更した時刻
0013F0 E169 3C               4      INC A
0013F1 E16A C0              11      RET NZ      ;ファイルが更新されていない
       E16B                     SETTMSX:            ;FCBに日付時刻をセットする
0013F2 E16B CDD1D8          17      CALL    _SYS2C      ;(BDOS)時刻の獲得
                                                ;H←時  L←分  D←秒
0013F5 E16E CB25             8      SLA L       ;   *2
0013F7 E170 CB25             8      SLA L       ;   *4
0013F9 E172 29              11      ADD HL,HL       ;*2 *8
0013FA E173 29              11      ADD HL,HL       ;*4 *16
0013FB E174 29              11      ADD HL,HL       ;*8 *32
0013FC E175 7A               4      LD  A,D
0013FD E176 0F               4      RRCA            ;bit.0->7->->->0->C
0013FE E177 E61F             7      AND 01FH
001400 E179 B5               4      OR  L
001401 E17A FD7716          19      LD  (IY+22),A   ;(FCB)ファイルを最後に変更した時刻
001404 E17D FD7417          19      LD  (IY+23),H
                                
001407 E180 CDCBD8          17      CALL    _SYS2A      ;(BDOS)日付の獲得
                                                ;HL←年  D←月  E←日
00140A E183 0144F8          10      LD  BC,0-1980
00140D E186 09              11      ADD HL,BC
00140E E187 65               4      LD  H,L
                                
00140F E188 7A               4      LD  A,D
001410 E189 87               4      ADD A,A     ;*2
001411 E18A 87               4      ADD A,A     ;*4
001412 E18B 87               4      ADD A,A     ;*8
001413 E18C 87               4      ADD A,A     ;*16
001414 E18D 6F               4      LD  L,A
001415 E18E 29              11      ADD HL,HL       ;*32
001416 E18F 7D               4      LD  A,L
001417 E190 B3               4      OR  E
001418 E191 FD7714          19      LD  (IY+20),A   ;(FCB)ファイルを最後に変更した日付
00141B E194 FD7415          19      LD  (IY+21),H
00141E E197 C9              10      RET
                                
       E198                     PUSHRR:
00141F E198 3237E2          13      LD  (SETSEQ_SWC_RND),A
001422 E19B 2249E2          16      LD  (SETSEQ_SWC_SEQ_RR),HL
001425 E19E CDBEE1          17      CALL    GET_RR_AHL
001428 E1A1 225AF0          16      LD  (HLBUF),HL
00142B E1A4 325CF0          13      LD  (HLBUF+2),A
00142E E1A7 C9              10      RET
                                
       E1A8                     GET_CPM_R_SIZE:     ;バイト単位からCP/Mのレコード単位を求める（1レコード=128バイト）
00142F E1A8 87               4      ADD A,A     ;in BHLA => out AHL
001430 E1A9 ED6A            15      ADC HL,HL
001432 E1AB CB18             8      RR  B
001434 E1AD B7               4      OR  A
001435 E1AE 78               4      LD  A,B     ;ここでフラグは変化しない
001436 E1AF C8              11      RET Z
001437 E1B0 2C               4      INC L       ;INC AHL
001438 E1B1 C0              11      RET NZ      ;
001439 E1B2 24               4      INC H       ;
00143A E1B3 C0              11      RET NZ      ;
00143B E1B4 3C               4      INC A       ;
00143C E1B5 C9              10      RET
                                
       E1B6                     INIT_RND:
00143D E1B6 3ECD             7      LD  A,0CDH      ;CALL ????
00143F E1B8 2107E2          10      LD  HL,POPRR
001442 E1BB CD98E1          17      CALL    PUSHRR
       E1BE                     GET_RR_AHL:
001445 E1BE FD6E21          19      LD  L,(IY+33)   ;(FCB)Random record
001448 E1C1 FD6622          19      LD  H,(IY+34)   ;
00144B E1C4 FD7E23          19      LD  A,(IY+35)   ;
00144E E1C7 C9              10      RET
       E1C8                     SET_RR_AHL:
00144F E1C8 FD7521          19      LD  (IY+33),L   ;(FCB)Random record
001452 E1CB FD7422          19      LD  (IY+34),H
001455 E1CE FD7723          19      LD  (IY+35),A
001458 E1D1 C9              10      RET
       E1D2                     INIT_SEQ:
001459 E1D2 3E01             7      LD  A,1     ;LD BC,????
00145B E1D4 2104E2          10      LD  HL,SETSEQ
00145E E1D7 CD98E1          17      CALL    PUSHRR
       E1DA                     GETSEQ:
001461 E1DA FD6E20          19      LD  L,(IY+32)   ;(FCB)カレントレコード
001464 E1DD FD660C          19      LD  H,(IY+12)   ;(FCB)カレントブロック
001467 E1E0 AF               4      XOR A
                                
001468 E1E1 CB25             8      SLA L   ;L=L*2
                                
00146A E1E3 CB3C             8      SRL H   ;HL=HL/2
00146C E1E5 CB1D             8      RR  L   ;
00146E E1E7 C9              10      RET
                                
       E1E8                     SETSEQ1:
00146F E1E8 F5              11      PUSH    AF      
001470 E1E9 E5              11      PUSH    HL      ;AHL=Random record
001471 E1EA FD7E21          19      LD  A,(IY+33)   ;(FCB)ランダムレコード
001474 E1ED FD6E22          19      LD  L,(IY+34)
001477 E1F0 FD6623          19      LD  H,(IY+35)
00147A E1F3 0600             7      LD  B,0
                                
00147C E1F5 CDA8E1          17      CALL    GET_CPM_R_SIZE
                                
00147F E1F8 29              11      ADD HL,HL
001480 E1F9 CB3D             8      SRL L       ;L=L/2
001482 E1FB FD7520          19      LD  (IY+32),L   ;(FCB)カレントレコード
001485 E1FE FD740C          19      LD  (IY+12),H   ;(FCB)カレントブロック
001488 E201 E1              10      POP HL
001489 E202 F1              10      POP AF
00148A E203 C9              10      RET
       E204                     SETSEQ:
00148B E204 CDE8E1          17      CALL    SETSEQ1
       E207                     POPRR:
00148E E207 F5              11      PUSH    AF
00148F E208 E5              11      PUSH    HL
001490 E209 2A5AF0          16      LD  HL,(HLBUF)
001493 E20C 3A5CF0          13      LD  A,(HLBUF+2)
001496 E20F CDC8E1          17      CALL    SET_RR_AHL
001499 E212 E1              10      POP HL
00149A E213 F1              10      POP AF
00149B E214 C9              10      RET
                                
       E215                     RB_WRITE:
00149C E215 C5              11      PUSH    BC
00149D E216 ED4B4CF1        20      LD  BC,(STABLE+2*026H)  ;(BDOS)ランダムブロック書き込み
0014A1 E21A 1805            12      JR  RBRW
       E21C                     RB_READ:
0014A3 E21C C5              11      PUSH    BC
0014A4 E21D ED4B4EF1        20      LD  BC,(STABLE+2*027H)  ;(BDOS)ランダムブロック読み込み
       E221                     RBRW:
0014A8 E221 CB3F             8      SRL A   ;AHLA' = HL*128
0014AA E223 CB1C             8      RR  H   ;AHL=AHL/2
0014AC E225 CB1D             8      RR  L   ;
0014AE E227 3E00             7      LD  A,0
0014B0 E229 1F               4      RRA     ;A'HLA
0014B1 E22A FD7721          19      LD  (IY+33),A   ;(FCB)ランダムレコード
0014B4 E22D FD7522          19      LD  (IY+34),L
0014B7 E230 FD7423          19      LD  (IY+35),H
0014BA E233 218000          10      LD  HL,128
0014BD E236 C5              11      PUSH    BC
       E237                     SETSEQ_SWC_RND:
0014BE E237 CDE8E1          17      CALL    SETSEQ1
0014C1 E23A C1              10      POP BC
0014C2 E23B FDCB20FE        23      SET 7,(IY+32)   ;(FCB)カレントレコード
0014C6 E23F FDE5            15      PUSH    IY
0014C8 E241 D1              10      POP DE
0014C9 E242 D5              11      PUSH    DE
0014CA E243 CD51E2          17      CALL    JP_BC
0014CD E246 FDE1            14      POP IY
       E249                     SETSEQ_SWC_SEQ_RR   EQU $+1
0014CF E248 CD04E2          17      CALL    SETSEQ
0014D2 E24B FDCB20BE        23      RES 7,(IY+32)   ;(FCB)カレントレコード
                                
0014D6 E24F C1              10      POP BC
0014D7 E250 C9              10      RET
       E251                     JP_BC:
0014D8 E251 C5              11      PUSH    BC
0014D9 E252 C9              10      RET
                                
       DDCB                     _SYS03  EQU SCF_FF_RET  ;(BDOS)外部入力
       DDCB                     _SYS2B  EQU SCF_FF_RET  ;(BDOS)日付の設定
       DDCB                     _SYS2D  EQU SCF_FF_RET  ;(BDOS)時刻の設定
       DDCB                     _SYS39  EQU SCF_FF_RET  ;(BDOS)サブディレクトリの作成
       DDCB                     _SYS3A  EQU SCF_FF_RET  ;(BDOS)サブディレクトリの削除
                                
[EOF:LDFILE.ASM:SHIFT_JIS]
                                    INCLUDE "LDFILE2.ASM"
                                
                                ;   LSX-Dodgers FILE2
                                
                                                ;Write random block
       E253                     _SYS26:     ;(BDOS)ランダムブロック書き込み
0014DA E253 AF               4      XOR A
0014DB E254 3241E5          13      LD  (DRDN1),A   ;NOP
0014DE E257 2285E4          16      LD  (LEFT+1),HL ;HL←書き込むレコード数
0014E1 E25A 225DF0          16      LD  (LEFTX),HL
0014E4 E25D CD20DD          17      CALL    SETDRV
                                
0014E7 E260 CDDAE3          17      CALL    RBX0
0014EA E263 DAFDE2          10      JP  C,RBWERR
0014ED E266 CDA8E0          17      CALL    WOPEN
0014F0 E269 DAFDE2          10      JP  C,RBWERR
0014F3 E26C 7C               4      LD  A,H
0014F4 E26D B5               4      OR  L
0014F5 E26E CAF6E2          10      JP  Z,RBW1
                                
0014F8 E271 2B               6      DEC HL
                                
0014F9 E272 CDA7E4          17      CALL    GET_RR_BCDE ;BCDE=Random record
                                
0014FC E275 19              11      ADD HL,DE       ;BCHL=HL+BCDE
0014FD E276 3001            12      JR  NC,S26X1    ;
0014FF E278 03               6      INC BC      ;
       E279                     S26X1:
001500 E279 CD0FE1          17      CALL    RWXR
001503 E27C DCB9E0          17      CALL    C,WRDFX
001506 E27F DAFDE2          10      JP  C,RBWERR
                                
001509 E282 CD09E4          17      CALL    RBX2
00150C E285 281A            12      JR  Z,RBWB      ;NZ=セクタ以下の端数がある
00150E E287 CD28E4          17      CALL    RBXA
001511 E28A 3871            12      JR  C,RBWERR
001513 E28C EB               4      EX  DE,HL
001514 E28D C5              11      PUSH    BC
001515 E28E EDB0                    LDIR
001517 E290 225FF0          16      LD  (DTAX),HL
                                
00151A E293 CD4DE0          17      CALL    SWTDBF      ;バッファデータは更新された
                                
00151D E296 2A5DF0          16      LD  HL,(LEFTX)
001520 E299 D1              10      POP DE
001521 E29A ED52            15      SBC HL,DE
001523 E29C 225DF0          16      LD  (LEFTX),HL
001526 E29F 2833            12      JR  Z,RBWEND
                                
       E2A1                     RBWB:
001528 E2A1 CD5EE4          17      CALL    RBXB
00152B E2A4 2816            12      JR  Z,RBWC
       E2A6                     RBWB1:
00152D E2A6 C5              11      PUSH    BC
00152E E2A7 D5              11      PUSH    DE
00152F E2A8 CD1EDF          17      CALL    CLUSTX
001532 E2AB CDBBE4          17      CALL    DWTC
001535 E2AE D1              10      POP DE
001536 E2AF C1              10      POP BC
001537 E2B0 384B            12      JR  C,RBWERR
001539 E2B2 CDB9E6          17      CALL    GNCLX
00153C E2B5 3846            12      JR  C,RBWERR
00153E E2B7 10ED            13      DJNZ    RBWB1
001540 E2B9 CD0BE5          17      CALL    DRW_FLUSH
       E2BC                     RBWC:
001543 E2BC CD78E4          17      CALL    RBXC
001546 E2BF 2813            12      JR  Z,RBWEND
001548 E2C1 C5              11      PUSH    BC
001549 E2C2 CD1EDF          17      CALL    CLUSTX
00154C E2C5 CD40E5          17      CALL    DRDN
00154F E2C8 C1              10      POP BC
001550 E2C9 3832            12      JR  C,RBWERR
001552 E2CB ED5B7EF1        20      LD  DE,(_DTBUF)
001556 E2CF EDB0                    LDIR
001558 E2D1 CD4DE0          17      CALL    SWTDBF      ;バッファデータは更新された
       E2D4                     RBWEND:
00155B E2D4 CD84E4          17      CALL    RBXEND
                                
00155E E2D7 CDE9E3          17      CALL    RBX1
001561 E2DA 301A            12      JR  NC,RBW1
001563 E2DC 2A85E4          16      LD  HL,(LEFT+1)
001566 E2DF FD5E10          19      LD  E,(IY+16)   ;(FCB)ファイルのサイズ(バイト単位)
001569 E2E2 FD5611          19      LD  D,(IY+17)   ;DE=File size
00156C E2E5 19              11      ADD HL,DE
00156D E2E6 FD7510          19      LD  (IY+16),L   ;(FCB)ファイルのサイズ(バイト単位)
001570 E2E9 FD7411          19      LD  (IY+17),H
001573 E2EC 3008            12      JR  NC,RBW1
001575 E2EE FD3412          23      INC (IY+18)
001578 E2F1 2003            12      JR  NZ,RBW1
00157A E2F3 FD3413          23      INC (IY+19)
       E2F6                     RBW1:
00157D E2F6 FDE1            14      POP IY
00157F E2F8 C1              10      POP BC
001580 E2F9 D1              10      POP DE
001581 E2FA E1              10      POP HL
       E2FB                     DD_NUL:
001582 E2FB AF               4      XOR A
       E2FC                     DRDF0:
       E2FC                     DWTF0:
001583 E2FC C9              10      RET
                                
       E2FD                     RBWERR:
001584 E2FD FDE5            15      PUSH    IY
001586 E2FF D1              10      POP DE
001587 E300 2A20F1          16      LD  HL,(STABLE+2*010H)
00158A E303 CD0F00          17      CALL    JP_HL
       E306                     RBRERR1:
00158D E306 3E01             7      LD  A,001H
       E308                     RBRERR2:
00158F E308 FDE1            14      POP IY
001591 E30A C1              10      POP BC
001592 E30B D1              10      POP DE
001593 E30C E1              10      POP HL
001594 E30D 37               4      SCF
001595 E30E 210000          10      LD  HL,0
001598 E311 C9              10      RET
                                
       E312                     RBRERR:
001599 E312 3EFF             7      LD  A,0FFH
00159B E314 18F2            12      JR  RBRERR2
                                
       E316                     RBRFL:
00159D E316 3E00             7  RBRFLP: LD  A,000H
00159F E318 FE0D             7      CP  00DH
0015A1 E31A 2005            12      JR  NZ,RBRFL1
0015A3 E31C D5              11      PUSH    DE
0015A4 E31D 1E0A             7      LD  E,00AH
0015A6 E31F 1805            12      JR  RBRFL2
       E321                     RBRFL1:
0015A8 E321 D5              11      PUSH    DE
0015A9 E322 CD09F0          17      CALL    _SYS07
0015AC E325 5F               4      LD  E,A
       E326                     RBRFL2:
0015AD E326 CDCDF0          17      CALL    _PRINT
0015B0 E329 7B               4      LD  A,E
0015B1 E32A D1              10      POP DE
0015B2 E32B 3217E3          13      LD  (RBRFLP+1),A
0015B5 E32E C9              10      RET
       E32F                     DDX:
0015B6 E32F FD7E01          19      LD  A,(IY+1)    ;(FCB)主ファイル名
0015B9 E332 CD43DF          17      CALL    CAP
0015BC E335 FE41             7      CP  'A'
0015BE E337 C9              10      RET
                                
                                                ;Read random block
       E338                     _SYS27:     ;(BDOS)ランダムブロック読み込み
0015BF E338 225DF0          16      LD  (LEFTX),HL
0015C2 E33B CD20DD          17      CALL    SETDRV
                                
0015C5 E33E FDCB0D66        20      BIT 4,(IY+13)   ;(FCB)属性(アトリビュート)
0015C9 E342 C2C8E3          10      JP  NZ,RBRDIR   ;ディレクトリ
0015CC E345 CDDAE3          17      CALL    RBX0
0015CF E348 DA12E3          10      JP  C,RBRERR
0015D2 E34B CDE9E3          17      CALL    RBX1
0015D5 E34E DA06E3          10      JP  C,RBRERR1
0015D8 E351 EB               4      EX  DE,HL
0015D9 E352 ED52            15      SBC HL,DE       ;CP 00HL,BCDE
0015DB E354 19              11      ADD HL,DE
0015DC E355 79               4      LD  A,C
0015DD E356 DE00             7      SBC A,0
0015DF E358 78               4      LD  A,B
0015E0 E359 DE00             7      SBC A,0
0015E2 E35B 3801            12      JR  C,RBR1
0015E4 E35D EB               4      EX  DE,HL
       E35E                     RBR1:
0015E5 E35E 9F               4      SBC A,A
0015E6 E35F E601             7      AND 1
0015E8 E361 32C6E3          13      LD  (RBRAP+1),A
                                
0015EB E364 7C               4      LD  A,H
0015EC E365 B5               4      OR  L
0015ED E366 2857            12      JR  Z,RBREND0
                                
0015EF E368 2285E4          16      LD  (LEFT+1),HL ;Read record byte
0015F2 E36B 225DF0          16      LD  (LEFTX),HL
                                
0015F5 E36E CD09E4          17      CALL    RBX2
0015F8 E371 2819            12      JR  Z,RBRB
0015FA E373 CD28E4          17      CALL    RBXA
0015FD E376 DA12E3          10      JP  C,RBRERR
001600 E379 C5              11      PUSH    BC
001601 E37A EDB0                    LDIR
001603 E37C ED535FF0        20      LD  (DTAX),DE
001607 E380 2A5DF0          16      LD  HL,(LEFTX)
00160A E383 D1              10      POP DE
00160B E384 A7               4      AND A
00160C E385 ED52            15      SBC HL,DE
00160E E387 225DF0          16      LD  (LEFTX),HL
001611 E38A 2830            12      JR  Z,RBREND
                                
       E38C                     RBRB:
001613 E38C CD5EE4          17      CALL    RBXB
001616 E38F 2815            12      JR  Z,RBRC
       E391                     RBRB1:
001618 E391 C5              11      PUSH    BC
001619 E392 D5              11      PUSH    DE
00161A E393 CD1EDF          17      CALL    CLUSTX
00161D E396 CDC1E4          17      CALL    DRDC
001620 E399 D1              10      POP DE
001621 E39A C1              10      POP BC
001622 E39B D4B9E6          17      CALL    NC,GNCLX
001625 E39E DA12E3          10      JP  C,RBRERR
001628 E3A1 10EE            13      DJNZ    RBRB1
00162A E3A3 CD0BE5          17      CALL    DRW_FLUSH
       E3A6                     RBRC:
00162D E3A6 CD78E4          17      CALL    RBXC
001630 E3A9 2811            12      JR  Z,RBREND
001632 E3AB C5              11      PUSH    BC
001633 E3AC CD1EDF          17      CALL    CLUSTX
001636 E3AF CD24E5          17      CALL    DRDX
001639 E3B2 C1              10      POP BC
00163A E3B3 DA12E3          10      JP  C,RBRERR
00163D E3B6 EB               4      EX  DE,HL
00163E E3B7 2A7EF1          16      LD  HL,(_DTBUF)
001641 E3BA EDB0                    LDIR
       E3BC                     RBREND:
001643 E3BC CD84E4          17      CALL    RBXEND
       E3BF                     RBREND0:
001646 E3BF FDE1            14      POP IY
001648 E3C1 C1              10      POP BC
001649 E3C2 D1              10      POP DE
00164A E3C3 F1              10      POP AF  ;(HL)
00164B E3C4 AF               4      XOR A
00164C E3C5 3E00             7  RBRAP:  LD  A,000H
00164E E3C7 C9              10      RET
                                
       E3C8                     RBRDIR:
00164F E3C8 FD6E1A          19      LD  L,(IY+26)   ;(FCB)ファイルの先頭クラスタ
001652 E3CB FD661B          19      LD  H,(IY+27)
001655 E3CE CD5EDF          17      CALL    CHDIR
001658 E3D1 AF               4      XOR A
001659 E3D2 67               4      LD  H,A
00165A E3D3 6F               4      LD  L,A
00165B E3D4 3C               4      INC A
00165C E3D5 32C6E3          13      LD  (RBRAP+1),A
00165F E3D8 18E5            12      JR  RBREND0
                                
       E3DA                     RBX0:
001661 E3DA 2A8AF0          16      LD  HL,(_DTA)
001664 E3DD 225FF0          16      LD  (DTAX),HL
001667 E3E0 2A5DF0          16      LD  HL,(LEFTX)
00166A E3E3 FD7E1C          19      LD  A,(IY+28)   ;(FCB)オープンモード
00166D E3E6 D6FD             7      SUB 0FDH
00166F E3E8 C9              10      RET
                                
       E3E9                     RBX1:
001670 E3E9 E5              11      PUSH    HL      ;Record byte
                                                ;AHL=File size
001671 E3EA FD6E10          19      LD  L,(IY+16)   ;ファイルのサイズ(バイト単位)
001674 E3ED FD6611          19      LD  H,(IY+17)   ;
001677 E3F0 FD7E12          19      LD  A,(IY+18)   ;
                                
00167A E3F3 CDA7E4          17      CALL    GET_RR_BCDE ;BCDE=Random record
                                
00167D E3F6 A7               4      AND A
00167E E3F7 ED52            15      SBC HL,DE
001680 E3F9 99               4      SBC A,C
001681 E3FA 4F               4      LD  C,A
001682 E3FB FD7E13          19      LD  A,(IY+19)   ;ファイルのサイズ
001685 E3FE 98               4      SBC A,B
001686 E3FF D1              10      POP DE
                                
001687 E400 D8              11      RET C
001688 E401 47               4      LD  B,A
001689 E402 B1               4      OR  C
00168A E403 EB               4      EX  DE,HL   ;BCDE=File byte HL=Record byte
00168B E404 B2               4      OR  D
00168C E405 B3               4      OR  E
00168D E406 C0              11      RET NZ
00168E E407 37               4      SCF
00168F E408 C9              10      RET
                                
       E409                     RBX2:               ;Cluster settings
001690 E409 FD6622          19      LD  H,(IY+34)   ;(+33)(FCB)ランダムレコード
001693 E40C FD4E23          19      LD  C,(IY+35)
001696 E40F 0600             7      LD  B,0
001698 E411 FDCB207E        20      BIT 7,(IY+32)   ;(FCB)カレントレコード
00169C E415 2003            12      JR  NZ,RBX3
00169E E417 FD4624          19      LD  B,(IY+36)
       E41A                     RBX3:
0016A1 E41A CD0FE1          17      CALL    RWXR
0016A4 E41D 3A40E4          13      LD  A,(SECSZ+2) ;1024=4 / 512=2 / 256=1
0016A7 E420 3D               4      DEC A
0016A8 E421 FDA622          19      AND (IY+34)
0016AB E424 FDB621          19      OR  (IY+33)
0016AE E427 C9              10      RET
                                
       E428                     RBXA:
0016AF E428 C5              11      PUSH    BC
0016B0 E429 D5              11      PUSH    DE
0016B1 E42A CD1EDF          17      CALL    CLUSTX
0016B4 E42D CD24E5          17      CALL    DRDX
0016B7 E430 D1              10      POP DE
0016B8 E431 C1              10      POP BC
0016B9 E432 D8              11      RET C
0016BA E433 CDB9E6          17      CALL    GNCLX
0016BD E436 D8              11      RET C
0016BE E437 ED53FEF1        20      LD  (_CLPS),DE
                                
0016C2 E43B FD4E21          19      LD  C,(IY+33)   ;(FCB)ランダムレコード
0016C5 E43E 210004          10  SECSZ:  LD  HL,0400H    ;自己書き換え 1024=0400H / 512=0200H ここに1セクタのサイズが格納される
0016C8 E441 7C               4      LD  A,H
0016C9 E442 3D               4      DEC A       ;1024=3 / 512=1
0016CA E443 FDA622          19      AND (IY+34)     ;(FCB)ランダムレコード
0016CD E446 47               4      LD  B,A     ;BCに1セクタ以下の端数が入る
0016CE E447 ED42            15      SBC HL,BC       ;残りを計算
                                
0016D0 E449 ED5B5DF0        20      LD  DE,(LEFTX)
0016D4 E44D ED52            15      SBC HL,DE       ;CP HL,DE
0016D6 E44F 19              11      ADD HL,DE       ;
0016D7 E450 3801            12      JR  C,RBXA1     ;DEとHLを比較して大きい方をHLに
0016D9 E452 EB               4      EX  DE,HL
       E453                     RBXA1:
0016DA E453 E5              11      PUSH    HL
0016DB E454 2A7EF1          16      LD  HL,(_DTBUF)
0016DE E457 09              11      ADD HL,BC
0016DF E458 ED5B5FF0        20      LD  DE,(DTAX)
0016E3 E45C C1              10      POP BC
0016E4 E45D C9              10      RET
                                
       E45E                     RBXB:
0016E5 E45E 2A5FF0          16      LD  HL,(DTAX)
0016E8 E461 FD5E1A          19      LD  E,(IY+26)   ;(FCB)ファイルの先頭クラスタ
0016EB E464 FD561B          19      LD  D,(IY+27)
0016EE E467 3A5EF0          13      LD  A,(LEFTX+1)
0016F1 E46A 47               4      LD  B,A
0016F2 E46B 3A40E4          13      LD  A,(SECSZ+2) ;1024=4 / 512=2 / 256=1
       E46E                     RBXB1:
0016F5 E46E 1F               4      RRA     ;->CF
0016F6 E46F 3804            12      JR  C,RBXB2
0016F8 E471 CB38             8      SRL B   ;B=B/2
0016FA E473 18F9            12      JR  RBXB1
       E475                     RBXB2:
0016FC E475 78               4      LD  A,B
0016FD E476 B7               4      OR  A
0016FE E477 C9              10      RET
                                
       E478                     RBXC:
0016FF E478 ED4B5DF0        20      LD  BC,(LEFTX)
001703 E47C 3A40E4          13      LD  A,(SECSZ+2) ;1024=4 / 512=2 / 256=1
001706 E47F 3D               4      DEC A
001707 E480 A0               4      AND B
001708 E481 47               4      LD  B,A     ;1セクタ以下の端数がない場合はZ
001709 E482 B1               4      OR  C
00170A E483 C9              10      RET
                                
       E484                     RBXEND:
00170B E484 110000          10  LEFT:   LD  DE,0
00170E E487 AF               4      XOR A
00170F E488 FD6E21          19      LD  L,(IY+33)   ;(FCB)ランダムレコード
001712 E48B FD6622          19      LD  H,(IY+34)
001715 E48E 19              11      ADD HL,DE
001716 E48F FD7521          19      LD  (IY+33),L   ;(FCB)ランダムレコード
001719 E492 FD7422          19      LD  (IY+34),H
00171C E495 300E            12      JR  NC,RBXEND1
00171E E497 FD3423          23      INC (IY+35)
001721 E49A 2009            12      JR  NZ,RBXEND1
001723 E49C FDCB207E        20      BIT 7,(IY+32)   ;(FCB)カレントレコード
001727 E4A0 2003            12      JR  NZ,RBXEND1
001729 E4A2 FD3424          23      INC (IY+36)
       E4A5                     RBXEND1:
00172C E4A5 EB               4      EX  DE,HL       ;HL=Read byte
00172D E4A6 C9              10      RET
                                
       E4A7                     GET_RR_BCDE:            ;BCDE=Random record
00172E E4A7 FD5E21          19      LD  E,(IY+33)   ;(FCB)ランダムレコード
001731 E4AA FD5622          19      LD  D,(IY+34)
001734 E4AD FD4E23          19      LD  C,(IY+35)
001737 E4B0 FD4624          19      LD  B,(IY+36)
00173A E4B3 FDCB207E        20      BIT 7,(IY+32)   ;(FCB)カレントレコード
00173E E4B7 C8              11      RET Z
00173F E4B8 0600             7      LD  B,0     ;CP/M互換のアクセスの場合はFCBは36バイト
001741 E4BA C9              10      RET
                                
                                ;   ランダムブロックアクセスの連続したセクタをまとめる
                                
       E4BB                     DWTC:
001742 E4BB E5              11      PUSH    HL
001743 E4BC 214BE8          10      LD  HL,DWT24B
001746 E4BF 1804            12      JR  DWTC1
       E4C1                     DRDC:
001748 E4C1 E5              11      PUSH    HL
001749 E4C2 213BE8          10      LD  HL,DRD24B
       E4C5                     DWTC1:
00174C E4C5 221FE5          16      LD  (DRWF_MODE),HL
00174F E4C8 E1              10      POP HL
001750 E4C9 3A0FE5          13      LD  A,(DRWF_B)
001753 E4CC B7               4      OR  A
001754 E4CD 200F            12      JR  NZ,DRDC1
       E4CF                     SAVE_DRWC:
001756 E4CF 0601             7      LD  B,1
001758 E4D1 ED430EE5        20      LD  (DRWF_C),BC
00175C E4D5 ED5315E5        20      LD  (DRWF_E),DE
001760 E4D9 2218E5          16      LD  (DRWF_HL),HL
001763 E4DC 1820            12      JR  INC_HL_DRWC
       E4DE                     DRDC1:
001765 E4DE E5              11      PUSH    HL
001766 E4DF 2115E5          10      LD  HL,DRWF_E
001769 E4E2 86               7      ADD A,(HL)
00176A E4E3 F5              11      PUSH    AF
00176B E4E4 BB               4      CP  E
00176C E4E5 201D            12      JR  NZ,DRDC2
00176E E4E7 F1              10      POP AF
00176F E4E8 23               6      INC HL
001770 E4E9 7E               7      LD  A,(HL)
001771 E4EA CE00             7      ADC A,0
001773 E4EC F5              11      PUSH    AF
001774 E4ED BA               4      CP  D
001775 E4EE 2014            12      JR  NZ,DRDC2
001777 E4F0 F1              10      POP AF
001778 E4F1 3A0EE5          13      LD  A,(DRWF_C)
00177B E4F4 CE00             7      ADC A,0
00177D E4F6 B9               4      CP  C
00177E E4F7 200C            12      JR  NZ,DRDC3
001780 E4F9 210FE5          10      LD  HL,DRWF_B
001783 E4FC 34              11      INC (HL)
001784 E4FD E1              10      POP HL
       E4FE                     INC_HL_DRWC:
001785 E4FE 3A40E4          13      LD  A,(SECSZ+2)     ;1セクタのサイズの上位1バイト
001788 E501 84               4      ADD A,H
001789 E502 67               4      LD  H,A
00178A E503 C9              10      RET
       E504                     DRDC2:
00178B E504 F1              10      POP AF
       E505                     DRDC3:
00178C E505 CD0BE5          17      CALL    DRW_FLUSH
00178F E508 E1              10      POP HL
001790 E509 18C4            12      JR  SAVE_DRWC
                                
                                ;   ランダムブロックアクセスの連続したセクタをまとめたものをフラッシュする
       E50B                     DRW_FLUSH:
001792 E50B C5              11      PUSH    BC
001793 E50C D5              11      PUSH    DE
       E50E                     DRWF_C  EQU $+1
       E50F                     DRWF_B  EQU $+2
001794 E50D 010000          10      LD  BC,0
001797 E510 78               4      LD  A,B
001798 E511 B7               4      OR  A
001799 E512 280D            12      JR  Z,DRDF1
       E515                     DRWF_E  EQU $+1
       E516                     DRWF_D  EQU $+2
00179B E514 110000          10      LD  DE,0
       E518                     DRWF_HL EQU $+1
00179E E517 210000          10      LD  HL,0
0017A1 E51A AF               4      XOR A
0017A2 E51B 320FE5          13      LD  (DRWF_B),A
       E51F                     DRWF_MODE   EQU $+1
0017A5 E51E CD3BE8          17      CALL    DRD24B
       E521                     DRDF1:
0017A8 E521 D1              10      POP DE
0017A9 E522 C1              10      POP BC
0017AA E523 C9              10      RET
[EOF:LDFILE2.ASM:SHIFT_JIS]
                                    INCLUDE "LDDIO.ASM"
                                
                                ;   LSX-Dodgers DIO
                                
       E524                     DRDX:
0017AB E524 CD62E5          17      CALL    DRDY
0017AE E527 C8              11      RET Z
0017AF E528 CD48E5          17      CALL    DRDX1       ;データバッファの情報を保存
0017B2 E52B D8              11      RET C
0017B3 E52C E5              11      PUSH    HL
0017B4 E52D C5              11      PUSH    BC
0017B5 E52E D5              11      PUSH    DE
0017B6 E52F 2A7EF1          16      LD  HL,(_DTBUF)
0017B9 E532 3A8BE5          13      LD  A,(_DBS24+1)
0017BC E535 4F               4      LD  C,A
0017BD E536 CD39E8          17      CALL    DRD24
0017C0 E539 DC5DE5          17      CALL    C,DRDNE
       E53C                     POP_DE_BC_HL_RET:
0017C3 E53C D1              10      POP DE
0017C4 E53D C1              10      POP BC
0017C5 E53E E1              10      POP HL
0017C6 E53F C9              10      RET
                                
                                ;   CDE:セクタ番号
       E540                     DRDN:
0017C7 E540 AF               4      XOR A
0017C8 E541 00               4  DRDN1:  NOP         ;自己書き換え NOP / SCF
0017C9 E542 30E0            12      JR  NC,DRDX
       E544                     DRDNX:
0017CB E544 CD62E5          17      CALL    DRDY
0017CE E547 C8              11      RET Z
       E548                     DRDX1:
0017CF E548 CD78E5          17      CALL    DWTX
                                                ;データバッファの読み込んだドライブ・セクタ情報を保存
0017D2 E54B ED53A6F0        20      LD  (_DBSEC),DE
0017D6 E54F 79               4      LD  A,C
0017D7 E550 328BE5          13      LD  (_DBS24+1),A
                                
0017DA E553 3A88F0          13      LD  A,(_DRV)
0017DD E556 32A5F0          13      LD  (_DBDRV),A
0017E0 E559 CDD9F0          17      CALL    _CHGDRV
0017E3 E55C D0              11      RET NC
       E55D                     DRDNE:
0017E4 E55D 9F               4      SBC A,A     ;CF=1ならばA=0FFH
0017E5 E55E 32A5F0          13      LD  (_DBDRV),A
0017E8 E561 C9              10      RET
                                
                                ;   CDE:セクタ番号
       E562                     DRDY:
0017E9 E562 3A8BE5          13      LD  A,(_DBS24+1)
0017EC E565 B9               4      CP  C
0017ED E566 C0              11      RET NZ
                                
0017EE E567 E5              11      PUSH    HL
0017EF E568 3A88F0          13      LD  A,(_DRV)
0017F2 E56B 21A5F0          10      LD  HL,_DBDRV
0017F5 E56E AE               7      XOR (HL)
0017F6 E56F 2005            12      JR  NZ,POP_HL_RET
                                
0017F8 E571 2AA6F0          16      LD  HL,(_DBSEC)
0017FB E574 ED52            15      SBC HL,DE       ;CF=0
       E576                     POP_HL_RET:
0017FD E576 E1              10      POP HL
0017FE E577 C9              10      RET
                                
       E578                     DWTX:
0017FF E578 3AA4F0          13      LD  A,(_WTDBF)
001802 E57B B7               4      OR  A
001803 E57C C8              11      RET Z
001804 E57D AF               4      XOR A
001805 E57E 32A4F0          13      LD  (_WTDBF),A
                                
001808 E581 E5              11      PUSH    HL
001809 E582 C5              11      PUSH    BC
00180A E583 D5              11      PUSH    DE
00180B E584 3AA5F0          13      LD  A,(_DBDRV)
00180E E587 CDD9F0          17      CALL    _CHGDRV
001811 E58A 0E00             7  _DBS24: LD  C,0
001813 E58C ED5BA6F0        20      LD  DE,(_DBSEC)
001817 E590 2A7EF1          16      LD  HL,(_DTBUF)
00181A E593 D449E8          17      CALL    NC,DWT24
       E596                     POP_DE_BC_HL_RET2:
00181D E596 18A4            12      JR  POP_DE_BC_HL_RET
                                
       E598                     RDFATX:
00181F E598 E5              11      PUSH    HL
001820 E599 3A88F0          13      LD  A,(_DRV)
001823 E59C 21AAF0          10      LD  HL,_FATDRV
001826 E59F AE               7      XOR (HL)
001827 E5A0 28D4            12      JR  Z,POP_HL_RET
                                
001829 E5A2 C5              11      PUSH    BC
00182A E5A3 D5              11      PUSH    DE
00182B E5A4 DDE5            15      PUSH    IX
00182D E5A6 CDC2E5          17      CALL    WTFATX
001830 E5A9 3813            12      JR  C,POP_IX_DE_BC_HL_RET
                                
001832 E5AB AF               4      XOR A
001833 E5AC 32ABF0          13      LD  (_FATIX),A
001836 E5AF 3A88F0          13      LD  A,(_DRV)
001839 E5B2 32AAF0          13      LD  (_FATDRV),A
00183C E5B5 CDE5F0          17      CALL    _RDFAT
       E5B8                     RDFATE2:
00183F E5B8 3004            12      JR  NC,POP_IX_DE_BC_HL_RET
001841 E5BA 9F               4      SBC A,A     ;A=0xFF
001842 E5BB 32AAF0          13      LD  (_FATDRV),A
       E5BE                     POP_IX_DE_BC_HL_RET:
001845 E5BE DDE1            14      POP IX
001847 E5C0 18D4            12      JR  POP_DE_BC_HL_RET2
                                
       E5C2                     WTFATX:
001849 E5C2 3AA2F0          13      LD  A,(_WTFATF)
00184C E5C5 B7               4      OR  A
00184D E5C6 C8              11      RET Z
00184E E5C7 E5              11      PUSH    HL
00184F E5C8 3AAAF0          13      LD  A,(_FATDRV)
001852 E5CB 21A5F0          10      LD  HL,_DBDRV
001855 E5CE AE               7      XOR (HL)
001856 E5CF CC78E5          17      CALL    Z,DWTX
001859 E5D2 38A2            12      JR  C,POP_HL_RET
00185B E5D4 C5              11      PUSH    BC
00185C E5D5 D5              11      PUSH    DE
00185D E5D6 DDE5            15      PUSH    IX
00185F E5D8 CD56E8          17      CALL    WTFAT
001862 E5DB AF               4      XOR A
001863 E5DC 32A2F0          13      LD  (_WTFATF),A
001866 E5DF 18DD            12      JR  POP_IX_DE_BC_HL_RET
                                
       E5E1                     NCL1:
001868 E5E1 7A               4      LD  A,D
001869 E5E2 B3               4      OR  E
00186A E5E3 37               4      SCF
00186B E5E4 C8              11      RET Z
                                
00186C E5E5 7A               4      LD  A,D
00186D E5E6 CB3F             8      SRL A   ;/2
00186F E5E8 CB3F             8      SRL A   ;/2
                                
001871 E5EA E5              11      PUSH    HL
001872 E5EB 320AE6          13      LD  (NCLPAT+2),A    ;_FATIX
001875 E5EE 2AAAF0          16      LD  HL,(_FATDRV)    ;L=_FATDRV H=_FATIX
001878 E5F1 BC               4      CP  H
001879 E5F2 3A88F0          13      LD  A,(_DRV)    ;この間でフラグは変化しない
00187C E5F5 3209E6          13      LD  (NCLPAT+1),A    ;_FATDRV
00187F E5F8 2005            12      JR  NZ,NCL2     ;FATIXが違う
001881 E5FA BD               4      CP  L
001882 E5FB 2002            12      JR  NZ,NCL2     ;ドライブが違う
001884 E5FD E1              10      POP HL
001885 E5FE C9              10      RET
       E5FF                     NCL2:
001886 E5FF C5              11      PUSH    BC
001887 E600 D5              11      PUSH    DE
001888 E601 DDE5            15      PUSH    IX
00188A E603 CDC2E5          17      CALL    WTFATX
00188D E606 38B6            12      JR  C,POP_IX_DE_BC_HL_RET
00188F E608 010000          10  NCLPAT: LD  BC,0        ;自己書き換え C=_FATDRV B=_FATIX
001892 E60B ED43AAF0        20      LD  (_FATDRV),BC
001896 E60F CD2BE8          17      CALL    RDFATS
001899 E612 18A4            12      JR  RDFATE2
                                
       E614                     NCL3:
00189B E614 CB9A             8      RES 3,D
00189D E616 CB92             8      RES 2,D
00189F E618 6B               4      LD  L,E
0018A0 E619 62               4      LD  H,D
0018A1 E61A CB3C             8      SRL H   ;
0018A3 E61C CB1D             8      RR  L   ;HLA=HLA/2
0018A5 E61E 1F               4      RRA     ;
0018A6 E61F F5              11      PUSH    AF
0018A7 E620 3AABF0          13      LD  A,(_FATIX)
0018AA E623 0F               4      RRCA
0018AB E624 300B            12      JR  NC,NCL3X1
0018AD E626 3A40E4          13      LD  A,(SECSZ+2)
0018B0 E629 FE04             7      CP  4       ;1セクタ1024バイトの場合は奇数インデックスの場合に先頭を512バイトずらす
0018B2 E62B 2004            12      JR  NZ,NCL3X1
0018B4 E62D 010002          10      LD  BC,512
0018B7 E630 09              11      ADD HL,BC
       E631                     NCL3X1:
0018B8 E631 F1              10      POP AF
0018B9 E632 ED4B7CF1        20      LD  BC,(_FATBF)
0018BD E636 19              11      ADD HL,DE
0018BE E637 09              11      ADD HL,BC
0018BF E638 17               4      RLA
0018C0 E639 C9              10      RET
                                
       E63A                     GNCL:
0018C1 E63A CDE1E5          17      CALL    NCL1        ;GET NEXT CLUSTER
0018C4 E63D D8              11      RET C
0018C5 E63E C5              11      PUSH    BC
0018C6 E63F E5              11      PUSH    HL
0018C7 E640 CD14E6          17      CALL    NCL3
0018CA E643 3809            12      JR  C,GNC1
0018CC E645 5E               7      LD  E,(HL)
0018CD E646 23               6      INC HL
0018CE E647 7E               7      LD  A,(HL)
0018CF E648 E60F             7      AND 00FH
0018D1 E64A 57               4      LD  D,A
0018D2 E64B E1              10      POP HL
0018D3 E64C C1              10      POP BC
0018D4 E64D C9              10      RET
       E64E                     GNC1:
0018D5 E64E 7E               7      LD  A,(HL)
0018D6 E64F 23               6      INC HL
0018D7 E650 56               7      LD  D,(HL)
0018D8 E651 0604             7      LD  B,4
       E653                     GNC1L:
0018DA E653 CB3A             8      SRL D   ;DA=DA/2
0018DC E655 1F               4      RRA     ;
0018DD E656 10FB            13      DJNZ    GNC1L
                                
0018DF E658 5F               4      LD  E,A
0018E0 E659 E1              10      POP HL
0018E1 E65A C1              10      POP BC
0018E2 E65B A7               4      AND A
0018E3 E65C C9              10      RET
                                
       E65D                     SNCL:
0018E4 E65D CDE1E5          17      CALL    NCL1
0018E7 E660 D8              11      RET C
                                ;               SET NEXT CLUSTER
0018E8 E661 E5              11      PUSH    HL
0018E9 E662 C5              11      PUSH    BC
0018EA E663 D5              11      PUSH    DE
0018EB E664 E5              11      PUSH    HL
0018EC E665 CD14E6          17      CALL    NCL3
0018EF E668 D1              10      POP DE
                                ;CF=ODD
0018F0 E669 7E               7      LD  A,(HL)
0018F1 E66A 73               7      LD  (HL),E
0018F2 E66B 3806            12      JR  C,SNC1
                                ;EVEN
                                ;M[0] = E
                                ;M[1] = (M[1] & 0xF0) | (D & 0x0F)
0018F4 E66D 23               6      INC HL
0018F5 E66E ED67            18      RRD     ;M={A[3:0],E[3:0]}
0018F7 E670 7A               4      LD  A,D
0018F8 E671 1804            12      JR  SNC11
       E673                     SNC1:
                                ;ODD
                                ;HL[0] = (HL[0]&0x0F) | (E<<4)
                                ;HL[1] = DE>>4
0018FA E673 ED6F            18      RLD     ;M={D[3:0],E[7:4]}
0018FC E675 23               6      INC HL
0018FD E676 72               7      LD  (HL),D  ;M={D[3:0],E[7:4]}
       E677                     SNC11:
0018FE E677 ED6F            18      RLD     ;M={M[7:4],D[3:0]}
001900 E679 B7               4      OR  A
001901 E67A D1              10      POP DE
001902 E67B C1              10      POP BC
001903 E67C E1              10      POP HL
       E67D                     FAT_CHANGED:
001904 E67D 3E01             7      LD  A,1
001906 E67F 32A2F0          13      LD  (_WTFATF),A
001909 E682 C9              10      RET
                                
       E683                     N16CL3:
00190A E683 C5              11      PUSH    BC
00190B E684 6B               4      LD  L,E
00190C E685 7A               4      LD  A,D
00190D E686 E603             7      AND 3
00190F E688 67               4      LD  H,A
001910 E689 29              11      ADD HL,HL
001911 E68A ED4B7CF1        20      LD  BC,(_FATBF)
001915 E68E 09              11      ADD HL,BC
001916 E68F C1              10      POP BC
001917 E690 C9              10      RET
                                
       E691                     GNCL16:
001918 E691 CDE1E5          17      CALL    NCL1        ;GET NEXT CLUSTER for FAT16
00191B E694 D8              11      RET C
00191C E695 E5              11      PUSH    HL
00191D E696 CD83E6          17      CALL    N16CL3
001920 E699 5E               7      LD  E,(HL)
001921 E69A 23               6      INC HL
001922 E69B 56               7      LD  D,(HL)
001923 E69C E1              10      POP HL
001924 E69D C9              10      RET
                                
       E69E                     SNCL16:
001925 E69E CDE1E5          17      CALL    NCL1        ;GET NEXT CLUSTER for FAT16
001928 E6A1 D8              11      RET C
001929 E6A2 D5              11      PUSH    DE
00192A E6A3 E5              11      PUSH    HL
00192B E6A4 CD83E6          17      CALL    N16CL3
00192E E6A7 D1              10      POP DE      ;HL
00192F E6A8 73               7      LD  (HL),E
001930 E6A9 23               6      INC HL
001931 E6AA 72               7      LD  (HL),D
001932 E6AB 6B               4      LD  L,E
001933 E6AC 62               4      LD  H,D
001934 E6AD D1              10      POP DE
001935 E6AE 18CD            12      JR  FAT_CHANGED
                                
                                ;------------------------
                                ;次のセクタを探す際に_SECPSの値をチェック
                                ;in
                                ;   DE : セクタ番号
                                ;out
                                ;   DE : 次のセクタ番号
                                ;note
                                ;
                                ;------------------------
       E6B0                     NEXTX:
001937 E6B0 3E00             7  _SECPS: LD  A,0 ;自己書き換え
001939 E6B2 3C               4      INC A
00193A E6B3 E600             7  NCPAT:  AND 0   ;自己書き換え　1クラスタの論理セクタ数-1
00193C E6B5 32B1E6          13      LD  (_SECPS+1),A
00193F E6B8 C9              10      RET
                                
       E6B9                     GNCLX:
001940 E6B9 CDB0E6          17      CALL    NEXTX
001943 E6BC C0              11      RET NZ  ;1クラスタのセクタ未満の場合は戻る
001944 E6BD C3F7F0          10      JP  _GNCL   ;次のクラスタを探す
                                
       E6C0                     RDFAT:
001947 E6C0 3E80             7      LD  A,080H
001949 E6C2 3270F0          13      LD  (CHECK),A
       E6C5                     RDFAT1:
00194C E6C5 3A88F0          13      LD  A,(_DRV)
00194F E6C8 CD80E9          17      CALL    CHGDRVR
001952 E6CB D8              11      RET C
001953 E6CC DD7E12          19      LD  A,(IX+012H) ;DPB_12_DEVICE
001956 E6CF CB6F             8      BIT 5,A
001958 E6D1 286B            12      JR  Z,RDFAT0X
00195A E6D3 2170F0          10      LD  HL,CHECK
00195D E6D6 A6               7      AND (HL)
00195E E6D7 77               7      LD  (HL),A
00195F E6D8 110000          10      LD  DE,0        ;BPB
001962 E6DB 2A7CF1          16      LD  HL,(_FATBF)
001965 E6DE CD37E8          17      CALL    DRD16
001968 E6E1 3024            12      JR  NC,GETBPB
00196A E6E3 2170F0          10      LD  HL,CHECK
00196D E6E6 CB06            15      RLC (HL)
00196F E6E8 3F               4      CCF
001970 E6E9 D8              11      RET C
001971 E6EA DDCB0A1E        23      RR  (IX+00AH)   ;DPB_0A_FDMODE
001975 E6EE 3F               4      CCF         ;フロッピーディスクのFDモードを切り替える
001976 E6EF DDCB0A16        23      RL  (IX+00AH)   ;DPB_0A_FDMODE
00197A E6F3 3EFF             7      LD  A,0FFH
00197C E6F5 3289F0          13      LD  (_DSK),A
00197F E6F8 3A84F0          13      LD  A,(_DRIVE)
001982 E6FB E603             7      AND 3
001984 E6FD F680             7      OR  080H
001986 E6FF 6F               4      LD  L,A
001987 E700 26F0             7      LD  H,_CYL0/256
001989 E702 3EFF             7      LD  A,0FFH
00198B E704 77               7      LD  (HL),A
00198C E705 18BE            12      JR  RDFAT1
       E707                     GETBPB:
00198E E707 FDE5            15      PUSH    IY
001990 E709 FD2A7CF1        20      LD  IY,(_FATBF) ;BPB
001994 E70D CDF1F0          17      CALL    _BPB2DPB
001997 E710 FDE1            14      POP IY
001999 E712 DD7E12          19      LD  A,(IX+012H) ;DPB_12_DEVICE
00199C E715 3021            12      JR  NC,GETBPBOK
00199E E717 E60F             7      AND 00FH
0019A0 E719 FE07             7      CP  7
0019A2 E71B 37               4      SCF
0019A3 E71C C0              11      RET NZ
0019A4 E71D DDCB0A46        20      BIT 0,(IX+00AH) ;DPB_0A_FDMODE
0019A8 E721 21C0F1          10      LD  HL,M2D
0019AB E724 2002            12      JR  NZ,SETFDMODE
0019AD E726 2ED2             7      LD  L,M2HD-STABLE
       E728                     SETFDMODE:
0019AF E728 DDE5            15      PUSH    IX
0019B1 E72A D1              10      POP DE
0019B2 E72B EDA0            16      LDI
0019B4 E72D EDA0            16      LDI
0019B6 E72F 13               6      INC DE
0019B7 E730 13               6      INC DE
0019B8 E731 13               6      INC DE
0019B9 E732 13               6      INC DE
0019BA E733 010C00          10      LD  BC,12
0019BD E736 EDB0                    LDIR
       E738                     GETBPBOK:
0019BF E738 3247E7          13      LD  (DEVSWC),A
0019C2 E73B CDDFE8          17      CALL    CHGDRV2
       E73E                     RDFAT0X:
0019C5 E73E CD2BE8          17      CALL    RDFATS
0019C8 E741 D8              11      RET C
0019C9 E742 DDAE06          19      XOR (IX+6)      ;DPB_06_FATID
0019CC E745 C8              11      RET Z
       E747                     DEVSWC  EQU $+1
0019CD E746 3E00             7      LD  A,0     ;DPB_12_DEVICE
0019CF E748 CB6F             8      BIT 5,A
0019D1 E74A C0              11      RET NZ      ;BPBを取得している場合はFATIDをチェックしない
0019D2 E74B 37               4      SCF
0019D3 E74C C9              10      RET
                                
       E74D                     BPB2DPB:
0019D4 E74D FD7E0B          19      LD  A,(IY+11)   ;BPB_BytsPerSec
0019D7 E750 B7               4      OR  A
0019D8 E751 37               4      SCF
0019D9 E752 C0              11      RET NZ
       E753                     BPBOK:
0019DA E753 FD7E0D          19      LD  A,(IY+13)   ;BPB_SecPerClus
0019DD E756 DD7707          19      LD  (IX+7),A    ;DPB_07_SECPCL
                                
0019E0 E759 FD7E16          19      LD  A,(IY+22)   ;BPB_FATSz16
0019E3 E75C DD7700          19      LD  (IX+0),A    ;DPB_00_FATLN
0019E6 E75F FD7E17          19      LD  A,(IY+23)   ;BPB_FATSz16
0019E9 E762 DD7701          19      LD  (IX+1),A    ;DPB_00_FATLN
                                
0019EC E765 FD6E0E          19      LD  L,(IY+14)   ;BPB_RsvdSecCnt
0019EF E768 FD660F          19      LD  H,(IY+15)
0019F2 E76B DD750E          19      LD  (IX+00EH),L ;DPB_0E_FATPS
0019F5 E76E FD5E16          19      LD  E,(IY+22)   ;BPB_FATSz16
0019F8 E771 FD5617          19      LD  D,(IY+23)
0019FB E774 FD4610          19      LD  B,(IY+16)   ;BPB_NumFATs
       E777                     BPBDP1:             ;BPB_FATSz16 * BPB_NumFATs
0019FE E777 19              11      ADD HL,DE
0019FF E778 10FD            13      DJNZ    BPBDP1
       E77A                     BPBDP2:
001A01 E77A DD7510          19      LD  (IX+010H),L ;DPB_10_DIRPS
001A04 E77D DD7411          19      LD  (IX+011H),H
001A07 E780 E5              11      PUSH    HL
                                
001A08 E781 FD6E11          19      LD  L,(IY+17)   ;BPB_RootEntCnt
001A0B E784 FD6612          19      LD  H,(IY+18)
001A0E E787 FD7E0C          19      LD  A,(IY+12)   ;BPB_BytsPerSec
001A11 E78A B7               4      OR  A
001A12 E78B 37               4      SCF
001A13 E78C C8              11      RET Z
001A14 E78D 0606             7      LD  B,6
       E78F                     BPBBPS1:
001A16 E78F 05               4      DEC B
001A17 E790 0F               4      RRCA
001A18 E791 30FC            12      JR  NC,BPBBPS1
       E793                     BPBDE1:
001A1A E793 29              11      ADD HL,HL
001A1B E794 10FD            13      DJNZ    BPBDE1
                                
001A1D E796 7C               4      LD  A,H
001A1E E797 DD770B          19      LD  (IX+00BH),A ;DPB_0B_DIRSCNT
                                
001A21 E79A D1              10      POP DE      ;DPB_10_DIRPS
001A22 E79B 6C               4      LD  L,H
001A23 E79C 2600             7      LD  H,0
001A25 E79E 19              11      ADD HL,DE       ;MAXDIR
001A26 E79F E5              11      PUSH    HL
001A27 E7A0 FD4E0D          19      LD  C,(IY+13)   ;BPB_SecPerClus
001A2A E7A3 CB21             8      SLA C       ;*2
001A2C E7A5 AF               4      XOR A
001A2D E7A6 47               4      LD  B,A
001A2E E7A7 ED42            15      SBC HL,BC
001A30 E7A9 DD7514          19      LD  (IX+014H),L ;DPB_14_ADDCL16
001A33 E7AC DD7415          19      LD  (IX+015H),H
                                
001A36 E7AF D1              10      POP DE      ;DE=DPB_0B_MAXDIR
001A37 E7B0 FD6E13          19      LD  L,(IY+19)   ;BPB_TotSec16
001A3A E7B3 FD6614          19      LD  H,(IY+20)
                                
001A3D E7B6 DD7E12          19      LD  A,(IX+012H) ;DPB_12_DEVICE
001A40 E7B9 E60F             7      AND 00FH
001A42 E7BB FE07             7      CP  7       ;フロッピー
001A44 E7BD 2019            12      JR  NZ,NOT_FD
001A46 E7BF E5              11      PUSH    HL
001A47 E7C0 FD4E18          19      LD  C,(IY+24)   ;BPB_SecPerTr
001A4A E7C3 DD710D          19      LD  (IX+00DH),C ;DPB_0D_MAXSEC
001A4D E7C6 AF               4      XOR A
001A4E E7C7 CB21             8      SLA C       ;両面なのでセクタ数を２倍
001A50 E7C9 0610             7      LD  B,16
       E7CB                     DIVSEC:             ;MAXCYL = BPB_TotSec16 / (BPB_SecPerTr * 2)
001A52 E7CB 29              11      ADD HL,HL
001A53 E7CC 17               4      RLA
001A54 E7CD B9               4      CP  C
001A55 E7CE 3802            12      JR  C,DIVSEC1
001A57 E7D0 91               4      SUB C
001A58 E7D1 2C               4      INC L
       E7D2                     DIVSEC1:
001A59 E7D2 10F7            13      DJNZ    DIVSEC
001A5B E7D4 DD750C          19      LD  (IX+00CH),L ;DPB_0C_MAXCYL
001A5E E7D7 E1              10      POP HL  ;ここまでフロッピー専用
       E7D8                     NOT_FD:
001A5F E7D8 7C               4      LD  A,H
001A60 E7D9 B5               4      OR  L
001A61 E7DA 3E00             7      LD  A,0     ;LDでフラグは変化しない。BPB_TotSec16を AHL で扱う為、Aに0を入れる
001A63 E7DC 2010            12      JR  NZ,BPB16BIT ;BPB_TotSec16が「0」の場合はBPB_TotSec32で計算
001A65 E7DE FD7E23          19      LD  A,(IY+35)   ;念のために総セクタ数が24ビットを超える場合はエラーを返す
001A68 E7E1 B7               4      OR  A
001A69 E7E2 37               4      SCF
001A6A E7E3 C0              11      RET NZ
001A6B E7E4 FD6E20          19      LD  L,(IY+32)   ;BPB_TotSec32 は AHL の24ビットで扱う
001A6E E7E7 FD6621          19      LD  H,(IY+33)   ;1クラスタの論理セクタ数(DPB_07_SECPCL)が最大128なので
001A71 E7EA FD7E22          19      LD  A,(IY+34)   ;24ビットを超えると必ずクラスタ数が16ビットを超えてしまうのでこれで十分
001A74 E7ED A7               4      AND A       ;CF=0
       E7EE                     BPB16BIT:
001A75 E7EE ED52            15      SBC HL,DE
001A77 E7F0 DE00             7      SBC A,0
001A79 E7F2 FD460D          19      LD  B,(IY+13)   ;BPB_SecPerClus
       E7F5                     BPBTC1:             ;総クラスタ数(AHL) = 総セクタ数(AHL) / セクタサイズ(B)
001A7C E7F5 CB18             8      RR  B       ;->CY
001A7E E7F7 3808            12      JR  C,BPBTC2
001A80 E7F9 CB3F             8      SRL A
001A82 E7FB CB1C             8      RR  H       ;AHL=AHL/2
001A84 E7FD CB1D             8      RR  L
001A86 E7FF 18F4            12      JR  BPBTC1
       E801                     BPBTC2:
001A88 E801 B7               4      OR  A
001A89 E802 37               4      SCF
001A8A E803 C0              11      RET NZ      ;念のため(クラスタ数が16ビットを超える場合)
001A8B E804 23               6      INC HL
001A8C E805 23               6      INC HL
001A8D E806 DD7508          19      LD  (IX+8),L    ;DPB_08_MAXCL
001A90 E809 DD7409          19      LD  (IX+9),H
                                
001A93 E80C FD7E15          19      LD  A,(IY+21)   ;BPB_Media
001A96 E80F DD7706          19      LD  (IX+6),A    ;DPB_06_FATID
                                
001A99 E812 FD7E10          19      LD  A,(IY+16)   ;BPB_NumFATs
001A9C E815 C6FE             7      ADD A,0-2       ;>2:CF=1
001A9E E817 FD7E0C          19      LD  A,(IY+12)   ;BPB_BytsPerSec
001AA1 E81A 6F               4      LD  L,A
001AA2 E81B 3002            12      JR  NC,BPBFAT1
001AA4 E81D F680             7      OR  080H
       E81F                     BPBFAT1:
001AA6 E81F DD770F          19      LD  (IX+00FH),A ;DPB_0F_BPS
001AA9 E822 2D               4      DEC L       ;以下のセクタサイズに合致しない場合はCF=1でエラーにする
001AAA E823 C8              11      RET Z       ;1セクタ256バイト
001AAB E824 2D               4      DEC L
001AAC E825 C8              11      RET Z       ;1セクタ512バイト
001AAD E826 2D               4      DEC L
001AAE E827 2D               4      DEC L
001AAF E828 C8              11      RET Z       ;1セクタ1024バイト
001AB0 E829 37               4      SCF
001AB1 E82A C9              10      RET
                                
       E82B                     RDFATS:
001AB2 E82B CD71E8          17      CALL    FATSETUP
001AB5 E82E D8              11      RET C
001AB6 E82F CD3BE8          17      CALL    DRD24B
001AB9 E832 2A7CF1          16      LD  HL,(_FATBF)
001ABC E835 7E               7      LD  A,(HL)
001ABD E836 C9              10      RET
                                
       E837                     DRD16:
001ABE E837 0E00             7      LD  C,0
       E839                     DRD24:
001AC0 E839 0601             7      LD  B,1
       E83B                     DRD24B:
001AC2 E83B DDE5            15      PUSH    IX
001AC4 E83D DD2AA8F0        20      LD  IX,(_DPB)
001AC8 E841 CDCAEA          17  DRDPAT: CALL    FDRD        ;自己書き換え（ディスク読み込み）
       E844                     POP_IX_RET:
001ACB E844 DDE1            14      POP IX
001ACD E846 C9              10      RET
                                
       E847                     DWT16:
001ACE E847 0E00             7      LD  C,0
       E849                     DWT24:
001AD0 E849 0601             7      LD  B,1
       E84B                     DWT24B:
001AD2 E84B DDE5            15      PUSH    IX
001AD4 E84D DD2AA8F0        20      LD  IX,(_DPB)
001AD8 E851 CD70EA          17  DWTPAT: CALL    FDWT        ;自己書き換え（ディスク書き込み）
001ADB E854 18EE            12      JR  POP_IX_RET
                                
       E856                     WTFAT:
001ADD E856 CD71E8          17      CALL    FATSETUP
001AE0 E859 D44BE8          17      CALL    NC,DWT24B
001AE3 E85C D8              11      RET C
001AE4 E85D DDCB0F7E        20      BIT 7,(IX+00FH) ;DPB_0F_BPS
001AE8 E861 C8              11      RET Z       ;予備FATが無い
001AE9 E862 CD78E8          17      CALL    FATS2
001AEC E865 E5              11      PUSH    HL      ;予備FAT
001AED E866 DD6E00          19      LD  L,(IX+0)    ;DPB_00_FATLN
001AF0 E869 DD6601          19      LD  H,(IX+1)
001AF3 E86C 19              11      ADD HL,DE
001AF4 E86D EB               4      EX  DE,HL
001AF5 E86E E1              10      POP HL
001AF6 E86F 18DA            12      JR  DWT24B
                                ;------------------------
                                ;FATのセットアップ
                                ;out
                                ;   B  : FATセクタ数
                                ;   DE : FAT先頭セクタ番号
                                ;   HL : FATバッファポインタ
                                ;   CF : 1=ドライブ切り替えエラー
                                ;note
                                ;   FATサイズがFATバッファを超える場合は
                                ;   対象クラスタ領域==(_FATIX)によって
                                ;   FAT12:対象クラスタ1024毎に1.5KBを切り替える
                                ;   FAT16:対象クラスタ1024毎に2KBを切り替える
                                ;------------------------
       E871                     FATSETUP:
001AF8 E871 3AAAF0          13      LD  A,(_FATDRV)
001AFB E874 CD80E9          17      CALL    CHGDRVR     ;ドライブ切り替え
001AFE E877 D8              11      RET C
       E878                     FATS2:
001AFF E878 DD7E0F          19      LD  A,(IX+00FH) ;DPB_0F_BPS 512=2 1024=4
001B02 E87B 0F               4      RRCA
001B03 E87C CDA5E8          17  FATSX:  CALL    FATSETUP12  ;自己書き換え
001B06 E87F 210000          10      LD  HL,0
001B09 E882 4A               4      LD  C,D
001B0A E883 54               4      LD  D,H
001B0B E884 3AABF0          13      LD  A,(_FATIX)  ;範囲FAT12:0-3/FAT16:0-63(0-03FH):65535*2/2048
001B0E E887 47               4      LD  B,A
001B0F E888 04               4      INC B
001B10 E889 DD7E00          19      LD  A,(IX+0)    ;DPB_00_FATLN
       E88C                     FAT_SKP:
001B13 E88C 05               4      DEC B
001B14 E88D 2805            12      JR  Z,FAT1
001B16 E88F 19              11      ADD HL,DE
001B17 E890 93               4      SUB E
001B18 E891 30F9            12      JR  NC,FAT_SKP
001B1A E893 C9              10      RET
       E894                     FAT1:
001B1B E894 EB               4      EX  DE,HL
001B1C E895 B9               4      CP  C       ;C=FATバッファに読み込めるセクタ数
001B1D E896 3801            12      JR  C,FAT2
001B1F E898 79               4      LD  A,C
       E899                     FAT2:
001B20 E899 47               4      LD  B,A
                                
001B21 E89A 2AFAF1          16      LD  HL,(_FATPS) ;fat sector pos
001B24 E89D 19              11      ADD HL,DE
001B25 E89E EB               4      EX  DE,HL
001B26 E89F 2A7CF1          16      LD  HL,(_FATBF)
001B29 E8A2 AF               4      XOR A       ;CF=0
001B2A E8A3 4F               4      LD  C,A
001B2B E8A4 C9              10      RET
                                ;
                                ;   FATバッファに読み込める最大のセクタ数と_FATIXで進めるセクタ数
                                ;   FATSETUP* (FAT12/FAT16)
                                ;out
                                ;   D : FATバッファに読み込める最大のセクタ数
                                ;   E : _FATIXで進めるセクタ数
       E8A5                     FATSETUP12:
001B2C E8A5 110606          10      LD  DE,0606H    ;256
001B2F E8A8 D8              11      RET C
001B30 E8A9 110303          10      LD  DE,0303H    ;512
001B33 E8AC 0F               4      RRCA
001B34 E8AD D8              11      RET C
001B35 E8AE 110102          10      LD  DE,0201H    ;1024
001B38 E8B1 C9              10      RET
                                
       E8B2                     FATSETUP16:
001B39 E8B2 110808          10      LD  DE,0808H    ;256
001B3C E8B5 D8              11      RET C
001B3D E8B6 110404          10      LD  DE,0404H
001B40 E8B9 0F               4      RRCA            ;512
001B41 E8BA D8              11      RET C
001B42 E8BB 110202          10      LD  DE,0202H    ;1024
001B45 E8BE C9              10      RET
                                
       E8BF                     CHGDRV:
001B46 E8BF E5              11      PUSH    HL
001B47 E8C0 2189F0          10      LD  HL,_DSK
001B4A E8C3 BE               7      CP  (HL)
001B4B E8C4 280A            12      JR  Z,CHGDRVE
       E8C6                     CHGDRV1:
001B4D E8C6 DDE5            15      PUSH    IX
001B4F E8C8 CDD2E8          17      CALL    CHGDRV0
001B52 E8CB 3A89F0          13      LD  A,(_DSK)
001B55 E8CE DDE1            14      POP IX
       E8D0                     CHGDRVE:
001B57 E8D0 E1              10      POP HL
001B58 E8D1 C9              10      RET
                                
       E8D2                     CHGDRV0:
001B59 E8D2 6F               4      LD  L,A
001B5A E8D3 CDDCF0          17      CALL    _GETDPB
001B5D E8D6 D8              11      RET C
001B5E E8D7 DD22A8F0        20      LD  (_DPB),IX
001B62 E8DB 7D               4      LD  A,L
001B63 E8DC 3289F0          13      LD  (_DSK),A
       E8DF                     CHGDRV2:
001B66 E8DF C5              11      PUSH    BC
001B67 E8E0 D5              11      PUSH    DE
001B68 E8E1 ED7336E9        20      LD  (SPPAT2+1),SP
001B6C E8E5 F3               4      DI
001B6D E8E6 DDF9            10      LD  SP,IX
                                
001B6F E8E8 E1              10      POP HL      ;DPB_00_FATLN
001B70 E8E9 E1              10      POP HL      ;DPB_02_DRD
001B71 E8EA 2242E8          16      LD  (DRDPAT+1),HL
                                
001B74 E8ED E1              10      POP HL
001B75 E8EE 2252E8          16      LD  (DWTPAT+1),HL   ;DPB_04_DWT
                                
001B78 E8F1 E1              10      POP HL      ;L=DPB_06_FATID H=DPB_07_SECPCL
001B79 E8F2 7C               4      LD  A,H
001B7A E8F3 3222DF          13      LD  (SPCPAT+1),A    ;1クラスタの論理セクタ数
001B7D E8F6 3D               4      DEC A
001B7E E8F7 32B4E6          13      LD  (NCPAT+1),A
                                
001B81 E8FA E1              10      POP HL      ;DPB_08_MAXCL
001B82 E8FB 7D               4      LD  A,L
001B83 E8FC 3241DF          13      LD  (CLPAT2+1),A
001B86 E8FF 7C               4      LD  A,H
001B87 E900 323DDF          13      LD  (CLPAT1+1),A
001B8A E903 2B               6      DEC HL
001B8B E904 2245E1          16      LD  (MAXCLP+1),HL
                                
001B8E E907 E1              10      POP HL      ;L=DPB_0A_FDMODE H=DPB_0B_DIRSCNT
001B8F E908 7D               4      LD  A,L
001B90 E909 F6FE             7      OR  0FEH
001B92 E90B 32B3F0          13      LD  (FDMODE+1),A
001B95 E90E 07               4      RLCA
001B96 E90F E603             7      AND 3
001B98 E911 320DEA          13      LD  (FSPAT+1),A
001B9B E914 4C               4      LD  C,H
                                
001B9C E915 E1              10      POP HL      ;L=DPB_0C_MAXCYL H=DPB_0D_MAXSEC
                                
001B9D E916 E1              10      POP HL      ;L=DPB_0E_FATPS H=DPB_0F_BPS
001B9E E917 7C               4      LD  A,H     ;DPB_0F_BPS
001B9F E918 E607             7      AND 7
001BA1 E91A 3240E4          13      LD  (SECSZ+2),A ;1セクタのサイズの上位1バイト 0x400 - 0x200 - 0x100
                                                ;1セクタ512 2D/2DD/2HC/2HQ(2HD1.44MB)/EMM/BRAM/EMEM等
                                                ;1セクタ1024 2HD/2HDE98
                                                ;1セクタ256 GRAM/RAMF/CMOS/等
                                                ;1024   512 256
                                                ;4  2   1
001BA4 E91D 87               4      ADD A,A     ;8  4   2
001BA5 E91E 87               4      ADD A,A     ;010H   8   4
001BA6 E91F 87               4      ADD A,A     ;020H   010H    8
001BA7 E920 329EDD          13      LD  (SDECPAT+1),A   ;1セクタ辺りのディレクトリエントリ数
                                
001BAA E923 2600             7      LD  H,0
001BAC E925 22FAF1          16      LD  (_FATPS),HL
                                
001BAF E928 E1              10      POP HL      ;DPB_10_DIRPS
001BB0 E929 22FCF1          16      LD  (_DIRPS),HL
                                
001BB3 E92C E1              10      POP HL      ;L=DPB_12_DEVICE H=DPB_13_UNITNO
001BB4 E92D 7C               4      LD  A,H
001BB5 E92E 3284F0          13      LD  (_DRIVE),A
                                
001BB8 E931 E1              10      POP HL      ;DPB_14_ADDCL16
001BB9 E932 2232DF          16      LD  (CLSPAT+1),HL
                                
001BBC E935 310000          10  SPPAT2: LD  SP,0        ;元のSPを復元
001BBF E938 FB               4      EI
001BC0 E939 2AFCF1          16      LD  HL,(_DIRPS)
001BC3 E93C 0600             7      LD  B,0
001BC5 E93E 09              11      ADD HL,BC       ;C=DPB_0B_DIRSCNT
001BC6 E93F 22B9DD          16      LD  (MD_PAT+1),HL
                                
001BC9 E942 2A45E1          16      LD  HL,(MAXCLP+1);
001BCC E945 11F60F          10      LD  DE,4086     ;クラスタ数が4086未満:FAT12 4086以上:FAT16
001BCF E948 ED52            15      SBC HL,DE       ;CF=0のはず
001BD1 E94A 300F            12      JR  NC,SETFAT16
001BD3 E94C 213AE6          10      LD  HL,GNCL     ;FAT12
001BD6 E94F 115DE6          10      LD  DE,SNCL
001BD9 E952 01A5E8          10      LD  BC,FATSETUP12
001BDC E955 DDCB0FAE        23      RES 5,(IX+00FH) ;DPB_0F_BPS(FAT12)
001BE0 E959 180D            12      JR  EXTRA1
       E95B                     SETFAT16:
001BE2 E95B 2191E6          10      LD  HL,GNCL16   ;FAT16
001BE5 E95E 119EE6          10      LD  DE,SNCL16
001BE8 E961 01B2E8          10      LD  BC,FATSETUP16
001BEB E964 DDCB0FEE        23      SET 5,(IX+00FH) ;DPB_0F_BPS(FAT16)
       E968                     EXTRA1:
001BEF E968 22F8F0          16      LD  (GNCPAT+1),HL
001BF2 E96B ED53FBF0        20      LD  (SNCPAT+1),DE
001BF6 E96F ED437DE8        20      LD  (FATSX+1),BC
001BFA E973 D1              10      POP DE
001BFB E974 C1              10      POP BC
001BFC E975 AF               4      XOR A
001BFD E976 C9              10      RET
                                
       E977                     GETDPBD:
001BFE E977 DDE3            23      EX  (SP),IX
001C00 E979 DDE5            15      PUSH    IX
001C02 E97B 3A88F0          13      LD  A,(_DRV)
001C05 E97E 1807            12      JR  GETDPB1
                                
       E980                     CHGDRVR:
001C07 E980 CDD9F0          17      CALL    _CHGDRV
001C0A E983 D8              11      RET C
001C0B E984 3A89F0          13      LD  A,(_DSK)
       E987                     GETDPB1:
001C0E E987 C3DCF0          10      JP  _GETDPB
                                
       E98A                     GETDPB:
001C11 E98A FE08             7      CP  8
001C13 E98C 3F               4      CCF
001C14 E98D D8              11      RET C
001C15 E98E 0F               4      RRCA
001C16 E98F 0F               4      RRCA
001C17 E990 0F               4      RRCA
001C18 E991 DD                      DB  0DDH        ;Z80未定義命令
001C19 E992 6F               4      LD  L,A     ;LD IXL,A
001C1A E993 DD                      DB  0DDH        ;Z80未定義命令
001C1B E994 26F2             7      LD  H,DEVICE/256    ;LD IXH,DEVICE/256
001C1D E996 DD7E00          19      LD  A,(IX+0)    ;DPB_00_FATLN
001C20 E999 A7               4      AND A       ;CF=0の為
001C21 E99A DDCB0F6E        20      BIT 5,(IX+00FH) ;DPB_0F_BPS
001C25 E99E C0              11      RET NZ      ;FAT16
001C26 E99F DDCB126E        20      BIT 5,(IX+012H) ;DPB_12_DEVICE
001C2A E9A3 C0              11      RET NZ      ;BPB
001C2B E9A4 FE01             7      CP  001H        ;A=0 THEN CF=1
001C2D E9A6 C9              10      RET
                                
       E9A7                     _SYS5F:
001C2E E9A7 AF               4      XOR A
       E9A8                     FFLUSH:
001C2F E9A8 F5              11      PUSH    AF
001C30 E9A9 3EFF             7      LD  A,0FFH
001C32 E9AB 3239F0          13      LD  (SFILE),A
001C35 E9AE CD78E5          17      CALL    DWTX
001C38 E9B1 3EFF             7      LD  A,0FFH
001C3A E9B3 32A5F0          13      LD  (_DBDRV),A
001C3D E9B6 CDC2E5          17      CALL    WTFATX
001C40 E9B9 AF               4      XOR A
001C41 E9BA 32ABF0          13      LD  (_FATIX),A
001C44 E9BD 2F               4      CPL         ;0FFH
001C45 E9BE 32AAF0          13      LD  (_FATDRV),A
001C48 E9C1 F1              10      POP AF
001C49 E9C2 C9              10      RET
                                
[EOF:LDDIO.ASM:SHIFT_JIS]
                                    INCLUDE "M7DISK.ASM"
                                
                                ;   LSX-Dodgers DISK
                                ;   MZ-700/1500
                                
       E9C3                     SEEK:
001C4A E9C3 0610             7      LD  B,16
001C4C E9C5 DD4E0D          19  MAXSEC: LD  C,(IX+0DH)  ;DPB_0D_MAXSEC
001C4F E9C8 AF               4      XOR A
001C50 E9C9 EB               4      EX  DE,HL
       E9CA                     DIV1:
001C51 E9CA 29              11      ADD HL,HL
001C52 E9CB 8F               4      ADC A,A
001C53 E9CC B9               4      CP  C
001C54 E9CD 3802            12      JR  C,DIV2
001C56 E9CF 91               4      SUB C
001C57 E9D0 2C               4      INC L
       E9D1                     DIV2:
001C58 E9D1 10F7            13      DJNZ    DIV1
                                
001C5A E9D3 3C               4      INC A   ;最小のセクタは１固定
001C5B E9D4 55               4      LD  D,L ;TRACK
001C5C E9D5 5F               4      LD  E,A ;SECTOR
                                
001C5D E9D6 3A84F0          13      LD  A,(_DRIVE)
001C60 E9D9 FE04             7      CP  4
001C62 E9DB 3F               4      CCF
001C63 E9DC D8              11      RET C
001C64 E9DD F684             7      OR  084H        ;Motor on + ドライブセレクト有効
001C66 E9DF D3DC            11      OUT (0DCH),A
001C68 E9E1 CB3A             8      SRL D       ;CYLINDER
001C6A E9E3 9F               4      SBC A,A
001C6B E9E4 D3DD            11      OUT (0DDH),A    ;SIDE
                                
001C6D E9E6 CD23EA          17      CALL    SETMODE
001C70 E9E9 D8              11      RET C
                                
001C71 E9EA CD5AEA          17      CALL    DRIVE
001C74 E9ED FEFF             7      CP  0FFH        ;A=0FFH Unknown CYLINDER
001C76 E9EF CC3FEA          17      CALL    Z,FDCRES    ;Restore
001C79 E9F2 2F               4      CPL         ;データバスが負論理
001C7A E9F3 D3D9            11      OUT (0D9H),A    ;Currrent CYLINDER
001C7C E9F5 2F               4      CPL         ;データバスが負論理
001C7D E9F6 92               4      SUB D
001C7E E9F7 C8              11      RET Z       ;No seek
                                
001C7F E9F8 3A86F0          13      LD  A,(_ISEEK)
001C82 E9FB 4F               4      LD  C,A
                                
001C83 E9FC DD7E0C          19      LD  A,(IX+00CH) ;DPB_0C_MAXCYL
001C86 E9FF 3D               4      DEC A
001C87 EA00 BA               4      CP  D       ;Over CYLINDER
001C88 EA01 D8              11      RET C
                                
001C89 EA02 7A               4      LD  A,D
001C8A EA03 2F               4      CPL         ;データバスが負論理
001C8B EA04 D3DB            11      OUT (0DBH),A
001C8D EA06 72               7      LD  (HL),D
                                
001C8E EA07 0E18             7      LD  C,018H      ;Seek
       EA09                     FDCCMD2:
001C90 EA09 3A85F0          13      LD  A,(_SEEKSP)
001C93 EA0C E6FF             7  FSPAT:  AND 0FFH
001C95 EA0E B1               4      OR  C
                                
       EA0F                     FDCCMD:
001C96 EA0F CD51EA          17      CALL    COMSET
       EA13                     FDCSMC  EQU $+1
001C99 EA12 3E80             7      LD  A,080H      ;FDC COMMAND(Self-modifying code)
001C9B EA14 E620             7      AND 020H        ;Write data Write track
001C9D EA16 3C               4      INC A
                                
       EA17                     SST:
001C9E EA17 0E00             7      LD  C,0
       EA19                     SST1:
001CA0 EA19 0D               4      DEC C       ; 4
001CA1 EA1A 20FD            12      JR  NZ,SST1     ;12 * 256 / 4 = About 1ms
001CA3 EA1C 3D               4      DEC A
001CA4 EA1D 20FA            12      JR  NZ,SST1
                                
001CA6 EA1F 3C               4      INC A       ;A=1
001CA7 EA20 CD28EA          17      CALL    READY
       EA23                     SETMODE:
001CAA EA23 CD54EA          17      CALL    DELAY0      ;Head select time
001CAD EA26 3E81             7      LD  A,081H
       EA28                     READY:
001CAF EA28 3232EA          13      LD  (WAITA),A
001CB2 EA2B E5              11      PUSH    HL
001CB3 EA2C 26F8             7      LD  H,0F8H
       EA2E                     READY2:
001CB5 EA2E DBD8            11      IN  A,(0D8H)
001CB7 EA30 2F               4      CPL         ;データバスが負論理
       EA32                     WAITA   EQU $+1
001CB8 EA31 E681             7      AND 081H        ;NOT READY,BUSY
001CBA EA33 2808            12      JR  Z,READYE
001CBC EA35 E3              19      EX  (SP),HL     ;wait 19clock
001CBD EA36 E3              19      EX  (SP),HL     ; //
001CBE EA37 2B               6      DEC HL
001CBF EA38 7C               4      LD  A,H
001CC0 EA39 B5               4      OR  L
001CC1 EA3A 20F2            12      JR  NZ,READY2
001CC3 EA3C 37               4      SCF
       EA3D                     READYE:
001CC4 EA3D E1              10      POP HL
001CC5 EA3E C9              10      RET
                                
       EA3F                     FDCRES:
001CC6 EA3F 3600            10      LD  (HL),0
001CC8 EA41 0E08             7      LD  C,8
001CCA EA43 18C4            12      JR  FDCCMD2
                                
       EA45                     FDMOFF:
001CCC EA45 F5              11      PUSH    AF
001CCD EA46 AF               4      XOR A       ;Motor off(ドライブセレクト無効)
001CCE EA47 D3DC            11      OUT (0DCH),A
001CD0 EA49 F1              10      POP AF
001CD1 EA4A C9              10      RET
                                
       EA4B                     SECSET:
001CD2 EA4B F5              11      PUSH    AF
001CD3 EA4C 7B               4      LD  A,E
001CD4 EA4D 2F               4      CPL         ;データバスが負論理
001CD5 EA4E D3DA            11      OUT (0DAH),A
001CD7 EA50 F1              10      POP AF
       EA51                     COMSET:
001CD8 EA51 2F               4      CPL         ;データバスが負論理
001CD9 EA52 D3D8            11      OUT (0D8H),A
       EA54                     DELAY0:
001CDB EA54 3E1A             7      LD  A,26
       EA56                     DELAY:
001CDD EA56 3D               4      DEC A
001CDE EA57 20FD            12      JR  NZ,DELAY
001CE0 EA59 C9              10      RET
                                
       EA5A                     DRIVE:
001CE1 EA5A 2A84F0          16      LD  HL,(_DRIVE)
001CE4 EA5D 26F0             7      LD  H,_CYL0/256
001CE6 EA5F CBFD             8      SET 7,L
001CE8 EA61 7E               7      LD  A,(HL)
001CE9 EA62 C9              10      RET
                                
       EA63                     RNF:
001CEA EA63 CD5AEA          17      CALL    DRIVE
001CED EA66 36FF            10      LD  (HL),0FFH
001CEF EA68 C9              10      RET
                                
001CF0 EA69 02                  RETRY:  DB  2
                                
                                
                                ;   FLOPPY DISK DRIVER
                                
       EA6A                     WTTRK:
001CF1 EA6A 0601             7      LD  B,1
001CF3 EA6C 3EF4             7      LD  A,0F4H
001CF5 EA6E 1802            12      JR  WTTRK1
       EA70                     FDWT:
001CF7 EA70 3EA0             7      LD  A,0A0H
       EA72                     WTTRK1:
001CF9 EA72 3213EA          13      LD  (FDCSMC),A
       EA75                     DWTBL:
001CFC EA75 78               4      LD  A,B
001CFD EA76 32B5EA          13      LD  (WTBSMC),A
001D00 EA79 3E02             7      LD  A,2     ;Retry count
001D02 EA7B 3269EA          13      LD  (RETRY),A
                                
       EA7E                     DWT0:
001D05 EA7E D5              11      PUSH    DE
001D06 EA7F E5              11      PUSH    HL
001D07 EA80 CDC3E9          17      CALL    SEEK        ;Write disk
001D0A EA83 E1              10      POP HL
001D0B EA84 383A            12      JR  C,ERRDW
001D0D EA86 F3               4      DI
001D0E EA87 3A13EA          13      LD  A,(FDCSMC)
001D11 EA8A CD4BEA          17      CALL    SECSET
001D14 EA8D 0EDB             7      LD  C,0DBH
       EA8F                     DWT1:
001D16 EA8F 7E               7      LD  A,(HL)
001D17 EA90 2F               4      CPL         ;データバスが負論理
001D18 EA91 57               4      LD  D,A
                                
       EA92                     DWT2:
001D19 EA92 DBD8            11      IN  A,(0D8H)
001D1B EA94 2F               4      CPL         ;データバスが負論理
001D1C EA95 0F               4      RRCA
001D1D EA96 3008            12      JR  NC,DWT4
001D1F EA98 0F               4      RRCA
001D20 EA99 30F7            12      JR  NC,DWT2
       EA9B                     DWT3:
001D22 EA9B ED51            12      OUT (C),D
001D24 EA9D 23               6      INC HL
001D25 EA9E 18EF            12      JR  DWT1
                                
       EAA0                     DWT4:
001D27 EAA0 3D               4      DEC A
001D28 EAA1 28F8            12      JR  Z,DWT3
001D2A EAA3 3C               4      INC A
001D2B EAA4 FB               4      EI
001D2C EAA5 D1              10      POP DE
001D2D EAA6 13               6      INC DE
001D2E EAA7 CD45EA          17      CALL    FDMOFF
001D31 EAAA 2808            12      JR  Z,DISKOK_WT
001D33 EAAC CD17EB          17      CALL    DISKC
001D36 EAAF 20CD            12      JR  NZ,DWT0
001D38 EAB1 B7               4      OR  A
001D39 EAB2 2005            12      JR  NZ,ERRW
                                
       EAB4                     DISKOK_WT:
       EAB5                     WTBSMC  EQU $+1
001D3B EAB4 0601             7      LD  B,1
001D3D EAB6 10BD            13      DJNZ    DWTBL
001D3F EAB8 C9              10      RET
                                
       EAB9                     ERRW:
001D40 EAB9 3EFF             7      LD  A,0FFH
       EABB                     ERRZ:
001D42 EABB BF               4      CP  A
001D43 EABC 37               4      SCF
001D44 EABD C345EA          10      JP  FDMOFF
                                
       EAC0                     ERRDW:
001D47 EAC0 D1              10      POP DE
001D48 EAC1 CD28EB          17      CALL    DELP
001D4B EAC4 20B8            12      JR  NZ,DWT0
001D4D EAC6 B7               4      OR  A
001D4E EAC7 20F0            12      JR  NZ,ERRW
001D50 EAC9 C9              10      RET
                                
       EACA                     FDRD:
001D51 EACA 3E80             7      LD  A,080H
001D53 EACC 3213EA          13      LD  (FDCSMC),A
       EACF                     DRDBL:
001D56 EACF 78               4      LD  A,B
001D57 EAD0 3209EB          13      LD  (RDBSMC),A
001D5A EAD3 3E02             7      LD  A,2     ;Retry count
001D5C EAD5 3269EA          13      LD  (RETRY),A
       EAD8                     DRD0:
001D5F EAD8 D5              11      PUSH    DE
001D60 EAD9 E5              11      PUSH    HL
001D61 EADA CDC3E9          17      CALL    SEEK        ;Read disk
001D64 EADD E1              10      POP HL
001D65 EADE 382D            12      JR  C,ERRDR
001D67 EAE0 F3               4      DI
001D68 EAE1 3A13EA          13      LD  A,(FDCSMC)
001D6B EAE4 CD4BEA          17      CALL    SECSET
       EAE7                     DRD1:
001D6E EAE7 DBD8            11      IN  A,(0D8H)
001D70 EAE9 2F               4      CPL         ;データバスが負論理
001D71 EAEA 0F               4      RRCA
001D72 EAEB 300A            12      JR  NC,DRD3
001D74 EAED 0F               4      RRCA
001D75 EAEE 30F7            12      JR  NC,DRD1
001D77 EAF0 DBDB            11      IN  A,(0DBH)
001D79 EAF2 2F               4      CPL         ;データバスが負論理
001D7A EAF3 77               7      LD  (HL),A
001D7B EAF4 23               6      INC HL
001D7C EAF5 18F0            12      JR  DRD1
                                
       EAF7                     DRD3:
001D7E EAF7 B7               4      OR  A
001D7F EAF8 FB               4      EI
001D80 EAF9 D1              10      POP DE
001D81 EAFA 13               6      INC DE
001D82 EAFB CD45EA          17      CALL    FDMOFF
001D85 EAFE 2808            12      JR  Z,DISKOK_RD
001D87 EB00 CD17EB          17      CALL    DISKC
001D8A EB03 20D3            12      JR  NZ,DRD0
001D8C EB05 B7               4      OR  A
001D8D EB06 20B1            12      JR  NZ,ERRW
                                
       EB08                     DISKOK_RD:
       EB09                     RDBSMC  EQU $+1
001D8F EB08 0601             7      LD  B,1
001D91 EB0A 10C3            13      DJNZ    DRDBL
001D93 EB0C C9              10      RET
                                
       EB0D                     ERRDR:
001D94 EB0D D1              10      POP DE
001D95 EB0E CD28EB          17      CALL    DELP
001D98 EB11 20C5            12      JR  NZ,DRD0
001D9A EB13 B7               4      OR  A
001D9B EB14 20A3            12      JR  NZ,ERRW
001D9D EB16 C9              10      RET
       EB17                     DISKC:
001D9E EB17 1B               6      DEC DE
001D9F EB18 CB5F             8      BIT 3,A
001DA1 EB1A C463EA          17      CALL    NZ,RNF
       EB1D                     DISKD:
001DA4 EB1D E5              11      PUSH    HL
001DA5 EB1E 2169EA          10      LD  HL,RETRY
001DA8 EB21 35              11      DEC (HL)
001DA9 EB22 E1              10      POP HL
001DAA EB23 200C            12      JR  NZ,ERR      ;Retry
001DAC EB25 B7               4      OR  A
001DAD EB26 2809            12      JR  Z,ERR       ;Error
                                
       EB28                     DELP:
001DAF EB28 CD63EA          17      CALL    RNF
001DB2 EB2B CD45EA          17      CALL    FDMOFF
001DB5 EB2E 3EFF             7      LD  A,0FFH
       EB30                     AERRZ:
001DB7 EB30 BF               4      CP  A
       EB31                     ERR:
001DB8 EB31 3EFF             7      LD  A,0FFH
001DBA EB33 C9              10      RET
                                
       F0B2                     FDMODE  EQU TVRAMTOP
[EOF:M7DISK.ASM:SHIFT_JIS]
                                    INCLUDE "M7DISK2.ASM"
                                
                                ;   LSX-Dodgers DISK2
                                ;   MZ-700/1500
                                
                                ;   EMM DRIVER
                                ;   1セクタ可変(256/512/1024)
                                
       EB34                     EDWT:
001DBB EB34 F5              11      PUSH    AF
001DBC EB35 CD53EB          17      CALL    EADR
001DBF EB38 0600             7      LD  B,0
       EB3A                     EDWT1:
001DC1 EB3A EDB3                    OTIR
001DC3 EB3C 3D               4      DEC A
001DC4 EB3D 20FB            12      JR  NZ,EDWT1
001DC6 EB3F 180B            12      JR  EDRW1
                                
       EB41                     EDRD:
001DC8 EB41 C5              11      PUSH    BC
001DC9 EB42 CD53EB          17      CALL    EADR
001DCC EB45 0600             7      LD  B,0
       EB47                     EDRD1:
001DCE EB47 EDB2                    INIR
001DD0 EB49 3D               4      DEC A
001DD1 EB4A 20FB            12      JR  NZ,EDRD1
       EB4C                     EDRW1:
001DD3 EB4C F1              10      POP AF
001DD4 EB4D 83               4      ADD A,E ;セクタを進める
001DD5 EB4E 5F               4      LD  E,A
001DD6 EB4F 8A               4      ADC A,D
001DD7 EB50 93               4      SUB E
001DD8 EB51 57               4      LD  D,A
001DD9 EB52 C9              10      RET
                                
       EB53                     EADR:
001DDA EB53 C5              11      PUSH    BC
001DDB EB54 D5              11      PUSH    DE
001DDC EB55 EB               4      EX  DE,HL
001DDD EB56 29              11      ADD HL,HL
001DDE EB57 DD4E0D          19      LD  C,(IX+00DH) ;DPB_0D_MAXSEC
001DE1 EB5A DD460C          19      LD  B,(IX+00CH) ;DPB_0C_MAXCYL
001DE4 EB5D 09              11      ADD HL,BC
001DE5 EB5E DD4E13          19      LD  C,(IX+013H) ;DPB_13_UNITNO
001DE8 EB61 ED49            12      OUT (C),C
001DEA EB63 0C               4      INC C
001DEB EB64 ED69            12      OUT (C),L
001DED EB66 0C               4      INC C
001DEE EB67 ED61            12      OUT (C),H
001DF0 EB69 0C               4      INC C
001DF1 EB6A EB               4      EX  DE,HL
001DF2 EB6B D1              10      POP DE
001DF3 EB6C DD460F          19      LD  B,(IX+00FH) ;DPB_0F_BPS
001DF6 EB6F F1              10      POP AF
       EB70                     EADR1:              ;読み込むセクタ数と1クラスタのセクタ数を掛ける
001DF7 EB70 CB18             8      RR  B
001DF9 EB72 D8              11      RET C
001DFA EB73 87               4      ADD A,A
001DFB EB74 18FA            12      JR  EADR1
                                
                                ;   CMOS BACKUP MEMORY DRIVER(32KB)
                                ;   1セクタ256
                                
       EB76                     CDWT:
001DFD EB76 78               4      LD  A,B
001DFE EB77 DD4E13          19      LD  C,(IX+013H) ;DPB_13_UNITNO
001E01 EB7A ED40            12      IN  B,(C)       ;アドレスカウンタを0000にリセット
001E03 EB7C ED59            12      OUT (C),E       ;W)アドレスカウンタ上位
001E05 EB7E 01FA00          10      LD  BC,000FAH
       EB81                     CDWT1:
001E08 EB81 EDB3                    OTIR            ;W)データ書き込み・アドレスカウンタ+1
001E0A EB83 13               6      INC DE
001E0B EB84 3D               4      DEC A
001E0C EB85 20FA            12      JR  NZ,CDWT1
001E0E EB87 A7               4      AND A
001E0F EB88 C9              10      RET
                                
       EB89                     CDRD:
001E10 EB89 78               4      LD  A,B
001E11 EB8A DD4E13          19      LD  C,(IX+013H) ;DPB_13_UNITNO
001E14 EB8D ED40            12      IN  B,(C)       ;アドレスカウンタを0000にリセット
001E16 EB8F ED59            12      OUT (C),E       ;W)アドレスカウンタ上位
001E18 EB91 01F900          10      LD  BC,000F9H
       EB94                     CDRD1:
001E1B EB94 EDB2                    INIR            ;R)データ読み出し・アドレスカウンタ+1
001E1D EB96 13               6      INC DE
001E1E EB97 3D               4      DEC A
001E1F EB98 20FA            12      JR  NZ,CDRD1
001E21 EB9A A7               4      AND A
001E22 EB9B C9              10      RET
                                
                                ;   RAM DISK DRIVER (64KB)
                                ;   1セクタ256
                                
       EB9C                     RDWT:
001E23 EB9C 3EB3             7      LD  A,0B3H      ;OTIR
001E25 EB9E 1802            12      JR  RDRW
       EBA0                     RDRD:
001E27 EBA0 3EB2             7      LD  A,0B2H      ;INIR
       EBA2                     RDRW:
001E29 EBA2 32AFEB          13      LD  (RDRW1+1),A
                                
001E2C EBA5 78               4      LD  A,B
001E2D EBA6 43               4      LD  B,E     ;B=アドレスカウンタ上位(X1の様な16bitのI/Oアクセス)
001E2E EBA7 0EEB             7      LD  C,0EBH
001E30 EBA9 ED71            12      OUT (C),0       ;0=アドレスカウンタ下位
001E32 EBAB 0D               4      DEC C       ;EA(R)データ読み出し・アドレスカウンタ+1
001E33 EBAC 0600             7      LD  B,0
       EBAE                     RDRW1:
001E35 EBAE EDB2                    INIR            ;自己書き換え(INIR/OTIR)
001E37 EBB0 13               6      INC DE
001E38 EBB1 3D               4      DEC A
001E39 EBB2 20FA            12      JR  NZ,RDRW1
001E3B EBB4 A7               4      AND A
001E3C EBB5 C9              10      RET
[EOF:M7DISK2.ASM:UTF_8]
                                    INCLUDE "LDCCPWK.ASM"
                                
                                ;   LSX-Dodgers CCP WORK
                                
       0040                     PATHX   EQU 64
001E3D EBB6                     PATHD:  DS  PATHX
001E7D EBF6 00                  PATHE:  DB  0
                                
       EBF7                     DTA_CCP:
001E7E EBF7                         DS  37
                                
       EC1C                     FCB_BAT:
001EA3 EC1C                         DS  37
                                
                                
001EC8 EC41 2062797465732066    FREE:   DB  " bytes free",9,'$'
            7265650924          
[EOF:LDCCPWK.ASM:UTF_8]
                                    INCLUDE "M7TABLE.ASM"
                                
                                ;   LSX-Dodgers TABLE 表示関連のテーブル
                                ;   MZ-700/1500
                                
       EC4E                     AT_TABLE:
001ED5 EC4E                         DS  TABLEAD-AT_TABLE
                                
       ED40                     KEY_TABLE:
001FC7 ED40 12081E1F1C1D5C2F        DB  12H,08H,1EH,1FH,1CH,1DH,5CH,'/'
001FCF ED48 5C5E2D2030392C2E        DB  5CH,'^','-',20H,'0','9',',','.'
001FD7 ED50 3132333435363738        DB  '1','2','3','4','5','6','7','8'
001FDF ED58 6162636465666768        DB  'a','b','c','d','e','f','g','h'
001FE7 ED60 696A6B6C6D6E6F70        DB  'i','j','k','l','m','n','o','p'
001FEF ED68 7172737475767778        DB  'q','r','s','t','u','v','w','x'
001FF7 ED70 797A405B5D000000        DB  'y','z','@','[',']',00H,00H,00H
001FFF ED78 001B3D09003B3A0D        DB  00H,1BH,'=',09H,00H,';',':',0DH
       ED80                     SHIFT_TABLE:
002007 ED80 12081E1F1C1D5F3F        DB  12H,08H,1EH,1FH,1CH,1DH,'_','?'
00200F ED88 7C7E3D2030293C3E        DB  '|','~','=',20H,'0',')','<','>'
002017 ED90 2122232425262728        DB  '!','"','#','$','%','&',27H,'('
00201F ED98 4142434445464748        DB  'A','B','C','D','E','F','G','H'
002027 EDA0 494A4B4C4D4E4F50        DB  'I','J','K','L','M','N','O','P'
00202F EDA8 5152535455565758        DB  'Q','R','S','T','U','V','W','X'
002037 EDB0 595A607B7D000000        DB  'Y','Z','`','{','}',00H,00H,00H
00203F EDB8 00003D09002B2A0D        DB  00H,00H,'=',09H,00H,'+','*',0DH
       EDC0                     CTRL_TABLE:
002047 EDC0 12081E1F1C1D3F2F        DB  12H,08H,1EH,1FH,1CH,1DH,'?','/'
00204F EDC8 2A2B2D2030392C2E        DB  '*','+','-',20H,'0','9',',','.'
002057 EDD0 3132333435363738        DB  '1','2','3','4','5','6','7','8'
00205F EDD8 0102030405060708        DB  01H,02H,03H,04H,05H,06H,07H,08H
002067 EDE0 090A0B0C0D0E0F10        DB  09H,0AH,0BH,0CH,0DH,0EH,0FH,10H
00206F EDE8 1112131415161718        DB  11H,12H,13H,14H,15H,16H,17H,18H
002077 EDF0 191A1B5B5D000000        DB  19H,1AH,1BH,'[',']',00H,00H,00H
00207F EDF8 00003D09003B3A0D        DB  00H,00H,'=',09H,00H,';',':',0DH
                                
                                ;   アドレス下位1バイトが0になるように
       EE00                     CD_TABLE:
002087 EE00 00D1D2D3D4D5D6D0        DB  $00,$D1,$D2,$D3,$D4,$D5,$D6,$D0 ;月火水木金土日
00208F EE08 D8DCD9DADBD7CFCE        DB  $D8,$DC,$D9,$DA,$DB,$D7,$CF,$CE ;年円時分秒
002097 EE10 601F5F5E1E1B7978        DB  $60,$1F,$5F,$5E,$1E,$1B,$79,$78 ;
00209F EE18 5C5D1C1D6DCACDC7        DB  $5C,$5D,$1C,$1D,$6D,$CA,$CD,$C7 ;
0020A7 EE20 0061626364656667        DB  $00,$61,$62,$63,$64,$65,$66,$67 ; !"#$%&'
0020AF EE28 68696B6A2F2A2E2D        DB  $68,$69,$6B,$6A,$2F,$2A,$2E,$2D ;()*+,-./
0020B7 EE30 2021222324252627        DB  $20,$21,$22,$23,$24,$25,$26,$27 ;01234567
0020BF EE38 28294F2C512B5749        DB  $28,$29,$4F,$2C,$51,$2B,$57,$49 ;89:;<=>?
0020C7 EE40 5501020304050607        DB  $55,$01,$02,$03,$04,$05,$06,$07 ;@ABCDEFG
0020CF EE48 08090A0B0C0D0E0F        DB  $08,$09,$0A,$0B,$0C,$0D,$0E,$0F ;HIJKLMNO
0020D7 EE50 1011121314151617        DB  $10,$11,$12,$13,$14,$15,$16,$17 ;PQRSTUVW
0020DF EE58 18191A52DD54507C        DB  $18,$19,$1A,$52,$DD,$54,$50,$7C ;XYZ[\]^_
0020E7 EE60 5901020304050607        DB  $59,$01,$02,$03,$04,$05,$06,$07 ;`abcdefg   ATB:1
0020EF EE68 08090A0B0C0D0E0F        DB  $08,$09,$0A,$0B,$0C,$0D,$0E,$0F ;hijklmno   ATB:1
0020F7 EE70 1011121314151617        DB  $10,$11,$12,$13,$14,$15,$16,$17 ;pqrstuvw   ATB:1
0020FF EE78 18191ACB35CC705A        DB  $18,$19,$1A,$CB,$35,$CC,$70,$5A ;xyz{|}~    ATB:1
002107 EE80 415346444847B49E        DB  $41,$53,$46,$44,$48,$47,$B4,$9E ;トランプ〇●をぁ   ATB:1
00210F EE88 B2B6BABE9FB3B7BB        DB  $B2,$B6,$BA,$BE,$9F,$B3,$B7,$BB ;ぃぅぇぉゃゅょっ   ATB:1
002117 EE90 BFA385A4A5A69487        DB  $BF,$A3,$85,$A4,$A5,$A6,$94,$87 ;ーあいうえおかき   ATB:1
00211F EE98 889C829884929083        DB  $88,$9C,$82,$98,$84,$92,$90,$83 ;くけこさしすせそ   ATB:1
002127 EEA0 F0BD9DB1B5B9B49E        DB  $F0,$BD,$9D,$B1,$B5,$B9,$B4,$9E ;　。「」、・ヲァ
00212F EEA8 B2B6BABE9FB3B7BB        DB  $B2,$B6,$BA,$BE,$9F,$B3,$B7,$BB ;ィゥェォャョュッ
002137 EEB0 BFA385A4A5A69487        DB  $BF,$A3,$85,$A4,$A5,$A6,$94,$87 ;ーアイウエオカキ
00213F EEB8 889C829884929083        DB  $88,$9C,$82,$98,$84,$92,$90,$83 ;クケコサシスセソ
002147 EEC0 91819A97939589A1        DB  $91,$81,$9A,$97,$93,$95,$89,$A1 ;タチツテトナニヌ
00214F EEC8 AF8B8696A2ABAA8A        DB  $AF,$8B,$86,$96,$A2,$AB,$AA,$8A ;ネノハヒフヘホマ
002157 EED0 8EB0AD8DA7A8A98F        DB  $8E,$B0,$AD,$8D,$A7,$A8,$A9,$8F ;ミムメモヤユヨラ
00215F EED8 8CAEAC9BA099BCB8        DB  $8C,$AE,$AC,$9B,$A0,$99,$BC,$B8 ;リルレロワン゛゜
002167 EEE0 91819A97939589A1        DB  $91,$81,$9A,$97,$93,$95,$89,$A1 ;たちつてとねにぬ   ATB:1
00216F EEE8 AF8B8696A2ABAA8A        DB  $AF,$8B,$86,$96,$A2,$AB,$AA,$8A ;ねのはひふへほま   ATB:1
002177 EEF0 8EB0AD8DA7A8A98F        DB  $8E,$B0,$AD,$8D,$A7,$A8,$A9,$8F ;みむめもやゆよら   ATB:1
00217F EEF8 8CAEAC9BA099BCB8        DB  $8C,$AE,$AC,$9B,$A0,$99,$BC,$B8 ;りるれろわん゛゜   ATB:1
       EF00                     DC_TABLE:
002187 EF00 2041424344454647        DB  $20,$41,$42,$43,$44,$45,$46,$47 ;0
00218F EF08 48494A4B4C4D4E4F        DB  $48,$49,$4A,$4B,$4C,$4D,$4E,$4F
002197 EF10 5051525354555657        DB  $50,$51,$52,$53,$54,$55,$56,$57 ;1
00219F EF18 58595A151A1B1411        DB  $58,$59,$5A,$15,$1A,$1B,$14,$11
0021A7 EF20 3031323334353637        DB  $30,$31,$32,$33,$34,$35,$36,$37 ;2
0021AF EF28 38392D3D3B2F2E2C        DB  $38,$39,$2D,$3D,$3B,$2F,$2E,$2C
0021B7 EF30 00000000007C0000        DB  $00,$00,$00,$00,$00,$7C,$00,$00 ;3
0021BF EF38 0000000000000000        DB  $00,$00,$00,$00,$00,$00,$00,$00
0021C7 EF40 0080000083008285        DB  $00,$80,$00,$00,$83,$00,$82,$85 ;4
0021CF EF48 843F00000000003A        DB  $84,$3F,$00,$00,$00,$00,$00,$3A
0021D7 EF50 5E3C5B815D40003E        DB  $5E,$3C,$5B,$81,$5D,$40,$00,$3E ;5
0021DF EF58 00607F0018191312        DB  $00,$60,$7F,$00,$18,$19,$13,$12
0021E7 EF60 1021222324252627        DB  $10,$21,$22,$23,$24,$25,$26,$27 ;6
0021EF EF68 28292B2A001C0000        DB  $28,$29,$2B,$2A,$00,$1C,$00,$00
0021F7 EF70 7E00000000000000        DB  $7E,$00,$00,$00,$00,$00,$00,$00 ;7
0021FF EF78 171600005F000000        DB  $17,$16,$00,$00,$5F,$00,$00,$00
002207 EF80 00C19A9F9C92CA97        DB  $00,$C1,$9A,$9F,$9C,$92,$CA,$97 ;8
00220F EF88 98C6CFC9D8D3D0D7        DB  $98,$C6,$CF,$C9,$D8,$D3,$D0,$D7
002217 EF90 9EC09DC496C5CBC3        DB  $9E,$C0,$9D,$C4,$96,$C5,$CB,$C3 ;9
00221F EF98 9BDDC2DB99A2878C        DB  $9B,$DD,$C2,$DB,$99,$A2,$87,$8C
002227 EFA0 DCC7CC91939495D4        DB  $DC,$C7,$CC,$91,$93,$94,$95,$D4 ;A
00222F EFA8 D5D6CECDDAD2D9C8        DB  $D5,$D6,$CE,$CD,$DA,$D2,$D9,$C8
002237 EFB0 D1A3888D86A4898E        DB  $D1,$A3,$88,$8D,$86,$A4,$89,$8E ;B
00223F EFB8 DFA58A8FDEA18B90        DB  $DF,$A5,$8A,$8F,$DE,$A1,$8B,$90
002247 EFC0 000000000000001F        DB  $00,$00,$00,$00,$00,$00,$00,$1F ;C
00224F EFC8 00001D7B7D1E0F0E        DB  $00,$00,$1D,$7B,$7D,$1E,$0F,$0E
002257 EFD0 070102030405060D        DB  $07,$01,$02,$03,$04,$05,$06,$0D ;D
00225F EFD8 080A0B0C095C0000        DB  $08,$0A,$0B,$0C,$09,$5C,$00,$00
002267 EFE0 0000000000000000        DB  $00,$00,$00,$00,$00,$00,$00,$00 ;E
00226F EFE8 0000000000000000        DB  $00,$00,$00,$00,$00,$00,$00,$00
002277 EFF0 A000000000000000        DB  $A0,$00,$00,$00,$00,$00,$00,$00 ;F
00227F EFF8 0000000000000000        DB  $00,$00,$00,$00,$00,$00,$00,$00
[EOF:M7TABLE.ASM:SHIFT_JIS]
                                    INCLUDE "LDWORK.ASM"
                                
                                ;   LSX-Dodgers WORK0
                                ;
                                ;   CP/M互換BIOS
                                ;   BOOT:アドレス下位1バイトが0になるように
       F000                     AT_WORK:
002287 F000                         DS  WORKAD-AT_WORK
                                
       F000                     CPM_BOOT:
002287 F000 C30000          10      JP  0
       F003                     _SYS00:     ;(BDOS)プログラム終了
       F003                     CPM_WBOOT:
00228A F003 C3FECF          10      JP  WBOOT1
       F006                     CPM_CONST:
00228D F006 C3BDD8          10      JP  CONSTX
       F009                     _SYS07:     ;(BDOS)コンソール直接入力
       F009                     CPM_CONIN:
002290 F009 C353D8          10      JP  FLGET
       F00C                     CPM_CONOUT:
002293 F00C C362DA          10      JP  CONOUT1
                                
       F00F                     DECBF:
002296 F00F                         DS  5
00229B F014 00                  FDRV    DB  0
00229C F015                     FNAME   DS  36
0022C0 F039                     SFILE:  DS  33      ;DRV FILENAME
0022E1 F05A                     HLBUF:  DS  3       ;Random record buffer
                                
0022E4 F05D 0000                LEFTX:  DW  0
0022E6 F05F 0000                DTAX:   DW  0
                                
       F061                     ZERO:
       F061                     BEEPD:
0022E8 F061 008E01000B000C10        DB  0,08EH,1,0,00BH,0,00CH,010H
0022F0 F069 073E08100D00FF          DB  007H,03EH,008H,010H,00DH,0,0FFH
       F062                     RTC_YY  EQU BEEPD+1
       F063                     RTC_MW  EQU BEEPD+2
       F064                     RTC_DD  EQU BEEPD+3
       F065                     RTC_TT  EQU BEEPD+4
       F066                     RTC_MM  EQU BEEPD+5
       F067                     RTC_SS  EQU BEEPD+6
                                
0022F7 F070 00                  CHECK:  DB  0
                                
0022F8 F071 4F4B24              OK: DB  "OK$"
0022FB F074                         DS  5
002300 F079 4572726F722124      COMERM: DB  "Error!$"
                                ;   システムワークエリア
                                ;   _CYL0:アドレス下位1バイトが080Hになるように
002307 F080 FF                  _CYL0:  DB  0FFH    ;Cylinder
002308 F081 FF                  _CYL1:  DB  0FFH    ;Cylinder
002309 F082 FF                  _CYL2:  DB  0FFH    ;Cylinder
00230A F083 FF                  _CYL3:  DB  0FFH    ;Cylinder
00230B F084 00                  _DRIVE: DB  0   ;unit number
00230C F085 00                  _SEEKSP:DB  0   ;Seek speed
00230D F086 FF                  _ISEEK: DB  0FFH    ;
00230E F087 00                  _DVSW:  DB  0
00230F F088 00                  _DRV:   DB  0
002310 F089 FF                  _DSK:   DB  0FFH
002311 F08A 8000                _DTA:   DW  00080H
002313 F08C 0000                _CTC:   DW  0
002315 F08E 0000                _TXADR: DW  0
002317 F090 0000                _KEYPS: DW  0
002319 F092 00FF                _KEYD:  DW  0FF00H  ;キーデータ
00231B F094 8310                _KEYSP: DB  KEYSP_L,KEYSP_H ;オートリピートの速度
00231D F096 71                  _COLORF:DB  COLORF  ;色
00231E F097 19                  _LINE:  DB  LINE
                                
00231F F098 0000                _FCB:   DW  0   ;SEARCH FILES
002321 F09A 0000                _FBPS:  DW  0   ;    //
002323 F09C 0000                _FBAD:  DW  0   ;    //
002325 F09E 00                  _FBCNT: DB  0   ;    //
002326 F09F 00                  _FILEN: DB  0   ;    //
002327 F0A0 00                  _DIRF:  DB  0   ;bit7:ディレクトリ bit0-6:セクタインデックス
002328 F0A1                         DS  1
002329 F0A2 00                  _WTFATF:DB  0   ;FATバッファの更新フラグ
00232A F0A3                         DS  1
00232B F0A4 00                  _WTDBF: DB  0   ;データバッファの更新フラグ
00232C F0A5 FF                  _DBDRV: DB  0FFH    ;データバッファにあるデータを読み込んだドライブ
00232D F0A6 0000                _DBSEC: DW  0   ;データバッファにあるデータを読み込んだセクタ番号
00232F F0A8 0000                _DPB:   DW  0
       F0AA                     _FATDRV:
002331 F0AA FF                      DB  0FFH    ;FATバッファに読み込んでいるドライブ
002332 F0AB 00                  _FATIX: DB  0   ;FATバッファに読み込んでいるインデックス
       F0AC                     _FAKEFREE:
002333 F0AC 0000                    DW  0   ;偽の残量（FATサイズが大きくなると重くなるのでその対策）
                                
002335 F0AE                         DS  2
                                
       F0B0                     CRTCD:
002337 F0B0 6F                      DB  06FH
       F0B1                     _WIDTH:
002338 F0B1 28                      DB  WIDTH
       F0B2                     TVRAMTOP:
002339 F0B2 5938                    DB  059H,038H
00233B F0B4 1F02                    DB  01FH,002H
       F0B6                     _LINE2:
00233D F0B6 19                      DB  019H
       F0B7                     WKE4:
00233E F0B7 1C                      DB  01CH
       F0B8                     WKE6:
00233F F0B8 00                      DB  000H
       F0B9                     WK40:
002340 F0B9 07                      DB  007H
       F0BA                     _PAGE_MINUS:
002341 F0BA 18FC                    DW  0-WIDTH*LINE
       F0BC                     _WIDTH_MINUS:
002343 F0BC D8FF                    DW  0-WIDTH
       F0BE                     WK30:
002345 F0BE 0C                      DB  00CH
       F0BF                     WK31:
       F0BF                     WK1FD0:
002346 F0BF 20                      DB  020H
                                
002347 F0C0 0000                CTC0:   DW  INTCTCE
002349 F0C2 0000                CTC1:   DW  INTCTCE
00234B F0C4 0000                CTC2:   DW  INTCTC2
00234D F0C6 0000                CTC3:   DW  INTCTCE
00234F F0C8 0000                INTVEC: DW  INT
                                
                                ;   LSX-Dodgers 独自BIOS
                                
002351 F0CA C39BDB          10  _INKEY: JP  INKEY
002354 F0CD C34ED9          10  _PRINT: JP  PRINT
002357 F0D0 C3F6DB          10  _SCRN:  JP  SCRN
00235A F0D3 C30BDB          10  _POS:   JP  POS
00235D F0D6 C330DA          10  _LOC:   JP  LOC
       F0D9                     _CHGDRV:
002360 F0D9 C3BFE8          10      JP  CHGDRV
       F0DC                     _GETDPB:
002363 F0DC C38AE9          10      JP  GETDPB
       F0DF                     _FFLUSH:
002366 F0DF C3A8E9          10      JP  FFLUSH
       F0E2                     _RDFATX:
002369 F0E2 C398E5          10      JP  RDFATX
00236C F0E5 C3C0E6          10  _RDFAT: JP  RDFAT
00236F F0E8 C36AEA          10  _WTTRK: JP  WTTRK
002372 F0EB C3CAEA          10  _FDRD:  JP  FDRD
002375 F0EE C370EA          10  _FDWT:  JP  FDWT
       F0F1                     _BPB2DPB:
002378 F0F1 C34DE7          10      JP  BPB2DPB
       F0F4                     _BREAK:
00237B F0F4 C393D1          10      JP  END_BATCH
       F0F7                     _GNCL:
00237E F0F7 C33AE6          10  GNCPAT: JP  GNCL        ; self-modifying code
       F0FA                     _SNCL:
002381 F0FA C35DE6          10  SNCPAT: JP  SNCL        ; self-modifying code
002384 F0FD C34DD0          10  _COMANL:JP  COMANL
                                
       F100                     _WE:
[EOF:LDWORK.ASM:SHIFT_JIS]
                                    INCLUDE "LDCALL.ASM"
                                
                                ;   LSX-Dodgers システムコール(BDOS)
                                ;
                                ;   LSX-Dodgers SYSTEM CALL
                                ;   STABLE:アドレス下位1バイトが0になるように
                                
       F100                     STABLE:
                                ;0
002387 F100 03F026D832D8CBDD        DW  _SYS00,_SYS01,_SYS02,_SYS03
00238F F108 40D540D537D809F0        DW  _SYS04,_SYS05,_SYS06,_SYS07
002397 F110 3FD842D589D8B5D8        DW  _SYS08,_SYS09,_SYS0A,_SYS0B
00239F F118 57D55CD56BD57CD5        DW  _SYS0C,_SYS0D,_SYS0E,_SYS0F
                                ;1
0023A7 F120 D0D517D660D696D6        DW  _SYS10,_SYS11,_SYS12,_SYS13
0023AF F128 9ED6B4D6C9D6C1D6        DW  _SYS14,_SYS15,_SYS16,_SYS17
0023B7 F130 10D715D71AD720D7        DW  _SYS18,_SYS19,_SYS1A,_SYS1B
0023BF F138 40D546D740D54AD7        DW  _SYS1C,_SYS1D,_SYS1E,_SYS1F
                                ;2
0023C7 F140 40D500D708D751D7        DW  _SYS20,_SYS21,_SYS22,_SYS23
0023CF F148 77D740D553E238E3        DW  _SYS24,_ERROR,_SYS26,_SYS27
0023D7 F150 08D780D7CBD8CBDD        DW  _SYS28,_SYS5C,_SYS2A,_SYS2B
0023DF F158 D1D8CBDD40D5A3D7        DW  _SYS2C,_SYS2D,_SYS2E,_SYS2F
                                ;3
0023E7 F160 9DD740D540D540D5        DW  _SYS30,_ERROR,_ERROR,_ERROR
0023EF F168 40D540D540D540D5        DW  _ERROR,_ERROR,_ERROR,_ERROR
0023F7 F170 40D5CBDDCBDDC4D7        DW  _ERROR,_SYS39,_SYS3A,_SYS5A
                                ;DOS2
0023FF F178 23D5                    DW  _DOS2
                                
002401 F17A                         DS  2
002403 F17C 00F3                _FATBF: DW  FATBF
002405 F17E 00FB                _DTBUF: DW  DTBUF
                                
                                ;   コントロールコードテーブル
                                ;   CTRLTB:アドレス下位1バイトが080Hになるように
                                
       F180                     CTRLTB:
002407 F180 B3D9B3D9E9D9DEDA        DW  CTRL00,CTRL00,CTRL02,CTRL03 ;  A,B,C
00240F F188 D8DA15DAC9DA72DA        DW  CTRL04,CTRL05,CTRL06,CTRL07 ;D,E,F,G
002417 F190 BFD9DAD9E1DA43DA        DW  CTRL08,CTRL09,CTRL0A,CTRL0B ;H,I,J,K
00241F F198 C6DA2BDAF3DAB3D9        DW  CTRL0C,CTRL0D,CTRL0E,CTRL00 ;L,M,N,O
002427 F1A0 B3D9B3D93BDAB3D9        DW  CTRL00,CTRL00,CTRL12,CTRL00 ;P,Q,R,S
00242F F1A8 B3D9B3D9B3D9B3D9        DW  CTRL00,CTRL00,CTRL00,CTRL00 ;T,U,V,W
002437 F1B0 B3D9B3D9C6DA4ADA        DW  CTRL00,CTRL00,CTRL0C,CTRL1B ;X,Y,Z,ESC
00243F F1B8 A2D9C6D9CFD9E1DA        DW  CTRL1C,CTRL1D,CTRL1E,CTRL1F ;→,←,↑,↓
                                
002447 F1C0 0200                M2D:    DW  2
002449 F1C2 FD02                    DB  0FDH,2
00244B F1C4 6401                    DW  356
00244D F1C6 FF0728090182            DB  0FFH,7,40,9,1,082H
002453 F1CC 0500A7000800            DW  5,0A7H,8
                                
002459 F1D2 0200                M2HD:   DW  2
00245B F1D4 FE01                    DB  0FEH,1
00245D F1D6 C704                    DW  1223
00245F F1D8 FE064D080184            DB  0FEH,6,77,8,1,084H
002465 F1DE 0500A7000900            DW  5,0A7H,9
                                
00246B F1E4                         DS  6
                                
002471 F1EA 1617                SDDATA: DB  22,23       ;(FCB)ファイルを最後に変更した時刻
002473 F1EC 1415                    DB  20,21       ;(FCB)ファイルを最後に変更した日付
002475 F1EE 1A1B                    DB  26,27       ;(FCB)ファイルの先頭クラスタ
002477 F1F0 10111213                DB  16,17,18,19 ;(FCB)ファイルのサイズ(バイト単位)
       F1F4                     SDDATAE:
                                
00247B F1F4                     SCDIR:  DS  2       ;+14 +15
00247D F1F6                     SFBPS:  DS  2       ;FBPS
00247F F1F8                     SFNDF:  DS  2       ;FILEN DIRF
                                
002481 F1FA 0000                _FATPS: DW  0
002483 F1FC 0000                _DIRPS: DW  0
002485 F1FE 0000                _CLPS:  DW  0
                                
       F200                     _PE:
[EOF:LDCALL.ASM:SHIFT_JIS]
                                    INCLUDE "M7DPB.ASM"
                                
                                ;   LSX-Dodgers DPB
                                ;   MZ-700/1500
                                
       F200                     DEVICE:
                                
                                ;   A:
                                
002487 F200 0200                    DW  2   ;DPB_00_FATLN
002489 F202 EBF0                    DW  _FDRD   ;DPB_02_DRD
00248B F204 EEF0                    DW  _FDWT   ;DPB_04_DWT
00248D F206 FD                      DB  0FDH    ;DPB_06_FATID
00248E F207 02                      DB  2   ;DPB_07_SECPCL
00248F F208 6401                    DW  356 ;DPB_08_MAXCL
002491 F20A FF                      DB  0FFH    ;DPB_0A_FDMODE  0FFH=2D / 0FEH=2HD
002492 F20B 07                      DB  7   ;DPB_0B_DIRSCNT
002493 F20C 28                      DB  40  ;DPB_0C_MAXCYL
002494 F20D 09                      DB  9   ;DPB_0D_MAXSEC  Number of sectors
002495 F20E 01                      DB  1   ;DPB_0E_FATPS
002496 F20F 82                      DB  082H    ;DPB_0F_BPS
002497 F210 0500                    DW  5   ;DPB_10_DIRPS
002499 F212 27                      DB  027H    ;DPB_12_DEVICE  Device Number
00249A F213 00                      DB  0   ;DPB_13_UNITNO
00249B F214 0800                    DW  8   ;DPB_14_ADDCL16
00249D F216 0000                    DW  0   ;DPB_16
00249F F218 0000                    DW  0   ;DPB_18
0024A1 F21A 0000                    DW  0   ;DPB_1A_SDIR
0024A3 F21C 46444430                DB  "FDD0"  ;DPB_1C_NAME
                                
                                ;   B:
                                
0024A7 F220 0200                    DW  2   ;DPB_00_FATLN
0024A9 F222 EBF0                    DW  _FDRD   ;DPB_02_DRD
0024AB F224 EEF0                    DW  _FDWT   ;DPB_04_DWT
0024AD F226 FD                      DB  0FDH    ;DPB_06_FATID
0024AE F227 02                      DB  2   ;DPB_07_SECPCL
0024AF F228 6401                    DW  356 ;DPB_08_MAXCL
0024B1 F22A FF                      DB  0FFH    ;DPB_0A_FDMODE  0FFH=2D / 0FEH=2HD
0024B2 F22B 07                      DB  7   ;DPB_0B_DIRSCNT
0024B3 F22C 28                      DB  40  ;DPB_0C_MAXCYL
0024B4 F22D 09                      DB  9   ;DPB_0D_MAXSEC  Number of sectors
0024B5 F22E 01                      DB  1   ;DPB_0E_FATPS
0024B6 F22F 82                      DB  082H    ;DPB_0F_BPS
0024B7 F230 0500                    DW  5   ;DPB_10_DIRPS
0024B9 F232 27                      DB  027H    ;DPB_12_DEVICE  Device Number
0024BA F233 01                      DB  1   ;DPB_13_UNITNO
0024BB F234 0800                    DW  8   ;DPB_14_ADDCL16
0024BD F236 0000                    DW  0   ;DPB_16
0024BF F238 0000                    DW  0   ;DPB_18
0024C1 F23A 0000                    DW  0   ;DPB_1A_SDIR
0024C3 F23C 46444431                DB  "FDD1"  ;DPB_1C_NAME
                                
                                ;   C:
                                
0024C7 F240 0100                    DW  1   ;DPB_00_FATLN
0024C9 F242 89EB                    DW  CDRD    ;DPB_02_DRD
0024CB F244 76EB                    DW  CDWT    ;DPB_04_DWT
0024CD F246 FA                      DB  0FAH    ;DPB_06_FATID
0024CE F247 01                      DB  1   ;DPB_07_SECPCL
0024CF F248 7A00                    DW  122 ;DPB_08_MAXCL
0024D1 F24A 00                      DB  0   ;DPB_0A_FDMODE
0024D2 F24B 06                      DB  6   ;DPB_0B_DIRSCNT
0024D3 F24C 00                      DB  0   ;DPB_0C_MAXCYL
0024D4 F24D 00                      DB  0   ;DPB_0D_MAXSEC
0024D5 F24E 01                      DB  1   ;DPB_0E_FATPS
0024D6 F24F 01                      DB  1   ;DPB_0F_BPS
0024D7 F250 0200                    DW  2   ;DPB_10_DIRPS
0024D9 F252 0C                      DB  00CH    ;DPB_12_DEVICE
0024DA F253 F8                      DB  0F8H    ;DPB_13_UNITNO
0024DB F254 0600                    DW  6   ;DPB_14_ADDCL16
0024DD F256 0000                    DW  0   ;DPB_16
0024DF F258 0000                    DW  0   ;DPB_18
0024E1 F25A 0000                    DW  0   ;DPB_1A_SDIR
0024E3 F25C 434D4F53                DB  "CMOS"  ;DPB_1C_NAME
                                
                                ;   D:
                                
0024E7 F260                         DS  32
                                
                                ;   E:
                                
002507 F280 0000                    DW  0   ;DPB_00_FATLN
002509 F282 41EB                    DW  EDRD    ;DPB_02_DRD
00250B F284 34EB                    DW  EDWT    ;DPB_04_DWT
00250D F286 FA                      DB  0FAH    ;DPB_06_FATID
00250E F287 02                      DB  2   ;DPB_07_SECPCL
00250F F288 0000                    DW  0   ;DPB_08_MAXCL
002511 F28A 00                      DB  0   ;DPB_0A_FDMODE
002512 F28B 10                      DB  16  ;DPB_0B_DIRSCNT
002513 F28C 00                      DB  0   ;DPB_0C_MAXCYL
002514 F28D 00                      DB  0   ;DPB_0D_MAXSEC
002515 F28E 01                      DB  1   ;DPB_0E_FATPS
002516 F28F 01                      DB  1   ;DPB_0F_BPS
002517 F290 0000                    DW  0   ;DPB_10_DIRPS
002519 F292 26                      DB  026H    ;DPB_12_DEVICE
00251A F293 00                      DB  0   ;DPB_13_UNITNO
00251B F294 0000                    DW  0   ;DPB_14_ADDCL16
00251D F296 0000                    DW  0   ;DPB_16
00251F F298 0000                    DW  0   ;DPB_18
002521 F29A 0000                    DW  0   ;DPB_1A_SDIR
002523 F29C 454D4D30                DB  "EMM0"  ;DPB_1C_NAME
                                
                                ;   F:
                                
002527 F2A0 0200                    DW  2   ;DPB_00_FATLN
002529 F2A2 A0EB                    DW  RDRD    ;DPB_02_DRD
00252B F2A4 9CEB                    DW  RDWT    ;DPB_04_DWT
00252D F2A6 FA                      DB  0FAH    ;DPB_06_FATID
00252E F2A7 01                      DB  1   ;DPB_07_SECPCL
00252F F2A8 F600                    DW  246 ;DPB_08_MAXCL
002531 F2AA 00                      DB  0   ;DPB_0A_FDMODE
002532 F2AB 09                      DB  9   ;DPB_0B_DIRSCNT
002533 F2AC 00                      DB  0   ;DPB_0C_MAXCYL
002534 F2AD 00                      DB  0   ;DPB_0D_MAXSEC
002535 F2AE 01                      DB  1   ;DPB_0E_FATPS
002536 F2AF 01                      DB  1   ;DPB_0F_BPS
002537 F2B0 0300                    DW  3   ;DPB_10_DIRPS
002539 F2B2 0F                      DB  00FH    ;DPB_12_DEVICE
00253A F2B3 00                      DB  0   ;DPB_13_UNITNO
00253B F2B4 0A00                    DW  10  ;DPB_14_ADDCL16
00253D F2B6 0000                    DW  0   ;DPB_16
00253F F2B8 0000                    DW  0   ;DPB_18
002541 F2BA 0000                    DW  0   ;DPB_1A_SDIR
002543 F2BC 52414D46                DB  "RAMF"  ;DPB_1C_NAME
                                
                                ;   G:
                                
002547 F2C0                         DS  32
                                
                                ;   H:
002567 F2E0                         DS  3
00256A F2E3 00                      DB  0
[EOF:M7DPB.ASM:UTF_8]
                                
       A56B                         ORG $$+OFFSET   ;$DEPHASE
       A56B                     LAST_ADR:
                                
                                    END
[EOF:M7.ASM:UTF_8]
