                                ;*** AILZ80ASM *** Z-80 Assembler, version 1.0.0.0, LST:Full:4
                                ;   LSX-Dodgers for MZ-700/1500
                                ;   Programmed by
                                ;   Gaku (Lovers/Tablacus)
                                
                                    INCLUDE "M7DEF.ASM"
                                
                                ;   LSX-Dodgers DEF
                                ;   MZ-700/1500
                                
       0001                     MAC EQU 1   ;MZ-700/1500
                                
       8080                     RUN EQU 08080H
       8000                     OFFSET  EQU RUN-128
       CF06                     BDOS    EQU 0CF06H
       EC40                     TABLEAD EQU 0EC40H
       EF00                     WORKAD  EQU 0EF00H
       F200                     FATBF   EQU 0F200H
       FA00                     DTBUF   EQU 0FA00H
       FE00                     KEYBF   EQU 0FE00H
       FF00                     KBUF    EQU 0FF00H
       FFD9                     TRAP38  EQU 0FFD9H
       0028                     WIDTH   EQU 40
       0019                     LINE    EQU 25
       0071                     COLORF  EQU 071H
       000A                     COMS    EQU 10
[EOF:M7DEF.ASM:UTF_8]
                                    INCLUDE "LDDEF.ASM"
                                
                                ;   LSX-Dodgers DEF
                                
       0001                     VER_1   EQU 1
       0004                     VER_2   EQU 4
       0005                     VER_3   EQU 5
       1D01                     MACW    EQU MAC + 01D00H    ;機種フラグとLD判別フラグ
       0001                     MACD    EQU MAC + 00000H    ;機種フラグとデバイスフラグ
       0145                     VER EQU VER_1 * 256 + VER_2 * 16 + VER_3
                                
       0005                     SYSTEM  EQU 00005H
       000F                     JP_HL   EQU 0000FH
       005C                     FCB1    EQU 0005CH
       006C                     FCB2    EQU 0006CH
       005D                     FCB1FN  EQU FCB1+1
       006D                     FCB2FN  EQU FCB2+1
       0080                     DTA1    EQU 00080H
                                
       FFCA                     EXTBIO  EQU 0FFCAH
                                
[EOF:LDDEF.ASM:SHIFT_JIS]
                                
000000 8000                         ORG OFFSET
                                                    ;MZTヘッダ128バイト
000000 8000 01                      DB  1           ;ファイルモード
000001 8001 4C44202020202020        DB  "LD           "     ;ファイル名(13)
            2020202020          
00000E 800E 535953                  DB  "SYS"           ;拡張子(3)
000011 8011 0D                      DB  $0D
000012 8012 1C24                    DW  LAST_ADR-RUN        ;サイズ
000014 8014 8080                    DW  RUN         ;開始アドレス
000016 8016 8080                    DW  RUN         ;実行アドレス
000018 8018                         DS  104
                                
                                    INCLUDE "M7INIT.ASM"
                                
                                ;   LSX-Dodgers INIT
                                ;   MZ-700/1500
                                
000080 8080 C38780          10      JP  START
000083 8083 011D                    DW  MACW
000085 8085 4501                    DW  VER
                                
       8087                     START:
000087 8087 F3               4      DI
000088 8088 ED56             8      IM  1
00008A 808A 318780          10      LD  SP,START
00008D 808D CD9B80          17      CALL    INIT        ;NZならAUTOEXECを実行
000090 8090 210000          10      LD  HL,0
000093 8093 E5              11      PUSH    HL
000094 8094 C8              11      RET Z
000095 8095 113D81          10      LD  DE,AUTOD
000098 8098 C3FDEF          10      JP  _COMANL
                                
       809B                     INIT:
00009B 809B D3E0            11      OUT (0E0H),A    ;DRAM(0000H-0FFHH)
00009D 809D D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
00009F 809F 21A281          10      LD  HL,INITE
0000A2 80A2 1106CF          10      LD  DE,BDOS
0000A5 80A5 01FA22          10      LD  BC,LAST_ADR-INITE
0000A8 80A8 EDB0                    LDIR
0000AA 80AA 217381          10      LD  HL,M7BEEPD
0000AD 80AD 1162EF          10      LD  DE,BEEPD+1
0000B0 80B0 010800          10      LD  BC,M7BEEPE-M7BEEPD
0000B3 80B3 EDB0                    LDIR
                                
0000B5 80B5 210000          10      LD  HL,0
0000B8 80B8 065C             7      LD  B,05CH
0000BA 80BA 3EEF             7      LD  A,0EFH      ;RST 28H
0000BC 80BC CD04DE          17      CALL    FILL_MEMORY
0000BF 80BF 06A4             7      LD  B,0A4H
0000C1 80C1 AF               4      XOR A
0000C2 80C2 CD04DE          17      CALL    FILL_MEMORY
                                
0000C5 80C5 3EC3             7      LD  A,0C3H      ;JP
0000C7 80C7 2103EF          10      LD  HL,CPM_WBOOT
0000CA 80CA 320000          13      LD  (00000H),A
0000CD 80CD 220100          16      LD  (00001H),HL ;IPL
                                
0000D0 80D0 21011D          10      LD  HL,MACW     ;3 bit7  DPB Compatible LA(1)
0000D3 80D3 220300          16      LD  (00003H),HL ;  bit6-0 Machine
                                ;               ;4 LSX-Dodgers(01DH)
0000D6 80D6 2106CF          10      LD  HL,BDOS
0000D9 80D9 320500          13      LD  (00005H),A
0000DC 80DC 220600          16      LD  (00006H),HL ;BDOS
                                
0000DF 80DF 21D9FF          10      LD  HL,TRAP38   ;TRAP38
0000E2 80E2 322800          13      LD  (00028H),A
0000E5 80E5 222900          16      LD  (00029H),HL ;RST 038H
                                
0000E8 80E8 3EC9             7      LD  A,0C9H      ;モード1割り込み
0000EA 80EA 323800          13      LD  (00038H),A
                                
0000ED 80ED 3EEF             7      LD  A,CPM_BOOT/256
0000EF 80EF 320B00          13      LD  (0000BH),A
                                
0000F2 80F2 3EE9             7      LD  A,0E9H      ;JP (HL)
0000F4 80F4 320F00          13      LD  (0000FH),A
                                
0000F7 80F7 3A7DF0          13      LD  A,(_FATBF+1)
0000FA 80FA 321300          13      LD  (00013H),A
                                
0000FD 80FD 3A7FF0          13      LD  A,(_DTBUF+1)
000100 8100 321700          13      LD  (00017H),A
                                
000103 8103 3EFE             7      LD  A,KEYBF/256
000105 8105 321B00          13      LD  (0001BH),A
                                
000108 8108 3EFF             7      LD  A,KBUF/256
00010A 810A 321F00          13      LD  (0001FH),A
                                
00010D 810D 214501          10      LD  HL,VER
000110 8110 225A00          16      LD  (0005AH),HL
                                
000113 8113 214981          10      LD  HL,INIMES
000116 8116 CD39D6          17      CALL    MSX
       8119                     INIT1:
000119 8119 F3               4      DI
00011A 811A 1100FF          10      LD  DE,0FF00H
00011D 811D 0600             7      LD  B,0
00011F 811F CDBDD3          17      CALL    ZERO_MEMORY_DE
000122 8122 21CAFF          10      LD  HL,EXTBIO
000125 8125 060F             7      LD  B,TRAP38-EXTBIO
000127 8127 3EEF             7      LD  A,0EFH      ;RST 28H
000129 8129 CD04DE          17      CALL    FILL_MEMORY
00012C 812C 217B81          10      LD  HL,AT_TRAP38
00012F 812F 11D9FF          10      LD  DE,TRAP38
000132 8132 012700          10      LD  BC,AT_TRAPE-AT_TRAP38
000135 8135 EDB0                    LDIR
                                
000137 8137 CDDFDC          17      CALL    CHKEY
00013A 813A FE03             7      CP  3
00013C 813C C9              10      RET
                                
00013D 813D 4155544F45584543    AUTOD:  DB  "AUTOEXEC "
            20                  
000146 8146 413A00              AUTODV: DB  "A:",0
                                
000149 8149 0C4C53582D446F64    INIMES: DB  00CH,"LSX-Dodgers for MZ-700/1500 v"
            6765727320666F72    
            204D5A2D3730302F    
            313530302076        
000167 8167 312E                    DB  030H + VER_1, '.'
000169 8169 3435                    DB  030H + VER_2 ,030H + VER_3
                                ;   DB  8,'PR.2'            ;表示
00016B 816B 2047616B750D0A          DB  ' Gaku',0DH,0AH
000172 8172 00                      DB  0
                                
       8173                     M7BEEPD:
000173 8173 0801                    DB  8,1
000175 8175 0736                    DB  7,036H
000177 8177 04F9                    DB  4,0F9H
000179 8179 0403                    DB  4,3
       817B                     M7BEEPE:
                                
       817B                     AT_TRAP38:
00017B FFD9                         ORG TRAP38,AT_TRAP38-OFFSET
00017B FFD9 210000          10      LD  HL,0
00017E FFDC E3              19      EX  (SP),HL
00017F FFDD 3E24             7      LD  A,'$'
000181 FFDF CD10D9          17      CALL    MSG_A
000184 FFE2 2B               6      DEC HL
000185 FFE3 7C               4      LD  A,H
000186 FFE4 CDE8FF          17      CALL    PRHX
000189 FFE7 7D               4      LD  A,L
       FFE8                     PRHX:
00018A FFE8 F5              11      PUSH    AF
00018B FFE9 07               4      RLCA
00018C FFEA 07               4      RLCA
00018D FFEB 07               4      RLCA
00018E FFEC 07               4      RLCA
00018F FFED CDF1FF          17      CALL    PRHX2
000192 FFF0 F1              10      POP AF
       FFF1                     PRHX2:
000193 FFF1 E60F             7      AND 00FH
000195 FFF3 FE0A             7      CP  10
000197 FFF5 3802            12      JR  C,PRHX3
000199 FFF7 C607             7      ADD A,'A'-'0'-10
       FFF9                     PRHX3:
00019B FFF9 C630             7      ADD A,'0'
00019D FFFB C310D9          10      JP  MSG_A
0001A0 FFFE                         DS  2
       81A2                         ORG $$+OFFSET   ;$DEPHASE
       81A2                     AT_TRAPE:
                                
       81A2                     INITE:
0001A2 CF06                         ORG BDOS,INITE-OFFSET
                                
0001A2 CF06 C309CF          10      JP  IO_BDOS
[EOF:M7INIT.ASM:SHIFT_JIS]
                                    INCLUDE "M7BANK.ASM"
                                
                                ;   LSX-Dodgers IO
                                ;   MZ-700/1500
                                ;   VRAM/KEY/TIMER(0D000H-0EFFFH)にアクセスするので0D000H-0FFFFHに置けない部分
                                ;
                                
       CF09                     IO_BDOS:
0001A5 CF09 D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
0001A7 CF0B C3E2D5          10      JP  BDOS0
                                
       CF0E                     RDKEYDATA:
0001AA CF0E D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
0001AC CF10 3200E0          13      LD  (0E000H),A
0001AF CF13 3A01E0          13      LD  A,(E001H)
0001B2 CF16 D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
0001B4 CF18 C9              10      RET
                                
       CF19                     RD556VSYNC:
0001B5 CF19 D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
0001B7 CF1B 3A02E0          13      LD  A,(0E002H)
0001BA CF1E D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
0001BC CF20 C9              10      RET
                                
       CF21                     RDMMIO:
0001BD CF21 D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
0001BF CF23 7E               7      LD  A,(HL)
0001C0 CF24 D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
0001C2 CF26 C9              10      RET
                                
       CF27                     WRMMIO:
0001C3 CF27 D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
0001C5 CF29 77               7      LD  (HL),A
0001C6 CF2A D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
0001C8 CF2C C9              10      RET
                                
       CF2D                     RDMMIO_BC:
0001C9 CF2D D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
0001CB CF2F 0A               7      LD  A,(BC)
0001CC CF30 D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
0001CE CF32 C9              10      RET
                                
       CF33                     WRMMIO_BC:
0001CF CF33 D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
0001D1 CF35 02               7      LD  (BC),A
0001D2 CF36 D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
0001D4 CF38 C9              10      RET
                                
       CF39                     IO_PRINT:
0001D5 CF39 D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
0001D7 CF3B 77               7      LD  (HL),A
0001D8 CF3C CBDC             8      SET 3,H
0001DA CF3E 71               7      LD  (HL),C
0001DB CF3F D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
0001DD CF41 C9              10      RET
                                
       CF42                     IO_CLR:
0001DE CF42 D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
       CF44                     C1AX1:
0001E0 CF44 7A               4      LD  A,D
0001E1 CF45 C6D0             7      ADD A,0D0H
0001E3 CF47 57               4      LD  D,A
0001E4 CF48 AF               4      XOR A
0001E5 CF49 12               7      LD  (DE),A      ;Text
0001E6 CF4A CBDA             8      SET 3,D
       CF4D                     ICSMC   EQU $+1
0001E8 CF4C 3E00             7      LD  A,0     ;自己書き換え
0001EA CF4E 12               7      LD  (DE),A      ;Color
0001EB CF4F 13               6      INC DE
0001EC CF50 7A               4      LD  A,D
0001ED CF51 D6D8             7      SUB 0D8H
0001EF CF53 57               4      LD  D,A
0001F0 CF54 2118FC          10      LD  HL,0-WIDTH*LINE
0001F3 CF57 19              11      ADD HL,DE
0001F4 CF58 30EA            12      JR  NC,C1AX1
0001F6 CF5A E1              10      POP HL
0001F7 CF5B D1              10      POP DE
0001F8 CF5C D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
0001FA CF5E C9              10      RET
                                
       CF5F                     IO_CLLINE:
0001FB CF5F D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
       CF61                     CLLINE1:
0001FD CF61 CB9C             8      RES 3,H
0001FF CF63 77               7      LD  (HL),A      ;Text
000200 CF64 CBDC             8      SET 3,H
000202 CF66 71               7      LD  (HL),C      ;Color
000203 CF67 23               6      INC HL
000204 CF68 10F7            13      DJNZ    CLLINE1
000206 CF6A D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
000208 CF6C C9              10      RET
                                
       CF6D                     IO_INS:
000209 CF6D D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
       CF6F                     IO_INS1:
00020B CF6F CD83CF          17      CALL    C12S
00020E CF72 23               6      INC HL
00020F CF73 10FA            13      DJNZ    IO_INS1
000211 CF75 D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
000213 CF77 C9              10      RET
                                
       CF78                     IO_BS:
000214 CF78 D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
       CF7A                     IO_BS1:
000216 CF7A CD83CF          17      CALL    C12S
000219 CF7D 2B               6      DEC HL
00021A CF7E 10F8            13      DJNZ    IO_BS
00021C CF80 D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
00021E CF82 C9              10      RET
                                
       CF83                     C12S:
00021F CF83 CB9C             8      RES 3,H
000221 CF85 5E               7      LD  E,(HL)
000222 CF86 77               7      LD  (HL),A
000223 CF87 7B               4      LD  A,E
000224 CF88 CBDC             8      SET 3,H
000226 CF8A 5E               7      LD  E,(HL)
000227 CF8B 71               7      LD  (HL),C
000228 CF8C 4B               4      LD  C,E
000229 CF8D C9              10      RET
                                
       CF8E                     IO_SCRUP:
00022A CF8E D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
       CF90                     SCRUP1:
00022C CF90 2815            12      JR  Z,SCRCL
00022E CF92 D5              11      PUSH    DE
00022F CF93 E5              11      PUSH    HL
000230 CF94 CBDA             8      SET 3,D
000232 CF96 CBDC             8      SET 3,H
000234 CF98 012800          10      LD  BC,WIDTH
000237 CF9B EDB0                    LDIR
000239 CF9D E1              10      POP HL
00023A CF9E D1              10      POP DE
00023B CF9F 012800          10      LD  BC,WIDTH
00023E CFA2 EDB0                    LDIR
000240 CFA4 3D               4      DEC A
000241 CFA5 18E9            12      JR  SCRUP1
                                
       CFA7                     SCRCL:
000243 CFA7 0628             7      LD  B,WIDTH
000245 CFA9 EB               4      EX  DE,HL
000246 CFAA D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
000248 CFAC CD10DB          17      CALL    CLLINE
00024B CFAF E1              10      POP HL
00024C CFB0 D1              10      POP DE
00024D CFB1 C1              10      POP BC
00024E CFB2 C9              10      RET
                                
       CFB3                     C_MON:
00024F CFB3 D3E4            11      OUT (0E4H),A    ;MONITOR ROM(0000H-0FFFH) & VRAM/KEY/TIMER(D000H-FFFFH)
000251 CFB5 C7              12      RST 0
                                
       CFB6                     BANKE:
000252 CFB6                         DS  0CFFEH-BANKE        ;スタックエリア
       CFFE                     EXTSP:
[EOF:M7BANK.ASM:SHIFT_JIS]
                                    INCLUDE "M7CCP.ASM"
                                
                                ;   LSX-Dodgers CCP
                                ;   MZ-700/1500
                                
       CFFE                     WBOOT1:
00029A CFFE D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)　ここは0CFFEH
00029C D000 D3E0            11      OUT (0E0H),A    ;DRAM(0000H-0FFHH)
00029E D002 ED7B0600        20      LD  SP,(SYSTEM+1)
0002A2 D006 FB               4      EI
0002A3 D007 2192EF          10      LD  HL,_KEYD
0002A6 D00A 3600            10      LD  (HL),0
0002A8 D00C CDDFDC          17      CALL    CHKEY
0002AB D00F CDFDD8          17      CALL    KEYBC_IFBREAK
0002AE D012 3E04             7      LD  A,4
0002B0 D014 CD10D9          17      CALL    MSG_A
[EOF:M7CCP.ASM:UTF_8]
                                    INCLUDE "LDCCP.ASM"
                                
                                ;   LSX-Dodgers CCP
                                
       D017                     COMMAND:
0002B3 D017 CDCAD0          17      CALL    SETDTA1
0002B6 D01A 3A87EF          13      LD  A,(_DVSW)
0002B9 D01D C641             7      ADD A,'A'
0002BB D01F CD10D9          17      CALL    MSG_A
0002BE D022 3E3E             7      LD  A,'>'
0002C0 D024 CD10D9          17      CALL    MSG_A
0002C3 D027 3E50             7      LD  A,80
0002C5 D029 12               7      LD  (DE),A
0002C6 D02A CD6FD9          17      CALL    _SYS0A      ;(BDOS)文字列入力
0002C9 D02D CD7FD2          17      CALL    LTNL
                                
0002CC D030 118200          10      LD  DE,DTA1+2
0002CF D033 CDFDEF          17      CALL    _COMANL
0002D2 D036 30DF            12      JR  NC,COMMAND
0002D4 D038 1179EF          10      LD  DE,COMERM
0002D7 D03B CD2AD6          17      CALL    _SYS09      ;(BDOS)文字列出力
0002DA D03E C7              12      RST 0
                                
       D03F                     COMANL:
0002DB D03F CD58DD          17      CALL    FILE
0002DE D042 3A19EF          13      LD  A,(FNAME+4)
0002E1 D045 FE20             7      CP  020H
0002E3 D047 201C            12      JR  NZ,COMB2
0002E5 D049 D5              11      PUSH    DE
0002E6 D04A 1115EF          10      LD  DE,FNAME
0002E9 D04D 1A               7      LD  A,(DE)
0002EA D04E FE20             7      CP  020H
0002EC D050 2844            12      JR  Z,SDVSW
0002EE D052 1B               6      DEC DE
0002EF D053 1A               7      LD  A,(DE)
0002F0 D054 C6FF             7      ADD A,0FFH
0002F2 D056 3809            12      JR  C,COMB
0002F4 D058 13               6      INC DE
                                
0002F5 D059 21A6D5          10      LD  HL,COMTB
0002F8 D05C 060A             7      LD  B,COMS
0002FA D05E CDDCDF          17      CALL    CPNAME
       D061                     COMB:
0002FD D061 D1              10      POP DE
0002FE D062 D20F00          10      JP  NC,JP_HL
       D065                     COMB2:
000301 D065 EB               4      EX  DE,HL
000302 D066 223ED1          16      LD  (COMPAT+1),HL
000305 D069 F5              11      PUSH    AF
000306 D06A CDEAD0          17      CALL    CEXE4
000309 D06D F1              10      POP AF
00030A D06E 2115EF          10      LD  HL,FNAME
00030D D071 116D00          10      LD  DE,FCB2+1   ;COMMAND NAME
000310 D074 010B00          10      LD  BC,11
000313 D077 EDB0                    LDIR
000315 D079 1149D5          10      LD  DE,PATHD
       D07C                     CEX1:
000318 D07C 1A               7      LD  A,(DE)
000319 D07D FE20             7      CP  020H
00031B D07F D8              11      RET C
00031C D080 CD4DDD          17      CALL    FILEC
00031F D083 D5              11      PUSH    DE
000320 D084 216D00          10      LD  HL,FCB2+1   ;COMMAND NAME
000323 D087 1115EF          10      LD  DE,FNAME
000326 D08A 010B00          10      LD  BC,11
000329 D08D EDB0                    LDIR
00032B D08F CDEAD0          17      CALL    CEXE4
00032E D092 D1              10      POP DE
00032F D093 13               6      INC DE
000330 D094 18E6            12      JR  CEX1
                                
       D096                     SDVSW:
000332 D096 F1              10      POP AF
000333 D097 3A14EF          13      LD  A,(FDRV)
000336 D09A 3D               4      DEC A
000337 D09B 5F               4      LD  E,A
000338 D09C 0E0E             7      LD  C,00EH      ;(BDOS)カレントドライブの設定
00033A D09E 1831            12      JR  SYSTEM0
                                
       D0A0                     OPEN1:
00033C D0A0 2114EF          10      LD  HL,FDRV
       D0A3                     OPEN:
00033F D0A3 0E11             7      LD  C,011H      ;(BDOS)ファイルの検索
       D0A5                     OPEN3:
000341 D0A5 D5              11      PUSH    DE
000342 D0A6 1124D5          10      LD  DE,DTA_CCP
000345 D0A9 CDC7D0          17      CALL    SETDTA
000348 D0AC EB               4      EX  DE,HL
000349 D0AD CDD1D0          17      CALL    SYSTEM0
00034C D0B0 D1              10      POP DE
00034D D0B1 C9              10      RET
                                
       D0B2                     OPEN2:
00034E D0B2 0E12             7      LD  C,012H
000350 D0B4 18EF            12      JR  OPEN3
                                
       D0B6                     DEFCB:              ;Z=Ok NZ=Error
000352 D0B6 1124D5          10      LD  DE,DTA_CCP
000355 D0B9 CDCFD0          17      CALL    SYSC0F
                                
000358 D0BC 1145D5          10      LD  DE,DTA_CCP+33   ;(FCB)ランダムレコード
00035B D0BF 0604             7      LD  B,4
00035D D0C1 CDBDD3          17      CALL    ZERO_MEMORY_DE
000360 D0C4 110001          10      LD  DE,00100H
       D0C7                     SETDTA:
000363 D0C7 C32ED8          10      JP  _SYS1A      ;(BDOS)DTAの設定
                                
       D0CA                     SETDTA1:
000366 D0CA 118000          10      LD  DE,DTA1
000369 D0CD 18F8            12      JR  SETDTA
                                
       D0CF                     SYSC0F:
00036B D0CF 0E0F             7      LD  C,00FH      ;(BDOS)ファイルのオープン
       D0D1                     SYSTEM0:
00036D D0D1 CD0500          17      CALL    SYSTEM
000370 D0D4 B7               4      OR  A
000371 D0D5 C9              10      RET
                                
       D0D6                     C_CD:
000372 D0D6 0E5A             7      LD  C,5AH
000374 D0D8 18F7            12      JR  SYSTEM0
                                
       D0DA                     S27BUF:
000376 D0DA 3A0700          13      LD  A,(SYSTEM+2)
000379 D0DD 3D               4      DEC A
00037A D0DE E6F8             7      AND 0F8H
00037C D0E0 67               4      LD  H,A
00037D D0E1 2E00             7      LD  L,0
       D0E3                     S27DTA:
00037F D0E3 1124D5          10      LD  DE,DTA_CCP
       D0E6                     S27:
000382 D0E6 0E27             7      LD  C,027H      ;(BDOS)ランダムブロック読み込み
000384 D0E8 18E7            12      JR  SYSTEM0
                                
       D0EA                     CEXE4:
000386 D0EA 3A14EF          13      LD  A,(FDRV)
000389 D0ED 325700          13      LD  (00057H),A
00038C D0F0 2A22EF          16      LD  HL,(FDRV+14)
00038F D0F3 225800          16      LD  (00058H),HL
                                
000392 D0F6 211DEF          10      LD  HL,FNAME+8
000395 D0F9 7E               7      LD  A,(HL)
000396 D0FA FE20             7      CP  020H
000398 D0FC 2007            12      JR  NZ,CEXE7
00039A D0FE 3E3F             7      LD  A,'?'
00039C D100 77               7      LD  (HL),A
00039D D101 23               6      INC HL
00039E D102 77               7      LD  (HL),A
00039F D103 23               6      INC HL
0003A0 D104 77               7      LD  (HL),A
       D105                     CEXE7:
0003A1 D105 CDA0D0          17      CALL    OPEN1
       D108                     CEXE5:
0003A4 D108 C0              11      RET NZ
0003A5 D109 2A2ED5          16      LD  HL,(DTA_CCP+1+9)
0003A8 D10C 7C               4      LD  A,H
0003A9 D10D CD64E0          17      CALL    CAP
0003AC D110 67               4      LD  H,A
0003AD D111 7D               4      LD  A,L
0003AE D112 CD64E0          17      CALL    CAP
0003B1 D115 6F               4      LD  L,A
0003B2 D116 3A2DD5          13      LD  A,(DTA_CCP+1+8)
0003B5 D119 CD64E0          17      CALL    CAP
0003B8 D11C D642             7      SUB 'B'
0003BA D11E 282C            12      JR  Z,C_BAT
0003BC D120 3D               4      DEC A       ;'C'
0003BD D121 2805            12      JR  Z,C_EXE
       D123                     CEXE6:
0003BF D123 CDB2D0          17      CALL    OPEN2
0003C2 D126 18E0            12      JR  CEXE5
                                
       D128                     C_EXE:
0003C4 D128 7C               4      LD  A,H
0003C5 D129 FE4D             7      CP  'M'
0003C7 D12B 20F6            12      JR  NZ,CEXE6
                                
0003C9 D12D CDB6D0          17      CALL    DEFCB
0003CC D130 CDDAD0          17      CALL    S27BUF
0003CF D133 3D               4      DEC A
0003D0 D134 37               4      SCF
0003D1 D135 C0              11      RET NZ
0003D2 D136 7C               4      LD  A,H
0003D3 D137 B5               4      OR  L
0003D4 D138 37               4      SCF
0003D5 D139 C8              11      RET Z
0003D6 D13A CDCAD0          17      CALL    SETDTA1
0003D9 D13D 110000          10  COMPAT: LD  DE,0                ; self-modifying code
0003DC D140 ED7B0600        20      LD  SP,(SYSTEM+1)
0003E0 D144 67               4      LD  H,A             ; A=0 in SETDTA1(_SYS1A)
0003E1 D145 6F               4      LD  L,A
0003E2 D146 E5              11      PUSH    HL              ; push $0000 (reboot address)
0003E3 D147 24               4      INC H
0003E4 D148 E5              11      PUSH    HL              ; push $0100 (TPA address)
0003E5 D149 C388D3          10      JP  SETFCB              ; and JP $0100
                                
       D14C                     C_BAT:
0003E8 D14C 114154          10      LD  DE,'A'+'T'*256
0003EB D14F ED52            15      SBC HL,DE
0003ED D151 20D0            12      JR  NZ,CEXE6
                                
0003EF D153 F1              10      POP AF
0003F0 D154 F1              10      POP AF
0003F1 D155 CDB6D0          17      CALL    DEFCB
0003F4 D158 210002          10      LD  HL,00200H
0003F7 D15B CDE3D0          17      CALL    S27DTA
0003FA D15E C6FE             7      ADD A,0FEH
0003FC D160 D8              11      RET C
0003FD D161 7D               4      LD  A,L
0003FE D162 B7               4      OR  A
0003FF D163 37               4      SCF
000400 D164 C8              11      RET Z
000401 D165 3C               4      INC A
000402 D166 F5              11      PUSH    AF
                                
000403 D167 CD00D9          17      CALL    KEYBC
000406 D16A 3E06             7      LD  A,6
000408 D16C CD10D9          17      CALL    MSG_A
00040B D16F C1              10      POP BC
00040C D170 210001          10      LD  HL,00100H
       D173                     BAT1:
00040F D173 A7               4      AND A
000410 D174 05               4      DEC B
000411 D175 C8              11      RET Z
000412 D176 7E               7      LD  A,(HL)
000413 D177 FE25             7      CP  '%'
000415 D179 280C            12      JR  Z,BAT2
       D17B                     BAT1X:
000417 D17B 7E               7      LD  A,(HL)
000418 D17C 23               6      INC HL
000419 D17D FE1A             7      CP  01AH
00041B D17F C8              11      RET Z
00041C D180 FE0A             7      CP  00AH
00041E D182 C4E5D8          17      CALL    NZ,KEYBS
000421 D185 18EC            12      JR  BAT1
                                
       D187                     BAT2:
000423 D187 23               6      INC HL
000424 D188 7E               7      LD  A,(HL)
000425 D189 2B               6      DEC HL
000426 D18A D631             7      SUB '1'
000428 D18C 38ED            12      JR  C,BAT1X
00042A D18E FE09             7      CP  9
00042C D190 30E9            12      JR  NC,BAT1X
00042E D192 23               6      INC HL
00042F D193 23               6      INC HL
000430 D194 3C               4      INC A
000431 D195 4F               4      LD  C,A
000432 D196 ED5B3ED1        20      LD  DE,(COMPAT+1)
       D19A                     BAT3:
000436 D19A 1A               7      LD  A,(DE)
000437 D19B B7               4      OR  A
000438 D19C 28D5            12      JR  Z,BAT1
00043A D19E CD2FDE          17      CALL    SPCUT
00043D D1A1 0D               4      DEC C
00043E D1A2 2808            12      JR  Z,BAT5
       D1A4                     BAT4:
000440 D1A4 1A               7      LD  A,(DE)
000441 D1A5 FE21             7      CP  021H
000443 D1A7 38F1            12      JR  C,BAT3
000445 D1A9 13               6      INC DE
000446 D1AA 18F8            12      JR  BAT4
       D1AC                     BAT5:
000448 D1AC 1A               7      LD  A,(DE)
000449 D1AD FE21             7      CP  021H
00044B D1AF 38C2            12      JR  C,BAT1
00044D D1B1 13               6      INC DE
00044E D1B2 CDE5D8          17      CALL    KEYBS
000451 D1B5 18F5            12      JR  BAT5
                                
       D1B7                     SWITCH:
000453 D1B7 1A               7      LD  A,(DE)
       D1B8                     SW1:
000454 D1B8 13               6      INC DE
000455 D1B9 B9               4      CP  C
000456 D1BA 1A               7      LD  A,(DE)
000457 D1BB C8              11      RET Z
000458 D1BC FE20             7      CP  020H
00045A D1BE 30F8            12      JR  NC,SW1
       D1C0                     C_REM:
00045C D1C0 AF               4      XOR A
00045D D1C1 C9              10      RET
                                
       D1C2                     C_DEL:
00045E D1C2 CD88D3          17      CALL    SETFCB
000461 D1C5 CD26D9          17      CALL    _SYS08      ;(BDOS)エコーなしコンソール入力
                                
000464 D1C8 0E13             7      LD  C,013H
000466 D1CA 180A            12      JR  CDEL1       ;(BDOS)ファイルの削除
                                
       D1CC                     C_REN:
000468 D1CC CD88D3          17      CALL    SETFCB
00046B D1CF 3E10             7      LD  A,010H      ;ディレクトリも対象にする
00046D D1D1 326900          13      LD  (FCB1+13),A ;属性
000470 D1D4 0E17             7      LD  C,017H      ;(BDOS)ファイル名の変更
       D1D6                     CDEL1:
000472 D1D6 115C00          10      LD  DE,FCB1
000475 D1D9 CD0500          17      CALL    SYSTEM
000478 D1DC C6FF             7      ADD A,0FFH
00047A D1DE C9              10      RET
                                
       D1DF                     C_DIR:
00047B D1DF CD4DDD          17      CALL    FILEC
00047E D1E2 2115EF          10      LD  HL,FDRV+1
000481 D1E5 CD19D5          17      CALL    CWILD1
000484 D1E8 3EF1             7      LD  A,0F1H
000486 D1EA 3221EF          13      LD  (FDRV+13),A
000489 D1ED CDA0D0          17      CALL    OPEN1
       D1F0                     CDIR1:
00048C D1F0 B7               4      OR  A
00048D D1F1 2008            12      JR  NZ,PDSKF
00048F D1F3 CD3ED2          17      CALL    P_NAME
000492 D1F6 CDB2D0          17      CALL    OPEN2
000495 D1F9 18F5            12      JR  CDIR1
                                
       D1FB                     PDSKF:
000497 D1FB 3A14EF          13      LD  A,(FDRV)
00049A D1FE 5F               4      LD  E,A
00049B D1FF 0E1B             7      LD  C,01BH      ;(BDOS)ディスク情報の獲得
00049D D201 CD0500          17      CALL    SYSTEM
0004A0 D204 4F               4      LD  C,A     ;C←1クラスタ辺りの論理セクタ数
0004A1 D205 C601             7      ADD A,001H
0004A3 D207 D8              11      RET C       ;Aが0FFHだった場合
0004A4 D208 3E06             7      LD  A,8-2
       D20A                     PDS1:               ;HL=未使用クラスタの総数
0004A6 D20A 3C               4      INC A
0004A7 D20B CB19             8      RR  C
0004A9 D20D 30FB            12      JR  NC,PDS1
       D20F                     PDS2:               ;B←論理セクタのサイズの上位8ビット
0004AB D20F 3C               4      INC A
0004AC D210 CB18             8      RR  B
0004AE D212 30FB            12      JR  NC,PDS2
0004B0 D214 47               4      LD  B,A
                                
0004B1 D215 110000          10      LD  DE,0
       D218                     PDS3:
0004B4 D218 29              11      ADD HL,HL
0004B5 D219 EB               4      EX  DE,HL
0004B6 D21A ED6A            15      ADC HL,HL
0004B8 D21C EB               4      EX  DE,HL
0004B9 D21D 10F9            13      DJNZ    PDS3
       D21F                     PDSKF1:
0004BB D21F CDB7D2          17      CALL    PRDEC_DEHL
0004BE D222 118AD5          10      LD  DE,FREE
0004C1 D225 CD2AD6          17      CALL    _SYS09      ;(BDOS)文字列出力
0004C4 D228 CDA6D2          17      CALL    PUTDRV
0004C7 D22B 3E5C             7      LD  A,05CH      ;\
0004C9 D22D CD10D9          17      CALL    MSG_A
0004CC D230 2A22EF          16      LD  HL,(FDRV+14)    ;ディレクトリのクラスタ番号
0004CF D233 AF               4      XOR A
0004D0 D234 11FEFF          10      LD  DE,0-2
0004D3 D237 19              11      ADD HL,DE
0004D4 D238 23               6      INC HL
0004D5 D239 DCB3D2          17      CALL    C,PRDEC_HL
0004D8 D23C 1841            12      JR  LTNL
                                
       D23E                     P_NAME:
0004DA D23E 3A25D5          13      LD  A,(DTA_CCP+1)
0004DD D241 FE2E             7      CP  '.'
0004DF D243 C8              11      RET Z
0004E0 D244 11A2D5          10      LD  DE,DIRHD
0004E3 D247 CD2AD6          17      CALL    _SYS09      ;(BDOS)文字列出力
0004E6 D24A 3A30D5          13      LD  A,(DTA_CCP+1+00BH)
0004E9 D24D F5              11      PUSH    AF
0004EA D24E 0F               4      RRCA
0004EB D24F 9F               4      SBC A,A
0004EC D250 E60A             7      AND '*'-020H
0004EE D252 C620             7      ADD A,020H
0004F0 D254 CD10D9          17      CALL    MSG_A
0004F3 D257 CDA6D2          17      CALL    PUTDRV
0004F6 D25A 2125D5          10      LD  HL,DTA_CCP+1
0004F9 D25D CDF7D2          17      CALL    FPRNT
                                
0004FC D260 F1              10      POP AF
0004FD D261 CB67             8      BIT 4,A
0004FF D263 2808            12      JR  Z,DIR3
000501 D265 1197D5          10      LD  DE,DIRMES
000504 D268 CD2AD6          17      CALL    _SYS09      ;(BDOS)文字列出力
000507 D26B 180A            12      JR  DIR6
       D26D                     DIR3:
000509 D26D ED5B43D5        20      LD  DE,(DTA_CCP+1+01EH)
00050D D271 2A41D5          16      LD  HL,(DTA_CCP+1+01CH)
000510 D274 CDB7D2          17      CALL    PRDEC_DEHL
       D277                     DIR6:
000513 D277 3AB1EF          13      LD  A,(CRTCD+1)
000516 D27A FE29             7      CP  40+1
000518 D27C D419D3          17      CALL    NC,PRTTMS
                                
       D27F                     LTNL:
00051B D27F 1E03             7      LD  E,3
00051D D281 C3CDEF          10      JP  _PRINT
                                
       D284                     C_PATH:
000520 D284 CD2FDE          17      CALL    SPCUT
000523 D287 2149D5          10      LD  HL,PATHD
000526 D28A FE21             7      CP  021H
000528 D28C 300C            12      JR  NC,CPATH0
       D28E                     CPATHP:
00052A D28E 7E               7      LD  A,(HL)
00052B D28F 23               6      INC HL
00052C D290 FE20             7      CP  020H
00052E D292 3F               4      CCF
00052F D293 30EA            12      JR  NC,LTNL
000531 D295 CD10D9          17      CALL    MSG_A
000534 D298 18F4            12      JR  CPATHP
       D29A                     CPATH0:
000536 D29A FE3B             7      CP  ';'
000538 D29C 2001            12      JR  NZ,CPATH1
00053A D29E 13               6      INC DE
       D29F                     CPATH1:
00053B D29F EB               4      EX  DE,HL
00053C D2A0 014000          10      LD  BC,PATHX
00053F D2A3 EDB0                    LDIR
000541 D2A5 C9              10      RET
                                
       D2A6                     PUTDRV:
000542 D2A6 3A14EF          13      LD  A,(FDRV)
000545 D2A9 C640             7      ADD A,'A'-1
000547 D2AB CD10D9          17      CALL    MSG_A
00054A D2AE 3E3A             7      LD  A,':'
       D2B0                     MSG_AR:
00054C D2B0 C310D9          10      JP  MSG_A
                                
       D2B3                     PRDEC_HL:
00054F D2B3 AF               4      XOR A
       D2B4                     PRDEC_AHL:
000550 D2B4 5F               4      LD  E,A
000551 D2B5 1600             7      LD  D,0
       D2B7                     PRDEC_DEHL:
000553 D2B7 D5              11      PUSH    DE
000554 D2B8 110FEF          10      LD  DE,DECBF
000557 D2BB 0605             7      LD  B,5
000559 D2BD CDBDD3          17      CALL    ZERO_MEMORY_DE  ;A=0
00055C D2C0 D1              10      POP DE
                                
00055D D2C1 0E20             7      LD  C,32
       D2C3                     DEC1:
00055F D2C3 29              11      ADD HL,HL
000560 D2C4 EB               4      EX  DE,HL
000561 D2C5 ED6A            15      ADC HL,HL
000563 D2C7 EB               4      EX  DE,HL
000564 D2C8 E5              11      PUSH    HL
000565 D2C9 2113EF          10      LD  HL,DECBF+4
000568 D2CC 0605             7      LD  B,5
       D2CE                     DEC2:
00056A D2CE 7E               7      LD  A,(HL)
00056B D2CF 8F               4      ADC A,A
00056C D2D0 27               4      DAA
00056D D2D1 77               7      LD  (HL),A
00056E D2D2 2B               6      DEC HL
00056F D2D3 10F9            13      DJNZ    DEC2
000571 D2D5 E1              10      POP HL
000572 D2D6 0D               4      DEC C
000573 D2D7 20EA            12      JR  NZ,DEC1
                                
000575 D2D9 210FEF          10      LD  HL,DECBF
000578 D2DC 3E20             7      LD  A,020H
00057A D2DE 0604             7      LD  B,4
       D2E0                     DEC3:
00057C D2E0 CDEDD2          17      CALL    DEC4
00057F D2E3 CDEDD2          17      CALL    DEC4
000582 D2E6 23               6      INC HL
000583 D2E7 10F7            13      DJNZ    DEC3
       D2E9                     DECX:
000585 D2E9 CDEDD2          17      CALL    DEC4
000588 D2EC AF               4      XOR A
       D2ED                     DEC4:
000589 D2ED ED6F            18      RLD
00058B D2EF FE20             7      CP  020H
00058D D2F1 2802            12      JR  Z,DEC5
00058F D2F3 F630             7      OR  030H
       D2F5                     DEC5:
000591 D2F5 18B9            12      JR  MSG_AR
                                
       D2F7                     FPRNT:
000593 D2F7 0608             7      LD  B,8
000595 D2F9 CD0AD3          17      CALL    P_N1
000598 D2FC 7E               7      LD  A,(HL)
000599 D2FD C680             7      ADD A,0A0H-020H
00059B D2FF FEA0             7      CP  0A0H
00059D D301 2802            12      JR  Z,FPR1
00059F D303 3E2E             7      LD  A,'.'
       D305                     FPR1:
0005A1 D305 CD10D9          17      CALL    MSG_A
0005A4 D308 0603             7      LD  B,3
                                
       D30A                     P_N1:
0005A6 D30A C5              11      PUSH    BC
0005A7 D30B E5              11      PUSH    HL
0005A8 D30C 7E               7      LD  A,(HL)
0005A9 D30D CD70E0          17      CALL    CAP3
0005AC D310 CD10D9          17      CALL    MSG_A
0005AF D313 E1              10      POP HL
0005B0 D314 C1              10      POP BC
0005B1 D315 23               6      INC HL
0005B2 D316 10F2            13      DJNZ    P_N1
0005B4 D318 C9              10      RET
                                
       D319                     PRTTMS:
0005B5 D319 3E20             7      LD  A,020H
0005B7 D31B CD10D9          17      CALL    MSG_A
                                
0005BA D31E 2A3DD5          16      LD  HL,(DTA_CCP+1+24)
0005BD D321 7D               4      LD  A,L
0005BE D322 B7               4      OR  A
0005BF D323 C8              11      RET Z
0005C0 D324 CB3C             8      SRL H
0005C2 D326 17               4      RLA
0005C3 D327 17               4      RLA
0005C4 D328 17               4      RLA
0005C5 D329 17               4      RLA
0005C6 D32A E60F             7      AND 00FH
0005C8 D32C 57               4      LD  D,A
0005C9 D32D 7C               4      LD  A,H
0005CA D32E C650             7      ADD A,80
0005CC D330 CD73D3          17      CALL    PRDEC_A
0005CF D333 3E2D             7      LD  A,'-'
0005D1 D335 CD10D9          17      CALL    MSG_A
0005D4 D338 7A               4      LD  A,D
0005D5 D339 CD73D3          17      CALL    PRDEC_A
0005D8 D33C 3E2D             7      LD  A,'-'
0005DA D33E CD10D9          17      CALL    MSG_A
0005DD D341 7D               4      LD  A,L
0005DE D342 E61F             7      AND 01FH
0005E0 D344 CD73D3          17      CALL    PRDEC_A
                                
0005E3 D347 2A3BD5          16      LD  HL,(DTA_CCP+1+22)
                                
0005E6 D34A 3E20             7      LD  A,020H
0005E8 D34C CD10D9          17      CALL    MSG_A
0005EB D34F 7C               4      LD  A,H
0005EC D350 65               4      LD  H,L
0005ED D351 0603             7      LD  B,3
       D353                     PRTTMS1:
0005EF D353 1F               4      RRA
0005F0 D354 CB1D             8      RR  L
0005F2 D356 10FB            13      DJNZ    PRTTMS1
0005F4 D358 E61F             7      AND 01FH
0005F6 D35A CD73D3          17      CALL    PRDEC_A
0005F9 D35D 3E3A             7      LD  A,':'
0005FB D35F CD10D9          17      CALL    MSG_A
0005FE D362 7D               4      LD  A,L
0005FF D363 0F               4      RRCA
000600 D364 0F               4      RRCA
000601 D365 E63F             7      AND 03FH
000603 D367 CD73D3          17      CALL    PRDEC_A
000606 D36A 3E3A             7      LD  A,':'
000608 D36C CD10D9          17      CALL    MSG_A
00060B D36F 7C               4      LD  A,H
00060C D370 E61F             7      AND 01FH
00060E D372 87               4      ADD A,A
                                
                                ;   PRINT10
                                
       D373                     PRDEC_A:
00060F D373 E5              11      PUSH    HL
000610 D374 0608             7      LD  B,8
000612 D376 4F               4      LD  C,A
000613 D377 AF               4      XOR A
       D378                     PRTA1:
000614 D378 CB01             4      RLC C
000616 D37A 8F               4      ADC A,A
000617 D37B 27               4      DAA
000618 D37C 10FA            13      DJNZ    PRTA1
00061A D37E 210FEF          10      LD  HL,DECBF
00061D D381 77               7      LD  (HL),A
00061E D382 AF               4      XOR A
00061F D383 CDE9D2          17      CALL    DECX
000622 D386 E1              10      POP HL
000623 D387 C9              10      RET
                                
       D388                     SETFCB:
000624 D388 CD2FDE          17      CALL    SPCUT
000627 D38B 1A               7      LD  A,(DE)
000628 D38C FE20             7      CP  020H
00062A D38E 3801            12      JR  C,SETFCBA
00062C D390 1B               6      DEC DE
       D391                     SETFCBA:
00062D D391 0624             7      LD  B,36
00062F D393 215C00          10      LD  HL,FCB1
000632 D396 E5              11      PUSH    HL
000633 D397 AF               4      XOR A
000634 D398 CD04DE          17      CALL    FILL_MEMORY
000637 D39B E1              10      POP HL
000638 D39C D5              11      PUSH    DE
000639 D39D CD8DD8          17      CALL    _SYS5C      ;(BDOS)ファイル名の解析
00063C D3A0 216C00          10      LD  HL,FCB2
00063F D3A3 CD8DD8          17      CALL    _SYS5C      ;(BDOS)ファイル名の解析
000642 D3A6 E1              10      POP HL
000643 D3A7 010050          10      LD  BC,05000H
000646 D3AA 118100          10      LD  DE,00081H
       D3AD                     SETFCB1:
000649 D3AD 7E               7      LD  A,(HL)
00064A D3AE 23               6      INC HL
00064B D3AF FE20             7      CP  020H
00064D D3B1 3805            12      JR  C,SETFCB2
00064F D3B3 12               7      LD  (DE),A
000650 D3B4 13               6      INC DE
000651 D3B5 0C               4      INC C
000652 D3B6 10F5            13      DJNZ    SETFCB1
       D3B8                     SETFCB2:
000654 D3B8 79               4      LD  A,C
000655 D3B9 328000          13      LD  (DTA1),A
000658 D3BC 04               4      INC B
       D3BD                     ZERO_MEMORY_DE:
000659 D3BD AF               4      XOR A
       D3BE                     FILL_MEMORY_DE:
00065A D3BE 12               7      LD  (DE),A
00065B D3BF 13               6      INC DE
00065C D3C0 10FC            13      DJNZ    FILL_MEMORY_DE
00065E D3C2 C9              10      RET
                                
       D3C3                     C_COPY:
00065F D3C3 CD88D3          17      CALL    SETFCB
000662 D3C6 118100          10      LD  DE,DTA1+1
000665 D3C9 0E2F             7      LD  C,'/'
000667 D3CB CDB7D1          17      CALL    SWITCH
00066A D3CE CD64E0          17      CALL    CAP
00066D D3D1 3259D4          13      LD  (SW+1),A
                                
000670 D3D4 1161EF          10      LD  DE,BEEPD
000673 D3D7 CD50DD          17      CALL    FILEC2
000676 D3DA 216C00          10      LD  HL,FCB2
000679 D3DD CD94D8          17      CALL    S29X1
                                
00067C D3E0 3E10             7      LD  A,010H
00067E D3E2 326900          13      LD  (FCB1+13),A
000681 D3E5 216D00          10      LD  HL,FCB2+1
000684 D3E8 CD19D5          17      CALL    CWILD1
       D3EB                     COPY0:
000687 D3EB CD16D5          17      CALL    CWILD
00068A D3EE 215C00          10      LD  HL,FCB1
00068D D3F1 CDA3D0          17      CALL    OPEN
000690 D3F4 37               4      SCF
       D3F5                     COPY1:
000691 D3F5 C0              11      RET NZ
000692 D3F6 CDB6D0          17      CALL    DEFCB
                                
000695 D3F9 3A31D5          13      LD  A,(DTA_CCP+13)
000698 D3FC CB67             8      BIT 4,A
00069A D3FE 2824            12      JR  Z,COPY1A
                                
00069C D400 215D00          10      LD  HL,FCB1+1
00069F D403 CD93E1          17      CALL    CHKWILD
0006A2 D406 3817            12      JR  C,COPY9
                                
0006A4 D408 3E20             7      LD  A,020H
0006A6 D40A 325D00          13      LD  (FCB1+1),A
0006A9 D40D 2A3ED5          16      LD  HL,(DTA_CCP+26)
0006AC D410 23               6      INC HL
0006AD D411 226A00          16      LD  (FCB1+14),HL
0006B0 D414 18D5            12      JR  COPY0
                                
       D416                     COPYS:
0006B2 D416 1174EF          10      LD  DE,SKIP
       D419                     COPY8:
0006B5 D419 CD2AD6          17      CALL    _SYS09      ;(BDOS)文字列出力
0006B8 D41C CD7FD2          17      CALL    LTNL
       D41F                     COPY9:
0006BB D41F CDB2D0          17      CALL    OPEN2
0006BE D422 18D1            12      JR  COPY1
                                
       D424                     COPY1A:
0006C0 D424 216C00          10      LD  HL,FCB2
0006C3 D427 1114EF          10      LD  DE,FDRV
0006C6 D42A 0126D5          10      LD  BC,DTA_CCP+2
0006C9 D42D EDA0            16      LDI
0006CB D42F 3E0B             7      LD  A,11
       D431                     COPY2:
0006CD D431 F5              11      PUSH    AF
0006CE D432 7E               7      LD  A,(HL)
0006CF D433 FE3F             7      CP  '?'
0006D1 D435 2001            12      JR  NZ,COPY3
0006D3 D437 0A               7      LD  A,(BC)
       D438                     COPY3:
0006D4 D438 12               7      LD  (DE),A
0006D5 D439 03               6      INC BC
0006D6 D43A 13               6      INC DE
0006D7 D43B 23               6      INC HL
0006D8 D43C F1              10      POP AF
0006D9 D43D 3D               4      DEC A
0006DA D43E 20F1            12      JR  NZ,COPY2
0006DC D440 010500          10      LD  BC,16-11
0006DF D443 EDB0                    LDIR
       D445                     PUTNAME:
0006E1 D445 215D00          10      LD  HL,FCB1+1
0006E4 D448 CD93E1          17      CALL    CHKWILD
0006E7 D44B 300B            12      JR  NC,PUTN1
0006E9 D44D 2115EF          10      LD  HL,FDRV+1
0006EC D450 CDF7D2          17      CALL    FPRNT
0006EF D453 3E20             7      LD  A,020H
0006F1 D455 CD10D9          17      CALL    MSG_A
       D458                     PUTN1:
0006F4 D458 3E00             7  SW: LD  A,000H
0006F6 D45A FE54             7      CP  'T'
0006F8 D45C 2005            12      JR  NZ,CSW1
0006FA D45E 2178D4          10      LD  HL,SWNE
0006FD D461 1807            12      JR  SWT1
       D463                     CSW1:
0006FF D463 FE4E             7      CP  'N'
000701 D465 2011            12      JR  NZ,SWNE
000703 D467 2116D4          10      LD  HL,COPYS
       D46A                     SWT1:
000706 D46A 1114EF          10      LD  DE,FDRV
000709 D46D CDCFD0          17      CALL    SYSC0F
00070C D470 2801            12      JR  Z,SWN1
00070E D472 E9               4      JP  (HL)
       D473                     SWN1:
00070F D473 CDCCD4          17      CALL    CTIME
000712 D476 309E            12      JR  NC,COPYS
       D478                     SWNE:
000714 D478 1114EF          10      LD  DE,FDRV
000717 D47B 0E16             7      LD  C,016H      ;(BDOS)ファイルの作成
000719 D47D CDD1D0          17      CALL    SYSTEM0
00071C D480 2048            12      JR  NZ,COPYE2
00071E D482 67               4      LD  H,A     ;A=0
00071F D483 6F               4      LD  L,A
000720 D484 2235EF          16      LD  (FDRV+33),HL    ;(FCB)ランダムレコード
000723 D487 2237EF          16      LD  (FDRV+35),HL
       D48A                     COPY6:
000726 D48A CDDAD0          17      CALL    S27BUF
000729 D48D 47               4      LD  B,A
00072A D48E 3C               4      INC A
00072B D48F 2831            12      JR  Z,COPYE
00072D D491 7C               4      LD  A,H
00072E D492 B5               4      OR  L
00072F D493 280C            12      JR  Z,COPY7
000731 D495 1114EF          10      LD  DE,FDRV
000734 D498 0E26             7      LD  C,026H      ;(BDOS)ランダムブロック書き込み
000736 D49A CDD1D0          17      CALL    SYSTEM0
000739 D49D 2023            12      JR  NZ,COPYE
00073B D49F 10E9            13      DJNZ    COPY6
       D4A1                     COPY7:
00073D D4A1 3A31D5          13      LD  A,(DTA_CCP+13)  ;(FCB)属性
000740 D4A4 3221EF          13      LD  (FDRV+13),A
000743 D4A7 2138D5          10      LD  HL,DTA_CCP+20   ;(FCB)タイムスタンプ
000746 D4AA 1128EF          10      LD  DE,FDRV+20
000749 D4AD 010400          10      LD  BC,4
00074C D4B0 EDB0                    LDIR
                                
00074E D4B2 1114EF          10      LD  DE,FDRV
000751 D4B5 0E10             7      LD  C,010H      ;(BDOS)ファイルのクローズ
000753 D4B7 CDD1D0          17      CALL    SYSTEM0
000756 D4BA 2006            12      JR  NZ,COPYE
                                
000758 D4BC 1171EF          10      LD  DE,OK
00075B D4BF C319D4          10      JP  COPY8
                                
       D4C2                     COPYE:
00075E D4C2 1114EF          10      LD  DE,FDRV
000761 D4C5 0E13             7      LD  C,013H      ;(BDOS)ファイルの削除
000763 D4C7 CD0500          17      CALL    SYSTEM
       D4CA                     COPYE2:
000766 D4CA 37               4      SCF
000767 D4CB C9              10      RET
                                
       D4CC                     CTIME:
000768 D4CC ED5B38D5        20      LD  DE,(DTA_CCP+20)
00076C D4D0 2A28EF          16      LD  HL,(FDRV+20)
00076F D4D3 A7               4      AND A
000770 D4D4 ED52            15      SBC HL,DE
000772 D4D6 C0              11      RET NZ
000773 D4D7 ED5B3AD5        20      LD  DE,(DTA_CCP+22)
000777 D4DB 2A2AEF          16      LD  HL,(FDRV+22)
00077A D4DE ED52            15      SBC HL,DE
00077C D4E0 C9              10      RET
                                
       D4E1                     C_TYPE:
00077D D4E1 CD88D3          17      CALL    SETFCB
000780 D4E4 215C00          10      LD  HL,FCB1
000783 D4E7 CDA3D0          17      CALL    OPEN
000786 D4EA 37               4      SCF
       D4EB                     TYPE1:
000787 D4EB C0              11      RET NZ
000788 D4EC CDB6D0          17      CALL    DEFCB
00078B D4EF 3E06             7      LD  A,6
00078D D4F1 CD10D9          17      CALL    MSG_A
       D4F4                     TYPE2:
000790 D4F4 CDDAD0          17      CALL    S27BUF
000793 D4F7 C6FE             7      ADD A,0FEH
000795 D4F9 D8              11      RET C
000796 D4FA 7C               4      LD  A,H
000797 D4FB B5               4      OR  L
000798 D4FC 2813            12      JR  Z,TYPEE
00079A D4FE 010001          10      LD  BC,00100H
       D501                     TYPE3:
00079D D501 0A               7      LD  A,(BC)
00079E D502 03               6      INC BC
00079F D503 FE1A             7      CP  01AH
0007A1 D505 280A            12      JR  Z,TYPEE
0007A3 D507 CD10D9          17      CALL    MSG_A
0007A6 D50A 2B               6      DEC HL
0007A7 D50B 7C               4      LD  A,H
0007A8 D50C B5               4      OR  L
0007A9 D50D 20F2            12      JR  NZ,TYPE3
0007AB D50F 18E3            12      JR  TYPE2
       D511                     TYPEE:
0007AD D511 CDB2D0          17      CALL    OPEN2
0007B0 D514 18D5            12      JR  TYPE1
                                
       D516                     CWILD:
0007B2 D516 215D00          10      LD  HL,FCB1+1
       D519                     CWILD1:
0007B5 D519 7E               7      LD  A,(HL)
0007B6 D51A FE20             7      CP  020H
0007B8 D51C C0              11      RET NZ
       D51D                     CWILD2:
0007B9 D51D 3E3F             7      LD  A,'?'
0007BB D51F 060B             7      LD  B,11
0007BD D521 C304DE          10      JP  FILL_MEMORY
                                
       D524                     DTA_CCP:
0007C0 D524                         DS  37
                                
       0040                     PATHX   EQU 64
0007E5 D549                     PATHD:  DS  PATHX
000825 D589 00                  PATHE:  DB  0
                                
000826 D58A 2062797465732066    FREE:   DB  " bytes free",9,'$'
            7265650924          
000833 D597 20202020203C4449    DIRMES: DB  "     <DIR>$"
            523E24              
00083E D5A2 20203A24            DIRHD:  DB  "  :$"
                                
       D5A6                     COMTB:
000842 D5A6 44202020                DB  "D   "  ;1
000846 D5AA DFD1                    DW  C_DIR
000848 D5AC 44495220                DB  "DIR "  ;2
00084C D5B0 DFD1                    DW  C_DIR
00084E D5B2 434F5059                DB  "COPY"  ;3
000852 D5B6 C3D3                    DW  C_COPY
000854 D5B8 43442020                DB  "CD  "  ;4
000858 D5BC D6D0                    DW  C_CD
00085A D5BE 44454C20                DB  "DEL "  ;5
00085E D5C2 C2D1                    DW  C_DEL
000860 D5C4 50415448                DB  "PATH"  ;6
000864 D5C8 84D2                    DW  C_PATH
000866 D5CA 52454E20                DB  "REN "  ;7
00086A D5CE CCD1                    DW  C_REN
00086C D5D0 54595045                DB  "TYPE"  ;8
000870 D5D4 E1D4                    DW  C_TYPE
000872 D5D6 52454D20                DB  "REM "  ;9
000876 D5DA C0D1                    DW  C_REM
[EOF:LDCCP.ASM:SHIFT_JIS]
                                    INCLUDE "M7CCP2.ASM"
                                
                                ;   LSX-Dodgers CCP2
                                ;   MZ-700/1500
                                
000878 D5DC 4D4F4E20                DB  "MON "  ;10
00087C D5E0 B3CF                    DW  C_MON
[EOF:M7CCP2.ASM:UTF_8]
                                    INCLUDE "LDOS.ASM"
                                
                                ;   LSX-Dodgers OS
                                
       D5E2                     BDOS0:
00087E D5E2 E5              11      PUSH    HL
00087F D5E3 210001          10      LD  HL,00100H
000882 D5E6 39              11      ADD HL,SP
000883 D5E7 3810            12      JR  C,BDOS1X
       D5E9                     BDOS2:
000885 D5E9 E1              10      POP HL
000886 D5EA ED73F5D5        20      LD  (BDSP+1),SP
00088A D5EE 31FECF          10      LD  SP,EXTSP
00088D D5F1 CDF8D5          17      CALL    BDOS1
000890 D5F4 310000          10  BDSP:   LD  SP,0
000893 D5F7 C9              10      RET
       D5F8                     BDOS1:
000894 D5F8 E5              11      PUSH    HL
       D5F9                     BDOS1X:
000895 D5F9 79               4      LD  A,C
000896 D5FA FE3C             7      CP  03CH
000898 D5FC 3802            12      JR  C,DOS1
00089A D5FE 3E3C             7      LD  A,03CH
       D600                     DOS1:
00089C D600 87               4      ADD A,A
00089D D601 6F               4      LD  L,A
00089E D602 26F0             7      LD  H,STABLE/256
0008A0 D604 7E               7      LD  A,(HL)
0008A1 D605 2C               4      INC L
0008A2 D606 66               7      LD  H,(HL)
0008A3 D607 6F               4      LD  L,A
0008A4 D608 E3              19      EX  (SP),HL
0008A5 D609 79               4      LD  A,C
0008A6 D60A C9              10      RET
       D60B                     _DOS2:
0008A7 D60B FE5A             7      CP  05AH        ;(BDOS)カレントディレクトリの変更(_CHDIR)
0008A9 D60D CAD1D8          10      JP  Z,_SYS5A
0008AC D610 FE5C             7      CP  05CH        ;(BDOS)ファイル名の解析(_PFILE)
0008AE D612 CA8DD8          10      JP  Z,_SYS5C
0008B1 D615 FE5F             7      CP  05FH        ;(BDOS)ディスクバッファのフラッシュ(_FLUSH)
0008B3 D617 CABFE9          10      JP  Z,_SYS5F
0008B6 D61A FE6F             7      CP  06FH        ;(BDOS)MSX-DOS のバージョン番号の獲得(_DOSVER)
0008B8 D61C 200A            12      JR  NZ,_ERROR
0008BA D61E 011D01          10      LD  BC,011DH
0008BD D621 114501          10      LD  DE,VER
0008C0 D624 210100          10      LD  HL,MACD
0008C3 D627 AF               4      XOR A
       D628                     _ERROR:
0008C4 D628 A7               4      AND A
0008C5 D629 C9              10      RET
                                
       D62A                     _SYS09:     ;文字列出力
0008C6 D62A D5              11      PUSH    DE
       D62B                     _SX09:
0008C7 D62B 1A               7      LD  A,(DE)
0008C8 D62C 13               6      INC DE
0008C9 D62D FE24             7      CP  '$'
0008CB D62F 2831            12      JR  Z,SX0E2
0008CD D631 CD10D9          17      CALL    MSG_A
0008D0 D634 18F5            12      JR  _SX09
                                
       D636                     MSX1:
0008D2 D636 CD10D9          17      CALL    MSG_A
       D639                     MSX:
0008D5 D639 7E               7      LD  A,(HL)
0008D6 D63A 23               6      INC HL
0008D7 D63B B7               4      OR  A
0008D8 D63C 20F8            12      JR  NZ,MSX1
0008DA D63E C9              10      RET
                                
       D63F                     _SYS0C:     ;(BDOS)バージョン番号の獲得
0008DB D63F 212200          10      LD  HL,00022H
0008DE D642 7D               4      LD  A,L
0008DF D643 C9              10      RET
                                
       D644                     _SYS0D:     ;(BDOS)ディスクリセット
0008E0 D644 CDDFEF          17      CALL    _FFLUSH
0008E3 D647 E5              11      PUSH    HL
0008E4 D648 218000          10      LD  HL,00080H
0008E7 D64B 228AEF          16      LD  (_DTA),HL
0008EA D64E E1              10      POP HL
0008EB D64F D5              11      PUSH    DE
0008EC D650 1E00             7      LD  E,0
0008EE D652 3E                      DB  03EH
                                
       D653                     _SYS0E:     ;(BDOS)カレントドライブの設定
0008EF D653 D5              11      PUSH    DE
0008F0 D654 7B               4      LD  A,E
0008F1 D655 DDE5            15      PUSH    IX
0008F3 D657 CDDCEF          17      CALL    _GETDPB
0008F6 D65A DDE1            14      POP IX
0008F8 D65C 3804            12      JR  C,SX0E2
0008FA D65E 7B               4      LD  A,E
0008FB D65F 3287EF          13      LD  (_DVSW),A
       D662                     SX0E2:
0008FE D662 3E08             7      LD  A,8
000900 D664 D1              10      POP DE
000901 D665 C9              10      RET
                                
       D666                     _SYS0F:     ;(BDOS)ファイルのオープン
000902 D666 CD41DE          17      CALL    SETDRV
000905 D669 FD7E1C          19      LD  A,(IY+28)   ;(FCB)オープンモード
000908 D66C C602             7      ADD A,002H      ;Write
00090A D66E 2848            12      JR  Z,FEND0F
00090C D670 CD8FE1          17      CALL    CHKWILDX
                                
00090F D673 D461DE          17      CALL    NC,SOPENX
       D676                     _S16XX:
000912 D676 3840            12      JR  C,FEND0F
                                                ;Directory location
000914 D678 3A9FEF          13      LD  A,(_FILEN)
000917 D67B FD7719          19      LD  (IY+25),A   ;(FCB)ディレクトリロケーション
                                ;               _DIRF
00091A D67E 3AA0EF          13      LD  A,(_DIRF)
00091D D681 FD771D          19      LD  (IY+29),A   ;(FCB)ディレクトリモード
                                ;               _FBPS
000920 D684 FD731E          19      LD  (IY+30),E   ;(FCB)ディレクトリポジション
000923 D687 FD721F          19      LD  (IY+31),D
                                ;               Open(Read)
000926 D68A FD361CFF        19      LD  (IY+28),0FFH    ;(FCB)オープンモード
                                ;               FILENAME
00092A D68E FDE5            15      PUSH    IY
00092C D690 D1              10      POP DE
00092D D691 13               6      INC DE
00092E D692 010B00          10      LD  BC,11
000931 D695 EDB0                    LDIR
                                ;               Attribute
000933 D697 7E               7      LD  A,(HL)
000934 D698 FD770D          19      LD  (IY+13),A   ;(FCB)属性(アトリビュート)
000937 D69B 110B00          10      LD  DE,11       ;Reserved
00093A D69E 19              11      ADD HL,DE
                                                    ;(FCB)ファイルを最後に変更した時刻
00093B D69F 11EAF0          10      LD  DE,SDDATA       ;(FCB)ファイルを最後に変更した日付
00093E D6A2 060A             7      LD  B,SDDATAE-SDDATA    ;(FCB)ファイルの先頭クラスタ
       D6A4                     S16LOOP:                ;(FCB)ファイルのサイズ(バイト単位)
000940 D6A4 1A               7      LD  A,(DE)
000941 D6A5 13               6      INC DE
000942 D6A6 32ADD6          13      LD  (S16PAT+2),A
000945 D6A9 7E               7      LD  A,(HL)
000946 D6AA 23               6      INC HL
000947 D6AB FD7700          19  S16PAT: LD  (IY+0),A
00094A D6AE 10F4            13      DJNZ    S16LOOP
                                
00094C D6B0 AF               4      XOR A
00094D D6B1 FD770C          19      LD  (IY+12),A   ;(FCB)カレントブロック
000950 D6B4 FD225CD7        20      LD  (OFCB+1),IY
       D6B8                     FEND0F:
000954 D6B8 1845            12      JR  FEND10
                                
       D6BA                     _SYS10:     ;(BDOS)ファイルのクローズ
000956 D6BA CD41DE          17      CALL    SETDRV
000959 D6BD FD7E1C          19      LD  A,(IY+28)   ;(FCB)オープンモード
00095C D6C0 D6FE             7      SUB 0FEH
00095E D6C2 37               4      SCF
00095F D6C3 3F               4      CCF
000960 D6C4 2039            12      JR  NZ,FEND10
       D6C6                     _S10A:              ;Write
000962 D6C6 FD770E          19      LD  (IY+14),A   ;(FCB)レコードサイズ/アクセスするディレクトリのクラスタ番号+1
000965 D6C9 FD770F          19      LD  (IY+15),A
                                
000968 D6CC FD341C          23      INC (IY+28)     ;0FEH->0FFH ;オープンモード
00096B D6CF CD7DE2          17      CALL    SETTMS
                                
00096E D6D2 FD7E1D          19      LD  A,(IY+29)   ;(FCB)ディレクトリモード
000971 D6D5 32A0EF          13      LD  (_DIRF),A
000974 D6D8 E67F             7      AND 07FH
000976 D6DA 32ECE6          13      LD  (_SECPS+1),A
000979 D6DD FD5E1E          19      LD  E,(IY+30)   ;(FCB)ディレクトリポジション
00097C D6E0 FD561F          19      LD  D,(IY+31)
00097F D6E3 CD95DF          17      CALL    READ_DIR
000982 D6E6 3817            12      JR  C,FEND10
                                
000984 D6E8 3ABFDE          13  SDECM1: LD  A,(SDECPAT+1)   ;1セクタ辺りのディレクトリエントリ数
000987 D6EB 3D               4      DEC A       ;1024=01FH / 512=00FH / 256=7
000988 D6EC FDA619          19      AND (IY+25)     ;(FCB)ディレクトリロケーション
00098B D6EF 6F               4      LD  L,A
00098C D6F0 2600             7      LD  H,0
00098E D6F2 29              11      ADD HL,HL       ;*2
00098F D6F3 29              11      ADD HL,HL       ;*4
000990 D6F4 29              11      ADD HL,HL       ;*8
000991 D6F5 29              11      ADD HL,HL       ;*16
000992 D6F6 29              11      ADD HL,HL       ;*32
000993 D6F7 ED4B7EF0        20      LD  BC,(_DTBUF)
000997 D6FB 09              11      ADD HL,BC
                                
000998 D6FC CD9FE1          17      CALL    SDIRENT
       D6FF                     FEND10:
00099B D6FF 1842            12      JR  FEND
                                
       D701                     _SYS11:     ;(BDOS)最初のファイルの検索
00099D D701 CD41DE          17      CALL    SETDRV
0009A0 D704 CD8EDE          17      CALL    SOPEN
       D707                     _S12X1:
0009A3 D707 383A            12      JR  C,FEND
0009A5 D709 CD2EDF          17      CALL    SOPENE2
0009A8 D70C ED5B8AEF        20      LD  DE,(_DTA)
0009AC D710 3A88EF          13      LD  A,(_DRV)
0009AF D713 3C               4      INC A
0009B0 D714 12               7      LD  (DE),A
0009B1 D715 D5              11      PUSH    DE
0009B2 D716 13               6      INC DE
0009B3 D717 012000          10      LD  BC,32
0009B6 D71A EDB0                    LDIR
0009B8 D71C FD6E0E          19      LD  L,(IY+14)   ;(FCB)レコードサイズ/アクセスするディレクトリのクラスタ番号+1
0009BB D71F FD660F          19      LD  H,(IY+15)
0009BE D722 22F4F0          16      LD  (SCDIR),HL
0009C1 D725 2A9AEF          16      LD  HL,(_FBPS)
0009C4 D728 22F6F0          16      LD  (SFBPS),HL
0009C7 D72B 2A9FEF          16      LD  HL,(_FILEN)
0009CA D72E 7C               4      LD  A,H
0009CB D72F B7               4      OR  A
0009CC D730 2806            12      JR  Z,_S12DIR
0009CE D732 3AECE6          13      LD  A,(_SECPS+1)
0009D1 D735 F680             7      OR  080H
0009D3 D737 67               4      LD  H,A
       D738                     _S12DIR:
0009D4 D738 22F8F0          16      LD  (SFNDF),HL  ;Directory position and Flags
0009D7 D73B E1              10      POP HL
0009D8 D73C 1139EF          10      LD  DE,SFILE
0009DB D73F 0E21             7      LD  C,33
       D741                     _S11B:
0009DD D741 EDB0                    LDIR
       D743                     FEND:
0009DF D743 9F               4      SBC A,A     ;CF=0 A=0 : CF=1 A=0FFH
       D744                     FENDE:
0009E0 D744 FDE1            14      POP IY
0009E2 D746 C1              10      POP BC
0009E3 D747 D1              10      POP DE
0009E4 D748 E1              10      POP HL
0009E5 D749 C9              10      RET
                                
       D74A                     _SYS12:     ;(BDOS)次のファイルの検索
0009E6 D74A E5              11      PUSH    HL
0009E7 D74B D5              11      PUSH    DE
0009E8 D74C C5              11      PUSH    BC
0009E9 D74D FDE5            15      PUSH    IY
0009EB D74F CDF2DE          17      CALL    NOPEN
0009EE D752 18B3            12      JR  _S12X1
                                
       D754                     _S16K:
0009F0 D754 FD7E1C          19      LD  A,(IY+28)   ;(FCB)オープンモード
0009F3 D757 FEFD             7      CP  0FDH        ;Device(0FDH)
0009F5 D759 37               4      SCF
0009F6 D75A C8              11      RET Z
                                
0009F7 D75B 110000          10  OFCB:   LD  DE,0
0009FA D75E D5              11      PUSH    DE
0009FB D75F 061A             7      LD  B,26        ;First cluster
       D761                     S16K1:
0009FD D761 13               6      INC DE
0009FE D762 23               6      INC HL
0009FF D763 10FC            13      DJNZ    S16K1
                                
000A01 D765 1A               7      LD  A,(DE)
000A02 D766 BE               7      CP  (HL)
000A03 D767 2013            12      JR  NZ,S16K2
000A05 D769 13               6      INC DE
000A06 D76A 23               6      INC HL
000A07 D76B 1A               7      LD  A,(DE)
000A08 D76C BE               7      CP  (HL)
000A09 D76D 200D            12      JR  NZ,S16K2
                                
000A0B D76F E1              10      POP HL
000A0C D770 FDE5            15      PUSH    IY
000A0E D772 D1              10      POP DE
000A0F D773 1A               7      LD  A,(DE)      ;Drive
000A10 D774 BE               7      CP  (HL)
000A11 D775 2006            12      JR  NZ,S16K3
                                                ;ここはCFが必ず0
000A13 D777 ED52            15      SBC HL,DE       ;CP HL,DE
000A15 D779 37               4      SCF
000A16 D77A C0              11      RET NZ
000A17 D77B E5              11      PUSH    HL
       D77C                     S16K2:
000A18 D77C E1              10      POP HL
       D77D                     S16K3:
000A19 D77D FDE5            15      PUSH    IY
000A1B D77F D1              10      POP DE
       D780                     _SYS13:     ;(BDOS)ファイルの削除
000A1C D780 CD41DE          17      CALL    SETDRV
000A1F D783 CDBFE0          17      CALL    KILL
       D786                     FEND13:
000A22 D786 18BB            12      JR  FEND
                                
       D788                     _SYS14:     ;(BDOS)シーケンシャルな読み出し
000A24 D788 CD41DE          17      CALL    SETDRV
000A27 D78B CDAFE2          17      CALL    PUSHRR
000A2A D78E CDF0E2          17      CALL    GETSEQ
                                
000A2D D791 CD04E3          17      CALL    RB_READ
000A30 D794 E5              11      PUSH    HL
000A31 D795 CDC3E2          17      CALL    SETSEQ
       D798                     SREAD:
000A34 D798 E1              10      POP HL
                                
000A35 D799 C601             7      ADD A,001H
000A37 D79B 38A6            12      JR  C,FEND
                                
000A39 D79D 7D               4      LD  A,L
000A3A D79E D601             7      SUB 001H
       D7A0                     FENDX:
000A3C D7A0 9F               4      SBC A,A
000A3D D7A1 E603             7      AND 3
000A3F D7A3 1F               4      RRA
000A40 D7A4 189E            12      JR  FENDE
                                
       D7A6                     _SYS15:     ;(BDOS)シーケンシャルな書き込み
000A42 D7A6 CD41DE          17      CALL    SETDRV
000A45 D7A9 CDAFE2          17      CALL    PUSHRR
000A48 D7AC CDF0E2          17      CALL    GETSEQ
                                
000A4B D7AF CDFDE2          17      CALL    RB_WRITE
000A4E D7B2 E5              11      PUSH    HL
000A4F D7B3 CDC3E2          17      CALL    SETSEQ
       D7B6                     SWRITE:
000A52 D7B6 E1              10      POP HL
                                
000A53 D7B7 C6FF             7      ADD A,0FFH
000A55 D7B9 18E5            12      JR  FENDX
                                
       D7BB                     _SYS17:     ;(BDOS)ファイル名の変更
000A57 D7BB CD41DE          17      CALL    SETDRV
000A5A D7BE CD15E1          17      CALL    NAME
000A5D D7C1 18C3            12      JR  FEND13
                                
       D7C3                     _SYS16:     ;(BDOS)ファイルの作成
000A5F D7C3 CD41DE          17      CALL    SETDRV
                                
000A62 D7C6 CD8FE1          17      CALL    CHKWILDX
000A65 D7C9 38BB            12      JR  C,FEND13
000A67 D7CB FD7E01          19      LD  A,(IY+1)    ;(FCB)主ファイル名
000A6A D7CE FE05             7      CP  5
000A6C D7D0 2805            12      JR  Z,_S16X2
000A6E D7D2 FE21             7      CP  021H
000A70 D7D4 DA86D7          10      JP  C,FEND13
       D7D7                     _S16X2:
                                ;               Clear FCB
000A73 D7D7 FDE5            15      PUSH    IY
000A75 D7D9 E1              10      POP HL
000A76 D7DA 011000          10      LD  BC,16
000A79 D7DD 09              11      ADD HL,BC
       D7DE                     _S16X1:
000A7A D7DE 70               7      LD  (HL),B      ;B=0
000A7B D7DF 23               6      INC HL
000A7C D7E0 0D               4      DEC C
000A7D D7E1 20FB            12      JR  NZ,_S16X1
                                
000A7F D7E3 CD82E2          17      CALL    SETTMSX
000A82 D7E6 FD360DFF        19      LD  (IY+13),0FFH    ;(FCB)Attribute
000A86 D7EA CD61DE          17      CALL    SOPENX
000A89 D7ED 3F               4      CCF
000A8A D7EE CC54D7          17      CALL    Z,_S16K
000A8D D7F1 D43FDF          17      CALL    NC,COPEN
000A90 D7F4 D49FE1          17      CALL    NC,SDIRENT
000A93 D7F7 C376D6          10      JP  _S16XX
                                
       D7FA                     _SYS21:     ;(BDOS)ランダムな読み出し
                                
000A96 D7FA CD41DE          17      CALL    SETDRV
000A99 D7FD CDAFE2          17      CALL    PUSHRR
000A9C D800 FD6E21          19      LD  L,(IY+33)   ;(FCB)Random record
000A9F D803 FD6622          19      LD  H,(IY+34)
                                
000AA2 D806 CD04E3          17      CALL    RB_READ
000AA5 D809 E5              11      PUSH    HL
000AA6 D80A CDDAE2          17      CALL    POPRR
000AA9 D80D 1889            12      JR  SREAD
                                
       D80F                     _SYS22:     ;(BDOS)ランダムな書き込み
       D80F                     _SYS28:     ;(BDOS)ランダムな書き込み・その2
000AAB D80F CD41DE          17      CALL    SETDRV
000AAE D812 CDAFE2          17      CALL    PUSHRR
000AB1 D815 FD6E21          19      LD  L,(IY+33)   ;(FCB)Random record
000AB4 D818 FD6622          19      LD  H,(IY+34)
                                
000AB7 D81B CDFDE2          17      CALL    RB_WRITE
000ABA D81E E5              11      PUSH    HL
000ABB D81F CDDAE2          17      CALL    POPRR
000ABE D822 1892            12      JR  SWRITE
                                
       D824                     _SYS18:     ;(BDOS)ログインベクトルの獲得
000AC0 D824 21FF00          10      LD  HL,000FFH
000AC3 D827 AF               4      XOR A
000AC4 D828 C9              10      RET
                                
       D829                     _SYS19:     ;(BDOS)カレントドライブ番号の獲得
000AC5 D829 3A87EF          13      LD  A,(_DVSW)
000AC8 D82C A7               4      AND A
000AC9 D82D C9              10      RET
                                
       D82E                     _SYS1A:     ;(BDOS)DTAの設定
000ACA D82E ED538AEF        20      LD  (_DTA),DE
000ACE D832 AF               4      XOR A
000ACF D833 C9              10      RET
                                
       D834                     _SYS1B:     ;(BDOS)ディスク情報の獲得
000AD0 D834 7B               4      LD  A,E
000AD1 D835 CD54DE          17      CALL    GETDRV
000AD4 D838 CDDCEF          17      CALL    _GETDPB
000AD7 D83B D4E2EF          17      CALL    NC,_RDFATX
000ADA D83E 210000          10      LD  HL,0
000ADD D841 D45BE2          17      CALL    NC,DSKF
                                
000AE0 D844 ED5B5CE2        20      LD  DE,(MAXCLP+1)   ;DPB_08_MAXCL-1
000AE4 D848 1B               6      DEC DE      ;DE←クラスタの総数
000AE5 D849 FD2A7CF0        20      LD  IY,(_FATBF) ;IY←メモリ上のFATの先頭アドレス
000AE9 D84D 9F               4      SBC A,A
000AEA D84E D8              11      RET C
000AEB D84F 4F               4      LD  C,A     ;C=0
000AEC D850 DD7E0F          19      LD  A,(IX+00FH) ;DPB_0F_BPS
000AEF D853 E60F             7      AND 00FH
000AF1 D855 47               4      LD  B,A
000AF2 D856 DD7E07          19      LD  A,(IX+7)    ;DPB_07_SECPCL
000AF5 D859 C9              10      RET
                                
       D85A                     _SYS1D:     ;(BDOS)書き込みが禁止されているディスクの調査
000AF6 D85A AF               4      XOR A
000AF7 D85B 67               4      LD  H,A
000AF8 D85C 6F               4      LD  L,A
000AF9 D85D C9              10      RET
                                
       D85E                     _SYS1F:     ;(BDOS)ディスク装置のパラメータの読み出し
000AFA D85E 2100F1          10      LD  HL,DEVICE
000AFD D861 7B               4      LD  A,E
000AFE D862 C3DCEF          10      JP  _GETDPB
                                
       D865                     _SYS23:     ;(BDOS)ファイルサイズの獲得
000B01 D865 E5              11      PUSH    HL
000B02 D866 2A1EF0          16      LD  HL,(STABLE+2*00FH)  ;ファイルのオープン
000B05 D869 CD0F00          17      CALL    JP_HL
000B08 D86C 3814            12      JR  C,_S23X1
                                
000B0A D86E D5              11      PUSH    DE      ;EX DE,IY
000B0B D86F FDE3            23      EX  (SP),IY     ;
                                ;   POP DE      ;
                                ;   PUSH    DE      ;DEを破壊しないように注意vv
000B0D D871 CDE0E2          17      CALL    GETSIZE
       D874                     _S24X1:
000B10 D874 FD7521          19      LD  (IY+33),L   ;(FCB)Random record
000B13 D877 FD7422          19      LD  (IY+34),H
000B16 D87A FD362300        19      LD  (IY+35),0
                                ;   POP DE      ;^^^^^^^^^^^^^^^^^^^^^^^^
                                ;   PUSH    DE      ;EX DE,IY
000B1A D87E FDE3            23      EX  (SP),IY     ;
000B1C D880 D1              10      POP DE      ;
                                
000B1D D881 AF               4      XOR A
       D882                     _S23X1:
000B1E D882 E1              10      POP HL
000B1F D883 C9              10      RET
                                
       D884                     _SYS24:     ;(BDOS)ランダムレコードフィールドの設定
000B20 D884 E5              11      PUSH    HL
000B21 D885 D5              11      PUSH    DE      ;EX DE,IY
000B22 D886 FDE3            23      EX  (SP),IY     ;
                                ;   POP DE      ;
                                ;   PUSH    DE      ;DEを破壊しないように注意vv
000B24 D888 CDF0E2          17      CALL    GETSEQ
000B27 D88B 18E7            12      JR  _S24X1      ;^^^^^^^^^^^^^^^^^^^^^^^^
                                
       D88D                     _SYS5C:     ;(BDOS)ファイル名の解析
000B29 D88D C5              11      PUSH    BC
000B2A D88E E5              11      PUSH    HL
000B2B D88F CD58DD          17      CALL    FILE
000B2E D892 E1              10      POP HL
000B2F D893 C1              10      POP BC
       D894                     S29X1:
000B30 D894 C5              11      PUSH    BC
000B31 D895 D5              11      PUSH    DE
000B32 D896 E5              11      PUSH    HL
000B33 D897 EB               4      EX  DE,HL
000B34 D898 2114EF          10      LD  HL,FDRV
000B37 D89B 010D00          10      LD  BC,13
000B3A D89E EDB0                    LDIR
000B3C D8A0 70               7      LD  (HL),B      ;B=0
000B3D D8A1 0E03             7      LD  C,3
000B3F D8A3 EDB0                    LDIR
000B41 D8A5 E1              10      POP HL
000B42 D8A6 D1              10      POP DE
000B43 D8A7 C1              10      POP BC
000B44 D8A8 AF               4      XOR A
000B45 D8A9 C9              10      RET
                                
       D8AA                     _SYS30:     ;(BDOS)論理セクタを用いた書き込み
000B46 D8AA C5              11      PUSH    BC
000B47 D8AB 015AE8          10      LD  BC,DWT24B
000B4A D8AE 1804            12      JR  S2FX
       D8B0                     _SYS2F:
000B4C D8B0 C5              11      PUSH    BC
000B4D D8B1 014AE8          10      LD  BC,DRD24B
       D8B4                     S2FX:
000B50 D8B4 ED43CAD8        20      LD  (S2FPAT+1),BC
000B54 D8B8 CDDFEF          17      CALL    _FFLUSH
                                
000B57 D8BB D5              11      PUSH    DE
000B58 D8BC E5              11      PUSH    HL
000B59 D8BD 7D               4      LD  A,L     ;Drive
000B5A D8BE CDD9EF          17      CALL    _CHGDRV
000B5D D8C1 3809            12      JR  C,S30X2
000B5F D8C3 44               4      LD  B,H     ;Number of clusters
000B60 D8C4 2A8AEF          16      LD  HL,(_DTA)
                                
000B63 D8C7 0E00             7      LD  C,0
000B65 D8C9 CD4AE8          17  S2FPAT: CALL    DRD24B
       D8CC                     S30X2:
000B68 D8CC E1              10      POP HL
000B69 D8CD D1              10      POP DE
000B6A D8CE C1              10      POP BC
000B6B D8CF 9F               4      SBC A,A
000B6C D8D0 C9              10      RET
                                
       D8D1                     _SYS5A:     ;(BDOS)カレントディレクトリの変更
000B6D D8D1 C5              11      PUSH    BC
000B6E D8D2 D5              11      PUSH    DE
000B6F D8D3 E5              11      PUSH    HL
000B70 D8D4 CD4DDD          17      CALL    FILEC
000B73 D8D7 210000          10      LD  HL,0
000B76 D8DA 1114EF          10      LD  DE,FDRV
000B79 D8DD 2A4EF0          16      LD  HL,(STABLE+2*027H)  ;ランダムブロック読み込み
000B7C D8E0 CD0F00          17      CALL    JP_HL
000B7F D8E3 18E7            12      JR  S30X2
[EOF:LDOS.ASM:SHIFT_JIS]
                                    INCLUDE "M7IO.ASM"
                                
                                ;   LSX-Dodgers IO
                                ;   MZ-700/1500
                                
       D628                     _SYS04  EQU _ERROR      ;(BDOS)外部出力
       D628                     _SYS05  EQU _ERROR      ;(BDOS)プリンタ出力
       D628                     _SYS1C  EQU _ERROR      ;(BDOS)ディスクの書き込み禁止化
       D628                     _SYS1E  EQU _ERROR      ;(BDOS)ファイル属性の設定
       D628                     _SYS20  EQU _ERROR      ;(BDOS)利用者番号の設定と読み出し
       D628                     _SYS2E  EQU _ERROR      ;(BDOS)ベリファイ・フラグの設定
                                
       0000                     INT EQU 0
       0000                     INTCTCE EQU 0
       0000                     INTCTC2 EQU 0
                                
       D8E5                     KEYSET:
       D8E5                     KEYBS:
000B81 D8E5 B7               4      OR  A
000B82 D8E6 C8              11      RET Z
       D8E7                     KEYBS1:
000B83 D8E7 CDFDD8          17      CALL    KEYBC_IFBREAK
000B86 D8EA E5              11      PUSH    HL
000B87 D8EB F5              11      PUSH    AF
000B88 D8EC 2A90EF          16      LD  HL,(_KEYPS)
000B8B D8EF 2C               4      INC L
000B8C D8F0 7D               4      LD  A,L
000B8D D8F1 BC               4      CP  H
000B8E D8F2 2815            12      JR  Z,POP_AF_HL_SCF_RET
000B90 D8F4 3290EF          13      LD  (_KEYPS),A
000B93 D8F7 26FE             7      LD  H,KEYBF/256
000B95 D8F9 F1              10      POP AF
000B96 D8FA 77               7      LD  (HL),A
000B97 D8FB E1              10      POP HL
000B98 D8FC C9              10      RET
       D8FD                     KEYBC_IFBREAK:
000B99 D8FD FE03             7      CP  3
000B9B D8FF C0              11      RET NZ
       D900                     KEYBC:
000B9C D900 E5              11      PUSH    HL
000B9D D901 210000          10      LD  HL,0
000BA0 D904 2290EF          16      LD  (_KEYPS),HL
000BA3 D907 E1              10      POP HL
000BA4 D908 C9              10      RET
                                
       D909                     POP_AF_HL_SCF_RET:
000BA5 D909 F1              10      POP AF
000BA6 D90A E1              10      POP HL
000BA7 D90B 37               4      SCF
000BA8 D90C C9              10      RET
                                
       D90D                     _SYS01:     ;(BDOS)コンソール入力
000BA9 D90D CD09EF          17      CALL    _SYS07
       D910                     MSG_A:
000BAC D910 F5              11      PUSH    AF
000BAD D911 D5              11      PUSH    DE
000BAE D912 5F               4      LD  E,A
000BAF D913 CD19D9          17      CALL    _SYS02
000BB2 D916 D1              10      POP DE
000BB3 D917 F1              10      POP AF
000BB4 D918 C9              10      RET
                                
       D919                     _SYS02:     ;(BDOS)コンソール出力
000BB5 D919 CD2BD9          17      CALL    BREAK
000BB8 D91C 1805            12      JR  PRINTX
                                
       D91E                     _SYS06:     ;(BDOS)コンソール直接入出力
000BBA D91E 7B               4      LD  A,E
000BBB D91F 3C               4      INC A
000BBC D920 CACAEF          10      JP  Z,_INKEY
       D923                     PRINTX:
000BBF D923 C3CDEF          10      JP  _PRINT
                                
       D926                     _SYS08:     ;(BDOS)エコーなしコンソール入力
000BC2 D926 CD09EF          17      CALL    _SYS07
000BC5 D929 1803            12      JR  BREAK1
       D92B                     BREAK:
000BC7 D92B CDDFDC          17      CALL    CHKEY
       D92E                     BREAK1:
000BCA D92E FE03             7      CP  3       ;CTRL+C
000BCC D930 CA00EF          10      JP  Z,CPM_BOOT
000BCF D933 FE13             7      CP  013H        ;CTRL+S
000BD1 D935 C0              11      RET NZ
                                
       D936                     PAUSE:
000BD2 D936 CD00D9          17      CALL    KEYBC
                                
       D939                     FLGET:
000BD5 D939 CDDFEF          17      CALL    _FFLUSH
000BD8 D93C E5              11      PUSH    HL
000BD9 D93D 2A8EEF          16      LD  HL,(_TXADR)
000BDC D940 7C               4      LD  A,H
000BDD D941 C6D0             7      ADD A,0D0H
000BDF D943 67               4      LD  H,A
000BE0 D944 CD21CF          17      CALL    RDMMIO
000BE3 D947 325CD9          13      LD  (FLSMC),A
       D94A                     FLGET1:
000BE6 D94A CD19CF          17      CALL    RD556VSYNC
000BE9 D94D CB77             8      BIT 6,A
000BEB D94F 3EEF             7      LD  A,0EFH      ;カーソル
000BED D951 200A            12      JR  NZ,FLGET2
000BEF D953 3A92EF          13      LD  A,(_KEYD)
000BF2 D956 B7               4      OR  A
000BF3 D957 3EEF             7      LD  A,0EFH      ;カーソル
000BF5 D959 2002            12      JR  NZ,FLGET2
       D95C                     FLSMC   EQU $+1
000BF7 D95B 3E00             7      LD  A,0     ;自己書き換え
       D95D                     FLGET2:
000BF9 D95D CD27CF          17      CALL    WRMMIO
000BFC D960 CDCAEF          17      CALL    _INKEY
000BFF D963 28E5            12      JR  Z,FLGET1
000C01 D965 F5              11      PUSH    AF
000C02 D966 3A5CD9          13      LD  A,(FLSMC)
000C05 D969 CD27CF          17      CALL    WRMMIO
000C08 D96C F1              10      POP AF
000C09 D96D E1              10      POP HL
000C0A D96E C9              10      RET
                                
       D96F                     _SYS0A:     ;(BDOS)文字列入力
000C0B D96F C5              11      PUSH    BC
000C0C D970 E5              11      PUSH    HL
000C0D D971 D5              11      PUSH    DE
000C0E D972 CD0BDC          17      CALL    GETL
000C11 D975 1100FF          10      LD  DE,KBUF
000C14 D978 E1              10      POP HL
000C15 D979 E5              11      PUSH    HL
000C16 D97A 0E00             7      LD  C,0
000C18 D97C 3004            12      JR  NC,SAX0
000C1A D97E 23               6      INC HL
000C1B D97F 23               6      INC HL
000C1C D980 1808            12      JR  SAX4
       D982                     SAX0:
000C1E D982 46               7      LD  B,(HL)
000C1F D983 23               6      INC HL
       D984                     SAX1:
000C20 D984 23               6      INC HL
000C21 D985 1A               7      LD  A,(DE)
000C22 D986 13               6      INC DE
000C23 D987 B7               4      OR  A
000C24 D988 2004            12      JR  NZ,SAX2
       D98A                     SAX4:
000C26 D98A 360D            10      LD  (HL),00DH
000C28 D98C 1804            12      JR  SAX3
       D98E                     SAX2:
000C2A D98E 77               7      LD  (HL),A
000C2B D98F 0C               4      INC C
000C2C D990 10F2            13      DJNZ    SAX1
       D992                     SAX3:
000C2E D992 D1              10      POP DE
000C2F D993 79               4      LD  A,C
000C30 D994 13               6      INC DE
000C31 D995 12               7      LD  (DE),A
000C32 D996 1B               6      DEC DE
000C33 D997 E1              10      POP HL
000C34 D998 C1              10      POP BC
000C35 D999 A7               4      AND A
000C36 D99A C9              10      RET
                                
       D99B                     _SYS0B:     ;(BDOS)コンソール状態のチェック
000C37 D99B CD2BD9          17      CALL    BREAK
000C3A D99E 3A92EF          13      LD  A,(_KEYD)
000C3D D9A1 B7               4      OR  A
000C3E D9A2 C8              11      RET Z
       D9A3                     CONSTX:
000C3F D9A3 CDDFEF          17      CALL    _FFLUSH
000C42 D9A6 E5              11      PUSH    HL
000C43 D9A7 2A90EF          16      LD  HL,(_KEYPS)
000C46 D9AA 7C               4      LD  A,H
000C47 D9AB AD               4      XOR L
000C48 D9AC E1              10      POP HL
000C49 D9AD CCDFDC          17      CALL    Z,CHKEY
000C4C D9B0 C6FF             7      ADD A,0FFH
000C4E D9B2 9F               4      SBC A,A
000C4F D9B3 C9              10      RET
                                
       D9B4                     _SYS2A:     ;(BDOS)日付の獲得
000C50 D9B4 210000          10      LD  HL,0
000C53 D9B7 110000          10      LD  DE,0
000C56 D9BA AF               4      XOR A
000C57 D9BB C9              10      RET
                                
       D9BC                     _SYS2C:     ;(BDOS)時刻の獲得
000C58 D9BC 210000          10      LD  HL,0
000C5B D9BF 110000          10      LD  DE,0
000C5E D9C2 AF               4      XOR A
000C5F D9C3 C9              10      RET
                                
       D9C4                     ESC1:
000C60 D9C4 7B               4      LD  A,E
000C61 D9C5 FE41             7      CP  'A'
000C63 D9C7 CABCDA          10      JP  Z,CTRL1E
000C66 D9CA FE42             7      CP  'B'
000C68 D9CC CACEDB          10      JP  Z,CTRL1F
000C6B D9CF FE43             7      CP  'C'
000C6D D9D1 CA8FDA          10      JP  Z,CTRL1C
000C70 D9D4 FE44             7      CP  'D'
000C72 D9D6 CAB3DA          10      JP  Z,CTRL1D
000C75 D9D9 FE45             7      CP  'E'
000C77 D9DB 2802            12      JR  Z,CT0CX
000C79 D9DD FE6A             7      CP  'j'
       D9DF                     CT0CX:
000C7B D9DF CAB3DB          10      JP  Z,CTRL0C
000C7E D9E2 FE48             7      CP  'H'
000C80 D9E4 CA30DB          10      JP  Z,CTRL0B
000C83 D9E7 FE4A             7      CP  'J'
000C85 D9E9 CAB6DB          10      JP  Z,CTRL06
000C88 D9EC FE4B             7      CP  'K'
000C8A D9EE CA02DB          10      JP  Z,CTRL05
000C8D D9F1 FE4C             7      CP  'L'
000C8F D9F3 CAE0DB          10      JP  Z,CTRL0E
000C92 D9F6 FE54             7      CP  'T'
000C94 D9F8 CA02DB          10      JP  Z,CTRL05
000C97 D9FB FE78             7      CP  'x'
000C99 D9FD 2804            12      JR  Z,ESC1X
000C9B D9FF FE79             7      CP  'y'
000C9D DA01 2002            12      JR  NZ,ESC1Y
       DA03                     ESC1X:
000C9F DA03 3601            10      LD  (HL),1
       DA05                     ESC1Y:
000CA1 DA05 FE3D             7      CP  '='
000CA3 DA07 2804            12      JR  Z,ESC1W
000CA5 DA09 FE59             7      CP  'Y'
000CA7 DA0B 2002            12      JR  NZ,ESC1Z
       DA0D                     ESC1W:
000CA9 DA0D 3602            10      LD  (HL),2
       DA0F                     ESC1Z:
000CAB DA0F FE20             7      CP  020H
000CAD DA11 3802            12      JR  C,ESC1C
000CAF DA13 87               4      ADD A,A
000CB0 DA14 D0              11      RET NC
       DA15                     ESC1C:
000CB1 DA15 E1              10      POP HL
000CB2 DA16 1832            12      JR  ANK
                                
       DA18                     ESC:
000CB4 DA18 217BDA          10      LD  HL,PRINTE5
000CB7 DA1B E5              11      PUSH    HL
000CB8 DA1C 213EDA          10      LD  HL,ESCFLG
000CBB DA1F 3600            10      LD  (HL),0
000CBD DA21 3D               4      DEC A
000CBE DA22 28A0            12      JR  Z,ESC1
000CC0 DA24 3D               4      DEC A
000CC1 DA25 2009            12      JR  NZ,ESC2
000CC3 DA27 3603            10      LD  (HL),3
000CC5 DA29 7B               4      LD  A,E
000CC6 DA2A D620             7      SUB 020H
000CC8 DA2C 3233DA          13      LD  (ESCYP+1),A
000CCB DA2F C9              10      RET
       DA30                     ESC2:
000CCC DA30 3D               4      DEC A
000CCD DA31 C0              11      RET NZ
000CCE DA32 2600             7  ESCYP:  LD  H,0
000CD0 DA34 7B               4      LD  A,E
000CD1 DA35 D620             7      SUB 020H
000CD3 DA37 6F               4      LD  L,A
000CD4 DA38 C3D6EF          10      JP  _LOC
                                
       DA3B                     PRINT:
000CD7 DA3B C5              11      PUSH    BC
000CD8 DA3C E5              11      PUSH    HL
       DA3E                     ESCFLG  EQU $+1
000CD9 DA3D 3E00             7      LD  A,000H      ;自己書き換え
000CDB DA3F B7               4      OR  A
000CDC DA40 20D6            12      JR  NZ,ESC
                                
000CDE DA42 3E1F             7      LD  A,01FH
000CE0 DA44 BB               4      CP  E
000CE1 DA45 3038            12      JR  NC,CTRL
       DA47                     INSFLG  EQU $
000CE3 DA47 0188DB          10      LD  BC,INSERT   ;自己書き換え
       DA4A                     ANK:
000CE6 DA4A 3A96EF          13      LD  A,(_COLORF)
000CE9 DA4D 4F               4      LD  C,A
000CEA DA4E 7B               4      LD  A,E
000CEB DA4F FE61             7      CP  'a'     ;英小文字
000CED DA51 3806            12      JR  C,PRT1
000CEF DA53 FE7B             7      CP  'z'+1
000CF1 DA55 3002            12      JR  NC,PRT1
000CF3 DA57 CBF9             8      SET 7,C
       DA59                     PRT1:
000CF5 DA59 FE86             7      CP  $86     ;ひらがな1(を－そ)
000CF7 DA5B 3806            12      JR  C,PRT2
000CF9 DA5D FEA0             7      CP  $A0
000CFB DA5F 3002            12      JR  NC,PRT2
000CFD DA61 CBF9             8      SET 7,C
       DA63                     PRT2:
000CFF DA63 FEE0             7      CP  $E0     ;ひらがな2(たーん)
000D01 DA65 3802            12      JR  C,PRT3
000D03 DA67 CBF9             8      SET 7,C
       DA69                     PRT3:
000D05 DA69 2A8EEF          16      LD  HL,(_TXADR)
000D08 DA6C 7C               4      LD  A,H
000D09 DA6D C6D0             7      ADD A,0D0H
000D0B DA6F 67               4      LD  H,A
000D0C DA70 42               4      LD  B,D
000D0D DA71 16ED             7      LD  D,CD_TABLE/256
000D0F DA73 1A               7      LD  A,(DE)
000D10 DA74 50               4      LD  D,B
000D11 DA75 CD39CF          17      CALL    IO_PRINT
000D14 DA78 CD8FDA          17      CALL    CTRL1C
       DA7B                     PRINTE5:
000D17 DA7B E1              10      POP HL
000D18 DA7C C1              10      POP BC
000D19 DA7D AF               4      XOR A
000D1A DA7E C9              10      RET
                                
       DA7F                     CTRL:
000D1B DA7F 7B               4      LD  A,E
000D1C DA80 87               4      ADD A,A
000D1D DA81 F680             7      OR  080H
000D1F DA83 6F               4      LD  L,A
000D20 DA84 26F0             7      LD  H,CTRLTB/256
000D22 DA86 7E               7      LD  A,(HL)
000D23 DA87 2C               4      INC L
000D24 DA88 66               7      LD  H,(HL)
000D25 DA89 6F               4      LD  L,A
000D26 DA8A CD0F00          17      CALL    JP_HL
000D29 DA8D 18EC            12      JR  PRINTE5
                                
       DA8F                     CTRL1C:
000D2B DA8F ED4B8EEF        20      LD  BC,(_TXADR)
000D2F DA93 03               6      INC BC
       DA94                     PRINTE3:
000D30 DA94 2118FC          10      LD  HL,0-WIDTH*LINE
000D33 DA97 A7               4      AND A
000D34 DA98 ED4A            15      ADC HL,BC
       DA9A                     PRINTE8:
000D36 DA9A 2805            12      JR  Z,PRINT2
000D38 DA9C ED438EEF        20      LD  (_TXADR),BC
       DAA0                     CTRL00:
000D3C DAA0 C9              10      RET
                                
       DAA1                     PRINT2:
000D3D DAA1 CDE6DB          17      CALL    SCR
000D40 DAA4 21D8FF          10      LD  HL,0-WIDTH
000D43 DAA7 09              11      ADD HL,BC
       DAA8                     SET_TXADR_HL:
000D44 DAA8 228EEF          16      LD  (_TXADR),HL
000D47 DAAB C9              10      RET
                                
       DAAC                     CTRL08:
000D48 DAAC 3A47DA          13      LD  A,(INSFLG)
000D4B DAAF FECD             7      CP  0CDH        ;CALL ????
000D4D DAB1 2823            12      JR  Z,CTRL02
       DAB3                     CTRL1D:
000D4F DAB3 2A8EEF          16      LD  HL,(_TXADR)
000D52 DAB6 7C               4      LD  A,H
000D53 DAB7 B5               4      OR  L
000D54 DAB8 C8              11      RET Z
000D55 DAB9 2B               6      DEC HL
000D56 DABA 18EC            12      JR  SET_TXADR_HL
                                
       DABC                     CTRL1E:
000D58 DABC ED4B8EEF        20      LD  BC,(_TXADR)
000D5C DAC0 21D8FF          10      LD  HL,0-WIDTH
000D5F DAC3 09              11      ADD HL,BC
000D60 DAC4 D0              11      RET NC
000D61 DAC5 18E1            12      JR  SET_TXADR_HL
                                
       DAC7                     CTRL09:
000D63 DAC7 ED4B8EEF        20      LD  BC,(_TXADR)
000D67 DACB 79               4      LD  A,C
000D68 DACC E6F8             7      AND 0F8H
000D6A DACE C608             7      ADD A,8
000D6C DAD0 4F               4      LD  C,A
000D6D DAD1 88               4      ADC A,B
000D6E DAD2 91               4      SUB C
000D6F DAD3 47               4      LD  B,A
000D70 DAD4 18BE            12      JR  PRINTE3
                                
       DAD6                     CTRL02:
000D72 DAD6 CDB3DA          17      CALL    CTRL1D
000D75 DAD9 C8              11      RET Z
000D76 DADA D5              11      PUSH    DE
000D77 DADB CDD3EF          17      CALL    _POS
000D7A DADE 54               4      LD  D,H
000D7B DADF 3E28             7      LD  A,WIDTH
000D7D DAE1 95               4      SUB L
000D7E DAE2 4F               4      LD  C,A
000D7F DAE3 0D               4      DEC C
000D80 DAE4 06D0             7      LD  B,0D0H
000D82 DAE6 2A8EEF          16      LD  HL,(_TXADR)
000D85 DAE9 09              11      ADD HL,BC
000D86 DAEA 47               4      LD  B,A
                                
000D87 DAEB 3AA4DB          13      LD  A,(MULINE)
000D8A DAEE BA               4      CP  D
000D8B DAEF 2007            12      JR  NZ,C02X1
000D8D DAF1 112800          10      LD  DE,WIDTH
000D90 DAF4 19              11      ADD HL,DE
000D91 DAF5 78               4      LD  A,B
000D92 DAF6 83               4      ADD A,E
000D93 DAF7 47               4      LD  B,A
       DAF8                     C02X1:
000D94 DAF8 3A96EF          13      LD  A,(_COLORF) ;C:Color
000D97 DAFB 4F               4      LD  C,A
000D98 DAFC AF               4      XOR A       ;A:Text
000D99 DAFD CD78CF          17      CALL    IO_BS
000D9C DB00 D1              10      POP DE
000D9D DB01 C9              10      RET
                                
       DB02                     CTRL05:
000D9E DB02 CDD3EF          17      CALL    _POS
000DA1 DB05 3E28             7      LD  A,WIDTH
000DA3 DB07 95               4      SUB L
000DA4 DB08 47               4      LD  B,A
       DB09                     C08X1:
000DA5 DB09 2A8EEF          16      LD  HL,(_TXADR)
000DA8 DB0C 7C               4      LD  A,H
000DA9 DB0D C6D0             7      ADD A,0D0H
000DAB DB0F 67               4      LD  H,A
       DB10                     CLLINE:
000DAC DB10 3A96EF          13      LD  A,(_COLORF)
000DAF DB13 4F               4      LD  C,A
000DB0 DB14 AF               4      XOR A
000DB1 DB15 C35FCF          10      JP  IO_CLLINE
                                
       DB18                     CTRL0D:
000DB4 DB18 CDD3EF          17      CALL    _POS
000DB7 DB1B 2E00             7      LD  L,0
       DB1D                     LOC:
000DB9 DB1D C5              11      PUSH    BC
000DBA DB1E E5              11      PUSH    HL
000DBB DB1F CD3DDB          17      CALL    LOC1
000DBE DB22 228EEF          16      LD  (_TXADR),HL
000DC1 DB25 E1              10      POP HL
000DC2 DB26 C1              10      POP BC
000DC3 DB27 C9              10      RET
                                
       DB28                     CTRL12:
000DC4 DB28 2147DA          10      LD  HL,INSFLG
000DC7 DB2B 7E               7      LD  A,(HL)
000DC8 DB2C EECC             7      XOR 0CCH        ;CD:CALL ???? 1:LD BC,????
000DCA DB2E 77               7      LD  (HL),A
000DCB DB2F C9              10      RET
                                
       DB30                     CTRL0B:
000DCC DB30 210000          10      LD  HL,0
000DCF DB33 228EEF          16      LD  (_TXADR),HL
000DD2 DB36 C9              10      RET
                                
       DB37                     CTRL1B:
000DD3 DB37 3E01             7      LD  A,1
000DD5 DB39 323EDA          13      LD  (ESCFLG),A
000DD8 DB3C C9              10      RET
                                
       DB3D                     LOC1:
000DD9 DB3D D5              11      PUSH    DE
000DDA DB3E 4D               4      LD  C,L
000DDB DB3F 0608             7      LD  B,8
000DDD DB41 5C               4      LD  E,H
000DDE DB42 210028          10      LD  HL,WIDTH*256
000DE1 DB45 55               4      LD  D,L ;L=0
       DB46                     LOC2:
000DE2 DB46 29              11      ADD HL,HL
000DE3 DB47 3001            12      JR  NC,LOC3
000DE5 DB49 19              11      ADD HL,DE
       DB4A                     LOC3:
000DE6 DB4A 10FA            13      DJNZ    LOC2
000DE8 DB4C 09              11      ADD HL,BC
000DE9 DB4D D1              10      POP DE
000DEA DB4E C9              10      RET
                                
       DB4F                     CONOUT1:
                                ;   CALL    CURSOR
000DEB DB4F 59               4      LD  E,C
000DEC DB50 CDCDEF          17      CALL    _PRINT
000DEF DB53 7B               4      LD  A,E
000DF0 DB54 FE0A             7      CP  00AH
000DF2 DB56 2006            12      JR  NZ,CURSOR
000DF4 DB58 CD18DB          17      CALL    CTRL0D
000DF7 DB5B CD02DB          17      CALL    CTRL05
       DB5E                     CURSOR:
000DFA DB5E C9              10      RET
                                
       DB5F                     CTRL07:
000DFB DB5F 06E0             7      LD  B,0E0H
000DFD DB61 2162EF          10      LD  HL,BEEPD+1
       DB64                     C07X0:
000E00 DB64 4E               7      LD  C,(HL)
000E01 DB65 23               6      INC HL
000E02 DB66 7E               7      LD  A,(HL)
000E03 DB67 23               6      INC HL
000E04 DB68 CD33CF          17      CALL    WRMMIO_BC
000E07 DB6B 7D               4      LD  A,L
000E08 DB6C FE6A             7      CP  (BEEPD+1+M7BEEPE-M7BEEPD)&255
000E0A DB6E 20F4            12      JR  NZ,C07X0
000E0C DB70 0610             7      LD  B,16
       DB72                     C07X1:
000E0E DB72 CD19CF          17      CALL    RD556VSYNC
000E11 DB75 87               4      ADD A,A
000E12 DB76 30FA            12      JR  NC,C07X1
       DB78                     C07X2:
000E14 DB78 CD19CF          17      CALL    RD556VSYNC
000E17 DB7B 87               4      ADD A,A
000E18 DB7C 38FA            12      JR  C,C07X2
000E1A DB7E 10F2            13      DJNZ    C07X1
                                
000E1C DB80 AF               4      XOR A
000E1D DB81 2108E0          10      LD  HL,0E008H
000E20 DB84 CD27CF          17      CALL    WRMMIO
000E23 DB87 C9              10      RET
                                
       DB88                     INSERT:
000E24 DB88 D5              11      PUSH    DE
000E25 DB89 CDD3EF          17      CALL    _POS
000E28 DB8C 54               4      LD  D,H
000E29 DB8D 3E28             7      LD  A,WIDTH
000E2B DB8F 95               4      SUB L
000E2C DB90 47               4      LD  B,A
000E2D DB91 2A8EEF          16      LD  HL,(_TXADR)
000E30 DB94 7C               4      LD  A,H
000E31 DB95 C6D0             7      ADD A,0D0H
000E33 DB97 67               4      LD  H,A
000E34 DB98 3A96EF          13      LD  A,(_COLORF) ;C:Color
000E37 DB9B 4F               4      LD  C,A
000E38 DB9C AF               4      XOR A       ;A:Text
000E39 DB9D CD6DCF          17      CALL    IO_INS
000E3C DBA0 B7               4      OR  A
000E3D DBA1 2005            12      JR  NZ,INS1
       DBA4                     MULINE  EQU $+1
000E3F DBA3 3EFF             7      LD  A,-1
000E41 DBA5 92               4      SUB D
000E42 DBA6 2009            12      JR  NZ,INS2
       DBA8                     INS1:
000E44 DBA8 0628             7      LD  B,WIDTH
000E46 DBAA CD6DCF          17      CALL    IO_INS
000E49 DBAD 7A               4      LD  A,D
000E4A DBAE 32A4DB          13      LD  (MULINE),A
       DBB1                     INS2:
000E4D DBB1 D1              10      POP DE
000E4E DBB2 C9              10      RET
                                
       DBB3                     CTRL0C:
000E4F DBB3 CD30DB          17      CALL    CTRL0B
       DBB6                     CTRL06:
000E52 DBB6 D5              11      PUSH    DE
000E53 DBB7 E5              11      PUSH    HL
000E54 DBB8 ED5B8EEF        20      LD  DE,(_TXADR)
000E58 DBBC 3A96EF          13      LD  A,(_COLORF)
000E5B DBBF 324DCF          13      LD  (ICSMC),A
000E5E DBC2 C342CF          10      JP  IO_CLR
                                
       DBC5                     CTRL04:
000E61 DBC5 CDD3EF          17      CALL    _POS
000E64 DBC8 7D               4      LD  A,L
000E65 DBC9 B7               4      OR  A
000E66 DBCA C8              11      RET Z
       DBCB                     CTRL03:
000E67 DBCB CD18DB          17      CALL    CTRL0D
       DBCE                     CTRL0A:
       DBCE                     CTRL1F:
000E6A DBCE 2A8EEF          16      LD  HL,(_TXADR)
000E6D DBD1 012800          10      LD  BC,WIDTH
000E70 DBD4 09              11      ADD HL,BC
000E71 DBD5 44               4      LD  B,H
000E72 DBD6 4D               4      LD  C,L
000E73 DBD7 2118FC          10      LD  HL,0-WIDTH*LINE
000E76 DBDA 09              11      ADD HL,BC
000E77 DBDB 3F               4      CCF
000E78 DBDC 9F               4      SBC A,A
000E79 DBDD C39ADA          10      JP  PRINTE8
                                
       DBE0                     CTRL0E:
000E7C DBE0 CDD3EF          17      CALL    _POS
000E7F DBE3 7C               4      LD  A,H
000E80 DBE4 1804            12      JR  SCR1
       DBE6                     SCR:
000E82 DBE6 3A97EF          13      LD  A,(_LINE)
000E85 DBE9 3D               4      DEC A
       DBEA                     SCR1:
000E86 DBEA C5              11      PUSH    BC
000E87 DBEB D5              11      PUSH    DE
000E88 DBEC E5              11      PUSH    HL
000E89 DBED 1100D0          10      LD  DE,0D000H
000E8C DBF0 2128D0          10      LD  HL,0D000H+WIDTH
                                
000E8F DBF3 47               4      LD  B,A
000E90 DBF4 B7               4      OR  A
000E91 DBF5 C38ECF          10      JP  IO_SCRUP
                                
       DBF8                     POS:
000E94 DBF8 2A8EEF          16      LD  HL,(_TXADR)
000E97 DBFB C5              11      PUSH    BC
000E98 DBFC 01D8FF          10      LD  BC,0-WIDTH
000E9B DBFF AF               4      XOR A
       DC00                     POS1:
000E9C DC00 09              11      ADD HL,BC
000E9D DC01 3C               4      INC A
000E9E DC02 38FC            12      JR  C,POS1
000EA0 DC04 ED42            15      SBC HL,BC
000EA2 DC06 3D               4      DEC A
000EA3 DC07 67               4      LD  H,A
000EA4 DC08 C1              10      POP BC
000EA5 DC09 A7               4      AND A
000EA6 DC0A C9              10      RET
                                
       DC0B                     GETL:
000EA7 DC0B CDD3EF          17      CALL    _POS
000EAA DC0E E5              11      PUSH    HL
000EAB DC0F 3ECD             7      LD  A,0CDH      ;CALL ????
000EAD DC11 3247DA          13      LD  (INSFLG),A
       DC14                     GETL1:
000EB0 DC14 CD26D9          17      CALL    _SYS08
000EB3 DC17 FE09             7      CP  9
000EB5 DC19 2008            12      JR  NZ,GETL1V
000EB7 DC1B 2100FF          10      LD  HL,KBUF
000EBA DC1E CD39D6          17      CALL    MSX
000EBD DC21 18F1            12      JR  GETL1
       DC23                     GETL1V:
000EBF DC23 5F               4      LD  E,A
000EC0 DC24 CDD3EF          17      CALL    _POS
000EC3 DC27 CDCDEF          17      CALL    _PRINT
000EC6 DC2A 7B               4      LD  A,E
000EC7 DC2B FE20             7      CP  $20
000EC9 DC2D 3809            12      JR  C,GETL1V1
000ECB DC2F 7D               4      LD  A,L
000ECC DC30 FE27             7      CP  WIDTH-1
000ECE DC32 2004            12      JR  NZ,GETL1V1
000ED0 DC34 7C               4      LD  A,H
000ED1 DC35 32A4DB          13      LD  (MULINE),A
       DC38                     GETL1V1:
000ED4 DC38 7B               4      LD  A,E
000ED5 DC39 FE0D             7      CP  00DH
000ED7 DC3B 20D7            12      JR  NZ,GETL1
000ED9 DC3D 3E01             7      LD  A,1     ;LD BC,????
000EDB DC3F 3247DA          13      LD  (INSFLG),A
000EDE DC42 1100FF          10      LD  DE,KBUF
000EE1 DC45 0628             7      LD  B,WIDTH
000EE3 DC47 CDBDD3          17      CALL    ZERO_MEMORY_DE
                                
000EE6 DC4A D1              10      POP DE
000EE7 DC4B CDD3EF          17      CALL    _POS
000EEA DC4E 6B               4      LD  L,E
000EEB DC4F 3E28             7      LD  A,WIDTH
000EED DC51 95               4      SUB L
000EEE DC52 57               4      LD  D,A
                                
000EEF DC53 3AA4DB          13      LD  A,(MULINE)
000EF2 DC56 94               4      SUB H
000EF3 DC57 2806            12      JR  Z,GL2X
000EF5 DC59 3C               4      INC A
000EF6 DC5A 200C            12      JR  NZ,GL3X
000EF8 DC5C 25               4      DEC H
000EF9 DC5D 1805            12      JR  GL4X
       DC5F                     GL2X:
000EFB DC5F 3E1F             7      LD  A,$1F
000EFD DC61 CD10D9          17      CALL    MSG_A
       DC64                     GL4X:
000F00 DC64 7A               4      LD  A,D
000F01 DC65 C628             7      ADD A,WIDTH
000F03 DC67 57               4      LD  D,A
       DC68                     GL3X:
000F04 DC68 CD3DDB          17      CALL    LOC1
000F07 DC6B 4D               4      LD  C,L
000F08 DC6C 7C               4      LD  A,H
000F09 DC6D C6D0             7      ADD A,0D0H
000F0B DC6F 47               4      LD  B,A
000F0C DC70 5A               4      LD  E,D
000F0D DC71 2100FF          10      LD  HL,KBUF
       DC74                     GETL2:
000F10 DC74 CDD0EF          17      CALL    _SCRN
000F13 DC77 03               6      INC BC
000F14 DC78 77               7      LD  (HL),A
000F15 DC79 23               6      INC HL
000F16 DC7A 1D               4      DEC E
000F17 DC7B 20F7            12      JR  NZ,GETL2
       DC7D                     GETL3:
000F19 DC7D 2B               6      DEC HL
000F1A DC7E 7E               7      LD  A,(HL)
000F1B DC7F FE21             7      CP  021H
000F1D DC81 D0              11      RET NC
000F1E DC82 3600            10      LD  (HL),0
000F20 DC84 15               4      DEC D
000F21 DC85 20F6            12      JR  NZ,GETL3
000F23 DC87 C9              10      RET
                                
       DC88                     INKEYB:
000F24 DC88 C1              10      POP BC
000F25 DC89 CB47             8      BIT 0,A
000F27 DC8B 3E08             7      LD  A,8
000F29 DC8D 2016            12      JR  NZ,INKEYD
000F2B DC8F 3E03             7      LD  A,3
000F2D DC91 1812            12      JR  INKEYD
       DC93                     INKEY:
000F2F DC93 E5              11      PUSH    HL
000F30 DC94 2A90EF          16      LD  HL,(_KEYPS)
000F33 DC97 7C               4      LD  A,H
000F34 DC98 AD               4      XOR L
000F35 DC99 280F            12      JR  Z,GETKEY
000F37 DC9B 7C               4      LD  A,H
000F38 DC9C 3C               4      INC A
000F39 DC9D 3291EF          13      LD  (_KEYPS+1),A
000F3C DCA0 6F               4      LD  L,A
000F3D DCA1 26FE             7      LD  H,KEYBF/256
000F3F DCA3 7E               7      LD  A,(HL)
000F40 DCA4 E1              10      POP HL
       DCA5                     INKEYD:
000F41 DCA5 B7               4      OR  A
000F42 DCA6 3292EF          13      LD  (_KEYD),A
000F45 DCA9 C9              10      RET
       DCAA                     GETKEY:
000F46 DCAA 3A92EF          13      LD  A,(_KEYD)
000F49 DCAD B7               4      OR  A
000F4A DCAE 6F               4      LD  L,A
000F4B DCAF 2610             7  GKSMC:  LD  H,16
       DCB1                     GETKEY1:
000F4D DCB1 CDDFDC          17      CALL    CHKEY       ;キーを離すまで待つ
000F50 DCB4 281E            12      JR  Z,GETKEY2
000F52 DCB6 BD               4      CP  L
000F53 DCB7 201B            12      JR  NZ,GETKEY2
000F55 DCB9 CD19CF          17      CALL    RD556VSYNC
000F58 DCBC 87               4      ADD A,A
000F59 DCBD 30F2            12      JR  NC,GETKEY1
       DCBF                     GETKEY1X:
000F5B DCBF CDDFDC          17      CALL    CHKEY       ;キーを離すまで待つ
000F5E DCC2 2810            12      JR  Z,GETKEY2
000F60 DCC4 BD               4      CP  L
000F61 DCC5 200D            12      JR  NZ,GETKEY2
000F63 DCC7 CD19CF          17      CALL    RD556VSYNC
000F66 DCCA 87               4      ADD A,A
000F67 DCCB 38F2            12      JR  C,GETKEY1X
000F69 DCCD 25               4      DEC H
000F6A DCCE 20E1            12      JR  NZ,GETKEY1
000F6C DCD0 3E01             7      LD  A,1
000F6E DCD2 1802            12      JR  GETKEY3
       DCD4                     GETKEY2:
000F70 DCD4 3E10             7      LD  A,16
       DCD6                     GETKEY3:
000F72 DCD6 32B0DC          13      LD  (GKSMC+1),A
000F75 DCD9 3A92EF          13      LD  A,(_KEYD)
000F78 DCDC B7               4      OR  A
000F79 DCDD E1              10      POP HL
000F7A DCDE C0              11      RET NZ
       DCDF                     CHKEY:
000F7B DCDF C5              11      PUSH    BC
000F7C DCE0 3E08             7      LD  A,8
000F7E DCE2 CD0ECF          17      CALL    RDKEYDATA
000F81 DCE5 3293EF          13      LD  (_KEYD+1),A
000F84 DCE8 CB7F             8      BIT 7,A
000F86 DCEA 289C            12      JR  Z,INKEYB
000F88 DCEC E5              11      PUSH    HL
000F89 DCED 0E07             7      LD  C,7
000F8B DCEF 2140EC          10      LD  HL,KEY_TABLE
000F8E DCF2 CB47             8      BIT 0,A
000F90 DCF4 2003            12      JR  NZ,INKEY0
000F92 DCF6 2180EC          10      LD  HL,SHIFT_TABLE
       DCF9                     INKEY0:
000F95 DCF9 CB77             8      BIT 6,A
000F97 DCFB 2003            12      JR  NZ,INKEY1
000F99 DCFD 21C0EC          10      LD  HL,CTRL_TABLE
       DD00                     INKEY1:
000F9C DD00 79               4      LD  A,C
000F9D DD01 CD0ECF          17      CALL    RDKEYDATA
000FA0 DD04 0608             7      LD  B,8
       DD06                     INKEY2:
000FA2 DD06 87               4      ADD A,A
000FA3 DD07 3009            12      JR  NC,INKEY3
000FA5 DD09 23               6      INC HL
000FA6 DD0A 10FA            13      DJNZ    INKEY2
000FA8 DD0C 0D               4      DEC C
000FA9 DD0D 79               4      LD  A,C
000FAA DD0E 3C               4      INC A
000FAB DD0F 20EF            12      JR  NZ,INKEY1
000FAD DD11 06                      DB  $06     ;LD B,?? 次の1バイトを飛ばす
       DD12                     INKEY3:
000FAE DD12 7E               7      LD  A,(HL)
000FAF DD13 E1              10      POP HL
000FB0 DD14 C1              10      POP BC
000FB1 DD15 188E            12      JR  INKEYD
                                
       DD17                     SCRN:
000FB3 DD17 E5              11      PUSH    HL
000FB4 DD18 CD2DCF          17      CALL    RDMMIO_BC
000FB7 DD1B 6F               4      LD  L,A
000FB8 DD1C 26EE             7      LD  H,DC_TABLE/256
000FBA DD1E 7E               7      LD  A,(HL)
000FBB DD1F FE41             7      CP  'A'     ;英小文字チェック
000FBD DD21 380E            12      JR  C,SCRN1
000FBF DD23 FE5B             7      CP  'Z'+1
000FC1 DD25 DC33DD          17      CALL    C,SCRNC
000FC4 DD28 FEA6             7      CP  $A6     ;ひらがなチェック
000FC6 DD2A 3805            12      JR  C,SCRN1
000FC8 DD2C FEE0             7      CP  $E0
000FCA DD2E DC33DD          17      CALL    C,SCRNC
       DD31                     SCRN1:
000FCD DD31 E1              10      POP HL
000FCE DD32 C9              10      RET
                                
       DD33                     SCRNC:
000FCF DD33 6F               4      LD  L,A
000FD0 DD34 60               4      LD  H,B
000FD1 DD35 CBD8             8      SET 3,B
000FD3 DD37 CD2DCF          17      CALL    RDMMIO_BC
000FD6 DD3A 44               4      LD  B,H
000FD7 DD3B CB7F             8      BIT 7,A
000FD9 DD3D 7D               4      LD  A,L
000FDA DD3E C8              11      RET Z
000FDB DD3F FE5B             7      CP  'Z'+1
000FDD DD41 3804            12      JR  C,SCRNC_ADD
000FDF DD43 FEC0             7      CP  $C0
000FE1 DD45 3803            12      JR  C,SCRNC_SUB
       DD47                     SCRNC_ADD:
000FE3 DD47 C620             7      ADD A,$20
000FE5 DD49 C9              10      RET
       DD4A                     SCRNC_SUB:
000FE6 DD4A D620             7      SUB $20
000FE8 DD4C C9              10      RET
[EOF:M7IO.ASM:SHIFT_JIS]
                                    INCLUDE "LDFILE.ASM"
                                
                                ;   LSX-Dodgers FILE
                                
       DD4D                     FILEC:
000FE9 DD4D CD58DD          17      CALL    FILE
       DD50                     FILEC2:
000FEC DD50 3A15EF          13      LD  A,(FDRV+1)
000FEF DD53 FE20             7      CP  020H
000FF1 DD55 C8              11      RET Z
000FF2 DD56 1839            12      JR  SETDIR1
                                
       DD58                     FILE:
000FF4 DD58 AF               4      XOR A
000FF5 DD59 3214EF          13      LD  (FDRV),A
000FF8 DD5C 67               4      LD  H,A
000FF9 DD5D 6F               4      LD  L,A
000FFA DD5E 2222EF          16      LD  (FDRV+14),HL
000FFD DD61 CD2FDE          17      CALL    SPCUT
001000 DD64 CD14DE          17      CALL    CCHK3
001003 DD67 2812            12      JR  Z,DEVI1
001005 DD69 13               6      INC DE
001006 DD6A 1A               7      LD  A,(DE)
001007 DD6B 1B               6      DEC DE
001008 DD6C FE3A             7      CP  ':'
00100A DD6E 200B            12      JR  NZ,DEVI1
00100C DD70 1A               7      LD  A,(DE)      ;DRIVE
00100D DD71 CD64E0          17      CALL    CAP
001010 DD74 D640             7      SUB '@'
001012 DD76 13               6      INC DE
001013 DD77 13               6      INC DE
001014 DD78 3214EF          13      LD  (FDRV),A
       DD7B                     DEVI1:
001017 DD7B 1A               7      LD  A,(DE)
001018 DD7C D65C             7      SUB 05CH        ;\
00101A DD7E 2009            12      JR  NZ,NOROOT
00101C DD80 6F               4      LD  L,A     ;A=0でH=0のはずなのでHL=0
00101D DD81 222EEF          16      LD  (FDRV+26),HL
001020 DD84 2C               4      INC L
001021 DD85 2222EF          16      LD  (FDRV+14),HL
001024 DD88 13               6      INC DE
       DD89                     NOROOT:
                                
       DD89                     SETDIR:
001025 DD89 CDB5DD          17      CALL    FILED
001028 DD8C 1A               7      LD  A,(DE)
001029 DD8D FE5C             7      CP  05CH        ;\
00102B DD8F C0              11      RET NZ
00102C DD90 13               6      INC DE
       DD91                     SETDIR1:
00102D DD91 3E10             7      LD  A,010H      ;Directory
00102F DD93 3221EF          13      LD  (FDRV+13),A
001032 DD96 D5              11      PUSH    DE
001033 DD97 1114EF          10      LD  DE,FDRV
001036 DD9A 2A1EF0          16      LD  HL,(STABLE+2*00FH)
001039 DD9D CD0F00          17      CALL    JP_HL
00103C DDA0 D1              10      POP DE
00103D DDA1 B7               4      OR  A
00103E DDA2 C0              11      RET NZ
                                
00103F DDA3 3A21EF          13      LD  A,(FDRV+13)
001042 DDA6 CB67             8      BIT 4,A
001044 DDA8 C8              11      RET Z
                                
001045 DDA9 CDFCDD          17      CALL    FILEI
001048 DDAC 2A2EEF          16      LD  HL,(FDRV+26)
00104B DDAF 23               6      INC HL
00104C DDB0 2222EF          16      LD  (FDRV+14),HL
00104F DDB3 18D4            12      JR  SETDIR
                                
       DDB5                     FILED:
001051 DDB5 CDFCDD          17      CALL    FILEI
001054 DDB8 2115EF          10      LD  HL,FNAME
                                
001057 DDBB 0608             7      LD  B,8
       DDBD                     FILE2:
001059 DDBD CD09DE          17      CALL    CCHKF
00105C DDC0 C8              11      RET Z
00105D DDC1 FE2A             7      CP  '*'
00105F DDC3 282E            12      JR  Z,FILE9
001061 DDC5 FE2E             7      CP  '.'
001063 DDC7 280C            12      JR  Z,FILE4
001065 DDC9 77               7      LD  (HL),A
001066 DDCA 23               6      INC HL
001067 DDCB 10F0            13      DJNZ    FILE2
                                
       DDCD                     FILE3:
001069 DDCD CD09DE          17      CALL    CCHKF
00106C DDD0 C8              11      RET Z
00106D DDD1 FE2E             7      CP  '.'
00106F DDD3 20F8            12      JR  NZ,FILE3
                                
       DDD5                     FILE4:
001071 DDD5 211DEF          10      LD  HL,FNAME+8
001074 DDD8 0603             7      LD  B,3
                                
       DDDA                     FILE4L:
001076 DDDA CD09DE          17      CALL    CCHKF
001079 DDDD C8              11      RET Z
00107A DDDE FE2E             7      CP  '.'
00107C DDE0 2008            12      JR  NZ,FILE12
00107E DDE2 3215EF          13      LD  (FNAME),A   ;Parent directory(..)
001081 DDE5 3216EF          13      LD  (FNAME+1),A
001084 DDE8 3E20             7      LD  A,020H
       DDEA                     FILE12:
001086 DDEA FE2A             7      CP  '*'
001088 DDEC 280A            12      JR  Z,FILE10
00108A DDEE 77               7      LD  (HL),A
00108B DDEF 23               6      INC HL
00108C DDF0 10E8            13      DJNZ    FILE4L
00108E DDF2 C9              10      RET
                                
       DDF3                     FILE9:              ;名前の*処理、名前の残りを?で埋める
00108F DDF3 CDF8DD          17      CALL    FILE10
001092 DDF6 18D5            12      JR  FILE3
                                
       DDF8                     FILE10:
001094 DDF8 3E3F             7      LD  A,'?'
001096 DDFA 1808            12      JR  FILL_MEMORY
       DDFC                     FILEI:              ;名前＋拡張子をスペースで初期化
001098 DDFC 3E20             7      LD  A,020H
00109A DDFE 01000B          10      LD  BC,11*256   ;C=0にしておく
00109D DE01 2115EF          10      LD  HL,FNAME
       DE04                     FILL_MEMORY:            ;HLからBバイトAで埋める
0010A0 DE04 77               7      LD  (HL),A
0010A1 DE05 23               6      INC HL
0010A2 DE06 10FC            13      DJNZ    FILL_MEMORY
0010A4 DE08 C9              10      RET
                                
       DE09                     CCHKF:
0010A5 DE09 1A               7      LD  A,(DE)
0010A6 DE0A CD11DE          17      CALL    CCHK2
0010A9 DE0D C8              11      RET Z
0010AA DE0E C37CE1          10      JP  FKAN
                                
       DE11                     CCHK2:
0010AD DE11 0C               4      INC C
0010AE DE12 0D               4      DEC C
0010AF DE13 C0              11      RET NZ
       DE14                     CCHK3:              ;ZF=1 で使えない文字
0010B0 DE14 FE2B             7      CP  '+'
0010B2 DE16 C8              11      RET Z
0010B3 DE17 FE2C             7      CP  ','
0010B5 DE19 C8              11      RET Z
0010B6 DE1A FE2F             7      CP  '/'
0010B8 DE1C C8              11      RET Z
0010B9 DE1D FE3A             7      CP  ':'
0010BB DE1F C8              11      RET Z
0010BC DE20 FE3B             7      CP  ';'
0010BE DE22 C8              11      RET Z
0010BF DE23 FE3D             7      CP  '='
0010C1 DE25 C8              11      RET Z
0010C2 DE26 FE5C             7      CP  05CH    ;\
0010C4 DE28 C8              11      RET Z
0010C5 DE29 FE20             7      CP  020H
0010C7 DE2B D0              11      RET NC
0010C8 DE2C BF               4      CP  A       ;Z=1
0010C9 DE2D C9              10      RET
                                
       DE2E                     SS1:
0010CA DE2E 13               6      INC DE
       DE2F                     SPCUT:              ;スペースをカット
0010CB DE2F 1A               7      LD  A,(DE)
0010CC DE30 FE20             7      CP  020H
0010CE DE32 28FA            12      JR  Z,SS1
0010D0 DE34 C9              10      RET
                                
       DE35                     SETDRVF:
0010D1 DE35 1114EF          10      LD  DE,FDRV
       DE38                     SETDRV0:
0010D4 DE38 CD41DE          17      CALL    SETDRV
0010D7 DE3B FDE1            14      POP IY
0010D9 DE3D C1              10      POP BC
0010DA DE3E D1              10      POP DE
0010DB DE3F E1              10      POP HL
0010DC DE40 C9              10      RET
                                
       DE41                     SETDRV:
0010DD DE41 E3              19      EX  (SP),HL     ;HL=RETRN ADDRESS
0010DE DE42 D5              11      PUSH    DE      ;PUSH HL/DE/BC/IY
0010DF DE43 C5              11      PUSH    BC
0010E0 DE44 1A               7      LD  A,(DE)
0010E1 DE45 D5              11      PUSH    DE
0010E2 DE46 FDE3            23      EX  (SP),IY
                                
0010E4 DE48 CD54DE          17      CALL    GETDRV
0010E7 DE4B 3C               4      INC A
0010E8 DE4C FD7700          19      LD  (IY+0),A    ;(FCB)ドライブ番号
0010EB DE4F 3D               4      DEC A
0010EC DE50 CDD9EF          17      CALL    _CHGDRV
                                
0010EF DE53 E9               4      JP  (HL)
                                
       DE54                     GETDRV:
0010F0 DE54 E67F             7      AND 07FH
0010F2 DE56 D601             7      SUB 001H
0010F4 DE58 3003            12      JR  NC,GETDRV1
0010F6 DE5A 3A87EF          13      LD  A,(_DVSW)   ;Current Drive
       DE5D                     GETDRV1:
0010F9 DE5D 3288EF          13      LD  (_DRV),A
0010FC DE60 C9              10      RET
                                
       DE61                     SOPENX:
0010FD DE61 1139EF          10      LD  DE,SFILE
001100 DE64 1A               7      LD  A,(DE)
001101 DE65 FDBE00           7      CP  (IY+0)      ;(FCB)ドライブ番号
001104 DE68 2024            12      JR  NZ,SOPEN
001106 DE6A 13               6      INC DE
001107 DE6B FDE5            15      PUSH    IY
001109 DE6D E1              10      POP HL
00110A DE6E 23               6      INC HL
00110B DE6F CDFCDF          17      CALL    CPFILE
00110E DE72 201A            12      JR  NZ,SOPEN
                                
001110 DE74 2AF4F0          16      LD  HL,(SCDIR)
001113 DE77 FD750E          19      LD  (IY+14),L   ;(FCB)アクセスするディレクトリのクラスタ番号+1
001116 DE7A FD740F          19      LD  (IY+15),H
                                
001119 DE7D 2AF8F0          16      LD  HL,(SFNDF)  ;Direcroty location and Flags
00111C DE80 229FEF          16      LD  (_FILEN),HL
                                
00111F DE83 ED5BF6F0        20      LD  DE,(SFBPS)
001123 DE87 2139EF          10      LD  HL,SFILE
001126 DE8A 36FF            10      LD  (HL),0FFH
001128 DE8C 23               6      INC HL
001129 DE8D C9              10      RET
       DE8E                     SOPEN:
00112A DE8E 21A4DF          10      LD  HL,FILESE
       DE91                     SOPENC:
00112D DE91 22CADE          16      LD  (OPENPAT+1),HL
                                
001130 DE94 CDE2EF          17      CALL    _RDFATX     ;Detect Media
001133 DE97 3856            12      JR  C,RDDERR
                                
001135 DE99 AF               4      XOR A
001136 DE9A 329FEF          13      LD  (_FILEN),A
001139 DE9D CDA9E0          17      CALL    LDDIRX1     ;A=0で呼び出す
00113C DEA0 2818            12      JR  Z,SDIRX1
                                
00113E DEA2 CD95DF          17      CALL    READ_DIR    ;Sub Directory
001141 DEA5 3808            12      JR  C,SDIRX0
001143 DEA7 2A7EF0          16      LD  HL,(_DTBUF)
001146 DEAA 7E               7      LD  A,(HL)
001147 DEAB FE2E             7      CP  '.'
001149 DEAD 280F            12      JR  Z,SOPEN1
       DEAF                     SDIRX0:
00114B DEAF AF               4      XOR A
00114C DEB0 32A0EF          13      LD  (_DIRF),A
00114F DEB3 FD360E01        19      LD  (IY+14),1   ;(FCB)レコードサイズ
001153 DEB7 FD770F          19      LD  (IY+15),A
       DEBA                     SDIRX1:
001156 DEBA ED5BFCF0        20      LD  DE,(_DIRPS) ;Root Directory
       DEBE                     SOPEN1:
00115A DEBE 0E20             7  SDECPAT:LD  C,32        ;自己書き換え 1セクタ辺りのディレクトリエントリ数  1024=32 / 512=16 / 256=8
       DEC0                     SOPEN1X:
00115C DEC0 CD95DF          17      CALL    READ_DIR    ;FILE SEARCH
00115F DEC3 382A            12      JR  C,RDDERR
001161 DEC5 2A7EF0          16      LD  HL,(_DTBUF)
       DEC8                     SOPEN2:
001164 DEC8 D5              11      PUSH    DE
001165 DEC9 CDA4DF          17  OPENPAT:CALL    FILESE      ;(self-modifying code)
001168 DECC D1              10      POP DE
001169 DECD 386E            12      JR  C,SOPENE
00116B DECF 281B            12      JR  Z,SCF_FF_RET
       DED1                     SOPEN3:
00116D DED1 3AA0EF          13      LD  A,(_DIRF)   ;ディレクトリか判別
001170 DED4 B7               4      OR  A
001171 DED5 200C            12      JR  NZ,SOPEN5
001173 DED7 13               6      INC DE      ;ルートディレクトリ
001174 DED8 E5              11      PUSH    HL
001175 DED9 210C00          10  MD_PAT: LD  HL,12       ;(self-modifying code)MAXDIR
001178 DEDC ED52            15      SBC HL,DE       ;CF=0 なので SUB HL,DE
00117A DEDE E1              10      POP HL
00117B DEDF 20DD            12      JR  NZ,SOPEN1
00117D DEE1 1807            12      JR  SOPEN6
       DEE3                     SOPEN5:
00117F DEE3 CDF4E6          17      CALL    GNCLX       ;END DIR
001182 DEE6 D8              11      RET C
001183 DEE7 CD5CE0          17      CALL    ENDCL
       DEEA                     SOPEN6:
001186 DEEA 38D2            12      JR  C,SOPEN1
       DEEC                     SCF_FF_RET:
001188 DEEC 37               4      SCF         ;CF=1
001189 DEED 9F               4      SBC A,A     ;A=0FFH
00118A DEEE C9              10      RET
                                
       DEEF                     RDDERR:
00118B DEEF BF               4      CP  A       ;READ ERR CF=1 ZF=1
00118C DEF0 37               4      SCF
00118D DEF1 C9              10      RET
                                
       DEF2                     NOPEN:
00118E DEF2 21A4DF          10      LD  HL,FILESE
001191 DEF5 22CADE          16      LD  (OPENPAT+1),HL
001194 DEF8 FD2A98EF        20      LD  IY,(_FCB)
001198 DEFC CD8FE1          17      CALL    CHKWILDX
00119B DEFF 30EB            12      JR  NC,SCF_FF_RET
00119D DF01 FD7E00          19      LD  A,(IY+0)    ;(FCB)ドライブ番号
0011A0 DF04 3D               4      DEC A
0011A1 DF05 3288EF          13      LD  (_DRV),A
0011A4 DF08 CDD9EF          17      CALL    _CHGDRV
0011A7 DF0B D8              11      RET C
0011A8 DF0C 2AF8F0          16      LD  HL,(SFNDF)  ;Direcroty location and Flags
0011AB DF0F 229FEF          16      LD  (_FILEN),HL
                                
0011AE DF12 CDA4E0          17      CALL    LDDIRX
0011B1 DF15 ED5B9AEF        20      LD  DE,(_FBPS)
0011B5 DF19 CD95DF          17      CALL    READ_DIR
0011B8 DF1C 38D1            12      JR  C,RDDERR
0011BA DF1E 3A9EEF          13      LD  A,(_FBCNT)
0011BD DF21 3D               4      DEC A
0011BE DF22 28AD            12      JR  Z,SOPEN3
       DF24                     NOPEN2:
0011C0 DF24 2A9CEF          16      LD  HL,(_FBAD)
0011C3 DF27 012000          10      LD  BC,020H
0011C6 DF2A 09              11      ADD HL,BC
0011C7 DF2B 4F               4      LD  C,A
0011C8 DF2C 189A            12      JR  SOPEN2
                                
       DF2E                     SOPENE2:
0011CA DF2E 229CEF          16      LD  (_FBAD),HL
0011CD DF31 79               4      LD  A,C
0011CE DF32 329EEF          13      LD  (_FBCNT),A
0011D1 DF35 ED539AEF        20      LD  (_FBPS),DE
0011D5 DF39 FD2298EF        20      LD  (_FCB),IY
       DF3D                     SOPENE:
0011D9 DF3D AF               4      XOR A
0011DA DF3E C9              10      RET
                                
       DF3F                     COPEN:
0011DB DF3F FD360D20        19      LD  (IY+13),020H    ;(FCB)属性(アトリビュート)
                                
0011DF DF43 21C1DF          10      LD  HL,NEXTSE
0011E2 DF46 CD91DE          17      CALL    SOPENC
0011E5 DF49 D0              11      RET NC
0011E6 DF4A C8              11      RET Z
0011E7 DF4B 3AA0EF          13      LD  A,(_DIRF)   ;ディレクトリか判別
0011EA DF4E B7               4      OR  A
0011EB DF4F 37               4      SCF
0011EC DF50 C8              11      RET Z       ;ルートディレクトリ
0011ED DF51 0601             7      LD  B,1
0011EF DF53 CDEBE1          17      CALL    WRDF
0011F2 DF56 D8              11      RET C
0011F3 DF57 ED5BFEF0        20      LD  DE,(_CLPS)
0011F7 DF5B D5              11      PUSH    DE
0011F8 DF5C CD25E0          17      CALL    DCPAT
0011FB DF5F CD7FE5          17      CALL    DRDNX
0011FE DF62 2A7EF0          16      LD  HL,(_DTBUF) ;ディレクトリエントリを0クリア
001201 DF65 3AFAE4          13      LD  A,(SECSZ+2) ;1024=4 / 512=2 / 256=1
001204 DF68 47               4      LD  B,A
001205 DF69 AF               4      XOR A
001206 DF6A 4F               4      LD  C,A
       DF6B                     COPENCL:
001207 DF6B 77               7      LD  (HL),A
001208 DF6C EDA1            16      CPI         ;HL=HL+1 BC=BC-1 BCが0の場合にP/V=0
00120A DF6E EA6BDF          10      JP  PE,COPENCL
                                
00120D DF71 3A43E0          13      LD  A,(SPCPAT+1)    ;1クラスタの論理セクタ数
001210 DF74 3D               4      DEC A
001211 DF75 2819            12      JR  Z,COPENE
001213 DF77 3E01             7      LD  A,1     ;1セクタ辺りのセクタ数が2以上の場合
001215 DF79 32ECE6          13      LD  (_SECPS+1),A
001218 DF7C D1              10      POP DE      ;DE=(_CLPS)
001219 DF7D D5              11      PUSH    DE
       DF7E                     COPEN1:
00121A DF7E D5              11      PUSH    DE      ;データバッファに入らないセクタもゼロクリア
00121B DF7F C5              11      PUSH    BC
00121C DF80 2A7EF0          16      LD  HL,(_DTBUF)
00121F DF83 CD3FE0          17      CALL    CLUSTX
001222 DF86 CD58E8          17      CALL    DWT24
001225 DF89 C1              10      POP BC
001226 DF8A D1              10      POP DE
001227 DF8B CDEBE6          17      CALL    NEXTX
00122A DF8E 20EE            12      JR  NZ,COPEN1
       DF90                     COPENE:
00122C DF90 2A7EF0          16      LD  HL,(_DTBUF)
00122F DF93 D1              10      POP DE
001230 DF94 C9              10      RET
                                
       DF95                     READ_DIR:
001231 DF95 ED53FEF0        20      LD  (_CLPS),DE
001235 DF99 C5              11      PUSH    BC
001236 DF9A D5              11      PUSH    DE
001237 DF9B CD25E0          17      CALL    DCPAT
00123A DF9E CD5FE5          17      CALL    DRDX
00123D DFA1 D1              10      POP DE
00123E DFA2 C1              10      POP BC
00123F DFA3 C9              10      RET
                                
       DFA4                     FILESE:
001240 DFA4 7E               7      LD  A,(HL)
001241 DFA5 B7               4      OR  A
001242 DFA6 C8              11      RET Z       ;END:ZF=1 CF=0
001243 DFA7 FEE5             7      CP  0E5H
001245 DFA9 280E            12      JR  Z,FILESE1
001247 DFAB FDE5            15      PUSH    IY
001249 DFAD D1              10      POP DE
00124A DFAE 13               6      INC DE
00124B DFAF E5              11      PUSH    HL
00124C DFB0 CDFCDF          17      CALL    CPFILE
00124F DFB3 CC1DE0          17      CALL    Z,CPFILE2
001252 DFB6 E1              10      POP HL
001253 DFB7 37               4      SCF
001254 DFB8 C8              11      RET Z       ;!!!:(ZF=1) CF=1
       DFB9                     FILESE1:
001255 DFB9 CDD0DF          17      CALL    FNEXT
001258 DFBC 20E6            12      JR  NZ,FILESE
       DFBE                     ZF0_CF0_AFF_RET:
00125A DFBE F6FF             7      OR  0FFH        ;ZF=0 CF=0
00125C DFC0 C9              10      RET
                                
       DFC1                     NEXTSE:
00125D DFC1 7E               7      LD  A,(HL)
00125E DFC2 B7               4      OR  A
00125F DFC3 37               4      SCF
001260 DFC4 C8              11      RET Z       ;!!!:ZF=1 CF=1
001261 DFC5 FEE5             7      CP  0E5H
001263 DFC7 37               4      SCF
001264 DFC8 C8              11      RET Z       ;!!!:(ZF=1) CF=1
001265 DFC9 CDD0DF          17      CALL    FNEXT
001268 DFCC 20F3            12      JR  NZ,NEXTSE
00126A DFCE 18EE            12      JR  ZF0_CF0_AFF_RET
                                
       DFD0                     FNEXT:
00126C DFD0 E5              11      PUSH    HL
00126D DFD1 219FEF          10      LD  HL,_FILEN
001270 DFD4 34              11      INC (HL)
001271 DFD5 E1              10      POP HL
001272 DFD6 112000          10      LD  DE,020H
001275 DFD9 19              11      ADD HL,DE
001276 DFDA 0D               4      DEC C
001277 DFDB C9              10      RET
                                
       DFDC                     CPNAME:
001278 DFDC C5              11      PUSH    BC
001279 DFDD D5              11      PUSH    DE
00127A DFDE E5              11      PUSH    HL
00127B DFDF CDF6DF          17      CALL    CPFILE4
00127E DFE2 E1              10      POP HL
00127F DFE3 23               6      INC HL
001280 DFE4 23               6      INC HL
001281 DFE5 23               6      INC HL
001282 DFE6 23               6      INC HL
001283 DFE7 D1              10      POP DE
001284 DFE8 C1              10      POP BC
001285 DFE9 2005            12      JR  NZ,CPNAME1
001287 DFEB 7E               7      LD  A,(HL)
001288 DFEC 23               6      INC HL
001289 DFED 66               7      LD  H,(HL)
00128A DFEE 6F               4      LD  L,A
00128B DFEF C9              10      RET
       DFF0                     CPNAME1:
00128C DFF0 23               6      INC HL
00128D DFF1 23               6      INC HL
00128E DFF2 10E8            13      DJNZ    CPNAME
001290 DFF4 37               4      SCF
001291 DFF5 C9              10      RET
                                
       DFF6                     CPFILE4:
001292 DFF6 C5              11      PUSH    BC
001293 DFF7 010004          10      LD  BC,00400H
001296 DFFA 1804            12      JR  CPSTR1
       DFFC                     CPFILE:
001298 DFFC C5              11      PUSH    BC
001299 DFFD 01000B          10      LD  BC,00B00H
       E000                     CPSTR1:
00129C E000 1A               7      LD  A,(DE)
00129D E001 FE3F             7      CP  '?'     ;Wild card
00129F E003 2812            12      JR  Z,CPSTR2
0012A1 E005 7E               7      LD  A,(HL)
0012A2 E006 CD75E1          17      CALL    FKANC
0012A5 E009 E5              11      PUSH    HL
0012A6 E00A 67               4      LD  H,A
0012A7 E00B 1A               7      LD  A,(DE)
0012A8 E00C CB01             4      RLC C
0012AA E00E CD75E1          17      CALL    FKANC
0012AD E011 CB09             4      RRC C
0012AF E013 BC               4      CP  H       ;CP (HL),(DE)
0012B0 E014 E1              10      POP HL
0012B1 E015 2004            12      JR  NZ,CPSTR3
       E017                     CPSTR2:
0012B3 E017 13               6      INC DE
0012B4 E018 23               6      INC HL
0012B5 E019 10E5            13      DJNZ    CPSTR1
       E01B                     CPSTR3:
0012B7 E01B C1              10      POP BC
0012B8 E01C C9              10      RET
                                
       E01D                     CPFILE2:
0012B9 E01D FD7E0D          19      LD  A,(IY+13)   ;(FCB)属性(アトリビュート)
0012BC E020 F6E1             7      OR  0E1H
0012BE E022 2F               4      CPL
0012BF E023 A6               7      AND (HL)
0012C0 E024 C9              10      RET
                                
       E025                     DCPAT:
0012C1 E025 0E00             7      LD  C,0
0012C3 E027 2A7EF0          16      LD  HL,(_DTBUF)
0012C6 E02A 3AA0EF          13      LD  A,(_DIRF)   ;ディレクトリか判別
0012C9 E02D B7               4      OR  A
0012CA E02E C8              11      RET Z       ;ルートディレクトリの場合はCレジスタを0にしておく(CDEがセクタ番号)
0012CB E02F 3A43E0          13      LD  A,(SPCPAT+1)
0012CE E032 4F               4      LD  C,A
0012CF E033 3AECE6          13      LD  A,(_SECPS+1)
0012D2 E036 B9               4      CP  C
0012D3 E037 3801            12      JR  C,DC1
0012D5 E039 AF               4      XOR A
       E03A                     DC1:
0012D6 E03A F680             7      OR  080H
0012D8 E03C 32A0EF          13      LD  (_DIRF),A   ;bit0-6:セクタインデックス
       E03F                     CLUSTX:
0012DB E03F E5              11      PUSH    HL
0012DC E040 EB               4      EX  DE,HL
0012DD E041 AF               4      XOR A
0012DE E042 0E01             7  SPCPAT: LD  C,1     ;自己書き換え（1クラスタの論理セクタ数）
       E044                     L_CLDBL:
0012E0 E044 CB19             8      RR  C       ;->CF
0012E2 E046 3804            12      JR  C,E_CLDBL
0012E4 E048 29              11      ADD HL,HL       ;*2
0012E5 E049 8F               4      ADC A,A
0012E6 E04A 18F8            12      JR  L_CLDBL
       E04C                     E_CLDBL:
0012E8 E04C 4F               4      LD  C,A
0012E9 E04D 3AECE6          13      LD  A,(_SECPS+1)
0012EC E050 B5               4      OR  L
0012ED E051 6F               4      LD  L,A
0012EE E052 110800          10  CLSPAT: LD  DE,8    ;+8 (2D)  !ADDCL (self-modifying code)
0012F1 E055 AF               4      XOR A
0012F2 E056 19              11      ADD HL,DE   ;データ格納領域の先頭論理セクタ番号
0012F3 E057 89               4      ADC A,C
0012F4 E058 4F               4      LD  C,A
0012F5 E059 EB               4      EX  DE,HL
0012F6 E05A E1              10      POP HL
0012F7 E05B C9              10      RET
                                
       E05C                     ENDCL:
0012F8 E05C 7A               4      LD  A,D ;END CLUSTER
0012F9 E05D FE01             7  CLPAT1: CP  1   ;164=356    (self-modifying code)
0012FB E05F C0              11      RET NZ
0012FC E060 7B               4      LD  A,E
0012FD E061 FE64             7  CLPAT2: CP  064H    ;       (self-modifying code)
0012FF E063 C9              10      RET
                                
       E064                     CAP:
001300 E064 FE61             7      CP  'a'
001302 E066 D8              11      RET C
001303 E067 FE7B             7      CP  'z'+1
001305 E069 D0              11      RET NC
001306 E06A D620             7      SUB 020H
001308 E06C C9              10      RET
       E06D                     CAP2:
001309 E06D CD64E0          17      CALL    CAP
       E070                     CAP3:
00130C E070 CD79E0          17      CALL    CAP4
00130F E073 FE21             7      CP  021H
001311 E075 D0              11      RET NC
001312 E076 3EA0             7      LD  A,0A0H
001314 E078 C9              10      RET
       E079                     CAP4:
001315 E079 FE05             7      CP  5
001317 E07B C0              11      RET NZ
001318 E07C 3EE5             7      LD  A,0E5H
00131A E07E C9              10      RET
                                
       E07F                     CHDIR:
00131B E07F CD8FE9          17      CALL    GETDPBD
00131E E082 381D            12      JR  C,CHDIR2
001320 E084 DD751A          19      LD  (IX+01AH),L     ;_SDIR_
001323 E087 DD741B          19      LD  (IX+01BH),H     ;_SDIR_+1
001326 E08A 1815            12      JR  CHDIR2      ;POP_IX_RET
                                
       E08C                     LDDIR:
001328 E08C CD8FE9          17      CALL    GETDPBD
00132B E08F DD5E1A          19      LD  E,(IX+01AH)     ;_SDIR_
00132E E092 DD561B          19      LD  D,(IX+01BH)     ;_SDIR_+1
001331 E095 13               6      INC DE
001332 E096 FD730E          19      LD  (IY+14),E   ;(FCB)アクセスするディレクトリのクラスタ番号+1
001335 E099 FD720F          19      LD  (IY+15),D
001338 E09C 1B               6      DEC DE
001339 E09D AF               4      XOR A
00133A E09E 32A0EF          13      LD  (_DIRF),A
       E0A1                     CHDIR2:
00133D E0A1 DDE1            14      POP IX
00133F E0A3 C9              10      RET
                                
       E0A4                     LDDIRX:
001340 E0A4 3AA0EF          13      LD  A,(_DIRF)   ;(FCB)アクセスするディレクトリのセクタインデックス
001343 E0A7 E67F             7      AND 07FH
       E0A9                     LDDIRX1:
001345 E0A9 32ECE6          13      LD  (_SECPS+1),A
001348 E0AC FD5E0E          19      LD  E,(IY+14)   ;(FCB)アクセスするディレクトリのクラスタ番号+1
00134B E0AF FD560F          19      LD  D,(IY+15)
00134E E0B2 1B               6      DEC DE
00134F E0B3 CD5CE0          17      CALL    ENDCL
001352 E0B6 D48CE0          17      CALL    NC,LDDIR
       E0B9                     LDDIRS:
001355 E0B9 7A               4      LD  A,D
001356 E0BA B3               4      OR  E
001357 E0BB 32A0EF          13      LD  (_DIRF),A   ;ディレクトリか判別
00135A E0BE C9              10      RET
                                
       E0BF                     KILL:
00135B E0BF CD8FE1          17      CALL    CHKWILDX
00135E E0C2 3834            12      JR  C,KILLW
001360 E0C4 CD61DE          17      CALL    SOPENX
       E0C7                     KILLS:
001363 E0C7 3E1F             7      LD  A,01FH
001365 E0C9 D40BE1          17      CALL    NC,CHKATT
001368 E0CC D8              11      RET C
       E0CD                     KILLSX:
001369 E0CD 36E5            10      LD  (HL),0E5H   ;DIR
00136B E0CF CD69E1          17      CALL    WTDB
00136E E0D2 111A00          10      LD  DE,01AH
001371 E0D5 19              11      ADD HL,DE
001372 E0D6 5E               7      LD  E,(HL)
001373 E0D7 23               6      INC HL
001374 E0D8 56               7      LD  D,(HL)
       E0D9                     KILLS1:
001375 E0D9 CD5CE0          17      CALL    ENDCL
001378 E0DC D0              11      RET NC      ;CF=0
001379 E0DD 21FEFF          10      LD  HL,0-2
00137C E0E0 19              11      ADD HL,DE
00137D E0E1 D0              11      RET NC      ;DE= 0 or 1
00137E E0E2 D5              11      PUSH    DE
00137F E0E3 CDF7EF          17      CALL    _GNCL
001382 E0E6 ED53FEF0        20      LD  (_CLPS),DE
001386 E0EA D1              10      POP DE
001387 E0EB 210000          10      LD  HL,0
00138A E0EE D4FAEF          17      CALL    NC,_SNCL
00138D E0F1 D8              11      RET C
00138E E0F2 ED5BFEF0        20      LD  DE,(_CLPS)  ;FAT
001392 E0F6 18E1            12      JR  KILLS1
                                
       E0F8                     KILLW:
001394 E0F8 CD8EDE          17      CALL    SOPEN
       E0FB                     KILLW1:
001397 E0FB 380B            12      JR  C,KILLW2
001399 E0FD CD2EDF          17      CALL    SOPENE2
00139C E100 CDC7E0          17      CALL    KILLS
00139F E103 CDF2DE          17      CALL    NOPEN
0013A2 E106 18F3            12      JR  KILLW1
       E108                     KILLW2:
0013A4 E108 C8              11      RET Z
0013A5 E109 3F               4      CCF
0013A6 E10A C9              10      RET
                                
       E10B                     CHKATT:
0013A7 E10B E5              11      PUSH    HL
0013A8 E10C 110B00          10      LD  DE,00BH
0013AB E10F 19              11      ADD HL,DE
0013AC E110 A6               7      AND (HL)
0013AD E111 E1              10      POP HL
0013AE E112 C8              11      RET Z
0013AF E113 37               4      SCF
0013B0 E114 C9              10      RET
                                
       E115                     NAME:
0013B1 E115 CD8FE1          17      CALL    CHKWILDX
0013B4 E118 D8              11      RET C
0013B5 E119 110400          10      LD  DE,4
0013B8 E11C 19              11      ADD HL,DE
0013B9 E11D 2235E1          16      LD  (NAMEP+2),HL
0013BC E120 23               6      INC HL
0013BD E121 CD93E1          17      CALL    CHKWILD
0013C0 E124 D8              11      RET C
                                
0013C1 E125 CD61DE          17      CALL    SOPENX
0013C4 E128 3E0F             7      LD  A,00FH
0013C6 E12A D40BE1          17      CALL    NC,CHKATT
0013C9 E12D D8              11      RET C
                                
0013CA E12E FD7E00          19      LD  A,(IY+0)
0013CD E131 FDE5            15      PUSH    IY
0013CF E133 FD210000        14  NAMEP:  LD  IY,0        ;自己書き換え
0013D3 E137 FD7700          19      LD  (IY+0),A
0013D6 E13A CD61DE          17      CALL    SOPENX
0013D9 E13D FDE3            23      EX  (SP),IY
0013DB E13F 3F               4      CCF
0013DC E140 D48EDE          17      CALL    NC,SOPEN
0013DF E143 EB               4      EX  DE,HL
0013E0 E144 E1              10      POP HL
0013E1 E145 D8              11      RET C
                                
       E146                     SETNAME:
0013E2 E146 01000B          10      LD  BC,11*256
0013E5 E149 23               6      INC HL
0013E6 E14A 7E               7      LD  A,(HL)
0013E7 E14B FEE5             7      CP  0E5H
0013E9 E14D 2004            12      JR  NZ,SNAME1
0013EB E14F 3E05             7      LD  A,5
0013ED E151 180E            12      JR  SNAME3
       E153                     SNAME1:
0013EF E153 7E               7      LD  A,(HL)
0013F0 E154 0C               4      INC C
0013F1 E155 0D               4      DEC C
0013F2 E156 2009            12      JR  NZ,SNAME3
0013F4 E158 CD64E0          17      CALL    CAP
0013F7 E15B FEA0             7      CP  0A0H
0013F9 E15D 2002            12      JR  NZ,SNAME3
0013FB E15F 3E20             7      LD  A,020H
       E161                     SNAME3:
0013FD E161 12               7      LD  (DE),A
0013FE E162 7E               7      LD  A,(HL)
0013FF E163 23               6      INC HL
001400 E164 CD7CE1          17      CALL    FKAN
001403 E167 10EA            13      DJNZ    SNAME1
       E169                     WTDB:
001405 E169 3EFF             7      LD  A,0FFH
001407 E16B 3239EF          13      LD  (SFILE),A
       E16E                     SWTDBF:
00140A E16E 3E01             7      LD  A,1
00140C E170 32A4EF          13      LD  (_WTDBF),A
00140F E173 AF               4      XOR A
001410 E174 C9              10      RET
                                
       E175                     FKANC:
001411 E175 CB41             8      BIT 0,C
001413 E177 CC6DE0          17      CALL    Z,CAP2
001416 E17A 1801            12      JR  FKANX
       E17C                     FKAN:           ;漢字チェック
001418 E17C 13               6      INC DE
       E17D                     FKANX:
001419 E17D CB41             8      BIT 0,C
00141B E17F CB81             8      RES 0,C
00141D E181 C0              11      RET NZ
00141E E182 FE80             7      CP  080H
001420 E184 D8              11      RET C
001421 E185 FEA0             7      CP  0A0H
001423 E187 3803            12      JR  C,FKAN1
001425 E189 FEE0             7      CP  0E0H
001427 E18B D8              11      RET C
       E18C                     FKAN1:
001428 E18C 0C               4      INC C
001429 E18D A7               4      AND A
00142A E18E C9              10      RET
                                
       E18F                     CHKWILDX:
00142B E18F FDE5            15      PUSH    IY
00142D E191 E1              10      POP HL
00142E E192 23               6      INC HL
       E193                     CHKWILD:
00142F E193 060B             7      LD  B,11
001431 E195 3E3F             7      LD  A,'?'
       E197                     CHKWIL1:
001433 E197 BE               7      CP  (HL)
001434 E198 23               6      INC HL
001435 E199 37               4      SCF
001436 E19A C8              11      RET Z
001437 E19B 10FA            13      DJNZ    CHKWIL1
001439 E19D AF               4      XOR A
00143A E19E C9              10      RET
                                
       E19F                     SDIRENT:        ;IY=FCB HL=DIR
00143B E19F D5              11      PUSH    DE
00143C E1A0 E5              11      PUSH    HL
00143D E1A1 FDE5            15      PUSH    IY
00143F E1A3 D1              10      POP DE
001440 E1A4 EB               4      EX  DE,HL
001441 E1A5 CD46E1          17      CALL    SETNAME
                                ;               Attribute
001444 E1A8 FD7E0D          19      LD  A,(IY+13)   ;(FCB)属性(アトリビュート)
001447 E1AB 12               7      LD  (DE),A
001448 E1AC 13               6      INC DE
                                ;               Reserved
001449 E1AD AF               4      XOR A
00144A E1AE 060A             7      LD  B,10
       E1B0                     SDE1:
00144C E1B0 12               7      LD  (DE),A
00144D E1B1 13               6      INC DE
00144E E1B2 10FC            13      DJNZ    SDE1
                                                    ;(FCB)更新時刻
001450 E1B4 21EAF0          10      LD  HL,SDDATA       ;(FCB)更新年月日
001453 E1B7 060A             7      LD  B,SDDATAE-SDDATA    ;(FCB)ファイルの先頭クラスタ
       E1B9                     SDLOOP:                 ;(FCB)ファイルのサイズ(バイト単位)
001455 E1B9 7E               7      LD  A,(HL)
001456 E1BA 23               6      INC HL
001457 E1BB 32C0E1          13      LD  (SDPAT+2),A
00145A E1BE FD7E00          19  SDPAT:  LD  A,(IY+0)    ;LD A,(IY+A)
00145D E1C1 12               7      LD  (DE),A
00145E E1C2 13               6      INC DE
00145F E1C3 10F4            13      DJNZ    SDLOOP
                                
001461 E1C5 AF               4      XOR A
001462 E1C6 E1              10      POP HL
001463 E1C7 D1              10      POP DE
001464 E1C8 C9              10      RET
                                
       E1C9                     WOPEN:
001465 E1C9 FD7E0D          19      LD  A,(IY+13)   ;(FCB)属性(アトリビュート)
001468 E1CC E61F             7      AND 01FH
00146A E1CE 37               4      SCF
00146B E1CF C0              11      RET NZ
00146C E1D0 FD361CFE        19      LD  (IY+28),0FEH    ;(FCB)オープンモード
       E1D4                     TOPEN2:
001470 E1D4 AF               4      XOR A
       E1D5                     TOPEN:              ;Initializes the time stamp
001471 E1D5 FD3617FF        19      LD  (IY+23),0FFH    ;(FCB)更新時刻
001475 E1D9 C9              10      RET
                                
       E1DA                     WRDFX:
001476 E1DA 3A43E0          13      LD  A,(SPCPAT+1)    ;1クラスタの論理セクタ
       E1DD                     L_WRFX:
001479 E1DD 1F               4      RRA     ;->CF
00147A E1DE 3804            12      JR  C,E_WRFX
00147C E1E0 CB39             8      SRL C   ;C=C/2
00147E E1E2 18F9            12      JR  L_WRFX
       E1E4                     E_WRFX:
001480 E1E4 41               4      LD  B,C
001481 E1E5 04               4      INC B
001482 E1E6 3E37             7      LD  A,037H      ;SCF
001484 E1E8 327CE5          13      LD  (DRDN1),A
                                
       E1EB                     WRDF:               ;Bクラスタ分FATを確保する
001487 E1EB 110200          10      LD  DE,2
00148A E1EE AF               4      XOR A
00148B E1EF 32ECE6          13      LD  (_SECPS+1),A
       E1F2                     WRDF1:
00148E E1F2 C5              11      PUSH    BC
00148F E1F3 D5              11      PUSH    DE
001490 E1F4 CDF7EF          17      CALL    _GNCL
001493 E1F7 381C            12      JR  C,WRDF3
001495 E1F9 7A               4      LD  A,D     ;空いているかチェック
001496 E1FA B3               4      OR  E
001497 E1FB 2027            12      JR  NZ,WRDF4
001499 E1FD E1              10      POP HL      ;HL=空いているクラスタ
00149A E1FE E5              11      PUSH    HL
00149B E1FF ED5BFEF0        20      LD  DE,(_CLPS)  ;DE=元の(_CLPS)
00149F E203 22FEF0          16      LD  (_CLPS),HL
0014A2 E206 7A               4      LD  A,D     ;元の(_CLPS)が 0 か?
0014A3 E207 B3               4      OR  E
0014A4 E208 2008            12      JR  NZ,WRDF2
0014A6 E20A FD751A          19      LD  (IY+26),L   ;(FCB)ファイルの先頭クラスタ
0014A9 E20D FD741B          19      LD  (IY+27),H   ;元が空の場合はFCBにクラスタをセットする
0014AC E210 1803            12      JR  WRDF3
       E212                     WRDF2:
0014AE E212 CDFAEF          17      CALL    _SNCL
       E215                     WRDF3:
0014B1 E215 D1              10      POP DE
0014B2 E216 C1              10      POP BC
0014B3 E217 D8              11      RET C
0014B4 E218 100C            13      DJNZ    WRDF5       ;ここでループカウンタチェック
0014B6 E21A ED5BFEF0        20      LD  DE,(_CLPS)
0014BA E21E 21FFFF          10      LD  HL,0FFFFH   ;FATエントリ終了(EOCマーク)
0014BD E221 C3FAEF          10      JP  _SNCL
                                
       E224                     WRDF4:              ;DEクラスタが空じゃないので次に移動する
0014C0 E224 D1              10      POP DE
0014C1 E225 C1              10      POP BC
       E226                     WRDF5:
0014C2 E226 13               6      INC DE
0014C3 E227 CD5CE0          17      CALL    ENDCL
0014C6 E22A 38C6            12      JR  C,WRDF1
0014C8 E22C 37               4      SCF
0014C9 E22D C9              10      RET
                                
       E22E                     RWXR:
0014CA E22E 3AFAE4          13      LD  A,(SECSZ+2) ;1024=4 / 512=2 / 256=1
       E231                     L_RWX:
0014CD E231 1F               4      RRA     ;->CF
0014CE E232 3806            12      JR  C,E_RWX
0014D0 E234 CB38             8      SRL B   ;BC=BC/2
0014D2 E236 CB19             8      RR  C   ;
0014D4 E238 18F7            12      JR  L_RWX
       E23A                     E_RWX:
0014D6 E23A FD5E1A          19      LD  E,(IY+26)   ;(FCB)ファイルの先頭クラスタ
0014D9 E23D FD561B          19      LD  D,(IY+27)
0014DC E240 AF               4      XOR A
0014DD E241 32ECE6          13      LD  (_SECPS+1),A
       E244                     RWX1:
0014E0 E244 ED53FEF0        20      LD  (_CLPS),DE
0014E4 E248 7A               4      LD  A,D
0014E5 E249 B3               4      OR  E
0014E6 E24A 280D            12      JR  Z,SCF_RET   ;RET DE==0 => CF=1
                                
0014E8 E24C 78               4      LD  A,B
0014E9 E24D B1               4      OR  C
0014EA E24E C8              11      RET Z       ;RET BC==0 => CF=0
                                
0014EB E24F CDF4E6          17      CALL    GNCLX
0014EE E252 D8              11      RET C
0014EF E253 0B               6      DEC BC
                                
0014F0 E254 CD5CE0          17      CALL    ENDCL
0014F3 E257 38EB            12      JR  C,RWX1
       E259                     SCF_RET:
0014F5 E259 37               4      SCF
0014F6 E25A C9              10      RET
                                
       E25B                     DSKF:
0014F7 E25B 110000          10  MAXCLP: LD  DE,0
0014FA E25E 2AACEF          16      LD  HL,(_FAKEFREE)
0014FD E261 7C               4      LD  A,H
0014FE E262 B5               4      OR  L
0014FF E263 2803            12      JR  Z,DSKF1
001501 E265 110100          10      LD  DE,1
       E268                     DSKF1:
001504 E268 D5              11      PUSH    DE
001505 E269 CDF7EF          17      CALL    _GNCL
001508 E26C 380C            12      JR  C,POPSCF
00150A E26E 7A               4      LD  A,D
00150B E26F B3               4      OR  E
00150C E270 2001            12      JR  NZ,DSKF2
00150E E272 23               6      INC HL
       E273                     DSKF2:
00150F E273 D1              10      POP DE
001510 E274 1B               6      DEC DE
001511 E275 7A               4      LD  A,D
001512 E276 B3               4      OR  E
001513 E277 20EF            12      JR  NZ,DSKF1
001515 E279 C9              10      RET
                                
       E27A                     POPSCF:
001516 E27A F1              10      POP AF
001517 E27B 37               4      SCF
001518 E27C C9              10      RET
                                
       E27D                     SETTMS:
001519 E27D FD7E17          19      LD  A,(IY+23)   ;(FCB)ファイルを最後に変更した時刻
00151C E280 3C               4      INC A
00151D E281 C0              11      RET NZ      ;ファイルが更新されていない
       E282                     SETTMSX:            ;FCBに日付時刻をセットする
00151E E282 CDBCD9          17      CALL    _SYS2C      ;(BDOS)時刻の獲得
                                                ;H←時  L←分  D←秒
001521 E285 CB25             8      SLA L       ;   *2
001523 E287 CB25             8      SLA L       ;   *4
001525 E289 29              11      ADD HL,HL       ;*2 *8
001526 E28A 29              11      ADD HL,HL       ;*4 *16
001527 E28B 29              11      ADD HL,HL       ;*8 *32
001528 E28C 7A               4      LD  A,D
001529 E28D 0F               4      RRCA            ;bit.0->7->->->0->C
00152A E28E E61F             7      AND 01FH
00152C E290 B5               4      OR  L
00152D E291 FD7716          19      LD  (IY+22),A   ;(FCB)ファイルを最後に変更した時刻
001530 E294 FD7417          19      LD  (IY+23),H
                                
001533 E297 CDB4D9          17      CALL    _SYS2A      ;(BDOS)日付の獲得
                                                ;HL←年  D←月  E←日
001536 E29A 0144F8          10      LD  BC,0-1980
001539 E29D 09              11      ADD HL,BC
00153A E29E 65               4      LD  H,L
                                
00153B E29F 7A               4      LD  A,D
00153C E2A0 87               4      ADD A,A     ;*2
00153D E2A1 87               4      ADD A,A     ;*4
00153E E2A2 87               4      ADD A,A     ;*8
00153F E2A3 87               4      ADD A,A     ;*16
001540 E2A4 6F               4      LD  L,A
001541 E2A5 29              11      ADD HL,HL       ;*32
001542 E2A6 7D               4      LD  A,L
001543 E2A7 B3               4      OR  E
001544 E2A8 FD7714          19      LD  (IY+20),A   ;(FCB)ファイルを最後に変更した日付
001547 E2AB FD7415          19      LD  (IY+21),H
00154A E2AE C9              10      RET
                                
       E2AF                     PUSHRR:
00154B E2AF CDB5E2          17      CALL    SUBRR
       E2B2                     POPRR1:
00154E E2B2 EDB0                    LDIR
001550 E2B4 C9              10      RET
                                
       E2B5                     SUBRR:
001551 E2B5 FDE5            15      PUSH    IY
001553 E2B7 E1              10      POP HL
001554 E2B8 112100          10      LD  DE,33
001557 E2BB 19              11      ADD HL,DE
001558 E2BC 115AEF          10      LD  DE,HLBUF
00155B E2BF 010300          10      LD  BC,3
00155E E2C2 C9              10      RET
                                
       E2C3                     SETSEQ:
00155F E2C3 F5              11      PUSH    AF      ;AHL=Random record
001560 E2C4 FD7E21          19      LD  A,(IY+33)   ;(FCB)ランダムレコード
001563 E2C7 FD6E22          19      LD  L,(IY+34)
001566 E2CA FD6623          19      LD  H,(IY+35)
                                
001569 E2CD CDE9E2          17      CALL    SSQ1
                                
00156C E2D0 29              11      ADD HL,HL
00156D E2D1 CB3D             8      SRL L       ;L=L/2
00156F E2D3 FD7520          19      LD  (IY+32),L   ;(FCB)カレントレコード
001572 E2D6 FD740C          19      LD  (IY+12),H   ;(FCB)カレントブロック
001575 E2D9 F1              10      POP AF
                                
       E2DA                     POPRR:
001576 E2DA CDB5E2          17      CALL    SUBRR
001579 E2DD EB               4      EX  DE,HL
00157A E2DE 18D2            12      JR  POPRR1
                                
       E2E0                     GETSIZE:
00157C E2E0 FD7E10          19      LD  A,(IY+16)   ;(FCB)ファイルのサイズ(バイト単位)
00157F E2E3 FD6E11          19      LD  L,(IY+17)
001582 E2E6 FD6612          19      LD  H,(IY+18)
       E2E9                     SSQ1:               ;バイト単位からCP/Mのレコード単位を求める（1レコード=128バイト）
001585 E2E9 87               4      ADD A,A     ;in HLA => out HL
001586 E2EA ED6A            15      ADC HL,HL
001588 E2EC B7               4      OR  A
001589 E2ED C8              11      RET Z
00158A E2EE 23               6      INC HL
00158B E2EF C9              10      RET
                                
       E2F0                     GETSEQ:
00158C E2F0 FD6E20          19      LD  L,(IY+32)   ;(FCB)カレントレコード
00158F E2F3 FD660C          19      LD  H,(IY+12)   ;(FCB)カレントブロック
                                
001592 E2F6 CB25             8      SLA L   ;L=L*2
                                
001594 E2F8 CB3C             8      SRL H   ;HL=HL/2
001596 E2FA CB1D             8      RR  L   ;
001598 E2FC C9              10      RET
                                
       E2FD                     RB_WRITE:
001599 E2FD C5              11      PUSH    BC
00159A E2FE ED4B4CF0        20      LD  BC,(STABLE+2*026H)  ;(BDOS)ランダムブロック書き込み
00159E E302 1805            12      JR  RBRW
       E304                     RB_READ:
0015A0 E304 C5              11      PUSH    BC
0015A1 E305 ED4B4EF0        20      LD  BC,(STABLE+2*027H)  ;(BDOS)ランダムブロック読み込み
       E309                     RBRW:
0015A5 E309 AF               4      XOR A   ;HLA = HL*128
0015A6 E30A CB3C             8      SRL H   ;HL=HL/2
0015A8 E30C CB1D             8      RR  L   ;
0015AA E30E 1F               4      RRA         ;HLA
0015AB E30F FD7721          19      LD  (IY+33),A   ;(FCB)ランダムレコード
0015AE E312 FD7522          19      LD  (IY+34),L
0015B1 E315 FD7423          19      LD  (IY+35),H
0015B4 E318 218000          10      LD  HL,128
                                
0015B7 E31B FDE5            15      PUSH    IY
0015B9 E31D D1              10      POP DE
0015BA E31E D5              11      PUSH    DE
0015BB E31F CD26E3          17      CALL    JP_BC
0015BE E322 FDE1            14      POP IY
0015C0 E324 C1              10      POP BC
0015C1 E325 C9              10      RET
       E326                     JP_BC:
0015C2 E326 C5              11      PUSH    BC
0015C3 E327 C9              10      RET
                                
       DEEC                     _SYS03  EQU SCF_FF_RET  ;(BDOS)外部入力
       DEEC                     _SYS2B  EQU SCF_FF_RET  ;(BDOS)日付の設定
       DEEC                     _SYS2D  EQU SCF_FF_RET  ;(BDOS)時刻の設定
       DEEC                     _SYS39  EQU SCF_FF_RET  ;(BDOS)サブディレクトリの作成
       DEEC                     _SYS3A  EQU SCF_FF_RET  ;(BDOS)サブディレクトリの削除
                                
[EOF:LDFILE.ASM:SHIFT_JIS]
                                    INCLUDE "LDFILE2.ASM"
                                
                                ;   LSX-Dodgers FILE2
                                
                                                ;Write random block
       E328                     _SYS26:     ;(BDOS)ランダムブロック書き込み
0015C4 E328 AF               4      XOR A
0015C5 E329 327CE5          13      LD  (DRDN1),A   ;NOP
0015C8 E32C 223DE5          16      LD  (LEFT+1),HL ;HL←書き込むレコード数
0015CB E32F 225DEF          16      LD  (LEFTX),HL
0015CE E332 CD41DE          17      CALL    SETDRV
                                
0015D1 E335 CDA5E4          17      CALL    RBX0
0015D4 E338 DACEE3          10      JP  C,RBWERR
0015D7 E33B CDC9E1          17      CALL    WOPEN
0015DA E33E DACEE3          10      JP  C,RBWERR
0015DD E341 7C               4      LD  A,H
0015DE E342 B5               4      OR  L
0015DF E343 CAC7E3          10      JP  Z,RBW1
                                
0015E2 E346 2B               6      DEC HL
                                
0015E3 E347 CD55E5          17      CALL    GET_RR_CDE  ;CDE=Random record
                                
0015E6 E34A AF               4      XOR A   ;AHL=HL+CDE
0015E7 E34B 19              11      ADD HL,DE
0015E8 E34C 89               4      ADC A,C
                                
0015E9 E34D 47               4      LD  B,A
0015EA E34E 4C               4      LD  C,H
                                
0015EB E34F CD2EE2          17      CALL    RWXR
0015EE E352 DCDAE1          17      CALL    C,WRDFX
0015F1 E355 DACEE3          10      JP  C,RBWERR
                                
0015F4 E358 CDCEE4          17      CALL    RBX2
0015F7 E35B 281A            12      JR  Z,RBWB      ;NZ=セクタ以下の端数がある
0015F9 E35D CDE2E4          17      CALL    RBXA
0015FC E360 386C            12      JR  C,RBWERR
0015FE E362 EB               4      EX  DE,HL
0015FF E363 C5              11      PUSH    BC
001600 E364 EDB0                    LDIR
001602 E366 225FEF          16      LD  (DTAX),HL
                                
001605 E369 CD6EE1          17      CALL    SWTDBF      ;バッファデータは更新された
                                
001608 E36C 2A5DEF          16      LD  HL,(LEFTX)
00160B E36F D1              10      POP DE
00160C E370 ED52            15      SBC HL,DE
00160E E372 225DEF          16      LD  (LEFTX),HL
001611 E375 2830            12      JR  Z,RBWEND
                                
       E377                     RBWB:
001613 E377 CD18E5          17      CALL    RBXB
001616 E37A 2813            12      JR  Z,RBWC
       E37C                     RBWB1:
001618 E37C C5              11      PUSH    BC
001619 E37D D5              11      PUSH    DE
00161A E37E CD3FE0          17      CALL    CLUSTX
00161D E381 CD58E8          17      CALL    DWT24
001620 E384 D1              10      POP DE
001621 E385 C1              10      POP BC
001622 E386 3846            12      JR  C,RBWERR
001624 E388 CDF4E6          17      CALL    GNCLX
001627 E38B 3841            12      JR  C,RBWERR
001629 E38D 10ED            13      DJNZ    RBWB1
       E38F                     RBWC:
00162B E38F CD30E5          17      CALL    RBXC
00162E E392 2813            12      JR  Z,RBWEND
001630 E394 C5              11      PUSH    BC
001631 E395 CD3FE0          17      CALL    CLUSTX
001634 E398 CD7BE5          17      CALL    DRDN
001637 E39B C1              10      POP BC
001638 E39C 3830            12      JR  C,RBWERR
00163A E39E ED5B7EF0        20      LD  DE,(_DTBUF)
00163E E3A2 EDB0                    LDIR
001640 E3A4 CD6EE1          17      CALL    SWTDBF      ;バッファデータは更新された
       E3A7                     RBWEND:
001643 E3A7 CD3CE5          17      CALL    RBXEND
                                
001646 E3AA CDB4E4          17      CALL    RBX1
001649 E3AD 3018            12      JR  NC,RBW1
00164B E3AF 2A3DE5          16      LD  HL,(LEFT+1)
00164E E3B2 FD5E10          19      LD  E,(IY+16)   ;(FCB)ファイルのサイズ(バイト単位)
001651 E3B5 FD5611          19      LD  D,(IY+17)   ;CDE=File size
001654 E3B8 FD4E12          19      LD  C,(IY+18)
001657 E3BB AF               4      XOR A
001658 E3BC 19              11      ADD HL,DE
001659 E3BD 89               4      ADC A,C
00165A E3BE FD7510          19      LD  (IY+16),L   ;(FCB)ファイルのサイズ(バイト単位)
00165D E3C1 FD7411          19      LD  (IY+17),H
001660 E3C4 FD7712          19      LD  (IY+18),A
       E3C7                     RBW1:
001663 E3C7 FDE1            14      POP IY
001665 E3C9 C1              10      POP BC
001666 E3CA D1              10      POP DE
001667 E3CB E1              10      POP HL
       E3CC                     DD_NUL:
001668 E3CC AF               4      XOR A
001669 E3CD C9              10      RET
                                
       E3CE                     RBWERR:
00166A E3CE FDE5            15      PUSH    IY
00166C E3D0 D1              10      POP DE
00166D E3D1 2A20F0          16      LD  HL,(STABLE+2*010H)
001670 E3D4 CD0F00          17      CALL    JP_HL
       E3D7                     RBRERR1:
001673 E3D7 3E01             7      LD  A,001H
       E3D9                     RBRERR2:
001675 E3D9 FDE1            14      POP IY
001677 E3DB C1              10      POP BC
001678 E3DC D1              10      POP DE
001679 E3DD E1              10      POP HL
00167A E3DE 37               4      SCF
00167B E3DF 210000          10      LD  HL,0
00167E E3E2 C9              10      RET
                                
       E3E3                     RBRERR:
00167F E3E3 3EFF             7      LD  A,0FFH
001681 E3E5 18F2            12      JR  RBRERR2
                                
       E3E7                     RBRFL:
001683 E3E7 3E00             7  RBRFLP: LD  A,000H
001685 E3E9 FE0D             7      CP  00DH
001687 E3EB 2005            12      JR  NZ,RBRFL1
001689 E3ED D5              11      PUSH    DE
00168A E3EE 1E0A             7      LD  E,00AH
00168C E3F0 1805            12      JR  RBRFL2
       E3F2                     RBRFL1:
00168E E3F2 D5              11      PUSH    DE
00168F E3F3 CD09EF          17      CALL    _SYS07
001692 E3F6 5F               4      LD  E,A
       E3F7                     RBRFL2:
001693 E3F7 CDCDEF          17      CALL    _PRINT
001696 E3FA 7B               4      LD  A,E
001697 E3FB D1              10      POP DE
001698 E3FC 32E8E3          13      LD  (RBRFLP+1),A
00169B E3FF C9              10      RET
       E400                     DDX:
00169C E400 FD7E01          19      LD  A,(IY+1)    ;(FCB)主ファイル名
00169F E403 CD64E0          17      CALL    CAP
0016A2 E406 FE41             7      CP  'A'
0016A4 E408 C9              10      RET
                                
                                                ;Read random block
       E409                     _SYS27:     ;(BDOS)ランダムブロック読み込み
0016A5 E409 225DEF          16      LD  (LEFTX),HL
0016A8 E40C CD41DE          17      CALL    SETDRV
                                
0016AB E40F FDCB0D66        20      BIT 4,(IY+13)   ;(FCB)属性(アトリビュート)
0016AF E413 C293E4          10      JP  NZ,RBRDIR   ;ディレクトリ
0016B2 E416 CDA5E4          17      CALL    RBX0
0016B5 E419 DAE3E3          10      JP  C,RBRERR
0016B8 E41C CDB4E4          17      CALL    RBX1
0016BB E41F DAD7E3          10      JP  C,RBRERR1
0016BE E422 79               4      LD  A,C
0016BF E423 EB               4      EX  DE,HL
0016C0 E424 ED52            15      SBC HL,DE       ;CP 0HL,CDE
0016C2 E426 19              11      ADD HL,DE
0016C3 E427 DE00             7      SBC A,000H
0016C5 E429 3801            12      JR  C,RBR1
0016C7 E42B EB               4      EX  DE,HL
       E42C                     RBR1:
0016C8 E42C 9F               4      SBC A,A
0016C9 E42D E601             7      AND 1
0016CB E42F 3291E4          13      LD  (RBRAP+1),A
                                
0016CE E432 7C               4      LD  A,H
0016CF E433 B5               4      OR  L
0016D0 E434 2854            12      JR  Z,RBREND0
                                
0016D2 E436 223DE5          16      LD  (LEFT+1),HL ;Read record byte
0016D5 E439 225DEF          16      LD  (LEFTX),HL
                                
0016D8 E43C CDCEE4          17      CALL    RBX2
0016DB E43F 2819            12      JR  Z,RBRB
0016DD E441 CDE2E4          17      CALL    RBXA
0016E0 E444 DAE3E3          10      JP  C,RBRERR
0016E3 E447 C5              11      PUSH    BC
0016E4 E448 EDB0                    LDIR
0016E6 E44A ED535FEF        20      LD  (DTAX),DE
0016EA E44E 2A5DEF          16      LD  HL,(LEFTX)
0016ED E451 D1              10      POP DE
0016EE E452 A7               4      AND A
0016EF E453 ED52            15      SBC HL,DE
0016F1 E455 225DEF          16      LD  (LEFTX),HL
0016F4 E458 282D            12      JR  Z,RBREND
                                
       E45A                     RBRB:
0016F6 E45A CD18E5          17      CALL    RBXB
0016F9 E45D 2812            12      JR  Z,RBRC
       E45F                     RBRB1:
0016FB E45F C5              11      PUSH    BC
0016FC E460 D5              11      PUSH    DE
0016FD E461 CD3FE0          17      CALL    CLUSTX
001700 E464 CD48E8          17      CALL    DRD24
001703 E467 D1              10      POP DE
001704 E468 C1              10      POP BC
001705 E469 D4F4E6          17      CALL    NC,GNCLX
001708 E46C DAE3E3          10      JP  C,RBRERR
00170B E46F 10EE            13      DJNZ    RBRB1
       E471                     RBRC:
00170D E471 CD30E5          17      CALL    RBXC
001710 E474 2811            12      JR  Z,RBREND
001712 E476 C5              11      PUSH    BC
001713 E477 CD3FE0          17      CALL    CLUSTX
001716 E47A CD5FE5          17      CALL    DRDX
001719 E47D C1              10      POP BC
00171A E47E DAE3E3          10      JP  C,RBRERR
00171D E481 EB               4      EX  DE,HL
00171E E482 2A7EF0          16      LD  HL,(_DTBUF)
001721 E485 EDB0                    LDIR
       E487                     RBREND:
001723 E487 CD3CE5          17      CALL    RBXEND
       E48A                     RBREND0:
001726 E48A FDE1            14      POP IY
001728 E48C C1              10      POP BC
001729 E48D D1              10      POP DE
00172A E48E F1              10      POP AF  ;(HL)
00172B E48F AF               4      XOR A
00172C E490 3E00             7  RBRAP:  LD  A,000H
00172E E492 C9              10      RET
                                
       E493                     RBRDIR:
00172F E493 FD6E1A          19      LD  L,(IY+26)   ;(FCB)ファイルの先頭クラスタ
001732 E496 FD661B          19      LD  H,(IY+27)
001735 E499 CD7FE0          17      CALL    CHDIR
001738 E49C AF               4      XOR A
001739 E49D 67               4      LD  H,A
00173A E49E 6F               4      LD  L,A
00173B E49F 3C               4      INC A
00173C E4A0 3291E4          13      LD  (RBRAP+1),A
00173F E4A3 18E5            12      JR  RBREND0
                                
       E4A5                     RBX0:
001741 E4A5 2A8AEF          16      LD  HL,(_DTA)
001744 E4A8 225FEF          16      LD  (DTAX),HL
001747 E4AB 2A5DEF          16      LD  HL,(LEFTX)
00174A E4AE FD7E1C          19      LD  A,(IY+28)   ;(FCB)オープンモード
00174D E4B1 D6FD             7      SUB 0FDH
00174F E4B3 C9              10      RET
                                
       E4B4                     RBX1:
001750 E4B4 E5              11      PUSH    HL      ;Record byte
                                                ;AHL=File size
001751 E4B5 FD6E10          19      LD  L,(IY+16)   ;ファイルのサイズ(バイト単位)
001754 E4B8 FD6611          19      LD  H,(IY+17)
001757 E4BB FD7E12          19      LD  A,(IY+18)
                                
00175A E4BE CD55E5          17      CALL    GET_RR_CDE  ;CDE=Random record
                                
00175D E4C1 A7               4      AND A
00175E E4C2 ED52            15      SBC HL,DE
001760 E4C4 99               4      SBC A,C
001761 E4C5 D1              10      POP DE
                                
001762 E4C6 D8              11      RET C
001763 E4C7 4F               4      LD  C,A
001764 E4C8 EB               4      EX  DE,HL   ;CDE=File byte  HL=Record byte
001765 E4C9 B2               4      OR  D
001766 E4CA B3               4      OR  E
001767 E4CB C0              11      RET NZ
001768 E4CC 37               4      SCF
001769 E4CD C9              10      RET
                                
       E4CE                     RBX2:               ;Cluster settings
00176A E4CE FD4E22          19      LD  C,(IY+34)   ;(+33)(FCB)ランダムレコード
00176D E4D1 FD4623          19      LD  B,(IY+35)
001770 E4D4 CD2EE2          17      CALL    RWXR
001773 E4D7 3AFAE4          13      LD  A,(SECSZ+2) ;1024=4 / 512=2 / 256=1
001776 E4DA 3D               4      DEC A
001777 E4DB FDA622          19      AND (IY+34)
00177A E4DE FDB621          19      OR  (IY+33)
00177D E4E1 C9              10      RET
                                
       E4E2                     RBXA:
00177E E4E2 C5              11      PUSH    BC
00177F E4E3 D5              11      PUSH    DE
001780 E4E4 CD3FE0          17      CALL    CLUSTX
001783 E4E7 CD5FE5          17      CALL    DRDX
001786 E4EA D1              10      POP DE
001787 E4EB C1              10      POP BC
001788 E4EC D8              11      RET C
001789 E4ED CDF4E6          17      CALL    GNCLX
00178C E4F0 D8              11      RET C
00178D E4F1 ED53FEF0        20      LD  (_CLPS),DE
                                
001791 E4F5 FD4E21          19      LD  C,(IY+33)   ;(FCB)ランダムレコード
001794 E4F8 210004          10  SECSZ:  LD  HL,0400H    ;自己書き換え 1024=0400H / 512=0200H ここに1セクタのサイズが格納される
001797 E4FB 7C               4      LD  A,H
001798 E4FC 3D               4      DEC A       ;1024=3 / 512=1
001799 E4FD FDA622          19      AND (IY+34)     ;(FCB)ランダムレコード
00179C E500 47               4      LD  B,A     ;BCに1セクタ以下の端数が入る
00179D E501 ED42            15      SBC HL,BC       ;残りを計算
                                
00179F E503 ED5B5DEF        20      LD  DE,(LEFTX)
0017A3 E507 ED52            15      SBC HL,DE       ;CP HL,DE
0017A5 E509 19              11      ADD HL,DE       ;
0017A6 E50A 3801            12      JR  C,RBXA1     ;DEとHLを比較して大きい方をHLに
0017A8 E50C EB               4      EX  DE,HL
       E50D                     RBXA1:
0017A9 E50D E5              11      PUSH    HL
0017AA E50E 2A7EF0          16      LD  HL,(_DTBUF)
0017AD E511 09              11      ADD HL,BC
0017AE E512 ED5B5FEF        20      LD  DE,(DTAX)
0017B2 E516 C1              10      POP BC
0017B3 E517 C9              10      RET
                                
       E518                     RBXB:
0017B4 E518 2A5FEF          16      LD  HL,(DTAX)
0017B7 E51B ED5BFEF0        20      LD  DE,(_CLPS)
0017BB E51F 3A5EEF          13      LD  A,(LEFTX+1)
0017BE E522 47               4      LD  B,A
0017BF E523 3AFAE4          13      LD  A,(SECSZ+2) ;1024=4 / 512=2 / 256=1
       E526                     RBXB1:
0017C2 E526 1F               4      RRA     ;->CF
0017C3 E527 3804            12      JR  C,RBXB2
0017C5 E529 CB38             8      SRL B   ;B=B/2
0017C7 E52B 18F9            12      JR  RBXB1
       E52D                     RBXB2:
0017C9 E52D 78               4      LD  A,B
0017CA E52E B7               4      OR  A
0017CB E52F C9              10      RET
                                
       E530                     RBXC:
0017CC E530 ED4B5DEF        20      LD  BC,(LEFTX)
0017D0 E534 3AFAE4          13      LD  A,(SECSZ+2) ;1024=4 / 512=2 / 256=1
0017D3 E537 3D               4      DEC A
0017D4 E538 A0               4      AND B
0017D5 E539 47               4      LD  B,A     ;1セクタ以下の端数がない場合はZ
0017D6 E53A B1               4      OR  C
0017D7 E53B C9              10      RET
                                
       E53C                     RBXEND:
0017D8 E53C 110000          10  LEFT:   LD  DE,0
0017DB E53F AF               4      XOR A
0017DC E540 FD6E21          19      LD  L,(IY+33)   ;(FCB)ランダムレコード
0017DF E543 FD6622          19      LD  H,(IY+34)
0017E2 E546 19              11      ADD HL,DE
0017E3 E547 FD8E23          19      ADC A,(IY+35)
0017E6 E54A FD7521          19      LD  (IY+33),L   ;(FCB)ランダムレコード
0017E9 E54D FD7422          19      LD  (IY+34),H
0017EC E550 FD7723          19      LD  (IY+35),A
0017EF E553 EB               4      EX  DE,HL       ;HL=Read byte
0017F0 E554 C9              10      RET
                                
       E555                     GET_RR_CDE:         ;CDE=Random record
0017F1 E555 FD5E21          19      LD  E,(IY+33)   ;(FCB)ランダムレコード
0017F4 E558 FD5622          19      LD  D,(IY+34)
0017F7 E55B FD4E23          19      LD  C,(IY+35)
0017FA E55E C9              10      RET
                                
[EOF:LDFILE2.ASM:SHIFT_JIS]
                                    INCLUDE "LDDIO.ASM"
                                
                                ;   LSX-Dodgers DIO
                                
       E55F                     DRDX:
0017FB E55F CD9DE5          17      CALL    DRDY
0017FE E562 C8              11      RET Z
0017FF E563 CD83E5          17      CALL    DRDX1       ;データバッファの情報を保存
001802 E566 D8              11      RET C
001803 E567 E5              11      PUSH    HL
001804 E568 C5              11      PUSH    BC
001805 E569 D5              11      PUSH    DE
001806 E56A 2A7EF0          16      LD  HL,(_DTBUF)
001809 E56D 3AC6E5          13      LD  A,(_DBS24+1)
00180C E570 4F               4      LD  C,A
00180D E571 CD48E8          17      CALL    DRD24
001810 E574 DC98E5          17      CALL    C,DRDNE
       E577                     POP_DE_BC_HL_RET:
001813 E577 D1              10      POP DE
001814 E578 C1              10      POP BC
001815 E579 E1              10      POP HL
001816 E57A C9              10      RET
                                
                                ;   CDE:セクタ番号
       E57B                     DRDN:
001817 E57B AF               4      XOR A
001818 E57C 00               4  DRDN1:  NOP         ;自己書き換え NOP / SCF
001819 E57D 30E0            12      JR  NC,DRDX
       E57F                     DRDNX:
00181B E57F CD9DE5          17      CALL    DRDY
00181E E582 C8              11      RET Z
       E583                     DRDX1:
00181F E583 CDB3E5          17      CALL    DWTX
                                                ;データバッファの読み込んだドライブ・セクタ情報を保存
001822 E586 ED53A6EF        20      LD  (_DBSEC),DE
001826 E58A 79               4      LD  A,C
001827 E58B 32C6E5          13      LD  (_DBS24+1),A
                                
00182A E58E 3A88EF          13      LD  A,(_DRV)
00182D E591 32A5EF          13      LD  (_DBDRV),A
001830 E594 CDD9EF          17      CALL    _CHGDRV
001833 E597 D0              11      RET NC
       E598                     DRDNE:
001834 E598 9F               4      SBC A,A     ;CF=1ならばA=0FFH
001835 E599 32A5EF          13      LD  (_DBDRV),A
001838 E59C C9              10      RET
                                
                                ;   CDE:セクタ番号
       E59D                     DRDY:
001839 E59D 3AC6E5          13      LD  A,(_DBS24+1)
00183C E5A0 B9               4      CP  C
00183D E5A1 C0              11      RET NZ
                                
00183E E5A2 E5              11      PUSH    HL
00183F E5A3 3A88EF          13      LD  A,(_DRV)
001842 E5A6 21A5EF          10      LD  HL,_DBDRV
001845 E5A9 AE               7      XOR (HL)
001846 E5AA 2005            12      JR  NZ,POP_HL_RET
                                
001848 E5AC 2AA6EF          16      LD  HL,(_DBSEC)
00184B E5AF ED52            15      SBC HL,DE       ;CF=0
       E5B1                     POP_HL_RET:
00184D E5B1 E1              10      POP HL
00184E E5B2 C9              10      RET
                                
       E5B3                     DWTX:
00184F E5B3 3AA4EF          13      LD  A,(_WTDBF)
001852 E5B6 B7               4      OR  A
001853 E5B7 C8              11      RET Z
001854 E5B8 AF               4      XOR A
001855 E5B9 32A4EF          13      LD  (_WTDBF),A
                                
001858 E5BC E5              11      PUSH    HL
001859 E5BD C5              11      PUSH    BC
00185A E5BE D5              11      PUSH    DE
00185B E5BF 3AA5EF          13      LD  A,(_DBDRV)
00185E E5C2 CDD9EF          17      CALL    _CHGDRV
001861 E5C5 0E00             7  _DBS24: LD  C,0
001863 E5C7 ED5BA6EF        20      LD  DE,(_DBSEC)
001867 E5CB 2A7EF0          16      LD  HL,(_DTBUF)
00186A E5CE D458E8          17      CALL    NC,DWT24
       E5D1                     POP_DE_BC_HL_RET2:
00186D E5D1 18A4            12      JR  POP_DE_BC_HL_RET
                                
       E5D3                     RDFATX:
00186F E5D3 E5              11      PUSH    HL
001870 E5D4 3A88EF          13      LD  A,(_DRV)
001873 E5D7 21AAEF          10      LD  HL,_FATDRV
001876 E5DA AE               7      XOR (HL)
001877 E5DB 28D4            12      JR  Z,POP_HL_RET
                                
001879 E5DD C5              11      PUSH    BC
00187A E5DE D5              11      PUSH    DE
00187B E5DF DDE5            15      PUSH    IX
00187D E5E1 CDFDE5          17      CALL    WTFATX
001880 E5E4 3813            12      JR  C,POP_IX_DE_BC_HL_RET
                                
001882 E5E6 AF               4      XOR A
001883 E5E7 32ABEF          13      LD  (_FATIX),A
001886 E5EA 3A88EF          13      LD  A,(_DRV)
001889 E5ED 32AAEF          13      LD  (_FATDRV),A
00188C E5F0 CDE5EF          17      CALL    _RDFAT
       E5F3                     RDFATE2:
00188F E5F3 3004            12      JR  NC,POP_IX_DE_BC_HL_RET
001891 E5F5 9F               4      SBC A,A     ;A=0xFF
001892 E5F6 32AAEF          13      LD  (_FATDRV),A
       E5F9                     POP_IX_DE_BC_HL_RET:
001895 E5F9 DDE1            14      POP IX
001897 E5FB 18D4            12      JR  POP_DE_BC_HL_RET2
                                
       E5FD                     WTFATX:
001899 E5FD 3AA2EF          13      LD  A,(_WTFATF)
00189C E600 B7               4      OR  A
00189D E601 C8              11      RET Z
00189E E602 E5              11      PUSH    HL
00189F E603 3AAAEF          13      LD  A,(_FATDRV)
0018A2 E606 21A5EF          10      LD  HL,_DBDRV
0018A5 E609 AE               7      XOR (HL)
0018A6 E60A CCB3E5          17      CALL    Z,DWTX
0018A9 E60D 38A2            12      JR  C,POP_HL_RET
0018AB E60F C5              11      PUSH    BC
0018AC E610 D5              11      PUSH    DE
0018AD E611 DDE5            15      PUSH    IX
0018AF E613 CD65E8          17      CALL    WTFAT
0018B2 E616 AF               4      XOR A
0018B3 E617 32A2EF          13      LD  (_WTFATF),A
0018B6 E61A 18DD            12      JR  POP_IX_DE_BC_HL_RET
                                
       E61C                     NCL1:
0018B8 E61C 7A               4      LD  A,D
0018B9 E61D B3               4      OR  E
0018BA E61E 37               4      SCF
0018BB E61F C8              11      RET Z
                                
0018BC E620 7A               4      LD  A,D
0018BD E621 CB3F             8      SRL A   ;/2
0018BF E623 CB3F             8      SRL A   ;/2
                                
0018C1 E625 E5              11      PUSH    HL
0018C2 E626 3245E6          13      LD  (NCLPAT+2),A    ;_FATIX
0018C5 E629 2AAAEF          16      LD  HL,(_FATDRV)    ;L=_FATDRV H=_FATIX
0018C8 E62C BC               4      CP  H
0018C9 E62D 3A88EF          13      LD  A,(_DRV)    ;この間でフラグは変化しない
0018CC E630 3244E6          13      LD  (NCLPAT+1),A    ;_FATDRV
0018CF E633 2005            12      JR  NZ,NCL2     ;FATIXが違う
0018D1 E635 BD               4      CP  L
0018D2 E636 2002            12      JR  NZ,NCL2     ;ドライブが違う
0018D4 E638 E1              10      POP HL
0018D5 E639 C9              10      RET
       E63A                     NCL2:
0018D6 E63A C5              11      PUSH    BC
0018D7 E63B D5              11      PUSH    DE
0018D8 E63C DDE5            15      PUSH    IX
0018DA E63E CDFDE5          17      CALL    WTFATX
0018DD E641 38B6            12      JR  C,POP_IX_DE_BC_HL_RET
0018DF E643 010000          10  NCLPAT: LD  BC,0        ;自己書き換え C=_FATDRV B=_FATIX
0018E2 E646 ED43AAEF        20      LD  (_FATDRV),BC
0018E6 E64A CD3AE8          17      CALL    RDFATS
0018E9 E64D 18A4            12      JR  RDFATE2
                                
       E64F                     NCL3:
0018EB E64F CB9A             8      RES 3,D
0018ED E651 CB92             8      RES 2,D
0018EF E653 6B               4      LD  L,E
0018F0 E654 62               4      LD  H,D
0018F1 E655 CB3C             8      SRL H   ;
0018F3 E657 CB1D             8      RR  L   ;HLA=HLA/2
0018F5 E659 1F               4      RRA     ;
0018F6 E65A F5              11      PUSH    AF
0018F7 E65B 3AABEF          13      LD  A,(_FATIX)
0018FA E65E 0F               4      RRCA
0018FB E65F 300B            12      JR  NC,NCL3X1
0018FD E661 3AFAE4          13      LD  A,(SECSZ+2)
001900 E664 FE04             7      CP  4       ;1セクタ1024バイトの場合は奇数インデックスの場合に先頭を512バイトずらす
001902 E666 2004            12      JR  NZ,NCL3X1
001904 E668 010002          10      LD  BC,512
001907 E66B 09              11      ADD HL,BC
       E66C                     NCL3X1:
001908 E66C F1              10      POP AF
001909 E66D ED4B7CF0        20      LD  BC,(_FATBF)
00190D E671 19              11      ADD HL,DE
00190E E672 09              11      ADD HL,BC
00190F E673 17               4      RLA
001910 E674 C9              10      RET
                                
       E675                     GNCL:
001911 E675 CD1CE6          17      CALL    NCL1        ;GET NEXT CLUSTER
001914 E678 D8              11      RET C
001915 E679 C5              11      PUSH    BC
001916 E67A E5              11      PUSH    HL
001917 E67B CD4FE6          17      CALL    NCL3
00191A E67E 3809            12      JR  C,GNC1
00191C E680 5E               7      LD  E,(HL)
00191D E681 23               6      INC HL
00191E E682 7E               7      LD  A,(HL)
00191F E683 E60F             7      AND 00FH
001921 E685 57               4      LD  D,A
001922 E686 E1              10      POP HL
001923 E687 C1              10      POP BC
001924 E688 C9              10      RET
       E689                     GNC1:
001925 E689 7E               7      LD  A,(HL)
001926 E68A 23               6      INC HL
001927 E68B 56               7      LD  D,(HL)
001928 E68C 0604             7      LD  B,4
       E68E                     GNC1L:
00192A E68E CB3A             8      SRL D   ;DA=DA/2
00192C E690 1F               4      RRA     ;
00192D E691 10FB            13      DJNZ    GNC1L
                                
00192F E693 5F               4      LD  E,A
001930 E694 E1              10      POP HL
001931 E695 C1              10      POP BC
001932 E696 A7               4      AND A
001933 E697 C9              10      RET
                                
       E698                     SNCL:
001934 E698 CD1CE6          17      CALL    NCL1
001937 E69B D8              11      RET C
                                ;               SET NEXT CLUSTER
001938 E69C E5              11      PUSH    HL
001939 E69D C5              11      PUSH    BC
00193A E69E D5              11      PUSH    DE
00193B E69F E5              11      PUSH    HL
00193C E6A0 CD4FE6          17      CALL    NCL3
00193F E6A3 D1              10      POP DE
                                ;CF=ODD
001940 E6A4 7E               7      LD  A,(HL)
001941 E6A5 73               7      LD  (HL),E
001942 E6A6 3806            12      JR  C,SNC1
                                ;EVEN
                                ;M[0] = E
                                ;M[1] = (M[1] & 0xF0) | (D & 0x0F)
001944 E6A8 23               6      INC HL
001945 E6A9 ED67            18      RRD     ;M={A[3:0],E[3:0]}
001947 E6AB 7A               4      LD  A,D
001948 E6AC 1804            12      JR  SNC11
       E6AE                     SNC1:
                                ;ODD
                                ;HL[0] = (HL[0]&0x0F) | (E<<4)
                                ;HL[1] = DE>>4
00194A E6AE ED6F            18      RLD     ;M={D[3:0],E[7:4]}
00194C E6B0 23               6      INC HL
00194D E6B1 72               7      LD  (HL),D  ;M={D[3:0],E[7:4]}
       E6B2                     SNC11:
00194E E6B2 ED6F            18      RLD     ;M={M[7:4],D[3:0]}
001950 E6B4 B7               4      OR  A
001951 E6B5 D1              10      POP DE
001952 E6B6 C1              10      POP BC
001953 E6B7 E1              10      POP HL
       E6B8                     FAT_CHANGED:
001954 E6B8 3E01             7      LD  A,1
001956 E6BA 32A2EF          13      LD  (_WTFATF),A
001959 E6BD C9              10      RET
                                
       E6BE                     N16CL3:
00195A E6BE C5              11      PUSH    BC
00195B E6BF 6B               4      LD  L,E
00195C E6C0 7A               4      LD  A,D
00195D E6C1 E603             7      AND 3
00195F E6C3 67               4      LD  H,A
001960 E6C4 29              11      ADD HL,HL
001961 E6C5 ED4B7CF0        20      LD  BC,(_FATBF)
001965 E6C9 09              11      ADD HL,BC
001966 E6CA C1              10      POP BC
001967 E6CB C9              10      RET
                                
       E6CC                     GNCL16:
001968 E6CC CD1CE6          17      CALL    NCL1        ;GET NEXT CLUSTER for FAT16
00196B E6CF D8              11      RET C
00196C E6D0 E5              11      PUSH    HL
00196D E6D1 CDBEE6          17      CALL    N16CL3
001970 E6D4 5E               7      LD  E,(HL)
001971 E6D5 23               6      INC HL
001972 E6D6 56               7      LD  D,(HL)
001973 E6D7 E1              10      POP HL
001974 E6D8 C9              10      RET
                                
       E6D9                     SNCL16:
001975 E6D9 CD1CE6          17      CALL    NCL1        ;GET NEXT CLUSTER for FAT16
001978 E6DC D8              11      RET C
001979 E6DD D5              11      PUSH    DE
00197A E6DE E5              11      PUSH    HL
00197B E6DF CDBEE6          17      CALL    N16CL3
00197E E6E2 D1              10      POP DE      ;HL
00197F E6E3 73               7      LD  (HL),E
001980 E6E4 23               6      INC HL
001981 E6E5 72               7      LD  (HL),D
001982 E6E6 6B               4      LD  L,E
001983 E6E7 62               4      LD  H,D
001984 E6E8 D1              10      POP DE
001985 E6E9 18CD            12      JR  FAT_CHANGED
                                
                                ;------------------------
                                ;次のセクタを探す際に_SECPSの値をチェック
                                ;in
                                ;   DE : セクタ番号
                                ;out
                                ;   DE : 次のセクタ番号
                                ;note
                                ;
                                ;------------------------
       E6EB                     NEXTX:
001987 E6EB 3E00             7  _SECPS: LD  A,0 ;自己書き換え
001989 E6ED 3C               4      INC A
00198A E6EE E600             7  NCPAT:  AND 0   ;自己書き換え　1クラスタの論理セクタ数-1
00198C E6F0 32ECE6          13      LD  (_SECPS+1),A
00198F E6F3 C9              10      RET
                                
       E6F4                     GNCLX:
001990 E6F4 CDEBE6          17      CALL    NEXTX
001993 E6F7 C0              11      RET NZ  ;1クラスタのセクタ未満の場合は戻る
001994 E6F8 C3F7EF          10      JP  _GNCL   ;次のクラスタを探す
                                
       E6FB                     RDFAT:
001997 E6FB 3E80             7      LD  A,080H
001999 E6FD 3270EF          13      LD  (CHECK),A
       E700                     RDFAT1:
00199C E700 3A88EF          13      LD  A,(_DRV)
00199F E703 CD98E9          17      CALL    CHGDRVR
0019A2 E706 D8              11      RET C
0019A3 E707 DD7E12          19      LD  A,(IX+012H) ;DPB_12_DEVICE
0019A6 E70A CB6F             8      BIT 5,A
0019A8 E70C 2843            12      JR  Z,RDFAT0X
0019AA E70E 2170EF          10      LD  HL,CHECK
0019AD E711 A6               7      AND (HL)
0019AE E712 77               7      LD  (HL),A
0019AF E713 110000          10      LD  DE,0        ;BPB
0019B2 E716 2A7CF0          16      LD  HL,(_FATBF)
0019B5 E719 CD46E8          17      CALL    DRD16
0019B8 E71C 3024            12      JR  NC,GETBPB
0019BA E71E 2170EF          10      LD  HL,CHECK
0019BD E721 CB06            15      RLC (HL)
0019BF E723 3F               4      CCF
0019C0 E724 D8              11      RET C
0019C1 E725 DDCB0A1E        23      RR  (IX+00AH)   ;DPB_0A_FDMODE
0019C5 E729 3F               4      CCF         ;フロッピーディスクのMFMモードを切り替える
0019C6 E72A DDCB0A16        23      RL  (IX+00AH)   ;DPB_0A_FDMODE
0019CA E72E 3EFF             7      LD  A,0FFH
0019CC E730 3289EF          13      LD  (_DSK),A
0019CF E733 3A84EF          13      LD  A,(_DRIVE)
0019D2 E736 E603             7      AND 3
0019D4 E738 F680             7      OR  080H
0019D6 E73A 6F               4      LD  L,A
0019D7 E73B 26EF             7      LD  H,_CYL0/256
0019D9 E73D 3EFF             7      LD  A,0FFH
0019DB E73F 77               7      LD  (HL),A
0019DC E740 18BE            12      JR  RDFAT1
       E742                     GETBPB:
0019DE E742 FDE5            15      PUSH    IY
0019E0 E744 FD2A7CF0        20      LD  IY,(_FATBF) ;BPB
0019E4 E748 CDF1EF          17      CALL    _BPB2DPB
0019E7 E74B FDE1            14      POP IY
0019E9 E74D D8              11      RET C
0019EA E74E CDEEE8          17      CALL    CHGDRV2
       E751                     RDFAT0X:
0019ED E751 CD3AE8          17      CALL    RDFATS
0019F0 E754 D8              11      RET C
0019F1 E755 DDBE06           7      CP  (IX+6)      ;DPB_06_FATID
0019F4 E758 C8              11      RET Z
0019F5 E759 DDCB126E        20      BIT 5,(IX+012H) ;DPB_12_DEVICE
0019F9 E75D C0              11      RET NZ      ;BPBを取得している場合はFATIDをチェックしない
0019FA E75E 37               4      SCF
0019FB E75F C9              10      RET
                                
       E760                     BPB2DPB:
0019FC E760 FD7E00          19      LD  A,(IY+0)    ;BS_JmpBoot
0019FF E763 FEEB             7      CP  0EBH        ;Short jump
001A01 E765 2808            12      JR  Z,BPBOK
001A03 E767 FEE9             7      CP  0E9H        ;Near jump
001A05 E769 2804            12      JR  Z,BPBOK
001A07 E76B FE60             7      CP  060H        ;X68k
001A09 E76D 37               4      SCF
001A0A E76E C0              11      RET NZ
       E76F                     BPBOK:
001A0B E76F FD7E0D          19      LD  A,(IY+13)   ;BPB_SecPerClus
001A0E E772 DD7707          19      LD  (IX+7),A    ;DPB_07_SECPCL
                                
001A11 E775 FD7E16          19      LD  A,(IY+22)   ;BPB_FATSz16
001A14 E778 DD7700          19      LD  (IX+0),A    ;DPB_00_FATLN
001A17 E77B FD7E17          19      LD  A,(IY+23)   ;BPB_FATSz16
001A1A E77E DD7701          19      LD  (IX+1),A    ;DPB_00_FATLN
                                
001A1D E781 FD6E0E          19      LD  L,(IY+14)   ;BPB_RsvdSecCnt
001A20 E784 FD660F          19      LD  H,(IY+15)
001A23 E787 DD750E          19      LD  (IX+00EH),L ;DPB_0E_FATPS
001A26 E78A FD5E16          19      LD  E,(IY+22)   ;BPB_FATSz16
001A29 E78D FD5617          19      LD  D,(IY+23)
001A2C E790 FD4610          19      LD  B,(IY+16)   ;BPB_NumFATs
       E793                     BPBDP1:             ;BPB_FATSz16 * BPB_NumFATs
001A2F E793 19              11      ADD HL,DE
001A30 E794 10FD            13      DJNZ    BPBDP1
       E796                     BPBDP2:
001A32 E796 DD7510          19      LD  (IX+010H),L ;DPB_10_DIRPS
001A35 E799 DD7411          19      LD  (IX+011H),H
001A38 E79C E5              11      PUSH    HL
                                
001A39 E79D FD6E11          19      LD  L,(IY+17)   ;BPB_RootEntCnt
001A3C E7A0 FD6612          19      LD  H,(IY+18)
001A3F E7A3 FD7E0C          19      LD  A,(IY+12)   ;BPB_BytsPerSec
001A42 E7A6 0606             7      LD  B,6
       E7A8                     BPBBPS1:
001A44 E7A8 05               4      DEC B
001A45 E7A9 0F               4      RRCA
001A46 E7AA 30FC            12      JR  NC,BPBBPS1
       E7AC                     BPBDE1:
001A48 E7AC 29              11      ADD HL,HL
001A49 E7AD 10FD            13      DJNZ    BPBDE1
                                
001A4B E7AF 7C               4      LD  A,H
001A4C E7B0 DD770B          19      LD  (IX+00BH),A ;DPB_0B_DIRSCNT
                                
001A4F E7B3 D1              10      POP DE      ;DPB_10_DIRPS
001A50 E7B4 6C               4      LD  L,H
001A51 E7B5 2600             7      LD  H,0
001A53 E7B7 19              11      ADD HL,DE       ;MAXDIR
001A54 E7B8 E5              11      PUSH    HL
001A55 E7B9 FD4E0D          19      LD  C,(IY+13)   ;BPB_SecPerClus
001A58 E7BC CB21             8      SLA C       ;*2
001A5A E7BE AF               4      XOR A
001A5B E7BF 47               4      LD  B,A
001A5C E7C0 ED42            15      SBC HL,BC
001A5E E7C2 DD7514          19      LD  (IX+014H),L ;DPB_14_ADDCL16
001A61 E7C5 DD7415          19      LD  (IX+015H),H
                                
001A64 E7C8 D1              10      POP DE      ;DE=DPB_0B_MAXDIR
001A65 E7C9 FD6E13          19      LD  L,(IY+19)   ;BPB_TotSec16
001A68 E7CC FD6614          19      LD  H,(IY+20)
001A6B E7CF 7C               4      LD  A,H
001A6C E7D0 B5               4      OR  L
001A6D E7D1 3E00             7      LD  A,0     ;LDでフラグは変化しない。BPB_TotSec16を AHL で扱う為、Aに0を入れる
001A6F E7D3 2010            12      JR  NZ,BPB16BIT ;BPB_TotSec16が「0」の場合はBPB_TotSec32で計算
001A71 E7D5 FD7E23          19      LD  A,(IY+35)   ;念のために総セクタ数が24ビットを超える場合はエラーを返す
001A74 E7D8 B7               4      OR  A
001A75 E7D9 37               4      SCF
001A76 E7DA C0              11      RET NZ
001A77 E7DB FD6E20          19      LD  L,(IY+32)   ;BPB_TotSec32 は AHL の24ビットで扱う
001A7A E7DE FD6621          19      LD  H,(IY+33)   ;1クラスタの論理セクタ数(DPB_07_SECPCL)が最大128なので
001A7D E7E1 FD7E22          19      LD  A,(IY+34)   ;24ビットを超えると必ずクラスタ数が16ビットを超えてしまうのでこれで十分
001A80 E7E4 A7               4      AND A       ;CF=0
       E7E5                     BPB16BIT:
001A81 E7E5 ED52            15      SBC HL,DE
001A83 E7E7 DE00             7      SBC A,0
001A85 E7E9 FD460D          19      LD  B,(IY+13)   ;BPB_SecPerClus
       E7EC                     BPBTC1:             ;総クラスタ数(AHL) = 総セクタ数(AHL) / セクタサイズ(B)
001A88 E7EC CB18             8      RR  B       ;->CY
001A8A E7EE 3808            12      JR  C,BPBTC2
001A8C E7F0 CB3F             8      SRL A
001A8E E7F2 CB1C             8      RR  H       ;AHL=AHL/2
001A90 E7F4 CB1D             8      RR  L
001A92 E7F6 18F4            12      JR  BPBTC1
       E7F8                     BPBTC2:
001A94 E7F8 B7               4      OR  A
001A95 E7F9 37               4      SCF
001A96 E7FA C0              11      RET NZ      ;念のため(クラスタ数が16ビットを超える場合)
001A97 E7FB 23               6      INC HL
001A98 E7FC 23               6      INC HL
001A99 E7FD DD7508          19      LD  (IX+8),L    ;DPB_08_MAXCL
001A9C E800 DD7409          19      LD  (IX+9),H
                                
001A9F E803 FD7E15          19      LD  A,(IY+21)   ;BPB_Media
001AA2 E806 DD7706          19      LD  (IX+6),A    ;DPB_06_FATID
                                
001AA5 E809 DDCB0A7E        20      BIT 7,(IX+00AH) ;DPB_0A_FDMODE
001AA9 E80D 2817            12      JR  Z,NOT_FD
001AAB E80F 2E28             7      LD  L,40        ;MAXCYLの設定（要検討）ここから下はフロッピーのみ書き換える
001AAD E811 FEFD             7      CP  0FDH    ;2D
001AAF E813 2808            12      JR  Z,SETCYL
001AB1 E815 2E4D             7      LD  L,77
001AB3 E817 FEFE             7      CP  0FEH    ;2HD
001AB5 E819 2802            12      JR  Z,SETCYL
001AB7 E81B 2E50             7      LD  L,80    ;その他2DD等
       E81D                     SETCYL:
001AB9 E81D DD750C          19      LD  (IX+00CH),L ;DPB_0C_MAXCYL
001ABC E820 FD7E18          19      LD  A,(IY+24)   ;BPB_SecPerTr
001ABF E823 DD770D          19      LD  (IX+00DH),A ;DPB_0D_MAXSEC  ;ここまでフロッピー専用
       E826                     NOT_FD:
001AC2 E826 FD7E10          19      LD  A,(IY+16)   ;BPB_NumFATs
001AC5 E829 FE02             7      CP  2       ;>2:NC
001AC7 E82B FD7E0C          19      LD  A,(IY+12)   ;BPB_BytsPerSec
001ACA E82E 3802            12      JR  C,BPBFAT1
001ACC E830 F680             7      OR  080H
       E832                     BPBFAT1:
001ACE E832 DD770F          19      LD  (IX+00FH),A ;DPB_0F_BPS
                                
001AD1 E835 E67F             7      AND 07FH        ;セクタバッファが1KBしかないので1KBを超える場合はCF=1でエラーにする
001AD3 E837 C6FB             7      ADD A,0-5       ;0-4:CF=0 5以上:CF=1
001AD5 E839 C9              10      RET
                                
       E83A                     RDFATS:
001AD6 E83A CD80E8          17      CALL    FATSETUP
001AD9 E83D D8              11      RET C
001ADA E83E CD4AE8          17      CALL    DRD24B
001ADD E841 2A7CF0          16      LD  HL,(_FATBF)
001AE0 E844 7E               7      LD  A,(HL)
001AE1 E845 C9              10      RET
                                
       E846                     DRD16:
001AE2 E846 0E00             7      LD  C,0
       E848                     DRD24:
001AE4 E848 0601             7      LD  B,1
       E84A                     DRD24B:
001AE6 E84A DDE5            15      PUSH    IX
001AE8 E84C DD2AA8EF        20      LD  IX,(_DPB)
001AEC E850 CDE8EA          17  DRDPAT: CALL    FDRD        ;自己書き換え（ディスク読み込み）
       E853                     POP_IX_RET:
001AEF E853 DDE1            14      POP IX
001AF1 E855 C9              10      RET
                                
       E856                     DWT16:
001AF2 E856 0E00             7      LD  C,0
       E858                     DWT24:
001AF4 E858 0601             7      LD  B,1
       E85A                     DWT24B:
001AF6 E85A DDE5            15      PUSH    IX
001AF8 E85C DD2AA8EF        20      LD  IX,(_DPB)
001AFC E860 CD8BEA          17  DWTPAT: CALL    FDWT        ;自己書き換え（ディスク書き込み）
001AFF E863 18EE            12      JR  POP_IX_RET
                                
       E865                     WTFAT:
001B01 E865 CD80E8          17      CALL    FATSETUP
001B04 E868 D45AE8          17      CALL    NC,DWT24B
001B07 E86B D8              11      RET C
001B08 E86C DDCB0F7E        20      BIT 7,(IX+00FH) ;DPB_0F_BPS
001B0C E870 C8              11      RET Z       ;予備FATが無い
001B0D E871 CD87E8          17      CALL    FATS2
001B10 E874 E5              11      PUSH    HL      ;予備FAT
001B11 E875 DD6E00          19      LD  L,(IX+0)    ;DPB_00_FATLN
001B14 E878 DD6601          19      LD  H,(IX+1)
001B17 E87B 19              11      ADD HL,DE
001B18 E87C EB               4      EX  DE,HL
001B19 E87D E1              10      POP HL
001B1A E87E 18DA            12      JR  DWT24B
                                ;------------------------
                                ;FATのセットアップ
                                ;out
                                ;   B  : FATセクタ数
                                ;   DE : FAT先頭セクタ番号
                                ;   HL : FATバッファポインタ
                                ;   CF : 1=ドライブ切り替えエラー
                                ;note
                                ;   FATサイズがFATバッファを超える場合は
                                ;   対象クラスタ領域==(_FATIX)によって
                                ;   FAT12:対象クラスタ1024毎に1.5KBを切り替える
                                ;   FAT16:対象クラスタ1024毎に2KBを切り替える
                                ;------------------------
       E880                     FATSETUP:
001B1C E880 3AAAEF          13      LD  A,(_FATDRV)
001B1F E883 CD98E9          17      CALL    CHGDRVR     ;ドライブ切り替え
001B22 E886 D8              11      RET C
       E887                     FATS2:
001B23 E887 DD7E0F          19      LD  A,(IX+00FH) ;DPB_0F_BPS 512=2 1024=4
001B26 E88A 0F               4      RRCA
001B27 E88B CDB4E8          17  FATSX:  CALL    FATSETUP12  ;自己書き換え
001B2A E88E 210000          10      LD  HL,0
001B2D E891 4A               4      LD  C,D
001B2E E892 54               4      LD  D,H
001B2F E893 3AABEF          13      LD  A,(_FATIX)  ;範囲FAT12:0-3/FAT16:0-63(0-03FH):65535*2/2048
001B32 E896 47               4      LD  B,A
001B33 E897 04               4      INC B
001B34 E898 DD7E00          19      LD  A,(IX+0)    ;DPB_00_FATLN
       E89B                     FAT_SKP:
001B37 E89B 05               4      DEC B
001B38 E89C 2805            12      JR  Z,FAT1
001B3A E89E 19              11      ADD HL,DE
001B3B E89F 93               4      SUB E
001B3C E8A0 30F9            12      JR  NC,FAT_SKP
001B3E E8A2 C9              10      RET
       E8A3                     FAT1:
001B3F E8A3 EB               4      EX  DE,HL
001B40 E8A4 B9               4      CP  C       ;C=FATバッファに読み込めるセクタ数
001B41 E8A5 3801            12      JR  C,FAT2
001B43 E8A7 79               4      LD  A,C
       E8A8                     FAT2:
001B44 E8A8 47               4      LD  B,A
                                
001B45 E8A9 2AFAF0          16      LD  HL,(_FATPS) ;fat sector pos
001B48 E8AC 19              11      ADD HL,DE
001B49 E8AD EB               4      EX  DE,HL
001B4A E8AE 2A7CF0          16      LD  HL,(_FATBF)
001B4D E8B1 AF               4      XOR A       ;CF=0
001B4E E8B2 4F               4      LD  C,A
001B4F E8B3 C9              10      RET
                                ;
                                ;   FATバッファに読み込める最大のセクタ数と_FATIXで進めるセクタ数
                                ;   FATSETUP* (FAT12/FAT16)
                                ;out
                                ;   D : FATバッファに読み込める最大のセクタ数
                                ;   E : _FATIXで進めるセクタ数
       E8B4                     FATSETUP12:
001B50 E8B4 110606          10      LD  DE,0606H    ;256
001B53 E8B7 D8              11      RET C
001B54 E8B8 110303          10      LD  DE,0303H    ;512
001B57 E8BB 0F               4      RRCA
001B58 E8BC D8              11      RET C
001B59 E8BD 110102          10      LD  DE,0201H    ;1024
001B5C E8C0 C9              10      RET
                                
       E8C1                     FATSETUP16:
001B5D E8C1 110808          10      LD  DE,0808H    ;256
001B60 E8C4 D8              11      RET C
001B61 E8C5 110404          10      LD  DE,0404H
001B64 E8C8 0F               4      RRCA            ;512
001B65 E8C9 D8              11      RET C
001B66 E8CA 110202          10      LD  DE,0202H    ;1024
001B69 E8CD C9              10      RET
                                
       E8CE                     CHGDRV:
001B6A E8CE E5              11      PUSH    HL
001B6B E8CF 2189EF          10      LD  HL,_DSK
001B6E E8D2 BE               7      CP  (HL)
001B6F E8D3 280A            12      JR  Z,CHGDRVE
       E8D5                     CHGDRV1:
001B71 E8D5 DDE5            15      PUSH    IX
001B73 E8D7 CDE1E8          17      CALL    CHGDRV0
001B76 E8DA 3A89EF          13      LD  A,(_DSK)
001B79 E8DD DDE1            14      POP IX
       E8DF                     CHGDRVE:
001B7B E8DF E1              10      POP HL
001B7C E8E0 C9              10      RET
                                
       E8E1                     CHGDRV0:
001B7D E8E1 6F               4      LD  L,A
001B7E E8E2 CDDCEF          17      CALL    _GETDPB
001B81 E8E5 D8              11      RET C
001B82 E8E6 DD22A8EF        20      LD  (_DPB),IX
001B86 E8EA 7D               4      LD  A,L
001B87 E8EB 3289EF          13      LD  (_DSK),A
       E8EE                     CHGDRV2:
001B8A E8EE C5              11      PUSH    BC
001B8B E8EF D5              11      PUSH    DE
001B8C E8F0 ED734DE9        20      LD  (SPPAT2+1),SP
001B90 E8F4 F3               4      DI
001B91 E8F5 DDF9            10      LD  SP,IX
                                
001B93 E8F7 E1              10      POP HL      ;DPB_00_FATLN
001B94 E8F8 E1              10      POP HL      ;DPB_02_DRD
001B95 E8F9 2251E8          16      LD  (DRDPAT+1),HL
                                
001B98 E8FC E1              10      POP HL
001B99 E8FD 2261E8          16      LD  (DWTPAT+1),HL   ;DPB_04_DWT
                                
001B9C E900 E1              10      POP HL      ;L=DPB_06_FATID H=DPB_07_SECPCL
001B9D E901 7C               4      LD  A,H
001B9E E902 3243E0          13      LD  (SPCPAT+1),A    ;1クラスタの論理セクタ数
001BA1 E905 3D               4      DEC A
001BA2 E906 32EFE6          13      LD  (NCPAT+1),A
                                
001BA5 E909 E1              10      POP HL      ;DPB_08_MAXCL
001BA6 E90A 7D               4      LD  A,L
001BA7 E90B 3262E0          13      LD  (CLPAT2+1),A
001BAA E90E 7C               4      LD  A,H
001BAB E90F 325EE0          13      LD  (CLPAT1+1),A
001BAE E912 2B               6      DEC HL
001BAF E913 225CE2          16      LD  (MAXCLP+1),HL
                                
001BB2 E916 E1              10      POP HL      ;L=DPB_0A_FDMODE H=DPB_0B_DIRSCNT
001BB3 E917 7D               4      LD  A,L
001BB4 E918 F6FE             7      OR  0FEH
001BB6 E91A 3288EB          13      LD  (FDMODE+1),A
001BB9 E91D 07               4      RLCA
001BBA E91E E603             7      AND 3
001BBC E920 322AEA          13      LD  (FSPAT+1),A
001BBF E923 4C               4      LD  C,H
                                
001BC0 E924 E1              10      POP HL      ;L=DPB_0C_MAXCYL H=DPB_0D_MAXSEC
001BC1 E925 7D               4      LD  A,L
001BC2 E926 32A1EF          13      LD  (_MAXCYL),A
001BC5 E929 7C               4      LD  A,H
001BC6 E92A 32E4E9          13      LD  (MAXSEC+1),A
                                
001BC9 E92D E1              10      POP HL      ;L=DPB_0E_FATPS H=DPB_0F_BPS
001BCA E92E 7C               4      LD  A,H     ;DPB_0F_BPS
001BCB E92F E607             7      AND 7
001BCD E931 32FAE4          13      LD  (SECSZ+2),A ;1セクタのサイズの上位1バイト 0x400 - 0x200 - 0x100
                                                ;1セクタ512 2D/2DD/2HC/2HQ(2HD1.44MB)/EMM/BRAM等
                                                ;1セクタ1024 2HD/2HDE98
                                                ;1セクタ256 GRAM等
                                                ;1024   512 256
                                                ;4  2   1
001BD0 E934 87               4      ADD A,A     ;8  4   2
001BD1 E935 87               4      ADD A,A     ;010H   8   4
001BD2 E936 87               4      ADD A,A     ;020H   010H    8
001BD3 E937 32BFDE          13      LD  (SDECPAT+1),A   ;1セクタ辺りのディレクトリエントリ数
                                
001BD6 E93A 2600             7      LD  H,0
001BD8 E93C 22FAF0          16      LD  (_FATPS),HL
                                
001BDB E93F E1              10      POP HL      ;L=DPB_10_DIRPS
001BDC E940 22FCF0          16      LD  (_DIRPS),HL
                                
001BDF E943 E1              10      POP HL      ;L=DPB_12_DEVICE H=DPB_13_UNITNO
001BE0 E944 7C               4      LD  A,H
001BE1 E945 3284EF          13      LD  (_DRIVE),A
                                
001BE4 E948 E1              10      POP HL      ;DPB_14_ADDCL16
001BE5 E949 2253E0          16      LD  (CLSPAT+1),HL
                                
001BE8 E94C 310000          10  SPPAT2: LD  SP,0        ;元のSPを復元
001BEB E94F FB               4      EI
001BEC E950 2AFCF0          16      LD  HL,(_DIRPS)
001BEF E953 0600             7      LD  B,0
001BF1 E955 09              11      ADD HL,BC
001BF2 E956 22DADE          16      LD  (MD_PAT+1),HL
                                
001BF5 E959 2A5CE2          16      LD  HL,(MAXCLP+1);
001BF8 E95C 11F60F          10      LD  DE,4086
001BFB E95F B7               4      OR  A
001BFC E960 ED52            15      SBC HL,DE
001BFE E962 300F            12      JR  NC,SETFAT16
001C00 E964 2175E6          10      LD  HL,GNCL     ;FAT12
001C03 E967 1198E6          10      LD  DE,SNCL
001C06 E96A 01B4E8          10      LD  BC,FATSETUP12
001C09 E96D DDCB0FAE        23      RES 5,(IX+00FH) ;DPB_0F_BPS(FAT12)
001C0D E971 180D            12      JR  EXTRA1
       E973                     SETFAT16:
001C0F E973 21CCE6          10      LD  HL,GNCL16   ;FAT16
001C12 E976 11D9E6          10      LD  DE,SNCL16
001C15 E979 01C1E8          10      LD  BC,FATSETUP16
001C18 E97C DDCB0FEE        23      SET 5,(IX+00FH) ;DPB_0F_BPS(FAT16)
       E980                     EXTRA1:
001C1C E980 22F8EF          16      LD  (GNCPAT+1),HL
001C1F E983 ED53FBEF        20      LD  (SNCPAT+1),DE
001C23 E987 ED438CE8        20      LD  (FATSX+1),BC
001C27 E98B D1              10      POP DE
001C28 E98C C1              10      POP BC
001C29 E98D AF               4      XOR A
001C2A E98E C9              10      RET
                                
       E98F                     GETDPBD:
001C2B E98F DDE3            23      EX  (SP),IX
001C2D E991 DDE5            15      PUSH    IX
001C2F E993 3A88EF          13      LD  A,(_DRV)
001C32 E996 1807            12      JR  GETDPB1
                                
       E998                     CHGDRVR:
001C34 E998 CDD9EF          17      CALL    _CHGDRV
001C37 E99B D8              11      RET C
001C38 E99C 3A89EF          13      LD  A,(_DSK)
       E99F                     GETDPB1:
001C3B E99F C3DCEF          10      JP  _GETDPB
                                
       E9A2                     GETDPB:
001C3E E9A2 FE08             7      CP  8
001C40 E9A4 3F               4      CCF
001C41 E9A5 D8              11      RET C
001C42 E9A6 0F               4      RRCA
001C43 E9A7 0F               4      RRCA
001C44 E9A8 0F               4      RRCA
001C45 E9A9 DD                      DB  0DDH        ;Z80未定義命令
001C46 E9AA 6F               4      LD  L,A     ;LD IXL,A
001C47 E9AB DD                      DB  0DDH        ;Z80未定義命令
001C48 E9AC 26F1             7      LD  H,DEVICE/256    ;LD IXH,DEVICE/256
001C4A E9AE DD7E00          19      LD  A,(IX+0)    ;DPB_00_FATLN
001C4D E9B1 B7               4      OR  A       ;CF=0の為
001C4E E9B2 DDCB0F6E        20      BIT 5,(IX+00FH) ;DPB_0F_BPS
001C52 E9B6 C0              11      RET NZ      ;FAT16
001C53 E9B7 DDCB126E        20      BIT 5,(IX+012H) ;DPB_12_DEVICE
001C57 E9BB C0              11      RET NZ      ;BPB
001C58 E9BC FE01             7      CP  001H        ;A=0 THEN CF=1
001C5A E9BE C9              10      RET
                                
       E9BF                     _SYS5F:
001C5B E9BF AF               4      XOR A
       E9C0                     FFLUSH:
001C5C E9C0 F5              11      PUSH    AF
001C5D E9C1 3EFF             7      LD  A,0FFH
001C5F E9C3 3239EF          13      LD  (SFILE),A
001C62 E9C6 CDB3E5          17      CALL    DWTX
001C65 E9C9 3EFF             7      LD  A,0FFH
001C67 E9CB 32A5EF          13      LD  (_DBDRV),A
001C6A E9CE CDFDE5          17      CALL    WTFATX
001C6D E9D1 AF               4      XOR A
001C6E E9D2 32ABEF          13      LD  (_FATIX),A
001C71 E9D5 2F               4      CPL
001C72 E9D6 32AAEF          13      LD  (_FATDRV),A
001C75 E9D9 F1              10      POP AF
001C76 E9DA C9              10      RET
                                
[EOF:LDDIO.ASM:SHIFT_JIS]
                                    INCLUDE "M7DISK.ASM"
                                
                                ;   LSX-Dodgers DISK
                                ;   MZ-700/1500
                                
       E9DB                     SEEK:
001C77 E9DB 7A               4      LD  A,D
001C78 E9DC B3               4      OR  E
001C79 E9DD 3E01             7      LD  A,001H
001C7B E9DF 2811            12      JR  Z,DIV3
                                
001C7D E9E1 0610             7      LD  B,16
001C7F E9E3 0E00             7  MAXSEC: LD  C,000H
001C81 E9E5 AF               4      XOR A
001C82 E9E6 EB               4      EX  DE,HL
       E9E7                     DIV1:
001C83 E9E7 29              11      ADD HL,HL
001C84 E9E8 8F               4      ADC A,A
001C85 E9E9 B9               4      CP  C
001C86 E9EA 3802            12      JR  C,DIV2
001C88 E9EC 91               4      SUB C
001C89 E9ED 2C               4      INC L
       E9EE                     DIV2:
001C8A E9EE 10F7            13      DJNZ    DIV1
                                
001C8C E9F0 3C               4      INC A   ;最小のセクタは１固定
001C8D E9F1 55               4      LD  D,L ;TRACK
       E9F2                     DIV3:
001C8E E9F2 5F               4      LD  E,A ;Remainder
                                
001C8F E9F3 3A84EF          13      LD  A,(_DRIVE)
001C92 E9F6 FE04             7      CP  4
001C94 E9F8 3F               4      CCF
001C95 E9F9 D8              11      RET C
001C96 E9FA F684             7      OR  084H        ;Motor on + ドライブセレクト有効
001C98 E9FC D3DC            11      OUT (0DCH),A
001C9A E9FE CB3A             8      SRL D       ;CYLINDER
001C9C EA00 9F               4      SBC A,A
001C9D EA01 D3DD            11      OUT (0DDH),A    ;SIDE
                                
001C9F EA03 CD40EA          17      CALL    SETMODE
001CA2 EA06 D8              11      RET C
                                
001CA3 EA07 CD75EA          17      CALL    DRIVE
001CA6 EA0A FEFF             7      CP  0FFH        ;A=0FFH Unknown CYLINDER
001CA8 EA0C CC5CEA          17      CALL    Z,FDCRES    ;Restore
001CAB EA0F 2F               4      CPL         ;データバスが負論理
001CAC EA10 D3D9            11      OUT (0D9H),A    ;Currrent CYLINDER
001CAE EA12 2F               4      CPL         ;データバスが負論理
001CAF EA13 92               4      SUB D
001CB0 EA14 C8              11      RET Z       ;No seek
                                
001CB1 EA15 3A86EF          13      LD  A,(_ISEEK)
001CB4 EA18 4F               4      LD  C,A
                                
001CB5 EA19 3AA1EF          13      LD  A,(_MAXCYL) ;Max CYLINDER
001CB8 EA1C 3D               4      DEC A
001CB9 EA1D BA               4      CP  D       ;Over CYLINDER
001CBA EA1E D8              11      RET C
                                
001CBB EA1F 7A               4      LD  A,D
001CBC EA20 2F               4      CPL         ;データバスが負論理
001CBD EA21 D3DB            11      OUT (0DBH),A
001CBF EA23 72               7      LD  (HL),D
                                
001CC0 EA24 0E18             7      LD  C,018H      ;Seek
       EA26                     FDCCMD2:
001CC2 EA26 3A85EF          13      LD  A,(_SEEKSP)
001CC5 EA29 E6FF             7  FSPAT:  AND 0FFH
001CC7 EA2B B1               4      OR  C
                                
       EA2C                     FDCCMD:
001CC8 EA2C CD6CEA          17      CALL    COMSET
       EA30                     FDCSMC  EQU $+1
001CCB EA2F 3E80             7      LD  A,080H      ;FDC COMMAND(Self-modifying code)
001CCD EA31 E620             7      AND 020H        ;Write data Write track
001CCF EA33 3C               4      INC A
                                
       EA34                     SST:
001CD0 EA34 0E00             7      LD  C,0
       EA36                     SST1:
001CD2 EA36 0D               4      DEC C       ; 4
001CD3 EA37 20FD            12      JR  NZ,SST1     ;12 * 256 / 4 = About 1ms
001CD5 EA39 3D               4      DEC A
001CD6 EA3A 20FA            12      JR  NZ,SST1
                                
001CD8 EA3C 3C               4      INC A       ;A=1
001CD9 EA3D CD45EA          17      CALL    READY
       EA40                     SETMODE:
001CDC EA40 CD6FEA          17      CALL    DELAY0      ;Head select time
001CDF EA43 3E81             7      LD  A,081H
       EA45                     READY:
001CE1 EA45 324FEA          13      LD  (WAITA),A
001CE4 EA48 E5              11      PUSH    HL
001CE5 EA49 26F8             7      LD  H,0F8H
       EA4B                     READY2:
001CE7 EA4B DBD8            11      IN  A,(0D8H)
001CE9 EA4D 2F               4      CPL         ;データバスが負論理
       EA4F                     WAITA   EQU $+1
001CEA EA4E E681             7      AND 081H        ;NOT READY,BUSY
001CEC EA50 2808            12      JR  Z,READYE
001CEE EA52 E3              19      EX  (SP),HL     ;wait 19clock
001CEF EA53 E3              19      EX  (SP),HL     ; //
001CF0 EA54 2B               6      DEC HL
001CF1 EA55 7C               4      LD  A,H
001CF2 EA56 B5               4      OR  L
001CF3 EA57 20F2            12      JR  NZ,READY2
001CF5 EA59 37               4      SCF
       EA5A                     READYE:
001CF6 EA5A E1              10      POP HL
001CF7 EA5B C9              10      RET
                                
       EA5C                     FDCRES:
001CF8 EA5C 3600            10      LD  (HL),0
001CFA EA5E 0E08             7      LD  C,8
001CFC EA60 18C4            12      JR  FDCCMD2
                                
       EA62                     FDMOFF:
001CFE EA62 AF               4      XOR A       ;Motor off(ドライブセレクト無効)
001CFF EA63 D3DC            11      OUT (0DCH),A
001D01 EA65 C9              10      RET
                                
       EA66                     SECSET:
001D02 EA66 F5              11      PUSH    AF
001D03 EA67 7B               4      LD  A,E
001D04 EA68 2F               4      CPL         ;データバスが負論理
001D05 EA69 D3DA            11      OUT (0DAH),A
001D07 EA6B F1              10      POP AF
       EA6C                     COMSET:
001D08 EA6C 2F               4      CPL         ;データバスが負論理
001D09 EA6D D3D8            11      OUT (0D8H),A
       EA6F                     DELAY0:
001D0B EA6F 3E1A             7      LD  A,26
       EA71                     DELAY:
001D0D EA71 3D               4      DEC A
001D0E EA72 20FD            12      JR  NZ,DELAY
001D10 EA74 C9              10      RET
                                
       EA75                     DRIVE:
001D11 EA75 2A84EF          16      LD  HL,(_DRIVE)
001D14 EA78 26EF             7      LD  H,_CYL0/256
001D16 EA7A CBFD             8      SET 7,L
001D18 EA7C 7E               7      LD  A,(HL)
001D19 EA7D C9              10      RET
                                
       EA7E                     RNF:
001D1A EA7E CD75EA          17      CALL    DRIVE
001D1D EA81 36FF            10      LD  (HL),0FFH
001D1F EA83 C9              10      RET
                                
001D20 EA84 02                  RETRY:  DB  2
                                
                                
                                ;   FLOPPY DISK DRIVER
                                
       EA85                     WTTRK:
001D21 EA85 0601             7      LD  B,1
001D23 EA87 3EF4             7      LD  A,0F4H
001D25 EA89 1802            12      JR  WTTRK1
       EA8B                     FDWT:
001D27 EA8B 3EA0             7      LD  A,0A0H
       EA8D                     WTTRK1:
001D29 EA8D 3230EA          13      LD  (FDCSMC),A
       EA90                     DWTBL:
001D2C EA90 78               4      LD  A,B
001D2D EA91 32D3EA          13      LD  (WTBSMC),A
001D30 EA94 3E02             7      LD  A,2     ;Retry count
001D32 EA96 3284EA          13      LD  (RETRY),A
                                
       EA99                     DWT0:
001D35 EA99 D5              11      PUSH    DE
001D36 EA9A E5              11      PUSH    HL
001D37 EA9B 226DEB          16      LD  (DHLSMC),HL
001D3A EA9E CDDBE9          17      CALL    SEEK        ;Write disk
001D3D EAA1 E1              10      POP HL
001D3E EAA2 383A            12      JR  C,ERRDW
001D40 EAA4 F3               4      DI
001D41 EAA5 3A30EA          13      LD  A,(FDCSMC)
001D44 EAA8 CD66EA          17      CALL    SECSET
001D47 EAAB 0EDB             7      LD  C,0DBH
       EAAD                     DWT1:
001D49 EAAD 7E               7      LD  A,(HL)
001D4A EAAE 2F               4      CPL         ;データバスが負論理
001D4B EAAF 57               4      LD  D,A
                                
       EAB0                     DWT2:
001D4C EAB0 DBD8            11      IN  A,(0D8H)
001D4E EAB2 2F               4      CPL         ;データバスが負論理
001D4F EAB3 0F               4      RRCA
001D50 EAB4 3008            12      JR  NC,DWT4
001D52 EAB6 0F               4      RRCA
001D53 EAB7 30F7            12      JR  NC,DWT2
       EAB9                     DWT3:
001D55 EAB9 ED51            12      OUT (C),D
001D57 EABB 23               6      INC HL
001D58 EABC 18EF            12      JR  DWT1
                                
       EABE                     DWT4:
001D5A EABE 3D               4      DEC A
001D5B EABF 28F8            12      JR  Z,DWT3
001D5D EAC1 3C               4      INC A
001D5E EAC2 FB               4      EI
001D5F EAC3 D1              10      POP DE
001D60 EAC4 13               6      INC DE
001D61 EAC5 CD62EA          17      CALL    FDMOFF
001D64 EAC8 2808            12      JR  Z,DISKOK_WT
001D66 EACA CD38EB          17      CALL    DISKC
001D69 EACD 20CA            12      JR  NZ,DWT0
001D6B EACF B7               4      OR  A
001D6C EAD0 2005            12      JR  NZ,ERRW
                                
       EAD2                     DISKOK_WT:
       EAD3                     WTBSMC  EQU $+1
001D6E EAD2 0601             7      LD  B,1
001D70 EAD4 10BA            13      DJNZ    DWTBL
001D72 EAD6 C9              10      RET
                                
       EAD7                     ERRW:
001D73 EAD7 3EFF             7      LD  A,0FFH
       EAD9                     ERRZ:
001D75 EAD9 BF               4      CP  A
001D76 EADA 37               4      SCF
001D77 EADB C362EA          10      JP  FDMOFF
                                
       EADE                     ERRDW:
001D7A EADE D1              10      POP DE
001D7B EADF CD49EB          17      CALL    DELP
001D7E EAE2 20B5            12      JR  NZ,DWT0
001D80 EAE4 B7               4      OR  A
001D81 EAE5 20F0            12      JR  NZ,ERRW
001D83 EAE7 C9              10      RET
                                
       EAE8                     FDRD:
001D84 EAE8 3E80             7      LD  A,080H
001D86 EAEA 3230EA          13      LD  (FDCSMC),A
       EAED                     DRDBL:
001D89 EAED 78               4      LD  A,B
001D8A EAEE 322AEB          13      LD  (RDBSMC),A
001D8D EAF1 3E02             7      LD  A,2     ;Retry count
001D8F EAF3 3284EA          13      LD  (RETRY),A
       EAF6                     DRD0:
001D92 EAF6 D5              11      PUSH    DE
001D93 EAF7 E5              11      PUSH    HL
001D94 EAF8 226DEB          16      LD  (DHLSMC),HL
001D97 EAFB CDDBE9          17      CALL    SEEK        ;Read disk
001D9A EAFE E1              10      POP HL
001D9B EAFF 382D            12      JR  C,ERRDR
001D9D EB01 F3               4      DI
001D9E EB02 3A30EA          13      LD  A,(FDCSMC)
001DA1 EB05 CD66EA          17      CALL    SECSET
       EB08                     DRD1:
001DA4 EB08 DBD8            11      IN  A,(0D8H)
001DA6 EB0A 2F               4      CPL         ;データバスが負論理
001DA7 EB0B 0F               4      RRCA
001DA8 EB0C 300A            12      JR  NC,DRD3
001DAA EB0E 0F               4      RRCA
001DAB EB0F 30F7            12      JR  NC,DRD1
001DAD EB11 DBDB            11      IN  A,(0DBH)
001DAF EB13 2F               4      CPL         ;データバスが負論理
001DB0 EB14 77               7      LD  (HL),A
001DB1 EB15 23               6      INC HL
001DB2 EB16 18F0            12      JR  DRD1
                                
       EB18                     DRD3:
001DB4 EB18 B7               4      OR  A
001DB5 EB19 FB               4      EI
001DB6 EB1A D1              10      POP DE
001DB7 EB1B 13               6      INC DE
001DB8 EB1C CD62EA          17      CALL    FDMOFF
001DBB EB1F 2808            12      JR  Z,DISKOK_RD
001DBD EB21 CD38EB          17      CALL    DISKC
001DC0 EB24 20D0            12      JR  NZ,DRD0
001DC2 EB26 B7               4      OR  A
001DC3 EB27 20AE            12      JR  NZ,ERRW
                                
       EB29                     DISKOK_RD:
       EB2A                     RDBSMC  EQU $+1
001DC5 EB29 0601             7      LD  B,1
001DC7 EB2B 10C0            13      DJNZ    DRDBL
001DC9 EB2D C9              10      RET
                                
       EB2E                     ERRDR:
001DCA EB2E D1              10      POP DE
001DCB EB2F CD49EB          17      CALL    DELP
001DCE EB32 20C2            12      JR  NZ,DRD0
001DD0 EB34 B7               4      OR  A
001DD1 EB35 20A0            12      JR  NZ,ERRW
001DD3 EB37 C9              10      RET
       EB38                     DISKC:
001DD4 EB38 1B               6      DEC DE
001DD5 EB39 CB5F             8      BIT 3,A
001DD7 EB3B C47EEA          17      CALL    NZ,RNF
       EB3E                     DISKD:
001DDA EB3E E5              11      PUSH    HL
001DDB EB3F 2184EA          10      LD  HL,RETRY
001DDE EB42 35              11      DEC (HL)
001DDF EB43 E1              10      POP HL
001DE0 EB44 203E            12      JR  NZ,ERR      ;Retry
001DE2 EB46 B7               4      OR  A
001DE3 EB47 283B            12      JR  Z,ERR       ;Error
                                
       EB49                     DELP:
001DE5 EB49 CD7EEA          17      CALL    RNF
001DE8 EB4C CD62EA          17      CALL    FDMOFF
001DEB EB4F 3A85EF          13      LD  A,(_SEEKSP)
001DEE EB52 87               4      ADD A,A
001DEF EB53 382E            12      JR  C,AERRZ
       EB55                     DELP1:
001DF1 EB55 D5              11      PUSH    DE
001DF2 EB56 21C0F0          10      LD  HL,DEMES
001DF5 EB59 CD39D6          17      CALL    MSX
001DF8 EB5C CD00D9          17      CALL    KEYBC
       EB5F                     DELP2:
001DFB EB5F CDCAEF          17      CALL    _INKEY
001DFE EB62 28FB            12      JR  Z,DELP2
                                
001E00 EB64 D1              10      POP DE
001E01 EB65 CD64E0          17      CALL    CAP
001E04 EB68 FE52             7      CP  'R'     ;Retry
001E06 EB6A 200A            12      JR  NZ,DELP3
       EB6D                     DHLSMC  EQU $+1
001E08 EB6C 210000          10      LD  HL,0        ;Self-modifying code
001E0B EB6F 3E02             7      LD  A,2
001E0D EB71 3284EA          13      LD  (RETRY),A
001E10 EB74 B7               4      OR  A
001E11 EB75 C9              10      RET
       EB76                     DELP3:
001E12 EB76 FE49             7      CP  'I'     ;Ignore
001E14 EB78 2807            12      JR  Z,IGNORE
001E16 EB7A FE41             7      CP  'A'     ;Abort
001E18 EB7C 20D7            12      JR  NZ,DELP1
001E1A EB7E C300EF          10      JP  CPM_BOOT
       EB81                     IGNORE:
001E1D EB81 3EFF             7      LD  A,0FFH
       EB83                     AERRZ:
001E1F EB83 BF               4      CP  A
       EB84                     ERR:
001E20 EB84 3EFF             7      LD  A,0FFH
001E22 EB86 C9              10      RET
                                
001E23 EB87 3EFF             7  FDMODE: LD  A,0FFH      ;Floppy mode(2D/2HD) (Self-modifying code)
[EOF:M7DISK.ASM:SHIFT_JIS]
                                    INCLUDE "M7DISK2.ASM"
                                
                                ;   LSX-Dodgers DISK2
                                ;   MZ-700/1500
                                
                                ;   EMM DRIVER
                                ;   1セクタ可変(256/512/1024)
                                
       EB89                     EDWT:
001E25 EB89 F5              11      PUSH    AF
001E26 EB8A CDA8EB          17      CALL    EADR
001E29 EB8D 0600             7      LD  B,0
       EB8F                     EDWT1:
001E2B EB8F EDB3                    OTIR
001E2D EB91 3D               4      DEC A
001E2E EB92 20FB            12      JR  NZ,EDWT1
001E30 EB94 180B            12      JR  EDRW1
                                
       EB96                     EDRD:
001E32 EB96 C5              11      PUSH    BC
001E33 EB97 CDA8EB          17      CALL    EADR
001E36 EB9A 0600             7      LD  B,0
       EB9C                     EDRD1:
001E38 EB9C EDB2                    INIR
001E3A EB9E 3D               4      DEC A
001E3B EB9F 20FB            12      JR  NZ,EDRD1
       EBA1                     EDRW1:
001E3D EBA1 F1              10      POP AF
001E3E EBA2 83               4      ADD A,E ;セクタを進める
001E3F EBA3 5F               4      LD  E,A
001E40 EBA4 8A               4      ADC A,D
001E41 EBA5 93               4      SUB E
001E42 EBA6 57               4      LD  D,A
001E43 EBA7 C9              10      RET
                                
       EBA8                     EADR:
001E44 EBA8 C5              11      PUSH    BC
001E45 EBA9 D5              11      PUSH    DE
001E46 EBAA EB               4      EX  DE,HL
001E47 EBAB 29              11      ADD HL,HL
001E48 EBAC DD4E0D          19      LD  C,(IX+00DH) ;DPB_0D_MAXSEC
001E4B EBAF DD460C          19      LD  B,(IX+00CH) ;DPB_0C_MAXCYL
001E4E EBB2 09              11      ADD HL,BC
001E4F EBB3 DD4E13          19      LD  C,(IX+013H) ;DPB_13_UNITNO
001E52 EBB6 ED49            12      OUT (C),C
001E54 EBB8 0C               4      INC C
001E55 EBB9 ED69            12      OUT (C),L
001E57 EBBB 0C               4      INC C
001E58 EBBC ED61            12      OUT (C),H
001E5A EBBE 0C               4      INC C
001E5B EBBF EB               4      EX  DE,HL
001E5C EBC0 D1              10      POP DE
001E5D EBC1 DD460F          19      LD  B,(IX+00FH) ;DPB_0F_BPS
001E60 EBC4 F1              10      POP AF
       EBC5                     EADR1:              ;読み込むセクタ数と1クラスタのセクタ数を掛ける
001E61 EBC5 CB18             8      RR  B
001E63 EBC7 D8              11      RET C
001E64 EBC8 87               4      ADD A,A
001E65 EBC9 18FA            12      JR  EADR1
                                
                                ;   CMOS BACKUP MEMORY DRIVER(32KB)
                                ;   1セクタ256
                                
       EBCB                     CDWT:
001E67 EBCB 78               4      LD  A,B
001E68 EBCC DD4E13          19      LD  C,(IX+013H) ;DPB_13_UNITNO
001E6B EBCF ED40            12      IN  B,(C)       ;アドレスカウンタを0000にリセット
001E6D EBD1 ED59            12      OUT (C),E       ;W)アドレスカウンタ上位
001E6F EBD3 0C               4      INC C       ;C=F9
001E70 EBD4 0C               4      INC C       ;C=FA
001E71 EBD5 0600             7      LD  B,0
       EBD7                     CDWT1:
001E73 EBD7 EDB3                    OTIR            ;W)データ書き込み・アドレスカウンタ+1
001E75 EBD9 13               6      INC DE
001E76 EBDA 3D               4      DEC A
001E77 EBDB 20FA            12      JR  NZ,CDWT1
001E79 EBDD A7               4      AND A
001E7A EBDE C9              10      RET
                                
       EBDF                     CDRD:
001E7B EBDF 78               4      LD  A,B
001E7C EBE0 DD4E13          19      LD  C,(IX+013H) ;DPB_13_UNITNO
001E7F EBE3 ED40            12      IN  B,(C)       ;アドレスカウンタを0000にリセット
001E81 EBE5 ED59            12      OUT (C),E       ;W)アドレスカウンタ上位
001E83 EBE7 0C               4      INC C       ;C=F9
001E84 EBE8 0600             7      LD  B,0
       EBEA                     CDRD1:
001E86 EBEA EDB2                    INIR            ;R)データ読み出し・アドレスカウンタ+1
001E88 EBEC 13               6      INC DE
001E89 EBED 3D               4      DEC A
001E8A EBEE 20FA            12      JR  NZ,CDRD1
001E8C EBF0 A7               4      AND A
001E8D EBF1 C9              10      RET
                                
                                ;   RAM DISK DRIVER (64KB)
                                ;   1セクタ256
                                
       EBF2                     RDWT:
001E8E EBF2 78               4      LD  A,B
001E8F EBF3 43               4      LD  B,E     ;B=アドレスカウンタ上位
001E90 EBF4 0EEB             7      LD  C,0EBH
001E92 EBF6 ED71            12      OUT (C),0       ;0=アドレスカウンタ下位
001E94 EBF8 0D               4      DEC C       ;EA(W)データ書き込み・アドレスカウンタ+1
001E95 EBF9 0600             7      LD  B,0
       EBFB                     RDWT1:
001E97 EBFB EDB3                    OTIR
001E99 EBFD 13               6      INC DE
001E9A EBFE 3D               4      DEC A
001E9B EBFF 20FA            12      JR  NZ,RDWT1
001E9D EC01 A7               4      AND A
001E9E EC02 C9              10      RET
                                
       EC03                     RDRD:
001E9F EC03 78               4      LD  A,B
001EA0 EC04 43               4      LD  B,E     ;B=アドレスカウンタ上位
001EA1 EC05 0EEB             7      LD  C,0EBH
001EA3 EC07 ED71            12      OUT (C),0       ;0=アドレスカウンタ下位
001EA5 EC09 0D               4      DEC C       ;EA(R)データ読み出し・アドレスカウンタ+1
001EA6 EC0A 0600             7      LD  B,0
       EC0C                     RDRD1:
001EA8 EC0C EDB2                    INIR
001EAA EC0E 13               6      INC DE
001EAB EC0F 3D               4      DEC A
001EAC EC10 20FA            12      JR  NZ,RDRD1
001EAE EC12 A7               4      AND A
001EAF EC13 C9              10      RET
[EOF:M7DISK2.ASM:UTF_8]
                                
                                    INCLUDE "M7TABLE.ASM"
                                
                                ;   LSX-Dodgers TABLE 表示関連のテーブル
                                ;   MZ-700/1500
                                
       EC14                     AT_TABLE:
001EB0 EC14                         DS  TABLEAD-AT_TABLE
                                
       EC40                     KEY_TABLE:
001EDC EC40 12081E1F1C1D5C2F        DB  12H,08H,1EH,1FH,1CH,1DH,5CH,'/'
001EE4 EC48 5C5E2D2030392C2E        DB  5CH,'^','-',20H,'0','9',',','.'
001EEC EC50 3132333435363738        DB  '1','2','3','4','5','6','7','8'
001EF4 EC58 6162636465666768        DB  'a','b','c','d','e','f','g','h'
001EFC EC60 696A6B6C6D6E6F70        DB  'i','j','k','l','m','n','o','p'
001F04 EC68 7172737475767778        DB  'q','r','s','t','u','v','w','x'
001F0C EC70 797A405B5D000000        DB  'y','z','@','[',']',00H,00H,00H
001F14 EC78 001B3D09003B3A0D        DB  00H,1BH,'=',09H,00H,';',':',0DH
       EC80                     SHIFT_TABLE:
001F1C EC80 12081E1F1C1D5F3F        DB  12H,08H,1EH,1FH,1CH,1DH,'_','?'
001F24 EC88 7C7E3D2030293C3E        DB  '|','~','=',20H,'0',')','<','>'
001F2C EC90 2122232425262728        DB  '!','"','#','$','%','&',27H,'('
001F34 EC98 4142434445464748        DB  'A','B','C','D','E','F','G','H'
001F3C ECA0 494A4B4C4D4E4F50        DB  'I','J','K','L','M','N','O','P'
001F44 ECA8 5152535455565758        DB  'Q','R','S','T','U','V','W','X'
001F4C ECB0 595A607B7D000000        DB  'Y','Z','`','{','}',00H,00H,00H
001F54 ECB8 00003D09002B2A0D        DB  00H,00H,'=',09H,00H,'+','*',0DH
       ECC0                     CTRL_TABLE:
001F5C ECC0 12081E1F1C1D3F2F        DB  12H,08H,1EH,1FH,1CH,1DH,'?','/'
001F64 ECC8 2A2B2D2030392C2E        DB  '*','+','-',20H,'0','9',',','.'
001F6C ECD0 3132333435363738        DB  '1','2','3','4','5','6','7','8'
001F74 ECD8 0102030405060708        DB  01H,02H,03H,04H,05H,06H,07H,08H
001F7C ECE0 090A0B0C0D0E0F10        DB  09H,0AH,0BH,0CH,0DH,0EH,0FH,10H
001F84 ECE8 1112131415161718        DB  11H,12H,13H,14H,15H,16H,17H,18H
001F8C ECF0 191A1B5B5D000000        DB  19H,1AH,1BH,'[',']',00H,00H,00H
001F94 ECF8 00003D09003B3A0D        DB  00H,00H,'=',09H,00H,';',':',0DH
                                
                                ;   アドレス下位1バイトが0になるように
       ED00                     CD_TABLE:
001F9C ED00 00D1D2D3D4D5D6D0        DB  $00,$D1,$D2,$D3,$D4,$D5,$D6,$D0 ;月火水木金土日
001FA4 ED08 D8DCD9DADBD7CFCE        DB  $D8,$DC,$D9,$DA,$DB,$D7,$CF,$CE ;年円時分秒
001FAC ED10 601F5F5E1E1B7978        DB  $60,$1F,$5F,$5E,$1E,$1B,$79,$78 ;
001FB4 ED18 5C5D1C1D6DCACDC7        DB  $5C,$5D,$1C,$1D,$6D,$CA,$CD,$C7 ;
001FBC ED20 0061626364656667        DB  $00,$61,$62,$63,$64,$65,$66,$67 ; !"#$%&'
001FC4 ED28 68696B6A2F2A2E2D        DB  $68,$69,$6B,$6A,$2F,$2A,$2E,$2D ;()*+,-./
001FCC ED30 2021222324252627        DB  $20,$21,$22,$23,$24,$25,$26,$27 ;01234567
001FD4 ED38 28294F2C512B5749        DB  $28,$29,$4F,$2C,$51,$2B,$57,$49 ;89:;<=>?
001FDC ED40 5501020304050607        DB  $55,$01,$02,$03,$04,$05,$06,$07 ;@ABCDEFG
001FE4 ED48 08090A0B0C0D0E0F        DB  $08,$09,$0A,$0B,$0C,$0D,$0E,$0F ;HIJKLMNO
001FEC ED50 1011121314151617        DB  $10,$11,$12,$13,$14,$15,$16,$17 ;PQRSTUVW
001FF4 ED58 18191A52DD54507C        DB  $18,$19,$1A,$52,$DD,$54,$50,$7C ;XYZ[\]^_
001FFC ED60 5901020304050607        DB  $59,$01,$02,$03,$04,$05,$06,$07 ;`abcdefg   ATB:1
002004 ED68 08090A0B0C0D0E0F        DB  $08,$09,$0A,$0B,$0C,$0D,$0E,$0F ;hijklmno   ATB:1
00200C ED70 1011121314151617        DB  $10,$11,$12,$13,$14,$15,$16,$17 ;pqrstuvw   ATB:1
002014 ED78 18191ACB35CC705A        DB  $18,$19,$1A,$CB,$35,$CC,$70,$5A ;xyz{|}~    ATB:1
00201C ED80 415346444847B49E        DB  $41,$53,$46,$44,$48,$47,$B4,$9E ;トランプ〇●をぁ   ATB:1
002024 ED88 B2B6BABE9FB3B7BB        DB  $B2,$B6,$BA,$BE,$9F,$B3,$B7,$BB ;ぃぅぇぉゃゅょっ   ATB:1
00202C ED90 BFA385A4A5A69487        DB  $BF,$A3,$85,$A4,$A5,$A6,$94,$87 ;ーあいうえおかき   ATB:1
002034 ED98 889C829884929083        DB  $88,$9C,$82,$98,$84,$92,$90,$83 ;くけこさしすせそ   ATB:1
00203C EDA0 F0BD9DB1B5B9B49E        DB  $F0,$BD,$9D,$B1,$B5,$B9,$B4,$9E ;　。「」、・ヲァ
002044 EDA8 B2B6BABE9FB3B7BB        DB  $B2,$B6,$BA,$BE,$9F,$B3,$B7,$BB ;ィゥェォャョュッ
00204C EDB0 BFA385A4A5A69487        DB  $BF,$A3,$85,$A4,$A5,$A6,$94,$87 ;ーアイウエオカキ
002054 EDB8 889C829884929083        DB  $88,$9C,$82,$98,$84,$92,$90,$83 ;クケコサシスセソ
00205C EDC0 91819A97939589A1        DB  $91,$81,$9A,$97,$93,$95,$89,$A1 ;タチツテトナニヌ
002064 EDC8 AF8B8696A2ABAA8A        DB  $AF,$8B,$86,$96,$A2,$AB,$AA,$8A ;ネノハヒフヘホマ
00206C EDD0 8EB0AD8DA7A8A98F        DB  $8E,$B0,$AD,$8D,$A7,$A8,$A9,$8F ;ミムメモヤユヨラ
002074 EDD8 8CAEAC9BA099BCB8        DB  $8C,$AE,$AC,$9B,$A0,$99,$BC,$B8 ;リルレロワン゛゜
00207C EDE0 91819A97939589A1        DB  $91,$81,$9A,$97,$93,$95,$89,$A1 ;たちつてとねにぬ   ATB:1
002084 EDE8 AF8B8696A2ABAA8A        DB  $AF,$8B,$86,$96,$A2,$AB,$AA,$8A ;ねのはひふへほま   ATB:1
00208C EDF0 8EB0AD8DA7A8A98F        DB  $8E,$B0,$AD,$8D,$A7,$A8,$A9,$8F ;みむめもやゆよら   ATB:1
002094 EDF8 8CAEAC9BA099BCB8        DB  $8C,$AE,$AC,$9B,$A0,$99,$BC,$B8 ;りるれろわん゛゜   ATB:1
       EE00                     DC_TABLE:
00209C EE00 2041424344454647        DB  $20,$41,$42,$43,$44,$45,$46,$47 ;0
0020A4 EE08 48494A4B4C4D4E4F        DB  $48,$49,$4A,$4B,$4C,$4D,$4E,$4F
0020AC EE10 5051525354555657        DB  $50,$51,$52,$53,$54,$55,$56,$57 ;1
0020B4 EE18 58595A151A1B1411        DB  $58,$59,$5A,$15,$1A,$1B,$14,$11
0020BC EE20 3031323334353637        DB  $30,$31,$32,$33,$34,$35,$36,$37 ;2
0020C4 EE28 38392D3D3B2F2E2C        DB  $38,$39,$2D,$3D,$3B,$2F,$2E,$2C
0020CC EE30 00000000007C0000        DB  $00,$00,$00,$00,$00,$7C,$00,$00 ;3
0020D4 EE38 0000000000000000        DB  $00,$00,$00,$00,$00,$00,$00,$00
0020DC EE40 0080000083008285        DB  $00,$80,$00,$00,$83,$00,$82,$85 ;4
0020E4 EE48 843F00000000003A        DB  $84,$3F,$00,$00,$00,$00,$00,$3A
0020EC EE50 5E3C5B815D40003E        DB  $5E,$3C,$5B,$81,$5D,$40,$00,$3E ;5
0020F4 EE58 00607F0018191312        DB  $00,$60,$7F,$00,$18,$19,$13,$12
0020FC EE60 1021222324252627        DB  $10,$21,$22,$23,$24,$25,$26,$27 ;6
002104 EE68 28292B2A001C0000        DB  $28,$29,$2B,$2A,$00,$1C,$00,$00
00210C EE70 7E00000000000000        DB  $7E,$00,$00,$00,$00,$00,$00,$00 ;7
002114 EE78 171600005F000000        DB  $17,$16,$00,$00,$5F,$00,$00,$00
00211C EE80 00C19A9F9C92CA97        DB  $00,$C1,$9A,$9F,$9C,$92,$CA,$97 ;8
002124 EE88 98C6CFC9D8D3D0D7        DB  $98,$C6,$CF,$C9,$D8,$D3,$D0,$D7
00212C EE90 9EC09DC496C5CBC3        DB  $9E,$C0,$9D,$C4,$96,$C5,$CB,$C3 ;9
002134 EE98 9BDDC2DB99A2878C        DB  $9B,$DD,$C2,$DB,$99,$A2,$87,$8C
00213C EEA0 DCC7CC91939495D4        DB  $DC,$C7,$CC,$91,$93,$94,$95,$D4 ;A
002144 EEA8 D5D6CECDDAD2D9C8        DB  $D5,$D6,$CE,$CD,$DA,$D2,$D9,$C8
00214C EEB0 D1A3888D86A4898E        DB  $D1,$A3,$88,$8D,$86,$A4,$89,$8E ;B
002154 EEB8 DFA58A8FDEA18B90        DB  $DF,$A5,$8A,$8F,$DE,$A1,$8B,$90
00215C EEC0 000000000000001F        DB  $00,$00,$00,$00,$00,$00,$00,$1F ;C
002164 EEC8 00001D7B7D1E0F0E        DB  $00,$00,$1D,$7B,$7D,$1E,$0F,$0E
00216C EED0 070102030405060D        DB  $07,$01,$02,$03,$04,$05,$06,$0D ;D
002174 EED8 080A0B0C095C0000        DB  $08,$0A,$0B,$0C,$09,$5C,$00,$00
00217C EEE0 0000000000000000        DB  $00,$00,$00,$00,$00,$00,$00,$00 ;E
002184 EEE8 0000000000000000        DB  $00,$00,$00,$00,$00,$00,$00,$00
00218C EEF0 A000000000000000        DB  $A0,$00,$00,$00,$00,$00,$00,$00 ;F
002194 EEF8 0000000000000000        DB  $00,$00,$00,$00,$00,$00,$00,$00
[EOF:M7TABLE.ASM:SHIFT_JIS]
                                    INCLUDE "LDWORK.ASM"
                                
                                ;   LSX-Dodgers WORK0
                                ;
                                ;   CP/M互換BIOS
                                ;   BOOT:アドレス下位1バイトが0になるように
       EF00                     AT_WORK:
00219C EF00                         DS  WORKAD-AT_WORK
                                
       EF00                     CPM_BOOT:
00219C EF00 C30000          10      JP  0
       EF03                     _SYS00:     ;(BDOS)プログラム終了
       EF03                     CPM_WBOOT:
00219F EF03 C3FECF          10      JP  WBOOT1
       EF06                     CPM_CONST:
0021A2 EF06 C3A3D9          10      JP  CONSTX
       EF09                     _SYS07:     ;(BDOS)コンソール直接入力
       EF09                     CPM_CONIN:
0021A5 EF09 C339D9          10      JP  FLGET
       EF0C                     CPM_CONOUT:
0021A8 EF0C C34FDB          10      JP  CONOUT1
                                
       EF0F                     DECBF:
0021AB EF0F                         DS  5
0021B0 EF14 00                  FDRV    DB  0
0021B1 EF15                     FNAME   DS  36
0021D5 EF39                     SFILE:  DS  33      ;DRV FILENAME
0021F6 EF5A                     HLBUF:  DS  3       ;Random record buffer
                                
0021F9 EF5D 0000                LEFTX:  DW  0
0021FB EF5F 0000                DTAX:   DW  0
                                
0021FD EF61 008E01000B000C10    BEEPD:  DB  0,08EH,1,0,00BH,0,00CH,010H
002205 EF69 073E08100D00FF          DB  007H,03EH,008H,010H,00DH,0,0FFH
                                
00220C EF70 00                  CHECK:  DB  0
                                
00220D EF71 4F4B24              OK: DB  "OK$"
002210 EF74 536B697024          SKIP:   DB  "Skip$"
002215 EF79 4572726F722124      COMERM: DB  "Error!$"
                                ;   システムワークエリア
                                ;   _CYL0:アドレス下位1バイトが080Hになるように
00221C EF80 FF                  _CYL0:  DB  0FFH    ;Cylinder
00221D EF81 FF                  _CYL1:  DB  0FFH    ;Cylinder
00221E EF82 FF                  _CYL2:  DB  0FFH    ;Cylinder
00221F EF83 FF                  _CYL3:  DB  0FFH    ;Cylinder
002220 EF84 00                  _DRIVE: DB  0   ;unit number
002221 EF85 00                  _SEEKSP:DB  0   ;Seek speed
002222 EF86 FF                  _ISEEK: DB  0FFH    ;
002223 EF87 00                  _DVSW:  DB  0
002224 EF88 00                  _DRV:   DB  0
002225 EF89 FF                  _DSK:   DB  0FFH
002226 EF8A 8000                _DTA:   DW  00080H
002228 EF8C 0000                _CTC:   DW  0
00222A EF8E 0000                _TXADR: DW  0
00222C EF90 0000                _KEYPS: DW  0
00222E EF92 00FF                _KEYD:  DW  0FF00H  ;キーデータ
002230 EF94 C210                _KEYSP: DW  010C2H
002232 EF96 71                  _COLORF:DB  COLORF  ;色
002233 EF97 19                  _LINE:  DB  LINE
                                
002234 EF98 0000                _FCB:   DW  0
002236 EF9A 0000                _FBPS:  DW  0   ;SEARCH FILES
002238 EF9C 0000                _FBAD:  DW  0   ;    //
00223A EF9E 00                  _FBCNT: DB  0   ;    //
00223B EF9F 00                  _FILEN: DB  0
00223C EFA0 00                  _DIRF:  DB  0   ;bit7:ディレクトリ bit0-6:セクタインデックス
00223D EFA1 00                  _MAXCYL:DB  0
00223E EFA2 00                  _WTFATF:DB  0   ;FATバッファの更新フラグ
00223F EFA3                             DS  1
002240 EFA4 00                  _WTDBF: DB  0   ;データバッファの更新フラグ
002241 EFA5 FF                  _DBDRV: DB  0FFH    ;データバッファにあるデータを読み込んだドライブ
002242 EFA6 0000                _DBSEC: DW  0   ;データバッファにあるデータを読み込んだセクタ番号
002244 EFA8 0000                _DPB:   DW  0
       EFAA                     _FATDRV:
002246 EFAA FF                      DB  0FFH    ;FATバッファに読み込んでいるドライブ
002247 EFAB 00                  _FATIX: DB  0   ;FATバッファに読み込んでいるインデックス
       EFAC                     _FAKEFREE:
002248 EFAC 0000                    DW  0   ;偽の残量（FATサイズが大きくなると重くなるのでその対策）
                                
00224A EFAE                         DS  2
                                
00224C EFB0 6F2859381F02191C    CRTCD:  DB  06FH,WIDTH,059H,038H,01FH,002H,019H,01CH
002254 EFB8 0007                    DB  000H,007H
002256 EFBA 18FCD8FF                DW  0-WIDTH*LINE,0-WIDTH
00225A EFBE 0C                      DB  00CH
00225B EFBF 20                  WK1FD0: DB  020H
                                
00225C EFC0 0000                CTC0:   DW  INTCTCE
00225E EFC2 0000                CTC1:   DW  INTCTCE
002260 EFC4 0000                CTC2:   DW  INTCTC2
002262 EFC6 0000                CTC3:   DW  INTCTCE
002264 EFC8 0000                INTVEC: DW  INT
                                
                                ;   LSX-Dodgers 独自BIOS
                                
002266 EFCA C393DC          10  _INKEY: JP  INKEY
002269 EFCD C33BDA          10  _PRINT: JP  PRINT
00226C EFD0 C317DD          10  _SCRN:  JP  SCRN
00226F EFD3 C3F8DB          10  _POS:   JP  POS
002272 EFD6 C31DDB          10  _LOC:   JP  LOC
       EFD9                     _CHGDRV:
002275 EFD9 C3CEE8          10      JP  CHGDRV
       EFDC                     _GETDPB:
002278 EFDC C3A2E9          10      JP  GETDPB
       EFDF                     _FFLUSH:
00227B EFDF C3C0E9          10      JP  FFLUSH
       EFE2                     _RDFATX:
00227E EFE2 C3D3E5          10      JP  RDFATX
002281 EFE5 C3FBE6          10  _RDFAT: JP  RDFAT
002284 EFE8 C385EA          10  _WTTRK: JP  WTTRK
002287 EFEB C3E8EA          10  _FDRD:  JP  FDRD
00228A EFEE C38BEA          10  _FDWT:  JP  FDWT
       EFF1                     _BPB2DPB:
00228D EFF1 C360E7          10      JP  BPB2DPB
002290 EFF4                         DS  3
       EFF7                     _GNCL:
002293 EFF7 C375E6          10  GNCPAT: JP  GNCL        ; self-modifying code
       EFFA                     _SNCL:
002296 EFFA C398E6          10  SNCPAT: JP  SNCL        ; self-modifying code
002299 EFFD C33FD0          10  _COMANL:JP  COMANL
                                
       F000                     _WE:
[EOF:LDWORK.ASM:SHIFT_JIS]
                                    INCLUDE "LDCALL.ASM"
                                
                                ;   LSX-Dodgers システムコール(BDOS)
                                ;
                                ;   LSX-Dodgers SYSTEM CALL
                                ;   STABLE:アドレス下位1バイトが0になるように
                                
       F000                     STABLE:
                                ;0
00229C F000 03EF0DD919D9ECDE        DW  _SYS00,_SYS01,_SYS02,_SYS03
0022A4 F008 28D628D61ED909EF        DW  _SYS04,_SYS05,_SYS06,_SYS07
0022AC F010 26D92AD66FD99BD9        DW  _SYS08,_SYS09,_SYS0A,_SYS0B
0022B4 F018 3FD644D653D666D6        DW  _SYS0C,_SYS0D,_SYS0E,_SYS0F
                                ;1
0022BC F020 BAD601D74AD780D7        DW  _SYS10,_SYS11,_SYS12,_SYS13
0022C4 F028 88D7A6D7C3D7BBD7        DW  _SYS14,_SYS15,_SYS16,_SYS17
0022CC F030 24D829D82ED834D8        DW  _SYS18,_SYS19,_SYS1A,_SYS1B
0022D4 F038 28D65AD828D65ED8        DW  _SYS1C,_SYS1D,_SYS1E,_SYS1F
                                ;2
0022DC F040 28D6FAD70FD865D8        DW  _SYS20,_SYS21,_SYS22,_SYS23
0022E4 F048 84D828D628E309E4        DW  _SYS24,_ERROR,_SYS26,_SYS27
0022EC F050 0FD88DD8B4D9ECDE        DW  _SYS28,_SYS5C,_SYS2A,_SYS2B
0022F4 F058 BCD9ECDE28D6B0D8        DW  _SYS2C,_SYS2D,_SYS2E,_SYS2F
                                ;3
0022FC F060 AAD828D628D628D6        DW  _SYS30,_ERROR,_ERROR,_ERROR
002304 F068 28D628D628D628D6        DW  _ERROR,_ERROR,_ERROR,_ERROR
00230C F070 28D6ECDEECDED1D8        DW  _ERROR,_SYS39,_SYS3A,_SYS5A
                                ;DOS2
002314 F078 0BD6                    DW  _DOS2
                                
002316 F07A                         DS  2
002318 F07C 00F2                _FATBF: DW  FATBF
00231A F07E 00FA                _DTBUF: DW  DTBUF
                                
                                ;   コントロールコードテーブル
                                ;   CTRLTB:アドレス下位1バイトが080Hになるように
                                
       F080                     CTRLTB:
00231C F080 A0DAA0DAD6DACBDB        DW  CTRL00,CTRL00,CTRL02,CTRL03 ;  A,B,C
002324 F088 C5DB02DBB6DB5FDB        DW  CTRL04,CTRL05,CTRL06,CTRL07 ;D,E,F,G
00232C F090 ACDAC7DACEDB30DB        DW  CTRL08,CTRL09,CTRL0A,CTRL0B ;H,I,J,K
002334 F098 B3DB18DBE0DBA0DA        DW  CTRL0C,CTRL0D,CTRL0E,CTRL00 ;L,M,N,O
00233C F0A0 A0DAA0DA28DBA0DA        DW  CTRL00,CTRL00,CTRL12,CTRL00 ;P,Q,R,S
002344 F0A8 A0DAA0DAA0DAA0DA        DW  CTRL00,CTRL00,CTRL00,CTRL00 ;T,U,V,W
00234C F0B0 A0DAA0DAB3DB37DB        DW  CTRL00,CTRL00,CTRL0C,CTRL1B ;X,Y,Z,ESC
002354 F0B8 8FDAB3DABCDACEDB        DW  CTRL1C,CTRL1D,CTRL1E,CTRL1F ;→,←,↑,↓
                                
00235C F0C0 0307                DEMES:  DB  3,7
00235E F0C2 4465766963652049        DB  "Device I/O Error",5,3
            2F4F204572726F72    
            0503                
002370 F0D4 41626F7274205265        DB  "Abort Retry Ignore?",5,3,0
            7472792049676E6F    
            72653F050300        
                                
002386 F0EA 1617                SDDATA: DB  22,23       ;(FCB)ファイルを最後に変更した時刻
002388 F0EC 1415                    DB  20,21       ;(FCB)ファイルを最後に変更した日付
00238A F0EE 1A1B                    DB  26,27       ;(FCB)ファイルの先頭クラスタ
00238C F0F0 10111213                DB  16,17,18,19 ;(FCB)ファイルのサイズ(バイト単位)
       F0F4                     SDDATAE:
                                
002390 F0F4                     SCDIR:  DS  2       ;+14 +15
002392 F0F6                     SFBPS:  DS  2       ;FBPS
002394 F0F8                     SFNDF:  DS  2       ;FILEN DIRF
                                
002396 F0FA 0000                _FATPS: DW  0
002398 F0FC 0000                _DIRPS: DW  0
00239A F0FE 0000                _CLPS:  DW  0
                                
       F100                     _PE:
[EOF:LDCALL.ASM:SHIFT_JIS]
                                    INCLUDE "M7DPB.ASM"
                                
                                ;   LSX-Dodgers DPB
                                ;   MZ-700/1500
                                
       F100                     DEVICE:
                                
                                ;   A:
                                
00239C F100 0200                    DW  2   ;DPB_00_FATLN
00239E F102 EBEF                    DW  _FDRD   ;DPB_02_DRD
0023A0 F104 EEEF                    DW  _FDWT   ;DPB_04_DWT
0023A2 F106 FD                      DB  0FDH    ;DPB_06_FATID
0023A3 F107 02                      DB  2   ;DPB_07_SECPCL
0023A4 F108 6401                    DW  356 ;DPB_08_MAXCL
0023A6 F10A FF                      DB  0FFH    ;DPB_0A_FDMODE  0FFH=2D / 0FEH=2HD
0023A7 F10B 07                      DB  7   ;DPB_0B_DIRSCNT
0023A8 F10C 28                      DB  40  ;DPB_0C_MAXCYL
0023A9 F10D 09                      DB  9   ;DPB_0D_MAXSEC  Number of sectors
0023AA F10E 01                      DB  1   ;DPB_0E_FATPS
0023AB F10F 82                      DB  082H    ;DPB_0F_BPS
0023AC F110 0500                    DW  5   ;DPB_10_DIRPS
0023AE F112 27                      DB  027H    ;DPB_12_DEVICE  Device Number
0023AF F113 00                      DB  0   ;DPB_13_UNITNO
0023B0 F114 0800                    DW  8   ;DPB_14_ADDCL16
0023B2 F116 0000                    DW  0   ;DPB_16
0023B4 F118 0000                    DW  0   ;DPB_18
0023B6 F11A 0000                    DW  0   ;DPB_1A_SDIR
0023B8 F11C 46444430                DB  "FDD0"  ;DPB_1C_NAME
                                
                                ;   B:
                                
0023BC F120 0200                    DW  2   ;DPB_00_FATLN
0023BE F122 EBEF                    DW  _FDRD   ;DPB_02_DRD
0023C0 F124 EEEF                    DW  _FDWT   ;DPB_04_DWT
0023C2 F126 FD                      DB  0FDH    ;DPB_06_FATID
0023C3 F127 02                      DB  2   ;DPB_07_SECPCL
0023C4 F128 6401                    DW  356 ;DPB_08_MAXCL
0023C6 F12A FF                      DB  0FFH    ;DPB_0A_FDMODE  0FFH=2D / 0FEH=2HD
0023C7 F12B 07                      DB  7   ;DPB_0B_DIRSCNT
0023C8 F12C 28                      DB  40  ;DPB_0C_MAXCYL
0023C9 F12D 09                      DB  9   ;DPB_0D_MAXSEC  Number of sectors
0023CA F12E 01                      DB  1   ;DPB_0E_FATPS
0023CB F12F 82                      DB  082H    ;DPB_0F_BPS
0023CC F130 0500                    DW  5   ;DPB_10_DIRPS
0023CE F132 27                      DB  027H    ;DPB_12_DEVICE  Device Number
0023CF F133 01                      DB  1   ;DPB_13_UNITNO
0023D0 F134 0800                    DW  8   ;DPB_14_ADDCL16
0023D2 F136 0000                    DW  0   ;DPB_16
0023D4 F138 0000                    DW  0   ;DPB_18
0023D6 F13A 0000                    DW  0   ;DPB_1A_SDIR
0023D8 F13C 46444431                DB  "FDD1"  ;DPB_1C_NAME
                                
                                ;   C:
                                
0023DC F140 0100                    DW  1   ;DPB_00_FATLN
0023DE F142 DFEB                    DW  CDRD    ;DPB_02_DRD
0023E0 F144 CBEB                    DW  CDWT    ;DPB_04_DWT
0023E2 F146 FA                      DB  0FAH    ;DPB_06_FATID
0023E3 F147 01                      DB  1   ;DPB_07_SECPCL
0023E4 F148 7A00                    DW  122 ;DPB_08_MAXCL
0023E6 F14A 00                      DB  0   ;DPB_0A_FDMODE
0023E7 F14B 06                      DB  6   ;DPB_0B_DIRSCNT
0023E8 F14C 00                      DB  0   ;DPB_0C_MAXCYL
0023E9 F14D 00                      DB  0   ;DPB_0D_MAXSEC
0023EA F14E 01                      DB  1   ;DPB_0E_FATPS
0023EB F14F 01                      DB  1   ;DPB_0F_BPS
0023EC F150 0200                    DW  2   ;DPB_10_DIRPS
0023EE F152 0C                      DB  00CH    ;DPB_12_DEVICE
0023EF F153 F8                      DB  0F8H    ;DPB_13_UNITNO
0023F0 F154 0600                    DW  6   ;DPB_14_ADDCL16
0023F2 F156 0000                    DW  0   ;DPB_16
0023F4 F158 0000                    DW  0   ;DPB_18
0023F6 F15A 0000                    DW  0   ;DPB_1A_SDIR
0023F8 F15C 434D4F53                DB  "CMOS"  ;DPB_1C_NAME
                                
                                ;   D:
                                
0023FC F160                         DS  32
                                
                                ;   E:
                                
00241C F180 0000                    DW  0   ;DPB_00_FATLN
00241E F182 96EB                    DW  EDRD    ;DPB_02_DRD
002420 F184 89EB                    DW  EDWT    ;DPB_04_DWT
002422 F186 FA                      DB  0FAH    ;DPB_06_FATID
002423 F187 02                      DB  2   ;DPB_07_SECPCL
002424 F188 0000                    DW  0   ;DPB_08_MAXCL
002426 F18A 00                      DB  0   ;DPB_0A_FDMODE
002427 F18B 10                      DB  16  ;DPB_0B_DIRSCNT
002428 F18C 00                      DB  0   ;DPB_0C_MAXCYL
002429 F18D 00                      DB  0   ;DPB_0D_MAXSEC
00242A F18E 01                      DB  1   ;DPB_0E_FATPS
00242B F18F 01                      DB  1   ;DPB_0F_BPS
00242C F190 0000                    DW  0   ;DPB_10_DIRPS
00242E F192 26                      DB  026H    ;DPB_12_DEVICE
00242F F193 00                      DB  0   ;DPB_13_UNITNO
002430 F194 0000                    DW  0   ;DPB_14_ADDCL16
002432 F196 0000                    DW  0   ;DPB_16
002434 F198 0000                    DW  0   ;DPB_18
002436 F19A 0000                    DW  0   ;DPB_1A_SDIR
002438 F19C 454D4D30                DB  "EMM0"  ;DPB_1C_NAME
                                
                                ;   F:
                                
00243C F1A0 0200                    DW  2   ;DPB_00_FATLN
00243E F1A2 03EC                    DW  RDRD    ;DPB_02_DRD
002440 F1A4 F2EB                    DW  RDWT    ;DPB_04_DWT
002442 F1A6 FA                      DB  0FAH    ;DPB_06_FATID
002443 F1A7 01                      DB  1   ;DPB_07_SECPCL
002444 F1A8 F600                    DW  246 ;DPB_08_MAXCL
002446 F1AA 00                      DB  0   ;DPB_0A_FDMODE
002447 F1AB 09                      DB  9   ;DPB_0B_DIRSCNT
002448 F1AC 00                      DB  0   ;DPB_0C_MAXCYL
002449 F1AD 00                      DB  0   ;DPB_0D_MAXSEC
00244A F1AE 01                      DB  1   ;DPB_0E_FATPS
00244B F1AF 01                      DB  1   ;DPB_0F_BPS
00244C F1B0 0300                    DW  3   ;DPB_10_DIRPS
00244E F1B2 0F                      DB  00FH    ;DPB_12_DEVICE
00244F F1B3 00                      DB  0   ;DPB_13_UNITNO
002450 F1B4 0A00                    DW  10  ;DPB_14_ADDCL16
002452 F1B6 0000                    DW  0   ;DPB_16
002454 F1B8 0000                    DW  0   ;DPB_18
002456 F1BA 0000                    DW  0   ;DPB_1A_SDIR
002458 F1BC 52414D46                DB  "RAMF"  ;DPB_1C_NAME
                                
                                ;   G:
                                
00245C F1C0                         DS  32
                                
                                ;   H:
00247C F1E0                         DS  31
00249B F1FF 00                      DB  0
[EOF:M7DPB.ASM:UTF_8]
                                
       A49C                         ORG $$+OFFSET   ;$DEPHASE
       A49C                     LAST_ADR:
                                
                                    END
[EOF:M7.ASM:UTF_8]
