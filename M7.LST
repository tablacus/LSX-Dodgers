                                ;*** AILZ80ASM *** Z-80 Assembler, version 1.0.13.0, LST:Full:4
                                ;   LSX-Dodgers for MZ-700/1500
                                ;   Programmed by
                                ;   Gaku (Lovers/Tablacus)
                                
                                    INCLUDE "M7DEF.ASM"
                                
                                ;   LSX-Dodgers DEF
                                ;   MZ-700/1500
                                
       0001                     MAC EQU 1   ;MZ-700/1500
       0000                     DEV EQU 0
                                
       011D                     VER_6F  EQU 0011DH
                                
       8080                     RUN EQU 08080H
       8000                     OFFSET  EQU RUN-128
       CF06                     BDOS    EQU 0CF06H
       ED40                     TABLEAD EQU 0ED40H
       F000                     WORKAD  EQU 0F000H
       F300                     FATBF   EQU 0F300H
       FB00                     DTBUF   EQU 0FB00H
       FF00                     KEYBF   EQU 0FF00H
       FF20                     KBUF    EQU 0FF20H
       FFD9                     TRAP38  EQU 0FFD9H
       0028                     WIDTH   EQU 40
       0019                     LINE    EQU 25
       0070                     COLORF  EQU 070H
       0010                     KEYSP_H EQU 16
       0083                     KEYSP_L EQU 131
       0009                     COMS    EQU 9
       0004                     MAX_SEC_SZ_H    EQU 4       ;1セクタ1024バイトのサポート(2:off 4:on)
       0100                     BUFFER  EQU 00100H
       D0E5                     S27BUF_COM  EQU S27BUF
[EOF:M7DEF.ASM:UTF_8]
                                    INCLUDE "LDDEF.ASM"
                                
                                ;   LSX-Dodgers DEF
                                
       0001                     VER_1   EQU 1
       0006                     VER_2   EQU 6
       0001                     VER_3   EQU 1
       1D01                     MACW    EQU MAC + 01D00H    ;機種フラグとLD判別フラグ
       0001                     MACD    EQU MAC + DEV * 256 ;機種フラグとデバイスフラグ
       0161                     VER EQU VER_1 * 256 + VER_2 * 16 + VER_3
                                
       0004                     _DVSW   EQU 00004H
       0005                     SYSTEM  EQU 00005H
       000F                     JP_HL   EQU 0000FH
       005C                     FCB1    EQU 0005CH
       006C                     FCB2    EQU 0006CH
       005D                     FCB1FN  EQU FCB1+1
       006D                     FCB2FN  EQU FCB2+1
       0080                     DTA1    EQU 00080H
                                
       FFCA                     EXTBIO  EQU 0FFCAH
                                
       0000                     DPB_FATLN   EQU 00H
       0002                     DPB_DRD     EQU 02H
       0004                     DPB_DWT     EQU 04H
       0006                     DPB_FATID   EQU 06H
       0007                     DPB_SECPCL  EQU 07H
       0008                     DPB_MAXCL   EQU 08H
       000A                     DPB_FDMODE  EQU 0AH
       000B                     DPB_DIRSCNT EQU 0BH
       000C                     DPB_MAXCYL  EQU 0CH
       000D                     DPB_MAXSEC  EQU 0DH
       000E                     DPB_FATPS   EQU 0EH
       000F                     DPB_BPS     EQU 0FH
       0010                     DPB_DIRPS   EQU 10H
       0012                     DPB_DEVICE  EQU 12H
       0013                     DPB_UNITNO  EQU 13H
       0014                     DPB_ADDCL   EQU 14H
                                
       001A                     DPB_SDIR    EQU 1AH
       001C                     DPB_NAME    EQU 1CH
                                
[EOF:LDDEF.ASM:SHIFT_JIS]
                                
000000 8000                         ORG OFFSET
                                                    ;MZTヘッダ128バイト
000000 8000 01                      DB  1           ;ファイルモード
000001 8001 4C44202020202020        DB  "LD           "     ;ファイル名(13)
            2020202020          
00000E 800E 535953                  DB  "SYS"           ;拡張子(3)
000011 8011 0D                      DB  $0D
000012 8012 3125                    DW  LAST_ADR-RUN        ;サイズ
000014 8014 8080                    DW  RUN         ;開始アドレス
000016 8016 8080                    DW  RUN         ;実行アドレス
000018 8018                         DS  104
                                
                                    INCLUDE "M7INIT.ASM"
                                
                                ;   LSX-Dodgers INIT
                                ;   MZ-700/1500
                                
000080 8080 C38780          10      JP  START
000083 8083 011D                    DW  MACW
000085 8085 6101                    DW  VER
                                
       8087                     START:
000087 8087 F3               4      DI
000088 8088 ED56             8      IM  1
00008A 808A 318780          10      LD  SP,START
00008D 808D CD9B80          17      CALL    INIT        ;NZならAUTOEXECを実行
000090 8090 210000          10      LD  HL,0
000093 8093 E5              11      PUSH    HL
000094 8094 C8              11      RET Z
000095 8095 116D81          10      LD  DE,AUTOD
000098 8098 C3FDF0          10      JP  _COMANL
                                
       809B                     INIT:
00009B 809B D3E0            11      OUT (0E0H),A    ;DRAM(0000H-0FFFH)
00009D 809D D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
00009F 809F 21D381          10      LD  HL,INITE
0000A2 80A2 1106CF          10      LD  DE,BDOS
0000A5 80A5 01DE23          10      LD  BC,LAST_ADR-INITE
0000A8 80A8 EDB0                    LDIR
0000AA 80AA 21A481          10      LD  HL,M7BEEPD
0000AD 80AD 1162F0          10      LD  DE,BEEPD+1
0000B0 80B0 010800          10      LD  BC,M7BEEPE-M7BEEPD
0000B3 80B3 EDB0                    LDIR
                                
0000B5 80B5 210000          10      LD  HL,0
0000B8 80B8 065C             7      LD  B,05CH
0000BA 80BA 3E                      DB  03EH    ;LD A,??
0000BB 80BB EF              12      RST 28H
0000BC 80BC CDECDB          17      CALL    FILL_MEMORY
0000BF 80BF 06A4             7      LD  B,0A4H
0000C1 80C1 AF               4      XOR A
0000C2 80C2 320400          13      LD  (_DVSW),A
0000C5 80C5 CDECDB          17      CALL    FILL_MEMORY
                                
0000C8 80C8 3EC3             7      LD  A,0C3H      ;JP
0000CA 80CA 2103F0          10      LD  HL,CPM_WBOOT
0000CD 80CD 320000          13      LD  (00000H),A
0000D0 80D0 220100          16      LD  (00001H),HL ;IPL
                                
0000D3 80D3 2106CF          10      LD  HL,BDOS
0000D6 80D6 320500          13      LD  (00005H),A
0000D9 80D9 220600          16      LD  (00006H),HL ;BDOS
                                
0000DC 80DC 21D9FF          10      LD  HL,TRAP38   ;TRAP38
0000DF 80DF 322800          13      LD  (00028H),A
0000E2 80E2 222900          16      LD  (00029H),HL ;RST 028H
                                
0000E5 80E5 323800          13      LD  (00038H),A
0000E8 80E8 211ACF          10      LD  HL,IO_INT8253
0000EB 80EB 223900          16      LD  (00039H),HL
                                
0000EE 80EE 3EF0             7      LD  A,CPM_BOOT/256
0000F0 80F0 320B00          13      LD  (0000BH),A
                                
0000F3 80F3 3EE9             7      LD  A,0E9H      ;JP (HL)
0000F5 80F5 320F00          13      LD  (0000FH),A
                                                    ;CHECK PCG(MZ-1500)
0000F8 80F8 2100E8          10      LD  HL,0E800H
0000FB 80FB 46               7      LD  B,(HL)
0000FC 80FC F3               4      DI
0000FD 80FD 3E01             7      LD  A,1
0000FF 80FF D3E5            11      OUT (0E5H),A    ;MZ-1500: PCGバンク切り替え
000101 8101 4E               7      LD  C,(HL)
000102 8102 79               4      LD  A,C
000103 8103 C6A5             7      ADD A,0A5H
000105 8105 5F               4      LD  E,A
000106 8106 73               7      LD  (HL),E
000107 8107 D3E6            11      OUT (0E6H),A    ;MZ-1500: PCGバンクを閉じる
000109 8109 71               7      LD  (HL),C
00010A 810A 3E01             7      LD  A,1
00010C 810C D3E5            11      OUT (0E5H),A    ;MZ-1500: PCGバンク切り替え
00010E 810E 7E               7      LD  A,(HL)
00010F 810F BB               4      CP  E
000110 8110 D3E6            11      OUT (0E6H),A    ;MZ-1500: PCGバンクを閉じる
000112 8112 70               7      LD  (HL),B
000113 8113 FB               4      EI
000114 8114 2804            12      JR  Z,MZ1500
000116 8116 AF               4      XOR A       ;MZ-700はPCGバンクが存在しない
000117 8117 32C0F2          13      LD  (GRAMFL),A
       811A                     MZ1500:
00011A 811A DD2180F2        14      LD  IX,EMMFL
00011E 811E CD6281          17      CALL    CHECK_EMM_BPB
000121 8121 FEEB             7      CP  0EBH
000123 8123 2810            12      JR  Z,EMM_BPB
000125 8125 DD360D02        19      LD  (IX+DPB_MAXSEC),2   ;BPBが512バイト目から始まる場合を調べる
000129 8129 CD6281          17      CALL    CHECK_EMM_BPB
00012C 812C DDBE06           7      CP  (IX+DPB_FATID)
00012F 812F 2004            12      JR  NZ,EMM_BPB
000131 8131 DD360D00        19      LD  (IX+DPB_MAXSEC),0   ;BPBが先頭の場合に戻す
       8135                     EMM_BPB:
000135 8135 217981          10      LD  HL,INIMES
000138 8138 CD89D4          17      CALL    MSX
       813B                     INIT1:
00013B 813B F3               4      DI
00013C 813C 1100FF          10      LD  DE,0FF00H
00013F 813F 0600             7      LD  B,0
000141 8141 CD27D3          17      CALL    ZERO_MEMORY_DE
000144 8144 21CAFF          10      LD  HL,EXTBIO
000147 8147 36C9            10      LD  (HL),0C9H   ;RET
000149 8149 23               6      INC HL
00014A 814A 060E             7      LD  B,TRAP38-EXTBIO-1
00014C 814C 3E                      DB  03EH    ;LD A,??
00014D 814D EF              12      RST 28H
00014E 814E CDECDB          17      CALL    FILL_MEMORY
000151 8151 21AC81          10      LD  HL,AT_TRAP38
000154 8154 11D9FF          10      LD  DE,TRAP38
000157 8157 012700          10      LD  BC,AT_TRAPE-AT_TRAP38
00015A 815A EDB0                    LDIR
                                
00015C 815C CDC7DA          17      CALL    CHKEY
00015F 815F FE03             7      CP  3
000161 8161 C9              10      RET
                                
       8162                     CHECK_EMM_BPB:
000162 8162 D5              11      PUSH    DE
000163 8163 110000          10      LD  DE,0
000166 8166 CD28EA          17      CALL    EADR
000169 8169 D1              10      POP DE
00016A 816A ED78            12      IN  A,(C)
00016C 816C C9              10      RET
                                
00016D 816D 4155544F45584543    AUTOD:  DB  "AUTOEXEC "
            20                  
000176 8176 413A00              AUTODV: DB  "A:",0
                                
000179 8179 0C4C53582D446F64    INIMES: DB  00CH,"LSX-Dodgers for MZ-700/1500 v"
            6765727320666F72    
            204D5A2D3730302F    
            313530302076        
000197 8197 312E                    DB  030H + VER_1, '.'
000199 8199 3631                    DB  030H + VER_2 ,030H + VER_3
00019B 819B 62                      DB  'b'
00019C 819C 2047616B750D0A          DB  " Gaku",0DH,0AH
0001A3 81A3 00                      DB  0
                                
       81A4                     M7BEEPD:
0001A4 81A4 0801                    DB  8,1
0001A6 81A6 0736                    DB  7,036H
0001A8 81A8 04F9                    DB  4,0F9H
0001AA 81AA 0403                    DB  4,3
       81AC                     M7BEEPE:
                                
       81AC                     AT_TRAP38:
0001AC FFD9                         ORG TRAP38,AT_TRAP38-OFFSET
0001AC FFD9 210000          10      LD  HL,0
0001AF FFDC E3              19      EX  (SP),HL
0001B0 FFDD 3E24             7      LD  A,'$'
0001B2 FFDF CD14D7          17      CALL    MSG_A
0001B5 FFE2 2B               6      DEC HL
0001B6 FFE3 7C               4      LD  A,H
0001B7 FFE4 CDE8FF          17      CALL    PRHX
0001BA FFE7 7D               4      LD  A,L
       FFE8                     PRHX:
0001BB FFE8 F5              11      PUSH    AF
0001BC FFE9 07               4      RLCA
0001BD FFEA 07               4      RLCA
0001BE FFEB 07               4      RLCA
0001BF FFEC 07               4      RLCA
0001C0 FFED CDF1FF          17      CALL    PRHX2
0001C3 FFF0 F1              10      POP AF
       FFF1                     PRHX2:
0001C4 FFF1 E60F             7      AND 00FH
0001C6 FFF3 FE0A             7      CP  10
0001C8 FFF5 3F               4      CCF
0001C9 FFF6 CE30             7      ADC A,'0'
0001CB FFF8 27               4      DAA
0001CC FFF9 C314D7          10      JP  MSG_A
0001CF FFFC                         DS  4
0001D3 81D3                         ORG $$+OFFSET,$$    ;$DEPHASE
       81D3                     AT_TRAPE:
                                
       81D3                     INITE:
0001D3 CF06                         ORG BDOS,INITE-OFFSET
                                
0001D3 CF06 C309CF          10      JP  IO_BDOS
[EOF:M7INIT.ASM:SHIFT_JIS]
                                    INCLUDE "M7BANK.ASM"
                                
                                ;   LSX-Dodgers IO
                                ;   MZ-700/1500
                                ;   VRAM/KEY/TIMER(0D000H-0EFFFH)にアクセスするので0D000H-0FFFFHに置けない部分
                                ;
                                
       CF09                     IO_BDOS:
0001D6 CF09 D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
0001D8 CF0B C349D4          10      JP  BDOS0
                                
       CF0E                     RDKEYDATA:
0001DB CF0E F3               4      DI
0001DC CF0F D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
0001DE CF11 3200E0          13      LD  (0E000H),A
0001E1 CF14 3A01E0          13      LD  A,(E001H)
0001E4 CF17 D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
0001E6 CF19 FB               4      EI
       CF1A                     IO_INT8253:
0001E7 CF1A C9              10      RET
                                
       CF1B                     RD556VSYNC:
0001E8 CF1B F3               4      DI
0001E9 CF1C D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
0001EB CF1E 3A02E0          13      LD  A,(0E002H)
0001EE CF21 D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
0001F0 CF23 FB               4      EI
0001F1 CF24 C9              10      RET
                                
       CF25                     RDMMIO:
0001F2 CF25 F3               4      DI
0001F3 CF26 D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
0001F5 CF28 7E               7      LD  A,(HL)
0001F6 CF29 D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
0001F8 CF2B FB               4      EI
0001F9 CF2C C9              10      RET
                                
       CF2D                     WRMMIO:
0001FA CF2D F3               4      DI
0001FB CF2E D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
0001FD CF30 77               7      LD  (HL),A
0001FE CF31 D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
000200 CF33 FB               4      EI
000201 CF34 C9              10      RET
                                
       CF35                     RDMMIO_BC:
000202 CF35 F3               4      DI
000203 CF36 D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
000205 CF38 0A               7      LD  A,(BC)
000206 CF39 D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
000208 CF3B FB               4      EI
000209 CF3C C9              10      RET
                                
       CF3D                     WRMMIO_BC:
00020A CF3D F3               4      DI
00020B CF3E D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
00020D CF40 02               7      LD  (BC),A
00020E CF41 D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
000210 CF43 FB               4      EI
000211 CF44 C9              10      RET
                                
       CF45                     IO_PRINT:
000212 CF45 F3               4      DI
000213 CF46 D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
000215 CF48 77               7      LD  (HL),A
000216 CF49 CBDC             8      SET 3,H
000218 CF4B 71               7      LD  (HL),C
000219 CF4C D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
00021B CF4E FB               4      EI
00021C CF4F C9              10      RET
                                
       CF50                     IO_CLR:
00021D CF50 F3               4      DI
00021E CF51 D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
       CF53                     C1AX1:
000220 CF53 7A               4      LD  A,D
000221 CF54 C6D0             7      ADD A,0D0H
000223 CF56 57               4      LD  D,A
000224 CF57 AF               4      XOR A
000225 CF58 12               7      LD  (DE),A      ;Text
000226 CF59 CBDA             8      SET 3,D
       CF5C                     ICSMC   EQU $+1
000228 CF5B 3E00             7      LD  A,0     ;自己書き換え
00022A CF5D 12               7      LD  (DE),A      ;Color
00022B CF5E 13               6      INC DE
00022C CF5F 7A               4      LD  A,D
00022D CF60 D6D8             7      SUB 0D8H
00022F CF62 57               4      LD  D,A
000230 CF63 2118FC          10      LD  HL,0-WIDTH*LINE
000233 CF66 19              11      ADD HL,DE
000234 CF67 30EA            12      JR  NC,C1AX1
000236 CF69 E1              10      POP HL
000237 CF6A D1              10      POP DE
000238 CF6B D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
00023A CF6D FB               4      EI
00023B CF6E C9              10      RET
                                
       CF6F                     IO_CLLINE:
00023C CF6F F3               4      DI
00023D CF70 D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
       CF72                     CLLINE1:
00023F CF72 CB9C             8      RES 3,H
000241 CF74 77               7      LD  (HL),A      ;Text
000242 CF75 CBDC             8      SET 3,H
000244 CF77 71               7      LD  (HL),C      ;Color
000245 CF78 23               6      INC HL
000246 CF79 10F7            13      DJNZ    CLLINE1
000248 CF7B D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
00024A CF7D FB               4      EI
00024B CF7E C9              10      RET
                                
       CF7F                     IO_INS:
00024C CF7F F3               4      DI
00024D CF80 D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
       CF82                     IO_INS1:
00024F CF82 CD99CF          17      CALL    C12S
000252 CF85 23               6      INC HL
000253 CF86 10FA            13      DJNZ    IO_INS1
000255 CF88 D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
000257 CF8A FB               4      EI
000258 CF8B C9              10      RET
                                
       CF8C                     IO_BS:
000259 CF8C F3               4      DI
00025A CF8D D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
       CF8F                     IO_BS1:
00025C CF8F CD99CF          17      CALL    C12S
00025F CF92 2B               6      DEC HL
000260 CF93 10F7            13      DJNZ    IO_BS
000262 CF95 D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
000264 CF97 FB               4      EI
000265 CF98 C9              10      RET
                                
       CF99                     C12S:
000266 CF99 CB9C             8      RES 3,H
000268 CF9B 5E               7      LD  E,(HL)
000269 CF9C 77               7      LD  (HL),A
00026A CF9D 7B               4      LD  A,E
00026B CF9E CBDC             8      SET 3,H
00026D CFA0 5E               7      LD  E,(HL)
00026E CFA1 71               7      LD  (HL),C
00026F CFA2 4B               4      LD  C,E
000270 CFA3 C9              10      RET
                                
       CFA4                     IO_SCRUP:
000271 CFA4 F3               4      DI
000272 CFA5 D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
       CFA7                     SCRUP1:
000274 CFA7 2815            12      JR  Z,SCRCL
000276 CFA9 D5              11      PUSH    DE
000277 CFAA E5              11      PUSH    HL
000278 CFAB CBDA             8      SET 3,D
00027A CFAD CBDC             8      SET 3,H
00027C CFAF 012800          10      LD  BC,WIDTH
00027F CFB2 EDB0                    LDIR
000281 CFB4 E1              10      POP HL
000282 CFB5 D1              10      POP DE
000283 CFB6 012800          10      LD  BC,WIDTH
000286 CFB9 EDB0                    LDIR
000288 CFBB 3D               4      DEC A
000289 CFBC 18E9            12      JR  SCRUP1
                                
       CFBE                     SCRCL:
00028B CFBE 0628             7      LD  B,WIDTH
00028D CFC0 EB               4      EX  DE,HL
00028E CFC1 D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
000290 CFC3 CD05D9          17      CALL    CLLINE
000293 CFC6 E1              10      POP HL
000294 CFC7 D1              10      POP DE
000295 CFC8 C1              10      POP BC
000296 CFC9 C9              10      RET
                                
       CFCA                     RD_PCG:
000297 CFCA F3               4      DI
000298 CFCB D3E5            11      OUT (0E5H),A    ;MZ-1500: PCGバンク切り替え
00029A CFCD 4E               7      LD  C,(HL)
       CFCE                     RW_PCG:
00029B CFCE D3E6            11      OUT (0E6H),A    ;MZ-1500: PCGバンクを閉じる
00029D CFD0 FB               4      EI
00029E CFD1 C9              10      RET
                                
       CFD2                     WR_PCG:
00029F CFD2 F3               4      DI
0002A0 CFD3 D3E5            11      OUT (0E5H),A    ;MZ-1500: PCGバンク切り替え
0002A2 CFD5 71               7      LD  (HL),C
0002A3 CFD6 18F6            12      JR  RW_PCG
                                
       CFD8                     C_MON:
0002A5 CFD8 D3E4            11      OUT (0E4H),A    ;MONITOR ROM(0000H-0FFFH) & VRAM/KEY/TIMER(D000H-FFFFH)
0002A7 CFDA C7              12      RST 0
                                
       CFDB                     BANKE:
0002A8 CFDB                         DS  0CFFEH-BANKE
[EOF:M7BANK.ASM:SHIFT_JIS]
                                    INCLUDE "M7CCP.ASM"
                                
                                ;   LSX-Dodgers CCP
                                ;   MZ-700/1500
                                
       CFFE                     WBOOT1:
0002CB CFFE D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)　ここは0CFFEH
0002CD D000 D3E0            11      OUT (0E0H),A    ;DRAM(0000H-0FFHH)
0002CF D002 F3               4      DI
0002D0 D003 3A94F0          13      LD  A,(_KEYSP)
0002D3 D006 ED7B0600        20      LD  SP,(SYSTEM+1)
0002D7 D00A FB               4      EI
0002D8 D00B 2192F0          10      LD  HL,_KEYD
0002DB D00E 3600            10      LD  (HL),0
0002DD D010 CDC7DA          17      CALL    CHKEY
0002E0 D013 CD10D7          17      CALL    KEYBC_IFBREAK
0002E3 D016 3E04             7      LD  A,4
0002E5 D018 CD14D7          17      CALL    MSG_A
[EOF:M7CCP.ASM:UTF_8]
                                    INCLUDE "LDCCP.ASM"
                                
                                ;   LSX-Dodgers CCP
                                
       D01B                     COMMAND:
0002E8 D01B 3A26EB          13      LD  A,(FCB_BAT)
0002EB D01E B7               4      OR  A
0002EC D01F C261D1          10      JP  NZ,C_BAT1
0002EF D022 CDD5D0          17      CALL    SETDTA1
0002F2 D025 3A0400          13      LD  A,(_DVSW)
0002F5 D028 C641             7      ADD A,'A'
0002F7 D02A CD14D7          17      CALL    MSG_A
0002FA D02D 3E3E             7      LD  A,'>'
0002FC D02F CD14D7          17      CALL    MSG_A
0002FF D032 3E50             7      LD  A,80
000301 D034 12               7      LD  (DE),A
000302 D035 CD70D7          17      CALL    _SYS0A      ;(BDOS)文字列入力
000305 D038 CD56D2          17      CALL    LTNL
       D03B                     COMMAND2:
000308 D03B 118200          10      LD  DE,DTA1+2
00030B D03E CDFDF0          17      CALL    _COMANL
00030E D041 30D8            12      JR  NC,COMMAND
000310 D043 1179F0          10      LD  DE,COMERM
000313 D046 CD7AD4          17      CALL    _SYS09      ;(BDOS)文字列出力
000316 D049 C7              12      RST 0
                                
       D04A                     COMANL:
000317 D04A CD40DB          17      CALL    FILE
00031A D04D 3A19F0          13      LD  A,(FNAME+4)
00031D D050 FE20             7      CP  020H
00031F D052 201C            12      JR  NZ,COMB2
000321 D054 D5              11      PUSH    DE
000322 D055 1115F0          10      LD  DE,FNAME
000325 D058 1A               7      LD  A,(DE)
000326 D059 FE20             7      CP  020H
000328 D05B 2844            12      JR  Z,SDVSW
00032A D05D 1B               6      DEC DE
00032B D05E 1A               7      LD  A,(DE)
00032C D05F C6FF             7      ADD A,0FFH
00032E D061 3809            12      JR  C,COMB
000330 D063 13               6      INC DE
                                
000331 D064 2113D4          10      LD  HL,COMTB
000334 D067 0609             7      LD  B,COMS
000336 D069 CDCFDD          17      CALL    CPNAME
       D06C                     COMB:
000339 D06C D1              10      POP DE
00033A D06D D20F00          10      JP  NC,JP_HL
       D070                     COMB2:
00033D D070 EB               4      EX  DE,HL
00033E D071 223ED1          16      LD  (COMSWC),HL
000341 D074 F5              11      PUSH    AF
000342 D075 CDF6D0          17      CALL    CEXE4
000345 D078 F1              10      POP AF
000346 D079 2115F0          10      LD  HL,FNAME
000349 D07C 116D00          10      LD  DE,FCB2FN   ;COMMAND NAME
00034C D07F 010B00          10      LD  BC,11
00034F D082 EDB0                    LDIR
000351 D084 11C5EA          10      LD  DE,PATHD
       D087                     CEX1:
000354 D087 1A               7      LD  A,(DE)
000355 D088 FE20             7      CP  020H
000357 D08A D8              11      RET C
000358 D08B CD35DB          17      CALL    FILEC
00035B D08E D5              11      PUSH    DE
00035C D08F 216D00          10      LD  HL,FCB2FN   ;COMMAND NAME
00035F D092 1115F0          10      LD  DE,FNAME
000362 D095 010B00          10      LD  BC,11
000365 D098 EDB0                    LDIR
000367 D09A CDF6D0          17      CALL    CEXE4
00036A D09D D1              10      POP DE
00036B D09E 13               6      INC DE
00036C D09F 18E6            12      JR  CEX1
                                
       D0A1                     SDVSW:
00036E D0A1 F1              10      POP AF
00036F D0A2 3A14F0          13      LD  A,(FDRV)
000372 D0A5 3D               4      DEC A
000373 D0A6 5F               4      LD  E,A
000374 D0A7 0E0E             7      LD  C,00EH      ;(BDOS)カレントドライブの設定
000376 D0A9 1831            12      JR  SYSTEM0
                                
       D0AB                     OPEN1:
000378 D0AB 2114F0          10      LD  HL,FDRV
       D0AE                     OPEN:
00037B D0AE 0E11             7      LD  C,011H      ;(BDOS)ファイルの検索
       D0B0                     OPEN3:
00037D D0B0 D5              11      PUSH    DE
00037E D0B1 1101EB          10      LD  DE,DTA_CCP
000381 D0B4 CDD2D0          17      CALL    SETDTA
000384 D0B7 EB               4      EX  DE,HL
000385 D0B8 CDDCD0          17      CALL    SYSTEM0
000388 D0BB D1              10      POP DE
000389 D0BC C9              10      RET
                                
       D0BD                     OPEN2:
00038A D0BD 0E12             7      LD  C,012H
00038C D0BF 18EF            12      JR  OPEN3
                                
       D0C1                     DEFCB:              ;Z=Ok NZ=Error
00038E D0C1 1101EB          10      LD  DE,DTA_CCP
000391 D0C4 CDDAD0          17      CALL    SYSC0F
                                
000394 D0C7 1122EB          10      LD  DE,DTA_CCP+33   ;(FCB)ランダムレコード
000397 D0CA 0604             7      LD  B,4
000399 D0CC CD27D3          17      CALL    ZERO_MEMORY_DE
       D0CF                     SETDTA100:
00039C D0CF 110001          10      LD  DE,BUFFER
       D0D2                     SETDTA:
00039F D0D2 C34DD6          10      JP  _SYS1A      ;(BDOS)DTAの設定
                                
       D0D5                     SETDTA1:
0003A2 D0D5 118000          10      LD  DE,DTA1
0003A5 D0D8 18F8            12      JR  SETDTA
                                
       D0DA                     SYSC0F:
0003A7 D0DA 0E0F             7      LD  C,00FH      ;(BDOS)ファイルのオープン
       D0DC                     SYSTEM0:
0003A9 D0DC CD0500          17      CALL    SYSTEM
0003AC D0DF B7               4      OR  A
0003AD D0E0 C9              10      RET
                                
       D0E1                     C_CD:
0003AE D0E1 0E5A             7      LD  C,05AH
0003B0 D0E3 18F7            12      JR  SYSTEM0
                                
       D0E5                     S27BUF:
0003B2 D0E5 2100FE          10      LD  HL,0-BUFFER-00100H  ;バッファー+スタック予備(0100H)
       D0E8                     S27BUF2:
0003B5 D0E8 39              11      ADD HL,SP
0003B6 D0E9 2E00             7      LD  L,0
0003B8 D0EB 7C               4      LD  A,H
0003B9 D0EC E6F8             7      AND 0F8H
0003BB D0EE 67               4      LD  H,A
       D0EF                     S27DTA:
0003BC D0EF 1101EB          10      LD  DE,DTA_CCP
       D0F2                     S27:
0003BF D0F2 0E27             7      LD  C,027H      ;(BDOS)ランダムブロック読み込み
0003C1 D0F4 18E6            12      JR  SYSTEM0
                                
       D0F6                     CEXE4:
0003C3 D0F6 211DF0          10      LD  HL,FNAME+8
0003C6 D0F9 7E               7      LD  A,(HL)
0003C7 D0FA FE20             7      CP  020H
0003C9 D0FC 2007            12      JR  NZ,CEXE7
0003CB D0FE 3E3F             7      LD  A,'?'
0003CD D100 77               7      LD  (HL),A
0003CE D101 23               6      INC HL
0003CF D102 77               7      LD  (HL),A
0003D0 D103 23               6      INC HL
0003D1 D104 77               7      LD  (HL),A
       D105                     CEXE7:
0003D2 D105 CDABD0          17      CALL    OPEN1
       D108                     CEXE5:
0003D5 D108 C0              11      RET NZ
0003D6 D109 2A0BEB          16      LD  HL,(DTA_CCP+1+9)
0003D9 D10C 7C               4      LD  A,H
0003DA D10D CD57DE          17      CALL    CAP
0003DD D110 67               4      LD  H,A
0003DE D111 7D               4      LD  A,L
0003DF D112 CD57DE          17      CALL    CAP
0003E2 D115 6F               4      LD  L,A
0003E3 D116 3A0AEB          13      LD  A,(DTA_CCP+1+8)
0003E6 D119 CD57DE          17      CALL    CAP
0003E9 D11C D642             7      SUB 'B'
0003EB D11E 282C            12      JR  Z,C_BAT
0003ED D120 3D               4      DEC A       ;'C'
0003EE D121 2805            12      JR  Z,C_EXE
       D123                     CEXE6:
0003F0 D123 CDBDD0          17      CALL    OPEN2
0003F3 D126 18E0            12      JR  CEXE5
                                
       D128                     C_EXE:
0003F5 D128 7C               4      LD  A,H
0003F6 D129 FE4D             7      CP  'M'
0003F8 D12B 20F6            12      JR  NZ,CEXE6
                                
0003FA D12D CDC1D0          17      CALL    DEFCB
0003FD D130 CDE5D0          17      CALL    S27BUF_COM
000400 D133 3D               4      DEC A
000401 D134 37               4      SCF
000402 D135 C0              11      RET NZ
000403 D136 7C               4      LD  A,H
000404 D137 B5               4      OR  L
000405 D138 37               4      SCF
000406 D139 C8              11      RET Z
000407 D13A CDD5D0          17      CALL    SETDTA1
00040A D13D 110000          10      LD  DE,0                ; self-modifying code
       D13E                     COMSWC  EQU $-2
00040D D140 ED7B0600        20      LD  SP,(SYSTEM+1)
000411 D144 67               4      LD  H,A             ; A=0 in SETDTA1(_SYS1A)
000412 D145 6F               4      LD  L,A
000413 D146 E5              11      PUSH    HL              ; push $0000 (reboot address)
000414 D147 24               4      INC H
000415 D148 E5              11      PUSH    HL              ; push $0100 (TPA address)
000416 D149 C3F2D2          10      JP  SETFCB              ; and JP $0100
                                
       D14C                     C_BAT:
000419 D14C 114154          10      LD  DE,'A'+'T'*256
00041C D14F ED52            15      SBC HL,DE
00041E D151 20D0            12      JR  NZ,CEXE6
                                
000420 D153 CDC1D0          17      CALL    DEFCB
                                
000423 D156 2101EB          10      LD  HL,DTA_CCP
000426 D159 1126EB          10      LD  DE,FCB_BAT
000429 D15C 012500          10      LD  BC,37
00042C D15F EDB0                    LDIR
       D161                     C_BAT1:
00042E D161 CDCFD0          17      CALL    SETDTA100
000431 D164 CD98D1          17      CALL    FGETC_BAT
000434 D167 218100          10      LD  HL,DTA1+1
000437 D16A 2025            12      JR  NZ,END_BATCH
000439 D16C FE21             7      CP  021H        ;スペースや改行など制御文字を飛ばす
00043B D16E 38F1            12      JR  C,C_BAT1
00043D D170 3620            10      LD  (HL),' '
00043F D172 23               6      INC HL
       D173                     C_BAT2:
000440 D173 77               7      LD  (HL),A
000441 D174 23               6      INC HL
000442 D175 7D               4      LD  A,L
000443 D176 3C               4      INC A       ;L==0FFH
000444 D177 2809            12      JR  Z,RUN_BATCH
000446 D179 CD98D1          17      CALL    FGETC_BAT
000449 D17C 2004            12      JR  NZ,RUN_BATCH
00044B D17E FE20             7      CP  020H
00044D D180 30F1            12      JR  NC,C_BAT2
       D182                     RUN_BATCH:
00044F D182 7D               4      LD  A,L
000450 D183 D67F             7      SUB DTA1-1
000452 D185 328000          13      LD  (DTA1),A
000455 D188 FE04             7      CP  4
000457 D18A 3805            12      JR  C,END_BATCH
000459 D18C 3600            10      LD  (HL),0
00045B D18E C33BD0          10      JP  COMMAND2
       D191                     END_BATCH:
00045E D191 AF               4      XOR A       ;バッチファイルを閉じる
00045F D192 3226EB          13      LD  (FCB_BAT),A
000462 D195 C300F0          10      JP  CPM_BOOT
                                
       D198                     FGETC_BAT:
000465 D198 1126EB          10      LD  DE,FCB_BAT
       D19B                     FGETC:              ;1文字ずつ読み込む
000468 D19B E5              11      PUSH    HL      ;Z:成功
000469 D19C 210100          10      LD  HL,1
00046C D19F CDF2D0          17      CALL    S27
00046F D1A2 E1              10      POP HL
000470 D1A3 3A0001          13      LD  A,(BUFFER)
000473 D1A6 C9              10      RET
                                
       D1A7                     C_DEL:
000474 D1A7 CDF2D2          17      CALL    SETFCB
000477 D1AA CD2AD7          17      CALL    _SYS08      ;(BDOS)エコーなしコンソール入力
                                
00047A D1AD 0E13             7      LD  C,013H
00047C D1AF 180A            12      JR  CDEL1       ;(BDOS)ファイルの削除
                                
       D1B1                     C_REN:
00047E D1B1 CDF2D2          17      CALL    SETFCB
000481 D1B4 3E10             7      LD  A,010H      ;ディレクトリも対象にする
000483 D1B6 326900          13      LD  (FCB1+13),A ;属性
000486 D1B9 0E17             7      LD  C,017H      ;(BDOS)ファイル名の変更
       D1BB                     CDEL1:
000488 D1BB 115C00          10      LD  DE,FCB1
00048B D1BE CD0500          17      CALL    SYSTEM
00048E D1C1 C6FF             7      ADD A,0FFH
000490 D1C3 C9              10      RET
                                
       D1C4                     C_DIR:
000491 D1C4 CD35DB          17      CALL    FILEC
000494 D1C7 2115F0          10      LD  HL,FDRV+1
000497 D1CA CD08D4          17      CALL    CWILD1
00049A D1CD 3EF1             7      LD  A,0F1H
00049C D1CF 3221F0          13      LD  (FDRV+13),A
00049F D1D2 CDABD0          17      CALL    OPEN1
       D1D5                     CDIR1:
0004A2 D1D5 B7               4      OR  A
0004A3 D1D6 2008            12      JR  NZ,PDSKF
0004A5 D1D8 CD23D2          17      CALL    P_NAME
0004A8 D1DB CDBDD0          17      CALL    OPEN2
0004AB D1DE 18F5            12      JR  CDIR1
       D1E0                     PDSKF:
0004AD D1E0 3A14F0          13      LD  A,(FDRV)
0004B0 D1E3 5F               4      LD  E,A
0004B1 D1E4 0E1B             7      LD  C,01BH      ;(BDOS)ディスク情報の獲得
0004B3 D1E6 CD0500          17      CALL    SYSTEM
0004B6 D1E9 4F               4      LD  C,A     ;C←1クラスタ辺りの論理セクタ数
0004B7 D1EA C601             7      ADD A,001H
0004B9 D1EC D8              11      RET C       ;Aが0FFHだった場合
0004BA D1ED 3E06             7      LD  A,8-2
       D1EF                     PDS1:               ;HL=未使用クラスタの総数
0004BC D1EF 3C               4      INC A
0004BD D1F0 CB19             8      RR  C
0004BF D1F2 30FB            12      JR  NC,PDS1
       D1F4                     PDS2:               ;B←論理セクタのサイズの上位8ビット
0004C1 D1F4 3C               4      INC A
0004C2 D1F5 CB18             8      RR  B
0004C4 D1F7 30FB            12      JR  NC,PDS2
0004C6 D1F9 47               4      LD  B,A
                                
0004C7 D1FA 110000          10      LD  DE,0
       D1FD                     PDS3:
0004CA D1FD 29              11      ADD HL,HL
0004CB D1FE EB               4      EX  DE,HL
0004CC D1FF ED6A            15      ADC HL,HL
0004CE D201 EB               4      EX  DE,HL
0004CF D202 10F9            13      DJNZ    PDS3
       D204                     PDSKF1:
0004D1 D204 CD90D2          17      CALL    PRDEC_DEHL
0004D4 D207 1156EB          10      LD  DE,FREE
0004D7 D20A CD7AD4          17      CALL    _SYS09      ;(BDOS)文字列出力
0004DA D20D CD7DD2          17      CALL    PUTDRV
0004DD D210 3E5C             7      LD  A,05CH      ;\
0004DF D212 CD14D7          17      CALL    MSG_A
0004E2 D215 2A22F0          16      LD  HL,(FDRV+14)    ;ディレクトリのクラスタ番号
0004E5 D218 AF               4      XOR A
0004E6 D219 11FEFF          10      LD  DE,0-2
0004E9 D21C 19              11      ADD HL,DE
0004EA D21D 23               6      INC HL
0004EB D21E DC8DD2          17      CALL    C,PRDEC_HL
0004EE D221 1833            12      JR  LTNL
                                
       D223                     P_NAME:
0004F0 D223 3A02EB          13      LD  A,(DTA_CCP+1)
0004F3 D226 FE2E             7      CP  '.'
0004F5 D228 C8              11      RET Z
                                
0004F6 D229 3A0DEB          13      LD  A,(DTA_CCP+1+00BH)
0004F9 D22C F5              11      PUSH    AF
0004FA D22D CB67             8      BIT 4,A
0004FC D22F 2808            12      JR  Z,DIR3
0004FE D231 114BEB          10      LD  DE,DIRMES
000501 D234 CD7AD4          17      CALL    _SYS09      ;(BDOS)文字列出力
000504 D237 180A            12      JR  DIR6
       D239                     DIR3:
000506 D239 ED5B20EB        20      LD  DE,(DTA_CCP+1+01EH)
00050A D23D 2A1EEB          16      LD  HL,(DTA_CCP+1+01CH)
00050D D240 CD90D2          17      CALL    PRDEC_DEHL
       D243                     DIR6:
000510 D243 F1              10      POP AF
000511 D244 0F               4      RRCA
000512 D245 9F               4      SBC A,A
000513 D246 E60A             7      AND '*'-020H
000515 D248 C620             7      ADD A,020H
000517 D24A CD14D7          17      CALL    MSG_A
00051A D24D CD7DD2          17      CALL    PUTDRV
00051D D250 2102EB          10      LD  HL,DTA_CCP+1
000520 D253 CDD0D2          17      CALL    FPRNT
                                
       D256                     LTNL:
000523 D256 1E03             7      LD  E,3
000525 D258 C3CDF0          10      JP  _PRINT
                                
       D25B                     C_PATH:
000528 D25B CD17DC          17      CALL    SPCUT
00052B D25E 21C5EA          10      LD  HL,PATHD
00052E D261 FE21             7      CP  021H
000530 D263 300C            12      JR  NC,CPATH0
       D265                     CPATHP:
000532 D265 7E               7      LD  A,(HL)
000533 D266 23               6      INC HL
000534 D267 FE20             7      CP  020H
000536 D269 3F               4      CCF
000537 D26A 30EA            12      JR  NC,LTNL
000539 D26C CD14D7          17      CALL    MSG_A
00053C D26F 18F4            12      JR  CPATHP
       D271                     CPATH0:
00053E D271 FE3B             7      CP  ';'
000540 D273 2001            12      JR  NZ,CPATH1
000542 D275 13               6      INC DE
       D276                     CPATH1:
000543 D276 EB               4      EX  DE,HL
000544 D277 013B00          10      LD  BC,PATHX
000547 D27A EDB0                    LDIR
000549 D27C C9              10      RET
                                
       D27D                     PUTDRV:
00054A D27D 3A14F0          13      LD  A,(FDRV)
00054D D280 CD4ADC          17      CALL    GETDRV1
000550 D283 C641             7      ADD A,'A'
000552 D285 CD14D7          17      CALL    MSG_A
000555 D288 3E3A             7      LD  A,':'
       D28A                     MSG_AR:
000557 D28A C314D7          10      JP  MSG_A
                                
       D28D                     PRDEC_HL:
00055A D28D AF               4      XOR A
00055B D28E 5F               4      LD  E,A
00055C D28F 57               4      LD  D,A
       D290                     PRDEC_DEHL:
00055D D290 D5              11      PUSH    DE
00055E D291 110FF0          10      LD  DE,DECBF
000561 D294 0605             7      LD  B,5
000563 D296 CD27D3          17      CALL    ZERO_MEMORY_DE  ;A=0
000566 D299 D1              10      POP DE
                                
000567 D29A 0E20             7      LD  C,32
       D29C                     DEC1:
000569 D29C 29              11      ADD HL,HL
00056A D29D EB               4      EX  DE,HL
00056B D29E ED6A            15      ADC HL,HL
00056D D2A0 EB               4      EX  DE,HL
00056E D2A1 E5              11      PUSH    HL
00056F D2A2 2113F0          10      LD  HL,DECBF+4
000572 D2A5 0605             7      LD  B,5
       D2A7                     DEC2:
000574 D2A7 7E               7      LD  A,(HL)
000575 D2A8 8F               4      ADC A,A
000576 D2A9 27               4      DAA
000577 D2AA 77               7      LD  (HL),A
000578 D2AB 2B               6      DEC HL
000579 D2AC 10F9            13      DJNZ    DEC2
00057B D2AE E1              10      POP HL
00057C D2AF 0D               4      DEC C
00057D D2B0 20EA            12      JR  NZ,DEC1
                                
00057F D2B2 210FF0          10      LD  HL,DECBF
000582 D2B5 3E20             7      LD  A,020H
000584 D2B7 0604             7      LD  B,4
       D2B9                     DEC3:
000586 D2B9 CDC6D2          17      CALL    DEC4
000589 D2BC CDC6D2          17      CALL    DEC4
00058C D2BF 23               6      INC HL
00058D D2C0 10F7            13      DJNZ    DEC3
       D2C2                     DECX:
00058F D2C2 CDC6D2          17      CALL    DEC4
000592 D2C5 AF               4      XOR A
       D2C6                     DEC4:
000593 D2C6 ED6F            18      RLD
000595 D2C8 FE20             7      CP  020H
000597 D2CA 2802            12      JR  Z,DEC5
000599 D2CC F630             7      OR  030H
       D2CE                     DEC5:
00059B D2CE 18BA            12      JR  MSG_AR
                                
       D2D0                     FPRNT:
00059D D2D0 0608             7      LD  B,8 ;ファイル名を表示
00059F D2D2 CDE1D2          17      CALL    P_N1
0005A2 D2D5 7E               7      LD  A,(HL)
0005A3 D2D6 CD63DE          17      CALL    CAP3
0005A6 D2D9 D8              11      RET C   ;拡張子が無い
                                
0005A7 D2DA 3E2E             7      LD  A,'.'
0005A9 D2DC CD14D7          17      CALL    MSG_A
0005AC D2DF 0603             7      LD  B,3 ;拡張子を表示
       D2E1                     P_N1:
0005AE D2E1 7E               7      LD  A,(HL)
0005AF D2E2 CD63DE          17      CALL    CAP3
0005B2 D2E5 3807            12      JR  C,P_N2
0005B4 D2E7 CD14D7          17      CALL    MSG_A
0005B7 D2EA 23               6      INC HL
0005B8 D2EB 10F4            13      DJNZ    P_N1
0005BA D2ED C9              10      RET
       D2EE                     P_N2:
0005BB D2EE 23               6      INC HL
0005BC D2EF 10FD            13      DJNZ    P_N2
0005BE D2F1 C9              10      RET
                                
       D2F2                     SETFCB:
0005BF D2F2 CD17DC          17      CALL    SPCUT
0005C2 D2F5 1A               7      LD  A,(DE)
0005C3 D2F6 FE20             7      CP  020H
0005C5 D2F8 3801            12      JR  C,SETFCBA
0005C7 D2FA 1B               6      DEC DE
       D2FB                     SETFCBA:
0005C8 D2FB 0624             7      LD  B,36
0005CA D2FD 215C00          10      LD  HL,FCB1
0005CD D300 E5              11      PUSH    HL
0005CE D301 AF               4      XOR A
0005CF D302 CDECDB          17      CALL    FILL_MEMORY
0005D2 D305 E1              10      POP HL
0005D3 D306 D5              11      PUSH    DE
0005D4 D307 CDB4D6          17      CALL    _SYS29      ;(BDOS)ファイル名の解析
0005D7 D30A 216C00          10      LD  HL,FCB2
0005DA D30D CDB4D6          17      CALL    _SYS29      ;(BDOS)ファイル名の解析
0005DD D310 E1              10      POP HL
0005DE D311 010050          10      LD  BC,05000H
0005E1 D314 118100          10      LD  DE,00081H
       D317                     SETFCB1:
0005E4 D317 7E               7      LD  A,(HL)
0005E5 D318 23               6      INC HL
0005E6 D319 FE20             7      CP  020H
0005E8 D31B 3805            12      JR  C,SETFCB2
0005EA D31D 12               7      LD  (DE),A
0005EB D31E 13               6      INC DE
0005EC D31F 0C               4      INC C
0005ED D320 10F5            13      DJNZ    SETFCB1
       D322                     SETFCB2:
0005EF D322 79               4      LD  A,C
0005F0 D323 328000          13      LD  (DTA1),A
0005F3 D326 04               4      INC B
       D327                     ZERO_MEMORY_DE:
0005F4 D327 AF               4      XOR A
       D328                     FILL_MEMORY_DE:
0005F5 D328 12               7      LD  (DE),A
0005F6 D329 13               6      INC DE
0005F7 D32A 10FC            13      DJNZ    FILL_MEMORY_DE
0005F9 D32C C9              10      RET
                                
       D32D                     C_COPY:
0005FA D32D CDF2D2          17      CALL    SETFCB
                                
0005FD D330 1161F0          10      LD  DE,ZERO
000600 D333 CD38DB          17      CALL    FILEC2
000603 D336 216C00          10      LD  HL,FCB2
000606 D339 CDBBD6          17      CALL    S29X1
                                
000609 D33C 3E10             7      LD  A,010H
00060B D33E 326900          13      LD  (FCB1+13),A
00060E D341 216D00          10      LD  HL,FCB2FN
000611 D344 CD08D4          17      CALL    CWILD1
       D347                     COPY0:
000614 D347 CD05D4          17      CALL    CWILD
000617 D34A 215C00          10      LD  HL,FCB1
00061A D34D CDAED0          17      CALL    OPEN
00061D D350 37               4      SCF
       D351                     COPY1:
00061E D351 C0              11      RET NZ
00061F D352 CDC1D0          17      CALL    DEFCB
                                
000622 D355 3A0EEB          13      LD  A,(DTA_CCP+13)
000625 D358 CB67             8      BIT 4,A
000627 D35A 2821            12      JR  Z,COPY1A
                                
000629 D35C 215D00          10      LD  HL,FCB1FN
00062C D35F CD7BDF          17      CALL    CHKWILD
00062F D362 3814            12      JR  C,COPY9
                                
000631 D364 3E20             7      LD  A,020H
000633 D366 325D00          13      LD  (FCB1FN),A
000636 D369 2A1BEB          16      LD  HL,(DTA_CCP+26)
000639 D36C 23               6      INC HL
00063A D36D 226A00          16      LD  (FCB1+14),HL
00063D D370 18D5            12      JR  COPY0
                                
       D372                     COPY8:
00063F D372 CD7AD4          17      CALL    _SYS09      ;(BDOS)文字列出力
000642 D375 CD56D2          17      CALL    LTNL
       D378                     COPY9:
000645 D378 CDBDD0          17      CALL    OPEN2
000648 D37B 18D4            12      JR  COPY1
                                
       D37D                     COPY1A:
00064A D37D 216C00          10      LD  HL,FCB2
00064D D380 1114F0          10      LD  DE,FDRV
000650 D383 0103EB          10      LD  BC,DTA_CCP+2
000653 D386 EDA0            16      LDI
000655 D388 3E0B             7      LD  A,11
       D38A                     COPY2:
000657 D38A F5              11      PUSH    AF
000658 D38B 7E               7      LD  A,(HL)
000659 D38C FE3F             7      CP  '?'
00065B D38E 2001            12      JR  NZ,COPY3
00065D D390 0A               7      LD  A,(BC)
       D391                     COPY3:
00065E D391 12               7      LD  (DE),A
00065F D392 03               6      INC BC
000660 D393 13               6      INC DE
000661 D394 23               6      INC HL
000662 D395 F1              10      POP AF
000663 D396 3D               4      DEC A
000664 D397 20F1            12      JR  NZ,COPY2
000666 D399 010500          10      LD  BC,16-11
000669 D39C EDB0                    LDIR
       D39E                     PUTNAME:
00066B D39E 215D00          10      LD  HL,FCB1FN
00066E D3A1 CD7BDF          17      CALL    CHKWILD
000671 D3A4 300B            12      JR  NC,PUTN1
000673 D3A6 2115F0          10      LD  HL,FDRV+1
000676 D3A9 CDD0D2          17      CALL    FPRNT
000679 D3AC 3E20             7      LD  A,020H
00067B D3AE CD14D7          17      CALL    MSG_A
       D3B1                     PUTN1:
00067E D3B1 1114F0          10      LD  DE,FDRV
000681 D3B4 0E16             7      LD  C,016H      ;(BDOS)ファイルの作成
000683 D3B6 CDDCD0          17      CALL    SYSTEM0
000686 D3B9 2048            12      JR  NZ,COPYE2
000688 D3BB 67               4      LD  H,A     ;A=0
000689 D3BC 6F               4      LD  L,A
00068A D3BD 2235F0          16      LD  (FDRV+33),HL    ;(FCB)ランダムレコード
00068D D3C0 2237F0          16      LD  (FDRV+35),HL
       D3C3                     COPY6:
000690 D3C3 CDE5D0          17      CALL    S27BUF
000693 D3C6 47               4      LD  B,A
000694 D3C7 3C               4      INC A
000695 D3C8 2831            12      JR  Z,COPYE
000697 D3CA 7C               4      LD  A,H
000698 D3CB B5               4      OR  L
000699 D3CC 280C            12      JR  Z,COPY7
00069B D3CE 1114F0          10      LD  DE,FDRV
00069E D3D1 0E26             7      LD  C,026H      ;(BDOS)ランダムブロック書き込み
0006A0 D3D3 CDDCD0          17      CALL    SYSTEM0
0006A3 D3D6 2023            12      JR  NZ,COPYE
0006A5 D3D8 10E9            13      DJNZ    COPY6
       D3DA                     COPY7:
0006A7 D3DA 3A0EEB          13      LD  A,(DTA_CCP+13)  ;(FCB)属性
0006AA D3DD 3221F0          13      LD  (FDRV+13),A
0006AD D3E0 2115EB          10      LD  HL,DTA_CCP+20   ;(FCB)タイムスタンプ
0006B0 D3E3 1128F0          10      LD  DE,FDRV+20
0006B3 D3E6 010400          10      LD  BC,4
0006B6 D3E9 EDB0                    LDIR
                                
0006B8 D3EB 1114F0          10      LD  DE,FDRV
0006BB D3EE 0E10             7      LD  C,010H      ;(BDOS)ファイルのクローズ
0006BD D3F0 CDDCD0          17      CALL    SYSTEM0
0006C0 D3F3 2006            12      JR  NZ,COPYE
                                
0006C2 D3F5 1171F0          10      LD  DE,OK
0006C5 D3F8 C372D3          10      JP  COPY8
                                
       D3FB                     COPYE:
0006C8 D3FB 1114F0          10      LD  DE,FDRV
0006CB D3FE 0E13             7      LD  C,013H      ;(BDOS)ファイルの削除
0006CD D400 CD0500          17      CALL    SYSTEM
       D403                     COPYE2:
0006D0 D403 37               4      SCF
0006D1 D404 C9              10      RET
                                
       D405                     CWILD:
0006D2 D405 215D00          10      LD  HL,FCB1FN
       D408                     CWILD1:
0006D5 D408 7E               7      LD  A,(HL)
0006D6 D409 FE20             7      CP  020H
0006D8 D40B C0              11      RET NZ
       D40C                     CWILD2:
0006D9 D40C 3E3F             7      LD  A,'?'
0006DB D40E 060B             7      LD  B,11
0006DD D410 C3ECDB          10      JP  FILL_MEMORY
                                
       D413                     COMTB:
0006E0 D413 44202020                DB  "D   "  ;1
0006E4 D417 C4D1                    DW  C_DIR
0006E6 D419 44495220                DB  "DIR "  ;2
0006EA D41D C4D1                    DW  C_DIR
0006EC D41F 434F5059                DB  "COPY"  ;3
0006F0 D423 2DD3                    DW  C_COPY
0006F2 D425 43442020                DB  "CD  "  ;4
0006F6 D429 E1D0                    DW  C_CD
0006F8 D42B 44454C20                DB  "DEL "  ;5
0006FC D42F A7D1                    DW  C_DEL
0006FE D431 50415448                DB  "PATH"  ;6
000702 D435 5BD2                    DW  C_PATH
000704 D437 52454E20                DB  "REN "  ;7
000708 D43B B1D1                    DW  C_REN
00070A D43D 52454D20                DB  "REM "  ;8
00070E D441 77D4                    DW  C_REM
[EOF:LDCCP.ASM:SHIFT_JIS]
                                    INCLUDE "M7CCP2.ASM"
                                
                                ;   LSX-Dodgers CCP2
                                ;   MZ-700/1500
                                
000710 D443 4D4F4E20                DB  "MON "  ;10
000714 D447 D8CF                    DW  C_MON
[EOF:M7CCP2.ASM:UTF_8]
                                    INCLUDE "LDOS.ASM"
                                
                                ;   LSX-Dodgers OS
                                
       D449                     BDOS0:
000716 D449 E5              11      PUSH    HL
000717 D44A 79               4      LD  A,C
000718 D44B FE3C             7      CP  03CH
00071A D44D 3802            12      JR  C,DOS1
00071C D44F 3E3C             7      LD  A,03CH
       D451                     DOS1:
00071E D451 87               4      ADD A,A
00071F D452 3256D4          13      LD  (DOS1_SWC),A
000722 D455 2A00F1          16      LD  HL,(STABLE)
       D456                     DOS1_SWC    EQU $-2
000725 D458 E3              19      EX  (SP),HL
000726 D459 79               4      LD  A,C
                                ;確認用
                                ;   LD  (0050H),A
000727 D45A C9              10      RET
       D45B                     _DOS2:
000728 D45B FE5A             7      CP  05AH        ;(BDOS)カレントディレクトリの変更(_CHDIR)
00072A D45D CAF6D6          10      JP  Z,_SYS5A
00072D D460 FE5C             7      CP  05CH        ;(BDOS)ファイル名の解析(_PFILE)
00072F D462 CAB3D6          10      JP  Z,_SYS5C
000732 D465 FE5F             7      CP  05FH        ;(BDOS)ディスクバッファのフラッシュ(_FLUSH)
000734 D467 CA89E8          10      JP  Z,_SYS5F
000737 D46A FE6F             7      CP  06FH        ;(BDOS)MSX-DOS のバージョン番号の獲得(_DOSVER)
000739 D46C 200A            12      JR  NZ,_ERROR
00073B D46E 011D01          10      LD  BC,VER_6F
00073E D471 116101          10      LD  DE,VER
000741 D474 210100          10      LD  HL,MACD
       D477                     C_REM:
000744 D477 AF               4      XOR A
       D478                     _ERROR:
000745 D478 A7               4      AND A
000746 D479 C9              10      RET
                                
       D47A                     _SYS09:     ;文字列出力
000747 D47A D5              11      PUSH    DE
       D47B                     _SX09:
000748 D47B 1A               7      LD  A,(DE)
000749 D47C 13               6      INC DE
00074A D47D FE24             7      CP  '$'
00074C D47F 2831            12      JR  Z,SX0E2
00074E D481 CD14D7          17      CALL    MSG_A
000751 D484 18F5            12      JR  _SX09
                                
       D486                     MSX1:
000753 D486 CD14D7          17      CALL    MSG_A
       D489                     MSX:
000756 D489 7E               7      LD  A,(HL)
000757 D48A 23               6      INC HL
000758 D48B B7               4      OR  A
000759 D48C 20F8            12      JR  NZ,MSX1
00075B D48E C9              10      RET
                                
       D48F                     _SYS0C:     ;(BDOS)バージョン番号の獲得
00075C D48F 212200          10      LD  HL,00022H
00075F D492 7D               4      LD  A,L
000760 D493 C9              10      RET
                                
       D494                     _SYS0D:     ;(BDOS)ディスクリセット
000761 D494 CDDFF0          17      CALL    _FFLUSH
000764 D497 E5              11      PUSH    HL
000765 D498 218000          10      LD  HL,00080H
000768 D49B 228AF0          16      LD  (_DTA),HL
00076B D49E E1              10      POP HL
00076C D49F D5              11      PUSH    DE
00076D D4A0 1E00             7      LD  E,0
00076F D4A2 3E                      DB  03EH    ;次の PUSH DE をスキップ
                                
       D4A3                     _SYS0E:     ;(BDOS)カレントドライブの設定
000770 D4A3 D5              11      PUSH    DE
000771 D4A4 7B               4      LD  A,E
000772 D4A5 DDE5            15      PUSH    IX
000774 D4A7 CDDCF0          17      CALL    _GETDPB
000777 D4AA DDE1            14      POP IX
000779 D4AC 3804            12      JR  C,SX0E2
00077B D4AE 7B               4      LD  A,E
00077C D4AF 320400          13      LD  (_DVSW),A
       D4B2                     SX0E2:
00077F D4B2 D1              10      POP DE
000780 D4B3 C9              10      RET
                                
       D4B4                     _SYS0F:     ;(BDOS)ファイルのオープン
000781 D4B4 CD29DC          17      CALL    SETDRV
000784 D4B7 FD7E1C          19      LD  A,(IY+28)   ;(FCB)オープンモード
000787 D4BA C602             7      ADD A,002H      ;Write
000789 D4BC 2848            12      JR  Z,FEND0F
00078B D4BE CD77DF          17      CALL    CHKWILDX
                                
00078E D4C1 D453DC          17      CALL    NC,SOPENX
       D4C4                     _S16XX:
000791 D4C4 3840            12      JR  C,FEND0F
                                                ;Directory location
000793 D4C6 3A9FF0          13      LD  A,(_FILEN)
000796 D4C9 FD7719          19      LD  (IY+25),A   ;(FCB)ディレクトリロケーション
                                ;               _DIRF
000799 D4CC 3AA0F0          13      LD  A,(_DIRF)
00079C D4CF FD771D          19      LD  (IY+29),A   ;(FCB)ディレクトリモード
                                ;               _FBPS
00079F D4D2 FD731E          19      LD  (IY+30),E   ;(FCB)ディレクトリポジション
0007A2 D4D5 FD721F          19      LD  (IY+31),D
                                ;               Open(Read)
0007A5 D4D8 FD361CFF        19      LD  (IY+28),0FFH    ;(FCB)オープンモード
                                ;               FILENAME
0007A9 D4DC FDE5            15      PUSH    IY
0007AB D4DE D1              10      POP DE
0007AC D4DF 13               6      INC DE
0007AD D4E0 010B00          10      LD  BC,11
0007B0 D4E3 EDB0                    LDIR
                                ;               Attribute
0007B2 D4E5 7E               7      LD  A,(HL)
0007B3 D4E6 FD770D          19      LD  (IY+13),A   ;(FCB)属性(アトリビュート)
0007B6 D4E9 110B00          10      LD  DE,11       ;Reserved
0007B9 D4EC 19              11      ADD HL,DE
                                                    ;(FCB)ファイルを最後に変更した時刻
0007BA D4ED 11E4F1          10      LD  DE,SDDATA       ;(FCB)ファイルを最後に変更した日付
0007BD D4F0 060A             7      LD  B,SDDATAE-SDDATA    ;(FCB)ファイルの先頭クラスタ
       D4F2                     S16LOOP:                ;(FCB)ファイルのサイズ(バイト単位)
0007BF D4F2 1A               7      LD  A,(DE)
0007C0 D4F3 13               6      INC DE
0007C1 D4F4 32FBD4          13      LD  (S16PAT),A
0007C4 D4F7 7E               7      LD  A,(HL)
0007C5 D4F8 23               6      INC HL
0007C6 D4F9 FD7700          19      LD  (IY+0),A
       D4FB                     S16PAT  EQU $-1
0007C9 D4FC 10F4            13      DJNZ    S16LOOP
                                
0007CB D4FE AF               4      XOR A
0007CC D4FF FD770C          19      LD  (IY+12),A   ;(FCB)カレントブロック
0007CF D502 FD22A3D5        20      LD  (OFCB_SWC),IY
       D506                     FEND0F:
0007D3 D506 1845            12      JR  FEND10
                                
       D508                     _SYS10:     ;(BDOS)ファイルのクローズ
0007D5 D508 CD29DC          17      CALL    SETDRV
0007D8 D50B FD7E1C          19      LD  A,(IY+28)   ;(FCB)オープンモード
0007DB D50E D6FE             7      SUB 0FEH
0007DD D510 37               4      SCF
0007DE D511 3F               4      CCF
0007DF D512 2039            12      JR  NZ,FEND10
       D514                     _S10A:              ;Write
0007E1 D514 FD770E          19      LD  (IY+14),A   ;(FCB)レコードサイズ/アクセスするディレクトリのクラスタ番号+1
0007E4 D517 FD770F          19      LD  (IY+15),A
                                
0007E7 D51A FD341C          23      INC (IY+28)     ;(FCB)オープンモード 0FEH->0FFH
0007EA D51D CD73E0          17      CALL    SETTMS
                                
0007ED D520 FD7E1D          19      LD  A,(IY+29)   ;(FCB)ディレクトリモード
0007F0 D523 32A0F0          13      LD  (_DIRF),A
0007F3 D526 E67F             7      AND 07FH
0007F5 D528 32A5E5          13      LD  (_SECPS),A
0007F8 D52B FD5E1E          19      LD  E,(IY+30)   ;(FCB)ディレクトリポジション
0007FB D52E FD561F          19      LD  D,(IY+31)
0007FE D531 CD88DD          17      CALL    READ_DIR
000801 D534 3817            12      JR  C,FEND10
                                
000803 D536 3AB3DC          13  SDECM1: LD  A,(SDECPAT) ;1セクタ辺りのディレクトリエントリ数
000806 D539 3D               4      DEC A       ;1024=01FH / 512=00FH / 256=7
000807 D53A FDA619          19      AND (IY+25)     ;(FCB)ディレクトリロケーション
00080A D53D 6F               4      LD  L,A
00080B D53E 2600             7      LD  H,0
00080D D540 29              11      ADD HL,HL       ;*2
00080E D541 29              11      ADD HL,HL       ;*4
00080F D542 29              11      ADD HL,HL       ;*8
000810 D543 29              11      ADD HL,HL       ;*16
000811 D544 29              11      ADD HL,HL       ;*32
000812 D545 ED4B7EF1        20      LD  BC,(_DTBUF)
000816 D549 09              11      ADD HL,BC
                                
000817 D54A CD87DF          17      CALL    SDIRENT
       D54D                     FEND10:
00081A D54D 1842            12      JR  FEND
                                
       D54F                     _SYS11:     ;(BDOS)最初のファイルの検索
00081C D54F CD29DC          17      CALL    SETDRV
00081F D552 CD82DC          17      CALL    SOPEN
       D555                     _S12X1:
000822 D555 383A            12      JR  C,FEND
000824 D557 CD21DD          17      CALL    SOPENE2
000827 D55A ED5B8AF0        20      LD  DE,(_DTA)
00082B D55E 3A88F0          13      LD  A,(_DRV)
00082E D561 3C               4      INC A
00082F D562 12               7      LD  (DE),A
000830 D563 D5              11      PUSH    DE
000831 D564 13               6      INC DE
000832 D565 012000          10      LD  BC,32
000835 D568 EDB0                    LDIR
000837 D56A FD6E0E          19      LD  L,(IY+14)   ;(FCB)レコードサイズ/アクセスするディレクトリのクラスタ番号+1
00083A D56D FD660F          19      LD  H,(IY+15)
00083D D570 22F4F1          16      LD  (SCDIR),HL
000840 D573 2A9AF0          16      LD  HL,(_FBPS)
000843 D576 22F6F1          16      LD  (SFBPS),HL
000846 D579 2A9FF0          16      LD  HL,(_FILEN)
000849 D57C 7C               4      LD  A,H
00084A D57D B7               4      OR  A
00084B D57E 2806            12      JR  Z,_S12DIR
00084D D580 3AA5E5          13      LD  A,(_SECPS)
000850 D583 F680             7      OR  080H
000852 D585 67               4      LD  H,A
       D586                     _S12DIR:
000853 D586 22F8F1          16      LD  (SFNDF),HL  ;Directory position and Flags
000856 D589 E1              10      POP HL
000857 D58A 1139F0          10      LD  DE,SFILE
00085A D58D 0E21             7      LD  C,33
       D58F                     _S11B:
00085C D58F EDB0                    LDIR
       D591                     FEND:
00085E D591 9F               4      SBC A,A     ;CF=0 A=0 : CF=1 A=0FFH
       D592                     FENDE:
00085F D592 FDE1            14      POP IY
000861 D594 C1              10      POP BC
000862 D595 D1              10      POP DE
000863 D596 E1              10      POP HL
000864 D597 C9              10      RET
                                
       D598                     _SYS12:     ;(BDOS)次のファイルの検索
000865 D598 E5              11      PUSH    HL
000866 D599 D5              11      PUSH    DE
000867 D59A C5              11      PUSH    BC
000868 D59B FDE5            15      PUSH    IY
00086A D59D CDE6DC          17      CALL    NOPEN
00086D D5A0 18B3            12      JR  _S12X1
                                
       D5A2                     _S16K:
00086F D5A2 110000          10      LD  DE,0
       D5A3                     OFCB_SWC    EQU $-2
000872 D5A5 D5              11      PUSH    DE
000873 D5A6 061A             7      LD  B,26        ;First cluster
       D5A8                     S16K1:
000875 D5A8 13               6      INC DE
000876 D5A9 23               6      INC HL
000877 D5AA 10FC            13      DJNZ    S16K1
                                
000879 D5AC 1A               7      LD  A,(DE)
00087A D5AD BE               7      CP  (HL)
00087B D5AE 2015            12      JR  NZ,S16K2
00087D D5B0 13               6      INC DE
00087E D5B1 23               6      INC HL
00087F D5B2 1A               7      LD  A,(DE)
000880 D5B3 BE               7      CP  (HL)
000881 D5B4 200F            12      JR  NZ,S16K2
                                
000883 D5B6 E1              10      POP HL
000884 D5B7 FDE5            15      PUSH    IY
000886 D5B9 D1              10      POP DE
000887 D5BA 7E               7      LD  A,(HL)
000888 D5BB CD3EDC          17      CALL    IS_SAME_DRV_A_DE
00088B D5BE 2006            12      JR  NZ,S16K3
                                                ;ここはCFが必ず0
00088D D5C0 ED52            15      SBC HL,DE       ;CP HL,DE
00088F D5C2 37               4      SCF
000890 D5C3 C0              11      RET NZ
000891 D5C4 E5              11      PUSH    HL
       D5C5                     S16K2:
000892 D5C5 E1              10      POP HL
       D5C6                     S16K3:
000893 D5C6 FDE5            15      PUSH    IY
000895 D5C8 D1              10      POP DE
       D5C9                     _SYS13:     ;(BDOS)ファイルの削除
000896 D5C9 CD29DC          17      CALL    SETDRV
000899 D5CC CDADDE          17      CALL    KILL
       D5CF                     FEND13:
00089C D5CF 18C0            12      JR  FEND
                                
       D5D1                     _SYS14:     ;(BDOS)シーケンシャルな読み出し
00089E D5D1 CD29DC          17      CALL    SETDRV
0008A1 D5D4 CDD5E0          17      CALL    INIT_SEQ
       D5D7                     SREAD:
0008A4 D5D7 CD03E1          17      CALL    RB_READ
                                
0008A7 D5DA C601             7      ADD A,001H
0008A9 D5DC 38B3            12      JR  C,FEND
                                
0008AB D5DE 7D               4      LD  A,L
0008AC D5DF D601             7      SUB 001H
       D5E1                     FENDX:
0008AE D5E1 9F               4      SBC A,A
0008AF D5E2 E603             7      AND 3
0008B1 D5E4 1F               4      RRA
0008B2 D5E5 18AB            12      JR  FENDE
                                
       D5E7                     _SYS15:     ;(BDOS)シーケンシャルな書き込み
0008B4 D5E7 CD29DC          17      CALL    SETDRV
0008B7 D5EA CDD5E0          17      CALL    INIT_SEQ
       D5ED                     SWRITE:
0008BA D5ED CDFCE0          17      CALL    RB_WRITE
                                
0008BD D5F0 C6FF             7      ADD A,0FFH
0008BF D5F2 18ED            12      JR  FENDX
                                
       D5F4                     _SYS17:     ;(BDOS)ファイル名の変更
0008C1 D5F4 CD29DC          17      CALL    SETDRV
0008C4 D5F7 CD03DF          17      CALL    NAME
0008C7 D5FA 18D3            12      JR  FEND13
                                
       D5FC                     _SYS16:     ;(BDOS)ファイルの作成
0008C9 D5FC CD29DC          17      CALL    SETDRV
                                
0008CC D5FF CD77DF          17      CALL    CHKWILDX
0008CF D602 38CB            12      JR  C,FEND13
0008D1 D604 FD7E01          19      LD  A,(IY+1)    ;(FCB)主ファイル名
0008D4 D607 FE05             7      CP  5
0008D6 D609 2805            12      JR  Z,_S16X2
0008D8 D60B FE21             7      CP  021H
0008DA D60D DACFD5          10      JP  C,FEND13
       D610                     _S16X2:
                                ;               Clear FCB
0008DD D610 FDE5            15      PUSH    IY
0008DF D612 E1              10      POP HL
0008E0 D613 011000          10      LD  BC,16
0008E3 D616 09              11      ADD HL,BC
       D617                     _S16X1:
0008E4 D617 70               7      LD  (HL),B      ;B=0
0008E5 D618 23               6      INC HL
0008E6 D619 0D               4      DEC C
0008E7 D61A 20FB            12      JR  NZ,_S16X1
                                
0008E9 D61C CD78E0          17      CALL    SETTMSX
0008EC D61F FD360DFF        19      LD  (IY+13),0FFH    ;(FCB)Attribute
0008F0 D623 CD53DC          17      CALL    SOPENX
0008F3 D626 3F               4      CCF
0008F4 D627 CCA2D5          17      CALL    Z,_S16K
0008F7 D62A D432DD          17      CALL    NC,COPEN
0008FA D62D D487DF          17      CALL    NC,SDIRENT
0008FD D630 C3C4D4          10      JP  _S16XX
                                
       D633                     _SYS21:     ;(BDOS)ランダムな読み出し
000900 D633 CD29DC          17      CALL    SETDRV
000903 D636 CDC3E0          17      CALL    INIT_RND
000906 D639 189C            12      JR  SREAD
                                
       D63B                     _SYS22:     ;(BDOS)ランダムな書き込み
       D63B                     _SYS28:     ;(BDOS)ランダムな書き込み・その2
000908 D63B CD29DC          17      CALL    SETDRV
00090B D63E CDC3E0          17      CALL    INIT_RND
00090E D641 18AA            12      JR  SWRITE
                                
       D643                     _SYS18:     ;(BDOS)ログインベクトルの獲得
000910 D643 21FF00          10      LD  HL,000FFH
000913 D646 AF               4      XOR A
000914 D647 C9              10      RET
                                
       D648                     _SYS19:     ;(BDOS)カレントドライブ番号の獲得
000915 D648 3A0400          13      LD  A,(_DVSW)
000918 D64B A7               4      AND A
000919 D64C C9              10      RET
                                
       D64D                     _SYS1A:     ;(BDOS)DTAの設定
00091A D64D ED538AF0        20      LD  (_DTA),DE
00091E D651 AF               4      XOR A
00091F D652 C9              10      RET
                                
       D653                     _SYS1B:     ;(BDOS)ディスク情報の獲得
000920 D653 7B               4      LD  A,E
000921 D654 CD37DC          17      CALL    GETDRV
000924 D657 CDDCF0          17      CALL    _GETDPB
000927 D65A D4E2F0          17      CALL    NC,_RDFATX
00092A D65D 210000          10      LD  HL,0
00092D D660 D451E0          17      CALL    NC,DSKF
                                
000930 D663 ED5B52E0        20      LD  DE,(MAXCLP) ;DPB_MAXCL-1
000934 D667 1B               6      DEC DE      ;DE←クラスタの総数
000935 D668 FD2A7CF1        20      LD  IY,(_FATBF) ;IY←メモリ上のFATの先頭アドレス
000939 D66C 9F               4      SBC A,A
00093A D66D D8              11      RET C
00093B D66E 4F               4      LD  C,A     ;C=0
00093C D66F DD7E0F          19      LD  A,(IX+DPB_BPS)
00093F D672 E607             7      AND 7
000941 D674 47               4      LD  B,A
000942 D675 DD7E07          19      LD  A,(IX+DPB_SECPCL)
000945 D678 C9              10      RET
                                
       D679                     _SYS1D:     ;(BDOS)書き込みが禁止されているディスクの調査
000946 D679 AF               4      XOR A
000947 D67A 67               4      LD  H,A
000948 D67B 6F               4      LD  L,A
000949 D67C C9              10      RET
                                
       D67D                     _SYS1F:     ;(BDOS)ディスク装置のパラメータの読み出し
00094A D67D 2100F2          10      LD  HL,_DEVICE
00094D D680 7B               4      LD  A,E
00094E D681 C3DCF0          10      JP  _GETDPB
                                
       D684                     _SYS23:     ;(BDOS)ファイルサイズの獲得
000951 D684 E5              11      PUSH    HL
000952 D685 2A1EF1          16      LD  HL,(STABLE+2*00FH)  ;ファイルのオープン
000955 D688 CD0F00          17      CALL    JP_HL
000958 D68B 381B            12      JR  C,_S23X1
                                
00095A D68D D5              11      PUSH    DE      ;EX DE,IY
00095B D68E FDE3            23      EX  (SP),IY     ;
                                ;   POP DE      ;
                                ;   PUSH    DE      ;DEを破壊しないように注意vv
00095D D690 FD7E10          19      LD  A,(IY+16)   ;(FCB)ファイルのサイズ(バイト単位)
000960 D693 FD6E11          19      LD  L,(IY+17)   ;
000963 D696 FD6612          19      LD  H,(IY+18)   ;
000966 D699 C5              11      PUSH    BC      ;
000967 D69A FD4613          19      LD  B,(IY+19)   ;
00096A D69D CDB5E0          17      CALL    GET_CPM_R_SIZE
00096D D6A0 C1              10      POP BC
       D6A1                     _S24X1:
00096E D6A1 CDEDE3          17      CALL    SET_RR_AHL
                                ;   POP DE      ;^^^^^^^^^^^^^^^^^^^^^^^^
                                ;   PUSH    DE      ;EX DE,IY
000971 D6A4 FDE3            23      EX  (SP),IY     ;
000973 D6A6 D1              10      POP DE      ;
                                
000974 D6A7 AF               4      XOR A
       D6A8                     _S23X1:
000975 D6A8 E1              10      POP HL
000976 D6A9 C9              10      RET
                                
       D6AA                     _SYS24:     ;(BDOS)ランダムレコードフィールドの設定
000977 D6AA E5              11      PUSH    HL
000978 D6AB D5              11      PUSH    DE      ;EX DE,IY
000979 D6AC FDE3            23      EX  (SP),IY     ;
                                ;   POP DE      ;
                                ;   PUSH    DE      ;DEを破壊しないように注意vv
00097B D6AE CDDDE0          17      CALL    GETSEQ
00097E D6B1 18EE            12      JR  _S24X1      ;^^^^^^^^^^^^^^^^^^^^^^^^
                                
       D6B3                     _SYS5C:     ;(BDOS)ファイル名の解析(_PFILE)
000980 D6B3 2B               6      DEC HL
       D6B4                     _SYS29:     ;(BDOS)ファイル名の解析(_PPATH)
000981 D6B4 C5              11      PUSH    BC
000982 D6B5 E5              11      PUSH    HL
000983 D6B6 CD40DB          17      CALL    FILE
000986 D6B9 E1              10      POP HL
000987 D6BA C1              10      POP BC
       D6BB                     S29X1:
000988 D6BB C5              11      PUSH    BC
000989 D6BC D5              11      PUSH    DE
00098A D6BD E5              11      PUSH    HL
00098B D6BE EB               4      EX  DE,HL
00098C D6BF AF               4      XOR A
00098D D6C0 3221F0          13      LD  (FDRV+13),A
000990 D6C3 2114F0          10      LD  HL,FDRV
000993 D6C6 011000          10      LD  BC,16
000996 D6C9 EDB0                    LDIR
000998 D6CB E1              10      POP HL
000999 D6CC D1              10      POP DE
00099A D6CD C1              10      POP BC
00099B D6CE C9              10      RET
                                
       D6CF                     _SYS30:     ;(BDOS)論理セクタを用いた書き込み
00099C D6CF C5              11      PUSH    BC
00099D D6D0 0148E7          10      LD  BC,DWT24B
0009A0 D6D3 1804            12      JR  S2FX
       D6D5                     _SYS2F:
0009A2 D6D5 C5              11      PUSH    BC
0009A3 D6D6 0138E7          10      LD  BC,DRD24B
       D6D9                     S2FX:
0009A6 D6D9 ED43EFD6        20      LD  (S2F_SWC),BC
0009AA D6DD CDDFF0          17      CALL    _FFLUSH
                                
0009AD D6E0 D5              11      PUSH    DE
0009AE D6E1 E5              11      PUSH    HL
0009AF D6E2 7D               4      LD  A,L     ;Drive
0009B0 D6E3 CDD9F0          17      CALL    _CHGDRV
0009B3 D6E6 3809            12      JR  C,S30X2
0009B5 D6E8 44               4      LD  B,H     ;Number of clusters
0009B6 D6E9 2A8AF0          16      LD  HL,(_DTA)
                                
0009B9 D6EC 0E00             7      LD  C,0
0009BB D6EE CD38E7          17      CALL    DRD24B
       D6EF                     S2F_SWC EQU $-2
       D6F1                     S30X2:
0009BE D6F1 E1              10      POP HL
0009BF D6F2 D1              10      POP DE
0009C0 D6F3 C1              10      POP BC
0009C1 D6F4 9F               4      SBC A,A
0009C2 D6F5 C9              10      RET
                                
       D6F6                     _SYS5A:     ;(BDOS)カレントディレクトリの変更
0009C3 D6F6 C5              11      PUSH    BC
0009C4 D6F7 D5              11      PUSH    DE
0009C5 D6F8 E5              11      PUSH    HL
0009C6 D6F9 CD35DB          17      CALL    FILEC
0009C9 D6FC 21F1D6          10      LD  HL,S30X2
0009CC D6FF E5              11      PUSH    HL
0009CD D700 3A21F0          13      LD  A,(FDRV+13) ;(FCB)属性(アトリビュート))
0009D0 D703 E610             7      AND 010H        ;ディレクトリ
0009D2 D705 C8              11      RET Z
0009D3 D706 1114F0          10      LD  DE,FDRV
0009D6 D709 2A4EF1          16      LD  HL,(STABLE+2*027H)  ;ランダムブロック読み込み
0009D9 D70C E9               4      JP  (HL)
[EOF:LDOS.ASM:SHIFT_JIS]
                                    INCLUDE "M7IO.ASM"
                                
                                ;   LSX-Dodgers IO
                                ;   MZ-700/1500
                                
       D478                     _SYS04  EQU _ERROR      ;(BDOS)外部出力
       D478                     _SYS05  EQU _ERROR      ;(BDOS)プリンタ出力
       D478                     _SYS1C  EQU _ERROR      ;(BDOS)ディスクの書き込み禁止化
       D478                     _SYS1E  EQU _ERROR      ;(BDOS)ファイル属性の設定
       D478                     _SYS20  EQU _ERROR      ;(BDOS)利用者番号の設定と読み出し
       D478                     _SYS2E  EQU _ERROR      ;(BDOS)ベリファイ・フラグの設定
                                
       0000                     INT EQU 0
       0000                     INTCTCE EQU 0
       0000                     INTCTC2 EQU 0
                                
       D70D                     POP_AF_HL_SCF_RET:
0009DA D70D F1              10      POP AF
0009DB D70E E1              10      POP HL
0009DC D70F 37               4      SCF
       D710                     KEYBC_IFBREAK:
0009DD D710 C9              10      RET
                                
       D711                     _SYS01:     ;(BDOS)コンソール入力
0009DE D711 CD09F0          17      CALL    _SYS07
       D714                     MSG_A:
0009E1 D714 F5              11      PUSH    AF
0009E2 D715 D5              11      PUSH    DE
0009E3 D716 5F               4      LD  E,A
0009E4 D717 CD1DD7          17      CALL    _SYS02
0009E7 D71A D1              10      POP DE
0009E8 D71B F1              10      POP AF
0009E9 D71C C9              10      RET
                                
       D71D                     _SYS02:     ;(BDOS)コンソール出力
0009EA D71D CD2FD7          17      CALL    BREAK
0009ED D720 1805            12      JR  PRINTX
                                
       D722                     _SYS06:     ;(BDOS)コンソール直接入出力
0009EF D722 7B               4      LD  A,E
0009F0 D723 3C               4      INC A
0009F1 D724 CACAF0          10      JP  Z,_INKEY
       D727                     PRINTX:
0009F4 D727 C3CDF0          10      JP  _PRINT
                                
       D72A                     _SYS08:     ;(BDOS)エコーなしコンソール入力
0009F7 D72A CD09F0          17      CALL    _SYS07
0009FA D72D 1803            12      JR  BREAK1
       D72F                     BREAK:
0009FC D72F CDC7DA          17      CALL    CHKEY
       D732                     BREAK1:
0009FF D732 FE03             7      CP  3       ;CTRL+C
000A01 D734 CA00F0          10      JP  Z,CPM_BOOT
000A04 D737 FE13             7      CP  013H        ;CTRL+S
000A06 D739 C0              11      RET NZ
                                
       D73A                     PAUSE:
       D73A                     FLGET:
000A07 D73A CDDFF0          17      CALL    _FFLUSH
000A0A D73D E5              11      PUSH    HL
000A0B D73E 2A8EF0          16      LD  HL,(_TXADR)
000A0E D741 7C               4      LD  A,H
000A0F D742 C6D0             7      ADD A,0D0H
000A11 D744 67               4      LD  H,A
000A12 D745 CD25CF          17      CALL    RDMMIO
000A15 D748 325DD7          13      LD  (FLSMC),A
       D74B                     FLGET1:
000A18 D74B CD1BCF          17      CALL    RD556VSYNC
000A1B D74E CB77             8      BIT 6,A
000A1D D750 3EEF             7      LD  A,0EFH      ;カーソル
000A1F D752 200A            12      JR  NZ,FLGET2
000A21 D754 3A92F0          13      LD  A,(_KEYD)
000A24 D757 B7               4      OR  A
000A25 D758 3EEF             7      LD  A,0EFH      ;カーソル
000A27 D75A 2002            12      JR  NZ,FLGET2
000A29 D75C 3E00             7      LD  A,0     ;自己書き換え
       D75D                     FLSMC   EQU $-1
       D75E                     FLGET2:
000A2B D75E CD2DCF          17      CALL    WRMMIO
000A2E D761 CDCAF0          17      CALL    _INKEY
000A31 D764 28E5            12      JR  Z,FLGET1
000A33 D766 F5              11      PUSH    AF
000A34 D767 3A5DD7          13      LD  A,(FLSMC)
000A37 D76A CD2DCF          17      CALL    WRMMIO
000A3A D76D F1              10      POP AF
000A3B D76E E1              10      POP HL
000A3C D76F C9              10      RET
                                
       D770                     _SYS0A:     ;(BDOS)文字列入力
000A3D D770 C5              11      PUSH    BC
000A3E D771 E5              11      PUSH    HL
000A3F D772 D5              11      PUSH    DE
000A40 D773 CD00DA          17      CALL    GETL
000A43 D776 1120FF          10      LD  DE,KBUF
000A46 D779 E1              10      POP HL
000A47 D77A E5              11      PUSH    HL
000A48 D77B 0E00             7      LD  C,0
000A4A D77D 3004            12      JR  NC,SAX0
000A4C D77F 23               6      INC HL
000A4D D780 23               6      INC HL
000A4E D781 1808            12      JR  SAX4
       D783                     SAX0:
000A50 D783 46               7      LD  B,(HL)
000A51 D784 23               6      INC HL
       D785                     SAX1:
000A52 D785 23               6      INC HL
000A53 D786 1A               7      LD  A,(DE)
000A54 D787 13               6      INC DE
000A55 D788 B7               4      OR  A
000A56 D789 2004            12      JR  NZ,SAX2
       D78B                     SAX4:
000A58 D78B 360D            10      LD  (HL),00DH
000A5A D78D 1804            12      JR  SAX3
       D78F                     SAX2:
000A5C D78F 77               7      LD  (HL),A
000A5D D790 0C               4      INC C
000A5E D791 10F2            13      DJNZ    SAX1
       D793                     SAX3:
000A60 D793 D1              10      POP DE
000A61 D794 79               4      LD  A,C
000A62 D795 13               6      INC DE
000A63 D796 12               7      LD  (DE),A
000A64 D797 1B               6      DEC DE
000A65 D798 E1              10      POP HL
000A66 D799 C1              10      POP BC
000A67 D79A A7               4      AND A
000A68 D79B C9              10      RET
                                
       D79C                     _SYS0B:     ;(BDOS)コンソール状態のチェック
000A69 D79C CD2FD7          17      CALL    BREAK
       D79F                     CONSTX:
000A6C D79F AF               4      XOR A
000A6D D7A0 3294DA          13      LD  (SKIP_KEYWAIT),A
000A70 D7A3 CDC7DA          17      CALL    CHKEY
000A73 D7A6 C8              11      RET Z
000A74 D7A7 CDDFF0          17      CALL    _FFLUSH
000A77 D7AA 37               4      SCF
000A78 D7AB 9F               4      SBC A,A
000A79 D7AC C9              10      RET
                                
       D7AD                     _SYS2A:     ;(BDOS)日付の獲得
000A7A D7AD AF               4      XOR A
000A7B D7AE 57               4      LD  D,A
000A7C D7AF 5F               4      LD  E,A
000A7D D7B0 67               4      LD  H,A
000A7E D7B1 6F               4      LD  L,A
000A7F D7B2 C9              10      RET
                                
       D7B3                     _SYS2C:     ;(BDOS)時刻の獲得
000A80 D7B3 AF               4      XOR A
000A81 D7B4 57               4      LD  D,A
000A82 D7B5 5F               4      LD  E,A
000A83 D7B6 67               4      LD  H,A
000A84 D7B7 6F               4      LD  L,A
000A85 D7B8 C9              10      RET
                                
       D7B9                     ESC1:
000A86 D7B9 7B               4      LD  A,E
000A87 D7BA FE41             7      CP  'A'
000A89 D7BC CAB1D8          10      JP  Z,CTRL1E
000A8C D7BF FE42             7      CP  'B'
000A8E D7C1 CAC3D9          10      JP  Z,CTRL1F
000A91 D7C4 FE43             7      CP  'C'
000A93 D7C6 CA84D8          10      JP  Z,CTRL1C
000A96 D7C9 FE44             7      CP  'D'
000A98 D7CB CAA8D8          10      JP  Z,CTRL1D
000A9B D7CE FE45             7      CP  'E'
000A9D D7D0 2802            12      JR  Z,CT0CX
000A9F D7D2 FE6A             7      CP  'j'
       D7D4                     CT0CX:
000AA1 D7D4 CAA8D9          10      JP  Z,CTRL0C
000AA4 D7D7 FE48             7      CP  'H'
000AA6 D7D9 CA25D9          10      JP  Z,CTRL0B
000AA9 D7DC FE4A             7      CP  'J'
000AAB D7DE CAABD9          10      JP  Z,CTRL06
000AAE D7E1 FE4B             7      CP  'K'
000AB0 D7E3 CAF7D8          10      JP  Z,CTRL05
000AB3 D7E6 FE4C             7      CP  'L'
000AB5 D7E8 CAD5D9          10      JP  Z,CTRL0E
000AB8 D7EB FE54             7      CP  'T'
000ABA D7ED CAF7D8          10      JP  Z,CTRL05
000ABD D7F0 FE78             7      CP  'x'
000ABF D7F2 2804            12      JR  Z,ESC1X
000AC1 D7F4 FE79             7      CP  'y'
000AC3 D7F6 2002            12      JR  NZ,ESC1Y
       D7F8                     ESC1X:
000AC5 D7F8 3601            10      LD  (HL),1
       D7FA                     ESC1Y:
000AC7 D7FA FE3D             7      CP  '='
000AC9 D7FC 2804            12      JR  Z,ESC1W
000ACB D7FE FE59             7      CP  'Y'
000ACD D800 2002            12      JR  NZ,ESC1Z
       D802                     ESC1W:
000ACF D802 3602            10      LD  (HL),2
       D804                     ESC1Z:
000AD1 D804 FE20             7      CP  020H
000AD3 D806 3802            12      JR  C,ESC1C
000AD5 D808 87               4      ADD A,A
000AD6 D809 D0              11      RET NC
       D80A                     ESC1C:
000AD7 D80A E1              10      POP HL
000AD8 D80B 1832            12      JR  ANK
                                
       D80D                     ESC:
000ADA D80D 2170D8          10      LD  HL,PRINTE5
000ADD D810 E5              11      PUSH    HL
000ADE D811 2133D8          10      LD  HL,ESCFLG
000AE1 D814 3600            10      LD  (HL),0
000AE3 D816 3D               4      DEC A
000AE4 D817 28A0            12      JR  Z,ESC1
000AE6 D819 3D               4      DEC A
000AE7 D81A 2009            12      JR  NZ,ESC2
000AE9 D81C 3603            10      LD  (HL),3
000AEB D81E 7B               4      LD  A,E
000AEC D81F D620             7      SUB 020H
000AEE D821 3228D8          13      LD  (ESCYP+1),A
000AF1 D824 C9              10      RET
       D825                     ESC2:
000AF2 D825 3D               4      DEC A
000AF3 D826 C0              11      RET NZ
000AF4 D827 2600             7  ESCYP:  LD  H,0
000AF6 D829 7B               4      LD  A,E
000AF7 D82A D620             7      SUB 020H
000AF9 D82C 6F               4      LD  L,A
000AFA D82D C3D6F0          10      JP  _LOC
                                
       D830                     PRINT:
000AFD D830 C5              11      PUSH    BC
000AFE D831 E5              11      PUSH    HL
000AFF D832 3E00             7      LD  A,000H      ;自己書き換え
       D833                     ESCFLG  EQU $-1
000B01 D834 B7               4      OR  A
000B02 D835 20D6            12      JR  NZ,ESC
                                
000B04 D837 3E1F             7      LD  A,01FH
000B06 D839 BB               4      CP  E
000B07 D83A 3038            12      JR  NC,CTRL
       D83C                     INSFLG  EQU $
000B09 D83C 017DD9          10      LD  BC,INSERT   ;自己書き換え
       D83F                     ANK:
000B0C D83F 3A96F0          13      LD  A,(_COLORF)
000B0F D842 4F               4      LD  C,A
000B10 D843 7B               4      LD  A,E
000B11 D844 FE61             7      CP  'a'     ;英小文字
000B13 D846 3806            12      JR  C,PRT1
000B15 D848 FE7B             7      CP  'z'+1
000B17 D84A 3002            12      JR  NC,PRT1
000B19 D84C CBF9             8      SET 7,C
       D84E                     PRT1:
000B1B D84E FE86             7      CP  $86     ;ひらがな1(を－そ)
000B1D D850 3806            12      JR  C,PRT2
000B1F D852 FEA0             7      CP  $A0
000B21 D854 3002            12      JR  NC,PRT2
000B23 D856 CBF9             8      SET 7,C
       D858                     PRT2:
000B25 D858 FEE0             7      CP  $E0     ;ひらがな2(たーん)
000B27 D85A 3802            12      JR  C,PRT3
000B29 D85C CBF9             8      SET 7,C
       D85E                     PRT3:
000B2B D85E 2A8EF0          16      LD  HL,(_TXADR)
000B2E D861 7C               4      LD  A,H
000B2F D862 C6D0             7      ADD A,0D0H
000B31 D864 67               4      LD  H,A
000B32 D865 42               4      LD  B,D
000B33 D866 16EE             7      LD  D,CD_TABLE/256
000B35 D868 1A               7      LD  A,(DE)
000B36 D869 50               4      LD  D,B
000B37 D86A CD45CF          17      CALL    IO_PRINT
000B3A D86D CD84D8          17      CALL    CTRL1C
       D870                     PRINTE5:
000B3D D870 E1              10      POP HL
000B3E D871 C1              10      POP BC
000B3F D872 AF               4      XOR A
000B40 D873 C9              10      RET
                                
       D874                     CTRL:
000B41 D874 7B               4      LD  A,E
000B42 D875 87               4      ADD A,A
000B43 D876 F680             7      OR  080H
000B45 D878 6F               4      LD  L,A
000B46 D879 26F1             7      LD  H,CTRLTB/256
000B48 D87B 7E               7      LD  A,(HL)
000B49 D87C 2C               4      INC L
000B4A D87D 66               7      LD  H,(HL)
000B4B D87E 6F               4      LD  L,A
000B4C D87F CD0F00          17      CALL    JP_HL
000B4F D882 18EC            12      JR  PRINTE5
                                
       D884                     CTRL1C:
000B51 D884 ED4B8EF0        20      LD  BC,(_TXADR)
000B55 D888 03               6      INC BC
       D889                     PRINTE3:
000B56 D889 2118FC          10      LD  HL,0-WIDTH*LINE
000B59 D88C A7               4      AND A
000B5A D88D ED4A            15      ADC HL,BC
       D88F                     PRINTE8:
000B5C D88F 2805            12      JR  Z,PRINT2
000B5E D891 ED438EF0        20      LD  (_TXADR),BC
       D895                     CTRL00:
000B62 D895 C9              10      RET
                                
       D896                     PRINT2:
000B63 D896 CDDBD9          17      CALL    SCR
000B66 D899 21D8FF          10      LD  HL,0-WIDTH
000B69 D89C 09              11      ADD HL,BC
       D89D                     SET_TXADR_HL:
000B6A D89D 228EF0          16      LD  (_TXADR),HL
000B6D D8A0 C9              10      RET
                                
       D8A1                     CTRL08:
000B6E D8A1 3A3CD8          13      LD  A,(INSFLG)
000B71 D8A4 FECD             7      CP  0CDH        ;CALL ????
000B73 D8A6 2823            12      JR  Z,CTRL02
       D8A8                     CTRL1D:
000B75 D8A8 2A8EF0          16      LD  HL,(_TXADR)
000B78 D8AB 7C               4      LD  A,H
000B79 D8AC B5               4      OR  L
000B7A D8AD C8              11      RET Z
000B7B D8AE 2B               6      DEC HL
000B7C D8AF 18EC            12      JR  SET_TXADR_HL
                                
       D8B1                     CTRL1E:
000B7E D8B1 ED4B8EF0        20      LD  BC,(_TXADR)
000B82 D8B5 21D8FF          10      LD  HL,0-WIDTH
000B85 D8B8 09              11      ADD HL,BC
000B86 D8B9 D0              11      RET NC
000B87 D8BA 18E1            12      JR  SET_TXADR_HL
                                
       D8BC                     CTRL09:
000B89 D8BC ED4B8EF0        20      LD  BC,(_TXADR)
000B8D D8C0 79               4      LD  A,C
000B8E D8C1 E6F8             7      AND 0F8H
000B90 D8C3 C608             7      ADD A,8
000B92 D8C5 4F               4      LD  C,A
000B93 D8C6 88               4      ADC A,B
000B94 D8C7 91               4      SUB C
000B95 D8C8 47               4      LD  B,A
000B96 D8C9 18BE            12      JR  PRINTE3
                                
       D8CB                     CTRL02:
000B98 D8CB CDA8D8          17      CALL    CTRL1D
000B9B D8CE C8              11      RET Z
000B9C D8CF D5              11      PUSH    DE
000B9D D8D0 CDD3F0          17      CALL    _POS
000BA0 D8D3 54               4      LD  D,H
000BA1 D8D4 3E28             7      LD  A,WIDTH
000BA3 D8D6 95               4      SUB L
000BA4 D8D7 4F               4      LD  C,A
000BA5 D8D8 0D               4      DEC C
000BA6 D8D9 06D0             7      LD  B,0D0H
000BA8 D8DB 2A8EF0          16      LD  HL,(_TXADR)
000BAB D8DE 09              11      ADD HL,BC
000BAC D8DF 47               4      LD  B,A
                                
000BAD D8E0 3A99D9          13      LD  A,(MULINE)
000BB0 D8E3 BA               4      CP  D
000BB1 D8E4 2007            12      JR  NZ,C02X1
000BB3 D8E6 112800          10      LD  DE,WIDTH
000BB6 D8E9 19              11      ADD HL,DE
000BB7 D8EA 78               4      LD  A,B
000BB8 D8EB 83               4      ADD A,E
000BB9 D8EC 47               4      LD  B,A
       D8ED                     C02X1:
000BBA D8ED 3A96F0          13      LD  A,(_COLORF) ;C:Color
000BBD D8F0 4F               4      LD  C,A
000BBE D8F1 AF               4      XOR A       ;A:Text
000BBF D8F2 CD8CCF          17      CALL    IO_BS
000BC2 D8F5 D1              10      POP DE
000BC3 D8F6 C9              10      RET
                                
       D8F7                     CTRL05:
000BC4 D8F7 CDD3F0          17      CALL    _POS
000BC7 D8FA 3E28             7      LD  A,WIDTH
000BC9 D8FC 95               4      SUB L
000BCA D8FD 47               4      LD  B,A
       D8FE                     C08X1:
000BCB D8FE 2A8EF0          16      LD  HL,(_TXADR)
000BCE D901 7C               4      LD  A,H
000BCF D902 C6D0             7      ADD A,0D0H
000BD1 D904 67               4      LD  H,A
       D905                     CLLINE:
000BD2 D905 3A96F0          13      LD  A,(_COLORF)
000BD5 D908 4F               4      LD  C,A
000BD6 D909 AF               4      XOR A
000BD7 D90A C36FCF          10      JP  IO_CLLINE
                                
       D90D                     CTRL0D:
000BDA D90D CDD3F0          17      CALL    _POS
000BDD D910 2E00             7      LD  L,0
       D912                     LOC:
000BDF D912 C5              11      PUSH    BC
000BE0 D913 E5              11      PUSH    HL
000BE1 D914 CD32D9          17      CALL    LOC1
000BE4 D917 228EF0          16      LD  (_TXADR),HL
000BE7 D91A E1              10      POP HL
000BE8 D91B C1              10      POP BC
000BE9 D91C C9              10      RET
                                
       D91D                     CTRL12:
000BEA D91D 213CD8          10      LD  HL,INSFLG
000BED D920 7E               7      LD  A,(HL)
000BEE D921 EECC             7      XOR 0CCH        ;CD:CALL ???? 1:LD BC,????
000BF0 D923 77               7      LD  (HL),A
000BF1 D924 C9              10      RET
                                
       D925                     CTRL0B:
000BF2 D925 210000          10      LD  HL,0
000BF5 D928 228EF0          16      LD  (_TXADR),HL
000BF8 D92B C9              10      RET
                                
       D92C                     CTRL1B:
000BF9 D92C 3E01             7      LD  A,1
000BFB D92E 3233D8          13      LD  (ESCFLG),A
000BFE D931 C9              10      RET
                                
       D932                     LOC1:
000BFF D932 D5              11      PUSH    DE
000C00 D933 4D               4      LD  C,L
000C01 D934 0608             7      LD  B,8
000C03 D936 5C               4      LD  E,H
000C04 D937 210028          10      LD  HL,WIDTH*256
000C07 D93A 55               4      LD  D,L ;L=0
       D93B                     LOC2:
000C08 D93B 29              11      ADD HL,HL
000C09 D93C 3001            12      JR  NC,LOC3
000C0B D93E 19              11      ADD HL,DE
       D93F                     LOC3:
000C0C D93F 10FA            13      DJNZ    LOC2
000C0E D941 09              11      ADD HL,BC
000C0F D942 D1              10      POP DE
000C10 D943 C9              10      RET
                                
       D944                     CONOUT1:
                                ;   CALL    CURSOR
000C11 D944 59               4      LD  E,C
000C12 D945 CDCDF0          17      CALL    _PRINT
000C15 D948 7B               4      LD  A,E
000C16 D949 FE0A             7      CP  00AH
000C18 D94B 2006            12      JR  NZ,CURSOR
000C1A D94D CD0DD9          17      CALL    CTRL0D
000C1D D950 CDF7D8          17      CALL    CTRL05
       D953                     CURSOR:
000C20 D953 C9              10      RET
                                
       D954                     CTRL07:
000C21 D954 06E0             7      LD  B,0E0H
000C23 D956 2162F0          10      LD  HL,BEEPD+1
       D959                     C07X0:
000C26 D959 4E               7      LD  C,(HL)
000C27 D95A 23               6      INC HL
000C28 D95B 7E               7      LD  A,(HL)
000C29 D95C 23               6      INC HL
000C2A D95D CD3DCF          17      CALL    WRMMIO_BC
000C2D D960 7D               4      LD  A,L
000C2E D961 FE6A             7      CP  (BEEPD+1+M7BEEPE-M7BEEPD)&255
000C30 D963 20F4            12      JR  NZ,C07X0
000C32 D965 0610             7      LD  B,16
       D967                     C07X1:
000C34 D967 CD1BCF          17      CALL    RD556VSYNC
000C37 D96A 87               4      ADD A,A
000C38 D96B 30FA            12      JR  NC,C07X1
       D96D                     C07X2:
000C3A D96D CD1BCF          17      CALL    RD556VSYNC
000C3D D970 87               4      ADD A,A
000C3E D971 38FA            12      JR  C,C07X2
000C40 D973 10F2            13      DJNZ    C07X1
                                
000C42 D975 AF               4      XOR A
000C43 D976 2108E0          10      LD  HL,0E008H
000C46 D979 CD2DCF          17      CALL    WRMMIO
000C49 D97C C9              10      RET
                                
       D97D                     INSERT:
000C4A D97D D5              11      PUSH    DE
000C4B D97E CDD3F0          17      CALL    _POS
000C4E D981 54               4      LD  D,H
000C4F D982 3E28             7      LD  A,WIDTH
000C51 D984 95               4      SUB L
000C52 D985 47               4      LD  B,A
000C53 D986 2A8EF0          16      LD  HL,(_TXADR)
000C56 D989 7C               4      LD  A,H
000C57 D98A C6D0             7      ADD A,0D0H
000C59 D98C 67               4      LD  H,A
000C5A D98D 3A96F0          13      LD  A,(_COLORF) ;C:Color
000C5D D990 4F               4      LD  C,A
000C5E D991 AF               4      XOR A       ;A:Text
000C5F D992 CD7FCF          17      CALL    IO_INS
000C62 D995 B7               4      OR  A
000C63 D996 2005            12      JR  NZ,INS1
       D999                     MULINE  EQU $+1
000C65 D998 3EFF             7      LD  A,-1
000C67 D99A 92               4      SUB D
000C68 D99B 2009            12      JR  NZ,INS2
       D99D                     INS1:
000C6A D99D 0628             7      LD  B,WIDTH
000C6C D99F CD7FCF          17      CALL    IO_INS
000C6F D9A2 7A               4      LD  A,D
000C70 D9A3 3299D9          13      LD  (MULINE),A
       D9A6                     INS2:
000C73 D9A6 D1              10      POP DE
000C74 D9A7 C9              10      RET
                                
       D9A8                     CTRL0C:
000C75 D9A8 CD25D9          17      CALL    CTRL0B
       D9AB                     CTRL06:
000C78 D9AB D5              11      PUSH    DE
000C79 D9AC E5              11      PUSH    HL
000C7A D9AD ED5B8EF0        20      LD  DE,(_TXADR)
000C7E D9B1 3A96F0          13      LD  A,(_COLORF)
000C81 D9B4 325CCF          13      LD  (ICSMC),A
000C84 D9B7 C350CF          10      JP  IO_CLR
                                
       D9BA                     CTRL04:
000C87 D9BA CDD3F0          17      CALL    _POS
000C8A D9BD 7D               4      LD  A,L
000C8B D9BE B7               4      OR  A
000C8C D9BF C8              11      RET Z
       D9C0                     CTRL03:
000C8D D9C0 CD0DD9          17      CALL    CTRL0D
       D9C3                     CTRL0A:
       D9C3                     CTRL1F:
000C90 D9C3 2A8EF0          16      LD  HL,(_TXADR)
000C93 D9C6 012800          10      LD  BC,WIDTH
000C96 D9C9 09              11      ADD HL,BC
000C97 D9CA 44               4      LD  B,H
000C98 D9CB 4D               4      LD  C,L
000C99 D9CC 2118FC          10      LD  HL,0-WIDTH*LINE
000C9C D9CF 09              11      ADD HL,BC
000C9D D9D0 3F               4      CCF
000C9E D9D1 9F               4      SBC A,A
000C9F D9D2 C38FD8          10      JP  PRINTE8
                                
       D9D5                     CTRL0E:
000CA2 D9D5 CDD3F0          17      CALL    _POS
000CA5 D9D8 7C               4      LD  A,H
000CA6 D9D9 1804            12      JR  SCR1
       D9DB                     SCR:
000CA8 D9DB 3A97F0          13      LD  A,(_LINE)
000CAB D9DE 3D               4      DEC A
       D9DF                     SCR1:
000CAC D9DF C5              11      PUSH    BC
000CAD D9E0 D5              11      PUSH    DE
000CAE D9E1 E5              11      PUSH    HL
000CAF D9E2 1100D0          10      LD  DE,0D000H
000CB2 D9E5 2128D0          10      LD  HL,0D000H+WIDTH
                                
000CB5 D9E8 47               4      LD  B,A
000CB6 D9E9 B7               4      OR  A
000CB7 D9EA C3A4CF          10      JP  IO_SCRUP
                                
       D9ED                     POS:
000CBA D9ED 2A8EF0          16      LD  HL,(_TXADR)
000CBD D9F0 C5              11      PUSH    BC
000CBE D9F1 01D8FF          10      LD  BC,0-WIDTH
000CC1 D9F4 AF               4      XOR A
       D9F5                     POS1:
000CC2 D9F5 09              11      ADD HL,BC
000CC3 D9F6 3C               4      INC A
000CC4 D9F7 38FC            12      JR  C,POS1
000CC6 D9F9 ED42            15      SBC HL,BC
000CC8 D9FB 3D               4      DEC A
000CC9 D9FC 67               4      LD  H,A
000CCA D9FD C1              10      POP BC
000CCB D9FE A7               4      AND A
000CCC D9FF C9              10      RET
                                
       DA00                     GETL:
000CCD DA00 CDD3F0          17      CALL    _POS
000CD0 DA03 E5              11      PUSH    HL
000CD1 DA04 3ECD             7      LD  A,0CDH      ;CALL ????
000CD3 DA06 323CD8          13      LD  (INSFLG),A
       DA09                     GETL1:
000CD6 DA09 CD2AD7          17      CALL    _SYS08
000CD9 DA0C FE09             7      CP  9
000CDB DA0E 2008            12      JR  NZ,GETL1V
000CDD DA10 2120FF          10      LD  HL,KBUF
000CE0 DA13 CD89D4          17      CALL    MSX
000CE3 DA16 18F1            12      JR  GETL1
       DA18                     GETL1V:
000CE5 DA18 5F               4      LD  E,A
000CE6 DA19 CDD3F0          17      CALL    _POS
000CE9 DA1C CDCDF0          17      CALL    _PRINT
000CEC DA1F 7B               4      LD  A,E
000CED DA20 FE20             7      CP  $20
000CEF DA22 3809            12      JR  C,GETL1V1
000CF1 DA24 7D               4      LD  A,L
000CF2 DA25 FE27             7      CP  WIDTH-1
000CF4 DA27 2004            12      JR  NZ,GETL1V1
000CF6 DA29 7C               4      LD  A,H
000CF7 DA2A 3299D9          13      LD  (MULINE),A
       DA2D                     GETL1V1:
000CFA DA2D 7B               4      LD  A,E
000CFB DA2E FE0D             7      CP  00DH
000CFD DA30 20D7            12      JR  NZ,GETL1
000CFF DA32 3E01             7      LD  A,1     ;LD BC,????
000D01 DA34 323CD8          13      LD  (INSFLG),A
000D04 DA37 1120FF          10      LD  DE,KBUF
000D07 DA3A 0628             7      LD  B,WIDTH
000D09 DA3C CD27D3          17      CALL    ZERO_MEMORY_DE
                                
000D0C DA3F D1              10      POP DE
000D0D DA40 CDD3F0          17      CALL    _POS
000D10 DA43 6B               4      LD  L,E
000D11 DA44 3E28             7      LD  A,WIDTH
000D13 DA46 95               4      SUB L
000D14 DA47 57               4      LD  D,A
                                
000D15 DA48 3A99D9          13      LD  A,(MULINE)
000D18 DA4B 94               4      SUB H
000D19 DA4C 2806            12      JR  Z,GL2X
000D1B DA4E 3C               4      INC A
000D1C DA4F 200C            12      JR  NZ,GL3X
000D1E DA51 25               4      DEC H
000D1F DA52 1805            12      JR  GL4X
       DA54                     GL2X:
000D21 DA54 3E1F             7      LD  A,$1F
000D23 DA56 CD14D7          17      CALL    MSG_A
       DA59                     GL4X:
000D26 DA59 7A               4      LD  A,D
000D27 DA5A C628             7      ADD A,WIDTH
000D29 DA5C 57               4      LD  D,A
       DA5D                     GL3X:
000D2A DA5D CD32D9          17      CALL    LOC1
000D2D DA60 4D               4      LD  C,L
000D2E DA61 7C               4      LD  A,H
000D2F DA62 C6D0             7      ADD A,0D0H
000D31 DA64 47               4      LD  B,A
000D32 DA65 5A               4      LD  E,D
000D33 DA66 2120FF          10      LD  HL,KBUF
       DA69                     GETL2:
000D36 DA69 CDD0F0          17      CALL    _SCRN
000D39 DA6C 03               6      INC BC
000D3A DA6D 77               7      LD  (HL),A
000D3B DA6E 23               6      INC HL
000D3C DA6F 1D               4      DEC E
000D3D DA70 20F7            12      JR  NZ,GETL2
       DA72                     GETL3:
000D3F DA72 2B               6      DEC HL
000D40 DA73 7E               7      LD  A,(HL)
000D41 DA74 FE21             7      CP  021H
000D43 DA76 D0              11      RET NC
000D44 DA77 3600            10      LD  (HL),0
000D46 DA79 15               4      DEC D
000D47 DA7A 20F6            12      JR  NZ,GETL3
000D49 DA7C C9              10      RET
                                
       DA7D                     INKEYB:
000D4A DA7D C1              10      POP BC
000D4B DA7E CB47             8      BIT 0,A
000D4D DA80 3E08             7      LD  A,8
000D4F DA82 2002            12      JR  NZ,INKEYD
000D51 DA84 3E03             7      LD  A,3
       DA86                     INKEYD:
000D53 DA86 3292F0          13      LD  (_KEYD),A
000D56 DA89 B7               4      OR  A
000D57 DA8A C9              10      RET
       DA8B                     INKEY:
000D58 DA8B E5              11      PUSH    HL
       DA8C                     GETKEY:
000D59 DA8C 3A92F0          13      LD  A,(_KEYD)
000D5C DA8F B7               4      OR  A
000D5D DA90 6F               4      LD  L,A
000D5E DA91 2610             7      LD  H,16
       DA92                     GKSMC   EQU $-1
       DA93                     GETKEY1:
000D60 DA93 3E01             7      LD  A,1
       DA94                     SKIP_KEYWAIT:   EQU $-1
000D62 DA95 B7               4      OR  A
000D63 DA96 C4C7DA          17      CALL    NZ,CHKEY    ;キーを離すまで待つ
000D66 DA99 281E            12      JR  Z,GETKEY2
000D68 DA9B BD               4      CP  L
000D69 DA9C 201B            12      JR  NZ,GETKEY2
000D6B DA9E CD1BCF          17      CALL    RD556VSYNC
000D6E DAA1 87               4      ADD A,A
000D6F DAA2 30EF            12      JR  NC,GETKEY1
       DAA4                     GETKEY1X:
000D71 DAA4 CDC7DA          17      CALL    CHKEY       ;キーを離すまで待つ
000D74 DAA7 2810            12      JR  Z,GETKEY2
000D76 DAA9 BD               4      CP  L
000D77 DAAA 200D            12      JR  NZ,GETKEY2
000D79 DAAC CD1BCF          17      CALL    RD556VSYNC
000D7C DAAF 87               4      ADD A,A
000D7D DAB0 38F2            12      JR  C,GETKEY1X
000D7F DAB2 25               4      DEC H
000D80 DAB3 20DE            12      JR  NZ,GETKEY1
000D82 DAB5 3E01             7      LD  A,1
000D84 DAB7 1805            12      JR  GETKEY3
       DAB9                     GETKEY2:
000D86 DAB9 3E10             7      LD  A,16
000D88 DABB 3294DA          13      LD  (SKIP_KEYWAIT),A
       DABE                     GETKEY3:
000D8B DABE 3292DA          13      LD  (GKSMC),A
000D8E DAC1 3A92F0          13      LD  A,(_KEYD)
000D91 DAC4 B7               4      OR  A
000D92 DAC5 E1              10      POP HL
000D93 DAC6 C0              11      RET NZ
       DAC7                     CHKEY:
000D94 DAC7 C5              11      PUSH    BC
000D95 DAC8 3E08             7      LD  A,8
000D97 DACA CD0ECF          17      CALL    RDKEYDATA
000D9A DACD 3293F0          13      LD  (_KEYD+1),A
000D9D DAD0 CB7F             8      BIT 7,A
000D9F DAD2 28A9            12      JR  Z,INKEYB
000DA1 DAD4 E5              11      PUSH    HL
000DA2 DAD5 0E07             7      LD  C,7
000DA4 DAD7 2140ED          10      LD  HL,KEY_TABLE
000DA7 DADA CB47             8      BIT 0,A
000DA9 DADC 2003            12      JR  NZ,CHKEY0
000DAB DADE 2180ED          10      LD  HL,SHIFT_TABLE
       DAE1                     CHKEY0:
000DAE DAE1 CB77             8      BIT 6,A
000DB0 DAE3 2003            12      JR  NZ,CHKEY1
000DB2 DAE5 21C0ED          10      LD  HL,CTRL_TABLE
       DAE8                     CHKEY1:
000DB5 DAE8 79               4      LD  A,C
000DB6 DAE9 CD0ECF          17      CALL    RDKEYDATA
000DB9 DAEC 0608             7      LD  B,8
       DAEE                     CHKEY2:
000DBB DAEE 87               4      ADD A,A
000DBC DAEF 3009            12      JR  NC,CHKEY3
000DBE DAF1 23               6      INC HL
000DBF DAF2 10FA            13      DJNZ    CHKEY2
000DC1 DAF4 0D               4      DEC C
000DC2 DAF5 79               4      LD  A,C
000DC3 DAF6 3C               4      INC A
000DC4 DAF7 20EF            12      JR  NZ,CHKEY1
000DC6 DAF9 06                      DB  $06     ;LD B,?? 次の1バイトを飛ばす
       DAFA                     CHKEY3:
000DC7 DAFA 7E               7      LD  A,(HL)
000DC8 DAFB E1              10      POP HL
000DC9 DAFC C1              10      POP BC
000DCA DAFD 1887            12      JR  INKEYD
                                
       DAFF                     SCRN:
000DCC DAFF E5              11      PUSH    HL
000DCD DB00 CD35CF          17      CALL    RDMMIO_BC
000DD0 DB03 6F               4      LD  L,A
000DD1 DB04 26EF             7      LD  H,DC_TABLE/256
000DD3 DB06 7E               7      LD  A,(HL)
000DD4 DB07 FE41             7      CP  'A'     ;英小文字チェック
000DD6 DB09 380E            12      JR  C,SCRN1
000DD8 DB0B FE5B             7      CP  'Z'+1
000DDA DB0D DC1BDB          17      CALL    C,SCRNC
000DDD DB10 FEA6             7      CP  $A6     ;ひらがなチェック
000DDF DB12 3805            12      JR  C,SCRN1
000DE1 DB14 FEE0             7      CP  $E0
000DE3 DB16 DC1BDB          17      CALL    C,SCRNC
       DB19                     SCRN1:
000DE6 DB19 E1              10      POP HL
000DE7 DB1A C9              10      RET
                                
       DB1B                     SCRNC:
000DE8 DB1B 6F               4      LD  L,A
000DE9 DB1C 60               4      LD  H,B
000DEA DB1D CBD8             8      SET 3,B
000DEC DB1F CD35CF          17      CALL    RDMMIO_BC
000DEF DB22 44               4      LD  B,H
000DF0 DB23 CB7F             8      BIT 7,A
000DF2 DB25 7D               4      LD  A,L
000DF3 DB26 C8              11      RET Z
000DF4 DB27 FE5B             7      CP  'Z'+1
000DF6 DB29 3804            12      JR  C,SCRNC_ADD
000DF8 DB2B FEC0             7      CP  $C0
000DFA DB2D 3803            12      JR  C,SCRNC_SUB
       DB2F                     SCRNC_ADD:
000DFC DB2F C620             7      ADD A,$20
000DFE DB31 C9              10      RET
       DB32                     SCRNC_SUB:
000DFF DB32 D620             7      SUB $20
000E01 DB34 C9              10      RET
[EOF:M7IO.ASM:SHIFT_JIS]
                                    INCLUDE "LDFILE.ASM"
                                
                                ;   LSX-Dodgers FILE
                                
                                ;   【注意】バイナリサイズを下位1バイトを0丁度に調整する必要あり
                                
       DB35                     FILEC:
000E02 DB35 CD40DB          17      CALL    FILE
       DB38                     FILEC2:
000E05 DB38 3A15F0          13      LD  A,(FDRV+1)
000E08 DB3B FE20             7      CP  020H
000E0A DB3D C8              11      RET Z
000E0B DB3E 1839            12      JR  SETDIR1
                                
       DB40                     FILE:
000E0D DB40 AF               4      XOR A
000E0E DB41 3214F0          13      LD  (FDRV),A
000E11 DB44 67               4      LD  H,A
000E12 DB45 6F               4      LD  L,A
000E13 DB46 2222F0          16      LD  (FDRV+14),HL
000E16 DB49 CD17DC          17      CALL    SPCUT
000E19 DB4C CDFCDB          17      CALL    CCHK3
000E1C DB4F 2812            12      JR  Z,DEVI1
000E1E DB51 13               6      INC DE
000E1F DB52 1A               7      LD  A,(DE)
000E20 DB53 1B               6      DEC DE
000E21 DB54 FE3A             7      CP  ':'
000E23 DB56 200B            12      JR  NZ,DEVI1
000E25 DB58 1A               7      LD  A,(DE)      ;DRIVE
000E26 DB59 CD57DE          17      CALL    CAP
000E29 DB5C D640             7      SUB '@'
000E2B DB5E 13               6      INC DE
000E2C DB5F 13               6      INC DE
000E2D DB60 3214F0          13      LD  (FDRV),A
       DB63                     DEVI1:
000E30 DB63 1A               7      LD  A,(DE)
000E31 DB64 D65C             7      SUB 05CH        ;\
000E33 DB66 2009            12      JR  NZ,NOROOT
000E35 DB68 6F               4      LD  L,A     ;A=0でH=0のはずなのでHL=0
000E36 DB69 222EF0          16      LD  (FDRV+26),HL
000E39 DB6C 2C               4      INC L
000E3A DB6D 2222F0          16      LD  (FDRV+14),HL
000E3D DB70 13               6      INC DE
       DB71                     NOROOT:
                                
       DB71                     SETDIR:
000E3E DB71 CD9DDB          17      CALL    FILED
000E41 DB74 1A               7      LD  A,(DE)
000E42 DB75 FE5C             7      CP  05CH        ;\
000E44 DB77 C0              11      RET NZ
000E45 DB78 13               6      INC DE
       DB79                     SETDIR1:
000E46 DB79 3E10             7      LD  A,010H      ;Directory
000E48 DB7B 3221F0          13      LD  (FDRV+13),A
000E4B DB7E D5              11      PUSH    DE
000E4C DB7F 1114F0          10      LD  DE,FDRV
000E4F DB82 2A1EF1          16      LD  HL,(STABLE+2*00FH)
000E52 DB85 CD0F00          17      CALL    JP_HL
000E55 DB88 D1              10      POP DE
000E56 DB89 B7               4      OR  A
000E57 DB8A C0              11      RET NZ
                                
000E58 DB8B 3A21F0          13      LD  A,(FDRV+13)
000E5B DB8E CB67             8      BIT 4,A
000E5D DB90 C8              11      RET Z
                                
000E5E DB91 CDE4DB          17      CALL    FILEI
000E61 DB94 2A2EF0          16      LD  HL,(FDRV+26)
000E64 DB97 23               6      INC HL
000E65 DB98 2222F0          16      LD  (FDRV+14),HL
000E68 DB9B 18D4            12      JR  SETDIR
                                
       DB9D                     FILED:
000E6A DB9D CDE4DB          17      CALL    FILEI
000E6D DBA0 2115F0          10      LD  HL,FNAME
                                
000E70 DBA3 0608             7      LD  B,8
       DBA5                     FILE2:
000E72 DBA5 CDF1DB          17      CALL    CCHKF
000E75 DBA8 C8              11      RET Z
000E76 DBA9 FE2A             7      CP  '*'
000E78 DBAB 282E            12      JR  Z,FILE9
000E7A DBAD FE2E             7      CP  '.'
000E7C DBAF 280C            12      JR  Z,FILE4
000E7E DBB1 77               7      LD  (HL),A
000E7F DBB2 23               6      INC HL
000E80 DBB3 10F0            13      DJNZ    FILE2
                                
       DBB5                     FILE3:
000E82 DBB5 CDF1DB          17      CALL    CCHKF
000E85 DBB8 C8              11      RET Z
000E86 DBB9 FE2E             7      CP  '.'
000E88 DBBB 20F8            12      JR  NZ,FILE3
                                
       DBBD                     FILE4:
000E8A DBBD 211DF0          10      LD  HL,FNAME+8
000E8D DBC0 0603             7      LD  B,3
                                
       DBC2                     FILE4L:
000E8F DBC2 CDF1DB          17      CALL    CCHKF
000E92 DBC5 C8              11      RET Z
000E93 DBC6 FE2E             7      CP  '.'
000E95 DBC8 2008            12      JR  NZ,FILE12
000E97 DBCA 3215F0          13      LD  (FNAME),A   ;Parent directory(..)
000E9A DBCD 3216F0          13      LD  (FNAME+1),A
000E9D DBD0 3E20             7      LD  A,020H
       DBD2                     FILE12:
000E9F DBD2 FE2A             7      CP  '*'
000EA1 DBD4 280A            12      JR  Z,FILE10
000EA3 DBD6 77               7      LD  (HL),A
000EA4 DBD7 23               6      INC HL
000EA5 DBD8 10E8            13      DJNZ    FILE4L
000EA7 DBDA C9              10      RET
                                
       DBDB                     FILE9:              ;名前の*処理、名前の残りを?で埋める
000EA8 DBDB CDE0DB          17      CALL    FILE10
000EAB DBDE 18D5            12      JR  FILE3
                                
       DBE0                     FILE10:
000EAD DBE0 3E3F             7      LD  A,'?'
000EAF DBE2 1808            12      JR  FILL_MEMORY
       DBE4                     FILEI:              ;名前＋拡張子をスペースで初期化
000EB1 DBE4 3E20             7      LD  A,020H
000EB3 DBE6 01000B          10      LD  BC,11*256   ;C=0にしておく
000EB6 DBE9 2115F0          10      LD  HL,FNAME
       DBEC                     FILL_MEMORY:            ;HLからBバイトAで埋める
000EB9 DBEC 77               7      LD  (HL),A
000EBA DBED 23               6      INC HL
000EBB DBEE 10FC            13      DJNZ    FILL_MEMORY
000EBD DBF0 C9              10      RET
                                
       DBF1                     CCHKF:
000EBE DBF1 1A               7      LD  A,(DE)
000EBF DBF2 CDF9DB          17      CALL    CCHK2
000EC2 DBF5 C8              11      RET Z
000EC3 DBF6 C364DF          10      JP  FKAN
                                
       DBF9                     CCHK2:
000EC6 DBF9 0C               4      INC C
000EC7 DBFA 0D               4      DEC C
000EC8 DBFB C0              11      RET NZ
       DBFC                     CCHK3:              ;ZF=1 で使えない文字
000EC9 DBFC FE2B             7      CP  '+'
000ECB DBFE C8              11      RET Z
000ECC DBFF FE2C             7      CP  ','
000ECE DC01 C8              11      RET Z
000ECF DC02 FE2F             7      CP  '/'
000ED1 DC04 C8              11      RET Z
000ED2 DC05 FE3A             7      CP  ':'
000ED4 DC07 C8              11      RET Z
000ED5 DC08 FE3B             7      CP  ';'
000ED7 DC0A C8              11      RET Z
000ED8 DC0B FE3D             7      CP  '='
000EDA DC0D C8              11      RET Z
000EDB DC0E FE5C             7      CP  05CH    ;\
000EDD DC10 C8              11      RET Z
000EDE DC11 FE20             7      CP  020H
000EE0 DC13 D0              11      RET NC
000EE1 DC14 BF               4      CP  A       ;Z=1
000EE2 DC15 C9              10      RET
                                
       DC16                     SS1:
000EE3 DC16 13               6      INC DE
       DC17                     SPCUT:              ;スペースをカット
000EE4 DC17 1A               7      LD  A,(DE)
000EE5 DC18 FE20             7      CP  020H
000EE7 DC1A 28FA            12      JR  Z,SS1
000EE9 DC1C C9              10      RET
                                
       DC1D                     SETDRVF:
000EEA DC1D 1114F0          10      LD  DE,FDRV
       DC20                     SETDRV0:
000EED DC20 CD29DC          17      CALL    SETDRV
000EF0 DC23 FDE1            14      POP IY
000EF2 DC25 C1              10      POP BC
000EF3 DC26 D1              10      POP DE
000EF4 DC27 E1              10      POP HL
000EF5 DC28 C9              10      RET
                                
       DC29                     SETDRV:
000EF6 DC29 E3              19      EX  (SP),HL     ;HL=RETRN ADDRESS
000EF7 DC2A D5              11      PUSH    DE      ;PUSH HL/DE/BC/IY
000EF8 DC2B C5              11      PUSH    BC
000EF9 DC2C 1A               7      LD  A,(DE)
000EFA DC2D D5              11      PUSH    DE
000EFB DC2E FDE3            23      EX  (SP),IY
                                
000EFD DC30 CD37DC          17      CALL    GETDRV
000F00 DC33 CDD9F0          17      CALL    _CHGDRV
                                
000F03 DC36 E9               4      JP  (HL)
                                
       DC37                     GETDRV:
000F04 DC37 CD4ADC          17      CALL    GETDRV1
000F07 DC3A 3288F0          13      LD  (_DRV),A
000F0A DC3D C9              10      RET
                                
       DC3E                     IS_SAME_DRV_A_DE:
                                ;   A と (DE) が同じドライブか調べる
                                ;   ZF=1ならば同じドライブ
000F0B DC3E CD4ADC          17      CALL    GETDRV1
000F0E DC41 C5              11      PUSH    BC
000F0F DC42 4F               4      LD  C,A
000F10 DC43 1A               7      LD  A,(DE)
000F11 DC44 CD4ADC          17      CALL    GETDRV1
000F14 DC47 A9               4      XOR C
000F15 DC48 C1              10      POP BC
000F16 DC49 C9              10      RET
       DC4A                     GETDRV1:
000F17 DC4A E67F             7      AND 07FH
000F19 DC4C D601             7      SUB 001H
000F1B DC4E D0              11      RET NC
000F1C DC4F 3A0400          13      LD  A,(_DVSW)   ;Current Drive
000F1F DC52 C9              10      RET
                                
       DC53                     SOPENX:
000F20 DC53 1139F0          10      LD  DE,SFILE
000F23 DC56 FD7E00          19      LD  A,(IY+0)        ;(FCB)ドライブ番号
000F26 DC59 CD3EDC          17      CALL    IS_SAME_DRV_A_DE
000F29 DC5C 2024            12      JR  NZ,SOPEN
000F2B DC5E 13               6      INC DE
000F2C DC5F FDE5            15      PUSH    IY
000F2E DC61 E1              10      POP HL
000F2F DC62 23               6      INC HL
000F30 DC63 CDEFDD          17      CALL    CPFILE
000F33 DC66 201A            12      JR  NZ,SOPEN
                                
000F35 DC68 2AF4F1          16      LD  HL,(SCDIR)
000F38 DC6B FD750E          19      LD  (IY+14),L   ;(FCB)アクセスするディレクトリのクラスタ番号+1
000F3B DC6E FD740F          19      LD  (IY+15),H
                                
000F3E DC71 2AF8F1          16      LD  HL,(SFNDF)  ;Direcroty location and Flags
000F41 DC74 229FF0          16      LD  (_FILEN),HL
                                
000F44 DC77 ED5BF6F1        20      LD  DE,(SFBPS)
000F48 DC7B 2139F0          10      LD  HL,SFILE
000F4B DC7E 36FF            10      LD  (HL),0FFH
000F4D DC80 23               6      INC HL
000F4E DC81 C9              10      RET
       DC82                     SOPEN:
000F4F DC82 2197DD          10      LD  HL,FILESE
       DC85                     SOPENC:
000F52 DC85 22BEDC          16      LD  (OPENPAT),HL
                                
000F55 DC88 CDE2F0          17      CALL    _RDFATX     ;Detect Media
000F58 DC8B 3856            12      JR  C,RDDERR
                                
000F5A DC8D AF               4      XOR A
000F5B DC8E 329FF0          13      LD  (_FILEN),A
000F5E DC91 CD97DE          17      CALL    LDDIRX1     ;A=0で呼び出す
000F61 DC94 2818            12      JR  Z,SDIRX1
                                
000F63 DC96 CD88DD          17      CALL    READ_DIR    ;Sub Directory
000F66 DC99 3808            12      JR  C,SDIRX0
000F68 DC9B 2A7EF1          16      LD  HL,(_DTBUF)
000F6B DC9E 7E               7      LD  A,(HL)
000F6C DC9F FE2E             7      CP  '.'
000F6E DCA1 280F            12      JR  Z,SOPEN1
       DCA3                     SDIRX0:
000F70 DCA3 AF               4      XOR A
000F71 DCA4 32A0F0          13      LD  (_DIRF),A
000F74 DCA7 FD360E01        19      LD  (IY+14),1   ;(FCB)レコードサイズ
000F78 DCAB FD770F          19      LD  (IY+15),A
       DCAE                     SDIRX1:
000F7B DCAE ED5BFCF1        20      LD  DE,(_DIRPS) ;Root Directory
       DCB2                     SOPEN1:
000F7F DCB2 0E20             7      LD  C,32        ;自己書き換え 1セクタ辺りのディレクトリエントリ数  1024=32 / 512=16 / 256=8
       DCB3                     SDECPAT EQU $-1
       DCB4                     SOPEN1X:
000F81 DCB4 CD88DD          17      CALL    READ_DIR    ;FILE SEARCH
000F84 DCB7 382A            12      JR  C,RDDERR
000F86 DCB9 2A7EF1          16      LD  HL,(_DTBUF)
       DCBC                     SOPEN2:
000F89 DCBC D5              11      PUSH    DE
000F8A DCBD CD97DD          17      CALL    FILESE      ;(self-modifying code)
       DCBE                     OPENPAT EQU $-2
000F8D DCC0 D1              10      POP DE
000F8E DCC1 386D            12      JR  C,SOPENE
000F90 DCC3 281B            12      JR  Z,SCF_FF_RET
       DCC5                     SOPEN3:
000F92 DCC5 3AA0F0          13      LD  A,(_DIRF)   ;ディレクトリか判別
000F95 DCC8 B7               4      OR  A
000F96 DCC9 200C            12      JR  NZ,SOPEN5
000F98 DCCB 13               6      INC DE      ;ルートディレクトリ
000F99 DCCC E5              11      PUSH    HL
000F9A DCCD 210C00          10      LD  HL,12       ;(self-modifying code)MAXDIR
       DCCE                     MD_PAT  EQU $-2
000F9D DCD0 ED52            15      SBC HL,DE       ;CF=0 なので SUB HL,DE
000F9F DCD2 E1              10      POP HL
000FA0 DCD3 20DD            12      JR  NZ,SOPEN1
000FA2 DCD5 1807            12      JR  SOPEN6
       DCD7                     SOPEN5:
000FA4 DCD7 CDADE5          17      CALL    GNCLX       ;END DIR
000FA7 DCDA D8              11      RET C
000FA8 DCDB CD4FDE          17      CALL    ENDCL
       DCDE                     SOPEN6:
000FAB DCDE 38D2            12      JR  C,SOPEN1
       DCE0                     SCF_FF_RET:
000FAD DCE0 37               4      SCF         ;CF=1
000FAE DCE1 9F               4      SBC A,A     ;A=0FFH
000FAF DCE2 C9              10      RET
                                
       DCE3                     RDDERR:
000FB0 DCE3 BF               4      CP  A       ;READ ERR CF=1 ZF=1
000FB1 DCE4 37               4      SCF
000FB2 DCE5 C9              10      RET
                                
       DCE6                     NOPEN:
000FB3 DCE6 2197DD          10      LD  HL,FILESE
000FB6 DCE9 22BEDC          16      LD  (OPENPAT),HL
000FB9 DCEC FD2A98F0        20      LD  IY,(_FCB)
000FBD DCF0 CD77DF          17      CALL    CHKWILDX
000FC0 DCF3 30EB            12      JR  NC,SCF_FF_RET
000FC2 DCF5 FD7E00          19      LD  A,(IY+0)
000FC5 DCF8 CD37DC          17      CALL    GETDRV
000FC8 DCFB CDD9F0          17      CALL    _CHGDRV
000FCB DCFE D8              11      RET C
000FCC DCFF 2AF8F1          16      LD  HL,(SFNDF)  ;Direcroty location and Flags
000FCF DD02 229FF0          16      LD  (_FILEN),HL
                                
000FD2 DD05 CD92DE          17      CALL    LDDIRX
000FD5 DD08 ED5B9AF0        20      LD  DE,(_FBPS)
000FD9 DD0C CD88DD          17      CALL    READ_DIR
000FDC DD0F 38D2            12      JR  C,RDDERR
000FDE DD11 3A9EF0          13      LD  A,(_FBCNT)
000FE1 DD14 3D               4      DEC A
000FE2 DD15 28AE            12      JR  Z,SOPEN3
       DD17                     NOPEN2:
000FE4 DD17 2A9CF0          16      LD  HL,(_FBAD)
000FE7 DD1A 012000          10      LD  BC,020H
000FEA DD1D 09              11      ADD HL,BC
000FEB DD1E 4F               4      LD  C,A
000FEC DD1F 189B            12      JR  SOPEN2
                                
       DD21                     SOPENE2:
000FEE DD21 229CF0          16      LD  (_FBAD),HL
000FF1 DD24 79               4      LD  A,C
000FF2 DD25 329EF0          13      LD  (_FBCNT),A
000FF5 DD28 ED539AF0        20      LD  (_FBPS),DE
000FF9 DD2C FD2298F0        20      LD  (_FCB),IY
       DD30                     SOPENE:
000FFD DD30 AF               4      XOR A
000FFE DD31 C9              10      RET
                                
       DD32                     COPEN:
000FFF DD32 FD360D20        19      LD  (IY+13),020H    ;(FCB)属性(アトリビュート)
                                
001003 DD36 21B4DD          10      LD  HL,NEXTSE
001006 DD39 CD85DC          17      CALL    SOPENC
001009 DD3C D0              11      RET NC
00100A DD3D C8              11      RET Z
00100B DD3E 3AA0F0          13      LD  A,(_DIRF)   ;ディレクトリか判別
00100E DD41 B7               4      OR  A
00100F DD42 37               4      SCF
001010 DD43 C8              11      RET Z       ;ルートディレクトリ
001011 DD44 0601             7      LD  B,1
001013 DD46 CDD6DF          17      CALL    WRDF
001016 DD49 D8              11      RET C
001017 DD4A ED5BFEF1        20      LD  DE,(_CLPS)
00101B DD4E D5              11      PUSH    DE
00101C DD4F CD18DE          17      CALL    DCPAT
00101F DD52 CD31E4          17      CALL    DRDNX
001022 DD55 2A7EF1          16      LD  HL,(_DTBUF) ;ディレクトリエントリを0クリア
001025 DD58 3A17E3          13      LD  A,(SECSZ+2) ;1024=4 / 512=2 / 256=1
001028 DD5B 47               4      LD  B,A
001029 DD5C AF               4      XOR A
00102A DD5D 4F               4      LD  C,A
       DD5E                     COPENCL:
00102B DD5E 77               7      LD  (HL),A
00102C DD5F EDA1            16      CPI         ;HL=HL+1 BC=BC-1 BCが0の場合にP/V=0
00102E DD61 EA5EDD          10      JP  PE,COPENCL
                                
001031 DD64 3A36DE          13      LD  A,(SPCPAT)  ;1クラスタの論理セクタ数
001034 DD67 3D               4      DEC A
001035 DD68 2819            12      JR  Z,COPENE
001037 DD6A 3E01             7      LD  A,1     ;1セクタ辺りのセクタ数が2以上の場合
001039 DD6C 32A5E5          13      LD  (_SECPS),A
00103C DD6F D1              10      POP DE      ;DE=(_CLPS)
00103D DD70 D5              11      PUSH    DE
       DD71                     COPEN1:
00103E DD71 D5              11      PUSH    DE      ;データバッファに入らないセクタもゼロクリア
00103F DD72 C5              11      PUSH    BC
001040 DD73 2A7EF1          16      LD  HL,(_DTBUF)
001043 DD76 CD32DE          17      CALL    CLUSTX
001046 DD79 CD46E7          17      CALL    DWT24
001049 DD7C C1              10      POP BC
00104A DD7D D1              10      POP DE
00104B DD7E CDA4E5          17      CALL    NEXTX
00104E DD81 20EE            12      JR  NZ,COPEN1
       DD83                     COPENE:
001050 DD83 2A7EF1          16      LD  HL,(_DTBUF)
001053 DD86 D1              10      POP DE
001054 DD87 C9              10      RET
                                
       DD88                     READ_DIR:
001055 DD88 ED53FEF1        20      LD  (_CLPS),DE
001059 DD8C C5              11      PUSH    BC
00105A DD8D D5              11      PUSH    DE
00105B DD8E CD18DE          17      CALL    DCPAT
00105E DD91 CD11E4          17      CALL    DRDX
001061 DD94 D1              10      POP DE
001062 DD95 C1              10      POP BC
001063 DD96 C9              10      RET
                                
       DD97                     FILESE:
001064 DD97 7E               7      LD  A,(HL)
001065 DD98 B7               4      OR  A
001066 DD99 C8              11      RET Z       ;END:ZF=1 CF=0
001067 DD9A FEE5             7      CP  0E5H
001069 DD9C 280E            12      JR  Z,FILESE1
00106B DD9E FDE5            15      PUSH    IY
00106D DDA0 D1              10      POP DE
00106E DDA1 13               6      INC DE
00106F DDA2 E5              11      PUSH    HL
001070 DDA3 CDEFDD          17      CALL    CPFILE
001073 DDA6 CC10DE          17      CALL    Z,CPFILE2
001076 DDA9 E1              10      POP HL
001077 DDAA 37               4      SCF
001078 DDAB C8              11      RET Z       ;!!!:(ZF=1) CF=1
       DDAC                     FILESE1:
001079 DDAC CDC3DD          17      CALL    FNEXT
00107C DDAF 20E6            12      JR  NZ,FILESE
       DDB1                     ZF0_CF0_AFF_RET:
00107E DDB1 F6FF             7      OR  0FFH        ;ZF=0 CF=0
001080 DDB3 C9              10      RET
                                
       DDB4                     NEXTSE:
001081 DDB4 7E               7      LD  A,(HL)
001082 DDB5 B7               4      OR  A
001083 DDB6 37               4      SCF
001084 DDB7 C8              11      RET Z       ;!!!:ZF=1 CF=1
001085 DDB8 FEE5             7      CP  0E5H
001087 DDBA 37               4      SCF
001088 DDBB C8              11      RET Z       ;!!!:(ZF=1) CF=1
001089 DDBC CDC3DD          17      CALL    FNEXT
00108C DDBF 20F3            12      JR  NZ,NEXTSE
00108E DDC1 18EE            12      JR  ZF0_CF0_AFF_RET
                                
       DDC3                     FNEXT:
001090 DDC3 E5              11      PUSH    HL
001091 DDC4 219FF0          10      LD  HL,_FILEN
001094 DDC7 34              11      INC (HL)
001095 DDC8 E1              10      POP HL
001096 DDC9 112000          10      LD  DE,020H
001099 DDCC 19              11      ADD HL,DE
00109A DDCD 0D               4      DEC C
00109B DDCE C9              10      RET
                                
       DDCF                     CPNAME:
00109C DDCF C5              11      PUSH    BC
00109D DDD0 D5              11      PUSH    DE
00109E DDD1 E5              11      PUSH    HL
00109F DDD2 CDE9DD          17      CALL    CPFILE4
0010A2 DDD5 E1              10      POP HL
0010A3 DDD6 23               6      INC HL
0010A4 DDD7 23               6      INC HL
0010A5 DDD8 23               6      INC HL
0010A6 DDD9 23               6      INC HL
0010A7 DDDA D1              10      POP DE
0010A8 DDDB C1              10      POP BC
0010A9 DDDC 2005            12      JR  NZ,CPNAME1
0010AB DDDE 7E               7      LD  A,(HL)
0010AC DDDF 23               6      INC HL
0010AD DDE0 66               7      LD  H,(HL)
0010AE DDE1 6F               4      LD  L,A
0010AF DDE2 C9              10      RET
       DDE3                     CPNAME1:
0010B0 DDE3 23               6      INC HL
0010B1 DDE4 23               6      INC HL
0010B2 DDE5 10E8            13      DJNZ    CPNAME
0010B4 DDE7 37               4      SCF
0010B5 DDE8 C9              10      RET
                                
       DDE9                     CPFILE4:
0010B6 DDE9 C5              11      PUSH    BC
0010B7 DDEA 010004          10      LD  BC,00400H
0010BA DDED 1804            12      JR  CPSTR1
       DDEF                     CPFILE:
0010BC DDEF C5              11      PUSH    BC
0010BD DDF0 01000B          10      LD  BC,00B00H
       DDF3                     CPSTR1:
0010C0 DDF3 1A               7      LD  A,(DE)
0010C1 DDF4 FE3F             7      CP  '?'     ;Wild card
0010C3 DDF6 2812            12      JR  Z,CPSTR2
0010C5 DDF8 7E               7      LD  A,(HL)
0010C6 DDF9 CD5DDF          17      CALL    FKANC
0010C9 DDFC E5              11      PUSH    HL
0010CA DDFD 67               4      LD  H,A
0010CB DDFE 1A               7      LD  A,(DE)
0010CC DDFF CB01             4      RLC C
0010CE DE01 CD5DDF          17      CALL    FKANC
0010D1 DE04 CB09             4      RRC C
0010D3 DE06 BC               4      CP  H       ;CP (HL),(DE)
0010D4 DE07 E1              10      POP HL
0010D5 DE08 2004            12      JR  NZ,CPSTR3
       DE0A                     CPSTR2:
0010D7 DE0A 13               6      INC DE
0010D8 DE0B 23               6      INC HL
0010D9 DE0C 10E5            13      DJNZ    CPSTR1
       DE0E                     CPSTR3:
0010DB DE0E C1              10      POP BC
0010DC DE0F C9              10      RET
                                
       DE10                     CPFILE2:
0010DD DE10 FD7E0D          19      LD  A,(IY+13)   ;(FCB)属性(アトリビュート)
0010E0 DE13 F6E1             7      OR  0E1H
0010E2 DE15 2F               4      CPL
0010E3 DE16 A6               7      AND (HL)
0010E4 DE17 C9              10      RET
                                
       DE18                     DCPAT:
0010E5 DE18 0E00             7      LD  C,0
0010E7 DE1A 2A7EF1          16      LD  HL,(_DTBUF)
0010EA DE1D 3AA0F0          13      LD  A,(_DIRF)   ;ディレクトリか判別
0010ED DE20 B7               4      OR  A
0010EE DE21 C8              11      RET Z       ;ルートディレクトリの場合はCレジスタを0にしておく(CDEがセクタ番号)
0010EF DE22 3A36DE          13      LD  A,(SPCPAT)
0010F2 DE25 4F               4      LD  C,A
0010F3 DE26 3AA5E5          13      LD  A,(_SECPS)
0010F6 DE29 B9               4      CP  C
0010F7 DE2A 3801            12      JR  C,DC1
0010F9 DE2C AF               4      XOR A
       DE2D                     DC1:
0010FA DE2D F680             7      OR  080H
0010FC DE2F 32A0F0          13      LD  (_DIRF),A   ;bit0-6:セクタインデックス
       DE32                     CLUSTX:
0010FF DE32 E5              11      PUSH    HL
001100 DE33 EB               4      EX  DE,HL
001101 DE34 AF               4      XOR A
001102 DE35 0E01             7      LD  C,1     ;自己書き換え（1クラスタの論理セクタ数）
       DE36                     SPCPAT  EQU $-1
       DE37                     L_CLDBL:
001104 DE37 CB19             8      RR  C       ;->CF
001106 DE39 3804            12      JR  C,E_CLDBL
001108 DE3B 29              11      ADD HL,HL       ;*2
001109 DE3C 8F               4      ADC A,A
00110A DE3D 18F8            12      JR  L_CLDBL
       DE3F                     E_CLDBL:
00110C DE3F 4F               4      LD  C,A
00110D DE40 3AA5E5          13      LD  A,(_SECPS)
001110 DE43 B5               4      OR  L
001111 DE44 6F               4      LD  L,A
001112 DE45 110800          10      LD  DE,8    ;+8 (2D)  !ADDCL (self-modifying code)
       DE46                     CLSPAT  EQU $-2
001115 DE48 AF               4      XOR A
001116 DE49 19              11      ADD HL,DE   ;データ格納領域の先頭論理セクタ番号
001117 DE4A 89               4      ADC A,C
001118 DE4B 4F               4      LD  C,A
001119 DE4C EB               4      EX  DE,HL
00111A DE4D E1              10      POP HL
00111B DE4E C9              10      RET
                                
       DE4F                     ENDCL:
00111C DE4F 7A               4      LD  A,D ;END CLUSTER
00111D DE50 FE01             7      CP  1   ;164=356    (self-modifying code)
       DE51                     CLPAT1  EQU $-1
00111F DE52 C0              11      RET NZ
001120 DE53 7B               4      LD  A,E
001121 DE54 FE64             7      CP  064H    ;       (self-modifying code)
       DE55                     CLPAT2  EQU $-1
001123 DE56 C9              10      RET
                                
       DE57                     CAP:
001124 DE57 FE61             7      CP  'a'
001126 DE59 D8              11      RET C
001127 DE5A FE7B             7      CP  'z'+1
001129 DE5C D0              11      RET NC
00112A DE5D D620             7      SUB 020H
00112C DE5F C9              10      RET
       DE60                     CAP2:
00112D DE60 CD57DE          17      CALL    CAP
       DE63                     CAP3:               ;
001130 DE63 FE05             7      CP  5
001132 DE65 2803            12      JR  Z,CAP4
001134 DE67 FE21             7      CP  021H
001136 DE69 C9              10      RET
       DE6A                     CAP4:
001137 DE6A 3EE5             7      LD  A,0E5H
001139 DE6C C9              10      RET
                                
       DE6D                     CHDIR:
00113A DE6D CD59E8          17      CALL    GETDPBD
00113D DE70 381D            12      JR  C,CHDIR2
00113F DE72 DD751A          19      LD  (IX+DPB_SDIR),L
001142 DE75 DD741B          19      LD  (IX+DPB_SDIR+1),H
001145 DE78 1815            12      JR  CHDIR2      ;POP_IX_RET
                                
       DE7A                     LDDIR:
001147 DE7A CD59E8          17      CALL    GETDPBD
00114A DE7D DD5E1A          19      LD  E,(IX+DPB_SDIR)
00114D DE80 DD561B          19      LD  D,(IX+DPB_SDIR+1)
001150 DE83 13               6      INC DE
001151 DE84 FD730E          19      LD  (IY+14),E   ;(FCB)アクセスするディレクトリのクラスタ番号+1
001154 DE87 FD720F          19      LD  (IY+15),D
001157 DE8A 1B               6      DEC DE
001158 DE8B AF               4      XOR A
001159 DE8C 32A0F0          13      LD  (_DIRF),A
       DE8F                     CHDIR2:
00115C DE8F DDE1            14      POP IX
00115E DE91 C9              10      RET
                                
       DE92                     LDDIRX:
00115F DE92 3AA0F0          13      LD  A,(_DIRF)   ;(FCB)アクセスするディレクトリのセクタインデックス
001162 DE95 E67F             7      AND 07FH
       DE97                     LDDIRX1:
001164 DE97 32A5E5          13      LD  (_SECPS),A
001167 DE9A FD5E0E          19      LD  E,(IY+14)   ;(FCB)アクセスするディレクトリのクラスタ番号+1
00116A DE9D FD560F          19      LD  D,(IY+15)
00116D DEA0 1B               6      DEC DE
00116E DEA1 CD4FDE          17      CALL    ENDCL
001171 DEA4 D47ADE          17      CALL    NC,LDDIR
       DEA7                     LDDIRS:
001174 DEA7 7A               4      LD  A,D
001175 DEA8 B3               4      OR  E
001176 DEA9 32A0F0          13      LD  (_DIRF),A   ;ディレクトリか判別
001179 DEAC C9              10      RET
                                
       DEAD                     KILL:
00117A DEAD CD77DF          17      CALL    CHKWILDX
00117D DEB0 3834            12      JR  C,KILLW
00117F DEB2 CD53DC          17      CALL    SOPENX
       DEB5                     KILLS:
001182 DEB5 3E1F             7      LD  A,01FH
001184 DEB7 D4F9DE          17      CALL    NC,CHKATT
001187 DEBA D8              11      RET C
       DEBB                     KILLSX:
001188 DEBB 36E5            10      LD  (HL),0E5H   ;DIR
00118A DEBD CD51DF          17      CALL    WTDB
00118D DEC0 111A00          10      LD  DE,01AH
001190 DEC3 19              11      ADD HL,DE
001191 DEC4 5E               7      LD  E,(HL)
001192 DEC5 23               6      INC HL
001193 DEC6 56               7      LD  D,(HL)
       DEC7                     KILLS1:
001194 DEC7 CD4FDE          17      CALL    ENDCL
001197 DECA D0              11      RET NC      ;CF=0
001198 DECB 21FEFF          10      LD  HL,0-2
00119B DECE 19              11      ADD HL,DE
00119C DECF D0              11      RET NC      ;DE= 0 or 1
00119D DED0 D5              11      PUSH    DE
00119E DED1 CDF7F0          17      CALL    _GNCL
0011A1 DED4 ED53FEF1        20      LD  (_CLPS),DE
0011A5 DED8 D1              10      POP DE
0011A6 DED9 210000          10      LD  HL,0
0011A9 DEDC D4FAF0          17      CALL    NC,_SNCL
0011AC DEDF D8              11      RET C
0011AD DEE0 ED5BFEF1        20      LD  DE,(_CLPS)  ;FAT
0011B1 DEE4 18E1            12      JR  KILLS1
                                
       DEE6                     KILLW:
0011B3 DEE6 CD82DC          17      CALL    SOPEN
       DEE9                     KILLW1:
0011B6 DEE9 380B            12      JR  C,KILLW2
0011B8 DEEB CD21DD          17      CALL    SOPENE2
0011BB DEEE CDB5DE          17      CALL    KILLS
0011BE DEF1 CDE6DC          17      CALL    NOPEN
0011C1 DEF4 18F3            12      JR  KILLW1
       DEF6                     KILLW2:
0011C3 DEF6 C8              11      RET Z
0011C4 DEF7 3F               4      CCF
0011C5 DEF8 C9              10      RET
                                
       DEF9                     CHKATT:
0011C6 DEF9 E5              11      PUSH    HL
0011C7 DEFA 110B00          10      LD  DE,00BH
0011CA DEFD 19              11      ADD HL,DE
0011CB DEFE A6               7      AND (HL)
0011CC DEFF E1              10      POP HL
0011CD DF00 C8              11      RET Z
0011CE DF01 37               4      SCF
0011CF DF02 C9              10      RET
                                
       DF03                     NAME:
0011D0 DF03 CD77DF          17      CALL    CHKWILDX
0011D3 DF06 D8              11      RET C
0011D4 DF07 110400          10      LD  DE,4
0011D7 DF0A 19              11      ADD HL,DE
0011D8 DF0B 2220DF          16      LD  (NAMEP),HL
0011DB DF0E 23               6      INC HL
0011DC DF0F CD7BDF          17      CALL    CHKWILD
0011DF DF12 D8              11      RET C
                                
0011E0 DF13 CD53DC          17      CALL    SOPENX
0011E3 DF16 3E0F             7      LD  A,00FH
0011E5 DF18 D4F9DE          17      CALL    NC,CHKATT
0011E8 DF1B D8              11      RET C
                                
0011E9 DF1C FDE5            15      PUSH    IY
0011EB DF1E FD210000        14      LD  IY,0        ;自己書き換え
       DF20                     NAMEP   EQU $-2
0011EF DF22 CD53DC          17      CALL    SOPENX
0011F2 DF25 FDE3            23      EX  (SP),IY
0011F4 DF27 3F               4      CCF
0011F5 DF28 D482DC          17      CALL    NC,SOPEN
0011F8 DF2B EB               4      EX  DE,HL
0011F9 DF2C E1              10      POP HL
0011FA DF2D D8              11      RET C
                                
       DF2E                     SETNAME:
0011FB DF2E 01000B          10      LD  BC,11*256
0011FE DF31 23               6      INC HL
0011FF DF32 7E               7      LD  A,(HL)
001200 DF33 FEE5             7      CP  0E5H
001202 DF35 2004            12      JR  NZ,SNAME1
001204 DF37 3E05             7      LD  A,5
001206 DF39 180E            12      JR  SNAME3
       DF3B                     SNAME1:
001208 DF3B 7E               7      LD  A,(HL)
001209 DF3C 0C               4      INC C
00120A DF3D 0D               4      DEC C
00120B DF3E 2009            12      JR  NZ,SNAME3
00120D DF40 CD57DE          17      CALL    CAP
001210 DF43 FEA0             7      CP  0A0H
001212 DF45 2002            12      JR  NZ,SNAME3
001214 DF47 3E20             7      LD  A,020H
       DF49                     SNAME3:
001216 DF49 12               7      LD  (DE),A
001217 DF4A 7E               7      LD  A,(HL)
001218 DF4B 23               6      INC HL
001219 DF4C CD64DF          17      CALL    FKAN
00121C DF4F 10EA            13      DJNZ    SNAME1
       DF51                     WTDB:
00121E DF51 3EFF             7      LD  A,0FFH
001220 DF53 3239F0          13      LD  (SFILE),A
001223 DF56 3E01             7      LD  A,1
001225 DF58 32A4F0          13      LD  (_WTDBF),A
001228 DF5B AF               4      XOR A
001229 DF5C C9              10      RET
                                
       DF5D                     FKANC:
00122A DF5D CB41             8      BIT 0,C
00122C DF5F CC60DE          17      CALL    Z,CAP2
00122F DF62 1801            12      JR  FKANX
       DF64                     FKAN:           ;漢字チェック
001231 DF64 13               6      INC DE
       DF65                     FKANX:
001232 DF65 CB41             8      BIT 0,C
001234 DF67 CB81             8      RES 0,C
001236 DF69 C0              11      RET NZ
001237 DF6A FE80             7      CP  080H
001239 DF6C D8              11      RET C
00123A DF6D FEA0             7      CP  0A0H
00123C DF6F 3803            12      JR  C,FKAN1
00123E DF71 FEE0             7      CP  0E0H
001240 DF73 D8              11      RET C
       DF74                     FKAN1:
001241 DF74 0C               4      INC C
001242 DF75 A7               4      AND A
001243 DF76 C9              10      RET
                                
       DF77                     CHKWILDX:
001244 DF77 FDE5            15      PUSH    IY
001246 DF79 E1              10      POP HL
001247 DF7A 23               6      INC HL
       DF7B                     CHKWILD:
001248 DF7B 060B             7      LD  B,11
00124A DF7D 3E3F             7      LD  A,'?'
       DF7F                     CHKWIL1:
00124C DF7F BE               7      CP  (HL)
00124D DF80 23               6      INC HL
00124E DF81 37               4      SCF
00124F DF82 C8              11      RET Z
001250 DF83 10FA            13      DJNZ    CHKWIL1
001252 DF85 AF               4      XOR A
001253 DF86 C9              10      RET
                                
       DF87                     SDIRENT:        ;IY=FCB HL=DIR
001254 DF87 D5              11      PUSH    DE
001255 DF88 E5              11      PUSH    HL
001256 DF89 FDE5            15      PUSH    IY
001258 DF8B D1              10      POP DE
001259 DF8C EB               4      EX  DE,HL
00125A DF8D CD2EDF          17      CALL    SETNAME
                                ;               Attribute
00125D DF90 FD7E0D          19      LD  A,(IY+13)   ;(FCB)属性(アトリビュート)
001260 DF93 12               7      LD  (DE),A
001261 DF94 13               6      INC DE
                                ;               Reserved
001262 DF95 AF               4      XOR A
001263 DF96 060A             7      LD  B,10
       DF98                     SDE1:
001265 DF98 12               7      LD  (DE),A
001266 DF99 13               6      INC DE
001267 DF9A 10FC            13      DJNZ    SDE1
                                                    ;(FCB)更新時刻
001269 DF9C 21E4F1          10      LD  HL,SDDATA       ;(FCB)更新年月日
00126C DF9F 060A             7      LD  B,SDDATAE-SDDATA    ;(FCB)ファイルの先頭クラスタ
       DFA1                     SDLOOP:                 ;(FCB)ファイルのサイズ(バイト単位)
00126E DFA1 7E               7      LD  A,(HL)
00126F DFA2 23               6      INC HL
001270 DFA3 32A8DF          13      LD  (SDPAT),A
001273 DFA6 FD7E00          19      LD  A,(IY+0)    ;LD A,(IY+A)
       DFA8                     SDPAT   EQU $-1
001276 DFA9 12               7      LD  (DE),A
001277 DFAA 13               6      INC DE
001278 DFAB 10F4            13      DJNZ    SDLOOP
                                
00127A DFAD AF               4      XOR A
00127B DFAE E1              10      POP HL
00127C DFAF D1              10      POP DE
00127D DFB0 C9              10      RET
                                
       DFB1                     WOPEN:
00127E DFB1 FD7E0D          19      LD  A,(IY+13)   ;(FCB)属性(アトリビュート)
001281 DFB4 E61F             7      AND 01FH
001283 DFB6 37               4      SCF
001284 DFB7 C0              11      RET NZ
001285 DFB8 FD361CFE        19      LD  (IY+28),0FEH    ;(FCB)オープンモード
       DFBC                     TOPEN2:
001289 DFBC AF               4      XOR A
       DFBD                     TOPEN:              ;Initializes the time stamp
00128A DFBD FD3617FF        19      LD  (IY+23),0FFH    ;(FCB)更新時刻
00128E DFC1 C9              10      RET
                                
       DFC2                     WRDFX:
00128F DFC2 3A36DE          13      LD  A,(SPCPAT)  ;1クラスタの論理セクタ
       DFC5                     L_WRFX:
001292 DFC5 1F               4      RRA         ;->CF
001293 DFC6 3806            12      JR  C,E_WRFX
001295 DFC8 CB39             8      SRL C
001297 DFCA CB1C             8      RR  H       ;CH=CH/2
001299 DFCC 18F7            12      JR  L_WRFX
       DFCE                     E_WRFX:
00129B DFCE 41               4      LD  B,C
00129C DFCF 4C               4      LD  C,H
00129D DFD0 03               6      INC BC
00129E DFD1 3E37             7      LD  A,037H      ;SCF
0012A0 DFD3 322EE4          13      LD  (DRDN1),A
                                
       DFD6                     WRDF:               ;BCクラスタ分FATを確保する
0012A3 DFD6 110200          10      LD  DE,2
0012A6 DFD9 AF               4      XOR A
0012A7 DFDA 32A5E5          13      LD  (_SECPS),A
       DFDD                     WRDF1:
0012AA DFDD C5              11      PUSH    BC
0012AB DFDE D5              11      PUSH    DE
0012AC DFDF CDF7F0          17      CALL    _GNCL
0012AF DFE2 381C            12      JR  C,WRDF3
0012B1 DFE4 7A               4      LD  A,D     ;空いているかチェック
0012B2 DFE5 B3               4      OR  E
0012B3 DFE6 202A            12      JR  NZ,WRDF4
0012B5 DFE8 E1              10      POP HL      ;HL=空いているクラスタ
0012B6 DFE9 E5              11      PUSH    HL
0012B7 DFEA ED5BFEF1        20      LD  DE,(_CLPS)  ;DE=元の(_CLPS)
0012BB DFEE 22FEF1          16      LD  (_CLPS),HL
0012BE DFF1 7A               4      LD  A,D     ;元の(_CLPS)が 0 か?
0012BF DFF2 B3               4      OR  E
0012C0 DFF3 2008            12      JR  NZ,WRDF2
0012C2 DFF5 FD751A          19      LD  (IY+26),L   ;(FCB)ファイルの先頭クラスタ
0012C5 DFF8 FD741B          19      LD  (IY+27),H   ;元が空の場合はFCBにクラスタをセットする
0012C8 DFFB 1803            12      JR  WRDF3
       DFFD                     WRDF2:
0012CA DFFD CDFAF0          17      CALL    _SNCL
       E000                     WRDF3:
0012CD E000 D1              10      POP DE
0012CE E001 C1              10      POP BC
0012CF E002 D8              11      RET C
0012D0 E003 0B               6      DEC BC
0012D1 E004 78               4      LD  A,B
0012D2 E005 B1               4      OR  C
0012D3 E006 200C            12      JR  NZ,WRDF5    ;ここでループカウンタチェック
0012D5 E008 ED5BFEF1        20      LD  DE,(_CLPS)
0012D9 E00C 21FFFF          10      LD  HL,0FFFFH   ;FATエントリ終了(EOCマーク)
0012DC E00F C3FAF0          10      JP  _SNCL
                                
       E012                     WRDF4:              ;DEクラスタが空じゃないので次に移動する
0012DF E012 D1              10      POP DE
0012E0 E013 C1              10      POP BC
       E014                     WRDF5:
0012E1 E014 13               6      INC DE
0012E2 E015 CD4FDE          17      CALL    ENDCL
0012E5 E018 38C3            12      JR  C,WRDF1
0012E7 E01A 37               4      SCF
0012E8 E01B C9              10      RET
                                
       E01C                     RWXR:
0012E9 E01C 3A17E3          13      LD  A,(SECSZ+2) ;1024=4 / 512=2 / 256=1
       E01F                     L_RWX:
0012EC E01F 1F               4      RRA     ;->CF
0012ED E020 3808            12      JR  C,E_RWX
0012EF E022 CB38             8      SRL B   ;BCH=BCH/2
0012F1 E024 CB19             8      RR  C   ;
0012F3 E026 CB1C             8      RR  H   ;
0012F5 E028 18F5            12      JR  L_RWX
       E02A                     E_RWX:
0012F7 E02A FD5E1A          19      LD  E,(IY+26)   ;(FCB)ファイルの先頭クラスタ
0012FA E02D FD561B          19      LD  D,(IY+27)
0012FD E030 AF               4      XOR A
0012FE E031 32A5E5          13      LD  (_SECPS),A
       E034                     RWX1:
001301 E034 ED53FEF1        20      LD  (_CLPS),DE
001305 E038 7A               4      LD  A,D
001306 E039 B3               4      OR  E
001307 E03A 2813            12      JR  Z,SCF_RET   ;RET DE==0 => CF=1
                                
001309 E03C 78               4      LD  A,B
00130A E03D B1               4      OR  C
00130B E03E B4               4      OR  H
00130C E03F C8              11      RET Z       ;RET BCH==0 => CF=0
                                
00130D E040 CDADE5          17      CALL    GNCLX
001310 E043 D8              11      RET C
001311 E044 7C               4      LD  A,H     ;
001312 E045 25               4      DEC H       ;
001313 E046 B7               4      OR  A       ;DEC BCH
001314 E047 2001            12      JR  NZ,RWX2     ;
001316 E049 0B               6      DEC BC      ;
       E04A                     RWX2:
001317 E04A CD4FDE          17      CALL    ENDCL
00131A E04D 38E5            12      JR  C,RWX1
       E04F                     SCF_RET:
00131C E04F 37               4      SCF
00131D E050 C9              10      RET
                                
       E051                     DSKF:
00131E E051 110000          10      LD  DE,0
       E052                     MAXCLP  EQU $-2
001321 E054 2AACF0          16      LD  HL,(_FAKEFREE)
001324 E057 7C               4      LD  A,H
001325 E058 B5               4      OR  L
001326 E059 2803            12      JR  Z,DSKF1
001328 E05B 110100          10      LD  DE,1
       E05E                     DSKF1:
00132B E05E D5              11      PUSH    DE
00132C E05F CDF7F0          17      CALL    _GNCL
00132F E062 380C            12      JR  C,POPSCF
001331 E064 7A               4      LD  A,D
001332 E065 B3               4      OR  E
001333 E066 2001            12      JR  NZ,DSKF2
001335 E068 23               6      INC HL
       E069                     DSKF2:
001336 E069 D1              10      POP DE
001337 E06A 1B               6      DEC DE
001338 E06B 7A               4      LD  A,D
001339 E06C B3               4      OR  E
00133A E06D 20EF            12      JR  NZ,DSKF1
00133C E06F C9              10      RET
                                
       E070                     POPSCF:
00133D E070 F1              10      POP AF
00133E E071 37               4      SCF
00133F E072 C9              10      RET
                                
       E073                     SETTMS:
001340 E073 FD7E17          19      LD  A,(IY+23)   ;(FCB)ファイルを最後に変更した時刻
001343 E076 3C               4      INC A
001344 E077 C0              11      RET NZ      ;ファイルが更新されていない
       E078                     SETTMSX:            ;FCBに日付時刻をセットする
001345 E078 CDB3D7          17      CALL    _SYS2C      ;(BDOS)時刻の獲得
                                                ;H←時  L←分  D←秒
001348 E07B CB25             8      SLA L       ;   *2
00134A E07D CB25             8      SLA L       ;   *4
00134C E07F 29              11      ADD HL,HL       ;*2 *8
00134D E080 29              11      ADD HL,HL       ;*4 *16
00134E E081 29              11      ADD HL,HL       ;*8 *32
00134F E082 7A               4      LD  A,D
001350 E083 0F               4      RRCA            ;bit.0->7->->->0->C
001351 E084 E61F             7      AND 01FH
001353 E086 B5               4      OR  L
001354 E087 FD7716          19      LD  (IY+22),A   ;(FCB)ファイルを最後に変更した時刻
001357 E08A FD7417          19      LD  (IY+23),H
                                
00135A E08D CDADD7          17      CALL    _SYS2A      ;(BDOS)日付の獲得
                                                ;HL←年  D←月  E←日
00135D E090 0144F8          10      LD  BC,0-1980
001360 E093 09              11      ADD HL,BC
001361 E094 65               4      LD  H,L
                                
001362 E095 7A               4      LD  A,D
001363 E096 87               4      ADD A,A     ;*2
001364 E097 87               4      ADD A,A     ;*4
001365 E098 87               4      ADD A,A     ;*8
001366 E099 87               4      ADD A,A     ;*16
001367 E09A 6F               4      LD  L,A
001368 E09B 29              11      ADD HL,HL       ;*32
001369 E09C 7D               4      LD  A,L
00136A E09D B3               4      OR  E
00136B E09E FD7714          19      LD  (IY+20),A   ;(FCB)ファイルを最後に変更した日付
00136E E0A1 FD7415          19      LD  (IY+21),H
001371 E0A4 C9              10      RET
                                
       E0A5                     PUSHRR:
001372 E0A5 3219E1          13      LD  (SETSEQ_SWC_RND),A
001375 E0A8 222BE1          16      LD  (SETSEQ_SWC_SEQ_RR),HL
001378 E0AB CDCBE0          17      CALL    GET_RR_AHL
00137B E0AE 220FF0          16      LD  (RR_BUF_HL),HL
00137E E0B1 3211F0          13      LD  (RR_BUF_A),A
001381 E0B4 C9              10      RET
                                
       E0B5                     GET_CPM_R_SIZE:     ;バイト単位からCP/Mのレコード単位を求める（1レコード=128バイト）
001382 E0B5 87               4      ADD A,A     ;in BHLA => out AHL
001383 E0B6 ED6A            15      ADC HL,HL
001385 E0B8 CB18             8      RR  B
001387 E0BA B7               4      OR  A
001388 E0BB 78               4      LD  A,B     ;ここでフラグは変化しない
001389 E0BC C8              11      RET Z
00138A E0BD 2C               4      INC L       ;INC AHL
00138B E0BE C0              11      RET NZ      ;
00138C E0BF 24               4      INC H       ;
00138D E0C0 C0              11      RET NZ      ;
00138E E0C1 3C               4      INC A       ;
00138F E0C2 C9              10      RET
                                
       E0C3                     INIT_RND:
001390 E0C3 3ECD             7      LD  A,0CDH      ;CALL ????
001392 E0C5 21EEE0          10      LD  HL,POPRR
001395 E0C8 CDA5E0          17      CALL    PUSHRR
       E0CB                     GET_RR_AHL:
001398 E0CB FD6E21          19      LD  L,(IY+33)   ;(FCB)Random record
00139B E0CE FD6622          19      LD  H,(IY+34)   ;
00139E E0D1 FD7E23          19      LD  A,(IY+35)   ;
0013A1 E0D4 C9              10      RET
       E0D5                     INIT_SEQ:
0013A2 E0D5 3E01             7      LD  A,1     ;LD BC,????
0013A4 E0D7 21EBE0          10      LD  HL,SETSEQ
0013A7 E0DA CDA5E0          17      CALL    PUSHRR
       E0DD                     GETSEQ:
0013AA E0DD FD6E20          19      LD  L,(IY+32)   ;(FCB)カレントレコード
0013AD E0E0 FD660C          19      LD  H,(IY+12)   ;(FCB)カレントブロック
0013B0 E0E3 AF               4      XOR A
                                
0013B1 E0E4 CB25             8      SLA L   ;L=L*2
                                
0013B3 E0E6 CB3C             8      SRL H   ;HL=HL/2
0013B5 E0E8 CB1D             8      RR  L   ;
0013B7 E0EA C9              10      RET
                                
       E0EB                     SETSEQ:
0013B8 E0EB CDF7E3          17      CALL    SETSEQ1
       E0EE                     POPRR:
0013BB E0EE F5              11      PUSH    AF
0013BC E0EF E5              11      PUSH    HL
0013BD E0F0 2A0FF0          16      LD  HL,(RR_BUF_HL)
0013C0 E0F3 3A11F0          13      LD  A,(RR_BUF_A)
0013C3 E0F6 CDEDE3          17      CALL    SET_RR_AHL
0013C6 E0F9 E1              10      POP HL
0013C7 E0FA F1              10      POP AF
0013C8 E0FB C9              10      RET
                                
       E0FC                     RB_WRITE:
0013C9 E0FC C5              11      PUSH    BC
0013CA E0FD ED4B4CF1        20      LD  BC,(STABLE+2*026H)  ;(BDOS)ランダムブロック書き込み
0013CE E101 1805            12      JR  RBRW
       E103                     RB_READ:
0013D0 E103 C5              11      PUSH    BC
0013D1 E104 ED4B4EF1        20      LD  BC,(STABLE+2*027H)  ;(BDOS)ランダムブロック読み込み
       E108                     RBRW:
0013D5 E108 1F               4      RRA     ;AHL = AHL*128
0013D6 E109 7C               4      LD  A,H ;AHL = AHL0/2
0013D7 E10A 1F               4      RRA     ;A
0013D8 E10B 65               4      LD  H,L ;
0013D9 E10C CB1C             8      RR  H   ;H
0013DB E10E 2E00             7      LD  L,0 ;
0013DD E110 CB1D             8      RR  L   ;L
0013DF E112 CDEDE3          17      CALL    SET_RR_AHL
0013E2 E115 218000          10      LD  HL,128
0013E5 E118 C5              11      PUSH    BC
       E119                     SETSEQ_SWC_RND:
0013E6 E119 CDF7E3          17      CALL    SETSEQ1
0013E9 E11C C1              10      POP BC
0013EA E11D FDCB20FE        23      SET 7,(IY+32)   ;(FCB)カレントレコード
0013EE E121 FDE5            15      PUSH    IY
0013F0 E123 D1              10      POP DE
0013F1 E124 D5              11      PUSH    DE
0013F2 E125 CD33E1          17      CALL    JP_BC
0013F5 E128 FDE1            14      POP IY
0013F7 E12A CDEBE0          17      CALL    SETSEQ
       E12B                     SETSEQ_SWC_SEQ_RR   EQU $-2
0013FA E12D FDCB20BE        23      RES 7,(IY+32)   ;(FCB)カレントレコード
                                
0013FE E131 C1              10      POP BC
0013FF E132 C9              10      RET
       E133                     JP_BC:
001400 E133 C5              11      PUSH    BC
001401 E134 C9              10      RET
                                
       DCE0                     _SYS03  EQU SCF_FF_RET  ;(BDOS)外部入力
       DCE0                     _SYS2B  EQU SCF_FF_RET  ;(BDOS)日付の設定
       DCE0                     _SYS2D  EQU SCF_FF_RET  ;(BDOS)時刻の設定
       DCE0                     _SYS39  EQU SCF_FF_RET  ;(BDOS)サブディレクトリの作成
       DCE0                     _SYS3A  EQU SCF_FF_RET  ;(BDOS)サブディレクトリの削除
                                
[EOF:LDFILE.ASM:SHIFT_JIS]
                                    INCLUDE "LDFILE2.ASM"
                                
                                ;   LSX-Dodgers FILE2
                                
                                                ;Write random block
       E135                     _SYS26:     ;(BDOS)ランダムブロック書き込み
001402 E135 AF               4      XOR A
001403 E136 322EE4          13      LD  (DRDN1),A   ;NOP
001406 E139 225AE3          16      LD  (RBSIZE),HL ;HL←書き込むレコード数
001409 E13C 225DF0          16      LD  (LEFTX),HL
00140C E13F CD29DC          17      CALL    SETDRV
                                
00140F E142 CDB2E2          17      CALL    RBX0
001412 E145 DAD2E1          10      JP  C,RBWERR
001415 E148 CDB1DF          17      CALL    WOPEN
001418 E14B DAD2E1          10      JP  C,RBWERR
00141B E14E 7C               4      LD  A,H
00141C E14F B5               4      OR  L
00141D E150 CACBE1          10      JP  Z,RBW1
                                
001420 E153 2B               6      DEC HL
                                
001421 E154 CD70E3          17      CALL    GET_RR_BCDE ;BCDE=Random record
                                
001424 E157 19              11      ADD HL,DE       ;BCHL=HL+BCDE
001425 E158 3001            12      JR  NC,S26X1    ;
001427 E15A 03               6      INC BC      ;
       E15B                     S26X1:
001428 E15B CD1CE0          17      CALL    RWXR
00142B E15E DCC2DF          17      CALL    C,WRDFX
00142E E161 DAD2E1          10      JP  C,RBWERR
                                
001431 E164 CDE1E2          17      CALL    RBX2
001434 E167 281A            12      JR  Z,RBWB      ;NZ=セクタ以下の端数がある
001436 E169 CD00E3          17      CALL    RBXA
001439 E16C 3864            12      JR  C,RBWERR
00143B E16E EB               4      EX  DE,HL
00143C E16F C5              11      PUSH    BC
00143D E170 EDB0                    LDIR
00143F E172 225FF0          16      LD  (DTAX),HL
                                
001442 E175 CD51DF          17      CALL    WTDB        ;バッファデータは更新された
                                
001445 E178 2A5DF0          16      LD  HL,(LEFTX)
001448 E17B D1              10      POP DE
001449 E17C ED52            15      SBC HL,DE
00144B E17E 225DF0          16      LD  (LEFTX),HL
00144E E181 2831            12      JR  Z,RBWEND
                                
       E183                     RBWB:
001450 E183 CD35E3          17      CALL    RBXB
001453 E186 2814            12      JR  Z,RBWC
       E188                     RBWB1:
001455 E188 C5              11      PUSH    BC
001456 E189 D5              11      PUSH    DE
001457 E18A CD32DE          17      CALL    CLUSTX
00145A E18D CD84E3          17      CALL    DWTC
00145D E190 D1              10      POP DE
00145E E191 C1              10      POP BC
00145F E192 D4ADE5          17      CALL    NC,GNCLX
001462 E195 383B            12      JR  C,RBWERR
001464 E197 10EF            13      DJNZ    RBWB1
001466 E199 CDD4E3          17      CALL    DRW_FLUSH
       E19C                     RBWC:
001469 E19C CD4DE3          17      CALL    RBXC
00146C E19F 2813            12      JR  Z,RBWEND
00146E E1A1 C5              11      PUSH    BC
00146F E1A2 CD32DE          17      CALL    CLUSTX
001472 E1A5 CD2DE4          17      CALL    DRDN
001475 E1A8 C1              10      POP BC
001476 E1A9 3827            12      JR  C,RBWERR
001478 E1AB ED5B7EF1        20      LD  DE,(_DTBUF)
00147C E1AF EDB0                    LDIR
00147E E1B1 CD51DF          17      CALL    WTDB        ;バッファデータは更新された
       E1B4                     RBWEND:
001481 E1B4 CD59E3          17      CALL    RBXEND
                                
001484 E1B7 CDC1E2          17      CALL    RBX1
001487 E1BA 300F            12      JR  NC,RBW1     ;ランダムレコードの方が大きい場合はサイズを合わせる
001489 E1BC CD70E3          17      CALL    GET_RR_BCDE ;BCDE=Random record
00148C E1BF FD7310          19      LD  (IY+16),E   ;ファイルのサイズ(バイト単位)
00148F E1C2 FD7211          19      LD  (IY+17),D   ;
001492 E1C5 FD7112          19      LD  (IY+18),C   ;
001495 E1C8 FD7013          19      LD  (IY+19),B   ;
       E1CB                     RBW1:
001498 E1CB FDE1            14      POP IY
00149A E1CD C1              10      POP BC
00149B E1CE D1              10      POP DE
00149C E1CF E1              10      POP HL
       E1D0                     DD_NUL:
00149D E1D0 AF               4      XOR A
       E1D1                     DRDF0:
       E1D1                     DWTF0:
00149E E1D1 C9              10      RET
                                
       E1D2                     RBWERR:
00149F E1D2 FDE5            15      PUSH    IY
0014A1 E1D4 D1              10      POP DE
0014A2 E1D5 2A20F1          16      LD  HL,(STABLE+2*010H)
0014A5 E1D8 CD0F00          17      CALL    JP_HL
       E1DB                     RBRERR1:
0014A8 E1DB 3E01             7      LD  A,001H
       E1DD                     RBRERR2:
0014AA E1DD FDE1            14      POP IY
0014AC E1DF C1              10      POP BC
0014AD E1E0 D1              10      POP DE
0014AE E1E1 E1              10      POP HL
0014AF E1E2 37               4      SCF
0014B0 E1E3 210000          10      LD  HL,0
0014B3 E1E6 C9              10      RET
                                
       E1E7                     RBRERR:
0014B4 E1E7 3EFF             7      LD  A,0FFH
0014B6 E1E9 18F2            12      JR  RBRERR2
                                
       E1EB                     RBRFL:
0014B8 E1EB 3E00             7  RBRFLP: LD  A,000H
0014BA E1ED FE0D             7      CP  00DH
0014BC E1EF 2005            12      JR  NZ,RBRFL1
0014BE E1F1 D5              11      PUSH    DE
0014BF E1F2 1E0A             7      LD  E,00AH
0014C1 E1F4 1805            12      JR  RBRFL2
       E1F6                     RBRFL1:
0014C3 E1F6 D5              11      PUSH    DE
0014C4 E1F7 CD09F0          17      CALL    _SYS07
0014C7 E1FA 5F               4      LD  E,A
       E1FB                     RBRFL2:
0014C8 E1FB CDCDF0          17      CALL    _PRINT
0014CB E1FE 7B               4      LD  A,E
0014CC E1FF D1              10      POP DE
0014CD E200 32ECE1          13      LD  (RBRFLP+1),A
0014D0 E203 C9              10      RET
       E204                     DDX:
0014D1 E204 FD7E01          19      LD  A,(IY+1)    ;(FCB)主ファイル名
0014D4 E207 CD57DE          17      CALL    CAP
0014D7 E20A FE41             7      CP  'A'
0014D9 E20C C9              10      RET
                                
                                                ;Read random block
       E20D                     _SYS27:     ;(BDOS)ランダムブロック読み込み
0014DA E20D 225DF0          16      LD  (LEFTX),HL
0014DD E210 CD29DC          17      CALL    SETDRV
                                
0014E0 E213 FDCB0D66        20      BIT 4,(IY+13)   ;(FCB)属性(アトリビュート)
0014E4 E217 C2A0E2          10      JP  NZ,RBRDIR   ;ディレクトリ
0014E7 E21A CDB2E2          17      CALL    RBX0
0014EA E21D DAE7E1          10      JP  C,RBRERR
0014ED E220 CDC1E2          17      CALL    RBX1
0014F0 E223 D4D9E2          17      CALL    NC,RBX1R
0014F3 E226 DADBE1          10      JP  C,RBRERR1
0014F6 E229 EB               4      EX  DE,HL
0014F7 E22A ED52            15      SBC HL,DE       ;CP 00HL,BCDE
0014F9 E22C 19              11      ADD HL,DE
0014FA E22D 79               4      LD  A,C
0014FB E22E DE00             7      SBC A,0
0014FD E230 78               4      LD  A,B
0014FE E231 DE00             7      SBC A,0
001500 E233 3801            12      JR  C,RBR1
001502 E235 EB               4      EX  DE,HL
       E236                     RBR1:
001503 E236 9F               4      SBC A,A
001504 E237 E601             7      AND 1
001506 E239 329EE2          13      LD  (RBRA_SWC),A
                                
001509 E23C 7C               4      LD  A,H
00150A E23D B5               4      OR  L
00150B E23E 2857            12      JR  Z,RBREND0
                                
00150D E240 225AE3          16      LD  (RBSIZE),HL ;HL←読み込むレコード数
001510 E243 225DF0          16      LD  (LEFTX),HL
                                
001513 E246 CDE1E2          17      CALL    RBX2
001516 E249 2819            12      JR  Z,RBRB
001518 E24B CD00E3          17      CALL    RBXA
00151B E24E DAE7E1          10      JP  C,RBRERR
00151E E251 C5              11      PUSH    BC
00151F E252 EDB0                    LDIR
001521 E254 ED535FF0        20      LD  (DTAX),DE
001525 E258 2A5DF0          16      LD  HL,(LEFTX)
001528 E25B D1              10      POP DE
001529 E25C A7               4      AND A
00152A E25D ED52            15      SBC HL,DE
00152C E25F 225DF0          16      LD  (LEFTX),HL
00152F E262 2830            12      JR  Z,RBREND
                                
       E264                     RBRB:
001531 E264 CD35E3          17      CALL    RBXB
001534 E267 2815            12      JR  Z,RBRC
       E269                     RBRB1:
001536 E269 C5              11      PUSH    BC
001537 E26A D5              11      PUSH    DE
001538 E26B CD32DE          17      CALL    CLUSTX
00153B E26E CD8AE3          17      CALL    DRDC
00153E E271 D1              10      POP DE
00153F E272 C1              10      POP BC
001540 E273 D4ADE5          17      CALL    NC,GNCLX
001543 E276 DAE7E1          10      JP  C,RBRERR
001546 E279 10EE            13      DJNZ    RBRB1
001548 E27B CDD4E3          17      CALL    DRW_FLUSH
       E27E                     RBRC:
00154B E27E CD4DE3          17      CALL    RBXC
00154E E281 2811            12      JR  Z,RBREND
001550 E283 C5              11      PUSH    BC
001551 E284 CD32DE          17      CALL    CLUSTX
001554 E287 CD11E4          17      CALL    DRDX
001557 E28A C1              10      POP BC
001558 E28B DAE7E1          10      JP  C,RBRERR
00155B E28E EB               4      EX  DE,HL
00155C E28F 2A7EF1          16      LD  HL,(_DTBUF)
00155F E292 EDB0                    LDIR
       E294                     RBREND:
001561 E294 CD59E3          17      CALL    RBXEND
       E297                     RBREND0:
001564 E297 FDE1            14      POP IY
001566 E299 C1              10      POP BC
001567 E29A D1              10      POP DE
001568 E29B F1              10      POP AF  ;(HL)
001569 E29C AF               4      XOR A
00156A E29D 3E00             7      LD  A,000H
       E29E                     RBRA_SWC    EQU $-1
00156C E29F C9              10      RET
                                
       E2A0                     RBRDIR:
00156D E2A0 FD6E1A          19      LD  L,(IY+26)   ;(FCB)ファイルの先頭クラスタ
001570 E2A3 FD661B          19      LD  H,(IY+27)
001573 E2A6 CD6DDE          17      CALL    CHDIR
001576 E2A9 AF               4      XOR A
001577 E2AA 67               4      LD  H,A
001578 E2AB 6F               4      LD  L,A
001579 E2AC 3C               4      INC A
00157A E2AD 329EE2          13      LD  (RBRA_SWC),A
00157D E2B0 18E5            12      JR  RBREND0
                                
       E2B2                     RBX0:
00157F E2B2 2A8AF0          16      LD  HL,(_DTA)
001582 E2B5 225FF0          16      LD  (DTAX),HL
001585 E2B8 2A5DF0          16      LD  HL,(LEFTX)
001588 E2BB FD7E1C          19      LD  A,(IY+28)   ;(FCB)オープンモード
00158B E2BE D6FD             7      SUB 0FDH
00158D E2C0 C9              10      RET
                                
       E2C1                     RBX1:               ;ファイルサイズとランダムレコードを比べる
00158E E2C1 E5              11      PUSH    HL      ;Record byte
                                                ;AHL=File size
00158F E2C2 FD6E10          19      LD  L,(IY+16)   ;ファイルのサイズ(バイト単位)
001592 E2C5 FD6611          19      LD  H,(IY+17)   ;
001595 E2C8 FD7E12          19      LD  A,(IY+18)   ;
                                
001598 E2CB CD70E3          17      CALL    GET_RR_BCDE ;BCDE=Random record
                                
00159B E2CE A7               4      AND A
00159C E2CF ED52            15      SBC HL,DE
00159E E2D1 99               4      SBC A,C
00159F E2D2 4F               4      LD  C,A
0015A0 E2D3 FD7E13          19      LD  A,(IY+19)   ;ファイルのサイズ
0015A3 E2D6 98               4      SBC A,B
0015A4 E2D7 D1              10      POP DE
0015A5 E2D8 C9              10      RET
       E2D9                     RBX1R:
0015A6 E2D9 47               4      LD  B,A
0015A7 E2DA B1               4      OR  C
0015A8 E2DB EB               4      EX  DE,HL   ;BCDE=File byte HL=Record byte
0015A9 E2DC B2               4      OR  D
0015AA E2DD B3               4      OR  E
0015AB E2DE C0              11      RET NZ
0015AC E2DF 37               4      SCF
0015AD E2E0 C9              10      RET
                                
       E2E1                     RBX2:               ;Cluster settings
0015AE E2E1 FD6622          19      LD  H,(IY+34)   ;(+33)(FCB)ランダムレコード
0015B1 E2E4 FD4E23          19      LD  C,(IY+35)
0015B4 E2E7 0600             7      LD  B,0
0015B6 E2E9 FDCB207E        20      BIT 7,(IY+32)   ;(FCB)カレントレコード
0015BA E2ED 2003            12      JR  NZ,RBX3
0015BC E2EF FD4624          19      LD  B,(IY+36)
       E2F2                     RBX3:
0015BF E2F2 CD1CE0          17      CALL    RWXR
0015C2 E2F5 3A17E3          13      LD  A,(SECSZ+2) ;1024=4 / 512=2 / 256=1
0015C5 E2F8 3D               4      DEC A
0015C6 E2F9 FDA622          19      AND (IY+34)
0015C9 E2FC FDB621          19      OR  (IY+33)
0015CC E2FF C9              10      RET
                                
       E300                     RBXA:
0015CD E300 C5              11      PUSH    BC
0015CE E301 D5              11      PUSH    DE
0015CF E302 CD32DE          17      CALL    CLUSTX
0015D2 E305 CD11E4          17      CALL    DRDX
0015D5 E308 D1              10      POP DE
0015D6 E309 C1              10      POP BC
0015D7 E30A D4ADE5          17      CALL    NC,GNCLX
0015DA E30D D8              11      RET C
0015DB E30E ED53FEF1        20      LD  (_CLPS),DE
                                
0015DF E312 FD4E21          19      LD  C,(IY+33)   ;(FCB)ランダムレコード
0015E2 E315 210004          10  SECSZ:  LD  HL,0400H    ;自己書き換え 1024=0400H / 512=0200H ここに1セクタのサイズが格納される
0015E5 E318 7C               4      LD  A,H
0015E6 E319 3D               4      DEC A       ;1024=3 / 512=1
0015E7 E31A FDA622          19      AND (IY+34)     ;(FCB)ランダムレコード
0015EA E31D 47               4      LD  B,A     ;BCに1セクタ以下の端数が入る
0015EB E31E ED42            15      SBC HL,BC       ;残りを計算
                                
0015ED E320 ED5B5DF0        20      LD  DE,(LEFTX)
0015F1 E324 ED52            15      SBC HL,DE       ;CP HL,DE
0015F3 E326 19              11      ADD HL,DE       ;
0015F4 E327 3801            12      JR  C,RBXA1     ;DEとHLを比較して大きい方をHLに
0015F6 E329 EB               4      EX  DE,HL
       E32A                     RBXA1:
0015F7 E32A E5              11      PUSH    HL
0015F8 E32B 2A7EF1          16      LD  HL,(_DTBUF)
0015FB E32E 09              11      ADD HL,BC
0015FC E32F ED5B5FF0        20      LD  DE,(DTAX)
001600 E333 C1              10      POP BC
001601 E334 C9              10      RET
                                
       E335                     RBXB:
001602 E335 2A5FF0          16      LD  HL,(DTAX)
001605 E338 ED5BFEF1        20      LD  DE,(_CLPS)
001609 E33C 3A5EF0          13      LD  A,(LEFTX+1)
00160C E33F 47               4      LD  B,A
00160D E340 3A17E3          13      LD  A,(SECSZ+2) ;1024=4 / 512=2 / 256=1
       E343                     RBXB1:
001610 E343 1F               4      RRA     ;->CF
001611 E344 3804            12      JR  C,RBXB2
001613 E346 CB38             8      SRL B   ;B=B/2
001615 E348 18F9            12      JR  RBXB1
       E34A                     RBXB2:
001617 E34A 78               4      LD  A,B
001618 E34B B7               4      OR  A
001619 E34C C9              10      RET
                                
       E34D                     RBXC:
00161A E34D ED4B5DF0        20      LD  BC,(LEFTX)
00161E E351 3A17E3          13      LD  A,(SECSZ+2) ;1024=4 / 512=2 / 256=1
001621 E354 3D               4      DEC A
001622 E355 A0               4      AND B
001623 E356 47               4      LD  B,A     ;1セクタ以下の端数がない場合はZ
001624 E357 B1               4      OR  C
001625 E358 C9              10      RET
                                
       E359                     RBXEND:             ;レコード数だけランダムレコードを進める
001626 E359 110000          10      LD  DE,0        ;進めるレコード数(RBSIZE)
       E35A                     RBSIZE  EQU $-2
001629 E35C CDCBE0          17      CALL    GET_RR_AHL
00162C E35F 19              11      ADD HL,DE
00162D E360 CE00             7      ADC A,0
00162F E362 CDEDE3          17      CALL    SET_RR_AHL
001632 E365 EB               4      EX  DE,HL       ;HL=進めるレコード数
001633 E366 D0              11      RET NC
001634 E367 FDCB207E        20      BIT 7,(IY+32)   ;(FCB)カレントレコード
001638 E36B C0              11      RET NZ
001639 E36C FD3424          23      INC (IY+36)
00163C E36F C9              10      RET
                                
       E370                     GET_RR_BCDE:            ;BCDE=Random record
00163D E370 FD5E21          19      LD  E,(IY+33)   ;(FCB)ランダムレコード
001640 E373 FD5622          19      LD  D,(IY+34)
001643 E376 FD4E23          19      LD  C,(IY+35)
001646 E379 0600             7      LD  B,0     ;CP/M互換のアクセスの場合はFCBは36バイト
001648 E37B FDCB207E        20      BIT 7,(IY+32)   ;(FCB)カレントレコード
00164C E37F C0              11      RET NZ
00164D E380 FD4624          19      LD  B,(IY+36)
001650 E383 C9              10      RET
                                
                                ;   ランダムブロックアクセスの連続したセクタをまとめる
                                
       E384                     DWTC:
001651 E384 E5              11      PUSH    HL
001652 E385 2148E7          10      LD  HL,DWT24B
001655 E388 1804            12      JR  DWTC1
       E38A                     DRDC:
001657 E38A E5              11      PUSH    HL
001658 E38B 2138E7          10      LD  HL,DRD24B
       E38E                     DWTC1:
00165B E38E 22E8E3          16      LD  (DRWF_MODE),HL
00165E E391 E1              10      POP HL
00165F E392 3AD8E3          13      LD  A,(DRWF_B)
001662 E395 B7               4      OR  A
001663 E396 200F            12      JR  NZ,DRDC1
       E398                     SAVE_DRWC:
001665 E398 0601             7      LD  B,1
001667 E39A ED43D7E3        20      LD  (DRWF_C),BC
00166B E39E ED53DEE3        20      LD  (DRWF_E),DE
00166F E3A2 22E1E3          16      LD  (DRWF_HL),HL
001672 E3A5 1820            12      JR  INC_HL_DRWC
       E3A7                     DRDC1:
001674 E3A7 E5              11      PUSH    HL
001675 E3A8 21DEE3          10      LD  HL,DRWF_E
001678 E3AB 86               7      ADD A,(HL)
001679 E3AC F5              11      PUSH    AF
00167A E3AD BB               4      CP  E
00167B E3AE 201D            12      JR  NZ,DRDC2
00167D E3B0 F1              10      POP AF
00167E E3B1 23               6      INC HL
00167F E3B2 7E               7      LD  A,(HL)
001680 E3B3 CE00             7      ADC A,0
001682 E3B5 F5              11      PUSH    AF
001683 E3B6 BA               4      CP  D
001684 E3B7 2014            12      JR  NZ,DRDC2
001686 E3B9 F1              10      POP AF
001687 E3BA 3AD7E3          13      LD  A,(DRWF_C)
00168A E3BD CE00             7      ADC A,0
00168C E3BF B9               4      CP  C
00168D E3C0 200C            12      JR  NZ,DRDC3
00168F E3C2 21D8E3          10      LD  HL,DRWF_B
001692 E3C5 34              11      INC (HL)
001693 E3C6 E1              10      POP HL
       E3C7                     INC_HL_DRWC:
001694 E3C7 3A17E3          13      LD  A,(SECSZ+2)     ;1セクタのサイズの上位1バイト
001697 E3CA 84               4      ADD A,H
001698 E3CB 67               4      LD  H,A
001699 E3CC C9              10      RET
       E3CD                     DRDC2:
00169A E3CD F1              10      POP AF
       E3CE                     DRDC3:
00169B E3CE CDD4E3          17      CALL    DRW_FLUSH
00169E E3D1 E1              10      POP HL
00169F E3D2 18C4            12      JR  SAVE_DRWC
                                
                                ;   ランダムブロックアクセスの連続したセクタをまとめたものをフラッシュする
       E3D4                     DRW_FLUSH:
0016A1 E3D4 C5              11      PUSH    BC
0016A2 E3D5 D5              11      PUSH    DE
0016A3 E3D6 010000          10      LD  BC,0
       E3D7                     DRWF_C  EQU $-2
       E3D8                     DRWF_B  EQU $-1
0016A6 E3D9 78               4      LD  A,B
0016A7 E3DA B7               4      OR  A
0016A8 E3DB 280D            12      JR  Z,DRDF1
0016AA E3DD 110000          10      LD  DE,0
       E3DE                     DRWF_E  EQU $-2
       E3DF                     DRWF_D  EQU $-1
0016AD E3E0 210000          10      LD  HL,0
       E3E1                     DRWF_HL EQU $-2
0016B0 E3E3 AF               4      XOR A
0016B1 E3E4 32D8E3          13      LD  (DRWF_B),A
0016B4 E3E7 CD38E7          17      CALL    DRD24B
       E3E8                     DRWF_MODE   EQU $-2
       E3EA                     DRDF1:
0016B7 E3EA D1              10      POP DE
0016B8 E3EB C1              10      POP BC
0016B9 E3EC C9              10      RET
                                
       E3ED                     SET_RR_AHL:
0016BA E3ED FD7521          19      LD  (IY+33),L   ;(FCB)Random record
0016BD E3F0 FD7422          19      LD  (IY+34),H
0016C0 E3F3 FD7723          19      LD  (IY+35),A
0016C3 E3F6 C9              10      RET
                                
       E3F7                     SETSEQ1:
0016C4 E3F7 F5              11      PUSH    AF
0016C5 E3F8 E5              11      PUSH    HL      ;AHL=Random record
0016C6 E3F9 CDCBE0          17      CALL    GET_RR_AHL
0016C9 E3FC 47               4      LD  B,A     ;AHL→HLA
0016CA E3FD 7D               4      LD  A,L     ;(IY+33)(FCB)ランダムレコード
0016CB E3FE 6C               4      LD  L,H     ;(IY+34)
0016CC E3FF 60               4      LD  H,B     ;(IY+35)
0016CD E400 0600             7      LD  B,0
                                
0016CF E402 CDB5E0          17      CALL    GET_CPM_R_SIZE
                                
0016D2 E405 29              11      ADD HL,HL
0016D3 E406 CB3D             8      SRL L       ;L=L/2
0016D5 E408 FD7520          19      LD  (IY+32),L   ;(FCB)カレントレコード
0016D8 E40B FD740C          19      LD  (IY+12),H   ;(FCB)カレントブロック
0016DB E40E E1              10      POP HL
0016DC E40F F1              10      POP AF
0016DD E410 C9              10      RET
[EOF:LDFILE2.ASM:SHIFT_JIS]
                                    INCLUDE "LDDIO.ASM"
                                
                                ;   LSX-Dodgers DIO
                                
       E411                     DRDX:
0016DE E411 CD4FE4          17      CALL    DRDY
0016E1 E414 C8              11      RET Z
0016E2 E415 CD35E4          17      CALL    DRDX1       ;データバッファの情報を保存
0016E5 E418 D8              11      RET C
0016E6 E419 E5              11      PUSH    HL
0016E7 E41A C5              11      PUSH    BC
0016E8 E41B D5              11      PUSH    DE
0016E9 E41C 2A7EF1          16      LD  HL,(_DTBUF)
0016EC E41F 3A78E4          13      LD  A,(_DBS24)
0016EF E422 4F               4      LD  C,A
0016F0 E423 CD36E7          17      CALL    DRD24
0016F3 E426 DC4AE4          17      CALL    C,DRDNE
       E429                     POP_DE_BC_HL_RET:
0016F6 E429 D1              10      POP DE
0016F7 E42A C1              10      POP BC
0016F8 E42B E1              10      POP HL
0016F9 E42C C9              10      RET
                                
                                ;   CDE:セクタ番号
       E42D                     DRDN:
0016FA E42D AF               4      XOR A
0016FB E42E 00               4  DRDN1:  NOP         ;自己書き換え NOP / SCF
0016FC E42F 30E0            12      JR  NC,DRDX
       E431                     DRDNX:
0016FE E431 CD4FE4          17      CALL    DRDY
001701 E434 C8              11      RET Z
       E435                     DRDX1:
001702 E435 CD65E4          17      CALL    DWTX
                                                ;データバッファの読み込んだドライブ・セクタ情報を保存
001705 E438 ED53A6F0        20      LD  (_DBSEC),DE
001709 E43C 79               4      LD  A,C
00170A E43D 3278E4          13      LD  (_DBS24),A
                                
00170D E440 3A88F0          13      LD  A,(_DRV)
001710 E443 32A5F0          13      LD  (_DBDRV),A
001713 E446 CDD9F0          17      CALL    _CHGDRV
001716 E449 D0              11      RET NC
       E44A                     DRDNE:
001717 E44A 9F               4      SBC A,A     ;CF=1ならばA=0FFH
001718 E44B 32A5F0          13      LD  (_DBDRV),A
00171B E44E C9              10      RET
                                
                                ;   CDE:セクタ番号
       E44F                     DRDY:
00171C E44F 3A78E4          13      LD  A,(_DBS24)
00171F E452 B9               4      CP  C
001720 E453 C0              11      RET NZ
                                
001721 E454 E5              11      PUSH    HL
001722 E455 3A88F0          13      LD  A,(_DRV)
001725 E458 21A5F0          10      LD  HL,_DBDRV
001728 E45B AE               7      XOR (HL)
001729 E45C 2005            12      JR  NZ,POP_HL_RET
                                
00172B E45E 2AA6F0          16      LD  HL,(_DBSEC)
00172E E461 ED52            15      SBC HL,DE       ;上でXORを使っているのでCF=0のはず
       E463                     POP_HL_RET:
001730 E463 E1              10      POP HL
001731 E464 C9              10      RET
                                
       E465                     DWTX:
001732 E465 3AA4F0          13      LD  A,(_WTDBF)
001735 E468 B7               4      OR  A
001736 E469 C8              11      RET Z
001737 E46A AF               4      XOR A
001738 E46B 32A4F0          13      LD  (_WTDBF),A
                                
00173B E46E E5              11      PUSH    HL
00173C E46F C5              11      PUSH    BC
00173D E470 D5              11      PUSH    DE
00173E E471 3AA5F0          13      LD  A,(_DBDRV)
001741 E474 CDD9F0          17      CALL    _CHGDRV
001744 E477 0E00             7      LD  C,0
       E478                     _DBS24  EQU $-1
001746 E479 ED5BA6F0        20      LD  DE,(_DBSEC)
00174A E47D 2A7EF1          16      LD  HL,(_DTBUF)
00174D E480 D446E7          17      CALL    NC,DWT24
       E483                     POP_DE_BC_HL_RET2:
001750 E483 18A4            12      JR  POP_DE_BC_HL_RET
                                
       E485                     RDFATX:
001752 E485 E5              11      PUSH    HL
001753 E486 3A88F0          13      LD  A,(_DRV)
001756 E489 21AAF0          10      LD  HL,_FATDRV
001759 E48C AE               7      XOR (HL)
00175A E48D 28D4            12      JR  Z,POP_HL_RET
                                
00175C E48F C5              11      PUSH    BC
00175D E490 D5              11      PUSH    DE
00175E E491 DDE5            15      PUSH    IX
001760 E493 CDAFE4          17      CALL    WTFATX
001763 E496 3813            12      JR  C,POP_IX_DE_BC_HL_RET
                                
001765 E498 AF               4      XOR A
001766 E499 32ABF0          13      LD  (_FATIX),A
001769 E49C 3A88F0          13      LD  A,(_DRV)
00176C E49F 32AAF0          13      LD  (_FATDRV),A
00176F E4A2 CDE5F0          17      CALL    _RDFAT
       E4A5                     RDFATE2:
001772 E4A5 3004            12      JR  NC,POP_IX_DE_BC_HL_RET
001774 E4A7 9F               4      SBC A,A     ;A=0xFF
001775 E4A8 32AAF0          13      LD  (_FATDRV),A
       E4AB                     POP_IX_DE_BC_HL_RET:
001778 E4AB DDE1            14      POP IX
00177A E4AD 18D4            12      JR  POP_DE_BC_HL_RET2
                                
       E4AF                     WTFATX:
00177C E4AF 3AA2F0          13      LD  A,(_WTFATF)
00177F E4B2 B7               4      OR  A
001780 E4B3 C8              11      RET Z
001781 E4B4 E5              11      PUSH    HL
001782 E4B5 3AAAF0          13      LD  A,(_FATDRV)
001785 E4B8 21A5F0          10      LD  HL,_DBDRV
001788 E4BB AE               7      XOR (HL)
001789 E4BC CC65E4          17      CALL    Z,DWTX
00178C E4BF 38A2            12      JR  C,POP_HL_RET
00178E E4C1 C5              11      PUSH    BC
00178F E4C2 D5              11      PUSH    DE
001790 E4C3 DDE5            15      PUSH    IX
001792 E4C5 CD53E7          17      CALL    WTFAT
001795 E4C8 AF               4      XOR A
001796 E4C9 32A2F0          13      LD  (_WTFATF),A
001799 E4CC 18DD            12      JR  POP_IX_DE_BC_HL_RET
                                
       E4CE                     N16CL1:
00179B E4CE 7A               4      LD  A,D
00179C E4CF B3               4      OR  E
00179D E4D0 37               4      SCF
00179E E4D1 C8              11      RET Z
                                
00179F E4D2 7A               4      LD  A,D
0017A0 E4D3 1807            12      JR  NCL1X
       E4D5                     NCL1:
0017A2 E4D5 7A               4      LD  A,D
0017A3 E4D6 B3               4      OR  E
0017A4 E4D7 37               4      SCF
0017A5 E4D8 C8              11      RET Z
                                
0017A6 E4D9 7A               4      LD  A,D
0017A7 E4DA CB3F             8      SRL A   ;/2
       E4DC                     NCL1X:
0017A9 E4DC CB3F             8      SRL A   ;/2
                                
0017AB E4DE E5              11      PUSH    HL
0017AC E4DF 32FEE4          13      LD  (NCLPAT_FATIX),A    ;_FATIX
0017AF E4E2 2AAAF0          16      LD  HL,(_FATDRV)    ;L=_FATDRV H=_FATIX
0017B2 E4E5 BC               4      CP  H
0017B3 E4E6 3A88F0          13      LD  A,(_DRV)    ;LDではフラグは変化しない
0017B6 E4E9 32FDE4          13      LD  (NCLPAT_FATDRV),A   ;_FATDRV
0017B9 E4EC 2005            12      JR  NZ,NCL2     ;FATIXが違う
0017BB E4EE BD               4      CP  L
0017BC E4EF 2002            12      JR  NZ,NCL2     ;ドライブが違う
0017BE E4F1 E1              10      POP HL
0017BF E4F2 C9              10      RET
       E4F3                     NCL2:
0017C0 E4F3 C5              11      PUSH    BC
0017C1 E4F4 D5              11      PUSH    DE
0017C2 E4F5 DDE5            15      PUSH    IX
0017C4 E4F7 CDAFE4          17      CALL    WTFATX
0017C7 E4FA 38AF            12      JR  C,POP_IX_DE_BC_HL_RET
0017C9 E4FC 010000          10      LD  BC,0        ;自己書き換え C=_FATDRV B=_FATIX
       E4FE                     NCLPAT_FATIX    EQU $-1
       E4FD                     NCLPAT_FATDRV   EQU $-2
0017CC E4FF ED43AAF0        20      LD  (_FATDRV),BC
0017D0 E503 CD28E7          17      CALL    RDFATS
0017D3 E506 189D            12      JR  RDFATE2
                                
       E508                     NCL3:
0017D5 E508 CB9A             8      RES 3,D
0017D7 E50A CB92             8      RES 2,D
0017D9 E50C 6B               4      LD  L,E
0017DA E50D 62               4      LD  H,D
0017DB E50E CB3C             8      SRL H   ;
0017DD E510 CB1D             8      RR  L   ;HLA=HLA/2
0017DF E512 1F               4      RRA     ;
0017E0 E513 F5              11      PUSH    AF
0017E1 E514 3AABF0          13      LD  A,(_FATIX)
0017E4 E517 0F               4      RRCA
0017E5 E518 300B            12      JR  NC,NCL3X1
0017E7 E51A 3A17E3          13      LD  A,(SECSZ+2)
0017EA E51D FE04             7      CP  4       ;1セクタ1024バイトの場合は奇数インデックスの場合に先頭を512バイトずらす
0017EC E51F 2004            12      JR  NZ,NCL3X1
0017EE E521 010002          10      LD  BC,512
0017F1 E524 09              11      ADD HL,BC
       E525                     NCL3X1:
0017F2 E525 F1              10      POP AF
0017F3 E526 ED4B7CF1        20      LD  BC,(_FATBF)
0017F7 E52A 19              11      ADD HL,DE
0017F8 E52B 09              11      ADD HL,BC
0017F9 E52C 17               4      RLA
0017FA E52D C9              10      RET
                                
       E52E                     GNCL:
0017FB E52E CDD5E4          17      CALL    NCL1        ;GET NEXT CLUSTER
0017FE E531 D8              11      RET C
0017FF E532 C5              11      PUSH    BC
001800 E533 E5              11      PUSH    HL
001801 E534 CD08E5          17      CALL    NCL3
001804 E537 3809            12      JR  C,GNC1
001806 E539 5E               7      LD  E,(HL)
001807 E53A 23               6      INC HL
001808 E53B 7E               7      LD  A,(HL)
001809 E53C E60F             7      AND 00FH
00180B E53E 57               4      LD  D,A
00180C E53F E1              10      POP HL
00180D E540 C1              10      POP BC
00180E E541 C9              10      RET
       E542                     GNC1:
00180F E542 7E               7      LD  A,(HL)
001810 E543 23               6      INC HL
001811 E544 56               7      LD  D,(HL)
001812 E545 0604             7      LD  B,4
       E547                     GNC1L:
001814 E547 CB3A             8      SRL D   ;DA=DA/2
001816 E549 1F               4      RRA     ;
001817 E54A 10FB            13      DJNZ    GNC1L
                                
001819 E54C 5F               4      LD  E,A
00181A E54D E1              10      POP HL
00181B E54E C1              10      POP BC
00181C E54F A7               4      AND A
00181D E550 C9              10      RET
                                
       E551                     SNCL:
00181E E551 CDD5E4          17      CALL    NCL1
001821 E554 D8              11      RET C
                                ;               SET NEXT CLUSTER
001822 E555 E5              11      PUSH    HL
001823 E556 C5              11      PUSH    BC
001824 E557 D5              11      PUSH    DE
001825 E558 E5              11      PUSH    HL
001826 E559 CD08E5          17      CALL    NCL3
001829 E55C D1              10      POP DE
                                ;CF=ODD
00182A E55D 7E               7      LD  A,(HL)
00182B E55E 73               7      LD  (HL),E
00182C E55F 3806            12      JR  C,SNC1
                                ;EVEN
                                ;M[0] = E
                                ;M[1] = (M[1] & 0xF0) | (D & 0x0F)
00182E E561 23               6      INC HL
00182F E562 ED67            18      RRD     ;M={A[3:0],E[3:0]}
001831 E564 7A               4      LD  A,D
001832 E565 1804            12      JR  SNC11
       E567                     SNC1:
                                ;ODD
                                ;HL[0] = (HL[0]&0x0F) | (E<<4)
                                ;HL[1] = DE>>4
001834 E567 ED6F            18      RLD     ;M={D[3:0],E[7:4]}
001836 E569 23               6      INC HL
001837 E56A 72               7      LD  (HL),D  ;M={D[3:0],E[7:4]}
       E56B                     SNC11:
001838 E56B ED6F            18      RLD     ;M={M[7:4],D[3:0]}
00183A E56D B7               4      OR  A
00183B E56E D1              10      POP DE
00183C E56F C1              10      POP BC
00183D E570 E1              10      POP HL
       E571                     FAT_CHANGED:
00183E E571 3E01             7      LD  A,1
001840 E573 32A2F0          13      LD  (_WTFATF),A
001843 E576 C9              10      RET
                                
       E577                     N16CL3:
001844 E577 C5              11      PUSH    BC
001845 E578 6B               4      LD  L,E
001846 E579 7A               4      LD  A,D
001847 E57A E601             7      AND 1
001849 E57C 67               4      LD  H,A
00184A E57D 29              11      ADD HL,HL
00184B E57E ED4B7CF1        20      LD  BC,(_FATBF)
00184F E582 09              11      ADD HL,BC
001850 E583 C1              10      POP BC
001851 E584 C9              10      RET
                                
       E585                     GNCL16:
001852 E585 CDCEE4          17      CALL    N16CL1      ;GET NEXT CLUSTER for FAT16
001855 E588 D8              11      RET C
001856 E589 E5              11      PUSH    HL
001857 E58A CD77E5          17      CALL    N16CL3
00185A E58D 5E               7      LD  E,(HL)
00185B E58E 23               6      INC HL
00185C E58F 56               7      LD  D,(HL)
00185D E590 E1              10      POP HL
00185E E591 C9              10      RET
                                
       E592                     SNCL16:
00185F E592 CDCEE4          17      CALL    N16CL1      ;GET NEXT CLUSTER for FAT16
001862 E595 D8              11      RET C
001863 E596 D5              11      PUSH    DE
001864 E597 E5              11      PUSH    HL
001865 E598 CD77E5          17      CALL    N16CL3
001868 E59B D1              10      POP DE      ;HL
001869 E59C 73               7      LD  (HL),E
00186A E59D 23               6      INC HL
00186B E59E 72               7      LD  (HL),D
00186C E59F 6B               4      LD  L,E
00186D E5A0 62               4      LD  H,D
00186E E5A1 D1              10      POP DE
00186F E5A2 18CD            12      JR  FAT_CHANGED
                                
                                ;------------------------
                                ;次のセクタを探す際に_SECPSの値をチェック
                                ;in
                                ;   DE : セクタ番号
                                ;out
                                ;   DE : 次のセクタ番号
                                ;note
                                ;
                                ;------------------------
       E5A4                     NEXTX:
001871 E5A4 3E00             7      LD  A,0 ;自己書き換え
       E5A5                     _SECPS  EQU $-1
001873 E5A6 3C               4      INC A
001874 E5A7 E600             7      AND 0   ;自己書き換え　1クラスタの論理セクタ数-1
       E5A8                     _NCPAT  EQU $-1
001876 E5A9 32A5E5          13      LD  (_SECPS),A
001879 E5AC C9              10      RET
                                
       E5AD                     GNCLX:
00187A E5AD CDA4E5          17      CALL    NEXTX
00187D E5B0 C0              11      RET NZ  ;1クラスタのセクタ未満の場合は戻る
00187E E5B1 C3F7F0          10      JP  _GNCL   ;次のクラスタを探す
                                
       E5B4                     RDFAT:
001881 E5B4 3E80             7      LD  A,080H
001883 E5B6 3270F0          13      LD  (CHECK),A
       E5B9                     RDFAT1:
001886 E5B9 3A88F0          13      LD  A,(_DRV)
001889 E5BC CD62E8          17      CALL    CHGDRVR
00188C E5BF D8              11      RET C
00188D E5C0 DD7E12          19      LD  A,(IX+DPB_DEVICE)
001890 E5C3 CB6F             8      BIT 5,A
001892 E5C5 286C            12      JR  Z,RDFAT0X
001894 E5C7 2170F0          10      LD  HL,CHECK
001897 E5CA A6               7      AND (HL)
001898 E5CB 77               7      LD  (HL),A
001899 E5CC 110000          10      LD  DE,0        ;BPB
00189C E5CF 2A7CF1          16      LD  HL,(_FATBF)
00189F E5D2 CD34E7          17      CALL    DRD16
0018A2 E5D5 3024            12      JR  NC,GETBPB
0018A4 E5D7 2170F0          10      LD  HL,CHECK
0018A7 E5DA CB06            15      RLC (HL)
0018A9 E5DC 3F               4      CCF
0018AA E5DD D8              11      RET C
0018AB E5DE DDCB0A1E        23      RR  (IX+DPB_FDMODE)
0018AF E5E2 3F               4      CCF         ;フロッピーディスクのFDモードを切り替える
0018B0 E5E3 DDCB0A16        23      RL  (IX+DPB_FDMODE)
0018B4 E5E7 3EFF             7      LD  A,0FFH
0018B6 E5E9 3289F0          13      LD  (_DSK),A
0018B9 E5EC 3A84F0          13      LD  A,(_DRIVE)
0018BC E5EF E603             7      AND 3
0018BE E5F1 F680             7      OR  080H
0018C0 E5F3 6F               4      LD  L,A
0018C1 E5F4 26F0             7      LD  H,_CYL0/256
0018C3 E5F6 3EFF             7      LD  A,0FFH
0018C5 E5F8 77               7      LD  (HL),A
0018C6 E5F9 18BE            12      JR  RDFAT1
       E5FB                     GETBPB:
0018C8 E5FB FDE5            15      PUSH    IY
0018CA E5FD FD2A7CF1        20      LD  IY,(_FATBF) ;BPB
0018CE E601 CDF1F0          17      CALL    _BPB2DPB
0018D1 E604 FDE1            14      POP IY
0018D3 E606 DD7E12          19      LD  A,(IX+DPB_DEVICE)
0018D6 E609 3025            12      JR  NC,GETBPBOK
0018D8 E60B E60F             7      AND 00FH
0018DA E60D FE07             7      CP  7
0018DC E60F 37               4      SCF
0018DD E610 C0              11      RET NZ
0018DE E611 DDCB0A46        20      BIT 0,(IX+DPB_FDMODE)
0018E2 E615 21C0F1          10      LD  HL,M2D
0018E5 E618 2006            12      JR  NZ,SETFDMODE
0018E7 E61A CD0DE7          17      CALL    CHECK1024
0018EA E61D D8              11      RET C
0018EB E61E 2ED2             7      LD  L,M2HD-STABLE
       E620                     SETFDMODE:
0018ED E620 DDE5            15      PUSH    IX
0018EF E622 D1              10      POP DE
0018F0 E623 EDA0            16      LDI
0018F2 E625 EDA0            16      LDI
0018F4 E627 13               6      INC DE
0018F5 E628 13               6      INC DE
0018F6 E629 13               6      INC DE
0018F7 E62A 13               6      INC DE
0018F8 E62B 010C00          10      LD  BC,12
0018FB E62E EDB0                    LDIR
       E630                     GETBPBOK:
0018FD E630 CDCEE7          17      CALL    CHGDRV2
       E633                     RDFAT0X:
001900 E633 CD28E7          17      CALL    RDFATS
001903 E636 D8              11      RET C
001904 E637 DDAE06          19      XOR (IX+DPB_FATID)
001907 E63A C8              11      RET Z
001908 E63B DD7E12          19      LD  A,(IX+DPB_DEVICE)
00190B E63E CB5F             8      BIT 3,A
00190D E640 2803            12      JR  Z,RDFAT0X1
00190F E642 CB6F             8      BIT 5,A
001911 E644 C0              11      RET NZ      ;BPBを取得している場合はFATIDをチェックしない
       E645                     RDFAT0X1:
001912 E645 37               4      SCF
001913 E646 C9              10      RET
                                
       E647                     POP_HL_SCF_RET:
001914 E647 E1              10      POP HL
001915 E648 37               4      SCF
001916 E649 C9              10      RET
                                
       E64A                     BPB2DPB:
001917 E64A FD7E0B          19      LD  A,(IY+11)   ;BPB_BytsPerSec
00191A E64D B7               4      OR  A
00191B E64E 37               4      SCF
00191C E64F C0              11      RET NZ
       E650                     BPBOK:
00191D E650 FD7E0D          19      LD  A,(IY+13)   ;BPB_SecPerClus
001920 E653 DD7707          19      LD  (IX+DPB_SECPCL),A
                                
001923 E656 FD7E16          19      LD  A,(IY+22)   ;BPB_FATSz16
001926 E659 DD7700          19      LD  (IX+DPB_FATLN),A
001929 E65C FD7E17          19      LD  A,(IY+23)   ;BPB_FATSz16
00192C E65F DD7701          19      LD  (IX+DPB_FATLN+1),A
                                
00192F E662 FD6E0E          19      LD  L,(IY+14)   ;BPB_RsvdSecCnt
001932 E665 FD660F          19      LD  H,(IY+15)
001935 E668 DD750E          19      LD  (IX+DPB_FATPS),L
001938 E66B FD5E16          19      LD  E,(IY+22)   ;BPB_FATSz16
00193B E66E FD5617          19      LD  D,(IY+23)
00193E E671 FD4610          19      LD  B,(IY+16)   ;BPB_NumFATs
       E674                     BPBDP1:             ;BPB_FATSz16 * BPB_NumFATs
001941 E674 19              11      ADD HL,DE
001942 E675 10FD            13      DJNZ    BPBDP1
       E677                     BPBDP2:
001944 E677 DD7510          19      LD  (IX+DPB_DIRPS),L
001947 E67A DD7411          19      LD  (IX+DPB_DIRPS+1),H
00194A E67D E5              11      PUSH    HL
                                
00194B E67E FD6E11          19      LD  L,(IY+17)   ;BPB_RootEntCnt
00194E E681 FD6612          19      LD  H,(IY+18)
001951 E684 FD7E0C          19      LD  A,(IY+12)   ;BPB_BytsPerSec
001954 E687 B7               4      OR  A
001955 E688 28BD            12      JR  Z,POP_HL_SCF_RET
001957 E68A 0606             7      LD  B,6
       E68C                     BPBBPS1:
001959 E68C 05               4      DEC B
00195A E68D 0F               4      RRCA
00195B E68E 30FC            12      JR  NC,BPBBPS1
       E690                     BPBDE1:
00195D E690 29              11      ADD HL,HL
00195E E691 10FD            13      DJNZ    BPBDE1
                                
001960 E693 7C               4      LD  A,H
001961 E694 DD770B          19      LD  (IX+DPB_DIRSCNT),A  ;
                                
001964 E697 D1              10      POP DE      ;DPB_DIRPS
001965 E698 6C               4      LD  L,H
001966 E699 2600             7      LD  H,0
001968 E69B 19              11      ADD HL,DE       ;MAXDIR
001969 E69C E5              11      PUSH    HL
00196A E69D FD4E0D          19      LD  C,(IY+13)   ;BPB_SecPerClus
00196D E6A0 CB21             8      SLA C       ;*2
00196F E6A2 AF               4      XOR A
001970 E6A3 47               4      LD  B,A
001971 E6A4 ED42            15      SBC HL,BC
001973 E6A6 DD7514          19      LD  (IX+DPB_ADDCL),L
001976 E6A9 DD7415          19      LD  (IX+DPB_ADDCL+1),H
                                
001979 E6AC D1              10      POP DE      ;DE=DPB_MAXDIR
00197A E6AD FD6E13          19      LD  L,(IY+19)   ;BPB_TotSec16
00197D E6B0 FD6614          19      LD  H,(IY+20)
                                
001980 E6B3 DD7E12          19      LD  A,(IX+DPB_DEVICE)
001983 E6B6 E60F             7      AND 00FH
001985 E6B8 FE07             7      CP  7       ;フロッピー
001987 E6BA 2019            12      JR  NZ,NOT_FD
001989 E6BC E5              11      PUSH    HL
00198A E6BD FD4E18          19      LD  C,(IY+24)   ;BPB_SecPerTr
00198D E6C0 DD710D          19      LD  (IX+DPB_MAXSEC),C
001990 E6C3 AF               4      XOR A
001991 E6C4 CB21             8      SLA C       ;両面なのでセクタ数を２倍
001993 E6C6 0610             7      LD  B,16
       E6C8                     DIVSEC:             ;MAXCYL = BPB_TotSec16 / (BPB_SecPerTr * 2)
001995 E6C8 29              11      ADD HL,HL
001996 E6C9 17               4      RLA
001997 E6CA B9               4      CP  C
001998 E6CB 3802            12      JR  C,DIVSEC1
00199A E6CD 91               4      SUB C
00199B E6CE 2C               4      INC L
       E6CF                     DIVSEC1:
00199C E6CF 10F7            13      DJNZ    DIVSEC
00199E E6D1 DD750C          19      LD  (IX+DPB_MAXCYL),L
0019A1 E6D4 E1              10      POP HL  ;ここまでフロッピー専用
       E6D5                     NOT_FD:
0019A2 E6D5 7C               4      LD  A,H
0019A3 E6D6 B5               4      OR  L
0019A4 E6D7 3E00             7      LD  A,0     ;LDでフラグは変化しない。BPB_TotSec16を AHL で扱う為、Aに0を入れる
0019A6 E6D9 200E            12      JR  NZ,BPB16BIT ;BPB_TotSec16が「0」の場合はBPB_TotSec32で計算
0019A8 E6DB 2F               4      CPL         ;A=0FFH
0019A9 E6DC FD8623          19      ADD A,(IY+35)   ;念のために総セクタ数が24ビットを超える場合はエラーを返す
0019AC E6DF D8              11      RET C
0019AD E6E0 FD6E20          19      LD  L,(IY+32)   ;BPB_TotSec32 は AHL の24ビットで扱う
0019B0 E6E3 FD6621          19      LD  H,(IY+33)   ;1クラスタの論理セクタ数(DPB_SECPCL)が最大128なので、
0019B3 E6E6 FD7E22          19      LD  A,(IY+34)   ;FAT12,FAT16では総セクタ数が24ビットを超えることは無い
       E6E9                     BPB16BIT:
0019B6 E6E9 ED52            15      SBC HL,DE       ;DE=DPB_MAXDIR
0019B8 E6EB DE00             7      SBC A,0
0019BA E6ED FD460D          19      LD  B,(IY+13)   ;BPB_SecPerClus
       E6F0                     BPBTC1:             ;総クラスタ数(AHL) = 総セクタ数(AHL) / セクタサイズ(B)
0019BD E6F0 CB18             8      RR  B       ;->CY
0019BF E6F2 3808            12      JR  C,BPBTC2
0019C1 E6F4 CB3F             8      SRL A
0019C3 E6F6 CB1C             8      RR  H       ;AHL=AHL/2
0019C5 E6F8 CB1D             8      RR  L
0019C7 E6FA 18F4            12      JR  BPBTC1
       E6FC                     BPBTC2:
0019C9 E6FC C6FF             7      ADD A,0FFH
0019CB E6FE D8              11      RET C       ;念のため(クラスタ数が16ビットを超える場合)
0019CC E6FF 23               6      INC HL
0019CD E700 23               6      INC HL
0019CE E701 DD7508          19      LD  (IX+DPB_MAXCL),L
0019D1 E704 DD7409          19      LD  (IX+DPB_MAXCL+1),H
                                
0019D4 E707 FD7E15          19      LD  A,(IY+21)   ;BPB_Media
0019D7 E70A DD7706          19      LD  (IX+DPB_FATID),A
       E70D                     CHECK1024:
0019DA E70D FD7E10          19      LD  A,(IY+16)   ;BPB_NumFATs
0019DD E710 C6FE             7      ADD A,0-2       ;>2:CF=1
0019DF E712 FD7E0C          19      LD  A,(IY+12)   ;BPB_BytsPerSec
0019E2 E715 6F               4      LD  L,A
0019E3 E716 3002            12      JR  NC,BPBFAT1
0019E5 E718 F680             7      OR  080H
       E71A                     BPBFAT1:            ;ここではCF=0
0019E7 E71A DD770F          19      LD  (IX+DPB_BPS),A
0019EA E71D 3A7BF1          13      LD  A,(_MAX_SEC_SZ_H)
0019ED E720 BD               4      CP  L
0019EE E721 C8              11      RET Z       ;1セクタ1024バイト
0019EF E722 2D               4      DEC L       ;以下のセクタサイズに合致しない場合はCF=1でエラーにする
0019F0 E723 C8              11      RET Z       ;1セクタ256バイト
0019F1 E724 2D               4      DEC L
0019F2 E725 C8              11      RET Z       ;1セクタ512バイト
0019F3 E726 37               4      SCF
0019F4 E727 C9              10      RET
                                
       E728                     RDFATS:
0019F5 E728 CD59E7          17      CALL    FATSETUP
0019F8 E72B D8              11      RET C
0019F9 E72C CD38E7          17      CALL    DRD24B
0019FC E72F 2A7CF1          16      LD  HL,(_FATBF)
0019FF E732 7E               7      LD  A,(HL)
001A00 E733 C9              10      RET
                                
       E734                     DRD16:
001A01 E734 0E00             7      LD  C,0
       E736                     DRD24:
001A03 E736 0601             7      LD  B,1
       E738                     DRD24B:
001A05 E738 DDE5            15      PUSH    IX
001A07 E73A DD2AA8F0        20      LD  IX,(_DPB)
001A0B E73E CDA2E9          17      CALL    FDRD        ;自己書き換え（ディスク読み込み）
       E73F                     DRDPAT  EQU $-2
       E741                     POP_IX_RET:
001A0E E741 DDE1            14      POP IX
001A10 E743 C9              10      RET
                                
       E744                     DWT16:
001A11 E744 0E00             7      LD  C,0
       E746                     DWT24:
001A13 E746 0601             7      LD  B,1
       E748                     DWT24B:
001A15 E748 DDE5            15      PUSH    IX
001A17 E74A DD2AA8F0        20      LD  IX,(_DPB)
001A1B E74E CD4BE9          17      CALL    FDWT        ;自己書き換え（ディスク書き込み）
       E74F                     DWTPAT  EQU $-2
001A1E E751 18EE            12      JR  POP_IX_RET
                                
       E753                     WTFAT:
001A20 E753 CD59E7          17      CALL    FATSETUP
001A23 E756 30F0            12      JR  NC,DWT24B
001A25 E758 C9              10      RET
                                ;   CALL    NC,DWT24B   ;予備FATの保存ルーチン
                                ;   RET C
                                ;   BIT 7,(IX+DPB_BPS)
                                ;   RET Z       ;予備FATが無い
                                ;   CALL    FATS2
                                ;   PUSH    HL      ;予備FAT
                                ;   LD  L,(IX+DPB_FATLN)
                                ;   LD  H,(IX+DPB_FATLN+1)
                                ;   ADD HL,DE
                                ;   EX  DE,HL
                                ;   POP HL
                                ;   JR  DWT24B
                                ;------------------------
                                ;FATのセットアップ
                                ;out
                                ;   B  : FATセクタ数
                                ;   DE : FAT先頭セクタ番号
                                ;   HL : FATバッファポインタ
                                ;   CF : 1=ドライブ切り替えエラー
                                ;note
                                ;   FATサイズがFATバッファを超える場合は
                                ;   対象クラスタ領域==(_FATIX)によって
                                ;   FAT12:対象クラスタ1024毎に1.5KBを切り替える
                                ;   FAT16:対象クラスタ512毎に1KBを切り替える
                                ;------------------------
       E759                     FATSETUP:
001A26 E759 3AAAF0          13      LD  A,(_FATDRV)
001A29 E75C CD62E8          17      CALL    CHGDRVR     ;ドライブ切り替え
001A2C E75F D8              11      RET C
       E760                     FATS2:
001A2D E760 DD7E0F          19      LD  A,(IX+DPB_BPS)  ;512=2 1024=4
001A30 E763 0F               4      RRCA
001A31 E764 CD94E7          17      CALL    FATSETUP12  ;自己書き換え
       E765                     FATSX   EQU $-2
001A34 E767 210000          10      LD  HL,0
001A37 E76A 4A               4      LD  C,D
001A38 E76B 54               4      LD  D,H
001A39 E76C 3AABF0          13      LD  A,(_FATIX)  ;範囲FAT12:0-3/FAT16:0-127(0-07FH):65535*2/1024
001A3C E76F 47               4      LD  B,A
001A3D E770 04               4      INC B
001A3E E771 DD7E00          19      LD  A,(IX+DPB_FATLN)
       E774                     FAT_SKP:
001A41 E774 05               4      DEC B
001A42 E775 2809            12      JR  Z,FAT1
001A44 E777 19              11      ADD HL,DE
001A45 E778 93               4      SUB E
001A46 E779 30F9            12      JR  NC,FAT_SKP
001A48 E77B DDCB0146        20      BIT 0,(IX+DPB_FATLN+1)  ;FATサイズが0100H(256)の場合
001A4C E77F C8              11      RET Z
       E780                     FAT1:
001A4D E780 EB               4      EX  DE,HL
001A4E E781 B7               4      OR  A       ;0の場合は0100Hとして扱う
001A4F E782 2803            12      JR  Z,FAT3
001A51 E784 B9               4      CP  C       ;C=FATバッファに読み込めるセクタ数
001A52 E785 3801            12      JR  C,FAT2
       E787                     FAT3:
001A54 E787 79               4      LD  A,C
       E788                     FAT2:
001A55 E788 47               4      LD  B,A
                                
001A56 E789 2AFAF1          16      LD  HL,(_FATPS) ;fat sector pos
001A59 E78C 19              11      ADD HL,DE
001A5A E78D EB               4      EX  DE,HL
001A5B E78E 2A7CF1          16      LD  HL,(_FATBF)
001A5E E791 AF               4      XOR A       ;CF=0
001A5F E792 4F               4      LD  C,A
001A60 E793 C9              10      RET
                                ;
                                ;   FATバッファに読み込める最大のセクタ数と_FATIXで進めるセクタ数
                                ;   FATSETUP* (FAT12/FAT16)
                                ;out
                                ;   D : FATバッファに読み込める最大のセクタ数
                                ;   E : _FATIXで進めるセクタ数
       E794                     FATSETUP12:
001A61 E794 110606          10      LD  DE,0606H    ;256
001A64 E797 D8              11      RET C
001A65 E798 110303          10      LD  DE,0303H    ;512
001A68 E79B 0F               4      RRCA
001A69 E79C D8              11      RET C
001A6A E79D 110102          10      LD  DE,0201H    ;1024
001A6D E7A0 C9              10      RET
                                
       E7A1                     FATSETUP16:
001A6E E7A1 110404          10      LD  DE,0404H    ;256
001A71 E7A4 D8              11      RET C
001A72 E7A5 110202          10      LD  DE,0202H    ;512
001A75 E7A8 0F               4      RRCA
001A76 E7A9 D8              11      RET C
001A77 E7AA 110101          10      LD  DE,0101H    ;1024
001A7A E7AD C9              10      RET
                                
       E7AE                     CHGDRV:
001A7B E7AE E5              11      PUSH    HL
001A7C E7AF 2189F0          10      LD  HL,_DSK
001A7F E7B2 BE               7      CP  (HL)
001A80 E7B3 280A            12      JR  Z,CHGDRVE
       E7B5                     CHGDRV1:
001A82 E7B5 DDE5            15      PUSH    IX
001A84 E7B7 CDC1E7          17      CALL    CHGDRV0
001A87 E7BA 3A89F0          13      LD  A,(_DSK)
001A8A E7BD DDE1            14      POP IX
       E7BF                     CHGDRVE:
001A8C E7BF E1              10      POP HL
001A8D E7C0 C9              10      RET
                                
       E7C1                     CHGDRV0:
001A8E E7C1 6F               4      LD  L,A
001A8F E7C2 CDDCF0          17      CALL    _GETDPB
001A92 E7C5 D8              11      RET C
001A93 E7C6 DD22A8F0        20      LD  (_DPB),IX
001A97 E7CA 7D               4      LD  A,L
001A98 E7CB 3289F0          13      LD  (_DSK),A
       E7CE                     CHGDRV2:
001A9B E7CE C5              11      PUSH    BC
001A9C E7CF D5              11      PUSH    DE
001A9D E7D0 ED7319E8        20      LD  (SPPAT2),SP
001AA1 E7D4 F3               4      DI
001AA2 E7D5 DDF9            10      LD  SP,IX
                                
001AA4 E7D7 E1              10      POP HL      ;00:DPB_FATLN
001AA5 E7D8 E1              10      POP HL      ;02:DPB_DRD
001AA6 E7D9 223FE7          16      LD  (DRDPAT),HL
                                
001AA9 E7DC E1              10      POP HL
001AAA E7DD 224FE7          16      LD  (DWTPAT),HL ;04:DPB_DWT
                                
001AAD E7E0 E1              10      POP HL      ;L=06:DPB_FATID H=07:DPB_SECPCL
001AAE E7E1 7C               4      LD  A,H
001AAF E7E2 3236DE          13      LD  (SPCPAT),A  ;1クラスタの論理セクタ数
001AB2 E7E5 3D               4      DEC A
001AB3 E7E6 32A8E5          13      LD  (_NCPAT),A
                                
001AB6 E7E9 E1              10      POP HL      ;08:DPB_MAXCL
001AB7 E7EA 7D               4      LD  A,L
001AB8 E7EB 3255DE          13      LD  (CLPAT2),A
001ABB E7EE 7C               4      LD  A,H
001ABC E7EF 3251DE          13      LD  (CLPAT1),A
001ABF E7F2 2B               6      DEC HL
001AC0 E7F3 2252E0          16      LD  (MAXCLP),HL
                                
001AC3 E7F6 E1              10      POP HL      ;L=0A:DPB_FDMODE H=0B:DPB_DIRSCNT
001AC4 E7F7 4C               4      LD  C,H
                                
001AC5 E7F8 E1              10      POP HL      ;L=0C:DPB_MAXCYL H=0D:DPB_MAXSEC
                                
001AC6 E7F9 E1              10      POP HL      ;L=0E:DPB_FATPS H=0F:DPB_BPS
001AC7 E7FA 7C               4      LD  A,H     ;DPB_BPS
001AC8 E7FB E607             7      AND 7
001ACA E7FD 3217E3          13      LD  (SECSZ+2),A ;1セクタのサイズの上位1バイト 0x400 - 0x200 - 0x100
                                                ;1セクタ512 2D/2DD/2HC/2HQ(2HD1.44MB)/EMM/BRAM/EMEM等
                                                ;1セクタ1024 2HD/2HDE98等
                                                ;1セクタ256 GRAM/RAMF/CMOS等
                                                ;1024   512 256
                                                ;4  2   1
001ACD E800 87               4      ADD A,A     ;8  4   2
001ACE E801 87               4      ADD A,A     ;010H   8   4
001ACF E802 87               4      ADD A,A     ;020H   010H    8
001AD0 E803 32B3DC          13      LD  (SDECPAT),A ;1セクタ辺りのディレクトリエントリ数
                                
001AD3 E806 2600             7      LD  H,0
001AD5 E808 22FAF1          16      LD  (_FATPS),HL
                                
001AD8 E80B E1              10      POP HL      ;10:DPB_DIRPS
001AD9 E80C 22FCF1          16      LD  (_DIRPS),HL
                                
001ADC E80F E1              10      POP HL      ;L=12:DPB_DEVICE H=13:DPB_UNITNO
001ADD E810 7C               4      LD  A,H
001ADE E811 3284F0          13      LD  (_DRIVE),A
                                
001AE1 E814 E1              10      POP HL      ;14:DPB_ADDCL
001AE2 E815 2246DE          16      LD  (CLSPAT),HL
                                
001AE5 E818 310000          10      LD  SP,0        ;元のSPを復元
       E819                     SPPAT2  EQU $-2
001AE8 E81B FB               4      EI
001AE9 E81C 2AFCF1          16      LD  HL,(_DIRPS)
001AEC E81F 0600             7      LD  B,0
001AEE E821 09              11      ADD HL,BC       ;C=DPB_DIRSCNT
001AEF E822 22CEDC          16      LD  (MD_PAT),HL
                                
001AF2 E825 2A52E0          16      LD  HL,(MAXCLP)
001AF5 E828 110AF0          10      LD  DE,0-4086   ;クラスタ数が4086未満:FAT12 4086以上:FAT16
001AF8 E82B 19              11      ADD HL,DE
001AF9 E82C 380F            12      JR  C,SETFAT16
001AFB E82E 212EE5          10      LD  HL,GNCL     ;FAT12
001AFE E831 1151E5          10      LD  DE,SNCL
001B01 E834 0194E7          10      LD  BC,FATSETUP12
001B04 E837 DDCB0FAE        23      RES 5,(IX+DPB_BPS)  ;DPB_BPS(FAT12)
001B08 E83B 180D            12      JR  EXTRA1
       E83D                     SETFAT16:
001B0A E83D 2185E5          10      LD  HL,GNCL16   ;FAT16
001B0D E840 1192E5          10      LD  DE,SNCL16
001B10 E843 01A1E7          10      LD  BC,FATSETUP16
001B13 E846 DDCB0FEE        23      SET 5,(IX+DPB_BPS)  ;DPB_BPS(FAT16)
       E84A                     EXTRA1:
001B17 E84A 22F8F0          16      LD  (GNCPAT),HL
001B1A E84D ED53FBF0        20      LD  (SNCPAT),DE
001B1E E851 ED4365E7        20      LD  (FATSX),BC
001B22 E855 D1              10      POP DE
001B23 E856 C1              10      POP BC
001B24 E857 AF               4      XOR A
001B25 E858 C9              10      RET
                                
       E859                     GETDPBD:
001B26 E859 DDE3            23      EX  (SP),IX
001B28 E85B DDE5            15      PUSH    IX
001B2A E85D 3A88F0          13      LD  A,(_DRV)
001B2D E860 1807            12      JR  GETDPB1
                                
       E862                     CHGDRVR:
001B2F E862 CDD9F0          17      CALL    _CHGDRV
001B32 E865 D8              11      RET C
001B33 E866 3A89F0          13      LD  A,(_DSK)
       E869                     GETDPB1:
001B36 E869 C3DCF0          10      JP  _GETDPB
                                
       E86C                     GETDPB:
001B39 E86C FE08             7      CP  8
001B3B E86E 3F               4      CCF
001B3C E86F D8              11      RET C
001B3D E870 0F               4      RRCA
001B3E E871 0F               4      RRCA
001B3F E872 0F               4      RRCA
001B40 E873 DD                      DB  0DDH        ;Z80未定義命令
001B41 E874 6F               4      LD  L,A     ;LD IXL,A
001B42 E875 DD                      DB  0DDH        ;Z80未定義命令
001B43 E876 26F2             7      LD  H,_DEVICE/256   ;LD IXH,_DEVICE/256
001B45 E878 DD7E00          19      LD  A,(IX+DPB_FATLN)
001B48 E87B A7               4      AND A       ;CF=0の為
001B49 E87C DDCB0F6E        20      BIT 5,(IX+DPB_BPS)
001B4D E880 C0              11      RET NZ      ;FAT16
001B4E E881 DDCB126E        20      BIT 5,(IX+DPB_DEVICE)
001B52 E885 C0              11      RET NZ      ;BPB
001B53 E886 FE01             7      CP  001H        ;A=0 THEN CF=1
001B55 E888 C9              10      RET
                                
       E889                     _SYS5F:
001B56 E889 AF               4      XOR A
       E88A                     FFLUSH:
001B57 E88A F5              11      PUSH    AF
001B58 E88B CDAFE4          17      CALL    WTFATX
001B5B E88E AF               4      XOR A
001B5C E88F 32ABF0          13      LD  (_FATIX),A
001B5F E892 2F               4      CPL         ;0FFH
001B60 E893 32AAF0          13      LD  (_FATDRV),A
001B63 E896 3E                      DB  03EH        ;次のPUSH AFをスキップ
       E897                     FFLUSHBUF:
001B64 E897 F5              11      PUSH    AF
001B65 E898 CD65E4          17      CALL    DWTX
001B68 E89B 3EFF             7      LD  A,0FFH
001B6A E89D 3239F0          13      LD  (SFILE),A
001B6D E8A0 32A5F0          13      LD  (_DBDRV),A
001B70 E8A3 F1              10      POP AF
001B71 E8A4 C9              10      RET
                                
[EOF:LDDIO.ASM:SHIFT_JIS]
                                    INCLUDE "M7DISK.ASM"
                                
                                ;   LSX-Dodgers DISK
                                ;   MZ-700/1500
                                
       E8A5                     SEEK:
001B72 E8A5 0610             7      LD  B,16
001B74 E8A7 DD4E0D          19      LD  C,(IX+DPB_MAXSEC)
001B77 E8AA AF               4      XOR A
001B78 E8AB EB               4      EX  DE,HL
       E8AC                     DIV1:
001B79 E8AC 29              11      ADD HL,HL
001B7A E8AD 8F               4      ADC A,A
001B7B E8AE B9               4      CP  C
001B7C E8AF 3802            12      JR  C,DIV2
001B7E E8B1 91               4      SUB C
001B7F E8B2 2C               4      INC L
       E8B3                     DIV2:
001B80 E8B3 10F7            13      DJNZ    DIV1
                                
001B82 E8B5 3C               4      INC A   ;最小のセクタは１固定
001B83 E8B6 55               4      LD  D,L ;TRACK
001B84 E8B7 5F               4      LD  E,A ;SECTOR
                                
001B85 E8B8 3A84F0          13      LD  A,(_DRIVE)
001B88 E8BB FE04             7      CP  4
001B8A E8BD 3F               4      CCF
001B8B E8BE D8              11      RET C
001B8C E8BF F684             7      OR  084H        ;Motor on + ドライブセレクト有効
001B8E E8C1 D3DC            11      OUT (0DCH),A    ;モータ/ドライブセレクト制御レジスタ
001B90 E8C3 CB3A             8      SRL D       ;CYLINDER
001B92 E8C5 9F               4      SBC A,A
001B93 E8C6 D3DD            11      OUT (0DDH),A    ;ヘッドセレクト制御レジスタ
                                
001B95 E8C8 CD00E9          17      CALL    SETMODE
001B98 E8CB D8              11      RET C
                                
001B99 E8CC CD35E9          17      CALL    DRIVE
001B9C E8CF FEFF             7      CP  0FFH        ;A=0FFH Unknown CYLINDER
001B9E E8D1 CC17E9          17      CALL    Z,FDCRES    ;Restore
001BA1 E8D4 2F               4      CPL         ;データバスが負論理
001BA2 E8D5 D3D9            11      OUT (0D9H),A    ;MB8876 トラックレジスタ
001BA4 E8D7 2F               4      CPL         ;データバスが負論理
001BA5 E8D8 92               4      SUB D
001BA6 E8D9 C8              11      RET Z       ;No seek
                                
001BA7 E8DA DD7E0C          19      LD  A,(IX+DPB_MAXCYL)
001BAA E8DD 3D               4      DEC A
001BAB E8DE BA               4      CP  D       ;Over CYLINDER
001BAC E8DF D8              11      RET C
                                
001BAD E8E0 7A               4      LD  A,D
001BAE E8E1 2F               4      CPL         ;データバスが負論理
001BAF E8E2 D3DB            11      OUT (0DBH),A    ;MB8876 データレジスタ
001BB1 E8E4 72               7      LD  (HL),D
                                
001BB2 E8E5 0E18             7      LD  C,018H      ;FDC TypeIコマンド Seek
       E8E7                     FDCCMD2:
001BB4 E8E7 3A85F0          13      LD  A,(_SEEKSP)
001BB7 E8EA B1               4      OR  C
                                
       E8EB                     FDCCMD:
001BB8 E8EB CD2CE9          17      CALL    COMSET
001BBB E8EE 3E80             7      LD  A,080H      ;FDC COMMAND(Self-modifying code)
       E8EF                     FDCSMC  EQU $-1
001BBD E8F0 E620             7      AND 020H        ;Write data Write track
001BBF E8F2 3C               4      INC A
                                
       E8F3                     SST:
001BC0 E8F3 0E00             7      LD  C,0
       E8F5                     SST1:
001BC2 E8F5 0D               4      DEC C       ; 4
001BC3 E8F6 20FD            12      JR  NZ,SST1     ;12 * 256 / 4 = About 1ms
001BC5 E8F8 3D               4      DEC A
001BC6 E8F9 20FA            12      JR  NZ,SST1
                                
001BC8 E8FB 0E01             7      LD  C,1
001BCA E8FD CD05E9          17      CALL    READY
       E900                     SETMODE:
001BCD E900 CD2FE9          17      CALL    DELAY0      ;Head select time
001BD0 E903 0E81             7      LD  C,081H
       E905                     READY:
001BD2 E905 0680             7      LD  B,128
       E907                     READY2:
001BD4 E907 DBD8            11      IN  A,(0D8H)    ;MB8876 ステータス/コマンドレジスタ
001BD6 E909 2F               4      CPL         ;データバスが負論理
001BD7 E90A A1               4      AND C       ;NOT READY,BUSY
001BD8 E90B C8              11      RET Z
001BD9 E90C CD1BCF          17      CALL    RD556VSYNC
001BDC E90F 07               4      RLCA
001BDD E910 A8               4      XOR B
001BDE E911 0F               4      RRCA
001BDF E912 30F3            12      JR  NC,READY2
001BE1 E914 10F1            13      DJNZ    READY2
001BE3 E916 C9              10      RET
                                
       E917                     FDCRES:
001BE4 E917 3600            10      LD  (HL),0
001BE6 E919 0E08             7      LD  C,8
001BE8 E91B 18CA            12      JR  FDCCMD2
                                
       E91D                     FDMOFF:
001BEA E91D F5              11      PUSH    AF
001BEB E91E AF               4      XOR A       ;Motor off(ドライブセレクト無効)
001BEC E91F D3DC            11      OUT (0DCH),A    ;モータ/ドライブセレクト制御レジスタ
001BEE E921 F1              10      POP AF
001BEF E922 C9              10      RET
                                
       E923                     SECSET_FDCCMD:
001BF0 E923 3AEFE8          13      LD  A,(FDCSMC)
       E926                     SECSET:
001BF3 E926 F5              11      PUSH    AF
001BF4 E927 7B               4      LD  A,E
001BF5 E928 2F               4      CPL         ;データバスが負論理
001BF6 E929 D3DA            11      OUT (0DAH),A    ;MB8876 セクタレジスタ
001BF8 E92B F1              10      POP AF
       E92C                     COMSET:
001BF9 E92C 2F               4      CPL         ;データバスが負論理
001BFA E92D D3D8            11      OUT (0D8H),A    ;MB8876 ステータス/コマンドレジスタ
       E92F                     DELAY0:
001BFC E92F 3E1A             7      LD  A,26
       E931                     DELAY:
001BFE E931 3D               4      DEC A
001BFF E932 20FD            12      JR  NZ,DELAY
001C01 E934 C9              10      RET
                                
       E935                     DRIVE:
001C02 E935 2A84F0          16      LD  HL,(_DRIVE)
001C05 E938 26F0             7      LD  H,_CYL0/256
001C07 E93A CBFD             8      SET 7,L
001C09 E93C 7E               7      LD  A,(HL)
001C0A E93D C9              10      RET
                                
       E93E                     RNF:
001C0B E93E CD35E9          17      CALL    DRIVE
001C0E E941 36FF            10      LD  (HL),0FFH
001C10 E943 C9              10      RET
                                
001C11 E944 02                  RETRY:  DB  2
                                
                                
                                ;   FLOPPY DISK DRIVER
                                
       E945                     WTTRK:
001C12 E945 0601             7      LD  B,1
001C14 E947 3EF4             7      LD  A,0F4H      ;FDC TypeIIIコマンド Write Track
001C16 E949 1802            12      JR  WTTRK1
       E94B                     FDWT:
001C18 E94B 3EA0             7      LD  A,0A0H      ;FDC TypeIIコマンド Write Sector
       E94D                     WTTRK1:
001C1A E94D 32EFE8          13      LD  (FDCSMC),A
       E950                     DWTBL:
001C1D E950 78               4      LD  A,B
001C1E E951 328DE9          13      LD  (WTBSMC),A
001C21 E954 3E02             7      LD  A,2     ;Retry count
001C23 E956 3244E9          13      LD  (RETRY),A
                                
       E959                     DWT0:
001C26 E959 D5              11      PUSH    DE
001C27 E95A E5              11      PUSH    HL
001C28 E95B CDA5E8          17      CALL    SEEK        ;Write disk
001C2B E95E E1              10      POP HL
001C2C E95F 3837            12      JR  C,ERRDW
001C2E E961 F3               4      DI
001C2F E962 CD23E9          17      CALL    SECSET_FDCCMD
001C32 E965 0EDB             7      LD  C,0DBH      ;MB8876 データレジスタ
       E967                     DWT1:
001C34 E967 7E               7      LD  A,(HL)
001C35 E968 2F               4      CPL         ;データバスが負論理
001C36 E969 57               4      LD  D,A
                                
       E96A                     DWT2:
001C37 E96A DBD8            11      IN  A,(0D8H)    ;MB8876 ステータス/コマンドレジスタ
001C39 E96C 2F               4      CPL         ;データバスが負論理
001C3A E96D 0F               4      RRCA
001C3B E96E 3008            12      JR  NC,DWT4
001C3D E970 0F               4      RRCA
001C3E E971 30F7            12      JR  NC,DWT2
       E973                     DWT3:
001C40 E973 ED51            12      OUT (C),D       ;MB8876 データレジスタ
001C42 E975 23               6      INC HL
001C43 E976 18EF            12      JR  DWT1
                                
       E978                     DWT4:
001C45 E978 3D               4      DEC A
001C46 E979 28F8            12      JR  Z,DWT3
001C48 E97B 3C               4      INC A
001C49 E97C FB               4      EI
001C4A E97D D1              10      POP DE
001C4B E97E 13               6      INC DE
001C4C E97F CD1DE9          17      CALL    FDMOFF
001C4F E982 2808            12      JR  Z,DISKOK_WT
001C51 E984 CDECE9          17      CALL    DISKC
001C54 E987 20D0            12      JR  NZ,DWT0
001C56 E989 B7               4      OR  A
001C57 E98A 2005            12      JR  NZ,ERRW
                                
       E98C                     DISKOK_WT:
001C59 E98C 0601             7      LD  B,1
       E98D                     WTBSMC  EQU $-1
001C5B E98E 10C0            13      DJNZ    DWTBL
001C5D E990 C9              10      RET
                                
       E991                     ERRW:
001C5E E991 3EFF             7      LD  A,0FFH
       E993                     ERRZ:
001C60 E993 BF               4      CP  A       ;ZF=1
001C61 E994 37               4      SCF
001C62 E995 C31DE9          10      JP  FDMOFF
                                
       E998                     ERRDW:
001C65 E998 D1              10      POP DE
001C66 E999 CDFDE9          17      CALL    DELP
001C69 E99C 20BB            12      JR  NZ,DWT0
001C6B E99E B7               4      OR  A
001C6C E99F 20F0            12      JR  NZ,ERRW
001C6E E9A1 C9              10      RET
                                
       E9A2                     FDRD:
001C6F E9A2 3E80             7      LD  A,080H      ;FDC TypeIIコマンド Read Sector
001C71 E9A4 32EFE8          13      LD  (FDCSMC),A
       E9A7                     DRDBL:
001C74 E9A7 78               4      LD  A,B
001C75 E9A8 32DEE9          13      LD  (RDBSMC),A
001C78 E9AB 3E02             7      LD  A,2     ;Retry count
001C7A E9AD 3244E9          13      LD  (RETRY),A
       E9B0                     DRD0:
001C7D E9B0 D5              11      PUSH    DE
001C7E E9B1 E5              11      PUSH    HL
001C7F E9B2 CDA5E8          17      CALL    SEEK        ;Read disk
001C82 E9B5 E1              10      POP HL
001C83 E9B6 382A            12      JR  C,ERRDR
001C85 E9B8 F3               4      DI
001C86 E9B9 CD23E9          17      CALL    SECSET_FDCCMD
       E9BC                     DRD1:
001C89 E9BC DBD8            11      IN  A,(0D8H)    ;MB8876 ステータス/コマンドレジスタ
001C8B E9BE 2F               4      CPL         ;データバスが負論理
001C8C E9BF 0F               4      RRCA
001C8D E9C0 300A            12      JR  NC,DRD3
001C8F E9C2 0F               4      RRCA
001C90 E9C3 30F7            12      JR  NC,DRD1
001C92 E9C5 DBDB            11      IN  A,(0DBH)    ;MB8876 データレジスタ
001C94 E9C7 2F               4      CPL         ;データバスが負論理
001C95 E9C8 77               7      LD  (HL),A
001C96 E9C9 23               6      INC HL
001C97 E9CA 18F0            12      JR  DRD1
                                
       E9CC                     DRD3:
001C99 E9CC B7               4      OR  A
001C9A E9CD FB               4      EI
001C9B E9CE D1              10      POP DE
001C9C E9CF 13               6      INC DE
001C9D E9D0 CD1DE9          17      CALL    FDMOFF
001CA0 E9D3 2808            12      JR  Z,DISKOK_RD
001CA2 E9D5 CDECE9          17      CALL    DISKC
001CA5 E9D8 20D6            12      JR  NZ,DRD0
001CA7 E9DA B7               4      OR  A
001CA8 E9DB 20B4            12      JR  NZ,ERRW
                                
       E9DD                     DISKOK_RD:
001CAA E9DD 0601             7      LD  B,1
       E9DE                     RDBSMC  EQU $-1
001CAC E9DF 10C6            13      DJNZ    DRDBL
001CAE E9E1 C9              10      RET
                                
       E9E2                     ERRDR:
001CAF E9E2 D1              10      POP DE
001CB0 E9E3 CDFDE9          17      CALL    DELP
001CB3 E9E6 20C8            12      JR  NZ,DRD0
001CB5 E9E8 B7               4      OR  A
001CB6 E9E9 20A6            12      JR  NZ,ERRW
001CB8 E9EB C9              10      RET
       E9EC                     DISKC:
001CB9 E9EC 1B               6      DEC DE
001CBA E9ED CB5F             8      BIT 3,A
001CBC E9EF C43EE9          17      CALL    NZ,RNF
       E9F2                     DISKD:
001CBF E9F2 E5              11      PUSH    HL
001CC0 E9F3 2144E9          10      LD  HL,RETRY
001CC3 E9F6 35              11      DEC (HL)
001CC4 E9F7 E1              10      POP HL
001CC5 E9F8 200C            12      JR  NZ,ERR      ;Retry
001CC7 E9FA B7               4      OR  A
001CC8 E9FB 2809            12      JR  Z,ERR       ;Error
                                
       E9FD                     DELP:
001CCA E9FD CD3EE9          17      CALL    RNF
001CCD EA00 CD1DE9          17      CALL    FDMOFF
001CD0 EA03 3EFF             7      LD  A,0FFH
       EA05                     AERRZ:
001CD2 EA05 BF               4      CP  A
       EA06                     ERR:
001CD3 EA06 3EFF             7      LD  A,0FFH
001CD5 EA08 C9              10      RET
[EOF:M7DISK.ASM:SHIFT_JIS]
                                    INCLUDE "M7DISK2.ASM"
                                
                                ;   LSX-Dodgers DISK2
                                ;   MZ-700/1500
                                
                                ;   EMM DRIVER
                                ;   1セクタ可変(256/512/1024)
                                
       EA09                     EDWT:
001CD6 EA09 F5              11      PUSH    AF
001CD7 EA0A CD28EA          17      CALL    EADR
001CDA EA0D 0600             7      LD  B,0
       EA0F                     EDWT1:
001CDC EA0F EDB3                    OTIR
001CDE EA11 3D               4      DEC A
001CDF EA12 20FB            12      JR  NZ,EDWT1
001CE1 EA14 180B            12      JR  EDRW1
                                
       EA16                     EDRD:
001CE3 EA16 C5              11      PUSH    BC
001CE4 EA17 CD28EA          17      CALL    EADR
001CE7 EA1A 0600             7      LD  B,0
       EA1C                     EDRD1:
001CE9 EA1C EDB2                    INIR
001CEB EA1E 3D               4      DEC A
001CEC EA1F 20FB            12      JR  NZ,EDRD1
       EA21                     EDRW1:
001CEE EA21 F1              10      POP AF
001CEF EA22 83               4      ADD A,E ;セクタを進める
001CF0 EA23 5F               4      LD  E,A
001CF1 EA24 8A               4      ADC A,D
001CF2 EA25 93               4      SUB E
001CF3 EA26 57               4      LD  D,A
001CF4 EA27 C9              10      RET
                                
       EA28                     EADR:
001CF5 EA28 D5              11      PUSH    DE
001CF6 EA29 EB               4      EX  DE,HL
001CF7 EA2A 78               4      LD  A,B
001CF8 EA2B DD460F          19      LD  B,(IX+DPB_BPS)
       EA2E                     EADR1:              ;読み込むセクタ数と1クラスタのセクタ数を掛ける
001CFB EA2E CB18             8      RR  B
001CFD EA30 3804            12      JR  C,EADR2
001CFF EA32 87               4      ADD A,A
001D00 EA33 29              11      ADD HL,HL
001D01 EA34 18F8            12      JR  EADR1
       EA36                     EADR2:
001D03 EA36 DD4E0D          19      LD  C,(IX+DPB_MAXSEC)
001D06 EA39 DD460C          19      LD  B,(IX+DPB_MAXCYL)
001D09 EA3C 09              11      ADD HL,BC
001D0A EA3D DD4E13          19      LD  C,(IX+DPB_UNITNO)
001D0D EA40 ED71                    DB  0EDH,071H   ;OUT (C),0  Z80未定義命令
001D0F EA42 0C               4      INC C
001D10 EA43 ED69            12      OUT (C),L
001D12 EA45 0C               4      INC C
001D13 EA46 ED61            12      OUT (C),H
001D15 EA48 0C               4      INC C
001D16 EA49 EB               4      EX  DE,HL
001D17 EA4A D1              10      POP DE
001D18 EA4B C9              10      RET
                                
                                ;   CMOS BACKUP MEMORY DRIVER(32KB)
                                ;   1セクタ256
                                
       EA4C                     CDWT:
001D19 EA4C 78               4      LD  A,B
001D1A EA4D DD4E13          19      LD  C,(IX+DPB_UNITNO)
001D1D EA50 ED40            12      IN  B,(C)       ;アドレスカウンタを0000にリセット
001D1F EA52 ED59            12      OUT (C),E       ;W)アドレスカウンタ上位
001D21 EA54 01FA00          10      LD  BC,000FAH
       EA57                     CDWT1:
001D24 EA57 EDB3                    OTIR            ;W)データ書き込み・アドレスカウンタ+1
001D26 EA59 13               6      INC DE
001D27 EA5A 3D               4      DEC A
001D28 EA5B 20FA            12      JR  NZ,CDWT1
001D2A EA5D A7               4      AND A
001D2B EA5E C9              10      RET
                                
       EA5F                     CDRD:
001D2C EA5F 78               4      LD  A,B
001D2D EA60 DD4E13          19      LD  C,(IX+DPB_UNITNO)
001D30 EA63 ED40            12      IN  B,(C)       ;アドレスカウンタを0000にリセット
001D32 EA65 ED59            12      OUT (C),E       ;W)アドレスカウンタ上位
001D34 EA67 01F900          10      LD  BC,000F9H
       EA6A                     CDRD1:
001D37 EA6A EDB2                    INIR            ;R)データ読み出し・アドレスカウンタ+1
001D39 EA6C 13               6      INC DE
001D3A EA6D 3D               4      DEC A
001D3B EA6E 20FA            12      JR  NZ,CDRD1
001D3D EA70 A7               4      AND A
001D3E EA71 C9              10      RET
                                
                                ;   RAM DISK DRIVER (64KB)
                                ;   1セクタ256
                                
       EA72                     RDWT:
001D3F EA72 3EB3             7      LD  A,0B3H      ;OTIR
001D41 EA74 1802            12      JR  RDRW
       EA76                     RDRD:
001D43 EA76 3EB2             7      LD  A,0B2H      ;INIR
       EA78                     RDRW:
001D45 EA78 3285EA          13      LD  (RDRW1+1),A
                                
001D48 EA7B 78               4      LD  A,B
001D49 EA7C 43               4      LD  B,E     ;B=アドレスカウンタ上位(X1の様な16bitのI/Oアクセス)
001D4A EA7D 0EEB             7      LD  C,0EBH
001D4C EA7F ED71            12      OUT (C),0       ;0=アドレスカウンタ下位
001D4E EA81 0D               4      DEC C       ;EA(R)データ読み出し・アドレスカウンタ+1
001D4F EA82 0600             7      LD  B,0
       EA84                     RDRW1:
001D51 EA84 EDB2                    INIR            ;自己書き換え(INIR/OTIR)
001D53 EA86 13               6      INC DE
001D54 EA87 3D               4      DEC A
001D55 EA88 20FA            12      JR  NZ,RDRW1
001D57 EA8A A7               4      AND A
001D58 EA8B C9              10      RET
                                
                                ;   G-RAM(PCG) DISK DRIVER (24KB)
                                ;   1セクタ256
                                
       EA8C                     GDWT:
001D59 EA8C C5              11      PUSH    BC
001D5A EA8D D5              11      PUSH    DE
001D5B EA8E CDB6EA          17      CALL    GADR
       EA91                     GDWT2:
001D5E EA91 4E               7      LD  C,(HL)
001D5F EA92 23               6      INC HL
001D60 EA93 EB               4      EX  DE,HL   ;HL=PCG,DE=メモリ
001D61 EA94 CDD2CF          17      CALL    WR_PCG
001D64 EA97 23               6      INC HL
001D65 EA98 EB               4      EX  DE,HL   ;HL=メモリ,DE=PCG
001D66 EA99 10F6            13      DJNZ    GDWT2
001D68 EA9B D1              10      POP DE
001D69 EA9C 1C               4      INC E
001D6A EA9D C1              10      POP BC
001D6B EA9E 10EC            13      DJNZ    GDWT
001D6D EAA0 C9              10      RET
       EAA1                     GDRD:
001D6E EAA1 C5              11      PUSH    BC
001D6F EAA2 D5              11      PUSH    DE
001D70 EAA3 CDB6EA          17      CALL    GADR
       EAA6                     GDRD2:
001D73 EAA6 EB               4      EX  DE,HL   ;HL=PCG,DE=メモリ
001D74 EAA7 CDCACF          17      CALL    RD_PCG
001D77 EAAA 23               6      INC HL
001D78 EAAB EB               4      EX  DE,HL   ;HL=メモリ,DE=PCG
001D79 EAAC 71               7      LD  (HL),C
001D7A EAAD 23               6      INC HL
001D7B EAAE 10F6            13      DJNZ    GDRD2
001D7D EAB0 D1              10      POP DE
001D7E EAB1 1C               4      INC E
001D7F EAB2 C1              10      POP BC
001D80 EAB3 10EC            13      DJNZ    GDRD
001D82 EAB5 C9              10      RET
                                
       EAB6                     GADR:
001D83 EAB6 7B               4      LD  A,E
001D84 EAB7 E61F             7      AND 01FH
001D86 EAB9 C6D0             7      ADD A,0D0H
001D88 EABB 57               4      LD  D,A
001D89 EABC 7B               4      LD  A,E
001D8A EABD 07               4      RLCA
001D8B EABE 07               4      RLCA
001D8C EABF 07               4      RLCA
001D8D EAC0 3C               4      INC A
001D8E EAC1 0600             7      LD  B,0
001D90 EAC3 58               4      LD  E,B
001D91 EAC4 C9              10      RET
[EOF:M7DISK2.ASM:UTF_8]
                                    INCLUDE "LDCCPWK.ASM"
                                
                                ;   LSX-Dodgers CCP WORK
                                
       003B                     PATHX   EQU 59
001D92 EAC5                     PATHD:  DS  PATHX
001DCD EB00 00                  PATHE:  DB  0
                                
       EB01                     DTA_CCP:
001DCE EB01                         DS  37
                                
       EB26                     FCB_BAT:
001DF3 EB26                         DS  37
                                
001E18 EB4B 2020203C4449523E    DIRMES: DB  "   <DIR>  $"
            202024              
001E23 EB56 20667265652024      FREE:   DB  " free $"
[EOF:LDCCPWK.ASM:UTF_8]
                                    INCLUDE "M7TABLE.ASM"
                                
                                ;   LSX-Dodgers TABLE 表示関連のテーブル
                                ;   MZ-700/1500
                                
       EB5D                     AT_TABLE:
001E2A EB5D                         DS  TABLEAD-AT_TABLE
                                
       ED40                     KEY_TABLE:
00200D ED40 12081E1F1C1D5C2F        DB  12H,08H,1EH,1FH,1CH,1DH,5CH,'/'
002015 ED48 5C5E2D2030392C2E        DB  5CH,'^','-',20H,'0','9',',','.'
00201D ED50 3132333435363738        DB  '1','2','3','4','5','6','7','8'
002025 ED58 6162636465666768        DB  'a','b','c','d','e','f','g','h'
00202D ED60 696A6B6C6D6E6F70        DB  'i','j','k','l','m','n','o','p'
002035 ED68 7172737475767778        DB  'q','r','s','t','u','v','w','x'
00203D ED70 797A405B5D000000        DB  'y','z','@','[',']',00H,00H,00H
002045 ED78 001B3D09003B3A0D        DB  00H,1BH,'=',09H,00H,';',':',0DH
       ED80                     SHIFT_TABLE:
00204D ED80 12081E1F1C1D5F3F        DB  12H,08H,1EH,1FH,1CH,1DH,'_','?'
002055 ED88 7C7E3D2030293C3E        DB  '|','~','=',20H,'0',')','<','>'
00205D ED90 2122232425262728        DB  '!','"','#','$','%','&',27H,'('
002065 ED98 4142434445464748        DB  'A','B','C','D','E','F','G','H'
00206D EDA0 494A4B4C4D4E4F50        DB  'I','J','K','L','M','N','O','P'
002075 EDA8 5152535455565758        DB  'Q','R','S','T','U','V','W','X'
00207D EDB0 595A607B7D000000        DB  'Y','Z','`','{','}',00H,00H,00H
002085 EDB8 00003D09002B2A0D        DB  00H,00H,'=',09H,00H,'+','*',0DH
       EDC0                     CTRL_TABLE:
00208D EDC0 12081E1F1C1D3F2F        DB  12H,08H,1EH,1FH,1CH,1DH,'?','/'
002095 EDC8 2A2B2D2030392C2E        DB  '*','+','-',20H,'0','9',',','.'
00209D EDD0 3132333435363738        DB  '1','2','3','4','5','6','7','8'
0020A5 EDD8 0102030405060708        DB  01H,02H,03H,04H,05H,06H,07H,08H
0020AD EDE0 090A0B0C0D0E0F10        DB  09H,0AH,0BH,0CH,0DH,0EH,0FH,10H
0020B5 EDE8 1112131415161718        DB  11H,12H,13H,14H,15H,16H,17H,18H
0020BD EDF0 191A1B5B5D000000        DB  19H,1AH,1BH,'[',']',00H,00H,00H
0020C5 EDF8 00003D09003B3A0D        DB  00H,00H,'=',09H,00H,';',':',0DH
                                
                                ;   アドレス下位1バイトが0になるように
       EE00                     CD_TABLE:
0020CD EE00 00D1D2D3D4D5D6D0        DB  $00,$D1,$D2,$D3,$D4,$D5,$D6,$D0 ;月火水木金土日
0020D5 EE08 D8DCD9DADBD7CFCE        DB  $D8,$DC,$D9,$DA,$DB,$D7,$CF,$CE ;年円時分秒
0020DD EE10 601F5F5E1E1B7978        DB  $60,$1F,$5F,$5E,$1E,$1B,$79,$78 ;
0020E5 EE18 5C5D1C1D6DCACDC7        DB  $5C,$5D,$1C,$1D,$6D,$CA,$CD,$C7 ;
0020ED EE20 0061626364656667        DB  $00,$61,$62,$63,$64,$65,$66,$67 ; !"#$%&'
0020F5 EE28 68696B6A2F2A2E2D        DB  $68,$69,$6B,$6A,$2F,$2A,$2E,$2D ;()*+,-./
0020FD EE30 2021222324252627        DB  $20,$21,$22,$23,$24,$25,$26,$27 ;01234567
002105 EE38 28294F2C512B5749        DB  $28,$29,$4F,$2C,$51,$2B,$57,$49 ;89:;<=>?
00210D EE40 5501020304050607        DB  $55,$01,$02,$03,$04,$05,$06,$07 ;@ABCDEFG
002115 EE48 08090A0B0C0D0E0F        DB  $08,$09,$0A,$0B,$0C,$0D,$0E,$0F ;HIJKLMNO
00211D EE50 1011121314151617        DB  $10,$11,$12,$13,$14,$15,$16,$17 ;PQRSTUVW
002125 EE58 18191A52DD54507C        DB  $18,$19,$1A,$52,$DD,$54,$50,$7C ;XYZ[\]^_
00212D EE60 5901020304050607        DB  $59,$01,$02,$03,$04,$05,$06,$07 ;`abcdefg   ATB:1
002135 EE68 08090A0B0C0D0E0F        DB  $08,$09,$0A,$0B,$0C,$0D,$0E,$0F ;hijklmno   ATB:1
00213D EE70 1011121314151617        DB  $10,$11,$12,$13,$14,$15,$16,$17 ;pqrstuvw   ATB:1
002145 EE78 18191ACB35CC705A        DB  $18,$19,$1A,$CB,$35,$CC,$70,$5A ;xyz{|}~    ATB:1
00214D EE80 415346444847B49E        DB  $41,$53,$46,$44,$48,$47,$B4,$9E ;トランプ〇●をぁ   ATB:1
002155 EE88 B2B6BABE9FB3B7BB        DB  $B2,$B6,$BA,$BE,$9F,$B3,$B7,$BB ;ぃぅぇぉゃゅょっ   ATB:1
00215D EE90 BFA385A4A5A69487        DB  $BF,$A3,$85,$A4,$A5,$A6,$94,$87 ;ーあいうえおかき   ATB:1
002165 EE98 889C829884929083        DB  $88,$9C,$82,$98,$84,$92,$90,$83 ;くけこさしすせそ   ATB:1
00216D EEA0 F0BD9DB1B5B9B49E        DB  $F0,$BD,$9D,$B1,$B5,$B9,$B4,$9E ;　。「」、・ヲァ
002175 EEA8 B2B6BABE9FB3B7BB        DB  $B2,$B6,$BA,$BE,$9F,$B3,$B7,$BB ;ィゥェォャョュッ
00217D EEB0 BFA385A4A5A69487        DB  $BF,$A3,$85,$A4,$A5,$A6,$94,$87 ;ーアイウエオカキ
002185 EEB8 889C829884929083        DB  $88,$9C,$82,$98,$84,$92,$90,$83 ;クケコサシスセソ
00218D EEC0 91819A97939589A1        DB  $91,$81,$9A,$97,$93,$95,$89,$A1 ;タチツテトナニヌ
002195 EEC8 AF8B8696A2ABAA8A        DB  $AF,$8B,$86,$96,$A2,$AB,$AA,$8A ;ネノハヒフヘホマ
00219D EED0 8EB0AD8DA7A8A98F        DB  $8E,$B0,$AD,$8D,$A7,$A8,$A9,$8F ;ミムメモヤユヨラ
0021A5 EED8 8CAEAC9BA099BCB8        DB  $8C,$AE,$AC,$9B,$A0,$99,$BC,$B8 ;リルレロワン゛゜
0021AD EEE0 91819A97939589A1        DB  $91,$81,$9A,$97,$93,$95,$89,$A1 ;たちつてとねにぬ   ATB:1
0021B5 EEE8 AF8B8696A2ABAA8A        DB  $AF,$8B,$86,$96,$A2,$AB,$AA,$8A ;ねのはひふへほま   ATB:1
0021BD EEF0 8EB0AD8DA7A8A98F        DB  $8E,$B0,$AD,$8D,$A7,$A8,$A9,$8F ;みむめもやゆよら   ATB:1
0021C5 EEF8 8CAEAC9BA099BCB8        DB  $8C,$AE,$AC,$9B,$A0,$99,$BC,$B8 ;りるれろわん゛゜   ATB:1
       EF00                     DC_TABLE:
0021CD EF00 2041424344454647        DB  $20,$41,$42,$43,$44,$45,$46,$47 ;0
0021D5 EF08 48494A4B4C4D4E4F        DB  $48,$49,$4A,$4B,$4C,$4D,$4E,$4F
0021DD EF10 5051525354555657        DB  $50,$51,$52,$53,$54,$55,$56,$57 ;1
0021E5 EF18 58595A151A1B1411        DB  $58,$59,$5A,$15,$1A,$1B,$14,$11
0021ED EF20 3031323334353637        DB  $30,$31,$32,$33,$34,$35,$36,$37 ;2
0021F5 EF28 38392D3D3B2F2E2C        DB  $38,$39,$2D,$3D,$3B,$2F,$2E,$2C
0021FD EF30 00000000007C0000        DB  $00,$00,$00,$00,$00,$7C,$00,$00 ;3
002205 EF38 0000000000000000        DB  $00,$00,$00,$00,$00,$00,$00,$00
00220D EF40 0080000083008285        DB  $00,$80,$00,$00,$83,$00,$82,$85 ;4
002215 EF48 843F00000000003A        DB  $84,$3F,$00,$00,$00,$00,$00,$3A
00221D EF50 5E3C5B815D40003E        DB  $5E,$3C,$5B,$81,$5D,$40,$00,$3E ;5
002225 EF58 00607F0018191312        DB  $00,$60,$7F,$00,$18,$19,$13,$12
00222D EF60 1021222324252627        DB  $10,$21,$22,$23,$24,$25,$26,$27 ;6
002235 EF68 28292B2A001C0000        DB  $28,$29,$2B,$2A,$00,$1C,$00,$00
00223D EF70 7E00000000000000        DB  $7E,$00,$00,$00,$00,$00,$00,$00 ;7
002245 EF78 171600005F000000        DB  $17,$16,$00,$00,$5F,$00,$00,$00
00224D EF80 00C19A9F9C92CA97        DB  $00,$C1,$9A,$9F,$9C,$92,$CA,$97 ;8
002255 EF88 98C6CFC9D8D3D0D7        DB  $98,$C6,$CF,$C9,$D8,$D3,$D0,$D7
00225D EF90 9EC09DC496C5CBC3        DB  $9E,$C0,$9D,$C4,$96,$C5,$CB,$C3 ;9
002265 EF98 9BDDC2DB99A2878C        DB  $9B,$DD,$C2,$DB,$99,$A2,$87,$8C
00226D EFA0 DCC7CC91939495D4        DB  $DC,$C7,$CC,$91,$93,$94,$95,$D4 ;A
002275 EFA8 D5D6CECDDAD2D9C8        DB  $D5,$D6,$CE,$CD,$DA,$D2,$D9,$C8
00227D EFB0 D1A3888D86A4898E        DB  $D1,$A3,$88,$8D,$86,$A4,$89,$8E ;B
002285 EFB8 DFA58A8FDEA18B90        DB  $DF,$A5,$8A,$8F,$DE,$A1,$8B,$90
00228D EFC0 000000000000001F        DB  $00,$00,$00,$00,$00,$00,$00,$1F ;C
002295 EFC8 00001D7B7D1E0F0E        DB  $00,$00,$1D,$7B,$7D,$1E,$0F,$0E
00229D EFD0 070102030405060D        DB  $07,$01,$02,$03,$04,$05,$06,$0D ;D
0022A5 EFD8 080A0B0C095C0000        DB  $08,$0A,$0B,$0C,$09,$5C,$00,$00
0022AD EFE0 0000000000000000        DB  $00,$00,$00,$00,$00,$00,$00,$00 ;E
0022B5 EFE8 0000000000000000        DB  $00,$00,$00,$00,$00,$00,$00,$00
0022BD EFF0 A000000000000000        DB  $A0,$00,$00,$00,$00,$00,$00,$00 ;F
0022C5 EFF8 0000000000000000        DB  $00,$00,$00,$00,$00,$00,$00,$00
[EOF:M7TABLE.ASM:SHIFT_JIS]
                                    INCLUDE "LDWORK.ASM"
                                
                                ;   LSX-Dodgers WORK0
                                ;
                                ;   CP/M互換BIOS
                                ;   BOOT:アドレス下位1バイトが0になるように
       F000                     AT_WORK:
0022CD F000                         DS  WORKAD-AT_WORK
                                
       F000                     CPM_BOOT:
0022CD F000 C30000          10      JP  0
       F003                     _SYS00:     ;(BDOS)プログラム終了
       F003                     CPM_WBOOT:
0022D0 F003 C3FECF          10      JP  WBOOT1
       F006                     CPM_CONST:
0022D3 F006 C39FD7          10      JP  CONSTX
       F009                     _SYS07:     ;(BDOS)コンソール直接入力
       F009                     CPM_CONIN:
0022D6 F009 C33AD7          10      JP  FLGET
       F00C                     CPM_CONOUT:
0022D9 F00C C344D9          10      JP  CONOUT1
                                
       F00F                     DECBF:              ;10進数表示時のバッファ(5バイト)
0022DC F00F                         DS  5
       F00F                     RR_BUF_HL   EQU DECBF   ;CP/M互換ファイルアクセスの際のランダムレコードの一時的な保管場所
       F011                     RR_BUF_A    EQU DECBF+2 ;計3バイト
                                
0022E1 F014 00                  FDRV:   DB  0
0022E2 F015                     FNAME:  DS  36
002306 F039                     SFILE:  DS  33      ;DRV FILENAME
                                
002327 F05A                         DS  3
                                
00232A F05D 0000                LEFTX:  DW  0
00232C F05F 0000                DTAX:   DW  0
                                
       F061                     ZERO:
       F061                     BEEPD:
00232E F061 008E01000B000C10        DB  0,08EH,1,0,00BH,0,00CH,010H
002336 F069 073E08100D00FF          DB  007H,03EH,008H,010H,00DH,0,0FFH
       F062                     RTC_YY  EQU BEEPD+1
       F063                     RTC_MW  EQU BEEPD+2
       F064                     RTC_DD  EQU BEEPD+3
       F065                     RTC_TT  EQU BEEPD+4
       F066                     RTC_MM  EQU BEEPD+5
       F067                     RTC_SS  EQU BEEPD+6
       F062                     ROM_SLT EQU BEEPD+1
                                
00233D F070 00                  CHECK:  DB  0
                                
00233E F071 4F4B24              OK: DB  "OK$"
002341 F074                         DS  5
002346 F079 4572726F722124      COMERM: DB  "Error!$"
                                ;   システムワークエリア
                                ;   _CYL0:アドレス下位1バイトが080Hになるように
00234D F080 FF                  _CYL0:  DB  0FFH    ;Cylinder
00234E F081 FF                  _CYL1:  DB  0FFH    ;Cylinder
00234F F082 FF                  _CYL2:  DB  0FFH    ;Cylinder
002350 F083 FF                  _CYL3:  DB  0FFH    ;Cylinder
002351 F084 00                  _DRIVE: DB  0   ;unit number
       F085                     _SEEKSP:
002352 F085 00                      DB  0   ;Seek speed
002353 F086 32                  _ISEEK: DB  50  ;
002354 F087                         DS  1
002355 F088 00                  _DRV:   DB  0
002356 F089 FF                  _DSK:   DB  0FFH
002357 F08A 8000                _DTA:   DW  00080H
002359 F08C 0000                _CTC:   DW  0
00235B F08E 0000                _TXADR: DW  0
00235D F090 0000                _KEYPS: DW  0
00235F F092 00FF                _KEYD:  DW  0FF00H  ;キーデータ
002361 F094 8310                _KEYSP: DB  KEYSP_L,KEYSP_H ;オートリピートの速度
       F096                     _COLORF:
002363 F096 70                      DB  COLORF  ;色
002364 F097 19                  _LINE:  DB  LINE
                                
002365 F098 0000                _FCB:   DW  0   ;SEARCH FILES
002367 F09A 0000                _FBPS:  DW  0   ;    //
002369 F09C 0000                _FBAD:  DW  0   ;    //
00236B F09E 00                  _FBCNT: DB  0   ;    //
00236C F09F 00                  _FILEN: DB  0   ;    //
00236D F0A0 00                  _DIRF:  DB  0   ;bit7:ディレクトリ bit0-6:セクタインデックス
00236E F0A1                         DS  1
       F0A2                     _WTFATF:
00236F F0A2 00                      DB  0   ;FATバッファの更新フラグ
002370 F0A3                         DS  1
002371 F0A4 00                  _WTDBF: DB  0   ;データバッファの更新フラグ
002372 F0A5 FF                  _DBDRV: DB  0FFH    ;データバッファにあるデータを読み込んだドライブ
002373 F0A6 0000                _DBSEC: DW  0   ;データバッファにあるデータを読み込んだセクタ番号
002375 F0A8 0000                _DPB:   DW  0
       F0AA                     _FATDRV:
002377 F0AA FF                      DB  0FFH    ;FATバッファに読み込んでいるドライブ
002378 F0AB 00                  _FATIX: DB  0   ;FATバッファに読み込んでいるインデックス
       F0AC                     _FAKEFREE:
002379 F0AC 0000                    DW  0   ;偽の残量（FATサイズが大きくなると重くなるのでその対策）
                                
00237B F0AE                         DS  2
                                
       F0B0                     CRTCD:
00237D F0B0 6F                      DB  06FH
       F0B1                     _WIDTH:
00237E F0B1 28                      DB  WIDTH
       F0B2                     TVRAMTOP:
00237F F0B2 5938                    DB  059H,038H
002381 F0B4 1F02                    DB  01FH,002H
       F0B6                     _LINE2:
002383 F0B6 19                      DB  019H
       F0B7                     WKE4:
002384 F0B7 1C                      DB  01CH
       F0B8                     WKE6:
002385 F0B8 00                      DB  000H
       F0B9                     WK40:
002386 F0B9 07                      DB  007H
       F0BA                     _PAGE_MINUS:
002387 F0BA 18FC                    DW  0-WIDTH*LINE
       F0BC                     _WIDTH_MINUS:
002389 F0BC D8FF                    DW  0-WIDTH
       F0BE                     WK30:
00238B F0BE 0C                      DB  00CH
       F0BF                     WK31:
       F0BF                     WK1FD0:
00238C F0BF 20                      DB  020H
                                
00238D F0C0 0000                CTC0:   DW  INTCTCE
00238F F0C2 0000                CTC1:   DW  INTCTCE
002391 F0C4 0000                CTC2:   DW  INTCTCE
002393 F0C6 0000                CTC3:   DW  INTCTCE
002395 F0C8 0000                INTVEC: DW  INT
                                
                                ;   LSX-Dodgers 独自BIOS
                                
002397 F0CA C38BDA          10  _INKEY: JP  INKEY
00239A F0CD C330D8          10  _PRINT: JP  PRINT
00239D F0D0 C3FFDA          10  _SCRN:  JP  SCRN
0023A0 F0D3 C3EDD9          10  _POS:   JP  POS
0023A3 F0D6 C312D9          10  _LOC:   JP  LOC
       F0D9                     _CHGDRV:
0023A6 F0D9 C3AEE7          10      JP  CHGDRV
       F0DC                     _GETDPB:
0023A9 F0DC C36CE8          10      JP  GETDPB
       F0DF                     _FFLUSH:
0023AC F0DF C38AE8          10      JP  FFLUSH
       F0E2                     _RDFATX:
0023AF F0E2 C385E4          10      JP  RDFATX
0023B2 F0E5 C3B4E5          10  _RDFAT: JP  RDFAT
0023B5 F0E8 C345E9          10  _WTTRK: JP  WTTRK
0023B8 F0EB C3A2E9          10  _FDRD:  JP  FDRD
0023BB F0EE C34BE9          10  _FDWT:  JP  FDWT
       F0F1                     _BPB2DPB:
0023BE F0F1 C34AE6          10      JP  BPB2DPB
       F0F4                     _BREAK:
0023C1 F0F4 C391D1          10      JP  END_BATCH
       F0F7                     _GNCL:
0023C4 F0F7 C32EE5          10      JP  GNCL        ; self-modifying code
       F0F8                     GNCPAT  EQU $-2
       F0FA                     _SNCL:
0023C7 F0FA C351E5          10      JP  SNCL        ; self-modifying code
       F0FB                     SNCPAT  EQU $-2
       F0FD                     _COMANL:
0023CA F0FD C34AD0          10      JP  COMANL
                                
       F100                     _WE:
[EOF:LDWORK.ASM:SHIFT_JIS]
                                    INCLUDE "LDCALL.ASM"
                                
                                ;   LSX-Dodgers システムコール(BDOS)
                                ;
                                ;   LSX-Dodgers SYSTEM CALL
                                ;   STABLE:アドレス下位1バイトが0になるように
                                
       F100                     STABLE:
                                ;0
0023CD F100 03F011D71DD7E0DC        DW  _SYS00,_SYS01,_SYS02,_SYS03
0023D5 F108 78D478D422D709F0        DW  _SYS04,_SYS05,_SYS06,_SYS07
0023DD F110 2AD77AD470D79CD7        DW  _SYS08,_SYS09,_SYS0A,_SYS0B
0023E5 F118 8FD494D4A3D4B4D4        DW  _SYS0C,_SYS0D,_SYS0E,_SYS0F
                                ;1
0023ED F120 08D54FD598D5C9D5        DW  _SYS10,_SYS11,_SYS12,_SYS13
0023F5 F128 D1D5E7D5FCD5F4D5        DW  _SYS14,_SYS15,_SYS16,_SYS17
0023FD F130 43D648D64DD653D6        DW  _SYS18,_SYS19,_SYS1A,_SYS1B
002405 F138 78D479D678D47DD6        DW  _SYS1C,_SYS1D,_SYS1E,_SYS1F
                                ;2
00240D F140 78D433D63BD684D6        DW  _SYS20,_SYS21,_SYS22,_SYS23
002415 F148 AAD678D435E10DE2        DW  _SYS24,_ERROR,_SYS26,_SYS27
00241D F150 3BD6B4D6ADD7E0DC        DW  _SYS28,_SYS29,_SYS2A,_SYS2B
002425 F158 B3D7E0DC78D4D5D6        DW  _SYS2C,_SYS2D,_SYS2E,_SYS2F
                                ;3
00242D F160 CFD678D478D478D4        DW  _SYS30,_ERROR,_ERROR,_ERROR
002435 F168 78D478D478D478D4        DW  _ERROR,_ERROR,_ERROR,_ERROR
00243D F170 78D4E0DCE0DCF6D6        DW  _ERROR,_SYS39,_SYS3A,_SYS5A
                                ;DOS2
002445 F178 5BD4                    DW  _DOS2
                                
002447 F17A                         DS  1
       F17B                     _MAX_SEC_SZ_H:
002448 F17B 04                      DB  MAX_SEC_SZ_H
       F17C                     _FATBF:
002449 F17C 00F3                    DW  FATBF
       F17E                     _DTBUF:
00244B F17E 00FB                    DW  DTBUF
                                
                                ;   コントロールコードテーブル
                                ;   CTRLTB:アドレス下位1バイトが080Hになるように
                                
       F180                     CTRLTB:
00244D F180 95D895D8CBD8C0D9        DW  CTRL00,CTRL00,CTRL02,CTRL03 ;  A,B,C
002455 F188 BAD9F7D8ABD954D9        DW  CTRL04,CTRL05,CTRL06,CTRL07 ;D,E,F,G
00245D F190 A1D8BCD8C3D925D9        DW  CTRL08,CTRL09,CTRL0A,CTRL0B ;H,I,J,K
002465 F198 A8D90DD9D5D995D8        DW  CTRL0C,CTRL0D,CTRL0E,CTRL00 ;L,M,N,O
00246D F1A0 95D895D81DD995D8        DW  CTRL00,CTRL00,CTRL12,CTRL00 ;P,Q,R,S
002475 F1A8 95D895D895D895D8        DW  CTRL00,CTRL00,CTRL00,CTRL00 ;T,U,V,W
00247D F1B0 95D895D8A8D92CD9        DW  CTRL00,CTRL00,CTRL0C,CTRL1B ;X,Y,Z,ESC
002485 F1B8 84D8A8D8B1D8C3D9        DW  CTRL1C,CTRL1D,CTRL1E,CTRL1F ;→,←,↑,↓
                                
00248D F1C0 0200                M2D:    DW  2
00248F F1C2 FD02                    DB  0FDH,2
002491 F1C4 6401                    DW  356
002493 F1C6 FF0728090182            DB  0FFH,7,40,9,1,082H
002499 F1CC 0500A7000800            DW  5,0A7H,8
                                
00249F F1D2 0200                M2HD:   DW  2
0024A1 F1D4 FE01                    DB  0FEH,1
0024A3 F1D6 C704                    DW  1223
0024A5 F1D8 FE064D080184            DB  0FEH,6,77,8,1,084H
0024AB F1DE 0500A7000900            DW  5,0A7H,9
                                
0024B1 F1E4 1617                SDDATA: DB  22,23       ;(FCB)ファイルを最後に変更した時刻
0024B3 F1E6 1415                    DB  20,21       ;(FCB)ファイルを最後に変更した日付
0024B5 F1E8 1A1B                    DB  26,27       ;(FCB)ファイルの先頭クラスタ
0024B7 F1EA 10111213                DB  16,17,18,19 ;(FCB)ファイルのサイズ(バイト単位)
       F1EE                     SDDATAE:
                                
0024BB F1EE                         DS  2
       F1F0                     _FCB_BAT:
0024BD F1F0 26EB                    DW  FCB_BAT
       F1F2                     _PATH:
0024BF F1F2 C5EA                    DW  PATHD
                                
0024C1 F1F4                     SCDIR:  DS  2       ;+14 +15
0024C3 F1F6                     SFBPS:  DS  2       ;FBPS
0024C5 F1F8                     SFNDF:  DS  2       ;FILEN DIRF
                                
0024C7 F1FA 0000                _FATPS: DW  0
0024C9 F1FC 0000                _DIRPS: DW  0
0024CB F1FE 0000                _CLPS:  DW  0
                                
       F200                     _PE:
[EOF:LDCALL.ASM:SHIFT_JIS]
                                    INCLUDE "M7DPB.ASM"
                                
                                ;   LSX-Dodgers DPB
                                ;   MZ-700/1500
                                
       F200                     _DEVICE:
                                
                                ;   A:
                                
0024CD F200 0200                    DW  2   ;DPB_FATLN
0024CF F202 EBF0                    DW  _FDRD   ;DPB_DRD
0024D1 F204 EEF0                    DW  _FDWT   ;DPB_DWT
0024D3 F206 FD                      DB  0FDH    ;DPB_FATID
0024D4 F207 02                      DB  2   ;DPB_SECPCL
0024D5 F208 6401                    DW  356 ;DPB_MAXCL
0024D7 F20A FF                      DB  0FFH    ;DPB_FDMODE 0FFH=2D / 0FEH=2HD
0024D8 F20B 07                      DB  7   ;DPB_DIRSCNT
0024D9 F20C 28                      DB  40  ;DPB_MAXCYL
0024DA F20D 09                      DB  9   ;DPB_MAXSEC Number of sectors
0024DB F20E 01                      DB  1   ;DPB_FATPS
0024DC F20F 82                      DB  082H    ;DPB_BPS
0024DD F210 0500                    DW  5   ;DPB_DIRPS
0024DF F212 27                      DB  027H    ;DPB_DEVICE Device Number
0024E0 F213 00                      DB  0   ;DPB_UNITNO
0024E1 F214 0800                    DW  8   ;DPB_ADDCL
0024E3 F216 0000                    DW  0   ;DPB_16
0024E5 F218 0000                    DW  0   ;DPB_18
0024E7 F21A 0000                    DW  0   ;DPB_SDIR
0024E9 F21C 46444430                DB  "FDD0"  ;DPB_NAME
                                
                                ;   B:
                                
0024ED F220 0200                    DW  2   ;DPB_FATLN
0024EF F222 EBF0                    DW  _FDRD   ;DPB_DRD
0024F1 F224 EEF0                    DW  _FDWT   ;DPB_DWT
0024F3 F226 FD                      DB  0FDH    ;DPB_FATID
0024F4 F227 02                      DB  2   ;DPB_SECPCL
0024F5 F228 6401                    DW  356 ;DPB_MAXCL
0024F7 F22A FF                      DB  0FFH    ;DPB_FDMODE 0FFH=2D / 0FEH=2HD
0024F8 F22B 07                      DB  7   ;DPB_DIRSCNT
0024F9 F22C 28                      DB  40  ;DPB_MAXCYL
0024FA F22D 09                      DB  9   ;DPB_MAXSEC Number of sectors
0024FB F22E 01                      DB  1   ;DPB_FATPS
0024FC F22F 82                      DB  082H    ;DPB_BPS
0024FD F230 0500                    DW  5   ;DPB_DIRPS
0024FF F232 27                      DB  027H    ;DPB_DEVICE Device Number
002500 F233 01                      DB  1   ;DPB_UNITNO
002501 F234 0800                    DW  8   ;DPB_ADDCL
002503 F236 0000                    DW  0   ;DPB_16
002505 F238 0000                    DW  0   ;DPB_18
002507 F23A 0000                    DW  0   ;DPB_SDIR
002509 F23C 46444431                DB  "FDD1"  ;DPB_NAME
                                
                                ;   C:
                                
00250D F240 0100                    DW  1   ;DPB_FATLN
00250F F242 5FEA                    DW  CDRD    ;DPB_DRD
002511 F244 4CEA                    DW  CDWT    ;DPB_DWT
002513 F246 FA                      DB  0FAH    ;DPB_FATID
002514 F247 01                      DB  1   ;DPB_SECPCL
002515 F248 7A00                    DW  122 ;DPB_MAXCL
002517 F24A 00                      DB  0   ;DPB_FDMODE
002518 F24B 06                      DB  6   ;DPB_DIRSCNT
002519 F24C 00                      DB  0   ;DPB_MAXCYL
00251A F24D 00                      DB  0   ;DPB_MAXSEC
00251B F24E 01                      DB  1   ;DPB_FATPS
00251C F24F 01                      DB  1   ;DPB_BPS
00251D F250 0200                    DW  2   ;DPB_DIRPS
00251F F252 0C                      DB  00CH    ;DPB_DEVICE
002520 F253 F8                      DB  0F8H    ;DPB_UNITNO
002521 F254 0600                    DW  6   ;DPB_ADDCL
002523 F256 0000                    DW  0   ;DPB_16
002525 F258 0000                    DW  0   ;DPB_18
002527 F25A 0000                    DW  0   ;DPB_SDIR
002529 F25C 434D4F53                DB  "CMOS"  ;DPB_NAME
                                
                                ;   D:
                                
00252D F260                         DS  32
                                
                                ;   E:
                                
       F280                     EMMFL:
00254D F280 0000                    DW  0   ;DPB_FATLN
00254F F282 16EA                    DW  EDRD    ;DPB_DRD
002551 F284 09EA                    DW  EDWT    ;DPB_DWT
002553 F286 FA                      DB  0FAH    ;DPB_FATID
002554 F287 02                      DB  2   ;DPB_SECPCL
002555 F288 0000                    DW  0   ;DPB_MAXCL
002557 F28A 00                      DB  0   ;DPB_FDMODE
002558 F28B 10                      DB  16  ;DPB_DIRSCNT
002559 F28C 00                      DB  0   ;DPB_MAXCYL
00255A F28D 00                      DB  0   ;DPB_MAXSEC
00255B F28E 01                      DB  1   ;DPB_FATPS
00255C F28F 01                      DB  1   ;DPB_BPS
00255D F290 0000                    DW  0   ;DPB_DIRPS
00255F F292 26                      DB  026H    ;DPB_DEVICE
002560 F293 00                      DB  0   ;DPB_UNITNO
002561 F294 0000                    DW  0   ;DPB_ADDCL
002563 F296 0000                    DW  0   ;DPB_16
002565 F298 0000                    DW  0   ;DPB_18
002567 F29A 0000                    DW  0   ;DPB_SDIR
002569 F29C 454D4D30                DB  "EMM0"  ;DPB_NAME
                                
                                ;   F:
                                
00256D F2A0 0200                    DW  2   ;DPB_FATLN
00256F F2A2 76EA                    DW  RDRD    ;DPB_DRD
002571 F2A4 72EA                    DW  RDWT    ;DPB_DWT
002573 F2A6 FA                      DB  0FAH    ;DPB_FATID
002574 F2A7 01                      DB  1   ;DPB_SECPCL
002575 F2A8 F600                    DW  246 ;DPB_MAXCL
002577 F2AA 00                      DB  0   ;DPB_FDMODE
002578 F2AB 09                      DB  9   ;DPB_DIRSCNT
002579 F2AC 00                      DB  0   ;DPB_MAXCYL
00257A F2AD 00                      DB  0   ;DPB_MAXSEC
00257B F2AE 01                      DB  1   ;DPB_FATPS
00257C F2AF 01                      DB  1   ;DPB_BPS
00257D F2B0 0300                    DW  3   ;DPB_DIRPS
00257F F2B2 0F                      DB  00FH    ;DPB_DEVICE
002580 F2B3 00                      DB  0   ;DPB_UNITNO
002581 F2B4 0A00                    DW  10  ;DPB_ADDCL
002583 F2B6 0000                    DW  0   ;DPB_16
002585 F2B8 0000                    DW  0   ;DPB_18
002587 F2BA 0000                    DW  0   ;DPB_SDIR
002589 F2BC 52414D46                DB  "RAMF"  ;DPB_NAME
                                
                                ;   G:
       F2C0                     GRAMFL:
00258D F2C0 0100                    DW  1   ;DPB_FATLN
00258F F2C2 A1EA                    DW  GDRD    ;DPB_DRD
002591 F2C4 8CEA                    DW  GDWT    ;DPB_DWT
002593 F2C6 FA                      DB  0FAH    ;DPB_FATID
002594 F2C7 01                      DB  1   ;DPB_SECPCL
002595 F2C8 5A00                    DW  90  ;DPB_MAXCL
002597 F2CA 00                      DB  0   ;DPB_FDMODE
002598 F2CB 06                      DB  6   ;DPB_DIRSCNT
002599 F2CC 00                      DB  0   ;DPB_MAXCYL
00259A F2CD 00                      DB  0   ;DPB_MAXSEC
00259B F2CE 01                      DB  1   ;DPB_FATPS
00259C F2CF 01                      DB  1   ;DPB_BPS
00259D F2D0 0200                    DW  2   ;DPB_DIRPS
00259F F2D2 05                      DB  005H    ;DPB_DEVICE
0025A0 F2D3 F8                      DB  0F8H    ;DPB_UNITNO
0025A1 F2D4 0600                    DW  6   ;DPB_ADDCL
0025A3 F2D6 0000                    DW  0   ;DPB_16
0025A5 F2D8 0000                    DW  0   ;DPB_18
0025A7 F2DA 0000                    DW  0   ;DPB_SDIR
0025A9 F2DC 4752414D                DB  "GRAM"  ;DPB_NAME
                                
                                ;   H:
0025AD F2E0                         DS  3
0025B0 F2E3 00                      DB  0
[EOF:M7DPB.ASM:UTF_8]
                                
0025B1 A5B1                         ORG $$+OFFSET,$$    ;$DEPHASE
       A5B1                     LAST_ADR:
                                
                                    END
[EOF:M7.ASM:UTF_8]
