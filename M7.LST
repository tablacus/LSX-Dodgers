                                ;*** AILZ80ASM *** Z-80 Assembler, version 1.0.0.0, LST:Full:4
                                ;   LSX-Dodgers for MZ-700/1500
                                ;   Programmed by
                                ;   Gaku (Lovers/Tablacus)
                                
                                    INCLUDE "M7DEF.ASM"
                                
                                ;   LSX-Dodgers DEF
                                ;   MZ-700/1500
                                
       0001                     MAC EQU 1   ;MZ-700/1500
       0000                     DEV EQU 0
                                
       8080                     RUN EQU 08080H
       8000                     OFFSET  EQU RUN-128
       CF06                     BDOS    EQU 0CF06H
       EC40                     TABLEAD EQU 0EC40H
       EF00                     WORKAD  EQU 0EF00H
       F200                     FATBF   EQU 0F200H
       FA00                     DTBUF   EQU 0FA00H
       FE00                     KEYBF   EQU 0FE00H
       FF00                     KBUF    EQU 0FF00H
       FFD9                     TRAP38  EQU 0FFD9H
       0028                     WIDTH   EQU 40
       0019                     LINE    EQU 25
       0071                     COLORF  EQU 071H
       0010                     KEYSP_H EQU 16
       0083                     KEYSP_L EQU 131
       000A                     COMS    EQU 10
[EOF:M7DEF.ASM:UTF_8]
                                    INCLUDE "LDDEF.ASM"
                                
                                ;   LSX-Dodgers DEF
                                
       0001                     VER_1   EQU 1
       0005                     VER_2   EQU 5
       0000                     VER_3   EQU 0
       1D01                     MACW    EQU MAC + 01D00H    ;機種フラグとLD判別フラグ
       0001                     MACD    EQU MAC + DEV * 256 ;機種フラグとデバイスフラグ
       0150                     VER EQU VER_1 * 256 + VER_2 * 16 + VER_3
                                
       0005                     SYSTEM  EQU 00005H
       000F                     JP_HL   EQU 0000FH
       005C                     FCB1    EQU 0005CH
       006C                     FCB2    EQU 0006CH
       005D                     FCB1FN  EQU FCB1+1
       006D                     FCB2FN  EQU FCB2+1
       0080                     DTA1    EQU 00080H
                                
       FFCA                     EXTBIO  EQU 0FFCAH
                                
[EOF:LDDEF.ASM:SHIFT_JIS]
                                
000000 8000                         ORG OFFSET
                                                    ;MZTヘッダ128バイト
000000 8000 01                      DB  1           ;ファイルモード
000001 8001 4C44202020202020        DB  "LD           "     ;ファイル名(13)
            2020202020          
00000E 800E 535953                  DB  "SYS"           ;拡張子(3)
000011 8011 0D                      DB  $0D
000012 8012 0824                    DW  LAST_ADR-RUN        ;サイズ
000014 8014 8080                    DW  RUN         ;開始アドレス
000016 8016 8080                    DW  RUN         ;実行アドレス
000018 8018                         DS  104
                                
                                    INCLUDE "M7INIT.ASM"
                                
                                ;   LSX-Dodgers INIT
                                ;   MZ-700/1500
                                
000080 8080 C38780          10      JP  START
000083 8083 011D                    DW  MACW
000085 8085 5001                    DW  VER
                                
       8087                     START:
000087 8087 F3               4      DI
000088 8088 ED56             8      IM  1
00008A 808A 318780          10      LD  SP,START
00008D 808D CD9B80          17      CALL    INIT        ;NZならAUTOEXECを実行
000090 8090 210000          10      LD  HL,0
000093 8093 E5              11      PUSH    HL
000094 8094 C8              11      RET Z
000095 8095 114481          10      LD  DE,AUTOD
000098 8098 C3FDEF          10      JP  _COMANL
                                
       809B                     INIT:
00009B 809B D3E0            11      OUT (0E0H),A    ;DRAM(0000H-0FFFH)
00009D 809D D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
00009F 809F 21AA81          10      LD  HL,INITE
0000A2 80A2 1106CF          10      LD  DE,BDOS
0000A5 80A5 01DE22          10      LD  BC,LAST_ADR-INITE
0000A8 80A8 EDB0                    LDIR
0000AA 80AA 217B81          10      LD  HL,M7BEEPD
0000AD 80AD 1162EF          10      LD  DE,BEEPD+1
0000B0 80B0 010800          10      LD  BC,M7BEEPE-M7BEEPD
0000B3 80B3 EDB0                    LDIR
                                
0000B5 80B5 210000          10      LD  HL,0
0000B8 80B8 065C             7      LD  B,05CH
0000BA 80BA 3EEF             7      LD  A,0EFH      ;RST 28H
0000BC 80BC CD72DD          17      CALL    FILL_MEMORY
0000BF 80BF 06A4             7      LD  B,0A4H
0000C1 80C1 AF               4      XOR A
0000C2 80C2 CD72DD          17      CALL    FILL_MEMORY
                                
0000C5 80C5 3EC3             7      LD  A,0C3H      ;JP
0000C7 80C7 2103EF          10      LD  HL,CPM_WBOOT
0000CA 80CA 320000          13      LD  (00000H),A
0000CD 80CD 220100          16      LD  (00001H),HL ;IPL
                                
0000D0 80D0 21011D          10      LD  HL,MACW     ;3 bit7  DPB Compatible LA(1)
0000D3 80D3 220300          16      LD  (00003H),HL ;  bit6-0 Machine
                                ;               ;4 LSX-Dodgers(01DH)
0000D6 80D6 2106CF          10      LD  HL,BDOS
0000D9 80D9 320500          13      LD  (00005H),A
0000DC 80DC 220600          16      LD  (00006H),HL ;BDOS
                                
0000DF 80DF 21D9FF          10      LD  HL,TRAP38   ;TRAP38
0000E2 80E2 322800          13      LD  (00028H),A
0000E5 80E5 222900          16      LD  (00029H),HL ;RST 028H
                                
0000E8 80E8 323800          13      LD  (00038H),A
0000EB 80EB 210ECF          10      LD  HL,IO_INT8253
0000EE 80EE 223900          16      LD  (00039H),HL
                                
0000F1 80F1 3EEF             7      LD  A,CPM_BOOT/256
0000F3 80F3 320B00          13      LD  (0000BH),A
                                
0000F6 80F6 3EE9             7      LD  A,0E9H      ;JP (HL)
0000F8 80F8 320F00          13      LD  (0000FH),A
                                
0000FB 80FB 3A7DF0          13      LD  A,(_FATBF+1)
0000FE 80FE 321300          13      LD  (00013H),A
                                
000101 8101 3A7FF0          13      LD  A,(_DTBUF+1)
000104 8104 321700          13      LD  (00017H),A
                                
000107 8107 3EFE             7      LD  A,KEYBF/256
000109 8109 321B00          13      LD  (0001BH),A
                                
00010C 810C 3EFF             7      LD  A,KBUF/256
00010E 810E 321F00          13      LD  (0001FH),A
                                
000111 8111 215001          10      LD  HL,VER
000114 8114 225A00          16      LD  (0005AH),HL
                                
000117 8117 215081          10      LD  HL,INIMES
00011A 811A CDDED5          17      CALL    MSX
       811D                     INIT1:
00011D 811D F3               4      DI
00011E 811E 1100FF          10      LD  DE,0FF00H
000121 8121 0600             7      LD  B,0
000123 8123 CDBED3          17      CALL    ZERO_MEMORY_DE
000126 8126 21CAFF          10      LD  HL,EXTBIO
000129 8129 36C9            10      LD  (HL),0C9H   ;RET
00012B 812B 23               6      INC HL
00012C 812C 060E             7      LD  B,TRAP38-EXTBIO-1
00012E 812E 3EEF             7      LD  A,0EFH      ;RST 28H
000130 8130 CD72DD          17      CALL    FILL_MEMORY
000133 8133 218381          10      LD  HL,AT_TRAP38
000136 8136 11D9FF          10      LD  DE,TRAP38
000139 8139 012700          10      LD  BC,AT_TRAPE-AT_TRAP38
00013C 813C EDB0                    LDIR
                                
00013E 813E CD4DDC          17      CALL    CHKEY
000141 8141 FE03             7      CP  3
000143 8143 C9              10      RET
                                
000144 8144 4155544F45584543    AUTOD:  DB  "AUTOEXEC "
            20                  
00014D 814D 413A00              AUTODV: DB  "A:",0
                                
000150 8150 0C4C53582D446F64    INIMES: DB  00CH,"LSX-Dodgers for MZ-700/1500 v"
            6765727320666F72    
            204D5A2D3730302F    
            313530302076        
00016E 816E 312E                    DB  030H + VER_1, '.'
000170 8170 3530                    DB  030H + VER_2 ,030H + VER_3
000172 8172 61                      DB  "a"
000173 8173 2047616B750D0A          DB  ' Gaku',0DH,0AH
00017A 817A 00                      DB  0
                                
       817B                     M7BEEPD:
00017B 817B 0801                    DB  8,1
00017D 817D 0736                    DB  7,036H
00017F 817F 04F9                    DB  4,0F9H
000181 8181 0403                    DB  4,3
       8183                     M7BEEPE:
                                
       8183                     AT_TRAP38:
000183 FFD9                         ORG TRAP38,AT_TRAP38-OFFSET
000183 FFD9 210000          10      LD  HL,0
000186 FFDC E3              19      EX  (SP),HL
000187 FFDD 3E24             7      LD  A,'$'
000189 FFDF CDB8D8          17      CALL    MSG_A
00018C FFE2 2B               6      DEC HL
00018D FFE3 7C               4      LD  A,H
00018E FFE4 CDE8FF          17      CALL    PRHX
000191 FFE7 7D               4      LD  A,L
       FFE8                     PRHX:
000192 FFE8 F5              11      PUSH    AF
000193 FFE9 07               4      RLCA
000194 FFEA 07               4      RLCA
000195 FFEB 07               4      RLCA
000196 FFEC 07               4      RLCA
000197 FFED CDF1FF          17      CALL    PRHX2
00019A FFF0 F1              10      POP AF
       FFF1                     PRHX2:
00019B FFF1 E60F             7      AND 00FH
00019D FFF3 FE0A             7      CP  10
00019F FFF5 3F               4      CCF
0001A0 FFF6 CE30             7      ADC A,'0'
0001A2 FFF8 27               4      DAA
0001A3 FFF9 C3B8D8          10      JP  MSG_A
0001A6 FFFC                         DS  4
       81AA                         ORG $$+OFFSET   ;$DEPHASE
       81AA                     AT_TRAPE:
                                
       81AA                     INITE:
0001AA CF06                         ORG BDOS,INITE-OFFSET
                                
0001AA CF06 C309CF          10      JP  IO_BDOS
[EOF:M7INIT.ASM:SHIFT_JIS]
                                    INCLUDE "M7BANK.ASM"
                                
                                ;   LSX-Dodgers IO
                                ;   MZ-700/1500
                                ;   VRAM/KEY/TIMER(0D000H-0EFFFH)にアクセスするので0D000H-0FFFFHに置けない部分
                                ;
                                
       CF09                     IO_BDOS:
0001AD CF09 D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
0001AF CF0B C39DD5          10      JP  BDOS0
                                
       CF0E                     IO_INT8253:
0001B2 CF0E F3               4      DI
0001B3 CF0F F5              11      PUSH    AF
0001B4 CF10 D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
0001B6 CF12 3E01             7      LD  A,1
0001B8 CF14 3206E0          13      LD  (0E006H),A  ;8253 Ch.2 カウンタ
0001BB CF17 AF               4      XOR A
0001BC CF18 3206E0          13      LD  (0E006H),A  ;8253 Ch.2 カウンタ
0001BF CF1B D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
0001C1 CF1D C372D8          10      JP  INT8253 
                                
       CF20                     RDKEYDATA:
0001C4 CF20 F3               4      DI
0001C5 CF21 D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
0001C7 CF23 3200E0          13      LD  (0E000H),A
0001CA CF26 3A01E0          13      LD  A,(E001H)
0001CD CF29 D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
0001CF CF2B FB               4      EI
0001D0 CF2C C9              10      RET
                                
       CF2D                     RD556VSYNC:
0001D1 CF2D F3               4      DI
0001D2 CF2E D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
0001D4 CF30 3A02E0          13      LD  A,(0E002H)
0001D7 CF33 D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
0001D9 CF35 FB               4      EI
0001DA CF36 C9              10      RET
                                
       CF37                     RDMMIO:
0001DB CF37 F3               4      DI
0001DC CF38 D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
0001DE CF3A 7E               7      LD  A,(HL)
0001DF CF3B D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
0001E1 CF3D FB               4      EI
0001E2 CF3E C9              10      RET
                                
       CF3F                     WRMMIO:
0001E3 CF3F F3               4      DI
0001E4 CF40 D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
0001E6 CF42 77               7      LD  (HL),A
0001E7 CF43 D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
0001E9 CF45 FB               4      EI
0001EA CF46 C9              10      RET
                                
       CF47                     RDMMIO_BC:
0001EB CF47 F3               4      DI
0001EC CF48 D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
0001EE CF4A 0A               7      LD  A,(BC)
0001EF CF4B D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
0001F1 CF4D FB               4      EI
0001F2 CF4E C9              10      RET
                                
       CF4F                     WRMMIO_BC:
0001F3 CF4F F3               4      DI
0001F4 CF50 D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
0001F6 CF52 02               7      LD  (BC),A
0001F7 CF53 D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
0001F9 CF55 FB               4      EI
0001FA CF56 C9              10      RET
                                
       CF57                     IO_PRINT:
0001FB CF57 F3               4      DI
0001FC CF58 D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
0001FE CF5A 77               7      LD  (HL),A
0001FF CF5B CBDC             8      SET 3,H
000201 CF5D 71               7      LD  (HL),C
000202 CF5E D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
000204 CF60 FB               4      EI
000205 CF61 C9              10      RET
                                
       CF62                     IO_CLR:
000206 CF62 F3               4      DI
000207 CF63 D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
       CF65                     C1AX1:
000209 CF65 7A               4      LD  A,D
00020A CF66 C6D0             7      ADD A,0D0H
00020C CF68 57               4      LD  D,A
00020D CF69 AF               4      XOR A
00020E CF6A 12               7      LD  (DE),A      ;Text
00020F CF6B CBDA             8      SET 3,D
       CF6E                     ICSMC   EQU $+1
000211 CF6D 3E00             7      LD  A,0     ;自己書き換え
000213 CF6F 12               7      LD  (DE),A      ;Color
000214 CF70 13               6      INC DE
000215 CF71 7A               4      LD  A,D
000216 CF72 D6D8             7      SUB 0D8H
000218 CF74 57               4      LD  D,A
000219 CF75 2118FC          10      LD  HL,0-WIDTH*LINE
00021C CF78 19              11      ADD HL,DE
00021D CF79 30EA            12      JR  NC,C1AX1
00021F CF7B E1              10      POP HL
000220 CF7C D1              10      POP DE
000221 CF7D D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
000223 CF7F FB               4      EI
000224 CF80 C9              10      RET
                                
       CF81                     IO_CLLINE:
000225 CF81 F3               4      DI
000226 CF82 D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
       CF84                     CLLINE1:
000228 CF84 CB9C             8      RES 3,H
00022A CF86 77               7      LD  (HL),A      ;Text
00022B CF87 CBDC             8      SET 3,H
00022D CF89 71               7      LD  (HL),C      ;Color
00022E CF8A 23               6      INC HL
00022F CF8B 10F7            13      DJNZ    CLLINE1
000231 CF8D D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
000233 CF8F FB               4      EI
000234 CF90 C9              10      RET
                                
       CF91                     IO_INS:
000235 CF91 F3               4      DI
000236 CF92 D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
       CF94                     IO_INS1:
000238 CF94 CDABCF          17      CALL    C12S
00023B CF97 23               6      INC HL
00023C CF98 10FA            13      DJNZ    IO_INS1
00023E CF9A D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
000240 CF9C FB               4      EI
000241 CF9D C9              10      RET
                                
       CF9E                     IO_BS:
000242 CF9E F3               4      DI
000243 CF9F D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
       CFA1                     IO_BS1:
000245 CFA1 CDABCF          17      CALL    C12S
000248 CFA4 2B               6      DEC HL
000249 CFA5 10F7            13      DJNZ    IO_BS
00024B CFA7 D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
00024D CFA9 FB               4      EI
00024E CFAA C9              10      RET
                                
       CFAB                     C12S:
00024F CFAB CB9C             8      RES 3,H
000251 CFAD 5E               7      LD  E,(HL)
000252 CFAE 77               7      LD  (HL),A
000253 CFAF 7B               4      LD  A,E
000254 CFB0 CBDC             8      SET 3,H
000256 CFB2 5E               7      LD  E,(HL)
000257 CFB3 71               7      LD  (HL),C
000258 CFB4 4B               4      LD  C,E
000259 CFB5 C9              10      RET
                                
       CFB6                     IO_SCRUP:
00025A CFB6 F3               4      DI
00025B CFB7 D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
       CFB9                     SCRUP1:
00025D CFB9 2815            12      JR  Z,SCRCL
00025F CFBB D5              11      PUSH    DE
000260 CFBC E5              11      PUSH    HL
000261 CFBD CBDA             8      SET 3,D
000263 CFBF CBDC             8      SET 3,H
000265 CFC1 012800          10      LD  BC,WIDTH
000268 CFC4 EDB0                    LDIR
00026A CFC6 E1              10      POP HL
00026B CFC7 D1              10      POP DE
00026C CFC8 012800          10      LD  BC,WIDTH
00026F CFCB EDB0                    LDIR
000271 CFCD 3D               4      DEC A
000272 CFCE 18E9            12      JR  SCRUP1
                                
       CFD0                     SCRCL:
000274 CFD0 0628             7      LD  B,WIDTH
000276 CFD2 EB               4      EX  DE,HL
000277 CFD3 D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
000279 CFD5 CDB2DA          17      CALL    CLLINE
00027C CFD8 E1              10      POP HL
00027D CFD9 D1              10      POP DE
00027E CFDA C1              10      POP BC
00027F CFDB C9              10      RET
                                
       CFDC                     C_MON:
000280 CFDC D3E4            11      OUT (0E4H),A    ;MONITOR ROM(0000H-0FFFH) & VRAM/KEY/TIMER(D000H-FFFFH)
000282 CFDE C7              12      RST 0
                                
       CFDF                     INITINT:
000283 CFDF D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
                                                ;HL=0E007H 8253 コントロール
000285 CFE1 36B0            10      LD  (HL),0B0H   ;Ch.2 カウンタの下位バイト→上位バイトの順に連続してアクセス Mode 0 16ビットバイナリ
000287 CFE3 3674            10      LD  (HL),074H   ;Ch.1 カウンタの下位バイト→上位バイトの順に連続してアクセス Mode 2 16ビットバイナリ
000289 CFE5 2D               4      DEC L       ;0E006H 8253 Ch.2 カウンタ
00028A CFE6 3602            10      LD  (HL),2
00028C CFE8 3600            10      LD  (HL),0
00028E CFEA 2D               4      DEC L       ;0E005H 8253 Ch.1 カウンタ
00028F CFEB 77               7      LD  (HL),A
000290 CFEC 3600            10      LD  (HL),0
000292 CFEE 3E05             7      LD  A,5
000294 CFF0 3203E0          13      LD  (0E003H),A  ;8255 コントロールポートでポートC(0E002H)のINTMSKを1にする
000297 CFF3 D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
000299 CFF5 C9              10      RET
                                
       CFF6                     BANKE:
00029A CFF6                         DS  0CFFEH-BANKE
[EOF:M7BANK.ASM:SHIFT_JIS]
                                    INCLUDE "M7CCP.ASM"
                                
                                ;   LSX-Dodgers CCP
                                ;   MZ-700/1500
                                
       CFFE                     WBOOT1:
0002A2 CFFE D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)　ここは0CFFEH
0002A4 D000 D3E0            11      OUT (0E0H),A    ;DRAM(0000H-0FFHH)
0002A6 D002 F3               4      DI
0002A7 D003 ED56             8      IM  1
0002A9 D005 2107E0          10      LD  HL,0E007H
0002AC D008 3A94EF          13      LD  A,(_KEYSP)
0002AF D00B CDDFCF          17      CALL    INITINT
0002B2 D00E ED7B0600        20      LD  SP,(SYSTEM+1)
0002B6 D012 FB               4      EI
0002B7 D013 2192EF          10      LD  HL,_KEYD
0002BA D016 3600            10      LD  (HL),0
0002BC D018 CD4DDC          17      CALL    CHKEY
0002BF D01B CDA5D8          17      CALL    KEYBC_IFBREAK
0002C2 D01E 3E04             7      LD  A,4
0002C4 D020 CDB8D8          17      CALL    MSG_A
[EOF:M7CCP.ASM:UTF_8]
                                    INCLUDE "LDCCP.ASM"
                                
                                ;   LSX-Dodgers CCP
                                
       D023                     COMMAND:
0002C7 D023 CDD6D0          17      CALL    SETDTA1
0002CA D026 3A87EF          13      LD  A,(_DVSW)
0002CD D029 C641             7      ADD A,'A'
0002CF D02B CDB8D8          17      CALL    MSG_A
0002D2 D02E 3E3E             7      LD  A,'>'
0002D4 D030 CDB8D8          17      CALL    MSG_A
0002D7 D033 3E50             7      LD  A,80
0002D9 D035 12               7      LD  (DE),A
0002DA D036 CD18D9          17      CALL    _SYS0A      ;(BDOS)文字列入力
0002DD D039 CD80D2          17      CALL    LTNL
                                
0002E0 D03C 118200          10      LD  DE,DTA1+2
0002E3 D03F CDFDEF          17      CALL    _COMANL
0002E6 D042 30DF            12      JR  NC,COMMAND
0002E8 D044 1179EF          10      LD  DE,COMERM
0002EB D047 CDCFD5          17      CALL    _SYS09      ;(BDOS)文字列出力
0002EE D04A C7              12      RST 0
                                
       D04B                     COMANL:
0002EF D04B CDC6DC          17      CALL    FILE
0002F2 D04E 3A19EF          13      LD  A,(FNAME+4)
0002F5 D051 FE20             7      CP  020H
0002F7 D053 201C            12      JR  NZ,COMB2
0002F9 D055 D5              11      PUSH    DE
0002FA D056 1115EF          10      LD  DE,FNAME
0002FD D059 1A               7      LD  A,(DE)
0002FE D05A FE20             7      CP  020H
000300 D05C 2844            12      JR  Z,SDVSW
000302 D05E 1B               6      DEC DE
000303 D05F 1A               7      LD  A,(DE)
000304 D060 C6FF             7      ADD A,0FFH
000306 D062 3809            12      JR  C,COMB
000308 D064 13               6      INC DE
                                
000309 D065 2161D5          10      LD  HL,COMTB
00030C D068 060A             7      LD  B,COMS
00030E D06A CD4ADF          17      CALL    CPNAME
       D06D                     COMB:
000311 D06D D1              10      POP DE
000312 D06E D20F00          10      JP  NC,JP_HL
       D071                     COMB2:
000315 D071 EB               4      EX  DE,HL
000316 D072 224AD1          16      LD  (COMPAT+1),HL
000319 D075 F5              11      PUSH    AF
00031A D076 CDF6D0          17      CALL    CEXE4
00031D D079 F1              10      POP AF
00031E D07A 2115EF          10      LD  HL,FNAME
000321 D07D 116D00          10      LD  DE,FCB2+1   ;COMMAND NAME
000324 D080 010B00          10      LD  BC,11
000327 D083 EDB0                    LDIR
000329 D085 1104D5          10      LD  DE,PATHD
       D088                     CEX1:
00032C D088 1A               7      LD  A,(DE)
00032D D089 FE20             7      CP  020H
00032F D08B D8              11      RET C
000330 D08C CDBBDC          17      CALL    FILEC
000333 D08F D5              11      PUSH    DE
000334 D090 216D00          10      LD  HL,FCB2+1   ;COMMAND NAME
000337 D093 1115EF          10      LD  DE,FNAME
00033A D096 010B00          10      LD  BC,11
00033D D099 EDB0                    LDIR
00033F D09B CDF6D0          17      CALL    CEXE4
000342 D09E D1              10      POP DE
000343 D09F 13               6      INC DE
000344 D0A0 18E6            12      JR  CEX1
                                
       D0A2                     SDVSW:
000346 D0A2 F1              10      POP AF
000347 D0A3 3A14EF          13      LD  A,(FDRV)
00034A D0A6 3D               4      DEC A
00034B D0A7 5F               4      LD  E,A
00034C D0A8 0E0E             7      LD  C,00EH      ;(BDOS)カレントドライブの設定
00034E D0AA 1831            12      JR  SYSTEM0
                                
       D0AC                     OPEN1:
000350 D0AC 2114EF          10      LD  HL,FDRV
       D0AF                     OPEN:
000353 D0AF 0E11             7      LD  C,011H      ;(BDOS)ファイルの検索
       D0B1                     OPEN3:
000355 D0B1 D5              11      PUSH    DE
000356 D0B2 11DFD4          10      LD  DE,DTA_CCP
000359 D0B5 CDD3D0          17      CALL    SETDTA
00035C D0B8 EB               4      EX  DE,HL
00035D D0B9 CDDDD0          17      CALL    SYSTEM0
000360 D0BC D1              10      POP DE
000361 D0BD C9              10      RET
                                
       D0BE                     OPEN2:
000362 D0BE 0E12             7      LD  C,012H
000364 D0C0 18EF            12      JR  OPEN3
                                
       D0C2                     DEFCB:              ;Z=Ok NZ=Error
000366 D0C2 11DFD4          10      LD  DE,DTA_CCP
000369 D0C5 CDDBD0          17      CALL    SYSC0F
                                
00036C D0C8 1100D5          10      LD  DE,DTA_CCP+33   ;(FCB)ランダムレコード
00036F D0CB 0604             7      LD  B,4
000371 D0CD CDBED3          17      CALL    ZERO_MEMORY_DE
000374 D0D0 110001          10      LD  DE,00100H
       D0D3                     SETDTA:
000377 D0D3 C3A9D7          10      JP  _SYS1A      ;(BDOS)DTAの設定
                                
       D0D6                     SETDTA1:
00037A D0D6 118000          10      LD  DE,DTA1
00037D D0D9 18F8            12      JR  SETDTA
                                
       D0DB                     SYSC0F:
00037F D0DB 0E0F             7      LD  C,00FH      ;(BDOS)ファイルのオープン
       D0DD                     SYSTEM0:
000381 D0DD CD0500          17      CALL    SYSTEM
000384 D0E0 B7               4      OR  A
000385 D0E1 C9              10      RET
                                
       D0E2                     C_CD:
000386 D0E2 0E5A             7      LD  C,5AH
000388 D0E4 18F7            12      JR  SYSTEM0
                                
       D0E6                     S27BUF:
00038A D0E6 3A0700          13      LD  A,(SYSTEM+2)
00038D D0E9 3D               4      DEC A
00038E D0EA E6F8             7      AND 0F8H
000390 D0EC 67               4      LD  H,A
000391 D0ED 2E00             7      LD  L,0
       D0EF                     S27DTA:
000393 D0EF 11DFD4          10      LD  DE,DTA_CCP
       D0F2                     S27:
000396 D0F2 0E27             7      LD  C,027H      ;(BDOS)ランダムブロック読み込み
000398 D0F4 18E7            12      JR  SYSTEM0
                                
       D0F6                     CEXE4:
00039A D0F6 3A14EF          13      LD  A,(FDRV)
00039D D0F9 325700          13      LD  (00057H),A
0003A0 D0FC 2A22EF          16      LD  HL,(FDRV+14)
0003A3 D0FF 225800          16      LD  (00058H),HL
                                
0003A6 D102 211DEF          10      LD  HL,FNAME+8
0003A9 D105 7E               7      LD  A,(HL)
0003AA D106 FE20             7      CP  020H
0003AC D108 2007            12      JR  NZ,CEXE7
0003AE D10A 3E3F             7      LD  A,'?'
0003B0 D10C 77               7      LD  (HL),A
0003B1 D10D 23               6      INC HL
0003B2 D10E 77               7      LD  (HL),A
0003B3 D10F 23               6      INC HL
0003B4 D110 77               7      LD  (HL),A
       D111                     CEXE7:
0003B5 D111 CDACD0          17      CALL    OPEN1
       D114                     CEXE5:
0003B8 D114 C0              11      RET NZ
0003B9 D115 2AE9D4          16      LD  HL,(DTA_CCP+1+9)
0003BC D118 7C               4      LD  A,H
0003BD D119 CDD2DF          17      CALL    CAP
0003C0 D11C 67               4      LD  H,A
0003C1 D11D 7D               4      LD  A,L
0003C2 D11E CDD2DF          17      CALL    CAP
0003C5 D121 6F               4      LD  L,A
0003C6 D122 3AE8D4          13      LD  A,(DTA_CCP+1+8)
0003C9 D125 CDD2DF          17      CALL    CAP
0003CC D128 D642             7      SUB 'B'
0003CE D12A 282C            12      JR  Z,C_BAT
0003D0 D12C 3D               4      DEC A       ;'C'
0003D1 D12D 2805            12      JR  Z,C_EXE
       D12F                     CEXE6:
0003D3 D12F CDBED0          17      CALL    OPEN2
0003D6 D132 18E0            12      JR  CEXE5
                                
       D134                     C_EXE:
0003D8 D134 7C               4      LD  A,H
0003D9 D135 FE4D             7      CP  'M'
0003DB D137 20F6            12      JR  NZ,CEXE6
                                
0003DD D139 CDC2D0          17      CALL    DEFCB
0003E0 D13C CDE6D0          17      CALL    S27BUF
0003E3 D13F 3D               4      DEC A
0003E4 D140 37               4      SCF
0003E5 D141 C0              11      RET NZ
0003E6 D142 7C               4      LD  A,H
0003E7 D143 B5               4      OR  L
0003E8 D144 37               4      SCF
0003E9 D145 C8              11      RET Z
0003EA D146 CDD6D0          17      CALL    SETDTA1
0003ED D149 110000          10  COMPAT: LD  DE,0                ; self-modifying code
0003F0 D14C ED7B0600        20      LD  SP,(SYSTEM+1)
0003F4 D150 67               4      LD  H,A             ; A=0 in SETDTA1(_SYS1A)
0003F5 D151 6F               4      LD  L,A
0003F6 D152 E5              11      PUSH    HL              ; push $0000 (reboot address)
0003F7 D153 24               4      INC H
0003F8 D154 E5              11      PUSH    HL              ; push $0100 (TPA address)
0003F9 D155 C389D3          10      JP  SETFCB              ; and JP $0100
                                
       D158                     C_BAT:
0003FC D158 114154          10      LD  DE,'A'+'T'*256
0003FF D15B ED52            15      SBC HL,DE
000401 D15D 20D0            12      JR  NZ,CEXE6
                                
000403 D15F F1              10      POP AF
000404 D160 F1              10      POP AF
000405 D161 CDC2D0          17      CALL    DEFCB
000408 D164 210002          10      LD  HL,00200H
00040B D167 CDEFD0          17      CALL    S27DTA
00040E D16A C6FE             7      ADD A,0FEH
000410 D16C D8              11      RET C
000411 D16D 7D               4      LD  A,L
000412 D16E B7               4      OR  A
000413 D16F 37               4      SCF
000414 D170 C8              11      RET Z
000415 D171 3C               4      INC A
000416 D172 F5              11      PUSH    AF
                                
000417 D173 CDA8D8          17      CALL    KEYBC
00041A D176 3E06             7      LD  A,6
00041C D178 CDB8D8          17      CALL    MSG_A
00041F D17B C1              10      POP BC
000420 D17C 210001          10      LD  HL,00100H
       D17F                     BAT1:
000423 D17F A7               4      AND A
000424 D180 05               4      DEC B
000425 D181 C8              11      RET Z
000426 D182 7E               7      LD  A,(HL)
000427 D183 FE25             7      CP  '%'
000429 D185 280C            12      JR  Z,BAT2
       D187                     BAT1X:
00042B D187 7E               7      LD  A,(HL)
00042C D188 23               6      INC HL
00042D D189 FE1A             7      CP  01AH
00042F D18B C8              11      RET Z
000430 D18C FE0A             7      CP  00AH
000432 D18E C48DD8          17      CALL    NZ,KEYBS
000435 D191 18EC            12      JR  BAT1
                                
       D193                     BAT2:
000437 D193 23               6      INC HL
000438 D194 7E               7      LD  A,(HL)
000439 D195 2B               6      DEC HL
00043A D196 D631             7      SUB '1'
00043C D198 38ED            12      JR  C,BAT1X
00043E D19A FE09             7      CP  9
000440 D19C 30E9            12      JR  NC,BAT1X
000442 D19E 23               6      INC HL
000443 D19F 23               6      INC HL
000444 D1A0 3C               4      INC A
000445 D1A1 4F               4      LD  C,A
000446 D1A2 ED5B4AD1        20      LD  DE,(COMPAT+1)
       D1A6                     BAT3:
00044A D1A6 1A               7      LD  A,(DE)
00044B D1A7 B7               4      OR  A
00044C D1A8 28D5            12      JR  Z,BAT1
00044E D1AA CD9DDD          17      CALL    SPCUT
000451 D1AD 0D               4      DEC C
000452 D1AE 2808            12      JR  Z,BAT5
       D1B0                     BAT4:
000454 D1B0 1A               7      LD  A,(DE)
000455 D1B1 FE21             7      CP  021H
000457 D1B3 38F1            12      JR  C,BAT3
000459 D1B5 13               6      INC DE
00045A D1B6 18F8            12      JR  BAT4
       D1B8                     BAT5:
00045C D1B8 1A               7      LD  A,(DE)
00045D D1B9 FE21             7      CP  021H
00045F D1BB 38C2            12      JR  C,BAT1
000461 D1BD 13               6      INC DE
000462 D1BE CD8DD8          17      CALL    KEYBS
000465 D1C1 18F5            12      JR  BAT5
                                
       D1C3                     C_DEL:
000467 D1C3 CD89D3          17      CALL    SETFCB
00046A D1C6 CDCED8          17      CALL    _SYS08      ;(BDOS)エコーなしコンソール入力
                                
00046D D1C9 0E13             7      LD  C,013H
00046F D1CB 180A            12      JR  CDEL1       ;(BDOS)ファイルの削除
                                
       D1CD                     C_REN:
000471 D1CD CD89D3          17      CALL    SETFCB
000474 D1D0 3E10             7      LD  A,010H      ;ディレクトリも対象にする
000476 D1D2 326900          13      LD  (FCB1+13),A ;属性
000479 D1D5 0E17             7      LD  C,017H      ;(BDOS)ファイル名の変更
       D1D7                     CDEL1:
00047B D1D7 115C00          10      LD  DE,FCB1
00047E D1DA CD0500          17      CALL    SYSTEM
000481 D1DD C6FF             7      ADD A,0FFH
000483 D1DF C9              10      RET
                                
       D1E0                     C_DIR:
000484 D1E0 CDBBDC          17      CALL    FILEC
000487 D1E3 2115EF          10      LD  HL,FDRV+1
00048A D1E6 CDD4D4          17      CALL    CWILD1
00048D D1E9 3EF1             7      LD  A,0F1H
00048F D1EB 3221EF          13      LD  (FDRV+13),A
000492 D1EE CDACD0          17      CALL    OPEN1
       D1F1                     CDIR1:
000495 D1F1 B7               4      OR  A
000496 D1F2 2008            12      JR  NZ,PDSKF
000498 D1F4 CD3FD2          17      CALL    P_NAME
00049B D1F7 CDBED0          17      CALL    OPEN2
00049E D1FA 18F5            12      JR  CDIR1
                                
       D1FC                     PDSKF:
0004A0 D1FC 3A14EF          13      LD  A,(FDRV)
0004A3 D1FF 5F               4      LD  E,A
0004A4 D200 0E1B             7      LD  C,01BH      ;(BDOS)ディスク情報の獲得
0004A6 D202 CD0500          17      CALL    SYSTEM
0004A9 D205 4F               4      LD  C,A     ;C←1クラスタ辺りの論理セクタ数
0004AA D206 C601             7      ADD A,001H
0004AC D208 D8              11      RET C       ;Aが0FFHだった場合
0004AD D209 3E06             7      LD  A,8-2
       D20B                     PDS1:               ;HL=未使用クラスタの総数
0004AF D20B 3C               4      INC A
0004B0 D20C CB19             8      RR  C
0004B2 D20E 30FB            12      JR  NC,PDS1
       D210                     PDS2:               ;B←論理セクタのサイズの上位8ビット
0004B4 D210 3C               4      INC A
0004B5 D211 CB18             8      RR  B
0004B7 D213 30FB            12      JR  NC,PDS2
0004B9 D215 47               4      LD  B,A
                                
0004BA D216 110000          10      LD  DE,0
       D219                     PDS3:
0004BD D219 29              11      ADD HL,HL
0004BE D21A EB               4      EX  DE,HL
0004BF D21B ED6A            15      ADC HL,HL
0004C1 D21D EB               4      EX  DE,HL
0004C2 D21E 10F9            13      DJNZ    PDS3
       D220                     PDSKF1:
0004C4 D220 CDB8D2          17      CALL    PRDEC_DEHL
0004C7 D223 1145D5          10      LD  DE,FREE
0004CA D226 CDCFD5          17      CALL    _SYS09      ;(BDOS)文字列出力
0004CD D229 CDA7D2          17      CALL    PUTDRV
0004D0 D22C 3E5C             7      LD  A,05CH      ;\
0004D2 D22E CDB8D8          17      CALL    MSG_A
0004D5 D231 2A22EF          16      LD  HL,(FDRV+14)    ;ディレクトリのクラスタ番号
0004D8 D234 AF               4      XOR A
0004D9 D235 11FEFF          10      LD  DE,0-2
0004DC D238 19              11      ADD HL,DE
0004DD D239 23               6      INC HL
0004DE D23A DCB4D2          17      CALL    C,PRDEC_HL
0004E1 D23D 1841            12      JR  LTNL
                                
       D23F                     P_NAME:
0004E3 D23F 3AE0D4          13      LD  A,(DTA_CCP+1)
0004E6 D242 FE2E             7      CP  '.'
0004E8 D244 C8              11      RET Z
0004E9 D245 115DD5          10      LD  DE,DIRHD
0004EC D248 CDCFD5          17      CALL    _SYS09      ;(BDOS)文字列出力
0004EF D24B 3AEBD4          13      LD  A,(DTA_CCP+1+00BH)
0004F2 D24E F5              11      PUSH    AF
0004F3 D24F 0F               4      RRCA
0004F4 D250 9F               4      SBC A,A
0004F5 D251 E60A             7      AND '*'-020H
0004F7 D253 C620             7      ADD A,020H
0004F9 D255 CDB8D8          17      CALL    MSG_A
0004FC D258 CDA7D2          17      CALL    PUTDRV
0004FF D25B 21E0D4          10      LD  HL,DTA_CCP+1
000502 D25E CDF8D2          17      CALL    FPRNT
                                
000505 D261 F1              10      POP AF
000506 D262 CB67             8      BIT 4,A
000508 D264 2808            12      JR  Z,DIR3
00050A D266 1152D5          10      LD  DE,DIRMES
00050D D269 CDCFD5          17      CALL    _SYS09      ;(BDOS)文字列出力
000510 D26C 180A            12      JR  DIR6
       D26E                     DIR3:
000512 D26E ED5BFED4        20      LD  DE,(DTA_CCP+1+01EH)
000516 D272 2AFCD4          16      LD  HL,(DTA_CCP+1+01CH)
000519 D275 CDB8D2          17      CALL    PRDEC_DEHL
       D278                     DIR6:
00051C D278 3AB1EF          13      LD  A,(_WIDTH)
00051F D27B FE29             7      CP  40+1
000521 D27D D41AD3          17      CALL    NC,PRTTMS
                                
       D280                     LTNL:
000524 D280 1E03             7      LD  E,3
000526 D282 C3CDEF          10      JP  _PRINT
                                
       D285                     C_PATH:
000529 D285 CD9DDD          17      CALL    SPCUT
00052C D288 2104D5          10      LD  HL,PATHD
00052F D28B FE21             7      CP  021H
000531 D28D 300C            12      JR  NC,CPATH0
       D28F                     CPATHP:
000533 D28F 7E               7      LD  A,(HL)
000534 D290 23               6      INC HL
000535 D291 FE20             7      CP  020H
000537 D293 3F               4      CCF
000538 D294 30EA            12      JR  NC,LTNL
00053A D296 CDB8D8          17      CALL    MSG_A
00053D D299 18F4            12      JR  CPATHP
       D29B                     CPATH0:
00053F D29B FE3B             7      CP  ';'
000541 D29D 2001            12      JR  NZ,CPATH1
000543 D29F 13               6      INC DE
       D2A0                     CPATH1:
000544 D2A0 EB               4      EX  DE,HL
000545 D2A1 014000          10      LD  BC,PATHX
000548 D2A4 EDB0                    LDIR
00054A D2A6 C9              10      RET
                                
       D2A7                     PUTDRV:
00054B D2A7 3A14EF          13      LD  A,(FDRV)
00054E D2AA C640             7      ADD A,'A'-1
000550 D2AC CDB8D8          17      CALL    MSG_A
000553 D2AF 3E3A             7      LD  A,':'
       D2B1                     MSG_AR:
000555 D2B1 C3B8D8          10      JP  MSG_A
                                
       D2B4                     PRDEC_HL:
000558 D2B4 AF               4      XOR A
       D2B5                     PRDEC_AHL:
000559 D2B5 5F               4      LD  E,A
00055A D2B6 1600             7      LD  D,0
       D2B8                     PRDEC_DEHL:
00055C D2B8 D5              11      PUSH    DE
00055D D2B9 110FEF          10      LD  DE,DECBF
000560 D2BC 0605             7      LD  B,5
000562 D2BE CDBED3          17      CALL    ZERO_MEMORY_DE  ;A=0
000565 D2C1 D1              10      POP DE
                                
000566 D2C2 0E20             7      LD  C,32
       D2C4                     DEC1:
000568 D2C4 29              11      ADD HL,HL
000569 D2C5 EB               4      EX  DE,HL
00056A D2C6 ED6A            15      ADC HL,HL
00056C D2C8 EB               4      EX  DE,HL
00056D D2C9 E5              11      PUSH    HL
00056E D2CA 2113EF          10      LD  HL,DECBF+4
000571 D2CD 0605             7      LD  B,5
       D2CF                     DEC2:
000573 D2CF 7E               7      LD  A,(HL)
000574 D2D0 8F               4      ADC A,A
000575 D2D1 27               4      DAA
000576 D2D2 77               7      LD  (HL),A
000577 D2D3 2B               6      DEC HL
000578 D2D4 10F9            13      DJNZ    DEC2
00057A D2D6 E1              10      POP HL
00057B D2D7 0D               4      DEC C
00057C D2D8 20EA            12      JR  NZ,DEC1
                                
00057E D2DA 210FEF          10      LD  HL,DECBF
000581 D2DD 3E20             7      LD  A,020H
000583 D2DF 0604             7      LD  B,4
       D2E1                     DEC3:
000585 D2E1 CDEED2          17      CALL    DEC4
000588 D2E4 CDEED2          17      CALL    DEC4
00058B D2E7 23               6      INC HL
00058C D2E8 10F7            13      DJNZ    DEC3
       D2EA                     DECX:
00058E D2EA CDEED2          17      CALL    DEC4
000591 D2ED AF               4      XOR A
       D2EE                     DEC4:
000592 D2EE ED6F            18      RLD
000594 D2F0 FE20             7      CP  020H
000596 D2F2 2802            12      JR  Z,DEC5
000598 D2F4 F630             7      OR  030H
       D2F6                     DEC5:
00059A D2F6 18B9            12      JR  MSG_AR
                                
       D2F8                     FPRNT:
00059C D2F8 0608             7      LD  B,8
00059E D2FA CD0BD3          17      CALL    P_N1
0005A1 D2FD 7E               7      LD  A,(HL)
0005A2 D2FE C680             7      ADD A,0A0H-020H
0005A4 D300 FEA0             7      CP  0A0H
0005A6 D302 2802            12      JR  Z,FPR1
0005A8 D304 3E2E             7      LD  A,'.'
       D306                     FPR1:
0005AA D306 CDB8D8          17      CALL    MSG_A
0005AD D309 0603             7      LD  B,3
                                
       D30B                     P_N1:
0005AF D30B C5              11      PUSH    BC
0005B0 D30C E5              11      PUSH    HL
0005B1 D30D 7E               7      LD  A,(HL)
0005B2 D30E CDDEDF          17      CALL    CAP3
0005B5 D311 CDB8D8          17      CALL    MSG_A
0005B8 D314 E1              10      POP HL
0005B9 D315 C1              10      POP BC
0005BA D316 23               6      INC HL
0005BB D317 10F2            13      DJNZ    P_N1
0005BD D319 C9              10      RET
                                
       D31A                     PRTTMS:
0005BE D31A 3E20             7      LD  A,020H
0005C0 D31C CDB8D8          17      CALL    MSG_A
                                
0005C3 D31F 2AF8D4          16      LD  HL,(DTA_CCP+1+24)
0005C6 D322 7D               4      LD  A,L
0005C7 D323 B7               4      OR  A
0005C8 D324 C8              11      RET Z
0005C9 D325 CB3C             8      SRL H
0005CB D327 17               4      RLA
0005CC D328 17               4      RLA
0005CD D329 17               4      RLA
0005CE D32A 17               4      RLA
0005CF D32B E60F             7      AND 00FH
0005D1 D32D 57               4      LD  D,A
0005D2 D32E 7C               4      LD  A,H
0005D3 D32F C650             7      ADD A,80
0005D5 D331 CD74D3          17      CALL    PRDEC_A
0005D8 D334 3E2D             7      LD  A,'-'
0005DA D336 CDB8D8          17      CALL    MSG_A
0005DD D339 7A               4      LD  A,D
0005DE D33A CD74D3          17      CALL    PRDEC_A
0005E1 D33D 3E2D             7      LD  A,'-'
0005E3 D33F CDB8D8          17      CALL    MSG_A
0005E6 D342 7D               4      LD  A,L
0005E7 D343 E61F             7      AND 01FH
0005E9 D345 CD74D3          17      CALL    PRDEC_A
                                
0005EC D348 2AF6D4          16      LD  HL,(DTA_CCP+1+22)
                                
0005EF D34B 3E20             7      LD  A,020H
0005F1 D34D CDB8D8          17      CALL    MSG_A
0005F4 D350 7C               4      LD  A,H
0005F5 D351 65               4      LD  H,L
0005F6 D352 0603             7      LD  B,3
       D354                     PRTTMS1:
0005F8 D354 1F               4      RRA
0005F9 D355 CB1D             8      RR  L
0005FB D357 10FB            13      DJNZ    PRTTMS1
0005FD D359 E61F             7      AND 01FH
0005FF D35B CD74D3          17      CALL    PRDEC_A
000602 D35E 3E3A             7      LD  A,':'
000604 D360 CDB8D8          17      CALL    MSG_A
000607 D363 7D               4      LD  A,L
000608 D364 0F               4      RRCA
000609 D365 0F               4      RRCA
00060A D366 E63F             7      AND 03FH
00060C D368 CD74D3          17      CALL    PRDEC_A
00060F D36B 3E3A             7      LD  A,':'
000611 D36D CDB8D8          17      CALL    MSG_A
000614 D370 7C               4      LD  A,H
000615 D371 E61F             7      AND 01FH
000617 D373 87               4      ADD A,A
                                
                                ;   PRINT10
                                
       D374                     PRDEC_A:
000618 D374 E5              11      PUSH    HL
000619 D375 0608             7      LD  B,8
00061B D377 4F               4      LD  C,A
00061C D378 AF               4      XOR A
       D379                     PRTA1:
00061D D379 CB01             4      RLC C
00061F D37B 8F               4      ADC A,A
000620 D37C 27               4      DAA
000621 D37D 10FA            13      DJNZ    PRTA1
000623 D37F 210FEF          10      LD  HL,DECBF
000626 D382 77               7      LD  (HL),A
000627 D383 AF               4      XOR A
000628 D384 CDEAD2          17      CALL    DECX
00062B D387 E1              10      POP HL
00062C D388 C9              10      RET
                                
       D389                     SETFCB:
00062D D389 CD9DDD          17      CALL    SPCUT
000630 D38C 1A               7      LD  A,(DE)
000631 D38D FE20             7      CP  020H
000633 D38F 3801            12      JR  C,SETFCBA
000635 D391 1B               6      DEC DE
       D392                     SETFCBA:
000636 D392 0624             7      LD  B,36
000638 D394 215C00          10      LD  HL,FCB1
00063B D397 E5              11      PUSH    HL
00063C D398 AF               4      XOR A
00063D D399 CD72DD          17      CALL    FILL_MEMORY
000640 D39C E1              10      POP HL
000641 D39D D5              11      PUSH    DE
000642 D39E CD0FD8          17      CALL    _SYS5C      ;(BDOS)ファイル名の解析
000645 D3A1 216C00          10      LD  HL,FCB2
000648 D3A4 CD0FD8          17      CALL    _SYS5C      ;(BDOS)ファイル名の解析
00064B D3A7 E1              10      POP HL
00064C D3A8 010050          10      LD  BC,05000H
00064F D3AB 118100          10      LD  DE,00081H
       D3AE                     SETFCB1:
000652 D3AE 7E               7      LD  A,(HL)
000653 D3AF 23               6      INC HL
000654 D3B0 FE20             7      CP  020H
000656 D3B2 3805            12      JR  C,SETFCB2
000658 D3B4 12               7      LD  (DE),A
000659 D3B5 13               6      INC DE
00065A D3B6 0C               4      INC C
00065B D3B7 10F5            13      DJNZ    SETFCB1
       D3B9                     SETFCB2:
00065D D3B9 79               4      LD  A,C
00065E D3BA 328000          13      LD  (DTA1),A
000661 D3BD 04               4      INC B
       D3BE                     ZERO_MEMORY_DE:
000662 D3BE AF               4      XOR A
       D3BF                     FILL_MEMORY_DE:
000663 D3BF 12               7      LD  (DE),A
000664 D3C0 13               6      INC DE
000665 D3C1 10FC            13      DJNZ    FILL_MEMORY_DE
000667 D3C3 C9              10      RET
                                
       D3C4                     C_COPY:
000668 D3C4 CD89D3          17      CALL    SETFCB
                                
00066B D3C7 1161EF          10      LD  DE,ZERO
00066E D3CA CDBEDC          17      CALL    FILEC2
000671 D3CD 216C00          10      LD  HL,FCB2
000674 D3D0 CD16D8          17      CALL    S29X1
                                
000677 D3D3 3E10             7      LD  A,010H
000679 D3D5 326900          13      LD  (FCB1+13),A
00067C D3D8 216D00          10      LD  HL,FCB2+1
00067F D3DB CDD4D4          17      CALL    CWILD1
       D3DE                     COPY0:
000682 D3DE CDD1D4          17      CALL    CWILD
000685 D3E1 215C00          10      LD  HL,FCB1
000688 D3E4 CDAFD0          17      CALL    OPEN
00068B D3E7 37               4      SCF
       D3E8                     COPY1:
00068C D3E8 C0              11      RET NZ
00068D D3E9 CDC2D0          17      CALL    DEFCB
                                
000690 D3EC 3AECD4          13      LD  A,(DTA_CCP+13)
000693 D3EF CB67             8      BIT 4,A
000695 D3F1 2821            12      JR  Z,COPY1A
                                
000697 D3F3 215D00          10      LD  HL,FCB1+1
00069A D3F6 CD01E1          17      CALL    CHKWILD
00069D D3F9 3814            12      JR  C,COPY9
                                
00069F D3FB 3E20             7      LD  A,020H
0006A1 D3FD 325D00          13      LD  (FCB1+1),A
0006A4 D400 2AF9D4          16      LD  HL,(DTA_CCP+26)
0006A7 D403 23               6      INC HL
0006A8 D404 226A00          16      LD  (FCB1+14),HL
0006AB D407 18D5            12      JR  COPY0
                                
       D409                     COPY8:
0006AD D409 CDCFD5          17      CALL    _SYS09      ;(BDOS)文字列出力
0006B0 D40C CD80D2          17      CALL    LTNL
       D40F                     COPY9:
0006B3 D40F CDBED0          17      CALL    OPEN2
0006B6 D412 18D4            12      JR  COPY1
                                
       D414                     COPY1A:
0006B8 D414 216C00          10      LD  HL,FCB2
0006BB D417 1114EF          10      LD  DE,FDRV
0006BE D41A 01E1D4          10      LD  BC,DTA_CCP+2
0006C1 D41D EDA0            16      LDI
0006C3 D41F 3E0B             7      LD  A,11
       D421                     COPY2:
0006C5 D421 F5              11      PUSH    AF
0006C6 D422 7E               7      LD  A,(HL)
0006C7 D423 FE3F             7      CP  '?'
0006C9 D425 2001            12      JR  NZ,COPY3
0006CB D427 0A               7      LD  A,(BC)
       D428                     COPY3:
0006CC D428 12               7      LD  (DE),A
0006CD D429 03               6      INC BC
0006CE D42A 13               6      INC DE
0006CF D42B 23               6      INC HL
0006D0 D42C F1              10      POP AF
0006D1 D42D 3D               4      DEC A
0006D2 D42E 20F1            12      JR  NZ,COPY2
0006D4 D430 010500          10      LD  BC,16-11
0006D7 D433 EDB0                    LDIR
       D435                     PUTNAME:
0006D9 D435 215D00          10      LD  HL,FCB1+1
0006DC D438 CD01E1          17      CALL    CHKWILD
0006DF D43B 300B            12      JR  NC,PUTN1
0006E1 D43D 2115EF          10      LD  HL,FDRV+1
0006E4 D440 CDF8D2          17      CALL    FPRNT
0006E7 D443 3E20             7      LD  A,020H
0006E9 D445 CDB8D8          17      CALL    MSG_A
       D448                     PUTN1:
0006EC D448 1114EF          10      LD  DE,FDRV
0006EF D44B 0E16             7      LD  C,016H      ;(BDOS)ファイルの作成
0006F1 D44D CDDDD0          17      CALL    SYSTEM0
0006F4 D450 2048            12      JR  NZ,COPYE2
0006F6 D452 67               4      LD  H,A     ;A=0
0006F7 D453 6F               4      LD  L,A
0006F8 D454 2235EF          16      LD  (FDRV+33),HL    ;(FCB)ランダムレコード
0006FB D457 2237EF          16      LD  (FDRV+35),HL
       D45A                     COPY6:
0006FE D45A CDE6D0          17      CALL    S27BUF
000701 D45D 47               4      LD  B,A
000702 D45E 3C               4      INC A
000703 D45F 2831            12      JR  Z,COPYE
000705 D461 7C               4      LD  A,H
000706 D462 B5               4      OR  L
000707 D463 280C            12      JR  Z,COPY7
000709 D465 1114EF          10      LD  DE,FDRV
00070C D468 0E26             7      LD  C,026H      ;(BDOS)ランダムブロック書き込み
00070E D46A CDDDD0          17      CALL    SYSTEM0
000711 D46D 2023            12      JR  NZ,COPYE
000713 D46F 10E9            13      DJNZ    COPY6
       D471                     COPY7:
000715 D471 3AECD4          13      LD  A,(DTA_CCP+13)  ;(FCB)属性
000718 D474 3221EF          13      LD  (FDRV+13),A
00071B D477 21F3D4          10      LD  HL,DTA_CCP+20   ;(FCB)タイムスタンプ
00071E D47A 1128EF          10      LD  DE,FDRV+20
000721 D47D 010400          10      LD  BC,4
000724 D480 EDB0                    LDIR
                                
000726 D482 1114EF          10      LD  DE,FDRV
000729 D485 0E10             7      LD  C,010H      ;(BDOS)ファイルのクローズ
00072B D487 CDDDD0          17      CALL    SYSTEM0
00072E D48A 2006            12      JR  NZ,COPYE
                                
000730 D48C 1171EF          10      LD  DE,OK
000733 D48F C309D4          10      JP  COPY8
                                
       D492                     COPYE:
000736 D492 1114EF          10      LD  DE,FDRV
000739 D495 0E13             7      LD  C,013H      ;(BDOS)ファイルの削除
00073B D497 CD0500          17      CALL    SYSTEM
       D49A                     COPYE2:
00073E D49A 37               4      SCF
00073F D49B C9              10      RET
                                
       D49C                     C_TYPE:
000740 D49C CD89D3          17      CALL    SETFCB
000743 D49F 215C00          10      LD  HL,FCB1
000746 D4A2 CDAFD0          17      CALL    OPEN
000749 D4A5 37               4      SCF
       D4A6                     TYPE1:
00074A D4A6 C0              11      RET NZ
00074B D4A7 CDC2D0          17      CALL    DEFCB
00074E D4AA 3E06             7      LD  A,6
000750 D4AC CDB8D8          17      CALL    MSG_A
       D4AF                     TYPE2:
000753 D4AF CDE6D0          17      CALL    S27BUF
000756 D4B2 C6FE             7      ADD A,0FEH
000758 D4B4 D8              11      RET C
000759 D4B5 7C               4      LD  A,H
00075A D4B6 B5               4      OR  L
00075B D4B7 2813            12      JR  Z,TYPEE
00075D D4B9 010001          10      LD  BC,00100H
       D4BC                     TYPE3:
000760 D4BC 0A               7      LD  A,(BC)
000761 D4BD 03               6      INC BC
000762 D4BE FE1A             7      CP  01AH
000764 D4C0 280A            12      JR  Z,TYPEE
000766 D4C2 CDB8D8          17      CALL    MSG_A
000769 D4C5 2B               6      DEC HL
00076A D4C6 7C               4      LD  A,H
00076B D4C7 B5               4      OR  L
00076C D4C8 20F2            12      JR  NZ,TYPE3
00076E D4CA 18E3            12      JR  TYPE2
       D4CC                     TYPEE:
000770 D4CC CDBED0          17      CALL    OPEN2
000773 D4CF 18D5            12      JR  TYPE1
                                
       D4D1                     CWILD:
000775 D4D1 215D00          10      LD  HL,FCB1+1
       D4D4                     CWILD1:
000778 D4D4 7E               7      LD  A,(HL)
000779 D4D5 FE20             7      CP  020H
00077B D4D7 C0              11      RET NZ
       D4D8                     CWILD2:
00077C D4D8 3E3F             7      LD  A,'?'
00077E D4DA 060B             7      LD  B,11
000780 D4DC C372DD          10      JP  FILL_MEMORY
                                
       D4DF                     DTA_CCP:
000783 D4DF                         DS  37
                                
       0040                     PATHX   EQU 64
0007A8 D504                     PATHD:  DS  PATHX
0007E8 D544 00                  PATHE:  DB  0
                                
0007E9 D545 2062797465732066    FREE:   DB  " bytes free",9,'$'
            7265650924          
0007F6 D552 20202020203C4449    DIRMES: DB  "     <DIR>$"
            523E24              
000801 D55D 20203A24            DIRHD:  DB  "  :$"
                                
       D561                     COMTB:
000805 D561 44202020                DB  "D   "  ;1
000809 D565 E0D1                    DW  C_DIR
00080B D567 44495220                DB  "DIR "  ;2
00080F D56B E0D1                    DW  C_DIR
000811 D56D 434F5059                DB  "COPY"  ;3
000815 D571 C4D3                    DW  C_COPY
000817 D573 43442020                DB  "CD  "  ;4
00081B D577 E2D0                    DW  C_CD
00081D D579 44454C20                DB  "DEL "  ;5
000821 D57D C3D1                    DW  C_DEL
000823 D57F 50415448                DB  "PATH"  ;6
000827 D583 85D2                    DW  C_PATH
000829 D585 52454E20                DB  "REN "  ;7
00082D D589 CDD1                    DW  C_REN
00082F D58B 54595045                DB  "TYPE"  ;8
000833 D58F 9CD4                    DW  C_TYPE
000835 D591 52454D20                DB  "REM "  ;9
000839 D595 CCD5                    DW  C_REM
[EOF:LDCCP.ASM:SHIFT_JIS]
                                    INCLUDE "M7CCP2.ASM"
                                
                                ;   LSX-Dodgers CCP2
                                ;   MZ-700/1500
                                
00083B D597 4D4F4E20                DB  "MON "  ;10
00083F D59B DCCF                    DW  C_MON
[EOF:M7CCP2.ASM:UTF_8]
                                    INCLUDE "LDOS.ASM"
                                
                                ;   LSX-Dodgers OS
                                
       D59D                     BDOS0:
000841 D59D E5              11      PUSH    HL
000842 D59E 79               4      LD  A,C
000843 D59F FE3C             7      CP  03CH
000845 D5A1 3802            12      JR  C,DOS1
000847 D5A3 3E3C             7      LD  A,03CH
       D5A5                     DOS1:
000849 D5A5 87               4      ADD A,A
00084A D5A6 6F               4      LD  L,A
00084B D5A7 26F0             7      LD  H,STABLE/256
00084D D5A9 7E               7      LD  A,(HL)
00084E D5AA 2C               4      INC L
00084F D5AB 66               7      LD  H,(HL)
000850 D5AC 6F               4      LD  L,A
000851 D5AD E3              19      EX  (SP),HL
000852 D5AE 79               4      LD  A,C
                                ;確認用
                                ;   LD  (0050H),A
000853 D5AF C9              10      RET
       D5B0                     _DOS2:
000854 D5B0 FE5A             7      CP  05AH        ;(BDOS)カレントディレクトリの変更(_CHDIR)
000856 D5B2 CA53D8          10      JP  Z,_SYS5A
000859 D5B5 FE5C             7      CP  05CH        ;(BDOS)ファイル名の解析(_PFILE)
00085B D5B7 CA0FD8          10      JP  Z,_SYS5C
00085E D5BA FE5F             7      CP  05FH        ;(BDOS)ディスクバッファのフラッシュ(_FLUSH)
000860 D5BC CA0CEA          10      JP  Z,_SYS5F
000863 D5BF FE6F             7      CP  06FH        ;(BDOS)MSX-DOS のバージョン番号の獲得(_DOSVER)
000865 D5C1 200A            12      JR  NZ,_ERROR
000867 D5C3 011D01          10      LD  BC,011DH
00086A D5C6 115001          10      LD  DE,VER
00086D D5C9 210100          10      LD  HL,MACD
       D5CC                     C_REM:
000870 D5CC AF               4      XOR A
       D5CD                     _ERROR:
000871 D5CD A7               4      AND A
000872 D5CE C9              10      RET
                                
       D5CF                     _SYS09:     ;文字列出力
000873 D5CF D5              11      PUSH    DE
       D5D0                     _SX09:
000874 D5D0 1A               7      LD  A,(DE)
000875 D5D1 13               6      INC DE
000876 D5D2 FE24             7      CP  '$'
000878 D5D4 2831            12      JR  Z,SX0E2
00087A D5D6 CDB8D8          17      CALL    MSG_A
00087D D5D9 18F5            12      JR  _SX09
                                
       D5DB                     MSX1:
00087F D5DB CDB8D8          17      CALL    MSG_A
       D5DE                     MSX:
000882 D5DE 7E               7      LD  A,(HL)
000883 D5DF 23               6      INC HL
000884 D5E0 B7               4      OR  A
000885 D5E1 20F8            12      JR  NZ,MSX1
000887 D5E3 C9              10      RET
                                
       D5E4                     _SYS0C:     ;(BDOS)バージョン番号の獲得
000888 D5E4 212200          10      LD  HL,00022H
00088B D5E7 7D               4      LD  A,L
00088C D5E8 C9              10      RET
                                
       D5E9                     _SYS0D:     ;(BDOS)ディスクリセット
00088D D5E9 CDDFEF          17      CALL    _FFLUSH
000890 D5EC E5              11      PUSH    HL
000891 D5ED 218000          10      LD  HL,00080H
000894 D5F0 228AEF          16      LD  (_DTA),HL
000897 D5F3 E1              10      POP HL
000898 D5F4 D5              11      PUSH    DE
000899 D5F5 1E00             7      LD  E,0
00089B D5F7 3E                      DB  03EH
                                
       D5F8                     _SYS0E:     ;(BDOS)カレントドライブの設定
00089C D5F8 D5              11      PUSH    DE
00089D D5F9 7B               4      LD  A,E
00089E D5FA DDE5            15      PUSH    IX
0008A0 D5FC CDDCEF          17      CALL    _GETDPB
0008A3 D5FF DDE1            14      POP IX
0008A5 D601 3804            12      JR  C,SX0E2
0008A7 D603 7B               4      LD  A,E
0008A8 D604 3287EF          13      LD  (_DVSW),A
       D607                     SX0E2:
0008AB D607 3E08             7      LD  A,8
0008AD D609 D1              10      POP DE
0008AE D60A C9              10      RET
                                
       D60B                     _SYS0F:     ;(BDOS)ファイルのオープン
0008AF D60B CDAFDD          17      CALL    SETDRV
0008B2 D60E FD7E1C          19      LD  A,(IY+28)   ;(FCB)オープンモード
0008B5 D611 C602             7      ADD A,002H      ;Write
0008B7 D613 2848            12      JR  Z,FEND0F
0008B9 D615 CDFDE0          17      CALL    CHKWILDX
                                
0008BC D618 D4CFDD          17      CALL    NC,SOPENX
       D61B                     _S16XX:
0008BF D61B 3840            12      JR  C,FEND0F
                                                ;Directory location
0008C1 D61D 3A9FEF          13      LD  A,(_FILEN)
0008C4 D620 FD7719          19      LD  (IY+25),A   ;(FCB)ディレクトリロケーション
                                ;               _DIRF
0008C7 D623 3AA0EF          13      LD  A,(_DIRF)
0008CA D626 FD771D          19      LD  (IY+29),A   ;(FCB)ディレクトリモード
                                ;               _FBPS
0008CD D629 FD731E          19      LD  (IY+30),E   ;(FCB)ディレクトリポジション
0008D0 D62C FD721F          19      LD  (IY+31),D
                                ;               Open(Read)
0008D3 D62F FD361CFF        19      LD  (IY+28),0FFH    ;(FCB)オープンモード
                                ;               FILENAME
0008D7 D633 FDE5            15      PUSH    IY
0008D9 D635 D1              10      POP DE
0008DA D636 13               6      INC DE
0008DB D637 010B00          10      LD  BC,11
0008DE D63A EDB0                    LDIR
                                ;               Attribute
0008E0 D63C 7E               7      LD  A,(HL)
0008E1 D63D FD770D          19      LD  (IY+13),A   ;(FCB)属性(アトリビュート)
0008E4 D640 110B00          10      LD  DE,11       ;Reserved
0008E7 D643 19              11      ADD HL,DE
                                                    ;(FCB)ファイルを最後に変更した時刻
0008E8 D644 11EAF0          10      LD  DE,SDDATA       ;(FCB)ファイルを最後に変更した日付
0008EB D647 060A             7      LD  B,SDDATAE-SDDATA    ;(FCB)ファイルの先頭クラスタ
       D649                     S16LOOP:                ;(FCB)ファイルのサイズ(バイト単位)
0008ED D649 1A               7      LD  A,(DE)
0008EE D64A 13               6      INC DE
0008EF D64B 3252D6          13      LD  (S16PAT+2),A
0008F2 D64E 7E               7      LD  A,(HL)
0008F3 D64F 23               6      INC HL
0008F4 D650 FD7700          19  S16PAT: LD  (IY+0),A
0008F7 D653 10F4            13      DJNZ    S16LOOP
                                
0008F9 D655 AF               4      XOR A
0008FA D656 FD770C          19      LD  (IY+12),A   ;(FCB)カレントブロック
0008FD D659 FD2201D7        20      LD  (OFCB+1),IY
       D65D                     FEND0F:
000901 D65D 1845            12      JR  FEND10
                                
       D65F                     _SYS10:     ;(BDOS)ファイルのクローズ
000903 D65F CDAFDD          17      CALL    SETDRV
000906 D662 FD7E1C          19      LD  A,(IY+28)   ;(FCB)オープンモード
000909 D665 D6FE             7      SUB 0FEH
00090B D667 37               4      SCF
00090C D668 3F               4      CCF
00090D D669 2039            12      JR  NZ,FEND10
       D66B                     _S10A:              ;Write
00090F D66B FD770E          19      LD  (IY+14),A   ;(FCB)レコードサイズ/アクセスするディレクトリのクラスタ番号+1
000912 D66E FD770F          19      LD  (IY+15),A
                                
000915 D671 FD341C          23      INC (IY+28)     ;0FEH->0FFH ;オープンモード
000918 D674 CDF5E1          17      CALL    SETTMS
                                
00091B D677 FD7E1D          19      LD  A,(IY+29)   ;(FCB)ディレクトリモード
00091E D67A 32A0EF          13      LD  (_DIRF),A
000921 D67D E67F             7      AND 07FH
000923 D67F 323EE7          13      LD  (_SECPS+1),A
000926 D682 FD5E1E          19      LD  E,(IY+30)   ;(FCB)ディレクトリポジション
000929 D685 FD561F          19      LD  D,(IY+31)
00092C D688 CD03DF          17      CALL    READ_DIR
00092F D68B 3817            12      JR  C,FEND10
                                
000931 D68D 3A2DDE          13  SDECM1: LD  A,(SDECPAT+1)   ;1セクタ辺りのディレクトリエントリ数
000934 D690 3D               4      DEC A       ;1024=01FH / 512=00FH / 256=7
000935 D691 FDA619          19      AND (IY+25)     ;(FCB)ディレクトリロケーション
000938 D694 6F               4      LD  L,A
000939 D695 2600             7      LD  H,0
00093B D697 29              11      ADD HL,HL       ;*2
00093C D698 29              11      ADD HL,HL       ;*4
00093D D699 29              11      ADD HL,HL       ;*8
00093E D69A 29              11      ADD HL,HL       ;*16
00093F D69B 29              11      ADD HL,HL       ;*32
000940 D69C ED4B7EF0        20      LD  BC,(_DTBUF)
000944 D6A0 09              11      ADD HL,BC
                                
000945 D6A1 CD0DE1          17      CALL    SDIRENT
       D6A4                     FEND10:
000948 D6A4 1842            12      JR  FEND
                                
       D6A6                     _SYS11:     ;(BDOS)最初のファイルの検索
00094A D6A6 CDAFDD          17      CALL    SETDRV
00094D D6A9 CDFCDD          17      CALL    SOPEN
       D6AC                     _S12X1:
000950 D6AC 383A            12      JR  C,FEND
000952 D6AE CD9CDE          17      CALL    SOPENE2
000955 D6B1 ED5B8AEF        20      LD  DE,(_DTA)
000959 D6B5 3A88EF          13      LD  A,(_DRV)
00095C D6B8 3C               4      INC A
00095D D6B9 12               7      LD  (DE),A
00095E D6BA D5              11      PUSH    DE
00095F D6BB 13               6      INC DE
000960 D6BC 012000          10      LD  BC,32
000963 D6BF EDB0                    LDIR
000965 D6C1 FD6E0E          19      LD  L,(IY+14)   ;(FCB)レコードサイズ/アクセスするディレクトリのクラスタ番号+1
000968 D6C4 FD660F          19      LD  H,(IY+15)
00096B D6C7 22F4F0          16      LD  (SCDIR),HL
00096E D6CA 2A9AEF          16      LD  HL,(_FBPS)
000971 D6CD 22F6F0          16      LD  (SFBPS),HL
000974 D6D0 2A9FEF          16      LD  HL,(_FILEN)
000977 D6D3 7C               4      LD  A,H
000978 D6D4 B7               4      OR  A
000979 D6D5 2806            12      JR  Z,_S12DIR
00097B D6D7 3A3EE7          13      LD  A,(_SECPS+1)
00097E D6DA F680             7      OR  080H
000980 D6DC 67               4      LD  H,A
       D6DD                     _S12DIR:
000981 D6DD 22F8F0          16      LD  (SFNDF),HL  ;Directory position and Flags
000984 D6E0 E1              10      POP HL
000985 D6E1 1139EF          10      LD  DE,SFILE
000988 D6E4 0E21             7      LD  C,33
       D6E6                     _S11B:
00098A D6E6 EDB0                    LDIR
       D6E8                     FEND:
00098C D6E8 9F               4      SBC A,A     ;CF=0 A=0 : CF=1 A=0FFH
       D6E9                     FENDE:
00098D D6E9 FDE1            14      POP IY
00098F D6EB C1              10      POP BC
000990 D6EC D1              10      POP DE
000991 D6ED E1              10      POP HL
000992 D6EE C9              10      RET
                                
       D6EF                     _SYS12:     ;(BDOS)次のファイルの検索
000993 D6EF E5              11      PUSH    HL
000994 D6F0 D5              11      PUSH    DE
000995 D6F1 C5              11      PUSH    BC
000996 D6F2 FDE5            15      PUSH    IY
000998 D6F4 CD60DE          17      CALL    NOPEN
00099B D6F7 18B3            12      JR  _S12X1
                                
       D6F9                     _S16K:
00099D D6F9 FD7E1C          19      LD  A,(IY+28)   ;(FCB)オープンモード
0009A0 D6FC FEFD             7      CP  0FDH        ;Device(0FDH)
0009A2 D6FE 37               4      SCF
0009A3 D6FF C8              11      RET Z
                                
0009A4 D700 110000          10  OFCB:   LD  DE,0
0009A7 D703 D5              11      PUSH    DE
0009A8 D704 061A             7      LD  B,26        ;First cluster
       D706                     S16K1:
0009AA D706 13               6      INC DE
0009AB D707 23               6      INC HL
0009AC D708 10FC            13      DJNZ    S16K1
                                
0009AE D70A 1A               7      LD  A,(DE)
0009AF D70B BE               7      CP  (HL)
0009B0 D70C 2013            12      JR  NZ,S16K2
0009B2 D70E 13               6      INC DE
0009B3 D70F 23               6      INC HL
0009B4 D710 1A               7      LD  A,(DE)
0009B5 D711 BE               7      CP  (HL)
0009B6 D712 200D            12      JR  NZ,S16K2
                                
0009B8 D714 E1              10      POP HL
0009B9 D715 FDE5            15      PUSH    IY
0009BB D717 D1              10      POP DE
0009BC D718 1A               7      LD  A,(DE)      ;Drive
0009BD D719 BE               7      CP  (HL)
0009BE D71A 2006            12      JR  NZ,S16K3
                                                ;ここはCFが必ず0
0009C0 D71C ED52            15      SBC HL,DE       ;CP HL,DE
0009C2 D71E 37               4      SCF
0009C3 D71F C0              11      RET NZ
0009C4 D720 E5              11      PUSH    HL
       D721                     S16K2:
0009C5 D721 E1              10      POP HL
       D722                     S16K3:
0009C6 D722 FDE5            15      PUSH    IY
0009C8 D724 D1              10      POP DE
       D725                     _SYS13:     ;(BDOS)ファイルの削除
0009C9 D725 CDAFDD          17      CALL    SETDRV
0009CC D728 CD2DE0          17      CALL    KILL
       D72B                     FEND13:
0009CF D72B 18BB            12      JR  FEND
                                
       D72D                     _SYS14:     ;(BDOS)シーケンシャルな読み出し
0009D1 D72D CDAFDD          17      CALL    SETDRV
0009D4 D730 CD61E2          17      CALL    INIT_SEQ
       D733                     SREAD:
0009D7 D733 CDABE2          17      CALL    RB_READ
                                
0009DA D736 C601             7      ADD A,001H
0009DC D738 38AE            12      JR  C,FEND
                                
0009DE D73A 7D               4      LD  A,L
0009DF D73B D601             7      SUB 001H
       D73D                     FENDX:
0009E1 D73D 9F               4      SBC A,A
0009E2 D73E E603             7      AND 3
0009E4 D740 1F               4      RRA
0009E5 D741 18A6            12      JR  FENDE
                                
       D743                     _SYS15:     ;(BDOS)シーケンシャルな書き込み
0009E7 D743 CDAFDD          17      CALL    SETDRV
0009EA D746 CD61E2          17      CALL    INIT_SEQ
       D749                     SWRITE:
0009ED D749 CDA4E2          17      CALL    RB_WRITE
                                
0009F0 D74C C6FF             7      ADD A,0FFH
0009F2 D74E 18ED            12      JR  FENDX
                                
       D750                     _SYS17:     ;(BDOS)ファイル名の変更
0009F4 D750 CDAFDD          17      CALL    SETDRV
0009F7 D753 CD83E0          17      CALL    NAME
0009FA D756 18D3            12      JR  FEND13
                                
       D758                     _SYS16:     ;(BDOS)ファイルの作成
0009FC D758 CDAFDD          17      CALL    SETDRV
                                
0009FF D75B CDFDE0          17      CALL    CHKWILDX
000A02 D75E 38CB            12      JR  C,FEND13
000A04 D760 FD7E01          19      LD  A,(IY+1)    ;(FCB)主ファイル名
000A07 D763 FE05             7      CP  5
000A09 D765 2805            12      JR  Z,_S16X2
000A0B D767 FE21             7      CP  021H
000A0D D769 DA2BD7          10      JP  C,FEND13
       D76C                     _S16X2:
                                ;               Clear FCB
000A10 D76C FDE5            15      PUSH    IY
000A12 D76E E1              10      POP HL
000A13 D76F 011000          10      LD  BC,16
000A16 D772 09              11      ADD HL,BC
       D773                     _S16X1:
000A17 D773 70               7      LD  (HL),B      ;B=0
000A18 D774 23               6      INC HL
000A19 D775 0D               4      DEC C
000A1A D776 20FB            12      JR  NZ,_S16X1
                                
000A1C D778 CDFAE1          17      CALL    SETTMSX
000A1F D77B FD360DFF        19      LD  (IY+13),0FFH    ;(FCB)Attribute
000A23 D77F CDCFDD          17      CALL    SOPENX
000A26 D782 3F               4      CCF
000A27 D783 CCF9D6          17      CALL    Z,_S16K
000A2A D786 D4ADDE          17      CALL    NC,COPEN
000A2D D789 D40DE1          17      CALL    NC,SDIRENT
000A30 D78C C31BD6          10      JP  _S16XX
                                
       D78F                     _SYS21:     ;(BDOS)ランダムな読み出し
000A33 D78F CDAFDD          17      CALL    SETDRV
000A36 D792 CD45E2          17      CALL    INIT_RND
000A39 D795 189C            12      JR  SREAD
                                
       D797                     _SYS22:     ;(BDOS)ランダムな書き込み
       D797                     _SYS28:     ;(BDOS)ランダムな書き込み・その2
000A3B D797 CDAFDD          17      CALL    SETDRV
000A3E D79A CD45E2          17      CALL    INIT_RND
000A41 D79D 18AA            12      JR  SWRITE
                                
       D79F                     _SYS18:     ;(BDOS)ログインベクトルの獲得
000A43 D79F 21FF00          10      LD  HL,000FFH
000A46 D7A2 AF               4      XOR A
000A47 D7A3 C9              10      RET
                                
       D7A4                     _SYS19:     ;(BDOS)カレントドライブ番号の獲得
000A48 D7A4 3A87EF          13      LD  A,(_DVSW)
000A4B D7A7 A7               4      AND A
000A4C D7A8 C9              10      RET
                                
       D7A9                     _SYS1A:     ;(BDOS)DTAの設定
000A4D D7A9 ED538AEF        20      LD  (_DTA),DE
000A51 D7AD AF               4      XOR A
000A52 D7AE C9              10      RET
                                
       D7AF                     _SYS1B:     ;(BDOS)ディスク情報の獲得
000A53 D7AF 7B               4      LD  A,E
000A54 D7B0 CDC2DD          17      CALL    GETDRV
000A57 D7B3 CDDCEF          17      CALL    _GETDPB
000A5A D7B6 D4E2EF          17      CALL    NC,_RDFATX
000A5D D7B9 210000          10      LD  HL,0
000A60 D7BC D4D3E1          17      CALL    NC,DSKF
                                
000A63 D7BF ED5BD4E1        20      LD  DE,(MAXCLP+1)   ;DPB_08_MAXCL-1
000A67 D7C3 1B               6      DEC DE      ;DE←クラスタの総数
000A68 D7C4 FD2A7CF0        20      LD  IY,(_FATBF) ;IY←メモリ上のFATの先頭アドレス
000A6C D7C8 9F               4      SBC A,A
000A6D D7C9 D8              11      RET C
000A6E D7CA 4F               4      LD  C,A     ;C=0
000A6F D7CB DD7E0F          19      LD  A,(IX+00FH) ;DPB_0F_BPS
000A72 D7CE E60F             7      AND 00FH
000A74 D7D0 47               4      LD  B,A
000A75 D7D1 DD7E07          19      LD  A,(IX+7)    ;DPB_07_SECPCL
000A78 D7D4 C9              10      RET
                                
       D7D5                     _SYS1D:     ;(BDOS)書き込みが禁止されているディスクの調査
000A79 D7D5 AF               4      XOR A
000A7A D7D6 67               4      LD  H,A
000A7B D7D7 6F               4      LD  L,A
000A7C D7D8 C9              10      RET
                                
       D7D9                     _SYS1F:     ;(BDOS)ディスク装置のパラメータの読み出し
000A7D D7D9 2100F1          10      LD  HL,DEVICE
000A80 D7DC 7B               4      LD  A,E
000A81 D7DD C3DCEF          10      JP  _GETDPB
                                
       D7E0                     _SYS23:     ;(BDOS)ファイルサイズの獲得
000A84 D7E0 E5              11      PUSH    HL
000A85 D7E1 2A1EF0          16      LD  HL,(STABLE+2*00FH)  ;ファイルのオープン
000A88 D7E4 CD0F00          17      CALL    JP_HL
000A8B D7E7 381B            12      JR  C,_S23X1
                                
000A8D D7E9 D5              11      PUSH    DE      ;EX DE,IY
000A8E D7EA FDE3            23      EX  (SP),IY     ;
                                ;   POP DE      ;
                                ;   PUSH    DE      ;DEを破壊しないように注意vv
000A90 D7EC FD7E10          19      LD  A,(IY+16)   ;(FCB)ファイルのサイズ(バイト単位)
000A93 D7EF FD6E11          19      LD  L,(IY+17)   ;
000A96 D7F2 FD6612          19      LD  H,(IY+18)   ;
000A99 D7F5 C5              11      PUSH    BC      ;
000A9A D7F6 FD4613          19      LD  B,(IY+19)   ;
000A9D D7F9 CD37E2          17      CALL    GET_CPM_R_SIZE
000AA0 D7FC C1              10      POP BC
       D7FD                     _S24X1:
000AA1 D7FD CD57E2          17      CALL    SET_RR_AHL
                                ;   POP DE      ;^^^^^^^^^^^^^^^^^^^^^^^^
                                ;   PUSH    DE      ;EX DE,IY
000AA4 D800 FDE3            23      EX  (SP),IY     ;
000AA6 D802 D1              10      POP DE      ;
                                
000AA7 D803 AF               4      XOR A
       D804                     _S23X1:
000AA8 D804 E1              10      POP HL
000AA9 D805 C9              10      RET
                                
       D806                     _SYS24:     ;(BDOS)ランダムレコードフィールドの設定
000AAA D806 E5              11      PUSH    HL
000AAB D807 D5              11      PUSH    DE      ;EX DE,IY
000AAC D808 FDE3            23      EX  (SP),IY     ;
                                ;   POP DE      ;
                                ;   PUSH    DE      ;DEを破壊しないように注意vv
000AAE D80A CD69E2          17      CALL    GETSEQ
000AB1 D80D 18EE            12      JR  _S24X1      ;^^^^^^^^^^^^^^^^^^^^^^^^
                                
       D80F                     _SYS5C:     ;(BDOS)ファイル名の解析
000AB3 D80F C5              11      PUSH    BC
000AB4 D810 E5              11      PUSH    HL
000AB5 D811 CDC6DC          17      CALL    FILE
000AB8 D814 E1              10      POP HL
000AB9 D815 C1              10      POP BC
       D816                     S29X1:
000ABA D816 C5              11      PUSH    BC
000ABB D817 D5              11      PUSH    DE
000ABC D818 E5              11      PUSH    HL
000ABD D819 EB               4      EX  DE,HL
000ABE D81A 2114EF          10      LD  HL,FDRV
000AC1 D81D 010D00          10      LD  BC,13
000AC4 D820 EDB0                    LDIR
000AC6 D822 70               7      LD  (HL),B      ;B=0
000AC7 D823 0E03             7      LD  C,3
000AC9 D825 EDB0                    LDIR
000ACB D827 E1              10      POP HL
000ACC D828 D1              10      POP DE
000ACD D829 C1              10      POP BC
000ACE D82A AF               4      XOR A
000ACF D82B C9              10      RET
                                
       D82C                     _SYS30:     ;(BDOS)論理セクタを用いた書き込み
000AD0 D82C C5              11      PUSH    BC
000AD1 D82D 01B0E8          10      LD  BC,DWT24B
000AD4 D830 1804            12      JR  S2FX
       D832                     _SYS2F:
000AD6 D832 C5              11      PUSH    BC
000AD7 D833 01A0E8          10      LD  BC,DRD24B
       D836                     S2FX:
000ADA D836 ED434CD8        20      LD  (S2FPAT+1),BC
000ADE D83A CDDFEF          17      CALL    _FFLUSH
                                
000AE1 D83D D5              11      PUSH    DE
000AE2 D83E E5              11      PUSH    HL
000AE3 D83F 7D               4      LD  A,L     ;Drive
000AE4 D840 CDD9EF          17      CALL    _CHGDRV
000AE7 D843 3809            12      JR  C,S30X2
000AE9 D845 44               4      LD  B,H     ;Number of clusters
000AEA D846 2A8AEF          16      LD  HL,(_DTA)
                                
000AED D849 0E00             7      LD  C,0
000AEF D84B CDA0E8          17  S2FPAT: CALL    DRD24B
       D84E                     S30X2:
000AF2 D84E E1              10      POP HL
000AF3 D84F D1              10      POP DE
000AF4 D850 C1              10      POP BC
000AF5 D851 9F               4      SBC A,A
000AF6 D852 C9              10      RET
                                
       D853                     _SYS5A:     ;(BDOS)カレントディレクトリの変更
000AF7 D853 C5              11      PUSH    BC
000AF8 D854 D5              11      PUSH    DE
000AF9 D855 E5              11      PUSH    HL
000AFA D856 CDBBDC          17      CALL    FILEC
000AFD D859 210000          10      LD  HL,0
000B00 D85C 1114EF          10      LD  DE,FDRV
000B03 D85F 2A4EF0          16      LD  HL,(STABLE+2*027H)  ;ランダムブロック読み込み
000B06 D862 CD0F00          17      CALL    JP_HL
000B09 D865 18E7            12      JR  S30X2
[EOF:LDOS.ASM:SHIFT_JIS]
                                    INCLUDE "M7IO.ASM"
                                
                                ;   LSX-Dodgers IO
                                ;   MZ-700/1500
                                
       D5CD                     _SYS04  EQU _ERROR      ;(BDOS)外部出力
       D5CD                     _SYS05  EQU _ERROR      ;(BDOS)プリンタ出力
       D5CD                     _SYS1C  EQU _ERROR      ;(BDOS)ディスクの書き込み禁止化
       D5CD                     _SYS1E  EQU _ERROR      ;(BDOS)ファイル属性の設定
       D5CD                     _SYS20  EQU _ERROR      ;(BDOS)利用者番号の設定と読み出し
       D5CD                     _SYS2E  EQU _ERROR      ;(BDOS)ベリファイ・フラグの設定
                                
       0000                     INT EQU 0
       0000                     INTCTCE EQU 0
       0000                     INTCTC2 EQU 0
                                
       D867                     ARWKEY:
000B0B D867 3D               4      DEC A
000B0C D868 327AD8          13      LD  (KEYAR),A
000B0F D86B 181D            12      JR  INT8253E
       D86D                     SETKEY1:
000B11 D86D 3A95EF          13      LD  A,(_KEYSP+1)
000B14 D870 180C            12      JR  SETKEY
       D872                     INT8253:
000B16 D872 CD4DDC          17      CALL    CHKEY
       D876                     KEYDT   EQU $+1
000B19 D875 FE00             7      CP  0
000B1B D877 20F4            12      JR  NZ,SETKEY1
       D87A                     KEYAR   EQU $+1
000B1D D879 3E00             7      LD  A,0
000B1F D87B B7               4      OR  A
000B20 D87C 20E9            12      JR  NZ,ARWKEY
       D87E                     SETKEY:
000B22 D87E 327AD8          13      LD  (KEYAR),A
000B25 D881 3A92EF          13      LD  A,(_KEYD)
000B28 D884 3276D8          13      LD  (KEYDT),A
000B2B D887 CD8DD8          17      CALL    KEYSET
       D88A                     INT8253E:
000B2E D88A F1              10      POP AF
000B2F D88B FB               4      EI
000B30 D88C C9              10      RET
       D88D                     KEYSET:
       D88D                     KEYBS:
000B31 D88D B7               4      OR  A
000B32 D88E C8              11      RET Z
       D88F                     KEYBS1:
000B33 D88F CDA5D8          17      CALL    KEYBC_IFBREAK
000B36 D892 E5              11      PUSH    HL
000B37 D893 F5              11      PUSH    AF
000B38 D894 2A90EF          16      LD  HL,(_KEYPS)
000B3B D897 2C               4      INC L
000B3C D898 7D               4      LD  A,L
000B3D D899 BC               4      CP  H
000B3E D89A 2815            12      JR  Z,POP_AF_HL_SCF_RET
000B40 D89C 3290EF          13      LD  (_KEYPS),A
000B43 D89F 26FE             7      LD  H,KEYBF/256
000B45 D8A1 F1              10      POP AF
000B46 D8A2 77               7      LD  (HL),A
000B47 D8A3 E1              10      POP HL
000B48 D8A4 C9              10      RET
       D8A5                     KEYBC_IFBREAK:
000B49 D8A5 FE03             7      CP  3
000B4B D8A7 C0              11      RET NZ
       D8A8                     KEYBC:
000B4C D8A8 E5              11      PUSH    HL
000B4D D8A9 210000          10      LD  HL,0
000B50 D8AC 2290EF          16      LD  (_KEYPS),HL
000B53 D8AF E1              10      POP HL
000B54 D8B0 C9              10      RET
                                
       D8B1                     POP_AF_HL_SCF_RET:
000B55 D8B1 F1              10      POP AF
000B56 D8B2 E1              10      POP HL
000B57 D8B3 37               4      SCF
000B58 D8B4 C9              10      RET
                                
       D8B5                     _SYS01:     ;(BDOS)コンソール入力
000B59 D8B5 CD09EF          17      CALL    _SYS07
       D8B8                     MSG_A:
000B5C D8B8 F5              11      PUSH    AF
000B5D D8B9 D5              11      PUSH    DE
000B5E D8BA 5F               4      LD  E,A
000B5F D8BB CDC1D8          17      CALL    _SYS02
000B62 D8BE D1              10      POP DE
000B63 D8BF F1              10      POP AF
000B64 D8C0 C9              10      RET
                                
       D8C1                     _SYS02:     ;(BDOS)コンソール出力
000B65 D8C1 CDD3D8          17      CALL    BREAK
000B68 D8C4 1805            12      JR  PRINTX
                                
       D8C6                     _SYS06:     ;(BDOS)コンソール直接入出力
000B6A D8C6 7B               4      LD  A,E
000B6B D8C7 3C               4      INC A
000B6C D8C8 CACAEF          10      JP  Z,_INKEY
       D8CB                     PRINTX:
000B6F D8CB C3CDEF          10      JP  _PRINT
                                
       D8CE                     _SYS08:     ;(BDOS)エコーなしコンソール入力
000B72 D8CE CD09EF          17      CALL    _SYS07
000B75 D8D1 1804            12      JR  BREAK1
       D8D3                     BREAK:
000B77 D8D3 FB               4      EI
000B78 D8D4 3A92EF          13      LD  A,(_KEYD)
       D8D7                     BREAK1:
000B7B D8D7 FE03             7      CP  3       ;CTRL+C
000B7D D8D9 CA00EF          10      JP  Z,CPM_BOOT
000B80 D8DC FE13             7      CP  013H        ;CTRL+S
000B82 D8DE C0              11      RET NZ
                                
       D8DF                     PAUSE:
000B83 D8DF CDA8D8          17      CALL    KEYBC
                                
       D8E2                     FLGET:
000B86 D8E2 CDDFEF          17      CALL    _FFLUSH
000B89 D8E5 E5              11      PUSH    HL
000B8A D8E6 2A8EEF          16      LD  HL,(_TXADR)
000B8D D8E9 7C               4      LD  A,H
000B8E D8EA C6D0             7      ADD A,0D0H
000B90 D8EC 67               4      LD  H,A
000B91 D8ED CD37CF          17      CALL    RDMMIO
000B94 D8F0 3205D9          13      LD  (FLSMC),A
       D8F3                     FLGET1:
000B97 D8F3 CD2DCF          17      CALL    RD556VSYNC
000B9A D8F6 CB77             8      BIT 6,A
000B9C D8F8 3EEF             7      LD  A,0EFH      ;カーソル
000B9E D8FA 200A            12      JR  NZ,FLGET2
000BA0 D8FC 3A92EF          13      LD  A,(_KEYD)
000BA3 D8FF B7               4      OR  A
000BA4 D900 3EEF             7      LD  A,0EFH      ;カーソル
000BA6 D902 2002            12      JR  NZ,FLGET2
       D905                     FLSMC   EQU $+1
000BA8 D904 3E00             7      LD  A,0     ;自己書き換え
       D906                     FLGET2:
000BAA D906 CD3FCF          17      CALL    WRMMIO
000BAD D909 CDCAEF          17      CALL    _INKEY
000BB0 D90C 28E5            12      JR  Z,FLGET1
000BB2 D90E F5              11      PUSH    AF
000BB3 D90F 3A05D9          13      LD  A,(FLSMC)
000BB6 D912 CD3FCF          17      CALL    WRMMIO
000BB9 D915 F1              10      POP AF
000BBA D916 E1              10      POP HL
000BBB D917 C9              10      RET
                                
       D918                     _SYS0A:     ;(BDOS)文字列入力
000BBC D918 C5              11      PUSH    BC
000BBD D919 E5              11      PUSH    HL
000BBE D91A D5              11      PUSH    DE
000BBF D91B CDADDB          17      CALL    GETL
000BC2 D91E 1100FF          10      LD  DE,KBUF
000BC5 D921 E1              10      POP HL
000BC6 D922 E5              11      PUSH    HL
000BC7 D923 0E00             7      LD  C,0
000BC9 D925 3004            12      JR  NC,SAX0
000BCB D927 23               6      INC HL
000BCC D928 23               6      INC HL
000BCD D929 1808            12      JR  SAX4
       D92B                     SAX0:
000BCF D92B 46               7      LD  B,(HL)
000BD0 D92C 23               6      INC HL
       D92D                     SAX1:
000BD1 D92D 23               6      INC HL
000BD2 D92E 1A               7      LD  A,(DE)
000BD3 D92F 13               6      INC DE
000BD4 D930 B7               4      OR  A
000BD5 D931 2004            12      JR  NZ,SAX2
       D933                     SAX4:
000BD7 D933 360D            10      LD  (HL),00DH
000BD9 D935 1804            12      JR  SAX3
       D937                     SAX2:
000BDB D937 77               7      LD  (HL),A
000BDC D938 0C               4      INC C
000BDD D939 10F2            13      DJNZ    SAX1
       D93B                     SAX3:
000BDF D93B D1              10      POP DE
000BE0 D93C 79               4      LD  A,C
000BE1 D93D 13               6      INC DE
000BE2 D93E 12               7      LD  (DE),A
000BE3 D93F 1B               6      DEC DE
000BE4 D940 E1              10      POP HL
000BE5 D941 C1              10      POP BC
000BE6 D942 A7               4      AND A
000BE7 D943 C9              10      RET
                                
       D944                     _SYS0B:     ;(BDOS)コンソール状態のチェック
000BE8 D944 CDD3D8          17      CALL    BREAK
000BEB D947 3A92EF          13      LD  A,(_KEYD)
000BEE D94A B7               4      OR  A
000BEF D94B C8              11      RET Z
       D94C                     CONSTX:
000BF0 D94C CDDFEF          17      CALL    _FFLUSH
000BF3 D94F E5              11      PUSH    HL
000BF4 D950 2A90EF          16      LD  HL,(_KEYPS)
000BF7 D953 7C               4      LD  A,H
000BF8 D954 AD               4      XOR L
000BF9 D955 E1              10      POP HL
000BFA D956 C6FF             7      ADD A,0FFH
000BFC D958 9F               4      SBC A,A
000BFD D959 C9              10      RET
                                
       D95A                     _SYS2A:     ;(BDOS)日付の獲得
000BFE D95A AF               4      XOR A
000BFF D95B 57               4      LD  D,A
000C00 D95C 5F               4      LD  E,A
000C01 D95D 67               4      LD  H,A
000C02 D95E 6F               4      LD  L,A
000C03 D95F C9              10      RET
                                
       D960                     _SYS2C:     ;(BDOS)時刻の獲得
000C04 D960 AF               4      XOR A
000C05 D961 57               4      LD  D,A
000C06 D962 5F               4      LD  E,A
000C07 D963 67               4      LD  H,A
000C08 D964 6F               4      LD  L,A
000C09 D965 C9              10      RET
                                
       D966                     ESC1:
000C0A D966 7B               4      LD  A,E
000C0B D967 FE41             7      CP  'A'
000C0D D969 CA5EDA          10      JP  Z,CTRL1E
000C10 D96C FE42             7      CP  'B'
000C12 D96E CA70DB          10      JP  Z,CTRL1F
000C15 D971 FE43             7      CP  'C'
000C17 D973 CA31DA          10      JP  Z,CTRL1C
000C1A D976 FE44             7      CP  'D'
000C1C D978 CA55DA          10      JP  Z,CTRL1D
000C1F D97B FE45             7      CP  'E'
000C21 D97D 2802            12      JR  Z,CT0CX
000C23 D97F FE6A             7      CP  'j'
       D981                     CT0CX:
000C25 D981 CA55DB          10      JP  Z,CTRL0C
000C28 D984 FE48             7      CP  'H'
000C2A D986 CAD2DA          10      JP  Z,CTRL0B
000C2D D989 FE4A             7      CP  'J'
000C2F D98B CA58DB          10      JP  Z,CTRL06
000C32 D98E FE4B             7      CP  'K'
000C34 D990 CAA4DA          10      JP  Z,CTRL05
000C37 D993 FE4C             7      CP  'L'
000C39 D995 CA82DB          10      JP  Z,CTRL0E
000C3C D998 FE54             7      CP  'T'
000C3E D99A CAA4DA          10      JP  Z,CTRL05
000C41 D99D FE78             7      CP  'x'
000C43 D99F 2804            12      JR  Z,ESC1X
000C45 D9A1 FE79             7      CP  'y'
000C47 D9A3 2002            12      JR  NZ,ESC1Y
       D9A5                     ESC1X:
000C49 D9A5 3601            10      LD  (HL),1
       D9A7                     ESC1Y:
000C4B D9A7 FE3D             7      CP  '='
000C4D D9A9 2804            12      JR  Z,ESC1W
000C4F D9AB FE59             7      CP  'Y'
000C51 D9AD 2002            12      JR  NZ,ESC1Z
       D9AF                     ESC1W:
000C53 D9AF 3602            10      LD  (HL),2
       D9B1                     ESC1Z:
000C55 D9B1 FE20             7      CP  020H
000C57 D9B3 3802            12      JR  C,ESC1C
000C59 D9B5 87               4      ADD A,A
000C5A D9B6 D0              11      RET NC
       D9B7                     ESC1C:
000C5B D9B7 E1              10      POP HL
000C5C D9B8 1832            12      JR  ANK
                                
       D9BA                     ESC:
000C5E D9BA 211DDA          10      LD  HL,PRINTE5
000C61 D9BD E5              11      PUSH    HL
000C62 D9BE 21E0D9          10      LD  HL,ESCFLG
000C65 D9C1 3600            10      LD  (HL),0
000C67 D9C3 3D               4      DEC A
000C68 D9C4 28A0            12      JR  Z,ESC1
000C6A D9C6 3D               4      DEC A
000C6B D9C7 2009            12      JR  NZ,ESC2
000C6D D9C9 3603            10      LD  (HL),3
000C6F D9CB 7B               4      LD  A,E
000C70 D9CC D620             7      SUB 020H
000C72 D9CE 32D5D9          13      LD  (ESCYP+1),A
000C75 D9D1 C9              10      RET
       D9D2                     ESC2:
000C76 D9D2 3D               4      DEC A
000C77 D9D3 C0              11      RET NZ
000C78 D9D4 2600             7  ESCYP:  LD  H,0
000C7A D9D6 7B               4      LD  A,E
000C7B D9D7 D620             7      SUB 020H
000C7D D9D9 6F               4      LD  L,A
000C7E D9DA C3D6EF          10      JP  _LOC
                                
       D9DD                     PRINT:
000C81 D9DD C5              11      PUSH    BC
000C82 D9DE E5              11      PUSH    HL
       D9E0                     ESCFLG  EQU $+1
000C83 D9DF 3E00             7      LD  A,000H      ;自己書き換え
000C85 D9E1 B7               4      OR  A
000C86 D9E2 20D6            12      JR  NZ,ESC
                                
000C88 D9E4 3E1F             7      LD  A,01FH
000C8A D9E6 BB               4      CP  E
000C8B D9E7 3038            12      JR  NC,CTRL
       D9E9                     INSFLG  EQU $
000C8D D9E9 012ADB          10      LD  BC,INSERT   ;自己書き換え
       D9EC                     ANK:
000C90 D9EC 3A96EF          13      LD  A,(_COLORF)
000C93 D9EF 4F               4      LD  C,A
000C94 D9F0 7B               4      LD  A,E
000C95 D9F1 FE61             7      CP  'a'     ;英小文字
000C97 D9F3 3806            12      JR  C,PRT1
000C99 D9F5 FE7B             7      CP  'z'+1
000C9B D9F7 3002            12      JR  NC,PRT1
000C9D D9F9 CBF9             8      SET 7,C
       D9FB                     PRT1:
000C9F D9FB FE86             7      CP  $86     ;ひらがな1(を－そ)
000CA1 D9FD 3806            12      JR  C,PRT2
000CA3 D9FF FEA0             7      CP  $A0
000CA5 DA01 3002            12      JR  NC,PRT2
000CA7 DA03 CBF9             8      SET 7,C
       DA05                     PRT2:
000CA9 DA05 FEE0             7      CP  $E0     ;ひらがな2(たーん)
000CAB DA07 3802            12      JR  C,PRT3
000CAD DA09 CBF9             8      SET 7,C
       DA0B                     PRT3:
000CAF DA0B 2A8EEF          16      LD  HL,(_TXADR)
000CB2 DA0E 7C               4      LD  A,H
000CB3 DA0F C6D0             7      ADD A,0D0H
000CB5 DA11 67               4      LD  H,A
000CB6 DA12 42               4      LD  B,D
000CB7 DA13 16ED             7      LD  D,CD_TABLE/256
000CB9 DA15 1A               7      LD  A,(DE)
000CBA DA16 50               4      LD  D,B
000CBB DA17 CD57CF          17      CALL    IO_PRINT
000CBE DA1A CD31DA          17      CALL    CTRL1C
       DA1D                     PRINTE5:
000CC1 DA1D E1              10      POP HL
000CC2 DA1E C1              10      POP BC
000CC3 DA1F AF               4      XOR A
000CC4 DA20 C9              10      RET
                                
       DA21                     CTRL:
000CC5 DA21 7B               4      LD  A,E
000CC6 DA22 87               4      ADD A,A
000CC7 DA23 F680             7      OR  080H
000CC9 DA25 6F               4      LD  L,A
000CCA DA26 26F0             7      LD  H,CTRLTB/256
000CCC DA28 7E               7      LD  A,(HL)
000CCD DA29 2C               4      INC L
000CCE DA2A 66               7      LD  H,(HL)
000CCF DA2B 6F               4      LD  L,A
000CD0 DA2C CD0F00          17      CALL    JP_HL
000CD3 DA2F 18EC            12      JR  PRINTE5
                                
       DA31                     CTRL1C:
000CD5 DA31 ED4B8EEF        20      LD  BC,(_TXADR)
000CD9 DA35 03               6      INC BC
       DA36                     PRINTE3:
000CDA DA36 2118FC          10      LD  HL,0-WIDTH*LINE
000CDD DA39 A7               4      AND A
000CDE DA3A ED4A            15      ADC HL,BC
       DA3C                     PRINTE8:
000CE0 DA3C 2805            12      JR  Z,PRINT2
000CE2 DA3E ED438EEF        20      LD  (_TXADR),BC
       DA42                     CTRL00:
000CE6 DA42 C9              10      RET
                                
       DA43                     PRINT2:
000CE7 DA43 CD88DB          17      CALL    SCR
000CEA DA46 21D8FF          10      LD  HL,0-WIDTH
000CED DA49 09              11      ADD HL,BC
       DA4A                     SET_TXADR_HL:
000CEE DA4A 228EEF          16      LD  (_TXADR),HL
000CF1 DA4D C9              10      RET
                                
       DA4E                     CTRL08:
000CF2 DA4E 3AE9D9          13      LD  A,(INSFLG)
000CF5 DA51 FECD             7      CP  0CDH        ;CALL ????
000CF7 DA53 2823            12      JR  Z,CTRL02
       DA55                     CTRL1D:
000CF9 DA55 2A8EEF          16      LD  HL,(_TXADR)
000CFC DA58 7C               4      LD  A,H
000CFD DA59 B5               4      OR  L
000CFE DA5A C8              11      RET Z
000CFF DA5B 2B               6      DEC HL
000D00 DA5C 18EC            12      JR  SET_TXADR_HL
                                
       DA5E                     CTRL1E:
000D02 DA5E ED4B8EEF        20      LD  BC,(_TXADR)
000D06 DA62 21D8FF          10      LD  HL,0-WIDTH
000D09 DA65 09              11      ADD HL,BC
000D0A DA66 D0              11      RET NC
000D0B DA67 18E1            12      JR  SET_TXADR_HL
                                
       DA69                     CTRL09:
000D0D DA69 ED4B8EEF        20      LD  BC,(_TXADR)
000D11 DA6D 79               4      LD  A,C
000D12 DA6E E6F8             7      AND 0F8H
000D14 DA70 C608             7      ADD A,8
000D16 DA72 4F               4      LD  C,A
000D17 DA73 88               4      ADC A,B
000D18 DA74 91               4      SUB C
000D19 DA75 47               4      LD  B,A
000D1A DA76 18BE            12      JR  PRINTE3
                                
       DA78                     CTRL02:
000D1C DA78 CD55DA          17      CALL    CTRL1D
000D1F DA7B C8              11      RET Z
000D20 DA7C D5              11      PUSH    DE
000D21 DA7D CDD3EF          17      CALL    _POS
000D24 DA80 54               4      LD  D,H
000D25 DA81 3E28             7      LD  A,WIDTH
000D27 DA83 95               4      SUB L
000D28 DA84 4F               4      LD  C,A
000D29 DA85 0D               4      DEC C
000D2A DA86 06D0             7      LD  B,0D0H
000D2C DA88 2A8EEF          16      LD  HL,(_TXADR)
000D2F DA8B 09              11      ADD HL,BC
000D30 DA8C 47               4      LD  B,A
                                
000D31 DA8D 3A46DB          13      LD  A,(MULINE)
000D34 DA90 BA               4      CP  D
000D35 DA91 2007            12      JR  NZ,C02X1
000D37 DA93 112800          10      LD  DE,WIDTH
000D3A DA96 19              11      ADD HL,DE
000D3B DA97 78               4      LD  A,B
000D3C DA98 83               4      ADD A,E
000D3D DA99 47               4      LD  B,A
       DA9A                     C02X1:
000D3E DA9A 3A96EF          13      LD  A,(_COLORF) ;C:Color
000D41 DA9D 4F               4      LD  C,A
000D42 DA9E AF               4      XOR A       ;A:Text
000D43 DA9F CD9ECF          17      CALL    IO_BS
000D46 DAA2 D1              10      POP DE
000D47 DAA3 C9              10      RET
                                
       DAA4                     CTRL05:
000D48 DAA4 CDD3EF          17      CALL    _POS
000D4B DAA7 3E28             7      LD  A,WIDTH
000D4D DAA9 95               4      SUB L
000D4E DAAA 47               4      LD  B,A
       DAAB                     C08X1:
000D4F DAAB 2A8EEF          16      LD  HL,(_TXADR)
000D52 DAAE 7C               4      LD  A,H
000D53 DAAF C6D0             7      ADD A,0D0H
000D55 DAB1 67               4      LD  H,A
       DAB2                     CLLINE:
000D56 DAB2 3A96EF          13      LD  A,(_COLORF)
000D59 DAB5 4F               4      LD  C,A
000D5A DAB6 AF               4      XOR A
000D5B DAB7 C381CF          10      JP  IO_CLLINE
                                
       DABA                     CTRL0D:
000D5E DABA CDD3EF          17      CALL    _POS
000D61 DABD 2E00             7      LD  L,0
       DABF                     LOC:
000D63 DABF C5              11      PUSH    BC
000D64 DAC0 E5              11      PUSH    HL
000D65 DAC1 CDDFDA          17      CALL    LOC1
000D68 DAC4 228EEF          16      LD  (_TXADR),HL
000D6B DAC7 E1              10      POP HL
000D6C DAC8 C1              10      POP BC
000D6D DAC9 C9              10      RET
                                
       DACA                     CTRL12:
000D6E DACA 21E9D9          10      LD  HL,INSFLG
000D71 DACD 7E               7      LD  A,(HL)
000D72 DACE EECC             7      XOR 0CCH        ;CD:CALL ???? 1:LD BC,????
000D74 DAD0 77               7      LD  (HL),A
000D75 DAD1 C9              10      RET
                                
       DAD2                     CTRL0B:
000D76 DAD2 210000          10      LD  HL,0
000D79 DAD5 228EEF          16      LD  (_TXADR),HL
000D7C DAD8 C9              10      RET
                                
       DAD9                     CTRL1B:
000D7D DAD9 3E01             7      LD  A,1
000D7F DADB 32E0D9          13      LD  (ESCFLG),A
000D82 DADE C9              10      RET
                                
       DADF                     LOC1:
000D83 DADF D5              11      PUSH    DE
000D84 DAE0 4D               4      LD  C,L
000D85 DAE1 0608             7      LD  B,8
000D87 DAE3 5C               4      LD  E,H
000D88 DAE4 210028          10      LD  HL,WIDTH*256
000D8B DAE7 55               4      LD  D,L ;L=0
       DAE8                     LOC2:
000D8C DAE8 29              11      ADD HL,HL
000D8D DAE9 3001            12      JR  NC,LOC3
000D8F DAEB 19              11      ADD HL,DE
       DAEC                     LOC3:
000D90 DAEC 10FA            13      DJNZ    LOC2
000D92 DAEE 09              11      ADD HL,BC
000D93 DAEF D1              10      POP DE
000D94 DAF0 C9              10      RET
                                
       DAF1                     CONOUT1:
                                ;   CALL    CURSOR
000D95 DAF1 59               4      LD  E,C
000D96 DAF2 CDCDEF          17      CALL    _PRINT
000D99 DAF5 7B               4      LD  A,E
000D9A DAF6 FE0A             7      CP  00AH
000D9C DAF8 2006            12      JR  NZ,CURSOR
000D9E DAFA CDBADA          17      CALL    CTRL0D
000DA1 DAFD CDA4DA          17      CALL    CTRL05
       DB00                     CURSOR:
000DA4 DB00 C9              10      RET
                                
       DB01                     CTRL07:
000DA5 DB01 06E0             7      LD  B,0E0H
000DA7 DB03 2162EF          10      LD  HL,BEEPD+1
       DB06                     C07X0:
000DAA DB06 4E               7      LD  C,(HL)
000DAB DB07 23               6      INC HL
000DAC DB08 7E               7      LD  A,(HL)
000DAD DB09 23               6      INC HL
000DAE DB0A CD4FCF          17      CALL    WRMMIO_BC
000DB1 DB0D 7D               4      LD  A,L
000DB2 DB0E FE6A             7      CP  (BEEPD+1+M7BEEPE-M7BEEPD)&255
000DB4 DB10 20F4            12      JR  NZ,C07X0
000DB6 DB12 0610             7      LD  B,16
       DB14                     C07X1:
000DB8 DB14 CD2DCF          17      CALL    RD556VSYNC
000DBB DB17 87               4      ADD A,A
000DBC DB18 30FA            12      JR  NC,C07X1
       DB1A                     C07X2:
000DBE DB1A CD2DCF          17      CALL    RD556VSYNC
000DC1 DB1D 87               4      ADD A,A
000DC2 DB1E 38FA            12      JR  C,C07X2
000DC4 DB20 10F2            13      DJNZ    C07X1
                                
000DC6 DB22 AF               4      XOR A
000DC7 DB23 2108E0          10      LD  HL,0E008H
000DCA DB26 CD3FCF          17      CALL    WRMMIO
000DCD DB29 C9              10      RET
                                
       DB2A                     INSERT:
000DCE DB2A D5              11      PUSH    DE
000DCF DB2B CDD3EF          17      CALL    _POS
000DD2 DB2E 54               4      LD  D,H
000DD3 DB2F 3E28             7      LD  A,WIDTH
000DD5 DB31 95               4      SUB L
000DD6 DB32 47               4      LD  B,A
000DD7 DB33 2A8EEF          16      LD  HL,(_TXADR)
000DDA DB36 7C               4      LD  A,H
000DDB DB37 C6D0             7      ADD A,0D0H
000DDD DB39 67               4      LD  H,A
000DDE DB3A 3A96EF          13      LD  A,(_COLORF) ;C:Color
000DE1 DB3D 4F               4      LD  C,A
000DE2 DB3E AF               4      XOR A       ;A:Text
000DE3 DB3F CD91CF          17      CALL    IO_INS
000DE6 DB42 B7               4      OR  A
000DE7 DB43 2005            12      JR  NZ,INS1
       DB46                     MULINE  EQU $+1
000DE9 DB45 3EFF             7      LD  A,-1
000DEB DB47 92               4      SUB D
000DEC DB48 2009            12      JR  NZ,INS2
       DB4A                     INS1:
000DEE DB4A 0628             7      LD  B,WIDTH
000DF0 DB4C CD91CF          17      CALL    IO_INS
000DF3 DB4F 7A               4      LD  A,D
000DF4 DB50 3246DB          13      LD  (MULINE),A
       DB53                     INS2:
000DF7 DB53 D1              10      POP DE
000DF8 DB54 C9              10      RET
                                
       DB55                     CTRL0C:
000DF9 DB55 CDD2DA          17      CALL    CTRL0B
       DB58                     CTRL06:
000DFC DB58 D5              11      PUSH    DE
000DFD DB59 E5              11      PUSH    HL
000DFE DB5A ED5B8EEF        20      LD  DE,(_TXADR)
000E02 DB5E 3A96EF          13      LD  A,(_COLORF)
000E05 DB61 326ECF          13      LD  (ICSMC),A
000E08 DB64 C362CF          10      JP  IO_CLR
                                
       DB67                     CTRL04:
000E0B DB67 CDD3EF          17      CALL    _POS
000E0E DB6A 7D               4      LD  A,L
000E0F DB6B B7               4      OR  A
000E10 DB6C C8              11      RET Z
       DB6D                     CTRL03:
000E11 DB6D CDBADA          17      CALL    CTRL0D
       DB70                     CTRL0A:
       DB70                     CTRL1F:
000E14 DB70 2A8EEF          16      LD  HL,(_TXADR)
000E17 DB73 012800          10      LD  BC,WIDTH
000E1A DB76 09              11      ADD HL,BC
000E1B DB77 44               4      LD  B,H
000E1C DB78 4D               4      LD  C,L
000E1D DB79 2118FC          10      LD  HL,0-WIDTH*LINE
000E20 DB7C 09              11      ADD HL,BC
000E21 DB7D 3F               4      CCF
000E22 DB7E 9F               4      SBC A,A
000E23 DB7F C33CDA          10      JP  PRINTE8
                                
       DB82                     CTRL0E:
000E26 DB82 CDD3EF          17      CALL    _POS
000E29 DB85 7C               4      LD  A,H
000E2A DB86 1804            12      JR  SCR1
       DB88                     SCR:
000E2C DB88 3A97EF          13      LD  A,(_LINE)
000E2F DB8B 3D               4      DEC A
       DB8C                     SCR1:
000E30 DB8C C5              11      PUSH    BC
000E31 DB8D D5              11      PUSH    DE
000E32 DB8E E5              11      PUSH    HL
000E33 DB8F 1100D0          10      LD  DE,0D000H
000E36 DB92 2128D0          10      LD  HL,0D000H+WIDTH
                                
000E39 DB95 47               4      LD  B,A
000E3A DB96 B7               4      OR  A
000E3B DB97 C3B6CF          10      JP  IO_SCRUP
                                
       DB9A                     POS:
000E3E DB9A 2A8EEF          16      LD  HL,(_TXADR)
000E41 DB9D C5              11      PUSH    BC
000E42 DB9E 01D8FF          10      LD  BC,0-WIDTH
000E45 DBA1 AF               4      XOR A
       DBA2                     POS1:
000E46 DBA2 09              11      ADD HL,BC
000E47 DBA3 3C               4      INC A
000E48 DBA4 38FC            12      JR  C,POS1
000E4A DBA6 ED42            15      SBC HL,BC
000E4C DBA8 3D               4      DEC A
000E4D DBA9 67               4      LD  H,A
000E4E DBAA C1              10      POP BC
000E4F DBAB A7               4      AND A
000E50 DBAC C9              10      RET
                                
       DBAD                     GETL:
000E51 DBAD CDD3EF          17      CALL    _POS
000E54 DBB0 E5              11      PUSH    HL
000E55 DBB1 3ECD             7      LD  A,0CDH      ;CALL ????
000E57 DBB3 32E9D9          13      LD  (INSFLG),A
       DBB6                     GETL1:
000E5A DBB6 CDCED8          17      CALL    _SYS08
000E5D DBB9 FE09             7      CP  9
000E5F DBBB 2008            12      JR  NZ,GETL1V
000E61 DBBD 2100FF          10      LD  HL,KBUF
000E64 DBC0 CDDED5          17      CALL    MSX
000E67 DBC3 18F1            12      JR  GETL1
       DBC5                     GETL1V:
000E69 DBC5 5F               4      LD  E,A
000E6A DBC6 CDD3EF          17      CALL    _POS
000E6D DBC9 CDCDEF          17      CALL    _PRINT
000E70 DBCC 7B               4      LD  A,E
000E71 DBCD FE20             7      CP  $20
000E73 DBCF 3809            12      JR  C,GETL1V1
000E75 DBD1 7D               4      LD  A,L
000E76 DBD2 FE27             7      CP  WIDTH-1
000E78 DBD4 2004            12      JR  NZ,GETL1V1
000E7A DBD6 7C               4      LD  A,H
000E7B DBD7 3246DB          13      LD  (MULINE),A
       DBDA                     GETL1V1:
000E7E DBDA 7B               4      LD  A,E
000E7F DBDB FE0D             7      CP  00DH
000E81 DBDD 20D7            12      JR  NZ,GETL1
000E83 DBDF 3E01             7      LD  A,1     ;LD BC,????
000E85 DBE1 32E9D9          13      LD  (INSFLG),A
000E88 DBE4 1100FF          10      LD  DE,KBUF
000E8B DBE7 0628             7      LD  B,WIDTH
000E8D DBE9 CDBED3          17      CALL    ZERO_MEMORY_DE
                                
000E90 DBEC D1              10      POP DE
000E91 DBED CDD3EF          17      CALL    _POS
000E94 DBF0 6B               4      LD  L,E
000E95 DBF1 3E28             7      LD  A,WIDTH
000E97 DBF3 95               4      SUB L
000E98 DBF4 57               4      LD  D,A
                                
000E99 DBF5 3A46DB          13      LD  A,(MULINE)
000E9C DBF8 94               4      SUB H
000E9D DBF9 2806            12      JR  Z,GL2X
000E9F DBFB 3C               4      INC A
000EA0 DBFC 200C            12      JR  NZ,GL3X
000EA2 DBFE 25               4      DEC H
000EA3 DBFF 1805            12      JR  GL4X
       DC01                     GL2X:
000EA5 DC01 3E1F             7      LD  A,$1F
000EA7 DC03 CDB8D8          17      CALL    MSG_A
       DC06                     GL4X:
000EAA DC06 7A               4      LD  A,D
000EAB DC07 C628             7      ADD A,WIDTH
000EAD DC09 57               4      LD  D,A
       DC0A                     GL3X:
000EAE DC0A CDDFDA          17      CALL    LOC1
000EB1 DC0D 4D               4      LD  C,L
000EB2 DC0E 7C               4      LD  A,H
000EB3 DC0F C6D0             7      ADD A,0D0H
000EB5 DC11 47               4      LD  B,A
000EB6 DC12 5A               4      LD  E,D
000EB7 DC13 2100FF          10      LD  HL,KBUF
       DC16                     GETL2:
000EBA DC16 CDD0EF          17      CALL    _SCRN
000EBD DC19 03               6      INC BC
000EBE DC1A 77               7      LD  (HL),A
000EBF DC1B 23               6      INC HL
000EC0 DC1C 1D               4      DEC E
000EC1 DC1D 20F7            12      JR  NZ,GETL2
       DC1F                     GETL3:
000EC3 DC1F 2B               6      DEC HL
000EC4 DC20 7E               7      LD  A,(HL)
000EC5 DC21 FE21             7      CP  021H
000EC7 DC23 D0              11      RET NC
000EC8 DC24 3600            10      LD  (HL),0
000ECA DC26 15               4      DEC D
000ECB DC27 20F6            12      JR  NZ,GETL3
000ECD DC29 C9              10      RET
                                
       DC2A                     INKEY:
000ECE DC2A FB               4      EI
000ECF DC2B E5              11      PUSH    HL
000ED0 DC2C 2A90EF          16      LD  HL,(_KEYPS)
000ED3 DC2F 7C               4      LD  A,H
000ED4 DC30 AD               4      XOR L
000ED5 DC31 2809            12      JR  Z,INKEY1
000ED7 DC33 7C               4      LD  A,H
000ED8 DC34 3C               4      INC A
000ED9 DC35 3291EF          13      LD  (_KEYPS+1),A
000EDC DC38 6F               4      LD  L,A
000EDD DC39 26FE             7      LD  H,KEYBF/256
000EDF DC3B 7E               7      LD  A,(HL)
       DC3C                     INKEY1:
000EE0 DC3C E1              10      POP HL
000EE1 DC3D B7               4      OR  A
000EE2 DC3E C9              10      RET
                                
       DC3F                     INKEYB:
000EE3 DC3F C1              10      POP BC
000EE4 DC40 CB47             8      BIT 0,A
000EE6 DC42 3E08             7      LD  A,8
000EE8 DC44 2002            12      JR  NZ,INKEYD
000EEA DC46 3E03             7      LD  A,3
       DC48                     INKEYD:
000EEC DC48 B7               4      OR  A
000EED DC49 3292EF          13      LD  (_KEYD),A
000EF0 DC4C C9              10      RET
       DC4D                     CHKEY:
000EF1 DC4D C5              11      PUSH    BC
000EF2 DC4E 3E08             7      LD  A,8
000EF4 DC50 CD20CF          17      CALL    RDKEYDATA
000EF7 DC53 3293EF          13      LD  (_KEYD+1),A
000EFA DC56 CB7F             8      BIT 7,A
000EFC DC58 28E5            12      JR  Z,INKEYB
000EFE DC5A E5              11      PUSH    HL
000EFF DC5B 0E07             7      LD  C,7
000F01 DC5D 2140EC          10      LD  HL,KEY_TABLE
000F04 DC60 CB47             8      BIT 0,A
000F06 DC62 2003            12      JR  NZ,CHKEY0
000F08 DC64 2180EC          10      LD  HL,SHIFT_TABLE
       DC67                     CHKEY0:
000F0B DC67 CB77             8      BIT 6,A
000F0D DC69 2003            12      JR  NZ,CHKEY1
000F0F DC6B 21C0EC          10      LD  HL,CTRL_TABLE
       DC6E                     CHKEY1:
000F12 DC6E 79               4      LD  A,C
000F13 DC6F CD20CF          17      CALL    RDKEYDATA
000F16 DC72 0608             7      LD  B,8
       DC74                     CHKEY2:
000F18 DC74 87               4      ADD A,A
000F19 DC75 3009            12      JR  NC,CHKEY3
000F1B DC77 23               6      INC HL
000F1C DC78 10FA            13      DJNZ    CHKEY2
000F1E DC7A 0D               4      DEC C
000F1F DC7B 79               4      LD  A,C
000F20 DC7C 3C               4      INC A
000F21 DC7D 20EF            12      JR  NZ,CHKEY1
000F23 DC7F 06                      DB  $06     ;LD B,?? 次の1バイトを飛ばす
       DC80                     CHKEY3:
000F24 DC80 7E               7      LD  A,(HL)
000F25 DC81 E1              10      POP HL
000F26 DC82 C1              10      POP BC
000F27 DC83 18C3            12      JR  INKEYD
                                
       DC85                     SCRN:
000F29 DC85 E5              11      PUSH    HL
000F2A DC86 CD47CF          17      CALL    RDMMIO_BC
000F2D DC89 6F               4      LD  L,A
000F2E DC8A 26EE             7      LD  H,DC_TABLE/256
000F30 DC8C 7E               7      LD  A,(HL)
000F31 DC8D FE41             7      CP  'A'     ;英小文字チェック
000F33 DC8F 380E            12      JR  C,SCRN1
000F35 DC91 FE5B             7      CP  'Z'+1
000F37 DC93 DCA1DC          17      CALL    C,SCRNC
000F3A DC96 FEA6             7      CP  $A6     ;ひらがなチェック
000F3C DC98 3805            12      JR  C,SCRN1
000F3E DC9A FEE0             7      CP  $E0
000F40 DC9C DCA1DC          17      CALL    C,SCRNC
       DC9F                     SCRN1:
000F43 DC9F E1              10      POP HL
000F44 DCA0 C9              10      RET
                                
       DCA1                     SCRNC:
000F45 DCA1 6F               4      LD  L,A
000F46 DCA2 60               4      LD  H,B
000F47 DCA3 CBD8             8      SET 3,B
000F49 DCA5 CD47CF          17      CALL    RDMMIO_BC
000F4C DCA8 44               4      LD  B,H
000F4D DCA9 CB7F             8      BIT 7,A
000F4F DCAB 7D               4      LD  A,L
000F50 DCAC C8              11      RET Z
000F51 DCAD FE5B             7      CP  'Z'+1
000F53 DCAF 3804            12      JR  C,SCRNC_ADD
000F55 DCB1 FEC0             7      CP  $C0
000F57 DCB3 3803            12      JR  C,SCRNC_SUB
       DCB5                     SCRNC_ADD:
000F59 DCB5 C620             7      ADD A,$20
000F5B DCB7 C9              10      RET
       DCB8                     SCRNC_SUB:
000F5C DCB8 D620             7      SUB $20
000F5E DCBA C9              10      RET
[EOF:M7IO.ASM:SHIFT_JIS]
                                    INCLUDE "LDFILE.ASM"
                                
                                ;   LSX-Dodgers FILE
                                
       DCBB                     FILEC:
000F5F DCBB CDC6DC          17      CALL    FILE
       DCBE                     FILEC2:
000F62 DCBE 3A15EF          13      LD  A,(FDRV+1)
000F65 DCC1 FE20             7      CP  020H
000F67 DCC3 C8              11      RET Z
000F68 DCC4 1839            12      JR  SETDIR1
                                
       DCC6                     FILE:
000F6A DCC6 AF               4      XOR A
000F6B DCC7 3214EF          13      LD  (FDRV),A
000F6E DCCA 67               4      LD  H,A
000F6F DCCB 6F               4      LD  L,A
000F70 DCCC 2222EF          16      LD  (FDRV+14),HL
000F73 DCCF CD9DDD          17      CALL    SPCUT
000F76 DCD2 CD82DD          17      CALL    CCHK3
000F79 DCD5 2812            12      JR  Z,DEVI1
000F7B DCD7 13               6      INC DE
000F7C DCD8 1A               7      LD  A,(DE)
000F7D DCD9 1B               6      DEC DE
000F7E DCDA FE3A             7      CP  ':'
000F80 DCDC 200B            12      JR  NZ,DEVI1
000F82 DCDE 1A               7      LD  A,(DE)      ;DRIVE
000F83 DCDF CDD2DF          17      CALL    CAP
000F86 DCE2 D640             7      SUB '@'
000F88 DCE4 13               6      INC DE
000F89 DCE5 13               6      INC DE
000F8A DCE6 3214EF          13      LD  (FDRV),A
       DCE9                     DEVI1:
000F8D DCE9 1A               7      LD  A,(DE)
000F8E DCEA D65C             7      SUB 05CH        ;\
000F90 DCEC 2009            12      JR  NZ,NOROOT
000F92 DCEE 6F               4      LD  L,A     ;A=0でH=0のはずなのでHL=0
000F93 DCEF 222EEF          16      LD  (FDRV+26),HL
000F96 DCF2 2C               4      INC L
000F97 DCF3 2222EF          16      LD  (FDRV+14),HL
000F9A DCF6 13               6      INC DE
       DCF7                     NOROOT:
                                
       DCF7                     SETDIR:
000F9B DCF7 CD23DD          17      CALL    FILED
000F9E DCFA 1A               7      LD  A,(DE)
000F9F DCFB FE5C             7      CP  05CH        ;\
000FA1 DCFD C0              11      RET NZ
000FA2 DCFE 13               6      INC DE
       DCFF                     SETDIR1:
000FA3 DCFF 3E10             7      LD  A,010H      ;Directory
000FA5 DD01 3221EF          13      LD  (FDRV+13),A
000FA8 DD04 D5              11      PUSH    DE
000FA9 DD05 1114EF          10      LD  DE,FDRV
000FAC DD08 2A1EF0          16      LD  HL,(STABLE+2*00FH)
000FAF DD0B CD0F00          17      CALL    JP_HL
000FB2 DD0E D1              10      POP DE
000FB3 DD0F B7               4      OR  A
000FB4 DD10 C0              11      RET NZ
                                
000FB5 DD11 3A21EF          13      LD  A,(FDRV+13)
000FB8 DD14 CB67             8      BIT 4,A
000FBA DD16 C8              11      RET Z
                                
000FBB DD17 CD6ADD          17      CALL    FILEI
000FBE DD1A 2A2EEF          16      LD  HL,(FDRV+26)
000FC1 DD1D 23               6      INC HL
000FC2 DD1E 2222EF          16      LD  (FDRV+14),HL
000FC5 DD21 18D4            12      JR  SETDIR
                                
       DD23                     FILED:
000FC7 DD23 CD6ADD          17      CALL    FILEI
000FCA DD26 2115EF          10      LD  HL,FNAME
                                
000FCD DD29 0608             7      LD  B,8
       DD2B                     FILE2:
000FCF DD2B CD77DD          17      CALL    CCHKF
000FD2 DD2E C8              11      RET Z
000FD3 DD2F FE2A             7      CP  '*'
000FD5 DD31 282E            12      JR  Z,FILE9
000FD7 DD33 FE2E             7      CP  '.'
000FD9 DD35 280C            12      JR  Z,FILE4
000FDB DD37 77               7      LD  (HL),A
000FDC DD38 23               6      INC HL
000FDD DD39 10F0            13      DJNZ    FILE2
                                
       DD3B                     FILE3:
000FDF DD3B CD77DD          17      CALL    CCHKF
000FE2 DD3E C8              11      RET Z
000FE3 DD3F FE2E             7      CP  '.'
000FE5 DD41 20F8            12      JR  NZ,FILE3
                                
       DD43                     FILE4:
000FE7 DD43 211DEF          10      LD  HL,FNAME+8
000FEA DD46 0603             7      LD  B,3
                                
       DD48                     FILE4L:
000FEC DD48 CD77DD          17      CALL    CCHKF
000FEF DD4B C8              11      RET Z
000FF0 DD4C FE2E             7      CP  '.'
000FF2 DD4E 2008            12      JR  NZ,FILE12
000FF4 DD50 3215EF          13      LD  (FNAME),A   ;Parent directory(..)
000FF7 DD53 3216EF          13      LD  (FNAME+1),A
000FFA DD56 3E20             7      LD  A,020H
       DD58                     FILE12:
000FFC DD58 FE2A             7      CP  '*'
000FFE DD5A 280A            12      JR  Z,FILE10
001000 DD5C 77               7      LD  (HL),A
001001 DD5D 23               6      INC HL
001002 DD5E 10E8            13      DJNZ    FILE4L
001004 DD60 C9              10      RET
                                
       DD61                     FILE9:              ;名前の*処理、名前の残りを?で埋める
001005 DD61 CD66DD          17      CALL    FILE10
001008 DD64 18D5            12      JR  FILE3
                                
       DD66                     FILE10:
00100A DD66 3E3F             7      LD  A,'?'
00100C DD68 1808            12      JR  FILL_MEMORY
       DD6A                     FILEI:              ;名前＋拡張子をスペースで初期化
00100E DD6A 3E20             7      LD  A,020H
001010 DD6C 01000B          10      LD  BC,11*256   ;C=0にしておく
001013 DD6F 2115EF          10      LD  HL,FNAME
       DD72                     FILL_MEMORY:            ;HLからBバイトAで埋める
001016 DD72 77               7      LD  (HL),A
001017 DD73 23               6      INC HL
001018 DD74 10FC            13      DJNZ    FILL_MEMORY
00101A DD76 C9              10      RET
                                
       DD77                     CCHKF:
00101B DD77 1A               7      LD  A,(DE)
00101C DD78 CD7FDD          17      CALL    CCHK2
00101F DD7B C8              11      RET Z
001020 DD7C C3EAE0          10      JP  FKAN
                                
       DD7F                     CCHK2:
001023 DD7F 0C               4      INC C
001024 DD80 0D               4      DEC C
001025 DD81 C0              11      RET NZ
       DD82                     CCHK3:              ;ZF=1 で使えない文字
001026 DD82 FE2B             7      CP  '+'
001028 DD84 C8              11      RET Z
001029 DD85 FE2C             7      CP  ','
00102B DD87 C8              11      RET Z
00102C DD88 FE2F             7      CP  '/'
00102E DD8A C8              11      RET Z
00102F DD8B FE3A             7      CP  ':'
001031 DD8D C8              11      RET Z
001032 DD8E FE3B             7      CP  ';'
001034 DD90 C8              11      RET Z
001035 DD91 FE3D             7      CP  '='
001037 DD93 C8              11      RET Z
001038 DD94 FE5C             7      CP  05CH    ;\
00103A DD96 C8              11      RET Z
00103B DD97 FE20             7      CP  020H
00103D DD99 D0              11      RET NC
00103E DD9A BF               4      CP  A       ;Z=1
00103F DD9B C9              10      RET
                                
       DD9C                     SS1:
001040 DD9C 13               6      INC DE
       DD9D                     SPCUT:              ;スペースをカット
001041 DD9D 1A               7      LD  A,(DE)
001042 DD9E FE20             7      CP  020H
001044 DDA0 28FA            12      JR  Z,SS1
001046 DDA2 C9              10      RET
                                
       DDA3                     SETDRVF:
001047 DDA3 1114EF          10      LD  DE,FDRV
       DDA6                     SETDRV0:
00104A DDA6 CDAFDD          17      CALL    SETDRV
00104D DDA9 FDE1            14      POP IY
00104F DDAB C1              10      POP BC
001050 DDAC D1              10      POP DE
001051 DDAD E1              10      POP HL
001052 DDAE C9              10      RET
                                
       DDAF                     SETDRV:
001053 DDAF E3              19      EX  (SP),HL     ;HL=RETRN ADDRESS
001054 DDB0 D5              11      PUSH    DE      ;PUSH HL/DE/BC/IY
001055 DDB1 C5              11      PUSH    BC
001056 DDB2 1A               7      LD  A,(DE)
001057 DDB3 D5              11      PUSH    DE
001058 DDB4 FDE3            23      EX  (SP),IY
                                
00105A DDB6 CDC2DD          17      CALL    GETDRV
00105D DDB9 3C               4      INC A
00105E DDBA FD7700          19      LD  (IY+0),A    ;(FCB)ドライブ番号
001061 DDBD 3D               4      DEC A
001062 DDBE CDD9EF          17      CALL    _CHGDRV
                                
001065 DDC1 E9               4      JP  (HL)
                                
       DDC2                     GETDRV:
001066 DDC2 E67F             7      AND 07FH
001068 DDC4 D601             7      SUB 001H
00106A DDC6 3003            12      JR  NC,GETDRV1
00106C DDC8 3A87EF          13      LD  A,(_DVSW)   ;Current Drive
       DDCB                     GETDRV1:
00106F DDCB 3288EF          13      LD  (_DRV),A
001072 DDCE C9              10      RET
                                
       DDCF                     SOPENX:
001073 DDCF 1139EF          10      LD  DE,SFILE
001076 DDD2 1A               7      LD  A,(DE)
001077 DDD3 FDBE00           7      CP  (IY+0)      ;(FCB)ドライブ番号
00107A DDD6 2024            12      JR  NZ,SOPEN
00107C DDD8 13               6      INC DE
00107D DDD9 FDE5            15      PUSH    IY
00107F DDDB E1              10      POP HL
001080 DDDC 23               6      INC HL
001081 DDDD CD6ADF          17      CALL    CPFILE
001084 DDE0 201A            12      JR  NZ,SOPEN
                                
001086 DDE2 2AF4F0          16      LD  HL,(SCDIR)
001089 DDE5 FD750E          19      LD  (IY+14),L   ;(FCB)アクセスするディレクトリのクラスタ番号+1
00108C DDE8 FD740F          19      LD  (IY+15),H
                                
00108F DDEB 2AF8F0          16      LD  HL,(SFNDF)  ;Direcroty location and Flags
001092 DDEE 229FEF          16      LD  (_FILEN),HL
                                
001095 DDF1 ED5BF6F0        20      LD  DE,(SFBPS)
001099 DDF5 2139EF          10      LD  HL,SFILE
00109C DDF8 36FF            10      LD  (HL),0FFH
00109E DDFA 23               6      INC HL
00109F DDFB C9              10      RET
       DDFC                     SOPEN:
0010A0 DDFC 2112DF          10      LD  HL,FILESE
       DDFF                     SOPENC:
0010A3 DDFF 2238DE          16      LD  (OPENPAT+1),HL
                                
0010A6 DE02 CDE2EF          17      CALL    _RDFATX     ;Detect Media
0010A9 DE05 3856            12      JR  C,RDDERR
                                
0010AB DE07 AF               4      XOR A
0010AC DE08 329FEF          13      LD  (_FILEN),A
0010AF DE0B CD17E0          17      CALL    LDDIRX1     ;A=0で呼び出す
0010B2 DE0E 2818            12      JR  Z,SDIRX1
                                
0010B4 DE10 CD03DF          17      CALL    READ_DIR    ;Sub Directory
0010B7 DE13 3808            12      JR  C,SDIRX0
0010B9 DE15 2A7EF0          16      LD  HL,(_DTBUF)
0010BC DE18 7E               7      LD  A,(HL)
0010BD DE19 FE2E             7      CP  '.'
0010BF DE1B 280F            12      JR  Z,SOPEN1
       DE1D                     SDIRX0:
0010C1 DE1D AF               4      XOR A
0010C2 DE1E 32A0EF          13      LD  (_DIRF),A
0010C5 DE21 FD360E01        19      LD  (IY+14),1   ;(FCB)レコードサイズ
0010C9 DE25 FD770F          19      LD  (IY+15),A
       DE28                     SDIRX1:
0010CC DE28 ED5BFCF0        20      LD  DE,(_DIRPS) ;Root Directory
       DE2C                     SOPEN1:
0010D0 DE2C 0E20             7  SDECPAT:LD  C,32        ;自己書き換え 1セクタ辺りのディレクトリエントリ数  1024=32 / 512=16 / 256=8
       DE2E                     SOPEN1X:
0010D2 DE2E CD03DF          17      CALL    READ_DIR    ;FILE SEARCH
0010D5 DE31 382A            12      JR  C,RDDERR
0010D7 DE33 2A7EF0          16      LD  HL,(_DTBUF)
       DE36                     SOPEN2:
0010DA DE36 D5              11      PUSH    DE
0010DB DE37 CD12DF          17  OPENPAT:CALL    FILESE      ;(self-modifying code)
0010DE DE3A D1              10      POP DE
0010DF DE3B 386E            12      JR  C,SOPENE
0010E1 DE3D 281B            12      JR  Z,SCF_FF_RET
       DE3F                     SOPEN3:
0010E3 DE3F 3AA0EF          13      LD  A,(_DIRF)   ;ディレクトリか判別
0010E6 DE42 B7               4      OR  A
0010E7 DE43 200C            12      JR  NZ,SOPEN5
0010E9 DE45 13               6      INC DE      ;ルートディレクトリ
0010EA DE46 E5              11      PUSH    HL
0010EB DE47 210C00          10  MD_PAT: LD  HL,12       ;(self-modifying code)MAXDIR
0010EE DE4A ED52            15      SBC HL,DE       ;CF=0 なので SUB HL,DE
0010F0 DE4C E1              10      POP HL
0010F1 DE4D 20DD            12      JR  NZ,SOPEN1
0010F3 DE4F 1807            12      JR  SOPEN6
       DE51                     SOPEN5:
0010F5 DE51 CD46E7          17      CALL    GNCLX       ;END DIR
0010F8 DE54 D8              11      RET C
0010F9 DE55 CDCADF          17      CALL    ENDCL
       DE58                     SOPEN6:
0010FC DE58 38D2            12      JR  C,SOPEN1
       DE5A                     SCF_FF_RET:
0010FE DE5A 37               4      SCF         ;CF=1
0010FF DE5B 9F               4      SBC A,A     ;A=0FFH
001100 DE5C C9              10      RET
                                
       DE5D                     RDDERR:
001101 DE5D BF               4      CP  A       ;READ ERR CF=1 ZF=1
001102 DE5E 37               4      SCF
001103 DE5F C9              10      RET
                                
       DE60                     NOPEN:
001104 DE60 2112DF          10      LD  HL,FILESE
001107 DE63 2238DE          16      LD  (OPENPAT+1),HL
00110A DE66 FD2A98EF        20      LD  IY,(_FCB)
00110E DE6A CDFDE0          17      CALL    CHKWILDX
001111 DE6D 30EB            12      JR  NC,SCF_FF_RET
001113 DE6F FD7E00          19      LD  A,(IY+0)    ;(FCB)ドライブ番号
001116 DE72 3D               4      DEC A
001117 DE73 3288EF          13      LD  (_DRV),A
00111A DE76 CDD9EF          17      CALL    _CHGDRV
00111D DE79 D8              11      RET C
00111E DE7A 2AF8F0          16      LD  HL,(SFNDF)  ;Direcroty location and Flags
001121 DE7D 229FEF          16      LD  (_FILEN),HL
                                
001124 DE80 CD12E0          17      CALL    LDDIRX
001127 DE83 ED5B9AEF        20      LD  DE,(_FBPS)
00112B DE87 CD03DF          17      CALL    READ_DIR
00112E DE8A 38D1            12      JR  C,RDDERR
001130 DE8C 3A9EEF          13      LD  A,(_FBCNT)
001133 DE8F 3D               4      DEC A
001134 DE90 28AD            12      JR  Z,SOPEN3
       DE92                     NOPEN2:
001136 DE92 2A9CEF          16      LD  HL,(_FBAD)
001139 DE95 012000          10      LD  BC,020H
00113C DE98 09              11      ADD HL,BC
00113D DE99 4F               4      LD  C,A
00113E DE9A 189A            12      JR  SOPEN2
                                
       DE9C                     SOPENE2:
001140 DE9C 229CEF          16      LD  (_FBAD),HL
001143 DE9F 79               4      LD  A,C
001144 DEA0 329EEF          13      LD  (_FBCNT),A
001147 DEA3 ED539AEF        20      LD  (_FBPS),DE
00114B DEA7 FD2298EF        20      LD  (_FCB),IY
       DEAB                     SOPENE:
00114F DEAB AF               4      XOR A
001150 DEAC C9              10      RET
                                
       DEAD                     COPEN:
001151 DEAD FD360D20        19      LD  (IY+13),020H    ;(FCB)属性(アトリビュート)
                                
001155 DEB1 212FDF          10      LD  HL,NEXTSE
001158 DEB4 CDFFDD          17      CALL    SOPENC
00115B DEB7 D0              11      RET NC
00115C DEB8 C8              11      RET Z
00115D DEB9 3AA0EF          13      LD  A,(_DIRF)   ;ディレクトリか判別
001160 DEBC B7               4      OR  A
001161 DEBD 37               4      SCF
001162 DEBE C8              11      RET Z       ;ルートディレクトリ
001163 DEBF 0601             7      LD  B,1
001165 DEC1 CD5BE1          17      CALL    WRDF
001168 DEC4 D8              11      RET C
001169 DEC5 ED5BFEF0        20      LD  DE,(_CLPS)
00116D DEC9 D5              11      PUSH    DE
00116E DECA CD93DF          17      CALL    DCPAT
001171 DECD CDD1E5          17      CALL    DRDNX
001174 DED0 2A7EF0          16      LD  HL,(_DTBUF) ;ディレクトリエントリを0クリア
001177 DED3 3ACFE4          13      LD  A,(SECSZ+2) ;1024=4 / 512=2 / 256=1
00117A DED6 47               4      LD  B,A
00117B DED7 AF               4      XOR A
00117C DED8 4F               4      LD  C,A
       DED9                     COPENCL:
00117D DED9 77               7      LD  (HL),A
00117E DEDA EDA1            16      CPI         ;HL=HL+1 BC=BC-1 BCが0の場合にP/V=0
001180 DEDC EAD9DE          10      JP  PE,COPENCL
                                
001183 DEDF 3AB1DF          13      LD  A,(SPCPAT+1)    ;1クラスタの論理セクタ数
001186 DEE2 3D               4      DEC A
001187 DEE3 2819            12      JR  Z,COPENE
001189 DEE5 3E01             7      LD  A,1     ;1セクタ辺りのセクタ数が2以上の場合
00118B DEE7 323EE7          13      LD  (_SECPS+1),A
00118E DEEA D1              10      POP DE      ;DE=(_CLPS)
00118F DEEB D5              11      PUSH    DE
       DEEC                     COPEN1:
001190 DEEC D5              11      PUSH    DE      ;データバッファに入らないセクタもゼロクリア
001191 DEED C5              11      PUSH    BC
001192 DEEE 2A7EF0          16      LD  HL,(_DTBUF)
001195 DEF1 CDADDF          17      CALL    CLUSTX
001198 DEF4 CDAEE8          17      CALL    DWT24
00119B DEF7 C1              10      POP BC
00119C DEF8 D1              10      POP DE
00119D DEF9 CD3DE7          17      CALL    NEXTX
0011A0 DEFC 20EE            12      JR  NZ,COPEN1
       DEFE                     COPENE:
0011A2 DEFE 2A7EF0          16      LD  HL,(_DTBUF)
0011A5 DF01 D1              10      POP DE
0011A6 DF02 C9              10      RET
                                
       DF03                     READ_DIR:
0011A7 DF03 ED53FEF0        20      LD  (_CLPS),DE
0011AB DF07 C5              11      PUSH    BC
0011AC DF08 D5              11      PUSH    DE
0011AD DF09 CD93DF          17      CALL    DCPAT
0011B0 DF0C CDB1E5          17      CALL    DRDX
0011B3 DF0F D1              10      POP DE
0011B4 DF10 C1              10      POP BC
0011B5 DF11 C9              10      RET
                                
       DF12                     FILESE:
0011B6 DF12 7E               7      LD  A,(HL)
0011B7 DF13 B7               4      OR  A
0011B8 DF14 C8              11      RET Z       ;END:ZF=1 CF=0
0011B9 DF15 FEE5             7      CP  0E5H
0011BB DF17 280E            12      JR  Z,FILESE1
0011BD DF19 FDE5            15      PUSH    IY
0011BF DF1B D1              10      POP DE
0011C0 DF1C 13               6      INC DE
0011C1 DF1D E5              11      PUSH    HL
0011C2 DF1E CD6ADF          17      CALL    CPFILE
0011C5 DF21 CC8BDF          17      CALL    Z,CPFILE2
0011C8 DF24 E1              10      POP HL
0011C9 DF25 37               4      SCF
0011CA DF26 C8              11      RET Z       ;!!!:(ZF=1) CF=1
       DF27                     FILESE1:
0011CB DF27 CD3EDF          17      CALL    FNEXT
0011CE DF2A 20E6            12      JR  NZ,FILESE
       DF2C                     ZF0_CF0_AFF_RET:
0011D0 DF2C F6FF             7      OR  0FFH        ;ZF=0 CF=0
0011D2 DF2E C9              10      RET
                                
       DF2F                     NEXTSE:
0011D3 DF2F 7E               7      LD  A,(HL)
0011D4 DF30 B7               4      OR  A
0011D5 DF31 37               4      SCF
0011D6 DF32 C8              11      RET Z       ;!!!:ZF=1 CF=1
0011D7 DF33 FEE5             7      CP  0E5H
0011D9 DF35 37               4      SCF
0011DA DF36 C8              11      RET Z       ;!!!:(ZF=1) CF=1
0011DB DF37 CD3EDF          17      CALL    FNEXT
0011DE DF3A 20F3            12      JR  NZ,NEXTSE
0011E0 DF3C 18EE            12      JR  ZF0_CF0_AFF_RET
                                
       DF3E                     FNEXT:
0011E2 DF3E E5              11      PUSH    HL
0011E3 DF3F 219FEF          10      LD  HL,_FILEN
0011E6 DF42 34              11      INC (HL)
0011E7 DF43 E1              10      POP HL
0011E8 DF44 112000          10      LD  DE,020H
0011EB DF47 19              11      ADD HL,DE
0011EC DF48 0D               4      DEC C
0011ED DF49 C9              10      RET
                                
       DF4A                     CPNAME:
0011EE DF4A C5              11      PUSH    BC
0011EF DF4B D5              11      PUSH    DE
0011F0 DF4C E5              11      PUSH    HL
0011F1 DF4D CD64DF          17      CALL    CPFILE4
0011F4 DF50 E1              10      POP HL
0011F5 DF51 23               6      INC HL
0011F6 DF52 23               6      INC HL
0011F7 DF53 23               6      INC HL
0011F8 DF54 23               6      INC HL
0011F9 DF55 D1              10      POP DE
0011FA DF56 C1              10      POP BC
0011FB DF57 2005            12      JR  NZ,CPNAME1
0011FD DF59 7E               7      LD  A,(HL)
0011FE DF5A 23               6      INC HL
0011FF DF5B 66               7      LD  H,(HL)
001200 DF5C 6F               4      LD  L,A
001201 DF5D C9              10      RET
       DF5E                     CPNAME1:
001202 DF5E 23               6      INC HL
001203 DF5F 23               6      INC HL
001204 DF60 10E8            13      DJNZ    CPNAME
001206 DF62 37               4      SCF
001207 DF63 C9              10      RET
                                
       DF64                     CPFILE4:
001208 DF64 C5              11      PUSH    BC
001209 DF65 010004          10      LD  BC,00400H
00120C DF68 1804            12      JR  CPSTR1
       DF6A                     CPFILE:
00120E DF6A C5              11      PUSH    BC
00120F DF6B 01000B          10      LD  BC,00B00H
       DF6E                     CPSTR1:
001212 DF6E 1A               7      LD  A,(DE)
001213 DF6F FE3F             7      CP  '?'     ;Wild card
001215 DF71 2812            12      JR  Z,CPSTR2
001217 DF73 7E               7      LD  A,(HL)
001218 DF74 CDE3E0          17      CALL    FKANC
00121B DF77 E5              11      PUSH    HL
00121C DF78 67               4      LD  H,A
00121D DF79 1A               7      LD  A,(DE)
00121E DF7A CB01             4      RLC C
001220 DF7C CDE3E0          17      CALL    FKANC
001223 DF7F CB09             4      RRC C
001225 DF81 BC               4      CP  H       ;CP (HL),(DE)
001226 DF82 E1              10      POP HL
001227 DF83 2004            12      JR  NZ,CPSTR3
       DF85                     CPSTR2:
001229 DF85 13               6      INC DE
00122A DF86 23               6      INC HL
00122B DF87 10E5            13      DJNZ    CPSTR1
       DF89                     CPSTR3:
00122D DF89 C1              10      POP BC
00122E DF8A C9              10      RET
                                
       DF8B                     CPFILE2:
00122F DF8B FD7E0D          19      LD  A,(IY+13)   ;(FCB)属性(アトリビュート)
001232 DF8E F6E1             7      OR  0E1H
001234 DF90 2F               4      CPL
001235 DF91 A6               7      AND (HL)
001236 DF92 C9              10      RET
                                
       DF93                     DCPAT:
001237 DF93 0E00             7      LD  C,0
001239 DF95 2A7EF0          16      LD  HL,(_DTBUF)
00123C DF98 3AA0EF          13      LD  A,(_DIRF)   ;ディレクトリか判別
00123F DF9B B7               4      OR  A
001240 DF9C C8              11      RET Z       ;ルートディレクトリの場合はCレジスタを0にしておく(CDEがセクタ番号)
001241 DF9D 3AB1DF          13      LD  A,(SPCPAT+1)
001244 DFA0 4F               4      LD  C,A
001245 DFA1 3A3EE7          13      LD  A,(_SECPS+1)
001248 DFA4 B9               4      CP  C
001249 DFA5 3801            12      JR  C,DC1
00124B DFA7 AF               4      XOR A
       DFA8                     DC1:
00124C DFA8 F680             7      OR  080H
00124E DFAA 32A0EF          13      LD  (_DIRF),A   ;bit0-6:セクタインデックス
       DFAD                     CLUSTX:
001251 DFAD E5              11      PUSH    HL
001252 DFAE EB               4      EX  DE,HL
001253 DFAF AF               4      XOR A
001254 DFB0 0E01             7  SPCPAT: LD  C,1     ;自己書き換え（1クラスタの論理セクタ数）
       DFB2                     L_CLDBL:
001256 DFB2 CB19             8      RR  C       ;->CF
001258 DFB4 3804            12      JR  C,E_CLDBL
00125A DFB6 29              11      ADD HL,HL       ;*2
00125B DFB7 8F               4      ADC A,A
00125C DFB8 18F8            12      JR  L_CLDBL
       DFBA                     E_CLDBL:
00125E DFBA 4F               4      LD  C,A
00125F DFBB 3A3EE7          13      LD  A,(_SECPS+1)
001262 DFBE B5               4      OR  L
001263 DFBF 6F               4      LD  L,A
001264 DFC0 110800          10  CLSPAT: LD  DE,8    ;+8 (2D)  !ADDCL (self-modifying code)
001267 DFC3 AF               4      XOR A
001268 DFC4 19              11      ADD HL,DE   ;データ格納領域の先頭論理セクタ番号
001269 DFC5 89               4      ADC A,C
00126A DFC6 4F               4      LD  C,A
00126B DFC7 EB               4      EX  DE,HL
00126C DFC8 E1              10      POP HL
00126D DFC9 C9              10      RET
                                
       DFCA                     ENDCL:
00126E DFCA 7A               4      LD  A,D ;END CLUSTER
00126F DFCB FE01             7  CLPAT1: CP  1   ;164=356    (self-modifying code)
001271 DFCD C0              11      RET NZ
001272 DFCE 7B               4      LD  A,E
001273 DFCF FE64             7  CLPAT2: CP  064H    ;       (self-modifying code)
001275 DFD1 C9              10      RET
                                
       DFD2                     CAP:
001276 DFD2 FE61             7      CP  'a'
001278 DFD4 D8              11      RET C
001279 DFD5 FE7B             7      CP  'z'+1
00127B DFD7 D0              11      RET NC
00127C DFD8 D620             7      SUB 020H
00127E DFDA C9              10      RET
       DFDB                     CAP2:
00127F DFDB CDD2DF          17      CALL    CAP
       DFDE                     CAP3:
001282 DFDE CDE7DF          17      CALL    CAP4
001285 DFE1 FE21             7      CP  021H
001287 DFE3 D0              11      RET NC
001288 DFE4 3EA0             7      LD  A,0A0H
00128A DFE6 C9              10      RET
       DFE7                     CAP4:
00128B DFE7 FE05             7      CP  5
00128D DFE9 C0              11      RET NZ
00128E DFEA 3EE5             7      LD  A,0E5H
001290 DFEC C9              10      RET
                                
       DFED                     CHDIR:
001291 DFED CDDCE9          17      CALL    GETDPBD
001294 DFF0 381D            12      JR  C,CHDIR2
001296 DFF2 DD751A          19      LD  (IX+01AH),L     ;_SDIR_
001299 DFF5 DD741B          19      LD  (IX+01BH),H     ;_SDIR_+1
00129C DFF8 1815            12      JR  CHDIR2      ;POP_IX_RET
                                
       DFFA                     LDDIR:
00129E DFFA CDDCE9          17      CALL    GETDPBD
0012A1 DFFD DD5E1A          19      LD  E,(IX+01AH)     ;_SDIR_
0012A4 E000 DD561B          19      LD  D,(IX+01BH)     ;_SDIR_+1
0012A7 E003 13               6      INC DE
0012A8 E004 FD730E          19      LD  (IY+14),E   ;(FCB)アクセスするディレクトリのクラスタ番号+1
0012AB E007 FD720F          19      LD  (IY+15),D
0012AE E00A 1B               6      DEC DE
0012AF E00B AF               4      XOR A
0012B0 E00C 32A0EF          13      LD  (_DIRF),A
       E00F                     CHDIR2:
0012B3 E00F DDE1            14      POP IX
0012B5 E011 C9              10      RET
                                
       E012                     LDDIRX:
0012B6 E012 3AA0EF          13      LD  A,(_DIRF)   ;(FCB)アクセスするディレクトリのセクタインデックス
0012B9 E015 E67F             7      AND 07FH
       E017                     LDDIRX1:
0012BB E017 323EE7          13      LD  (_SECPS+1),A
0012BE E01A FD5E0E          19      LD  E,(IY+14)   ;(FCB)アクセスするディレクトリのクラスタ番号+1
0012C1 E01D FD560F          19      LD  D,(IY+15)
0012C4 E020 1B               6      DEC DE
0012C5 E021 CDCADF          17      CALL    ENDCL
0012C8 E024 D4FADF          17      CALL    NC,LDDIR
       E027                     LDDIRS:
0012CB E027 7A               4      LD  A,D
0012CC E028 B3               4      OR  E
0012CD E029 32A0EF          13      LD  (_DIRF),A   ;ディレクトリか判別
0012D0 E02C C9              10      RET
                                
       E02D                     KILL:
0012D1 E02D CDFDE0          17      CALL    CHKWILDX
0012D4 E030 3834            12      JR  C,KILLW
0012D6 E032 CDCFDD          17      CALL    SOPENX
       E035                     KILLS:
0012D9 E035 3E1F             7      LD  A,01FH
0012DB E037 D479E0          17      CALL    NC,CHKATT
0012DE E03A D8              11      RET C
       E03B                     KILLSX:
0012DF E03B 36E5            10      LD  (HL),0E5H   ;DIR
0012E1 E03D CDD7E0          17      CALL    WTDB
0012E4 E040 111A00          10      LD  DE,01AH
0012E7 E043 19              11      ADD HL,DE
0012E8 E044 5E               7      LD  E,(HL)
0012E9 E045 23               6      INC HL
0012EA E046 56               7      LD  D,(HL)
       E047                     KILLS1:
0012EB E047 CDCADF          17      CALL    ENDCL
0012EE E04A D0              11      RET NC      ;CF=0
0012EF E04B 21FEFF          10      LD  HL,0-2
0012F2 E04E 19              11      ADD HL,DE
0012F3 E04F D0              11      RET NC      ;DE= 0 or 1
0012F4 E050 D5              11      PUSH    DE
0012F5 E051 CDF7EF          17      CALL    _GNCL
0012F8 E054 ED53FEF0        20      LD  (_CLPS),DE
0012FC E058 D1              10      POP DE
0012FD E059 210000          10      LD  HL,0
001300 E05C D4FAEF          17      CALL    NC,_SNCL
001303 E05F D8              11      RET C
001304 E060 ED5BFEF0        20      LD  DE,(_CLPS)  ;FAT
001308 E064 18E1            12      JR  KILLS1
                                
       E066                     KILLW:
00130A E066 CDFCDD          17      CALL    SOPEN
       E069                     KILLW1:
00130D E069 380B            12      JR  C,KILLW2
00130F E06B CD9CDE          17      CALL    SOPENE2
001312 E06E CD35E0          17      CALL    KILLS
001315 E071 CD60DE          17      CALL    NOPEN
001318 E074 18F3            12      JR  KILLW1
       E076                     KILLW2:
00131A E076 C8              11      RET Z
00131B E077 3F               4      CCF
00131C E078 C9              10      RET
                                
       E079                     CHKATT:
00131D E079 E5              11      PUSH    HL
00131E E07A 110B00          10      LD  DE,00BH
001321 E07D 19              11      ADD HL,DE
001322 E07E A6               7      AND (HL)
001323 E07F E1              10      POP HL
001324 E080 C8              11      RET Z
001325 E081 37               4      SCF
001326 E082 C9              10      RET
                                
       E083                     NAME:
001327 E083 CDFDE0          17      CALL    CHKWILDX
00132A E086 D8              11      RET C
00132B E087 110400          10      LD  DE,4
00132E E08A 19              11      ADD HL,DE
00132F E08B 22A3E0          16      LD  (NAMEP+2),HL
001332 E08E 23               6      INC HL
001333 E08F CD01E1          17      CALL    CHKWILD
001336 E092 D8              11      RET C
                                
001337 E093 CDCFDD          17      CALL    SOPENX
00133A E096 3E0F             7      LD  A,00FH
00133C E098 D479E0          17      CALL    NC,CHKATT
00133F E09B D8              11      RET C
                                
001340 E09C FD7E00          19      LD  A,(IY+0)
001343 E09F FDE5            15      PUSH    IY
001345 E0A1 FD210000        14  NAMEP:  LD  IY,0        ;自己書き換え
001349 E0A5 FD7700          19      LD  (IY+0),A
00134C E0A8 CDCFDD          17      CALL    SOPENX
00134F E0AB FDE3            23      EX  (SP),IY
001351 E0AD 3F               4      CCF
001352 E0AE D4FCDD          17      CALL    NC,SOPEN
001355 E0B1 EB               4      EX  DE,HL
001356 E0B2 E1              10      POP HL
001357 E0B3 D8              11      RET C
                                
       E0B4                     SETNAME:
001358 E0B4 01000B          10      LD  BC,11*256
00135B E0B7 23               6      INC HL
00135C E0B8 7E               7      LD  A,(HL)
00135D E0B9 FEE5             7      CP  0E5H
00135F E0BB 2004            12      JR  NZ,SNAME1
001361 E0BD 3E05             7      LD  A,5
001363 E0BF 180E            12      JR  SNAME3
       E0C1                     SNAME1:
001365 E0C1 7E               7      LD  A,(HL)
001366 E0C2 0C               4      INC C
001367 E0C3 0D               4      DEC C
001368 E0C4 2009            12      JR  NZ,SNAME3
00136A E0C6 CDD2DF          17      CALL    CAP
00136D E0C9 FEA0             7      CP  0A0H
00136F E0CB 2002            12      JR  NZ,SNAME3
001371 E0CD 3E20             7      LD  A,020H
       E0CF                     SNAME3:
001373 E0CF 12               7      LD  (DE),A
001374 E0D0 7E               7      LD  A,(HL)
001375 E0D1 23               6      INC HL
001376 E0D2 CDEAE0          17      CALL    FKAN
001379 E0D5 10EA            13      DJNZ    SNAME1
       E0D7                     WTDB:
00137B E0D7 3EFF             7      LD  A,0FFH
00137D E0D9 3239EF          13      LD  (SFILE),A
       E0DC                     SWTDBF:
001380 E0DC 3E01             7      LD  A,1
001382 E0DE 32A4EF          13      LD  (_WTDBF),A
001385 E0E1 AF               4      XOR A
001386 E0E2 C9              10      RET
                                
       E0E3                     FKANC:
001387 E0E3 CB41             8      BIT 0,C
001389 E0E5 CCDBDF          17      CALL    Z,CAP2
00138C E0E8 1801            12      JR  FKANX
       E0EA                     FKAN:           ;漢字チェック
00138E E0EA 13               6      INC DE
       E0EB                     FKANX:
00138F E0EB CB41             8      BIT 0,C
001391 E0ED CB81             8      RES 0,C
001393 E0EF C0              11      RET NZ
001394 E0F0 FE80             7      CP  080H
001396 E0F2 D8              11      RET C
001397 E0F3 FEA0             7      CP  0A0H
001399 E0F5 3803            12      JR  C,FKAN1
00139B E0F7 FEE0             7      CP  0E0H
00139D E0F9 D8              11      RET C
       E0FA                     FKAN1:
00139E E0FA 0C               4      INC C
00139F E0FB A7               4      AND A
0013A0 E0FC C9              10      RET
                                
       E0FD                     CHKWILDX:
0013A1 E0FD FDE5            15      PUSH    IY
0013A3 E0FF E1              10      POP HL
0013A4 E100 23               6      INC HL
       E101                     CHKWILD:
0013A5 E101 060B             7      LD  B,11
0013A7 E103 3E3F             7      LD  A,'?'
       E105                     CHKWIL1:
0013A9 E105 BE               7      CP  (HL)
0013AA E106 23               6      INC HL
0013AB E107 37               4      SCF
0013AC E108 C8              11      RET Z
0013AD E109 10FA            13      DJNZ    CHKWIL1
0013AF E10B AF               4      XOR A
0013B0 E10C C9              10      RET
                                
       E10D                     SDIRENT:        ;IY=FCB HL=DIR
0013B1 E10D D5              11      PUSH    DE
0013B2 E10E E5              11      PUSH    HL
0013B3 E10F FDE5            15      PUSH    IY
0013B5 E111 D1              10      POP DE
0013B6 E112 EB               4      EX  DE,HL
0013B7 E113 CDB4E0          17      CALL    SETNAME
                                ;               Attribute
0013BA E116 FD7E0D          19      LD  A,(IY+13)   ;(FCB)属性(アトリビュート)
0013BD E119 12               7      LD  (DE),A
0013BE E11A 13               6      INC DE
                                ;               Reserved
0013BF E11B AF               4      XOR A
0013C0 E11C 060A             7      LD  B,10
       E11E                     SDE1:
0013C2 E11E 12               7      LD  (DE),A
0013C3 E11F 13               6      INC DE
0013C4 E120 10FC            13      DJNZ    SDE1
                                                    ;(FCB)更新時刻
0013C6 E122 21EAF0          10      LD  HL,SDDATA       ;(FCB)更新年月日
0013C9 E125 060A             7      LD  B,SDDATAE-SDDATA    ;(FCB)ファイルの先頭クラスタ
       E127                     SDLOOP:                 ;(FCB)ファイルのサイズ(バイト単位)
0013CB E127 7E               7      LD  A,(HL)
0013CC E128 23               6      INC HL
0013CD E129 322EE1          13      LD  (SDPAT+2),A
0013D0 E12C FD7E00          19  SDPAT:  LD  A,(IY+0)    ;LD A,(IY+A)
0013D3 E12F 12               7      LD  (DE),A
0013D4 E130 13               6      INC DE
0013D5 E131 10F4            13      DJNZ    SDLOOP
                                
0013D7 E133 AF               4      XOR A
0013D8 E134 E1              10      POP HL
0013D9 E135 D1              10      POP DE
0013DA E136 C9              10      RET
                                
       E137                     WOPEN:
0013DB E137 FD7E0D          19      LD  A,(IY+13)   ;(FCB)属性(アトリビュート)
0013DE E13A E61F             7      AND 01FH
0013E0 E13C 37               4      SCF
0013E1 E13D C0              11      RET NZ
0013E2 E13E FD361CFE        19      LD  (IY+28),0FEH    ;(FCB)オープンモード
       E142                     TOPEN2:
0013E6 E142 AF               4      XOR A
       E143                     TOPEN:              ;Initializes the time stamp
0013E7 E143 FD3617FF        19      LD  (IY+23),0FFH    ;(FCB)更新時刻
0013EB E147 C9              10      RET
                                
       E148                     WRDFX:
0013EC E148 3AB1DF          13      LD  A,(SPCPAT+1)    ;1クラスタの論理セクタ
       E14B                     L_WRFX:
0013EF E14B 1F               4      RRA         ;->CF
0013F0 E14C 3806            12      JR  C,E_WRFX
0013F2 E14E CB39             8      SRL C
0013F4 E150 CB1C             8      RR  H       ;CH=CH/2
0013F6 E152 18F7            12      JR  L_WRFX
       E154                     E_WRFX:
0013F8 E154 44               4      LD  B,H
0013F9 E155 04               4      INC B
0013FA E156 3E37             7      LD  A,037H      ;SCF
0013FC E158 32CEE5          13      LD  (DRDN1),A
                                
       E15B                     WRDF:               ;Bクラスタ分FATを確保する
0013FF E15B 110200          10      LD  DE,2
001402 E15E AF               4      XOR A
001403 E15F 323EE7          13      LD  (_SECPS+1),A
       E162                     WRDF1:
001406 E162 C5              11      PUSH    BC
001407 E163 D5              11      PUSH    DE
001408 E164 CDF7EF          17      CALL    _GNCL
00140B E167 381C            12      JR  C,WRDF3
00140D E169 7A               4      LD  A,D     ;空いているかチェック
00140E E16A B3               4      OR  E
00140F E16B 2027            12      JR  NZ,WRDF4
001411 E16D E1              10      POP HL      ;HL=空いているクラスタ
001412 E16E E5              11      PUSH    HL
001413 E16F ED5BFEF0        20      LD  DE,(_CLPS)  ;DE=元の(_CLPS)
001417 E173 22FEF0          16      LD  (_CLPS),HL
00141A E176 7A               4      LD  A,D     ;元の(_CLPS)が 0 か?
00141B E177 B3               4      OR  E
00141C E178 2008            12      JR  NZ,WRDF2
00141E E17A FD751A          19      LD  (IY+26),L   ;(FCB)ファイルの先頭クラスタ
001421 E17D FD741B          19      LD  (IY+27),H   ;元が空の場合はFCBにクラスタをセットする
001424 E180 1803            12      JR  WRDF3
       E182                     WRDF2:
001426 E182 CDFAEF          17      CALL    _SNCL
       E185                     WRDF3:
001429 E185 D1              10      POP DE
00142A E186 C1              10      POP BC
00142B E187 D8              11      RET C
00142C E188 100C            13      DJNZ    WRDF5       ;ここでループカウンタチェック
00142E E18A ED5BFEF0        20      LD  DE,(_CLPS)
001432 E18E 21FFFF          10      LD  HL,0FFFFH   ;FATエントリ終了(EOCマーク)
001435 E191 C3FAEF          10      JP  _SNCL
                                
       E194                     WRDF4:              ;DEクラスタが空じゃないので次に移動する
001438 E194 D1              10      POP DE
001439 E195 C1              10      POP BC
       E196                     WRDF5:
00143A E196 13               6      INC DE
00143B E197 CDCADF          17      CALL    ENDCL
00143E E19A 38C6            12      JR  C,WRDF1
001440 E19C 37               4      SCF
001441 E19D C9              10      RET
                                
       E19E                     RWXR:
001442 E19E 3ACFE4          13      LD  A,(SECSZ+2) ;1024=4 / 512=2 / 256=1
       E1A1                     L_RWX:
001445 E1A1 1F               4      RRA     ;->CF
001446 E1A2 3808            12      JR  C,E_RWX
001448 E1A4 CB38             8      SRL B   ;BCH=BCH/2
00144A E1A6 CB19             8      RR  C   ;
00144C E1A8 CB1C             8      RR  H   ;
00144E E1AA 18F5            12      JR  L_RWX
       E1AC                     E_RWX:
001450 E1AC FD5E1A          19      LD  E,(IY+26)   ;(FCB)ファイルの先頭クラスタ
001453 E1AF FD561B          19      LD  D,(IY+27)
001456 E1B2 AF               4      XOR A
001457 E1B3 323EE7          13      LD  (_SECPS+1),A
       E1B6                     RWX1:
00145A E1B6 ED53FEF0        20      LD  (_CLPS),DE
00145E E1BA 7A               4      LD  A,D
00145F E1BB B3               4      OR  E
001460 E1BC 2813            12      JR  Z,SCF_RET   ;RET DE==0 => CF=1
                                
001462 E1BE 78               4      LD  A,B
001463 E1BF B1               4      OR  C
001464 E1C0 B4               4      OR  H
001465 E1C1 C8              11      RET Z       ;RET BCH==0 => CF=0
                                
001466 E1C2 CD46E7          17      CALL    GNCLX
001469 E1C5 D8              11      RET C
00146A E1C6 7C               4      LD  A,H     ;
00146B E1C7 25               4      DEC H       ;
00146C E1C8 B7               4      OR  A       ;DEC BCH
00146D E1C9 2001            12      JR  NZ,RWX2     ;
00146F E1CB 0B               6      DEC BC      ;
       E1CC                     RWX2:
001470 E1CC CDCADF          17      CALL    ENDCL
001473 E1CF 38E5            12      JR  C,RWX1
       E1D1                     SCF_RET:
001475 E1D1 37               4      SCF
001476 E1D2 C9              10      RET
                                
       E1D3                     DSKF:
001477 E1D3 110000          10  MAXCLP: LD  DE,0
00147A E1D6 2AACEF          16      LD  HL,(_FAKEFREE)
00147D E1D9 7C               4      LD  A,H
00147E E1DA B5               4      OR  L
00147F E1DB 2803            12      JR  Z,DSKF1
001481 E1DD 110100          10      LD  DE,1
       E1E0                     DSKF1:
001484 E1E0 D5              11      PUSH    DE
001485 E1E1 CDF7EF          17      CALL    _GNCL
001488 E1E4 380C            12      JR  C,POPSCF
00148A E1E6 7A               4      LD  A,D
00148B E1E7 B3               4      OR  E
00148C E1E8 2001            12      JR  NZ,DSKF2
00148E E1EA 23               6      INC HL
       E1EB                     DSKF2:
00148F E1EB D1              10      POP DE
001490 E1EC 1B               6      DEC DE
001491 E1ED 7A               4      LD  A,D
001492 E1EE B3               4      OR  E
001493 E1EF 20EF            12      JR  NZ,DSKF1
001495 E1F1 C9              10      RET
                                
       E1F2                     POPSCF:
001496 E1F2 F1              10      POP AF
001497 E1F3 37               4      SCF
001498 E1F4 C9              10      RET
                                
       E1F5                     SETTMS:
001499 E1F5 FD7E17          19      LD  A,(IY+23)   ;(FCB)ファイルを最後に変更した時刻
00149C E1F8 3C               4      INC A
00149D E1F9 C0              11      RET NZ      ;ファイルが更新されていない
       E1FA                     SETTMSX:            ;FCBに日付時刻をセットする
00149E E1FA CD60D9          17      CALL    _SYS2C      ;(BDOS)時刻の獲得
                                                ;H←時  L←分  D←秒
0014A1 E1FD CB25             8      SLA L       ;   *2
0014A3 E1FF CB25             8      SLA L       ;   *4
0014A5 E201 29              11      ADD HL,HL       ;*2 *8
0014A6 E202 29              11      ADD HL,HL       ;*4 *16
0014A7 E203 29              11      ADD HL,HL       ;*8 *32
0014A8 E204 7A               4      LD  A,D
0014A9 E205 0F               4      RRCA            ;bit.0->7->->->0->C
0014AA E206 E61F             7      AND 01FH
0014AC E208 B5               4      OR  L
0014AD E209 FD7716          19      LD  (IY+22),A   ;(FCB)ファイルを最後に変更した時刻
0014B0 E20C FD7417          19      LD  (IY+23),H
                                
0014B3 E20F CD5AD9          17      CALL    _SYS2A      ;(BDOS)日付の獲得
                                                ;HL←年  D←月  E←日
0014B6 E212 0144F8          10      LD  BC,0-1980
0014B9 E215 09              11      ADD HL,BC
0014BA E216 65               4      LD  H,L
                                
0014BB E217 7A               4      LD  A,D
0014BC E218 87               4      ADD A,A     ;*2
0014BD E219 87               4      ADD A,A     ;*4
0014BE E21A 87               4      ADD A,A     ;*8
0014BF E21B 87               4      ADD A,A     ;*16
0014C0 E21C 6F               4      LD  L,A
0014C1 E21D 29              11      ADD HL,HL       ;*32
0014C2 E21E 7D               4      LD  A,L
0014C3 E21F B3               4      OR  E
0014C4 E220 FD7714          19      LD  (IY+20),A   ;(FCB)ファイルを最後に変更した日付
0014C7 E223 FD7415          19      LD  (IY+21),H
0014CA E226 C9              10      RET
                                
       E227                     PUSHRR:
0014CB E227 32C6E2          13      LD  (SETSEQ_SWC_RND),A
0014CE E22A 22D8E2          16      LD  (SETSEQ_SWC_SEQ_RR),HL
0014D1 E22D CD4DE2          17      CALL    GET_RR_AHL
0014D4 E230 225AEF          16      LD  (HLBUF),HL
0014D7 E233 325CEF          13      LD  (HLBUF+2),A
0014DA E236 C9              10      RET
                                
       E237                     GET_CPM_R_SIZE:     ;バイト単位からCP/Mのレコード単位を求める（1レコード=128バイト）
0014DB E237 87               4      ADD A,A     ;in BHLA => out AHL
0014DC E238 ED6A            15      ADC HL,HL
0014DE E23A CB18             8      RR  B
0014E0 E23C B7               4      OR  A
0014E1 E23D 78               4      LD  A,B     ;ここでフラグは変化しない
0014E2 E23E C8              11      RET Z
0014E3 E23F 2C               4      INC L       ;INC AHL
0014E4 E240 C0              11      RET NZ      ;
0014E5 E241 24               4      INC H       ;
0014E6 E242 C0              11      RET NZ      ;
0014E7 E243 3C               4      INC A       ;
0014E8 E244 C9              10      RET
                                
       E245                     INIT_RND:
0014E9 E245 3ECD             7      LD  A,0CDH      ;CALL ????
0014EB E247 2196E2          10      LD  HL,POPRR
0014EE E24A CD27E2          17      CALL    PUSHRR
       E24D                     GET_RR_AHL:
0014F1 E24D FD6E21          19      LD  L,(IY+33)   ;(FCB)Random record
0014F4 E250 FD6622          19      LD  H,(IY+34)   ;
0014F7 E253 FD7E23          19      LD  A,(IY+35)   ;
0014FA E256 C9              10      RET
       E257                     SET_RR_AHL:
0014FB E257 FD7521          19      LD  (IY+33),L   ;(FCB)Random record
0014FE E25A FD7422          19      LD  (IY+34),H
001501 E25D FD7723          19      LD  (IY+35),A
001504 E260 C9              10      RET
       E261                     INIT_SEQ:
001505 E261 3E01             7      LD  A,1     ;LD BC,????
001507 E263 2193E2          10      LD  HL,SETSEQ
00150A E266 CD27E2          17      CALL    PUSHRR
       E269                     GETSEQ:
00150D E269 FD6E20          19      LD  L,(IY+32)   ;(FCB)カレントレコード
001510 E26C FD660C          19      LD  H,(IY+12)   ;(FCB)カレントブロック
001513 E26F AF               4      XOR A
                                
001514 E270 CB25             8      SLA L   ;L=L*2
                                
001516 E272 CB3C             8      SRL H   ;HL=HL/2
001518 E274 CB1D             8      RR  L   ;
00151A E276 C9              10      RET
                                
       E277                     SETSEQ1:
00151B E277 F5              11      PUSH    AF      
00151C E278 E5              11      PUSH    HL      ;AHL=Random record
00151D E279 FD7E21          19      LD  A,(IY+33)   ;(FCB)ランダムレコード
001520 E27C FD6E22          19      LD  L,(IY+34)
001523 E27F FD6623          19      LD  H,(IY+35)
001526 E282 0600             7      LD  B,0
                                
001528 E284 CD37E2          17      CALL    GET_CPM_R_SIZE
                                
00152B E287 29              11      ADD HL,HL
00152C E288 CB3D             8      SRL L       ;L=L/2
00152E E28A FD7520          19      LD  (IY+32),L   ;(FCB)カレントレコード
001531 E28D FD740C          19      LD  (IY+12),H   ;(FCB)カレントブロック
001534 E290 E1              10      POP HL
001535 E291 F1              10      POP AF
001536 E292 C9              10      RET
       E293                     SETSEQ:
001537 E293 CD77E2          17      CALL    SETSEQ1
       E296                     POPRR:
00153A E296 F5              11      PUSH    AF
00153B E297 E5              11      PUSH    HL
00153C E298 2A5AEF          16      LD  HL,(HLBUF)
00153F E29B 3A5CEF          13      LD  A,(HLBUF+2)
001542 E29E CD57E2          17      CALL    SET_RR_AHL
001545 E2A1 E1              10      POP HL
001546 E2A2 F1              10      POP AF
001547 E2A3 C9              10      RET
                                
       E2A4                     RB_WRITE:
001548 E2A4 C5              11      PUSH    BC
001549 E2A5 ED4B4CF0        20      LD  BC,(STABLE+2*026H)  ;(BDOS)ランダムブロック書き込み
00154D E2A9 1805            12      JR  RBRW
       E2AB                     RB_READ:
00154F E2AB C5              11      PUSH    BC
001550 E2AC ED4B4EF0        20      LD  BC,(STABLE+2*027H)  ;(BDOS)ランダムブロック読み込み
       E2B0                     RBRW:
001554 E2B0 CB3F             8      SRL A   ;AHLA' = HL*128
001556 E2B2 CB1C             8      RR  H   ;AHL=AHL/2
001558 E2B4 CB1D             8      RR  L   ;
00155A E2B6 3E00             7      LD  A,0
00155C E2B8 1F               4      RRA     ;A'HLA
00155D E2B9 FD7721          19      LD  (IY+33),A   ;(FCB)ランダムレコード
001560 E2BC FD7522          19      LD  (IY+34),L
001563 E2BF FD7423          19      LD  (IY+35),H
001566 E2C2 218000          10      LD  HL,128
001569 E2C5 C5              11      PUSH    BC
       E2C6                     SETSEQ_SWC_RND:
00156A E2C6 CD77E2          17      CALL    SETSEQ1
00156D E2C9 C1              10      POP BC
00156E E2CA FDCB20FE        23      SET 7,(IY+32)   ;(FCB)カレントレコード
001572 E2CE FDE5            15      PUSH    IY
001574 E2D0 D1              10      POP DE
001575 E2D1 D5              11      PUSH    DE
001576 E2D2 CDE0E2          17      CALL    JP_BC
001579 E2D5 FDE1            14      POP IY
       E2D8                     SETSEQ_SWC_SEQ_RR   EQU $+1
00157B E2D7 CD93E2          17      CALL    SETSEQ
00157E E2DA FDCB20BE        23      RES 7,(IY+32)   ;(FCB)カレントレコード
                                
001582 E2DE C1              10      POP BC
001583 E2DF C9              10      RET
       E2E0                     JP_BC:
001584 E2E0 C5              11      PUSH    BC
001585 E2E1 C9              10      RET
                                
       DE5A                     _SYS03  EQU SCF_FF_RET  ;(BDOS)外部入力
       DE5A                     _SYS2B  EQU SCF_FF_RET  ;(BDOS)日付の設定
       DE5A                     _SYS2D  EQU SCF_FF_RET  ;(BDOS)時刻の設定
       DE5A                     _SYS39  EQU SCF_FF_RET  ;(BDOS)サブディレクトリの作成
       DE5A                     _SYS3A  EQU SCF_FF_RET  ;(BDOS)サブディレクトリの削除
                                
[EOF:LDFILE.ASM:SHIFT_JIS]
                                    INCLUDE "LDFILE2.ASM"
                                
                                ;   LSX-Dodgers FILE2
                                
                                                ;Write random block
       E2E2                     _SYS26:     ;(BDOS)ランダムブロック書き込み
001586 E2E2 AF               4      XOR A
001587 E2E3 32CEE5          13      LD  (DRDN1),A   ;NOP
00158A E2E6 2212E5          16      LD  (LEFT+1),HL ;HL←書き込むレコード数
00158D E2E9 225DEF          16      LD  (LEFTX),HL
001590 E2EC CDAFDD          17      CALL    SETDRV
                                
001593 E2EF CD69E4          17      CALL    RBX0
001596 E2F2 DA8CE3          10      JP  C,RBWERR
001599 E2F5 CD37E1          17      CALL    WOPEN
00159C E2F8 DA8CE3          10      JP  C,RBWERR
00159F E2FB 7C               4      LD  A,H
0015A0 E2FC B5               4      OR  L
0015A1 E2FD CA85E3          10      JP  Z,RBW1
                                
0015A4 E300 2B               6      DEC HL
                                
0015A5 E301 CD34E5          17      CALL    GET_RR_BCDE ;BCDE=Random record
                                
0015A8 E304 19              11      ADD HL,DE       ;BCHL=HL+BCDE
0015A9 E305 3001            12      JR  NC,S26X1    ;
0015AB E307 03               6      INC BC      ;
       E308                     S26X1:
0015AC E308 CD9EE1          17      CALL    RWXR
0015AF E30B DC48E1          17      CALL    C,WRDFX
0015B2 E30E DA8CE3          10      JP  C,RBWERR
                                
0015B5 E311 CD98E4          17      CALL    RBX2
0015B8 E314 281A            12      JR  Z,RBWB      ;NZ=セクタ以下の端数がある
0015BA E316 CDB7E4          17      CALL    RBXA
0015BD E319 3871            12      JR  C,RBWERR
0015BF E31B EB               4      EX  DE,HL
0015C0 E31C C5              11      PUSH    BC
0015C1 E31D EDB0                    LDIR
0015C3 E31F 225FEF          16      LD  (DTAX),HL
                                
0015C6 E322 CDDCE0          17      CALL    SWTDBF      ;バッファデータは更新された
                                
0015C9 E325 2A5DEF          16      LD  HL,(LEFTX)
0015CC E328 D1              10      POP DE
0015CD E329 ED52            15      SBC HL,DE
0015CF E32B 225DEF          16      LD  (LEFTX),HL
0015D2 E32E 2833            12      JR  Z,RBWEND
                                
       E330                     RBWB:
0015D4 E330 CDEDE4          17      CALL    RBXB
0015D7 E333 2816            12      JR  Z,RBWC
       E335                     RBWB1:
0015D9 E335 C5              11      PUSH    BC
0015DA E336 D5              11      PUSH    DE
0015DB E337 CDADDF          17      CALL    CLUSTX
0015DE E33A CD48E5          17      CALL    DWTC
0015E1 E33D D1              10      POP DE
0015E2 E33E C1              10      POP BC
0015E3 E33F 384B            12      JR  C,RBWERR
0015E5 E341 CD46E7          17      CALL    GNCLX
0015E8 E344 3846            12      JR  C,RBWERR
0015EA E346 10ED            13      DJNZ    RBWB1
0015EC E348 CD98E5          17      CALL    DRW_FLUSH
       E34B                     RBWC:
0015EF E34B CD05E5          17      CALL    RBXC
0015F2 E34E 2813            12      JR  Z,RBWEND
0015F4 E350 C5              11      PUSH    BC
0015F5 E351 CDADDF          17      CALL    CLUSTX
0015F8 E354 CDCDE5          17      CALL    DRDN
0015FB E357 C1              10      POP BC
0015FC E358 3832            12      JR  C,RBWERR
0015FE E35A ED5B7EF0        20      LD  DE,(_DTBUF)
001602 E35E EDB0                    LDIR
001604 E360 CDDCE0          17      CALL    SWTDBF      ;バッファデータは更新された
       E363                     RBWEND:
001607 E363 CD11E5          17      CALL    RBXEND
                                
00160A E366 CD78E4          17      CALL    RBX1
00160D E369 301A            12      JR  NC,RBW1
00160F E36B 2A12E5          16      LD  HL,(LEFT+1)
001612 E36E FD5E10          19      LD  E,(IY+16)   ;(FCB)ファイルのサイズ(バイト単位)
001615 E371 FD5611          19      LD  D,(IY+17)   ;DE=File size
001618 E374 19              11      ADD HL,DE
001619 E375 FD7510          19      LD  (IY+16),L   ;(FCB)ファイルのサイズ(バイト単位)
00161C E378 FD7411          19      LD  (IY+17),H
00161F E37B 3008            12      JR  NC,RBW1
001621 E37D FD3412          23      INC (IY+18)
001624 E380 2003            12      JR  NZ,RBW1
001626 E382 FD3413          23      INC (IY+19)
       E385                     RBW1:
001629 E385 FDE1            14      POP IY
00162B E387 C1              10      POP BC
00162C E388 D1              10      POP DE
00162D E389 E1              10      POP HL
       E38A                     DD_NUL:
00162E E38A AF               4      XOR A
       E38B                     DRDF0:
       E38B                     DWTF0:
00162F E38B C9              10      RET
                                
       E38C                     RBWERR:
001630 E38C FDE5            15      PUSH    IY
001632 E38E D1              10      POP DE
001633 E38F 2A20F0          16      LD  HL,(STABLE+2*010H)
001636 E392 CD0F00          17      CALL    JP_HL
       E395                     RBRERR1:
001639 E395 3E01             7      LD  A,001H
       E397                     RBRERR2:
00163B E397 FDE1            14      POP IY
00163D E399 C1              10      POP BC
00163E E39A D1              10      POP DE
00163F E39B E1              10      POP HL
001640 E39C 37               4      SCF
001641 E39D 210000          10      LD  HL,0
001644 E3A0 C9              10      RET
                                
       E3A1                     RBRERR:
001645 E3A1 3EFF             7      LD  A,0FFH
001647 E3A3 18F2            12      JR  RBRERR2
                                
       E3A5                     RBRFL:
001649 E3A5 3E00             7  RBRFLP: LD  A,000H
00164B E3A7 FE0D             7      CP  00DH
00164D E3A9 2005            12      JR  NZ,RBRFL1
00164F E3AB D5              11      PUSH    DE
001650 E3AC 1E0A             7      LD  E,00AH
001652 E3AE 1805            12      JR  RBRFL2
       E3B0                     RBRFL1:
001654 E3B0 D5              11      PUSH    DE
001655 E3B1 CD09EF          17      CALL    _SYS07
001658 E3B4 5F               4      LD  E,A
       E3B5                     RBRFL2:
001659 E3B5 CDCDEF          17      CALL    _PRINT
00165C E3B8 7B               4      LD  A,E
00165D E3B9 D1              10      POP DE
00165E E3BA 32A6E3          13      LD  (RBRFLP+1),A
001661 E3BD C9              10      RET
       E3BE                     DDX:
001662 E3BE FD7E01          19      LD  A,(IY+1)    ;(FCB)主ファイル名
001665 E3C1 CDD2DF          17      CALL    CAP
001668 E3C4 FE41             7      CP  'A'
00166A E3C6 C9              10      RET
                                
                                                ;Read random block
       E3C7                     _SYS27:     ;(BDOS)ランダムブロック読み込み
00166B E3C7 225DEF          16      LD  (LEFTX),HL
00166E E3CA CDAFDD          17      CALL    SETDRV
                                
001671 E3CD FDCB0D66        20      BIT 4,(IY+13)   ;(FCB)属性(アトリビュート)
001675 E3D1 C257E4          10      JP  NZ,RBRDIR   ;ディレクトリ
001678 E3D4 CD69E4          17      CALL    RBX0
00167B E3D7 DAA1E3          10      JP  C,RBRERR
00167E E3DA CD78E4          17      CALL    RBX1
001681 E3DD DA95E3          10      JP  C,RBRERR1
001684 E3E0 EB               4      EX  DE,HL
001685 E3E1 ED52            15      SBC HL,DE       ;CP 00HL,BCDE
001687 E3E3 19              11      ADD HL,DE
001688 E3E4 79               4      LD  A,C
001689 E3E5 DE00             7      SBC A,0
00168B E3E7 78               4      LD  A,B
00168C E3E8 DE00             7      SBC A,0
00168E E3EA 3801            12      JR  C,RBR1
001690 E3EC EB               4      EX  DE,HL
       E3ED                     RBR1:
001691 E3ED 9F               4      SBC A,A
001692 E3EE E601             7      AND 1
001694 E3F0 3255E4          13      LD  (RBRAP+1),A
                                
001697 E3F3 7C               4      LD  A,H
001698 E3F4 B5               4      OR  L
001699 E3F5 2857            12      JR  Z,RBREND0
                                
00169B E3F7 2212E5          16      LD  (LEFT+1),HL ;Read record byte
00169E E3FA 225DEF          16      LD  (LEFTX),HL
                                
0016A1 E3FD CD98E4          17      CALL    RBX2
0016A4 E400 2819            12      JR  Z,RBRB
0016A6 E402 CDB7E4          17      CALL    RBXA
0016A9 E405 DAA1E3          10      JP  C,RBRERR
0016AC E408 C5              11      PUSH    BC
0016AD E409 EDB0                    LDIR
0016AF E40B ED535FEF        20      LD  (DTAX),DE
0016B3 E40F 2A5DEF          16      LD  HL,(LEFTX)
0016B6 E412 D1              10      POP DE
0016B7 E413 A7               4      AND A
0016B8 E414 ED52            15      SBC HL,DE
0016BA E416 225DEF          16      LD  (LEFTX),HL
0016BD E419 2830            12      JR  Z,RBREND
                                
       E41B                     RBRB:
0016BF E41B CDEDE4          17      CALL    RBXB
0016C2 E41E 2815            12      JR  Z,RBRC
       E420                     RBRB1:
0016C4 E420 C5              11      PUSH    BC
0016C5 E421 D5              11      PUSH    DE
0016C6 E422 CDADDF          17      CALL    CLUSTX
0016C9 E425 CD4EE5          17      CALL    DRDC
0016CC E428 D1              10      POP DE
0016CD E429 C1              10      POP BC
0016CE E42A D446E7          17      CALL    NC,GNCLX
0016D1 E42D DAA1E3          10      JP  C,RBRERR
0016D4 E430 10EE            13      DJNZ    RBRB1
0016D6 E432 CD98E5          17      CALL    DRW_FLUSH
       E435                     RBRC:
0016D9 E435 CD05E5          17      CALL    RBXC
0016DC E438 2811            12      JR  Z,RBREND
0016DE E43A C5              11      PUSH    BC
0016DF E43B CDADDF          17      CALL    CLUSTX
0016E2 E43E CDB1E5          17      CALL    DRDX
0016E5 E441 C1              10      POP BC
0016E6 E442 DAA1E3          10      JP  C,RBRERR
0016E9 E445 EB               4      EX  DE,HL
0016EA E446 2A7EF0          16      LD  HL,(_DTBUF)
0016ED E449 EDB0                    LDIR
       E44B                     RBREND:
0016EF E44B CD11E5          17      CALL    RBXEND
       E44E                     RBREND0:
0016F2 E44E FDE1            14      POP IY
0016F4 E450 C1              10      POP BC
0016F5 E451 D1              10      POP DE
0016F6 E452 F1              10      POP AF  ;(HL)
0016F7 E453 AF               4      XOR A
0016F8 E454 3E00             7  RBRAP:  LD  A,000H
0016FA E456 C9              10      RET
                                
       E457                     RBRDIR:
0016FB E457 FD6E1A          19      LD  L,(IY+26)   ;(FCB)ファイルの先頭クラスタ
0016FE E45A FD661B          19      LD  H,(IY+27)
001701 E45D CDEDDF          17      CALL    CHDIR
001704 E460 AF               4      XOR A
001705 E461 67               4      LD  H,A
001706 E462 6F               4      LD  L,A
001707 E463 3C               4      INC A
001708 E464 3255E4          13      LD  (RBRAP+1),A
00170B E467 18E5            12      JR  RBREND0
                                
       E469                     RBX0:
00170D E469 2A8AEF          16      LD  HL,(_DTA)
001710 E46C 225FEF          16      LD  (DTAX),HL
001713 E46F 2A5DEF          16      LD  HL,(LEFTX)
001716 E472 FD7E1C          19      LD  A,(IY+28)   ;(FCB)オープンモード
001719 E475 D6FD             7      SUB 0FDH
00171B E477 C9              10      RET
                                
       E478                     RBX1:
00171C E478 E5              11      PUSH    HL      ;Record byte
                                                ;AHL=File size
00171D E479 FD6E10          19      LD  L,(IY+16)   ;ファイルのサイズ(バイト単位)
001720 E47C FD6611          19      LD  H,(IY+17)   ;
001723 E47F FD7E12          19      LD  A,(IY+18)   ;
                                
001726 E482 CD34E5          17      CALL    GET_RR_BCDE ;BCDE=Random record
                                
001729 E485 A7               4      AND A
00172A E486 ED52            15      SBC HL,DE
00172C E488 99               4      SBC A,C
00172D E489 4F               4      LD  C,A
00172E E48A FD7E13          19      LD  A,(IY+19)   ;ファイルのサイズ
001731 E48D 98               4      SBC A,B
001732 E48E D1              10      POP DE
                                
001733 E48F D8              11      RET C
001734 E490 47               4      LD  B,A
001735 E491 B1               4      OR  C
001736 E492 EB               4      EX  DE,HL   ;BCDE=File byte HL=Record byte
001737 E493 B2               4      OR  D
001738 E494 B3               4      OR  E
001739 E495 C0              11      RET NZ
00173A E496 37               4      SCF
00173B E497 C9              10      RET
                                
       E498                     RBX2:               ;Cluster settings
00173C E498 FD6622          19      LD  H,(IY+34)   ;(+33)(FCB)ランダムレコード
00173F E49B FD4E23          19      LD  C,(IY+35)
001742 E49E 0600             7      LD  B,0
001744 E4A0 FDCB207E        20      BIT 7,(IY+32)   ;(FCB)カレントレコード
001748 E4A4 2003            12      JR  NZ,RBX3
00174A E4A6 FD4624          19      LD  B,(IY+36)
       E4A9                     RBX3:
00174D E4A9 CD9EE1          17      CALL    RWXR
001750 E4AC 3ACFE4          13      LD  A,(SECSZ+2) ;1024=4 / 512=2 / 256=1
001753 E4AF 3D               4      DEC A
001754 E4B0 FDA622          19      AND (IY+34)
001757 E4B3 FDB621          19      OR  (IY+33)
00175A E4B6 C9              10      RET
                                
       E4B7                     RBXA:
00175B E4B7 C5              11      PUSH    BC
00175C E4B8 D5              11      PUSH    DE
00175D E4B9 CDADDF          17      CALL    CLUSTX
001760 E4BC CDB1E5          17      CALL    DRDX
001763 E4BF D1              10      POP DE
001764 E4C0 C1              10      POP BC
001765 E4C1 D8              11      RET C
001766 E4C2 CD46E7          17      CALL    GNCLX
001769 E4C5 D8              11      RET C
00176A E4C6 ED53FEF0        20      LD  (_CLPS),DE
                                
00176E E4CA FD4E21          19      LD  C,(IY+33)   ;(FCB)ランダムレコード
001771 E4CD 210004          10  SECSZ:  LD  HL,0400H    ;自己書き換え 1024=0400H / 512=0200H ここに1セクタのサイズが格納される
001774 E4D0 7C               4      LD  A,H
001775 E4D1 3D               4      DEC A       ;1024=3 / 512=1
001776 E4D2 FDA622          19      AND (IY+34)     ;(FCB)ランダムレコード
001779 E4D5 47               4      LD  B,A     ;BCに1セクタ以下の端数が入る
00177A E4D6 ED42            15      SBC HL,BC       ;残りを計算
                                
00177C E4D8 ED5B5DEF        20      LD  DE,(LEFTX)
001780 E4DC ED52            15      SBC HL,DE       ;CP HL,DE
001782 E4DE 19              11      ADD HL,DE       ;
001783 E4DF 3801            12      JR  C,RBXA1     ;DEとHLを比較して大きい方をHLに
001785 E4E1 EB               4      EX  DE,HL
       E4E2                     RBXA1:
001786 E4E2 E5              11      PUSH    HL
001787 E4E3 2A7EF0          16      LD  HL,(_DTBUF)
00178A E4E6 09              11      ADD HL,BC
00178B E4E7 ED5B5FEF        20      LD  DE,(DTAX)
00178F E4EB C1              10      POP BC
001790 E4EC C9              10      RET
                                
       E4ED                     RBXB:
001791 E4ED 2A5FEF          16      LD  HL,(DTAX)
001794 E4F0 ED5BFEF0        20      LD  DE,(_CLPS)
001798 E4F4 3A5EEF          13      LD  A,(LEFTX+1)
00179B E4F7 47               4      LD  B,A
00179C E4F8 3ACFE4          13      LD  A,(SECSZ+2) ;1024=4 / 512=2 / 256=1
       E4FB                     RBXB1:
00179F E4FB 1F               4      RRA     ;->CF
0017A0 E4FC 3804            12      JR  C,RBXB2
0017A2 E4FE CB38             8      SRL B   ;B=B/2
0017A4 E500 18F9            12      JR  RBXB1
       E502                     RBXB2:
0017A6 E502 78               4      LD  A,B
0017A7 E503 B7               4      OR  A
0017A8 E504 C9              10      RET
                                
       E505                     RBXC:
0017A9 E505 ED4B5DEF        20      LD  BC,(LEFTX)
0017AD E509 3ACFE4          13      LD  A,(SECSZ+2) ;1024=4 / 512=2 / 256=1
0017B0 E50C 3D               4      DEC A
0017B1 E50D A0               4      AND B
0017B2 E50E 47               4      LD  B,A     ;1セクタ以下の端数がない場合はZ
0017B3 E50F B1               4      OR  C
0017B4 E510 C9              10      RET
                                
       E511                     RBXEND:
0017B5 E511 110000          10  LEFT:   LD  DE,0
0017B8 E514 AF               4      XOR A
0017B9 E515 FD6E21          19      LD  L,(IY+33)   ;(FCB)ランダムレコード
0017BC E518 FD6622          19      LD  H,(IY+34)
0017BF E51B 19              11      ADD HL,DE
0017C0 E51C FD7521          19      LD  (IY+33),L   ;(FCB)ランダムレコード
0017C3 E51F FD7422          19      LD  (IY+34),H
0017C6 E522 300E            12      JR  NC,RBXEND1
0017C8 E524 FD3423          23      INC (IY+35)
0017CB E527 2009            12      JR  NZ,RBXEND1
0017CD E529 FDCB207E        20      BIT 7,(IY+32)   ;(FCB)カレントレコード
0017D1 E52D 2003            12      JR  NZ,RBXEND1
0017D3 E52F FD3424          23      INC (IY+36)
       E532                     RBXEND1:
0017D6 E532 EB               4      EX  DE,HL       ;HL=Read byte
0017D7 E533 C9              10      RET
                                
       E534                     GET_RR_BCDE:            ;BCDE=Random record
0017D8 E534 FD5E21          19      LD  E,(IY+33)   ;(FCB)ランダムレコード
0017DB E537 FD5622          19      LD  D,(IY+34)
0017DE E53A FD4E23          19      LD  C,(IY+35)
0017E1 E53D FD4624          19      LD  B,(IY+36)
0017E4 E540 FDCB207E        20      BIT 7,(IY+32)   ;(FCB)カレントレコード
0017E8 E544 C8              11      RET Z
0017E9 E545 0600             7      LD  B,0     ;CP/M互換のアクセスの場合はFCBは36バイト
0017EB E547 C9              10      RET
                                
                                ;   ランダムブロックアクセスの連続したセクタをまとめる
                                
       E548                     DWTC:
0017EC E548 E5              11      PUSH    HL
0017ED E549 21B0E8          10      LD  HL,DWT24B
0017F0 E54C 1804            12      JR  DWTC1
       E54E                     DRDC:
0017F2 E54E E5              11      PUSH    HL
0017F3 E54F 21A0E8          10      LD  HL,DRD24B
       E552                     DWTC1:
0017F6 E552 22ACE5          16      LD  (DRWF_MODE),HL
0017F9 E555 E1              10      POP HL
0017FA E556 3A9CE5          13      LD  A,(DRWF_B)
0017FD E559 B7               4      OR  A
0017FE E55A 200F            12      JR  NZ,DRDC1
       E55C                     SAVE_DRWC:
001800 E55C 0601             7      LD  B,1
001802 E55E ED439BE5        20      LD  (DRWF_C),BC
001806 E562 ED53A2E5        20      LD  (DRWF_E),DE
00180A E566 22A5E5          16      LD  (DRWF_HL),HL
00180D E569 1820            12      JR  INC_HL_DRWC
       E56B                     DRDC1:
00180F E56B E5              11      PUSH    HL
001810 E56C 21A2E5          10      LD  HL,DRWF_E
001813 E56F 86               7      ADD A,(HL)
001814 E570 F5              11      PUSH    AF
001815 E571 BB               4      CP  E
001816 E572 201D            12      JR  NZ,DRDC2
001818 E574 F1              10      POP AF
001819 E575 23               6      INC HL
00181A E576 7E               7      LD  A,(HL)
00181B E577 CE00             7      ADC A,0
00181D E579 F5              11      PUSH    AF
00181E E57A BA               4      CP  D
00181F E57B 2014            12      JR  NZ,DRDC2
001821 E57D F1              10      POP AF
001822 E57E 3A9BE5          13      LD  A,(DRWF_C)
001825 E581 CE00             7      ADC A,0
001827 E583 B9               4      CP  C
001828 E584 200C            12      JR  NZ,DRDC3
00182A E586 219CE5          10      LD  HL,DRWF_B
00182D E589 34              11      INC (HL)
00182E E58A E1              10      POP HL
       E58B                     INC_HL_DRWC:
00182F E58B 3ACFE4          13      LD  A,(SECSZ+2)     ;1セクタのサイズの上位1バイト
001832 E58E 84               4      ADD A,H
001833 E58F 67               4      LD  H,A
001834 E590 C9              10      RET
       E591                     DRDC2:
001835 E591 F1              10      POP AF
       E592                     DRDC3:
001836 E592 CD98E5          17      CALL    DRW_FLUSH
001839 E595 E1              10      POP HL
00183A E596 18C4            12      JR  SAVE_DRWC
                                
                                ;   ランダムブロックアクセスの連続したセクタをまとめたものをフラッシュする
       E598                     DRW_FLUSH:
00183C E598 C5              11      PUSH    BC
00183D E599 D5              11      PUSH    DE
       E59B                     DRWF_C  EQU $+1
       E59C                     DRWF_B  EQU $+2
00183E E59A 010000          10      LD  BC,0
001841 E59D 78               4      LD  A,B
001842 E59E B7               4      OR  A
001843 E59F 280D            12      JR  Z,DRDF1
       E5A2                     DRWF_E  EQU $+1
       E5A3                     DRWF_D  EQU $+2
001845 E5A1 110000          10      LD  DE,0
       E5A5                     DRWF_HL EQU $+1
001848 E5A4 210000          10      LD  HL,0
00184B E5A7 AF               4      XOR A
00184C E5A8 329CE5          13      LD  (DRWF_B),A
       E5AC                     DRWF_MODE   EQU $+1
00184F E5AB CDA0E8          17      CALL    DRD24B
       E5AE                     DRDF1:
001852 E5AE D1              10      POP DE
001853 E5AF C1              10      POP BC
001854 E5B0 C9              10      RET
[EOF:LDFILE2.ASM:SHIFT_JIS]
                                    INCLUDE "LDDIO.ASM"
                                
                                ;   LSX-Dodgers DIO
                                
       E5B1                     DRDX:
001855 E5B1 CDEFE5          17      CALL    DRDY
001858 E5B4 C8              11      RET Z
001859 E5B5 CDD5E5          17      CALL    DRDX1       ;データバッファの情報を保存
00185C E5B8 D8              11      RET C
00185D E5B9 E5              11      PUSH    HL
00185E E5BA C5              11      PUSH    BC
00185F E5BB D5              11      PUSH    DE
001860 E5BC 2A7EF0          16      LD  HL,(_DTBUF)
001863 E5BF 3A18E6          13      LD  A,(_DBS24+1)
001866 E5C2 4F               4      LD  C,A
001867 E5C3 CD9EE8          17      CALL    DRD24
00186A E5C6 DCEAE5          17      CALL    C,DRDNE
       E5C9                     POP_DE_BC_HL_RET:
00186D E5C9 D1              10      POP DE
00186E E5CA C1              10      POP BC
00186F E5CB E1              10      POP HL
001870 E5CC C9              10      RET
                                
                                ;   CDE:セクタ番号
       E5CD                     DRDN:
001871 E5CD AF               4      XOR A
001872 E5CE 00               4  DRDN1:  NOP         ;自己書き換え NOP / SCF
001873 E5CF 30E0            12      JR  NC,DRDX
       E5D1                     DRDNX:
001875 E5D1 CDEFE5          17      CALL    DRDY
001878 E5D4 C8              11      RET Z
       E5D5                     DRDX1:
001879 E5D5 CD05E6          17      CALL    DWTX
                                                ;データバッファの読み込んだドライブ・セクタ情報を保存
00187C E5D8 ED53A6EF        20      LD  (_DBSEC),DE
001880 E5DC 79               4      LD  A,C
001881 E5DD 3218E6          13      LD  (_DBS24+1),A
                                
001884 E5E0 3A88EF          13      LD  A,(_DRV)
001887 E5E3 32A5EF          13      LD  (_DBDRV),A
00188A E5E6 CDD9EF          17      CALL    _CHGDRV
00188D E5E9 D0              11      RET NC
       E5EA                     DRDNE:
00188E E5EA 9F               4      SBC A,A     ;CF=1ならばA=0FFH
00188F E5EB 32A5EF          13      LD  (_DBDRV),A
001892 E5EE C9              10      RET
                                
                                ;   CDE:セクタ番号
       E5EF                     DRDY:
001893 E5EF 3A18E6          13      LD  A,(_DBS24+1)
001896 E5F2 B9               4      CP  C
001897 E5F3 C0              11      RET NZ
                                
001898 E5F4 E5              11      PUSH    HL
001899 E5F5 3A88EF          13      LD  A,(_DRV)
00189C E5F8 21A5EF          10      LD  HL,_DBDRV
00189F E5FB AE               7      XOR (HL)
0018A0 E5FC 2005            12      JR  NZ,POP_HL_RET
                                
0018A2 E5FE 2AA6EF          16      LD  HL,(_DBSEC)
0018A5 E601 ED52            15      SBC HL,DE       ;CF=0
       E603                     POP_HL_RET:
0018A7 E603 E1              10      POP HL
0018A8 E604 C9              10      RET
                                
       E605                     DWTX:
0018A9 E605 3AA4EF          13      LD  A,(_WTDBF)
0018AC E608 B7               4      OR  A
0018AD E609 C8              11      RET Z
0018AE E60A AF               4      XOR A
0018AF E60B 32A4EF          13      LD  (_WTDBF),A
                                
0018B2 E60E E5              11      PUSH    HL
0018B3 E60F C5              11      PUSH    BC
0018B4 E610 D5              11      PUSH    DE
0018B5 E611 3AA5EF          13      LD  A,(_DBDRV)
0018B8 E614 CDD9EF          17      CALL    _CHGDRV
0018BB E617 0E00             7  _DBS24: LD  C,0
0018BD E619 ED5BA6EF        20      LD  DE,(_DBSEC)
0018C1 E61D 2A7EF0          16      LD  HL,(_DTBUF)
0018C4 E620 D4AEE8          17      CALL    NC,DWT24
       E623                     POP_DE_BC_HL_RET2:
0018C7 E623 18A4            12      JR  POP_DE_BC_HL_RET
                                
       E625                     RDFATX:
0018C9 E625 E5              11      PUSH    HL
0018CA E626 3A88EF          13      LD  A,(_DRV)
0018CD E629 21AAEF          10      LD  HL,_FATDRV
0018D0 E62C AE               7      XOR (HL)
0018D1 E62D 28D4            12      JR  Z,POP_HL_RET
                                
0018D3 E62F C5              11      PUSH    BC
0018D4 E630 D5              11      PUSH    DE
0018D5 E631 DDE5            15      PUSH    IX
0018D7 E633 CD4FE6          17      CALL    WTFATX
0018DA E636 3813            12      JR  C,POP_IX_DE_BC_HL_RET
                                
0018DC E638 AF               4      XOR A
0018DD E639 32ABEF          13      LD  (_FATIX),A
0018E0 E63C 3A88EF          13      LD  A,(_DRV)
0018E3 E63F 32AAEF          13      LD  (_FATDRV),A
0018E6 E642 CDE5EF          17      CALL    _RDFAT
       E645                     RDFATE2:
0018E9 E645 3004            12      JR  NC,POP_IX_DE_BC_HL_RET
0018EB E647 9F               4      SBC A,A     ;A=0xFF
0018EC E648 32AAEF          13      LD  (_FATDRV),A
       E64B                     POP_IX_DE_BC_HL_RET:
0018EF E64B DDE1            14      POP IX
0018F1 E64D 18D4            12      JR  POP_DE_BC_HL_RET2
                                
       E64F                     WTFATX:
0018F3 E64F 3AA2EF          13      LD  A,(_WTFATF)
0018F6 E652 B7               4      OR  A
0018F7 E653 C8              11      RET Z
0018F8 E654 E5              11      PUSH    HL
0018F9 E655 3AAAEF          13      LD  A,(_FATDRV)
0018FC E658 21A5EF          10      LD  HL,_DBDRV
0018FF E65B AE               7      XOR (HL)
001900 E65C CC05E6          17      CALL    Z,DWTX
001903 E65F 38A2            12      JR  C,POP_HL_RET
001905 E661 C5              11      PUSH    BC
001906 E662 D5              11      PUSH    DE
001907 E663 DDE5            15      PUSH    IX
001909 E665 CDBBE8          17      CALL    WTFAT
00190C E668 AF               4      XOR A
00190D E669 32A2EF          13      LD  (_WTFATF),A
001910 E66C 18DD            12      JR  POP_IX_DE_BC_HL_RET
                                
       E66E                     NCL1:
001912 E66E 7A               4      LD  A,D
001913 E66F B3               4      OR  E
001914 E670 37               4      SCF
001915 E671 C8              11      RET Z
                                
001916 E672 7A               4      LD  A,D
001917 E673 CB3F             8      SRL A   ;/2
001919 E675 CB3F             8      SRL A   ;/2
                                
00191B E677 E5              11      PUSH    HL
00191C E678 3297E6          13      LD  (NCLPAT+2),A    ;_FATIX
00191F E67B 2AAAEF          16      LD  HL,(_FATDRV)    ;L=_FATDRV H=_FATIX
001922 E67E BC               4      CP  H
001923 E67F 3A88EF          13      LD  A,(_DRV)    ;この間でフラグは変化しない
001926 E682 3296E6          13      LD  (NCLPAT+1),A    ;_FATDRV
001929 E685 2005            12      JR  NZ,NCL2     ;FATIXが違う
00192B E687 BD               4      CP  L
00192C E688 2002            12      JR  NZ,NCL2     ;ドライブが違う
00192E E68A E1              10      POP HL
00192F E68B C9              10      RET
       E68C                     NCL2:
001930 E68C C5              11      PUSH    BC
001931 E68D D5              11      PUSH    DE
001932 E68E DDE5            15      PUSH    IX
001934 E690 CD4FE6          17      CALL    WTFATX
001937 E693 38B6            12      JR  C,POP_IX_DE_BC_HL_RET
001939 E695 010000          10  NCLPAT: LD  BC,0        ;自己書き換え C=_FATDRV B=_FATIX
00193C E698 ED43AAEF        20      LD  (_FATDRV),BC
001940 E69C CD90E8          17      CALL    RDFATS
001943 E69F 18A4            12      JR  RDFATE2
                                
       E6A1                     NCL3:
001945 E6A1 CB9A             8      RES 3,D
001947 E6A3 CB92             8      RES 2,D
001949 E6A5 6B               4      LD  L,E
00194A E6A6 62               4      LD  H,D
00194B E6A7 CB3C             8      SRL H   ;
00194D E6A9 CB1D             8      RR  L   ;HLA=HLA/2
00194F E6AB 1F               4      RRA     ;
001950 E6AC F5              11      PUSH    AF
001951 E6AD 3AABEF          13      LD  A,(_FATIX)
001954 E6B0 0F               4      RRCA
001955 E6B1 300B            12      JR  NC,NCL3X1
001957 E6B3 3ACFE4          13      LD  A,(SECSZ+2)
00195A E6B6 FE04             7      CP  4       ;1セクタ1024バイトの場合は奇数インデックスの場合に先頭を512バイトずらす
00195C E6B8 2004            12      JR  NZ,NCL3X1
00195E E6BA 010002          10      LD  BC,512
001961 E6BD 09              11      ADD HL,BC
       E6BE                     NCL3X1:
001962 E6BE F1              10      POP AF
001963 E6BF ED4B7CF0        20      LD  BC,(_FATBF)
001967 E6C3 19              11      ADD HL,DE
001968 E6C4 09              11      ADD HL,BC
001969 E6C5 17               4      RLA
00196A E6C6 C9              10      RET
                                
       E6C7                     GNCL:
00196B E6C7 CD6EE6          17      CALL    NCL1        ;GET NEXT CLUSTER
00196E E6CA D8              11      RET C
00196F E6CB C5              11      PUSH    BC
001970 E6CC E5              11      PUSH    HL
001971 E6CD CDA1E6          17      CALL    NCL3
001974 E6D0 3809            12      JR  C,GNC1
001976 E6D2 5E               7      LD  E,(HL)
001977 E6D3 23               6      INC HL
001978 E6D4 7E               7      LD  A,(HL)
001979 E6D5 E60F             7      AND 00FH
00197B E6D7 57               4      LD  D,A
00197C E6D8 E1              10      POP HL
00197D E6D9 C1              10      POP BC
00197E E6DA C9              10      RET
       E6DB                     GNC1:
00197F E6DB 7E               7      LD  A,(HL)
001980 E6DC 23               6      INC HL
001981 E6DD 56               7      LD  D,(HL)
001982 E6DE 0604             7      LD  B,4
       E6E0                     GNC1L:
001984 E6E0 CB3A             8      SRL D   ;DA=DA/2
001986 E6E2 1F               4      RRA     ;
001987 E6E3 10FB            13      DJNZ    GNC1L
                                
001989 E6E5 5F               4      LD  E,A
00198A E6E6 E1              10      POP HL
00198B E6E7 C1              10      POP BC
00198C E6E8 A7               4      AND A
00198D E6E9 C9              10      RET
                                
       E6EA                     SNCL:
00198E E6EA CD6EE6          17      CALL    NCL1
001991 E6ED D8              11      RET C
                                ;               SET NEXT CLUSTER
001992 E6EE E5              11      PUSH    HL
001993 E6EF C5              11      PUSH    BC
001994 E6F0 D5              11      PUSH    DE
001995 E6F1 E5              11      PUSH    HL
001996 E6F2 CDA1E6          17      CALL    NCL3
001999 E6F5 D1              10      POP DE
                                ;CF=ODD
00199A E6F6 7E               7      LD  A,(HL)
00199B E6F7 73               7      LD  (HL),E
00199C E6F8 3806            12      JR  C,SNC1
                                ;EVEN
                                ;M[0] = E
                                ;M[1] = (M[1] & 0xF0) | (D & 0x0F)
00199E E6FA 23               6      INC HL
00199F E6FB ED67            18      RRD     ;M={A[3:0],E[3:0]}
0019A1 E6FD 7A               4      LD  A,D
0019A2 E6FE 1804            12      JR  SNC11
       E700                     SNC1:
                                ;ODD
                                ;HL[0] = (HL[0]&0x0F) | (E<<4)
                                ;HL[1] = DE>>4
0019A4 E700 ED6F            18      RLD     ;M={D[3:0],E[7:4]}
0019A6 E702 23               6      INC HL
0019A7 E703 72               7      LD  (HL),D  ;M={D[3:0],E[7:4]}
       E704                     SNC11:
0019A8 E704 ED6F            18      RLD     ;M={M[7:4],D[3:0]}
0019AA E706 B7               4      OR  A
0019AB E707 D1              10      POP DE
0019AC E708 C1              10      POP BC
0019AD E709 E1              10      POP HL
       E70A                     FAT_CHANGED:
0019AE E70A 3E01             7      LD  A,1
0019B0 E70C 32A2EF          13      LD  (_WTFATF),A
0019B3 E70F C9              10      RET
                                
       E710                     N16CL3:
0019B4 E710 C5              11      PUSH    BC
0019B5 E711 6B               4      LD  L,E
0019B6 E712 7A               4      LD  A,D
0019B7 E713 E603             7      AND 3
0019B9 E715 67               4      LD  H,A
0019BA E716 29              11      ADD HL,HL
0019BB E717 ED4B7CF0        20      LD  BC,(_FATBF)
0019BF E71B 09              11      ADD HL,BC
0019C0 E71C C1              10      POP BC
0019C1 E71D C9              10      RET
                                
       E71E                     GNCL16:
0019C2 E71E CD6EE6          17      CALL    NCL1        ;GET NEXT CLUSTER for FAT16
0019C5 E721 D8              11      RET C
0019C6 E722 E5              11      PUSH    HL
0019C7 E723 CD10E7          17      CALL    N16CL3
0019CA E726 5E               7      LD  E,(HL)
0019CB E727 23               6      INC HL
0019CC E728 56               7      LD  D,(HL)
0019CD E729 E1              10      POP HL
0019CE E72A C9              10      RET
                                
       E72B                     SNCL16:
0019CF E72B CD6EE6          17      CALL    NCL1        ;GET NEXT CLUSTER for FAT16
0019D2 E72E D8              11      RET C
0019D3 E72F D5              11      PUSH    DE
0019D4 E730 E5              11      PUSH    HL
0019D5 E731 CD10E7          17      CALL    N16CL3
0019D8 E734 D1              10      POP DE      ;HL
0019D9 E735 73               7      LD  (HL),E
0019DA E736 23               6      INC HL
0019DB E737 72               7      LD  (HL),D
0019DC E738 6B               4      LD  L,E
0019DD E739 62               4      LD  H,D
0019DE E73A D1              10      POP DE
0019DF E73B 18CD            12      JR  FAT_CHANGED
                                
                                ;------------------------
                                ;次のセクタを探す際に_SECPSの値をチェック
                                ;in
                                ;   DE : セクタ番号
                                ;out
                                ;   DE : 次のセクタ番号
                                ;note
                                ;
                                ;------------------------
       E73D                     NEXTX:
0019E1 E73D 3E00             7  _SECPS: LD  A,0 ;自己書き換え
0019E3 E73F 3C               4      INC A
0019E4 E740 E600             7  NCPAT:  AND 0   ;自己書き換え　1クラスタの論理セクタ数-1
0019E6 E742 323EE7          13      LD  (_SECPS+1),A
0019E9 E745 C9              10      RET
                                
       E746                     GNCLX:
0019EA E746 CD3DE7          17      CALL    NEXTX
0019ED E749 C0              11      RET NZ  ;1クラスタのセクタ未満の場合は戻る
0019EE E74A C3F7EF          10      JP  _GNCL   ;次のクラスタを探す
                                
       E74D                     RDFAT:
0019F1 E74D 3E80             7      LD  A,080H
0019F3 E74F 3270EF          13      LD  (CHECK),A
       E752                     RDFAT1:
0019F6 E752 3A88EF          13      LD  A,(_DRV)
0019F9 E755 CDE5E9          17      CALL    CHGDRVR
0019FC E758 D8              11      RET C
0019FD E759 DD7E12          19      LD  A,(IX+012H) ;DPB_12_DEVICE
001A00 E75C CB6F             8      BIT 5,A
001A02 E75E 2843            12      JR  Z,RDFAT0X
001A04 E760 2170EF          10      LD  HL,CHECK
001A07 E763 A6               7      AND (HL)
001A08 E764 77               7      LD  (HL),A
001A09 E765 110000          10      LD  DE,0        ;BPB
001A0C E768 2A7CF0          16      LD  HL,(_FATBF)
001A0F E76B CD9CE8          17      CALL    DRD16
001A12 E76E 3024            12      JR  NC,GETBPB
001A14 E770 2170EF          10      LD  HL,CHECK
001A17 E773 CB06            15      RLC (HL)
001A19 E775 3F               4      CCF
001A1A E776 D8              11      RET C
001A1B E777 DDCB0A1E        23      RR  (IX+00AH)   ;DPB_0A_FDMODE
001A1F E77B 3F               4      CCF         ;フロッピーディスクのMFMモードを切り替える
001A20 E77C DDCB0A16        23      RL  (IX+00AH)   ;DPB_0A_FDMODE
001A24 E780 3EFF             7      LD  A,0FFH
001A26 E782 3289EF          13      LD  (_DSK),A
001A29 E785 3A84EF          13      LD  A,(_DRIVE)
001A2C E788 E603             7      AND 3
001A2E E78A F680             7      OR  080H
001A30 E78C 6F               4      LD  L,A
001A31 E78D 26EF             7      LD  H,_CYL0/256
001A33 E78F 3EFF             7      LD  A,0FFH
001A35 E791 77               7      LD  (HL),A
001A36 E792 18BE            12      JR  RDFAT1
       E794                     GETBPB:
001A38 E794 FDE5            15      PUSH    IY
001A3A E796 FD2A7CF0        20      LD  IY,(_FATBF) ;BPB
001A3E E79A CDF1EF          17      CALL    _BPB2DPB
001A41 E79D FDE1            14      POP IY
001A43 E79F D8              11      RET C
001A44 E7A0 CD44E9          17      CALL    CHGDRV2
       E7A3                     RDFAT0X:
001A47 E7A3 CD90E8          17      CALL    RDFATS
001A4A E7A6 D8              11      RET C
001A4B E7A7 DDBE06           7      CP  (IX+6)      ;DPB_06_FATID
001A4E E7AA C8              11      RET Z
001A4F E7AB DDCB126E        20      BIT 5,(IX+012H) ;DPB_12_DEVICE
001A53 E7AF C0              11      RET NZ      ;BPBを取得している場合はFATIDをチェックしない
001A54 E7B0 37               4      SCF
001A55 E7B1 C9              10      RET
                                
       E7B2                     BPB2DPB:
001A56 E7B2 FD7E0B          19      LD  A,(IY+11)   ;BPB_BytsPerSec
001A59 E7B5 B7               4      OR  A
001A5A E7B6 37               4      SCF
001A5B E7B7 C0              11      RET NZ
       E7B8                     BPBOK:
001A5C E7B8 FD7E0D          19      LD  A,(IY+13)   ;BPB_SecPerClus
001A5F E7BB DD7707          19      LD  (IX+7),A    ;DPB_07_SECPCL
                                
001A62 E7BE FD7E16          19      LD  A,(IY+22)   ;BPB_FATSz16
001A65 E7C1 DD7700          19      LD  (IX+0),A    ;DPB_00_FATLN
001A68 E7C4 FD7E17          19      LD  A,(IY+23)   ;BPB_FATSz16
001A6B E7C7 DD7701          19      LD  (IX+1),A    ;DPB_00_FATLN
                                
001A6E E7CA FD6E0E          19      LD  L,(IY+14)   ;BPB_RsvdSecCnt
001A71 E7CD FD660F          19      LD  H,(IY+15)
001A74 E7D0 DD750E          19      LD  (IX+00EH),L ;DPB_0E_FATPS
001A77 E7D3 FD5E16          19      LD  E,(IY+22)   ;BPB_FATSz16
001A7A E7D6 FD5617          19      LD  D,(IY+23)
001A7D E7D9 FD4610          19      LD  B,(IY+16)   ;BPB_NumFATs
       E7DC                     BPBDP1:             ;BPB_FATSz16 * BPB_NumFATs
001A80 E7DC 19              11      ADD HL,DE
001A81 E7DD 10FD            13      DJNZ    BPBDP1
       E7DF                     BPBDP2:
001A83 E7DF DD7510          19      LD  (IX+010H),L ;DPB_10_DIRPS
001A86 E7E2 DD7411          19      LD  (IX+011H),H
001A89 E7E5 E5              11      PUSH    HL
                                
001A8A E7E6 FD6E11          19      LD  L,(IY+17)   ;BPB_RootEntCnt
001A8D E7E9 FD6612          19      LD  H,(IY+18)
001A90 E7EC FD7E0C          19      LD  A,(IY+12)   ;BPB_BytsPerSec
001A93 E7EF B7               4      OR  A
001A94 E7F0 37               4      SCF
001A95 E7F1 C8              11      RET Z
001A96 E7F2 0606             7      LD  B,6
       E7F4                     BPBBPS1:
001A98 E7F4 05               4      DEC B
001A99 E7F5 0F               4      RRCA
001A9A E7F6 30FC            12      JR  NC,BPBBPS1
       E7F8                     BPBDE1:
001A9C E7F8 29              11      ADD HL,HL
001A9D E7F9 10FD            13      DJNZ    BPBDE1
                                
001A9F E7FB 7C               4      LD  A,H
001AA0 E7FC DD770B          19      LD  (IX+00BH),A ;DPB_0B_DIRSCNT
                                
001AA3 E7FF D1              10      POP DE      ;DPB_10_DIRPS
001AA4 E800 6C               4      LD  L,H
001AA5 E801 2600             7      LD  H,0
001AA7 E803 19              11      ADD HL,DE       ;MAXDIR
001AA8 E804 E5              11      PUSH    HL
001AA9 E805 FD4E0D          19      LD  C,(IY+13)   ;BPB_SecPerClus
001AAC E808 CB21             8      SLA C       ;*2
001AAE E80A AF               4      XOR A
001AAF E80B 47               4      LD  B,A
001AB0 E80C ED42            15      SBC HL,BC
001AB2 E80E DD7514          19      LD  (IX+014H),L ;DPB_14_ADDCL16
001AB5 E811 DD7415          19      LD  (IX+015H),H
                                
001AB8 E814 D1              10      POP DE      ;DE=DPB_0B_MAXDIR
001AB9 E815 FD6E13          19      LD  L,(IY+19)   ;BPB_TotSec16
001ABC E818 FD6614          19      LD  H,(IY+20)
                                
001ABF E81B DD7E12          19      LD  A,(IX+012H) ;DPB_12_DEVICE
001AC2 E81E E60F             7      AND 00FH
001AC4 E820 FE07             7      CP  7       ;フロッピー
001AC6 E822 2019            12      JR  NZ,NOT_FD
001AC8 E824 E5              11      PUSH    HL
001AC9 E825 FD4E18          19      LD  C,(IY+24)   ;BPB_SecPerTr
001ACC E828 DD710D          19      LD  (IX+00DH),C ;DPB_0D_MAXSEC
001ACF E82B AF               4      XOR A
001AD0 E82C CB21             8      SLA C       ;両面なのでセクタ数を２倍
001AD2 E82E 0610             7      LD  B,16
       E830                     DIVSEC:             ;MAXCYL = BPB_TotSec16 / (BPB_SecPerTr * 2)
001AD4 E830 29              11      ADD HL,HL
001AD5 E831 17               4      RLA
001AD6 E832 B9               4      CP  C
001AD7 E833 3802            12      JR  C,DIVSEC1
001AD9 E835 91               4      SUB C
001ADA E836 2C               4      INC L
       E837                     DIVSEC1:
001ADB E837 10F7            13      DJNZ    DIVSEC
001ADD E839 DD750C          19      LD  (IX+00CH),L ;DPB_0C_MAXCYL
001AE0 E83C E1              10      POP HL  ;ここまでフロッピー専用
       E83D                     NOT_FD:
001AE1 E83D 7C               4      LD  A,H
001AE2 E83E B5               4      OR  L
001AE3 E83F 3E00             7      LD  A,0     ;LDでフラグは変化しない。BPB_TotSec16を AHL で扱う為、Aに0を入れる
001AE5 E841 2010            12      JR  NZ,BPB16BIT ;BPB_TotSec16が「0」の場合はBPB_TotSec32で計算
001AE7 E843 FD7E23          19      LD  A,(IY+35)   ;念のために総セクタ数が24ビットを超える場合はエラーを返す
001AEA E846 B7               4      OR  A
001AEB E847 37               4      SCF
001AEC E848 C0              11      RET NZ
001AED E849 FD6E20          19      LD  L,(IY+32)   ;BPB_TotSec32 は AHL の24ビットで扱う
001AF0 E84C FD6621          19      LD  H,(IY+33)   ;1クラスタの論理セクタ数(DPB_07_SECPCL)が最大128なので
001AF3 E84F FD7E22          19      LD  A,(IY+34)   ;24ビットを超えると必ずクラスタ数が16ビットを超えてしまうのでこれで十分
001AF6 E852 A7               4      AND A       ;CF=0
       E853                     BPB16BIT:
001AF7 E853 ED52            15      SBC HL,DE
001AF9 E855 DE00             7      SBC A,0
001AFB E857 FD460D          19      LD  B,(IY+13)   ;BPB_SecPerClus
       E85A                     BPBTC1:             ;総クラスタ数(AHL) = 総セクタ数(AHL) / セクタサイズ(B)
001AFE E85A CB18             8      RR  B       ;->CY
001B00 E85C 3808            12      JR  C,BPBTC2
001B02 E85E CB3F             8      SRL A
001B04 E860 CB1C             8      RR  H       ;AHL=AHL/2
001B06 E862 CB1D             8      RR  L
001B08 E864 18F4            12      JR  BPBTC1
       E866                     BPBTC2:
001B0A E866 B7               4      OR  A
001B0B E867 37               4      SCF
001B0C E868 C0              11      RET NZ      ;念のため(クラスタ数が16ビットを超える場合)
001B0D E869 23               6      INC HL
001B0E E86A 23               6      INC HL
001B0F E86B DD7508          19      LD  (IX+8),L    ;DPB_08_MAXCL
001B12 E86E DD7409          19      LD  (IX+9),H
                                
001B15 E871 FD7E15          19      LD  A,(IY+21)   ;BPB_Media
001B18 E874 DD7706          19      LD  (IX+6),A    ;DPB_06_FATID
                                
001B1B E877 FD7E10          19      LD  A,(IY+16)   ;BPB_NumFATs
001B1E E87A C6FE             7      ADD A,0-2       ;>2:CF=1
001B20 E87C FD7E0C          19      LD  A,(IY+12)   ;BPB_BytsPerSec
001B23 E87F 6F               4      LD  L,A
001B24 E880 3002            12      JR  NC,BPBFAT1
001B26 E882 F680             7      OR  080H
       E884                     BPBFAT1:
001B28 E884 DD770F          19      LD  (IX+00FH),A ;DPB_0F_BPS
001B2B E887 2D               4      DEC L       ;以下のセクタサイズに合致しない場合はCF=1でエラーにする
001B2C E888 C8              11      RET Z       ;1セクタ256バイト
001B2D E889 2D               4      DEC L
001B2E E88A C8              11      RET Z       ;1セクタ512バイト
001B2F E88B 2D               4      DEC L
001B30 E88C 2D               4      DEC L
001B31 E88D C8              11      RET Z       ;1セクタ1024バイト
001B32 E88E 37               4      SCF
001B33 E88F C9              10      RET
                                
       E890                     RDFATS:
001B34 E890 CDD6E8          17      CALL    FATSETUP
001B37 E893 D8              11      RET C
001B38 E894 CDA0E8          17      CALL    DRD24B
001B3B E897 2A7CF0          16      LD  HL,(_FATBF)
001B3E E89A 7E               7      LD  A,(HL)
001B3F E89B C9              10      RET
                                
       E89C                     DRD16:
001B40 E89C 0E00             7      LD  C,0
       E89E                     DRD24:
001B42 E89E 0601             7      LD  B,1
       E8A0                     DRD24B:
001B44 E8A0 DDE5            15      PUSH    IX
001B46 E8A2 DD2AA8EF        20      LD  IX,(_DPB)
001B4A E8A6 CD2DEB          17  DRDPAT: CALL    FDRD        ;自己書き換え（ディスク読み込み）
       E8A9                     POP_IX_RET:
001B4D E8A9 DDE1            14      POP IX
001B4F E8AB C9              10      RET
                                
       E8AC                     DWT16:
001B50 E8AC 0E00             7      LD  C,0
       E8AE                     DWT24:
001B52 E8AE 0601             7      LD  B,1
       E8B0                     DWT24B:
001B54 E8B0 DDE5            15      PUSH    IX
001B56 E8B2 DD2AA8EF        20      LD  IX,(_DPB)
001B5A E8B6 CDD3EA          17  DWTPAT: CALL    FDWT        ;自己書き換え（ディスク書き込み）
001B5D E8B9 18EE            12      JR  POP_IX_RET
                                
       E8BB                     WTFAT:
001B5F E8BB CDD6E8          17      CALL    FATSETUP
001B62 E8BE D4B0E8          17      CALL    NC,DWT24B
001B65 E8C1 D8              11      RET C
001B66 E8C2 DDCB0F7E        20      BIT 7,(IX+00FH) ;DPB_0F_BPS
001B6A E8C6 C8              11      RET Z       ;予備FATが無い
001B6B E8C7 CDDDE8          17      CALL    FATS2
001B6E E8CA E5              11      PUSH    HL      ;予備FAT
001B6F E8CB DD6E00          19      LD  L,(IX+0)    ;DPB_00_FATLN
001B72 E8CE DD6601          19      LD  H,(IX+1)
001B75 E8D1 19              11      ADD HL,DE
001B76 E8D2 EB               4      EX  DE,HL
001B77 E8D3 E1              10      POP HL
001B78 E8D4 18DA            12      JR  DWT24B
                                ;------------------------
                                ;FATのセットアップ
                                ;out
                                ;   B  : FATセクタ数
                                ;   DE : FAT先頭セクタ番号
                                ;   HL : FATバッファポインタ
                                ;   CF : 1=ドライブ切り替えエラー
                                ;note
                                ;   FATサイズがFATバッファを超える場合は
                                ;   対象クラスタ領域==(_FATIX)によって
                                ;   FAT12:対象クラスタ1024毎に1.5KBを切り替える
                                ;   FAT16:対象クラスタ1024毎に2KBを切り替える
                                ;------------------------
       E8D6                     FATSETUP:
001B7A E8D6 3AAAEF          13      LD  A,(_FATDRV)
001B7D E8D9 CDE5E9          17      CALL    CHGDRVR     ;ドライブ切り替え
001B80 E8DC D8              11      RET C
       E8DD                     FATS2:
001B81 E8DD DD7E0F          19      LD  A,(IX+00FH) ;DPB_0F_BPS 512=2 1024=4
001B84 E8E0 0F               4      RRCA
001B85 E8E1 CD0AE9          17  FATSX:  CALL    FATSETUP12  ;自己書き換え
001B88 E8E4 210000          10      LD  HL,0
001B8B E8E7 4A               4      LD  C,D
001B8C E8E8 54               4      LD  D,H
001B8D E8E9 3AABEF          13      LD  A,(_FATIX)  ;範囲FAT12:0-3/FAT16:0-63(0-03FH):65535*2/2048
001B90 E8EC 47               4      LD  B,A
001B91 E8ED 04               4      INC B
001B92 E8EE DD7E00          19      LD  A,(IX+0)    ;DPB_00_FATLN
       E8F1                     FAT_SKP:
001B95 E8F1 05               4      DEC B
001B96 E8F2 2805            12      JR  Z,FAT1
001B98 E8F4 19              11      ADD HL,DE
001B99 E8F5 93               4      SUB E
001B9A E8F6 30F9            12      JR  NC,FAT_SKP
001B9C E8F8 C9              10      RET
       E8F9                     FAT1:
001B9D E8F9 EB               4      EX  DE,HL
001B9E E8FA B9               4      CP  C       ;C=FATバッファに読み込めるセクタ数
001B9F E8FB 3801            12      JR  C,FAT2
001BA1 E8FD 79               4      LD  A,C
       E8FE                     FAT2:
001BA2 E8FE 47               4      LD  B,A
                                
001BA3 E8FF 2AFAF0          16      LD  HL,(_FATPS) ;fat sector pos
001BA6 E902 19              11      ADD HL,DE
001BA7 E903 EB               4      EX  DE,HL
001BA8 E904 2A7CF0          16      LD  HL,(_FATBF)
001BAB E907 AF               4      XOR A       ;CF=0
001BAC E908 4F               4      LD  C,A
001BAD E909 C9              10      RET
                                ;
                                ;   FATバッファに読み込める最大のセクタ数と_FATIXで進めるセクタ数
                                ;   FATSETUP* (FAT12/FAT16)
                                ;out
                                ;   D : FATバッファに読み込める最大のセクタ数
                                ;   E : _FATIXで進めるセクタ数
       E90A                     FATSETUP12:
001BAE E90A 110606          10      LD  DE,0606H    ;256
001BB1 E90D D8              11      RET C
001BB2 E90E 110303          10      LD  DE,0303H    ;512
001BB5 E911 0F               4      RRCA
001BB6 E912 D8              11      RET C
001BB7 E913 110102          10      LD  DE,0201H    ;1024
001BBA E916 C9              10      RET
                                
       E917                     FATSETUP16:
001BBB E917 110808          10      LD  DE,0808H    ;256
001BBE E91A D8              11      RET C
001BBF E91B 110404          10      LD  DE,0404H
001BC2 E91E 0F               4      RRCA            ;512
001BC3 E91F D8              11      RET C
001BC4 E920 110202          10      LD  DE,0202H    ;1024
001BC7 E923 C9              10      RET
                                
       E924                     CHGDRV:
001BC8 E924 E5              11      PUSH    HL
001BC9 E925 2189EF          10      LD  HL,_DSK
001BCC E928 BE               7      CP  (HL)
001BCD E929 280A            12      JR  Z,CHGDRVE
       E92B                     CHGDRV1:
001BCF E92B DDE5            15      PUSH    IX
001BD1 E92D CD37E9          17      CALL    CHGDRV0
001BD4 E930 3A89EF          13      LD  A,(_DSK)
001BD7 E933 DDE1            14      POP IX
       E935                     CHGDRVE:
001BD9 E935 E1              10      POP HL
001BDA E936 C9              10      RET
                                
       E937                     CHGDRV0:
001BDB E937 6F               4      LD  L,A
001BDC E938 CDDCEF          17      CALL    _GETDPB
001BDF E93B D8              11      RET C
001BE0 E93C DD22A8EF        20      LD  (_DPB),IX
001BE4 E940 7D               4      LD  A,L
001BE5 E941 3289EF          13      LD  (_DSK),A
       E944                     CHGDRV2:
001BE8 E944 C5              11      PUSH    BC
001BE9 E945 D5              11      PUSH    DE
001BEA E946 ED739BE9        20      LD  (SPPAT2+1),SP
001BEE E94A F3               4      DI
001BEF E94B DDF9            10      LD  SP,IX
                                
001BF1 E94D E1              10      POP HL      ;DPB_00_FATLN
001BF2 E94E E1              10      POP HL      ;DPB_02_DRD
001BF3 E94F 22A7E8          16      LD  (DRDPAT+1),HL
                                
001BF6 E952 E1              10      POP HL
001BF7 E953 22B7E8          16      LD  (DWTPAT+1),HL   ;DPB_04_DWT
                                
001BFA E956 E1              10      POP HL      ;L=DPB_06_FATID H=DPB_07_SECPCL
001BFB E957 7C               4      LD  A,H
001BFC E958 32B1DF          13      LD  (SPCPAT+1),A    ;1クラスタの論理セクタ数
001BFF E95B 3D               4      DEC A
001C00 E95C 3241E7          13      LD  (NCPAT+1),A
                                
001C03 E95F E1              10      POP HL      ;DPB_08_MAXCL
001C04 E960 7D               4      LD  A,L
001C05 E961 32D0DF          13      LD  (CLPAT2+1),A
001C08 E964 7C               4      LD  A,H
001C09 E965 32CCDF          13      LD  (CLPAT1+1),A
001C0C E968 2B               6      DEC HL
001C0D E969 22D4E1          16      LD  (MAXCLP+1),HL
                                
001C10 E96C E1              10      POP HL      ;L=DPB_0A_FDMODE H=DPB_0B_DIRSCNT
001C11 E96D 7D               4      LD  A,L
001C12 E96E F6FE             7      OR  0FEH
001C14 E970 32B3EF          13      LD  (FDMODE+1),A
001C17 E973 07               4      RLCA
001C18 E974 E603             7      AND 3
001C1A E976 3272EA          13      LD  (FSPAT+1),A
001C1D E979 4C               4      LD  C,H
                                
001C1E E97A E1              10      POP HL      ;L=DPB_0C_MAXCYL H=DPB_0D_MAXSEC
                                
001C1F E97B E1              10      POP HL      ;L=DPB_0E_FATPS H=DPB_0F_BPS
001C20 E97C 7C               4      LD  A,H     ;DPB_0F_BPS
001C21 E97D E607             7      AND 7
001C23 E97F 32CFE4          13      LD  (SECSZ+2),A ;1セクタのサイズの上位1バイト 0x400 - 0x200 - 0x100
                                                ;1セクタ512 2D/2DD/2HC/2HQ(2HD1.44MB)/EMM/BRAM/EMEM等
                                                ;1セクタ1024 2HD/2HDE98
                                                ;1セクタ256 GRAM/RAMF/CMOS/等
                                                ;1024   512 256
                                                ;4  2   1
001C26 E982 87               4      ADD A,A     ;8  4   2
001C27 E983 87               4      ADD A,A     ;010H   8   4
001C28 E984 87               4      ADD A,A     ;020H   010H    8
001C29 E985 322DDE          13      LD  (SDECPAT+1),A   ;1セクタ辺りのディレクトリエントリ数
                                
001C2C E988 2600             7      LD  H,0
001C2E E98A 22FAF0          16      LD  (_FATPS),HL
                                
001C31 E98D E1              10      POP HL      ;DPB_10_DIRPS
001C32 E98E 22FCF0          16      LD  (_DIRPS),HL
                                
001C35 E991 E1              10      POP HL      ;L=DPB_12_DEVICE H=DPB_13_UNITNO
001C36 E992 7C               4      LD  A,H
001C37 E993 3284EF          13      LD  (_DRIVE),A
                                
001C3A E996 E1              10      POP HL      ;DPB_14_ADDCL16
001C3B E997 22C1DF          16      LD  (CLSPAT+1),HL
                                
001C3E E99A 310000          10  SPPAT2: LD  SP,0        ;元のSPを復元
001C41 E99D FB               4      EI
001C42 E99E 2AFCF0          16      LD  HL,(_DIRPS)
001C45 E9A1 0600             7      LD  B,0
001C47 E9A3 09              11      ADD HL,BC       ;C=DPB_0B_DIRSCNT
001C48 E9A4 2248DE          16      LD  (MD_PAT+1),HL
                                
001C4B E9A7 2AD4E1          16      LD  HL,(MAXCLP+1);
001C4E E9AA 11F60F          10      LD  DE,4086     ;クラスタ数が4086未満:FAT12 4086以上:FAT16
001C51 E9AD ED52            15      SBC HL,DE       ;CF=0のはず
001C53 E9AF 300F            12      JR  NC,SETFAT16
001C55 E9B1 21C7E6          10      LD  HL,GNCL     ;FAT12
001C58 E9B4 11EAE6          10      LD  DE,SNCL
001C5B E9B7 010AE9          10      LD  BC,FATSETUP12
001C5E E9BA DDCB0FAE        23      RES 5,(IX+00FH) ;DPB_0F_BPS(FAT12)
001C62 E9BE 180D            12      JR  EXTRA1
       E9C0                     SETFAT16:
001C64 E9C0 211EE7          10      LD  HL,GNCL16   ;FAT16
001C67 E9C3 112BE7          10      LD  DE,SNCL16
001C6A E9C6 0117E9          10      LD  BC,FATSETUP16
001C6D E9C9 DDCB0FEE        23      SET 5,(IX+00FH) ;DPB_0F_BPS(FAT16)
       E9CD                     EXTRA1:
001C71 E9CD 22F8EF          16      LD  (GNCPAT+1),HL
001C74 E9D0 ED53FBEF        20      LD  (SNCPAT+1),DE
001C78 E9D4 ED43E2E8        20      LD  (FATSX+1),BC
001C7C E9D8 D1              10      POP DE
001C7D E9D9 C1              10      POP BC
001C7E E9DA AF               4      XOR A
001C7F E9DB C9              10      RET
                                
       E9DC                     GETDPBD:
001C80 E9DC DDE3            23      EX  (SP),IX
001C82 E9DE DDE5            15      PUSH    IX
001C84 E9E0 3A88EF          13      LD  A,(_DRV)
001C87 E9E3 1807            12      JR  GETDPB1
                                
       E9E5                     CHGDRVR:
001C89 E9E5 CDD9EF          17      CALL    _CHGDRV
001C8C E9E8 D8              11      RET C
001C8D E9E9 3A89EF          13      LD  A,(_DSK)
       E9EC                     GETDPB1:
001C90 E9EC C3DCEF          10      JP  _GETDPB
                                
       E9EF                     GETDPB:
001C93 E9EF FE08             7      CP  8
001C95 E9F1 3F               4      CCF
001C96 E9F2 D8              11      RET C
001C97 E9F3 0F               4      RRCA
001C98 E9F4 0F               4      RRCA
001C99 E9F5 0F               4      RRCA
001C9A E9F6 DD                      DB  0DDH        ;Z80未定義命令
001C9B E9F7 6F               4      LD  L,A     ;LD IXL,A
001C9C E9F8 DD                      DB  0DDH        ;Z80未定義命令
001C9D E9F9 26F1             7      LD  H,DEVICE/256    ;LD IXH,DEVICE/256
001C9F E9FB DD7E00          19      LD  A,(IX+0)    ;DPB_00_FATLN
001CA2 E9FE A7               4      AND A       ;CF=0の為
001CA3 E9FF DDCB0F6E        20      BIT 5,(IX+00FH) ;DPB_0F_BPS
001CA7 EA03 C0              11      RET NZ      ;FAT16
001CA8 EA04 DDCB126E        20      BIT 5,(IX+012H) ;DPB_12_DEVICE
001CAC EA08 C0              11      RET NZ      ;BPB
001CAD EA09 FE01             7      CP  001H        ;A=0 THEN CF=1
001CAF EA0B C9              10      RET
                                
       EA0C                     _SYS5F:
001CB0 EA0C AF               4      XOR A
       EA0D                     FFLUSH:
001CB1 EA0D F5              11      PUSH    AF
001CB2 EA0E 3EFF             7      LD  A,0FFH
001CB4 EA10 3239EF          13      LD  (SFILE),A
001CB7 EA13 CD05E6          17      CALL    DWTX
001CBA EA16 3EFF             7      LD  A,0FFH
001CBC EA18 32A5EF          13      LD  (_DBDRV),A
001CBF EA1B CD4FE6          17      CALL    WTFATX
001CC2 EA1E AF               4      XOR A
001CC3 EA1F 32ABEF          13      LD  (_FATIX),A
001CC6 EA22 2F               4      CPL         ;0FFH
001CC7 EA23 32AAEF          13      LD  (_FATDRV),A
001CCA EA26 F1              10      POP AF
001CCB EA27 C9              10      RET
                                
[EOF:LDDIO.ASM:SHIFT_JIS]
                                    INCLUDE "M7DISK.ASM"
                                
                                ;   LSX-Dodgers DISK
                                ;   MZ-700/1500
                                
       EA28                     SEEK:
001CCC EA28 0610             7      LD  B,16
001CCE EA2A DD4E0D          19  MAXSEC: LD  C,(IX+0DH)  ;DPB_0D_MAXSEC
001CD1 EA2D AF               4      XOR A
001CD2 EA2E EB               4      EX  DE,HL
       EA2F                     DIV1:
001CD3 EA2F 29              11      ADD HL,HL
001CD4 EA30 8F               4      ADC A,A
001CD5 EA31 B9               4      CP  C
001CD6 EA32 3802            12      JR  C,DIV2
001CD8 EA34 91               4      SUB C
001CD9 EA35 2C               4      INC L
       EA36                     DIV2:
001CDA EA36 10F7            13      DJNZ    DIV1
                                
001CDC EA38 3C               4      INC A   ;最小のセクタは１固定
001CDD EA39 55               4      LD  D,L ;TRACK
001CDE EA3A 5F               4      LD  E,A ;SECTOR
                                
001CDF EA3B 3A84EF          13      LD  A,(_DRIVE)
001CE2 EA3E FE04             7      CP  4
001CE4 EA40 3F               4      CCF
001CE5 EA41 D8              11      RET C
001CE6 EA42 F684             7      OR  084H        ;Motor on + ドライブセレクト有効
001CE8 EA44 D3DC            11      OUT (0DCH),A
001CEA EA46 CB3A             8      SRL D       ;CYLINDER
001CEC EA48 9F               4      SBC A,A
001CED EA49 D3DD            11      OUT (0DDH),A    ;SIDE
                                
001CEF EA4B CD88EA          17      CALL    SETMODE
001CF2 EA4E D8              11      RET C
                                
001CF3 EA4F CDBDEA          17      CALL    DRIVE
001CF6 EA52 FEFF             7      CP  0FFH        ;A=0FFH Unknown CYLINDER
001CF8 EA54 CCA4EA          17      CALL    Z,FDCRES    ;Restore
001CFB EA57 2F               4      CPL         ;データバスが負論理
001CFC EA58 D3D9            11      OUT (0D9H),A    ;Currrent CYLINDER
001CFE EA5A 2F               4      CPL         ;データバスが負論理
001CFF EA5B 92               4      SUB D
001D00 EA5C C8              11      RET Z       ;No seek
                                
001D01 EA5D 3A86EF          13      LD  A,(_ISEEK)
001D04 EA60 4F               4      LD  C,A
                                
001D05 EA61 DD7E0C          19      LD  A,(IX+00CH) ;DPB_0C_MAXCYL
001D08 EA64 3D               4      DEC A
001D09 EA65 BA               4      CP  D       ;Over CYLINDER
001D0A EA66 D8              11      RET C
                                
001D0B EA67 7A               4      LD  A,D
001D0C EA68 2F               4      CPL         ;データバスが負論理
001D0D EA69 D3DB            11      OUT (0DBH),A
001D0F EA6B 72               7      LD  (HL),D
                                
001D10 EA6C 0E18             7      LD  C,018H      ;Seek
       EA6E                     FDCCMD2:
001D12 EA6E 3A85EF          13      LD  A,(_SEEKSP)
001D15 EA71 E6FF             7  FSPAT:  AND 0FFH
001D17 EA73 B1               4      OR  C
                                
       EA74                     FDCCMD:
001D18 EA74 CDB4EA          17      CALL    COMSET
       EA78                     FDCSMC  EQU $+1
001D1B EA77 3E80             7      LD  A,080H      ;FDC COMMAND(Self-modifying code)
001D1D EA79 E620             7      AND 020H        ;Write data Write track
001D1F EA7B 3C               4      INC A
                                
       EA7C                     SST:
001D20 EA7C 0E00             7      LD  C,0
       EA7E                     SST1:
001D22 EA7E 0D               4      DEC C       ; 4
001D23 EA7F 20FD            12      JR  NZ,SST1     ;12 * 256 / 4 = About 1ms
001D25 EA81 3D               4      DEC A
001D26 EA82 20FA            12      JR  NZ,SST1
                                
001D28 EA84 3C               4      INC A       ;A=1
001D29 EA85 CD8DEA          17      CALL    READY
       EA88                     SETMODE:
001D2C EA88 CDB7EA          17      CALL    DELAY0      ;Head select time
001D2F EA8B 3E81             7      LD  A,081H
       EA8D                     READY:
001D31 EA8D 3297EA          13      LD  (WAITA),A
001D34 EA90 E5              11      PUSH    HL
001D35 EA91 26F8             7      LD  H,0F8H
       EA93                     READY2:
001D37 EA93 DBD8            11      IN  A,(0D8H)
001D39 EA95 2F               4      CPL         ;データバスが負論理
       EA97                     WAITA   EQU $+1
001D3A EA96 E681             7      AND 081H        ;NOT READY,BUSY
001D3C EA98 2808            12      JR  Z,READYE
001D3E EA9A E3              19      EX  (SP),HL     ;wait 19clock
001D3F EA9B E3              19      EX  (SP),HL     ; //
001D40 EA9C 2B               6      DEC HL
001D41 EA9D 7C               4      LD  A,H
001D42 EA9E B5               4      OR  L
001D43 EA9F 20F2            12      JR  NZ,READY2
001D45 EAA1 37               4      SCF
       EAA2                     READYE:
001D46 EAA2 E1              10      POP HL
001D47 EAA3 C9              10      RET
                                
       EAA4                     FDCRES:
001D48 EAA4 3600            10      LD  (HL),0
001D4A EAA6 0E08             7      LD  C,8
001D4C EAA8 18C4            12      JR  FDCCMD2
                                
       EAAA                     FDMOFF:
001D4E EAAA AF               4      XOR A       ;Motor off(ドライブセレクト無効)
001D4F EAAB D3DC            11      OUT (0DCH),A
001D51 EAAD C9              10      RET
                                
       EAAE                     SECSET:
001D52 EAAE F5              11      PUSH    AF
001D53 EAAF 7B               4      LD  A,E
001D54 EAB0 2F               4      CPL         ;データバスが負論理
001D55 EAB1 D3DA            11      OUT (0DAH),A
001D57 EAB3 F1              10      POP AF
       EAB4                     COMSET:
001D58 EAB4 2F               4      CPL         ;データバスが負論理
001D59 EAB5 D3D8            11      OUT (0D8H),A
       EAB7                     DELAY0:
001D5B EAB7 3E1A             7      LD  A,26
       EAB9                     DELAY:
001D5D EAB9 3D               4      DEC A
001D5E EABA 20FD            12      JR  NZ,DELAY
001D60 EABC C9              10      RET
                                
       EABD                     DRIVE:
001D61 EABD 2A84EF          16      LD  HL,(_DRIVE)
001D64 EAC0 26EF             7      LD  H,_CYL0/256
001D66 EAC2 CBFD             8      SET 7,L
001D68 EAC4 7E               7      LD  A,(HL)
001D69 EAC5 C9              10      RET
                                
       EAC6                     RNF:
001D6A EAC6 CDBDEA          17      CALL    DRIVE
001D6D EAC9 36FF            10      LD  (HL),0FFH
001D6F EACB C9              10      RET
                                
001D70 EACC 02                  RETRY:  DB  2
                                
                                
                                ;   FLOPPY DISK DRIVER
                                
       EACD                     WTTRK:
001D71 EACD 0601             7      LD  B,1
001D73 EACF 3EF4             7      LD  A,0F4H
001D75 EAD1 1802            12      JR  WTTRK1
       EAD3                     FDWT:
001D77 EAD3 3EA0             7      LD  A,0A0H
       EAD5                     WTTRK1:
001D79 EAD5 3278EA          13      LD  (FDCSMC),A
       EAD8                     DWTBL:
001D7C EAD8 78               4      LD  A,B
001D7D EAD9 3218EB          13      LD  (WTBSMC),A
001D80 EADC 3E02             7      LD  A,2     ;Retry count
001D82 EADE 32CCEA          13      LD  (RETRY),A
                                
       EAE1                     DWT0:
001D85 EAE1 D5              11      PUSH    DE
001D86 EAE2 E5              11      PUSH    HL
001D87 EAE3 CD28EA          17      CALL    SEEK        ;Write disk
001D8A EAE6 E1              10      POP HL
001D8B EAE7 383A            12      JR  C,ERRDW
001D8D EAE9 F3               4      DI
001D8E EAEA 3A78EA          13      LD  A,(FDCSMC)
001D91 EAED CDAEEA          17      CALL    SECSET
001D94 EAF0 0EDB             7      LD  C,0DBH
       EAF2                     DWT1:
001D96 EAF2 7E               7      LD  A,(HL)
001D97 EAF3 2F               4      CPL         ;データバスが負論理
001D98 EAF4 57               4      LD  D,A
                                
       EAF5                     DWT2:
001D99 EAF5 DBD8            11      IN  A,(0D8H)
001D9B EAF7 2F               4      CPL         ;データバスが負論理
001D9C EAF8 0F               4      RRCA
001D9D EAF9 3008            12      JR  NC,DWT4
001D9F EAFB 0F               4      RRCA
001DA0 EAFC 30F7            12      JR  NC,DWT2
       EAFE                     DWT3:
001DA2 EAFE ED51            12      OUT (C),D
001DA4 EB00 23               6      INC HL
001DA5 EB01 18EF            12      JR  DWT1
                                
       EB03                     DWT4:
001DA7 EB03 3D               4      DEC A
001DA8 EB04 28F8            12      JR  Z,DWT3
001DAA EB06 3C               4      INC A
001DAB EB07 FB               4      EI
001DAC EB08 D1              10      POP DE
001DAD EB09 13               6      INC DE
001DAE EB0A CDAAEA          17      CALL    FDMOFF
001DB1 EB0D 2808            12      JR  Z,DISKOK_WT
001DB3 EB0F CD7AEB          17      CALL    DISKC
001DB6 EB12 20CD            12      JR  NZ,DWT0
001DB8 EB14 B7               4      OR  A
001DB9 EB15 2005            12      JR  NZ,ERRW
                                
       EB17                     DISKOK_WT:
       EB18                     WTBSMC  EQU $+1
001DBB EB17 0601             7      LD  B,1
001DBD EB19 10BD            13      DJNZ    DWTBL
001DBF EB1B C9              10      RET
                                
       EB1C                     ERRW:
001DC0 EB1C 3EFF             7      LD  A,0FFH
       EB1E                     ERRZ:
001DC2 EB1E BF               4      CP  A
001DC3 EB1F 37               4      SCF
001DC4 EB20 C3AAEA          10      JP  FDMOFF
                                
       EB23                     ERRDW:
001DC7 EB23 D1              10      POP DE
001DC8 EB24 CD8BEB          17      CALL    DELP
001DCB EB27 20B8            12      JR  NZ,DWT0
001DCD EB29 B7               4      OR  A
001DCE EB2A 20F0            12      JR  NZ,ERRW
001DD0 EB2C C9              10      RET
                                
       EB2D                     FDRD:
001DD1 EB2D 3E80             7      LD  A,080H
001DD3 EB2F 3278EA          13      LD  (FDCSMC),A
       EB32                     DRDBL:
001DD6 EB32 78               4      LD  A,B
001DD7 EB33 326CEB          13      LD  (RDBSMC),A
001DDA EB36 3E02             7      LD  A,2     ;Retry count
001DDC EB38 32CCEA          13      LD  (RETRY),A
       EB3B                     DRD0:
001DDF EB3B D5              11      PUSH    DE
001DE0 EB3C E5              11      PUSH    HL
001DE1 EB3D CD28EA          17      CALL    SEEK        ;Read disk
001DE4 EB40 E1              10      POP HL
001DE5 EB41 382D            12      JR  C,ERRDR
001DE7 EB43 F3               4      DI
001DE8 EB44 3A78EA          13      LD  A,(FDCSMC)
001DEB EB47 CDAEEA          17      CALL    SECSET
       EB4A                     DRD1:
001DEE EB4A DBD8            11      IN  A,(0D8H)
001DF0 EB4C 2F               4      CPL         ;データバスが負論理
001DF1 EB4D 0F               4      RRCA
001DF2 EB4E 300A            12      JR  NC,DRD3
001DF4 EB50 0F               4      RRCA
001DF5 EB51 30F7            12      JR  NC,DRD1
001DF7 EB53 DBDB            11      IN  A,(0DBH)
001DF9 EB55 2F               4      CPL         ;データバスが負論理
001DFA EB56 77               7      LD  (HL),A
001DFB EB57 23               6      INC HL
001DFC EB58 18F0            12      JR  DRD1
                                
       EB5A                     DRD3:
001DFE EB5A B7               4      OR  A
001DFF EB5B FB               4      EI
001E00 EB5C D1              10      POP DE
001E01 EB5D 13               6      INC DE
001E02 EB5E CDAAEA          17      CALL    FDMOFF
001E05 EB61 2808            12      JR  Z,DISKOK_RD
001E07 EB63 CD7AEB          17      CALL    DISKC
001E0A EB66 20D3            12      JR  NZ,DRD0
001E0C EB68 B7               4      OR  A
001E0D EB69 20B1            12      JR  NZ,ERRW
                                
       EB6B                     DISKOK_RD:
       EB6C                     RDBSMC  EQU $+1
001E0F EB6B 0601             7      LD  B,1
001E11 EB6D 10C3            13      DJNZ    DRDBL
001E13 EB6F C9              10      RET
                                
       EB70                     ERRDR:
001E14 EB70 D1              10      POP DE
001E15 EB71 CD8BEB          17      CALL    DELP
001E18 EB74 20C5            12      JR  NZ,DRD0
001E1A EB76 B7               4      OR  A
001E1B EB77 20A3            12      JR  NZ,ERRW
001E1D EB79 C9              10      RET
       EB7A                     DISKC:
001E1E EB7A 1B               6      DEC DE
001E1F EB7B CB5F             8      BIT 3,A
001E21 EB7D C4C6EA          17      CALL    NZ,RNF
       EB80                     DISKD:
001E24 EB80 E5              11      PUSH    HL
001E25 EB81 21CCEA          10      LD  HL,RETRY
001E28 EB84 35              11      DEC (HL)
001E29 EB85 E1              10      POP HL
001E2A EB86 200C            12      JR  NZ,ERR      ;Retry
001E2C EB88 B7               4      OR  A
001E2D EB89 2809            12      JR  Z,ERR       ;Error
                                
       EB8B                     DELP:
001E2F EB8B CDC6EA          17      CALL    RNF
001E32 EB8E CDAAEA          17      CALL    FDMOFF
001E35 EB91 3EFF             7      LD  A,0FFH
       EB93                     AERRZ:
001E37 EB93 BF               4      CP  A
       EB94                     ERR:
001E38 EB94 3EFF             7      LD  A,0FFH
001E3A EB96 C9              10      RET
                                
       EFB2                     FDMODE  EQU TVRAMTOP
[EOF:M7DISK.ASM:SHIFT_JIS]
                                    INCLUDE "M7DISK2.ASM"
                                
                                ;   LSX-Dodgers DISK2
                                ;   MZ-700/1500
                                
                                ;   EMM DRIVER
                                ;   1セクタ可変(256/512/1024)
                                
       EB97                     EDWT:
001E3B EB97 F5              11      PUSH    AF
001E3C EB98 CDB6EB          17      CALL    EADR
001E3F EB9B 0600             7      LD  B,0
       EB9D                     EDWT1:
001E41 EB9D EDB3                    OTIR
001E43 EB9F 3D               4      DEC A
001E44 EBA0 20FB            12      JR  NZ,EDWT1
001E46 EBA2 180B            12      JR  EDRW1
                                
       EBA4                     EDRD:
001E48 EBA4 C5              11      PUSH    BC
001E49 EBA5 CDB6EB          17      CALL    EADR
001E4C EBA8 0600             7      LD  B,0
       EBAA                     EDRD1:
001E4E EBAA EDB2                    INIR
001E50 EBAC 3D               4      DEC A
001E51 EBAD 20FB            12      JR  NZ,EDRD1
       EBAF                     EDRW1:
001E53 EBAF F1              10      POP AF
001E54 EBB0 83               4      ADD A,E ;セクタを進める
001E55 EBB1 5F               4      LD  E,A
001E56 EBB2 8A               4      ADC A,D
001E57 EBB3 93               4      SUB E
001E58 EBB4 57               4      LD  D,A
001E59 EBB5 C9              10      RET
                                
       EBB6                     EADR:
001E5A EBB6 C5              11      PUSH    BC
001E5B EBB7 D5              11      PUSH    DE
001E5C EBB8 EB               4      EX  DE,HL
001E5D EBB9 29              11      ADD HL,HL
001E5E EBBA DD4E0D          19      LD  C,(IX+00DH) ;DPB_0D_MAXSEC
001E61 EBBD DD460C          19      LD  B,(IX+00CH) ;DPB_0C_MAXCYL
001E64 EBC0 09              11      ADD HL,BC
001E65 EBC1 DD4E13          19      LD  C,(IX+013H) ;DPB_13_UNITNO
001E68 EBC4 ED49            12      OUT (C),C
001E6A EBC6 0C               4      INC C
001E6B EBC7 ED69            12      OUT (C),L
001E6D EBC9 0C               4      INC C
001E6E EBCA ED61            12      OUT (C),H
001E70 EBCC 0C               4      INC C
001E71 EBCD EB               4      EX  DE,HL
001E72 EBCE D1              10      POP DE
001E73 EBCF DD460F          19      LD  B,(IX+00FH) ;DPB_0F_BPS
001E76 EBD2 F1              10      POP AF
       EBD3                     EADR1:              ;読み込むセクタ数と1クラスタのセクタ数を掛ける
001E77 EBD3 CB18             8      RR  B
001E79 EBD5 D8              11      RET C
001E7A EBD6 87               4      ADD A,A
001E7B EBD7 18FA            12      JR  EADR1
                                
                                ;   CMOS BACKUP MEMORY DRIVER(32KB)
                                ;   1セクタ256
                                
       EBD9                     CDWT:
001E7D EBD9 78               4      LD  A,B
001E7E EBDA DD4E13          19      LD  C,(IX+013H) ;DPB_13_UNITNO
001E81 EBDD ED40            12      IN  B,(C)       ;アドレスカウンタを0000にリセット
001E83 EBDF ED59            12      OUT (C),E       ;W)アドレスカウンタ上位
001E85 EBE1 0C               4      INC C       ;C=F9
001E86 EBE2 0C               4      INC C       ;C=FA
001E87 EBE3 0600             7      LD  B,0
       EBE5                     CDWT1:
001E89 EBE5 EDB3                    OTIR            ;W)データ書き込み・アドレスカウンタ+1
001E8B EBE7 13               6      INC DE
001E8C EBE8 3D               4      DEC A
001E8D EBE9 20FA            12      JR  NZ,CDWT1
001E8F EBEB A7               4      AND A
001E90 EBEC C9              10      RET
                                
       EBED                     CDRD:
001E91 EBED 78               4      LD  A,B
001E92 EBEE DD4E13          19      LD  C,(IX+013H) ;DPB_13_UNITNO
001E95 EBF1 ED40            12      IN  B,(C)       ;アドレスカウンタを0000にリセット
001E97 EBF3 ED59            12      OUT (C),E       ;W)アドレスカウンタ上位
001E99 EBF5 0C               4      INC C       ;C=F9
001E9A EBF6 0600             7      LD  B,0
       EBF8                     CDRD1:
001E9C EBF8 EDB2                    INIR            ;R)データ読み出し・アドレスカウンタ+1
001E9E EBFA 13               6      INC DE
001E9F EBFB 3D               4      DEC A
001EA0 EBFC 20FA            12      JR  NZ,CDRD1
001EA2 EBFE A7               4      AND A
001EA3 EBFF C9              10      RET
                                
                                ;   RAM DISK DRIVER (64KB)
                                ;   1セクタ256
                                
       EC00                     RDWT:
001EA4 EC00 78               4      LD  A,B
001EA5 EC01 43               4      LD  B,E     ;B=アドレスカウンタ上位
001EA6 EC02 0EEB             7      LD  C,0EBH
001EA8 EC04 ED71            12      OUT (C),0       ;0=アドレスカウンタ下位
001EAA EC06 0D               4      DEC C       ;EA(W)データ書き込み・アドレスカウンタ+1
001EAB EC07 0600             7      LD  B,0
       EC09                     RDWT1:
001EAD EC09 EDB3                    OTIR
001EAF EC0B 13               6      INC DE
001EB0 EC0C 3D               4      DEC A
001EB1 EC0D 20FA            12      JR  NZ,RDWT1
001EB3 EC0F A7               4      AND A
001EB4 EC10 C9              10      RET
                                
       EC11                     RDRD:
001EB5 EC11 78               4      LD  A,B
001EB6 EC12 43               4      LD  B,E     ;B=アドレスカウンタ上位
001EB7 EC13 0EEB             7      LD  C,0EBH
001EB9 EC15 ED71            12      OUT (C),0       ;0=アドレスカウンタ下位
001EBB EC17 0D               4      DEC C       ;EA(R)データ読み出し・アドレスカウンタ+1
001EBC EC18 0600             7      LD  B,0
       EC1A                     RDRD1:
001EBE EC1A EDB2                    INIR
001EC0 EC1C 13               6      INC DE
001EC1 EC1D 3D               4      DEC A
001EC2 EC1E 20FA            12      JR  NZ,RDRD1
001EC4 EC20 A7               4      AND A
001EC5 EC21 C9              10      RET
[EOF:M7DISK2.ASM:UTF_8]
                                
                                    INCLUDE "M7TABLE.ASM"
                                
                                ;   LSX-Dodgers TABLE 表示関連のテーブル
                                ;   MZ-700/1500
                                
       EC22                     AT_TABLE:
001EC6 EC22                         DS  TABLEAD-AT_TABLE
                                
       EC40                     KEY_TABLE:
001EE4 EC40 12081E1F1C1D5C2F        DB  12H,08H,1EH,1FH,1CH,1DH,5CH,'/'
001EEC EC48 5C5E2D2030392C2E        DB  5CH,'^','-',20H,'0','9',',','.'
001EF4 EC50 3132333435363738        DB  '1','2','3','4','5','6','7','8'
001EFC EC58 6162636465666768        DB  'a','b','c','d','e','f','g','h'
001F04 EC60 696A6B6C6D6E6F70        DB  'i','j','k','l','m','n','o','p'
001F0C EC68 7172737475767778        DB  'q','r','s','t','u','v','w','x'
001F14 EC70 797A405B5D000000        DB  'y','z','@','[',']',00H,00H,00H
001F1C EC78 001B3D09003B3A0D        DB  00H,1BH,'=',09H,00H,';',':',0DH
       EC80                     SHIFT_TABLE:
001F24 EC80 12081E1F1C1D5F3F        DB  12H,08H,1EH,1FH,1CH,1DH,'_','?'
001F2C EC88 7C7E3D2030293C3E        DB  '|','~','=',20H,'0',')','<','>'
001F34 EC90 2122232425262728        DB  '!','"','#','$','%','&',27H,'('
001F3C EC98 4142434445464748        DB  'A','B','C','D','E','F','G','H'
001F44 ECA0 494A4B4C4D4E4F50        DB  'I','J','K','L','M','N','O','P'
001F4C ECA8 5152535455565758        DB  'Q','R','S','T','U','V','W','X'
001F54 ECB0 595A607B7D000000        DB  'Y','Z','`','{','}',00H,00H,00H
001F5C ECB8 00003D09002B2A0D        DB  00H,00H,'=',09H,00H,'+','*',0DH
       ECC0                     CTRL_TABLE:
001F64 ECC0 12081E1F1C1D3F2F        DB  12H,08H,1EH,1FH,1CH,1DH,'?','/'
001F6C ECC8 2A2B2D2030392C2E        DB  '*','+','-',20H,'0','9',',','.'
001F74 ECD0 3132333435363738        DB  '1','2','3','4','5','6','7','8'
001F7C ECD8 0102030405060708        DB  01H,02H,03H,04H,05H,06H,07H,08H
001F84 ECE0 090A0B0C0D0E0F10        DB  09H,0AH,0BH,0CH,0DH,0EH,0FH,10H
001F8C ECE8 1112131415161718        DB  11H,12H,13H,14H,15H,16H,17H,18H
001F94 ECF0 191A1B5B5D000000        DB  19H,1AH,1BH,'[',']',00H,00H,00H
001F9C ECF8 00003D09003B3A0D        DB  00H,00H,'=',09H,00H,';',':',0DH
                                
                                ;   アドレス下位1バイトが0になるように
       ED00                     CD_TABLE:
001FA4 ED00 00D1D2D3D4D5D6D0        DB  $00,$D1,$D2,$D3,$D4,$D5,$D6,$D0 ;月火水木金土日
001FAC ED08 D8DCD9DADBD7CFCE        DB  $D8,$DC,$D9,$DA,$DB,$D7,$CF,$CE ;年円時分秒
001FB4 ED10 601F5F5E1E1B7978        DB  $60,$1F,$5F,$5E,$1E,$1B,$79,$78 ;
001FBC ED18 5C5D1C1D6DCACDC7        DB  $5C,$5D,$1C,$1D,$6D,$CA,$CD,$C7 ;
001FC4 ED20 0061626364656667        DB  $00,$61,$62,$63,$64,$65,$66,$67 ; !"#$%&'
001FCC ED28 68696B6A2F2A2E2D        DB  $68,$69,$6B,$6A,$2F,$2A,$2E,$2D ;()*+,-./
001FD4 ED30 2021222324252627        DB  $20,$21,$22,$23,$24,$25,$26,$27 ;01234567
001FDC ED38 28294F2C512B5749        DB  $28,$29,$4F,$2C,$51,$2B,$57,$49 ;89:;<=>?
001FE4 ED40 5501020304050607        DB  $55,$01,$02,$03,$04,$05,$06,$07 ;@ABCDEFG
001FEC ED48 08090A0B0C0D0E0F        DB  $08,$09,$0A,$0B,$0C,$0D,$0E,$0F ;HIJKLMNO
001FF4 ED50 1011121314151617        DB  $10,$11,$12,$13,$14,$15,$16,$17 ;PQRSTUVW
001FFC ED58 18191A52DD54507C        DB  $18,$19,$1A,$52,$DD,$54,$50,$7C ;XYZ[\]^_
002004 ED60 5901020304050607        DB  $59,$01,$02,$03,$04,$05,$06,$07 ;`abcdefg   ATB:1
00200C ED68 08090A0B0C0D0E0F        DB  $08,$09,$0A,$0B,$0C,$0D,$0E,$0F ;hijklmno   ATB:1
002014 ED70 1011121314151617        DB  $10,$11,$12,$13,$14,$15,$16,$17 ;pqrstuvw   ATB:1
00201C ED78 18191ACB35CC705A        DB  $18,$19,$1A,$CB,$35,$CC,$70,$5A ;xyz{|}~    ATB:1
002024 ED80 415346444847B49E        DB  $41,$53,$46,$44,$48,$47,$B4,$9E ;トランプ〇●をぁ   ATB:1
00202C ED88 B2B6BABE9FB3B7BB        DB  $B2,$B6,$BA,$BE,$9F,$B3,$B7,$BB ;ぃぅぇぉゃゅょっ   ATB:1
002034 ED90 BFA385A4A5A69487        DB  $BF,$A3,$85,$A4,$A5,$A6,$94,$87 ;ーあいうえおかき   ATB:1
00203C ED98 889C829884929083        DB  $88,$9C,$82,$98,$84,$92,$90,$83 ;くけこさしすせそ   ATB:1
002044 EDA0 F0BD9DB1B5B9B49E        DB  $F0,$BD,$9D,$B1,$B5,$B9,$B4,$9E ;　。「」、・ヲァ
00204C EDA8 B2B6BABE9FB3B7BB        DB  $B2,$B6,$BA,$BE,$9F,$B3,$B7,$BB ;ィゥェォャョュッ
002054 EDB0 BFA385A4A5A69487        DB  $BF,$A3,$85,$A4,$A5,$A6,$94,$87 ;ーアイウエオカキ
00205C EDB8 889C829884929083        DB  $88,$9C,$82,$98,$84,$92,$90,$83 ;クケコサシスセソ
002064 EDC0 91819A97939589A1        DB  $91,$81,$9A,$97,$93,$95,$89,$A1 ;タチツテトナニヌ
00206C EDC8 AF8B8696A2ABAA8A        DB  $AF,$8B,$86,$96,$A2,$AB,$AA,$8A ;ネノハヒフヘホマ
002074 EDD0 8EB0AD8DA7A8A98F        DB  $8E,$B0,$AD,$8D,$A7,$A8,$A9,$8F ;ミムメモヤユヨラ
00207C EDD8 8CAEAC9BA099BCB8        DB  $8C,$AE,$AC,$9B,$A0,$99,$BC,$B8 ;リルレロワン゛゜
002084 EDE0 91819A97939589A1        DB  $91,$81,$9A,$97,$93,$95,$89,$A1 ;たちつてとねにぬ   ATB:1
00208C EDE8 AF8B8696A2ABAA8A        DB  $AF,$8B,$86,$96,$A2,$AB,$AA,$8A ;ねのはひふへほま   ATB:1
002094 EDF0 8EB0AD8DA7A8A98F        DB  $8E,$B0,$AD,$8D,$A7,$A8,$A9,$8F ;みむめもやゆよら   ATB:1
00209C EDF8 8CAEAC9BA099BCB8        DB  $8C,$AE,$AC,$9B,$A0,$99,$BC,$B8 ;りるれろわん゛゜   ATB:1
       EE00                     DC_TABLE:
0020A4 EE00 2041424344454647        DB  $20,$41,$42,$43,$44,$45,$46,$47 ;0
0020AC EE08 48494A4B4C4D4E4F        DB  $48,$49,$4A,$4B,$4C,$4D,$4E,$4F
0020B4 EE10 5051525354555657        DB  $50,$51,$52,$53,$54,$55,$56,$57 ;1
0020BC EE18 58595A151A1B1411        DB  $58,$59,$5A,$15,$1A,$1B,$14,$11
0020C4 EE20 3031323334353637        DB  $30,$31,$32,$33,$34,$35,$36,$37 ;2
0020CC EE28 38392D3D3B2F2E2C        DB  $38,$39,$2D,$3D,$3B,$2F,$2E,$2C
0020D4 EE30 00000000007C0000        DB  $00,$00,$00,$00,$00,$7C,$00,$00 ;3
0020DC EE38 0000000000000000        DB  $00,$00,$00,$00,$00,$00,$00,$00
0020E4 EE40 0080000083008285        DB  $00,$80,$00,$00,$83,$00,$82,$85 ;4
0020EC EE48 843F00000000003A        DB  $84,$3F,$00,$00,$00,$00,$00,$3A
0020F4 EE50 5E3C5B815D40003E        DB  $5E,$3C,$5B,$81,$5D,$40,$00,$3E ;5
0020FC EE58 00607F0018191312        DB  $00,$60,$7F,$00,$18,$19,$13,$12
002104 EE60 1021222324252627        DB  $10,$21,$22,$23,$24,$25,$26,$27 ;6
00210C EE68 28292B2A001C0000        DB  $28,$29,$2B,$2A,$00,$1C,$00,$00
002114 EE70 7E00000000000000        DB  $7E,$00,$00,$00,$00,$00,$00,$00 ;7
00211C EE78 171600005F000000        DB  $17,$16,$00,$00,$5F,$00,$00,$00
002124 EE80 00C19A9F9C92CA97        DB  $00,$C1,$9A,$9F,$9C,$92,$CA,$97 ;8
00212C EE88 98C6CFC9D8D3D0D7        DB  $98,$C6,$CF,$C9,$D8,$D3,$D0,$D7
002134 EE90 9EC09DC496C5CBC3        DB  $9E,$C0,$9D,$C4,$96,$C5,$CB,$C3 ;9
00213C EE98 9BDDC2DB99A2878C        DB  $9B,$DD,$C2,$DB,$99,$A2,$87,$8C
002144 EEA0 DCC7CC91939495D4        DB  $DC,$C7,$CC,$91,$93,$94,$95,$D4 ;A
00214C EEA8 D5D6CECDDAD2D9C8        DB  $D5,$D6,$CE,$CD,$DA,$D2,$D9,$C8
002154 EEB0 D1A3888D86A4898E        DB  $D1,$A3,$88,$8D,$86,$A4,$89,$8E ;B
00215C EEB8 DFA58A8FDEA18B90        DB  $DF,$A5,$8A,$8F,$DE,$A1,$8B,$90
002164 EEC0 000000000000001F        DB  $00,$00,$00,$00,$00,$00,$00,$1F ;C
00216C EEC8 00001D7B7D1E0F0E        DB  $00,$00,$1D,$7B,$7D,$1E,$0F,$0E
002174 EED0 070102030405060D        DB  $07,$01,$02,$03,$04,$05,$06,$0D ;D
00217C EED8 080A0B0C095C0000        DB  $08,$0A,$0B,$0C,$09,$5C,$00,$00
002184 EEE0 0000000000000000        DB  $00,$00,$00,$00,$00,$00,$00,$00 ;E
00218C EEE8 0000000000000000        DB  $00,$00,$00,$00,$00,$00,$00,$00
002194 EEF0 A000000000000000        DB  $A0,$00,$00,$00,$00,$00,$00,$00 ;F
00219C EEF8 0000000000000000        DB  $00,$00,$00,$00,$00,$00,$00,$00
[EOF:M7TABLE.ASM:SHIFT_JIS]
                                    INCLUDE "LDWORK.ASM"
                                
                                ;   LSX-Dodgers WORK0
                                ;
                                ;   CP/M互換BIOS
                                ;   BOOT:アドレス下位1バイトが0になるように
       EF00                     AT_WORK:
0021A4 EF00                         DS  WORKAD-AT_WORK
                                
       EF00                     CPM_BOOT:
0021A4 EF00 C30000          10      JP  0
       EF03                     _SYS00:     ;(BDOS)プログラム終了
       EF03                     CPM_WBOOT:
0021A7 EF03 C3FECF          10      JP  WBOOT1
       EF06                     CPM_CONST:
0021AA EF06 C34CD9          10      JP  CONSTX
       EF09                     _SYS07:     ;(BDOS)コンソール直接入力
       EF09                     CPM_CONIN:
0021AD EF09 C3E2D8          10      JP  FLGET
       EF0C                     CPM_CONOUT:
0021B0 EF0C C3F1DA          10      JP  CONOUT1
                                
       EF0F                     DECBF:
0021B3 EF0F                         DS  5
0021B8 EF14 00                  FDRV    DB  0
0021B9 EF15                     FNAME   DS  36
0021DD EF39                     SFILE:  DS  33      ;DRV FILENAME
0021FE EF5A                     HLBUF:  DS  3       ;Random record buffer
                                
002201 EF5D 0000                LEFTX:  DW  0
002203 EF5F 0000                DTAX:   DW  0
                                
       EF61                     ZERO:
       EF61                     BEEPD:
002205 EF61 008E01000B000C10        DB  0,08EH,1,0,00BH,0,00CH,010H
00220D EF69 073E08100D00FF          DB  007H,03EH,008H,010H,00DH,0,0FFH
       EF62                     RTC_YY  EQU BEEPD+1
       EF63                     RTC_MW  EQU BEEPD+2
       EF64                     RTC_DD  EQU BEEPD+3
       EF65                     RTC_TT  EQU BEEPD+4
       EF66                     RTC_MM  EQU BEEPD+5
       EF67                     RTC_SS  EQU BEEPD+6
                                
002214 EF70 00                  CHECK:  DB  0
                                
002215 EF71 4F4B24              OK: DB  "OK$"
002218 EF74                         DS  5
00221D EF79 4572726F722124      COMERM: DB  "Error!$"
                                ;   システムワークエリア
                                ;   _CYL0:アドレス下位1バイトが080Hになるように
002224 EF80 FF                  _CYL0:  DB  0FFH    ;Cylinder
002225 EF81 FF                  _CYL1:  DB  0FFH    ;Cylinder
002226 EF82 FF                  _CYL2:  DB  0FFH    ;Cylinder
002227 EF83 FF                  _CYL3:  DB  0FFH    ;Cylinder
002228 EF84 00                  _DRIVE: DB  0   ;unit number
002229 EF85 00                  _SEEKSP:DB  0   ;Seek speed
00222A EF86 FF                  _ISEEK: DB  0FFH    ;
00222B EF87 00                  _DVSW:  DB  0
00222C EF88 00                  _DRV:   DB  0
00222D EF89 FF                  _DSK:   DB  0FFH
00222E EF8A 8000                _DTA:   DW  00080H
002230 EF8C 0000                _CTC:   DW  0
002232 EF8E 0000                _TXADR: DW  0
002234 EF90 0000                _KEYPS: DW  0
002236 EF92 00FF                _KEYD:  DW  0FF00H  ;キーデータ
002238 EF94 8310                _KEYSP: DB  KEYSP_L,KEYSP_H ;オートリピートの速度
00223A EF96 71                  _COLORF:DB  COLORF  ;色
00223B EF97 19                  _LINE:  DB  LINE
                                
00223C EF98 0000                _FCB:   DW  0   ;SEARCH FILES
00223E EF9A 0000                _FBPS:  DW  0   ;    //
002240 EF9C 0000                _FBAD:  DW  0   ;    //
002242 EF9E 00                  _FBCNT: DB  0   ;    //
002243 EF9F 00                  _FILEN: DB  0   ;    //
002244 EFA0 00                  _DIRF:  DB  0   ;bit7:ディレクトリ bit0-6:セクタインデックス
002245 EFA1                         DS  1
002246 EFA2 00                  _WTFATF:DB  0   ;FATバッファの更新フラグ
002247 EFA3                         DS  1
002248 EFA4 00                  _WTDBF: DB  0   ;データバッファの更新フラグ
002249 EFA5 FF                  _DBDRV: DB  0FFH    ;データバッファにあるデータを読み込んだドライブ
00224A EFA6 0000                _DBSEC: DW  0   ;データバッファにあるデータを読み込んだセクタ番号
00224C EFA8 0000                _DPB:   DW  0
       EFAA                     _FATDRV:
00224E EFAA FF                      DB  0FFH    ;FATバッファに読み込んでいるドライブ
00224F EFAB 00                  _FATIX: DB  0   ;FATバッファに読み込んでいるインデックス
       EFAC                     _FAKEFREE:
002250 EFAC 0000                    DW  0   ;偽の残量（FATサイズが大きくなると重くなるのでその対策）
                                
002252 EFAE                         DS  2
                                
       EFB0                     CRTCD:  
002254 EFB0 6F                      DB  06FH
       EFB1                     _WIDTH: 
002255 EFB1 28                      DB  WIDTH
       EFB2                     TVRAMTOP:
002256 EFB2 5938                    DB  059H,038H
002258 EFB4 1F02                    DB  01FH,002H
       EFB6                     _LINE2:
00225A EFB6 19                      DB  019H
       EFB7                     WKE4:
00225B EFB7 1C                      DB  01CH
       EFB8                     WKE6:
00225C EFB8 00                      DB  000H
       EFB9                     WK40:
00225D EFB9 07                      DB  007H
       EFBA                     _PAGE_MINUS:
00225E EFBA 18FC                    DW  0-WIDTH*LINE
       EFBC                     _WIDTH_MINUS:
002260 EFBC D8FF                    DW  0-WIDTH
       EFBE                     WK30:
002262 EFBE 0C                      DB  00CH
       EFBF                     WK31:
       EFBF                     WK1FD0:
002263 EFBF 20                      DB  020H
                                
002264 EFC0 0000                CTC0:   DW  INTCTCE
002266 EFC2 0000                CTC1:   DW  INTCTCE
002268 EFC4 0000                CTC2:   DW  INTCTC2
00226A EFC6 0000                CTC3:   DW  INTCTCE
00226C EFC8 0000                INTVEC: DW  INT
                                
                                ;   LSX-Dodgers 独自BIOS
                                
00226E EFCA C32ADC          10  _INKEY: JP  INKEY
002271 EFCD C3DDD9          10  _PRINT: JP  PRINT
002274 EFD0 C385DC          10  _SCRN:  JP  SCRN
002277 EFD3 C39ADB          10  _POS:   JP  POS
00227A EFD6 C3BFDA          10  _LOC:   JP  LOC
       EFD9                     _CHGDRV:
00227D EFD9 C324E9          10      JP  CHGDRV
       EFDC                     _GETDPB:
002280 EFDC C3EFE9          10      JP  GETDPB
       EFDF                     _FFLUSH:
002283 EFDF C30DEA          10      JP  FFLUSH
       EFE2                     _RDFATX:
002286 EFE2 C325E6          10      JP  RDFATX
002289 EFE5 C34DE7          10  _RDFAT: JP  RDFAT
00228C EFE8 C3CDEA          10  _WTTRK: JP  WTTRK
00228F EFEB C32DEB          10  _FDRD:  JP  FDRD
002292 EFEE C3D3EA          10  _FDWT:  JP  FDWT
       EFF1                     _BPB2DPB:
002295 EFF1 C3B2E7          10      JP  BPB2DPB
002298 EFF4                         DS  3
       EFF7                     _GNCL:
00229B EFF7 C3C7E6          10  GNCPAT: JP  GNCL        ; self-modifying code
       EFFA                     _SNCL:
00229E EFFA C3EAE6          10  SNCPAT: JP  SNCL        ; self-modifying code
0022A1 EFFD C34BD0          10  _COMANL:JP  COMANL
                                
       F000                     _WE:
[EOF:LDWORK.ASM:SHIFT_JIS]
                                    INCLUDE "LDCALL.ASM"
                                
                                ;   LSX-Dodgers システムコール(BDOS)
                                ;
                                ;   LSX-Dodgers SYSTEM CALL
                                ;   STABLE:アドレス下位1バイトが0になるように
                                
       F000                     STABLE:
                                ;0
0022A4 F000 03EFB5D8C1D85ADE        DW  _SYS00,_SYS01,_SYS02,_SYS03
0022AC F008 CDD5CDD5C6D809EF        DW  _SYS04,_SYS05,_SYS06,_SYS07
0022B4 F010 CED8CFD518D944D9        DW  _SYS08,_SYS09,_SYS0A,_SYS0B
0022BC F018 E4D5E9D5F8D50BD6        DW  _SYS0C,_SYS0D,_SYS0E,_SYS0F
                                ;1
0022C4 F020 5FD6A6D6EFD625D7        DW  _SYS10,_SYS11,_SYS12,_SYS13
0022CC F028 2DD743D758D750D7        DW  _SYS14,_SYS15,_SYS16,_SYS17
0022D4 F030 9FD7A4D7A9D7AFD7        DW  _SYS18,_SYS19,_SYS1A,_SYS1B
0022DC F038 CDD5D5D7CDD5D9D7        DW  _SYS1C,_SYS1D,_SYS1E,_SYS1F
                                ;2
0022E4 F040 CDD58FD797D7E0D7        DW  _SYS20,_SYS21,_SYS22,_SYS23
0022EC F048 06D8CDD5E2E2C7E3        DW  _SYS24,_ERROR,_SYS26,_SYS27
0022F4 F050 97D70FD85AD95ADE        DW  _SYS28,_SYS5C,_SYS2A,_SYS2B
0022FC F058 60D95ADECDD532D8        DW  _SYS2C,_SYS2D,_SYS2E,_SYS2F
                                ;3
002304 F060 2CD8CDD5CDD5CDD5        DW  _SYS30,_ERROR,_ERROR,_ERROR
00230C F068 CDD5CDD5CDD5CDD5        DW  _ERROR,_ERROR,_ERROR,_ERROR
002314 F070 CDD55ADE5ADE53D8        DW  _ERROR,_SYS39,_SYS3A,_SYS5A
                                ;DOS2
00231C F078 B0D5                    DW  _DOS2
                                
00231E F07A                         DS  2
002320 F07C 00F2                _FATBF: DW  FATBF
002322 F07E 00FA                _DTBUF: DW  DTBUF
                                
                                ;   コントロールコードテーブル
                                ;   CTRLTB:アドレス下位1バイトが080Hになるように
                                
       F080                     CTRLTB:
002324 F080 42DA42DA78DA6DDB        DW  CTRL00,CTRL00,CTRL02,CTRL03 ;  A,B,C
00232C F088 67DBA4DA58DB01DB        DW  CTRL04,CTRL05,CTRL06,CTRL07 ;D,E,F,G
002334 F090 4EDA69DA70DBD2DA        DW  CTRL08,CTRL09,CTRL0A,CTRL0B ;H,I,J,K
00233C F098 55DBBADA82DB42DA        DW  CTRL0C,CTRL0D,CTRL0E,CTRL00 ;L,M,N,O
002344 F0A0 42DA42DACADA42DA        DW  CTRL00,CTRL00,CTRL12,CTRL00 ;P,Q,R,S
00234C F0A8 42DA42DA42DA42DA        DW  CTRL00,CTRL00,CTRL00,CTRL00 ;T,U,V,W
002354 F0B0 42DA42DA55DBD9DA        DW  CTRL00,CTRL00,CTRL0C,CTRL1B ;X,Y,Z,ESC
00235C F0B8 31DA55DA5EDA70DB        DW  CTRL1C,CTRL1D,CTRL1E,CTRL1F ;→,←,↑,↓
                                
002364 F0C0                         DS  02AH
                                
00238E F0EA 1617                SDDATA: DB  22,23       ;(FCB)ファイルを最後に変更した時刻
002390 F0EC 1415                    DB  20,21       ;(FCB)ファイルを最後に変更した日付
002392 F0EE 1A1B                    DB  26,27       ;(FCB)ファイルの先頭クラスタ
002394 F0F0 10111213                DB  16,17,18,19 ;(FCB)ファイルのサイズ(バイト単位)
       F0F4                     SDDATAE:
                                
002398 F0F4                     SCDIR:  DS  2       ;+14 +15
00239A F0F6                     SFBPS:  DS  2       ;FBPS
00239C F0F8                     SFNDF:  DS  2       ;FILEN DIRF
                                
00239E F0FA 0000                _FATPS: DW  0
0023A0 F0FC 0000                _DIRPS: DW  0
0023A2 F0FE 0000                _CLPS:  DW  0
                                
       F100                     _PE:
[EOF:LDCALL.ASM:SHIFT_JIS]
                                    INCLUDE "M7DPB.ASM"
                                
                                ;   LSX-Dodgers DPB
                                ;   MZ-700/1500
                                
       F100                     DEVICE:
                                
                                ;   A:
                                
0023A4 F100 0200                    DW  2   ;DPB_00_FATLN
0023A6 F102 EBEF                    DW  _FDRD   ;DPB_02_DRD
0023A8 F104 EEEF                    DW  _FDWT   ;DPB_04_DWT
0023AA F106 FD                      DB  0FDH    ;DPB_06_FATID
0023AB F107 02                      DB  2   ;DPB_07_SECPCL
0023AC F108 6401                    DW  356 ;DPB_08_MAXCL
0023AE F10A FF                      DB  0FFH    ;DPB_0A_FDMODE  0FFH=2D / 0FEH=2HD
0023AF F10B 07                      DB  7   ;DPB_0B_DIRSCNT
0023B0 F10C 28                      DB  40  ;DPB_0C_MAXCYL
0023B1 F10D 09                      DB  9   ;DPB_0D_MAXSEC  Number of sectors
0023B2 F10E 01                      DB  1   ;DPB_0E_FATPS
0023B3 F10F 82                      DB  082H    ;DPB_0F_BPS
0023B4 F110 0500                    DW  5   ;DPB_10_DIRPS
0023B6 F112 27                      DB  027H    ;DPB_12_DEVICE  Device Number
0023B7 F113 00                      DB  0   ;DPB_13_UNITNO
0023B8 F114 0800                    DW  8   ;DPB_14_ADDCL16
0023BA F116 0000                    DW  0   ;DPB_16
0023BC F118 0000                    DW  0   ;DPB_18
0023BE F11A 0000                    DW  0   ;DPB_1A_SDIR
0023C0 F11C 46444430                DB  "FDD0"  ;DPB_1C_NAME
                                
                                ;   B:
                                
0023C4 F120 0200                    DW  2   ;DPB_00_FATLN
0023C6 F122 EBEF                    DW  _FDRD   ;DPB_02_DRD
0023C8 F124 EEEF                    DW  _FDWT   ;DPB_04_DWT
0023CA F126 FD                      DB  0FDH    ;DPB_06_FATID
0023CB F127 02                      DB  2   ;DPB_07_SECPCL
0023CC F128 6401                    DW  356 ;DPB_08_MAXCL
0023CE F12A FF                      DB  0FFH    ;DPB_0A_FDMODE  0FFH=2D / 0FEH=2HD
0023CF F12B 07                      DB  7   ;DPB_0B_DIRSCNT
0023D0 F12C 28                      DB  40  ;DPB_0C_MAXCYL
0023D1 F12D 09                      DB  9   ;DPB_0D_MAXSEC  Number of sectors
0023D2 F12E 01                      DB  1   ;DPB_0E_FATPS
0023D3 F12F 82                      DB  082H    ;DPB_0F_BPS
0023D4 F130 0500                    DW  5   ;DPB_10_DIRPS
0023D6 F132 27                      DB  027H    ;DPB_12_DEVICE  Device Number
0023D7 F133 01                      DB  1   ;DPB_13_UNITNO
0023D8 F134 0800                    DW  8   ;DPB_14_ADDCL16
0023DA F136 0000                    DW  0   ;DPB_16
0023DC F138 0000                    DW  0   ;DPB_18
0023DE F13A 0000                    DW  0   ;DPB_1A_SDIR
0023E0 F13C 46444431                DB  "FDD1"  ;DPB_1C_NAME
                                
                                ;   C:
                                
0023E4 F140 0100                    DW  1   ;DPB_00_FATLN
0023E6 F142 EDEB                    DW  CDRD    ;DPB_02_DRD
0023E8 F144 D9EB                    DW  CDWT    ;DPB_04_DWT
0023EA F146 FA                      DB  0FAH    ;DPB_06_FATID
0023EB F147 01                      DB  1   ;DPB_07_SECPCL
0023EC F148 7A00                    DW  122 ;DPB_08_MAXCL
0023EE F14A 00                      DB  0   ;DPB_0A_FDMODE
0023EF F14B 06                      DB  6   ;DPB_0B_DIRSCNT
0023F0 F14C 00                      DB  0   ;DPB_0C_MAXCYL
0023F1 F14D 00                      DB  0   ;DPB_0D_MAXSEC
0023F2 F14E 01                      DB  1   ;DPB_0E_FATPS
0023F3 F14F 01                      DB  1   ;DPB_0F_BPS
0023F4 F150 0200                    DW  2   ;DPB_10_DIRPS
0023F6 F152 0C                      DB  00CH    ;DPB_12_DEVICE
0023F7 F153 F8                      DB  0F8H    ;DPB_13_UNITNO
0023F8 F154 0600                    DW  6   ;DPB_14_ADDCL16
0023FA F156 0000                    DW  0   ;DPB_16
0023FC F158 0000                    DW  0   ;DPB_18
0023FE F15A 0000                    DW  0   ;DPB_1A_SDIR
002400 F15C 434D4F53                DB  "CMOS"  ;DPB_1C_NAME
                                
                                ;   D:
                                
002404 F160                         DS  32
                                
                                ;   E:
                                
002424 F180 0000                    DW  0   ;DPB_00_FATLN
002426 F182 A4EB                    DW  EDRD    ;DPB_02_DRD
002428 F184 97EB                    DW  EDWT    ;DPB_04_DWT
00242A F186 FA                      DB  0FAH    ;DPB_06_FATID
00242B F187 02                      DB  2   ;DPB_07_SECPCL
00242C F188 0000                    DW  0   ;DPB_08_MAXCL
00242E F18A 00                      DB  0   ;DPB_0A_FDMODE
00242F F18B 10                      DB  16  ;DPB_0B_DIRSCNT
002430 F18C 00                      DB  0   ;DPB_0C_MAXCYL
002431 F18D 00                      DB  0   ;DPB_0D_MAXSEC
002432 F18E 01                      DB  1   ;DPB_0E_FATPS
002433 F18F 01                      DB  1   ;DPB_0F_BPS
002434 F190 0000                    DW  0   ;DPB_10_DIRPS
002436 F192 26                      DB  026H    ;DPB_12_DEVICE
002437 F193 00                      DB  0   ;DPB_13_UNITNO
002438 F194 0000                    DW  0   ;DPB_14_ADDCL16
00243A F196 0000                    DW  0   ;DPB_16
00243C F198 0000                    DW  0   ;DPB_18
00243E F19A 0000                    DW  0   ;DPB_1A_SDIR
002440 F19C 454D4D30                DB  "EMM0"  ;DPB_1C_NAME
                                
                                ;   F:
                                
002444 F1A0 0200                    DW  2   ;DPB_00_FATLN
002446 F1A2 11EC                    DW  RDRD    ;DPB_02_DRD
002448 F1A4 00EC                    DW  RDWT    ;DPB_04_DWT
00244A F1A6 FA                      DB  0FAH    ;DPB_06_FATID
00244B F1A7 01                      DB  1   ;DPB_07_SECPCL
00244C F1A8 F600                    DW  246 ;DPB_08_MAXCL
00244E F1AA 00                      DB  0   ;DPB_0A_FDMODE
00244F F1AB 09                      DB  9   ;DPB_0B_DIRSCNT
002450 F1AC 00                      DB  0   ;DPB_0C_MAXCYL
002451 F1AD 00                      DB  0   ;DPB_0D_MAXSEC
002452 F1AE 01                      DB  1   ;DPB_0E_FATPS
002453 F1AF 01                      DB  1   ;DPB_0F_BPS
002454 F1B0 0300                    DW  3   ;DPB_10_DIRPS
002456 F1B2 0F                      DB  00FH    ;DPB_12_DEVICE
002457 F1B3 00                      DB  0   ;DPB_13_UNITNO
002458 F1B4 0A00                    DW  10  ;DPB_14_ADDCL16
00245A F1B6 0000                    DW  0   ;DPB_16
00245C F1B8 0000                    DW  0   ;DPB_18
00245E F1BA 0000                    DW  0   ;DPB_1A_SDIR
002460 F1BC 52414D46                DB  "RAMF"  ;DPB_1C_NAME
                                
                                ;   G:
                                
002464 F1C0                         DS  32
                                
                                ;   H:
002484 F1E0                         DS  3
002487 F1E3 00                      DB  0
[EOF:M7DPB.ASM:UTF_8]
                                
       A488                         ORG $$+OFFSET   ;$DEPHASE
       A488                     LAST_ADR:
                                
                                    END
[EOF:M7.ASM:UTF_8]
