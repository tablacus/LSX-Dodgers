                                ;*** AILZ80ASM *** Z-80 Assembler, version 1.0.0.0, LST:Full:4
                                ;   LSX-Dodgers for MZ-700/1500
                                ;   Programmed by
                                ;   Gaku (Lovers/Tablacus)
                                
                                    INCLUDE "M7DEF.ASM"
                                
                                ;   LSX-Dodgers DEF
                                ;   MZ-700/1500
                                
       0001                     MAC EQU 1   ;MZ-700/1500
       0000                     DEV EQU 0
                                
       011D                     VER_6F  EQU 0011DH
                                
       8080                     RUN EQU 08080H
       8000                     OFFSET  EQU RUN-128
       CF06                     BDOS    EQU 0CF06H
       ED40                     TABLEAD EQU 0ED40H
       F000                     WORKAD  EQU 0F000H
       F300                     FATBF   EQU 0F300H
       FB00                     DTBUF   EQU 0FB00H
       FF00                     KEYBF   EQU 0FF00H
       FF20                     KBUF    EQU 0FF20H
       FFD9                     TRAP38  EQU 0FFD9H
       0028                     WIDTH   EQU 40
       0019                     LINE    EQU 25
       0070                     COLORF  EQU 070H
       0010                     KEYSP_H EQU 16
       0083                     KEYSP_L EQU 131
       0009                     COMS    EQU 9
[EOF:M7DEF.ASM:UTF_8]
                                    INCLUDE "LDDEF.ASM"
                                
                                ;   LSX-Dodgers DEF
                                
       0001                     VER_1   EQU 1
       0005                     VER_2   EQU 5
       0008                     VER_3   EQU 8
       1D01                     MACW    EQU MAC + 01D00H    ;機種フラグとLD判別フラグ
       0001                     MACD    EQU MAC + DEV * 256 ;機種フラグとデバイスフラグ
       0158                     VER EQU VER_1 * 256 + VER_2 * 16 + VER_3
                                
       0005                     SYSTEM  EQU 00005H
       000F                     JP_HL   EQU 0000FH
       005C                     FCB1    EQU 0005CH
       006C                     FCB2    EQU 0006CH
       005D                     FCB1FN  EQU FCB1+1
       006D                     FCB2FN  EQU FCB2+1
       0080                     DTA1    EQU 00080H
                                
       FFCA                     EXTBIO  EQU 0FFCAH
                                
       0000                     DPB_FATLN   EQU 00H
       0002                     DPB_DRD     EQU 02H
       0004                     DPB_DWT     EQU 04H
       0006                     DPB_FATID   EQU 06H
       0007                     DPB_SECPCL  EQU 07H
       0008                     DPB_MAXCL   EQU 08H
       000A                     DPB_FDMODE  EQU 0AH
       000B                     DPB_DIRSCNT EQU 0BH
       000C                     DPB_MAXCYL  EQU 0CH
       000D                     DPB_MAXSEC  EQU 0DH
       000E                     DPB_FATPS   EQU 0EH
       000F                     DPB_BPS     EQU 0FH
       0010                     DPB_DIRPS   EQU 10H
       0012                     DPB_DEVICE  EQU 12H
       0013                     DPB_UNITNO  EQU 13H
       0014                     DPB_ADDCL   EQU 14H
                                
       001A                     DPB_SDIR    EQU 1AH
       001C                     DPB_NAME    EQU 1CH
                                
[EOF:LDDEF.ASM:SHIFT_JIS]
                                
000000 8000                         ORG OFFSET
                                                    ;MZTヘッダ128バイト
000000 8000 01                      DB  1           ;ファイルモード
000001 8001 4C44202020202020        DB  "LD           "     ;ファイル名(13)
            2020202020          
00000E 800E 535953                  DB  "SYS"           ;拡張子(3)
000011 8011 0D                      DB  $0D
000012 8012 1125                    DW  LAST_ADR-RUN        ;サイズ
000014 8014 8080                    DW  RUN         ;開始アドレス
000016 8016 8080                    DW  RUN         ;実行アドレス
000018 8018                         DS  104
                                
                                    INCLUDE "M7INIT.ASM"
                                
                                ;   LSX-Dodgers INIT
                                ;   MZ-700/1500
                                
000080 8080 C38780          10      JP  START
000083 8083 011D                    DW  MACW
000085 8085 5801                    DW  VER
                                
       8087                     START:
000087 8087 F3               4      DI
000088 8088 ED56             8      IM  1
00008A 808A 318780          10      LD  SP,START
00008D 808D CD9B80          17      CALL    INIT        ;NZならAUTOEXECを実行
000090 8090 210000          10      LD  HL,0
000093 8093 E5              11      PUSH    HL
000094 8094 C8              11      RET Z
000095 8095 114E81          10      LD  DE,AUTOD
000098 8098 C3FDF0          10      JP  _COMANL
                                
       809B                     INIT:
00009B 809B D3E0            11      OUT (0E0H),A    ;DRAM(0000H-0FFFH)
00009D 809D D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
00009F 809F 21B381          10      LD  HL,INITE
0000A2 80A2 1106CF          10      LD  DE,BDOS
0000A5 80A5 01DE23          10      LD  BC,LAST_ADR-INITE
0000A8 80A8 EDB0                    LDIR
0000AA 80AA 218481          10      LD  HL,M7BEEPD
0000AD 80AD 1162F0          10      LD  DE,BEEPD+1
0000B0 80B0 010800          10      LD  BC,M7BEEPE-M7BEEPD
0000B3 80B3 EDB0                    LDIR
                                
0000B5 80B5 210000          10      LD  HL,0
0000B8 80B8 065C             7      LD  B,05CH
0000BA 80BA 3E                      DB  03EH    ;LD A,??
0000BB 80BB EF              12      RST 28H
0000BC 80BC CDEFDB          17      CALL    FILL_MEMORY
0000BF 80BF 06A4             7      LD  B,0A4H
0000C1 80C1 AF               4      XOR A
0000C2 80C2 CDEFDB          17      CALL    FILL_MEMORY
                                
0000C5 80C5 3EC3             7      LD  A,0C3H      ;JP
0000C7 80C7 2103F0          10      LD  HL,CPM_WBOOT
0000CA 80CA 320000          13      LD  (00000H),A
0000CD 80CD 220100          16      LD  (00001H),HL ;IPL
                                
0000D0 80D0 21011D          10      LD  HL,MACW     ;3 bit7  DPB Compatible LA(1)
0000D3 80D3 220300          16      LD  (00003H),HL ;  bit6-0 Machine
                                ;               ;4 LSX-Dodgers(01DH)
0000D6 80D6 2106CF          10      LD  HL,BDOS
0000D9 80D9 320500          13      LD  (00005H),A
0000DC 80DC 220600          16      LD  (00006H),HL ;BDOS
                                
0000DF 80DF 21D9FF          10      LD  HL,TRAP38   ;TRAP38
0000E2 80E2 322800          13      LD  (00028H),A
0000E5 80E5 222900          16      LD  (00029H),HL ;RST 028H
                                
0000E8 80E8 323800          13      LD  (00038H),A
0000EB 80EB 211ACF          10      LD  HL,IO_INT8253
0000EE 80EE 223900          16      LD  (00039H),HL
                                
0000F1 80F1 3EF0             7      LD  A,CPM_BOOT/256
0000F3 80F3 320B00          13      LD  (0000BH),A
                                
0000F6 80F6 3EE9             7      LD  A,0E9H      ;JP (HL)
0000F8 80F8 320F00          13      LD  (0000FH),A
                                
0000FB 80FB DD2180F2        14      LD  IX,EMMFL
0000FF 80FF CD4381          17      CALL    CHECK_EMM_BPB
000102 8102 FEEB             7      CP  0EBH
000104 8104 2810            12      JR  Z,EMM_BPB
000106 8106 DD360D02        19      LD  (IX+DPB_MAXSEC),2   ;BPBが512バイト目から始まる場合を調べる
00010A 810A CD4381          17      CALL    CHECK_EMM_BPB
00010D 810D DDBE06           7      CP  (IX+DPB_FATID)
000110 8110 2004            12      JR  NZ,EMM_BPB
000112 8112 DD360D00        19      LD  (IX+DPB_MAXSEC),0   ;BPBが先頭の場合に戻す
       8116                     EMM_BPB:
000116 8116 215A81          10      LD  HL,INIMES
000119 8119 CD86D4          17      CALL    MSX
       811C                     INIT1:
00011C 811C F3               4      DI
00011D 811D 1100FF          10      LD  DE,0FF00H
000120 8120 0600             7      LD  B,0
000122 8122 CD23D3          17      CALL    ZERO_MEMORY_DE
000125 8125 21CAFF          10      LD  HL,EXTBIO
000128 8128 36C9            10      LD  (HL),0C9H   ;RET
00012A 812A 23               6      INC HL
00012B 812B 060E             7      LD  B,TRAP38-EXTBIO-1
00012D 812D 3E                      DB  03EH    ;LD A,??
00012E 812E EF              12      RST 28H
00012F 812F CDEFDB          17      CALL    FILL_MEMORY
000132 8132 218C81          10      LD  HL,AT_TRAP38
000135 8135 11D9FF          10      LD  DE,TRAP38
000138 8138 012700          10      LD  BC,AT_TRAPE-AT_TRAP38
00013B 813B EDB0                    LDIR
                                
00013D 813D CDCADA          17      CALL    CHKEY
000140 8140 FE03             7      CP  3
000142 8142 C9              10      RET
                                
       8143                     CHECK_EMM_BPB:
000143 8143 D5              11      PUSH    DE
000144 8144 110000          10      LD  DE,0
000147 8147 CD3EEA          17      CALL    EADR
00014A 814A D1              10      POP DE
00014B 814B ED78            12      IN  A,(C)
00014D 814D C9              10      RET
                                
00014E 814E 4155544F45584543    AUTOD:  DB  "AUTOEXEC "
            20                  
000157 8157 413A00              AUTODV: DB  "A:",0
                                
00015A 815A 0C4C53582D446F64    INIMES: DB  00CH,"LSX-Dodgers for MZ-700/1500 v"
            6765727320666F72    
            204D5A2D3730302F    
            313530302076        
000178 8178 312E                    DB  030H + VER_1, '.'
00017A 817A 3538                    DB  030H + VER_2 ,030H + VER_3
                                ;   DB  ""
00017C 817C 2047616B750D0A          DB  ' Gaku',0DH,0AH
000183 8183 00                      DB  0
                                
       8184                     M7BEEPD:
000184 8184 0801                    DB  8,1
000186 8186 0736                    DB  7,036H
000188 8188 04F9                    DB  4,0F9H
00018A 818A 0403                    DB  4,3
       818C                     M7BEEPE:
                                
       818C                     AT_TRAP38:
00018C FFD9                         ORG TRAP38,AT_TRAP38-OFFSET
00018C FFD9 210000          10      LD  HL,0
00018F FFDC E3              19      EX  (SP),HL
000190 FFDD 3E24             7      LD  A,'$'
000192 FFDF CD12D7          17      CALL    MSG_A
000195 FFE2 2B               6      DEC HL
000196 FFE3 7C               4      LD  A,H
000197 FFE4 CDE8FF          17      CALL    PRHX
00019A FFE7 7D               4      LD  A,L
       FFE8                     PRHX:
00019B FFE8 F5              11      PUSH    AF
00019C FFE9 07               4      RLCA
00019D FFEA 07               4      RLCA
00019E FFEB 07               4      RLCA
00019F FFEC 07               4      RLCA
0001A0 FFED CDF1FF          17      CALL    PRHX2
0001A3 FFF0 F1              10      POP AF
       FFF1                     PRHX2:
0001A4 FFF1 E60F             7      AND 00FH
0001A6 FFF3 FE0A             7      CP  10
0001A8 FFF5 3F               4      CCF
0001A9 FFF6 CE30             7      ADC A,'0'
0001AB FFF8 27               4      DAA
0001AC FFF9 C312D7          10      JP  MSG_A
0001AF FFFC                         DS  4
       81B3                         ORG $$+OFFSET   ;$DEPHASE
       81B3                     AT_TRAPE:
                                
       81B3                     INITE:
0001B3 CF06                         ORG BDOS,INITE-OFFSET
                                
0001B3 CF06 C309CF          10      JP  IO_BDOS
[EOF:M7INIT.ASM:SHIFT_JIS]
                                    INCLUDE "M7BANK.ASM"
                                
                                ;   LSX-Dodgers IO
                                ;   MZ-700/1500
                                ;   VRAM/KEY/TIMER(0D000H-0EFFFH)にアクセスするので0D000H-0FFFFHに置けない部分
                                ;
                                
       CF09                     IO_BDOS:
0001B6 CF09 D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
0001B8 CF0B C345D4          10      JP  BDOS0
                                
       CF0E                     RDKEYDATA:
0001BB CF0E F3               4      DI
0001BC CF0F D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
0001BE CF11 3200E0          13      LD  (0E000H),A
0001C1 CF14 3A01E0          13      LD  A,(E001H)
0001C4 CF17 D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
0001C6 CF19 FB               4      EI
       CF1A                     IO_INT8253:
0001C7 CF1A C9              10      RET
                                
       CF1B                     RD556VSYNC:
0001C8 CF1B F3               4      DI
0001C9 CF1C D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
0001CB CF1E 3A02E0          13      LD  A,(0E002H)
0001CE CF21 D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
0001D0 CF23 FB               4      EI
0001D1 CF24 C9              10      RET
                                
       CF25                     RDMMIO:
0001D2 CF25 F3               4      DI
0001D3 CF26 D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
0001D5 CF28 7E               7      LD  A,(HL)
0001D6 CF29 D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
0001D8 CF2B FB               4      EI
0001D9 CF2C C9              10      RET
                                
       CF2D                     WRMMIO:
0001DA CF2D F3               4      DI
0001DB CF2E D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
0001DD CF30 77               7      LD  (HL),A
0001DE CF31 D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
0001E0 CF33 FB               4      EI
0001E1 CF34 C9              10      RET
                                
       CF35                     RDMMIO_BC:
0001E2 CF35 F3               4      DI
0001E3 CF36 D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
0001E5 CF38 0A               7      LD  A,(BC)
0001E6 CF39 D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
0001E8 CF3B FB               4      EI
0001E9 CF3C C9              10      RET
                                
       CF3D                     WRMMIO_BC:
0001EA CF3D F3               4      DI
0001EB CF3E D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
0001ED CF40 02               7      LD  (BC),A
0001EE CF41 D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
0001F0 CF43 FB               4      EI
0001F1 CF44 C9              10      RET
                                
       CF45                     IO_PRINT:
0001F2 CF45 F3               4      DI
0001F3 CF46 D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
0001F5 CF48 77               7      LD  (HL),A
0001F6 CF49 CBDC             8      SET 3,H
0001F8 CF4B 71               7      LD  (HL),C
0001F9 CF4C D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
0001FB CF4E FB               4      EI
0001FC CF4F C9              10      RET
                                
       CF50                     IO_CLR:
0001FD CF50 F3               4      DI
0001FE CF51 D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
       CF53                     C1AX1:
000200 CF53 7A               4      LD  A,D
000201 CF54 C6D0             7      ADD A,0D0H
000203 CF56 57               4      LD  D,A
000204 CF57 AF               4      XOR A
000205 CF58 12               7      LD  (DE),A      ;Text
000206 CF59 CBDA             8      SET 3,D
       CF5C                     ICSMC   EQU $+1
000208 CF5B 3E00             7      LD  A,0     ;自己書き換え
00020A CF5D 12               7      LD  (DE),A      ;Color
00020B CF5E 13               6      INC DE
00020C CF5F 7A               4      LD  A,D
00020D CF60 D6D8             7      SUB 0D8H
00020F CF62 57               4      LD  D,A
000210 CF63 2118FC          10      LD  HL,0-WIDTH*LINE
000213 CF66 19              11      ADD HL,DE
000214 CF67 30EA            12      JR  NC,C1AX1
000216 CF69 E1              10      POP HL
000217 CF6A D1              10      POP DE
000218 CF6B D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
00021A CF6D FB               4      EI
00021B CF6E C9              10      RET
                                
       CF6F                     IO_CLLINE:
00021C CF6F F3               4      DI
00021D CF70 D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
       CF72                     CLLINE1:
00021F CF72 CB9C             8      RES 3,H
000221 CF74 77               7      LD  (HL),A      ;Text
000222 CF75 CBDC             8      SET 3,H
000224 CF77 71               7      LD  (HL),C      ;Color
000225 CF78 23               6      INC HL
000226 CF79 10F7            13      DJNZ    CLLINE1
000228 CF7B D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
00022A CF7D FB               4      EI
00022B CF7E C9              10      RET
                                
       CF7F                     IO_INS:
00022C CF7F F3               4      DI
00022D CF80 D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
       CF82                     IO_INS1:
00022F CF82 CD99CF          17      CALL    C12S
000232 CF85 23               6      INC HL
000233 CF86 10FA            13      DJNZ    IO_INS1
000235 CF88 D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
000237 CF8A FB               4      EI
000238 CF8B C9              10      RET
                                
       CF8C                     IO_BS:
000239 CF8C F3               4      DI
00023A CF8D D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
       CF8F                     IO_BS1:
00023C CF8F CD99CF          17      CALL    C12S
00023F CF92 2B               6      DEC HL
000240 CF93 10F7            13      DJNZ    IO_BS
000242 CF95 D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
000244 CF97 FB               4      EI
000245 CF98 C9              10      RET
                                
       CF99                     C12S:
000246 CF99 CB9C             8      RES 3,H
000248 CF9B 5E               7      LD  E,(HL)
000249 CF9C 77               7      LD  (HL),A
00024A CF9D 7B               4      LD  A,E
00024B CF9E CBDC             8      SET 3,H
00024D CFA0 5E               7      LD  E,(HL)
00024E CFA1 71               7      LD  (HL),C
00024F CFA2 4B               4      LD  C,E
000250 CFA3 C9              10      RET
                                
       CFA4                     IO_SCRUP:
000251 CFA4 F3               4      DI
000252 CFA5 D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
       CFA7                     SCRUP1:
000254 CFA7 2815            12      JR  Z,SCRCL
000256 CFA9 D5              11      PUSH    DE
000257 CFAA E5              11      PUSH    HL
000258 CFAB CBDA             8      SET 3,D
00025A CFAD CBDC             8      SET 3,H
00025C CFAF 012800          10      LD  BC,WIDTH
00025F CFB2 EDB0                    LDIR
000261 CFB4 E1              10      POP HL
000262 CFB5 D1              10      POP DE
000263 CFB6 012800          10      LD  BC,WIDTH
000266 CFB9 EDB0                    LDIR
000268 CFBB 3D               4      DEC A
000269 CFBC 18E9            12      JR  SCRUP1
                                
       CFBE                     SCRCL:
00026B CFBE 0628             7      LD  B,WIDTH
00026D CFC0 EB               4      EX  DE,HL
00026E CFC1 D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
000270 CFC3 CD08D9          17      CALL    CLLINE
000273 CFC6 E1              10      POP HL
000274 CFC7 D1              10      POP DE
000275 CFC8 C1              10      POP BC
000276 CFC9 C9              10      RET
                                
       CFCA                     C_MON:
000277 CFCA D3E4            11      OUT (0E4H),A    ;MONITOR ROM(0000H-0FFFH) & VRAM/KEY/TIMER(D000H-FFFFH)
000279 CFCC C7              12      RST 0
                                
       CFCD                     BANKE:
00027A CFCD                         DS  0CFFEH-BANKE
[EOF:M7BANK.ASM:SHIFT_JIS]
                                    INCLUDE "M7CCP.ASM"
                                
                                ;   LSX-Dodgers CCP
                                ;   MZ-700/1500
                                
       CFFE                     WBOOT1:
0002AB CFFE D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)　ここは0CFFEH
0002AD D000 D3E0            11      OUT (0E0H),A    ;DRAM(0000H-0FFHH)
0002AF D002 F3               4      DI
0002B0 D003 3A94F0          13      LD  A,(_KEYSP)
0002B3 D006 ED7B0600        20      LD  SP,(SYSTEM+1)
0002B7 D00A FB               4      EI
0002B8 D00B 2192F0          10      LD  HL,_KEYD
0002BB D00E 3600            10      LD  (HL),0
0002BD D010 CDCADA          17      CALL    CHKEY
0002C0 D013 CD0ED7          17      CALL    KEYBC_IFBREAK
0002C3 D016 3E04             7      LD  A,4
0002C5 D018 CD12D7          17      CALL    MSG_A
[EOF:M7CCP.ASM:UTF_8]
                                    INCLUDE "LDCCP.ASM"
                                
                                ;   LSX-Dodgers CCP
                                
       D01B                     COMMAND:
0002C8 D01B 3A03EB          13      LD  A,(FCB_BAT)
0002CB D01E B7               4      OR  A
0002CC D01F C260D1          10      JP  NZ,C_BAT1
0002CF D022 CDD5D0          17      CALL    SETDTA1
0002D2 D025 3A87F0          13      LD  A,(_DVSW)
0002D5 D028 C641             7      ADD A,'A'
0002D7 D02A CD12D7          17      CALL    MSG_A
0002DA D02D 3E3E             7      LD  A,'>'
0002DC D02F CD12D7          17      CALL    MSG_A
0002DF D032 3E50             7      LD  A,80
0002E1 D034 12               7      LD  (DE),A
0002E2 D035 CD6ED7          17      CALL    _SYS0A      ;(BDOS)文字列入力
0002E5 D038 CD55D2          17      CALL    LTNL
       D03B                     COMMAND2:
0002E8 D03B 118200          10      LD  DE,DTA1+2
0002EB D03E CDFDF0          17      CALL    _COMANL
0002EE D041 30D8            12      JR  NC,COMMAND
0002F0 D043 1179F0          10      LD  DE,COMERM
0002F3 D046 CD77D4          17      CALL    _SYS09      ;(BDOS)文字列出力
0002F6 D049 C7              12      RST 0
                                
       D04A                     COMANL:
0002F7 D04A CD43DB          17      CALL    FILE
0002FA D04D 3A19F0          13      LD  A,(FNAME+4)
0002FD D050 FE20             7      CP  020H
0002FF D052 201C            12      JR  NZ,COMB2
000301 D054 D5              11      PUSH    DE
000302 D055 1115F0          10      LD  DE,FNAME
000305 D058 1A               7      LD  A,(DE)
000306 D059 FE20             7      CP  020H
000308 D05B 2844            12      JR  Z,SDVSW
00030A D05D 1B               6      DEC DE
00030B D05E 1A               7      LD  A,(DE)
00030C D05F C6FF             7      ADD A,0FFH
00030E D061 3809            12      JR  C,COMB
000310 D063 13               6      INC DE
                                
000311 D064 210FD4          10      LD  HL,COMTB
000314 D067 0609             7      LD  B,COMS
000316 D069 CDC7DD          17      CALL    CPNAME
       D06C                     COMB:
000319 D06C D1              10      POP DE
00031A D06D D20F00          10      JP  NC,JP_HL
       D070                     COMB2:
00031D D070 EB               4      EX  DE,HL
00031E D071 223DD1          16      LD  (COMPAT+1),HL
000321 D074 F5              11      PUSH    AF
000322 D075 CDF5D0          17      CALL    CEXE4
000325 D078 F1              10      POP AF
000326 D079 2115F0          10      LD  HL,FNAME
000329 D07C 116D00          10      LD  DE,FCB2+1   ;COMMAND NAME
00032C D07F 010B00          10      LD  BC,11
00032F D082 EDB0                    LDIR
000331 D084 11A2EA          10      LD  DE,PATHD
       D087                     CEX1:
000334 D087 1A               7      LD  A,(DE)
000335 D088 FE20             7      CP  020H
000337 D08A D8              11      RET C
000338 D08B CD38DB          17      CALL    FILEC
00033B D08E D5              11      PUSH    DE
00033C D08F 216D00          10      LD  HL,FCB2+1   ;COMMAND NAME
00033F D092 1115F0          10      LD  DE,FNAME
000342 D095 010B00          10      LD  BC,11
000345 D098 EDB0                    LDIR
000347 D09A CDF5D0          17      CALL    CEXE4
00034A D09D D1              10      POP DE
00034B D09E 13               6      INC DE
00034C D09F 18E6            12      JR  CEX1
                                
       D0A1                     SDVSW:
00034E D0A1 F1              10      POP AF
00034F D0A2 3A14F0          13      LD  A,(FDRV)
000352 D0A5 3D               4      DEC A
000353 D0A6 5F               4      LD  E,A
000354 D0A7 0E0E             7      LD  C,00EH      ;(BDOS)カレントドライブの設定
000356 D0A9 1831            12      JR  SYSTEM0
                                
       D0AB                     OPEN1:
000358 D0AB 2114F0          10      LD  HL,FDRV
       D0AE                     OPEN:
00035B D0AE 0E11             7      LD  C,011H      ;(BDOS)ファイルの検索
       D0B0                     OPEN3:
00035D D0B0 D5              11      PUSH    DE
00035E D0B1 11DEEA          10      LD  DE,DTA_CCP
000361 D0B4 CDD2D0          17      CALL    SETDTA
000364 D0B7 EB               4      EX  DE,HL
000365 D0B8 CDDCD0          17      CALL    SYSTEM0
000368 D0BB D1              10      POP DE
000369 D0BC C9              10      RET
                                
       D0BD                     OPEN2:
00036A D0BD 0E12             7      LD  C,012H
00036C D0BF 18EF            12      JR  OPEN3
                                
       D0C1                     DEFCB:              ;Z=Ok NZ=Error
00036E D0C1 11DEEA          10      LD  DE,DTA_CCP
000371 D0C4 CDDAD0          17      CALL    SYSC0F
                                
000374 D0C7 11FFEA          10      LD  DE,DTA_CCP+33   ;(FCB)ランダムレコード
000377 D0CA 0604             7      LD  B,4
000379 D0CC CD23D3          17      CALL    ZERO_MEMORY_DE
       D0CF                     SETDTA100:
00037C D0CF 110001          10      LD  DE,00100H
       D0D2                     SETDTA:
00037F D0D2 C34FD6          10      JP  _SYS1A      ;(BDOS)DTAの設定
                                
       D0D5                     SETDTA1:
000382 D0D5 118000          10      LD  DE,DTA1
000385 D0D8 18F8            12      JR  SETDTA
                                
       D0DA                     SYSC0F:
000387 D0DA 0E0F             7      LD  C,00FH      ;(BDOS)ファイルのオープン
       D0DC                     SYSTEM0:
000389 D0DC CD0500          17      CALL    SYSTEM
00038C D0DF B7               4      OR  A
00038D D0E0 C9              10      RET
                                
       D0E1                     C_CD:
00038E D0E1 0E5A             7      LD  C,5AH
000390 D0E3 18F7            12      JR  SYSTEM0
                                
       D0E5                     S27BUF:
000392 D0E5 3A0700          13      LD  A,(SYSTEM+2)
000395 D0E8 3D               4      DEC A
000396 D0E9 E6F8             7      AND 0F8H
000398 D0EB 67               4      LD  H,A
000399 D0EC 2E00             7      LD  L,0
       D0EE                     S27DTA:
00039B D0EE 11DEEA          10      LD  DE,DTA_CCP
       D0F1                     S27:
00039E D0F1 0E27             7      LD  C,027H      ;(BDOS)ランダムブロック読み込み
0003A0 D0F3 18E7            12      JR  SYSTEM0
                                
       D0F5                     CEXE4:
0003A2 D0F5 211DF0          10      LD  HL,FNAME+8
0003A5 D0F8 7E               7      LD  A,(HL)
0003A6 D0F9 FE20             7      CP  020H
0003A8 D0FB 2007            12      JR  NZ,CEXE7
0003AA D0FD 3E3F             7      LD  A,'?'
0003AC D0FF 77               7      LD  (HL),A
0003AD D100 23               6      INC HL
0003AE D101 77               7      LD  (HL),A
0003AF D102 23               6      INC HL
0003B0 D103 77               7      LD  (HL),A
       D104                     CEXE7:
0003B1 D104 CDABD0          17      CALL    OPEN1
       D107                     CEXE5:
0003B4 D107 C0              11      RET NZ
0003B5 D108 2AE8EA          16      LD  HL,(DTA_CCP+1+9)
0003B8 D10B 7C               4      LD  A,H
0003B9 D10C CD4FDE          17      CALL    CAP
0003BC D10F 67               4      LD  H,A
0003BD D110 7D               4      LD  A,L
0003BE D111 CD4FDE          17      CALL    CAP
0003C1 D114 6F               4      LD  L,A
0003C2 D115 3AE7EA          13      LD  A,(DTA_CCP+1+8)
0003C5 D118 CD4FDE          17      CALL    CAP
0003C8 D11B D642             7      SUB 'B'
0003CA D11D 282C            12      JR  Z,C_BAT
0003CC D11F 3D               4      DEC A       ;'C'
0003CD D120 2805            12      JR  Z,C_EXE
       D122                     CEXE6:
0003CF D122 CDBDD0          17      CALL    OPEN2
0003D2 D125 18E0            12      JR  CEXE5
                                
       D127                     C_EXE:
0003D4 D127 7C               4      LD  A,H
0003D5 D128 FE4D             7      CP  'M'
0003D7 D12A 20F6            12      JR  NZ,CEXE6
                                
0003D9 D12C CDC1D0          17      CALL    DEFCB
0003DC D12F CDE5D0          17      CALL    S27BUF
0003DF D132 3D               4      DEC A
0003E0 D133 37               4      SCF
0003E1 D134 C0              11      RET NZ
0003E2 D135 7C               4      LD  A,H
0003E3 D136 B5               4      OR  L
0003E4 D137 37               4      SCF
0003E5 D138 C8              11      RET Z
0003E6 D139 CDD5D0          17      CALL    SETDTA1
0003E9 D13C 110000          10  COMPAT: LD  DE,0                ; self-modifying code
0003EC D13F ED7B0600        20      LD  SP,(SYSTEM+1)
0003F0 D143 67               4      LD  H,A             ; A=0 in SETDTA1(_SYS1A)
0003F1 D144 6F               4      LD  L,A
0003F2 D145 E5              11      PUSH    HL              ; push $0000 (reboot address)
0003F3 D146 24               4      INC H
0003F4 D147 E5              11      PUSH    HL              ; push $0100 (TPA address)
0003F5 D148 C3EED2          10      JP  SETFCB              ; and JP $0100
                                
       D14B                     C_BAT:
0003F8 D14B 114154          10      LD  DE,'A'+'T'*256
0003FB D14E ED52            15      SBC HL,DE
0003FD D150 20D0            12      JR  NZ,CEXE6
                                
0003FF D152 CDC1D0          17      CALL    DEFCB
                                
000402 D155 21DEEA          10      LD  HL,DTA_CCP
000405 D158 1103EB          10      LD  DE,FCB_BAT
000408 D15B 012500          10      LD  BC,37
00040B D15E EDB0                    LDIR
       D160                     C_BAT1:
00040D D160 CDCFD0          17      CALL    SETDTA100
000410 D163 CD97D1          17      CALL    FGETC_BAT
000413 D166 218100          10      LD  HL,DTA1+1
000416 D169 2025            12      JR  NZ,END_BATCH
000418 D16B FE21             7      CP  021H        ;スペースや改行など制御文字を飛ばす
00041A D16D 38F1            12      JR  C,C_BAT1
00041C D16F 3620            10      LD  (HL),' '
00041E D171 23               6      INC HL
       D172                     C_BAT2:
00041F D172 77               7      LD  (HL),A
000420 D173 23               6      INC HL
000421 D174 7D               4      LD  A,L
000422 D175 3C               4      INC A       ;L==0FFH
000423 D176 2809            12      JR  Z,RUN_BATCH
000425 D178 CD97D1          17      CALL    FGETC_BAT
000428 D17B 2004            12      JR  NZ,RUN_BATCH
00042A D17D FE20             7      CP  020H
00042C D17F 30F1            12      JR  NC,C_BAT2
       D181                     RUN_BATCH:
00042E D181 7D               4      LD  A,L
00042F D182 D67F             7      SUB DTA1-1
000431 D184 328000          13      LD  (DTA1),A
000434 D187 FE04             7      CP  4
000436 D189 3805            12      JR  C,END_BATCH
000438 D18B 3600            10      LD  (HL),0
00043A D18D C33BD0          10      JP  COMMAND2
       D190                     END_BATCH:
00043D D190 AF               4      XOR A       ;バッチファイルを閉じる
00043E D191 3203EB          13      LD  (FCB_BAT),A
000441 D194 C300F0          10      JP  CPM_BOOT
                                
       D197                     FGETC_BAT:
000444 D197 1103EB          10      LD  DE,FCB_BAT
       D19A                     FGETC:              ;1文字ずつ読み込む
000447 D19A E5              11      PUSH    HL      ;Z:成功
000448 D19B 210100          10      LD  HL,1
00044B D19E CDF1D0          17      CALL    S27
00044E D1A1 E1              10      POP HL
00044F D1A2 3A0001          13      LD  A,(00100H)
000452 D1A5 C9              10      RET
                                
       D1A6                     C_DEL:
000453 D1A6 CDEED2          17      CALL    SETFCB
000456 D1A9 CD28D7          17      CALL    _SYS08      ;(BDOS)エコーなしコンソール入力
                                
000459 D1AC 0E13             7      LD  C,013H
00045B D1AE 180A            12      JR  CDEL1       ;(BDOS)ファイルの削除
                                
       D1B0                     C_REN:
00045D D1B0 CDEED2          17      CALL    SETFCB
000460 D1B3 3E10             7      LD  A,010H      ;ディレクトリも対象にする
000462 D1B5 326900          13      LD  (FCB1+13),A ;属性
000465 D1B8 0E17             7      LD  C,017H      ;(BDOS)ファイル名の変更
       D1BA                     CDEL1:
000467 D1BA 115C00          10      LD  DE,FCB1
00046A D1BD CD0500          17      CALL    SYSTEM
00046D D1C0 C6FF             7      ADD A,0FFH
00046F D1C2 C9              10      RET
                                
       D1C3                     C_DIR:
000470 D1C3 CD38DB          17      CALL    FILEC
000473 D1C6 2115F0          10      LD  HL,FDRV+1
000476 D1C9 CD04D4          17      CALL    CWILD1
000479 D1CC 3EF1             7      LD  A,0F1H
00047B D1CE 3221F0          13      LD  (FDRV+13),A
00047E D1D1 CDABD0          17      CALL    OPEN1
       D1D4                     CDIR1:
000481 D1D4 B7               4      OR  A
000482 D1D5 2008            12      JR  NZ,PDSKF
000484 D1D7 CD22D2          17      CALL    P_NAME
000487 D1DA CDBDD0          17      CALL    OPEN2
00048A D1DD 18F5            12      JR  CDIR1
       D1DF                     PDSKF:
00048C D1DF 3A14F0          13      LD  A,(FDRV)
00048F D1E2 5F               4      LD  E,A
000490 D1E3 0E1B             7      LD  C,01BH      ;(BDOS)ディスク情報の獲得
000492 D1E5 CD0500          17      CALL    SYSTEM
000495 D1E8 4F               4      LD  C,A     ;C←1クラスタ辺りの論理セクタ数
000496 D1E9 C601             7      ADD A,001H
000498 D1EB D8              11      RET C       ;Aが0FFHだった場合
000499 D1EC 3E06             7      LD  A,8-2
       D1EE                     PDS1:               ;HL=未使用クラスタの総数
00049B D1EE 3C               4      INC A
00049C D1EF CB19             8      RR  C
00049E D1F1 30FB            12      JR  NC,PDS1
       D1F3                     PDS2:               ;B←論理セクタのサイズの上位8ビット
0004A0 D1F3 3C               4      INC A
0004A1 D1F4 CB18             8      RR  B
0004A3 D1F6 30FB            12      JR  NC,PDS2
0004A5 D1F8 47               4      LD  B,A
                                
0004A6 D1F9 110000          10      LD  DE,0
       D1FC                     PDS3:
0004A9 D1FC 29              11      ADD HL,HL
0004AA D1FD EB               4      EX  DE,HL
0004AB D1FE ED6A            15      ADC HL,HL
0004AD D200 EB               4      EX  DE,HL
0004AE D201 10F9            13      DJNZ    PDS3
       D203                     PDSKF1:
0004B0 D203 CD8CD2          17      CALL    PRDEC_DEHL
0004B3 D206 1133EB          10      LD  DE,FREE
0004B6 D209 CD77D4          17      CALL    _SYS09      ;(BDOS)文字列出力
0004B9 D20C CD7CD2          17      CALL    PUTDRV
0004BC D20F 3E5C             7      LD  A,05CH      ;\
0004BE D211 CD12D7          17      CALL    MSG_A
0004C1 D214 2A22F0          16      LD  HL,(FDRV+14)    ;ディレクトリのクラスタ番号
0004C4 D217 AF               4      XOR A
0004C5 D218 11FEFF          10      LD  DE,0-2
0004C8 D21B 19              11      ADD HL,DE
0004C9 D21C 23               6      INC HL
0004CA D21D DC89D2          17      CALL    C,PRDEC_HL
0004CD D220 1833            12      JR  LTNL
                                
       D222                     P_NAME:
0004CF D222 3ADFEA          13      LD  A,(DTA_CCP+1)
0004D2 D225 FE2E             7      CP  '.'
0004D4 D227 C8              11      RET Z
                                
0004D5 D228 3AEAEA          13      LD  A,(DTA_CCP+1+00BH)
0004D8 D22B F5              11      PUSH    AF
0004D9 D22C CB67             8      BIT 4,A
0004DB D22E 2808            12      JR  Z,DIR3
0004DD D230 1128EB          10      LD  DE,DIRMES
0004E0 D233 CD77D4          17      CALL    _SYS09      ;(BDOS)文字列出力
0004E3 D236 180A            12      JR  DIR6
       D238                     DIR3:
0004E5 D238 ED5BFDEA        20      LD  DE,(DTA_CCP+1+01EH)
0004E9 D23C 2AFBEA          16      LD  HL,(DTA_CCP+1+01CH)
0004EC D23F CD8CD2          17      CALL    PRDEC_DEHL
       D242                     DIR6:
0004EF D242 F1              10      POP AF
0004F0 D243 0F               4      RRCA
0004F1 D244 9F               4      SBC A,A
0004F2 D245 E60A             7      AND '*'-020H
0004F4 D247 C620             7      ADD A,020H
0004F6 D249 CD12D7          17      CALL    MSG_A
0004F9 D24C CD7CD2          17      CALL    PUTDRV
0004FC D24F 21DFEA          10      LD  HL,DTA_CCP+1
0004FF D252 CDCCD2          17      CALL    FPRNT
                                
       D255                     LTNL:
000502 D255 1E03             7      LD  E,3
000504 D257 C3CDF0          10      JP  _PRINT
                                
       D25A                     C_PATH:
000507 D25A CD1ADC          17      CALL    SPCUT
00050A D25D 21A2EA          10      LD  HL,PATHD
00050D D260 FE21             7      CP  021H
00050F D262 300C            12      JR  NC,CPATH0
       D264                     CPATHP:
000511 D264 7E               7      LD  A,(HL)
000512 D265 23               6      INC HL
000513 D266 FE20             7      CP  020H
000515 D268 3F               4      CCF
000516 D269 30EA            12      JR  NC,LTNL
000518 D26B CD12D7          17      CALL    MSG_A
00051B D26E 18F4            12      JR  CPATHP
       D270                     CPATH0:
00051D D270 FE3B             7      CP  ';'
00051F D272 2001            12      JR  NZ,CPATH1
000521 D274 13               6      INC DE
       D275                     CPATH1:
000522 D275 EB               4      EX  DE,HL
000523 D276 013B00          10      LD  BC,PATHX
000526 D279 EDB0                    LDIR
000528 D27B C9              10      RET
                                
       D27C                     PUTDRV:
000529 D27C 3A14F0          13      LD  A,(FDRV)
00052C D27F C640             7      ADD A,'A'-1
00052E D281 CD12D7          17      CALL    MSG_A
000531 D284 3E3A             7      LD  A,':'
       D286                     MSG_AR:
000533 D286 C312D7          10      JP  MSG_A
                                
       D289                     PRDEC_HL:
000536 D289 AF               4      XOR A
000537 D28A 5F               4      LD  E,A
000538 D28B 57               4      LD  D,A
       D28C                     PRDEC_DEHL:
000539 D28C D5              11      PUSH    DE
00053A D28D 110FF0          10      LD  DE,DECBF
00053D D290 0605             7      LD  B,5
00053F D292 CD23D3          17      CALL    ZERO_MEMORY_DE  ;A=0
000542 D295 D1              10      POP DE
                                
000543 D296 0E20             7      LD  C,32
       D298                     DEC1:
000545 D298 29              11      ADD HL,HL
000546 D299 EB               4      EX  DE,HL
000547 D29A ED6A            15      ADC HL,HL
000549 D29C EB               4      EX  DE,HL
00054A D29D E5              11      PUSH    HL
00054B D29E 2113F0          10      LD  HL,DECBF+4
00054E D2A1 0605             7      LD  B,5
       D2A3                     DEC2:
000550 D2A3 7E               7      LD  A,(HL)
000551 D2A4 8F               4      ADC A,A
000552 D2A5 27               4      DAA
000553 D2A6 77               7      LD  (HL),A
000554 D2A7 2B               6      DEC HL
000555 D2A8 10F9            13      DJNZ    DEC2
000557 D2AA E1              10      POP HL
000558 D2AB 0D               4      DEC C
000559 D2AC 20EA            12      JR  NZ,DEC1
                                
00055B D2AE 210FF0          10      LD  HL,DECBF
00055E D2B1 3E20             7      LD  A,020H
000560 D2B3 0604             7      LD  B,4
       D2B5                     DEC3:
000562 D2B5 CDC2D2          17      CALL    DEC4
000565 D2B8 CDC2D2          17      CALL    DEC4
000568 D2BB 23               6      INC HL
000569 D2BC 10F7            13      DJNZ    DEC3
       D2BE                     DECX:
00056B D2BE CDC2D2          17      CALL    DEC4
00056E D2C1 AF               4      XOR A
       D2C2                     DEC4:
00056F D2C2 ED6F            18      RLD
000571 D2C4 FE20             7      CP  020H
000573 D2C6 2802            12      JR  Z,DEC5
000575 D2C8 F630             7      OR  030H
       D2CA                     DEC5:
000577 D2CA 18BA            12      JR  MSG_AR
                                
       D2CC                     FPRNT:
000579 D2CC 0608             7      LD  B,8 ;ファイル名を表示
00057B D2CE CDDDD2          17      CALL    P_N1
00057E D2D1 7E               7      LD  A,(HL)
00057F D2D2 CD5BDE          17      CALL    CAP3
000582 D2D5 D8              11      RET C   ;拡張子が無い
                                
000583 D2D6 3E2E             7      LD  A,'.'
000585 D2D8 CD12D7          17      CALL    MSG_A
000588 D2DB 0603             7      LD  B,3 ;拡張子を表示
       D2DD                     P_N1:
00058A D2DD 7E               7      LD  A,(HL)
00058B D2DE CD5BDE          17      CALL    CAP3
00058E D2E1 3807            12      JR  C,P_N2
000590 D2E3 CD12D7          17      CALL    MSG_A
000593 D2E6 23               6      INC HL
000594 D2E7 10F4            13      DJNZ    P_N1
000596 D2E9 C9              10      RET
       D2EA                     P_N2:
000597 D2EA 23               6      INC HL
000598 D2EB 10FD            13      DJNZ    P_N2
00059A D2ED C9              10      RET
                                
       D2EE                     SETFCB:
00059B D2EE CD1ADC          17      CALL    SPCUT
00059E D2F1 1A               7      LD  A,(DE)
00059F D2F2 FE20             7      CP  020H
0005A1 D2F4 3801            12      JR  C,SETFCBA
0005A3 D2F6 1B               6      DEC DE
       D2F7                     SETFCBA:
0005A4 D2F7 0624             7      LD  B,36
0005A6 D2F9 215C00          10      LD  HL,FCB1
0005A9 D2FC E5              11      PUSH    HL
0005AA D2FD AF               4      XOR A
0005AB D2FE CDEFDB          17      CALL    FILL_MEMORY
0005AE D301 E1              10      POP HL
0005AF D302 D5              11      PUSH    DE
0005B0 D303 CDB5D6          17      CALL    _SYS29      ;(BDOS)ファイル名の解析
0005B3 D306 216C00          10      LD  HL,FCB2
0005B6 D309 CDB5D6          17      CALL    _SYS29      ;(BDOS)ファイル名の解析
0005B9 D30C E1              10      POP HL
0005BA D30D 010050          10      LD  BC,05000H
0005BD D310 118100          10      LD  DE,00081H
       D313                     SETFCB1:
0005C0 D313 7E               7      LD  A,(HL)
0005C1 D314 23               6      INC HL
0005C2 D315 FE20             7      CP  020H
0005C4 D317 3805            12      JR  C,SETFCB2
0005C6 D319 12               7      LD  (DE),A
0005C7 D31A 13               6      INC DE
0005C8 D31B 0C               4      INC C
0005C9 D31C 10F5            13      DJNZ    SETFCB1
       D31E                     SETFCB2:
0005CB D31E 79               4      LD  A,C
0005CC D31F 328000          13      LD  (DTA1),A
0005CF D322 04               4      INC B
       D323                     ZERO_MEMORY_DE:
0005D0 D323 AF               4      XOR A
       D324                     FILL_MEMORY_DE:
0005D1 D324 12               7      LD  (DE),A
0005D2 D325 13               6      INC DE
0005D3 D326 10FC            13      DJNZ    FILL_MEMORY_DE
0005D5 D328 C9              10      RET
                                
       D329                     C_COPY:
0005D6 D329 CDEED2          17      CALL    SETFCB
                                
0005D9 D32C 1161F0          10      LD  DE,ZERO
0005DC D32F CD3BDB          17      CALL    FILEC2
0005DF D332 216C00          10      LD  HL,FCB2
0005E2 D335 CDBCD6          17      CALL    S29X1
                                
0005E5 D338 3E10             7      LD  A,010H
0005E7 D33A 326900          13      LD  (FCB1+13),A
0005EA D33D 216D00          10      LD  HL,FCB2+1
0005ED D340 CD04D4          17      CALL    CWILD1
       D343                     COPY0:
0005F0 D343 CD01D4          17      CALL    CWILD
0005F3 D346 215C00          10      LD  HL,FCB1
0005F6 D349 CDAED0          17      CALL    OPEN
0005F9 D34C 37               4      SCF
       D34D                     COPY1:
0005FA D34D C0              11      RET NZ
0005FB D34E CDC1D0          17      CALL    DEFCB
                                
0005FE D351 3AEBEA          13      LD  A,(DTA_CCP+13)
000601 D354 CB67             8      BIT 4,A
000603 D356 2821            12      JR  Z,COPY1A
                                
000605 D358 215D00          10      LD  HL,FCB1+1
000608 D35B CD79DF          17      CALL    CHKWILD
00060B D35E 3814            12      JR  C,COPY9
                                
00060D D360 3E20             7      LD  A,020H
00060F D362 325D00          13      LD  (FCB1+1),A
000612 D365 2AF8EA          16      LD  HL,(DTA_CCP+26)
000615 D368 23               6      INC HL
000616 D369 226A00          16      LD  (FCB1+14),HL
000619 D36C 18D5            12      JR  COPY0
                                
       D36E                     COPY8:
00061B D36E CD77D4          17      CALL    _SYS09      ;(BDOS)文字列出力
00061E D371 CD55D2          17      CALL    LTNL
       D374                     COPY9:
000621 D374 CDBDD0          17      CALL    OPEN2
000624 D377 18D4            12      JR  COPY1
                                
       D379                     COPY1A:
000626 D379 216C00          10      LD  HL,FCB2
000629 D37C 1114F0          10      LD  DE,FDRV
00062C D37F 01E0EA          10      LD  BC,DTA_CCP+2
00062F D382 EDA0            16      LDI
000631 D384 3E0B             7      LD  A,11
       D386                     COPY2:
000633 D386 F5              11      PUSH    AF
000634 D387 7E               7      LD  A,(HL)
000635 D388 FE3F             7      CP  '?'
000637 D38A 2001            12      JR  NZ,COPY3
000639 D38C 0A               7      LD  A,(BC)
       D38D                     COPY3:
00063A D38D 12               7      LD  (DE),A
00063B D38E 03               6      INC BC
00063C D38F 13               6      INC DE
00063D D390 23               6      INC HL
00063E D391 F1              10      POP AF
00063F D392 3D               4      DEC A
000640 D393 20F1            12      JR  NZ,COPY2
000642 D395 010500          10      LD  BC,16-11
000645 D398 EDB0                    LDIR
       D39A                     PUTNAME:
000647 D39A 215D00          10      LD  HL,FCB1+1
00064A D39D CD79DF          17      CALL    CHKWILD
00064D D3A0 300B            12      JR  NC,PUTN1
00064F D3A2 2115F0          10      LD  HL,FDRV+1
000652 D3A5 CDCCD2          17      CALL    FPRNT
000655 D3A8 3E20             7      LD  A,020H
000657 D3AA CD12D7          17      CALL    MSG_A
       D3AD                     PUTN1:
00065A D3AD 1114F0          10      LD  DE,FDRV
00065D D3B0 0E16             7      LD  C,016H      ;(BDOS)ファイルの作成
00065F D3B2 CDDCD0          17      CALL    SYSTEM0
000662 D3B5 2048            12      JR  NZ,COPYE2
000664 D3B7 67               4      LD  H,A     ;A=0
000665 D3B8 6F               4      LD  L,A
000666 D3B9 2235F0          16      LD  (FDRV+33),HL    ;(FCB)ランダムレコード
000669 D3BC 2237F0          16      LD  (FDRV+35),HL
       D3BF                     COPY6:
00066C D3BF CDE5D0          17      CALL    S27BUF
00066F D3C2 47               4      LD  B,A
000670 D3C3 3C               4      INC A
000671 D3C4 2831            12      JR  Z,COPYE
000673 D3C6 7C               4      LD  A,H
000674 D3C7 B5               4      OR  L
000675 D3C8 280C            12      JR  Z,COPY7
000677 D3CA 1114F0          10      LD  DE,FDRV
00067A D3CD 0E26             7      LD  C,026H      ;(BDOS)ランダムブロック書き込み
00067C D3CF CDDCD0          17      CALL    SYSTEM0
00067F D3D2 2023            12      JR  NZ,COPYE
000681 D3D4 10E9            13      DJNZ    COPY6
       D3D6                     COPY7:
000683 D3D6 3AEBEA          13      LD  A,(DTA_CCP+13)  ;(FCB)属性
000686 D3D9 3221F0          13      LD  (FDRV+13),A
000689 D3DC 21F2EA          10      LD  HL,DTA_CCP+20   ;(FCB)タイムスタンプ
00068C D3DF 1128F0          10      LD  DE,FDRV+20
00068F D3E2 010400          10      LD  BC,4
000692 D3E5 EDB0                    LDIR
                                
000694 D3E7 1114F0          10      LD  DE,FDRV
000697 D3EA 0E10             7      LD  C,010H      ;(BDOS)ファイルのクローズ
000699 D3EC CDDCD0          17      CALL    SYSTEM0
00069C D3EF 2006            12      JR  NZ,COPYE
                                
00069E D3F1 1171F0          10      LD  DE,OK
0006A1 D3F4 C36ED3          10      JP  COPY8
                                
       D3F7                     COPYE:
0006A4 D3F7 1114F0          10      LD  DE,FDRV
0006A7 D3FA 0E13             7      LD  C,013H      ;(BDOS)ファイルの削除
0006A9 D3FC CD0500          17      CALL    SYSTEM
       D3FF                     COPYE2:
0006AC D3FF 37               4      SCF
0006AD D400 C9              10      RET
                                
       D401                     CWILD:
0006AE D401 215D00          10      LD  HL,FCB1+1
       D404                     CWILD1:
0006B1 D404 7E               7      LD  A,(HL)
0006B2 D405 FE20             7      CP  020H
0006B4 D407 C0              11      RET NZ
       D408                     CWILD2:
0006B5 D408 3E3F             7      LD  A,'?'
0006B7 D40A 060B             7      LD  B,11
0006B9 D40C C3EFDB          10      JP  FILL_MEMORY
                                
       D40F                     COMTB:
0006BC D40F 44202020                DB  "D   "  ;1
0006C0 D413 C3D1                    DW  C_DIR
0006C2 D415 44495220                DB  "DIR "  ;2
0006C6 D419 C3D1                    DW  C_DIR
0006C8 D41B 434F5059                DB  "COPY"  ;3
0006CC D41F 29D3                    DW  C_COPY
0006CE D421 43442020                DB  "CD  "  ;4
0006D2 D425 E1D0                    DW  C_CD
0006D4 D427 44454C20                DB  "DEL "  ;5
0006D8 D42B A6D1                    DW  C_DEL
0006DA D42D 50415448                DB  "PATH"  ;6
0006DE D431 5AD2                    DW  C_PATH
0006E0 D433 52454E20                DB  "REN "  ;7
0006E4 D437 B0D1                    DW  C_REN
0006E6 D439 52454D20                DB  "REM "  ;8
0006EA D43D 74D4                    DW  C_REM
[EOF:LDCCP.ASM:SHIFT_JIS]
                                    INCLUDE "M7CCP2.ASM"
                                
                                ;   LSX-Dodgers CCP2
                                ;   MZ-700/1500
                                
0006EC D43F 4D4F4E20                DB  "MON "  ;10
0006F0 D443 CACF                    DW  C_MON
[EOF:M7CCP2.ASM:UTF_8]
                                    INCLUDE "LDOS.ASM"
                                
                                ;   LSX-Dodgers OS
                                
       D445                     BDOS0:
0006F2 D445 E5              11      PUSH    HL
0006F3 D446 79               4      LD  A,C
0006F4 D447 FE3C             7      CP  03CH
0006F6 D449 3802            12      JR  C,DOS1
0006F8 D44B 3E3C             7      LD  A,03CH
       D44D                     DOS1:
0006FA D44D 87               4      ADD A,A
0006FB D44E 6F               4      LD  L,A
0006FC D44F 26F1             7      LD  H,STABLE/256
0006FE D451 7E               7      LD  A,(HL)
0006FF D452 2C               4      INC L
000700 D453 66               7      LD  H,(HL)
000701 D454 6F               4      LD  L,A
000702 D455 E3              19      EX  (SP),HL
000703 D456 79               4      LD  A,C
                                ;確認用
                                ;   LD  (0050H),A
000704 D457 C9              10      RET
       D458                     _DOS2:
000705 D458 FE5A             7      CP  05AH        ;(BDOS)カレントディレクトリの変更(_CHDIR)
000707 D45A CAF7D6          10      JP  Z,_SYS5A
00070A D45D FE5C             7      CP  05CH        ;(BDOS)ファイル名の解析(_PFILE)
00070C D45F CAB5D6          10      JP  Z,_SYS29
00070F D462 FE5F             7      CP  05FH        ;(BDOS)ディスクバッファのフラッシュ(_FLUSH)
000711 D464 CA92E8          10      JP  Z,_SYS5F
000714 D467 FE6F             7      CP  06FH        ;(BDOS)MSX-DOS のバージョン番号の獲得(_DOSVER)
000716 D469 200A            12      JR  NZ,_ERROR
000718 D46B 011D01          10      LD  BC,VER_6F
00071B D46E 115801          10      LD  DE,VER
00071E D471 210100          10      LD  HL,MACD
       D474                     C_REM:
000721 D474 AF               4      XOR A
       D475                     _ERROR:
000722 D475 A7               4      AND A
000723 D476 C9              10      RET
                                
       D477                     _SYS09:     ;文字列出力
000724 D477 D5              11      PUSH    DE
       D478                     _SX09:
000725 D478 1A               7      LD  A,(DE)
000726 D479 13               6      INC DE
000727 D47A FE24             7      CP  '$'
000729 D47C 2831            12      JR  Z,SX0E2
00072B D47E CD12D7          17      CALL    MSG_A
00072E D481 18F5            12      JR  _SX09
                                
       D483                     MSX1:
000730 D483 CD12D7          17      CALL    MSG_A
       D486                     MSX:
000733 D486 7E               7      LD  A,(HL)
000734 D487 23               6      INC HL
000735 D488 B7               4      OR  A
000736 D489 20F8            12      JR  NZ,MSX1
000738 D48B C9              10      RET
                                
       D48C                     _SYS0C:     ;(BDOS)バージョン番号の獲得
000739 D48C 212200          10      LD  HL,00022H
00073C D48F 7D               4      LD  A,L
00073D D490 C9              10      RET
                                
       D491                     _SYS0D:     ;(BDOS)ディスクリセット
00073E D491 CDDFF0          17      CALL    _FFLUSH
000741 D494 E5              11      PUSH    HL
000742 D495 218000          10      LD  HL,00080H
000745 D498 228AF0          16      LD  (_DTA),HL
000748 D49B E1              10      POP HL
000749 D49C D5              11      PUSH    DE
00074A D49D 1E00             7      LD  E,0
00074C D49F 3E                      DB  03EH    ;次の PUSH DE をスキップ
                                
       D4A0                     _SYS0E:     ;(BDOS)カレントドライブの設定
00074D D4A0 D5              11      PUSH    DE
00074E D4A1 7B               4      LD  A,E
00074F D4A2 DDE5            15      PUSH    IX
000751 D4A4 CDDCF0          17      CALL    _GETDPB
000754 D4A7 DDE1            14      POP IX
000756 D4A9 3804            12      JR  C,SX0E2
000758 D4AB 7B               4      LD  A,E
000759 D4AC 3287F0          13      LD  (_DVSW),A
       D4AF                     SX0E2:
00075C D4AF D1              10      POP DE
00075D D4B0 C9              10      RET
                                
       D4B1                     _SYS0F:     ;(BDOS)ファイルのオープン
00075E D4B1 CD2CDC          17      CALL    SETDRV
000761 D4B4 FD7E1C          19      LD  A,(IY+28)   ;(FCB)オープンモード
000764 D4B7 C602             7      ADD A,002H      ;Write
000766 D4B9 2848            12      JR  Z,FEND0F
000768 D4BB CD75DF          17      CALL    CHKWILDX
                                
00076B D4BE D44CDC          17      CALL    NC,SOPENX
       D4C1                     _S16XX:
00076E D4C1 3840            12      JR  C,FEND0F
                                                ;Directory location
000770 D4C3 3A9FF0          13      LD  A,(_FILEN)
000773 D4C6 FD7719          19      LD  (IY+25),A   ;(FCB)ディレクトリロケーション
                                ;               _DIRF
000776 D4C9 3AA0F0          13      LD  A,(_DIRF)
000779 D4CC FD771D          19      LD  (IY+29),A   ;(FCB)ディレクトリモード
                                ;               _FBPS
00077C D4CF FD731E          19      LD  (IY+30),E   ;(FCB)ディレクトリポジション
00077F D4D2 FD721F          19      LD  (IY+31),D
                                ;               Open(Read)
000782 D4D5 FD361CFF        19      LD  (IY+28),0FFH    ;(FCB)オープンモード
                                ;               FILENAME
000786 D4D9 FDE5            15      PUSH    IY
000788 D4DB D1              10      POP DE
000789 D4DC 13               6      INC DE
00078A D4DD 010B00          10      LD  BC,11
00078D D4E0 EDB0                    LDIR
                                ;               Attribute
00078F D4E2 7E               7      LD  A,(HL)
000790 D4E3 FD770D          19      LD  (IY+13),A   ;(FCB)属性(アトリビュート)
000793 D4E6 110B00          10      LD  DE,11       ;Reserved
000796 D4E9 19              11      ADD HL,DE
                                                    ;(FCB)ファイルを最後に変更した時刻
000797 D4EA 11E4F1          10      LD  DE,SDDATA       ;(FCB)ファイルを最後に変更した日付
00079A D4ED 060A             7      LD  B,SDDATAE-SDDATA    ;(FCB)ファイルの先頭クラスタ
       D4EF                     S16LOOP:                ;(FCB)ファイルのサイズ(バイト単位)
00079C D4EF 1A               7      LD  A,(DE)
00079D D4F0 13               6      INC DE
00079E D4F1 32F8D4          13      LD  (S16PAT+2),A
0007A1 D4F4 7E               7      LD  A,(HL)
0007A2 D4F5 23               6      INC HL
0007A3 D4F6 FD7700          19  S16PAT: LD  (IY+0),A
0007A6 D4F9 10F4            13      DJNZ    S16LOOP
                                
0007A8 D4FB AF               4      XOR A
0007A9 D4FC FD770C          19      LD  (IY+12),A   ;(FCB)カレントブロック
0007AC D4FF FD22A7D5        20      LD  (OFCB+1),IY
       D503                     FEND0F:
0007B0 D503 1845            12      JR  FEND10
                                
       D505                     _SYS10:     ;(BDOS)ファイルのクローズ
0007B2 D505 CD2CDC          17      CALL    SETDRV
0007B5 D508 FD7E1C          19      LD  A,(IY+28)   ;(FCB)オープンモード
0007B8 D50B D6FE             7      SUB 0FEH
0007BA D50D 37               4      SCF
0007BB D50E 3F               4      CCF
0007BC D50F 2039            12      JR  NZ,FEND10
       D511                     _S10A:              ;Write
0007BE D511 FD770E          19      LD  (IY+14),A   ;(FCB)レコードサイズ/アクセスするディレクトリのクラスタ番号+1
0007C1 D514 FD770F          19      LD  (IY+15),A
                                
0007C4 D517 FD341C          23      INC (IY+28)     ;0FEH->0FFH ;オープンモード
0007C7 D51A CD71E0          17      CALL    SETTMS
                                
0007CA D51D FD7E1D          19      LD  A,(IY+29)   ;(FCB)ディレクトリモード
0007CD D520 32A0F0          13      LD  (_DIRF),A
0007D0 D523 E67F             7      AND 07FH
0007D2 D525 329CE5          13      LD  (_SECPS),A
0007D5 D528 FD5E1E          19      LD  E,(IY+30)   ;(FCB)ディレクトリポジション
0007D8 D52B FD561F          19      LD  D,(IY+31)
0007DB D52E CD80DD          17      CALL    READ_DIR
0007DE D531 3817            12      JR  C,FEND10
                                
0007E0 D533 3AAADC          13  SDECM1: LD  A,(SDECPAT) ;1セクタ辺りのディレクトリエントリ数
0007E3 D536 3D               4      DEC A       ;1024=01FH / 512=00FH / 256=7
0007E4 D537 FDA619          19      AND (IY+25)     ;(FCB)ディレクトリロケーション
0007E7 D53A 6F               4      LD  L,A
0007E8 D53B 2600             7      LD  H,0
0007EA D53D 29              11      ADD HL,HL       ;*2
0007EB D53E 29              11      ADD HL,HL       ;*4
0007EC D53F 29              11      ADD HL,HL       ;*8
0007ED D540 29              11      ADD HL,HL       ;*16
0007EE D541 29              11      ADD HL,HL       ;*32
0007EF D542 ED4B7EF1        20      LD  BC,(_DTBUF)
0007F3 D546 09              11      ADD HL,BC
                                
0007F4 D547 CD85DF          17      CALL    SDIRENT
       D54A                     FEND10:
0007F7 D54A 1842            12      JR  FEND
                                
       D54C                     _SYS11:     ;(BDOS)最初のファイルの検索
0007F9 D54C CD2CDC          17      CALL    SETDRV
0007FC D54F CD79DC          17      CALL    SOPEN
       D552                     _S12X1:
0007FF D552 383A            12      JR  C,FEND
000801 D554 CD19DD          17      CALL    SOPENE2
000804 D557 ED5B8AF0        20      LD  DE,(_DTA)
000808 D55B 3A88F0          13      LD  A,(_DRV)
00080B D55E 3C               4      INC A
00080C D55F 12               7      LD  (DE),A
00080D D560 D5              11      PUSH    DE
00080E D561 13               6      INC DE
00080F D562 012000          10      LD  BC,32
000812 D565 EDB0                    LDIR
000814 D567 FD6E0E          19      LD  L,(IY+14)   ;(FCB)レコードサイズ/アクセスするディレクトリのクラスタ番号+1
000817 D56A FD660F          19      LD  H,(IY+15)
00081A D56D 22F4F1          16      LD  (SCDIR),HL
00081D D570 2A9AF0          16      LD  HL,(_FBPS)
000820 D573 22F6F1          16      LD  (SFBPS),HL
000823 D576 2A9FF0          16      LD  HL,(_FILEN)
000826 D579 7C               4      LD  A,H
000827 D57A B7               4      OR  A
000828 D57B 2806            12      JR  Z,_S12DIR
00082A D57D 3A9CE5          13      LD  A,(_SECPS)
00082D D580 F680             7      OR  080H
00082F D582 67               4      LD  H,A
       D583                     _S12DIR:
000830 D583 22F8F1          16      LD  (SFNDF),HL  ;Directory position and Flags
000833 D586 E1              10      POP HL
000834 D587 1139F0          10      LD  DE,SFILE
000837 D58A 0E21             7      LD  C,33
       D58C                     _S11B:
000839 D58C EDB0                    LDIR
       D58E                     FEND:
00083B D58E 9F               4      SBC A,A     ;CF=0 A=0 : CF=1 A=0FFH
       D58F                     FENDE:
00083C D58F FDE1            14      POP IY
00083E D591 C1              10      POP BC
00083F D592 D1              10      POP DE
000840 D593 E1              10      POP HL
000841 D594 C9              10      RET
                                
       D595                     _SYS12:     ;(BDOS)次のファイルの検索
000842 D595 E5              11      PUSH    HL
000843 D596 D5              11      PUSH    DE
000844 D597 C5              11      PUSH    BC
000845 D598 FDE5            15      PUSH    IY
000847 D59A CDDDDC          17      CALL    NOPEN
00084A D59D 18B3            12      JR  _S12X1
                                
       D59F                     _S16K:
00084C D59F FD7E1C          19      LD  A,(IY+28)   ;(FCB)オープンモード
00084F D5A2 FEFD             7      CP  0FDH        ;Device(0FDH)
000851 D5A4 37               4      SCF
000852 D5A5 C8              11      RET Z
                                
000853 D5A6 110000          10  OFCB:   LD  DE,0
000856 D5A9 D5              11      PUSH    DE
000857 D5AA 061A             7      LD  B,26        ;First cluster
       D5AC                     S16K1:
000859 D5AC 13               6      INC DE
00085A D5AD 23               6      INC HL
00085B D5AE 10FC            13      DJNZ    S16K1
                                
00085D D5B0 1A               7      LD  A,(DE)
00085E D5B1 BE               7      CP  (HL)
00085F D5B2 2013            12      JR  NZ,S16K2
000861 D5B4 13               6      INC DE
000862 D5B5 23               6      INC HL
000863 D5B6 1A               7      LD  A,(DE)
000864 D5B7 BE               7      CP  (HL)
000865 D5B8 200D            12      JR  NZ,S16K2
                                
000867 D5BA E1              10      POP HL
000868 D5BB FDE5            15      PUSH    IY
00086A D5BD D1              10      POP DE
00086B D5BE 1A               7      LD  A,(DE)      ;Drive
00086C D5BF BE               7      CP  (HL)
00086D D5C0 2006            12      JR  NZ,S16K3
                                                ;ここはCFが必ず0
00086F D5C2 ED52            15      SBC HL,DE       ;CP HL,DE
000871 D5C4 37               4      SCF
000872 D5C5 C0              11      RET NZ
000873 D5C6 E5              11      PUSH    HL
       D5C7                     S16K2:
000874 D5C7 E1              10      POP HL
       D5C8                     S16K3:
000875 D5C8 FDE5            15      PUSH    IY
000877 D5CA D1              10      POP DE
       D5CB                     _SYS13:     ;(BDOS)ファイルの削除
000878 D5CB CD2CDC          17      CALL    SETDRV
00087B D5CE CDA5DE          17      CALL    KILL
       D5D1                     FEND13:
00087E D5D1 18BB            12      JR  FEND
                                
       D5D3                     _SYS14:     ;(BDOS)シーケンシャルな読み出し
000880 D5D3 CD2CDC          17      CALL    SETDRV
000883 D5D6 CDDDE0          17      CALL    INIT_SEQ
       D5D9                     SREAD:
000886 D5D9 CD25E1          17      CALL    RB_READ
                                
000889 D5DC C601             7      ADD A,001H
00088B D5DE 38AE            12      JR  C,FEND
                                
00088D D5E0 7D               4      LD  A,L
00088E D5E1 D601             7      SUB 001H
       D5E3                     FENDX:
000890 D5E3 9F               4      SBC A,A
000891 D5E4 E603             7      AND 3
000893 D5E6 1F               4      RRA
000894 D5E7 18A6            12      JR  FENDE
                                
       D5E9                     _SYS15:     ;(BDOS)シーケンシャルな書き込み
000896 D5E9 CD2CDC          17      CALL    SETDRV
000899 D5EC CDDDE0          17      CALL    INIT_SEQ
       D5EF                     SWRITE:
00089C D5EF CD1EE1          17      CALL    RB_WRITE
                                
00089F D5F2 C6FF             7      ADD A,0FFH
0008A1 D5F4 18ED            12      JR  FENDX
                                
       D5F6                     _SYS17:     ;(BDOS)ファイル名の変更
0008A3 D5F6 CD2CDC          17      CALL    SETDRV
0008A6 D5F9 CDFBDE          17      CALL    NAME
0008A9 D5FC 18D3            12      JR  FEND13
                                
       D5FE                     _SYS16:     ;(BDOS)ファイルの作成
0008AB D5FE CD2CDC          17      CALL    SETDRV
                                
0008AE D601 CD75DF          17      CALL    CHKWILDX
0008B1 D604 38CB            12      JR  C,FEND13
0008B3 D606 FD7E01          19      LD  A,(IY+1)    ;(FCB)主ファイル名
0008B6 D609 FE05             7      CP  5
0008B8 D60B 2805            12      JR  Z,_S16X2
0008BA D60D FE21             7      CP  021H
0008BC D60F DAD1D5          10      JP  C,FEND13
       D612                     _S16X2:
                                ;               Clear FCB
0008BF D612 FDE5            15      PUSH    IY
0008C1 D614 E1              10      POP HL
0008C2 D615 011000          10      LD  BC,16
0008C5 D618 09              11      ADD HL,BC
       D619                     _S16X1:
0008C6 D619 70               7      LD  (HL),B      ;B=0
0008C7 D61A 23               6      INC HL
0008C8 D61B 0D               4      DEC C
0008C9 D61C 20FB            12      JR  NZ,_S16X1
                                
0008CB D61E CD76E0          17      CALL    SETTMSX
0008CE D621 FD360DFF        19      LD  (IY+13),0FFH    ;(FCB)Attribute
0008D2 D625 CD4CDC          17      CALL    SOPENX
0008D5 D628 3F               4      CCF
0008D6 D629 CC9FD5          17      CALL    Z,_S16K
0008D9 D62C D42ADD          17      CALL    NC,COPEN
0008DC D62F D485DF          17      CALL    NC,SDIRENT
0008DF D632 C3C1D4          10      JP  _S16XX
                                
       D635                     _SYS21:     ;(BDOS)ランダムな読み出し
0008E2 D635 CD2CDC          17      CALL    SETDRV
0008E5 D638 CDC1E0          17      CALL    INIT_RND
0008E8 D63B 189C            12      JR  SREAD
                                
       D63D                     _SYS22:     ;(BDOS)ランダムな書き込み
       D63D                     _SYS28:     ;(BDOS)ランダムな書き込み・その2
0008EA D63D CD2CDC          17      CALL    SETDRV
0008ED D640 CDC1E0          17      CALL    INIT_RND
0008F0 D643 18AA            12      JR  SWRITE
                                
       D645                     _SYS18:     ;(BDOS)ログインベクトルの獲得
0008F2 D645 21FF00          10      LD  HL,000FFH
0008F5 D648 AF               4      XOR A
0008F6 D649 C9              10      RET
                                
       D64A                     _SYS19:     ;(BDOS)カレントドライブ番号の獲得
0008F7 D64A 3A87F0          13      LD  A,(_DVSW)
0008FA D64D A7               4      AND A
0008FB D64E C9              10      RET
                                
       D64F                     _SYS1A:     ;(BDOS)DTAの設定
0008FC D64F ED538AF0        20      LD  (_DTA),DE
000900 D653 AF               4      XOR A
000901 D654 C9              10      RET
                                
       D655                     _SYS1B:     ;(BDOS)ディスク情報の獲得
000902 D655 7B               4      LD  A,E
000903 D656 CD3FDC          17      CALL    GETDRV
000906 D659 CDDCF0          17      CALL    _GETDPB
000909 D65C D4E2F0          17      CALL    NC,_RDFATX
00090C D65F 210000          10      LD  HL,0
00090F D662 D44FE0          17      CALL    NC,DSKF
                                
000912 D665 ED5B50E0        20      LD  DE,(MAXCLP) ;DPB_MAXCL-1
000916 D669 1B               6      DEC DE      ;DE←クラスタの総数
000917 D66A FD2A7CF1        20      LD  IY,(_FATBF) ;IY←メモリ上のFATの先頭アドレス
00091B D66E 9F               4      SBC A,A
00091C D66F D8              11      RET C
00091D D670 4F               4      LD  C,A     ;C=0
00091E D671 DD7E0F          19      LD  A,(IX+DPB_BPS)
000921 D674 E607             7      AND 7
000923 D676 47               4      LD  B,A
000924 D677 DD7E07          19      LD  A,(IX+DPB_SECPCL)
000927 D67A C9              10      RET
                                
       D67B                     _SYS1D:     ;(BDOS)書き込みが禁止されているディスクの調査
000928 D67B AF               4      XOR A
000929 D67C 67               4      LD  H,A
00092A D67D 6F               4      LD  L,A
00092B D67E C9              10      RET
                                
       D67F                     _SYS1F:     ;(BDOS)ディスク装置のパラメータの読み出し
00092C D67F 2100F2          10      LD  HL,_DEVICE
00092F D682 7B               4      LD  A,E
000930 D683 C3DCF0          10      JP  _GETDPB
                                
       D686                     _SYS23:     ;(BDOS)ファイルサイズの獲得
000933 D686 E5              11      PUSH    HL
000934 D687 2A1EF1          16      LD  HL,(STABLE+2*00FH)  ;ファイルのオープン
000937 D68A CD0F00          17      CALL    JP_HL
00093A D68D 381B            12      JR  C,_S23X1
                                
00093C D68F D5              11      PUSH    DE      ;EX DE,IY
00093D D690 FDE3            23      EX  (SP),IY     ;
                                ;   POP DE      ;
                                ;   PUSH    DE      ;DEを破壊しないように注意vv
00093F D692 FD7E10          19      LD  A,(IY+16)   ;(FCB)ファイルのサイズ(バイト単位)
000942 D695 FD6E11          19      LD  L,(IY+17)   ;
000945 D698 FD6612          19      LD  H,(IY+18)   ;
000948 D69B C5              11      PUSH    BC      ;
000949 D69C FD4613          19      LD  B,(IY+19)   ;
00094C D69F CDB3E0          17      CALL    GET_CPM_R_SIZE
00094F D6A2 C1              10      POP BC
       D6A3                     _S24X1:
000950 D6A3 CDD3E0          17      CALL    SET_RR_AHL
                                ;   POP DE      ;^^^^^^^^^^^^^^^^^^^^^^^^
                                ;   PUSH    DE      ;EX DE,IY
000953 D6A6 FDE3            23      EX  (SP),IY     ;
000955 D6A8 D1              10      POP DE      ;
                                
000956 D6A9 AF               4      XOR A
       D6AA                     _S23X1:
000957 D6AA E1              10      POP HL
000958 D6AB C9              10      RET
                                
       D6AC                     _SYS24:     ;(BDOS)ランダムレコードフィールドの設定
000959 D6AC E5              11      PUSH    HL
00095A D6AD D5              11      PUSH    DE      ;EX DE,IY
00095B D6AE FDE3            23      EX  (SP),IY     ;
                                ;   POP DE      ;
                                ;   PUSH    DE      ;DEを破壊しないように注意vv
00095D D6B0 CDE5E0          17      CALL    GETSEQ
000960 D6B3 18EE            12      JR  _S24X1      ;^^^^^^^^^^^^^^^^^^^^^^^^
                                
       D6B5                     _SYS29:     ;(BDOS)ファイル名の解析(_PPATH)
000962 D6B5 C5              11      PUSH    BC
000963 D6B6 E5              11      PUSH    HL
000964 D6B7 CD43DB          17      CALL    FILE
000967 D6BA E1              10      POP HL
000968 D6BB C1              10      POP BC
       D6BC                     S29X1:
000969 D6BC C5              11      PUSH    BC
00096A D6BD D5              11      PUSH    DE
00096B D6BE E5              11      PUSH    HL
00096C D6BF EB               4      EX  DE,HL
00096D D6C0 AF               4      XOR A
00096E D6C1 3221F0          13      LD  (FDRV+13),A
000971 D6C4 2114F0          10      LD  HL,FDRV
000974 D6C7 011000          10      LD  BC,16
000977 D6CA EDB0                    LDIR
000979 D6CC E1              10      POP HL
00097A D6CD D1              10      POP DE
00097B D6CE C1              10      POP BC
00097C D6CF C9              10      RET
                                
       D6D0                     _SYS30:     ;(BDOS)論理セクタを用いた書き込み
00097D D6D0 C5              11      PUSH    BC
00097E D6D1 0136E7          10      LD  BC,DWT24B
000981 D6D4 1804            12      JR  S2FX
       D6D6                     _SYS2F:
000983 D6D6 C5              11      PUSH    BC
000984 D6D7 0126E7          10      LD  BC,DRD24B
       D6DA                     S2FX:
000987 D6DA ED43F0D6        20      LD  (S2FPAT+1),BC
00098B D6DE CDDFF0          17      CALL    _FFLUSH
                                
00098E D6E1 D5              11      PUSH    DE
00098F D6E2 E5              11      PUSH    HL
000990 D6E3 7D               4      LD  A,L     ;Drive
000991 D6E4 CDD9F0          17      CALL    _CHGDRV
000994 D6E7 3809            12      JR  C,S30X2
000996 D6E9 44               4      LD  B,H     ;Number of clusters
000997 D6EA 2A8AF0          16      LD  HL,(_DTA)
                                
00099A D6ED 0E00             7      LD  C,0
00099C D6EF CD26E7          17  S2FPAT: CALL    DRD24B
       D6F2                     S30X2:
00099F D6F2 E1              10      POP HL
0009A0 D6F3 D1              10      POP DE
0009A1 D6F4 C1              10      POP BC
0009A2 D6F5 9F               4      SBC A,A
0009A3 D6F6 C9              10      RET
                                
       D6F7                     _SYS5A:     ;(BDOS)カレントディレクトリの変更
0009A4 D6F7 C5              11      PUSH    BC
0009A5 D6F8 D5              11      PUSH    DE
0009A6 D6F9 E5              11      PUSH    HL
0009A7 D6FA CD38DB          17      CALL    FILEC
0009AA D6FD 210000          10      LD  HL,0
0009AD D700 1114F0          10      LD  DE,FDRV
0009B0 D703 2A4EF1          16      LD  HL,(STABLE+2*027H)  ;ランダムブロック読み込み
0009B3 D706 CD0F00          17      CALL    JP_HL
0009B6 D709 18E7            12      JR  S30X2
[EOF:LDOS.ASM:SHIFT_JIS]
                                    INCLUDE "M7IO.ASM"
                                
                                ;   LSX-Dodgers IO
                                ;   MZ-700/1500
                                
       D475                     _SYS04  EQU _ERROR      ;(BDOS)外部出力
       D475                     _SYS05  EQU _ERROR      ;(BDOS)プリンタ出力
       D475                     _SYS1C  EQU _ERROR      ;(BDOS)ディスクの書き込み禁止化
       D475                     _SYS1E  EQU _ERROR      ;(BDOS)ファイル属性の設定
       D475                     _SYS20  EQU _ERROR      ;(BDOS)利用者番号の設定と読み出し
       D475                     _SYS2E  EQU _ERROR      ;(BDOS)ベリファイ・フラグの設定
                                
       0000                     INT EQU 0
       0000                     INTCTCE EQU 0
       0000                     INTCTC2 EQU 0
                                
       D70B                     POP_AF_HL_SCF_RET:
0009B8 D70B F1              10      POP AF
0009B9 D70C E1              10      POP HL
0009BA D70D 37               4      SCF
       D70E                     KEYBC_IFBREAK:
0009BB D70E C9              10      RET
                                
       D70F                     _SYS01:     ;(BDOS)コンソール入力
0009BC D70F CD09F0          17      CALL    _SYS07
       D712                     MSG_A:
0009BF D712 F5              11      PUSH    AF
0009C0 D713 D5              11      PUSH    DE
0009C1 D714 5F               4      LD  E,A
0009C2 D715 CD1BD7          17      CALL    _SYS02
0009C5 D718 D1              10      POP DE
0009C6 D719 F1              10      POP AF
0009C7 D71A C9              10      RET
                                
       D71B                     _SYS02:     ;(BDOS)コンソール出力
0009C8 D71B CD2DD7          17      CALL    BREAK
0009CB D71E 1805            12      JR  PRINTX
                                
       D720                     _SYS06:     ;(BDOS)コンソール直接入出力
0009CD D720 7B               4      LD  A,E
0009CE D721 3C               4      INC A
0009CF D722 CACAF0          10      JP  Z,_INKEY
       D725                     PRINTX:
0009D2 D725 C3CDF0          10      JP  _PRINT
                                
       D728                     _SYS08:     ;(BDOS)エコーなしコンソール入力
0009D5 D728 CD09F0          17      CALL    _SYS07
0009D8 D72B 1803            12      JR  BREAK1
       D72D                     BREAK:
0009DA D72D CDCADA          17      CALL    CHKEY
       D730                     BREAK1:
0009DD D730 FE03             7      CP  3       ;CTRL+C
0009DF D732 CA00F0          10      JP  Z,CPM_BOOT
0009E2 D735 FE13             7      CP  013H        ;CTRL+S
0009E4 D737 C0              11      RET NZ
                                
       D738                     PAUSE:
       D738                     FLGET:
0009E5 D738 CDDFF0          17      CALL    _FFLUSH
0009E8 D73B E5              11      PUSH    HL
0009E9 D73C 2A8EF0          16      LD  HL,(_TXADR)
0009EC D73F 7C               4      LD  A,H
0009ED D740 C6D0             7      ADD A,0D0H
0009EF D742 67               4      LD  H,A
0009F0 D743 CD25CF          17      CALL    RDMMIO
0009F3 D746 325BD7          13      LD  (FLSMC),A
       D749                     FLGET1:
0009F6 D749 CD1BCF          17      CALL    RD556VSYNC
0009F9 D74C CB77             8      BIT 6,A
0009FB D74E 3EEF             7      LD  A,0EFH      ;カーソル
0009FD D750 200A            12      JR  NZ,FLGET2
0009FF D752 3A92F0          13      LD  A,(_KEYD)
000A02 D755 B7               4      OR  A
000A03 D756 3EEF             7      LD  A,0EFH      ;カーソル
000A05 D758 2002            12      JR  NZ,FLGET2
000A07 D75A 3E00             7      LD  A,0     ;自己書き換え
       D75B                     FLSMC   EQU $-1
       D75C                     FLGET2:
000A09 D75C CD2DCF          17      CALL    WRMMIO
000A0C D75F CDCAF0          17      CALL    _INKEY
000A0F D762 28E5            12      JR  Z,FLGET1
000A11 D764 F5              11      PUSH    AF
000A12 D765 3A5BD7          13      LD  A,(FLSMC)
000A15 D768 CD2DCF          17      CALL    WRMMIO
000A18 D76B F1              10      POP AF
000A19 D76C E1              10      POP HL
000A1A D76D C9              10      RET
                                
       D76E                     _SYS0A:     ;(BDOS)文字列入力
000A1B D76E C5              11      PUSH    BC
000A1C D76F E5              11      PUSH    HL
000A1D D770 D5              11      PUSH    DE
000A1E D771 CD03DA          17      CALL    GETL
000A21 D774 1120FF          10      LD  DE,KBUF
000A24 D777 E1              10      POP HL
000A25 D778 E5              11      PUSH    HL
000A26 D779 0E00             7      LD  C,0
000A28 D77B 3004            12      JR  NC,SAX0
000A2A D77D 23               6      INC HL
000A2B D77E 23               6      INC HL
000A2C D77F 1808            12      JR  SAX4
       D781                     SAX0:
000A2E D781 46               7      LD  B,(HL)
000A2F D782 23               6      INC HL
       D783                     SAX1:
000A30 D783 23               6      INC HL
000A31 D784 1A               7      LD  A,(DE)
000A32 D785 13               6      INC DE
000A33 D786 B7               4      OR  A
000A34 D787 2004            12      JR  NZ,SAX2
       D789                     SAX4:
000A36 D789 360D            10      LD  (HL),00DH
000A38 D78B 1804            12      JR  SAX3
       D78D                     SAX2:
000A3A D78D 77               7      LD  (HL),A
000A3B D78E 0C               4      INC C
000A3C D78F 10F2            13      DJNZ    SAX1
       D791                     SAX3:
000A3E D791 D1              10      POP DE
000A3F D792 79               4      LD  A,C
000A40 D793 13               6      INC DE
000A41 D794 12               7      LD  (DE),A
000A42 D795 1B               6      DEC DE
000A43 D796 E1              10      POP HL
000A44 D797 C1              10      POP BC
000A45 D798 A7               4      AND A
000A46 D799 C9              10      RET
                                
       D79A                     _SYS0B:     ;(BDOS)コンソール状態のチェック
000A47 D79A CD2DD7          17      CALL    BREAK
000A4A D79D AF               4      XOR A
000A4B D79E 3297DA          13      LD  (SKIP_KEYWAIT),A
000A4E D7A1 3A92F0          13      LD  A,(_KEYD)
000A51 D7A4 B7               4      OR  A
000A52 D7A5 C8              11      RET Z
       D7A6                     CONSTX:
000A53 D7A6 CDDFF0          17      CALL    _FFLUSH
000A56 D7A9 CDCADA          17      CALL    CHKEY
000A59 D7AC C6FF             7      ADD A,0FFH
000A5B D7AE 9F               4      SBC A,A
000A5C D7AF C9              10      RET
                                
       D7B0                     _SYS2A:     ;(BDOS)日付の獲得
000A5D D7B0 AF               4      XOR A
000A5E D7B1 57               4      LD  D,A
000A5F D7B2 5F               4      LD  E,A
000A60 D7B3 67               4      LD  H,A
000A61 D7B4 6F               4      LD  L,A
000A62 D7B5 C9              10      RET
                                
       D7B6                     _SYS2C:     ;(BDOS)時刻の獲得
000A63 D7B6 AF               4      XOR A
000A64 D7B7 57               4      LD  D,A
000A65 D7B8 5F               4      LD  E,A
000A66 D7B9 67               4      LD  H,A
000A67 D7BA 6F               4      LD  L,A
000A68 D7BB C9              10      RET
                                
       D7BC                     ESC1:
000A69 D7BC 7B               4      LD  A,E
000A6A D7BD FE41             7      CP  'A'
000A6C D7BF CAB4D8          10      JP  Z,CTRL1E
000A6F D7C2 FE42             7      CP  'B'
000A71 D7C4 CAC6D9          10      JP  Z,CTRL1F
000A74 D7C7 FE43             7      CP  'C'
000A76 D7C9 CA87D8          10      JP  Z,CTRL1C
000A79 D7CC FE44             7      CP  'D'
000A7B D7CE CAABD8          10      JP  Z,CTRL1D
000A7E D7D1 FE45             7      CP  'E'
000A80 D7D3 2802            12      JR  Z,CT0CX
000A82 D7D5 FE6A             7      CP  'j'
       D7D7                     CT0CX:
000A84 D7D7 CAABD9          10      JP  Z,CTRL0C
000A87 D7DA FE48             7      CP  'H'
000A89 D7DC CA28D9          10      JP  Z,CTRL0B
000A8C D7DF FE4A             7      CP  'J'
000A8E D7E1 CAAED9          10      JP  Z,CTRL06
000A91 D7E4 FE4B             7      CP  'K'
000A93 D7E6 CAFAD8          10      JP  Z,CTRL05
000A96 D7E9 FE4C             7      CP  'L'
000A98 D7EB CAD8D9          10      JP  Z,CTRL0E
000A9B D7EE FE54             7      CP  'T'
000A9D D7F0 CAFAD8          10      JP  Z,CTRL05
000AA0 D7F3 FE78             7      CP  'x'
000AA2 D7F5 2804            12      JR  Z,ESC1X
000AA4 D7F7 FE79             7      CP  'y'
000AA6 D7F9 2002            12      JR  NZ,ESC1Y
       D7FB                     ESC1X:
000AA8 D7FB 3601            10      LD  (HL),1
       D7FD                     ESC1Y:
000AAA D7FD FE3D             7      CP  '='
000AAC D7FF 2804            12      JR  Z,ESC1W
000AAE D801 FE59             7      CP  'Y'
000AB0 D803 2002            12      JR  NZ,ESC1Z
       D805                     ESC1W:
000AB2 D805 3602            10      LD  (HL),2
       D807                     ESC1Z:
000AB4 D807 FE20             7      CP  020H
000AB6 D809 3802            12      JR  C,ESC1C
000AB8 D80B 87               4      ADD A,A
000AB9 D80C D0              11      RET NC
       D80D                     ESC1C:
000ABA D80D E1              10      POP HL
000ABB D80E 1832            12      JR  ANK
                                
       D810                     ESC:
000ABD D810 2173D8          10      LD  HL,PRINTE5
000AC0 D813 E5              11      PUSH    HL
000AC1 D814 2136D8          10      LD  HL,ESCFLG
000AC4 D817 3600            10      LD  (HL),0
000AC6 D819 3D               4      DEC A
000AC7 D81A 28A0            12      JR  Z,ESC1
000AC9 D81C 3D               4      DEC A
000ACA D81D 2009            12      JR  NZ,ESC2
000ACC D81F 3603            10      LD  (HL),3
000ACE D821 7B               4      LD  A,E
000ACF D822 D620             7      SUB 020H
000AD1 D824 322BD8          13      LD  (ESCYP+1),A
000AD4 D827 C9              10      RET
       D828                     ESC2:
000AD5 D828 3D               4      DEC A
000AD6 D829 C0              11      RET NZ
000AD7 D82A 2600             7  ESCYP:  LD  H,0
000AD9 D82C 7B               4      LD  A,E
000ADA D82D D620             7      SUB 020H
000ADC D82F 6F               4      LD  L,A
000ADD D830 C3D6F0          10      JP  _LOC
                                
       D833                     PRINT:
000AE0 D833 C5              11      PUSH    BC
000AE1 D834 E5              11      PUSH    HL
000AE2 D835 3E00             7      LD  A,000H      ;自己書き換え
       D836                     ESCFLG  EQU $-1
000AE4 D837 B7               4      OR  A
000AE5 D838 20D6            12      JR  NZ,ESC
                                
000AE7 D83A 3E1F             7      LD  A,01FH
000AE9 D83C BB               4      CP  E
000AEA D83D 3038            12      JR  NC,CTRL
       D83F                     INSFLG  EQU $
000AEC D83F 0180D9          10      LD  BC,INSERT   ;自己書き換え
       D842                     ANK:
000AEF D842 3A96F0          13      LD  A,(_COLORF)
000AF2 D845 4F               4      LD  C,A
000AF3 D846 7B               4      LD  A,E
000AF4 D847 FE61             7      CP  'a'     ;英小文字
000AF6 D849 3806            12      JR  C,PRT1
000AF8 D84B FE7B             7      CP  'z'+1
000AFA D84D 3002            12      JR  NC,PRT1
000AFC D84F CBF9             8      SET 7,C
       D851                     PRT1:
000AFE D851 FE86             7      CP  $86     ;ひらがな1(を－そ)
000B00 D853 3806            12      JR  C,PRT2
000B02 D855 FEA0             7      CP  $A0
000B04 D857 3002            12      JR  NC,PRT2
000B06 D859 CBF9             8      SET 7,C
       D85B                     PRT2:
000B08 D85B FEE0             7      CP  $E0     ;ひらがな2(たーん)
000B0A D85D 3802            12      JR  C,PRT3
000B0C D85F CBF9             8      SET 7,C
       D861                     PRT3:
000B0E D861 2A8EF0          16      LD  HL,(_TXADR)
000B11 D864 7C               4      LD  A,H
000B12 D865 C6D0             7      ADD A,0D0H
000B14 D867 67               4      LD  H,A
000B15 D868 42               4      LD  B,D
000B16 D869 16EE             7      LD  D,CD_TABLE/256
000B18 D86B 1A               7      LD  A,(DE)
000B19 D86C 50               4      LD  D,B
000B1A D86D CD45CF          17      CALL    IO_PRINT
000B1D D870 CD87D8          17      CALL    CTRL1C
       D873                     PRINTE5:
000B20 D873 E1              10      POP HL
000B21 D874 C1              10      POP BC
000B22 D875 AF               4      XOR A
000B23 D876 C9              10      RET
                                
       D877                     CTRL:
000B24 D877 7B               4      LD  A,E
000B25 D878 87               4      ADD A,A
000B26 D879 F680             7      OR  080H
000B28 D87B 6F               4      LD  L,A
000B29 D87C 26F1             7      LD  H,CTRLTB/256
000B2B D87E 7E               7      LD  A,(HL)
000B2C D87F 2C               4      INC L
000B2D D880 66               7      LD  H,(HL)
000B2E D881 6F               4      LD  L,A
000B2F D882 CD0F00          17      CALL    JP_HL
000B32 D885 18EC            12      JR  PRINTE5
                                
       D887                     CTRL1C:
000B34 D887 ED4B8EF0        20      LD  BC,(_TXADR)
000B38 D88B 03               6      INC BC
       D88C                     PRINTE3:
000B39 D88C 2118FC          10      LD  HL,0-WIDTH*LINE
000B3C D88F A7               4      AND A
000B3D D890 ED4A            15      ADC HL,BC
       D892                     PRINTE8:
000B3F D892 2805            12      JR  Z,PRINT2
000B41 D894 ED438EF0        20      LD  (_TXADR),BC
       D898                     CTRL00:
000B45 D898 C9              10      RET
                                
       D899                     PRINT2:
000B46 D899 CDDED9          17      CALL    SCR
000B49 D89C 21D8FF          10      LD  HL,0-WIDTH
000B4C D89F 09              11      ADD HL,BC
       D8A0                     SET_TXADR_HL:
000B4D D8A0 228EF0          16      LD  (_TXADR),HL
000B50 D8A3 C9              10      RET
                                
       D8A4                     CTRL08:
000B51 D8A4 3A3FD8          13      LD  A,(INSFLG)
000B54 D8A7 FECD             7      CP  0CDH        ;CALL ????
000B56 D8A9 2823            12      JR  Z,CTRL02
       D8AB                     CTRL1D:
000B58 D8AB 2A8EF0          16      LD  HL,(_TXADR)
000B5B D8AE 7C               4      LD  A,H
000B5C D8AF B5               4      OR  L
000B5D D8B0 C8              11      RET Z
000B5E D8B1 2B               6      DEC HL
000B5F D8B2 18EC            12      JR  SET_TXADR_HL
                                
       D8B4                     CTRL1E:
000B61 D8B4 ED4B8EF0        20      LD  BC,(_TXADR)
000B65 D8B8 21D8FF          10      LD  HL,0-WIDTH
000B68 D8BB 09              11      ADD HL,BC
000B69 D8BC D0              11      RET NC
000B6A D8BD 18E1            12      JR  SET_TXADR_HL
                                
       D8BF                     CTRL09:
000B6C D8BF ED4B8EF0        20      LD  BC,(_TXADR)
000B70 D8C3 79               4      LD  A,C
000B71 D8C4 E6F8             7      AND 0F8H
000B73 D8C6 C608             7      ADD A,8
000B75 D8C8 4F               4      LD  C,A
000B76 D8C9 88               4      ADC A,B
000B77 D8CA 91               4      SUB C
000B78 D8CB 47               4      LD  B,A
000B79 D8CC 18BE            12      JR  PRINTE3
                                
       D8CE                     CTRL02:
000B7B D8CE CDABD8          17      CALL    CTRL1D
000B7E D8D1 C8              11      RET Z
000B7F D8D2 D5              11      PUSH    DE
000B80 D8D3 CDD3F0          17      CALL    _POS
000B83 D8D6 54               4      LD  D,H
000B84 D8D7 3E28             7      LD  A,WIDTH
000B86 D8D9 95               4      SUB L
000B87 D8DA 4F               4      LD  C,A
000B88 D8DB 0D               4      DEC C
000B89 D8DC 06D0             7      LD  B,0D0H
000B8B D8DE 2A8EF0          16      LD  HL,(_TXADR)
000B8E D8E1 09              11      ADD HL,BC
000B8F D8E2 47               4      LD  B,A
                                
000B90 D8E3 3A9CD9          13      LD  A,(MULINE)
000B93 D8E6 BA               4      CP  D
000B94 D8E7 2007            12      JR  NZ,C02X1
000B96 D8E9 112800          10      LD  DE,WIDTH
000B99 D8EC 19              11      ADD HL,DE
000B9A D8ED 78               4      LD  A,B
000B9B D8EE 83               4      ADD A,E
000B9C D8EF 47               4      LD  B,A
       D8F0                     C02X1:
000B9D D8F0 3A96F0          13      LD  A,(_COLORF) ;C:Color
000BA0 D8F3 4F               4      LD  C,A
000BA1 D8F4 AF               4      XOR A       ;A:Text
000BA2 D8F5 CD8CCF          17      CALL    IO_BS
000BA5 D8F8 D1              10      POP DE
000BA6 D8F9 C9              10      RET
                                
       D8FA                     CTRL05:
000BA7 D8FA CDD3F0          17      CALL    _POS
000BAA D8FD 3E28             7      LD  A,WIDTH
000BAC D8FF 95               4      SUB L
000BAD D900 47               4      LD  B,A
       D901                     C08X1:
000BAE D901 2A8EF0          16      LD  HL,(_TXADR)
000BB1 D904 7C               4      LD  A,H
000BB2 D905 C6D0             7      ADD A,0D0H
000BB4 D907 67               4      LD  H,A
       D908                     CLLINE:
000BB5 D908 3A96F0          13      LD  A,(_COLORF)
000BB8 D90B 4F               4      LD  C,A
000BB9 D90C AF               4      XOR A
000BBA D90D C36FCF          10      JP  IO_CLLINE
                                
       D910                     CTRL0D:
000BBD D910 CDD3F0          17      CALL    _POS
000BC0 D913 2E00             7      LD  L,0
       D915                     LOC:
000BC2 D915 C5              11      PUSH    BC
000BC3 D916 E5              11      PUSH    HL
000BC4 D917 CD35D9          17      CALL    LOC1
000BC7 D91A 228EF0          16      LD  (_TXADR),HL
000BCA D91D E1              10      POP HL
000BCB D91E C1              10      POP BC
000BCC D91F C9              10      RET
                                
       D920                     CTRL12:
000BCD D920 213FD8          10      LD  HL,INSFLG
000BD0 D923 7E               7      LD  A,(HL)
000BD1 D924 EECC             7      XOR 0CCH        ;CD:CALL ???? 1:LD BC,????
000BD3 D926 77               7      LD  (HL),A
000BD4 D927 C9              10      RET
                                
       D928                     CTRL0B:
000BD5 D928 210000          10      LD  HL,0
000BD8 D92B 228EF0          16      LD  (_TXADR),HL
000BDB D92E C9              10      RET
                                
       D92F                     CTRL1B:
000BDC D92F 3E01             7      LD  A,1
000BDE D931 3236D8          13      LD  (ESCFLG),A
000BE1 D934 C9              10      RET
                                
       D935                     LOC1:
000BE2 D935 D5              11      PUSH    DE
000BE3 D936 4D               4      LD  C,L
000BE4 D937 0608             7      LD  B,8
000BE6 D939 5C               4      LD  E,H
000BE7 D93A 210028          10      LD  HL,WIDTH*256
000BEA D93D 55               4      LD  D,L ;L=0
       D93E                     LOC2:
000BEB D93E 29              11      ADD HL,HL
000BEC D93F 3001            12      JR  NC,LOC3
000BEE D941 19              11      ADD HL,DE
       D942                     LOC3:
000BEF D942 10FA            13      DJNZ    LOC2
000BF1 D944 09              11      ADD HL,BC
000BF2 D945 D1              10      POP DE
000BF3 D946 C9              10      RET
                                
       D947                     CONOUT1:
                                ;   CALL    CURSOR
000BF4 D947 59               4      LD  E,C
000BF5 D948 CDCDF0          17      CALL    _PRINT
000BF8 D94B 7B               4      LD  A,E
000BF9 D94C FE0A             7      CP  00AH
000BFB D94E 2006            12      JR  NZ,CURSOR
000BFD D950 CD10D9          17      CALL    CTRL0D
000C00 D953 CDFAD8          17      CALL    CTRL05
       D956                     CURSOR:
000C03 D956 C9              10      RET
                                
       D957                     CTRL07:
000C04 D957 06E0             7      LD  B,0E0H
000C06 D959 2162F0          10      LD  HL,BEEPD+1
       D95C                     C07X0:
000C09 D95C 4E               7      LD  C,(HL)
000C0A D95D 23               6      INC HL
000C0B D95E 7E               7      LD  A,(HL)
000C0C D95F 23               6      INC HL
000C0D D960 CD3DCF          17      CALL    WRMMIO_BC
000C10 D963 7D               4      LD  A,L
000C11 D964 FE6A             7      CP  (BEEPD+1+M7BEEPE-M7BEEPD)&255
000C13 D966 20F4            12      JR  NZ,C07X0
000C15 D968 0610             7      LD  B,16
       D96A                     C07X1:
000C17 D96A CD1BCF          17      CALL    RD556VSYNC
000C1A D96D 87               4      ADD A,A
000C1B D96E 30FA            12      JR  NC,C07X1
       D970                     C07X2:
000C1D D970 CD1BCF          17      CALL    RD556VSYNC
000C20 D973 87               4      ADD A,A
000C21 D974 38FA            12      JR  C,C07X2
000C23 D976 10F2            13      DJNZ    C07X1
                                
000C25 D978 AF               4      XOR A
000C26 D979 2108E0          10      LD  HL,0E008H
000C29 D97C CD2DCF          17      CALL    WRMMIO
000C2C D97F C9              10      RET
                                
       D980                     INSERT:
000C2D D980 D5              11      PUSH    DE
000C2E D981 CDD3F0          17      CALL    _POS
000C31 D984 54               4      LD  D,H
000C32 D985 3E28             7      LD  A,WIDTH
000C34 D987 95               4      SUB L
000C35 D988 47               4      LD  B,A
000C36 D989 2A8EF0          16      LD  HL,(_TXADR)
000C39 D98C 7C               4      LD  A,H
000C3A D98D C6D0             7      ADD A,0D0H
000C3C D98F 67               4      LD  H,A
000C3D D990 3A96F0          13      LD  A,(_COLORF) ;C:Color
000C40 D993 4F               4      LD  C,A
000C41 D994 AF               4      XOR A       ;A:Text
000C42 D995 CD7FCF          17      CALL    IO_INS
000C45 D998 B7               4      OR  A
000C46 D999 2005            12      JR  NZ,INS1
       D99C                     MULINE  EQU $+1
000C48 D99B 3EFF             7      LD  A,-1
000C4A D99D 92               4      SUB D
000C4B D99E 2009            12      JR  NZ,INS2
       D9A0                     INS1:
000C4D D9A0 0628             7      LD  B,WIDTH
000C4F D9A2 CD7FCF          17      CALL    IO_INS
000C52 D9A5 7A               4      LD  A,D
000C53 D9A6 329CD9          13      LD  (MULINE),A
       D9A9                     INS2:
000C56 D9A9 D1              10      POP DE
000C57 D9AA C9              10      RET
                                
       D9AB                     CTRL0C:
000C58 D9AB CD28D9          17      CALL    CTRL0B
       D9AE                     CTRL06:
000C5B D9AE D5              11      PUSH    DE
000C5C D9AF E5              11      PUSH    HL
000C5D D9B0 ED5B8EF0        20      LD  DE,(_TXADR)
000C61 D9B4 3A96F0          13      LD  A,(_COLORF)
000C64 D9B7 325CCF          13      LD  (ICSMC),A
000C67 D9BA C350CF          10      JP  IO_CLR
                                
       D9BD                     CTRL04:
000C6A D9BD CDD3F0          17      CALL    _POS
000C6D D9C0 7D               4      LD  A,L
000C6E D9C1 B7               4      OR  A
000C6F D9C2 C8              11      RET Z
       D9C3                     CTRL03:
000C70 D9C3 CD10D9          17      CALL    CTRL0D
       D9C6                     CTRL0A:
       D9C6                     CTRL1F:
000C73 D9C6 2A8EF0          16      LD  HL,(_TXADR)
000C76 D9C9 012800          10      LD  BC,WIDTH
000C79 D9CC 09              11      ADD HL,BC
000C7A D9CD 44               4      LD  B,H
000C7B D9CE 4D               4      LD  C,L
000C7C D9CF 2118FC          10      LD  HL,0-WIDTH*LINE
000C7F D9D2 09              11      ADD HL,BC
000C80 D9D3 3F               4      CCF
000C81 D9D4 9F               4      SBC A,A
000C82 D9D5 C392D8          10      JP  PRINTE8
                                
       D9D8                     CTRL0E:
000C85 D9D8 CDD3F0          17      CALL    _POS
000C88 D9DB 7C               4      LD  A,H
000C89 D9DC 1804            12      JR  SCR1
       D9DE                     SCR:
000C8B D9DE 3A97F0          13      LD  A,(_LINE)
000C8E D9E1 3D               4      DEC A
       D9E2                     SCR1:
000C8F D9E2 C5              11      PUSH    BC
000C90 D9E3 D5              11      PUSH    DE
000C91 D9E4 E5              11      PUSH    HL
000C92 D9E5 1100D0          10      LD  DE,0D000H
000C95 D9E8 2128D0          10      LD  HL,0D000H+WIDTH
                                
000C98 D9EB 47               4      LD  B,A
000C99 D9EC B7               4      OR  A
000C9A D9ED C3A4CF          10      JP  IO_SCRUP
                                
       D9F0                     POS:
000C9D D9F0 2A8EF0          16      LD  HL,(_TXADR)
000CA0 D9F3 C5              11      PUSH    BC
000CA1 D9F4 01D8FF          10      LD  BC,0-WIDTH
000CA4 D9F7 AF               4      XOR A
       D9F8                     POS1:
000CA5 D9F8 09              11      ADD HL,BC
000CA6 D9F9 3C               4      INC A
000CA7 D9FA 38FC            12      JR  C,POS1
000CA9 D9FC ED42            15      SBC HL,BC
000CAB D9FE 3D               4      DEC A
000CAC D9FF 67               4      LD  H,A
000CAD DA00 C1              10      POP BC
000CAE DA01 A7               4      AND A
000CAF DA02 C9              10      RET
                                
       DA03                     GETL:
000CB0 DA03 CDD3F0          17      CALL    _POS
000CB3 DA06 E5              11      PUSH    HL
000CB4 DA07 3ECD             7      LD  A,0CDH      ;CALL ????
000CB6 DA09 323FD8          13      LD  (INSFLG),A
       DA0C                     GETL1:
000CB9 DA0C CD28D7          17      CALL    _SYS08
000CBC DA0F FE09             7      CP  9
000CBE DA11 2008            12      JR  NZ,GETL1V
000CC0 DA13 2120FF          10      LD  HL,KBUF
000CC3 DA16 CD86D4          17      CALL    MSX
000CC6 DA19 18F1            12      JR  GETL1
       DA1B                     GETL1V:
000CC8 DA1B 5F               4      LD  E,A
000CC9 DA1C CDD3F0          17      CALL    _POS
000CCC DA1F CDCDF0          17      CALL    _PRINT
000CCF DA22 7B               4      LD  A,E
000CD0 DA23 FE20             7      CP  $20
000CD2 DA25 3809            12      JR  C,GETL1V1
000CD4 DA27 7D               4      LD  A,L
000CD5 DA28 FE27             7      CP  WIDTH-1
000CD7 DA2A 2004            12      JR  NZ,GETL1V1
000CD9 DA2C 7C               4      LD  A,H
000CDA DA2D 329CD9          13      LD  (MULINE),A
       DA30                     GETL1V1:
000CDD DA30 7B               4      LD  A,E
000CDE DA31 FE0D             7      CP  00DH
000CE0 DA33 20D7            12      JR  NZ,GETL1
000CE2 DA35 3E01             7      LD  A,1     ;LD BC,????
000CE4 DA37 323FD8          13      LD  (INSFLG),A
000CE7 DA3A 1120FF          10      LD  DE,KBUF
000CEA DA3D 0628             7      LD  B,WIDTH
000CEC DA3F CD23D3          17      CALL    ZERO_MEMORY_DE
                                
000CEF DA42 D1              10      POP DE
000CF0 DA43 CDD3F0          17      CALL    _POS
000CF3 DA46 6B               4      LD  L,E
000CF4 DA47 3E28             7      LD  A,WIDTH
000CF6 DA49 95               4      SUB L
000CF7 DA4A 57               4      LD  D,A
                                
000CF8 DA4B 3A9CD9          13      LD  A,(MULINE)
000CFB DA4E 94               4      SUB H
000CFC DA4F 2806            12      JR  Z,GL2X
000CFE DA51 3C               4      INC A
000CFF DA52 200C            12      JR  NZ,GL3X
000D01 DA54 25               4      DEC H
000D02 DA55 1805            12      JR  GL4X
       DA57                     GL2X:
000D04 DA57 3E1F             7      LD  A,$1F
000D06 DA59 CD12D7          17      CALL    MSG_A
       DA5C                     GL4X:
000D09 DA5C 7A               4      LD  A,D
000D0A DA5D C628             7      ADD A,WIDTH
000D0C DA5F 57               4      LD  D,A
       DA60                     GL3X:
000D0D DA60 CD35D9          17      CALL    LOC1
000D10 DA63 4D               4      LD  C,L
000D11 DA64 7C               4      LD  A,H
000D12 DA65 C6D0             7      ADD A,0D0H
000D14 DA67 47               4      LD  B,A
000D15 DA68 5A               4      LD  E,D
000D16 DA69 2120FF          10      LD  HL,KBUF
       DA6C                     GETL2:
000D19 DA6C CDD0F0          17      CALL    _SCRN
000D1C DA6F 03               6      INC BC
000D1D DA70 77               7      LD  (HL),A
000D1E DA71 23               6      INC HL
000D1F DA72 1D               4      DEC E
000D20 DA73 20F7            12      JR  NZ,GETL2
       DA75                     GETL3:
000D22 DA75 2B               6      DEC HL
000D23 DA76 7E               7      LD  A,(HL)
000D24 DA77 FE21             7      CP  021H
000D26 DA79 D0              11      RET NC
000D27 DA7A 3600            10      LD  (HL),0
000D29 DA7C 15               4      DEC D
000D2A DA7D 20F6            12      JR  NZ,GETL3
000D2C DA7F C9              10      RET
                                
       DA80                     INKEYB:
000D2D DA80 C1              10      POP BC
000D2E DA81 CB47             8      BIT 0,A
000D30 DA83 3E08             7      LD  A,8
000D32 DA85 2002            12      JR  NZ,INKEYD
000D34 DA87 3E03             7      LD  A,3
       DA89                     INKEYD:
000D36 DA89 3292F0          13      LD  (_KEYD),A
000D39 DA8C B7               4      OR  A
000D3A DA8D C9              10      RET
       DA8E                     INKEY:
000D3B DA8E E5              11      PUSH    HL
       DA8F                     GETKEY:
000D3C DA8F 3A92F0          13      LD  A,(_KEYD)
000D3F DA92 B7               4      OR  A
000D40 DA93 6F               4      LD  L,A
000D41 DA94 2610             7  GKSMC:  LD  H,16
       DA96                     GETKEY1:
000D43 DA96 3E01             7      LD  A,1
       DA97                     SKIP_KEYWAIT:   EQU $-1
000D45 DA98 B7               4      OR  A
000D46 DA99 C4CADA          17      CALL    NZ,CHKEY    ;キーを離すまで待つ
000D49 DA9C 281E            12      JR  Z,GETKEY2
000D4B DA9E BD               4      CP  L
000D4C DA9F 201B            12      JR  NZ,GETKEY2
000D4E DAA1 CD1BCF          17      CALL    RD556VSYNC
000D51 DAA4 87               4      ADD A,A
000D52 DAA5 30EF            12      JR  NC,GETKEY1
       DAA7                     GETKEY1X:
000D54 DAA7 CDCADA          17      CALL    CHKEY       ;キーを離すまで待つ
000D57 DAAA 2810            12      JR  Z,GETKEY2
000D59 DAAC BD               4      CP  L
000D5A DAAD 200D            12      JR  NZ,GETKEY2
000D5C DAAF CD1BCF          17      CALL    RD556VSYNC
000D5F DAB2 87               4      ADD A,A
000D60 DAB3 38F2            12      JR  C,GETKEY1X
000D62 DAB5 25               4      DEC H
000D63 DAB6 20DE            12      JR  NZ,GETKEY1
000D65 DAB8 3E01             7      LD  A,1
000D67 DABA 1805            12      JR  GETKEY3
       DABC                     GETKEY2:
000D69 DABC 3E10             7      LD  A,16
000D6B DABE 3297DA          13      LD  (SKIP_KEYWAIT),A
       DAC1                     GETKEY3:
000D6E DAC1 3295DA          13      LD  (GKSMC+1),A
000D71 DAC4 3A92F0          13      LD  A,(_KEYD)
000D74 DAC7 B7               4      OR  A
000D75 DAC8 E1              10      POP HL
000D76 DAC9 C0              11      RET NZ
       DACA                     CHKEY:
000D77 DACA C5              11      PUSH    BC
000D78 DACB 3E08             7      LD  A,8
000D7A DACD CD0ECF          17      CALL    RDKEYDATA
000D7D DAD0 3293F0          13      LD  (_KEYD+1),A
000D80 DAD3 CB7F             8      BIT 7,A
000D82 DAD5 28A9            12      JR  Z,INKEYB
000D84 DAD7 E5              11      PUSH    HL
000D85 DAD8 0E07             7      LD  C,7
000D87 DADA 2140ED          10      LD  HL,KEY_TABLE
000D8A DADD CB47             8      BIT 0,A
000D8C DADF 2003            12      JR  NZ,CHKEY0
000D8E DAE1 2180ED          10      LD  HL,SHIFT_TABLE
       DAE4                     CHKEY0:
000D91 DAE4 CB77             8      BIT 6,A
000D93 DAE6 2003            12      JR  NZ,CHKEY1
000D95 DAE8 21C0ED          10      LD  HL,CTRL_TABLE
       DAEB                     CHKEY1:
000D98 DAEB 79               4      LD  A,C
000D99 DAEC CD0ECF          17      CALL    RDKEYDATA
000D9C DAEF 0608             7      LD  B,8
       DAF1                     CHKEY2:
000D9E DAF1 87               4      ADD A,A
000D9F DAF2 3009            12      JR  NC,CHKEY3
000DA1 DAF4 23               6      INC HL
000DA2 DAF5 10FA            13      DJNZ    CHKEY2
000DA4 DAF7 0D               4      DEC C
000DA5 DAF8 79               4      LD  A,C
000DA6 DAF9 3C               4      INC A
000DA7 DAFA 20EF            12      JR  NZ,CHKEY1
000DA9 DAFC 06                      DB  $06     ;LD B,?? 次の1バイトを飛ばす
       DAFD                     CHKEY3:
000DAA DAFD 7E               7      LD  A,(HL)
000DAB DAFE E1              10      POP HL
000DAC DAFF C1              10      POP BC
000DAD DB00 1887            12      JR  INKEYD
                                
       DB02                     SCRN:
000DAF DB02 E5              11      PUSH    HL
000DB0 DB03 CD35CF          17      CALL    RDMMIO_BC
000DB3 DB06 6F               4      LD  L,A
000DB4 DB07 26EF             7      LD  H,DC_TABLE/256
000DB6 DB09 7E               7      LD  A,(HL)
000DB7 DB0A FE41             7      CP  'A'     ;英小文字チェック
000DB9 DB0C 380E            12      JR  C,SCRN1
000DBB DB0E FE5B             7      CP  'Z'+1
000DBD DB10 DC1EDB          17      CALL    C,SCRNC
000DC0 DB13 FEA6             7      CP  $A6     ;ひらがなチェック
000DC2 DB15 3805            12      JR  C,SCRN1
000DC4 DB17 FEE0             7      CP  $E0
000DC6 DB19 DC1EDB          17      CALL    C,SCRNC
       DB1C                     SCRN1:
000DC9 DB1C E1              10      POP HL
000DCA DB1D C9              10      RET
                                
       DB1E                     SCRNC:
000DCB DB1E 6F               4      LD  L,A
000DCC DB1F 60               4      LD  H,B
000DCD DB20 CBD8             8      SET 3,B
000DCF DB22 CD35CF          17      CALL    RDMMIO_BC
000DD2 DB25 44               4      LD  B,H
000DD3 DB26 CB7F             8      BIT 7,A
000DD5 DB28 7D               4      LD  A,L
000DD6 DB29 C8              11      RET Z
000DD7 DB2A FE5B             7      CP  'Z'+1
000DD9 DB2C 3804            12      JR  C,SCRNC_ADD
000DDB DB2E FEC0             7      CP  $C0
000DDD DB30 3803            12      JR  C,SCRNC_SUB
       DB32                     SCRNC_ADD:
000DDF DB32 C620             7      ADD A,$20
000DE1 DB34 C9              10      RET
       DB35                     SCRNC_SUB:
000DE2 DB35 D620             7      SUB $20
000DE4 DB37 C9              10      RET
[EOF:M7IO.ASM:SHIFT_JIS]
                                    INCLUDE "LDFILE.ASM"
                                
                                ;   LSX-Dodgers FILE
                                
       DB38                     FILEC:
000DE5 DB38 CD43DB          17      CALL    FILE
       DB3B                     FILEC2:
000DE8 DB3B 3A15F0          13      LD  A,(FDRV+1)
000DEB DB3E FE20             7      CP  020H
000DED DB40 C8              11      RET Z
000DEE DB41 1839            12      JR  SETDIR1
                                
       DB43                     FILE:
000DF0 DB43 AF               4      XOR A
000DF1 DB44 3214F0          13      LD  (FDRV),A
000DF4 DB47 67               4      LD  H,A
000DF5 DB48 6F               4      LD  L,A
000DF6 DB49 2222F0          16      LD  (FDRV+14),HL
000DF9 DB4C CD1ADC          17      CALL    SPCUT
000DFC DB4F CDFFDB          17      CALL    CCHK3
000DFF DB52 2812            12      JR  Z,DEVI1
000E01 DB54 13               6      INC DE
000E02 DB55 1A               7      LD  A,(DE)
000E03 DB56 1B               6      DEC DE
000E04 DB57 FE3A             7      CP  ':'
000E06 DB59 200B            12      JR  NZ,DEVI1
000E08 DB5B 1A               7      LD  A,(DE)      ;DRIVE
000E09 DB5C CD4FDE          17      CALL    CAP
000E0C DB5F D640             7      SUB '@'
000E0E DB61 13               6      INC DE
000E0F DB62 13               6      INC DE
000E10 DB63 3214F0          13      LD  (FDRV),A
       DB66                     DEVI1:
000E13 DB66 1A               7      LD  A,(DE)
000E14 DB67 D65C             7      SUB 05CH        ;\
000E16 DB69 2009            12      JR  NZ,NOROOT
000E18 DB6B 6F               4      LD  L,A     ;A=0でH=0のはずなのでHL=0
000E19 DB6C 222EF0          16      LD  (FDRV+26),HL
000E1C DB6F 2C               4      INC L
000E1D DB70 2222F0          16      LD  (FDRV+14),HL
000E20 DB73 13               6      INC DE
       DB74                     NOROOT:
                                
       DB74                     SETDIR:
000E21 DB74 CDA0DB          17      CALL    FILED
000E24 DB77 1A               7      LD  A,(DE)
000E25 DB78 FE5C             7      CP  05CH        ;\
000E27 DB7A C0              11      RET NZ
000E28 DB7B 13               6      INC DE
       DB7C                     SETDIR1:
000E29 DB7C 3E10             7      LD  A,010H      ;Directory
000E2B DB7E 3221F0          13      LD  (FDRV+13),A
000E2E DB81 D5              11      PUSH    DE
000E2F DB82 1114F0          10      LD  DE,FDRV
000E32 DB85 2A1EF1          16      LD  HL,(STABLE+2*00FH)
000E35 DB88 CD0F00          17      CALL    JP_HL
000E38 DB8B D1              10      POP DE
000E39 DB8C B7               4      OR  A
000E3A DB8D C0              11      RET NZ
                                
000E3B DB8E 3A21F0          13      LD  A,(FDRV+13)
000E3E DB91 CB67             8      BIT 4,A
000E40 DB93 C8              11      RET Z
                                
000E41 DB94 CDE7DB          17      CALL    FILEI
000E44 DB97 2A2EF0          16      LD  HL,(FDRV+26)
000E47 DB9A 23               6      INC HL
000E48 DB9B 2222F0          16      LD  (FDRV+14),HL
000E4B DB9E 18D4            12      JR  SETDIR
                                
       DBA0                     FILED:
000E4D DBA0 CDE7DB          17      CALL    FILEI
000E50 DBA3 2115F0          10      LD  HL,FNAME
                                
000E53 DBA6 0608             7      LD  B,8
       DBA8                     FILE2:
000E55 DBA8 CDF4DB          17      CALL    CCHKF
000E58 DBAB C8              11      RET Z
000E59 DBAC FE2A             7      CP  '*'
000E5B DBAE 282E            12      JR  Z,FILE9
000E5D DBB0 FE2E             7      CP  '.'
000E5F DBB2 280C            12      JR  Z,FILE4
000E61 DBB4 77               7      LD  (HL),A
000E62 DBB5 23               6      INC HL
000E63 DBB6 10F0            13      DJNZ    FILE2
                                
       DBB8                     FILE3:
000E65 DBB8 CDF4DB          17      CALL    CCHKF
000E68 DBBB C8              11      RET Z
000E69 DBBC FE2E             7      CP  '.'
000E6B DBBE 20F8            12      JR  NZ,FILE3
                                
       DBC0                     FILE4:
000E6D DBC0 211DF0          10      LD  HL,FNAME+8
000E70 DBC3 0603             7      LD  B,3
                                
       DBC5                     FILE4L:
000E72 DBC5 CDF4DB          17      CALL    CCHKF
000E75 DBC8 C8              11      RET Z
000E76 DBC9 FE2E             7      CP  '.'
000E78 DBCB 2008            12      JR  NZ,FILE12
000E7A DBCD 3215F0          13      LD  (FNAME),A   ;Parent directory(..)
000E7D DBD0 3216F0          13      LD  (FNAME+1),A
000E80 DBD3 3E20             7      LD  A,020H
       DBD5                     FILE12:
000E82 DBD5 FE2A             7      CP  '*'
000E84 DBD7 280A            12      JR  Z,FILE10
000E86 DBD9 77               7      LD  (HL),A
000E87 DBDA 23               6      INC HL
000E88 DBDB 10E8            13      DJNZ    FILE4L
000E8A DBDD C9              10      RET
                                
       DBDE                     FILE9:              ;名前の*処理、名前の残りを?で埋める
000E8B DBDE CDE3DB          17      CALL    FILE10
000E8E DBE1 18D5            12      JR  FILE3
                                
       DBE3                     FILE10:
000E90 DBE3 3E3F             7      LD  A,'?'
000E92 DBE5 1808            12      JR  FILL_MEMORY
       DBE7                     FILEI:              ;名前＋拡張子をスペースで初期化
000E94 DBE7 3E20             7      LD  A,020H
000E96 DBE9 01000B          10      LD  BC,11*256   ;C=0にしておく
000E99 DBEC 2115F0          10      LD  HL,FNAME
       DBEF                     FILL_MEMORY:            ;HLからBバイトAで埋める
000E9C DBEF 77               7      LD  (HL),A
000E9D DBF0 23               6      INC HL
000E9E DBF1 10FC            13      DJNZ    FILL_MEMORY
000EA0 DBF3 C9              10      RET
                                
       DBF4                     CCHKF:
000EA1 DBF4 1A               7      LD  A,(DE)
000EA2 DBF5 CDFCDB          17      CALL    CCHK2
000EA5 DBF8 C8              11      RET Z
000EA6 DBF9 C362DF          10      JP  FKAN
                                
       DBFC                     CCHK2:
000EA9 DBFC 0C               4      INC C
000EAA DBFD 0D               4      DEC C
000EAB DBFE C0              11      RET NZ
       DBFF                     CCHK3:              ;ZF=1 で使えない文字
000EAC DBFF FE2B             7      CP  '+'
000EAE DC01 C8              11      RET Z
000EAF DC02 FE2C             7      CP  ','
000EB1 DC04 C8              11      RET Z
000EB2 DC05 FE2F             7      CP  '/'
000EB4 DC07 C8              11      RET Z
000EB5 DC08 FE3A             7      CP  ':'
000EB7 DC0A C8              11      RET Z
000EB8 DC0B FE3B             7      CP  ';'
000EBA DC0D C8              11      RET Z
000EBB DC0E FE3D             7      CP  '='
000EBD DC10 C8              11      RET Z
000EBE DC11 FE5C             7      CP  05CH    ;\
000EC0 DC13 C8              11      RET Z
000EC1 DC14 FE20             7      CP  020H
000EC3 DC16 D0              11      RET NC
000EC4 DC17 BF               4      CP  A       ;Z=1
000EC5 DC18 C9              10      RET
                                
       DC19                     SS1:
000EC6 DC19 13               6      INC DE
       DC1A                     SPCUT:              ;スペースをカット
000EC7 DC1A 1A               7      LD  A,(DE)
000EC8 DC1B FE20             7      CP  020H
000ECA DC1D 28FA            12      JR  Z,SS1
000ECC DC1F C9              10      RET
                                
       DC20                     SETDRVF:
000ECD DC20 1114F0          10      LD  DE,FDRV
       DC23                     SETDRV0:
000ED0 DC23 CD2CDC          17      CALL    SETDRV
000ED3 DC26 FDE1            14      POP IY
000ED5 DC28 C1              10      POP BC
000ED6 DC29 D1              10      POP DE
000ED7 DC2A E1              10      POP HL
000ED8 DC2B C9              10      RET
                                
       DC2C                     SETDRV:
000ED9 DC2C E3              19      EX  (SP),HL     ;HL=RETRN ADDRESS
000EDA DC2D D5              11      PUSH    DE      ;PUSH HL/DE/BC/IY
000EDB DC2E C5              11      PUSH    BC
000EDC DC2F 1A               7      LD  A,(DE)
000EDD DC30 D5              11      PUSH    DE
000EDE DC31 FDE3            23      EX  (SP),IY
                                
000EE0 DC33 CD3FDC          17      CALL    GETDRV
000EE3 DC36 3C               4      INC A
000EE4 DC37 FD7700          19      LD  (IY+0),A    ;(FCB)ドライブ番号
000EE7 DC3A 3D               4      DEC A
000EE8 DC3B CDD9F0          17      CALL    _CHGDRV
                                
000EEB DC3E E9               4      JP  (HL)
                                
       DC3F                     GETDRV:
000EEC DC3F E67F             7      AND 07FH
000EEE DC41 D601             7      SUB 001H
000EF0 DC43 3003            12      JR  NC,GETDRV1
000EF2 DC45 3A87F0          13      LD  A,(_DVSW)   ;Current Drive
       DC48                     GETDRV1:
000EF5 DC48 3288F0          13      LD  (_DRV),A
000EF8 DC4B C9              10      RET
                                
       DC4C                     SOPENX:
000EF9 DC4C 1139F0          10      LD  DE,SFILE
000EFC DC4F 1A               7      LD  A,(DE)
000EFD DC50 FDBE00           7      CP  (IY+0)      ;(FCB)ドライブ番号
000F00 DC53 2024            12      JR  NZ,SOPEN
000F02 DC55 13               6      INC DE
000F03 DC56 FDE5            15      PUSH    IY
000F05 DC58 E1              10      POP HL
000F06 DC59 23               6      INC HL
000F07 DC5A CDE7DD          17      CALL    CPFILE
000F0A DC5D 201A            12      JR  NZ,SOPEN
                                
000F0C DC5F 2AF4F1          16      LD  HL,(SCDIR)
000F0F DC62 FD750E          19      LD  (IY+14),L   ;(FCB)アクセスするディレクトリのクラスタ番号+1
000F12 DC65 FD740F          19      LD  (IY+15),H
                                
000F15 DC68 2AF8F1          16      LD  HL,(SFNDF)  ;Direcroty location and Flags
000F18 DC6B 229FF0          16      LD  (_FILEN),HL
                                
000F1B DC6E ED5BF6F1        20      LD  DE,(SFBPS)
000F1F DC72 2139F0          10      LD  HL,SFILE
000F22 DC75 36FF            10      LD  (HL),0FFH
000F24 DC77 23               6      INC HL
000F25 DC78 C9              10      RET
       DC79                     SOPEN:
000F26 DC79 218FDD          10      LD  HL,FILESE
       DC7C                     SOPENC:
000F29 DC7C 22B5DC          16      LD  (OPENPAT+1),HL
                                
000F2C DC7F CDE2F0          17      CALL    _RDFATX     ;Detect Media
000F2F DC82 3856            12      JR  C,RDDERR
                                
000F31 DC84 AF               4      XOR A
000F32 DC85 329FF0          13      LD  (_FILEN),A
000F35 DC88 CD8FDE          17      CALL    LDDIRX1     ;A=0で呼び出す
000F38 DC8B 2818            12      JR  Z,SDIRX1
                                
000F3A DC8D CD80DD          17      CALL    READ_DIR    ;Sub Directory
000F3D DC90 3808            12      JR  C,SDIRX0
000F3F DC92 2A7EF1          16      LD  HL,(_DTBUF)
000F42 DC95 7E               7      LD  A,(HL)
000F43 DC96 FE2E             7      CP  '.'
000F45 DC98 280F            12      JR  Z,SOPEN1
       DC9A                     SDIRX0:
000F47 DC9A AF               4      XOR A
000F48 DC9B 32A0F0          13      LD  (_DIRF),A
000F4B DC9E FD360E01        19      LD  (IY+14),1   ;(FCB)レコードサイズ
000F4F DCA2 FD770F          19      LD  (IY+15),A
       DCA5                     SDIRX1:
000F52 DCA5 ED5BFCF1        20      LD  DE,(_DIRPS) ;Root Directory
       DCA9                     SOPEN1:
000F56 DCA9 0E20             7      LD  C,32        ;自己書き換え 1セクタ辺りのディレクトリエントリ数  1024=32 / 512=16 / 256=8
       DCAA                     SDECPAT EQU $-1
       DCAB                     SOPEN1X:
000F58 DCAB CD80DD          17      CALL    READ_DIR    ;FILE SEARCH
000F5B DCAE 382A            12      JR  C,RDDERR
000F5D DCB0 2A7EF1          16      LD  HL,(_DTBUF)
       DCB3                     SOPEN2:
000F60 DCB3 D5              11      PUSH    DE
000F61 DCB4 CD8FDD          17  OPENPAT:CALL    FILESE      ;(self-modifying code)
000F64 DCB7 D1              10      POP DE
000F65 DCB8 386E            12      JR  C,SOPENE
000F67 DCBA 281B            12      JR  Z,SCF_FF_RET
       DCBC                     SOPEN3:
000F69 DCBC 3AA0F0          13      LD  A,(_DIRF)   ;ディレクトリか判別
000F6C DCBF B7               4      OR  A
000F6D DCC0 200C            12      JR  NZ,SOPEN5
000F6F DCC2 13               6      INC DE      ;ルートディレクトリ
000F70 DCC3 E5              11      PUSH    HL
000F71 DCC4 210C00          10      LD  HL,12       ;(self-modifying code)MAXDIR
       DCC5                     MD_PAT  EQU $-2
000F74 DCC7 ED52            15      SBC HL,DE       ;CF=0 なので SUB HL,DE
000F76 DCC9 E1              10      POP HL
000F77 DCCA 20DD            12      JR  NZ,SOPEN1
000F79 DCCC 1807            12      JR  SOPEN6
       DCCE                     SOPEN5:
000F7B DCCE CDA4E5          17      CALL    GNCLX       ;END DIR
000F7E DCD1 D8              11      RET C
000F7F DCD2 CD47DE          17      CALL    ENDCL
       DCD5                     SOPEN6:
000F82 DCD5 38D2            12      JR  C,SOPEN1
       DCD7                     SCF_FF_RET:
000F84 DCD7 37               4      SCF         ;CF=1
000F85 DCD8 9F               4      SBC A,A     ;A=0FFH
000F86 DCD9 C9              10      RET
                                
       DCDA                     RDDERR:
000F87 DCDA BF               4      CP  A       ;READ ERR CF=1 ZF=1
000F88 DCDB 37               4      SCF
000F89 DCDC C9              10      RET
                                
       DCDD                     NOPEN:
000F8A DCDD 218FDD          10      LD  HL,FILESE
000F8D DCE0 22B5DC          16      LD  (OPENPAT+1),HL
000F90 DCE3 FD2A98F0        20      LD  IY,(_FCB)
000F94 DCE7 CD75DF          17      CALL    CHKWILDX
000F97 DCEA 30EB            12      JR  NC,SCF_FF_RET
000F99 DCEC FD7E00          19      LD  A,(IY+0)    ;(FCB)ドライブ番号
000F9C DCEF 3D               4      DEC A
000F9D DCF0 3288F0          13      LD  (_DRV),A
000FA0 DCF3 CDD9F0          17      CALL    _CHGDRV
000FA3 DCF6 D8              11      RET C
000FA4 DCF7 2AF8F1          16      LD  HL,(SFNDF)  ;Direcroty location and Flags
000FA7 DCFA 229FF0          16      LD  (_FILEN),HL
                                
000FAA DCFD CD8ADE          17      CALL    LDDIRX
000FAD DD00 ED5B9AF0        20      LD  DE,(_FBPS)
000FB1 DD04 CD80DD          17      CALL    READ_DIR
000FB4 DD07 38D1            12      JR  C,RDDERR
000FB6 DD09 3A9EF0          13      LD  A,(_FBCNT)
000FB9 DD0C 3D               4      DEC A
000FBA DD0D 28AD            12      JR  Z,SOPEN3
       DD0F                     NOPEN2:
000FBC DD0F 2A9CF0          16      LD  HL,(_FBAD)
000FBF DD12 012000          10      LD  BC,020H
000FC2 DD15 09              11      ADD HL,BC
000FC3 DD16 4F               4      LD  C,A
000FC4 DD17 189A            12      JR  SOPEN2
                                
       DD19                     SOPENE2:
000FC6 DD19 229CF0          16      LD  (_FBAD),HL
000FC9 DD1C 79               4      LD  A,C
000FCA DD1D 329EF0          13      LD  (_FBCNT),A
000FCD DD20 ED539AF0        20      LD  (_FBPS),DE
000FD1 DD24 FD2298F0        20      LD  (_FCB),IY
       DD28                     SOPENE:
000FD5 DD28 AF               4      XOR A
000FD6 DD29 C9              10      RET
                                
       DD2A                     COPEN:
000FD7 DD2A FD360D20        19      LD  (IY+13),020H    ;(FCB)属性(アトリビュート)
                                
000FDB DD2E 21ACDD          10      LD  HL,NEXTSE
000FDE DD31 CD7CDC          17      CALL    SOPENC
000FE1 DD34 D0              11      RET NC
000FE2 DD35 C8              11      RET Z
000FE3 DD36 3AA0F0          13      LD  A,(_DIRF)   ;ディレクトリか判別
000FE6 DD39 B7               4      OR  A
000FE7 DD3A 37               4      SCF
000FE8 DD3B C8              11      RET Z       ;ルートディレクトリ
000FE9 DD3C 0601             7      LD  B,1
000FEB DD3E CDD4DF          17      CALL    WRDF
000FEE DD41 D8              11      RET C
000FEF DD42 ED5BFEF1        20      LD  DE,(_CLPS)
000FF3 DD46 D5              11      PUSH    DE
000FF4 DD47 CD10DE          17      CALL    DCPAT
000FF7 DD4A CD2FE4          17      CALL    DRDNX
000FFA DD4D 2A7EF1          16      LD  HL,(_DTBUF) ;ディレクトリエントリを0クリア
000FFD DD50 3A39E3          13      LD  A,(SECSZ+2) ;1024=4 / 512=2 / 256=1
001000 DD53 47               4      LD  B,A
001001 DD54 AF               4      XOR A
001002 DD55 4F               4      LD  C,A
       DD56                     COPENCL:
001003 DD56 77               7      LD  (HL),A
001004 DD57 EDA1            16      CPI         ;HL=HL+1 BC=BC-1 BCが0の場合にP/V=0
001006 DD59 EA56DD          10      JP  PE,COPENCL
                                
001009 DD5C 3A2EDE          13      LD  A,(SPCPAT)  ;1クラスタの論理セクタ数
00100C DD5F 3D               4      DEC A
00100D DD60 2819            12      JR  Z,COPENE
00100F DD62 3E01             7      LD  A,1     ;1セクタ辺りのセクタ数が2以上の場合
001011 DD64 329CE5          13      LD  (_SECPS),A
001014 DD67 D1              10      POP DE      ;DE=(_CLPS)
001015 DD68 D5              11      PUSH    DE
       DD69                     COPEN1:
001016 DD69 D5              11      PUSH    DE      ;データバッファに入らないセクタもゼロクリア
001017 DD6A C5              11      PUSH    BC
001018 DD6B 2A7EF1          16      LD  HL,(_DTBUF)
00101B DD6E CD2ADE          17      CALL    CLUSTX
00101E DD71 CD34E7          17      CALL    DWT24
001021 DD74 C1              10      POP BC
001022 DD75 D1              10      POP DE
001023 DD76 CD9BE5          17      CALL    NEXTX
001026 DD79 20EE            12      JR  NZ,COPEN1
       DD7B                     COPENE:
001028 DD7B 2A7EF1          16      LD  HL,(_DTBUF)
00102B DD7E D1              10      POP DE
00102C DD7F C9              10      RET
                                
       DD80                     READ_DIR:
00102D DD80 ED53FEF1        20      LD  (_CLPS),DE
001031 DD84 C5              11      PUSH    BC
001032 DD85 D5              11      PUSH    DE
001033 DD86 CD10DE          17      CALL    DCPAT
001036 DD89 CD0FE4          17      CALL    DRDX
001039 DD8C D1              10      POP DE
00103A DD8D C1              10      POP BC
00103B DD8E C9              10      RET
                                
       DD8F                     FILESE:
00103C DD8F 7E               7      LD  A,(HL)
00103D DD90 B7               4      OR  A
00103E DD91 C8              11      RET Z       ;END:ZF=1 CF=0
00103F DD92 FEE5             7      CP  0E5H
001041 DD94 280E            12      JR  Z,FILESE1
001043 DD96 FDE5            15      PUSH    IY
001045 DD98 D1              10      POP DE
001046 DD99 13               6      INC DE
001047 DD9A E5              11      PUSH    HL
001048 DD9B CDE7DD          17      CALL    CPFILE
00104B DD9E CC08DE          17      CALL    Z,CPFILE2
00104E DDA1 E1              10      POP HL
00104F DDA2 37               4      SCF
001050 DDA3 C8              11      RET Z       ;!!!:(ZF=1) CF=1
       DDA4                     FILESE1:
001051 DDA4 CDBBDD          17      CALL    FNEXT
001054 DDA7 20E6            12      JR  NZ,FILESE
       DDA9                     ZF0_CF0_AFF_RET:
001056 DDA9 F6FF             7      OR  0FFH        ;ZF=0 CF=0
001058 DDAB C9              10      RET
                                
       DDAC                     NEXTSE:
001059 DDAC 7E               7      LD  A,(HL)
00105A DDAD B7               4      OR  A
00105B DDAE 37               4      SCF
00105C DDAF C8              11      RET Z       ;!!!:ZF=1 CF=1
00105D DDB0 FEE5             7      CP  0E5H
00105F DDB2 37               4      SCF
001060 DDB3 C8              11      RET Z       ;!!!:(ZF=1) CF=1
001061 DDB4 CDBBDD          17      CALL    FNEXT
001064 DDB7 20F3            12      JR  NZ,NEXTSE
001066 DDB9 18EE            12      JR  ZF0_CF0_AFF_RET
                                
       DDBB                     FNEXT:
001068 DDBB E5              11      PUSH    HL
001069 DDBC 219FF0          10      LD  HL,_FILEN
00106C DDBF 34              11      INC (HL)
00106D DDC0 E1              10      POP HL
00106E DDC1 112000          10      LD  DE,020H
001071 DDC4 19              11      ADD HL,DE
001072 DDC5 0D               4      DEC C
001073 DDC6 C9              10      RET
                                
       DDC7                     CPNAME:
001074 DDC7 C5              11      PUSH    BC
001075 DDC8 D5              11      PUSH    DE
001076 DDC9 E5              11      PUSH    HL
001077 DDCA CDE1DD          17      CALL    CPFILE4
00107A DDCD E1              10      POP HL
00107B DDCE 23               6      INC HL
00107C DDCF 23               6      INC HL
00107D DDD0 23               6      INC HL
00107E DDD1 23               6      INC HL
00107F DDD2 D1              10      POP DE
001080 DDD3 C1              10      POP BC
001081 DDD4 2005            12      JR  NZ,CPNAME1
001083 DDD6 7E               7      LD  A,(HL)
001084 DDD7 23               6      INC HL
001085 DDD8 66               7      LD  H,(HL)
001086 DDD9 6F               4      LD  L,A
001087 DDDA C9              10      RET
       DDDB                     CPNAME1:
001088 DDDB 23               6      INC HL
001089 DDDC 23               6      INC HL
00108A DDDD 10E8            13      DJNZ    CPNAME
00108C DDDF 37               4      SCF
00108D DDE0 C9              10      RET
                                
       DDE1                     CPFILE4:
00108E DDE1 C5              11      PUSH    BC
00108F DDE2 010004          10      LD  BC,00400H
001092 DDE5 1804            12      JR  CPSTR1
       DDE7                     CPFILE:
001094 DDE7 C5              11      PUSH    BC
001095 DDE8 01000B          10      LD  BC,00B00H
       DDEB                     CPSTR1:
001098 DDEB 1A               7      LD  A,(DE)
001099 DDEC FE3F             7      CP  '?'     ;Wild card
00109B DDEE 2812            12      JR  Z,CPSTR2
00109D DDF0 7E               7      LD  A,(HL)
00109E DDF1 CD5BDF          17      CALL    FKANC
0010A1 DDF4 E5              11      PUSH    HL
0010A2 DDF5 67               4      LD  H,A
0010A3 DDF6 1A               7      LD  A,(DE)
0010A4 DDF7 CB01             4      RLC C
0010A6 DDF9 CD5BDF          17      CALL    FKANC
0010A9 DDFC CB09             4      RRC C
0010AB DDFE BC               4      CP  H       ;CP (HL),(DE)
0010AC DDFF E1              10      POP HL
0010AD DE00 2004            12      JR  NZ,CPSTR3
       DE02                     CPSTR2:
0010AF DE02 13               6      INC DE
0010B0 DE03 23               6      INC HL
0010B1 DE04 10E5            13      DJNZ    CPSTR1
       DE06                     CPSTR3:
0010B3 DE06 C1              10      POP BC
0010B4 DE07 C9              10      RET
                                
       DE08                     CPFILE2:
0010B5 DE08 FD7E0D          19      LD  A,(IY+13)   ;(FCB)属性(アトリビュート)
0010B8 DE0B F6E1             7      OR  0E1H
0010BA DE0D 2F               4      CPL
0010BB DE0E A6               7      AND (HL)
0010BC DE0F C9              10      RET
                                
       DE10                     DCPAT:
0010BD DE10 0E00             7      LD  C,0
0010BF DE12 2A7EF1          16      LD  HL,(_DTBUF)
0010C2 DE15 3AA0F0          13      LD  A,(_DIRF)   ;ディレクトリか判別
0010C5 DE18 B7               4      OR  A
0010C6 DE19 C8              11      RET Z       ;ルートディレクトリの場合はCレジスタを0にしておく(CDEがセクタ番号)
0010C7 DE1A 3A2EDE          13      LD  A,(SPCPAT)
0010CA DE1D 4F               4      LD  C,A
0010CB DE1E 3A9CE5          13      LD  A,(_SECPS)
0010CE DE21 B9               4      CP  C
0010CF DE22 3801            12      JR  C,DC1
0010D1 DE24 AF               4      XOR A
       DE25                     DC1:
0010D2 DE25 F680             7      OR  080H
0010D4 DE27 32A0F0          13      LD  (_DIRF),A   ;bit0-6:セクタインデックス
       DE2A                     CLUSTX:
0010D7 DE2A E5              11      PUSH    HL
0010D8 DE2B EB               4      EX  DE,HL
0010D9 DE2C AF               4      XOR A
0010DA DE2D 0E01             7      LD  C,1     ;自己書き換え（1クラスタの論理セクタ数）
       DE2E                     SPCPAT  EQU $-1
       DE2F                     L_CLDBL:
0010DC DE2F CB19             8      RR  C       ;->CF
0010DE DE31 3804            12      JR  C,E_CLDBL
0010E0 DE33 29              11      ADD HL,HL       ;*2
0010E1 DE34 8F               4      ADC A,A
0010E2 DE35 18F8            12      JR  L_CLDBL
       DE37                     E_CLDBL:
0010E4 DE37 4F               4      LD  C,A
0010E5 DE38 3A9CE5          13      LD  A,(_SECPS)
0010E8 DE3B B5               4      OR  L
0010E9 DE3C 6F               4      LD  L,A
0010EA DE3D 110800          10      LD  DE,8    ;+8 (2D)  !ADDCL (self-modifying code)
       DE3E                     CLSPAT  EQU $-2
0010ED DE40 AF               4      XOR A
0010EE DE41 19              11      ADD HL,DE   ;データ格納領域の先頭論理セクタ番号
0010EF DE42 89               4      ADC A,C
0010F0 DE43 4F               4      LD  C,A
0010F1 DE44 EB               4      EX  DE,HL
0010F2 DE45 E1              10      POP HL
0010F3 DE46 C9              10      RET
                                
       DE47                     ENDCL:
0010F4 DE47 7A               4      LD  A,D ;END CLUSTER
0010F5 DE48 FE01             7      CP  1   ;164=356    (self-modifying code)
       DE49                     CLPAT1  EQU $-1
0010F7 DE4A C0              11      RET NZ
0010F8 DE4B 7B               4      LD  A,E
0010F9 DE4C FE64             7      CP  064H    ;       (self-modifying code)
       DE4D                     CLPAT2  EQU $-1
0010FB DE4E C9              10      RET
                                
       DE4F                     CAP:
0010FC DE4F FE61             7      CP  'a'
0010FE DE51 D8              11      RET C
0010FF DE52 FE7B             7      CP  'z'+1
001101 DE54 D0              11      RET NC
001102 DE55 D620             7      SUB 020H
001104 DE57 C9              10      RET
       DE58                     CAP2:
001105 DE58 CD4FDE          17      CALL    CAP
       DE5B                     CAP3:               ;
001108 DE5B FE05             7      CP  5
00110A DE5D 2803            12      JR  Z,CAP4
00110C DE5F FE21             7      CP  021H
00110E DE61 C9              10      RET
       DE62                     CAP4:
00110F DE62 3EE5             7      LD  A,0E5H
001111 DE64 C9              10      RET
                                
       DE65                     CHDIR:
001112 DE65 CD62E8          17      CALL    GETDPBD
001115 DE68 381D            12      JR  C,CHDIR2
001117 DE6A DD751A          19      LD  (IX+DPB_SDIR),L
00111A DE6D DD741B          19      LD  (IX+DPB_SDIR+1),H
00111D DE70 1815            12      JR  CHDIR2      ;POP_IX_RET
                                
       DE72                     LDDIR:
00111F DE72 CD62E8          17      CALL    GETDPBD
001122 DE75 DD5E1A          19      LD  E,(IX+DPB_SDIR)
001125 DE78 DD561B          19      LD  D,(IX+DPB_SDIR+1)
001128 DE7B 13               6      INC DE
001129 DE7C FD730E          19      LD  (IY+14),E   ;(FCB)アクセスするディレクトリのクラスタ番号+1
00112C DE7F FD720F          19      LD  (IY+15),D
00112F DE82 1B               6      DEC DE
001130 DE83 AF               4      XOR A
001131 DE84 32A0F0          13      LD  (_DIRF),A
       DE87                     CHDIR2:
001134 DE87 DDE1            14      POP IX
001136 DE89 C9              10      RET
                                
       DE8A                     LDDIRX:
001137 DE8A 3AA0F0          13      LD  A,(_DIRF)   ;(FCB)アクセスするディレクトリのセクタインデックス
00113A DE8D E67F             7      AND 07FH
       DE8F                     LDDIRX1:
00113C DE8F 329CE5          13      LD  (_SECPS),A
00113F DE92 FD5E0E          19      LD  E,(IY+14)   ;(FCB)アクセスするディレクトリのクラスタ番号+1
001142 DE95 FD560F          19      LD  D,(IY+15)
001145 DE98 1B               6      DEC DE
001146 DE99 CD47DE          17      CALL    ENDCL
001149 DE9C D472DE          17      CALL    NC,LDDIR
       DE9F                     LDDIRS:
00114C DE9F 7A               4      LD  A,D
00114D DEA0 B3               4      OR  E
00114E DEA1 32A0F0          13      LD  (_DIRF),A   ;ディレクトリか判別
001151 DEA4 C9              10      RET
                                
       DEA5                     KILL:
001152 DEA5 CD75DF          17      CALL    CHKWILDX
001155 DEA8 3834            12      JR  C,KILLW
001157 DEAA CD4CDC          17      CALL    SOPENX
       DEAD                     KILLS:
00115A DEAD 3E1F             7      LD  A,01FH
00115C DEAF D4F1DE          17      CALL    NC,CHKATT
00115F DEB2 D8              11      RET C
       DEB3                     KILLSX:
001160 DEB3 36E5            10      LD  (HL),0E5H   ;DIR
001162 DEB5 CD4FDF          17      CALL    WTDB
001165 DEB8 111A00          10      LD  DE,01AH
001168 DEBB 19              11      ADD HL,DE
001169 DEBC 5E               7      LD  E,(HL)
00116A DEBD 23               6      INC HL
00116B DEBE 56               7      LD  D,(HL)
       DEBF                     KILLS1:
00116C DEBF CD47DE          17      CALL    ENDCL
00116F DEC2 D0              11      RET NC      ;CF=0
001170 DEC3 21FEFF          10      LD  HL,0-2
001173 DEC6 19              11      ADD HL,DE
001174 DEC7 D0              11      RET NC      ;DE= 0 or 1
001175 DEC8 D5              11      PUSH    DE
001176 DEC9 CDF7F0          17      CALL    _GNCL
001179 DECC ED53FEF1        20      LD  (_CLPS),DE
00117D DED0 D1              10      POP DE
00117E DED1 210000          10      LD  HL,0
001181 DED4 D4FAF0          17      CALL    NC,_SNCL
001184 DED7 D8              11      RET C
001185 DED8 ED5BFEF1        20      LD  DE,(_CLPS)  ;FAT
001189 DEDC 18E1            12      JR  KILLS1
                                
       DEDE                     KILLW:
00118B DEDE CD79DC          17      CALL    SOPEN
       DEE1                     KILLW1:
00118E DEE1 380B            12      JR  C,KILLW2
001190 DEE3 CD19DD          17      CALL    SOPENE2
001193 DEE6 CDADDE          17      CALL    KILLS
001196 DEE9 CDDDDC          17      CALL    NOPEN
001199 DEEC 18F3            12      JR  KILLW1
       DEEE                     KILLW2:
00119B DEEE C8              11      RET Z
00119C DEEF 3F               4      CCF
00119D DEF0 C9              10      RET
                                
       DEF1                     CHKATT:
00119E DEF1 E5              11      PUSH    HL
00119F DEF2 110B00          10      LD  DE,00BH
0011A2 DEF5 19              11      ADD HL,DE
0011A3 DEF6 A6               7      AND (HL)
0011A4 DEF7 E1              10      POP HL
0011A5 DEF8 C8              11      RET Z
0011A6 DEF9 37               4      SCF
0011A7 DEFA C9              10      RET
                                
       DEFB                     NAME:
0011A8 DEFB CD75DF          17      CALL    CHKWILDX
0011AB DEFE D8              11      RET C
0011AC DEFF 110400          10      LD  DE,4
0011AF DF02 19              11      ADD HL,DE
0011B0 DF03 221BDF          16      LD  (NAMEP+2),HL
0011B3 DF06 23               6      INC HL
0011B4 DF07 CD79DF          17      CALL    CHKWILD
0011B7 DF0A D8              11      RET C
                                
0011B8 DF0B CD4CDC          17      CALL    SOPENX
0011BB DF0E 3E0F             7      LD  A,00FH
0011BD DF10 D4F1DE          17      CALL    NC,CHKATT
0011C0 DF13 D8              11      RET C
                                
0011C1 DF14 FD7E00          19      LD  A,(IY+0)
0011C4 DF17 FDE5            15      PUSH    IY
0011C6 DF19 FD210000        14  NAMEP:  LD  IY,0        ;自己書き換え
0011CA DF1D FD7700          19      LD  (IY+0),A
0011CD DF20 CD4CDC          17      CALL    SOPENX
0011D0 DF23 FDE3            23      EX  (SP),IY
0011D2 DF25 3F               4      CCF
0011D3 DF26 D479DC          17      CALL    NC,SOPEN
0011D6 DF29 EB               4      EX  DE,HL
0011D7 DF2A E1              10      POP HL
0011D8 DF2B D8              11      RET C
                                
       DF2C                     SETNAME:
0011D9 DF2C 01000B          10      LD  BC,11*256
0011DC DF2F 23               6      INC HL
0011DD DF30 7E               7      LD  A,(HL)
0011DE DF31 FEE5             7      CP  0E5H
0011E0 DF33 2004            12      JR  NZ,SNAME1
0011E2 DF35 3E05             7      LD  A,5
0011E4 DF37 180E            12      JR  SNAME3
       DF39                     SNAME1:
0011E6 DF39 7E               7      LD  A,(HL)
0011E7 DF3A 0C               4      INC C
0011E8 DF3B 0D               4      DEC C
0011E9 DF3C 2009            12      JR  NZ,SNAME3
0011EB DF3E CD4FDE          17      CALL    CAP
0011EE DF41 FEA0             7      CP  0A0H
0011F0 DF43 2002            12      JR  NZ,SNAME3
0011F2 DF45 3E20             7      LD  A,020H
       DF47                     SNAME3:
0011F4 DF47 12               7      LD  (DE),A
0011F5 DF48 7E               7      LD  A,(HL)
0011F6 DF49 23               6      INC HL
0011F7 DF4A CD62DF          17      CALL    FKAN
0011FA DF4D 10EA            13      DJNZ    SNAME1
       DF4F                     WTDB:
0011FC DF4F 3EFF             7      LD  A,0FFH
0011FE DF51 3239F0          13      LD  (SFILE),A
       DF54                     SWTDBF:
001201 DF54 3E01             7      LD  A,1
001203 DF56 32A4F0          13      LD  (_WTDBF),A
001206 DF59 AF               4      XOR A
001207 DF5A C9              10      RET
                                
       DF5B                     FKANC:
001208 DF5B CB41             8      BIT 0,C
00120A DF5D CC58DE          17      CALL    Z,CAP2
00120D DF60 1801            12      JR  FKANX
       DF62                     FKAN:           ;漢字チェック
00120F DF62 13               6      INC DE
       DF63                     FKANX:
001210 DF63 CB41             8      BIT 0,C
001212 DF65 CB81             8      RES 0,C
001214 DF67 C0              11      RET NZ
001215 DF68 FE80             7      CP  080H
001217 DF6A D8              11      RET C
001218 DF6B FEA0             7      CP  0A0H
00121A DF6D 3803            12      JR  C,FKAN1
00121C DF6F FEE0             7      CP  0E0H
00121E DF71 D8              11      RET C
       DF72                     FKAN1:
00121F DF72 0C               4      INC C
001220 DF73 A7               4      AND A
001221 DF74 C9              10      RET
                                
       DF75                     CHKWILDX:
001222 DF75 FDE5            15      PUSH    IY
001224 DF77 E1              10      POP HL
001225 DF78 23               6      INC HL
       DF79                     CHKWILD:
001226 DF79 060B             7      LD  B,11
001228 DF7B 3E3F             7      LD  A,'?'
       DF7D                     CHKWIL1:
00122A DF7D BE               7      CP  (HL)
00122B DF7E 23               6      INC HL
00122C DF7F 37               4      SCF
00122D DF80 C8              11      RET Z
00122E DF81 10FA            13      DJNZ    CHKWIL1
001230 DF83 AF               4      XOR A
001231 DF84 C9              10      RET
                                
       DF85                     SDIRENT:        ;IY=FCB HL=DIR
001232 DF85 D5              11      PUSH    DE
001233 DF86 E5              11      PUSH    HL
001234 DF87 FDE5            15      PUSH    IY
001236 DF89 D1              10      POP DE
001237 DF8A EB               4      EX  DE,HL
001238 DF8B CD2CDF          17      CALL    SETNAME
                                ;               Attribute
00123B DF8E FD7E0D          19      LD  A,(IY+13)   ;(FCB)属性(アトリビュート)
00123E DF91 12               7      LD  (DE),A
00123F DF92 13               6      INC DE
                                ;               Reserved
001240 DF93 AF               4      XOR A
001241 DF94 060A             7      LD  B,10
       DF96                     SDE1:
001243 DF96 12               7      LD  (DE),A
001244 DF97 13               6      INC DE
001245 DF98 10FC            13      DJNZ    SDE1
                                                    ;(FCB)更新時刻
001247 DF9A 21E4F1          10      LD  HL,SDDATA       ;(FCB)更新年月日
00124A DF9D 060A             7      LD  B,SDDATAE-SDDATA    ;(FCB)ファイルの先頭クラスタ
       DF9F                     SDLOOP:                 ;(FCB)ファイルのサイズ(バイト単位)
00124C DF9F 7E               7      LD  A,(HL)
00124D DFA0 23               6      INC HL
00124E DFA1 32A6DF          13      LD  (SDPAT+2),A
001251 DFA4 FD7E00          19  SDPAT:  LD  A,(IY+0)    ;LD A,(IY+A)
001254 DFA7 12               7      LD  (DE),A
001255 DFA8 13               6      INC DE
001256 DFA9 10F4            13      DJNZ    SDLOOP
                                
001258 DFAB AF               4      XOR A
001259 DFAC E1              10      POP HL
00125A DFAD D1              10      POP DE
00125B DFAE C9              10      RET
                                
       DFAF                     WOPEN:
00125C DFAF FD7E0D          19      LD  A,(IY+13)   ;(FCB)属性(アトリビュート)
00125F DFB2 E61F             7      AND 01FH
001261 DFB4 37               4      SCF
001262 DFB5 C0              11      RET NZ
001263 DFB6 FD361CFE        19      LD  (IY+28),0FEH    ;(FCB)オープンモード
       DFBA                     TOPEN2:
001267 DFBA AF               4      XOR A
       DFBB                     TOPEN:              ;Initializes the time stamp
001268 DFBB FD3617FF        19      LD  (IY+23),0FFH    ;(FCB)更新時刻
00126C DFBF C9              10      RET
                                
       DFC0                     WRDFX:
00126D DFC0 3A2EDE          13      LD  A,(SPCPAT)  ;1クラスタの論理セクタ
       DFC3                     L_WRFX:
001270 DFC3 1F               4      RRA         ;->CF
001271 DFC4 3806            12      JR  C,E_WRFX
001273 DFC6 CB39             8      SRL C
001275 DFC8 CB1C             8      RR  H       ;CH=CH/2
001277 DFCA 18F7            12      JR  L_WRFX
       DFCC                     E_WRFX:
001279 DFCC 41               4      LD  B,C
00127A DFCD 4C               4      LD  C,H
00127B DFCE 03               6      INC BC
00127C DFCF 3E37             7      LD  A,037H      ;SCF
00127E DFD1 322CE4          13      LD  (DRDN1),A
                                
       DFD4                     WRDF:               ;BCクラスタ分FATを確保する
001281 DFD4 110200          10      LD  DE,2
001284 DFD7 AF               4      XOR A
001285 DFD8 329CE5          13      LD  (_SECPS),A
       DFDB                     WRDF1:
001288 DFDB C5              11      PUSH    BC
001289 DFDC D5              11      PUSH    DE
00128A DFDD CDF7F0          17      CALL    _GNCL
00128D DFE0 381C            12      JR  C,WRDF3
00128F DFE2 7A               4      LD  A,D     ;空いているかチェック
001290 DFE3 B3               4      OR  E
001291 DFE4 202A            12      JR  NZ,WRDF4
001293 DFE6 E1              10      POP HL      ;HL=空いているクラスタ
001294 DFE7 E5              11      PUSH    HL
001295 DFE8 ED5BFEF1        20      LD  DE,(_CLPS)  ;DE=元の(_CLPS)
001299 DFEC 22FEF1          16      LD  (_CLPS),HL
00129C DFEF 7A               4      LD  A,D     ;元の(_CLPS)が 0 か?
00129D DFF0 B3               4      OR  E
00129E DFF1 2008            12      JR  NZ,WRDF2
0012A0 DFF3 FD751A          19      LD  (IY+26),L   ;(FCB)ファイルの先頭クラスタ
0012A3 DFF6 FD741B          19      LD  (IY+27),H   ;元が空の場合はFCBにクラスタをセットする
0012A6 DFF9 1803            12      JR  WRDF3
       DFFB                     WRDF2:
0012A8 DFFB CDFAF0          17      CALL    _SNCL
       DFFE                     WRDF3:
0012AB DFFE D1              10      POP DE
0012AC DFFF C1              10      POP BC
0012AD E000 D8              11      RET C
0012AE E001 0B               6      DEC BC
0012AF E002 78               4      LD  A,B
0012B0 E003 B1               4      OR  C
0012B1 E004 200C            12      JR  NZ,WRDF5    ;ここでループカウンタチェック
0012B3 E006 ED5BFEF1        20      LD  DE,(_CLPS)
0012B7 E00A 21FFFF          10      LD  HL,0FFFFH   ;FATエントリ終了(EOCマーク)
0012BA E00D C3FAF0          10      JP  _SNCL
                                
       E010                     WRDF4:              ;DEクラスタが空じゃないので次に移動する
0012BD E010 D1              10      POP DE
0012BE E011 C1              10      POP BC
       E012                     WRDF5:
0012BF E012 13               6      INC DE
0012C0 E013 CD47DE          17      CALL    ENDCL
0012C3 E016 38C3            12      JR  C,WRDF1
0012C5 E018 37               4      SCF
0012C6 E019 C9              10      RET
                                
       E01A                     RWXR:
0012C7 E01A 3A39E3          13      LD  A,(SECSZ+2) ;1024=4 / 512=2 / 256=1
       E01D                     L_RWX:
0012CA E01D 1F               4      RRA     ;->CF
0012CB E01E 3808            12      JR  C,E_RWX
0012CD E020 CB38             8      SRL B   ;BCH=BCH/2
0012CF E022 CB19             8      RR  C   ;
0012D1 E024 CB1C             8      RR  H   ;
0012D3 E026 18F5            12      JR  L_RWX
       E028                     E_RWX:
0012D5 E028 FD5E1A          19      LD  E,(IY+26)   ;(FCB)ファイルの先頭クラスタ
0012D8 E02B FD561B          19      LD  D,(IY+27)
0012DB E02E AF               4      XOR A
0012DC E02F 329CE5          13      LD  (_SECPS),A
       E032                     RWX1:
0012DF E032 ED53FEF1        20      LD  (_CLPS),DE
0012E3 E036 7A               4      LD  A,D
0012E4 E037 B3               4      OR  E
0012E5 E038 2813            12      JR  Z,SCF_RET   ;RET DE==0 => CF=1
                                
0012E7 E03A 78               4      LD  A,B
0012E8 E03B B1               4      OR  C
0012E9 E03C B4               4      OR  H
0012EA E03D C8              11      RET Z       ;RET BCH==0 => CF=0
                                
0012EB E03E CDA4E5          17      CALL    GNCLX
0012EE E041 D8              11      RET C
0012EF E042 7C               4      LD  A,H     ;
0012F0 E043 25               4      DEC H       ;
0012F1 E044 B7               4      OR  A       ;DEC BCH
0012F2 E045 2001            12      JR  NZ,RWX2     ;
0012F4 E047 0B               6      DEC BC      ;
       E048                     RWX2:
0012F5 E048 CD47DE          17      CALL    ENDCL
0012F8 E04B 38E5            12      JR  C,RWX1
       E04D                     SCF_RET:
0012FA E04D 37               4      SCF
0012FB E04E C9              10      RET
                                
       E04F                     DSKF:
0012FC E04F 110000          10      LD  DE,0
       E050                     MAXCLP  EQU $-2
0012FF E052 2AACF0          16      LD  HL,(_FAKEFREE)
001302 E055 7C               4      LD  A,H
001303 E056 B5               4      OR  L
001304 E057 2803            12      JR  Z,DSKF1
001306 E059 110100          10      LD  DE,1
       E05C                     DSKF1:
001309 E05C D5              11      PUSH    DE
00130A E05D CDF7F0          17      CALL    _GNCL
00130D E060 380C            12      JR  C,POPSCF
00130F E062 7A               4      LD  A,D
001310 E063 B3               4      OR  E
001311 E064 2001            12      JR  NZ,DSKF2
001313 E066 23               6      INC HL
       E067                     DSKF2:
001314 E067 D1              10      POP DE
001315 E068 1B               6      DEC DE
001316 E069 7A               4      LD  A,D
001317 E06A B3               4      OR  E
001318 E06B 20EF            12      JR  NZ,DSKF1
00131A E06D C9              10      RET
                                
       E06E                     POPSCF:
00131B E06E F1              10      POP AF
00131C E06F 37               4      SCF
00131D E070 C9              10      RET
                                
       E071                     SETTMS:
00131E E071 FD7E17          19      LD  A,(IY+23)   ;(FCB)ファイルを最後に変更した時刻
001321 E074 3C               4      INC A
001322 E075 C0              11      RET NZ      ;ファイルが更新されていない
       E076                     SETTMSX:            ;FCBに日付時刻をセットする
001323 E076 CDB6D7          17      CALL    _SYS2C      ;(BDOS)時刻の獲得
                                                ;H←時  L←分  D←秒
001326 E079 CB25             8      SLA L       ;   *2
001328 E07B CB25             8      SLA L       ;   *4
00132A E07D 29              11      ADD HL,HL       ;*2 *8
00132B E07E 29              11      ADD HL,HL       ;*4 *16
00132C E07F 29              11      ADD HL,HL       ;*8 *32
00132D E080 7A               4      LD  A,D
00132E E081 0F               4      RRCA            ;bit.0->7->->->0->C
00132F E082 E61F             7      AND 01FH
001331 E084 B5               4      OR  L
001332 E085 FD7716          19      LD  (IY+22),A   ;(FCB)ファイルを最後に変更した時刻
001335 E088 FD7417          19      LD  (IY+23),H
                                
001338 E08B CDB0D7          17      CALL    _SYS2A      ;(BDOS)日付の獲得
                                                ;HL←年  D←月  E←日
00133B E08E 0144F8          10      LD  BC,0-1980
00133E E091 09              11      ADD HL,BC
00133F E092 65               4      LD  H,L
                                
001340 E093 7A               4      LD  A,D
001341 E094 87               4      ADD A,A     ;*2
001342 E095 87               4      ADD A,A     ;*4
001343 E096 87               4      ADD A,A     ;*8
001344 E097 87               4      ADD A,A     ;*16
001345 E098 6F               4      LD  L,A
001346 E099 29              11      ADD HL,HL       ;*32
001347 E09A 7D               4      LD  A,L
001348 E09B B3               4      OR  E
001349 E09C FD7714          19      LD  (IY+20),A   ;(FCB)ファイルを最後に変更した日付
00134C E09F FD7415          19      LD  (IY+21),H
00134F E0A2 C9              10      RET
                                
       E0A3                     PUSHRR:
001350 E0A3 323BE1          13      LD  (SETSEQ_SWC_RND),A
001353 E0A6 224DE1          16      LD  (SETSEQ_SWC_SEQ_RR),HL
001356 E0A9 CDC9E0          17      CALL    GET_RR_AHL
001359 E0AC 220FF0          16      LD  (RR_BUF_HL),HL
00135C E0AF 3211F0          13      LD  (RR_BUF_A),A
00135F E0B2 C9              10      RET
                                
       E0B3                     GET_CPM_R_SIZE:     ;バイト単位からCP/Mのレコード単位を求める（1レコード=128バイト）
001360 E0B3 87               4      ADD A,A     ;in BHLA => out AHL
001361 E0B4 ED6A            15      ADC HL,HL
001363 E0B6 CB18             8      RR  B
001365 E0B8 B7               4      OR  A
001366 E0B9 78               4      LD  A,B     ;ここでフラグは変化しない
001367 E0BA C8              11      RET Z
001368 E0BB 2C               4      INC L       ;INC AHL
001369 E0BC C0              11      RET NZ      ;
00136A E0BD 24               4      INC H       ;
00136B E0BE C0              11      RET NZ      ;
00136C E0BF 3C               4      INC A       ;
00136D E0C0 C9              10      RET
                                
       E0C1                     INIT_RND:
00136E E0C1 3ECD             7      LD  A,0CDH      ;CALL ????
001370 E0C3 2110E1          10      LD  HL,POPRR
001373 E0C6 CDA3E0          17      CALL    PUSHRR
       E0C9                     GET_RR_AHL:
001376 E0C9 FD6E21          19      LD  L,(IY+33)   ;(FCB)Random record
001379 E0CC FD6622          19      LD  H,(IY+34)   ;
00137C E0CF FD7E23          19      LD  A,(IY+35)   ;
00137F E0D2 C9              10      RET
       E0D3                     SET_RR_AHL:
001380 E0D3 FD7521          19      LD  (IY+33),L   ;(FCB)Random record
001383 E0D6 FD7422          19      LD  (IY+34),H
001386 E0D9 FD7723          19      LD  (IY+35),A
001389 E0DC C9              10      RET
       E0DD                     INIT_SEQ:
00138A E0DD 3E01             7      LD  A,1     ;LD BC,????
00138C E0DF 210DE1          10      LD  HL,SETSEQ
00138F E0E2 CDA3E0          17      CALL    PUSHRR
       E0E5                     GETSEQ:
001392 E0E5 FD6E20          19      LD  L,(IY+32)   ;(FCB)カレントレコード
001395 E0E8 FD660C          19      LD  H,(IY+12)   ;(FCB)カレントブロック
001398 E0EB AF               4      XOR A
                                
001399 E0EC CB25             8      SLA L   ;L=L*2
                                
00139B E0EE CB3C             8      SRL H   ;HL=HL/2
00139D E0F0 CB1D             8      RR  L   ;
00139F E0F2 C9              10      RET
                                
       E0F3                     SETSEQ1:
0013A0 E0F3 F5              11      PUSH    AF
0013A1 E0F4 E5              11      PUSH    HL      ;AHL=Random record
0013A2 E0F5 CDC9E0          17      CALL    GET_RR_AHL
0013A5 E0F8 47               4      LD  B,A     ;AHL→HLA
0013A6 E0F9 7D               4      LD  A,L     ;(IY+33)(FCB)ランダムレコード
0013A7 E0FA 6C               4      LD  L,H     ;(IY+34)
0013A8 E0FB 60               4      LD  H,B     ;(IY+35)
0013A9 E0FC 0600             7      LD  B,0
                                
0013AB E0FE CDB3E0          17      CALL    GET_CPM_R_SIZE
                                
0013AE E101 29              11      ADD HL,HL
0013AF E102 CB3D             8      SRL L       ;L=L/2
0013B1 E104 FD7520          19      LD  (IY+32),L   ;(FCB)カレントレコード
0013B4 E107 FD740C          19      LD  (IY+12),H   ;(FCB)カレントブロック
0013B7 E10A E1              10      POP HL
0013B8 E10B F1              10      POP AF
0013B9 E10C C9              10      RET
       E10D                     SETSEQ:
0013BA E10D CDF3E0          17      CALL    SETSEQ1
       E110                     POPRR:
0013BD E110 F5              11      PUSH    AF
0013BE E111 E5              11      PUSH    HL
0013BF E112 2A0FF0          16      LD  HL,(RR_BUF_HL)
0013C2 E115 3A11F0          13      LD  A,(RR_BUF_A)
0013C5 E118 CDD3E0          17      CALL    SET_RR_AHL
0013C8 E11B E1              10      POP HL
0013C9 E11C F1              10      POP AF
0013CA E11D C9              10      RET
                                
       E11E                     RB_WRITE:
0013CB E11E C5              11      PUSH    BC
0013CC E11F ED4B4CF1        20      LD  BC,(STABLE+2*026H)  ;(BDOS)ランダムブロック書き込み
0013D0 E123 1805            12      JR  RBRW
       E125                     RB_READ:
0013D2 E125 C5              11      PUSH    BC
0013D3 E126 ED4B4EF1        20      LD  BC,(STABLE+2*027H)  ;(BDOS)ランダムブロック読み込み
       E12A                     RBRW:
0013D7 E12A 1F               4      RRA     ;AHL = AHL*128
0013D8 E12B 7C               4      LD  A,H ;AHL = AHL0/2
0013D9 E12C 1F               4      RRA     ;A
0013DA E12D 65               4      LD  H,L ;
0013DB E12E CB1C             8      RR  H   ;H
0013DD E130 2E00             7      LD  L,0 ;
0013DF E132 CB1D             8      RR  L   ;L
0013E1 E134 CDD3E0          17      CALL    SET_RR_AHL
0013E4 E137 218000          10      LD  HL,128
0013E7 E13A C5              11      PUSH    BC
       E13B                     SETSEQ_SWC_RND:
0013E8 E13B CDF3E0          17      CALL    SETSEQ1
0013EB E13E C1              10      POP BC
0013EC E13F FDCB20FE        23      SET 7,(IY+32)   ;(FCB)カレントレコード
0013F0 E143 FDE5            15      PUSH    IY
0013F2 E145 D1              10      POP DE
0013F3 E146 D5              11      PUSH    DE
0013F4 E147 CD55E1          17      CALL    JP_BC
0013F7 E14A FDE1            14      POP IY
0013F9 E14C CD0DE1          17      CALL    SETSEQ
       E14D                     SETSEQ_SWC_SEQ_RR   EQU $-2
0013FC E14F FDCB20BE        23      RES 7,(IY+32)   ;(FCB)カレントレコード
                                
001400 E153 C1              10      POP BC
001401 E154 C9              10      RET
       E155                     JP_BC:
001402 E155 C5              11      PUSH    BC
001403 E156 C9              10      RET
                                
       DCD7                     _SYS03  EQU SCF_FF_RET  ;(BDOS)外部入力
       DCD7                     _SYS2B  EQU SCF_FF_RET  ;(BDOS)日付の設定
       DCD7                     _SYS2D  EQU SCF_FF_RET  ;(BDOS)時刻の設定
       DCD7                     _SYS39  EQU SCF_FF_RET  ;(BDOS)サブディレクトリの作成
       DCD7                     _SYS3A  EQU SCF_FF_RET  ;(BDOS)サブディレクトリの削除
                                
[EOF:LDFILE.ASM:SHIFT_JIS]
                                    INCLUDE "LDFILE2.ASM"
                                
                                ;   LSX-Dodgers FILE2
                                
                                                ;Write random block
       E157                     _SYS26:     ;(BDOS)ランダムブロック書き込み
001404 E157 AF               4      XOR A
001405 E158 322CE4          13      LD  (DRDN1),A   ;NOP
001408 E15B 227CE3          16      LD  (RBSIZE),HL ;HL←書き込むレコード数
00140B E15E 225DF0          16      LD  (LEFTX),HL
00140E E161 CD2CDC          17      CALL    SETDRV
                                
001411 E164 CDD4E2          17      CALL    RBX0
001414 E167 DAF4E1          10      JP  C,RBWERR
001417 E16A CDAFDF          17      CALL    WOPEN
00141A E16D DAF4E1          10      JP  C,RBWERR
00141D E170 7C               4      LD  A,H
00141E E171 B5               4      OR  L
00141F E172 CAEDE1          10      JP  Z,RBW1
                                
001422 E175 2B               6      DEC HL
                                
001423 E176 CD92E3          17      CALL    GET_RR_BCDE ;BCDE=Random record
                                
001426 E179 19              11      ADD HL,DE       ;BCHL=HL+BCDE
001427 E17A 3001            12      JR  NC,S26X1    ;
001429 E17C 03               6      INC BC      ;
       E17D                     S26X1:
00142A E17D CD1AE0          17      CALL    RWXR
00142D E180 DCC0DF          17      CALL    C,WRDFX
001430 E183 DAF4E1          10      JP  C,RBWERR
                                
001433 E186 CD03E3          17      CALL    RBX2
001436 E189 281A            12      JR  Z,RBWB      ;NZ=セクタ以下の端数がある
001438 E18B CD22E3          17      CALL    RBXA
00143B E18E 3864            12      JR  C,RBWERR
00143D E190 EB               4      EX  DE,HL
00143E E191 C5              11      PUSH    BC
00143F E192 EDB0                    LDIR
001441 E194 225FF0          16      LD  (DTAX),HL
                                
001444 E197 CD54DF          17      CALL    SWTDBF      ;バッファデータは更新された
                                
001447 E19A 2A5DF0          16      LD  HL,(LEFTX)
00144A E19D D1              10      POP DE
00144B E19E ED52            15      SBC HL,DE
00144D E1A0 225DF0          16      LD  (LEFTX),HL
001450 E1A3 2831            12      JR  Z,RBWEND
                                
       E1A5                     RBWB:
001452 E1A5 CD57E3          17      CALL    RBXB
001455 E1A8 2814            12      JR  Z,RBWC
       E1AA                     RBWB1:
001457 E1AA C5              11      PUSH    BC
001458 E1AB D5              11      PUSH    DE
001459 E1AC CD2ADE          17      CALL    CLUSTX
00145C E1AF CDA6E3          17      CALL    DWTC
00145F E1B2 D1              10      POP DE
001460 E1B3 C1              10      POP BC
001461 E1B4 D4A4E5          17      CALL    NC,GNCLX
001464 E1B7 383B            12      JR  C,RBWERR
001466 E1B9 10EF            13      DJNZ    RBWB1
001468 E1BB CDF6E3          17      CALL    DRW_FLUSH
       E1BE                     RBWC:
00146B E1BE CD6FE3          17      CALL    RBXC
00146E E1C1 2813            12      JR  Z,RBWEND
001470 E1C3 C5              11      PUSH    BC
001471 E1C4 CD2ADE          17      CALL    CLUSTX
001474 E1C7 CD2BE4          17      CALL    DRDN
001477 E1CA C1              10      POP BC
001478 E1CB 3827            12      JR  C,RBWERR
00147A E1CD ED5B7EF1        20      LD  DE,(_DTBUF)
00147E E1D1 EDB0                    LDIR
001480 E1D3 CD54DF          17      CALL    SWTDBF      ;バッファデータは更新された
       E1D6                     RBWEND:
001483 E1D6 CD7BE3          17      CALL    RBXEND
                                
001486 E1D9 CDE3E2          17      CALL    RBX1
001489 E1DC 300F            12      JR  NC,RBW1     ;ランダムレコードの方が大きい場合はサイズを合わせる
00148B E1DE CD92E3          17      CALL    GET_RR_BCDE ;BCDE=Random record
00148E E1E1 FD7310          19      LD  (IY+16),E   ;ファイルのサイズ(バイト単位)
001491 E1E4 FD7211          19      LD  (IY+17),D   ;
001494 E1E7 FD7112          19      LD  (IY+18),C   ;
001497 E1EA FD7013          19      LD  (IY+19),B   ;
       E1ED                     RBW1:
00149A E1ED FDE1            14      POP IY
00149C E1EF C1              10      POP BC
00149D E1F0 D1              10      POP DE
00149E E1F1 E1              10      POP HL
       E1F2                     DD_NUL:
00149F E1F2 AF               4      XOR A
       E1F3                     DRDF0:
       E1F3                     DWTF0:
0014A0 E1F3 C9              10      RET
                                
       E1F4                     RBWERR:
0014A1 E1F4 FDE5            15      PUSH    IY
0014A3 E1F6 D1              10      POP DE
0014A4 E1F7 2A20F1          16      LD  HL,(STABLE+2*010H)
0014A7 E1FA CD0F00          17      CALL    JP_HL
       E1FD                     RBRERR1:
0014AA E1FD 3E01             7      LD  A,001H
       E1FF                     RBRERR2:
0014AC E1FF FDE1            14      POP IY
0014AE E201 C1              10      POP BC
0014AF E202 D1              10      POP DE
0014B0 E203 E1              10      POP HL
0014B1 E204 37               4      SCF
0014B2 E205 210000          10      LD  HL,0
0014B5 E208 C9              10      RET
                                
       E209                     RBRERR:
0014B6 E209 3EFF             7      LD  A,0FFH
0014B8 E20B 18F2            12      JR  RBRERR2
                                
       E20D                     RBRFL:
0014BA E20D 3E00             7  RBRFLP: LD  A,000H
0014BC E20F FE0D             7      CP  00DH
0014BE E211 2005            12      JR  NZ,RBRFL1
0014C0 E213 D5              11      PUSH    DE
0014C1 E214 1E0A             7      LD  E,00AH
0014C3 E216 1805            12      JR  RBRFL2
       E218                     RBRFL1:
0014C5 E218 D5              11      PUSH    DE
0014C6 E219 CD09F0          17      CALL    _SYS07
0014C9 E21C 5F               4      LD  E,A
       E21D                     RBRFL2:
0014CA E21D CDCDF0          17      CALL    _PRINT
0014CD E220 7B               4      LD  A,E
0014CE E221 D1              10      POP DE
0014CF E222 320EE2          13      LD  (RBRFLP+1),A
0014D2 E225 C9              10      RET
       E226                     DDX:
0014D3 E226 FD7E01          19      LD  A,(IY+1)    ;(FCB)主ファイル名
0014D6 E229 CD4FDE          17      CALL    CAP
0014D9 E22C FE41             7      CP  'A'
0014DB E22E C9              10      RET
                                
                                                ;Read random block
       E22F                     _SYS27:     ;(BDOS)ランダムブロック読み込み
0014DC E22F 225DF0          16      LD  (LEFTX),HL
0014DF E232 CD2CDC          17      CALL    SETDRV
                                
0014E2 E235 FDCB0D66        20      BIT 4,(IY+13)   ;(FCB)属性(アトリビュート)
0014E6 E239 C2C2E2          10      JP  NZ,RBRDIR   ;ディレクトリ
0014E9 E23C CDD4E2          17      CALL    RBX0
0014EC E23F DA09E2          10      JP  C,RBRERR
0014EF E242 CDE3E2          17      CALL    RBX1
0014F2 E245 D4FBE2          17      CALL    NC,RBX1R
0014F5 E248 DAFDE1          10      JP  C,RBRERR1
0014F8 E24B EB               4      EX  DE,HL
0014F9 E24C ED52            15      SBC HL,DE       ;CP 00HL,BCDE
0014FB E24E 19              11      ADD HL,DE
0014FC E24F 79               4      LD  A,C
0014FD E250 DE00             7      SBC A,0
0014FF E252 78               4      LD  A,B
001500 E253 DE00             7      SBC A,0
001502 E255 3801            12      JR  C,RBR1
001504 E257 EB               4      EX  DE,HL
       E258                     RBR1:
001505 E258 9F               4      SBC A,A
001506 E259 E601             7      AND 1
001508 E25B 32C0E2          13      LD  (RBRAP+1),A
                                
00150B E25E 7C               4      LD  A,H
00150C E25F B5               4      OR  L
00150D E260 2857            12      JR  Z,RBREND0
                                
00150F E262 227CE3          16      LD  (RBSIZE),HL ;HL←読み込むレコード数
001512 E265 225DF0          16      LD  (LEFTX),HL
                                
001515 E268 CD03E3          17      CALL    RBX2
001518 E26B 2819            12      JR  Z,RBRB
00151A E26D CD22E3          17      CALL    RBXA
00151D E270 DA09E2          10      JP  C,RBRERR
001520 E273 C5              11      PUSH    BC
001521 E274 EDB0                    LDIR
001523 E276 ED535FF0        20      LD  (DTAX),DE
001527 E27A 2A5DF0          16      LD  HL,(LEFTX)
00152A E27D D1              10      POP DE
00152B E27E A7               4      AND A
00152C E27F ED52            15      SBC HL,DE
00152E E281 225DF0          16      LD  (LEFTX),HL
001531 E284 2830            12      JR  Z,RBREND
                                
       E286                     RBRB:
001533 E286 CD57E3          17      CALL    RBXB
001536 E289 2815            12      JR  Z,RBRC
       E28B                     RBRB1:
001538 E28B C5              11      PUSH    BC
001539 E28C D5              11      PUSH    DE
00153A E28D CD2ADE          17      CALL    CLUSTX
00153D E290 CDACE3          17      CALL    DRDC
001540 E293 D1              10      POP DE
001541 E294 C1              10      POP BC
001542 E295 D4A4E5          17      CALL    NC,GNCLX
001545 E298 DA09E2          10      JP  C,RBRERR
001548 E29B 10EE            13      DJNZ    RBRB1
00154A E29D CDF6E3          17      CALL    DRW_FLUSH
       E2A0                     RBRC:
00154D E2A0 CD6FE3          17      CALL    RBXC
001550 E2A3 2811            12      JR  Z,RBREND
001552 E2A5 C5              11      PUSH    BC
001553 E2A6 CD2ADE          17      CALL    CLUSTX
001556 E2A9 CD0FE4          17      CALL    DRDX
001559 E2AC C1              10      POP BC
00155A E2AD DA09E2          10      JP  C,RBRERR
00155D E2B0 EB               4      EX  DE,HL
00155E E2B1 2A7EF1          16      LD  HL,(_DTBUF)
001561 E2B4 EDB0                    LDIR
       E2B6                     RBREND:
001563 E2B6 CD7BE3          17      CALL    RBXEND
       E2B9                     RBREND0:
001566 E2B9 FDE1            14      POP IY
001568 E2BB C1              10      POP BC
001569 E2BC D1              10      POP DE
00156A E2BD F1              10      POP AF  ;(HL)
00156B E2BE AF               4      XOR A
00156C E2BF 3E00             7  RBRAP:  LD  A,000H
00156E E2C1 C9              10      RET
                                
       E2C2                     RBRDIR:
00156F E2C2 FD6E1A          19      LD  L,(IY+26)   ;(FCB)ファイルの先頭クラスタ
001572 E2C5 FD661B          19      LD  H,(IY+27)
001575 E2C8 CD65DE          17      CALL    CHDIR
001578 E2CB AF               4      XOR A
001579 E2CC 67               4      LD  H,A
00157A E2CD 6F               4      LD  L,A
00157B E2CE 3C               4      INC A
00157C E2CF 32C0E2          13      LD  (RBRAP+1),A
00157F E2D2 18E5            12      JR  RBREND0
                                
       E2D4                     RBX0:
001581 E2D4 2A8AF0          16      LD  HL,(_DTA)
001584 E2D7 225FF0          16      LD  (DTAX),HL
001587 E2DA 2A5DF0          16      LD  HL,(LEFTX)
00158A E2DD FD7E1C          19      LD  A,(IY+28)   ;(FCB)オープンモード
00158D E2E0 D6FD             7      SUB 0FDH
00158F E2E2 C9              10      RET
                                
       E2E3                     RBX1:               ;ファイルサイズとランダムレコードを比べる
001590 E2E3 E5              11      PUSH    HL      ;Record byte
                                                ;AHL=File size
001591 E2E4 FD6E10          19      LD  L,(IY+16)   ;ファイルのサイズ(バイト単位)
001594 E2E7 FD6611          19      LD  H,(IY+17)   ;
001597 E2EA FD7E12          19      LD  A,(IY+18)   ;
                                
00159A E2ED CD92E3          17      CALL    GET_RR_BCDE ;BCDE=Random record
                                
00159D E2F0 A7               4      AND A
00159E E2F1 ED52            15      SBC HL,DE
0015A0 E2F3 99               4      SBC A,C
0015A1 E2F4 4F               4      LD  C,A
0015A2 E2F5 FD7E13          19      LD  A,(IY+19)   ;ファイルのサイズ
0015A5 E2F8 98               4      SBC A,B
0015A6 E2F9 D1              10      POP DE
0015A7 E2FA C9              10      RET
       E2FB                     RBX1R:
0015A8 E2FB 47               4      LD  B,A
0015A9 E2FC B1               4      OR  C
0015AA E2FD EB               4      EX  DE,HL   ;BCDE=File byte HL=Record byte
0015AB E2FE B2               4      OR  D
0015AC E2FF B3               4      OR  E
0015AD E300 C0              11      RET NZ
0015AE E301 37               4      SCF
0015AF E302 C9              10      RET
                                
       E303                     RBX2:               ;Cluster settings
0015B0 E303 FD6622          19      LD  H,(IY+34)   ;(+33)(FCB)ランダムレコード
0015B3 E306 FD4E23          19      LD  C,(IY+35)
0015B6 E309 0600             7      LD  B,0
0015B8 E30B FDCB207E        20      BIT 7,(IY+32)   ;(FCB)カレントレコード
0015BC E30F 2003            12      JR  NZ,RBX3
0015BE E311 FD4624          19      LD  B,(IY+36)
       E314                     RBX3:
0015C1 E314 CD1AE0          17      CALL    RWXR
0015C4 E317 3A39E3          13      LD  A,(SECSZ+2) ;1024=4 / 512=2 / 256=1
0015C7 E31A 3D               4      DEC A
0015C8 E31B FDA622          19      AND (IY+34)
0015CB E31E FDB621          19      OR  (IY+33)
0015CE E321 C9              10      RET
                                
       E322                     RBXA:
0015CF E322 C5              11      PUSH    BC
0015D0 E323 D5              11      PUSH    DE
0015D1 E324 CD2ADE          17      CALL    CLUSTX
0015D4 E327 CD0FE4          17      CALL    DRDX
0015D7 E32A D1              10      POP DE
0015D8 E32B C1              10      POP BC
0015D9 E32C D4A4E5          17      CALL    NC,GNCLX
0015DC E32F D8              11      RET C
0015DD E330 ED53FEF1        20      LD  (_CLPS),DE
                                
0015E1 E334 FD4E21          19      LD  C,(IY+33)   ;(FCB)ランダムレコード
0015E4 E337 210004          10  SECSZ:  LD  HL,0400H    ;自己書き換え 1024=0400H / 512=0200H ここに1セクタのサイズが格納される
0015E7 E33A 7C               4      LD  A,H
0015E8 E33B 3D               4      DEC A       ;1024=3 / 512=1
0015E9 E33C FDA622          19      AND (IY+34)     ;(FCB)ランダムレコード
0015EC E33F 47               4      LD  B,A     ;BCに1セクタ以下の端数が入る
0015ED E340 ED42            15      SBC HL,BC       ;残りを計算
                                
0015EF E342 ED5B5DF0        20      LD  DE,(LEFTX)
0015F3 E346 ED52            15      SBC HL,DE       ;CP HL,DE
0015F5 E348 19              11      ADD HL,DE       ;
0015F6 E349 3801            12      JR  C,RBXA1     ;DEとHLを比較して大きい方をHLに
0015F8 E34B EB               4      EX  DE,HL
       E34C                     RBXA1:
0015F9 E34C E5              11      PUSH    HL
0015FA E34D 2A7EF1          16      LD  HL,(_DTBUF)
0015FD E350 09              11      ADD HL,BC
0015FE E351 ED5B5FF0        20      LD  DE,(DTAX)
001602 E355 C1              10      POP BC
001603 E356 C9              10      RET
                                
       E357                     RBXB:
001604 E357 2A5FF0          16      LD  HL,(DTAX)
001607 E35A ED5BFEF1        20      LD  DE,(_CLPS)
00160B E35E 3A5EF0          13      LD  A,(LEFTX+1)
00160E E361 47               4      LD  B,A
00160F E362 3A39E3          13      LD  A,(SECSZ+2) ;1024=4 / 512=2 / 256=1
       E365                     RBXB1:
001612 E365 1F               4      RRA     ;->CF
001613 E366 3804            12      JR  C,RBXB2
001615 E368 CB38             8      SRL B   ;B=B/2
001617 E36A 18F9            12      JR  RBXB1
       E36C                     RBXB2:
001619 E36C 78               4      LD  A,B
00161A E36D B7               4      OR  A
00161B E36E C9              10      RET
                                
       E36F                     RBXC:
00161C E36F ED4B5DF0        20      LD  BC,(LEFTX)
001620 E373 3A39E3          13      LD  A,(SECSZ+2) ;1024=4 / 512=2 / 256=1
001623 E376 3D               4      DEC A
001624 E377 A0               4      AND B
001625 E378 47               4      LD  B,A     ;1セクタ以下の端数がない場合はZ
001626 E379 B1               4      OR  C
001627 E37A C9              10      RET
                                
       E37B                     RBXEND:             ;レコード数だけランダムレコードを進める
001628 E37B 110000          10      LD  DE,0        ;進めるレコード数(RBSIZE)
       E37C                     RBSIZE  EQU $-2
00162B E37E CDC9E0          17      CALL    GET_RR_AHL
00162E E381 19              11      ADD HL,DE
00162F E382 CE00             7      ADC A,0
001631 E384 CDD3E0          17      CALL    SET_RR_AHL
001634 E387 EB               4      EX  DE,HL       ;HL=進めるレコード数
001635 E388 D0              11      RET NC
001636 E389 FDCB207E        20      BIT 7,(IY+32)   ;(FCB)カレントレコード
00163A E38D C0              11      RET NZ
00163B E38E FD3424          23      INC (IY+36)
00163E E391 C9              10      RET
                                
       E392                     GET_RR_BCDE:            ;BCDE=Random record
00163F E392 FD5E21          19      LD  E,(IY+33)   ;(FCB)ランダムレコード
001642 E395 FD5622          19      LD  D,(IY+34)
001645 E398 FD4E23          19      LD  C,(IY+35)
001648 E39B 0600             7      LD  B,0     ;CP/M互換のアクセスの場合はFCBは36バイト
00164A E39D FDCB207E        20      BIT 7,(IY+32)   ;(FCB)カレントレコード
00164E E3A1 C0              11      RET NZ
00164F E3A2 FD4624          19      LD  B,(IY+36)
001652 E3A5 C9              10      RET
                                
                                ;   ランダムブロックアクセスの連続したセクタをまとめる
                                
       E3A6                     DWTC:
001653 E3A6 E5              11      PUSH    HL
001654 E3A7 2136E7          10      LD  HL,DWT24B
001657 E3AA 1804            12      JR  DWTC1
       E3AC                     DRDC:
001659 E3AC E5              11      PUSH    HL
00165A E3AD 2126E7          10      LD  HL,DRD24B
       E3B0                     DWTC1:
00165D E3B0 220AE4          16      LD  (DRWF_MODE),HL
001660 E3B3 E1              10      POP HL
001661 E3B4 3AFAE3          13      LD  A,(DRWF_B)
001664 E3B7 B7               4      OR  A
001665 E3B8 200F            12      JR  NZ,DRDC1
       E3BA                     SAVE_DRWC:
001667 E3BA 0601             7      LD  B,1
001669 E3BC ED43F9E3        20      LD  (DRWF_C),BC
00166D E3C0 ED5300E4        20      LD  (DRWF_E),DE
001671 E3C4 2203E4          16      LD  (DRWF_HL),HL
001674 E3C7 1820            12      JR  INC_HL_DRWC
       E3C9                     DRDC1:
001676 E3C9 E5              11      PUSH    HL
001677 E3CA 2100E4          10      LD  HL,DRWF_E
00167A E3CD 86               7      ADD A,(HL)
00167B E3CE F5              11      PUSH    AF
00167C E3CF BB               4      CP  E
00167D E3D0 201D            12      JR  NZ,DRDC2
00167F E3D2 F1              10      POP AF
001680 E3D3 23               6      INC HL
001681 E3D4 7E               7      LD  A,(HL)
001682 E3D5 CE00             7      ADC A,0
001684 E3D7 F5              11      PUSH    AF
001685 E3D8 BA               4      CP  D
001686 E3D9 2014            12      JR  NZ,DRDC2
001688 E3DB F1              10      POP AF
001689 E3DC 3AF9E3          13      LD  A,(DRWF_C)
00168C E3DF CE00             7      ADC A,0
00168E E3E1 B9               4      CP  C
00168F E3E2 200C            12      JR  NZ,DRDC3
001691 E3E4 21FAE3          10      LD  HL,DRWF_B
001694 E3E7 34              11      INC (HL)
001695 E3E8 E1              10      POP HL
       E3E9                     INC_HL_DRWC:
001696 E3E9 3A39E3          13      LD  A,(SECSZ+2)     ;1セクタのサイズの上位1バイト
001699 E3EC 84               4      ADD A,H
00169A E3ED 67               4      LD  H,A
00169B E3EE C9              10      RET
       E3EF                     DRDC2:
00169C E3EF F1              10      POP AF
       E3F0                     DRDC3:
00169D E3F0 CDF6E3          17      CALL    DRW_FLUSH
0016A0 E3F3 E1              10      POP HL
0016A1 E3F4 18C4            12      JR  SAVE_DRWC
                                
                                ;   ランダムブロックアクセスの連続したセクタをまとめたものをフラッシュする
       E3F6                     DRW_FLUSH:
0016A3 E3F6 C5              11      PUSH    BC
0016A4 E3F7 D5              11      PUSH    DE
0016A5 E3F8 010000          10      LD  BC,0
       E3F9                     DRWF_C  EQU $-2
       E3FA                     DRWF_B  EQU $-1
0016A8 E3FB 78               4      LD  A,B
0016A9 E3FC B7               4      OR  A
0016AA E3FD 280D            12      JR  Z,DRDF1
0016AC E3FF 110000          10      LD  DE,0
       E400                     DRWF_E  EQU $-2
       E401                     DRWF_D  EQU $-1
0016AF E402 210000          10      LD  HL,0
       E403                     DRWF_HL EQU $-2
0016B2 E405 AF               4      XOR A
0016B3 E406 32FAE3          13      LD  (DRWF_B),A
0016B6 E409 CD26E7          17      CALL    DRD24B
       E40A                     DRWF_MODE   EQU $-2
       E40C                     DRDF1:
0016B9 E40C D1              10      POP DE
0016BA E40D C1              10      POP BC
0016BB E40E C9              10      RET
[EOF:LDFILE2.ASM:SHIFT_JIS]
                                    INCLUDE "LDDIO.ASM"
                                
                                ;   LSX-Dodgers DIO
                                
       E40F                     DRDX:
0016BC E40F CD4DE4          17      CALL    DRDY
0016BF E412 C8              11      RET Z
0016C0 E413 CD33E4          17      CALL    DRDX1       ;データバッファの情報を保存
0016C3 E416 D8              11      RET C
0016C4 E417 E5              11      PUSH    HL
0016C5 E418 C5              11      PUSH    BC
0016C6 E419 D5              11      PUSH    DE
0016C7 E41A 2A7EF1          16      LD  HL,(_DTBUF)
0016CA E41D 3A76E4          13      LD  A,(_DBS24)
0016CD E420 4F               4      LD  C,A
0016CE E421 CD24E7          17      CALL    DRD24
0016D1 E424 DC48E4          17      CALL    C,DRDNE
       E427                     POP_DE_BC_HL_RET:
0016D4 E427 D1              10      POP DE
0016D5 E428 C1              10      POP BC
0016D6 E429 E1              10      POP HL
0016D7 E42A C9              10      RET
                                
                                ;   CDE:セクタ番号
       E42B                     DRDN:
0016D8 E42B AF               4      XOR A
0016D9 E42C 00               4  DRDN1:  NOP         ;自己書き換え NOP / SCF
0016DA E42D 30E0            12      JR  NC,DRDX
       E42F                     DRDNX:
0016DC E42F CD4DE4          17      CALL    DRDY
0016DF E432 C8              11      RET Z
       E433                     DRDX1:
0016E0 E433 CD63E4          17      CALL    DWTX
                                                ;データバッファの読み込んだドライブ・セクタ情報を保存
0016E3 E436 ED53A6F0        20      LD  (_DBSEC),DE
0016E7 E43A 79               4      LD  A,C
0016E8 E43B 3276E4          13      LD  (_DBS24),A
                                
0016EB E43E 3A88F0          13      LD  A,(_DRV)
0016EE E441 32A5F0          13      LD  (_DBDRV),A
0016F1 E444 CDD9F0          17      CALL    _CHGDRV
0016F4 E447 D0              11      RET NC
       E448                     DRDNE:
0016F5 E448 9F               4      SBC A,A     ;CF=1ならばA=0FFH
0016F6 E449 32A5F0          13      LD  (_DBDRV),A
0016F9 E44C C9              10      RET
                                
                                ;   CDE:セクタ番号
       E44D                     DRDY:
0016FA E44D 3A76E4          13      LD  A,(_DBS24)
0016FD E450 B9               4      CP  C
0016FE E451 C0              11      RET NZ
                                
0016FF E452 E5              11      PUSH    HL
001700 E453 3A88F0          13      LD  A,(_DRV)
001703 E456 21A5F0          10      LD  HL,_DBDRV
001706 E459 AE               7      XOR (HL)
001707 E45A 2005            12      JR  NZ,POP_HL_RET
                                
001709 E45C 2AA6F0          16      LD  HL,(_DBSEC)
00170C E45F ED52            15      SBC HL,DE       ;上でXORを使っているのでCF=0のはず
       E461                     POP_HL_RET:
00170E E461 E1              10      POP HL
00170F E462 C9              10      RET
                                
       E463                     DWTX:
001710 E463 3AA4F0          13      LD  A,(_WTDBF)
001713 E466 B7               4      OR  A
001714 E467 C8              11      RET Z
001715 E468 AF               4      XOR A
001716 E469 32A4F0          13      LD  (_WTDBF),A
                                
001719 E46C E5              11      PUSH    HL
00171A E46D C5              11      PUSH    BC
00171B E46E D5              11      PUSH    DE
00171C E46F 3AA5F0          13      LD  A,(_DBDRV)
00171F E472 CDD9F0          17      CALL    _CHGDRV
001722 E475 0E00             7      LD  C,0
       E476                     _DBS24  EQU $-1
001724 E477 ED5BA6F0        20      LD  DE,(_DBSEC)
001728 E47B 2A7EF1          16      LD  HL,(_DTBUF)
00172B E47E D434E7          17      CALL    NC,DWT24
       E481                     POP_DE_BC_HL_RET2:
00172E E481 18A4            12      JR  POP_DE_BC_HL_RET
                                
       E483                     RDFATX:
001730 E483 E5              11      PUSH    HL
001731 E484 3A88F0          13      LD  A,(_DRV)
001734 E487 21AAF0          10      LD  HL,_FATDRV
001737 E48A AE               7      XOR (HL)
001738 E48B 28D4            12      JR  Z,POP_HL_RET
                                
00173A E48D C5              11      PUSH    BC
00173B E48E D5              11      PUSH    DE
00173C E48F DDE5            15      PUSH    IX
00173E E491 CDADE4          17      CALL    WTFATX
001741 E494 3813            12      JR  C,POP_IX_DE_BC_HL_RET
                                
001743 E496 AF               4      XOR A
001744 E497 32ABF0          13      LD  (_FATIX),A
001747 E49A 3A88F0          13      LD  A,(_DRV)
00174A E49D 32AAF0          13      LD  (_FATDRV),A
00174D E4A0 CDE5F0          17      CALL    _RDFAT
       E4A3                     RDFATE2:
001750 E4A3 3004            12      JR  NC,POP_IX_DE_BC_HL_RET
001752 E4A5 9F               4      SBC A,A     ;A=0xFF
001753 E4A6 32AAF0          13      LD  (_FATDRV),A
       E4A9                     POP_IX_DE_BC_HL_RET:
001756 E4A9 DDE1            14      POP IX
001758 E4AB 18D4            12      JR  POP_DE_BC_HL_RET2
                                
       E4AD                     WTFATX:
00175A E4AD 3AA2F0          13      LD  A,(_WTFATF)
00175D E4B0 B7               4      OR  A
00175E E4B1 C8              11      RET Z
00175F E4B2 E5              11      PUSH    HL
001760 E4B3 3AAAF0          13      LD  A,(_FATDRV)
001763 E4B6 21A5F0          10      LD  HL,_DBDRV
001766 E4B9 AE               7      XOR (HL)
001767 E4BA CC63E4          17      CALL    Z,DWTX
00176A E4BD 38A2            12      JR  C,POP_HL_RET
00176C E4BF C5              11      PUSH    BC
00176D E4C0 D5              11      PUSH    DE
00176E E4C1 DDE5            15      PUSH    IX
001770 E4C3 CD41E7          17      CALL    WTFAT
001773 E4C6 AF               4      XOR A
001774 E4C7 32A2F0          13      LD  (_WTFATF),A
001777 E4CA 18DD            12      JR  POP_IX_DE_BC_HL_RET
                                
       E4CC                     NCL1:
001779 E4CC 7A               4      LD  A,D
00177A E4CD B3               4      OR  E
00177B E4CE 37               4      SCF
00177C E4CF C8              11      RET Z
                                
00177D E4D0 7A               4      LD  A,D
00177E E4D1 CB3F             8      SRL A   ;/2
001780 E4D3 CB3F             8      SRL A   ;/2
                                
001782 E4D5 E5              11      PUSH    HL
001783 E4D6 32F5E4          13      LD  (NCLPAT_FATIX),A    ;_FATIX
001786 E4D9 2AAAF0          16      LD  HL,(_FATDRV)    ;L=_FATDRV H=_FATIX
001789 E4DC BC               4      CP  H
00178A E4DD 3A88F0          13      LD  A,(_DRV)    ;LDではフラグは変化しない
00178D E4E0 32F4E4          13      LD  (NCLPAT_FATDRV),A   ;_FATDRV
001790 E4E3 2005            12      JR  NZ,NCL2     ;FATIXが違う
001792 E4E5 BD               4      CP  L
001793 E4E6 2002            12      JR  NZ,NCL2     ;ドライブが違う
001795 E4E8 E1              10      POP HL
001796 E4E9 C9              10      RET
       E4EA                     NCL2:
001797 E4EA C5              11      PUSH    BC
001798 E4EB D5              11      PUSH    DE
001799 E4EC DDE5            15      PUSH    IX
00179B E4EE CDADE4          17      CALL    WTFATX
00179E E4F1 38B6            12      JR  C,POP_IX_DE_BC_HL_RET
0017A0 E4F3 010000          10      LD  BC,0        ;自己書き換え C=_FATDRV B=_FATIX
       E4F5                     NCLPAT_FATIX    EQU $-1
       E4F4                     NCLPAT_FATDRV   EQU $-2
0017A3 E4F6 ED43AAF0        20      LD  (_FATDRV),BC
0017A7 E4FA CD16E7          17      CALL    RDFATS
0017AA E4FD 18A4            12      JR  RDFATE2
                                
       E4FF                     NCL3:
0017AC E4FF CB9A             8      RES 3,D
0017AE E501 CB92             8      RES 2,D
0017B0 E503 6B               4      LD  L,E
0017B1 E504 62               4      LD  H,D
0017B2 E505 CB3C             8      SRL H   ;
0017B4 E507 CB1D             8      RR  L   ;HLA=HLA/2
0017B6 E509 1F               4      RRA     ;
0017B7 E50A F5              11      PUSH    AF
0017B8 E50B 3AABF0          13      LD  A,(_FATIX)
0017BB E50E 0F               4      RRCA
0017BC E50F 300B            12      JR  NC,NCL3X1
0017BE E511 3A39E3          13      LD  A,(SECSZ+2)
0017C1 E514 FE04             7      CP  4       ;1セクタ1024バイトの場合は奇数インデックスの場合に先頭を512バイトずらす
0017C3 E516 2004            12      JR  NZ,NCL3X1
0017C5 E518 010002          10      LD  BC,512
0017C8 E51B 09              11      ADD HL,BC
       E51C                     NCL3X1:
0017C9 E51C F1              10      POP AF
0017CA E51D ED4B7CF1        20      LD  BC,(_FATBF)
0017CE E521 19              11      ADD HL,DE
0017CF E522 09              11      ADD HL,BC
0017D0 E523 17               4      RLA
0017D1 E524 C9              10      RET
                                
       E525                     GNCL:
0017D2 E525 CDCCE4          17      CALL    NCL1        ;GET NEXT CLUSTER
0017D5 E528 D8              11      RET C
0017D6 E529 C5              11      PUSH    BC
0017D7 E52A E5              11      PUSH    HL
0017D8 E52B CDFFE4          17      CALL    NCL3
0017DB E52E 3809            12      JR  C,GNC1
0017DD E530 5E               7      LD  E,(HL)
0017DE E531 23               6      INC HL
0017DF E532 7E               7      LD  A,(HL)
0017E0 E533 E60F             7      AND 00FH
0017E2 E535 57               4      LD  D,A
0017E3 E536 E1              10      POP HL
0017E4 E537 C1              10      POP BC
0017E5 E538 C9              10      RET
       E539                     GNC1:
0017E6 E539 7E               7      LD  A,(HL)
0017E7 E53A 23               6      INC HL
0017E8 E53B 56               7      LD  D,(HL)
0017E9 E53C 0604             7      LD  B,4
       E53E                     GNC1L:
0017EB E53E CB3A             8      SRL D   ;DA=DA/2
0017ED E540 1F               4      RRA     ;
0017EE E541 10FB            13      DJNZ    GNC1L
                                
0017F0 E543 5F               4      LD  E,A
0017F1 E544 E1              10      POP HL
0017F2 E545 C1              10      POP BC
0017F3 E546 A7               4      AND A
0017F4 E547 C9              10      RET
                                
       E548                     SNCL:
0017F5 E548 CDCCE4          17      CALL    NCL1
0017F8 E54B D8              11      RET C
                                ;               SET NEXT CLUSTER
0017F9 E54C E5              11      PUSH    HL
0017FA E54D C5              11      PUSH    BC
0017FB E54E D5              11      PUSH    DE
0017FC E54F E5              11      PUSH    HL
0017FD E550 CDFFE4          17      CALL    NCL3
001800 E553 D1              10      POP DE
                                ;CF=ODD
001801 E554 7E               7      LD  A,(HL)
001802 E555 73               7      LD  (HL),E
001803 E556 3806            12      JR  C,SNC1
                                ;EVEN
                                ;M[0] = E
                                ;M[1] = (M[1] & 0xF0) | (D & 0x0F)
001805 E558 23               6      INC HL
001806 E559 ED67            18      RRD     ;M={A[3:0],E[3:0]}
001808 E55B 7A               4      LD  A,D
001809 E55C 1804            12      JR  SNC11
       E55E                     SNC1:
                                ;ODD
                                ;HL[0] = (HL[0]&0x0F) | (E<<4)
                                ;HL[1] = DE>>4
00180B E55E ED6F            18      RLD     ;M={D[3:0],E[7:4]}
00180D E560 23               6      INC HL
00180E E561 72               7      LD  (HL),D  ;M={D[3:0],E[7:4]}
       E562                     SNC11:
00180F E562 ED6F            18      RLD     ;M={M[7:4],D[3:0]}
001811 E564 B7               4      OR  A
001812 E565 D1              10      POP DE
001813 E566 C1              10      POP BC
001814 E567 E1              10      POP HL
       E568                     FAT_CHANGED:
001815 E568 3E01             7      LD  A,1
001817 E56A 32A2F0          13      LD  (_WTFATF),A
00181A E56D C9              10      RET
                                
       E56E                     N16CL3:
00181B E56E C5              11      PUSH    BC
00181C E56F 6B               4      LD  L,E
00181D E570 7A               4      LD  A,D
00181E E571 E603             7      AND 3
001820 E573 67               4      LD  H,A
001821 E574 29              11      ADD HL,HL
001822 E575 ED4B7CF1        20      LD  BC,(_FATBF)
001826 E579 09              11      ADD HL,BC
001827 E57A C1              10      POP BC
001828 E57B C9              10      RET
                                
       E57C                     GNCL16:
001829 E57C CDCCE4          17      CALL    NCL1        ;GET NEXT CLUSTER for FAT16
00182C E57F D8              11      RET C
00182D E580 E5              11      PUSH    HL
00182E E581 CD6EE5          17      CALL    N16CL3
001831 E584 5E               7      LD  E,(HL)
001832 E585 23               6      INC HL
001833 E586 56               7      LD  D,(HL)
001834 E587 E1              10      POP HL
001835 E588 C9              10      RET
                                
       E589                     SNCL16:
001836 E589 CDCCE4          17      CALL    NCL1        ;GET NEXT CLUSTER for FAT16
001839 E58C D8              11      RET C
00183A E58D D5              11      PUSH    DE
00183B E58E E5              11      PUSH    HL
00183C E58F CD6EE5          17      CALL    N16CL3
00183F E592 D1              10      POP DE      ;HL
001840 E593 73               7      LD  (HL),E
001841 E594 23               6      INC HL
001842 E595 72               7      LD  (HL),D
001843 E596 6B               4      LD  L,E
001844 E597 62               4      LD  H,D
001845 E598 D1              10      POP DE
001846 E599 18CD            12      JR  FAT_CHANGED
                                
                                ;------------------------
                                ;次のセクタを探す際に_SECPSの値をチェック
                                ;in
                                ;   DE : セクタ番号
                                ;out
                                ;   DE : 次のセクタ番号
                                ;note
                                ;
                                ;------------------------
       E59B                     NEXTX:
001848 E59B 3E00             7      LD  A,0 ;自己書き換え
       E59C                     _SECPS  EQU $-1
00184A E59D 3C               4      INC A
00184B E59E E600             7      AND 0   ;自己書き換え　1クラスタの論理セクタ数-1
       E59F                     _NCPAT  EQU $-1
00184D E5A0 329CE5          13      LD  (_SECPS),A
001850 E5A3 C9              10      RET
                                
       E5A4                     GNCLX:
001851 E5A4 CD9BE5          17      CALL    NEXTX
001854 E5A7 C0              11      RET NZ  ;1クラスタのセクタ未満の場合は戻る
001855 E5A8 C3F7F0          10      JP  _GNCL   ;次のクラスタを探す
                                
       E5AB                     RDFAT:
001858 E5AB 3E80             7      LD  A,080H
00185A E5AD 3270F0          13      LD  (CHECK),A
       E5B0                     RDFAT1:
00185D E5B0 3A88F0          13      LD  A,(_DRV)
001860 E5B3 CD6BE8          17      CALL    CHGDRVR
001863 E5B6 D8              11      RET C
001864 E5B7 DD7E12          19      LD  A,(IX+DPB_DEVICE)
001867 E5BA CB6F             8      BIT 5,A
001869 E5BC 2868            12      JR  Z,RDFAT0X
00186B E5BE 2170F0          10      LD  HL,CHECK
00186E E5C1 A6               7      AND (HL)
00186F E5C2 77               7      LD  (HL),A
001870 E5C3 110000          10      LD  DE,0        ;BPB
001873 E5C6 2A7CF1          16      LD  HL,(_FATBF)
001876 E5C9 CD22E7          17      CALL    DRD16
001879 E5CC 3024            12      JR  NC,GETBPB
00187B E5CE 2170F0          10      LD  HL,CHECK
00187E E5D1 CB06            15      RLC (HL)
001880 E5D3 3F               4      CCF
001881 E5D4 D8              11      RET C
001882 E5D5 DDCB0A1E        23      RR  (IX+DPB_FDMODE)
001886 E5D9 3F               4      CCF         ;フロッピーディスクのFDモードを切り替える
001887 E5DA DDCB0A16        23      RL  (IX+DPB_FDMODE)
00188B E5DE 3EFF             7      LD  A,0FFH
00188D E5E0 3289F0          13      LD  (_DSK),A
001890 E5E3 3A84F0          13      LD  A,(_DRIVE)
001893 E5E6 E603             7      AND 3
001895 E5E8 F680             7      OR  080H
001897 E5EA 6F               4      LD  L,A
001898 E5EB 26F0             7      LD  H,_CYL0/256
00189A E5ED 3EFF             7      LD  A,0FFH
00189C E5EF 77               7      LD  (HL),A
00189D E5F0 18BE            12      JR  RDFAT1
       E5F2                     GETBPB:
00189F E5F2 FDE5            15      PUSH    IY
0018A1 E5F4 FD2A7CF1        20      LD  IY,(_FATBF) ;BPB
0018A5 E5F8 CDF1F0          17      CALL    _BPB2DPB
0018A8 E5FB FDE1            14      POP IY
0018AA E5FD DD7E12          19      LD  A,(IX+DPB_DEVICE)
0018AD E600 3021            12      JR  NC,GETBPBOK
0018AF E602 E60F             7      AND 00FH
0018B1 E604 FE07             7      CP  7
0018B3 E606 37               4      SCF
0018B4 E607 C0              11      RET NZ
0018B5 E608 DDCB0A46        20      BIT 0,(IX+DPB_FDMODE)
0018B9 E60C 21C0F1          10      LD  HL,M2D
0018BC E60F 2002            12      JR  NZ,SETFDMODE
0018BE E611 2ED2             7      LD  L,M2HD-STABLE
       E613                     SETFDMODE:
0018C0 E613 DDE5            15      PUSH    IX
0018C2 E615 D1              10      POP DE
0018C3 E616 EDA0            16      LDI
0018C5 E618 EDA0            16      LDI
0018C7 E61A 13               6      INC DE
0018C8 E61B 13               6      INC DE
0018C9 E61C 13               6      INC DE
0018CA E61D 13               6      INC DE
0018CB E61E 010C00          10      LD  BC,12
0018CE E621 EDB0                    LDIR
       E623                     GETBPBOK:
0018D0 E623 CDCAE7          17      CALL    CHGDRV2
       E626                     RDFAT0X:
0018D3 E626 CD16E7          17      CALL    RDFATS
0018D6 E629 D8              11      RET C
0018D7 E62A DDAE06          19      XOR (IX+DPB_FATID)
0018DA E62D C8              11      RET Z
0018DB E62E DDCB126E        20      BIT 5,(IX+DPB_DEVICE)
0018DF E632 C0              11      RET NZ      ;BPBを取得している場合はFATIDをチェックしない
0018E0 E633 37               4      SCF
0018E1 E634 C9              10      RET
                                
       E635                     POP_HL_SCF_RET:
0018E2 E635 E1              10      POP HL
0018E3 E636 37               4      SCF
0018E4 E637 C9              10      RET
                                
       E638                     BPB2DPB:
0018E5 E638 FD7E0B          19      LD  A,(IY+11)   ;BPB_BytsPerSec
0018E8 E63B B7               4      OR  A
0018E9 E63C 37               4      SCF
0018EA E63D C0              11      RET NZ
       E63E                     BPBOK:
0018EB E63E FD7E0D          19      LD  A,(IY+13)   ;BPB_SecPerClus
0018EE E641 DD7707          19      LD  (IX+DPB_SECPCL),A
                                
0018F1 E644 FD7E16          19      LD  A,(IY+22)   ;BPB_FATSz16
0018F4 E647 DD7700          19      LD  (IX+DPB_FATLN),A
0018F7 E64A FD7E17          19      LD  A,(IY+23)   ;BPB_FATSz16
0018FA E64D DD7701          19      LD  (IX+DPB_FATLN+1),A
                                
0018FD E650 FD6E0E          19      LD  L,(IY+14)   ;BPB_RsvdSecCnt
001900 E653 FD660F          19      LD  H,(IY+15)
001903 E656 DD750E          19      LD  (IX+DPB_FATPS),L
001906 E659 FD5E16          19      LD  E,(IY+22)   ;BPB_FATSz16
001909 E65C FD5617          19      LD  D,(IY+23)
00190C E65F FD4610          19      LD  B,(IY+16)   ;BPB_NumFATs
       E662                     BPBDP1:             ;BPB_FATSz16 * BPB_NumFATs
00190F E662 19              11      ADD HL,DE
001910 E663 10FD            13      DJNZ    BPBDP1
       E665                     BPBDP2:
001912 E665 DD7510          19      LD  (IX+DPB_DIRPS),L
001915 E668 DD7411          19      LD  (IX+DPB_DIRPS+1),H
001918 E66B E5              11      PUSH    HL
                                
001919 E66C FD6E11          19      LD  L,(IY+17)   ;BPB_RootEntCnt
00191C E66F FD6612          19      LD  H,(IY+18)
00191F E672 FD7E0C          19      LD  A,(IY+12)   ;BPB_BytsPerSec
001922 E675 B7               4      OR  A
001923 E676 28BD            12      JR  Z,POP_HL_SCF_RET
001925 E678 0606             7      LD  B,6
       E67A                     BPBBPS1:
001927 E67A 05               4      DEC B
001928 E67B 0F               4      RRCA
001929 E67C 30FC            12      JR  NC,BPBBPS1
       E67E                     BPBDE1:
00192B E67E 29              11      ADD HL,HL
00192C E67F 10FD            13      DJNZ    BPBDE1
                                
00192E E681 7C               4      LD  A,H
00192F E682 DD770B          19      LD  (IX+DPB_DIRSCNT),A  ;
                                
001932 E685 D1              10      POP DE      ;DPB_DIRPS
001933 E686 6C               4      LD  L,H
001934 E687 2600             7      LD  H,0
001936 E689 19              11      ADD HL,DE       ;MAXDIR
001937 E68A E5              11      PUSH    HL
001938 E68B FD4E0D          19      LD  C,(IY+13)   ;BPB_SecPerClus
00193B E68E CB21             8      SLA C       ;*2
00193D E690 AF               4      XOR A
00193E E691 47               4      LD  B,A
00193F E692 ED42            15      SBC HL,BC
001941 E694 DD7514          19      LD  (IX+DPB_ADDCL),L
001944 E697 DD7415          19      LD  (IX+DPB_ADDCL+1),H
                                
001947 E69A D1              10      POP DE      ;DE=DPB_MAXDIR
001948 E69B FD6E13          19      LD  L,(IY+19)   ;BPB_TotSec16
00194B E69E FD6614          19      LD  H,(IY+20)
                                
00194E E6A1 DD7E12          19      LD  A,(IX+DPB_DEVICE)
001951 E6A4 E60F             7      AND 00FH
001953 E6A6 FE07             7      CP  7       ;フロッピー
001955 E6A8 2019            12      JR  NZ,NOT_FD
001957 E6AA E5              11      PUSH    HL
001958 E6AB FD4E18          19      LD  C,(IY+24)   ;BPB_SecPerTr
00195B E6AE DD710D          19      LD  (IX+DPB_MAXSEC),C
00195E E6B1 AF               4      XOR A
00195F E6B2 CB21             8      SLA C       ;両面なのでセクタ数を２倍
001961 E6B4 0610             7      LD  B,16
       E6B6                     DIVSEC:             ;MAXCYL = BPB_TotSec16 / (BPB_SecPerTr * 2)
001963 E6B6 29              11      ADD HL,HL
001964 E6B7 17               4      RLA
001965 E6B8 B9               4      CP  C
001966 E6B9 3802            12      JR  C,DIVSEC1
001968 E6BB 91               4      SUB C
001969 E6BC 2C               4      INC L
       E6BD                     DIVSEC1:
00196A E6BD 10F7            13      DJNZ    DIVSEC
00196C E6BF DD750C          19      LD  (IX+DPB_MAXCYL),L
00196F E6C2 E1              10      POP HL  ;ここまでフロッピー専用
       E6C3                     NOT_FD:
001970 E6C3 7C               4      LD  A,H
001971 E6C4 B5               4      OR  L
001972 E6C5 3E00             7      LD  A,0     ;LDでフラグは変化しない。BPB_TotSec16を AHL で扱う為、Aに0を入れる
001974 E6C7 2010            12      JR  NZ,BPB16BIT ;BPB_TotSec16が「0」の場合はBPB_TotSec32で計算
001976 E6C9 FD7E23          19      LD  A,(IY+35)   ;念のために総セクタ数が24ビットを超える場合はエラーを返す
001979 E6CC B7               4      OR  A
00197A E6CD 37               4      SCF
00197B E6CE C0              11      RET NZ
00197C E6CF FD6E20          19      LD  L,(IY+32)   ;BPB_TotSec32 は AHL の24ビットで扱う
00197F E6D2 FD6621          19      LD  H,(IY+33)   ;1クラスタの論理セクタ数(DPB_SECPCL)が最大128なので
001982 E6D5 FD7E22          19      LD  A,(IY+34)   ;24ビットを超えると必ずクラスタ数が16ビットを超えてしまうのでこれで十分
001985 E6D8 A7               4      AND A       ;CF=0
       E6D9                     BPB16BIT:
001986 E6D9 ED52            15      SBC HL,DE
001988 E6DB DE00             7      SBC A,0
00198A E6DD FD460D          19      LD  B,(IY+13)   ;BPB_SecPerClus
       E6E0                     BPBTC1:             ;総クラスタ数(AHL) = 総セクタ数(AHL) / セクタサイズ(B)
00198D E6E0 CB18             8      RR  B       ;->CY
00198F E6E2 3808            12      JR  C,BPBTC2
001991 E6E4 CB3F             8      SRL A
001993 E6E6 CB1C             8      RR  H       ;AHL=AHL/2
001995 E6E8 CB1D             8      RR  L
001997 E6EA 18F4            12      JR  BPBTC1
       E6EC                     BPBTC2:
001999 E6EC B7               4      OR  A
00199A E6ED 37               4      SCF
00199B E6EE C0              11      RET NZ      ;念のため(クラスタ数が16ビットを超える場合)
00199C E6EF 23               6      INC HL
00199D E6F0 23               6      INC HL
00199E E6F1 DD7508          19      LD  (IX+DPB_MAXCL),L
0019A1 E6F4 DD7409          19      LD  (IX+DPB_MAXCL+1),H
                                
0019A4 E6F7 FD7E15          19      LD  A,(IY+21)   ;BPB_Media
0019A7 E6FA DD7706          19      LD  (IX+DPB_FATID),A
                                
0019AA E6FD FD7E10          19      LD  A,(IY+16)   ;BPB_NumFATs
0019AD E700 C6FE             7      ADD A,0-2       ;>2:CF=1
0019AF E702 FD7E0C          19      LD  A,(IY+12)   ;BPB_BytsPerSec
0019B2 E705 6F               4      LD  L,A
0019B3 E706 3002            12      JR  NC,BPBFAT1
0019B5 E708 F680             7      OR  080H
       E70A                     BPBFAT1:            ;ここではCF=0
0019B7 E70A DD770F          19      LD  (IX+DPB_BPS),A
0019BA E70D 2D               4      DEC L       ;以下のセクタサイズに合致しない場合はCF=1でエラーにする
0019BB E70E C8              11      RET Z       ;1セクタ256バイト
0019BC E70F 2D               4      DEC L
0019BD E710 C8              11      RET Z       ;1セクタ512バイト
0019BE E711 2D               4      DEC L
0019BF E712 2D               4      DEC L
0019C0 E713 C8              11      RET Z       ;1セクタ1024バイト
0019C1 E714 37               4      SCF
0019C2 E715 C9              10      RET
                                
       E716                     RDFATS:
0019C3 E716 CD5CE7          17      CALL    FATSETUP
0019C6 E719 D8              11      RET C
0019C7 E71A CD26E7          17      CALL    DRD24B
0019CA E71D 2A7CF1          16      LD  HL,(_FATBF)
0019CD E720 7E               7      LD  A,(HL)
0019CE E721 C9              10      RET
                                
       E722                     DRD16:
0019CF E722 0E00             7      LD  C,0
       E724                     DRD24:
0019D1 E724 0601             7      LD  B,1
       E726                     DRD24B:
0019D3 E726 DDE5            15      PUSH    IX
0019D5 E728 DD2AA8F0        20      LD  IX,(_DPB)
0019D9 E72C CDB5E9          17      CALL    FDRD        ;自己書き換え（ディスク読み込み）
       E72D                     DRDPAT  EQU $-2
       E72F                     POP_IX_RET:
0019DC E72F DDE1            14      POP IX
0019DE E731 C9              10      RET
                                
       E732                     DWT16:
0019DF E732 0E00             7      LD  C,0
       E734                     DWT24:
0019E1 E734 0601             7      LD  B,1
       E736                     DWT24B:
0019E3 E736 DDE5            15      PUSH    IX
0019E5 E738 DD2AA8F0        20      LD  IX,(_DPB)
0019E9 E73C CD5BE9          17      CALL    FDWT        ;自己書き換え（ディスク書き込み）
       E73D                     DWTPAT  EQU $-2
0019EC E73F 18EE            12      JR  POP_IX_RET
                                
       E741                     WTFAT:
0019EE E741 CD5CE7          17      CALL    FATSETUP
0019F1 E744 D436E7          17      CALL    NC,DWT24B
0019F4 E747 D8              11      RET C
0019F5 E748 DDCB0F7E        20      BIT 7,(IX+DPB_BPS)
0019F9 E74C C8              11      RET Z       ;予備FATが無い
0019FA E74D CD63E7          17      CALL    FATS2
0019FD E750 E5              11      PUSH    HL      ;予備FAT
0019FE E751 DD6E00          19      LD  L,(IX+DPB_FATLN)
001A01 E754 DD6601          19      LD  H,(IX+DPB_FATLN+1)
001A04 E757 19              11      ADD HL,DE
001A05 E758 EB               4      EX  DE,HL
001A06 E759 E1              10      POP HL
001A07 E75A 18DA            12      JR  DWT24B
                                ;------------------------
                                ;FATのセットアップ
                                ;out
                                ;   B  : FATセクタ数
                                ;   DE : FAT先頭セクタ番号
                                ;   HL : FATバッファポインタ
                                ;   CF : 1=ドライブ切り替えエラー
                                ;note
                                ;   FATサイズがFATバッファを超える場合は
                                ;   対象クラスタ領域==(_FATIX)によって
                                ;   FAT12:対象クラスタ1024毎に1.5KBを切り替える
                                ;   FAT16:対象クラスタ1024毎に2KBを切り替える
                                ;------------------------
       E75C                     FATSETUP:
001A09 E75C 3AAAF0          13      LD  A,(_FATDRV)
001A0C E75F CD6BE8          17      CALL    CHGDRVR     ;ドライブ切り替え
001A0F E762 D8              11      RET C
       E763                     FATS2:
001A10 E763 DD7E0F          19      LD  A,(IX+DPB_BPS)  ;512=2 1024=4
001A13 E766 0F               4      RRCA
001A14 E767 CD90E7          17      CALL    FATSETUP12  ;自己書き換え
       E768                     FATSX   EQU $-2
001A17 E76A 210000          10      LD  HL,0
001A1A E76D 4A               4      LD  C,D
001A1B E76E 54               4      LD  D,H
001A1C E76F 3AABF0          13      LD  A,(_FATIX)  ;範囲FAT12:0-3/FAT16:0-63(0-03FH):65535*2/2048
001A1F E772 47               4      LD  B,A
001A20 E773 04               4      INC B
001A21 E774 DD7E00          19      LD  A,(IX+DPB_FATLN)
       E777                     FAT_SKP:
001A24 E777 05               4      DEC B
001A25 E778 2805            12      JR  Z,FAT1
001A27 E77A 19              11      ADD HL,DE
001A28 E77B 93               4      SUB E
001A29 E77C 30F9            12      JR  NC,FAT_SKP
001A2B E77E C9              10      RET
       E77F                     FAT1:
001A2C E77F EB               4      EX  DE,HL
001A2D E780 B9               4      CP  C       ;C=FATバッファに読み込めるセクタ数
001A2E E781 3801            12      JR  C,FAT2
001A30 E783 79               4      LD  A,C
       E784                     FAT2:
001A31 E784 47               4      LD  B,A
                                
001A32 E785 2AFAF1          16      LD  HL,(_FATPS) ;fat sector pos
001A35 E788 19              11      ADD HL,DE
001A36 E789 EB               4      EX  DE,HL
001A37 E78A 2A7CF1          16      LD  HL,(_FATBF)
001A3A E78D AF               4      XOR A       ;CF=0
001A3B E78E 4F               4      LD  C,A
001A3C E78F C9              10      RET
                                ;
                                ;   FATバッファに読み込める最大のセクタ数と_FATIXで進めるセクタ数
                                ;   FATSETUP* (FAT12/FAT16)
                                ;out
                                ;   D : FATバッファに読み込める最大のセクタ数
                                ;   E : _FATIXで進めるセクタ数
       E790                     FATSETUP12:
001A3D E790 110606          10      LD  DE,0606H    ;256
001A40 E793 D8              11      RET C
001A41 E794 110303          10      LD  DE,0303H    ;512
001A44 E797 0F               4      RRCA
001A45 E798 D8              11      RET C
001A46 E799 110102          10      LD  DE,0201H    ;1024
001A49 E79C C9              10      RET
                                
       E79D                     FATSETUP16:
001A4A E79D 110808          10      LD  DE,0808H    ;256
001A4D E7A0 D8              11      RET C
001A4E E7A1 110404          10      LD  DE,0404H
001A51 E7A4 0F               4      RRCA            ;512
001A52 E7A5 D8              11      RET C
001A53 E7A6 110202          10      LD  DE,0202H    ;1024
001A56 E7A9 C9              10      RET
                                
       E7AA                     CHGDRV:
001A57 E7AA E5              11      PUSH    HL
001A58 E7AB 2189F0          10      LD  HL,_DSK
001A5B E7AE BE               7      CP  (HL)
001A5C E7AF 280A            12      JR  Z,CHGDRVE
       E7B1                     CHGDRV1:
001A5E E7B1 DDE5            15      PUSH    IX
001A60 E7B3 CDBDE7          17      CALL    CHGDRV0
001A63 E7B6 3A89F0          13      LD  A,(_DSK)
001A66 E7B9 DDE1            14      POP IX
       E7BB                     CHGDRVE:
001A68 E7BB E1              10      POP HL
001A69 E7BC C9              10      RET
                                
       E7BD                     CHGDRV0:
001A6A E7BD 6F               4      LD  L,A
001A6B E7BE CDDCF0          17      CALL    _GETDPB
001A6E E7C1 D8              11      RET C
001A6F E7C2 DD22A8F0        20      LD  (_DPB),IX
001A73 E7C6 7D               4      LD  A,L
001A74 E7C7 3289F0          13      LD  (_DSK),A
       E7CA                     CHGDRV2:
001A77 E7CA C5              11      PUSH    BC
001A78 E7CB D5              11      PUSH    DE
001A79 E7CC ED7321E8        20      LD  (SPPAT2),SP
001A7D E7D0 F3               4      DI
001A7E E7D1 DDF9            10      LD  SP,IX
                                
001A80 E7D3 E1              10      POP HL      ;00:DPB_FATLN
001A81 E7D4 E1              10      POP HL      ;02:DPB_DRD
001A82 E7D5 222DE7          16      LD  (DRDPAT),HL
                                
001A85 E7D8 E1              10      POP HL
001A86 E7D9 223DE7          16      LD  (DWTPAT),HL ;04:DPB_DWT
                                
001A89 E7DC E1              10      POP HL      ;L=06:DPB_FATID H=07:DPB_SECPCL
001A8A E7DD 7C               4      LD  A,H
001A8B E7DE 322EDE          13      LD  (SPCPAT),A  ;1クラスタの論理セクタ数
001A8E E7E1 3D               4      DEC A
001A8F E7E2 329FE5          13      LD  (_NCPAT),A
                                
001A92 E7E5 E1              10      POP HL      ;08:DPB_MAXCL
001A93 E7E6 7D               4      LD  A,L
001A94 E7E7 324DDE          13      LD  (CLPAT2),A
001A97 E7EA 7C               4      LD  A,H
001A98 E7EB 3249DE          13      LD  (CLPAT1),A
001A9B E7EE 2B               6      DEC HL
001A9C E7EF 2250E0          16      LD  (MAXCLP),HL
                                
001A9F E7F2 E1              10      POP HL      ;L=0A:DPB_FDMODE H=0B:DPB_DIRSCNT
001AA0 E7F3 7D               4      LD  A,L
001AA1 E7F4 F6FE             7      OR  0FEH
001AA3 E7F6 32B3F0          13      LD  (FDMODE+1),A
001AA6 E7F9 07               4      RLCA
001AA7 E7FA E603             7      AND 3
001AA9 E7FC 32F8E8          13      LD  (FSPAT+1),A
001AAC E7FF 4C               4      LD  C,H
                                
001AAD E800 E1              10      POP HL      ;L=0C:DPB_MAXCYL H=0D:DPB_MAXSEC
                                
001AAE E801 E1              10      POP HL      ;L=0E:DPB_FATPS H=0F:DPB_BPS
001AAF E802 7C               4      LD  A,H     ;DPB_BPS
001AB0 E803 E607             7      AND 7
001AB2 E805 3239E3          13      LD  (SECSZ+2),A ;1セクタのサイズの上位1バイト 0x400 - 0x200 - 0x100
                                                ;1セクタ512 2D/2DD/2HC/2HQ(2HD1.44MB)/EMM/BRAM/EMEM等
                                                ;1セクタ1024 2HD/2HDE98
                                                ;1セクタ256 GRAM/RAMF/CMOS/等
                                                ;1024   512 256
                                                ;4  2   1
001AB5 E808 87               4      ADD A,A     ;8  4   2
001AB6 E809 87               4      ADD A,A     ;010H   8   4
001AB7 E80A 87               4      ADD A,A     ;020H   010H    8
001AB8 E80B 32AADC          13      LD  (SDECPAT),A ;1セクタ辺りのディレクトリエントリ数
                                
001ABB E80E 2600             7      LD  H,0
001ABD E810 22FAF1          16      LD  (_FATPS),HL
                                
001AC0 E813 E1              10      POP HL      ;10:DPB_DIRPS
001AC1 E814 22FCF1          16      LD  (_DIRPS),HL
                                
001AC4 E817 E1              10      POP HL      ;L=12:DPB_DEVICE H=13:DPB_UNITNO
001AC5 E818 7C               4      LD  A,H
001AC6 E819 3284F0          13      LD  (_DRIVE),A
                                
001AC9 E81C E1              10      POP HL      ;14:DPB_ADDCL
001ACA E81D 223EDE          16      LD  (CLSPAT),HL
                                
001ACD E820 310000          10      LD  SP,0        ;元のSPを復元
       E821                     SPPAT2  EQU $-2
001AD0 E823 FB               4      EI
001AD1 E824 2AFCF1          16      LD  HL,(_DIRPS)
001AD4 E827 0600             7      LD  B,0
001AD6 E829 09              11      ADD HL,BC       ;C=DPB_DIRSCNT
001AD7 E82A 22C5DC          16      LD  (MD_PAT),HL
                                
001ADA E82D 2A50E0          16      LD  HL,(MAXCLP);
001ADD E830 11F60F          10      LD  DE,4086     ;クラスタ数が4086未満:FAT12 4086以上:FAT16
001AE0 E833 ED52            15      SBC HL,DE       ;CF=0のはず
001AE2 E835 300F            12      JR  NC,SETFAT16
001AE4 E837 2125E5          10      LD  HL,GNCL     ;FAT12
001AE7 E83A 1148E5          10      LD  DE,SNCL
001AEA E83D 0190E7          10      LD  BC,FATSETUP12
001AED E840 DDCB0FAE        23      RES 5,(IX+DPB_BPS)  ;DPB_BPS(FAT12)
001AF1 E844 180D            12      JR  EXTRA1
       E846                     SETFAT16:
001AF3 E846 217CE5          10      LD  HL,GNCL16   ;FAT16
001AF6 E849 1189E5          10      LD  DE,SNCL16
001AF9 E84C 019DE7          10      LD  BC,FATSETUP16
001AFC E84F DDCB0FEE        23      SET 5,(IX+DPB_BPS)  ;DPB_BPS(FAT16)
       E853                     EXTRA1:
001B00 E853 22F8F0          16      LD  (GNCPAT),HL
001B03 E856 ED53FBF0        20      LD  (SNCPAT),DE
001B07 E85A ED4368E7        20      LD  (FATSX),BC
001B0B E85E D1              10      POP DE
001B0C E85F C1              10      POP BC
001B0D E860 AF               4      XOR A
001B0E E861 C9              10      RET
                                
       E862                     GETDPBD:
001B0F E862 DDE3            23      EX  (SP),IX
001B11 E864 DDE5            15      PUSH    IX
001B13 E866 3A88F0          13      LD  A,(_DRV)
001B16 E869 1807            12      JR  GETDPB1
                                
       E86B                     CHGDRVR:
001B18 E86B CDD9F0          17      CALL    _CHGDRV
001B1B E86E D8              11      RET C
001B1C E86F 3A89F0          13      LD  A,(_DSK)
       E872                     GETDPB1:
001B1F E872 C3DCF0          10      JP  _GETDPB
                                
       E875                     GETDPB:
001B22 E875 FE08             7      CP  8
001B24 E877 3F               4      CCF
001B25 E878 D8              11      RET C
001B26 E879 0F               4      RRCA
001B27 E87A 0F               4      RRCA
001B28 E87B 0F               4      RRCA
001B29 E87C DD                      DB  0DDH        ;Z80未定義命令
001B2A E87D 6F               4      LD  L,A     ;LD IXL,A
001B2B E87E DD                      DB  0DDH        ;Z80未定義命令
001B2C E87F 26F2             7      LD  H,_DEVICE/256   ;LD IXH,_DEVICE/256
001B2E E881 DD7E00          19      LD  A,(IX+DPB_FATLN)
001B31 E884 A7               4      AND A       ;CF=0の為
001B32 E885 DDCB0F6E        20      BIT 5,(IX+DPB_BPS)
001B36 E889 C0              11      RET NZ      ;FAT16
001B37 E88A DDCB126E        20      BIT 5,(IX+DPB_DEVICE)
001B3B E88E C0              11      RET NZ      ;BPB
001B3C E88F FE01             7      CP  001H        ;A=0 THEN CF=1
001B3E E891 C9              10      RET
                                
       E892                     _SYS5F:
001B3F E892 AF               4      XOR A
       E893                     FFLUSH:
001B40 E893 F5              11      PUSH    AF
001B41 E894 CDADE4          17      CALL    WTFATX
001B44 E897 AF               4      XOR A
001B45 E898 32ABF0          13      LD  (_FATIX),A
001B48 E89B 2F               4      CPL         ;0FFH
001B49 E89C 32AAF0          13      LD  (_FATDRV),A
001B4C E89F 3E                      DB  03EH        ;次のPUSH AFをスキップ
       E8A0                     FFLUSHBUF:
001B4D E8A0 F5              11      PUSH    AF
001B4E E8A1 CD63E4          17      CALL    DWTX
001B51 E8A4 3EFF             7      LD  A,0FFH
001B53 E8A6 3239F0          13      LD  (SFILE),A
001B56 E8A9 32A5F0          13      LD  (_DBDRV),A
001B59 E8AC F1              10      POP AF
001B5A E8AD C9              10      RET
                                
[EOF:LDDIO.ASM:SHIFT_JIS]
                                    INCLUDE "M7DISK.ASM"
                                
                                ;   LSX-Dodgers DISK
                                ;   MZ-700/1500
                                
       E8AE                     SEEK:
001B5B E8AE 0610             7      LD  B,16
001B5D E8B0 DD4E0D          19      LD  C,(IX+DPB_MAXSEC)
001B60 E8B3 AF               4      XOR A
001B61 E8B4 EB               4      EX  DE,HL
       E8B5                     DIV1:
001B62 E8B5 29              11      ADD HL,HL
001B63 E8B6 8F               4      ADC A,A
001B64 E8B7 B9               4      CP  C
001B65 E8B8 3802            12      JR  C,DIV2
001B67 E8BA 91               4      SUB C
001B68 E8BB 2C               4      INC L
       E8BC                     DIV2:
001B69 E8BC 10F7            13      DJNZ    DIV1
                                
001B6B E8BE 3C               4      INC A   ;最小のセクタは１固定
001B6C E8BF 55               4      LD  D,L ;TRACK
001B6D E8C0 5F               4      LD  E,A ;SECTOR
                                
001B6E E8C1 3A84F0          13      LD  A,(_DRIVE)
001B71 E8C4 FE04             7      CP  4
001B73 E8C6 3F               4      CCF
001B74 E8C7 D8              11      RET C
001B75 E8C8 F684             7      OR  084H        ;Motor on + ドライブセレクト有効
001B77 E8CA D3DC            11      OUT (0DCH),A
001B79 E8CC CB3A             8      SRL D       ;CYLINDER
001B7B E8CE 9F               4      SBC A,A
001B7C E8CF D3DD            11      OUT (0DDH),A    ;SIDE
                                
001B7E E8D1 CD0EE9          17      CALL    SETMODE
001B81 E8D4 D8              11      RET C
                                
001B82 E8D5 CD45E9          17      CALL    DRIVE
001B85 E8D8 FEFF             7      CP  0FFH        ;A=0FFH Unknown CYLINDER
001B87 E8DA CC2AE9          17      CALL    Z,FDCRES    ;Restore
001B8A E8DD 2F               4      CPL         ;データバスが負論理
001B8B E8DE D3D9            11      OUT (0D9H),A    ;Currrent CYLINDER
001B8D E8E0 2F               4      CPL         ;データバスが負論理
001B8E E8E1 92               4      SUB D
001B8F E8E2 C8              11      RET Z       ;No seek
                                
001B90 E8E3 3A86F0          13      LD  A,(_ISEEK)
001B93 E8E6 4F               4      LD  C,A
                                
001B94 E8E7 DD7E0C          19      LD  A,(IX+DPB_MAXCYL)
001B97 E8EA 3D               4      DEC A
001B98 E8EB BA               4      CP  D       ;Over CYLINDER
001B99 E8EC D8              11      RET C
                                
001B9A E8ED 7A               4      LD  A,D
001B9B E8EE 2F               4      CPL         ;データバスが負論理
001B9C E8EF D3DB            11      OUT (0DBH),A
001B9E E8F1 72               7      LD  (HL),D
                                
001B9F E8F2 0E18             7      LD  C,018H      ;Seek
       E8F4                     FDCCMD2:
001BA1 E8F4 3A85F0          13      LD  A,(_SEEKSP)
001BA4 E8F7 E6FF             7  FSPAT:  AND 0FFH
001BA6 E8F9 B1               4      OR  C
                                
       E8FA                     FDCCMD:
001BA7 E8FA CD3CE9          17      CALL    COMSET
       E8FE                     FDCSMC  EQU $+1
001BAA E8FD 3E80             7      LD  A,080H      ;FDC COMMAND(Self-modifying code)
001BAC E8FF E620             7      AND 020H        ;Write data Write track
001BAE E901 3C               4      INC A
                                
       E902                     SST:
001BAF E902 0E00             7      LD  C,0
       E904                     SST1:
001BB1 E904 0D               4      DEC C       ; 4
001BB2 E905 20FD            12      JR  NZ,SST1     ;12 * 256 / 4 = About 1ms
001BB4 E907 3D               4      DEC A
001BB5 E908 20FA            12      JR  NZ,SST1
                                
001BB7 E90A 3C               4      INC A       ;A=1
001BB8 E90B CD13E9          17      CALL    READY
       E90E                     SETMODE:
001BBB E90E CD3FE9          17      CALL    DELAY0      ;Head select time
001BBE E911 3E81             7      LD  A,081H
       E913                     READY:
001BC0 E913 321DE9          13      LD  (WAITA),A
001BC3 E916 E5              11      PUSH    HL
001BC4 E917 26F8             7      LD  H,0F8H
       E919                     READY2:
001BC6 E919 DBD8            11      IN  A,(0D8H)
001BC8 E91B 2F               4      CPL         ;データバスが負論理
       E91D                     WAITA   EQU $+1
001BC9 E91C E681             7      AND 081H        ;NOT READY,BUSY
001BCB E91E 2808            12      JR  Z,READYE
001BCD E920 E3              19      EX  (SP),HL     ;wait 19clock
001BCE E921 E3              19      EX  (SP),HL     ; //
001BCF E922 2B               6      DEC HL
001BD0 E923 7C               4      LD  A,H
001BD1 E924 B5               4      OR  L
001BD2 E925 20F2            12      JR  NZ,READY2
001BD4 E927 37               4      SCF
       E928                     READYE:
001BD5 E928 E1              10      POP HL
001BD6 E929 C9              10      RET
                                
       E92A                     FDCRES:
001BD7 E92A 3600            10      LD  (HL),0
001BD9 E92C 0E08             7      LD  C,8
001BDB E92E 18C4            12      JR  FDCCMD2
                                
       E930                     FDMOFF:
001BDD E930 F5              11      PUSH    AF
001BDE E931 AF               4      XOR A       ;Motor off(ドライブセレクト無効)
001BDF E932 D3DC            11      OUT (0DCH),A
001BE1 E934 F1              10      POP AF
001BE2 E935 C9              10      RET
                                
       E936                     SECSET:
001BE3 E936 F5              11      PUSH    AF
001BE4 E937 7B               4      LD  A,E
001BE5 E938 2F               4      CPL         ;データバスが負論理
001BE6 E939 D3DA            11      OUT (0DAH),A
001BE8 E93B F1              10      POP AF
       E93C                     COMSET:
001BE9 E93C 2F               4      CPL         ;データバスが負論理
001BEA E93D D3D8            11      OUT (0D8H),A
       E93F                     DELAY0:
001BEC E93F 3E1A             7      LD  A,26
       E941                     DELAY:
001BEE E941 3D               4      DEC A
001BEF E942 20FD            12      JR  NZ,DELAY
001BF1 E944 C9              10      RET
                                
       E945                     DRIVE:
001BF2 E945 2A84F0          16      LD  HL,(_DRIVE)
001BF5 E948 26F0             7      LD  H,_CYL0/256
001BF7 E94A CBFD             8      SET 7,L
001BF9 E94C 7E               7      LD  A,(HL)
001BFA E94D C9              10      RET
                                
       E94E                     RNF:
001BFB E94E CD45E9          17      CALL    DRIVE
001BFE E951 36FF            10      LD  (HL),0FFH
001C00 E953 C9              10      RET
                                
001C01 E954 02                  RETRY:  DB  2
                                
                                
                                ;   FLOPPY DISK DRIVER
                                
       E955                     WTTRK:
001C02 E955 0601             7      LD  B,1
001C04 E957 3EF4             7      LD  A,0F4H
001C06 E959 1802            12      JR  WTTRK1
       E95B                     FDWT:
001C08 E95B 3EA0             7      LD  A,0A0H
       E95D                     WTTRK1:
001C0A E95D 32FEE8          13      LD  (FDCSMC),A
       E960                     DWTBL:
001C0D E960 78               4      LD  A,B
001C0E E961 32A0E9          13      LD  (WTBSMC),A
001C11 E964 3E02             7      LD  A,2     ;Retry count
001C13 E966 3254E9          13      LD  (RETRY),A
                                
       E969                     DWT0:
001C16 E969 D5              11      PUSH    DE
001C17 E96A E5              11      PUSH    HL
001C18 E96B CDAEE8          17      CALL    SEEK        ;Write disk
001C1B E96E E1              10      POP HL
001C1C E96F 383A            12      JR  C,ERRDW
001C1E E971 F3               4      DI
001C1F E972 3AFEE8          13      LD  A,(FDCSMC)
001C22 E975 CD36E9          17      CALL    SECSET
001C25 E978 0EDB             7      LD  C,0DBH
       E97A                     DWT1:
001C27 E97A 7E               7      LD  A,(HL)
001C28 E97B 2F               4      CPL         ;データバスが負論理
001C29 E97C 57               4      LD  D,A
                                
       E97D                     DWT2:
001C2A E97D DBD8            11      IN  A,(0D8H)
001C2C E97F 2F               4      CPL         ;データバスが負論理
001C2D E980 0F               4      RRCA
001C2E E981 3008            12      JR  NC,DWT4
001C30 E983 0F               4      RRCA
001C31 E984 30F7            12      JR  NC,DWT2
       E986                     DWT3:
001C33 E986 ED51            12      OUT (C),D
001C35 E988 23               6      INC HL
001C36 E989 18EF            12      JR  DWT1
                                
       E98B                     DWT4:
001C38 E98B 3D               4      DEC A
001C39 E98C 28F8            12      JR  Z,DWT3
001C3B E98E 3C               4      INC A
001C3C E98F FB               4      EI
001C3D E990 D1              10      POP DE
001C3E E991 13               6      INC DE
001C3F E992 CD30E9          17      CALL    FDMOFF
001C42 E995 2808            12      JR  Z,DISKOK_WT
001C44 E997 CD02EA          17      CALL    DISKC
001C47 E99A 20CD            12      JR  NZ,DWT0
001C49 E99C B7               4      OR  A
001C4A E99D 2005            12      JR  NZ,ERRW
                                
       E99F                     DISKOK_WT:
       E9A0                     WTBSMC  EQU $+1
001C4C E99F 0601             7      LD  B,1
001C4E E9A1 10BD            13      DJNZ    DWTBL
001C50 E9A3 C9              10      RET
                                
       E9A4                     ERRW:
001C51 E9A4 3EFF             7      LD  A,0FFH
       E9A6                     ERRZ:
001C53 E9A6 BF               4      CP  A
001C54 E9A7 37               4      SCF
001C55 E9A8 C330E9          10      JP  FDMOFF
                                
       E9AB                     ERRDW:
001C58 E9AB D1              10      POP DE
001C59 E9AC CD13EA          17      CALL    DELP
001C5C E9AF 20B8            12      JR  NZ,DWT0
001C5E E9B1 B7               4      OR  A
001C5F E9B2 20F0            12      JR  NZ,ERRW
001C61 E9B4 C9              10      RET
                                
       E9B5                     FDRD:
001C62 E9B5 3E80             7      LD  A,080H
001C64 E9B7 32FEE8          13      LD  (FDCSMC),A
       E9BA                     DRDBL:
001C67 E9BA 78               4      LD  A,B
001C68 E9BB 32F4E9          13      LD  (RDBSMC),A
001C6B E9BE 3E02             7      LD  A,2     ;Retry count
001C6D E9C0 3254E9          13      LD  (RETRY),A
       E9C3                     DRD0:
001C70 E9C3 D5              11      PUSH    DE
001C71 E9C4 E5              11      PUSH    HL
001C72 E9C5 CDAEE8          17      CALL    SEEK        ;Read disk
001C75 E9C8 E1              10      POP HL
001C76 E9C9 382D            12      JR  C,ERRDR
001C78 E9CB F3               4      DI
001C79 E9CC 3AFEE8          13      LD  A,(FDCSMC)
001C7C E9CF CD36E9          17      CALL    SECSET
       E9D2                     DRD1:
001C7F E9D2 DBD8            11      IN  A,(0D8H)
001C81 E9D4 2F               4      CPL         ;データバスが負論理
001C82 E9D5 0F               4      RRCA
001C83 E9D6 300A            12      JR  NC,DRD3
001C85 E9D8 0F               4      RRCA
001C86 E9D9 30F7            12      JR  NC,DRD1
001C88 E9DB DBDB            11      IN  A,(0DBH)
001C8A E9DD 2F               4      CPL         ;データバスが負論理
001C8B E9DE 77               7      LD  (HL),A
001C8C E9DF 23               6      INC HL
001C8D E9E0 18F0            12      JR  DRD1
                                
       E9E2                     DRD3:
001C8F E9E2 B7               4      OR  A
001C90 E9E3 FB               4      EI
001C91 E9E4 D1              10      POP DE
001C92 E9E5 13               6      INC DE
001C93 E9E6 CD30E9          17      CALL    FDMOFF
001C96 E9E9 2808            12      JR  Z,DISKOK_RD
001C98 E9EB CD02EA          17      CALL    DISKC
001C9B E9EE 20D3            12      JR  NZ,DRD0
001C9D E9F0 B7               4      OR  A
001C9E E9F1 20B1            12      JR  NZ,ERRW
                                
       E9F3                     DISKOK_RD:
       E9F4                     RDBSMC  EQU $+1
001CA0 E9F3 0601             7      LD  B,1
001CA2 E9F5 10C3            13      DJNZ    DRDBL
001CA4 E9F7 C9              10      RET
                                
       E9F8                     ERRDR:
001CA5 E9F8 D1              10      POP DE
001CA6 E9F9 CD13EA          17      CALL    DELP
001CA9 E9FC 20C5            12      JR  NZ,DRD0
001CAB E9FE B7               4      OR  A
001CAC E9FF 20A3            12      JR  NZ,ERRW
001CAE EA01 C9              10      RET
       EA02                     DISKC:
001CAF EA02 1B               6      DEC DE
001CB0 EA03 CB5F             8      BIT 3,A
001CB2 EA05 C44EE9          17      CALL    NZ,RNF
       EA08                     DISKD:
001CB5 EA08 E5              11      PUSH    HL
001CB6 EA09 2154E9          10      LD  HL,RETRY
001CB9 EA0C 35              11      DEC (HL)
001CBA EA0D E1              10      POP HL
001CBB EA0E 200C            12      JR  NZ,ERR      ;Retry
001CBD EA10 B7               4      OR  A
001CBE EA11 2809            12      JR  Z,ERR       ;Error
                                
       EA13                     DELP:
001CC0 EA13 CD4EE9          17      CALL    RNF
001CC3 EA16 CD30E9          17      CALL    FDMOFF
001CC6 EA19 3EFF             7      LD  A,0FFH
       EA1B                     AERRZ:
001CC8 EA1B BF               4      CP  A
       EA1C                     ERR:
001CC9 EA1C 3EFF             7      LD  A,0FFH
001CCB EA1E C9              10      RET
                                
       F0B2                     FDMODE  EQU TVRAMTOP
[EOF:M7DISK.ASM:SHIFT_JIS]
                                    INCLUDE "M7DISK2.ASM"
                                
                                ;   LSX-Dodgers DISK2
                                ;   MZ-700/1500
                                
                                ;   EMM DRIVER
                                ;   1セクタ可変(256/512/1024)
                                
       EA1F                     EDWT:
001CCC EA1F F5              11      PUSH    AF
001CCD EA20 CD3EEA          17      CALL    EADR
001CD0 EA23 0600             7      LD  B,0
       EA25                     EDWT1:
001CD2 EA25 EDB3                    OTIR
001CD4 EA27 3D               4      DEC A
001CD5 EA28 20FB            12      JR  NZ,EDWT1
001CD7 EA2A 180B            12      JR  EDRW1
                                
       EA2C                     EDRD:
001CD9 EA2C C5              11      PUSH    BC
001CDA EA2D CD3EEA          17      CALL    EADR
001CDD EA30 0600             7      LD  B,0
       EA32                     EDRD1:
001CDF EA32 EDB2                    INIR
001CE1 EA34 3D               4      DEC A
001CE2 EA35 20FB            12      JR  NZ,EDRD1
       EA37                     EDRW1:
001CE4 EA37 F1              10      POP AF
001CE5 EA38 83               4      ADD A,E ;セクタを進める
001CE6 EA39 5F               4      LD  E,A
001CE7 EA3A 8A               4      ADC A,D
001CE8 EA3B 93               4      SUB E
001CE9 EA3C 57               4      LD  D,A
001CEA EA3D C9              10      RET
                                
       EA3E                     EADR:
001CEB EA3E D5              11      PUSH    DE
001CEC EA3F EB               4      EX  DE,HL
001CED EA40 78               4      LD  A,B
001CEE EA41 DD460F          19      LD  B,(IX+DPB_BPS)
       EA44                     EADR1:              ;読み込むセクタ数と1クラスタのセクタ数を掛ける
001CF1 EA44 CB18             8      RR  B
001CF3 EA46 3804            12      JR  C,EADR2
001CF5 EA48 87               4      ADD A,A
001CF6 EA49 29              11      ADD HL,HL
001CF7 EA4A 18F8            12      JR  EADR1
       EA4C                     EADR2:
001CF9 EA4C DD4E0D          19      LD  C,(IX+DPB_MAXSEC)
001CFC EA4F DD460C          19      LD  B,(IX+DPB_MAXCYL)
001CFF EA52 09              11      ADD HL,BC
001D00 EA53 DD4E13          19      LD  C,(IX+DPB_UNITNO)
001D03 EA56 ED71                    DB  0EDH,071H   ;OUT (C),0  Z80未定義命令
001D05 EA58 0C               4      INC C
001D06 EA59 ED69            12      OUT (C),L
001D08 EA5B 0C               4      INC C
001D09 EA5C ED61            12      OUT (C),H
001D0B EA5E 0C               4      INC C
001D0C EA5F EB               4      EX  DE,HL
001D0D EA60 D1              10      POP DE
001D0E EA61 C9              10      RET
                                
                                ;   CMOS BACKUP MEMORY DRIVER(32KB)
                                ;   1セクタ256
                                
       EA62                     CDWT:
001D0F EA62 78               4      LD  A,B
001D10 EA63 DD4E13          19      LD  C,(IX+DPB_UNITNO)
001D13 EA66 ED40            12      IN  B,(C)       ;アドレスカウンタを0000にリセット
001D15 EA68 ED59            12      OUT (C),E       ;W)アドレスカウンタ上位
001D17 EA6A 01FA00          10      LD  BC,000FAH
       EA6D                     CDWT1:
001D1A EA6D EDB3                    OTIR            ;W)データ書き込み・アドレスカウンタ+1
001D1C EA6F 13               6      INC DE
001D1D EA70 3D               4      DEC A
001D1E EA71 20FA            12      JR  NZ,CDWT1
001D20 EA73 A7               4      AND A
001D21 EA74 C9              10      RET
                                
       EA75                     CDRD:
001D22 EA75 78               4      LD  A,B
001D23 EA76 DD4E13          19      LD  C,(IX+DPB_UNITNO)
001D26 EA79 ED40            12      IN  B,(C)       ;アドレスカウンタを0000にリセット
001D28 EA7B ED59            12      OUT (C),E       ;W)アドレスカウンタ上位
001D2A EA7D 01F900          10      LD  BC,000F9H
       EA80                     CDRD1:
001D2D EA80 EDB2                    INIR            ;R)データ読み出し・アドレスカウンタ+1
001D2F EA82 13               6      INC DE
001D30 EA83 3D               4      DEC A
001D31 EA84 20FA            12      JR  NZ,CDRD1
001D33 EA86 A7               4      AND A
001D34 EA87 C9              10      RET
                                
                                ;   RAM DISK DRIVER (64KB)
                                ;   1セクタ256
                                
       EA88                     RDWT:
001D35 EA88 3EB3             7      LD  A,0B3H      ;OTIR
001D37 EA8A 1802            12      JR  RDRW
       EA8C                     RDRD:
001D39 EA8C 3EB2             7      LD  A,0B2H      ;INIR
       EA8E                     RDRW:
001D3B EA8E 329BEA          13      LD  (RDRW1+1),A
                                
001D3E EA91 78               4      LD  A,B
001D3F EA92 43               4      LD  B,E     ;B=アドレスカウンタ上位(X1の様な16bitのI/Oアクセス)
001D40 EA93 0EEB             7      LD  C,0EBH
001D42 EA95 ED71            12      OUT (C),0       ;0=アドレスカウンタ下位
001D44 EA97 0D               4      DEC C       ;EA(R)データ読み出し・アドレスカウンタ+1
001D45 EA98 0600             7      LD  B,0
       EA9A                     RDRW1:
001D47 EA9A EDB2                    INIR            ;自己書き換え(INIR/OTIR)
001D49 EA9C 13               6      INC DE
001D4A EA9D 3D               4      DEC A
001D4B EA9E 20FA            12      JR  NZ,RDRW1
001D4D EAA0 A7               4      AND A
001D4E EAA1 C9              10      RET
[EOF:M7DISK2.ASM:UTF_8]
                                    INCLUDE "LDCCPWK.ASM"
                                
                                ;   LSX-Dodgers CCP WORK
                                
       003B                     PATHX   EQU 59
001D4F EAA2                     PATHD:  DS  PATHX
001D8A EADD 00                  PATHE:  DB  0
                                
       EADE                     DTA_CCP:
001D8B EADE                         DS  37
                                
       EB03                     FCB_BAT:
001DB0 EB03                         DS  37
                                
001DD5 EB28 2020203C4449523E    DIRMES: DB  "   <DIR>  $"
            202024              
001DE0 EB33 20667265652024      FREE:   DB  " free $"
[EOF:LDCCPWK.ASM:UTF_8]
                                    INCLUDE "M7TABLE.ASM"
                                
                                ;   LSX-Dodgers TABLE 表示関連のテーブル
                                ;   MZ-700/1500
                                
       EB3A                     AT_TABLE:
001DE7 EB3A                         DS  TABLEAD-AT_TABLE
                                
       ED40                     KEY_TABLE:
001FED ED40 12081E1F1C1D5C2F        DB  12H,08H,1EH,1FH,1CH,1DH,5CH,'/'
001FF5 ED48 5C5E2D2030392C2E        DB  5CH,'^','-',20H,'0','9',',','.'
001FFD ED50 3132333435363738        DB  '1','2','3','4','5','6','7','8'
002005 ED58 6162636465666768        DB  'a','b','c','d','e','f','g','h'
00200D ED60 696A6B6C6D6E6F70        DB  'i','j','k','l','m','n','o','p'
002015 ED68 7172737475767778        DB  'q','r','s','t','u','v','w','x'
00201D ED70 797A405B5D000000        DB  'y','z','@','[',']',00H,00H,00H
002025 ED78 001B3D09003B3A0D        DB  00H,1BH,'=',09H,00H,';',':',0DH
       ED80                     SHIFT_TABLE:
00202D ED80 12081E1F1C1D5F3F        DB  12H,08H,1EH,1FH,1CH,1DH,'_','?'
002035 ED88 7C7E3D2030293C3E        DB  '|','~','=',20H,'0',')','<','>'
00203D ED90 2122232425262728        DB  '!','"','#','$','%','&',27H,'('
002045 ED98 4142434445464748        DB  'A','B','C','D','E','F','G','H'
00204D EDA0 494A4B4C4D4E4F50        DB  'I','J','K','L','M','N','O','P'
002055 EDA8 5152535455565758        DB  'Q','R','S','T','U','V','W','X'
00205D EDB0 595A607B7D000000        DB  'Y','Z','`','{','}',00H,00H,00H
002065 EDB8 00003D09002B2A0D        DB  00H,00H,'=',09H,00H,'+','*',0DH
       EDC0                     CTRL_TABLE:
00206D EDC0 12081E1F1C1D3F2F        DB  12H,08H,1EH,1FH,1CH,1DH,'?','/'
002075 EDC8 2A2B2D2030392C2E        DB  '*','+','-',20H,'0','9',',','.'
00207D EDD0 3132333435363738        DB  '1','2','3','4','5','6','7','8'
002085 EDD8 0102030405060708        DB  01H,02H,03H,04H,05H,06H,07H,08H
00208D EDE0 090A0B0C0D0E0F10        DB  09H,0AH,0BH,0CH,0DH,0EH,0FH,10H
002095 EDE8 1112131415161718        DB  11H,12H,13H,14H,15H,16H,17H,18H
00209D EDF0 191A1B5B5D000000        DB  19H,1AH,1BH,'[',']',00H,00H,00H
0020A5 EDF8 00003D09003B3A0D        DB  00H,00H,'=',09H,00H,';',':',0DH
                                
                                ;   アドレス下位1バイトが0になるように
       EE00                     CD_TABLE:
0020AD EE00 00D1D2D3D4D5D6D0        DB  $00,$D1,$D2,$D3,$D4,$D5,$D6,$D0 ;月火水木金土日
0020B5 EE08 D8DCD9DADBD7CFCE        DB  $D8,$DC,$D9,$DA,$DB,$D7,$CF,$CE ;年円時分秒
0020BD EE10 601F5F5E1E1B7978        DB  $60,$1F,$5F,$5E,$1E,$1B,$79,$78 ;
0020C5 EE18 5C5D1C1D6DCACDC7        DB  $5C,$5D,$1C,$1D,$6D,$CA,$CD,$C7 ;
0020CD EE20 0061626364656667        DB  $00,$61,$62,$63,$64,$65,$66,$67 ; !"#$%&'
0020D5 EE28 68696B6A2F2A2E2D        DB  $68,$69,$6B,$6A,$2F,$2A,$2E,$2D ;()*+,-./
0020DD EE30 2021222324252627        DB  $20,$21,$22,$23,$24,$25,$26,$27 ;01234567
0020E5 EE38 28294F2C512B5749        DB  $28,$29,$4F,$2C,$51,$2B,$57,$49 ;89:;<=>?
0020ED EE40 5501020304050607        DB  $55,$01,$02,$03,$04,$05,$06,$07 ;@ABCDEFG
0020F5 EE48 08090A0B0C0D0E0F        DB  $08,$09,$0A,$0B,$0C,$0D,$0E,$0F ;HIJKLMNO
0020FD EE50 1011121314151617        DB  $10,$11,$12,$13,$14,$15,$16,$17 ;PQRSTUVW
002105 EE58 18191A52DD54507C        DB  $18,$19,$1A,$52,$DD,$54,$50,$7C ;XYZ[\]^_
00210D EE60 5901020304050607        DB  $59,$01,$02,$03,$04,$05,$06,$07 ;`abcdefg   ATB:1
002115 EE68 08090A0B0C0D0E0F        DB  $08,$09,$0A,$0B,$0C,$0D,$0E,$0F ;hijklmno   ATB:1
00211D EE70 1011121314151617        DB  $10,$11,$12,$13,$14,$15,$16,$17 ;pqrstuvw   ATB:1
002125 EE78 18191ACB35CC705A        DB  $18,$19,$1A,$CB,$35,$CC,$70,$5A ;xyz{|}~    ATB:1
00212D EE80 415346444847B49E        DB  $41,$53,$46,$44,$48,$47,$B4,$9E ;トランプ〇●をぁ   ATB:1
002135 EE88 B2B6BABE9FB3B7BB        DB  $B2,$B6,$BA,$BE,$9F,$B3,$B7,$BB ;ぃぅぇぉゃゅょっ   ATB:1
00213D EE90 BFA385A4A5A69487        DB  $BF,$A3,$85,$A4,$A5,$A6,$94,$87 ;ーあいうえおかき   ATB:1
002145 EE98 889C829884929083        DB  $88,$9C,$82,$98,$84,$92,$90,$83 ;くけこさしすせそ   ATB:1
00214D EEA0 F0BD9DB1B5B9B49E        DB  $F0,$BD,$9D,$B1,$B5,$B9,$B4,$9E ;　。「」、・ヲァ
002155 EEA8 B2B6BABE9FB3B7BB        DB  $B2,$B6,$BA,$BE,$9F,$B3,$B7,$BB ;ィゥェォャョュッ
00215D EEB0 BFA385A4A5A69487        DB  $BF,$A3,$85,$A4,$A5,$A6,$94,$87 ;ーアイウエオカキ
002165 EEB8 889C829884929083        DB  $88,$9C,$82,$98,$84,$92,$90,$83 ;クケコサシスセソ
00216D EEC0 91819A97939589A1        DB  $91,$81,$9A,$97,$93,$95,$89,$A1 ;タチツテトナニヌ
002175 EEC8 AF8B8696A2ABAA8A        DB  $AF,$8B,$86,$96,$A2,$AB,$AA,$8A ;ネノハヒフヘホマ
00217D EED0 8EB0AD8DA7A8A98F        DB  $8E,$B0,$AD,$8D,$A7,$A8,$A9,$8F ;ミムメモヤユヨラ
002185 EED8 8CAEAC9BA099BCB8        DB  $8C,$AE,$AC,$9B,$A0,$99,$BC,$B8 ;リルレロワン゛゜
00218D EEE0 91819A97939589A1        DB  $91,$81,$9A,$97,$93,$95,$89,$A1 ;たちつてとねにぬ   ATB:1
002195 EEE8 AF8B8696A2ABAA8A        DB  $AF,$8B,$86,$96,$A2,$AB,$AA,$8A ;ねのはひふへほま   ATB:1
00219D EEF0 8EB0AD8DA7A8A98F        DB  $8E,$B0,$AD,$8D,$A7,$A8,$A9,$8F ;みむめもやゆよら   ATB:1
0021A5 EEF8 8CAEAC9BA099BCB8        DB  $8C,$AE,$AC,$9B,$A0,$99,$BC,$B8 ;りるれろわん゛゜   ATB:1
       EF00                     DC_TABLE:
0021AD EF00 2041424344454647        DB  $20,$41,$42,$43,$44,$45,$46,$47 ;0
0021B5 EF08 48494A4B4C4D4E4F        DB  $48,$49,$4A,$4B,$4C,$4D,$4E,$4F
0021BD EF10 5051525354555657        DB  $50,$51,$52,$53,$54,$55,$56,$57 ;1
0021C5 EF18 58595A151A1B1411        DB  $58,$59,$5A,$15,$1A,$1B,$14,$11
0021CD EF20 3031323334353637        DB  $30,$31,$32,$33,$34,$35,$36,$37 ;2
0021D5 EF28 38392D3D3B2F2E2C        DB  $38,$39,$2D,$3D,$3B,$2F,$2E,$2C
0021DD EF30 00000000007C0000        DB  $00,$00,$00,$00,$00,$7C,$00,$00 ;3
0021E5 EF38 0000000000000000        DB  $00,$00,$00,$00,$00,$00,$00,$00
0021ED EF40 0080000083008285        DB  $00,$80,$00,$00,$83,$00,$82,$85 ;4
0021F5 EF48 843F00000000003A        DB  $84,$3F,$00,$00,$00,$00,$00,$3A
0021FD EF50 5E3C5B815D40003E        DB  $5E,$3C,$5B,$81,$5D,$40,$00,$3E ;5
002205 EF58 00607F0018191312        DB  $00,$60,$7F,$00,$18,$19,$13,$12
00220D EF60 1021222324252627        DB  $10,$21,$22,$23,$24,$25,$26,$27 ;6
002215 EF68 28292B2A001C0000        DB  $28,$29,$2B,$2A,$00,$1C,$00,$00
00221D EF70 7E00000000000000        DB  $7E,$00,$00,$00,$00,$00,$00,$00 ;7
002225 EF78 171600005F000000        DB  $17,$16,$00,$00,$5F,$00,$00,$00
00222D EF80 00C19A9F9C92CA97        DB  $00,$C1,$9A,$9F,$9C,$92,$CA,$97 ;8
002235 EF88 98C6CFC9D8D3D0D7        DB  $98,$C6,$CF,$C9,$D8,$D3,$D0,$D7
00223D EF90 9EC09DC496C5CBC3        DB  $9E,$C0,$9D,$C4,$96,$C5,$CB,$C3 ;9
002245 EF98 9BDDC2DB99A2878C        DB  $9B,$DD,$C2,$DB,$99,$A2,$87,$8C
00224D EFA0 DCC7CC91939495D4        DB  $DC,$C7,$CC,$91,$93,$94,$95,$D4 ;A
002255 EFA8 D5D6CECDDAD2D9C8        DB  $D5,$D6,$CE,$CD,$DA,$D2,$D9,$C8
00225D EFB0 D1A3888D86A4898E        DB  $D1,$A3,$88,$8D,$86,$A4,$89,$8E ;B
002265 EFB8 DFA58A8FDEA18B90        DB  $DF,$A5,$8A,$8F,$DE,$A1,$8B,$90
00226D EFC0 000000000000001F        DB  $00,$00,$00,$00,$00,$00,$00,$1F ;C
002275 EFC8 00001D7B7D1E0F0E        DB  $00,$00,$1D,$7B,$7D,$1E,$0F,$0E
00227D EFD0 070102030405060D        DB  $07,$01,$02,$03,$04,$05,$06,$0D ;D
002285 EFD8 080A0B0C095C0000        DB  $08,$0A,$0B,$0C,$09,$5C,$00,$00
00228D EFE0 0000000000000000        DB  $00,$00,$00,$00,$00,$00,$00,$00 ;E
002295 EFE8 0000000000000000        DB  $00,$00,$00,$00,$00,$00,$00,$00
00229D EFF0 A000000000000000        DB  $A0,$00,$00,$00,$00,$00,$00,$00 ;F
0022A5 EFF8 0000000000000000        DB  $00,$00,$00,$00,$00,$00,$00,$00
[EOF:M7TABLE.ASM:SHIFT_JIS]
                                    INCLUDE "LDWORK.ASM"
                                
                                ;   LSX-Dodgers WORK0
                                ;
                                ;   CP/M互換BIOS
                                ;   BOOT:アドレス下位1バイトが0になるように
       F000                     AT_WORK:
0022AD F000                         DS  WORKAD-AT_WORK
                                
       F000                     CPM_BOOT:
0022AD F000 C30000          10      JP  0
       F003                     _SYS00:     ;(BDOS)プログラム終了
       F003                     CPM_WBOOT:
0022B0 F003 C3FECF          10      JP  WBOOT1
       F006                     CPM_CONST:
0022B3 F006 C3A6D7          10      JP  CONSTX
       F009                     _SYS07:     ;(BDOS)コンソール直接入力
       F009                     CPM_CONIN:
0022B6 F009 C338D7          10      JP  FLGET
       F00C                     CPM_CONOUT:
0022B9 F00C C347D9          10      JP  CONOUT1
                                
       F00F                     DECBF:              ;10進数表示時のバッファ(5バイト)
0022BC F00F                         DS  5
       F00F                     RR_BUF_HL   EQU DECBF   ;CP/M互換ファイルアクセスの際のランダムレコードの一時的な保管場所
       F011                     RR_BUF_A    EQU DECBF+2 ;計3バイト
                                
0022C1 F014 00                  FDRV:   DB  0
0022C2 F015                     FNAME:  DS  36
0022E6 F039                     SFILE:  DS  33      ;DRV FILENAME
                                
002307 F05A                         DS  3
                                
00230A F05D 0000                LEFTX:  DW  0
00230C F05F 0000                DTAX:   DW  0
                                
       F061                     ZERO:
       F061                     BEEPD:
00230E F061 008E01000B000C10        DB  0,08EH,1,0,00BH,0,00CH,010H
002316 F069 073E08100D00FF          DB  007H,03EH,008H,010H,00DH,0,0FFH
       F062                     RTC_YY  EQU BEEPD+1
       F063                     RTC_MW  EQU BEEPD+2
       F064                     RTC_DD  EQU BEEPD+3
       F065                     RTC_TT  EQU BEEPD+4
       F066                     RTC_MM  EQU BEEPD+5
       F067                     RTC_SS  EQU BEEPD+6
       F062                     ROM_SLT EQU BEEPD+1
                                
00231D F070 00                  CHECK:  DB  0
                                
00231E F071 4F4B24              OK: DB  "OK$"
002321 F074                         DS  5
002326 F079 4572726F722124      COMERM: DB  "Error!$"
                                ;   システムワークエリア
                                ;   _CYL0:アドレス下位1バイトが080Hになるように
00232D F080 FF                  _CYL0:  DB  0FFH    ;Cylinder
00232E F081 FF                  _CYL1:  DB  0FFH    ;Cylinder
00232F F082 FF                  _CYL2:  DB  0FFH    ;Cylinder
002330 F083 FF                  _CYL3:  DB  0FFH    ;Cylinder
002331 F084 00                  _DRIVE: DB  0   ;unit number
002332 F085 00                  _SEEKSP:DB  0   ;Seek speed
002333 F086 FF                  _ISEEK: DB  0FFH    ;
002334 F087 00                  _DVSW:  DB  0
002335 F088 00                  _DRV:   DB  0
002336 F089 FF                  _DSK:   DB  0FFH
002337 F08A 8000                _DTA:   DW  00080H
002339 F08C 0000                _CTC:   DW  0
00233B F08E 0000                _TXADR: DW  0
00233D F090 0000                _KEYPS: DW  0
00233F F092 00FF                _KEYD:  DW  0FF00H  ;キーデータ
002341 F094 8310                _KEYSP: DB  KEYSP_L,KEYSP_H ;オートリピートの速度
002343 F096 70                  _COLORF:DB  COLORF  ;色
002344 F097 19                  _LINE:  DB  LINE
                                
002345 F098 0000                _FCB:   DW  0   ;SEARCH FILES
002347 F09A 0000                _FBPS:  DW  0   ;    //
002349 F09C 0000                _FBAD:  DW  0   ;    //
00234B F09E 00                  _FBCNT: DB  0   ;    //
00234C F09F 00                  _FILEN: DB  0   ;    //
00234D F0A0 00                  _DIRF:  DB  0   ;bit7:ディレクトリ bit0-6:セクタインデックス
00234E F0A1                         DS  1
00234F F0A2 00                  _WTFATF:DB  0   ;FATバッファの更新フラグ
002350 F0A3                         DS  1
002351 F0A4 00                  _WTDBF: DB  0   ;データバッファの更新フラグ
002352 F0A5 FF                  _DBDRV: DB  0FFH    ;データバッファにあるデータを読み込んだドライブ
002353 F0A6 0000                _DBSEC: DW  0   ;データバッファにあるデータを読み込んだセクタ番号
002355 F0A8 0000                _DPB:   DW  0
       F0AA                     _FATDRV:
002357 F0AA FF                      DB  0FFH    ;FATバッファに読み込んでいるドライブ
002358 F0AB 00                  _FATIX: DB  0   ;FATバッファに読み込んでいるインデックス
       F0AC                     _FAKEFREE:
002359 F0AC 0000                    DW  0   ;偽の残量（FATサイズが大きくなると重くなるのでその対策）
                                
00235B F0AE                         DS  2
                                
       F0B0                     CRTCD:
00235D F0B0 6F                      DB  06FH
       F0B1                     _WIDTH:
00235E F0B1 28                      DB  WIDTH
       F0B2                     TVRAMTOP:
00235F F0B2 5938                    DB  059H,038H
002361 F0B4 1F02                    DB  01FH,002H
       F0B6                     _LINE2:
002363 F0B6 19                      DB  019H
       F0B7                     WKE4:
002364 F0B7 1C                      DB  01CH
       F0B8                     WKE6:
002365 F0B8 00                      DB  000H
       F0B9                     WK40:
002366 F0B9 07                      DB  007H
       F0BA                     _PAGE_MINUS:
002367 F0BA 18FC                    DW  0-WIDTH*LINE
       F0BC                     _WIDTH_MINUS:
002369 F0BC D8FF                    DW  0-WIDTH
       F0BE                     WK30:
00236B F0BE 0C                      DB  00CH
       F0BF                     WK31:
       F0BF                     WK1FD0:
00236C F0BF 20                      DB  020H
                                
00236D F0C0 0000                CTC0:   DW  INTCTCE
00236F F0C2 0000                CTC1:   DW  INTCTCE
002371 F0C4 0000                CTC2:   DW  INTCTCE
002373 F0C6 0000                CTC3:   DW  INTCTCE
002375 F0C8 0000                INTVEC: DW  INT
                                
                                ;   LSX-Dodgers 独自BIOS
                                
002377 F0CA C38EDA          10  _INKEY: JP  INKEY
00237A F0CD C333D8          10  _PRINT: JP  PRINT
00237D F0D0 C302DB          10  _SCRN:  JP  SCRN
002380 F0D3 C3F0D9          10  _POS:   JP  POS
002383 F0D6 C315D9          10  _LOC:   JP  LOC
       F0D9                     _CHGDRV:
002386 F0D9 C3AAE7          10      JP  CHGDRV
       F0DC                     _GETDPB:
002389 F0DC C375E8          10      JP  GETDPB
       F0DF                     _FFLUSH:
00238C F0DF C393E8          10      JP  FFLUSH
       F0E2                     _RDFATX:
00238F F0E2 C383E4          10      JP  RDFATX
002392 F0E5 C3ABE5          10  _RDFAT: JP  RDFAT
002395 F0E8 C355E9          10  _WTTRK: JP  WTTRK
002398 F0EB C3B5E9          10  _FDRD:  JP  FDRD
00239B F0EE C35BE9          10  _FDWT:  JP  FDWT
       F0F1                     _BPB2DPB:
00239E F0F1 C338E6          10      JP  BPB2DPB
       F0F4                     _BREAK:
0023A1 F0F4 C390D1          10      JP  END_BATCH
       F0F7                     _GNCL:
0023A4 F0F7 C325E5          10      JP  GNCL        ; self-modifying code
       F0F8                     GNCPAT  EQU $-2
       F0FA                     _SNCL:
0023A7 F0FA C348E5          10      JP  SNCL        ; self-modifying code
       F0FB                     SNCPAT  EQU $-2
0023AA F0FD C34AD0          10  _COMANL:JP  COMANL
                                
       F100                     _WE:
[EOF:LDWORK.ASM:SHIFT_JIS]
                                    INCLUDE "LDCALL.ASM"
                                
                                ;   LSX-Dodgers システムコール(BDOS)
                                ;
                                ;   LSX-Dodgers SYSTEM CALL
                                ;   STABLE:アドレス下位1バイトが0になるように
                                
       F100                     STABLE:
                                ;0
0023AD F100 03F00FD71BD7D7DC        DW  _SYS00,_SYS01,_SYS02,_SYS03
0023B5 F108 75D475D420D709F0        DW  _SYS04,_SYS05,_SYS06,_SYS07
0023BD F110 28D777D46ED79AD7        DW  _SYS08,_SYS09,_SYS0A,_SYS0B
0023C5 F118 8CD491D4A0D4B1D4        DW  _SYS0C,_SYS0D,_SYS0E,_SYS0F
                                ;1
0023CD F120 05D54CD595D5CBD5        DW  _SYS10,_SYS11,_SYS12,_SYS13
0023D5 F128 D3D5E9D5FED5F6D5        DW  _SYS14,_SYS15,_SYS16,_SYS17
0023DD F130 45D64AD64FD655D6        DW  _SYS18,_SYS19,_SYS1A,_SYS1B
0023E5 F138 75D47BD675D47FD6        DW  _SYS1C,_SYS1D,_SYS1E,_SYS1F
                                ;2
0023ED F140 75D435D63DD686D6        DW  _SYS20,_SYS21,_SYS22,_SYS23
0023F5 F148 ACD675D457E12FE2        DW  _SYS24,_ERROR,_SYS26,_SYS27
0023FD F150 3DD6B5D6B0D7D7DC        DW  _SYS28,_SYS29,_SYS2A,_SYS2B
002405 F158 B6D7D7DC75D4D6D6        DW  _SYS2C,_SYS2D,_SYS2E,_SYS2F
                                ;3
00240D F160 D0D675D475D475D4        DW  _SYS30,_ERROR,_ERROR,_ERROR
002415 F168 75D475D475D475D4        DW  _ERROR,_ERROR,_ERROR,_ERROR
00241D F170 75D4D7DCD7DCF7D6        DW  _ERROR,_SYS39,_SYS3A,_SYS5A
                                ;DOS2
002425 F178 58D4                    DW  _DOS2
                                
002427 F17A                         DS  2
002429 F17C 00F3                _FATBF: DW  FATBF
00242B F17E 00FB                _DTBUF: DW  DTBUF
                                
                                ;   コントロールコードテーブル
                                ;   CTRLTB:アドレス下位1バイトが080Hになるように
                                
       F180                     CTRLTB:
00242D F180 98D898D8CED8C3D9        DW  CTRL00,CTRL00,CTRL02,CTRL03 ;  A,B,C
002435 F188 BDD9FAD8AED957D9        DW  CTRL04,CTRL05,CTRL06,CTRL07 ;D,E,F,G
00243D F190 A4D8BFD8C6D928D9        DW  CTRL08,CTRL09,CTRL0A,CTRL0B ;H,I,J,K
002445 F198 ABD910D9D8D998D8        DW  CTRL0C,CTRL0D,CTRL0E,CTRL00 ;L,M,N,O
00244D F1A0 98D898D820D998D8        DW  CTRL00,CTRL00,CTRL12,CTRL00 ;P,Q,R,S
002455 F1A8 98D898D898D898D8        DW  CTRL00,CTRL00,CTRL00,CTRL00 ;T,U,V,W
00245D F1B0 98D898D8ABD92FD9        DW  CTRL00,CTRL00,CTRL0C,CTRL1B ;X,Y,Z,ESC
002465 F1B8 87D8ABD8B4D8C6D9        DW  CTRL1C,CTRL1D,CTRL1E,CTRL1F ;→,←,↑,↓
                                
00246D F1C0 0200                M2D:    DW  2
00246F F1C2 FD02                    DB  0FDH,2
002471 F1C4 6401                    DW  356
002473 F1C6 FF0728090182            DB  0FFH,7,40,9,1,082H
002479 F1CC 0500A7000800            DW  5,0A7H,8
                                
00247F F1D2 0200                M2HD:   DW  2
002481 F1D4 FE01                    DB  0FEH,1
002483 F1D6 C704                    DW  1223
002485 F1D8 FE064D080184            DB  0FEH,6,77,8,1,084H
00248B F1DE 0500A7000900            DW  5,0A7H,9
                                
002491 F1E4 1617                SDDATA: DB  22,23       ;(FCB)ファイルを最後に変更した時刻
002493 F1E6 1415                    DB  20,21       ;(FCB)ファイルを最後に変更した日付
002495 F1E8 1A1B                    DB  26,27       ;(FCB)ファイルの先頭クラスタ
002497 F1EA 10111213                DB  16,17,18,19 ;(FCB)ファイルのサイズ(バイト単位)
       F1EE                     SDDATAE:
                                
00249B F1EE                         DS  2
       F1F0                     _FCB_BAT:
00249D F1F0 03EB                    DW  FCB_BAT
       F1F2                     _PATH:
00249F F1F2 A2EA                    DW  PATHD
                                
0024A1 F1F4                     SCDIR:  DS  2       ;+14 +15
0024A3 F1F6                     SFBPS:  DS  2       ;FBPS
0024A5 F1F8                     SFNDF:  DS  2       ;FILEN DIRF
                                
0024A7 F1FA 0000                _FATPS: DW  0
0024A9 F1FC 0000                _DIRPS: DW  0
0024AB F1FE 0000                _CLPS:  DW  0
                                
       F200                     _PE:
[EOF:LDCALL.ASM:SHIFT_JIS]
                                    INCLUDE "M7DPB.ASM"
                                
                                ;   LSX-Dodgers DPB
                                ;   MZ-700/1500
                                
       F200                     _DEVICE:
                                
                                ;   A:
                                
0024AD F200 0200                    DW  2   ;DPB_FATLN
0024AF F202 EBF0                    DW  _FDRD   ;DPB_DRD
0024B1 F204 EEF0                    DW  _FDWT   ;DPB_DWT
0024B3 F206 FD                      DB  0FDH    ;DPB_FATID
0024B4 F207 02                      DB  2   ;DPB_SECPCL
0024B5 F208 6401                    DW  356 ;DPB_MAXCL
0024B7 F20A FF                      DB  0FFH    ;DPB_FDMODE 0FFH=2D / 0FEH=2HD
0024B8 F20B 07                      DB  7   ;DPB_DIRSCNT
0024B9 F20C 28                      DB  40  ;DPB_MAXCYL
0024BA F20D 09                      DB  9   ;DPB_MAXSEC Number of sectors
0024BB F20E 01                      DB  1   ;DPB_FATPS
0024BC F20F 82                      DB  082H    ;DPB_BPS
0024BD F210 0500                    DW  5   ;DPB_DIRPS
0024BF F212 27                      DB  027H    ;DPB_DEVICE Device Number
0024C0 F213 00                      DB  0   ;DPB_UNITNO
0024C1 F214 0800                    DW  8   ;DPB_ADDCL
0024C3 F216 0000                    DW  0   ;DPB_16
0024C5 F218 0000                    DW  0   ;DPB_18
0024C7 F21A 0000                    DW  0   ;DPB_SDIR
0024C9 F21C 46444430                DB  "FDD0"  ;DPB_NAME
                                
                                ;   B:
                                
0024CD F220 0200                    DW  2   ;DPB_FATLN
0024CF F222 EBF0                    DW  _FDRD   ;DPB_DRD
0024D1 F224 EEF0                    DW  _FDWT   ;DPB_DWT
0024D3 F226 FD                      DB  0FDH    ;DPB_FATID
0024D4 F227 02                      DB  2   ;DPB_SECPCL
0024D5 F228 6401                    DW  356 ;DPB_MAXCL
0024D7 F22A FF                      DB  0FFH    ;DPB_FDMODE 0FFH=2D / 0FEH=2HD
0024D8 F22B 07                      DB  7   ;DPB_DIRSCNT
0024D9 F22C 28                      DB  40  ;DPB_MAXCYL
0024DA F22D 09                      DB  9   ;DPB_MAXSEC Number of sectors
0024DB F22E 01                      DB  1   ;DPB_FATPS
0024DC F22F 82                      DB  082H    ;DPB_BPS
0024DD F230 0500                    DW  5   ;DPB_DIRPS
0024DF F232 27                      DB  027H    ;DPB_DEVICE Device Number
0024E0 F233 01                      DB  1   ;DPB_UNITNO
0024E1 F234 0800                    DW  8   ;DPB_ADDCL
0024E3 F236 0000                    DW  0   ;DPB_16
0024E5 F238 0000                    DW  0   ;DPB_18
0024E7 F23A 0000                    DW  0   ;DPB_SDIR
0024E9 F23C 46444431                DB  "FDD1"  ;DPB_NAME
                                
                                ;   C:
                                
0024ED F240 0100                    DW  1   ;DPB_FATLN
0024EF F242 75EA                    DW  CDRD    ;DPB_DRD
0024F1 F244 62EA                    DW  CDWT    ;DPB_DWT
0024F3 F246 FA                      DB  0FAH    ;DPB_FATID
0024F4 F247 01                      DB  1   ;DPB_SECPCL
0024F5 F248 7A00                    DW  122 ;DPB_MAXCL
0024F7 F24A 00                      DB  0   ;DPB_FDMODE
0024F8 F24B 06                      DB  6   ;DPB_DIRSCNT
0024F9 F24C 00                      DB  0   ;DPB_MAXCYL
0024FA F24D 00                      DB  0   ;DPB_MAXSEC
0024FB F24E 01                      DB  1   ;DPB_FATPS
0024FC F24F 01                      DB  1   ;DPB_BPS
0024FD F250 0200                    DW  2   ;DPB_DIRPS
0024FF F252 0C                      DB  00CH    ;DPB_DEVICE
002500 F253 F8                      DB  0F8H    ;DPB_UNITNO
002501 F254 0600                    DW  6   ;DPB_ADDCL
002503 F256 0000                    DW  0   ;DPB_16
002505 F258 0000                    DW  0   ;DPB_18
002507 F25A 0000                    DW  0   ;DPB_SDIR
002509 F25C 434D4F53                DB  "CMOS"  ;DPB_NAME
                                
                                ;   D:
                                
00250D F260                         DS  32
                                
                                ;   E:
                                
00252D F280 0000                EMMFL:  DW  0   ;DPB_FATLN
00252F F282 2CEA                    DW  EDRD    ;DPB_DRD
002531 F284 1FEA                    DW  EDWT    ;DPB_DWT
002533 F286 FA                      DB  0FAH    ;DPB_FATID
002534 F287 02                      DB  2   ;DPB_SECPCL
002535 F288 0000                    DW  0   ;DPB_MAXCL
002537 F28A 00                      DB  0   ;DPB_FDMODE
002538 F28B 10                      DB  16  ;DPB_DIRSCNT
002539 F28C 00                      DB  0   ;DPB_MAXCYL
00253A F28D 00                      DB  0   ;DPB_MAXSEC
00253B F28E 01                      DB  1   ;DPB_FATPS
00253C F28F 01                      DB  1   ;DPB_BPS
00253D F290 0000                    DW  0   ;DPB_DIRPS
00253F F292 26                      DB  026H    ;DPB_DEVICE
002540 F293 00                      DB  0   ;DPB_UNITNO
002541 F294 0000                    DW  0   ;DPB_ADDCL
002543 F296 0000                    DW  0   ;DPB_16
002545 F298 0000                    DW  0   ;DPB_18
002547 F29A 0000                    DW  0   ;DPB_SDIR
002549 F29C 454D4D30                DB  "EMM0"  ;DPB_NAME
                                
                                ;   F:
                                
00254D F2A0 0200                    DW  2   ;DPB_FATLN
00254F F2A2 8CEA                    DW  RDRD    ;DPB_DRD
002551 F2A4 88EA                    DW  RDWT    ;DPB_DWT
002553 F2A6 FA                      DB  0FAH    ;DPB_FATID
002554 F2A7 01                      DB  1   ;DPB_SECPCL
002555 F2A8 F600                    DW  246 ;DPB_MAXCL
002557 F2AA 00                      DB  0   ;DPB_FDMODE
002558 F2AB 09                      DB  9   ;DPB_DIRSCNT
002559 F2AC 00                      DB  0   ;DPB_MAXCYL
00255A F2AD 00                      DB  0   ;DPB_MAXSEC
00255B F2AE 01                      DB  1   ;DPB_FATPS
00255C F2AF 01                      DB  1   ;DPB_BPS
00255D F2B0 0300                    DW  3   ;DPB_DIRPS
00255F F2B2 0F                      DB  00FH    ;DPB_DEVICE
002560 F2B3 00                      DB  0   ;DPB_UNITNO
002561 F2B4 0A00                    DW  10  ;DPB_ADDCL
002563 F2B6 0000                    DW  0   ;DPB_16
002565 F2B8 0000                    DW  0   ;DPB_18
002567 F2BA 0000                    DW  0   ;DPB_SDIR
002569 F2BC 52414D46                DB  "RAMF"  ;DPB_NAME
                                
                                ;   G:
                                
00256D F2C0                         DS  32
                                
                                ;   H:
00258D F2E0                         DS  3
002590 F2E3 00                      DB  0
[EOF:M7DPB.ASM:UTF_8]
                                
       A591                         ORG $$+OFFSET   ;$DEPHASE
       A591                     LAST_ADR:
                                
                                    END
[EOF:M7.ASM:UTF_8]
