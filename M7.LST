                                ;*** AILZ80ASM *** Z-80 Assembler, version 1.0.0.0, LST:Full:4
                                ;   LSX-Dodgers for MZ-700/1500
                                ;   Programmed by
                                ;   Gaku (Lovers/Tablacus)
                                
                                    INCLUDE "M7DEF.ASM"
                                
                                ;   LSX-Dodgers DEF
                                ;   MZ-700/1500
                                
       0001                     MAC EQU 1   ;MZ-700/1500
       0000                     DEV EQU 0
                                
       8080                     RUN EQU 08080H
       8000                     OFFSET  EQU RUN-128
       CF06                     BDOS    EQU 0CF06H
       EC40                     TABLEAD EQU 0EC40H
       EF00                     WORKAD  EQU 0EF00H
       F200                     FATBF   EQU 0F200H
       FA00                     DTBUF   EQU 0FA00H
       FE00                     KEYBF   EQU 0FE00H
       FF00                     KBUF    EQU 0FF00H
       FFD9                     TRAP38  EQU 0FFD9H
       0028                     WIDTH   EQU 40
       0019                     LINE    EQU 25
       0071                     COLORF  EQU 071H
       000A                     COMS    EQU 10
[EOF:M7DEF.ASM:UTF_8]
                                    INCLUDE "LDDEF.ASM"
                                
                                ;   LSX-Dodgers DEF
                                
       0001                     VER_1   EQU 1
       0004                     VER_2   EQU 4
       0009                     VER_3   EQU 9
       1D01                     MACW    EQU MAC + 01D00H    ;機種フラグとLD判別フラグ
       0001                     MACD    EQU MAC + DEV * 256 ;機種フラグとデバイスフラグ
       0149                     VER EQU VER_1 * 256 + VER_2 * 16 + VER_3
                                
       0005                     SYSTEM  EQU 00005H
       000F                     JP_HL   EQU 0000FH
       005C                     FCB1    EQU 0005CH
       006C                     FCB2    EQU 0006CH
       005D                     FCB1FN  EQU FCB1+1
       006D                     FCB2FN  EQU FCB2+1
       0080                     DTA1    EQU 00080H
                                
       FFCA                     EXTBIO  EQU 0FFCAH
                                
[EOF:LDDEF.ASM:SHIFT_JIS]
                                
000000 8000                         ORG OFFSET
                                                    ;MZTヘッダ128バイト
000000 8000 01                      DB  1           ;ファイルモード
000001 8001 4C44202020202020        DB  "LD           "     ;ファイル名(13)
            2020202020          
00000E 800E 535953                  DB  "SYS"           ;拡張子(3)
000011 8011 0D                      DB  $0D
000012 8012 0424                    DW  LAST_ADR-RUN        ;サイズ
000014 8014 8080                    DW  RUN         ;開始アドレス
000016 8016 8080                    DW  RUN         ;実行アドレス
000018 8018                         DS  104
                                
                                    INCLUDE "M7INIT.ASM"
                                
                                ;   LSX-Dodgers INIT
                                ;   MZ-700/1500
                                
000080 8080 C38780          10      JP  START
000083 8083 011D                    DW  MACW
000085 8085 4901                    DW  VER
                                
       8087                     START:
000087 8087 F3               4      DI
000088 8088 ED56             8      IM  1
00008A 808A 318780          10      LD  SP,START
00008D 808D CD9B80          17      CALL    INIT        ;NZならAUTOEXECを実行
000090 8090 210000          10      LD  HL,0
000093 8093 E5              11      PUSH    HL
000094 8094 C8              11      RET Z
000095 8095 114181          10      LD  DE,AUTOD
000098 8098 C3FDEF          10      JP  _COMANL
                                
       809B                     INIT:
00009B 809B D3E0            11      OUT (0E0H),A    ;DRAM(0000H-0FFFH)
00009D 809D D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
00009F 809F 21A681          10      LD  HL,INITE
0000A2 80A2 1106CF          10      LD  DE,BDOS
0000A5 80A5 01DE22          10      LD  BC,LAST_ADR-INITE
0000A8 80A8 EDB0                    LDIR
0000AA 80AA 217781          10      LD  HL,M7BEEPD
0000AD 80AD 1162EF          10      LD  DE,BEEPD+1
0000B0 80B0 010800          10      LD  BC,M7BEEPE-M7BEEPD
0000B3 80B3 EDB0                    LDIR
                                
0000B5 80B5 210000          10      LD  HL,0
0000B8 80B8 065C             7      LD  B,05CH
0000BA 80BA 3EEF             7      LD  A,0EFH      ;RST 28H
0000BC 80BC CD6EDD          17      CALL    FILL_MEMORY
0000BF 80BF 06A4             7      LD  B,0A4H
0000C1 80C1 AF               4      XOR A
0000C2 80C2 CD6EDD          17      CALL    FILL_MEMORY
                                
0000C5 80C5 3EC3             7      LD  A,0C3H      ;JP
0000C7 80C7 2103EF          10      LD  HL,CPM_WBOOT
0000CA 80CA 320000          13      LD  (00000H),A
0000CD 80CD 220100          16      LD  (00001H),HL ;IPL
                                
0000D0 80D0 21011D          10      LD  HL,MACW     ;3 bit7  DPB Compatible LA(1)
0000D3 80D3 220300          16      LD  (00003H),HL ;  bit6-0 Machine
                                ;               ;4 LSX-Dodgers(01DH)
0000D6 80D6 2106CF          10      LD  HL,BDOS
0000D9 80D9 320500          13      LD  (00005H),A
0000DC 80DC 220600          16      LD  (00006H),HL ;BDOS
                                
0000DF 80DF 21D9FF          10      LD  HL,TRAP38   ;TRAP38
0000E2 80E2 322800          13      LD  (00028H),A
0000E5 80E5 222900          16      LD  (00029H),HL ;RST 028H
                                
0000E8 80E8 323800          13      LD  (00038H),A
0000EB 80EB 210ECF          10      LD  HL,IO_INT8253
0000EE 80EE 223900          16      LD  (00039H),HL
                                
0000F1 80F1 3EEF             7      LD  A,CPM_BOOT/256
0000F3 80F3 320B00          13      LD  (0000BH),A
                                
0000F6 80F6 3EE9             7      LD  A,0E9H      ;JP (HL)
0000F8 80F8 320F00          13      LD  (0000FH),A
                                
0000FB 80FB 3A7DF0          13      LD  A,(_FATBF+1)
0000FE 80FE 321300          13      LD  (00013H),A
                                
000101 8101 3A7FF0          13      LD  A,(_DTBUF+1)
000104 8104 321700          13      LD  (00017H),A
                                
000107 8107 3EFE             7      LD  A,KEYBF/256
000109 8109 321B00          13      LD  (0001BH),A
                                
00010C 810C 3EFF             7      LD  A,KBUF/256
00010E 810E 321F00          13      LD  (0001FH),A
                                
000111 8111 214901          10      LD  HL,VER
000114 8114 225A00          16      LD  (0005AH),HL
                                
000117 8117 214D81          10      LD  HL,INIMES
00011A 811A CDDBD5          17      CALL    MSX
       811D                     INIT1:
00011D 811D F3               4      DI
00011E 811E 1100FF          10      LD  DE,0FF00H
000121 8121 0600             7      LD  B,0
000123 8123 CDBBD3          17      CALL    ZERO_MEMORY_DE
000126 8126 21CAFF          10      LD  HL,EXTBIO
000129 8129 060F             7      LD  B,TRAP38-EXTBIO
00012B 812B 3EEF             7      LD  A,0EFH      ;RST 28H
00012D 812D CD6EDD          17      CALL    FILL_MEMORY
000130 8130 217F81          10      LD  HL,AT_TRAP38
000133 8133 11D9FF          10      LD  DE,TRAP38
000136 8136 012700          10      LD  BC,AT_TRAPE-AT_TRAP38
000139 8139 EDB0                    LDIR
                                
00013B 813B CD49DC          17      CALL    CHKEY
00013E 813E FE03             7      CP  3
000140 8140 C9              10      RET
                                
000141 8141 4155544F45584543    AUTOD:  DB  "AUTOEXEC "
            20                  
00014A 814A 413A00              AUTODV: DB  "A:",0
                                
00014D 814D 0C4C53582D446F64    INIMES: DB  00CH,"LSX-Dodgers for MZ-700/1500 v"
            6765727320666F72    
            204D5A2D3730302F    
            313530302076        
00016B 816B 312E                    DB  030H + VER_1, '.'
00016D 816D 3439                    DB  030H + VER_2 ,030H + VER_3
                                ;   DB  "PR3"
00016F 816F 2047616B750D0A          DB  ' Gaku',0DH,0AH
000176 8176 00                      DB  0
                                
       8177                     M7BEEPD:
000177 8177 0801                    DB  8,1
000179 8179 0736                    DB  7,036H
00017B 817B 04F9                    DB  4,0F9H
00017D 817D 0403                    DB  4,3
       817F                     M7BEEPE:
                                
       817F                     AT_TRAP38:
00017F FFD9                         ORG TRAP38,AT_TRAP38-OFFSET
00017F FFD9 210000          10      LD  HL,0
000182 FFDC E3              19      EX  (SP),HL
000183 FFDD 3E24             7      LD  A,'$'
000185 FFDF CDB4D8          17      CALL    MSG_A
000188 FFE2 2B               6      DEC HL
000189 FFE3 7C               4      LD  A,H
00018A FFE4 CDE8FF          17      CALL    PRHX
00018D FFE7 7D               4      LD  A,L
       FFE8                     PRHX:
00018E FFE8 F5              11      PUSH    AF
00018F FFE9 07               4      RLCA
000190 FFEA 07               4      RLCA
000191 FFEB 07               4      RLCA
000192 FFEC 07               4      RLCA
000193 FFED CDF1FF          17      CALL    PRHX2
000196 FFF0 F1              10      POP AF
       FFF1                     PRHX2:
000197 FFF1 E60F             7      AND 00FH
000199 FFF3 FE0A             7      CP  10
00019B FFF5 3F               4      CCF
00019C FFF6 CE30             7      ADC A,'0'
00019E FFF8 27               4      DAA
00019F FFF9 C3B4D8          10      JP  MSG_A
0001A2 FFFC                         DS  4
       81A6                         ORG $$+OFFSET   ;$DEPHASE
       81A6                     AT_TRAPE:
                                
       81A6                     INITE:
0001A6 CF06                         ORG BDOS,INITE-OFFSET
                                
0001A6 CF06 C309CF          10      JP  IO_BDOS
[EOF:M7INIT.ASM:SHIFT_JIS]
                                    INCLUDE "M7BANK.ASM"
                                
                                ;   LSX-Dodgers IO
                                ;   MZ-700/1500
                                ;   VRAM/KEY/TIMER(0D000H-0EFFFH)にアクセスするので0D000H-0FFFFHに置けない部分
                                ;
                                
       CF09                     IO_BDOS:
0001A9 CF09 D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
0001AB CF0B C39AD5          10      JP  BDOS0
                                
       CF0E                     IO_INT8253:
0001AE CF0E F3               4      DI
0001AF CF0F F5              11      PUSH    AF
0001B0 CF10 D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
0001B2 CF12 3E01             7      LD  A,1
0001B4 CF14 3206E0          13      LD  (0E006H),A  ;8253 Ch.2 カウンタ
0001B7 CF17 AF               4      XOR A
0001B8 CF18 3206E0          13      LD  (0E006H),A  ;8253 Ch.2 カウンタ
0001BB CF1B D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
0001BD CF1D C36ED8          10      JP  INT8253 
                                
       CF20                     RDKEYDATA:
0001C0 CF20 F3               4      DI
0001C1 CF21 D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
0001C3 CF23 3200E0          13      LD  (0E000H),A
0001C6 CF26 3A01E0          13      LD  A,(E001H)
0001C9 CF29 D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
0001CB CF2B FB               4      EI
0001CC CF2C C9              10      RET
                                
       CF2D                     RD556VSYNC:
0001CD CF2D F3               4      DI
0001CE CF2E D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
0001D0 CF30 3A02E0          13      LD  A,(0E002H)
0001D3 CF33 D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
0001D5 CF35 FB               4      EI
0001D6 CF36 C9              10      RET
                                
       CF37                     RDMMIO:
0001D7 CF37 F3               4      DI
0001D8 CF38 D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
0001DA CF3A 7E               7      LD  A,(HL)
0001DB CF3B D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
0001DD CF3D FB               4      EI
0001DE CF3E C9              10      RET
                                
       CF3F                     WRMMIO:
0001DF CF3F F3               4      DI
0001E0 CF40 D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
0001E2 CF42 77               7      LD  (HL),A
0001E3 CF43 D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
0001E5 CF45 FB               4      EI
0001E6 CF46 C9              10      RET
                                
       CF47                     RDMMIO_BC:
0001E7 CF47 F3               4      DI
0001E8 CF48 D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
0001EA CF4A 0A               7      LD  A,(BC)
0001EB CF4B D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
0001ED CF4D FB               4      EI
0001EE CF4E C9              10      RET
                                
       CF4F                     WRMMIO_BC:
0001EF CF4F F3               4      DI
0001F0 CF50 D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
0001F2 CF52 02               7      LD  (BC),A
0001F3 CF53 D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
0001F5 CF55 FB               4      EI
0001F6 CF56 C9              10      RET
                                
       CF57                     IO_PRINT:
0001F7 CF57 F3               4      DI
0001F8 CF58 D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
0001FA CF5A 77               7      LD  (HL),A
0001FB CF5B CBDC             8      SET 3,H
0001FD CF5D 71               7      LD  (HL),C
0001FE CF5E D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
000200 CF60 FB               4      EI
000201 CF61 C9              10      RET
                                
       CF62                     IO_CLR:
000202 CF62 F3               4      DI
000203 CF63 D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
       CF65                     C1AX1:
000205 CF65 7A               4      LD  A,D
000206 CF66 C6D0             7      ADD A,0D0H
000208 CF68 57               4      LD  D,A
000209 CF69 AF               4      XOR A
00020A CF6A 12               7      LD  (DE),A      ;Text
00020B CF6B CBDA             8      SET 3,D
       CF6E                     ICSMC   EQU $+1
00020D CF6D 3E00             7      LD  A,0     ;自己書き換え
00020F CF6F 12               7      LD  (DE),A      ;Color
000210 CF70 13               6      INC DE
000211 CF71 7A               4      LD  A,D
000212 CF72 D6D8             7      SUB 0D8H
000214 CF74 57               4      LD  D,A
000215 CF75 2118FC          10      LD  HL,0-WIDTH*LINE
000218 CF78 19              11      ADD HL,DE
000219 CF79 30EA            12      JR  NC,C1AX1
00021B CF7B E1              10      POP HL
00021C CF7C D1              10      POP DE
00021D CF7D D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
00021F CF7F FB               4      EI
000220 CF80 C9              10      RET
                                
       CF81                     IO_CLLINE:
000221 CF81 F3               4      DI
000222 CF82 D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
       CF84                     CLLINE1:
000224 CF84 CB9C             8      RES 3,H
000226 CF86 77               7      LD  (HL),A      ;Text
000227 CF87 CBDC             8      SET 3,H
000229 CF89 71               7      LD  (HL),C      ;Color
00022A CF8A 23               6      INC HL
00022B CF8B 10F7            13      DJNZ    CLLINE1
00022D CF8D D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
00022F CF8F FB               4      EI
000230 CF90 C9              10      RET
                                
       CF91                     IO_INS:
000231 CF91 F3               4      DI
000232 CF92 D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
       CF94                     IO_INS1:
000234 CF94 CDABCF          17      CALL    C12S
000237 CF97 23               6      INC HL
000238 CF98 10FA            13      DJNZ    IO_INS1
00023A CF9A D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
00023C CF9C FB               4      EI
00023D CF9D C9              10      RET
                                
       CF9E                     IO_BS:
00023E CF9E F3               4      DI
00023F CF9F D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
       CFA1                     IO_BS1:
000241 CFA1 CDABCF          17      CALL    C12S
000244 CFA4 2B               6      DEC HL
000245 CFA5 10F7            13      DJNZ    IO_BS
000247 CFA7 D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
000249 CFA9 FB               4      EI
00024A CFAA C9              10      RET
                                
       CFAB                     C12S:
00024B CFAB CB9C             8      RES 3,H
00024D CFAD 5E               7      LD  E,(HL)
00024E CFAE 77               7      LD  (HL),A
00024F CFAF 7B               4      LD  A,E
000250 CFB0 CBDC             8      SET 3,H
000252 CFB2 5E               7      LD  E,(HL)
000253 CFB3 71               7      LD  (HL),C
000254 CFB4 4B               4      LD  C,E
000255 CFB5 C9              10      RET
                                
       CFB6                     IO_SCRUP:
000256 CFB6 F3               4      DI
000257 CFB7 D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
       CFB9                     SCRUP1:
000259 CFB9 2815            12      JR  Z,SCRCL
00025B CFBB D5              11      PUSH    DE
00025C CFBC E5              11      PUSH    HL
00025D CFBD CBDA             8      SET 3,D
00025F CFBF CBDC             8      SET 3,H
000261 CFC1 012800          10      LD  BC,WIDTH
000264 CFC4 EDB0                    LDIR
000266 CFC6 E1              10      POP HL
000267 CFC7 D1              10      POP DE
000268 CFC8 012800          10      LD  BC,WIDTH
00026B CFCB EDB0                    LDIR
00026D CFCD 3D               4      DEC A
00026E CFCE 18E9            12      JR  SCRUP1
                                
       CFD0                     SCRCL:
000270 CFD0 0628             7      LD  B,WIDTH
000272 CFD2 EB               4      EX  DE,HL
000273 CFD3 D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
000275 CFD5 CDAEDA          17      CALL    CLLINE
000278 CFD8 E1              10      POP HL
000279 CFD9 D1              10      POP DE
00027A CFDA C1              10      POP BC
00027B CFDB C9              10      RET
                                
       CFDC                     C_MON:
00027C CFDC D3E4            11      OUT (0E4H),A    ;MONITOR ROM(0000H-0FFFH) & VRAM/KEY/TIMER(D000H-FFFFH)
00027E CFDE C7              12      RST 0
                                
       CFDF                     INITINT:
00027F CFDF D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
                                                ;HL=0E007H 8253 コントロール
000281 CFE1 36B0            10      LD  (HL),0B0H   ;Ch.2 カウンタの下位バイト→上位バイトの順に連続してアクセス Mode 0 16ビットバイナリ
000283 CFE3 3674            10      LD  (HL),074H   ;Ch.1 カウンタの下位バイト→上位バイトの順に連続してアクセス Mode 2 16ビットバイナリ
000285 CFE5 2D               4      DEC L       ;0E006H 8253 Ch.2 カウンタ
000286 CFE6 3602            10      LD  (HL),2
000288 CFE8 3600            10      LD  (HL),0
00028A CFEA 2D               4      DEC L       ;0E005H 8253 Ch.1 カウンタ
00028B CFEB 3683            10      LD  (HL),131
00028D CFED 3600            10      LD  (HL),0
00028F CFEF 3E05             7      LD  A,5
000291 CFF1 3203E0          13      LD  (0E003H),A  ;8255 コントロールポートでポートC(0E002H)のINTMSKを1にする
000294 CFF4 D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
000296 CFF6 C9              10      RET
                                
       CFF7                     BANKE:
000297 CFF7                         DS  0CFFEH-BANKE
[EOF:M7BANK.ASM:SHIFT_JIS]
                                    INCLUDE "M7CCP.ASM"
                                
                                ;   LSX-Dodgers CCP
                                ;   MZ-700/1500
                                
       CFFE                     WBOOT1:
00029E CFFE D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)　ここは0CFFEH
0002A0 D000 D3E0            11      OUT (0E0H),A    ;DRAM(0000H-0FFHH)
0002A2 D002 F3               4      DI
0002A3 D003 ED56             8      IM  1
0002A5 D005 2107E0          10      LD  HL,0E007H
0002A8 D008 CDDFCF          17      CALL    INITINT
0002AB D00B ED7B0600        20      LD  SP,(SYSTEM+1)
0002AF D00F FB               4      EI
0002B0 D010 2192EF          10      LD  HL,_KEYD
0002B3 D013 3600            10      LD  (HL),0
0002B5 D015 CD49DC          17      CALL    CHKEY
0002B8 D018 CDA1D8          17      CALL    KEYBC_IFBREAK
0002BB D01B 3E04             7      LD  A,4
0002BD D01D CDB4D8          17      CALL    MSG_A
[EOF:M7CCP.ASM:UTF_8]
                                    INCLUDE "LDCCP.ASM"
                                
                                ;   LSX-Dodgers CCP
                                
       D020                     COMMAND:
0002C0 D020 CDD3D0          17      CALL    SETDTA1
0002C3 D023 3A87EF          13      LD  A,(_DVSW)
0002C6 D026 C641             7      ADD A,'A'
0002C8 D028 CDB4D8          17      CALL    MSG_A
0002CB D02B 3E3E             7      LD  A,'>'
0002CD D02D CDB4D8          17      CALL    MSG_A
0002D0 D030 3E50             7      LD  A,80
0002D2 D032 12               7      LD  (DE),A
0002D3 D033 CD14D9          17      CALL    _SYS0A      ;(BDOS)文字列入力
0002D6 D036 CD7DD2          17      CALL    LTNL
                                
0002D9 D039 118200          10      LD  DE,DTA1+2
0002DC D03C CDFDEF          17      CALL    _COMANL
0002DF D03F 30DF            12      JR  NC,COMMAND
0002E1 D041 1179EF          10      LD  DE,COMERM
0002E4 D044 CDCCD5          17      CALL    _SYS09      ;(BDOS)文字列出力
0002E7 D047 C7              12      RST 0
                                
       D048                     COMANL:
0002E8 D048 CDC2DC          17      CALL    FILE
0002EB D04B 3A19EF          13      LD  A,(FNAME+4)
0002EE D04E FE20             7      CP  020H
0002F0 D050 201C            12      JR  NZ,COMB2
0002F2 D052 D5              11      PUSH    DE
0002F3 D053 1115EF          10      LD  DE,FNAME
0002F6 D056 1A               7      LD  A,(DE)
0002F7 D057 FE20             7      CP  020H
0002F9 D059 2844            12      JR  Z,SDVSW
0002FB D05B 1B               6      DEC DE
0002FC D05C 1A               7      LD  A,(DE)
0002FD D05D C6FF             7      ADD A,0FFH
0002FF D05F 3809            12      JR  C,COMB
000301 D061 13               6      INC DE
                                
000302 D062 215ED5          10      LD  HL,COMTB
000305 D065 060A             7      LD  B,COMS
000307 D067 CD46DF          17      CALL    CPNAME
       D06A                     COMB:
00030A D06A D1              10      POP DE
00030B D06B D20F00          10      JP  NC,JP_HL
       D06E                     COMB2:
00030E D06E EB               4      EX  DE,HL
00030F D06F 2247D1          16      LD  (COMPAT+1),HL
000312 D072 F5              11      PUSH    AF
000313 D073 CDF3D0          17      CALL    CEXE4
000316 D076 F1              10      POP AF
000317 D077 2115EF          10      LD  HL,FNAME
00031A D07A 116D00          10      LD  DE,FCB2+1   ;COMMAND NAME
00031D D07D 010B00          10      LD  BC,11
000320 D080 EDB0                    LDIR
000322 D082 1101D5          10      LD  DE,PATHD
       D085                     CEX1:
000325 D085 1A               7      LD  A,(DE)
000326 D086 FE20             7      CP  020H
000328 D088 D8              11      RET C
000329 D089 CDB7DC          17      CALL    FILEC
00032C D08C D5              11      PUSH    DE
00032D D08D 216D00          10      LD  HL,FCB2+1   ;COMMAND NAME
000330 D090 1115EF          10      LD  DE,FNAME
000333 D093 010B00          10      LD  BC,11
000336 D096 EDB0                    LDIR
000338 D098 CDF3D0          17      CALL    CEXE4
00033B D09B D1              10      POP DE
00033C D09C 13               6      INC DE
00033D D09D 18E6            12      JR  CEX1
                                
       D09F                     SDVSW:
00033F D09F F1              10      POP AF
000340 D0A0 3A14EF          13      LD  A,(FDRV)
000343 D0A3 3D               4      DEC A
000344 D0A4 5F               4      LD  E,A
000345 D0A5 0E0E             7      LD  C,00EH      ;(BDOS)カレントドライブの設定
000347 D0A7 1831            12      JR  SYSTEM0
                                
       D0A9                     OPEN1:
000349 D0A9 2114EF          10      LD  HL,FDRV
       D0AC                     OPEN:
00034C D0AC 0E11             7      LD  C,011H      ;(BDOS)ファイルの検索
       D0AE                     OPEN3:
00034E D0AE D5              11      PUSH    DE
00034F D0AF 11DCD4          10      LD  DE,DTA_CCP
000352 D0B2 CDD0D0          17      CALL    SETDTA
000355 D0B5 EB               4      EX  DE,HL
000356 D0B6 CDDAD0          17      CALL    SYSTEM0
000359 D0B9 D1              10      POP DE
00035A D0BA C9              10      RET
                                
       D0BB                     OPEN2:
00035B D0BB 0E12             7      LD  C,012H
00035D D0BD 18EF            12      JR  OPEN3
                                
       D0BF                     DEFCB:              ;Z=Ok NZ=Error
00035F D0BF 11DCD4          10      LD  DE,DTA_CCP
000362 D0C2 CDD8D0          17      CALL    SYSC0F
                                
000365 D0C5 11FDD4          10      LD  DE,DTA_CCP+33   ;(FCB)ランダムレコード
000368 D0C8 0604             7      LD  B,4
00036A D0CA CDBBD3          17      CALL    ZERO_MEMORY_DE
00036D D0CD 110001          10      LD  DE,00100H
       D0D0                     SETDTA:
000370 D0D0 C3A6D7          10      JP  _SYS1A      ;(BDOS)DTAの設定
                                
       D0D3                     SETDTA1:
000373 D0D3 118000          10      LD  DE,DTA1
000376 D0D6 18F8            12      JR  SETDTA
                                
       D0D8                     SYSC0F:
000378 D0D8 0E0F             7      LD  C,00FH      ;(BDOS)ファイルのオープン
       D0DA                     SYSTEM0:
00037A D0DA CD0500          17      CALL    SYSTEM
00037D D0DD B7               4      OR  A
00037E D0DE C9              10      RET
                                
       D0DF                     C_CD:
00037F D0DF 0E5A             7      LD  C,5AH
000381 D0E1 18F7            12      JR  SYSTEM0
                                
       D0E3                     S27BUF:
000383 D0E3 3A0700          13      LD  A,(SYSTEM+2)
000386 D0E6 3D               4      DEC A
000387 D0E7 E6F8             7      AND 0F8H
000389 D0E9 67               4      LD  H,A
00038A D0EA 2E00             7      LD  L,0
       D0EC                     S27DTA:
00038C D0EC 11DCD4          10      LD  DE,DTA_CCP
       D0EF                     S27:
00038F D0EF 0E27             7      LD  C,027H      ;(BDOS)ランダムブロック読み込み
000391 D0F1 18E7            12      JR  SYSTEM0
                                
       D0F3                     CEXE4:
000393 D0F3 3A14EF          13      LD  A,(FDRV)
000396 D0F6 325700          13      LD  (00057H),A
000399 D0F9 2A22EF          16      LD  HL,(FDRV+14)
00039C D0FC 225800          16      LD  (00058H),HL
                                
00039F D0FF 211DEF          10      LD  HL,FNAME+8
0003A2 D102 7E               7      LD  A,(HL)
0003A3 D103 FE20             7      CP  020H
0003A5 D105 2007            12      JR  NZ,CEXE7
0003A7 D107 3E3F             7      LD  A,'?'
0003A9 D109 77               7      LD  (HL),A
0003AA D10A 23               6      INC HL
0003AB D10B 77               7      LD  (HL),A
0003AC D10C 23               6      INC HL
0003AD D10D 77               7      LD  (HL),A
       D10E                     CEXE7:
0003AE D10E CDA9D0          17      CALL    OPEN1
       D111                     CEXE5:
0003B1 D111 C0              11      RET NZ
0003B2 D112 2AE6D4          16      LD  HL,(DTA_CCP+1+9)
0003B5 D115 7C               4      LD  A,H
0003B6 D116 CDCEDF          17      CALL    CAP
0003B9 D119 67               4      LD  H,A
0003BA D11A 7D               4      LD  A,L
0003BB D11B CDCEDF          17      CALL    CAP
0003BE D11E 6F               4      LD  L,A
0003BF D11F 3AE5D4          13      LD  A,(DTA_CCP+1+8)
0003C2 D122 CDCEDF          17      CALL    CAP
0003C5 D125 D642             7      SUB 'B'
0003C7 D127 282C            12      JR  Z,C_BAT
0003C9 D129 3D               4      DEC A       ;'C'
0003CA D12A 2805            12      JR  Z,C_EXE
       D12C                     CEXE6:
0003CC D12C CDBBD0          17      CALL    OPEN2
0003CF D12F 18E0            12      JR  CEXE5
                                
       D131                     C_EXE:
0003D1 D131 7C               4      LD  A,H
0003D2 D132 FE4D             7      CP  'M'
0003D4 D134 20F6            12      JR  NZ,CEXE6
                                
0003D6 D136 CDBFD0          17      CALL    DEFCB
0003D9 D139 CDE3D0          17      CALL    S27BUF
0003DC D13C 3D               4      DEC A
0003DD D13D 37               4      SCF
0003DE D13E C0              11      RET NZ
0003DF D13F 7C               4      LD  A,H
0003E0 D140 B5               4      OR  L
0003E1 D141 37               4      SCF
0003E2 D142 C8              11      RET Z
0003E3 D143 CDD3D0          17      CALL    SETDTA1
0003E6 D146 110000          10  COMPAT: LD  DE,0                ; self-modifying code
0003E9 D149 ED7B0600        20      LD  SP,(SYSTEM+1)
0003ED D14D 67               4      LD  H,A             ; A=0 in SETDTA1(_SYS1A)
0003EE D14E 6F               4      LD  L,A
0003EF D14F E5              11      PUSH    HL              ; push $0000 (reboot address)
0003F0 D150 24               4      INC H
0003F1 D151 E5              11      PUSH    HL              ; push $0100 (TPA address)
0003F2 D152 C386D3          10      JP  SETFCB              ; and JP $0100
                                
       D155                     C_BAT:
0003F5 D155 114154          10      LD  DE,'A'+'T'*256
0003F8 D158 ED52            15      SBC HL,DE
0003FA D15A 20D0            12      JR  NZ,CEXE6
                                
0003FC D15C F1              10      POP AF
0003FD D15D F1              10      POP AF
0003FE D15E CDBFD0          17      CALL    DEFCB
000401 D161 210002          10      LD  HL,00200H
000404 D164 CDECD0          17      CALL    S27DTA
000407 D167 C6FE             7      ADD A,0FEH
000409 D169 D8              11      RET C
00040A D16A 7D               4      LD  A,L
00040B D16B B7               4      OR  A
00040C D16C 37               4      SCF
00040D D16D C8              11      RET Z
00040E D16E 3C               4      INC A
00040F D16F F5              11      PUSH    AF
                                
000410 D170 CDA4D8          17      CALL    KEYBC
000413 D173 3E06             7      LD  A,6
000415 D175 CDB4D8          17      CALL    MSG_A
000418 D178 C1              10      POP BC
000419 D179 210001          10      LD  HL,00100H
       D17C                     BAT1:
00041C D17C A7               4      AND A
00041D D17D 05               4      DEC B
00041E D17E C8              11      RET Z
00041F D17F 7E               7      LD  A,(HL)
000420 D180 FE25             7      CP  '%'
000422 D182 280C            12      JR  Z,BAT2
       D184                     BAT1X:
000424 D184 7E               7      LD  A,(HL)
000425 D185 23               6      INC HL
000426 D186 FE1A             7      CP  01AH
000428 D188 C8              11      RET Z
000429 D189 FE0A             7      CP  00AH
00042B D18B C489D8          17      CALL    NZ,KEYBS
00042E D18E 18EC            12      JR  BAT1
                                
       D190                     BAT2:
000430 D190 23               6      INC HL
000431 D191 7E               7      LD  A,(HL)
000432 D192 2B               6      DEC HL
000433 D193 D631             7      SUB '1'
000435 D195 38ED            12      JR  C,BAT1X
000437 D197 FE09             7      CP  9
000439 D199 30E9            12      JR  NC,BAT1X
00043B D19B 23               6      INC HL
00043C D19C 23               6      INC HL
00043D D19D 3C               4      INC A
00043E D19E 4F               4      LD  C,A
00043F D19F ED5B47D1        20      LD  DE,(COMPAT+1)
       D1A3                     BAT3:
000443 D1A3 1A               7      LD  A,(DE)
000444 D1A4 B7               4      OR  A
000445 D1A5 28D5            12      JR  Z,BAT1
000447 D1A7 CD99DD          17      CALL    SPCUT
00044A D1AA 0D               4      DEC C
00044B D1AB 2808            12      JR  Z,BAT5
       D1AD                     BAT4:
00044D D1AD 1A               7      LD  A,(DE)
00044E D1AE FE21             7      CP  021H
000450 D1B0 38F1            12      JR  C,BAT3
000452 D1B2 13               6      INC DE
000453 D1B3 18F8            12      JR  BAT4
       D1B5                     BAT5:
000455 D1B5 1A               7      LD  A,(DE)
000456 D1B6 FE21             7      CP  021H
000458 D1B8 38C2            12      JR  C,BAT1
00045A D1BA 13               6      INC DE
00045B D1BB CD89D8          17      CALL    KEYBS
00045E D1BE 18F5            12      JR  BAT5
                                
       D1C0                     C_DEL:
000460 D1C0 CD86D3          17      CALL    SETFCB
000463 D1C3 CDCAD8          17      CALL    _SYS08      ;(BDOS)エコーなしコンソール入力
                                
000466 D1C6 0E13             7      LD  C,013H
000468 D1C8 180A            12      JR  CDEL1       ;(BDOS)ファイルの削除
                                
       D1CA                     C_REN:
00046A D1CA CD86D3          17      CALL    SETFCB
00046D D1CD 3E10             7      LD  A,010H      ;ディレクトリも対象にする
00046F D1CF 326900          13      LD  (FCB1+13),A ;属性
000472 D1D2 0E17             7      LD  C,017H      ;(BDOS)ファイル名の変更
       D1D4                     CDEL1:
000474 D1D4 115C00          10      LD  DE,FCB1
000477 D1D7 CD0500          17      CALL    SYSTEM
00047A D1DA C6FF             7      ADD A,0FFH
00047C D1DC C9              10      RET
                                
       D1DD                     C_DIR:
00047D D1DD CDB7DC          17      CALL    FILEC
000480 D1E0 2115EF          10      LD  HL,FDRV+1
000483 D1E3 CDD1D4          17      CALL    CWILD1
000486 D1E6 3EF1             7      LD  A,0F1H
000488 D1E8 3221EF          13      LD  (FDRV+13),A
00048B D1EB CDA9D0          17      CALL    OPEN1
       D1EE                     CDIR1:
00048E D1EE B7               4      OR  A
00048F D1EF 2008            12      JR  NZ,PDSKF
000491 D1F1 CD3CD2          17      CALL    P_NAME
000494 D1F4 CDBBD0          17      CALL    OPEN2
000497 D1F7 18F5            12      JR  CDIR1
                                
       D1F9                     PDSKF:
000499 D1F9 3A14EF          13      LD  A,(FDRV)
00049C D1FC 5F               4      LD  E,A
00049D D1FD 0E1B             7      LD  C,01BH      ;(BDOS)ディスク情報の獲得
00049F D1FF CD0500          17      CALL    SYSTEM
0004A2 D202 4F               4      LD  C,A     ;C←1クラスタ辺りの論理セクタ数
0004A3 D203 C601             7      ADD A,001H
0004A5 D205 D8              11      RET C       ;Aが0FFHだった場合
0004A6 D206 3E06             7      LD  A,8-2
       D208                     PDS1:               ;HL=未使用クラスタの総数
0004A8 D208 3C               4      INC A
0004A9 D209 CB19             8      RR  C
0004AB D20B 30FB            12      JR  NC,PDS1
       D20D                     PDS2:               ;B←論理セクタのサイズの上位8ビット
0004AD D20D 3C               4      INC A
0004AE D20E CB18             8      RR  B
0004B0 D210 30FB            12      JR  NC,PDS2
0004B2 D212 47               4      LD  B,A
                                
0004B3 D213 110000          10      LD  DE,0
       D216                     PDS3:
0004B6 D216 29              11      ADD HL,HL
0004B7 D217 EB               4      EX  DE,HL
0004B8 D218 ED6A            15      ADC HL,HL
0004BA D21A EB               4      EX  DE,HL
0004BB D21B 10F9            13      DJNZ    PDS3
       D21D                     PDSKF1:
0004BD D21D CDB5D2          17      CALL    PRDEC_DEHL
0004C0 D220 1142D5          10      LD  DE,FREE
0004C3 D223 CDCCD5          17      CALL    _SYS09      ;(BDOS)文字列出力
0004C6 D226 CDA4D2          17      CALL    PUTDRV
0004C9 D229 3E5C             7      LD  A,05CH      ;\
0004CB D22B CDB4D8          17      CALL    MSG_A
0004CE D22E 2A22EF          16      LD  HL,(FDRV+14)    ;ディレクトリのクラスタ番号
0004D1 D231 AF               4      XOR A
0004D2 D232 11FEFF          10      LD  DE,0-2
0004D5 D235 19              11      ADD HL,DE
0004D6 D236 23               6      INC HL
0004D7 D237 DCB1D2          17      CALL    C,PRDEC_HL
0004DA D23A 1841            12      JR  LTNL
                                
       D23C                     P_NAME:
0004DC D23C 3ADDD4          13      LD  A,(DTA_CCP+1)
0004DF D23F FE2E             7      CP  '.'
0004E1 D241 C8              11      RET Z
0004E2 D242 115AD5          10      LD  DE,DIRHD
0004E5 D245 CDCCD5          17      CALL    _SYS09      ;(BDOS)文字列出力
0004E8 D248 3AE8D4          13      LD  A,(DTA_CCP+1+00BH)
0004EB D24B F5              11      PUSH    AF
0004EC D24C 0F               4      RRCA
0004ED D24D 9F               4      SBC A,A
0004EE D24E E60A             7      AND '*'-020H
0004F0 D250 C620             7      ADD A,020H
0004F2 D252 CDB4D8          17      CALL    MSG_A
0004F5 D255 CDA4D2          17      CALL    PUTDRV
0004F8 D258 21DDD4          10      LD  HL,DTA_CCP+1
0004FB D25B CDF5D2          17      CALL    FPRNT
                                
0004FE D25E F1              10      POP AF
0004FF D25F CB67             8      BIT 4,A
000501 D261 2808            12      JR  Z,DIR3
000503 D263 114FD5          10      LD  DE,DIRMES
000506 D266 CDCCD5          17      CALL    _SYS09      ;(BDOS)文字列出力
000509 D269 180A            12      JR  DIR6
       D26B                     DIR3:
00050B D26B ED5BFBD4        20      LD  DE,(DTA_CCP+1+01EH)
00050F D26F 2AF9D4          16      LD  HL,(DTA_CCP+1+01CH)
000512 D272 CDB5D2          17      CALL    PRDEC_DEHL
       D275                     DIR6:
000515 D275 3AB1EF          13      LD  A,(_WIDTH)
000518 D278 FE29             7      CP  40+1
00051A D27A D417D3          17      CALL    NC,PRTTMS
                                
       D27D                     LTNL:
00051D D27D 1E03             7      LD  E,3
00051F D27F C3CDEF          10      JP  _PRINT
                                
       D282                     C_PATH:
000522 D282 CD99DD          17      CALL    SPCUT
000525 D285 2101D5          10      LD  HL,PATHD
000528 D288 FE21             7      CP  021H
00052A D28A 300C            12      JR  NC,CPATH0
       D28C                     CPATHP:
00052C D28C 7E               7      LD  A,(HL)
00052D D28D 23               6      INC HL
00052E D28E FE20             7      CP  020H
000530 D290 3F               4      CCF
000531 D291 30EA            12      JR  NC,LTNL
000533 D293 CDB4D8          17      CALL    MSG_A
000536 D296 18F4            12      JR  CPATHP
       D298                     CPATH0:
000538 D298 FE3B             7      CP  ';'
00053A D29A 2001            12      JR  NZ,CPATH1
00053C D29C 13               6      INC DE
       D29D                     CPATH1:
00053D D29D EB               4      EX  DE,HL
00053E D29E 014000          10      LD  BC,PATHX
000541 D2A1 EDB0                    LDIR
000543 D2A3 C9              10      RET
                                
       D2A4                     PUTDRV:
000544 D2A4 3A14EF          13      LD  A,(FDRV)
000547 D2A7 C640             7      ADD A,'A'-1
000549 D2A9 CDB4D8          17      CALL    MSG_A
00054C D2AC 3E3A             7      LD  A,':'
       D2AE                     MSG_AR:
00054E D2AE C3B4D8          10      JP  MSG_A
                                
       D2B1                     PRDEC_HL:
000551 D2B1 AF               4      XOR A
       D2B2                     PRDEC_AHL:
000552 D2B2 5F               4      LD  E,A
000553 D2B3 1600             7      LD  D,0
       D2B5                     PRDEC_DEHL:
000555 D2B5 D5              11      PUSH    DE
000556 D2B6 110FEF          10      LD  DE,DECBF
000559 D2B9 0605             7      LD  B,5
00055B D2BB CDBBD3          17      CALL    ZERO_MEMORY_DE  ;A=0
00055E D2BE D1              10      POP DE
                                
00055F D2BF 0E20             7      LD  C,32
       D2C1                     DEC1:
000561 D2C1 29              11      ADD HL,HL
000562 D2C2 EB               4      EX  DE,HL
000563 D2C3 ED6A            15      ADC HL,HL
000565 D2C5 EB               4      EX  DE,HL
000566 D2C6 E5              11      PUSH    HL
000567 D2C7 2113EF          10      LD  HL,DECBF+4
00056A D2CA 0605             7      LD  B,5
       D2CC                     DEC2:
00056C D2CC 7E               7      LD  A,(HL)
00056D D2CD 8F               4      ADC A,A
00056E D2CE 27               4      DAA
00056F D2CF 77               7      LD  (HL),A
000570 D2D0 2B               6      DEC HL
000571 D2D1 10F9            13      DJNZ    DEC2
000573 D2D3 E1              10      POP HL
000574 D2D4 0D               4      DEC C
000575 D2D5 20EA            12      JR  NZ,DEC1
                                
000577 D2D7 210FEF          10      LD  HL,DECBF
00057A D2DA 3E20             7      LD  A,020H
00057C D2DC 0604             7      LD  B,4
       D2DE                     DEC3:
00057E D2DE CDEBD2          17      CALL    DEC4
000581 D2E1 CDEBD2          17      CALL    DEC4
000584 D2E4 23               6      INC HL
000585 D2E5 10F7            13      DJNZ    DEC3
       D2E7                     DECX:
000587 D2E7 CDEBD2          17      CALL    DEC4
00058A D2EA AF               4      XOR A
       D2EB                     DEC4:
00058B D2EB ED6F            18      RLD
00058D D2ED FE20             7      CP  020H
00058F D2EF 2802            12      JR  Z,DEC5
000591 D2F1 F630             7      OR  030H
       D2F3                     DEC5:
000593 D2F3 18B9            12      JR  MSG_AR
                                
       D2F5                     FPRNT:
000595 D2F5 0608             7      LD  B,8
000597 D2F7 CD08D3          17      CALL    P_N1
00059A D2FA 7E               7      LD  A,(HL)
00059B D2FB C680             7      ADD A,0A0H-020H
00059D D2FD FEA0             7      CP  0A0H
00059F D2FF 2802            12      JR  Z,FPR1
0005A1 D301 3E2E             7      LD  A,'.'
       D303                     FPR1:
0005A3 D303 CDB4D8          17      CALL    MSG_A
0005A6 D306 0603             7      LD  B,3
                                
       D308                     P_N1:
0005A8 D308 C5              11      PUSH    BC
0005A9 D309 E5              11      PUSH    HL
0005AA D30A 7E               7      LD  A,(HL)
0005AB D30B CDDADF          17      CALL    CAP3
0005AE D30E CDB4D8          17      CALL    MSG_A
0005B1 D311 E1              10      POP HL
0005B2 D312 C1              10      POP BC
0005B3 D313 23               6      INC HL
0005B4 D314 10F2            13      DJNZ    P_N1
0005B6 D316 C9              10      RET
                                
       D317                     PRTTMS:
0005B7 D317 3E20             7      LD  A,020H
0005B9 D319 CDB4D8          17      CALL    MSG_A
                                
0005BC D31C 2AF5D4          16      LD  HL,(DTA_CCP+1+24)
0005BF D31F 7D               4      LD  A,L
0005C0 D320 B7               4      OR  A
0005C1 D321 C8              11      RET Z
0005C2 D322 CB3C             8      SRL H
0005C4 D324 17               4      RLA
0005C5 D325 17               4      RLA
0005C6 D326 17               4      RLA
0005C7 D327 17               4      RLA
0005C8 D328 E60F             7      AND 00FH
0005CA D32A 57               4      LD  D,A
0005CB D32B 7C               4      LD  A,H
0005CC D32C C650             7      ADD A,80
0005CE D32E CD71D3          17      CALL    PRDEC_A
0005D1 D331 3E2D             7      LD  A,'-'
0005D3 D333 CDB4D8          17      CALL    MSG_A
0005D6 D336 7A               4      LD  A,D
0005D7 D337 CD71D3          17      CALL    PRDEC_A
0005DA D33A 3E2D             7      LD  A,'-'
0005DC D33C CDB4D8          17      CALL    MSG_A
0005DF D33F 7D               4      LD  A,L
0005E0 D340 E61F             7      AND 01FH
0005E2 D342 CD71D3          17      CALL    PRDEC_A
                                
0005E5 D345 2AF3D4          16      LD  HL,(DTA_CCP+1+22)
                                
0005E8 D348 3E20             7      LD  A,020H
0005EA D34A CDB4D8          17      CALL    MSG_A
0005ED D34D 7C               4      LD  A,H
0005EE D34E 65               4      LD  H,L
0005EF D34F 0603             7      LD  B,3
       D351                     PRTTMS1:
0005F1 D351 1F               4      RRA
0005F2 D352 CB1D             8      RR  L
0005F4 D354 10FB            13      DJNZ    PRTTMS1
0005F6 D356 E61F             7      AND 01FH
0005F8 D358 CD71D3          17      CALL    PRDEC_A
0005FB D35B 3E3A             7      LD  A,':'
0005FD D35D CDB4D8          17      CALL    MSG_A
000600 D360 7D               4      LD  A,L
000601 D361 0F               4      RRCA
000602 D362 0F               4      RRCA
000603 D363 E63F             7      AND 03FH
000605 D365 CD71D3          17      CALL    PRDEC_A
000608 D368 3E3A             7      LD  A,':'
00060A D36A CDB4D8          17      CALL    MSG_A
00060D D36D 7C               4      LD  A,H
00060E D36E E61F             7      AND 01FH
000610 D370 87               4      ADD A,A
                                
                                ;   PRINT10
                                
       D371                     PRDEC_A:
000611 D371 E5              11      PUSH    HL
000612 D372 0608             7      LD  B,8
000614 D374 4F               4      LD  C,A
000615 D375 AF               4      XOR A
       D376                     PRTA1:
000616 D376 CB01             4      RLC C
000618 D378 8F               4      ADC A,A
000619 D379 27               4      DAA
00061A D37A 10FA            13      DJNZ    PRTA1
00061C D37C 210FEF          10      LD  HL,DECBF
00061F D37F 77               7      LD  (HL),A
000620 D380 AF               4      XOR A
000621 D381 CDE7D2          17      CALL    DECX
000624 D384 E1              10      POP HL
000625 D385 C9              10      RET
                                
       D386                     SETFCB:
000626 D386 CD99DD          17      CALL    SPCUT
000629 D389 1A               7      LD  A,(DE)
00062A D38A FE20             7      CP  020H
00062C D38C 3801            12      JR  C,SETFCBA
00062E D38E 1B               6      DEC DE
       D38F                     SETFCBA:
00062F D38F 0624             7      LD  B,36
000631 D391 215C00          10      LD  HL,FCB1
000634 D394 E5              11      PUSH    HL
000635 D395 AF               4      XOR A
000636 D396 CD6EDD          17      CALL    FILL_MEMORY
000639 D399 E1              10      POP HL
00063A D39A D5              11      PUSH    DE
00063B D39B CD0CD8          17      CALL    _SYS5C      ;(BDOS)ファイル名の解析
00063E D39E 216C00          10      LD  HL,FCB2
000641 D3A1 CD0CD8          17      CALL    _SYS5C      ;(BDOS)ファイル名の解析
000644 D3A4 E1              10      POP HL
000645 D3A5 010050          10      LD  BC,05000H
000648 D3A8 118100          10      LD  DE,00081H
       D3AB                     SETFCB1:
00064B D3AB 7E               7      LD  A,(HL)
00064C D3AC 23               6      INC HL
00064D D3AD FE20             7      CP  020H
00064F D3AF 3805            12      JR  C,SETFCB2
000651 D3B1 12               7      LD  (DE),A
000652 D3B2 13               6      INC DE
000653 D3B3 0C               4      INC C
000654 D3B4 10F5            13      DJNZ    SETFCB1
       D3B6                     SETFCB2:
000656 D3B6 79               4      LD  A,C
000657 D3B7 328000          13      LD  (DTA1),A
00065A D3BA 04               4      INC B
       D3BB                     ZERO_MEMORY_DE:
00065B D3BB AF               4      XOR A
       D3BC                     FILL_MEMORY_DE:
00065C D3BC 12               7      LD  (DE),A
00065D D3BD 13               6      INC DE
00065E D3BE 10FC            13      DJNZ    FILL_MEMORY_DE
000660 D3C0 C9              10      RET
                                
       D3C1                     C_COPY:
000661 D3C1 CD86D3          17      CALL    SETFCB
                                
000664 D3C4 1161EF          10      LD  DE,ZERO
000667 D3C7 CDBADC          17      CALL    FILEC2
00066A D3CA 216C00          10      LD  HL,FCB2
00066D D3CD CD13D8          17      CALL    S29X1
                                
000670 D3D0 3E10             7      LD  A,010H
000672 D3D2 326900          13      LD  (FCB1+13),A
000675 D3D5 216D00          10      LD  HL,FCB2+1
000678 D3D8 CDD1D4          17      CALL    CWILD1
       D3DB                     COPY0:
00067B D3DB CDCED4          17      CALL    CWILD
00067E D3DE 215C00          10      LD  HL,FCB1
000681 D3E1 CDACD0          17      CALL    OPEN
000684 D3E4 37               4      SCF
       D3E5                     COPY1:
000685 D3E5 C0              11      RET NZ
000686 D3E6 CDBFD0          17      CALL    DEFCB
                                
000689 D3E9 3AE9D4          13      LD  A,(DTA_CCP+13)
00068C D3EC CB67             8      BIT 4,A
00068E D3EE 2821            12      JR  Z,COPY1A
                                
000690 D3F0 215D00          10      LD  HL,FCB1+1
000693 D3F3 CDFDE0          17      CALL    CHKWILD
000696 D3F6 3814            12      JR  C,COPY9
                                
000698 D3F8 3E20             7      LD  A,020H
00069A D3FA 325D00          13      LD  (FCB1+1),A
00069D D3FD 2AF6D4          16      LD  HL,(DTA_CCP+26)
0006A0 D400 23               6      INC HL
0006A1 D401 226A00          16      LD  (FCB1+14),HL
0006A4 D404 18D5            12      JR  COPY0
                                
       D406                     COPY8:
0006A6 D406 CDCCD5          17      CALL    _SYS09      ;(BDOS)文字列出力
0006A9 D409 CD7DD2          17      CALL    LTNL
       D40C                     COPY9:
0006AC D40C CDBBD0          17      CALL    OPEN2
0006AF D40F 18D4            12      JR  COPY1
                                
       D411                     COPY1A:
0006B1 D411 216C00          10      LD  HL,FCB2
0006B4 D414 1114EF          10      LD  DE,FDRV
0006B7 D417 01DED4          10      LD  BC,DTA_CCP+2
0006BA D41A EDA0            16      LDI
0006BC D41C 3E0B             7      LD  A,11
       D41E                     COPY2:
0006BE D41E F5              11      PUSH    AF
0006BF D41F 7E               7      LD  A,(HL)
0006C0 D420 FE3F             7      CP  '?'
0006C2 D422 2001            12      JR  NZ,COPY3
0006C4 D424 0A               7      LD  A,(BC)
       D425                     COPY3:
0006C5 D425 12               7      LD  (DE),A
0006C6 D426 03               6      INC BC
0006C7 D427 13               6      INC DE
0006C8 D428 23               6      INC HL
0006C9 D429 F1              10      POP AF
0006CA D42A 3D               4      DEC A
0006CB D42B 20F1            12      JR  NZ,COPY2
0006CD D42D 010500          10      LD  BC,16-11
0006D0 D430 EDB0                    LDIR
       D432                     PUTNAME:
0006D2 D432 215D00          10      LD  HL,FCB1+1
0006D5 D435 CDFDE0          17      CALL    CHKWILD
0006D8 D438 300B            12      JR  NC,PUTN1
0006DA D43A 2115EF          10      LD  HL,FDRV+1
0006DD D43D CDF5D2          17      CALL    FPRNT
0006E0 D440 3E20             7      LD  A,020H
0006E2 D442 CDB4D8          17      CALL    MSG_A
       D445                     PUTN1:
0006E5 D445 1114EF          10      LD  DE,FDRV
0006E8 D448 0E16             7      LD  C,016H      ;(BDOS)ファイルの作成
0006EA D44A CDDAD0          17      CALL    SYSTEM0
0006ED D44D 2048            12      JR  NZ,COPYE2
0006EF D44F 67               4      LD  H,A     ;A=0
0006F0 D450 6F               4      LD  L,A
0006F1 D451 2235EF          16      LD  (FDRV+33),HL    ;(FCB)ランダムレコード
0006F4 D454 2237EF          16      LD  (FDRV+35),HL
       D457                     COPY6:
0006F7 D457 CDE3D0          17      CALL    S27BUF
0006FA D45A 47               4      LD  B,A
0006FB D45B 3C               4      INC A
0006FC D45C 2831            12      JR  Z,COPYE
0006FE D45E 7C               4      LD  A,H
0006FF D45F B5               4      OR  L
000700 D460 280C            12      JR  Z,COPY7
000702 D462 1114EF          10      LD  DE,FDRV
000705 D465 0E26             7      LD  C,026H      ;(BDOS)ランダムブロック書き込み
000707 D467 CDDAD0          17      CALL    SYSTEM0
00070A D46A 2023            12      JR  NZ,COPYE
00070C D46C 10E9            13      DJNZ    COPY6
       D46E                     COPY7:
00070E D46E 3AE9D4          13      LD  A,(DTA_CCP+13)  ;(FCB)属性
000711 D471 3221EF          13      LD  (FDRV+13),A
000714 D474 21F0D4          10      LD  HL,DTA_CCP+20   ;(FCB)タイムスタンプ
000717 D477 1128EF          10      LD  DE,FDRV+20
00071A D47A 010400          10      LD  BC,4
00071D D47D EDB0                    LDIR
                                
00071F D47F 1114EF          10      LD  DE,FDRV
000722 D482 0E10             7      LD  C,010H      ;(BDOS)ファイルのクローズ
000724 D484 CDDAD0          17      CALL    SYSTEM0
000727 D487 2006            12      JR  NZ,COPYE
                                
000729 D489 1171EF          10      LD  DE,OK
00072C D48C C306D4          10      JP  COPY8
                                
       D48F                     COPYE:
00072F D48F 1114EF          10      LD  DE,FDRV
000732 D492 0E13             7      LD  C,013H      ;(BDOS)ファイルの削除
000734 D494 CD0500          17      CALL    SYSTEM
       D497                     COPYE2:
000737 D497 37               4      SCF
000738 D498 C9              10      RET
                                
       D499                     C_TYPE:
000739 D499 CD86D3          17      CALL    SETFCB
00073C D49C 215C00          10      LD  HL,FCB1
00073F D49F CDACD0          17      CALL    OPEN
000742 D4A2 37               4      SCF
       D4A3                     TYPE1:
000743 D4A3 C0              11      RET NZ
000744 D4A4 CDBFD0          17      CALL    DEFCB
000747 D4A7 3E06             7      LD  A,6
000749 D4A9 CDB4D8          17      CALL    MSG_A
       D4AC                     TYPE2:
00074C D4AC CDE3D0          17      CALL    S27BUF
00074F D4AF C6FE             7      ADD A,0FEH
000751 D4B1 D8              11      RET C
000752 D4B2 7C               4      LD  A,H
000753 D4B3 B5               4      OR  L
000754 D4B4 2813            12      JR  Z,TYPEE
000756 D4B6 010001          10      LD  BC,00100H
       D4B9                     TYPE3:
000759 D4B9 0A               7      LD  A,(BC)
00075A D4BA 03               6      INC BC
00075B D4BB FE1A             7      CP  01AH
00075D D4BD 280A            12      JR  Z,TYPEE
00075F D4BF CDB4D8          17      CALL    MSG_A
000762 D4C2 2B               6      DEC HL
000763 D4C3 7C               4      LD  A,H
000764 D4C4 B5               4      OR  L
000765 D4C5 20F2            12      JR  NZ,TYPE3
000767 D4C7 18E3            12      JR  TYPE2
       D4C9                     TYPEE:
000769 D4C9 CDBBD0          17      CALL    OPEN2
00076C D4CC 18D5            12      JR  TYPE1
                                
       D4CE                     CWILD:
00076E D4CE 215D00          10      LD  HL,FCB1+1
       D4D1                     CWILD1:
000771 D4D1 7E               7      LD  A,(HL)
000772 D4D2 FE20             7      CP  020H
000774 D4D4 C0              11      RET NZ
       D4D5                     CWILD2:
000775 D4D5 3E3F             7      LD  A,'?'
000777 D4D7 060B             7      LD  B,11
000779 D4D9 C36EDD          10      JP  FILL_MEMORY
                                
       D4DC                     DTA_CCP:
00077C D4DC                         DS  37
                                
       0040                     PATHX   EQU 64
0007A1 D501                     PATHD:  DS  PATHX
0007E1 D541 00                  PATHE:  DB  0
                                
0007E2 D542 2062797465732066    FREE:   DB  " bytes free",9,'$'
            7265650924          
0007EF D54F 20202020203C4449    DIRMES: DB  "     <DIR>$"
            523E24              
0007FA D55A 20203A24            DIRHD:  DB  "  :$"
                                
       D55E                     COMTB:
0007FE D55E 44202020                DB  "D   "  ;1
000802 D562 DDD1                    DW  C_DIR
000804 D564 44495220                DB  "DIR "  ;2
000808 D568 DDD1                    DW  C_DIR
00080A D56A 434F5059                DB  "COPY"  ;3
00080E D56E C1D3                    DW  C_COPY
000810 D570 43442020                DB  "CD  "  ;4
000814 D574 DFD0                    DW  C_CD
000816 D576 44454C20                DB  "DEL "  ;5
00081A D57A C0D1                    DW  C_DEL
00081C D57C 50415448                DB  "PATH"  ;6
000820 D580 82D2                    DW  C_PATH
000822 D582 52454E20                DB  "REN "  ;7
000826 D586 CAD1                    DW  C_REN
000828 D588 54595045                DB  "TYPE"  ;8
00082C D58C 99D4                    DW  C_TYPE
00082E D58E 52454D20                DB  "REM "  ;9
000832 D592 C9D5                    DW  C_REM
[EOF:LDCCP.ASM:SHIFT_JIS]
                                    INCLUDE "M7CCP2.ASM"
                                
                                ;   LSX-Dodgers CCP2
                                ;   MZ-700/1500
                                
000834 D594 4D4F4E20                DB  "MON "  ;10
000838 D598 DCCF                    DW  C_MON
[EOF:M7CCP2.ASM:UTF_8]
                                    INCLUDE "LDOS.ASM"
                                
                                ;   LSX-Dodgers OS
                                
       D59A                     BDOS0:
00083A D59A E5              11      PUSH    HL
00083B D59B 79               4      LD  A,C
00083C D59C FE3C             7      CP  03CH
00083E D59E 3802            12      JR  C,DOS1
000840 D5A0 3E3C             7      LD  A,03CH
       D5A2                     DOS1:
000842 D5A2 87               4      ADD A,A
000843 D5A3 6F               4      LD  L,A
000844 D5A4 26F0             7      LD  H,STABLE/256
000846 D5A6 7E               7      LD  A,(HL)
000847 D5A7 2C               4      INC L
000848 D5A8 66               7      LD  H,(HL)
000849 D5A9 6F               4      LD  L,A
00084A D5AA E3              19      EX  (SP),HL
00084B D5AB 79               4      LD  A,C
                                ;確認用
                                ;   LD  (0050H),A
00084C D5AC C9              10      RET
       D5AD                     _DOS2:
00084D D5AD FE5A             7      CP  05AH        ;(BDOS)カレントディレクトリの変更(_CHDIR)
00084F D5AF CA50D8          10      JP  Z,_SYS5A
000852 D5B2 FE5C             7      CP  05CH        ;(BDOS)ファイル名の解析(_PFILE)
000854 D5B4 CA0CD8          10      JP  Z,_SYS5C
000857 D5B7 FE5F             7      CP  05FH        ;(BDOS)ディスクバッファのフラッシュ(_FLUSH)
000859 D5B9 CA03EA          10      JP  Z,_SYS5F
00085C D5BC FE6F             7      CP  06FH        ;(BDOS)MSX-DOS のバージョン番号の獲得(_DOSVER)
00085E D5BE 200A            12      JR  NZ,_ERROR
000860 D5C0 011D01          10      LD  BC,011DH
000863 D5C3 114901          10      LD  DE,VER
000866 D5C6 210100          10      LD  HL,MACD
       D5C9                     C_REM:
000869 D5C9 AF               4      XOR A
       D5CA                     _ERROR:
00086A D5CA A7               4      AND A
00086B D5CB C9              10      RET
                                
       D5CC                     _SYS09:     ;文字列出力
00086C D5CC D5              11      PUSH    DE
       D5CD                     _SX09:
00086D D5CD 1A               7      LD  A,(DE)
00086E D5CE 13               6      INC DE
00086F D5CF FE24             7      CP  '$'
000871 D5D1 2831            12      JR  Z,SX0E2
000873 D5D3 CDB4D8          17      CALL    MSG_A
000876 D5D6 18F5            12      JR  _SX09
                                
       D5D8                     MSX1:
000878 D5D8 CDB4D8          17      CALL    MSG_A
       D5DB                     MSX:
00087B D5DB 7E               7      LD  A,(HL)
00087C D5DC 23               6      INC HL
00087D D5DD B7               4      OR  A
00087E D5DE 20F8            12      JR  NZ,MSX1
000880 D5E0 C9              10      RET
                                
       D5E1                     _SYS0C:     ;(BDOS)バージョン番号の獲得
000881 D5E1 212200          10      LD  HL,00022H
000884 D5E4 7D               4      LD  A,L
000885 D5E5 C9              10      RET
                                
       D5E6                     _SYS0D:     ;(BDOS)ディスクリセット
000886 D5E6 CDDFEF          17      CALL    _FFLUSH
000889 D5E9 E5              11      PUSH    HL
00088A D5EA 218000          10      LD  HL,00080H
00088D D5ED 228AEF          16      LD  (_DTA),HL
000890 D5F0 E1              10      POP HL
000891 D5F1 D5              11      PUSH    DE
000892 D5F2 1E00             7      LD  E,0
000894 D5F4 3E                      DB  03EH
                                
       D5F5                     _SYS0E:     ;(BDOS)カレントドライブの設定
000895 D5F5 D5              11      PUSH    DE
000896 D5F6 7B               4      LD  A,E
000897 D5F7 DDE5            15      PUSH    IX
000899 D5F9 CDDCEF          17      CALL    _GETDPB
00089C D5FC DDE1            14      POP IX
00089E D5FE 3804            12      JR  C,SX0E2
0008A0 D600 7B               4      LD  A,E
0008A1 D601 3287EF          13      LD  (_DVSW),A
       D604                     SX0E2:
0008A4 D604 3E08             7      LD  A,8
0008A6 D606 D1              10      POP DE
0008A7 D607 C9              10      RET
                                
       D608                     _SYS0F:     ;(BDOS)ファイルのオープン
0008A8 D608 CDABDD          17      CALL    SETDRV
0008AB D60B FD7E1C          19      LD  A,(IY+28)   ;(FCB)オープンモード
0008AE D60E C602             7      ADD A,002H      ;Write
0008B0 D610 2848            12      JR  Z,FEND0F
0008B2 D612 CDF9E0          17      CALL    CHKWILDX
                                
0008B5 D615 D4CBDD          17      CALL    NC,SOPENX
       D618                     _S16XX:
0008B8 D618 3840            12      JR  C,FEND0F
                                                ;Directory location
0008BA D61A 3A9FEF          13      LD  A,(_FILEN)
0008BD D61D FD7719          19      LD  (IY+25),A   ;(FCB)ディレクトリロケーション
                                ;               _DIRF
0008C0 D620 3AA0EF          13      LD  A,(_DIRF)
0008C3 D623 FD771D          19      LD  (IY+29),A   ;(FCB)ディレクトリモード
                                ;               _FBPS
0008C6 D626 FD731E          19      LD  (IY+30),E   ;(FCB)ディレクトリポジション
0008C9 D629 FD721F          19      LD  (IY+31),D
                                ;               Open(Read)
0008CC D62C FD361CFF        19      LD  (IY+28),0FFH    ;(FCB)オープンモード
                                ;               FILENAME
0008D0 D630 FDE5            15      PUSH    IY
0008D2 D632 D1              10      POP DE
0008D3 D633 13               6      INC DE
0008D4 D634 010B00          10      LD  BC,11
0008D7 D637 EDB0                    LDIR
                                ;               Attribute
0008D9 D639 7E               7      LD  A,(HL)
0008DA D63A FD770D          19      LD  (IY+13),A   ;(FCB)属性(アトリビュート)
0008DD D63D 110B00          10      LD  DE,11       ;Reserved
0008E0 D640 19              11      ADD HL,DE
                                                    ;(FCB)ファイルを最後に変更した時刻
0008E1 D641 11EAF0          10      LD  DE,SDDATA       ;(FCB)ファイルを最後に変更した日付
0008E4 D644 060A             7      LD  B,SDDATAE-SDDATA    ;(FCB)ファイルの先頭クラスタ
       D646                     S16LOOP:                ;(FCB)ファイルのサイズ(バイト単位)
0008E6 D646 1A               7      LD  A,(DE)
0008E7 D647 13               6      INC DE
0008E8 D648 324FD6          13      LD  (S16PAT+2),A
0008EB D64B 7E               7      LD  A,(HL)
0008EC D64C 23               6      INC HL
0008ED D64D FD7700          19  S16PAT: LD  (IY+0),A
0008F0 D650 10F4            13      DJNZ    S16LOOP
                                
0008F2 D652 AF               4      XOR A
0008F3 D653 FD770C          19      LD  (IY+12),A   ;(FCB)カレントブロック
0008F6 D656 FD22FED6        20      LD  (OFCB+1),IY
       D65A                     FEND0F:
0008FA D65A 1845            12      JR  FEND10
                                
       D65C                     _SYS10:     ;(BDOS)ファイルのクローズ
0008FC D65C CDABDD          17      CALL    SETDRV
0008FF D65F FD7E1C          19      LD  A,(IY+28)   ;(FCB)オープンモード
000902 D662 D6FE             7      SUB 0FEH
000904 D664 37               4      SCF
000905 D665 3F               4      CCF
000906 D666 2039            12      JR  NZ,FEND10
       D668                     _S10A:              ;Write
000908 D668 FD770E          19      LD  (IY+14),A   ;(FCB)レコードサイズ/アクセスするディレクトリのクラスタ番号+1
00090B D66B FD770F          19      LD  (IY+15),A
                                
00090E D66E FD341C          23      INC (IY+28)     ;0FEH->0FFH ;オープンモード
000911 D671 CDF1E1          17      CALL    SETTMS
                                
000914 D674 FD7E1D          19      LD  A,(IY+29)   ;(FCB)ディレクトリモード
000917 D677 32A0EF          13      LD  (_DIRF),A
00091A D67A E67F             7      AND 07FH
00091C D67C 323AE7          13      LD  (_SECPS+1),A
00091F D67F FD5E1E          19      LD  E,(IY+30)   ;(FCB)ディレクトリポジション
000922 D682 FD561F          19      LD  D,(IY+31)
000925 D685 CDFFDE          17      CALL    READ_DIR
000928 D688 3817            12      JR  C,FEND10
                                
00092A D68A 3A29DE          13  SDECM1: LD  A,(SDECPAT+1)   ;1セクタ辺りのディレクトリエントリ数
00092D D68D 3D               4      DEC A       ;1024=01FH / 512=00FH / 256=7
00092E D68E FDA619          19      AND (IY+25)     ;(FCB)ディレクトリロケーション
000931 D691 6F               4      LD  L,A
000932 D692 2600             7      LD  H,0
000934 D694 29              11      ADD HL,HL       ;*2
000935 D695 29              11      ADD HL,HL       ;*4
000936 D696 29              11      ADD HL,HL       ;*8
000937 D697 29              11      ADD HL,HL       ;*16
000938 D698 29              11      ADD HL,HL       ;*32
000939 D699 ED4B7EF0        20      LD  BC,(_DTBUF)
00093D D69D 09              11      ADD HL,BC
                                
00093E D69E CD09E1          17      CALL    SDIRENT
       D6A1                     FEND10:
000941 D6A1 1842            12      JR  FEND
                                
       D6A3                     _SYS11:     ;(BDOS)最初のファイルの検索
000943 D6A3 CDABDD          17      CALL    SETDRV
000946 D6A6 CDF8DD          17      CALL    SOPEN
       D6A9                     _S12X1:
000949 D6A9 383A            12      JR  C,FEND
00094B D6AB CD98DE          17      CALL    SOPENE2
00094E D6AE ED5B8AEF        20      LD  DE,(_DTA)
000952 D6B2 3A88EF          13      LD  A,(_DRV)
000955 D6B5 3C               4      INC A
000956 D6B6 12               7      LD  (DE),A
000957 D6B7 D5              11      PUSH    DE
000958 D6B8 13               6      INC DE
000959 D6B9 012000          10      LD  BC,32
00095C D6BC EDB0                    LDIR
00095E D6BE FD6E0E          19      LD  L,(IY+14)   ;(FCB)レコードサイズ/アクセスするディレクトリのクラスタ番号+1
000961 D6C1 FD660F          19      LD  H,(IY+15)
000964 D6C4 22F4F0          16      LD  (SCDIR),HL
000967 D6C7 2A9AEF          16      LD  HL,(_FBPS)
00096A D6CA 22F6F0          16      LD  (SFBPS),HL
00096D D6CD 2A9FEF          16      LD  HL,(_FILEN)
000970 D6D0 7C               4      LD  A,H
000971 D6D1 B7               4      OR  A
000972 D6D2 2806            12      JR  Z,_S12DIR
000974 D6D4 3A3AE7          13      LD  A,(_SECPS+1)
000977 D6D7 F680             7      OR  080H
000979 D6D9 67               4      LD  H,A
       D6DA                     _S12DIR:
00097A D6DA 22F8F0          16      LD  (SFNDF),HL  ;Directory position and Flags
00097D D6DD E1              10      POP HL
00097E D6DE 1139EF          10      LD  DE,SFILE
000981 D6E1 0E21             7      LD  C,33
       D6E3                     _S11B:
000983 D6E3 EDB0                    LDIR
       D6E5                     FEND:
000985 D6E5 9F               4      SBC A,A     ;CF=0 A=0 : CF=1 A=0FFH
       D6E6                     FENDE:
000986 D6E6 FDE1            14      POP IY
000988 D6E8 C1              10      POP BC
000989 D6E9 D1              10      POP DE
00098A D6EA E1              10      POP HL
00098B D6EB C9              10      RET
                                
       D6EC                     _SYS12:     ;(BDOS)次のファイルの検索
00098C D6EC E5              11      PUSH    HL
00098D D6ED D5              11      PUSH    DE
00098E D6EE C5              11      PUSH    BC
00098F D6EF FDE5            15      PUSH    IY
000991 D6F1 CD5CDE          17      CALL    NOPEN
000994 D6F4 18B3            12      JR  _S12X1
                                
       D6F6                     _S16K:
000996 D6F6 FD7E1C          19      LD  A,(IY+28)   ;(FCB)オープンモード
000999 D6F9 FEFD             7      CP  0FDH        ;Device(0FDH)
00099B D6FB 37               4      SCF
00099C D6FC C8              11      RET Z
                                
00099D D6FD 110000          10  OFCB:   LD  DE,0
0009A0 D700 D5              11      PUSH    DE
0009A1 D701 061A             7      LD  B,26        ;First cluster
       D703                     S16K1:
0009A3 D703 13               6      INC DE
0009A4 D704 23               6      INC HL
0009A5 D705 10FC            13      DJNZ    S16K1
                                
0009A7 D707 1A               7      LD  A,(DE)
0009A8 D708 BE               7      CP  (HL)
0009A9 D709 2013            12      JR  NZ,S16K2
0009AB D70B 13               6      INC DE
0009AC D70C 23               6      INC HL
0009AD D70D 1A               7      LD  A,(DE)
0009AE D70E BE               7      CP  (HL)
0009AF D70F 200D            12      JR  NZ,S16K2
                                
0009B1 D711 E1              10      POP HL
0009B2 D712 FDE5            15      PUSH    IY
0009B4 D714 D1              10      POP DE
0009B5 D715 1A               7      LD  A,(DE)      ;Drive
0009B6 D716 BE               7      CP  (HL)
0009B7 D717 2006            12      JR  NZ,S16K3
                                                ;ここはCFが必ず0
0009B9 D719 ED52            15      SBC HL,DE       ;CP HL,DE
0009BB D71B 37               4      SCF
0009BC D71C C0              11      RET NZ
0009BD D71D E5              11      PUSH    HL
       D71E                     S16K2:
0009BE D71E E1              10      POP HL
       D71F                     S16K3:
0009BF D71F FDE5            15      PUSH    IY
0009C1 D721 D1              10      POP DE
       D722                     _SYS13:     ;(BDOS)ファイルの削除
0009C2 D722 CDABDD          17      CALL    SETDRV
0009C5 D725 CD29E0          17      CALL    KILL
       D728                     FEND13:
0009C8 D728 18BB            12      JR  FEND
                                
       D72A                     _SYS14:     ;(BDOS)シーケンシャルな読み出し
0009CA D72A CDABDD          17      CALL    SETDRV
0009CD D72D CD5DE2          17      CALL    INIT_SEQ
       D730                     SREAD:
0009D0 D730 CDA7E2          17      CALL    RB_READ
                                
0009D3 D733 C601             7      ADD A,001H
0009D5 D735 38AE            12      JR  C,FEND
                                
0009D7 D737 7D               4      LD  A,L
0009D8 D738 D601             7      SUB 001H
       D73A                     FENDX:
0009DA D73A 9F               4      SBC A,A
0009DB D73B E603             7      AND 3
0009DD D73D 1F               4      RRA
0009DE D73E 18A6            12      JR  FENDE
                                
       D740                     _SYS15:     ;(BDOS)シーケンシャルな書き込み
0009E0 D740 CDABDD          17      CALL    SETDRV
0009E3 D743 CD5DE2          17      CALL    INIT_SEQ
       D746                     SWRITE:
0009E6 D746 CDA0E2          17      CALL    RB_WRITE
                                
0009E9 D749 C6FF             7      ADD A,0FFH
0009EB D74B 18ED            12      JR  FENDX
                                
       D74D                     _SYS17:     ;(BDOS)ファイル名の変更
0009ED D74D CDABDD          17      CALL    SETDRV
0009F0 D750 CD7FE0          17      CALL    NAME
0009F3 D753 18D3            12      JR  FEND13
                                
       D755                     _SYS16:     ;(BDOS)ファイルの作成
0009F5 D755 CDABDD          17      CALL    SETDRV
                                
0009F8 D758 CDF9E0          17      CALL    CHKWILDX
0009FB D75B 38CB            12      JR  C,FEND13
0009FD D75D FD7E01          19      LD  A,(IY+1)    ;(FCB)主ファイル名
000A00 D760 FE05             7      CP  5
000A02 D762 2805            12      JR  Z,_S16X2
000A04 D764 FE21             7      CP  021H
000A06 D766 DA28D7          10      JP  C,FEND13
       D769                     _S16X2:
                                ;               Clear FCB
000A09 D769 FDE5            15      PUSH    IY
000A0B D76B E1              10      POP HL
000A0C D76C 011000          10      LD  BC,16
000A0F D76F 09              11      ADD HL,BC
       D770                     _S16X1:
000A10 D770 70               7      LD  (HL),B      ;B=0
000A11 D771 23               6      INC HL
000A12 D772 0D               4      DEC C
000A13 D773 20FB            12      JR  NZ,_S16X1
                                
000A15 D775 CDF6E1          17      CALL    SETTMSX
000A18 D778 FD360DFF        19      LD  (IY+13),0FFH    ;(FCB)Attribute
000A1C D77C CDCBDD          17      CALL    SOPENX
000A1F D77F 3F               4      CCF
000A20 D780 CCF6D6          17      CALL    Z,_S16K
000A23 D783 D4A9DE          17      CALL    NC,COPEN
000A26 D786 D409E1          17      CALL    NC,SDIRENT
000A29 D789 C318D6          10      JP  _S16XX
                                
       D78C                     _SYS21:     ;(BDOS)ランダムな読み出し
000A2C D78C CDABDD          17      CALL    SETDRV
000A2F D78F CD41E2          17      CALL    INIT_RND
000A32 D792 189C            12      JR  SREAD
                                
       D794                     _SYS22:     ;(BDOS)ランダムな書き込み
       D794                     _SYS28:     ;(BDOS)ランダムな書き込み・その2
000A34 D794 CDABDD          17      CALL    SETDRV
000A37 D797 CD41E2          17      CALL    INIT_RND
000A3A D79A 18AA            12      JR  SWRITE
                                
       D79C                     _SYS18:     ;(BDOS)ログインベクトルの獲得
000A3C D79C 21FF00          10      LD  HL,000FFH
000A3F D79F AF               4      XOR A
000A40 D7A0 C9              10      RET
                                
       D7A1                     _SYS19:     ;(BDOS)カレントドライブ番号の獲得
000A41 D7A1 3A87EF          13      LD  A,(_DVSW)
000A44 D7A4 A7               4      AND A
000A45 D7A5 C9              10      RET
                                
       D7A6                     _SYS1A:     ;(BDOS)DTAの設定
000A46 D7A6 ED538AEF        20      LD  (_DTA),DE
000A4A D7AA AF               4      XOR A
000A4B D7AB C9              10      RET
                                
       D7AC                     _SYS1B:     ;(BDOS)ディスク情報の獲得
000A4C D7AC 7B               4      LD  A,E
000A4D D7AD CDBEDD          17      CALL    GETDRV
000A50 D7B0 CDDCEF          17      CALL    _GETDPB
000A53 D7B3 D4E2EF          17      CALL    NC,_RDFATX
000A56 D7B6 210000          10      LD  HL,0
000A59 D7B9 D4CFE1          17      CALL    NC,DSKF
                                
000A5C D7BC ED5BD0E1        20      LD  DE,(MAXCLP+1)   ;DPB_08_MAXCL-1
000A60 D7C0 1B               6      DEC DE      ;DE←クラスタの総数
000A61 D7C1 FD2A7CF0        20      LD  IY,(_FATBF) ;IY←メモリ上のFATの先頭アドレス
000A65 D7C5 9F               4      SBC A,A
000A66 D7C6 D8              11      RET C
000A67 D7C7 4F               4      LD  C,A     ;C=0
000A68 D7C8 DD7E0F          19      LD  A,(IX+00FH) ;DPB_0F_BPS
000A6B D7CB E60F             7      AND 00FH
000A6D D7CD 47               4      LD  B,A
000A6E D7CE DD7E07          19      LD  A,(IX+7)    ;DPB_07_SECPCL
000A71 D7D1 C9              10      RET
                                
       D7D2                     _SYS1D:     ;(BDOS)書き込みが禁止されているディスクの調査
000A72 D7D2 AF               4      XOR A
000A73 D7D3 67               4      LD  H,A
000A74 D7D4 6F               4      LD  L,A
000A75 D7D5 C9              10      RET
                                
       D7D6                     _SYS1F:     ;(BDOS)ディスク装置のパラメータの読み出し
000A76 D7D6 2100F1          10      LD  HL,DEVICE
000A79 D7D9 7B               4      LD  A,E
000A7A D7DA C3DCEF          10      JP  _GETDPB
                                
       D7DD                     _SYS23:     ;(BDOS)ファイルサイズの獲得
000A7D D7DD E5              11      PUSH    HL
000A7E D7DE 2A1EF0          16      LD  HL,(STABLE+2*00FH)  ;ファイルのオープン
000A81 D7E1 CD0F00          17      CALL    JP_HL
000A84 D7E4 381B            12      JR  C,_S23X1
                                
000A86 D7E6 D5              11      PUSH    DE      ;EX DE,IY
000A87 D7E7 FDE3            23      EX  (SP),IY     ;
                                ;   POP DE      ;
                                ;   PUSH    DE      ;DEを破壊しないように注意vv
000A89 D7E9 FD7E10          19      LD  A,(IY+16)   ;(FCB)ファイルのサイズ(バイト単位)
000A8C D7EC FD6E11          19      LD  L,(IY+17)   ;
000A8F D7EF FD6612          19      LD  H,(IY+18)   ;
000A92 D7F2 C5              11      PUSH    BC      ;
000A93 D7F3 FD4613          19      LD  B,(IY+19)   ;
000A96 D7F6 CD33E2          17      CALL    GET_CPM_R_SIZE
000A99 D7F9 C1              10      POP BC
       D7FA                     _S24X1:
000A9A D7FA CD53E2          17      CALL    SET_RR_AHL
                                ;   POP DE      ;^^^^^^^^^^^^^^^^^^^^^^^^
                                ;   PUSH    DE      ;EX DE,IY
000A9D D7FD FDE3            23      EX  (SP),IY     ;
000A9F D7FF D1              10      POP DE      ;
                                
000AA0 D800 AF               4      XOR A
       D801                     _S23X1:
000AA1 D801 E1              10      POP HL
000AA2 D802 C9              10      RET
                                
       D803                     _SYS24:     ;(BDOS)ランダムレコードフィールドの設定
000AA3 D803 E5              11      PUSH    HL
000AA4 D804 D5              11      PUSH    DE      ;EX DE,IY
000AA5 D805 FDE3            23      EX  (SP),IY     ;
                                ;   POP DE      ;
                                ;   PUSH    DE      ;DEを破壊しないように注意vv
000AA7 D807 CD65E2          17      CALL    GETSEQ
000AAA D80A 18EE            12      JR  _S24X1      ;^^^^^^^^^^^^^^^^^^^^^^^^
                                
       D80C                     _SYS5C:     ;(BDOS)ファイル名の解析
000AAC D80C C5              11      PUSH    BC
000AAD D80D E5              11      PUSH    HL
000AAE D80E CDC2DC          17      CALL    FILE
000AB1 D811 E1              10      POP HL
000AB2 D812 C1              10      POP BC
       D813                     S29X1:
000AB3 D813 C5              11      PUSH    BC
000AB4 D814 D5              11      PUSH    DE
000AB5 D815 E5              11      PUSH    HL
000AB6 D816 EB               4      EX  DE,HL
000AB7 D817 2114EF          10      LD  HL,FDRV
000ABA D81A 010D00          10      LD  BC,13
000ABD D81D EDB0                    LDIR
000ABF D81F 70               7      LD  (HL),B      ;B=0
000AC0 D820 0E03             7      LD  C,3
000AC2 D822 EDB0                    LDIR
000AC4 D824 E1              10      POP HL
000AC5 D825 D1              10      POP DE
000AC6 D826 C1              10      POP BC
000AC7 D827 AF               4      XOR A
000AC8 D828 C9              10      RET
                                
       D829                     _SYS30:     ;(BDOS)論理セクタを用いた書き込み
000AC9 D829 C5              11      PUSH    BC
000ACA D82A 01A7E8          10      LD  BC,DWT24B
000ACD D82D 1804            12      JR  S2FX
       D82F                     _SYS2F:
000ACF D82F C5              11      PUSH    BC
000AD0 D830 0197E8          10      LD  BC,DRD24B
       D833                     S2FX:
000AD3 D833 ED4349D8        20      LD  (S2FPAT+1),BC
000AD7 D837 CDDFEF          17      CALL    _FFLUSH
                                
000ADA D83A D5              11      PUSH    DE
000ADB D83B E5              11      PUSH    HL
000ADC D83C 7D               4      LD  A,L     ;Drive
000ADD D83D CDD9EF          17      CALL    _CHGDRV
000AE0 D840 3809            12      JR  C,S30X2
000AE2 D842 44               4      LD  B,H     ;Number of clusters
000AE3 D843 2A8AEF          16      LD  HL,(_DTA)
                                
000AE6 D846 0E00             7      LD  C,0
000AE8 D848 CD97E8          17  S2FPAT: CALL    DRD24B
       D84B                     S30X2:
000AEB D84B E1              10      POP HL
000AEC D84C D1              10      POP DE
000AED D84D C1              10      POP BC
000AEE D84E 9F               4      SBC A,A
000AEF D84F C9              10      RET
                                
       D850                     _SYS5A:     ;(BDOS)カレントディレクトリの変更
000AF0 D850 C5              11      PUSH    BC
000AF1 D851 D5              11      PUSH    DE
000AF2 D852 E5              11      PUSH    HL
000AF3 D853 CDB7DC          17      CALL    FILEC
000AF6 D856 210000          10      LD  HL,0
000AF9 D859 1114EF          10      LD  DE,FDRV
000AFC D85C 2A4EF0          16      LD  HL,(STABLE+2*027H)  ;ランダムブロック読み込み
000AFF D85F CD0F00          17      CALL    JP_HL
000B02 D862 18E7            12      JR  S30X2
[EOF:LDOS.ASM:SHIFT_JIS]
                                    INCLUDE "M7IO.ASM"
                                
                                ;   LSX-Dodgers IO
                                ;   MZ-700/1500
                                
       D5CA                     _SYS04  EQU _ERROR      ;(BDOS)外部出力
       D5CA                     _SYS05  EQU _ERROR      ;(BDOS)プリンタ出力
       D5CA                     _SYS1C  EQU _ERROR      ;(BDOS)ディスクの書き込み禁止化
       D5CA                     _SYS1E  EQU _ERROR      ;(BDOS)ファイル属性の設定
       D5CA                     _SYS20  EQU _ERROR      ;(BDOS)利用者番号の設定と読み出し
       D5CA                     _SYS2E  EQU _ERROR      ;(BDOS)ベリファイ・フラグの設定
                                
       0000                     INT EQU 0
       0000                     INTCTCE EQU 0
       0000                     INTCTC2 EQU 0
                                
       D864                     ARWKEY:
000B04 D864 3D               4      DEC A
000B05 D865 3276D8          13      LD  (KEYAR),A
000B08 D868 181C            12      JR  INT8253E
       D86A                     SETKEY1:
000B0A D86A 3E10             7      LD  A,16
000B0C D86C 180C            12      JR  SETKEY
       D86E                     INT8253:
000B0E D86E CD49DC          17      CALL    CHKEY
       D872                     KEYDT   EQU $+1
000B11 D871 FE00             7      CP  0
000B13 D873 20F5            12      JR  NZ,SETKEY1
       D876                     KEYAR   EQU $+1
000B15 D875 3E00             7      LD  A,0
000B17 D877 B7               4      OR  A
000B18 D878 20EA            12      JR  NZ,ARWKEY
       D87A                     SETKEY:
000B1A D87A 3276D8          13      LD  (KEYAR),A
000B1D D87D 3A92EF          13      LD  A,(_KEYD)
000B20 D880 3272D8          13      LD  (KEYDT),A
000B23 D883 CD89D8          17      CALL    KEYSET
       D886                     INT8253E:
000B26 D886 F1              10      POP AF
000B27 D887 FB               4      EI
000B28 D888 C9              10      RET
       D889                     KEYSET:
       D889                     KEYBS:
000B29 D889 B7               4      OR  A
000B2A D88A C8              11      RET Z
       D88B                     KEYBS1:
000B2B D88B CDA1D8          17      CALL    KEYBC_IFBREAK
000B2E D88E E5              11      PUSH    HL
000B2F D88F F5              11      PUSH    AF
000B30 D890 2A90EF          16      LD  HL,(_KEYPS)
000B33 D893 2C               4      INC L
000B34 D894 7D               4      LD  A,L
000B35 D895 BC               4      CP  H
000B36 D896 2815            12      JR  Z,POP_AF_HL_SCF_RET
000B38 D898 3290EF          13      LD  (_KEYPS),A
000B3B D89B 26FE             7      LD  H,KEYBF/256
000B3D D89D F1              10      POP AF
000B3E D89E 77               7      LD  (HL),A
000B3F D89F E1              10      POP HL
000B40 D8A0 C9              10      RET
       D8A1                     KEYBC_IFBREAK:
000B41 D8A1 FE03             7      CP  3
000B43 D8A3 C0              11      RET NZ
       D8A4                     KEYBC:
000B44 D8A4 E5              11      PUSH    HL
000B45 D8A5 210000          10      LD  HL,0
000B48 D8A8 2290EF          16      LD  (_KEYPS),HL
000B4B D8AB E1              10      POP HL
000B4C D8AC C9              10      RET
                                
       D8AD                     POP_AF_HL_SCF_RET:
000B4D D8AD F1              10      POP AF
000B4E D8AE E1              10      POP HL
000B4F D8AF 37               4      SCF
000B50 D8B0 C9              10      RET
                                
       D8B1                     _SYS01:     ;(BDOS)コンソール入力
000B51 D8B1 CD09EF          17      CALL    _SYS07
       D8B4                     MSG_A:
000B54 D8B4 F5              11      PUSH    AF
000B55 D8B5 D5              11      PUSH    DE
000B56 D8B6 5F               4      LD  E,A
000B57 D8B7 CDBDD8          17      CALL    _SYS02
000B5A D8BA D1              10      POP DE
000B5B D8BB F1              10      POP AF
000B5C D8BC C9              10      RET
                                
       D8BD                     _SYS02:     ;(BDOS)コンソール出力
000B5D D8BD CDCFD8          17      CALL    BREAK
000B60 D8C0 1805            12      JR  PRINTX
                                
       D8C2                     _SYS06:     ;(BDOS)コンソール直接入出力
000B62 D8C2 7B               4      LD  A,E
000B63 D8C3 3C               4      INC A
000B64 D8C4 CACAEF          10      JP  Z,_INKEY
       D8C7                     PRINTX:
000B67 D8C7 C3CDEF          10      JP  _PRINT
                                
       D8CA                     _SYS08:     ;(BDOS)エコーなしコンソール入力
000B6A D8CA CD09EF          17      CALL    _SYS07
000B6D D8CD 1804            12      JR  BREAK1
       D8CF                     BREAK:
000B6F D8CF FB               4      EI
000B70 D8D0 3A92EF          13      LD  A,(_KEYD)
       D8D3                     BREAK1:
000B73 D8D3 FE03             7      CP  3       ;CTRL+C
000B75 D8D5 CA00EF          10      JP  Z,CPM_BOOT
000B78 D8D8 FE13             7      CP  013H        ;CTRL+S
000B7A D8DA C0              11      RET NZ
                                
       D8DB                     PAUSE:
000B7B D8DB CDA4D8          17      CALL    KEYBC
                                
       D8DE                     FLGET:
000B7E D8DE CDDFEF          17      CALL    _FFLUSH
000B81 D8E1 E5              11      PUSH    HL
000B82 D8E2 2A8EEF          16      LD  HL,(_TXADR)
000B85 D8E5 7C               4      LD  A,H
000B86 D8E6 C6D0             7      ADD A,0D0H
000B88 D8E8 67               4      LD  H,A
000B89 D8E9 CD37CF          17      CALL    RDMMIO
000B8C D8EC 3201D9          13      LD  (FLSMC),A
       D8EF                     FLGET1:
000B8F D8EF CD2DCF          17      CALL    RD556VSYNC
000B92 D8F2 CB77             8      BIT 6,A
000B94 D8F4 3EEF             7      LD  A,0EFH      ;カーソル
000B96 D8F6 200A            12      JR  NZ,FLGET2
000B98 D8F8 3A92EF          13      LD  A,(_KEYD)
000B9B D8FB B7               4      OR  A
000B9C D8FC 3EEF             7      LD  A,0EFH      ;カーソル
000B9E D8FE 2002            12      JR  NZ,FLGET2
       D901                     FLSMC   EQU $+1
000BA0 D900 3E00             7      LD  A,0     ;自己書き換え
       D902                     FLGET2:
000BA2 D902 CD3FCF          17      CALL    WRMMIO
000BA5 D905 CDCAEF          17      CALL    _INKEY
000BA8 D908 28E5            12      JR  Z,FLGET1
000BAA D90A F5              11      PUSH    AF
000BAB D90B 3A01D9          13      LD  A,(FLSMC)
000BAE D90E CD3FCF          17      CALL    WRMMIO
000BB1 D911 F1              10      POP AF
000BB2 D912 E1              10      POP HL
000BB3 D913 C9              10      RET
                                
       D914                     _SYS0A:     ;(BDOS)文字列入力
000BB4 D914 C5              11      PUSH    BC
000BB5 D915 E5              11      PUSH    HL
000BB6 D916 D5              11      PUSH    DE
000BB7 D917 CDA9DB          17      CALL    GETL
000BBA D91A 1100FF          10      LD  DE,KBUF
000BBD D91D E1              10      POP HL
000BBE D91E E5              11      PUSH    HL
000BBF D91F 0E00             7      LD  C,0
000BC1 D921 3004            12      JR  NC,SAX0
000BC3 D923 23               6      INC HL
000BC4 D924 23               6      INC HL
000BC5 D925 1808            12      JR  SAX4
       D927                     SAX0:
000BC7 D927 46               7      LD  B,(HL)
000BC8 D928 23               6      INC HL
       D929                     SAX1:
000BC9 D929 23               6      INC HL
000BCA D92A 1A               7      LD  A,(DE)
000BCB D92B 13               6      INC DE
000BCC D92C B7               4      OR  A
000BCD D92D 2004            12      JR  NZ,SAX2
       D92F                     SAX4:
000BCF D92F 360D            10      LD  (HL),00DH
000BD1 D931 1804            12      JR  SAX3
       D933                     SAX2:
000BD3 D933 77               7      LD  (HL),A
000BD4 D934 0C               4      INC C
000BD5 D935 10F2            13      DJNZ    SAX1
       D937                     SAX3:
000BD7 D937 D1              10      POP DE
000BD8 D938 79               4      LD  A,C
000BD9 D939 13               6      INC DE
000BDA D93A 12               7      LD  (DE),A
000BDB D93B 1B               6      DEC DE
000BDC D93C E1              10      POP HL
000BDD D93D C1              10      POP BC
000BDE D93E A7               4      AND A
000BDF D93F C9              10      RET
                                
       D940                     _SYS0B:     ;(BDOS)コンソール状態のチェック
000BE0 D940 CDCFD8          17      CALL    BREAK
000BE3 D943 3A92EF          13      LD  A,(_KEYD)
000BE6 D946 B7               4      OR  A
000BE7 D947 C8              11      RET Z
       D948                     CONSTX:
000BE8 D948 CDDFEF          17      CALL    _FFLUSH
000BEB D94B E5              11      PUSH    HL
000BEC D94C 2A90EF          16      LD  HL,(_KEYPS)
000BEF D94F 7C               4      LD  A,H
000BF0 D950 AD               4      XOR L
000BF1 D951 E1              10      POP HL
000BF2 D952 C6FF             7      ADD A,0FFH
000BF4 D954 9F               4      SBC A,A
000BF5 D955 C9              10      RET
                                
       D956                     _SYS2A:     ;(BDOS)日付の獲得
000BF6 D956 AF               4      XOR A
000BF7 D957 57               4      LD  D,A
000BF8 D958 5F               4      LD  E,A
000BF9 D959 67               4      LD  H,A
000BFA D95A 6F               4      LD  L,A
000BFB D95B C9              10      RET
                                
       D95C                     _SYS2C:     ;(BDOS)時刻の獲得
000BFC D95C AF               4      XOR A
000BFD D95D 57               4      LD  D,A
000BFE D95E 5F               4      LD  E,A
000BFF D95F 67               4      LD  H,A
000C00 D960 6F               4      LD  L,A
000C01 D961 C9              10      RET
                                
       D962                     ESC1:
000C02 D962 7B               4      LD  A,E
000C03 D963 FE41             7      CP  'A'
000C05 D965 CA5ADA          10      JP  Z,CTRL1E
000C08 D968 FE42             7      CP  'B'
000C0A D96A CA6CDB          10      JP  Z,CTRL1F
000C0D D96D FE43             7      CP  'C'
000C0F D96F CA2DDA          10      JP  Z,CTRL1C
000C12 D972 FE44             7      CP  'D'
000C14 D974 CA51DA          10      JP  Z,CTRL1D
000C17 D977 FE45             7      CP  'E'
000C19 D979 2802            12      JR  Z,CT0CX
000C1B D97B FE6A             7      CP  'j'
       D97D                     CT0CX:
000C1D D97D CA51DB          10      JP  Z,CTRL0C
000C20 D980 FE48             7      CP  'H'
000C22 D982 CACEDA          10      JP  Z,CTRL0B
000C25 D985 FE4A             7      CP  'J'
000C27 D987 CA54DB          10      JP  Z,CTRL06
000C2A D98A FE4B             7      CP  'K'
000C2C D98C CAA0DA          10      JP  Z,CTRL05
000C2F D98F FE4C             7      CP  'L'
000C31 D991 CA7EDB          10      JP  Z,CTRL0E
000C34 D994 FE54             7      CP  'T'
000C36 D996 CAA0DA          10      JP  Z,CTRL05
000C39 D999 FE78             7      CP  'x'
000C3B D99B 2804            12      JR  Z,ESC1X
000C3D D99D FE79             7      CP  'y'
000C3F D99F 2002            12      JR  NZ,ESC1Y
       D9A1                     ESC1X:
000C41 D9A1 3601            10      LD  (HL),1
       D9A3                     ESC1Y:
000C43 D9A3 FE3D             7      CP  '='
000C45 D9A5 2804            12      JR  Z,ESC1W
000C47 D9A7 FE59             7      CP  'Y'
000C49 D9A9 2002            12      JR  NZ,ESC1Z
       D9AB                     ESC1W:
000C4B D9AB 3602            10      LD  (HL),2
       D9AD                     ESC1Z:
000C4D D9AD FE20             7      CP  020H
000C4F D9AF 3802            12      JR  C,ESC1C
000C51 D9B1 87               4      ADD A,A
000C52 D9B2 D0              11      RET NC
       D9B3                     ESC1C:
000C53 D9B3 E1              10      POP HL
000C54 D9B4 1832            12      JR  ANK
                                
       D9B6                     ESC:
000C56 D9B6 2119DA          10      LD  HL,PRINTE5
000C59 D9B9 E5              11      PUSH    HL
000C5A D9BA 21DCD9          10      LD  HL,ESCFLG
000C5D D9BD 3600            10      LD  (HL),0
000C5F D9BF 3D               4      DEC A
000C60 D9C0 28A0            12      JR  Z,ESC1
000C62 D9C2 3D               4      DEC A
000C63 D9C3 2009            12      JR  NZ,ESC2
000C65 D9C5 3603            10      LD  (HL),3
000C67 D9C7 7B               4      LD  A,E
000C68 D9C8 D620             7      SUB 020H
000C6A D9CA 32D1D9          13      LD  (ESCYP+1),A
000C6D D9CD C9              10      RET
       D9CE                     ESC2:
000C6E D9CE 3D               4      DEC A
000C6F D9CF C0              11      RET NZ
000C70 D9D0 2600             7  ESCYP:  LD  H,0
000C72 D9D2 7B               4      LD  A,E
000C73 D9D3 D620             7      SUB 020H
000C75 D9D5 6F               4      LD  L,A
000C76 D9D6 C3D6EF          10      JP  _LOC
                                
       D9D9                     PRINT:
000C79 D9D9 C5              11      PUSH    BC
000C7A D9DA E5              11      PUSH    HL
       D9DC                     ESCFLG  EQU $+1
000C7B D9DB 3E00             7      LD  A,000H      ;自己書き換え
000C7D D9DD B7               4      OR  A
000C7E D9DE 20D6            12      JR  NZ,ESC
                                
000C80 D9E0 3E1F             7      LD  A,01FH
000C82 D9E2 BB               4      CP  E
000C83 D9E3 3038            12      JR  NC,CTRL
       D9E5                     INSFLG  EQU $
000C85 D9E5 0126DB          10      LD  BC,INSERT   ;自己書き換え
       D9E8                     ANK:
000C88 D9E8 3A96EF          13      LD  A,(_COLORF)
000C8B D9EB 4F               4      LD  C,A
000C8C D9EC 7B               4      LD  A,E
000C8D D9ED FE61             7      CP  'a'     ;英小文字
000C8F D9EF 3806            12      JR  C,PRT1
000C91 D9F1 FE7B             7      CP  'z'+1
000C93 D9F3 3002            12      JR  NC,PRT1
000C95 D9F5 CBF9             8      SET 7,C
       D9F7                     PRT1:
000C97 D9F7 FE86             7      CP  $86     ;ひらがな1(を－そ)
000C99 D9F9 3806            12      JR  C,PRT2
000C9B D9FB FEA0             7      CP  $A0
000C9D D9FD 3002            12      JR  NC,PRT2
000C9F D9FF CBF9             8      SET 7,C
       DA01                     PRT2:
000CA1 DA01 FEE0             7      CP  $E0     ;ひらがな2(たーん)
000CA3 DA03 3802            12      JR  C,PRT3
000CA5 DA05 CBF9             8      SET 7,C
       DA07                     PRT3:
000CA7 DA07 2A8EEF          16      LD  HL,(_TXADR)
000CAA DA0A 7C               4      LD  A,H
000CAB DA0B C6D0             7      ADD A,0D0H
000CAD DA0D 67               4      LD  H,A
000CAE DA0E 42               4      LD  B,D
000CAF DA0F 16ED             7      LD  D,CD_TABLE/256
000CB1 DA11 1A               7      LD  A,(DE)
000CB2 DA12 50               4      LD  D,B
000CB3 DA13 CD57CF          17      CALL    IO_PRINT
000CB6 DA16 CD2DDA          17      CALL    CTRL1C
       DA19                     PRINTE5:
000CB9 DA19 E1              10      POP HL
000CBA DA1A C1              10      POP BC
000CBB DA1B AF               4      XOR A
000CBC DA1C C9              10      RET
                                
       DA1D                     CTRL:
000CBD DA1D 7B               4      LD  A,E
000CBE DA1E 87               4      ADD A,A
000CBF DA1F F680             7      OR  080H
000CC1 DA21 6F               4      LD  L,A
000CC2 DA22 26F0             7      LD  H,CTRLTB/256
000CC4 DA24 7E               7      LD  A,(HL)
000CC5 DA25 2C               4      INC L
000CC6 DA26 66               7      LD  H,(HL)
000CC7 DA27 6F               4      LD  L,A
000CC8 DA28 CD0F00          17      CALL    JP_HL
000CCB DA2B 18EC            12      JR  PRINTE5
                                
       DA2D                     CTRL1C:
000CCD DA2D ED4B8EEF        20      LD  BC,(_TXADR)
000CD1 DA31 03               6      INC BC
       DA32                     PRINTE3:
000CD2 DA32 2118FC          10      LD  HL,0-WIDTH*LINE
000CD5 DA35 A7               4      AND A
000CD6 DA36 ED4A            15      ADC HL,BC
       DA38                     PRINTE8:
000CD8 DA38 2805            12      JR  Z,PRINT2
000CDA DA3A ED438EEF        20      LD  (_TXADR),BC
       DA3E                     CTRL00:
000CDE DA3E C9              10      RET
                                
       DA3F                     PRINT2:
000CDF DA3F CD84DB          17      CALL    SCR
000CE2 DA42 21D8FF          10      LD  HL,0-WIDTH
000CE5 DA45 09              11      ADD HL,BC
       DA46                     SET_TXADR_HL:
000CE6 DA46 228EEF          16      LD  (_TXADR),HL
000CE9 DA49 C9              10      RET
                                
       DA4A                     CTRL08:
000CEA DA4A 3AE5D9          13      LD  A,(INSFLG)
000CED DA4D FECD             7      CP  0CDH        ;CALL ????
000CEF DA4F 2823            12      JR  Z,CTRL02
       DA51                     CTRL1D:
000CF1 DA51 2A8EEF          16      LD  HL,(_TXADR)
000CF4 DA54 7C               4      LD  A,H
000CF5 DA55 B5               4      OR  L
000CF6 DA56 C8              11      RET Z
000CF7 DA57 2B               6      DEC HL
000CF8 DA58 18EC            12      JR  SET_TXADR_HL
                                
       DA5A                     CTRL1E:
000CFA DA5A ED4B8EEF        20      LD  BC,(_TXADR)
000CFE DA5E 21D8FF          10      LD  HL,0-WIDTH
000D01 DA61 09              11      ADD HL,BC
000D02 DA62 D0              11      RET NC
000D03 DA63 18E1            12      JR  SET_TXADR_HL
                                
       DA65                     CTRL09:
000D05 DA65 ED4B8EEF        20      LD  BC,(_TXADR)
000D09 DA69 79               4      LD  A,C
000D0A DA6A E6F8             7      AND 0F8H
000D0C DA6C C608             7      ADD A,8
000D0E DA6E 4F               4      LD  C,A
000D0F DA6F 88               4      ADC A,B
000D10 DA70 91               4      SUB C
000D11 DA71 47               4      LD  B,A
000D12 DA72 18BE            12      JR  PRINTE3
                                
       DA74                     CTRL02:
000D14 DA74 CD51DA          17      CALL    CTRL1D
000D17 DA77 C8              11      RET Z
000D18 DA78 D5              11      PUSH    DE
000D19 DA79 CDD3EF          17      CALL    _POS
000D1C DA7C 54               4      LD  D,H
000D1D DA7D 3E28             7      LD  A,WIDTH
000D1F DA7F 95               4      SUB L
000D20 DA80 4F               4      LD  C,A
000D21 DA81 0D               4      DEC C
000D22 DA82 06D0             7      LD  B,0D0H
000D24 DA84 2A8EEF          16      LD  HL,(_TXADR)
000D27 DA87 09              11      ADD HL,BC
000D28 DA88 47               4      LD  B,A
                                
000D29 DA89 3A42DB          13      LD  A,(MULINE)
000D2C DA8C BA               4      CP  D
000D2D DA8D 2007            12      JR  NZ,C02X1
000D2F DA8F 112800          10      LD  DE,WIDTH
000D32 DA92 19              11      ADD HL,DE
000D33 DA93 78               4      LD  A,B
000D34 DA94 83               4      ADD A,E
000D35 DA95 47               4      LD  B,A
       DA96                     C02X1:
000D36 DA96 3A96EF          13      LD  A,(_COLORF) ;C:Color
000D39 DA99 4F               4      LD  C,A
000D3A DA9A AF               4      XOR A       ;A:Text
000D3B DA9B CD9ECF          17      CALL    IO_BS
000D3E DA9E D1              10      POP DE
000D3F DA9F C9              10      RET
                                
       DAA0                     CTRL05:
000D40 DAA0 CDD3EF          17      CALL    _POS
000D43 DAA3 3E28             7      LD  A,WIDTH
000D45 DAA5 95               4      SUB L
000D46 DAA6 47               4      LD  B,A
       DAA7                     C08X1:
000D47 DAA7 2A8EEF          16      LD  HL,(_TXADR)
000D4A DAAA 7C               4      LD  A,H
000D4B DAAB C6D0             7      ADD A,0D0H
000D4D DAAD 67               4      LD  H,A
       DAAE                     CLLINE:
000D4E DAAE 3A96EF          13      LD  A,(_COLORF)
000D51 DAB1 4F               4      LD  C,A
000D52 DAB2 AF               4      XOR A
000D53 DAB3 C381CF          10      JP  IO_CLLINE
                                
       DAB6                     CTRL0D:
000D56 DAB6 CDD3EF          17      CALL    _POS
000D59 DAB9 2E00             7      LD  L,0
       DABB                     LOC:
000D5B DABB C5              11      PUSH    BC
000D5C DABC E5              11      PUSH    HL
000D5D DABD CDDBDA          17      CALL    LOC1
000D60 DAC0 228EEF          16      LD  (_TXADR),HL
000D63 DAC3 E1              10      POP HL
000D64 DAC4 C1              10      POP BC
000D65 DAC5 C9              10      RET
                                
       DAC6                     CTRL12:
000D66 DAC6 21E5D9          10      LD  HL,INSFLG
000D69 DAC9 7E               7      LD  A,(HL)
000D6A DACA EECC             7      XOR 0CCH        ;CD:CALL ???? 1:LD BC,????
000D6C DACC 77               7      LD  (HL),A
000D6D DACD C9              10      RET
                                
       DACE                     CTRL0B:
000D6E DACE 210000          10      LD  HL,0
000D71 DAD1 228EEF          16      LD  (_TXADR),HL
000D74 DAD4 C9              10      RET
                                
       DAD5                     CTRL1B:
000D75 DAD5 3E01             7      LD  A,1
000D77 DAD7 32DCD9          13      LD  (ESCFLG),A
000D7A DADA C9              10      RET
                                
       DADB                     LOC1:
000D7B DADB D5              11      PUSH    DE
000D7C DADC 4D               4      LD  C,L
000D7D DADD 0608             7      LD  B,8
000D7F DADF 5C               4      LD  E,H
000D80 DAE0 210028          10      LD  HL,WIDTH*256
000D83 DAE3 55               4      LD  D,L ;L=0
       DAE4                     LOC2:
000D84 DAE4 29              11      ADD HL,HL
000D85 DAE5 3001            12      JR  NC,LOC3
000D87 DAE7 19              11      ADD HL,DE
       DAE8                     LOC3:
000D88 DAE8 10FA            13      DJNZ    LOC2
000D8A DAEA 09              11      ADD HL,BC
000D8B DAEB D1              10      POP DE
000D8C DAEC C9              10      RET
                                
       DAED                     CONOUT1:
                                ;   CALL    CURSOR
000D8D DAED 59               4      LD  E,C
000D8E DAEE CDCDEF          17      CALL    _PRINT
000D91 DAF1 7B               4      LD  A,E
000D92 DAF2 FE0A             7      CP  00AH
000D94 DAF4 2006            12      JR  NZ,CURSOR
000D96 DAF6 CDB6DA          17      CALL    CTRL0D
000D99 DAF9 CDA0DA          17      CALL    CTRL05
       DAFC                     CURSOR:
000D9C DAFC C9              10      RET
                                
       DAFD                     CTRL07:
000D9D DAFD 06E0             7      LD  B,0E0H
000D9F DAFF 2162EF          10      LD  HL,BEEPD+1
       DB02                     C07X0:
000DA2 DB02 4E               7      LD  C,(HL)
000DA3 DB03 23               6      INC HL
000DA4 DB04 7E               7      LD  A,(HL)
000DA5 DB05 23               6      INC HL
000DA6 DB06 CD4FCF          17      CALL    WRMMIO_BC
000DA9 DB09 7D               4      LD  A,L
000DAA DB0A FE6A             7      CP  (BEEPD+1+M7BEEPE-M7BEEPD)&255
000DAC DB0C 20F4            12      JR  NZ,C07X0
000DAE DB0E 0610             7      LD  B,16
       DB10                     C07X1:
000DB0 DB10 CD2DCF          17      CALL    RD556VSYNC
000DB3 DB13 87               4      ADD A,A
000DB4 DB14 30FA            12      JR  NC,C07X1
       DB16                     C07X2:
000DB6 DB16 CD2DCF          17      CALL    RD556VSYNC
000DB9 DB19 87               4      ADD A,A
000DBA DB1A 38FA            12      JR  C,C07X2
000DBC DB1C 10F2            13      DJNZ    C07X1
                                
000DBE DB1E AF               4      XOR A
000DBF DB1F 2108E0          10      LD  HL,0E008H
000DC2 DB22 CD3FCF          17      CALL    WRMMIO
000DC5 DB25 C9              10      RET
                                
       DB26                     INSERT:
000DC6 DB26 D5              11      PUSH    DE
000DC7 DB27 CDD3EF          17      CALL    _POS
000DCA DB2A 54               4      LD  D,H
000DCB DB2B 3E28             7      LD  A,WIDTH
000DCD DB2D 95               4      SUB L
000DCE DB2E 47               4      LD  B,A
000DCF DB2F 2A8EEF          16      LD  HL,(_TXADR)
000DD2 DB32 7C               4      LD  A,H
000DD3 DB33 C6D0             7      ADD A,0D0H
000DD5 DB35 67               4      LD  H,A
000DD6 DB36 3A96EF          13      LD  A,(_COLORF) ;C:Color
000DD9 DB39 4F               4      LD  C,A
000DDA DB3A AF               4      XOR A       ;A:Text
000DDB DB3B CD91CF          17      CALL    IO_INS
000DDE DB3E B7               4      OR  A
000DDF DB3F 2005            12      JR  NZ,INS1
       DB42                     MULINE  EQU $+1
000DE1 DB41 3EFF             7      LD  A,-1
000DE3 DB43 92               4      SUB D
000DE4 DB44 2009            12      JR  NZ,INS2
       DB46                     INS1:
000DE6 DB46 0628             7      LD  B,WIDTH
000DE8 DB48 CD91CF          17      CALL    IO_INS
000DEB DB4B 7A               4      LD  A,D
000DEC DB4C 3242DB          13      LD  (MULINE),A
       DB4F                     INS2:
000DEF DB4F D1              10      POP DE
000DF0 DB50 C9              10      RET
                                
       DB51                     CTRL0C:
000DF1 DB51 CDCEDA          17      CALL    CTRL0B
       DB54                     CTRL06:
000DF4 DB54 D5              11      PUSH    DE
000DF5 DB55 E5              11      PUSH    HL
000DF6 DB56 ED5B8EEF        20      LD  DE,(_TXADR)
000DFA DB5A 3A96EF          13      LD  A,(_COLORF)
000DFD DB5D 326ECF          13      LD  (ICSMC),A
000E00 DB60 C362CF          10      JP  IO_CLR
                                
       DB63                     CTRL04:
000E03 DB63 CDD3EF          17      CALL    _POS
000E06 DB66 7D               4      LD  A,L
000E07 DB67 B7               4      OR  A
000E08 DB68 C8              11      RET Z
       DB69                     CTRL03:
000E09 DB69 CDB6DA          17      CALL    CTRL0D
       DB6C                     CTRL0A:
       DB6C                     CTRL1F:
000E0C DB6C 2A8EEF          16      LD  HL,(_TXADR)
000E0F DB6F 012800          10      LD  BC,WIDTH
000E12 DB72 09              11      ADD HL,BC
000E13 DB73 44               4      LD  B,H
000E14 DB74 4D               4      LD  C,L
000E15 DB75 2118FC          10      LD  HL,0-WIDTH*LINE
000E18 DB78 09              11      ADD HL,BC
000E19 DB79 3F               4      CCF
000E1A DB7A 9F               4      SBC A,A
000E1B DB7B C338DA          10      JP  PRINTE8
                                
       DB7E                     CTRL0E:
000E1E DB7E CDD3EF          17      CALL    _POS
000E21 DB81 7C               4      LD  A,H
000E22 DB82 1804            12      JR  SCR1
       DB84                     SCR:
000E24 DB84 3A97EF          13      LD  A,(_LINE)
000E27 DB87 3D               4      DEC A
       DB88                     SCR1:
000E28 DB88 C5              11      PUSH    BC
000E29 DB89 D5              11      PUSH    DE
000E2A DB8A E5              11      PUSH    HL
000E2B DB8B 1100D0          10      LD  DE,0D000H
000E2E DB8E 2128D0          10      LD  HL,0D000H+WIDTH
                                
000E31 DB91 47               4      LD  B,A
000E32 DB92 B7               4      OR  A
000E33 DB93 C3B6CF          10      JP  IO_SCRUP
                                
       DB96                     POS:
000E36 DB96 2A8EEF          16      LD  HL,(_TXADR)
000E39 DB99 C5              11      PUSH    BC
000E3A DB9A 01D8FF          10      LD  BC,0-WIDTH
000E3D DB9D AF               4      XOR A
       DB9E                     POS1:
000E3E DB9E 09              11      ADD HL,BC
000E3F DB9F 3C               4      INC A
000E40 DBA0 38FC            12      JR  C,POS1
000E42 DBA2 ED42            15      SBC HL,BC
000E44 DBA4 3D               4      DEC A
000E45 DBA5 67               4      LD  H,A
000E46 DBA6 C1              10      POP BC
000E47 DBA7 A7               4      AND A
000E48 DBA8 C9              10      RET
                                
       DBA9                     GETL:
000E49 DBA9 CDD3EF          17      CALL    _POS
000E4C DBAC E5              11      PUSH    HL
000E4D DBAD 3ECD             7      LD  A,0CDH      ;CALL ????
000E4F DBAF 32E5D9          13      LD  (INSFLG),A
       DBB2                     GETL1:
000E52 DBB2 CDCAD8          17      CALL    _SYS08
000E55 DBB5 FE09             7      CP  9
000E57 DBB7 2008            12      JR  NZ,GETL1V
000E59 DBB9 2100FF          10      LD  HL,KBUF
000E5C DBBC CDDBD5          17      CALL    MSX
000E5F DBBF 18F1            12      JR  GETL1
       DBC1                     GETL1V:
000E61 DBC1 5F               4      LD  E,A
000E62 DBC2 CDD3EF          17      CALL    _POS
000E65 DBC5 CDCDEF          17      CALL    _PRINT
000E68 DBC8 7B               4      LD  A,E
000E69 DBC9 FE20             7      CP  $20
000E6B DBCB 3809            12      JR  C,GETL1V1
000E6D DBCD 7D               4      LD  A,L
000E6E DBCE FE27             7      CP  WIDTH-1
000E70 DBD0 2004            12      JR  NZ,GETL1V1
000E72 DBD2 7C               4      LD  A,H
000E73 DBD3 3242DB          13      LD  (MULINE),A
       DBD6                     GETL1V1:
000E76 DBD6 7B               4      LD  A,E
000E77 DBD7 FE0D             7      CP  00DH
000E79 DBD9 20D7            12      JR  NZ,GETL1
000E7B DBDB 3E01             7      LD  A,1     ;LD BC,????
000E7D DBDD 32E5D9          13      LD  (INSFLG),A
000E80 DBE0 1100FF          10      LD  DE,KBUF
000E83 DBE3 0628             7      LD  B,WIDTH
000E85 DBE5 CDBBD3          17      CALL    ZERO_MEMORY_DE
                                
000E88 DBE8 D1              10      POP DE
000E89 DBE9 CDD3EF          17      CALL    _POS
000E8C DBEC 6B               4      LD  L,E
000E8D DBED 3E28             7      LD  A,WIDTH
000E8F DBEF 95               4      SUB L
000E90 DBF0 57               4      LD  D,A
                                
000E91 DBF1 3A42DB          13      LD  A,(MULINE)
000E94 DBF4 94               4      SUB H
000E95 DBF5 2806            12      JR  Z,GL2X
000E97 DBF7 3C               4      INC A
000E98 DBF8 200C            12      JR  NZ,GL3X
000E9A DBFA 25               4      DEC H
000E9B DBFB 1805            12      JR  GL4X
       DBFD                     GL2X:
000E9D DBFD 3E1F             7      LD  A,$1F
000E9F DBFF CDB4D8          17      CALL    MSG_A
       DC02                     GL4X:
000EA2 DC02 7A               4      LD  A,D
000EA3 DC03 C628             7      ADD A,WIDTH
000EA5 DC05 57               4      LD  D,A
       DC06                     GL3X:
000EA6 DC06 CDDBDA          17      CALL    LOC1
000EA9 DC09 4D               4      LD  C,L
000EAA DC0A 7C               4      LD  A,H
000EAB DC0B C6D0             7      ADD A,0D0H
000EAD DC0D 47               4      LD  B,A
000EAE DC0E 5A               4      LD  E,D
000EAF DC0F 2100FF          10      LD  HL,KBUF
       DC12                     GETL2:
000EB2 DC12 CDD0EF          17      CALL    _SCRN
000EB5 DC15 03               6      INC BC
000EB6 DC16 77               7      LD  (HL),A
000EB7 DC17 23               6      INC HL
000EB8 DC18 1D               4      DEC E
000EB9 DC19 20F7            12      JR  NZ,GETL2
       DC1B                     GETL3:
000EBB DC1B 2B               6      DEC HL
000EBC DC1C 7E               7      LD  A,(HL)
000EBD DC1D FE21             7      CP  021H
000EBF DC1F D0              11      RET NC
000EC0 DC20 3600            10      LD  (HL),0
000EC2 DC22 15               4      DEC D
000EC3 DC23 20F6            12      JR  NZ,GETL3
000EC5 DC25 C9              10      RET
                                
       DC26                     INKEY:
000EC6 DC26 FB               4      EI
000EC7 DC27 E5              11      PUSH    HL
000EC8 DC28 2A90EF          16      LD  HL,(_KEYPS)
000ECB DC2B 7C               4      LD  A,H
000ECC DC2C AD               4      XOR L
000ECD DC2D 2809            12      JR  Z,INKEY1
000ECF DC2F 7C               4      LD  A,H
000ED0 DC30 3C               4      INC A
000ED1 DC31 3291EF          13      LD  (_KEYPS+1),A
000ED4 DC34 6F               4      LD  L,A
000ED5 DC35 26FE             7      LD  H,KEYBF/256
000ED7 DC37 7E               7      LD  A,(HL)
       DC38                     INKEY1:
000ED8 DC38 E1              10      POP HL
000ED9 DC39 B7               4      OR  A
000EDA DC3A C9              10      RET
                                
       DC3B                     INKEYB:
000EDB DC3B C1              10      POP BC
000EDC DC3C CB47             8      BIT 0,A
000EDE DC3E 3E08             7      LD  A,8
000EE0 DC40 2002            12      JR  NZ,INKEYD
000EE2 DC42 3E03             7      LD  A,3
       DC44                     INKEYD:
000EE4 DC44 B7               4      OR  A
000EE5 DC45 3292EF          13      LD  (_KEYD),A
000EE8 DC48 C9              10      RET
       DC49                     CHKEY:
000EE9 DC49 C5              11      PUSH    BC
000EEA DC4A 3E08             7      LD  A,8
000EEC DC4C CD20CF          17      CALL    RDKEYDATA
000EEF DC4F 3293EF          13      LD  (_KEYD+1),A
000EF2 DC52 CB7F             8      BIT 7,A
000EF4 DC54 28E5            12      JR  Z,INKEYB
000EF6 DC56 E5              11      PUSH    HL
000EF7 DC57 0E07             7      LD  C,7
000EF9 DC59 2140EC          10      LD  HL,KEY_TABLE
000EFC DC5C CB47             8      BIT 0,A
000EFE DC5E 2003            12      JR  NZ,CHKEY0
000F00 DC60 2180EC          10      LD  HL,SHIFT_TABLE
       DC63                     CHKEY0:
000F03 DC63 CB77             8      BIT 6,A
000F05 DC65 2003            12      JR  NZ,CHKEY1
000F07 DC67 21C0EC          10      LD  HL,CTRL_TABLE
       DC6A                     CHKEY1:
000F0A DC6A 79               4      LD  A,C
000F0B DC6B CD20CF          17      CALL    RDKEYDATA
000F0E DC6E 0608             7      LD  B,8
       DC70                     CHKEY2:
000F10 DC70 87               4      ADD A,A
000F11 DC71 3009            12      JR  NC,CHKEY3
000F13 DC73 23               6      INC HL
000F14 DC74 10FA            13      DJNZ    CHKEY2
000F16 DC76 0D               4      DEC C
000F17 DC77 79               4      LD  A,C
000F18 DC78 3C               4      INC A
000F19 DC79 20EF            12      JR  NZ,CHKEY1
000F1B DC7B 06                      DB  $06     ;LD B,?? 次の1バイトを飛ばす
       DC7C                     CHKEY3:
000F1C DC7C 7E               7      LD  A,(HL)
000F1D DC7D E1              10      POP HL
000F1E DC7E C1              10      POP BC
000F1F DC7F 18C3            12      JR  INKEYD
                                
       DC81                     SCRN:
000F21 DC81 E5              11      PUSH    HL
000F22 DC82 CD47CF          17      CALL    RDMMIO_BC
000F25 DC85 6F               4      LD  L,A
000F26 DC86 26EE             7      LD  H,DC_TABLE/256
000F28 DC88 7E               7      LD  A,(HL)
000F29 DC89 FE41             7      CP  'A'     ;英小文字チェック
000F2B DC8B 380E            12      JR  C,SCRN1
000F2D DC8D FE5B             7      CP  'Z'+1
000F2F DC8F DC9DDC          17      CALL    C,SCRNC
000F32 DC92 FEA6             7      CP  $A6     ;ひらがなチェック
000F34 DC94 3805            12      JR  C,SCRN1
000F36 DC96 FEE0             7      CP  $E0
000F38 DC98 DC9DDC          17      CALL    C,SCRNC
       DC9B                     SCRN1:
000F3B DC9B E1              10      POP HL
000F3C DC9C C9              10      RET
                                
       DC9D                     SCRNC:
000F3D DC9D 6F               4      LD  L,A
000F3E DC9E 60               4      LD  H,B
000F3F DC9F CBD8             8      SET 3,B
000F41 DCA1 CD47CF          17      CALL    RDMMIO_BC
000F44 DCA4 44               4      LD  B,H
000F45 DCA5 CB7F             8      BIT 7,A
000F47 DCA7 7D               4      LD  A,L
000F48 DCA8 C8              11      RET Z
000F49 DCA9 FE5B             7      CP  'Z'+1
000F4B DCAB 3804            12      JR  C,SCRNC_ADD
000F4D DCAD FEC0             7      CP  $C0
000F4F DCAF 3803            12      JR  C,SCRNC_SUB
       DCB1                     SCRNC_ADD:
000F51 DCB1 C620             7      ADD A,$20
000F53 DCB3 C9              10      RET
       DCB4                     SCRNC_SUB:
000F54 DCB4 D620             7      SUB $20
000F56 DCB6 C9              10      RET
[EOF:M7IO.ASM:SHIFT_JIS]
                                    INCLUDE "LDFILE.ASM"
                                
                                ;   LSX-Dodgers FILE
                                
       DCB7                     FILEC:
000F57 DCB7 CDC2DC          17      CALL    FILE
       DCBA                     FILEC2:
000F5A DCBA 3A15EF          13      LD  A,(FDRV+1)
000F5D DCBD FE20             7      CP  020H
000F5F DCBF C8              11      RET Z
000F60 DCC0 1839            12      JR  SETDIR1
                                
       DCC2                     FILE:
000F62 DCC2 AF               4      XOR A
000F63 DCC3 3214EF          13      LD  (FDRV),A
000F66 DCC6 67               4      LD  H,A
000F67 DCC7 6F               4      LD  L,A
000F68 DCC8 2222EF          16      LD  (FDRV+14),HL
000F6B DCCB CD99DD          17      CALL    SPCUT
000F6E DCCE CD7EDD          17      CALL    CCHK3
000F71 DCD1 2812            12      JR  Z,DEVI1
000F73 DCD3 13               6      INC DE
000F74 DCD4 1A               7      LD  A,(DE)
000F75 DCD5 1B               6      DEC DE
000F76 DCD6 FE3A             7      CP  ':'
000F78 DCD8 200B            12      JR  NZ,DEVI1
000F7A DCDA 1A               7      LD  A,(DE)      ;DRIVE
000F7B DCDB CDCEDF          17      CALL    CAP
000F7E DCDE D640             7      SUB '@'
000F80 DCE0 13               6      INC DE
000F81 DCE1 13               6      INC DE
000F82 DCE2 3214EF          13      LD  (FDRV),A
       DCE5                     DEVI1:
000F85 DCE5 1A               7      LD  A,(DE)
000F86 DCE6 D65C             7      SUB 05CH        ;\
000F88 DCE8 2009            12      JR  NZ,NOROOT
000F8A DCEA 6F               4      LD  L,A     ;A=0でH=0のはずなのでHL=0
000F8B DCEB 222EEF          16      LD  (FDRV+26),HL
000F8E DCEE 2C               4      INC L
000F8F DCEF 2222EF          16      LD  (FDRV+14),HL
000F92 DCF2 13               6      INC DE
       DCF3                     NOROOT:
                                
       DCF3                     SETDIR:
000F93 DCF3 CD1FDD          17      CALL    FILED
000F96 DCF6 1A               7      LD  A,(DE)
000F97 DCF7 FE5C             7      CP  05CH        ;\
000F99 DCF9 C0              11      RET NZ
000F9A DCFA 13               6      INC DE
       DCFB                     SETDIR1:
000F9B DCFB 3E10             7      LD  A,010H      ;Directory
000F9D DCFD 3221EF          13      LD  (FDRV+13),A
000FA0 DD00 D5              11      PUSH    DE
000FA1 DD01 1114EF          10      LD  DE,FDRV
000FA4 DD04 2A1EF0          16      LD  HL,(STABLE+2*00FH)
000FA7 DD07 CD0F00          17      CALL    JP_HL
000FAA DD0A D1              10      POP DE
000FAB DD0B B7               4      OR  A
000FAC DD0C C0              11      RET NZ
                                
000FAD DD0D 3A21EF          13      LD  A,(FDRV+13)
000FB0 DD10 CB67             8      BIT 4,A
000FB2 DD12 C8              11      RET Z
                                
000FB3 DD13 CD66DD          17      CALL    FILEI
000FB6 DD16 2A2EEF          16      LD  HL,(FDRV+26)
000FB9 DD19 23               6      INC HL
000FBA DD1A 2222EF          16      LD  (FDRV+14),HL
000FBD DD1D 18D4            12      JR  SETDIR
                                
       DD1F                     FILED:
000FBF DD1F CD66DD          17      CALL    FILEI
000FC2 DD22 2115EF          10      LD  HL,FNAME
                                
000FC5 DD25 0608             7      LD  B,8
       DD27                     FILE2:
000FC7 DD27 CD73DD          17      CALL    CCHKF
000FCA DD2A C8              11      RET Z
000FCB DD2B FE2A             7      CP  '*'
000FCD DD2D 282E            12      JR  Z,FILE9
000FCF DD2F FE2E             7      CP  '.'
000FD1 DD31 280C            12      JR  Z,FILE4
000FD3 DD33 77               7      LD  (HL),A
000FD4 DD34 23               6      INC HL
000FD5 DD35 10F0            13      DJNZ    FILE2
                                
       DD37                     FILE3:
000FD7 DD37 CD73DD          17      CALL    CCHKF
000FDA DD3A C8              11      RET Z
000FDB DD3B FE2E             7      CP  '.'
000FDD DD3D 20F8            12      JR  NZ,FILE3
                                
       DD3F                     FILE4:
000FDF DD3F 211DEF          10      LD  HL,FNAME+8
000FE2 DD42 0603             7      LD  B,3
                                
       DD44                     FILE4L:
000FE4 DD44 CD73DD          17      CALL    CCHKF
000FE7 DD47 C8              11      RET Z
000FE8 DD48 FE2E             7      CP  '.'
000FEA DD4A 2008            12      JR  NZ,FILE12
000FEC DD4C 3215EF          13      LD  (FNAME),A   ;Parent directory(..)
000FEF DD4F 3216EF          13      LD  (FNAME+1),A
000FF2 DD52 3E20             7      LD  A,020H
       DD54                     FILE12:
000FF4 DD54 FE2A             7      CP  '*'
000FF6 DD56 280A            12      JR  Z,FILE10
000FF8 DD58 77               7      LD  (HL),A
000FF9 DD59 23               6      INC HL
000FFA DD5A 10E8            13      DJNZ    FILE4L
000FFC DD5C C9              10      RET
                                
       DD5D                     FILE9:              ;名前の*処理、名前の残りを?で埋める
000FFD DD5D CD62DD          17      CALL    FILE10
001000 DD60 18D5            12      JR  FILE3
                                
       DD62                     FILE10:
001002 DD62 3E3F             7      LD  A,'?'
001004 DD64 1808            12      JR  FILL_MEMORY
       DD66                     FILEI:              ;名前＋拡張子をスペースで初期化
001006 DD66 3E20             7      LD  A,020H
001008 DD68 01000B          10      LD  BC,11*256   ;C=0にしておく
00100B DD6B 2115EF          10      LD  HL,FNAME
       DD6E                     FILL_MEMORY:            ;HLからBバイトAで埋める
00100E DD6E 77               7      LD  (HL),A
00100F DD6F 23               6      INC HL
001010 DD70 10FC            13      DJNZ    FILL_MEMORY
001012 DD72 C9              10      RET
                                
       DD73                     CCHKF:
001013 DD73 1A               7      LD  A,(DE)
001014 DD74 CD7BDD          17      CALL    CCHK2
001017 DD77 C8              11      RET Z
001018 DD78 C3E6E0          10      JP  FKAN
                                
       DD7B                     CCHK2:
00101B DD7B 0C               4      INC C
00101C DD7C 0D               4      DEC C
00101D DD7D C0              11      RET NZ
       DD7E                     CCHK3:              ;ZF=1 で使えない文字
00101E DD7E FE2B             7      CP  '+'
001020 DD80 C8              11      RET Z
001021 DD81 FE2C             7      CP  ','
001023 DD83 C8              11      RET Z
001024 DD84 FE2F             7      CP  '/'
001026 DD86 C8              11      RET Z
001027 DD87 FE3A             7      CP  ':'
001029 DD89 C8              11      RET Z
00102A DD8A FE3B             7      CP  ';'
00102C DD8C C8              11      RET Z
00102D DD8D FE3D             7      CP  '='
00102F DD8F C8              11      RET Z
001030 DD90 FE5C             7      CP  05CH    ;\
001032 DD92 C8              11      RET Z
001033 DD93 FE20             7      CP  020H
001035 DD95 D0              11      RET NC
001036 DD96 BF               4      CP  A       ;Z=1
001037 DD97 C9              10      RET
                                
       DD98                     SS1:
001038 DD98 13               6      INC DE
       DD99                     SPCUT:              ;スペースをカット
001039 DD99 1A               7      LD  A,(DE)
00103A DD9A FE20             7      CP  020H
00103C DD9C 28FA            12      JR  Z,SS1
00103E DD9E C9              10      RET
                                
       DD9F                     SETDRVF:
00103F DD9F 1114EF          10      LD  DE,FDRV
       DDA2                     SETDRV0:
001042 DDA2 CDABDD          17      CALL    SETDRV
001045 DDA5 FDE1            14      POP IY
001047 DDA7 C1              10      POP BC
001048 DDA8 D1              10      POP DE
001049 DDA9 E1              10      POP HL
00104A DDAA C9              10      RET
                                
       DDAB                     SETDRV:
00104B DDAB E3              19      EX  (SP),HL     ;HL=RETRN ADDRESS
00104C DDAC D5              11      PUSH    DE      ;PUSH HL/DE/BC/IY
00104D DDAD C5              11      PUSH    BC
00104E DDAE 1A               7      LD  A,(DE)
00104F DDAF D5              11      PUSH    DE
001050 DDB0 FDE3            23      EX  (SP),IY
                                
001052 DDB2 CDBEDD          17      CALL    GETDRV
001055 DDB5 3C               4      INC A
001056 DDB6 FD7700          19      LD  (IY+0),A    ;(FCB)ドライブ番号
001059 DDB9 3D               4      DEC A
00105A DDBA CDD9EF          17      CALL    _CHGDRV
                                
00105D DDBD E9               4      JP  (HL)
                                
       DDBE                     GETDRV:
00105E DDBE E67F             7      AND 07FH
001060 DDC0 D601             7      SUB 001H
001062 DDC2 3003            12      JR  NC,GETDRV1
001064 DDC4 3A87EF          13      LD  A,(_DVSW)   ;Current Drive
       DDC7                     GETDRV1:
001067 DDC7 3288EF          13      LD  (_DRV),A
00106A DDCA C9              10      RET
                                
       DDCB                     SOPENX:
00106B DDCB 1139EF          10      LD  DE,SFILE
00106E DDCE 1A               7      LD  A,(DE)
00106F DDCF FDBE00           7      CP  (IY+0)      ;(FCB)ドライブ番号
001072 DDD2 2024            12      JR  NZ,SOPEN
001074 DDD4 13               6      INC DE
001075 DDD5 FDE5            15      PUSH    IY
001077 DDD7 E1              10      POP HL
001078 DDD8 23               6      INC HL
001079 DDD9 CD66DF          17      CALL    CPFILE
00107C DDDC 201A            12      JR  NZ,SOPEN
                                
00107E DDDE 2AF4F0          16      LD  HL,(SCDIR)
001081 DDE1 FD750E          19      LD  (IY+14),L   ;(FCB)アクセスするディレクトリのクラスタ番号+1
001084 DDE4 FD740F          19      LD  (IY+15),H
                                
001087 DDE7 2AF8F0          16      LD  HL,(SFNDF)  ;Direcroty location and Flags
00108A DDEA 229FEF          16      LD  (_FILEN),HL
                                
00108D DDED ED5BF6F0        20      LD  DE,(SFBPS)
001091 DDF1 2139EF          10      LD  HL,SFILE
001094 DDF4 36FF            10      LD  (HL),0FFH
001096 DDF6 23               6      INC HL
001097 DDF7 C9              10      RET
       DDF8                     SOPEN:
001098 DDF8 210EDF          10      LD  HL,FILESE
       DDFB                     SOPENC:
00109B DDFB 2234DE          16      LD  (OPENPAT+1),HL
                                
00109E DDFE CDE2EF          17      CALL    _RDFATX     ;Detect Media
0010A1 DE01 3856            12      JR  C,RDDERR
                                
0010A3 DE03 AF               4      XOR A
0010A4 DE04 329FEF          13      LD  (_FILEN),A
0010A7 DE07 CD13E0          17      CALL    LDDIRX1     ;A=0で呼び出す
0010AA DE0A 2818            12      JR  Z,SDIRX1
                                
0010AC DE0C CDFFDE          17      CALL    READ_DIR    ;Sub Directory
0010AF DE0F 3808            12      JR  C,SDIRX0
0010B1 DE11 2A7EF0          16      LD  HL,(_DTBUF)
0010B4 DE14 7E               7      LD  A,(HL)
0010B5 DE15 FE2E             7      CP  '.'
0010B7 DE17 280F            12      JR  Z,SOPEN1
       DE19                     SDIRX0:
0010B9 DE19 AF               4      XOR A
0010BA DE1A 32A0EF          13      LD  (_DIRF),A
0010BD DE1D FD360E01        19      LD  (IY+14),1   ;(FCB)レコードサイズ
0010C1 DE21 FD770F          19      LD  (IY+15),A
       DE24                     SDIRX1:
0010C4 DE24 ED5BFCF0        20      LD  DE,(_DIRPS) ;Root Directory
       DE28                     SOPEN1:
0010C8 DE28 0E20             7  SDECPAT:LD  C,32        ;自己書き換え 1セクタ辺りのディレクトリエントリ数  1024=32 / 512=16 / 256=8
       DE2A                     SOPEN1X:
0010CA DE2A CDFFDE          17      CALL    READ_DIR    ;FILE SEARCH
0010CD DE2D 382A            12      JR  C,RDDERR
0010CF DE2F 2A7EF0          16      LD  HL,(_DTBUF)
       DE32                     SOPEN2:
0010D2 DE32 D5              11      PUSH    DE
0010D3 DE33 CD0EDF          17  OPENPAT:CALL    FILESE      ;(self-modifying code)
0010D6 DE36 D1              10      POP DE
0010D7 DE37 386E            12      JR  C,SOPENE
0010D9 DE39 281B            12      JR  Z,SCF_FF_RET
       DE3B                     SOPEN3:
0010DB DE3B 3AA0EF          13      LD  A,(_DIRF)   ;ディレクトリか判別
0010DE DE3E B7               4      OR  A
0010DF DE3F 200C            12      JR  NZ,SOPEN5
0010E1 DE41 13               6      INC DE      ;ルートディレクトリ
0010E2 DE42 E5              11      PUSH    HL
0010E3 DE43 210C00          10  MD_PAT: LD  HL,12       ;(self-modifying code)MAXDIR
0010E6 DE46 ED52            15      SBC HL,DE       ;CF=0 なので SUB HL,DE
0010E8 DE48 E1              10      POP HL
0010E9 DE49 20DD            12      JR  NZ,SOPEN1
0010EB DE4B 1807            12      JR  SOPEN6
       DE4D                     SOPEN5:
0010ED DE4D CD42E7          17      CALL    GNCLX       ;END DIR
0010F0 DE50 D8              11      RET C
0010F1 DE51 CDC6DF          17      CALL    ENDCL
       DE54                     SOPEN6:
0010F4 DE54 38D2            12      JR  C,SOPEN1
       DE56                     SCF_FF_RET:
0010F6 DE56 37               4      SCF         ;CF=1
0010F7 DE57 9F               4      SBC A,A     ;A=0FFH
0010F8 DE58 C9              10      RET
                                
       DE59                     RDDERR:
0010F9 DE59 BF               4      CP  A       ;READ ERR CF=1 ZF=1
0010FA DE5A 37               4      SCF
0010FB DE5B C9              10      RET
                                
       DE5C                     NOPEN:
0010FC DE5C 210EDF          10      LD  HL,FILESE
0010FF DE5F 2234DE          16      LD  (OPENPAT+1),HL
001102 DE62 FD2A98EF        20      LD  IY,(_FCB)
001106 DE66 CDF9E0          17      CALL    CHKWILDX
001109 DE69 30EB            12      JR  NC,SCF_FF_RET
00110B DE6B FD7E00          19      LD  A,(IY+0)    ;(FCB)ドライブ番号
00110E DE6E 3D               4      DEC A
00110F DE6F 3288EF          13      LD  (_DRV),A
001112 DE72 CDD9EF          17      CALL    _CHGDRV
001115 DE75 D8              11      RET C
001116 DE76 2AF8F0          16      LD  HL,(SFNDF)  ;Direcroty location and Flags
001119 DE79 229FEF          16      LD  (_FILEN),HL
                                
00111C DE7C CD0EE0          17      CALL    LDDIRX
00111F DE7F ED5B9AEF        20      LD  DE,(_FBPS)
001123 DE83 CDFFDE          17      CALL    READ_DIR
001126 DE86 38D1            12      JR  C,RDDERR
001128 DE88 3A9EEF          13      LD  A,(_FBCNT)
00112B DE8B 3D               4      DEC A
00112C DE8C 28AD            12      JR  Z,SOPEN3
       DE8E                     NOPEN2:
00112E DE8E 2A9CEF          16      LD  HL,(_FBAD)
001131 DE91 012000          10      LD  BC,020H
001134 DE94 09              11      ADD HL,BC
001135 DE95 4F               4      LD  C,A
001136 DE96 189A            12      JR  SOPEN2
                                
       DE98                     SOPENE2:
001138 DE98 229CEF          16      LD  (_FBAD),HL
00113B DE9B 79               4      LD  A,C
00113C DE9C 329EEF          13      LD  (_FBCNT),A
00113F DE9F ED539AEF        20      LD  (_FBPS),DE
001143 DEA3 FD2298EF        20      LD  (_FCB),IY
       DEA7                     SOPENE:
001147 DEA7 AF               4      XOR A
001148 DEA8 C9              10      RET
                                
       DEA9                     COPEN:
001149 DEA9 FD360D20        19      LD  (IY+13),020H    ;(FCB)属性(アトリビュート)
                                
00114D DEAD 212BDF          10      LD  HL,NEXTSE
001150 DEB0 CDFBDD          17      CALL    SOPENC
001153 DEB3 D0              11      RET NC
001154 DEB4 C8              11      RET Z
001155 DEB5 3AA0EF          13      LD  A,(_DIRF)   ;ディレクトリか判別
001158 DEB8 B7               4      OR  A
001159 DEB9 37               4      SCF
00115A DEBA C8              11      RET Z       ;ルートディレクトリ
00115B DEBB 0601             7      LD  B,1
00115D DEBD CD57E1          17      CALL    WRDF
001160 DEC0 D8              11      RET C
001161 DEC1 ED5BFEF0        20      LD  DE,(_CLPS)
001165 DEC5 D5              11      PUSH    DE
001166 DEC6 CD8FDF          17      CALL    DCPAT
001169 DEC9 CDCDE5          17      CALL    DRDNX
00116C DECC 2A7EF0          16      LD  HL,(_DTBUF) ;ディレクトリエントリを0クリア
00116F DECF 3ACBE4          13      LD  A,(SECSZ+2) ;1024=4 / 512=2 / 256=1
001172 DED2 47               4      LD  B,A
001173 DED3 AF               4      XOR A
001174 DED4 4F               4      LD  C,A
       DED5                     COPENCL:
001175 DED5 77               7      LD  (HL),A
001176 DED6 EDA1            16      CPI         ;HL=HL+1 BC=BC-1 BCが0の場合にP/V=0
001178 DED8 EAD5DE          10      JP  PE,COPENCL
                                
00117B DEDB 3AADDF          13      LD  A,(SPCPAT+1)    ;1クラスタの論理セクタ数
00117E DEDE 3D               4      DEC A
00117F DEDF 2819            12      JR  Z,COPENE
001181 DEE1 3E01             7      LD  A,1     ;1セクタ辺りのセクタ数が2以上の場合
001183 DEE3 323AE7          13      LD  (_SECPS+1),A
001186 DEE6 D1              10      POP DE      ;DE=(_CLPS)
001187 DEE7 D5              11      PUSH    DE
       DEE8                     COPEN1:
001188 DEE8 D5              11      PUSH    DE      ;データバッファに入らないセクタもゼロクリア
001189 DEE9 C5              11      PUSH    BC
00118A DEEA 2A7EF0          16      LD  HL,(_DTBUF)
00118D DEED CDA9DF          17      CALL    CLUSTX
001190 DEF0 CDA5E8          17      CALL    DWT24
001193 DEF3 C1              10      POP BC
001194 DEF4 D1              10      POP DE
001195 DEF5 CD39E7          17      CALL    NEXTX
001198 DEF8 20EE            12      JR  NZ,COPEN1
       DEFA                     COPENE:
00119A DEFA 2A7EF0          16      LD  HL,(_DTBUF)
00119D DEFD D1              10      POP DE
00119E DEFE C9              10      RET
                                
       DEFF                     READ_DIR:
00119F DEFF ED53FEF0        20      LD  (_CLPS),DE
0011A3 DF03 C5              11      PUSH    BC
0011A4 DF04 D5              11      PUSH    DE
0011A5 DF05 CD8FDF          17      CALL    DCPAT
0011A8 DF08 CDADE5          17      CALL    DRDX
0011AB DF0B D1              10      POP DE
0011AC DF0C C1              10      POP BC
0011AD DF0D C9              10      RET
                                
       DF0E                     FILESE:
0011AE DF0E 7E               7      LD  A,(HL)
0011AF DF0F B7               4      OR  A
0011B0 DF10 C8              11      RET Z       ;END:ZF=1 CF=0
0011B1 DF11 FEE5             7      CP  0E5H
0011B3 DF13 280E            12      JR  Z,FILESE1
0011B5 DF15 FDE5            15      PUSH    IY
0011B7 DF17 D1              10      POP DE
0011B8 DF18 13               6      INC DE
0011B9 DF19 E5              11      PUSH    HL
0011BA DF1A CD66DF          17      CALL    CPFILE
0011BD DF1D CC87DF          17      CALL    Z,CPFILE2
0011C0 DF20 E1              10      POP HL
0011C1 DF21 37               4      SCF
0011C2 DF22 C8              11      RET Z       ;!!!:(ZF=1) CF=1
       DF23                     FILESE1:
0011C3 DF23 CD3ADF          17      CALL    FNEXT
0011C6 DF26 20E6            12      JR  NZ,FILESE
       DF28                     ZF0_CF0_AFF_RET:
0011C8 DF28 F6FF             7      OR  0FFH        ;ZF=0 CF=0
0011CA DF2A C9              10      RET
                                
       DF2B                     NEXTSE:
0011CB DF2B 7E               7      LD  A,(HL)
0011CC DF2C B7               4      OR  A
0011CD DF2D 37               4      SCF
0011CE DF2E C8              11      RET Z       ;!!!:ZF=1 CF=1
0011CF DF2F FEE5             7      CP  0E5H
0011D1 DF31 37               4      SCF
0011D2 DF32 C8              11      RET Z       ;!!!:(ZF=1) CF=1
0011D3 DF33 CD3ADF          17      CALL    FNEXT
0011D6 DF36 20F3            12      JR  NZ,NEXTSE
0011D8 DF38 18EE            12      JR  ZF0_CF0_AFF_RET
                                
       DF3A                     FNEXT:
0011DA DF3A E5              11      PUSH    HL
0011DB DF3B 219FEF          10      LD  HL,_FILEN
0011DE DF3E 34              11      INC (HL)
0011DF DF3F E1              10      POP HL
0011E0 DF40 112000          10      LD  DE,020H
0011E3 DF43 19              11      ADD HL,DE
0011E4 DF44 0D               4      DEC C
0011E5 DF45 C9              10      RET
                                
       DF46                     CPNAME:
0011E6 DF46 C5              11      PUSH    BC
0011E7 DF47 D5              11      PUSH    DE
0011E8 DF48 E5              11      PUSH    HL
0011E9 DF49 CD60DF          17      CALL    CPFILE4
0011EC DF4C E1              10      POP HL
0011ED DF4D 23               6      INC HL
0011EE DF4E 23               6      INC HL
0011EF DF4F 23               6      INC HL
0011F0 DF50 23               6      INC HL
0011F1 DF51 D1              10      POP DE
0011F2 DF52 C1              10      POP BC
0011F3 DF53 2005            12      JR  NZ,CPNAME1
0011F5 DF55 7E               7      LD  A,(HL)
0011F6 DF56 23               6      INC HL
0011F7 DF57 66               7      LD  H,(HL)
0011F8 DF58 6F               4      LD  L,A
0011F9 DF59 C9              10      RET
       DF5A                     CPNAME1:
0011FA DF5A 23               6      INC HL
0011FB DF5B 23               6      INC HL
0011FC DF5C 10E8            13      DJNZ    CPNAME
0011FE DF5E 37               4      SCF
0011FF DF5F C9              10      RET
                                
       DF60                     CPFILE4:
001200 DF60 C5              11      PUSH    BC
001201 DF61 010004          10      LD  BC,00400H
001204 DF64 1804            12      JR  CPSTR1
       DF66                     CPFILE:
001206 DF66 C5              11      PUSH    BC
001207 DF67 01000B          10      LD  BC,00B00H
       DF6A                     CPSTR1:
00120A DF6A 1A               7      LD  A,(DE)
00120B DF6B FE3F             7      CP  '?'     ;Wild card
00120D DF6D 2812            12      JR  Z,CPSTR2
00120F DF6F 7E               7      LD  A,(HL)
001210 DF70 CDDFE0          17      CALL    FKANC
001213 DF73 E5              11      PUSH    HL
001214 DF74 67               4      LD  H,A
001215 DF75 1A               7      LD  A,(DE)
001216 DF76 CB01             4      RLC C
001218 DF78 CDDFE0          17      CALL    FKANC
00121B DF7B CB09             4      RRC C
00121D DF7D BC               4      CP  H       ;CP (HL),(DE)
00121E DF7E E1              10      POP HL
00121F DF7F 2004            12      JR  NZ,CPSTR3
       DF81                     CPSTR2:
001221 DF81 13               6      INC DE
001222 DF82 23               6      INC HL
001223 DF83 10E5            13      DJNZ    CPSTR1
       DF85                     CPSTR3:
001225 DF85 C1              10      POP BC
001226 DF86 C9              10      RET
                                
       DF87                     CPFILE2:
001227 DF87 FD7E0D          19      LD  A,(IY+13)   ;(FCB)属性(アトリビュート)
00122A DF8A F6E1             7      OR  0E1H
00122C DF8C 2F               4      CPL
00122D DF8D A6               7      AND (HL)
00122E DF8E C9              10      RET
                                
       DF8F                     DCPAT:
00122F DF8F 0E00             7      LD  C,0
001231 DF91 2A7EF0          16      LD  HL,(_DTBUF)
001234 DF94 3AA0EF          13      LD  A,(_DIRF)   ;ディレクトリか判別
001237 DF97 B7               4      OR  A
001238 DF98 C8              11      RET Z       ;ルートディレクトリの場合はCレジスタを0にしておく(CDEがセクタ番号)
001239 DF99 3AADDF          13      LD  A,(SPCPAT+1)
00123C DF9C 4F               4      LD  C,A
00123D DF9D 3A3AE7          13      LD  A,(_SECPS+1)
001240 DFA0 B9               4      CP  C
001241 DFA1 3801            12      JR  C,DC1
001243 DFA3 AF               4      XOR A
       DFA4                     DC1:
001244 DFA4 F680             7      OR  080H
001246 DFA6 32A0EF          13      LD  (_DIRF),A   ;bit0-6:セクタインデックス
       DFA9                     CLUSTX:
001249 DFA9 E5              11      PUSH    HL
00124A DFAA EB               4      EX  DE,HL
00124B DFAB AF               4      XOR A
00124C DFAC 0E01             7  SPCPAT: LD  C,1     ;自己書き換え（1クラスタの論理セクタ数）
       DFAE                     L_CLDBL:
00124E DFAE CB19             8      RR  C       ;->CF
001250 DFB0 3804            12      JR  C,E_CLDBL
001252 DFB2 29              11      ADD HL,HL       ;*2
001253 DFB3 8F               4      ADC A,A
001254 DFB4 18F8            12      JR  L_CLDBL
       DFB6                     E_CLDBL:
001256 DFB6 4F               4      LD  C,A
001257 DFB7 3A3AE7          13      LD  A,(_SECPS+1)
00125A DFBA B5               4      OR  L
00125B DFBB 6F               4      LD  L,A
00125C DFBC 110800          10  CLSPAT: LD  DE,8    ;+8 (2D)  !ADDCL (self-modifying code)
00125F DFBF AF               4      XOR A
001260 DFC0 19              11      ADD HL,DE   ;データ格納領域の先頭論理セクタ番号
001261 DFC1 89               4      ADC A,C
001262 DFC2 4F               4      LD  C,A
001263 DFC3 EB               4      EX  DE,HL
001264 DFC4 E1              10      POP HL
001265 DFC5 C9              10      RET
                                
       DFC6                     ENDCL:
001266 DFC6 7A               4      LD  A,D ;END CLUSTER
001267 DFC7 FE01             7  CLPAT1: CP  1   ;164=356    (self-modifying code)
001269 DFC9 C0              11      RET NZ
00126A DFCA 7B               4      LD  A,E
00126B DFCB FE64             7  CLPAT2: CP  064H    ;       (self-modifying code)
00126D DFCD C9              10      RET
                                
       DFCE                     CAP:
00126E DFCE FE61             7      CP  'a'
001270 DFD0 D8              11      RET C
001271 DFD1 FE7B             7      CP  'z'+1
001273 DFD3 D0              11      RET NC
001274 DFD4 D620             7      SUB 020H
001276 DFD6 C9              10      RET
       DFD7                     CAP2:
001277 DFD7 CDCEDF          17      CALL    CAP
       DFDA                     CAP3:
00127A DFDA CDE3DF          17      CALL    CAP4
00127D DFDD FE21             7      CP  021H
00127F DFDF D0              11      RET NC
001280 DFE0 3EA0             7      LD  A,0A0H
001282 DFE2 C9              10      RET
       DFE3                     CAP4:
001283 DFE3 FE05             7      CP  5
001285 DFE5 C0              11      RET NZ
001286 DFE6 3EE5             7      LD  A,0E5H
001288 DFE8 C9              10      RET
                                
       DFE9                     CHDIR:
001289 DFE9 CDD3E9          17      CALL    GETDPBD
00128C DFEC 381D            12      JR  C,CHDIR2
00128E DFEE DD751A          19      LD  (IX+01AH),L     ;_SDIR_
001291 DFF1 DD741B          19      LD  (IX+01BH),H     ;_SDIR_+1
001294 DFF4 1815            12      JR  CHDIR2      ;POP_IX_RET
                                
       DFF6                     LDDIR:
001296 DFF6 CDD3E9          17      CALL    GETDPBD
001299 DFF9 DD5E1A          19      LD  E,(IX+01AH)     ;_SDIR_
00129C DFFC DD561B          19      LD  D,(IX+01BH)     ;_SDIR_+1
00129F DFFF 13               6      INC DE
0012A0 E000 FD730E          19      LD  (IY+14),E   ;(FCB)アクセスするディレクトリのクラスタ番号+1
0012A3 E003 FD720F          19      LD  (IY+15),D
0012A6 E006 1B               6      DEC DE
0012A7 E007 AF               4      XOR A
0012A8 E008 32A0EF          13      LD  (_DIRF),A
       E00B                     CHDIR2:
0012AB E00B DDE1            14      POP IX
0012AD E00D C9              10      RET
                                
       E00E                     LDDIRX:
0012AE E00E 3AA0EF          13      LD  A,(_DIRF)   ;(FCB)アクセスするディレクトリのセクタインデックス
0012B1 E011 E67F             7      AND 07FH
       E013                     LDDIRX1:
0012B3 E013 323AE7          13      LD  (_SECPS+1),A
0012B6 E016 FD5E0E          19      LD  E,(IY+14)   ;(FCB)アクセスするディレクトリのクラスタ番号+1
0012B9 E019 FD560F          19      LD  D,(IY+15)
0012BC E01C 1B               6      DEC DE
0012BD E01D CDC6DF          17      CALL    ENDCL
0012C0 E020 D4F6DF          17      CALL    NC,LDDIR
       E023                     LDDIRS:
0012C3 E023 7A               4      LD  A,D
0012C4 E024 B3               4      OR  E
0012C5 E025 32A0EF          13      LD  (_DIRF),A   ;ディレクトリか判別
0012C8 E028 C9              10      RET
                                
       E029                     KILL:
0012C9 E029 CDF9E0          17      CALL    CHKWILDX
0012CC E02C 3834            12      JR  C,KILLW
0012CE E02E CDCBDD          17      CALL    SOPENX
       E031                     KILLS:
0012D1 E031 3E1F             7      LD  A,01FH
0012D3 E033 D475E0          17      CALL    NC,CHKATT
0012D6 E036 D8              11      RET C
       E037                     KILLSX:
0012D7 E037 36E5            10      LD  (HL),0E5H   ;DIR
0012D9 E039 CDD3E0          17      CALL    WTDB
0012DC E03C 111A00          10      LD  DE,01AH
0012DF E03F 19              11      ADD HL,DE
0012E0 E040 5E               7      LD  E,(HL)
0012E1 E041 23               6      INC HL
0012E2 E042 56               7      LD  D,(HL)
       E043                     KILLS1:
0012E3 E043 CDC6DF          17      CALL    ENDCL
0012E6 E046 D0              11      RET NC      ;CF=0
0012E7 E047 21FEFF          10      LD  HL,0-2
0012EA E04A 19              11      ADD HL,DE
0012EB E04B D0              11      RET NC      ;DE= 0 or 1
0012EC E04C D5              11      PUSH    DE
0012ED E04D CDF7EF          17      CALL    _GNCL
0012F0 E050 ED53FEF0        20      LD  (_CLPS),DE
0012F4 E054 D1              10      POP DE
0012F5 E055 210000          10      LD  HL,0
0012F8 E058 D4FAEF          17      CALL    NC,_SNCL
0012FB E05B D8              11      RET C
0012FC E05C ED5BFEF0        20      LD  DE,(_CLPS)  ;FAT
001300 E060 18E1            12      JR  KILLS1
                                
       E062                     KILLW:
001302 E062 CDF8DD          17      CALL    SOPEN
       E065                     KILLW1:
001305 E065 380B            12      JR  C,KILLW2
001307 E067 CD98DE          17      CALL    SOPENE2
00130A E06A CD31E0          17      CALL    KILLS
00130D E06D CD5CDE          17      CALL    NOPEN
001310 E070 18F3            12      JR  KILLW1
       E072                     KILLW2:
001312 E072 C8              11      RET Z
001313 E073 3F               4      CCF
001314 E074 C9              10      RET
                                
       E075                     CHKATT:
001315 E075 E5              11      PUSH    HL
001316 E076 110B00          10      LD  DE,00BH
001319 E079 19              11      ADD HL,DE
00131A E07A A6               7      AND (HL)
00131B E07B E1              10      POP HL
00131C E07C C8              11      RET Z
00131D E07D 37               4      SCF
00131E E07E C9              10      RET
                                
       E07F                     NAME:
00131F E07F CDF9E0          17      CALL    CHKWILDX
001322 E082 D8              11      RET C
001323 E083 110400          10      LD  DE,4
001326 E086 19              11      ADD HL,DE
001327 E087 229FE0          16      LD  (NAMEP+2),HL
00132A E08A 23               6      INC HL
00132B E08B CDFDE0          17      CALL    CHKWILD
00132E E08E D8              11      RET C
                                
00132F E08F CDCBDD          17      CALL    SOPENX
001332 E092 3E0F             7      LD  A,00FH
001334 E094 D475E0          17      CALL    NC,CHKATT
001337 E097 D8              11      RET C
                                
001338 E098 FD7E00          19      LD  A,(IY+0)
00133B E09B FDE5            15      PUSH    IY
00133D E09D FD210000        14  NAMEP:  LD  IY,0        ;自己書き換え
001341 E0A1 FD7700          19      LD  (IY+0),A
001344 E0A4 CDCBDD          17      CALL    SOPENX
001347 E0A7 FDE3            23      EX  (SP),IY
001349 E0A9 3F               4      CCF
00134A E0AA D4F8DD          17      CALL    NC,SOPEN
00134D E0AD EB               4      EX  DE,HL
00134E E0AE E1              10      POP HL
00134F E0AF D8              11      RET C
                                
       E0B0                     SETNAME:
001350 E0B0 01000B          10      LD  BC,11*256
001353 E0B3 23               6      INC HL
001354 E0B4 7E               7      LD  A,(HL)
001355 E0B5 FEE5             7      CP  0E5H
001357 E0B7 2004            12      JR  NZ,SNAME1
001359 E0B9 3E05             7      LD  A,5
00135B E0BB 180E            12      JR  SNAME3
       E0BD                     SNAME1:
00135D E0BD 7E               7      LD  A,(HL)
00135E E0BE 0C               4      INC C
00135F E0BF 0D               4      DEC C
001360 E0C0 2009            12      JR  NZ,SNAME3
001362 E0C2 CDCEDF          17      CALL    CAP
001365 E0C5 FEA0             7      CP  0A0H
001367 E0C7 2002            12      JR  NZ,SNAME3
001369 E0C9 3E20             7      LD  A,020H
       E0CB                     SNAME3:
00136B E0CB 12               7      LD  (DE),A
00136C E0CC 7E               7      LD  A,(HL)
00136D E0CD 23               6      INC HL
00136E E0CE CDE6E0          17      CALL    FKAN
001371 E0D1 10EA            13      DJNZ    SNAME1
       E0D3                     WTDB:
001373 E0D3 3EFF             7      LD  A,0FFH
001375 E0D5 3239EF          13      LD  (SFILE),A
       E0D8                     SWTDBF:
001378 E0D8 3E01             7      LD  A,1
00137A E0DA 32A4EF          13      LD  (_WTDBF),A
00137D E0DD AF               4      XOR A
00137E E0DE C9              10      RET
                                
       E0DF                     FKANC:
00137F E0DF CB41             8      BIT 0,C
001381 E0E1 CCD7DF          17      CALL    Z,CAP2
001384 E0E4 1801            12      JR  FKANX
       E0E6                     FKAN:           ;漢字チェック
001386 E0E6 13               6      INC DE
       E0E7                     FKANX:
001387 E0E7 CB41             8      BIT 0,C
001389 E0E9 CB81             8      RES 0,C
00138B E0EB C0              11      RET NZ
00138C E0EC FE80             7      CP  080H
00138E E0EE D8              11      RET C
00138F E0EF FEA0             7      CP  0A0H
001391 E0F1 3803            12      JR  C,FKAN1
001393 E0F3 FEE0             7      CP  0E0H
001395 E0F5 D8              11      RET C
       E0F6                     FKAN1:
001396 E0F6 0C               4      INC C
001397 E0F7 A7               4      AND A
001398 E0F8 C9              10      RET
                                
       E0F9                     CHKWILDX:
001399 E0F9 FDE5            15      PUSH    IY
00139B E0FB E1              10      POP HL
00139C E0FC 23               6      INC HL
       E0FD                     CHKWILD:
00139D E0FD 060B             7      LD  B,11
00139F E0FF 3E3F             7      LD  A,'?'
       E101                     CHKWIL1:
0013A1 E101 BE               7      CP  (HL)
0013A2 E102 23               6      INC HL
0013A3 E103 37               4      SCF
0013A4 E104 C8              11      RET Z
0013A5 E105 10FA            13      DJNZ    CHKWIL1
0013A7 E107 AF               4      XOR A
0013A8 E108 C9              10      RET
                                
       E109                     SDIRENT:        ;IY=FCB HL=DIR
0013A9 E109 D5              11      PUSH    DE
0013AA E10A E5              11      PUSH    HL
0013AB E10B FDE5            15      PUSH    IY
0013AD E10D D1              10      POP DE
0013AE E10E EB               4      EX  DE,HL
0013AF E10F CDB0E0          17      CALL    SETNAME
                                ;               Attribute
0013B2 E112 FD7E0D          19      LD  A,(IY+13)   ;(FCB)属性(アトリビュート)
0013B5 E115 12               7      LD  (DE),A
0013B6 E116 13               6      INC DE
                                ;               Reserved
0013B7 E117 AF               4      XOR A
0013B8 E118 060A             7      LD  B,10
       E11A                     SDE1:
0013BA E11A 12               7      LD  (DE),A
0013BB E11B 13               6      INC DE
0013BC E11C 10FC            13      DJNZ    SDE1
                                                    ;(FCB)更新時刻
0013BE E11E 21EAF0          10      LD  HL,SDDATA       ;(FCB)更新年月日
0013C1 E121 060A             7      LD  B,SDDATAE-SDDATA    ;(FCB)ファイルの先頭クラスタ
       E123                     SDLOOP:                 ;(FCB)ファイルのサイズ(バイト単位)
0013C3 E123 7E               7      LD  A,(HL)
0013C4 E124 23               6      INC HL
0013C5 E125 322AE1          13      LD  (SDPAT+2),A
0013C8 E128 FD7E00          19  SDPAT:  LD  A,(IY+0)    ;LD A,(IY+A)
0013CB E12B 12               7      LD  (DE),A
0013CC E12C 13               6      INC DE
0013CD E12D 10F4            13      DJNZ    SDLOOP
                                
0013CF E12F AF               4      XOR A
0013D0 E130 E1              10      POP HL
0013D1 E131 D1              10      POP DE
0013D2 E132 C9              10      RET
                                
       E133                     WOPEN:
0013D3 E133 FD7E0D          19      LD  A,(IY+13)   ;(FCB)属性(アトリビュート)
0013D6 E136 E61F             7      AND 01FH
0013D8 E138 37               4      SCF
0013D9 E139 C0              11      RET NZ
0013DA E13A FD361CFE        19      LD  (IY+28),0FEH    ;(FCB)オープンモード
       E13E                     TOPEN2:
0013DE E13E AF               4      XOR A
       E13F                     TOPEN:              ;Initializes the time stamp
0013DF E13F FD3617FF        19      LD  (IY+23),0FFH    ;(FCB)更新時刻
0013E3 E143 C9              10      RET
                                
       E144                     WRDFX:
0013E4 E144 3AADDF          13      LD  A,(SPCPAT+1)    ;1クラスタの論理セクタ
       E147                     L_WRFX:
0013E7 E147 1F               4      RRA         ;->CF
0013E8 E148 3806            12      JR  C,E_WRFX
0013EA E14A CB39             8      SRL C
0013EC E14C CB1C             8      RR  H       ;CH=CH/2
0013EE E14E 18F7            12      JR  L_WRFX
       E150                     E_WRFX:
0013F0 E150 44               4      LD  B,H
0013F1 E151 04               4      INC B
0013F2 E152 3E37             7      LD  A,037H      ;SCF
0013F4 E154 32CAE5          13      LD  (DRDN1),A
                                
       E157                     WRDF:               ;Bクラスタ分FATを確保する
0013F7 E157 110200          10      LD  DE,2
0013FA E15A AF               4      XOR A
0013FB E15B 323AE7          13      LD  (_SECPS+1),A
       E15E                     WRDF1:
0013FE E15E C5              11      PUSH    BC
0013FF E15F D5              11      PUSH    DE
001400 E160 CDF7EF          17      CALL    _GNCL
001403 E163 381C            12      JR  C,WRDF3
001405 E165 7A               4      LD  A,D     ;空いているかチェック
001406 E166 B3               4      OR  E
001407 E167 2027            12      JR  NZ,WRDF4
001409 E169 E1              10      POP HL      ;HL=空いているクラスタ
00140A E16A E5              11      PUSH    HL
00140B E16B ED5BFEF0        20      LD  DE,(_CLPS)  ;DE=元の(_CLPS)
00140F E16F 22FEF0          16      LD  (_CLPS),HL
001412 E172 7A               4      LD  A,D     ;元の(_CLPS)が 0 か?
001413 E173 B3               4      OR  E
001414 E174 2008            12      JR  NZ,WRDF2
001416 E176 FD751A          19      LD  (IY+26),L   ;(FCB)ファイルの先頭クラスタ
001419 E179 FD741B          19      LD  (IY+27),H   ;元が空の場合はFCBにクラスタをセットする
00141C E17C 1803            12      JR  WRDF3
       E17E                     WRDF2:
00141E E17E CDFAEF          17      CALL    _SNCL
       E181                     WRDF3:
001421 E181 D1              10      POP DE
001422 E182 C1              10      POP BC
001423 E183 D8              11      RET C
001424 E184 100C            13      DJNZ    WRDF5       ;ここでループカウンタチェック
001426 E186 ED5BFEF0        20      LD  DE,(_CLPS)
00142A E18A 21FFFF          10      LD  HL,0FFFFH   ;FATエントリ終了(EOCマーク)
00142D E18D C3FAEF          10      JP  _SNCL
                                
       E190                     WRDF4:              ;DEクラスタが空じゃないので次に移動する
001430 E190 D1              10      POP DE
001431 E191 C1              10      POP BC
       E192                     WRDF5:
001432 E192 13               6      INC DE
001433 E193 CDC6DF          17      CALL    ENDCL
001436 E196 38C6            12      JR  C,WRDF1
001438 E198 37               4      SCF
001439 E199 C9              10      RET
                                
       E19A                     RWXR:
00143A E19A 3ACBE4          13      LD  A,(SECSZ+2) ;1024=4 / 512=2 / 256=1
       E19D                     L_RWX:
00143D E19D 1F               4      RRA     ;->CF
00143E E19E 3808            12      JR  C,E_RWX
001440 E1A0 CB38             8      SRL B   ;BCH=BCH/2
001442 E1A2 CB19             8      RR  C   ;
001444 E1A4 CB1C             8      RR  H   ;
001446 E1A6 18F5            12      JR  L_RWX
       E1A8                     E_RWX:
001448 E1A8 FD5E1A          19      LD  E,(IY+26)   ;(FCB)ファイルの先頭クラスタ
00144B E1AB FD561B          19      LD  D,(IY+27)
00144E E1AE AF               4      XOR A
00144F E1AF 323AE7          13      LD  (_SECPS+1),A
       E1B2                     RWX1:
001452 E1B2 ED53FEF0        20      LD  (_CLPS),DE
001456 E1B6 7A               4      LD  A,D
001457 E1B7 B3               4      OR  E
001458 E1B8 2813            12      JR  Z,SCF_RET   ;RET DE==0 => CF=1
                                
00145A E1BA 78               4      LD  A,B
00145B E1BB B1               4      OR  C
00145C E1BC B4               4      OR  H
00145D E1BD C8              11      RET Z       ;RET BCH==0 => CF=0
                                
00145E E1BE CD42E7          17      CALL    GNCLX
001461 E1C1 D8              11      RET C
001462 E1C2 7C               4      LD  A,H     ;
001463 E1C3 25               4      DEC H       ;
001464 E1C4 B7               4      OR  A       ;DEC BCH
001465 E1C5 2001            12      JR  NZ,RWX2     ;
001467 E1C7 0B               6      DEC BC      ;
       E1C8                     RWX2:
001468 E1C8 CDC6DF          17      CALL    ENDCL
00146B E1CB 38E5            12      JR  C,RWX1
       E1CD                     SCF_RET:
00146D E1CD 37               4      SCF
00146E E1CE C9              10      RET
                                
       E1CF                     DSKF:
00146F E1CF 110000          10  MAXCLP: LD  DE,0
001472 E1D2 2AACEF          16      LD  HL,(_FAKEFREE)
001475 E1D5 7C               4      LD  A,H
001476 E1D6 B5               4      OR  L
001477 E1D7 2803            12      JR  Z,DSKF1
001479 E1D9 110100          10      LD  DE,1
       E1DC                     DSKF1:
00147C E1DC D5              11      PUSH    DE
00147D E1DD CDF7EF          17      CALL    _GNCL
001480 E1E0 380C            12      JR  C,POPSCF
001482 E1E2 7A               4      LD  A,D
001483 E1E3 B3               4      OR  E
001484 E1E4 2001            12      JR  NZ,DSKF2
001486 E1E6 23               6      INC HL
       E1E7                     DSKF2:
001487 E1E7 D1              10      POP DE
001488 E1E8 1B               6      DEC DE
001489 E1E9 7A               4      LD  A,D
00148A E1EA B3               4      OR  E
00148B E1EB 20EF            12      JR  NZ,DSKF1
00148D E1ED C9              10      RET
                                
       E1EE                     POPSCF:
00148E E1EE F1              10      POP AF
00148F E1EF 37               4      SCF
001490 E1F0 C9              10      RET
                                
       E1F1                     SETTMS:
001491 E1F1 FD7E17          19      LD  A,(IY+23)   ;(FCB)ファイルを最後に変更した時刻
001494 E1F4 3C               4      INC A
001495 E1F5 C0              11      RET NZ      ;ファイルが更新されていない
       E1F6                     SETTMSX:            ;FCBに日付時刻をセットする
001496 E1F6 CD5CD9          17      CALL    _SYS2C      ;(BDOS)時刻の獲得
                                                ;H←時  L←分  D←秒
001499 E1F9 CB25             8      SLA L       ;   *2
00149B E1FB CB25             8      SLA L       ;   *4
00149D E1FD 29              11      ADD HL,HL       ;*2 *8
00149E E1FE 29              11      ADD HL,HL       ;*4 *16
00149F E1FF 29              11      ADD HL,HL       ;*8 *32
0014A0 E200 7A               4      LD  A,D
0014A1 E201 0F               4      RRCA            ;bit.0->7->->->0->C
0014A2 E202 E61F             7      AND 01FH
0014A4 E204 B5               4      OR  L
0014A5 E205 FD7716          19      LD  (IY+22),A   ;(FCB)ファイルを最後に変更した時刻
0014A8 E208 FD7417          19      LD  (IY+23),H
                                
0014AB E20B CD56D9          17      CALL    _SYS2A      ;(BDOS)日付の獲得
                                                ;HL←年  D←月  E←日
0014AE E20E 0144F8          10      LD  BC,0-1980
0014B1 E211 09              11      ADD HL,BC
0014B2 E212 65               4      LD  H,L
                                
0014B3 E213 7A               4      LD  A,D
0014B4 E214 87               4      ADD A,A     ;*2
0014B5 E215 87               4      ADD A,A     ;*4
0014B6 E216 87               4      ADD A,A     ;*8
0014B7 E217 87               4      ADD A,A     ;*16
0014B8 E218 6F               4      LD  L,A
0014B9 E219 29              11      ADD HL,HL       ;*32
0014BA E21A 7D               4      LD  A,L
0014BB E21B B3               4      OR  E
0014BC E21C FD7714          19      LD  (IY+20),A   ;(FCB)ファイルを最後に変更した日付
0014BF E21F FD7415          19      LD  (IY+21),H
0014C2 E222 C9              10      RET
                                
       E223                     PUSHRR:
0014C3 E223 32C2E2          13      LD  (SETSEQ_SWC_RND),A
0014C6 E226 22D4E2          16      LD  (SETSEQ_SWC_SEQ_RR),HL
0014C9 E229 CD49E2          17      CALL    GET_RR_AHL
0014CC E22C 225AEF          16      LD  (HLBUF),HL
0014CF E22F 325CEF          13      LD  (HLBUF+2),A
0014D2 E232 C9              10      RET
                                
       E233                     GET_CPM_R_SIZE:     ;バイト単位からCP/Mのレコード単位を求める（1レコード=128バイト）
0014D3 E233 87               4      ADD A,A     ;in BHLA => out AHL
0014D4 E234 ED6A            15      ADC HL,HL
0014D6 E236 CB18             8      RR  B
0014D8 E238 B7               4      OR  A
0014D9 E239 78               4      LD  A,B     ;ここでフラグは変化しない
0014DA E23A C8              11      RET Z
0014DB E23B 2C               4      INC L       ;INC AHL
0014DC E23C C0              11      RET NZ      ;
0014DD E23D 24               4      INC H       ;
0014DE E23E C0              11      RET NZ      ;
0014DF E23F 3C               4      INC A       ;
0014E0 E240 C9              10      RET
                                
       E241                     INIT_RND:
0014E1 E241 3ECD             7      LD  A,0CDH      ;CALL ????
0014E3 E243 2192E2          10      LD  HL,POPRR
0014E6 E246 CD23E2          17      CALL    PUSHRR
       E249                     GET_RR_AHL:
0014E9 E249 FD6E21          19      LD  L,(IY+33)   ;(FCB)Random record
0014EC E24C FD6622          19      LD  H,(IY+34)   ;
0014EF E24F FD7E23          19      LD  A,(IY+35)   ;
0014F2 E252 C9              10      RET
       E253                     SET_RR_AHL:
0014F3 E253 FD7521          19      LD  (IY+33),L   ;(FCB)Random record
0014F6 E256 FD7422          19      LD  (IY+34),H
0014F9 E259 FD7723          19      LD  (IY+35),A
0014FC E25C C9              10      RET
       E25D                     INIT_SEQ:
0014FD E25D 3E01             7      LD  A,1     ;LD BC,????
0014FF E25F 218FE2          10      LD  HL,SETSEQ
001502 E262 CD23E2          17      CALL    PUSHRR
       E265                     GETSEQ:
001505 E265 FD6E20          19      LD  L,(IY+32)   ;(FCB)カレントレコード
001508 E268 FD660C          19      LD  H,(IY+12)   ;(FCB)カレントブロック
00150B E26B AF               4      XOR A
                                
00150C E26C CB25             8      SLA L   ;L=L*2
                                
00150E E26E CB3C             8      SRL H   ;HL=HL/2
001510 E270 CB1D             8      RR  L   ;
001512 E272 C9              10      RET
                                
       E273                     SETSEQ1:
001513 E273 F5              11      PUSH    AF      
001514 E274 E5              11      PUSH    HL      ;AHL=Random record
001515 E275 FD7E21          19      LD  A,(IY+33)   ;(FCB)ランダムレコード
001518 E278 FD6E22          19      LD  L,(IY+34)
00151B E27B FD6623          19      LD  H,(IY+35)
00151E E27E 0600             7      LD  B,0
                                
001520 E280 CD33E2          17      CALL    GET_CPM_R_SIZE
                                
001523 E283 29              11      ADD HL,HL
001524 E284 CB3D             8      SRL L       ;L=L/2
001526 E286 FD7520          19      LD  (IY+32),L   ;(FCB)カレントレコード
001529 E289 FD740C          19      LD  (IY+12),H   ;(FCB)カレントブロック
00152C E28C E1              10      POP HL
00152D E28D F1              10      POP AF
00152E E28E C9              10      RET
       E28F                     SETSEQ:
00152F E28F CD73E2          17      CALL    SETSEQ1
       E292                     POPRR:
001532 E292 F5              11      PUSH    AF
001533 E293 E5              11      PUSH    HL
001534 E294 2A5AEF          16      LD  HL,(HLBUF)
001537 E297 3A5CEF          13      LD  A,(HLBUF+2)
00153A E29A CD53E2          17      CALL    SET_RR_AHL
00153D E29D E1              10      POP HL
00153E E29E F1              10      POP AF
00153F E29F C9              10      RET
                                
       E2A0                     RB_WRITE:
001540 E2A0 C5              11      PUSH    BC
001541 E2A1 ED4B4CF0        20      LD  BC,(STABLE+2*026H)  ;(BDOS)ランダムブロック書き込み
001545 E2A5 1805            12      JR  RBRW
       E2A7                     RB_READ:
001547 E2A7 C5              11      PUSH    BC
001548 E2A8 ED4B4EF0        20      LD  BC,(STABLE+2*027H)  ;(BDOS)ランダムブロック読み込み
       E2AC                     RBRW:
00154C E2AC CB3F             8      SRL A   ;AHLA' = HL*128
00154E E2AE CB1C             8      RR  H   ;AHL=AHL/2
001550 E2B0 CB1D             8      RR  L   ;
001552 E2B2 3E00             7      LD  A,0
001554 E2B4 1F               4      RRA     ;A'HLA
001555 E2B5 FD7721          19      LD  (IY+33),A   ;(FCB)ランダムレコード
001558 E2B8 FD7522          19      LD  (IY+34),L
00155B E2BB FD7423          19      LD  (IY+35),H
00155E E2BE 218000          10      LD  HL,128
001561 E2C1 C5              11      PUSH    BC
       E2C2                     SETSEQ_SWC_RND:
001562 E2C2 CD73E2          17      CALL    SETSEQ1
001565 E2C5 C1              10      POP BC
001566 E2C6 FDCB20FE        23      SET 7,(IY+32)   ;(FCB)カレントレコード
00156A E2CA FDE5            15      PUSH    IY
00156C E2CC D1              10      POP DE
00156D E2CD D5              11      PUSH    DE
00156E E2CE CDDCE2          17      CALL    JP_BC
001571 E2D1 FDE1            14      POP IY
       E2D4                     SETSEQ_SWC_SEQ_RR   EQU $+1
001573 E2D3 CD8FE2          17      CALL    SETSEQ
001576 E2D6 FDCB20BE        23      RES 7,(IY+32)   ;(FCB)カレントレコード
                                
00157A E2DA C1              10      POP BC
00157B E2DB C9              10      RET
       E2DC                     JP_BC:
00157C E2DC C5              11      PUSH    BC
00157D E2DD C9              10      RET
                                
       DE56                     _SYS03  EQU SCF_FF_RET  ;(BDOS)外部入力
       DE56                     _SYS2B  EQU SCF_FF_RET  ;(BDOS)日付の設定
       DE56                     _SYS2D  EQU SCF_FF_RET  ;(BDOS)時刻の設定
       DE56                     _SYS39  EQU SCF_FF_RET  ;(BDOS)サブディレクトリの作成
       DE56                     _SYS3A  EQU SCF_FF_RET  ;(BDOS)サブディレクトリの削除
                                
[EOF:LDFILE.ASM:SHIFT_JIS]
                                    INCLUDE "LDFILE2.ASM"
                                
                                ;   LSX-Dodgers FILE2
                                
                                                ;Write random block
       E2DE                     _SYS26:     ;(BDOS)ランダムブロック書き込み
00157E E2DE AF               4      XOR A
00157F E2DF 32CAE5          13      LD  (DRDN1),A   ;NOP
001582 E2E2 220EE5          16      LD  (LEFT+1),HL ;HL←書き込むレコード数
001585 E2E5 225DEF          16      LD  (LEFTX),HL
001588 E2E8 CDABDD          17      CALL    SETDRV
                                
00158B E2EB CD65E4          17      CALL    RBX0
00158E E2EE DA88E3          10      JP  C,RBWERR
001591 E2F1 CD33E1          17      CALL    WOPEN
001594 E2F4 DA88E3          10      JP  C,RBWERR
001597 E2F7 7C               4      LD  A,H
001598 E2F8 B5               4      OR  L
001599 E2F9 CA81E3          10      JP  Z,RBW1
                                
00159C E2FC 2B               6      DEC HL
                                
00159D E2FD CD30E5          17      CALL    GET_RR_BCDE ;BCDE=Random record
                                
0015A0 E300 19              11      ADD HL,DE       ;BCHL=HL+BCDE
0015A1 E301 3001            12      JR  NC,S26X1    ;
0015A3 E303 03               6      INC BC      ;
       E304                     S26X1:
0015A4 E304 CD9AE1          17      CALL    RWXR
0015A7 E307 DC44E1          17      CALL    C,WRDFX
0015AA E30A DA88E3          10      JP  C,RBWERR
                                
0015AD E30D CD94E4          17      CALL    RBX2
0015B0 E310 281A            12      JR  Z,RBWB      ;NZ=セクタ以下の端数がある
0015B2 E312 CDB3E4          17      CALL    RBXA
0015B5 E315 3871            12      JR  C,RBWERR
0015B7 E317 EB               4      EX  DE,HL
0015B8 E318 C5              11      PUSH    BC
0015B9 E319 EDB0                    LDIR
0015BB E31B 225FEF          16      LD  (DTAX),HL
                                
0015BE E31E CDD8E0          17      CALL    SWTDBF      ;バッファデータは更新された
                                
0015C1 E321 2A5DEF          16      LD  HL,(LEFTX)
0015C4 E324 D1              10      POP DE
0015C5 E325 ED52            15      SBC HL,DE
0015C7 E327 225DEF          16      LD  (LEFTX),HL
0015CA E32A 2833            12      JR  Z,RBWEND
                                
       E32C                     RBWB:
0015CC E32C CDE9E4          17      CALL    RBXB
0015CF E32F 2816            12      JR  Z,RBWC
       E331                     RBWB1:
0015D1 E331 C5              11      PUSH    BC
0015D2 E332 D5              11      PUSH    DE
0015D3 E333 CDA9DF          17      CALL    CLUSTX
0015D6 E336 CD44E5          17      CALL    DWTC
0015D9 E339 D1              10      POP DE
0015DA E33A C1              10      POP BC
0015DB E33B 384B            12      JR  C,RBWERR
0015DD E33D CD42E7          17      CALL    GNCLX
0015E0 E340 3846            12      JR  C,RBWERR
0015E2 E342 10ED            13      DJNZ    RBWB1
0015E4 E344 CD94E5          17      CALL    DRW_FLUSH
       E347                     RBWC:
0015E7 E347 CD01E5          17      CALL    RBXC
0015EA E34A 2813            12      JR  Z,RBWEND
0015EC E34C C5              11      PUSH    BC
0015ED E34D CDA9DF          17      CALL    CLUSTX
0015F0 E350 CDC9E5          17      CALL    DRDN
0015F3 E353 C1              10      POP BC
0015F4 E354 3832            12      JR  C,RBWERR
0015F6 E356 ED5B7EF0        20      LD  DE,(_DTBUF)
0015FA E35A EDB0                    LDIR
0015FC E35C CDD8E0          17      CALL    SWTDBF      ;バッファデータは更新された
       E35F                     RBWEND:
0015FF E35F CD0DE5          17      CALL    RBXEND
                                
001602 E362 CD74E4          17      CALL    RBX1
001605 E365 301A            12      JR  NC,RBW1
001607 E367 2A0EE5          16      LD  HL,(LEFT+1)
00160A E36A FD5E10          19      LD  E,(IY+16)   ;(FCB)ファイルのサイズ(バイト単位)
00160D E36D FD5611          19      LD  D,(IY+17)   ;DE=File size
001610 E370 19              11      ADD HL,DE
001611 E371 FD7510          19      LD  (IY+16),L   ;(FCB)ファイルのサイズ(バイト単位)
001614 E374 FD7411          19      LD  (IY+17),H
001617 E377 3008            12      JR  NC,RBW1
001619 E379 FD3412          23      INC (IY+18)
00161C E37C 2003            12      JR  NZ,RBW1
00161E E37E FD3413          23      INC (IY+19)
       E381                     RBW1:
001621 E381 FDE1            14      POP IY
001623 E383 C1              10      POP BC
001624 E384 D1              10      POP DE
001625 E385 E1              10      POP HL
       E386                     DD_NUL:
001626 E386 AF               4      XOR A
       E387                     DRDF0:
       E387                     DWTF0:
001627 E387 C9              10      RET
                                
       E388                     RBWERR:
001628 E388 FDE5            15      PUSH    IY
00162A E38A D1              10      POP DE
00162B E38B 2A20F0          16      LD  HL,(STABLE+2*010H)
00162E E38E CD0F00          17      CALL    JP_HL
       E391                     RBRERR1:
001631 E391 3E01             7      LD  A,001H
       E393                     RBRERR2:
001633 E393 FDE1            14      POP IY
001635 E395 C1              10      POP BC
001636 E396 D1              10      POP DE
001637 E397 E1              10      POP HL
001638 E398 37               4      SCF
001639 E399 210000          10      LD  HL,0
00163C E39C C9              10      RET
                                
       E39D                     RBRERR:
00163D E39D 3EFF             7      LD  A,0FFH
00163F E39F 18F2            12      JR  RBRERR2
                                
       E3A1                     RBRFL:
001641 E3A1 3E00             7  RBRFLP: LD  A,000H
001643 E3A3 FE0D             7      CP  00DH
001645 E3A5 2005            12      JR  NZ,RBRFL1
001647 E3A7 D5              11      PUSH    DE
001648 E3A8 1E0A             7      LD  E,00AH
00164A E3AA 1805            12      JR  RBRFL2
       E3AC                     RBRFL1:
00164C E3AC D5              11      PUSH    DE
00164D E3AD CD09EF          17      CALL    _SYS07
001650 E3B0 5F               4      LD  E,A
       E3B1                     RBRFL2:
001651 E3B1 CDCDEF          17      CALL    _PRINT
001654 E3B4 7B               4      LD  A,E
001655 E3B5 D1              10      POP DE
001656 E3B6 32A2E3          13      LD  (RBRFLP+1),A
001659 E3B9 C9              10      RET
       E3BA                     DDX:
00165A E3BA FD7E01          19      LD  A,(IY+1)    ;(FCB)主ファイル名
00165D E3BD CDCEDF          17      CALL    CAP
001660 E3C0 FE41             7      CP  'A'
001662 E3C2 C9              10      RET
                                
                                                ;Read random block
       E3C3                     _SYS27:     ;(BDOS)ランダムブロック読み込み
001663 E3C3 225DEF          16      LD  (LEFTX),HL
001666 E3C6 CDABDD          17      CALL    SETDRV
                                
001669 E3C9 FDCB0D66        20      BIT 4,(IY+13)   ;(FCB)属性(アトリビュート)
00166D E3CD C253E4          10      JP  NZ,RBRDIR   ;ディレクトリ
001670 E3D0 CD65E4          17      CALL    RBX0
001673 E3D3 DA9DE3          10      JP  C,RBRERR
001676 E3D6 CD74E4          17      CALL    RBX1
001679 E3D9 DA91E3          10      JP  C,RBRERR1
00167C E3DC EB               4      EX  DE,HL
00167D E3DD ED52            15      SBC HL,DE       ;CP 00HL,BCDE
00167F E3DF 19              11      ADD HL,DE
001680 E3E0 79               4      LD  A,C
001681 E3E1 DE00             7      SBC A,0
001683 E3E3 78               4      LD  A,B
001684 E3E4 DE00             7      SBC A,0
001686 E3E6 3801            12      JR  C,RBR1
001688 E3E8 EB               4      EX  DE,HL
       E3E9                     RBR1:
001689 E3E9 9F               4      SBC A,A
00168A E3EA E601             7      AND 1
00168C E3EC 3251E4          13      LD  (RBRAP+1),A
                                
00168F E3EF 7C               4      LD  A,H
001690 E3F0 B5               4      OR  L
001691 E3F1 2857            12      JR  Z,RBREND0
                                
001693 E3F3 220EE5          16      LD  (LEFT+1),HL ;Read record byte
001696 E3F6 225DEF          16      LD  (LEFTX),HL
                                
001699 E3F9 CD94E4          17      CALL    RBX2
00169C E3FC 2819            12      JR  Z,RBRB
00169E E3FE CDB3E4          17      CALL    RBXA
0016A1 E401 DA9DE3          10      JP  C,RBRERR
0016A4 E404 C5              11      PUSH    BC
0016A5 E405 EDB0                    LDIR
0016A7 E407 ED535FEF        20      LD  (DTAX),DE
0016AB E40B 2A5DEF          16      LD  HL,(LEFTX)
0016AE E40E D1              10      POP DE
0016AF E40F A7               4      AND A
0016B0 E410 ED52            15      SBC HL,DE
0016B2 E412 225DEF          16      LD  (LEFTX),HL
0016B5 E415 2830            12      JR  Z,RBREND
                                
       E417                     RBRB:
0016B7 E417 CDE9E4          17      CALL    RBXB
0016BA E41A 2815            12      JR  Z,RBRC
       E41C                     RBRB1:
0016BC E41C C5              11      PUSH    BC
0016BD E41D D5              11      PUSH    DE
0016BE E41E CDA9DF          17      CALL    CLUSTX
0016C1 E421 CD4AE5          17      CALL    DRDC
0016C4 E424 D1              10      POP DE
0016C5 E425 C1              10      POP BC
0016C6 E426 D442E7          17      CALL    NC,GNCLX
0016C9 E429 DA9DE3          10      JP  C,RBRERR
0016CC E42C 10EE            13      DJNZ    RBRB1
0016CE E42E CD94E5          17      CALL    DRW_FLUSH
       E431                     RBRC:
0016D1 E431 CD01E5          17      CALL    RBXC
0016D4 E434 2811            12      JR  Z,RBREND
0016D6 E436 C5              11      PUSH    BC
0016D7 E437 CDA9DF          17      CALL    CLUSTX
0016DA E43A CDADE5          17      CALL    DRDX
0016DD E43D C1              10      POP BC
0016DE E43E DA9DE3          10      JP  C,RBRERR
0016E1 E441 EB               4      EX  DE,HL
0016E2 E442 2A7EF0          16      LD  HL,(_DTBUF)
0016E5 E445 EDB0                    LDIR
       E447                     RBREND:
0016E7 E447 CD0DE5          17      CALL    RBXEND
       E44A                     RBREND0:
0016EA E44A FDE1            14      POP IY
0016EC E44C C1              10      POP BC
0016ED E44D D1              10      POP DE
0016EE E44E F1              10      POP AF  ;(HL)
0016EF E44F AF               4      XOR A
0016F0 E450 3E00             7  RBRAP:  LD  A,000H
0016F2 E452 C9              10      RET
                                
       E453                     RBRDIR:
0016F3 E453 FD6E1A          19      LD  L,(IY+26)   ;(FCB)ファイルの先頭クラスタ
0016F6 E456 FD661B          19      LD  H,(IY+27)
0016F9 E459 CDE9DF          17      CALL    CHDIR
0016FC E45C AF               4      XOR A
0016FD E45D 67               4      LD  H,A
0016FE E45E 6F               4      LD  L,A
0016FF E45F 3C               4      INC A
001700 E460 3251E4          13      LD  (RBRAP+1),A
001703 E463 18E5            12      JR  RBREND0
                                
       E465                     RBX0:
001705 E465 2A8AEF          16      LD  HL,(_DTA)
001708 E468 225FEF          16      LD  (DTAX),HL
00170B E46B 2A5DEF          16      LD  HL,(LEFTX)
00170E E46E FD7E1C          19      LD  A,(IY+28)   ;(FCB)オープンモード
001711 E471 D6FD             7      SUB 0FDH
001713 E473 C9              10      RET
                                
       E474                     RBX1:
001714 E474 E5              11      PUSH    HL      ;Record byte
                                                ;AHL=File size
001715 E475 FD6E10          19      LD  L,(IY+16)   ;ファイルのサイズ(バイト単位)
001718 E478 FD6611          19      LD  H,(IY+17)   ;
00171B E47B FD7E12          19      LD  A,(IY+18)   ;
                                
00171E E47E CD30E5          17      CALL    GET_RR_BCDE ;BCDE=Random record
                                
001721 E481 A7               4      AND A
001722 E482 ED52            15      SBC HL,DE
001724 E484 99               4      SBC A,C
001725 E485 4F               4      LD  C,A
001726 E486 FD7E13          19      LD  A,(IY+19)   ;ファイルのサイズ
001729 E489 98               4      SBC A,B
00172A E48A D1              10      POP DE
                                
00172B E48B D8              11      RET C
00172C E48C 47               4      LD  B,A
00172D E48D B1               4      OR  C
00172E E48E EB               4      EX  DE,HL   ;BCDE=File byte HL=Record byte
00172F E48F B2               4      OR  D
001730 E490 B3               4      OR  E
001731 E491 C0              11      RET NZ
001732 E492 37               4      SCF
001733 E493 C9              10      RET
                                
       E494                     RBX2:               ;Cluster settings
001734 E494 FD6622          19      LD  H,(IY+34)   ;(+33)(FCB)ランダムレコード
001737 E497 FD4E23          19      LD  C,(IY+35)
00173A E49A 0600             7      LD  B,0
00173C E49C FDCB207E        20      BIT 7,(IY+32)   ;(FCB)カレントレコード
001740 E4A0 2003            12      JR  NZ,RBX3
001742 E4A2 FD4624          19      LD  B,(IY+36)
       E4A5                     RBX3:
001745 E4A5 CD9AE1          17      CALL    RWXR
001748 E4A8 3ACBE4          13      LD  A,(SECSZ+2) ;1024=4 / 512=2 / 256=1
00174B E4AB 3D               4      DEC A
00174C E4AC FDA622          19      AND (IY+34)
00174F E4AF FDB621          19      OR  (IY+33)
001752 E4B2 C9              10      RET
                                
       E4B3                     RBXA:
001753 E4B3 C5              11      PUSH    BC
001754 E4B4 D5              11      PUSH    DE
001755 E4B5 CDA9DF          17      CALL    CLUSTX
001758 E4B8 CDADE5          17      CALL    DRDX
00175B E4BB D1              10      POP DE
00175C E4BC C1              10      POP BC
00175D E4BD D8              11      RET C
00175E E4BE CD42E7          17      CALL    GNCLX
001761 E4C1 D8              11      RET C
001762 E4C2 ED53FEF0        20      LD  (_CLPS),DE
                                
001766 E4C6 FD4E21          19      LD  C,(IY+33)   ;(FCB)ランダムレコード
001769 E4C9 210004          10  SECSZ:  LD  HL,0400H    ;自己書き換え 1024=0400H / 512=0200H ここに1セクタのサイズが格納される
00176C E4CC 7C               4      LD  A,H
00176D E4CD 3D               4      DEC A       ;1024=3 / 512=1
00176E E4CE FDA622          19      AND (IY+34)     ;(FCB)ランダムレコード
001771 E4D1 47               4      LD  B,A     ;BCに1セクタ以下の端数が入る
001772 E4D2 ED42            15      SBC HL,BC       ;残りを計算
                                
001774 E4D4 ED5B5DEF        20      LD  DE,(LEFTX)
001778 E4D8 ED52            15      SBC HL,DE       ;CP HL,DE
00177A E4DA 19              11      ADD HL,DE       ;
00177B E4DB 3801            12      JR  C,RBXA1     ;DEとHLを比較して大きい方をHLに
00177D E4DD EB               4      EX  DE,HL
       E4DE                     RBXA1:
00177E E4DE E5              11      PUSH    HL
00177F E4DF 2A7EF0          16      LD  HL,(_DTBUF)
001782 E4E2 09              11      ADD HL,BC
001783 E4E3 ED5B5FEF        20      LD  DE,(DTAX)
001787 E4E7 C1              10      POP BC
001788 E4E8 C9              10      RET
                                
       E4E9                     RBXB:
001789 E4E9 2A5FEF          16      LD  HL,(DTAX)
00178C E4EC ED5BFEF0        20      LD  DE,(_CLPS)
001790 E4F0 3A5EEF          13      LD  A,(LEFTX+1)
001793 E4F3 47               4      LD  B,A
001794 E4F4 3ACBE4          13      LD  A,(SECSZ+2) ;1024=4 / 512=2 / 256=1
       E4F7                     RBXB1:
001797 E4F7 1F               4      RRA     ;->CF
001798 E4F8 3804            12      JR  C,RBXB2
00179A E4FA CB38             8      SRL B   ;B=B/2
00179C E4FC 18F9            12      JR  RBXB1
       E4FE                     RBXB2:
00179E E4FE 78               4      LD  A,B
00179F E4FF B7               4      OR  A
0017A0 E500 C9              10      RET
                                
       E501                     RBXC:
0017A1 E501 ED4B5DEF        20      LD  BC,(LEFTX)
0017A5 E505 3ACBE4          13      LD  A,(SECSZ+2) ;1024=4 / 512=2 / 256=1
0017A8 E508 3D               4      DEC A
0017A9 E509 A0               4      AND B
0017AA E50A 47               4      LD  B,A     ;1セクタ以下の端数がない場合はZ
0017AB E50B B1               4      OR  C
0017AC E50C C9              10      RET
                                
       E50D                     RBXEND:
0017AD E50D 110000          10  LEFT:   LD  DE,0
0017B0 E510 AF               4      XOR A
0017B1 E511 FD6E21          19      LD  L,(IY+33)   ;(FCB)ランダムレコード
0017B4 E514 FD6622          19      LD  H,(IY+34)
0017B7 E517 19              11      ADD HL,DE
0017B8 E518 FD7521          19      LD  (IY+33),L   ;(FCB)ランダムレコード
0017BB E51B FD7422          19      LD  (IY+34),H
0017BE E51E 300E            12      JR  NC,RBXEND1
0017C0 E520 FD3423          23      INC (IY+35)
0017C3 E523 2009            12      JR  NZ,RBXEND1
0017C5 E525 FDCB207E        20      BIT 7,(IY+32)   ;(FCB)カレントレコード
0017C9 E529 2003            12      JR  NZ,RBXEND1
0017CB E52B FD3424          23      INC (IY+36)
       E52E                     RBXEND1:
0017CE E52E EB               4      EX  DE,HL       ;HL=Read byte
0017CF E52F C9              10      RET
                                
       E530                     GET_RR_BCDE:            ;BCDE=Random record
0017D0 E530 FD5E21          19      LD  E,(IY+33)   ;(FCB)ランダムレコード
0017D3 E533 FD5622          19      LD  D,(IY+34)
0017D6 E536 FD4E23          19      LD  C,(IY+35)
0017D9 E539 FD4624          19      LD  B,(IY+36)
0017DC E53C FDCB207E        20      BIT 7,(IY+32)   ;(FCB)カレントレコード
0017E0 E540 C8              11      RET Z
0017E1 E541 0600             7      LD  B,0     ;CP/M互換のアクセスの場合はFCBは36バイト
0017E3 E543 C9              10      RET
                                
                                ;   ランダムブロックアクセスの連続したセクタをまとめる
                                
       E544                     DWTC:
0017E4 E544 E5              11      PUSH    HL
0017E5 E545 21A7E8          10      LD  HL,DWT24B
0017E8 E548 1804            12      JR  DWTC1
       E54A                     DRDC:
0017EA E54A E5              11      PUSH    HL
0017EB E54B 2197E8          10      LD  HL,DRD24B
       E54E                     DWTC1:
0017EE E54E 22A8E5          16      LD  (DRWF_MODE),HL
0017F1 E551 E1              10      POP HL
0017F2 E552 3A98E5          13      LD  A,(DRWF_B)
0017F5 E555 B7               4      OR  A
0017F6 E556 200F            12      JR  NZ,DRDC1
       E558                     SAVE_DRWC:
0017F8 E558 0601             7      LD  B,1
0017FA E55A ED4397E5        20      LD  (DRWF_C),BC
0017FE E55E ED539EE5        20      LD  (DRWF_E),DE
001802 E562 22A1E5          16      LD  (DRWF_HL),HL
001805 E565 1820            12      JR  INC_HL_DRWC
       E567                     DRDC1:
001807 E567 E5              11      PUSH    HL
001808 E568 219EE5          10      LD  HL,DRWF_E
00180B E56B 86               7      ADD A,(HL)
00180C E56C F5              11      PUSH    AF
00180D E56D BB               4      CP  E
00180E E56E 201D            12      JR  NZ,DRDC2
001810 E570 F1              10      POP AF
001811 E571 23               6      INC HL
001812 E572 7E               7      LD  A,(HL)
001813 E573 CE00             7      ADC A,0
001815 E575 F5              11      PUSH    AF
001816 E576 BA               4      CP  D
001817 E577 2014            12      JR  NZ,DRDC2
001819 E579 F1              10      POP AF
00181A E57A 3A97E5          13      LD  A,(DRWF_C)
00181D E57D CE00             7      ADC A,0
00181F E57F B9               4      CP  C
001820 E580 200C            12      JR  NZ,DRDC3
001822 E582 2198E5          10      LD  HL,DRWF_B
001825 E585 34              11      INC (HL)
001826 E586 E1              10      POP HL
       E587                     INC_HL_DRWC:
001827 E587 3ACBE4          13      LD  A,(SECSZ+2)     ;1セクタのサイズの上位1バイト
00182A E58A 84               4      ADD A,H
00182B E58B 67               4      LD  H,A
00182C E58C C9              10      RET
       E58D                     DRDC2:
00182D E58D F1              10      POP AF
       E58E                     DRDC3:
00182E E58E CD94E5          17      CALL    DRW_FLUSH
001831 E591 E1              10      POP HL
001832 E592 18C4            12      JR  SAVE_DRWC
                                
                                ;   ランダムブロックアクセスの連続したセクタをまとめたものをフラッシュする
       E594                     DRW_FLUSH:
001834 E594 C5              11      PUSH    BC
001835 E595 D5              11      PUSH    DE
       E597                     DRWF_C  EQU $+1
       E598                     DRWF_B  EQU $+2
001836 E596 010000          10      LD  BC,0
001839 E599 78               4      LD  A,B
00183A E59A B7               4      OR  A
00183B E59B 280D            12      JR  Z,DRDF1
       E59E                     DRWF_E  EQU $+1
       E59F                     DRWF_D  EQU $+2
00183D E59D 110000          10      LD  DE,0
       E5A1                     DRWF_HL EQU $+1
001840 E5A0 210000          10      LD  HL,0
001843 E5A3 AF               4      XOR A
001844 E5A4 3298E5          13      LD  (DRWF_B),A
       E5A8                     DRWF_MODE   EQU $+1
001847 E5A7 CD97E8          17      CALL    DRD24B
       E5AA                     DRDF1:
00184A E5AA D1              10      POP DE
00184B E5AB C1              10      POP BC
00184C E5AC C9              10      RET
[EOF:LDFILE2.ASM:SHIFT_JIS]
                                    INCLUDE "LDDIO.ASM"
                                
                                ;   LSX-Dodgers DIO
                                
       E5AD                     DRDX:
00184D E5AD CDEBE5          17      CALL    DRDY
001850 E5B0 C8              11      RET Z
001851 E5B1 CDD1E5          17      CALL    DRDX1       ;データバッファの情報を保存
001854 E5B4 D8              11      RET C
001855 E5B5 E5              11      PUSH    HL
001856 E5B6 C5              11      PUSH    BC
001857 E5B7 D5              11      PUSH    DE
001858 E5B8 2A7EF0          16      LD  HL,(_DTBUF)
00185B E5BB 3A14E6          13      LD  A,(_DBS24+1)
00185E E5BE 4F               4      LD  C,A
00185F E5BF CD95E8          17      CALL    DRD24
001862 E5C2 DCE6E5          17      CALL    C,DRDNE
       E5C5                     POP_DE_BC_HL_RET:
001865 E5C5 D1              10      POP DE
001866 E5C6 C1              10      POP BC
001867 E5C7 E1              10      POP HL
001868 E5C8 C9              10      RET
                                
                                ;   CDE:セクタ番号
       E5C9                     DRDN:
001869 E5C9 AF               4      XOR A
00186A E5CA 00               4  DRDN1:  NOP         ;自己書き換え NOP / SCF
00186B E5CB 30E0            12      JR  NC,DRDX
       E5CD                     DRDNX:
00186D E5CD CDEBE5          17      CALL    DRDY
001870 E5D0 C8              11      RET Z
       E5D1                     DRDX1:
001871 E5D1 CD01E6          17      CALL    DWTX
                                                ;データバッファの読み込んだドライブ・セクタ情報を保存
001874 E5D4 ED53A6EF        20      LD  (_DBSEC),DE
001878 E5D8 79               4      LD  A,C
001879 E5D9 3214E6          13      LD  (_DBS24+1),A
                                
00187C E5DC 3A88EF          13      LD  A,(_DRV)
00187F E5DF 32A5EF          13      LD  (_DBDRV),A
001882 E5E2 CDD9EF          17      CALL    _CHGDRV
001885 E5E5 D0              11      RET NC
       E5E6                     DRDNE:
001886 E5E6 9F               4      SBC A,A     ;CF=1ならばA=0FFH
001887 E5E7 32A5EF          13      LD  (_DBDRV),A
00188A E5EA C9              10      RET
                                
                                ;   CDE:セクタ番号
       E5EB                     DRDY:
00188B E5EB 3A14E6          13      LD  A,(_DBS24+1)
00188E E5EE B9               4      CP  C
00188F E5EF C0              11      RET NZ
                                
001890 E5F0 E5              11      PUSH    HL
001891 E5F1 3A88EF          13      LD  A,(_DRV)
001894 E5F4 21A5EF          10      LD  HL,_DBDRV
001897 E5F7 AE               7      XOR (HL)
001898 E5F8 2005            12      JR  NZ,POP_HL_RET
                                
00189A E5FA 2AA6EF          16      LD  HL,(_DBSEC)
00189D E5FD ED52            15      SBC HL,DE       ;CF=0
       E5FF                     POP_HL_RET:
00189F E5FF E1              10      POP HL
0018A0 E600 C9              10      RET
                                
       E601                     DWTX:
0018A1 E601 3AA4EF          13      LD  A,(_WTDBF)
0018A4 E604 B7               4      OR  A
0018A5 E605 C8              11      RET Z
0018A6 E606 AF               4      XOR A
0018A7 E607 32A4EF          13      LD  (_WTDBF),A
                                
0018AA E60A E5              11      PUSH    HL
0018AB E60B C5              11      PUSH    BC
0018AC E60C D5              11      PUSH    DE
0018AD E60D 3AA5EF          13      LD  A,(_DBDRV)
0018B0 E610 CDD9EF          17      CALL    _CHGDRV
0018B3 E613 0E00             7  _DBS24: LD  C,0
0018B5 E615 ED5BA6EF        20      LD  DE,(_DBSEC)
0018B9 E619 2A7EF0          16      LD  HL,(_DTBUF)
0018BC E61C D4A5E8          17      CALL    NC,DWT24
       E61F                     POP_DE_BC_HL_RET2:
0018BF E61F 18A4            12      JR  POP_DE_BC_HL_RET
                                
       E621                     RDFATX:
0018C1 E621 E5              11      PUSH    HL
0018C2 E622 3A88EF          13      LD  A,(_DRV)
0018C5 E625 21AAEF          10      LD  HL,_FATDRV
0018C8 E628 AE               7      XOR (HL)
0018C9 E629 28D4            12      JR  Z,POP_HL_RET
                                
0018CB E62B C5              11      PUSH    BC
0018CC E62C D5              11      PUSH    DE
0018CD E62D DDE5            15      PUSH    IX
0018CF E62F CD4BE6          17      CALL    WTFATX
0018D2 E632 3813            12      JR  C,POP_IX_DE_BC_HL_RET
                                
0018D4 E634 AF               4      XOR A
0018D5 E635 32ABEF          13      LD  (_FATIX),A
0018D8 E638 3A88EF          13      LD  A,(_DRV)
0018DB E63B 32AAEF          13      LD  (_FATDRV),A
0018DE E63E CDE5EF          17      CALL    _RDFAT
       E641                     RDFATE2:
0018E1 E641 3004            12      JR  NC,POP_IX_DE_BC_HL_RET
0018E3 E643 9F               4      SBC A,A     ;A=0xFF
0018E4 E644 32AAEF          13      LD  (_FATDRV),A
       E647                     POP_IX_DE_BC_HL_RET:
0018E7 E647 DDE1            14      POP IX
0018E9 E649 18D4            12      JR  POP_DE_BC_HL_RET2
                                
       E64B                     WTFATX:
0018EB E64B 3AA2EF          13      LD  A,(_WTFATF)
0018EE E64E B7               4      OR  A
0018EF E64F C8              11      RET Z
0018F0 E650 E5              11      PUSH    HL
0018F1 E651 3AAAEF          13      LD  A,(_FATDRV)
0018F4 E654 21A5EF          10      LD  HL,_DBDRV
0018F7 E657 AE               7      XOR (HL)
0018F8 E658 CC01E6          17      CALL    Z,DWTX
0018FB E65B 38A2            12      JR  C,POP_HL_RET
0018FD E65D C5              11      PUSH    BC
0018FE E65E D5              11      PUSH    DE
0018FF E65F DDE5            15      PUSH    IX
001901 E661 CDB2E8          17      CALL    WTFAT
001904 E664 AF               4      XOR A
001905 E665 32A2EF          13      LD  (_WTFATF),A
001908 E668 18DD            12      JR  POP_IX_DE_BC_HL_RET
                                
       E66A                     NCL1:
00190A E66A 7A               4      LD  A,D
00190B E66B B3               4      OR  E
00190C E66C 37               4      SCF
00190D E66D C8              11      RET Z
                                
00190E E66E 7A               4      LD  A,D
00190F E66F CB3F             8      SRL A   ;/2
001911 E671 CB3F             8      SRL A   ;/2
                                
001913 E673 E5              11      PUSH    HL
001914 E674 3293E6          13      LD  (NCLPAT+2),A    ;_FATIX
001917 E677 2AAAEF          16      LD  HL,(_FATDRV)    ;L=_FATDRV H=_FATIX
00191A E67A BC               4      CP  H
00191B E67B 3A88EF          13      LD  A,(_DRV)    ;この間でフラグは変化しない
00191E E67E 3292E6          13      LD  (NCLPAT+1),A    ;_FATDRV
001921 E681 2005            12      JR  NZ,NCL2     ;FATIXが違う
001923 E683 BD               4      CP  L
001924 E684 2002            12      JR  NZ,NCL2     ;ドライブが違う
001926 E686 E1              10      POP HL
001927 E687 C9              10      RET
       E688                     NCL2:
001928 E688 C5              11      PUSH    BC
001929 E689 D5              11      PUSH    DE
00192A E68A DDE5            15      PUSH    IX
00192C E68C CD4BE6          17      CALL    WTFATX
00192F E68F 38B6            12      JR  C,POP_IX_DE_BC_HL_RET
001931 E691 010000          10  NCLPAT: LD  BC,0        ;自己書き換え C=_FATDRV B=_FATIX
001934 E694 ED43AAEF        20      LD  (_FATDRV),BC
001938 E698 CD87E8          17      CALL    RDFATS
00193B E69B 18A4            12      JR  RDFATE2
                                
       E69D                     NCL3:
00193D E69D CB9A             8      RES 3,D
00193F E69F CB92             8      RES 2,D
001941 E6A1 6B               4      LD  L,E
001942 E6A2 62               4      LD  H,D
001943 E6A3 CB3C             8      SRL H   ;
001945 E6A5 CB1D             8      RR  L   ;HLA=HLA/2
001947 E6A7 1F               4      RRA     ;
001948 E6A8 F5              11      PUSH    AF
001949 E6A9 3AABEF          13      LD  A,(_FATIX)
00194C E6AC 0F               4      RRCA
00194D E6AD 300B            12      JR  NC,NCL3X1
00194F E6AF 3ACBE4          13      LD  A,(SECSZ+2)
001952 E6B2 FE04             7      CP  4       ;1セクタ1024バイトの場合は奇数インデックスの場合に先頭を512バイトずらす
001954 E6B4 2004            12      JR  NZ,NCL3X1
001956 E6B6 010002          10      LD  BC,512
001959 E6B9 09              11      ADD HL,BC
       E6BA                     NCL3X1:
00195A E6BA F1              10      POP AF
00195B E6BB ED4B7CF0        20      LD  BC,(_FATBF)
00195F E6BF 19              11      ADD HL,DE
001960 E6C0 09              11      ADD HL,BC
001961 E6C1 17               4      RLA
001962 E6C2 C9              10      RET
                                
       E6C3                     GNCL:
001963 E6C3 CD6AE6          17      CALL    NCL1        ;GET NEXT CLUSTER
001966 E6C6 D8              11      RET C
001967 E6C7 C5              11      PUSH    BC
001968 E6C8 E5              11      PUSH    HL
001969 E6C9 CD9DE6          17      CALL    NCL3
00196C E6CC 3809            12      JR  C,GNC1
00196E E6CE 5E               7      LD  E,(HL)
00196F E6CF 23               6      INC HL
001970 E6D0 7E               7      LD  A,(HL)
001971 E6D1 E60F             7      AND 00FH
001973 E6D3 57               4      LD  D,A
001974 E6D4 E1              10      POP HL
001975 E6D5 C1              10      POP BC
001976 E6D6 C9              10      RET
       E6D7                     GNC1:
001977 E6D7 7E               7      LD  A,(HL)
001978 E6D8 23               6      INC HL
001979 E6D9 56               7      LD  D,(HL)
00197A E6DA 0604             7      LD  B,4
       E6DC                     GNC1L:
00197C E6DC CB3A             8      SRL D   ;DA=DA/2
00197E E6DE 1F               4      RRA     ;
00197F E6DF 10FB            13      DJNZ    GNC1L
                                
001981 E6E1 5F               4      LD  E,A
001982 E6E2 E1              10      POP HL
001983 E6E3 C1              10      POP BC
001984 E6E4 A7               4      AND A
001985 E6E5 C9              10      RET
                                
       E6E6                     SNCL:
001986 E6E6 CD6AE6          17      CALL    NCL1
001989 E6E9 D8              11      RET C
                                ;               SET NEXT CLUSTER
00198A E6EA E5              11      PUSH    HL
00198B E6EB C5              11      PUSH    BC
00198C E6EC D5              11      PUSH    DE
00198D E6ED E5              11      PUSH    HL
00198E E6EE CD9DE6          17      CALL    NCL3
001991 E6F1 D1              10      POP DE
                                ;CF=ODD
001992 E6F2 7E               7      LD  A,(HL)
001993 E6F3 73               7      LD  (HL),E
001994 E6F4 3806            12      JR  C,SNC1
                                ;EVEN
                                ;M[0] = E
                                ;M[1] = (M[1] & 0xF0) | (D & 0x0F)
001996 E6F6 23               6      INC HL
001997 E6F7 ED67            18      RRD     ;M={A[3:0],E[3:0]}
001999 E6F9 7A               4      LD  A,D
00199A E6FA 1804            12      JR  SNC11
       E6FC                     SNC1:
                                ;ODD
                                ;HL[0] = (HL[0]&0x0F) | (E<<4)
                                ;HL[1] = DE>>4
00199C E6FC ED6F            18      RLD     ;M={D[3:0],E[7:4]}
00199E E6FE 23               6      INC HL
00199F E6FF 72               7      LD  (HL),D  ;M={D[3:0],E[7:4]}
       E700                     SNC11:
0019A0 E700 ED6F            18      RLD     ;M={M[7:4],D[3:0]}
0019A2 E702 B7               4      OR  A
0019A3 E703 D1              10      POP DE
0019A4 E704 C1              10      POP BC
0019A5 E705 E1              10      POP HL
       E706                     FAT_CHANGED:
0019A6 E706 3E01             7      LD  A,1
0019A8 E708 32A2EF          13      LD  (_WTFATF),A
0019AB E70B C9              10      RET
                                
       E70C                     N16CL3:
0019AC E70C C5              11      PUSH    BC
0019AD E70D 6B               4      LD  L,E
0019AE E70E 7A               4      LD  A,D
0019AF E70F E603             7      AND 3
0019B1 E711 67               4      LD  H,A
0019B2 E712 29              11      ADD HL,HL
0019B3 E713 ED4B7CF0        20      LD  BC,(_FATBF)
0019B7 E717 09              11      ADD HL,BC
0019B8 E718 C1              10      POP BC
0019B9 E719 C9              10      RET
                                
       E71A                     GNCL16:
0019BA E71A CD6AE6          17      CALL    NCL1        ;GET NEXT CLUSTER for FAT16
0019BD E71D D8              11      RET C
0019BE E71E E5              11      PUSH    HL
0019BF E71F CD0CE7          17      CALL    N16CL3
0019C2 E722 5E               7      LD  E,(HL)
0019C3 E723 23               6      INC HL
0019C4 E724 56               7      LD  D,(HL)
0019C5 E725 E1              10      POP HL
0019C6 E726 C9              10      RET
                                
       E727                     SNCL16:
0019C7 E727 CD6AE6          17      CALL    NCL1        ;GET NEXT CLUSTER for FAT16
0019CA E72A D8              11      RET C
0019CB E72B D5              11      PUSH    DE
0019CC E72C E5              11      PUSH    HL
0019CD E72D CD0CE7          17      CALL    N16CL3
0019D0 E730 D1              10      POP DE      ;HL
0019D1 E731 73               7      LD  (HL),E
0019D2 E732 23               6      INC HL
0019D3 E733 72               7      LD  (HL),D
0019D4 E734 6B               4      LD  L,E
0019D5 E735 62               4      LD  H,D
0019D6 E736 D1              10      POP DE
0019D7 E737 18CD            12      JR  FAT_CHANGED
                                
                                ;------------------------
                                ;次のセクタを探す際に_SECPSの値をチェック
                                ;in
                                ;   DE : セクタ番号
                                ;out
                                ;   DE : 次のセクタ番号
                                ;note
                                ;
                                ;------------------------
       E739                     NEXTX:
0019D9 E739 3E00             7  _SECPS: LD  A,0 ;自己書き換え
0019DB E73B 3C               4      INC A
0019DC E73C E600             7  NCPAT:  AND 0   ;自己書き換え　1クラスタの論理セクタ数-1
0019DE E73E 323AE7          13      LD  (_SECPS+1),A
0019E1 E741 C9              10      RET
                                
       E742                     GNCLX:
0019E2 E742 CD39E7          17      CALL    NEXTX
0019E5 E745 C0              11      RET NZ  ;1クラスタのセクタ未満の場合は戻る
0019E6 E746 C3F7EF          10      JP  _GNCL   ;次のクラスタを探す
                                
       E749                     RDFAT:
0019E9 E749 3E80             7      LD  A,080H
0019EB E74B 3270EF          13      LD  (CHECK),A
       E74E                     RDFAT1:
0019EE E74E 3A88EF          13      LD  A,(_DRV)
0019F1 E751 CDDCE9          17      CALL    CHGDRVR
0019F4 E754 D8              11      RET C
0019F5 E755 DD7E12          19      LD  A,(IX+012H) ;DPB_12_DEVICE
0019F8 E758 CB6F             8      BIT 5,A
0019FA E75A 2843            12      JR  Z,RDFAT0X
0019FC E75C 2170EF          10      LD  HL,CHECK
0019FF E75F A6               7      AND (HL)
001A00 E760 77               7      LD  (HL),A
001A01 E761 110000          10      LD  DE,0        ;BPB
001A04 E764 2A7CF0          16      LD  HL,(_FATBF)
001A07 E767 CD93E8          17      CALL    DRD16
001A0A E76A 3024            12      JR  NC,GETBPB
001A0C E76C 2170EF          10      LD  HL,CHECK
001A0F E76F CB06            15      RLC (HL)
001A11 E771 3F               4      CCF
001A12 E772 D8              11      RET C
001A13 E773 DDCB0A1E        23      RR  (IX+00AH)   ;DPB_0A_FDMODE
001A17 E777 3F               4      CCF         ;フロッピーディスクのMFMモードを切り替える
001A18 E778 DDCB0A16        23      RL  (IX+00AH)   ;DPB_0A_FDMODE
001A1C E77C 3EFF             7      LD  A,0FFH
001A1E E77E 3289EF          13      LD  (_DSK),A
001A21 E781 3A84EF          13      LD  A,(_DRIVE)
001A24 E784 E603             7      AND 3
001A26 E786 F680             7      OR  080H
001A28 E788 6F               4      LD  L,A
001A29 E789 26EF             7      LD  H,_CYL0/256
001A2B E78B 3EFF             7      LD  A,0FFH
001A2D E78D 77               7      LD  (HL),A
001A2E E78E 18BE            12      JR  RDFAT1
       E790                     GETBPB:
001A30 E790 FDE5            15      PUSH    IY
001A32 E792 FD2A7CF0        20      LD  IY,(_FATBF) ;BPB
001A36 E796 CDF1EF          17      CALL    _BPB2DPB
001A39 E799 FDE1            14      POP IY
001A3B E79B D8              11      RET C
001A3C E79C CD3BE9          17      CALL    CHGDRV2
       E79F                     RDFAT0X:
001A3F E79F CD87E8          17      CALL    RDFATS
001A42 E7A2 D8              11      RET C
001A43 E7A3 DDBE06           7      CP  (IX+6)      ;DPB_06_FATID
001A46 E7A6 C8              11      RET Z
001A47 E7A7 DDCB126E        20      BIT 5,(IX+012H) ;DPB_12_DEVICE
001A4B E7AB C0              11      RET NZ      ;BPBを取得している場合はFATIDをチェックしない
001A4C E7AC 37               4      SCF
001A4D E7AD C9              10      RET
                                
       E7AE                     BPB2DPB:
001A4E E7AE FD7E0B          19      LD  A,(IY+11)   ;BPB_BytsPerSec
001A51 E7B1 B7               4      OR  A
001A52 E7B2 37               4      SCF
001A53 E7B3 C0              11      RET NZ
       E7B4                     BPBOK:
001A54 E7B4 FD7E0D          19      LD  A,(IY+13)   ;BPB_SecPerClus
001A57 E7B7 DD7707          19      LD  (IX+7),A    ;DPB_07_SECPCL
                                
001A5A E7BA FD7E16          19      LD  A,(IY+22)   ;BPB_FATSz16
001A5D E7BD DD7700          19      LD  (IX+0),A    ;DPB_00_FATLN
001A60 E7C0 FD7E17          19      LD  A,(IY+23)   ;BPB_FATSz16
001A63 E7C3 DD7701          19      LD  (IX+1),A    ;DPB_00_FATLN
                                
001A66 E7C6 FD6E0E          19      LD  L,(IY+14)   ;BPB_RsvdSecCnt
001A69 E7C9 FD660F          19      LD  H,(IY+15)
001A6C E7CC DD750E          19      LD  (IX+00EH),L ;DPB_0E_FATPS
001A6F E7CF FD5E16          19      LD  E,(IY+22)   ;BPB_FATSz16
001A72 E7D2 FD5617          19      LD  D,(IY+23)
001A75 E7D5 FD4610          19      LD  B,(IY+16)   ;BPB_NumFATs
       E7D8                     BPBDP1:             ;BPB_FATSz16 * BPB_NumFATs
001A78 E7D8 19              11      ADD HL,DE
001A79 E7D9 10FD            13      DJNZ    BPBDP1
       E7DB                     BPBDP2:
001A7B E7DB DD7510          19      LD  (IX+010H),L ;DPB_10_DIRPS
001A7E E7DE DD7411          19      LD  (IX+011H),H
001A81 E7E1 E5              11      PUSH    HL
                                
001A82 E7E2 FD6E11          19      LD  L,(IY+17)   ;BPB_RootEntCnt
001A85 E7E5 FD6612          19      LD  H,(IY+18)
001A88 E7E8 FD7E0C          19      LD  A,(IY+12)   ;BPB_BytsPerSec
001A8B E7EB B7               4      OR  A
001A8C E7EC 37               4      SCF
001A8D E7ED C8              11      RET Z
001A8E E7EE 0606             7      LD  B,6
       E7F0                     BPBBPS1:
001A90 E7F0 05               4      DEC B
001A91 E7F1 0F               4      RRCA
001A92 E7F2 30FC            12      JR  NC,BPBBPS1
       E7F4                     BPBDE1:
001A94 E7F4 29              11      ADD HL,HL
001A95 E7F5 10FD            13      DJNZ    BPBDE1
                                
001A97 E7F7 7C               4      LD  A,H
001A98 E7F8 DD770B          19      LD  (IX+00BH),A ;DPB_0B_DIRSCNT
                                
001A9B E7FB D1              10      POP DE      ;DPB_10_DIRPS
001A9C E7FC 6C               4      LD  L,H
001A9D E7FD 2600             7      LD  H,0
001A9F E7FF 19              11      ADD HL,DE       ;MAXDIR
001AA0 E800 E5              11      PUSH    HL
001AA1 E801 FD4E0D          19      LD  C,(IY+13)   ;BPB_SecPerClus
001AA4 E804 CB21             8      SLA C       ;*2
001AA6 E806 AF               4      XOR A
001AA7 E807 47               4      LD  B,A
001AA8 E808 ED42            15      SBC HL,BC
001AAA E80A DD7514          19      LD  (IX+014H),L ;DPB_14_ADDCL16
001AAD E80D DD7415          19      LD  (IX+015H),H
                                
001AB0 E810 D1              10      POP DE      ;DE=DPB_0B_MAXDIR
001AB1 E811 FD6E13          19      LD  L,(IY+19)   ;BPB_TotSec16
001AB4 E814 FD6614          19      LD  H,(IY+20)
                                
001AB7 E817 DDCB0A7E        20      BIT 7,(IX+00AH) ;DPB_0A_FDMODE
001ABB E81B 2817            12      JR  Z,NOT_FD
001ABD E81D E5              11      PUSH    HL
001ABE E81E FD4E18          19      LD  C,(IY+24)   ;BPB_SecPerTr
001AC1 E821 DD710D          19      LD  (IX+00DH),C ;DPB_0D_MAXSEC
001AC4 E824 AF               4      XOR A
001AC5 E825 47               4      LD  B,A
001AC6 E826 CB21             8      SLA C       ;両面なのでセクタ数を２倍
001AC8 E828 2B               6      DEC HL
       E829                     CNTSEC:             ;MAXCYL = BPB_TotSec16 / (BPB_SecPerTr * 2)
001AC9 E829 3C               4      INC A
001ACA E82A 2804            12      JR  Z,CNTSECE
001ACC E82C ED42            15      SBC HL,BC
001ACE E82E 30F9            12      JR  NC,CNTSEC
       E830                     CNTSECE:
001AD0 E830 DD770C          19      LD  (IX+00CH),A ;DPB_0C_MAXCYL
001AD3 E833 E1              10      POP HL  ;ここまでフロッピー専用
       E834                     NOT_FD:
001AD4 E834 7C               4      LD  A,H
001AD5 E835 B5               4      OR  L
001AD6 E836 3E00             7      LD  A,0     ;LDでフラグは変化しない。BPB_TotSec16を AHL で扱う為、Aに0を入れる
001AD8 E838 2010            12      JR  NZ,BPB16BIT ;BPB_TotSec16が「0」の場合はBPB_TotSec32で計算
001ADA E83A FD7E23          19      LD  A,(IY+35)   ;念のために総セクタ数が24ビットを超える場合はエラーを返す
001ADD E83D B7               4      OR  A
001ADE E83E 37               4      SCF
001ADF E83F C0              11      RET NZ
001AE0 E840 FD6E20          19      LD  L,(IY+32)   ;BPB_TotSec32 は AHL の24ビットで扱う
001AE3 E843 FD6621          19      LD  H,(IY+33)   ;1クラスタの論理セクタ数(DPB_07_SECPCL)が最大128なので
001AE6 E846 FD7E22          19      LD  A,(IY+34)   ;24ビットを超えると必ずクラスタ数が16ビットを超えてしまうのでこれで十分
001AE9 E849 A7               4      AND A       ;CF=0
       E84A                     BPB16BIT:
001AEA E84A ED52            15      SBC HL,DE
001AEC E84C DE00             7      SBC A,0
001AEE E84E FD460D          19      LD  B,(IY+13)   ;BPB_SecPerClus
       E851                     BPBTC1:             ;総クラスタ数(AHL) = 総セクタ数(AHL) / セクタサイズ(B)
001AF1 E851 CB18             8      RR  B       ;->CY
001AF3 E853 3808            12      JR  C,BPBTC2
001AF5 E855 CB3F             8      SRL A
001AF7 E857 CB1C             8      RR  H       ;AHL=AHL/2
001AF9 E859 CB1D             8      RR  L
001AFB E85B 18F4            12      JR  BPBTC1
       E85D                     BPBTC2:
001AFD E85D B7               4      OR  A
001AFE E85E 37               4      SCF
001AFF E85F C0              11      RET NZ      ;念のため(クラスタ数が16ビットを超える場合)
001B00 E860 23               6      INC HL
001B01 E861 23               6      INC HL
001B02 E862 DD7508          19      LD  (IX+8),L    ;DPB_08_MAXCL
001B05 E865 DD7409          19      LD  (IX+9),H
                                
001B08 E868 FD7E15          19      LD  A,(IY+21)   ;BPB_Media
001B0B E86B DD7706          19      LD  (IX+6),A    ;DPB_06_FATID
                                
001B0E E86E FD7E10          19      LD  A,(IY+16)   ;BPB_NumFATs
001B11 E871 C6FE             7      ADD A,0-2       ;>2:CF=1
001B13 E873 FD7E0C          19      LD  A,(IY+12)   ;BPB_BytsPerSec
001B16 E876 6F               4      LD  L,A
001B17 E877 3002            12      JR  NC,BPBFAT1
001B19 E879 F680             7      OR  080H
       E87B                     BPBFAT1:
001B1B E87B DD770F          19      LD  (IX+00FH),A ;DPB_0F_BPS
001B1E E87E 2D               4      DEC L       ;以下のセクタサイズに合致しない場合はCF=1でエラーにする
001B1F E87F C8              11      RET Z       ;1セクタ256バイト
001B20 E880 2D               4      DEC L
001B21 E881 C8              11      RET Z       ;1セクタ512バイト
001B22 E882 2D               4      DEC L
001B23 E883 2D               4      DEC L
001B24 E884 C8              11      RET Z       ;1セクタ1024バイト
001B25 E885 37               4      SCF
001B26 E886 C9              10      RET
                                
       E887                     RDFATS:
001B27 E887 CDCDE8          17      CALL    FATSETUP
001B2A E88A D8              11      RET C
001B2B E88B CD97E8          17      CALL    DRD24B
001B2E E88E 2A7CF0          16      LD  HL,(_FATBF)
001B31 E891 7E               7      LD  A,(HL)
001B32 E892 C9              10      RET
                                
       E893                     DRD16:
001B33 E893 0E00             7      LD  C,0
       E895                     DRD24:
001B35 E895 0601             7      LD  B,1
       E897                     DRD24B:
001B37 E897 DDE5            15      PUSH    IX
001B39 E899 DD2AA8EF        20      LD  IX,(_DPB)
001B3D E89D CD24EB          17  DRDPAT: CALL    FDRD        ;自己書き換え（ディスク読み込み）
       E8A0                     POP_IX_RET:
001B40 E8A0 DDE1            14      POP IX
001B42 E8A2 C9              10      RET
                                
       E8A3                     DWT16:
001B43 E8A3 0E00             7      LD  C,0
       E8A5                     DWT24:
001B45 E8A5 0601             7      LD  B,1
       E8A7                     DWT24B:
001B47 E8A7 DDE5            15      PUSH    IX
001B49 E8A9 DD2AA8EF        20      LD  IX,(_DPB)
001B4D E8AD CDCAEA          17  DWTPAT: CALL    FDWT        ;自己書き換え（ディスク書き込み）
001B50 E8B0 18EE            12      JR  POP_IX_RET
                                
       E8B2                     WTFAT:
001B52 E8B2 CDCDE8          17      CALL    FATSETUP
001B55 E8B5 D4A7E8          17      CALL    NC,DWT24B
001B58 E8B8 D8              11      RET C
001B59 E8B9 DDCB0F7E        20      BIT 7,(IX+00FH) ;DPB_0F_BPS
001B5D E8BD C8              11      RET Z       ;予備FATが無い
001B5E E8BE CDD4E8          17      CALL    FATS2
001B61 E8C1 E5              11      PUSH    HL      ;予備FAT
001B62 E8C2 DD6E00          19      LD  L,(IX+0)    ;DPB_00_FATLN
001B65 E8C5 DD6601          19      LD  H,(IX+1)
001B68 E8C8 19              11      ADD HL,DE
001B69 E8C9 EB               4      EX  DE,HL
001B6A E8CA E1              10      POP HL
001B6B E8CB 18DA            12      JR  DWT24B
                                ;------------------------
                                ;FATのセットアップ
                                ;out
                                ;   B  : FATセクタ数
                                ;   DE : FAT先頭セクタ番号
                                ;   HL : FATバッファポインタ
                                ;   CF : 1=ドライブ切り替えエラー
                                ;note
                                ;   FATサイズがFATバッファを超える場合は
                                ;   対象クラスタ領域==(_FATIX)によって
                                ;   FAT12:対象クラスタ1024毎に1.5KBを切り替える
                                ;   FAT16:対象クラスタ1024毎に2KBを切り替える
                                ;------------------------
       E8CD                     FATSETUP:
001B6D E8CD 3AAAEF          13      LD  A,(_FATDRV)
001B70 E8D0 CDDCE9          17      CALL    CHGDRVR     ;ドライブ切り替え
001B73 E8D3 D8              11      RET C
       E8D4                     FATS2:
001B74 E8D4 DD7E0F          19      LD  A,(IX+00FH) ;DPB_0F_BPS 512=2 1024=4
001B77 E8D7 0F               4      RRCA
001B78 E8D8 CD01E9          17  FATSX:  CALL    FATSETUP12  ;自己書き換え
001B7B E8DB 210000          10      LD  HL,0
001B7E E8DE 4A               4      LD  C,D
001B7F E8DF 54               4      LD  D,H
001B80 E8E0 3AABEF          13      LD  A,(_FATIX)  ;範囲FAT12:0-3/FAT16:0-63(0-03FH):65535*2/2048
001B83 E8E3 47               4      LD  B,A
001B84 E8E4 04               4      INC B
001B85 E8E5 DD7E00          19      LD  A,(IX+0)    ;DPB_00_FATLN
       E8E8                     FAT_SKP:
001B88 E8E8 05               4      DEC B
001B89 E8E9 2805            12      JR  Z,FAT1
001B8B E8EB 19              11      ADD HL,DE
001B8C E8EC 93               4      SUB E
001B8D E8ED 30F9            12      JR  NC,FAT_SKP
001B8F E8EF C9              10      RET
       E8F0                     FAT1:
001B90 E8F0 EB               4      EX  DE,HL
001B91 E8F1 B9               4      CP  C       ;C=FATバッファに読み込めるセクタ数
001B92 E8F2 3801            12      JR  C,FAT2
001B94 E8F4 79               4      LD  A,C
       E8F5                     FAT2:
001B95 E8F5 47               4      LD  B,A
                                
001B96 E8F6 2AFAF0          16      LD  HL,(_FATPS) ;fat sector pos
001B99 E8F9 19              11      ADD HL,DE
001B9A E8FA EB               4      EX  DE,HL
001B9B E8FB 2A7CF0          16      LD  HL,(_FATBF)
001B9E E8FE AF               4      XOR A       ;CF=0
001B9F E8FF 4F               4      LD  C,A
001BA0 E900 C9              10      RET
                                ;
                                ;   FATバッファに読み込める最大のセクタ数と_FATIXで進めるセクタ数
                                ;   FATSETUP* (FAT12/FAT16)
                                ;out
                                ;   D : FATバッファに読み込める最大のセクタ数
                                ;   E : _FATIXで進めるセクタ数
       E901                     FATSETUP12:
001BA1 E901 110606          10      LD  DE,0606H    ;256
001BA4 E904 D8              11      RET C
001BA5 E905 110303          10      LD  DE,0303H    ;512
001BA8 E908 0F               4      RRCA
001BA9 E909 D8              11      RET C
001BAA E90A 110102          10      LD  DE,0201H    ;1024
001BAD E90D C9              10      RET
                                
       E90E                     FATSETUP16:
001BAE E90E 110808          10      LD  DE,0808H    ;256
001BB1 E911 D8              11      RET C
001BB2 E912 110404          10      LD  DE,0404H
001BB5 E915 0F               4      RRCA            ;512
001BB6 E916 D8              11      RET C
001BB7 E917 110202          10      LD  DE,0202H    ;1024
001BBA E91A C9              10      RET
                                
       E91B                     CHGDRV:
001BBB E91B E5              11      PUSH    HL
001BBC E91C 2189EF          10      LD  HL,_DSK
001BBF E91F BE               7      CP  (HL)
001BC0 E920 280A            12      JR  Z,CHGDRVE
       E922                     CHGDRV1:
001BC2 E922 DDE5            15      PUSH    IX
001BC4 E924 CD2EE9          17      CALL    CHGDRV0
001BC7 E927 3A89EF          13      LD  A,(_DSK)
001BCA E92A DDE1            14      POP IX
       E92C                     CHGDRVE:
001BCC E92C E1              10      POP HL
001BCD E92D C9              10      RET
                                
       E92E                     CHGDRV0:
001BCE E92E 6F               4      LD  L,A
001BCF E92F CDDCEF          17      CALL    _GETDPB
001BD2 E932 D8              11      RET C
001BD3 E933 DD22A8EF        20      LD  (_DPB),IX
001BD7 E937 7D               4      LD  A,L
001BD8 E938 3289EF          13      LD  (_DSK),A
       E93B                     CHGDRV2:
001BDB E93B C5              11      PUSH    BC
001BDC E93C D5              11      PUSH    DE
001BDD E93D ED7392E9        20      LD  (SPPAT2+1),SP
001BE1 E941 F3               4      DI
001BE2 E942 DDF9            10      LD  SP,IX
                                
001BE4 E944 E1              10      POP HL      ;DPB_00_FATLN
001BE5 E945 E1              10      POP HL      ;DPB_02_DRD
001BE6 E946 229EE8          16      LD  (DRDPAT+1),HL
                                
001BE9 E949 E1              10      POP HL
001BEA E94A 22AEE8          16      LD  (DWTPAT+1),HL   ;DPB_04_DWT
                                
001BED E94D E1              10      POP HL      ;L=DPB_06_FATID H=DPB_07_SECPCL
001BEE E94E 7C               4      LD  A,H
001BEF E94F 32ADDF          13      LD  (SPCPAT+1),A    ;1クラスタの論理セクタ数
001BF2 E952 3D               4      DEC A
001BF3 E953 323DE7          13      LD  (NCPAT+1),A
                                
001BF6 E956 E1              10      POP HL      ;DPB_08_MAXCL
001BF7 E957 7D               4      LD  A,L
001BF8 E958 32CCDF          13      LD  (CLPAT2+1),A
001BFB E95B 7C               4      LD  A,H
001BFC E95C 32C8DF          13      LD  (CLPAT1+1),A
001BFF E95F 2B               6      DEC HL
001C00 E960 22D0E1          16      LD  (MAXCLP+1),HL
                                
001C03 E963 E1              10      POP HL      ;L=DPB_0A_FDMODE H=DPB_0B_DIRSCNT
001C04 E964 7D               4      LD  A,L
001C05 E965 F6FE             7      OR  0FEH
001C07 E967 32B3EF          13      LD  (FDMODE+1),A
001C0A E96A 07               4      RLCA
001C0B E96B E603             7      AND 3
001C0D E96D 3269EA          13      LD  (FSPAT+1),A
001C10 E970 4C               4      LD  C,H
                                
001C11 E971 E1              10      POP HL      ;L=DPB_0C_MAXCYL H=DPB_0D_MAXSEC
                                
001C12 E972 E1              10      POP HL      ;L=DPB_0E_FATPS H=DPB_0F_BPS
001C13 E973 7C               4      LD  A,H     ;DPB_0F_BPS
001C14 E974 E607             7      AND 7
001C16 E976 32CBE4          13      LD  (SECSZ+2),A ;1セクタのサイズの上位1バイト 0x400 - 0x200 - 0x100
                                                ;1セクタ512 2D/2DD/2HC/2HQ(2HD1.44MB)/EMM/BRAM/EMEM等
                                                ;1セクタ1024 2HD/2HDE98
                                                ;1セクタ256 GRAM/RAMF/CMOS/等
                                                ;1024   512 256
                                                ;4  2   1
001C19 E979 87               4      ADD A,A     ;8  4   2
001C1A E97A 87               4      ADD A,A     ;010H   8   4
001C1B E97B 87               4      ADD A,A     ;020H   010H    8
001C1C E97C 3229DE          13      LD  (SDECPAT+1),A   ;1セクタ辺りのディレクトリエントリ数
                                
001C1F E97F 2600             7      LD  H,0
001C21 E981 22FAF0          16      LD  (_FATPS),HL
                                
001C24 E984 E1              10      POP HL      ;DPB_10_DIRPS
001C25 E985 22FCF0          16      LD  (_DIRPS),HL
                                
001C28 E988 E1              10      POP HL      ;L=DPB_12_DEVICE H=DPB_13_UNITNO
001C29 E989 7C               4      LD  A,H
001C2A E98A 3284EF          13      LD  (_DRIVE),A
                                
001C2D E98D E1              10      POP HL      ;DPB_14_ADDCL16
001C2E E98E 22BDDF          16      LD  (CLSPAT+1),HL
                                
001C31 E991 310000          10  SPPAT2: LD  SP,0        ;元のSPを復元
001C34 E994 FB               4      EI
001C35 E995 2AFCF0          16      LD  HL,(_DIRPS)
001C38 E998 0600             7      LD  B,0
001C3A E99A 09              11      ADD HL,BC       ;C=DPB_0B_DIRSCNT
001C3B E99B 2244DE          16      LD  (MD_PAT+1),HL
                                
001C3E E99E 2AD0E1          16      LD  HL,(MAXCLP+1);
001C41 E9A1 11F60F          10      LD  DE,4086     ;クラスタ数が4086未満:FAT12 4086以上:FAT16
001C44 E9A4 ED52            15      SBC HL,DE       ;CF=0のはず
001C46 E9A6 300F            12      JR  NC,SETFAT16
001C48 E9A8 21C3E6          10      LD  HL,GNCL     ;FAT12
001C4B E9AB 11E6E6          10      LD  DE,SNCL
001C4E E9AE 0101E9          10      LD  BC,FATSETUP12
001C51 E9B1 DDCB0FAE        23      RES 5,(IX+00FH) ;DPB_0F_BPS(FAT12)
001C55 E9B5 180D            12      JR  EXTRA1
       E9B7                     SETFAT16:
001C57 E9B7 211AE7          10      LD  HL,GNCL16   ;FAT16
001C5A E9BA 1127E7          10      LD  DE,SNCL16
001C5D E9BD 010EE9          10      LD  BC,FATSETUP16
001C60 E9C0 DDCB0FEE        23      SET 5,(IX+00FH) ;DPB_0F_BPS(FAT16)
       E9C4                     EXTRA1:
001C64 E9C4 22F8EF          16      LD  (GNCPAT+1),HL
001C67 E9C7 ED53FBEF        20      LD  (SNCPAT+1),DE
001C6B E9CB ED43D9E8        20      LD  (FATSX+1),BC
001C6F E9CF D1              10      POP DE
001C70 E9D0 C1              10      POP BC
001C71 E9D1 AF               4      XOR A
001C72 E9D2 C9              10      RET
                                
       E9D3                     GETDPBD:
001C73 E9D3 DDE3            23      EX  (SP),IX
001C75 E9D5 DDE5            15      PUSH    IX
001C77 E9D7 3A88EF          13      LD  A,(_DRV)
001C7A E9DA 1807            12      JR  GETDPB1
                                
       E9DC                     CHGDRVR:
001C7C E9DC CDD9EF          17      CALL    _CHGDRV
001C7F E9DF D8              11      RET C
001C80 E9E0 3A89EF          13      LD  A,(_DSK)
       E9E3                     GETDPB1:
001C83 E9E3 C3DCEF          10      JP  _GETDPB
                                
       E9E6                     GETDPB:
001C86 E9E6 FE08             7      CP  8
001C88 E9E8 3F               4      CCF
001C89 E9E9 D8              11      RET C
001C8A E9EA 0F               4      RRCA
001C8B E9EB 0F               4      RRCA
001C8C E9EC 0F               4      RRCA
001C8D E9ED DD                      DB  0DDH        ;Z80未定義命令
001C8E E9EE 6F               4      LD  L,A     ;LD IXL,A
001C8F E9EF DD                      DB  0DDH        ;Z80未定義命令
001C90 E9F0 26F1             7      LD  H,DEVICE/256    ;LD IXH,DEVICE/256
001C92 E9F2 DD7E00          19      LD  A,(IX+0)    ;DPB_00_FATLN
001C95 E9F5 A7               4      AND A       ;CF=0の為
001C96 E9F6 DDCB0F6E        20      BIT 5,(IX+00FH) ;DPB_0F_BPS
001C9A E9FA C0              11      RET NZ      ;FAT16
001C9B E9FB DDCB126E        20      BIT 5,(IX+012H) ;DPB_12_DEVICE
001C9F E9FF C0              11      RET NZ      ;BPB
001CA0 EA00 FE01             7      CP  001H        ;A=0 THEN CF=1
001CA2 EA02 C9              10      RET
                                
       EA03                     _SYS5F:
001CA3 EA03 AF               4      XOR A
       EA04                     FFLUSH:
001CA4 EA04 F5              11      PUSH    AF
001CA5 EA05 3EFF             7      LD  A,0FFH
001CA7 EA07 3239EF          13      LD  (SFILE),A
001CAA EA0A CD01E6          17      CALL    DWTX
001CAD EA0D 3EFF             7      LD  A,0FFH
001CAF EA0F 32A5EF          13      LD  (_DBDRV),A
001CB2 EA12 CD4BE6          17      CALL    WTFATX
001CB5 EA15 AF               4      XOR A
001CB6 EA16 32ABEF          13      LD  (_FATIX),A
001CB9 EA19 2F               4      CPL         ;0FFH
001CBA EA1A 32AAEF          13      LD  (_FATDRV),A
001CBD EA1D F1              10      POP AF
001CBE EA1E C9              10      RET
                                
[EOF:LDDIO.ASM:SHIFT_JIS]
                                    INCLUDE "M7DISK.ASM"
                                
                                ;   LSX-Dodgers DISK
                                ;   MZ-700/1500
                                
       EA1F                     SEEK:
001CBF EA1F 0610             7      LD  B,16
001CC1 EA21 DD4E0D          19  MAXSEC: LD  C,(IX+0DH)  ;DPB_0D_MAXSEC
001CC4 EA24 AF               4      XOR A
001CC5 EA25 EB               4      EX  DE,HL
       EA26                     DIV1:
001CC6 EA26 29              11      ADD HL,HL
001CC7 EA27 8F               4      ADC A,A
001CC8 EA28 B9               4      CP  C
001CC9 EA29 3802            12      JR  C,DIV2
001CCB EA2B 91               4      SUB C
001CCC EA2C 2C               4      INC L
       EA2D                     DIV2:
001CCD EA2D 10F7            13      DJNZ    DIV1
                                
001CCF EA2F 3C               4      INC A   ;最小のセクタは１固定
001CD0 EA30 55               4      LD  D,L ;TRACK
001CD1 EA31 5F               4      LD  E,A ;SECTOR
                                
001CD2 EA32 3A84EF          13      LD  A,(_DRIVE)
001CD5 EA35 FE04             7      CP  4
001CD7 EA37 3F               4      CCF
001CD8 EA38 D8              11      RET C
001CD9 EA39 F684             7      OR  084H        ;Motor on + ドライブセレクト有効
001CDB EA3B D3DC            11      OUT (0DCH),A
001CDD EA3D CB3A             8      SRL D       ;CYLINDER
001CDF EA3F 9F               4      SBC A,A
001CE0 EA40 D3DD            11      OUT (0DDH),A    ;SIDE
                                
001CE2 EA42 CD7FEA          17      CALL    SETMODE
001CE5 EA45 D8              11      RET C
                                
001CE6 EA46 CDB4EA          17      CALL    DRIVE
001CE9 EA49 FEFF             7      CP  0FFH        ;A=0FFH Unknown CYLINDER
001CEB EA4B CC9BEA          17      CALL    Z,FDCRES    ;Restore
001CEE EA4E 2F               4      CPL         ;データバスが負論理
001CEF EA4F D3D9            11      OUT (0D9H),A    ;Currrent CYLINDER
001CF1 EA51 2F               4      CPL         ;データバスが負論理
001CF2 EA52 92               4      SUB D
001CF3 EA53 C8              11      RET Z       ;No seek
                                
001CF4 EA54 3A86EF          13      LD  A,(_ISEEK)
001CF7 EA57 4F               4      LD  C,A
                                
001CF8 EA58 DD7E0C          19      LD  A,(IX+00CH) ;DPB_0C_MAXCYL
001CFB EA5B 3D               4      DEC A
001CFC EA5C BA               4      CP  D       ;Over CYLINDER
001CFD EA5D D8              11      RET C
                                
001CFE EA5E 7A               4      LD  A,D
001CFF EA5F 2F               4      CPL         ;データバスが負論理
001D00 EA60 D3DB            11      OUT (0DBH),A
001D02 EA62 72               7      LD  (HL),D
                                
001D03 EA63 0E18             7      LD  C,018H      ;Seek
       EA65                     FDCCMD2:
001D05 EA65 3A85EF          13      LD  A,(_SEEKSP)
001D08 EA68 E6FF             7  FSPAT:  AND 0FFH
001D0A EA6A B1               4      OR  C
                                
       EA6B                     FDCCMD:
001D0B EA6B CDABEA          17      CALL    COMSET
       EA6F                     FDCSMC  EQU $+1
001D0E EA6E 3E80             7      LD  A,080H      ;FDC COMMAND(Self-modifying code)
001D10 EA70 E620             7      AND 020H        ;Write data Write track
001D12 EA72 3C               4      INC A
                                
       EA73                     SST:
001D13 EA73 0E00             7      LD  C,0
       EA75                     SST1:
001D15 EA75 0D               4      DEC C       ; 4
001D16 EA76 20FD            12      JR  NZ,SST1     ;12 * 256 / 4 = About 1ms
001D18 EA78 3D               4      DEC A
001D19 EA79 20FA            12      JR  NZ,SST1
                                
001D1B EA7B 3C               4      INC A       ;A=1
001D1C EA7C CD84EA          17      CALL    READY
       EA7F                     SETMODE:
001D1F EA7F CDAEEA          17      CALL    DELAY0      ;Head select time
001D22 EA82 3E81             7      LD  A,081H
       EA84                     READY:
001D24 EA84 328EEA          13      LD  (WAITA),A
001D27 EA87 E5              11      PUSH    HL
001D28 EA88 26F8             7      LD  H,0F8H
       EA8A                     READY2:
001D2A EA8A DBD8            11      IN  A,(0D8H)
001D2C EA8C 2F               4      CPL         ;データバスが負論理
       EA8E                     WAITA   EQU $+1
001D2D EA8D E681             7      AND 081H        ;NOT READY,BUSY
001D2F EA8F 2808            12      JR  Z,READYE
001D31 EA91 E3              19      EX  (SP),HL     ;wait 19clock
001D32 EA92 E3              19      EX  (SP),HL     ; //
001D33 EA93 2B               6      DEC HL
001D34 EA94 7C               4      LD  A,H
001D35 EA95 B5               4      OR  L
001D36 EA96 20F2            12      JR  NZ,READY2
001D38 EA98 37               4      SCF
       EA99                     READYE:
001D39 EA99 E1              10      POP HL
001D3A EA9A C9              10      RET
                                
       EA9B                     FDCRES:
001D3B EA9B 3600            10      LD  (HL),0
001D3D EA9D 0E08             7      LD  C,8
001D3F EA9F 18C4            12      JR  FDCCMD2
                                
       EAA1                     FDMOFF:
001D41 EAA1 AF               4      XOR A       ;Motor off(ドライブセレクト無効)
001D42 EAA2 D3DC            11      OUT (0DCH),A
001D44 EAA4 C9              10      RET
                                
       EAA5                     SECSET:
001D45 EAA5 F5              11      PUSH    AF
001D46 EAA6 7B               4      LD  A,E
001D47 EAA7 2F               4      CPL         ;データバスが負論理
001D48 EAA8 D3DA            11      OUT (0DAH),A
001D4A EAAA F1              10      POP AF
       EAAB                     COMSET:
001D4B EAAB 2F               4      CPL         ;データバスが負論理
001D4C EAAC D3D8            11      OUT (0D8H),A
       EAAE                     DELAY0:
001D4E EAAE 3E1A             7      LD  A,26
       EAB0                     DELAY:
001D50 EAB0 3D               4      DEC A
001D51 EAB1 20FD            12      JR  NZ,DELAY
001D53 EAB3 C9              10      RET
                                
       EAB4                     DRIVE:
001D54 EAB4 2A84EF          16      LD  HL,(_DRIVE)
001D57 EAB7 26EF             7      LD  H,_CYL0/256
001D59 EAB9 CBFD             8      SET 7,L
001D5B EABB 7E               7      LD  A,(HL)
001D5C EABC C9              10      RET
                                
       EABD                     RNF:
001D5D EABD CDB4EA          17      CALL    DRIVE
001D60 EAC0 36FF            10      LD  (HL),0FFH
001D62 EAC2 C9              10      RET
                                
001D63 EAC3 02                  RETRY:  DB  2
                                
                                
                                ;   FLOPPY DISK DRIVER
                                
       EAC4                     WTTRK:
001D64 EAC4 0601             7      LD  B,1
001D66 EAC6 3EF4             7      LD  A,0F4H
001D68 EAC8 1802            12      JR  WTTRK1
       EACA                     FDWT:
001D6A EACA 3EA0             7      LD  A,0A0H
       EACC                     WTTRK1:
001D6C EACC 326FEA          13      LD  (FDCSMC),A
       EACF                     DWTBL:
001D6F EACF 78               4      LD  A,B
001D70 EAD0 320FEB          13      LD  (WTBSMC),A
001D73 EAD3 3E02             7      LD  A,2     ;Retry count
001D75 EAD5 32C3EA          13      LD  (RETRY),A
                                
       EAD8                     DWT0:
001D78 EAD8 D5              11      PUSH    DE
001D79 EAD9 E5              11      PUSH    HL
001D7A EADA CD1FEA          17      CALL    SEEK        ;Write disk
001D7D EADD E1              10      POP HL
001D7E EADE 383A            12      JR  C,ERRDW
001D80 EAE0 F3               4      DI
001D81 EAE1 3A6FEA          13      LD  A,(FDCSMC)
001D84 EAE4 CDA5EA          17      CALL    SECSET
001D87 EAE7 0EDB             7      LD  C,0DBH
       EAE9                     DWT1:
001D89 EAE9 7E               7      LD  A,(HL)
001D8A EAEA 2F               4      CPL         ;データバスが負論理
001D8B EAEB 57               4      LD  D,A
                                
       EAEC                     DWT2:
001D8C EAEC DBD8            11      IN  A,(0D8H)
001D8E EAEE 2F               4      CPL         ;データバスが負論理
001D8F EAEF 0F               4      RRCA
001D90 EAF0 3008            12      JR  NC,DWT4
001D92 EAF2 0F               4      RRCA
001D93 EAF3 30F7            12      JR  NC,DWT2
       EAF5                     DWT3:
001D95 EAF5 ED51            12      OUT (C),D
001D97 EAF7 23               6      INC HL
001D98 EAF8 18EF            12      JR  DWT1
                                
       EAFA                     DWT4:
001D9A EAFA 3D               4      DEC A
001D9B EAFB 28F8            12      JR  Z,DWT3
001D9D EAFD 3C               4      INC A
001D9E EAFE FB               4      EI
001D9F EAFF D1              10      POP DE
001DA0 EB00 13               6      INC DE
001DA1 EB01 CDA1EA          17      CALL    FDMOFF
001DA4 EB04 2808            12      JR  Z,DISKOK_WT
001DA6 EB06 CD71EB          17      CALL    DISKC
001DA9 EB09 20CD            12      JR  NZ,DWT0
001DAB EB0B B7               4      OR  A
001DAC EB0C 2005            12      JR  NZ,ERRW
                                
       EB0E                     DISKOK_WT:
       EB0F                     WTBSMC  EQU $+1
001DAE EB0E 0601             7      LD  B,1
001DB0 EB10 10BD            13      DJNZ    DWTBL
001DB2 EB12 C9              10      RET
                                
       EB13                     ERRW:
001DB3 EB13 3EFF             7      LD  A,0FFH
       EB15                     ERRZ:
001DB5 EB15 BF               4      CP  A
001DB6 EB16 37               4      SCF
001DB7 EB17 C3A1EA          10      JP  FDMOFF
                                
       EB1A                     ERRDW:
001DBA EB1A D1              10      POP DE
001DBB EB1B CD82EB          17      CALL    DELP
001DBE EB1E 20B8            12      JR  NZ,DWT0
001DC0 EB20 B7               4      OR  A
001DC1 EB21 20F0            12      JR  NZ,ERRW
001DC3 EB23 C9              10      RET
                                
       EB24                     FDRD:
001DC4 EB24 3E80             7      LD  A,080H
001DC6 EB26 326FEA          13      LD  (FDCSMC),A
       EB29                     DRDBL:
001DC9 EB29 78               4      LD  A,B
001DCA EB2A 3263EB          13      LD  (RDBSMC),A
001DCD EB2D 3E02             7      LD  A,2     ;Retry count
001DCF EB2F 32C3EA          13      LD  (RETRY),A
       EB32                     DRD0:
001DD2 EB32 D5              11      PUSH    DE
001DD3 EB33 E5              11      PUSH    HL
001DD4 EB34 CD1FEA          17      CALL    SEEK        ;Read disk
001DD7 EB37 E1              10      POP HL
001DD8 EB38 382D            12      JR  C,ERRDR
001DDA EB3A F3               4      DI
001DDB EB3B 3A6FEA          13      LD  A,(FDCSMC)
001DDE EB3E CDA5EA          17      CALL    SECSET
       EB41                     DRD1:
001DE1 EB41 DBD8            11      IN  A,(0D8H)
001DE3 EB43 2F               4      CPL         ;データバスが負論理
001DE4 EB44 0F               4      RRCA
001DE5 EB45 300A            12      JR  NC,DRD3
001DE7 EB47 0F               4      RRCA
001DE8 EB48 30F7            12      JR  NC,DRD1
001DEA EB4A DBDB            11      IN  A,(0DBH)
001DEC EB4C 2F               4      CPL         ;データバスが負論理
001DED EB4D 77               7      LD  (HL),A
001DEE EB4E 23               6      INC HL
001DEF EB4F 18F0            12      JR  DRD1
                                
       EB51                     DRD3:
001DF1 EB51 B7               4      OR  A
001DF2 EB52 FB               4      EI
001DF3 EB53 D1              10      POP DE
001DF4 EB54 13               6      INC DE
001DF5 EB55 CDA1EA          17      CALL    FDMOFF
001DF8 EB58 2808            12      JR  Z,DISKOK_RD
001DFA EB5A CD71EB          17      CALL    DISKC
001DFD EB5D 20D3            12      JR  NZ,DRD0
001DFF EB5F B7               4      OR  A
001E00 EB60 20B1            12      JR  NZ,ERRW
                                
       EB62                     DISKOK_RD:
       EB63                     RDBSMC  EQU $+1
001E02 EB62 0601             7      LD  B,1
001E04 EB64 10C3            13      DJNZ    DRDBL
001E06 EB66 C9              10      RET
                                
       EB67                     ERRDR:
001E07 EB67 D1              10      POP DE
001E08 EB68 CD82EB          17      CALL    DELP
001E0B EB6B 20C5            12      JR  NZ,DRD0
001E0D EB6D B7               4      OR  A
001E0E EB6E 20A3            12      JR  NZ,ERRW
001E10 EB70 C9              10      RET
       EB71                     DISKC:
001E11 EB71 1B               6      DEC DE
001E12 EB72 CB5F             8      BIT 3,A
001E14 EB74 C4BDEA          17      CALL    NZ,RNF
       EB77                     DISKD:
001E17 EB77 E5              11      PUSH    HL
001E18 EB78 21C3EA          10      LD  HL,RETRY
001E1B EB7B 35              11      DEC (HL)
001E1C EB7C E1              10      POP HL
001E1D EB7D 200C            12      JR  NZ,ERR      ;Retry
001E1F EB7F B7               4      OR  A
001E20 EB80 2809            12      JR  Z,ERR       ;Error
                                
       EB82                     DELP:
001E22 EB82 CDBDEA          17      CALL    RNF
001E25 EB85 CDA1EA          17      CALL    FDMOFF
001E28 EB88 3EFF             7      LD  A,0FFH
       EB8A                     AERRZ:
001E2A EB8A BF               4      CP  A
       EB8B                     ERR:
001E2B EB8B 3EFF             7      LD  A,0FFH
001E2D EB8D C9              10      RET
                                
       EFB2                     FDMODE  EQU TVRAMTOP
[EOF:M7DISK.ASM:SHIFT_JIS]
                                    INCLUDE "M7DISK2.ASM"
                                
                                ;   LSX-Dodgers DISK2
                                ;   MZ-700/1500
                                
                                ;   EMM DRIVER
                                ;   1セクタ可変(256/512/1024)
                                
       EB8E                     EDWT:
001E2E EB8E F5              11      PUSH    AF
001E2F EB8F CDADEB          17      CALL    EADR
001E32 EB92 0600             7      LD  B,0
       EB94                     EDWT1:
001E34 EB94 EDB3                    OTIR
001E36 EB96 3D               4      DEC A
001E37 EB97 20FB            12      JR  NZ,EDWT1
001E39 EB99 180B            12      JR  EDRW1
                                
       EB9B                     EDRD:
001E3B EB9B C5              11      PUSH    BC
001E3C EB9C CDADEB          17      CALL    EADR
001E3F EB9F 0600             7      LD  B,0
       EBA1                     EDRD1:
001E41 EBA1 EDB2                    INIR
001E43 EBA3 3D               4      DEC A
001E44 EBA4 20FB            12      JR  NZ,EDRD1
       EBA6                     EDRW1:
001E46 EBA6 F1              10      POP AF
001E47 EBA7 83               4      ADD A,E ;セクタを進める
001E48 EBA8 5F               4      LD  E,A
001E49 EBA9 8A               4      ADC A,D
001E4A EBAA 93               4      SUB E
001E4B EBAB 57               4      LD  D,A
001E4C EBAC C9              10      RET
                                
       EBAD                     EADR:
001E4D EBAD C5              11      PUSH    BC
001E4E EBAE D5              11      PUSH    DE
001E4F EBAF EB               4      EX  DE,HL
001E50 EBB0 29              11      ADD HL,HL
001E51 EBB1 DD4E0D          19      LD  C,(IX+00DH) ;DPB_0D_MAXSEC
001E54 EBB4 DD460C          19      LD  B,(IX+00CH) ;DPB_0C_MAXCYL
001E57 EBB7 09              11      ADD HL,BC
001E58 EBB8 DD4E13          19      LD  C,(IX+013H) ;DPB_13_UNITNO
001E5B EBBB ED49            12      OUT (C),C
001E5D EBBD 0C               4      INC C
001E5E EBBE ED69            12      OUT (C),L
001E60 EBC0 0C               4      INC C
001E61 EBC1 ED61            12      OUT (C),H
001E63 EBC3 0C               4      INC C
001E64 EBC4 EB               4      EX  DE,HL
001E65 EBC5 D1              10      POP DE
001E66 EBC6 DD460F          19      LD  B,(IX+00FH) ;DPB_0F_BPS
001E69 EBC9 F1              10      POP AF
       EBCA                     EADR1:              ;読み込むセクタ数と1クラスタのセクタ数を掛ける
001E6A EBCA CB18             8      RR  B
001E6C EBCC D8              11      RET C
001E6D EBCD 87               4      ADD A,A
001E6E EBCE 18FA            12      JR  EADR1
                                
                                ;   CMOS BACKUP MEMORY DRIVER(32KB)
                                ;   1セクタ256
                                
       EBD0                     CDWT:
001E70 EBD0 78               4      LD  A,B
001E71 EBD1 DD4E13          19      LD  C,(IX+013H) ;DPB_13_UNITNO
001E74 EBD4 ED40            12      IN  B,(C)       ;アドレスカウンタを0000にリセット
001E76 EBD6 ED59            12      OUT (C),E       ;W)アドレスカウンタ上位
001E78 EBD8 0C               4      INC C       ;C=F9
001E79 EBD9 0C               4      INC C       ;C=FA
001E7A EBDA 0600             7      LD  B,0
       EBDC                     CDWT1:
001E7C EBDC EDB3                    OTIR            ;W)データ書き込み・アドレスカウンタ+1
001E7E EBDE 13               6      INC DE
001E7F EBDF 3D               4      DEC A
001E80 EBE0 20FA            12      JR  NZ,CDWT1
001E82 EBE2 A7               4      AND A
001E83 EBE3 C9              10      RET
                                
       EBE4                     CDRD:
001E84 EBE4 78               4      LD  A,B
001E85 EBE5 DD4E13          19      LD  C,(IX+013H) ;DPB_13_UNITNO
001E88 EBE8 ED40            12      IN  B,(C)       ;アドレスカウンタを0000にリセット
001E8A EBEA ED59            12      OUT (C),E       ;W)アドレスカウンタ上位
001E8C EBEC 0C               4      INC C       ;C=F9
001E8D EBED 0600             7      LD  B,0
       EBEF                     CDRD1:
001E8F EBEF EDB2                    INIR            ;R)データ読み出し・アドレスカウンタ+1
001E91 EBF1 13               6      INC DE
001E92 EBF2 3D               4      DEC A
001E93 EBF3 20FA            12      JR  NZ,CDRD1
001E95 EBF5 A7               4      AND A
001E96 EBF6 C9              10      RET
                                
                                ;   RAM DISK DRIVER (64KB)
                                ;   1セクタ256
                                
       EBF7                     RDWT:
001E97 EBF7 78               4      LD  A,B
001E98 EBF8 43               4      LD  B,E     ;B=アドレスカウンタ上位
001E99 EBF9 0EEB             7      LD  C,0EBH
001E9B EBFB ED71            12      OUT (C),0       ;0=アドレスカウンタ下位
001E9D EBFD 0D               4      DEC C       ;EA(W)データ書き込み・アドレスカウンタ+1
001E9E EBFE 0600             7      LD  B,0
       EC00                     RDWT1:
001EA0 EC00 EDB3                    OTIR
001EA2 EC02 13               6      INC DE
001EA3 EC03 3D               4      DEC A
001EA4 EC04 20FA            12      JR  NZ,RDWT1
001EA6 EC06 A7               4      AND A
001EA7 EC07 C9              10      RET
                                
       EC08                     RDRD:
001EA8 EC08 78               4      LD  A,B
001EA9 EC09 43               4      LD  B,E     ;B=アドレスカウンタ上位
001EAA EC0A 0EEB             7      LD  C,0EBH
001EAC EC0C ED71            12      OUT (C),0       ;0=アドレスカウンタ下位
001EAE EC0E 0D               4      DEC C       ;EA(R)データ読み出し・アドレスカウンタ+1
001EAF EC0F 0600             7      LD  B,0
       EC11                     RDRD1:
001EB1 EC11 EDB2                    INIR
001EB3 EC13 13               6      INC DE
001EB4 EC14 3D               4      DEC A
001EB5 EC15 20FA            12      JR  NZ,RDRD1
001EB7 EC17 A7               4      AND A
001EB8 EC18 C9              10      RET
[EOF:M7DISK2.ASM:UTF_8]
                                
                                    INCLUDE "M7TABLE.ASM"
                                
                                ;   LSX-Dodgers TABLE 表示関連のテーブル
                                ;   MZ-700/1500
                                
       EC19                     AT_TABLE:
001EB9 EC19                         DS  TABLEAD-AT_TABLE
                                
       EC40                     KEY_TABLE:
001EE0 EC40 12081E1F1C1D5C2F        DB  12H,08H,1EH,1FH,1CH,1DH,5CH,'/'
001EE8 EC48 5C5E2D2030392C2E        DB  5CH,'^','-',20H,'0','9',',','.'
001EF0 EC50 3132333435363738        DB  '1','2','3','4','5','6','7','8'
001EF8 EC58 6162636465666768        DB  'a','b','c','d','e','f','g','h'
001F00 EC60 696A6B6C6D6E6F70        DB  'i','j','k','l','m','n','o','p'
001F08 EC68 7172737475767778        DB  'q','r','s','t','u','v','w','x'
001F10 EC70 797A405B5D000000        DB  'y','z','@','[',']',00H,00H,00H
001F18 EC78 001B3D09003B3A0D        DB  00H,1BH,'=',09H,00H,';',':',0DH
       EC80                     SHIFT_TABLE:
001F20 EC80 12081E1F1C1D5F3F        DB  12H,08H,1EH,1FH,1CH,1DH,'_','?'
001F28 EC88 7C7E3D2030293C3E        DB  '|','~','=',20H,'0',')','<','>'
001F30 EC90 2122232425262728        DB  '!','"','#','$','%','&',27H,'('
001F38 EC98 4142434445464748        DB  'A','B','C','D','E','F','G','H'
001F40 ECA0 494A4B4C4D4E4F50        DB  'I','J','K','L','M','N','O','P'
001F48 ECA8 5152535455565758        DB  'Q','R','S','T','U','V','W','X'
001F50 ECB0 595A607B7D000000        DB  'Y','Z','`','{','}',00H,00H,00H
001F58 ECB8 00003D09002B2A0D        DB  00H,00H,'=',09H,00H,'+','*',0DH
       ECC0                     CTRL_TABLE:
001F60 ECC0 12081E1F1C1D3F2F        DB  12H,08H,1EH,1FH,1CH,1DH,'?','/'
001F68 ECC8 2A2B2D2030392C2E        DB  '*','+','-',20H,'0','9',',','.'
001F70 ECD0 3132333435363738        DB  '1','2','3','4','5','6','7','8'
001F78 ECD8 0102030405060708        DB  01H,02H,03H,04H,05H,06H,07H,08H
001F80 ECE0 090A0B0C0D0E0F10        DB  09H,0AH,0BH,0CH,0DH,0EH,0FH,10H
001F88 ECE8 1112131415161718        DB  11H,12H,13H,14H,15H,16H,17H,18H
001F90 ECF0 191A1B5B5D000000        DB  19H,1AH,1BH,'[',']',00H,00H,00H
001F98 ECF8 00003D09003B3A0D        DB  00H,00H,'=',09H,00H,';',':',0DH
                                
                                ;   アドレス下位1バイトが0になるように
       ED00                     CD_TABLE:
001FA0 ED00 00D1D2D3D4D5D6D0        DB  $00,$D1,$D2,$D3,$D4,$D5,$D6,$D0 ;月火水木金土日
001FA8 ED08 D8DCD9DADBD7CFCE        DB  $D8,$DC,$D9,$DA,$DB,$D7,$CF,$CE ;年円時分秒
001FB0 ED10 601F5F5E1E1B7978        DB  $60,$1F,$5F,$5E,$1E,$1B,$79,$78 ;
001FB8 ED18 5C5D1C1D6DCACDC7        DB  $5C,$5D,$1C,$1D,$6D,$CA,$CD,$C7 ;
001FC0 ED20 0061626364656667        DB  $00,$61,$62,$63,$64,$65,$66,$67 ; !"#$%&'
001FC8 ED28 68696B6A2F2A2E2D        DB  $68,$69,$6B,$6A,$2F,$2A,$2E,$2D ;()*+,-./
001FD0 ED30 2021222324252627        DB  $20,$21,$22,$23,$24,$25,$26,$27 ;01234567
001FD8 ED38 28294F2C512B5749        DB  $28,$29,$4F,$2C,$51,$2B,$57,$49 ;89:;<=>?
001FE0 ED40 5501020304050607        DB  $55,$01,$02,$03,$04,$05,$06,$07 ;@ABCDEFG
001FE8 ED48 08090A0B0C0D0E0F        DB  $08,$09,$0A,$0B,$0C,$0D,$0E,$0F ;HIJKLMNO
001FF0 ED50 1011121314151617        DB  $10,$11,$12,$13,$14,$15,$16,$17 ;PQRSTUVW
001FF8 ED58 18191A52DD54507C        DB  $18,$19,$1A,$52,$DD,$54,$50,$7C ;XYZ[\]^_
002000 ED60 5901020304050607        DB  $59,$01,$02,$03,$04,$05,$06,$07 ;`abcdefg   ATB:1
002008 ED68 08090A0B0C0D0E0F        DB  $08,$09,$0A,$0B,$0C,$0D,$0E,$0F ;hijklmno   ATB:1
002010 ED70 1011121314151617        DB  $10,$11,$12,$13,$14,$15,$16,$17 ;pqrstuvw   ATB:1
002018 ED78 18191ACB35CC705A        DB  $18,$19,$1A,$CB,$35,$CC,$70,$5A ;xyz{|}~    ATB:1
002020 ED80 415346444847B49E        DB  $41,$53,$46,$44,$48,$47,$B4,$9E ;トランプ〇●をぁ   ATB:1
002028 ED88 B2B6BABE9FB3B7BB        DB  $B2,$B6,$BA,$BE,$9F,$B3,$B7,$BB ;ぃぅぇぉゃゅょっ   ATB:1
002030 ED90 BFA385A4A5A69487        DB  $BF,$A3,$85,$A4,$A5,$A6,$94,$87 ;ーあいうえおかき   ATB:1
002038 ED98 889C829884929083        DB  $88,$9C,$82,$98,$84,$92,$90,$83 ;くけこさしすせそ   ATB:1
002040 EDA0 F0BD9DB1B5B9B49E        DB  $F0,$BD,$9D,$B1,$B5,$B9,$B4,$9E ;　。「」、・ヲァ
002048 EDA8 B2B6BABE9FB3B7BB        DB  $B2,$B6,$BA,$BE,$9F,$B3,$B7,$BB ;ィゥェォャョュッ
002050 EDB0 BFA385A4A5A69487        DB  $BF,$A3,$85,$A4,$A5,$A6,$94,$87 ;ーアイウエオカキ
002058 EDB8 889C829884929083        DB  $88,$9C,$82,$98,$84,$92,$90,$83 ;クケコサシスセソ
002060 EDC0 91819A97939589A1        DB  $91,$81,$9A,$97,$93,$95,$89,$A1 ;タチツテトナニヌ
002068 EDC8 AF8B8696A2ABAA8A        DB  $AF,$8B,$86,$96,$A2,$AB,$AA,$8A ;ネノハヒフヘホマ
002070 EDD0 8EB0AD8DA7A8A98F        DB  $8E,$B0,$AD,$8D,$A7,$A8,$A9,$8F ;ミムメモヤユヨラ
002078 EDD8 8CAEAC9BA099BCB8        DB  $8C,$AE,$AC,$9B,$A0,$99,$BC,$B8 ;リルレロワン゛゜
002080 EDE0 91819A97939589A1        DB  $91,$81,$9A,$97,$93,$95,$89,$A1 ;たちつてとねにぬ   ATB:1
002088 EDE8 AF8B8696A2ABAA8A        DB  $AF,$8B,$86,$96,$A2,$AB,$AA,$8A ;ねのはひふへほま   ATB:1
002090 EDF0 8EB0AD8DA7A8A98F        DB  $8E,$B0,$AD,$8D,$A7,$A8,$A9,$8F ;みむめもやゆよら   ATB:1
002098 EDF8 8CAEAC9BA099BCB8        DB  $8C,$AE,$AC,$9B,$A0,$99,$BC,$B8 ;りるれろわん゛゜   ATB:1
       EE00                     DC_TABLE:
0020A0 EE00 2041424344454647        DB  $20,$41,$42,$43,$44,$45,$46,$47 ;0
0020A8 EE08 48494A4B4C4D4E4F        DB  $48,$49,$4A,$4B,$4C,$4D,$4E,$4F
0020B0 EE10 5051525354555657        DB  $50,$51,$52,$53,$54,$55,$56,$57 ;1
0020B8 EE18 58595A151A1B1411        DB  $58,$59,$5A,$15,$1A,$1B,$14,$11
0020C0 EE20 3031323334353637        DB  $30,$31,$32,$33,$34,$35,$36,$37 ;2
0020C8 EE28 38392D3D3B2F2E2C        DB  $38,$39,$2D,$3D,$3B,$2F,$2E,$2C
0020D0 EE30 00000000007C0000        DB  $00,$00,$00,$00,$00,$7C,$00,$00 ;3
0020D8 EE38 0000000000000000        DB  $00,$00,$00,$00,$00,$00,$00,$00
0020E0 EE40 0080000083008285        DB  $00,$80,$00,$00,$83,$00,$82,$85 ;4
0020E8 EE48 843F00000000003A        DB  $84,$3F,$00,$00,$00,$00,$00,$3A
0020F0 EE50 5E3C5B815D40003E        DB  $5E,$3C,$5B,$81,$5D,$40,$00,$3E ;5
0020F8 EE58 00607F0018191312        DB  $00,$60,$7F,$00,$18,$19,$13,$12
002100 EE60 1021222324252627        DB  $10,$21,$22,$23,$24,$25,$26,$27 ;6
002108 EE68 28292B2A001C0000        DB  $28,$29,$2B,$2A,$00,$1C,$00,$00
002110 EE70 7E00000000000000        DB  $7E,$00,$00,$00,$00,$00,$00,$00 ;7
002118 EE78 171600005F000000        DB  $17,$16,$00,$00,$5F,$00,$00,$00
002120 EE80 00C19A9F9C92CA97        DB  $00,$C1,$9A,$9F,$9C,$92,$CA,$97 ;8
002128 EE88 98C6CFC9D8D3D0D7        DB  $98,$C6,$CF,$C9,$D8,$D3,$D0,$D7
002130 EE90 9EC09DC496C5CBC3        DB  $9E,$C0,$9D,$C4,$96,$C5,$CB,$C3 ;9
002138 EE98 9BDDC2DB99A2878C        DB  $9B,$DD,$C2,$DB,$99,$A2,$87,$8C
002140 EEA0 DCC7CC91939495D4        DB  $DC,$C7,$CC,$91,$93,$94,$95,$D4 ;A
002148 EEA8 D5D6CECDDAD2D9C8        DB  $D5,$D6,$CE,$CD,$DA,$D2,$D9,$C8
002150 EEB0 D1A3888D86A4898E        DB  $D1,$A3,$88,$8D,$86,$A4,$89,$8E ;B
002158 EEB8 DFA58A8FDEA18B90        DB  $DF,$A5,$8A,$8F,$DE,$A1,$8B,$90
002160 EEC0 000000000000001F        DB  $00,$00,$00,$00,$00,$00,$00,$1F ;C
002168 EEC8 00001D7B7D1E0F0E        DB  $00,$00,$1D,$7B,$7D,$1E,$0F,$0E
002170 EED0 070102030405060D        DB  $07,$01,$02,$03,$04,$05,$06,$0D ;D
002178 EED8 080A0B0C095C0000        DB  $08,$0A,$0B,$0C,$09,$5C,$00,$00
002180 EEE0 0000000000000000        DB  $00,$00,$00,$00,$00,$00,$00,$00 ;E
002188 EEE8 0000000000000000        DB  $00,$00,$00,$00,$00,$00,$00,$00
002190 EEF0 A000000000000000        DB  $A0,$00,$00,$00,$00,$00,$00,$00 ;F
002198 EEF8 0000000000000000        DB  $00,$00,$00,$00,$00,$00,$00,$00
[EOF:M7TABLE.ASM:SHIFT_JIS]
                                    INCLUDE "LDWORK.ASM"
                                
                                ;   LSX-Dodgers WORK0
                                ;
                                ;   CP/M互換BIOS
                                ;   BOOT:アドレス下位1バイトが0になるように
       EF00                     AT_WORK:
0021A0 EF00                         DS  WORKAD-AT_WORK
                                
       EF00                     CPM_BOOT:
0021A0 EF00 C30000          10      JP  0
       EF03                     _SYS00:     ;(BDOS)プログラム終了
       EF03                     CPM_WBOOT:
0021A3 EF03 C3FECF          10      JP  WBOOT1
       EF06                     CPM_CONST:
0021A6 EF06 C348D9          10      JP  CONSTX
       EF09                     _SYS07:     ;(BDOS)コンソール直接入力
       EF09                     CPM_CONIN:
0021A9 EF09 C3DED8          10      JP  FLGET
       EF0C                     CPM_CONOUT:
0021AC EF0C C3EDDA          10      JP  CONOUT1
                                
       EF0F                     DECBF:
0021AF EF0F                         DS  5
0021B4 EF14 00                  FDRV    DB  0
0021B5 EF15                     FNAME   DS  36
0021D9 EF39                     SFILE:  DS  33      ;DRV FILENAME
0021FA EF5A                     HLBUF:  DS  3       ;Random record buffer
                                
0021FD EF5D 0000                LEFTX:  DW  0
0021FF EF5F 0000                DTAX:   DW  0
                                
       EF61                     ZERO:
       EF61                     BEEPD:
002201 EF61 008E01000B000C10        DB  0,08EH,1,0,00BH,0,00CH,010H
002209 EF69 073E08100D00FF          DB  007H,03EH,008H,010H,00DH,0,0FFH
       EF62                     RTC_YY  EQU BEEPD+1
       EF63                     RTC_MW  EQU BEEPD+2
       EF64                     RTC_DD  EQU BEEPD+3
       EF65                     RTC_TT  EQU BEEPD+4
       EF66                     RTC_MM  EQU BEEPD+5
       EF67                     RTC_SS  EQU BEEPD+6
                                
002210 EF70 00                  CHECK:  DB  0
                                
002211 EF71 4F4B24              OK: DB  "OK$"
002214 EF74                         DS  5
002219 EF79 4572726F722124      COMERM: DB  "Error!$"
                                ;   システムワークエリア
                                ;   _CYL0:アドレス下位1バイトが080Hになるように
002220 EF80 FF                  _CYL0:  DB  0FFH    ;Cylinder
002221 EF81 FF                  _CYL1:  DB  0FFH    ;Cylinder
002222 EF82 FF                  _CYL2:  DB  0FFH    ;Cylinder
002223 EF83 FF                  _CYL3:  DB  0FFH    ;Cylinder
002224 EF84 00                  _DRIVE: DB  0   ;unit number
002225 EF85 00                  _SEEKSP:DB  0   ;Seek speed
002226 EF86 FF                  _ISEEK: DB  0FFH    ;
002227 EF87 00                  _DVSW:  DB  0
002228 EF88 00                  _DRV:   DB  0
002229 EF89 FF                  _DSK:   DB  0FFH
00222A EF8A 8000                _DTA:   DW  00080H
00222C EF8C 0000                _CTC:   DW  0
00222E EF8E 0000                _TXADR: DW  0
002230 EF90 0000                _KEYPS: DW  0
002232 EF92 00FF                _KEYD:  DW  0FF00H  ;キーデータ
002234 EF94 C210                _KEYSP: DW  010C2H
002236 EF96 71                  _COLORF:DB  COLORF  ;色
002237 EF97 19                  _LINE:  DB  LINE
                                
002238 EF98 0000                _FCB:   DW  0
00223A EF9A 0000                _FBPS:  DW  0   ;SEARCH FILES
00223C EF9C 0000                _FBAD:  DW  0   ;    //
00223E EF9E 00                  _FBCNT: DB  0   ;    //
00223F EF9F 00                  _FILEN: DB  0
002240 EFA0 00                  _DIRF:  DB  0   ;bit7:ディレクトリ bit0-6:セクタインデックス
002241 EFA1                         DS  1
002242 EFA2 00                  _WTFATF:DB  0   ;FATバッファの更新フラグ
002243 EFA3                         DS  1
002244 EFA4 00                  _WTDBF: DB  0   ;データバッファの更新フラグ
002245 EFA5 FF                  _DBDRV: DB  0FFH    ;データバッファにあるデータを読み込んだドライブ
002246 EFA6 0000                _DBSEC: DW  0   ;データバッファにあるデータを読み込んだセクタ番号
002248 EFA8 0000                _DPB:   DW  0
       EFAA                     _FATDRV:
00224A EFAA FF                      DB  0FFH    ;FATバッファに読み込んでいるドライブ
00224B EFAB 00                  _FATIX: DB  0   ;FATバッファに読み込んでいるインデックス
       EFAC                     _FAKEFREE:
00224C EFAC 0000                    DW  0   ;偽の残量（FATサイズが大きくなると重くなるのでその対策）
                                
00224E EFAE                         DS  2
                                
       EFB0                     CRTCD:  
002250 EFB0 6F                      DB  06FH
       EFB1                     _WIDTH: 
002251 EFB1 28                      DB  WIDTH
       EFB2                     TVRAMTOP:
002252 EFB2 5938                    DB  059H,038H
002254 EFB4 1F02                    DB  01FH,002H
       EFB6                     _LINE2:
002256 EFB6 19                      DB  019H
       EFB7                     WKE4:
002257 EFB7 1C                      DB  01CH
       EFB8                     WKE6:
002258 EFB8 00                      DB  000H
       EFB9                     WK40:
002259 EFB9 07                      DB  007H
       EFBA                     _PAGE_MINUS:
00225A EFBA 18FC                    DW  0-WIDTH*LINE
       EFBC                     _WIDTH_MINUS:
00225C EFBC D8FF                    DW  0-WIDTH
       EFBE                     WK30:
00225E EFBE 0C                      DB  00CH
       EFBF                     WK31:
       EFBF                     WK1FD0:
00225F EFBF 20                      DB  020H
                                
002260 EFC0 0000                CTC0:   DW  INTCTCE
002262 EFC2 0000                CTC1:   DW  INTCTCE
002264 EFC4 0000                CTC2:   DW  INTCTC2
002266 EFC6 0000                CTC3:   DW  INTCTCE
002268 EFC8 0000                INTVEC: DW  INT
                                
                                ;   LSX-Dodgers 独自BIOS
                                
00226A EFCA C326DC          10  _INKEY: JP  INKEY
00226D EFCD C3D9D9          10  _PRINT: JP  PRINT
002270 EFD0 C381DC          10  _SCRN:  JP  SCRN
002273 EFD3 C396DB          10  _POS:   JP  POS
002276 EFD6 C3BBDA          10  _LOC:   JP  LOC
       EFD9                     _CHGDRV:
002279 EFD9 C31BE9          10      JP  CHGDRV
       EFDC                     _GETDPB:
00227C EFDC C3E6E9          10      JP  GETDPB
       EFDF                     _FFLUSH:
00227F EFDF C304EA          10      JP  FFLUSH
       EFE2                     _RDFATX:
002282 EFE2 C321E6          10      JP  RDFATX
002285 EFE5 C349E7          10  _RDFAT: JP  RDFAT
002288 EFE8 C3C4EA          10  _WTTRK: JP  WTTRK
00228B EFEB C324EB          10  _FDRD:  JP  FDRD
00228E EFEE C3CAEA          10  _FDWT:  JP  FDWT
       EFF1                     _BPB2DPB:
002291 EFF1 C3AEE7          10      JP  BPB2DPB
002294 EFF4                         DS  3
       EFF7                     _GNCL:
002297 EFF7 C3C3E6          10  GNCPAT: JP  GNCL        ; self-modifying code
       EFFA                     _SNCL:
00229A EFFA C3E6E6          10  SNCPAT: JP  SNCL        ; self-modifying code
00229D EFFD C348D0          10  _COMANL:JP  COMANL
                                
       F000                     _WE:
[EOF:LDWORK.ASM:SHIFT_JIS]
                                    INCLUDE "LDCALL.ASM"
                                
                                ;   LSX-Dodgers システムコール(BDOS)
                                ;
                                ;   LSX-Dodgers SYSTEM CALL
                                ;   STABLE:アドレス下位1バイトが0になるように
                                
       F000                     STABLE:
                                ;0
0022A0 F000 03EFB1D8BDD856DE        DW  _SYS00,_SYS01,_SYS02,_SYS03
0022A8 F008 CAD5CAD5C2D809EF        DW  _SYS04,_SYS05,_SYS06,_SYS07
0022B0 F010 CAD8CCD514D940D9        DW  _SYS08,_SYS09,_SYS0A,_SYS0B
0022B8 F018 E1D5E6D5F5D508D6        DW  _SYS0C,_SYS0D,_SYS0E,_SYS0F
                                ;1
0022C0 F020 5CD6A3D6ECD622D7        DW  _SYS10,_SYS11,_SYS12,_SYS13
0022C8 F028 2AD740D755D74DD7        DW  _SYS14,_SYS15,_SYS16,_SYS17
0022D0 F030 9CD7A1D7A6D7ACD7        DW  _SYS18,_SYS19,_SYS1A,_SYS1B
0022D8 F038 CAD5D2D7CAD5D6D7        DW  _SYS1C,_SYS1D,_SYS1E,_SYS1F
                                ;2
0022E0 F040 CAD58CD794D7DDD7        DW  _SYS20,_SYS21,_SYS22,_SYS23
0022E8 F048 03D8CAD5DEE2C3E3        DW  _SYS24,_ERROR,_SYS26,_SYS27
0022F0 F050 94D70CD856D956DE        DW  _SYS28,_SYS5C,_SYS2A,_SYS2B
0022F8 F058 5CD956DECAD52FD8        DW  _SYS2C,_SYS2D,_SYS2E,_SYS2F
                                ;3
002300 F060 29D8CAD5CAD5CAD5        DW  _SYS30,_ERROR,_ERROR,_ERROR
002308 F068 CAD5CAD5CAD5CAD5        DW  _ERROR,_ERROR,_ERROR,_ERROR
002310 F070 CAD556DE56DE50D8        DW  _ERROR,_SYS39,_SYS3A,_SYS5A
                                ;DOS2
002318 F078 ADD5                    DW  _DOS2
                                
00231A F07A                         DS  2
00231C F07C 00F2                _FATBF: DW  FATBF
00231E F07E 00FA                _DTBUF: DW  DTBUF
                                
                                ;   コントロールコードテーブル
                                ;   CTRLTB:アドレス下位1バイトが080Hになるように
                                
       F080                     CTRLTB:
002320 F080 3EDA3EDA74DA69DB        DW  CTRL00,CTRL00,CTRL02,CTRL03 ;  A,B,C
002328 F088 63DBA0DA54DBFDDA        DW  CTRL04,CTRL05,CTRL06,CTRL07 ;D,E,F,G
002330 F090 4ADA65DA6CDBCEDA        DW  CTRL08,CTRL09,CTRL0A,CTRL0B ;H,I,J,K
002338 F098 51DBB6DA7EDB3EDA        DW  CTRL0C,CTRL0D,CTRL0E,CTRL00 ;L,M,N,O
002340 F0A0 3EDA3EDAC6DA3EDA        DW  CTRL00,CTRL00,CTRL12,CTRL00 ;P,Q,R,S
002348 F0A8 3EDA3EDA3EDA3EDA        DW  CTRL00,CTRL00,CTRL00,CTRL00 ;T,U,V,W
002350 F0B0 3EDA3EDA51DBD5DA        DW  CTRL00,CTRL00,CTRL0C,CTRL1B ;X,Y,Z,ESC
002358 F0B8 2DDA51DA5ADA6CDB        DW  CTRL1C,CTRL1D,CTRL1E,CTRL1F ;→,←,↑,↓
                                
002360 F0C0                         DS  02AH
                                
00238A F0EA 1617                SDDATA: DB  22,23       ;(FCB)ファイルを最後に変更した時刻
00238C F0EC 1415                    DB  20,21       ;(FCB)ファイルを最後に変更した日付
00238E F0EE 1A1B                    DB  26,27       ;(FCB)ファイルの先頭クラスタ
002390 F0F0 10111213                DB  16,17,18,19 ;(FCB)ファイルのサイズ(バイト単位)
       F0F4                     SDDATAE:
                                
002394 F0F4                     SCDIR:  DS  2       ;+14 +15
002396 F0F6                     SFBPS:  DS  2       ;FBPS
002398 F0F8                     SFNDF:  DS  2       ;FILEN DIRF
                                
00239A F0FA 0000                _FATPS: DW  0
00239C F0FC 0000                _DIRPS: DW  0
00239E F0FE 0000                _CLPS:  DW  0
                                
       F100                     _PE:
[EOF:LDCALL.ASM:SHIFT_JIS]
                                    INCLUDE "M7DPB.ASM"
                                
                                ;   LSX-Dodgers DPB
                                ;   MZ-700/1500
                                
       F100                     DEVICE:
                                
                                ;   A:
                                
0023A0 F100 0200                    DW  2   ;DPB_00_FATLN
0023A2 F102 EBEF                    DW  _FDRD   ;DPB_02_DRD
0023A4 F104 EEEF                    DW  _FDWT   ;DPB_04_DWT
0023A6 F106 FD                      DB  0FDH    ;DPB_06_FATID
0023A7 F107 02                      DB  2   ;DPB_07_SECPCL
0023A8 F108 6401                    DW  356 ;DPB_08_MAXCL
0023AA F10A FF                      DB  0FFH    ;DPB_0A_FDMODE  0FFH=2D / 0FEH=2HD
0023AB F10B 07                      DB  7   ;DPB_0B_DIRSCNT
0023AC F10C 28                      DB  40  ;DPB_0C_MAXCYL
0023AD F10D 09                      DB  9   ;DPB_0D_MAXSEC  Number of sectors
0023AE F10E 01                      DB  1   ;DPB_0E_FATPS
0023AF F10F 82                      DB  082H    ;DPB_0F_BPS
0023B0 F110 0500                    DW  5   ;DPB_10_DIRPS
0023B2 F112 27                      DB  027H    ;DPB_12_DEVICE  Device Number
0023B3 F113 00                      DB  0   ;DPB_13_UNITNO
0023B4 F114 0800                    DW  8   ;DPB_14_ADDCL16
0023B6 F116 0000                    DW  0   ;DPB_16
0023B8 F118 0000                    DW  0   ;DPB_18
0023BA F11A 0000                    DW  0   ;DPB_1A_SDIR
0023BC F11C 46444430                DB  "FDD0"  ;DPB_1C_NAME
                                
                                ;   B:
                                
0023C0 F120 0200                    DW  2   ;DPB_00_FATLN
0023C2 F122 EBEF                    DW  _FDRD   ;DPB_02_DRD
0023C4 F124 EEEF                    DW  _FDWT   ;DPB_04_DWT
0023C6 F126 FD                      DB  0FDH    ;DPB_06_FATID
0023C7 F127 02                      DB  2   ;DPB_07_SECPCL
0023C8 F128 6401                    DW  356 ;DPB_08_MAXCL
0023CA F12A FF                      DB  0FFH    ;DPB_0A_FDMODE  0FFH=2D / 0FEH=2HD
0023CB F12B 07                      DB  7   ;DPB_0B_DIRSCNT
0023CC F12C 28                      DB  40  ;DPB_0C_MAXCYL
0023CD F12D 09                      DB  9   ;DPB_0D_MAXSEC  Number of sectors
0023CE F12E 01                      DB  1   ;DPB_0E_FATPS
0023CF F12F 82                      DB  082H    ;DPB_0F_BPS
0023D0 F130 0500                    DW  5   ;DPB_10_DIRPS
0023D2 F132 27                      DB  027H    ;DPB_12_DEVICE  Device Number
0023D3 F133 01                      DB  1   ;DPB_13_UNITNO
0023D4 F134 0800                    DW  8   ;DPB_14_ADDCL16
0023D6 F136 0000                    DW  0   ;DPB_16
0023D8 F138 0000                    DW  0   ;DPB_18
0023DA F13A 0000                    DW  0   ;DPB_1A_SDIR
0023DC F13C 46444431                DB  "FDD1"  ;DPB_1C_NAME
                                
                                ;   C:
                                
0023E0 F140 0100                    DW  1   ;DPB_00_FATLN
0023E2 F142 E4EB                    DW  CDRD    ;DPB_02_DRD
0023E4 F144 D0EB                    DW  CDWT    ;DPB_04_DWT
0023E6 F146 FA                      DB  0FAH    ;DPB_06_FATID
0023E7 F147 01                      DB  1   ;DPB_07_SECPCL
0023E8 F148 7A00                    DW  122 ;DPB_08_MAXCL
0023EA F14A 00                      DB  0   ;DPB_0A_FDMODE
0023EB F14B 06                      DB  6   ;DPB_0B_DIRSCNT
0023EC F14C 00                      DB  0   ;DPB_0C_MAXCYL
0023ED F14D 00                      DB  0   ;DPB_0D_MAXSEC
0023EE F14E 01                      DB  1   ;DPB_0E_FATPS
0023EF F14F 01                      DB  1   ;DPB_0F_BPS
0023F0 F150 0200                    DW  2   ;DPB_10_DIRPS
0023F2 F152 0C                      DB  00CH    ;DPB_12_DEVICE
0023F3 F153 F8                      DB  0F8H    ;DPB_13_UNITNO
0023F4 F154 0600                    DW  6   ;DPB_14_ADDCL16
0023F6 F156 0000                    DW  0   ;DPB_16
0023F8 F158 0000                    DW  0   ;DPB_18
0023FA F15A 0000                    DW  0   ;DPB_1A_SDIR
0023FC F15C 434D4F53                DB  "CMOS"  ;DPB_1C_NAME
                                
                                ;   D:
                                
002400 F160                         DS  32
                                
                                ;   E:
                                
002420 F180 0000                    DW  0   ;DPB_00_FATLN
002422 F182 9BEB                    DW  EDRD    ;DPB_02_DRD
002424 F184 8EEB                    DW  EDWT    ;DPB_04_DWT
002426 F186 FA                      DB  0FAH    ;DPB_06_FATID
002427 F187 02                      DB  2   ;DPB_07_SECPCL
002428 F188 0000                    DW  0   ;DPB_08_MAXCL
00242A F18A 00                      DB  0   ;DPB_0A_FDMODE
00242B F18B 10                      DB  16  ;DPB_0B_DIRSCNT
00242C F18C 00                      DB  0   ;DPB_0C_MAXCYL
00242D F18D 00                      DB  0   ;DPB_0D_MAXSEC
00242E F18E 01                      DB  1   ;DPB_0E_FATPS
00242F F18F 01                      DB  1   ;DPB_0F_BPS
002430 F190 0000                    DW  0   ;DPB_10_DIRPS
002432 F192 26                      DB  026H    ;DPB_12_DEVICE
002433 F193 00                      DB  0   ;DPB_13_UNITNO
002434 F194 0000                    DW  0   ;DPB_14_ADDCL16
002436 F196 0000                    DW  0   ;DPB_16
002438 F198 0000                    DW  0   ;DPB_18
00243A F19A 0000                    DW  0   ;DPB_1A_SDIR
00243C F19C 454D4D30                DB  "EMM0"  ;DPB_1C_NAME
                                
                                ;   F:
                                
002440 F1A0 0200                    DW  2   ;DPB_00_FATLN
002442 F1A2 08EC                    DW  RDRD    ;DPB_02_DRD
002444 F1A4 F7EB                    DW  RDWT    ;DPB_04_DWT
002446 F1A6 FA                      DB  0FAH    ;DPB_06_FATID
002447 F1A7 01                      DB  1   ;DPB_07_SECPCL
002448 F1A8 F600                    DW  246 ;DPB_08_MAXCL
00244A F1AA 00                      DB  0   ;DPB_0A_FDMODE
00244B F1AB 09                      DB  9   ;DPB_0B_DIRSCNT
00244C F1AC 00                      DB  0   ;DPB_0C_MAXCYL
00244D F1AD 00                      DB  0   ;DPB_0D_MAXSEC
00244E F1AE 01                      DB  1   ;DPB_0E_FATPS
00244F F1AF 01                      DB  1   ;DPB_0F_BPS
002450 F1B0 0300                    DW  3   ;DPB_10_DIRPS
002452 F1B2 0F                      DB  00FH    ;DPB_12_DEVICE
002453 F1B3 00                      DB  0   ;DPB_13_UNITNO
002454 F1B4 0A00                    DW  10  ;DPB_14_ADDCL16
002456 F1B6 0000                    DW  0   ;DPB_16
002458 F1B8 0000                    DW  0   ;DPB_18
00245A F1BA 0000                    DW  0   ;DPB_1A_SDIR
00245C F1BC 52414D46                DB  "RAMF"  ;DPB_1C_NAME
                                
                                ;   G:
                                
002460 F1C0                         DS  32
                                
                                ;   H:
002480 F1E0                         DS  3
002483 F1E3 00                      DB  0
[EOF:M7DPB.ASM:UTF_8]
                                
       A484                         ORG $$+OFFSET   ;$DEPHASE
       A484                     LAST_ADR:
                                
                                    END
[EOF:M7.ASM:UTF_8]
