                                ;*** AILZ80ASM *** Z-80 Assembler, version 1.0.0.0, LST:Full:4
                                ;   LSX-Dodgers for MZ-700/1500
                                ;   Programmed by
                                ;   Gaku (Lovers/Tablacus)
                                
                                    INCLUDE "M7DEF.ASM"
                                
                                ;   LSX-Dodgers DEF
                                ;   MZ-700/1500
                                
       0001                     MAC EQU 1   ;MZ-700/1500
                                
       8080                     RUN EQU 08080H
       8000                     OFFSET  EQU RUN-128
       CF06                     BDOS    EQU 0CF06H
       EC40                     TABLEAD EQU 0EC40H
       EF00                     WORKAD  EQU 0EF00H
       F200                     FATBF   EQU 0F200H
       FA00                     DTBUF   EQU 0FA00H
       FE00                     KEYBF   EQU 0FE00H
       FF00                     KBUF    EQU 0FF00H
       FFD9                     TRAP38  EQU 0FFD9H
       0028                     WIDTH   EQU 40
       0019                     LINE    EQU 25
       0071                     COLORF  EQU 071H
       000A                     COMS    EQU 10
[EOF:M7DEF.ASM:UTF_8]
                                    INCLUDE "LDDEF.ASM"
                                
                                ;   LSX-Dodgers DEF
                                
       0001                     VER_1   EQU 1
       0004                     VER_2   EQU 4
       0006                     VER_3   EQU 6
       1D01                     MACW    EQU MAC + 01D00H    ;機種フラグとLD判別フラグ
       0001                     MACD    EQU MAC + 00000H    ;機種フラグとデバイスフラグ
       0146                     VER EQU VER_1 * 256 + VER_2 * 16 + VER_3
                                
       0005                     SYSTEM  EQU 00005H
       000F                     JP_HL   EQU 0000FH
       005C                     FCB1    EQU 0005CH
       006C                     FCB2    EQU 0006CH
       005D                     FCB1FN  EQU FCB1+1
       006D                     FCB2FN  EQU FCB2+1
       0080                     DTA1    EQU 00080H
                                
       FFCA                     EXTBIO  EQU 0FFCAH
                                
[EOF:LDDEF.ASM:SHIFT_JIS]
                                
000000 8000                         ORG OFFSET
                                                    ;MZTヘッダ128バイト
000000 8000 01                      DB  1           ;ファイルモード
000001 8001 4C44202020202020        DB  "LD           "     ;ファイル名(13)
            2020202020          
00000E 800E 535953                  DB  "SYS"           ;拡張子(3)
000011 8011 0D                      DB  $0D
000012 8012 1C24                    DW  LAST_ADR-RUN        ;サイズ
000014 8014 8080                    DW  RUN         ;開始アドレス
000016 8016 8080                    DW  RUN         ;実行アドレス
000018 8018                         DS  104
                                
                                    INCLUDE "M7INIT.ASM"
                                
                                ;   LSX-Dodgers INIT
                                ;   MZ-700/1500
                                
000080 8080 C38780          10      JP  START
000083 8083 011D                    DW  MACW
000085 8085 4601                    DW  VER
                                
       8087                     START:
000087 8087 F3               4      DI
000088 8088 ED56             8      IM  1
00008A 808A 318780          10      LD  SP,START
00008D 808D CD9B80          17      CALL    INIT        ;NZならAUTOEXECを実行
000090 8090 210000          10      LD  HL,0
000093 8093 E5              11      PUSH    HL
000094 8094 C8              11      RET Z
000095 8095 113D81          10      LD  DE,AUTOD
000098 8098 C3FDEF          10      JP  _COMANL
                                
       809B                     INIT:
00009B 809B D3E0            11      OUT (0E0H),A    ;DRAM(0000H-0FFHH)
00009D 809D D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
00009F 809F 21A281          10      LD  HL,INITE
0000A2 80A2 1106CF          10      LD  DE,BDOS
0000A5 80A5 01FA22          10      LD  BC,LAST_ADR-INITE
0000A8 80A8 EDB0                    LDIR
0000AA 80AA 217381          10      LD  HL,M7BEEPD
0000AD 80AD 1162EF          10      LD  DE,BEEPD+1
0000B0 80B0 010800          10      LD  BC,M7BEEPE-M7BEEPD
0000B3 80B3 EDB0                    LDIR
                                
0000B5 80B5 210000          10      LD  HL,0
0000B8 80B8 065C             7      LD  B,05CH
0000BA 80BA 3EEF             7      LD  A,0EFH      ;RST 28H
0000BC 80BC CDBADD          17      CALL    FILL_MEMORY
0000BF 80BF 06A4             7      LD  B,0A4H
0000C1 80C1 AF               4      XOR A
0000C2 80C2 CDBADD          17      CALL    FILL_MEMORY
                                
0000C5 80C5 3EC3             7      LD  A,0C3H      ;JP
0000C7 80C7 2103EF          10      LD  HL,CPM_WBOOT
0000CA 80CA 320000          13      LD  (00000H),A
0000CD 80CD 220100          16      LD  (00001H),HL ;IPL
                                
0000D0 80D0 21011D          10      LD  HL,MACW     ;3 bit7  DPB Compatible LA(1)
0000D3 80D3 220300          16      LD  (00003H),HL ;  bit6-0 Machine
                                ;               ;4 LSX-Dodgers(01DH)
0000D6 80D6 2106CF          10      LD  HL,BDOS
0000D9 80D9 320500          13      LD  (00005H),A
0000DC 80DC 220600          16      LD  (00006H),HL ;BDOS
                                
0000DF 80DF 21D9FF          10      LD  HL,TRAP38   ;TRAP38
0000E2 80E2 322800          13      LD  (00028H),A
0000E5 80E5 222900          16      LD  (00029H),HL ;RST 038H
                                
0000E8 80E8 3EC9             7      LD  A,0C9H      ;モード1割り込み
0000EA 80EA 323800          13      LD  (00038H),A
                                
0000ED 80ED 3EEF             7      LD  A,CPM_BOOT/256
0000EF 80EF 320B00          13      LD  (0000BH),A
                                
0000F2 80F2 3EE9             7      LD  A,0E9H      ;JP (HL)
0000F4 80F4 320F00          13      LD  (0000FH),A
                                
0000F7 80F7 3A7DF0          13      LD  A,(_FATBF+1)
0000FA 80FA 321300          13      LD  (00013H),A
                                
0000FD 80FD 3A7FF0          13      LD  A,(_DTBUF+1)
000100 8100 321700          13      LD  (00017H),A
                                
000103 8103 3EFE             7      LD  A,KEYBF/256
000105 8105 321B00          13      LD  (0001BH),A
                                
000108 8108 3EFF             7      LD  A,KBUF/256
00010A 810A 321F00          13      LD  (0001FH),A
                                
00010D 810D 214601          10      LD  HL,VER
000110 8110 225A00          16      LD  (0005AH),HL
                                
000113 8113 214981          10      LD  HL,INIMES
000116 8116 CDE8D5          17      CALL    MSX
       8119                     INIT1:
000119 8119 F3               4      DI
00011A 811A 1100FF          10      LD  DE,0FF00H
00011D 811D 0600             7      LD  B,0
00011F 811F CDB2D3          17      CALL    ZERO_MEMORY_DE
000122 8122 21CAFF          10      LD  HL,EXTBIO
000125 8125 060F             7      LD  B,TRAP38-EXTBIO
000127 8127 3EEF             7      LD  A,0EFH      ;RST 28H
000129 8129 CDBADD          17      CALL    FILL_MEMORY
00012C 812C 217B81          10      LD  HL,AT_TRAP38
00012F 812F 11D9FF          10      LD  DE,TRAP38
000132 8132 012700          10      LD  BC,AT_TRAPE-AT_TRAP38
000135 8135 EDB0                    LDIR
                                
000137 8137 CD95DC          17      CALL    CHKEY
00013A 813A FE03             7      CP  3
00013C 813C C9              10      RET
                                
00013D 813D 4155544F45584543    AUTOD:  DB  "AUTOEXEC "
            20                  
000146 8146 413A00              AUTODV: DB  "A:",0
                                
000149 8149 0C4C53582D446F64    INIMES: DB  00CH,"LSX-Dodgers for MZ-700/1500 v"
            6765727320666F72    
            204D5A2D3730302F    
            313530302076        
000167 8167 312E                    DB  030H + VER_1, '.'
000169 8169 3436                    DB  030H + VER_2 ,030H + VER_3
                                ;   DB  8,'PR.2'            ;表示
00016B 816B 2047616B750D0A          DB  ' Gaku',0DH,0AH
000172 8172 00                      DB  0
                                
       8173                     M7BEEPD:
000173 8173 0801                    DB  8,1
000175 8175 0736                    DB  7,036H
000177 8177 04F9                    DB  4,0F9H
000179 8179 0403                    DB  4,3
       817B                     M7BEEPE:
                                
       817B                     AT_TRAP38:
00017B FFD9                         ORG TRAP38,AT_TRAP38-OFFSET
00017B FFD9 210000          10      LD  HL,0
00017E FFDC E3              19      EX  (SP),HL
00017F FFDD 3E24             7      LD  A,'$'
000181 FFDF CDC6D8          17      CALL    MSG_A
000184 FFE2 2B               6      DEC HL
000185 FFE3 7C               4      LD  A,H
000186 FFE4 CDE8FF          17      CALL    PRHX
000189 FFE7 7D               4      LD  A,L
       FFE8                     PRHX:
00018A FFE8 F5              11      PUSH    AF
00018B FFE9 07               4      RLCA
00018C FFEA 07               4      RLCA
00018D FFEB 07               4      RLCA
00018E FFEC 07               4      RLCA
00018F FFED CDF1FF          17      CALL    PRHX2
000192 FFF0 F1              10      POP AF
       FFF1                     PRHX2:
000193 FFF1 E60F             7      AND 00FH
000195 FFF3 FE0A             7      CP  10
000197 FFF5 3F               4      CCF
000198 FFF6 CE30             7      ADC A,'0'
00019A FFF8 27               4      DAA
00019B FFF9 C3C6D8          10      JP  MSG_A
00019E FFFC                         DS  4
       81A2                         ORG $$+OFFSET   ;$DEPHASE
       81A2                     AT_TRAPE:
                                
       81A2                     INITE:
0001A2 CF06                         ORG BDOS,INITE-OFFSET
                                
0001A2 CF06 C309CF          10      JP  IO_BDOS
[EOF:M7INIT.ASM:SHIFT_JIS]
                                    INCLUDE "M7BANK.ASM"
                                
                                ;   LSX-Dodgers IO
                                ;   MZ-700/1500
                                ;   VRAM/KEY/TIMER(0D000H-0EFFFH)にアクセスするので0D000H-0FFFFHに置けない部分
                                ;
                                
       CF09                     IO_BDOS:
0001A5 CF09 D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
0001A7 CF0B C391D5          10      JP  BDOS0
                                
       CF0E                     RDKEYDATA:
0001AA CF0E D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
0001AC CF10 3200E0          13      LD  (0E000H),A
0001AF CF13 3A01E0          13      LD  A,(E001H)
0001B2 CF16 D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
0001B4 CF18 C9              10      RET
                                
       CF19                     RD556VSYNC:
0001B5 CF19 D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
0001B7 CF1B 3A02E0          13      LD  A,(0E002H)
0001BA CF1E D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
0001BC CF20 C9              10      RET
                                
       CF21                     RDMMIO:
0001BD CF21 D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
0001BF CF23 7E               7      LD  A,(HL)
0001C0 CF24 D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
0001C2 CF26 C9              10      RET
                                
       CF27                     WRMMIO:
0001C3 CF27 D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
0001C5 CF29 77               7      LD  (HL),A
0001C6 CF2A D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
0001C8 CF2C C9              10      RET
                                
       CF2D                     RDMMIO_BC:
0001C9 CF2D D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
0001CB CF2F 0A               7      LD  A,(BC)
0001CC CF30 D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
0001CE CF32 C9              10      RET
                                
       CF33                     WRMMIO_BC:
0001CF CF33 D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
0001D1 CF35 02               7      LD  (BC),A
0001D2 CF36 D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
0001D4 CF38 C9              10      RET
                                
       CF39                     IO_PRINT:
0001D5 CF39 D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
0001D7 CF3B 77               7      LD  (HL),A
0001D8 CF3C CBDC             8      SET 3,H
0001DA CF3E 71               7      LD  (HL),C
0001DB CF3F D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
0001DD CF41 C9              10      RET
                                
       CF42                     IO_CLR:
0001DE CF42 D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
       CF44                     C1AX1:
0001E0 CF44 7A               4      LD  A,D
0001E1 CF45 C6D0             7      ADD A,0D0H
0001E3 CF47 57               4      LD  D,A
0001E4 CF48 AF               4      XOR A
0001E5 CF49 12               7      LD  (DE),A      ;Text
0001E6 CF4A CBDA             8      SET 3,D
       CF4D                     ICSMC   EQU $+1
0001E8 CF4C 3E00             7      LD  A,0     ;自己書き換え
0001EA CF4E 12               7      LD  (DE),A      ;Color
0001EB CF4F 13               6      INC DE
0001EC CF50 7A               4      LD  A,D
0001ED CF51 D6D8             7      SUB 0D8H
0001EF CF53 57               4      LD  D,A
0001F0 CF54 2118FC          10      LD  HL,0-WIDTH*LINE
0001F3 CF57 19              11      ADD HL,DE
0001F4 CF58 30EA            12      JR  NC,C1AX1
0001F6 CF5A E1              10      POP HL
0001F7 CF5B D1              10      POP DE
0001F8 CF5C D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
0001FA CF5E C9              10      RET
                                
       CF5F                     IO_CLLINE:
0001FB CF5F D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
       CF61                     CLLINE1:
0001FD CF61 CB9C             8      RES 3,H
0001FF CF63 77               7      LD  (HL),A      ;Text
000200 CF64 CBDC             8      SET 3,H
000202 CF66 71               7      LD  (HL),C      ;Color
000203 CF67 23               6      INC HL
000204 CF68 10F7            13      DJNZ    CLLINE1
000206 CF6A D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
000208 CF6C C9              10      RET
                                
       CF6D                     IO_INS:
000209 CF6D D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
       CF6F                     IO_INS1:
00020B CF6F CD83CF          17      CALL    C12S
00020E CF72 23               6      INC HL
00020F CF73 10FA            13      DJNZ    IO_INS1
000211 CF75 D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
000213 CF77 C9              10      RET
                                
       CF78                     IO_BS:
000214 CF78 D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
       CF7A                     IO_BS1:
000216 CF7A CD83CF          17      CALL    C12S
000219 CF7D 2B               6      DEC HL
00021A CF7E 10F8            13      DJNZ    IO_BS
00021C CF80 D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
00021E CF82 C9              10      RET
                                
       CF83                     C12S:
00021F CF83 CB9C             8      RES 3,H
000221 CF85 5E               7      LD  E,(HL)
000222 CF86 77               7      LD  (HL),A
000223 CF87 7B               4      LD  A,E
000224 CF88 CBDC             8      SET 3,H
000226 CF8A 5E               7      LD  E,(HL)
000227 CF8B 71               7      LD  (HL),C
000228 CF8C 4B               4      LD  C,E
000229 CF8D C9              10      RET
                                
       CF8E                     IO_SCRUP:
00022A CF8E D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
       CF90                     SCRUP1:
00022C CF90 2815            12      JR  Z,SCRCL
00022E CF92 D5              11      PUSH    DE
00022F CF93 E5              11      PUSH    HL
000230 CF94 CBDA             8      SET 3,D
000232 CF96 CBDC             8      SET 3,H
000234 CF98 012800          10      LD  BC,WIDTH
000237 CF9B EDB0                    LDIR
000239 CF9D E1              10      POP HL
00023A CF9E D1              10      POP DE
00023B CF9F 012800          10      LD  BC,WIDTH
00023E CFA2 EDB0                    LDIR
000240 CFA4 3D               4      DEC A
000241 CFA5 18E9            12      JR  SCRUP1
                                
       CFA7                     SCRCL:
000243 CFA7 0628             7      LD  B,WIDTH
000245 CFA9 EB               4      EX  DE,HL
000246 CFAA D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
000248 CFAC CDC6DA          17      CALL    CLLINE
00024B CFAF E1              10      POP HL
00024C CFB0 D1              10      POP DE
00024D CFB1 C1              10      POP BC
00024E CFB2 C9              10      RET
                                
       CFB3                     C_MON:
00024F CFB3 D3E4            11      OUT (0E4H),A    ;MONITOR ROM(0000H-0FFFH) & VRAM/KEY/TIMER(D000H-FFFFH)
000251 CFB5 C7              12      RST 0
                                
       CFB6                     BANKE:
000252 CFB6                         DS  0CFFEH-BANKE        ;スタックエリア
       CFFE                     EXTSP:
[EOF:M7BANK.ASM:SHIFT_JIS]
                                    INCLUDE "M7CCP.ASM"
                                
                                ;   LSX-Dodgers CCP
                                ;   MZ-700/1500
                                
       CFFE                     WBOOT1:
00029A CFFE D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)　ここは0CFFEH
00029C D000 D3E0            11      OUT (0E0H),A    ;DRAM(0000H-0FFHH)
00029E D002 ED7B0600        20      LD  SP,(SYSTEM+1)
0002A2 D006 FB               4      EI
0002A3 D007 2192EF          10      LD  HL,_KEYD
0002A6 D00A 3600            10      LD  (HL),0
0002A8 D00C CD95DC          17      CALL    CHKEY
0002AB D00F CDB3D8          17      CALL    KEYBC_IFBREAK
0002AE D012 3E04             7      LD  A,4
0002B0 D014 CDC6D8          17      CALL    MSG_A
[EOF:M7CCP.ASM:UTF_8]
                                    INCLUDE "LDCCP.ASM"
                                
                                ;   LSX-Dodgers CCP
                                
       D017                     COMMAND:
0002B3 D017 CDCAD0          17      CALL    SETDTA1
0002B6 D01A 3A87EF          13      LD  A,(_DVSW)
0002B9 D01D C641             7      ADD A,'A'
0002BB D01F CDC6D8          17      CALL    MSG_A
0002BE D022 3E3E             7      LD  A,'>'
0002C0 D024 CDC6D8          17      CALL    MSG_A
0002C3 D027 3E50             7      LD  A,80
0002C5 D029 12               7      LD  (DE),A
0002C6 D02A CD25D9          17      CALL    _SYS0A      ;(BDOS)文字列入力
0002C9 D02D CD74D2          17      CALL    LTNL
                                
0002CC D030 118200          10      LD  DE,DTA1+2
0002CF D033 CDFDEF          17      CALL    _COMANL
0002D2 D036 30DF            12      JR  NC,COMMAND
0002D4 D038 1179EF          10      LD  DE,COMERM
0002D7 D03B CDD9D5          17      CALL    _SYS09      ;(BDOS)文字列出力
0002DA D03E C7              12      RST 0
                                
       D03F                     COMANL:
0002DB D03F CD0EDD          17      CALL    FILE
0002DE D042 3A19EF          13      LD  A,(FNAME+4)
0002E1 D045 FE20             7      CP  020H
0002E3 D047 201C            12      JR  NZ,COMB2
0002E5 D049 D5              11      PUSH    DE
0002E6 D04A 1115EF          10      LD  DE,FNAME
0002E9 D04D 1A               7      LD  A,(DE)
0002EA D04E FE20             7      CP  020H
0002EC D050 2844            12      JR  Z,SDVSW
0002EE D052 1B               6      DEC DE
0002EF D053 1A               7      LD  A,(DE)
0002F0 D054 C6FF             7      ADD A,0FFH
0002F2 D056 3809            12      JR  C,COMB
0002F4 D058 13               6      INC DE
                                
0002F5 D059 2155D5          10      LD  HL,COMTB
0002F8 D05C 060A             7      LD  B,COMS
0002FA D05E CD92DF          17      CALL    CPNAME
       D061                     COMB:
0002FD D061 D1              10      POP DE
0002FE D062 D20F00          10      JP  NC,JP_HL
       D065                     COMB2:
000301 D065 EB               4      EX  DE,HL
000302 D066 223ED1          16      LD  (COMPAT+1),HL
000305 D069 F5              11      PUSH    AF
000306 D06A CDEAD0          17      CALL    CEXE4
000309 D06D F1              10      POP AF
00030A D06E 2115EF          10      LD  HL,FNAME
00030D D071 116D00          10      LD  DE,FCB2+1   ;COMMAND NAME
000310 D074 010B00          10      LD  BC,11
000313 D077 EDB0                    LDIR
000315 D079 11F8D4          10      LD  DE,PATHD
       D07C                     CEX1:
000318 D07C 1A               7      LD  A,(DE)
000319 D07D FE20             7      CP  020H
00031B D07F D8              11      RET C
00031C D080 CD03DD          17      CALL    FILEC
00031F D083 D5              11      PUSH    DE
000320 D084 216D00          10      LD  HL,FCB2+1   ;COMMAND NAME
000323 D087 1115EF          10      LD  DE,FNAME
000326 D08A 010B00          10      LD  BC,11
000329 D08D EDB0                    LDIR
00032B D08F CDEAD0          17      CALL    CEXE4
00032E D092 D1              10      POP DE
00032F D093 13               6      INC DE
000330 D094 18E6            12      JR  CEX1
                                
       D096                     SDVSW:
000332 D096 F1              10      POP AF
000333 D097 3A14EF          13      LD  A,(FDRV)
000336 D09A 3D               4      DEC A
000337 D09B 5F               4      LD  E,A
000338 D09C 0E0E             7      LD  C,00EH      ;(BDOS)カレントドライブの設定
00033A D09E 1831            12      JR  SYSTEM0
                                
       D0A0                     OPEN1:
00033C D0A0 2114EF          10      LD  HL,FDRV
       D0A3                     OPEN:
00033F D0A3 0E11             7      LD  C,011H      ;(BDOS)ファイルの検索
       D0A5                     OPEN3:
000341 D0A5 D5              11      PUSH    DE
000342 D0A6 11D3D4          10      LD  DE,DTA_CCP
000345 D0A9 CDC7D0          17      CALL    SETDTA
000348 D0AC EB               4      EX  DE,HL
000349 D0AD CDD1D0          17      CALL    SYSTEM0
00034C D0B0 D1              10      POP DE
00034D D0B1 C9              10      RET
                                
       D0B2                     OPEN2:
00034E D0B2 0E12             7      LD  C,012H
000350 D0B4 18EF            12      JR  OPEN3
                                
       D0B6                     DEFCB:              ;Z=Ok NZ=Error
000352 D0B6 11D3D4          10      LD  DE,DTA_CCP
000355 D0B9 CDCFD0          17      CALL    SYSC0F
                                
000358 D0BC 11F4D4          10      LD  DE,DTA_CCP+33   ;(FCB)ランダムレコード
00035B D0BF 0604             7      LD  B,4
00035D D0C1 CDB2D3          17      CALL    ZERO_MEMORY_DE
000360 D0C4 110001          10      LD  DE,00100H
       D0C7                     SETDTA:
000363 D0C7 C3D7D7          10      JP  _SYS1A      ;(BDOS)DTAの設定
                                
       D0CA                     SETDTA1:
000366 D0CA 118000          10      LD  DE,DTA1
000369 D0CD 18F8            12      JR  SETDTA
                                
       D0CF                     SYSC0F:
00036B D0CF 0E0F             7      LD  C,00FH      ;(BDOS)ファイルのオープン
       D0D1                     SYSTEM0:
00036D D0D1 CD0500          17      CALL    SYSTEM
000370 D0D4 B7               4      OR  A
000371 D0D5 C9              10      RET
                                
       D0D6                     C_CD:
000372 D0D6 0E5A             7      LD  C,5AH
000374 D0D8 18F7            12      JR  SYSTEM0
                                
       D0DA                     S27BUF:
000376 D0DA 3A0700          13      LD  A,(SYSTEM+2)
000379 D0DD 3D               4      DEC A
00037A D0DE E6F8             7      AND 0F8H
00037C D0E0 67               4      LD  H,A
00037D D0E1 2E00             7      LD  L,0
       D0E3                     S27DTA:
00037F D0E3 11D3D4          10      LD  DE,DTA_CCP
       D0E6                     S27:
000382 D0E6 0E27             7      LD  C,027H      ;(BDOS)ランダムブロック読み込み
000384 D0E8 18E7            12      JR  SYSTEM0
                                
       D0EA                     CEXE4:
000386 D0EA 3A14EF          13      LD  A,(FDRV)
000389 D0ED 325700          13      LD  (00057H),A
00038C D0F0 2A22EF          16      LD  HL,(FDRV+14)
00038F D0F3 225800          16      LD  (00058H),HL
                                
000392 D0F6 211DEF          10      LD  HL,FNAME+8
000395 D0F9 7E               7      LD  A,(HL)
000396 D0FA FE20             7      CP  020H
000398 D0FC 2007            12      JR  NZ,CEXE7
00039A D0FE 3E3F             7      LD  A,'?'
00039C D100 77               7      LD  (HL),A
00039D D101 23               6      INC HL
00039E D102 77               7      LD  (HL),A
00039F D103 23               6      INC HL
0003A0 D104 77               7      LD  (HL),A
       D105                     CEXE7:
0003A1 D105 CDA0D0          17      CALL    OPEN1
       D108                     CEXE5:
0003A4 D108 C0              11      RET NZ
0003A5 D109 2ADDD4          16      LD  HL,(DTA_CCP+1+9)
0003A8 D10C 7C               4      LD  A,H
0003A9 D10D CD1AE0          17      CALL    CAP
0003AC D110 67               4      LD  H,A
0003AD D111 7D               4      LD  A,L
0003AE D112 CD1AE0          17      CALL    CAP
0003B1 D115 6F               4      LD  L,A
0003B2 D116 3ADCD4          13      LD  A,(DTA_CCP+1+8)
0003B5 D119 CD1AE0          17      CALL    CAP
0003B8 D11C D642             7      SUB 'B'
0003BA D11E 282C            12      JR  Z,C_BAT
0003BC D120 3D               4      DEC A       ;'C'
0003BD D121 2805            12      JR  Z,C_EXE
       D123                     CEXE6:
0003BF D123 CDB2D0          17      CALL    OPEN2
0003C2 D126 18E0            12      JR  CEXE5
                                
       D128                     C_EXE:
0003C4 D128 7C               4      LD  A,H
0003C5 D129 FE4D             7      CP  'M'
0003C7 D12B 20F6            12      JR  NZ,CEXE6
                                
0003C9 D12D CDB6D0          17      CALL    DEFCB
0003CC D130 CDDAD0          17      CALL    S27BUF
0003CF D133 3D               4      DEC A
0003D0 D134 37               4      SCF
0003D1 D135 C0              11      RET NZ
0003D2 D136 7C               4      LD  A,H
0003D3 D137 B5               4      OR  L
0003D4 D138 37               4      SCF
0003D5 D139 C8              11      RET Z
0003D6 D13A CDCAD0          17      CALL    SETDTA1
0003D9 D13D 110000          10  COMPAT: LD  DE,0                ; self-modifying code
0003DC D140 ED7B0600        20      LD  SP,(SYSTEM+1)
0003E0 D144 67               4      LD  H,A             ; A=0 in SETDTA1(_SYS1A)
0003E1 D145 6F               4      LD  L,A
0003E2 D146 E5              11      PUSH    HL              ; push $0000 (reboot address)
0003E3 D147 24               4      INC H
0003E4 D148 E5              11      PUSH    HL              ; push $0100 (TPA address)
0003E5 D149 C37DD3          10      JP  SETFCB              ; and JP $0100
                                
       D14C                     C_BAT:
0003E8 D14C 114154          10      LD  DE,'A'+'T'*256
0003EB D14F ED52            15      SBC HL,DE
0003ED D151 20D0            12      JR  NZ,CEXE6
                                
0003EF D153 F1              10      POP AF
0003F0 D154 F1              10      POP AF
0003F1 D155 CDB6D0          17      CALL    DEFCB
0003F4 D158 210002          10      LD  HL,00200H
0003F7 D15B CDE3D0          17      CALL    S27DTA
0003FA D15E C6FE             7      ADD A,0FEH
0003FC D160 D8              11      RET C
0003FD D161 7D               4      LD  A,L
0003FE D162 B7               4      OR  A
0003FF D163 37               4      SCF
000400 D164 C8              11      RET Z
000401 D165 3C               4      INC A
000402 D166 F5              11      PUSH    AF
                                
000403 D167 CDB6D8          17      CALL    KEYBC
000406 D16A 3E06             7      LD  A,6
000408 D16C CDC6D8          17      CALL    MSG_A
00040B D16F C1              10      POP BC
00040C D170 210001          10      LD  HL,00100H
       D173                     BAT1:
00040F D173 A7               4      AND A
000410 D174 05               4      DEC B
000411 D175 C8              11      RET Z
000412 D176 7E               7      LD  A,(HL)
000413 D177 FE25             7      CP  '%'
000415 D179 280C            12      JR  Z,BAT2
       D17B                     BAT1X:
000417 D17B 7E               7      LD  A,(HL)
000418 D17C 23               6      INC HL
000419 D17D FE1A             7      CP  01AH
00041B D17F C8              11      RET Z
00041C D180 FE0A             7      CP  00AH
00041E D182 C49BD8          17      CALL    NZ,KEYBS
000421 D185 18EC            12      JR  BAT1
                                
       D187                     BAT2:
000423 D187 23               6      INC HL
000424 D188 7E               7      LD  A,(HL)
000425 D189 2B               6      DEC HL
000426 D18A D631             7      SUB '1'
000428 D18C 38ED            12      JR  C,BAT1X
00042A D18E FE09             7      CP  9
00042C D190 30E9            12      JR  NC,BAT1X
00042E D192 23               6      INC HL
00042F D193 23               6      INC HL
000430 D194 3C               4      INC A
000431 D195 4F               4      LD  C,A
000432 D196 ED5B3ED1        20      LD  DE,(COMPAT+1)
       D19A                     BAT3:
000436 D19A 1A               7      LD  A,(DE)
000437 D19B B7               4      OR  A
000438 D19C 28D5            12      JR  Z,BAT1
00043A D19E CDE5DD          17      CALL    SPCUT
00043D D1A1 0D               4      DEC C
00043E D1A2 2808            12      JR  Z,BAT5
       D1A4                     BAT4:
000440 D1A4 1A               7      LD  A,(DE)
000441 D1A5 FE21             7      CP  021H
000443 D1A7 38F1            12      JR  C,BAT3
000445 D1A9 13               6      INC DE
000446 D1AA 18F8            12      JR  BAT4
       D1AC                     BAT5:
000448 D1AC 1A               7      LD  A,(DE)
000449 D1AD FE21             7      CP  021H
00044B D1AF 38C2            12      JR  C,BAT1
00044D D1B1 13               6      INC DE
00044E D1B2 CD9BD8          17      CALL    KEYBS
000451 D1B5 18F5            12      JR  BAT5
                                
       D1B7                     C_DEL:
000453 D1B7 CD7DD3          17      CALL    SETFCB
000456 D1BA CDDCD8          17      CALL    _SYS08      ;(BDOS)エコーなしコンソール入力
                                
000459 D1BD 0E13             7      LD  C,013H
00045B D1BF 180A            12      JR  CDEL1       ;(BDOS)ファイルの削除
                                
       D1C1                     C_REN:
00045D D1C1 CD7DD3          17      CALL    SETFCB
000460 D1C4 3E10             7      LD  A,010H      ;ディレクトリも対象にする
000462 D1C6 326900          13      LD  (FCB1+13),A ;属性
000465 D1C9 0E17             7      LD  C,017H      ;(BDOS)ファイル名の変更
       D1CB                     CDEL1:
000467 D1CB 115C00          10      LD  DE,FCB1
00046A D1CE CD0500          17      CALL    SYSTEM
00046D D1D1 C6FF             7      ADD A,0FFH
00046F D1D3 C9              10      RET
                                
       D1D4                     C_DIR:
000470 D1D4 CD03DD          17      CALL    FILEC
000473 D1D7 2115EF          10      LD  HL,FDRV+1
000476 D1DA CDC8D4          17      CALL    CWILD1
000479 D1DD 3EF1             7      LD  A,0F1H
00047B D1DF 3221EF          13      LD  (FDRV+13),A
00047E D1E2 CDA0D0          17      CALL    OPEN1
       D1E5                     CDIR1:
000481 D1E5 B7               4      OR  A
000482 D1E6 2008            12      JR  NZ,PDSKF
000484 D1E8 CD33D2          17      CALL    P_NAME
000487 D1EB CDB2D0          17      CALL    OPEN2
00048A D1EE 18F5            12      JR  CDIR1
                                
       D1F0                     PDSKF:
00048C D1F0 3A14EF          13      LD  A,(FDRV)
00048F D1F3 5F               4      LD  E,A
000490 D1F4 0E1B             7      LD  C,01BH      ;(BDOS)ディスク情報の獲得
000492 D1F6 CD0500          17      CALL    SYSTEM
000495 D1F9 4F               4      LD  C,A     ;C←1クラスタ辺りの論理セクタ数
000496 D1FA C601             7      ADD A,001H
000498 D1FC D8              11      RET C       ;Aが0FFHだった場合
000499 D1FD 3E06             7      LD  A,8-2
       D1FF                     PDS1:               ;HL=未使用クラスタの総数
00049B D1FF 3C               4      INC A
00049C D200 CB19             8      RR  C
00049E D202 30FB            12      JR  NC,PDS1
       D204                     PDS2:               ;B←論理セクタのサイズの上位8ビット
0004A0 D204 3C               4      INC A
0004A1 D205 CB18             8      RR  B
0004A3 D207 30FB            12      JR  NC,PDS2
0004A5 D209 47               4      LD  B,A
                                
0004A6 D20A 110000          10      LD  DE,0
       D20D                     PDS3:
0004A9 D20D 29              11      ADD HL,HL
0004AA D20E EB               4      EX  DE,HL
0004AB D20F ED6A            15      ADC HL,HL
0004AD D211 EB               4      EX  DE,HL
0004AE D212 10F9            13      DJNZ    PDS3
       D214                     PDSKF1:
0004B0 D214 CDACD2          17      CALL    PRDEC_DEHL
0004B3 D217 1139D5          10      LD  DE,FREE
0004B6 D21A CDD9D5          17      CALL    _SYS09      ;(BDOS)文字列出力
0004B9 D21D CD9BD2          17      CALL    PUTDRV
0004BC D220 3E5C             7      LD  A,05CH      ;\
0004BE D222 CDC6D8          17      CALL    MSG_A
0004C1 D225 2A22EF          16      LD  HL,(FDRV+14)    ;ディレクトリのクラスタ番号
0004C4 D228 AF               4      XOR A
0004C5 D229 11FEFF          10      LD  DE,0-2
0004C8 D22C 19              11      ADD HL,DE
0004C9 D22D 23               6      INC HL
0004CA D22E DCA8D2          17      CALL    C,PRDEC_HL
0004CD D231 1841            12      JR  LTNL
                                
       D233                     P_NAME:
0004CF D233 3AD4D4          13      LD  A,(DTA_CCP+1)
0004D2 D236 FE2E             7      CP  '.'
0004D4 D238 C8              11      RET Z
0004D5 D239 1151D5          10      LD  DE,DIRHD
0004D8 D23C CDD9D5          17      CALL    _SYS09      ;(BDOS)文字列出力
0004DB D23F 3ADFD4          13      LD  A,(DTA_CCP+1+00BH)
0004DE D242 F5              11      PUSH    AF
0004DF D243 0F               4      RRCA
0004E0 D244 9F               4      SBC A,A
0004E1 D245 E60A             7      AND '*'-020H
0004E3 D247 C620             7      ADD A,020H
0004E5 D249 CDC6D8          17      CALL    MSG_A
0004E8 D24C CD9BD2          17      CALL    PUTDRV
0004EB D24F 21D4D4          10      LD  HL,DTA_CCP+1
0004EE D252 CDECD2          17      CALL    FPRNT
                                
0004F1 D255 F1              10      POP AF
0004F2 D256 CB67             8      BIT 4,A
0004F4 D258 2808            12      JR  Z,DIR3
0004F6 D25A 1146D5          10      LD  DE,DIRMES
0004F9 D25D CDD9D5          17      CALL    _SYS09      ;(BDOS)文字列出力
0004FC D260 180A            12      JR  DIR6
       D262                     DIR3:
0004FE D262 ED5BF2D4        20      LD  DE,(DTA_CCP+1+01EH)
000502 D266 2AF0D4          16      LD  HL,(DTA_CCP+1+01CH)
000505 D269 CDACD2          17      CALL    PRDEC_DEHL
       D26C                     DIR6:
000508 D26C 3AB1EF          13      LD  A,(CRTCD+1)
00050B D26F FE29             7      CP  40+1
00050D D271 D40ED3          17      CALL    NC,PRTTMS
                                
       D274                     LTNL:
000510 D274 1E03             7      LD  E,3
000512 D276 C3CDEF          10      JP  _PRINT
                                
       D279                     C_PATH:
000515 D279 CDE5DD          17      CALL    SPCUT
000518 D27C 21F8D4          10      LD  HL,PATHD
00051B D27F FE21             7      CP  021H
00051D D281 300C            12      JR  NC,CPATH0
       D283                     CPATHP:
00051F D283 7E               7      LD  A,(HL)
000520 D284 23               6      INC HL
000521 D285 FE20             7      CP  020H
000523 D287 3F               4      CCF
000524 D288 30EA            12      JR  NC,LTNL
000526 D28A CDC6D8          17      CALL    MSG_A
000529 D28D 18F4            12      JR  CPATHP
       D28F                     CPATH0:
00052B D28F FE3B             7      CP  ';'
00052D D291 2001            12      JR  NZ,CPATH1
00052F D293 13               6      INC DE
       D294                     CPATH1:
000530 D294 EB               4      EX  DE,HL
000531 D295 014000          10      LD  BC,PATHX
000534 D298 EDB0                    LDIR
000536 D29A C9              10      RET
                                
       D29B                     PUTDRV:
000537 D29B 3A14EF          13      LD  A,(FDRV)
00053A D29E C640             7      ADD A,'A'-1
00053C D2A0 CDC6D8          17      CALL    MSG_A
00053F D2A3 3E3A             7      LD  A,':'
       D2A5                     MSG_AR:
000541 D2A5 C3C6D8          10      JP  MSG_A
                                
       D2A8                     PRDEC_HL:
000544 D2A8 AF               4      XOR A
       D2A9                     PRDEC_AHL:
000545 D2A9 5F               4      LD  E,A
000546 D2AA 1600             7      LD  D,0
       D2AC                     PRDEC_DEHL:
000548 D2AC D5              11      PUSH    DE
000549 D2AD 110FEF          10      LD  DE,DECBF
00054C D2B0 0605             7      LD  B,5
00054E D2B2 CDB2D3          17      CALL    ZERO_MEMORY_DE  ;A=0
000551 D2B5 D1              10      POP DE
                                
000552 D2B6 0E20             7      LD  C,32
       D2B8                     DEC1:
000554 D2B8 29              11      ADD HL,HL
000555 D2B9 EB               4      EX  DE,HL
000556 D2BA ED6A            15      ADC HL,HL
000558 D2BC EB               4      EX  DE,HL
000559 D2BD E5              11      PUSH    HL
00055A D2BE 2113EF          10      LD  HL,DECBF+4
00055D D2C1 0605             7      LD  B,5
       D2C3                     DEC2:
00055F D2C3 7E               7      LD  A,(HL)
000560 D2C4 8F               4      ADC A,A
000561 D2C5 27               4      DAA
000562 D2C6 77               7      LD  (HL),A
000563 D2C7 2B               6      DEC HL
000564 D2C8 10F9            13      DJNZ    DEC2
000566 D2CA E1              10      POP HL
000567 D2CB 0D               4      DEC C
000568 D2CC 20EA            12      JR  NZ,DEC1
                                
00056A D2CE 210FEF          10      LD  HL,DECBF
00056D D2D1 3E20             7      LD  A,020H
00056F D2D3 0604             7      LD  B,4
       D2D5                     DEC3:
000571 D2D5 CDE2D2          17      CALL    DEC4
000574 D2D8 CDE2D2          17      CALL    DEC4
000577 D2DB 23               6      INC HL
000578 D2DC 10F7            13      DJNZ    DEC3
       D2DE                     DECX:
00057A D2DE CDE2D2          17      CALL    DEC4
00057D D2E1 AF               4      XOR A
       D2E2                     DEC4:
00057E D2E2 ED6F            18      RLD
000580 D2E4 FE20             7      CP  020H
000582 D2E6 2802            12      JR  Z,DEC5
000584 D2E8 F630             7      OR  030H
       D2EA                     DEC5:
000586 D2EA 18B9            12      JR  MSG_AR
                                
       D2EC                     FPRNT:
000588 D2EC 0608             7      LD  B,8
00058A D2EE CDFFD2          17      CALL    P_N1
00058D D2F1 7E               7      LD  A,(HL)
00058E D2F2 C680             7      ADD A,0A0H-020H
000590 D2F4 FEA0             7      CP  0A0H
000592 D2F6 2802            12      JR  Z,FPR1
000594 D2F8 3E2E             7      LD  A,'.'
       D2FA                     FPR1:
000596 D2FA CDC6D8          17      CALL    MSG_A
000599 D2FD 0603             7      LD  B,3
                                
       D2FF                     P_N1:
00059B D2FF C5              11      PUSH    BC
00059C D300 E5              11      PUSH    HL
00059D D301 7E               7      LD  A,(HL)
00059E D302 CD26E0          17      CALL    CAP3
0005A1 D305 CDC6D8          17      CALL    MSG_A
0005A4 D308 E1              10      POP HL
0005A5 D309 C1              10      POP BC
0005A6 D30A 23               6      INC HL
0005A7 D30B 10F2            13      DJNZ    P_N1
0005A9 D30D C9              10      RET
                                
       D30E                     PRTTMS:
0005AA D30E 3E20             7      LD  A,020H
0005AC D310 CDC6D8          17      CALL    MSG_A
                                
0005AF D313 2AECD4          16      LD  HL,(DTA_CCP+1+24)
0005B2 D316 7D               4      LD  A,L
0005B3 D317 B7               4      OR  A
0005B4 D318 C8              11      RET Z
0005B5 D319 CB3C             8      SRL H
0005B7 D31B 17               4      RLA
0005B8 D31C 17               4      RLA
0005B9 D31D 17               4      RLA
0005BA D31E 17               4      RLA
0005BB D31F E60F             7      AND 00FH
0005BD D321 57               4      LD  D,A
0005BE D322 7C               4      LD  A,H
0005BF D323 C650             7      ADD A,80
0005C1 D325 CD68D3          17      CALL    PRDEC_A
0005C4 D328 3E2D             7      LD  A,'-'
0005C6 D32A CDC6D8          17      CALL    MSG_A
0005C9 D32D 7A               4      LD  A,D
0005CA D32E CD68D3          17      CALL    PRDEC_A
0005CD D331 3E2D             7      LD  A,'-'
0005CF D333 CDC6D8          17      CALL    MSG_A
0005D2 D336 7D               4      LD  A,L
0005D3 D337 E61F             7      AND 01FH
0005D5 D339 CD68D3          17      CALL    PRDEC_A
                                
0005D8 D33C 2AEAD4          16      LD  HL,(DTA_CCP+1+22)
                                
0005DB D33F 3E20             7      LD  A,020H
0005DD D341 CDC6D8          17      CALL    MSG_A
0005E0 D344 7C               4      LD  A,H
0005E1 D345 65               4      LD  H,L
0005E2 D346 0603             7      LD  B,3
       D348                     PRTTMS1:
0005E4 D348 1F               4      RRA
0005E5 D349 CB1D             8      RR  L
0005E7 D34B 10FB            13      DJNZ    PRTTMS1
0005E9 D34D E61F             7      AND 01FH
0005EB D34F CD68D3          17      CALL    PRDEC_A
0005EE D352 3E3A             7      LD  A,':'
0005F0 D354 CDC6D8          17      CALL    MSG_A
0005F3 D357 7D               4      LD  A,L
0005F4 D358 0F               4      RRCA
0005F5 D359 0F               4      RRCA
0005F6 D35A E63F             7      AND 03FH
0005F8 D35C CD68D3          17      CALL    PRDEC_A
0005FB D35F 3E3A             7      LD  A,':'
0005FD D361 CDC6D8          17      CALL    MSG_A
000600 D364 7C               4      LD  A,H
000601 D365 E61F             7      AND 01FH
000603 D367 87               4      ADD A,A
                                
                                ;   PRINT10
                                
       D368                     PRDEC_A:
000604 D368 E5              11      PUSH    HL
000605 D369 0608             7      LD  B,8
000607 D36B 4F               4      LD  C,A
000608 D36C AF               4      XOR A
       D36D                     PRTA1:
000609 D36D CB01             4      RLC C
00060B D36F 8F               4      ADC A,A
00060C D370 27               4      DAA
00060D D371 10FA            13      DJNZ    PRTA1
00060F D373 210FEF          10      LD  HL,DECBF
000612 D376 77               7      LD  (HL),A
000613 D377 AF               4      XOR A
000614 D378 CDDED2          17      CALL    DECX
000617 D37B E1              10      POP HL
000618 D37C C9              10      RET
                                
       D37D                     SETFCB:
000619 D37D CDE5DD          17      CALL    SPCUT
00061C D380 1A               7      LD  A,(DE)
00061D D381 FE20             7      CP  020H
00061F D383 3801            12      JR  C,SETFCBA
000621 D385 1B               6      DEC DE
       D386                     SETFCBA:
000622 D386 0624             7      LD  B,36
000624 D388 215C00          10      LD  HL,FCB1
000627 D38B E5              11      PUSH    HL
000628 D38C AF               4      XOR A
000629 D38D CDBADD          17      CALL    FILL_MEMORY
00062C D390 E1              10      POP HL
00062D D391 D5              11      PUSH    DE
00062E D392 CD43D8          17      CALL    _SYS5C      ;(BDOS)ファイル名の解析
000631 D395 216C00          10      LD  HL,FCB2
000634 D398 CD43D8          17      CALL    _SYS5C      ;(BDOS)ファイル名の解析
000637 D39B E1              10      POP HL
000638 D39C 010050          10      LD  BC,05000H
00063B D39F 118100          10      LD  DE,00081H
       D3A2                     SETFCB1:
00063E D3A2 7E               7      LD  A,(HL)
00063F D3A3 23               6      INC HL
000640 D3A4 FE20             7      CP  020H
000642 D3A6 3805            12      JR  C,SETFCB2
000644 D3A8 12               7      LD  (DE),A
000645 D3A9 13               6      INC DE
000646 D3AA 0C               4      INC C
000647 D3AB 10F5            13      DJNZ    SETFCB1
       D3AD                     SETFCB2:
000649 D3AD 79               4      LD  A,C
00064A D3AE 328000          13      LD  (DTA1),A
00064D D3B1 04               4      INC B
       D3B2                     ZERO_MEMORY_DE:
00064E D3B2 AF               4      XOR A
       D3B3                     FILL_MEMORY_DE:
00064F D3B3 12               7      LD  (DE),A
000650 D3B4 13               6      INC DE
000651 D3B5 10FC            13      DJNZ    FILL_MEMORY_DE
000653 D3B7 C9              10      RET
                                
       D3B8                     C_COPY:
000654 D3B8 CD7DD3          17      CALL    SETFCB
                                
000657 D3BB 1161EF          10      LD  DE,BEEPD
00065A D3BE CD06DD          17      CALL    FILEC2
00065D D3C1 216C00          10      LD  HL,FCB2
000660 D3C4 CD4AD8          17      CALL    S29X1
                                
000663 D3C7 3E10             7      LD  A,010H
000665 D3C9 326900          13      LD  (FCB1+13),A
000668 D3CC 216D00          10      LD  HL,FCB2+1
00066B D3CF CDC8D4          17      CALL    CWILD1
       D3D2                     COPY0:
00066E D3D2 CDC5D4          17      CALL    CWILD
000671 D3D5 215C00          10      LD  HL,FCB1
000674 D3D8 CDA3D0          17      CALL    OPEN
000677 D3DB 37               4      SCF
       D3DC                     COPY1:
000678 D3DC C0              11      RET NZ
000679 D3DD CDB6D0          17      CALL    DEFCB
                                
00067C D3E0 3AE0D4          13      LD  A,(DTA_CCP+13)
00067F D3E3 CB67             8      BIT 4,A
000681 D3E5 2821            12      JR  Z,COPY1A
                                
000683 D3E7 215D00          10      LD  HL,FCB1+1
000686 D3EA CD49E1          17      CALL    CHKWILD
000689 D3ED 3814            12      JR  C,COPY9
                                
00068B D3EF 3E20             7      LD  A,020H
00068D D3F1 325D00          13      LD  (FCB1+1),A
000690 D3F4 2AEDD4          16      LD  HL,(DTA_CCP+26)
000693 D3F7 23               6      INC HL
000694 D3F8 226A00          16      LD  (FCB1+14),HL
000697 D3FB 18D5            12      JR  COPY0
                                
       D3FD                     COPY8:
000699 D3FD CDD9D5          17      CALL    _SYS09      ;(BDOS)文字列出力
00069C D400 CD74D2          17      CALL    LTNL
       D403                     COPY9:
00069F D403 CDB2D0          17      CALL    OPEN2
0006A2 D406 18D4            12      JR  COPY1
                                
       D408                     COPY1A:
0006A4 D408 216C00          10      LD  HL,FCB2
0006A7 D40B 1114EF          10      LD  DE,FDRV
0006AA D40E 01D5D4          10      LD  BC,DTA_CCP+2
0006AD D411 EDA0            16      LDI
0006AF D413 3E0B             7      LD  A,11
       D415                     COPY2:
0006B1 D415 F5              11      PUSH    AF
0006B2 D416 7E               7      LD  A,(HL)
0006B3 D417 FE3F             7      CP  '?'
0006B5 D419 2001            12      JR  NZ,COPY3
0006B7 D41B 0A               7      LD  A,(BC)
       D41C                     COPY3:
0006B8 D41C 12               7      LD  (DE),A
0006B9 D41D 03               6      INC BC
0006BA D41E 13               6      INC DE
0006BB D41F 23               6      INC HL
0006BC D420 F1              10      POP AF
0006BD D421 3D               4      DEC A
0006BE D422 20F1            12      JR  NZ,COPY2
0006C0 D424 010500          10      LD  BC,16-11
0006C3 D427 EDB0                    LDIR
       D429                     PUTNAME:
0006C5 D429 215D00          10      LD  HL,FCB1+1
0006C8 D42C CD49E1          17      CALL    CHKWILD
0006CB D42F 300B            12      JR  NC,PUTN1
0006CD D431 2115EF          10      LD  HL,FDRV+1
0006D0 D434 CDECD2          17      CALL    FPRNT
0006D3 D437 3E20             7      LD  A,020H
0006D5 D439 CDC6D8          17      CALL    MSG_A
       D43C                     PUTN1:
0006D8 D43C 1114EF          10      LD  DE,FDRV
0006DB D43F 0E16             7      LD  C,016H      ;(BDOS)ファイルの作成
0006DD D441 CDD1D0          17      CALL    SYSTEM0
0006E0 D444 2048            12      JR  NZ,COPYE2
0006E2 D446 67               4      LD  H,A     ;A=0
0006E3 D447 6F               4      LD  L,A
0006E4 D448 2235EF          16      LD  (FDRV+33),HL    ;(FCB)ランダムレコード
0006E7 D44B 2237EF          16      LD  (FDRV+35),HL
       D44E                     COPY6:
0006EA D44E CDDAD0          17      CALL    S27BUF
0006ED D451 47               4      LD  B,A
0006EE D452 3C               4      INC A
0006EF D453 2831            12      JR  Z,COPYE
0006F1 D455 7C               4      LD  A,H
0006F2 D456 B5               4      OR  L
0006F3 D457 280C            12      JR  Z,COPY7
0006F5 D459 1114EF          10      LD  DE,FDRV
0006F8 D45C 0E26             7      LD  C,026H      ;(BDOS)ランダムブロック書き込み
0006FA D45E CDD1D0          17      CALL    SYSTEM0
0006FD D461 2023            12      JR  NZ,COPYE
0006FF D463 10E9            13      DJNZ    COPY6
       D465                     COPY7:
000701 D465 3AE0D4          13      LD  A,(DTA_CCP+13)  ;(FCB)属性
000704 D468 3221EF          13      LD  (FDRV+13),A
000707 D46B 21E7D4          10      LD  HL,DTA_CCP+20   ;(FCB)タイムスタンプ
00070A D46E 1128EF          10      LD  DE,FDRV+20
00070D D471 010400          10      LD  BC,4
000710 D474 EDB0                    LDIR
                                
000712 D476 1114EF          10      LD  DE,FDRV
000715 D479 0E10             7      LD  C,010H      ;(BDOS)ファイルのクローズ
000717 D47B CDD1D0          17      CALL    SYSTEM0
00071A D47E 2006            12      JR  NZ,COPYE
                                
00071C D480 1171EF          10      LD  DE,OK
00071F D483 C3FDD3          10      JP  COPY8
                                
       D486                     COPYE:
000722 D486 1114EF          10      LD  DE,FDRV
000725 D489 0E13             7      LD  C,013H      ;(BDOS)ファイルの削除
000727 D48B CD0500          17      CALL    SYSTEM
       D48E                     COPYE2:
00072A D48E 37               4      SCF
00072B D48F C9              10      RET
                                
       D490                     C_TYPE:
00072C D490 CD7DD3          17      CALL    SETFCB
00072F D493 215C00          10      LD  HL,FCB1
000732 D496 CDA3D0          17      CALL    OPEN
000735 D499 37               4      SCF
       D49A                     TYPE1:
000736 D49A C0              11      RET NZ
000737 D49B CDB6D0          17      CALL    DEFCB
00073A D49E 3E06             7      LD  A,6
00073C D4A0 CDC6D8          17      CALL    MSG_A
       D4A3                     TYPE2:
00073F D4A3 CDDAD0          17      CALL    S27BUF
000742 D4A6 C6FE             7      ADD A,0FEH
000744 D4A8 D8              11      RET C
000745 D4A9 7C               4      LD  A,H
000746 D4AA B5               4      OR  L
000747 D4AB 2813            12      JR  Z,TYPEE
000749 D4AD 010001          10      LD  BC,00100H
       D4B0                     TYPE3:
00074C D4B0 0A               7      LD  A,(BC)
00074D D4B1 03               6      INC BC
00074E D4B2 FE1A             7      CP  01AH
000750 D4B4 280A            12      JR  Z,TYPEE
000752 D4B6 CDC6D8          17      CALL    MSG_A
000755 D4B9 2B               6      DEC HL
000756 D4BA 7C               4      LD  A,H
000757 D4BB B5               4      OR  L
000758 D4BC 20F2            12      JR  NZ,TYPE3
00075A D4BE 18E3            12      JR  TYPE2
       D4C0                     TYPEE:
00075C D4C0 CDB2D0          17      CALL    OPEN2
00075F D4C3 18D5            12      JR  TYPE1
                                
       D4C5                     CWILD:
000761 D4C5 215D00          10      LD  HL,FCB1+1
       D4C8                     CWILD1:
000764 D4C8 7E               7      LD  A,(HL)
000765 D4C9 FE20             7      CP  020H
000767 D4CB C0              11      RET NZ
       D4CC                     CWILD2:
000768 D4CC 3E3F             7      LD  A,'?'
00076A D4CE 060B             7      LD  B,11
00076C D4D0 C3BADD          10      JP  FILL_MEMORY
                                
       D4D3                     DTA_CCP:
00076F D4D3                         DS  37
                                
       0040                     PATHX   EQU 64
000794 D4F8                     PATHD:  DS  PATHX
0007D4 D538 00                  PATHE:  DB  0
                                
0007D5 D539 2062797465732066    FREE:   DB  " bytes free",9,'$'
            7265650924          
0007E2 D546 20202020203C4449    DIRMES: DB  "     <DIR>$"
            523E24              
0007ED D551 20203A24            DIRHD:  DB  "  :$"
                                
       D555                     COMTB:
0007F1 D555 44202020                DB  "D   "  ;1
0007F5 D559 D4D1                    DW  C_DIR
0007F7 D55B 44495220                DB  "DIR "  ;2
0007FB D55F D4D1                    DW  C_DIR
0007FD D561 434F5059                DB  "COPY"  ;3
000801 D565 B8D3                    DW  C_COPY
000803 D567 43442020                DB  "CD  "  ;4
000807 D56B D6D0                    DW  C_CD
000809 D56D 44454C20                DB  "DEL "  ;5
00080D D571 B7D1                    DW  C_DEL
00080F D573 50415448                DB  "PATH"  ;6
000813 D577 79D2                    DW  C_PATH
000815 D579 52454E20                DB  "REN "  ;7
000819 D57D C1D1                    DW  C_REN
00081B D57F 54595045                DB  "TYPE"  ;8
00081F D583 90D4                    DW  C_TYPE
000821 D585 52454D20                DB  "REM "  ;9
000825 D589 D6D5                    DW  C_REM
[EOF:LDCCP.ASM:SHIFT_JIS]
                                    INCLUDE "M7CCP2.ASM"
                                
                                ;   LSX-Dodgers CCP2
                                ;   MZ-700/1500
                                
000827 D58B 4D4F4E20                DB  "MON "  ;10
00082B D58F B3CF                    DW  C_MON
[EOF:M7CCP2.ASM:UTF_8]
                                    INCLUDE "LDOS.ASM"
                                
                                ;   LSX-Dodgers OS
                                
       D591                     BDOS0:
00082D D591 E5              11      PUSH    HL
00082E D592 210001          10      LD  HL,00100H
000831 D595 39              11      ADD HL,SP
000832 D596 3810            12      JR  C,BDOS1X
       D598                     BDOS2:
000834 D598 E1              10      POP HL
000835 D599 ED73A4D5        20      LD  (BDSP+1),SP
000839 D59D 31FECF          10      LD  SP,EXTSP
00083C D5A0 CDA7D5          17      CALL    BDOS1
00083F D5A3 310000          10  BDSP:   LD  SP,0
000842 D5A6 C9              10      RET
       D5A7                     BDOS1:
000843 D5A7 E5              11      PUSH    HL
       D5A8                     BDOS1X:
000844 D5A8 79               4      LD  A,C
000845 D5A9 FE3C             7      CP  03CH
000847 D5AB 3802            12      JR  C,DOS1
000849 D5AD 3E3C             7      LD  A,03CH
       D5AF                     DOS1:
00084B D5AF 87               4      ADD A,A
00084C D5B0 6F               4      LD  L,A
00084D D5B1 26F0             7      LD  H,STABLE/256
00084F D5B3 7E               7      LD  A,(HL)
000850 D5B4 2C               4      INC L
000851 D5B5 66               7      LD  H,(HL)
000852 D5B6 6F               4      LD  L,A
000853 D5B7 E3              19      EX  (SP),HL
000854 D5B8 79               4      LD  A,C
000855 D5B9 C9              10      RET
       D5BA                     _DOS2:
000856 D5BA FE5A             7      CP  05AH        ;(BDOS)カレントディレクトリの変更(_CHDIR)
000858 D5BC CA87D8          10      JP  Z,_SYS5A
00085B D5BF FE5C             7      CP  05CH        ;(BDOS)ファイル名の解析(_PFILE)
00085D D5C1 CA43D8          10      JP  Z,_SYS5C
000860 D5C4 FE5F             7      CP  05FH        ;(BDOS)ディスクバッファのフラッシュ(_FLUSH)
000862 D5C6 CAC1E9          10      JP  Z,_SYS5F
000865 D5C9 FE6F             7      CP  06FH        ;(BDOS)MSX-DOS のバージョン番号の獲得(_DOSVER)
000867 D5CB 200A            12      JR  NZ,_ERROR
000869 D5CD 011D01          10      LD  BC,011DH
00086C D5D0 114601          10      LD  DE,VER
00086F D5D3 210100          10      LD  HL,MACD
       D5D6                     C_REM:
000872 D5D6 AF               4      XOR A
       D5D7                     _ERROR:
000873 D5D7 A7               4      AND A
000874 D5D8 C9              10      RET
                                
       D5D9                     _SYS09:     ;文字列出力
000875 D5D9 D5              11      PUSH    DE
       D5DA                     _SX09:
000876 D5DA 1A               7      LD  A,(DE)
000877 D5DB 13               6      INC DE
000878 D5DC FE24             7      CP  '$'
00087A D5DE 2831            12      JR  Z,SX0E2
00087C D5E0 CDC6D8          17      CALL    MSG_A
00087F D5E3 18F5            12      JR  _SX09
                                
       D5E5                     MSX1:
000881 D5E5 CDC6D8          17      CALL    MSG_A
       D5E8                     MSX:
000884 D5E8 7E               7      LD  A,(HL)
000885 D5E9 23               6      INC HL
000886 D5EA B7               4      OR  A
000887 D5EB 20F8            12      JR  NZ,MSX1
000889 D5ED C9              10      RET
                                
       D5EE                     _SYS0C:     ;(BDOS)バージョン番号の獲得
00088A D5EE 212200          10      LD  HL,00022H
00088D D5F1 7D               4      LD  A,L
00088E D5F2 C9              10      RET
                                
       D5F3                     _SYS0D:     ;(BDOS)ディスクリセット
00088F D5F3 CDDFEF          17      CALL    _FFLUSH
000892 D5F6 E5              11      PUSH    HL
000893 D5F7 218000          10      LD  HL,00080H
000896 D5FA 228AEF          16      LD  (_DTA),HL
000899 D5FD E1              10      POP HL
00089A D5FE D5              11      PUSH    DE
00089B D5FF 1E00             7      LD  E,0
00089D D601 3E                      DB  03EH
                                
       D602                     _SYS0E:     ;(BDOS)カレントドライブの設定
00089E D602 D5              11      PUSH    DE
00089F D603 7B               4      LD  A,E
0008A0 D604 DDE5            15      PUSH    IX
0008A2 D606 CDDCEF          17      CALL    _GETDPB
0008A5 D609 DDE1            14      POP IX
0008A7 D60B 3804            12      JR  C,SX0E2
0008A9 D60D 7B               4      LD  A,E
0008AA D60E 3287EF          13      LD  (_DVSW),A
       D611                     SX0E2:
0008AD D611 3E08             7      LD  A,8
0008AF D613 D1              10      POP DE
0008B0 D614 C9              10      RET
                                
       D615                     _SYS0F:     ;(BDOS)ファイルのオープン
0008B1 D615 CDF7DD          17      CALL    SETDRV
0008B4 D618 FD7E1C          19      LD  A,(IY+28)   ;(FCB)オープンモード
0008B7 D61B C602             7      ADD A,002H      ;Write
0008B9 D61D 2848            12      JR  Z,FEND0F
0008BB D61F CD45E1          17      CALL    CHKWILDX
                                
0008BE D622 D417DE          17      CALL    NC,SOPENX
       D625                     _S16XX:
0008C1 D625 3840            12      JR  C,FEND0F
                                                ;Directory location
0008C3 D627 3A9FEF          13      LD  A,(_FILEN)
0008C6 D62A FD7719          19      LD  (IY+25),A   ;(FCB)ディレクトリロケーション
                                ;               _DIRF
0008C9 D62D 3AA0EF          13      LD  A,(_DIRF)
0008CC D630 FD771D          19      LD  (IY+29),A   ;(FCB)ディレクトリモード
                                ;               _FBPS
0008CF D633 FD731E          19      LD  (IY+30),E   ;(FCB)ディレクトリポジション
0008D2 D636 FD721F          19      LD  (IY+31),D
                                ;               Open(Read)
0008D5 D639 FD361CFF        19      LD  (IY+28),0FFH    ;(FCB)オープンモード
                                ;               FILENAME
0008D9 D63D FDE5            15      PUSH    IY
0008DB D63F D1              10      POP DE
0008DC D640 13               6      INC DE
0008DD D641 010B00          10      LD  BC,11
0008E0 D644 EDB0                    LDIR
                                ;               Attribute
0008E2 D646 7E               7      LD  A,(HL)
0008E3 D647 FD770D          19      LD  (IY+13),A   ;(FCB)属性(アトリビュート)
0008E6 D64A 110B00          10      LD  DE,11       ;Reserved
0008E9 D64D 19              11      ADD HL,DE
                                                    ;(FCB)ファイルを最後に変更した時刻
0008EA D64E 11EAF0          10      LD  DE,SDDATA       ;(FCB)ファイルを最後に変更した日付
0008ED D651 060A             7      LD  B,SDDATAE-SDDATA    ;(FCB)ファイルの先頭クラスタ
       D653                     S16LOOP:                ;(FCB)ファイルのサイズ(バイト単位)
0008EF D653 1A               7      LD  A,(DE)
0008F0 D654 13               6      INC DE
0008F1 D655 325CD6          13      LD  (S16PAT+2),A
0008F4 D658 7E               7      LD  A,(HL)
0008F5 D659 23               6      INC HL
0008F6 D65A FD7700          19  S16PAT: LD  (IY+0),A
0008F9 D65D 10F4            13      DJNZ    S16LOOP
                                
0008FB D65F AF               4      XOR A
0008FC D660 FD770C          19      LD  (IY+12),A   ;(FCB)カレントブロック
0008FF D663 FD220BD7        20      LD  (OFCB+1),IY
       D667                     FEND0F:
000903 D667 1845            12      JR  FEND10
                                
       D669                     _SYS10:     ;(BDOS)ファイルのクローズ
000905 D669 CDF7DD          17      CALL    SETDRV
000908 D66C FD7E1C          19      LD  A,(IY+28)   ;(FCB)オープンモード
00090B D66F D6FE             7      SUB 0FEH
00090D D671 37               4      SCF
00090E D672 3F               4      CCF
00090F D673 2039            12      JR  NZ,FEND10
       D675                     _S10A:              ;Write
000911 D675 FD770E          19      LD  (IY+14),A   ;(FCB)レコードサイズ/アクセスするディレクトリのクラスタ番号+1
000914 D678 FD770F          19      LD  (IY+15),A
                                
000917 D67B FD341C          23      INC (IY+28)     ;0FEH->0FFH ;オープンモード
00091A D67E CD3DE2          17      CALL    SETTMS
                                
00091D D681 FD7E1D          19      LD  A,(IY+29)   ;(FCB)ディレクトリモード
000920 D684 32A0EF          13      LD  (_DIRF),A
000923 D687 E67F             7      AND 07FH
000925 D689 32EEE6          13      LD  (_SECPS+1),A
000928 D68C FD5E1E          19      LD  E,(IY+30)   ;(FCB)ディレクトリポジション
00092B D68F FD561F          19      LD  D,(IY+31)
00092E D692 CD4BDF          17      CALL    READ_DIR
000931 D695 3817            12      JR  C,FEND10
                                
000933 D697 3A75DE          13  SDECM1: LD  A,(SDECPAT+1)   ;1セクタ辺りのディレクトリエントリ数
000936 D69A 3D               4      DEC A       ;1024=01FH / 512=00FH / 256=7
000937 D69B FDA619          19      AND (IY+25)     ;(FCB)ディレクトリロケーション
00093A D69E 6F               4      LD  L,A
00093B D69F 2600             7      LD  H,0
00093D D6A1 29              11      ADD HL,HL       ;*2
00093E D6A2 29              11      ADD HL,HL       ;*4
00093F D6A3 29              11      ADD HL,HL       ;*8
000940 D6A4 29              11      ADD HL,HL       ;*16
000941 D6A5 29              11      ADD HL,HL       ;*32
000942 D6A6 ED4B7EF0        20      LD  BC,(_DTBUF)
000946 D6AA 09              11      ADD HL,BC
                                
000947 D6AB CD55E1          17      CALL    SDIRENT
       D6AE                     FEND10:
00094A D6AE 1842            12      JR  FEND
                                
       D6B0                     _SYS11:     ;(BDOS)最初のファイルの検索
00094C D6B0 CDF7DD          17      CALL    SETDRV
00094F D6B3 CD44DE          17      CALL    SOPEN
       D6B6                     _S12X1:
000952 D6B6 383A            12      JR  C,FEND
000954 D6B8 CDE4DE          17      CALL    SOPENE2
000957 D6BB ED5B8AEF        20      LD  DE,(_DTA)
00095B D6BF 3A88EF          13      LD  A,(_DRV)
00095E D6C2 3C               4      INC A
00095F D6C3 12               7      LD  (DE),A
000960 D6C4 D5              11      PUSH    DE
000961 D6C5 13               6      INC DE
000962 D6C6 012000          10      LD  BC,32
000965 D6C9 EDB0                    LDIR
000967 D6CB FD6E0E          19      LD  L,(IY+14)   ;(FCB)レコードサイズ/アクセスするディレクトリのクラスタ番号+1
00096A D6CE FD660F          19      LD  H,(IY+15)
00096D D6D1 22F4F0          16      LD  (SCDIR),HL
000970 D6D4 2A9AEF          16      LD  HL,(_FBPS)
000973 D6D7 22F6F0          16      LD  (SFBPS),HL
000976 D6DA 2A9FEF          16      LD  HL,(_FILEN)
000979 D6DD 7C               4      LD  A,H
00097A D6DE B7               4      OR  A
00097B D6DF 2806            12      JR  Z,_S12DIR
00097D D6E1 3AEEE6          13      LD  A,(_SECPS+1)
000980 D6E4 F680             7      OR  080H
000982 D6E6 67               4      LD  H,A
       D6E7                     _S12DIR:
000983 D6E7 22F8F0          16      LD  (SFNDF),HL  ;Directory position and Flags
000986 D6EA E1              10      POP HL
000987 D6EB 1139EF          10      LD  DE,SFILE
00098A D6EE 0E21             7      LD  C,33
       D6F0                     _S11B:
00098C D6F0 EDB0                    LDIR
       D6F2                     FEND:
00098E D6F2 9F               4      SBC A,A     ;CF=0 A=0 : CF=1 A=0FFH
       D6F3                     FENDE:
00098F D6F3 FDE1            14      POP IY
000991 D6F5 C1              10      POP BC
000992 D6F6 D1              10      POP DE
000993 D6F7 E1              10      POP HL
000994 D6F8 C9              10      RET
                                
       D6F9                     _SYS12:     ;(BDOS)次のファイルの検索
000995 D6F9 E5              11      PUSH    HL
000996 D6FA D5              11      PUSH    DE
000997 D6FB C5              11      PUSH    BC
000998 D6FC FDE5            15      PUSH    IY
00099A D6FE CDA8DE          17      CALL    NOPEN
00099D D701 18B3            12      JR  _S12X1
                                
       D703                     _S16K:
00099F D703 FD7E1C          19      LD  A,(IY+28)   ;(FCB)オープンモード
0009A2 D706 FEFD             7      CP  0FDH        ;Device(0FDH)
0009A4 D708 37               4      SCF
0009A5 D709 C8              11      RET Z
                                
0009A6 D70A 110000          10  OFCB:   LD  DE,0
0009A9 D70D D5              11      PUSH    DE
0009AA D70E 061A             7      LD  B,26        ;First cluster
       D710                     S16K1:
0009AC D710 13               6      INC DE
0009AD D711 23               6      INC HL
0009AE D712 10FC            13      DJNZ    S16K1
                                
0009B0 D714 1A               7      LD  A,(DE)
0009B1 D715 BE               7      CP  (HL)
0009B2 D716 2013            12      JR  NZ,S16K2
0009B4 D718 13               6      INC DE
0009B5 D719 23               6      INC HL
0009B6 D71A 1A               7      LD  A,(DE)
0009B7 D71B BE               7      CP  (HL)
0009B8 D71C 200D            12      JR  NZ,S16K2
                                
0009BA D71E E1              10      POP HL
0009BB D71F FDE5            15      PUSH    IY
0009BD D721 D1              10      POP DE
0009BE D722 1A               7      LD  A,(DE)      ;Drive
0009BF D723 BE               7      CP  (HL)
0009C0 D724 2006            12      JR  NZ,S16K3
                                                ;ここはCFが必ず0
0009C2 D726 ED52            15      SBC HL,DE       ;CP HL,DE
0009C4 D728 37               4      SCF
0009C5 D729 C0              11      RET NZ
0009C6 D72A E5              11      PUSH    HL
       D72B                     S16K2:
0009C7 D72B E1              10      POP HL
       D72C                     S16K3:
0009C8 D72C FDE5            15      PUSH    IY
0009CA D72E D1              10      POP DE
       D72F                     _SYS13:     ;(BDOS)ファイルの削除
0009CB D72F CDF7DD          17      CALL    SETDRV
0009CE D732 CD75E0          17      CALL    KILL
       D735                     FEND13:
0009D1 D735 18BB            12      JR  FEND
                                
       D737                     _SYS14:     ;(BDOS)シーケンシャルな読み出し
0009D3 D737 CDF7DD          17      CALL    SETDRV
0009D6 D73A CD6FE2          17      CALL    PUSHRR
0009D9 D73D CDB7E2          17      CALL    GETSEQ
                                
0009DC D740 CDD0E2          17      CALL    RB_READ
0009DF D743 E5              11      PUSH    HL
0009E0 D744 CD83E2          17      CALL    SETSEQ
       D747                     SREAD:
0009E3 D747 E1              10      POP HL
                                
0009E4 D748 C601             7      ADD A,001H
0009E6 D74A 38A6            12      JR  C,FEND
                                
0009E8 D74C 7D               4      LD  A,L
0009E9 D74D D601             7      SUB 001H
       D74F                     FENDX:
0009EB D74F 9F               4      SBC A,A
0009EC D750 E603             7      AND 3
0009EE D752 1F               4      RRA
0009EF D753 189E            12      JR  FENDE
                                
       D755                     _SYS15:     ;(BDOS)シーケンシャルな書き込み
0009F1 D755 CDF7DD          17      CALL    SETDRV
0009F4 D758 CD6FE2          17      CALL    PUSHRR
0009F7 D75B CDB7E2          17      CALL    GETSEQ
                                
0009FA D75E CDC9E2          17      CALL    RB_WRITE
0009FD D761 E5              11      PUSH    HL
0009FE D762 CD83E2          17      CALL    SETSEQ
       D765                     SWRITE:
000A01 D765 E1              10      POP HL
                                
000A02 D766 C6FF             7      ADD A,0FFH
000A04 D768 18E5            12      JR  FENDX
                                
       D76A                     _SYS17:     ;(BDOS)ファイル名の変更
000A06 D76A CDF7DD          17      CALL    SETDRV
000A09 D76D CDCBE0          17      CALL    NAME
000A0C D770 18C3            12      JR  FEND13
                                
       D772                     _SYS16:     ;(BDOS)ファイルの作成
000A0E D772 CDF7DD          17      CALL    SETDRV
                                
000A11 D775 CD45E1          17      CALL    CHKWILDX
000A14 D778 38BB            12      JR  C,FEND13
000A16 D77A FD7E01          19      LD  A,(IY+1)    ;(FCB)主ファイル名
000A19 D77D FE05             7      CP  5
000A1B D77F 2805            12      JR  Z,_S16X2
000A1D D781 FE21             7      CP  021H
000A1F D783 DA35D7          10      JP  C,FEND13
       D786                     _S16X2:
                                ;               Clear FCB
000A22 D786 FDE5            15      PUSH    IY
000A24 D788 E1              10      POP HL
000A25 D789 011000          10      LD  BC,16
000A28 D78C 09              11      ADD HL,BC
       D78D                     _S16X1:
000A29 D78D 70               7      LD  (HL),B      ;B=0
000A2A D78E 23               6      INC HL
000A2B D78F 0D               4      DEC C
000A2C D790 20FB            12      JR  NZ,_S16X1
                                
000A2E D792 CD42E2          17      CALL    SETTMSX
000A31 D795 FD360DFF        19      LD  (IY+13),0FFH    ;(FCB)Attribute
000A35 D799 CD17DE          17      CALL    SOPENX
000A38 D79C 3F               4      CCF
000A39 D79D CC03D7          17      CALL    Z,_S16K
000A3C D7A0 D4F5DE          17      CALL    NC,COPEN
000A3F D7A3 D455E1          17      CALL    NC,SDIRENT
000A42 D7A6 C325D6          10      JP  _S16XX
                                
       D7A9                     _SYS21:     ;(BDOS)ランダムな読み出し
                                
000A45 D7A9 CDF7DD          17      CALL    SETDRV
000A48 D7AC CD6FE2          17      CALL    PUSHRR
000A4B D7AF CD58E5          17      CALL    GET_RR_AHL
                                
000A4E D7B2 CDD0E2          17      CALL    RB_READ
000A51 D7B5 E5              11      PUSH    HL
000A52 D7B6 CDA3E2          17      CALL    POPRR
000A55 D7B9 188C            12      JR  SREAD
                                
       D7BB                     _SYS22:     ;(BDOS)ランダムな書き込み
       D7BB                     _SYS28:     ;(BDOS)ランダムな書き込み・その2
000A57 D7BB CDF7DD          17      CALL    SETDRV
000A5A D7BE CD6FE2          17      CALL    PUSHRR
000A5D D7C1 CD58E5          17      CALL    GET_RR_AHL
                                
000A60 D7C4 CDC9E2          17      CALL    RB_WRITE
000A63 D7C7 E5              11      PUSH    HL
000A64 D7C8 CDA3E2          17      CALL    POPRR
000A67 D7CB 1898            12      JR  SWRITE
                                
       D7CD                     _SYS18:     ;(BDOS)ログインベクトルの獲得
000A69 D7CD 21FF00          10      LD  HL,000FFH
000A6C D7D0 AF               4      XOR A
000A6D D7D1 C9              10      RET
                                
       D7D2                     _SYS19:     ;(BDOS)カレントドライブ番号の獲得
000A6E D7D2 3A87EF          13      LD  A,(_DVSW)
000A71 D7D5 A7               4      AND A
000A72 D7D6 C9              10      RET
                                
       D7D7                     _SYS1A:     ;(BDOS)DTAの設定
000A73 D7D7 ED538AEF        20      LD  (_DTA),DE
000A77 D7DB AF               4      XOR A
000A78 D7DC C9              10      RET
                                
       D7DD                     _SYS1B:     ;(BDOS)ディスク情報の獲得
000A79 D7DD 7B               4      LD  A,E
000A7A D7DE CD0ADE          17      CALL    GETDRV
000A7D D7E1 CDDCEF          17      CALL    _GETDPB
000A80 D7E4 D4E2EF          17      CALL    NC,_RDFATX
000A83 D7E7 210000          10      LD  HL,0
000A86 D7EA D41BE2          17      CALL    NC,DSKF
                                
000A89 D7ED ED5B1CE2        20      LD  DE,(MAXCLP+1)   ;DPB_08_MAXCL-1
000A8D D7F1 1B               6      DEC DE      ;DE←クラスタの総数
000A8E D7F2 FD2A7CF0        20      LD  IY,(_FATBF) ;IY←メモリ上のFATの先頭アドレス
000A92 D7F6 9F               4      SBC A,A
000A93 D7F7 D8              11      RET C
000A94 D7F8 4F               4      LD  C,A     ;C=0
000A95 D7F9 DD7E0F          19      LD  A,(IX+00FH) ;DPB_0F_BPS
000A98 D7FC E60F             7      AND 00FH
000A9A D7FE 47               4      LD  B,A
000A9B D7FF DD7E07          19      LD  A,(IX+7)    ;DPB_07_SECPCL
000A9E D802 C9              10      RET
                                
       D803                     _SYS1D:     ;(BDOS)書き込みが禁止されているディスクの調査
000A9F D803 AF               4      XOR A
000AA0 D804 67               4      LD  H,A
000AA1 D805 6F               4      LD  L,A
000AA2 D806 C9              10      RET
                                
       D807                     _SYS1F:     ;(BDOS)ディスク装置のパラメータの読み出し
000AA3 D807 2100F1          10      LD  HL,DEVICE
000AA6 D80A 7B               4      LD  A,E
000AA7 D80B C3DCEF          10      JP  _GETDPB
                                
       D80E                     _SYS23:     ;(BDOS)ファイルサイズの獲得
000AAA D80E E5              11      PUSH    HL
000AAB D80F 2A1EF0          16      LD  HL,(STABLE+2*00FH)  ;ファイルのオープン
000AAE D812 CD0F00          17      CALL    JP_HL
000AB1 D815 3821            12      JR  C,_S23X1
                                
000AB3 D817 D5              11      PUSH    DE      ;EX DE,IY
000AB4 D818 FDE3            23      EX  (SP),IY     ;
                                ;   POP DE      ;
                                ;   PUSH    DE      ;DEを破壊しないように注意vv
000AB6 D81A FD7E10          19      LD  A,(IY+16)   ;(FCB)ファイルのサイズ(バイト単位)
000AB9 D81D FD6E11          19      LD  L,(IY+17)   ;
000ABC D820 FD6612          19      LD  H,(IY+18)   ;
000ABF D823 C5              11      PUSH    BC      ;
000AC0 D824 FD4613          19      LD  B,(IY+19)   ;
000AC3 D827 CDA9E2          17      CALL    GET_CPM_R_SIZE
000AC6 D82A C1              10      POP BC
       D82B                     _S24X1:
000AC7 D82B FD7521          19      LD  (IY+33),L   ;(FCB)Random record
000ACA D82E FD7422          19      LD  (IY+34),H
000ACD D831 FD7723          19      LD  (IY+35),A
                                ;   POP DE      ;^^^^^^^^^^^^^^^^^^^^^^^^
                                ;   PUSH    DE      ;EX DE,IY
000AD0 D834 FDE3            23      EX  (SP),IY     ;
000AD2 D836 D1              10      POP DE      ;
                                
000AD3 D837 AF               4      XOR A
       D838                     _S23X1:
000AD4 D838 E1              10      POP HL
000AD5 D839 C9              10      RET
                                
       D83A                     _SYS24:     ;(BDOS)ランダムレコードフィールドの設定
000AD6 D83A E5              11      PUSH    HL
000AD7 D83B D5              11      PUSH    DE      ;EX DE,IY
000AD8 D83C FDE3            23      EX  (SP),IY     ;
                                ;   POP DE      ;
                                ;   PUSH    DE      ;DEを破壊しないように注意vv
000ADA D83E CDB7E2          17      CALL    GETSEQ
000ADD D841 18E8            12      JR  _S24X1      ;^^^^^^^^^^^^^^^^^^^^^^^^
                                
       D843                     _SYS5C:     ;(BDOS)ファイル名の解析
000ADF D843 C5              11      PUSH    BC
000AE0 D844 E5              11      PUSH    HL
000AE1 D845 CD0EDD          17      CALL    FILE
000AE4 D848 E1              10      POP HL
000AE5 D849 C1              10      POP BC
       D84A                     S29X1:
000AE6 D84A C5              11      PUSH    BC
000AE7 D84B D5              11      PUSH    DE
000AE8 D84C E5              11      PUSH    HL
000AE9 D84D EB               4      EX  DE,HL
000AEA D84E 2114EF          10      LD  HL,FDRV
000AED D851 010D00          10      LD  BC,13
000AF0 D854 EDB0                    LDIR
000AF2 D856 70               7      LD  (HL),B      ;B=0
000AF3 D857 0E03             7      LD  C,3
000AF5 D859 EDB0                    LDIR
000AF7 D85B E1              10      POP HL
000AF8 D85C D1              10      POP DE
000AF9 D85D C1              10      POP BC
000AFA D85E AF               4      XOR A
000AFB D85F C9              10      RET
                                
       D860                     _SYS30:     ;(BDOS)論理セクタを用いた書き込み
000AFC D860 C5              11      PUSH    BC
000AFD D861 015CE8          10      LD  BC,DWT24B
000B00 D864 1804            12      JR  S2FX
       D866                     _SYS2F:
000B02 D866 C5              11      PUSH    BC
000B03 D867 014CE8          10      LD  BC,DRD24B
       D86A                     S2FX:
000B06 D86A ED4380D8        20      LD  (S2FPAT+1),BC
000B0A D86E CDDFEF          17      CALL    _FFLUSH
                                
000B0D D871 D5              11      PUSH    DE
000B0E D872 E5              11      PUSH    HL
000B0F D873 7D               4      LD  A,L     ;Drive
000B10 D874 CDD9EF          17      CALL    _CHGDRV
000B13 D877 3809            12      JR  C,S30X2
000B15 D879 44               4      LD  B,H     ;Number of clusters
000B16 D87A 2A8AEF          16      LD  HL,(_DTA)
                                
000B19 D87D 0E00             7      LD  C,0
000B1B D87F CD4CE8          17  S2FPAT: CALL    DRD24B
       D882                     S30X2:
000B1E D882 E1              10      POP HL
000B1F D883 D1              10      POP DE
000B20 D884 C1              10      POP BC
000B21 D885 9F               4      SBC A,A
000B22 D886 C9              10      RET
                                
       D887                     _SYS5A:     ;(BDOS)カレントディレクトリの変更
000B23 D887 C5              11      PUSH    BC
000B24 D888 D5              11      PUSH    DE
000B25 D889 E5              11      PUSH    HL
000B26 D88A CD03DD          17      CALL    FILEC
000B29 D88D 210000          10      LD  HL,0
000B2C D890 1114EF          10      LD  DE,FDRV
000B2F D893 2A4EF0          16      LD  HL,(STABLE+2*027H)  ;ランダムブロック読み込み
000B32 D896 CD0F00          17      CALL    JP_HL
000B35 D899 18E7            12      JR  S30X2
[EOF:LDOS.ASM:SHIFT_JIS]
                                    INCLUDE "M7IO.ASM"
                                
                                ;   LSX-Dodgers IO
                                ;   MZ-700/1500
                                
       D5D7                     _SYS04  EQU _ERROR      ;(BDOS)外部出力
       D5D7                     _SYS05  EQU _ERROR      ;(BDOS)プリンタ出力
       D5D7                     _SYS1C  EQU _ERROR      ;(BDOS)ディスクの書き込み禁止化
       D5D7                     _SYS1E  EQU _ERROR      ;(BDOS)ファイル属性の設定
       D5D7                     _SYS20  EQU _ERROR      ;(BDOS)利用者番号の設定と読み出し
       D5D7                     _SYS2E  EQU _ERROR      ;(BDOS)ベリファイ・フラグの設定
                                
       0000                     INT EQU 0
       0000                     INTCTCE EQU 0
       0000                     INTCTC2 EQU 0
                                
       D89B                     KEYSET:
       D89B                     KEYBS:
000B37 D89B B7               4      OR  A
000B38 D89C C8              11      RET Z
       D89D                     KEYBS1:
000B39 D89D CDB3D8          17      CALL    KEYBC_IFBREAK
000B3C D8A0 E5              11      PUSH    HL
000B3D D8A1 F5              11      PUSH    AF
000B3E D8A2 2A90EF          16      LD  HL,(_KEYPS)
000B41 D8A5 2C               4      INC L
000B42 D8A6 7D               4      LD  A,L
000B43 D8A7 BC               4      CP  H
000B44 D8A8 2815            12      JR  Z,POP_AF_HL_SCF_RET
000B46 D8AA 3290EF          13      LD  (_KEYPS),A
000B49 D8AD 26FE             7      LD  H,KEYBF/256
000B4B D8AF F1              10      POP AF
000B4C D8B0 77               7      LD  (HL),A
000B4D D8B1 E1              10      POP HL
000B4E D8B2 C9              10      RET
       D8B3                     KEYBC_IFBREAK:
000B4F D8B3 FE03             7      CP  3
000B51 D8B5 C0              11      RET NZ
       D8B6                     KEYBC:
000B52 D8B6 E5              11      PUSH    HL
000B53 D8B7 210000          10      LD  HL,0
000B56 D8BA 2290EF          16      LD  (_KEYPS),HL
000B59 D8BD E1              10      POP HL
000B5A D8BE C9              10      RET
                                
       D8BF                     POP_AF_HL_SCF_RET:
000B5B D8BF F1              10      POP AF
000B5C D8C0 E1              10      POP HL
000B5D D8C1 37               4      SCF
000B5E D8C2 C9              10      RET
                                
       D8C3                     _SYS01:     ;(BDOS)コンソール入力
000B5F D8C3 CD09EF          17      CALL    _SYS07
       D8C6                     MSG_A:
000B62 D8C6 F5              11      PUSH    AF
000B63 D8C7 D5              11      PUSH    DE
000B64 D8C8 5F               4      LD  E,A
000B65 D8C9 CDCFD8          17      CALL    _SYS02
000B68 D8CC D1              10      POP DE
000B69 D8CD F1              10      POP AF
000B6A D8CE C9              10      RET
                                
       D8CF                     _SYS02:     ;(BDOS)コンソール出力
000B6B D8CF CDE1D8          17      CALL    BREAK
000B6E D8D2 1805            12      JR  PRINTX
                                
       D8D4                     _SYS06:     ;(BDOS)コンソール直接入出力
000B70 D8D4 7B               4      LD  A,E
000B71 D8D5 3C               4      INC A
000B72 D8D6 CACAEF          10      JP  Z,_INKEY
       D8D9                     PRINTX:
000B75 D8D9 C3CDEF          10      JP  _PRINT
                                
       D8DC                     _SYS08:     ;(BDOS)エコーなしコンソール入力
000B78 D8DC CD09EF          17      CALL    _SYS07
000B7B D8DF 1803            12      JR  BREAK1
       D8E1                     BREAK:
000B7D D8E1 CD95DC          17      CALL    CHKEY
       D8E4                     BREAK1:
000B80 D8E4 FE03             7      CP  3       ;CTRL+C
000B82 D8E6 CA00EF          10      JP  Z,CPM_BOOT
000B85 D8E9 FE13             7      CP  013H        ;CTRL+S
000B87 D8EB C0              11      RET NZ
                                
       D8EC                     PAUSE:
000B88 D8EC CDB6D8          17      CALL    KEYBC
                                
       D8EF                     FLGET:
000B8B D8EF CDDFEF          17      CALL    _FFLUSH
000B8E D8F2 E5              11      PUSH    HL
000B8F D8F3 2A8EEF          16      LD  HL,(_TXADR)
000B92 D8F6 7C               4      LD  A,H
000B93 D8F7 C6D0             7      ADD A,0D0H
000B95 D8F9 67               4      LD  H,A
000B96 D8FA CD21CF          17      CALL    RDMMIO
000B99 D8FD 3212D9          13      LD  (FLSMC),A
       D900                     FLGET1:
000B9C D900 CD19CF          17      CALL    RD556VSYNC
000B9F D903 CB77             8      BIT 6,A
000BA1 D905 3EEF             7      LD  A,0EFH      ;カーソル
000BA3 D907 200A            12      JR  NZ,FLGET2
000BA5 D909 3A92EF          13      LD  A,(_KEYD)
000BA8 D90C B7               4      OR  A
000BA9 D90D 3EEF             7      LD  A,0EFH      ;カーソル
000BAB D90F 2002            12      JR  NZ,FLGET2
       D912                     FLSMC   EQU $+1
000BAD D911 3E00             7      LD  A,0     ;自己書き換え
       D913                     FLGET2:
000BAF D913 CD27CF          17      CALL    WRMMIO
000BB2 D916 CDCAEF          17      CALL    _INKEY
000BB5 D919 28E5            12      JR  Z,FLGET1
000BB7 D91B F5              11      PUSH    AF
000BB8 D91C 3A12D9          13      LD  A,(FLSMC)
000BBB D91F CD27CF          17      CALL    WRMMIO
000BBE D922 F1              10      POP AF
000BBF D923 E1              10      POP HL
000BC0 D924 C9              10      RET
                                
       D925                     _SYS0A:     ;(BDOS)文字列入力
000BC1 D925 C5              11      PUSH    BC
000BC2 D926 E5              11      PUSH    HL
000BC3 D927 D5              11      PUSH    DE
000BC4 D928 CDC1DB          17      CALL    GETL
000BC7 D92B 1100FF          10      LD  DE,KBUF
000BCA D92E E1              10      POP HL
000BCB D92F E5              11      PUSH    HL
000BCC D930 0E00             7      LD  C,0
000BCE D932 3004            12      JR  NC,SAX0
000BD0 D934 23               6      INC HL
000BD1 D935 23               6      INC HL
000BD2 D936 1808            12      JR  SAX4
       D938                     SAX0:
000BD4 D938 46               7      LD  B,(HL)
000BD5 D939 23               6      INC HL
       D93A                     SAX1:
000BD6 D93A 23               6      INC HL
000BD7 D93B 1A               7      LD  A,(DE)
000BD8 D93C 13               6      INC DE
000BD9 D93D B7               4      OR  A
000BDA D93E 2004            12      JR  NZ,SAX2
       D940                     SAX4:
000BDC D940 360D            10      LD  (HL),00DH
000BDE D942 1804            12      JR  SAX3
       D944                     SAX2:
000BE0 D944 77               7      LD  (HL),A
000BE1 D945 0C               4      INC C
000BE2 D946 10F2            13      DJNZ    SAX1
       D948                     SAX3:
000BE4 D948 D1              10      POP DE
000BE5 D949 79               4      LD  A,C
000BE6 D94A 13               6      INC DE
000BE7 D94B 12               7      LD  (DE),A
000BE8 D94C 1B               6      DEC DE
000BE9 D94D E1              10      POP HL
000BEA D94E C1              10      POP BC
000BEB D94F A7               4      AND A
000BEC D950 C9              10      RET
                                
       D951                     _SYS0B:     ;(BDOS)コンソール状態のチェック
000BED D951 CDE1D8          17      CALL    BREAK
000BF0 D954 3A92EF          13      LD  A,(_KEYD)
000BF3 D957 B7               4      OR  A
000BF4 D958 C8              11      RET Z
       D959                     CONSTX:
000BF5 D959 CDDFEF          17      CALL    _FFLUSH
000BF8 D95C E5              11      PUSH    HL
000BF9 D95D 2A90EF          16      LD  HL,(_KEYPS)
000BFC D960 7C               4      LD  A,H
000BFD D961 AD               4      XOR L
000BFE D962 E1              10      POP HL
000BFF D963 CC95DC          17      CALL    Z,CHKEY
000C02 D966 C6FF             7      ADD A,0FFH
000C04 D968 9F               4      SBC A,A
000C05 D969 C9              10      RET
                                
       D96A                     _SYS2A:     ;(BDOS)日付の獲得
000C06 D96A 210000          10      LD  HL,0
000C09 D96D 110000          10      LD  DE,0
000C0C D970 AF               4      XOR A
000C0D D971 C9              10      RET
                                
       D972                     _SYS2C:     ;(BDOS)時刻の獲得
000C0E D972 210000          10      LD  HL,0
000C11 D975 110000          10      LD  DE,0
000C14 D978 AF               4      XOR A
000C15 D979 C9              10      RET
                                
       D97A                     ESC1:
000C16 D97A 7B               4      LD  A,E
000C17 D97B FE41             7      CP  'A'
000C19 D97D CA72DA          10      JP  Z,CTRL1E
000C1C D980 FE42             7      CP  'B'
000C1E D982 CA84DB          10      JP  Z,CTRL1F
000C21 D985 FE43             7      CP  'C'
000C23 D987 CA45DA          10      JP  Z,CTRL1C
000C26 D98A FE44             7      CP  'D'
000C28 D98C CA69DA          10      JP  Z,CTRL1D
000C2B D98F FE45             7      CP  'E'
000C2D D991 2802            12      JR  Z,CT0CX
000C2F D993 FE6A             7      CP  'j'
       D995                     CT0CX:
000C31 D995 CA69DB          10      JP  Z,CTRL0C
000C34 D998 FE48             7      CP  'H'
000C36 D99A CAE6DA          10      JP  Z,CTRL0B
000C39 D99D FE4A             7      CP  'J'
000C3B D99F CA6CDB          10      JP  Z,CTRL06
000C3E D9A2 FE4B             7      CP  'K'
000C40 D9A4 CAB8DA          10      JP  Z,CTRL05
000C43 D9A7 FE4C             7      CP  'L'
000C45 D9A9 CA96DB          10      JP  Z,CTRL0E
000C48 D9AC FE54             7      CP  'T'
000C4A D9AE CAB8DA          10      JP  Z,CTRL05
000C4D D9B1 FE78             7      CP  'x'
000C4F D9B3 2804            12      JR  Z,ESC1X
000C51 D9B5 FE79             7      CP  'y'
000C53 D9B7 2002            12      JR  NZ,ESC1Y
       D9B9                     ESC1X:
000C55 D9B9 3601            10      LD  (HL),1
       D9BB                     ESC1Y:
000C57 D9BB FE3D             7      CP  '='
000C59 D9BD 2804            12      JR  Z,ESC1W
000C5B D9BF FE59             7      CP  'Y'
000C5D D9C1 2002            12      JR  NZ,ESC1Z
       D9C3                     ESC1W:
000C5F D9C3 3602            10      LD  (HL),2
       D9C5                     ESC1Z:
000C61 D9C5 FE20             7      CP  020H
000C63 D9C7 3802            12      JR  C,ESC1C
000C65 D9C9 87               4      ADD A,A
000C66 D9CA D0              11      RET NC
       D9CB                     ESC1C:
000C67 D9CB E1              10      POP HL
000C68 D9CC 1832            12      JR  ANK
                                
       D9CE                     ESC:
000C6A D9CE 2131DA          10      LD  HL,PRINTE5
000C6D D9D1 E5              11      PUSH    HL
000C6E D9D2 21F4D9          10      LD  HL,ESCFLG
000C71 D9D5 3600            10      LD  (HL),0
000C73 D9D7 3D               4      DEC A
000C74 D9D8 28A0            12      JR  Z,ESC1
000C76 D9DA 3D               4      DEC A
000C77 D9DB 2009            12      JR  NZ,ESC2
000C79 D9DD 3603            10      LD  (HL),3
000C7B D9DF 7B               4      LD  A,E
000C7C D9E0 D620             7      SUB 020H
000C7E D9E2 32E9D9          13      LD  (ESCYP+1),A
000C81 D9E5 C9              10      RET
       D9E6                     ESC2:
000C82 D9E6 3D               4      DEC A
000C83 D9E7 C0              11      RET NZ
000C84 D9E8 2600             7  ESCYP:  LD  H,0
000C86 D9EA 7B               4      LD  A,E
000C87 D9EB D620             7      SUB 020H
000C89 D9ED 6F               4      LD  L,A
000C8A D9EE C3D6EF          10      JP  _LOC
                                
       D9F1                     PRINT:
000C8D D9F1 C5              11      PUSH    BC
000C8E D9F2 E5              11      PUSH    HL
       D9F4                     ESCFLG  EQU $+1
000C8F D9F3 3E00             7      LD  A,000H      ;自己書き換え
000C91 D9F5 B7               4      OR  A
000C92 D9F6 20D6            12      JR  NZ,ESC
                                
000C94 D9F8 3E1F             7      LD  A,01FH
000C96 D9FA BB               4      CP  E
000C97 D9FB 3038            12      JR  NC,CTRL
       D9FD                     INSFLG  EQU $
000C99 D9FD 013EDB          10      LD  BC,INSERT   ;自己書き換え
       DA00                     ANK:
000C9C DA00 3A96EF          13      LD  A,(_COLORF)
000C9F DA03 4F               4      LD  C,A
000CA0 DA04 7B               4      LD  A,E
000CA1 DA05 FE61             7      CP  'a'     ;英小文字
000CA3 DA07 3806            12      JR  C,PRT1
000CA5 DA09 FE7B             7      CP  'z'+1
000CA7 DA0B 3002            12      JR  NC,PRT1
000CA9 DA0D CBF9             8      SET 7,C
       DA0F                     PRT1:
000CAB DA0F FE86             7      CP  $86     ;ひらがな1(を－そ)
000CAD DA11 3806            12      JR  C,PRT2
000CAF DA13 FEA0             7      CP  $A0
000CB1 DA15 3002            12      JR  NC,PRT2
000CB3 DA17 CBF9             8      SET 7,C
       DA19                     PRT2:
000CB5 DA19 FEE0             7      CP  $E0     ;ひらがな2(たーん)
000CB7 DA1B 3802            12      JR  C,PRT3
000CB9 DA1D CBF9             8      SET 7,C
       DA1F                     PRT3:
000CBB DA1F 2A8EEF          16      LD  HL,(_TXADR)
000CBE DA22 7C               4      LD  A,H
000CBF DA23 C6D0             7      ADD A,0D0H
000CC1 DA25 67               4      LD  H,A
000CC2 DA26 42               4      LD  B,D
000CC3 DA27 16ED             7      LD  D,CD_TABLE/256
000CC5 DA29 1A               7      LD  A,(DE)
000CC6 DA2A 50               4      LD  D,B
000CC7 DA2B CD39CF          17      CALL    IO_PRINT
000CCA DA2E CD45DA          17      CALL    CTRL1C
       DA31                     PRINTE5:
000CCD DA31 E1              10      POP HL
000CCE DA32 C1              10      POP BC
000CCF DA33 AF               4      XOR A
000CD0 DA34 C9              10      RET
                                
       DA35                     CTRL:
000CD1 DA35 7B               4      LD  A,E
000CD2 DA36 87               4      ADD A,A
000CD3 DA37 F680             7      OR  080H
000CD5 DA39 6F               4      LD  L,A
000CD6 DA3A 26F0             7      LD  H,CTRLTB/256
000CD8 DA3C 7E               7      LD  A,(HL)
000CD9 DA3D 2C               4      INC L
000CDA DA3E 66               7      LD  H,(HL)
000CDB DA3F 6F               4      LD  L,A
000CDC DA40 CD0F00          17      CALL    JP_HL
000CDF DA43 18EC            12      JR  PRINTE5
                                
       DA45                     CTRL1C:
000CE1 DA45 ED4B8EEF        20      LD  BC,(_TXADR)
000CE5 DA49 03               6      INC BC
       DA4A                     PRINTE3:
000CE6 DA4A 2118FC          10      LD  HL,0-WIDTH*LINE
000CE9 DA4D A7               4      AND A
000CEA DA4E ED4A            15      ADC HL,BC
       DA50                     PRINTE8:
000CEC DA50 2805            12      JR  Z,PRINT2
000CEE DA52 ED438EEF        20      LD  (_TXADR),BC
       DA56                     CTRL00:
000CF2 DA56 C9              10      RET
                                
       DA57                     PRINT2:
000CF3 DA57 CD9CDB          17      CALL    SCR
000CF6 DA5A 21D8FF          10      LD  HL,0-WIDTH
000CF9 DA5D 09              11      ADD HL,BC
       DA5E                     SET_TXADR_HL:
000CFA DA5E 228EEF          16      LD  (_TXADR),HL
000CFD DA61 C9              10      RET
                                
       DA62                     CTRL08:
000CFE DA62 3AFDD9          13      LD  A,(INSFLG)
000D01 DA65 FECD             7      CP  0CDH        ;CALL ????
000D03 DA67 2823            12      JR  Z,CTRL02
       DA69                     CTRL1D:
000D05 DA69 2A8EEF          16      LD  HL,(_TXADR)
000D08 DA6C 7C               4      LD  A,H
000D09 DA6D B5               4      OR  L
000D0A DA6E C8              11      RET Z
000D0B DA6F 2B               6      DEC HL
000D0C DA70 18EC            12      JR  SET_TXADR_HL
                                
       DA72                     CTRL1E:
000D0E DA72 ED4B8EEF        20      LD  BC,(_TXADR)
000D12 DA76 21D8FF          10      LD  HL,0-WIDTH
000D15 DA79 09              11      ADD HL,BC
000D16 DA7A D0              11      RET NC
000D17 DA7B 18E1            12      JR  SET_TXADR_HL
                                
       DA7D                     CTRL09:
000D19 DA7D ED4B8EEF        20      LD  BC,(_TXADR)
000D1D DA81 79               4      LD  A,C
000D1E DA82 E6F8             7      AND 0F8H
000D20 DA84 C608             7      ADD A,8
000D22 DA86 4F               4      LD  C,A
000D23 DA87 88               4      ADC A,B
000D24 DA88 91               4      SUB C
000D25 DA89 47               4      LD  B,A
000D26 DA8A 18BE            12      JR  PRINTE3
                                
       DA8C                     CTRL02:
000D28 DA8C CD69DA          17      CALL    CTRL1D
000D2B DA8F C8              11      RET Z
000D2C DA90 D5              11      PUSH    DE
000D2D DA91 CDD3EF          17      CALL    _POS
000D30 DA94 54               4      LD  D,H
000D31 DA95 3E28             7      LD  A,WIDTH
000D33 DA97 95               4      SUB L
000D34 DA98 4F               4      LD  C,A
000D35 DA99 0D               4      DEC C
000D36 DA9A 06D0             7      LD  B,0D0H
000D38 DA9C 2A8EEF          16      LD  HL,(_TXADR)
000D3B DA9F 09              11      ADD HL,BC
000D3C DAA0 47               4      LD  B,A
                                
000D3D DAA1 3A5ADB          13      LD  A,(MULINE)
000D40 DAA4 BA               4      CP  D
000D41 DAA5 2007            12      JR  NZ,C02X1
000D43 DAA7 112800          10      LD  DE,WIDTH
000D46 DAAA 19              11      ADD HL,DE
000D47 DAAB 78               4      LD  A,B
000D48 DAAC 83               4      ADD A,E
000D49 DAAD 47               4      LD  B,A
       DAAE                     C02X1:
000D4A DAAE 3A96EF          13      LD  A,(_COLORF) ;C:Color
000D4D DAB1 4F               4      LD  C,A
000D4E DAB2 AF               4      XOR A       ;A:Text
000D4F DAB3 CD78CF          17      CALL    IO_BS
000D52 DAB6 D1              10      POP DE
000D53 DAB7 C9              10      RET
                                
       DAB8                     CTRL05:
000D54 DAB8 CDD3EF          17      CALL    _POS
000D57 DABB 3E28             7      LD  A,WIDTH
000D59 DABD 95               4      SUB L
000D5A DABE 47               4      LD  B,A
       DABF                     C08X1:
000D5B DABF 2A8EEF          16      LD  HL,(_TXADR)
000D5E DAC2 7C               4      LD  A,H
000D5F DAC3 C6D0             7      ADD A,0D0H
000D61 DAC5 67               4      LD  H,A
       DAC6                     CLLINE:
000D62 DAC6 3A96EF          13      LD  A,(_COLORF)
000D65 DAC9 4F               4      LD  C,A
000D66 DACA AF               4      XOR A
000D67 DACB C35FCF          10      JP  IO_CLLINE
                                
       DACE                     CTRL0D:
000D6A DACE CDD3EF          17      CALL    _POS
000D6D DAD1 2E00             7      LD  L,0
       DAD3                     LOC:
000D6F DAD3 C5              11      PUSH    BC
000D70 DAD4 E5              11      PUSH    HL
000D71 DAD5 CDF3DA          17      CALL    LOC1
000D74 DAD8 228EEF          16      LD  (_TXADR),HL
000D77 DADB E1              10      POP HL
000D78 DADC C1              10      POP BC
000D79 DADD C9              10      RET
                                
       DADE                     CTRL12:
000D7A DADE 21FDD9          10      LD  HL,INSFLG
000D7D DAE1 7E               7      LD  A,(HL)
000D7E DAE2 EECC             7      XOR 0CCH        ;CD:CALL ???? 1:LD BC,????
000D80 DAE4 77               7      LD  (HL),A
000D81 DAE5 C9              10      RET
                                
       DAE6                     CTRL0B:
000D82 DAE6 210000          10      LD  HL,0
000D85 DAE9 228EEF          16      LD  (_TXADR),HL
000D88 DAEC C9              10      RET
                                
       DAED                     CTRL1B:
000D89 DAED 3E01             7      LD  A,1
000D8B DAEF 32F4D9          13      LD  (ESCFLG),A
000D8E DAF2 C9              10      RET
                                
       DAF3                     LOC1:
000D8F DAF3 D5              11      PUSH    DE
000D90 DAF4 4D               4      LD  C,L
000D91 DAF5 0608             7      LD  B,8
000D93 DAF7 5C               4      LD  E,H
000D94 DAF8 210028          10      LD  HL,WIDTH*256
000D97 DAFB 55               4      LD  D,L ;L=0
       DAFC                     LOC2:
000D98 DAFC 29              11      ADD HL,HL
000D99 DAFD 3001            12      JR  NC,LOC3
000D9B DAFF 19              11      ADD HL,DE
       DB00                     LOC3:
000D9C DB00 10FA            13      DJNZ    LOC2
000D9E DB02 09              11      ADD HL,BC
000D9F DB03 D1              10      POP DE
000DA0 DB04 C9              10      RET
                                
       DB05                     CONOUT1:
                                ;   CALL    CURSOR
000DA1 DB05 59               4      LD  E,C
000DA2 DB06 CDCDEF          17      CALL    _PRINT
000DA5 DB09 7B               4      LD  A,E
000DA6 DB0A FE0A             7      CP  00AH
000DA8 DB0C 2006            12      JR  NZ,CURSOR
000DAA DB0E CDCEDA          17      CALL    CTRL0D
000DAD DB11 CDB8DA          17      CALL    CTRL05
       DB14                     CURSOR:
000DB0 DB14 C9              10      RET
                                
       DB15                     CTRL07:
000DB1 DB15 06E0             7      LD  B,0E0H
000DB3 DB17 2162EF          10      LD  HL,BEEPD+1
       DB1A                     C07X0:
000DB6 DB1A 4E               7      LD  C,(HL)
000DB7 DB1B 23               6      INC HL
000DB8 DB1C 7E               7      LD  A,(HL)
000DB9 DB1D 23               6      INC HL
000DBA DB1E CD33CF          17      CALL    WRMMIO_BC
000DBD DB21 7D               4      LD  A,L
000DBE DB22 FE6A             7      CP  (BEEPD+1+M7BEEPE-M7BEEPD)&255
000DC0 DB24 20F4            12      JR  NZ,C07X0
000DC2 DB26 0610             7      LD  B,16
       DB28                     C07X1:
000DC4 DB28 CD19CF          17      CALL    RD556VSYNC
000DC7 DB2B 87               4      ADD A,A
000DC8 DB2C 30FA            12      JR  NC,C07X1
       DB2E                     C07X2:
000DCA DB2E CD19CF          17      CALL    RD556VSYNC
000DCD DB31 87               4      ADD A,A
000DCE DB32 38FA            12      JR  C,C07X2
000DD0 DB34 10F2            13      DJNZ    C07X1
                                
000DD2 DB36 AF               4      XOR A
000DD3 DB37 2108E0          10      LD  HL,0E008H
000DD6 DB3A CD27CF          17      CALL    WRMMIO
000DD9 DB3D C9              10      RET
                                
       DB3E                     INSERT:
000DDA DB3E D5              11      PUSH    DE
000DDB DB3F CDD3EF          17      CALL    _POS
000DDE DB42 54               4      LD  D,H
000DDF DB43 3E28             7      LD  A,WIDTH
000DE1 DB45 95               4      SUB L
000DE2 DB46 47               4      LD  B,A
000DE3 DB47 2A8EEF          16      LD  HL,(_TXADR)
000DE6 DB4A 7C               4      LD  A,H
000DE7 DB4B C6D0             7      ADD A,0D0H
000DE9 DB4D 67               4      LD  H,A
000DEA DB4E 3A96EF          13      LD  A,(_COLORF) ;C:Color
000DED DB51 4F               4      LD  C,A
000DEE DB52 AF               4      XOR A       ;A:Text
000DEF DB53 CD6DCF          17      CALL    IO_INS
000DF2 DB56 B7               4      OR  A
000DF3 DB57 2005            12      JR  NZ,INS1
       DB5A                     MULINE  EQU $+1
000DF5 DB59 3EFF             7      LD  A,-1
000DF7 DB5B 92               4      SUB D
000DF8 DB5C 2009            12      JR  NZ,INS2
       DB5E                     INS1:
000DFA DB5E 0628             7      LD  B,WIDTH
000DFC DB60 CD6DCF          17      CALL    IO_INS
000DFF DB63 7A               4      LD  A,D
000E00 DB64 325ADB          13      LD  (MULINE),A
       DB67                     INS2:
000E03 DB67 D1              10      POP DE
000E04 DB68 C9              10      RET
                                
       DB69                     CTRL0C:
000E05 DB69 CDE6DA          17      CALL    CTRL0B
       DB6C                     CTRL06:
000E08 DB6C D5              11      PUSH    DE
000E09 DB6D E5              11      PUSH    HL
000E0A DB6E ED5B8EEF        20      LD  DE,(_TXADR)
000E0E DB72 3A96EF          13      LD  A,(_COLORF)
000E11 DB75 324DCF          13      LD  (ICSMC),A
000E14 DB78 C342CF          10      JP  IO_CLR
                                
       DB7B                     CTRL04:
000E17 DB7B CDD3EF          17      CALL    _POS
000E1A DB7E 7D               4      LD  A,L
000E1B DB7F B7               4      OR  A
000E1C DB80 C8              11      RET Z
       DB81                     CTRL03:
000E1D DB81 CDCEDA          17      CALL    CTRL0D
       DB84                     CTRL0A:
       DB84                     CTRL1F:
000E20 DB84 2A8EEF          16      LD  HL,(_TXADR)
000E23 DB87 012800          10      LD  BC,WIDTH
000E26 DB8A 09              11      ADD HL,BC
000E27 DB8B 44               4      LD  B,H
000E28 DB8C 4D               4      LD  C,L
000E29 DB8D 2118FC          10      LD  HL,0-WIDTH*LINE
000E2C DB90 09              11      ADD HL,BC
000E2D DB91 3F               4      CCF
000E2E DB92 9F               4      SBC A,A
000E2F DB93 C350DA          10      JP  PRINTE8
                                
       DB96                     CTRL0E:
000E32 DB96 CDD3EF          17      CALL    _POS
000E35 DB99 7C               4      LD  A,H
000E36 DB9A 1804            12      JR  SCR1
       DB9C                     SCR:
000E38 DB9C 3A97EF          13      LD  A,(_LINE)
000E3B DB9F 3D               4      DEC A
       DBA0                     SCR1:
000E3C DBA0 C5              11      PUSH    BC
000E3D DBA1 D5              11      PUSH    DE
000E3E DBA2 E5              11      PUSH    HL
000E3F DBA3 1100D0          10      LD  DE,0D000H
000E42 DBA6 2128D0          10      LD  HL,0D000H+WIDTH
                                
000E45 DBA9 47               4      LD  B,A
000E46 DBAA B7               4      OR  A
000E47 DBAB C38ECF          10      JP  IO_SCRUP
                                
       DBAE                     POS:
000E4A DBAE 2A8EEF          16      LD  HL,(_TXADR)
000E4D DBB1 C5              11      PUSH    BC
000E4E DBB2 01D8FF          10      LD  BC,0-WIDTH
000E51 DBB5 AF               4      XOR A
       DBB6                     POS1:
000E52 DBB6 09              11      ADD HL,BC
000E53 DBB7 3C               4      INC A
000E54 DBB8 38FC            12      JR  C,POS1
000E56 DBBA ED42            15      SBC HL,BC
000E58 DBBC 3D               4      DEC A
000E59 DBBD 67               4      LD  H,A
000E5A DBBE C1              10      POP BC
000E5B DBBF A7               4      AND A
000E5C DBC0 C9              10      RET
                                
       DBC1                     GETL:
000E5D DBC1 CDD3EF          17      CALL    _POS
000E60 DBC4 E5              11      PUSH    HL
000E61 DBC5 3ECD             7      LD  A,0CDH      ;CALL ????
000E63 DBC7 32FDD9          13      LD  (INSFLG),A
       DBCA                     GETL1:
000E66 DBCA CDDCD8          17      CALL    _SYS08
000E69 DBCD FE09             7      CP  9
000E6B DBCF 2008            12      JR  NZ,GETL1V
000E6D DBD1 2100FF          10      LD  HL,KBUF
000E70 DBD4 CDE8D5          17      CALL    MSX
000E73 DBD7 18F1            12      JR  GETL1
       DBD9                     GETL1V:
000E75 DBD9 5F               4      LD  E,A
000E76 DBDA CDD3EF          17      CALL    _POS
000E79 DBDD CDCDEF          17      CALL    _PRINT
000E7C DBE0 7B               4      LD  A,E
000E7D DBE1 FE20             7      CP  $20
000E7F DBE3 3809            12      JR  C,GETL1V1
000E81 DBE5 7D               4      LD  A,L
000E82 DBE6 FE27             7      CP  WIDTH-1
000E84 DBE8 2004            12      JR  NZ,GETL1V1
000E86 DBEA 7C               4      LD  A,H
000E87 DBEB 325ADB          13      LD  (MULINE),A
       DBEE                     GETL1V1:
000E8A DBEE 7B               4      LD  A,E
000E8B DBEF FE0D             7      CP  00DH
000E8D DBF1 20D7            12      JR  NZ,GETL1
000E8F DBF3 3E01             7      LD  A,1     ;LD BC,????
000E91 DBF5 32FDD9          13      LD  (INSFLG),A
000E94 DBF8 1100FF          10      LD  DE,KBUF
000E97 DBFB 0628             7      LD  B,WIDTH
000E99 DBFD CDB2D3          17      CALL    ZERO_MEMORY_DE
                                
000E9C DC00 D1              10      POP DE
000E9D DC01 CDD3EF          17      CALL    _POS
000EA0 DC04 6B               4      LD  L,E
000EA1 DC05 3E28             7      LD  A,WIDTH
000EA3 DC07 95               4      SUB L
000EA4 DC08 57               4      LD  D,A
                                
000EA5 DC09 3A5ADB          13      LD  A,(MULINE)
000EA8 DC0C 94               4      SUB H
000EA9 DC0D 2806            12      JR  Z,GL2X
000EAB DC0F 3C               4      INC A
000EAC DC10 200C            12      JR  NZ,GL3X
000EAE DC12 25               4      DEC H
000EAF DC13 1805            12      JR  GL4X
       DC15                     GL2X:
000EB1 DC15 3E1F             7      LD  A,$1F
000EB3 DC17 CDC6D8          17      CALL    MSG_A
       DC1A                     GL4X:
000EB6 DC1A 7A               4      LD  A,D
000EB7 DC1B C628             7      ADD A,WIDTH
000EB9 DC1D 57               4      LD  D,A
       DC1E                     GL3X:
000EBA DC1E CDF3DA          17      CALL    LOC1
000EBD DC21 4D               4      LD  C,L
000EBE DC22 7C               4      LD  A,H
000EBF DC23 C6D0             7      ADD A,0D0H
000EC1 DC25 47               4      LD  B,A
000EC2 DC26 5A               4      LD  E,D
000EC3 DC27 2100FF          10      LD  HL,KBUF
       DC2A                     GETL2:
000EC6 DC2A CDD0EF          17      CALL    _SCRN
000EC9 DC2D 03               6      INC BC
000ECA DC2E 77               7      LD  (HL),A
000ECB DC2F 23               6      INC HL
000ECC DC30 1D               4      DEC E
000ECD DC31 20F7            12      JR  NZ,GETL2
       DC33                     GETL3:
000ECF DC33 2B               6      DEC HL
000ED0 DC34 7E               7      LD  A,(HL)
000ED1 DC35 FE21             7      CP  021H
000ED3 DC37 D0              11      RET NC
000ED4 DC38 3600            10      LD  (HL),0
000ED6 DC3A 15               4      DEC D
000ED7 DC3B 20F6            12      JR  NZ,GETL3
000ED9 DC3D C9              10      RET
                                
       DC3E                     INKEYB:
000EDA DC3E C1              10      POP BC
000EDB DC3F CB47             8      BIT 0,A
000EDD DC41 3E08             7      LD  A,8
000EDF DC43 2016            12      JR  NZ,INKEYD
000EE1 DC45 3E03             7      LD  A,3
000EE3 DC47 1812            12      JR  INKEYD
       DC49                     INKEY:
000EE5 DC49 E5              11      PUSH    HL
000EE6 DC4A 2A90EF          16      LD  HL,(_KEYPS)
000EE9 DC4D 7C               4      LD  A,H
000EEA DC4E AD               4      XOR L
000EEB DC4F 280F            12      JR  Z,GETKEY
000EED DC51 7C               4      LD  A,H
000EEE DC52 3C               4      INC A
000EEF DC53 3291EF          13      LD  (_KEYPS+1),A
000EF2 DC56 6F               4      LD  L,A
000EF3 DC57 26FE             7      LD  H,KEYBF/256
000EF5 DC59 7E               7      LD  A,(HL)
000EF6 DC5A E1              10      POP HL
       DC5B                     INKEYD:
000EF7 DC5B B7               4      OR  A
000EF8 DC5C 3292EF          13      LD  (_KEYD),A
000EFB DC5F C9              10      RET
       DC60                     GETKEY:
000EFC DC60 3A92EF          13      LD  A,(_KEYD)
000EFF DC63 B7               4      OR  A
000F00 DC64 6F               4      LD  L,A
000F01 DC65 2610             7  GKSMC:  LD  H,16
       DC67                     GETKEY1:
000F03 DC67 CD95DC          17      CALL    CHKEY       ;キーを離すまで待つ
000F06 DC6A 281E            12      JR  Z,GETKEY2
000F08 DC6C BD               4      CP  L
000F09 DC6D 201B            12      JR  NZ,GETKEY2
000F0B DC6F CD19CF          17      CALL    RD556VSYNC
000F0E DC72 87               4      ADD A,A
000F0F DC73 30F2            12      JR  NC,GETKEY1
       DC75                     GETKEY1X:
000F11 DC75 CD95DC          17      CALL    CHKEY       ;キーを離すまで待つ
000F14 DC78 2810            12      JR  Z,GETKEY2
000F16 DC7A BD               4      CP  L
000F17 DC7B 200D            12      JR  NZ,GETKEY2
000F19 DC7D CD19CF          17      CALL    RD556VSYNC
000F1C DC80 87               4      ADD A,A
000F1D DC81 38F2            12      JR  C,GETKEY1X
000F1F DC83 25               4      DEC H
000F20 DC84 20E1            12      JR  NZ,GETKEY1
000F22 DC86 3E01             7      LD  A,1
000F24 DC88 1802            12      JR  GETKEY3
       DC8A                     GETKEY2:
000F26 DC8A 3E10             7      LD  A,16
       DC8C                     GETKEY3:
000F28 DC8C 3266DC          13      LD  (GKSMC+1),A
000F2B DC8F 3A92EF          13      LD  A,(_KEYD)
000F2E DC92 B7               4      OR  A
000F2F DC93 E1              10      POP HL
000F30 DC94 C0              11      RET NZ
       DC95                     CHKEY:
000F31 DC95 C5              11      PUSH    BC
000F32 DC96 3E08             7      LD  A,8
000F34 DC98 CD0ECF          17      CALL    RDKEYDATA
000F37 DC9B 3293EF          13      LD  (_KEYD+1),A
000F3A DC9E CB7F             8      BIT 7,A
000F3C DCA0 289C            12      JR  Z,INKEYB
000F3E DCA2 E5              11      PUSH    HL
000F3F DCA3 0E07             7      LD  C,7
000F41 DCA5 2140EC          10      LD  HL,KEY_TABLE
000F44 DCA8 CB47             8      BIT 0,A
000F46 DCAA 2003            12      JR  NZ,INKEY0
000F48 DCAC 2180EC          10      LD  HL,SHIFT_TABLE
       DCAF                     INKEY0:
000F4B DCAF CB77             8      BIT 6,A
000F4D DCB1 2003            12      JR  NZ,INKEY1
000F4F DCB3 21C0EC          10      LD  HL,CTRL_TABLE
       DCB6                     INKEY1:
000F52 DCB6 79               4      LD  A,C
000F53 DCB7 CD0ECF          17      CALL    RDKEYDATA
000F56 DCBA 0608             7      LD  B,8
       DCBC                     INKEY2:
000F58 DCBC 87               4      ADD A,A
000F59 DCBD 3009            12      JR  NC,INKEY3
000F5B DCBF 23               6      INC HL
000F5C DCC0 10FA            13      DJNZ    INKEY2
000F5E DCC2 0D               4      DEC C
000F5F DCC3 79               4      LD  A,C
000F60 DCC4 3C               4      INC A
000F61 DCC5 20EF            12      JR  NZ,INKEY1
000F63 DCC7 06                      DB  $06     ;LD B,?? 次の1バイトを飛ばす
       DCC8                     INKEY3:
000F64 DCC8 7E               7      LD  A,(HL)
000F65 DCC9 E1              10      POP HL
000F66 DCCA C1              10      POP BC
000F67 DCCB 188E            12      JR  INKEYD
                                
       DCCD                     SCRN:
000F69 DCCD E5              11      PUSH    HL
000F6A DCCE CD2DCF          17      CALL    RDMMIO_BC
000F6D DCD1 6F               4      LD  L,A
000F6E DCD2 26EE             7      LD  H,DC_TABLE/256
000F70 DCD4 7E               7      LD  A,(HL)
000F71 DCD5 FE41             7      CP  'A'     ;英小文字チェック
000F73 DCD7 380E            12      JR  C,SCRN1
000F75 DCD9 FE5B             7      CP  'Z'+1
000F77 DCDB DCE9DC          17      CALL    C,SCRNC
000F7A DCDE FEA6             7      CP  $A6     ;ひらがなチェック
000F7C DCE0 3805            12      JR  C,SCRN1
000F7E DCE2 FEE0             7      CP  $E0
000F80 DCE4 DCE9DC          17      CALL    C,SCRNC
       DCE7                     SCRN1:
000F83 DCE7 E1              10      POP HL
000F84 DCE8 C9              10      RET
                                
       DCE9                     SCRNC:
000F85 DCE9 6F               4      LD  L,A
000F86 DCEA 60               4      LD  H,B
000F87 DCEB CBD8             8      SET 3,B
000F89 DCED CD2DCF          17      CALL    RDMMIO_BC
000F8C DCF0 44               4      LD  B,H
000F8D DCF1 CB7F             8      BIT 7,A
000F8F DCF3 7D               4      LD  A,L
000F90 DCF4 C8              11      RET Z
000F91 DCF5 FE5B             7      CP  'Z'+1
000F93 DCF7 3804            12      JR  C,SCRNC_ADD
000F95 DCF9 FEC0             7      CP  $C0
000F97 DCFB 3803            12      JR  C,SCRNC_SUB
       DCFD                     SCRNC_ADD:
000F99 DCFD C620             7      ADD A,$20
000F9B DCFF C9              10      RET
       DD00                     SCRNC_SUB:
000F9C DD00 D620             7      SUB $20
000F9E DD02 C9              10      RET
[EOF:M7IO.ASM:SHIFT_JIS]
                                    INCLUDE "LDFILE.ASM"
                                
                                ;   LSX-Dodgers FILE
                                
       DD03                     FILEC:
000F9F DD03 CD0EDD          17      CALL    FILE
       DD06                     FILEC2:
000FA2 DD06 3A15EF          13      LD  A,(FDRV+1)
000FA5 DD09 FE20             7      CP  020H
000FA7 DD0B C8              11      RET Z
000FA8 DD0C 1839            12      JR  SETDIR1
                                
       DD0E                     FILE:
000FAA DD0E AF               4      XOR A
000FAB DD0F 3214EF          13      LD  (FDRV),A
000FAE DD12 67               4      LD  H,A
000FAF DD13 6F               4      LD  L,A
000FB0 DD14 2222EF          16      LD  (FDRV+14),HL
000FB3 DD17 CDE5DD          17      CALL    SPCUT
000FB6 DD1A CDCADD          17      CALL    CCHK3
000FB9 DD1D 2812            12      JR  Z,DEVI1
000FBB DD1F 13               6      INC DE
000FBC DD20 1A               7      LD  A,(DE)
000FBD DD21 1B               6      DEC DE
000FBE DD22 FE3A             7      CP  ':'
000FC0 DD24 200B            12      JR  NZ,DEVI1
000FC2 DD26 1A               7      LD  A,(DE)      ;DRIVE
000FC3 DD27 CD1AE0          17      CALL    CAP
000FC6 DD2A D640             7      SUB '@'
000FC8 DD2C 13               6      INC DE
000FC9 DD2D 13               6      INC DE
000FCA DD2E 3214EF          13      LD  (FDRV),A
       DD31                     DEVI1:
000FCD DD31 1A               7      LD  A,(DE)
000FCE DD32 D65C             7      SUB 05CH        ;\
000FD0 DD34 2009            12      JR  NZ,NOROOT
000FD2 DD36 6F               4      LD  L,A     ;A=0でH=0のはずなのでHL=0
000FD3 DD37 222EEF          16      LD  (FDRV+26),HL
000FD6 DD3A 2C               4      INC L
000FD7 DD3B 2222EF          16      LD  (FDRV+14),HL
000FDA DD3E 13               6      INC DE
       DD3F                     NOROOT:
                                
       DD3F                     SETDIR:
000FDB DD3F CD6BDD          17      CALL    FILED
000FDE DD42 1A               7      LD  A,(DE)
000FDF DD43 FE5C             7      CP  05CH        ;\
000FE1 DD45 C0              11      RET NZ
000FE2 DD46 13               6      INC DE
       DD47                     SETDIR1:
000FE3 DD47 3E10             7      LD  A,010H      ;Directory
000FE5 DD49 3221EF          13      LD  (FDRV+13),A
000FE8 DD4C D5              11      PUSH    DE
000FE9 DD4D 1114EF          10      LD  DE,FDRV
000FEC DD50 2A1EF0          16      LD  HL,(STABLE+2*00FH)
000FEF DD53 CD0F00          17      CALL    JP_HL
000FF2 DD56 D1              10      POP DE
000FF3 DD57 B7               4      OR  A
000FF4 DD58 C0              11      RET NZ
                                
000FF5 DD59 3A21EF          13      LD  A,(FDRV+13)
000FF8 DD5C CB67             8      BIT 4,A
000FFA DD5E C8              11      RET Z
                                
000FFB DD5F CDB2DD          17      CALL    FILEI
000FFE DD62 2A2EEF          16      LD  HL,(FDRV+26)
001001 DD65 23               6      INC HL
001002 DD66 2222EF          16      LD  (FDRV+14),HL
001005 DD69 18D4            12      JR  SETDIR
                                
       DD6B                     FILED:
001007 DD6B CDB2DD          17      CALL    FILEI
00100A DD6E 2115EF          10      LD  HL,FNAME
                                
00100D DD71 0608             7      LD  B,8
       DD73                     FILE2:
00100F DD73 CDBFDD          17      CALL    CCHKF
001012 DD76 C8              11      RET Z
001013 DD77 FE2A             7      CP  '*'
001015 DD79 282E            12      JR  Z,FILE9
001017 DD7B FE2E             7      CP  '.'
001019 DD7D 280C            12      JR  Z,FILE4
00101B DD7F 77               7      LD  (HL),A
00101C DD80 23               6      INC HL
00101D DD81 10F0            13      DJNZ    FILE2
                                
       DD83                     FILE3:
00101F DD83 CDBFDD          17      CALL    CCHKF
001022 DD86 C8              11      RET Z
001023 DD87 FE2E             7      CP  '.'
001025 DD89 20F8            12      JR  NZ,FILE3
                                
       DD8B                     FILE4:
001027 DD8B 211DEF          10      LD  HL,FNAME+8
00102A DD8E 0603             7      LD  B,3
                                
       DD90                     FILE4L:
00102C DD90 CDBFDD          17      CALL    CCHKF
00102F DD93 C8              11      RET Z
001030 DD94 FE2E             7      CP  '.'
001032 DD96 2008            12      JR  NZ,FILE12
001034 DD98 3215EF          13      LD  (FNAME),A   ;Parent directory(..)
001037 DD9B 3216EF          13      LD  (FNAME+1),A
00103A DD9E 3E20             7      LD  A,020H
       DDA0                     FILE12:
00103C DDA0 FE2A             7      CP  '*'
00103E DDA2 280A            12      JR  Z,FILE10
001040 DDA4 77               7      LD  (HL),A
001041 DDA5 23               6      INC HL
001042 DDA6 10E8            13      DJNZ    FILE4L
001044 DDA8 C9              10      RET
                                
       DDA9                     FILE9:              ;名前の*処理、名前の残りを?で埋める
001045 DDA9 CDAEDD          17      CALL    FILE10
001048 DDAC 18D5            12      JR  FILE3
                                
       DDAE                     FILE10:
00104A DDAE 3E3F             7      LD  A,'?'
00104C DDB0 1808            12      JR  FILL_MEMORY
       DDB2                     FILEI:              ;名前＋拡張子をスペースで初期化
00104E DDB2 3E20             7      LD  A,020H
001050 DDB4 01000B          10      LD  BC,11*256   ;C=0にしておく
001053 DDB7 2115EF          10      LD  HL,FNAME
       DDBA                     FILL_MEMORY:            ;HLからBバイトAで埋める
001056 DDBA 77               7      LD  (HL),A
001057 DDBB 23               6      INC HL
001058 DDBC 10FC            13      DJNZ    FILL_MEMORY
00105A DDBE C9              10      RET
                                
       DDBF                     CCHKF:
00105B DDBF 1A               7      LD  A,(DE)
00105C DDC0 CDC7DD          17      CALL    CCHK2
00105F DDC3 C8              11      RET Z
001060 DDC4 C332E1          10      JP  FKAN
                                
       DDC7                     CCHK2:
001063 DDC7 0C               4      INC C
001064 DDC8 0D               4      DEC C
001065 DDC9 C0              11      RET NZ
       DDCA                     CCHK3:              ;ZF=1 で使えない文字
001066 DDCA FE2B             7      CP  '+'
001068 DDCC C8              11      RET Z
001069 DDCD FE2C             7      CP  ','
00106B DDCF C8              11      RET Z
00106C DDD0 FE2F             7      CP  '/'
00106E DDD2 C8              11      RET Z
00106F DDD3 FE3A             7      CP  ':'
001071 DDD5 C8              11      RET Z
001072 DDD6 FE3B             7      CP  ';'
001074 DDD8 C8              11      RET Z
001075 DDD9 FE3D             7      CP  '='
001077 DDDB C8              11      RET Z
001078 DDDC FE5C             7      CP  05CH    ;\
00107A DDDE C8              11      RET Z
00107B DDDF FE20             7      CP  020H
00107D DDE1 D0              11      RET NC
00107E DDE2 BF               4      CP  A       ;Z=1
00107F DDE3 C9              10      RET
                                
       DDE4                     SS1:
001080 DDE4 13               6      INC DE
       DDE5                     SPCUT:              ;スペースをカット
001081 DDE5 1A               7      LD  A,(DE)
001082 DDE6 FE20             7      CP  020H
001084 DDE8 28FA            12      JR  Z,SS1
001086 DDEA C9              10      RET
                                
       DDEB                     SETDRVF:
001087 DDEB 1114EF          10      LD  DE,FDRV
       DDEE                     SETDRV0:
00108A DDEE CDF7DD          17      CALL    SETDRV
00108D DDF1 FDE1            14      POP IY
00108F DDF3 C1              10      POP BC
001090 DDF4 D1              10      POP DE
001091 DDF5 E1              10      POP HL
001092 DDF6 C9              10      RET
                                
       DDF7                     SETDRV:
001093 DDF7 E3              19      EX  (SP),HL     ;HL=RETRN ADDRESS
001094 DDF8 D5              11      PUSH    DE      ;PUSH HL/DE/BC/IY
001095 DDF9 C5              11      PUSH    BC
001096 DDFA 1A               7      LD  A,(DE)
001097 DDFB D5              11      PUSH    DE
001098 DDFC FDE3            23      EX  (SP),IY
                                
00109A DDFE CD0ADE          17      CALL    GETDRV
00109D DE01 3C               4      INC A
00109E DE02 FD7700          19      LD  (IY+0),A    ;(FCB)ドライブ番号
0010A1 DE05 3D               4      DEC A
0010A2 DE06 CDD9EF          17      CALL    _CHGDRV
                                
0010A5 DE09 E9               4      JP  (HL)
                                
       DE0A                     GETDRV:
0010A6 DE0A E67F             7      AND 07FH
0010A8 DE0C D601             7      SUB 001H
0010AA DE0E 3003            12      JR  NC,GETDRV1
0010AC DE10 3A87EF          13      LD  A,(_DVSW)   ;Current Drive
       DE13                     GETDRV1:
0010AF DE13 3288EF          13      LD  (_DRV),A
0010B2 DE16 C9              10      RET
                                
       DE17                     SOPENX:
0010B3 DE17 1139EF          10      LD  DE,SFILE
0010B6 DE1A 1A               7      LD  A,(DE)
0010B7 DE1B FDBE00           7      CP  (IY+0)      ;(FCB)ドライブ番号
0010BA DE1E 2024            12      JR  NZ,SOPEN
0010BC DE20 13               6      INC DE
0010BD DE21 FDE5            15      PUSH    IY
0010BF DE23 E1              10      POP HL
0010C0 DE24 23               6      INC HL
0010C1 DE25 CDB2DF          17      CALL    CPFILE
0010C4 DE28 201A            12      JR  NZ,SOPEN
                                
0010C6 DE2A 2AF4F0          16      LD  HL,(SCDIR)
0010C9 DE2D FD750E          19      LD  (IY+14),L   ;(FCB)アクセスするディレクトリのクラスタ番号+1
0010CC DE30 FD740F          19      LD  (IY+15),H
                                
0010CF DE33 2AF8F0          16      LD  HL,(SFNDF)  ;Direcroty location and Flags
0010D2 DE36 229FEF          16      LD  (_FILEN),HL
                                
0010D5 DE39 ED5BF6F0        20      LD  DE,(SFBPS)
0010D9 DE3D 2139EF          10      LD  HL,SFILE
0010DC DE40 36FF            10      LD  (HL),0FFH
0010DE DE42 23               6      INC HL
0010DF DE43 C9              10      RET
       DE44                     SOPEN:
0010E0 DE44 215ADF          10      LD  HL,FILESE
       DE47                     SOPENC:
0010E3 DE47 2280DE          16      LD  (OPENPAT+1),HL
                                
0010E6 DE4A CDE2EF          17      CALL    _RDFATX     ;Detect Media
0010E9 DE4D 3856            12      JR  C,RDDERR
                                
0010EB DE4F AF               4      XOR A
0010EC DE50 329FEF          13      LD  (_FILEN),A
0010EF DE53 CD5FE0          17      CALL    LDDIRX1     ;A=0で呼び出す
0010F2 DE56 2818            12      JR  Z,SDIRX1
                                
0010F4 DE58 CD4BDF          17      CALL    READ_DIR    ;Sub Directory
0010F7 DE5B 3808            12      JR  C,SDIRX0
0010F9 DE5D 2A7EF0          16      LD  HL,(_DTBUF)
0010FC DE60 7E               7      LD  A,(HL)
0010FD DE61 FE2E             7      CP  '.'
0010FF DE63 280F            12      JR  Z,SOPEN1
       DE65                     SDIRX0:
001101 DE65 AF               4      XOR A
001102 DE66 32A0EF          13      LD  (_DIRF),A
001105 DE69 FD360E01        19      LD  (IY+14),1   ;(FCB)レコードサイズ
001109 DE6D FD770F          19      LD  (IY+15),A
       DE70                     SDIRX1:
00110C DE70 ED5BFCF0        20      LD  DE,(_DIRPS) ;Root Directory
       DE74                     SOPEN1:
001110 DE74 0E20             7  SDECPAT:LD  C,32        ;自己書き換え 1セクタ辺りのディレクトリエントリ数  1024=32 / 512=16 / 256=8
       DE76                     SOPEN1X:
001112 DE76 CD4BDF          17      CALL    READ_DIR    ;FILE SEARCH
001115 DE79 382A            12      JR  C,RDDERR
001117 DE7B 2A7EF0          16      LD  HL,(_DTBUF)
       DE7E                     SOPEN2:
00111A DE7E D5              11      PUSH    DE
00111B DE7F CD5ADF          17  OPENPAT:CALL    FILESE      ;(self-modifying code)
00111E DE82 D1              10      POP DE
00111F DE83 386E            12      JR  C,SOPENE
001121 DE85 281B            12      JR  Z,SCF_FF_RET
       DE87                     SOPEN3:
001123 DE87 3AA0EF          13      LD  A,(_DIRF)   ;ディレクトリか判別
001126 DE8A B7               4      OR  A
001127 DE8B 200C            12      JR  NZ,SOPEN5
001129 DE8D 13               6      INC DE      ;ルートディレクトリ
00112A DE8E E5              11      PUSH    HL
00112B DE8F 210C00          10  MD_PAT: LD  HL,12       ;(self-modifying code)MAXDIR
00112E DE92 ED52            15      SBC HL,DE       ;CF=0 なので SUB HL,DE
001130 DE94 E1              10      POP HL
001131 DE95 20DD            12      JR  NZ,SOPEN1
001133 DE97 1807            12      JR  SOPEN6
       DE99                     SOPEN5:
001135 DE99 CDF6E6          17      CALL    GNCLX       ;END DIR
001138 DE9C D8              11      RET C
001139 DE9D CD12E0          17      CALL    ENDCL
       DEA0                     SOPEN6:
00113C DEA0 38D2            12      JR  C,SOPEN1
       DEA2                     SCF_FF_RET:
00113E DEA2 37               4      SCF         ;CF=1
00113F DEA3 9F               4      SBC A,A     ;A=0FFH
001140 DEA4 C9              10      RET
                                
       DEA5                     RDDERR:
001141 DEA5 BF               4      CP  A       ;READ ERR CF=1 ZF=1
001142 DEA6 37               4      SCF
001143 DEA7 C9              10      RET
                                
       DEA8                     NOPEN:
001144 DEA8 215ADF          10      LD  HL,FILESE
001147 DEAB 2280DE          16      LD  (OPENPAT+1),HL
00114A DEAE FD2A98EF        20      LD  IY,(_FCB)
00114E DEB2 CD45E1          17      CALL    CHKWILDX
001151 DEB5 30EB            12      JR  NC,SCF_FF_RET
001153 DEB7 FD7E00          19      LD  A,(IY+0)    ;(FCB)ドライブ番号
001156 DEBA 3D               4      DEC A
001157 DEBB 3288EF          13      LD  (_DRV),A
00115A DEBE CDD9EF          17      CALL    _CHGDRV
00115D DEC1 D8              11      RET C
00115E DEC2 2AF8F0          16      LD  HL,(SFNDF)  ;Direcroty location and Flags
001161 DEC5 229FEF          16      LD  (_FILEN),HL
                                
001164 DEC8 CD5AE0          17      CALL    LDDIRX
001167 DECB ED5B9AEF        20      LD  DE,(_FBPS)
00116B DECF CD4BDF          17      CALL    READ_DIR
00116E DED2 38D1            12      JR  C,RDDERR
001170 DED4 3A9EEF          13      LD  A,(_FBCNT)
001173 DED7 3D               4      DEC A
001174 DED8 28AD            12      JR  Z,SOPEN3
       DEDA                     NOPEN2:
001176 DEDA 2A9CEF          16      LD  HL,(_FBAD)
001179 DEDD 012000          10      LD  BC,020H
00117C DEE0 09              11      ADD HL,BC
00117D DEE1 4F               4      LD  C,A
00117E DEE2 189A            12      JR  SOPEN2
                                
       DEE4                     SOPENE2:
001180 DEE4 229CEF          16      LD  (_FBAD),HL
001183 DEE7 79               4      LD  A,C
001184 DEE8 329EEF          13      LD  (_FBCNT),A
001187 DEEB ED539AEF        20      LD  (_FBPS),DE
00118B DEEF FD2298EF        20      LD  (_FCB),IY
       DEF3                     SOPENE:
00118F DEF3 AF               4      XOR A
001190 DEF4 C9              10      RET
                                
       DEF5                     COPEN:
001191 DEF5 FD360D20        19      LD  (IY+13),020H    ;(FCB)属性(アトリビュート)
                                
001195 DEF9 2177DF          10      LD  HL,NEXTSE
001198 DEFC CD47DE          17      CALL    SOPENC
00119B DEFF D0              11      RET NC
00119C DF00 C8              11      RET Z
00119D DF01 3AA0EF          13      LD  A,(_DIRF)   ;ディレクトリか判別
0011A0 DF04 B7               4      OR  A
0011A1 DF05 37               4      SCF
0011A2 DF06 C8              11      RET Z       ;ルートディレクトリ
0011A3 DF07 0601             7      LD  B,1
0011A5 DF09 CDA3E1          17      CALL    WRDF
0011A8 DF0C D8              11      RET C
0011A9 DF0D ED5BFEF0        20      LD  DE,(_CLPS)
0011AD DF11 D5              11      PUSH    DE
0011AE DF12 CDDBDF          17      CALL    DCPAT
0011B1 DF15 CD81E5          17      CALL    DRDNX
0011B4 DF18 2A7EF0          16      LD  HL,(_DTBUF) ;ディレクトリエントリを0クリア
0011B7 DF1B 3AECE4          13      LD  A,(SECSZ+2) ;1024=4 / 512=2 / 256=1
0011BA DF1E 47               4      LD  B,A
0011BB DF1F AF               4      XOR A
0011BC DF20 4F               4      LD  C,A
       DF21                     COPENCL:
0011BD DF21 77               7      LD  (HL),A
0011BE DF22 EDA1            16      CPI         ;HL=HL+1 BC=BC-1 BCが0の場合にP/V=0
0011C0 DF24 EA21DF          10      JP  PE,COPENCL
                                
0011C3 DF27 3AF9DF          13      LD  A,(SPCPAT+1)    ;1クラスタの論理セクタ数
0011C6 DF2A 3D               4      DEC A
0011C7 DF2B 2819            12      JR  Z,COPENE
0011C9 DF2D 3E01             7      LD  A,1     ;1セクタ辺りのセクタ数が2以上の場合
0011CB DF2F 32EEE6          13      LD  (_SECPS+1),A
0011CE DF32 D1              10      POP DE      ;DE=(_CLPS)
0011CF DF33 D5              11      PUSH    DE
       DF34                     COPEN1:
0011D0 DF34 D5              11      PUSH    DE      ;データバッファに入らないセクタもゼロクリア
0011D1 DF35 C5              11      PUSH    BC
0011D2 DF36 2A7EF0          16      LD  HL,(_DTBUF)
0011D5 DF39 CDF5DF          17      CALL    CLUSTX
0011D8 DF3C CD5AE8          17      CALL    DWT24
0011DB DF3F C1              10      POP BC
0011DC DF40 D1              10      POP DE
0011DD DF41 CDEDE6          17      CALL    NEXTX
0011E0 DF44 20EE            12      JR  NZ,COPEN1
       DF46                     COPENE:
0011E2 DF46 2A7EF0          16      LD  HL,(_DTBUF)
0011E5 DF49 D1              10      POP DE
0011E6 DF4A C9              10      RET
                                
       DF4B                     READ_DIR:
0011E7 DF4B ED53FEF0        20      LD  (_CLPS),DE
0011EB DF4F C5              11      PUSH    BC
0011EC DF50 D5              11      PUSH    DE
0011ED DF51 CDDBDF          17      CALL    DCPAT
0011F0 DF54 CD61E5          17      CALL    DRDX
0011F3 DF57 D1              10      POP DE
0011F4 DF58 C1              10      POP BC
0011F5 DF59 C9              10      RET
                                
       DF5A                     FILESE:
0011F6 DF5A 7E               7      LD  A,(HL)
0011F7 DF5B B7               4      OR  A
0011F8 DF5C C8              11      RET Z       ;END:ZF=1 CF=0
0011F9 DF5D FEE5             7      CP  0E5H
0011FB DF5F 280E            12      JR  Z,FILESE1
0011FD DF61 FDE5            15      PUSH    IY
0011FF DF63 D1              10      POP DE
001200 DF64 13               6      INC DE
001201 DF65 E5              11      PUSH    HL
001202 DF66 CDB2DF          17      CALL    CPFILE
001205 DF69 CCD3DF          17      CALL    Z,CPFILE2
001208 DF6C E1              10      POP HL
001209 DF6D 37               4      SCF
00120A DF6E C8              11      RET Z       ;!!!:(ZF=1) CF=1
       DF6F                     FILESE1:
00120B DF6F CD86DF          17      CALL    FNEXT
00120E DF72 20E6            12      JR  NZ,FILESE
       DF74                     ZF0_CF0_AFF_RET:
001210 DF74 F6FF             7      OR  0FFH        ;ZF=0 CF=0
001212 DF76 C9              10      RET
                                
       DF77                     NEXTSE:
001213 DF77 7E               7      LD  A,(HL)
001214 DF78 B7               4      OR  A
001215 DF79 37               4      SCF
001216 DF7A C8              11      RET Z       ;!!!:ZF=1 CF=1
001217 DF7B FEE5             7      CP  0E5H
001219 DF7D 37               4      SCF
00121A DF7E C8              11      RET Z       ;!!!:(ZF=1) CF=1
00121B DF7F CD86DF          17      CALL    FNEXT
00121E DF82 20F3            12      JR  NZ,NEXTSE
001220 DF84 18EE            12      JR  ZF0_CF0_AFF_RET
                                
       DF86                     FNEXT:
001222 DF86 E5              11      PUSH    HL
001223 DF87 219FEF          10      LD  HL,_FILEN
001226 DF8A 34              11      INC (HL)
001227 DF8B E1              10      POP HL
001228 DF8C 112000          10      LD  DE,020H
00122B DF8F 19              11      ADD HL,DE
00122C DF90 0D               4      DEC C
00122D DF91 C9              10      RET
                                
       DF92                     CPNAME:
00122E DF92 C5              11      PUSH    BC
00122F DF93 D5              11      PUSH    DE
001230 DF94 E5              11      PUSH    HL
001231 DF95 CDACDF          17      CALL    CPFILE4
001234 DF98 E1              10      POP HL
001235 DF99 23               6      INC HL
001236 DF9A 23               6      INC HL
001237 DF9B 23               6      INC HL
001238 DF9C 23               6      INC HL
001239 DF9D D1              10      POP DE
00123A DF9E C1              10      POP BC
00123B DF9F 2005            12      JR  NZ,CPNAME1
00123D DFA1 7E               7      LD  A,(HL)
00123E DFA2 23               6      INC HL
00123F DFA3 66               7      LD  H,(HL)
001240 DFA4 6F               4      LD  L,A
001241 DFA5 C9              10      RET
       DFA6                     CPNAME1:
001242 DFA6 23               6      INC HL
001243 DFA7 23               6      INC HL
001244 DFA8 10E8            13      DJNZ    CPNAME
001246 DFAA 37               4      SCF
001247 DFAB C9              10      RET
                                
       DFAC                     CPFILE4:
001248 DFAC C5              11      PUSH    BC
001249 DFAD 010004          10      LD  BC,00400H
00124C DFB0 1804            12      JR  CPSTR1
       DFB2                     CPFILE:
00124E DFB2 C5              11      PUSH    BC
00124F DFB3 01000B          10      LD  BC,00B00H
       DFB6                     CPSTR1:
001252 DFB6 1A               7      LD  A,(DE)
001253 DFB7 FE3F             7      CP  '?'     ;Wild card
001255 DFB9 2812            12      JR  Z,CPSTR2
001257 DFBB 7E               7      LD  A,(HL)
001258 DFBC CD2BE1          17      CALL    FKANC
00125B DFBF E5              11      PUSH    HL
00125C DFC0 67               4      LD  H,A
00125D DFC1 1A               7      LD  A,(DE)
00125E DFC2 CB01             4      RLC C
001260 DFC4 CD2BE1          17      CALL    FKANC
001263 DFC7 CB09             4      RRC C
001265 DFC9 BC               4      CP  H       ;CP (HL),(DE)
001266 DFCA E1              10      POP HL
001267 DFCB 2004            12      JR  NZ,CPSTR3
       DFCD                     CPSTR2:
001269 DFCD 13               6      INC DE
00126A DFCE 23               6      INC HL
00126B DFCF 10E5            13      DJNZ    CPSTR1
       DFD1                     CPSTR3:
00126D DFD1 C1              10      POP BC
00126E DFD2 C9              10      RET
                                
       DFD3                     CPFILE2:
00126F DFD3 FD7E0D          19      LD  A,(IY+13)   ;(FCB)属性(アトリビュート)
001272 DFD6 F6E1             7      OR  0E1H
001274 DFD8 2F               4      CPL
001275 DFD9 A6               7      AND (HL)
001276 DFDA C9              10      RET
                                
       DFDB                     DCPAT:
001277 DFDB 0E00             7      LD  C,0
001279 DFDD 2A7EF0          16      LD  HL,(_DTBUF)
00127C DFE0 3AA0EF          13      LD  A,(_DIRF)   ;ディレクトリか判別
00127F DFE3 B7               4      OR  A
001280 DFE4 C8              11      RET Z       ;ルートディレクトリの場合はCレジスタを0にしておく(CDEがセクタ番号)
001281 DFE5 3AF9DF          13      LD  A,(SPCPAT+1)
001284 DFE8 4F               4      LD  C,A
001285 DFE9 3AEEE6          13      LD  A,(_SECPS+1)
001288 DFEC B9               4      CP  C
001289 DFED 3801            12      JR  C,DC1
00128B DFEF AF               4      XOR A
       DFF0                     DC1:
00128C DFF0 F680             7      OR  080H
00128E DFF2 32A0EF          13      LD  (_DIRF),A   ;bit0-6:セクタインデックス
       DFF5                     CLUSTX:
001291 DFF5 E5              11      PUSH    HL
001292 DFF6 EB               4      EX  DE,HL
001293 DFF7 AF               4      XOR A
001294 DFF8 0E01             7  SPCPAT: LD  C,1     ;自己書き換え（1クラスタの論理セクタ数）
       DFFA                     L_CLDBL:
001296 DFFA CB19             8      RR  C       ;->CF
001298 DFFC 3804            12      JR  C,E_CLDBL
00129A DFFE 29              11      ADD HL,HL       ;*2
00129B DFFF 8F               4      ADC A,A
00129C E000 18F8            12      JR  L_CLDBL
       E002                     E_CLDBL:
00129E E002 4F               4      LD  C,A
00129F E003 3AEEE6          13      LD  A,(_SECPS+1)
0012A2 E006 B5               4      OR  L
0012A3 E007 6F               4      LD  L,A
0012A4 E008 110800          10  CLSPAT: LD  DE,8    ;+8 (2D)  !ADDCL (self-modifying code)
0012A7 E00B AF               4      XOR A
0012A8 E00C 19              11      ADD HL,DE   ;データ格納領域の先頭論理セクタ番号
0012A9 E00D 89               4      ADC A,C
0012AA E00E 4F               4      LD  C,A
0012AB E00F EB               4      EX  DE,HL
0012AC E010 E1              10      POP HL
0012AD E011 C9              10      RET
                                
       E012                     ENDCL:
0012AE E012 7A               4      LD  A,D ;END CLUSTER
0012AF E013 FE01             7  CLPAT1: CP  1   ;164=356    (self-modifying code)
0012B1 E015 C0              11      RET NZ
0012B2 E016 7B               4      LD  A,E
0012B3 E017 FE64             7  CLPAT2: CP  064H    ;       (self-modifying code)
0012B5 E019 C9              10      RET
                                
       E01A                     CAP:
0012B6 E01A FE61             7      CP  'a'
0012B8 E01C D8              11      RET C
0012B9 E01D FE7B             7      CP  'z'+1
0012BB E01F D0              11      RET NC
0012BC E020 D620             7      SUB 020H
0012BE E022 C9              10      RET
       E023                     CAP2:
0012BF E023 CD1AE0          17      CALL    CAP
       E026                     CAP3:
0012C2 E026 CD2FE0          17      CALL    CAP4
0012C5 E029 FE21             7      CP  021H
0012C7 E02B D0              11      RET NC
0012C8 E02C 3EA0             7      LD  A,0A0H
0012CA E02E C9              10      RET
       E02F                     CAP4:
0012CB E02F FE05             7      CP  5
0012CD E031 C0              11      RET NZ
0012CE E032 3EE5             7      LD  A,0E5H
0012D0 E034 C9              10      RET
                                
       E035                     CHDIR:
0012D1 E035 CD91E9          17      CALL    GETDPBD
0012D4 E038 381D            12      JR  C,CHDIR2
0012D6 E03A DD751A          19      LD  (IX+01AH),L     ;_SDIR_
0012D9 E03D DD741B          19      LD  (IX+01BH),H     ;_SDIR_+1
0012DC E040 1815            12      JR  CHDIR2      ;POP_IX_RET
                                
       E042                     LDDIR:
0012DE E042 CD91E9          17      CALL    GETDPBD
0012E1 E045 DD5E1A          19      LD  E,(IX+01AH)     ;_SDIR_
0012E4 E048 DD561B          19      LD  D,(IX+01BH)     ;_SDIR_+1
0012E7 E04B 13               6      INC DE
0012E8 E04C FD730E          19      LD  (IY+14),E   ;(FCB)アクセスするディレクトリのクラスタ番号+1
0012EB E04F FD720F          19      LD  (IY+15),D
0012EE E052 1B               6      DEC DE
0012EF E053 AF               4      XOR A
0012F0 E054 32A0EF          13      LD  (_DIRF),A
       E057                     CHDIR2:
0012F3 E057 DDE1            14      POP IX
0012F5 E059 C9              10      RET
                                
       E05A                     LDDIRX:
0012F6 E05A 3AA0EF          13      LD  A,(_DIRF)   ;(FCB)アクセスするディレクトリのセクタインデックス
0012F9 E05D E67F             7      AND 07FH
       E05F                     LDDIRX1:
0012FB E05F 32EEE6          13      LD  (_SECPS+1),A
0012FE E062 FD5E0E          19      LD  E,(IY+14)   ;(FCB)アクセスするディレクトリのクラスタ番号+1
001301 E065 FD560F          19      LD  D,(IY+15)
001304 E068 1B               6      DEC DE
001305 E069 CD12E0          17      CALL    ENDCL
001308 E06C D442E0          17      CALL    NC,LDDIR
       E06F                     LDDIRS:
00130B E06F 7A               4      LD  A,D
00130C E070 B3               4      OR  E
00130D E071 32A0EF          13      LD  (_DIRF),A   ;ディレクトリか判別
001310 E074 C9              10      RET
                                
       E075                     KILL:
001311 E075 CD45E1          17      CALL    CHKWILDX
001314 E078 3834            12      JR  C,KILLW
001316 E07A CD17DE          17      CALL    SOPENX
       E07D                     KILLS:
001319 E07D 3E1F             7      LD  A,01FH
00131B E07F D4C1E0          17      CALL    NC,CHKATT
00131E E082 D8              11      RET C
       E083                     KILLSX:
00131F E083 36E5            10      LD  (HL),0E5H   ;DIR
001321 E085 CD1FE1          17      CALL    WTDB
001324 E088 111A00          10      LD  DE,01AH
001327 E08B 19              11      ADD HL,DE
001328 E08C 5E               7      LD  E,(HL)
001329 E08D 23               6      INC HL
00132A E08E 56               7      LD  D,(HL)
       E08F                     KILLS1:
00132B E08F CD12E0          17      CALL    ENDCL
00132E E092 D0              11      RET NC      ;CF=0
00132F E093 21FEFF          10      LD  HL,0-2
001332 E096 19              11      ADD HL,DE
001333 E097 D0              11      RET NC      ;DE= 0 or 1
001334 E098 D5              11      PUSH    DE
001335 E099 CDF7EF          17      CALL    _GNCL
001338 E09C ED53FEF0        20      LD  (_CLPS),DE
00133C E0A0 D1              10      POP DE
00133D E0A1 210000          10      LD  HL,0
001340 E0A4 D4FAEF          17      CALL    NC,_SNCL
001343 E0A7 D8              11      RET C
001344 E0A8 ED5BFEF0        20      LD  DE,(_CLPS)  ;FAT
001348 E0AC 18E1            12      JR  KILLS1
                                
       E0AE                     KILLW:
00134A E0AE CD44DE          17      CALL    SOPEN
       E0B1                     KILLW1:
00134D E0B1 380B            12      JR  C,KILLW2
00134F E0B3 CDE4DE          17      CALL    SOPENE2
001352 E0B6 CD7DE0          17      CALL    KILLS
001355 E0B9 CDA8DE          17      CALL    NOPEN
001358 E0BC 18F3            12      JR  KILLW1
       E0BE                     KILLW2:
00135A E0BE C8              11      RET Z
00135B E0BF 3F               4      CCF
00135C E0C0 C9              10      RET
                                
       E0C1                     CHKATT:
00135D E0C1 E5              11      PUSH    HL
00135E E0C2 110B00          10      LD  DE,00BH
001361 E0C5 19              11      ADD HL,DE
001362 E0C6 A6               7      AND (HL)
001363 E0C7 E1              10      POP HL
001364 E0C8 C8              11      RET Z
001365 E0C9 37               4      SCF
001366 E0CA C9              10      RET
                                
       E0CB                     NAME:
001367 E0CB CD45E1          17      CALL    CHKWILDX
00136A E0CE D8              11      RET C
00136B E0CF 110400          10      LD  DE,4
00136E E0D2 19              11      ADD HL,DE
00136F E0D3 22EBE0          16      LD  (NAMEP+2),HL
001372 E0D6 23               6      INC HL
001373 E0D7 CD49E1          17      CALL    CHKWILD
001376 E0DA D8              11      RET C
                                
001377 E0DB CD17DE          17      CALL    SOPENX
00137A E0DE 3E0F             7      LD  A,00FH
00137C E0E0 D4C1E0          17      CALL    NC,CHKATT
00137F E0E3 D8              11      RET C
                                
001380 E0E4 FD7E00          19      LD  A,(IY+0)
001383 E0E7 FDE5            15      PUSH    IY
001385 E0E9 FD210000        14  NAMEP:  LD  IY,0        ;自己書き換え
001389 E0ED FD7700          19      LD  (IY+0),A
00138C E0F0 CD17DE          17      CALL    SOPENX
00138F E0F3 FDE3            23      EX  (SP),IY
001391 E0F5 3F               4      CCF
001392 E0F6 D444DE          17      CALL    NC,SOPEN
001395 E0F9 EB               4      EX  DE,HL
001396 E0FA E1              10      POP HL
001397 E0FB D8              11      RET C
                                
       E0FC                     SETNAME:
001398 E0FC 01000B          10      LD  BC,11*256
00139B E0FF 23               6      INC HL
00139C E100 7E               7      LD  A,(HL)
00139D E101 FEE5             7      CP  0E5H
00139F E103 2004            12      JR  NZ,SNAME1
0013A1 E105 3E05             7      LD  A,5
0013A3 E107 180E            12      JR  SNAME3
       E109                     SNAME1:
0013A5 E109 7E               7      LD  A,(HL)
0013A6 E10A 0C               4      INC C
0013A7 E10B 0D               4      DEC C
0013A8 E10C 2009            12      JR  NZ,SNAME3
0013AA E10E CD1AE0          17      CALL    CAP
0013AD E111 FEA0             7      CP  0A0H
0013AF E113 2002            12      JR  NZ,SNAME3
0013B1 E115 3E20             7      LD  A,020H
       E117                     SNAME3:
0013B3 E117 12               7      LD  (DE),A
0013B4 E118 7E               7      LD  A,(HL)
0013B5 E119 23               6      INC HL
0013B6 E11A CD32E1          17      CALL    FKAN
0013B9 E11D 10EA            13      DJNZ    SNAME1
       E11F                     WTDB:
0013BB E11F 3EFF             7      LD  A,0FFH
0013BD E121 3239EF          13      LD  (SFILE),A
       E124                     SWTDBF:
0013C0 E124 3E01             7      LD  A,1
0013C2 E126 32A4EF          13      LD  (_WTDBF),A
0013C5 E129 AF               4      XOR A
0013C6 E12A C9              10      RET
                                
       E12B                     FKANC:
0013C7 E12B CB41             8      BIT 0,C
0013C9 E12D CC23E0          17      CALL    Z,CAP2
0013CC E130 1801            12      JR  FKANX
       E132                     FKAN:           ;漢字チェック
0013CE E132 13               6      INC DE
       E133                     FKANX:
0013CF E133 CB41             8      BIT 0,C
0013D1 E135 CB81             8      RES 0,C
0013D3 E137 C0              11      RET NZ
0013D4 E138 FE80             7      CP  080H
0013D6 E13A D8              11      RET C
0013D7 E13B FEA0             7      CP  0A0H
0013D9 E13D 3803            12      JR  C,FKAN1
0013DB E13F FEE0             7      CP  0E0H
0013DD E141 D8              11      RET C
       E142                     FKAN1:
0013DE E142 0C               4      INC C
0013DF E143 A7               4      AND A
0013E0 E144 C9              10      RET
                                
       E145                     CHKWILDX:
0013E1 E145 FDE5            15      PUSH    IY
0013E3 E147 E1              10      POP HL
0013E4 E148 23               6      INC HL
       E149                     CHKWILD:
0013E5 E149 060B             7      LD  B,11
0013E7 E14B 3E3F             7      LD  A,'?'
       E14D                     CHKWIL1:
0013E9 E14D BE               7      CP  (HL)
0013EA E14E 23               6      INC HL
0013EB E14F 37               4      SCF
0013EC E150 C8              11      RET Z
0013ED E151 10FA            13      DJNZ    CHKWIL1
0013EF E153 AF               4      XOR A
0013F0 E154 C9              10      RET
                                
       E155                     SDIRENT:        ;IY=FCB HL=DIR
0013F1 E155 D5              11      PUSH    DE
0013F2 E156 E5              11      PUSH    HL
0013F3 E157 FDE5            15      PUSH    IY
0013F5 E159 D1              10      POP DE
0013F6 E15A EB               4      EX  DE,HL
0013F7 E15B CDFCE0          17      CALL    SETNAME
                                ;               Attribute
0013FA E15E FD7E0D          19      LD  A,(IY+13)   ;(FCB)属性(アトリビュート)
0013FD E161 12               7      LD  (DE),A
0013FE E162 13               6      INC DE
                                ;               Reserved
0013FF E163 AF               4      XOR A
001400 E164 060A             7      LD  B,10
       E166                     SDE1:
001402 E166 12               7      LD  (DE),A
001403 E167 13               6      INC DE
001404 E168 10FC            13      DJNZ    SDE1
                                                    ;(FCB)更新時刻
001406 E16A 21EAF0          10      LD  HL,SDDATA       ;(FCB)更新年月日
001409 E16D 060A             7      LD  B,SDDATAE-SDDATA    ;(FCB)ファイルの先頭クラスタ
       E16F                     SDLOOP:                 ;(FCB)ファイルのサイズ(バイト単位)
00140B E16F 7E               7      LD  A,(HL)
00140C E170 23               6      INC HL
00140D E171 3276E1          13      LD  (SDPAT+2),A
001410 E174 FD7E00          19  SDPAT:  LD  A,(IY+0)    ;LD A,(IY+A)
001413 E177 12               7      LD  (DE),A
001414 E178 13               6      INC DE
001415 E179 10F4            13      DJNZ    SDLOOP
                                
001417 E17B AF               4      XOR A
001418 E17C E1              10      POP HL
001419 E17D D1              10      POP DE
00141A E17E C9              10      RET
                                
       E17F                     WOPEN:
00141B E17F FD7E0D          19      LD  A,(IY+13)   ;(FCB)属性(アトリビュート)
00141E E182 E61F             7      AND 01FH
001420 E184 37               4      SCF
001421 E185 C0              11      RET NZ
001422 E186 FD361CFE        19      LD  (IY+28),0FEH    ;(FCB)オープンモード
       E18A                     TOPEN2:
001426 E18A AF               4      XOR A
       E18B                     TOPEN:              ;Initializes the time stamp
001427 E18B FD3617FF        19      LD  (IY+23),0FFH    ;(FCB)更新時刻
00142B E18F C9              10      RET
                                
       E190                     WRDFX:
00142C E190 3AF9DF          13      LD  A,(SPCPAT+1)    ;1クラスタの論理セクタ
       E193                     L_WRFX:
00142F E193 1F               4      RRA         ;->CF
001430 E194 3806            12      JR  C,E_WRFX
001432 E196 CB39             8      SRL C
001434 E198 CB1C             8      RR  H       ;CH=CH/2
001436 E19A 18F7            12      JR  L_WRFX
       E19C                     E_WRFX:
001438 E19C 44               4      LD  B,H
001439 E19D 04               4      INC B
00143A E19E 3E37             7      LD  A,037H      ;SCF
00143C E1A0 327EE5          13      LD  (DRDN1),A
                                
       E1A3                     WRDF:               ;Bクラスタ分FATを確保する
00143F E1A3 110200          10      LD  DE,2
001442 E1A6 AF               4      XOR A
001443 E1A7 32EEE6          13      LD  (_SECPS+1),A
       E1AA                     WRDF1:
001446 E1AA C5              11      PUSH    BC
001447 E1AB D5              11      PUSH    DE
001448 E1AC CDF7EF          17      CALL    _GNCL
00144B E1AF 381C            12      JR  C,WRDF3
00144D E1B1 7A               4      LD  A,D     ;空いているかチェック
00144E E1B2 B3               4      OR  E
00144F E1B3 2027            12      JR  NZ,WRDF4
001451 E1B5 E1              10      POP HL      ;HL=空いているクラスタ
001452 E1B6 E5              11      PUSH    HL
001453 E1B7 ED5BFEF0        20      LD  DE,(_CLPS)  ;DE=元の(_CLPS)
001457 E1BB 22FEF0          16      LD  (_CLPS),HL
00145A E1BE 7A               4      LD  A,D     ;元の(_CLPS)が 0 か?
00145B E1BF B3               4      OR  E
00145C E1C0 2008            12      JR  NZ,WRDF2
00145E E1C2 FD751A          19      LD  (IY+26),L   ;(FCB)ファイルの先頭クラスタ
001461 E1C5 FD741B          19      LD  (IY+27),H   ;元が空の場合はFCBにクラスタをセットする
001464 E1C8 1803            12      JR  WRDF3
       E1CA                     WRDF2:
001466 E1CA CDFAEF          17      CALL    _SNCL
       E1CD                     WRDF3:
001469 E1CD D1              10      POP DE
00146A E1CE C1              10      POP BC
00146B E1CF D8              11      RET C
00146C E1D0 100C            13      DJNZ    WRDF5       ;ここでループカウンタチェック
00146E E1D2 ED5BFEF0        20      LD  DE,(_CLPS)
001472 E1D6 21FFFF          10      LD  HL,0FFFFH   ;FATエントリ終了(EOCマーク)
001475 E1D9 C3FAEF          10      JP  _SNCL
                                
       E1DC                     WRDF4:              ;DEクラスタが空じゃないので次に移動する
001478 E1DC D1              10      POP DE
001479 E1DD C1              10      POP BC
       E1DE                     WRDF5:
00147A E1DE 13               6      INC DE
00147B E1DF CD12E0          17      CALL    ENDCL
00147E E1E2 38C6            12      JR  C,WRDF1
001480 E1E4 37               4      SCF
001481 E1E5 C9              10      RET
                                
       E1E6                     RWXR:
001482 E1E6 3AECE4          13      LD  A,(SECSZ+2) ;1024=4 / 512=2 / 256=1
       E1E9                     L_RWX:
001485 E1E9 1F               4      RRA     ;->CF
001486 E1EA 3808            12      JR  C,E_RWX
001488 E1EC CB38             8      SRL B   ;BCH=BCH/2
00148A E1EE CB19             8      RR  C   ;
00148C E1F0 CB1C             8      RR  H   ;
00148E E1F2 18F5            12      JR  L_RWX
       E1F4                     E_RWX:
001490 E1F4 FD5E1A          19      LD  E,(IY+26)   ;(FCB)ファイルの先頭クラスタ
001493 E1F7 FD561B          19      LD  D,(IY+27)
001496 E1FA AF               4      XOR A
001497 E1FB 32EEE6          13      LD  (_SECPS+1),A
       E1FE                     RWX1:
00149A E1FE ED53FEF0        20      LD  (_CLPS),DE
00149E E202 7A               4      LD  A,D
00149F E203 B3               4      OR  E
0014A0 E204 2813            12      JR  Z,SCF_RET   ;RET DE==0 => CF=1
                                
0014A2 E206 78               4      LD  A,B
0014A3 E207 B1               4      OR  C
0014A4 E208 B4               4      OR  H
0014A5 E209 C8              11      RET Z       ;RET BCH==0 => CF=0
                                
0014A6 E20A CDF6E6          17      CALL    GNCLX
0014A9 E20D D8              11      RET C
0014AA E20E 7C               4      LD  A,H     ;
0014AB E20F 25               4      DEC H       ;
0014AC E210 B7               4      OR  A       ;DEC BCH
0014AD E211 2001            12      JR  NZ,RWX2     ;
0014AF E213 0B               6      DEC BC      ;
       E214                     RWX2:
0014B0 E214 CD12E0          17      CALL    ENDCL
0014B3 E217 38E5            12      JR  C,RWX1
       E219                     SCF_RET:
0014B5 E219 37               4      SCF
0014B6 E21A C9              10      RET
                                
       E21B                     DSKF:
0014B7 E21B 110000          10  MAXCLP: LD  DE,0
0014BA E21E 2AACEF          16      LD  HL,(_FAKEFREE)
0014BD E221 7C               4      LD  A,H
0014BE E222 B5               4      OR  L
0014BF E223 2803            12      JR  Z,DSKF1
0014C1 E225 110100          10      LD  DE,1
       E228                     DSKF1:
0014C4 E228 D5              11      PUSH    DE
0014C5 E229 CDF7EF          17      CALL    _GNCL
0014C8 E22C 380C            12      JR  C,POPSCF
0014CA E22E 7A               4      LD  A,D
0014CB E22F B3               4      OR  E
0014CC E230 2001            12      JR  NZ,DSKF2
0014CE E232 23               6      INC HL
       E233                     DSKF2:
0014CF E233 D1              10      POP DE
0014D0 E234 1B               6      DEC DE
0014D1 E235 7A               4      LD  A,D
0014D2 E236 B3               4      OR  E
0014D3 E237 20EF            12      JR  NZ,DSKF1
0014D5 E239 C9              10      RET
                                
       E23A                     POPSCF:
0014D6 E23A F1              10      POP AF
0014D7 E23B 37               4      SCF
0014D8 E23C C9              10      RET
                                
       E23D                     SETTMS:
0014D9 E23D FD7E17          19      LD  A,(IY+23)   ;(FCB)ファイルを最後に変更した時刻
0014DC E240 3C               4      INC A
0014DD E241 C0              11      RET NZ      ;ファイルが更新されていない
       E242                     SETTMSX:            ;FCBに日付時刻をセットする
0014DE E242 CD72D9          17      CALL    _SYS2C      ;(BDOS)時刻の獲得
                                                ;H←時  L←分  D←秒
0014E1 E245 CB25             8      SLA L       ;   *2
0014E3 E247 CB25             8      SLA L       ;   *4
0014E5 E249 29              11      ADD HL,HL       ;*2 *8
0014E6 E24A 29              11      ADD HL,HL       ;*4 *16
0014E7 E24B 29              11      ADD HL,HL       ;*8 *32
0014E8 E24C 7A               4      LD  A,D
0014E9 E24D 0F               4      RRCA            ;bit.0->7->->->0->C
0014EA E24E E61F             7      AND 01FH
0014EC E250 B5               4      OR  L
0014ED E251 FD7716          19      LD  (IY+22),A   ;(FCB)ファイルを最後に変更した時刻
0014F0 E254 FD7417          19      LD  (IY+23),H
                                
0014F3 E257 CD6AD9          17      CALL    _SYS2A      ;(BDOS)日付の獲得
                                                ;HL←年  D←月  E←日
0014F6 E25A 0144F8          10      LD  BC,0-1980
0014F9 E25D 09              11      ADD HL,BC
0014FA E25E 65               4      LD  H,L
                                
0014FB E25F 7A               4      LD  A,D
0014FC E260 87               4      ADD A,A     ;*2
0014FD E261 87               4      ADD A,A     ;*4
0014FE E262 87               4      ADD A,A     ;*8
0014FF E263 87               4      ADD A,A     ;*16
001500 E264 6F               4      LD  L,A
001501 E265 29              11      ADD HL,HL       ;*32
001502 E266 7D               4      LD  A,L
001503 E267 B3               4      OR  E
001504 E268 FD7714          19      LD  (IY+20),A   ;(FCB)ファイルを最後に変更した日付
001507 E26B FD7415          19      LD  (IY+21),H
00150A E26E C9              10      RET
                                
       E26F                     PUSHRR:
00150B E26F CD75E2          17      CALL    SUBRR
       E272                     POPRR1:
00150E E272 EDB0                    LDIR
001510 E274 C9              10      RET
                                
       E275                     SUBRR:
001511 E275 FDE5            15      PUSH    IY
001513 E277 E1              10      POP HL
001514 E278 112100          10      LD  DE,33
001517 E27B 19              11      ADD HL,DE
001518 E27C 115AEF          10      LD  DE,HLBUF
00151B E27F 010300          10      LD  BC,3
00151E E282 C9              10      RET
                                
       E283                     SETSEQ:
00151F E283 F5              11      PUSH    AF      ;AHL=Random record
001520 E284 C5              11      PUSH    BC
001521 E285 FD7E21          19      LD  A,(IY+33)   ;(FCB)ランダムレコード
001524 E288 FD6E22          19      LD  L,(IY+34)
001527 E28B FD6623          19      LD  H,(IY+35)
00152A E28E 010000          10  RR36:   LD  BC,0        ;(IY+36)
                                
00152D E291 CDA9E2          17      CALL    GET_CPM_R_SIZE
                                
001530 E294 29              11      ADD HL,HL
001531 E295 8F               4      ADC A,A
001532 E296 CB3D             8      SRL L       ;L=L/2
001534 E298 FD7520          19      LD  (IY+32),L   ;(FCB)カレントレコード
001537 E29B FD740C          19      LD  (IY+12),H   ;(FCB)カレントブロック
00153A E29E FD7718          19      LD  (IY+24),A   ;(FCB)カレントブロック上位
00153D E2A1 C1              10      POP BC
00153E E2A2 F1              10      POP AF
                                
       E2A3                     POPRR:
00153F E2A3 CD75E2          17      CALL    SUBRR
001542 E2A6 EB               4      EX  DE,HL
001543 E2A7 18C9            12      JR  POPRR1
                                
       E2A9                     GET_CPM_R_SIZE:     ;バイト単位からCP/Mのレコード単位を求める（1レコード=128バイト）
001545 E2A9 87               4      ADD A,A     ;in BHLA => out AHL
001546 E2AA ED6A            15      ADC HL,HL
001548 E2AC CB18             8      RR  B
00154A E2AE B7               4      OR  A
00154B E2AF 78               4      LD  A,B     ;ここでフラグは変化しない
00154C E2B0 C8              11      RET Z
00154D E2B1 2C               4      INC L       ;INC AHL
00154E E2B2 C0              11      RET NZ      ;
00154F E2B3 24               4      INC H       ;
001550 E2B4 C0              11      RET NZ      ;
001551 E2B5 3C               4      INC A       ;
001552 E2B6 C9              10      RET
                                
       E2B7                     GETSEQ:
001553 E2B7 FD6E20          19      LD  L,(IY+32)   ;(FCB)カレントレコード
001556 E2BA FD660C          19      LD  H,(IY+12)   ;(FCB)カレントブロック
001559 E2BD FD7E18          19      LD  A,(IY+24)   ;(FCB)カレントブロック上位
                                
00155C E2C0 CB25             8      SLA L   ;L=L*2
                                
00155E E2C2 CB3F             8      SRL A   ;
001560 E2C4 CB1C             8      RR  H   ;AHL=AHL/2
001562 E2C6 CB1D             8      RR  L   ;
001564 E2C8 C9              10      RET
                                
       E2C9                     RB_WRITE:
001565 E2C9 C5              11      PUSH    BC
001566 E2CA ED4B4CF0        20      LD  BC,(STABLE+2*026H)  ;(BDOS)ランダムブロック書き込み
00156A E2CE 1805            12      JR  RBRW
       E2D0                     RB_READ:
00156C E2D0 C5              11      PUSH    BC
00156D E2D1 ED4B4EF0        20      LD  BC,(STABLE+2*027H)  ;(BDOS)ランダムブロック読み込み
       E2D5                     RBRW:
001571 E2D5 CB3F             8      SRL A   ;AHLA' = HL*128
001573 E2D7 F5              11      PUSH    AF
001574 E2D8 CB1C             8      RR  H   ;AHL=AHL/2
001576 E2DA CB1D             8      RR  L   ;
001578 E2DC 3E00             7      LD  A,0
00157A E2DE 1F               4      RRA         ;A'HLA
00157B E2DF FD7721          19      LD  (IY+33),A   ;(FCB)ランダムレコード
00157E E2E2 FD7522          19      LD  (IY+34),L
001581 E2E5 FD7423          19      LD  (IY+35),H
001584 E2E8 FD7E24          19      LD  A,(IY+36)   ;ランダムレコードを4バイトで扱うとCP/M用のコマンドで
001587 E2EB 3209E3          13      LD  (PBRSWC+3),A    ;デフォルトのFCBとデフォルトのDTAを使用しているコマンドで
00158A E2EE F1              10      POP AF      ;ファイル読み込みの際に先頭の1バイトが化けるので保存
00158B E2EF FD7724          19      LD  (IY+36),A   ;
00158E E2F2 218000          10      LD  HL,128
                                
001591 E2F5 FDE5            15      PUSH    IY
001593 E2F7 D1              10      POP DE
001594 E2F8 D5              11      PUSH    DE
001595 E2F9 CD0BE3          17      CALL    JP_BC
001598 E2FC FDE1            14      POP IY
00159A E2FE FD4624          19      LD  B,(IY+36)
00159D E301 ED438FE2        20      LD  (RR36+1),BC
0015A1 E305 C1              10      POP BC
0015A2 E306 FD362400        19  PBRSWC: LD  (IY+36),0   ;自己書き換え   ここでランダムレコードを復元
0015A6 E30A C9              10      RET
       E30B                     JP_BC:
0015A7 E30B C5              11      PUSH    BC
0015A8 E30C C9              10      RET
                                
       DEA2                     _SYS03  EQU SCF_FF_RET  ;(BDOS)外部入力
       DEA2                     _SYS2B  EQU SCF_FF_RET  ;(BDOS)日付の設定
       DEA2                     _SYS2D  EQU SCF_FF_RET  ;(BDOS)時刻の設定
       DEA2                     _SYS39  EQU SCF_FF_RET  ;(BDOS)サブディレクトリの作成
       DEA2                     _SYS3A  EQU SCF_FF_RET  ;(BDOS)サブディレクトリの削除
                                
[EOF:LDFILE.ASM:SHIFT_JIS]
                                    INCLUDE "LDFILE2.ASM"
                                
                                ;   LSX-Dodgers FILE2
                                
                                                ;Write random block
       E30D                     _SYS26:     ;(BDOS)ランダムブロック書き込み
0015A9 E30D AF               4      XOR A
0015AA E30E 327EE5          13      LD  (DRDN1),A   ;NOP
0015AD E311 222FE5          16      LD  (LEFT+1),HL ;HL←書き込むレコード数
0015B0 E314 225DEF          16      LD  (LEFTX),HL
0015B3 E317 CDF7DD          17      CALL    SETDRV
                                
0015B6 E31A CD8EE4          17      CALL    RBX0
0015B9 E31D DAB4E3          10      JP  C,RBWERR
0015BC E320 CD7FE1          17      CALL    WOPEN
0015BF E323 DAB4E3          10      JP  C,RBWERR
0015C2 E326 7C               4      LD  A,H
0015C3 E327 B5               4      OR  L
0015C4 E328 CAADE3          10      JP  Z,RBW1
                                
0015C7 E32B 2B               6      DEC HL
                                
0015C8 E32C CD4BE5          17      CALL    GET_RR_BCDE ;BCDE=Random record
                                
0015CB E32F 19              11      ADD HL,DE       ;BCHL=HL+BCDE
0015CC E330 3001            12      JR  NC,S26X1    ;
0015CE E332 03               6      INC BC      ;
       E333                     S26X1:
0015CF E333 CDE6E1          17      CALL    RWXR
0015D2 E336 DC90E1          17      CALL    C,WRDFX
0015D5 E339 DAB4E3          10      JP  C,RBWERR
                                
0015D8 E33C CDBDE4          17      CALL    RBX2
0015DB E33F 281A            12      JR  Z,RBWB      ;NZ=セクタ以下の端数がある
0015DD E341 CDD4E4          17      CALL    RBXA
0015E0 E344 386E            12      JR  C,RBWERR
0015E2 E346 EB               4      EX  DE,HL
0015E3 E347 C5              11      PUSH    BC
0015E4 E348 EDB0                    LDIR
0015E6 E34A 225FEF          16      LD  (DTAX),HL
                                
0015E9 E34D CD24E1          17      CALL    SWTDBF      ;バッファデータは更新された
                                
0015EC E350 2A5DEF          16      LD  HL,(LEFTX)
0015EF E353 D1              10      POP DE
0015F0 E354 ED52            15      SBC HL,DE
0015F2 E356 225DEF          16      LD  (LEFTX),HL
0015F5 E359 2830            12      JR  Z,RBWEND
                                
       E35B                     RBWB:
0015F7 E35B CD0AE5          17      CALL    RBXB
0015FA E35E 2813            12      JR  Z,RBWC
       E360                     RBWB1:
0015FC E360 C5              11      PUSH    BC
0015FD E361 D5              11      PUSH    DE
0015FE E362 CDF5DF          17      CALL    CLUSTX
001601 E365 CD5AE8          17      CALL    DWT24
001604 E368 D1              10      POP DE
001605 E369 C1              10      POP BC
001606 E36A 3848            12      JR  C,RBWERR
001608 E36C CDF6E6          17      CALL    GNCLX
00160B E36F 3843            12      JR  C,RBWERR
00160D E371 10ED            13      DJNZ    RBWB1
       E373                     RBWC:
00160F E373 CD22E5          17      CALL    RBXC
001612 E376 2813            12      JR  Z,RBWEND
001614 E378 C5              11      PUSH    BC
001615 E379 CDF5DF          17      CALL    CLUSTX
001618 E37C CD7DE5          17      CALL    DRDN
00161B E37F C1              10      POP BC
00161C E380 3832            12      JR  C,RBWERR
00161E E382 ED5B7EF0        20      LD  DE,(_DTBUF)
001622 E386 EDB0                    LDIR
001624 E388 CD24E1          17      CALL    SWTDBF      ;バッファデータは更新された
       E38B                     RBWEND:
001627 E38B CD2EE5          17      CALL    RBXEND
                                
00162A E38E CD9DE4          17      CALL    RBX1
00162D E391 301A            12      JR  NC,RBW1
00162F E393 2A2FE5          16      LD  HL,(LEFT+1)
001632 E396 FD5E10          19      LD  E,(IY+16)   ;(FCB)ファイルのサイズ(バイト単位)
001635 E399 FD5611          19      LD  D,(IY+17)   ;DE=File size
001638 E39C 19              11      ADD HL,DE
001639 E39D FD7510          19      LD  (IY+16),L   ;(FCB)ファイルのサイズ(バイト単位)
00163C E3A0 FD7411          19      LD  (IY+17),H
00163F E3A3 3008            12      JR  NC,RBW1
001641 E3A5 FD3412          23      INC (IY+18)
001644 E3A8 2003            12      JR  NZ,RBW1
001646 E3AA FD3413          23      INC (IY+19)
       E3AD                     RBW1:
001649 E3AD FDE1            14      POP IY
00164B E3AF C1              10      POP BC
00164C E3B0 D1              10      POP DE
00164D E3B1 E1              10      POP HL
       E3B2                     DD_NUL:
00164E E3B2 AF               4      XOR A
00164F E3B3 C9              10      RET
                                
       E3B4                     RBWERR:
001650 E3B4 FDE5            15      PUSH    IY
001652 E3B6 D1              10      POP DE
001653 E3B7 2A20F0          16      LD  HL,(STABLE+2*010H)
001656 E3BA CD0F00          17      CALL    JP_HL
       E3BD                     RBRERR1:
001659 E3BD 3E01             7      LD  A,001H
       E3BF                     RBRERR2:
00165B E3BF FDE1            14      POP IY
00165D E3C1 C1              10      POP BC
00165E E3C2 D1              10      POP DE
00165F E3C3 E1              10      POP HL
001660 E3C4 37               4      SCF
001661 E3C5 210000          10      LD  HL,0
001664 E3C8 C9              10      RET
                                
       E3C9                     RBRERR:
001665 E3C9 3EFF             7      LD  A,0FFH
001667 E3CB 18F2            12      JR  RBRERR2
                                
       E3CD                     RBRFL:
001669 E3CD 3E00             7  RBRFLP: LD  A,000H
00166B E3CF FE0D             7      CP  00DH
00166D E3D1 2005            12      JR  NZ,RBRFL1
00166F E3D3 D5              11      PUSH    DE
001670 E3D4 1E0A             7      LD  E,00AH
001672 E3D6 1805            12      JR  RBRFL2
       E3D8                     RBRFL1:
001674 E3D8 D5              11      PUSH    DE
001675 E3D9 CD09EF          17      CALL    _SYS07
001678 E3DC 5F               4      LD  E,A
       E3DD                     RBRFL2:
001679 E3DD CDCDEF          17      CALL    _PRINT
00167C E3E0 7B               4      LD  A,E
00167D E3E1 D1              10      POP DE
00167E E3E2 32CEE3          13      LD  (RBRFLP+1),A
001681 E3E5 C9              10      RET
       E3E6                     DDX:
001682 E3E6 FD7E01          19      LD  A,(IY+1)    ;(FCB)主ファイル名
001685 E3E9 CD1AE0          17      CALL    CAP
001688 E3EC FE41             7      CP  'A'
00168A E3EE C9              10      RET
                                
                                                ;Read random block
       E3EF                     _SYS27:     ;(BDOS)ランダムブロック読み込み
00168B E3EF 225DEF          16      LD  (LEFTX),HL
00168E E3F2 CDF7DD          17      CALL    SETDRV
                                
001691 E3F5 FDCB0D66        20      BIT 4,(IY+13)   ;(FCB)属性(アトリビュート)
001695 E3F9 C27CE4          10      JP  NZ,RBRDIR   ;ディレクトリ
001698 E3FC CD8EE4          17      CALL    RBX0
00169B E3FF DAC9E3          10      JP  C,RBRERR
00169E E402 CD9DE4          17      CALL    RBX1
0016A1 E405 DABDE3          10      JP  C,RBRERR1
0016A4 E408 EB               4      EX  DE,HL
0016A5 E409 ED52            15      SBC HL,DE       ;CP 00HL,BCDE
0016A7 E40B 19              11      ADD HL,DE
0016A8 E40C 79               4      LD  A,C
0016A9 E40D DE00             7      SBC A,0
0016AB E40F 78               4      LD  A,B
0016AC E410 DE00             7      SBC A,0
0016AE E412 3801            12      JR  C,RBR1
0016B0 E414 EB               4      EX  DE,HL
       E415                     RBR1:
0016B1 E415 9F               4      SBC A,A
0016B2 E416 E601             7      AND 1
0016B4 E418 327AE4          13      LD  (RBRAP+1),A
                                
0016B7 E41B 7C               4      LD  A,H
0016B8 E41C B5               4      OR  L
0016B9 E41D 2854            12      JR  Z,RBREND0
                                
0016BB E41F 222FE5          16      LD  (LEFT+1),HL ;Read record byte
0016BE E422 225DEF          16      LD  (LEFTX),HL
                                
0016C1 E425 CDBDE4          17      CALL    RBX2
0016C4 E428 2819            12      JR  Z,RBRB
0016C6 E42A CDD4E4          17      CALL    RBXA
0016C9 E42D DAC9E3          10      JP  C,RBRERR
0016CC E430 C5              11      PUSH    BC
0016CD E431 EDB0                    LDIR
0016CF E433 ED535FEF        20      LD  (DTAX),DE
0016D3 E437 2A5DEF          16      LD  HL,(LEFTX)
0016D6 E43A D1              10      POP DE
0016D7 E43B A7               4      AND A
0016D8 E43C ED52            15      SBC HL,DE
0016DA E43E 225DEF          16      LD  (LEFTX),HL
0016DD E441 282D            12      JR  Z,RBREND
                                
       E443                     RBRB:
0016DF E443 CD0AE5          17      CALL    RBXB
0016E2 E446 2812            12      JR  Z,RBRC
       E448                     RBRB1:
0016E4 E448 C5              11      PUSH    BC
0016E5 E449 D5              11      PUSH    DE
0016E6 E44A CDF5DF          17      CALL    CLUSTX
0016E9 E44D CD4AE8          17      CALL    DRD24
0016EC E450 D1              10      POP DE
0016ED E451 C1              10      POP BC
0016EE E452 D4F6E6          17      CALL    NC,GNCLX
0016F1 E455 DAC9E3          10      JP  C,RBRERR
0016F4 E458 10EE            13      DJNZ    RBRB1
       E45A                     RBRC:
0016F6 E45A CD22E5          17      CALL    RBXC
0016F9 E45D 2811            12      JR  Z,RBREND
0016FB E45F C5              11      PUSH    BC
0016FC E460 CDF5DF          17      CALL    CLUSTX
0016FF E463 CD61E5          17      CALL    DRDX
001702 E466 C1              10      POP BC
001703 E467 DAC9E3          10      JP  C,RBRERR
001706 E46A EB               4      EX  DE,HL
001707 E46B 2A7EF0          16      LD  HL,(_DTBUF)
00170A E46E EDB0                    LDIR
       E470                     RBREND:
00170C E470 CD2EE5          17      CALL    RBXEND
       E473                     RBREND0:
00170F E473 FDE1            14      POP IY
001711 E475 C1              10      POP BC
001712 E476 D1              10      POP DE
001713 E477 F1              10      POP AF  ;(HL)
001714 E478 AF               4      XOR A
001715 E479 3E00             7  RBRAP:  LD  A,000H
001717 E47B C9              10      RET
                                
       E47C                     RBRDIR:
001718 E47C FD6E1A          19      LD  L,(IY+26)   ;(FCB)ファイルの先頭クラスタ
00171B E47F FD661B          19      LD  H,(IY+27)
00171E E482 CD35E0          17      CALL    CHDIR
001721 E485 AF               4      XOR A
001722 E486 67               4      LD  H,A
001723 E487 6F               4      LD  L,A
001724 E488 3C               4      INC A
001725 E489 327AE4          13      LD  (RBRAP+1),A
001728 E48C 18E5            12      JR  RBREND0
                                
       E48E                     RBX0:
00172A E48E 2A8AEF          16      LD  HL,(_DTA)
00172D E491 225FEF          16      LD  (DTAX),HL
001730 E494 2A5DEF          16      LD  HL,(LEFTX)
001733 E497 FD7E1C          19      LD  A,(IY+28)   ;(FCB)オープンモード
001736 E49A D6FD             7      SUB 0FDH
001738 E49C C9              10      RET
                                
       E49D                     RBX1:
001739 E49D E5              11      PUSH    HL      ;Record byte
                                                ;AHL=File size
00173A E49E FD6E10          19      LD  L,(IY+16)   ;ファイルのサイズ(バイト単位)
00173D E4A1 FD6611          19      LD  H,(IY+17)   ;
001740 E4A4 FD7E12          19      LD  A,(IY+18)   ;
                                
001743 E4A7 CD4BE5          17      CALL    GET_RR_BCDE ;BCDE=Random record
                                
001746 E4AA A7               4      AND A
001747 E4AB ED52            15      SBC HL,DE
001749 E4AD 99               4      SBC A,C
00174A E4AE 4F               4      LD  C,A
00174B E4AF FD7E13          19      LD  A,(IY+19)   ;ファイルのサイズ
00174E E4B2 98               4      SBC A,B
00174F E4B3 D1              10      POP DE
                                
001750 E4B4 D8              11      RET C
001751 E4B5 47               4      LD  B,A
001752 E4B6 B1               4      OR  C
001753 E4B7 EB               4      EX  DE,HL   ;BCDE=File byte HL=Record byte
001754 E4B8 B2               4      OR  D
001755 E4B9 B3               4      OR  E
001756 E4BA C0              11      RET NZ
001757 E4BB 37               4      SCF
001758 E4BC C9              10      RET
                                
       E4BD                     RBX2:               ;Cluster settings
001759 E4BD FD6622          19      LD  H,(IY+34)   ;(+33)(FCB)ランダムレコード
00175C E4C0 FD4E23          19      LD  C,(IY+35)
00175F E4C3 FD4624          19      LD  B,(IY+36)
001762 E4C6 CDE6E1          17      CALL    RWXR
001765 E4C9 3AECE4          13      LD  A,(SECSZ+2) ;1024=4 / 512=2 / 256=1
001768 E4CC 3D               4      DEC A
001769 E4CD FDA622          19      AND (IY+34)
00176C E4D0 FDB621          19      OR  (IY+33)
00176F E4D3 C9              10      RET
                                
       E4D4                     RBXA:
001770 E4D4 C5              11      PUSH    BC
001771 E4D5 D5              11      PUSH    DE
001772 E4D6 CDF5DF          17      CALL    CLUSTX
001775 E4D9 CD61E5          17      CALL    DRDX
001778 E4DC D1              10      POP DE
001779 E4DD C1              10      POP BC
00177A E4DE D8              11      RET C
00177B E4DF CDF6E6          17      CALL    GNCLX
00177E E4E2 D8              11      RET C
00177F E4E3 ED53FEF0        20      LD  (_CLPS),DE
                                
001783 E4E7 FD4E21          19      LD  C,(IY+33)   ;(FCB)ランダムレコード
001786 E4EA 210004          10  SECSZ:  LD  HL,0400H    ;自己書き換え 1024=0400H / 512=0200H ここに1セクタのサイズが格納される
001789 E4ED 7C               4      LD  A,H
00178A E4EE 3D               4      DEC A       ;1024=3 / 512=1
00178B E4EF FDA622          19      AND (IY+34)     ;(FCB)ランダムレコード
00178E E4F2 47               4      LD  B,A     ;BCに1セクタ以下の端数が入る
00178F E4F3 ED42            15      SBC HL,BC       ;残りを計算
                                
001791 E4F5 ED5B5DEF        20      LD  DE,(LEFTX)
001795 E4F9 ED52            15      SBC HL,DE       ;CP HL,DE
001797 E4FB 19              11      ADD HL,DE       ;
001798 E4FC 3801            12      JR  C,RBXA1     ;DEとHLを比較して大きい方をHLに
00179A E4FE EB               4      EX  DE,HL
       E4FF                     RBXA1:
00179B E4FF E5              11      PUSH    HL
00179C E500 2A7EF0          16      LD  HL,(_DTBUF)
00179F E503 09              11      ADD HL,BC
0017A0 E504 ED5B5FEF        20      LD  DE,(DTAX)
0017A4 E508 C1              10      POP BC
0017A5 E509 C9              10      RET
                                
       E50A                     RBXB:
0017A6 E50A 2A5FEF          16      LD  HL,(DTAX)
0017A9 E50D ED5BFEF0        20      LD  DE,(_CLPS)
0017AD E511 3A5EEF          13      LD  A,(LEFTX+1)
0017B0 E514 47               4      LD  B,A
0017B1 E515 3AECE4          13      LD  A,(SECSZ+2) ;1024=4 / 512=2 / 256=1
       E518                     RBXB1:
0017B4 E518 1F               4      RRA     ;->CF
0017B5 E519 3804            12      JR  C,RBXB2
0017B7 E51B CB38             8      SRL B   ;B=B/2
0017B9 E51D 18F9            12      JR  RBXB1
       E51F                     RBXB2:
0017BB E51F 78               4      LD  A,B
0017BC E520 B7               4      OR  A
0017BD E521 C9              10      RET
                                
       E522                     RBXC:
0017BE E522 ED4B5DEF        20      LD  BC,(LEFTX)
0017C2 E526 3AECE4          13      LD  A,(SECSZ+2) ;1024=4 / 512=2 / 256=1
0017C5 E529 3D               4      DEC A
0017C6 E52A A0               4      AND B
0017C7 E52B 47               4      LD  B,A     ;1セクタ以下の端数がない場合はZ
0017C8 E52C B1               4      OR  C
0017C9 E52D C9              10      RET
                                
       E52E                     RBXEND:
0017CA E52E 110000          10  LEFT:   LD  DE,0
0017CD E531 AF               4      XOR A
0017CE E532 FD6E21          19      LD  L,(IY+33)   ;(FCB)ランダムレコード
0017D1 E535 FD6622          19      LD  H,(IY+34)
0017D4 E538 19              11      ADD HL,DE
0017D5 E539 FD7521          19      LD  (IY+33),L   ;(FCB)ランダムレコード
0017D8 E53C FD7422          19      LD  (IY+34),H
0017DB E53F 3008            12      JR  NC,RBXEND1
0017DD E541 FD3423          23      INC (IY+35)
0017E0 E544 2003            12      JR  NZ,RBXEND1
0017E2 E546 FD3424          23      INC (IY+36)
       E549                     RBXEND1:
0017E5 E549 EB               4      EX  DE,HL       ;HL=Read byte
0017E6 E54A C9              10      RET
                                
       E54B                     GET_RR_BCDE:            ;BCDE=Random record
0017E7 E54B FD5E21          19      LD  E,(IY+33)   ;(FCB)ランダムレコード
0017EA E54E FD5622          19      LD  D,(IY+34)
0017ED E551 FD4E23          19      LD  C,(IY+35)
0017F0 E554 FD4624          19      LD  B,(IY+36)
0017F3 E557 C9              10      RET
                                
       E558                     GET_RR_AHL:
0017F4 E558 FD6E21          19      LD  L,(IY+33)   ;(FCB)Random record
0017F7 E55B FD6622          19      LD  H,(IY+34)   ;
0017FA E55E FD7E23          19      LD  A,(IY+35)   ;
                                
                                
[EOF:LDFILE2.ASM:SHIFT_JIS]
                                    INCLUDE "LDDIO.ASM"
                                
                                ;   LSX-Dodgers DIO
                                
       E561                     DRDX:
0017FD E561 CD9FE5          17      CALL    DRDY
001800 E564 C8              11      RET Z
001801 E565 CD85E5          17      CALL    DRDX1       ;データバッファの情報を保存
001804 E568 D8              11      RET C
001805 E569 E5              11      PUSH    HL
001806 E56A C5              11      PUSH    BC
001807 E56B D5              11      PUSH    DE
001808 E56C 2A7EF0          16      LD  HL,(_DTBUF)
00180B E56F 3AC8E5          13      LD  A,(_DBS24+1)
00180E E572 4F               4      LD  C,A
00180F E573 CD4AE8          17      CALL    DRD24
001812 E576 DC9AE5          17      CALL    C,DRDNE
       E579                     POP_DE_BC_HL_RET:
001815 E579 D1              10      POP DE
001816 E57A C1              10      POP BC
001817 E57B E1              10      POP HL
001818 E57C C9              10      RET
                                
                                ;   CDE:セクタ番号
       E57D                     DRDN:
001819 E57D AF               4      XOR A
00181A E57E 00               4  DRDN1:  NOP         ;自己書き換え NOP / SCF
00181B E57F 30E0            12      JR  NC,DRDX
       E581                     DRDNX:
00181D E581 CD9FE5          17      CALL    DRDY
001820 E584 C8              11      RET Z
       E585                     DRDX1:
001821 E585 CDB5E5          17      CALL    DWTX
                                                ;データバッファの読み込んだドライブ・セクタ情報を保存
001824 E588 ED53A6EF        20      LD  (_DBSEC),DE
001828 E58C 79               4      LD  A,C
001829 E58D 32C8E5          13      LD  (_DBS24+1),A
                                
00182C E590 3A88EF          13      LD  A,(_DRV)
00182F E593 32A5EF          13      LD  (_DBDRV),A
001832 E596 CDD9EF          17      CALL    _CHGDRV
001835 E599 D0              11      RET NC
       E59A                     DRDNE:
001836 E59A 9F               4      SBC A,A     ;CF=1ならばA=0FFH
001837 E59B 32A5EF          13      LD  (_DBDRV),A
00183A E59E C9              10      RET
                                
                                ;   CDE:セクタ番号
       E59F                     DRDY:
00183B E59F 3AC8E5          13      LD  A,(_DBS24+1)
00183E E5A2 B9               4      CP  C
00183F E5A3 C0              11      RET NZ
                                
001840 E5A4 E5              11      PUSH    HL
001841 E5A5 3A88EF          13      LD  A,(_DRV)
001844 E5A8 21A5EF          10      LD  HL,_DBDRV
001847 E5AB AE               7      XOR (HL)
001848 E5AC 2005            12      JR  NZ,POP_HL_RET
                                
00184A E5AE 2AA6EF          16      LD  HL,(_DBSEC)
00184D E5B1 ED52            15      SBC HL,DE       ;CF=0
       E5B3                     POP_HL_RET:
00184F E5B3 E1              10      POP HL
001850 E5B4 C9              10      RET
                                
       E5B5                     DWTX:
001851 E5B5 3AA4EF          13      LD  A,(_WTDBF)
001854 E5B8 B7               4      OR  A
001855 E5B9 C8              11      RET Z
001856 E5BA AF               4      XOR A
001857 E5BB 32A4EF          13      LD  (_WTDBF),A
                                
00185A E5BE E5              11      PUSH    HL
00185B E5BF C5              11      PUSH    BC
00185C E5C0 D5              11      PUSH    DE
00185D E5C1 3AA5EF          13      LD  A,(_DBDRV)
001860 E5C4 CDD9EF          17      CALL    _CHGDRV
001863 E5C7 0E00             7  _DBS24: LD  C,0
001865 E5C9 ED5BA6EF        20      LD  DE,(_DBSEC)
001869 E5CD 2A7EF0          16      LD  HL,(_DTBUF)
00186C E5D0 D45AE8          17      CALL    NC,DWT24
       E5D3                     POP_DE_BC_HL_RET2:
00186F E5D3 18A4            12      JR  POP_DE_BC_HL_RET
                                
       E5D5                     RDFATX:
001871 E5D5 E5              11      PUSH    HL
001872 E5D6 3A88EF          13      LD  A,(_DRV)
001875 E5D9 21AAEF          10      LD  HL,_FATDRV
001878 E5DC AE               7      XOR (HL)
001879 E5DD 28D4            12      JR  Z,POP_HL_RET
                                
00187B E5DF C5              11      PUSH    BC
00187C E5E0 D5              11      PUSH    DE
00187D E5E1 DDE5            15      PUSH    IX
00187F E5E3 CDFFE5          17      CALL    WTFATX
001882 E5E6 3813            12      JR  C,POP_IX_DE_BC_HL_RET
                                
001884 E5E8 AF               4      XOR A
001885 E5E9 32ABEF          13      LD  (_FATIX),A
001888 E5EC 3A88EF          13      LD  A,(_DRV)
00188B E5EF 32AAEF          13      LD  (_FATDRV),A
00188E E5F2 CDE5EF          17      CALL    _RDFAT
       E5F5                     RDFATE2:
001891 E5F5 3004            12      JR  NC,POP_IX_DE_BC_HL_RET
001893 E5F7 9F               4      SBC A,A     ;A=0xFF
001894 E5F8 32AAEF          13      LD  (_FATDRV),A
       E5FB                     POP_IX_DE_BC_HL_RET:
001897 E5FB DDE1            14      POP IX
001899 E5FD 18D4            12      JR  POP_DE_BC_HL_RET2
                                
       E5FF                     WTFATX:
00189B E5FF 3AA2EF          13      LD  A,(_WTFATF)
00189E E602 B7               4      OR  A
00189F E603 C8              11      RET Z
0018A0 E604 E5              11      PUSH    HL
0018A1 E605 3AAAEF          13      LD  A,(_FATDRV)
0018A4 E608 21A5EF          10      LD  HL,_DBDRV
0018A7 E60B AE               7      XOR (HL)
0018A8 E60C CCB5E5          17      CALL    Z,DWTX
0018AB E60F 38A2            12      JR  C,POP_HL_RET
0018AD E611 C5              11      PUSH    BC
0018AE E612 D5              11      PUSH    DE
0018AF E613 DDE5            15      PUSH    IX
0018B1 E615 CD67E8          17      CALL    WTFAT
0018B4 E618 AF               4      XOR A
0018B5 E619 32A2EF          13      LD  (_WTFATF),A
0018B8 E61C 18DD            12      JR  POP_IX_DE_BC_HL_RET
                                
       E61E                     NCL1:
0018BA E61E 7A               4      LD  A,D
0018BB E61F B3               4      OR  E
0018BC E620 37               4      SCF
0018BD E621 C8              11      RET Z
                                
0018BE E622 7A               4      LD  A,D
0018BF E623 CB3F             8      SRL A   ;/2
0018C1 E625 CB3F             8      SRL A   ;/2
                                
0018C3 E627 E5              11      PUSH    HL
0018C4 E628 3247E6          13      LD  (NCLPAT+2),A    ;_FATIX
0018C7 E62B 2AAAEF          16      LD  HL,(_FATDRV)    ;L=_FATDRV H=_FATIX
0018CA E62E BC               4      CP  H
0018CB E62F 3A88EF          13      LD  A,(_DRV)    ;この間でフラグは変化しない
0018CE E632 3246E6          13      LD  (NCLPAT+1),A    ;_FATDRV
0018D1 E635 2005            12      JR  NZ,NCL2     ;FATIXが違う
0018D3 E637 BD               4      CP  L
0018D4 E638 2002            12      JR  NZ,NCL2     ;ドライブが違う
0018D6 E63A E1              10      POP HL
0018D7 E63B C9              10      RET
       E63C                     NCL2:
0018D8 E63C C5              11      PUSH    BC
0018D9 E63D D5              11      PUSH    DE
0018DA E63E DDE5            15      PUSH    IX
0018DC E640 CDFFE5          17      CALL    WTFATX
0018DF E643 38B6            12      JR  C,POP_IX_DE_BC_HL_RET
0018E1 E645 010000          10  NCLPAT: LD  BC,0        ;自己書き換え C=_FATDRV B=_FATIX
0018E4 E648 ED43AAEF        20      LD  (_FATDRV),BC
0018E8 E64C CD3CE8          17      CALL    RDFATS
0018EB E64F 18A4            12      JR  RDFATE2
                                
       E651                     NCL3:
0018ED E651 CB9A             8      RES 3,D
0018EF E653 CB92             8      RES 2,D
0018F1 E655 6B               4      LD  L,E
0018F2 E656 62               4      LD  H,D
0018F3 E657 CB3C             8      SRL H   ;
0018F5 E659 CB1D             8      RR  L   ;HLA=HLA/2
0018F7 E65B 1F               4      RRA     ;
0018F8 E65C F5              11      PUSH    AF
0018F9 E65D 3AABEF          13      LD  A,(_FATIX)
0018FC E660 0F               4      RRCA
0018FD E661 300B            12      JR  NC,NCL3X1
0018FF E663 3AECE4          13      LD  A,(SECSZ+2)
001902 E666 FE04             7      CP  4       ;1セクタ1024バイトの場合は奇数インデックスの場合に先頭を512バイトずらす
001904 E668 2004            12      JR  NZ,NCL3X1
001906 E66A 010002          10      LD  BC,512
001909 E66D 09              11      ADD HL,BC
       E66E                     NCL3X1:
00190A E66E F1              10      POP AF
00190B E66F ED4B7CF0        20      LD  BC,(_FATBF)
00190F E673 19              11      ADD HL,DE
001910 E674 09              11      ADD HL,BC
001911 E675 17               4      RLA
001912 E676 C9              10      RET
                                
       E677                     GNCL:
001913 E677 CD1EE6          17      CALL    NCL1        ;GET NEXT CLUSTER
001916 E67A D8              11      RET C
001917 E67B C5              11      PUSH    BC
001918 E67C E5              11      PUSH    HL
001919 E67D CD51E6          17      CALL    NCL3
00191C E680 3809            12      JR  C,GNC1
00191E E682 5E               7      LD  E,(HL)
00191F E683 23               6      INC HL
001920 E684 7E               7      LD  A,(HL)
001921 E685 E60F             7      AND 00FH
001923 E687 57               4      LD  D,A
001924 E688 E1              10      POP HL
001925 E689 C1              10      POP BC
001926 E68A C9              10      RET
       E68B                     GNC1:
001927 E68B 7E               7      LD  A,(HL)
001928 E68C 23               6      INC HL
001929 E68D 56               7      LD  D,(HL)
00192A E68E 0604             7      LD  B,4
       E690                     GNC1L:
00192C E690 CB3A             8      SRL D   ;DA=DA/2
00192E E692 1F               4      RRA     ;
00192F E693 10FB            13      DJNZ    GNC1L
                                
001931 E695 5F               4      LD  E,A
001932 E696 E1              10      POP HL
001933 E697 C1              10      POP BC
001934 E698 A7               4      AND A
001935 E699 C9              10      RET
                                
       E69A                     SNCL:
001936 E69A CD1EE6          17      CALL    NCL1
001939 E69D D8              11      RET C
                                ;               SET NEXT CLUSTER
00193A E69E E5              11      PUSH    HL
00193B E69F C5              11      PUSH    BC
00193C E6A0 D5              11      PUSH    DE
00193D E6A1 E5              11      PUSH    HL
00193E E6A2 CD51E6          17      CALL    NCL3
001941 E6A5 D1              10      POP DE
                                ;CF=ODD
001942 E6A6 7E               7      LD  A,(HL)
001943 E6A7 73               7      LD  (HL),E
001944 E6A8 3806            12      JR  C,SNC1
                                ;EVEN
                                ;M[0] = E
                                ;M[1] = (M[1] & 0xF0) | (D & 0x0F)
001946 E6AA 23               6      INC HL
001947 E6AB ED67            18      RRD     ;M={A[3:0],E[3:0]}
001949 E6AD 7A               4      LD  A,D
00194A E6AE 1804            12      JR  SNC11
       E6B0                     SNC1:
                                ;ODD
                                ;HL[0] = (HL[0]&0x0F) | (E<<4)
                                ;HL[1] = DE>>4
00194C E6B0 ED6F            18      RLD     ;M={D[3:0],E[7:4]}
00194E E6B2 23               6      INC HL
00194F E6B3 72               7      LD  (HL),D  ;M={D[3:0],E[7:4]}
       E6B4                     SNC11:
001950 E6B4 ED6F            18      RLD     ;M={M[7:4],D[3:0]}
001952 E6B6 B7               4      OR  A
001953 E6B7 D1              10      POP DE
001954 E6B8 C1              10      POP BC
001955 E6B9 E1              10      POP HL
       E6BA                     FAT_CHANGED:
001956 E6BA 3E01             7      LD  A,1
001958 E6BC 32A2EF          13      LD  (_WTFATF),A
00195B E6BF C9              10      RET
                                
       E6C0                     N16CL3:
00195C E6C0 C5              11      PUSH    BC
00195D E6C1 6B               4      LD  L,E
00195E E6C2 7A               4      LD  A,D
00195F E6C3 E603             7      AND 3
001961 E6C5 67               4      LD  H,A
001962 E6C6 29              11      ADD HL,HL
001963 E6C7 ED4B7CF0        20      LD  BC,(_FATBF)
001967 E6CB 09              11      ADD HL,BC
001968 E6CC C1              10      POP BC
001969 E6CD C9              10      RET
                                
       E6CE                     GNCL16:
00196A E6CE CD1EE6          17      CALL    NCL1        ;GET NEXT CLUSTER for FAT16
00196D E6D1 D8              11      RET C
00196E E6D2 E5              11      PUSH    HL
00196F E6D3 CDC0E6          17      CALL    N16CL3
001972 E6D6 5E               7      LD  E,(HL)
001973 E6D7 23               6      INC HL
001974 E6D8 56               7      LD  D,(HL)
001975 E6D9 E1              10      POP HL
001976 E6DA C9              10      RET
                                
       E6DB                     SNCL16:
001977 E6DB CD1EE6          17      CALL    NCL1        ;GET NEXT CLUSTER for FAT16
00197A E6DE D8              11      RET C
00197B E6DF D5              11      PUSH    DE
00197C E6E0 E5              11      PUSH    HL
00197D E6E1 CDC0E6          17      CALL    N16CL3
001980 E6E4 D1              10      POP DE      ;HL
001981 E6E5 73               7      LD  (HL),E
001982 E6E6 23               6      INC HL
001983 E6E7 72               7      LD  (HL),D
001984 E6E8 6B               4      LD  L,E
001985 E6E9 62               4      LD  H,D
001986 E6EA D1              10      POP DE
001987 E6EB 18CD            12      JR  FAT_CHANGED
                                
                                ;------------------------
                                ;次のセクタを探す際に_SECPSの値をチェック
                                ;in
                                ;   DE : セクタ番号
                                ;out
                                ;   DE : 次のセクタ番号
                                ;note
                                ;
                                ;------------------------
       E6ED                     NEXTX:
001989 E6ED 3E00             7  _SECPS: LD  A,0 ;自己書き換え
00198B E6EF 3C               4      INC A
00198C E6F0 E600             7  NCPAT:  AND 0   ;自己書き換え　1クラスタの論理セクタ数-1
00198E E6F2 32EEE6          13      LD  (_SECPS+1),A
001991 E6F5 C9              10      RET
                                
       E6F6                     GNCLX:
001992 E6F6 CDEDE6          17      CALL    NEXTX
001995 E6F9 C0              11      RET NZ  ;1クラスタのセクタ未満の場合は戻る
001996 E6FA C3F7EF          10      JP  _GNCL   ;次のクラスタを探す
                                
       E6FD                     RDFAT:
001999 E6FD 3E80             7      LD  A,080H
00199B E6FF 3270EF          13      LD  (CHECK),A
       E702                     RDFAT1:
00199E E702 3A88EF          13      LD  A,(_DRV)
0019A1 E705 CD9AE9          17      CALL    CHGDRVR
0019A4 E708 D8              11      RET C
0019A5 E709 DD7E12          19      LD  A,(IX+012H) ;DPB_12_DEVICE
0019A8 E70C CB6F             8      BIT 5,A
0019AA E70E 2843            12      JR  Z,RDFAT0X
0019AC E710 2170EF          10      LD  HL,CHECK
0019AF E713 A6               7      AND (HL)
0019B0 E714 77               7      LD  (HL),A
0019B1 E715 110000          10      LD  DE,0        ;BPB
0019B4 E718 2A7CF0          16      LD  HL,(_FATBF)
0019B7 E71B CD48E8          17      CALL    DRD16
0019BA E71E 3024            12      JR  NC,GETBPB
0019BC E720 2170EF          10      LD  HL,CHECK
0019BF E723 CB06            15      RLC (HL)
0019C1 E725 3F               4      CCF
0019C2 E726 D8              11      RET C
0019C3 E727 DDCB0A1E        23      RR  (IX+00AH)   ;DPB_0A_FDMODE
0019C7 E72B 3F               4      CCF         ;フロッピーディスクのMFMモードを切り替える
0019C8 E72C DDCB0A16        23      RL  (IX+00AH)   ;DPB_0A_FDMODE
0019CC E730 3EFF             7      LD  A,0FFH
0019CE E732 3289EF          13      LD  (_DSK),A
0019D1 E735 3A84EF          13      LD  A,(_DRIVE)
0019D4 E738 E603             7      AND 3
0019D6 E73A F680             7      OR  080H
0019D8 E73C 6F               4      LD  L,A
0019D9 E73D 26EF             7      LD  H,_CYL0/256
0019DB E73F 3EFF             7      LD  A,0FFH
0019DD E741 77               7      LD  (HL),A
0019DE E742 18BE            12      JR  RDFAT1
       E744                     GETBPB:
0019E0 E744 FDE5            15      PUSH    IY
0019E2 E746 FD2A7CF0        20      LD  IY,(_FATBF) ;BPB
0019E6 E74A CDF1EF          17      CALL    _BPB2DPB
0019E9 E74D FDE1            14      POP IY
0019EB E74F D8              11      RET C
0019EC E750 CDF0E8          17      CALL    CHGDRV2
       E753                     RDFAT0X:
0019EF E753 CD3CE8          17      CALL    RDFATS
0019F2 E756 D8              11      RET C
0019F3 E757 DDBE06           7      CP  (IX+6)      ;DPB_06_FATID
0019F6 E75A C8              11      RET Z
0019F7 E75B DDCB126E        20      BIT 5,(IX+012H) ;DPB_12_DEVICE
0019FB E75F C0              11      RET NZ      ;BPBを取得している場合はFATIDをチェックしない
0019FC E760 37               4      SCF
0019FD E761 C9              10      RET
                                
       E762                     BPB2DPB:
0019FE E762 FD7E00          19      LD  A,(IY+0)    ;BS_JmpBoot
001A01 E765 FEEB             7      CP  0EBH        ;Short jump
001A03 E767 2808            12      JR  Z,BPBOK
001A05 E769 FEE9             7      CP  0E9H        ;Near jump
001A07 E76B 2804            12      JR  Z,BPBOK
001A09 E76D FE60             7      CP  060H        ;X68k
001A0B E76F 37               4      SCF
001A0C E770 C0              11      RET NZ
       E771                     BPBOK:
001A0D E771 FD7E0D          19      LD  A,(IY+13)   ;BPB_SecPerClus
001A10 E774 DD7707          19      LD  (IX+7),A    ;DPB_07_SECPCL
                                
001A13 E777 FD7E16          19      LD  A,(IY+22)   ;BPB_FATSz16
001A16 E77A DD7700          19      LD  (IX+0),A    ;DPB_00_FATLN
001A19 E77D FD7E17          19      LD  A,(IY+23)   ;BPB_FATSz16
001A1C E780 DD7701          19      LD  (IX+1),A    ;DPB_00_FATLN
                                
001A1F E783 FD6E0E          19      LD  L,(IY+14)   ;BPB_RsvdSecCnt
001A22 E786 FD660F          19      LD  H,(IY+15)
001A25 E789 DD750E          19      LD  (IX+00EH),L ;DPB_0E_FATPS
001A28 E78C FD5E16          19      LD  E,(IY+22)   ;BPB_FATSz16
001A2B E78F FD5617          19      LD  D,(IY+23)
001A2E E792 FD4610          19      LD  B,(IY+16)   ;BPB_NumFATs
       E795                     BPBDP1:             ;BPB_FATSz16 * BPB_NumFATs
001A31 E795 19              11      ADD HL,DE
001A32 E796 10FD            13      DJNZ    BPBDP1
       E798                     BPBDP2:
001A34 E798 DD7510          19      LD  (IX+010H),L ;DPB_10_DIRPS
001A37 E79B DD7411          19      LD  (IX+011H),H
001A3A E79E E5              11      PUSH    HL
                                
001A3B E79F FD6E11          19      LD  L,(IY+17)   ;BPB_RootEntCnt
001A3E E7A2 FD6612          19      LD  H,(IY+18)
001A41 E7A5 FD7E0C          19      LD  A,(IY+12)   ;BPB_BytsPerSec
001A44 E7A8 0606             7      LD  B,6
       E7AA                     BPBBPS1:
001A46 E7AA 05               4      DEC B
001A47 E7AB 0F               4      RRCA
001A48 E7AC 30FC            12      JR  NC,BPBBPS1
       E7AE                     BPBDE1:
001A4A E7AE 29              11      ADD HL,HL
001A4B E7AF 10FD            13      DJNZ    BPBDE1
                                
001A4D E7B1 7C               4      LD  A,H
001A4E E7B2 DD770B          19      LD  (IX+00BH),A ;DPB_0B_DIRSCNT
                                
001A51 E7B5 D1              10      POP DE      ;DPB_10_DIRPS
001A52 E7B6 6C               4      LD  L,H
001A53 E7B7 2600             7      LD  H,0
001A55 E7B9 19              11      ADD HL,DE       ;MAXDIR
001A56 E7BA E5              11      PUSH    HL
001A57 E7BB FD4E0D          19      LD  C,(IY+13)   ;BPB_SecPerClus
001A5A E7BE CB21             8      SLA C       ;*2
001A5C E7C0 AF               4      XOR A
001A5D E7C1 47               4      LD  B,A
001A5E E7C2 ED42            15      SBC HL,BC
001A60 E7C4 DD7514          19      LD  (IX+014H),L ;DPB_14_ADDCL16
001A63 E7C7 DD7415          19      LD  (IX+015H),H
                                
001A66 E7CA D1              10      POP DE      ;DE=DPB_0B_MAXDIR
001A67 E7CB FD6E13          19      LD  L,(IY+19)   ;BPB_TotSec16
001A6A E7CE FD6614          19      LD  H,(IY+20)
001A6D E7D1 7C               4      LD  A,H
001A6E E7D2 B5               4      OR  L
001A6F E7D3 3E00             7      LD  A,0     ;LDでフラグは変化しない。BPB_TotSec16を AHL で扱う為、Aに0を入れる
001A71 E7D5 2010            12      JR  NZ,BPB16BIT ;BPB_TotSec16が「0」の場合はBPB_TotSec32で計算
001A73 E7D7 FD7E23          19      LD  A,(IY+35)   ;念のために総セクタ数が24ビットを超える場合はエラーを返す
001A76 E7DA B7               4      OR  A
001A77 E7DB 37               4      SCF
001A78 E7DC C0              11      RET NZ
001A79 E7DD FD6E20          19      LD  L,(IY+32)   ;BPB_TotSec32 は AHL の24ビットで扱う
001A7C E7E0 FD6621          19      LD  H,(IY+33)   ;1クラスタの論理セクタ数(DPB_07_SECPCL)が最大128なので
001A7F E7E3 FD7E22          19      LD  A,(IY+34)   ;24ビットを超えると必ずクラスタ数が16ビットを超えてしまうのでこれで十分
001A82 E7E6 A7               4      AND A       ;CF=0
       E7E7                     BPB16BIT:
001A83 E7E7 ED52            15      SBC HL,DE
001A85 E7E9 DE00             7      SBC A,0
001A87 E7EB FD460D          19      LD  B,(IY+13)   ;BPB_SecPerClus
       E7EE                     BPBTC1:             ;総クラスタ数(AHL) = 総セクタ数(AHL) / セクタサイズ(B)
001A8A E7EE CB18             8      RR  B       ;->CY
001A8C E7F0 3808            12      JR  C,BPBTC2
001A8E E7F2 CB3F             8      SRL A
001A90 E7F4 CB1C             8      RR  H       ;AHL=AHL/2
001A92 E7F6 CB1D             8      RR  L
001A94 E7F8 18F4            12      JR  BPBTC1
       E7FA                     BPBTC2:
001A96 E7FA B7               4      OR  A
001A97 E7FB 37               4      SCF
001A98 E7FC C0              11      RET NZ      ;念のため(クラスタ数が16ビットを超える場合)
001A99 E7FD 23               6      INC HL
001A9A E7FE 23               6      INC HL
001A9B E7FF DD7508          19      LD  (IX+8),L    ;DPB_08_MAXCL
001A9E E802 DD7409          19      LD  (IX+9),H
                                
001AA1 E805 FD7E15          19      LD  A,(IY+21)   ;BPB_Media
001AA4 E808 DD7706          19      LD  (IX+6),A    ;DPB_06_FATID
                                
001AA7 E80B DDCB0A7E        20      BIT 7,(IX+00AH) ;DPB_0A_FDMODE
001AAB E80F 2817            12      JR  Z,NOT_FD
001AAD E811 2E28             7      LD  L,40        ;MAXCYLの設定（要検討）ここから下はフロッピーのみ書き換える
001AAF E813 FEFD             7      CP  0FDH    ;2D
001AB1 E815 2808            12      JR  Z,SETCYL
001AB3 E817 2E4D             7      LD  L,77
001AB5 E819 FEFE             7      CP  0FEH    ;2HD
001AB7 E81B 2802            12      JR  Z,SETCYL
001AB9 E81D 2E50             7      LD  L,80    ;その他2DD等
       E81F                     SETCYL:
001ABB E81F DD750C          19      LD  (IX+00CH),L ;DPB_0C_MAXCYL
001ABE E822 FD7E18          19      LD  A,(IY+24)   ;BPB_SecPerTr
001AC1 E825 DD770D          19      LD  (IX+00DH),A ;DPB_0D_MAXSEC  ;ここまでフロッピー専用
       E828                     NOT_FD:
001AC4 E828 FD7E10          19      LD  A,(IY+16)   ;BPB_NumFATs
001AC7 E82B FE02             7      CP  2       ;>2:NC
001AC9 E82D FD7E0C          19      LD  A,(IY+12)   ;BPB_BytsPerSec
001ACC E830 3802            12      JR  C,BPBFAT1
001ACE E832 F680             7      OR  080H
       E834                     BPBFAT1:
001AD0 E834 DD770F          19      LD  (IX+00FH),A ;DPB_0F_BPS
                                
001AD3 E837 E67F             7      AND 07FH        ;セクタバッファが1KBしかないので1KBを超える場合はCF=1でエラーにする
001AD5 E839 C6FB             7      ADD A,0-5       ;0-4:CF=0 5以上:CF=1
001AD7 E83B C9              10      RET
                                
       E83C                     RDFATS:
001AD8 E83C CD82E8          17      CALL    FATSETUP
001ADB E83F D8              11      RET C
001ADC E840 CD4CE8          17      CALL    DRD24B
001ADF E843 2A7CF0          16      LD  HL,(_FATBF)
001AE2 E846 7E               7      LD  A,(HL)
001AE3 E847 C9              10      RET
                                
       E848                     DRD16:
001AE4 E848 0E00             7      LD  C,0
       E84A                     DRD24:
001AE6 E84A 0601             7      LD  B,1
       E84C                     DRD24B:
001AE8 E84C DDE5            15      PUSH    IX
001AEA E84E DD2AA8EF        20      LD  IX,(_DPB)
001AEE E852 CDEAEA          17  DRDPAT: CALL    FDRD        ;自己書き換え（ディスク読み込み）
       E855                     POP_IX_RET:
001AF1 E855 DDE1            14      POP IX
001AF3 E857 C9              10      RET
                                
       E858                     DWT16:
001AF4 E858 0E00             7      LD  C,0
       E85A                     DWT24:
001AF6 E85A 0601             7      LD  B,1
       E85C                     DWT24B:
001AF8 E85C DDE5            15      PUSH    IX
001AFA E85E DD2AA8EF        20      LD  IX,(_DPB)
001AFE E862 CD8DEA          17  DWTPAT: CALL    FDWT        ;自己書き換え（ディスク書き込み）
001B01 E865 18EE            12      JR  POP_IX_RET
                                
       E867                     WTFAT:
001B03 E867 CD82E8          17      CALL    FATSETUP
001B06 E86A D45CE8          17      CALL    NC,DWT24B
001B09 E86D D8              11      RET C
001B0A E86E DDCB0F7E        20      BIT 7,(IX+00FH) ;DPB_0F_BPS
001B0E E872 C8              11      RET Z       ;予備FATが無い
001B0F E873 CD89E8          17      CALL    FATS2
001B12 E876 E5              11      PUSH    HL      ;予備FAT
001B13 E877 DD6E00          19      LD  L,(IX+0)    ;DPB_00_FATLN
001B16 E87A DD6601          19      LD  H,(IX+1)
001B19 E87D 19              11      ADD HL,DE
001B1A E87E EB               4      EX  DE,HL
001B1B E87F E1              10      POP HL
001B1C E880 18DA            12      JR  DWT24B
                                ;------------------------
                                ;FATのセットアップ
                                ;out
                                ;   B  : FATセクタ数
                                ;   DE : FAT先頭セクタ番号
                                ;   HL : FATバッファポインタ
                                ;   CF : 1=ドライブ切り替えエラー
                                ;note
                                ;   FATサイズがFATバッファを超える場合は
                                ;   対象クラスタ領域==(_FATIX)によって
                                ;   FAT12:対象クラスタ1024毎に1.5KBを切り替える
                                ;   FAT16:対象クラスタ1024毎に2KBを切り替える
                                ;------------------------
       E882                     FATSETUP:
001B1E E882 3AAAEF          13      LD  A,(_FATDRV)
001B21 E885 CD9AE9          17      CALL    CHGDRVR     ;ドライブ切り替え
001B24 E888 D8              11      RET C
       E889                     FATS2:
001B25 E889 DD7E0F          19      LD  A,(IX+00FH) ;DPB_0F_BPS 512=2 1024=4
001B28 E88C 0F               4      RRCA
001B29 E88D CDB6E8          17  FATSX:  CALL    FATSETUP12  ;自己書き換え
001B2C E890 210000          10      LD  HL,0
001B2F E893 4A               4      LD  C,D
001B30 E894 54               4      LD  D,H
001B31 E895 3AABEF          13      LD  A,(_FATIX)  ;範囲FAT12:0-3/FAT16:0-63(0-03FH):65535*2/2048
001B34 E898 47               4      LD  B,A
001B35 E899 04               4      INC B
001B36 E89A DD7E00          19      LD  A,(IX+0)    ;DPB_00_FATLN
       E89D                     FAT_SKP:
001B39 E89D 05               4      DEC B
001B3A E89E 2805            12      JR  Z,FAT1
001B3C E8A0 19              11      ADD HL,DE
001B3D E8A1 93               4      SUB E
001B3E E8A2 30F9            12      JR  NC,FAT_SKP
001B40 E8A4 C9              10      RET
       E8A5                     FAT1:
001B41 E8A5 EB               4      EX  DE,HL
001B42 E8A6 B9               4      CP  C       ;C=FATバッファに読み込めるセクタ数
001B43 E8A7 3801            12      JR  C,FAT2
001B45 E8A9 79               4      LD  A,C
       E8AA                     FAT2:
001B46 E8AA 47               4      LD  B,A
                                
001B47 E8AB 2AFAF0          16      LD  HL,(_FATPS) ;fat sector pos
001B4A E8AE 19              11      ADD HL,DE
001B4B E8AF EB               4      EX  DE,HL
001B4C E8B0 2A7CF0          16      LD  HL,(_FATBF)
001B4F E8B3 AF               4      XOR A       ;CF=0
001B50 E8B4 4F               4      LD  C,A
001B51 E8B5 C9              10      RET
                                ;
                                ;   FATバッファに読み込める最大のセクタ数と_FATIXで進めるセクタ数
                                ;   FATSETUP* (FAT12/FAT16)
                                ;out
                                ;   D : FATバッファに読み込める最大のセクタ数
                                ;   E : _FATIXで進めるセクタ数
       E8B6                     FATSETUP12:
001B52 E8B6 110606          10      LD  DE,0606H    ;256
001B55 E8B9 D8              11      RET C
001B56 E8BA 110303          10      LD  DE,0303H    ;512
001B59 E8BD 0F               4      RRCA
001B5A E8BE D8              11      RET C
001B5B E8BF 110102          10      LD  DE,0201H    ;1024
001B5E E8C2 C9              10      RET
                                
       E8C3                     FATSETUP16:
001B5F E8C3 110808          10      LD  DE,0808H    ;256
001B62 E8C6 D8              11      RET C
001B63 E8C7 110404          10      LD  DE,0404H
001B66 E8CA 0F               4      RRCA            ;512
001B67 E8CB D8              11      RET C
001B68 E8CC 110202          10      LD  DE,0202H    ;1024
001B6B E8CF C9              10      RET
                                
       E8D0                     CHGDRV:
001B6C E8D0 E5              11      PUSH    HL
001B6D E8D1 2189EF          10      LD  HL,_DSK
001B70 E8D4 BE               7      CP  (HL)
001B71 E8D5 280A            12      JR  Z,CHGDRVE
       E8D7                     CHGDRV1:
001B73 E8D7 DDE5            15      PUSH    IX
001B75 E8D9 CDE3E8          17      CALL    CHGDRV0
001B78 E8DC 3A89EF          13      LD  A,(_DSK)
001B7B E8DF DDE1            14      POP IX
       E8E1                     CHGDRVE:
001B7D E8E1 E1              10      POP HL
001B7E E8E2 C9              10      RET
                                
       E8E3                     CHGDRV0:
001B7F E8E3 6F               4      LD  L,A
001B80 E8E4 CDDCEF          17      CALL    _GETDPB
001B83 E8E7 D8              11      RET C
001B84 E8E8 DD22A8EF        20      LD  (_DPB),IX
001B88 E8EC 7D               4      LD  A,L
001B89 E8ED 3289EF          13      LD  (_DSK),A
       E8F0                     CHGDRV2:
001B8C E8F0 C5              11      PUSH    BC
001B8D E8F1 D5              11      PUSH    DE
001B8E E8F2 ED734FE9        20      LD  (SPPAT2+1),SP
001B92 E8F6 F3               4      DI
001B93 E8F7 DDF9            10      LD  SP,IX
                                
001B95 E8F9 E1              10      POP HL      ;DPB_00_FATLN
001B96 E8FA E1              10      POP HL      ;DPB_02_DRD
001B97 E8FB 2253E8          16      LD  (DRDPAT+1),HL
                                
001B9A E8FE E1              10      POP HL
001B9B E8FF 2263E8          16      LD  (DWTPAT+1),HL   ;DPB_04_DWT
                                
001B9E E902 E1              10      POP HL      ;L=DPB_06_FATID H=DPB_07_SECPCL
001B9F E903 7C               4      LD  A,H
001BA0 E904 32F9DF          13      LD  (SPCPAT+1),A    ;1クラスタの論理セクタ数
001BA3 E907 3D               4      DEC A
001BA4 E908 32F1E6          13      LD  (NCPAT+1),A
                                
001BA7 E90B E1              10      POP HL      ;DPB_08_MAXCL
001BA8 E90C 7D               4      LD  A,L
001BA9 E90D 3218E0          13      LD  (CLPAT2+1),A
001BAC E910 7C               4      LD  A,H
001BAD E911 3214E0          13      LD  (CLPAT1+1),A
001BB0 E914 2B               6      DEC HL
001BB1 E915 221CE2          16      LD  (MAXCLP+1),HL
                                
001BB4 E918 E1              10      POP HL      ;L=DPB_0A_FDMODE H=DPB_0B_DIRSCNT
001BB5 E919 7D               4      LD  A,L
001BB6 E91A F6FE             7      OR  0FEH
001BB8 E91C 328AEB          13      LD  (FDMODE+1),A
001BBB E91F 07               4      RLCA
001BBC E920 E603             7      AND 3
001BBE E922 322CEA          13      LD  (FSPAT+1),A
001BC1 E925 4C               4      LD  C,H
                                
001BC2 E926 E1              10      POP HL      ;L=DPB_0C_MAXCYL H=DPB_0D_MAXSEC
001BC3 E927 7D               4      LD  A,L
001BC4 E928 32A1EF          13      LD  (_MAXCYL),A
001BC7 E92B 7C               4      LD  A,H
001BC8 E92C 32E6E9          13      LD  (MAXSEC+1),A
                                
001BCB E92F E1              10      POP HL      ;L=DPB_0E_FATPS H=DPB_0F_BPS
001BCC E930 7C               4      LD  A,H     ;DPB_0F_BPS
001BCD E931 E607             7      AND 7
001BCF E933 32ECE4          13      LD  (SECSZ+2),A ;1セクタのサイズの上位1バイト 0x400 - 0x200 - 0x100
                                                ;1セクタ512 2D/2DD/2HC/2HQ(2HD1.44MB)/EMM/BRAM等
                                                ;1セクタ1024 2HD/2HDE98
                                                ;1セクタ256 GRAM等
                                                ;1024   512 256
                                                ;4  2   1
001BD2 E936 87               4      ADD A,A     ;8  4   2
001BD3 E937 87               4      ADD A,A     ;010H   8   4
001BD4 E938 87               4      ADD A,A     ;020H   010H    8
001BD5 E939 3275DE          13      LD  (SDECPAT+1),A   ;1セクタ辺りのディレクトリエントリ数
                                
001BD8 E93C 2600             7      LD  H,0
001BDA E93E 22FAF0          16      LD  (_FATPS),HL
                                
001BDD E941 E1              10      POP HL      ;L=DPB_10_DIRPS
001BDE E942 22FCF0          16      LD  (_DIRPS),HL
                                
001BE1 E945 E1              10      POP HL      ;L=DPB_12_DEVICE H=DPB_13_UNITNO
001BE2 E946 7C               4      LD  A,H
001BE3 E947 3284EF          13      LD  (_DRIVE),A
                                
001BE6 E94A E1              10      POP HL      ;DPB_14_ADDCL16
001BE7 E94B 2209E0          16      LD  (CLSPAT+1),HL
                                
001BEA E94E 310000          10  SPPAT2: LD  SP,0        ;元のSPを復元
001BED E951 FB               4      EI
001BEE E952 2AFCF0          16      LD  HL,(_DIRPS)
001BF1 E955 0600             7      LD  B,0
001BF3 E957 09              11      ADD HL,BC
001BF4 E958 2290DE          16      LD  (MD_PAT+1),HL
                                
001BF7 E95B 2A1CE2          16      LD  HL,(MAXCLP+1);
001BFA E95E 11F60F          10      LD  DE,4086
001BFD E961 B7               4      OR  A
001BFE E962 ED52            15      SBC HL,DE
001C00 E964 300F            12      JR  NC,SETFAT16
001C02 E966 2177E6          10      LD  HL,GNCL     ;FAT12
001C05 E969 119AE6          10      LD  DE,SNCL
001C08 E96C 01B6E8          10      LD  BC,FATSETUP12
001C0B E96F DDCB0FAE        23      RES 5,(IX+00FH) ;DPB_0F_BPS(FAT12)
001C0F E973 180D            12      JR  EXTRA1
       E975                     SETFAT16:
001C11 E975 21CEE6          10      LD  HL,GNCL16   ;FAT16
001C14 E978 11DBE6          10      LD  DE,SNCL16
001C17 E97B 01C3E8          10      LD  BC,FATSETUP16
001C1A E97E DDCB0FEE        23      SET 5,(IX+00FH) ;DPB_0F_BPS(FAT16)
       E982                     EXTRA1:
001C1E E982 22F8EF          16      LD  (GNCPAT+1),HL
001C21 E985 ED53FBEF        20      LD  (SNCPAT+1),DE
001C25 E989 ED438EE8        20      LD  (FATSX+1),BC
001C29 E98D D1              10      POP DE
001C2A E98E C1              10      POP BC
001C2B E98F AF               4      XOR A
001C2C E990 C9              10      RET
                                
       E991                     GETDPBD:
001C2D E991 DDE3            23      EX  (SP),IX
001C2F E993 DDE5            15      PUSH    IX
001C31 E995 3A88EF          13      LD  A,(_DRV)
001C34 E998 1807            12      JR  GETDPB1
                                
       E99A                     CHGDRVR:
001C36 E99A CDD9EF          17      CALL    _CHGDRV
001C39 E99D D8              11      RET C
001C3A E99E 3A89EF          13      LD  A,(_DSK)
       E9A1                     GETDPB1:
001C3D E9A1 C3DCEF          10      JP  _GETDPB
                                
       E9A4                     GETDPB:
001C40 E9A4 FE08             7      CP  8
001C42 E9A6 3F               4      CCF
001C43 E9A7 D8              11      RET C
001C44 E9A8 0F               4      RRCA
001C45 E9A9 0F               4      RRCA
001C46 E9AA 0F               4      RRCA
001C47 E9AB DD                      DB  0DDH        ;Z80未定義命令
001C48 E9AC 6F               4      LD  L,A     ;LD IXL,A
001C49 E9AD DD                      DB  0DDH        ;Z80未定義命令
001C4A E9AE 26F1             7      LD  H,DEVICE/256    ;LD IXH,DEVICE/256
001C4C E9B0 DD7E00          19      LD  A,(IX+0)    ;DPB_00_FATLN
001C4F E9B3 B7               4      OR  A       ;CF=0の為
001C50 E9B4 DDCB0F6E        20      BIT 5,(IX+00FH) ;DPB_0F_BPS
001C54 E9B8 C0              11      RET NZ      ;FAT16
001C55 E9B9 DDCB126E        20      BIT 5,(IX+012H) ;DPB_12_DEVICE
001C59 E9BD C0              11      RET NZ      ;BPB
001C5A E9BE FE01             7      CP  001H        ;A=0 THEN CF=1
001C5C E9C0 C9              10      RET
                                
       E9C1                     _SYS5F:
001C5D E9C1 AF               4      XOR A
       E9C2                     FFLUSH:
001C5E E9C2 F5              11      PUSH    AF
001C5F E9C3 3EFF             7      LD  A,0FFH
001C61 E9C5 3239EF          13      LD  (SFILE),A
001C64 E9C8 CDB5E5          17      CALL    DWTX
001C67 E9CB 3EFF             7      LD  A,0FFH
001C69 E9CD 32A5EF          13      LD  (_DBDRV),A
001C6C E9D0 CDFFE5          17      CALL    WTFATX
001C6F E9D3 AF               4      XOR A
001C70 E9D4 32ABEF          13      LD  (_FATIX),A
001C73 E9D7 2F               4      CPL
001C74 E9D8 32AAEF          13      LD  (_FATDRV),A
001C77 E9DB F1              10      POP AF
001C78 E9DC C9              10      RET
                                
[EOF:LDDIO.ASM:SHIFT_JIS]
                                    INCLUDE "M7DISK.ASM"
                                
                                ;   LSX-Dodgers DISK
                                ;   MZ-700/1500
                                
       E9DD                     SEEK:
001C79 E9DD 7A               4      LD  A,D
001C7A E9DE B3               4      OR  E
001C7B E9DF 3E01             7      LD  A,001H
001C7D E9E1 2811            12      JR  Z,DIV3
                                
001C7F E9E3 0610             7      LD  B,16
001C81 E9E5 0E00             7  MAXSEC: LD  C,000H
001C83 E9E7 AF               4      XOR A
001C84 E9E8 EB               4      EX  DE,HL
       E9E9                     DIV1:
001C85 E9E9 29              11      ADD HL,HL
001C86 E9EA 8F               4      ADC A,A
001C87 E9EB B9               4      CP  C
001C88 E9EC 3802            12      JR  C,DIV2
001C8A E9EE 91               4      SUB C
001C8B E9EF 2C               4      INC L
       E9F0                     DIV2:
001C8C E9F0 10F7            13      DJNZ    DIV1
                                
001C8E E9F2 3C               4      INC A   ;最小のセクタは１固定
001C8F E9F3 55               4      LD  D,L ;TRACK
       E9F4                     DIV3:
001C90 E9F4 5F               4      LD  E,A ;Remainder
                                
001C91 E9F5 3A84EF          13      LD  A,(_DRIVE)
001C94 E9F8 FE04             7      CP  4
001C96 E9FA 3F               4      CCF
001C97 E9FB D8              11      RET C
001C98 E9FC F684             7      OR  084H        ;Motor on + ドライブセレクト有効
001C9A E9FE D3DC            11      OUT (0DCH),A
001C9C EA00 CB3A             8      SRL D       ;CYLINDER
001C9E EA02 9F               4      SBC A,A
001C9F EA03 D3DD            11      OUT (0DDH),A    ;SIDE
                                
001CA1 EA05 CD42EA          17      CALL    SETMODE
001CA4 EA08 D8              11      RET C
                                
001CA5 EA09 CD77EA          17      CALL    DRIVE
001CA8 EA0C FEFF             7      CP  0FFH        ;A=0FFH Unknown CYLINDER
001CAA EA0E CC5EEA          17      CALL    Z,FDCRES    ;Restore
001CAD EA11 2F               4      CPL         ;データバスが負論理
001CAE EA12 D3D9            11      OUT (0D9H),A    ;Currrent CYLINDER
001CB0 EA14 2F               4      CPL         ;データバスが負論理
001CB1 EA15 92               4      SUB D
001CB2 EA16 C8              11      RET Z       ;No seek
                                
001CB3 EA17 3A86EF          13      LD  A,(_ISEEK)
001CB6 EA1A 4F               4      LD  C,A
                                
001CB7 EA1B 3AA1EF          13      LD  A,(_MAXCYL) ;Max CYLINDER
001CBA EA1E 3D               4      DEC A
001CBB EA1F BA               4      CP  D       ;Over CYLINDER
001CBC EA20 D8              11      RET C
                                
001CBD EA21 7A               4      LD  A,D
001CBE EA22 2F               4      CPL         ;データバスが負論理
001CBF EA23 D3DB            11      OUT (0DBH),A
001CC1 EA25 72               7      LD  (HL),D
                                
001CC2 EA26 0E18             7      LD  C,018H      ;Seek
       EA28                     FDCCMD2:
001CC4 EA28 3A85EF          13      LD  A,(_SEEKSP)
001CC7 EA2B E6FF             7  FSPAT:  AND 0FFH
001CC9 EA2D B1               4      OR  C
                                
       EA2E                     FDCCMD:
001CCA EA2E CD6EEA          17      CALL    COMSET
       EA32                     FDCSMC  EQU $+1
001CCD EA31 3E80             7      LD  A,080H      ;FDC COMMAND(Self-modifying code)
001CCF EA33 E620             7      AND 020H        ;Write data Write track
001CD1 EA35 3C               4      INC A
                                
       EA36                     SST:
001CD2 EA36 0E00             7      LD  C,0
       EA38                     SST1:
001CD4 EA38 0D               4      DEC C       ; 4
001CD5 EA39 20FD            12      JR  NZ,SST1     ;12 * 256 / 4 = About 1ms
001CD7 EA3B 3D               4      DEC A
001CD8 EA3C 20FA            12      JR  NZ,SST1
                                
001CDA EA3E 3C               4      INC A       ;A=1
001CDB EA3F CD47EA          17      CALL    READY
       EA42                     SETMODE:
001CDE EA42 CD71EA          17      CALL    DELAY0      ;Head select time
001CE1 EA45 3E81             7      LD  A,081H
       EA47                     READY:
001CE3 EA47 3251EA          13      LD  (WAITA),A
001CE6 EA4A E5              11      PUSH    HL
001CE7 EA4B 26F8             7      LD  H,0F8H
       EA4D                     READY2:
001CE9 EA4D DBD8            11      IN  A,(0D8H)
001CEB EA4F 2F               4      CPL         ;データバスが負論理
       EA51                     WAITA   EQU $+1
001CEC EA50 E681             7      AND 081H        ;NOT READY,BUSY
001CEE EA52 2808            12      JR  Z,READYE
001CF0 EA54 E3              19      EX  (SP),HL     ;wait 19clock
001CF1 EA55 E3              19      EX  (SP),HL     ; //
001CF2 EA56 2B               6      DEC HL
001CF3 EA57 7C               4      LD  A,H
001CF4 EA58 B5               4      OR  L
001CF5 EA59 20F2            12      JR  NZ,READY2
001CF7 EA5B 37               4      SCF
       EA5C                     READYE:
001CF8 EA5C E1              10      POP HL
001CF9 EA5D C9              10      RET
                                
       EA5E                     FDCRES:
001CFA EA5E 3600            10      LD  (HL),0
001CFC EA60 0E08             7      LD  C,8
001CFE EA62 18C4            12      JR  FDCCMD2
                                
       EA64                     FDMOFF:
001D00 EA64 AF               4      XOR A       ;Motor off(ドライブセレクト無効)
001D01 EA65 D3DC            11      OUT (0DCH),A
001D03 EA67 C9              10      RET
                                
       EA68                     SECSET:
001D04 EA68 F5              11      PUSH    AF
001D05 EA69 7B               4      LD  A,E
001D06 EA6A 2F               4      CPL         ;データバスが負論理
001D07 EA6B D3DA            11      OUT (0DAH),A
001D09 EA6D F1              10      POP AF
       EA6E                     COMSET:
001D0A EA6E 2F               4      CPL         ;データバスが負論理
001D0B EA6F D3D8            11      OUT (0D8H),A
       EA71                     DELAY0:
001D0D EA71 3E1A             7      LD  A,26
       EA73                     DELAY:
001D0F EA73 3D               4      DEC A
001D10 EA74 20FD            12      JR  NZ,DELAY
001D12 EA76 C9              10      RET
                                
       EA77                     DRIVE:
001D13 EA77 2A84EF          16      LD  HL,(_DRIVE)
001D16 EA7A 26EF             7      LD  H,_CYL0/256
001D18 EA7C CBFD             8      SET 7,L
001D1A EA7E 7E               7      LD  A,(HL)
001D1B EA7F C9              10      RET
                                
       EA80                     RNF:
001D1C EA80 CD77EA          17      CALL    DRIVE
001D1F EA83 36FF            10      LD  (HL),0FFH
001D21 EA85 C9              10      RET
                                
001D22 EA86 02                  RETRY:  DB  2
                                
                                
                                ;   FLOPPY DISK DRIVER
                                
       EA87                     WTTRK:
001D23 EA87 0601             7      LD  B,1
001D25 EA89 3EF4             7      LD  A,0F4H
001D27 EA8B 1802            12      JR  WTTRK1
       EA8D                     FDWT:
001D29 EA8D 3EA0             7      LD  A,0A0H
       EA8F                     WTTRK1:
001D2B EA8F 3232EA          13      LD  (FDCSMC),A
       EA92                     DWTBL:
001D2E EA92 78               4      LD  A,B
001D2F EA93 32D5EA          13      LD  (WTBSMC),A
001D32 EA96 3E02             7      LD  A,2     ;Retry count
001D34 EA98 3286EA          13      LD  (RETRY),A
                                
       EA9B                     DWT0:
001D37 EA9B D5              11      PUSH    DE
001D38 EA9C E5              11      PUSH    HL
001D39 EA9D 226FEB          16      LD  (DHLSMC),HL
001D3C EAA0 CDDDE9          17      CALL    SEEK        ;Write disk
001D3F EAA3 E1              10      POP HL
001D40 EAA4 383A            12      JR  C,ERRDW
001D42 EAA6 F3               4      DI
001D43 EAA7 3A32EA          13      LD  A,(FDCSMC)
001D46 EAAA CD68EA          17      CALL    SECSET
001D49 EAAD 0EDB             7      LD  C,0DBH
       EAAF                     DWT1:
001D4B EAAF 7E               7      LD  A,(HL)
001D4C EAB0 2F               4      CPL         ;データバスが負論理
001D4D EAB1 57               4      LD  D,A
                                
       EAB2                     DWT2:
001D4E EAB2 DBD8            11      IN  A,(0D8H)
001D50 EAB4 2F               4      CPL         ;データバスが負論理
001D51 EAB5 0F               4      RRCA
001D52 EAB6 3008            12      JR  NC,DWT4
001D54 EAB8 0F               4      RRCA
001D55 EAB9 30F7            12      JR  NC,DWT2
       EABB                     DWT3:
001D57 EABB ED51            12      OUT (C),D
001D59 EABD 23               6      INC HL
001D5A EABE 18EF            12      JR  DWT1
                                
       EAC0                     DWT4:
001D5C EAC0 3D               4      DEC A
001D5D EAC1 28F8            12      JR  Z,DWT3
001D5F EAC3 3C               4      INC A
001D60 EAC4 FB               4      EI
001D61 EAC5 D1              10      POP DE
001D62 EAC6 13               6      INC DE
001D63 EAC7 CD64EA          17      CALL    FDMOFF
001D66 EACA 2808            12      JR  Z,DISKOK_WT
001D68 EACC CD3AEB          17      CALL    DISKC
001D6B EACF 20CA            12      JR  NZ,DWT0
001D6D EAD1 B7               4      OR  A
001D6E EAD2 2005            12      JR  NZ,ERRW
                                
       EAD4                     DISKOK_WT:
       EAD5                     WTBSMC  EQU $+1
001D70 EAD4 0601             7      LD  B,1
001D72 EAD6 10BA            13      DJNZ    DWTBL
001D74 EAD8 C9              10      RET
                                
       EAD9                     ERRW:
001D75 EAD9 3EFF             7      LD  A,0FFH
       EADB                     ERRZ:
001D77 EADB BF               4      CP  A
001D78 EADC 37               4      SCF
001D79 EADD C364EA          10      JP  FDMOFF
                                
       EAE0                     ERRDW:
001D7C EAE0 D1              10      POP DE
001D7D EAE1 CD4BEB          17      CALL    DELP
001D80 EAE4 20B5            12      JR  NZ,DWT0
001D82 EAE6 B7               4      OR  A
001D83 EAE7 20F0            12      JR  NZ,ERRW
001D85 EAE9 C9              10      RET
                                
       EAEA                     FDRD:
001D86 EAEA 3E80             7      LD  A,080H
001D88 EAEC 3232EA          13      LD  (FDCSMC),A
       EAEF                     DRDBL:
001D8B EAEF 78               4      LD  A,B
001D8C EAF0 322CEB          13      LD  (RDBSMC),A
001D8F EAF3 3E02             7      LD  A,2     ;Retry count
001D91 EAF5 3286EA          13      LD  (RETRY),A
       EAF8                     DRD0:
001D94 EAF8 D5              11      PUSH    DE
001D95 EAF9 E5              11      PUSH    HL
001D96 EAFA 226FEB          16      LD  (DHLSMC),HL
001D99 EAFD CDDDE9          17      CALL    SEEK        ;Read disk
001D9C EB00 E1              10      POP HL
001D9D EB01 382D            12      JR  C,ERRDR
001D9F EB03 F3               4      DI
001DA0 EB04 3A32EA          13      LD  A,(FDCSMC)
001DA3 EB07 CD68EA          17      CALL    SECSET
       EB0A                     DRD1:
001DA6 EB0A DBD8            11      IN  A,(0D8H)
001DA8 EB0C 2F               4      CPL         ;データバスが負論理
001DA9 EB0D 0F               4      RRCA
001DAA EB0E 300A            12      JR  NC,DRD3
001DAC EB10 0F               4      RRCA
001DAD EB11 30F7            12      JR  NC,DRD1
001DAF EB13 DBDB            11      IN  A,(0DBH)
001DB1 EB15 2F               4      CPL         ;データバスが負論理
001DB2 EB16 77               7      LD  (HL),A
001DB3 EB17 23               6      INC HL
001DB4 EB18 18F0            12      JR  DRD1
                                
       EB1A                     DRD3:
001DB6 EB1A B7               4      OR  A
001DB7 EB1B FB               4      EI
001DB8 EB1C D1              10      POP DE
001DB9 EB1D 13               6      INC DE
001DBA EB1E CD64EA          17      CALL    FDMOFF
001DBD EB21 2808            12      JR  Z,DISKOK_RD
001DBF EB23 CD3AEB          17      CALL    DISKC
001DC2 EB26 20D0            12      JR  NZ,DRD0
001DC4 EB28 B7               4      OR  A
001DC5 EB29 20AE            12      JR  NZ,ERRW
                                
       EB2B                     DISKOK_RD:
       EB2C                     RDBSMC  EQU $+1
001DC7 EB2B 0601             7      LD  B,1
001DC9 EB2D 10C0            13      DJNZ    DRDBL
001DCB EB2F C9              10      RET
                                
       EB30                     ERRDR:
001DCC EB30 D1              10      POP DE
001DCD EB31 CD4BEB          17      CALL    DELP
001DD0 EB34 20C2            12      JR  NZ,DRD0
001DD2 EB36 B7               4      OR  A
001DD3 EB37 20A0            12      JR  NZ,ERRW
001DD5 EB39 C9              10      RET
       EB3A                     DISKC:
001DD6 EB3A 1B               6      DEC DE
001DD7 EB3B CB5F             8      BIT 3,A
001DD9 EB3D C480EA          17      CALL    NZ,RNF
       EB40                     DISKD:
001DDC EB40 E5              11      PUSH    HL
001DDD EB41 2186EA          10      LD  HL,RETRY
001DE0 EB44 35              11      DEC (HL)
001DE1 EB45 E1              10      POP HL
001DE2 EB46 203E            12      JR  NZ,ERR      ;Retry
001DE4 EB48 B7               4      OR  A
001DE5 EB49 283B            12      JR  Z,ERR       ;Error
                                
       EB4B                     DELP:
001DE7 EB4B CD80EA          17      CALL    RNF
001DEA EB4E CD64EA          17      CALL    FDMOFF
001DED EB51 3A85EF          13      LD  A,(_SEEKSP)
001DF0 EB54 87               4      ADD A,A
001DF1 EB55 382E            12      JR  C,AERRZ
       EB57                     DELP1:
001DF3 EB57 D5              11      PUSH    DE
001DF4 EB58 21C0F0          10      LD  HL,DEMES
001DF7 EB5B CDE8D5          17      CALL    MSX
001DFA EB5E CDB6D8          17      CALL    KEYBC
       EB61                     DELP2:
001DFD EB61 CDCAEF          17      CALL    _INKEY
001E00 EB64 28FB            12      JR  Z,DELP2
                                
001E02 EB66 D1              10      POP DE
001E03 EB67 CD1AE0          17      CALL    CAP
001E06 EB6A FE52             7      CP  'R'     ;Retry
001E08 EB6C 200A            12      JR  NZ,DELP3
       EB6F                     DHLSMC  EQU $+1
001E0A EB6E 210000          10      LD  HL,0        ;Self-modifying code
001E0D EB71 3E02             7      LD  A,2
001E0F EB73 3286EA          13      LD  (RETRY),A
001E12 EB76 B7               4      OR  A
001E13 EB77 C9              10      RET
       EB78                     DELP3:
001E14 EB78 FE49             7      CP  'I'     ;Ignore
001E16 EB7A 2807            12      JR  Z,IGNORE
001E18 EB7C FE41             7      CP  'A'     ;Abort
001E1A EB7E 20D7            12      JR  NZ,DELP1
001E1C EB80 C300EF          10      JP  CPM_BOOT
       EB83                     IGNORE:
001E1F EB83 3EFF             7      LD  A,0FFH
       EB85                     AERRZ:
001E21 EB85 BF               4      CP  A
       EB86                     ERR:
001E22 EB86 3EFF             7      LD  A,0FFH
001E24 EB88 C9              10      RET
                                
001E25 EB89 3EFF             7  FDMODE: LD  A,0FFH      ;Floppy mode(2D/2HD) (Self-modifying code)
[EOF:M7DISK.ASM:SHIFT_JIS]
                                    INCLUDE "M7DISK2.ASM"
                                
                                ;   LSX-Dodgers DISK2
                                ;   MZ-700/1500
                                
                                ;   EMM DRIVER
                                ;   1セクタ可変(256/512/1024)
                                
       EB8B                     EDWT:
001E27 EB8B F5              11      PUSH    AF
001E28 EB8C CDAAEB          17      CALL    EADR
001E2B EB8F 0600             7      LD  B,0
       EB91                     EDWT1:
001E2D EB91 EDB3                    OTIR
001E2F EB93 3D               4      DEC A
001E30 EB94 20FB            12      JR  NZ,EDWT1
001E32 EB96 180B            12      JR  EDRW1
                                
       EB98                     EDRD:
001E34 EB98 C5              11      PUSH    BC
001E35 EB99 CDAAEB          17      CALL    EADR
001E38 EB9C 0600             7      LD  B,0
       EB9E                     EDRD1:
001E3A EB9E EDB2                    INIR
001E3C EBA0 3D               4      DEC A
001E3D EBA1 20FB            12      JR  NZ,EDRD1
       EBA3                     EDRW1:
001E3F EBA3 F1              10      POP AF
001E40 EBA4 83               4      ADD A,E ;セクタを進める
001E41 EBA5 5F               4      LD  E,A
001E42 EBA6 8A               4      ADC A,D
001E43 EBA7 93               4      SUB E
001E44 EBA8 57               4      LD  D,A
001E45 EBA9 C9              10      RET
                                
       EBAA                     EADR:
001E46 EBAA C5              11      PUSH    BC
001E47 EBAB D5              11      PUSH    DE
001E48 EBAC EB               4      EX  DE,HL
001E49 EBAD 29              11      ADD HL,HL
001E4A EBAE DD4E0D          19      LD  C,(IX+00DH) ;DPB_0D_MAXSEC
001E4D EBB1 DD460C          19      LD  B,(IX+00CH) ;DPB_0C_MAXCYL
001E50 EBB4 09              11      ADD HL,BC
001E51 EBB5 DD4E13          19      LD  C,(IX+013H) ;DPB_13_UNITNO
001E54 EBB8 ED49            12      OUT (C),C
001E56 EBBA 0C               4      INC C
001E57 EBBB ED69            12      OUT (C),L
001E59 EBBD 0C               4      INC C
001E5A EBBE ED61            12      OUT (C),H
001E5C EBC0 0C               4      INC C
001E5D EBC1 EB               4      EX  DE,HL
001E5E EBC2 D1              10      POP DE
001E5F EBC3 DD460F          19      LD  B,(IX+00FH) ;DPB_0F_BPS
001E62 EBC6 F1              10      POP AF
       EBC7                     EADR1:              ;読み込むセクタ数と1クラスタのセクタ数を掛ける
001E63 EBC7 CB18             8      RR  B
001E65 EBC9 D8              11      RET C
001E66 EBCA 87               4      ADD A,A
001E67 EBCB 18FA            12      JR  EADR1
                                
                                ;   CMOS BACKUP MEMORY DRIVER(32KB)
                                ;   1セクタ256
                                
       EBCD                     CDWT:
001E69 EBCD 78               4      LD  A,B
001E6A EBCE DD4E13          19      LD  C,(IX+013H) ;DPB_13_UNITNO
001E6D EBD1 ED40            12      IN  B,(C)       ;アドレスカウンタを0000にリセット
001E6F EBD3 ED59            12      OUT (C),E       ;W)アドレスカウンタ上位
001E71 EBD5 0C               4      INC C       ;C=F9
001E72 EBD6 0C               4      INC C       ;C=FA
001E73 EBD7 0600             7      LD  B,0
       EBD9                     CDWT1:
001E75 EBD9 EDB3                    OTIR            ;W)データ書き込み・アドレスカウンタ+1
001E77 EBDB 13               6      INC DE
001E78 EBDC 3D               4      DEC A
001E79 EBDD 20FA            12      JR  NZ,CDWT1
001E7B EBDF A7               4      AND A
001E7C EBE0 C9              10      RET
                                
       EBE1                     CDRD:
001E7D EBE1 78               4      LD  A,B
001E7E EBE2 DD4E13          19      LD  C,(IX+013H) ;DPB_13_UNITNO
001E81 EBE5 ED40            12      IN  B,(C)       ;アドレスカウンタを0000にリセット
001E83 EBE7 ED59            12      OUT (C),E       ;W)アドレスカウンタ上位
001E85 EBE9 0C               4      INC C       ;C=F9
001E86 EBEA 0600             7      LD  B,0
       EBEC                     CDRD1:
001E88 EBEC EDB2                    INIR            ;R)データ読み出し・アドレスカウンタ+1
001E8A EBEE 13               6      INC DE
001E8B EBEF 3D               4      DEC A
001E8C EBF0 20FA            12      JR  NZ,CDRD1
001E8E EBF2 A7               4      AND A
001E8F EBF3 C9              10      RET
                                
                                ;   RAM DISK DRIVER (64KB)
                                ;   1セクタ256
                                
       EBF4                     RDWT:
001E90 EBF4 78               4      LD  A,B
001E91 EBF5 43               4      LD  B,E     ;B=アドレスカウンタ上位
001E92 EBF6 0EEB             7      LD  C,0EBH
001E94 EBF8 ED71            12      OUT (C),0       ;0=アドレスカウンタ下位
001E96 EBFA 0D               4      DEC C       ;EA(W)データ書き込み・アドレスカウンタ+1
001E97 EBFB 0600             7      LD  B,0
       EBFD                     RDWT1:
001E99 EBFD EDB3                    OTIR
001E9B EBFF 13               6      INC DE
001E9C EC00 3D               4      DEC A
001E9D EC01 20FA            12      JR  NZ,RDWT1
001E9F EC03 A7               4      AND A
001EA0 EC04 C9              10      RET
                                
       EC05                     RDRD:
001EA1 EC05 78               4      LD  A,B
001EA2 EC06 43               4      LD  B,E     ;B=アドレスカウンタ上位
001EA3 EC07 0EEB             7      LD  C,0EBH
001EA5 EC09 ED71            12      OUT (C),0       ;0=アドレスカウンタ下位
001EA7 EC0B 0D               4      DEC C       ;EA(R)データ読み出し・アドレスカウンタ+1
001EA8 EC0C 0600             7      LD  B,0
       EC0E                     RDRD1:
001EAA EC0E EDB2                    INIR
001EAC EC10 13               6      INC DE
001EAD EC11 3D               4      DEC A
001EAE EC12 20FA            12      JR  NZ,RDRD1
001EB0 EC14 A7               4      AND A
001EB1 EC15 C9              10      RET
[EOF:M7DISK2.ASM:UTF_8]
                                
                                    INCLUDE "M7TABLE.ASM"
                                
                                ;   LSX-Dodgers TABLE 表示関連のテーブル
                                ;   MZ-700/1500
                                
       EC16                     AT_TABLE:
001EB2 EC16                         DS  TABLEAD-AT_TABLE
                                
       EC40                     KEY_TABLE:
001EDC EC40 12081E1F1C1D5C2F        DB  12H,08H,1EH,1FH,1CH,1DH,5CH,'/'
001EE4 EC48 5C5E2D2030392C2E        DB  5CH,'^','-',20H,'0','9',',','.'
001EEC EC50 3132333435363738        DB  '1','2','3','4','5','6','7','8'
001EF4 EC58 6162636465666768        DB  'a','b','c','d','e','f','g','h'
001EFC EC60 696A6B6C6D6E6F70        DB  'i','j','k','l','m','n','o','p'
001F04 EC68 7172737475767778        DB  'q','r','s','t','u','v','w','x'
001F0C EC70 797A405B5D000000        DB  'y','z','@','[',']',00H,00H,00H
001F14 EC78 001B3D09003B3A0D        DB  00H,1BH,'=',09H,00H,';',':',0DH
       EC80                     SHIFT_TABLE:
001F1C EC80 12081E1F1C1D5F3F        DB  12H,08H,1EH,1FH,1CH,1DH,'_','?'
001F24 EC88 7C7E3D2030293C3E        DB  '|','~','=',20H,'0',')','<','>'
001F2C EC90 2122232425262728        DB  '!','"','#','$','%','&',27H,'('
001F34 EC98 4142434445464748        DB  'A','B','C','D','E','F','G','H'
001F3C ECA0 494A4B4C4D4E4F50        DB  'I','J','K','L','M','N','O','P'
001F44 ECA8 5152535455565758        DB  'Q','R','S','T','U','V','W','X'
001F4C ECB0 595A607B7D000000        DB  'Y','Z','`','{','}',00H,00H,00H
001F54 ECB8 00003D09002B2A0D        DB  00H,00H,'=',09H,00H,'+','*',0DH
       ECC0                     CTRL_TABLE:
001F5C ECC0 12081E1F1C1D3F2F        DB  12H,08H,1EH,1FH,1CH,1DH,'?','/'
001F64 ECC8 2A2B2D2030392C2E        DB  '*','+','-',20H,'0','9',',','.'
001F6C ECD0 3132333435363738        DB  '1','2','3','4','5','6','7','8'
001F74 ECD8 0102030405060708        DB  01H,02H,03H,04H,05H,06H,07H,08H
001F7C ECE0 090A0B0C0D0E0F10        DB  09H,0AH,0BH,0CH,0DH,0EH,0FH,10H
001F84 ECE8 1112131415161718        DB  11H,12H,13H,14H,15H,16H,17H,18H
001F8C ECF0 191A1B5B5D000000        DB  19H,1AH,1BH,'[',']',00H,00H,00H
001F94 ECF8 00003D09003B3A0D        DB  00H,00H,'=',09H,00H,';',':',0DH
                                
                                ;   アドレス下位1バイトが0になるように
       ED00                     CD_TABLE:
001F9C ED00 00D1D2D3D4D5D6D0        DB  $00,$D1,$D2,$D3,$D4,$D5,$D6,$D0 ;月火水木金土日
001FA4 ED08 D8DCD9DADBD7CFCE        DB  $D8,$DC,$D9,$DA,$DB,$D7,$CF,$CE ;年円時分秒
001FAC ED10 601F5F5E1E1B7978        DB  $60,$1F,$5F,$5E,$1E,$1B,$79,$78 ;
001FB4 ED18 5C5D1C1D6DCACDC7        DB  $5C,$5D,$1C,$1D,$6D,$CA,$CD,$C7 ;
001FBC ED20 0061626364656667        DB  $00,$61,$62,$63,$64,$65,$66,$67 ; !"#$%&'
001FC4 ED28 68696B6A2F2A2E2D        DB  $68,$69,$6B,$6A,$2F,$2A,$2E,$2D ;()*+,-./
001FCC ED30 2021222324252627        DB  $20,$21,$22,$23,$24,$25,$26,$27 ;01234567
001FD4 ED38 28294F2C512B5749        DB  $28,$29,$4F,$2C,$51,$2B,$57,$49 ;89:;<=>?
001FDC ED40 5501020304050607        DB  $55,$01,$02,$03,$04,$05,$06,$07 ;@ABCDEFG
001FE4 ED48 08090A0B0C0D0E0F        DB  $08,$09,$0A,$0B,$0C,$0D,$0E,$0F ;HIJKLMNO
001FEC ED50 1011121314151617        DB  $10,$11,$12,$13,$14,$15,$16,$17 ;PQRSTUVW
001FF4 ED58 18191A52DD54507C        DB  $18,$19,$1A,$52,$DD,$54,$50,$7C ;XYZ[\]^_
001FFC ED60 5901020304050607        DB  $59,$01,$02,$03,$04,$05,$06,$07 ;`abcdefg   ATB:1
002004 ED68 08090A0B0C0D0E0F        DB  $08,$09,$0A,$0B,$0C,$0D,$0E,$0F ;hijklmno   ATB:1
00200C ED70 1011121314151617        DB  $10,$11,$12,$13,$14,$15,$16,$17 ;pqrstuvw   ATB:1
002014 ED78 18191ACB35CC705A        DB  $18,$19,$1A,$CB,$35,$CC,$70,$5A ;xyz{|}~    ATB:1
00201C ED80 415346444847B49E        DB  $41,$53,$46,$44,$48,$47,$B4,$9E ;トランプ〇●をぁ   ATB:1
002024 ED88 B2B6BABE9FB3B7BB        DB  $B2,$B6,$BA,$BE,$9F,$B3,$B7,$BB ;ぃぅぇぉゃゅょっ   ATB:1
00202C ED90 BFA385A4A5A69487        DB  $BF,$A3,$85,$A4,$A5,$A6,$94,$87 ;ーあいうえおかき   ATB:1
002034 ED98 889C829884929083        DB  $88,$9C,$82,$98,$84,$92,$90,$83 ;くけこさしすせそ   ATB:1
00203C EDA0 F0BD9DB1B5B9B49E        DB  $F0,$BD,$9D,$B1,$B5,$B9,$B4,$9E ;　。「」、・ヲァ
002044 EDA8 B2B6BABE9FB3B7BB        DB  $B2,$B6,$BA,$BE,$9F,$B3,$B7,$BB ;ィゥェォャョュッ
00204C EDB0 BFA385A4A5A69487        DB  $BF,$A3,$85,$A4,$A5,$A6,$94,$87 ;ーアイウエオカキ
002054 EDB8 889C829884929083        DB  $88,$9C,$82,$98,$84,$92,$90,$83 ;クケコサシスセソ
00205C EDC0 91819A97939589A1        DB  $91,$81,$9A,$97,$93,$95,$89,$A1 ;タチツテトナニヌ
002064 EDC8 AF8B8696A2ABAA8A        DB  $AF,$8B,$86,$96,$A2,$AB,$AA,$8A ;ネノハヒフヘホマ
00206C EDD0 8EB0AD8DA7A8A98F        DB  $8E,$B0,$AD,$8D,$A7,$A8,$A9,$8F ;ミムメモヤユヨラ
002074 EDD8 8CAEAC9BA099BCB8        DB  $8C,$AE,$AC,$9B,$A0,$99,$BC,$B8 ;リルレロワン゛゜
00207C EDE0 91819A97939589A1        DB  $91,$81,$9A,$97,$93,$95,$89,$A1 ;たちつてとねにぬ   ATB:1
002084 EDE8 AF8B8696A2ABAA8A        DB  $AF,$8B,$86,$96,$A2,$AB,$AA,$8A ;ねのはひふへほま   ATB:1
00208C EDF0 8EB0AD8DA7A8A98F        DB  $8E,$B0,$AD,$8D,$A7,$A8,$A9,$8F ;みむめもやゆよら   ATB:1
002094 EDF8 8CAEAC9BA099BCB8        DB  $8C,$AE,$AC,$9B,$A0,$99,$BC,$B8 ;りるれろわん゛゜   ATB:1
       EE00                     DC_TABLE:
00209C EE00 2041424344454647        DB  $20,$41,$42,$43,$44,$45,$46,$47 ;0
0020A4 EE08 48494A4B4C4D4E4F        DB  $48,$49,$4A,$4B,$4C,$4D,$4E,$4F
0020AC EE10 5051525354555657        DB  $50,$51,$52,$53,$54,$55,$56,$57 ;1
0020B4 EE18 58595A151A1B1411        DB  $58,$59,$5A,$15,$1A,$1B,$14,$11
0020BC EE20 3031323334353637        DB  $30,$31,$32,$33,$34,$35,$36,$37 ;2
0020C4 EE28 38392D3D3B2F2E2C        DB  $38,$39,$2D,$3D,$3B,$2F,$2E,$2C
0020CC EE30 00000000007C0000        DB  $00,$00,$00,$00,$00,$7C,$00,$00 ;3
0020D4 EE38 0000000000000000        DB  $00,$00,$00,$00,$00,$00,$00,$00
0020DC EE40 0080000083008285        DB  $00,$80,$00,$00,$83,$00,$82,$85 ;4
0020E4 EE48 843F00000000003A        DB  $84,$3F,$00,$00,$00,$00,$00,$3A
0020EC EE50 5E3C5B815D40003E        DB  $5E,$3C,$5B,$81,$5D,$40,$00,$3E ;5
0020F4 EE58 00607F0018191312        DB  $00,$60,$7F,$00,$18,$19,$13,$12
0020FC EE60 1021222324252627        DB  $10,$21,$22,$23,$24,$25,$26,$27 ;6
002104 EE68 28292B2A001C0000        DB  $28,$29,$2B,$2A,$00,$1C,$00,$00
00210C EE70 7E00000000000000        DB  $7E,$00,$00,$00,$00,$00,$00,$00 ;7
002114 EE78 171600005F000000        DB  $17,$16,$00,$00,$5F,$00,$00,$00
00211C EE80 00C19A9F9C92CA97        DB  $00,$C1,$9A,$9F,$9C,$92,$CA,$97 ;8
002124 EE88 98C6CFC9D8D3D0D7        DB  $98,$C6,$CF,$C9,$D8,$D3,$D0,$D7
00212C EE90 9EC09DC496C5CBC3        DB  $9E,$C0,$9D,$C4,$96,$C5,$CB,$C3 ;9
002134 EE98 9BDDC2DB99A2878C        DB  $9B,$DD,$C2,$DB,$99,$A2,$87,$8C
00213C EEA0 DCC7CC91939495D4        DB  $DC,$C7,$CC,$91,$93,$94,$95,$D4 ;A
002144 EEA8 D5D6CECDDAD2D9C8        DB  $D5,$D6,$CE,$CD,$DA,$D2,$D9,$C8
00214C EEB0 D1A3888D86A4898E        DB  $D1,$A3,$88,$8D,$86,$A4,$89,$8E ;B
002154 EEB8 DFA58A8FDEA18B90        DB  $DF,$A5,$8A,$8F,$DE,$A1,$8B,$90
00215C EEC0 000000000000001F        DB  $00,$00,$00,$00,$00,$00,$00,$1F ;C
002164 EEC8 00001D7B7D1E0F0E        DB  $00,$00,$1D,$7B,$7D,$1E,$0F,$0E
00216C EED0 070102030405060D        DB  $07,$01,$02,$03,$04,$05,$06,$0D ;D
002174 EED8 080A0B0C095C0000        DB  $08,$0A,$0B,$0C,$09,$5C,$00,$00
00217C EEE0 0000000000000000        DB  $00,$00,$00,$00,$00,$00,$00,$00 ;E
002184 EEE8 0000000000000000        DB  $00,$00,$00,$00,$00,$00,$00,$00
00218C EEF0 A000000000000000        DB  $A0,$00,$00,$00,$00,$00,$00,$00 ;F
002194 EEF8 0000000000000000        DB  $00,$00,$00,$00,$00,$00,$00,$00
[EOF:M7TABLE.ASM:SHIFT_JIS]
                                    INCLUDE "LDWORK.ASM"
                                
                                ;   LSX-Dodgers WORK0
                                ;
                                ;   CP/M互換BIOS
                                ;   BOOT:アドレス下位1バイトが0になるように
       EF00                     AT_WORK:
00219C EF00                         DS  WORKAD-AT_WORK
                                
       EF00                     CPM_BOOT:
00219C EF00 C30000          10      JP  0
       EF03                     _SYS00:     ;(BDOS)プログラム終了
       EF03                     CPM_WBOOT:
00219F EF03 C3FECF          10      JP  WBOOT1
       EF06                     CPM_CONST:
0021A2 EF06 C359D9          10      JP  CONSTX
       EF09                     _SYS07:     ;(BDOS)コンソール直接入力
       EF09                     CPM_CONIN:
0021A5 EF09 C3EFD8          10      JP  FLGET
       EF0C                     CPM_CONOUT:
0021A8 EF0C C305DB          10      JP  CONOUT1
                                
       EF0F                     DECBF:
0021AB EF0F                         DS  5
0021B0 EF14 00                  FDRV    DB  0
0021B1 EF15                     FNAME   DS  36
0021D5 EF39                     SFILE:  DS  33      ;DRV FILENAME
0021F6 EF5A                     HLBUF:  DS  3       ;Random record buffer
                                
0021F9 EF5D 0000                LEFTX:  DW  0
0021FB EF5F 0000                DTAX:   DW  0
                                
0021FD EF61 008E01000B000C10    BEEPD:  DB  0,08EH,1,0,00BH,0,00CH,010H
002205 EF69 073E08100D00FF          DB  007H,03EH,008H,010H,00DH,0,0FFH
                                
00220C EF70 00                  CHECK:  DB  0
                                
00220D EF71 4F4B24              OK: DB  "OK$"
002210 EF74                         DS  5
002215 EF79 4572726F722124      COMERM: DB  "Error!$"
                                ;   システムワークエリア
                                ;   _CYL0:アドレス下位1バイトが080Hになるように
00221C EF80 FF                  _CYL0:  DB  0FFH    ;Cylinder
00221D EF81 FF                  _CYL1:  DB  0FFH    ;Cylinder
00221E EF82 FF                  _CYL2:  DB  0FFH    ;Cylinder
00221F EF83 FF                  _CYL3:  DB  0FFH    ;Cylinder
002220 EF84 00                  _DRIVE: DB  0   ;unit number
002221 EF85 00                  _SEEKSP:DB  0   ;Seek speed
002222 EF86 FF                  _ISEEK: DB  0FFH    ;
002223 EF87 00                  _DVSW:  DB  0
002224 EF88 00                  _DRV:   DB  0
002225 EF89 FF                  _DSK:   DB  0FFH
002226 EF8A 8000                _DTA:   DW  00080H
002228 EF8C 0000                _CTC:   DW  0
00222A EF8E 0000                _TXADR: DW  0
00222C EF90 0000                _KEYPS: DW  0
00222E EF92 00FF                _KEYD:  DW  0FF00H  ;キーデータ
002230 EF94 C210                _KEYSP: DW  010C2H
002232 EF96 71                  _COLORF:DB  COLORF  ;色
002233 EF97 19                  _LINE:  DB  LINE
                                
002234 EF98 0000                _FCB:   DW  0
002236 EF9A 0000                _FBPS:  DW  0   ;SEARCH FILES
002238 EF9C 0000                _FBAD:  DW  0   ;    //
00223A EF9E 00                  _FBCNT: DB  0   ;    //
00223B EF9F 00                  _FILEN: DB  0
00223C EFA0 00                  _DIRF:  DB  0   ;bit7:ディレクトリ bit0-6:セクタインデックス
00223D EFA1 00                  _MAXCYL:DB  0
00223E EFA2 00                  _WTFATF:DB  0   ;FATバッファの更新フラグ
00223F EFA3                             DS  1
002240 EFA4 00                  _WTDBF: DB  0   ;データバッファの更新フラグ
002241 EFA5 FF                  _DBDRV: DB  0FFH    ;データバッファにあるデータを読み込んだドライブ
002242 EFA6 0000                _DBSEC: DW  0   ;データバッファにあるデータを読み込んだセクタ番号
002244 EFA8 0000                _DPB:   DW  0
       EFAA                     _FATDRV:
002246 EFAA FF                      DB  0FFH    ;FATバッファに読み込んでいるドライブ
002247 EFAB 00                  _FATIX: DB  0   ;FATバッファに読み込んでいるインデックス
       EFAC                     _FAKEFREE:
002248 EFAC 0000                    DW  0   ;偽の残量（FATサイズが大きくなると重くなるのでその対策）
                                
00224A EFAE                         DS  2
                                
00224C EFB0 6F2859381F02191C    CRTCD:  DB  06FH,WIDTH,059H,038H,01FH,002H,019H,01CH
002254 EFB8 0007                    DB  000H,007H
002256 EFBA 18FCD8FF                DW  0-WIDTH*LINE,0-WIDTH
00225A EFBE 0C                      DB  00CH
00225B EFBF 20                  WK1FD0: DB  020H
                                
00225C EFC0 0000                CTC0:   DW  INTCTCE
00225E EFC2 0000                CTC1:   DW  INTCTCE
002260 EFC4 0000                CTC2:   DW  INTCTC2
002262 EFC6 0000                CTC3:   DW  INTCTCE
002264 EFC8 0000                INTVEC: DW  INT
                                
                                ;   LSX-Dodgers 独自BIOS
                                
002266 EFCA C349DC          10  _INKEY: JP  INKEY
002269 EFCD C3F1D9          10  _PRINT: JP  PRINT
00226C EFD0 C3CDDC          10  _SCRN:  JP  SCRN
00226F EFD3 C3AEDB          10  _POS:   JP  POS
002272 EFD6 C3D3DA          10  _LOC:   JP  LOC
       EFD9                     _CHGDRV:
002275 EFD9 C3D0E8          10      JP  CHGDRV
       EFDC                     _GETDPB:
002278 EFDC C3A4E9          10      JP  GETDPB
       EFDF                     _FFLUSH:
00227B EFDF C3C2E9          10      JP  FFLUSH
       EFE2                     _RDFATX:
00227E EFE2 C3D5E5          10      JP  RDFATX
002281 EFE5 C3FDE6          10  _RDFAT: JP  RDFAT
002284 EFE8 C387EA          10  _WTTRK: JP  WTTRK
002287 EFEB C3EAEA          10  _FDRD:  JP  FDRD
00228A EFEE C38DEA          10  _FDWT:  JP  FDWT
       EFF1                     _BPB2DPB:
00228D EFF1 C362E7          10      JP  BPB2DPB
002290 EFF4                         DS  3
       EFF7                     _GNCL:
002293 EFF7 C377E6          10  GNCPAT: JP  GNCL        ; self-modifying code
       EFFA                     _SNCL:
002296 EFFA C39AE6          10  SNCPAT: JP  SNCL        ; self-modifying code
002299 EFFD C33FD0          10  _COMANL:JP  COMANL
                                
       F000                     _WE:
[EOF:LDWORK.ASM:SHIFT_JIS]
                                    INCLUDE "LDCALL.ASM"
                                
                                ;   LSX-Dodgers システムコール(BDOS)
                                ;
                                ;   LSX-Dodgers SYSTEM CALL
                                ;   STABLE:アドレス下位1バイトが0になるように
                                
       F000                     STABLE:
                                ;0
00229C F000 03EFC3D8CFD8A2DE        DW  _SYS00,_SYS01,_SYS02,_SYS03
0022A4 F008 D7D5D7D5D4D809EF        DW  _SYS04,_SYS05,_SYS06,_SYS07
0022AC F010 DCD8D9D525D951D9        DW  _SYS08,_SYS09,_SYS0A,_SYS0B
0022B4 F018 EED5F3D502D615D6        DW  _SYS0C,_SYS0D,_SYS0E,_SYS0F
                                ;1
0022BC F020 69D6B0D6F9D62FD7        DW  _SYS10,_SYS11,_SYS12,_SYS13
0022C4 F028 37D755D772D76AD7        DW  _SYS14,_SYS15,_SYS16,_SYS17
0022CC F030 CDD7D2D7D7D7DDD7        DW  _SYS18,_SYS19,_SYS1A,_SYS1B
0022D4 F038 D7D503D8D7D507D8        DW  _SYS1C,_SYS1D,_SYS1E,_SYS1F
                                ;2
0022DC F040 D7D5A9D7BBD70ED8        DW  _SYS20,_SYS21,_SYS22,_SYS23
0022E4 F048 3AD8D7D50DE3EFE3        DW  _SYS24,_ERROR,_SYS26,_SYS27
0022EC F050 BBD743D86AD9A2DE        DW  _SYS28,_SYS5C,_SYS2A,_SYS2B
0022F4 F058 72D9A2DED7D566D8        DW  _SYS2C,_SYS2D,_SYS2E,_SYS2F
                                ;3
0022FC F060 60D8D7D5D7D5D7D5        DW  _SYS30,_ERROR,_ERROR,_ERROR
002304 F068 D7D5D7D5D7D5D7D5        DW  _ERROR,_ERROR,_ERROR,_ERROR
00230C F070 D7D5A2DEA2DE87D8        DW  _ERROR,_SYS39,_SYS3A,_SYS5A
                                ;DOS2
002314 F078 BAD5                    DW  _DOS2
                                
002316 F07A                         DS  2
002318 F07C 00F2                _FATBF: DW  FATBF
00231A F07E 00FA                _DTBUF: DW  DTBUF
                                
                                ;   コントロールコードテーブル
                                ;   CTRLTB:アドレス下位1バイトが080Hになるように
                                
       F080                     CTRLTB:
00231C F080 56DA56DA8CDA81DB        DW  CTRL00,CTRL00,CTRL02,CTRL03 ;  A,B,C
002324 F088 7BDBB8DA6CDB15DB        DW  CTRL04,CTRL05,CTRL06,CTRL07 ;D,E,F,G
00232C F090 62DA7DDA84DBE6DA        DW  CTRL08,CTRL09,CTRL0A,CTRL0B ;H,I,J,K
002334 F098 69DBCEDA96DB56DA        DW  CTRL0C,CTRL0D,CTRL0E,CTRL00 ;L,M,N,O
00233C F0A0 56DA56DADEDA56DA        DW  CTRL00,CTRL00,CTRL12,CTRL00 ;P,Q,R,S
002344 F0A8 56DA56DA56DA56DA        DW  CTRL00,CTRL00,CTRL00,CTRL00 ;T,U,V,W
00234C F0B0 56DA56DA69DBEDDA        DW  CTRL00,CTRL00,CTRL0C,CTRL1B ;X,Y,Z,ESC
002354 F0B8 45DA69DA72DA84DB        DW  CTRL1C,CTRL1D,CTRL1E,CTRL1F ;→,←,↑,↓
                                
00235C F0C0 0307                DEMES:  DB  3,7
00235E F0C2 4465766963652049        DB  "Device I/O Error",5,3
            2F4F204572726F72    
            0503                
002370 F0D4 41626F7274205265        DB  "Abort Retry Ignore?",5,3,0
            7472792049676E6F    
            72653F050300        
                                
002386 F0EA 1617                SDDATA: DB  22,23       ;(FCB)ファイルを最後に変更した時刻
002388 F0EC 1415                    DB  20,21       ;(FCB)ファイルを最後に変更した日付
00238A F0EE 1A1B                    DB  26,27       ;(FCB)ファイルの先頭クラスタ
00238C F0F0 10111213                DB  16,17,18,19 ;(FCB)ファイルのサイズ(バイト単位)
       F0F4                     SDDATAE:
                                
002390 F0F4                     SCDIR:  DS  2       ;+14 +15
002392 F0F6                     SFBPS:  DS  2       ;FBPS
002394 F0F8                     SFNDF:  DS  2       ;FILEN DIRF
                                
002396 F0FA 0000                _FATPS: DW  0
002398 F0FC 0000                _DIRPS: DW  0
00239A F0FE 0000                _CLPS:  DW  0
                                
       F100                     _PE:
[EOF:LDCALL.ASM:SHIFT_JIS]
                                    INCLUDE "M7DPB.ASM"
                                
                                ;   LSX-Dodgers DPB
                                ;   MZ-700/1500
                                
       F100                     DEVICE:
                                
                                ;   A:
                                
00239C F100 0200                    DW  2   ;DPB_00_FATLN
00239E F102 EBEF                    DW  _FDRD   ;DPB_02_DRD
0023A0 F104 EEEF                    DW  _FDWT   ;DPB_04_DWT
0023A2 F106 FD                      DB  0FDH    ;DPB_06_FATID
0023A3 F107 02                      DB  2   ;DPB_07_SECPCL
0023A4 F108 6401                    DW  356 ;DPB_08_MAXCL
0023A6 F10A FF                      DB  0FFH    ;DPB_0A_FDMODE  0FFH=2D / 0FEH=2HD
0023A7 F10B 07                      DB  7   ;DPB_0B_DIRSCNT
0023A8 F10C 28                      DB  40  ;DPB_0C_MAXCYL
0023A9 F10D 09                      DB  9   ;DPB_0D_MAXSEC  Number of sectors
0023AA F10E 01                      DB  1   ;DPB_0E_FATPS
0023AB F10F 82                      DB  082H    ;DPB_0F_BPS
0023AC F110 0500                    DW  5   ;DPB_10_DIRPS
0023AE F112 27                      DB  027H    ;DPB_12_DEVICE  Device Number
0023AF F113 00                      DB  0   ;DPB_13_UNITNO
0023B0 F114 0800                    DW  8   ;DPB_14_ADDCL16
0023B2 F116 0000                    DW  0   ;DPB_16
0023B4 F118 0000                    DW  0   ;DPB_18
0023B6 F11A 0000                    DW  0   ;DPB_1A_SDIR
0023B8 F11C 46444430                DB  "FDD0"  ;DPB_1C_NAME
                                
                                ;   B:
                                
0023BC F120 0200                    DW  2   ;DPB_00_FATLN
0023BE F122 EBEF                    DW  _FDRD   ;DPB_02_DRD
0023C0 F124 EEEF                    DW  _FDWT   ;DPB_04_DWT
0023C2 F126 FD                      DB  0FDH    ;DPB_06_FATID
0023C3 F127 02                      DB  2   ;DPB_07_SECPCL
0023C4 F128 6401                    DW  356 ;DPB_08_MAXCL
0023C6 F12A FF                      DB  0FFH    ;DPB_0A_FDMODE  0FFH=2D / 0FEH=2HD
0023C7 F12B 07                      DB  7   ;DPB_0B_DIRSCNT
0023C8 F12C 28                      DB  40  ;DPB_0C_MAXCYL
0023C9 F12D 09                      DB  9   ;DPB_0D_MAXSEC  Number of sectors
0023CA F12E 01                      DB  1   ;DPB_0E_FATPS
0023CB F12F 82                      DB  082H    ;DPB_0F_BPS
0023CC F130 0500                    DW  5   ;DPB_10_DIRPS
0023CE F132 27                      DB  027H    ;DPB_12_DEVICE  Device Number
0023CF F133 01                      DB  1   ;DPB_13_UNITNO
0023D0 F134 0800                    DW  8   ;DPB_14_ADDCL16
0023D2 F136 0000                    DW  0   ;DPB_16
0023D4 F138 0000                    DW  0   ;DPB_18
0023D6 F13A 0000                    DW  0   ;DPB_1A_SDIR
0023D8 F13C 46444431                DB  "FDD1"  ;DPB_1C_NAME
                                
                                ;   C:
                                
0023DC F140 0100                    DW  1   ;DPB_00_FATLN
0023DE F142 E1EB                    DW  CDRD    ;DPB_02_DRD
0023E0 F144 CDEB                    DW  CDWT    ;DPB_04_DWT
0023E2 F146 FA                      DB  0FAH    ;DPB_06_FATID
0023E3 F147 01                      DB  1   ;DPB_07_SECPCL
0023E4 F148 7A00                    DW  122 ;DPB_08_MAXCL
0023E6 F14A 00                      DB  0   ;DPB_0A_FDMODE
0023E7 F14B 06                      DB  6   ;DPB_0B_DIRSCNT
0023E8 F14C 00                      DB  0   ;DPB_0C_MAXCYL
0023E9 F14D 00                      DB  0   ;DPB_0D_MAXSEC
0023EA F14E 01                      DB  1   ;DPB_0E_FATPS
0023EB F14F 01                      DB  1   ;DPB_0F_BPS
0023EC F150 0200                    DW  2   ;DPB_10_DIRPS
0023EE F152 0C                      DB  00CH    ;DPB_12_DEVICE
0023EF F153 F8                      DB  0F8H    ;DPB_13_UNITNO
0023F0 F154 0600                    DW  6   ;DPB_14_ADDCL16
0023F2 F156 0000                    DW  0   ;DPB_16
0023F4 F158 0000                    DW  0   ;DPB_18
0023F6 F15A 0000                    DW  0   ;DPB_1A_SDIR
0023F8 F15C 434D4F53                DB  "CMOS"  ;DPB_1C_NAME
                                
                                ;   D:
                                
0023FC F160                         DS  32
                                
                                ;   E:
                                
00241C F180 0000                    DW  0   ;DPB_00_FATLN
00241E F182 98EB                    DW  EDRD    ;DPB_02_DRD
002420 F184 8BEB                    DW  EDWT    ;DPB_04_DWT
002422 F186 FA                      DB  0FAH    ;DPB_06_FATID
002423 F187 02                      DB  2   ;DPB_07_SECPCL
002424 F188 0000                    DW  0   ;DPB_08_MAXCL
002426 F18A 00                      DB  0   ;DPB_0A_FDMODE
002427 F18B 10                      DB  16  ;DPB_0B_DIRSCNT
002428 F18C 00                      DB  0   ;DPB_0C_MAXCYL
002429 F18D 00                      DB  0   ;DPB_0D_MAXSEC
00242A F18E 01                      DB  1   ;DPB_0E_FATPS
00242B F18F 01                      DB  1   ;DPB_0F_BPS
00242C F190 0000                    DW  0   ;DPB_10_DIRPS
00242E F192 26                      DB  026H    ;DPB_12_DEVICE
00242F F193 00                      DB  0   ;DPB_13_UNITNO
002430 F194 0000                    DW  0   ;DPB_14_ADDCL16
002432 F196 0000                    DW  0   ;DPB_16
002434 F198 0000                    DW  0   ;DPB_18
002436 F19A 0000                    DW  0   ;DPB_1A_SDIR
002438 F19C 454D4D30                DB  "EMM0"  ;DPB_1C_NAME
                                
                                ;   F:
                                
00243C F1A0 0200                    DW  2   ;DPB_00_FATLN
00243E F1A2 05EC                    DW  RDRD    ;DPB_02_DRD
002440 F1A4 F4EB                    DW  RDWT    ;DPB_04_DWT
002442 F1A6 FA                      DB  0FAH    ;DPB_06_FATID
002443 F1A7 01                      DB  1   ;DPB_07_SECPCL
002444 F1A8 F600                    DW  246 ;DPB_08_MAXCL
002446 F1AA 00                      DB  0   ;DPB_0A_FDMODE
002447 F1AB 09                      DB  9   ;DPB_0B_DIRSCNT
002448 F1AC 00                      DB  0   ;DPB_0C_MAXCYL
002449 F1AD 00                      DB  0   ;DPB_0D_MAXSEC
00244A F1AE 01                      DB  1   ;DPB_0E_FATPS
00244B F1AF 01                      DB  1   ;DPB_0F_BPS
00244C F1B0 0300                    DW  3   ;DPB_10_DIRPS
00244E F1B2 0F                      DB  00FH    ;DPB_12_DEVICE
00244F F1B3 00                      DB  0   ;DPB_13_UNITNO
002450 F1B4 0A00                    DW  10  ;DPB_14_ADDCL16
002452 F1B6 0000                    DW  0   ;DPB_16
002454 F1B8 0000                    DW  0   ;DPB_18
002456 F1BA 0000                    DW  0   ;DPB_1A_SDIR
002458 F1BC 52414D46                DB  "RAMF"  ;DPB_1C_NAME
                                
                                ;   G:
                                
00245C F1C0                         DS  32
                                
                                ;   H:
00247C F1E0                         DS  31
00249B F1FF 00                      DB  0
[EOF:M7DPB.ASM:UTF_8]
                                
       A49C                         ORG $$+OFFSET   ;$DEPHASE
       A49C                     LAST_ADR:
                                
                                    END
[EOF:M7.ASM:UTF_8]
