                                ;*** AILZ80ASM *** Z-80 Assembler, version 1.0.0.0, LST:Full:4
                                ;   LSX-Dodgers for MZ-700/1500
                                ;   Programmed by
                                ;   Gaku (Lovers/Tablacus)
                                
                                    INCLUDE "M7DEF.ASM"
                                
                                ;   LSX-Dodgers DEF
                                ;   MZ-700/1500
                                
       0001                     MAC EQU 1   ;MZ-700/1500
       0000                     DEV EQU 0
                                
       011D                     VER_6F  EQU 0011DH
       00A0                     NBSP    EQU 0A0H
                                
       8080                     RUN EQU 08080H
       8000                     OFFSET  EQU RUN-128
       CF06                     BDOS    EQU 0CF06H
       ED40                     TABLEAD EQU 0ED40H
       F000                     WORKAD  EQU 0F000H
       F300                     FATBF   EQU 0F300H
       FB00                     DTBUF   EQU 0FB00H
       FF00                     KEYBF   EQU 0FF00H
       FF20                     KBUF    EQU 0FF20H
       FFD9                     TRAP38  EQU 0FFD9H
       0028                     WIDTH   EQU 40
       0019                     LINE    EQU 25
       0070                     COLORF  EQU 070H
       0010                     KEYSP_H EQU 16
       0083                     KEYSP_L EQU 131
       000A                     COMS    EQU 10
[EOF:M7DEF.ASM:UTF_8]
                                    INCLUDE "LDDEF.ASM"
                                
                                ;   LSX-Dodgers DEF
                                
       0001                     VER_1   EQU 1
       0005                     VER_2   EQU 5
       0007                     VER_3   EQU 7
       1D01                     MACW    EQU MAC + 01D00H    ;機種フラグとLD判別フラグ
       0001                     MACD    EQU MAC + DEV * 256 ;機種フラグとデバイスフラグ
       0157                     VER EQU VER_1 * 256 + VER_2 * 16 + VER_3
                                
       0005                     SYSTEM  EQU 00005H
       000F                     JP_HL   EQU 0000FH
       005C                     FCB1    EQU 0005CH
       006C                     FCB2    EQU 0006CH
       005D                     FCB1FN  EQU FCB1+1
       006D                     FCB2FN  EQU FCB2+1
       0080                     DTA1    EQU 00080H
                                
       FFCA                     EXTBIO  EQU 0FFCAH
                                
       0000                     DPB_FATLN   EQU 00H
       0002                     DPB_DRD     EQU 02H
       0004                     DPB_DWT     EQU 04H
       0006                     DPB_FATID   EQU 06H
       0007                     DPB_SECPCL  EQU 07H
       0008                     DPB_MAXCL   EQU 08H
       000A                     DPB_FDMODE  EQU 0AH
       000B                     DPB_DIRSCNT EQU 0BH
       000C                     DPB_MAXCYL  EQU 0CH
       000D                     DPB_MAXSEC  EQU 0DH
       000E                     DPB_FATPS   EQU 0EH
       000F                     DPB_BPS     EQU 0FH
       0010                     DPB_DIRPS   EQU 10H
       0012                     DPB_DEVICE  EQU 12H
       0013                     DPB_UNITNO  EQU 13H
       0014                     DPB_ADDCL   EQU 14H
                                
       001A                     DPB_SDIR    EQU 1AH
       001C                     DPB_NAME    EQU 1CH
                                
[EOF:LDDEF.ASM:SHIFT_JIS]
                                
000000 8000                         ORG OFFSET
                                                    ;MZTヘッダ128バイト
000000 8000 01                      DB  1           ;ファイルモード
000001 8001 4C44202020202020        DB  "LD           "     ;ファイル名(13)
            2020202020          
00000E 800E 535953                  DB  "SYS"           ;拡張子(3)
000011 8011 0D                      DB  $0D
000012 8012 EB24                    DW  LAST_ADR-RUN        ;サイズ
000014 8014 8080                    DW  RUN         ;開始アドレス
000016 8016 8080                    DW  RUN         ;実行アドレス
000018 8018                         DS  104
                                
                                    INCLUDE "M7INIT.ASM"
                                
                                ;   LSX-Dodgers INIT
                                ;   MZ-700/1500
                                
000080 8080 C38780          10      JP  START
000083 8083 011D                    DW  MACW
000085 8085 5701                    DW  VER
                                
       8087                     START:
000087 8087 F3               4      DI
000088 8088 ED56             8      IM  1
00008A 808A 318780          10      LD  SP,START
00008D 808D CD9B80          17      CALL    INIT        ;NZならAUTOEXECを実行
000090 8090 210000          10      LD  HL,0
000093 8093 E5              11      PUSH    HL
000094 8094 C8              11      RET Z
000095 8095 112881          10      LD  DE,AUTOD
000098 8098 C3FDF0          10      JP  _COMANL
                                
       809B                     INIT:
00009B 809B D3E0            11      OUT (0E0H),A    ;DRAM(0000H-0FFFH)
00009D 809D D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
00009F 809F 218D81          10      LD  HL,INITE
0000A2 80A2 1106CF          10      LD  DE,BDOS
0000A5 80A5 01DE23          10      LD  BC,LAST_ADR-INITE
0000A8 80A8 EDB0                    LDIR
0000AA 80AA 215E81          10      LD  HL,M7BEEPD
0000AD 80AD 1162F0          10      LD  DE,BEEPD+1
0000B0 80B0 010800          10      LD  BC,M7BEEPE-M7BEEPD
0000B3 80B3 EDB0                    LDIR
                                
0000B5 80B5 210000          10      LD  HL,0
0000B8 80B8 065C             7      LD  B,05CH
0000BA 80BA 3EEF             7      LD  A,0EFH      ;RST 28H
0000BC 80BC CDEEDC          17      CALL    FILL_MEMORY
0000BF 80BF 06A4             7      LD  B,0A4H
0000C1 80C1 AF               4      XOR A
0000C2 80C2 CDEEDC          17      CALL    FILL_MEMORY
                                
0000C5 80C5 3EC3             7      LD  A,0C3H      ;JP
0000C7 80C7 2103F0          10      LD  HL,CPM_WBOOT
0000CA 80CA 320000          13      LD  (00000H),A
0000CD 80CD 220100          16      LD  (00001H),HL ;IPL
                                
0000D0 80D0 21011D          10      LD  HL,MACW     ;3 bit7  DPB Compatible LA(1)
0000D3 80D3 220300          16      LD  (00003H),HL ;  bit6-0 Machine
                                ;               ;4 LSX-Dodgers(01DH)
0000D6 80D6 2106CF          10      LD  HL,BDOS
0000D9 80D9 320500          13      LD  (00005H),A
0000DC 80DC 220600          16      LD  (00006H),HL ;BDOS
                                
0000DF 80DF 21D9FF          10      LD  HL,TRAP38   ;TRAP38
0000E2 80E2 322800          13      LD  (00028H),A
0000E5 80E5 222900          16      LD  (00029H),HL ;RST 028H
                                
0000E8 80E8 323800          13      LD  (00038H),A
0000EB 80EB 210ECF          10      LD  HL,IO_INT8253
0000EE 80EE 223900          16      LD  (00039H),HL
                                
0000F1 80F1 3EF0             7      LD  A,CPM_BOOT/256
0000F3 80F3 320B00          13      LD  (0000BH),A
                                
0000F6 80F6 3EE9             7      LD  A,0E9H      ;JP (HL)
0000F8 80F8 320F00          13      LD  (0000FH),A
                                
0000FB 80FB 213481          10      LD  HL,INIMES
0000FE 80FE CD51D5          17      CALL    MSX
       8101                     INIT1:
000101 8101 F3               4      DI
000102 8102 1100FF          10      LD  DE,0FF00H
000105 8105 0600             7      LD  B,0
000107 8107 CDA4D3          17      CALL    ZERO_MEMORY_DE
00010A 810A 21CAFF          10      LD  HL,EXTBIO
00010D 810D 36C9            10      LD  (HL),0C9H   ;RET
00010F 810F 23               6      INC HL
000110 8110 060E             7      LD  B,TRAP38-EXTBIO-1
000112 8112 3EEF             7      LD  A,0EFH      ;RST 28H
000114 8114 CDEEDC          17      CALL    FILL_MEMORY
000117 8117 216681          10      LD  HL,AT_TRAP38
00011A 811A 11D9FF          10      LD  DE,TRAP38
00011D 811D 012700          10      LD  BC,AT_TRAPE-AT_TRAP38
000120 8120 EDB0                    LDIR
                                
000122 8122 CDC9DB          17      CALL    CHKEY
000125 8125 FE03             7      CP  3
000127 8127 C9              10      RET
                                
000128 8128 4155544F45584543    AUTOD:  DB  "AUTOEXEC "
            20                  
000131 8131 413A00              AUTODV: DB  "A:",0
                                
000134 8134 0C4C53582D446F64    INIMES: DB  00CH,"LSX-Dodgers for MZ-700/1500 v"
            6765727320666F72    
            204D5A2D3730302F    
            313530302076        
000152 8152 312E                    DB  030H + VER_1, '.'
000154 8154 3537                    DB  030H + VER_2 ,030H + VER_3
                                ;   DB  ""
000156 8156 2047616B750D0A          DB  ' Gaku',0DH,0AH
00015D 815D 00                      DB  0
                                
       815E                     M7BEEPD:
00015E 815E 0801                    DB  8,1
000160 8160 0736                    DB  7,036H
000162 8162 04F9                    DB  4,0F9H
000164 8164 0403                    DB  4,3
       8166                     M7BEEPE:
                                
       8166                     AT_TRAP38:
000166 FFD9                         ORG TRAP38,AT_TRAP38-OFFSET
000166 FFD9 210000          10      LD  HL,0
000169 FFDC E3              19      EX  (SP),HL
00016A FFDD 3E24             7      LD  A,'$'
00016C FFDF CD32D8          17      CALL    MSG_A
00016F FFE2 2B               6      DEC HL
000170 FFE3 7C               4      LD  A,H
000171 FFE4 CDE8FF          17      CALL    PRHX
000174 FFE7 7D               4      LD  A,L
       FFE8                     PRHX:
000175 FFE8 F5              11      PUSH    AF
000176 FFE9 07               4      RLCA
000177 FFEA 07               4      RLCA
000178 FFEB 07               4      RLCA
000179 FFEC 07               4      RLCA
00017A FFED CDF1FF          17      CALL    PRHX2
00017D FFF0 F1              10      POP AF
       FFF1                     PRHX2:
00017E FFF1 E60F             7      AND 00FH
000180 FFF3 FE0A             7      CP  10
000182 FFF5 3F               4      CCF
000183 FFF6 CE30             7      ADC A,'0'
000185 FFF8 27               4      DAA
000186 FFF9 C332D8          10      JP  MSG_A
000189 FFFC                         DS  4
       818D                         ORG $$+OFFSET   ;$DEPHASE
       818D                     AT_TRAPE:
                                
       818D                     INITE:
00018D CF06                         ORG BDOS,INITE-OFFSET
                                
00018D CF06 C309CF          10      JP  IO_BDOS
[EOF:M7INIT.ASM:SHIFT_JIS]
                                    INCLUDE "M7BANK.ASM"
                                
                                ;   LSX-Dodgers IO
                                ;   MZ-700/1500
                                ;   VRAM/KEY/TIMER(0D000H-0EFFFH)にアクセスするので0D000H-0FFFFHに置けない部分
                                ;
                                
       CF09                     IO_BDOS:
000190 CF09 D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
000192 CF0B C310D5          10      JP  BDOS0
                                
       CF0E                     IO_INT8253:
000195 CF0E F3               4      DI
000196 CF0F F5              11      PUSH    AF
000197 CF10 D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
000199 CF12 3E01             7      LD  A,1
00019B CF14 3206E0          13      LD  (0E006H),A  ;8253 Ch.2 カウンタ
00019E CF17 AF               4      XOR A
00019F CF18 3206E0          13      LD  (0E006H),A  ;8253 Ch.2 カウンタ
0001A2 CF1B D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
0001A4 CF1D C3E1D7          10      JP  INT8253 
                                
       CF20                     RDKEYDATA:
0001A7 CF20 F3               4      DI
0001A8 CF21 D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
0001AA CF23 3200E0          13      LD  (0E000H),A
0001AD CF26 3A01E0          13      LD  A,(E001H)
0001B0 CF29 D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
0001B2 CF2B FB               4      EI
0001B3 CF2C C9              10      RET
                                
       CF2D                     RD556VSYNC:
0001B4 CF2D F3               4      DI
0001B5 CF2E D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
0001B7 CF30 3A02E0          13      LD  A,(0E002H)
0001BA CF33 D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
0001BC CF35 FB               4      EI
0001BD CF36 C9              10      RET
                                
       CF37                     RDMMIO:
0001BE CF37 F3               4      DI
0001BF CF38 D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
0001C1 CF3A 7E               7      LD  A,(HL)
0001C2 CF3B D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
0001C4 CF3D FB               4      EI
0001C5 CF3E C9              10      RET
                                
       CF3F                     WRMMIO:
0001C6 CF3F F3               4      DI
0001C7 CF40 D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
0001C9 CF42 77               7      LD  (HL),A
0001CA CF43 D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
0001CC CF45 FB               4      EI
0001CD CF46 C9              10      RET
                                
       CF47                     RDMMIO_BC:
0001CE CF47 F3               4      DI
0001CF CF48 D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
0001D1 CF4A 0A               7      LD  A,(BC)
0001D2 CF4B D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
0001D4 CF4D FB               4      EI
0001D5 CF4E C9              10      RET
                                
       CF4F                     WRMMIO_BC:
0001D6 CF4F F3               4      DI
0001D7 CF50 D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
0001D9 CF52 02               7      LD  (BC),A
0001DA CF53 D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
0001DC CF55 FB               4      EI
0001DD CF56 C9              10      RET
                                
       CF57                     IO_PRINT:
0001DE CF57 F3               4      DI
0001DF CF58 D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
0001E1 CF5A 77               7      LD  (HL),A
0001E2 CF5B CBDC             8      SET 3,H
0001E4 CF5D 71               7      LD  (HL),C
0001E5 CF5E D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
0001E7 CF60 FB               4      EI
0001E8 CF61 C9              10      RET
                                
       CF62                     IO_CLR:
0001E9 CF62 F3               4      DI
0001EA CF63 D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
       CF65                     C1AX1:
0001EC CF65 7A               4      LD  A,D
0001ED CF66 C6D0             7      ADD A,0D0H
0001EF CF68 57               4      LD  D,A
0001F0 CF69 AF               4      XOR A
0001F1 CF6A 12               7      LD  (DE),A      ;Text
0001F2 CF6B CBDA             8      SET 3,D
       CF6E                     ICSMC   EQU $+1
0001F4 CF6D 3E00             7      LD  A,0     ;自己書き換え
0001F6 CF6F 12               7      LD  (DE),A      ;Color
0001F7 CF70 13               6      INC DE
0001F8 CF71 7A               4      LD  A,D
0001F9 CF72 D6D8             7      SUB 0D8H
0001FB CF74 57               4      LD  D,A
0001FC CF75 2118FC          10      LD  HL,0-WIDTH*LINE
0001FF CF78 19              11      ADD HL,DE
000200 CF79 30EA            12      JR  NC,C1AX1
000202 CF7B E1              10      POP HL
000203 CF7C D1              10      POP DE
000204 CF7D D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
000206 CF7F FB               4      EI
000207 CF80 C9              10      RET
                                
       CF81                     IO_CLLINE:
000208 CF81 F3               4      DI
000209 CF82 D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
       CF84                     CLLINE1:
00020B CF84 CB9C             8      RES 3,H
00020D CF86 77               7      LD  (HL),A      ;Text
00020E CF87 CBDC             8      SET 3,H
000210 CF89 71               7      LD  (HL),C      ;Color
000211 CF8A 23               6      INC HL
000212 CF8B 10F7            13      DJNZ    CLLINE1
000214 CF8D D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
000216 CF8F FB               4      EI
000217 CF90 C9              10      RET
                                
       CF91                     IO_INS:
000218 CF91 F3               4      DI
000219 CF92 D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
       CF94                     IO_INS1:
00021B CF94 CDABCF          17      CALL    C12S
00021E CF97 23               6      INC HL
00021F CF98 10FA            13      DJNZ    IO_INS1
000221 CF9A D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
000223 CF9C FB               4      EI
000224 CF9D C9              10      RET
                                
       CF9E                     IO_BS:
000225 CF9E F3               4      DI
000226 CF9F D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
       CFA1                     IO_BS1:
000228 CFA1 CDABCF          17      CALL    C12S
00022B CFA4 2B               6      DEC HL
00022C CFA5 10F7            13      DJNZ    IO_BS
00022E CFA7 D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
000230 CFA9 FB               4      EI
000231 CFAA C9              10      RET
                                
       CFAB                     C12S:
000232 CFAB CB9C             8      RES 3,H
000234 CFAD 5E               7      LD  E,(HL)
000235 CFAE 77               7      LD  (HL),A
000236 CFAF 7B               4      LD  A,E
000237 CFB0 CBDC             8      SET 3,H
000239 CFB2 5E               7      LD  E,(HL)
00023A CFB3 71               7      LD  (HL),C
00023B CFB4 4B               4      LD  C,E
00023C CFB5 C9              10      RET
                                
       CFB6                     IO_SCRUP:
00023D CFB6 F3               4      DI
00023E CFB7 D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
       CFB9                     SCRUP1:
000240 CFB9 2815            12      JR  Z,SCRCL
000242 CFBB D5              11      PUSH    DE
000243 CFBC E5              11      PUSH    HL
000244 CFBD CBDA             8      SET 3,D
000246 CFBF CBDC             8      SET 3,H
000248 CFC1 012800          10      LD  BC,WIDTH
00024B CFC4 EDB0                    LDIR
00024D CFC6 E1              10      POP HL
00024E CFC7 D1              10      POP DE
00024F CFC8 012800          10      LD  BC,WIDTH
000252 CFCB EDB0                    LDIR
000254 CFCD 3D               4      DEC A
000255 CFCE 18E9            12      JR  SCRUP1
                                
       CFD0                     SCRCL:
000257 CFD0 0628             7      LD  B,WIDTH
000259 CFD2 EB               4      EX  DE,HL
00025A CFD3 D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
00025C CFD5 CD2CDA          17      CALL    CLLINE
00025F CFD8 E1              10      POP HL
000260 CFD9 D1              10      POP DE
000261 CFDA C1              10      POP BC
000262 CFDB C9              10      RET
                                
       CFDC                     C_MON:
000263 CFDC D3E4            11      OUT (0E4H),A    ;MONITOR ROM(0000H-0FFFH) & VRAM/KEY/TIMER(D000H-FFFFH)
000265 CFDE C7              12      RST 0
                                
       CFDF                     INITINT:
000266 CFDF D3E3            11      OUT (0E3H),A    ;VRAM/KEY/TIMER(D000H-FFFFH)
000268 CFE1 2107E0          10      LD  HL,0E007H   ;HL=0E007H 8253 コントロール
00026B CFE4 36B0            10      LD  (HL),0B0H   ;Ch.2 カウンタの下位バイト→上位バイトの順に連続してアクセス Mode 0 16ビットバイナリ
00026D CFE6 3674            10      LD  (HL),074H   ;Ch.1 カウンタの下位バイト→上位バイトの順に連続してアクセス Mode 2 16ビットバイナリ
00026F CFE8 2D               4      DEC L       ;0E006H 8253 Ch.2 カウンタ
000270 CFE9 3602            10      LD  (HL),2
000272 CFEB 3600            10      LD  (HL),0
000274 CFED 2D               4      DEC L       ;0E005H 8253 Ch.1 カウンタ
000275 CFEE 77               7      LD  (HL),A
000276 CFEF 3600            10      LD  (HL),0
000278 CFF1 3E05             7      LD  A,5
00027A CFF3 3203E0          13      LD  (0E003H),A  ;8255 コントロールポートでポートC(0E002H)のINTMSKを1にする
00027D CFF6 D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)
00027F CFF8 C9              10      RET
                                
       CFF9                     BANKE:
000280 CFF9                         DS  0CFFEH-BANKE
[EOF:M7BANK.ASM:SHIFT_JIS]
                                    INCLUDE "M7CCP.ASM"
                                
                                ;   LSX-Dodgers CCP
                                ;   MZ-700/1500
                                
       CFFE                     WBOOT1:
000285 CFFE D3E1            11      OUT (0E1H),A    ;DRAM(D000H-FFFFH)　ここは0CFFEH
000287 D000 D3E0            11      OUT (0E0H),A    ;DRAM(0000H-0FFHH)
000289 D002 F3               4      DI
00028A D003 3A94F0          13      LD  A,(_KEYSP)
00028D D006 CDDFCF          17      CALL    INITINT
000290 D009 ED7B0600        20      LD  SP,(SYSTEM+1)
000294 D00D FB               4      EI
000295 D00E 2192F0          10      LD  HL,_KEYD
000298 D011 3600            10      LD  (HL),0
00029A D013 CDC9DB          17      CALL    CHKEY
00029D D016 CD1FD8          17      CALL    KEYBC_IFBREAK
0002A0 D019 3E04             7      LD  A,4
0002A2 D01B CD32D8          17      CALL    MSG_A
[EOF:M7CCP.ASM:UTF_8]
                                    INCLUDE "LDCCP.ASM"
                                
                                ;   LSX-Dodgers CCP
                                
       D01E                     COMMAND:
0002A5 D01E 3A0CEC          13      LD  A,(FCB_BAT)
0002A8 D021 B7               4      OR  A
0002A9 D022 C263D1          10      JP  NZ,C_BAT1
0002AC D025 CDD8D0          17      CALL    SETDTA1
0002AF D028 3A87F0          13      LD  A,(_DVSW)
0002B2 D02B C641             7      ADD A,'A'
0002B4 D02D CD32D8          17      CALL    MSG_A
0002B7 D030 3E3E             7      LD  A,'>'
0002B9 D032 CD32D8          17      CALL    MSG_A
0002BC D035 3E50             7      LD  A,80
0002BE D037 12               7      LD  (DE),A
0002BF D038 CD92D8          17      CALL    _SYS0A      ;(BDOS)文字列入力
0002C2 D03B CD66D2          17      CALL    LTNL
       D03E                     COMMAND2:
0002C5 D03E 118200          10      LD  DE,DTA1+2
0002C8 D041 CDFDF0          17      CALL    _COMANL
0002CB D044 30D8            12      JR  NC,COMMAND
0002CD D046 1179F0          10      LD  DE,COMERM
0002D0 D049 CD42D5          17      CALL    _SYS09      ;(BDOS)文字列出力
0002D3 D04C C7              12      RST 0
                                
       D04D                     COMANL:
0002D4 D04D CD42DC          17      CALL    FILE
0002D7 D050 3A19F0          13      LD  A,(FNAME+4)
0002DA D053 FE20             7      CP  020H
0002DC D055 201C            12      JR  NZ,COMB2
0002DE D057 D5              11      PUSH    DE
0002DF D058 1115F0          10      LD  DE,FNAME
0002E2 D05B 1A               7      LD  A,(DE)
0002E3 D05C FE20             7      CP  020H
0002E5 D05E 2844            12      JR  Z,SDVSW
0002E7 D060 1B               6      DEC DE
0002E8 D061 1A               7      LD  A,(DE)
0002E9 D062 C6FF             7      ADD A,0FFH
0002EB D064 3809            12      JR  C,COMB
0002ED D066 13               6      INC DE
                                
0002EE D067 21D4D4          10      LD  HL,COMTB
0002F1 D06A 060A             7      LD  B,COMS
0002F3 D06C CDC6DE          17      CALL    CPNAME
       D06F                     COMB:
0002F6 D06F D1              10      POP DE
0002F7 D070 D20F00          10      JP  NC,JP_HL
       D073                     COMB2:
0002FA D073 EB               4      EX  DE,HL
0002FB D074 2240D1          16      LD  (COMPAT+1),HL
0002FE D077 F5              11      PUSH    AF
0002FF D078 CDF8D0          17      CALL    CEXE4
000302 D07B F1              10      POP AF
000303 D07C 2115F0          10      LD  HL,FNAME
000306 D07F 116D00          10      LD  DE,FCB2+1   ;COMMAND NAME
000309 D082 010B00          10      LD  BC,11
00030C D085 EDB0                    LDIR
00030E D087 11A6EB          10      LD  DE,PATHD
       D08A                     CEX1:
000311 D08A 1A               7      LD  A,(DE)
000312 D08B FE20             7      CP  020H
000314 D08D D8              11      RET C
000315 D08E CD37DC          17      CALL    FILEC
000318 D091 D5              11      PUSH    DE
000319 D092 216D00          10      LD  HL,FCB2+1   ;COMMAND NAME
00031C D095 1115F0          10      LD  DE,FNAME
00031F D098 010B00          10      LD  BC,11
000322 D09B EDB0                    LDIR
000324 D09D CDF8D0          17      CALL    CEXE4
000327 D0A0 D1              10      POP DE
000328 D0A1 13               6      INC DE
000329 D0A2 18E6            12      JR  CEX1
                                
       D0A4                     SDVSW:
00032B D0A4 F1              10      POP AF
00032C D0A5 3A14F0          13      LD  A,(FDRV)
00032F D0A8 3D               4      DEC A
000330 D0A9 5F               4      LD  E,A
000331 D0AA 0E0E             7      LD  C,00EH      ;(BDOS)カレントドライブの設定
000333 D0AC 1831            12      JR  SYSTEM0
                                
       D0AE                     OPEN1:
000335 D0AE 2114F0          10      LD  HL,FDRV
       D0B1                     OPEN:
000338 D0B1 0E11             7      LD  C,011H      ;(BDOS)ファイルの検索
       D0B3                     OPEN3:
00033A D0B3 D5              11      PUSH    DE
00033B D0B4 11E7EB          10      LD  DE,DTA_CCP
00033E D0B7 CDD5D0          17      CALL    SETDTA
000341 D0BA EB               4      EX  DE,HL
000342 D0BB CDDFD0          17      CALL    SYSTEM0
000345 D0BE D1              10      POP DE
000346 D0BF C9              10      RET
                                
       D0C0                     OPEN2:
000347 D0C0 0E12             7      LD  C,012H
000349 D0C2 18EF            12      JR  OPEN3
                                
       D0C4                     DEFCB:              ;Z=Ok NZ=Error
00034B D0C4 11E7EB          10      LD  DE,DTA_CCP
00034E D0C7 CDDDD0          17      CALL    SYSC0F
                                
000351 D0CA 1108EC          10      LD  DE,DTA_CCP+33   ;(FCB)ランダムレコード
000354 D0CD 0604             7      LD  B,4
000356 D0CF CDA4D3          17      CALL    ZERO_MEMORY_DE
       D0D2                     SETDTA100:
000359 D0D2 110001          10      LD  DE,00100H
       D0D5                     SETDTA:
00035C D0D5 C31AD7          10      JP  _SYS1A      ;(BDOS)DTAの設定
                                
       D0D8                     SETDTA1:
00035F D0D8 118000          10      LD  DE,DTA1
000362 D0DB 18F8            12      JR  SETDTA
                                
       D0DD                     SYSC0F:
000364 D0DD 0E0F             7      LD  C,00FH      ;(BDOS)ファイルのオープン
       D0DF                     SYSTEM0:
000366 D0DF CD0500          17      CALL    SYSTEM
000369 D0E2 B7               4      OR  A
00036A D0E3 C9              10      RET
                                
       D0E4                     C_CD:
00036B D0E4 0E5A             7      LD  C,5AH
00036D D0E6 18F7            12      JR  SYSTEM0
                                
       D0E8                     S27BUF:
00036F D0E8 3A0700          13      LD  A,(SYSTEM+2)
000372 D0EB 3D               4      DEC A
000373 D0EC E6F8             7      AND 0F8H
000375 D0EE 67               4      LD  H,A
000376 D0EF 2E00             7      LD  L,0
       D0F1                     S27DTA:
000378 D0F1 11E7EB          10      LD  DE,DTA_CCP
       D0F4                     S27:
00037B D0F4 0E27             7      LD  C,027H      ;(BDOS)ランダムブロック読み込み
00037D D0F6 18E7            12      JR  SYSTEM0
                                
       D0F8                     CEXE4:
00037F D0F8 211DF0          10      LD  HL,FNAME+8
000382 D0FB 7E               7      LD  A,(HL)
000383 D0FC FE20             7      CP  020H
000385 D0FE 2007            12      JR  NZ,CEXE7
000387 D100 3E3F             7      LD  A,'?'
000389 D102 77               7      LD  (HL),A
00038A D103 23               6      INC HL
00038B D104 77               7      LD  (HL),A
00038C D105 23               6      INC HL
00038D D106 77               7      LD  (HL),A
       D107                     CEXE7:
00038E D107 CDAED0          17      CALL    OPEN1
       D10A                     CEXE5:
000391 D10A C0              11      RET NZ
000392 D10B 2AF1EB          16      LD  HL,(DTA_CCP+1+9)
000395 D10E 7C               4      LD  A,H
000396 D10F CD4EDF          17      CALL    CAP
000399 D112 67               4      LD  H,A
00039A D113 7D               4      LD  A,L
00039B D114 CD4EDF          17      CALL    CAP
00039E D117 6F               4      LD  L,A
00039F D118 3AF0EB          13      LD  A,(DTA_CCP+1+8)
0003A2 D11B CD4EDF          17      CALL    CAP
0003A5 D11E D642             7      SUB 'B'
0003A7 D120 282C            12      JR  Z,C_BAT
0003A9 D122 3D               4      DEC A       ;'C'
0003AA D123 2805            12      JR  Z,C_EXE
       D125                     CEXE6:
0003AC D125 CDC0D0          17      CALL    OPEN2
0003AF D128 18E0            12      JR  CEXE5
                                
       D12A                     C_EXE:
0003B1 D12A 7C               4      LD  A,H
0003B2 D12B FE4D             7      CP  'M'
0003B4 D12D 20F6            12      JR  NZ,CEXE6
                                
0003B6 D12F CDC4D0          17      CALL    DEFCB
0003B9 D132 CDE8D0          17      CALL    S27BUF
0003BC D135 3D               4      DEC A
0003BD D136 37               4      SCF
0003BE D137 C0              11      RET NZ
0003BF D138 7C               4      LD  A,H
0003C0 D139 B5               4      OR  L
0003C1 D13A 37               4      SCF
0003C2 D13B C8              11      RET Z
0003C3 D13C CDD8D0          17      CALL    SETDTA1
0003C6 D13F 110000          10  COMPAT: LD  DE,0                ; self-modifying code
0003C9 D142 ED7B0600        20      LD  SP,(SYSTEM+1)
0003CD D146 67               4      LD  H,A             ; A=0 in SETDTA1(_SYS1A)
0003CE D147 6F               4      LD  L,A
0003CF D148 E5              11      PUSH    HL              ; push $0000 (reboot address)
0003D0 D149 24               4      INC H
0003D1 D14A E5              11      PUSH    HL              ; push $0100 (TPA address)
0003D2 D14B C36FD3          10      JP  SETFCB              ; and JP $0100
                                
       D14E                     C_BAT:
0003D5 D14E 114154          10      LD  DE,'A'+'T'*256
0003D8 D151 ED52            15      SBC HL,DE
0003DA D153 20D0            12      JR  NZ,CEXE6
                                
0003DC D155 CDC4D0          17      CALL    DEFCB
                                
0003DF D158 21E7EB          10      LD  HL,DTA_CCP
0003E2 D15B 110CEC          10      LD  DE,FCB_BAT
0003E5 D15E 012500          10      LD  BC,37
0003E8 D161 EDB0                    LDIR
       D163                     C_BAT1:
0003EA D163 CDD2D0          17      CALL    SETDTA100
0003ED D166 CD9AD1          17      CALL    FGETC_BAT
0003F0 D169 218100          10      LD  HL,DTA1+1
0003F3 D16C 2025            12      JR  NZ,END_BATCH
0003F5 D16E FE21             7      CP  021H        ;スペースや改行など制御文字を飛ばす
0003F7 D170 38F1            12      JR  C,C_BAT1
0003F9 D172 3620            10      LD  (HL),' '
0003FB D174 23               6      INC HL
       D175                     C_BAT2:
0003FC D175 77               7      LD  (HL),A
0003FD D176 23               6      INC HL
0003FE D177 7D               4      LD  A,L
0003FF D178 3C               4      INC A       ;L==0FFH
000400 D179 2809            12      JR  Z,RUN_BATCH
000402 D17B CD9AD1          17      CALL    FGETC_BAT
000405 D17E 2004            12      JR  NZ,RUN_BATCH
000407 D180 FE20             7      CP  020H
000409 D182 30F1            12      JR  NC,C_BAT2
       D184                     RUN_BATCH:
00040B D184 7D               4      LD  A,L
00040C D185 D67F             7      SUB DTA1-1
00040E D187 328000          13      LD  (DTA1),A
000411 D18A FE04             7      CP  4
000413 D18C 3805            12      JR  C,END_BATCH
000415 D18E 3600            10      LD  (HL),0
000417 D190 C33ED0          10      JP  COMMAND2
       D193                     END_BATCH:
00041A D193 AF               4      XOR A       ;バッチファイルを閉じる
00041B D194 320CEC          13      LD  (FCB_BAT),A
00041E D197 C300F0          10      JP  CPM_BOOT
                                
       D19A                     FGETC_BAT:
000421 D19A 110CEC          10      LD  DE,FCB_BAT
       D19D                     FGETC:              ;1文字ずつ読み込む
000424 D19D E5              11      PUSH    HL      ;Z:成功
000425 D19E 210100          10      LD  HL,1
000428 D1A1 CDF4D0          17      CALL    S27
00042B D1A4 E1              10      POP HL
00042C D1A5 3A0001          13      LD  A,(00100H)
00042F D1A8 C9              10      RET
                                
       D1A9                     C_DEL:
000430 D1A9 CD6FD3          17      CALL    SETFCB
000433 D1AC CD48D8          17      CALL    _SYS08      ;(BDOS)エコーなしコンソール入力
                                
000436 D1AF 0E13             7      LD  C,013H
000438 D1B1 180A            12      JR  CDEL1       ;(BDOS)ファイルの削除
                                
       D1B3                     C_REN:
00043A D1B3 CD6FD3          17      CALL    SETFCB
00043D D1B6 3E10             7      LD  A,010H      ;ディレクトリも対象にする
00043F D1B8 326900          13      LD  (FCB1+13),A ;属性
000442 D1BB 0E17             7      LD  C,017H      ;(BDOS)ファイル名の変更
       D1BD                     CDEL1:
000444 D1BD 115C00          10      LD  DE,FCB1
000447 D1C0 CD0500          17      CALL    SYSTEM
00044A D1C3 C6FF             7      ADD A,0FFH
00044C D1C5 C9              10      RET
                                
       D1C6                     C_DIR:
00044D D1C6 CD37DC          17      CALL    FILEC
000450 D1C9 2115F0          10      LD  HL,FDRV+1
000453 D1CC CDBAD4          17      CALL    CWILD1
000456 D1CF 3EF1             7      LD  A,0F1H
000458 D1D1 3221F0          13      LD  (FDRV+13),A
00045B D1D4 CDAED0          17      CALL    OPEN1
       D1D7                     CDIR1:
00045E D1D7 B7               4      OR  A
00045F D1D8 2008            12      JR  NZ,PDSKF
000461 D1DA CD25D2          17      CALL    P_NAME
000464 D1DD CDC0D0          17      CALL    OPEN2
000467 D1E0 18F5            12      JR  CDIR1
                                
       D1E2                     PDSKF:
000469 D1E2 3A14F0          13      LD  A,(FDRV)
00046C D1E5 5F               4      LD  E,A
00046D D1E6 0E1B             7      LD  C,01BH      ;(BDOS)ディスク情報の獲得
00046F D1E8 CD0500          17      CALL    SYSTEM
000472 D1EB 4F               4      LD  C,A     ;C←1クラスタ辺りの論理セクタ数
000473 D1EC C601             7      ADD A,001H
000475 D1EE D8              11      RET C       ;Aが0FFHだった場合
000476 D1EF 3E06             7      LD  A,8-2
       D1F1                     PDS1:               ;HL=未使用クラスタの総数
000478 D1F1 3C               4      INC A
000479 D1F2 CB19             8      RR  C
00047B D1F4 30FB            12      JR  NC,PDS1
       D1F6                     PDS2:               ;B←論理セクタのサイズの上位8ビット
00047D D1F6 3C               4      INC A
00047E D1F7 CB18             8      RR  B
000480 D1F9 30FB            12      JR  NC,PDS2
000482 D1FB 47               4      LD  B,A
                                
000483 D1FC 110000          10      LD  DE,0
       D1FF                     PDS3:
000486 D1FF 29              11      ADD HL,HL
000487 D200 EB               4      EX  DE,HL
000488 D201 ED6A            15      ADC HL,HL
00048A D203 EB               4      EX  DE,HL
00048B D204 10F9            13      DJNZ    PDS3
       D206                     PDSKF1:
00048D D206 CD9ED2          17      CALL    PRDEC_DEHL
000490 D209 1131EC          10      LD  DE,FREE
000493 D20C CD42D5          17      CALL    _SYS09      ;(BDOS)文字列出力
000496 D20F CD8DD2          17      CALL    PUTDRV
000499 D212 3E5C             7      LD  A,05CH      ;\
00049B D214 CD32D8          17      CALL    MSG_A
00049E D217 2A22F0          16      LD  HL,(FDRV+14)    ;ディレクトリのクラスタ番号
0004A1 D21A AF               4      XOR A
0004A2 D21B 11FEFF          10      LD  DE,0-2
0004A5 D21E 19              11      ADD HL,DE
0004A6 D21F 23               6      INC HL
0004A7 D220 DC9AD2          17      CALL    C,PRDEC_HL
0004AA D223 1841            12      JR  LTNL
                                
       D225                     P_NAME:
0004AC D225 3AE8EB          13      LD  A,(DTA_CCP+1)
0004AF D228 FE2E             7      CP  '.'
0004B1 D22A C8              11      RET Z
0004B2 D22B 11D0D4          10      LD  DE,DIRHD
0004B5 D22E CD42D5          17      CALL    _SYS09      ;(BDOS)文字列出力
0004B8 D231 3AF3EB          13      LD  A,(DTA_CCP+1+00BH)
0004BB D234 F5              11      PUSH    AF
0004BC D235 0F               4      RRCA
0004BD D236 9F               4      SBC A,A
0004BE D237 E60A             7      AND '*'-020H
0004C0 D239 C620             7      ADD A,020H
0004C2 D23B CD32D8          17      CALL    MSG_A
0004C5 D23E CD8DD2          17      CALL    PUTDRV
0004C8 D241 21E8EB          10      LD  HL,DTA_CCP+1
0004CB D244 CDDED2          17      CALL    FPRNT
                                
0004CE D247 F1              10      POP AF
0004CF D248 CB67             8      BIT 4,A
0004D1 D24A 2808            12      JR  Z,DIR3
0004D3 D24C 11C5D4          10      LD  DE,DIRMES
0004D6 D24F CD42D5          17      CALL    _SYS09      ;(BDOS)文字列出力
0004D9 D252 180A            12      JR  DIR6
       D254                     DIR3:
0004DB D254 ED5B06EC        20      LD  DE,(DTA_CCP+1+01EH)
0004DF D258 2A04EC          16      LD  HL,(DTA_CCP+1+01CH)
0004E2 D25B CD9ED2          17      CALL    PRDEC_DEHL
       D25E                     DIR6:
0004E5 D25E 3AB1F0          13      LD  A,(_WIDTH)
0004E8 D261 FE29             7      CP  40+1
0004EA D263 D400D3          17      CALL    NC,PRTTMS
                                
       D266                     LTNL:
0004ED D266 1E03             7      LD  E,3
0004EF D268 C3CDF0          10      JP  _PRINT
                                
       D26B                     C_PATH:
0004F2 D26B CD19DD          17      CALL    SPCUT
0004F5 D26E 21A6EB          10      LD  HL,PATHD
0004F8 D271 FE21             7      CP  021H
0004FA D273 300C            12      JR  NC,CPATH0
       D275                     CPATHP:
0004FC D275 7E               7      LD  A,(HL)
0004FD D276 23               6      INC HL
0004FE D277 FE20             7      CP  020H
000500 D279 3F               4      CCF
000501 D27A 30EA            12      JR  NC,LTNL
000503 D27C CD32D8          17      CALL    MSG_A
000506 D27F 18F4            12      JR  CPATHP
       D281                     CPATH0:
000508 D281 FE3B             7      CP  ';'
00050A D283 2001            12      JR  NZ,CPATH1
00050C D285 13               6      INC DE
       D286                     CPATH1:
00050D D286 EB               4      EX  DE,HL
00050E D287 014000          10      LD  BC,PATHX
000511 D28A EDB0                    LDIR
000513 D28C C9              10      RET
                                
       D28D                     PUTDRV:
000514 D28D 3A14F0          13      LD  A,(FDRV)
000517 D290 C640             7      ADD A,'A'-1
000519 D292 CD32D8          17      CALL    MSG_A
00051C D295 3E3A             7      LD  A,':'
       D297                     MSG_AR:
00051E D297 C332D8          10      JP  MSG_A
                                
       D29A                     PRDEC_HL:
000521 D29A AF               4      XOR A
       D29B                     PRDEC_AHL:
000522 D29B 5F               4      LD  E,A
000523 D29C 1600             7      LD  D,0
       D29E                     PRDEC_DEHL:
000525 D29E D5              11      PUSH    DE
000526 D29F 110FF0          10      LD  DE,DECBF
000529 D2A2 0605             7      LD  B,5
00052B D2A4 CDA4D3          17      CALL    ZERO_MEMORY_DE  ;A=0
00052E D2A7 D1              10      POP DE
                                
00052F D2A8 0E20             7      LD  C,32
       D2AA                     DEC1:
000531 D2AA 29              11      ADD HL,HL
000532 D2AB EB               4      EX  DE,HL
000533 D2AC ED6A            15      ADC HL,HL
000535 D2AE EB               4      EX  DE,HL
000536 D2AF E5              11      PUSH    HL
000537 D2B0 2113F0          10      LD  HL,DECBF+4
00053A D2B3 0605             7      LD  B,5
       D2B5                     DEC2:
00053C D2B5 7E               7      LD  A,(HL)
00053D D2B6 8F               4      ADC A,A
00053E D2B7 27               4      DAA
00053F D2B8 77               7      LD  (HL),A
000540 D2B9 2B               6      DEC HL
000541 D2BA 10F9            13      DJNZ    DEC2
000543 D2BC E1              10      POP HL
000544 D2BD 0D               4      DEC C
000545 D2BE 20EA            12      JR  NZ,DEC1
                                
000547 D2C0 210FF0          10      LD  HL,DECBF
00054A D2C3 3E20             7      LD  A,020H
00054C D2C5 0604             7      LD  B,4
       D2C7                     DEC3:
00054E D2C7 CDD4D2          17      CALL    DEC4
000551 D2CA CDD4D2          17      CALL    DEC4
000554 D2CD 23               6      INC HL
000555 D2CE 10F7            13      DJNZ    DEC3
       D2D0                     DECX:
000557 D2D0 CDD4D2          17      CALL    DEC4
00055A D2D3 AF               4      XOR A
       D2D4                     DEC4:
00055B D2D4 ED6F            18      RLD
00055D D2D6 FE20             7      CP  020H
00055F D2D8 2802            12      JR  Z,DEC5
000561 D2DA F630             7      OR  030H
       D2DC                     DEC5:
000563 D2DC 18B9            12      JR  MSG_AR
                                
       D2DE                     FPRNT:
000565 D2DE 0608             7      LD  B,8
000567 D2E0 CDF1D2          17      CALL    P_N1
00056A D2E3 7E               7      LD  A,(HL)
00056B D2E4 C680             7      ADD A,NBSP-020H
00056D D2E6 FEA0             7      CP  NBSP
00056F D2E8 2802            12      JR  Z,FPR1
000571 D2EA 3E2E             7      LD  A,'.'
       D2EC                     FPR1:
000573 D2EC CD32D8          17      CALL    MSG_A
000576 D2EF 0603             7      LD  B,3
                                
       D2F1                     P_N1:
000578 D2F1 C5              11      PUSH    BC
000579 D2F2 E5              11      PUSH    HL
00057A D2F3 7E               7      LD  A,(HL)
00057B D2F4 CD5ADF          17      CALL    CAP3
00057E D2F7 CD32D8          17      CALL    MSG_A
000581 D2FA E1              10      POP HL
000582 D2FB C1              10      POP BC
000583 D2FC 23               6      INC HL
000584 D2FD 10F2            13      DJNZ    P_N1
000586 D2FF C9              10      RET
                                
       D300                     PRTTMS:
000587 D300 3E20             7      LD  A,020H
000589 D302 CD32D8          17      CALL    MSG_A
                                
00058C D305 2A00EC          16      LD  HL,(DTA_CCP+1+24)
00058F D308 7D               4      LD  A,L
000590 D309 B7               4      OR  A
000591 D30A C8              11      RET Z
000592 D30B CB3C             8      SRL H
000594 D30D 17               4      RLA
000595 D30E 17               4      RLA
000596 D30F 17               4      RLA
000597 D310 17               4      RLA
000598 D311 E60F             7      AND 00FH
00059A D313 57               4      LD  D,A
00059B D314 7C               4      LD  A,H
00059C D315 C650             7      ADD A,80
00059E D317 CD5AD3          17      CALL    PRDEC_A
0005A1 D31A 3E2D             7      LD  A,'-'
0005A3 D31C CD32D8          17      CALL    MSG_A
0005A6 D31F 7A               4      LD  A,D
0005A7 D320 CD5AD3          17      CALL    PRDEC_A
0005AA D323 3E2D             7      LD  A,'-'
0005AC D325 CD32D8          17      CALL    MSG_A
0005AF D328 7D               4      LD  A,L
0005B0 D329 E61F             7      AND 01FH
0005B2 D32B CD5AD3          17      CALL    PRDEC_A
                                
0005B5 D32E 2AFEEB          16      LD  HL,(DTA_CCP+1+22)
                                
0005B8 D331 3E20             7      LD  A,020H
0005BA D333 CD32D8          17      CALL    MSG_A
0005BD D336 7C               4      LD  A,H
0005BE D337 65               4      LD  H,L
0005BF D338 0603             7      LD  B,3
       D33A                     PRTTMS1:
0005C1 D33A 1F               4      RRA
0005C2 D33B CB1D             8      RR  L
0005C4 D33D 10FB            13      DJNZ    PRTTMS1
0005C6 D33F E61F             7      AND 01FH
0005C8 D341 CD5AD3          17      CALL    PRDEC_A
0005CB D344 3E3A             7      LD  A,':'
0005CD D346 CD32D8          17      CALL    MSG_A
0005D0 D349 7D               4      LD  A,L
0005D1 D34A 0F               4      RRCA
0005D2 D34B 0F               4      RRCA
0005D3 D34C E63F             7      AND 03FH
0005D5 D34E CD5AD3          17      CALL    PRDEC_A
0005D8 D351 3E3A             7      LD  A,':'
0005DA D353 CD32D8          17      CALL    MSG_A
0005DD D356 7C               4      LD  A,H
0005DE D357 E61F             7      AND 01FH
0005E0 D359 87               4      ADD A,A
                                
                                ;   PRINT10
                                
       D35A                     PRDEC_A:
0005E1 D35A E5              11      PUSH    HL
0005E2 D35B 0608             7      LD  B,8
0005E4 D35D 4F               4      LD  C,A
0005E5 D35E AF               4      XOR A
       D35F                     PRTA1:
0005E6 D35F CB01             4      RLC C
0005E8 D361 8F               4      ADC A,A
0005E9 D362 27               4      DAA
0005EA D363 10FA            13      DJNZ    PRTA1
0005EC D365 210FF0          10      LD  HL,DECBF
0005EF D368 77               7      LD  (HL),A
0005F0 D369 AF               4      XOR A
0005F1 D36A CDD0D2          17      CALL    DECX
0005F4 D36D E1              10      POP HL
0005F5 D36E C9              10      RET
                                
       D36F                     SETFCB:
0005F6 D36F CD19DD          17      CALL    SPCUT
0005F9 D372 1A               7      LD  A,(DE)
0005FA D373 FE20             7      CP  020H
0005FC D375 3801            12      JR  C,SETFCBA
0005FE D377 1B               6      DEC DE
       D378                     SETFCBA:
0005FF D378 0624             7      LD  B,36
000601 D37A 215C00          10      LD  HL,FCB1
000604 D37D E5              11      PUSH    HL
000605 D37E AF               4      XOR A
000606 D37F CDEEDC          17      CALL    FILL_MEMORY
000609 D382 E1              10      POP HL
00060A D383 D5              11      PUSH    DE
00060B D384 CD80D7          17      CALL    _SYS29      ;(BDOS)ファイル名の解析
00060E D387 216C00          10      LD  HL,FCB2
000611 D38A CD80D7          17      CALL    _SYS29      ;(BDOS)ファイル名の解析
000614 D38D E1              10      POP HL
000615 D38E 010050          10      LD  BC,05000H
000618 D391 118100          10      LD  DE,00081H
       D394                     SETFCB1:
00061B D394 7E               7      LD  A,(HL)
00061C D395 23               6      INC HL
00061D D396 FE20             7      CP  020H
00061F D398 3805            12      JR  C,SETFCB2
000621 D39A 12               7      LD  (DE),A
000622 D39B 13               6      INC DE
000623 D39C 0C               4      INC C
000624 D39D 10F5            13      DJNZ    SETFCB1
       D39F                     SETFCB2:
000626 D39F 79               4      LD  A,C
000627 D3A0 328000          13      LD  (DTA1),A
00062A D3A3 04               4      INC B
       D3A4                     ZERO_MEMORY_DE:
00062B D3A4 AF               4      XOR A
       D3A5                     FILL_MEMORY_DE:
00062C D3A5 12               7      LD  (DE),A
00062D D3A6 13               6      INC DE
00062E D3A7 10FC            13      DJNZ    FILL_MEMORY_DE
000630 D3A9 C9              10      RET
                                
       D3AA                     C_COPY:
000631 D3AA CD6FD3          17      CALL    SETFCB
                                
000634 D3AD 1161F0          10      LD  DE,ZERO
000637 D3B0 CD3ADC          17      CALL    FILEC2
00063A D3B3 216C00          10      LD  HL,FCB2
00063D D3B6 CD87D7          17      CALL    S29X1
                                
000640 D3B9 3E10             7      LD  A,010H
000642 D3BB 326900          13      LD  (FCB1+13),A
000645 D3BE 216D00          10      LD  HL,FCB2+1
000648 D3C1 CDBAD4          17      CALL    CWILD1
       D3C4                     COPY0:
00064B D3C4 CDB7D4          17      CALL    CWILD
00064E D3C7 215C00          10      LD  HL,FCB1
000651 D3CA CDB1D0          17      CALL    OPEN
000654 D3CD 37               4      SCF
       D3CE                     COPY1:
000655 D3CE C0              11      RET NZ
000656 D3CF CDC4D0          17      CALL    DEFCB
                                
000659 D3D2 3AF4EB          13      LD  A,(DTA_CCP+13)
00065C D3D5 CB67             8      BIT 4,A
00065E D3D7 2821            12      JR  Z,COPY1A
                                
000660 D3D9 215D00          10      LD  HL,FCB1+1
000663 D3DC CD7DE0          17      CALL    CHKWILD
000666 D3DF 3814            12      JR  C,COPY9
                                
000668 D3E1 3E20             7      LD  A,020H
00066A D3E3 325D00          13      LD  (FCB1+1),A
00066D D3E6 2A01EC          16      LD  HL,(DTA_CCP+26)
000670 D3E9 23               6      INC HL
000671 D3EA 226A00          16      LD  (FCB1+14),HL
000674 D3ED 18D5            12      JR  COPY0
                                
       D3EF                     COPY8:
000676 D3EF CD42D5          17      CALL    _SYS09      ;(BDOS)文字列出力
000679 D3F2 CD66D2          17      CALL    LTNL
       D3F5                     COPY9:
00067C D3F5 CDC0D0          17      CALL    OPEN2
00067F D3F8 18D4            12      JR  COPY1
                                
       D3FA                     COPY1A:
000681 D3FA 216C00          10      LD  HL,FCB2
000684 D3FD 1114F0          10      LD  DE,FDRV
000687 D400 01E9EB          10      LD  BC,DTA_CCP+2
00068A D403 EDA0            16      LDI
00068C D405 3E0B             7      LD  A,11
       D407                     COPY2:
00068E D407 F5              11      PUSH    AF
00068F D408 7E               7      LD  A,(HL)
000690 D409 FE3F             7      CP  '?'
000692 D40B 2001            12      JR  NZ,COPY3
000694 D40D 0A               7      LD  A,(BC)
       D40E                     COPY3:
000695 D40E 12               7      LD  (DE),A
000696 D40F 03               6      INC BC
000697 D410 13               6      INC DE
000698 D411 23               6      INC HL
000699 D412 F1              10      POP AF
00069A D413 3D               4      DEC A
00069B D414 20F1            12      JR  NZ,COPY2
00069D D416 010500          10      LD  BC,16-11
0006A0 D419 EDB0                    LDIR
       D41B                     PUTNAME:
0006A2 D41B 215D00          10      LD  HL,FCB1+1
0006A5 D41E CD7DE0          17      CALL    CHKWILD
0006A8 D421 300B            12      JR  NC,PUTN1
0006AA D423 2115F0          10      LD  HL,FDRV+1
0006AD D426 CDDED2          17      CALL    FPRNT
0006B0 D429 3E20             7      LD  A,020H
0006B2 D42B CD32D8          17      CALL    MSG_A
       D42E                     PUTN1:
0006B5 D42E 1114F0          10      LD  DE,FDRV
0006B8 D431 0E16             7      LD  C,016H      ;(BDOS)ファイルの作成
0006BA D433 CDDFD0          17      CALL    SYSTEM0
0006BD D436 2048            12      JR  NZ,COPYE2
0006BF D438 67               4      LD  H,A     ;A=0
0006C0 D439 6F               4      LD  L,A
0006C1 D43A 2235F0          16      LD  (FDRV+33),HL    ;(FCB)ランダムレコード
0006C4 D43D 2237F0          16      LD  (FDRV+35),HL
       D440                     COPY6:
0006C7 D440 CDE8D0          17      CALL    S27BUF
0006CA D443 47               4      LD  B,A
0006CB D444 3C               4      INC A
0006CC D445 2831            12      JR  Z,COPYE
0006CE D447 7C               4      LD  A,H
0006CF D448 B5               4      OR  L
0006D0 D449 280C            12      JR  Z,COPY7
0006D2 D44B 1114F0          10      LD  DE,FDRV
0006D5 D44E 0E26             7      LD  C,026H      ;(BDOS)ランダムブロック書き込み
0006D7 D450 CDDFD0          17      CALL    SYSTEM0
0006DA D453 2023            12      JR  NZ,COPYE
0006DC D455 10E9            13      DJNZ    COPY6
       D457                     COPY7:
0006DE D457 3AF4EB          13      LD  A,(DTA_CCP+13)  ;(FCB)属性
0006E1 D45A 3221F0          13      LD  (FDRV+13),A
0006E4 D45D 21FBEB          10      LD  HL,DTA_CCP+20   ;(FCB)タイムスタンプ
0006E7 D460 1128F0          10      LD  DE,FDRV+20
0006EA D463 010400          10      LD  BC,4
0006ED D466 EDB0                    LDIR
                                
0006EF D468 1114F0          10      LD  DE,FDRV
0006F2 D46B 0E10             7      LD  C,010H      ;(BDOS)ファイルのクローズ
0006F4 D46D CDDFD0          17      CALL    SYSTEM0
0006F7 D470 2006            12      JR  NZ,COPYE
                                
0006F9 D472 1171F0          10      LD  DE,OK
0006FC D475 C3EFD3          10      JP  COPY8
                                
       D478                     COPYE:
0006FF D478 1114F0          10      LD  DE,FDRV
000702 D47B 0E13             7      LD  C,013H      ;(BDOS)ファイルの削除
000704 D47D CD0500          17      CALL    SYSTEM
       D480                     COPYE2:
000707 D480 37               4      SCF
000708 D481 C9              10      RET
                                
       D482                     C_TYPE:
000709 D482 CD6FD3          17      CALL    SETFCB
00070C D485 215C00          10      LD  HL,FCB1
00070F D488 CDB1D0          17      CALL    OPEN
000712 D48B 37               4      SCF
       D48C                     TYPE1:
000713 D48C C0              11      RET NZ
000714 D48D CDC4D0          17      CALL    DEFCB
000717 D490 3E06             7      LD  A,6
000719 D492 CD32D8          17      CALL    MSG_A
       D495                     TYPE2:
00071C D495 CDE8D0          17      CALL    S27BUF
00071F D498 C6FE             7      ADD A,0FEH
000721 D49A D8              11      RET C
000722 D49B 7C               4      LD  A,H
000723 D49C B5               4      OR  L
000724 D49D 2813            12      JR  Z,TYPEE
000726 D49F 010001          10      LD  BC,00100H
       D4A2                     TYPE3:
000729 D4A2 0A               7      LD  A,(BC)
00072A D4A3 03               6      INC BC
00072B D4A4 FE1A             7      CP  01AH
00072D D4A6 280A            12      JR  Z,TYPEE
00072F D4A8 CD32D8          17      CALL    MSG_A
000732 D4AB 2B               6      DEC HL
000733 D4AC 7C               4      LD  A,H
000734 D4AD B5               4      OR  L
000735 D4AE 20F2            12      JR  NZ,TYPE3
000737 D4B0 18E3            12      JR  TYPE2
       D4B2                     TYPEE:
000739 D4B2 CDC0D0          17      CALL    OPEN2
00073C D4B5 18D5            12      JR  TYPE1
                                
       D4B7                     CWILD:
00073E D4B7 215D00          10      LD  HL,FCB1+1
       D4BA                     CWILD1:
000741 D4BA 7E               7      LD  A,(HL)
000742 D4BB FE20             7      CP  020H
000744 D4BD C0              11      RET NZ
       D4BE                     CWILD2:
000745 D4BE 3E3F             7      LD  A,'?'
000747 D4C0 060B             7      LD  B,11
000749 D4C2 C3EEDC          10      JP  FILL_MEMORY
                                
00074C D4C5 20202020203C4449    DIRMES: DB  "     <DIR>$"
            523E24              
000757 D4D0 20203A24            DIRHD:  DB  "  :$"
                                
       D4D4                     COMTB:
00075B D4D4 44202020                DB  "D   "  ;1
00075F D4D8 C6D1                    DW  C_DIR
000761 D4DA 44495220                DB  "DIR "  ;2
000765 D4DE C6D1                    DW  C_DIR
000767 D4E0 434F5059                DB  "COPY"  ;3
00076B D4E4 AAD3                    DW  C_COPY
00076D D4E6 43442020                DB  "CD  "  ;4
000771 D4EA E4D0                    DW  C_CD
000773 D4EC 44454C20                DB  "DEL "  ;5
000777 D4F0 A9D1                    DW  C_DEL
000779 D4F2 50415448                DB  "PATH"  ;6
00077D D4F6 6BD2                    DW  C_PATH
00077F D4F8 52454E20                DB  "REN "  ;7
000783 D4FC B3D1                    DW  C_REN
000785 D4FE 54595045                DB  "TYPE"  ;8
000789 D502 82D4                    DW  C_TYPE
00078B D504 52454D20                DB  "REM "  ;9
00078F D508 3FD5                    DW  C_REM
[EOF:LDCCP.ASM:SHIFT_JIS]
                                    INCLUDE "M7CCP2.ASM"
                                
                                ;   LSX-Dodgers CCP2
                                ;   MZ-700/1500
                                
000791 D50A 4D4F4E20                DB  "MON "  ;10
000795 D50E DCCF                    DW  C_MON
[EOF:M7CCP2.ASM:UTF_8]
                                    INCLUDE "LDOS.ASM"
                                
                                ;   LSX-Dodgers OS
                                
       D510                     BDOS0:
000797 D510 E5              11      PUSH    HL
000798 D511 79               4      LD  A,C
000799 D512 FE3C             7      CP  03CH
00079B D514 3802            12      JR  C,DOS1
00079D D516 3E3C             7      LD  A,03CH
       D518                     DOS1:
00079F D518 87               4      ADD A,A
0007A0 D519 6F               4      LD  L,A
0007A1 D51A 26F1             7      LD  H,STABLE/256
0007A3 D51C 7E               7      LD  A,(HL)
0007A4 D51D 2C               4      INC L
0007A5 D51E 66               7      LD  H,(HL)
0007A6 D51F 6F               4      LD  L,A
0007A7 D520 E3              19      EX  (SP),HL
0007A8 D521 79               4      LD  A,C
                                ;確認用
                                ;   LD  (0050H),A
0007A9 D522 C9              10      RET
       D523                     _DOS2:
0007AA D523 FE5A             7      CP  05AH        ;(BDOS)カレントディレクトリの変更(_CHDIR)
0007AC D525 CAC2D7          10      JP  Z,_SYS5A
0007AF D528 FE5C             7      CP  05CH        ;(BDOS)ファイル名の解析(_PFILE)
0007B1 D52A CA80D7          10      JP  Z,_SYS29
0007B4 D52D FE5F             7      CP  05FH        ;(BDOS)ディスクバッファのフラッシュ(_FLUSH)
0007B6 D52F CA96E9          10      JP  Z,_SYS5F
0007B9 D532 FE6F             7      CP  06FH        ;(BDOS)MSX-DOS のバージョン番号の獲得(_DOSVER)
0007BB D534 200A            12      JR  NZ,_ERROR
0007BD D536 011D01          10      LD  BC,VER_6F
0007C0 D539 115701          10      LD  DE,VER
0007C3 D53C 210100          10      LD  HL,MACD
       D53F                     C_REM:
0007C6 D53F AF               4      XOR A
       D540                     _ERROR:
0007C7 D540 A7               4      AND A
0007C8 D541 C9              10      RET
                                
       D542                     _SYS09:     ;文字列出力
0007C9 D542 D5              11      PUSH    DE
       D543                     _SX09:
0007CA D543 1A               7      LD  A,(DE)
0007CB D544 13               6      INC DE
0007CC D545 FE24             7      CP  '$'
0007CE D547 2831            12      JR  Z,SX0E2
0007D0 D549 CD32D8          17      CALL    MSG_A
0007D3 D54C 18F5            12      JR  _SX09
                                
       D54E                     MSX1:
0007D5 D54E CD32D8          17      CALL    MSG_A
       D551                     MSX:
0007D8 D551 7E               7      LD  A,(HL)
0007D9 D552 23               6      INC HL
0007DA D553 B7               4      OR  A
0007DB D554 20F8            12      JR  NZ,MSX1
0007DD D556 C9              10      RET
                                
       D557                     _SYS0C:     ;(BDOS)バージョン番号の獲得
0007DE D557 212200          10      LD  HL,00022H
0007E1 D55A 7D               4      LD  A,L
0007E2 D55B C9              10      RET
                                
       D55C                     _SYS0D:     ;(BDOS)ディスクリセット
0007E3 D55C CDDFF0          17      CALL    _FFLUSH
0007E6 D55F E5              11      PUSH    HL
0007E7 D560 218000          10      LD  HL,00080H
0007EA D563 228AF0          16      LD  (_DTA),HL
0007ED D566 E1              10      POP HL
0007EE D567 D5              11      PUSH    DE
0007EF D568 1E00             7      LD  E,0
0007F1 D56A 3E                      DB  03EH
                                
       D56B                     _SYS0E:     ;(BDOS)カレントドライブの設定
0007F2 D56B D5              11      PUSH    DE
0007F3 D56C 7B               4      LD  A,E
0007F4 D56D DDE5            15      PUSH    IX
0007F6 D56F CDDCF0          17      CALL    _GETDPB
0007F9 D572 DDE1            14      POP IX
0007FB D574 3804            12      JR  C,SX0E2
0007FD D576 7B               4      LD  A,E
0007FE D577 3287F0          13      LD  (_DVSW),A
       D57A                     SX0E2:
000801 D57A D1              10      POP DE
000802 D57B C9              10      RET
                                
       D57C                     _SYS0F:     ;(BDOS)ファイルのオープン
000803 D57C CD2BDD          17      CALL    SETDRV
000806 D57F FD7E1C          19      LD  A,(IY+28)   ;(FCB)オープンモード
000809 D582 C602             7      ADD A,002H      ;Write
00080B D584 2848            12      JR  Z,FEND0F
00080D D586 CD79E0          17      CALL    CHKWILDX
                                
000810 D589 D44BDD          17      CALL    NC,SOPENX
       D58C                     _S16XX:
000813 D58C 3840            12      JR  C,FEND0F
                                                ;Directory location
000815 D58E 3A9FF0          13      LD  A,(_FILEN)
000818 D591 FD7719          19      LD  (IY+25),A   ;(FCB)ディレクトリロケーション
                                ;               _DIRF
00081B D594 3AA0F0          13      LD  A,(_DIRF)
00081E D597 FD771D          19      LD  (IY+29),A   ;(FCB)ディレクトリモード
                                ;               _FBPS
000821 D59A FD731E          19      LD  (IY+30),E   ;(FCB)ディレクトリポジション
000824 D59D FD721F          19      LD  (IY+31),D
                                ;               Open(Read)
000827 D5A0 FD361CFF        19      LD  (IY+28),0FFH    ;(FCB)オープンモード
                                ;               FILENAME
00082B D5A4 FDE5            15      PUSH    IY
00082D D5A6 D1              10      POP DE
00082E D5A7 13               6      INC DE
00082F D5A8 010B00          10      LD  BC,11
000832 D5AB EDB0                    LDIR
                                ;               Attribute
000834 D5AD 7E               7      LD  A,(HL)
000835 D5AE FD770D          19      LD  (IY+13),A   ;(FCB)属性(アトリビュート)
000838 D5B1 110B00          10      LD  DE,11       ;Reserved
00083B D5B4 19              11      ADD HL,DE
                                                    ;(FCB)ファイルを最後に変更した時刻
00083C D5B5 11E4F1          10      LD  DE,SDDATA       ;(FCB)ファイルを最後に変更した日付
00083F D5B8 060A             7      LD  B,SDDATAE-SDDATA    ;(FCB)ファイルの先頭クラスタ
       D5BA                     S16LOOP:                ;(FCB)ファイルのサイズ(バイト単位)
000841 D5BA 1A               7      LD  A,(DE)
000842 D5BB 13               6      INC DE
000843 D5BC 32C3D5          13      LD  (S16PAT+2),A
000846 D5BF 7E               7      LD  A,(HL)
000847 D5C0 23               6      INC HL
000848 D5C1 FD7700          19  S16PAT: LD  (IY+0),A
00084B D5C4 10F4            13      DJNZ    S16LOOP
                                
00084D D5C6 AF               4      XOR A
00084E D5C7 FD770C          19      LD  (IY+12),A   ;(FCB)カレントブロック
000851 D5CA FD2272D6        20      LD  (OFCB+1),IY
       D5CE                     FEND0F:
000855 D5CE 1845            12      JR  FEND10
                                
       D5D0                     _SYS10:     ;(BDOS)ファイルのクローズ
000857 D5D0 CD2BDD          17      CALL    SETDRV
00085A D5D3 FD7E1C          19      LD  A,(IY+28)   ;(FCB)オープンモード
00085D D5D6 D6FE             7      SUB 0FEH
00085F D5D8 37               4      SCF
000860 D5D9 3F               4      CCF
000861 D5DA 2039            12      JR  NZ,FEND10
       D5DC                     _S10A:              ;Write
000863 D5DC FD770E          19      LD  (IY+14),A   ;(FCB)レコードサイズ/アクセスするディレクトリのクラスタ番号+1
000866 D5DF FD770F          19      LD  (IY+15),A
                                
000869 D5E2 FD341C          23      INC (IY+28)     ;0FEH->0FFH ;オープンモード
00086C D5E5 CD75E1          17      CALL    SETTMS
                                
00086F D5E8 FD7E1D          19      LD  A,(IY+29)   ;(FCB)ディレクトリモード
000872 D5EB 32A0F0          13      LD  (_DIRF),A
000875 D5EE E67F             7      AND 07FH
000877 D5F0 32A0E6          13      LD  (_SECPS+1),A
00087A D5F3 FD5E1E          19      LD  E,(IY+30)   ;(FCB)ディレクトリポジション
00087D D5F6 FD561F          19      LD  D,(IY+31)
000880 D5F9 CD7FDE          17      CALL    READ_DIR
000883 D5FC 3817            12      JR  C,FEND10
                                
000885 D5FE 3AA9DD          13  SDECM1: LD  A,(SDECPAT+1)   ;1セクタ辺りのディレクトリエントリ数
000888 D601 3D               4      DEC A       ;1024=01FH / 512=00FH / 256=7
000889 D602 FDA619          19      AND (IY+25)     ;(FCB)ディレクトリロケーション
00088C D605 6F               4      LD  L,A
00088D D606 2600             7      LD  H,0
00088F D608 29              11      ADD HL,HL       ;*2
000890 D609 29              11      ADD HL,HL       ;*4
000891 D60A 29              11      ADD HL,HL       ;*8
000892 D60B 29              11      ADD HL,HL       ;*16
000893 D60C 29              11      ADD HL,HL       ;*32
000894 D60D ED4B7EF1        20      LD  BC,(_DTBUF)
000898 D611 09              11      ADD HL,BC
                                
000899 D612 CD89E0          17      CALL    SDIRENT
       D615                     FEND10:
00089C D615 1842            12      JR  FEND
                                
       D617                     _SYS11:     ;(BDOS)最初のファイルの検索
00089E D617 CD2BDD          17      CALL    SETDRV
0008A1 D61A CD78DD          17      CALL    SOPEN
       D61D                     _S12X1:
0008A4 D61D 383A            12      JR  C,FEND
0008A6 D61F CD18DE          17      CALL    SOPENE2
0008A9 D622 ED5B8AF0        20      LD  DE,(_DTA)
0008AD D626 3A88F0          13      LD  A,(_DRV)
0008B0 D629 3C               4      INC A
0008B1 D62A 12               7      LD  (DE),A
0008B2 D62B D5              11      PUSH    DE
0008B3 D62C 13               6      INC DE
0008B4 D62D 012000          10      LD  BC,32
0008B7 D630 EDB0                    LDIR
0008B9 D632 FD6E0E          19      LD  L,(IY+14)   ;(FCB)レコードサイズ/アクセスするディレクトリのクラスタ番号+1
0008BC D635 FD660F          19      LD  H,(IY+15)
0008BF D638 22F4F1          16      LD  (SCDIR),HL
0008C2 D63B 2A9AF0          16      LD  HL,(_FBPS)
0008C5 D63E 22F6F1          16      LD  (SFBPS),HL
0008C8 D641 2A9FF0          16      LD  HL,(_FILEN)
0008CB D644 7C               4      LD  A,H
0008CC D645 B7               4      OR  A
0008CD D646 2806            12      JR  Z,_S12DIR
0008CF D648 3AA0E6          13      LD  A,(_SECPS+1)
0008D2 D64B F680             7      OR  080H
0008D4 D64D 67               4      LD  H,A
       D64E                     _S12DIR:
0008D5 D64E 22F8F1          16      LD  (SFNDF),HL  ;Directory position and Flags
0008D8 D651 E1              10      POP HL
0008D9 D652 1139F0          10      LD  DE,SFILE
0008DC D655 0E21             7      LD  C,33
       D657                     _S11B:
0008DE D657 EDB0                    LDIR
       D659                     FEND:
0008E0 D659 9F               4      SBC A,A     ;CF=0 A=0 : CF=1 A=0FFH
       D65A                     FENDE:
0008E1 D65A FDE1            14      POP IY
0008E3 D65C C1              10      POP BC
0008E4 D65D D1              10      POP DE
0008E5 D65E E1              10      POP HL
0008E6 D65F C9              10      RET
                                
       D660                     _SYS12:     ;(BDOS)次のファイルの検索
0008E7 D660 E5              11      PUSH    HL
0008E8 D661 D5              11      PUSH    DE
0008E9 D662 C5              11      PUSH    BC
0008EA D663 FDE5            15      PUSH    IY
0008EC D665 CDDCDD          17      CALL    NOPEN
0008EF D668 18B3            12      JR  _S12X1
                                
       D66A                     _S16K:
0008F1 D66A FD7E1C          19      LD  A,(IY+28)   ;(FCB)オープンモード
0008F4 D66D FEFD             7      CP  0FDH        ;Device(0FDH)
0008F6 D66F 37               4      SCF
0008F7 D670 C8              11      RET Z
                                
0008F8 D671 110000          10  OFCB:   LD  DE,0
0008FB D674 D5              11      PUSH    DE
0008FC D675 061A             7      LD  B,26        ;First cluster
       D677                     S16K1:
0008FE D677 13               6      INC DE
0008FF D678 23               6      INC HL
000900 D679 10FC            13      DJNZ    S16K1
                                
000902 D67B 1A               7      LD  A,(DE)
000903 D67C BE               7      CP  (HL)
000904 D67D 2013            12      JR  NZ,S16K2
000906 D67F 13               6      INC DE
000907 D680 23               6      INC HL
000908 D681 1A               7      LD  A,(DE)
000909 D682 BE               7      CP  (HL)
00090A D683 200D            12      JR  NZ,S16K2
                                
00090C D685 E1              10      POP HL
00090D D686 FDE5            15      PUSH    IY
00090F D688 D1              10      POP DE
000910 D689 1A               7      LD  A,(DE)      ;Drive
000911 D68A BE               7      CP  (HL)
000912 D68B 2006            12      JR  NZ,S16K3
                                                ;ここはCFが必ず0
000914 D68D ED52            15      SBC HL,DE       ;CP HL,DE
000916 D68F 37               4      SCF
000917 D690 C0              11      RET NZ
000918 D691 E5              11      PUSH    HL
       D692                     S16K2:
000919 D692 E1              10      POP HL
       D693                     S16K3:
00091A D693 FDE5            15      PUSH    IY
00091C D695 D1              10      POP DE
       D696                     _SYS13:     ;(BDOS)ファイルの削除
00091D D696 CD2BDD          17      CALL    SETDRV
000920 D699 CDA9DF          17      CALL    KILL
       D69C                     FEND13:
000923 D69C 18BB            12      JR  FEND
                                
       D69E                     _SYS14:     ;(BDOS)シーケンシャルな読み出し
000925 D69E CD2BDD          17      CALL    SETDRV
000928 D6A1 CDE1E1          17      CALL    INIT_SEQ
       D6A4                     SREAD:
00092B D6A4 CD29E2          17      CALL    RB_READ
                                
00092E D6A7 C601             7      ADD A,001H
000930 D6A9 38AE            12      JR  C,FEND
                                
000932 D6AB 7D               4      LD  A,L
000933 D6AC D601             7      SUB 001H
       D6AE                     FENDX:
000935 D6AE 9F               4      SBC A,A
000936 D6AF E603             7      AND 3
000938 D6B1 1F               4      RRA
000939 D6B2 18A6            12      JR  FENDE
                                
       D6B4                     _SYS15:     ;(BDOS)シーケンシャルな書き込み
00093B D6B4 CD2BDD          17      CALL    SETDRV
00093E D6B7 CDE1E1          17      CALL    INIT_SEQ
       D6BA                     SWRITE:
000941 D6BA CD22E2          17      CALL    RB_WRITE
                                
000944 D6BD C6FF             7      ADD A,0FFH
000946 D6BF 18ED            12      JR  FENDX
                                
       D6C1                     _SYS17:     ;(BDOS)ファイル名の変更
000948 D6C1 CD2BDD          17      CALL    SETDRV
00094B D6C4 CDFFDF          17      CALL    NAME
00094E D6C7 18D3            12      JR  FEND13
                                
       D6C9                     _SYS16:     ;(BDOS)ファイルの作成
000950 D6C9 CD2BDD          17      CALL    SETDRV
                                
000953 D6CC CD79E0          17      CALL    CHKWILDX
000956 D6CF 38CB            12      JR  C,FEND13
000958 D6D1 FD7E01          19      LD  A,(IY+1)    ;(FCB)主ファイル名
00095B D6D4 FE05             7      CP  5
00095D D6D6 2805            12      JR  Z,_S16X2
00095F D6D8 FE21             7      CP  021H
000961 D6DA DA9CD6          10      JP  C,FEND13
       D6DD                     _S16X2:
                                ;               Clear FCB
000964 D6DD FDE5            15      PUSH    IY
000966 D6DF E1              10      POP HL
000967 D6E0 011000          10      LD  BC,16
00096A D6E3 09              11      ADD HL,BC
       D6E4                     _S16X1:
00096B D6E4 70               7      LD  (HL),B      ;B=0
00096C D6E5 23               6      INC HL
00096D D6E6 0D               4      DEC C
00096E D6E7 20FB            12      JR  NZ,_S16X1
                                
000970 D6E9 CD7AE1          17      CALL    SETTMSX
000973 D6EC FD360DFF        19      LD  (IY+13),0FFH    ;(FCB)Attribute
000977 D6F0 CD4BDD          17      CALL    SOPENX
00097A D6F3 3F               4      CCF
00097B D6F4 CC6AD6          17      CALL    Z,_S16K
00097E D6F7 D429DE          17      CALL    NC,COPEN
000981 D6FA D489E0          17      CALL    NC,SDIRENT
000984 D6FD C38CD5          10      JP  _S16XX
                                
       D700                     _SYS21:     ;(BDOS)ランダムな読み出し
000987 D700 CD2BDD          17      CALL    SETDRV
00098A D703 CDC5E1          17      CALL    INIT_RND
00098D D706 189C            12      JR  SREAD
                                
       D708                     _SYS22:     ;(BDOS)ランダムな書き込み
       D708                     _SYS28:     ;(BDOS)ランダムな書き込み・その2
00098F D708 CD2BDD          17      CALL    SETDRV
000992 D70B CDC5E1          17      CALL    INIT_RND
000995 D70E 18AA            12      JR  SWRITE
                                
       D710                     _SYS18:     ;(BDOS)ログインベクトルの獲得
000997 D710 21FF00          10      LD  HL,000FFH
00099A D713 AF               4      XOR A
00099B D714 C9              10      RET
                                
       D715                     _SYS19:     ;(BDOS)カレントドライブ番号の獲得
00099C D715 3A87F0          13      LD  A,(_DVSW)
00099F D718 A7               4      AND A
0009A0 D719 C9              10      RET
                                
       D71A                     _SYS1A:     ;(BDOS)DTAの設定
0009A1 D71A ED538AF0        20      LD  (_DTA),DE
0009A5 D71E AF               4      XOR A
0009A6 D71F C9              10      RET
                                
       D720                     _SYS1B:     ;(BDOS)ディスク情報の獲得
0009A7 D720 7B               4      LD  A,E
0009A8 D721 CD3EDD          17      CALL    GETDRV
0009AB D724 CDDCF0          17      CALL    _GETDPB
0009AE D727 D4E2F0          17      CALL    NC,_RDFATX
0009B1 D72A 210000          10      LD  HL,0
0009B4 D72D D453E1          17      CALL    NC,DSKF
                                
0009B7 D730 ED5B54E1        20      LD  DE,(MAXCLP+1)   ;DPB_MAXCL-1
0009BB D734 1B               6      DEC DE      ;DE←クラスタの総数
0009BC D735 FD2A7CF1        20      LD  IY,(_FATBF) ;IY←メモリ上のFATの先頭アドレス
0009C0 D739 9F               4      SBC A,A
0009C1 D73A D8              11      RET C
0009C2 D73B 4F               4      LD  C,A     ;C=0
0009C3 D73C DD7E0F          19      LD  A,(IX+DPB_BPS)
0009C6 D73F E60F             7      AND 00FH
0009C8 D741 47               4      LD  B,A
0009C9 D742 DD7E07          19      LD  A,(IX+DPB_SECPCL)
0009CC D745 C9              10      RET
                                
       D746                     _SYS1D:     ;(BDOS)書き込みが禁止されているディスクの調査
0009CD D746 AF               4      XOR A
0009CE D747 67               4      LD  H,A
0009CF D748 6F               4      LD  L,A
0009D0 D749 C9              10      RET
                                
       D74A                     _SYS1F:     ;(BDOS)ディスク装置のパラメータの読み出し
0009D1 D74A 2100F2          10      LD  HL,_DEVICE
0009D4 D74D 7B               4      LD  A,E
0009D5 D74E C3DCF0          10      JP  _GETDPB
                                
       D751                     _SYS23:     ;(BDOS)ファイルサイズの獲得
0009D8 D751 E5              11      PUSH    HL
0009D9 D752 2A1EF1          16      LD  HL,(STABLE+2*00FH)  ;ファイルのオープン
0009DC D755 CD0F00          17      CALL    JP_HL
0009DF D758 381B            12      JR  C,_S23X1
                                
0009E1 D75A D5              11      PUSH    DE      ;EX DE,IY
0009E2 D75B FDE3            23      EX  (SP),IY     ;
                                ;   POP DE      ;
                                ;   PUSH    DE      ;DEを破壊しないように注意vv
0009E4 D75D FD7E10          19      LD  A,(IY+16)   ;(FCB)ファイルのサイズ(バイト単位)
0009E7 D760 FD6E11          19      LD  L,(IY+17)   ;
0009EA D763 FD6612          19      LD  H,(IY+18)   ;
0009ED D766 C5              11      PUSH    BC      ;
0009EE D767 FD4613          19      LD  B,(IY+19)   ;
0009F1 D76A CDB7E1          17      CALL    GET_CPM_R_SIZE
0009F4 D76D C1              10      POP BC
       D76E                     _S24X1:
0009F5 D76E CDD7E1          17      CALL    SET_RR_AHL
                                ;   POP DE      ;^^^^^^^^^^^^^^^^^^^^^^^^
                                ;   PUSH    DE      ;EX DE,IY
0009F8 D771 FDE3            23      EX  (SP),IY     ;
0009FA D773 D1              10      POP DE      ;
                                
0009FB D774 AF               4      XOR A
       D775                     _S23X1:
0009FC D775 E1              10      POP HL
0009FD D776 C9              10      RET
                                
       D777                     _SYS24:     ;(BDOS)ランダムレコードフィールドの設定
0009FE D777 E5              11      PUSH    HL
0009FF D778 D5              11      PUSH    DE      ;EX DE,IY
000A00 D779 FDE3            23      EX  (SP),IY     ;
                                ;   POP DE      ;
                                ;   PUSH    DE      ;DEを破壊しないように注意vv
000A02 D77B CDE9E1          17      CALL    GETSEQ
000A05 D77E 18EE            12      JR  _S24X1      ;^^^^^^^^^^^^^^^^^^^^^^^^
                                
       D780                     _SYS29:     ;(BDOS)ファイル名の解析(_PPATH)
000A07 D780 C5              11      PUSH    BC
000A08 D781 E5              11      PUSH    HL
000A09 D782 CD42DC          17      CALL    FILE
000A0C D785 E1              10      POP HL
000A0D D786 C1              10      POP BC
       D787                     S29X1:
000A0E D787 C5              11      PUSH    BC
000A0F D788 D5              11      PUSH    DE
000A10 D789 E5              11      PUSH    HL
000A11 D78A EB               4      EX  DE,HL
000A12 D78B AF               4      XOR A
000A13 D78C 3221F0          13      LD  (FDRV+13),A
000A16 D78F 2114F0          10      LD  HL,FDRV
000A19 D792 011000          10      LD  BC,16
000A1C D795 EDB0                    LDIR
000A1E D797 E1              10      POP HL
000A1F D798 D1              10      POP DE
000A20 D799 C1              10      POP BC
000A21 D79A C9              10      RET
                                
       D79B                     _SYS30:     ;(BDOS)論理セクタを用いた書き込み
000A22 D79B C5              11      PUSH    BC
000A23 D79C 013AE8          10      LD  BC,DWT24B
000A26 D79F 1804            12      JR  S2FX
       D7A1                     _SYS2F:
000A28 D7A1 C5              11      PUSH    BC
000A29 D7A2 012AE8          10      LD  BC,DRD24B
       D7A5                     S2FX:
000A2C D7A5 ED43BBD7        20      LD  (S2FPAT+1),BC
000A30 D7A9 CDDFF0          17      CALL    _FFLUSH
                                
000A33 D7AC D5              11      PUSH    DE
000A34 D7AD E5              11      PUSH    HL
000A35 D7AE 7D               4      LD  A,L     ;Drive
000A36 D7AF CDD9F0          17      CALL    _CHGDRV
000A39 D7B2 3809            12      JR  C,S30X2
000A3B D7B4 44               4      LD  B,H     ;Number of clusters
000A3C D7B5 2A8AF0          16      LD  HL,(_DTA)
                                
000A3F D7B8 0E00             7      LD  C,0
000A41 D7BA CD2AE8          17  S2FPAT: CALL    DRD24B
       D7BD                     S30X2:
000A44 D7BD E1              10      POP HL
000A45 D7BE D1              10      POP DE
000A46 D7BF C1              10      POP BC
000A47 D7C0 9F               4      SBC A,A
000A48 D7C1 C9              10      RET
                                
       D7C2                     _SYS5A:     ;(BDOS)カレントディレクトリの変更
000A49 D7C2 C5              11      PUSH    BC
000A4A D7C3 D5              11      PUSH    DE
000A4B D7C4 E5              11      PUSH    HL
000A4C D7C5 CD37DC          17      CALL    FILEC
000A4F D7C8 210000          10      LD  HL,0
000A52 D7CB 1114F0          10      LD  DE,FDRV
000A55 D7CE 2A4EF1          16      LD  HL,(STABLE+2*027H)  ;ランダムブロック読み込み
000A58 D7D1 CD0F00          17      CALL    JP_HL
000A5B D7D4 18E7            12      JR  S30X2
[EOF:LDOS.ASM:SHIFT_JIS]
                                    INCLUDE "M7IO.ASM"
                                
                                ;   LSX-Dodgers IO
                                ;   MZ-700/1500
                                
       D540                     _SYS04  EQU _ERROR      ;(BDOS)外部出力
       D540                     _SYS05  EQU _ERROR      ;(BDOS)プリンタ出力
       D540                     _SYS1C  EQU _ERROR      ;(BDOS)ディスクの書き込み禁止化
       D540                     _SYS1E  EQU _ERROR      ;(BDOS)ファイル属性の設定
       D540                     _SYS20  EQU _ERROR      ;(BDOS)利用者番号の設定と読み出し
       D540                     _SYS2E  EQU _ERROR      ;(BDOS)ベリファイ・フラグの設定
                                
       0000                     INT EQU 0
       0000                     INTCTCE EQU 0
       0000                     INTCTC2 EQU 0
                                
       D7D6                     ARWKEY:
000A5D D7D6 3D               4      DEC A
000A5E D7D7 32F2D7          13      LD  (KEYAR),A
000A61 D7DA 1826            12      JR  INT8253E
       D7DC                     SETKEY1:
000A63 D7DC 3A95F0          13      LD  A,(_KEYSP+1)
000A66 D7DF 1815            12      JR  SETKEY
       D7E1                     INT8253:
000A68 D7E1 CDC9DB          17      CALL    CHKEY
000A6B D7E4 FE00             7      CP  0
       D7E5                     KEYDT   EQU $-1
000A6D D7E6 20F4            12      JR  NZ,SETKEY1
000A6F D7E8 E5              11      PUSH    HL
000A70 D7E9 2A90F0          16      LD  HL,(_KEYPS)
000A73 D7EC 7C               4      LD  A,H
000A74 D7ED AD               4      XOR L
000A75 D7EE E1              10      POP HL
000A76 D7EF 2011            12      JR  NZ,INT8253E
000A78 D7F1 3E00             7      LD  A,0
       D7F2                     KEYAR   EQU $-1
000A7A D7F3 B7               4      OR  A
000A7B D7F4 20E0            12      JR  NZ,ARWKEY
       D7F6                     SETKEY:
000A7D D7F6 32F2D7          13      LD  (KEYAR),A
000A80 D7F9 3A92F0          13      LD  A,(_KEYD)
000A83 D7FC 32E5D7          13      LD  (KEYDT),A
000A86 D7FF CD05D8          17      CALL    KEYSET
       D802                     INT8253E:
000A89 D802 F1              10      POP AF
000A8A D803 FB               4      EI
000A8B D804 C9              10      RET
       D805                     KEYSET:
       D805                     KEYBS:
000A8C D805 B7               4      OR  A
000A8D D806 C8              11      RET Z
       D807                     KEYBS1:
000A8E D807 CD1FD8          17      CALL    KEYBC_IFBREAK
000A91 D80A E5              11      PUSH    HL
000A92 D80B F5              11      PUSH    AF
000A93 D80C 2A90F0          16      LD  HL,(_KEYPS)
000A96 D80F 2C               4      INC L
000A97 D810 CBAD             8      RES 5,L
000A99 D812 7D               4      LD  A,L
000A9A D813 BC               4      CP  H
000A9B D814 2815            12      JR  Z,POP_AF_HL_SCF_RET
000A9D D816 3290F0          13      LD  (_KEYPS),A
000AA0 D819 26FF             7      LD  H,KEYBF/256
000AA2 D81B F1              10      POP AF
000AA3 D81C 77               7      LD  (HL),A
000AA4 D81D E1              10      POP HL
000AA5 D81E C9              10      RET
       D81F                     KEYBC_IFBREAK:
000AA6 D81F FE03             7      CP  3
000AA8 D821 C0              11      RET NZ
       D822                     KEYBC:
000AA9 D822 E5              11      PUSH    HL
000AAA D823 210000          10      LD  HL,0
000AAD D826 2290F0          16      LD  (_KEYPS),HL
000AB0 D829 E1              10      POP HL
000AB1 D82A C9              10      RET
                                
       D82B                     POP_AF_HL_SCF_RET:
000AB2 D82B F1              10      POP AF
000AB3 D82C E1              10      POP HL
000AB4 D82D 37               4      SCF
000AB5 D82E C9              10      RET
                                
       D82F                     _SYS01:     ;(BDOS)コンソール入力
000AB6 D82F CD09F0          17      CALL    _SYS07
       D832                     MSG_A:
000AB9 D832 F5              11      PUSH    AF
000ABA D833 D5              11      PUSH    DE
000ABB D834 5F               4      LD  E,A
000ABC D835 CD3BD8          17      CALL    _SYS02
000ABF D838 D1              10      POP DE
000AC0 D839 F1              10      POP AF
000AC1 D83A C9              10      RET
                                
       D83B                     _SYS02:     ;(BDOS)コンソール出力
000AC2 D83B CD4DD8          17      CALL    BREAK
000AC5 D83E 1805            12      JR  PRINTX
                                
       D840                     _SYS06:     ;(BDOS)コンソール直接入出力
000AC7 D840 7B               4      LD  A,E
000AC8 D841 3C               4      INC A
000AC9 D842 CACAF0          10      JP  Z,_INKEY
       D845                     PRINTX:
000ACC D845 C3CDF0          10      JP  _PRINT
                                
       D848                     _SYS08:     ;(BDOS)エコーなしコンソール入力
000ACF D848 CD09F0          17      CALL    _SYS07
000AD2 D84B 1804            12      JR  BREAK1
       D84D                     BREAK:
000AD4 D84D FB               4      EI
000AD5 D84E 3A92F0          13      LD  A,(_KEYD)
       D851                     BREAK1:
000AD8 D851 FE03             7      CP  3       ;CTRL+C
000ADA D853 CA00F0          10      JP  Z,CPM_BOOT
000ADD D856 FE13             7      CP  013H        ;CTRL+S
000ADF D858 C0              11      RET NZ
                                
       D859                     PAUSE:
000AE0 D859 CD22D8          17      CALL    KEYBC
                                
       D85C                     FLGET:
000AE3 D85C CDDFF0          17      CALL    _FFLUSH
000AE6 D85F E5              11      PUSH    HL
000AE7 D860 2A8EF0          16      LD  HL,(_TXADR)
000AEA D863 7C               4      LD  A,H
000AEB D864 C6D0             7      ADD A,0D0H
000AED D866 67               4      LD  H,A
000AEE D867 CD37CF          17      CALL    RDMMIO
000AF1 D86A 327FD8          13      LD  (FLSMC),A
       D86D                     FLGET1:
000AF4 D86D CD2DCF          17      CALL    RD556VSYNC
000AF7 D870 CB77             8      BIT 6,A
000AF9 D872 3EEF             7      LD  A,0EFH      ;カーソル
000AFB D874 200A            12      JR  NZ,FLGET2
000AFD D876 3A92F0          13      LD  A,(_KEYD)
000B00 D879 B7               4      OR  A
000B01 D87A 3EEF             7      LD  A,0EFH      ;カーソル
000B03 D87C 2002            12      JR  NZ,FLGET2
       D87F                     FLSMC   EQU $+1
000B05 D87E 3E00             7      LD  A,0     ;自己書き換え
       D880                     FLGET2:
000B07 D880 CD3FCF          17      CALL    WRMMIO
000B0A D883 CDCAF0          17      CALL    _INKEY
000B0D D886 28E5            12      JR  Z,FLGET1
000B0F D888 F5              11      PUSH    AF
000B10 D889 3A7FD8          13      LD  A,(FLSMC)
000B13 D88C CD3FCF          17      CALL    WRMMIO
000B16 D88F F1              10      POP AF
000B17 D890 E1              10      POP HL
000B18 D891 C9              10      RET
                                
       D892                     _SYS0A:     ;(BDOS)文字列入力
000B19 D892 C5              11      PUSH    BC
000B1A D893 E5              11      PUSH    HL
000B1B D894 D5              11      PUSH    DE
000B1C D895 CD27DB          17      CALL    GETL
000B1F D898 1120FF          10      LD  DE,KBUF
000B22 D89B E1              10      POP HL
000B23 D89C E5              11      PUSH    HL
000B24 D89D 0E00             7      LD  C,0
000B26 D89F 3004            12      JR  NC,SAX0
000B28 D8A1 23               6      INC HL
000B29 D8A2 23               6      INC HL
000B2A D8A3 1808            12      JR  SAX4
       D8A5                     SAX0:
000B2C D8A5 46               7      LD  B,(HL)
000B2D D8A6 23               6      INC HL
       D8A7                     SAX1:
000B2E D8A7 23               6      INC HL
000B2F D8A8 1A               7      LD  A,(DE)
000B30 D8A9 13               6      INC DE
000B31 D8AA B7               4      OR  A
000B32 D8AB 2004            12      JR  NZ,SAX2
       D8AD                     SAX4:
000B34 D8AD 360D            10      LD  (HL),00DH
000B36 D8AF 1804            12      JR  SAX3
       D8B1                     SAX2:
000B38 D8B1 77               7      LD  (HL),A
000B39 D8B2 0C               4      INC C
000B3A D8B3 10F2            13      DJNZ    SAX1
       D8B5                     SAX3:
000B3C D8B5 D1              10      POP DE
000B3D D8B6 79               4      LD  A,C
000B3E D8B7 13               6      INC DE
000B3F D8B8 12               7      LD  (DE),A
000B40 D8B9 1B               6      DEC DE
000B41 D8BA E1              10      POP HL
000B42 D8BB C1              10      POP BC
000B43 D8BC A7               4      AND A
000B44 D8BD C9              10      RET
                                
       D8BE                     _SYS0B:     ;(BDOS)コンソール状態のチェック
000B45 D8BE CD4DD8          17      CALL    BREAK
000B48 D8C1 3A92F0          13      LD  A,(_KEYD)
000B4B D8C4 B7               4      OR  A
000B4C D8C5 C8              11      RET Z
       D8C6                     CONSTX:
000B4D D8C6 CDDFF0          17      CALL    _FFLUSH
000B50 D8C9 E5              11      PUSH    HL
000B51 D8CA 2A90F0          16      LD  HL,(_KEYPS)
000B54 D8CD 7C               4      LD  A,H
000B55 D8CE AD               4      XOR L
000B56 D8CF E1              10      POP HL
000B57 D8D0 C6FF             7      ADD A,0FFH
000B59 D8D2 9F               4      SBC A,A
000B5A D8D3 C9              10      RET
                                
       D8D4                     _SYS2A:     ;(BDOS)日付の獲得
000B5B D8D4 AF               4      XOR A
000B5C D8D5 57               4      LD  D,A
000B5D D8D6 5F               4      LD  E,A
000B5E D8D7 67               4      LD  H,A
000B5F D8D8 6F               4      LD  L,A
000B60 D8D9 C9              10      RET
                                
       D8DA                     _SYS2C:     ;(BDOS)時刻の獲得
000B61 D8DA AF               4      XOR A
000B62 D8DB 57               4      LD  D,A
000B63 D8DC 5F               4      LD  E,A
000B64 D8DD 67               4      LD  H,A
000B65 D8DE 6F               4      LD  L,A
000B66 D8DF C9              10      RET
                                
       D8E0                     ESC1:
000B67 D8E0 7B               4      LD  A,E
000B68 D8E1 FE41             7      CP  'A'
000B6A D8E3 CAD8D9          10      JP  Z,CTRL1E
000B6D D8E6 FE42             7      CP  'B'
000B6F D8E8 CAEADA          10      JP  Z,CTRL1F
000B72 D8EB FE43             7      CP  'C'
000B74 D8ED CAABD9          10      JP  Z,CTRL1C
000B77 D8F0 FE44             7      CP  'D'
000B79 D8F2 CACFD9          10      JP  Z,CTRL1D
000B7C D8F5 FE45             7      CP  'E'
000B7E D8F7 2802            12      JR  Z,CT0CX
000B80 D8F9 FE6A             7      CP  'j'
       D8FB                     CT0CX:
000B82 D8FB CACFDA          10      JP  Z,CTRL0C
000B85 D8FE FE48             7      CP  'H'
000B87 D900 CA4CDA          10      JP  Z,CTRL0B
000B8A D903 FE4A             7      CP  'J'
000B8C D905 CAD2DA          10      JP  Z,CTRL06
000B8F D908 FE4B             7      CP  'K'
000B91 D90A CA1EDA          10      JP  Z,CTRL05
000B94 D90D FE4C             7      CP  'L'
000B96 D90F CAFCDA          10      JP  Z,CTRL0E
000B99 D912 FE54             7      CP  'T'
000B9B D914 CA1EDA          10      JP  Z,CTRL05
000B9E D917 FE78             7      CP  'x'
000BA0 D919 2804            12      JR  Z,ESC1X
000BA2 D91B FE79             7      CP  'y'
000BA4 D91D 2002            12      JR  NZ,ESC1Y
       D91F                     ESC1X:
000BA6 D91F 3601            10      LD  (HL),1
       D921                     ESC1Y:
000BA8 D921 FE3D             7      CP  '='
000BAA D923 2804            12      JR  Z,ESC1W
000BAC D925 FE59             7      CP  'Y'
000BAE D927 2002            12      JR  NZ,ESC1Z
       D929                     ESC1W:
000BB0 D929 3602            10      LD  (HL),2
       D92B                     ESC1Z:
000BB2 D92B FE20             7      CP  020H
000BB4 D92D 3802            12      JR  C,ESC1C
000BB6 D92F 87               4      ADD A,A
000BB7 D930 D0              11      RET NC
       D931                     ESC1C:
000BB8 D931 E1              10      POP HL
000BB9 D932 1832            12      JR  ANK
                                
       D934                     ESC:
000BBB D934 2197D9          10      LD  HL,PRINTE5
000BBE D937 E5              11      PUSH    HL
000BBF D938 215AD9          10      LD  HL,ESCFLG
000BC2 D93B 3600            10      LD  (HL),0
000BC4 D93D 3D               4      DEC A
000BC5 D93E 28A0            12      JR  Z,ESC1
000BC7 D940 3D               4      DEC A
000BC8 D941 2009            12      JR  NZ,ESC2
000BCA D943 3603            10      LD  (HL),3
000BCC D945 7B               4      LD  A,E
000BCD D946 D620             7      SUB 020H
000BCF D948 324FD9          13      LD  (ESCYP+1),A
000BD2 D94B C9              10      RET
       D94C                     ESC2:
000BD3 D94C 3D               4      DEC A
000BD4 D94D C0              11      RET NZ
000BD5 D94E 2600             7  ESCYP:  LD  H,0
000BD7 D950 7B               4      LD  A,E
000BD8 D951 D620             7      SUB 020H
000BDA D953 6F               4      LD  L,A
000BDB D954 C3D6F0          10      JP  _LOC
                                
       D957                     PRINT:
000BDE D957 C5              11      PUSH    BC
000BDF D958 E5              11      PUSH    HL
       D95A                     ESCFLG  EQU $+1
000BE0 D959 3E00             7      LD  A,000H      ;自己書き換え
000BE2 D95B B7               4      OR  A
000BE3 D95C 20D6            12      JR  NZ,ESC
                                
000BE5 D95E 3E1F             7      LD  A,01FH
000BE7 D960 BB               4      CP  E
000BE8 D961 3038            12      JR  NC,CTRL
       D963                     INSFLG  EQU $
000BEA D963 01A4DA          10      LD  BC,INSERT   ;自己書き換え
       D966                     ANK:
000BED D966 3A96F0          13      LD  A,(_COLORF)
000BF0 D969 4F               4      LD  C,A
000BF1 D96A 7B               4      LD  A,E
000BF2 D96B FE61             7      CP  'a'     ;英小文字
000BF4 D96D 3806            12      JR  C,PRT1
000BF6 D96F FE7B             7      CP  'z'+1
000BF8 D971 3002            12      JR  NC,PRT1
000BFA D973 CBF9             8      SET 7,C
       D975                     PRT1:
000BFC D975 FE86             7      CP  $86     ;ひらがな1(を－そ)
000BFE D977 3806            12      JR  C,PRT2
000C00 D979 FEA0             7      CP  $A0
000C02 D97B 3002            12      JR  NC,PRT2
000C04 D97D CBF9             8      SET 7,C
       D97F                     PRT2:
000C06 D97F FEE0             7      CP  $E0     ;ひらがな2(たーん)
000C08 D981 3802            12      JR  C,PRT3
000C0A D983 CBF9             8      SET 7,C
       D985                     PRT3:
000C0C D985 2A8EF0          16      LD  HL,(_TXADR)
000C0F D988 7C               4      LD  A,H
000C10 D989 C6D0             7      ADD A,0D0H
000C12 D98B 67               4      LD  H,A
000C13 D98C 42               4      LD  B,D
000C14 D98D 16EE             7      LD  D,CD_TABLE/256
000C16 D98F 1A               7      LD  A,(DE)
000C17 D990 50               4      LD  D,B
000C18 D991 CD57CF          17      CALL    IO_PRINT
000C1B D994 CDABD9          17      CALL    CTRL1C
       D997                     PRINTE5:
000C1E D997 E1              10      POP HL
000C1F D998 C1              10      POP BC
000C20 D999 AF               4      XOR A
000C21 D99A C9              10      RET
                                
       D99B                     CTRL:
000C22 D99B 7B               4      LD  A,E
000C23 D99C 87               4      ADD A,A
000C24 D99D F680             7      OR  080H
000C26 D99F 6F               4      LD  L,A
000C27 D9A0 26F1             7      LD  H,CTRLTB/256
000C29 D9A2 7E               7      LD  A,(HL)
000C2A D9A3 2C               4      INC L
000C2B D9A4 66               7      LD  H,(HL)
000C2C D9A5 6F               4      LD  L,A
000C2D D9A6 CD0F00          17      CALL    JP_HL
000C30 D9A9 18EC            12      JR  PRINTE5
                                
       D9AB                     CTRL1C:
000C32 D9AB ED4B8EF0        20      LD  BC,(_TXADR)
000C36 D9AF 03               6      INC BC
       D9B0                     PRINTE3:
000C37 D9B0 2118FC          10      LD  HL,0-WIDTH*LINE
000C3A D9B3 A7               4      AND A
000C3B D9B4 ED4A            15      ADC HL,BC
       D9B6                     PRINTE8:
000C3D D9B6 2805            12      JR  Z,PRINT2
000C3F D9B8 ED438EF0        20      LD  (_TXADR),BC
       D9BC                     CTRL00:
000C43 D9BC C9              10      RET
                                
       D9BD                     PRINT2:
000C44 D9BD CD02DB          17      CALL    SCR
000C47 D9C0 21D8FF          10      LD  HL,0-WIDTH
000C4A D9C3 09              11      ADD HL,BC
       D9C4                     SET_TXADR_HL:
000C4B D9C4 228EF0          16      LD  (_TXADR),HL
000C4E D9C7 C9              10      RET
                                
       D9C8                     CTRL08:
000C4F D9C8 3A63D9          13      LD  A,(INSFLG)
000C52 D9CB FECD             7      CP  0CDH        ;CALL ????
000C54 D9CD 2823            12      JR  Z,CTRL02
       D9CF                     CTRL1D:
000C56 D9CF 2A8EF0          16      LD  HL,(_TXADR)
000C59 D9D2 7C               4      LD  A,H
000C5A D9D3 B5               4      OR  L
000C5B D9D4 C8              11      RET Z
000C5C D9D5 2B               6      DEC HL
000C5D D9D6 18EC            12      JR  SET_TXADR_HL
                                
       D9D8                     CTRL1E:
000C5F D9D8 ED4B8EF0        20      LD  BC,(_TXADR)
000C63 D9DC 21D8FF          10      LD  HL,0-WIDTH
000C66 D9DF 09              11      ADD HL,BC
000C67 D9E0 D0              11      RET NC
000C68 D9E1 18E1            12      JR  SET_TXADR_HL
                                
       D9E3                     CTRL09:
000C6A D9E3 ED4B8EF0        20      LD  BC,(_TXADR)
000C6E D9E7 79               4      LD  A,C
000C6F D9E8 E6F8             7      AND 0F8H
000C71 D9EA C608             7      ADD A,8
000C73 D9EC 4F               4      LD  C,A
000C74 D9ED 88               4      ADC A,B
000C75 D9EE 91               4      SUB C
000C76 D9EF 47               4      LD  B,A
000C77 D9F0 18BE            12      JR  PRINTE3
                                
       D9F2                     CTRL02:
000C79 D9F2 CDCFD9          17      CALL    CTRL1D
000C7C D9F5 C8              11      RET Z
000C7D D9F6 D5              11      PUSH    DE
000C7E D9F7 CDD3F0          17      CALL    _POS
000C81 D9FA 54               4      LD  D,H
000C82 D9FB 3E28             7      LD  A,WIDTH
000C84 D9FD 95               4      SUB L
000C85 D9FE 4F               4      LD  C,A
000C86 D9FF 0D               4      DEC C
000C87 DA00 06D0             7      LD  B,0D0H
000C89 DA02 2A8EF0          16      LD  HL,(_TXADR)
000C8C DA05 09              11      ADD HL,BC
000C8D DA06 47               4      LD  B,A
                                
000C8E DA07 3AC0DA          13      LD  A,(MULINE)
000C91 DA0A BA               4      CP  D
000C92 DA0B 2007            12      JR  NZ,C02X1
000C94 DA0D 112800          10      LD  DE,WIDTH
000C97 DA10 19              11      ADD HL,DE
000C98 DA11 78               4      LD  A,B
000C99 DA12 83               4      ADD A,E
000C9A DA13 47               4      LD  B,A
       DA14                     C02X1:
000C9B DA14 3A96F0          13      LD  A,(_COLORF) ;C:Color
000C9E DA17 4F               4      LD  C,A
000C9F DA18 AF               4      XOR A       ;A:Text
000CA0 DA19 CD9ECF          17      CALL    IO_BS
000CA3 DA1C D1              10      POP DE
000CA4 DA1D C9              10      RET
                                
       DA1E                     CTRL05:
000CA5 DA1E CDD3F0          17      CALL    _POS
000CA8 DA21 3E28             7      LD  A,WIDTH
000CAA DA23 95               4      SUB L
000CAB DA24 47               4      LD  B,A
       DA25                     C08X1:
000CAC DA25 2A8EF0          16      LD  HL,(_TXADR)
000CAF DA28 7C               4      LD  A,H
000CB0 DA29 C6D0             7      ADD A,0D0H
000CB2 DA2B 67               4      LD  H,A
       DA2C                     CLLINE:
000CB3 DA2C 3A96F0          13      LD  A,(_COLORF)
000CB6 DA2F 4F               4      LD  C,A
000CB7 DA30 AF               4      XOR A
000CB8 DA31 C381CF          10      JP  IO_CLLINE
                                
       DA34                     CTRL0D:
000CBB DA34 CDD3F0          17      CALL    _POS
000CBE DA37 2E00             7      LD  L,0
       DA39                     LOC:
000CC0 DA39 C5              11      PUSH    BC
000CC1 DA3A E5              11      PUSH    HL
000CC2 DA3B CD59DA          17      CALL    LOC1
000CC5 DA3E 228EF0          16      LD  (_TXADR),HL
000CC8 DA41 E1              10      POP HL
000CC9 DA42 C1              10      POP BC
000CCA DA43 C9              10      RET
                                
       DA44                     CTRL12:
000CCB DA44 2163D9          10      LD  HL,INSFLG
000CCE DA47 7E               7      LD  A,(HL)
000CCF DA48 EECC             7      XOR 0CCH        ;CD:CALL ???? 1:LD BC,????
000CD1 DA4A 77               7      LD  (HL),A
000CD2 DA4B C9              10      RET
                                
       DA4C                     CTRL0B:
000CD3 DA4C 210000          10      LD  HL,0
000CD6 DA4F 228EF0          16      LD  (_TXADR),HL
000CD9 DA52 C9              10      RET
                                
       DA53                     CTRL1B:
000CDA DA53 3E01             7      LD  A,1
000CDC DA55 325AD9          13      LD  (ESCFLG),A
000CDF DA58 C9              10      RET
                                
       DA59                     LOC1:
000CE0 DA59 D5              11      PUSH    DE
000CE1 DA5A 4D               4      LD  C,L
000CE2 DA5B 0608             7      LD  B,8
000CE4 DA5D 5C               4      LD  E,H
000CE5 DA5E 210028          10      LD  HL,WIDTH*256
000CE8 DA61 55               4      LD  D,L ;L=0
       DA62                     LOC2:
000CE9 DA62 29              11      ADD HL,HL
000CEA DA63 3001            12      JR  NC,LOC3
000CEC DA65 19              11      ADD HL,DE
       DA66                     LOC3:
000CED DA66 10FA            13      DJNZ    LOC2
000CEF DA68 09              11      ADD HL,BC
000CF0 DA69 D1              10      POP DE
000CF1 DA6A C9              10      RET
                                
       DA6B                     CONOUT1:
                                ;   CALL    CURSOR
000CF2 DA6B 59               4      LD  E,C
000CF3 DA6C CDCDF0          17      CALL    _PRINT
000CF6 DA6F 7B               4      LD  A,E
000CF7 DA70 FE0A             7      CP  00AH
000CF9 DA72 2006            12      JR  NZ,CURSOR
000CFB DA74 CD34DA          17      CALL    CTRL0D
000CFE DA77 CD1EDA          17      CALL    CTRL05
       DA7A                     CURSOR:
000D01 DA7A C9              10      RET
                                
       DA7B                     CTRL07:
000D02 DA7B 06E0             7      LD  B,0E0H
000D04 DA7D 2162F0          10      LD  HL,BEEPD+1
       DA80                     C07X0:
000D07 DA80 4E               7      LD  C,(HL)
000D08 DA81 23               6      INC HL
000D09 DA82 7E               7      LD  A,(HL)
000D0A DA83 23               6      INC HL
000D0B DA84 CD4FCF          17      CALL    WRMMIO_BC
000D0E DA87 7D               4      LD  A,L
000D0F DA88 FE6A             7      CP  (BEEPD+1+M7BEEPE-M7BEEPD)&255
000D11 DA8A 20F4            12      JR  NZ,C07X0
000D13 DA8C 0610             7      LD  B,16
       DA8E                     C07X1:
000D15 DA8E CD2DCF          17      CALL    RD556VSYNC
000D18 DA91 87               4      ADD A,A
000D19 DA92 30FA            12      JR  NC,C07X1
       DA94                     C07X2:
000D1B DA94 CD2DCF          17      CALL    RD556VSYNC
000D1E DA97 87               4      ADD A,A
000D1F DA98 38FA            12      JR  C,C07X2
000D21 DA9A 10F2            13      DJNZ    C07X1
                                
000D23 DA9C AF               4      XOR A
000D24 DA9D 2108E0          10      LD  HL,0E008H
000D27 DAA0 CD3FCF          17      CALL    WRMMIO
000D2A DAA3 C9              10      RET
                                
       DAA4                     INSERT:
000D2B DAA4 D5              11      PUSH    DE
000D2C DAA5 CDD3F0          17      CALL    _POS
000D2F DAA8 54               4      LD  D,H
000D30 DAA9 3E28             7      LD  A,WIDTH
000D32 DAAB 95               4      SUB L
000D33 DAAC 47               4      LD  B,A
000D34 DAAD 2A8EF0          16      LD  HL,(_TXADR)
000D37 DAB0 7C               4      LD  A,H
000D38 DAB1 C6D0             7      ADD A,0D0H
000D3A DAB3 67               4      LD  H,A
000D3B DAB4 3A96F0          13      LD  A,(_COLORF) ;C:Color
000D3E DAB7 4F               4      LD  C,A
000D3F DAB8 AF               4      XOR A       ;A:Text
000D40 DAB9 CD91CF          17      CALL    IO_INS
000D43 DABC B7               4      OR  A
000D44 DABD 2005            12      JR  NZ,INS1
       DAC0                     MULINE  EQU $+1
000D46 DABF 3EFF             7      LD  A,-1
000D48 DAC1 92               4      SUB D
000D49 DAC2 2009            12      JR  NZ,INS2
       DAC4                     INS1:
000D4B DAC4 0628             7      LD  B,WIDTH
000D4D DAC6 CD91CF          17      CALL    IO_INS
000D50 DAC9 7A               4      LD  A,D
000D51 DACA 32C0DA          13      LD  (MULINE),A
       DACD                     INS2:
000D54 DACD D1              10      POP DE
000D55 DACE C9              10      RET
                                
       DACF                     CTRL0C:
000D56 DACF CD4CDA          17      CALL    CTRL0B
       DAD2                     CTRL06:
000D59 DAD2 D5              11      PUSH    DE
000D5A DAD3 E5              11      PUSH    HL
000D5B DAD4 ED5B8EF0        20      LD  DE,(_TXADR)
000D5F DAD8 3A96F0          13      LD  A,(_COLORF)
000D62 DADB 326ECF          13      LD  (ICSMC),A
000D65 DADE C362CF          10      JP  IO_CLR
                                
       DAE1                     CTRL04:
000D68 DAE1 CDD3F0          17      CALL    _POS
000D6B DAE4 7D               4      LD  A,L
000D6C DAE5 B7               4      OR  A
000D6D DAE6 C8              11      RET Z
       DAE7                     CTRL03:
000D6E DAE7 CD34DA          17      CALL    CTRL0D
       DAEA                     CTRL0A:
       DAEA                     CTRL1F:
000D71 DAEA 2A8EF0          16      LD  HL,(_TXADR)
000D74 DAED 012800          10      LD  BC,WIDTH
000D77 DAF0 09              11      ADD HL,BC
000D78 DAF1 44               4      LD  B,H
000D79 DAF2 4D               4      LD  C,L
000D7A DAF3 2118FC          10      LD  HL,0-WIDTH*LINE
000D7D DAF6 09              11      ADD HL,BC
000D7E DAF7 3F               4      CCF
000D7F DAF8 9F               4      SBC A,A
000D80 DAF9 C3B6D9          10      JP  PRINTE8
                                
       DAFC                     CTRL0E:
000D83 DAFC CDD3F0          17      CALL    _POS
000D86 DAFF 7C               4      LD  A,H
000D87 DB00 1804            12      JR  SCR1
       DB02                     SCR:
000D89 DB02 3A97F0          13      LD  A,(_LINE)
000D8C DB05 3D               4      DEC A
       DB06                     SCR1:
000D8D DB06 C5              11      PUSH    BC
000D8E DB07 D5              11      PUSH    DE
000D8F DB08 E5              11      PUSH    HL
000D90 DB09 1100D0          10      LD  DE,0D000H
000D93 DB0C 2128D0          10      LD  HL,0D000H+WIDTH
                                
000D96 DB0F 47               4      LD  B,A
000D97 DB10 B7               4      OR  A
000D98 DB11 C3B6CF          10      JP  IO_SCRUP
                                
       DB14                     POS:
000D9B DB14 2A8EF0          16      LD  HL,(_TXADR)
000D9E DB17 C5              11      PUSH    BC
000D9F DB18 01D8FF          10      LD  BC,0-WIDTH
000DA2 DB1B AF               4      XOR A
       DB1C                     POS1:
000DA3 DB1C 09              11      ADD HL,BC
000DA4 DB1D 3C               4      INC A
000DA5 DB1E 38FC            12      JR  C,POS1
000DA7 DB20 ED42            15      SBC HL,BC
000DA9 DB22 3D               4      DEC A
000DAA DB23 67               4      LD  H,A
000DAB DB24 C1              10      POP BC
000DAC DB25 A7               4      AND A
000DAD DB26 C9              10      RET
                                
       DB27                     GETL:
000DAE DB27 CDD3F0          17      CALL    _POS
000DB1 DB2A E5              11      PUSH    HL
000DB2 DB2B 3ECD             7      LD  A,0CDH      ;CALL ????
000DB4 DB2D 3263D9          13      LD  (INSFLG),A
       DB30                     GETL1:
000DB7 DB30 CD48D8          17      CALL    _SYS08
000DBA DB33 FE09             7      CP  9
000DBC DB35 2008            12      JR  NZ,GETL1V
000DBE DB37 2120FF          10      LD  HL,KBUF
000DC1 DB3A CD51D5          17      CALL    MSX
000DC4 DB3D 18F1            12      JR  GETL1
       DB3F                     GETL1V:
000DC6 DB3F 5F               4      LD  E,A
000DC7 DB40 CDD3F0          17      CALL    _POS
000DCA DB43 CDCDF0          17      CALL    _PRINT
000DCD DB46 7B               4      LD  A,E
000DCE DB47 FE20             7      CP  $20
000DD0 DB49 3809            12      JR  C,GETL1V1
000DD2 DB4B 7D               4      LD  A,L
000DD3 DB4C FE27             7      CP  WIDTH-1
000DD5 DB4E 2004            12      JR  NZ,GETL1V1
000DD7 DB50 7C               4      LD  A,H
000DD8 DB51 32C0DA          13      LD  (MULINE),A
       DB54                     GETL1V1:
000DDB DB54 7B               4      LD  A,E
000DDC DB55 FE0D             7      CP  00DH
000DDE DB57 20D7            12      JR  NZ,GETL1
000DE0 DB59 3E01             7      LD  A,1     ;LD BC,????
000DE2 DB5B 3263D9          13      LD  (INSFLG),A
000DE5 DB5E 1120FF          10      LD  DE,KBUF
000DE8 DB61 0628             7      LD  B,WIDTH
000DEA DB63 CDA4D3          17      CALL    ZERO_MEMORY_DE
                                
000DED DB66 D1              10      POP DE
000DEE DB67 CDD3F0          17      CALL    _POS
000DF1 DB6A 6B               4      LD  L,E
000DF2 DB6B 3E28             7      LD  A,WIDTH
000DF4 DB6D 95               4      SUB L
000DF5 DB6E 57               4      LD  D,A
                                
000DF6 DB6F 3AC0DA          13      LD  A,(MULINE)
000DF9 DB72 94               4      SUB H
000DFA DB73 2806            12      JR  Z,GL2X
000DFC DB75 3C               4      INC A
000DFD DB76 200C            12      JR  NZ,GL3X
000DFF DB78 25               4      DEC H
000E00 DB79 1805            12      JR  GL4X
       DB7B                     GL2X:
000E02 DB7B 3E1F             7      LD  A,$1F
000E04 DB7D CD32D8          17      CALL    MSG_A
       DB80                     GL4X:
000E07 DB80 7A               4      LD  A,D
000E08 DB81 C628             7      ADD A,WIDTH
000E0A DB83 57               4      LD  D,A
       DB84                     GL3X:
000E0B DB84 CD59DA          17      CALL    LOC1
000E0E DB87 4D               4      LD  C,L
000E0F DB88 7C               4      LD  A,H
000E10 DB89 C6D0             7      ADD A,0D0H
000E12 DB8B 47               4      LD  B,A
000E13 DB8C 5A               4      LD  E,D
000E14 DB8D 2120FF          10      LD  HL,KBUF
       DB90                     GETL2:
000E17 DB90 CDD0F0          17      CALL    _SCRN
000E1A DB93 03               6      INC BC
000E1B DB94 77               7      LD  (HL),A
000E1C DB95 23               6      INC HL
000E1D DB96 1D               4      DEC E
000E1E DB97 20F7            12      JR  NZ,GETL2
       DB99                     GETL3:
000E20 DB99 2B               6      DEC HL
000E21 DB9A 7E               7      LD  A,(HL)
000E22 DB9B FE21             7      CP  021H
000E24 DB9D D0              11      RET NC
000E25 DB9E 3600            10      LD  (HL),0
000E27 DBA0 15               4      DEC D
000E28 DBA1 20F6            12      JR  NZ,GETL3
000E2A DBA3 C9              10      RET
                                
       DBA4                     INKEY:
000E2B DBA4 FB               4      EI
000E2C DBA5 E5              11      PUSH    HL
000E2D DBA6 2A90F0          16      LD  HL,(_KEYPS)
000E30 DBA9 7C               4      LD  A,H
000E31 DBAA AD               4      XOR L
000E32 DBAB 280B            12      JR  Z,INKEY1
000E34 DBAD 7C               4      LD  A,H
000E35 DBAE 3C               4      INC A
000E36 DBAF E61F             7      AND 01FH
000E38 DBB1 3291F0          13      LD  (_KEYPS+1),A
000E3B DBB4 6F               4      LD  L,A
000E3C DBB5 26FF             7      LD  H,KEYBF/256
000E3E DBB7 7E               7      LD  A,(HL)
       DBB8                     INKEY1:
000E3F DBB8 E1              10      POP HL
000E40 DBB9 B7               4      OR  A
000E41 DBBA C9              10      RET
                                
       DBBB                     INKEYB:
000E42 DBBB C1              10      POP BC
000E43 DBBC CB47             8      BIT 0,A
000E45 DBBE 3E08             7      LD  A,8
000E47 DBC0 2002            12      JR  NZ,INKEYD
000E49 DBC2 3E03             7      LD  A,3
       DBC4                     INKEYD:
000E4B DBC4 B7               4      OR  A
000E4C DBC5 3292F0          13      LD  (_KEYD),A
000E4F DBC8 C9              10      RET
       DBC9                     CHKEY:
000E50 DBC9 C5              11      PUSH    BC
000E51 DBCA 3E08             7      LD  A,8
000E53 DBCC CD20CF          17      CALL    RDKEYDATA
000E56 DBCF 3293F0          13      LD  (_KEYD+1),A
000E59 DBD2 CB7F             8      BIT 7,A
000E5B DBD4 28E5            12      JR  Z,INKEYB
000E5D DBD6 E5              11      PUSH    HL
000E5E DBD7 0E07             7      LD  C,7
000E60 DBD9 2140ED          10      LD  HL,KEY_TABLE
000E63 DBDC CB47             8      BIT 0,A
000E65 DBDE 2003            12      JR  NZ,CHKEY0
000E67 DBE0 2180ED          10      LD  HL,SHIFT_TABLE
       DBE3                     CHKEY0:
000E6A DBE3 CB77             8      BIT 6,A
000E6C DBE5 2003            12      JR  NZ,CHKEY1
000E6E DBE7 21C0ED          10      LD  HL,CTRL_TABLE
       DBEA                     CHKEY1:
000E71 DBEA 79               4      LD  A,C
000E72 DBEB CD20CF          17      CALL    RDKEYDATA
000E75 DBEE 0608             7      LD  B,8
       DBF0                     CHKEY2:
000E77 DBF0 87               4      ADD A,A
000E78 DBF1 3009            12      JR  NC,CHKEY3
000E7A DBF3 23               6      INC HL
000E7B DBF4 10FA            13      DJNZ    CHKEY2
000E7D DBF6 0D               4      DEC C
000E7E DBF7 79               4      LD  A,C
000E7F DBF8 3C               4      INC A
000E80 DBF9 20EF            12      JR  NZ,CHKEY1
000E82 DBFB 06                      DB  $06     ;LD B,?? 次の1バイトを飛ばす
       DBFC                     CHKEY3:
000E83 DBFC 7E               7      LD  A,(HL)
000E84 DBFD E1              10      POP HL
000E85 DBFE C1              10      POP BC
000E86 DBFF 18C3            12      JR  INKEYD
                                
       DC01                     SCRN:
000E88 DC01 E5              11      PUSH    HL
000E89 DC02 CD47CF          17      CALL    RDMMIO_BC
000E8C DC05 6F               4      LD  L,A
000E8D DC06 26EF             7      LD  H,DC_TABLE/256
000E8F DC08 7E               7      LD  A,(HL)
000E90 DC09 FE41             7      CP  'A'     ;英小文字チェック
000E92 DC0B 380E            12      JR  C,SCRN1
000E94 DC0D FE5B             7      CP  'Z'+1
000E96 DC0F DC1DDC          17      CALL    C,SCRNC
000E99 DC12 FEA6             7      CP  $A6     ;ひらがなチェック
000E9B DC14 3805            12      JR  C,SCRN1
000E9D DC16 FEE0             7      CP  $E0
000E9F DC18 DC1DDC          17      CALL    C,SCRNC
       DC1B                     SCRN1:
000EA2 DC1B E1              10      POP HL
000EA3 DC1C C9              10      RET
                                
       DC1D                     SCRNC:
000EA4 DC1D 6F               4      LD  L,A
000EA5 DC1E 60               4      LD  H,B
000EA6 DC1F CBD8             8      SET 3,B
000EA8 DC21 CD47CF          17      CALL    RDMMIO_BC
000EAB DC24 44               4      LD  B,H
000EAC DC25 CB7F             8      BIT 7,A
000EAE DC27 7D               4      LD  A,L
000EAF DC28 C8              11      RET Z
000EB0 DC29 FE5B             7      CP  'Z'+1
000EB2 DC2B 3804            12      JR  C,SCRNC_ADD
000EB4 DC2D FEC0             7      CP  $C0
000EB6 DC2F 3803            12      JR  C,SCRNC_SUB
       DC31                     SCRNC_ADD:
000EB8 DC31 C620             7      ADD A,$20
000EBA DC33 C9              10      RET
       DC34                     SCRNC_SUB:
000EBB DC34 D620             7      SUB $20
000EBD DC36 C9              10      RET
[EOF:M7IO.ASM:SHIFT_JIS]
                                    INCLUDE "LDFILE.ASM"
                                
                                ;   LSX-Dodgers FILE
                                
       DC37                     FILEC:
000EBE DC37 CD42DC          17      CALL    FILE
       DC3A                     FILEC2:
000EC1 DC3A 3A15F0          13      LD  A,(FDRV+1)
000EC4 DC3D FE20             7      CP  020H
000EC6 DC3F C8              11      RET Z
000EC7 DC40 1839            12      JR  SETDIR1
                                
       DC42                     FILE:
000EC9 DC42 AF               4      XOR A
000ECA DC43 3214F0          13      LD  (FDRV),A
000ECD DC46 67               4      LD  H,A
000ECE DC47 6F               4      LD  L,A
000ECF DC48 2222F0          16      LD  (FDRV+14),HL
000ED2 DC4B CD19DD          17      CALL    SPCUT
000ED5 DC4E CDFEDC          17      CALL    CCHK3
000ED8 DC51 2812            12      JR  Z,DEVI1
000EDA DC53 13               6      INC DE
000EDB DC54 1A               7      LD  A,(DE)
000EDC DC55 1B               6      DEC DE
000EDD DC56 FE3A             7      CP  ':'
000EDF DC58 200B            12      JR  NZ,DEVI1
000EE1 DC5A 1A               7      LD  A,(DE)      ;DRIVE
000EE2 DC5B CD4EDF          17      CALL    CAP
000EE5 DC5E D640             7      SUB '@'
000EE7 DC60 13               6      INC DE
000EE8 DC61 13               6      INC DE
000EE9 DC62 3214F0          13      LD  (FDRV),A
       DC65                     DEVI1:
000EEC DC65 1A               7      LD  A,(DE)
000EED DC66 D65C             7      SUB 05CH        ;\
000EEF DC68 2009            12      JR  NZ,NOROOT
000EF1 DC6A 6F               4      LD  L,A     ;A=0でH=0のはずなのでHL=0
000EF2 DC6B 222EF0          16      LD  (FDRV+26),HL
000EF5 DC6E 2C               4      INC L
000EF6 DC6F 2222F0          16      LD  (FDRV+14),HL
000EF9 DC72 13               6      INC DE
       DC73                     NOROOT:
                                
       DC73                     SETDIR:
000EFA DC73 CD9FDC          17      CALL    FILED
000EFD DC76 1A               7      LD  A,(DE)
000EFE DC77 FE5C             7      CP  05CH        ;\
000F00 DC79 C0              11      RET NZ
000F01 DC7A 13               6      INC DE
       DC7B                     SETDIR1:
000F02 DC7B 3E10             7      LD  A,010H      ;Directory
000F04 DC7D 3221F0          13      LD  (FDRV+13),A
000F07 DC80 D5              11      PUSH    DE
000F08 DC81 1114F0          10      LD  DE,FDRV
000F0B DC84 2A1EF1          16      LD  HL,(STABLE+2*00FH)
000F0E DC87 CD0F00          17      CALL    JP_HL
000F11 DC8A D1              10      POP DE
000F12 DC8B B7               4      OR  A
000F13 DC8C C0              11      RET NZ
                                
000F14 DC8D 3A21F0          13      LD  A,(FDRV+13)
000F17 DC90 CB67             8      BIT 4,A
000F19 DC92 C8              11      RET Z
                                
000F1A DC93 CDE6DC          17      CALL    FILEI
000F1D DC96 2A2EF0          16      LD  HL,(FDRV+26)
000F20 DC99 23               6      INC HL
000F21 DC9A 2222F0          16      LD  (FDRV+14),HL
000F24 DC9D 18D4            12      JR  SETDIR
                                
       DC9F                     FILED:
000F26 DC9F CDE6DC          17      CALL    FILEI
000F29 DCA2 2115F0          10      LD  HL,FNAME
                                
000F2C DCA5 0608             7      LD  B,8
       DCA7                     FILE2:
000F2E DCA7 CDF3DC          17      CALL    CCHKF
000F31 DCAA C8              11      RET Z
000F32 DCAB FE2A             7      CP  '*'
000F34 DCAD 282E            12      JR  Z,FILE9
000F36 DCAF FE2E             7      CP  '.'
000F38 DCB1 280C            12      JR  Z,FILE4
000F3A DCB3 77               7      LD  (HL),A
000F3B DCB4 23               6      INC HL
000F3C DCB5 10F0            13      DJNZ    FILE2
                                
       DCB7                     FILE3:
000F3E DCB7 CDF3DC          17      CALL    CCHKF
000F41 DCBA C8              11      RET Z
000F42 DCBB FE2E             7      CP  '.'
000F44 DCBD 20F8            12      JR  NZ,FILE3
                                
       DCBF                     FILE4:
000F46 DCBF 211DF0          10      LD  HL,FNAME+8
000F49 DCC2 0603             7      LD  B,3
                                
       DCC4                     FILE4L:
000F4B DCC4 CDF3DC          17      CALL    CCHKF
000F4E DCC7 C8              11      RET Z
000F4F DCC8 FE2E             7      CP  '.'
000F51 DCCA 2008            12      JR  NZ,FILE12
000F53 DCCC 3215F0          13      LD  (FNAME),A   ;Parent directory(..)
000F56 DCCF 3216F0          13      LD  (FNAME+1),A
000F59 DCD2 3E20             7      LD  A,020H
       DCD4                     FILE12:
000F5B DCD4 FE2A             7      CP  '*'
000F5D DCD6 280A            12      JR  Z,FILE10
000F5F DCD8 77               7      LD  (HL),A
000F60 DCD9 23               6      INC HL
000F61 DCDA 10E8            13      DJNZ    FILE4L
000F63 DCDC C9              10      RET
                                
       DCDD                     FILE9:              ;名前の*処理、名前の残りを?で埋める
000F64 DCDD CDE2DC          17      CALL    FILE10
000F67 DCE0 18D5            12      JR  FILE3
                                
       DCE2                     FILE10:
000F69 DCE2 3E3F             7      LD  A,'?'
000F6B DCE4 1808            12      JR  FILL_MEMORY
       DCE6                     FILEI:              ;名前＋拡張子をスペースで初期化
000F6D DCE6 3E20             7      LD  A,020H
000F6F DCE8 01000B          10      LD  BC,11*256   ;C=0にしておく
000F72 DCEB 2115F0          10      LD  HL,FNAME
       DCEE                     FILL_MEMORY:            ;HLからBバイトAで埋める
000F75 DCEE 77               7      LD  (HL),A
000F76 DCEF 23               6      INC HL
000F77 DCF0 10FC            13      DJNZ    FILL_MEMORY
000F79 DCF2 C9              10      RET
                                
       DCF3                     CCHKF:
000F7A DCF3 1A               7      LD  A,(DE)
000F7B DCF4 CDFBDC          17      CALL    CCHK2
000F7E DCF7 C8              11      RET Z
000F7F DCF8 C366E0          10      JP  FKAN
                                
       DCFB                     CCHK2:
000F82 DCFB 0C               4      INC C
000F83 DCFC 0D               4      DEC C
000F84 DCFD C0              11      RET NZ
       DCFE                     CCHK3:              ;ZF=1 で使えない文字
000F85 DCFE FE2B             7      CP  '+'
000F87 DD00 C8              11      RET Z
000F88 DD01 FE2C             7      CP  ','
000F8A DD03 C8              11      RET Z
000F8B DD04 FE2F             7      CP  '/'
000F8D DD06 C8              11      RET Z
000F8E DD07 FE3A             7      CP  ':'
000F90 DD09 C8              11      RET Z
000F91 DD0A FE3B             7      CP  ';'
000F93 DD0C C8              11      RET Z
000F94 DD0D FE3D             7      CP  '='
000F96 DD0F C8              11      RET Z
000F97 DD10 FE5C             7      CP  05CH    ;\
000F99 DD12 C8              11      RET Z
000F9A DD13 FE20             7      CP  020H
000F9C DD15 D0              11      RET NC
000F9D DD16 BF               4      CP  A       ;Z=1
000F9E DD17 C9              10      RET
                                
       DD18                     SS1:
000F9F DD18 13               6      INC DE
       DD19                     SPCUT:              ;スペースをカット
000FA0 DD19 1A               7      LD  A,(DE)
000FA1 DD1A FE20             7      CP  020H
000FA3 DD1C 28FA            12      JR  Z,SS1
000FA5 DD1E C9              10      RET
                                
       DD1F                     SETDRVF:
000FA6 DD1F 1114F0          10      LD  DE,FDRV
       DD22                     SETDRV0:
000FA9 DD22 CD2BDD          17      CALL    SETDRV
000FAC DD25 FDE1            14      POP IY
000FAE DD27 C1              10      POP BC
000FAF DD28 D1              10      POP DE
000FB0 DD29 E1              10      POP HL
000FB1 DD2A C9              10      RET
                                
       DD2B                     SETDRV:
000FB2 DD2B E3              19      EX  (SP),HL     ;HL=RETRN ADDRESS
000FB3 DD2C D5              11      PUSH    DE      ;PUSH HL/DE/BC/IY
000FB4 DD2D C5              11      PUSH    BC
000FB5 DD2E 1A               7      LD  A,(DE)
000FB6 DD2F D5              11      PUSH    DE
000FB7 DD30 FDE3            23      EX  (SP),IY
                                
000FB9 DD32 CD3EDD          17      CALL    GETDRV
000FBC DD35 3C               4      INC A
000FBD DD36 FD7700          19      LD  (IY+0),A    ;(FCB)ドライブ番号
000FC0 DD39 3D               4      DEC A
000FC1 DD3A CDD9F0          17      CALL    _CHGDRV
                                
000FC4 DD3D E9               4      JP  (HL)
                                
       DD3E                     GETDRV:
000FC5 DD3E E67F             7      AND 07FH
000FC7 DD40 D601             7      SUB 001H
000FC9 DD42 3003            12      JR  NC,GETDRV1
000FCB DD44 3A87F0          13      LD  A,(_DVSW)   ;Current Drive
       DD47                     GETDRV1:
000FCE DD47 3288F0          13      LD  (_DRV),A
000FD1 DD4A C9              10      RET
                                
       DD4B                     SOPENX:
000FD2 DD4B 1139F0          10      LD  DE,SFILE
000FD5 DD4E 1A               7      LD  A,(DE)
000FD6 DD4F FDBE00           7      CP  (IY+0)      ;(FCB)ドライブ番号
000FD9 DD52 2024            12      JR  NZ,SOPEN
000FDB DD54 13               6      INC DE
000FDC DD55 FDE5            15      PUSH    IY
000FDE DD57 E1              10      POP HL
000FDF DD58 23               6      INC HL
000FE0 DD59 CDE6DE          17      CALL    CPFILE
000FE3 DD5C 201A            12      JR  NZ,SOPEN
                                
000FE5 DD5E 2AF4F1          16      LD  HL,(SCDIR)
000FE8 DD61 FD750E          19      LD  (IY+14),L   ;(FCB)アクセスするディレクトリのクラスタ番号+1
000FEB DD64 FD740F          19      LD  (IY+15),H
                                
000FEE DD67 2AF8F1          16      LD  HL,(SFNDF)  ;Direcroty location and Flags
000FF1 DD6A 229FF0          16      LD  (_FILEN),HL
                                
000FF4 DD6D ED5BF6F1        20      LD  DE,(SFBPS)
000FF8 DD71 2139F0          10      LD  HL,SFILE
000FFB DD74 36FF            10      LD  (HL),0FFH
000FFD DD76 23               6      INC HL
000FFE DD77 C9              10      RET
       DD78                     SOPEN:
000FFF DD78 218EDE          10      LD  HL,FILESE
       DD7B                     SOPENC:
001002 DD7B 22B4DD          16      LD  (OPENPAT+1),HL
                                
001005 DD7E CDE2F0          17      CALL    _RDFATX     ;Detect Media
001008 DD81 3856            12      JR  C,RDDERR
                                
00100A DD83 AF               4      XOR A
00100B DD84 329FF0          13      LD  (_FILEN),A
00100E DD87 CD93DF          17      CALL    LDDIRX1     ;A=0で呼び出す
001011 DD8A 2818            12      JR  Z,SDIRX1
                                
001013 DD8C CD7FDE          17      CALL    READ_DIR    ;Sub Directory
001016 DD8F 3808            12      JR  C,SDIRX0
001018 DD91 2A7EF1          16      LD  HL,(_DTBUF)
00101B DD94 7E               7      LD  A,(HL)
00101C DD95 FE2E             7      CP  '.'
00101E DD97 280F            12      JR  Z,SOPEN1
       DD99                     SDIRX0:
001020 DD99 AF               4      XOR A
001021 DD9A 32A0F0          13      LD  (_DIRF),A
001024 DD9D FD360E01        19      LD  (IY+14),1   ;(FCB)レコードサイズ
001028 DDA1 FD770F          19      LD  (IY+15),A
       DDA4                     SDIRX1:
00102B DDA4 ED5BFCF1        20      LD  DE,(_DIRPS) ;Root Directory
       DDA8                     SOPEN1:
00102F DDA8 0E20             7  SDECPAT:LD  C,32        ;自己書き換え 1セクタ辺りのディレクトリエントリ数  1024=32 / 512=16 / 256=8
       DDAA                     SOPEN1X:
001031 DDAA CD7FDE          17      CALL    READ_DIR    ;FILE SEARCH
001034 DDAD 382A            12      JR  C,RDDERR
001036 DDAF 2A7EF1          16      LD  HL,(_DTBUF)
       DDB2                     SOPEN2:
001039 DDB2 D5              11      PUSH    DE
00103A DDB3 CD8EDE          17  OPENPAT:CALL    FILESE      ;(self-modifying code)
00103D DDB6 D1              10      POP DE
00103E DDB7 386E            12      JR  C,SOPENE
001040 DDB9 281B            12      JR  Z,SCF_FF_RET
       DDBB                     SOPEN3:
001042 DDBB 3AA0F0          13      LD  A,(_DIRF)   ;ディレクトリか判別
001045 DDBE B7               4      OR  A
001046 DDBF 200C            12      JR  NZ,SOPEN5
001048 DDC1 13               6      INC DE      ;ルートディレクトリ
001049 DDC2 E5              11      PUSH    HL
00104A DDC3 210C00          10  MD_PAT: LD  HL,12       ;(self-modifying code)MAXDIR
00104D DDC6 ED52            15      SBC HL,DE       ;CF=0 なので SUB HL,DE
00104F DDC8 E1              10      POP HL
001050 DDC9 20DD            12      JR  NZ,SOPEN1
001052 DDCB 1807            12      JR  SOPEN6
       DDCD                     SOPEN5:
001054 DDCD CDA8E6          17      CALL    GNCLX       ;END DIR
001057 DDD0 D8              11      RET C
001058 DDD1 CD46DF          17      CALL    ENDCL
       DDD4                     SOPEN6:
00105B DDD4 38D2            12      JR  C,SOPEN1
       DDD6                     SCF_FF_RET:
00105D DDD6 37               4      SCF         ;CF=1
00105E DDD7 9F               4      SBC A,A     ;A=0FFH
00105F DDD8 C9              10      RET
                                
       DDD9                     RDDERR:
001060 DDD9 BF               4      CP  A       ;READ ERR CF=1 ZF=1
001061 DDDA 37               4      SCF
001062 DDDB C9              10      RET
                                
       DDDC                     NOPEN:
001063 DDDC 218EDE          10      LD  HL,FILESE
001066 DDDF 22B4DD          16      LD  (OPENPAT+1),HL
001069 DDE2 FD2A98F0        20      LD  IY,(_FCB)
00106D DDE6 CD79E0          17      CALL    CHKWILDX
001070 DDE9 30EB            12      JR  NC,SCF_FF_RET
001072 DDEB FD7E00          19      LD  A,(IY+0)    ;(FCB)ドライブ番号
001075 DDEE 3D               4      DEC A
001076 DDEF 3288F0          13      LD  (_DRV),A
001079 DDF2 CDD9F0          17      CALL    _CHGDRV
00107C DDF5 D8              11      RET C
00107D DDF6 2AF8F1          16      LD  HL,(SFNDF)  ;Direcroty location and Flags
001080 DDF9 229FF0          16      LD  (_FILEN),HL
                                
001083 DDFC CD8EDF          17      CALL    LDDIRX
001086 DDFF ED5B9AF0        20      LD  DE,(_FBPS)
00108A DE03 CD7FDE          17      CALL    READ_DIR
00108D DE06 38D1            12      JR  C,RDDERR
00108F DE08 3A9EF0          13      LD  A,(_FBCNT)
001092 DE0B 3D               4      DEC A
001093 DE0C 28AD            12      JR  Z,SOPEN3
       DE0E                     NOPEN2:
001095 DE0E 2A9CF0          16      LD  HL,(_FBAD)
001098 DE11 012000          10      LD  BC,020H
00109B DE14 09              11      ADD HL,BC
00109C DE15 4F               4      LD  C,A
00109D DE16 189A            12      JR  SOPEN2
                                
       DE18                     SOPENE2:
00109F DE18 229CF0          16      LD  (_FBAD),HL
0010A2 DE1B 79               4      LD  A,C
0010A3 DE1C 329EF0          13      LD  (_FBCNT),A
0010A6 DE1F ED539AF0        20      LD  (_FBPS),DE
0010AA DE23 FD2298F0        20      LD  (_FCB),IY
       DE27                     SOPENE:
0010AE DE27 AF               4      XOR A
0010AF DE28 C9              10      RET
                                
       DE29                     COPEN:
0010B0 DE29 FD360D20        19      LD  (IY+13),020H    ;(FCB)属性(アトリビュート)
                                
0010B4 DE2D 21ABDE          10      LD  HL,NEXTSE
0010B7 DE30 CD7BDD          17      CALL    SOPENC
0010BA DE33 D0              11      RET NC
0010BB DE34 C8              11      RET Z
0010BC DE35 3AA0F0          13      LD  A,(_DIRF)   ;ディレクトリか判別
0010BF DE38 B7               4      OR  A
0010C0 DE39 37               4      SCF
0010C1 DE3A C8              11      RET Z       ;ルートディレクトリ
0010C2 DE3B 0601             7      LD  B,1
0010C4 DE3D CDD8E0          17      CALL    WRDF
0010C7 DE40 D8              11      RET C
0010C8 DE41 ED5BFEF1        20      LD  DE,(_CLPS)
0010CC DE45 D5              11      PUSH    DE
0010CD DE46 CD0FDF          17      CALL    DCPAT
0010D0 DE49 CD33E5          17      CALL    DRDNX
0010D3 DE4C 2A7EF1          16      LD  HL,(_DTBUF) ;ディレクトリエントリを0クリア
0010D6 DE4F 3A3DE4          13      LD  A,(SECSZ+2) ;1024=4 / 512=2 / 256=1
0010D9 DE52 47               4      LD  B,A
0010DA DE53 AF               4      XOR A
0010DB DE54 4F               4      LD  C,A
       DE55                     COPENCL:
0010DC DE55 77               7      LD  (HL),A
0010DD DE56 EDA1            16      CPI         ;HL=HL+1 BC=BC-1 BCが0の場合にP/V=0
0010DF DE58 EA55DE          10      JP  PE,COPENCL
                                
0010E2 DE5B 3A2DDF          13      LD  A,(SPCPAT+1)    ;1クラスタの論理セクタ数
0010E5 DE5E 3D               4      DEC A
0010E6 DE5F 2819            12      JR  Z,COPENE
0010E8 DE61 3E01             7      LD  A,1     ;1セクタ辺りのセクタ数が2以上の場合
0010EA DE63 32A0E6          13      LD  (_SECPS+1),A
0010ED DE66 D1              10      POP DE      ;DE=(_CLPS)
0010EE DE67 D5              11      PUSH    DE
       DE68                     COPEN1:
0010EF DE68 D5              11      PUSH    DE      ;データバッファに入らないセクタもゼロクリア
0010F0 DE69 C5              11      PUSH    BC
0010F1 DE6A 2A7EF1          16      LD  HL,(_DTBUF)
0010F4 DE6D CD29DF          17      CALL    CLUSTX
0010F7 DE70 CD38E8          17      CALL    DWT24
0010FA DE73 C1              10      POP BC
0010FB DE74 D1              10      POP DE
0010FC DE75 CD9FE6          17      CALL    NEXTX
0010FF DE78 20EE            12      JR  NZ,COPEN1
       DE7A                     COPENE:
001101 DE7A 2A7EF1          16      LD  HL,(_DTBUF)
001104 DE7D D1              10      POP DE
001105 DE7E C9              10      RET
                                
       DE7F                     READ_DIR:
001106 DE7F ED53FEF1        20      LD  (_CLPS),DE
00110A DE83 C5              11      PUSH    BC
00110B DE84 D5              11      PUSH    DE
00110C DE85 CD0FDF          17      CALL    DCPAT
00110F DE88 CD13E5          17      CALL    DRDX
001112 DE8B D1              10      POP DE
001113 DE8C C1              10      POP BC
001114 DE8D C9              10      RET
                                
       DE8E                     FILESE:
001115 DE8E 7E               7      LD  A,(HL)
001116 DE8F B7               4      OR  A
001117 DE90 C8              11      RET Z       ;END:ZF=1 CF=0
001118 DE91 FEE5             7      CP  0E5H
00111A DE93 280E            12      JR  Z,FILESE1
00111C DE95 FDE5            15      PUSH    IY
00111E DE97 D1              10      POP DE
00111F DE98 13               6      INC DE
001120 DE99 E5              11      PUSH    HL
001121 DE9A CDE6DE          17      CALL    CPFILE
001124 DE9D CC07DF          17      CALL    Z,CPFILE2
001127 DEA0 E1              10      POP HL
001128 DEA1 37               4      SCF
001129 DEA2 C8              11      RET Z       ;!!!:(ZF=1) CF=1
       DEA3                     FILESE1:
00112A DEA3 CDBADE          17      CALL    FNEXT
00112D DEA6 20E6            12      JR  NZ,FILESE
       DEA8                     ZF0_CF0_AFF_RET:
00112F DEA8 F6FF             7      OR  0FFH        ;ZF=0 CF=0
001131 DEAA C9              10      RET
                                
       DEAB                     NEXTSE:
001132 DEAB 7E               7      LD  A,(HL)
001133 DEAC B7               4      OR  A
001134 DEAD 37               4      SCF
001135 DEAE C8              11      RET Z       ;!!!:ZF=1 CF=1
001136 DEAF FEE5             7      CP  0E5H
001138 DEB1 37               4      SCF
001139 DEB2 C8              11      RET Z       ;!!!:(ZF=1) CF=1
00113A DEB3 CDBADE          17      CALL    FNEXT
00113D DEB6 20F3            12      JR  NZ,NEXTSE
00113F DEB8 18EE            12      JR  ZF0_CF0_AFF_RET
                                
       DEBA                     FNEXT:
001141 DEBA E5              11      PUSH    HL
001142 DEBB 219FF0          10      LD  HL,_FILEN
001145 DEBE 34              11      INC (HL)
001146 DEBF E1              10      POP HL
001147 DEC0 112000          10      LD  DE,020H
00114A DEC3 19              11      ADD HL,DE
00114B DEC4 0D               4      DEC C
00114C DEC5 C9              10      RET
                                
       DEC6                     CPNAME:
00114D DEC6 C5              11      PUSH    BC
00114E DEC7 D5              11      PUSH    DE
00114F DEC8 E5              11      PUSH    HL
001150 DEC9 CDE0DE          17      CALL    CPFILE4
001153 DECC E1              10      POP HL
001154 DECD 23               6      INC HL
001155 DECE 23               6      INC HL
001156 DECF 23               6      INC HL
001157 DED0 23               6      INC HL
001158 DED1 D1              10      POP DE
001159 DED2 C1              10      POP BC
00115A DED3 2005            12      JR  NZ,CPNAME1
00115C DED5 7E               7      LD  A,(HL)
00115D DED6 23               6      INC HL
00115E DED7 66               7      LD  H,(HL)
00115F DED8 6F               4      LD  L,A
001160 DED9 C9              10      RET
       DEDA                     CPNAME1:
001161 DEDA 23               6      INC HL
001162 DEDB 23               6      INC HL
001163 DEDC 10E8            13      DJNZ    CPNAME
001165 DEDE 37               4      SCF
001166 DEDF C9              10      RET
                                
       DEE0                     CPFILE4:
001167 DEE0 C5              11      PUSH    BC
001168 DEE1 010004          10      LD  BC,00400H
00116B DEE4 1804            12      JR  CPSTR1
       DEE6                     CPFILE:
00116D DEE6 C5              11      PUSH    BC
00116E DEE7 01000B          10      LD  BC,00B00H
       DEEA                     CPSTR1:
001171 DEEA 1A               7      LD  A,(DE)
001172 DEEB FE3F             7      CP  '?'     ;Wild card
001174 DEED 2812            12      JR  Z,CPSTR2
001176 DEEF 7E               7      LD  A,(HL)
001177 DEF0 CD5FE0          17      CALL    FKANC
00117A DEF3 E5              11      PUSH    HL
00117B DEF4 67               4      LD  H,A
00117C DEF5 1A               7      LD  A,(DE)
00117D DEF6 CB01             4      RLC C
00117F DEF8 CD5FE0          17      CALL    FKANC
001182 DEFB CB09             4      RRC C
001184 DEFD BC               4      CP  H       ;CP (HL),(DE)
001185 DEFE E1              10      POP HL
001186 DEFF 2004            12      JR  NZ,CPSTR3
       DF01                     CPSTR2:
001188 DF01 13               6      INC DE
001189 DF02 23               6      INC HL
00118A DF03 10E5            13      DJNZ    CPSTR1
       DF05                     CPSTR3:
00118C DF05 C1              10      POP BC
00118D DF06 C9              10      RET
                                
       DF07                     CPFILE2:
00118E DF07 FD7E0D          19      LD  A,(IY+13)   ;(FCB)属性(アトリビュート)
001191 DF0A F6E1             7      OR  0E1H
001193 DF0C 2F               4      CPL
001194 DF0D A6               7      AND (HL)
001195 DF0E C9              10      RET
                                
       DF0F                     DCPAT:
001196 DF0F 0E00             7      LD  C,0
001198 DF11 2A7EF1          16      LD  HL,(_DTBUF)
00119B DF14 3AA0F0          13      LD  A,(_DIRF)   ;ディレクトリか判別
00119E DF17 B7               4      OR  A
00119F DF18 C8              11      RET Z       ;ルートディレクトリの場合はCレジスタを0にしておく(CDEがセクタ番号)
0011A0 DF19 3A2DDF          13      LD  A,(SPCPAT+1)
0011A3 DF1C 4F               4      LD  C,A
0011A4 DF1D 3AA0E6          13      LD  A,(_SECPS+1)
0011A7 DF20 B9               4      CP  C
0011A8 DF21 3801            12      JR  C,DC1
0011AA DF23 AF               4      XOR A
       DF24                     DC1:
0011AB DF24 F680             7      OR  080H
0011AD DF26 32A0F0          13      LD  (_DIRF),A   ;bit0-6:セクタインデックス
       DF29                     CLUSTX:
0011B0 DF29 E5              11      PUSH    HL
0011B1 DF2A EB               4      EX  DE,HL
0011B2 DF2B AF               4      XOR A
0011B3 DF2C 0E01             7  SPCPAT: LD  C,1     ;自己書き換え（1クラスタの論理セクタ数）
       DF2E                     L_CLDBL:
0011B5 DF2E CB19             8      RR  C       ;->CF
0011B7 DF30 3804            12      JR  C,E_CLDBL
0011B9 DF32 29              11      ADD HL,HL       ;*2
0011BA DF33 8F               4      ADC A,A
0011BB DF34 18F8            12      JR  L_CLDBL
       DF36                     E_CLDBL:
0011BD DF36 4F               4      LD  C,A
0011BE DF37 3AA0E6          13      LD  A,(_SECPS+1)
0011C1 DF3A B5               4      OR  L
0011C2 DF3B 6F               4      LD  L,A
0011C3 DF3C 110800          10  CLSPAT: LD  DE,8    ;+8 (2D)  !ADDCL (self-modifying code)
0011C6 DF3F AF               4      XOR A
0011C7 DF40 19              11      ADD HL,DE   ;データ格納領域の先頭論理セクタ番号
0011C8 DF41 89               4      ADC A,C
0011C9 DF42 4F               4      LD  C,A
0011CA DF43 EB               4      EX  DE,HL
0011CB DF44 E1              10      POP HL
0011CC DF45 C9              10      RET
                                
       DF46                     ENDCL:
0011CD DF46 7A               4      LD  A,D ;END CLUSTER
0011CE DF47 FE01             7  CLPAT1: CP  1   ;164=356    (self-modifying code)
0011D0 DF49 C0              11      RET NZ
0011D1 DF4A 7B               4      LD  A,E
0011D2 DF4B FE64             7  CLPAT2: CP  064H    ;       (self-modifying code)
0011D4 DF4D C9              10      RET
                                
       DF4E                     CAP:
0011D5 DF4E FE61             7      CP  'a'
0011D7 DF50 D8              11      RET C
0011D8 DF51 FE7B             7      CP  'z'+1
0011DA DF53 D0              11      RET NC
0011DB DF54 D620             7      SUB 020H
0011DD DF56 C9              10      RET
       DF57                     CAP2:
0011DE DF57 CD4EDF          17      CALL    CAP
       DF5A                     CAP3:
0011E1 DF5A CD63DF          17      CALL    CAP4
0011E4 DF5D FE21             7      CP  021H
0011E6 DF5F D0              11      RET NC
0011E7 DF60 3EA0             7      LD  A,NBSP
0011E9 DF62 C9              10      RET
       DF63                     CAP4:
0011EA DF63 FE05             7      CP  5
0011EC DF65 C0              11      RET NZ
0011ED DF66 3EE5             7      LD  A,0E5H
0011EF DF68 C9              10      RET
                                
       DF69                     CHDIR:
0011F0 DF69 CD66E9          17      CALL    GETDPBD
0011F3 DF6C 381D            12      JR  C,CHDIR2
0011F5 DF6E DD751A          19      LD  (IX+DPB_SDIR),L
0011F8 DF71 DD741B          19      LD  (IX+DPB_SDIR+1),H
0011FB DF74 1815            12      JR  CHDIR2      ;POP_IX_RET
                                
       DF76                     LDDIR:
0011FD DF76 CD66E9          17      CALL    GETDPBD
001200 DF79 DD5E1A          19      LD  E,(IX+DPB_SDIR)
001203 DF7C DD561B          19      LD  D,(IX+DPB_SDIR+1)
001206 DF7F 13               6      INC DE
001207 DF80 FD730E          19      LD  (IY+14),E   ;(FCB)アクセスするディレクトリのクラスタ番号+1
00120A DF83 FD720F          19      LD  (IY+15),D
00120D DF86 1B               6      DEC DE
00120E DF87 AF               4      XOR A
00120F DF88 32A0F0          13      LD  (_DIRF),A
       DF8B                     CHDIR2:
001212 DF8B DDE1            14      POP IX
001214 DF8D C9              10      RET
                                
       DF8E                     LDDIRX:
001215 DF8E 3AA0F0          13      LD  A,(_DIRF)   ;(FCB)アクセスするディレクトリのセクタインデックス
001218 DF91 E67F             7      AND 07FH
       DF93                     LDDIRX1:
00121A DF93 32A0E6          13      LD  (_SECPS+1),A
00121D DF96 FD5E0E          19      LD  E,(IY+14)   ;(FCB)アクセスするディレクトリのクラスタ番号+1
001220 DF99 FD560F          19      LD  D,(IY+15)
001223 DF9C 1B               6      DEC DE
001224 DF9D CD46DF          17      CALL    ENDCL
001227 DFA0 D476DF          17      CALL    NC,LDDIR
       DFA3                     LDDIRS:
00122A DFA3 7A               4      LD  A,D
00122B DFA4 B3               4      OR  E
00122C DFA5 32A0F0          13      LD  (_DIRF),A   ;ディレクトリか判別
00122F DFA8 C9              10      RET
                                
       DFA9                     KILL:
001230 DFA9 CD79E0          17      CALL    CHKWILDX
001233 DFAC 3834            12      JR  C,KILLW
001235 DFAE CD4BDD          17      CALL    SOPENX
       DFB1                     KILLS:
001238 DFB1 3E1F             7      LD  A,01FH
00123A DFB3 D4F5DF          17      CALL    NC,CHKATT
00123D DFB6 D8              11      RET C
       DFB7                     KILLSX:
00123E DFB7 36E5            10      LD  (HL),0E5H   ;DIR
001240 DFB9 CD53E0          17      CALL    WTDB
001243 DFBC 111A00          10      LD  DE,01AH
001246 DFBF 19              11      ADD HL,DE
001247 DFC0 5E               7      LD  E,(HL)
001248 DFC1 23               6      INC HL
001249 DFC2 56               7      LD  D,(HL)
       DFC3                     KILLS1:
00124A DFC3 CD46DF          17      CALL    ENDCL
00124D DFC6 D0              11      RET NC      ;CF=0
00124E DFC7 21FEFF          10      LD  HL,0-2
001251 DFCA 19              11      ADD HL,DE
001252 DFCB D0              11      RET NC      ;DE= 0 or 1
001253 DFCC D5              11      PUSH    DE
001254 DFCD CDF7F0          17      CALL    _GNCL
001257 DFD0 ED53FEF1        20      LD  (_CLPS),DE
00125B DFD4 D1              10      POP DE
00125C DFD5 210000          10      LD  HL,0
00125F DFD8 D4FAF0          17      CALL    NC,_SNCL
001262 DFDB D8              11      RET C
001263 DFDC ED5BFEF1        20      LD  DE,(_CLPS)  ;FAT
001267 DFE0 18E1            12      JR  KILLS1
                                
       DFE2                     KILLW:
001269 DFE2 CD78DD          17      CALL    SOPEN
       DFE5                     KILLW1:
00126C DFE5 380B            12      JR  C,KILLW2
00126E DFE7 CD18DE          17      CALL    SOPENE2
001271 DFEA CDB1DF          17      CALL    KILLS
001274 DFED CDDCDD          17      CALL    NOPEN
001277 DFF0 18F3            12      JR  KILLW1
       DFF2                     KILLW2:
001279 DFF2 C8              11      RET Z
00127A DFF3 3F               4      CCF
00127B DFF4 C9              10      RET
                                
       DFF5                     CHKATT:
00127C DFF5 E5              11      PUSH    HL
00127D DFF6 110B00          10      LD  DE,00BH
001280 DFF9 19              11      ADD HL,DE
001281 DFFA A6               7      AND (HL)
001282 DFFB E1              10      POP HL
001283 DFFC C8              11      RET Z
001284 DFFD 37               4      SCF
001285 DFFE C9              10      RET
                                
       DFFF                     NAME:
001286 DFFF CD79E0          17      CALL    CHKWILDX
001289 E002 D8              11      RET C
00128A E003 110400          10      LD  DE,4
00128D E006 19              11      ADD HL,DE
00128E E007 221FE0          16      LD  (NAMEP+2),HL
001291 E00A 23               6      INC HL
001292 E00B CD7DE0          17      CALL    CHKWILD
001295 E00E D8              11      RET C
                                
001296 E00F CD4BDD          17      CALL    SOPENX
001299 E012 3E0F             7      LD  A,00FH
00129B E014 D4F5DF          17      CALL    NC,CHKATT
00129E E017 D8              11      RET C
                                
00129F E018 FD7E00          19      LD  A,(IY+0)
0012A2 E01B FDE5            15      PUSH    IY
0012A4 E01D FD210000        14  NAMEP:  LD  IY,0        ;自己書き換え
0012A8 E021 FD7700          19      LD  (IY+0),A
0012AB E024 CD4BDD          17      CALL    SOPENX
0012AE E027 FDE3            23      EX  (SP),IY
0012B0 E029 3F               4      CCF
0012B1 E02A D478DD          17      CALL    NC,SOPEN
0012B4 E02D EB               4      EX  DE,HL
0012B5 E02E E1              10      POP HL
0012B6 E02F D8              11      RET C
                                
       E030                     SETNAME:
0012B7 E030 01000B          10      LD  BC,11*256
0012BA E033 23               6      INC HL
0012BB E034 7E               7      LD  A,(HL)
0012BC E035 FEE5             7      CP  0E5H
0012BE E037 2004            12      JR  NZ,SNAME1
0012C0 E039 3E05             7      LD  A,5
0012C2 E03B 180E            12      JR  SNAME3
       E03D                     SNAME1:
0012C4 E03D 7E               7      LD  A,(HL)
0012C5 E03E 0C               4      INC C
0012C6 E03F 0D               4      DEC C
0012C7 E040 2009            12      JR  NZ,SNAME3
0012C9 E042 CD4EDF          17      CALL    CAP
0012CC E045 FEA0             7      CP  0A0H
0012CE E047 2002            12      JR  NZ,SNAME3
0012D0 E049 3E20             7      LD  A,020H
       E04B                     SNAME3:
0012D2 E04B 12               7      LD  (DE),A
0012D3 E04C 7E               7      LD  A,(HL)
0012D4 E04D 23               6      INC HL
0012D5 E04E CD66E0          17      CALL    FKAN
0012D8 E051 10EA            13      DJNZ    SNAME1
       E053                     WTDB:
0012DA E053 3EFF             7      LD  A,0FFH
0012DC E055 3239F0          13      LD  (SFILE),A
       E058                     SWTDBF:
0012DF E058 3E01             7      LD  A,1
0012E1 E05A 32A4F0          13      LD  (_WTDBF),A
0012E4 E05D AF               4      XOR A
0012E5 E05E C9              10      RET
                                
       E05F                     FKANC:
0012E6 E05F CB41             8      BIT 0,C
0012E8 E061 CC57DF          17      CALL    Z,CAP2
0012EB E064 1801            12      JR  FKANX
       E066                     FKAN:           ;漢字チェック
0012ED E066 13               6      INC DE
       E067                     FKANX:
0012EE E067 CB41             8      BIT 0,C
0012F0 E069 CB81             8      RES 0,C
0012F2 E06B C0              11      RET NZ
0012F3 E06C FE80             7      CP  080H
0012F5 E06E D8              11      RET C
0012F6 E06F FEA0             7      CP  0A0H
0012F8 E071 3803            12      JR  C,FKAN1
0012FA E073 FEE0             7      CP  0E0H
0012FC E075 D8              11      RET C
       E076                     FKAN1:
0012FD E076 0C               4      INC C
0012FE E077 A7               4      AND A
0012FF E078 C9              10      RET
                                
       E079                     CHKWILDX:
001300 E079 FDE5            15      PUSH    IY
001302 E07B E1              10      POP HL
001303 E07C 23               6      INC HL
       E07D                     CHKWILD:
001304 E07D 060B             7      LD  B,11
001306 E07F 3E3F             7      LD  A,'?'
       E081                     CHKWIL1:
001308 E081 BE               7      CP  (HL)
001309 E082 23               6      INC HL
00130A E083 37               4      SCF
00130B E084 C8              11      RET Z
00130C E085 10FA            13      DJNZ    CHKWIL1
00130E E087 AF               4      XOR A
00130F E088 C9              10      RET
                                
       E089                     SDIRENT:        ;IY=FCB HL=DIR
001310 E089 D5              11      PUSH    DE
001311 E08A E5              11      PUSH    HL
001312 E08B FDE5            15      PUSH    IY
001314 E08D D1              10      POP DE
001315 E08E EB               4      EX  DE,HL
001316 E08F CD30E0          17      CALL    SETNAME
                                ;               Attribute
001319 E092 FD7E0D          19      LD  A,(IY+13)   ;(FCB)属性(アトリビュート)
00131C E095 12               7      LD  (DE),A
00131D E096 13               6      INC DE
                                ;               Reserved
00131E E097 AF               4      XOR A
00131F E098 060A             7      LD  B,10
       E09A                     SDE1:
001321 E09A 12               7      LD  (DE),A
001322 E09B 13               6      INC DE
001323 E09C 10FC            13      DJNZ    SDE1
                                                    ;(FCB)更新時刻
001325 E09E 21E4F1          10      LD  HL,SDDATA       ;(FCB)更新年月日
001328 E0A1 060A             7      LD  B,SDDATAE-SDDATA    ;(FCB)ファイルの先頭クラスタ
       E0A3                     SDLOOP:                 ;(FCB)ファイルのサイズ(バイト単位)
00132A E0A3 7E               7      LD  A,(HL)
00132B E0A4 23               6      INC HL
00132C E0A5 32AAE0          13      LD  (SDPAT+2),A
00132F E0A8 FD7E00          19  SDPAT:  LD  A,(IY+0)    ;LD A,(IY+A)
001332 E0AB 12               7      LD  (DE),A
001333 E0AC 13               6      INC DE
001334 E0AD 10F4            13      DJNZ    SDLOOP
                                
001336 E0AF AF               4      XOR A
001337 E0B0 E1              10      POP HL
001338 E0B1 D1              10      POP DE
001339 E0B2 C9              10      RET
                                
       E0B3                     WOPEN:
00133A E0B3 FD7E0D          19      LD  A,(IY+13)   ;(FCB)属性(アトリビュート)
00133D E0B6 E61F             7      AND 01FH
00133F E0B8 37               4      SCF
001340 E0B9 C0              11      RET NZ
001341 E0BA FD361CFE        19      LD  (IY+28),0FEH    ;(FCB)オープンモード
       E0BE                     TOPEN2:
001345 E0BE AF               4      XOR A
       E0BF                     TOPEN:              ;Initializes the time stamp
001346 E0BF FD3617FF        19      LD  (IY+23),0FFH    ;(FCB)更新時刻
00134A E0C3 C9              10      RET
                                
       E0C4                     WRDFX:
00134B E0C4 3A2DDF          13      LD  A,(SPCPAT+1)    ;1クラスタの論理セクタ
       E0C7                     L_WRFX:
00134E E0C7 1F               4      RRA         ;->CF
00134F E0C8 3806            12      JR  C,E_WRFX
001351 E0CA CB39             8      SRL C
001353 E0CC CB1C             8      RR  H       ;CH=CH/2
001355 E0CE 18F7            12      JR  L_WRFX
       E0D0                     E_WRFX:
001357 E0D0 41               4      LD  B,C
001358 E0D1 4C               4      LD  C,H
001359 E0D2 03               6      INC BC
00135A E0D3 3E37             7      LD  A,037H      ;SCF
00135C E0D5 3230E5          13      LD  (DRDN1),A
                                
       E0D8                     WRDF:               ;BCクラスタ分FATを確保する
00135F E0D8 110200          10      LD  DE,2
001362 E0DB AF               4      XOR A
001363 E0DC 32A0E6          13      LD  (_SECPS+1),A
       E0DF                     WRDF1:
001366 E0DF C5              11      PUSH    BC
001367 E0E0 D5              11      PUSH    DE
001368 E0E1 CDF7F0          17      CALL    _GNCL
00136B E0E4 381C            12      JR  C,WRDF3
00136D E0E6 7A               4      LD  A,D     ;空いているかチェック
00136E E0E7 B3               4      OR  E
00136F E0E8 202A            12      JR  NZ,WRDF4
001371 E0EA E1              10      POP HL      ;HL=空いているクラスタ
001372 E0EB E5              11      PUSH    HL
001373 E0EC ED5BFEF1        20      LD  DE,(_CLPS)  ;DE=元の(_CLPS)
001377 E0F0 22FEF1          16      LD  (_CLPS),HL
00137A E0F3 7A               4      LD  A,D     ;元の(_CLPS)が 0 か?
00137B E0F4 B3               4      OR  E
00137C E0F5 2008            12      JR  NZ,WRDF2
00137E E0F7 FD751A          19      LD  (IY+26),L   ;(FCB)ファイルの先頭クラスタ
001381 E0FA FD741B          19      LD  (IY+27),H   ;元が空の場合はFCBにクラスタをセットする
001384 E0FD 1803            12      JR  WRDF3
       E0FF                     WRDF2:
001386 E0FF CDFAF0          17      CALL    _SNCL
       E102                     WRDF3:
001389 E102 D1              10      POP DE
00138A E103 C1              10      POP BC
00138B E104 D8              11      RET C
00138C E105 0B               6      DEC BC
00138D E106 78               4      LD  A,B
00138E E107 B1               4      OR  C
00138F E108 200C            12      JR  NZ,WRDF5    ;ここでループカウンタチェック
001391 E10A ED5BFEF1        20      LD  DE,(_CLPS)
001395 E10E 21FFFF          10      LD  HL,0FFFFH   ;FATエントリ終了(EOCマーク)
001398 E111 C3FAF0          10      JP  _SNCL
                                
       E114                     WRDF4:              ;DEクラスタが空じゃないので次に移動する
00139B E114 D1              10      POP DE
00139C E115 C1              10      POP BC
       E116                     WRDF5:
00139D E116 13               6      INC DE
00139E E117 CD46DF          17      CALL    ENDCL
0013A1 E11A 38C3            12      JR  C,WRDF1
0013A3 E11C 37               4      SCF
0013A4 E11D C9              10      RET
                                
       E11E                     RWXR:
0013A5 E11E 3A3DE4          13      LD  A,(SECSZ+2) ;1024=4 / 512=2 / 256=1
       E121                     L_RWX:
0013A8 E121 1F               4      RRA     ;->CF
0013A9 E122 3808            12      JR  C,E_RWX
0013AB E124 CB38             8      SRL B   ;BCH=BCH/2
0013AD E126 CB19             8      RR  C   ;
0013AF E128 CB1C             8      RR  H   ;
0013B1 E12A 18F5            12      JR  L_RWX
       E12C                     E_RWX:
0013B3 E12C FD5E1A          19      LD  E,(IY+26)   ;(FCB)ファイルの先頭クラスタ
0013B6 E12F FD561B          19      LD  D,(IY+27)
0013B9 E132 AF               4      XOR A
0013BA E133 32A0E6          13      LD  (_SECPS+1),A
       E136                     RWX1:
0013BD E136 ED53FEF1        20      LD  (_CLPS),DE
0013C1 E13A 7A               4      LD  A,D
0013C2 E13B B3               4      OR  E
0013C3 E13C 2813            12      JR  Z,SCF_RET   ;RET DE==0 => CF=1
                                
0013C5 E13E 78               4      LD  A,B
0013C6 E13F B1               4      OR  C
0013C7 E140 B4               4      OR  H
0013C8 E141 C8              11      RET Z       ;RET BCH==0 => CF=0
                                
0013C9 E142 CDA8E6          17      CALL    GNCLX
0013CC E145 D8              11      RET C
0013CD E146 7C               4      LD  A,H     ;
0013CE E147 25               4      DEC H       ;
0013CF E148 B7               4      OR  A       ;DEC BCH
0013D0 E149 2001            12      JR  NZ,RWX2     ;
0013D2 E14B 0B               6      DEC BC      ;
       E14C                     RWX2:
0013D3 E14C CD46DF          17      CALL    ENDCL
0013D6 E14F 38E5            12      JR  C,RWX1
       E151                     SCF_RET:
0013D8 E151 37               4      SCF
0013D9 E152 C9              10      RET
                                
       E153                     DSKF:
0013DA E153 110000          10  MAXCLP: LD  DE,0
0013DD E156 2AACF0          16      LD  HL,(_FAKEFREE)
0013E0 E159 7C               4      LD  A,H
0013E1 E15A B5               4      OR  L
0013E2 E15B 2803            12      JR  Z,DSKF1
0013E4 E15D 110100          10      LD  DE,1
       E160                     DSKF1:
0013E7 E160 D5              11      PUSH    DE
0013E8 E161 CDF7F0          17      CALL    _GNCL
0013EB E164 380C            12      JR  C,POPSCF
0013ED E166 7A               4      LD  A,D
0013EE E167 B3               4      OR  E
0013EF E168 2001            12      JR  NZ,DSKF2
0013F1 E16A 23               6      INC HL
       E16B                     DSKF2:
0013F2 E16B D1              10      POP DE
0013F3 E16C 1B               6      DEC DE
0013F4 E16D 7A               4      LD  A,D
0013F5 E16E B3               4      OR  E
0013F6 E16F 20EF            12      JR  NZ,DSKF1
0013F8 E171 C9              10      RET
                                
       E172                     POPSCF:
0013F9 E172 F1              10      POP AF
0013FA E173 37               4      SCF
0013FB E174 C9              10      RET
                                
       E175                     SETTMS:
0013FC E175 FD7E17          19      LD  A,(IY+23)   ;(FCB)ファイルを最後に変更した時刻
0013FF E178 3C               4      INC A
001400 E179 C0              11      RET NZ      ;ファイルが更新されていない
       E17A                     SETTMSX:            ;FCBに日付時刻をセットする
001401 E17A CDDAD8          17      CALL    _SYS2C      ;(BDOS)時刻の獲得
                                                ;H←時  L←分  D←秒
001404 E17D CB25             8      SLA L       ;   *2
001406 E17F CB25             8      SLA L       ;   *4
001408 E181 29              11      ADD HL,HL       ;*2 *8
001409 E182 29              11      ADD HL,HL       ;*4 *16
00140A E183 29              11      ADD HL,HL       ;*8 *32
00140B E184 7A               4      LD  A,D
00140C E185 0F               4      RRCA            ;bit.0->7->->->0->C
00140D E186 E61F             7      AND 01FH
00140F E188 B5               4      OR  L
001410 E189 FD7716          19      LD  (IY+22),A   ;(FCB)ファイルを最後に変更した時刻
001413 E18C FD7417          19      LD  (IY+23),H
                                
001416 E18F CDD4D8          17      CALL    _SYS2A      ;(BDOS)日付の獲得
                                                ;HL←年  D←月  E←日
001419 E192 0144F8          10      LD  BC,0-1980
00141C E195 09              11      ADD HL,BC
00141D E196 65               4      LD  H,L
                                
00141E E197 7A               4      LD  A,D
00141F E198 87               4      ADD A,A     ;*2
001420 E199 87               4      ADD A,A     ;*4
001421 E19A 87               4      ADD A,A     ;*8
001422 E19B 87               4      ADD A,A     ;*16
001423 E19C 6F               4      LD  L,A
001424 E19D 29              11      ADD HL,HL       ;*32
001425 E19E 7D               4      LD  A,L
001426 E19F B3               4      OR  E
001427 E1A0 FD7714          19      LD  (IY+20),A   ;(FCB)ファイルを最後に変更した日付
00142A E1A3 FD7415          19      LD  (IY+21),H
00142D E1A6 C9              10      RET
                                
       E1A7                     PUSHRR:
00142E E1A7 323FE2          13      LD  (SETSEQ_SWC_RND),A
001431 E1AA 2251E2          16      LD  (SETSEQ_SWC_SEQ_RR),HL
001434 E1AD CDCDE1          17      CALL    GET_RR_AHL
001437 E1B0 220FF0          16      LD  (RR_BUF_HL),HL
00143A E1B3 3211F0          13      LD  (RR_BUF_A),A
00143D E1B6 C9              10      RET
                                
       E1B7                     GET_CPM_R_SIZE:     ;バイト単位からCP/Mのレコード単位を求める（1レコード=128バイト）
00143E E1B7 87               4      ADD A,A     ;in BHLA => out AHL
00143F E1B8 ED6A            15      ADC HL,HL
001441 E1BA CB18             8      RR  B
001443 E1BC B7               4      OR  A
001444 E1BD 78               4      LD  A,B     ;ここでフラグは変化しない
001445 E1BE C8              11      RET Z
001446 E1BF 2C               4      INC L       ;INC AHL
001447 E1C0 C0              11      RET NZ      ;
001448 E1C1 24               4      INC H       ;
001449 E1C2 C0              11      RET NZ      ;
00144A E1C3 3C               4      INC A       ;
00144B E1C4 C9              10      RET
                                
       E1C5                     INIT_RND:
00144C E1C5 3ECD             7      LD  A,0CDH      ;CALL ????
00144E E1C7 2114E2          10      LD  HL,POPRR
001451 E1CA CDA7E1          17      CALL    PUSHRR
       E1CD                     GET_RR_AHL:
001454 E1CD FD6E21          19      LD  L,(IY+33)   ;(FCB)Random record
001457 E1D0 FD6622          19      LD  H,(IY+34)   ;
00145A E1D3 FD7E23          19      LD  A,(IY+35)   ;
00145D E1D6 C9              10      RET
       E1D7                     SET_RR_AHL:
00145E E1D7 FD7521          19      LD  (IY+33),L   ;(FCB)Random record
001461 E1DA FD7422          19      LD  (IY+34),H
001464 E1DD FD7723          19      LD  (IY+35),A
001467 E1E0 C9              10      RET
       E1E1                     INIT_SEQ:
001468 E1E1 3E01             7      LD  A,1     ;LD BC,????
00146A E1E3 2111E2          10      LD  HL,SETSEQ
00146D E1E6 CDA7E1          17      CALL    PUSHRR
       E1E9                     GETSEQ:
001470 E1E9 FD6E20          19      LD  L,(IY+32)   ;(FCB)カレントレコード
001473 E1EC FD660C          19      LD  H,(IY+12)   ;(FCB)カレントブロック
001476 E1EF AF               4      XOR A
                                
001477 E1F0 CB25             8      SLA L   ;L=L*2
                                
001479 E1F2 CB3C             8      SRL H   ;HL=HL/2
00147B E1F4 CB1D             8      RR  L   ;
00147D E1F6 C9              10      RET
                                
       E1F7                     SETSEQ1:
00147E E1F7 F5              11      PUSH    AF
00147F E1F8 E5              11      PUSH    HL      ;AHL=Random record
001480 E1F9 CDCDE1          17      CALL    GET_RR_AHL
001483 E1FC 47               4      LD  B,A     ;AHL→HLA
001484 E1FD 7D               4      LD  A,L     ;(IY+33)(FCB)ランダムレコード
001485 E1FE 6C               4      LD  L,H     ;(IY+34)
001486 E1FF 60               4      LD  H,B     ;(IY+35)
001487 E200 0600             7      LD  B,0
                                
001489 E202 CDB7E1          17      CALL    GET_CPM_R_SIZE
                                
00148C E205 29              11      ADD HL,HL
00148D E206 CB3D             8      SRL L       ;L=L/2
00148F E208 FD7520          19      LD  (IY+32),L   ;(FCB)カレントレコード
001492 E20B FD740C          19      LD  (IY+12),H   ;(FCB)カレントブロック
001495 E20E E1              10      POP HL
001496 E20F F1              10      POP AF
001497 E210 C9              10      RET
       E211                     SETSEQ:
001498 E211 CDF7E1          17      CALL    SETSEQ1
       E214                     POPRR:
00149B E214 F5              11      PUSH    AF
00149C E215 E5              11      PUSH    HL
00149D E216 2A0FF0          16      LD  HL,(RR_BUF_HL)
0014A0 E219 3A11F0          13      LD  A,(RR_BUF_A)
0014A3 E21C CDD7E1          17      CALL    SET_RR_AHL
0014A6 E21F E1              10      POP HL
0014A7 E220 F1              10      POP AF
0014A8 E221 C9              10      RET
                                
       E222                     RB_WRITE:
0014A9 E222 C5              11      PUSH    BC
0014AA E223 ED4B4CF1        20      LD  BC,(STABLE+2*026H)  ;(BDOS)ランダムブロック書き込み
0014AE E227 1805            12      JR  RBRW
       E229                     RB_READ:
0014B0 E229 C5              11      PUSH    BC
0014B1 E22A ED4B4EF1        20      LD  BC,(STABLE+2*027H)  ;(BDOS)ランダムブロック読み込み
       E22E                     RBRW:
0014B5 E22E 1F               4      RRA     ;AHL = AHL*128
0014B6 E22F 7C               4      LD  A,H ;AHL = AHL0/2
0014B7 E230 1F               4      RRA     ;A
0014B8 E231 65               4      LD  H,L ;
0014B9 E232 CB1C             8      RR  H   ;H
0014BB E234 2E00             7      LD  L,0 ;
0014BD E236 CB1D             8      RR  L   ;L
0014BF E238 CDD7E1          17      CALL    SET_RR_AHL
0014C2 E23B 218000          10      LD  HL,128
0014C5 E23E C5              11      PUSH    BC
       E23F                     SETSEQ_SWC_RND:
0014C6 E23F CDF7E1          17      CALL    SETSEQ1
0014C9 E242 C1              10      POP BC
0014CA E243 FDCB20FE        23      SET 7,(IY+32)   ;(FCB)カレントレコード
0014CE E247 FDE5            15      PUSH    IY
0014D0 E249 D1              10      POP DE
0014D1 E24A D5              11      PUSH    DE
0014D2 E24B CD59E2          17      CALL    JP_BC
0014D5 E24E FDE1            14      POP IY
0014D7 E250 CD11E2          17      CALL    SETSEQ
       E251                     SETSEQ_SWC_SEQ_RR   EQU $-2
0014DA E253 FDCB20BE        23      RES 7,(IY+32)   ;(FCB)カレントレコード
                                
0014DE E257 C1              10      POP BC
0014DF E258 C9              10      RET
       E259                     JP_BC:
0014E0 E259 C5              11      PUSH    BC
0014E1 E25A C9              10      RET
                                
       DDD6                     _SYS03  EQU SCF_FF_RET  ;(BDOS)外部入力
       DDD6                     _SYS2B  EQU SCF_FF_RET  ;(BDOS)日付の設定
       DDD6                     _SYS2D  EQU SCF_FF_RET  ;(BDOS)時刻の設定
       DDD6                     _SYS39  EQU SCF_FF_RET  ;(BDOS)サブディレクトリの作成
       DDD6                     _SYS3A  EQU SCF_FF_RET  ;(BDOS)サブディレクトリの削除
                                
[EOF:LDFILE.ASM:SHIFT_JIS]
                                    INCLUDE "LDFILE2.ASM"
                                
                                ;   LSX-Dodgers FILE2
                                
                                                ;Write random block
       E25B                     _SYS26:     ;(BDOS)ランダムブロック書き込み
0014E2 E25B AF               4      XOR A
0014E3 E25C 3230E5          13      LD  (DRDN1),A   ;NOP
0014E6 E25F 2280E4          16      LD  (RBSIZE),HL ;HL←書き込むレコード数
0014E9 E262 225DF0          16      LD  (LEFTX),HL
0014EC E265 CD2BDD          17      CALL    SETDRV
                                
0014EF E268 CDD8E3          17      CALL    RBX0
0014F2 E26B DAF8E2          10      JP  C,RBWERR
0014F5 E26E CDB3E0          17      CALL    WOPEN
0014F8 E271 DAF8E2          10      JP  C,RBWERR
0014FB E274 7C               4      LD  A,H
0014FC E275 B5               4      OR  L
0014FD E276 CAF1E2          10      JP  Z,RBW1
                                
001500 E279 2B               6      DEC HL
                                
001501 E27A CD96E4          17      CALL    GET_RR_BCDE ;BCDE=Random record
                                
001504 E27D 19              11      ADD HL,DE       ;BCHL=HL+BCDE
001505 E27E 3001            12      JR  NC,S26X1    ;
001507 E280 03               6      INC BC      ;
       E281                     S26X1:
001508 E281 CD1EE1          17      CALL    RWXR
00150B E284 DCC4E0          17      CALL    C,WRDFX
00150E E287 DAF8E2          10      JP  C,RBWERR
                                
001511 E28A CD07E4          17      CALL    RBX2
001514 E28D 281A            12      JR  Z,RBWB      ;NZ=セクタ以下の端数がある
001516 E28F CD26E4          17      CALL    RBXA
001519 E292 3864            12      JR  C,RBWERR
00151B E294 EB               4      EX  DE,HL
00151C E295 C5              11      PUSH    BC
00151D E296 EDB0                    LDIR
00151F E298 225FF0          16      LD  (DTAX),HL
                                
001522 E29B CD58E0          17      CALL    SWTDBF      ;バッファデータは更新された
                                
001525 E29E 2A5DF0          16      LD  HL,(LEFTX)
001528 E2A1 D1              10      POP DE
001529 E2A2 ED52            15      SBC HL,DE
00152B E2A4 225DF0          16      LD  (LEFTX),HL
00152E E2A7 2831            12      JR  Z,RBWEND
                                
       E2A9                     RBWB:
001530 E2A9 CD5BE4          17      CALL    RBXB
001533 E2AC 2814            12      JR  Z,RBWC
       E2AE                     RBWB1:
001535 E2AE C5              11      PUSH    BC
001536 E2AF D5              11      PUSH    DE
001537 E2B0 CD29DF          17      CALL    CLUSTX
00153A E2B3 CDAAE4          17      CALL    DWTC
00153D E2B6 D1              10      POP DE
00153E E2B7 C1              10      POP BC
00153F E2B8 D4A8E6          17      CALL    NC,GNCLX
001542 E2BB 383B            12      JR  C,RBWERR
001544 E2BD 10EF            13      DJNZ    RBWB1
001546 E2BF CDFAE4          17      CALL    DRW_FLUSH
       E2C2                     RBWC:
001549 E2C2 CD73E4          17      CALL    RBXC
00154C E2C5 2813            12      JR  Z,RBWEND
00154E E2C7 C5              11      PUSH    BC
00154F E2C8 CD29DF          17      CALL    CLUSTX
001552 E2CB CD2FE5          17      CALL    DRDN
001555 E2CE C1              10      POP BC
001556 E2CF 3827            12      JR  C,RBWERR
001558 E2D1 ED5B7EF1        20      LD  DE,(_DTBUF)
00155C E2D5 EDB0                    LDIR
00155E E2D7 CD58E0          17      CALL    SWTDBF      ;バッファデータは更新された
       E2DA                     RBWEND:
001561 E2DA CD7FE4          17      CALL    RBXEND
                                
001564 E2DD CDE7E3          17      CALL    RBX1
001567 E2E0 300F            12      JR  NC,RBW1     ;ランダムレコードの方が大きい場合はサイズを合わせる
001569 E2E2 CD96E4          17      CALL    GET_RR_BCDE ;BCDE=Random record
00156C E2E5 FD7310          19      LD  (IY+16),E   ;ファイルのサイズ(バイト単位)
00156F E2E8 FD7211          19      LD  (IY+17),D   ;
001572 E2EB FD7112          19      LD  (IY+18),C   ;
001575 E2EE FD7013          19      LD  (IY+19),B   ;
       E2F1                     RBW1:
001578 E2F1 FDE1            14      POP IY
00157A E2F3 C1              10      POP BC
00157B E2F4 D1              10      POP DE
00157C E2F5 E1              10      POP HL
       E2F6                     DD_NUL:
00157D E2F6 AF               4      XOR A
       E2F7                     DRDF0:
       E2F7                     DWTF0:
00157E E2F7 C9              10      RET
                                
       E2F8                     RBWERR:
00157F E2F8 FDE5            15      PUSH    IY
001581 E2FA D1              10      POP DE
001582 E2FB 2A20F1          16      LD  HL,(STABLE+2*010H)
001585 E2FE CD0F00          17      CALL    JP_HL
       E301                     RBRERR1:
001588 E301 3E01             7      LD  A,001H
       E303                     RBRERR2:
00158A E303 FDE1            14      POP IY
00158C E305 C1              10      POP BC
00158D E306 D1              10      POP DE
00158E E307 E1              10      POP HL
00158F E308 37               4      SCF
001590 E309 210000          10      LD  HL,0
001593 E30C C9              10      RET
                                
       E30D                     RBRERR:
001594 E30D 3EFF             7      LD  A,0FFH
001596 E30F 18F2            12      JR  RBRERR2
                                
       E311                     RBRFL:
001598 E311 3E00             7  RBRFLP: LD  A,000H
00159A E313 FE0D             7      CP  00DH
00159C E315 2005            12      JR  NZ,RBRFL1
00159E E317 D5              11      PUSH    DE
00159F E318 1E0A             7      LD  E,00AH
0015A1 E31A 1805            12      JR  RBRFL2
       E31C                     RBRFL1:
0015A3 E31C D5              11      PUSH    DE
0015A4 E31D CD09F0          17      CALL    _SYS07
0015A7 E320 5F               4      LD  E,A
       E321                     RBRFL2:
0015A8 E321 CDCDF0          17      CALL    _PRINT
0015AB E324 7B               4      LD  A,E
0015AC E325 D1              10      POP DE
0015AD E326 3212E3          13      LD  (RBRFLP+1),A
0015B0 E329 C9              10      RET
       E32A                     DDX:
0015B1 E32A FD7E01          19      LD  A,(IY+1)    ;(FCB)主ファイル名
0015B4 E32D CD4EDF          17      CALL    CAP
0015B7 E330 FE41             7      CP  'A'
0015B9 E332 C9              10      RET
                                
                                                ;Read random block
       E333                     _SYS27:     ;(BDOS)ランダムブロック読み込み
0015BA E333 225DF0          16      LD  (LEFTX),HL
0015BD E336 CD2BDD          17      CALL    SETDRV
                                
0015C0 E339 FDCB0D66        20      BIT 4,(IY+13)   ;(FCB)属性(アトリビュート)
0015C4 E33D C2C6E3          10      JP  NZ,RBRDIR   ;ディレクトリ
0015C7 E340 CDD8E3          17      CALL    RBX0
0015CA E343 DA0DE3          10      JP  C,RBRERR
0015CD E346 CDE7E3          17      CALL    RBX1
0015D0 E349 D4FFE3          17      CALL    NC,RBX1R
0015D3 E34C DA01E3          10      JP  C,RBRERR1
0015D6 E34F EB               4      EX  DE,HL
0015D7 E350 ED52            15      SBC HL,DE       ;CP 00HL,BCDE
0015D9 E352 19              11      ADD HL,DE
0015DA E353 79               4      LD  A,C
0015DB E354 DE00             7      SBC A,0
0015DD E356 78               4      LD  A,B
0015DE E357 DE00             7      SBC A,0
0015E0 E359 3801            12      JR  C,RBR1
0015E2 E35B EB               4      EX  DE,HL
       E35C                     RBR1:
0015E3 E35C 9F               4      SBC A,A
0015E4 E35D E601             7      AND 1
0015E6 E35F 32C4E3          13      LD  (RBRAP+1),A
                                
0015E9 E362 7C               4      LD  A,H
0015EA E363 B5               4      OR  L
0015EB E364 2857            12      JR  Z,RBREND0
                                
0015ED E366 2280E4          16      LD  (RBSIZE),HL ;HL←読み込むレコード数
0015F0 E369 225DF0          16      LD  (LEFTX),HL
                                
0015F3 E36C CD07E4          17      CALL    RBX2
0015F6 E36F 2819            12      JR  Z,RBRB
0015F8 E371 CD26E4          17      CALL    RBXA
0015FB E374 DA0DE3          10      JP  C,RBRERR
0015FE E377 C5              11      PUSH    BC
0015FF E378 EDB0                    LDIR
001601 E37A ED535FF0        20      LD  (DTAX),DE
001605 E37E 2A5DF0          16      LD  HL,(LEFTX)
001608 E381 D1              10      POP DE
001609 E382 A7               4      AND A
00160A E383 ED52            15      SBC HL,DE
00160C E385 225DF0          16      LD  (LEFTX),HL
00160F E388 2830            12      JR  Z,RBREND
                                
       E38A                     RBRB:
001611 E38A CD5BE4          17      CALL    RBXB
001614 E38D 2815            12      JR  Z,RBRC
       E38F                     RBRB1:
001616 E38F C5              11      PUSH    BC
001617 E390 D5              11      PUSH    DE
001618 E391 CD29DF          17      CALL    CLUSTX
00161B E394 CDB0E4          17      CALL    DRDC
00161E E397 D1              10      POP DE
00161F E398 C1              10      POP BC
001620 E399 D4A8E6          17      CALL    NC,GNCLX
001623 E39C DA0DE3          10      JP  C,RBRERR
001626 E39F 10EE            13      DJNZ    RBRB1
001628 E3A1 CDFAE4          17      CALL    DRW_FLUSH
       E3A4                     RBRC:
00162B E3A4 CD73E4          17      CALL    RBXC
00162E E3A7 2811            12      JR  Z,RBREND
001630 E3A9 C5              11      PUSH    BC
001631 E3AA CD29DF          17      CALL    CLUSTX
001634 E3AD CD13E5          17      CALL    DRDX
001637 E3B0 C1              10      POP BC
001638 E3B1 DA0DE3          10      JP  C,RBRERR
00163B E3B4 EB               4      EX  DE,HL
00163C E3B5 2A7EF1          16      LD  HL,(_DTBUF)
00163F E3B8 EDB0                    LDIR
       E3BA                     RBREND:
001641 E3BA CD7FE4          17      CALL    RBXEND
       E3BD                     RBREND0:
001644 E3BD FDE1            14      POP IY
001646 E3BF C1              10      POP BC
001647 E3C0 D1              10      POP DE
001648 E3C1 F1              10      POP AF  ;(HL)
001649 E3C2 AF               4      XOR A
00164A E3C3 3E00             7  RBRAP:  LD  A,000H
00164C E3C5 C9              10      RET
                                
       E3C6                     RBRDIR:
00164D E3C6 FD6E1A          19      LD  L,(IY+26)   ;(FCB)ファイルの先頭クラスタ
001650 E3C9 FD661B          19      LD  H,(IY+27)
001653 E3CC CD69DF          17      CALL    CHDIR
001656 E3CF AF               4      XOR A
001657 E3D0 67               4      LD  H,A
001658 E3D1 6F               4      LD  L,A
001659 E3D2 3C               4      INC A
00165A E3D3 32C4E3          13      LD  (RBRAP+1),A
00165D E3D6 18E5            12      JR  RBREND0
                                
       E3D8                     RBX0:
00165F E3D8 2A8AF0          16      LD  HL,(_DTA)
001662 E3DB 225FF0          16      LD  (DTAX),HL
001665 E3DE 2A5DF0          16      LD  HL,(LEFTX)
001668 E3E1 FD7E1C          19      LD  A,(IY+28)   ;(FCB)オープンモード
00166B E3E4 D6FD             7      SUB 0FDH
00166D E3E6 C9              10      RET
                                
       E3E7                     RBX1:               ;ファイルサイズとランダムレコードを比べる
00166E E3E7 E5              11      PUSH    HL      ;Record byte
                                                ;AHL=File size
00166F E3E8 FD6E10          19      LD  L,(IY+16)   ;ファイルのサイズ(バイト単位)
001672 E3EB FD6611          19      LD  H,(IY+17)   ;
001675 E3EE FD7E12          19      LD  A,(IY+18)   ;
                                
001678 E3F1 CD96E4          17      CALL    GET_RR_BCDE ;BCDE=Random record
                                
00167B E3F4 A7               4      AND A
00167C E3F5 ED52            15      SBC HL,DE
00167E E3F7 99               4      SBC A,C
00167F E3F8 4F               4      LD  C,A
001680 E3F9 FD7E13          19      LD  A,(IY+19)   ;ファイルのサイズ
001683 E3FC 98               4      SBC A,B
001684 E3FD D1              10      POP DE
001685 E3FE C9              10      RET
       E3FF                     RBX1R:
001686 E3FF 47               4      LD  B,A
001687 E400 B1               4      OR  C
001688 E401 EB               4      EX  DE,HL   ;BCDE=File byte HL=Record byte
001689 E402 B2               4      OR  D
00168A E403 B3               4      OR  E
00168B E404 C0              11      RET NZ
00168C E405 37               4      SCF
00168D E406 C9              10      RET
                                
       E407                     RBX2:               ;Cluster settings
00168E E407 FD6622          19      LD  H,(IY+34)   ;(+33)(FCB)ランダムレコード
001691 E40A FD4E23          19      LD  C,(IY+35)
001694 E40D 0600             7      LD  B,0
001696 E40F FDCB207E        20      BIT 7,(IY+32)   ;(FCB)カレントレコード
00169A E413 2003            12      JR  NZ,RBX3
00169C E415 FD4624          19      LD  B,(IY+36)
       E418                     RBX3:
00169F E418 CD1EE1          17      CALL    RWXR
0016A2 E41B 3A3DE4          13      LD  A,(SECSZ+2) ;1024=4 / 512=2 / 256=1
0016A5 E41E 3D               4      DEC A
0016A6 E41F FDA622          19      AND (IY+34)
0016A9 E422 FDB621          19      OR  (IY+33)
0016AC E425 C9              10      RET
                                
       E426                     RBXA:
0016AD E426 C5              11      PUSH    BC
0016AE E427 D5              11      PUSH    DE
0016AF E428 CD29DF          17      CALL    CLUSTX
0016B2 E42B CD13E5          17      CALL    DRDX
0016B5 E42E D1              10      POP DE
0016B6 E42F C1              10      POP BC
0016B7 E430 D4A8E6          17      CALL    NC,GNCLX
0016BA E433 D8              11      RET C
0016BB E434 ED53FEF1        20      LD  (_CLPS),DE
                                
0016BF E438 FD4E21          19      LD  C,(IY+33)   ;(FCB)ランダムレコード
0016C2 E43B 210004          10  SECSZ:  LD  HL,0400H    ;自己書き換え 1024=0400H / 512=0200H ここに1セクタのサイズが格納される
0016C5 E43E 7C               4      LD  A,H
0016C6 E43F 3D               4      DEC A       ;1024=3 / 512=1
0016C7 E440 FDA622          19      AND (IY+34)     ;(FCB)ランダムレコード
0016CA E443 47               4      LD  B,A     ;BCに1セクタ以下の端数が入る
0016CB E444 ED42            15      SBC HL,BC       ;残りを計算
                                
0016CD E446 ED5B5DF0        20      LD  DE,(LEFTX)
0016D1 E44A ED52            15      SBC HL,DE       ;CP HL,DE
0016D3 E44C 19              11      ADD HL,DE       ;
0016D4 E44D 3801            12      JR  C,RBXA1     ;DEとHLを比較して大きい方をHLに
0016D6 E44F EB               4      EX  DE,HL
       E450                     RBXA1:
0016D7 E450 E5              11      PUSH    HL
0016D8 E451 2A7EF1          16      LD  HL,(_DTBUF)
0016DB E454 09              11      ADD HL,BC
0016DC E455 ED5B5FF0        20      LD  DE,(DTAX)
0016E0 E459 C1              10      POP BC
0016E1 E45A C9              10      RET
                                
       E45B                     RBXB:
0016E2 E45B 2A5FF0          16      LD  HL,(DTAX)
0016E5 E45E ED5BFEF1        20      LD  DE,(_CLPS)
0016E9 E462 3A5EF0          13      LD  A,(LEFTX+1)
0016EC E465 47               4      LD  B,A
0016ED E466 3A3DE4          13      LD  A,(SECSZ+2) ;1024=4 / 512=2 / 256=1
       E469                     RBXB1:
0016F0 E469 1F               4      RRA     ;->CF
0016F1 E46A 3804            12      JR  C,RBXB2
0016F3 E46C CB38             8      SRL B   ;B=B/2
0016F5 E46E 18F9            12      JR  RBXB1
       E470                     RBXB2:
0016F7 E470 78               4      LD  A,B
0016F8 E471 B7               4      OR  A
0016F9 E472 C9              10      RET
                                
       E473                     RBXC:
0016FA E473 ED4B5DF0        20      LD  BC,(LEFTX)
0016FE E477 3A3DE4          13      LD  A,(SECSZ+2) ;1024=4 / 512=2 / 256=1
001701 E47A 3D               4      DEC A
001702 E47B A0               4      AND B
001703 E47C 47               4      LD  B,A     ;1セクタ以下の端数がない場合はZ
001704 E47D B1               4      OR  C
001705 E47E C9              10      RET
                                
       E47F                     RBXEND:             ;レコード数だけランダムレコードを進める
001706 E47F 110000          10      LD  DE,0        ;進めるレコード数(RBSIZE)
       E480                     RBSIZE  EQU $-2
001709 E482 CDCDE1          17      CALL    GET_RR_AHL
00170C E485 19              11      ADD HL,DE
00170D E486 CE00             7      ADC A,0
00170F E488 CDD7E1          17      CALL    SET_RR_AHL
001712 E48B EB               4      EX  DE,HL       ;HL=進めるレコード数
001713 E48C D0              11      RET NC
001714 E48D FDCB207E        20      BIT 7,(IY+32)   ;(FCB)カレントレコード
001718 E491 C0              11      RET NZ
001719 E492 FD3424          23      INC (IY+36)
00171C E495 C9              10      RET
                                
       E496                     GET_RR_BCDE:            ;BCDE=Random record
00171D E496 FD5E21          19      LD  E,(IY+33)   ;(FCB)ランダムレコード
001720 E499 FD5622          19      LD  D,(IY+34)
001723 E49C FD4E23          19      LD  C,(IY+35)
001726 E49F 0600             7      LD  B,0     ;CP/M互換のアクセスの場合はFCBは36バイト
001728 E4A1 FDCB207E        20      BIT 7,(IY+32)   ;(FCB)カレントレコード
00172C E4A5 C0              11      RET NZ
00172D E4A6 FD4624          19      LD  B,(IY+36)
001730 E4A9 C9              10      RET
                                
                                ;   ランダムブロックアクセスの連続したセクタをまとめる
                                
       E4AA                     DWTC:
001731 E4AA E5              11      PUSH    HL
001732 E4AB 213AE8          10      LD  HL,DWT24B
001735 E4AE 1804            12      JR  DWTC1
       E4B0                     DRDC:
001737 E4B0 E5              11      PUSH    HL
001738 E4B1 212AE8          10      LD  HL,DRD24B
       E4B4                     DWTC1:
00173B E4B4 220EE5          16      LD  (DRWF_MODE),HL
00173E E4B7 E1              10      POP HL
00173F E4B8 3AFEE4          13      LD  A,(DRWF_B)
001742 E4BB B7               4      OR  A
001743 E4BC 200F            12      JR  NZ,DRDC1
       E4BE                     SAVE_DRWC:
001745 E4BE 0601             7      LD  B,1
001747 E4C0 ED43FDE4        20      LD  (DRWF_C),BC
00174B E4C4 ED5304E5        20      LD  (DRWF_E),DE
00174F E4C8 2207E5          16      LD  (DRWF_HL),HL
001752 E4CB 1820            12      JR  INC_HL_DRWC
       E4CD                     DRDC1:
001754 E4CD E5              11      PUSH    HL
001755 E4CE 2104E5          10      LD  HL,DRWF_E
001758 E4D1 86               7      ADD A,(HL)
001759 E4D2 F5              11      PUSH    AF
00175A E4D3 BB               4      CP  E
00175B E4D4 201D            12      JR  NZ,DRDC2
00175D E4D6 F1              10      POP AF
00175E E4D7 23               6      INC HL
00175F E4D8 7E               7      LD  A,(HL)
001760 E4D9 CE00             7      ADC A,0
001762 E4DB F5              11      PUSH    AF
001763 E4DC BA               4      CP  D
001764 E4DD 2014            12      JR  NZ,DRDC2
001766 E4DF F1              10      POP AF
001767 E4E0 3AFDE4          13      LD  A,(DRWF_C)
00176A E4E3 CE00             7      ADC A,0
00176C E4E5 B9               4      CP  C
00176D E4E6 200C            12      JR  NZ,DRDC3
00176F E4E8 21FEE4          10      LD  HL,DRWF_B
001772 E4EB 34              11      INC (HL)
001773 E4EC E1              10      POP HL
       E4ED                     INC_HL_DRWC:
001774 E4ED 3A3DE4          13      LD  A,(SECSZ+2)     ;1セクタのサイズの上位1バイト
001777 E4F0 84               4      ADD A,H
001778 E4F1 67               4      LD  H,A
001779 E4F2 C9              10      RET
       E4F3                     DRDC2:
00177A E4F3 F1              10      POP AF
       E4F4                     DRDC3:
00177B E4F4 CDFAE4          17      CALL    DRW_FLUSH
00177E E4F7 E1              10      POP HL
00177F E4F8 18C4            12      JR  SAVE_DRWC
                                
                                ;   ランダムブロックアクセスの連続したセクタをまとめたものをフラッシュする
       E4FA                     DRW_FLUSH:
001781 E4FA C5              11      PUSH    BC
001782 E4FB D5              11      PUSH    DE
001783 E4FC 010000          10      LD  BC,0
       E4FD                     DRWF_C  EQU $-2
       E4FE                     DRWF_B  EQU $-1
001786 E4FF 78               4      LD  A,B
001787 E500 B7               4      OR  A
001788 E501 280D            12      JR  Z,DRDF1
00178A E503 110000          10      LD  DE,0
       E504                     DRWF_E  EQU $-2
       E505                     DRWF_D  EQU $-1
00178D E506 210000          10      LD  HL,0
       E507                     DRWF_HL EQU $-2
001790 E509 AF               4      XOR A
001791 E50A 32FEE4          13      LD  (DRWF_B),A
001794 E50D CD2AE8          17      CALL    DRD24B
       E50E                     DRWF_MODE   EQU $-2
       E510                     DRDF1:
001797 E510 D1              10      POP DE
001798 E511 C1              10      POP BC
001799 E512 C9              10      RET
[EOF:LDFILE2.ASM:SHIFT_JIS]
                                    INCLUDE "LDDIO.ASM"
                                
                                ;   LSX-Dodgers DIO
                                
       E513                     DRDX:
00179A E513 CD51E5          17      CALL    DRDY
00179D E516 C8              11      RET Z
00179E E517 CD37E5          17      CALL    DRDX1       ;データバッファの情報を保存
0017A1 E51A D8              11      RET C
0017A2 E51B E5              11      PUSH    HL
0017A3 E51C C5              11      PUSH    BC
0017A4 E51D D5              11      PUSH    DE
0017A5 E51E 2A7EF1          16      LD  HL,(_DTBUF)
0017A8 E521 3A7AE5          13      LD  A,(_DBS24+1)
0017AB E524 4F               4      LD  C,A
0017AC E525 CD28E8          17      CALL    DRD24
0017AF E528 DC4CE5          17      CALL    C,DRDNE
       E52B                     POP_DE_BC_HL_RET:
0017B2 E52B D1              10      POP DE
0017B3 E52C C1              10      POP BC
0017B4 E52D E1              10      POP HL
0017B5 E52E C9              10      RET
                                
                                ;   CDE:セクタ番号
       E52F                     DRDN:
0017B6 E52F AF               4      XOR A
0017B7 E530 00               4  DRDN1:  NOP         ;自己書き換え NOP / SCF
0017B8 E531 30E0            12      JR  NC,DRDX
       E533                     DRDNX:
0017BA E533 CD51E5          17      CALL    DRDY
0017BD E536 C8              11      RET Z
       E537                     DRDX1:
0017BE E537 CD67E5          17      CALL    DWTX
                                                ;データバッファの読み込んだドライブ・セクタ情報を保存
0017C1 E53A ED53A6F0        20      LD  (_DBSEC),DE
0017C5 E53E 79               4      LD  A,C
0017C6 E53F 327AE5          13      LD  (_DBS24+1),A
                                
0017C9 E542 3A88F0          13      LD  A,(_DRV)
0017CC E545 32A5F0          13      LD  (_DBDRV),A
0017CF E548 CDD9F0          17      CALL    _CHGDRV
0017D2 E54B D0              11      RET NC
       E54C                     DRDNE:
0017D3 E54C 9F               4      SBC A,A     ;CF=1ならばA=0FFH
0017D4 E54D 32A5F0          13      LD  (_DBDRV),A
0017D7 E550 C9              10      RET
                                
                                ;   CDE:セクタ番号
       E551                     DRDY:
0017D8 E551 3A7AE5          13      LD  A,(_DBS24+1)
0017DB E554 B9               4      CP  C
0017DC E555 C0              11      RET NZ
                                
0017DD E556 E5              11      PUSH    HL
0017DE E557 3A88F0          13      LD  A,(_DRV)
0017E1 E55A 21A5F0          10      LD  HL,_DBDRV
0017E4 E55D AE               7      XOR (HL)
0017E5 E55E 2005            12      JR  NZ,POP_HL_RET
                                
0017E7 E560 2AA6F0          16      LD  HL,(_DBSEC)
0017EA E563 ED52            15      SBC HL,DE       ;CF=0
       E565                     POP_HL_RET:
0017EC E565 E1              10      POP HL
0017ED E566 C9              10      RET
                                
       E567                     DWTX:
0017EE E567 3AA4F0          13      LD  A,(_WTDBF)
0017F1 E56A B7               4      OR  A
0017F2 E56B C8              11      RET Z
0017F3 E56C AF               4      XOR A
0017F4 E56D 32A4F0          13      LD  (_WTDBF),A
                                
0017F7 E570 E5              11      PUSH    HL
0017F8 E571 C5              11      PUSH    BC
0017F9 E572 D5              11      PUSH    DE
0017FA E573 3AA5F0          13      LD  A,(_DBDRV)
0017FD E576 CDD9F0          17      CALL    _CHGDRV
001800 E579 0E00             7  _DBS24: LD  C,0
001802 E57B ED5BA6F0        20      LD  DE,(_DBSEC)
001806 E57F 2A7EF1          16      LD  HL,(_DTBUF)
001809 E582 D438E8          17      CALL    NC,DWT24
       E585                     POP_DE_BC_HL_RET2:
00180C E585 18A4            12      JR  POP_DE_BC_HL_RET
                                
       E587                     RDFATX:
00180E E587 E5              11      PUSH    HL
00180F E588 3A88F0          13      LD  A,(_DRV)
001812 E58B 21AAF0          10      LD  HL,_FATDRV
001815 E58E AE               7      XOR (HL)
001816 E58F 28D4            12      JR  Z,POP_HL_RET
                                
001818 E591 C5              11      PUSH    BC
001819 E592 D5              11      PUSH    DE
00181A E593 DDE5            15      PUSH    IX
00181C E595 CDB1E5          17      CALL    WTFATX
00181F E598 3813            12      JR  C,POP_IX_DE_BC_HL_RET
                                
001821 E59A AF               4      XOR A
001822 E59B 32ABF0          13      LD  (_FATIX),A
001825 E59E 3A88F0          13      LD  A,(_DRV)
001828 E5A1 32AAF0          13      LD  (_FATDRV),A
00182B E5A4 CDE5F0          17      CALL    _RDFAT
       E5A7                     RDFATE2:
00182E E5A7 3004            12      JR  NC,POP_IX_DE_BC_HL_RET
001830 E5A9 9F               4      SBC A,A     ;A=0xFF
001831 E5AA 32AAF0          13      LD  (_FATDRV),A
       E5AD                     POP_IX_DE_BC_HL_RET:
001834 E5AD DDE1            14      POP IX
001836 E5AF 18D4            12      JR  POP_DE_BC_HL_RET2
                                
       E5B1                     WTFATX:
001838 E5B1 3AA2F0          13      LD  A,(_WTFATF)
00183B E5B4 B7               4      OR  A
00183C E5B5 C8              11      RET Z
00183D E5B6 E5              11      PUSH    HL
00183E E5B7 3AAAF0          13      LD  A,(_FATDRV)
001841 E5BA 21A5F0          10      LD  HL,_DBDRV
001844 E5BD AE               7      XOR (HL)
001845 E5BE CC67E5          17      CALL    Z,DWTX
001848 E5C1 38A2            12      JR  C,POP_HL_RET
00184A E5C3 C5              11      PUSH    BC
00184B E5C4 D5              11      PUSH    DE
00184C E5C5 DDE5            15      PUSH    IX
00184E E5C7 CD45E8          17      CALL    WTFAT
001851 E5CA AF               4      XOR A
001852 E5CB 32A2F0          13      LD  (_WTFATF),A
001855 E5CE 18DD            12      JR  POP_IX_DE_BC_HL_RET
                                
       E5D0                     NCL1:
001857 E5D0 7A               4      LD  A,D
001858 E5D1 B3               4      OR  E
001859 E5D2 37               4      SCF
00185A E5D3 C8              11      RET Z
                                
00185B E5D4 7A               4      LD  A,D
00185C E5D5 CB3F             8      SRL A   ;/2
00185E E5D7 CB3F             8      SRL A   ;/2
                                
001860 E5D9 E5              11      PUSH    HL
001861 E5DA 32F9E5          13      LD  (NCLPAT+2),A    ;_FATIX
001864 E5DD 2AAAF0          16      LD  HL,(_FATDRV)    ;L=_FATDRV H=_FATIX
001867 E5E0 BC               4      CP  H
001868 E5E1 3A88F0          13      LD  A,(_DRV)    ;この間でフラグは変化しない
00186B E5E4 32F8E5          13      LD  (NCLPAT+1),A    ;_FATDRV
00186E E5E7 2005            12      JR  NZ,NCL2     ;FATIXが違う
001870 E5E9 BD               4      CP  L
001871 E5EA 2002            12      JR  NZ,NCL2     ;ドライブが違う
001873 E5EC E1              10      POP HL
001874 E5ED C9              10      RET
       E5EE                     NCL2:
001875 E5EE C5              11      PUSH    BC
001876 E5EF D5              11      PUSH    DE
001877 E5F0 DDE5            15      PUSH    IX
001879 E5F2 CDB1E5          17      CALL    WTFATX
00187C E5F5 38B6            12      JR  C,POP_IX_DE_BC_HL_RET
00187E E5F7 010000          10  NCLPAT: LD  BC,0        ;自己書き換え C=_FATDRV B=_FATIX
001881 E5FA ED43AAF0        20      LD  (_FATDRV),BC
001885 E5FE CD1AE8          17      CALL    RDFATS
001888 E601 18A4            12      JR  RDFATE2
                                
       E603                     NCL3:
00188A E603 CB9A             8      RES 3,D
00188C E605 CB92             8      RES 2,D
00188E E607 6B               4      LD  L,E
00188F E608 62               4      LD  H,D
001890 E609 CB3C             8      SRL H   ;
001892 E60B CB1D             8      RR  L   ;HLA=HLA/2
001894 E60D 1F               4      RRA     ;
001895 E60E F5              11      PUSH    AF
001896 E60F 3AABF0          13      LD  A,(_FATIX)
001899 E612 0F               4      RRCA
00189A E613 300B            12      JR  NC,NCL3X1
00189C E615 3A3DE4          13      LD  A,(SECSZ+2)
00189F E618 FE04             7      CP  4       ;1セクタ1024バイトの場合は奇数インデックスの場合に先頭を512バイトずらす
0018A1 E61A 2004            12      JR  NZ,NCL3X1
0018A3 E61C 010002          10      LD  BC,512
0018A6 E61F 09              11      ADD HL,BC
       E620                     NCL3X1:
0018A7 E620 F1              10      POP AF
0018A8 E621 ED4B7CF1        20      LD  BC,(_FATBF)
0018AC E625 19              11      ADD HL,DE
0018AD E626 09              11      ADD HL,BC
0018AE E627 17               4      RLA
0018AF E628 C9              10      RET
                                
       E629                     GNCL:
0018B0 E629 CDD0E5          17      CALL    NCL1        ;GET NEXT CLUSTER
0018B3 E62C D8              11      RET C
0018B4 E62D C5              11      PUSH    BC
0018B5 E62E E5              11      PUSH    HL
0018B6 E62F CD03E6          17      CALL    NCL3
0018B9 E632 3809            12      JR  C,GNC1
0018BB E634 5E               7      LD  E,(HL)
0018BC E635 23               6      INC HL
0018BD E636 7E               7      LD  A,(HL)
0018BE E637 E60F             7      AND 00FH
0018C0 E639 57               4      LD  D,A
0018C1 E63A E1              10      POP HL
0018C2 E63B C1              10      POP BC
0018C3 E63C C9              10      RET
       E63D                     GNC1:
0018C4 E63D 7E               7      LD  A,(HL)
0018C5 E63E 23               6      INC HL
0018C6 E63F 56               7      LD  D,(HL)
0018C7 E640 0604             7      LD  B,4
       E642                     GNC1L:
0018C9 E642 CB3A             8      SRL D   ;DA=DA/2
0018CB E644 1F               4      RRA     ;
0018CC E645 10FB            13      DJNZ    GNC1L
                                
0018CE E647 5F               4      LD  E,A
0018CF E648 E1              10      POP HL
0018D0 E649 C1              10      POP BC
0018D1 E64A A7               4      AND A
0018D2 E64B C9              10      RET
                                
       E64C                     SNCL:
0018D3 E64C CDD0E5          17      CALL    NCL1
0018D6 E64F D8              11      RET C
                                ;               SET NEXT CLUSTER
0018D7 E650 E5              11      PUSH    HL
0018D8 E651 C5              11      PUSH    BC
0018D9 E652 D5              11      PUSH    DE
0018DA E653 E5              11      PUSH    HL
0018DB E654 CD03E6          17      CALL    NCL3
0018DE E657 D1              10      POP DE
                                ;CF=ODD
0018DF E658 7E               7      LD  A,(HL)
0018E0 E659 73               7      LD  (HL),E
0018E1 E65A 3806            12      JR  C,SNC1
                                ;EVEN
                                ;M[0] = E
                                ;M[1] = (M[1] & 0xF0) | (D & 0x0F)
0018E3 E65C 23               6      INC HL
0018E4 E65D ED67            18      RRD     ;M={A[3:0],E[3:0]}
0018E6 E65F 7A               4      LD  A,D
0018E7 E660 1804            12      JR  SNC11
       E662                     SNC1:
                                ;ODD
                                ;HL[0] = (HL[0]&0x0F) | (E<<4)
                                ;HL[1] = DE>>4
0018E9 E662 ED6F            18      RLD     ;M={D[3:0],E[7:4]}
0018EB E664 23               6      INC HL
0018EC E665 72               7      LD  (HL),D  ;M={D[3:0],E[7:4]}
       E666                     SNC11:
0018ED E666 ED6F            18      RLD     ;M={M[7:4],D[3:0]}
0018EF E668 B7               4      OR  A
0018F0 E669 D1              10      POP DE
0018F1 E66A C1              10      POP BC
0018F2 E66B E1              10      POP HL
       E66C                     FAT_CHANGED:
0018F3 E66C 3E01             7      LD  A,1
0018F5 E66E 32A2F0          13      LD  (_WTFATF),A
0018F8 E671 C9              10      RET
                                
       E672                     N16CL3:
0018F9 E672 C5              11      PUSH    BC
0018FA E673 6B               4      LD  L,E
0018FB E674 7A               4      LD  A,D
0018FC E675 E603             7      AND 3
0018FE E677 67               4      LD  H,A
0018FF E678 29              11      ADD HL,HL
001900 E679 ED4B7CF1        20      LD  BC,(_FATBF)
001904 E67D 09              11      ADD HL,BC
001905 E67E C1              10      POP BC
001906 E67F C9              10      RET
                                
       E680                     GNCL16:
001907 E680 CDD0E5          17      CALL    NCL1        ;GET NEXT CLUSTER for FAT16
00190A E683 D8              11      RET C
00190B E684 E5              11      PUSH    HL
00190C E685 CD72E6          17      CALL    N16CL3
00190F E688 5E               7      LD  E,(HL)
001910 E689 23               6      INC HL
001911 E68A 56               7      LD  D,(HL)
001912 E68B E1              10      POP HL
001913 E68C C9              10      RET
                                
       E68D                     SNCL16:
001914 E68D CDD0E5          17      CALL    NCL1        ;GET NEXT CLUSTER for FAT16
001917 E690 D8              11      RET C
001918 E691 D5              11      PUSH    DE
001919 E692 E5              11      PUSH    HL
00191A E693 CD72E6          17      CALL    N16CL3
00191D E696 D1              10      POP DE      ;HL
00191E E697 73               7      LD  (HL),E
00191F E698 23               6      INC HL
001920 E699 72               7      LD  (HL),D
001921 E69A 6B               4      LD  L,E
001922 E69B 62               4      LD  H,D
001923 E69C D1              10      POP DE
001924 E69D 18CD            12      JR  FAT_CHANGED
                                
                                ;------------------------
                                ;次のセクタを探す際に_SECPSの値をチェック
                                ;in
                                ;   DE : セクタ番号
                                ;out
                                ;   DE : 次のセクタ番号
                                ;note
                                ;
                                ;------------------------
       E69F                     NEXTX:
001926 E69F 3E00             7  _SECPS: LD  A,0 ;自己書き換え
001928 E6A1 3C               4      INC A
001929 E6A2 E600             7  NCPAT:  AND 0   ;自己書き換え　1クラスタの論理セクタ数-1
00192B E6A4 32A0E6          13      LD  (_SECPS+1),A
00192E E6A7 C9              10      RET
                                
       E6A8                     GNCLX:
00192F E6A8 CD9FE6          17      CALL    NEXTX
001932 E6AB C0              11      RET NZ  ;1クラスタのセクタ未満の場合は戻る
001933 E6AC C3F7F0          10      JP  _GNCL   ;次のクラスタを探す
                                
       E6AF                     RDFAT:
001936 E6AF 3E80             7      LD  A,080H
001938 E6B1 3270F0          13      LD  (CHECK),A
       E6B4                     RDFAT1:
00193B E6B4 3A88F0          13      LD  A,(_DRV)
00193E E6B7 CD6FE9          17      CALL    CHGDRVR
001941 E6BA D8              11      RET C
001942 E6BB DD7E12          19      LD  A,(IX+DPB_DEVICE)
001945 E6BE CB6F             8      BIT 5,A
001947 E6C0 286B            12      JR  Z,RDFAT0X
001949 E6C2 2170F0          10      LD  HL,CHECK
00194C E6C5 A6               7      AND (HL)
00194D E6C6 77               7      LD  (HL),A
00194E E6C7 110000          10      LD  DE,0        ;BPB
001951 E6CA 2A7CF1          16      LD  HL,(_FATBF)
001954 E6CD CD26E8          17      CALL    DRD16
001957 E6D0 3024            12      JR  NC,GETBPB
001959 E6D2 2170F0          10      LD  HL,CHECK
00195C E6D5 CB06            15      RLC (HL)
00195E E6D7 3F               4      CCF
00195F E6D8 D8              11      RET C
001960 E6D9 DDCB0A1E        23      RR  (IX+DPB_FDMODE)
001964 E6DD 3F               4      CCF         ;フロッピーディスクのFDモードを切り替える
001965 E6DE DDCB0A16        23      RL  (IX+DPB_FDMODE)
001969 E6E2 3EFF             7      LD  A,0FFH
00196B E6E4 3289F0          13      LD  (_DSK),A
00196E E6E7 3A84F0          13      LD  A,(_DRIVE)
001971 E6EA E603             7      AND 3
001973 E6EC F680             7      OR  080H
001975 E6EE 6F               4      LD  L,A
001976 E6EF 26F0             7      LD  H,_CYL0/256
001978 E6F1 3EFF             7      LD  A,0FFH
00197A E6F3 77               7      LD  (HL),A
00197B E6F4 18BE            12      JR  RDFAT1
       E6F6                     GETBPB:
00197D E6F6 FDE5            15      PUSH    IY
00197F E6F8 FD2A7CF1        20      LD  IY,(_FATBF) ;BPB
001983 E6FC CDF1F0          17      CALL    _BPB2DPB
001986 E6FF FDE1            14      POP IY
001988 E701 DD7E12          19      LD  A,(IX+DPB_DEVICE)
00198B E704 3021            12      JR  NC,GETBPBOK
00198D E706 E60F             7      AND 00FH
00198F E708 FE07             7      CP  7
001991 E70A 37               4      SCF
001992 E70B C0              11      RET NZ
001993 E70C DDCB0A46        20      BIT 0,(IX+DPB_FDMODE)
001997 E710 21C0F1          10      LD  HL,M2D
00199A E713 2002            12      JR  NZ,SETFDMODE
00199C E715 2ED2             7      LD  L,M2HD-STABLE
       E717                     SETFDMODE:
00199E E717 DDE5            15      PUSH    IX
0019A0 E719 D1              10      POP DE
0019A1 E71A EDA0            16      LDI
0019A3 E71C EDA0            16      LDI
0019A5 E71E 13               6      INC DE
0019A6 E71F 13               6      INC DE
0019A7 E720 13               6      INC DE
0019A8 E721 13               6      INC DE
0019A9 E722 010C00          10      LD  BC,12
0019AC E725 EDB0                    LDIR
       E727                     GETBPBOK:
0019AE E727 3236E7          13      LD  (DEVSWC),A
0019B1 E72A CDCEE8          17      CALL    CHGDRV2
       E72D                     RDFAT0X:
0019B4 E72D CD1AE8          17      CALL    RDFATS
0019B7 E730 D8              11      RET C
0019B8 E731 DDAE06          19      XOR (IX+DPB_FATID)
0019BB E734 C8              11      RET Z
0019BC E735 3E00             7      LD  A,0     ;DPB_DEVICE
       E736                     DEVSWC  EQU $-1
0019BE E737 CB6F             8      BIT 5,A
0019C0 E739 C0              11      RET NZ      ;BPBを取得している場合はFATIDをチェックしない
0019C1 E73A 37               4      SCF
0019C2 E73B C9              10      RET
                                
       E73C                     BPB2DPB:
0019C3 E73C FD7E0B          19      LD  A,(IY+11)   ;BPB_BytsPerSec
0019C6 E73F B7               4      OR  A
0019C7 E740 37               4      SCF
0019C8 E741 C0              11      RET NZ
       E742                     BPBOK:
0019C9 E742 FD7E0D          19      LD  A,(IY+13)   ;BPB_SecPerClus
0019CC E745 DD7707          19      LD  (IX+DPB_SECPCL),A
                                
0019CF E748 FD7E16          19      LD  A,(IY+22)   ;BPB_FATSz16
0019D2 E74B DD7700          19      LD  (IX+DPB_FATLN),A
0019D5 E74E FD7E17          19      LD  A,(IY+23)   ;BPB_FATSz16
0019D8 E751 DD7701          19      LD  (IX+DPB_FATLN+1),A
                                
0019DB E754 FD6E0E          19      LD  L,(IY+14)   ;BPB_RsvdSecCnt
0019DE E757 FD660F          19      LD  H,(IY+15)
0019E1 E75A DD750E          19      LD  (IX+DPB_FATPS),L
0019E4 E75D FD5E16          19      LD  E,(IY+22)   ;BPB_FATSz16
0019E7 E760 FD5617          19      LD  D,(IY+23)
0019EA E763 FD4610          19      LD  B,(IY+16)   ;BPB_NumFATs
       E766                     BPBDP1:             ;BPB_FATSz16 * BPB_NumFATs
0019ED E766 19              11      ADD HL,DE
0019EE E767 10FD            13      DJNZ    BPBDP1
       E769                     BPBDP2:
0019F0 E769 DD7510          19      LD  (IX+DPB_DIRPS),L
0019F3 E76C DD7411          19      LD  (IX+DPB_DIRPS+1),H
0019F6 E76F E5              11      PUSH    HL
                                
0019F7 E770 FD6E11          19      LD  L,(IY+17)   ;BPB_RootEntCnt
0019FA E773 FD6612          19      LD  H,(IY+18)
0019FD E776 FD7E0C          19      LD  A,(IY+12)   ;BPB_BytsPerSec
001A00 E779 B7               4      OR  A
001A01 E77A 37               4      SCF
001A02 E77B C8              11      RET Z
001A03 E77C 0606             7      LD  B,6
       E77E                     BPBBPS1:
001A05 E77E 05               4      DEC B
001A06 E77F 0F               4      RRCA
001A07 E780 30FC            12      JR  NC,BPBBPS1
       E782                     BPBDE1:
001A09 E782 29              11      ADD HL,HL
001A0A E783 10FD            13      DJNZ    BPBDE1
                                
001A0C E785 7C               4      LD  A,H
001A0D E786 DD770B          19      LD  (IX+DPB_DIRSCNT),A  ;
                                
001A10 E789 D1              10      POP DE      ;DPB_DIRPS
001A11 E78A 6C               4      LD  L,H
001A12 E78B 2600             7      LD  H,0
001A14 E78D 19              11      ADD HL,DE       ;MAXDIR
001A15 E78E E5              11      PUSH    HL
001A16 E78F FD4E0D          19      LD  C,(IY+13)   ;BPB_SecPerClus
001A19 E792 CB21             8      SLA C       ;*2
001A1B E794 AF               4      XOR A
001A1C E795 47               4      LD  B,A
001A1D E796 ED42            15      SBC HL,BC
001A1F E798 DD7514          19      LD  (IX+DPB_ADDCL),L
001A22 E79B DD7415          19      LD  (IX+DPB_ADDCL+1),H
                                
001A25 E79E D1              10      POP DE      ;DE=DPB_MAXDIR
001A26 E79F FD6E13          19      LD  L,(IY+19)   ;BPB_TotSec16
001A29 E7A2 FD6614          19      LD  H,(IY+20)
                                
001A2C E7A5 DD7E12          19      LD  A,(IX+DPB_DEVICE)
001A2F E7A8 E60F             7      AND 00FH
001A31 E7AA FE07             7      CP  7       ;フロッピー
001A33 E7AC 2019            12      JR  NZ,NOT_FD
001A35 E7AE E5              11      PUSH    HL
001A36 E7AF FD4E18          19      LD  C,(IY+24)   ;BPB_SecPerTr
001A39 E7B2 DD710D          19      LD  (IX+DPB_MAXSEC),C
001A3C E7B5 AF               4      XOR A
001A3D E7B6 CB21             8      SLA C       ;両面なのでセクタ数を２倍
001A3F E7B8 0610             7      LD  B,16
       E7BA                     DIVSEC:             ;MAXCYL = BPB_TotSec16 / (BPB_SecPerTr * 2)
001A41 E7BA 29              11      ADD HL,HL
001A42 E7BB 17               4      RLA
001A43 E7BC B9               4      CP  C
001A44 E7BD 3802            12      JR  C,DIVSEC1
001A46 E7BF 91               4      SUB C
001A47 E7C0 2C               4      INC L
       E7C1                     DIVSEC1:
001A48 E7C1 10F7            13      DJNZ    DIVSEC
001A4A E7C3 DD750C          19      LD  (IX+DPB_MAXCYL),L
001A4D E7C6 E1              10      POP HL  ;ここまでフロッピー専用
       E7C7                     NOT_FD:
001A4E E7C7 7C               4      LD  A,H
001A4F E7C8 B5               4      OR  L
001A50 E7C9 3E00             7      LD  A,0     ;LDでフラグは変化しない。BPB_TotSec16を AHL で扱う為、Aに0を入れる
001A52 E7CB 2010            12      JR  NZ,BPB16BIT ;BPB_TotSec16が「0」の場合はBPB_TotSec32で計算
001A54 E7CD FD7E23          19      LD  A,(IY+35)   ;念のために総セクタ数が24ビットを超える場合はエラーを返す
001A57 E7D0 B7               4      OR  A
001A58 E7D1 37               4      SCF
001A59 E7D2 C0              11      RET NZ
001A5A E7D3 FD6E20          19      LD  L,(IY+32)   ;BPB_TotSec32 は AHL の24ビットで扱う
001A5D E7D6 FD6621          19      LD  H,(IY+33)   ;1クラスタの論理セクタ数(DPB_SECPCL)が最大128なので
001A60 E7D9 FD7E22          19      LD  A,(IY+34)   ;24ビットを超えると必ずクラスタ数が16ビットを超えてしまうのでこれで十分
001A63 E7DC A7               4      AND A       ;CF=0
       E7DD                     BPB16BIT:
001A64 E7DD ED52            15      SBC HL,DE
001A66 E7DF DE00             7      SBC A,0
001A68 E7E1 FD460D          19      LD  B,(IY+13)   ;BPB_SecPerClus
       E7E4                     BPBTC1:             ;総クラスタ数(AHL) = 総セクタ数(AHL) / セクタサイズ(B)
001A6B E7E4 CB18             8      RR  B       ;->CY
001A6D E7E6 3808            12      JR  C,BPBTC2
001A6F E7E8 CB3F             8      SRL A
001A71 E7EA CB1C             8      RR  H       ;AHL=AHL/2
001A73 E7EC CB1D             8      RR  L
001A75 E7EE 18F4            12      JR  BPBTC1
       E7F0                     BPBTC2:
001A77 E7F0 B7               4      OR  A
001A78 E7F1 37               4      SCF
001A79 E7F2 C0              11      RET NZ      ;念のため(クラスタ数が16ビットを超える場合)
001A7A E7F3 23               6      INC HL
001A7B E7F4 23               6      INC HL
001A7C E7F5 DD7508          19      LD  (IX+DPB_MAXCL),L
001A7F E7F8 DD7409          19      LD  (IX+DPB_MAXCL+1),H
                                
001A82 E7FB FD7E15          19      LD  A,(IY+21)   ;BPB_Media
001A85 E7FE DD7706          19      LD  (IX+DPB_FATID),A
                                
001A88 E801 FD7E10          19      LD  A,(IY+16)   ;BPB_NumFATs
001A8B E804 C6FE             7      ADD A,0-2       ;>2:CF=1
001A8D E806 FD7E0C          19      LD  A,(IY+12)   ;BPB_BytsPerSec
001A90 E809 6F               4      LD  L,A
001A91 E80A 3002            12      JR  NC,BPBFAT1
001A93 E80C F680             7      OR  080H
       E80E                     BPBFAT1:            ;ここではCF=0
001A95 E80E DD770F          19      LD  (IX+DPB_BPS),A
001A98 E811 2D               4      DEC L       ;以下のセクタサイズに合致しない場合はCF=1でエラーにする
001A99 E812 C8              11      RET Z       ;1セクタ256バイト
001A9A E813 2D               4      DEC L
001A9B E814 C8              11      RET Z       ;1セクタ512バイト
001A9C E815 2D               4      DEC L
001A9D E816 2D               4      DEC L
001A9E E817 C8              11      RET Z       ;1セクタ1024バイト
001A9F E818 37               4      SCF
001AA0 E819 C9              10      RET
                                
       E81A                     RDFATS:
001AA1 E81A CD60E8          17      CALL    FATSETUP
001AA4 E81D D8              11      RET C
001AA5 E81E CD2AE8          17      CALL    DRD24B
001AA8 E821 2A7CF1          16      LD  HL,(_FATBF)
001AAB E824 7E               7      LD  A,(HL)
001AAC E825 C9              10      RET
                                
       E826                     DRD16:
001AAD E826 0E00             7      LD  C,0
       E828                     DRD24:
001AAF E828 0601             7      LD  B,1
       E82A                     DRD24B:
001AB1 E82A DDE5            15      PUSH    IX
001AB3 E82C DD2AA8F0        20      LD  IX,(_DPB)
001AB7 E830 CDB9EA          17  DRDPAT: CALL    FDRD        ;自己書き換え（ディスク読み込み）
       E833                     POP_IX_RET:
001ABA E833 DDE1            14      POP IX
001ABC E835 C9              10      RET
                                
       E836                     DWT16:
001ABD E836 0E00             7      LD  C,0
       E838                     DWT24:
001ABF E838 0601             7      LD  B,1
       E83A                     DWT24B:
001AC1 E83A DDE5            15      PUSH    IX
001AC3 E83C DD2AA8F0        20      LD  IX,(_DPB)
001AC7 E840 CD5FEA          17  DWTPAT: CALL    FDWT        ;自己書き換え（ディスク書き込み）
001ACA E843 18EE            12      JR  POP_IX_RET
                                
       E845                     WTFAT:
001ACC E845 CD60E8          17      CALL    FATSETUP
001ACF E848 D43AE8          17      CALL    NC,DWT24B
001AD2 E84B D8              11      RET C
001AD3 E84C DDCB0F7E        20      BIT 7,(IX+DPB_BPS)
001AD7 E850 C8              11      RET Z       ;予備FATが無い
001AD8 E851 CD67E8          17      CALL    FATS2
001ADB E854 E5              11      PUSH    HL      ;予備FAT
001ADC E855 DD6E00          19      LD  L,(IX+DPB_FATLN)
001ADF E858 DD6601          19      LD  H,(IX+DPB_FATLN+1)
001AE2 E85B 19              11      ADD HL,DE
001AE3 E85C EB               4      EX  DE,HL
001AE4 E85D E1              10      POP HL
001AE5 E85E 18DA            12      JR  DWT24B
                                ;------------------------
                                ;FATのセットアップ
                                ;out
                                ;   B  : FATセクタ数
                                ;   DE : FAT先頭セクタ番号
                                ;   HL : FATバッファポインタ
                                ;   CF : 1=ドライブ切り替えエラー
                                ;note
                                ;   FATサイズがFATバッファを超える場合は
                                ;   対象クラスタ領域==(_FATIX)によって
                                ;   FAT12:対象クラスタ1024毎に1.5KBを切り替える
                                ;   FAT16:対象クラスタ1024毎に2KBを切り替える
                                ;------------------------
       E860                     FATSETUP:
001AE7 E860 3AAAF0          13      LD  A,(_FATDRV)
001AEA E863 CD6FE9          17      CALL    CHGDRVR     ;ドライブ切り替え
001AED E866 D8              11      RET C
       E867                     FATS2:
001AEE E867 DD7E0F          19      LD  A,(IX+DPB_BPS)  ;512=2 1024=4
001AF1 E86A 0F               4      RRCA
001AF2 E86B CD94E8          17  FATSX:  CALL    FATSETUP12  ;自己書き換え
001AF5 E86E 210000          10      LD  HL,0
001AF8 E871 4A               4      LD  C,D
001AF9 E872 54               4      LD  D,H
001AFA E873 3AABF0          13      LD  A,(_FATIX)  ;範囲FAT12:0-3/FAT16:0-63(0-03FH):65535*2/2048
001AFD E876 47               4      LD  B,A
001AFE E877 04               4      INC B
001AFF E878 DD7E00          19      LD  A,(IX+DPB_FATLN)
       E87B                     FAT_SKP:
001B02 E87B 05               4      DEC B
001B03 E87C 2805            12      JR  Z,FAT1
001B05 E87E 19              11      ADD HL,DE
001B06 E87F 93               4      SUB E
001B07 E880 30F9            12      JR  NC,FAT_SKP
001B09 E882 C9              10      RET
       E883                     FAT1:
001B0A E883 EB               4      EX  DE,HL
001B0B E884 B9               4      CP  C       ;C=FATバッファに読み込めるセクタ数
001B0C E885 3801            12      JR  C,FAT2
001B0E E887 79               4      LD  A,C
       E888                     FAT2:
001B0F E888 47               4      LD  B,A
                                
001B10 E889 2AFAF1          16      LD  HL,(_FATPS) ;fat sector pos
001B13 E88C 19              11      ADD HL,DE
001B14 E88D EB               4      EX  DE,HL
001B15 E88E 2A7CF1          16      LD  HL,(_FATBF)
001B18 E891 AF               4      XOR A       ;CF=0
001B19 E892 4F               4      LD  C,A
001B1A E893 C9              10      RET
                                ;
                                ;   FATバッファに読み込める最大のセクタ数と_FATIXで進めるセクタ数
                                ;   FATSETUP* (FAT12/FAT16)
                                ;out
                                ;   D : FATバッファに読み込める最大のセクタ数
                                ;   E : _FATIXで進めるセクタ数
       E894                     FATSETUP12:
001B1B E894 110606          10      LD  DE,0606H    ;256
001B1E E897 D8              11      RET C
001B1F E898 110303          10      LD  DE,0303H    ;512
001B22 E89B 0F               4      RRCA
001B23 E89C D8              11      RET C
001B24 E89D 110102          10      LD  DE,0201H    ;1024
001B27 E8A0 C9              10      RET
                                
       E8A1                     FATSETUP16:
001B28 E8A1 110808          10      LD  DE,0808H    ;256
001B2B E8A4 D8              11      RET C
001B2C E8A5 110404          10      LD  DE,0404H
001B2F E8A8 0F               4      RRCA            ;512
001B30 E8A9 D8              11      RET C
001B31 E8AA 110202          10      LD  DE,0202H    ;1024
001B34 E8AD C9              10      RET
                                
       E8AE                     CHGDRV:
001B35 E8AE E5              11      PUSH    HL
001B36 E8AF 2189F0          10      LD  HL,_DSK
001B39 E8B2 BE               7      CP  (HL)
001B3A E8B3 280A            12      JR  Z,CHGDRVE
       E8B5                     CHGDRV1:
001B3C E8B5 DDE5            15      PUSH    IX
001B3E E8B7 CDC1E8          17      CALL    CHGDRV0
001B41 E8BA 3A89F0          13      LD  A,(_DSK)
001B44 E8BD DDE1            14      POP IX
       E8BF                     CHGDRVE:
001B46 E8BF E1              10      POP HL
001B47 E8C0 C9              10      RET
                                
       E8C1                     CHGDRV0:
001B48 E8C1 6F               4      LD  L,A
001B49 E8C2 CDDCF0          17      CALL    _GETDPB
001B4C E8C5 D8              11      RET C
001B4D E8C6 DD22A8F0        20      LD  (_DPB),IX
001B51 E8CA 7D               4      LD  A,L
001B52 E8CB 3289F0          13      LD  (_DSK),A
       E8CE                     CHGDRV2:
001B55 E8CE C5              11      PUSH    BC
001B56 E8CF D5              11      PUSH    DE
001B57 E8D0 ED7325E9        20      LD  (SPPAT2+1),SP
001B5B E8D4 F3               4      DI
001B5C E8D5 DDF9            10      LD  SP,IX
                                
001B5E E8D7 E1              10      POP HL      ;00:DPB_FATLN
001B5F E8D8 E1              10      POP HL      ;02:DPB_DRD
001B60 E8D9 2231E8          16      LD  (DRDPAT+1),HL
                                
001B63 E8DC E1              10      POP HL
001B64 E8DD 2241E8          16      LD  (DWTPAT+1),HL   ;04:DPB_DWT
                                
001B67 E8E0 E1              10      POP HL      ;L=06:DPB_FATID H=07:DPB_SECPCL
001B68 E8E1 7C               4      LD  A,H
001B69 E8E2 322DDF          13      LD  (SPCPAT+1),A    ;1クラスタの論理セクタ数
001B6C E8E5 3D               4      DEC A
001B6D E8E6 32A3E6          13      LD  (NCPAT+1),A
                                
001B70 E8E9 E1              10      POP HL      ;08:DPB_MAXCL
001B71 E8EA 7D               4      LD  A,L
001B72 E8EB 324CDF          13      LD  (CLPAT2+1),A
001B75 E8EE 7C               4      LD  A,H
001B76 E8EF 3248DF          13      LD  (CLPAT1+1),A
001B79 E8F2 2B               6      DEC HL
001B7A E8F3 2254E1          16      LD  (MAXCLP+1),HL
                                
001B7D E8F6 E1              10      POP HL      ;L=0A:DPB_FDMODE H=0B:DPB_DIRSCNT
001B7E E8F7 7D               4      LD  A,L
001B7F E8F8 F6FE             7      OR  0FEH
001B81 E8FA 32B3F0          13      LD  (FDMODE+1),A
001B84 E8FD 07               4      RLCA
001B85 E8FE E603             7      AND 3
001B87 E900 32FCE9          13      LD  (FSPAT+1),A
001B8A E903 4C               4      LD  C,H
                                
001B8B E904 E1              10      POP HL      ;L=0C:DPB_MAXCYL H=0D:DPB_MAXSEC
                                
001B8C E905 E1              10      POP HL      ;L=0E:DPB_FATPS H=0F:DPB_BPS
001B8D E906 7C               4      LD  A,H     ;DPB_BPS
001B8E E907 E607             7      AND 7
001B90 E909 323DE4          13      LD  (SECSZ+2),A ;1セクタのサイズの上位1バイト 0x400 - 0x200 - 0x100
                                                ;1セクタ512 2D/2DD/2HC/2HQ(2HD1.44MB)/EMM/BRAM/EMEM等
                                                ;1セクタ1024 2HD/2HDE98
                                                ;1セクタ256 GRAM/RAMF/CMOS/等
                                                ;1024   512 256
                                                ;4  2   1
001B93 E90C 87               4      ADD A,A     ;8  4   2
001B94 E90D 87               4      ADD A,A     ;010H   8   4
001B95 E90E 87               4      ADD A,A     ;020H   010H    8
001B96 E90F 32A9DD          13      LD  (SDECPAT+1),A   ;1セクタ辺りのディレクトリエントリ数
                                
001B99 E912 2600             7      LD  H,0
001B9B E914 22FAF1          16      LD  (_FATPS),HL
                                
001B9E E917 E1              10      POP HL      ;10:DPB_DIRPS
001B9F E918 22FCF1          16      LD  (_DIRPS),HL
                                
001BA2 E91B E1              10      POP HL      ;L=12:DPB_DEVICE H=13:DPB_UNITNO
001BA3 E91C 7C               4      LD  A,H
001BA4 E91D 3284F0          13      LD  (_DRIVE),A
                                
001BA7 E920 E1              10      POP HL      ;14:DPB_ADDCL
001BA8 E921 223DDF          16      LD  (CLSPAT+1),HL
                                
001BAB E924 310000          10  SPPAT2: LD  SP,0        ;元のSPを復元
001BAE E927 FB               4      EI
001BAF E928 2AFCF1          16      LD  HL,(_DIRPS)
001BB2 E92B 0600             7      LD  B,0
001BB4 E92D 09              11      ADD HL,BC       ;C=DPB_DIRSCNT
001BB5 E92E 22C4DD          16      LD  (MD_PAT+1),HL
                                
001BB8 E931 2A54E1          16      LD  HL,(MAXCLP+1);
001BBB E934 11F60F          10      LD  DE,4086     ;クラスタ数が4086未満:FAT12 4086以上:FAT16
001BBE E937 ED52            15      SBC HL,DE       ;CF=0のはず
001BC0 E939 300F            12      JR  NC,SETFAT16
001BC2 E93B 2129E6          10      LD  HL,GNCL     ;FAT12
001BC5 E93E 114CE6          10      LD  DE,SNCL
001BC8 E941 0194E8          10      LD  BC,FATSETUP12
001BCB E944 DDCB0FAE        23      RES 5,(IX+DPB_BPS)  ;DPB_BPS(FAT12)
001BCF E948 180D            12      JR  EXTRA1
       E94A                     SETFAT16:
001BD1 E94A 2180E6          10      LD  HL,GNCL16   ;FAT16
001BD4 E94D 118DE6          10      LD  DE,SNCL16
001BD7 E950 01A1E8          10      LD  BC,FATSETUP16
001BDA E953 DDCB0FEE        23      SET 5,(IX+DPB_BPS)  ;DPB_BPS(FAT16)
       E957                     EXTRA1:
001BDE E957 22F8F0          16      LD  (GNCPAT+1),HL
001BE1 E95A ED53FBF0        20      LD  (SNCPAT+1),DE
001BE5 E95E ED436CE8        20      LD  (FATSX+1),BC
001BE9 E962 D1              10      POP DE
001BEA E963 C1              10      POP BC
001BEB E964 AF               4      XOR A
001BEC E965 C9              10      RET
                                
       E966                     GETDPBD:
001BED E966 DDE3            23      EX  (SP),IX
001BEF E968 DDE5            15      PUSH    IX
001BF1 E96A 3A88F0          13      LD  A,(_DRV)
001BF4 E96D 1807            12      JR  GETDPB1
                                
       E96F                     CHGDRVR:
001BF6 E96F CDD9F0          17      CALL    _CHGDRV
001BF9 E972 D8              11      RET C
001BFA E973 3A89F0          13      LD  A,(_DSK)
       E976                     GETDPB1:
001BFD E976 C3DCF0          10      JP  _GETDPB
                                
       E979                     GETDPB:
001C00 E979 FE08             7      CP  8
001C02 E97B 3F               4      CCF
001C03 E97C D8              11      RET C
001C04 E97D 0F               4      RRCA
001C05 E97E 0F               4      RRCA
001C06 E97F 0F               4      RRCA
001C07 E980 DD                      DB  0DDH        ;Z80未定義命令
001C08 E981 6F               4      LD  L,A     ;LD IXL,A
001C09 E982 DD                      DB  0DDH        ;Z80未定義命令
001C0A E983 26F2             7      LD  H,_DEVICE/256   ;LD IXH,_DEVICE/256
001C0C E985 DD7E00          19      LD  A,(IX+DPB_FATLN)
001C0F E988 A7               4      AND A       ;CF=0の為
001C10 E989 DDCB0F6E        20      BIT 5,(IX+DPB_BPS)
001C14 E98D C0              11      RET NZ      ;FAT16
001C15 E98E DDCB126E        20      BIT 5,(IX+DPB_DEVICE)
001C19 E992 C0              11      RET NZ      ;BPB
001C1A E993 FE01             7      CP  001H        ;A=0 THEN CF=1
001C1C E995 C9              10      RET
                                
       E996                     _SYS5F:
001C1D E996 AF               4      XOR A
       E997                     FFLUSH:
001C1E E997 F5              11      PUSH    AF
001C1F E998 CDB1E5          17      CALL    WTFATX
001C22 E99B AF               4      XOR A
001C23 E99C 32ABF0          13      LD  (_FATIX),A
001C26 E99F 2F               4      CPL         ;0FFH
001C27 E9A0 32AAF0          13      LD  (_FATDRV),A
001C2A E9A3 3E                      DB  03EH        ;次のPUSH AFをスキップ
       E9A4                     FFLUSHBUF:
001C2B E9A4 F5              11      PUSH    AF
001C2C E9A5 CD67E5          17      CALL    DWTX
001C2F E9A8 3EFF             7      LD  A,0FFH
001C31 E9AA 3239F0          13      LD  (SFILE),A
001C34 E9AD 32A5F0          13      LD  (_DBDRV),A
001C37 E9B0 F1              10      POP AF
001C38 E9B1 C9              10      RET
                                
[EOF:LDDIO.ASM:SHIFT_JIS]
                                    INCLUDE "M7DISK.ASM"
                                
                                ;   LSX-Dodgers DISK
                                ;   MZ-700/1500
                                
       E9B2                     SEEK:
001C39 E9B2 0610             7      LD  B,16
001C3B E9B4 DD4E0D          19      LD  C,(IX+DPB_MAXSEC)
001C3E E9B7 AF               4      XOR A
001C3F E9B8 EB               4      EX  DE,HL
       E9B9                     DIV1:
001C40 E9B9 29              11      ADD HL,HL
001C41 E9BA 8F               4      ADC A,A
001C42 E9BB B9               4      CP  C
001C43 E9BC 3802            12      JR  C,DIV2
001C45 E9BE 91               4      SUB C
001C46 E9BF 2C               4      INC L
       E9C0                     DIV2:
001C47 E9C0 10F7            13      DJNZ    DIV1
                                
001C49 E9C2 3C               4      INC A   ;最小のセクタは１固定
001C4A E9C3 55               4      LD  D,L ;TRACK
001C4B E9C4 5F               4      LD  E,A ;SECTOR
                                
001C4C E9C5 3A84F0          13      LD  A,(_DRIVE)
001C4F E9C8 FE04             7      CP  4
001C51 E9CA 3F               4      CCF
001C52 E9CB D8              11      RET C
001C53 E9CC F684             7      OR  084H        ;Motor on + ドライブセレクト有効
001C55 E9CE D3DC            11      OUT (0DCH),A
001C57 E9D0 CB3A             8      SRL D       ;CYLINDER
001C59 E9D2 9F               4      SBC A,A
001C5A E9D3 D3DD            11      OUT (0DDH),A    ;SIDE
                                
001C5C E9D5 CD12EA          17      CALL    SETMODE
001C5F E9D8 D8              11      RET C
                                
001C60 E9D9 CD49EA          17      CALL    DRIVE
001C63 E9DC FEFF             7      CP  0FFH        ;A=0FFH Unknown CYLINDER
001C65 E9DE CC2EEA          17      CALL    Z,FDCRES    ;Restore
001C68 E9E1 2F               4      CPL         ;データバスが負論理
001C69 E9E2 D3D9            11      OUT (0D9H),A    ;Currrent CYLINDER
001C6B E9E4 2F               4      CPL         ;データバスが負論理
001C6C E9E5 92               4      SUB D
001C6D E9E6 C8              11      RET Z       ;No seek
                                
001C6E E9E7 3A86F0          13      LD  A,(_ISEEK)
001C71 E9EA 4F               4      LD  C,A
                                
001C72 E9EB DD7E0C          19      LD  A,(IX+DPB_MAXCYL)
001C75 E9EE 3D               4      DEC A
001C76 E9EF BA               4      CP  D       ;Over CYLINDER
001C77 E9F0 D8              11      RET C
                                
001C78 E9F1 7A               4      LD  A,D
001C79 E9F2 2F               4      CPL         ;データバスが負論理
001C7A E9F3 D3DB            11      OUT (0DBH),A
001C7C E9F5 72               7      LD  (HL),D
                                
001C7D E9F6 0E18             7      LD  C,018H      ;Seek
       E9F8                     FDCCMD2:
001C7F E9F8 3A85F0          13      LD  A,(_SEEKSP)
001C82 E9FB E6FF             7  FSPAT:  AND 0FFH
001C84 E9FD B1               4      OR  C
                                
       E9FE                     FDCCMD:
001C85 E9FE CD40EA          17      CALL    COMSET
       EA02                     FDCSMC  EQU $+1
001C88 EA01 3E80             7      LD  A,080H      ;FDC COMMAND(Self-modifying code)
001C8A EA03 E620             7      AND 020H        ;Write data Write track
001C8C EA05 3C               4      INC A
                                
       EA06                     SST:
001C8D EA06 0E00             7      LD  C,0
       EA08                     SST1:
001C8F EA08 0D               4      DEC C       ; 4
001C90 EA09 20FD            12      JR  NZ,SST1     ;12 * 256 / 4 = About 1ms
001C92 EA0B 3D               4      DEC A
001C93 EA0C 20FA            12      JR  NZ,SST1
                                
001C95 EA0E 3C               4      INC A       ;A=1
001C96 EA0F CD17EA          17      CALL    READY
       EA12                     SETMODE:
001C99 EA12 CD43EA          17      CALL    DELAY0      ;Head select time
001C9C EA15 3E81             7      LD  A,081H
       EA17                     READY:
001C9E EA17 3221EA          13      LD  (WAITA),A
001CA1 EA1A E5              11      PUSH    HL
001CA2 EA1B 26F8             7      LD  H,0F8H
       EA1D                     READY2:
001CA4 EA1D DBD8            11      IN  A,(0D8H)
001CA6 EA1F 2F               4      CPL         ;データバスが負論理
       EA21                     WAITA   EQU $+1
001CA7 EA20 E681             7      AND 081H        ;NOT READY,BUSY
001CA9 EA22 2808            12      JR  Z,READYE
001CAB EA24 E3              19      EX  (SP),HL     ;wait 19clock
001CAC EA25 E3              19      EX  (SP),HL     ; //
001CAD EA26 2B               6      DEC HL
001CAE EA27 7C               4      LD  A,H
001CAF EA28 B5               4      OR  L
001CB0 EA29 20F2            12      JR  NZ,READY2
001CB2 EA2B 37               4      SCF
       EA2C                     READYE:
001CB3 EA2C E1              10      POP HL
001CB4 EA2D C9              10      RET
                                
       EA2E                     FDCRES:
001CB5 EA2E 3600            10      LD  (HL),0
001CB7 EA30 0E08             7      LD  C,8
001CB9 EA32 18C4            12      JR  FDCCMD2
                                
       EA34                     FDMOFF:
001CBB EA34 F5              11      PUSH    AF
001CBC EA35 AF               4      XOR A       ;Motor off(ドライブセレクト無効)
001CBD EA36 D3DC            11      OUT (0DCH),A
001CBF EA38 F1              10      POP AF
001CC0 EA39 C9              10      RET
                                
       EA3A                     SECSET:
001CC1 EA3A F5              11      PUSH    AF
001CC2 EA3B 7B               4      LD  A,E
001CC3 EA3C 2F               4      CPL         ;データバスが負論理
001CC4 EA3D D3DA            11      OUT (0DAH),A
001CC6 EA3F F1              10      POP AF
       EA40                     COMSET:
001CC7 EA40 2F               4      CPL         ;データバスが負論理
001CC8 EA41 D3D8            11      OUT (0D8H),A
       EA43                     DELAY0:
001CCA EA43 3E1A             7      LD  A,26
       EA45                     DELAY:
001CCC EA45 3D               4      DEC A
001CCD EA46 20FD            12      JR  NZ,DELAY
001CCF EA48 C9              10      RET
                                
       EA49                     DRIVE:
001CD0 EA49 2A84F0          16      LD  HL,(_DRIVE)
001CD3 EA4C 26F0             7      LD  H,_CYL0/256
001CD5 EA4E CBFD             8      SET 7,L
001CD7 EA50 7E               7      LD  A,(HL)
001CD8 EA51 C9              10      RET
                                
       EA52                     RNF:
001CD9 EA52 CD49EA          17      CALL    DRIVE
001CDC EA55 36FF            10      LD  (HL),0FFH
001CDE EA57 C9              10      RET
                                
001CDF EA58 02                  RETRY:  DB  2
                                
                                
                                ;   FLOPPY DISK DRIVER
                                
       EA59                     WTTRK:
001CE0 EA59 0601             7      LD  B,1
001CE2 EA5B 3EF4             7      LD  A,0F4H
001CE4 EA5D 1802            12      JR  WTTRK1
       EA5F                     FDWT:
001CE6 EA5F 3EA0             7      LD  A,0A0H
       EA61                     WTTRK1:
001CE8 EA61 3202EA          13      LD  (FDCSMC),A
       EA64                     DWTBL:
001CEB EA64 78               4      LD  A,B
001CEC EA65 32A4EA          13      LD  (WTBSMC),A
001CEF EA68 3E02             7      LD  A,2     ;Retry count
001CF1 EA6A 3258EA          13      LD  (RETRY),A
                                
       EA6D                     DWT0:
001CF4 EA6D D5              11      PUSH    DE
001CF5 EA6E E5              11      PUSH    HL
001CF6 EA6F CDB2E9          17      CALL    SEEK        ;Write disk
001CF9 EA72 E1              10      POP HL
001CFA EA73 383A            12      JR  C,ERRDW
001CFC EA75 F3               4      DI
001CFD EA76 3A02EA          13      LD  A,(FDCSMC)
001D00 EA79 CD3AEA          17      CALL    SECSET
001D03 EA7C 0EDB             7      LD  C,0DBH
       EA7E                     DWT1:
001D05 EA7E 7E               7      LD  A,(HL)
001D06 EA7F 2F               4      CPL         ;データバスが負論理
001D07 EA80 57               4      LD  D,A
                                
       EA81                     DWT2:
001D08 EA81 DBD8            11      IN  A,(0D8H)
001D0A EA83 2F               4      CPL         ;データバスが負論理
001D0B EA84 0F               4      RRCA
001D0C EA85 3008            12      JR  NC,DWT4
001D0E EA87 0F               4      RRCA
001D0F EA88 30F7            12      JR  NC,DWT2
       EA8A                     DWT3:
001D11 EA8A ED51            12      OUT (C),D
001D13 EA8C 23               6      INC HL
001D14 EA8D 18EF            12      JR  DWT1
                                
       EA8F                     DWT4:
001D16 EA8F 3D               4      DEC A
001D17 EA90 28F8            12      JR  Z,DWT3
001D19 EA92 3C               4      INC A
001D1A EA93 FB               4      EI
001D1B EA94 D1              10      POP DE
001D1C EA95 13               6      INC DE
001D1D EA96 CD34EA          17      CALL    FDMOFF
001D20 EA99 2808            12      JR  Z,DISKOK_WT
001D22 EA9B CD06EB          17      CALL    DISKC
001D25 EA9E 20CD            12      JR  NZ,DWT0
001D27 EAA0 B7               4      OR  A
001D28 EAA1 2005            12      JR  NZ,ERRW
                                
       EAA3                     DISKOK_WT:
       EAA4                     WTBSMC  EQU $+1
001D2A EAA3 0601             7      LD  B,1
001D2C EAA5 10BD            13      DJNZ    DWTBL
001D2E EAA7 C9              10      RET
                                
       EAA8                     ERRW:
001D2F EAA8 3EFF             7      LD  A,0FFH
       EAAA                     ERRZ:
001D31 EAAA BF               4      CP  A
001D32 EAAB 37               4      SCF
001D33 EAAC C334EA          10      JP  FDMOFF
                                
       EAAF                     ERRDW:
001D36 EAAF D1              10      POP DE
001D37 EAB0 CD17EB          17      CALL    DELP
001D3A EAB3 20B8            12      JR  NZ,DWT0
001D3C EAB5 B7               4      OR  A
001D3D EAB6 20F0            12      JR  NZ,ERRW
001D3F EAB8 C9              10      RET
                                
       EAB9                     FDRD:
001D40 EAB9 3E80             7      LD  A,080H
001D42 EABB 3202EA          13      LD  (FDCSMC),A
       EABE                     DRDBL:
001D45 EABE 78               4      LD  A,B
001D46 EABF 32F8EA          13      LD  (RDBSMC),A
001D49 EAC2 3E02             7      LD  A,2     ;Retry count
001D4B EAC4 3258EA          13      LD  (RETRY),A
       EAC7                     DRD0:
001D4E EAC7 D5              11      PUSH    DE
001D4F EAC8 E5              11      PUSH    HL
001D50 EAC9 CDB2E9          17      CALL    SEEK        ;Read disk
001D53 EACC E1              10      POP HL
001D54 EACD 382D            12      JR  C,ERRDR
001D56 EACF F3               4      DI
001D57 EAD0 3A02EA          13      LD  A,(FDCSMC)
001D5A EAD3 CD3AEA          17      CALL    SECSET
       EAD6                     DRD1:
001D5D EAD6 DBD8            11      IN  A,(0D8H)
001D5F EAD8 2F               4      CPL         ;データバスが負論理
001D60 EAD9 0F               4      RRCA
001D61 EADA 300A            12      JR  NC,DRD3
001D63 EADC 0F               4      RRCA
001D64 EADD 30F7            12      JR  NC,DRD1
001D66 EADF DBDB            11      IN  A,(0DBH)
001D68 EAE1 2F               4      CPL         ;データバスが負論理
001D69 EAE2 77               7      LD  (HL),A
001D6A EAE3 23               6      INC HL
001D6B EAE4 18F0            12      JR  DRD1
                                
       EAE6                     DRD3:
001D6D EAE6 B7               4      OR  A
001D6E EAE7 FB               4      EI
001D6F EAE8 D1              10      POP DE
001D70 EAE9 13               6      INC DE
001D71 EAEA CD34EA          17      CALL    FDMOFF
001D74 EAED 2808            12      JR  Z,DISKOK_RD
001D76 EAEF CD06EB          17      CALL    DISKC
001D79 EAF2 20D3            12      JR  NZ,DRD0
001D7B EAF4 B7               4      OR  A
001D7C EAF5 20B1            12      JR  NZ,ERRW
                                
       EAF7                     DISKOK_RD:
       EAF8                     RDBSMC  EQU $+1
001D7E EAF7 0601             7      LD  B,1
001D80 EAF9 10C3            13      DJNZ    DRDBL
001D82 EAFB C9              10      RET
                                
       EAFC                     ERRDR:
001D83 EAFC D1              10      POP DE
001D84 EAFD CD17EB          17      CALL    DELP
001D87 EB00 20C5            12      JR  NZ,DRD0
001D89 EB02 B7               4      OR  A
001D8A EB03 20A3            12      JR  NZ,ERRW
001D8C EB05 C9              10      RET
       EB06                     DISKC:
001D8D EB06 1B               6      DEC DE
001D8E EB07 CB5F             8      BIT 3,A
001D90 EB09 C452EA          17      CALL    NZ,RNF
       EB0C                     DISKD:
001D93 EB0C E5              11      PUSH    HL
001D94 EB0D 2158EA          10      LD  HL,RETRY
001D97 EB10 35              11      DEC (HL)
001D98 EB11 E1              10      POP HL
001D99 EB12 200C            12      JR  NZ,ERR      ;Retry
001D9B EB14 B7               4      OR  A
001D9C EB15 2809            12      JR  Z,ERR       ;Error
                                
       EB17                     DELP:
001D9E EB17 CD52EA          17      CALL    RNF
001DA1 EB1A CD34EA          17      CALL    FDMOFF
001DA4 EB1D 3EFF             7      LD  A,0FFH
       EB1F                     AERRZ:
001DA6 EB1F BF               4      CP  A
       EB20                     ERR:
001DA7 EB20 3EFF             7      LD  A,0FFH
001DA9 EB22 C9              10      RET
                                
       F0B2                     FDMODE  EQU TVRAMTOP
[EOF:M7DISK.ASM:SHIFT_JIS]
                                    INCLUDE "M7DISK2.ASM"
                                
                                ;   LSX-Dodgers DISK2
                                ;   MZ-700/1500
                                
                                ;   EMM DRIVER
                                ;   1セクタ可変(256/512/1024)
                                
       EB23                     EDWT:
001DAA EB23 F5              11      PUSH    AF
001DAB EB24 CD42EB          17      CALL    EADR
001DAE EB27 0600             7      LD  B,0
       EB29                     EDWT1:
001DB0 EB29 EDB3                    OTIR
001DB2 EB2B 3D               4      DEC A
001DB3 EB2C 20FB            12      JR  NZ,EDWT1
001DB5 EB2E 180B            12      JR  EDRW1
                                
       EB30                     EDRD:
001DB7 EB30 C5              11      PUSH    BC
001DB8 EB31 CD42EB          17      CALL    EADR
001DBB EB34 0600             7      LD  B,0
       EB36                     EDRD1:
001DBD EB36 EDB2                    INIR
001DBF EB38 3D               4      DEC A
001DC0 EB39 20FB            12      JR  NZ,EDRD1
       EB3B                     EDRW1:
001DC2 EB3B F1              10      POP AF
001DC3 EB3C 83               4      ADD A,E ;セクタを進める
001DC4 EB3D 5F               4      LD  E,A
001DC5 EB3E 8A               4      ADC A,D
001DC6 EB3F 93               4      SUB E
001DC7 EB40 57               4      LD  D,A
001DC8 EB41 C9              10      RET
                                
       EB42                     EADR:
001DC9 EB42 D5              11      PUSH    DE
001DCA EB43 EB               4      EX  DE,HL
001DCB EB44 78               4      LD  A,B
001DCC EB45 DD460F          19      LD  B,(IX+DPB_BPS)
       EB48                     EADR1:              ;読み込むセクタ数と1クラスタのセクタ数を掛ける
001DCF EB48 CB18             8      RR  B
001DD1 EB4A 3804            12      JR  C,EADR2
001DD3 EB4C 87               4      ADD A,A
001DD4 EB4D 29              11      ADD HL,HL
001DD5 EB4E 18F8            12      JR  EADR1
       EB50                     EADR2:
001DD7 EB50 DD4E0D          19      LD  C,(IX+DPB_MAXSEC)
001DDA EB53 DD460C          19      LD  B,(IX+DPB_MAXCYL)
001DDD EB56 09              11      ADD HL,BC
001DDE EB57 DD4E13          19      LD  C,(IX+DPB_UNITNO)
001DE1 EB5A ED49            12      OUT (C),C
001DE3 EB5C 0C               4      INC C
001DE4 EB5D ED69            12      OUT (C),L
001DE6 EB5F 0C               4      INC C
001DE7 EB60 ED61            12      OUT (C),H
001DE9 EB62 0C               4      INC C
001DEA EB63 EB               4      EX  DE,HL
001DEB EB64 D1              10      POP DE
001DEC EB65 C9              10      RET
                                
                                ;   CMOS BACKUP MEMORY DRIVER(32KB)
                                ;   1セクタ256
                                
       EB66                     CDWT:
001DED EB66 78               4      LD  A,B
001DEE EB67 DD4E13          19      LD  C,(IX+DPB_UNITNO)
001DF1 EB6A ED40            12      IN  B,(C)       ;アドレスカウンタを0000にリセット
001DF3 EB6C ED59            12      OUT (C),E       ;W)アドレスカウンタ上位
001DF5 EB6E 01FA00          10      LD  BC,000FAH
       EB71                     CDWT1:
001DF8 EB71 EDB3                    OTIR            ;W)データ書き込み・アドレスカウンタ+1
001DFA EB73 13               6      INC DE
001DFB EB74 3D               4      DEC A
001DFC EB75 20FA            12      JR  NZ,CDWT1
001DFE EB77 A7               4      AND A
001DFF EB78 C9              10      RET
                                
       EB79                     CDRD:
001E00 EB79 78               4      LD  A,B
001E01 EB7A DD4E13          19      LD  C,(IX+DPB_UNITNO)
001E04 EB7D ED40            12      IN  B,(C)       ;アドレスカウンタを0000にリセット
001E06 EB7F ED59            12      OUT (C),E       ;W)アドレスカウンタ上位
001E08 EB81 01F900          10      LD  BC,000F9H
       EB84                     CDRD1:
001E0B EB84 EDB2                    INIR            ;R)データ読み出し・アドレスカウンタ+1
001E0D EB86 13               6      INC DE
001E0E EB87 3D               4      DEC A
001E0F EB88 20FA            12      JR  NZ,CDRD1
001E11 EB8A A7               4      AND A
001E12 EB8B C9              10      RET
                                
                                ;   RAM DISK DRIVER (64KB)
                                ;   1セクタ256
                                
       EB8C                     RDWT:
001E13 EB8C 3EB3             7      LD  A,0B3H      ;OTIR
001E15 EB8E 1802            12      JR  RDRW
       EB90                     RDRD:
001E17 EB90 3EB2             7      LD  A,0B2H      ;INIR
       EB92                     RDRW:
001E19 EB92 329FEB          13      LD  (RDRW1+1),A
                                
001E1C EB95 78               4      LD  A,B
001E1D EB96 43               4      LD  B,E     ;B=アドレスカウンタ上位(X1の様な16bitのI/Oアクセス)
001E1E EB97 0EEB             7      LD  C,0EBH
001E20 EB99 ED71            12      OUT (C),0       ;0=アドレスカウンタ下位
001E22 EB9B 0D               4      DEC C       ;EA(R)データ読み出し・アドレスカウンタ+1
001E23 EB9C 0600             7      LD  B,0
       EB9E                     RDRW1:
001E25 EB9E EDB2                    INIR            ;自己書き換え(INIR/OTIR)
001E27 EBA0 13               6      INC DE
001E28 EBA1 3D               4      DEC A
001E29 EBA2 20FA            12      JR  NZ,RDRW1
001E2B EBA4 A7               4      AND A
001E2C EBA5 C9              10      RET
[EOF:M7DISK2.ASM:UTF_8]
                                    INCLUDE "LDCCPWK.ASM"
                                
                                ;   LSX-Dodgers CCP WORK
                                
       0040                     PATHX   EQU 64
001E2D EBA6                     PATHD:  DS  PATHX
001E6D EBE6 00                  PATHE:  DB  0
                                
       EBE7                     DTA_CCP:
001E6E EBE7                         DS  37
                                
       EC0C                     FCB_BAT:
001E93 EC0C                         DS  37
                                
                                
001EB8 EC31 2062797465732066    FREE:   DB  " bytes free",9,'$'
            7265650924          
[EOF:LDCCPWK.ASM:UTF_8]
                                    INCLUDE "M7TABLE.ASM"
                                
                                ;   LSX-Dodgers TABLE 表示関連のテーブル
                                ;   MZ-700/1500
                                
       EC3E                     AT_TABLE:
001EC5 EC3E                         DS  TABLEAD-AT_TABLE
                                
       ED40                     KEY_TABLE:
001FC7 ED40 12081E1F1C1D5C2F        DB  12H,08H,1EH,1FH,1CH,1DH,5CH,'/'
001FCF ED48 5C5E2D2030392C2E        DB  5CH,'^','-',20H,'0','9',',','.'
001FD7 ED50 3132333435363738        DB  '1','2','3','4','5','6','7','8'
001FDF ED58 6162636465666768        DB  'a','b','c','d','e','f','g','h'
001FE7 ED60 696A6B6C6D6E6F70        DB  'i','j','k','l','m','n','o','p'
001FEF ED68 7172737475767778        DB  'q','r','s','t','u','v','w','x'
001FF7 ED70 797A405B5D000000        DB  'y','z','@','[',']',00H,00H,00H
001FFF ED78 001B3D09003B3A0D        DB  00H,1BH,'=',09H,00H,';',':',0DH
       ED80                     SHIFT_TABLE:
002007 ED80 12081E1F1C1D5F3F        DB  12H,08H,1EH,1FH,1CH,1DH,'_','?'
00200F ED88 7C7E3D2030293C3E        DB  '|','~','=',20H,'0',')','<','>'
002017 ED90 2122232425262728        DB  '!','"','#','$','%','&',27H,'('
00201F ED98 4142434445464748        DB  'A','B','C','D','E','F','G','H'
002027 EDA0 494A4B4C4D4E4F50        DB  'I','J','K','L','M','N','O','P'
00202F EDA8 5152535455565758        DB  'Q','R','S','T','U','V','W','X'
002037 EDB0 595A607B7D000000        DB  'Y','Z','`','{','}',00H,00H,00H
00203F EDB8 00003D09002B2A0D        DB  00H,00H,'=',09H,00H,'+','*',0DH
       EDC0                     CTRL_TABLE:
002047 EDC0 12081E1F1C1D3F2F        DB  12H,08H,1EH,1FH,1CH,1DH,'?','/'
00204F EDC8 2A2B2D2030392C2E        DB  '*','+','-',20H,'0','9',',','.'
002057 EDD0 3132333435363738        DB  '1','2','3','4','5','6','7','8'
00205F EDD8 0102030405060708        DB  01H,02H,03H,04H,05H,06H,07H,08H
002067 EDE0 090A0B0C0D0E0F10        DB  09H,0AH,0BH,0CH,0DH,0EH,0FH,10H
00206F EDE8 1112131415161718        DB  11H,12H,13H,14H,15H,16H,17H,18H
002077 EDF0 191A1B5B5D000000        DB  19H,1AH,1BH,'[',']',00H,00H,00H
00207F EDF8 00003D09003B3A0D        DB  00H,00H,'=',09H,00H,';',':',0DH
                                
                                ;   アドレス下位1バイトが0になるように
       EE00                     CD_TABLE:
002087 EE00 00D1D2D3D4D5D6D0        DB  $00,$D1,$D2,$D3,$D4,$D5,$D6,$D0 ;月火水木金土日
00208F EE08 D8DCD9DADBD7CFCE        DB  $D8,$DC,$D9,$DA,$DB,$D7,$CF,$CE ;年円時分秒
002097 EE10 601F5F5E1E1B7978        DB  $60,$1F,$5F,$5E,$1E,$1B,$79,$78 ;
00209F EE18 5C5D1C1D6DCACDC7        DB  $5C,$5D,$1C,$1D,$6D,$CA,$CD,$C7 ;
0020A7 EE20 0061626364656667        DB  $00,$61,$62,$63,$64,$65,$66,$67 ; !"#$%&'
0020AF EE28 68696B6A2F2A2E2D        DB  $68,$69,$6B,$6A,$2F,$2A,$2E,$2D ;()*+,-./
0020B7 EE30 2021222324252627        DB  $20,$21,$22,$23,$24,$25,$26,$27 ;01234567
0020BF EE38 28294F2C512B5749        DB  $28,$29,$4F,$2C,$51,$2B,$57,$49 ;89:;<=>?
0020C7 EE40 5501020304050607        DB  $55,$01,$02,$03,$04,$05,$06,$07 ;@ABCDEFG
0020CF EE48 08090A0B0C0D0E0F        DB  $08,$09,$0A,$0B,$0C,$0D,$0E,$0F ;HIJKLMNO
0020D7 EE50 1011121314151617        DB  $10,$11,$12,$13,$14,$15,$16,$17 ;PQRSTUVW
0020DF EE58 18191A52DD54507C        DB  $18,$19,$1A,$52,$DD,$54,$50,$7C ;XYZ[\]^_
0020E7 EE60 5901020304050607        DB  $59,$01,$02,$03,$04,$05,$06,$07 ;`abcdefg   ATB:1
0020EF EE68 08090A0B0C0D0E0F        DB  $08,$09,$0A,$0B,$0C,$0D,$0E,$0F ;hijklmno   ATB:1
0020F7 EE70 1011121314151617        DB  $10,$11,$12,$13,$14,$15,$16,$17 ;pqrstuvw   ATB:1
0020FF EE78 18191ACB35CC705A        DB  $18,$19,$1A,$CB,$35,$CC,$70,$5A ;xyz{|}~    ATB:1
002107 EE80 415346444847B49E        DB  $41,$53,$46,$44,$48,$47,$B4,$9E ;トランプ〇●をぁ   ATB:1
00210F EE88 B2B6BABE9FB3B7BB        DB  $B2,$B6,$BA,$BE,$9F,$B3,$B7,$BB ;ぃぅぇぉゃゅょっ   ATB:1
002117 EE90 BFA385A4A5A69487        DB  $BF,$A3,$85,$A4,$A5,$A6,$94,$87 ;ーあいうえおかき   ATB:1
00211F EE98 889C829884929083        DB  $88,$9C,$82,$98,$84,$92,$90,$83 ;くけこさしすせそ   ATB:1
002127 EEA0 F0BD9DB1B5B9B49E        DB  $F0,$BD,$9D,$B1,$B5,$B9,$B4,$9E ;　。「」、・ヲァ
00212F EEA8 B2B6BABE9FB3B7BB        DB  $B2,$B6,$BA,$BE,$9F,$B3,$B7,$BB ;ィゥェォャョュッ
002137 EEB0 BFA385A4A5A69487        DB  $BF,$A3,$85,$A4,$A5,$A6,$94,$87 ;ーアイウエオカキ
00213F EEB8 889C829884929083        DB  $88,$9C,$82,$98,$84,$92,$90,$83 ;クケコサシスセソ
002147 EEC0 91819A97939589A1        DB  $91,$81,$9A,$97,$93,$95,$89,$A1 ;タチツテトナニヌ
00214F EEC8 AF8B8696A2ABAA8A        DB  $AF,$8B,$86,$96,$A2,$AB,$AA,$8A ;ネノハヒフヘホマ
002157 EED0 8EB0AD8DA7A8A98F        DB  $8E,$B0,$AD,$8D,$A7,$A8,$A9,$8F ;ミムメモヤユヨラ
00215F EED8 8CAEAC9BA099BCB8        DB  $8C,$AE,$AC,$9B,$A0,$99,$BC,$B8 ;リルレロワン゛゜
002167 EEE0 91819A97939589A1        DB  $91,$81,$9A,$97,$93,$95,$89,$A1 ;たちつてとねにぬ   ATB:1
00216F EEE8 AF8B8696A2ABAA8A        DB  $AF,$8B,$86,$96,$A2,$AB,$AA,$8A ;ねのはひふへほま   ATB:1
002177 EEF0 8EB0AD8DA7A8A98F        DB  $8E,$B0,$AD,$8D,$A7,$A8,$A9,$8F ;みむめもやゆよら   ATB:1
00217F EEF8 8CAEAC9BA099BCB8        DB  $8C,$AE,$AC,$9B,$A0,$99,$BC,$B8 ;りるれろわん゛゜   ATB:1
       EF00                     DC_TABLE:
002187 EF00 2041424344454647        DB  $20,$41,$42,$43,$44,$45,$46,$47 ;0
00218F EF08 48494A4B4C4D4E4F        DB  $48,$49,$4A,$4B,$4C,$4D,$4E,$4F
002197 EF10 5051525354555657        DB  $50,$51,$52,$53,$54,$55,$56,$57 ;1
00219F EF18 58595A151A1B1411        DB  $58,$59,$5A,$15,$1A,$1B,$14,$11
0021A7 EF20 3031323334353637        DB  $30,$31,$32,$33,$34,$35,$36,$37 ;2
0021AF EF28 38392D3D3B2F2E2C        DB  $38,$39,$2D,$3D,$3B,$2F,$2E,$2C
0021B7 EF30 00000000007C0000        DB  $00,$00,$00,$00,$00,$7C,$00,$00 ;3
0021BF EF38 0000000000000000        DB  $00,$00,$00,$00,$00,$00,$00,$00
0021C7 EF40 0080000083008285        DB  $00,$80,$00,$00,$83,$00,$82,$85 ;4
0021CF EF48 843F00000000003A        DB  $84,$3F,$00,$00,$00,$00,$00,$3A
0021D7 EF50 5E3C5B815D40003E        DB  $5E,$3C,$5B,$81,$5D,$40,$00,$3E ;5
0021DF EF58 00607F0018191312        DB  $00,$60,$7F,$00,$18,$19,$13,$12
0021E7 EF60 1021222324252627        DB  $10,$21,$22,$23,$24,$25,$26,$27 ;6
0021EF EF68 28292B2A001C0000        DB  $28,$29,$2B,$2A,$00,$1C,$00,$00
0021F7 EF70 7E00000000000000        DB  $7E,$00,$00,$00,$00,$00,$00,$00 ;7
0021FF EF78 171600005F000000        DB  $17,$16,$00,$00,$5F,$00,$00,$00
002207 EF80 00C19A9F9C92CA97        DB  $00,$C1,$9A,$9F,$9C,$92,$CA,$97 ;8
00220F EF88 98C6CFC9D8D3D0D7        DB  $98,$C6,$CF,$C9,$D8,$D3,$D0,$D7
002217 EF90 9EC09DC496C5CBC3        DB  $9E,$C0,$9D,$C4,$96,$C5,$CB,$C3 ;9
00221F EF98 9BDDC2DB99A2878C        DB  $9B,$DD,$C2,$DB,$99,$A2,$87,$8C
002227 EFA0 DCC7CC91939495D4        DB  $DC,$C7,$CC,$91,$93,$94,$95,$D4 ;A
00222F EFA8 D5D6CECDDAD2D9C8        DB  $D5,$D6,$CE,$CD,$DA,$D2,$D9,$C8
002237 EFB0 D1A3888D86A4898E        DB  $D1,$A3,$88,$8D,$86,$A4,$89,$8E ;B
00223F EFB8 DFA58A8FDEA18B90        DB  $DF,$A5,$8A,$8F,$DE,$A1,$8B,$90
002247 EFC0 000000000000001F        DB  $00,$00,$00,$00,$00,$00,$00,$1F ;C
00224F EFC8 00001D7B7D1E0F0E        DB  $00,$00,$1D,$7B,$7D,$1E,$0F,$0E
002257 EFD0 070102030405060D        DB  $07,$01,$02,$03,$04,$05,$06,$0D ;D
00225F EFD8 080A0B0C095C0000        DB  $08,$0A,$0B,$0C,$09,$5C,$00,$00
002267 EFE0 0000000000000000        DB  $00,$00,$00,$00,$00,$00,$00,$00 ;E
00226F EFE8 0000000000000000        DB  $00,$00,$00,$00,$00,$00,$00,$00
002277 EFF0 A000000000000000        DB  $A0,$00,$00,$00,$00,$00,$00,$00 ;F
00227F EFF8 0000000000000000        DB  $00,$00,$00,$00,$00,$00,$00,$00
[EOF:M7TABLE.ASM:SHIFT_JIS]
                                    INCLUDE "LDWORK.ASM"
                                
                                ;   LSX-Dodgers WORK0
                                ;
                                ;   CP/M互換BIOS
                                ;   BOOT:アドレス下位1バイトが0になるように
       F000                     AT_WORK:
002287 F000                         DS  WORKAD-AT_WORK
                                
       F000                     CPM_BOOT:
002287 F000 C30000          10      JP  0
       F003                     _SYS00:     ;(BDOS)プログラム終了
       F003                     CPM_WBOOT:
00228A F003 C3FECF          10      JP  WBOOT1
       F006                     CPM_CONST:
00228D F006 C3C6D8          10      JP  CONSTX
       F009                     _SYS07:     ;(BDOS)コンソール直接入力
       F009                     CPM_CONIN:
002290 F009 C35CD8          10      JP  FLGET
       F00C                     CPM_CONOUT:
002293 F00C C36BDA          10      JP  CONOUT1
                                
       F00F                     DECBF:              ;10進数表示時のバッファ(5バイト)
002296 F00F                         DS  5
       F00F                     RR_BUF_HL   EQU DECBF   ;CP/M互換ファイルアクセスの際のランダムレコードの一時的な保管場所
       F011                     RR_BUF_A    EQU DECBF+2 ;計3バイト
                                
00229B F014 00                  FDRV:   DB  0
00229C F015                     FNAME:  DS  36
0022C0 F039                     SFILE:  DS  33      ;DRV FILENAME
                                
0022E1 F05A                         DS  3
                                
0022E4 F05D 0000                LEFTX:  DW  0
0022E6 F05F 0000                DTAX:   DW  0
                                
       F061                     ZERO:
       F061                     BEEPD:
0022E8 F061 008E01000B000C10        DB  0,08EH,1,0,00BH,0,00CH,010H
0022F0 F069 073E08100D00FF          DB  007H,03EH,008H,010H,00DH,0,0FFH
       F062                     RTC_YY  EQU BEEPD+1
       F063                     RTC_MW  EQU BEEPD+2
       F064                     RTC_DD  EQU BEEPD+3
       F065                     RTC_TT  EQU BEEPD+4
       F066                     RTC_MM  EQU BEEPD+5
       F067                     RTC_SS  EQU BEEPD+6
       F062                     ROM_SLT EQU BEEPD+1
                                
0022F7 F070 00                  CHECK:  DB  0
                                
0022F8 F071 4F4B24              OK: DB  "OK$"
0022FB F074                         DS  5
002300 F079 4572726F722124      COMERM: DB  "Error!$"
                                ;   システムワークエリア
                                ;   _CYL0:アドレス下位1バイトが080Hになるように
002307 F080 FF                  _CYL0:  DB  0FFH    ;Cylinder
002308 F081 FF                  _CYL1:  DB  0FFH    ;Cylinder
002309 F082 FF                  _CYL2:  DB  0FFH    ;Cylinder
00230A F083 FF                  _CYL3:  DB  0FFH    ;Cylinder
00230B F084 00                  _DRIVE: DB  0   ;unit number
00230C F085 00                  _SEEKSP:DB  0   ;Seek speed
00230D F086 FF                  _ISEEK: DB  0FFH    ;
00230E F087 00                  _DVSW:  DB  0
00230F F088 00                  _DRV:   DB  0
002310 F089 FF                  _DSK:   DB  0FFH
002311 F08A 8000                _DTA:   DW  00080H
002313 F08C 0000                _CTC:   DW  0
002315 F08E 0000                _TXADR: DW  0
002317 F090 0000                _KEYPS: DW  0
002319 F092 00FF                _KEYD:  DW  0FF00H  ;キーデータ
00231B F094 8310                _KEYSP: DB  KEYSP_L,KEYSP_H ;オートリピートの速度
00231D F096 70                  _COLORF:DB  COLORF  ;色
00231E F097 19                  _LINE:  DB  LINE
                                
00231F F098 0000                _FCB:   DW  0   ;SEARCH FILES
002321 F09A 0000                _FBPS:  DW  0   ;    //
002323 F09C 0000                _FBAD:  DW  0   ;    //
002325 F09E 00                  _FBCNT: DB  0   ;    //
002326 F09F 00                  _FILEN: DB  0   ;    //
002327 F0A0 00                  _DIRF:  DB  0   ;bit7:ディレクトリ bit0-6:セクタインデックス
002328 F0A1                         DS  1
002329 F0A2 00                  _WTFATF:DB  0   ;FATバッファの更新フラグ
00232A F0A3                         DS  1
00232B F0A4 00                  _WTDBF: DB  0   ;データバッファの更新フラグ
00232C F0A5 FF                  _DBDRV: DB  0FFH    ;データバッファにあるデータを読み込んだドライブ
00232D F0A6 0000                _DBSEC: DW  0   ;データバッファにあるデータを読み込んだセクタ番号
00232F F0A8 0000                _DPB:   DW  0
       F0AA                     _FATDRV:
002331 F0AA FF                      DB  0FFH    ;FATバッファに読み込んでいるドライブ
002332 F0AB 00                  _FATIX: DB  0   ;FATバッファに読み込んでいるインデックス
       F0AC                     _FAKEFREE:
002333 F0AC 0000                    DW  0   ;偽の残量（FATサイズが大きくなると重くなるのでその対策）
                                
002335 F0AE                         DS  2
                                
       F0B0                     CRTCD:
002337 F0B0 6F                      DB  06FH
       F0B1                     _WIDTH:
002338 F0B1 28                      DB  WIDTH
       F0B2                     TVRAMTOP:
002339 F0B2 5938                    DB  059H,038H
00233B F0B4 1F02                    DB  01FH,002H
       F0B6                     _LINE2:
00233D F0B6 19                      DB  019H
       F0B7                     WKE4:
00233E F0B7 1C                      DB  01CH
       F0B8                     WKE6:
00233F F0B8 00                      DB  000H
       F0B9                     WK40:
002340 F0B9 07                      DB  007H
       F0BA                     _PAGE_MINUS:
002341 F0BA 18FC                    DW  0-WIDTH*LINE
       F0BC                     _WIDTH_MINUS:
002343 F0BC D8FF                    DW  0-WIDTH
       F0BE                     WK30:
002345 F0BE 0C                      DB  00CH
       F0BF                     WK31:
       F0BF                     WK1FD0:
002346 F0BF 20                      DB  020H
                                
002347 F0C0 0000                CTC0:   DW  INTCTCE
002349 F0C2 0000                CTC1:   DW  INTCTCE
00234B F0C4 0000                CTC2:   DW  INTCTC2
00234D F0C6 0000                CTC3:   DW  INTCTCE
00234F F0C8 0000                INTVEC: DW  INT
                                
                                ;   LSX-Dodgers 独自BIOS
                                
002351 F0CA C3A4DB          10  _INKEY: JP  INKEY
002354 F0CD C357D9          10  _PRINT: JP  PRINT
002357 F0D0 C301DC          10  _SCRN:  JP  SCRN
00235A F0D3 C314DB          10  _POS:   JP  POS
00235D F0D6 C339DA          10  _LOC:   JP  LOC
       F0D9                     _CHGDRV:
002360 F0D9 C3AEE8          10      JP  CHGDRV
       F0DC                     _GETDPB:
002363 F0DC C379E9          10      JP  GETDPB
       F0DF                     _FFLUSH:
002366 F0DF C397E9          10      JP  FFLUSH
       F0E2                     _RDFATX:
002369 F0E2 C387E5          10      JP  RDFATX
00236C F0E5 C3AFE6          10  _RDFAT: JP  RDFAT
00236F F0E8 C359EA          10  _WTTRK: JP  WTTRK
002372 F0EB C3B9EA          10  _FDRD:  JP  FDRD
002375 F0EE C35FEA          10  _FDWT:  JP  FDWT
       F0F1                     _BPB2DPB:
002378 F0F1 C33CE7          10      JP  BPB2DPB
       F0F4                     _BREAK:
00237B F0F4 C393D1          10      JP  END_BATCH
       F0F7                     _GNCL:
00237E F0F7 C329E6          10  GNCPAT: JP  GNCL        ; self-modifying code
       F0FA                     _SNCL:
002381 F0FA C34CE6          10  SNCPAT: JP  SNCL        ; self-modifying code
002384 F0FD C34DD0          10  _COMANL:JP  COMANL
                                
       F100                     _WE:
[EOF:LDWORK.ASM:SHIFT_JIS]
                                    INCLUDE "LDCALL.ASM"
                                
                                ;   LSX-Dodgers システムコール(BDOS)
                                ;
                                ;   LSX-Dodgers SYSTEM CALL
                                ;   STABLE:アドレス下位1バイトが0になるように
                                
       F100                     STABLE:
                                ;0
002387 F100 03F02FD83BD8D6DD        DW  _SYS00,_SYS01,_SYS02,_SYS03
00238F F108 40D540D540D809F0        DW  _SYS04,_SYS05,_SYS06,_SYS07
002397 F110 48D842D592D8BED8        DW  _SYS08,_SYS09,_SYS0A,_SYS0B
00239F F118 57D55CD56BD57CD5        DW  _SYS0C,_SYS0D,_SYS0E,_SYS0F
                                ;1
0023A7 F120 D0D517D660D696D6        DW  _SYS10,_SYS11,_SYS12,_SYS13
0023AF F128 9ED6B4D6C9D6C1D6        DW  _SYS14,_SYS15,_SYS16,_SYS17
0023B7 F130 10D715D71AD720D7        DW  _SYS18,_SYS19,_SYS1A,_SYS1B
0023BF F138 40D546D740D54AD7        DW  _SYS1C,_SYS1D,_SYS1E,_SYS1F
                                ;2
0023C7 F140 40D500D708D751D7        DW  _SYS20,_SYS21,_SYS22,_SYS23
0023CF F148 77D740D55BE233E3        DW  _SYS24,_ERROR,_SYS26,_SYS27
0023D7 F150 08D780D7D4D8D6DD        DW  _SYS28,_SYS29,_SYS2A,_SYS2B
0023DF F158 DAD8D6DD40D5A1D7        DW  _SYS2C,_SYS2D,_SYS2E,_SYS2F
                                ;3
0023E7 F160 9BD740D540D540D5        DW  _SYS30,_ERROR,_ERROR,_ERROR
0023EF F168 40D540D540D540D5        DW  _ERROR,_ERROR,_ERROR,_ERROR
0023F7 F170 40D5D6DDD6DDC2D7        DW  _ERROR,_SYS39,_SYS3A,_SYS5A
                                ;DOS2
0023FF F178 23D5                    DW  _DOS2
                                
002401 F17A                         DS  2
002403 F17C 00F3                _FATBF: DW  FATBF
002405 F17E 00FB                _DTBUF: DW  DTBUF
                                
                                ;   コントロールコードテーブル
                                ;   CTRLTB:アドレス下位1バイトが080Hになるように
                                
       F180                     CTRLTB:
002407 F180 BCD9BCD9F2D9E7DA        DW  CTRL00,CTRL00,CTRL02,CTRL03 ;  A,B,C
00240F F188 E1DA1EDAD2DA7BDA        DW  CTRL04,CTRL05,CTRL06,CTRL07 ;D,E,F,G
002417 F190 C8D9E3D9EADA4CDA        DW  CTRL08,CTRL09,CTRL0A,CTRL0B ;H,I,J,K
00241F F198 CFDA34DAFCDABCD9        DW  CTRL0C,CTRL0D,CTRL0E,CTRL00 ;L,M,N,O
002427 F1A0 BCD9BCD944DABCD9        DW  CTRL00,CTRL00,CTRL12,CTRL00 ;P,Q,R,S
00242F F1A8 BCD9BCD9BCD9BCD9        DW  CTRL00,CTRL00,CTRL00,CTRL00 ;T,U,V,W
002437 F1B0 BCD9BCD9CFDA53DA        DW  CTRL00,CTRL00,CTRL0C,CTRL1B ;X,Y,Z,ESC
00243F F1B8 ABD9CFD9D8D9EADA        DW  CTRL1C,CTRL1D,CTRL1E,CTRL1F ;→,←,↑,↓
                                
002447 F1C0 0200                M2D:    DW  2
002449 F1C2 FD02                    DB  0FDH,2
00244B F1C4 6401                    DW  356
00244D F1C6 FF0728090182            DB  0FFH,7,40,9,1,082H
002453 F1CC 0500A7000800            DW  5,0A7H,8
                                
002459 F1D2 0200                M2HD:   DW  2
00245B F1D4 FE01                    DB  0FEH,1
00245D F1D6 C704                    DW  1223
00245F F1D8 FE064D080184            DB  0FEH,6,77,8,1,084H
002465 F1DE 0500A7000900            DW  5,0A7H,9
                                
00246B F1E4 1617                SDDATA: DB  22,23       ;(FCB)ファイルを最後に変更した時刻
00246D F1E6 1415                    DB  20,21       ;(FCB)ファイルを最後に変更した日付
00246F F1E8 1A1B                    DB  26,27       ;(FCB)ファイルの先頭クラスタ
002471 F1EA 10111213                DB  16,17,18,19 ;(FCB)ファイルのサイズ(バイト単位)
       F1EE                     SDDATAE:
                                
002475 F1EE                         DS  2
       F1F0                     _FCB_BAT:
002477 F1F0 0CEC                    DW  FCB_BAT
       F1F2                     _PATH:
002479 F1F2 A6EB                    DW  PATHD
                                
00247B F1F4                     SCDIR:  DS  2       ;+14 +15
00247D F1F6                     SFBPS:  DS  2       ;FBPS
00247F F1F8                     SFNDF:  DS  2       ;FILEN DIRF
                                
002481 F1FA 0000                _FATPS: DW  0
002483 F1FC 0000                _DIRPS: DW  0
002485 F1FE 0000                _CLPS:  DW  0
                                
       F200                     _PE:
[EOF:LDCALL.ASM:SHIFT_JIS]
                                    INCLUDE "M7DPB.ASM"
                                
                                ;   LSX-Dodgers DPB
                                ;   MZ-700/1500
                                
       F200                     _DEVICE:
                                
                                ;   A:
                                
002487 F200 0200                    DW  2   ;DPB_FATLN
002489 F202 EBF0                    DW  _FDRD   ;DPB_DRD
00248B F204 EEF0                    DW  _FDWT   ;DPB_DWT
00248D F206 FD                      DB  0FDH    ;DPB_FATID
00248E F207 02                      DB  2   ;DPB_SECPCL
00248F F208 6401                    DW  356 ;DPB_MAXCL
002491 F20A FF                      DB  0FFH    ;DPB_FDMODE 0FFH=2D / 0FEH=2HD
002492 F20B 07                      DB  7   ;DPB_DIRSCNT
002493 F20C 28                      DB  40  ;DPB_MAXCYL
002494 F20D 09                      DB  9   ;DPB_MAXSEC Number of sectors
002495 F20E 01                      DB  1   ;DPB_FATPS
002496 F20F 82                      DB  082H    ;DPB_BPS
002497 F210 0500                    DW  5   ;DPB_DIRPS
002499 F212 27                      DB  027H    ;DPB_DEVICE Device Number
00249A F213 00                      DB  0   ;DPB_UNITNO
00249B F214 0800                    DW  8   ;DPB_ADDCL
00249D F216 0000                    DW  0   ;DPB_16
00249F F218 0000                    DW  0   ;DPB_18
0024A1 F21A 0000                    DW  0   ;DPB_SDIR
0024A3 F21C 46444430                DB  "FDD0"  ;DPB_NAME
                                
                                ;   B:
                                
0024A7 F220 0200                    DW  2   ;DPB_FATLN
0024A9 F222 EBF0                    DW  _FDRD   ;DPB_DRD
0024AB F224 EEF0                    DW  _FDWT   ;DPB_DWT
0024AD F226 FD                      DB  0FDH    ;DPB_FATID
0024AE F227 02                      DB  2   ;DPB_SECPCL
0024AF F228 6401                    DW  356 ;DPB_MAXCL
0024B1 F22A FF                      DB  0FFH    ;DPB_FDMODE 0FFH=2D / 0FEH=2HD
0024B2 F22B 07                      DB  7   ;DPB_DIRSCNT
0024B3 F22C 28                      DB  40  ;DPB_MAXCYL
0024B4 F22D 09                      DB  9   ;DPB_MAXSEC Number of sectors
0024B5 F22E 01                      DB  1   ;DPB_FATPS
0024B6 F22F 82                      DB  082H    ;DPB_BPS
0024B7 F230 0500                    DW  5   ;DPB_DIRPS
0024B9 F232 27                      DB  027H    ;DPB_DEVICE Device Number
0024BA F233 01                      DB  1   ;DPB_UNITNO
0024BB F234 0800                    DW  8   ;DPB_ADDCL
0024BD F236 0000                    DW  0   ;DPB_16
0024BF F238 0000                    DW  0   ;DPB_18
0024C1 F23A 0000                    DW  0   ;DPB_SDIR
0024C3 F23C 46444431                DB  "FDD1"  ;DPB_NAME
                                
                                ;   C:
                                
0024C7 F240 0100                    DW  1   ;DPB_FATLN
0024C9 F242 79EB                    DW  CDRD    ;DPB_DRD
0024CB F244 66EB                    DW  CDWT    ;DPB_DWT
0024CD F246 FA                      DB  0FAH    ;DPB_FATID
0024CE F247 01                      DB  1   ;DPB_SECPCL
0024CF F248 7A00                    DW  122 ;DPB_MAXCL
0024D1 F24A 00                      DB  0   ;DPB_FDMODE
0024D2 F24B 06                      DB  6   ;DPB_DIRSCNT
0024D3 F24C 00                      DB  0   ;DPB_MAXCYL
0024D4 F24D 00                      DB  0   ;DPB_MAXSEC
0024D5 F24E 01                      DB  1   ;DPB_FATPS
0024D6 F24F 01                      DB  1   ;DPB_BPS
0024D7 F250 0200                    DW  2   ;DPB_DIRPS
0024D9 F252 0C                      DB  00CH    ;DPB_DEVICE
0024DA F253 F8                      DB  0F8H    ;DPB_UNITNO
0024DB F254 0600                    DW  6   ;DPB_ADDCL
0024DD F256 0000                    DW  0   ;DPB_16
0024DF F258 0000                    DW  0   ;DPB_18
0024E1 F25A 0000                    DW  0   ;DPB_SDIR
0024E3 F25C 434D4F53                DB  "CMOS"  ;DPB_NAME
                                
                                ;   D:
                                
0024E7 F260                         DS  32
                                
                                ;   E:
                                
002507 F280 0000                    DW  0   ;DPB_FATLN
002509 F282 30EB                    DW  EDRD    ;DPB_DRD
00250B F284 23EB                    DW  EDWT    ;DPB_DWT
00250D F286 FA                      DB  0FAH    ;DPB_FATID
00250E F287 02                      DB  2   ;DPB_SECPCL
00250F F288 0000                    DW  0   ;DPB_MAXCL
002511 F28A 00                      DB  0   ;DPB_FDMODE
002512 F28B 10                      DB  16  ;DPB_DIRSCNT
002513 F28C 00                      DB  0   ;DPB_MAXCYL
002514 F28D 00                      DB  0   ;DPB_MAXSEC
002515 F28E 01                      DB  1   ;DPB_FATPS
002516 F28F 01                      DB  1   ;DPB_BPS
002517 F290 0000                    DW  0   ;DPB_DIRPS
002519 F292 26                      DB  026H    ;DPB_DEVICE
00251A F293 00                      DB  0   ;DPB_UNITNO
00251B F294 0000                    DW  0   ;DPB_ADDCL
00251D F296 0000                    DW  0   ;DPB_16
00251F F298 0000                    DW  0   ;DPB_18
002521 F29A 0000                    DW  0   ;DPB_SDIR
002523 F29C 454D4D30                DB  "EMM0"  ;DPB_NAME
                                
                                ;   F:
                                
002527 F2A0 0200                    DW  2   ;DPB_FATLN
002529 F2A2 90EB                    DW  RDRD    ;DPB_DRD
00252B F2A4 8CEB                    DW  RDWT    ;DPB_DWT
00252D F2A6 FA                      DB  0FAH    ;DPB_FATID
00252E F2A7 01                      DB  1   ;DPB_SECPCL
00252F F2A8 F600                    DW  246 ;DPB_MAXCL
002531 F2AA 00                      DB  0   ;DPB_FDMODE
002532 F2AB 09                      DB  9   ;DPB_DIRSCNT
002533 F2AC 00                      DB  0   ;DPB_MAXCYL
002534 F2AD 00                      DB  0   ;DPB_MAXSEC
002535 F2AE 01                      DB  1   ;DPB_FATPS
002536 F2AF 01                      DB  1   ;DPB_BPS
002537 F2B0 0300                    DW  3   ;DPB_DIRPS
002539 F2B2 0F                      DB  00FH    ;DPB_DEVICE
00253A F2B3 00                      DB  0   ;DPB_UNITNO
00253B F2B4 0A00                    DW  10  ;DPB_ADDCL
00253D F2B6 0000                    DW  0   ;DPB_16
00253F F2B8 0000                    DW  0   ;DPB_18
002541 F2BA 0000                    DW  0   ;DPB_SDIR
002543 F2BC 52414D46                DB  "RAMF"  ;DPB_NAME
                                
                                ;   G:
                                
002547 F2C0                         DS  32
                                
                                ;   H:
002567 F2E0                         DS  3
00256A F2E3 00                      DB  0
[EOF:M7DPB.ASM:UTF_8]
                                
       A56B                         ORG $$+OFFSET   ;$DEPHASE
       A56B                     LAST_ADR:
                                
                                    END
[EOF:M7.ASM:UTF_8]
