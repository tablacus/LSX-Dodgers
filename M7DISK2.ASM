
;	LSX-Dodgers DISK2
;	MZ-700/1500

;	EMM DRIVER


EDWT:
	PUSH	AF
	CALL	EADR
	LD	B,0
EDWT1:
	OTIR
	DEC	A
	JR	NZ,EDWT1
	JR	EDRW1

EDRD:
	PUSH	BC
	CALL	EADR
	LD	B,0
EDRD1:
	INIR
	DEC	A
	JR	NZ,EDRD1
EDRW1:
	POP	AF
	ADD	A,E	;セクタを進める
	LD	E,A
	ADC	A,D
	SUB	E
	LD	D,A
	RET

EADR:
	PUSH	BC
	PUSH	DE
	EX	DE,HL
	ADD	HL,HL
	LD	C,(IX+00DH)	;DPB_0D_MAXSEC
	LD	B,(IX+00CH)	;DPB_0C_MAXCYL
	ADD	HL,BC
	LD	C,(IX+013H)	;DPB_13_UNITNO
	OUT	(C),C
	INC	C
	OUT	(C),L
	INC	C
	OUT	(C),H
	INC	C
	EX	DE,HL
	POP	DE
	LD	B,(IX+00FH)	;DPB_0F_BPS
	POP	AF
EADR1:				;読み込むセクタ数と1クラスタのセクタ数を掛ける
	RR	B
	RET	C
	ADD	A,A
	JR	EADR1
