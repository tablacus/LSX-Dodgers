LSX-Dodgers
メモリマップ

0000-00FF	システムスクラッチエリア
0100-D105	TPA(Transient Program Area)
D106-FFFF	システム領域

システムスクラッチエリア

 $00番地から$FF番地までの領域でシステムとユーザープログラムの橋渡しをする領域といえます
システムコールの飛び先もこの領域にあります。また、コマンドに渡す引数の内容もこの領域に
格納されます。


TPA(Transient Program Area)

 $100番地から始まり、6～7番地の内容が示しているアドレスの1バイト前までがTPAと
呼ばれる領域です。この領域はユーザープログラムで自由に使用することができます。
なお、6～7番地はシステムコールの飛び先を示しています。


システム領域

 TPAより高位のアドレス領域はシステムが使用している領域であり、プログラムが勝手に使っ
てはいけません。


システムスクラッチエリア(MSX-DOSと共通部)

$0000	ウォームブート
$0005	システムコール
$0006	システム領域の開始アドレス(TPAの最終アドレス+1)

$005C	デフォルトのFCB その1
$006C	デフォルトのFCB その2
$0080	デフォルトのDTA

	※外部コマンドを実行した際
	$5Cより:1つ目のパラメータをファイル名として加工 *1
	$6Cより:2つ目のパラメータをファイル名として加工 *1
	$80	 :コマンドラインの文字数
	$81より:コマンドラインの内容

*1	格納形式はFCBと同形式のドライブ番号(1バイト)+ファイル名(8バイト)+拡張子(3バイト)


NMIは$0066がデフォルトのFCBと重なるため使用できません。


システムスクラッチエリア(MSX-DOSと異なる部分)

$0003	機種ID(最上位ビットはDPBレベル)
$0004	LSX-Dodgers ID(LDの場合$1Dが格納される)
$000B	システムコールテーブル&システムワークの上位アドレス
$000F	JP (HL)
$0018	BIOS-ROM呼び出し(X1turboシリーズのみ)
$0038	ウォームブート
$0057	外部コマンドを実行したドライブ
$0058	外部コマンドを実行したパス

機種ID	X1:0	(最上位ビットはDPBがLAと同じ場合に1)



BIOS-ROM呼び出し

 BCレジスタにBIOS-ROMのコールアドレスを入れてコール(RST 18H)する。
 turboBASICやturboSWORD等と同じ。


システム領域

CB00-D105	イニシャルプログラム(起動後はTPAとなる)
D106-EEFF	LD本体+コマンドシェル
EF00-EFFF BIOS互換コールテーブル+システムワークエリア
F000-F0FF	システムコールテーブル+システムワークエリア
F100-F1FF	ドライブパラメータブロック(DPB)(A:～H:)
F200-F9FF	FATバッファ(2KB)
FA00-FDFF	データバッファ(1KB)
FE00-FEFF	先行キー入力バッファ
FF00-FFFF	1行入力キーバッファ&スタックエリア

データバッファはLSX-Dodgersが扱える最大のセクタサイズの1KB


注意

 LSX-Dodgersには簡単な遅廷書き込みを採用しているのでFATバッファやデータバッファの内容を
破壊した場合ディスクに影響が出ます。
システムコールの$0D	ディスクリセット(_DSKRST)を使うとバッファをフラッシュします。

eof
