・LSX-Dodgers
・メモリマップ

0000-00FF	システム・スクラッチ・エリア
0100-CC05	TPA(Transient Program Area)
CC06-FFFF	システム領域

・システム・スクラッチ・エリア

 $00番地から$FF番地までの領域でシステムとユーザー・プログラムの橋渡しをする領域といえます
システム・コールの飛び先もこの領域にあります。また、コマンドに渡す引数の内容もこの領域に
格納されます。


・TPA(Transient Program Area)

 $100番地から始まり、6～7番地の内容が示しているアドレスの1バイト前までがTPAと
呼ばれる領域です。この領域はユーザー・プログラムで自由に使用することができます。
なお、6～7番地はシステム・コールの飛び先を示しています。


・システム領域

 TPAより高位のアドレス領域はシステムが使用している領域であり、プログラムが勝手に使っ
てはいけません。


・システム・スクラッチ・エリア(MSX-DOSと共通部)

$0000	ウォーム・ブート
$0005	システム・コール
$0006	システム領域の開始アドレス(TPAの最終アドレス+1)

$005C	デフォルトのFCB その1
$006C	デフォルトのFCB その2
$0080	デフォルトのDTA

	※外部コマンドを実行した際
	$5Cより:1つ目のパラメータをファイル名として加工 *1
	$6Cより:2つ目のパラメータをファイル名として加工 *1
	$80	 :コマンドラインの文字数
	$81より:コマンドラインの内容

*1	格納形式はFCBと同形式のドライブ番号(1バイト)+ファイル名(8バイト)+拡張子(3バイト)


NMIは$0066がデフォルトのFCBと重なるため使用できません。


・システム・スクラッチ・エリア(MSX-DOSと異なる部分)

$0003	機種ID(最上位ビットはDPBレベル)
$0004	LSX-Dodgers ID(LDの場合$1Dが格納される)
$000B	システム・コール・テーブル&システム・ワークの上位アドレス
$000F	JP (HL)
$0018	BIOS-ROM呼び出し(X1turboシリーズのみ)
$0038	ウォーム・ブート
$0057	外部コマンドを実行したドライブ
$0058	外部コマンドを実行したパス
$005A	LDのバージョン(BCDで格納)

機種ID	X1:$80	(最上位ビットはDPBレベル)



・BIOS-ROM呼び出し

 BCレジスタにBIOS-ROMのコール・アドレスを入れてコール(RST 18H)する。
 turboBASICやturboSWORD等と同じ。


・システム領域

C600-CC05	イニシャル・プログラム(起動後はTPAとなる)
CC06-EBFF	LD本体+コマンド・シェル
EC00-EC7F	システム・コール・テーブル
EC80-ECFF	システム・ワーク・エリア
ED00-EDFF	ドライブ・パラメータ・ブロック(DPB)(A:～H:)
EE00-F9FF	FATバッファ
FA00-FDFF	データ・バッファ
FE00-FEFF	先行キー入力バッファ
FF00-FFFF	1行入力キーバッファ&スタック・エリア

データ・バッファはLSX-Dodgersが扱える最大のセクタサイズの1KB
FATバッファはその3セクタ分で3KB
FAT12の最大サイズは6KBなので半分に分けてアクセスしている。
2HD(1.25MB)を無視してセクタサイズを512バイトに限定すればそれぞれ半分にできそうな気がする。
FATは4分割してアクセス。
FAT12は3クラスタ分で2バイトという困った仕様なのでバッファサイズがセクタサイズの3の倍数じゃないと扱うのが難しい。
逆にFAT16なら1セクタで分けることもできると思う。
今はこんなの気にせずバンクメモリを使って全部読み込む方が良いかもとも思う。

・注意

 LSX-Dodgersには簡単な遅廷書き込みを採用しているのでFATバッファやデータバッファの内容を
破壊した場合ディスクに影響が出ます。

eof
