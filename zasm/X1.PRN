			  Z80 ASSEMBLER - ZASM VER 1.6
                      	;	LSX-Dodgers for X1/turbo/Z
                      	;	Programmed by
                      	;	Gaku (Lovers/Tablacus)
                      	;X1DEF.ASM
                      	
                      	;	LSX-Dodgers DEF
                      	;	X1/turbo/Z
                      	
  0000                	MAC	EQU	0		;X1
  0001                	VER_1   EQU	1
  0004                	VER_2   EQU	4
  0004                	VER_3   EQU	4
                      	
  CB00                	RUN	EQU	0CB00H
  D106                	BDOS	EQU	0D106H
  EF00                	WORKAD	EQU	0EF00H
  F200                	FATBF	EQU	0F200H
  FA00                	DTBUF	EQU	0FA00H
  FE00                	KEYBF	EQU	0FE00H
  FF00                	KBUF	EQU	0FF00H
  FFCA                	EXTSP	EQU	0FFCAH
  FFD9                	TRAP38	EQU	0FFD9H
  0050                	WIDTH	EQU	80
  0018                	LINE	EQU	24
  0007                	COLORF	EQU	7
  0009                	COMS	EQU	9
                      	
                      	
                      	;LDDEF.ASM
                      	
                      	;	LSX-Dodgers DEF
                      	
  1D00                	MACW	EQU	MAC + 01D00H	;機種フラグとLD判別フラグ
  0000                	MACD	EQU	MAC + 00000H	;機種フラグとデバイスフラグ
  0148                	VER	EQU	VER_1 * 256 + VER_2 * 17 + VER_3
                      	
  0005                	SYSTEM	EQU	00005H
  000F                	JP_HL	EQU	0000FH
  005C                	FCB1	EQU	0005CH
  006C                	FCB2	EQU	0006CH
  005D                	FCB1FN	EQU	FCB1+1
  006D                	FCB2FN	EQU	FCB2+1
  0080                	DTA1	EQU	00080H
                      	
  FFCA                	EXTBIO	EQU	0FFCAH
                      	
                      	
                      	
  CAF9                		ORG	RUN-7
                      	
                      	;	MSX BINARY HEADER
  CAF9  FE            		DB	0FEH
                      	;	MSX BINARY START ADDRESS
  CAFA  00CB          		DW	RUN
                      	;	MSX BINARY END ADDRESS
  CAFC  00F2          		DW	LAST_ADR
                      	;	MSX BINARY EXEC ADDRESS
  CAFE  04CB          		DW	START
                      	;X1INIT.ASM
                      	
                      	;	LSX-Dodgers INIT
                      	;	X1/turbo/Z
                      	
  CB00  001D          		DW	MACW
  CB02  4801          		DW	VER
                      	
  CB04                	START:
  CB04  F3            		DI
  CB05  ED5E          		IM	2
  CB07  31CAFF        		LD	SP,EXTSP
  CB0A  CD18CB        		CALL	INIT		;NZならAUTOEXECを実行
  CB0D  210000        		LD	HL,0
  CB10  E5            		PUSH	HL
  CB11  C8            		RET	Z
  CB12  11B4CE        		LD	DE,AUTOD
  CB15  C3FDEF        		JP	_COMANL
                      	
  CB18                	INIT:
  CB18  3E1E          		LD	A,01EH
  CB1A  D300          		OUT	(0),A
                      	
  CB1C  010000        		LD	BC,0
  CB1F  ED438CEF      		LD	(_CTC),BC
  CB23  01040A        		LD	BC,00A04H
  CB26  CD5ECE        		CALL	CHKCTC
  CB29  010407        		LD	BC,00704H
  CB2C  CD5ECE        		CALL	CHKCTC
  CB2F  01A81F        		LD	BC,01FA8H
  CB32  CD5ECE        		CALL	CHKCTC
  CB35  01A01F        		LD	BC,01FA0H
  CB38  CD5ECE        		CALL	CHKCTC
                      	;
  CB3B                	INISIO:
  CB3B  01911F        		LD	BC,01F91H	;INIT SIO
  CB3E  1601          		LD	D,1
  CB40  ED51          		OUT	(C),D
                      	
  CB42  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  CB44  0E93          		LD	C,093H
  CB46  ED51          		OUT	(C),D
  CB48  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  CB4A  0E99          		LD	C,099H		;INIT SIO
  CB4C  1601          		LD	D,1
  CB4E  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  CB50  0E9B          		LD	C,09BH
  CB52  ED51          		OUT	(C),D
  CB54  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
                      	
  CB56  0E80          		LD	C,080H		;INIT DMA
  CB58  2106C3        		LD	HL,0C306H
  CB5B                	INIDMA:
  CB5B  ED61          		OUT	(C),H
  CB5D  2D            		DEC	L
  CB5E  20FB          		JR	NZ,INIDMA
                      	
  CB60  3EE4          		LD	A,0E4H
  CB62  CD40DF        		CALL	COMOUT
  CB65  AF            		XOR	A
  CB66  CD1ADF        		CALL	OT49SB
                      	
  CB69  3EEF          		LD	A,INTVEC/256
  CB6B  ED47          		LD	I,A
                      	
  CB6D  ED4B8CEF      		LD	BC,(_CTC)
  CB71  0B            		DEC	BC
  CB72  0B            		DEC	BC
                      	
  CB73  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  CB75  3EC0          		LD	A,CTC0
  CB77  ED79          		OUT	(C),A
                      	
  CB79  0C            		INC	C
  CB7A  3E47          		LD	A,047H
  CB7C  ED79          		OUT	(C),A
  CB7E  3E0D          		LD	A,13		;Baudrate 9600-13
  CB80  ED79          		OUT	(C),A
                      	
  CB82  79            		LD	A,C
  CB83  D610          		SUB	010H
  CB85  4F            		LD	C,A
                      	;	LD	(SIOAD+1),BC
                      	;	LD	(SIOAD0+1),BC
                      	;	LD	(SIOAD1+1),BC
                      	
  CB86  2104CF        		LD	HL,SIODATA
  CB89                	SINIT1:
  CB89  7E            		LD	A,(HL)
  CB8A  23            		INC	HL
  CB8B  FEFF          		CP	0FFH
  CB8D  2804          		JR	Z,SINIT2
  CB8F  ED79          		OUT	(C),A
  CB91  18F6          		JR	SINIT1
  CB93                	SINIT2:
  CB93  3EE4          		LD	A,0E4H
  CB95  CD40DF        		CALL	COMOUT
  CB98  3EC8          		LD	A,INTVEC
  CB9A  CD1ADF        		CALL	OT49SB
                      	;
  CB9D  01C41F        		LD	BC,01FC4H
  CBA0  3E0C          		LD	A,00CH
  CBA2  ED79          		OUT	(C),A
                      	
  CBA4  0EC0          		LD	C,0C0H
  CBA6  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
                      	
  CBA8  0C            		INC	C
  CBA9  3E28          		LD	A,40
  CBAB  ED79          		OUT	(C),A
                      	
  CBAD  0C            		INC	C
  CBAE  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
                      	
  CBB0  0C            		INC	C
  CBB1  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
                      	
  CBB3  0EC5          		LD	C,0C5H
  CBB5  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
                      	
  CBB7                	TEXT:
  CBB7  0EB0          		LD	C,0B0H
  CBB9  3E80          		LD	A,080H
  CBBB  ED79          		OUT	(C),A
  CBBD  1607          		LD	D,7
  CBBF  0EB9          		LD	C,0B9H
  CBC1  21FDCE        		LD	HL,TEXTDT
  CBC4                	TEXT1:
  CBC4  04            		INC	B
  CBC5  EDA3          		OUTI
  CBC7  0C            		INC	C
  CBC8  15            		DEC	D
  CBC9  20F9          		JR	NZ,TEXT1
  CBCB  01B01F        		LD	BC,01FB0H
  CBCE  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
                      	
  CBD0  0EC4          		LD	C,0C4H
  CBD2  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
                      	
  CBD4  01011A        		LD	BC,01A01H
  CBD7  ED78          		IN	A,(C)
  CBD9  E608          		AND	8
  CBDB  2809          		JR	Z,PRN
  CBDD  0E03          		LD	C,003H
  CBDF  3E0F          		LD	A,00FH
  CBE1  ED79          		OUT	(C),A
  CBE3  01040A        		LD	BC,00A04H
  CBE6                	PRN:
  CBE6  210000        		LD	HL,0
  CBE9  065C          		LD	B,05CH
  CBEB  3EFF          		LD	A,0FFH		;RST 38H
  CBED  CD96E1        		CALL	FILL_MEMORY
  CBF0  06A4          		LD	B,0A4H
  CBF2  AF            		XOR	A
  CBF3  CD96E1        		CALL	FILL_MEMORY
                      	
  CBF6  3EC3          		LD	A,0C3H		;JP
  CBF8  2103EF        		LD	HL,CPM_WBOOT
  CBFB  320000        		LD	(00000H),A
  CBFE  220100        		LD	(00001H),HL	;IPL
                      	
  CC01  21001D        		LD	HL,MACW	;3 bit7  DPB Compatible LA(1)
  CC04  220300        		LD	(00003H),HL	;  bit6-0 Machine X1(0)
                      	;				;4 LSX-Dodgers(01DH)
  CC07  2106D1        		LD	HL,BDOS
  CC0A  320500        		LD	(00005H),A
  CC0D  220600        		LD	(00006H),HL	;BDOS
                      	
  CC10  211ADB        		LD	HL,BIOS
  CC13  221900        		LD	(00019H),HL	;BIOS-ROM
                      	
  CC16  21D9FF        		LD	HL,TRAP38	;TRAP38
  CC19  323800        		LD	(00038H),A
  CC1C  223900        		LD	(00039H),HL	;RST 038H
                      	
  CC1F  3EEF          		LD	A,CPM_BOOT/256
  CC21  320B00        		LD	(0000BH),A
                      	
  CC24  3EE9          		LD	A,0E9H		;JP (HL)
  CC26  320F00        		LD	(0000FH),A
                      	
  CC29  3A7DF0        		LD	A,(_FATBF+1)
  CC2C  321300        		LD	(00013H),A
                      	
  CC2F  3A7FF0        		LD	A,(_DTBUF+1)
  CC32  321700        		LD	(00017H),A
                      	
  CC35  3EFE          		LD	A,KEYBF/256
  CC37  321B00        		LD	(0001BH),A
                      	
  CC3A  3EFF          		LD	A,KBUF/256
  CC3C  321F00        		LD	(0001FH),A
                      	
  CC3F  214801        		LD	HL,VER
  CC42  225A00        		LD	(0005AH),HL
                      	
  CC45  3EE6          		LD	A,0E6H
  CC47  CD40DF        		CALL	COMOUT
  CC4A  CD25DF        		CALL	IN49SB
  CC4D  F5            		PUSH	AF
  CC4E  CD25DF        		CALL	IN49SB
  CC51  F1            		POP	AF
  CC52  F5            		PUSH	AF
  CC53  E612          		AND	012H
  CC55  2005          		JR	NZ,KEYR
  CC57  3E01          		LD	A,1
  CC59  32A2CD        		LD	(KEYREP+1),A
  CC5C                	KEYR:
  CC5C  F1            		POP	AF
  CC5D  E603          		AND	3
  CC5F  280E          		JR	Z,NON
                      	
  CC61  01D03F        		LD	BC,03FD0H
  CC64  ED49          		OUT	(C),C
  CC66  3E37          		LD	A,037H
  CC68  D3D0          		OUT	(0D0H),A
  CC6A  ED78          		IN	A,(C)
  CC6C  B9            		CP	C
  CC6D  2864          		JR	Z,TURBO
  CC6F                	NON:
  CC6F  2110CF        		LD	HL,AT_SCR1
  CC72  11CADF        		LD	DE,SCR1
  CC75  018F00        		LD	BC,SCRNX-SCR1	;転送先のサイズ確認用
  CC78  018E00        		LD	BC,AT_SCRE-AT_SCR1
  CC7B  EDB0          		LDIR
                      	
  CC7D  219ECF        		LD	HL,AT_WTTRK
  CC80  1136EE        		LD	DE,WTTRK
  CC83  01B900        		LD	BC,DMAE-WTTRK	;転送先のサイズ確認用
  CC86  01B100        		LD	BC,AT_CPUE-AT_WTTRK
  CC89  EDB0          		LDIR
                      	
  CC8B  214FD0        		LD	HL,AT_EDWT
  CC8E  11CCD7        		LD	DE,EDWT
  CC91  014B00        		LD	BC,EMME-EDWT	;転送先のサイズ確認用
  CC94  014600        		LD	BC,AT_EMME-AT_EDWT
  CC97  EDB0          		LDIR
                      	
  CC99  2197EE        		LD	HL,AT_DRD+AT_R
  CC9C  22ECEF        		LD	(_FDRD+1),HL
  CC9F  213CEE        		LD	HL,AT_DWT+AT_R
  CCA2  22EFEF        		LD	(_FDWT+1),HL
  CCA5  21E0D7        		LD	HL,AT_EDRD+AT_RE
  CCA8  2282F1        		LD	(EMMRD),HL
  CCAB  21CCD7        		LD	HL,AT_EDWT+AT_RE
  CCAE  2284F1        		LD	(EMMWR),HL
                      	
  CCB1  3E27          		LD	A,027H			;ノンターボはMFM切り替えを行わない
  CCB3  3212F1        		LD	(DEVICE+012H),A		;Aドライブ
  CCB6  3232F1        		LD	(DEVICE+012H+32),A	;Bドライブ
  CCB9  3252F1        		LD	(DEVICE+012H+32*2),A	;Cドライブ
  CCBC  3272F1        		LD	(DEVICE+012H+32*3),A	;Dドライブ
                      	
  CCBF  210000        		LD	HL,0
  CCC2  226BDF        		LD	(X1PAT),HL
                      	
  CCC5  3EAF          		LD	A,0AFH		;XOR	A
  CCC7  3288DD        		LD	(X1KPAT),A
                      	
  CCCA  2159E0        		LD	HL,SCRNX
  CCCD  22D1EF        		LD	(_SCRN+1),HL
                      	
  CCD0  C359CD        		JP	NOBANK
                      	
  CCD3                	TURBO:
  CCD3  F3            		DI			;Check BIOS
  CCD4  061D          		LD	B,01DH
  CCD6  ED79          		OUT	(C),A		;BIOS ON
  CCD8  3A512F        		LD	A,(02F51H)
  CCDB  04            		INC	B		;B=01EH
  CCDC  ED79          		OUT	(C),A		;BIOS OFF
  CCDE  FB            		EI
  CCDF  FEC9          		CP	0C9H
  CCE1  280D          		JR	Z,BIOSOK
  CCE3  3EAF          		LD	A,0AFH		;XOR	A
  CCE5  3288DD        		LD	(X1KPAT),A
  CCE8  2159E0        		LD	HL,SCRNX
  CCEB  22D1EF        		LD	(_SCRN+1),HL
  CCEE  1805          		JR	NOBIOS
  CCF0                	BIOSOK:
  CCF0  3EC3          		LD	A,0C3H		;JP
  CCF2  321800        		LD	(00018H),A
  CCF5                	NOBIOS:
  CCF5  3E1F          		LD	A,01FH		;スタートポート
  CCF7  DBF0          		IN	A,(0F0H)
  CCF9  0F            		RRCA
  CCFA  380B          		JR	C,CRT1
  CCFC  21EDCE        		LD	HL,_C8025H
  CCFF  11B0EF        		LD	DE,CRTCD
  CD02  011000        		LD	BC,16
  CD05  EDB0          		LDIR
  CD07                	CRT1:
  CD07  3E1F          		LD	A,01FH		;スタートポート
  CD09  DBF0          		IN	A,(0F0H)
  CD0B  CB57          		BIT	2,A
  CD0D  2818          		JR	Z,BANK
                      	
  CD0F  AF            		XOR	A
  CD10                	TZ1:				;前面スイッチが2HDの場合はMFMモードを2HDにしておく
  CD10  F5            		PUSH	AF
  CD11  CDDCEF        		CALL	_GETDPB
  CD14  DD7E12        		LD	A,(IX+012H)	;DPB_12_DEVICE
  CD17  E68F          		AND	08FH
  CD19  FE87          		CP	087H		;フロッピーでMEM切り替えがON
  CD1B  2004          		JR	NZ,TZ2
  CD1D  DDCB0A86      		RES	0,(IX+0AH)	;(DPB_0A_FDMODE)
  CD21                	TZ2:
  CD21  F1            		POP	AF
  CD22  3C            		INC	A
  CD23  FE08          		CP	8
  CD25  38E9          		JR	C,TZ1
                      	
  CD27                	BANK:
  CD27  01000B        		LD	BC,00B00H
  CD2A  21007F        		LD	HL,07F00H
  CD2D  F3            		DI
  CD2E                	BANK1:
  CD2E  ED69          		OUT	(C),L
  CD30  5E            		LD	E,(HL)
  CD31  7B            		LD	A,E
  CD32  C6A5          		ADD	A,0A5H
  CD34  77            		LD	(HL),A
  CD35  BE            		CP	(HL)
  CD36  73            		LD	(HL),E
  CD37  2005          		JR	NZ,BANK2
  CD39  2C            		INC	L
  CD3A  CB65          		BIT	4,L
  CD3C  28F0          		JR	Z,BANK1
  CD3E                	BANK2:
  CD3E  3E10          		LD	A,010H
  CD40  ED79          		OUT	(C),A
  CD42  7D            		LD	A,L
  CD43  B7            		OR	A
  CD44  2813          		JR	Z,NOBANK
  CD46  2600          		LD	H,0
  CD48  29            		ADD	HL,HL	;*2
  CD49  29            		ADD	HL,HL	;*4
  CD4A  29            		ADD	HL,HL	;*8
  CD4B  29            		ADD	HL,HL	;*16
  CD4C  29            		ADD	HL,HL	;*32
  CD4D  2B            		DEC	HL	;-1
  CD4E  2B            		DEC	HL	;-2
  CD4F  2B            		DEC	HL	;-3
  CD50  22A8F1        		LD	(BANKCL),HL
  CD53  CDA4CE        		CALL	CALC_FATLN
  CD56  32A0F1        		LD	(BANKFL),A
  CD59                	NOBANK:
  CD59                	EMM:
  CD59  DD2180F1      		LD	IX,EMMFL
  CD5D  CD55CE        		CALL	EADR0
  CD60  ED78          		IN	A,(C)
  CD62  F5            		PUSH	AF
                      	
  CD63  110000        		LD	DE,0
  CD66                	ECHECK1:
  CD66  13            		INC	DE
  CD67  CD39CE        		CALL	EADR2
  CD6A  ED60          		IN	H,(C)
  CD6C  CD39CE        		CALL	EADR2
  CD6F  7C            		LD	A,H
  CD70  C6E5          		ADD	A,0E5H
  CD72  ED79          		OUT	(C),A
  CD74  3C            		INC	A
  CD75  CD55CE        		CALL	EADR0
  CD78  ED79          		OUT	(C),A
  CD7A  3D            		DEC	A
  CD7B  CD39CE        		CALL	EADR2
  CD7E  ED68          		IN	L,(C)
  CD80  CD39CE        		CALL	EADR2
  CD83  ED61          		OUT	(C),H
  CD85  BD            		CP	L
  CD86  2004          		JR	NZ,ECHECK2
  CD88  CB5A          		BIT	3,D
  CD8A  28DA          		JR	Z,ECHECK1
  CD8C                	ECHECK2:
  CD8C  CD55CE        		CALL	EADR0
  CD8F  F1            		POP	AF
  CD90  ED79          		OUT	(C),A
                      	
  CD92  21F7FF        		LD	HL,0-9
  CD95  19            		ADD	HL,DE
  CD96  3009          		JR	NC,NOEMM
  CD98  2288F1        		LD	(EMMCL),HL
  CD9B  CDA4CE        		CALL	CALC_FATLN
  CD9E  3280F1        		LD	(EMMFL),A
  CDA1                	NOEMM:
  CDA1  3E00          	KEYREP:	LD	A,000H
  CDA3  B7            		OR	A
  CDA4  2807          		JR	Z,KEYR1
  CDA6  010000        		LD	BC,0
  CDA9  ED438CEF      		LD	(_CTC),BC
  CDAD                	KEYR1:
  CDAD  CD85CE        		CALL	SETCRTC
  CDB0  01AA10        		LD	BC,010AAH	;PALET
  CDB3  ED49          		OUT	(C),C
  CDB5  01CC11        		LD	BC,011CCH
  CDB8  ED49          		OUT	(C),C
  CDBA  01F012        		LD	BC,012F0H
  CDBD  ED49          		OUT	(C),C
  CDBF  04            		INC	B
  CDC0  ED71          		DB	0EDH,071H
                      	
  CDC2  0130F8        		LD	BC,0-80*25
  CDC5  2ABAEF        		LD	HL,(CRTCD+10)
  CDC8  ED43BAEF      		LD	(CRTCD+10),BC
  CDCC  1E0C          		LD	E,00CH
  CDCE  CDCDEF        		CALL	_PRINT
  CDD1  22BAEF        		LD	(CRTCD+10),HL
                      	
  CDD4  21C0CE        		LD	HL,INIMES
  CDD7  CD6ED8        		CALL	MSX
                      	
  CDDA  3A87FF        		LD	A,(0FF87H)
  CDDD  FE08          		CP	8
  CDDF  301E          		JR	NC,INIT0
  CDE1  5F            		LD	E,A
  CDE2  C641          		ADD	A,'A'
  CDE4  32BDCE        		LD	(AUTODV),A
  CDE7  0E0E          		LD	C,00EH
  CDE9  CD0500        		CALL	SYSTEM
  CDEC  1C            		INC	E
  CDED  2185EF        		LD	HL,_SEEKSP	;Disk error Ignore
  CDF0  CBFE          		SET	7,(HL)
  CDF2  0E1B          		LD	C,01BH
  CDF4  CD0500        		CALL	SYSTEM
                      	
  CDF7  2185EF        		LD	HL,_SEEKSP
  CDFA  CBBE          		RES	7,(HL)
                      	
  CDFC  3C            		INC	A
  CDFD  2008          		JR	NZ,INIT1
  CDFF                	INIT0:
  CDFF  1E00          		LD	E,0
  CE01  0E0E          		LD	C,00EH
  CE03  CD0500        		CALL	SYSTEM
  CE06  AF            		XOR	A
  CE07                	INIT1:
  CE07  F3            		DI
  CE08  08            		EX	AF,AF'
  CE09  2EFE          		LD	L,0-2		;CALLのスタック分減らす
  CE0B  39            		ADD	HL,SP
  CE0C  1100FF        		LD	DE,0FF00H
  CE0F  45            		LD	B,L
  CE10  CD05D5        		CALL	ZERO_MEMORY_DE
  CE13  21CAFF        		LD	HL,EXTSP
  CE16  060F          		LD	B,TRAP38-EXTBIO
  CE18  3EFF          		LD	A,0FFH		;RST 38H
  CE1A  CD96E1        		CALL	FILL_MEMORY
  CE1D  2195D0        		LD	HL,AT_TRAP38
  CE20  11D9FF        		LD	DE,TRAP38
  CE23  012700        		LD	BC,AT_TRAPE-AT_TRAP38
  CE26  EDB0          		LDIR
  CE28  08            		EX	AF,AF'
  CE29  B7            		OR	A
  CE2A  C8            		RET	Z
                      	
  CE2B  3EE6          		LD	A,0E6H
  CE2D  CD40DF        		CALL	COMOUT
  CE30  CD25DF        		CALL	IN49SB
  CE33  CD25DF        		CALL	IN49SB
  CE36  FE1B          		CP	01BH
  CE38  C9            		RET
                      	
  CE39                	EADR2:
  CE39  D5            		PUSH	DE
  CE3A  EB            		EX	DE,HL
  CE3B  29            		ADD	HL,HL
  CE3C  29            		ADD	HL,HL
  CE3D  DD4E0D        		LD	C,(IX+00DH)	;DPB_0D_MAXSEC
  CE40  DD460C        		LD	B,(IX+00CH)	;DPB_0C_MAXCYL
  CE43  09            		ADD	HL,BC
  CE44  DD4E13        		LD	C,(IX+013H)	;DPB_13_UNITNO
  CE47  060D          		LD	B,00DH
  CE49  ED49          		OUT	(C),C
  CE4B  0C            		INC	C
  CE4C  ED69          		OUT	(C),L
  CE4E  0C            		INC	C
  CE4F  ED61          		OUT	(C),H
  CE51  0C            		INC	C
  CE52  EB            		EX	DE,HL
  CE53  D1            		POP	DE
  CE54  C9            		RET
                      	
  CE55                	EADR0:
  CE55  D5            		PUSH	DE
  CE56  110000        		LD	DE,0
  CE59  CD39CE        		CALL	EADR2
  CE5C  D1            		POP	DE
  CE5D  C9            		RET
                      	
  CE5E                	CHKCTC:
  CE5E  C5            		PUSH	BC
  CE5F  110347        		LD	DE,04703H
  CE62                	INICTC1:
  CE62  0C            		INC	C
  CE63  ED51          		OUT	(C),D
  CE65  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  CE67  1D            		DEC	E
  CE68  20F8          		JR	NZ,INICTC1
  CE6A  C1            		POP	BC
                      	
  CE6B  11FA07        		LD	DE,007FAH
  CE6E  ED51          		OUT	(C),D
  CE70  ED59          		OUT	(C),E
  CE72  ED78          		IN	A,(C)
  CE74  BB            		CP	E
  CE75  C0            		RET	NZ
  CE76  ED51          		OUT	(C),D
  CE78  ED51          		OUT	(C),D
  CE7A  ED78          		IN	A,(C)
  CE7C  BA            		CP	D
  CE7D  C0            		RET	NZ
  CE7E  03            		INC	BC
  CE7F  03            		INC	BC
  CE80  ED438CEF      		LD	(_CTC),BC
  CE84  C9            		RET
                      	
  CE85                	SETCRTC:
  CE85  21B0EF        		LD	HL,CRTCD
  CE88  AF            		XOR	A
  CE89                	SETCRT1:
  CE89  010018        		LD	BC,01800H
  CE8C  ED79          		OUT	(C),A
  CE8E  0C            		INC	C
  CE8F  04            		INC	B
  CE90  EDA3          		OUTI
  CE92  3C            		INC	A
  CE93  FE0C          		CP	12
  CE95  20F2          		JR	NZ,SETCRT1
  CE97  23            		INC	HL
  CE98  23            		INC	HL
  CE99  01031B        		LD	BC,01A03H+00100H
  CE9C  EDA3          		OUTI
  CE9E  01D020        		LD	BC,01FD0H+00100H
  CEA1  EDA3          		OUTI
  CEA3  C9            		RET
                      	
  CEA4                	CALC_FATLN:	;FAT12のクラスタ数から必要なFATサイズを求める(セクタサイズ512)
  CEA4  5D            		LD	E,L
  CEA5  54            		LD	D,H
  CEA6  29            		ADD	HL,HL	;*2
  CEA7  19            		ADD	HL,DE	;*3
  CEA8  CB3C          		SRL	H	;/2
  CEAA  CB1D          		RR	L	;1クラスタ辺り1.5バイト必要
  CEAC  11FF01        		LD	DE,511	;切り上げる
  CEAF  19            		ADD	HL,DE
  CEB0  7C            		LD	A,H
  CEB1  CB3F          		SRL	A
  CEB3  C9            		RET
                      	
  CEB4  4155544F455845	AUTOD:	DB	"AUTOEXEC "
  CEBD  413A00        	AUTODV:	DB	"A:",0
                      	
  CEC0  4C53582D446F64	INIMES:	DB	"LSX-Dodgers for X1/turbo version "
  CEE1  312E          		DB	030H + VER_1, '.'
  CEE3  3434          		DB	030H + VER_2 ,030H + VER_3
  CEE5  2047616B750D0A		DB	' Gaku',0DH,0AH
  CEEC  00            		DB	0
                      	
  CEED                	_C8025H:
  CEED  6B5059881B0119		DB	06BH,050H,059H,088H,01BH,001H,019H,01AH
  CEF5  000F          		DB	000H,00FH
  CEF7  80F8B0FF      		DW	0-80*LINE,0-80
  CEFB  0C23          		DB	00CH,023H
                      	
  CEFD  030C0F30333C3F	TEXTDT:	DB	003H,00CH,00FH,030H,033H,03CH,03FH
                      	
  CF04                	SIODATA:
  CF04  18            		DB	018H
  CF05  0100          		DB	1,0
  CF07  0200          		DB	2,0
  CF09  03C1          		DB	3,0C1H
  CF0B  0444          		DB	4,044H
  CF0D  05E8          		DB	5,0E8H
  CF0F  FF            		DB	0FFH
                      	
                      	;	ノンターボ用パッチ
                      	
  CF10                	AT_SCR1:
  CF10  D9            		EXX
  CF11  C5            		PUSH	BC
  CF12  ED4BB1EF      		LD	BC,(CRTCD+1)
  CF16  0620          		LD	B,020H
  CF18  D9            		EXX
  CF19  C5            		PUSH	BC
  CF1A  010020        		LD	BC,02000H
                      	
  CF1D  67            		LD	H,A
  CF1E  B7            		OR	A
  CF1F                	AT_SCRUP1:
  CF1F  2815          		JR	Z,AT_SCRCL
  CF21  C5            		PUSH	BC
  CF22  CBE0          		SET	4,B
  CF24  D9            		EXX
  CF25  C5            		PUSH	BC
  CF26  CBE0          		SET	4,B
  CF28  D9            		EXX
  CF29  CDFBDF        		CALL	AT_UPSUB+AT_RS
  CF2C  D9            		EXX
  CF2D  C1            		POP	BC
  CF2E  D9            		EXX
  CF2F  C1            		POP	BC
  CF30  CDFBDF        		CALL	AT_UPSUB+AT_RS
  CF33  25            		DEC	H
  CF34  18E9          		JR	AT_SCRUP1
                      	
  CF36                	AT_SCRCL:
  CF36  2AB1EF        		LD	HL,(CRTCD+1)
  CF39  CD91DE        		CALL	LINECL
  CF3C  C1            		POP	BC
  CF3D  D9            		EXX
  CF3E  C1            		POP	BC
  CF3F  D9            		EXX
  CF40  C9            		RET
                      	
  CF41                	AT_UPSUB:
  CF41  3AB1EF        		LD	A,(CRTCD+1)
  CF44  6F            		LD	L,A
  CF45                	AT_UPSUB1:
  CF45  D9            		EXX
  CF46  ED78          		IN	A,(C)
  CF48  03            		INC	BC
  CF49  D9            		EXX
  CF4A  ED79          		OUT	(C),A
  CF4C  03            		INC	BC
  CF4D  2D            		DEC	L
  CF4E  20F5          		JR	NZ,AT_UPSUB1
  CF50  C9            		RET
                      	
                      	;	FLOPPY DISK DRIVER(CPU)
                      	
  CF51                	DISKC:
  CF51  1B            		DEC	DE
  CF52  CB5F          		BIT	3,A
  CF54  C42FEE        		CALL	NZ,RNF
  CF57                	DISKD:
  CF57  E5            		PUSH	HL
  CF58  2135EE        		LD	HL,RETRY
  CF5B  35            		DEC	(HL)
  CF5C  E1            		POP	HL
  CF5D  203C          		JR	NZ,AT_ERR		;Retry
  CF5F  B7            		OR	A
  CF60  2839          		JR	Z,AT_ERR		;Error
                      	
  CF62                	AT_DELP:
  CF62  CD2FEE        		CALL	RNF
  CF65  CD0BEE        		CALL	FDMOFF
  CF68  3A85EF        		LD	A,(_SEEKSP)
  CF6B  87            		ADD	A,A
  CF6C  382C          		JR	C,AT_ERRZ
  CF6E                	AT_DELP1:
  CF6E  D5            		PUSH	DE
  CF6F  21C0F0        		LD	HL,DEMES
  CF72  CD6ED8        		CALL	MSX
  CF75  CDECDB        		CALL	KEYBC
  CF78                	AT_DELP2:
  CF78  CDCAEF        		CALL	_INKEY
  CF7B  28FB          		JR	Z,AT_DELP2
                      	
  CF7D  D1            		POP	DE
  CF7E  CDF6E3        		CALL	CAP
  CF81  FE52          		CP	'R'		;Retry
  CF83  200A          		JR	NZ,AT_DELP3
  CF85  210000        	DHLPAT:	LD	HL,0
  CF88  3E02          		LD	A,2
  CF8A  3235EE        		LD	(RETRY),A
  CF8D  B7            		OR	A
  CF8E  C9            		RET
  CF8F                	AT_DELP3:
  CF8F  FE49          		CP	'I'		;Ignore
  CF91  2805          		JR	Z,AT_IGNORE
  CF93  FE41          		CP	'A'		;Abort
  CF95  20D7          		JR	NZ,AT_DELP1
  CF97  C7            		RST	0
  CF98                	AT_IGNORE:
  CF98  3EFF          		LD	A,0FFH
  CF9A                	AT_ERRZ:
  CF9A  BF            		CP	A
  CF9B                	AT_ERR:
  CF9B  3EFF          		LD	A,0FFH
  CF9D  C9            		RET
                      	
  CF9E                	AT_SCRE:
                      	
  CF9E                	AT_WTTRK:
  CF9E  0601          		LD	B,1
  CFA0  3EF4          		LD	A,0F4H
  CFA2  1802          		JR	AT_WTTRK1
  CFA4                	AT_DWT:
  CFA4  3EA0          		LD	A,0A0H
  CFA6                	AT_WTTRK1:
  CFA6  32D3ED        		LD	(FDCPAT+1),A
  CFA9                	DWTBL:
  CFA9  78            		LD	A,B
  CFAA  3282EE        		LD	(AT_WTB+1+AT_R),A
  CFAD  3E02          		LD	A,2		;Retry count
  CFAF  3235EE        		LD	(RETRY),A
                      	
  CFB2                	DWT0:
  CFB2  D5            		PUSH	DE
  CFB3  E5            		PUSH	HL
  CFB4  2240E0        		LD	(DHLPAT+1+AT_RS),HL
  CFB7  CD6DED        		CALL	SEEK		;Write disk
  CFBA  E1            		POP	HL
  CFBB  3838          		JR	C,ERRDW
  CFBD  F3            		DI
  CFBE  3AD3ED        		LD	A,(FDCPAT+1)
  CFC1  CD17EE        		CALL	SECSET
  CFC4  0EFB          		LD	C,0FBH
                      	
  CFC6                	DWT1:
  CFC6  56            		LD	D,(HL)
  CFC7                	DWT2:
  CFC7  78            		LD	A,B
  CFC8  DBF8          		IN	A,(0F8H)
  CFCA  0F            		RRCA
  CFCB  3008          		JR	NC,DWT4
  CFCD  0F            		RRCA
  CFCE  30F7          		JR	NC,DWT2
  CFD0                	DWT3:
  CFD0  ED51          		OUT	(C),D
  CFD2  23            		INC	HL
  CFD3  18F1          		JR	DWT1
                      	
  CFD5                	DWT4:
  CFD5  3D            		DEC	A
  CFD6  28F8          		JR	Z,DWT3
  CFD8  3C            		INC	A
  CFD9  FB            		EI
  CFDA  D1            		POP	DE
  CFDB  13            		INC	DE
  CFDC  CD0BEE        		CALL	FDMOFF
  CFDF  2808          		JR	Z,DISKOK_WT
  CFE1  CD0BE0        		CALL	DISKC+AT_RS
  CFE4  20CC          		JR	NZ,DWT0
  CFE6  B7            		OR	A
  CFE7  2005          		JR	NZ,ERRW
                      	
  CFE9                	DISKOK_WT:
  CFE9  0601          	AT_WTB:	LD	B,1
  CFEB  10BC          		DJNZ	DWTBL
  CFED  C9            		RET
                      	
  CFEE                	ERRW:
  CFEE  3EFF          		LD	A,0FFH
  CFF0                	ERRZ:
  CFF0  BF            		CP	A
  CFF1  37            		SCF
  CFF2  C30BEE        		JP	FDMOFF
                      	
  CFF5                	ERRDW:
  CFF5  D1            		POP	DE
  CFF6  CD1CE0        		CALL	AT_DELP+AT_RS
  CFF9  20B7          		JR	NZ,DWT0
  CFFB  B7            		OR	A
  CFFC  20F0          		JR	NZ,ERRW
  CFFE  C9            		RET
                      	
  CFFF                	AT_DRD:
  CFFF  3E80          		LD	A,080H
  D001  32D3ED        		LD	(FDCPAT+1),A
  D004                	DRDBL:
  D004  78            		LD	A,B
  D005  32D9EE        		LD	(AT_RDB+1+AT_R),A
  D008  3E02          		LD	A,2		;Retry count
  D00A  3235EE        		LD	(RETRY),A
  D00D                	DRD0:
  D00D  D5            		PUSH	DE
  D00E  E5            		PUSH	HL
  D00F  2240E0        		LD	(DHLPAT+1+AT_RS),HL
  D012  CD6DED        		CALL	SEEK		;Read disk
  D015  E1            		POP	HL
  D016  382D          		JR	C,ERRDR
  D018  F3            		DI
  D019  3AD3ED        		LD	A,(FDCPAT+1)
  D01C  CD17EE        		CALL	SECSET
  D01F  0EFB          		LD	C,0FBH
  D021                	DRD1:
  D021  78            		LD	A,B
  D022  DBF8          		IN	A,(0F8H)
  D024  0F            		RRCA
  D025  3008          		JR	NC,DRD3
  D027  0F            		RRCA
  D028  30F7          		JR	NC,DRD1
  D02A  EDA2          		INI
  D02C  04            		INC	B
  D02D  18F2          		JR	DRD1
                      	
  D02F                	DRD3:
  D02F  B7            		OR	A
  D030  FB            		EI
  D031  D1            		POP	DE
  D032  13            		INC	DE
  D033  CD0BEE        		CALL	FDMOFF
  D036  2808          		JR	Z,DISKOK_RD
  D038  CD0BE0        		CALL	DISKC+AT_RS
  D03B  20D0          		JR	NZ,DRD0
  D03D  B7            		OR	A
  D03E  20AE          		JR	NZ,ERRW
                      	
  D040                	DISKOK_RD:
  D040  0601          	AT_RDB:	LD	B,1
  D042  10C0          		DJNZ	DRDBL
  D044  C9            		RET
                      	
  D045                	ERRDR:
  D045  D1            		POP	DE
  D046  CD1CE0        		CALL	AT_DELP+AT_RS
  D049  20C2          		JR	NZ,DRD0
  D04B  B7            		OR	A
  D04C  20A0          		JR	NZ,ERRW
  D04E  C9            		RET
                      	
  D04F                	AT_CPUE:
                      	
                      	
                      	;	EMM DRIVER(CPU)
                      	
                      	
  D04F                	AT_EDWT:
  D04F  CDF4D7        		CALL	AT_EADR+AT_RE
  D052                	AT_EDWT0:
  D052  F5            		PUSH	AF
  D053  AF            		XOR	A
  D054                	AT_EDWT1:
  D054  04            		INC	B
  D055  EDA3          		OUTI
  D057  04            		INC	B
  D058  EDA3          		OUTI
  D05A  3D            		DEC	A
  D05B  20F7          		JR	NZ,AT_EDWT1
  D05D  13            		INC	DE
  D05E  F1            		POP	AF
  D05F  3D            		DEC	A
  D060  20F0          		JR	NZ,AT_EDWT0
  D062  C9            		RET
                      	
  D063                	AT_EDRD:
  D063  CDF4D7        		CALL	AT_EADR+AT_RE
  D066                	AT_EDRD0:
  D066  F5            		PUSH	AF
  D067  AF            		XOR	A
  D068                	AT_EDRD1:
  D068  EDA2          		INI
  D06A  04            		INC	B
  D06B  EDA2          		INI
  D06D  04            		INC	B
  D06E  3D            		DEC	A
  D06F  20F7          		JR	NZ,AT_EDRD1
  D071  13            		INC	DE
  D072  F1            		POP	AF
  D073  3D            		DEC	A
  D074  20F0          		JR	NZ,AT_EDRD0
  D076  C9            		RET
                      	
  D077                	AT_EADR:
  D077  C5            		PUSH	BC
  D078  D5            		PUSH	DE
  D079  EB            		EX	DE,HL
  D07A  29            		ADD	HL,HL
  D07B  DD4E0D        		LD	C,(IX+00DH)	;DPB_0D_MAXSEC
  D07E  DD460C        		LD	B,(IX+00CH)	;DPB_0C_MAXCYL
  D081  09            		ADD	HL,BC
  D082  DD4E13        		LD	C,(IX+013H)	;DPB_13_UNITNO
  D085  060D          		LD	B,00DH
  D087  ED49          		OUT	(C),C
  D089  0C            		INC	C
  D08A  ED69          		OUT	(C),L
  D08C  0C            		INC	C
  D08D  ED61          		OUT	(C),H
  D08F  0C            		INC	C
  D090  EB            		EX	DE,HL
  D091  D1            		POP	DE
  D092  F1            		POP	AF
  D093  A7            		AND	A	;CF=0
  D094  C9            		RET
  D095                	AT_EMME:
                      	
  D095                	AT_TRAP38:
  D095  210000        		LD	HL,0
  D098  E3            		EX	(SP),HL
  D099  3E24          		LD	A,'$'
  D09B  CD23DC        		CALL	MSG_A
  D09E  2B            		DEC	HL
  D09F  7C            		LD	A,H
  D0A0  CDE8FF        		CALL	PRHX+AT_RT
  D0A3  7D            		LD	A,L
  D0A4                	PRHX:
  D0A4  F5            		PUSH	AF
  D0A5  07            		RLCA
  D0A6  07            		RLCA
  D0A7  07            		RLCA
  D0A8  07            		RLCA
  D0A9  CDF1FF        		CALL	PRHX2+AT_RT
  D0AC  F1            		POP	AF
  D0AD                	PRHX2:
  D0AD  E60F          		AND	00FH
  D0AF  FE0A          		CP	10
  D0B1  3802          		JR	C,PRHX3
  D0B3  C607          		ADD	A,'A'-'0'-10
  D0B5                	PRHX3:
  D0B5  C630          		ADD	A,'0'
  D0B7  C323DC        		JP	MSG_A
  D0BA                		DS	2
  D0BC                	AT_TRAPE:
                      	
  2F44                	AT_RT	EQU	TRAP38-AT_TRAP38
                      	
  D0BC                	INITE:
  D0BC                		DS	BDOS-INITE
                      	
  D106  C317D8        		JP	BDOS0
                      	
                      	;X1CCP.ASM
                      	
                      	;	LSX-Dodgers CCP
                      	;	X1/turbo/Z
                      	
  D109                	WBOOT1:
  D109  F3            		DI
  D10A  ED7B0600      		LD	SP,(SYSTEM+1)
                      	
  D10E  3EEF          		LD	A,INTVEC/256
  D110  ED47          		LD	I,A
                      	
  D112  3EE4          		LD	A,0E4H
  D114  CD40DF        		CALL	COMOUT
  D117  3EC8          		LD	A,INTVEC
  D119  CD1ADF        		CALL	OT49SB
                      	
  D11C  3ABCEF        		LD	A,(CRTCD+12)
  D11F  B7            		OR	A
  D120  200C          		JR	NZ,SETCRT0
  D122  2180F8        		LD	HL,0-80*LINE
  D125  22BAEF        		LD	(CRTCD+10),HL
  D128  21B0FF        		LD	HL,0-80
  D12B  22BCEF        		LD	(CRTCD+12),HL
  D12E                	SETCRT0:
  D12E  21B0EF        		LD	HL,CRTCD
  D131  AF            		XOR	A
  D132                	SETCRT2:
  D132  010018        		LD	BC,01800H
  D135  ED79          		OUT	(C),A
  D137  0C            		INC	C
  D138  56            		LD	D,(HL)
  D139  FE0D          		CP	13
  D13B  3802          		JR	C,SETCRT3
  D13D  1600          		LD	D,0
  D13F                	SETCRT3:
  D13F  ED51          		OUT	(C),D
  D141  23            		INC	HL
  D142  3C            		INC	A
  D143  FE0E          		CP	14
  D145  20EB          		JR	NZ,SETCRT2
                      	
  D147  01031B        		LD	BC,01A03H+00100H
  D14A  EDA3          		OUTI
  D14C  01D020        		LD	BC,01FD0H+00100H
  D14F  EDA3          		OUTI
  D151  2192EF        		LD	HL,_KEYD
  D154  7E            		LD	A,(HL)
  D155  3600          		LD	(HL),0
  D157  CDE9DB        		CALL	KEYBC_IFBREAK
  D15A  3E04          		LD	A,4
  D15C  CD23DC        		CALL	MSG_A
                      	
                      	;LDCCP.ASM
                      	
                      	;	LSX-Dodgers CCP
                      	
  D15F                	COMMAND:
  D15F  CD12D2        		CALL	SETDTA1
  D162  3A87EF        		LD	A,(_DVSW)
  D165  C641          		ADD	A,'A'
  D167  CD23DC        		CALL	MSG_A
  D16A  3E3E          		LD	A,'>'
  D16C  CD23DC        		CALL	MSG_A
  D16F  3E50          		LD	A,80
  D171  12            		LD	(DE),A
  D172  CD72DC        		CALL	_SYS0A		;(BDOS)文字列入力
  D175  CDC7D3        		CALL	LTNL
                      	
  D178  118200        		LD	DE,DTA1+2
  D17B  CDFDEF        		CALL	_COMANL
  D17E  30DF          		JR	NC,COMMAND
  D180  1179EF        		LD	DE,COMERM
  D183  CD5FD8        		CALL	_SYS09		;(BDOS)文字列出力
  D186  C7            		RST	0
                      	
  D187                	COMANL:
  D187  CDEAE0        		CALL	FILE
  D18A  3A19EF        		LD	A,(FNAME+4)
  D18D  FE20          		CP	020H
  D18F  201C          		JR	NZ,COMB2
  D191  D5            		PUSH	DE
  D192  1115EF        		LD	DE,FNAME
  D195  1A            		LD	A,(DE)
  D196  FE20          		CP	020H
  D198  2844          		JR	Z,SDVSW
  D19A  1B            		DEC	DE
  D19B  1A            		LD	A,(DE)
  D19C  C6FF          		ADD	A,0FFH
  D19E  3809          		JR	C,COMB
  D1A0  13            		INC	DE
                      	
  D1A1  21EED6        		LD	HL,COMTB
  D1A4  0609          		LD	B,COMS
  D1A6  CD6EE3        		CALL	CPNAME
  D1A9                	COMB:
  D1A9  D1            		POP	DE
  D1AA  D20F00        		JP	NC,JP_HL
  D1AD                	COMB2:
  D1AD  EB            		EX	DE,HL
  D1AE  2286D2        		LD	(COMPAT+1),HL
  D1B1  F5            		PUSH	AF
  D1B2  CD32D2        		CALL	CEXE4
  D1B5  F1            		POP	AF
  D1B6  2115EF        		LD	HL,FNAME
  D1B9  116D00        		LD	DE,FCB2+1	;COMMAND NAME
  D1BC  010B00        		LD	BC,11
  D1BF  EDB0          		LDIR
  D1C1  1191D6        		LD	DE,PATHD
  D1C4                	CEX1:
  D1C4  1A            		LD	A,(DE)
  D1C5  FE20          		CP	020H
  D1C7  D8            		RET	C
  D1C8  CDDFE0        		CALL	FILEC
  D1CB  D5            		PUSH	DE
  D1CC  216D00        		LD	HL,FCB2+1	;COMMAND NAME
  D1CF  1115EF        		LD	DE,FNAME
  D1D2  010B00        		LD	BC,11
  D1D5  EDB0          		LDIR
  D1D7  CD32D2        		CALL	CEXE4
  D1DA  D1            		POP	DE
  D1DB  13            		INC	DE
  D1DC  18E6          		JR	CEX1
                      	
  D1DE                	SDVSW:
  D1DE  F1            		POP	AF
  D1DF  3A14EF        		LD	A,(FDRV)
  D1E2  3D            		DEC	A
  D1E3  5F            		LD	E,A
  D1E4  0E0E          		LD	C,00EH		;(BDOS)カレントドライブの設定
  D1E6  1831          		JR	SYSTEM0
                      	
  D1E8                	OPEN1:
  D1E8  2114EF        		LD	HL,FDRV
  D1EB                	OPEN:
  D1EB  0E11          		LD	C,011H		;(BDOS)ファイルの検索
  D1ED                	OPEN3:
  D1ED  D5            		PUSH	DE
  D1EE  116CD6        		LD	DE,DTA_CCP
  D1F1  CD0FD2        		CALL	SETDTA
  D1F4  EB            		EX	DE,HL
  D1F5  CD19D2        		CALL	SYSTEM0
  D1F8  D1            		POP	DE
  D1F9  C9            		RET
                      	
  D1FA                	OPEN2:
  D1FA  0E12          		LD	C,012H
  D1FC  18EF          		JR	OPEN3
                      	
  D1FE                	DEFCB:				;Z=Ok NZ=Error
  D1FE  116CD6        		LD	DE,DTA_CCP
  D201  CD17D2        		CALL	SYSC0F
                      	
  D204  118DD6        		LD	DE,DTA_CCP+33	;(FCB)ランダムレコード
  D207  0604          		LD	B,4
  D209  CD05D5        		CALL	ZERO_MEMORY_DE
  D20C  110001        		LD	DE,00100H
  D20F                	SETDTA:
  D20F  C363DA        		JP	_SYS1A		;(BDOS)DTAの設定
                      	
  D212                	SETDTA1:
  D212  118000        		LD	DE,DTA1
  D215  18F8          		JR	SETDTA
                      	
  D217                	SYSC0F:
  D217  0E0F          		LD	C,00FH		;(BDOS)ファイルのオープン
  D219                	SYSTEM0:
  D219  CD0500        		CALL	SYSTEM
  D21C  B7            		OR	A
  D21D  C9            		RET
                      	
  D21E                	C_CD:
  D21E  0E5A          		LD	C,5AH
  D220  18F7          		JR	SYSTEM0
                      	
  D222                	S27BUF:
  D222  3A0700        		LD	A,(SYSTEM+2)
  D225  3D            		DEC	A
  D226  E6F8          		AND	0F8H
  D228  67            		LD	H,A
  D229  2E00          		LD	L,0
  D22B                	S27DTA:
  D22B  116CD6        		LD	DE,DTA_CCP
  D22E                	S27:
  D22E  0E27          		LD	C,027H		;(BDOS)ランダムブロック読み込み
  D230  18E7          		JR	SYSTEM0
                      	
  D232                	CEXE4:
  D232  3A14EF        		LD	A,(FDRV)
  D235  325700        		LD	(00057H),A
  D238  2A22EF        		LD	HL,(FDRV+14)
  D23B  225800        		LD	(00058H),HL
                      	
  D23E  211DEF        		LD	HL,FNAME+8
  D241  7E            		LD	A,(HL)
  D242  FE20          		CP	020H
  D244  2007          		JR	NZ,CEXE7
  D246  3E3F          		LD	A,'?'
  D248  77            		LD	(HL),A
  D249  23            		INC	HL
  D24A  77            		LD	(HL),A
  D24B  23            		INC	HL
  D24C  77            		LD	(HL),A
  D24D                	CEXE7:
  D24D  CDE8D1        		CALL	OPEN1
  D250                	CEXE5:
  D250  C0            		RET	NZ
  D251  2A76D6        		LD	HL,(DTA_CCP+1+9)
  D254  7C            		LD	A,H
  D255  CDF6E3        		CALL	CAP
  D258  67            		LD	H,A
  D259  7D            		LD	A,L
  D25A  CDF6E3        		CALL	CAP
  D25D  6F            		LD	L,A
  D25E  3A75D6        		LD	A,(DTA_CCP+1+8)
  D261  CDF6E3        		CALL	CAP
  D264  D642          		SUB	'B'
  D266  282C          		JR	Z,C_BAT
  D268  3D            		DEC	A		;'C'
  D269  2805          		JR	Z,C_EXE
  D26B                	CEXE6:
  D26B  CDFAD1        		CALL	OPEN2
  D26E  18E0          		JR	CEXE5
                      	
  D270                	C_EXE:
  D270  7C            		LD	A,H
  D271  FE4D          		CP	'M'
  D273  20F6          		JR	NZ,CEXE6
                      	
  D275  CDFED1        		CALL	DEFCB
  D278  CD22D2        		CALL	S27BUF
  D27B  3D            		DEC	A
  D27C  37            		SCF
  D27D  C0            		RET	NZ
  D27E  7C            		LD	A,H
  D27F  B5            		OR	L
  D280  37            		SCF
  D281  C8            		RET	Z
  D282  CD12D2        		CALL	SETDTA1
  D285  110000        	COMPAT:	LD	DE,0				; self-modifying code
  D288  ED7B0600      		LD	SP,(SYSTEM+1)
  D28C  67            		LD	H,A				; A=0 in SETDTA1(_SYS1A)
  D28D  6F            		LD	L,A
  D28E  E5            		PUSH	HL				; push $0000 (reboot address)
  D28F  24            		INC	H
  D290  E5            		PUSH	HL				; push $0100 (TPA address)
  D291  C3D0D4        		JP	SETFCB				; and JP $0100
                      	
  D294                	C_BAT:
  D294  114154        		LD	DE,'A'+'T'*256
  D297  ED52          		SBC	HL,DE
  D299  20D0          		JR	NZ,CEXE6
                      	
  D29B  F1            		POP	AF
  D29C  F1            		POP	AF
  D29D  CDFED1        		CALL	DEFCB
  D2A0  210002        		LD	HL,00200H
  D2A3  CD2BD2        		CALL	S27DTA
  D2A6  C6FE          		ADD	A,0FEH
  D2A8  D8            		RET	C
  D2A9  7D            		LD	A,L
  D2AA  B7            		OR	A
  D2AB  37            		SCF
  D2AC  C8            		RET	Z
  D2AD  3C            		INC	A
  D2AE  F5            		PUSH	AF
                      	
  D2AF  CDECDB        		CALL	KEYBC
  D2B2  3E06          		LD	A,6
  D2B4  CD23DC        		CALL	MSG_A
  D2B7  C1            		POP	BC
  D2B8  210001        		LD	HL,00100H
  D2BB                	BAT1:
  D2BB  A7            		AND	A
  D2BC  05            		DEC	B
  D2BD  C8            		RET	Z
  D2BE  7E            		LD	A,(HL)
  D2BF  FE25          		CP	'%'
  D2C1  280C          		JR	Z,BAT2
  D2C3                	BAT1X:
  D2C3  7E            		LD	A,(HL)
  D2C4  23            		INC	HL
  D2C5  FE1A          		CP	01AH
  D2C7  C8            		RET	Z
  D2C8  FE0A          		CP	00AH
  D2CA  C4D1DB        		CALL	NZ,KEYBS
  D2CD  18EC          		JR	BAT1
                      	
  D2CF                	BAT2:
  D2CF  23            		INC	HL
  D2D0  7E            		LD	A,(HL)
  D2D1  2B            		DEC	HL
  D2D2  D631          		SUB	'1'
  D2D4  38ED          		JR	C,BAT1X
  D2D6  FE09          		CP	9
  D2D8  30E9          		JR	NC,BAT1X
  D2DA  23            		INC	HL
  D2DB  23            		INC	HL
  D2DC  3C            		INC	A
  D2DD  4F            		LD	C,A
  D2DE  ED5B86D2      		LD	DE,(COMPAT+1)
  D2E2                	BAT3:
  D2E2  1A            		LD	A,(DE)
  D2E3  B7            		OR	A
  D2E4  28D5          		JR	Z,BAT1
  D2E6  CDC1E1        		CALL	SPCUT
  D2E9  0D            		DEC	C
  D2EA  2808          		JR	Z,BAT5
  D2EC                	BAT4:
  D2EC  1A            		LD	A,(DE)
  D2ED  FE21          		CP	021H
  D2EF  38F1          		JR	C,BAT3
  D2F1  13            		INC	DE
  D2F2  18F8          		JR	BAT4
  D2F4                	BAT5:
  D2F4  1A            		LD	A,(DE)
  D2F5  FE21          		CP	021H
  D2F7  38C2          		JR	C,BAT1
  D2F9  13            		INC	DE
  D2FA  CDD1DB        		CALL	KEYBS
  D2FD  18F5          		JR	BAT5
                      	
  D2FF                	SWITCH:
  D2FF  1A            		LD	A,(DE)
  D300                	SW1:
  D300  13            		INC	DE
  D301  B9            		CP	C
  D302  1A            		LD	A,(DE)
  D303  C8            		RET	Z
  D304  FE20          		CP	020H
  D306  30F8          		JR	NC,SW1
  D308                	C_REM:
  D308  AF            		XOR	A
  D309  C9            		RET
                      	
  D30A                	C_DEL:
  D30A  CDD0D4        		CALL	SETFCB
  D30D  CD39DC        		CALL	_SYS08		;(BDOS)エコーなしコンソール入力
                      	
  D310  0E13          		LD	C,013H
  D312  180A          		JR	CDEL1		;(BDOS)ファイルの削除
                      	
  D314                	C_REN:
  D314  CDD0D4        		CALL	SETFCB
  D317  3E10          		LD	A,010H		;ディレクトリも対象にする
  D319  326900        		LD	(FCB1+13),A	;属性
  D31C  0E17          		LD	C,017H		;(BDOS)ファイル名の変更
  D31E                	CDEL1:
  D31E  115C00        		LD	DE,FCB1
  D321  CD0500        		CALL	SYSTEM
  D324  C6FF          		ADD	A,0FFH
  D326  C9            		RET
                      	
  D327                	C_DIR:
  D327  CDDFE0        		CALL	FILEC
  D32A  2115EF        		LD	HL,FDRV+1
  D32D  CD61D6        		CALL	CWILD1
  D330  3EF1          		LD	A,0F1H
  D332  3221EF        		LD	(FDRV+13),A
  D335  CDE8D1        		CALL	OPEN1
  D338                	CDIR1:
  D338  B7            		OR	A
  D339  2008          		JR	NZ,PDSKF
  D33B  CD86D3        		CALL	P_NAME
  D33E  CDFAD1        		CALL	OPEN2
  D341  18F5          		JR	CDIR1
                      	
  D343                	PDSKF:
  D343  3A14EF        		LD	A,(FDRV)
  D346  5F            		LD	E,A
  D347  0E1B          		LD	C,01BH		;(BDOS)ディスク情報の獲得
  D349  CD0500        		CALL	SYSTEM
  D34C  4F            		LD	C,A		;C←1クラスタ辺りの論理セクタ数
  D34D  C601          		ADD	A,001H
  D34F  D8            		RET	C		;Aが0FFHだった場合
  D350  3E06          		LD	A,8-2
  D352                	PDS1:				;HL=未使用クラスタの総数
  D352  3C            		INC	A
  D353  CB19          		RR	C
  D355  30FB          		JR	NC,PDS1
  D357                	PDS2:				;B←論理セクタのサイズの上位8ビット
  D357  3C            		INC	A
  D358  CB18          		RR	B
  D35A  30FB          		JR	NC,PDS2
  D35C  47            		LD	B,A
                      	
  D35D  110000        		LD	DE,0
  D360                	PDS3:
  D360  29            		ADD	HL,HL
  D361  EB            		EX	DE,HL
  D362  ED6A          		ADC	HL,HL
  D364  EB            		EX	DE,HL
  D365  10F9          		DJNZ	PDS3
  D367                	PDSKF1:
  D367  CDFFD3        		CALL	PRDEC_DEHL
  D36A  11D2D6        		LD	DE,FREE
  D36D  CD5FD8        		CALL	_SYS09		;(BDOS)文字列出力
  D370  CDEED3        		CALL	PUTDRV
  D373  3E5C          		LD	A,05CH		;\
  D375  CD23DC        		CALL	MSG_A
  D378  2A22EF        		LD	HL,(FDRV+14)	;ディレクトリのクラスタ番号
  D37B  AF            		XOR	A
  D37C  11FEFF        		LD	DE,0-2
  D37F  19            		ADD	HL,DE
  D380  23            		INC	HL
  D381  DCFBD3        		CALL	C,PRDEC_HL
  D384  1841          		JR	LTNL
                      	
  D386                	P_NAME:
  D386  3A6DD6        		LD	A,(DTA_CCP+1)
  D389  FE2E          		CP	'.'
  D38B  C8            		RET	Z
  D38C  11EAD6        		LD	DE,DIRHD
  D38F  CD5FD8        		CALL	_SYS09		;(BDOS)文字列出力
  D392  3A78D6        		LD	A,(DTA_CCP+1+00BH)
  D395  F5            		PUSH	AF
  D396  0F            		RRCA
  D397  9F            		SBC	A,A
  D398  E60A          		AND	'*'-020H
  D39A  C620          		ADD	A,020H
  D39C  CD23DC        		CALL	MSG_A
  D39F  CDEED3        		CALL	PUTDRV
  D3A2  216DD6        		LD	HL,DTA_CCP+1
  D3A5  CD3FD4        		CALL	FPRNT
                      	
  D3A8  F1            		POP	AF
  D3A9  CB67          		BIT	4,A
  D3AB  2808          		JR	Z,DIR3
  D3AD  11DFD6        		LD	DE,DIRMES
  D3B0  CD5FD8        		CALL	_SYS09		;(BDOS)文字列出力
  D3B3  180A          		JR	DIR6
  D3B5                	DIR3:
  D3B5  ED5B8BD6      		LD	DE,(DTA_CCP+1+01EH)
  D3B9  2A89D6        		LD	HL,(DTA_CCP+1+01CH)
  D3BC  CDFFD3        		CALL	PRDEC_DEHL
  D3BF                	DIR6:
  D3BF  3AB1EF        		LD	A,(CRTCD+1)
  D3C2  FE29          		CP	40+1
  D3C4  D461D4        		CALL	NC,PRTTMS
                      	
  D3C7                	LTNL:
  D3C7  1E03          		LD	E,3
  D3C9  C3CDEF        		JP	_PRINT
                      	
  D3CC                	C_PATH:
  D3CC  CDC1E1        		CALL	SPCUT
  D3CF  2191D6        		LD	HL,PATHD
  D3D2  FE21          		CP	021H
  D3D4  300C          		JR	NC,CPATH0
  D3D6                	CPATHP:
  D3D6  7E            		LD	A,(HL)
  D3D7  23            		INC	HL
  D3D8  FE20          		CP	020H
  D3DA  3F            		CCF
  D3DB  30EA          		JR	NC,LTNL
  D3DD  CD23DC        		CALL	MSG_A
  D3E0  18F4          		JR	CPATHP
  D3E2                	CPATH0:
  D3E2  FE3B          		CP	';'
  D3E4  2001          		JR	NZ,CPATH1
  D3E6  13            		INC	DE
  D3E7                	CPATH1:
  D3E7  EB            		EX	DE,HL
  D3E8  014000        		LD	BC,PATHX
  D3EB  EDB0          		LDIR
  D3ED  C9            		RET
                      	
  D3EE                	PUTDRV:
  D3EE  3A14EF        		LD	A,(FDRV)
  D3F1  C640          		ADD	A,'A'-1
  D3F3  CD23DC        		CALL	MSG_A
  D3F6  3E3A          		LD	A,':'
  D3F8                	MSG_AR:
  D3F8  C323DC        		JP	MSG_A
                      	
  D3FB                	PRDEC_HL:
  D3FB  AF            		XOR	A
  D3FC                	PRDEC_AHL:
  D3FC  5F            		LD	E,A
  D3FD  1600          		LD	D,0
  D3FF                	PRDEC_DEHL:
  D3FF  D5            		PUSH	DE
  D400  110FEF        		LD	DE,DECBF
  D403  0605          		LD	B,5
  D405  CD05D5        		CALL	ZERO_MEMORY_DE	;A=0
  D408  D1            		POP	DE
                      	
  D409  0E20          		LD	C,32
  D40B                	DEC1:
  D40B  29            		ADD	HL,HL
  D40C  EB            		EX	DE,HL
  D40D  ED6A          		ADC	HL,HL
  D40F  EB            		EX	DE,HL
  D410  E5            		PUSH	HL
  D411  2113EF        		LD	HL,DECBF+4
  D414  0605          		LD	B,5
  D416                	DEC2:
  D416  7E            		LD	A,(HL)
  D417  8F            		ADC	A,A
  D418  27            		DAA
  D419  77            		LD	(HL),A
  D41A  2B            		DEC	HL
  D41B  10F9          		DJNZ	DEC2
  D41D  E1            		POP	HL
  D41E  0D            		DEC	C
  D41F  20EA          		JR	NZ,DEC1
                      	
  D421  210FEF        		LD	HL,DECBF
  D424  3E20          		LD	A,020H
  D426  0604          		LD	B,4
  D428                	DEC3:
  D428  CD35D4        		CALL	DEC4
  D42B  CD35D4        		CALL	DEC4
  D42E  23            		INC	HL
  D42F  10F7          		DJNZ	DEC3
  D431                	DECX:
  D431  CD35D4        		CALL	DEC4
  D434  AF            		XOR	A
  D435                	DEC4:
  D435  ED6F          		RLD
  D437  FE20          		CP	020H
  D439  2802          		JR	Z,DEC5
  D43B  F630          		OR	030H
  D43D                	DEC5:
  D43D  18B9          		JR	MSG_AR
                      	
  D43F                	FPRNT:
  D43F  0608          		LD	B,8
  D441  CD52D4        		CALL	P_N1
  D444  7E            		LD	A,(HL)
  D445  C680          		ADD	A,0A0H-020H
  D447  FEA0          		CP	0A0H
  D449  2802          		JR	Z,FPR1
  D44B  3E2E          		LD	A,'.'
  D44D                	FPR1:
  D44D  CD23DC        		CALL	MSG_A
  D450  0603          		LD	B,3
                      	
  D452                	P_N1:
  D452  C5            		PUSH	BC
  D453  E5            		PUSH	HL
  D454  7E            		LD	A,(HL)
  D455  CD02E4        		CALL	CAP3
  D458  CD23DC        		CALL	MSG_A
  D45B  E1            		POP	HL
  D45C  C1            		POP	BC
  D45D  23            		INC	HL
  D45E  10F2          		DJNZ	P_N1
  D460  C9            		RET
                      	
  D461                	PRTTMS:
  D461  3E20          		LD	A,020H
  D463  CD23DC        		CALL	MSG_A
                      	
  D466  2A85D6        		LD	HL,(DTA_CCP+1+24)
  D469  7D            		LD	A,L
  D46A  B7            		OR	A
  D46B  C8            		RET	Z
  D46C  CB3C          		SRL	H
  D46E  17            		RLA
  D46F  17            		RLA
  D470  17            		RLA
  D471  17            		RLA
  D472  E60F          		AND	00FH
  D474  57            		LD	D,A
  D475  7C            		LD	A,H
  D476  C650          		ADD	A,80
  D478  CDBBD4        		CALL	PRDEC_A
  D47B  3E2D          		LD	A,'-'
  D47D  CD23DC        		CALL	MSG_A
  D480  7A            		LD	A,D
  D481  CDBBD4        		CALL	PRDEC_A
  D484  3E2D          		LD	A,'-'
  D486  CD23DC        		CALL	MSG_A
  D489  7D            		LD	A,L
  D48A  E61F          		AND	01FH
  D48C  CDBBD4        		CALL	PRDEC_A
                      	
  D48F  2A83D6        		LD	HL,(DTA_CCP+1+22)
                      	
  D492  3E20          		LD	A,020H
  D494  CD23DC        		CALL	MSG_A
  D497  7C            		LD	A,H
  D498  65            		LD	H,L
  D499  0603          		LD	B,3
  D49B                	PRTTMS1:
  D49B  1F            		RRA
  D49C  CB1D          		RR	L
  D49E  10FB          		DJNZ	PRTTMS1
  D4A0  E61F          		AND	01FH
  D4A2  CDBBD4        		CALL	PRDEC_A
  D4A5  3E3A          		LD	A,':'
  D4A7  CD23DC        		CALL	MSG_A
  D4AA  7D            		LD	A,L
  D4AB  0F            		RRCA
  D4AC  0F            		RRCA
  D4AD  E63F          		AND	03FH
  D4AF  CDBBD4        		CALL	PRDEC_A
  D4B2  3E3A          		LD	A,':'
  D4B4  CD23DC        		CALL	MSG_A
  D4B7  7C            		LD	A,H
  D4B8  E61F          		AND	01FH
  D4BA  87            		ADD	A,A
                      	
                      	;	PRINT10
                      	
  D4BB                	PRDEC_A:
  D4BB  E5            		PUSH	HL
  D4BC  0608          		LD	B,8
  D4BE  4F            		LD	C,A
  D4BF  AF            		XOR	A
  D4C0                	PRTA1:
  D4C0  CB01          		RLC	C
  D4C2  8F            		ADC	A,A
  D4C3  27            		DAA
  D4C4  10FA          		DJNZ	PRTA1
  D4C6  210FEF        		LD	HL,DECBF
  D4C9  77            		LD	(HL),A
  D4CA  AF            		XOR	A
  D4CB  CD31D4        		CALL	DECX
  D4CE  E1            		POP	HL
  D4CF  C9            		RET
                      	
  D4D0                	SETFCB:
  D4D0  CDC1E1        		CALL	SPCUT
  D4D3  1A            		LD	A,(DE)
  D4D4  FE20          		CP	020H
  D4D6  3801          		JR	C,SETFCBA
  D4D8  1B            		DEC	DE
  D4D9                	SETFCBA:
  D4D9  0624          		LD	B,36
  D4DB  215C00        		LD	HL,FCB1
  D4DE  E5            		PUSH	HL
  D4DF  AF            		XOR	A
  D4E0  CD96E1        		CALL	FILL_MEMORY
  D4E3  E1            		POP	HL
  D4E4  D5            		PUSH	DE
  D4E5  CDC2DA        		CALL	_SYS5C		;(BDOS)ファイル名の解析
  D4E8  216C00        		LD	HL,FCB2
  D4EB  CDC2DA        		CALL	_SYS5C		;(BDOS)ファイル名の解析
  D4EE  E1            		POP	HL
  D4EF  010050        		LD	BC,05000H
  D4F2  118100        		LD	DE,00081H
  D4F5                	SETFCB1:
  D4F5  7E            		LD	A,(HL)
  D4F6  23            		INC	HL
  D4F7  FE20          		CP	020H
  D4F9  3805          		JR	C,SETFCB2
  D4FB  12            		LD	(DE),A
  D4FC  13            		INC	DE
  D4FD  0C            		INC	C
  D4FE  10F5          		DJNZ	SETFCB1
  D500                	SETFCB2:
  D500  79            		LD	A,C
  D501  328000        		LD	(DTA1),A
  D504  04            		INC	B
  D505                	ZERO_MEMORY_DE:
  D505  AF            		XOR	A
  D506                	FILL_MEMORY_DE:
  D506  12            		LD	(DE),A
  D507  13            		INC	DE
  D508  10FC          		DJNZ	FILL_MEMORY_DE
  D50A  C9            		RET
                      	
  D50B                	C_COPY:
  D50B  CDD0D4        		CALL	SETFCB
  D50E  118100        		LD	DE,DTA1+1
  D511  0E2F          		LD	C,'/'
  D513  CDFFD2        		CALL	SWITCH
  D516  CDF6E3        		CALL	CAP
  D519  32A1D5        		LD	(SW+1),A
                      	
  D51C  1161EF        		LD	DE,BEEPD
  D51F  CDE2E0        		CALL	FILEC2
  D522  216C00        		LD	HL,FCB2
  D525  CDC9DA        		CALL	S29X1
                      	
  D528  3E10          		LD	A,010H
  D52A  326900        		LD	(FCB1+13),A
  D52D  216D00        		LD	HL,FCB2+1
  D530  CD61D6        		CALL	CWILD1
  D533                	COPY0:
  D533  CD5ED6        		CALL	CWILD
  D536  215C00        		LD	HL,FCB1
  D539  CDEBD1        		CALL	OPEN
  D53C  37            		SCF
  D53D                	COPY1:
  D53D  C0            		RET	NZ
  D53E  CDFED1        		CALL	DEFCB
                      	
  D541  3A79D6        		LD	A,(DTA_CCP+13)
  D544  CB67          		BIT	4,A
  D546  2824          		JR	Z,COPY1A
                      	
  D548  215D00        		LD	HL,FCB1+1
  D54B  CD25E5        		CALL	CHKWILD
  D54E  3817          		JR	C,COPY9
                      	
  D550  3E20          		LD	A,020H
  D552  325D00        		LD	(FCB1+1),A
  D555  2A86D6        		LD	HL,(DTA_CCP+26)
  D558  23            		INC	HL
  D559  226A00        		LD	(FCB1+14),HL
  D55C  18D5          		JR	COPY0
                      	
  D55E                	COPYS:
  D55E  1174EF        		LD	DE,SKIP
  D561                	COPY8:
  D561  CD5FD8        		CALL	_SYS09		;(BDOS)文字列出力
  D564  CDC7D3        		CALL	LTNL
  D567                	COPY9:
  D567  CDFAD1        		CALL	OPEN2
  D56A  18D1          		JR	COPY1
                      	
  D56C                	COPY1A:
  D56C  216C00        		LD	HL,FCB2
  D56F  1114EF        		LD	DE,FDRV
  D572  016ED6        		LD	BC,DTA_CCP+2
  D575  EDA0          		LDI
  D577  3E0B          		LD	A,11
  D579                	COPY2:
  D579  F5            		PUSH	AF
  D57A  7E            		LD	A,(HL)
  D57B  FE3F          		CP	'?'
  D57D  2001          		JR	NZ,COPY3
  D57F  0A            		LD	A,(BC)
  D580                	COPY3:
  D580  12            		LD	(DE),A
  D581  03            		INC	BC
  D582  13            		INC	DE
  D583  23            		INC	HL
  D584  F1            		POP	AF
  D585  3D            		DEC	A
  D586  20F1          		JR	NZ,COPY2
  D588  010500        		LD	BC,16-11
  D58B  EDB0          		LDIR
  D58D                	PUTNAME:
  D58D  215D00        		LD	HL,FCB1+1
  D590  CD25E5        		CALL	CHKWILD
  D593  300B          		JR	NC,PUTN1
  D595  2115EF        		LD	HL,FDRV+1
  D598  CD3FD4        		CALL	FPRNT
  D59B  3E20          		LD	A,020H
  D59D  CD23DC        		CALL	MSG_A
  D5A0                	PUTN1:
  D5A0  3E00          	SW:	LD	A,000H
  D5A2  FE54          		CP	'T'
  D5A4  2005          		JR	NZ,CSW1
  D5A6  21C0D5        		LD	HL,SWNE
  D5A9  1807          		JR	SWT1
  D5AB                	CSW1:
  D5AB  FE4E          		CP	'N'
  D5AD  2011          		JR	NZ,SWNE
  D5AF  215ED5        		LD	HL,COPYS
  D5B2                	SWT1:
  D5B2  1114EF        		LD	DE,FDRV
  D5B5  CD17D2        		CALL	SYSC0F
  D5B8  2801          		JR	Z,SWN1
  D5BA  E9            		JP	(HL)
  D5BB                	SWN1:
  D5BB  CD14D6        		CALL	CTIME
  D5BE  309E          		JR	NC,COPYS
  D5C0                	SWNE:
  D5C0  1114EF        		LD	DE,FDRV
  D5C3  0E16          		LD	C,016H		;(BDOS)ファイルの作成
  D5C5  CD19D2        		CALL	SYSTEM0
  D5C8  2048          		JR	NZ,COPYE2
  D5CA  67            		LD	H,A		;A=0
  D5CB  6F            		LD	L,A
  D5CC  2235EF        		LD	(FDRV+33),HL	;(FCB)ランダムレコード
  D5CF  2237EF        		LD	(FDRV+35),HL
  D5D2                	COPY6:
  D5D2  CD22D2        		CALL	S27BUF
  D5D5  47            		LD	B,A
  D5D6  3C            		INC	A
  D5D7  2831          		JR	Z,COPYE
  D5D9  7C            		LD	A,H
  D5DA  B5            		OR	L
  D5DB  280C          		JR	Z,COPY7
  D5DD  1114EF        		LD	DE,FDRV
  D5E0  0E26          		LD	C,026H		;(BDOS)ランダムブロック書き込み
  D5E2  CD19D2        		CALL	SYSTEM0
  D5E5  2023          		JR	NZ,COPYE
  D5E7  10E9          		DJNZ	COPY6
  D5E9                	COPY7:
  D5E9  3A79D6        		LD	A,(DTA_CCP+13)	;(FCB)属性
  D5EC  3221EF        		LD	(FDRV+13),A
  D5EF  2180D6        		LD	HL,DTA_CCP+20	;(FCB)タイムスタンプ
  D5F2  1128EF        		LD	DE,FDRV+20
  D5F5  010400        		LD	BC,4
  D5F8  EDB0          		LDIR
                      	
  D5FA  1114EF        		LD	DE,FDRV
  D5FD  0E10          		LD	C,010H		;(BDOS)ファイルのクローズ
  D5FF  CD19D2        		CALL	SYSTEM0
  D602  2006          		JR	NZ,COPYE
                      	
  D604  1171EF        		LD	DE,OK
  D607  C361D5        		JP	COPY8
                      	
  D60A                	COPYE:
  D60A  1114EF        		LD	DE,FDRV
  D60D  0E13          		LD	C,013H		;(BDOS)ファイルの削除
  D60F  CD0500        		CALL	SYSTEM
  D612                	COPYE2:
  D612  37            		SCF
  D613  C9            		RET
                      	
  D614                	CTIME:
  D614  ED5B80D6      		LD	DE,(DTA_CCP+20)
  D618  2A28EF        		LD	HL,(FDRV+20)
  D61B  A7            		AND	A
  D61C  ED52          		SBC	HL,DE
  D61E  C0            		RET	NZ
  D61F  ED5B82D6      		LD	DE,(DTA_CCP+22)
  D623  2A2AEF        		LD	HL,(FDRV+22)
  D626  ED52          		SBC	HL,DE
  D628  C9            		RET
                      	
  D629                	C_TYPE:
  D629  CDD0D4        		CALL	SETFCB
  D62C  215C00        		LD	HL,FCB1
  D62F  CDEBD1        		CALL	OPEN
  D632  37            		SCF
  D633                	TYPE1:
  D633  C0            		RET	NZ
  D634  CDFED1        		CALL	DEFCB
  D637  3E06          		LD	A,6
  D639  CD23DC        		CALL	MSG_A
  D63C                	TYPE2:
  D63C  CD22D2        		CALL	S27BUF
  D63F  C6FE          		ADD	A,0FEH
  D641  D8            		RET	C
  D642  7C            		LD	A,H
  D643  B5            		OR	L
  D644  2813          		JR	Z,TYPEE
  D646  010001        		LD	BC,00100H
  D649                	TYPE3:
  D649  0A            		LD	A,(BC)
  D64A  03            		INC	BC
  D64B  FE1A          		CP	01AH
  D64D  280A          		JR	Z,TYPEE
  D64F  CD23DC        		CALL	MSG_A
  D652  2B            		DEC	HL
  D653  7C            		LD	A,H
  D654  B5            		OR	L
  D655  20F2          		JR	NZ,TYPE3
  D657  18E3          		JR	TYPE2
  D659                	TYPEE:
  D659  CDFAD1        		CALL	OPEN2
  D65C  18D5          		JR	TYPE1
                      	
  D65E                	CWILD:
  D65E  215D00        		LD	HL,FCB1+1
  D661                	CWILD1:
  D661  7E            		LD	A,(HL)
  D662  FE20          		CP	020H
  D664  C0            		RET	NZ
  D665                	CWILD2:
  D665  3E3F          		LD	A,'?'
  D667  060B          		LD	B,11
  D669  C396E1        		JP	FILL_MEMORY
                      	
  D66C                	DTA_CCP:
  D66C                		DS	37
                      	
  0040                	PATHX	EQU	64
  D691                	PATHD:	DS	PATHX
  D6D1  00            	PATHE:	DB	0
                      	
  D6D2  20627974657320	FREE:	DB	" bytes free",9,'$'
  D6DF  20202020203C44	DIRMES:	DB	"     <DIR>$"
  D6EA  20203A24      	DIRHD:	DB	"  :$"
                      	
  D6EE                	COMTB:
  D6EE  44202020      		DB	"D   "	;1
  D6F2  27D3          		DW	C_DIR
  D6F4  44495220      		DB	"DIR "	;2
  D6F8  27D3          		DW	C_DIR
  D6FA  434F5059      		DB	"COPY"	;3
  D6FE  0BD5          		DW	C_COPY
  D700  43442020      		DB	"CD  "	;4
  D704  1ED2          		DW	C_CD
  D706  44454C20      		DB	"DEL "	;5
  D70A  0AD3          		DW	C_DEL
  D70C  50415448      		DB	"PATH"	;6
  D710  CCD3          		DW	C_PATH
  D712  52454E20      		DB	"REN "	;7
  D716  14D3          		DW	C_REN
  D718  54595045      		DB	"TYPE"	;8
  D71C  29D6          		DW	C_TYPE
  D71E  52454D20      		DB	"REM "	;9
  D722  08D3          		DW	C_REM
                      	
                      	;X1DISK2.ASM
                      	
                      	;	LSX-Dodgers DISK2
                      	;	X1/turbo/Z
                      	
                      	;	GRAPHIC RAM DISK DRIVER
                      	
                      	
  D724                	GDRD:
  D724  C5            		PUSH	BC
  D725  CD4DD7        		CALL	GADR
  D728  F1            		POP	AF
  D729                	GDRD1:
  D729  EDA2          		INI
  D72B  04            		INC	B
  D72C  0C            		INC	C
  D72D  20FA          		JR	NZ,GDRD1
  D72F  04            		INC	B
  D730  13            		INC	DE
  D731  3D            		DEC	A
  D732  20F5          		JR	NZ,GDRD1
  D734                	GBANK0:
  D734  3ABFEF        		LD	A,(WK1FD0)
  D737  E6EF          		AND	0EFH		;BANK0
  D739  181D          		JR	S1FD0
                      	
  D73B                	GDWT:
  D73B  C5            		PUSH	BC
  D73C  CD4DD7        		CALL	GADR
  D73F  F1            		POP	AF
  D740                	GDWT1:
  D740  04            		INC	B
  D741  EDA3          		OUTI
  D743  0C            		INC	C
  D744  20FA          		JR	NZ,GDWT1
  D746  04            		INC	B
  D747  13            		INC	DE
  D748  3D            		DEC	A
  D749  20F5          		JR	NZ,GDWT1
  D74B  18E7          		JR	GBANK0
                      	
  D74D                	GADR:
  D74D  0E00          		LD	C,0
  D74F  7B            		LD	A,E
  D750  C640          		ADD	A,040H
  D752  47            		LD	B,A
  D753  3ABFEF        		LD	A,(WK1FD0)
  D756  F610          		OR	010H		;BANK1
  D758                	S1FD0:
  D758  C5            		PUSH	BC
  D759  32BFEF        		LD	(WK1FD0),A
  D75C  01D01F        		LD	BC,01FD0H
  D75F  ED79          		OUT	(C),A
  D761  C1            		POP	BC
  D762  C9            		RET
                      	
                      	
                      	;	BANK RAM DISK DRIVER
                      	
  D763                	BDWT:
  D763  3E            		DB	03EH	;LD A,??
  D764  37            		SCF
  D765  1802          		JR	BRW
                      	
  D767                	BDRD:
  D767  3E            		DB	03EH	;LD A,??
  D768  A7            		AND	A
  D769                	BRW:
  D769  F3            		DI
  D76A  3292D7        		LD	(BRWPAT),A
  D76D  ED73B2D7      		LD	(BANKSP+1),SP
  D771  3AB3D7        		LD	A,(BANKSP+2)
  D774  87            		ADD	A,A
  D775  3803          		JR	C,BRW0
  D777  31CAFF        		LD	SP,EXTSP
  D77A                	BRW0:
  D77A  D9            		EXX		;裏レジスタ
  D77B  C5            		 PUSH	 BC
  D77C  D5            		 PUSH	 DE
  D77D  01000B        		 LD	 BC,00B00H	 ;バンクメモリ
  D780  111010        		 LD	 DE,01010H
  D783  D9            		 EXX		;表レジスタ
  D784                	BRW1:
  D784  C5            		PUSH	BC
  D785  D5            		PUSH	DE
  D786  EB            		EX	DE,HL
  D787  29            		ADD	HL,HL
  D788  29            		ADD	HL,HL
  D789  7C            		LD	A,H
  D78A  E60F          		AND	00FH	;バンク
  D78C  65            		LD	H,L
  D78D  CB3C          		SRL	H	;/2
  D78F  2E00          		LD	L,0
  D791  D9            		EXX		;裏レジスタ
  D792  A7            	BRWPAT:	 AND	 A	;自己書き換え(AND A:読み出し/SCF:書き込み)
  D793  3808          		 JR	 C,BRWT
  D795  57            		 LD	 D,A	 ;D=バンク
  D796  D9            		 EXX		;表レジスタ
  D797  EB            		EX	DE,HL
  D798  CDB6D7        		CALL	BTFR
  D79B  1806          		JR	BRW2
  D79D                	BRWT:
  D79D  5F            		 LD	E,A	 ;E=バンク
  D79E  D9            		 EXX		;表レジスタ
  D79F  CDB6D7        		CALL	BTFR
  D7A2  EB            		EX	DE,HL
  D7A3                	BRW2:
  D7A3  D1            		POP	DE
  D7A4  C1            		POP	BC
  D7A5  13            		INC	DE
  D7A6  10DC          		DJNZ	BRW1
                      	
  D7A8  D9            		EXX		;裏レジスタ
  D7A9  3E10          		 LD	 A,10H
  D7AB  ED79          		 OUT	 (C),A		;メインメモリに切り替える
  D7AD  D1            		 POP	 DE
  D7AE  C1            		 POP	 BC
  D7AF  D9            		 EXX		;表レジスタ
  D7B0  AF            		XOR	A
  D7B1  310000        	BANKSP:	LD	SP,0
  D7B4  FB            		EI
  D7B5  C9            		RET
                      	
                      	;メインメモリ←→バンクメモリ 512バイトの転送を行う
                      	; DE:転送元アドレス
                      	; HL:転送先アドレス
                      	; 裏BC:バンク切り替えポート(0B00H)
                      	; 裏D:転送元バンク(0-0FH:10Hはメインメモリ)
                      	; 裏E:転送先バンク(0-0FH:10Hはメインメモリ)
                      	
  D7B6                	BTFR:
  D7B6  0600          		LD	B,0	;256回ループ(256*2)
  D7B8                	BTFR1:
  D7B8  D9            		EXX		;裏レジスタ
  D7B9  ED51          		 OUT	 (C),D	 ;BANK(MAIN)
  D7BB  D9            		 EXX		;表レジスタ
  D7BC  1A            		LD	A,(DE)
  D7BD  4F            		LD	C,A
  D7BE  13            		INC	DE
  D7BF  1A            		LD	A,(DE)
  D7C0  13            		INC	DE
  D7C1  D9            		EXX		;裏レジスタ
  D7C2  ED59          		 OUT	 (C),E	 ;MAIN(BANK)
  D7C4  D9            		 EXX		;表レジスタ
  D7C5  71            		LD	(HL),C
  D7C6  23            		INC	HL
  D7C7  77            		LD	(HL),A
  D7C8  23            		INC	HL
  D7C9  10ED          		DJNZ	BTFR1
  D7CB  C9            		RET
                      	
                      	;	EMM DRIVER(DMA)
                      	
                      	
  D7CC                	EDWT:
  D7CC  0E0F          		LD	C,15
  D7CE  1802          		JR	EDWT1
  D7D0                	EDRD:
  D7D0  0E0E          		LD	C,14
  D7D2                	EDWT1:
  D7D2  C5            		PUSH	BC
  D7D3  D5            		PUSH	DE
  D7D4  2214D8        		LD	(DMAB),HL
  D7D7  78            		LD	A,B
  D7D8  87            		ADD	A,A
  D7D9  3D            		DEC	A
  D7DA  320DD8        		LD	(DMALEN+1),A
  D7DD  3C            		INC	A
  D7DE  84            		ADD	A,H	;HL(アドレス)を先に進めておく
  D7DF  67            		LD	H,A
  D7E0  EB            		EX	DE,HL
  D7E1  29            		ADD	HL,HL
  D7E2  DD460C        		LD	B,(IX+00CH)	;DPB_0C_MAXCYL
  D7E5  79            		LD	A,C
  D7E6  DD4E0D        		LD	C,(IX+00DH)	;DPB_0D_MAXSEC
  D7E9  09            		ADD	HL,BC
  D7EA  DD4E13        		LD	C,(IX+013H)	;DPB_13_UNITNO
  D7ED  060D          		LD	B,00DH
  D7EF  ED49          		OUT	(C),C
  D7F1  0C            		INC	C
  D7F2  ED69          		OUT	(C),L
  D7F4  0C            		INC	C
  D7F5  ED61          		OUT	(C),H
                      	
  D7F7  2108D8        		LD	HL,EDMAD
  D7FA  CDF6DF        		CALL	SETDMA
  D7FD  CD1EE0        		CALL	GO_DMA
  D800  EB            		EX	DE,HL
  D801  D1            		POP	DE
  D802  C1            		POP	BC
  D803                	DMA_ADD_SEC:
  D803  13            		INC	DE
  D804  10FD          		DJNZ	DMA_ADD_SEC
  D806  AF            		XOR	A
  D807  C9            		RET
                      	
  D808                	EDMAD:
  D808  C3            		DB	0C3H	;WR6 リセット
  D809  7D            		DB	07DH	;WR0 ポートA→ポートB 転送
  D80A  030D          		DW	00D03H	;ポートA開始アドレス EMMリード/ライト
  D80C  FF01          	DMALEN:	DW	001FFH	;ブロック長(転送サイズ-1)
  D80E  2C            		DB	02CH	;WR1 ポートAアドレス固定 I/O
  D80F  50            		DB	050H	;WR2 ポートBアドレスインクリメント メモリ
  D810  02            		DB	002H	;ポートBタイミング
  D811  80            		DB	080H	;WR3
  D812  9A            		DB	09AH	;WR5 WAIT RDY:HIGH
  D813  AD            		DB	0ADH	;WR4 連続 ポートB開始アドレス
  D814  0000          	DMAB:	DW	0
  D816  01            		DB	001H	;WR0 ポートA←ポートB 転送
  D817                	EMME:
                      	
  077D                	AT_RE	EQU	EDWT-AT_EDWT
                      	
                      	
                      	;LDOS.ASM
                      	
                      	;	LSX-Dodgers OS
                      	
  D817                	BDOS0:
  D817  E5            		PUSH	HL
  D818  210001        		LD	HL,00100H
  D81B  39            		ADD	HL,SP
  D81C  3810          		JR	C,BDOS1X
  D81E                	BDOS2:
  D81E  E1            		POP	HL
  D81F  ED732AD8      		LD	(BDSP+1),SP
  D823  31CAFF        		LD	SP,EXTSP
  D826  CD2DD8        		CALL	BDOS1
  D829  310000        	BDSP:	LD	SP,0
  D82C  C9            		RET
  D82D                	BDOS1:
  D82D  E5            		PUSH	HL
  D82E                	BDOS1X:
  D82E  79            		LD	A,C
  D82F  FE3C          		CP	03CH
  D831  3802          		JR	C,DOS1
  D833  3E3C          		LD	A,03CH
  D835                	DOS1:
  D835  87            		ADD	A,A
  D836  6F            		LD	L,A
  D837  26F0          		LD	H,STABLE/256
  D839  7E            		LD	A,(HL)
  D83A  2C            		INC	L
  D83B  66            		LD	H,(HL)
  D83C  6F            		LD	L,A
  D83D  E3            		EX	(SP),HL
  D83E  79            		LD	A,C
  D83F  C9            		RET
  D840                	_DOS2:
  D840  FE5A          		CP	05AH		;(BDOS)カレントディレクトリの変更(_CHDIR)
  D842  CA06DB        		JP	Z,_SYS5A
  D845  FE5C          		CP	05CH		;(BDOS)ファイル名の解析(_PFILE)
  D847  CAC2DA        		JP	Z,_SYS5C
  D84A  FE5F          		CP	05FH		;(BDOS)ディスクバッファのフラッシュ(_FLUSH)
  D84C  CA51ED        		JP	Z,_SYS5F
  D84F  FE6F          		CP	06FH		;(BDOS)MSX-DOS のバージョン番号の獲得(_DOSVER)
  D851  200A          		JR	NZ,_ERROR
  D853  011D01        		LD	BC,011DH
  D856  114801        		LD	DE,VER
  D859  210000        		LD	HL,MACD
  D85C  AF            		XOR	A
  D85D                	_ERROR:
  D85D  A7            		AND	A
  D85E  C9            		RET
                      	
  D85F                	_SYS09:		;文字列出力
  D85F  D5            		PUSH	DE
  D860                	_SX09:
  D860  1A            		LD	A,(DE)
  D861  13            		INC	DE
  D862  FE24          		CP	'$'
  D864  2831          		JR	Z,SX0E2
  D866  CD23DC        		CALL	MSG_A
  D869  18F5          		JR	_SX09
                      	
  D86B                	MSX1:
  D86B  CD23DC        		CALL	MSG_A
  D86E                	MSX:
  D86E  7E            		LD	A,(HL)
  D86F  23            		INC	HL
  D870  B7            		OR	A
  D871  20F8          		JR	NZ,MSX1
  D873  C9            		RET
                      	
  D874                	_SYS0C:		;(BDOS)バージョン番号の獲得
  D874  212200        		LD	HL,00022H
  D877  7D            		LD	A,L
  D878  C9            		RET
                      	
  D879                	_SYS0D:		;(BDOS)ディスクリセット
  D879  CDDFEF        		CALL	_FFLUSH
  D87C  E5            		PUSH	HL
  D87D  218000        		LD	HL,00080H
  D880  228AEF        		LD	(_DTA),HL
  D883  E1            		POP	HL
  D884  D5            		PUSH	DE
  D885  1E00          		LD	E,0
  D887  3E            		DB	03EH
                      	
  D888                	_SYS0E:		;(BDOS)カレントドライブの設定
  D888  D5            		PUSH	DE
  D889  7B            		LD	A,E
  D88A  DDE5          		PUSH	IX
  D88C  CDDCEF        		CALL	_GETDPB
  D88F  DDE1          		POP	IX
  D891  3804          		JR	C,SX0E2
  D893  7B            		LD	A,E
  D894  3287EF        		LD	(_DVSW),A
  D897                	SX0E2:
  D897  3E08          		LD	A,8
  D899  D1            		POP	DE
  D89A  C9            		RET
                      	
  D89B                	_SYS0F:		;(BDOS)ファイルのオープン
  D89B  CDD3E1        		CALL	SETDRV
  D89E  FD7E1C        		LD	A,(IY+28)	;(FCB)オープンモード
  D8A1  C602          		ADD	A,002H		;Write
  D8A3  2848          		JR	Z,FEND0F
  D8A5  CD21E5        		CALL	CHKWILDX
                      	
  D8A8  D4F3E1        		CALL	NC,SOPENX
  D8AB                	_S16XX:
  D8AB  3840          		JR	C,FEND0F
                      					;Directory location
  D8AD  3A9FEF        		LD	A,(_FILEN)
  D8B0  FD7719        		LD	(IY+25),A	;(FCB)ディレクトリロケーション
                      	;				_DIRF
  D8B3  3AA0EF        		LD	A,(_DIRF)
  D8B6  FD771D        		LD	(IY+29),A	;(FCB)ディレクトリモード
                      	;				_FBPS
  D8B9  FD731E        		LD	(IY+30),E	;(FCB)ディレクトリポジション
  D8BC  FD721F        		LD	(IY+31),D
                      	;				Open(Read)
  D8BF  FD361CFF      		LD	(IY+28),0FFH	;(FCB)オープンモード
                      	;				FILENAME
  D8C3  FDE5          		PUSH	IY
  D8C5  D1            		POP	DE
  D8C6  13            		INC	DE
  D8C7  010B00        		LD	BC,11
  D8CA  EDB0          		LDIR
                      	;				Attribute
  D8CC  7E            		LD	A,(HL)
  D8CD  FD770D        		LD	(IY+13),A	;(FCB)属性(アトリビュート)
  D8D0  110B00        		LD	DE,11		;Reserved
  D8D3  19            		ADD	HL,DE
                      						;(FCB)ファイルを最後に変更した時刻
  D8D4  11EAF0        		LD	DE,SDDATA		;(FCB)ファイルを最後に変更した日付
  D8D7  060A          		LD	B,SDDATAE-SDDATA	;(FCB)ファイルの先頭クラスタ
  D8D9                	S16LOOP:				;(FCB)ファイルのサイズ(バイト単位)
  D8D9  1A            		LD	A,(DE)
  D8DA  13            		INC	DE
  D8DB  32E2D8        		LD	(S16PAT+2),A
  D8DE  7E            		LD	A,(HL)
  D8DF  23            		INC	HL
  D8E0  FD7700        	S16PAT:	LD	(IY+0),A
  D8E3  10F4          		DJNZ	S16LOOP
                      	
  D8E5  AF            		XOR	A
  D8E6  FD770C        		LD	(IY+12),A	;(FCB)カレントブロック
  D8E9  FD2291D9      		LD	(OFCB+1),IY
  D8ED                	FEND0F:
  D8ED  1845          		JR	FEND10
                      	
  D8EF                	_SYS10:		;(BDOS)ファイルのクローズ
  D8EF  CDD3E1        		CALL	SETDRV
  D8F2  FD7E1C        		LD	A,(IY+28)	;(FCB)オープンモード
  D8F5  D6FE          		SUB	0FEH
  D8F7  37            		SCF
  D8F8  3F            		CCF
  D8F9  2039          		JR	NZ,FEND10
  D8FB                	_S10A:				;Write
  D8FB  FD770E        		LD	(IY+14),A	;(FCB)レコードサイズ/アクセスするディレクトリのクラスタ番号+1
  D8FE  FD770F        		LD	(IY+15),A
                      	
  D901  FD341C        		INC	(IY+28)		;0FEH->0FFH ;オープンモード
  D904  CD0FE6        		CALL	SETTMS
                      	
  D907  FD7E1D        		LD	A,(IY+29)	;(FCB)ディレクトリモード
  D90A  32A0EF        		LD	(_DIRF),A
  D90D  E67F          		AND	07FH
  D90F  327EEA        		LD	(_SECPS+1),A
  D912  FD5E1E        		LD	E,(IY+30)	;(FCB)ディレクトリポジション
  D915  FD561F        		LD	D,(IY+31)
  D918  CD27E3        		CALL	READ_DIR
  D91B  3817          		JR	C,FEND10
                      	
  D91D  3A51E2        	SDECM1:	LD	A,(SDECPAT+1)	;1セクタ辺りのディレクトリエントリ数
  D920  3D            	 	DEC	A		;1024=01FH / 512=00FH / 256=7
  D921  FDA619        		AND	(IY+25)		;(FCB)ディレクトリロケーション
  D924  6F            		LD	L,A
  D925  2600          		LD	H,0
  D927  29            		ADD	HL,HL		;*2
  D928  29            		ADD	HL,HL		;*4
  D929  29            		ADD	HL,HL		;*8
  D92A  29            		ADD	HL,HL		;*16
  D92B  29            		ADD	HL,HL		;*32
  D92C  ED4B7EF0      		LD	BC,(_DTBUF)
  D930  09            		ADD	HL,BC
                      	
  D931  CD31E5        		CALL	SDIRENT
  D934                	FEND10:
  D934  1842          		JR	FEND
                      	
  D936                	_SYS11:		;(BDOS)最初のファイルの検索
  D936  CDD3E1        		CALL	SETDRV
  D939  CD20E2        		CALL	SOPEN
  D93C                	_S12X1:
  D93C  383A          		JR	C,FEND
  D93E  CDC0E2        		CALL	SOPENE2
  D941  ED5B8AEF      		LD	DE,(_DTA)
  D945  3A88EF        		LD	A,(_DRV)
  D948  3C            		INC	A
  D949  12            		LD	(DE),A
  D94A  D5            		PUSH	DE
  D94B  13            		INC	DE
  D94C  012000        		LD	BC,32
  D94F  EDB0          		LDIR
  D951  FD6E0E        		LD	L,(IY+14)	;(FCB)レコードサイズ/アクセスするディレクトリのクラスタ番号+1
  D954  FD660F        		LD	H,(IY+15)
  D957  22F4F0        		LD	(SCDIR),HL
  D95A  2A9AEF        		LD	HL,(_FBPS)
  D95D  22F6F0        		LD	(SFBPS),HL
  D960  2A9FEF        		LD	HL,(_FILEN)
  D963  7C            		LD	A,H
  D964  B7            		OR	A
  D965  2806          		JR	Z,_S12DIR
  D967  3A7EEA        		LD	A,(_SECPS+1)
  D96A  F680          		OR	080H
  D96C  67            		LD	H,A
  D96D                	_S12DIR:
  D96D  22F8F0        		LD	(SFNDF),HL	;Directory position and Flags
  D970  E1            		POP	HL
  D971  1139EF        		LD	DE,SFILE
  D974  0E21          		LD	C,33
  D976                	_S11B:
  D976  EDB0          		LDIR
  D978                	FEND:
  D978  9F            		SBC	A,A		;CF=0 A=0 : CF=1 A=0FFH
  D979                	FENDE:
  D979  FDE1          		POP	IY
  D97B  C1            		POP	BC
  D97C  D1            		POP	DE
  D97D  E1            		POP	HL
  D97E  C9            		RET
                      	
  D97F                	_SYS12:		;(BDOS)次のファイルの検索
  D97F  E5            		PUSH	HL
  D980  D5            		PUSH	DE
  D981  C5            		PUSH	BC
  D982  FDE5          		PUSH	IY
  D984  CD84E2        		CALL	NOPEN
  D987  18B3          		JR	_S12X1
                      	
  D989                	_S16K:
  D989  FD7E1C        		LD	A,(IY+28)	;(FCB)オープンモード
  D98C  FEFD          		CP	0FDH		;Device(0FDH)
  D98E  37            		SCF
  D98F  C8            		RET	Z
                      	
  D990  110000        	OFCB:	LD	DE,0
  D993  D5            		PUSH	DE
  D994  061A          		LD	B,26		;First cluster
  D996                	S16K1:
  D996  13            		INC	DE
  D997  23            		INC	HL
  D998  10FC          		DJNZ	S16K1
                      	
  D99A  1A            		LD	A,(DE)
  D99B  BE            		CP	(HL)
  D99C  2013          		JR	NZ,S16K2
  D99E  13            		INC	DE
  D99F  23            		INC	HL
  D9A0  1A            		LD	A,(DE)
  D9A1  BE            		CP	(HL)
  D9A2  200D          		JR	NZ,S16K2
                      	
  D9A4  E1            		POP	HL
  D9A5  FDE5          		PUSH	IY
  D9A7  D1            		POP	DE
  D9A8  1A            		LD	A,(DE)		;Drive
  D9A9  BE            		CP	(HL)
  D9AA  2006          		JR	NZ,S16K3
                      					;ここはCFが必ず0
  D9AC  ED52          		SBC	HL,DE		;CP HL,DE
  D9AE  37            		SCF
  D9AF  C0            		RET	NZ
  D9B0  E5            		PUSH	HL
  D9B1                	S16K2:
  D9B1  E1            		POP	HL
  D9B2                	S16K3:
  D9B2  FDE5          		PUSH	IY
  D9B4  D1            		POP	DE
  D9B5                	_SYS13:		;(BDOS)ファイルの削除
  D9B5  CDD3E1        		CALL	SETDRV
  D9B8  CD51E4        		CALL	KILL
  D9BB                	FEND13:
  D9BB  18BB          		JR	FEND
                      	
  D9BD                	_SYS14:		;(BDOS)シーケンシャルな読み出し
  D9BD  CDD3E1        		CALL	SETDRV
  D9C0  CD41E6        		CALL	PUSHRR
  D9C3  CD82E6        		CALL	GETSEQ
                      	
  D9C6  CD96E6        		CALL	RB_READ
  D9C9  E5            		PUSH	HL
  D9CA  CD55E6        		CALL	SETSEQ
  D9CD                	SREAD:
  D9CD  E1            		POP	HL
                      	
  D9CE  C601          		ADD	A,001H
  D9D0  38A6          		JR	C,FEND
                      	
  D9D2  7D            		LD	A,L
  D9D3  D601          		SUB	001H
  D9D5                	FENDX:
  D9D5  9F            		SBC	A,A
  D9D6  E603          		AND	3
  D9D8  1F            		RRA
  D9D9  189E          		JR	FENDE
                      	
  D9DB                	_SYS15:		;(BDOS)シーケンシャルな書き込み
  D9DB  CDD3E1        		CALL	SETDRV
  D9DE  CD41E6        		CALL	PUSHRR
  D9E1  CD82E6        		CALL	GETSEQ
                      	
  D9E4  CD8FE6        		CALL	RB_WRITE
  D9E7  E5            		PUSH	HL
  D9E8  CD55E6        		CALL	SETSEQ
  D9EB                	SWRITE:
  D9EB  E1            		POP	HL
                      	
  D9EC  C6FF          		ADD	A,0FFH
  D9EE  18E5          		JR	FENDX
                      	
  D9F0                	_SYS17:		;(BDOS)ファイル名の変更
  D9F0  CDD3E1        		CALL	SETDRV
  D9F3  CDA7E4        		CALL	NAME
  D9F6  18C3          		JR	FEND13
                      	
  D9F8                	_SYS16:		;(BDOS)ファイルの作成
  D9F8  CDD3E1        		CALL	SETDRV
                      	
  D9FB  CD21E5        		CALL	CHKWILDX
  D9FE  38BB          		JR	C,FEND13
  DA00  FD7E01        		LD	A,(IY+1)	;(FCB)主ファイル名
  DA03  FE05          		CP	5
  DA05  2805          		JR	Z,_S16X2
  DA07  FE21          		CP	021H
  DA09  DABBD9        		JP	C,FEND13
  DA0C                	_S16X2:
                      	;				Clear FCB
  DA0C  FDE5          		PUSH	IY
  DA0E  E1            		POP	HL
  DA0F  011000        		LD	BC,16
  DA12  09            		ADD	HL,BC
  DA13                	_S16X1:
  DA13  70            		LD	(HL),B		;B=0
  DA14  23            		INC	HL
  DA15  0D            		DEC	C
  DA16  20FB          		JR	NZ,_S16X1
                      	
  DA18  CD14E6        		CALL	SETTMSX
  DA1B  FD360DFF      		LD	(IY+13),0FFH	;(FCB)Attribute
  DA1F  CDF3E1        		CALL	SOPENX
  DA22  3F            		CCF
  DA23  CC89D9        		CALL	Z,_S16K
  DA26  D4D1E2        		CALL	NC,COPEN
  DA29  D431E5        		CALL	NC,SDIRENT
  DA2C  C3ABD8        		JP	_S16XX
                      	
  DA2F                	_SYS21:		;(BDOS)ランダムな読み出し
                      	
  DA2F  CDD3E1        		CALL	SETDRV
  DA32  CD41E6        		CALL	PUSHRR
  DA35  FD6E21        		LD	L,(IY+33)	;(FCB)Random record
  DA38  FD6622        		LD	H,(IY+34)
                      	
  DA3B  CD96E6        		CALL	RB_READ
  DA3E  E5            		PUSH	HL
  DA3F  CD6CE6        		CALL	POPRR
  DA42  1889          		JR	SREAD
                      	
  DA44                	_SYS22:		;(BDOS)ランダムな書き込み
  DA44                	_SYS28:		;(BDOS)ランダムな書き込み・その2
  DA44  CDD3E1        		CALL	SETDRV
  DA47  CD41E6        		CALL	PUSHRR
  DA4A  FD6E21        		LD	L,(IY+33)	;(FCB)Random record
  DA4D  FD6622        		LD	H,(IY+34)
                      	
  DA50  CD8FE6        		CALL	RB_WRITE
  DA53  E5            		PUSH	HL
  DA54  CD6CE6        		CALL	POPRR
  DA57  1892          		JR	SWRITE
                      	
  DA59                	_SYS18:		;(BDOS)ログインベクトルの獲得
  DA59  21FF00        		LD	HL,000FFH
  DA5C  AF            		XOR	A
  DA5D  C9            		RET
                      	
  DA5E                	_SYS19:		;(BDOS)カレントドライブ番号の獲得
  DA5E  3A87EF        		LD	A,(_DVSW)
  DA61  A7            		AND	A
  DA62  C9            		RET
                      	
  DA63                	_SYS1A:		;(BDOS)DTAの設定
  DA63  ED538AEF      		LD	(_DTA),DE
  DA67  AF            		XOR	A
  DA68  C9            		RET
                      	
  DA69                	_SYS1B:		;(BDOS)ディスク情報の獲得
  DA69  7B            		LD	A,E
  DA6A  CDE6E1        		CALL	GETDRV
  DA6D  CDDCEF        		CALL	_GETDPB
  DA70  D4E2EF        		CALL	NC,_RDFATX
  DA73  210000        		LD	HL,0
  DA76  D4EDE5        		CALL	NC,DSKF
                      	
  DA79  ED5BEEE5      		LD	DE,(MAXCLP+1)	;DPB_08_MAXCL-1
  DA7D  1B            		DEC	DE		;DE←クラスタの総数
  DA7E  FD2A7CF0      		LD	IY,(_FATBF)	;IY←メモリ上のFATの先頭アドレス
  DA82  9F            		SBC	A,A
  DA83  D8            		RET	C
  DA84  4F            		LD	C,A		;C=0
  DA85  DD7E0F        		LD	A,(IX+00FH)	;DPB_0F_BPS
  DA88  E60F          		AND	00FH
  DA8A  47            		LD	B,A
  DA8B  DD7E07        		LD	A,(IX+7)	;DPB_07_SECPCL
  DA8E  C9            		RET
                      	
  DA8F                	_SYS1D:		;(BDOS)書き込みが禁止されているディスクの調査
  DA8F  AF            		XOR	A
  DA90  67            		LD	H,A
  DA91  6F            		LD	L,A
  DA92  C9            		RET
                      	
  DA93                	_SYS1F:		;(BDOS)ディスク装置のパラメータの読み出し
  DA93  2100F1        		LD	HL,DEVICE
  DA96  7B            		LD	A,E
  DA97  C3DCEF        		JP	_GETDPB
                      	
  DA9A                	_SYS23:		;(BDOS)ファイルサイズの獲得
  DA9A  E5            		PUSH	HL
  DA9B  2A1EF0        		LD	HL,(STABLE+2*00FH)	;ファイルのオープン
  DA9E  CD0F00        		CALL	JP_HL
  DAA1  3814          		JR	C,_S23X1
                      	
  DAA3  D5            		PUSH	DE		;EX DE,IY
  DAA4  FDE3          		EX	(SP),IY		;
                      	;	POP	DE		;
                      	;	PUSH	DE		;DEを破壊しないように注意vv
  DAA6  CD72E6        		CALL	GETSIZE
  DAA9                	_S24X1:
  DAA9  FD7521        		LD	(IY+33),L	;(FCB)Random record
  DAAC  FD7422        		LD	(IY+34),H
  DAAF  FD362300      		LD	(IY+35),0
                      	;	POP	DE		;^^^^^^^^^^^^^^^^^^^^^^^^
                      	;	PUSH	DE		;EX DE,IY
  DAB3  FDE3          		EX	(SP),IY		;
  DAB5  D1            		POP	DE		;
                      	
  DAB6  AF            		XOR	A
  DAB7                	_S23X1:
  DAB7  E1            		POP	HL
  DAB8  C9            		RET
                      	
  DAB9                	_SYS24:		;(BDOS)ランダムレコードフィールドの設定
  DAB9  E5            		PUSH	HL
  DABA  D5            		PUSH	DE		;EX DE,IY
  DABB  FDE3          		EX	(SP),IY		;
                      	;	POP	DE		;
                      	;	PUSH	DE		;DEを破壊しないように注意vv
  DABD  CD82E6        		CALL	GETSEQ
  DAC0  18E7          		JR	_S24X1		;^^^^^^^^^^^^^^^^^^^^^^^^
                      	
  DAC2                	_SYS5C:		;(BDOS)ファイル名の解析
  DAC2  C5            		PUSH	BC
  DAC3  E5            		PUSH	HL
  DAC4  CDEAE0        		CALL	FILE
  DAC7  E1            		POP	HL
  DAC8  C1            		POP	BC
  DAC9                	S29X1:
  DAC9  C5            		PUSH	BC
  DACA  D5            		PUSH	DE
  DACB  E5            		PUSH	HL
  DACC  EB            		EX	DE,HL
  DACD  2114EF        		LD	HL,FDRV
  DAD0  010D00        		LD	BC,13
  DAD3  EDB0          		LDIR
  DAD5  70            		LD	(HL),B		;B=0
  DAD6  0E03          		LD	C,3
  DAD8  EDB0          		LDIR
  DADA  E1            		POP	HL
  DADB  D1            		POP	DE
  DADC  C1            		POP	BC
  DADD  AF            		XOR	A
  DADE  C9            		RET
                      	
  DADF                	_SYS30:		;(BDOS)論理セクタを用いた書き込み
  DADF  C5            		PUSH	BC
  DAE0  01ECEB        		LD	BC,DWT24B
  DAE3  1804          		JR	S2FX
  DAE5                	_SYS2F:
  DAE5  C5            		PUSH	BC
  DAE6  01DCEB        		LD	BC,DRD24B
  DAE9                	S2FX:
  DAE9  ED43FFDA      		LD	(S2FPAT+1),BC
  DAED  CDDFEF        		CALL	_FFLUSH
                      	
  DAF0  D5            		PUSH	DE
  DAF1  E5            		PUSH	HL
  DAF2  7D            		LD	A,L		;Drive
  DAF3  CDD9EF        		CALL	_CHGDRV
  DAF6  3809          		JR	C,S30X2
  DAF8  44            		LD	B,H		;Number of clusters
  DAF9  2A8AEF        		LD	HL,(_DTA)
                      	
  DAFC  0E00          		LD	C,0
  DAFE  CDDCEB        	S2FPAT:	CALL	DRD24B
  DB01                	S30X2:
  DB01  E1            		POP	HL
  DB02  D1            		POP	DE
  DB03  C1            		POP	BC
  DB04  9F            		SBC	A,A
  DB05  C9            		RET
                      	
  DB06                	_SYS5A:		;(BDOS)カレントディレクトリの変更
  DB06  C5            		PUSH	BC
  DB07  D5            		PUSH	DE
  DB08  E5            		PUSH	HL
  DB09  CDDFE0        		CALL	FILEC
  DB0C  210000        		LD	HL,0
  DB0F  1114EF        		LD	DE,FDRV
  DB12  2A4EF0        		LD	HL,(STABLE+2*027H)	;ランダムブロック読み込み
  DB15  CD0F00        		CALL	JP_HL
  DB18  18E7          		JR	S30X2
                      	
                      	;X1IO.ASM
                      	
                      	;	LSX-Dodgers IO
                      	;	X1/turbo/Z
                      	
  D85D                	_SYS04	EQU	_ERROR		;(BDOS)外部出力
  D85D                	_SYS05	EQU	_ERROR		;(BDOS)プリンタ出力
  D85D                	_SYS1C	EQU	_ERROR		;(BDOS)ディスクの書き込み禁止化
  D85D                	_SYS1E	EQU	_ERROR		;(BDOS)ファイル属性の設定
  D85D                	_SYS20	EQU	_ERROR		;(BDOS)利用者番号の設定と読み出し
  D85D                	_SYS2E	EQU	_ERROR		;(BDOS)ベリファイ・フラグの設定
                      	
  DB1A                	BIOS:
  DB1A  E5            		PUSH	HL
  DB1B  211080        		LD	HL,08010H
  DB1E  39            		ADD	HL,SP
  DB1F  E1            		POP	HL
  DB20  300E          		JR	NC,BIOS2
  DB22                	BIOS1:
  DB22  CD2ADB        		CALL	BIOS3
  DB25  061E          		LD	B,01EH
  DB27  ED79          		OUT	(C),A
  DB29  C9            		RET
  DB2A                	BIOS3:
  DB2A  C5            		PUSH	BC
  DB2B  061D          		LD	B,01DH
  DB2D  ED79          		OUT	(C),A
  DB2F  C9            		RET
  DB30                	BIOS2:
  DB30  ED733BDB      		LD	(SPPAT+1),SP	;スタックがBIOS-ROMと被っている場合
  DB34  31CAFF        		LD	SP,EXTSP
  DB37  CD22DB        		CALL	BIOS1
  DB3A  310000        	SPPAT:	LD	SP,0
  DB3D  C9            		RET
                      	
  DB3E                	INT:
  DB3E  F5            		PUSH	AF
  DB3F  E5            		PUSH	HL
  DB40  ED7351DB      		LD	(INTSP+1),SP
  DB44  210001        		LD	HL,00100H
  DB47  39            		ADD	HL,SP
  DB48  3803          		JR	C,INTP1X
  DB4A  31CAFF        		LD	SP,EXTSP
  DB4D                	INTP1X:
  DB4D  CD58DB        		CALL	INTP1
  DB50  310000        	INTSP:	LD	SP,0
  DB53                	INTPE:
  DB53  E1            		POP	HL
  DB54                	INTPE2:
  DB54  F1            		POP	AF
  DB55                	INTCTCE:
  DB55  FB            		EI
  DB56  ED4D          		RETI
  DB58                	INTP1:
  DB58  C5            		PUSH	BC
                      	
  DB59  CD25DF        		CALL	IN49SB
  DB5C  67            		LD	H,A
  DB5D  CD25DF        		CALL	IN49SB
  DB60  6F            		LD	L,A
                      	
  DB61  FE08          		CP	8		;DELキー
  DB63  2005          		JR	NZ,SCEXE
  DB65  7C            		LD	A,H
  DB66  E611          		AND	011H		;CTRLキー + GRAPHキー
  DB68  2808          		JR	Z,RESET
  DB6A                	SCEXE:
  DB6A  2292EF        		LD	(_KEYD),HL
  DB6D  CD9EDB        		CALL	KEYSET1
                      	
  DB70  C1            		POP	BC
  DB71  C9            		RET
                      	
  DB72                	RESET:
  DB72  3E1D          		LD	A,01DH
  DB74  D300          		OUT	(0),A
  DB76  C7            		RST	0
                      	
  DB77                	INTCTC2:
  DB77  F5            		PUSH	AF
  DB78  3E00          	INTCPAT:LD	A,000H
  DB7A  3D            		DEC	A
  DB7B  3279DB        		LD	(INTCPAT+1),A
  DB7E  20D4          		JR	NZ,INTPE2
                      	
  DB80  3A92EF        		LD	A,(_KEYD)
  DB83  B7            		OR	A
  DB84  28CE          		JR	Z,INTPE2
  DB86                	KEYSET0:
  DB86  E5            		PUSH	HL
  DB87  2A90EF        		LD	HL,(_KEYPS)
  DB8A  7C            		LD	A,H
  DB8B  AD            		XOR	L
  DB8C  2006          		JR	NZ,INTC2A
                      	
  DB8E  2A92EF        		LD	HL,(_KEYD)
  DB91  CDC8DB        		CALL	KEYSET
  DB94                	INTC2A:
  DB94  3A94EF        		LD	A,(_KEYSP)
  DB97  E60F          		AND	00FH
  DB99  3279DB        		LD	(INTCPAT+1),A
                      	
  DB9C  18B5          		JR	INTPE
                      	
  DB9E                	KEYSET1:
  DB9E  CB6C          		BIT	5,H
  DBA0  F5            		PUSH	AF
  DBA1  ED4B8CEF      		LD	BC,(_CTC)
  DBA5  78            		LD	A,B
  DBA6  B1            		OR	C
  DBA7  2006          		JR	NZ,KEYS10E
                      	
  DBA9  F1            		POP	AF
  DBAA  201C          		JR	NZ,KEYSET
  DBAC  F5            		PUSH	AF
  DBAD  18D7          		JR	KEYSET0
  DBAF                	KEYS10E:
  DBAF  F1            		POP	AF
  DBB0  C8            		RET	Z
  DBB1  F5            		PUSH	AF
  DBB2  3E03          		LD	A,3		;CTC STOP
  DBB4  ED79          		OUT	(C),A
  DBB6  F1            		POP	AF
                      	
  DBB7  B7            		OR	A
  DBB8  C8            		RET	Z
                      	
  DBB9  E5            		PUSH	HL
  DBBA  2A94EF        		LD	HL,(_KEYSP)
  DBBD  3EA7          		LD	A,0A7H
  DBBF  ED79          		OUT	(C),A
  DBC1  ED69          		OUT	(C),L
  DBC3  7C            		LD	A,H
  DBC4  3279DB        		LD	(INTCPAT+1),A
  DBC7  E1            		POP	HL
                      	
  DBC8                	KEYSET:
  DBC8  7D            		LD	A,L
  DBC9  CB7C          		BIT	7,H
  DBCB  CCF9DB        		CALL	Z,FKEY
  DBCE  CB74          		BIT	6,H
  DBD0  C0            		RET	NZ
  DBD1                	KEYBS:
  DBD1  B7            		OR	A
  DBD2  C8            		RET	Z
  DBD3                	KEYBS1:
  DBD3  CDE9DB        		CALL	KEYBC_IFBREAK
  DBD6  E5            		PUSH	HL
  DBD7  F5            		PUSH	AF
  DBD8  2A90EF        		LD	HL,(_KEYPS)
  DBDB  2C            		INC	L
  DBDC  7D            		LD	A,L
  DBDD  BC            		CP	H
  DBDE  2815          		JR	Z,POP_AF_HL_SCF_RET
  DBE0  3290EF        		LD	(_KEYPS),A
  DBE3  26FE          		LD	H,KEYBF/256
  DBE5  F1            		POP	AF
  DBE6  77            		LD	(HL),A
  DBE7  E1            		POP	HL
  DBE8  C9            		RET
  DBE9                	KEYBC_IFBREAK:
  DBE9  FE03          		CP	3
  DBEB  C0            		RET	NZ
  DBEC                	KEYBC:
  DBEC  E5            		PUSH	HL
  DBED  210000        		LD	HL,0
  DBF0  2290EF        		LD	(_KEYPS),HL
  DBF3  E1            		POP	HL
  DBF4  C9            		RET
                      	
  DBF5                	POP_AF_HL_SCF_RET:
  DBF5  F1            		POP	AF
  DBF6  E1            		POP	HL
  DBF7  37            		SCF
  DBF8  C9            		RET
                      	
  DBF9                	FKEY:
  DBF9  CB75          		BIT	6,L
  DBFB  C8            		RET	Z
  DBFC  3E1B          		LD	A,01BH
  DBFE  CDD3DB        		CALL	KEYBS1
  DC01  7D            		LD	A,L
  DC02  C6AF          		ADD	A,020H-'q'
  DC04  CB7D          		BIT	7,L
  DC06  C8            		RET	Z
  DC07  2E50          		LD	L,'P'
  DC09  D690          		SUB	0E1H+020H-'q'
  DC0B  2810          		JR	Z,KEYBSL
  DC0D  2C            		INC	L
  DC0E  3D            		DEC	A
  DC0F  280C          		JR	Z,KEYBSL
  DC11  2C            		INC	L
  DC12  D609          		SUB	0EBH-0E2H
  DC14  2807          		JR	Z,KEYBSL
  DC16  2E43          		LD	L,'C'
  DC18  3D            		DEC	A
  DC19  2802          		JR	Z,KEYBSL
  DC1B  2E58          		LD	L,'X'
  DC1D                	KEYBSL:
  DC1D  7D            		LD	A,L
  DC1E  18B3          		JR	KEYBS1
                      	
  DC20                	_SYS01:		;(BDOS)コンソール入力
  DC20  CD09EF        		CALL	_SYS07
  DC23                	MSG_A:
  DC23  F5            		PUSH	AF
  DC24  D5            		PUSH	DE
  DC25  5F            		LD	E,A
  DC26  CD2CDC        		CALL	_SYS02
  DC29  D1            		POP	DE
  DC2A  F1            		POP	AF
  DC2B  C9            		RET
                      	
  DC2C                	_SYS02:		;(BDOS)コンソール出力
  DC2C  CD3EDC        		CALL	BREAK
  DC2F  1805          		JR	PRINTX
                      	
  DC31                	_SYS06:		;(BDOS)コンソール直接入出力
  DC31  7B            		LD	A,E
  DC32  3C            		INC	A
  DC33  CACAEF        		JP	Z,_INKEY
  DC36                	PRINTX:
  DC36  C3CDEF        		JP	_PRINT
                      	
  DC39                	_SYS08:		;(BDOS)エコーなしコンソール入力
  DC39  CD09EF        		CALL	_SYS07
  DC3C  1804          		JR	BREAK1
  DC3E                	BREAK:
  DC3E  FB            		EI
  DC3F  3A92EF        		LD	A,(_KEYD)
  DC42                	BREAK1:
  DC42  FE03          		CP	3		;CTRL+C
  DC44  CA00EF        		JP	Z,CPM_BOOT
  DC47  FE13          		CP	013H		;CTRL+S
  DC49  C0            		RET	NZ
                      	
  DC4A                	PAUSE:
  DC4A  CDECDB        		CALL	KEYBC
                      	
  DC4D                	FLGET:
  DC4D  CDDFEF        		CALL	_FFLUSH
  DC50  C5            		PUSH	BC
  DC51  E5            		PUSH	HL
  DC52  ED4B8EEF      		LD	BC,(_TXADR)
  DC56  CBE8          		SET	5,B
  DC58  ED60          		IN	H,(C)
  DC5A                	FLGET1:
  DC5A  3A93EF        		LD	A,(_KEYD+1)
  DC5D  0F            		RRCA
  DC5E  0F            		RRCA
  DC5F  E610          		AND	010H
  DC61  F608          		OR	8
  DC63  ED68          		IN	L,(C)
  DC65  B5            		OR	L
  DC66  ED79          		OUT	(C),A
  DC68  CDCAEF        		CALL	_INKEY
  DC6B  28ED          		JR	Z,FLGET1
  DC6D  ED61          		OUT	(C),H
  DC6F  E1            		POP	HL
  DC70  C1            		POP	BC
  DC71  C9            		RET
                      	
  DC72                	_SYS0A:		;(BDOS)文字列入力
  DC72  C5            		PUSH	BC
  DC73  E5            		PUSH	HL
  DC74  D5            		PUSH	DE
  DC75  CD70E0        		CALL	GETL
  DC78  1100FF        		LD	DE,KBUF
  DC7B  E1            		POP	HL
  DC7C  E5            		PUSH	HL
  DC7D  0E00          		LD	C,0
  DC7F  3004          		JR	NC,SAX0
  DC81  23            		INC	HL
  DC82  23            		INC	HL
  DC83  1808          		JR	SAX4
  DC85                	SAX0:
  DC85  46            		LD	B,(HL)
  DC86  23            		INC	HL
  DC87                	SAX1:
  DC87  23            		INC	HL
  DC88  1A            		LD	A,(DE)
  DC89  13            		INC	DE
  DC8A  B7            		OR	A
  DC8B  2004          		JR	NZ,SAX2
  DC8D                	SAX4:
  DC8D  360D          		LD	(HL),00DH
  DC8F  1804          		JR	SAX3
  DC91                	SAX2:
  DC91  77            		LD	(HL),A
  DC92  0C            		INC	C
  DC93  10F2          		DJNZ	SAX1
  DC95                	SAX3:
  DC95  D1            		POP	DE
  DC96  79            		LD	A,C
  DC97  13            		INC	DE
  DC98  12            		LD	(DE),A
  DC99  1B            		DEC	DE
  DC9A  E1            		POP	HL
  DC9B  C1            		POP	BC
  DC9C  A7            		AND	A
  DC9D  C9            		RET
                      	
  DC9E                	_SYS0B:		;(BDOS)コンソール状態のチェック
  DC9E  CD3EDC        		CALL	BREAK
  DCA1  3A92EF        		LD	A,(_KEYD)
  DCA4  B7            		OR	A
  DCA5  C8            		RET	Z
  DCA6                	CONSTX:
  DCA6  CDDFEF        		CALL	_FFLUSH
  DCA9  E5            		PUSH	HL
  DCAA  2A90EF        		LD	HL,(_KEYPS)
  DCAD  7C            		LD	A,H
  DCAE  AD            		XOR	L
  DCAF  E1            		POP	HL
  DCB0  C6FF          		ADD	A,0FFH
  DCB2  9F            		SBC	A,A
  DCB3  C9            		RET
                      	
  DCB4                	_SYS2A:		;(BDOS)日付の獲得
  DCB4  C5            		PUSH	BC
  DCB5  3EED          		LD	A,0EDH		;Read calendar
  DCB7  CD40DF        		CALL	COMOUT
  DCBA  CDD7DC        		CALL	IN49SB_BCD	;YY
  DCBD  6F            		LD	L,A
  DCBE  2600          		LD	H,0
                      	;	LD	DE,1900		;0076CH
                      	;	CP	90		;90以上は1900年代 1990-1999
                      	;	JR	NC,RDDATE1	;90未満は2000年代 2000-2089
                      	;	LD	E,0D0H		;2000 & 0FFH D=007H
  DCC0  11D007        		LD	DE,2000		;すべて2000年代で処理 2000-2099
  DCC3                	RDDATE1:
  DCC3  19            		ADD	HL,DE
  DCC4  CD25DF        		CALL	IN49SB		;MM
  DCC7  57            		LD	D,A
  DCC8  CDD7DC        		CALL	IN49SB_BCD	;DD
  DCCB  5F            		LD	E,A
  DCCC  7A            		LD	A,D
  DCCD  E607          		AND	7
  DCCF  0604          		LD	B,4
  DCD1                	RDDATE2:
  DCD1  CB3A          		SRL	D
  DCD3  10FC          		DJNZ	RDDATE2
  DCD5  C1            		POP	BC
  DCD6  C9            		RET
  DCD7                	IN49SB_BCD:
  DCD7  CD25DF        		CALL	IN49SB
                      	;------------------------
                      	;BCDの10進数化
                      	;in
                      	;	A  : BCD
                      	;out
                      	;	A  : 10進数
                      	;------------------------
  DCDA  4F            		LD	C,A
  DCDB  E6F0          		AND	0F0H	;10の位
  DCDD  0F            		RRCA
  DCDE  47            		LD	B,A
  DCDF  0F            		RRCA
  DCE0  0F            		RRCA
  DCE1  80            		ADD	A,B
  DCE2  47            		LD	B,A
  DCE3  79            		LD	A,C
  DCE4  E60F          		AND	00FH	;1の位
  DCE6  80            		ADD	A,B
  DCE7  C9            		RET
                      	
  DCE8                	_SYS2C:		;(BDOS)時刻の獲得
  DCE8  C5            		PUSH	BC
  DCE9  3EEF          		LD	A,0EFH		;Read time
  DCEB  CD40DF        		CALL	COMOUT
  DCEE  CDD7DC        		CALL	IN49SB_BCD	;TT
  DCF1  67            		LD	H,A
  DCF2  CDD7DC        		CALL	IN49SB_BCD	;MM
  DCF5  6F            		LD	L,A
  DCF6  CDD7DC        		CALL	IN49SB_BCD	;SS
  DCF9  57            		LD	D,A
  DCFA  C1            		POP	BC
  DCFB  AF            		XOR	A
  DCFC  C9            		RET
                      	
  DCFD                	ESC1:
  DCFD  7B            		LD	A,E
  DCFE  FE41          		CP	'A'
  DD00  CA41DE        		JP	Z,CTRL1E
  DD03  FE42          		CP	'B'
  DD05  CAABDF        		JP	Z,CTRL1F
  DD08  FE43          		CP	'C'
  DD0A  CA4CDE        		JP	Z,CTRL1C
  DD0D  FE44          		CP	'D'
  DD0F  CA38DE        		JP	Z,CTRL1D
  DD12  FE45          		CP	'E'
  DD14  2802          		JR	Z,CT0CX
  DD16  FE6A          		CP	'j'
  DD18                	CT0CX:
  DD18  CA7EDF        		JP	Z,CTRL0C
  DD1B  FE48          		CP	'H'
  DD1D  CAC6DE        		JP	Z,CTRL0B
  DD20  FE4A          		CP	'J'
  DD22  CA81DF        		JP	Z,CTRL06
  DD25  FE4B          		CP	'K'
  DD27  CA85DE        		JP	Z,CTRL05
  DD2A  FE4C          		CP	'L'
  DD2C  CAC0DF        		JP	Z,CTRL0E
  DD2F  FE54          		CP	'T'
  DD31  CA85DE        		JP	Z,CTRL05
  DD34  FE78          		CP	'x'
  DD36  2804          		JR	Z,ESC1X
  DD38  FE79          		CP	'y'
  DD3A  2002          		JR	NZ,ESC1Y
  DD3C                	ESC1X:
  DD3C  3601          		LD	(HL),1
  DD3E                	ESC1Y:
  DD3E  FE3D          		CP	'='
  DD40  2804          		JR	Z,ESC1W
  DD42  FE59          		CP	'Y'
  DD44  2002          		JR	NZ,ESC1Z
  DD46                	ESC1W:
  DD46  3602          		LD	(HL),2
  DD48                	ESC1Z:
  DD48  FE20          		CP	020H
  DD4A  3802          		JR	C,ESC1C
  DD4C  87            		ADD	A,A
  DD4D  D0            		RET	NC
  DD4E                	ESC1C:
  DD4E  E1            		POP	HL
  DD4F  1849          		JR	ANK
                      	
  DD51                	ESC:
  DD51  21ABDD        		LD	HL,PRINTE5
  DD54  E5            		PUSH	HL
  DD55  2177DD        		LD	HL,ESCFLG+1
  DD58  3600          		LD	(HL),0
  DD5A  3D            		DEC	A
  DD5B  28A0          		JR	Z,ESC1
  DD5D  3D            		DEC	A
  DD5E  2009          		JR	NZ,ESC2
  DD60  3603          		LD	(HL),3
  DD62  7B            		LD	A,E
  DD63  D620          		SUB	020H
  DD65  326CDD        		LD	(ESCYP+1),A
  DD68  C9            		RET
  DD69                	ESC2:
  DD69  3D            		DEC	A
  DD6A  C0            		RET	NZ
  DD6B  2600          	ESCYP:	LD	H,0
  DD6D  7B            		LD	A,E
  DD6E  D620          		SUB	020H
  DD70  6F            		LD	L,A
  DD71  C3D6EF        		JP	_LOC
                      	
  DD74                	PRINT:
  DD74  C5            		PUSH	BC
  DD75  E5            		PUSH	HL
  DD76  3E00          	ESCFLG:	LD	A,000H
  DD78  B7            		OR	A
  DD79  20D6          		JR	NZ,ESC
                      	
  DD7B  3E1F          		LD	A,01FH
  DD7D  BB            		CP	E
  DD7E  302F          		JR	NC,CTRL
  DD80  0149DF        	INSFLG:	LD	BC,INSERT
                      	
  DD83  3E00          	KANFLG:	LD	A,000H
  DD85  B7            		OR	A
  DD86  203A          		JR	NZ,KANJI2
  DD88  7B            	X1KPAT:	LD	A,E
  DD89  FE80          		CP	080H
  DD8B  380D          		JR	C,ANK
  DD8D  FEA0          		CP	0A0H
  DD8F  3804          		JR	C,KANJI1
  DD91  FEE0          		CP	0E0H
  DD93  3805          		JR	C,ANK
  DD95                	KANJI1:
  DD95  3284DD        		LD	(KANFLG+1),A
  DD98  1811          		JR	PRINTE5
  DD9A                	ANK:
  DD9A  ED4B8EEF      		LD	BC,(_TXADR)
  DD9E  78            		LD	A,B
  DD9F  F638          		OR	038H
  DDA1  47            		LD	B,A
  DDA2  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令	kanji
  DDA4  CB98          		RES	3,B
  DDA6  ED59          		OUT	(C),E		;Text
  DDA8                	KANJIE:
  DDA8  CD0DDE        		CALL	PRINTE7
  DDAB                	PRINTE5:
  DDAB  E1            		POP	HL
  DDAC  C1            		POP	BC
  DDAD  AF            		XOR	A
  DDAE  C9            		RET
                      	
  DDAF                	CTRL:
  DDAF  CDF4DD        		CALL	KANCLR
  DDB2  7B            		LD	A,E
  DDB3  87            		ADD	A,A
  DDB4  F680          		OR	080H
  DDB6  6F            		LD	L,A
  DDB7  26F0          		LD	H,CTRLTB/256
  DDB9  7E            		LD	A,(HL)
  DDBA  2C            		INC	L
  DDBB  66            		LD	H,(HL)
  DDBC  6F            		LD	L,A
  DDBD  CD0F00        		CALL	JP_HL
  DDC0  18E9          		JR	PRINTE5
                      	
  DDC2                	KANJI2:
  DDC2  D5            		PUSH	DE
  DDC3  57            		LD	D,A
  DDC4  01812F        		LD	BC,02F81H	;SFTJIS
  DDC7  DF            		RST	018H
  DDC8  01C32F        		LD	BC,02FC3H	;Instead or JISVRM
  DDCB  DF            		RST	018H
                      	
  DDCC  ED4B8EEF      		LD	BC,(_TXADR)
  DDD0  78            		LD	A,B
  DDD1  F638          		OR	038H
  DDD3  47            		LD	B,A
  DDD4  ED51          		OUT	(C),D		;kanji
  DDD6  CB98          		RES	3,B
  DDD8  ED59          		OUT	(C),E		;Text
  DDDA  CD0DDE        		CALL	PRINTE7
  DDDD  ED4B8EEF      		LD	BC,(_TXADR)
  DDE1  78            		LD	A,B
  DDE2  F638          		OR	038H
  DDE4  47            		LD	B,A
  DDE5  CBF2          		SET	6,D
  DDE7  ED51          		OUT	(C),D		;Kanji
  DDE9  CB98          		RES	3,B
  DDEB  ED59          		OUT	(C),E		;Text
  DDED  D1            		POP	DE
  DDEE  AF            		XOR	A
  DDEF  3284DD        		LD	(KANFLG+1),A
  DDF2  18B4          		JR	KANJIE
                      	
  DDF4                	KANCLR:
  DDF4  3A84DD        		LD	A,(KANFLG+1)
  DDF7  B7            		OR	A
  DDF8  C8            		RET	Z
  DDF9  ED4B8EEF      		LD	BC,(_TXADR)
  DDFD  78            		LD	A,B
  DDFE  F638          		OR	038H
  DE00  47            		LD	B,A
  DE01  AF            		XOR	A
  DE02  3284DD        		LD	(KANFLG+1),A
  DE05  ED79          		OUT	(C),A		;Kanji
  DE07  CB98          		RES	3,B
  DE09  3E20          		LD	A,020H
  DE0B  ED79          		OUT	(C),A		;Text
  DE0D                	PRINTE7:
  DE0D  CBA0          		RES	4,B
  DE0F                	PRINTE6:
  DE0F  3A96EF        		LD	A,(_COLORF)
  DE12                	PRINTE4:
  DE12  ED79          		OUT	(C),A		;Color
  DE14  78            		LD	A,B
  DE15  E607          		AND	7
  DE17  47            		LD	B,A
  DE18                	PRINTE2:
  DE18  03            		INC	BC
  DE19                	PRINTE3:
  DE19  2ABAEF        		LD	HL,(CRTCD+10)
  DE1C  A7            		AND	A
  DE1D  ED4A          		ADC	HL,BC
  DE1F                	PRINTE8:
  DE1F  2805          		JR	Z,PRINT2
  DE21  ED438EEF      		LD	(_TXADR),BC
  DE25                	CTRL00:
  DE25  C9            		RET
                      	
  DE26                	PRINT2:
  DE26  CDC6DF        		CALL	SCR
  DE29  2ABCEF        		LD	HL,(CRTCD+12)
  DE2C  09            		ADD	HL,BC
  DE2D                	SET_TXADR_HL:
  DE2D  228EEF        		LD	(_TXADR),HL
  DE30  C9            		RET
                      	
  DE31                	CTRL08:
  DE31  3A80DD        		LD	A,(INSFLG)
  DE34  FECD          		CP	0CDH		;CALL ????
  DE36  2829          		JR	Z,CTRL02
  DE38                	CTRL1D:
  DE38  2A8EEF        		LD	HL,(_TXADR)
  DE3B  7C            		LD	A,H
  DE3C  B5            		OR	L
  DE3D  C8            		RET	Z
  DE3E  2B            		DEC	HL
  DE3F  18EC          		JR	SET_TXADR_HL
                      	
  DE41                	CTRL1E:
  DE41  ED4B8EEF      		LD	BC,(_TXADR)
  DE45  2ABCEF        		LD	HL,(CRTCD+12)
  DE48  09            		ADD	HL,BC
  DE49  D0            		RET	NC
  DE4A  18E1          		JR	SET_TXADR_HL
                      	
  DE4C                	CTRL1C:
  DE4C  ED4B8EEF      		LD	BC,(_TXADR)
  DE50  18C6          		JR	PRINTE2
                      	
  DE52                	CTRL09:
  DE52  ED4B8EEF      		LD	BC,(_TXADR)
  DE56  79            		LD	A,C
  DE57  E6F8          		AND	0F8H
  DE59  C608          		ADD	A,8
  DE5B  4F            		LD	C,A
  DE5C  88            		ADC	A,B
  DE5D  91            		SUB	C
  DE5E  47            		LD	B,A
  DE5F  18B8          		JR	PRINTE3
                      	
  DE61                	CTRL02:
  DE61  CD38DE        		CALL	CTRL1D
  DE64  C8            		RET	Z
  DE65  D5            		PUSH	DE
  DE66  CDD3EF        		CALL	_POS
  DE69  3AB1EF        		LD	A,(CRTCD+1)
  DE6C  95            		SUB	L
  DE6D  4F            		LD	C,A
  DE6E  0D            		DEC	C
  DE6F  0638          		LD	B,038H
  DE71  2A8EEF        		LD	HL,(_TXADR)
  DE74  09            		ADD	HL,BC
  DE75  44            		LD	B,H
  DE76  4D            		LD	C,L
  DE77  110020        		LD	DE,02000H	;D:Text E:kanji
  DE7A  2A96EF        		LD	HL,(_COLORF)	;L:Color
  DE7D                	C8X1:
  DE7D  CD65DF        		CALL	C12S
  DE80  0B            		DEC	BC
  DE81  20FA          		JR	NZ,C8X1
  DE83  D1            		POP	DE
  DE84  C9            		RET
                      	
  DE85                	CTRL05:
  DE85  CDD3EF        		CALL	_POS
  DE88  3AB1EF        		LD	A,(CRTCD+1)
  DE8B  95            		SUB	L
  DE8C  6F            		LD	L,A
  DE8D                	C08X1:
  DE8D  ED4B8EEF      		LD	BC,(_TXADR)
  DE91                	LINECL:
  DE91  2620          		LD	H,020H
  DE93  3A96EF        		LD	A,(_COLORF)
  DE96  CBE8          		SET	5,B
  DE98                	LINECL1:
  DE98  CBD8          		SET	3,B
  DE9A  CBE0          		SET	4,B
  DE9C  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令	kanji
  DE9E  CB98          		RES	3,B
  DEA0  ED61          		OUT	(C),H		;Text
  DEA2  CBA0          		RES	4,B
  DEA4  ED79          		OUT	(C),A		;Color
  DEA6  03            		INC	BC
  DEA7  2D            		DEC	L
  DEA8  20EE          		JR	NZ,LINECL1
  DEAA  C9            		RET
                      	
  DEAB                	CTRL0D:
  DEAB  CDD3EF        		CALL	_POS
  DEAE  2E00          		LD	L,0
  DEB0                	LOC:
  DEB0  C5            		PUSH	BC
  DEB1  E5            		PUSH	HL
  DEB2  CDF4DD        		CALL	KANCLR
  DEB5  CDD3DE        		CALL	LOC1
  DEB8  228EEF        		LD	(_TXADR),HL
  DEBB  E1            		POP	HL
  DEBC  C1            		POP	BC
  DEBD  C9            		RET
                      	
  DEBE                	CTRL12:
  DEBE  2180DD        		LD	HL,INSFLG
  DEC1  7E            		LD	A,(HL)
  DEC2  EECC          		XOR	0CCH		;CD:CALL ???? 1:LD BC,????
  DEC4  77            		LD	(HL),A
  DEC5  C9            		RET
                      	
  DEC6                	CTRL0B:
  DEC6  210000        		LD	HL,0
  DEC9  228EEF        		LD	(_TXADR),HL
  DECC  C9            		RET
                      	
  DECD                	CTRL1B:
  DECD  3E01          		LD	A,1
  DECF  3277DD        		LD	(ESCFLG+1),A
  DED2  C9            		RET
                      	
  DED3                	LOC1:
  DED3  D5            		PUSH	DE
  DED4  4D            		LD	C,L
  DED5  0608          		LD	B,8
  DED7  5C            		LD	E,H
  DED8  1600          		LD	D,0
  DEDA  2AB0EF        		LD	HL,(CRTCD)
  DEDD  6A            		LD	L,D
  DEDE                	LOC2:
  DEDE  29            		ADD	HL,HL
  DEDF  3001          		JR	NC,LOC3
  DEE1  19            		ADD	HL,DE
  DEE2                	LOC3:
  DEE2  10FA          		DJNZ	LOC2
  DEE4  09            		ADD	HL,BC
  DEE5  D1            		POP	DE
  DEE6  C9            		RET
                      	
  DEE7                	CONOUT1:
  DEE7  CDF9DE        		CALL	CURSOR
  DEEA  59            		LD	E,C
  DEEB  CDCDEF        		CALL	_PRINT
  DEEE  7B            		LD	A,E
  DEEF  FE0A          		CP	00AH
  DEF1  2006          		JR	NZ,CURSOR
  DEF3  CDABDE        		CALL	CTRL0D
  DEF6  CD85DE        		CALL	CTRL05
  DEF9                	CURSOR:
  DEF9  C5            		PUSH	BC
  DEFA  ED4B8EEF      		LD	BC,(_TXADR)
  DEFE  CBE8          		SET	5,B
  DF00  ED78          		IN	A,(C)
  DF02  EE18          		XOR	018H
  DF04  ED79          		OUT	(C),A
  DF06  C1            		POP	BC
  DF07  C9            		RET
                      	
  DF08                	CTRL07:
  DF08  2161EF        		LD	HL,BEEPD
  DF0B                	BEEP1:
  DF0B  7E            		LD	A,(HL)
  DF0C  23            		INC	HL
  DF0D  FEFF          		CP	0FFH
  DF0F  C8            		RET	Z
  DF10  F3            		DI
  DF11  061C          		LD	B,01CH
  DF13  ED79          		OUT	(C),A
  DF15  EDA3          		OUTI
  DF17  FB            		EI
  DF18  18F1          		JR	BEEP1
                      	
  DF1A                	OT49SB:
  DF1A  C5            		PUSH	BC
  DF1B  CD36DF        		CALL	CANW
  DF1E  010019        		LD	BC,01900H
  DF21  ED79          		OUT	(C),A
  DF23  C1            		POP	BC
  DF24  C9            		RET
                      	
  DF25                	IN49SB:
  DF25  C5            		PUSH	BC
  DF26  01011A        		LD	BC,01A01H
  DF29                	CANR:
  DF29  ED78          		IN	A,(C)
  DF2B  E620          		AND	020H
  DF2D  20FA          		JR	NZ,CANR
  DF2F  010019        		LD	BC,01900H
  DF32  ED78          		IN	A,(C)
  DF34  C1            		POP	BC
  DF35  C9            		RET
                      	
  DF36                	CANW:
  DF36  01011A        		LD	BC,01A01H
  DF39  ED48          		IN	C,(C)
  DF3B  CB71          		BIT	6,C
  DF3D  20F7          		JR	NZ,CANW
  DF3F  C9            		RET
                      	
  DF40                	COMOUT:
  DF40  FB            		EI
  DF41  CD1ADF        		CALL	OT49SB
  DF44  CD36DF        		CALL	CANW
  DF47  F3            		DI
  DF48  C9            		RET
                      	
  DF49                	INSERT:
  DF49  D5            		PUSH	DE
  DF4A  CDD3EF        		CALL	_POS
  DF4D  3AB1EF        		LD	A,(CRTCD+1)
  DF50  95            		SUB	L
  DF51  ED4B8EEF      		LD	BC,(_TXADR)
  DF55  110020        		LD	DE,02000H	;D:Text E:Kanji
  DF58  2A96EF        		LD	HL,(_COLORF)	;L:Color
  DF5B  CBE8          		SET	5,B
  DF5D                	C12X1:
  DF5D  CD65DF        		CALL	C12S
  DF60  03            		INC	BC
  DF61  20FA          		JR	NZ,C12X1
  DF63  D1            		POP	DE
  DF64  C9            		RET
                      	
  DF65                	C12S:
  DF65  CBE0          		SET	4,B
  DF67  CBD8          		SET	3,B
  DF69  ED60          		IN	H,(C)
  DF6B  ED59          	X1PAT:	OUT	(C),E
  DF6D  5C            		LD	E,H
  DF6E  CB98          		RES	3,B
  DF70  ED60          		IN	H,(C)
  DF72  ED51          		OUT	(C),D
  DF74  54            		LD	D,H
  DF75  CBA0          		RES	4,B
  DF77  ED60          		IN	H,(C)
  DF79  ED69          		OUT	(C),L
  DF7B  6C            		LD	L,H
  DF7C  3D            		DEC	A
  DF7D  C9            		RET
                      	
  DF7E                	CTRL0C:
  DF7E  CDC6DE        		CALL	CTRL0B
  DF81                	CTRL06:
  DF81  ED4B8EEF      		LD	BC,(_TXADR)
  DF85                	C1AX1:
  DF85  78            		LD	A,B
  DF86  F638          		OR	038H
  DF88  47            		LD	B,A
  DF89  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令	kanji
  DF8B  CB98          		RES	3,B
  DF8D  3E20          		LD	A,020H
  DF8F  ED79          		OUT	(C),A		;Text
  DF91  CBA0          		RES	4,B
  DF93  3A96EF        		LD	A,(_COLORF)
  DF96  ED79          		OUT	(C),A		;Color
  DF98  03            		INC	BC
  DF99  CBA8          		RES	5,B
  DF9B  2ABAEF        		LD	HL,(CRTCD+10)
  DF9E  09            		ADD	HL,BC
  DF9F  30E4          		JR	NC,C1AX1
  DFA1  C9            		RET
                      	
  DFA2                	CTRL04:
  DFA2  CDD3EF        		CALL	_POS
  DFA5  7D            		LD	A,L
  DFA6  B7            		OR	A
  DFA7  C8            		RET	Z
  DFA8                	CTRL03:
  DFA8  CDABDE        		CALL	CTRL0D
  DFAB                	CTRL0A:
  DFAB                	CTRL1F:
  DFAB  ED4B8EEF      		LD	BC,(_TXADR)
  DFAF  2AB1EF        		LD	HL,(CRTCD+1)
  DFB2  2600          		LD	H,0
  DFB4  09            		ADD	HL,BC
  DFB5  44            		LD	B,H
  DFB6  4D            		LD	C,L
  DFB7  2ABAEF        		LD	HL,(CRTCD+10)
  DFBA  09            		ADD	HL,BC
  DFBB  3F            		CCF
  DFBC  9F            		SBC	A,A
  DFBD  C31FDE        		JP	PRINTE8
                      	
  DFC0                	CTRL0E:
  DFC0  CDD3EF        		CALL	_POS
  DFC3  7C            		LD	A,H
  DFC4  1804          		JR	SCR1
  DFC6                	SCR:
  DFC6  3A97EF        		LD	A,(_LINE)
  DFC9  3D            		DEC	A
  DFCA                	SCR1:
  DFCA  C5            		PUSH	BC
  DFCB  D5            		PUSH	DE
  DFCC  F5            		PUSH	AF
  DFCD  3E07          		LD	A,7
  DFCF  2100E0        		LD	HL,SCRDMAD
  DFD2  CDF6DF        		CALL	SETDMA
  DFD5  F1            		POP	AF
  DFD6  210038        		LD	HL,03800H
                      	
  DFD9                	SCRUP1:
  DFD9  B7            		OR	A
  DFDA  284D          		JR	Z,SCRCL
  DFDC  F5            		PUSH	AF
  DFDD  CD07E0        		CALL	UPSUB		;kanji
  DFE0  3ABCEF        		LD	A,(CRTCD+12)
  DFE3  5F            		LD	E,A
  DFE4  16F7          		LD	D,0F7H
  DFE6  19            		ADD	HL,DE
  DFE7  D5            		PUSH	DE
  DFE8  CD07E0        		CALL	UPSUB		;Text
  DFEB  D1            		POP	DE
  DFEC  19            		ADD	HL,DE
  DFED  CD07E0        		CALL	UPSUB		;Color
  DFF0  CBE4          		SET	4,H
  DFF2  F1            		POP	AF
  DFF3  3D            		DEC	A
  DFF4  18E3          		JR	SCRUP1
                      	
  DFF6                	SETDMA:
  DFF6  01871F        		LD	BC,01F87H
  DFF9                	SDMA:
  DFF9  04            		INC	B
  DFFA  EDA3          		OUTI
  DFFC  3D            		DEC	A
  DFFD  20FA          		JR	NZ,SDMA
  DFFF  C9            		RET
                      	
  E000                	SCRDMAD:
  E000  C3            		DB	0C3H		;WR6 リセット
  E001  9A            		DB	09AH		;WR5 ストップ WAIT READY:HIGH
  E002  65            		DB	065H		;WR0 ブロック長(LH)
  E003  4F00          		DW	79
  E005  1C            		DB	01CH		;WR1 ポートAインクリメント I/O
  E006  18            		DB	018H		;WR0 ポートAアドレス(LH)
                      	
  E007                	UPSUB:
  E007  3AB1EF        		LD	A,(CRTCD+1)
  E00A  5F            		LD	E,A
  E00B  1600          		LD	D,0
  E00D  3ECD          		LD	A,0CDH		;WR4 バースト ポートB開始アドレス(LH)
  E00F  ED79          		OUT	(C),A
  E011  ED69          		OUT	(C),L		;SOURCE
  E013  ED61          		OUT	(C),H
  E015  19            		ADD	HL,DE
  E016  3E1D          		LD	A,01DH		;WR0 ポートA開始アドレス(LH) ポートA→ポートB 転送
  E018  ED79          		OUT	(C),A
  E01A  ED69          		OUT	(C),L		;DEST
  E01C  ED61          		OUT	(C),H
  E01E                	GO_DMA:
  E01E  3ECF          		LD	A,0CFH
  E020  ED79          		OUT	(C),A		;WR6 ロード
  E022  3EB3          		LD	A,0B3H
  E024  ED79          		OUT	(C),A		;WR6 強制RDY
  E026  ED49          		OUT	(C),C		;WR6 イネーブル
  E028  C9            		RET
                      	
  E029                	SCRCL:
  E029  44            		LD	B,H
  E02A  4D            		LD	C,L
  E02B  2AB1EF        		LD	HL,(CRTCD+1)
  E02E  CD91DE        		CALL	LINECL
  E031  D1            		POP	DE
  E032  C1            		POP	BC
  E033  C9            		RET
                      	
  E034                	SCRN:
  E034  D5            		PUSH	DE
  E035  ED58          		IN	E,(C)		;Text
  E037  CBD8          		SET	3,B
  E039  ED50          		IN	D,(C)		;Kanji
  E03B  2819          		JR	Z,SCRNE
  E03D  AF            		XOR	A
  E03E  C5            		PUSH	BC
  E03F  013730        		LD	BC,03037H	;VRMJIS
  E042  DF            		RST	018H
  E043  01522F        		LD	BC,02F52H	;JISSFT
  E046  DF            		RST	018H
  E047  C1            		POP	BC
  E048  ED78          		IN	A,(C)
  E04A  CB98          		RES	3,B
  E04C  E640          		AND	040H
  E04E  2003          		JR	NZ,SCRN1
  E050  7A            		LD	A,D
  E051  D1            		POP	DE
  E052  C9            		RET
  E053                	SCRN1:
  E053  7B            		LD	A,E
  E054  D1            		POP	DE
  E055  C9            		RET
                      	
  E056                	SCRNE:
  E056  D1            		POP	DE
  E057  CB98          		RES	3,B
  E059                	SCRNX:
  E059  ED78          		IN	A,(C)
  E05B  C9            		RET
                      	
  E05C                	POS:
  E05C  2A8EEF        		LD	HL,(_TXADR)
  E05F  C5            		PUSH	BC
  E060  ED4BBCEF      		LD	BC,(CRTCD+12)
  E064  AF            		XOR	A
  E065                	POS1:
  E065  09            		ADD	HL,BC
  E066  3C            		INC	A
  E067  38FC          		JR	C,POS1
  E069  ED42          		SBC	HL,BC
  E06B  3D            		DEC	A
  E06C  67            		LD	H,A
  E06D  C1            		POP	BC
  E06E  A7            		AND	A
  E06F  C9            		RET
                      	
  E070                	GETL:
  E070  CDD3EF        		CALL	_POS
  E073  E5            		PUSH	HL
  E074  3ECD          		LD	A,0CDH		;CALL ????
  E076  3280DD        		LD	(INSFLG),A
  E079                	GETL1:
  E079  CD39DC        		CALL	_SYS08
  E07C  FE09          		CP	9
  E07E  2008          		JR	NZ,GETL1V
  E080  2100FF        		LD	HL,KBUF
  E083  CD6ED8        		CALL	MSX
  E086  18F1          		JR	GETL1
  E088                	GETL1V:
  E088  5F            		LD	E,A
  E089  CDCDEF        		CALL	_PRINT
                      	
  E08C  7B            		LD	A,E
  E08D  FE0D          		CP	00DH
  E08F  20E8          		JR	NZ,GETL1
  E091  3E01          		LD	A,1		;LD BC,????
  E093  3280DD        		LD	(INSFLG),A
  E096  1100FF        		LD	DE,KBUF
  E099  3AB1EF        		LD	A,(CRTCD+1)
  E09C  47            		LD	B,A
  E09D  CD05D5        		CALL	ZERO_MEMORY_DE
                      	
  E0A0  D1            		POP	DE
  E0A1  CDD3EF        		CALL	_POS
  E0A4  6B            		LD	L,E
  E0A5  3AB1EF        		LD	A,(CRTCD+1)
  E0A8  95            		SUB	L
  E0A9  57            		LD	D,A
  E0AA  CDD3DE        		CALL	LOC1
  E0AD  4D            		LD	C,L
  E0AE  7C            		LD	A,H
  E0AF  F630          		OR	030H
  E0B1  47            		LD	B,A
  E0B2  5A            		LD	E,D
  E0B3  2100FF        		LD	HL,KBUF
  E0B6                	GETL2:
  E0B6  CDD0EF        		CALL	_SCRN
  E0B9  03            		INC	BC
  E0BA  77            		LD	(HL),A
  E0BB  23            		INC	HL
  E0BC  1D            		DEC	E
  E0BD  20F7          		JR	NZ,GETL2
  E0BF                	GETL3:
  E0BF  2B            		DEC	HL
  E0C0  7E            		LD	A,(HL)
  E0C1  FE21          		CP	021H
  E0C3  D0            		RET	NC
  E0C4  3600          		LD	(HL),0
  E0C6  15            		DEC	D
  E0C7  20F6          		JR	NZ,GETL3
  E0C9  C9            		RET
                      	
  E0CA                	INKEY:
  E0CA  FB            		EI
  E0CB  E5            		PUSH	HL
  E0CC  2A90EF        		LD	HL,(_KEYPS)
  E0CF  7C            		LD	A,H
  E0D0  AD            		XOR	L
  E0D1  2809          		JR	Z,INKEY1
  E0D3  7C            		LD	A,H
  E0D4  3C            		INC	A
  E0D5  3291EF        		LD	(_KEYPS+1),A
  E0D8  6F            		LD	L,A
  E0D9  26FE          		LD	H,KEYBF/256
  E0DB  7E            		LD	A,(HL)
  E0DC                	INKEY1:
  E0DC  E1            		POP	HL
  E0DD  B7            		OR	A
  E0DE  C9            		RET
                      	
  10BA                	AT_RS	EQU	SCR1-AT_SCR1
                      	
                      	;LDFILE.ASM
                      	
                      	;	LSX-Dodgers FILE
                      	
  E0DF                	FILEC:
  E0DF  CDEAE0        		CALL	FILE
  E0E2                	FILEC2:
  E0E2  3A15EF        		LD	A,(FDRV+1)
  E0E5  FE20          		CP	020H
  E0E7  C8            		RET	Z
  E0E8  1839          		JR	SETDIR1
                      	
  E0EA                	FILE:
  E0EA  AF            		XOR	A
  E0EB  3214EF        		LD	(FDRV),A
  E0EE  67            		LD	H,A
  E0EF  6F            		LD	L,A
  E0F0  2222EF        		LD	(FDRV+14),HL
  E0F3  CDC1E1        		CALL	SPCUT
  E0F6  CDA6E1        		CALL	CCHK3
  E0F9  2812          		JR	Z,DEVI1
  E0FB  13            		INC	DE
  E0FC  1A            		LD	A,(DE)
  E0FD  1B            		DEC	DE
  E0FE  FE3A          		CP	':'
  E100  200B          		JR	NZ,DEVI1
  E102  1A            		LD	A,(DE)		;DRIVE
  E103  CDF6E3        		CALL	CAP
  E106  D640          		SUB	'@'
  E108  13            		INC	DE
  E109  13            		INC	DE
  E10A  3214EF        		LD	(FDRV),A
  E10D                	DEVI1:
  E10D  1A            		LD	A,(DE)
  E10E  D65C          		SUB	05CH		;\
  E110  2009          		JR	NZ,NOROOT
  E112  6F            		LD	L,A		;A=0でH=0のはずなのでHL=0
  E113  222EEF        		LD	(FDRV+26),HL
  E116  2C            		INC	L
  E117  2222EF        		LD	(FDRV+14),HL
  E11A  13            		INC	DE
  E11B                	NOROOT:
                      	
  E11B                	SETDIR:
  E11B  CD47E1        		CALL	FILED
  E11E  1A            		LD	A,(DE)
  E11F  FE5C          		CP	05CH		;\
  E121  C0            		RET	NZ
  E122  13            		INC	DE
  E123                	SETDIR1:
  E123  3E10          		LD	A,010H		;Directory
  E125  3221EF        		LD	(FDRV+13),A
  E128  D5            		PUSH	DE
  E129  1114EF        		LD	DE,FDRV
  E12C  2A1EF0        		LD	HL,(STABLE+2*00FH)
  E12F  CD0F00        		CALL	JP_HL
  E132  D1            		POP	DE
  E133  B7            		OR	A
  E134  C0            		RET	NZ
                      	
  E135  3A21EF        		LD	A,(FDRV+13)
  E138  CB67          		BIT	4,A
  E13A  C8            		RET	Z
                      	
  E13B  CD8EE1        		CALL	FILEI
  E13E  2A2EEF        		LD	HL,(FDRV+26)
  E141  23            		INC	HL
  E142  2222EF        		LD	(FDRV+14),HL
  E145  18D4          		JR	SETDIR
                      	
  E147                	FILED:
  E147  CD8EE1        		CALL	FILEI
  E14A  2115EF        		LD	HL,FNAME
                      	
  E14D  0608          		LD	B,8
  E14F                	FILE2:
  E14F  CD9BE1        		CALL	CCHKF
  E152  C8            		RET	Z
  E153  FE2A          		CP	'*'
  E155  282E          		JR	Z,FILE9
  E157  FE2E          		CP	'.'
  E159  280C          		JR	Z,FILE4
  E15B  77            		LD	(HL),A
  E15C  23            		INC	HL
  E15D  10F0          		DJNZ	FILE2
                      	
  E15F                	FILE3:
  E15F  CD9BE1        		CALL	CCHKF
  E162  C8            		RET	Z
  E163  FE2E          		CP	'.'
  E165  20F8          		JR	NZ,FILE3
                      	
  E167                	FILE4:
  E167  211DEF        		LD	HL,FNAME+8
  E16A  0603          		LD	B,3
                      	
  E16C                	FILE4L:
  E16C  CD9BE1        		CALL	CCHKF
  E16F  C8            		RET	Z
  E170  FE2E          		CP	'.'
  E172  2008          		JR	NZ,FILE12
  E174  3215EF        		LD	(FNAME),A	;Parent directory(..)
  E177  3216EF        		LD	(FNAME+1),A
  E17A  3E20          		LD	A,020H
  E17C                	FILE12:
  E17C  FE2A          		CP	'*'
  E17E  280A          		JR	Z,FILE10
  E180  77            		LD	(HL),A
  E181  23            		INC	HL
  E182  10E8          		DJNZ	FILE4L
  E184  C9            		RET
                      	
  E185                	FILE9:				;名前の*処理、名前の残りを?で埋める
  E185  CD8AE1        		CALL	FILE10
  E188  18D5          		JR	FILE3
                      	
  E18A                	FILE10:
  E18A  3E3F          		LD	A,'?'
  E18C  1808          		JR	FILL_MEMORY
  E18E                	FILEI:				;名前＋拡張子をスペースで初期化
  E18E  3E20          		LD	A,020H
  E190  01000B        		LD	BC,11*256	;C=0にしておく
  E193  2115EF        		LD	HL,FNAME
  E196                	FILL_MEMORY:			;HLからBバイトAで埋める
  E196  77            		LD	(HL),A
  E197  23            		INC	HL
  E198  10FC          		DJNZ	FILL_MEMORY
  E19A  C9            		RET
                      	
  E19B                	CCHKF:
  E19B  1A            		LD	A,(DE)
  E19C  CDA3E1        		CALL	CCHK2
  E19F  C8            		RET	Z
  E1A0  C30EE5        		JP	FKAN
                      	
  E1A3                	CCHK2:
  E1A3  0C            		INC	C
  E1A4  0D            		DEC	C
  E1A5  C0            		RET	NZ
  E1A6                	CCHK3:				;ZF=1 で使えない文字
  E1A6  FE2B          		CP	'+'
  E1A8  C8            		RET	Z
  E1A9  FE2C          		CP	','
  E1AB  C8            		RET	Z
  E1AC  FE2F          		CP	'/'
  E1AE  C8            		RET	Z
  E1AF  FE3A          		CP	':'
  E1B1  C8            		RET	Z
  E1B2  FE3B          		CP	';'
  E1B4  C8            		RET	Z
  E1B5  FE3D          		CP	'='
  E1B7  C8            		RET	Z
  E1B8  FE5C          		CP	05CH	;\
  E1BA  C8            		RET	Z
  E1BB  FE20          		CP	020H
  E1BD  D0            		RET	NC
  E1BE  BF            		CP	A		;Z=1
  E1BF  C9            		RET
                      	
  E1C0                	SS1:
  E1C0  13            		INC	DE
  E1C1                	SPCUT:				;スペースをカット
  E1C1  1A            		LD	A,(DE)
  E1C2  FE20          		CP	020H
  E1C4  28FA          		JR	Z,SS1
  E1C6  C9            		RET
                      	
  E1C7                	SETDRVF:
  E1C7  1114EF        		LD	DE,FDRV
  E1CA                	SETDRV0:
  E1CA  CDD3E1        		CALL	SETDRV
  E1CD  FDE1          		POP	IY
  E1CF  C1            		POP	BC
  E1D0  D1            		POP	DE
  E1D1  E1            		POP	HL
  E1D2  C9            		RET
                      	
  E1D3                	SETDRV:
  E1D3  E3            		EX	(SP),HL		;HL=RETRN ADDRESS
  E1D4  D5            		PUSH	DE		;PUSH HL/DE/BC/IY
  E1D5  C5            		PUSH	BC
  E1D6  1A            		LD	A,(DE)
  E1D7  D5            		PUSH	DE
  E1D8  FDE3          		EX	(SP),IY
                      	
  E1DA  CDE6E1        		CALL	GETDRV
  E1DD  3C            		INC	A
  E1DE  FD7700        		LD	(IY+0),A	;(FCB)ドライブ番号
  E1E1  3D            		DEC	A
  E1E2  CDD9EF        		CALL	_CHGDRV
                      	
  E1E5  E9            		JP	(HL)
                      	
  E1E6                	GETDRV:
  E1E6  E67F          		AND	07FH
  E1E8  D601          		SUB	001H
  E1EA  3003          		JR	NC,GETDRV1
  E1EC  3A87EF        		LD	A,(_DVSW)	;Current Drive
  E1EF                	GETDRV1:
  E1EF  3288EF        		LD	(_DRV),A
  E1F2  C9            		RET
                      	
  E1F3                	SOPENX:
  E1F3  1139EF        		LD	DE,SFILE
  E1F6  1A            		LD	A,(DE)
  E1F7  FDBE00        		CP	(IY+0)		;(FCB)ドライブ番号
  E1FA  2024          		JR	NZ,SOPEN
  E1FC  13            		INC	DE
  E1FD  FDE5          		PUSH	IY
  E1FF  E1            		POP	HL
  E200  23            		INC	HL
  E201  CD8EE3        		CALL	CPFILE
  E204  201A          		JR	NZ,SOPEN
                      	
  E206  2AF4F0        		LD	HL,(SCDIR)
  E209  FD750E        		LD	(IY+14),L	;(FCB)アクセスするディレクトリのクラスタ番号+1
  E20C  FD740F        		LD	(IY+15),H
                      	
  E20F  2AF8F0        		LD	HL,(SFNDF)	;Direcroty location and Flags
  E212  229FEF        		LD	(_FILEN),HL
                      	
  E215  ED5BF6F0      		LD	DE,(SFBPS)
  E219  2139EF        		LD	HL,SFILE
  E21C  36FF          		LD	(HL),0FFH
  E21E  23            		INC	HL
  E21F  C9            		RET
  E220                	SOPEN:
  E220  2136E3        		LD	HL,FILESE
  E223                	SOPENC:
  E223  225CE2        		LD	(OPENPAT+1),HL
                      	
  E226  CDE2EF        		CALL	_RDFATX		;Detect Media
  E229  3856          		JR	C,RDDERR
                      	
  E22B  AF            		XOR	A
  E22C  329FEF        		LD	(_FILEN),A
  E22F  CD3BE4        		CALL	LDDIRX1		;A=0で呼び出す
  E232  2818          		JR	Z,SDIRX1
                      	
  E234  CD27E3        		CALL	READ_DIR	;Sub Directory
  E237  3808          		JR	C,SDIRX0
  E239  2A7EF0        		LD	HL,(_DTBUF)
  E23C  7E            		LD	A,(HL)
  E23D  FE2E          		CP	'.'
  E23F  280F          		JR	Z,SOPEN1
  E241                	SDIRX0:
  E241  AF            		XOR	A
  E242  32A0EF        		LD	(_DIRF),A
  E245  FD360E01      		LD	(IY+14),1	;(FCB)レコードサイズ
  E249  FD770F        		LD	(IY+15),A
  E24C                	SDIRX1:
  E24C  ED5BFCF0      		LD	DE,(_DIRPS)	;Root Directory
  E250                	SOPEN1:
  E250  0E20          	SDECPAT:LD	C,32		;自己書き換え 1セクタ辺りのディレクトリエントリ数  1024=32 / 512=16 / 256=8
  E252                	SOPEN1X:
  E252  CD27E3        		CALL	READ_DIR	;FILE SEARCH
  E255  382A          		JR	C,RDDERR
  E257  2A7EF0        		LD	HL,(_DTBUF)
  E25A                	SOPEN2:
  E25A  D5            		PUSH	DE
  E25B  CD36E3        	OPENPAT:CALL	FILESE		;(self-modifying code)
  E25E  D1            		POP	DE
  E25F  386E          		JR	C,SOPENE
  E261  281B          		JR	Z,SCF_FF_RET
  E263                	SOPEN3:
  E263  3AA0EF        		LD	A,(_DIRF)	;ディレクトリか判別
  E266  B7            		OR	A
  E267  200C          		JR	NZ,SOPEN5
  E269  13            		INC	DE		;ルートディレクトリ
  E26A  E5            		PUSH	HL
  E26B  210C00        	MD_PAT:	LD	HL,12		;(self-modifying code)MAXDIR
  E26E  ED52          		SBC	HL,DE		;CF=0 なので SUB HL,DE
  E270  E1            		POP	HL
  E271  20DD          		JR	NZ,SOPEN1
  E273  1807          		JR	SOPEN6
  E275                	SOPEN5:
  E275  CD86EA        		CALL	GNCLX		;END DIR
  E278  D8            		RET	C
  E279  CDEEE3        		CALL	ENDCL
  E27C                	SOPEN6:
  E27C  38D2          		JR	C,SOPEN1
  E27E                	SCF_FF_RET:
  E27E  37            		SCF			;CF=1
  E27F  9F            		SBC	A,A		;A=0FFH
  E280  C9            		RET
                      	
  E281                	RDDERR:
  E281  BF            		CP	A		;READ ERR CF=1 ZF=1
  E282  37            		SCF
  E283  C9            		RET
                      	
  E284                	NOPEN:
  E284  2136E3        		LD	HL,FILESE
  E287  225CE2        		LD	(OPENPAT+1),HL
  E28A  FD2A98EF      		LD	IY,(_FCB)
  E28E  CD21E5        		CALL	CHKWILDX
  E291  30EB          		JR	NC,SCF_FF_RET
  E293  FD7E00        		LD	A,(IY+0)	;(FCB)ドライブ番号
  E296  3D            		DEC	A
  E297  3288EF        		LD	(_DRV),A
  E29A  CDD9EF        		CALL	_CHGDRV
  E29D  D8            		RET	C
  E29E  2AF8F0        		LD	HL,(SFNDF)	;Direcroty location and Flags
  E2A1  229FEF        		LD	(_FILEN),HL
                      	
  E2A4  CD36E4        		CALL	LDDIRX
  E2A7  ED5B9AEF      		LD	DE,(_FBPS)
  E2AB  CD27E3        		CALL	READ_DIR
  E2AE  38D1          		JR	C,RDDERR
  E2B0  3A9EEF        		LD	A,(_FBCNT)
  E2B3  3D            		DEC	A
  E2B4  28AD          		JR	Z,SOPEN3
  E2B6                	NOPEN2:
  E2B6  2A9CEF        		LD	HL,(_FBAD)
  E2B9  012000        		LD	BC,020H
  E2BC  09            		ADD	HL,BC
  E2BD  4F            		LD	C,A
  E2BE  189A          		JR	SOPEN2
                      	
  E2C0                	SOPENE2:
  E2C0  229CEF        		LD	(_FBAD),HL
  E2C3  79            		LD	A,C
  E2C4  329EEF        		LD	(_FBCNT),A
  E2C7  ED539AEF      		LD	(_FBPS),DE
  E2CB  FD2298EF      		LD	(_FCB),IY
  E2CF                	SOPENE:
  E2CF  AF            		XOR	A
  E2D0  C9            		RET
                      	
  E2D1                	COPEN:
  E2D1  FD360D20      		LD	(IY+13),020H	;(FCB)属性(アトリビュート)
                      	
  E2D5  2153E3        		LD	HL,NEXTSE
  E2D8  CD23E2        		CALL	SOPENC
  E2DB  D0            		RET	NC
  E2DC  C8            		RET	Z
  E2DD  3AA0EF        		LD	A,(_DIRF)	;ディレクトリか判別
  E2E0  B7            		OR	A
  E2E1  37            		SCF
  E2E2  C8            		RET	Z		;ルートディレクトリ
  E2E3  0601          		LD	B,1
  E2E5  CD7DE5        		CALL	WRDF
  E2E8  D8            		RET	C
  E2E9  ED5BFEF0      		LD	DE,(_CLPS)
  E2ED  D5            		PUSH	DE
  E2EE  CDB7E3        		CALL	DCPAT
  E2F1  CD11E9        		CALL	DRDNX
  E2F4  2A7EF0        		LD	HL,(_DTBUF)	;ディレクトリエントリを0クリア
  E2F7  3A8CE8        		LD	A,(SECSZ+2)	;1024=4 / 512=2 / 256=1
  E2FA  47            		LD	B,A
  E2FB  AF            		XOR	A
  E2FC  4F            		LD	C,A
  E2FD                	COPENCL:
  E2FD  77            		LD	(HL),A
  E2FE  EDA1          		CPI			;HL=HL+1 BC=BC-1 BCが0の場合にP/V=0
  E300  EAFDE2        		JP	PE,COPENCL
                      	
  E303  3AD5E3        		LD	A,(SPCPAT+1)	;1クラスタの論理セクタ数
  E306  3D            		DEC	A
  E307  2819          		JR	Z,COPENE
  E309  3E01          		LD	A,1		;1セクタ辺りのセクタ数が2以上の場合
  E30B  327EEA        		LD	(_SECPS+1),A
  E30E  D1            		POP	DE		;DE=(_CLPS)
  E30F  D5            		PUSH	DE
  E310                	COPEN1:
  E310  D5            		PUSH	DE		;データバッファに入らないセクタもゼロクリア
  E311  C5            		PUSH	BC
  E312  2A7EF0        		LD	HL,(_DTBUF)
  E315  CDD1E3        		CALL	CLUSTX
  E318  CDEAEB        		CALL	DWT24
  E31B  C1            		POP	BC
  E31C  D1            		POP	DE
  E31D  CD7DEA        		CALL	NEXTX
  E320  20EE          		JR	NZ,COPEN1
  E322                	COPENE:
  E322  2A7EF0        		LD	HL,(_DTBUF)
  E325  D1            		POP	DE
  E326  C9            		RET
                      	
  E327                	READ_DIR:
  E327  ED53FEF0      		LD	(_CLPS),DE
  E32B  C5            		PUSH	BC
  E32C  D5            		PUSH	DE
  E32D  CDB7E3        		CALL	DCPAT
  E330  CDF1E8        		CALL	DRDX
  E333  D1            		POP	DE
  E334  C1            		POP	BC
  E335  C9            		RET
                      	
  E336                	FILESE:
  E336  7E            		LD	A,(HL)
  E337  B7            		OR	A
  E338  C8            		RET	Z		;END:ZF=1 CF=0
  E339  FEE5          		CP	0E5H
  E33B  280E          		JR	Z,FILESE1
  E33D  FDE5          		PUSH	IY
  E33F  D1            		POP	DE
  E340  13            		INC	DE
  E341  E5            		PUSH	HL
  E342  CD8EE3        		CALL	CPFILE
  E345  CCAFE3        		CALL	Z,CPFILE2
  E348  E1            		POP	HL
  E349  37            		SCF
  E34A  C8            		RET	Z		;!!!:(ZF=1) CF=1
  E34B                	FILESE1:
  E34B  CD62E3        		CALL	FNEXT
  E34E  20E6          		JR	NZ,FILESE
  E350                	ZF0_CF0_AFF_RET:
  E350  F6FF          		OR	0FFH		;ZF=0 CF=0
  E352  C9            		RET
                      	
  E353                	NEXTSE:
  E353  7E            		LD	A,(HL)
  E354  B7            		OR	A
  E355  37            		SCF
  E356  C8            		RET	Z		;!!!:ZF=1 CF=1
  E357  FEE5          		CP	0E5H
  E359  37            		SCF
  E35A  C8            		RET	Z		;!!!:(ZF=1) CF=1
  E35B  CD62E3        		CALL	FNEXT
  E35E  20F3          		JR	NZ,NEXTSE
  E360  18EE          		JR	ZF0_CF0_AFF_RET
                      	
  E362                	FNEXT:
  E362  E5            		PUSH	HL
  E363  219FEF        		LD	HL,_FILEN
  E366  34            		INC	(HL)
  E367  E1            		POP	HL
  E368  112000        		LD	DE,020H
  E36B  19            		ADD	HL,DE
  E36C  0D            		DEC	C
  E36D  C9            		RET
                      	
  E36E                	CPNAME:
  E36E  C5            		PUSH	BC
  E36F  D5            		PUSH	DE
  E370  E5            		PUSH	HL
  E371  CD88E3        		CALL	CPFILE4
  E374  E1            		POP	HL
  E375  23            		INC	HL
  E376  23            		INC	HL
  E377  23            		INC	HL
  E378  23            		INC	HL
  E379  D1            		POP	DE
  E37A  C1            		POP	BC
  E37B  2005          		JR	NZ,CPNAME1
  E37D  7E            		LD	A,(HL)
  E37E  23            		INC	HL
  E37F  66            		LD	H,(HL)
  E380  6F            		LD	L,A
  E381  C9            		RET
  E382                	CPNAME1:
  E382  23            		INC	HL
  E383  23            		INC	HL
  E384  10E8          		DJNZ	CPNAME
  E386  37            		SCF
  E387  C9            		RET
                      	
  E388                	CPFILE4:
  E388  C5            		PUSH	BC
  E389  010004        		LD	BC,00400H
  E38C  1804          		JR	CPSTR1
  E38E                	CPFILE:
  E38E  C5            		PUSH	BC
  E38F  01000B        		LD	BC,00B00H
  E392                	CPSTR1:
  E392  1A            		LD	A,(DE)
  E393  FE3F          		CP	'?'		;Wild card
  E395  2812          		JR	Z,CPSTR2
  E397  7E            		LD	A,(HL)
  E398  CD07E5        		CALL	FKANC
  E39B  E5            		PUSH	HL
  E39C  67            		LD	H,A
  E39D  1A            		LD	A,(DE)
  E39E  CB01          		RLC	C
  E3A0  CD07E5        		CALL	FKANC
  E3A3  CB09          		RRC	C
  E3A5  BC            		CP	H		;CP (HL),(DE)
  E3A6  E1            		POP	HL
  E3A7  2004          		JR	NZ,CPSTR3
  E3A9                	CPSTR2:
  E3A9  13            		INC	DE
  E3AA  23            		INC	HL
  E3AB  10E5          		DJNZ	CPSTR1
  E3AD                	CPSTR3:
  E3AD  C1            		POP	BC
  E3AE  C9            		RET
                      	
  E3AF                	CPFILE2:
  E3AF  FD7E0D        		LD	A,(IY+13)	;(FCB)属性(アトリビュート)
  E3B2  F6E1          		OR	0E1H
  E3B4  2F            		CPL
  E3B5  A6            		AND	(HL)
  E3B6  C9            		RET
                      	
  E3B7                	DCPAT:
  E3B7  0E00          		LD	C,0
  E3B9  2A7EF0        		LD	HL,(_DTBUF)
  E3BC  3AA0EF        		LD	A,(_DIRF)	;ディレクトリか判別
  E3BF  B7            		OR	A
  E3C0  C8            		RET	Z		;ルートディレクトリの場合はCレジスタを0にしておく(CDEがセクタ番号)
  E3C1  3AD5E3        		LD	A,(SPCPAT+1)
  E3C4  4F            		LD	C,A
  E3C5  3A7EEA        		LD	A,(_SECPS+1)
  E3C8  B9            		CP	C
  E3C9  3801          		JR	C,DC1
  E3CB  AF            		XOR	A
  E3CC                	DC1:
  E3CC  F680          		OR	080H
  E3CE  32A0EF        		LD	(_DIRF),A	;bit0-6:セクタインデックス
  E3D1                	CLUSTX:
  E3D1  E5            		PUSH	HL
  E3D2  EB            		EX	DE,HL
  E3D3  AF            		XOR	A
  E3D4  0E01          	SPCPAT:	LD	C,1		;自己書き換え（1クラスタの論理セクタ数）
  E3D6                	L_CLDBL:
  E3D6  CB19          		RR	C		;->CF
  E3D8  3804          		JR	C,E_CLDBL
  E3DA  29            		ADD	HL,HL		;*2
  E3DB  8F            		ADC	A,A
  E3DC  18F8          		JR	L_CLDBL
  E3DE                	E_CLDBL:
  E3DE  4F            		LD	C,A
  E3DF  3A7EEA        		LD	A,(_SECPS+1)
  E3E2  B5            		OR	L
  E3E3  6F            		LD	L,A
  E3E4  110800        	CLSPAT:	LD	DE,8	;+8 (2D)  !ADDCL (self-modifying code)
  E3E7  AF            		XOR	A
  E3E8  19            		ADD	HL,DE	;データ格納領域の先頭論理セクタ番号
  E3E9  89            		ADC	A,C
  E3EA  4F            		LD	C,A
  E3EB  EB            		EX	DE,HL
  E3EC  E1            		POP	HL
  E3ED  C9            		RET
                      	
  E3EE                	ENDCL:
  E3EE  7A            		LD	A,D	;END CLUSTER
  E3EF  FE01          	CLPAT1:	CP	1	;164=356	(self-modifying code)
  E3F1  C0            		RET	NZ
  E3F2  7B            		LD	A,E
  E3F3  FE64          	CLPAT2:	CP	064H	;		(self-modifying code)
  E3F5  C9            		RET
                      	
  E3F6                	CAP:
  E3F6  FE61          		CP	'a'
  E3F8  D8            		RET	C
  E3F9  FE7B          		CP	'z'+1
  E3FB  D0            		RET	NC
  E3FC  D620          		SUB	020H
  E3FE  C9            		RET
  E3FF                	CAP2:
  E3FF  CDF6E3        		CALL	CAP
  E402                	CAP3:
  E402  CD0BE4        		CALL	CAP4
  E405  FE21          		CP	021H
  E407  D0            		RET	NC
  E408  3EA0          		LD	A,0A0H
  E40A  C9            		RET
  E40B                	CAP4:
  E40B  FE05          		CP	5
  E40D  C0            		RET	NZ
  E40E  3EE5          		LD	A,0E5H
  E410  C9            		RET
                      	
  E411                	CHDIR:
  E411  CD21ED        		CALL	GETDPBD
  E414  381D          		JR	C,CHDIR2
  E416  DD751A        		LD	(IX+01AH),L		;_SDIR_
  E419  DD741B        		LD	(IX+01BH),H		;_SDIR_+1
  E41C  1815          		JR	CHDIR2		;POP_IX_RET
                      	
  E41E                	LDDIR:
  E41E  CD21ED        		CALL	GETDPBD
  E421  DD5E1A        		LD	E,(IX+01AH)		;_SDIR_
  E424  DD561B        		LD	D,(IX+01BH)		;_SDIR_+1
  E427  13            		INC	DE
  E428  FD730E        		LD	(IY+14),E	;(FCB)アクセスするディレクトリのクラスタ番号+1
  E42B  FD720F        		LD	(IY+15),D
  E42E  1B            		DEC	DE
  E42F  AF            		XOR	A
  E430  32A0EF        		LD	(_DIRF),A
  E433                	CHDIR2:
  E433  DDE1          		POP	IX
  E435  C9            		RET
                      	
  E436                	LDDIRX:
  E436  3AA0EF        		LD	A,(_DIRF)	;(FCB)アクセスするディレクトリのセクタインデックス
  E439  E67F          		AND	07FH
  E43B                	LDDIRX1:
  E43B  327EEA        		LD	(_SECPS+1),A
  E43E  FD5E0E        		LD	E,(IY+14)	;(FCB)アクセスするディレクトリのクラスタ番号+1
  E441  FD560F        		LD	D,(IY+15)
  E444  1B            		DEC	DE
  E445  CDEEE3        		CALL	ENDCL
  E448  D41EE4        		CALL	NC,LDDIR
  E44B                	LDDIRS:
  E44B  7A            		LD	A,D
  E44C  B3            		OR	E
  E44D  32A0EF        		LD	(_DIRF),A	;ディレクトリか判別
  E450  C9            		RET
                      	
  E451                	KILL:
  E451  CD21E5        		CALL	CHKWILDX
  E454  3834          		JR	C,KILLW
  E456  CDF3E1        		CALL	SOPENX
  E459                	KILLS:
  E459  3E1F          		LD	A,01FH
  E45B  D49DE4        		CALL	NC,CHKATT
  E45E  D8            		RET	C
  E45F                	KILLSX:
  E45F  36E5          		LD	(HL),0E5H	;DIR
  E461  CDFBE4        		CALL	WTDB
  E464  111A00        		LD	DE,01AH
  E467  19            		ADD	HL,DE
  E468  5E            		LD	E,(HL)
  E469  23            		INC	HL
  E46A  56            		LD	D,(HL)
  E46B                	KILLS1:
  E46B  CDEEE3        		CALL	ENDCL
  E46E  D0            		RET	NC		;CF=0
  E46F  21FEFF        		LD	HL,0-2
  E472  19            		ADD	HL,DE
  E473  D0            		RET	NC		;DE= 0 or 1
  E474  D5            		PUSH	DE
  E475  CDF7EF        		CALL	_GNCL
  E478  ED53FEF0      		LD	(_CLPS),DE
  E47C  D1            		POP	DE
  E47D  210000        		LD	HL,0
  E480  D4FAEF        		CALL	NC,_SNCL
  E483  D8            		RET	C
  E484  ED5BFEF0      		LD	DE,(_CLPS)	;FAT
  E488  18E1          		JR	KILLS1
                      	
  E48A                	KILLW:
  E48A  CD20E2        		CALL	SOPEN
  E48D                	KILLW1:
  E48D  380B          		JR	C,KILLW2
  E48F  CDC0E2        		CALL	SOPENE2
  E492  CD59E4        		CALL	KILLS
  E495  CD84E2        		CALL	NOPEN
  E498  18F3          		JR	KILLW1
  E49A                	KILLW2:
  E49A  C8            		RET	Z
  E49B  3F            		CCF
  E49C  C9            		RET
                      	
  E49D                	CHKATT:
  E49D  E5            		PUSH	HL
  E49E  110B00        		LD	DE,00BH
  E4A1  19            		ADD	HL,DE
  E4A2  A6            		AND	(HL)
  E4A3  E1            		POP	HL
  E4A4  C8            		RET	Z
  E4A5  37            		SCF
  E4A6  C9            		RET
                      	
  E4A7                	NAME:
  E4A7  CD21E5        		CALL	CHKWILDX
  E4AA  D8            		RET	C
  E4AB  110400        		LD	DE,4
  E4AE  19            		ADD	HL,DE
  E4AF  22C7E4        		LD	(NAMEP+2),HL
  E4B2  23            		INC	HL
  E4B3  CD25E5        		CALL	CHKWILD
  E4B6  D8            		RET	C
                      	
  E4B7  CDF3E1        		CALL	SOPENX
  E4BA  3E0F          		LD	A,00FH
  E4BC  D49DE4        		CALL	NC,CHKATT
  E4BF  D8            		RET	C
                      	
  E4C0  FD7E00        		LD	A,(IY+0)
  E4C3  FDE5          		PUSH	IY
  E4C5  FD210000      	NAMEP:	LD	IY,0		;自己書き換え
  E4C9  FD7700        		LD	(IY+0),A
  E4CC  CDF3E1        		CALL	SOPENX
  E4CF  FDE3          		EX	(SP),IY
  E4D1  3F            		CCF
  E4D2  D420E2        		CALL	NC,SOPEN
  E4D5  EB            		EX	DE,HL
  E4D6  E1            		POP	HL
  E4D7  D8            		RET	C
                      	
  E4D8                	SETNAME:
  E4D8  01000B        		LD	BC,11*256
  E4DB  23            		INC	HL
  E4DC  7E            		LD	A,(HL)
  E4DD  FEE5          		CP	0E5H
  E4DF  2004          		JR	NZ,SNAME1
  E4E1  3E05          		LD	A,5
  E4E3  180E          		JR	SNAME3
  E4E5                	SNAME1:
  E4E5  7E            		LD	A,(HL)
  E4E6  0C            		INC	C
  E4E7  0D            		DEC	C
  E4E8  2009          		JR	NZ,SNAME3
  E4EA  CDF6E3        		CALL	CAP
  E4ED  FEA0          		CP	0A0H
  E4EF  2002          		JR	NZ,SNAME3
  E4F1  3E20          		LD	A,020H
  E4F3                	SNAME3:
  E4F3  12            		LD	(DE),A
  E4F4  7E            		LD	A,(HL)
  E4F5  23            		INC	HL
  E4F6  CD0EE5        		CALL	FKAN
  E4F9  10EA          		DJNZ	SNAME1
  E4FB                	WTDB:
  E4FB  3EFF          		LD	A,0FFH
  E4FD  3239EF        		LD	(SFILE),A
  E500                	SWTDBF:
  E500  3E01          		LD	A,1
  E502  32A4EF        		LD	(_WTDBF),A
  E505  AF            		XOR	A
  E506  C9            		RET
                      	
  E507                	FKANC:
  E507  CB41          		BIT	0,C
  E509  CCFFE3        		CALL	Z,CAP2
  E50C  1801          		JR	FKANX
  E50E                	FKAN:			;漢字チェック
  E50E  13            		INC	DE
  E50F                	FKANX:
  E50F  CB41          		BIT	0,C
  E511  CB81          		RES	0,C
  E513  C0            		RET	NZ
  E514  FE80          		CP	080H
  E516  D8            		RET	C
  E517  FEA0          		CP	0A0H
  E519  3803          		JR	C,FKAN1
  E51B  FEE0          		CP	0E0H
  E51D  D8            		RET	C
  E51E                	FKAN1:
  E51E  0C            		INC	C
  E51F  A7            		AND	A
  E520  C9            		RET
                      	
  E521                	CHKWILDX:
  E521  FDE5          		PUSH	IY
  E523  E1            		POP	HL
  E524  23            		INC	HL
  E525                	CHKWILD:
  E525  060B          		LD	B,11
  E527  3E3F          		LD	A,'?'
  E529                	CHKWIL1:
  E529  BE            		CP	(HL)
  E52A  23            		INC	HL
  E52B  37            		SCF
  E52C  C8            		RET	Z
  E52D  10FA          		DJNZ	CHKWIL1
  E52F  AF            		XOR	A
  E530  C9            		RET
                      	
  E531                	SDIRENT:		;IY=FCB HL=DIR
  E531  D5            		PUSH	DE
  E532  E5            		PUSH	HL
  E533  FDE5          		PUSH	IY
  E535  D1            		POP	DE
  E536  EB            		EX	DE,HL
  E537  CDD8E4        		CALL	SETNAME
                      	;				Attribute
  E53A  FD7E0D        		LD	A,(IY+13)	;(FCB)属性(アトリビュート)
  E53D  12            		LD	(DE),A
  E53E  13            		INC	DE
                      	;				Reserved
  E53F  AF            		XOR	A
  E540  060A          		LD	B,10
  E542                	SDE1:
  E542  12            		LD	(DE),A
  E543  13            		INC	DE
  E544  10FC          		DJNZ	SDE1
                      						;(FCB)更新時刻
  E546  21EAF0        		LD	HL,SDDATA		;(FCB)更新年月日
  E549  060A          		LD	B,SDDATAE-SDDATA	;(FCB)ファイルの先頭クラスタ
  E54B                	SDLOOP:					;(FCB)ファイルのサイズ(バイト単位)
  E54B  7E            		LD	A,(HL)
  E54C  23            		INC	HL
  E54D  3252E5        		LD	(SDPAT+2),A
  E550  FD7E00        	SDPAT:	LD	A,(IY+0)	;LD A,(IY+A)
  E553  12            		LD	(DE),A
  E554  13            		INC	DE
  E555  10F4          		DJNZ	SDLOOP
                      	
  E557  AF            		XOR	A
  E558  E1            		POP	HL
  E559  D1            		POP	DE
  E55A  C9            		RET
                      	
  E55B                	WOPEN:
  E55B  FD7E0D        		LD	A,(IY+13)	;(FCB)属性(アトリビュート)
  E55E  E61F          		AND	01FH
  E560  37            		SCF
  E561  C0            		RET	NZ
  E562  FD361CFE      		LD	(IY+28),0FEH	;(FCB)オープンモード
  E566                	TOPEN2:
  E566  AF            		XOR	A
  E567                	TOPEN:				;Initializes the time stamp
  E567  FD3617FF      		LD	(IY+23),0FFH	;(FCB)更新時刻
  E56B  C9            		RET
                      	
  E56C                	WRDFX:
  E56C  3AD5E3        		LD	A,(SPCPAT+1)	;1クラスタの論理セクタ
  E56F                	L_WRFX:
  E56F  1F            		RRA		;->CF
  E570  3804          		JR	C,E_WRFX
  E572  CB39          		SRL	C	;C=C/2
  E574  18F9          		JR	L_WRFX
  E576                	E_WRFX:
  E576  41            		LD	B,C
  E577  04            		INC	B
  E578  3E37          		LD	A,037H		;SCF
  E57A  320EE9        		LD	(DRDN1),A
                      	
  E57D                	WRDF:				;Bクラスタ分FATを確保する
  E57D  110200        		LD	DE,2
  E580  AF            		XOR	A
  E581  327EEA        		LD	(_SECPS+1),A
  E584                	WRDF1:
  E584  C5            		PUSH	BC
  E585  D5            		PUSH	DE
  E586  CDF7EF        		CALL	_GNCL
  E589  381C          		JR	C,WRDF3
  E58B  7A            		LD	A,D		;空いているかチェック
  E58C  B3            		OR	E
  E58D  2027          		JR	NZ,WRDF4
  E58F  E1            		POP	HL		;HL=空いているクラスタ
  E590  E5            		PUSH	HL
  E591  ED5BFEF0      		LD	DE,(_CLPS)	;DE=元の(_CLPS)
  E595  22FEF0        		LD	(_CLPS),HL
  E598  7A            		LD	A,D		;元の(_CLPS)が 0 か?
  E599  B3            		OR	E
  E59A  2008          		JR	NZ,WRDF2
  E59C  FD751A        		LD	(IY+26),L	;(FCB)ファイルの先頭クラスタ
  E59F  FD741B        		LD	(IY+27),H	;元が空の場合はFCBにクラスタをセットする
  E5A2  1803          		JR	WRDF3
  E5A4                	WRDF2:
  E5A4  CDFAEF        		CALL	_SNCL
  E5A7                	WRDF3:
  E5A7  D1            		POP	DE
  E5A8  C1            		POP	BC
  E5A9  D8            		RET	C
  E5AA  100C          		DJNZ	WRDF5		;ここでループカウンタチェック
  E5AC  ED5BFEF0      		LD	DE,(_CLPS)
  E5B0  21FFFF        		LD	HL,0FFFFH	;FATエントリ終了(EOCマーク)
  E5B3  C3FAEF        		JP	_SNCL
                      	
  E5B6                	WRDF4:				;DEクラスタが空じゃないので次に移動する
  E5B6  D1            		POP	DE
  E5B7  C1            		POP	BC
  E5B8                	WRDF5:
  E5B8  13            		INC	DE
  E5B9  CDEEE3        		CALL	ENDCL
  E5BC  38C6          		JR	C,WRDF1
  E5BE  37            		SCF
  E5BF  C9            		RET
                      	
  E5C0                	RWXR:
  E5C0  3A8CE8        		LD	A,(SECSZ+2)	;1024=4 / 512=2 / 256=1
  E5C3                	L_RWX:
  E5C3  1F            		RRA		;->CF
  E5C4  3806          		JR	C,E_RWX
  E5C6  CB38          		SRL	B	;BC=BC/2
  E5C8  CB19          		RR	C	;
  E5CA  18F7          		JR	L_RWX
  E5CC                	E_RWX:
  E5CC  FD5E1A        		LD	E,(IY+26)	;(FCB)ファイルの先頭クラスタ
  E5CF  FD561B        		LD	D,(IY+27)
  E5D2  AF            		XOR	A
  E5D3  327EEA        		LD	(_SECPS+1),A
  E5D6                	RWX1:
  E5D6  ED53FEF0      		LD	(_CLPS),DE
  E5DA  7A            		LD	A,D
  E5DB  B3            		OR	E
  E5DC  280D          		JR	Z,SCF_RET	;RET DE==0 => CF=1
                      	
  E5DE  78            		LD	A,B
  E5DF  B1            		OR	C
  E5E0  C8            		RET	Z		;RET BC==0 => CF=0
                      	
  E5E1  CD86EA        		CALL	GNCLX
  E5E4  D8            		RET	C
  E5E5  0B            		DEC	BC
                      	
  E5E6  CDEEE3        		CALL	ENDCL
  E5E9  38EB          		JR	C,RWX1
  E5EB                	SCF_RET:
  E5EB  37            		SCF
  E5EC  C9            		RET
                      	
  E5ED                	DSKF:
  E5ED  110000        	MAXCLP:	LD	DE,0
  E5F0  2AACEF        		LD	HL,(_FAKEFREE)
  E5F3  7C            		LD	A,H
  E5F4  B5            		OR	L
  E5F5  2803          		JR	Z,DSKF1
  E5F7  110100        		LD	DE,1
  E5FA                	DSKF1:
  E5FA  D5            		PUSH	DE
  E5FB  CDF7EF        		CALL	_GNCL
  E5FE  380C          		JR	C,POPSCF
  E600  7A            		LD	A,D
  E601  B3            		OR	E
  E602  2001          		JR	NZ,DSKF2
  E604  23            		INC	HL
  E605                	DSKF2:
  E605  D1            		POP	DE
  E606  1B            		DEC	DE
  E607  7A            		LD	A,D
  E608  B3            		OR	E
  E609  20EF          		JR	NZ,DSKF1
  E60B  C9            		RET
                      	
  E60C                	POPSCF:
  E60C  F1            		POP	AF
  E60D  37            		SCF
  E60E  C9            		RET
                      	
  E60F                	SETTMS:
  E60F  FD7E17        		LD	A,(IY+23)	;(FCB)ファイルを最後に変更した時刻
  E612  3C            		INC	A
  E613  C0            		RET	NZ		;ファイルが更新されていない
  E614                	SETTMSX:			;FCBに日付時刻をセットする
  E614  CDE8DC        		CALL	_SYS2C		;(BDOS)時刻の獲得
                      					;H←時  L←分  D←秒
  E617  CB25          		SLA	L		;   *2
  E619  CB25          		SLA	L		;   *4
  E61B  29            		ADD	HL,HL		;*2 *8
  E61C  29            		ADD	HL,HL		;*4 *16
  E61D  29            		ADD	HL,HL		;*8 *32
  E61E  7A            		LD	A,D
  E61F  0F            		RRCA			;bit.0->7->->->0->C
  E620  E61F          		AND	01FH
  E622  B5            		OR	L
  E623  FD7716        		LD	(IY+22),A	;(FCB)ファイルを最後に変更した時刻
  E626  FD7417        		LD	(IY+23),H
                      	
  E629  CDB4DC        		CALL	_SYS2A		;(BDOS)日付の獲得
                      					;HL←年  D←月  E←日
  E62C  0144F8        		LD	BC,0-1980
  E62F  09            		ADD	HL,BC
  E630  65            		LD	H,L
                      	
  E631  7A            		LD	A,D
  E632  87            		ADD	A,A		;*2
  E633  87            		ADD	A,A		;*4
  E634  87            		ADD	A,A		;*8
  E635  87            		ADD	A,A		;*16
  E636  6F            		LD	L,A
  E637  29            		ADD	HL,HL		;*32
  E638  7D            		LD	A,L
  E639  B3            		OR	E
  E63A  FD7714        		LD	(IY+20),A	;(FCB)ファイルを最後に変更した日付
  E63D  FD7415        		LD	(IY+21),H
  E640  C9            		RET
                      	
  E641                	PUSHRR:
  E641  CD47E6        		CALL	SUBRR
  E644                	POPRR1:
  E644  EDB0          		LDIR
  E646  C9            		RET
                      	
  E647                	SUBRR:
  E647  FDE5          		PUSH	IY
  E649  E1            		POP	HL
  E64A  112100        		LD	DE,33
  E64D  19            		ADD	HL,DE
  E64E  115AEF        		LD	DE,HLBUF
  E651  010300        		LD	BC,3
  E654  C9            		RET
                      	
  E655                	SETSEQ:
  E655  F5            		PUSH	AF		;AHL=Random record
  E656  FD7E21        		LD	A,(IY+33)	;(FCB)ランダムレコード
  E659  FD6E22        		LD	L,(IY+34)
  E65C  FD6623        		LD	H,(IY+35)
                      	
  E65F  CD7BE6        		CALL	SSQ1
                      	
  E662  29            		ADD	HL,HL
  E663  CB3D          		SRL	L		;L=L/2
  E665  FD7520        		LD	(IY+32),L	;(FCB)カレントレコード
  E668  FD740C        		LD	(IY+12),H	;(FCB)カレントブロック
  E66B  F1            		POP	AF
                      	
  E66C                	POPRR:
  E66C  CD47E6        		CALL	SUBRR
  E66F  EB            		EX	DE,HL
  E670  18D2          		JR	POPRR1
                      	
  E672                	GETSIZE:
  E672  FD7E10        		LD	A,(IY+16)	;(FCB)ファイルのサイズ(バイト単位)
  E675  FD6E11        		LD	L,(IY+17)
  E678  FD6612        		LD	H,(IY+18)
  E67B                	SSQ1:				;バイト単位からCP/Mのレコード単位を求める（1レコード=128バイト）
  E67B  87            		ADD	A,A		;in HLA => out HL
  E67C  ED6A          		ADC	HL,HL
  E67E  B7            		OR	A
  E67F  C8            		RET	Z
  E680  23            		INC	HL
  E681  C9            		RET
                      	
  E682                	GETSEQ:
  E682  FD6E20        		LD	L,(IY+32)	;(FCB)カレントレコード
  E685  FD660C        		LD	H,(IY+12)	;(FCB)カレントブロック
                      	
  E688  CB25          		SLA	L	;L=L*2
                      	
  E68A  CB3C          		SRL	H	;HL=HL/2
  E68C  CB1D          		RR	L	;
  E68E  C9            		RET
                      	
  E68F                	RB_WRITE:
  E68F  C5            		PUSH	BC
  E690  ED4B4CF0      		LD	BC,(STABLE+2*026H)	;(BDOS)ランダムブロック書き込み
  E694  1805          		JR	RBRW
  E696                	RB_READ:
  E696  C5            		PUSH	BC
  E697  ED4B4EF0      		LD	BC,(STABLE+2*027H)	;(BDOS)ランダムブロック読み込み
  E69B                	RBRW:
  E69B  AF            		XOR	A	;HLA = HL*128
  E69C  CB3C          		SRL	H	;HL=HL/2
  E69E  CB1D          		RR	L	;
  E6A0  1F            		RRA			;HLA
  E6A1  FD7721        		LD	(IY+33),A	;(FCB)ランダムレコード
  E6A4  FD7522        		LD	(IY+34),L
  E6A7  FD7423        		LD	(IY+35),H
  E6AA  218000        		LD	HL,128
                      	
  E6AD  FDE5          		PUSH	IY
  E6AF  D1            		POP	DE
  E6B0  D5            		PUSH	DE
  E6B1  CDB8E6        		CALL	JP_BC
  E6B4  FDE1          		POP	IY
  E6B6  C1            		POP	BC
  E6B7  C9            		RET
  E6B8                	JP_BC:
  E6B8  C5            		PUSH	BC
  E6B9  C9            		RET
                      	
  E27E                	_SYS03	EQU	SCF_FF_RET	;(BDOS)外部入力
  E27E                	_SYS2B	EQU	SCF_FF_RET	;(BDOS)日付の設定
  E27E                	_SYS2D	EQU	SCF_FF_RET	;(BDOS)時刻の設定
  E27E                	_SYS39	EQU	SCF_FF_RET	;(BDOS)サブディレクトリの作成
  E27E                	_SYS3A	EQU	SCF_FF_RET	;(BDOS)サブディレクトリの削除
                      	
                      	
                      	;LDFILE2.ASM
                      	
                      	;	LSX-Dodgers FILE2
                      	
                      					;Write random block
  E6BA                	_SYS26:		;(BDOS)ランダムブロック書き込み
  E6BA  AF            		XOR	A
  E6BB  320EE9        		LD	(DRDN1),A	;NOP
  E6BE  22CFE8        		LD	(LEFT+1),HL	;HL←書き込むレコード数
  E6C1  225DEF        		LD	(LEFTX),HL
  E6C4  CDD3E1        		CALL	SETDRV
                      	
  E6C7  CD37E8        		CALL	RBX0
  E6CA  DA60E7        		JP	C,RBWERR
  E6CD  CD5BE5        		CALL	WOPEN
  E6D0  DA60E7        		JP	C,RBWERR
  E6D3  7C            		LD	A,H
  E6D4  B5            		OR	L
  E6D5  CA59E7        		JP	Z,RBW1
                      	
  E6D8  2B            		DEC	HL
                      	
  E6D9  CDE7E8        		CALL	GET_RR_CDE	;CDE=Random record
                      	
  E6DC  AF            		XOR	A	;AHL=HL+CDE
  E6DD  19            		ADD	HL,DE
  E6DE  89            		ADC	A,C
                      	
  E6DF  47            		LD	B,A
  E6E0  4C            		LD	C,H
                      	
  E6E1  CDC0E5        		CALL	RWXR
  E6E4  DC6CE5        		CALL	C,WRDFX
  E6E7  DA60E7        		JP	C,RBWERR
                      	
  E6EA  CD60E8        		CALL	RBX2
  E6ED  281A          		JR	Z,RBWB		;NZ=セクタ以下の端数がある
  E6EF  CD74E8        		CALL	RBXA
  E6F2  386C          		JR	C,RBWERR
  E6F4  EB            		EX	DE,HL
  E6F5  C5            		PUSH	BC
  E6F6  EDB0          		LDIR
  E6F8  225FEF        		LD	(DTAX),HL
                      	
  E6FB  CD00E5        		CALL	SWTDBF		;バッファデータは更新された
                      	
  E6FE  2A5DEF        		LD	HL,(LEFTX)
  E701  D1            		POP	DE
  E702  ED52          		SBC	HL,DE
  E704  225DEF        		LD	(LEFTX),HL
  E707  2830          		JR	Z,RBWEND
                      	
  E709                	RBWB:
  E709  CDAAE8        		CALL	RBXB
  E70C  2813          		JR	Z,RBWC
  E70E                	RBWB1:
  E70E  C5            		PUSH	BC
  E70F  D5            		PUSH	DE
  E710  CDD1E3        		CALL	CLUSTX
  E713  CDEAEB        		CALL	DWT24
  E716  D1            		POP	DE
  E717  C1            		POP	BC
  E718  3846          		JR	C,RBWERR
  E71A  CD86EA        		CALL	GNCLX
  E71D  3841          		JR	C,RBWERR
  E71F  10ED          		DJNZ	RBWB1
  E721                	RBWC:
  E721  CDC2E8        		CALL	RBXC
  E724  2813          		JR	Z,RBWEND
  E726  C5            		PUSH	BC
  E727  CDD1E3        		CALL	CLUSTX
  E72A  CD0DE9        		CALL	DRDN
  E72D  C1            		POP	BC
  E72E  3830          		JR	C,RBWERR
  E730  ED5B7EF0      		LD	DE,(_DTBUF)
  E734  EDB0          		LDIR
  E736  CD00E5        		CALL	SWTDBF		;バッファデータは更新された
  E739                	RBWEND:
  E739  CDCEE8        		CALL	RBXEND
                      	
  E73C  CD46E8        		CALL	RBX1
  E73F  3018          		JR	NC,RBW1
  E741  2ACFE8        		LD	HL,(LEFT+1)
  E744  FD5E10        		LD	E,(IY+16)	;(FCB)ファイルのサイズ(バイト単位)
  E747  FD5611        		LD	D,(IY+17)	;CDE=File size
  E74A  FD4E12        		LD	C,(IY+18)
  E74D  AF            		XOR	A
  E74E  19            		ADD	HL,DE
  E74F  89            		ADC	A,C
  E750  FD7510        		LD	(IY+16),L	;(FCB)ファイルのサイズ(バイト単位)
  E753  FD7411        		LD	(IY+17),H
  E756  FD7712        		LD	(IY+18),A
  E759                	RBW1:
  E759  FDE1          		POP	IY
  E75B  C1            		POP	BC
  E75C  D1            		POP	DE
  E75D  E1            		POP	HL
  E75E                	DD_NUL:
  E75E  AF            		XOR	A
  E75F  C9            		RET
                      	
  E760                	RBWERR:
  E760  FDE5          		PUSH	IY
  E762  D1            		POP	DE
  E763  2A20F0        		LD	HL,(STABLE+2*010H)
  E766  CD0F00        		CALL	JP_HL
  E769                	RBRERR1:
  E769  3E01          		LD	A,001H
  E76B                	RBRERR2:
  E76B  FDE1          		POP	IY
  E76D  C1            		POP	BC
  E76E  D1            		POP	DE
  E76F  E1            		POP	HL
  E770  37            		SCF
  E771  210000        		LD	HL,0
  E774  C9            		RET
                      	
  E775                	RBRERR:
  E775  3EFF          		LD	A,0FFH
  E777  18F2          		JR	RBRERR2
                      	
  E779                	RBRFL:
  E779  3E00          	RBRFLP:	LD	A,000H
  E77B  FE0D          		CP	00DH
  E77D  2005          		JR	NZ,RBRFL1
  E77F  D5            		PUSH	DE
  E780  1E0A          		LD	E,00AH
  E782  1805          		JR	RBRFL2
  E784                	RBRFL1:
  E784  D5            		PUSH	DE
  E785  CD09EF        		CALL	_SYS07
  E788  5F            		LD	E,A
  E789                	RBRFL2:
  E789  CDCDEF        		CALL	_PRINT
  E78C  7B            		LD	A,E
  E78D  D1            		POP	DE
  E78E  327AE7        		LD	(RBRFLP+1),A
  E791  C9            		RET
  E792                	DDX:
  E792  FD7E01        		LD	A,(IY+1)	;(FCB)主ファイル名
  E795  CDF6E3        		CALL	CAP
  E798  FE41          		CP	'A'
  E79A  C9            		RET
                      	
                      					;Read random block
  E79B                	_SYS27:		;(BDOS)ランダムブロック読み込み
  E79B  225DEF        		LD	(LEFTX),HL
  E79E  CDD3E1        		CALL	SETDRV
                      	
  E7A1  FDCB0D66      		BIT	4,(IY+13)	;(FCB)属性(アトリビュート)
  E7A5  C225E8        		JP	NZ,RBRDIR	;ディレクトリ
  E7A8  CD37E8        		CALL	RBX0
  E7AB  DA75E7        		JP	C,RBRERR
  E7AE  CD46E8        		CALL	RBX1
  E7B1  DA69E7        		JP	C,RBRERR1
  E7B4  79            		LD	A,C
  E7B5  EB            		EX	DE,HL
  E7B6  ED52          		SBC	HL,DE		;CP 0HL,CDE
  E7B8  19            		ADD	HL,DE
  E7B9  DE00          		SBC	A,000H
  E7BB  3801          		JR	C,RBR1
  E7BD  EB            		EX	DE,HL
  E7BE                	RBR1:
  E7BE  9F            		SBC	A,A
  E7BF  E601          		AND	1
  E7C1  3223E8        		LD	(RBRAP+1),A
                      	
  E7C4  7C            		LD	A,H
  E7C5  B5            		OR	L
  E7C6  2854          		JR	Z,RBREND0
                      	
  E7C8  22CFE8        		LD	(LEFT+1),HL	;Read record byte
  E7CB  225DEF        		LD	(LEFTX),HL
                      	
  E7CE  CD60E8        		CALL	RBX2
  E7D1  2819          		JR	Z,RBRB
  E7D3  CD74E8        		CALL	RBXA
  E7D6  DA75E7        		JP	C,RBRERR
  E7D9  C5            		PUSH	BC
  E7DA  EDB0          		LDIR
  E7DC  ED535FEF      		LD	(DTAX),DE
  E7E0  2A5DEF        		LD	HL,(LEFTX)
  E7E3  D1            		POP	DE
  E7E4  A7            		AND	A
  E7E5  ED52          		SBC	HL,DE
  E7E7  225DEF        		LD	(LEFTX),HL
  E7EA  282D          		JR	Z,RBREND
                      	
  E7EC                	RBRB:
  E7EC  CDAAE8        		CALL	RBXB
  E7EF  2812          		JR	Z,RBRC
  E7F1                	RBRB1:
  E7F1  C5            		PUSH	BC
  E7F2  D5            		PUSH	DE
  E7F3  CDD1E3        		CALL	CLUSTX
  E7F6  CDDAEB        		CALL	DRD24
  E7F9  D1            		POP	DE
  E7FA  C1            		POP	BC
  E7FB  D486EA        		CALL	NC,GNCLX
  E7FE  DA75E7        		JP	C,RBRERR
  E801  10EE          		DJNZ	RBRB1
  E803                	RBRC:
  E803  CDC2E8        		CALL	RBXC
  E806  2811          		JR	Z,RBREND
  E808  C5            		PUSH	BC
  E809  CDD1E3        		CALL	CLUSTX
  E80C  CDF1E8        		CALL	DRDX
  E80F  C1            		POP	BC
  E810  DA75E7        		JP	C,RBRERR
  E813  EB            		EX	DE,HL
  E814  2A7EF0        		LD	HL,(_DTBUF)
  E817  EDB0          		LDIR
  E819                	RBREND:
  E819  CDCEE8        		CALL	RBXEND
  E81C                	RBREND0:
  E81C  FDE1          		POP	IY
  E81E  C1            		POP	BC
  E81F  D1            		POP	DE
  E820  F1            		POP	AF	;(HL)
  E821  AF            		XOR	A
  E822  3E00          	RBRAP:	LD	A,000H
  E824  C9            		RET
                      	
  E825                	RBRDIR:
  E825  FD6E1A        		LD	L,(IY+26)	;(FCB)ファイルの先頭クラスタ
  E828  FD661B        		LD	H,(IY+27)
  E82B  CD11E4        		CALL	CHDIR
  E82E  AF            		XOR	A
  E82F  67            		LD	H,A
  E830  6F            		LD	L,A
  E831  3C            		INC	A
  E832  3223E8        		LD	(RBRAP+1),A
  E835  18E5          		JR	RBREND0
                      	
  E837                	RBX0:
  E837  2A8AEF        		LD	HL,(_DTA)
  E83A  225FEF        		LD	(DTAX),HL
  E83D  2A5DEF        		LD	HL,(LEFTX)
  E840  FD7E1C        		LD	A,(IY+28)	;(FCB)オープンモード
  E843  D6FD          		SUB	0FDH
  E845  C9            		RET
                      	
  E846                	RBX1:
  E846  E5            		PUSH	HL		;Record byte
                      					;AHL=File size
  E847  FD6E10        		LD	L,(IY+16)	;ファイルのサイズ(バイト単位)
  E84A  FD6611        		LD	H,(IY+17)
  E84D  FD7E12        		LD	A,(IY+18)
                      	
  E850  CDE7E8        		CALL	GET_RR_CDE	;CDE=Random record
                      	
  E853  A7            		AND	A
  E854  ED52          		SBC	HL,DE
  E856  99            		SBC	A,C
  E857  D1            		POP	DE
                      	
  E858  D8            		RET	C
  E859  4F            		LD	C,A
  E85A  EB            		EX	DE,HL	;CDE=File byte	HL=Record byte
  E85B  B2            		OR	D
  E85C  B3            		OR	E
  E85D  C0            		RET	NZ
  E85E  37            		SCF
  E85F  C9            		RET
                      	
  E860                	RBX2:				;Cluster settings
  E860  FD4E22        		LD	C,(IY+34)	;(+33)(FCB)ランダムレコード
  E863  FD4623        		LD	B,(IY+35)
  E866  CDC0E5        		CALL	RWXR
  E869  3A8CE8        		LD	A,(SECSZ+2)	;1024=4 / 512=2 / 256=1
  E86C  3D            		DEC	A
  E86D  FDA622        		AND	(IY+34)
  E870  FDB621        		OR	(IY+33)
  E873  C9            		RET
                      	
  E874                	RBXA:
  E874  C5            		PUSH	BC
  E875  D5            		PUSH	DE
  E876  CDD1E3        		CALL	CLUSTX
  E879  CDF1E8        		CALL	DRDX
  E87C  D1            		POP	DE
  E87D  C1            		POP	BC
  E87E  D8            		RET	C
  E87F  CD86EA        		CALL	GNCLX
  E882  D8            		RET	C
  E883  ED53FEF0      		LD	(_CLPS),DE
                      	
  E887  FD4E21        		LD	C,(IY+33)	;(FCB)ランダムレコード
  E88A  210004        	SECSZ:	LD	HL,0400H	;自己書き換え 1024=0400H / 512=0200H ここに1セクタのサイズが格納される
  E88D  7C            		LD	A,H
  E88E  3D            		DEC	A		;1024=3 / 512=1
  E88F  FDA622        		AND	(IY+34)		;(FCB)ランダムレコード
  E892  47            		LD	B,A		;BCに1セクタ以下の端数が入る
  E893  ED42          		SBC	HL,BC		;残りを計算
                      	
  E895  ED5B5DEF      		LD	DE,(LEFTX)
  E899  ED52          		SBC	HL,DE		;CP HL,DE
  E89B  19            		ADD	HL,DE		;
  E89C  3801          		JR	C,RBXA1		;DEとHLを比較して大きい方をHLに
  E89E  EB            		EX	DE,HL
  E89F                	RBXA1:
  E89F  E5            		PUSH	HL
  E8A0  2A7EF0        		LD	HL,(_DTBUF)
  E8A3  09            		ADD	HL,BC
  E8A4  ED5B5FEF      		LD	DE,(DTAX)
  E8A8  C1            		POP	BC
  E8A9  C9            		RET
                      	
  E8AA                	RBXB:
  E8AA  2A5FEF        		LD	HL,(DTAX)
  E8AD  ED5BFEF0      		LD	DE,(_CLPS)
  E8B1  3A5EEF        		LD	A,(LEFTX+1)
  E8B4  47            		LD	B,A
  E8B5  3A8CE8        		LD	A,(SECSZ+2)	;1024=4 / 512=2 / 256=1
  E8B8                	RBXB1:
  E8B8  1F            		RRA		;->CF
  E8B9  3804          		JR	C,RBXB2
  E8BB  CB38          		SRL	B	;B=B/2
  E8BD  18F9          		JR	RBXB1
  E8BF                	RBXB2:
  E8BF  78            		LD	A,B
  E8C0  B7            		OR	A
  E8C1  C9            		RET
                      	
  E8C2                	RBXC:
  E8C2  ED4B5DEF      		LD	BC,(LEFTX)
  E8C6  3A8CE8        		LD	A,(SECSZ+2)	;1024=4 / 512=2 / 256=1
  E8C9  3D            		DEC	A
  E8CA  A0            		AND	B
  E8CB  47            		LD	B,A		;1セクタ以下の端数がない場合はZ
  E8CC  B1            		OR	C
  E8CD  C9            		RET
                      	
  E8CE                	RBXEND:
  E8CE  110000        	LEFT:	LD	DE,0
  E8D1  AF            		XOR	A
  E8D2  FD6E21        		LD	L,(IY+33)	;(FCB)ランダムレコード
  E8D5  FD6622        		LD	H,(IY+34)
  E8D8  19            		ADD	HL,DE
  E8D9  FD8E23        		ADC	A,(IY+35)
  E8DC  FD7521        		LD	(IY+33),L	;(FCB)ランダムレコード
  E8DF  FD7422        		LD	(IY+34),H
  E8E2  FD7723        		LD	(IY+35),A
  E8E5  EB            		EX	DE,HL		;HL=Read byte
  E8E6  C9            		RET
                      	
  E8E7                	GET_RR_CDE:			;CDE=Random record
  E8E7  FD5E21        		LD	E,(IY+33)	;(FCB)ランダムレコード
  E8EA  FD5622        		LD	D,(IY+34)
  E8ED  FD4E23        		LD	C,(IY+35)
  E8F0  C9            		RET
                      	
                      	
                      	;LDDIO.ASM
                      	
                      	;	LSX-Dodgers DIO
                      	
  E8F1                	DRDX:
  E8F1  CD2FE9        		CALL	DRDY
  E8F4  C8            		RET	Z
  E8F5  CD15E9        		CALL	DRDX1		;データバッファの情報を保存
  E8F8  D8            		RET	C
  E8F9  E5            		PUSH	HL
  E8FA  C5            		PUSH	BC
  E8FB  D5            		PUSH	DE
  E8FC  2A7EF0        		LD	HL,(_DTBUF)
  E8FF  3A58E9        		LD	A,(_DBS24+1)
  E902  4F            		LD	C,A
  E903  CDDAEB        		CALL	DRD24
  E906  DC2AE9        		CALL	C,DRDNE
  E909                	POP_DE_BC_HL_RET:
  E909  D1            		POP	DE
  E90A  C1            		POP	BC
  E90B  E1            		POP	HL
  E90C  C9            		RET
                      	
                      	;	CDE:セクタ番号
  E90D                	DRDN:
  E90D  AF            		XOR	A
  E90E  00            	DRDN1:	NOP			;自己書き換え NOP / SCF
  E90F  30E0          		JR	NC,DRDX
  E911                	DRDNX:
  E911  CD2FE9        		CALL	DRDY
  E914  C8            		RET	Z
  E915                	DRDX1:
  E915  CD45E9        		CALL	DWTX
                      					;データバッファの読み込んだドライブ・セクタ情報を保存
  E918  ED53A6EF      		LD	(_DBSEC),DE
  E91C  79            		LD	A,C
  E91D  3258E9        		LD	(_DBS24+1),A
                      	
  E920  3A88EF        		LD	A,(_DRV)
  E923  32A5EF        		LD	(_DBDRV),A
  E926  CDD9EF        		CALL	_CHGDRV
  E929  D0            		RET	NC
  E92A                	DRDNE:
  E92A  9F            		SBC	A,A		;CF=1ならばA=0FFH
  E92B  32A5EF        		LD	(_DBDRV),A
  E92E  C9            		RET
                      	
                      	;	CDE:セクタ番号
  E92F                	DRDY:
  E92F  3A58E9        		LD	A,(_DBS24+1)
  E932  B9            		CP	C
  E933  C0            		RET	NZ
                      	
  E934  E5            		PUSH	HL
  E935  3A88EF        		LD	A,(_DRV)
  E938  21A5EF        		LD	HL,_DBDRV
  E93B  AE            		XOR	(HL)
  E93C  2005          		JR	NZ,POP_HL_RET
                      	
  E93E  2AA6EF        		LD	HL,(_DBSEC)
  E941  ED52          		SBC	HL,DE		;CF=0
  E943                	POP_HL_RET:
  E943  E1            		POP	HL
  E944  C9            		RET
                      	
  E945                	DWTX:
  E945  3AA4EF        		LD	A,(_WTDBF)
  E948  B7            		OR	A
  E949  C8            		RET	Z
  E94A  AF            		XOR	A
  E94B  32A4EF        		LD	(_WTDBF),A
                      	
  E94E  E5            		PUSH	HL
  E94F  C5            		PUSH	BC
  E950  D5            		PUSH	DE
  E951  3AA5EF        		LD	A,(_DBDRV)
  E954  CDD9EF        		CALL	_CHGDRV
  E957  0E00          	_DBS24:	LD	C,0
  E959  ED5BA6EF      		LD	DE,(_DBSEC)
  E95D  2A7EF0        		LD	HL,(_DTBUF)
  E960  D4EAEB        		CALL	NC,DWT24
  E963                	POP_DE_BC_HL_RET2:
  E963  18A4          		JR	POP_DE_BC_HL_RET
                      	
  E965                	RDFATX:
  E965  E5            		PUSH	HL
  E966  3A88EF        		LD	A,(_DRV)
  E969  21AAEF        		LD	HL,_FATDRV
  E96C  AE            		XOR	(HL)
  E96D  28D4          		JR	Z,POP_HL_RET
                      	
  E96F  C5            		PUSH	BC
  E970  D5            		PUSH	DE
  E971  DDE5          		PUSH	IX
  E973  CD8FE9        		CALL	WTFATX
  E976  3813          		JR	C,POP_IX_DE_BC_HL_RET
                      	
  E978  AF            		XOR	A
  E979  32ABEF        		LD	(_FATIX),A
  E97C  3A88EF        		LD	A,(_DRV)
  E97F  32AAEF        		LD	(_FATDRV),A
  E982  CDE5EF        		CALL	_RDFAT
  E985                	RDFATE2:
  E985  3004          		JR	NC,POP_IX_DE_BC_HL_RET
  E987  9F            		SBC	A,A		;A=0xFF
  E988  32AAEF        		LD	(_FATDRV),A
  E98B                	POP_IX_DE_BC_HL_RET:
  E98B  DDE1          		POP	IX
  E98D  18D4          		JR	POP_DE_BC_HL_RET2
                      	
  E98F                	WTFATX:
  E98F  3AA2EF        		LD	A,(_WTFATF)
  E992  B7            		OR	A
  E993  C8            		RET	Z
  E994  E5            		PUSH	HL
  E995  3AAAEF        		LD	A,(_FATDRV)
  E998  21A5EF        		LD	HL,_DBDRV
  E99B  AE            		XOR	(HL)
  E99C  CC45E9        		CALL	Z,DWTX
  E99F  38A2          		JR	C,POP_HL_RET
  E9A1  C5            		PUSH	BC
  E9A2  D5            		PUSH	DE
  E9A3  DDE5          		PUSH	IX
  E9A5  CDF7EB        		CALL	WTFAT
  E9A8  AF            		XOR	A
  E9A9  32A2EF        		LD	(_WTFATF),A
  E9AC  18DD          		JR	POP_IX_DE_BC_HL_RET
                      	
  E9AE                	NCL1:
  E9AE  7A            		LD	A,D
  E9AF  B3            		OR	E
  E9B0  37            		SCF
  E9B1  C8            		RET	Z
                      	
  E9B2  7A            		LD	A,D
  E9B3  CB3F          		SRL	A	;/2
  E9B5  CB3F          		SRL	A	;/2
                      	
  E9B7  E5            		PUSH	HL
  E9B8  32D7E9        		LD	(NCLPAT+2),A	;_FATIX
  E9BB  2AAAEF        		LD	HL,(_FATDRV)	;L=_FATDRV H=_FATIX
  E9BE  BC            		CP	H
  E9BF  3A88EF        		LD	A,(_DRV)	;この間でフラグは変化しない
  E9C2  32D6E9        		LD	(NCLPAT+1),A	;_FATDRV
  E9C5  2005          		JR	NZ,NCL2		;FATIXが違う
  E9C7  BD            		CP	L
  E9C8  2002          		JR	NZ,NCL2		;ドライブが違う
  E9CA  E1            		POP	HL
  E9CB  C9            		RET
  E9CC                	NCL2:
  E9CC  C5            		PUSH	BC
  E9CD  D5            		PUSH	DE
  E9CE  DDE5          		PUSH	IX
  E9D0  CD8FE9        		CALL	WTFATX
  E9D3  38B6          		JR	C,POP_IX_DE_BC_HL_RET
  E9D5  010000        	NCLPAT:	LD	BC,0		;自己書き換え C=_FATDRV B=_FATIX
  E9D8  ED43AAEF      		LD	(_FATDRV),BC
  E9DC  CDCCEB        		CALL	RDFATS
  E9DF  18A4          		JR	RDFATE2
                      	
  E9E1                	NCL3:
  E9E1  CB9A          		RES	3,D
  E9E3  CB92          		RES	2,D
  E9E5  6B            		LD	L,E
  E9E6  62            		LD	H,D
  E9E7  CB3C          		SRL	H	;
  E9E9  CB1D          		RR	L	;HLA=HLA/2
  E9EB  1F            		RRA		;
  E9EC  F5            		PUSH	AF
  E9ED  3AABEF        		LD	A,(_FATIX)
  E9F0  0F            		RRCA
  E9F1  300B          		JR	NC,NCL3X1
  E9F3  3A8CE8        		LD	A,(SECSZ+2)
  E9F6  FE04          		CP	4		;1セクタ1024バイトの場合は奇数インデックスの場合に先頭を512バイトずらす
  E9F8  2004          		JR	NZ,NCL3X1
  E9FA  010002        		LD	BC,512
  E9FD  09            		ADD	HL,BC
  E9FE                	NCL3X1:
  E9FE  F1            		POP	AF
  E9FF  ED4B7CF0      		LD	BC,(_FATBF)
  EA03  19            		ADD	HL,DE
  EA04  09            		ADD	HL,BC
  EA05  17            		RLA
  EA06  C9            		RET
                      	
  EA07                	GNCL:
  EA07  CDAEE9        		CALL	NCL1		;GET NEXT CLUSTER
  EA0A  D8            		RET	C
  EA0B  C5            		PUSH	BC
  EA0C  E5            		PUSH	HL
  EA0D  CDE1E9        		CALL	NCL3
  EA10  3809          		JR	C,GNC1
  EA12  5E            		LD	E,(HL)
  EA13  23            		INC	HL
  EA14  7E            		LD	A,(HL)
  EA15  E60F          		AND	00FH
  EA17  57            		LD	D,A
  EA18  E1            		POP	HL
  EA19  C1            		POP	BC
  EA1A  C9            		RET
  EA1B                	GNC1:
  EA1B  7E            		LD	A,(HL)
  EA1C  23            		INC	HL
  EA1D  56            		LD	D,(HL)
  EA1E  0604          		LD	B,4
  EA20                	GNC1L:
  EA20  CB3A          		SRL	D	;DA=DA/2
  EA22  1F            		RRA		;
  EA23  10FB          		DJNZ	GNC1L
                      	
  EA25  5F            		LD	E,A
  EA26  E1            		POP	HL
  EA27  C1            		POP	BC
  EA28  A7            		AND	A
  EA29  C9            		RET
                      	
  EA2A                	SNCL:
  EA2A  CDAEE9        		CALL	NCL1
  EA2D  D8            		RET	C
                      	;				SET NEXT CLUSTER
  EA2E  E5            		PUSH	HL
  EA2F  C5            		PUSH	BC
  EA30  D5            		PUSH	DE
  EA31  E5            		PUSH	HL
  EA32  CDE1E9        		CALL	NCL3
  EA35  D1            		POP	DE
                      	;CF=ODD
  EA36  7E            		LD	A,(HL)
  EA37  73            		LD	(HL),E
  EA38  3806          		JR	C,SNC1
                      	;EVEN
                      	;M[0] = E
                      	;M[1] = (M[1] & 0xF0) | (D & 0x0F)
  EA3A  23            		INC	HL
  EA3B  ED67          		RRD		;M={A[3:0],E[3:0]}
  EA3D  7A            		LD	A,D
  EA3E  1804          		JR	SNC11
  EA40                	SNC1:
                      	;ODD
                      	;HL[0] = (HL[0]&0x0F) | (E<<4)
                      	;HL[1] = DE>>4
  EA40  ED6F          		RLD		;M={D[3:0],E[7:4]}
  EA42  23            		INC	HL
  EA43  72            		LD	(HL),D	;M={D[3:0],E[7:4]}
  EA44                	SNC11:
  EA44  ED6F          		RLD		;M={M[7:4],D[3:0]}
  EA46  B7            		OR	A
  EA47  D1            		POP	DE
  EA48  C1            		POP	BC
  EA49  E1            		POP	HL
  EA4A                	FAT_CHANGED:
  EA4A  3E01          		LD	A,1
  EA4C  32A2EF        		LD	(_WTFATF),A
  EA4F  C9            		RET
                      	
  EA50                	N16CL3:
  EA50  C5            		PUSH	BC
  EA51  6B            		LD	L,E
  EA52  7A            		LD	A,D
  EA53  E603          		AND	3
  EA55  67            		LD	H,A
  EA56  29            		ADD	HL,HL
  EA57  ED4B7CF0      		LD	BC,(_FATBF)
  EA5B  09            		ADD	HL,BC
  EA5C  C1            		POP	BC
  EA5D  C9            		RET
                      	
  EA5E                	GNCL16:
  EA5E  CDAEE9        		CALL	NCL1		;GET NEXT CLUSTER for FAT16
  EA61  D8            		RET	C
  EA62  E5            		PUSH	HL
  EA63  CD50EA        		CALL	N16CL3
  EA66  5E            		LD	E,(HL)
  EA67  23            		INC	HL
  EA68  56            		LD	D,(HL)
  EA69  E1            		POP	HL
  EA6A  C9            		RET
                      	
  EA6B                	SNCL16:
  EA6B  CDAEE9        		CALL	NCL1		;GET NEXT CLUSTER for FAT16
  EA6E  D8            		RET	C
  EA6F  D5            		PUSH	DE
  EA70  E5            		PUSH	HL
  EA71  CD50EA        		CALL	N16CL3
  EA74  D1            		POP	DE		;HL
  EA75  73            		LD	(HL),E
  EA76  23            		INC	HL
  EA77  72            		LD	(HL),D
  EA78  6B            		LD	L,E
  EA79  62            		LD	H,D
  EA7A  D1            		POP	DE
  EA7B  18CD          		JR	FAT_CHANGED
                      	
                      	;------------------------
                      	;次のセクタを探す際に_SECPSの値をチェック
                      	;in
                      	;	DE : セクタ番号
                      	;out
                      	;	DE : 次のセクタ番号
                      	;note
                      	;
                      	;------------------------
  EA7D                	NEXTX:
  EA7D  3E00          	_SECPS:	LD	A,0	;自己書き換え
  EA7F  3C            		INC	A
  EA80  E600          	NCPAT:	AND	0	;自己書き換え　1クラスタの論理セクタ数-1
  EA82  327EEA        		LD	(_SECPS+1),A
  EA85  C9            		RET
                      	
  EA86                	GNCLX:
  EA86  CD7DEA        		CALL	NEXTX
  EA89  C0            		RET	NZ	;1クラスタのセクタ未満の場合は戻る
  EA8A  C3F7EF        		JP	_GNCL	;次のクラスタを探す
                      	
  EA8D                	RDFAT:
  EA8D  3E80          		LD	A,080H
  EA8F  3270EF        		LD	(CHECK),A
  EA92                	RDFAT1:
  EA92  3A88EF        		LD	A,(_DRV)
  EA95  CD2AED        		CALL	CHGDRVR
  EA98  D8            		RET	C
  EA99  DD7E12        		LD	A,(IX+012H)	;DPB_12_DEVICE
  EA9C  CB6F          		BIT	5,A
  EA9E  2843          		JR	Z,RDFAT0X
  EAA0  2170EF        		LD	HL,CHECK
  EAA3  A6            		AND	(HL)
  EAA4  77            		LD	(HL),A
  EAA5  110000        		LD	DE,0		;BPB
  EAA8  2A7CF0        		LD	HL,(_FATBF)
  EAAB  CDD8EB        		CALL	DRD16
  EAAE  3024          		JR	NC,GETBPB
  EAB0  2170EF        		LD	HL,CHECK
  EAB3  CB06          		RLC	(HL)
  EAB5  3F            		CCF
  EAB6  D8            		RET	C
  EAB7  DDCB0A1E      		RR	(IX+00AH)	;DPB_0A_FDMODE
  EABB  3F            		CCF			;フロッピーディスクのMFMモードを切り替える
  EABC  DDCB0A16      		RL	(IX+00AH)	;DPB_0A_FDMODE
  EAC0  3EFF          		LD	A,0FFH
  EAC2  3289EF        		LD	(_DSK),A
  EAC5  3A84EF        		LD	A,(_DRIVE)
  EAC8  E603          		AND	3
  EACA  F680          		OR	080H
  EACC  6F            		LD	L,A
  EACD  26EF          		LD	H,_CYL0/256
  EACF  3EFF          		LD	A,0FFH
  EAD1  77            		LD	(HL),A
  EAD2  18BE          		JR	RDFAT1
  EAD4                	GETBPB:
  EAD4  FDE5          		PUSH	IY
  EAD6  FD2A7CF0      		LD	IY,(_FATBF)	;BPB
  EADA  CDF1EF        		CALL	_BPB2DPB
  EADD  FDE1          		POP	IY
  EADF  D8            		RET	C
  EAE0  CD80EC        		CALL	CHGDRV2
  EAE3                	RDFAT0X:
  EAE3  CDCCEB        		CALL	RDFATS
  EAE6  D8            		RET	C
  EAE7  DDBE06        		CP	(IX+6)		;DPB_06_FATID
  EAEA  C8            		RET	Z
  EAEB  DDCB126E      		BIT	5,(IX+012H)	;DPB_12_DEVICE
  EAEF  C0            		RET	NZ		;BPBを取得している場合はFATIDをチェックしない
  EAF0  37            		SCF
  EAF1  C9            		RET
                      	
  EAF2                	BPB2DPB:
  EAF2  FD7E00        		LD	A,(IY+0)	;BS_JmpBoot
  EAF5  FEEB          		CP	0EBH		;Short jump
  EAF7  2808          		JR	Z,BPBOK
  EAF9  FEE9          		CP	0E9H		;Near jump
  EAFB  2804          		JR	Z,BPBOK
  EAFD  FE60          		CP	060H		;X68k
  EAFF  37            		SCF
  EB00  C0            		RET	NZ
  EB01                	BPBOK:
  EB01  FD7E0D        		LD	A,(IY+13)	;BPB_SecPerClus
  EB04  DD7707        		LD	(IX+7),A	;DPB_07_SECPCL
                      	
  EB07  FD7E16        		LD	A,(IY+22)	;BPB_FATSz16
  EB0A  DD7700        		LD	(IX+0),A	;DPB_00_FATLN
  EB0D  FD7E17        		LD	A,(IY+23)	;BPB_FATSz16
  EB10  DD7701        		LD	(IX+1),A	;DPB_00_FATLN
                      	
  EB13  FD6E0E        		LD	L,(IY+14)	;BPB_RsvdSecCnt
  EB16  FD660F        		LD	H,(IY+15)
  EB19  DD750E        		LD	(IX+00EH),L	;DPB_0E_FATPS
  EB1C  FD5E16        		LD	E,(IY+22)	;BPB_FATSz16
  EB1F  FD5617        		LD	D,(IY+23)
  EB22  FD4610        		LD	B,(IY+16)	;BPB_NumFATs
  EB25                	BPBDP1:				;BPB_FATSz16 * BPB_NumFATs
  EB25  19            		ADD	HL,DE
  EB26  10FD          		DJNZ	BPBDP1
  EB28                	BPBDP2:
  EB28  DD7510        		LD	(IX+010H),L	;DPB_10_DIRPS
  EB2B  DD7411        		LD	(IX+011H),H
  EB2E  E5            		PUSH	HL
                      	
  EB2F  FD6E11        		LD	L,(IY+17)	;BPB_RootEntCnt
  EB32  FD6612        		LD	H,(IY+18)
  EB35  FD7E0C        		LD	A,(IY+12)	;BPB_BytsPerSec
  EB38  0606          		LD	B,6
  EB3A                	BPBBPS1:
  EB3A  05            		DEC	B
  EB3B  0F            		RRCA
  EB3C  30FC          		JR	NC,BPBBPS1
  EB3E                	BPBDE1:
  EB3E  29            		ADD	HL,HL
  EB3F  10FD          		DJNZ	BPBDE1
                      	
  EB41  7C            		LD	A,H
  EB42  DD770B        		LD	(IX+00BH),A	;DPB_0B_DIRSCNT
                      	
  EB45  D1            		POP	DE		;DPB_10_DIRPS
  EB46  6C            		LD	L,H
  EB47  2600          		LD	H,0
  EB49  19            		ADD	HL,DE		;MAXDIR
  EB4A  E5            		PUSH	HL
  EB4B  FD4E0D        		LD	C,(IY+13)	;BPB_SecPerClus
  EB4E  CB21          		SLA	C		;*2
  EB50  AF            		XOR	A
  EB51  47            		LD	B,A
  EB52  ED42          		SBC	HL,BC
  EB54  DD7514        		LD	(IX+014H),L	;DPB_14_ADDCL16
  EB57  DD7415        		LD	(IX+015H),H
                      	
  EB5A  D1            		POP	DE		;DE=DPB_0B_MAXDIR
  EB5B  FD6E13        		LD	L,(IY+19)	;BPB_TotSec16
  EB5E  FD6614        		LD	H,(IY+20)
  EB61  7C            		LD	A,H
  EB62  B5            		OR	L
  EB63  3E00          		LD	A,0		;LDでフラグは変化しない。BPB_TotSec16を AHL で扱う為、Aに0を入れる
  EB65  2010          		JR	NZ,BPB16BIT	;BPB_TotSec16が「0」の場合はBPB_TotSec32で計算
  EB67  FD7E23        		LD	A,(IY+35)	;念のために総セクタ数が24ビットを超える場合はエラーを返す
  EB6A  B7            		OR	A
  EB6B  37            		SCF
  EB6C  C0            		RET	NZ
  EB6D  FD6E20        		LD	L,(IY+32)	;BPB_TotSec32 は AHL の24ビットで扱う
  EB70  FD6621        		LD	H,(IY+33)	;1クラスタの論理セクタ数(DPB_07_SECPCL)が最大128なので
  EB73  FD7E22        		LD	A,(IY+34)	;24ビットを超えると必ずクラスタ数が16ビットを超えてしまうのでこれで十分
  EB76  A7            		AND	A		;CF=0
  EB77                	BPB16BIT:
  EB77  ED52          		SBC	HL,DE
  EB79  DE00          		SBC	A,0
  EB7B  FD460D        		LD	B,(IY+13)	;BPB_SecPerClus
  EB7E                	BPBTC1:				;総クラスタ数(AHL) = 総セクタ数(AHL) / セクタサイズ(B)
  EB7E  CB18          		RR	B		;->CY
  EB80  3808          		JR	C,BPBTC2
  EB82  CB3F          		SRL	A
  EB84  CB1C          		RR	H		;AHL=AHL/2
  EB86  CB1D          		RR	L
  EB88  18F4          		JR	BPBTC1
  EB8A                	BPBTC2:
  EB8A  B7            		OR	A
  EB8B  37            		SCF
  EB8C  C0            		RET	NZ		;念のため(クラスタ数が16ビットを超える場合)
  EB8D  23            		INC	HL
  EB8E  23            		INC	HL
  EB8F  DD7508        		LD	(IX+8),L	;DPB_08_MAXCL
  EB92  DD7409        		LD	(IX+9),H
                      	
  EB95  FD7E15        		LD	A,(IY+21)	;BPB_Media
  EB98  DD7706        		LD	(IX+6),A	;DPB_06_FATID
                      	
  EB9B  DDCB0A7E      		BIT	7,(IX+00AH)	;DPB_0A_FDMODE
  EB9F  2817          		JR	Z,NOT_FD
  EBA1  2E28          		LD	L,40		;MAXCYLの設定（要検討）ここから下はフロッピーのみ書き換える
  EBA3  FEFD          		CP	0FDH	;2D
  EBA5  2808          		JR	Z,SETCYL
  EBA7  2E4D          		LD	L,77
  EBA9  FEFE          		CP	0FEH	;2HD
  EBAB  2802          		JR	Z,SETCYL
  EBAD  2E50          		LD	L,80	;その他2DD等
  EBAF                	SETCYL:
  EBAF  DD750C        		LD	(IX+00CH),L	;DPB_0C_MAXCYL
  EBB2  FD7E18        		LD	A,(IY+24)	;BPB_SecPerTr
  EBB5  DD770D        		LD	(IX+00DH),A	;DPB_0D_MAXSEC	;ここまでフロッピー専用
  EBB8                	NOT_FD:
  EBB8  FD7E10        		LD	A,(IY+16)	;BPB_NumFATs
  EBBB  FE02          		CP	2		;>2:NC
  EBBD  FD7E0C        		LD	A,(IY+12)	;BPB_BytsPerSec
  EBC0  3802          		JR	C,BPBFAT1
  EBC2  F680          		OR	080H
  EBC4                	BPBFAT1:
  EBC4  DD770F        		LD	(IX+00FH),A	;DPB_0F_BPS
                      	
  EBC7  E67F          		AND	07FH		;セクタバッファが1KBしかないので1KBを超える場合はCF=1でエラーにする
  EBC9  C6FB          		ADD	A,0-5		;0-4:CF=0 5以上:CF=1
  EBCB  C9            		RET
                      	
  EBCC                	RDFATS:
  EBCC  CD12EC        		CALL	FATSETUP
  EBCF  D8            		RET	C
  EBD0  CDDCEB        		CALL	DRD24B
  EBD3  2A7CF0        		LD	HL,(_FATBF)
  EBD6  7E            		LD	A,(HL)
  EBD7  C9            		RET
                      	
  EBD8                	DRD16:
  EBD8  0E00          		LD	C,0
  EBDA                	DRD24:
  EBDA  0601          		LD	B,1
  EBDC                	DRD24B:
  EBDC  DDE5          		PUSH	IX
  EBDE  DD2AA8EF      		LD	IX,(_DPB)
  EBE2  CD4AEE        	DRDPAT:	CALL	FDRD		;自己書き換え（ディスク読み込み）
  EBE5                	POP_IX_RET:
  EBE5  DDE1          		POP	IX
  EBE7  C9            		RET
                      	
  EBE8                	DWT16:
  EBE8  0E00          		LD	C,0
  EBEA                	DWT24:
  EBEA  0601          		LD	B,1
  EBEC                	DWT24B:
  EBEC  DDE5          		PUSH	IX
  EBEE  DD2AA8EF      		LD	IX,(_DPB)
  EBF2  CD3CEE        	DWTPAT:	CALL	FDWT		;自己書き換え（ディスク書き込み）
  EBF5  18EE          		JR	POP_IX_RET
                      	
  EBF7                	WTFAT:
  EBF7  CD12EC        		CALL	FATSETUP
  EBFA  D4ECEB        		CALL	NC,DWT24B
  EBFD  D8            		RET	C
  EBFE  DDCB0F7E      		BIT	7,(IX+00FH)	;DPB_0F_BPS
  EC02  C8            		RET	Z		;予備FATが無い
  EC03  CD19EC        		CALL	FATS2
  EC06  E5            		PUSH	HL		;予備FAT
  EC07  DD6E00        		LD	L,(IX+0)	;DPB_00_FATLN
  EC0A  DD6601        		LD	H,(IX+1)
  EC0D  19            		ADD	HL,DE
  EC0E  EB            		EX	DE,HL
  EC0F  E1            		POP	HL
  EC10  18DA          		JR	DWT24B
                      	;------------------------
                      	;FATのセットアップ
                      	;out
                      	;	B  : FATセクタ数
                      	;	DE : FAT先頭セクタ番号
                      	;	HL : FATバッファポインタ
                      	;	CF : 1=ドライブ切り替えエラー
                      	;note
                      	;	FATサイズがFATバッファを超える場合は
                      	;	対象クラスタ領域==(_FATIX)によって
                      	;	FAT12:対象クラスタ1024毎に1.5KBを切り替える
                      	;	FAT16:対象クラスタ1024毎に2KBを切り替える
                      	;------------------------
  EC12                	FATSETUP:
  EC12  3AAAEF        		LD	A,(_FATDRV)
  EC15  CD2AED        		CALL	CHGDRVR		;ドライブ切り替え
  EC18  D8            		RET	C
  EC19                	FATS2:
  EC19  DD7E0F        		LD	A,(IX+00FH)	;DPB_0F_BPS 512=2 1024=4
  EC1C  0F            		RRCA
  EC1D  CD46EC        	FATSX:	CALL	FATSETUP12	;自己書き換え
  EC20  210000        		LD	HL,0
  EC23  4A            		LD	C,D
  EC24  54            		LD	D,H
  EC25  3AABEF        		LD	A,(_FATIX)	;範囲FAT12:0-3/FAT16:0-63(0-03FH):65535*2/2048
  EC28  47            		LD	B,A
  EC29  04            		INC	B
  EC2A  DD7E00        		LD	A,(IX+0)	;DPB_00_FATLN
  EC2D                	FAT_SKP:
  EC2D  05            		DEC	B
  EC2E  2805          		JR	Z,FAT1
  EC30  19            		ADD	HL,DE
  EC31  93            		SUB	E
  EC32  30F9          		JR	NC,FAT_SKP
  EC34  C9            		RET
  EC35                	FAT1:
  EC35  EB            		EX	DE,HL
  EC36  B9            		CP	C		;C=FATバッファに読み込めるセクタ数
  EC37  3801          		JR	C,FAT2
  EC39  79            		LD	A,C
  EC3A                	FAT2:
  EC3A  47            		LD	B,A
                      	
  EC3B  2AFAF0        		LD	HL,(_FATPS)	;fat sector pos
  EC3E  19            		ADD	HL,DE
  EC3F  EB            		EX	DE,HL
  EC40  2A7CF0        		LD	HL,(_FATBF)
  EC43  AF            		XOR	A		;CF=0
  EC44  4F            		LD	C,A
  EC45  C9            		RET
                      	;
                      	;	FATバッファに読み込める最大のセクタ数と_FATIXで進めるセクタ数
                      	;	FATSETUP* (FAT12/FAT16)
                      	;out
                      	;	D : FATバッファに読み込める最大のセクタ数
                      	;	E : _FATIXで進めるセクタ数
  EC46                	FATSETUP12:
  EC46  110606        		LD	DE,0606H	;256
  EC49  D8            		RET	C
  EC4A  110303        		LD	DE,0303H	;512
  EC4D  0F            		RRCA
  EC4E  D8            		RET	C
  EC4F  110102        		LD	DE,0201H	;1024
  EC52  C9            		RET
                      	
  EC53                	FATSETUP16:
  EC53  110808        		LD	DE,0808H	;256
  EC56  D8            		RET	C
  EC57  110404        		LD	DE,0404H
  EC5A  0F            		RRCA			;512
  EC5B  D8            		RET	C
  EC5C  110202        		LD	DE,0202H	;1024
  EC5F  C9            		RET
                      	
  EC60                	CHGDRV:
  EC60  E5            		PUSH	HL
  EC61  2189EF        		LD	HL,_DSK
  EC64  BE            		CP	(HL)
  EC65  280A          		JR	Z,CHGDRVE
  EC67                	CHGDRV1:
  EC67  DDE5          		PUSH	IX
  EC69  CD73EC        		CALL	CHGDRV0
  EC6C  3A89EF        		LD	A,(_DSK)
  EC6F  DDE1          		POP	IX
  EC71                	CHGDRVE:
  EC71  E1            		POP	HL
  EC72  C9            		RET
                      	
  EC73                	CHGDRV0:
  EC73  6F            		LD	L,A
  EC74  CDDCEF        		CALL	_GETDPB
  EC77  D8            		RET	C
  EC78  DD22A8EF      		LD	(_DPB),IX
  EC7C  7D            		LD	A,L
  EC7D  3289EF        		LD	(_DSK),A
  EC80                	CHGDRV2:
  EC80  C5            		PUSH	BC
  EC81  D5            		PUSH	DE
  EC82  ED73DFEC      		LD	(SPPAT2+1),SP
  EC86  F3            		DI
  EC87  DDF9          		LD	SP,IX
                      	
  EC89  E1            		POP	HL		;DPB_00_FATLN
  EC8A  E1            		POP	HL		;DPB_02_DRD
  EC8B  22E3EB        		LD	(DRDPAT+1),HL
                      	
  EC8E  E1            		POP	HL
  EC8F  22F3EB        		LD	(DWTPAT+1),HL	;DPB_04_DWT
                      	
  EC92  E1            		POP	HL		;L=DPB_06_FATID H=DPB_07_SECPCL
  EC93  7C            		LD	A,H
  EC94  32D5E3        		LD	(SPCPAT+1),A	;1クラスタの論理セクタ数
  EC97  3D            		DEC	A
  EC98  3281EA        		LD	(NCPAT+1),A
                      	
  EC9B  E1            		POP	HL		;DPB_08_MAXCL
  EC9C  7D            		LD	A,L
  EC9D  32F4E3        		LD	(CLPAT2+1),A
  ECA0  7C            		LD	A,H
  ECA1  32F0E3        		LD	(CLPAT1+1),A
  ECA4  2B            		DEC	HL
  ECA5  22EEE5        		LD	(MAXCLP+1),HL
                      	
  ECA8  E1            		POP	HL		;L=DPB_0A_FDMODE H=DPB_0B_DIRSCNT
  ECA9  7D            		LD	A,L
  ECAA  F6FE          		OR	0FEH
  ECAC  32E5ED        		LD	(FDMODE+1),A
  ECAF  07            		RLCA
  ECB0  E603          		AND	3
  ECB2  32CDED        		LD	(FSPAT+1),A
  ECB5  4C            		LD	C,H
                      	
  ECB6  E1            		POP	HL		;L=DPB_0C_MAXCYL H=DPB_0D_MAXSEC
  ECB7  7D            		LD	A,L
  ECB8  32A1EF        		LD	(_MAXCYL),A
  ECBB  7C            		LD	A,H
  ECBC  3276ED        		LD	(MAXSEC+1),A
                      	
  ECBF  E1            		POP	HL		;L=DPB_0E_FATPS H=DPB_0F_BPS
  ECC0  7C            		LD	A,H		;DPB_0F_BPS
  ECC1  E607          		AND	7
  ECC3  328CE8        		LD	(SECSZ+2),A	;1セクタのサイズの上位1バイト 0x400 - 0x200 - 0x100
                      					;1セクタ512 2D/2DD/2HC/2HQ(2HD1.44MB)/EMM/BRAM等
                      					;1セクタ1024 2HD/2HDE98
                      					;1セクタ256 GRAM等
                      					;1024	512	256
                      					;4	2	1
  ECC6  87            		ADD	A,A		;8	4	2
  ECC7  87            		ADD	A,A		;010H	8	4
  ECC8  87            		ADD	A,A		;020H	010H	8
  ECC9  3251E2        		LD	(SDECPAT+1),A	;1セクタ辺りのディレクトリエントリ数
                      	
  ECCC  2600          		LD	H,0
  ECCE  22FAF0        		LD	(_FATPS),HL
                      	
  ECD1  E1            		POP	HL		;L=DPB_10_DIRPS
  ECD2  22FCF0        		LD	(_DIRPS),HL
                      	
  ECD5  E1            		POP	HL		;L=DPB_12_DEVICE H=DPB_13_UNITNO
  ECD6  7C            		LD	A,H
  ECD7  3284EF        		LD	(_DRIVE),A
                      	
  ECDA  E1            		POP	HL		;DPB_14_ADDCL16
  ECDB  22E5E3        		LD	(CLSPAT+1),HL
                      	
  ECDE  310000        	SPPAT2:	LD	SP,0		;元のSPを復元
  ECE1  FB            		EI
  ECE2  2AFCF0        		LD	HL,(_DIRPS)
  ECE5  0600          		LD	B,0
  ECE7  09            		ADD	HL,BC
  ECE8  226CE2        		LD	(MD_PAT+1),HL
                      	
  ECEB  2AEEE5        		LD	HL,(MAXCLP+1);
  ECEE  11F60F        		LD	DE,4086
  ECF1  B7            		OR	A
  ECF2  ED52          		SBC	HL,DE
  ECF4  300F          		JR	NC,SETFAT16
  ECF6  2107EA        		LD	HL,GNCL		;FAT12
  ECF9  112AEA        		LD	DE,SNCL
  ECFC  0146EC        		LD	BC,FATSETUP12
  ECFF  DDCB0FAE      		RES	5,(IX+00FH)	;DPB_0F_BPS(FAT12)
  ED03  180D          		JR	EXTRA1
  ED05                	SETFAT16:
  ED05  215EEA        		LD	HL,GNCL16	;FAT16
  ED08  116BEA        		LD	DE,SNCL16
  ED0B  0153EC        		LD	BC,FATSETUP16
  ED0E  DDCB0FEE      		SET	5,(IX+00FH)	;DPB_0F_BPS(FAT16)
  ED12                	EXTRA1:
  ED12  22F8EF        		LD	(GNCPAT+1),HL
  ED15  ED53FBEF      		LD	(SNCPAT+1),DE
  ED19  ED431EEC      		LD	(FATSX+1),BC
  ED1D  D1            		POP	DE
  ED1E  C1            		POP	BC
  ED1F  AF            		XOR	A
  ED20  C9            		RET
                      	
  ED21                	GETDPBD:
  ED21  DDE3          		EX	(SP),IX
  ED23  DDE5          		PUSH	IX
  ED25  3A88EF        		LD	A,(_DRV)
  ED28  1807          		JR	GETDPB1
                      	
  ED2A                	CHGDRVR:
  ED2A  CDD9EF        		CALL	_CHGDRV
  ED2D  D8            		RET	C
  ED2E  3A89EF        		LD	A,(_DSK)
  ED31                	GETDPB1:
  ED31  C3DCEF        		JP	_GETDPB
                      	
  ED34                	GETDPB:
  ED34  FE08          		CP	8
  ED36  3F            		CCF
  ED37  D8            		RET	C
  ED38  0F            		RRCA
  ED39  0F            		RRCA
  ED3A  0F            		RRCA
  ED3B  DD            		DB	0DDH		;Z80未定義命令
  ED3C  6F            		LD	L,A		;LD	IXL,A
  ED3D  DD            		DB	0DDH		;Z80未定義命令
  ED3E  26F1          		LD	H,DEVICE/256	;LD	IXH,DEVICE/256
  ED40  DD7E00        		LD	A,(IX+0)	;DPB_00_FATLN
  ED43  B7            		OR	A		;CF=0の為
  ED44  DDCB0F6E      		BIT	5,(IX+00FH)	;DPB_0F_BPS
  ED48  C0            		RET	NZ		;FAT16
  ED49  DDCB126E      		BIT	5,(IX+012H)	;DPB_12_DEVICE
  ED4D  C0            		RET	NZ		;BPB
  ED4E  FE01          		CP	001H		;A=0 THEN CF=1
  ED50  C9            		RET
                      	
  ED51                	_SYS5F:
  ED51  AF            		XOR	A
  ED52                	FFLUSH:
  ED52  F5            		PUSH	AF
  ED53  3EFF          		LD	A,0FFH
  ED55  3239EF        		LD	(SFILE),A
  ED58  CD45E9        		CALL	DWTX
  ED5B  3EFF          		LD	A,0FFH
  ED5D  32A5EF        		LD	(_DBDRV),A
  ED60  CD8FE9        		CALL	WTFATX
  ED63  AF            		XOR	A
  ED64  32ABEF        		LD	(_FATIX),A
  ED67  2F            		CPL
  ED68  32AAEF        		LD	(_FATDRV),A
  ED6B  F1            		POP	AF
  ED6C  C9            		RET
                      	
                      	
                      	;X1DISK.ASM
                      	
                      	;	LSX-Dodgers DISK
                      	;	X1/turbo/Z
                      	
  ED6D                	SEEK:
  ED6D  7A            		LD	A,D
  ED6E  B3            		OR	E
  ED6F  3E01          		LD	A,001H
  ED71  2811          		JR	Z,DIV3
                      	
  ED73  0610          		LD	B,16
  ED75  0E00          	MAXSEC:	LD	C,000H
  ED77  AF            		XOR	A
  ED78  EB            		EX	DE,HL
  ED79                	DIV1:
  ED79  29            		ADD	HL,HL
  ED7A  8F            		ADC	A,A
  ED7B  B9            		CP	C
  ED7C  3802          		JR	C,DIV2
  ED7E  91            		SUB	C
  ED7F  2C            		INC	L
  ED80                	DIV2:
  ED80  10F7          		DJNZ	DIV1
                      	
  ED82  3C            		INC	A	;最小のセクタは１固定
  ED83  55            		LD	D,L	;Quotient(TRACK)
  ED84                	DIV3:
  ED84  5F            		LD	E,A	;Remainder
  ED85  CB3A          		SRL	D	;CYLINDER
  ED87  9F            		SBC	A,A
  ED88  E610          		AND	010H	;SIDE
  ED8A  4F            		LD	C,A
                      	
  ED8B  3A84EF        		LD	A,(_DRIVE)
  ED8E  FE04          		CP	4
  ED90  3F            		CCF
  ED91  D8            		RET	C
  ED92  B1            		OR	C
  ED93  3211EE        		LD	(MOPAT+1),A	;Motor off data
  ED96  01FC0F        		LD	BC,00FFCH
  ED99  F680          		OR	080H		;Motor on
  ED9B  ED79          		OUT	(C),A
                      	
  ED9D  CDE3ED        		CALL	SETMODE
  EDA0  D8            		RET	C
                      	
  EDA1  CD26EE        		CALL	DRIVE
  EDA4  FEFF          		CP	0FFH		;A=0FFH Unknown CYLINDER
  EDA6  CC05EE        		CALL	Z,FDCRES	;Restore
  EDA9  0EF9          		LD	C,0F9H
  EDAB  ED79          		OUT	(C),A		;Currrent CYLINDER
  EDAD  92            		SUB	D
  EDAE  C8            		RET	Z		;No seek
                      	
  EDAF  3A86EF        		LD	A,(_ISEEK)
  EDB2  4F            		LD	C,A
                      	
  EDB3  3AA1EF        		LD	A,(_MAXCYL)	;Max CYLINDER
  EDB6  3D            		DEC	A
  EDB7  BA            		CP	D		;Over CYLINDER
  EDB8  D8            		RET	C
                      	
  EDB9  B9            		CP	C		;for Built-in 2DD
  EDBA  3803          		JR	C,SETM2
  EDBC  78            		LD	A,B		;B=00FH
  EDBD  DBFE          		IN	A,(0FEH)		;2HD mode for 2DD seek
  EDBF                	SETM2:
  EDBF  78            		LD	A,B
  EDC0  DBFD          		IN	A,(0FDH)		;MFM mode
                      	
  EDC2  0EFB          		LD	C,0FBH
  EDC4  ED51          		OUT	(C),D
  EDC6  72            		LD	(HL),D
  EDC7  0E18          		LD	C,018H		;Seek
  EDC9                	FDCCMD2:
  EDC9  3A85EF        		LD	A,(_SEEKSP)
  EDCC  E6FF          	FSPAT:	AND	0FFH
  EDCE  B1            		OR	C
                      	
  EDCF                	FDCCMD:
  EDCF  CD1CEE        		CALL	COMSET
                      	
  EDD2  3E80          	FDCPAT:	LD	A,080H		;FDC COMMAND(Self-modifying code)
  EDD4  E620          		AND	020H		;Write data Write track
  EDD6  3C            		INC	A
                      	
  EDD7                	SST:
  EDD7  0E00          		LD	C,0
  EDD9                	SST1:
  EDD9  0D            		DEC	C		; 4
  EDDA  20FD          		JR	NZ,SST1		;12 * 256 / 4 = About 1ms
  EDDC  3D            		DEC	A
  EDDD  20FA          		JR	NZ,SST1
                      	
  EDDF  3C            		INC	A		;A=1
  EDE0  CDEEED        		CALL	READY
  EDE3                	SETMODE:
  EDE3  78            		LD	A,B		;B=00FH
  EDE4  DBFF          	FDMODE:	IN	A,(0FFH)	;Floppy mode(2D/2HD) (Self-modifying code)
                      	
  EDE6  78            		LD	A,B
  EDE7  DBFD          		IN	A,(0FDH)	;MFM mode
                      	
  EDE9  CD20EE        		CALL	DELAY0		;Head select time
  EDEC  3E81          		LD	A,081H
  EDEE                	READY:
  EDEE  32F8ED        		LD	(WAITA+1),A
  EDF1  E5            		PUSH	HL
  EDF2  0EF8          		LD	C,0F8H
  EDF4  61            		LD	H,C
  EDF5                	READY2:
  EDF5  ED78          		IN	A,(C)
  EDF7  E681          	WAITA:	AND	081H		;NOT READY,BUSY
  EDF9  2808          		JR	Z,READYE
  EDFB  E3            		EX	(SP),HL		;wait 19clock
  EDFC  E3            		EX	(SP),HL		; //
  EDFD  2B            		DEC	HL
  EDFE  7C            		LD	A,H
  EDFF  B5            		OR	L
  EE00  20F3          		JR	NZ,READY2
  EE02  37            		SCF
  EE03                	READYE:
  EE03  E1            		POP	HL
  EE04  C9            		RET
                      	
  EE05                	FDCRES:
  EE05  3600          		LD	(HL),0
  EE07  0E08          		LD	C,8
  EE09  18BE          		JR	FDCCMD2
                      	
  EE0B                	FDMOFF:
  EE0B  F5            		PUSH	AF
  EE0C  C5            		PUSH	BC
  EE0D  01FC0F        		LD	BC,00FFCH	;Motor off
  EE10  3E00          	MOPAT:	LD	A,000H		;(Self-rewriting)
  EE12  ED79          		OUT	(C),A
  EE14  C1            		POP	BC
  EE15  F1            		POP	AF
  EE16  C9            		RET
                      	
  EE17                	SECSET:
  EE17  01FA0F        		LD	BC,00FFAH
  EE1A  ED59          		OUT	(C),E
  EE1C                	COMSET:
  EE1C  0EF8          		LD	C,0F8H
  EE1E  ED79          		OUT	(C),A
  EE20                	DELAY0:
  EE20  3E1A          		LD	A,26
  EE22                	DELAY:
  EE22  3D            		DEC	A
  EE23  20FD          		JR	NZ,DELAY
  EE25  C9            		RET
                      	
  EE26                	DRIVE:
  EE26  2A84EF        		LD	HL,(_DRIVE)
  EE29  26EF          		LD	H,_CYL0/256
  EE2B  CBFD          		SET	7,L
  EE2D  7E            		LD	A,(HL)
  EE2E  C9            		RET
                      	
  EE2F                	RNF:
  EE2F  CD26EE        		CALL	DRIVE
  EE32  36FF          		LD	(HL),0FFH
  EE34  C9            		RET
                      	
  EE35  02            	RETRY:	DB	2
                      	
                      	
                      	;	FLOPPY DISK DRIVER(DMA)
                      	
                      	
  EE36                	WTTRK:
  EE36  0601          		LD	B,1
  EE38  3EF4          		LD	A,0F4H
  EE3A  1802          		JR	WTTRK1
  EE3C                	FDWT:
  EE3C  3EA0          		LD	A,0A0H
  EE3E                	WTTRK1:
  EE3E  32D3ED        		LD	(FDCPAT+1),A
  EE41  3E10          		LD	A,16
  EE43  180C          		JR	DISK
                      	
  EE45                	DISKOK:
  EE45  0601          	FDCNT:	LD	B,1
  EE47  100B          		DJNZ	DISK1
  EE49  C9            		RET
                      	
  EE4A                	FDRD:
  EE4A  3E80          		LD	A,080H
  EE4C  32D3ED        		LD	(FDCPAT+1),A
  EE4F  3E0E          		LD	A,14
                      	
  EE51                	DISK:
  EE51  3268EE        		LD	(DMAPAT+1),A
  EE54                	DISK1:
  EE54  78            		LD	A,B
  EE55  3246EE        		LD	(FDCNT+1),A
  EE58  22EAEE        		LD	(DMAD+11),HL
  EE5B                	DISKR:
  EE5B  3E02          		LD	A,2		;Retry count
  EE5D  3235EE        		LD	(RETRY),A
  EE60                	DISK2:
  EE60  D5            		PUSH	DE
  EE61  CD6DED        		CALL	SEEK
  EE64  3843          		JR	C,ERRF
  EE66  F3            		DI
                      	
  EE67  3E0E          	DMAPAT:	LD	A,14		;自己書き換え
  EE69  21DFEE        		LD	HL,DMAD
  EE6C  CDF6DF        		CALL	SETDMA
  EE6F  ED49          		OUT	(C),C		;OUT 01F87H,087H WR6 イネーブル
  EE71  3AD3ED        		LD	A,(FDCPAT+1)
  EE74  C5            		PUSH	BC
  EE75  CD17EE        		CALL	SECSET
  EE78  2AEAEE        		LD	HL,(DMAHL)
  EE7B  23            		INC	HL
  EE7C  1106BB        		LD	DE,0BB06H	;READ DMA
                      	
  EE7F  3E03          		LD	A,3
  EE81  CDEEED        		CALL	READY
  EE84  ED78          		IN	A,(C)
                      	
  EE86  C1            		POP	BC
  EE87  ED51          		OUT	(C),D		;読み出しマスク設定
  EE89  ED59          		OUT	(C),E		;バイトカウンタ(LH)
  EE8B  ED58          		IN	E,(C)
  EE8D  ED50          		IN	D,(C)
  EE8F  19            		ADD	HL,DE
  EE90  D1            		POP	DE
  EE91  13            		INC	DE
  EE92  FB            		EI
  EE93  CD0BEE        		CALL	FDMOFF
  EE96  B7            		OR	A
  EE97  28AC          		JR	Z,DISKOK
  EE99  1B            		DEC	DE
  EE9A  CB67          		BIT	4,A
  EE9C  C42FEE        		CALL	NZ,RNF
  EE9F                	DISKE2:
  EE9F  2135EE        		LD	HL,RETRY
  EEA2  35            		DEC	(HL)
  EEA3  20BB          		JR	NZ,DISK2
  EEA5  B7            		OR	A
  EEA6  2834          		JR	Z,ERR
  EEA8  D5            		PUSH	DE
  EEA9                	ERRF:
  EEA9  D1            		POP	DE
  EEAA                	DELP:
  EEAA  CD2FEE        		CALL	RNF
  EEAD  CD0BEE        		CALL	FDMOFF
  EEB0  3A85EF        		LD	A,(_SEEKSP)
  EEB3  87            		ADD	A,A
  EEB4  9F            		SBC	A,A
  EEB5  3825          		JR	C,ERR
  EEB7                	DELP1:
  EEB7  D5            		PUSH	DE
  EEB8  21C0F0        		LD	HL,DEMES
  EEBB  CD6ED8        		CALL	MSX
  EEBE  CDECDB        		CALL	KEYBC
  EEC1                	DELP2:
  EEC1  CDCAEF        		CALL	_INKEY
  EEC4  28FB          		JR	Z,DELP2
                      	
  EEC6  D1            		POP	DE
  EEC7  CDF6E3        		CALL	CAP
  EECA  FE52          		CP	'R'		;Retry
  EECC  CA5BEE        		JP	Z,DISKR
  EECF  FE49          		CP	'I'		;Ignore
  EED1  2807          		JR	Z,IGNORE
  EED3  FE41          		CP	'A'		;Abort
  EED5  20E0          		JR	NZ,DELP1
  EED7  C300EF        		JP	CPM_BOOT
  EEDA                	IGNORE:
  EEDA  3EFF          		LD	A,0FFH
  EEDC                	ERR:
  EEDC  BF            		CP	A
  EEDD  37            		SCF
  EEDE  C9            		RET
                      	
                      				;X1turbo DISK DMA
  EEDF  C3            	DMAD:	DB	0C3H	;WR6 リセット
  EEE0  7D            		DB	07DH	;WR0 ポートA→ポートB 転送
  EEE1  FB0F          		DW	00FFBH	;ポートA開始アドレス FDC データレジスタ
  EEE3  FFFF          		DW	0FFFFH	;ブロック長(転送サイズ-1)
  EEE5  2C            		DB	02CH	;WR1 ポートAアドレス固定 I/O
  EEE6  10            		DB	010H	;WR2 ポートBインクリメント
  EEE7  80            		DB	080H	;WR3
  EEE8  92            		DB	092H	;WR5 WAIT RDY:LOW
  EEE9  8D            		DB	08DH	;WR4 バイト ポートB開始アドレス(LH)
  EEEA  0000          	DMAHL:	DW	0	;ポートB開始アドレス
  EEEC  CF            		DB	0CFH	;WR6 ロード
  EEED  01            		DB	001H	;WR0 ポートB←ポートB 転送
  EEEE  CF            		DB	0CFH	;WR6 ロード
                      	
  EEEF                	DMAE:
                      	
  1E98                	AT_R	EQU	WTTRK-AT_WTTRK
                      	
                      	;LDWORK.ASM
                      	
                      	;	LSX-Dodgers WORK0
                      	;
                      	;	CP/M互換BIOS
                      	;	BOOT:アドレス下位1バイトが0になるように
  EEEF                	AT_WORK:
  EEEF                		DS	WORKAD-AT_WORK
                      	
  EF00                	CPM_BOOT:
  EF00  C30000        		JP	0
  EF03                	_SYS00:		;(BDOS)プログラム終了
  EF03                	CPM_WBOOT:
  EF03  C309D1        		JP	WBOOT1
  EF06                	CPM_CONST:
  EF06  C3A6DC        		JP	CONSTX
  EF09                	_SYS07:		;(BDOS)コンソール直接入力
  EF09                	CPM_CONIN:
  EF09  C34DDC        		JP	FLGET
  EF0C                	CPM_CONOUT:
  EF0C  C3E7DE        		JP	CONOUT1
                      	
  EF0F                	DECBF:
  EF0F                		DS	5
  EF14  00            	FDRV	DB	0
  EF15                	FNAME	DS	36
  EF39                	SFILE:	DS	33		;DRV FILENAME
  EF5A                	HLBUF:	DS	3		;Random record buffer
                      	
  EF5D  0000          	LEFTX:	DW	0
  EF5F  0000          	DTAX:	DW	0
                      	
  EF61  008E01000B000C	BEEPD:	DB	0,08EH,1,0,00BH,0,00CH,010H
  EF69  073E08100D00FF		DB	007H,03EH,008H,010H,00DH,0,0FFH
                      	
  EF70  00            	CHECK:	DB	0
                      	
  EF71  4F4B24        	OK:	DB	"OK$"
  EF74  536B697024    	SKIP:	DB	"Skip$"
  EF79  4572726F722124	COMERM:	DB	"Error!$"
                      	;	システムワークエリア
                      	;	_CYL0:アドレス下位1バイトが080Hになるように
  EF80  FF            	_CYL0:	DB	0FFH	;Cylinder
  EF81  FF            	_CYL1:	DB	0FFH	;Cylinder
  EF82  FF            	_CYL2:	DB	0FFH	;Cylinder
  EF83  FF            	_CYL3:	DB	0FFH	;Cylinder
  EF84  00            	_DRIVE:	DB	0	;unit number
  EF85  00            	_SEEKSP:DB	0	;Seek speed
  EF86  FF            	_ISEEK:	DB	0FFH	;
  EF87  00            	_DVSW:	DB	0
  EF88  00            	_DRV:	DB	0
  EF89  FF            	_DSK:	DB	0FFH
  EF8A  8000          	_DTA:	DW	00080H
  EF8C  0000          	_CTC:	DW	0
  EF8E  0000          	_TXADR:	DW	0
  EF90  0000          	_KEYPS:	DW	0
  EF92  00FF          	_KEYD:	DW	0FF00H	;キーデータ
  EF94  C210          	_KEYSP:	DW	010C2H
  EF96  07            	_COLORF:DB	COLORF	;色
  EF97  18            	_LINE:	DB	LINE
                      	
  EF98  0000          	_FCB:	DW	0
  EF9A  0000          	_FBPS:	DW	0	;SEARCH FILES
  EF9C  0000          	_FBAD:	DW	0	;    //
  EF9E  00            	_FBCNT:	DB	0	;    //
  EF9F  00            	_FILEN:	DB	0
  EFA0  00            	_DIRF:	DB	0	;bit7:ディレクトリ bit0-6:セクタインデックス
  EFA1  00            	_MAXCYL:DB	0
  EFA2  00            	_WTFATF:DB	0	;FATバッファの更新フラグ
  EFA3                			DS	1
  EFA4  00            	_WTDBF:	DB	0	;データバッファの更新フラグ
  EFA5  FF            	_DBDRV:	DB	0FFH	;データバッファにあるデータを読み込んだドライブ
  EFA6  0000          	_DBSEC:	DW	0	;データバッファにあるデータを読み込んだセクタ番号
  EFA8  0000          	_DPB:	DW	0
  EFAA                	_FATDRV:
  EFAA  FF            		DB	0FFH	;FATバッファに読み込んでいるドライブ
  EFAB  00            	_FATIX:	DB	0	;FATバッファに読み込んでいるインデックス
  EFAC                	_FAKEFREE:
  EFAC  0000          		DW	0	;偽の残量（FATサイズが大きくなると重くなるのでその対策）
                      	
  EFAE                		DS	2
                      	
  EFB0  6F5059381F0219	CRTCD:	DB	06FH,WIDTH,059H,038H,01FH,002H,019H,01CH
  EFB8  0007          		DB	000H,007H
  EFBA  80F8B0FF      		DW	0-WIDTH*LINE,0-WIDTH
  EFBE  0C            		DB	00CH
  EFBF  20            	WK1FD0:	DB	020H
                      	
  EFC0  55DB          	CTC0:	DW	INTCTCE
  EFC2  55DB          	CTC1:	DW	INTCTCE
  EFC4  77DB          	CTC2:	DW	INTCTC2
  EFC6  55DB          	CTC3:	DW	INTCTCE
  EFC8  3EDB          	INTVEC:	DW	INT
                      	
                      	;	LSX-Dodgers 独自BIOS
                      	
  EFCA  C3CAE0        	_INKEY:	JP	INKEY
  EFCD  C374DD        	_PRINT:	JP	PRINT
  EFD0  C334E0        	_SCRN:	JP	SCRN
  EFD3  C35CE0        	_POS:	JP	POS
  EFD6  C3B0DE        	_LOC:	JP	LOC
  EFD9                	_CHGDRV:
  EFD9  C360EC        		JP	CHGDRV
  EFDC                	_GETDPB:
  EFDC  C334ED        		JP	GETDPB
  EFDF                	_FFLUSH:
  EFDF  C352ED        		JP	FFLUSH
  EFE2                	_RDFATX:
  EFE2  C365E9        		JP	RDFATX
  EFE5  C38DEA        	_RDFAT:	JP	RDFAT
  EFE8  C336EE        	_WTTRK:	JP	WTTRK
  EFEB  C34AEE        	_FDRD:	JP	FDRD
  EFEE  C33CEE        	_FDWT:	JP	FDWT
  EFF1                	_BPB2DPB:
  EFF1  C3F2EA        		JP	BPB2DPB
  EFF4                		DS	3
  EFF7                	_GNCL:
  EFF7  C307EA        	GNCPAT:	JP	GNCL		; self-modifying code
  EFFA                	_SNCL:
  EFFA  C32AEA        	SNCPAT:	JP	SNCL		; self-modifying code
  EFFD  C387D1        	_COMANL:JP	COMANL
                      	
  F000                	_WE:
                      	
                      	;LDCALL.ASM
                      	
                      	;	LSX-Dodgers システムコール(BDOS)
                      	;
                      	;	LSX-Dodgers SYSTEM CALL
                      	;	STABLE:アドレス下位1バイトが0になるように
                      	
  F000                	STABLE:
                      	;0
  F000  03EF20DC2CDC7E		DW	_SYS00,_SYS01,_SYS02,_SYS03
  F008  5DD85DD831DC09		DW	_SYS04,_SYS05,_SYS06,_SYS07
  F010  39DC5FD872DC9E		DW	_SYS08,_SYS09,_SYS0A,_SYS0B
  F018  74D879D888D89B		DW	_SYS0C,_SYS0D,_SYS0E,_SYS0F
                      	;1
  F020  EFD836D97FD9B5		DW	_SYS10,_SYS11,_SYS12,_SYS13
  F028  BDD9DBD9F8D9F0		DW	_SYS14,_SYS15,_SYS16,_SYS17
  F030  59DA5EDA63DA69		DW	_SYS18,_SYS19,_SYS1A,_SYS1B
  F038  5DD88FDA5DD893		DW	_SYS1C,_SYS1D,_SYS1E,_SYS1F
                      	;2
  F040  5DD82FDA44DA9A		DW	_SYS20,_SYS21,_SYS22,_SYS23
  F048  B9DA5DD8BAE69B		DW	_SYS24,_ERROR,_SYS26,_SYS27
  F050  44DAC2DAB4DC7E		DW	_SYS28,_SYS5C,_SYS2A,_SYS2B
  F058  E8DC7EE25DD8E5		DW	_SYS2C,_SYS2D,_SYS2E,_SYS2F
                      	;3
  F060  DFDA5DD85DD85D		DW	_SYS30,_ERROR,_ERROR,_ERROR
  F068  5DD85DD85DD85D		DW	_ERROR,_ERROR,_ERROR,_ERROR
  F070  5DD87EE27EE206		DW	_ERROR,_SYS39,_SYS3A,_SYS5A
                      	;DOS2
  F078  40D8          		DW	_DOS2
                      	
  F07A                		DS	2
  F07C  00F2          	_FATBF:	DW	FATBF
  F07E  00FA          	_DTBUF:	DW	DTBUF
                      	
                      	;	コントロールコードテーブル
                      	;	CTRLTB:アドレス下位1バイトが080Hになるように
                      	
  F080                	CTRLTB:
  F080  25DE25DE61DEA8		DW	CTRL00,CTRL00,CTRL02,CTRL03	;  A,B,C
  F088  A2DF85DE81DF08		DW	CTRL04,CTRL05,CTRL06,CTRL07	;D,E,F,G
  F090  31DE52DEABDFC6		DW	CTRL08,CTRL09,CTRL0A,CTRL0B	;H,I,J,K
  F098  7EDFABDEC0DF25		DW	CTRL0C,CTRL0D,CTRL0E,CTRL00	;L,M,N,O
  F0A0  25DE25DEBEDE25		DW	CTRL00,CTRL00,CTRL12,CTRL00	;P,Q,R,S
  F0A8  25DE25DE25DE25		DW	CTRL00,CTRL00,CTRL00,CTRL00	;T,U,V,W
  F0B0  25DE25DE7EDFCD		DW	CTRL00,CTRL00,CTRL0C,CTRL1B	;X,Y,Z,ESC
  F0B8  4CDE38DE41DEAB		DW	CTRL1C,CTRL1D,CTRL1E,CTRL1F	;→,←,↑,↓
                      	
  F0C0  0307          	DEMES:	DB	3,7
  F0C2  44657669636520		DB	"Device I/O Error",5,3
  F0D4  41626F72742052		DB	"Abort Retry Ignore?",5,3,0
                      	
  F0EA  1617          	SDDATA:	DB	22,23		;(FCB)ファイルを最後に変更した時刻
  F0EC  1415          		DB	20,21		;(FCB)ファイルを最後に変更した日付
  F0EE  1A1B          		DB	26,27		;(FCB)ファイルの先頭クラスタ
  F0F0  10111213      		DB	16,17,18,19	;(FCB)ファイルのサイズ(バイト単位)
  F0F4                	SDDATAE:
                      	
  F0F4                	SCDIR:	DS	2		;+14 +15
  F0F6                	SFBPS:	DS	2		;FBPS
  F0F8                	SFNDF:	DS	2		;FILEN DIRF
                      	
  F0FA  0000          	_FATPS:	DW	0
  F0FC  0000          	_DIRPS:	DW	0
  F0FE  0000          	_CLPS:	DW	0
                      	
  F100                	_PE:
                      	
                      	;X1DPB.ASM
                      	
                      	;	LSX-Dodgers DPB
                      	;	X1/turbo/Z
                      	
  F100                	DEVICE:
                      	
                      	;	A:
                      	
  F100  0200          		DW	2	;DPB_00_FATLN
  F102  EBEF          		DW	_FDRD	;DPB_02_DRD
  F104  EEEF          		DW	_FDWT	;DPB_04_DWT
  F106  FD            		DB	0FDH	;DPB_06_FATID
  F107  02            		DB	2	;DPB_07_SECPCL
  F108  6401          		DW	356	;DPB_08_MAXCL
  F10A  FF            		DB	0FFH	;DPB_0A_FDMODE	0FFH=2D / 0FEH=2HD
  F10B  07            		DB	7	;DPB_0B_DIRSCNT
  F10C  28            		DB	40	;DPB_0C_MAXCYL
  F10D  09            		DB	9	;DPB_0D_MAXSEC	Number of sectors
  F10E  01            		DB	1	;DPB_0E_FATPS
  F10F  82            		DB	082H	;DPB_0F_BPS
  F110  0500          		DW	5	;DPB_10_DIRPS
  F112  A7            		DB	0A7H	;DPB_12_DEVICE	Device Number
  F113  00            		DB	0	;DPB_13_UNITNO
  F114  0800          		DW	8	;DPB_14_ADDCL16
  F116  0000          		DW	0	;DPB_16
  F118  0000          		DW	0	;DPB_18
  F11A  0000          		DW	0	;DPB_1A_SDIR
  F11C  46444430      		DB	"FDD0"	;DPB_1C_NAME
                      	
                      	;	B:
                      	
  F120  0200          		DW	2	;DPB_00_FATLN
  F122  EBEF          		DW	_FDRD	;DPB_02_DRD
  F124  EEEF          		DW	_FDWT	;DPB_04_DWT
  F126  FD            		DB	0FDH	;DPB_06_FATID
  F127  02            		DB	2	;DPB_07_SECPCL
  F128  6401          		DW	356	;DPB_08_MAXCL
  F12A  FF            		DB	0FFH	;DPB_0A_FDMODE	0FFH=2D / 0FEH=2HD
  F12B  07            		DB	7	;DPB_0B_DIRSCNT
  F12C  28            		DB	40	;DPB_0C_MAXCYL
  F12D  09            		DB	9	;DPB_0D_MAXSEC	Number of sectors
  F12E  01            		DB	1	;DPB_0E_FATPS
  F12F  82            		DB	082H	;DPB_0F_BPS
  F130  0500          		DW	5	;DPB_10_DIRPS
  F132  A7            		DB	0A7H	;DPB_12_DEVICE	Device Number
  F133  01            		DB	1	;DPB_13_UNITNO
  F134  0800          		DW	8	;DPB_14_ADDCL16
  F136  0000          		DW	0	;DPB_16
  F138  0000          		DW	0	;DPB_18
  F13A  0000          		DW	0	;DPB_1A_SDIR
  F13C  46444431      		DB	"FDD1"	;DPB_1C_NAME
                      	
                      	;	C:
                      	
  F140  0200          		DW	2	;DPB_00_FATLN
  F142  EBEF          		DW	_FDRD	;DPB_02_DRD
  F144  EEEF          		DW	_FDWT	;DPB_04_DWT
  F146  FD            		DB	0FDH	;DPB_06_FATID
  F147  02            		DB	2	;DPB_07_SECPCL
  F148  6401          		DW	356	;DPB_08_MAXCL
  F14A  FF            		DB	0FFH	;DPB_0A_FDMODE	0FFH=2D / 0FEH=2HD
  F14B  07            		DB	7	;DPB_0B_DIRSCNT
  F14C  28            		DB	40	;DPB_0C_MAXCYL
  F14D  09            		DB	9	;DPB_0D_MAXSEC	Number of sectors
  F14E  01            		DB	1	;DPB_0E_FATPS
  F14F  82            		DB	082H	;DPB_0F_BPS
  F150  0500          		DW	5	;DPB_10_DIRPS
  F152  A7            		DB	0A7H	;DPB_12_DEVICE	Device Number
  F153  02            		DB	2	;DPB_13_UNITNO
  F154  0800          		DW	8	;DPB_14_ADDCL16
  F156  0000          		DW	0	;DPB_16
  F158  0000          		DW	0	;DPB_18
  F15A  0000          		DW	0	;DPB_1A_SDIR
  F15C  46444432      		DB	"FDD2"	;DPB_1C_NAME
                      	
                      	;	D:
                      	
  F160  0200          		DW	2	;DPB_00_FATLN
  F162  EBEF          		DW	_FDRD	;DPB_02_DRD
  F164  EEEF          		DW	_FDWT	;DPB_04_DWT
  F166  FD            		DB	0FDH	;DPB_06_FATID
  F167  02            		DB	2	;DPB_07_SECPCL
  F168  6401          		DW	356	;DPB_08_MAXCL
  F16A  FF            		DB	0FFH	;DPB_0A_FDMODE	0FFH=2D / 0FEH=2HD
  F16B  07            		DB	7	;DPB_0B_DIRSCNT
  F16C  28            		DB	40	;DPB_0C_MAXCYL
  F16D  09            		DB	9	;DPB_0D_MAXSEC	Number of sectors
  F16E  01            		DB	1	;DPB_0E_FATPS
  F16F  82            		DB	082H	;DPB_0F_BPS
  F170  0500          		DW	5	;DPB_10_DIRPS
  F172  A7            		DB	0A7H	;DPB_12_DEVICE
  F173  03            		DB	3	;DPB_13_UNITNO
  F174  0800          		DW	8	;DPB_14_ADDCL16
  F176  0000          		DW	0	;DPB_16
  F178  0000          		DW	0	;DPB_18
  F17A  0000          		DW	0	;DPB_1A_SDIR
  F17C  46444433      		DB	"FDD3"	;DPB_1C_NAME
                      	
                      	;	E:
                      	
  F180  0000          	EMMFL:	DW	0	;DPB_00_FATLN
  F182  D0D7          	EMMRD:	DW	EDRD	;DPB_02_DRD
  F184  CCD7          	EMMWR:	DW	EDWT	;DPB_04_DWT
  F186  FE            		DB	0FEH	;DPB_06_FATID
  F187  02            		DB	2	;DPB_07_SECPCL
  F188  0000          	EMMCL:	DW	0	;DPB_08_MAXCL
  F18A  00            		DB	0	;DPB_0A_FDMODE
  F18B  0C            		DB	12	;DPB_0B_DIRSCNT
  F18C  00            		DB	0	;DPB_0C_MAXCYL
  F18D  00            		DB	0	;DPB_0D_MAXSEC
  F18E  02            		DB	2	;DPB_0E_FATPS
  F18F  02            		DB	2	;DPB_0F_BPS
  F190  0A00          		DW	10	;DPB_10_DIRPS
  F192  06            		DB	6	;DPB_12_DEVICE
  F193  00            		DB	0	;DPB_13_UNITNO
  F194  1200          		DW	18	;DPB_14_ADDCL16
  F196  0000          		DW	0	;DPB_16
  F198  0000          		DW	0	;DPB_18
  F19A  0000          		DW	0	;DPB_1A_SDIR
  F19C  454D4D30      		DB	"EMM0"	;DPB_1C_NAME
                      	
                      	;	F:
                      	
  F1A0  0000          	BANKFL:	DW	0	;DPB_00_FATLN
  F1A2  67D7          		DW	BDRD	;DPB_02_DRD
  F1A4  63D7          		DW	BDWT	;DPB_04_DWT
  F1A6  F9            		DB	0F9H	;DPB_06_FATID
  F1A7  02            		DB	2	;DPB_07_SECPCL
  F1A8  0000          	BANKCL:	DW	0	;DPB_08_MAXCL
  F1AA  00            		DB	0	;DPB_0A_FDMODE
  F1AB  08            		DB	8	;DPB_0B_DIRSCNT
  F1AC  00            		DB	0	;DPB_0C_MAXCYL
  F1AD  01            		DB	1	;DPB_0D_MAXSEC
  F1AE  00            		DB	0	;DPB_0E_FATPS
  F1AF  02            		DB	2	;DPB_0F_BPS
  F1B0  0200          		DW	2	;DPB_10_DIRPS
  F1B2  0B            		DB	00BH	;DPB_12_DEVICE
  F1B3  00            		DB	0	;DPB_13_UNITNO
  F1B4  0600          		DW	6	;DPB_14_ADDCL16
  F1B6  0000          		DW	0	;DPB_16
  F1B8  0000          		DW	0	;DPB_18
  F1BA  0000          		DW	0	;DPB_1A_SDIR
  F1BC  4252414D      		DB	"BRAM"	;DPB_1C_NAME
                      	
                      	;	G:
                      	
  F1C0  0100          		DW	1	;DPB_00_FATLN
  F1C2  24D7          		DW	GDRD	;DPB_02_DRD
  F1C4  3BD7          		DW	GDWT	;DPB_04_DWT
  F1C6  F9            		DB	0F9H	;DPB_06_FATID
  F1C7  04            		DB	4	;DPB_07_SECPCL
  F1C8  3000          		DW	48	;DPB_08_MAXCL
  F1CA  00            		DB	0	;DPB_0A_FDMODE
  F1CB  04            		DB	4	;DPB_0B_DIRSCNT
  F1CC  00            		DB	0	;DPB_0C_MAXCYL
  F1CD  01            		DB	1	;DPB_0D_MAXSEC
  F1CE  00            		DB	0	;DPB_0E_FATPS
  F1CF  01            		DB	1	;DPB_0F_BPS
  F1D0  0400          		DW	4	;DPB_10_DIRPS
  F1D2  05            		DB	5	;DPB_12_DEVICE
  F1D3  01            		DB	1	;DPB_13_UNITNO
  F1D4  0000          		DW	0	;DPB_14_ADDCL16
  F1D6  0000          		DW	0	;DPB_16
  F1D8  0000          		DW	0	;DPB_18
  F1DA  0000          		DW	0	;DPB_1A_SDIR
  F1DC  4752414D      		DB	"GRAM"	;DPB_1C_NAME
                      	
                      	;	H:
  F1E0                		DS	31
  F1FF  00            		DB	0
                      	
                      	
  F200                	LAST_ADR:
                      	
  F200                		END
