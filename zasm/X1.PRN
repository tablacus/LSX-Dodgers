			  Z80 ASSEMBLER - ZASM VER 1.6
                      	;	LSX-Dodgers for X1/turbo/Z
                      	;	Programmed by
                      	;	Gaku (Lovers/Tablacus)
                      	;X1DEF.ASM
                      	
                      	;	LSX-Dodgers DEF
                      	;	X1/turbo/Z
                      	
  0000                	MAC	EQU	0		;X1
  0000                	DEV EQU 0
                      	
  CC00                	RUN	EQU	0CC00H
  D206                	BDOS	EQU	0D206H
  F000                	WORKAD	EQU	0F000H
  F300                	FATBF	EQU	0F300H
  FB00                	DTBUF	EQU	0FB00H
  FF00                	KEYBF	EQU	0FF00H
  FF20                	KBUF	EQU	0FF20H
  FFCA                	EXTSP	EQU	0FFCAH
  FFD9                	TRAP38	EQU	0FFD9H
  0050                	WIDTH	EQU	80
  0018                	LINE	EQU	24
  0007                	COLORF	EQU	7
  0010                	KEYSP_H	EQU	16
  00C2                	KEYSP_L	EQU	0C2H
  0009                	COMS	EQU	9
                      	
                      	
                      	;LDDEF.ASM
                      	
                      	;	LSX-Dodgers DEF
                      	
  0001                	VER_1   EQU	1
  0005                	VER_2   EQU	5
  0006                	VER_3   EQU	6
  1D00                	MACW	EQU	MAC + 01D00H	;機種フラグとLD判別フラグ
  0000                	MACD	EQU	MAC + DEV * 256	;機種フラグとデバイスフラグ
  0156                	VER	EQU	VER_1 * 256 + VER_2 * 16 + VER_3
                      	
  0005                	SYSTEM	EQU	00005H
  000F                	JP_HL	EQU	0000FH
  005C                	FCB1	EQU	0005CH
  006C                	FCB2	EQU	0006CH
  005D                	FCB1FN	EQU	FCB1+1
  006D                	FCB2FN	EQU	FCB2+1
  0080                	DTA1	EQU	00080H
                      	
  FFCA                	EXTBIO	EQU	0FFCAH
                      	
                      	
                      	
  CBF9                		ORG	RUN-7
                      	
                      	;	MSX BINARY HEADER
  CBF9  FE            		DB	0FEH
                      	;	MSX BINARY START ADDRESS
  CBFA  00CC          		DW	RUN
                      	;	MSX BINARY END ADDRESS
  CBFC  F9F2          		DW	LAST_ADR
                      	;	MSX BINARY EXEC ADDRESS
  CBFE  07CC          		DW	START
                      	;X1INIT.ASM
                      	
                      	;	LSX-Dodgers INIT
                      	;	X1/turbo/Z
                      	
  CC00  C307CC        		JP	START
  CC03  001D          		DW	MACW
  CC05  5601          		DW	VER
                      	
  CC07                	START:
  CC07  F3            		DI
  CC08  ED5E          		IM	2
  CC0A  31CAFF        		LD	SP,EXTSP
  CC0D  CD1BCC        		CALL	INIT		;NZならAUTOEXECを実行
  CC10  210000        		LD	HL,0
  CC13  E5            		PUSH	HL
  CC14  C8            		RET	Z
  CC15  1199CF        		LD	DE,AUTOD
  CC18  C3FDF0        		JP	_COMANL
                      	
  CC1B                	INIT:
  CC1B  3E1E          		LD	A,01EH
  CC1D  D300          		OUT	(0),A
                      	
  CC1F  010000        		LD	BC,0
  CC22  ED438CF0      		LD	(_CTC),BC
  CC26  01040A        		LD	BC,00A04H
  CC29  CD43CF        		CALL	CHKCTC
  CC2C  010407        		LD	BC,00704H
  CC2F  CD43CF        		CALL	CHKCTC
  CC32  01A81F        		LD	BC,01FA8H
  CC35  CD43CF        		CALL	CHKCTC
  CC38  01A01F        		LD	BC,01FA0H
  CC3B  CD43CF        		CALL	CHKCTC
                      	;
  CC3E                	INISIO:
  CC3E  01911F        		LD	BC,01F91H	;INIT SIO
  CC41  1601          		LD	D,1
  CC43  ED51          		OUT	(C),D
                      	
  CC45  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  CC47  0E93          		LD	C,093H
  CC49  ED51          		OUT	(C),D
  CC4B  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  CC4D  0E99          		LD	C,099H		;INIT SIO
  CC4F  1601          		LD	D,1
  CC51  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  CC53  0E9B          		LD	C,09BH
  CC55  ED51          		OUT	(C),D
  CC57  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
                      	
  CC59  0E80          		LD	C,080H		;INIT DMA
  CC5B  2106C3        		LD	HL,0C306H
  CC5E                	INIDMA:
  CC5E  ED61          		OUT	(C),H
  CC60  2D            		DEC	L
  CC61  20FB          		JR	NZ,INIDMA
                      	
  CC63  3EE4          		LD	A,0E4H
  CC65  CDDBDE        		CALL	COMOUT
  CC68  AF            		XOR	A
  CC69  CDB5DE        		CALL	OT49SB
                      	
  CC6C  3EF0          		LD	A,INTVEC/256
  CC6E  ED47          		LD	I,A
                      	
  CC70  ED4B8CF0      		LD	BC,(_CTC)
  CC74  0D            		DEC	C
  CC75  0D            		DEC	C
                      	
  CC76  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  CC78  3EC0          		LD	A,CTC0
  CC7A  ED79          		OUT	(C),A
                      	
  CC7C  0C            		INC	C
  CC7D  3E47          		LD	A,047H
  CC7F  ED79          		OUT	(C),A
  CC81  3E0D          		LD	A,13		;Baudrate 9600-13
  CC83  ED79          		OUT	(C),A
                      	
  CC85  79            		LD	A,C
  CC86  D610          		SUB	010H
  CC88  4F            		LD	C,A
                      	;	LD	(SIOAD+1),BC
                      	;	LD	(SIOAD0+1),BC
                      	;	LD	(SIOAD1+1),BC
                      	
  CC89  21E9CF        		LD	HL,SIODATA
  CC8C                	SINIT1:
  CC8C  7E            		LD	A,(HL)
  CC8D  23            		INC	HL
  CC8E  FEFF          		CP	0FFH
  CC90  2804          		JR	Z,SINIT2
  CC92  ED79          		OUT	(C),A
  CC94  18F6          		JR	SINIT1
  CC96                	SINIT2:
  CC96  3EE4          		LD	A,0E4H
  CC98  CDDBDE        		CALL	COMOUT
  CC9B  3EC8          		LD	A,INTVEC
  CC9D  CDB5DE        		CALL	OT49SB
                      	;
  CCA0  01C41F        		LD	BC,01FC4H
  CCA3  3E0C          		LD	A,00CH
  CCA5  ED79          		OUT	(C),A
                      	
  CCA7  0EC0          		LD	C,0C0H
  CCA9  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
                      	
  CCAB  0C            		INC	C
  CCAC  3E28          		LD	A,40
  CCAE  ED79          		OUT	(C),A
                      	
  CCB0  0C            		INC	C
  CCB1  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
                      	
  CCB3  0C            		INC	C
  CCB4  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
                      	
  CCB6  0EC5          		LD	C,0C5H
  CCB8  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
                      	
  CCBA                	TEXT:
  CCBA  0EB0          		LD	C,0B0H
  CCBC  3E80          		LD	A,080H
  CCBE  ED79          		OUT	(C),A
  CCC0  1607          		LD	D,7
  CCC2  0EB9          		LD	C,0B9H
  CCC4  21E2CF        		LD	HL,TEXTDT
  CCC7                	TEXT1:
  CCC7  04            		INC	B
  CCC8  EDA3          		OUTI
  CCCA  0C            		INC	C
  CCCB  15            		DEC	D
  CCCC  20F9          		JR	NZ,TEXT1
  CCCE  01B01F        		LD	BC,01FB0H
  CCD1  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
                      	
  CCD3  0EC4          		LD	C,0C4H
  CCD5  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
                      	
  CCD7  01011A        		LD	BC,01A01H
  CCDA  ED78          		IN	A,(C)
  CCDC  E608          		AND	8
  CCDE  2809          		JR	Z,PRN
  CCE0  0E03          		LD	C,003H
  CCE2  3E0F          		LD	A,00FH
  CCE4  ED79          		OUT	(C),A
  CCE6  01040A        		LD	BC,00A04H
  CCE9                	PRN:
  CCE9  210000        		LD	HL,0
  CCEC  065C          		LD	B,05CH
  CCEE  3EFF          		LD	A,0FFH		;RST 38H
  CCF0  CD35E1        		CALL	FILL_MEMORY
  CCF3  06A4          		LD	B,0A4H
  CCF5  AF            		XOR	A
  CCF6  CD35E1        		CALL	FILL_MEMORY
                      	
  CCF9  3EC3          		LD	A,0C3H		;JP
  CCFB  2103F0        		LD	HL,CPM_WBOOT
  CCFE  320000        		LD	(00000H),A
  CD01  220100        		LD	(00001H),HL	;IPL
                      	
  CD04  21001D        		LD	HL,MACW	;3 bit7  DPB Compatible LA(1)
  CD07  220300        		LD	(00003H),HL	;  bit6-0 Machine X1(0)
                      	;				;4 LSX-Dodgers(01DH)
  CD0A  2106D2        		LD	HL,BDOS
  CD0D  320500        		LD	(00005H),A
  CD10  220600        		LD	(00006H),HL	;BDOS
                      	
  CD13  21F5DA        		LD	HL,BIOS
  CD16  221900        		LD	(00019H),HL	;BIOS-ROM
                      	
  CD19  21D9FF        		LD	HL,TRAP38	;TRAP38
  CD1C  323800        		LD	(00038H),A
  CD1F  223900        		LD	(00039H),HL	;RST 038H
                      	
  CD22  3EF0          		LD	A,CPM_BOOT/256
  CD24  320B00        		LD	(0000BH),A
                      	
  CD27  3EE9          		LD	A,0E9H		;JP (HL)
  CD29  320F00        		LD	(0000FH),A
                      	
  CD2C  3EE6          		LD	A,0E6H
  CD2E  CDDBDE        		CALL	COMOUT
  CD31  CDC0DE        		CALL	IN49SB
  CD34  F5            		PUSH	AF
  CD35  CDC0DE        		CALL	IN49SB
  CD38  F1            		POP	AF
  CD39  F5            		PUSH	AF
  CD3A  E612          		AND	012H
  CD3C  2005          		JR	NZ,KEYR
  CD3E  3E01          		LD	A,1
  CD40  3296CE        		LD	(KEYREP+1),A
  CD43                	KEYR:
  CD43  F1            		POP	AF
  CD44  E603          		AND	3
  CD46  280E          		JR	Z,NON
                      	
  CD48  01D03F        		LD	BC,03FD0H
  CD4B  ED49          		OUT	(C),C
  CD4D  3E37          		LD	A,037H
  CD4F  D3D0          		OUT	(0D0H),A
  CD51  ED78          		IN	A,(C)
  CD53  B9            		CP	C
  CD54  2865          		JR	Z,TURBO
  CD56                	NON:
  CD56  211CD0        		LD	HL,AT_SCR1
  CD59  1165DF        		LD	DE,SCR1
  CD5C  019400        		LD	BC,SCRNE-SCR1	;転送先のサイズ確認用
  CD5F  018500        		LD	BC,AT_SCRE-AT_SCR1
  CD62  EDB0          		LDIR
                      	
  CD64  21A1D0        		LD	HL,AT_DWT
  CD67  11BDEE        		LD	DE,WTTRK
  CD6A  018F00        		LD	BC,DMAE-WTTRK	;転送先のサイズ確認用
  CD6D  018E00        		LD	BC,AT_CPUE-AT_DWT
  CD70  EDB0          		LDIR
                      	
  CD72  212FD1        		LD	HL,AT_EDWT
  CD75  11E4D7        		LD	DE,EDWT
  CD78  014B00        		LD	BC,EMME-EDWT	;転送先のサイズ確認用
  CD7B  014600        		LD	BC,AT_EMME-AT_EDWT
  CD7E  EDB0          		LDIR
                      	
  CD80  21E0DF        		LD	HL,AT_WTTRK+AT_RS
  CD83  22E9F0        		LD	(_WTTRK+1),HL
  CD86  2106EF        		LD	HL,AT_DRD+AT_R
  CD89  22ECF0        		LD	(_FDRD+1),HL
  CD8C  21BDEE        		LD	HL,AT_DWT+AT_R
  CD8F  22EFF0        		LD	(_FDWT+1),HL
  CD92  21F8D7        		LD	HL,AT_EDRD+AT_RE
  CD95  2282F2        		LD	(EMMRD),HL
  CD98  21E4D7        		LD	HL,AT_EDWT+AT_RE
  CD9B  2284F2        		LD	(EMMWR),HL
  CD9E  21E7DF        		LD	HL,AT_SCRN+AT_RS
  CDA1  22D1F0        		LD	(_SCRN+1),HL
                      	
  CDA4  3E27          		LD	A,027H			;ノンターボはMFM切り替えを行わない
  CDA6  3212F2        		LD	(DEVICE+012H),A		;Aドライブ
  CDA9  3232F2        		LD	(DEVICE+012H+32),A	;Bドライブ
  CDAC  3252F2        		LD	(DEVICE+012H+32*2),A	;Cドライブ
  CDAF  3272F2        		LD	(DEVICE+012H+32*3),A	;Dドライブ
                      	
  CDB2  210000        		LD	HL,0
  CDB5  2206DF        		LD	(X1PAT),HL
  CDB8  C344CE        		JP	NOBANK
                      	
  CDBB                	TURBO:
  CDBB  F3            		DI			;Check BIOS
  CDBC  061D          		LD	B,01DH
  CDBE  ED79          		OUT	(C),A		;BIOS ON
  CDC0  3A512F        		LD	A,(02F51H)
  CDC3  04            		INC	B		;B=01EH
  CDC4  ED79          		OUT	(C),A		;BIOS OFF
  CDC6  FB            		EI
  CDC7  FEC9          		CP	0C9H
  CDC9  2802          		JR	Z,BIOSOK
  CDCB  1805          		JR	NOBIOS
  CDCD                	BIOSOK:
  CDCD  3EC3          		LD	A,0C3H		;JP
  CDCF  321800        		LD	(00018H),A
  CDD2                	NOBIOS:
  CDD2  3E1F          		LD	A,01FH		;スタートポート
  CDD4  DBF0          		IN	A,(0F0H)
  CDD6  0F            		RRCA
  CDD7  380B          		JR	C,CRT1
  CDD9  21D2CF        		LD	HL,_C8025H
  CDDC  11B0F0        		LD	DE,CRTCD
  CDDF  011000        		LD	BC,16
  CDE2  EDB0          		LDIR
  CDE4                	CRT1:
  CDE4  3E1F          		LD	A,01FH		;スタートポート
  CDE6  DBF0          		IN	A,(0F0H)
  CDE8  CB57          		BIT	2,A
  CDEA  2818          		JR	Z,BANK
                      	
  CDEC  AF            		XOR	A
  CDED                	TZ1:				;前面スイッチが2HDの場合はMFMモードを2HDにしておく
  CDED  F5            		PUSH	AF
  CDEE  CDDCF0        		CALL	_GETDPB
  CDF1  DD7E12        		LD	A,(IX+012H)	;DPB_12_DEVICE
  CDF4  E68F          		AND	08FH
  CDF6  FE87          		CP	087H		;フロッピーでMEM切り替えがON
  CDF8  2004          		JR	NZ,TZ2
  CDFA  DDCB0A86      		RES	0,(IX+0AH)	;(DPB_0A_FDMODE)
  CDFE                	TZ2:
  CDFE  F1            		POP	AF
  CDFF  3C            		INC	A
  CE00  FE08          		CP	8
  CE02  38E9          		JR	C,TZ1
                      	
  CE04                	BANK:
  CE04  01000B        		LD	BC,00B00H
  CE07  21007F        		LD	HL,07F00H
  CE0A  F3            		DI
  CE0B  ED69          		OUT	(C),L
  CE0D  3A0000        		LD	A,(0)
  CE10  FEEB          		CP	0EBH
  CE12  2005          		JR	NZ,BANK1
  CE14  3E2B          		LD	A,02BH
  CE16  32B2F2        		LD	(BANKDV),A
  CE19                	BANK1:
  CE19  ED69          		OUT	(C),L
  CE1B  5E            		LD	E,(HL)
  CE1C  7B            		LD	A,E
  CE1D  C6A5          		ADD	A,0A5H
  CE1F  77            		LD	(HL),A
  CE20  BE            		CP	(HL)
  CE21  73            		LD	(HL),E
  CE22  2005          		JR	NZ,BANK2
  CE24  2C            		INC	L
  CE25  CB65          		BIT	4,L
  CE27  28F0          		JR	Z,BANK1
  CE29                	BANK2:
  CE29  3E10          		LD	A,010H
  CE2B  ED79          		OUT	(C),A
  CE2D  7D            		LD	A,L
  CE2E  B7            		OR	A
  CE2F  2813          		JR	Z,NOBANK
  CE31  2600          		LD	H,0
  CE33  29            		ADD	HL,HL	;*2
  CE34  29            		ADD	HL,HL	;*4
  CE35  29            		ADD	HL,HL	;*8
  CE36  29            		ADD	HL,HL	;*16
  CE37  29            		ADD	HL,HL	;*32
  CE38  2B            		DEC	HL	;-1
  CE39  2B            		DEC	HL	;-2
  CE3A  2B            		DEC	HL	;-3
  CE3B  22A8F2        		LD	(BANKCL),HL
  CE3E  CD89CF        		CALL	CALC_FATLN
  CE41  32A0F2        		LD	(BANKFL),A
  CE44                	NOBANK:
  CE44                	EMM:
  CE44  DD2180F2      		LD	IX,EMMFL
  CE48  CD3ACF        		CALL	EADR0
  CE4B  ED78          		IN	A,(C)
  CE4D  F5            		PUSH	AF
                      	
  CE4E  110000        		LD	DE,0
  CE51                	ECHECK1:
  CE51  13            		INC	DE
  CE52  CD1ECF        		CALL	EADR2
  CE55  ED60          		IN	H,(C)
  CE57  CD1ECF        		CALL	EADR2
  CE5A  7C            		LD	A,H
  CE5B  C6E5          		ADD	A,0E5H
  CE5D  ED79          		OUT	(C),A
  CE5F  3C            		INC	A
  CE60  CD3ACF        		CALL	EADR0
  CE63  ED79          		OUT	(C),A
  CE65  3D            		DEC	A
  CE66  CD1ECF        		CALL	EADR2
  CE69  ED68          		IN	L,(C)
  CE6B  CD1ECF        		CALL	EADR2
  CE6E  ED61          		OUT	(C),H
  CE70  BD            		CP	L
  CE71  2004          		JR	NZ,ECHECK2
  CE73  CB5A          		BIT	3,D
  CE75  28DA          		JR	Z,ECHECK1
  CE77                	ECHECK2:
  CE77  CD3ACF        		CALL	EADR0
  CE7A  F1            		POP	AF
  CE7B  ED79          		OUT	(C),A
  CE7D  FEEB          		CP	0EBH
  CE7F  2005          		JR	NZ,EMM_BPB
  CE81  3E26          		LD	A,026H
  CE83  3292F2        		LD	(EMMDV),A
  CE86                	EMM_BPB:
  CE86  21F7FF        		LD	HL,0-9
  CE89  19            		ADD	HL,DE
  CE8A  3009          		JR	NC,NOEMM
  CE8C  2288F2        		LD	(EMMCL),HL
  CE8F  CD89CF        		CALL	CALC_FATLN
  CE92  3280F2        		LD	(EMMFL),A
  CE95                	NOEMM:
  CE95  3E00          	KEYREP:	LD	A,000H
  CE97  B7            		OR	A
  CE98  2807          		JR	Z,KEYR1
  CE9A  010000        		LD	BC,0
  CE9D  ED438CF0      		LD	(_CTC),BC
  CEA1                	KEYR1:
  CEA1  CD6ACF        		CALL	SETCRTC
  CEA4  0130F8        		LD	BC,0-80*25
  CEA7  2ABAF0        		LD	HL,(_PAGE_MINUS)
  CEAA  ED43BAF0      		LD	(_PAGE_MINUS),BC
  CEAE  1E0C          		LD	E,00CH
  CEB0  CDCDF0        		CALL	_PRINT
  CEB3  22BAF0        		LD	(_PAGE_MINUS),HL
                      	
  CEB6  21A5CF        		LD	HL,INIMES
  CEB9  CD70D8        		CALL	MSX
                      	
  CEBC  3A87FF        		LD	A,(0FF87H)
  CEBF  FE08          		CP	8
  CEC1  301E          		JR	NC,INIT0
  CEC3  5F            		LD	E,A
  CEC4  C641          		ADD	A,'A'
  CEC6  32A2CF        		LD	(AUTODV),A
  CEC9  0E0E          		LD	C,00EH
  CECB  CD0500        		CALL	SYSTEM
  CECE  1C            		INC	E
  CECF  2185F0        		LD	HL,_SEEKSP	;Disk error Ignore
  CED2  CBFE          		SET	7,(HL)
  CED4  0E1B          		LD	C,01BH
  CED6  CD0500        		CALL	SYSTEM
                      	
  CED9  2185F0        		LD	HL,_SEEKSP
  CEDC  CBBE          		RES	7,(HL)
                      	
  CEDE  3C            		INC	A
  CEDF  2008          		JR	NZ,INIT1
  CEE1                	INIT0:
  CEE1  1E00          		LD	E,0
  CEE3  0E0E          		LD	C,00EH
  CEE5  CD0500        		CALL	SYSTEM
  CEE8  AF            		XOR	A
  CEE9                	INIT1:
  CEE9  F3            		DI
  CEEA  08            		EX	AF,AF'
  CEEB  2EFE          		LD	L,0-2		;CALLのスタック分減らす
  CEED  39            		ADD	HL,SP
  CEEE  1100FF        		LD	DE,0FF00H
  CEF1  45            		LD	B,L
  CEF2  CDD3D5        		CALL	ZERO_MEMORY_DE
  CEF5  21CAFF        		LD	HL,EXTBIO
  CEF8  36C9          		LD	(HL),0C9H	;RET
  CEFA  23            		INC	HL
  CEFB  060E          		LD	B,TRAP38-EXTBIO-1
  CEFD  3EFF          		LD	A,0FFH		;RST 38H
  CEFF  CD35E1        		CALL	FILL_MEMORY
  CF02  21F5CF        		LD	HL,AT_TRAP38
  CF05  11D9FF        		LD	DE,TRAP38
  CF08  012700        		LD	BC,AT_TRAPE-AT_TRAP38
  CF0B  EDB0          		LDIR
  CF0D  08            		EX	AF,AF'
  CF0E  B7            		OR	A
  CF0F  C8            		RET	Z
                      	
  CF10  3EE6          		LD	A,0E6H
  CF12  CDDBDE        		CALL	COMOUT
  CF15  CDC0DE        		CALL	IN49SB
  CF18  CDC0DE        		CALL	IN49SB
  CF1B  FE1B          		CP	01BH
  CF1D  C9            		RET
                      	
  CF1E                	EADR2:
  CF1E  D5            		PUSH	DE
  CF1F  EB            		EX	DE,HL
  CF20  29            		ADD	HL,HL
  CF21  29            		ADD	HL,HL
  CF22  DD4E0D        		LD	C,(IX+00DH)	;DPB_0D_MAXSEC
  CF25  DD460C        		LD	B,(IX+00CH)	;DPB_0C_MAXCYL
  CF28  09            		ADD	HL,BC
  CF29  DD4E13        		LD	C,(IX+013H)	;DPB_13_UNITNO
  CF2C  060D          		LD	B,00DH
  CF2E  ED49          		OUT	(C),C
  CF30  0C            		INC	C
  CF31  ED69          		OUT	(C),L
  CF33  0C            		INC	C
  CF34  ED61          		OUT	(C),H
  CF36  0C            		INC	C
  CF37  EB            		EX	DE,HL
  CF38  D1            		POP	DE
  CF39  C9            		RET
                      	
  CF3A                	EADR0:
  CF3A  D5            		PUSH	DE
  CF3B  110000        		LD	DE,0
  CF3E  CD1ECF        		CALL	EADR2
  CF41  D1            		POP	DE
  CF42  C9            		RET
                      	
  CF43                	CHKCTC:
  CF43  C5            		PUSH	BC
  CF44  110347        		LD	DE,04703H
  CF47                	INICTC1:
  CF47  0C            		INC	C
  CF48  ED51          		OUT	(C),D
  CF4A  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  CF4C  1D            		DEC	E
  CF4D  20F8          		JR	NZ,INICTC1
  CF4F  C1            		POP	BC
                      	
  CF50  11FA07        		LD	DE,007FAH
  CF53  ED51          		OUT	(C),D
  CF55  ED59          		OUT	(C),E
  CF57  ED78          		IN	A,(C)
  CF59  BB            		CP	E
  CF5A  C0            		RET	NZ
  CF5B  ED51          		OUT	(C),D
  CF5D  ED51          		OUT	(C),D
  CF5F  ED78          		IN	A,(C)
  CF61  BA            		CP	D
  CF62  C0            		RET	NZ
  CF63  0C            		INC	C
  CF64  0C            		INC	C
  CF65  ED438CF0      		LD	(_CTC),BC
  CF69  C9            		RET
                      	
  CF6A                	SETCRTC:
  CF6A  21B0F0        		LD	HL,CRTCD
  CF6D  AF            		XOR	A
  CF6E                	SETCRT1:
  CF6E  010018        		LD	BC,01800H
  CF71  ED79          		OUT	(C),A
  CF73  0C            		INC	C
  CF74  04            		INC	B
  CF75  EDA3          		OUTI
  CF77  3C            		INC	A
  CF78  FE0C          		CP	12
  CF7A  20F2          		JR	NZ,SETCRT1
  CF7C  23            		INC	HL
  CF7D  23            		INC	HL
  CF7E  01031B        		LD	BC,01A03H+00100H
  CF81  EDA3          		OUTI
  CF83  01D020        		LD	BC,01FD0H+00100H
  CF86  EDA3          		OUTI
  CF88  C9            		RET
                      	
  CF89                	CALC_FATLN:	;FAT12のクラスタ数から必要なFATサイズを求める(セクタサイズ512)
  CF89  5D            		LD	E,L
  CF8A  54            		LD	D,H
  CF8B  29            		ADD	HL,HL	;*2
  CF8C  19            		ADD	HL,DE	;*3
  CF8D  CB3C          		SRL	H	;/2
  CF8F  CB1D          		RR	L	;1クラスタ辺り1.5バイト必要
  CF91  11FF01        		LD	DE,511	;切り上げる
  CF94  19            		ADD	HL,DE
  CF95  7C            		LD	A,H
  CF96  CB3F          		SRL	A
  CF98  C9            		RET
                      	
  CF99  4155544F455845	AUTOD:	DB	"AUTOEXEC "
  CFA2  413A00        	AUTODV:	DB	"A:",0
                      	
  CFA5  4C53582D446F64	INIMES:	DB	"LSX-Dodgers for X1/turbo version "
  CFC6  312E          		DB	030H + VER_1, '.'
  CFC8  3536          		DB	030H + VER_2 ,030H + VER_3
                      	;	DB	""
  CFCA  2047616B750D0A		DB	' Gaku',0DH,0AH
  CFD1  00            		DB	0
                      	
  CFD2                	_C8025H:
  CFD2  6B5059881B0119		DB	06BH,050H,059H,088H,01BH,001H,019H,01AH
  CFDA  000F          		DB	000H,00FH
  CFDC  80F8B0FF      		DW	0-80*LINE,0-80
  CFE0  0C23          		DB	00CH,023H
                      	
  CFE2  030C0F30333C3F	TEXTDT:	DB	003H,00CH,00FH,030H,033H,03CH,03FH
                      	
  CFE9                	SIODATA:
  CFE9  18            		DB	018H
  CFEA  0100          		DB	1,0
  CFEC  0200          		DB	2,0
  CFEE  03C1          		DB	3,0C1H
  CFF0  0444          		DB	4,044H
  CFF2  05E8          		DB	5,0E8H
  CFF4  FF            		DB	0FFH
                      	
  CFF5                	AT_TRAP38:
  CFF5  210000        		LD	HL,0
  CFF8  E3            		EX	(SP),HL
  CFF9  3E24          		LD	A,'$'
  CFFB  CDBCDB        		CALL	MSG_A
  CFFE  2B            		DEC	HL
  CFFF  7C            		LD	A,H
  D000  CDE8FF        		CALL	PRHX+AT_RT
  D003  7D            		LD	A,L
  D004                	PRHX:
  D004  F5            		PUSH	AF
  D005  07            		RLCA
  D006  07            		RLCA
  D007  07            		RLCA
  D008  07            		RLCA
  D009  CDF1FF        		CALL	PRHX2+AT_RT
  D00C  F1            		POP	AF
  D00D                	PRHX2:
  D00D  E60F          		AND	00FH
  D00F  FE0A          		CP	10
  D011  3F            		CCF
  D012  CE30          		ADC	A,'0'
  D014  27            		DAA
  D015  C3BCDB        		JP	MSG_A
  D018                		DS	4
  D01C                	AT_TRAPE:
                      	
                      	;X1CPU.ASM
                      	
                      	;	LSX-Dodgers CPU
                      	;	X1/turbo/Z
                      	
                      	;	ノンターボ用パッチ
                      	;	DMAを使って転送している部分をCPUに差し替える
                      	
  D01C                	AT_SCR1:
  D01C  D9            		EXX
  D01D  C5            		PUSH	BC
  D01E  ED4BB1F0      		LD	BC,(_WIDTH)
  D022  0620          		LD	B,020H
  D024  D9            		EXX
  D025  C5            		PUSH	BC
  D026  010020        		LD	BC,02000H
                      	
  D029  67            		LD	H,A
  D02A  B7            		OR	A
  D02B                	AT_SCRUP1:
  D02B  2815          		JR	Z,AT_SCRCL
  D02D  C5            		PUSH	BC
  D02E  CBE0          		SET	4,B
  D030  D9            		EXX
  D031  C5            		PUSH	BC
  D032  CBE0          		SET	4,B
  D034  D9            		EXX
  D035  CD96DF        		CALL	AT_UPSUB+AT_RS
  D038  D9            		EXX
  D039  C1            		POP	BC
  D03A  D9            		EXX
  D03B  C1            		POP	BC
  D03C  CD96DF        		CALL	AT_UPSUB+AT_RS
  D03F  25            		DEC	H
  D040  18E9          		JR	AT_SCRUP1
                      	
  D042                	AT_SCRCL:
  D042  2AB1F0        		LD	HL,(_WIDTH)
  D045  CD2EDE        		CALL	LINECL
  D048  C1            		POP	BC
  D049  D9            		EXX
  D04A  C1            		POP	BC
  D04B  D9            		EXX
  D04C  C9            		RET
                      	
  D04D                	AT_UPSUB:
  D04D  3AB1F0        		LD	A,(_WIDTH)
  D050  6F            		LD	L,A
  D051                	AT_UPSUB1:
  D051  D9            		EXX
  D052  ED78          		IN	A,(C)
  D054  03            		INC	BC
  D055  D9            		EXX
  D056  ED79          		OUT	(C),A
  D058  03            		INC	BC
  D059  2D            		DEC	L
  D05A  20F5          		JR	NZ,AT_UPSUB1
  D05C  C9            		RET
                      	
                      	;	FLOPPY DISK DRIVER(CPU)
                      	
  D05D                	DISKC:
  D05D  1B            		DEC	DE
  D05E  CB5F          		BIT	3,A
  D060  C4B6EE        		CALL	NZ,RNF
  D063                	DISKD:
  D063  E5            		PUSH	HL
  D064  21BCEE        		LD	HL,RETRY
  D067  35            		DEC	(HL)
  D068  E1            		POP	HL
  D069  200C          		JR	NZ,AT_ERR		;Retry
  D06B  B7            		OR	A
  D06C  2809          		JR	Z,AT_ERR		;Error
                      	
  D06E                	AT_DELP:
  D06E  CDB6EE        		CALL	RNF
  D071  CD92EE        		CALL	FDMOFF
  D074  3EFF          		LD	A,0FFH
  D076                	AT_ERRZ:
  D076  BF            		CP	A
  D077                	AT_ERR:
  D077  3EFF          		LD	A,0FFH
  D079  C9            		RET
  D07A                	ERRW:
  D07A  3EFF          		LD	A,0FFH
  D07C  BF            		CP	A
  D07D  37            		SCF
  D07E  C392EE        		JP	FDMOFF
                      	
  D081                	ERRDW:
  D081  D1            		POP	DE
  D082  CDB7DF        		CALL	AT_DELP+AT_RS
  D085  C2CBEE        		JP	NZ,DWT0+AT_R
  D088  B7            		OR	A
  D089  20EF          		JR	NZ,ERRW
  D08B  C9            		RET
                      	
  D08C                	ERRDR:
  D08C  D1            		POP	DE
  D08D  CDB7DF        		CALL	AT_DELP+AT_RS
  D090  C214EF        		JP	NZ,DRD0+AT_R
  D093  B7            		OR	A
  D094  20E4          		JR	NZ,ERRW
  D096  C9            		RET
                      	
  D097                	AT_WTTRK:
  D097  0601          		LD	B,1
  D099  3EF4          		LD	A,0F4H
  D09B  C3BFEE        		JP	AT_WTTRK1+AT_R
                      	
  D09E                	AT_SCRN:
  D09E  ED78          		IN	A,(C)
  D0A0  C9            		RET
  D0A1                	AT_SCRE:
                      	
  D0A1                	AT_DWT:
  D0A1  3EA0          		LD	A,0A0H
  D0A3                	AT_WTTRK1:
  D0A3  325AEE        		LD	(FDCPAT+1),A
  D0A6                	DWTBL:
  D0A6  78            		LD	A,B
  D0A7  3202EF        		LD	(AT_WTB+1+AT_R),A
  D0AA  3E02          		LD	A,2		;Retry count
  D0AC  32BCEE        		LD	(RETRY),A
                      	
  D0AF                	DWT0:
  D0AF  D5            		PUSH	DE
  D0B0  E5            		PUSH	HL
  D0B1  CDF9ED        		CALL	SEEK		;Write disk
  D0B4  E1            		POP	HL
  D0B5  DACADF        		JP	C,ERRDW+AT_RS
  D0B8  F3            		DI
  D0B9  3A5AEE        		LD	A,(FDCPAT+1)
  D0BC  CD9EEE        		CALL	SECSET
  D0BF  0EFB          		LD	C,0FBH
                      	
  D0C1                	DWT1:
  D0C1  56            		LD	D,(HL)
  D0C2                	DWT2:
  D0C2  78            		LD	A,B
  D0C3  DBF8          		IN	A,(0F8H)
  D0C5  0F            		RRCA
  D0C6  3008          		JR	NC,DWT4
  D0C8  0F            		RRCA
  D0C9  30F7          		JR	NC,DWT2
  D0CB                	DWT3:
  D0CB  ED51          		OUT	(C),D
  D0CD  23            		INC	HL
  D0CE  18F1          		JR	DWT1
                      	
  D0D0                	DWT4:
  D0D0  3D            		DEC	A
  D0D1  28F8          		JR	Z,DWT3
  D0D3  3C            		INC	A
  D0D4  FB            		EI
  D0D5  D1            		POP	DE
  D0D6  13            		INC	DE
  D0D7  CD92EE        		CALL	FDMOFF
  D0DA  2809          		JR	Z,DISKOK_WT
  D0DC  CDA6DF        		CALL	DISKC+AT_RS
  D0DF  20CE          		JR	NZ,DWT0
  D0E1  B7            		OR	A
  D0E2  C2C3DF        		JP	NZ,ERRW+AT_RS
                      	
  D0E5                	DISKOK_WT:
  D0E5  0601          	AT_WTB:	LD	B,1
  D0E7  10BD          		DJNZ	DWTBL
  D0E9  C9            		RET
                      	
  D0EA                	AT_DRD:
  D0EA  3E80          		LD	A,080H
  D0EC  325AEE        		LD	(FDCPAT+1),A
  D0EF                	DRDBL:
  D0EF  78            		LD	A,B
  D0F0  3247EF        		LD	(AT_RDB+1+AT_R),A
  D0F3  3E02          		LD	A,2		;Retry count
  D0F5  32BCEE        		LD	(RETRY),A
  D0F8                	DRD0:
  D0F8  D5            		PUSH	DE
  D0F9  E5            		PUSH	HL
  D0FA  CDF9ED        		CALL	SEEK		;Read disk
  D0FD  E1            		POP	HL
  D0FE  DAD5DF        		JP	C,ERRDR+AT_RS
  D101  F3            		DI
  D102  3A5AEE        		LD	A,(FDCPAT+1)
  D105  CD9EEE        		CALL	SECSET
  D108  0EFB          		LD	C,0FBH
  D10A                	DRD1:
  D10A  78            		LD	A,B
  D10B  DBF8          		IN	A,(0F8H)
  D10D  0F            		RRCA
  D10E  3008          		JR	NC,DRD3
  D110  0F            		RRCA
  D111  30F7          		JR	NC,DRD1
  D113  EDA2          		INI
  D115  04            		INC	B
  D116  18F2          		JR	DRD1
                      	
  D118                	DRD3:
  D118  B7            		OR	A
  D119  FB            		EI
  D11A  D1            		POP	DE
  D11B  13            		INC	DE
  D11C  CD92EE        		CALL	FDMOFF
  D11F  2809          		JR	Z,DISKOK_RD
  D121  CDA6DF        		CALL	DISKC+AT_RS
  D124  20D2          		JR	NZ,DRD0
  D126  B7            		OR	A
  D127  C2C3DF        		JP	NZ,ERRW+AT_RS
                      	
  D12A                	DISKOK_RD:
  D12A  0601          	AT_RDB:	LD	B,1
  D12C  10C1          		DJNZ	DRDBL
  D12E  C9            		RET
                      	
  D12F                	AT_CPUE:
                      	
                      	
                      	;	EMM DRIVER(CPU)
                      	
                      	
  D12F                	AT_EDWT:
  D12F  CD0CD8        		CALL	AT_EADR+AT_RE
  D132                	AT_EDWT0:
  D132  F5            		PUSH	AF
  D133  AF            		XOR	A
  D134                	AT_EDWT1:
  D134  04            		INC	B
  D135  EDA3          		OUTI
  D137  04            		INC	B
  D138  EDA3          		OUTI
  D13A  3D            		DEC	A
  D13B  20F7          		JR	NZ,AT_EDWT1
  D13D  13            		INC	DE
  D13E  F1            		POP	AF
  D13F  3D            		DEC	A
  D140  20F0          		JR	NZ,AT_EDWT0
  D142  C9            		RET
                      	
  D143                	AT_EDRD:
  D143  CD0CD8        		CALL	AT_EADR+AT_RE
  D146                	AT_EDRD0:
  D146  F5            		PUSH	AF
  D147  AF            		XOR	A
  D148                	AT_EDRD1:
  D148  EDA2          		INI
  D14A  04            		INC	B
  D14B  EDA2          		INI
  D14D  04            		INC	B
  D14E  3D            		DEC	A
  D14F  20F7          		JR	NZ,AT_EDRD1
  D151  13            		INC	DE
  D152  F1            		POP	AF
  D153  3D            		DEC	A
  D154  20F0          		JR	NZ,AT_EDRD0
  D156  C9            		RET
                      	
  D157                	AT_EADR:
  D157  C5            		PUSH	BC
  D158  D5            		PUSH	DE
  D159  EB            		EX	DE,HL
  D15A  29            		ADD	HL,HL
  D15B  DD4E0D        		LD	C,(IX+00DH)	;DPB_0D_MAXSEC
  D15E  DD460C        		LD	B,(IX+00CH)	;DPB_0C_MAXCYL
  D161  09            		ADD	HL,BC
  D162  DD4E13        		LD	C,(IX+013H)	;DPB_13_UNITNO
  D165  060D          		LD	B,00DH
  D167  ED49          		OUT	(C),C
  D169  0C            		INC	C
  D16A  ED69          		OUT	(C),L
  D16C  0C            		INC	C
  D16D  ED61          		OUT	(C),H
  D16F  0C            		INC	C
  D170  EB            		EX	DE,HL
  D171  D1            		POP	DE
  D172  F1            		POP	AF
  D173  A7            		AND	A	;CF=0
  D174  C9            		RET
  D175                	AT_EMME:
                      	
  2FE4                	AT_RT	EQU	TRAP38-AT_TRAP38
                      	
  D175                	INITE:
  D175                		DS	BDOS-INITE
  D206  C32FD8        		JP	BDOS0
                      	
                      	;X1CCP.ASM
                      	
                      	;	LSX-Dodgers CCP
                      	;	X1/turbo/Z
                      	
  D209                	WBOOT1:
  D209  F3            		DI
  D20A  ED7B0600      		LD	SP,(SYSTEM+1)
                      	
  D20E  3EF0          		LD	A,INTVEC/256
  D210  ED47          		LD	I,A
                      	
  D212  3EE4          		LD	A,0E4H
  D214  CDDBDE        		CALL	COMOUT
  D217  3EC8          		LD	A,INTVEC
  D219  CDB5DE        		CALL	OT49SB
                      	
  D21C  21B0F0        		LD	HL,CRTCD
  D21F  AF            		XOR	A
  D220                	SETCRT2:
  D220  010018        		LD	BC,01800H
  D223  ED79          		OUT	(C),A
  D225  0C            		INC	C
  D226  56            		LD	D,(HL)
  D227  FE0D          		CP	13
  D229  3802          		JR	C,SETCRT3
  D22B  1600          		LD	D,0
  D22D                	SETCRT3:
  D22D  ED51          		OUT	(C),D
  D22F  23            		INC	HL
  D230  3C            		INC	A
  D231  FE0E          		CP	14
  D233  20EB          		JR	NZ,SETCRT2
                      	
  D235  01031B        		LD	BC,01A03H+00100H
  D238  EDA3          		OUTI
  D23A  01D020        		LD	BC,01FD0H+00100H
  D23D  EDA3          		OUTI
  D23F  2192F0        		LD	HL,_KEYD
  D242  7E            		LD	A,(HL)
  D243  3600          		LD	(HL),0
  D245  CDA9DB        		CALL	KEYBC_IFBREAK
  D248  3E04          		LD	A,4
  D24A  CDBCDB        		CALL	MSG_A
                      	
                      	;LDCCP.ASM
                      	
                      	;	LSX-Dodgers CCP
                      	
  D24D                	COMMAND:
  D24D  3AB2EF        		LD	A,(FCB_BAT)
  D250  B7            		OR	A
  D251  C292D3        		JP	NZ,C_BAT1
  D254  CD07D3        		CALL	SETDTA1
  D257  3A87F0        		LD	A,(_DVSW)
  D25A  C641          		ADD	A,'A'
  D25C  CDBCDB        		CALL	MSG_A
  D25F  3E3E          		LD	A,'>'
  D261  CDBCDB        		CALL	MSG_A
  D264  3E50          		LD	A,80
  D266  12            		LD	(DE),A
  D267  CD0BDC        		CALL	_SYS0A		;(BDOS)文字列入力
  D26A  CD95D4        		CALL	LTNL
  D26D                	COMMAND2:
  D26D  118200        		LD	DE,DTA1+2
  D270  CDFDF0        		CALL	_COMANL
  D273  30D8          		JR	NC,COMMAND
  D275  1179F0        		LD	DE,COMERM
  D278  CD61D8        		CALL	_SYS09		;(BDOS)文字列出力
  D27B  C7            		RST	0
                      	
  D27C                	COMANL:
  D27C  CD89E0        		CALL	FILE
  D27F  3A19F0        		LD	A,(FNAME+4)
  D282  FE20          		CP	020H
  D284  201C          		JR	NZ,COMB2
  D286  D5            		PUSH	DE
  D287  1115F0        		LD	DE,FNAME
  D28A  1A            		LD	A,(DE)
  D28B  FE20          		CP	020H
  D28D  2844          		JR	Z,SDVSW
  D28F  1B            		DEC	DE
  D290  1A            		LD	A,(DE)
  D291  C6FF          		ADD	A,0FFH
  D293  3809          		JR	C,COMB
  D295  13            		INC	DE
                      	
  D296  2103D7        		LD	HL,COMTB
  D299  0609          		LD	B,COMS
  D29B  CD0DE3        		CALL	CPNAME
  D29E                	COMB:
  D29E  D1            		POP	DE
  D29F  D20F00        		JP	NC,JP_HL
  D2A2                	COMB2:
  D2A2  EB            		EX	DE,HL
  D2A3  226FD3        		LD	(COMPAT+1),HL
  D2A6  F5            		PUSH	AF
  D2A7  CD27D3        		CALL	CEXE4
  D2AA  F1            		POP	AF
  D2AB  2115F0        		LD	HL,FNAME
  D2AE  116D00        		LD	DE,FCB2+1	;COMMAND NAME
  D2B1  010B00        		LD	BC,11
  D2B4  EDB0          		LDIR
  D2B6  114CEF        		LD	DE,PATHD
  D2B9                	CEX1:
  D2B9  1A            		LD	A,(DE)
  D2BA  FE20          		CP	020H
  D2BC  D8            		RET	C
  D2BD  CD7EE0        		CALL	FILEC
  D2C0  D5            		PUSH	DE
  D2C1  216D00        		LD	HL,FCB2+1	;COMMAND NAME
  D2C4  1115F0        		LD	DE,FNAME
  D2C7  010B00        		LD	BC,11
  D2CA  EDB0          		LDIR
  D2CC  CD27D3        		CALL	CEXE4
  D2CF  D1            		POP	DE
  D2D0  13            		INC	DE
  D2D1  18E6          		JR	CEX1
                      	
  D2D3                	SDVSW:
  D2D3  F1            		POP	AF
  D2D4  3A14F0        		LD	A,(FDRV)
  D2D7  3D            		DEC	A
  D2D8  5F            		LD	E,A
  D2D9  0E0E          		LD	C,00EH		;(BDOS)カレントドライブの設定
  D2DB  1831          		JR	SYSTEM0
                      	
  D2DD                	OPEN1:
  D2DD  2114F0        		LD	HL,FDRV
  D2E0                	OPEN:
  D2E0  0E11          		LD	C,011H		;(BDOS)ファイルの検索
  D2E2                	OPEN3:
  D2E2  D5            		PUSH	DE
  D2E3  118DEF        		LD	DE,DTA_CCP
  D2E6  CD04D3        		CALL	SETDTA
  D2E9  EB            		EX	DE,HL
  D2EA  CD0ED3        		CALL	SYSTEM0
  D2ED  D1            		POP	DE
  D2EE  C9            		RET
                      	
  D2EF                	OPEN2:
  D2EF  0E12          		LD	C,012H
  D2F1  18EF          		JR	OPEN3
                      	
  D2F3                	DEFCB:				;Z=Ok NZ=Error
  D2F3  118DEF        		LD	DE,DTA_CCP
  D2F6  CD0CD3        		CALL	SYSC0F
                      	
  D2F9  11AEEF        		LD	DE,DTA_CCP+33	;(FCB)ランダムレコード
  D2FC  0604          		LD	B,4
  D2FE  CDD3D5        		CALL	ZERO_MEMORY_DE
  D301                	SETDTA100:
  D301  110001        		LD	DE,00100H
  D304                	SETDTA:
  D304  C339DA        		JP	_SYS1A		;(BDOS)DTAの設定
                      	
  D307                	SETDTA1:
  D307  118000        		LD	DE,DTA1
  D30A  18F8          		JR	SETDTA
                      	
  D30C                	SYSC0F:
  D30C  0E0F          		LD	C,00FH		;(BDOS)ファイルのオープン
  D30E                	SYSTEM0:
  D30E  CD0500        		CALL	SYSTEM
  D311  B7            		OR	A
  D312  C9            		RET
                      	
  D313                	C_CD:
  D313  0E5A          		LD	C,5AH
  D315  18F7          		JR	SYSTEM0
                      	
  D317                	S27BUF:
  D317  3A0700        		LD	A,(SYSTEM+2)
  D31A  3D            		DEC	A
  D31B  E6F8          		AND	0F8H
  D31D  67            		LD	H,A
  D31E  2E00          		LD	L,0
  D320                	S27DTA:
  D320  118DEF        		LD	DE,DTA_CCP
  D323                	S27:
  D323  0E27          		LD	C,027H		;(BDOS)ランダムブロック読み込み
  D325  18E7          		JR	SYSTEM0
                      	
  D327                	CEXE4:
  D327  211DF0        		LD	HL,FNAME+8
  D32A  7E            		LD	A,(HL)
  D32B  FE20          		CP	020H
  D32D  2007          		JR	NZ,CEXE7
  D32F  3E3F          		LD	A,'?'
  D331  77            		LD	(HL),A
  D332  23            		INC	HL
  D333  77            		LD	(HL),A
  D334  23            		INC	HL
  D335  77            		LD	(HL),A
  D336                	CEXE7:
  D336  CDDDD2        		CALL	OPEN1
  D339                	CEXE5:
  D339  C0            		RET	NZ
  D33A  2A97EF        		LD	HL,(DTA_CCP+1+9)
  D33D  7C            		LD	A,H
  D33E  CD95E3        		CALL	CAP
  D341  67            		LD	H,A
  D342  7D            		LD	A,L
  D343  CD95E3        		CALL	CAP
  D346  6F            		LD	L,A
  D347  3A96EF        		LD	A,(DTA_CCP+1+8)
  D34A  CD95E3        		CALL	CAP
  D34D  D642          		SUB	'B'
  D34F  282C          		JR	Z,C_BAT
  D351  3D            		DEC	A		;'C'
  D352  2805          		JR	Z,C_EXE
  D354                	CEXE6:
  D354  CDEFD2        		CALL	OPEN2
  D357  18E0          		JR	CEXE5
                      	
  D359                	C_EXE:
  D359  7C            		LD	A,H
  D35A  FE4D          		CP	'M'
  D35C  20F6          		JR	NZ,CEXE6
                      	
  D35E  CDF3D2        		CALL	DEFCB
  D361  CD17D3        		CALL	S27BUF
  D364  3D            		DEC	A
  D365  37            		SCF
  D366  C0            		RET	NZ
  D367  7C            		LD	A,H
  D368  B5            		OR	L
  D369  37            		SCF
  D36A  C8            		RET	Z
  D36B  CD07D3        		CALL	SETDTA1
  D36E  110000        	COMPAT:	LD	DE,0				; self-modifying code
  D371  ED7B0600      		LD	SP,(SYSTEM+1)
  D375  67            		LD	H,A				; A=0 in SETDTA1(_SYS1A)
  D376  6F            		LD	L,A
  D377  E5            		PUSH	HL				; push $0000 (reboot address)
  D378  24            		INC	H
  D379  E5            		PUSH	HL				; push $0100 (TPA address)
  D37A  C39ED5        		JP	SETFCB				; and JP $0100
                      	
  D37D                	C_BAT:
  D37D  114154        		LD	DE,'A'+'T'*256
  D380  ED52          		SBC	HL,DE
  D382  20D0          		JR	NZ,CEXE6
                      	
  D384  CDF3D2        		CALL	DEFCB
                      	
  D387  218DEF        		LD	HL,DTA_CCP
  D38A  11B2EF        		LD	DE,FCB_BAT
  D38D  012500        		LD	BC,37
  D390  EDB0          		LDIR
  D392                	C_BAT1:
  D392  CD01D3        		CALL	SETDTA100
  D395  CDC9D3        		CALL	FGETC_BAT
  D398  218100        		LD	HL,DTA1+1
  D39B  2025          		JR	NZ,END_BATCH
  D39D  FE21          		CP	021H		;スペースや改行など制御文字を飛ばす
  D39F  38F1          		JR	C,C_BAT1
  D3A1  3620          		LD	(HL),' '
  D3A3  23            		INC	HL
  D3A4                	C_BAT2:
  D3A4  77            		LD	(HL),A
  D3A5  23            		INC	HL
  D3A6  7D            		LD	A,L
  D3A7  3C            		INC	A		;L==0FFH
  D3A8  2809          		JR	Z,RUN_BATCH
  D3AA  CDC9D3        		CALL	FGETC_BAT
  D3AD  2004          		JR	NZ,RUN_BATCH
  D3AF  FE20          		CP	020H
  D3B1  30F1          		JR	NC,C_BAT2
  D3B3                	RUN_BATCH:
  D3B3  7D            		LD	A,L
  D3B4  D67F          		SUB	DTA1-1
  D3B6  328000        		LD	(DTA1),A
  D3B9  FE04          		CP	4
  D3BB  3805          		JR	C,END_BATCH
  D3BD  3600          		LD	(HL),0
  D3BF  C36DD2        		JP	COMMAND2
  D3C2                	END_BATCH:
  D3C2  AF            		XOR	A		;バッチファイルを閉じる
  D3C3  32B2EF        		LD	(FCB_BAT),A
  D3C6  C300F0        		JP	CPM_BOOT
                      	
  D3C9                	FGETC_BAT:
  D3C9  11B2EF        		LD	DE,FCB_BAT
  D3CC                	FGETC:				;1文字ずつ読み込む
  D3CC  E5            		PUSH	HL		;Z:成功
  D3CD  210100        		LD	HL,1
  D3D0  CD23D3        		CALL	S27
  D3D3  E1            		POP	HL
  D3D4  3A0001        		LD	A,(00100H)
  D3D7  C9            		RET
                      	
  D3D8                	C_DEL:
  D3D8  CD9ED5        		CALL	SETFCB
  D3DB  CDD2DB        		CALL	_SYS08		;(BDOS)エコーなしコンソール入力
                      	
  D3DE  0E13          		LD	C,013H
  D3E0  180A          		JR	CDEL1		;(BDOS)ファイルの削除
                      	
  D3E2                	C_REN:
  D3E2  CD9ED5        		CALL	SETFCB
  D3E5  3E10          		LD	A,010H		;ディレクトリも対象にする
  D3E7  326900        		LD	(FCB1+13),A	;属性
  D3EA  0E17          		LD	C,017H		;(BDOS)ファイル名の変更
  D3EC                	CDEL1:
  D3EC  115C00        		LD	DE,FCB1
  D3EF  CD0500        		CALL	SYSTEM
  D3F2  C6FF          		ADD	A,0FFH
  D3F4  C9            		RET
                      	
  D3F5                	C_DIR:
  D3F5  CD7EE0        		CALL	FILEC
  D3F8  2115F0        		LD	HL,FDRV+1
  D3FB  CDE9D6        		CALL	CWILD1
  D3FE  3EF1          		LD	A,0F1H
  D400  3221F0        		LD	(FDRV+13),A
  D403  CDDDD2        		CALL	OPEN1
  D406                	CDIR1:
  D406  B7            		OR	A
  D407  2008          		JR	NZ,PDSKF
  D409  CD54D4        		CALL	P_NAME
  D40C  CDEFD2        		CALL	OPEN2
  D40F  18F5          		JR	CDIR1
                      	
  D411                	PDSKF:
  D411  3A14F0        		LD	A,(FDRV)
  D414  5F            		LD	E,A
  D415  0E1B          		LD	C,01BH		;(BDOS)ディスク情報の獲得
  D417  CD0500        		CALL	SYSTEM
  D41A  4F            		LD	C,A		;C←1クラスタ辺りの論理セクタ数
  D41B  C601          		ADD	A,001H
  D41D  D8            		RET	C		;Aが0FFHだった場合
  D41E  3E06          		LD	A,8-2
  D420                	PDS1:				;HL=未使用クラスタの総数
  D420  3C            		INC	A
  D421  CB19          		RR	C
  D423  30FB          		JR	NC,PDS1
  D425                	PDS2:				;B←論理セクタのサイズの上位8ビット
  D425  3C            		INC	A
  D426  CB18          		RR	B
  D428  30FB          		JR	NC,PDS2
  D42A  47            		LD	B,A
                      	
  D42B  110000        		LD	DE,0
  D42E                	PDS3:
  D42E  29            		ADD	HL,HL
  D42F  EB            		EX	DE,HL
  D430  ED6A          		ADC	HL,HL
  D432  EB            		EX	DE,HL
  D433  10F9          		DJNZ	PDS3
  D435                	PDSKF1:
  D435  CDCDD4        		CALL	PRDEC_DEHL
  D438  11D7EF        		LD	DE,FREE
  D43B  CD61D8        		CALL	_SYS09		;(BDOS)文字列出力
  D43E  CDBCD4        		CALL	PUTDRV
  D441  3E5C          		LD	A,05CH		;\
  D443  CDBCDB        		CALL	MSG_A
  D446  2A22F0        		LD	HL,(FDRV+14)	;ディレクトリのクラスタ番号
  D449  AF            		XOR	A
  D44A  11FEFF        		LD	DE,0-2
  D44D  19            		ADD	HL,DE
  D44E  23            		INC	HL
  D44F  DCC9D4        		CALL	C,PRDEC_HL
  D452  1841          		JR	LTNL
                      	
  D454                	P_NAME:
  D454  3A8EEF        		LD	A,(DTA_CCP+1)
  D457  FE2E          		CP	'.'
  D459  C8            		RET	Z
  D45A  11FFD6        		LD	DE,DIRHD
  D45D  CD61D8        		CALL	_SYS09		;(BDOS)文字列出力
  D460  3A99EF        		LD	A,(DTA_CCP+1+00BH)
  D463  F5            		PUSH	AF
  D464  0F            		RRCA
  D465  9F            		SBC	A,A
  D466  E60A          		AND	'*'-020H
  D468  C620          		ADD	A,020H
  D46A  CDBCDB        		CALL	MSG_A
  D46D  CDBCD4        		CALL	PUTDRV
  D470  218EEF        		LD	HL,DTA_CCP+1
  D473  CD0DD5        		CALL	FPRNT
                      	
  D476  F1            		POP	AF
  D477  CB67          		BIT	4,A
  D479  2808          		JR	Z,DIR3
  D47B  11F4D6        		LD	DE,DIRMES
  D47E  CD61D8        		CALL	_SYS09		;(BDOS)文字列出力
  D481  180A          		JR	DIR6
  D483                	DIR3:
  D483  ED5BACEF      		LD	DE,(DTA_CCP+1+01EH)
  D487  2AAAEF        		LD	HL,(DTA_CCP+1+01CH)
  D48A  CDCDD4        		CALL	PRDEC_DEHL
  D48D                	DIR6:
  D48D  3AB1F0        		LD	A,(_WIDTH)
  D490  FE29          		CP	40+1
  D492  D42FD5        		CALL	NC,PRTTMS
                      	
  D495                	LTNL:
  D495  1E03          		LD	E,3
  D497  C3CDF0        		JP	_PRINT
                      	
  D49A                	C_PATH:
  D49A  CD60E1        		CALL	SPCUT
  D49D  214CEF        		LD	HL,PATHD
  D4A0  FE21          		CP	021H
  D4A2  300C          		JR	NC,CPATH0
  D4A4                	CPATHP:
  D4A4  7E            		LD	A,(HL)
  D4A5  23            		INC	HL
  D4A6  FE20          		CP	020H
  D4A8  3F            		CCF
  D4A9  30EA          		JR	NC,LTNL
  D4AB  CDBCDB        		CALL	MSG_A
  D4AE  18F4          		JR	CPATHP
  D4B0                	CPATH0:
  D4B0  FE3B          		CP	';'
  D4B2  2001          		JR	NZ,CPATH1
  D4B4  13            		INC	DE
  D4B5                	CPATH1:
  D4B5  EB            		EX	DE,HL
  D4B6  014000        		LD	BC,PATHX
  D4B9  EDB0          		LDIR
  D4BB  C9            		RET
                      	
  D4BC                	PUTDRV:
  D4BC  3A14F0        		LD	A,(FDRV)
  D4BF  C640          		ADD	A,'A'-1
  D4C1  CDBCDB        		CALL	MSG_A
  D4C4  3E3A          		LD	A,':'
  D4C6                	MSG_AR:
  D4C6  C3BCDB        		JP	MSG_A
                      	
  D4C9                	PRDEC_HL:
  D4C9  AF            		XOR	A
  D4CA                	PRDEC_AHL:
  D4CA  5F            		LD	E,A
  D4CB  1600          		LD	D,0
  D4CD                	PRDEC_DEHL:
  D4CD  D5            		PUSH	DE
  D4CE  110FF0        		LD	DE,DECBF
  D4D1  0605          		LD	B,5
  D4D3  CDD3D5        		CALL	ZERO_MEMORY_DE	;A=0
  D4D6  D1            		POP	DE
                      	
  D4D7  0E20          		LD	C,32
  D4D9                	DEC1:
  D4D9  29            		ADD	HL,HL
  D4DA  EB            		EX	DE,HL
  D4DB  ED6A          		ADC	HL,HL
  D4DD  EB            		EX	DE,HL
  D4DE  E5            		PUSH	HL
  D4DF  2113F0        		LD	HL,DECBF+4
  D4E2  0605          		LD	B,5
  D4E4                	DEC2:
  D4E4  7E            		LD	A,(HL)
  D4E5  8F            		ADC	A,A
  D4E6  27            		DAA
  D4E7  77            		LD	(HL),A
  D4E8  2B            		DEC	HL
  D4E9  10F9          		DJNZ	DEC2
  D4EB  E1            		POP	HL
  D4EC  0D            		DEC	C
  D4ED  20EA          		JR	NZ,DEC1
                      	
  D4EF  210FF0        		LD	HL,DECBF
  D4F2  3E20          		LD	A,020H
  D4F4  0604          		LD	B,4
  D4F6                	DEC3:
  D4F6  CD03D5        		CALL	DEC4
  D4F9  CD03D5        		CALL	DEC4
  D4FC  23            		INC	HL
  D4FD  10F7          		DJNZ	DEC3
  D4FF                	DECX:
  D4FF  CD03D5        		CALL	DEC4
  D502  AF            		XOR	A
  D503                	DEC4:
  D503  ED6F          		RLD
  D505  FE20          		CP	020H
  D507  2802          		JR	Z,DEC5
  D509  F630          		OR	030H
  D50B                	DEC5:
  D50B  18B9          		JR	MSG_AR
                      	
  D50D                	FPRNT:
  D50D  0608          		LD	B,8
  D50F  CD20D5        		CALL	P_N1
  D512  7E            		LD	A,(HL)
  D513  C680          		ADD	A,0A0H-020H
  D515  FEA0          		CP	0A0H
  D517  2802          		JR	Z,FPR1
  D519  3E2E          		LD	A,'.'
  D51B                	FPR1:
  D51B  CDBCDB        		CALL	MSG_A
  D51E  0603          		LD	B,3
                      	
  D520                	P_N1:
  D520  C5            		PUSH	BC
  D521  E5            		PUSH	HL
  D522  7E            		LD	A,(HL)
  D523  CDA1E3        		CALL	CAP3
  D526  CDBCDB        		CALL	MSG_A
  D529  E1            		POP	HL
  D52A  C1            		POP	BC
  D52B  23            		INC	HL
  D52C  10F2          		DJNZ	P_N1
  D52E  C9            		RET
                      	
  D52F                	PRTTMS:
  D52F  3E20          		LD	A,020H
  D531  CDBCDB        		CALL	MSG_A
                      	
  D534  2AA6EF        		LD	HL,(DTA_CCP+1+24)
  D537  7D            		LD	A,L
  D538  B7            		OR	A
  D539  C8            		RET	Z
  D53A  CB3C          		SRL	H
  D53C  17            		RLA
  D53D  17            		RLA
  D53E  17            		RLA
  D53F  17            		RLA
  D540  E60F          		AND	00FH
  D542  57            		LD	D,A
  D543  7C            		LD	A,H
  D544  C650          		ADD	A,80
  D546  CD89D5        		CALL	PRDEC_A
  D549  3E2D          		LD	A,'-'
  D54B  CDBCDB        		CALL	MSG_A
  D54E  7A            		LD	A,D
  D54F  CD89D5        		CALL	PRDEC_A
  D552  3E2D          		LD	A,'-'
  D554  CDBCDB        		CALL	MSG_A
  D557  7D            		LD	A,L
  D558  E61F          		AND	01FH
  D55A  CD89D5        		CALL	PRDEC_A
                      	
  D55D  2AA4EF        		LD	HL,(DTA_CCP+1+22)
                      	
  D560  3E20          		LD	A,020H
  D562  CDBCDB        		CALL	MSG_A
  D565  7C            		LD	A,H
  D566  65            		LD	H,L
  D567  0603          		LD	B,3
  D569                	PRTTMS1:
  D569  1F            		RRA
  D56A  CB1D          		RR	L
  D56C  10FB          		DJNZ	PRTTMS1
  D56E  E61F          		AND	01FH
  D570  CD89D5        		CALL	PRDEC_A
  D573  3E3A          		LD	A,':'
  D575  CDBCDB        		CALL	MSG_A
  D578  7D            		LD	A,L
  D579  0F            		RRCA
  D57A  0F            		RRCA
  D57B  E63F          		AND	03FH
  D57D  CD89D5        		CALL	PRDEC_A
  D580  3E3A          		LD	A,':'
  D582  CDBCDB        		CALL	MSG_A
  D585  7C            		LD	A,H
  D586  E61F          		AND	01FH
  D588  87            		ADD	A,A
                      	
                      	;	PRINT10
                      	
  D589                	PRDEC_A:
  D589  E5            		PUSH	HL
  D58A  0608          		LD	B,8
  D58C  4F            		LD	C,A
  D58D  AF            		XOR	A
  D58E                	PRTA1:
  D58E  CB01          		RLC	C
  D590  8F            		ADC	A,A
  D591  27            		DAA
  D592  10FA          		DJNZ	PRTA1
  D594  210FF0        		LD	HL,DECBF
  D597  77            		LD	(HL),A
  D598  AF            		XOR	A
  D599  CDFFD4        		CALL	DECX
  D59C  E1            		POP	HL
  D59D  C9            		RET
                      	
  D59E                	SETFCB:
  D59E  CD60E1        		CALL	SPCUT
  D5A1  1A            		LD	A,(DE)
  D5A2  FE20          		CP	020H
  D5A4  3801          		JR	C,SETFCBA
  D5A6  1B            		DEC	DE
  D5A7                	SETFCBA:
  D5A7  0624          		LD	B,36
  D5A9  215C00        		LD	HL,FCB1
  D5AC  E5            		PUSH	HL
  D5AD  AF            		XOR	A
  D5AE  CD35E1        		CALL	FILL_MEMORY
  D5B1  E1            		POP	HL
  D5B2  D5            		PUSH	DE
  D5B3  CD9FDA        		CALL	_SYS29		;(BDOS)ファイル名の解析
  D5B6  216C00        		LD	HL,FCB2
  D5B9  CD9FDA        		CALL	_SYS29		;(BDOS)ファイル名の解析
  D5BC  E1            		POP	HL
  D5BD  010050        		LD	BC,05000H
  D5C0  118100        		LD	DE,00081H
  D5C3                	SETFCB1:
  D5C3  7E            		LD	A,(HL)
  D5C4  23            		INC	HL
  D5C5  FE20          		CP	020H
  D5C7  3805          		JR	C,SETFCB2
  D5C9  12            		LD	(DE),A
  D5CA  13            		INC	DE
  D5CB  0C            		INC	C
  D5CC  10F5          		DJNZ	SETFCB1
  D5CE                	SETFCB2:
  D5CE  79            		LD	A,C
  D5CF  328000        		LD	(DTA1),A
  D5D2  04            		INC	B
  D5D3                	ZERO_MEMORY_DE:
  D5D3  AF            		XOR	A
  D5D4                	FILL_MEMORY_DE:
  D5D4  12            		LD	(DE),A
  D5D5  13            		INC	DE
  D5D6  10FC          		DJNZ	FILL_MEMORY_DE
  D5D8  C9            		RET
                      	
  D5D9                	C_COPY:
  D5D9  CD9ED5        		CALL	SETFCB
                      	
  D5DC  1161F0        		LD	DE,ZERO
  D5DF  CD81E0        		CALL	FILEC2
  D5E2  216C00        		LD	HL,FCB2
  D5E5  CDA6DA        		CALL	S29X1
                      	
  D5E8  3E10          		LD	A,010H
  D5EA  326900        		LD	(FCB1+13),A
  D5ED  216D00        		LD	HL,FCB2+1
  D5F0  CDE9D6        		CALL	CWILD1
  D5F3                	COPY0:
  D5F3  CDE6D6        		CALL	CWILD
  D5F6  215C00        		LD	HL,FCB1
  D5F9  CDE0D2        		CALL	OPEN
  D5FC  37            		SCF
  D5FD                	COPY1:
  D5FD  C0            		RET	NZ
  D5FE  CDF3D2        		CALL	DEFCB
                      	
  D601  3A9AEF        		LD	A,(DTA_CCP+13)
  D604  CB67          		BIT	4,A
  D606  2821          		JR	Z,COPY1A
                      	
  D608  215D00        		LD	HL,FCB1+1
  D60B  CDC4E4        		CALL	CHKWILD
  D60E  3814          		JR	C,COPY9
                      	
  D610  3E20          		LD	A,020H
  D612  325D00        		LD	(FCB1+1),A
  D615  2AA7EF        		LD	HL,(DTA_CCP+26)
  D618  23            		INC	HL
  D619  226A00        		LD	(FCB1+14),HL
  D61C  18D5          		JR	COPY0
                      	
  D61E                	COPY8:
  D61E  CD61D8        		CALL	_SYS09		;(BDOS)文字列出力
  D621  CD95D4        		CALL	LTNL
  D624                	COPY9:
  D624  CDEFD2        		CALL	OPEN2
  D627  18D4          		JR	COPY1
                      	
  D629                	COPY1A:
  D629  216C00        		LD	HL,FCB2
  D62C  1114F0        		LD	DE,FDRV
  D62F  018FEF        		LD	BC,DTA_CCP+2
  D632  EDA0          		LDI
  D634  3E0B          		LD	A,11
  D636                	COPY2:
  D636  F5            		PUSH	AF
  D637  7E            		LD	A,(HL)
  D638  FE3F          		CP	'?'
  D63A  2001          		JR	NZ,COPY3
  D63C  0A            		LD	A,(BC)
  D63D                	COPY3:
  D63D  12            		LD	(DE),A
  D63E  03            		INC	BC
  D63F  13            		INC	DE
  D640  23            		INC	HL
  D641  F1            		POP	AF
  D642  3D            		DEC	A
  D643  20F1          		JR	NZ,COPY2
  D645  010500        		LD	BC,16-11
  D648  EDB0          		LDIR
  D64A                	PUTNAME:
  D64A  215D00        		LD	HL,FCB1+1
  D64D  CDC4E4        		CALL	CHKWILD
  D650  300B          		JR	NC,PUTN1
  D652  2115F0        		LD	HL,FDRV+1
  D655  CD0DD5        		CALL	FPRNT
  D658  3E20          		LD	A,020H
  D65A  CDBCDB        		CALL	MSG_A
  D65D                	PUTN1:
  D65D  1114F0        		LD	DE,FDRV
  D660  0E16          		LD	C,016H		;(BDOS)ファイルの作成
  D662  CD0ED3        		CALL	SYSTEM0
  D665  2048          		JR	NZ,COPYE2
  D667  67            		LD	H,A		;A=0
  D668  6F            		LD	L,A
  D669  2235F0        		LD	(FDRV+33),HL	;(FCB)ランダムレコード
  D66C  2237F0        		LD	(FDRV+35),HL
  D66F                	COPY6:
  D66F  CD17D3        		CALL	S27BUF
  D672  47            		LD	B,A
  D673  3C            		INC	A
  D674  2831          		JR	Z,COPYE
  D676  7C            		LD	A,H
  D677  B5            		OR	L
  D678  280C          		JR	Z,COPY7
  D67A  1114F0        		LD	DE,FDRV
  D67D  0E26          		LD	C,026H		;(BDOS)ランダムブロック書き込み
  D67F  CD0ED3        		CALL	SYSTEM0
  D682  2023          		JR	NZ,COPYE
  D684  10E9          		DJNZ	COPY6
  D686                	COPY7:
  D686  3A9AEF        		LD	A,(DTA_CCP+13)	;(FCB)属性
  D689  3221F0        		LD	(FDRV+13),A
  D68C  21A1EF        		LD	HL,DTA_CCP+20	;(FCB)タイムスタンプ
  D68F  1128F0        		LD	DE,FDRV+20
  D692  010400        		LD	BC,4
  D695  EDB0          		LDIR
                      	
  D697  1114F0        		LD	DE,FDRV
  D69A  0E10          		LD	C,010H		;(BDOS)ファイルのクローズ
  D69C  CD0ED3        		CALL	SYSTEM0
  D69F  2006          		JR	NZ,COPYE
                      	
  D6A1  1171F0        		LD	DE,OK
  D6A4  C31ED6        		JP	COPY8
                      	
  D6A7                	COPYE:
  D6A7  1114F0        		LD	DE,FDRV
  D6AA  0E13          		LD	C,013H		;(BDOS)ファイルの削除
  D6AC  CD0500        		CALL	SYSTEM
  D6AF                	COPYE2:
  D6AF  37            		SCF
  D6B0  C9            		RET
                      	
  D6B1                	C_TYPE:
  D6B1  CD9ED5        		CALL	SETFCB
  D6B4  215C00        		LD	HL,FCB1
  D6B7  CDE0D2        		CALL	OPEN
  D6BA  37            		SCF
  D6BB                	TYPE1:
  D6BB  C0            		RET	NZ
  D6BC  CDF3D2        		CALL	DEFCB
  D6BF  3E06          		LD	A,6
  D6C1  CDBCDB        		CALL	MSG_A
  D6C4                	TYPE2:
  D6C4  CD17D3        		CALL	S27BUF
  D6C7  C6FE          		ADD	A,0FEH
  D6C9  D8            		RET	C
  D6CA  7C            		LD	A,H
  D6CB  B5            		OR	L
  D6CC  2813          		JR	Z,TYPEE
  D6CE  010001        		LD	BC,00100H
  D6D1                	TYPE3:
  D6D1  0A            		LD	A,(BC)
  D6D2  03            		INC	BC
  D6D3  FE1A          		CP	01AH
  D6D5  280A          		JR	Z,TYPEE
  D6D7  CDBCDB        		CALL	MSG_A
  D6DA  2B            		DEC	HL
  D6DB  7C            		LD	A,H
  D6DC  B5            		OR	L
  D6DD  20F2          		JR	NZ,TYPE3
  D6DF  18E3          		JR	TYPE2
  D6E1                	TYPEE:
  D6E1  CDEFD2        		CALL	OPEN2
  D6E4  18D5          		JR	TYPE1
                      	
  D6E6                	CWILD:
  D6E6  215D00        		LD	HL,FCB1+1
  D6E9                	CWILD1:
  D6E9  7E            		LD	A,(HL)
  D6EA  FE20          		CP	020H
  D6EC  C0            		RET	NZ
  D6ED                	CWILD2:
  D6ED  3E3F          		LD	A,'?'
  D6EF  060B          		LD	B,11
  D6F1  C335E1        		JP	FILL_MEMORY
                      	
  D6F4  20202020203C44	DIRMES:	DB	"     <DIR>$"
  D6FF  20203A24      	DIRHD:	DB	"  :$"
                      	
  D703                	COMTB:
  D703  44202020      		DB	"D   "	;1
  D707  F5D3          		DW	C_DIR
  D709  44495220      		DB	"DIR "	;2
  D70D  F5D3          		DW	C_DIR
  D70F  434F5059      		DB	"COPY"	;3
  D713  D9D5          		DW	C_COPY
  D715  43442020      		DB	"CD  "	;4
  D719  13D3          		DW	C_CD
  D71B  44454C20      		DB	"DEL "	;5
  D71F  D8D3          		DW	C_DEL
  D721  50415448      		DB	"PATH"	;6
  D725  9AD4          		DW	C_PATH
  D727  52454E20      		DB	"REN "	;7
  D72B  E2D3          		DW	C_REN
  D72D  54595045      		DB	"TYPE"	;8
  D731  B1D6          		DW	C_TYPE
  D733  52454D20      		DB	"REM "	;9
  D737  5ED8          		DW	C_REM
                      	
                      	;X1DISK2.ASM
                      	
                      	;	LSX-Dodgers DISK2
                      	;	X1/turbo/Z
                      	
                      	;	GRAPHIC RAM DISK DRIVER
                      	
                      	
  D739                	GDRD:
  D739  C5            		PUSH	BC
  D73A  CD62D7        		CALL	GADR
  D73D  F1            		POP	AF
  D73E                	GDRD1:
  D73E  EDA2          		INI
  D740  04            		INC	B
  D741  0C            		INC	C
  D742  20FA          		JR	NZ,GDRD1
  D744  04            		INC	B
  D745  13            		INC	DE
  D746  3D            		DEC	A
  D747  20F5          		JR	NZ,GDRD1
  D749                	GBANK0:
  D749  3ABFF0        		LD	A,(WK1FD0)
  D74C  E6EF          		AND	0EFH		;BANK0
  D74E  181D          		JR	S1FD0
                      	
  D750                	GDWT:
  D750  C5            		PUSH	BC
  D751  CD62D7        		CALL	GADR
  D754  F1            		POP	AF
  D755                	GDWT1:
  D755  04            		INC	B
  D756  EDA3          		OUTI
  D758  0C            		INC	C
  D759  20FA          		JR	NZ,GDWT1
  D75B  04            		INC	B
  D75C  13            		INC	DE
  D75D  3D            		DEC	A
  D75E  20F5          		JR	NZ,GDWT1
  D760  18E7          		JR	GBANK0
                      	
  D762                	GADR:
  D762  0E00          		LD	C,0
  D764  7B            		LD	A,E
  D765  C640          		ADD	A,040H
  D767  47            		LD	B,A
  D768  3ABFF0        		LD	A,(WK1FD0)
  D76B  F610          		OR	010H		;BANK1
  D76D                	S1FD0:
  D76D  C5            		PUSH	BC
  D76E  32BFF0        		LD	(WK1FD0),A
  D771  01D01F        		LD	BC,01FD0H
  D774  ED79          		OUT	(C),A
  D776  C1            		POP	BC
  D777  C9            		RET
                      	
                      	
                      	;	BANK RAM DISK DRIVER
                      	
  D778                	BDWT:
  D778  3E            		DB	03EH	;LD A,??
  D779  37            		SCF
  D77A  1802          		JR	BRW
                      	
  D77C                	BDRD:
  D77C  3E            		DB	03EH	;LD A,??
  D77D  A7            		AND	A
  D77E                	BRW:
  D77E  F3            		DI
  D77F  32AAD7        		LD	(BRWPAT),A
  D782  ED73CAD7      		LD	(BANKSP),SP
  D786  3ACBD7        		LD	A,(BANKSP_H)
  D789  87            		ADD	A,A
  D78A  3803          		JR	C,BRW0
  D78C  31CAFF        		LD	SP,EXTSP
  D78F                	BRW0:
  D78F  D9            		EXX		;裏レジスタ
  D790  C5            		 PUSH	 BC
  D791  D5            		 PUSH	 DE
  D792  01000B        		 LD	 BC,00B00H	 ;バンクメモリ
  D795  111010        		 LD	 DE,01010H
  D798  D9            		 EXX		;表レジスタ
  D799                	BRW1:
  D799  C5            		PUSH	BC
  D79A  D5            		PUSH	DE
  D79B  EB            		EX	DE,HL
  D79C  29            		ADD	HL,HL
  D79D  29            		ADD	HL,HL
  D79E  7C            		LD	A,H
  D79F  DD860C        		ADD	A,(IX+00CH)	;DPB_0C_MAXCYL
  D7A2  E60F          		AND	00FH	;バンク
  D7A4  65            		LD	H,L
  D7A5  CB3C          		SRL	H	;/2
  D7A7  2E00          		LD	L,0
  D7A9  D9            		EXX		;裏レジスタ
  D7AA  A7            	BRWPAT:	 AND	 A	;自己書き換え(AND A:読み出し/SCF:書き込み)
  D7AB  3808          		 JR	 C,BRWT
  D7AD  57            		 LD	 D,A	 ;D=バンク
  D7AE  D9            		 EXX		;表レジスタ
  D7AF  EB            		EX	DE,HL
  D7B0  CDCED7        		CALL	BTFR
  D7B3  1806          		JR	BRW2
  D7B5                	BRWT:
  D7B5  5F            		 LD	E,A	 ;E=バンク
  D7B6  D9            		 EXX		;表レジスタ
  D7B7  CDCED7        		CALL	BTFR
  D7BA  EB            		EX	DE,HL
  D7BB                	BRW2:
  D7BB  D1            		POP	DE
  D7BC  C1            		POP	BC
  D7BD  13            		INC	DE
  D7BE  10D9          		DJNZ	BRW1
                      	
  D7C0  D9            		EXX		;裏レジスタ
  D7C1  3E10          		 LD	 A,10H
  D7C3  ED79          		 OUT	 (C),A		;メインメモリに切り替える
  D7C5  D1            		 POP	 DE
  D7C6  C1            		 POP	 BC
  D7C7  D9            		 EXX		;表レジスタ
  D7C8  AF            		XOR	A
  D7C9  310000        		LD	SP,0
  D7CB                	BANKSP_H	EQU	$-1
  D7CA                	BANKSP		EQU	$-2
  D7CC  FB            		EI
  D7CD  C9            		RET
                      	
                      	;メインメモリ←→バンクメモリ 512バイトの転送を行う
                      	; DE:転送元アドレス
                      	; HL:転送先アドレス
                      	; 裏BC:バンク切り替えポート(0B00H)
                      	; 裏D:転送元バンク(0-0FH:10Hはメインメモリ)
                      	; 裏E:転送先バンク(0-0FH:10Hはメインメモリ)
                      	
  D7CE                	BTFR:
  D7CE  0600          		LD	B,0	;256回ループ(256*2)
  D7D0                	BTFR1:
  D7D0  D9            		EXX		;裏レジスタ
  D7D1  ED51          		 OUT	 (C),D	 ;BANK(MAIN)
  D7D3  D9            		 EXX		;表レジスタ
  D7D4  1A            		LD	A,(DE)
  D7D5  4F            		LD	C,A
  D7D6  13            		INC	DE
  D7D7  1A            		LD	A,(DE)
  D7D8  13            		INC	DE
  D7D9  D9            		EXX		;裏レジスタ
  D7DA  ED59          		 OUT	 (C),E	 ;MAIN(BANK)
  D7DC  D9            		 EXX		;表レジスタ
  D7DD  71            		LD	(HL),C
  D7DE  23            		INC	HL
  D7DF  77            		LD	(HL),A
  D7E0  23            		INC	HL
  D7E1  10ED          		DJNZ	BTFR1
  D7E3  C9            		RET
                      	
                      	;	EMM DRIVER(DMA)
                      	
                      	
  D7E4                	EDWT:
  D7E4  0E0F          		LD	C,15
  D7E6  1802          		JR	EDWT1
  D7E8                	EDRD:
  D7E8  0E0E          		LD	C,14
  D7EA                	EDWT1:
  D7EA  C5            		PUSH	BC
  D7EB  D5            		PUSH	DE
  D7EC  222CD8        		LD	(DMAB),HL
  D7EF  78            		LD	A,B
  D7F0  87            		ADD	A,A
  D7F1  3D            		DEC	A
  D7F2  3225D8        		LD	(DMALEN+1),A
  D7F5  3C            		INC	A
  D7F6  84            		ADD	A,H	;HL(アドレス)を先に進めておく
  D7F7  67            		LD	H,A
  D7F8  EB            		EX	DE,HL
  D7F9  29            		ADD	HL,HL
  D7FA  DD460C        		LD	B,(IX+00CH)	;DPB_0C_MAXCYL
  D7FD  79            		LD	A,C
  D7FE  DD4E0D        		LD	C,(IX+00DH)	;DPB_0D_MAXSEC
  D801  09            		ADD	HL,BC
  D802  DD4E13        		LD	C,(IX+013H)	;DPB_13_UNITNO
  D805  060D          		LD	B,00DH
  D807  ED49          		OUT	(C),C
  D809  0C            		INC	C
  D80A  ED69          		OUT	(C),L
  D80C  0C            		INC	C
  D80D  ED61          		OUT	(C),H
                      	
  D80F  2120D8        		LD	HL,EDMAD
  D812  CD91DF        		CALL	SETDMA
  D815  CDB9DF        		CALL	GO_DMA
  D818  EB            		EX	DE,HL
  D819  D1            		POP	DE
  D81A  C1            		POP	BC
  D81B                	DMA_ADD_SEC:
  D81B  13            		INC	DE
  D81C  10FD          		DJNZ	DMA_ADD_SEC
  D81E  AF            		XOR	A
  D81F  C9            		RET
                      	
  D820                	EDMAD:
  D820  C3            		DB	0C3H	;WR6 リセット
  D821  7D            		DB	07DH	;WR0 ポートA→ポートB 転送
  D822  030D          		DW	00D03H	;ポートA開始アドレス EMMリード/ライト
  D824  FF01          	DMALEN:	DW	001FFH	;ブロック長(転送サイズ-1)
  D826  2C            		DB	02CH	;WR1 ポートAアドレス固定 I/O
  D827  50            		DB	050H	;WR2 ポートBアドレスインクリメント メモリ
  D828  02            		DB	002H	;ポートBタイミング
  D829  80            		DB	080H	;WR3
  D82A  9A            		DB	09AH	;WR5 WAIT RDY:HIGH
  D82B  AD            		DB	0ADH	;WR4 連続 ポートB開始アドレス
  D82C  0000          	DMAB:	DW	0
  D82E  01            		DB	001H	;WR0 ポートA←ポートB 転送
  D82F                	EMME:
                      	
  06B5                	AT_RE	EQU	EDWT-AT_EDWT
                      	
                      	
                      	;LDOS.ASM
                      	
                      	;	LSX-Dodgers OS
                      	
  D82F                	BDOS0:
  D82F  E5            		PUSH	HL
  D830  79            		LD	A,C
  D831  FE3C          		CP	03CH
  D833  3802          		JR	C,DOS1
  D835  3E3C          		LD	A,03CH
  D837                	DOS1:
  D837  87            		ADD	A,A
  D838  6F            		LD	L,A
  D839  26F1          		LD	H,STABLE/256
  D83B  7E            		LD	A,(HL)
  D83C  2C            		INC	L
  D83D  66            		LD	H,(HL)
  D83E  6F            		LD	L,A
  D83F  E3            		EX	(SP),HL
  D840  79            		LD	A,C
                      	;確認用
                      	;	LD	(0050H),A
  D841  C9            		RET
  D842                	_DOS2:
  D842  FE5A          		CP	05AH		;(BDOS)カレントディレクトリの変更(_CHDIR)
  D844  CAE1DA        		JP	Z,_SYS5A
  D847  FE5C          		CP	05CH		;(BDOS)ファイル名の解析(_PFILE)
  D849  CA9FDA        		JP	Z,_SYS29
  D84C  FE5F          		CP	05FH		;(BDOS)ディスクバッファのフラッシュ(_FLUSH)
  D84E  CADDED        		JP	Z,_SYS5F
  D851  FE6F          		CP	06FH		;(BDOS)MSX-DOS のバージョン番号の獲得(_DOSVER)
  D853  200A          		JR	NZ,_ERROR
  D855  011D01        		LD	BC,011DH
  D858  115601        		LD	DE,VER
  D85B  210000        		LD	HL,MACD
  D85E                	C_REM:
  D85E  AF            		XOR	A
  D85F                	_ERROR:
  D85F  A7            		AND	A
  D860  C9            		RET
                      	
  D861                	_SYS09:		;文字列出力
  D861  D5            		PUSH	DE
  D862                	_SX09:
  D862  1A            		LD	A,(DE)
  D863  13            		INC	DE
  D864  FE24          		CP	'$'
  D866  2831          		JR	Z,SX0E2
  D868  CDBCDB        		CALL	MSG_A
  D86B  18F5          		JR	_SX09
                      	
  D86D                	MSX1:
  D86D  CDBCDB        		CALL	MSG_A
  D870                	MSX:
  D870  7E            		LD	A,(HL)
  D871  23            		INC	HL
  D872  B7            		OR	A
  D873  20F8          		JR	NZ,MSX1
  D875  C9            		RET
                      	
  D876                	_SYS0C:		;(BDOS)バージョン番号の獲得
  D876  212200        		LD	HL,00022H
  D879  7D            		LD	A,L
  D87A  C9            		RET
                      	
  D87B                	_SYS0D:		;(BDOS)ディスクリセット
  D87B  CDDFF0        		CALL	_FFLUSH
  D87E  E5            		PUSH	HL
  D87F  218000        		LD	HL,00080H
  D882  228AF0        		LD	(_DTA),HL
  D885  E1            		POP	HL
  D886  D5            		PUSH	DE
  D887  1E00          		LD	E,0
  D889  3E            		DB	03EH
                      	
  D88A                	_SYS0E:		;(BDOS)カレントドライブの設定
  D88A  D5            		PUSH	DE
  D88B  7B            		LD	A,E
  D88C  DDE5          		PUSH	IX
  D88E  CDDCF0        		CALL	_GETDPB
  D891  DDE1          		POP	IX
  D893  3804          		JR	C,SX0E2
  D895  7B            		LD	A,E
  D896  3287F0        		LD	(_DVSW),A
  D899                	SX0E2:
  D899  D1            		POP	DE
  D89A  C9            		RET
                      	
  D89B                	_SYS0F:		;(BDOS)ファイルのオープン
  D89B  CD72E1        		CALL	SETDRV
  D89E  FD7E1C        		LD	A,(IY+28)	;(FCB)オープンモード
  D8A1  C602          		ADD	A,002H		;Write
  D8A3  2848          		JR	Z,FEND0F
  D8A5  CDC0E4        		CALL	CHKWILDX
                      	
  D8A8  D492E1        		CALL	NC,SOPENX
  D8AB                	_S16XX:
  D8AB  3840          		JR	C,FEND0F
                      					;Directory location
  D8AD  3A9FF0        		LD	A,(_FILEN)
  D8B0  FD7719        		LD	(IY+25),A	;(FCB)ディレクトリロケーション
                      	;				_DIRF
  D8B3  3AA0F0        		LD	A,(_DIRF)
  D8B6  FD771D        		LD	(IY+29),A	;(FCB)ディレクトリモード
                      	;				_FBPS
  D8B9  FD731E        		LD	(IY+30),E	;(FCB)ディレクトリポジション
  D8BC  FD721F        		LD	(IY+31),D
                      	;				Open(Read)
  D8BF  FD361CFF      		LD	(IY+28),0FFH	;(FCB)オープンモード
                      	;				FILENAME
  D8C3  FDE5          		PUSH	IY
  D8C5  D1            		POP	DE
  D8C6  13            		INC	DE
  D8C7  010B00        		LD	BC,11
  D8CA  EDB0          		LDIR
                      	;				Attribute
  D8CC  7E            		LD	A,(HL)
  D8CD  FD770D        		LD	(IY+13),A	;(FCB)属性(アトリビュート)
  D8D0  110B00        		LD	DE,11		;Reserved
  D8D3  19            		ADD	HL,DE
                      						;(FCB)ファイルを最後に変更した時刻
  D8D4  11EAF1        		LD	DE,SDDATA		;(FCB)ファイルを最後に変更した日付
  D8D7  060A          		LD	B,SDDATAE-SDDATA	;(FCB)ファイルの先頭クラスタ
  D8D9                	S16LOOP:				;(FCB)ファイルのサイズ(バイト単位)
  D8D9  1A            		LD	A,(DE)
  D8DA  13            		INC	DE
  D8DB  32E2D8        		LD	(S16PAT+2),A
  D8DE  7E            		LD	A,(HL)
  D8DF  23            		INC	HL
  D8E0  FD7700        	S16PAT:	LD	(IY+0),A
  D8E3  10F4          		DJNZ	S16LOOP
                      	
  D8E5  AF            		XOR	A
  D8E6  FD770C        		LD	(IY+12),A	;(FCB)カレントブロック
  D8E9  FD2291D9      		LD	(OFCB+1),IY
  D8ED                	FEND0F:
  D8ED  1845          		JR	FEND10
                      	
  D8EF                	_SYS10:		;(BDOS)ファイルのクローズ
  D8EF  CD72E1        		CALL	SETDRV
  D8F2  FD7E1C        		LD	A,(IY+28)	;(FCB)オープンモード
  D8F5  D6FE          		SUB	0FEH
  D8F7  37            		SCF
  D8F8  3F            		CCF
  D8F9  2039          		JR	NZ,FEND10
  D8FB                	_S10A:				;Write
  D8FB  FD770E        		LD	(IY+14),A	;(FCB)レコードサイズ/アクセスするディレクトリのクラスタ番号+1
  D8FE  FD770F        		LD	(IY+15),A
                      	
  D901  FD341C        		INC	(IY+28)		;0FEH->0FFH ;オープンモード
  D904  CDBCE5        		CALL	SETTMS
                      	
  D907  FD7E1D        		LD	A,(IY+29)	;(FCB)ディレクトリモード
  D90A  32A0F0        		LD	(_DIRF),A
  D90D  E67F          		AND	07FH
  D90F  32E7EA        		LD	(_SECPS+1),A
  D912  FD5E1E        		LD	E,(IY+30)	;(FCB)ディレクトリポジション
  D915  FD561F        		LD	D,(IY+31)
  D918  CDC6E2        		CALL	READ_DIR
  D91B  3817          		JR	C,FEND10
                      	
  D91D  3AF0E1        	SDECM1:	LD	A,(SDECPAT+1)	;1セクタ辺りのディレクトリエントリ数
  D920  3D            	 	DEC	A		;1024=01FH / 512=00FH / 256=7
  D921  FDA619        		AND	(IY+25)		;(FCB)ディレクトリロケーション
  D924  6F            		LD	L,A
  D925  2600          		LD	H,0
  D927  29            		ADD	HL,HL		;*2
  D928  29            		ADD	HL,HL		;*4
  D929  29            		ADD	HL,HL		;*8
  D92A  29            		ADD	HL,HL		;*16
  D92B  29            		ADD	HL,HL		;*32
  D92C  ED4B7EF1      		LD	BC,(_DTBUF)
  D930  09            		ADD	HL,BC
                      	
  D931  CDD0E4        		CALL	SDIRENT
  D934                	FEND10:
  D934  1842          		JR	FEND
                      	
  D936                	_SYS11:		;(BDOS)最初のファイルの検索
  D936  CD72E1        		CALL	SETDRV
  D939  CDBFE1        		CALL	SOPEN
  D93C                	_S12X1:
  D93C  383A          		JR	C,FEND
  D93E  CD5FE2        		CALL	SOPENE2
  D941  ED5B8AF0      		LD	DE,(_DTA)
  D945  3A88F0        		LD	A,(_DRV)
  D948  3C            		INC	A
  D949  12            		LD	(DE),A
  D94A  D5            		PUSH	DE
  D94B  13            		INC	DE
  D94C  012000        		LD	BC,32
  D94F  EDB0          		LDIR
  D951  FD6E0E        		LD	L,(IY+14)	;(FCB)レコードサイズ/アクセスするディレクトリのクラスタ番号+1
  D954  FD660F        		LD	H,(IY+15)
  D957  22F4F1        		LD	(SCDIR),HL
  D95A  2A9AF0        		LD	HL,(_FBPS)
  D95D  22F6F1        		LD	(SFBPS),HL
  D960  2A9FF0        		LD	HL,(_FILEN)
  D963  7C            		LD	A,H
  D964  B7            		OR	A
  D965  2806          		JR	Z,_S12DIR
  D967  3AE7EA        		LD	A,(_SECPS+1)
  D96A  F680          		OR	080H
  D96C  67            		LD	H,A
  D96D                	_S12DIR:
  D96D  22F8F1        		LD	(SFNDF),HL	;Directory position and Flags
  D970  E1            		POP	HL
  D971  1139F0        		LD	DE,SFILE
  D974  0E21          		LD	C,33
  D976                	_S11B:
  D976  EDB0          		LDIR
  D978                	FEND:
  D978  9F            		SBC	A,A		;CF=0 A=0 : CF=1 A=0FFH
  D979                	FENDE:
  D979  FDE1          		POP	IY
  D97B  C1            		POP	BC
  D97C  D1            		POP	DE
  D97D  E1            		POP	HL
  D97E  C9            		RET
                      	
  D97F                	_SYS12:		;(BDOS)次のファイルの検索
  D97F  E5            		PUSH	HL
  D980  D5            		PUSH	DE
  D981  C5            		PUSH	BC
  D982  FDE5          		PUSH	IY
  D984  CD23E2        		CALL	NOPEN
  D987  18B3          		JR	_S12X1
                      	
  D989                	_S16K:
  D989  FD7E1C        		LD	A,(IY+28)	;(FCB)オープンモード
  D98C  FEFD          		CP	0FDH		;Device(0FDH)
  D98E  37            		SCF
  D98F  C8            		RET	Z
                      	
  D990  110000        	OFCB:	LD	DE,0
  D993  D5            		PUSH	DE
  D994  061A          		LD	B,26		;First cluster
  D996                	S16K1:
  D996  13            		INC	DE
  D997  23            		INC	HL
  D998  10FC          		DJNZ	S16K1
                      	
  D99A  1A            		LD	A,(DE)
  D99B  BE            		CP	(HL)
  D99C  2013          		JR	NZ,S16K2
  D99E  13            		INC	DE
  D99F  23            		INC	HL
  D9A0  1A            		LD	A,(DE)
  D9A1  BE            		CP	(HL)
  D9A2  200D          		JR	NZ,S16K2
                      	
  D9A4  E1            		POP	HL
  D9A5  FDE5          		PUSH	IY
  D9A7  D1            		POP	DE
  D9A8  1A            		LD	A,(DE)		;Drive
  D9A9  BE            		CP	(HL)
  D9AA  2006          		JR	NZ,S16K3
                      					;ここはCFが必ず0
  D9AC  ED52          		SBC	HL,DE		;CP HL,DE
  D9AE  37            		SCF
  D9AF  C0            		RET	NZ
  D9B0  E5            		PUSH	HL
  D9B1                	S16K2:
  D9B1  E1            		POP	HL
  D9B2                	S16K3:
  D9B2  FDE5          		PUSH	IY
  D9B4  D1            		POP	DE
  D9B5                	_SYS13:		;(BDOS)ファイルの削除
  D9B5  CD72E1        		CALL	SETDRV
  D9B8  CDF0E3        		CALL	KILL
  D9BB                	FEND13:
  D9BB  18BB          		JR	FEND
                      	
  D9BD                	_SYS14:		;(BDOS)シーケンシャルな読み出し
  D9BD  CD72E1        		CALL	SETDRV
  D9C0  CD28E6        		CALL	INIT_SEQ
  D9C3                	SREAD:
  D9C3  CD70E6        		CALL	RB_READ
                      	
  D9C6  C601          		ADD	A,001H
  D9C8  38AE          		JR	C,FEND
                      	
  D9CA  7D            		LD	A,L
  D9CB  D601          		SUB	001H
  D9CD                	FENDX:
  D9CD  9F            		SBC	A,A
  D9CE  E603          		AND	3
  D9D0  1F            		RRA
  D9D1  18A6          		JR	FENDE
                      	
  D9D3                	_SYS15:		;(BDOS)シーケンシャルな書き込み
  D9D3  CD72E1        		CALL	SETDRV
  D9D6  CD28E6        		CALL	INIT_SEQ
  D9D9                	SWRITE:
  D9D9  CD69E6        		CALL	RB_WRITE
                      	
  D9DC  C6FF          		ADD	A,0FFH
  D9DE  18ED          		JR	FENDX
                      	
  D9E0                	_SYS17:		;(BDOS)ファイル名の変更
  D9E0  CD72E1        		CALL	SETDRV
  D9E3  CD46E4        		CALL	NAME
  D9E6  18D3          		JR	FEND13
                      	
  D9E8                	_SYS16:		;(BDOS)ファイルの作成
  D9E8  CD72E1        		CALL	SETDRV
                      	
  D9EB  CDC0E4        		CALL	CHKWILDX
  D9EE  38CB          		JR	C,FEND13
  D9F0  FD7E01        		LD	A,(IY+1)	;(FCB)主ファイル名
  D9F3  FE05          		CP	5
  D9F5  2805          		JR	Z,_S16X2
  D9F7  FE21          		CP	021H
  D9F9  DABBD9        		JP	C,FEND13
  D9FC                	_S16X2:
                      	;				Clear FCB
  D9FC  FDE5          		PUSH	IY
  D9FE  E1            		POP	HL
  D9FF  011000        		LD	BC,16
  DA02  09            		ADD	HL,BC
  DA03                	_S16X1:
  DA03  70            		LD	(HL),B		;B=0
  DA04  23            		INC	HL
  DA05  0D            		DEC	C
  DA06  20FB          		JR	NZ,_S16X1
                      	
  DA08  CDC1E5        		CALL	SETTMSX
  DA0B  FD360DFF      		LD	(IY+13),0FFH	;(FCB)Attribute
  DA0F  CD92E1        		CALL	SOPENX
  DA12  3F            		CCF
  DA13  CC89D9        		CALL	Z,_S16K
  DA16  D470E2        		CALL	NC,COPEN
  DA19  D4D0E4        		CALL	NC,SDIRENT
  DA1C  C3ABD8        		JP	_S16XX
                      	
  DA1F                	_SYS21:		;(BDOS)ランダムな読み出し
  DA1F  CD72E1        		CALL	SETDRV
  DA22  CD0CE6        		CALL	INIT_RND
  DA25  189C          		JR	SREAD
                      	
  DA27                	_SYS22:		;(BDOS)ランダムな書き込み
  DA27                	_SYS28:		;(BDOS)ランダムな書き込み・その2
  DA27  CD72E1        		CALL	SETDRV
  DA2A  CD0CE6        		CALL	INIT_RND
  DA2D  18AA          		JR	SWRITE
                      	
  DA2F                	_SYS18:		;(BDOS)ログインベクトルの獲得
  DA2F  21FF00        		LD	HL,000FFH
  DA32  AF            		XOR	A
  DA33  C9            		RET
                      	
  DA34                	_SYS19:		;(BDOS)カレントドライブ番号の獲得
  DA34  3A87F0        		LD	A,(_DVSW)
  DA37  A7            		AND	A
  DA38  C9            		RET
                      	
  DA39                	_SYS1A:		;(BDOS)DTAの設定
  DA39  ED538AF0      		LD	(_DTA),DE
  DA3D  AF            		XOR	A
  DA3E  C9            		RET
                      	
  DA3F                	_SYS1B:		;(BDOS)ディスク情報の獲得
  DA3F  7B            		LD	A,E
  DA40  CD85E1        		CALL	GETDRV
  DA43  CDDCF0        		CALL	_GETDPB
  DA46  D4E2F0        		CALL	NC,_RDFATX
  DA49  210000        		LD	HL,0
  DA4C  D49AE5        		CALL	NC,DSKF
                      	
  DA4F  ED5B9BE5      		LD	DE,(MAXCLP+1)	;DPB_08_MAXCL-1
  DA53  1B            		DEC	DE		;DE←クラスタの総数
  DA54  FD2A7CF1      		LD	IY,(_FATBF)	;IY←メモリ上のFATの先頭アドレス
  DA58  9F            		SBC	A,A
  DA59  D8            		RET	C
  DA5A  4F            		LD	C,A		;C=0
  DA5B  DD7E0F        		LD	A,(IX+00FH)	;DPB_0F_BPS
  DA5E  E60F          		AND	00FH
  DA60  47            		LD	B,A
  DA61  DD7E07        		LD	A,(IX+7)	;DPB_07_SECPCL
  DA64  C9            		RET
                      	
  DA65                	_SYS1D:		;(BDOS)書き込みが禁止されているディスクの調査
  DA65  AF            		XOR	A
  DA66  67            		LD	H,A
  DA67  6F            		LD	L,A
  DA68  C9            		RET
                      	
  DA69                	_SYS1F:		;(BDOS)ディスク装置のパラメータの読み出し
  DA69  2100F2        		LD	HL,DEVICE
  DA6C  7B            		LD	A,E
  DA6D  C3DCF0        		JP	_GETDPB
                      	
  DA70                	_SYS23:		;(BDOS)ファイルサイズの獲得
  DA70  E5            		PUSH	HL
  DA71  2A1EF1        		LD	HL,(STABLE+2*00FH)	;ファイルのオープン
  DA74  CD0F00        		CALL	JP_HL
  DA77  381B          		JR	C,_S23X1
                      	
  DA79  D5            		PUSH	DE		;EX DE,IY
  DA7A  FDE3          		EX	(SP),IY		;
                      	;	POP	DE		;
                      	;	PUSH	DE		;DEを破壊しないように注意vv
  DA7C  FD7E10        		LD	A,(IY+16)	;(FCB)ファイルのサイズ(バイト単位)
  DA7F  FD6E11        		LD	L,(IY+17)	;
  DA82  FD6612        		LD	H,(IY+18)	;
  DA85  C5            		PUSH	BC		;
  DA86  FD4613        		LD	B,(IY+19)	;
  DA89  CDFEE5        		CALL	GET_CPM_R_SIZE
  DA8C  C1            		POP	BC
  DA8D                	_S24X1:
  DA8D  CD1EE6        		CALL	SET_RR_AHL
                      	;	POP	DE		;^^^^^^^^^^^^^^^^^^^^^^^^
                      	;	PUSH	DE		;EX DE,IY
  DA90  FDE3          		EX	(SP),IY		;
  DA92  D1            		POP	DE		;
                      	
  DA93  AF            		XOR	A
  DA94                	_S23X1:
  DA94  E1            		POP	HL
  DA95  C9            		RET
                      	
  DA96                	_SYS24:		;(BDOS)ランダムレコードフィールドの設定
  DA96  E5            		PUSH	HL
  DA97  D5            		PUSH	DE		;EX DE,IY
  DA98  FDE3          		EX	(SP),IY		;
                      	;	POP	DE		;
                      	;	PUSH	DE		;DEを破壊しないように注意vv
  DA9A  CD30E6        		CALL	GETSEQ
  DA9D  18EE          		JR	_S24X1		;^^^^^^^^^^^^^^^^^^^^^^^^
                      	
  DA9F                	_SYS29:		;(BDOS)ファイル名の解析(_PPATH)
  DA9F  C5            		PUSH	BC
  DAA0  E5            		PUSH	HL
  DAA1  CD89E0        		CALL	FILE
  DAA4  E1            		POP	HL
  DAA5  C1            		POP	BC
  DAA6                	S29X1:
  DAA6  C5            		PUSH	BC
  DAA7  D5            		PUSH	DE
  DAA8  E5            		PUSH	HL
  DAA9  EB            		EX	DE,HL
  DAAA  AF            		XOR	A
  DAAB  3221F0        		LD	(FDRV+13),A
  DAAE  2114F0        		LD	HL,FDRV
  DAB1  011000        		LD	BC,16
  DAB4  EDB0          		LDIR
  DAB6  E1            		POP	HL
  DAB7  D1            		POP	DE
  DAB8  C1            		POP	BC
  DAB9  C9            		RET
                      	
  DABA                	_SYS30:		;(BDOS)論理セクタを用いた書き込み
  DABA  C5            		PUSH	BC
  DABB  0181EC        		LD	BC,DWT24B
  DABE  1804          		JR	S2FX
  DAC0                	_SYS2F:
  DAC0  C5            		PUSH	BC
  DAC1  0171EC        		LD	BC,DRD24B
  DAC4                	S2FX:
  DAC4  ED43DADA      		LD	(S2FPAT+1),BC
  DAC8  CDDFF0        		CALL	_FFLUSH
                      	
  DACB  D5            		PUSH	DE
  DACC  E5            		PUSH	HL
  DACD  7D            		LD	A,L		;Drive
  DACE  CDD9F0        		CALL	_CHGDRV
  DAD1  3809          		JR	C,S30X2
  DAD3  44            		LD	B,H		;Number of clusters
  DAD4  2A8AF0        		LD	HL,(_DTA)
                      	
  DAD7  0E00          		LD	C,0
  DAD9  CD71EC        	S2FPAT:	CALL	DRD24B
  DADC                	S30X2:
  DADC  E1            		POP	HL
  DADD  D1            		POP	DE
  DADE  C1            		POP	BC
  DADF  9F            		SBC	A,A
  DAE0  C9            		RET
                      	
  DAE1                	_SYS5A:		;(BDOS)カレントディレクトリの変更
  DAE1  C5            		PUSH	BC
  DAE2  D5            		PUSH	DE
  DAE3  E5            		PUSH	HL
  DAE4  CD7EE0        		CALL	FILEC
  DAE7  210000        		LD	HL,0
  DAEA  1114F0        		LD	DE,FDRV
  DAED  2A4EF1        		LD	HL,(STABLE+2*027H)	;ランダムブロック読み込み
  DAF0  CD0F00        		CALL	JP_HL
  DAF3  18E7          		JR	S30X2
                      	
                      	;X1IO.ASM
                      	
                      	;	LSX-Dodgers IO
                      	;	X1/turbo/Z
                      	
  D85F                	_SYS04	EQU	_ERROR		;(BDOS)外部出力
  D85F                	_SYS05	EQU	_ERROR		;(BDOS)プリンタ出力
  D85F                	_SYS1C	EQU	_ERROR		;(BDOS)ディスクの書き込み禁止化
  D85F                	_SYS1E	EQU	_ERROR		;(BDOS)ファイル属性の設定
  D85F                	_SYS20	EQU	_ERROR		;(BDOS)利用者番号の設定と読み出し
  D85F                	_SYS2E	EQU	_ERROR		;(BDOS)ベリファイ・フラグの設定
                      	
  DAF5                	BIOS:
  DAF5  E5            		PUSH	HL
  DAF6  211080        		LD	HL,08010H
  DAF9  39            		ADD	HL,SP
  DAFA  E1            		POP	HL
  DAFB  300E          		JR	NC,BIOS2
  DAFD                	BIOS1:
  DAFD  CD05DB        		CALL	BIOS3
  DB00  061E          		LD	B,01EH
  DB02  ED79          		OUT	(C),A
  DB04  C9            		RET
  DB05                	BIOS3:
  DB05  C5            		PUSH	BC
  DB06  061D          		LD	B,01DH
  DB08  ED79          		OUT	(C),A
  DB0A  C9            		RET
  DB0B                	BIOS2:
  DB0B  ED7316DB      		LD	(BIOS_SP),SP	;スタックがBIOS-ROMと被っている場合
  DB0F  31CAFF        		LD	SP,EXTSP
  DB12  CDFDDA        		CALL	BIOS1
  DB15  310000        		LD	SP,0
  DB16                	BIOS_SP	EQU	$-2
  DB18  C9            		RET
                      	
  DB19                	INT:
  DB19  F5            		PUSH	AF
  DB1A  E5            		PUSH	HL
  DB1B  C5            		PUSH	BC
                      	
  DB1C  CDC0DE        		CALL	IN49SB
  DB1F  67            		LD	H,A
  DB20  CDC0DE        		CALL	IN49SB
  DB23  6F            		LD	L,A
  DB24                	SCEXE:
  DB24  2292F0        		LD	(_KEYD),HL
  DB27  CD57DB        		CALL	KEYSET1
                      	
  DB2A  C1            		POP	BC
  DB2B                	INTPE:
  DB2B  E1            		POP	HL
  DB2C                	INTPE2:
  DB2C  F1            		POP	AF
  DB2D                	INTCTCE:
  DB2D  FB            		EI
  DB2E  ED4D          		RETI
                      	
  DB30                	INTCTC2:
  DB30  F5            		PUSH	AF
  DB31  3E00          	INTCPAT:LD	A,000H
  DB33  3D            		DEC	A
  DB34  3232DB        		LD	(INTCPAT+1),A
  DB37  20F3          		JR	NZ,INTPE2
                      	
  DB39  3A92F0        		LD	A,(_KEYD)
  DB3C  B7            		OR	A
  DB3D  28ED          		JR	Z,INTPE2
  DB3F                	KEYSET0:
  DB3F  E5            		PUSH	HL
  DB40  2A90F0        		LD	HL,(_KEYPS)
  DB43  7C            		LD	A,H
  DB44  AD            		XOR	L
  DB45  2006          		JR	NZ,INTC2A
                      	
  DB47  2A92F0        		LD	HL,(_KEYD)
  DB4A  CD8BDB        		CALL	KEYSET
  DB4D                	INTC2A:
  DB4D  3A94F0        		LD	A,(_KEYSP)
  DB50  E60F          		AND	00FH
  DB52  3232DB        		LD	(INTCPAT+1),A
                      	
  DB55  18D4          		JR	INTPE
                      	
  DB57                	KEYSET1:
  DB57  CB6C          		BIT	5,H
  DB59  F5            		PUSH	AF
  DB5A  ED4B8CF0      		LD	BC,(_CTC)
  DB5E  78            		LD	A,B
  DB5F  B1            		OR	C
  DB60  2006          		JR	NZ,KEYS10E
                      	
  DB62  F1            		POP	AF
  DB63  2026          		JR	NZ,KEYSET
  DB65  F5            		PUSH	AF
  DB66  18D7          		JR	KEYSET0
  DB68                	KEYS10E:
  DB68  F1            		POP	AF
  DB69  C8            		RET	Z
  DB6A  F5            		PUSH	AF
  DB6B  3E03          		LD	A,3		;CTC STOP
  DB6D  ED79          		OUT	(C),A
  DB6F  F1            		POP	AF
                      	
  DB70  B7            		OR	A
  DB71  C8            		RET	Z
                      	
  DB72  3EA7          		LD	A,0A7H
  DB74  ED79          		OUT	(C),A
  DB76  3A94F0        		LD	A,(_KEYSP)
  DB79  ED79          		OUT	(C),A
  DB7B  79            		LD	A,C
  DB7C  E6FC          		AND	0FCH
  DB7E  4F            		LD	C,A
  DB7F  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  DB81  3EC0          		LD	A,CTC0
  DB83  ED79          		OUT	(C),A
  DB85  3A95F0        		LD	A,(_KEYSP+1)
  DB88  3232DB        		LD	(INTCPAT+1),A
                      	
  DB8B                	KEYSET:
  DB8B  7D            		LD	A,L
  DB8C  CB74          		BIT	6,H
  DB8E  C0            		RET	NZ
  DB8F                	KEYBS:
  DB8F  B7            		OR	A
  DB90  C8            		RET	Z
  DB91                	KEYBS1:
  DB91  CDA9DB        		CALL	KEYBC_IFBREAK
  DB94  E5            		PUSH	HL
  DB95  F5            		PUSH	AF
  DB96  2A90F0        		LD	HL,(_KEYPS)
  DB99  2C            		INC	L
  DB9A  CBAD          		RES	5,L
  DB9C  7D            		LD	A,L
  DB9D  BC            		CP	H
  DB9E  2815          		JR	Z,POP_AF_HL_SCF_RET
  DBA0  3290F0        		LD	(_KEYPS),A
  DBA3  26FF          		LD	H,KEYBF/256
  DBA5  F1            		POP	AF
  DBA6  77            		LD	(HL),A
  DBA7  E1            		POP	HL
  DBA8  C9            		RET
  DBA9                	KEYBC_IFBREAK:
  DBA9  FE03          		CP	3
  DBAB  C0            		RET	NZ
  DBAC                	KEYBC:
  DBAC  E5            		PUSH	HL
  DBAD  210000        		LD	HL,0
  DBB0  2290F0        		LD	(_KEYPS),HL
  DBB3  E1            		POP	HL
  DBB4  C9            		RET
                      	
  DBB5                	POP_AF_HL_SCF_RET:
  DBB5  F1            		POP	AF
  DBB6  E1            		POP	HL
  DBB7  37            		SCF
  DBB8  C9            		RET
                      	
  DBB9                	_SYS01:		;(BDOS)コンソール入力
  DBB9  CD09F0        		CALL	_SYS07
  DBBC                	MSG_A:
  DBBC  F5            		PUSH	AF
  DBBD  D5            		PUSH	DE
  DBBE  5F            		LD	E,A
  DBBF  CDC5DB        		CALL	_SYS02
  DBC2  D1            		POP	DE
  DBC3  F1            		POP	AF
  DBC4  C9            		RET
                      	
  DBC5                	_SYS02:		;(BDOS)コンソール出力
  DBC5  CDD7DB        		CALL	BREAK
  DBC8  1805          		JR	PRINTX
                      	
  DBCA                	_SYS06:		;(BDOS)コンソール直接入出力
  DBCA  7B            		LD	A,E
  DBCB  3C            		INC	A
  DBCC  CACAF0        		JP	Z,_INKEY
  DBCF                	PRINTX:
  DBCF  C3CDF0        		JP	_PRINT
                      	
  DBD2                	_SYS08:		;(BDOS)エコーなしコンソール入力
  DBD2  CD09F0        		CALL	_SYS07
  DBD5  1804          		JR	BREAK1
  DBD7                	BREAK:
  DBD7  FB            		EI
  DBD8  3A92F0        		LD	A,(_KEYD)
  DBDB                	BREAK1:
  DBDB  FE03          		CP	3		;CTRL+C
  DBDD  CCF4F0        		CALL	Z,_BREAK
  DBE0  FE13          		CP	013H		;CTRL+S
  DBE2  C0            		RET	NZ
                      	
  DBE3                	PAUSE:
  DBE3  CDACDB        		CALL	KEYBC
                      	
  DBE6                	FLGET:
  DBE6  CDDFF0        		CALL	_FFLUSH
  DBE9  C5            		PUSH	BC
  DBEA  E5            		PUSH	HL
  DBEB  ED4B8EF0      		LD	BC,(_TXADR)
  DBEF  CBE8          		SET	5,B
  DBF1  ED60          		IN	H,(C)
  DBF3                	FLGET1:
  DBF3  3A93F0        		LD	A,(_KEYD+1)
  DBF6  0F            		RRCA
  DBF7  0F            		RRCA
  DBF8  E610          		AND	010H
  DBFA  F608          		OR	8
  DBFC  ED68          		IN	L,(C)
  DBFE  B5            		OR	L
  DBFF  ED79          		OUT	(C),A
  DC01  CDCAF0        		CALL	_INKEY
  DC04  28ED          		JR	Z,FLGET1
  DC06  ED61          		OUT	(C),H
  DC08  E1            		POP	HL
  DC09  C1            		POP	BC
  DC0A  C9            		RET
                      	
  DC0B                	_SYS0A:		;(BDOS)文字列入力
  DC0B  C5            		PUSH	BC
  DC0C  E5            		PUSH	HL
  DC0D  D5            		PUSH	DE
  DC0E  CD0DE0        		CALL	GETL
  DC11  1120FF        		LD	DE,KBUF
  DC14  E1            		POP	HL
  DC15  E5            		PUSH	HL
  DC16  0E00          		LD	C,0
  DC18  3004          		JR	NC,SAX0
  DC1A  23            		INC	HL
  DC1B  23            		INC	HL
  DC1C  1808          		JR	SAX4
  DC1E                	SAX0:
  DC1E  46            		LD	B,(HL)
  DC1F  23            		INC	HL
  DC20                	SAX1:
  DC20  23            		INC	HL
  DC21  1A            		LD	A,(DE)
  DC22  13            		INC	DE
  DC23  B7            		OR	A
  DC24  2004          		JR	NZ,SAX2
  DC26                	SAX4:
  DC26  360D          		LD	(HL),00DH
  DC28  1804          		JR	SAX3
  DC2A                	SAX2:
  DC2A  77            		LD	(HL),A
  DC2B  0C            		INC	C
  DC2C  10F2          		DJNZ	SAX1
  DC2E                	SAX3:
  DC2E  D1            		POP	DE
  DC2F  79            		LD	A,C
  DC30  13            		INC	DE
  DC31  12            		LD	(DE),A
  DC32  1B            		DEC	DE
  DC33  E1            		POP	HL
  DC34  C1            		POP	BC
  DC35  A7            		AND	A
  DC36  C9            		RET
                      	
  DC37                	_SYS0B:		;(BDOS)コンソール状態のチェック
  DC37  CDD7DB        		CALL	BREAK
  DC3A  3A92F0        		LD	A,(_KEYD)
  DC3D  B7            		OR	A
  DC3E  C8            		RET	Z
  DC3F                	CONSTX:
  DC3F  CDDFF0        		CALL	_FFLUSH
  DC42  E5            		PUSH	HL
  DC43  2A90F0        		LD	HL,(_KEYPS)
  DC46  7C            		LD	A,H
  DC47  AD            		XOR	L
  DC48  E1            		POP	HL
  DC49  C6FF          		ADD	A,0FFH
  DC4B  9F            		SBC	A,A
  DC4C  C9            		RET
                      	
  DC4D                	_SYS2A:		;(BDOS)日付の獲得
  DC4D  C5            		PUSH	BC
  DC4E  3EED          		LD	A,0EDH		;Read calendar
  DC50  CDDBDE        		CALL	COMOUT
  DC53  CD85DC        		CALL	IN49SB_BCD	;YY
  DC56  6F            		LD	L,A
  DC57  2600          		LD	H,0
                      	;	LD	DE,1900		;0076CH
                      	;	CP	90		;90以上は1900年代 1990-1999
                      	;	JR	NC,RDDATE1	;90未満は2000年代 2000-2089
                      	;	LD	E,0D0H		;2000 & 0FFH D=007H
  DC59  11D007        		LD	DE,2000		;すべて2000年代で処理 2000-2099
  DC5C                	RDDATE1:
  DC5C  19            		ADD	HL,DE
  DC5D  CDC0DE        		CALL	IN49SB		;MW
  DC60  57            		LD	D,A
  DC61  CD85DC        		CALL	IN49SB_BCD	;DD
  DC64  5F            		LD	E,A
  DC65  7A            		LD	A,D
  DC66  0604          		LD	B,4
  DC68                	RDDATE2:
  DC68  CB3A          		SRL	D
  DC6A  10FC          		DJNZ	RDDATE2
  DC6C  C1            		POP	BC
  DC6D  E607          		AND	7
  DC6F  C9            		RET
                      	
  DC70                	_SYS2C:		;(BDOS)時刻の獲得
  DC70  C5            		PUSH	BC
  DC71  3EEF          		LD	A,0EFH		;Read time
  DC73  CDDBDE        		CALL	COMOUT
  DC76  CD85DC        		CALL	IN49SB_BCD	;TT
  DC79  67            		LD	H,A
  DC7A  CD85DC        		CALL	IN49SB_BCD	;MM
  DC7D  6F            		LD	L,A
  DC7E  CD85DC        		CALL	IN49SB_BCD	;SS
  DC81  57            		LD	D,A
  DC82  C1            		POP	BC
  DC83  AF            		XOR	A
  DC84  C9            		RET
                      	
  DC85                	IN49SB_BCD:
  DC85  CDC0DE        		CALL	IN49SB
                      	;------------------------
                      	;BCDの10進数化
                      	;in
                      	;	A  : BCD
                      	;out
                      	;	A  : 10進数
                      	;------------------------
  DC88  4F            		LD	C,A
  DC89  E6F0          		AND	0F0H	;10の位
  DC8B  0F            		RRCA
  DC8C  47            		LD	B,A
  DC8D  0F            		RRCA
  DC8E  0F            		RRCA
  DC8F  80            		ADD	A,B
  DC90  47            		LD	B,A
  DC91  79            		LD	A,C
  DC92  E60F          		AND	00FH	;1の位
  DC94  80            		ADD	A,B
  DC95  C9            		RET
                      	
  DC96                	ESC1:
  DC96  7B            		LD	A,E
  DC97  FE41          		CP	'A'
  DC99  CADEDD        		JP	Z,CTRL1E
  DC9C  FE42          		CP	'B'
  DC9E  CA46DF        		JP	Z,CTRL1F
  DCA1  FE43          		CP	'C'
  DCA3  CAE9DD        		JP	Z,CTRL1C
  DCA6  FE44          		CP	'D'
  DCA8  CAD5DD        		JP	Z,CTRL1D
  DCAB  FE45          		CP	'E'
  DCAD  2802          		JR	Z,CT0CX
  DCAF  FE6A          		CP	'j'
  DCB1                	CT0CX:
  DCB1  CA19DF        		JP	Z,CTRL0C
  DCB4  FE48          		CP	'H'
  DCB6  CA63DE        		JP	Z,CTRL0B
  DCB9  FE4A          		CP	'J'
  DCBB  CA1CDF        		JP	Z,CTRL06
  DCBE  FE4B          		CP	'K'
  DCC0  2807          		JR	Z,CT05X
  DCC2  FE4C          		CP	'L'
  DCC4  CA5BDF        		JP	Z,CTRL0E
  DCC7  FE54          		CP	'T'
  DCC9                	CT05X:
  DCC9  CA22DE        		JP	Z,CTRL05
  DCCC  FE78          		CP	'x'
  DCCE  2804          		JR	Z,ESC1X
  DCD0  FE79          		CP	'y'
  DCD2  2002          		JR	NZ,ESC1Y
  DCD4                	ESC1X:
  DCD4  3601          		LD	(HL),1
  DCD6                	ESC1Y:
  DCD6  FE3D          		CP	'='
  DCD8  2804          		JR	Z,ESC1W
  DCDA  FE59          		CP	'Y'
  DCDC  2002          		JR	NZ,ESC1Z
  DCDE                	ESC1W:
  DCDE  3602          		LD	(HL),2
  DCE0                	ESC1Z:
  DCE0  FE20          		CP	020H
  DCE2  3802          		JR	C,ESC1C
  DCE4  87            		ADD	A,A
  DCE5  D0            		RET	NC
  DCE6                	ESC1C:
  DCE6  E1            		POP	HL
  DCE7                	ANK:
  DCE7  ED4B8EF0      		LD	BC,(_TXADR)
  DCEB  78            		LD	A,B
  DCEC  F638          		OR	038H
  DCEE  47            		LD	B,A
  DCEF  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令	kanji
  DCF1  CB98          		RES	3,B
  DCF3  ED59          		OUT	(C),E		;Text
  DCF5                	KANJIE:
  DCF5  CDAADD        		CALL	PRINTE7
  DCF8                	PRINTE5:
  DCF8  E1            		POP	HL
  DCF9  C1            		POP	BC
  DCFA  AF            		XOR	A
  DCFB  C9            		RET
                      	
  DCFC                	ESC:
  DCFC  21F8DC        		LD	HL,PRINTE5
  DCFF  E5            		PUSH	HL
  DD00  2122DD        		LD	HL,ESCFLG+1
  DD03  3600          		LD	(HL),0
  DD05  3D            		DEC	A
  DD06  288E          		JR	Z,ESC1
  DD08  3D            		DEC	A
  DD09  2009          		JR	NZ,ESC2
  DD0B  3603          		LD	(HL),3
  DD0D  7B            		LD	A,E
  DD0E  D620          		SUB	020H
  DD10  3217DD        		LD	(ESCYP+1),A
  DD13  C9            		RET
  DD14                	ESC2:
  DD14  3D            		DEC	A
  DD15  C0            		RET	NZ
  DD16  2600          	ESCYP:	LD	H,0
  DD18  7B            		LD	A,E
  DD19  D620          		SUB	020H
  DD1B  6F            		LD	L,A
  DD1C  C3D6F0        		JP	_LOC
                      	
  DD1F                	PRINT:
  DD1F  C5            		PUSH	BC
  DD20  E5            		PUSH	HL
  DD21  3E00          	ESCFLG:	LD	A,000H
  DD23  B7            		OR	A
  DD24  20D6          		JR	NZ,ESC
                      	
  DD26  3E1F          		LD	A,01FH
  DD28  BB            		CP	E
  DD29  3020          		JR	NC,CTRL
  DD2B  01E4DE        	INSFLG:	LD	BC,INSERT
                      	
  DD2E  3A1800        		LD	A,(00018H)
  DD31  3C            		INC	A
  DD32  28B3          		JR	Z,ANK
  DD34  3E00          	KANFLG:	LD	A,000H
  DD36  B7            		OR	A
  DD37  2025          		JR	NZ,KANJI2
  DD39  7B            		LD	A,E
  DD3A  FE80          		CP	080H
  DD3C  38A9          		JR	C,ANK
  DD3E  FEA0          		CP	0A0H
  DD40  3804          		JR	C,KANJI1
  DD42  FEE0          		CP	0E0H
  DD44  38A1          		JR	C,ANK
  DD46                	KANJI1:
  DD46  3235DD        		LD	(KANFLG+1),A
  DD49  18AD          		JR	PRINTE5
                      	
  DD4B                	CTRL:
  DD4B  CD91DD        		CALL	KANCLR
  DD4E  7B            		LD	A,E
  DD4F  87            		ADD	A,A
  DD50  F680          		OR	080H
  DD52  6F            		LD	L,A
  DD53  26F1          		LD	H,CTRLTB/256
  DD55  7E            		LD	A,(HL)
  DD56  2C            		INC	L
  DD57  66            		LD	H,(HL)
  DD58  6F            		LD	L,A
  DD59  CD0F00        		CALL	JP_HL
  DD5C  189A          		JR	PRINTE5
                      	
  DD5E                	KANJI2:
  DD5E  D5            		PUSH	DE
  DD5F  57            		LD	D,A
  DD60  01812F        		LD	BC,02F81H	;SFTJIS
  DD63  DF            		RST	018H
  DD64  01C32F        		LD	BC,02FC3H	;Instead or JISVRM
  DD67  DF            		RST	018H
                      	
  DD68  ED4B8EF0      		LD	BC,(_TXADR)
  DD6C  78            		LD	A,B
  DD6D  F638          		OR	038H
  DD6F  47            		LD	B,A
  DD70  ED51          		OUT	(C),D		;kanji
  DD72  CB98          		RES	3,B
  DD74  ED59          		OUT	(C),E		;Text
  DD76  CDAADD        		CALL	PRINTE7
  DD79  ED4B8EF0      		LD	BC,(_TXADR)
  DD7D  78            		LD	A,B
  DD7E  F638          		OR	038H
  DD80  47            		LD	B,A
  DD81  CBF2          		SET	6,D
  DD83  ED51          		OUT	(C),D		;Kanji
  DD85  CB98          		RES	3,B
  DD87  ED59          		OUT	(C),E		;Text
  DD89  D1            		POP	DE
  DD8A  AF            		XOR	A
  DD8B  3235DD        		LD	(KANFLG+1),A
  DD8E  C3F5DC        		JP	KANJIE
                      	
  DD91                	KANCLR:
  DD91  3A35DD        		LD	A,(KANFLG+1)
  DD94  B7            		OR	A
  DD95  C8            		RET	Z
  DD96  ED4B8EF0      		LD	BC,(_TXADR)
  DD9A  78            		LD	A,B
  DD9B  F638          		OR	038H
  DD9D  47            		LD	B,A
  DD9E  AF            		XOR	A
  DD9F  3235DD        		LD	(KANFLG+1),A
  DDA2  ED79          		OUT	(C),A		;Kanji
  DDA4  CB98          		RES	3,B
  DDA6  3E20          		LD	A,020H
  DDA8  ED79          		OUT	(C),A		;Text
  DDAA                	PRINTE7:
  DDAA  CBA0          		RES	4,B
  DDAC                	PRINTE6:
  DDAC  3A96F0        		LD	A,(_COLORF)
  DDAF                	PRINTE4:
  DDAF  ED79          		OUT	(C),A		;Color
  DDB1  78            		LD	A,B
  DDB2  E607          		AND	7
  DDB4  47            		LD	B,A
  DDB5                	PRINTE2:
  DDB5  03            		INC	BC
  DDB6                	PRINTE3:
  DDB6  2ABAF0        		LD	HL,(_PAGE_MINUS)
  DDB9  A7            		AND	A
  DDBA  ED4A          		ADC	HL,BC
  DDBC                	PRINTE8:
  DDBC  2805          		JR	Z,PRINT2
  DDBE  ED438EF0      		LD	(_TXADR),BC
  DDC2                	CTRL00:
  DDC2  C9            		RET
                      	
  DDC3                	PRINT2:
  DDC3  CD61DF        		CALL	SCR
  DDC6  2ABCF0        		LD	HL,(_WIDTH_MINUS)
  DDC9  09            		ADD	HL,BC
  DDCA                	SET_TXADR_HL:
  DDCA  228EF0        		LD	(_TXADR),HL
  DDCD  C9            		RET
                      	
  DDCE                	CTRL08:
  DDCE  3A2BDD        		LD	A,(INSFLG)
  DDD1  FECD          		CP	0CDH		;CALL ????
  DDD3  2829          		JR	Z,CTRL02
  DDD5                	CTRL1D:
  DDD5  2A8EF0        		LD	HL,(_TXADR)
  DDD8  7C            		LD	A,H
  DDD9  B5            		OR	L
  DDDA  C8            		RET	Z
  DDDB  2B            		DEC	HL
  DDDC  18EC          		JR	SET_TXADR_HL
                      	
  DDDE                	CTRL1E:
  DDDE  ED4B8EF0      		LD	BC,(_TXADR)
  DDE2  2ABCF0        		LD	HL,(_WIDTH_MINUS)
  DDE5  09            		ADD	HL,BC
  DDE6  D0            		RET	NC
  DDE7  18E1          		JR	SET_TXADR_HL
                      	
  DDE9                	CTRL1C:
  DDE9  ED4B8EF0      		LD	BC,(_TXADR)
  DDED  18C6          		JR	PRINTE2
                      	
  DDEF                	CTRL09:
  DDEF  ED4B8EF0      		LD	BC,(_TXADR)
  DDF3  79            		LD	A,C
  DDF4  E6F8          		AND	0F8H
  DDF6  C608          		ADD	A,8
  DDF8  4F            		LD	C,A
  DDF9  88            		ADC	A,B
  DDFA  91            		SUB	C
  DDFB  47            		LD	B,A
  DDFC  18B8          		JR	PRINTE3
                      	
  DDFE                	CTRL02:
  DDFE  CDD5DD        		CALL	CTRL1D
  DE01  C8            		RET	Z
  DE02  D5            		PUSH	DE
  DE03  CDD3F0        		CALL	_POS
  DE06  3AB1F0        		LD	A,(_WIDTH)
  DE09  95            		SUB	L
  DE0A  4F            		LD	C,A
  DE0B  0D            		DEC	C
  DE0C  0638          		LD	B,038H
  DE0E  2A8EF0        		LD	HL,(_TXADR)
  DE11  09            		ADD	HL,BC
  DE12  44            		LD	B,H
  DE13  4D            		LD	C,L
  DE14  110020        		LD	DE,02000H	;D:Text E:kanji
  DE17  2A96F0        		LD	HL,(_COLORF)	;L:Color
  DE1A                	C8X1:
  DE1A  CD00DF        		CALL	C12S
  DE1D  0B            		DEC	BC
  DE1E  20FA          		JR	NZ,C8X1
  DE20  D1            		POP	DE
  DE21  C9            		RET
                      	
  DE22                	CTRL05:
  DE22  CDD3F0        		CALL	_POS
  DE25  3AB1F0        		LD	A,(_WIDTH)
  DE28  95            		SUB	L
  DE29  6F            		LD	L,A
  DE2A                	C08X1:
  DE2A  ED4B8EF0      		LD	BC,(_TXADR)
  DE2E                	LINECL:
  DE2E  2620          		LD	H,020H
  DE30  3A96F0        		LD	A,(_COLORF)
  DE33  CBE8          		SET	5,B
  DE35                	LINECL1:
  DE35  CBD8          		SET	3,B
  DE37  CBE0          		SET	4,B
  DE39  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令	kanji
  DE3B  CB98          		RES	3,B
  DE3D  ED61          		OUT	(C),H		;Text
  DE3F  CBA0          		RES	4,B
  DE41  ED79          		OUT	(C),A		;Color
  DE43  03            		INC	BC
  DE44  2D            		DEC	L
  DE45  20EE          		JR	NZ,LINECL1
  DE47  C9            		RET
                      	
  DE48                	CTRL0D:
  DE48  CDD3F0        		CALL	_POS
  DE4B  2E00          		LD	L,0
  DE4D                	LOC:
  DE4D  C5            		PUSH	BC
  DE4E  E5            		PUSH	HL
  DE4F  CD91DD        		CALL	KANCLR
  DE52  CD70DE        		CALL	LOC1
  DE55  228EF0        		LD	(_TXADR),HL
  DE58  E1            		POP	HL
  DE59  C1            		POP	BC
  DE5A  C9            		RET
                      	
  DE5B                	CTRL12:
  DE5B  212BDD        		LD	HL,INSFLG
  DE5E  7E            		LD	A,(HL)
  DE5F  EECC          		XOR	0CCH		;CD:CALL ???? 1:LD BC,????
  DE61  77            		LD	(HL),A
  DE62  C9            		RET
                      	
  DE63                	CTRL0B:
  DE63  210000        		LD	HL,0
  DE66  228EF0        		LD	(_TXADR),HL
  DE69  C9            		RET
                      	
  DE6A                	CTRL1B:
  DE6A  3E01          		LD	A,1
  DE6C  3222DD        		LD	(ESCFLG+1),A
  DE6F  C9            		RET
                      	
  DE70                	LOC1:
  DE70  D5            		PUSH	DE
  DE71  4D            		LD	C,L
  DE72  0608          		LD	B,8
  DE74  5C            		LD	E,H
  DE75  1600          		LD	D,0
  DE77  2AB0F0        		LD	HL,(CRTCD)
  DE7A  6A            		LD	L,D
  DE7B                	LOC2:
  DE7B  29            		ADD	HL,HL
  DE7C  3001          		JR	NC,LOC3
  DE7E  19            		ADD	HL,DE
  DE7F                	LOC3:
  DE7F  10FA          		DJNZ	LOC2
  DE81  09            		ADD	HL,BC
  DE82  D1            		POP	DE
  DE83  C9            		RET
                      	
  DE84                	CONOUT1:
  DE84  CD96DE        		CALL	CURSOR
  DE87  59            		LD	E,C
  DE88  CDCDF0        		CALL	_PRINT
  DE8B  7B            		LD	A,E
  DE8C  FE0A          		CP	00AH
  DE8E  2006          		JR	NZ,CURSOR
  DE90  CD48DE        		CALL	CTRL0D
  DE93  CD22DE        		CALL	CTRL05
  DE96                	CURSOR:
  DE96  C5            		PUSH	BC
  DE97  ED4B8EF0      		LD	BC,(_TXADR)
  DE9B  CBE8          		SET	5,B
  DE9D  ED78          		IN	A,(C)
  DE9F  EE18          		XOR	018H
  DEA1  ED79          		OUT	(C),A
  DEA3  C1            		POP	BC
  DEA4  C9            		RET
                      	
  DEA5                	CTRL07:
  DEA5  2161F0        		LD	HL,BEEPD
  DEA8                	BEEP1:
  DEA8  7E            		LD	A,(HL)
  DEA9  23            		INC	HL
  DEAA  FEFF          		CP	0FFH
  DEAC  C8            		RET	Z
  DEAD  061C          		LD	B,01CH
  DEAF  ED79          		OUT	(C),A
  DEB1  EDA3          		OUTI
  DEB3  18F3          		JR	BEEP1
                      	
  DEB5                	OT49SB:
  DEB5  C5            		PUSH	BC
  DEB6  CDD1DE        		CALL	CANW
  DEB9  010019        		LD	BC,01900H
  DEBC  ED79          		OUT	(C),A
  DEBE  C1            		POP	BC
  DEBF  C9            		RET
                      	
  DEC0                	IN49SB:
  DEC0  C5            		PUSH	BC
  DEC1  01011A        		LD	BC,01A01H
  DEC4                	CANR:
  DEC4  ED78          		IN	A,(C)
  DEC6  E620          		AND	020H
  DEC8  20FA          		JR	NZ,CANR
  DECA  010019        		LD	BC,01900H
  DECD  ED78          		IN	A,(C)
  DECF  C1            		POP	BC
  DED0  C9            		RET
                      	
  DED1                	CANW:
  DED1  01011A        		LD	BC,01A01H
  DED4  ED48          		IN	C,(C)
  DED6  CB71          		BIT	6,C
  DED8  20F7          		JR	NZ,CANW
  DEDA  C9            		RET
                      	
  DEDB                	COMOUT:
  DEDB  FB            		EI
  DEDC  CDB5DE        		CALL	OT49SB
  DEDF  CDD1DE        		CALL	CANW
  DEE2  F3            		DI
  DEE3  C9            		RET
                      	
  DEE4                	INSERT:
  DEE4  D5            		PUSH	DE
  DEE5  CDD3F0        		CALL	_POS
  DEE8  3AB1F0        		LD	A,(_WIDTH)
  DEEB  95            		SUB	L
  DEEC  ED4B8EF0      		LD	BC,(_TXADR)
  DEF0  110020        		LD	DE,02000H	;D:Text E:Kanji
  DEF3  2A96F0        		LD	HL,(_COLORF)	;L:Color
  DEF6  CBE8          		SET	5,B
  DEF8                	C12X1:
  DEF8  CD00DF        		CALL	C12S
  DEFB  03            		INC	BC
  DEFC  20FA          		JR	NZ,C12X1
  DEFE  D1            		POP	DE
  DEFF  C9            		RET
                      	
  DF00                	C12S:
  DF00  CBE0          		SET	4,B
  DF02  CBD8          		SET	3,B
  DF04  ED60          		IN	H,(C)
  DF06  ED59          	X1PAT:	OUT	(C),E
  DF08  5C            		LD	E,H
  DF09  CB98          		RES	3,B
  DF0B  ED60          		IN	H,(C)
  DF0D  ED51          		OUT	(C),D
  DF0F  54            		LD	D,H
  DF10  CBA0          		RES	4,B
  DF12  ED60          		IN	H,(C)
  DF14  ED69          		OUT	(C),L
  DF16  6C            		LD	L,H
  DF17  3D            		DEC	A
  DF18  C9            		RET
                      	
  DF19                	CTRL0C:
  DF19  CD63DE        		CALL	CTRL0B
  DF1C                	CTRL06:
  DF1C  ED4B8EF0      		LD	BC,(_TXADR)
  DF20                	C1AX1:
  DF20  78            		LD	A,B
  DF21  F638          		OR	038H
  DF23  47            		LD	B,A
  DF24  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令	kanji
  DF26  CB98          		RES	3,B
  DF28  3E20          		LD	A,020H
  DF2A  ED79          		OUT	(C),A		;Text
  DF2C  CBA0          		RES	4,B
  DF2E  3A96F0        		LD	A,(_COLORF)
  DF31  ED79          		OUT	(C),A		;Color
  DF33  03            		INC	BC
  DF34  CBA8          		RES	5,B
  DF36  2ABAF0        		LD	HL,(_PAGE_MINUS)
  DF39  09            		ADD	HL,BC
  DF3A  30E4          		JR	NC,C1AX1
  DF3C  C9            		RET
                      	
  DF3D                	CTRL04:
  DF3D  CDD3F0        		CALL	_POS
  DF40  7D            		LD	A,L
  DF41  B7            		OR	A
  DF42  C8            		RET	Z
  DF43                	CTRL03:
  DF43  CD48DE        		CALL	CTRL0D
  DF46                	CTRL0A:
  DF46                	CTRL1F:
  DF46  ED4B8EF0      		LD	BC,(_TXADR)
  DF4A  2AB1F0        		LD	HL,(_WIDTH)
  DF4D  2600          		LD	H,0
  DF4F  09            		ADD	HL,BC
  DF50  44            		LD	B,H
  DF51  4D            		LD	C,L
  DF52  2ABAF0        		LD	HL,(_PAGE_MINUS)
  DF55  09            		ADD	HL,BC
  DF56  3F            		CCF
  DF57  9F            		SBC	A,A
  DF58  C3BCDD        		JP	PRINTE8
                      	
  DF5B                	CTRL0E:
  DF5B  CDD3F0        		CALL	_POS
  DF5E  7C            		LD	A,H
  DF5F  1804          		JR	SCR1
  DF61                	SCR:
  DF61  3A97F0        		LD	A,(_LINE)
  DF64  3D            		DEC	A
  DF65                	SCR1:
  DF65  C5            		PUSH	BC
  DF66  D5            		PUSH	DE
  DF67  F5            		PUSH	AF
  DF68  3E07          		LD	A,7
  DF6A  219BDF        		LD	HL,SCRDMAD
  DF6D  CD91DF        		CALL	SETDMA
  DF70  F1            		POP	AF
  DF71  210038        		LD	HL,03800H
                      	
  DF74                	SCRUP1:
  DF74  B7            		OR	A
  DF75  284D          		JR	Z,SCRCL
  DF77  F5            		PUSH	AF
  DF78  CDA2DF        		CALL	UPSUB		;kanji
  DF7B  3ABCF0        		LD	A,(_WIDTH_MINUS)
  DF7E  5F            		LD	E,A
  DF7F  16F7          		LD	D,0F7H
  DF81  19            		ADD	HL,DE
  DF82  D5            		PUSH	DE
  DF83  CDA2DF        		CALL	UPSUB		;Text
  DF86  D1            		POP	DE
  DF87  19            		ADD	HL,DE
  DF88  CDA2DF        		CALL	UPSUB		;Color
  DF8B  CBE4          		SET	4,H
  DF8D  F1            		POP	AF
  DF8E  3D            		DEC	A
  DF8F  18E3          		JR	SCRUP1
                      	
  DF91                	SETDMA:
  DF91  01871F        		LD	BC,01F87H
  DF94                	SDMA:
  DF94  04            		INC	B
  DF95  EDA3          		OUTI
  DF97  3D            		DEC	A
  DF98  20FA          		JR	NZ,SDMA
  DF9A  C9            		RET
                      	
  DF9B                	SCRDMAD:
  DF9B  C3            		DB	0C3H		;WR6 リセット
  DF9C  9A            		DB	09AH		;WR5 ストップ WAIT READY:HIGH
  DF9D  65            		DB	065H		;WR0 ブロック長(LH)
  DF9E  4F00          		DW	79
  DFA0  1C            		DB	01CH		;WR1 ポートAインクリメント I/O
  DFA1  18            		DB	018H		;WR0 ポートAアドレス(LH)
                      	
  DFA2                	UPSUB:
  DFA2  3AB1F0        		LD	A,(_WIDTH)
  DFA5  5F            		LD	E,A
  DFA6  1600          		LD	D,0
  DFA8  3ECD          		LD	A,0CDH		;WR4 バースト ポートB開始アドレス(LH)
  DFAA  ED79          		OUT	(C),A
  DFAC  ED69          		OUT	(C),L		;SOURCE
  DFAE  ED61          		OUT	(C),H
  DFB0  19            		ADD	HL,DE
  DFB1  3E1D          		LD	A,01DH		;WR0 ポートA開始アドレス(LH) ポートA→ポートB 転送
  DFB3  ED79          		OUT	(C),A
  DFB5  ED69          		OUT	(C),L		;DEST
  DFB7  ED61          		OUT	(C),H
  DFB9                	GO_DMA:
  DFB9  3ECF          		LD	A,0CFH
  DFBB  ED79          		OUT	(C),A		;WR6 ロード
  DFBD  3EB3          		LD	A,0B3H
  DFBF  ED79          		OUT	(C),A		;WR6 強制RDY
  DFC1  ED49          		OUT	(C),C		;WR6 イネーブル
  DFC3  C9            		RET
                      	
  DFC4                	SCRCL:
  DFC4  44            		LD	B,H
  DFC5  4D            		LD	C,L
  DFC6  2AB1F0        		LD	HL,(_WIDTH)
  DFC9  CD2EDE        		CALL	LINECL
  DFCC  D1            		POP	DE
  DFCD  C1            		POP	BC
  DFCE  C9            		RET
                      	
  DFCF                	SCRN:
  DFCF  D5            		PUSH	DE
  DFD0  ED58          		IN	E,(C)		;Text
  DFD2  3A1800        		LD	A,(00018H)
  DFD5  3C            		INC	A
  DFD6  281E          		JR	Z,SCRN2
  DFD8  CBD8          		SET	3,B
  DFDA  ED50          		IN	D,(C)		;Kanji
  DFDC  2816          		JR	Z,SCRN1
  DFDE  AF            		XOR	A
  DFDF  C5            		PUSH	BC
  DFE0  013730        		LD	BC,03037H	;VRMJIS
  DFE3  DF            		RST	018H
  DFE4  01522F        		LD	BC,02F52H	;JISSFT
  DFE7  DF            		RST	018H
  DFE8  C1            		POP	BC
  DFE9  ED78          		IN	A,(C)
  DFEB  CB98          		RES	3,B
  DFED  E640          		AND	040H
  DFEF  2005          		JR	NZ,SCRN2
  DFF1  7A            		LD	A,D
  DFF2  D1            		POP	DE
  DFF3  C9            		RET
  DFF4                	SCRN1:
  DFF4  CB98          		RES	3,B
  DFF6                	SCRN2:
  DFF6  7B            		LD	A,E
  DFF7  D1            		POP	DE
  DFF8  C9            		RET
  DFF9                	SCRNE:
  DFF9                	POS:
  DFF9  2A8EF0        		LD	HL,(_TXADR)
  DFFC  C5            		PUSH	BC
  DFFD  ED4BBCF0      		LD	BC,(_WIDTH_MINUS)
  E001  AF            		XOR	A
  E002                	POS1:
  E002  09            		ADD	HL,BC
  E003  3C            		INC	A
  E004  38FC          		JR	C,POS1
  E006  ED42          		SBC	HL,BC
  E008  3D            		DEC	A
  E009  67            		LD	H,A
  E00A  C1            		POP	BC
  E00B  A7            		AND	A
  E00C  C9            		RET
                      	
  E00D                	GETL:
  E00D  CDD3F0        		CALL	_POS
  E010  E5            		PUSH	HL
  E011  3ECD          		LD	A,0CDH		;CALL ????
  E013  322BDD        		LD	(INSFLG),A
  E016                	GETL1:
  E016  CDD2DB        		CALL	_SYS08
  E019  FE09          		CP	9
  E01B  2008          		JR	NZ,GETL1V
  E01D  2120FF        		LD	HL,KBUF
  E020  CD70D8        		CALL	MSX
  E023  18F1          		JR	GETL1
  E025                	GETL1V:
  E025  5F            		LD	E,A
  E026  CDCDF0        		CALL	_PRINT
                      	
  E029  7B            		LD	A,E
  E02A  FE0D          		CP	00DH
  E02C  20E8          		JR	NZ,GETL1
  E02E  3E01          		LD	A,1		;LD BC,????
  E030  322BDD        		LD	(INSFLG),A
  E033  1120FF        		LD	DE,KBUF
  E036  3AB1F0        		LD	A,(_WIDTH)
  E039  47            		LD	B,A
  E03A  CDD3D5        		CALL	ZERO_MEMORY_DE
                      	
  E03D  D1            		POP	DE
  E03E  CDD3F0        		CALL	_POS
  E041  6B            		LD	L,E
  E042  3AB1F0        		LD	A,(_WIDTH)
  E045  95            		SUB	L
  E046  57            		LD	D,A
  E047  CD70DE        		CALL	LOC1
  E04A  4D            		LD	C,L
  E04B  7C            		LD	A,H
  E04C  F630          		OR	030H
  E04E  47            		LD	B,A
  E04F  5A            		LD	E,D
  E050  2120FF        		LD	HL,KBUF
  E053                	GETL2:
  E053  CDD0F0        		CALL	_SCRN
  E056  03            		INC	BC
  E057  77            		LD	(HL),A
  E058  23            		INC	HL
  E059  1D            		DEC	E
  E05A  20F7          		JR	NZ,GETL2
  E05C                	GETL3:
  E05C  2B            		DEC	HL
  E05D  7E            		LD	A,(HL)
  E05E  FE21          		CP	021H
  E060  D0            		RET	NC
  E061  3600          		LD	(HL),0
  E063  15            		DEC	D
  E064  20F6          		JR	NZ,GETL3
  E066  C9            		RET
                      	
  E067                	INKEY:
  E067  FB            		EI
  E068  E5            		PUSH	HL
  E069  2A90F0        		LD	HL,(_KEYPS)
  E06C  7C            		LD	A,H
  E06D  AD            		XOR	L
  E06E  280B          		JR	Z,INKEY1
  E070  7C            		LD	A,H
  E071  3C            		INC	A
  E072  E61F          		AND	01FH
  E074  3291F0        		LD	(_KEYPS+1),A
  E077  6F            		LD	L,A
  E078  26FF          		LD	H,KEYBF/256
  E07A  7E            		LD	A,(HL)
  E07B                	INKEY1:
  E07B  E1            		POP	HL
  E07C  B7            		OR	A
  E07D  C9            		RET
                      	
  0F49                	AT_RS	EQU	SCR1-AT_SCR1
                      	
                      	;LDFILE.ASM
                      	
                      	;	LSX-Dodgers FILE
                      	
  E07E                	FILEC:
  E07E  CD89E0        		CALL	FILE
  E081                	FILEC2:
  E081  3A15F0        		LD	A,(FDRV+1)
  E084  FE20          		CP	020H
  E086  C8            		RET	Z
  E087  1839          		JR	SETDIR1
                      	
  E089                	FILE:
  E089  AF            		XOR	A
  E08A  3214F0        		LD	(FDRV),A
  E08D  67            		LD	H,A
  E08E  6F            		LD	L,A
  E08F  2222F0        		LD	(FDRV+14),HL
  E092  CD60E1        		CALL	SPCUT
  E095  CD45E1        		CALL	CCHK3
  E098  2812          		JR	Z,DEVI1
  E09A  13            		INC	DE
  E09B  1A            		LD	A,(DE)
  E09C  1B            		DEC	DE
  E09D  FE3A          		CP	':'
  E09F  200B          		JR	NZ,DEVI1
  E0A1  1A            		LD	A,(DE)		;DRIVE
  E0A2  CD95E3        		CALL	CAP
  E0A5  D640          		SUB	'@'
  E0A7  13            		INC	DE
  E0A8  13            		INC	DE
  E0A9  3214F0        		LD	(FDRV),A
  E0AC                	DEVI1:
  E0AC  1A            		LD	A,(DE)
  E0AD  D65C          		SUB	05CH		;\
  E0AF  2009          		JR	NZ,NOROOT
  E0B1  6F            		LD	L,A		;A=0でH=0のはずなのでHL=0
  E0B2  222EF0        		LD	(FDRV+26),HL
  E0B5  2C            		INC	L
  E0B6  2222F0        		LD	(FDRV+14),HL
  E0B9  13            		INC	DE
  E0BA                	NOROOT:
                      	
  E0BA                	SETDIR:
  E0BA  CDE6E0        		CALL	FILED
  E0BD  1A            		LD	A,(DE)
  E0BE  FE5C          		CP	05CH		;\
  E0C0  C0            		RET	NZ
  E0C1  13            		INC	DE
  E0C2                	SETDIR1:
  E0C2  3E10          		LD	A,010H		;Directory
  E0C4  3221F0        		LD	(FDRV+13),A
  E0C7  D5            		PUSH	DE
  E0C8  1114F0        		LD	DE,FDRV
  E0CB  2A1EF1        		LD	HL,(STABLE+2*00FH)
  E0CE  CD0F00        		CALL	JP_HL
  E0D1  D1            		POP	DE
  E0D2  B7            		OR	A
  E0D3  C0            		RET	NZ
                      	
  E0D4  3A21F0        		LD	A,(FDRV+13)
  E0D7  CB67          		BIT	4,A
  E0D9  C8            		RET	Z
                      	
  E0DA  CD2DE1        		CALL	FILEI
  E0DD  2A2EF0        		LD	HL,(FDRV+26)
  E0E0  23            		INC	HL
  E0E1  2222F0        		LD	(FDRV+14),HL
  E0E4  18D4          		JR	SETDIR
                      	
  E0E6                	FILED:
  E0E6  CD2DE1        		CALL	FILEI
  E0E9  2115F0        		LD	HL,FNAME
                      	
  E0EC  0608          		LD	B,8
  E0EE                	FILE2:
  E0EE  CD3AE1        		CALL	CCHKF
  E0F1  C8            		RET	Z
  E0F2  FE2A          		CP	'*'
  E0F4  282E          		JR	Z,FILE9
  E0F6  FE2E          		CP	'.'
  E0F8  280C          		JR	Z,FILE4
  E0FA  77            		LD	(HL),A
  E0FB  23            		INC	HL
  E0FC  10F0          		DJNZ	FILE2
                      	
  E0FE                	FILE3:
  E0FE  CD3AE1        		CALL	CCHKF
  E101  C8            		RET	Z
  E102  FE2E          		CP	'.'
  E104  20F8          		JR	NZ,FILE3
                      	
  E106                	FILE4:
  E106  211DF0        		LD	HL,FNAME+8
  E109  0603          		LD	B,3
                      	
  E10B                	FILE4L:
  E10B  CD3AE1        		CALL	CCHKF
  E10E  C8            		RET	Z
  E10F  FE2E          		CP	'.'
  E111  2008          		JR	NZ,FILE12
  E113  3215F0        		LD	(FNAME),A	;Parent directory(..)
  E116  3216F0        		LD	(FNAME+1),A
  E119  3E20          		LD	A,020H
  E11B                	FILE12:
  E11B  FE2A          		CP	'*'
  E11D  280A          		JR	Z,FILE10
  E11F  77            		LD	(HL),A
  E120  23            		INC	HL
  E121  10E8          		DJNZ	FILE4L
  E123  C9            		RET
                      	
  E124                	FILE9:				;名前の*処理、名前の残りを?で埋める
  E124  CD29E1        		CALL	FILE10
  E127  18D5          		JR	FILE3
                      	
  E129                	FILE10:
  E129  3E3F          		LD	A,'?'
  E12B  1808          		JR	FILL_MEMORY
  E12D                	FILEI:				;名前＋拡張子をスペースで初期化
  E12D  3E20          		LD	A,020H
  E12F  01000B        		LD	BC,11*256	;C=0にしておく
  E132  2115F0        		LD	HL,FNAME
  E135                	FILL_MEMORY:			;HLからBバイトAで埋める
  E135  77            		LD	(HL),A
  E136  23            		INC	HL
  E137  10FC          		DJNZ	FILL_MEMORY
  E139  C9            		RET
                      	
  E13A                	CCHKF:
  E13A  1A            		LD	A,(DE)
  E13B  CD42E1        		CALL	CCHK2
  E13E  C8            		RET	Z
  E13F  C3ADE4        		JP	FKAN
                      	
  E142                	CCHK2:
  E142  0C            		INC	C
  E143  0D            		DEC	C
  E144  C0            		RET	NZ
  E145                	CCHK3:				;ZF=1 で使えない文字
  E145  FE2B          		CP	'+'
  E147  C8            		RET	Z
  E148  FE2C          		CP	','
  E14A  C8            		RET	Z
  E14B  FE2F          		CP	'/'
  E14D  C8            		RET	Z
  E14E  FE3A          		CP	':'
  E150  C8            		RET	Z
  E151  FE3B          		CP	';'
  E153  C8            		RET	Z
  E154  FE3D          		CP	'='
  E156  C8            		RET	Z
  E157  FE5C          		CP	05CH	;\
  E159  C8            		RET	Z
  E15A  FE20          		CP	020H
  E15C  D0            		RET	NC
  E15D  BF            		CP	A		;Z=1
  E15E  C9            		RET
                      	
  E15F                	SS1:
  E15F  13            		INC	DE
  E160                	SPCUT:				;スペースをカット
  E160  1A            		LD	A,(DE)
  E161  FE20          		CP	020H
  E163  28FA          		JR	Z,SS1
  E165  C9            		RET
                      	
  E166                	SETDRVF:
  E166  1114F0        		LD	DE,FDRV
  E169                	SETDRV0:
  E169  CD72E1        		CALL	SETDRV
  E16C  FDE1          		POP	IY
  E16E  C1            		POP	BC
  E16F  D1            		POP	DE
  E170  E1            		POP	HL
  E171  C9            		RET
                      	
  E172                	SETDRV:
  E172  E3            		EX	(SP),HL		;HL=RETRN ADDRESS
  E173  D5            		PUSH	DE		;PUSH HL/DE/BC/IY
  E174  C5            		PUSH	BC
  E175  1A            		LD	A,(DE)
  E176  D5            		PUSH	DE
  E177  FDE3          		EX	(SP),IY
                      	
  E179  CD85E1        		CALL	GETDRV
  E17C  3C            		INC	A
  E17D  FD7700        		LD	(IY+0),A	;(FCB)ドライブ番号
  E180  3D            		DEC	A
  E181  CDD9F0        		CALL	_CHGDRV
                      	
  E184  E9            		JP	(HL)
                      	
  E185                	GETDRV:
  E185  E67F          		AND	07FH
  E187  D601          		SUB	001H
  E189  3003          		JR	NC,GETDRV1
  E18B  3A87F0        		LD	A,(_DVSW)	;Current Drive
  E18E                	GETDRV1:
  E18E  3288F0        		LD	(_DRV),A
  E191  C9            		RET
                      	
  E192                	SOPENX:
  E192  1139F0        		LD	DE,SFILE
  E195  1A            		LD	A,(DE)
  E196  FDBE00        		CP	(IY+0)		;(FCB)ドライブ番号
  E199  2024          		JR	NZ,SOPEN
  E19B  13            		INC	DE
  E19C  FDE5          		PUSH	IY
  E19E  E1            		POP	HL
  E19F  23            		INC	HL
  E1A0  CD2DE3        		CALL	CPFILE
  E1A3  201A          		JR	NZ,SOPEN
                      	
  E1A5  2AF4F1        		LD	HL,(SCDIR)
  E1A8  FD750E        		LD	(IY+14),L	;(FCB)アクセスするディレクトリのクラスタ番号+1
  E1AB  FD740F        		LD	(IY+15),H
                      	
  E1AE  2AF8F1        		LD	HL,(SFNDF)	;Direcroty location and Flags
  E1B1  229FF0        		LD	(_FILEN),HL
                      	
  E1B4  ED5BF6F1      		LD	DE,(SFBPS)
  E1B8  2139F0        		LD	HL,SFILE
  E1BB  36FF          		LD	(HL),0FFH
  E1BD  23            		INC	HL
  E1BE  C9            		RET
  E1BF                	SOPEN:
  E1BF  21D5E2        		LD	HL,FILESE
  E1C2                	SOPENC:
  E1C2  22FBE1        		LD	(OPENPAT+1),HL
                      	
  E1C5  CDE2F0        		CALL	_RDFATX		;Detect Media
  E1C8  3856          		JR	C,RDDERR
                      	
  E1CA  AF            		XOR	A
  E1CB  329FF0        		LD	(_FILEN),A
  E1CE  CDDAE3        		CALL	LDDIRX1		;A=0で呼び出す
  E1D1  2818          		JR	Z,SDIRX1
                      	
  E1D3  CDC6E2        		CALL	READ_DIR	;Sub Directory
  E1D6  3808          		JR	C,SDIRX0
  E1D8  2A7EF1        		LD	HL,(_DTBUF)
  E1DB  7E            		LD	A,(HL)
  E1DC  FE2E          		CP	'.'
  E1DE  280F          		JR	Z,SOPEN1
  E1E0                	SDIRX0:
  E1E0  AF            		XOR	A
  E1E1  32A0F0        		LD	(_DIRF),A
  E1E4  FD360E01      		LD	(IY+14),1	;(FCB)レコードサイズ
  E1E8  FD770F        		LD	(IY+15),A
  E1EB                	SDIRX1:
  E1EB  ED5BFCF1      		LD	DE,(_DIRPS)	;Root Directory
  E1EF                	SOPEN1:
  E1EF  0E20          	SDECPAT:LD	C,32		;自己書き換え 1セクタ辺りのディレクトリエントリ数  1024=32 / 512=16 / 256=8
  E1F1                	SOPEN1X:
  E1F1  CDC6E2        		CALL	READ_DIR	;FILE SEARCH
  E1F4  382A          		JR	C,RDDERR
  E1F6  2A7EF1        		LD	HL,(_DTBUF)
  E1F9                	SOPEN2:
  E1F9  D5            		PUSH	DE
  E1FA  CDD5E2        	OPENPAT:CALL	FILESE		;(self-modifying code)
  E1FD  D1            		POP	DE
  E1FE  386E          		JR	C,SOPENE
  E200  281B          		JR	Z,SCF_FF_RET
  E202                	SOPEN3:
  E202  3AA0F0        		LD	A,(_DIRF)	;ディレクトリか判別
  E205  B7            		OR	A
  E206  200C          		JR	NZ,SOPEN5
  E208  13            		INC	DE		;ルートディレクトリ
  E209  E5            		PUSH	HL
  E20A  210C00        	MD_PAT:	LD	HL,12		;(self-modifying code)MAXDIR
  E20D  ED52          		SBC	HL,DE		;CF=0 なので SUB HL,DE
  E20F  E1            		POP	HL
  E210  20DD          		JR	NZ,SOPEN1
  E212  1807          		JR	SOPEN6
  E214                	SOPEN5:
  E214  CDEFEA        		CALL	GNCLX		;END DIR
  E217  D8            		RET	C
  E218  CD8DE3        		CALL	ENDCL
  E21B                	SOPEN6:
  E21B  38D2          		JR	C,SOPEN1
  E21D                	SCF_FF_RET:
  E21D  37            		SCF			;CF=1
  E21E  9F            		SBC	A,A		;A=0FFH
  E21F  C9            		RET
                      	
  E220                	RDDERR:
  E220  BF            		CP	A		;READ ERR CF=1 ZF=1
  E221  37            		SCF
  E222  C9            		RET
                      	
  E223                	NOPEN:
  E223  21D5E2        		LD	HL,FILESE
  E226  22FBE1        		LD	(OPENPAT+1),HL
  E229  FD2A98F0      		LD	IY,(_FCB)
  E22D  CDC0E4        		CALL	CHKWILDX
  E230  30EB          		JR	NC,SCF_FF_RET
  E232  FD7E00        		LD	A,(IY+0)	;(FCB)ドライブ番号
  E235  3D            		DEC	A
  E236  3288F0        		LD	(_DRV),A
  E239  CDD9F0        		CALL	_CHGDRV
  E23C  D8            		RET	C
  E23D  2AF8F1        		LD	HL,(SFNDF)	;Direcroty location and Flags
  E240  229FF0        		LD	(_FILEN),HL
                      	
  E243  CDD5E3        		CALL	LDDIRX
  E246  ED5B9AF0      		LD	DE,(_FBPS)
  E24A  CDC6E2        		CALL	READ_DIR
  E24D  38D1          		JR	C,RDDERR
  E24F  3A9EF0        		LD	A,(_FBCNT)
  E252  3D            		DEC	A
  E253  28AD          		JR	Z,SOPEN3
  E255                	NOPEN2:
  E255  2A9CF0        		LD	HL,(_FBAD)
  E258  012000        		LD	BC,020H
  E25B  09            		ADD	HL,BC
  E25C  4F            		LD	C,A
  E25D  189A          		JR	SOPEN2
                      	
  E25F                	SOPENE2:
  E25F  229CF0        		LD	(_FBAD),HL
  E262  79            		LD	A,C
  E263  329EF0        		LD	(_FBCNT),A
  E266  ED539AF0      		LD	(_FBPS),DE
  E26A  FD2298F0      		LD	(_FCB),IY
  E26E                	SOPENE:
  E26E  AF            		XOR	A
  E26F  C9            		RET
                      	
  E270                	COPEN:
  E270  FD360D20      		LD	(IY+13),020H	;(FCB)属性(アトリビュート)
                      	
  E274  21F2E2        		LD	HL,NEXTSE
  E277  CDC2E1        		CALL	SOPENC
  E27A  D0            		RET	NC
  E27B  C8            		RET	Z
  E27C  3AA0F0        		LD	A,(_DIRF)	;ディレクトリか判別
  E27F  B7            		OR	A
  E280  37            		SCF
  E281  C8            		RET	Z		;ルートディレクトリ
  E282  0601          		LD	B,1
  E284  CD1FE5        		CALL	WRDF
  E287  D8            		RET	C
  E288  ED5BFEF1      		LD	DE,(_CLPS)
  E28C  D5            		PUSH	DE
  E28D  CD56E3        		CALL	DCPAT
  E290  CD7AE9        		CALL	DRDNX
  E293  2A7EF1        		LD	HL,(_DTBUF)	;ディレクトリエントリを0クリア
  E296  3A84E8        		LD	A,(SECSZ+2)	;1024=4 / 512=2 / 256=1
  E299  47            		LD	B,A
  E29A  AF            		XOR	A
  E29B  4F            		LD	C,A
  E29C                	COPENCL:
  E29C  77            		LD	(HL),A
  E29D  EDA1          		CPI			;HL=HL+1 BC=BC-1 BCが0の場合にP/V=0
  E29F  EA9CE2        		JP	PE,COPENCL
                      	
  E2A2  3A74E3        		LD	A,(SPCPAT+1)	;1クラスタの論理セクタ数
  E2A5  3D            		DEC	A
  E2A6  2819          		JR	Z,COPENE
  E2A8  3E01          		LD	A,1		;1セクタ辺りのセクタ数が2以上の場合
  E2AA  32E7EA        		LD	(_SECPS+1),A
  E2AD  D1            		POP	DE		;DE=(_CLPS)
  E2AE  D5            		PUSH	DE
  E2AF                	COPEN1:
  E2AF  D5            		PUSH	DE		;データバッファに入らないセクタもゼロクリア
  E2B0  C5            		PUSH	BC
  E2B1  2A7EF1        		LD	HL,(_DTBUF)
  E2B4  CD70E3        		CALL	CLUSTX
  E2B7  CD7FEC        		CALL	DWT24
  E2BA  C1            		POP	BC
  E2BB  D1            		POP	DE
  E2BC  CDE6EA        		CALL	NEXTX
  E2BF  20EE          		JR	NZ,COPEN1
  E2C1                	COPENE:
  E2C1  2A7EF1        		LD	HL,(_DTBUF)
  E2C4  D1            		POP	DE
  E2C5  C9            		RET
                      	
  E2C6                	READ_DIR:
  E2C6  ED53FEF1      		LD	(_CLPS),DE
  E2CA  C5            		PUSH	BC
  E2CB  D5            		PUSH	DE
  E2CC  CD56E3        		CALL	DCPAT
  E2CF  CD5AE9        		CALL	DRDX
  E2D2  D1            		POP	DE
  E2D3  C1            		POP	BC
  E2D4  C9            		RET
                      	
  E2D5                	FILESE:
  E2D5  7E            		LD	A,(HL)
  E2D6  B7            		OR	A
  E2D7  C8            		RET	Z		;END:ZF=1 CF=0
  E2D8  FEE5          		CP	0E5H
  E2DA  280E          		JR	Z,FILESE1
  E2DC  FDE5          		PUSH	IY
  E2DE  D1            		POP	DE
  E2DF  13            		INC	DE
  E2E0  E5            		PUSH	HL
  E2E1  CD2DE3        		CALL	CPFILE
  E2E4  CC4EE3        		CALL	Z,CPFILE2
  E2E7  E1            		POP	HL
  E2E8  37            		SCF
  E2E9  C8            		RET	Z		;!!!:(ZF=1) CF=1
  E2EA                	FILESE1:
  E2EA  CD01E3        		CALL	FNEXT
  E2ED  20E6          		JR	NZ,FILESE
  E2EF                	ZF0_CF0_AFF_RET:
  E2EF  F6FF          		OR	0FFH		;ZF=0 CF=0
  E2F1  C9            		RET
                      	
  E2F2                	NEXTSE:
  E2F2  7E            		LD	A,(HL)
  E2F3  B7            		OR	A
  E2F4  37            		SCF
  E2F5  C8            		RET	Z		;!!!:ZF=1 CF=1
  E2F6  FEE5          		CP	0E5H
  E2F8  37            		SCF
  E2F9  C8            		RET	Z		;!!!:(ZF=1) CF=1
  E2FA  CD01E3        		CALL	FNEXT
  E2FD  20F3          		JR	NZ,NEXTSE
  E2FF  18EE          		JR	ZF0_CF0_AFF_RET
                      	
  E301                	FNEXT:
  E301  E5            		PUSH	HL
  E302  219FF0        		LD	HL,_FILEN
  E305  34            		INC	(HL)
  E306  E1            		POP	HL
  E307  112000        		LD	DE,020H
  E30A  19            		ADD	HL,DE
  E30B  0D            		DEC	C
  E30C  C9            		RET
                      	
  E30D                	CPNAME:
  E30D  C5            		PUSH	BC
  E30E  D5            		PUSH	DE
  E30F  E5            		PUSH	HL
  E310  CD27E3        		CALL	CPFILE4
  E313  E1            		POP	HL
  E314  23            		INC	HL
  E315  23            		INC	HL
  E316  23            		INC	HL
  E317  23            		INC	HL
  E318  D1            		POP	DE
  E319  C1            		POP	BC
  E31A  2005          		JR	NZ,CPNAME1
  E31C  7E            		LD	A,(HL)
  E31D  23            		INC	HL
  E31E  66            		LD	H,(HL)
  E31F  6F            		LD	L,A
  E320  C9            		RET
  E321                	CPNAME1:
  E321  23            		INC	HL
  E322  23            		INC	HL
  E323  10E8          		DJNZ	CPNAME
  E325  37            		SCF
  E326  C9            		RET
                      	
  E327                	CPFILE4:
  E327  C5            		PUSH	BC
  E328  010004        		LD	BC,00400H
  E32B  1804          		JR	CPSTR1
  E32D                	CPFILE:
  E32D  C5            		PUSH	BC
  E32E  01000B        		LD	BC,00B00H
  E331                	CPSTR1:
  E331  1A            		LD	A,(DE)
  E332  FE3F          		CP	'?'		;Wild card
  E334  2812          		JR	Z,CPSTR2
  E336  7E            		LD	A,(HL)
  E337  CDA6E4        		CALL	FKANC
  E33A  E5            		PUSH	HL
  E33B  67            		LD	H,A
  E33C  1A            		LD	A,(DE)
  E33D  CB01          		RLC	C
  E33F  CDA6E4        		CALL	FKANC
  E342  CB09          		RRC	C
  E344  BC            		CP	H		;CP (HL),(DE)
  E345  E1            		POP	HL
  E346  2004          		JR	NZ,CPSTR3
  E348                	CPSTR2:
  E348  13            		INC	DE
  E349  23            		INC	HL
  E34A  10E5          		DJNZ	CPSTR1
  E34C                	CPSTR3:
  E34C  C1            		POP	BC
  E34D  C9            		RET
                      	
  E34E                	CPFILE2:
  E34E  FD7E0D        		LD	A,(IY+13)	;(FCB)属性(アトリビュート)
  E351  F6E1          		OR	0E1H
  E353  2F            		CPL
  E354  A6            		AND	(HL)
  E355  C9            		RET
                      	
  E356                	DCPAT:
  E356  0E00          		LD	C,0
  E358  2A7EF1        		LD	HL,(_DTBUF)
  E35B  3AA0F0        		LD	A,(_DIRF)	;ディレクトリか判別
  E35E  B7            		OR	A
  E35F  C8            		RET	Z		;ルートディレクトリの場合はCレジスタを0にしておく(CDEがセクタ番号)
  E360  3A74E3        		LD	A,(SPCPAT+1)
  E363  4F            		LD	C,A
  E364  3AE7EA        		LD	A,(_SECPS+1)
  E367  B9            		CP	C
  E368  3801          		JR	C,DC1
  E36A  AF            		XOR	A
  E36B                	DC1:
  E36B  F680          		OR	080H
  E36D  32A0F0        		LD	(_DIRF),A	;bit0-6:セクタインデックス
  E370                	CLUSTX:
  E370  E5            		PUSH	HL
  E371  EB            		EX	DE,HL
  E372  AF            		XOR	A
  E373  0E01          	SPCPAT:	LD	C,1		;自己書き換え（1クラスタの論理セクタ数）
  E375                	L_CLDBL:
  E375  CB19          		RR	C		;->CF
  E377  3804          		JR	C,E_CLDBL
  E379  29            		ADD	HL,HL		;*2
  E37A  8F            		ADC	A,A
  E37B  18F8          		JR	L_CLDBL
  E37D                	E_CLDBL:
  E37D  4F            		LD	C,A
  E37E  3AE7EA        		LD	A,(_SECPS+1)
  E381  B5            		OR	L
  E382  6F            		LD	L,A
  E383  110800        	CLSPAT:	LD	DE,8	;+8 (2D)  !ADDCL (self-modifying code)
  E386  AF            		XOR	A
  E387  19            		ADD	HL,DE	;データ格納領域の先頭論理セクタ番号
  E388  89            		ADC	A,C
  E389  4F            		LD	C,A
  E38A  EB            		EX	DE,HL
  E38B  E1            		POP	HL
  E38C  C9            		RET
                      	
  E38D                	ENDCL:
  E38D  7A            		LD	A,D	;END CLUSTER
  E38E  FE01          	CLPAT1:	CP	1	;164=356	(self-modifying code)
  E390  C0            		RET	NZ
  E391  7B            		LD	A,E
  E392  FE64          	CLPAT2:	CP	064H	;		(self-modifying code)
  E394  C9            		RET
                      	
  E395                	CAP:
  E395  FE61          		CP	'a'
  E397  D8            		RET	C
  E398  FE7B          		CP	'z'+1
  E39A  D0            		RET	NC
  E39B  D620          		SUB	020H
  E39D  C9            		RET
  E39E                	CAP2:
  E39E  CD95E3        		CALL	CAP
  E3A1                	CAP3:
  E3A1  CDAAE3        		CALL	CAP4
  E3A4  FE21          		CP	021H
  E3A6  D0            		RET	NC
  E3A7  3EA0          		LD	A,0A0H
  E3A9  C9            		RET
  E3AA                	CAP4:
  E3AA  FE05          		CP	5
  E3AC  C0            		RET	NZ
  E3AD  3EE5          		LD	A,0E5H
  E3AF  C9            		RET
                      	
  E3B0                	CHDIR:
  E3B0  CDADED        		CALL	GETDPBD
  E3B3  381D          		JR	C,CHDIR2
  E3B5  DD751A        		LD	(IX+01AH),L		;_SDIR_
  E3B8  DD741B        		LD	(IX+01BH),H		;_SDIR_+1
  E3BB  1815          		JR	CHDIR2		;POP_IX_RET
                      	
  E3BD                	LDDIR:
  E3BD  CDADED        		CALL	GETDPBD
  E3C0  DD5E1A        		LD	E,(IX+01AH)		;_SDIR_
  E3C3  DD561B        		LD	D,(IX+01BH)		;_SDIR_+1
  E3C6  13            		INC	DE
  E3C7  FD730E        		LD	(IY+14),E	;(FCB)アクセスするディレクトリのクラスタ番号+1
  E3CA  FD720F        		LD	(IY+15),D
  E3CD  1B            		DEC	DE
  E3CE  AF            		XOR	A
  E3CF  32A0F0        		LD	(_DIRF),A
  E3D2                	CHDIR2:
  E3D2  DDE1          		POP	IX
  E3D4  C9            		RET
                      	
  E3D5                	LDDIRX:
  E3D5  3AA0F0        		LD	A,(_DIRF)	;(FCB)アクセスするディレクトリのセクタインデックス
  E3D8  E67F          		AND	07FH
  E3DA                	LDDIRX1:
  E3DA  32E7EA        		LD	(_SECPS+1),A
  E3DD  FD5E0E        		LD	E,(IY+14)	;(FCB)アクセスするディレクトリのクラスタ番号+1
  E3E0  FD560F        		LD	D,(IY+15)
  E3E3  1B            		DEC	DE
  E3E4  CD8DE3        		CALL	ENDCL
  E3E7  D4BDE3        		CALL	NC,LDDIR
  E3EA                	LDDIRS:
  E3EA  7A            		LD	A,D
  E3EB  B3            		OR	E
  E3EC  32A0F0        		LD	(_DIRF),A	;ディレクトリか判別
  E3EF  C9            		RET
                      	
  E3F0                	KILL:
  E3F0  CDC0E4        		CALL	CHKWILDX
  E3F3  3834          		JR	C,KILLW
  E3F5  CD92E1        		CALL	SOPENX
  E3F8                	KILLS:
  E3F8  3E1F          		LD	A,01FH
  E3FA  D43CE4        		CALL	NC,CHKATT
  E3FD  D8            		RET	C
  E3FE                	KILLSX:
  E3FE  36E5          		LD	(HL),0E5H	;DIR
  E400  CD9AE4        		CALL	WTDB
  E403  111A00        		LD	DE,01AH
  E406  19            		ADD	HL,DE
  E407  5E            		LD	E,(HL)
  E408  23            		INC	HL
  E409  56            		LD	D,(HL)
  E40A                	KILLS1:
  E40A  CD8DE3        		CALL	ENDCL
  E40D  D0            		RET	NC		;CF=0
  E40E  21FEFF        		LD	HL,0-2
  E411  19            		ADD	HL,DE
  E412  D0            		RET	NC		;DE= 0 or 1
  E413  D5            		PUSH	DE
  E414  CDF7F0        		CALL	_GNCL
  E417  ED53FEF1      		LD	(_CLPS),DE
  E41B  D1            		POP	DE
  E41C  210000        		LD	HL,0
  E41F  D4FAF0        		CALL	NC,_SNCL
  E422  D8            		RET	C
  E423  ED5BFEF1      		LD	DE,(_CLPS)	;FAT
  E427  18E1          		JR	KILLS1
                      	
  E429                	KILLW:
  E429  CDBFE1        		CALL	SOPEN
  E42C                	KILLW1:
  E42C  380B          		JR	C,KILLW2
  E42E  CD5FE2        		CALL	SOPENE2
  E431  CDF8E3        		CALL	KILLS
  E434  CD23E2        		CALL	NOPEN
  E437  18F3          		JR	KILLW1
  E439                	KILLW2:
  E439  C8            		RET	Z
  E43A  3F            		CCF
  E43B  C9            		RET
                      	
  E43C                	CHKATT:
  E43C  E5            		PUSH	HL
  E43D  110B00        		LD	DE,00BH
  E440  19            		ADD	HL,DE
  E441  A6            		AND	(HL)
  E442  E1            		POP	HL
  E443  C8            		RET	Z
  E444  37            		SCF
  E445  C9            		RET
                      	
  E446                	NAME:
  E446  CDC0E4        		CALL	CHKWILDX
  E449  D8            		RET	C
  E44A  110400        		LD	DE,4
  E44D  19            		ADD	HL,DE
  E44E  2266E4        		LD	(NAMEP+2),HL
  E451  23            		INC	HL
  E452  CDC4E4        		CALL	CHKWILD
  E455  D8            		RET	C
                      	
  E456  CD92E1        		CALL	SOPENX
  E459  3E0F          		LD	A,00FH
  E45B  D43CE4        		CALL	NC,CHKATT
  E45E  D8            		RET	C
                      	
  E45F  FD7E00        		LD	A,(IY+0)
  E462  FDE5          		PUSH	IY
  E464  FD210000      	NAMEP:	LD	IY,0		;自己書き換え
  E468  FD7700        		LD	(IY+0),A
  E46B  CD92E1        		CALL	SOPENX
  E46E  FDE3          		EX	(SP),IY
  E470  3F            		CCF
  E471  D4BFE1        		CALL	NC,SOPEN
  E474  EB            		EX	DE,HL
  E475  E1            		POP	HL
  E476  D8            		RET	C
                      	
  E477                	SETNAME:
  E477  01000B        		LD	BC,11*256
  E47A  23            		INC	HL
  E47B  7E            		LD	A,(HL)
  E47C  FEE5          		CP	0E5H
  E47E  2004          		JR	NZ,SNAME1
  E480  3E05          		LD	A,5
  E482  180E          		JR	SNAME3
  E484                	SNAME1:
  E484  7E            		LD	A,(HL)
  E485  0C            		INC	C
  E486  0D            		DEC	C
  E487  2009          		JR	NZ,SNAME3
  E489  CD95E3        		CALL	CAP
  E48C  FEA0          		CP	0A0H
  E48E  2002          		JR	NZ,SNAME3
  E490  3E20          		LD	A,020H
  E492                	SNAME3:
  E492  12            		LD	(DE),A
  E493  7E            		LD	A,(HL)
  E494  23            		INC	HL
  E495  CDADE4        		CALL	FKAN
  E498  10EA          		DJNZ	SNAME1
  E49A                	WTDB:
  E49A  3EFF          		LD	A,0FFH
  E49C  3239F0        		LD	(SFILE),A
  E49F                	SWTDBF:
  E49F  3E01          		LD	A,1
  E4A1  32A4F0        		LD	(_WTDBF),A
  E4A4  AF            		XOR	A
  E4A5  C9            		RET
                      	
  E4A6                	FKANC:
  E4A6  CB41          		BIT	0,C
  E4A8  CC9EE3        		CALL	Z,CAP2
  E4AB  1801          		JR	FKANX
  E4AD                	FKAN:			;漢字チェック
  E4AD  13            		INC	DE
  E4AE                	FKANX:
  E4AE  CB41          		BIT	0,C
  E4B0  CB81          		RES	0,C
  E4B2  C0            		RET	NZ
  E4B3  FE80          		CP	080H
  E4B5  D8            		RET	C
  E4B6  FEA0          		CP	0A0H
  E4B8  3803          		JR	C,FKAN1
  E4BA  FEE0          		CP	0E0H
  E4BC  D8            		RET	C
  E4BD                	FKAN1:
  E4BD  0C            		INC	C
  E4BE  A7            		AND	A
  E4BF  C9            		RET
                      	
  E4C0                	CHKWILDX:
  E4C0  FDE5          		PUSH	IY
  E4C2  E1            		POP	HL
  E4C3  23            		INC	HL
  E4C4                	CHKWILD:
  E4C4  060B          		LD	B,11
  E4C6  3E3F          		LD	A,'?'
  E4C8                	CHKWIL1:
  E4C8  BE            		CP	(HL)
  E4C9  23            		INC	HL
  E4CA  37            		SCF
  E4CB  C8            		RET	Z
  E4CC  10FA          		DJNZ	CHKWIL1
  E4CE  AF            		XOR	A
  E4CF  C9            		RET
                      	
  E4D0                	SDIRENT:		;IY=FCB HL=DIR
  E4D0  D5            		PUSH	DE
  E4D1  E5            		PUSH	HL
  E4D2  FDE5          		PUSH	IY
  E4D4  D1            		POP	DE
  E4D5  EB            		EX	DE,HL
  E4D6  CD77E4        		CALL	SETNAME
                      	;				Attribute
  E4D9  FD7E0D        		LD	A,(IY+13)	;(FCB)属性(アトリビュート)
  E4DC  12            		LD	(DE),A
  E4DD  13            		INC	DE
                      	;				Reserved
  E4DE  AF            		XOR	A
  E4DF  060A          		LD	B,10
  E4E1                	SDE1:
  E4E1  12            		LD	(DE),A
  E4E2  13            		INC	DE
  E4E3  10FC          		DJNZ	SDE1
                      						;(FCB)更新時刻
  E4E5  21EAF1        		LD	HL,SDDATA		;(FCB)更新年月日
  E4E8  060A          		LD	B,SDDATAE-SDDATA	;(FCB)ファイルの先頭クラスタ
  E4EA                	SDLOOP:					;(FCB)ファイルのサイズ(バイト単位)
  E4EA  7E            		LD	A,(HL)
  E4EB  23            		INC	HL
  E4EC  32F1E4        		LD	(SDPAT+2),A
  E4EF  FD7E00        	SDPAT:	LD	A,(IY+0)	;LD A,(IY+A)
  E4F2  12            		LD	(DE),A
  E4F3  13            		INC	DE
  E4F4  10F4          		DJNZ	SDLOOP
                      	
  E4F6  AF            		XOR	A
  E4F7  E1            		POP	HL
  E4F8  D1            		POP	DE
  E4F9  C9            		RET
                      	
  E4FA                	WOPEN:
  E4FA  FD7E0D        		LD	A,(IY+13)	;(FCB)属性(アトリビュート)
  E4FD  E61F          		AND	01FH
  E4FF  37            		SCF
  E500  C0            		RET	NZ
  E501  FD361CFE      		LD	(IY+28),0FEH	;(FCB)オープンモード
  E505                	TOPEN2:
  E505  AF            		XOR	A
  E506                	TOPEN:				;Initializes the time stamp
  E506  FD3617FF      		LD	(IY+23),0FFH	;(FCB)更新時刻
  E50A  C9            		RET
                      	
  E50B                	WRDFX:
  E50B  3A74E3        		LD	A,(SPCPAT+1)	;1クラスタの論理セクタ
  E50E                	L_WRFX:
  E50E  1F            		RRA			;->CF
  E50F  3806          		JR	C,E_WRFX
  E511  CB39          		SRL	C
  E513  CB1C          		RR	H		;CH=CH/2
  E515  18F7          		JR	L_WRFX
  E517                	E_WRFX:
  E517  41            		LD	B,C
  E518  4C            		LD	C,H
  E519  03            		INC	BC
  E51A  3E37          		LD	A,037H		;SCF
  E51C  3277E9        		LD	(DRDN1),A
                      	
  E51F                	WRDF:				;BCクラスタ分FATを確保する
  E51F  110200        		LD	DE,2
  E522  AF            		XOR	A
  E523  32E7EA        		LD	(_SECPS+1),A
  E526                	WRDF1:
  E526  C5            		PUSH	BC
  E527  D5            		PUSH	DE
  E528  CDF7F0        		CALL	_GNCL
  E52B  381C          		JR	C,WRDF3
  E52D  7A            		LD	A,D		;空いているかチェック
  E52E  B3            		OR	E
  E52F  202A          		JR	NZ,WRDF4
  E531  E1            		POP	HL		;HL=空いているクラスタ
  E532  E5            		PUSH	HL
  E533  ED5BFEF1      		LD	DE,(_CLPS)	;DE=元の(_CLPS)
  E537  22FEF1        		LD	(_CLPS),HL
  E53A  7A            		LD	A,D		;元の(_CLPS)が 0 か?
  E53B  B3            		OR	E
  E53C  2008          		JR	NZ,WRDF2
  E53E  FD751A        		LD	(IY+26),L	;(FCB)ファイルの先頭クラスタ
  E541  FD741B        		LD	(IY+27),H	;元が空の場合はFCBにクラスタをセットする
  E544  1803          		JR	WRDF3
  E546                	WRDF2:
  E546  CDFAF0        		CALL	_SNCL
  E549                	WRDF3:
  E549  D1            		POP	DE
  E54A  C1            		POP	BC
  E54B  D8            		RET	C
  E54C  0B            		DEC	BC
  E54D  78            		LD	A,B
  E54E  B1            		OR	C
  E54F  200C          		JR	NZ,WRDF5	;ここでループカウンタチェック
  E551  ED5BFEF1      		LD	DE,(_CLPS)
  E555  21FFFF        		LD	HL,0FFFFH	;FATエントリ終了(EOCマーク)
  E558  C3FAF0        		JP	_SNCL
                      	
  E55B                	WRDF4:				;DEクラスタが空じゃないので次に移動する
  E55B  D1            		POP	DE
  E55C  C1            		POP	BC
  E55D                	WRDF5:
  E55D  13            		INC	DE
  E55E  CD8DE3        		CALL	ENDCL
  E561  38C3          		JR	C,WRDF1
  E563  37            		SCF
  E564  C9            		RET
                      	
  E565                	RWXR:
  E565  3A84E8        		LD	A,(SECSZ+2)	;1024=4 / 512=2 / 256=1
  E568                	L_RWX:
  E568  1F            		RRA		;->CF
  E569  3808          		JR	C,E_RWX
  E56B  CB38          		SRL	B	;BCH=BCH/2
  E56D  CB19          		RR	C	;
  E56F  CB1C          		RR	H	;
  E571  18F5          		JR	L_RWX
  E573                	E_RWX:
  E573  FD5E1A        		LD	E,(IY+26)	;(FCB)ファイルの先頭クラスタ
  E576  FD561B        		LD	D,(IY+27)
  E579  AF            		XOR	A
  E57A  32E7EA        		LD	(_SECPS+1),A
  E57D                	RWX1:
  E57D  ED53FEF1      		LD	(_CLPS),DE
  E581  7A            		LD	A,D
  E582  B3            		OR	E
  E583  2813          		JR	Z,SCF_RET	;RET DE==0 => CF=1
                      	
  E585  78            		LD	A,B
  E586  B1            		OR	C
  E587  B4            		OR	H
  E588  C8            		RET	Z		;RET BCH==0 => CF=0
                      	
  E589  CDEFEA        		CALL	GNCLX
  E58C  D8            		RET	C
  E58D  7C            		LD	A,H		;
  E58E  25            		DEC	H		;
  E58F  B7            		OR	A		;DEC BCH
  E590  2001          		JR	NZ,RWX2		;
  E592  0B            		DEC	BC		;
  E593                	RWX2:
  E593  CD8DE3        		CALL	ENDCL
  E596  38E5          		JR	C,RWX1
  E598                	SCF_RET:
  E598  37            		SCF
  E599  C9            		RET
                      	
  E59A                	DSKF:
  E59A  110000        	MAXCLP:	LD	DE,0
  E59D  2AACF0        		LD	HL,(_FAKEFREE)
  E5A0  7C            		LD	A,H
  E5A1  B5            		OR	L
  E5A2  2803          		JR	Z,DSKF1
  E5A4  110100        		LD	DE,1
  E5A7                	DSKF1:
  E5A7  D5            		PUSH	DE
  E5A8  CDF7F0        		CALL	_GNCL
  E5AB  380C          		JR	C,POPSCF
  E5AD  7A            		LD	A,D
  E5AE  B3            		OR	E
  E5AF  2001          		JR	NZ,DSKF2
  E5B1  23            		INC	HL
  E5B2                	DSKF2:
  E5B2  D1            		POP	DE
  E5B3  1B            		DEC	DE
  E5B4  7A            		LD	A,D
  E5B5  B3            		OR	E
  E5B6  20EF          		JR	NZ,DSKF1
  E5B8  C9            		RET
                      	
  E5B9                	POPSCF:
  E5B9  F1            		POP	AF
  E5BA  37            		SCF
  E5BB  C9            		RET
                      	
  E5BC                	SETTMS:
  E5BC  FD7E17        		LD	A,(IY+23)	;(FCB)ファイルを最後に変更した時刻
  E5BF  3C            		INC	A
  E5C0  C0            		RET	NZ		;ファイルが更新されていない
  E5C1                	SETTMSX:			;FCBに日付時刻をセットする
  E5C1  CD70DC        		CALL	_SYS2C		;(BDOS)時刻の獲得
                      					;H←時  L←分  D←秒
  E5C4  CB25          		SLA	L		;   *2
  E5C6  CB25          		SLA	L		;   *4
  E5C8  29            		ADD	HL,HL		;*2 *8
  E5C9  29            		ADD	HL,HL		;*4 *16
  E5CA  29            		ADD	HL,HL		;*8 *32
  E5CB  7A            		LD	A,D
  E5CC  0F            		RRCA			;bit.0->7->->->0->C
  E5CD  E61F          		AND	01FH
  E5CF  B5            		OR	L
  E5D0  FD7716        		LD	(IY+22),A	;(FCB)ファイルを最後に変更した時刻
  E5D3  FD7417        		LD	(IY+23),H
                      	
  E5D6  CD4DDC        		CALL	_SYS2A		;(BDOS)日付の獲得
                      					;HL←年  D←月  E←日
  E5D9  0144F8        		LD	BC,0-1980
  E5DC  09            		ADD	HL,BC
  E5DD  65            		LD	H,L
                      	
  E5DE  7A            		LD	A,D
  E5DF  87            		ADD	A,A		;*2
  E5E0  87            		ADD	A,A		;*4
  E5E1  87            		ADD	A,A		;*8
  E5E2  87            		ADD	A,A		;*16
  E5E3  6F            		LD	L,A
  E5E4  29            		ADD	HL,HL		;*32
  E5E5  7D            		LD	A,L
  E5E6  B3            		OR	E
  E5E7  FD7714        		LD	(IY+20),A	;(FCB)ファイルを最後に変更した日付
  E5EA  FD7415        		LD	(IY+21),H
  E5ED  C9            		RET
                      	
  E5EE                	PUSHRR:
  E5EE  3286E6        		LD	(SETSEQ_SWC_RND),A
  E5F1  2298E6        		LD	(SETSEQ_SWC_SEQ_RR),HL
  E5F4  CD14E6        		CALL	GET_RR_AHL
  E5F7  220FF0        		LD	(RR_BUF_HL),HL
  E5FA  3211F0        		LD	(RR_BUF_A),A
  E5FD  C9            		RET
                      	
  E5FE                	GET_CPM_R_SIZE:		;バイト単位からCP/Mのレコード単位を求める（1レコード=128バイト）
  E5FE  87            		ADD	A,A		;in BHLA => out AHL
  E5FF  ED6A          		ADC	HL,HL
  E601  CB18          		RR	B
  E603  B7            		OR	A
  E604  78            		LD	A,B		;ここでフラグは変化しない
  E605  C8            		RET	Z
  E606  2C            		INC	L		;INC AHL
  E607  C0            		RET	NZ		;
  E608  24            		INC	H		;
  E609  C0            		RET	NZ		;
  E60A  3C            		INC	A		;
  E60B  C9            		RET
                      	
  E60C                	INIT_RND:
  E60C  3ECD          		LD	A,0CDH		;CALL ????
  E60E  215BE6        		LD	HL,POPRR
  E611  CDEEE5        		CALL	PUSHRR
  E614                	GET_RR_AHL:
  E614  FD6E21        		LD	L,(IY+33)	;(FCB)Random record
  E617  FD6622        		LD	H,(IY+34)	;
  E61A  FD7E23        		LD	A,(IY+35)	;
  E61D  C9            		RET
  E61E                	SET_RR_AHL:
  E61E  FD7521        		LD	(IY+33),L	;(FCB)Random record
  E621  FD7422        		LD	(IY+34),H
  E624  FD7723        		LD	(IY+35),A
  E627  C9            		RET
  E628                	INIT_SEQ:
  E628  3E01          		LD	A,1		;LD BC,????
  E62A  2158E6        		LD	HL,SETSEQ
  E62D  CDEEE5        		CALL	PUSHRR
  E630                	GETSEQ:
  E630  FD6E20        		LD	L,(IY+32)	;(FCB)カレントレコード
  E633  FD660C        		LD	H,(IY+12)	;(FCB)カレントブロック
  E636  AF            		XOR	A
                      	
  E637  CB25          		SLA	L	;L=L*2
                      	
  E639  CB3C          		SRL	H	;HL=HL/2
  E63B  CB1D          		RR	L	;
  E63D  C9            		RET
                      	
  E63E                	SETSEQ1:
  E63E  F5            		PUSH	AF
  E63F  E5            		PUSH	HL		;AHL=Random record
  E640  CD14E6        		CALL	GET_RR_AHL
  E643  47            		LD	B,A		;AHL→HLA
  E644  7D            		LD	A,L		;(IY+33)(FCB)ランダムレコード
  E645  6C            		LD	L,H		;(IY+34)
  E646  60            		LD	H,B		;(IY+35)
  E647  0600          		LD	B,0
                      	
  E649  CDFEE5        		CALL	GET_CPM_R_SIZE
                      	
  E64C  29            		ADD	HL,HL
  E64D  CB3D          		SRL	L		;L=L/2
  E64F  FD7520        		LD	(IY+32),L	;(FCB)カレントレコード
  E652  FD740C        		LD	(IY+12),H	;(FCB)カレントブロック
  E655  E1            		POP	HL
  E656  F1            		POP	AF
  E657  C9            		RET
  E658                	SETSEQ:
  E658  CD3EE6        		CALL	SETSEQ1
  E65B                	POPRR:
  E65B  F5            		PUSH	AF
  E65C  E5            		PUSH	HL
  E65D  2A0FF0        		LD	HL,(RR_BUF_HL)
  E660  3A11F0        		LD	A,(RR_BUF_A)
  E663  CD1EE6        		CALL	SET_RR_AHL
  E666  E1            		POP	HL
  E667  F1            		POP	AF
  E668  C9            		RET
                      	
  E669                	RB_WRITE:
  E669  C5            		PUSH	BC
  E66A  ED4B4CF1      		LD	BC,(STABLE+2*026H)	;(BDOS)ランダムブロック書き込み
  E66E  1805          		JR	RBRW
  E670                	RB_READ:
  E670  C5            		PUSH	BC
  E671  ED4B4EF1      		LD	BC,(STABLE+2*027H)	;(BDOS)ランダムブロック読み込み
  E675                	RBRW:
  E675  1F            		RRA		;AHL = AHL*128
  E676  7C            		LD	A,H	;AHL = AHL0/2
  E677  1F            		RRA		;A
  E678  65            		LD	H,L	;
  E679  CB1C          		RR	H	;H
  E67B  2E00          		LD	L,0	;
  E67D  CB1D          		RR	L	;L
  E67F  CD1EE6        		CALL	SET_RR_AHL
  E682  218000        		LD	HL,128
  E685  C5            		PUSH	BC
  E686                	SETSEQ_SWC_RND:
  E686  CD3EE6        		CALL	SETSEQ1
  E689  C1            		POP	BC
  E68A  FDCB20FE      		SET	7,(IY+32)	;(FCB)カレントレコード
  E68E  FDE5          		PUSH	IY
  E690  D1            		POP	DE
  E691  D5            		PUSH	DE
  E692  CDA0E6        		CALL	JP_BC
  E695  FDE1          		POP	IY
  E697  CD58E6        		CALL	SETSEQ
  E698                	SETSEQ_SWC_SEQ_RR	EQU $-2
  E69A  FDCB20BE      		RES	7,(IY+32)	;(FCB)カレントレコード
                      	
  E69E  C1            		POP	BC
  E69F  C9            		RET
  E6A0                	JP_BC:
  E6A0  C5            		PUSH	BC
  E6A1  C9            		RET
                      	
  E21D                	_SYS03	EQU	SCF_FF_RET	;(BDOS)外部入力
  E21D                	_SYS2B	EQU	SCF_FF_RET	;(BDOS)日付の設定
  E21D                	_SYS2D	EQU	SCF_FF_RET	;(BDOS)時刻の設定
  E21D                	_SYS39	EQU	SCF_FF_RET	;(BDOS)サブディレクトリの作成
  E21D                	_SYS3A	EQU	SCF_FF_RET	;(BDOS)サブディレクトリの削除
                      	
                      	
                      	;LDFILE2.ASM
                      	
                      	;	LSX-Dodgers FILE2
                      	
                      					;Write random block
  E6A2                	_SYS26:		;(BDOS)ランダムブロック書き込み
  E6A2  AF            		XOR	A
  E6A3  3277E9        		LD	(DRDN1),A	;NOP
  E6A6  22C7E8        		LD	(RBSIZE),HL	;HL←書き込むレコード数
  E6A9  225DF0        		LD	(LEFTX),HL
  E6AC  CD72E1        		CALL	SETDRV
                      	
  E6AF  CD1FE8        		CALL	RBX0
  E6B2  DA3FE7        		JP	C,RBWERR
  E6B5  CDFAE4        		CALL	WOPEN
  E6B8  DA3FE7        		JP	C,RBWERR
  E6BB  7C            		LD	A,H
  E6BC  B5            		OR	L
  E6BD  CA38E7        		JP	Z,RBW1
                      	
  E6C0  2B            		DEC	HL
                      	
  E6C1  CDDDE8        		CALL	GET_RR_BCDE	;BCDE=Random record
                      	
  E6C4  19            		ADD	HL,DE		;BCHL=HL+BCDE
  E6C5  3001          		JR	NC,S26X1	;
  E6C7  03            		INC	BC		;
  E6C8                	S26X1:
  E6C8  CD65E5        		CALL	RWXR
  E6CB  DC0BE5        		CALL	C,WRDFX
  E6CE  DA3FE7        		JP	C,RBWERR
                      	
  E6D1  CD4EE8        		CALL	RBX2
  E6D4  281A          		JR	Z,RBWB		;NZ=セクタ以下の端数がある
  E6D6  CD6DE8        		CALL	RBXA
  E6D9  3864          		JR	C,RBWERR
  E6DB  EB            		EX	DE,HL
  E6DC  C5            		PUSH	BC
  E6DD  EDB0          		LDIR
  E6DF  225FF0        		LD	(DTAX),HL
                      	
  E6E2  CD9FE4        		CALL	SWTDBF		;バッファデータは更新された
                      	
  E6E5  2A5DF0        		LD	HL,(LEFTX)
  E6E8  D1            		POP	DE
  E6E9  ED52          		SBC	HL,DE
  E6EB  225DF0        		LD	(LEFTX),HL
  E6EE  2831          		JR	Z,RBWEND
                      	
  E6F0                	RBWB:
  E6F0  CDA2E8        		CALL	RBXB
  E6F3  2814          		JR	Z,RBWC
  E6F5                	RBWB1:
  E6F5  C5            		PUSH	BC
  E6F6  D5            		PUSH	DE
  E6F7  CD70E3        		CALL	CLUSTX
  E6FA  CDF1E8        		CALL	DWTC
  E6FD  D1            		POP	DE
  E6FE  C1            		POP	BC
  E6FF  D4EFEA        		CALL	NC,GNCLX
  E702  383B          		JR	C,RBWERR
  E704  10EF          		DJNZ	RBWB1
  E706  CD41E9        		CALL	DRW_FLUSH
  E709                	RBWC:
  E709  CDBAE8        		CALL	RBXC
  E70C  2813          		JR	Z,RBWEND
  E70E  C5            		PUSH	BC
  E70F  CD70E3        		CALL	CLUSTX
  E712  CD76E9        		CALL	DRDN
  E715  C1            		POP	BC
  E716  3827          		JR	C,RBWERR
  E718  ED5B7EF1      		LD	DE,(_DTBUF)
  E71C  EDB0          		LDIR
  E71E  CD9FE4        		CALL	SWTDBF		;バッファデータは更新された
  E721                	RBWEND:
  E721  CDC6E8        		CALL	RBXEND
                      	
  E724  CD2EE8        		CALL	RBX1
  E727  300F          		JR	NC,RBW1		;ランダムレコードの方が大きい場合はサイズを合わせる
  E729  CDDDE8        		CALL	GET_RR_BCDE	;BCDE=Random record
  E72C  FD7310        		LD	(IY+16),E	;ファイルのサイズ(バイト単位)
  E72F  FD7211        		LD	(IY+17),D	;
  E732  FD7112        		LD	(IY+18),C	;
  E735  FD7013        		LD	(IY+19),B	;
  E738                	RBW1:
  E738  FDE1          		POP	IY
  E73A  C1            		POP	BC
  E73B  D1            		POP	DE
  E73C  E1            		POP	HL
  E73D                	DD_NUL:
  E73D  AF            		XOR	A
  E73E                	DRDF0:
  E73E                	DWTF0:
  E73E  C9            		RET
                      	
  E73F                	RBWERR:
  E73F  FDE5          		PUSH	IY
  E741  D1            		POP	DE
  E742  2A20F1        		LD	HL,(STABLE+2*010H)
  E745  CD0F00        		CALL	JP_HL
  E748                	RBRERR1:
  E748  3E01          		LD	A,001H
  E74A                	RBRERR2:
  E74A  FDE1          		POP	IY
  E74C  C1            		POP	BC
  E74D  D1            		POP	DE
  E74E  E1            		POP	HL
  E74F  37            		SCF
  E750  210000        		LD	HL,0
  E753  C9            		RET
                      	
  E754                	RBRERR:
  E754  3EFF          		LD	A,0FFH
  E756  18F2          		JR	RBRERR2
                      	
  E758                	RBRFL:
  E758  3E00          	RBRFLP:	LD	A,000H
  E75A  FE0D          		CP	00DH
  E75C  2005          		JR	NZ,RBRFL1
  E75E  D5            		PUSH	DE
  E75F  1E0A          		LD	E,00AH
  E761  1805          		JR	RBRFL2
  E763                	RBRFL1:
  E763  D5            		PUSH	DE
  E764  CD09F0        		CALL	_SYS07
  E767  5F            		LD	E,A
  E768                	RBRFL2:
  E768  CDCDF0        		CALL	_PRINT
  E76B  7B            		LD	A,E
  E76C  D1            		POP	DE
  E76D  3259E7        		LD	(RBRFLP+1),A
  E770  C9            		RET
  E771                	DDX:
  E771  FD7E01        		LD	A,(IY+1)	;(FCB)主ファイル名
  E774  CD95E3        		CALL	CAP
  E777  FE41          		CP	'A'
  E779  C9            		RET
                      	
                      					;Read random block
  E77A                	_SYS27:		;(BDOS)ランダムブロック読み込み
  E77A  225DF0        		LD	(LEFTX),HL
  E77D  CD72E1        		CALL	SETDRV
                      	
  E780  FDCB0D66      		BIT	4,(IY+13)	;(FCB)属性(アトリビュート)
  E784  C20DE8        		JP	NZ,RBRDIR	;ディレクトリ
  E787  CD1FE8        		CALL	RBX0
  E78A  DA54E7        		JP	C,RBRERR
  E78D  CD2EE8        		CALL	RBX1
  E790  D446E8        		CALL	NC,RBX1R
  E793  DA48E7        		JP	C,RBRERR1
  E796  EB            		EX	DE,HL
  E797  ED52          		SBC	HL,DE		;CP 00HL,BCDE
  E799  19            		ADD	HL,DE
  E79A  79            		LD	A,C
  E79B  DE00          		SBC	A,0
  E79D  78            		LD	A,B
  E79E  DE00          		SBC	A,0
  E7A0  3801          		JR	C,RBR1
  E7A2  EB            		EX	DE,HL
  E7A3                	RBR1:
  E7A3  9F            		SBC	A,A
  E7A4  E601          		AND	1
  E7A6  320BE8        		LD	(RBRAP+1),A
                      	
  E7A9  7C            		LD	A,H
  E7AA  B5            		OR	L
  E7AB  2857          		JR	Z,RBREND0
                      	
  E7AD  22C7E8        		LD	(RBSIZE),HL	;HL←読み込むレコード数
  E7B0  225DF0        		LD	(LEFTX),HL
                      	
  E7B3  CD4EE8        		CALL	RBX2
  E7B6  2819          		JR	Z,RBRB
  E7B8  CD6DE8        		CALL	RBXA
  E7BB  DA54E7        		JP	C,RBRERR
  E7BE  C5            		PUSH	BC
  E7BF  EDB0          		LDIR
  E7C1  ED535FF0      		LD	(DTAX),DE
  E7C5  2A5DF0        		LD	HL,(LEFTX)
  E7C8  D1            		POP	DE
  E7C9  A7            		AND	A
  E7CA  ED52          		SBC	HL,DE
  E7CC  225DF0        		LD	(LEFTX),HL
  E7CF  2830          		JR	Z,RBREND
                      	
  E7D1                	RBRB:
  E7D1  CDA2E8        		CALL	RBXB
  E7D4  2815          		JR	Z,RBRC
  E7D6                	RBRB1:
  E7D6  C5            		PUSH	BC
  E7D7  D5            		PUSH	DE
  E7D8  CD70E3        		CALL	CLUSTX
  E7DB  CDF7E8        		CALL	DRDC
  E7DE  D1            		POP	DE
  E7DF  C1            		POP	BC
  E7E0  D4EFEA        		CALL	NC,GNCLX
  E7E3  DA54E7        		JP	C,RBRERR
  E7E6  10EE          		DJNZ	RBRB1
  E7E8  CD41E9        		CALL	DRW_FLUSH
  E7EB                	RBRC:
  E7EB  CDBAE8        		CALL	RBXC
  E7EE  2811          		JR	Z,RBREND
  E7F0  C5            		PUSH	BC
  E7F1  CD70E3        		CALL	CLUSTX
  E7F4  CD5AE9        		CALL	DRDX
  E7F7  C1            		POP	BC
  E7F8  DA54E7        		JP	C,RBRERR
  E7FB  EB            		EX	DE,HL
  E7FC  2A7EF1        		LD	HL,(_DTBUF)
  E7FF  EDB0          		LDIR
  E801                	RBREND:
  E801  CDC6E8        		CALL	RBXEND
  E804                	RBREND0:
  E804  FDE1          		POP	IY
  E806  C1            		POP	BC
  E807  D1            		POP	DE
  E808  F1            		POP	AF	;(HL)
  E809  AF            		XOR	A
  E80A  3E00          	RBRAP:	LD	A,000H
  E80C  C9            		RET
                      	
  E80D                	RBRDIR:
  E80D  FD6E1A        		LD	L,(IY+26)	;(FCB)ファイルの先頭クラスタ
  E810  FD661B        		LD	H,(IY+27)
  E813  CDB0E3        		CALL	CHDIR
  E816  AF            		XOR	A
  E817  67            		LD	H,A
  E818  6F            		LD	L,A
  E819  3C            		INC	A
  E81A  320BE8        		LD	(RBRAP+1),A
  E81D  18E5          		JR	RBREND0
                      	
  E81F                	RBX0:
  E81F  2A8AF0        		LD	HL,(_DTA)
  E822  225FF0        		LD	(DTAX),HL
  E825  2A5DF0        		LD	HL,(LEFTX)
  E828  FD7E1C        		LD	A,(IY+28)	;(FCB)オープンモード
  E82B  D6FD          		SUB	0FDH
  E82D  C9            		RET
                      	
  E82E                	RBX1:				;ファイルサイズとランダムレコードを比べる
  E82E  E5            		PUSH	HL		;Record byte
                      					;AHL=File size
  E82F  FD6E10        		LD	L,(IY+16)	;ファイルのサイズ(バイト単位)
  E832  FD6611        		LD	H,(IY+17)	;
  E835  FD7E12        		LD	A,(IY+18)	;
                      	
  E838  CDDDE8        		CALL	GET_RR_BCDE	;BCDE=Random record
                      	
  E83B  A7            		AND	A
  E83C  ED52          		SBC	HL,DE
  E83E  99            		SBC	A,C
  E83F  4F            		LD	C,A
  E840  FD7E13        		LD	A,(IY+19)	;ファイルのサイズ
  E843  98            		SBC	A,B
  E844  D1            		POP	DE
  E845  C9            		RET
  E846                	RBX1R:
  E846  47            		LD	B,A
  E847  B1            		OR	C
  E848  EB            		EX	DE,HL	;BCDE=File byte	HL=Record byte
  E849  B2            		OR	D
  E84A  B3            		OR	E
  E84B  C0            		RET	NZ
  E84C  37            		SCF
  E84D  C9            		RET
                      	
  E84E                	RBX2:				;Cluster settings
  E84E  FD6622        		LD	H,(IY+34)	;(+33)(FCB)ランダムレコード
  E851  FD4E23        		LD	C,(IY+35)
  E854  0600          		LD	B,0
  E856  FDCB207E      		BIT	7,(IY+32)	;(FCB)カレントレコード
  E85A  2003          		JR	NZ,RBX3
  E85C  FD4624        		LD	B,(IY+36)
  E85F                	RBX3:
  E85F  CD65E5        		CALL	RWXR
  E862  3A84E8        		LD	A,(SECSZ+2)	;1024=4 / 512=2 / 256=1
  E865  3D            		DEC	A
  E866  FDA622        		AND	(IY+34)
  E869  FDB621        		OR	(IY+33)
  E86C  C9            		RET
                      	
  E86D                	RBXA:
  E86D  C5            		PUSH	BC
  E86E  D5            		PUSH	DE
  E86F  CD70E3        		CALL	CLUSTX
  E872  CD5AE9        		CALL	DRDX
  E875  D1            		POP	DE
  E876  C1            		POP	BC
  E877  D4EFEA        		CALL	NC,GNCLX
  E87A  D8            		RET	C
  E87B  ED53FEF1      		LD	(_CLPS),DE
                      	
  E87F  FD4E21        		LD	C,(IY+33)	;(FCB)ランダムレコード
  E882  210004        	SECSZ:	LD	HL,0400H	;自己書き換え 1024=0400H / 512=0200H ここに1セクタのサイズが格納される
  E885  7C            		LD	A,H
  E886  3D            		DEC	A		;1024=3 / 512=1
  E887  FDA622        		AND	(IY+34)		;(FCB)ランダムレコード
  E88A  47            		LD	B,A		;BCに1セクタ以下の端数が入る
  E88B  ED42          		SBC	HL,BC		;残りを計算
                      	
  E88D  ED5B5DF0      		LD	DE,(LEFTX)
  E891  ED52          		SBC	HL,DE		;CP HL,DE
  E893  19            		ADD	HL,DE		;
  E894  3801          		JR	C,RBXA1		;DEとHLを比較して大きい方をHLに
  E896  EB            		EX	DE,HL
  E897                	RBXA1:
  E897  E5            		PUSH	HL
  E898  2A7EF1        		LD	HL,(_DTBUF)
  E89B  09            		ADD	HL,BC
  E89C  ED5B5FF0      		LD	DE,(DTAX)
  E8A0  C1            		POP	BC
  E8A1  C9            		RET
                      	
  E8A2                	RBXB:
  E8A2  2A5FF0        		LD	HL,(DTAX)
  E8A5  ED5BFEF1      		LD	DE,(_CLPS)
  E8A9  3A5EF0        		LD	A,(LEFTX+1)
  E8AC  47            		LD	B,A
  E8AD  3A84E8        		LD	A,(SECSZ+2)	;1024=4 / 512=2 / 256=1
  E8B0                	RBXB1:
  E8B0  1F            		RRA		;->CF
  E8B1  3804          		JR	C,RBXB2
  E8B3  CB38          		SRL	B	;B=B/2
  E8B5  18F9          		JR	RBXB1
  E8B7                	RBXB2:
  E8B7  78            		LD	A,B
  E8B8  B7            		OR	A
  E8B9  C9            		RET
                      	
  E8BA                	RBXC:
  E8BA  ED4B5DF0      		LD	BC,(LEFTX)
  E8BE  3A84E8        		LD	A,(SECSZ+2)	;1024=4 / 512=2 / 256=1
  E8C1  3D            		DEC	A
  E8C2  A0            		AND	B
  E8C3  47            		LD	B,A		;1セクタ以下の端数がない場合はZ
  E8C4  B1            		OR	C
  E8C5  C9            		RET
                      	
  E8C6                	RBXEND:				;レコード数だけランダムレコードを進める
  E8C6  110000        		LD	DE,0		;進めるレコード数(RBSIZE)
  E8C7                	RBSIZE	EQU	$-2
  E8C9  CD14E6        		CALL	GET_RR_AHL
  E8CC  19            		ADD	HL,DE
  E8CD  CE00          		ADC	A,0
  E8CF  CD1EE6        		CALL	SET_RR_AHL
  E8D2  EB            		EX	DE,HL		;HL=進めるレコード数
  E8D3  D0            		RET	NC
  E8D4  FDCB207E      		BIT	7,(IY+32)	;(FCB)カレントレコード
  E8D8  C0            		RET	NZ
  E8D9  FD3424        		INC	(IY+36)
  E8DC  C9            		RET
                      	
  E8DD                	GET_RR_BCDE:			;BCDE=Random record
  E8DD  FD5E21        		LD	E,(IY+33)	;(FCB)ランダムレコード
  E8E0  FD5622        		LD	D,(IY+34)
  E8E3  FD4E23        		LD	C,(IY+35)
  E8E6  0600          		LD	B,0		;CP/M互換のアクセスの場合はFCBは36バイト
  E8E8  FDCB207E      		BIT	7,(IY+32)	;(FCB)カレントレコード
  E8EC  C0            		RET	NZ
  E8ED  FD4624        		LD	B,(IY+36)
  E8F0  C9            		RET
                      	
                      	;	ランダムブロックアクセスの連続したセクタをまとめる
                      	
  E8F1                	DWTC:
  E8F1  E5            		PUSH	HL
  E8F2  2181EC        		LD	HL,DWT24B
  E8F5  1804          		JR	DWTC1
  E8F7                	DRDC:
  E8F7  E5            		PUSH	HL
  E8F8  2171EC        		LD	HL,DRD24B
  E8FB                	DWTC1:
  E8FB  2255E9        		LD	(DRWF_MODE),HL
  E8FE  E1            		POP	HL
  E8FF  3A45E9        		LD	A,(DRWF_B)
  E902  B7            		OR	A
  E903  200F          		JR	NZ,DRDC1
  E905                	SAVE_DRWC:
  E905  0601          		LD	B,1
  E907  ED4344E9      		LD	(DRWF_C),BC
  E90B  ED534BE9      		LD	(DRWF_E),DE
  E90F  224EE9        		LD	(DRWF_HL),HL
  E912  1820          		JR	INC_HL_DRWC
  E914                	DRDC1:
  E914  E5            		PUSH	HL
  E915  214BE9        		LD	HL,DRWF_E
  E918  86            		ADD	A,(HL)
  E919  F5            		PUSH	AF
  E91A  BB            		CP	E
  E91B  201D          		JR	NZ,DRDC2
  E91D  F1            		POP	AF
  E91E  23            		INC	HL
  E91F  7E            		LD	A,(HL)
  E920  CE00          		ADC	A,0
  E922  F5            		PUSH	AF
  E923  BA            		CP	D
  E924  2014          		JR	NZ,DRDC2
  E926  F1            		POP	AF
  E927  3A44E9        		LD	A,(DRWF_C)
  E92A  CE00          		ADC	A,0
  E92C  B9            		CP	C
  E92D  200C          		JR	NZ,DRDC3
  E92F  2145E9        		LD	HL,DRWF_B
  E932  34            		INC	(HL)
  E933  E1            		POP	HL
  E934                	INC_HL_DRWC:
  E934  3A84E8        		LD	A,(SECSZ+2)		;1セクタのサイズの上位1バイト
  E937  84            		ADD	A,H
  E938  67            		LD	H,A
  E939  C9            		RET
  E93A                	DRDC2:
  E93A  F1            		POP	AF
  E93B                	DRDC3:
  E93B  CD41E9        		CALL	DRW_FLUSH
  E93E  E1            		POP	HL
  E93F  18C4          		JR	SAVE_DRWC
                      	
                      	;	ランダムブロックアクセスの連続したセクタをまとめたものをフラッシュする
  E941                	DRW_FLUSH:
  E941  C5            		PUSH	BC
  E942  D5            		PUSH	DE
  E943  010000        		LD	BC,0
  E944                	DRWF_C	EQU	$-2
  E945                	DRWF_B	EQU	$-1
  E946  78            		LD	A,B
  E947  B7            		OR	A
  E948  280D          		JR	Z,DRDF1
  E94A  110000        		LD	DE,0
  E94B                	DRWF_E	EQU	$-2
  E94C                	DRWF_D	EQU	$-1
  E94D  210000        		LD	HL,0
  E94E                	DRWF_HL	EQU	$-2
  E950  AF            		XOR	A
  E951  3245E9        		LD	(DRWF_B),A
  E954  CD71EC        		CALL	DRD24B
  E955                	DRWF_MODE	EQU	$-2
  E957                	DRDF1:
  E957  D1            		POP	DE
  E958  C1            		POP	BC
  E959  C9            		RET
                      	
                      	;LDDIO.ASM
                      	
                      	;	LSX-Dodgers DIO
                      	
  E95A                	DRDX:
  E95A  CD98E9        		CALL	DRDY
  E95D  C8            		RET	Z
  E95E  CD7EE9        		CALL	DRDX1		;データバッファの情報を保存
  E961  D8            		RET	C
  E962  E5            		PUSH	HL
  E963  C5            		PUSH	BC
  E964  D5            		PUSH	DE
  E965  2A7EF1        		LD	HL,(_DTBUF)
  E968  3AC1E9        		LD	A,(_DBS24+1)
  E96B  4F            		LD	C,A
  E96C  CD6FEC        		CALL	DRD24
  E96F  DC93E9        		CALL	C,DRDNE
  E972                	POP_DE_BC_HL_RET:
  E972  D1            		POP	DE
  E973  C1            		POP	BC
  E974  E1            		POP	HL
  E975  C9            		RET
                      	
                      	;	CDE:セクタ番号
  E976                	DRDN:
  E976  AF            		XOR	A
  E977  00            	DRDN1:	NOP			;自己書き換え NOP / SCF
  E978  30E0          		JR	NC,DRDX
  E97A                	DRDNX:
  E97A  CD98E9        		CALL	DRDY
  E97D  C8            		RET	Z
  E97E                	DRDX1:
  E97E  CDAEE9        		CALL	DWTX
                      					;データバッファの読み込んだドライブ・セクタ情報を保存
  E981  ED53A6F0      		LD	(_DBSEC),DE
  E985  79            		LD	A,C
  E986  32C1E9        		LD	(_DBS24+1),A
                      	
  E989  3A88F0        		LD	A,(_DRV)
  E98C  32A5F0        		LD	(_DBDRV),A
  E98F  CDD9F0        		CALL	_CHGDRV
  E992  D0            		RET	NC
  E993                	DRDNE:
  E993  9F            		SBC	A,A		;CF=1ならばA=0FFH
  E994  32A5F0        		LD	(_DBDRV),A
  E997  C9            		RET
                      	
                      	;	CDE:セクタ番号
  E998                	DRDY:
  E998  3AC1E9        		LD	A,(_DBS24+1)
  E99B  B9            		CP	C
  E99C  C0            		RET	NZ
                      	
  E99D  E5            		PUSH	HL
  E99E  3A88F0        		LD	A,(_DRV)
  E9A1  21A5F0        		LD	HL,_DBDRV
  E9A4  AE            		XOR	(HL)
  E9A5  2005          		JR	NZ,POP_HL_RET
                      	
  E9A7  2AA6F0        		LD	HL,(_DBSEC)
  E9AA  ED52          		SBC	HL,DE		;CF=0
  E9AC                	POP_HL_RET:
  E9AC  E1            		POP	HL
  E9AD  C9            		RET
                      	
  E9AE                	DWTX:
  E9AE  3AA4F0        		LD	A,(_WTDBF)
  E9B1  B7            		OR	A
  E9B2  C8            		RET	Z
  E9B3  AF            		XOR	A
  E9B4  32A4F0        		LD	(_WTDBF),A
                      	
  E9B7  E5            		PUSH	HL
  E9B8  C5            		PUSH	BC
  E9B9  D5            		PUSH	DE
  E9BA  3AA5F0        		LD	A,(_DBDRV)
  E9BD  CDD9F0        		CALL	_CHGDRV
  E9C0  0E00          	_DBS24:	LD	C,0
  E9C2  ED5BA6F0      		LD	DE,(_DBSEC)
  E9C6  2A7EF1        		LD	HL,(_DTBUF)
  E9C9  D47FEC        		CALL	NC,DWT24
  E9CC                	POP_DE_BC_HL_RET2:
  E9CC  18A4          		JR	POP_DE_BC_HL_RET
                      	
  E9CE                	RDFATX:
  E9CE  E5            		PUSH	HL
  E9CF  3A88F0        		LD	A,(_DRV)
  E9D2  21AAF0        		LD	HL,_FATDRV
  E9D5  AE            		XOR	(HL)
  E9D6  28D4          		JR	Z,POP_HL_RET
                      	
  E9D8  C5            		PUSH	BC
  E9D9  D5            		PUSH	DE
  E9DA  DDE5          		PUSH	IX
  E9DC  CDF8E9        		CALL	WTFATX
  E9DF  3813          		JR	C,POP_IX_DE_BC_HL_RET
                      	
  E9E1  AF            		XOR	A
  E9E2  32ABF0        		LD	(_FATIX),A
  E9E5  3A88F0        		LD	A,(_DRV)
  E9E8  32AAF0        		LD	(_FATDRV),A
  E9EB  CDE5F0        		CALL	_RDFAT
  E9EE                	RDFATE2:
  E9EE  3004          		JR	NC,POP_IX_DE_BC_HL_RET
  E9F0  9F            		SBC	A,A		;A=0xFF
  E9F1  32AAF0        		LD	(_FATDRV),A
  E9F4                	POP_IX_DE_BC_HL_RET:
  E9F4  DDE1          		POP	IX
  E9F6  18D4          		JR	POP_DE_BC_HL_RET2
                      	
  E9F8                	WTFATX:
  E9F8  3AA2F0        		LD	A,(_WTFATF)
  E9FB  B7            		OR	A
  E9FC  C8            		RET	Z
  E9FD  E5            		PUSH	HL
  E9FE  3AAAF0        		LD	A,(_FATDRV)
  EA01  21A5F0        		LD	HL,_DBDRV
  EA04  AE            		XOR	(HL)
  EA05  CCAEE9        		CALL	Z,DWTX
  EA08  38A2          		JR	C,POP_HL_RET
  EA0A  C5            		PUSH	BC
  EA0B  D5            		PUSH	DE
  EA0C  DDE5          		PUSH	IX
  EA0E  CD8CEC        		CALL	WTFAT
  EA11  AF            		XOR	A
  EA12  32A2F0        		LD	(_WTFATF),A
  EA15  18DD          		JR	POP_IX_DE_BC_HL_RET
                      	
  EA17                	NCL1:
  EA17  7A            		LD	A,D
  EA18  B3            		OR	E
  EA19  37            		SCF
  EA1A  C8            		RET	Z
                      	
  EA1B  7A            		LD	A,D
  EA1C  CB3F          		SRL	A	;/2
  EA1E  CB3F          		SRL	A	;/2
                      	
  EA20  E5            		PUSH	HL
  EA21  3240EA        		LD	(NCLPAT+2),A	;_FATIX
  EA24  2AAAF0        		LD	HL,(_FATDRV)	;L=_FATDRV H=_FATIX
  EA27  BC            		CP	H
  EA28  3A88F0        		LD	A,(_DRV)	;この間でフラグは変化しない
  EA2B  323FEA        		LD	(NCLPAT+1),A	;_FATDRV
  EA2E  2005          		JR	NZ,NCL2		;FATIXが違う
  EA30  BD            		CP	L
  EA31  2002          		JR	NZ,NCL2		;ドライブが違う
  EA33  E1            		POP	HL
  EA34  C9            		RET
  EA35                	NCL2:
  EA35  C5            		PUSH	BC
  EA36  D5            		PUSH	DE
  EA37  DDE5          		PUSH	IX
  EA39  CDF8E9        		CALL	WTFATX
  EA3C  38B6          		JR	C,POP_IX_DE_BC_HL_RET
  EA3E  010000        	NCLPAT:	LD	BC,0		;自己書き換え C=_FATDRV B=_FATIX
  EA41  ED43AAF0      		LD	(_FATDRV),BC
  EA45  CD61EC        		CALL	RDFATS
  EA48  18A4          		JR	RDFATE2
                      	
  EA4A                	NCL3:
  EA4A  CB9A          		RES	3,D
  EA4C  CB92          		RES	2,D
  EA4E  6B            		LD	L,E
  EA4F  62            		LD	H,D
  EA50  CB3C          		SRL	H	;
  EA52  CB1D          		RR	L	;HLA=HLA/2
  EA54  1F            		RRA		;
  EA55  F5            		PUSH	AF
  EA56  3AABF0        		LD	A,(_FATIX)
  EA59  0F            		RRCA
  EA5A  300B          		JR	NC,NCL3X1
  EA5C  3A84E8        		LD	A,(SECSZ+2)
  EA5F  FE04          		CP	4		;1セクタ1024バイトの場合は奇数インデックスの場合に先頭を512バイトずらす
  EA61  2004          		JR	NZ,NCL3X1
  EA63  010002        		LD	BC,512
  EA66  09            		ADD	HL,BC
  EA67                	NCL3X1:
  EA67  F1            		POP	AF
  EA68  ED4B7CF1      		LD	BC,(_FATBF)
  EA6C  19            		ADD	HL,DE
  EA6D  09            		ADD	HL,BC
  EA6E  17            		RLA
  EA6F  C9            		RET
                      	
  EA70                	GNCL:
  EA70  CD17EA        		CALL	NCL1		;GET NEXT CLUSTER
  EA73  D8            		RET	C
  EA74  C5            		PUSH	BC
  EA75  E5            		PUSH	HL
  EA76  CD4AEA        		CALL	NCL3
  EA79  3809          		JR	C,GNC1
  EA7B  5E            		LD	E,(HL)
  EA7C  23            		INC	HL
  EA7D  7E            		LD	A,(HL)
  EA7E  E60F          		AND	00FH
  EA80  57            		LD	D,A
  EA81  E1            		POP	HL
  EA82  C1            		POP	BC
  EA83  C9            		RET
  EA84                	GNC1:
  EA84  7E            		LD	A,(HL)
  EA85  23            		INC	HL
  EA86  56            		LD	D,(HL)
  EA87  0604          		LD	B,4
  EA89                	GNC1L:
  EA89  CB3A          		SRL	D	;DA=DA/2
  EA8B  1F            		RRA		;
  EA8C  10FB          		DJNZ	GNC1L
                      	
  EA8E  5F            		LD	E,A
  EA8F  E1            		POP	HL
  EA90  C1            		POP	BC
  EA91  A7            		AND	A
  EA92  C9            		RET
                      	
  EA93                	SNCL:
  EA93  CD17EA        		CALL	NCL1
  EA96  D8            		RET	C
                      	;				SET NEXT CLUSTER
  EA97  E5            		PUSH	HL
  EA98  C5            		PUSH	BC
  EA99  D5            		PUSH	DE
  EA9A  E5            		PUSH	HL
  EA9B  CD4AEA        		CALL	NCL3
  EA9E  D1            		POP	DE
                      	;CF=ODD
  EA9F  7E            		LD	A,(HL)
  EAA0  73            		LD	(HL),E
  EAA1  3806          		JR	C,SNC1
                      	;EVEN
                      	;M[0] = E
                      	;M[1] = (M[1] & 0xF0) | (D & 0x0F)
  EAA3  23            		INC	HL
  EAA4  ED67          		RRD		;M={A[3:0],E[3:0]}
  EAA6  7A            		LD	A,D
  EAA7  1804          		JR	SNC11
  EAA9                	SNC1:
                      	;ODD
                      	;HL[0] = (HL[0]&0x0F) | (E<<4)
                      	;HL[1] = DE>>4
  EAA9  ED6F          		RLD		;M={D[3:0],E[7:4]}
  EAAB  23            		INC	HL
  EAAC  72            		LD	(HL),D	;M={D[3:0],E[7:4]}
  EAAD                	SNC11:
  EAAD  ED6F          		RLD		;M={M[7:4],D[3:0]}
  EAAF  B7            		OR	A
  EAB0  D1            		POP	DE
  EAB1  C1            		POP	BC
  EAB2  E1            		POP	HL
  EAB3                	FAT_CHANGED:
  EAB3  3E01          		LD	A,1
  EAB5  32A2F0        		LD	(_WTFATF),A
  EAB8  C9            		RET
                      	
  EAB9                	N16CL3:
  EAB9  C5            		PUSH	BC
  EABA  6B            		LD	L,E
  EABB  7A            		LD	A,D
  EABC  E603          		AND	3
  EABE  67            		LD	H,A
  EABF  29            		ADD	HL,HL
  EAC0  ED4B7CF1      		LD	BC,(_FATBF)
  EAC4  09            		ADD	HL,BC
  EAC5  C1            		POP	BC
  EAC6  C9            		RET
                      	
  EAC7                	GNCL16:
  EAC7  CD17EA        		CALL	NCL1		;GET NEXT CLUSTER for FAT16
  EACA  D8            		RET	C
  EACB  E5            		PUSH	HL
  EACC  CDB9EA        		CALL	N16CL3
  EACF  5E            		LD	E,(HL)
  EAD0  23            		INC	HL
  EAD1  56            		LD	D,(HL)
  EAD2  E1            		POP	HL
  EAD3  C9            		RET
                      	
  EAD4                	SNCL16:
  EAD4  CD17EA        		CALL	NCL1		;GET NEXT CLUSTER for FAT16
  EAD7  D8            		RET	C
  EAD8  D5            		PUSH	DE
  EAD9  E5            		PUSH	HL
  EADA  CDB9EA        		CALL	N16CL3
  EADD  D1            		POP	DE		;HL
  EADE  73            		LD	(HL),E
  EADF  23            		INC	HL
  EAE0  72            		LD	(HL),D
  EAE1  6B            		LD	L,E
  EAE2  62            		LD	H,D
  EAE3  D1            		POP	DE
  EAE4  18CD          		JR	FAT_CHANGED
                      	
                      	;------------------------
                      	;次のセクタを探す際に_SECPSの値をチェック
                      	;in
                      	;	DE : セクタ番号
                      	;out
                      	;	DE : 次のセクタ番号
                      	;note
                      	;
                      	;------------------------
  EAE6                	NEXTX:
  EAE6  3E00          	_SECPS:	LD	A,0	;自己書き換え
  EAE8  3C            		INC	A
  EAE9  E600          	NCPAT:	AND	0	;自己書き換え　1クラスタの論理セクタ数-1
  EAEB  32E7EA        		LD	(_SECPS+1),A
  EAEE  C9            		RET
                      	
  EAEF                	GNCLX:
  EAEF  CDE6EA        		CALL	NEXTX
  EAF2  C0            		RET	NZ	;1クラスタのセクタ未満の場合は戻る
  EAF3  C3F7F0        		JP	_GNCL	;次のクラスタを探す
                      	
  EAF6                	RDFAT:
  EAF6  3E80          		LD	A,080H
  EAF8  3270F0        		LD	(CHECK),A
  EAFB                	RDFAT1:
  EAFB  3A88F0        		LD	A,(_DRV)
  EAFE  CDB6ED        		CALL	CHGDRVR
  EB01  D8            		RET	C
  EB02  DD7E12        		LD	A,(IX+012H)	;DPB_12_DEVICE
  EB05  CB6F          		BIT	5,A
  EB07  286B          		JR	Z,RDFAT0X
  EB09  2170F0        		LD	HL,CHECK
  EB0C  A6            		AND	(HL)
  EB0D  77            		LD	(HL),A
  EB0E  110000        		LD	DE,0		;BPB
  EB11  2A7CF1        		LD	HL,(_FATBF)
  EB14  CD6DEC        		CALL	DRD16
  EB17  3024          		JR	NC,GETBPB
  EB19  2170F0        		LD	HL,CHECK
  EB1C  CB06          		RLC	(HL)
  EB1E  3F            		CCF
  EB1F  D8            		RET	C
  EB20  DDCB0A1E      		RR	(IX+00AH)	;DPB_0A_FDMODE
  EB24  3F            		CCF			;フロッピーディスクのFDモードを切り替える
  EB25  DDCB0A16      		RL	(IX+00AH)	;DPB_0A_FDMODE
  EB29  3EFF          		LD	A,0FFH
  EB2B  3289F0        		LD	(_DSK),A
  EB2E  3A84F0        		LD	A,(_DRIVE)
  EB31  E603          		AND	3
  EB33  F680          		OR	080H
  EB35  6F            		LD	L,A
  EB36  26F0          		LD	H,_CYL0/256
  EB38  3EFF          		LD	A,0FFH
  EB3A  77            		LD	(HL),A
  EB3B  18BE          		JR	RDFAT1
  EB3D                	GETBPB:
  EB3D  FDE5          		PUSH	IY
  EB3F  FD2A7CF1      		LD	IY,(_FATBF)	;BPB
  EB43  CDF1F0        		CALL	_BPB2DPB
  EB46  FDE1          		POP	IY
  EB48  DD7E12        		LD	A,(IX+012H)	;DPB_12_DEVICE
  EB4B  3021          		JR	NC,GETBPBOK
  EB4D  E60F          		AND	00FH
  EB4F  FE07          		CP	7
  EB51  37            		SCF
  EB52  C0            		RET	NZ
  EB53  DDCB0A46      		BIT	0,(IX+00AH)	;DPB_0A_FDMODE
  EB57  21C0F1        		LD	HL,M2D
  EB5A  2002          		JR	NZ,SETFDMODE
  EB5C  2ED2          		LD	L,M2HD-STABLE
  EB5E                	SETFDMODE:
  EB5E  DDE5          		PUSH	IX
  EB60  D1            		POP	DE
  EB61  EDA0          		LDI
  EB63  EDA0          		LDI
  EB65  13            		INC	DE
  EB66  13            		INC	DE
  EB67  13            		INC	DE
  EB68  13            		INC	DE
  EB69  010C00        		LD	BC,12
  EB6C  EDB0          		LDIR
  EB6E                	GETBPBOK:
  EB6E  327DEB        		LD	(DEVSWC),A
  EB71  CD15ED        		CALL	CHGDRV2
  EB74                	RDFAT0X:
  EB74  CD61EC        		CALL	RDFATS
  EB77  D8            		RET	C
  EB78  DDAE06        		XOR	(IX+6)		;DPB_06_FATID
  EB7B  C8            		RET	Z
  EB7C  3E00          		LD	A,0		;DPB_12_DEVICE
  EB7D                	DEVSWC	EQU	$-1
  EB7E  CB6F          		BIT	5,A
  EB80  C0            		RET	NZ		;BPBを取得している場合はFATIDをチェックしない
  EB81  37            		SCF
  EB82  C9            		RET
                      	
  EB83                	BPB2DPB:
  EB83  FD7E0B        		LD	A,(IY+11)	;BPB_BytsPerSec
  EB86  B7            		OR	A
  EB87  37            		SCF
  EB88  C0            		RET	NZ
  EB89                	BPBOK:
  EB89  FD7E0D        		LD	A,(IY+13)	;BPB_SecPerClus
  EB8C  DD7707        		LD	(IX+7),A	;DPB_07_SECPCL
                      	
  EB8F  FD7E16        		LD	A,(IY+22)	;BPB_FATSz16
  EB92  DD7700        		LD	(IX+0),A	;DPB_00_FATLN
  EB95  FD7E17        		LD	A,(IY+23)	;BPB_FATSz16
  EB98  DD7701        		LD	(IX+1),A	;DPB_00_FATLN
                      	
  EB9B  FD6E0E        		LD	L,(IY+14)	;BPB_RsvdSecCnt
  EB9E  FD660F        		LD	H,(IY+15)
  EBA1  DD750E        		LD	(IX+00EH),L	;DPB_0E_FATPS
  EBA4  FD5E16        		LD	E,(IY+22)	;BPB_FATSz16
  EBA7  FD5617        		LD	D,(IY+23)
  EBAA  FD4610        		LD	B,(IY+16)	;BPB_NumFATs
  EBAD                	BPBDP1:				;BPB_FATSz16 * BPB_NumFATs
  EBAD  19            		ADD	HL,DE
  EBAE  10FD          		DJNZ	BPBDP1
  EBB0                	BPBDP2:
  EBB0  DD7510        		LD	(IX+010H),L	;DPB_10_DIRPS
  EBB3  DD7411        		LD	(IX+011H),H
  EBB6  E5            		PUSH	HL
                      	
  EBB7  FD6E11        		LD	L,(IY+17)	;BPB_RootEntCnt
  EBBA  FD6612        		LD	H,(IY+18)
  EBBD  FD7E0C        		LD	A,(IY+12)	;BPB_BytsPerSec
  EBC0  B7            		OR	A
  EBC1  37            		SCF
  EBC2  C8            		RET	Z
  EBC3  0606          		LD	B,6
  EBC5                	BPBBPS1:
  EBC5  05            		DEC	B
  EBC6  0F            		RRCA
  EBC7  30FC          		JR	NC,BPBBPS1
  EBC9                	BPBDE1:
  EBC9  29            		ADD	HL,HL
  EBCA  10FD          		DJNZ	BPBDE1
                      	
  EBCC  7C            		LD	A,H
  EBCD  DD770B        		LD	(IX+00BH),A	;DPB_0B_DIRSCNT
                      	
  EBD0  D1            		POP	DE		;DPB_10_DIRPS
  EBD1  6C            		LD	L,H
  EBD2  2600          		LD	H,0
  EBD4  19            		ADD	HL,DE		;MAXDIR
  EBD5  E5            		PUSH	HL
  EBD6  FD4E0D        		LD	C,(IY+13)	;BPB_SecPerClus
  EBD9  CB21          		SLA	C		;*2
  EBDB  AF            		XOR	A
  EBDC  47            		LD	B,A
  EBDD  ED42          		SBC	HL,BC
  EBDF  DD7514        		LD	(IX+014H),L	;DPB_14_ADDCL16
  EBE2  DD7415        		LD	(IX+015H),H
                      	
  EBE5  D1            		POP	DE		;DE=DPB_0B_MAXDIR
  EBE6  FD6E13        		LD	L,(IY+19)	;BPB_TotSec16
  EBE9  FD6614        		LD	H,(IY+20)
                      	
  EBEC  DD7E12        		LD	A,(IX+012H)	;DPB_12_DEVICE
  EBEF  E60F          		AND	00FH
  EBF1  FE07          		CP	7		;フロッピー
  EBF3  2019          		JR	NZ,NOT_FD
  EBF5  E5            		PUSH	HL
  EBF6  FD4E18        		LD	C,(IY+24)	;BPB_SecPerTr
  EBF9  DD710D        		LD	(IX+00DH),C	;DPB_0D_MAXSEC
  EBFC  AF            		XOR	A
  EBFD  CB21          		SLA	C		;両面なのでセクタ数を２倍
  EBFF  0610          		LD	B,16
  EC01                	DIVSEC:				;MAXCYL = BPB_TotSec16 / (BPB_SecPerTr * 2)
  EC01  29            		ADD	HL,HL
  EC02  17            		RLA
  EC03  B9            		CP	C
  EC04  3802          	   	JR	C,DIVSEC1
  EC06  91            	   	SUB	C
  EC07  2C            		INC	L
  EC08                	DIVSEC1:
  EC08  10F7          	 	DJNZ	DIVSEC
  EC0A  DD750C        		LD	(IX+00CH),L	;DPB_0C_MAXCYL
  EC0D  E1            		POP	HL	;ここまでフロッピー専用
  EC0E                	NOT_FD:
  EC0E  7C            		LD	A,H
  EC0F  B5            		OR	L
  EC10  3E00          		LD	A,0		;LDでフラグは変化しない。BPB_TotSec16を AHL で扱う為、Aに0を入れる
  EC12  2010          		JR	NZ,BPB16BIT	;BPB_TotSec16が「0」の場合はBPB_TotSec32で計算
  EC14  FD7E23        		LD	A,(IY+35)	;念のために総セクタ数が24ビットを超える場合はエラーを返す
  EC17  B7            		OR	A
  EC18  37            		SCF
  EC19  C0            		RET	NZ
  EC1A  FD6E20        		LD	L,(IY+32)	;BPB_TotSec32 は AHL の24ビットで扱う
  EC1D  FD6621        		LD	H,(IY+33)	;1クラスタの論理セクタ数(DPB_07_SECPCL)が最大128なので
  EC20  FD7E22        		LD	A,(IY+34)	;24ビットを超えると必ずクラスタ数が16ビットを超えてしまうのでこれで十分
  EC23  A7            		AND	A		;CF=0
  EC24                	BPB16BIT:
  EC24  ED52          		SBC	HL,DE
  EC26  DE00          		SBC	A,0
  EC28  FD460D        		LD	B,(IY+13)	;BPB_SecPerClus
  EC2B                	BPBTC1:				;総クラスタ数(AHL) = 総セクタ数(AHL) / セクタサイズ(B)
  EC2B  CB18          		RR	B		;->CY
  EC2D  3808          		JR	C,BPBTC2
  EC2F  CB3F          		SRL	A
  EC31  CB1C          		RR	H		;AHL=AHL/2
  EC33  CB1D          		RR	L
  EC35  18F4          		JR	BPBTC1
  EC37                	BPBTC2:
  EC37  B7            		OR	A
  EC38  37            		SCF
  EC39  C0            		RET	NZ		;念のため(クラスタ数が16ビットを超える場合)
  EC3A  23            		INC	HL
  EC3B  23            		INC	HL
  EC3C  DD7508        		LD	(IX+8),L	;DPB_08_MAXCL
  EC3F  DD7409        		LD	(IX+9),H
                      	
  EC42  FD7E15        		LD	A,(IY+21)	;BPB_Media
  EC45  DD7706        		LD	(IX+6),A	;DPB_06_FATID
                      	
  EC48  FD7E10        		LD	A,(IY+16)	;BPB_NumFATs
  EC4B  C6FE          		ADD	A,0-2		;>2:CF=1
  EC4D  FD7E0C        		LD	A,(IY+12)	;BPB_BytsPerSec
  EC50  6F            		LD	L,A
  EC51  3002          		JR	NC,BPBFAT1
  EC53  F680          		OR	080H
  EC55                	BPBFAT1:
  EC55  DD770F        		LD	(IX+00FH),A	;DPB_0F_BPS
  EC58  2D            		DEC	L		;以下のセクタサイズに合致しない場合はCF=1でエラーにする
  EC59  C8            		RET	Z		;1セクタ256バイト
  EC5A  2D            		DEC	L
  EC5B  C8            		RET	Z		;1セクタ512バイト
  EC5C  2D            		DEC	L
  EC5D  2D            		DEC	L
  EC5E  C8            		RET	Z		;1セクタ1024バイト
  EC5F  37            		SCF
  EC60  C9            		RET
                      	
  EC61                	RDFATS:
  EC61  CDA7EC        		CALL	FATSETUP
  EC64  D8            		RET	C
  EC65  CD71EC        		CALL	DRD24B
  EC68  2A7CF1        		LD	HL,(_FATBF)
  EC6B  7E            		LD	A,(HL)
  EC6C  C9            		RET
                      	
  EC6D                	DRD16:
  EC6D  0E00          		LD	C,0
  EC6F                	DRD24:
  EC6F  0601          		LD	B,1
  EC71                	DRD24B:
  EC71  DDE5          		PUSH	IX
  EC73  DD2AA8F0      		LD	IX,(_DPB)
  EC77  CDD1EE        	DRDPAT:	CALL	FDRD		;自己書き換え（ディスク読み込み）
  EC7A                	POP_IX_RET:
  EC7A  DDE1          		POP	IX
  EC7C  C9            		RET
                      	
  EC7D                	DWT16:
  EC7D  0E00          		LD	C,0
  EC7F                	DWT24:
  EC7F  0601          		LD	B,1
  EC81                	DWT24B:
  EC81  DDE5          		PUSH	IX
  EC83  DD2AA8F0      		LD	IX,(_DPB)
  EC87  CDC3EE        	DWTPAT:	CALL	FDWT		;自己書き換え（ディスク書き込み）
  EC8A  18EE          		JR	POP_IX_RET
                      	
  EC8C                	WTFAT:
  EC8C  CDA7EC        		CALL	FATSETUP
  EC8F  D481EC        		CALL	NC,DWT24B
  EC92  D8            		RET	C
  EC93  DDCB0F7E      		BIT	7,(IX+00FH)	;DPB_0F_BPS
  EC97  C8            		RET	Z		;予備FATが無い
  EC98  CDAEEC        		CALL	FATS2
  EC9B  E5            		PUSH	HL		;予備FAT
  EC9C  DD6E00        		LD	L,(IX+0)	;DPB_00_FATLN
  EC9F  DD6601        		LD	H,(IX+1)
  ECA2  19            		ADD	HL,DE
  ECA3  EB            		EX	DE,HL
  ECA4  E1            		POP	HL
  ECA5  18DA          		JR	DWT24B
                      	;------------------------
                      	;FATのセットアップ
                      	;out
                      	;	B  : FATセクタ数
                      	;	DE : FAT先頭セクタ番号
                      	;	HL : FATバッファポインタ
                      	;	CF : 1=ドライブ切り替えエラー
                      	;note
                      	;	FATサイズがFATバッファを超える場合は
                      	;	対象クラスタ領域==(_FATIX)によって
                      	;	FAT12:対象クラスタ1024毎に1.5KBを切り替える
                      	;	FAT16:対象クラスタ1024毎に2KBを切り替える
                      	;------------------------
  ECA7                	FATSETUP:
  ECA7  3AAAF0        		LD	A,(_FATDRV)
  ECAA  CDB6ED        		CALL	CHGDRVR		;ドライブ切り替え
  ECAD  D8            		RET	C
  ECAE                	FATS2:
  ECAE  DD7E0F        		LD	A,(IX+00FH)	;DPB_0F_BPS 512=2 1024=4
  ECB1  0F            		RRCA
  ECB2  CDDBEC        	FATSX:	CALL	FATSETUP12	;自己書き換え
  ECB5  210000        		LD	HL,0
  ECB8  4A            		LD	C,D
  ECB9  54            		LD	D,H
  ECBA  3AABF0        		LD	A,(_FATIX)	;範囲FAT12:0-3/FAT16:0-63(0-03FH):65535*2/2048
  ECBD  47            		LD	B,A
  ECBE  04            		INC	B
  ECBF  DD7E00        		LD	A,(IX+0)	;DPB_00_FATLN
  ECC2                	FAT_SKP:
  ECC2  05            		DEC	B
  ECC3  2805          		JR	Z,FAT1
  ECC5  19            		ADD	HL,DE
  ECC6  93            		SUB	E
  ECC7  30F9          		JR	NC,FAT_SKP
  ECC9  C9            		RET
  ECCA                	FAT1:
  ECCA  EB            		EX	DE,HL
  ECCB  B9            		CP	C		;C=FATバッファに読み込めるセクタ数
  ECCC  3801          		JR	C,FAT2
  ECCE  79            		LD	A,C
  ECCF                	FAT2:
  ECCF  47            		LD	B,A
                      	
  ECD0  2AFAF1        		LD	HL,(_FATPS)	;fat sector pos
  ECD3  19            		ADD	HL,DE
  ECD4  EB            		EX	DE,HL
  ECD5  2A7CF1        		LD	HL,(_FATBF)
  ECD8  AF            		XOR	A		;CF=0
  ECD9  4F            		LD	C,A
  ECDA  C9            		RET
                      	;
                      	;	FATバッファに読み込める最大のセクタ数と_FATIXで進めるセクタ数
                      	;	FATSETUP* (FAT12/FAT16)
                      	;out
                      	;	D : FATバッファに読み込める最大のセクタ数
                      	;	E : _FATIXで進めるセクタ数
  ECDB                	FATSETUP12:
  ECDB  110606        		LD	DE,0606H	;256
  ECDE  D8            		RET	C
  ECDF  110303        		LD	DE,0303H	;512
  ECE2  0F            		RRCA
  ECE3  D8            		RET	C
  ECE4  110102        		LD	DE,0201H	;1024
  ECE7  C9            		RET
                      	
  ECE8                	FATSETUP16:
  ECE8  110808        		LD	DE,0808H	;256
  ECEB  D8            		RET	C
  ECEC  110404        		LD	DE,0404H
  ECEF  0F            		RRCA			;512
  ECF0  D8            		RET	C
  ECF1  110202        		LD	DE,0202H	;1024
  ECF4  C9            		RET
                      	
  ECF5                	CHGDRV:
  ECF5  E5            		PUSH	HL
  ECF6  2189F0        		LD	HL,_DSK
  ECF9  BE            		CP	(HL)
  ECFA  280A          		JR	Z,CHGDRVE
  ECFC                	CHGDRV1:
  ECFC  DDE5          		PUSH	IX
  ECFE  CD08ED        		CALL	CHGDRV0
  ED01  3A89F0        		LD	A,(_DSK)
  ED04  DDE1          		POP	IX
  ED06                	CHGDRVE:
  ED06  E1            		POP	HL
  ED07  C9            		RET
                      	
  ED08                	CHGDRV0:
  ED08  6F            		LD	L,A
  ED09  CDDCF0        		CALL	_GETDPB
  ED0C  D8            		RET	C
  ED0D  DD22A8F0      		LD	(_DPB),IX
  ED11  7D            		LD	A,L
  ED12  3289F0        		LD	(_DSK),A
  ED15                	CHGDRV2:
  ED15  C5            		PUSH	BC
  ED16  D5            		PUSH	DE
  ED17  ED736CED      		LD	(SPPAT2+1),SP
  ED1B  F3            		DI
  ED1C  DDF9          		LD	SP,IX
                      	
  ED1E  E1            		POP	HL		;DPB_00_FATLN
  ED1F  E1            		POP	HL		;DPB_02_DRD
  ED20  2278EC        		LD	(DRDPAT+1),HL
                      	
  ED23  E1            		POP	HL
  ED24  2288EC        		LD	(DWTPAT+1),HL	;DPB_04_DWT
                      	
  ED27  E1            		POP	HL		;L=DPB_06_FATID H=DPB_07_SECPCL
  ED28  7C            		LD	A,H
  ED29  3274E3        		LD	(SPCPAT+1),A	;1クラスタの論理セクタ数
  ED2C  3D            		DEC	A
  ED2D  32EAEA        		LD	(NCPAT+1),A
                      	
  ED30  E1            		POP	HL		;DPB_08_MAXCL
  ED31  7D            		LD	A,L
  ED32  3293E3        		LD	(CLPAT2+1),A
  ED35  7C            		LD	A,H
  ED36  328FE3        		LD	(CLPAT1+1),A
  ED39  2B            		DEC	HL
  ED3A  229BE5        		LD	(MAXCLP+1),HL
                      	
  ED3D  E1            		POP	HL		;L=DPB_0A_FDMODE H=DPB_0B_DIRSCNT
  ED3E  7D            		LD	A,L
  ED3F  F6FE          		OR	0FEH
  ED41  326CEE        		LD	(FDMODE+1),A
  ED44  07            		RLCA
  ED45  E603          		AND	3
  ED47  3254EE        		LD	(FSPAT+1),A
  ED4A  4C            		LD	C,H
                      	
  ED4B  E1            		POP	HL		;L=DPB_0C_MAXCYL H=DPB_0D_MAXSEC
                      	
  ED4C  E1            		POP	HL		;L=DPB_0E_FATPS H=DPB_0F_BPS
  ED4D  7C            		LD	A,H		;DPB_0F_BPS
  ED4E  E607          		AND	7
  ED50  3284E8        		LD	(SECSZ+2),A	;1セクタのサイズの上位1バイト 0x400 - 0x200 - 0x100
                      					;1セクタ512 2D/2DD/2HC/2HQ(2HD1.44MB)/EMM/BRAM/EMEM等
                      					;1セクタ1024 2HD/2HDE98
                      					;1セクタ256 GRAM/RAMF/CMOS/等
                      					;1024	512	256
                      					;4	2	1
  ED53  87            		ADD	A,A		;8	4	2
  ED54  87            		ADD	A,A		;010H	8	4
  ED55  87            		ADD	A,A		;020H	010H	8
  ED56  32F0E1        		LD	(SDECPAT+1),A	;1セクタ辺りのディレクトリエントリ数
                      	
  ED59  2600          		LD	H,0
  ED5B  22FAF1        		LD	(_FATPS),HL
                      	
  ED5E  E1            		POP	HL		;DPB_10_DIRPS
  ED5F  22FCF1        		LD	(_DIRPS),HL
                      	
  ED62  E1            		POP	HL		;L=DPB_12_DEVICE H=DPB_13_UNITNO
  ED63  7C            		LD	A,H
  ED64  3284F0        		LD	(_DRIVE),A
                      	
  ED67  E1            		POP	HL		;DPB_14_ADDCL16
  ED68  2284E3        		LD	(CLSPAT+1),HL
                      	
  ED6B  310000        	SPPAT2:	LD	SP,0		;元のSPを復元
  ED6E  FB            		EI
  ED6F  2AFCF1        		LD	HL,(_DIRPS)
  ED72  0600          		LD	B,0
  ED74  09            		ADD	HL,BC		;C=DPB_0B_DIRSCNT
  ED75  220BE2        		LD	(MD_PAT+1),HL
                      	
  ED78  2A9BE5        		LD	HL,(MAXCLP+1);
  ED7B  11F60F        		LD	DE,4086		;クラスタ数が4086未満:FAT12 4086以上:FAT16
  ED7E  ED52          		SBC	HL,DE		;CF=0のはず
  ED80  300F          		JR	NC,SETFAT16
  ED82  2170EA        		LD	HL,GNCL		;FAT12
  ED85  1193EA        		LD	DE,SNCL
  ED88  01DBEC        		LD	BC,FATSETUP12
  ED8B  DDCB0FAE      		RES	5,(IX+00FH)	;DPB_0F_BPS(FAT12)
  ED8F  180D          		JR	EXTRA1
  ED91                	SETFAT16:
  ED91  21C7EA        		LD	HL,GNCL16	;FAT16
  ED94  11D4EA        		LD	DE,SNCL16
  ED97  01E8EC        		LD	BC,FATSETUP16
  ED9A  DDCB0FEE      		SET	5,(IX+00FH)	;DPB_0F_BPS(FAT16)
  ED9E                	EXTRA1:
  ED9E  22F8F0        		LD	(GNCPAT+1),HL
  EDA1  ED53FBF0      		LD	(SNCPAT+1),DE
  EDA5  ED43B3EC      		LD	(FATSX+1),BC
  EDA9  D1            		POP	DE
  EDAA  C1            		POP	BC
  EDAB  AF            		XOR	A
  EDAC  C9            		RET
                      	
  EDAD                	GETDPBD:
  EDAD  DDE3          		EX	(SP),IX
  EDAF  DDE5          		PUSH	IX
  EDB1  3A88F0        		LD	A,(_DRV)
  EDB4  1807          		JR	GETDPB1
                      	
  EDB6                	CHGDRVR:
  EDB6  CDD9F0        		CALL	_CHGDRV
  EDB9  D8            		RET	C
  EDBA  3A89F0        		LD	A,(_DSK)
  EDBD                	GETDPB1:
  EDBD  C3DCF0        		JP	_GETDPB
                      	
  EDC0                	GETDPB:
  EDC0  FE08          		CP	8
  EDC2  3F            		CCF
  EDC3  D8            		RET	C
  EDC4  0F            		RRCA
  EDC5  0F            		RRCA
  EDC6  0F            		RRCA
  EDC7  DD            		DB	0DDH		;Z80未定義命令
  EDC8  6F            		LD	L,A		;LD	IXL,A
  EDC9  DD            		DB	0DDH		;Z80未定義命令
  EDCA  26F2          		LD	H,DEVICE/256	;LD	IXH,DEVICE/256
  EDCC  DD7E00        		LD	A,(IX+0)	;DPB_00_FATLN
  EDCF  A7            		AND	A		;CF=0の為
  EDD0  DDCB0F6E      		BIT	5,(IX+00FH)	;DPB_0F_BPS
  EDD4  C0            		RET	NZ		;FAT16
  EDD5  DDCB126E      		BIT	5,(IX+012H)	;DPB_12_DEVICE
  EDD9  C0            		RET	NZ		;BPB
  EDDA  FE01          		CP	001H		;A=0 THEN CF=1
  EDDC  C9            		RET
                      	
  EDDD                	_SYS5F:
  EDDD  AF            		XOR	A
  EDDE                	FFLUSH:
  EDDE  F5            		PUSH	AF
  EDDF  3EFF          		LD	A,0FFH
  EDE1  3239F0        		LD	(SFILE),A
  EDE4  CDAEE9        		CALL	DWTX
  EDE7  3EFF          		LD	A,0FFH
  EDE9  32A5F0        		LD	(_DBDRV),A
  EDEC  CDF8E9        		CALL	WTFATX
  EDEF  AF            		XOR	A
  EDF0  32ABF0        		LD	(_FATIX),A
  EDF3  2F            		CPL			;0FFH
  EDF4  32AAF0        		LD	(_FATDRV),A
  EDF7  F1            		POP	AF
  EDF8  C9            		RET
                      	
                      	
                      	;X1DISK.ASM
                      	
                      	;	LSX-Dodgers DISK
                      	;	X1/turbo/Z
                      	
  EDF9                	SEEK:
  EDF9  0610          		LD	B,16
  EDFB  DD4E0D        		LD	C,(IX+0DH)	;DPB_0D_MAXSEC
  EDFE  AF            		XOR	A
  EDFF  EB            		EX	DE,HL
  EE00                	DIV1:
  EE00  29            		ADD	HL,HL
  EE01  8F            		ADC	A,A
  EE02  B9            		CP	C
  EE03  3802          		JR	C,DIV2
  EE05  91            		SUB	C
  EE06  2C            		INC	L
  EE07                	DIV2:
  EE07  10F7          		DJNZ	DIV1
                      	
  EE09  3C            		INC	A	;最小のセクタは１固定
  EE0A  55            		LD	D,L	;TRACK
  EE0B  5F            		LD	E,A	;SECTOR
  EE0C  CB3A          		SRL	D	;CYLINDER
  EE0E  9F            		SBC	A,A
  EE0F  E610          		AND	010H	;SIDE
  EE11  4F            		LD	C,A
                      	
  EE12  3A84F0        		LD	A,(_DRIVE)
  EE15  FE04          		CP	4
  EE17  3F            		CCF
  EE18  D8            		RET	C
  EE19  B1            		OR	C
  EE1A  3298EE        		LD	(MOPAT+1),A	;Motor off data
  EE1D  01FC0F        		LD	BC,00FFCH
  EE20  F680          		OR	080H		;Motor on
  EE22  ED79          		OUT	(C),A
                      	
  EE24  CD6AEE        		CALL	SETMODE
  EE27  D8            		RET	C
                      	
  EE28  CDADEE        		CALL	DRIVE
  EE2B  FEFF          		CP	0FFH		;A=0FFH Unknown CYLINDER
  EE2D  CC8CEE        		CALL	Z,FDCRES	;Restore
  EE30  0EF9          		LD	C,0F9H
  EE32  ED79          		OUT	(C),A		;Currrent CYLINDER
  EE34  92            		SUB	D
  EE35  C8            		RET	Z		;No seek
                      	
  EE36  3A86F0        		LD	A,(_ISEEK)
  EE39  4F            		LD	C,A
                      	
  EE3A  DD7E0C        		LD	A,(IX+00CH)	;DPB_0C_MAXCYL
  EE3D  3D            		DEC	A
  EE3E  BA            		CP	D		;Over CYLINDER
  EE3F  D8            		RET	C
                      	
  EE40  B9            		CP	C		;for Built-in 2DD
  EE41  3803          		JR	C,SETM2
  EE43  78            		LD	A,B		;B=00FH
  EE44  DBFE          		IN	A,(0FEH)		;2HD mode for 2DD seek
  EE46                	SETM2:
  EE46  78            		LD	A,B
  EE47  DBFD          		IN	A,(0FDH)		;MFM mode
                      	
  EE49  0EFB          		LD	C,0FBH
  EE4B  ED51          		OUT	(C),D
  EE4D  72            		LD	(HL),D
  EE4E  0E18          		LD	C,018H		;Seek
  EE50                	FDCCMD2:
  EE50  3A85F0        		LD	A,(_SEEKSP)
  EE53  E6FF          	FSPAT:	AND	0FFH
  EE55  B1            		OR	C
                      	
  EE56                	FDCCMD:
  EE56  CDA3EE        		CALL	COMSET
                      	
  EE59  3E80          	FDCPAT:	LD	A,080H		;FDC COMMAND(Self-modifying code)
  EE5B  E620          		AND	020H		;Write data Write track
  EE5D  3C            		INC	A
                      	
  EE5E                	SST:
  EE5E  0E00          		LD	C,0
  EE60                	SST1:
  EE60  0D            		DEC	C		; 4
  EE61  20FD          		JR	NZ,SST1		;12 * 256 / 4 = About 1ms
  EE63  3D            		DEC	A
  EE64  20FA          		JR	NZ,SST1
                      	
  EE66  3C            		INC	A		;A=1
  EE67  CD75EE        		CALL	READY
  EE6A                	SETMODE:
  EE6A  78            		LD	A,B		;B=00FH
  EE6B  DBFF          	FDMODE:	IN	A,(0FFH)	;Floppy mode(2D/2HD) (Self-modifying code)
                      	
  EE6D  78            		LD	A,B
  EE6E  DBFD          		IN	A,(0FDH)	;MFM mode
                      	
  EE70  CDA7EE        		CALL	DELAY0		;Head select time
  EE73  3E81          		LD	A,081H
  EE75                	READY:
  EE75  327FEE        		LD	(WAITA+1),A
  EE78  E5            		PUSH	HL
  EE79  0EF8          		LD	C,0F8H
  EE7B  61            		LD	H,C
  EE7C                	READY2:
  EE7C  ED78          		IN	A,(C)
  EE7E  E681          	WAITA:	AND	081H		;NOT READY,BUSY
  EE80  2808          		JR	Z,READYE
  EE82  E3            		EX	(SP),HL		;wait 19clock
  EE83  E3            		EX	(SP),HL		; //
  EE84  2B            		DEC	HL
  EE85  7C            		LD	A,H
  EE86  B5            		OR	L
  EE87  20F3          		JR	NZ,READY2
  EE89  37            		SCF
  EE8A                	READYE:
  EE8A  E1            		POP	HL
  EE8B  C9            		RET
                      	
  EE8C                	FDCRES:
  EE8C  3600          		LD	(HL),0
  EE8E  0E08          		LD	C,8
  EE90  18BE          		JR	FDCCMD2
                      	
  EE92                	FDMOFF:
  EE92  F5            		PUSH	AF
  EE93  C5            		PUSH	BC
  EE94  01FC0F        		LD	BC,00FFCH	;Motor off
  EE97  3E00          	MOPAT:	LD	A,000H		;(Self-rewriting)
  EE99  ED79          		OUT	(C),A
  EE9B  C1            		POP	BC
  EE9C  F1            		POP	AF
  EE9D  C9            		RET
                      	
  EE9E                	SECSET:
  EE9E  01FA0F        		LD	BC,00FFAH
  EEA1  ED59          		OUT	(C),E
  EEA3                	COMSET:
  EEA3  0EF8          		LD	C,0F8H
  EEA5  ED79          		OUT	(C),A
  EEA7                	DELAY0:
  EEA7  3E1A          		LD	A,26
  EEA9                	DELAY:
  EEA9  3D            		DEC	A
  EEAA  20FD          		JR	NZ,DELAY
  EEAC  C9            		RET
                      	
  EEAD                	DRIVE:
  EEAD  2A84F0        		LD	HL,(_DRIVE)
  EEB0  26F0          		LD	H,_CYL0/256
  EEB2  CBFD          		SET	7,L
  EEB4  7E            		LD	A,(HL)
  EEB5  C9            		RET
                      	
  EEB6                	RNF:
  EEB6  CDADEE        		CALL	DRIVE
  EEB9  36FF          		LD	(HL),0FFH
  EEBB  C9            		RET
                      	
  EEBC  02            	RETRY:	DB	2
                      	
                      	
                      	;	FLOPPY DISK DRIVER(DMA)
                      	
                      	
  EEBD                	WTTRK:
  EEBD  0601          		LD	B,1
  EEBF  3EF4          		LD	A,0F4H
  EEC1  1802          		JR	WTTRK1
  EEC3                	FDWT:
  EEC3  3EA0          		LD	A,0A0H
  EEC5                	WTTRK1:
  EEC5  325AEE        		LD	(FDCPAT+1),A
  EEC8  3E10          		LD	A,16
  EECA  180C          		JR	DISK
                      	
  EECC                	DISKOK:
  EECC  0601          	FDCNT:	LD	B,1
  EECE  100B          		DJNZ	DISK1
  EED0  C9            		RET
                      	
  EED1                	FDRD:
  EED1  3E80          		LD	A,080H
  EED3  325AEE        		LD	(FDCPAT+1),A
  EED6  3E0E          		LD	A,14
                      	
  EED8                	DISK:
  EED8  32EFEE        		LD	(DMAPAT+1),A
  EEDB                	DISK1:
  EEDB  78            		LD	A,B
  EEDC  32CDEE        		LD	(FDCNT+1),A
  EEDF  2247EF        		LD	(DMAD+11),HL
  EEE2                	DISKR:
  EEE2  3E02          		LD	A,2		;Retry count
  EEE4  32BCEE        		LD	(RETRY),A
  EEE7                	DISK2:
  EEE7  D5            		PUSH	DE
  EEE8  CDF9ED        		CALL	SEEK
  EEEB  3843          		JR	C,ERRF
  EEED  F3            		DI
                      	
  EEEE  3E0E          	DMAPAT:	LD	A,14		;自己書き換え
  EEF0  213CEF        		LD	HL,DMAD
  EEF3  CD91DF        		CALL	SETDMA
  EEF6  ED49          		OUT	(C),C		;OUT 01F87H,087H WR6 イネーブル
  EEF8  3A5AEE        		LD	A,(FDCPAT+1)
  EEFB  C5            		PUSH	BC
  EEFC  CD9EEE        		CALL	SECSET
  EEFF  2A47EF        		LD	HL,(DMAHL)
  EF02  23            		INC	HL
  EF03  1106BB        		LD	DE,0BB06H	;READ DMA
                      	
  EF06  3E03          		LD	A,3
  EF08  CD75EE        		CALL	READY
  EF0B  ED78          		IN	A,(C)
                      	
  EF0D  C1            		POP	BC
  EF0E  ED51          		OUT	(C),D		;読み出しマスク設定
  EF10  ED59          		OUT	(C),E		;バイトカウンタ(LH)
  EF12  ED58          		IN	E,(C)
  EF14  ED50          		IN	D,(C)
  EF16  19            		ADD	HL,DE
  EF17  D1            		POP	DE
  EF18  13            		INC	DE
  EF19  FB            		EI
  EF1A  CD92EE        		CALL	FDMOFF
  EF1D  B7            		OR	A
  EF1E  28AC          		JR	Z,DISKOK
  EF20  1B            		DEC	DE
  EF21  CB67          		BIT	4,A
  EF23  C4B6EE        		CALL	NZ,RNF
  EF26                	DISKE2:
  EF26  21BCEE        		LD	HL,RETRY
  EF29  35            		DEC	(HL)
  EF2A  20BB          		JR	NZ,DISK2
  EF2C  B7            		OR	A
  EF2D  280A          		JR	Z,ERR
  EF2F  D5            		PUSH	DE
  EF30                	ERRF:
  EF30  D1            		POP	DE
  EF31                	DELP:
  EF31  CDB6EE        		CALL	RNF
  EF34  CD92EE        		CALL	FDMOFF
  EF37  3EFF          		LD	A,0FFH
  EF39                	ERR:
  EF39  BF            		CP	A
  EF3A  37            		SCF
  EF3B  C9            		RET
                      	
                      				;X1turbo DISK DMA
  EF3C  C3            	DMAD:	DB	0C3H	;WR6 リセット
  EF3D  7D            		DB	07DH	;WR0 ポートA→ポートB 転送
  EF3E  FB0F          		DW	00FFBH	;ポートA開始アドレス FDC データレジスタ
  EF40  FFFF          		DW	0FFFFH	;ブロック長(転送サイズ-1)
  EF42  2C            		DB	02CH	;WR1 ポートAアドレス固定 I/O
  EF43  10            		DB	010H	;WR2 ポートBインクリメント
  EF44  80            		DB	080H	;WR3
  EF45  92            		DB	092H	;WR5 WAIT RDY:LOW
  EF46  8D            		DB	08DH	;WR4 バイト ポートB開始アドレス(LH)
  EF47  0000          	DMAHL:	DW	0	;ポートB開始アドレス
  EF49  CF            		DB	0CFH	;WR6 ロード
  EF4A  01            		DB	001H	;WR0 ポートB←ポートB 転送
  EF4B  CF            		DB	0CFH	;WR6 ロード
                      	
  EF4C                	DMAE:
                      	
  1E1C                	AT_R	EQU	WTTRK-AT_DWT
  EF4C                	AT_TABLE:
                      	
                      	;LDCCPWK.ASM
                      	
                      	;	LSX-Dodgers CCP WORK
                      	
  0040                	PATHX	EQU	64
  EF4C                	PATHD:	DS	PATHX
  EF8C  00            	PATHE:	DB	0
                      	
  EF8D                	DTA_CCP:
  EF8D                		DS	37
                      	
  EFB2                	FCB_BAT:
  EFB2                		DS	37
                      	
                      	
  EFD7  20627974657320	FREE:	DB	" bytes free",9,'$'
                      	
                      	;LDWORK.ASM
                      	
                      	;	LSX-Dodgers WORK0
                      	;
                      	;	CP/M互換BIOS
                      	;	BOOT:アドレス下位1バイトが0になるように
  EFE4                	AT_WORK:
  EFE4                		DS	WORKAD-AT_WORK
                      	
  F000                	CPM_BOOT:
  F000  C30000        		JP	0
  F003                	_SYS00:		;(BDOS)プログラム終了
  F003                	CPM_WBOOT:
  F003  C309D2        		JP	WBOOT1
  F006                	CPM_CONST:
  F006  C33FDC        		JP	CONSTX
  F009                	_SYS07:		;(BDOS)コンソール直接入力
  F009                	CPM_CONIN:
  F009  C3E6DB        		JP	FLGET
  F00C                	CPM_CONOUT:
  F00C  C384DE        		JP	CONOUT1
                      	
  F00F                	DECBF:				;10進数表示時のバッファ(5バイト)
  F00F                		DS	5
  F00F                	RR_BUF_HL	EQU	DECBF	;CP/M互換ファイルアクセスの際のランダムレコードの一時的な保管場所
  F011                	RR_BUF_A	EQU	DECBF+2	;計3バイト
                      	
  F014  00            	FDRV:	DB	0
  F015                	FNAME:	DS	36
  F039                	SFILE:	DS	33		;DRV FILENAME
                      	
  F05A                		DS	3
                      	
  F05D  0000          	LEFTX:	DW	0
  F05F  0000          	DTAX:	DW	0
                      	
  F061                	ZERO:
  F061                	BEEPD:
  F061  008E01000B000C		DB	0,08EH,1,0,00BH,0,00CH,010H
  F069  073E08100D00FF		DB	007H,03EH,008H,010H,00DH,0,0FFH
  F062                	RTC_YY	EQU	BEEPD+1
  F063                	RTC_MW	EQU	BEEPD+2
  F064                	RTC_DD	EQU	BEEPD+3
  F065                	RTC_TT	EQU	BEEPD+4
  F066                	RTC_MM	EQU	BEEPD+5
  F067                	RTC_SS	EQU	BEEPD+6
                      	
  F070  00            	CHECK:	DB	0
                      	
  F071  4F4B24        	OK:	DB	"OK$"
  F074                		DS	5
  F079  4572726F722124	COMERM:	DB	"Error!$"
                      	;	システムワークエリア
                      	;	_CYL0:アドレス下位1バイトが080Hになるように
  F080  FF            	_CYL0:	DB	0FFH	;Cylinder
  F081  FF            	_CYL1:	DB	0FFH	;Cylinder
  F082  FF            	_CYL2:	DB	0FFH	;Cylinder
  F083  FF            	_CYL3:	DB	0FFH	;Cylinder
  F084  00            	_DRIVE:	DB	0	;unit number
  F085  00            	_SEEKSP:DB	0	;Seek speed
  F086  FF            	_ISEEK:	DB	0FFH	;
  F087  00            	_DVSW:	DB	0
  F088  00            	_DRV:	DB	0
  F089  FF            	_DSK:	DB	0FFH
  F08A  8000          	_DTA:	DW	00080H
  F08C  0000          	_CTC:	DW	0
  F08E  0000          	_TXADR:	DW	0
  F090  0000          	_KEYPS:	DW	0
  F092  00FF          	_KEYD:	DW	0FF00H	;キーデータ
  F094  C210          	_KEYSP:	DB	KEYSP_L,KEYSP_H	;オートリピートの速度
  F096  07            	_COLORF:DB	COLORF	;色
  F097  18            	_LINE:	DB	LINE
                      	
  F098  0000          	_FCB:	DW	0	;SEARCH FILES
  F09A  0000          	_FBPS:	DW	0	;    //
  F09C  0000          	_FBAD:	DW	0	;    //
  F09E  00            	_FBCNT:	DB	0	;    //
  F09F  00            	_FILEN:	DB	0	;    //
  F0A0  00            	_DIRF:	DB	0	;bit7:ディレクトリ bit0-6:セクタインデックス
  F0A1                		DS	1
  F0A2  00            	_WTFATF:DB	0	;FATバッファの更新フラグ
  F0A3                		DS	1
  F0A4  00            	_WTDBF:	DB	0	;データバッファの更新フラグ
  F0A5  FF            	_DBDRV:	DB	0FFH	;データバッファにあるデータを読み込んだドライブ
  F0A6  0000          	_DBSEC:	DW	0	;データバッファにあるデータを読み込んだセクタ番号
  F0A8  0000          	_DPB:	DW	0
  F0AA                	_FATDRV:
  F0AA  FF            		DB	0FFH	;FATバッファに読み込んでいるドライブ
  F0AB  00            	_FATIX:	DB	0	;FATバッファに読み込んでいるインデックス
  F0AC                	_FAKEFREE:
  F0AC  0000          		DW	0	;偽の残量（FATサイズが大きくなると重くなるのでその対策）
                      	
  F0AE                		DS	2
                      	
  F0B0                	CRTCD:
  F0B0  6F            		DB	06FH
  F0B1                	_WIDTH:
  F0B1  50            		DB	WIDTH
  F0B2                	TVRAMTOP:
  F0B2  5938          		DB	059H,038H
  F0B4  1F02          		DB	01FH,002H
  F0B6                	_LINE2:
  F0B6  19            		DB	019H
  F0B7                	WKE4:
  F0B7  1C            		DB	01CH
  F0B8                	WKE6:
  F0B8  00            		DB	000H
  F0B9                	WK40:
  F0B9  07            		DB	007H
  F0BA                	_PAGE_MINUS:
  F0BA  80F8          		DW	0-WIDTH*LINE
  F0BC                	_WIDTH_MINUS:
  F0BC  B0FF          		DW	0-WIDTH
  F0BE                	WK30:
  F0BE  0C            		DB	00CH
  F0BF                	WK31:
  F0BF                	WK1FD0:
  F0BF  20            		DB	020H
                      	
  F0C0  2DDB          	CTC0:	DW	INTCTCE
  F0C2  2DDB          	CTC1:	DW	INTCTCE
  F0C4  30DB          	CTC2:	DW	INTCTC2
  F0C6  2DDB          	CTC3:	DW	INTCTCE
  F0C8  19DB          	INTVEC:	DW	INT
                      	
                      	;	LSX-Dodgers 独自BIOS
                      	
  F0CA  C367E0        	_INKEY:	JP	INKEY
  F0CD  C31FDD        	_PRINT:	JP	PRINT
  F0D0  C3CFDF        	_SCRN:	JP	SCRN
  F0D3  C3F9DF        	_POS:	JP	POS
  F0D6  C34DDE        	_LOC:	JP	LOC
  F0D9                	_CHGDRV:
  F0D9  C3F5EC        		JP	CHGDRV
  F0DC                	_GETDPB:
  F0DC  C3C0ED        		JP	GETDPB
  F0DF                	_FFLUSH:
  F0DF  C3DEED        		JP	FFLUSH
  F0E2                	_RDFATX:
  F0E2  C3CEE9        		JP	RDFATX
  F0E5  C3F6EA        	_RDFAT:	JP	RDFAT
  F0E8  C3BDEE        	_WTTRK:	JP	WTTRK
  F0EB  C3D1EE        	_FDRD:	JP	FDRD
  F0EE  C3C3EE        	_FDWT:	JP	FDWT
  F0F1                	_BPB2DPB:
  F0F1  C383EB        		JP	BPB2DPB
  F0F4                	_BREAK:
  F0F4  C3C2D3        		JP	END_BATCH
  F0F7                	_GNCL:
  F0F7  C370EA        	GNCPAT:	JP	GNCL		; self-modifying code
  F0FA                	_SNCL:
  F0FA  C393EA        	SNCPAT:	JP	SNCL		; self-modifying code
  F0FD  C37CD2        	_COMANL:JP	COMANL
                      	
  F100                	_WE:
                      	
                      	;LDCALL.ASM
                      	
                      	;	LSX-Dodgers システムコール(BDOS)
                      	;
                      	;	LSX-Dodgers SYSTEM CALL
                      	;	STABLE:アドレス下位1バイトが0になるように
                      	
  F100                	STABLE:
                      	;0
  F100  03F0B9DBC5DB1D		DW	_SYS00,_SYS01,_SYS02,_SYS03
  F108  5FD85FD8CADB09		DW	_SYS04,_SYS05,_SYS06,_SYS07
  F110  D2DB61D80BDC37		DW	_SYS08,_SYS09,_SYS0A,_SYS0B
  F118  76D87BD88AD89B		DW	_SYS0C,_SYS0D,_SYS0E,_SYS0F
                      	;1
  F120  EFD836D97FD9B5		DW	_SYS10,_SYS11,_SYS12,_SYS13
  F128  BDD9D3D9E8D9E0		DW	_SYS14,_SYS15,_SYS16,_SYS17
  F130  2FDA34DA39DA3F		DW	_SYS18,_SYS19,_SYS1A,_SYS1B
  F138  5FD865DA5FD869		DW	_SYS1C,_SYS1D,_SYS1E,_SYS1F
                      	;2
  F140  5FD81FDA27DA70		DW	_SYS20,_SYS21,_SYS22,_SYS23
  F148  96DA5FD8A2E67A		DW	_SYS24,_ERROR,_SYS26,_SYS27
  F150  27DA9FDA4DDC1D		DW	_SYS28,_SYS29,_SYS2A,_SYS2B
  F158  70DC1DE25FD8C0		DW	_SYS2C,_SYS2D,_SYS2E,_SYS2F
                      	;3
  F160  BADA5FD85FD85F		DW	_SYS30,_ERROR,_ERROR,_ERROR
  F168  5FD85FD85FD85F		DW	_ERROR,_ERROR,_ERROR,_ERROR
  F170  5FD81DE21DE2E1		DW	_ERROR,_SYS39,_SYS3A,_SYS5A
                      	;DOS2
  F178  42D8          		DW	_DOS2
                      	
  F17A                		DS	2
  F17C  00F3          	_FATBF:	DW	FATBF
  F17E  00FB          	_DTBUF:	DW	DTBUF
                      	
                      	;	コントロールコードテーブル
                      	;	CTRLTB:アドレス下位1バイトが080Hになるように
                      	
  F180                	CTRLTB:
  F180  C2DDC2DDFEDD43		DW	CTRL00,CTRL00,CTRL02,CTRL03	;  A,B,C
  F188  3DDF22DE1CDFA5		DW	CTRL04,CTRL05,CTRL06,CTRL07	;D,E,F,G
  F190  CEDDEFDD46DF63		DW	CTRL08,CTRL09,CTRL0A,CTRL0B	;H,I,J,K
  F198  19DF48DE5BDFC2		DW	CTRL0C,CTRL0D,CTRL0E,CTRL00	;L,M,N,O
  F1A0  C2DDC2DD5BDEC2		DW	CTRL00,CTRL00,CTRL12,CTRL00	;P,Q,R,S
  F1A8  C2DDC2DDC2DDC2		DW	CTRL00,CTRL00,CTRL00,CTRL00	;T,U,V,W
  F1B0  C2DDC2DD19DF6A		DW	CTRL00,CTRL00,CTRL0C,CTRL1B	;X,Y,Z,ESC
  F1B8  E9DDD5DDDEDD46		DW	CTRL1C,CTRL1D,CTRL1E,CTRL1F	;→,←,↑,↓
                      	
  F1C0  0200          	M2D:	DW	2
  F1C2  FD02          		DB	0FDH,2
  F1C4  6401          		DW	356
  F1C6  FF0728090182  		DB	0FFH,7,40,9,1,082H
  F1CC  0500A7000800  		DW	5,0A7H,8
                      	
  F1D2  0200          	M2HD:	DW	2
  F1D4  FE01          		DB	0FEH,1
  F1D6  C704          		DW	1223
  F1D8  FE064D080184  		DB	0FEH,6,77,8,1,084H
  F1DE  0500A7000900  		DW	5,0A7H,9
                      	
  F1E4                		DS	6
                      	
  F1EA  1617          	SDDATA:	DB	22,23		;(FCB)ファイルを最後に変更した時刻
  F1EC  1415          		DB	20,21		;(FCB)ファイルを最後に変更した日付
  F1EE  1A1B          		DB	26,27		;(FCB)ファイルの先頭クラスタ
  F1F0  10111213      		DB	16,17,18,19	;(FCB)ファイルのサイズ(バイト単位)
  F1F4                	SDDATAE:
                      	
  F1F4                	SCDIR:	DS	2		;+14 +15
  F1F6                	SFBPS:	DS	2		;FBPS
  F1F8                	SFNDF:	DS	2		;FILEN DIRF
                      	
  F1FA  0000          	_FATPS:	DW	0
  F1FC  0000          	_DIRPS:	DW	0
  F1FE  0000          	_CLPS:	DW	0
                      	
  F200                	_PE:
                      	
                      	;X1DPB.ASM
                      	
                      	;	LSX-Dodgers DPB
                      	;	X1/turbo/Z
                      	
  F200                	DEVICE:
                      	
                      	;	A:
                      	
  F200  0200          		DW	2	;DPB_00_FATLN
  F202  EBF0          		DW	_FDRD	;DPB_02_DRD
  F204  EEF0          		DW	_FDWT	;DPB_04_DWT
  F206  FD            		DB	0FDH	;DPB_06_FATID
  F207  02            		DB	2	;DPB_07_SECPCL
  F208  6401          		DW	356	;DPB_08_MAXCL
  F20A  FF            		DB	0FFH	;DPB_0A_FDMODE	0FFH=2D / 0FEH=2HD
  F20B  07            		DB	7	;DPB_0B_DIRSCNT
  F20C  28            		DB	40	;DPB_0C_MAXCYL
  F20D  09            		DB	9	;DPB_0D_MAXSEC	Number of sectors
  F20E  01            		DB	1	;DPB_0E_FATPS
  F20F  82            		DB	082H	;DPB_0F_BPS
  F210  0500          		DW	5	;DPB_10_DIRPS
  F212  A7            		DB	0A7H	;DPB_12_DEVICE	Device Number
  F213  00            		DB	0	;DPB_13_UNITNO
  F214  0800          		DW	8	;DPB_14_ADDCL16
  F216  0000          		DW	0	;DPB_16
  F218  0000          		DW	0	;DPB_18
  F21A  0000          		DW	0	;DPB_1A_SDIR
  F21C  46444430      		DB	"FDD0"	;DPB_1C_NAME
                      	
                      	;	B:
                      	
  F220  0200          		DW	2	;DPB_00_FATLN
  F222  EBF0          		DW	_FDRD	;DPB_02_DRD
  F224  EEF0          		DW	_FDWT	;DPB_04_DWT
  F226  FD            		DB	0FDH	;DPB_06_FATID
  F227  02            		DB	2	;DPB_07_SECPCL
  F228  6401          		DW	356	;DPB_08_MAXCL
  F22A  FF            		DB	0FFH	;DPB_0A_FDMODE	0FFH=2D / 0FEH=2HD
  F22B  07            		DB	7	;DPB_0B_DIRSCNT
  F22C  28            		DB	40	;DPB_0C_MAXCYL
  F22D  09            		DB	9	;DPB_0D_MAXSEC	Number of sectors
  F22E  01            		DB	1	;DPB_0E_FATPS
  F22F  82            		DB	082H	;DPB_0F_BPS
  F230  0500          		DW	5	;DPB_10_DIRPS
  F232  A7            		DB	0A7H	;DPB_12_DEVICE	Device Number
  F233  01            		DB	1	;DPB_13_UNITNO
  F234  0800          		DW	8	;DPB_14_ADDCL16
  F236  0000          		DW	0	;DPB_16
  F238  0000          		DW	0	;DPB_18
  F23A  0000          		DW	0	;DPB_1A_SDIR
  F23C  46444431      		DB	"FDD1"	;DPB_1C_NAME
                      	
                      	;	C:
                      	
  F240  0200          		DW	2	;DPB_00_FATLN
  F242  EBF0          		DW	_FDRD	;DPB_02_DRD
  F244  EEF0          		DW	_FDWT	;DPB_04_DWT
  F246  FD            		DB	0FDH	;DPB_06_FATID
  F247  02            		DB	2	;DPB_07_SECPCL
  F248  6401          		DW	356	;DPB_08_MAXCL
  F24A  FF            		DB	0FFH	;DPB_0A_FDMODE	0FFH=2D / 0FEH=2HD
  F24B  07            		DB	7	;DPB_0B_DIRSCNT
  F24C  28            		DB	40	;DPB_0C_MAXCYL
  F24D  09            		DB	9	;DPB_0D_MAXSEC	Number of sectors
  F24E  01            		DB	1	;DPB_0E_FATPS
  F24F  82            		DB	082H	;DPB_0F_BPS
  F250  0500          		DW	5	;DPB_10_DIRPS
  F252  A7            		DB	0A7H	;DPB_12_DEVICE	Device Number
  F253  02            		DB	2	;DPB_13_UNITNO
  F254  0800          		DW	8	;DPB_14_ADDCL16
  F256  0000          		DW	0	;DPB_16
  F258  0000          		DW	0	;DPB_18
  F25A  0000          		DW	0	;DPB_1A_SDIR
  F25C  46444432      		DB	"FDD2"	;DPB_1C_NAME
                      	
                      	;	D:
                      	
  F260  0200          		DW	2	;DPB_00_FATLN
  F262  EBF0          		DW	_FDRD	;DPB_02_DRD
  F264  EEF0          		DW	_FDWT	;DPB_04_DWT
  F266  FD            		DB	0FDH	;DPB_06_FATID
  F267  02            		DB	2	;DPB_07_SECPCL
  F268  6401          		DW	356	;DPB_08_MAXCL
  F26A  FF            		DB	0FFH	;DPB_0A_FDMODE	0FFH=2D / 0FEH=2HD
  F26B  07            		DB	7	;DPB_0B_DIRSCNT
  F26C  28            		DB	40	;DPB_0C_MAXCYL
  F26D  09            		DB	9	;DPB_0D_MAXSEC	Number of sectors
  F26E  01            		DB	1	;DPB_0E_FATPS
  F26F  82            		DB	082H	;DPB_0F_BPS
  F270  0500          		DW	5	;DPB_10_DIRPS
  F272  A7            		DB	0A7H	;DPB_12_DEVICE
  F273  03            		DB	3	;DPB_13_UNITNO
  F274  0800          		DW	8	;DPB_14_ADDCL16
  F276  0000          		DW	0	;DPB_16
  F278  0000          		DW	0	;DPB_18
  F27A  0000          		DW	0	;DPB_1A_SDIR
  F27C  46444433      		DB	"FDD3"	;DPB_1C_NAME
                      	
                      	;	E:
                      	
  F280  0000          	EMMFL:	DW	0	;DPB_00_FATLN
  F282  E8D7          	EMMRD:	DW	EDRD	;DPB_02_DRD
  F284  E4D7          	EMMWR:	DW	EDWT	;DPB_04_DWT
  F286  FE            		DB	0FEH	;DPB_06_FATID
  F287  02            		DB	2	;DPB_07_SECPCL
  F288  0000          	EMMCL:	DW	0	;DPB_08_MAXCL
  F28A  00            		DB	0	;DPB_0A_FDMODE
  F28B  0C            		DB	12	;DPB_0B_DIRSCNT
  F28C  00            		DB	0	;DPB_0C_MAXCYL
  F28D  00            		DB	0	;DPB_0D_MAXSEC
  F28E  02            		DB	2	;DPB_0E_FATPS
  F28F  02            		DB	2	;DPB_0F_BPS
  F290  0A00          		DW	10	;DPB_10_DIRPS
  F292  06            	EMMDV:	DB	6	;DPB_12_DEVICE
  F293  00            		DB	0	;DPB_13_UNITNO
  F294  1200          		DW	18	;DPB_14_ADDCL16
  F296  0000          		DW	0	;DPB_16
  F298  0000          		DW	0	;DPB_18
  F29A  0000          		DW	0	;DPB_1A_SDIR
  F29C  454D4D30      		DB	"EMM0"	;DPB_1C_NAME
                      	
                      	;	F:
                      	
  F2A0  0000          	BANKFL:	DW	0	;DPB_00_FATLN
  F2A2  7CD7          		DW	BDRD	;DPB_02_DRD
  F2A4  78D7          		DW	BDWT	;DPB_04_DWT
  F2A6  F9            		DB	0F9H	;DPB_06_FATID
  F2A7  02            		DB	2	;DPB_07_SECPCL
  F2A8  0000          	BANKCL:	DW	0	;DPB_08_MAXCL
  F2AA  00            		DB	0	;DPB_0A_FDMODE
  F2AB  08            		DB	8	;DPB_0B_DIRSCNT
  F2AC  00            		DB	0	;DPB_0C_MAXCYL
  F2AD  01            		DB	1	;DPB_0D_MAXSEC
  F2AE  00            		DB	0	;DPB_0E_FATPS
  F2AF  02            		DB	2	;DPB_0F_BPS
  F2B0  0200          		DW	2	;DPB_10_DIRPS
  F2B2  0B            	BANKDV:	DB	00BH	;DPB_12_DEVICE
  F2B3  00            		DB	0	;DPB_13_UNITNO
  F2B4  0600          		DW	6	;DPB_14_ADDCL16
  F2B6  0000          		DW	0	;DPB_16
  F2B8  0000          		DW	0	;DPB_18
  F2BA  0000          		DW	0	;DPB_1A_SDIR
  F2BC  4252414D      		DB	"BRAM"	;DPB_1C_NAME
                      	
                      	;	G:
                      	
  F2C0  0200          		DW	2	;DPB_00_FATLN
  F2C2  39D7          		DW	GDRD	;DPB_02_DRD
  F2C4  50D7          		DW	GDWT	;DPB_04_DWT
  F2C6  FA            		DB	0FAH	;DPB_06_FATID
  F2C7  01            		DB	1	;DPB_07_SECPCL
  F2C8  B800          		DW	184	;DPB_08_MAXCL
  F2CA  00            		DB	0	;DPB_0A_FDMODE
  F2CB  07            		DB	7	;DPB_0B_DIRSCNT
  F2CC  00            		DB	0	;DPB_0C_MAXCYL
  F2CD  01            		DB	1	;DPB_0D_MAXSEC
  F2CE  01            		DB	1	;DPB_0E_FATPS
  F2CF  01            		DB	1	;DPB_0F_BPS
  F2D0  0300          		DW	3	;DPB_10_DIRPS
  F2D2  05            		DB	5	;DPB_12_DEVICE
  F2D3  01            		DB	1	;DPB_13_UNITNO
  F2D4  0800          		DW	8	;DPB_14_ADDCL16
  F2D6  0000          		DW	0	;DPB_16
  F2D8  0000          		DW	0	;DPB_18
  F2DA  0000          		DW	0	;DPB_1A_SDIR
  F2DC  4752414D      		DB	"GRAM"	;DPB_1C_NAME
                      	
                      	;	H:
  F2E0                		DS	32-8
  F2F8  00            		DB	0
                      	
                      	
  F2F9                	LAST_ADR:
                      	
  F2F9                		END
