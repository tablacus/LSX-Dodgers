			  Z80 ASSEMBLER - ZASM VER 1.6
                      	;	LSX-Dodgers for X1/turbo/Z
                      	;	Programmed by
                      	;	Gaku (Lovers/Tablacus)
                      	;X1DEF.ASM
                      	
                      	;	LSX-Dodgers DEF
                      	;	X1/turbo/Z
                      	
  0000                	MAC	EQU	0		;X1
  0000                	DEV EQU 0
                      	
  CC00                	RUN	EQU	0CC00H
  D206                	BDOS	EQU	0D206H
  F000                	WORKAD	EQU	0F000H
  F300                	FATBF	EQU	0F300H
  FB00                	DTBUF	EQU	0FB00H
  FF00                	KEYBF	EQU	0FF00H
  FF20                	KBUF	EQU	0FF20H
  FFCA                	EXTSP	EQU	0FFCAH
  FFD9                	TRAP38	EQU	0FFD9H
  0050                	WIDTH	EQU	80
  0018                	LINE	EQU	24
  0007                	COLORF	EQU	7
  0010                	KEYSP_H	EQU	16
  00C2                	KEYSP_L	EQU	0C2H
  0009                	COMS	EQU	9
                      	
                      	
                      	;LDDEF.ASM
                      	
                      	;	LSX-Dodgers DEF
                      	
  0001                	VER_1   EQU	1
  0005                	VER_2   EQU	5
  0004                	VER_3   EQU	4
  1D00                	MACW	EQU	MAC + 01D00H	;機種フラグとLD判別フラグ
  0000                	MACD	EQU	MAC + DEV * 256	;機種フラグとデバイスフラグ
  0154                	VER	EQU	VER_1 * 256 + VER_2 * 16 + VER_3
                      	
  0005                	SYSTEM	EQU	00005H
  000F                	JP_HL	EQU	0000FH
  005C                	FCB1	EQU	0005CH
  006C                	FCB2	EQU	0006CH
  005D                	FCB1FN	EQU	FCB1+1
  006D                	FCB2FN	EQU	FCB2+1
  0080                	DTA1	EQU	00080H
                      	
  FFCA                	EXTBIO	EQU	0FFCAH
                      	
                      	
                      	
  CBF9                		ORG	RUN-7
                      	
                      	;	MSX BINARY HEADER
  CBF9  FE            		DB	0FEH
                      	;	MSX BINARY START ADDRESS
  CBFA  00CC          		DW	RUN
                      	;	MSX BINARY END ADDRESS
  CBFC  F9F2          		DW	LAST_ADR
                      	;	MSX BINARY EXEC ADDRESS
  CBFE  07CC          		DW	START
                      	;X1INIT.ASM
                      	
                      	;	LSX-Dodgers INIT
                      	;	X1/turbo/Z
                      	
  CC00  C307CC        		JP	START
  CC03  001D          		DW	MACW
  CC05  5401          		DW	VER
                      	
  CC07                	START:
  CC07  F3            		DI
  CC08  ED5E          		IM	2
  CC0A  31CAFF        		LD	SP,EXTSP
  CC0D  CD1BCC        		CALL	INIT		;NZならAUTOEXECを実行
  CC10  210000        		LD	HL,0
  CC13  E5            		PUSH	HL
  CC14  C8            		RET	Z
  CC15  1199CF        		LD	DE,AUTOD
  CC18  C3FDF0        		JP	_COMANL
                      	
  CC1B                	INIT:
  CC1B  3E1E          		LD	A,01EH
  CC1D  D300          		OUT	(0),A
                      	
  CC1F  010000        		LD	BC,0
  CC22  ED438CF0      		LD	(_CTC),BC
  CC26  01040A        		LD	BC,00A04H
  CC29  CD43CF        		CALL	CHKCTC
  CC2C  010407        		LD	BC,00704H
  CC2F  CD43CF        		CALL	CHKCTC
  CC32  01A81F        		LD	BC,01FA8H
  CC35  CD43CF        		CALL	CHKCTC
  CC38  01A01F        		LD	BC,01FA0H
  CC3B  CD43CF        		CALL	CHKCTC
                      	;
  CC3E                	INISIO:
  CC3E  01911F        		LD	BC,01F91H	;INIT SIO
  CC41  1601          		LD	D,1
  CC43  ED51          		OUT	(C),D
                      	
  CC45  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  CC47  0E93          		LD	C,093H
  CC49  ED51          		OUT	(C),D
  CC4B  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  CC4D  0E99          		LD	C,099H		;INIT SIO
  CC4F  1601          		LD	D,1
  CC51  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  CC53  0E9B          		LD	C,09BH
  CC55  ED51          		OUT	(C),D
  CC57  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
                      	
  CC59  0E80          		LD	C,080H		;INIT DMA
  CC5B  2106C3        		LD	HL,0C306H
  CC5E                	INIDMA:
  CC5E  ED61          		OUT	(C),H
  CC60  2D            		DEC	L
  CC61  20FB          		JR	NZ,INIDMA
                      	
  CC63  3EE4          		LD	A,0E4H
  CC65  CDDDDE        		CALL	COMOUT
  CC68  AF            		XOR	A
  CC69  CDB7DE        		CALL	OT49SB
                      	
  CC6C  3EF0          		LD	A,INTVEC/256
  CC6E  ED47          		LD	I,A
                      	
  CC70  ED4B8CF0      		LD	BC,(_CTC)
  CC74  0D            		DEC	C
  CC75  0D            		DEC	C
                      	
  CC76  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  CC78  3EC0          		LD	A,CTC0
  CC7A  ED79          		OUT	(C),A
                      	
  CC7C  0C            		INC	C
  CC7D  3E47          		LD	A,047H
  CC7F  ED79          		OUT	(C),A
  CC81  3E0D          		LD	A,13		;Baudrate 9600-13
  CC83  ED79          		OUT	(C),A
                      	
  CC85  79            		LD	A,C
  CC86  D610          		SUB	010H
  CC88  4F            		LD	C,A
                      	;	LD	(SIOAD+1),BC
                      	;	LD	(SIOAD0+1),BC
                      	;	LD	(SIOAD1+1),BC
                      	
  CC89  21E9CF        		LD	HL,SIODATA
  CC8C                	SINIT1:
  CC8C  7E            		LD	A,(HL)
  CC8D  23            		INC	HL
  CC8E  FEFF          		CP	0FFH
  CC90  2804          		JR	Z,SINIT2
  CC92  ED79          		OUT	(C),A
  CC94  18F6          		JR	SINIT1
  CC96                	SINIT2:
  CC96  3EE4          		LD	A,0E4H
  CC98  CDDDDE        		CALL	COMOUT
  CC9B  3EC8          		LD	A,INTVEC
  CC9D  CDB7DE        		CALL	OT49SB
                      	;
  CCA0  01C41F        		LD	BC,01FC4H
  CCA3  3E0C          		LD	A,00CH
  CCA5  ED79          		OUT	(C),A
                      	
  CCA7  0EC0          		LD	C,0C0H
  CCA9  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
                      	
  CCAB  0C            		INC	C
  CCAC  3E28          		LD	A,40
  CCAE  ED79          		OUT	(C),A
                      	
  CCB0  0C            		INC	C
  CCB1  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
                      	
  CCB3  0C            		INC	C
  CCB4  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
                      	
  CCB6  0EC5          		LD	C,0C5H
  CCB8  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
                      	
  CCBA                	TEXT:
  CCBA  0EB0          		LD	C,0B0H
  CCBC  3E80          		LD	A,080H
  CCBE  ED79          		OUT	(C),A
  CCC0  1607          		LD	D,7
  CCC2  0EB9          		LD	C,0B9H
  CCC4  21E2CF        		LD	HL,TEXTDT
  CCC7                	TEXT1:
  CCC7  04            		INC	B
  CCC8  EDA3          		OUTI
  CCCA  0C            		INC	C
  CCCB  15            		DEC	D
  CCCC  20F9          		JR	NZ,TEXT1
  CCCE  01B01F        		LD	BC,01FB0H
  CCD1  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
                      	
  CCD3  0EC4          		LD	C,0C4H
  CCD5  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
                      	
  CCD7  01011A        		LD	BC,01A01H
  CCDA  ED78          		IN	A,(C)
  CCDC  E608          		AND	8
  CCDE  2809          		JR	Z,PRN
  CCE0  0E03          		LD	C,003H
  CCE2  3E0F          		LD	A,00FH
  CCE4  ED79          		OUT	(C),A
  CCE6  01040A        		LD	BC,00A04H
  CCE9                	PRN:
  CCE9  210000        		LD	HL,0
  CCEC  065C          		LD	B,05CH
  CCEE  3EFF          		LD	A,0FFH		;RST 38H
  CCF0  CD37E1        		CALL	FILL_MEMORY
  CCF3  06A4          		LD	B,0A4H
  CCF5  AF            		XOR	A
  CCF6  CD37E1        		CALL	FILL_MEMORY
                      	
  CCF9  3EC3          		LD	A,0C3H		;JP
  CCFB  2103F0        		LD	HL,CPM_WBOOT
  CCFE  320000        		LD	(00000H),A
  CD01  220100        		LD	(00001H),HL	;IPL
                      	
  CD04  21001D        		LD	HL,MACW	;3 bit7  DPB Compatible LA(1)
  CD07  220300        		LD	(00003H),HL	;  bit6-0 Machine X1(0)
                      	;				;4 LSX-Dodgers(01DH)
  CD0A  2106D2        		LD	HL,BDOS
  CD0D  320500        		LD	(00005H),A
  CD10  220600        		LD	(00006H),HL	;BDOS
                      	
  CD13  21F7DA        		LD	HL,BIOS
  CD16  221900        		LD	(00019H),HL	;BIOS-ROM
                      	
  CD19  21D9FF        		LD	HL,TRAP38	;TRAP38
  CD1C  323800        		LD	(00038H),A
  CD1F  223900        		LD	(00039H),HL	;RST 038H
                      	
  CD22  3EF0          		LD	A,CPM_BOOT/256
  CD24  320B00        		LD	(0000BH),A
                      	
  CD27  3EE9          		LD	A,0E9H		;JP (HL)
  CD29  320F00        		LD	(0000FH),A
                      	
  CD2C  3EE6          		LD	A,0E6H
  CD2E  CDDDDE        		CALL	COMOUT
  CD31  CDC2DE        		CALL	IN49SB
  CD34  F5            		PUSH	AF
  CD35  CDC2DE        		CALL	IN49SB
  CD38  F1            		POP	AF
  CD39  F5            		PUSH	AF
  CD3A  E612          		AND	012H
  CD3C  2005          		JR	NZ,KEYR
  CD3E  3E01          		LD	A,1
  CD40  3296CE        		LD	(KEYREP+1),A
  CD43                	KEYR:
  CD43  F1            		POP	AF
  CD44  E603          		AND	3
  CD46  280E          		JR	Z,NON
                      	
  CD48  01D03F        		LD	BC,03FD0H
  CD4B  ED49          		OUT	(C),C
  CD4D  3E37          		LD	A,037H
  CD4F  D3D0          		OUT	(0D0H),A
  CD51  ED78          		IN	A,(C)
  CD53  B9            		CP	C
  CD54  2865          		JR	Z,TURBO
  CD56                	NON:
  CD56  211CD0        		LD	HL,AT_SCR1
  CD59  1167DF        		LD	DE,SCR1
  CD5C  019400        		LD	BC,SCRNE-SCR1	;転送先のサイズ確認用
  CD5F  018500        		LD	BC,AT_SCRE-AT_SCR1
  CD62  EDB0          		LDIR
                      	
  CD64  21A1D0        		LD	HL,AT_DWT
  CD67  11D9EE        		LD	DE,WTTRK
  CD6A  018F00        		LD	BC,DMAE-WTTRK	;転送先のサイズ確認用
  CD6D  018E00        		LD	BC,AT_CPUE-AT_DWT
  CD70  EDB0          		LDIR
                      	
  CD72  212FD1        		LD	HL,AT_EDWT
  CD75  11E4D7        		LD	DE,EDWT
  CD78  014B00        		LD	BC,EMME-EDWT	;転送先のサイズ確認用
  CD7B  014600        		LD	BC,AT_EMME-AT_EDWT
  CD7E  EDB0          		LDIR
                      	
  CD80  21E2DF        		LD	HL,AT_WTTRK+AT_RS
  CD83  22E9F0        		LD	(_WTTRK+1),HL
  CD86  2122EF        		LD	HL,AT_DRD+AT_R
  CD89  22ECF0        		LD	(_FDRD+1),HL
  CD8C  21D9EE        		LD	HL,AT_DWT+AT_R
  CD8F  22EFF0        		LD	(_FDWT+1),HL
  CD92  21F8D7        		LD	HL,AT_EDRD+AT_RE
  CD95  2282F2        		LD	(EMMRD),HL
  CD98  21E4D7        		LD	HL,AT_EDWT+AT_RE
  CD9B  2284F2        		LD	(EMMWR),HL
  CD9E  21E9DF        		LD	HL,AT_SCRN+AT_RS
  CDA1  22D1F0        		LD	(_SCRN+1),HL
                      	
  CDA4  3E27          		LD	A,027H			;ノンターボはMFM切り替えを行わない
  CDA6  3212F2        		LD	(DEVICE+012H),A		;Aドライブ
  CDA9  3232F2        		LD	(DEVICE+012H+32),A	;Bドライブ
  CDAC  3252F2        		LD	(DEVICE+012H+32*2),A	;Cドライブ
  CDAF  3272F2        		LD	(DEVICE+012H+32*3),A	;Dドライブ
                      	
  CDB2  210000        		LD	HL,0
  CDB5  2208DF        		LD	(X1PAT),HL
  CDB8  C344CE        		JP	NOBANK
                      	
  CDBB                	TURBO:
  CDBB  F3            		DI			;Check BIOS
  CDBC  061D          		LD	B,01DH
  CDBE  ED79          		OUT	(C),A		;BIOS ON
  CDC0  3A512F        		LD	A,(02F51H)
  CDC3  04            		INC	B		;B=01EH
  CDC4  ED79          		OUT	(C),A		;BIOS OFF
  CDC6  FB            		EI
  CDC7  FEC9          		CP	0C9H
  CDC9  2802          		JR	Z,BIOSOK
  CDCB  1805          		JR	NOBIOS
  CDCD                	BIOSOK:
  CDCD  3EC3          		LD	A,0C3H		;JP
  CDCF  321800        		LD	(00018H),A
  CDD2                	NOBIOS:
  CDD2  3E1F          		LD	A,01FH		;スタートポート
  CDD4  DBF0          		IN	A,(0F0H)
  CDD6  0F            		RRCA
  CDD7  380B          		JR	C,CRT1
  CDD9  21D2CF        		LD	HL,_C8025H
  CDDC  11B0F0        		LD	DE,CRTCD
  CDDF  011000        		LD	BC,16
  CDE2  EDB0          		LDIR
  CDE4                	CRT1:
  CDE4  3E1F          		LD	A,01FH		;スタートポート
  CDE6  DBF0          		IN	A,(0F0H)
  CDE8  CB57          		BIT	2,A
  CDEA  2818          		JR	Z,BANK
                      	
  CDEC  AF            		XOR	A
  CDED                	TZ1:				;前面スイッチが2HDの場合はMFMモードを2HDにしておく
  CDED  F5            		PUSH	AF
  CDEE  CDDCF0        		CALL	_GETDPB
  CDF1  DD7E12        		LD	A,(IX+012H)	;DPB_12_DEVICE
  CDF4  E68F          		AND	08FH
  CDF6  FE87          		CP	087H		;フロッピーでMEM切り替えがON
  CDF8  2004          		JR	NZ,TZ2
  CDFA  DDCB0A86      		RES	0,(IX+0AH)	;(DPB_0A_FDMODE)
  CDFE                	TZ2:
  CDFE  F1            		POP	AF
  CDFF  3C            		INC	A
  CE00  FE08          		CP	8
  CE02  38E9          		JR	C,TZ1
                      	
  CE04                	BANK:
  CE04  01000B        		LD	BC,00B00H
  CE07  21007F        		LD	HL,07F00H
  CE0A  F3            		DI
  CE0B  ED69          		OUT	(C),L
  CE0D  3A0000        		LD	A,(0)
  CE10  FEEB          		CP	0EBH
  CE12  2005          		JR	NZ,BANK1
  CE14  3E2B          		LD	A,02BH
  CE16  32B2F2        		LD	(BANKDV),A
  CE19                	BANK1:
  CE19  ED69          		OUT	(C),L
  CE1B  5E            		LD	E,(HL)
  CE1C  7B            		LD	A,E
  CE1D  C6A5          		ADD	A,0A5H
  CE1F  77            		LD	(HL),A
  CE20  BE            		CP	(HL)
  CE21  73            		LD	(HL),E
  CE22  2005          		JR	NZ,BANK2
  CE24  2C            		INC	L
  CE25  CB65          		BIT	4,L
  CE27  28F0          		JR	Z,BANK1
  CE29                	BANK2:
  CE29  3E10          		LD	A,010H
  CE2B  ED79          		OUT	(C),A
  CE2D  7D            		LD	A,L
  CE2E  B7            		OR	A
  CE2F  2813          		JR	Z,NOBANK
  CE31  2600          		LD	H,0
  CE33  29            		ADD	HL,HL	;*2
  CE34  29            		ADD	HL,HL	;*4
  CE35  29            		ADD	HL,HL	;*8
  CE36  29            		ADD	HL,HL	;*16
  CE37  29            		ADD	HL,HL	;*32
  CE38  2B            		DEC	HL	;-1
  CE39  2B            		DEC	HL	;-2
  CE3A  2B            		DEC	HL	;-3
  CE3B  22A8F2        		LD	(BANKCL),HL
  CE3E  CD89CF        		CALL	CALC_FATLN
  CE41  32A0F2        		LD	(BANKFL),A
  CE44                	NOBANK:
  CE44                	EMM:
  CE44  DD2180F2      		LD	IX,EMMFL
  CE48  CD3ACF        		CALL	EADR0
  CE4B  ED78          		IN	A,(C)
  CE4D  F5            		PUSH	AF
                      	
  CE4E  110000        		LD	DE,0
  CE51                	ECHECK1:
  CE51  13            		INC	DE
  CE52  CD1ECF        		CALL	EADR2
  CE55  ED60          		IN	H,(C)
  CE57  CD1ECF        		CALL	EADR2
  CE5A  7C            		LD	A,H
  CE5B  C6E5          		ADD	A,0E5H
  CE5D  ED79          		OUT	(C),A
  CE5F  3C            		INC	A
  CE60  CD3ACF        		CALL	EADR0
  CE63  ED79          		OUT	(C),A
  CE65  3D            		DEC	A
  CE66  CD1ECF        		CALL	EADR2
  CE69  ED68          		IN	L,(C)
  CE6B  CD1ECF        		CALL	EADR2
  CE6E  ED61          		OUT	(C),H
  CE70  BD            		CP	L
  CE71  2004          		JR	NZ,ECHECK2
  CE73  CB5A          		BIT	3,D
  CE75  28DA          		JR	Z,ECHECK1
  CE77                	ECHECK2:
  CE77  CD3ACF        		CALL	EADR0
  CE7A  F1            		POP	AF
  CE7B  ED79          		OUT	(C),A
  CE7D  FEEB          		CP	0EBH
  CE7F  2005          		JR	NZ,EMM_BPB
  CE81  3E26          		LD	A,026H
  CE83  3292F2        		LD	(EMMDV),A
  CE86                	EMM_BPB:
  CE86  21F7FF        		LD	HL,0-9
  CE89  19            		ADD	HL,DE
  CE8A  3009          		JR	NC,NOEMM
  CE8C  2288F2        		LD	(EMMCL),HL
  CE8F  CD89CF        		CALL	CALC_FATLN
  CE92  3280F2        		LD	(EMMFL),A
  CE95                	NOEMM:
  CE95  3E00          	KEYREP:	LD	A,000H
  CE97  B7            		OR	A
  CE98  2807          		JR	Z,KEYR1
  CE9A  010000        		LD	BC,0
  CE9D  ED438CF0      		LD	(_CTC),BC
  CEA1                	KEYR1:
  CEA1  CD6ACF        		CALL	SETCRTC
  CEA4  0130F8        		LD	BC,0-80*25
  CEA7  2ABAF0        		LD	HL,(_PAGE_MINUS)
  CEAA  ED43BAF0      		LD	(_PAGE_MINUS),BC
  CEAE  1E0C          		LD	E,00CH
  CEB0  CDCDF0        		CALL	_PRINT
  CEB3  22BAF0        		LD	(_PAGE_MINUS),HL
                      	
  CEB6  21A5CF        		LD	HL,INIMES
  CEB9  CD70D8        		CALL	MSX
                      	
  CEBC  3A87FF        		LD	A,(0FF87H)
  CEBF  FE08          		CP	8
  CEC1  301E          		JR	NC,INIT0
  CEC3  5F            		LD	E,A
  CEC4  C641          		ADD	A,'A'
  CEC6  32A2CF        		LD	(AUTODV),A
  CEC9  0E0E          		LD	C,00EH
  CECB  CD0500        		CALL	SYSTEM
  CECE  1C            		INC	E
  CECF  2185F0        		LD	HL,_SEEKSP	;Disk error Ignore
  CED2  CBFE          		SET	7,(HL)
  CED4  0E1B          		LD	C,01BH
  CED6  CD0500        		CALL	SYSTEM
                      	
  CED9  2185F0        		LD	HL,_SEEKSP
  CEDC  CBBE          		RES	7,(HL)
                      	
  CEDE  3C            		INC	A
  CEDF  2008          		JR	NZ,INIT1
  CEE1                	INIT0:
  CEE1  1E00          		LD	E,0
  CEE3  0E0E          		LD	C,00EH
  CEE5  CD0500        		CALL	SYSTEM
  CEE8  AF            		XOR	A
  CEE9                	INIT1:
  CEE9  F3            		DI
  CEEA  08            		EX	AF,AF'
  CEEB  2EFE          		LD	L,0-2		;CALLのスタック分減らす
  CEED  39            		ADD	HL,SP
  CEEE  1100FF        		LD	DE,0FF00H
  CEF1  45            		LD	B,L
  CEF2  CDD3D5        		CALL	ZERO_MEMORY_DE
  CEF5  21CAFF        		LD	HL,EXTBIO
  CEF8  36C9          		LD	(HL),0C9H	;RET
  CEFA  23            		INC	HL
  CEFB  060E          		LD	B,TRAP38-EXTBIO-1
  CEFD  3EFF          		LD	A,0FFH		;RST 38H
  CEFF  CD37E1        		CALL	FILL_MEMORY
  CF02  21F5CF        		LD	HL,AT_TRAP38
  CF05  11D9FF        		LD	DE,TRAP38
  CF08  012700        		LD	BC,AT_TRAPE-AT_TRAP38
  CF0B  EDB0          		LDIR
  CF0D  08            		EX	AF,AF'
  CF0E  B7            		OR	A
  CF0F  C8            		RET	Z
                      	
  CF10  3EE6          		LD	A,0E6H
  CF12  CDDDDE        		CALL	COMOUT
  CF15  CDC2DE        		CALL	IN49SB
  CF18  CDC2DE        		CALL	IN49SB
  CF1B  FE1B          		CP	01BH
  CF1D  C9            		RET
                      	
  CF1E                	EADR2:
  CF1E  D5            		PUSH	DE
  CF1F  EB            		EX	DE,HL
  CF20  29            		ADD	HL,HL
  CF21  29            		ADD	HL,HL
  CF22  DD4E0D        		LD	C,(IX+00DH)	;DPB_0D_MAXSEC
  CF25  DD460C        		LD	B,(IX+00CH)	;DPB_0C_MAXCYL
  CF28  09            		ADD	HL,BC
  CF29  DD4E13        		LD	C,(IX+013H)	;DPB_13_UNITNO
  CF2C  060D          		LD	B,00DH
  CF2E  ED49          		OUT	(C),C
  CF30  0C            		INC	C
  CF31  ED69          		OUT	(C),L
  CF33  0C            		INC	C
  CF34  ED61          		OUT	(C),H
  CF36  0C            		INC	C
  CF37  EB            		EX	DE,HL
  CF38  D1            		POP	DE
  CF39  C9            		RET
                      	
  CF3A                	EADR0:
  CF3A  D5            		PUSH	DE
  CF3B  110000        		LD	DE,0
  CF3E  CD1ECF        		CALL	EADR2
  CF41  D1            		POP	DE
  CF42  C9            		RET
                      	
  CF43                	CHKCTC:
  CF43  C5            		PUSH	BC
  CF44  110347        		LD	DE,04703H
  CF47                	INICTC1:
  CF47  0C            		INC	C
  CF48  ED51          		OUT	(C),D
  CF4A  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  CF4C  1D            		DEC	E
  CF4D  20F8          		JR	NZ,INICTC1
  CF4F  C1            		POP	BC
                      	
  CF50  11FA07        		LD	DE,007FAH
  CF53  ED51          		OUT	(C),D
  CF55  ED59          		OUT	(C),E
  CF57  ED78          		IN	A,(C)
  CF59  BB            		CP	E
  CF5A  C0            		RET	NZ
  CF5B  ED51          		OUT	(C),D
  CF5D  ED51          		OUT	(C),D
  CF5F  ED78          		IN	A,(C)
  CF61  BA            		CP	D
  CF62  C0            		RET	NZ
  CF63  0C            		INC	C
  CF64  0C            		INC	C
  CF65  ED438CF0      		LD	(_CTC),BC
  CF69  C9            		RET
                      	
  CF6A                	SETCRTC:
  CF6A  21B0F0        		LD	HL,CRTCD
  CF6D  AF            		XOR	A
  CF6E                	SETCRT1:
  CF6E  010018        		LD	BC,01800H
  CF71  ED79          		OUT	(C),A
  CF73  0C            		INC	C
  CF74  04            		INC	B
  CF75  EDA3          		OUTI
  CF77  3C            		INC	A
  CF78  FE0C          		CP	12
  CF7A  20F2          		JR	NZ,SETCRT1
  CF7C  23            		INC	HL
  CF7D  23            		INC	HL
  CF7E  01031B        		LD	BC,01A03H+00100H
  CF81  EDA3          		OUTI
  CF83  01D020        		LD	BC,01FD0H+00100H
  CF86  EDA3          		OUTI
  CF88  C9            		RET
                      	
  CF89                	CALC_FATLN:	;FAT12のクラスタ数から必要なFATサイズを求める(セクタサイズ512)
  CF89  5D            		LD	E,L
  CF8A  54            		LD	D,H
  CF8B  29            		ADD	HL,HL	;*2
  CF8C  19            		ADD	HL,DE	;*3
  CF8D  CB3C          		SRL	H	;/2
  CF8F  CB1D          		RR	L	;1クラスタ辺り1.5バイト必要
  CF91  11FF01        		LD	DE,511	;切り上げる
  CF94  19            		ADD	HL,DE
  CF95  7C            		LD	A,H
  CF96  CB3F          		SRL	A
  CF98  C9            		RET
                      	
  CF99  4155544F455845	AUTOD:	DB	"AUTOEXEC "
  CFA2  413A00        	AUTODV:	DB	"A:",0
                      	
  CFA5  4C53582D446F64	INIMES:	DB	"LSX-Dodgers for X1/turbo version "
  CFC6  312E          		DB	030H + VER_1, '.'
  CFC8  3534          		DB	030H + VER_2 ,030H + VER_3
                      	;	DB	""
  CFCA  2047616B750D0A		DB	' Gaku',0DH,0AH
  CFD1  00            		DB	0
                      	
  CFD2                	_C8025H:
  CFD2  6B5059881B0119		DB	06BH,050H,059H,088H,01BH,001H,019H,01AH
  CFDA  000F          		DB	000H,00FH
  CFDC  80F8B0FF      		DW	0-80*LINE,0-80
  CFE0  0C23          		DB	00CH,023H
                      	
  CFE2  030C0F30333C3F	TEXTDT:	DB	003H,00CH,00FH,030H,033H,03CH,03FH
                      	
  CFE9                	SIODATA:
  CFE9  18            		DB	018H
  CFEA  0100          		DB	1,0
  CFEC  0200          		DB	2,0
  CFEE  03C1          		DB	3,0C1H
  CFF0  0444          		DB	4,044H
  CFF2  05E8          		DB	5,0E8H
  CFF4  FF            		DB	0FFH
                      	
  CFF5                	AT_TRAP38:
  CFF5  210000        		LD	HL,0
  CFF8  E3            		EX	(SP),HL
  CFF9  3E24          		LD	A,'$'
  CFFB  CDBEDB        		CALL	MSG_A
  CFFE  2B            		DEC	HL
  CFFF  7C            		LD	A,H
  D000  CDE8FF        		CALL	PRHX+AT_RT
  D003  7D            		LD	A,L
  D004                	PRHX:
  D004  F5            		PUSH	AF
  D005  07            		RLCA
  D006  07            		RLCA
  D007  07            		RLCA
  D008  07            		RLCA
  D009  CDF1FF        		CALL	PRHX2+AT_RT
  D00C  F1            		POP	AF
  D00D                	PRHX2:
  D00D  E60F          		AND	00FH
  D00F  FE0A          		CP	10
  D011  3F            		CCF
  D012  CE30          		ADC	A,'0'
  D014  27            		DAA
  D015  C3BEDB        		JP	MSG_A
  D018                		DS	4
  D01C                	AT_TRAPE:
                      	
                      	;X1CPU.ASM
                      	
                      	;	LSX-Dodgers CPU
                      	;	X1/turbo/Z
                      	
                      	;	ノンターボ用パッチ
                      	;	DMAを使って転送している部分をCPUに差し替える
                      	
  D01C                	AT_SCR1:
  D01C  D9            		EXX
  D01D  C5            		PUSH	BC
  D01E  ED4BB1F0      		LD	BC,(_WIDTH)
  D022  0620          		LD	B,020H
  D024  D9            		EXX
  D025  C5            		PUSH	BC
  D026  010020        		LD	BC,02000H
                      	
  D029  67            		LD	H,A
  D02A  B7            		OR	A
  D02B                	AT_SCRUP1:
  D02B  2815          		JR	Z,AT_SCRCL
  D02D  C5            		PUSH	BC
  D02E  CBE0          		SET	4,B
  D030  D9            		EXX
  D031  C5            		PUSH	BC
  D032  CBE0          		SET	4,B
  D034  D9            		EXX
  D035  CD98DF        		CALL	AT_UPSUB+AT_RS
  D038  D9            		EXX
  D039  C1            		POP	BC
  D03A  D9            		EXX
  D03B  C1            		POP	BC
  D03C  CD98DF        		CALL	AT_UPSUB+AT_RS
  D03F  25            		DEC	H
  D040  18E9          		JR	AT_SCRUP1
                      	
  D042                	AT_SCRCL:
  D042  2AB1F0        		LD	HL,(_WIDTH)
  D045  CD30DE        		CALL	LINECL
  D048  C1            		POP	BC
  D049  D9            		EXX
  D04A  C1            		POP	BC
  D04B  D9            		EXX
  D04C  C9            		RET
                      	
  D04D                	AT_UPSUB:
  D04D  3AB1F0        		LD	A,(_WIDTH)
  D050  6F            		LD	L,A
  D051                	AT_UPSUB1:
  D051  D9            		EXX
  D052  ED78          		IN	A,(C)
  D054  03            		INC	BC
  D055  D9            		EXX
  D056  ED79          		OUT	(C),A
  D058  03            		INC	BC
  D059  2D            		DEC	L
  D05A  20F5          		JR	NZ,AT_UPSUB1
  D05C  C9            		RET
                      	
                      	;	FLOPPY DISK DRIVER(CPU)
                      	
  D05D                	DISKC:
  D05D  1B            		DEC	DE
  D05E  CB5F          		BIT	3,A
  D060  C4D2EE        		CALL	NZ,RNF
  D063                	DISKD:
  D063  E5            		PUSH	HL
  D064  21D8EE        		LD	HL,RETRY
  D067  35            		DEC	(HL)
  D068  E1            		POP	HL
  D069  200C          		JR	NZ,AT_ERR		;Retry
  D06B  B7            		OR	A
  D06C  2809          		JR	Z,AT_ERR		;Error
                      	
  D06E                	AT_DELP:
  D06E  CDD2EE        		CALL	RNF
  D071  CDAEEE        		CALL	FDMOFF
  D074  3EFF          		LD	A,0FFH
  D076                	AT_ERRZ:
  D076  BF            		CP	A
  D077                	AT_ERR:
  D077  3EFF          		LD	A,0FFH
  D079  C9            		RET
  D07A                	ERRW:
  D07A  3EFF          		LD	A,0FFH
  D07C  BF            		CP	A
  D07D  37            		SCF
  D07E  C3AEEE        		JP	FDMOFF
                      	
  D081                	ERRDW:
  D081  D1            		POP	DE
  D082  CDB9DF        		CALL	AT_DELP+AT_RS
  D085  C2E7EE        		JP	NZ,DWT0+AT_R
  D088  B7            		OR	A
  D089  20EF          		JR	NZ,ERRW
  D08B  C9            		RET
                      	
  D08C                	ERRDR:
  D08C  D1            		POP	DE
  D08D  CDB9DF        		CALL	AT_DELP+AT_RS
  D090  C230EF        		JP	NZ,DRD0+AT_R
  D093  B7            		OR	A
  D094  20E4          		JR	NZ,ERRW
  D096  C9            		RET
                      	
  D097                	AT_WTTRK:
  D097  0601          		LD	B,1
  D099  3EF4          		LD	A,0F4H
  D09B  C3DBEE        		JP	AT_WTTRK1+AT_R
                      	
  D09E                	AT_SCRN:
  D09E  ED78          		IN	A,(C)
  D0A0  C9            		RET
  D0A1                	AT_SCRE:
                      	
  D0A1                	AT_DWT:
  D0A1  3EA0          		LD	A,0A0H
  D0A3                	AT_WTTRK1:
  D0A3  3276EE        		LD	(FDCPAT+1),A
  D0A6                	DWTBL:
  D0A6  78            		LD	A,B
  D0A7  321EEF        		LD	(AT_WTB+1+AT_R),A
  D0AA  3E02          		LD	A,2		;Retry count
  D0AC  32D8EE        		LD	(RETRY),A
                      	
  D0AF                	DWT0:
  D0AF  D5            		PUSH	DE
  D0B0  E5            		PUSH	HL
  D0B1  CD15EE        		CALL	SEEK		;Write disk
  D0B4  E1            		POP	HL
  D0B5  DACCDF        		JP	C,ERRDW+AT_RS
  D0B8  F3            		DI
  D0B9  3A76EE        		LD	A,(FDCPAT+1)
  D0BC  CDBAEE        		CALL	SECSET
  D0BF  0EFB          		LD	C,0FBH
                      	
  D0C1                	DWT1:
  D0C1  56            		LD	D,(HL)
  D0C2                	DWT2:
  D0C2  78            		LD	A,B
  D0C3  DBF8          		IN	A,(0F8H)
  D0C5  0F            		RRCA
  D0C6  3008          		JR	NC,DWT4
  D0C8  0F            		RRCA
  D0C9  30F7          		JR	NC,DWT2
  D0CB                	DWT3:
  D0CB  ED51          		OUT	(C),D
  D0CD  23            		INC	HL
  D0CE  18F1          		JR	DWT1
                      	
  D0D0                	DWT4:
  D0D0  3D            		DEC	A
  D0D1  28F8          		JR	Z,DWT3
  D0D3  3C            		INC	A
  D0D4  FB            		EI
  D0D5  D1            		POP	DE
  D0D6  13            		INC	DE
  D0D7  CDAEEE        		CALL	FDMOFF
  D0DA  2809          		JR	Z,DISKOK_WT
  D0DC  CDA8DF        		CALL	DISKC+AT_RS
  D0DF  20CE          		JR	NZ,DWT0
  D0E1  B7            		OR	A
  D0E2  C2C5DF        		JP	NZ,ERRW+AT_RS
                      	
  D0E5                	DISKOK_WT:
  D0E5  0601          	AT_WTB:	LD	B,1
  D0E7  10BD          		DJNZ	DWTBL
  D0E9  C9            		RET
                      	
  D0EA                	AT_DRD:
  D0EA  3E80          		LD	A,080H
  D0EC  3276EE        		LD	(FDCPAT+1),A
  D0EF                	DRDBL:
  D0EF  78            		LD	A,B
  D0F0  3263EF        		LD	(AT_RDB+1+AT_R),A
  D0F3  3E02          		LD	A,2		;Retry count
  D0F5  32D8EE        		LD	(RETRY),A
  D0F8                	DRD0:
  D0F8  D5            		PUSH	DE
  D0F9  E5            		PUSH	HL
  D0FA  CD15EE        		CALL	SEEK		;Read disk
  D0FD  E1            		POP	HL
  D0FE  DAD7DF        		JP	C,ERRDR+AT_RS
  D101  F3            		DI
  D102  3A76EE        		LD	A,(FDCPAT+1)
  D105  CDBAEE        		CALL	SECSET
  D108  0EFB          		LD	C,0FBH
  D10A                	DRD1:
  D10A  78            		LD	A,B
  D10B  DBF8          		IN	A,(0F8H)
  D10D  0F            		RRCA
  D10E  3008          		JR	NC,DRD3
  D110  0F            		RRCA
  D111  30F7          		JR	NC,DRD1
  D113  EDA2          		INI
  D115  04            		INC	B
  D116  18F2          		JR	DRD1
                      	
  D118                	DRD3:
  D118  B7            		OR	A
  D119  FB            		EI
  D11A  D1            		POP	DE
  D11B  13            		INC	DE
  D11C  CDAEEE        		CALL	FDMOFF
  D11F  2809          		JR	Z,DISKOK_RD
  D121  CDA8DF        		CALL	DISKC+AT_RS
  D124  20D2          		JR	NZ,DRD0
  D126  B7            		OR	A
  D127  C2C5DF        		JP	NZ,ERRW+AT_RS
                      	
  D12A                	DISKOK_RD:
  D12A  0601          	AT_RDB:	LD	B,1
  D12C  10C1          		DJNZ	DRDBL
  D12E  C9            		RET
                      	
  D12F                	AT_CPUE:
                      	
                      	
                      	;	EMM DRIVER(CPU)
                      	
                      	
  D12F                	AT_EDWT:
  D12F  CD0CD8        		CALL	AT_EADR+AT_RE
  D132                	AT_EDWT0:
  D132  F5            		PUSH	AF
  D133  AF            		XOR	A
  D134                	AT_EDWT1:
  D134  04            		INC	B
  D135  EDA3          		OUTI
  D137  04            		INC	B
  D138  EDA3          		OUTI
  D13A  3D            		DEC	A
  D13B  20F7          		JR	NZ,AT_EDWT1
  D13D  13            		INC	DE
  D13E  F1            		POP	AF
  D13F  3D            		DEC	A
  D140  20F0          		JR	NZ,AT_EDWT0
  D142  C9            		RET
                      	
  D143                	AT_EDRD:
  D143  CD0CD8        		CALL	AT_EADR+AT_RE
  D146                	AT_EDRD0:
  D146  F5            		PUSH	AF
  D147  AF            		XOR	A
  D148                	AT_EDRD1:
  D148  EDA2          		INI
  D14A  04            		INC	B
  D14B  EDA2          		INI
  D14D  04            		INC	B
  D14E  3D            		DEC	A
  D14F  20F7          		JR	NZ,AT_EDRD1
  D151  13            		INC	DE
  D152  F1            		POP	AF
  D153  3D            		DEC	A
  D154  20F0          		JR	NZ,AT_EDRD0
  D156  C9            		RET
                      	
  D157                	AT_EADR:
  D157  C5            		PUSH	BC
  D158  D5            		PUSH	DE
  D159  EB            		EX	DE,HL
  D15A  29            		ADD	HL,HL
  D15B  DD4E0D        		LD	C,(IX+00DH)	;DPB_0D_MAXSEC
  D15E  DD460C        		LD	B,(IX+00CH)	;DPB_0C_MAXCYL
  D161  09            		ADD	HL,BC
  D162  DD4E13        		LD	C,(IX+013H)	;DPB_13_UNITNO
  D165  060D          		LD	B,00DH
  D167  ED49          		OUT	(C),C
  D169  0C            		INC	C
  D16A  ED69          		OUT	(C),L
  D16C  0C            		INC	C
  D16D  ED61          		OUT	(C),H
  D16F  0C            		INC	C
  D170  EB            		EX	DE,HL
  D171  D1            		POP	DE
  D172  F1            		POP	AF
  D173  A7            		AND	A	;CF=0
  D174  C9            		RET
  D175                	AT_EMME:
                      	
  2FE4                	AT_RT	EQU	TRAP38-AT_TRAP38
                      	
  D175                	INITE:
  D175                		DS	BDOS-INITE
  D206  C32FD8        		JP	BDOS0
                      	
                      	;X1CCP.ASM
                      	
                      	;	LSX-Dodgers CCP
                      	;	X1/turbo/Z
                      	
  D209                	WBOOT1:
  D209  F3            		DI
  D20A  ED7B0600      		LD	SP,(SYSTEM+1)
                      	
  D20E  3EF0          		LD	A,INTVEC/256
  D210  ED47          		LD	I,A
                      	
  D212  3EE4          		LD	A,0E4H
  D214  CDDDDE        		CALL	COMOUT
  D217  3EC8          		LD	A,INTVEC
  D219  CDB7DE        		CALL	OT49SB
                      	
  D21C  21B0F0        		LD	HL,CRTCD
  D21F  AF            		XOR	A
  D220                	SETCRT2:
  D220  010018        		LD	BC,01800H
  D223  ED79          		OUT	(C),A
  D225  0C            		INC	C
  D226  56            		LD	D,(HL)
  D227  FE0D          		CP	13
  D229  3802          		JR	C,SETCRT3
  D22B  1600          		LD	D,0
  D22D                	SETCRT3:
  D22D  ED51          		OUT	(C),D
  D22F  23            		INC	HL
  D230  3C            		INC	A
  D231  FE0E          		CP	14
  D233  20EB          		JR	NZ,SETCRT2
                      	
  D235  01031B        		LD	BC,01A03H+00100H
  D238  EDA3          		OUTI
  D23A  01D020        		LD	BC,01FD0H+00100H
  D23D  EDA3          		OUTI
  D23F  2192F0        		LD	HL,_KEYD
  D242  7E            		LD	A,(HL)
  D243  3600          		LD	(HL),0
  D245  CDABDB        		CALL	KEYBC_IFBREAK
  D248  3E04          		LD	A,4
  D24A  CDBEDB        		CALL	MSG_A
                      	
                      	;LDCCP.ASM
                      	
                      	;	LSX-Dodgers CCP
                      	
  D24D                	COMMAND:
  D24D  3ACEEF        		LD	A,(FCB_BAT)
  D250  B7            		OR	A
  D251  C292D3        		JP	NZ,C_BAT1
  D254  CD07D3        		CALL	SETDTA1
  D257  3A87F0        		LD	A,(_DVSW)
  D25A  C641          		ADD	A,'A'
  D25C  CDBEDB        		CALL	MSG_A
  D25F  3E3E          		LD	A,'>'
  D261  CDBEDB        		CALL	MSG_A
  D264  3E50          		LD	A,80
  D266  12            		LD	(DE),A
  D267  CD0DDC        		CALL	_SYS0A		;(BDOS)文字列入力
  D26A  CD95D4        		CALL	LTNL
  D26D                	COMMAND2:
  D26D  118200        		LD	DE,DTA1+2
  D270  CDFDF0        		CALL	_COMANL
  D273  30D8          		JR	NC,COMMAND
  D275  1179F0        		LD	DE,COMERM
  D278  CD61D8        		CALL	_SYS09		;(BDOS)文字列出力
  D27B  C7            		RST	0
                      	
  D27C                	COMANL:
  D27C  CD8BE0        		CALL	FILE
  D27F  3A19F0        		LD	A,(FNAME+4)
  D282  FE20          		CP	020H
  D284  201C          		JR	NZ,COMB2
  D286  D5            		PUSH	DE
  D287  1115F0        		LD	DE,FNAME
  D28A  1A            		LD	A,(DE)
  D28B  FE20          		CP	020H
  D28D  2844          		JR	Z,SDVSW
  D28F  1B            		DEC	DE
  D290  1A            		LD	A,(DE)
  D291  C6FF          		ADD	A,0FFH
  D293  3809          		JR	C,COMB
  D295  13            		INC	DE
                      	
  D296  2103D7        		LD	HL,COMTB
  D299  0609          		LD	B,COMS
  D29B  CD0FE3        		CALL	CPNAME
  D29E                	COMB:
  D29E  D1            		POP	DE
  D29F  D20F00        		JP	NC,JP_HL
  D2A2                	COMB2:
  D2A2  EB            		EX	DE,HL
  D2A3  226FD3        		LD	(COMPAT+1),HL
  D2A6  F5            		PUSH	AF
  D2A7  CD27D3        		CALL	CEXE4
  D2AA  F1            		POP	AF
  D2AB  2115F0        		LD	HL,FNAME
  D2AE  116D00        		LD	DE,FCB2+1	;COMMAND NAME
  D2B1  010B00        		LD	BC,11
  D2B4  EDB0          		LDIR
  D2B6  1168EF        		LD	DE,PATHD
  D2B9                	CEX1:
  D2B9  1A            		LD	A,(DE)
  D2BA  FE20          		CP	020H
  D2BC  D8            		RET	C
  D2BD  CD80E0        		CALL	FILEC
  D2C0  D5            		PUSH	DE
  D2C1  216D00        		LD	HL,FCB2+1	;COMMAND NAME
  D2C4  1115F0        		LD	DE,FNAME
  D2C7  010B00        		LD	BC,11
  D2CA  EDB0          		LDIR
  D2CC  CD27D3        		CALL	CEXE4
  D2CF  D1            		POP	DE
  D2D0  13            		INC	DE
  D2D1  18E6          		JR	CEX1
                      	
  D2D3                	SDVSW:
  D2D3  F1            		POP	AF
  D2D4  3A14F0        		LD	A,(FDRV)
  D2D7  3D            		DEC	A
  D2D8  5F            		LD	E,A
  D2D9  0E0E          		LD	C,00EH		;(BDOS)カレントドライブの設定
  D2DB  1831          		JR	SYSTEM0
                      	
  D2DD                	OPEN1:
  D2DD  2114F0        		LD	HL,FDRV
  D2E0                	OPEN:
  D2E0  0E11          		LD	C,011H		;(BDOS)ファイルの検索
  D2E2                	OPEN3:
  D2E2  D5            		PUSH	DE
  D2E3  11A9EF        		LD	DE,DTA_CCP
  D2E6  CD04D3        		CALL	SETDTA
  D2E9  EB            		EX	DE,HL
  D2EA  CD0ED3        		CALL	SYSTEM0
  D2ED  D1            		POP	DE
  D2EE  C9            		RET
                      	
  D2EF                	OPEN2:
  D2EF  0E12          		LD	C,012H
  D2F1  18EF          		JR	OPEN3
                      	
  D2F3                	DEFCB:				;Z=Ok NZ=Error
  D2F3  11A9EF        		LD	DE,DTA_CCP
  D2F6  CD0CD3        		CALL	SYSC0F
                      	
  D2F9  11CAEF        		LD	DE,DTA_CCP+33	;(FCB)ランダムレコード
  D2FC  0604          		LD	B,4
  D2FE  CDD3D5        		CALL	ZERO_MEMORY_DE
  D301                	SETDTA100:
  D301  110001        		LD	DE,00100H
  D304                	SETDTA:
  D304  C339DA        		JP	_SYS1A		;(BDOS)DTAの設定
                      	
  D307                	SETDTA1:
  D307  118000        		LD	DE,DTA1
  D30A  18F8          		JR	SETDTA
                      	
  D30C                	SYSC0F:
  D30C  0E0F          		LD	C,00FH		;(BDOS)ファイルのオープン
  D30E                	SYSTEM0:
  D30E  CD0500        		CALL	SYSTEM
  D311  B7            		OR	A
  D312  C9            		RET
                      	
  D313                	C_CD:
  D313  0E5A          		LD	C,5AH
  D315  18F7          		JR	SYSTEM0
                      	
  D317                	S27BUF:
  D317  3A0700        		LD	A,(SYSTEM+2)
  D31A  3D            		DEC	A
  D31B  E6F8          		AND	0F8H
  D31D  67            		LD	H,A
  D31E  2E00          		LD	L,0
  D320                	S27DTA:
  D320  11A9EF        		LD	DE,DTA_CCP
  D323                	S27:
  D323  0E27          		LD	C,027H		;(BDOS)ランダムブロック読み込み
  D325  18E7          		JR	SYSTEM0
                      	
  D327                	CEXE4:
  D327  211DF0        		LD	HL,FNAME+8
  D32A  7E            		LD	A,(HL)
  D32B  FE20          		CP	020H
  D32D  2007          		JR	NZ,CEXE7
  D32F  3E3F          		LD	A,'?'
  D331  77            		LD	(HL),A
  D332  23            		INC	HL
  D333  77            		LD	(HL),A
  D334  23            		INC	HL
  D335  77            		LD	(HL),A
  D336                	CEXE7:
  D336  CDDDD2        		CALL	OPEN1
  D339                	CEXE5:
  D339  C0            		RET	NZ
  D33A  2AB3EF        		LD	HL,(DTA_CCP+1+9)
  D33D  7C            		LD	A,H
  D33E  CD97E3        		CALL	CAP
  D341  67            		LD	H,A
  D342  7D            		LD	A,L
  D343  CD97E3        		CALL	CAP
  D346  6F            		LD	L,A
  D347  3AB2EF        		LD	A,(DTA_CCP+1+8)
  D34A  CD97E3        		CALL	CAP
  D34D  D642          		SUB	'B'
  D34F  282C          		JR	Z,C_BAT
  D351  3D            		DEC	A		;'C'
  D352  2805          		JR	Z,C_EXE
  D354                	CEXE6:
  D354  CDEFD2        		CALL	OPEN2
  D357  18E0          		JR	CEXE5
                      	
  D359                	C_EXE:
  D359  7C            		LD	A,H
  D35A  FE4D          		CP	'M'
  D35C  20F6          		JR	NZ,CEXE6
                      	
  D35E  CDF3D2        		CALL	DEFCB
  D361  CD17D3        		CALL	S27BUF
  D364  3D            		DEC	A
  D365  37            		SCF
  D366  C0            		RET	NZ
  D367  7C            		LD	A,H
  D368  B5            		OR	L
  D369  37            		SCF
  D36A  C8            		RET	Z
  D36B  CD07D3        		CALL	SETDTA1
  D36E  110000        	COMPAT:	LD	DE,0				; self-modifying code
  D371  ED7B0600      		LD	SP,(SYSTEM+1)
  D375  67            		LD	H,A				; A=0 in SETDTA1(_SYS1A)
  D376  6F            		LD	L,A
  D377  E5            		PUSH	HL				; push $0000 (reboot address)
  D378  24            		INC	H
  D379  E5            		PUSH	HL				; push $0100 (TPA address)
  D37A  C39ED5        		JP	SETFCB				; and JP $0100
                      	
  D37D                	C_BAT:
  D37D  114154        		LD	DE,'A'+'T'*256
  D380  ED52          		SBC	HL,DE
  D382  20D0          		JR	NZ,CEXE6
                      	
  D384  CDF3D2        		CALL	DEFCB
                      	
  D387  21A9EF        		LD	HL,DTA_CCP
  D38A  11CEEF        		LD	DE,FCB_BAT
  D38D  012500        		LD	BC,37
  D390  EDB0          		LDIR
  D392                	C_BAT1:
  D392  CD01D3        		CALL	SETDTA100
  D395  CDC9D3        		CALL	FGETC_BAT
  D398  218100        		LD	HL,DTA1+1
  D39B  2025          		JR	NZ,END_BATCH
  D39D  FE21          		CP	021H		;スペースや改行など制御文字を飛ばす
  D39F  38F1          		JR	C,C_BAT1
  D3A1  3620          		LD	(HL),' '
  D3A3  23            		INC	HL
  D3A4                	C_BAT2:
  D3A4  77            		LD	(HL),A
  D3A5  23            		INC	HL
  D3A6  7D            		LD	A,L
  D3A7  3C            		INC	A		;L==0FFH
  D3A8  2809          		JR	Z,RUN_BATCH
  D3AA  CDC9D3        		CALL	FGETC_BAT
  D3AD  2004          		JR	NZ,RUN_BATCH
  D3AF  FE20          		CP	020H
  D3B1  30F1          		JR	NC,C_BAT2
  D3B3                	RUN_BATCH:
  D3B3  7D            		LD	A,L
  D3B4  D67F          		SUB	DTA1-1
  D3B6  328000        		LD	(DTA1),A
  D3B9  FE04          		CP	4
  D3BB  3805          		JR	C,END_BATCH
  D3BD  3600          		LD	(HL),0
  D3BF  C36DD2        		JP	COMMAND2
  D3C2                	END_BATCH:
  D3C2  AF            		XOR	A		;バッチファイルを閉じる
  D3C3  32CEEF        		LD	(FCB_BAT),A
  D3C6  C300F0        		JP	CPM_BOOT
                      	
  D3C9                	FGETC_BAT:
  D3C9  11CEEF        		LD	DE,FCB_BAT
  D3CC                	FGETC:				;1文字ずつ読み込む
  D3CC  E5            		PUSH	HL		;Z:成功
  D3CD  210100        		LD	HL,1
  D3D0  CD23D3        		CALL	S27
  D3D3  E1            		POP	HL
  D3D4  3A0001        		LD	A,(00100H)
  D3D7  C9            		RET
                      	
  D3D8                	C_DEL:
  D3D8  CD9ED5        		CALL	SETFCB
  D3DB  CDD4DB        		CALL	_SYS08		;(BDOS)エコーなしコンソール入力
                      	
  D3DE  0E13          		LD	C,013H
  D3E0  180A          		JR	CDEL1		;(BDOS)ファイルの削除
                      	
  D3E2                	C_REN:
  D3E2  CD9ED5        		CALL	SETFCB
  D3E5  3E10          		LD	A,010H		;ディレクトリも対象にする
  D3E7  326900        		LD	(FCB1+13),A	;属性
  D3EA  0E17          		LD	C,017H		;(BDOS)ファイル名の変更
  D3EC                	CDEL1:
  D3EC  115C00        		LD	DE,FCB1
  D3EF  CD0500        		CALL	SYSTEM
  D3F2  C6FF          		ADD	A,0FFH
  D3F4  C9            		RET
                      	
  D3F5                	C_DIR:
  D3F5  CD80E0        		CALL	FILEC
  D3F8  2115F0        		LD	HL,FDRV+1
  D3FB  CDE9D6        		CALL	CWILD1
  D3FE  3EF1          		LD	A,0F1H
  D400  3221F0        		LD	(FDRV+13),A
  D403  CDDDD2        		CALL	OPEN1
  D406                	CDIR1:
  D406  B7            		OR	A
  D407  2008          		JR	NZ,PDSKF
  D409  CD54D4        		CALL	P_NAME
  D40C  CDEFD2        		CALL	OPEN2
  D40F  18F5          		JR	CDIR1
                      	
  D411                	PDSKF:
  D411  3A14F0        		LD	A,(FDRV)
  D414  5F            		LD	E,A
  D415  0E1B          		LD	C,01BH		;(BDOS)ディスク情報の獲得
  D417  CD0500        		CALL	SYSTEM
  D41A  4F            		LD	C,A		;C←1クラスタ辺りの論理セクタ数
  D41B  C601          		ADD	A,001H
  D41D  D8            		RET	C		;Aが0FFHだった場合
  D41E  3E06          		LD	A,8-2
  D420                	PDS1:				;HL=未使用クラスタの総数
  D420  3C            		INC	A
  D421  CB19          		RR	C
  D423  30FB          		JR	NC,PDS1
  D425                	PDS2:				;B←論理セクタのサイズの上位8ビット
  D425  3C            		INC	A
  D426  CB18          		RR	B
  D428  30FB          		JR	NC,PDS2
  D42A  47            		LD	B,A
                      	
  D42B  110000        		LD	DE,0
  D42E                	PDS3:
  D42E  29            		ADD	HL,HL
  D42F  EB            		EX	DE,HL
  D430  ED6A          		ADC	HL,HL
  D432  EB            		EX	DE,HL
  D433  10F9          		DJNZ	PDS3
  D435                	PDSKF1:
  D435  CDCDD4        		CALL	PRDEC_DEHL
  D438  11F3EF        		LD	DE,FREE
  D43B  CD61D8        		CALL	_SYS09		;(BDOS)文字列出力
  D43E  CDBCD4        		CALL	PUTDRV
  D441  3E5C          		LD	A,05CH		;\
  D443  CDBEDB        		CALL	MSG_A
  D446  2A22F0        		LD	HL,(FDRV+14)	;ディレクトリのクラスタ番号
  D449  AF            		XOR	A
  D44A  11FEFF        		LD	DE,0-2
  D44D  19            		ADD	HL,DE
  D44E  23            		INC	HL
  D44F  DCC9D4        		CALL	C,PRDEC_HL
  D452  1841          		JR	LTNL
                      	
  D454                	P_NAME:
  D454  3AAAEF        		LD	A,(DTA_CCP+1)
  D457  FE2E          		CP	'.'
  D459  C8            		RET	Z
  D45A  11FFD6        		LD	DE,DIRHD
  D45D  CD61D8        		CALL	_SYS09		;(BDOS)文字列出力
  D460  3AB5EF        		LD	A,(DTA_CCP+1+00BH)
  D463  F5            		PUSH	AF
  D464  0F            		RRCA
  D465  9F            		SBC	A,A
  D466  E60A          		AND	'*'-020H
  D468  C620          		ADD	A,020H
  D46A  CDBEDB        		CALL	MSG_A
  D46D  CDBCD4        		CALL	PUTDRV
  D470  21AAEF        		LD	HL,DTA_CCP+1
  D473  CD0DD5        		CALL	FPRNT
                      	
  D476  F1            		POP	AF
  D477  CB67          		BIT	4,A
  D479  2808          		JR	Z,DIR3
  D47B  11F4D6        		LD	DE,DIRMES
  D47E  CD61D8        		CALL	_SYS09		;(BDOS)文字列出力
  D481  180A          		JR	DIR6
  D483                	DIR3:
  D483  ED5BC8EF      		LD	DE,(DTA_CCP+1+01EH)
  D487  2AC6EF        		LD	HL,(DTA_CCP+1+01CH)
  D48A  CDCDD4        		CALL	PRDEC_DEHL
  D48D                	DIR6:
  D48D  3AB1F0        		LD	A,(_WIDTH)
  D490  FE29          		CP	40+1
  D492  D42FD5        		CALL	NC,PRTTMS
                      	
  D495                	LTNL:
  D495  1E03          		LD	E,3
  D497  C3CDF0        		JP	_PRINT
                      	
  D49A                	C_PATH:
  D49A  CD62E1        		CALL	SPCUT
  D49D  2168EF        		LD	HL,PATHD
  D4A0  FE21          		CP	021H
  D4A2  300C          		JR	NC,CPATH0
  D4A4                	CPATHP:
  D4A4  7E            		LD	A,(HL)
  D4A5  23            		INC	HL
  D4A6  FE20          		CP	020H
  D4A8  3F            		CCF
  D4A9  30EA          		JR	NC,LTNL
  D4AB  CDBEDB        		CALL	MSG_A
  D4AE  18F4          		JR	CPATHP
  D4B0                	CPATH0:
  D4B0  FE3B          		CP	';'
  D4B2  2001          		JR	NZ,CPATH1
  D4B4  13            		INC	DE
  D4B5                	CPATH1:
  D4B5  EB            		EX	DE,HL
  D4B6  014000        		LD	BC,PATHX
  D4B9  EDB0          		LDIR
  D4BB  C9            		RET
                      	
  D4BC                	PUTDRV:
  D4BC  3A14F0        		LD	A,(FDRV)
  D4BF  C640          		ADD	A,'A'-1
  D4C1  CDBEDB        		CALL	MSG_A
  D4C4  3E3A          		LD	A,':'
  D4C6                	MSG_AR:
  D4C6  C3BEDB        		JP	MSG_A
                      	
  D4C9                	PRDEC_HL:
  D4C9  AF            		XOR	A
  D4CA                	PRDEC_AHL:
  D4CA  5F            		LD	E,A
  D4CB  1600          		LD	D,0
  D4CD                	PRDEC_DEHL:
  D4CD  D5            		PUSH	DE
  D4CE  110FF0        		LD	DE,DECBF
  D4D1  0605          		LD	B,5
  D4D3  CDD3D5        		CALL	ZERO_MEMORY_DE	;A=0
  D4D6  D1            		POP	DE
                      	
  D4D7  0E20          		LD	C,32
  D4D9                	DEC1:
  D4D9  29            		ADD	HL,HL
  D4DA  EB            		EX	DE,HL
  D4DB  ED6A          		ADC	HL,HL
  D4DD  EB            		EX	DE,HL
  D4DE  E5            		PUSH	HL
  D4DF  2113F0        		LD	HL,DECBF+4
  D4E2  0605          		LD	B,5
  D4E4                	DEC2:
  D4E4  7E            		LD	A,(HL)
  D4E5  8F            		ADC	A,A
  D4E6  27            		DAA
  D4E7  77            		LD	(HL),A
  D4E8  2B            		DEC	HL
  D4E9  10F9          		DJNZ	DEC2
  D4EB  E1            		POP	HL
  D4EC  0D            		DEC	C
  D4ED  20EA          		JR	NZ,DEC1
                      	
  D4EF  210FF0        		LD	HL,DECBF
  D4F2  3E20          		LD	A,020H
  D4F4  0604          		LD	B,4
  D4F6                	DEC3:
  D4F6  CD03D5        		CALL	DEC4
  D4F9  CD03D5        		CALL	DEC4
  D4FC  23            		INC	HL
  D4FD  10F7          		DJNZ	DEC3
  D4FF                	DECX:
  D4FF  CD03D5        		CALL	DEC4
  D502  AF            		XOR	A
  D503                	DEC4:
  D503  ED6F          		RLD
  D505  FE20          		CP	020H
  D507  2802          		JR	Z,DEC5
  D509  F630          		OR	030H
  D50B                	DEC5:
  D50B  18B9          		JR	MSG_AR
                      	
  D50D                	FPRNT:
  D50D  0608          		LD	B,8
  D50F  CD20D5        		CALL	P_N1
  D512  7E            		LD	A,(HL)
  D513  C680          		ADD	A,0A0H-020H
  D515  FEA0          		CP	0A0H
  D517  2802          		JR	Z,FPR1
  D519  3E2E          		LD	A,'.'
  D51B                	FPR1:
  D51B  CDBEDB        		CALL	MSG_A
  D51E  0603          		LD	B,3
                      	
  D520                	P_N1:
  D520  C5            		PUSH	BC
  D521  E5            		PUSH	HL
  D522  7E            		LD	A,(HL)
  D523  CDA3E3        		CALL	CAP3
  D526  CDBEDB        		CALL	MSG_A
  D529  E1            		POP	HL
  D52A  C1            		POP	BC
  D52B  23            		INC	HL
  D52C  10F2          		DJNZ	P_N1
  D52E  C9            		RET
                      	
  D52F                	PRTTMS:
  D52F  3E20          		LD	A,020H
  D531  CDBEDB        		CALL	MSG_A
                      	
  D534  2AC2EF        		LD	HL,(DTA_CCP+1+24)
  D537  7D            		LD	A,L
  D538  B7            		OR	A
  D539  C8            		RET	Z
  D53A  CB3C          		SRL	H
  D53C  17            		RLA
  D53D  17            		RLA
  D53E  17            		RLA
  D53F  17            		RLA
  D540  E60F          		AND	00FH
  D542  57            		LD	D,A
  D543  7C            		LD	A,H
  D544  C650          		ADD	A,80
  D546  CD89D5        		CALL	PRDEC_A
  D549  3E2D          		LD	A,'-'
  D54B  CDBEDB        		CALL	MSG_A
  D54E  7A            		LD	A,D
  D54F  CD89D5        		CALL	PRDEC_A
  D552  3E2D          		LD	A,'-'
  D554  CDBEDB        		CALL	MSG_A
  D557  7D            		LD	A,L
  D558  E61F          		AND	01FH
  D55A  CD89D5        		CALL	PRDEC_A
                      	
  D55D  2AC0EF        		LD	HL,(DTA_CCP+1+22)
                      	
  D560  3E20          		LD	A,020H
  D562  CDBEDB        		CALL	MSG_A
  D565  7C            		LD	A,H
  D566  65            		LD	H,L
  D567  0603          		LD	B,3
  D569                	PRTTMS1:
  D569  1F            		RRA
  D56A  CB1D          		RR	L
  D56C  10FB          		DJNZ	PRTTMS1
  D56E  E61F          		AND	01FH
  D570  CD89D5        		CALL	PRDEC_A
  D573  3E3A          		LD	A,':'
  D575  CDBEDB        		CALL	MSG_A
  D578  7D            		LD	A,L
  D579  0F            		RRCA
  D57A  0F            		RRCA
  D57B  E63F          		AND	03FH
  D57D  CD89D5        		CALL	PRDEC_A
  D580  3E3A          		LD	A,':'
  D582  CDBEDB        		CALL	MSG_A
  D585  7C            		LD	A,H
  D586  E61F          		AND	01FH
  D588  87            		ADD	A,A
                      	
                      	;	PRINT10
                      	
  D589                	PRDEC_A:
  D589  E5            		PUSH	HL
  D58A  0608          		LD	B,8
  D58C  4F            		LD	C,A
  D58D  AF            		XOR	A
  D58E                	PRTA1:
  D58E  CB01          		RLC	C
  D590  8F            		ADC	A,A
  D591  27            		DAA
  D592  10FA          		DJNZ	PRTA1
  D594  210FF0        		LD	HL,DECBF
  D597  77            		LD	(HL),A
  D598  AF            		XOR	A
  D599  CDFFD4        		CALL	DECX
  D59C  E1            		POP	HL
  D59D  C9            		RET
                      	
  D59E                	SETFCB:
  D59E  CD62E1        		CALL	SPCUT
  D5A1  1A            		LD	A,(DE)
  D5A2  FE20          		CP	020H
  D5A4  3801          		JR	C,SETFCBA
  D5A6  1B            		DEC	DE
  D5A7                	SETFCBA:
  D5A7  0624          		LD	B,36
  D5A9  215C00        		LD	HL,FCB1
  D5AC  E5            		PUSH	HL
  D5AD  AF            		XOR	A
  D5AE  CD37E1        		CALL	FILL_MEMORY
  D5B1  E1            		POP	HL
  D5B2  D5            		PUSH	DE
  D5B3  CD9FDA        		CALL	_SYS29		;(BDOS)ファイル名の解析
  D5B6  216C00        		LD	HL,FCB2
  D5B9  CD9FDA        		CALL	_SYS29		;(BDOS)ファイル名の解析
  D5BC  E1            		POP	HL
  D5BD  010050        		LD	BC,05000H
  D5C0  118100        		LD	DE,00081H
  D5C3                	SETFCB1:
  D5C3  7E            		LD	A,(HL)
  D5C4  23            		INC	HL
  D5C5  FE20          		CP	020H
  D5C7  3805          		JR	C,SETFCB2
  D5C9  12            		LD	(DE),A
  D5CA  13            		INC	DE
  D5CB  0C            		INC	C
  D5CC  10F5          		DJNZ	SETFCB1
  D5CE                	SETFCB2:
  D5CE  79            		LD	A,C
  D5CF  328000        		LD	(DTA1),A
  D5D2  04            		INC	B
  D5D3                	ZERO_MEMORY_DE:
  D5D3  AF            		XOR	A
  D5D4                	FILL_MEMORY_DE:
  D5D4  12            		LD	(DE),A
  D5D5  13            		INC	DE
  D5D6  10FC          		DJNZ	FILL_MEMORY_DE
  D5D8  C9            		RET
                      	
  D5D9                	C_COPY:
  D5D9  CD9ED5        		CALL	SETFCB
                      	
  D5DC  1161F0        		LD	DE,ZERO
  D5DF  CD83E0        		CALL	FILEC2
  D5E2  216C00        		LD	HL,FCB2
  D5E5  CDA6DA        		CALL	S29X1
                      	
  D5E8  3E10          		LD	A,010H
  D5EA  326900        		LD	(FCB1+13),A
  D5ED  216D00        		LD	HL,FCB2+1
  D5F0  CDE9D6        		CALL	CWILD1
  D5F3                	COPY0:
  D5F3  CDE6D6        		CALL	CWILD
  D5F6  215C00        		LD	HL,FCB1
  D5F9  CDE0D2        		CALL	OPEN
  D5FC  37            		SCF
  D5FD                	COPY1:
  D5FD  C0            		RET	NZ
  D5FE  CDF3D2        		CALL	DEFCB
                      	
  D601  3AB6EF        		LD	A,(DTA_CCP+13)
  D604  CB67          		BIT	4,A
  D606  2821          		JR	Z,COPY1A
                      	
  D608  215D00        		LD	HL,FCB1+1
  D60B  CDC6E4        		CALL	CHKWILD
  D60E  3814          		JR	C,COPY9
                      	
  D610  3E20          		LD	A,020H
  D612  325D00        		LD	(FCB1+1),A
  D615  2AC3EF        		LD	HL,(DTA_CCP+26)
  D618  23            		INC	HL
  D619  226A00        		LD	(FCB1+14),HL
  D61C  18D5          		JR	COPY0
                      	
  D61E                	COPY8:
  D61E  CD61D8        		CALL	_SYS09		;(BDOS)文字列出力
  D621  CD95D4        		CALL	LTNL
  D624                	COPY9:
  D624  CDEFD2        		CALL	OPEN2
  D627  18D4          		JR	COPY1
                      	
  D629                	COPY1A:
  D629  216C00        		LD	HL,FCB2
  D62C  1114F0        		LD	DE,FDRV
  D62F  01ABEF        		LD	BC,DTA_CCP+2
  D632  EDA0          		LDI
  D634  3E0B          		LD	A,11
  D636                	COPY2:
  D636  F5            		PUSH	AF
  D637  7E            		LD	A,(HL)
  D638  FE3F          		CP	'?'
  D63A  2001          		JR	NZ,COPY3
  D63C  0A            		LD	A,(BC)
  D63D                	COPY3:
  D63D  12            		LD	(DE),A
  D63E  03            		INC	BC
  D63F  13            		INC	DE
  D640  23            		INC	HL
  D641  F1            		POP	AF
  D642  3D            		DEC	A
  D643  20F1          		JR	NZ,COPY2
  D645  010500        		LD	BC,16-11
  D648  EDB0          		LDIR
  D64A                	PUTNAME:
  D64A  215D00        		LD	HL,FCB1+1
  D64D  CDC6E4        		CALL	CHKWILD
  D650  300B          		JR	NC,PUTN1
  D652  2115F0        		LD	HL,FDRV+1
  D655  CD0DD5        		CALL	FPRNT
  D658  3E20          		LD	A,020H
  D65A  CDBEDB        		CALL	MSG_A
  D65D                	PUTN1:
  D65D  1114F0        		LD	DE,FDRV
  D660  0E16          		LD	C,016H		;(BDOS)ファイルの作成
  D662  CD0ED3        		CALL	SYSTEM0
  D665  2048          		JR	NZ,COPYE2
  D667  67            		LD	H,A		;A=0
  D668  6F            		LD	L,A
  D669  2235F0        		LD	(FDRV+33),HL	;(FCB)ランダムレコード
  D66C  2237F0        		LD	(FDRV+35),HL
  D66F                	COPY6:
  D66F  CD17D3        		CALL	S27BUF
  D672  47            		LD	B,A
  D673  3C            		INC	A
  D674  2831          		JR	Z,COPYE
  D676  7C            		LD	A,H
  D677  B5            		OR	L
  D678  280C          		JR	Z,COPY7
  D67A  1114F0        		LD	DE,FDRV
  D67D  0E26          		LD	C,026H		;(BDOS)ランダムブロック書き込み
  D67F  CD0ED3        		CALL	SYSTEM0
  D682  2023          		JR	NZ,COPYE
  D684  10E9          		DJNZ	COPY6
  D686                	COPY7:
  D686  3AB6EF        		LD	A,(DTA_CCP+13)	;(FCB)属性
  D689  3221F0        		LD	(FDRV+13),A
  D68C  21BDEF        		LD	HL,DTA_CCP+20	;(FCB)タイムスタンプ
  D68F  1128F0        		LD	DE,FDRV+20
  D692  010400        		LD	BC,4
  D695  EDB0          		LDIR
                      	
  D697  1114F0        		LD	DE,FDRV
  D69A  0E10          		LD	C,010H		;(BDOS)ファイルのクローズ
  D69C  CD0ED3        		CALL	SYSTEM0
  D69F  2006          		JR	NZ,COPYE
                      	
  D6A1  1171F0        		LD	DE,OK
  D6A4  C31ED6        		JP	COPY8
                      	
  D6A7                	COPYE:
  D6A7  1114F0        		LD	DE,FDRV
  D6AA  0E13          		LD	C,013H		;(BDOS)ファイルの削除
  D6AC  CD0500        		CALL	SYSTEM
  D6AF                	COPYE2:
  D6AF  37            		SCF
  D6B0  C9            		RET
                      	
  D6B1                	C_TYPE:
  D6B1  CD9ED5        		CALL	SETFCB
  D6B4  215C00        		LD	HL,FCB1
  D6B7  CDE0D2        		CALL	OPEN
  D6BA  37            		SCF
  D6BB                	TYPE1:
  D6BB  C0            		RET	NZ
  D6BC  CDF3D2        		CALL	DEFCB
  D6BF  3E06          		LD	A,6
  D6C1  CDBEDB        		CALL	MSG_A
  D6C4                	TYPE2:
  D6C4  CD17D3        		CALL	S27BUF
  D6C7  C6FE          		ADD	A,0FEH
  D6C9  D8            		RET	C
  D6CA  7C            		LD	A,H
  D6CB  B5            		OR	L
  D6CC  2813          		JR	Z,TYPEE
  D6CE  010001        		LD	BC,00100H
  D6D1                	TYPE3:
  D6D1  0A            		LD	A,(BC)
  D6D2  03            		INC	BC
  D6D3  FE1A          		CP	01AH
  D6D5  280A          		JR	Z,TYPEE
  D6D7  CDBEDB        		CALL	MSG_A
  D6DA  2B            		DEC	HL
  D6DB  7C            		LD	A,H
  D6DC  B5            		OR	L
  D6DD  20F2          		JR	NZ,TYPE3
  D6DF  18E3          		JR	TYPE2
  D6E1                	TYPEE:
  D6E1  CDEFD2        		CALL	OPEN2
  D6E4  18D5          		JR	TYPE1
                      	
  D6E6                	CWILD:
  D6E6  215D00        		LD	HL,FCB1+1
  D6E9                	CWILD1:
  D6E9  7E            		LD	A,(HL)
  D6EA  FE20          		CP	020H
  D6EC  C0            		RET	NZ
  D6ED                	CWILD2:
  D6ED  3E3F          		LD	A,'?'
  D6EF  060B          		LD	B,11
  D6F1  C337E1        		JP	FILL_MEMORY
                      	
  D6F4  20202020203C44	DIRMES:	DB	"     <DIR>$"
  D6FF  20203A24      	DIRHD:	DB	"  :$"
                      	
  D703                	COMTB:
  D703  44202020      		DB	"D   "	;1
  D707  F5D3          		DW	C_DIR
  D709  44495220      		DB	"DIR "	;2
  D70D  F5D3          		DW	C_DIR
  D70F  434F5059      		DB	"COPY"	;3
  D713  D9D5          		DW	C_COPY
  D715  43442020      		DB	"CD  "	;4
  D719  13D3          		DW	C_CD
  D71B  44454C20      		DB	"DEL "	;5
  D71F  D8D3          		DW	C_DEL
  D721  50415448      		DB	"PATH"	;6
  D725  9AD4          		DW	C_PATH
  D727  52454E20      		DB	"REN "	;7
  D72B  E2D3          		DW	C_REN
  D72D  54595045      		DB	"TYPE"	;8
  D731  B1D6          		DW	C_TYPE
  D733  52454D20      		DB	"REM "	;9
  D737  5ED8          		DW	C_REM
                      	
                      	;X1DISK2.ASM
                      	
                      	;	LSX-Dodgers DISK2
                      	;	X1/turbo/Z
                      	
                      	;	GRAPHIC RAM DISK DRIVER
                      	
                      	
  D739                	GDRD:
  D739  C5            		PUSH	BC
  D73A  CD62D7        		CALL	GADR
  D73D  F1            		POP	AF
  D73E                	GDRD1:
  D73E  EDA2          		INI
  D740  04            		INC	B
  D741  0C            		INC	C
  D742  20FA          		JR	NZ,GDRD1
  D744  04            		INC	B
  D745  13            		INC	DE
  D746  3D            		DEC	A
  D747  20F5          		JR	NZ,GDRD1
  D749                	GBANK0:
  D749  3ABFF0        		LD	A,(WK1FD0)
  D74C  E6EF          		AND	0EFH		;BANK0
  D74E  181D          		JR	S1FD0
                      	
  D750                	GDWT:
  D750  C5            		PUSH	BC
  D751  CD62D7        		CALL	GADR
  D754  F1            		POP	AF
  D755                	GDWT1:
  D755  04            		INC	B
  D756  EDA3          		OUTI
  D758  0C            		INC	C
  D759  20FA          		JR	NZ,GDWT1
  D75B  04            		INC	B
  D75C  13            		INC	DE
  D75D  3D            		DEC	A
  D75E  20F5          		JR	NZ,GDWT1
  D760  18E7          		JR	GBANK0
                      	
  D762                	GADR:
  D762  0E00          		LD	C,0
  D764  7B            		LD	A,E
  D765  C640          		ADD	A,040H
  D767  47            		LD	B,A
  D768  3ABFF0        		LD	A,(WK1FD0)
  D76B  F610          		OR	010H		;BANK1
  D76D                	S1FD0:
  D76D  C5            		PUSH	BC
  D76E  32BFF0        		LD	(WK1FD0),A
  D771  01D01F        		LD	BC,01FD0H
  D774  ED79          		OUT	(C),A
  D776  C1            		POP	BC
  D777  C9            		RET
                      	
                      	
                      	;	BANK RAM DISK DRIVER
                      	
  D778                	BDWT:
  D778  3E            		DB	03EH	;LD A,??
  D779  37            		SCF
  D77A  1802          		JR	BRW
                      	
  D77C                	BDRD:
  D77C  3E            		DB	03EH	;LD A,??
  D77D  A7            		AND	A
  D77E                	BRW:
  D77E  F3            		DI
  D77F  32AAD7        		LD	(BRWPAT),A
  D782  ED73CAD7      		LD	(BANKSP),SP
  D786  3ACBD7        		LD	A,(BANKSP_H)
  D789  87            		ADD	A,A
  D78A  3803          		JR	C,BRW0
  D78C  31CAFF        		LD	SP,EXTSP
  D78F                	BRW0:
  D78F  D9            		EXX		;裏レジスタ
  D790  C5            		 PUSH	 BC
  D791  D5            		 PUSH	 DE
  D792  01000B        		 LD	 BC,00B00H	 ;バンクメモリ
  D795  111010        		 LD	 DE,01010H
  D798  D9            		 EXX		;表レジスタ
  D799                	BRW1:
  D799  C5            		PUSH	BC
  D79A  D5            		PUSH	DE
  D79B  EB            		EX	DE,HL
  D79C  29            		ADD	HL,HL
  D79D  29            		ADD	HL,HL
  D79E  7C            		LD	A,H
  D79F  DD860C        		ADD	A,(IX+00CH)	;DPB_0C_MAXCYL
  D7A2  E60F          		AND	00FH	;バンク
  D7A4  65            		LD	H,L
  D7A5  CB3C          		SRL	H	;/2
  D7A7  2E00          		LD	L,0
  D7A9  D9            		EXX		;裏レジスタ
  D7AA  A7            	BRWPAT:	 AND	 A	;自己書き換え(AND A:読み出し/SCF:書き込み)
  D7AB  3808          		 JR	 C,BRWT
  D7AD  57            		 LD	 D,A	 ;D=バンク
  D7AE  D9            		 EXX		;表レジスタ
  D7AF  EB            		EX	DE,HL
  D7B0  CDCED7        		CALL	BTFR
  D7B3  1806          		JR	BRW2
  D7B5                	BRWT:
  D7B5  5F            		 LD	E,A	 ;E=バンク
  D7B6  D9            		 EXX		;表レジスタ
  D7B7  CDCED7        		CALL	BTFR
  D7BA  EB            		EX	DE,HL
  D7BB                	BRW2:
  D7BB  D1            		POP	DE
  D7BC  C1            		POP	BC
  D7BD  13            		INC	DE
  D7BE  10D9          		DJNZ	BRW1
                      	
  D7C0  D9            		EXX		;裏レジスタ
  D7C1  3E10          		 LD	 A,10H
  D7C3  ED79          		 OUT	 (C),A		;メインメモリに切り替える
  D7C5  D1            		 POP	 DE
  D7C6  C1            		 POP	 BC
  D7C7  D9            		 EXX		;表レジスタ
  D7C8  AF            		XOR	A
  D7C9  310000        		LD	SP,0
  D7CB                	BANKSP_H	EQU	$-1
  D7CA                	BANKSP		EQU	$-2
  D7CC  FB            		EI
  D7CD  C9            		RET
                      	
                      	;メインメモリ←→バンクメモリ 512バイトの転送を行う
                      	; DE:転送元アドレス
                      	; HL:転送先アドレス
                      	; 裏BC:バンク切り替えポート(0B00H)
                      	; 裏D:転送元バンク(0-0FH:10Hはメインメモリ)
                      	; 裏E:転送先バンク(0-0FH:10Hはメインメモリ)
                      	
  D7CE                	BTFR:
  D7CE  0600          		LD	B,0	;256回ループ(256*2)
  D7D0                	BTFR1:
  D7D0  D9            		EXX		;裏レジスタ
  D7D1  ED51          		 OUT	 (C),D	 ;BANK(MAIN)
  D7D3  D9            		 EXX		;表レジスタ
  D7D4  1A            		LD	A,(DE)
  D7D5  4F            		LD	C,A
  D7D6  13            		INC	DE
  D7D7  1A            		LD	A,(DE)
  D7D8  13            		INC	DE
  D7D9  D9            		EXX		;裏レジスタ
  D7DA  ED59          		 OUT	 (C),E	 ;MAIN(BANK)
  D7DC  D9            		 EXX		;表レジスタ
  D7DD  71            		LD	(HL),C
  D7DE  23            		INC	HL
  D7DF  77            		LD	(HL),A
  D7E0  23            		INC	HL
  D7E1  10ED          		DJNZ	BTFR1
  D7E3  C9            		RET
                      	
                      	;	EMM DRIVER(DMA)
                      	
                      	
  D7E4                	EDWT:
  D7E4  0E0F          		LD	C,15
  D7E6  1802          		JR	EDWT1
  D7E8                	EDRD:
  D7E8  0E0E          		LD	C,14
  D7EA                	EDWT1:
  D7EA  C5            		PUSH	BC
  D7EB  D5            		PUSH	DE
  D7EC  222CD8        		LD	(DMAB),HL
  D7EF  78            		LD	A,B
  D7F0  87            		ADD	A,A
  D7F1  3D            		DEC	A
  D7F2  3225D8        		LD	(DMALEN+1),A
  D7F5  3C            		INC	A
  D7F6  84            		ADD	A,H	;HL(アドレス)を先に進めておく
  D7F7  67            		LD	H,A
  D7F8  EB            		EX	DE,HL
  D7F9  29            		ADD	HL,HL
  D7FA  DD460C        		LD	B,(IX+00CH)	;DPB_0C_MAXCYL
  D7FD  79            		LD	A,C
  D7FE  DD4E0D        		LD	C,(IX+00DH)	;DPB_0D_MAXSEC
  D801  09            		ADD	HL,BC
  D802  DD4E13        		LD	C,(IX+013H)	;DPB_13_UNITNO
  D805  060D          		LD	B,00DH
  D807  ED49          		OUT	(C),C
  D809  0C            		INC	C
  D80A  ED69          		OUT	(C),L
  D80C  0C            		INC	C
  D80D  ED61          		OUT	(C),H
                      	
  D80F  2120D8        		LD	HL,EDMAD
  D812  CD93DF        		CALL	SETDMA
  D815  CDBBDF        		CALL	GO_DMA
  D818  EB            		EX	DE,HL
  D819  D1            		POP	DE
  D81A  C1            		POP	BC
  D81B                	DMA_ADD_SEC:
  D81B  13            		INC	DE
  D81C  10FD          		DJNZ	DMA_ADD_SEC
  D81E  AF            		XOR	A
  D81F  C9            		RET
                      	
  D820                	EDMAD:
  D820  C3            		DB	0C3H	;WR6 リセット
  D821  7D            		DB	07DH	;WR0 ポートA→ポートB 転送
  D822  030D          		DW	00D03H	;ポートA開始アドレス EMMリード/ライト
  D824  FF01          	DMALEN:	DW	001FFH	;ブロック長(転送サイズ-1)
  D826  2C            		DB	02CH	;WR1 ポートAアドレス固定 I/O
  D827  50            		DB	050H	;WR2 ポートBアドレスインクリメント メモリ
  D828  02            		DB	002H	;ポートBタイミング
  D829  80            		DB	080H	;WR3
  D82A  9A            		DB	09AH	;WR5 WAIT RDY:HIGH
  D82B  AD            		DB	0ADH	;WR4 連続 ポートB開始アドレス
  D82C  0000          	DMAB:	DW	0
  D82E  01            		DB	001H	;WR0 ポートA←ポートB 転送
  D82F                	EMME:
                      	
  06B5                	AT_RE	EQU	EDWT-AT_EDWT
                      	
                      	
                      	;LDOS.ASM
                      	
                      	;	LSX-Dodgers OS
                      	
  D82F                	BDOS0:
  D82F  E5            		PUSH	HL
  D830  79            		LD	A,C
  D831  FE3C          		CP	03CH
  D833  3802          		JR	C,DOS1
  D835  3E3C          		LD	A,03CH
  D837                	DOS1:
  D837  87            		ADD	A,A
  D838  6F            		LD	L,A
  D839  26F1          		LD	H,STABLE/256
  D83B  7E            		LD	A,(HL)
  D83C  2C            		INC	L
  D83D  66            		LD	H,(HL)
  D83E  6F            		LD	L,A
  D83F  E3            		EX	(SP),HL
  D840  79            		LD	A,C
                      	;確認用
                      	;	LD	(0050H),A
  D841  C9            		RET
  D842                	_DOS2:
  D842  FE5A          		CP	05AH		;(BDOS)カレントディレクトリの変更(_CHDIR)
  D844  CAE3DA        		JP	Z,_SYS5A
  D847  FE5C          		CP	05CH		;(BDOS)ファイル名の解析(_PFILE)
  D849  CA9FDA        		JP	Z,_SYS29
  D84C  FE5F          		CP	05FH		;(BDOS)ディスクバッファのフラッシュ(_FLUSH)
  D84E  CAF9ED        		JP	Z,_SYS5F
  D851  FE6F          		CP	06FH		;(BDOS)MSX-DOS のバージョン番号の獲得(_DOSVER)
  D853  200A          		JR	NZ,_ERROR
  D855  011D01        		LD	BC,011DH
  D858  115401        		LD	DE,VER
  D85B  210000        		LD	HL,MACD
  D85E                	C_REM:
  D85E  AF            		XOR	A
  D85F                	_ERROR:
  D85F  A7            		AND	A
  D860  C9            		RET
                      	
  D861                	_SYS09:		;文字列出力
  D861  D5            		PUSH	DE
  D862                	_SX09:
  D862  1A            		LD	A,(DE)
  D863  13            		INC	DE
  D864  FE24          		CP	'$'
  D866  2831          		JR	Z,SX0E2
  D868  CDBEDB        		CALL	MSG_A
  D86B  18F5          		JR	_SX09
                      	
  D86D                	MSX1:
  D86D  CDBEDB        		CALL	MSG_A
  D870                	MSX:
  D870  7E            		LD	A,(HL)
  D871  23            		INC	HL
  D872  B7            		OR	A
  D873  20F8          		JR	NZ,MSX1
  D875  C9            		RET
                      	
  D876                	_SYS0C:		;(BDOS)バージョン番号の獲得
  D876  212200        		LD	HL,00022H
  D879  7D            		LD	A,L
  D87A  C9            		RET
                      	
  D87B                	_SYS0D:		;(BDOS)ディスクリセット
  D87B  CDDFF0        		CALL	_FFLUSH
  D87E  E5            		PUSH	HL
  D87F  218000        		LD	HL,00080H
  D882  228AF0        		LD	(_DTA),HL
  D885  E1            		POP	HL
  D886  D5            		PUSH	DE
  D887  1E00          		LD	E,0
  D889  3E            		DB	03EH
                      	
  D88A                	_SYS0E:		;(BDOS)カレントドライブの設定
  D88A  D5            		PUSH	DE
  D88B  7B            		LD	A,E
  D88C  DDE5          		PUSH	IX
  D88E  CDDCF0        		CALL	_GETDPB
  D891  DDE1          		POP	IX
  D893  3804          		JR	C,SX0E2
  D895  7B            		LD	A,E
  D896  3287F0        		LD	(_DVSW),A
  D899                	SX0E2:
  D899  D1            		POP	DE
  D89A  C9            		RET
                      	
  D89B                	_SYS0F:		;(BDOS)ファイルのオープン
  D89B  CD74E1        		CALL	SETDRV
  D89E  FD7E1C        		LD	A,(IY+28)	;(FCB)オープンモード
  D8A1  C602          		ADD	A,002H		;Write
  D8A3  2848          		JR	Z,FEND0F
  D8A5  CDC2E4        		CALL	CHKWILDX
                      	
  D8A8  D494E1        		CALL	NC,SOPENX
  D8AB                	_S16XX:
  D8AB  3840          		JR	C,FEND0F
                      					;Directory location
  D8AD  3A9FF0        		LD	A,(_FILEN)
  D8B0  FD7719        		LD	(IY+25),A	;(FCB)ディレクトリロケーション
                      	;				_DIRF
  D8B3  3AA0F0        		LD	A,(_DIRF)
  D8B6  FD771D        		LD	(IY+29),A	;(FCB)ディレクトリモード
                      	;				_FBPS
  D8B9  FD731E        		LD	(IY+30),E	;(FCB)ディレクトリポジション
  D8BC  FD721F        		LD	(IY+31),D
                      	;				Open(Read)
  D8BF  FD361CFF      		LD	(IY+28),0FFH	;(FCB)オープンモード
                      	;				FILENAME
  D8C3  FDE5          		PUSH	IY
  D8C5  D1            		POP	DE
  D8C6  13            		INC	DE
  D8C7  010B00        		LD	BC,11
  D8CA  EDB0          		LDIR
                      	;				Attribute
  D8CC  7E            		LD	A,(HL)
  D8CD  FD770D        		LD	(IY+13),A	;(FCB)属性(アトリビュート)
  D8D0  110B00        		LD	DE,11		;Reserved
  D8D3  19            		ADD	HL,DE
                      						;(FCB)ファイルを最後に変更した時刻
  D8D4  11EAF1        		LD	DE,SDDATA		;(FCB)ファイルを最後に変更した日付
  D8D7  060A          		LD	B,SDDATAE-SDDATA	;(FCB)ファイルの先頭クラスタ
  D8D9                	S16LOOP:				;(FCB)ファイルのサイズ(バイト単位)
  D8D9  1A            		LD	A,(DE)
  D8DA  13            		INC	DE
  D8DB  32E2D8        		LD	(S16PAT+2),A
  D8DE  7E            		LD	A,(HL)
  D8DF  23            		INC	HL
  D8E0  FD7700        	S16PAT:	LD	(IY+0),A
  D8E3  10F4          		DJNZ	S16LOOP
                      	
  D8E5  AF            		XOR	A
  D8E6  FD770C        		LD	(IY+12),A	;(FCB)カレントブロック
  D8E9  FD2291D9      		LD	(OFCB+1),IY
  D8ED                	FEND0F:
  D8ED  1845          		JR	FEND10
                      	
  D8EF                	_SYS10:		;(BDOS)ファイルのクローズ
  D8EF  CD74E1        		CALL	SETDRV
  D8F2  FD7E1C        		LD	A,(IY+28)	;(FCB)オープンモード
  D8F5  D6FE          		SUB	0FEH
  D8F7  37            		SCF
  D8F8  3F            		CCF
  D8F9  2039          		JR	NZ,FEND10
  D8FB                	_S10A:				;Write
  D8FB  FD770E        		LD	(IY+14),A	;(FCB)レコードサイズ/アクセスするディレクトリのクラスタ番号+1
  D8FE  FD770F        		LD	(IY+15),A
                      	
  D901  FD341C        		INC	(IY+28)		;0FEH->0FFH ;オープンモード
  D904  CDBAE5        		CALL	SETTMS
                      	
  D907  FD7E1D        		LD	A,(IY+29)	;(FCB)ディレクトリモード
  D90A  32A0F0        		LD	(_DIRF),A
  D90D  E67F          		AND	07FH
  D90F  3203EB        		LD	(_SECPS+1),A
  D912  FD5E1E        		LD	E,(IY+30)	;(FCB)ディレクトリポジション
  D915  FD561F        		LD	D,(IY+31)
  D918  CDC8E2        		CALL	READ_DIR
  D91B  3817          		JR	C,FEND10
                      	
  D91D  3AF2E1        	SDECM1:	LD	A,(SDECPAT+1)	;1セクタ辺りのディレクトリエントリ数
  D920  3D            	 	DEC	A		;1024=01FH / 512=00FH / 256=7
  D921  FDA619        		AND	(IY+25)		;(FCB)ディレクトリロケーション
  D924  6F            		LD	L,A
  D925  2600          		LD	H,0
  D927  29            		ADD	HL,HL		;*2
  D928  29            		ADD	HL,HL		;*4
  D929  29            		ADD	HL,HL		;*8
  D92A  29            		ADD	HL,HL		;*16
  D92B  29            		ADD	HL,HL		;*32
  D92C  ED4B7EF1      		LD	BC,(_DTBUF)
  D930  09            		ADD	HL,BC
                      	
  D931  CDD2E4        		CALL	SDIRENT
  D934                	FEND10:
  D934  1842          		JR	FEND
                      	
  D936                	_SYS11:		;(BDOS)最初のファイルの検索
  D936  CD74E1        		CALL	SETDRV
  D939  CDC1E1        		CALL	SOPEN
  D93C                	_S12X1:
  D93C  383A          		JR	C,FEND
  D93E  CD61E2        		CALL	SOPENE2
  D941  ED5B8AF0      		LD	DE,(_DTA)
  D945  3A88F0        		LD	A,(_DRV)
  D948  3C            		INC	A
  D949  12            		LD	(DE),A
  D94A  D5            		PUSH	DE
  D94B  13            		INC	DE
  D94C  012000        		LD	BC,32
  D94F  EDB0          		LDIR
  D951  FD6E0E        		LD	L,(IY+14)	;(FCB)レコードサイズ/アクセスするディレクトリのクラスタ番号+1
  D954  FD660F        		LD	H,(IY+15)
  D957  22F4F1        		LD	(SCDIR),HL
  D95A  2A9AF0        		LD	HL,(_FBPS)
  D95D  22F6F1        		LD	(SFBPS),HL
  D960  2A9FF0        		LD	HL,(_FILEN)
  D963  7C            		LD	A,H
  D964  B7            		OR	A
  D965  2806          		JR	Z,_S12DIR
  D967  3A03EB        		LD	A,(_SECPS+1)
  D96A  F680          		OR	080H
  D96C  67            		LD	H,A
  D96D                	_S12DIR:
  D96D  22F8F1        		LD	(SFNDF),HL	;Directory position and Flags
  D970  E1            		POP	HL
  D971  1139F0        		LD	DE,SFILE
  D974  0E21          		LD	C,33
  D976                	_S11B:
  D976  EDB0          		LDIR
  D978                	FEND:
  D978  9F            		SBC	A,A		;CF=0 A=0 : CF=1 A=0FFH
  D979                	FENDE:
  D979  FDE1          		POP	IY
  D97B  C1            		POP	BC
  D97C  D1            		POP	DE
  D97D  E1            		POP	HL
  D97E  C9            		RET
                      	
  D97F                	_SYS12:		;(BDOS)次のファイルの検索
  D97F  E5            		PUSH	HL
  D980  D5            		PUSH	DE
  D981  C5            		PUSH	BC
  D982  FDE5          		PUSH	IY
  D984  CD25E2        		CALL	NOPEN
  D987  18B3          		JR	_S12X1
                      	
  D989                	_S16K:
  D989  FD7E1C        		LD	A,(IY+28)	;(FCB)オープンモード
  D98C  FEFD          		CP	0FDH		;Device(0FDH)
  D98E  37            		SCF
  D98F  C8            		RET	Z
                      	
  D990  110000        	OFCB:	LD	DE,0
  D993  D5            		PUSH	DE
  D994  061A          		LD	B,26		;First cluster
  D996                	S16K1:
  D996  13            		INC	DE
  D997  23            		INC	HL
  D998  10FC          		DJNZ	S16K1
                      	
  D99A  1A            		LD	A,(DE)
  D99B  BE            		CP	(HL)
  D99C  2013          		JR	NZ,S16K2
  D99E  13            		INC	DE
  D99F  23            		INC	HL
  D9A0  1A            		LD	A,(DE)
  D9A1  BE            		CP	(HL)
  D9A2  200D          		JR	NZ,S16K2
                      	
  D9A4  E1            		POP	HL
  D9A5  FDE5          		PUSH	IY
  D9A7  D1            		POP	DE
  D9A8  1A            		LD	A,(DE)		;Drive
  D9A9  BE            		CP	(HL)
  D9AA  2006          		JR	NZ,S16K3
                      					;ここはCFが必ず0
  D9AC  ED52          		SBC	HL,DE		;CP HL,DE
  D9AE  37            		SCF
  D9AF  C0            		RET	NZ
  D9B0  E5            		PUSH	HL
  D9B1                	S16K2:
  D9B1  E1            		POP	HL
  D9B2                	S16K3:
  D9B2  FDE5          		PUSH	IY
  D9B4  D1            		POP	DE
  D9B5                	_SYS13:		;(BDOS)ファイルの削除
  D9B5  CD74E1        		CALL	SETDRV
  D9B8  CDF2E3        		CALL	KILL
  D9BB                	FEND13:
  D9BB  18BB          		JR	FEND
                      	
  D9BD                	_SYS14:		;(BDOS)シーケンシャルな読み出し
  D9BD  CD74E1        		CALL	SETDRV
  D9C0  CD26E6        		CALL	INIT_SEQ
  D9C3                	SREAD:
  D9C3  CD70E6        		CALL	RB_READ
                      	
  D9C6  C601          		ADD	A,001H
  D9C8  38AE          		JR	C,FEND
                      	
  D9CA  7D            		LD	A,L
  D9CB  D601          		SUB	001H
  D9CD                	FENDX:
  D9CD  9F            		SBC	A,A
  D9CE  E603          		AND	3
  D9D0  1F            		RRA
  D9D1  18A6          		JR	FENDE
                      	
  D9D3                	_SYS15:		;(BDOS)シーケンシャルな書き込み
  D9D3  CD74E1        		CALL	SETDRV
  D9D6  CD26E6        		CALL	INIT_SEQ
  D9D9                	SWRITE:
  D9D9  CD69E6        		CALL	RB_WRITE
                      	
  D9DC  C6FF          		ADD	A,0FFH
  D9DE  18ED          		JR	FENDX
                      	
  D9E0                	_SYS17:		;(BDOS)ファイル名の変更
  D9E0  CD74E1        		CALL	SETDRV
  D9E3  CD48E4        		CALL	NAME
  D9E6  18D3          		JR	FEND13
                      	
  D9E8                	_SYS16:		;(BDOS)ファイルの作成
  D9E8  CD74E1        		CALL	SETDRV
                      	
  D9EB  CDC2E4        		CALL	CHKWILDX
  D9EE  38CB          		JR	C,FEND13
  D9F0  FD7E01        		LD	A,(IY+1)	;(FCB)主ファイル名
  D9F3  FE05          		CP	5
  D9F5  2805          		JR	Z,_S16X2
  D9F7  FE21          		CP	021H
  D9F9  DABBD9        		JP	C,FEND13
  D9FC                	_S16X2:
                      	;				Clear FCB
  D9FC  FDE5          		PUSH	IY
  D9FE  E1            		POP	HL
  D9FF  011000        		LD	BC,16
  DA02  09            		ADD	HL,BC
  DA03                	_S16X1:
  DA03  70            		LD	(HL),B		;B=0
  DA04  23            		INC	HL
  DA05  0D            		DEC	C
  DA06  20FB          		JR	NZ,_S16X1
                      	
  DA08  CDBFE5        		CALL	SETTMSX
  DA0B  FD360DFF      		LD	(IY+13),0FFH	;(FCB)Attribute
  DA0F  CD94E1        		CALL	SOPENX
  DA12  3F            		CCF
  DA13  CC89D9        		CALL	Z,_S16K
  DA16  D472E2        		CALL	NC,COPEN
  DA19  D4D2E4        		CALL	NC,SDIRENT
  DA1C  C3ABD8        		JP	_S16XX
                      	
  DA1F                	_SYS21:		;(BDOS)ランダムな読み出し
  DA1F  CD74E1        		CALL	SETDRV
  DA22  CD0AE6        		CALL	INIT_RND
  DA25  189C          		JR	SREAD
                      	
  DA27                	_SYS22:		;(BDOS)ランダムな書き込み
  DA27                	_SYS28:		;(BDOS)ランダムな書き込み・その2
  DA27  CD74E1        		CALL	SETDRV
  DA2A  CD0AE6        		CALL	INIT_RND
  DA2D  18AA          		JR	SWRITE
                      	
  DA2F                	_SYS18:		;(BDOS)ログインベクトルの獲得
  DA2F  21FF00        		LD	HL,000FFH
  DA32  AF            		XOR	A
  DA33  C9            		RET
                      	
  DA34                	_SYS19:		;(BDOS)カレントドライブ番号の獲得
  DA34  3A87F0        		LD	A,(_DVSW)
  DA37  A7            		AND	A
  DA38  C9            		RET
                      	
  DA39                	_SYS1A:		;(BDOS)DTAの設定
  DA39  ED538AF0      		LD	(_DTA),DE
  DA3D  AF            		XOR	A
  DA3E  C9            		RET
                      	
  DA3F                	_SYS1B:		;(BDOS)ディスク情報の獲得
  DA3F  7B            		LD	A,E
  DA40  CD87E1        		CALL	GETDRV
  DA43  CDDCF0        		CALL	_GETDPB
  DA46  D4E2F0        		CALL	NC,_RDFATX
  DA49  210000        		LD	HL,0
  DA4C  D498E5        		CALL	NC,DSKF
                      	
  DA4F  ED5B99E5      		LD	DE,(MAXCLP+1)	;DPB_08_MAXCL-1
  DA53  1B            		DEC	DE		;DE←クラスタの総数
  DA54  FD2A7CF1      		LD	IY,(_FATBF)	;IY←メモリ上のFATの先頭アドレス
  DA58  9F            		SBC	A,A
  DA59  D8            		RET	C
  DA5A  4F            		LD	C,A		;C=0
  DA5B  DD7E0F        		LD	A,(IX+00FH)	;DPB_0F_BPS
  DA5E  E60F          		AND	00FH
  DA60  47            		LD	B,A
  DA61  DD7E07        		LD	A,(IX+7)	;DPB_07_SECPCL
  DA64  C9            		RET
                      	
  DA65                	_SYS1D:		;(BDOS)書き込みが禁止されているディスクの調査
  DA65  AF            		XOR	A
  DA66  67            		LD	H,A
  DA67  6F            		LD	L,A
  DA68  C9            		RET
                      	
  DA69                	_SYS1F:		;(BDOS)ディスク装置のパラメータの読み出し
  DA69  2100F2        		LD	HL,DEVICE
  DA6C  7B            		LD	A,E
  DA6D  C3DCF0        		JP	_GETDPB
                      	
  DA70                	_SYS23:		;(BDOS)ファイルサイズの獲得
  DA70  E5            		PUSH	HL
  DA71  2A1EF1        		LD	HL,(STABLE+2*00FH)	;ファイルのオープン
  DA74  CD0F00        		CALL	JP_HL
  DA77  381B          		JR	C,_S23X1
                      	
  DA79  D5            		PUSH	DE		;EX DE,IY
  DA7A  FDE3          		EX	(SP),IY		;
                      	;	POP	DE		;
                      	;	PUSH	DE		;DEを破壊しないように注意vv
  DA7C  FD7E10        		LD	A,(IY+16)	;(FCB)ファイルのサイズ(バイト単位)
  DA7F  FD6E11        		LD	L,(IY+17)	;
  DA82  FD6612        		LD	H,(IY+18)	;
  DA85  C5            		PUSH	BC		;
  DA86  FD4613        		LD	B,(IY+19)	;
  DA89  CDFCE5        		CALL	GET_CPM_R_SIZE
  DA8C  C1            		POP	BC
  DA8D                	_S24X1:
  DA8D  CD1CE6        		CALL	SET_RR_AHL
                      	;	POP	DE		;^^^^^^^^^^^^^^^^^^^^^^^^
                      	;	PUSH	DE		;EX DE,IY
  DA90  FDE3          		EX	(SP),IY		;
  DA92  D1            		POP	DE		;
                      	
  DA93  AF            		XOR	A
  DA94                	_S23X1:
  DA94  E1            		POP	HL
  DA95  C9            		RET
                      	
  DA96                	_SYS24:		;(BDOS)ランダムレコードフィールドの設定
  DA96  E5            		PUSH	HL
  DA97  D5            		PUSH	DE		;EX DE,IY
  DA98  FDE3          		EX	(SP),IY		;
                      	;	POP	DE		;
                      	;	PUSH	DE		;DEを破壊しないように注意vv
  DA9A  CD2EE6        		CALL	GETSEQ
  DA9D  18EE          		JR	_S24X1		;^^^^^^^^^^^^^^^^^^^^^^^^
                      	
  DA9F                	_SYS29:		;(BDOS)ファイル名の解析(_PPATH)
  DA9F  C5            		PUSH	BC
  DAA0  E5            		PUSH	HL
  DAA1  CD8BE0        		CALL	FILE
  DAA4  E1            		POP	HL
  DAA5  C1            		POP	BC
  DAA6                	S29X1:
  DAA6  C5            		PUSH	BC
  DAA7  D5            		PUSH	DE
  DAA8  E5            		PUSH	HL
  DAA9  EB            		EX	DE,HL
  DAAA  2114F0        		LD	HL,FDRV
  DAAD  010D00        		LD	BC,13
  DAB0  EDB0          		LDIR
  DAB2  70            		LD	(HL),B		;B=0
  DAB3  0E03          		LD	C,3
  DAB5  EDB0          		LDIR
  DAB7  E1            		POP	HL
  DAB8  D1            		POP	DE
  DAB9  C1            		POP	BC
  DABA  AF            		XOR	A
  DABB  C9            		RET
                      	
  DABC                	_SYS30:		;(BDOS)論理セクタを用いた書き込み
  DABC  C5            		PUSH	BC
  DABD  019DEC        		LD	BC,DWT24B
  DAC0  1804          		JR	S2FX
  DAC2                	_SYS2F:
  DAC2  C5            		PUSH	BC
  DAC3  018DEC        		LD	BC,DRD24B
  DAC6                	S2FX:
  DAC6  ED43DCDA      		LD	(S2FPAT+1),BC
  DACA  CDDFF0        		CALL	_FFLUSH
                      	
  DACD  D5            		PUSH	DE
  DACE  E5            		PUSH	HL
  DACF  7D            		LD	A,L		;Drive
  DAD0  CDD9F0        		CALL	_CHGDRV
  DAD3  3809          		JR	C,S30X2
  DAD5  44            		LD	B,H		;Number of clusters
  DAD6  2A8AF0        		LD	HL,(_DTA)
                      	
  DAD9  0E00          		LD	C,0
  DADB  CD8DEC        	S2FPAT:	CALL	DRD24B
  DADE                	S30X2:
  DADE  E1            		POP	HL
  DADF  D1            		POP	DE
  DAE0  C1            		POP	BC
  DAE1  9F            		SBC	A,A
  DAE2  C9            		RET
                      	
  DAE3                	_SYS5A:		;(BDOS)カレントディレクトリの変更
  DAE3  C5            		PUSH	BC
  DAE4  D5            		PUSH	DE
  DAE5  E5            		PUSH	HL
  DAE6  CD80E0        		CALL	FILEC
  DAE9  210000        		LD	HL,0
  DAEC  1114F0        		LD	DE,FDRV
  DAEF  2A4EF1        		LD	HL,(STABLE+2*027H)	;ランダムブロック読み込み
  DAF2  CD0F00        		CALL	JP_HL
  DAF5  18E7          		JR	S30X2
                      	
                      	;X1IO.ASM
                      	
                      	;	LSX-Dodgers IO
                      	;	X1/turbo/Z
                      	
  D85F                	_SYS04	EQU	_ERROR		;(BDOS)外部出力
  D85F                	_SYS05	EQU	_ERROR		;(BDOS)プリンタ出力
  D85F                	_SYS1C	EQU	_ERROR		;(BDOS)ディスクの書き込み禁止化
  D85F                	_SYS1E	EQU	_ERROR		;(BDOS)ファイル属性の設定
  D85F                	_SYS20	EQU	_ERROR		;(BDOS)利用者番号の設定と読み出し
  D85F                	_SYS2E	EQU	_ERROR		;(BDOS)ベリファイ・フラグの設定
                      	
  DAF7                	BIOS:
  DAF7  E5            		PUSH	HL
  DAF8  211080        		LD	HL,08010H
  DAFB  39            		ADD	HL,SP
  DAFC  E1            		POP	HL
  DAFD  300E          		JR	NC,BIOS2
  DAFF                	BIOS1:
  DAFF  CD07DB        		CALL	BIOS3
  DB02  061E          		LD	B,01EH
  DB04  ED79          		OUT	(C),A
  DB06  C9            		RET
  DB07                	BIOS3:
  DB07  C5            		PUSH	BC
  DB08  061D          		LD	B,01DH
  DB0A  ED79          		OUT	(C),A
  DB0C  C9            		RET
  DB0D                	BIOS2:
  DB0D  ED7318DB      		LD	(BIOS_SP),SP	;スタックがBIOS-ROMと被っている場合
  DB11  31CAFF        		LD	SP,EXTSP
  DB14  CDFFDA        		CALL	BIOS1
  DB17  310000        		LD	SP,0
  DB18                	BIOS_SP	EQU	$-2
  DB1A  C9            		RET
                      	
  DB1B                	INT:
  DB1B  F5            		PUSH	AF
  DB1C  E5            		PUSH	HL
  DB1D  C5            		PUSH	BC
                      	
  DB1E  CDC2DE        		CALL	IN49SB
  DB21  67            		LD	H,A
  DB22  CDC2DE        		CALL	IN49SB
  DB25  6F            		LD	L,A
  DB26                	SCEXE:
  DB26  2292F0        		LD	(_KEYD),HL
  DB29  CD59DB        		CALL	KEYSET1
                      	
  DB2C  C1            		POP	BC
  DB2D                	INTPE:
  DB2D  E1            		POP	HL
  DB2E                	INTPE2:
  DB2E  F1            		POP	AF
  DB2F                	INTCTCE:
  DB2F  FB            		EI
  DB30  ED4D          		RETI
                      	
  DB32                	INTCTC2:
  DB32  F5            		PUSH	AF
  DB33  3E00          	INTCPAT:LD	A,000H
  DB35  3D            		DEC	A
  DB36  3234DB        		LD	(INTCPAT+1),A
  DB39  20F3          		JR	NZ,INTPE2
                      	
  DB3B  3A92F0        		LD	A,(_KEYD)
  DB3E  B7            		OR	A
  DB3F  28ED          		JR	Z,INTPE2
  DB41                	KEYSET0:
  DB41  E5            		PUSH	HL
  DB42  2A90F0        		LD	HL,(_KEYPS)
  DB45  7C            		LD	A,H
  DB46  AD            		XOR	L
  DB47  2006          		JR	NZ,INTC2A
                      	
  DB49  2A92F0        		LD	HL,(_KEYD)
  DB4C  CD8DDB        		CALL	KEYSET
  DB4F                	INTC2A:
  DB4F  3A94F0        		LD	A,(_KEYSP)
  DB52  E60F          		AND	00FH
  DB54  3234DB        		LD	(INTCPAT+1),A
                      	
  DB57  18D4          		JR	INTPE
                      	
  DB59                	KEYSET1:
  DB59  CB6C          		BIT	5,H
  DB5B  F5            		PUSH	AF
  DB5C  ED4B8CF0      		LD	BC,(_CTC)
  DB60  78            		LD	A,B
  DB61  B1            		OR	C
  DB62  2006          		JR	NZ,KEYS10E
                      	
  DB64  F1            		POP	AF
  DB65  2026          		JR	NZ,KEYSET
  DB67  F5            		PUSH	AF
  DB68  18D7          		JR	KEYSET0
  DB6A                	KEYS10E:
  DB6A  F1            		POP	AF
  DB6B  C8            		RET	Z
  DB6C  F5            		PUSH	AF
  DB6D  3E03          		LD	A,3		;CTC STOP
  DB6F  ED79          		OUT	(C),A
  DB71  F1            		POP	AF
                      	
  DB72  B7            		OR	A
  DB73  C8            		RET	Z
                      	
  DB74  3EA7          		LD	A,0A7H
  DB76  ED79          		OUT	(C),A
  DB78  3A94F0        		LD	A,(_KEYSP)
  DB7B  ED79          		OUT	(C),A
  DB7D  79            		LD	A,C
  DB7E  E6FC          		AND	0FCH
  DB80  4F            		LD	C,A
  DB81  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  DB83  3EC0          		LD	A,CTC0
  DB85  ED79          		OUT	(C),A
  DB87  3A95F0        		LD	A,(_KEYSP+1)
  DB8A  3234DB        		LD	(INTCPAT+1),A
                      	
  DB8D                	KEYSET:
  DB8D  7D            		LD	A,L
  DB8E  CB74          		BIT	6,H
  DB90  C0            		RET	NZ
  DB91                	KEYBS:
  DB91  B7            		OR	A
  DB92  C8            		RET	Z
  DB93                	KEYBS1:
  DB93  CDABDB        		CALL	KEYBC_IFBREAK
  DB96  E5            		PUSH	HL
  DB97  F5            		PUSH	AF
  DB98  2A90F0        		LD	HL,(_KEYPS)
  DB9B  2C            		INC	L
  DB9C  CBAD          		RES	5,L
  DB9E  7D            		LD	A,L
  DB9F  BC            		CP	H
  DBA0  2815          		JR	Z,POP_AF_HL_SCF_RET
  DBA2  3290F0        		LD	(_KEYPS),A
  DBA5  26FF          		LD	H,KEYBF/256
  DBA7  F1            		POP	AF
  DBA8  77            		LD	(HL),A
  DBA9  E1            		POP	HL
  DBAA  C9            		RET
  DBAB                	KEYBC_IFBREAK:
  DBAB  FE03          		CP	3
  DBAD  C0            		RET	NZ
  DBAE                	KEYBC:
  DBAE  E5            		PUSH	HL
  DBAF  210000        		LD	HL,0
  DBB2  2290F0        		LD	(_KEYPS),HL
  DBB5  E1            		POP	HL
  DBB6  C9            		RET
                      	
  DBB7                	POP_AF_HL_SCF_RET:
  DBB7  F1            		POP	AF
  DBB8  E1            		POP	HL
  DBB9  37            		SCF
  DBBA  C9            		RET
                      	
  DBBB                	_SYS01:		;(BDOS)コンソール入力
  DBBB  CD09F0        		CALL	_SYS07
  DBBE                	MSG_A:
  DBBE  F5            		PUSH	AF
  DBBF  D5            		PUSH	DE
  DBC0  5F            		LD	E,A
  DBC1  CDC7DB        		CALL	_SYS02
  DBC4  D1            		POP	DE
  DBC5  F1            		POP	AF
  DBC6  C9            		RET
                      	
  DBC7                	_SYS02:		;(BDOS)コンソール出力
  DBC7  CDD9DB        		CALL	BREAK
  DBCA  1805          		JR	PRINTX
                      	
  DBCC                	_SYS06:		;(BDOS)コンソール直接入出力
  DBCC  7B            		LD	A,E
  DBCD  3C            		INC	A
  DBCE  CACAF0        		JP	Z,_INKEY
  DBD1                	PRINTX:
  DBD1  C3CDF0        		JP	_PRINT
                      	
  DBD4                	_SYS08:		;(BDOS)エコーなしコンソール入力
  DBD4  CD09F0        		CALL	_SYS07
  DBD7  1804          		JR	BREAK1
  DBD9                	BREAK:
  DBD9  FB            		EI
  DBDA  3A92F0        		LD	A,(_KEYD)
  DBDD                	BREAK1:
  DBDD  FE03          		CP	3		;CTRL+C
  DBDF  CCF4F0        		CALL	Z,_BREAK
  DBE2  FE13          		CP	013H		;CTRL+S
  DBE4  C0            		RET	NZ
                      	
  DBE5                	PAUSE:
  DBE5  CDAEDB        		CALL	KEYBC
                      	
  DBE8                	FLGET:
  DBE8  CDDFF0        		CALL	_FFLUSH
  DBEB  C5            		PUSH	BC
  DBEC  E5            		PUSH	HL
  DBED  ED4B8EF0      		LD	BC,(_TXADR)
  DBF1  CBE8          		SET	5,B
  DBF3  ED60          		IN	H,(C)
  DBF5                	FLGET1:
  DBF5  3A93F0        		LD	A,(_KEYD+1)
  DBF8  0F            		RRCA
  DBF9  0F            		RRCA
  DBFA  E610          		AND	010H
  DBFC  F608          		OR	8
  DBFE  ED68          		IN	L,(C)
  DC00  B5            		OR	L
  DC01  ED79          		OUT	(C),A
  DC03  CDCAF0        		CALL	_INKEY
  DC06  28ED          		JR	Z,FLGET1
  DC08  ED61          		OUT	(C),H
  DC0A  E1            		POP	HL
  DC0B  C1            		POP	BC
  DC0C  C9            		RET
                      	
  DC0D                	_SYS0A:		;(BDOS)文字列入力
  DC0D  C5            		PUSH	BC
  DC0E  E5            		PUSH	HL
  DC0F  D5            		PUSH	DE
  DC10  CD0FE0        		CALL	GETL
  DC13  1120FF        		LD	DE,KBUF
  DC16  E1            		POP	HL
  DC17  E5            		PUSH	HL
  DC18  0E00          		LD	C,0
  DC1A  3004          		JR	NC,SAX0
  DC1C  23            		INC	HL
  DC1D  23            		INC	HL
  DC1E  1808          		JR	SAX4
  DC20                	SAX0:
  DC20  46            		LD	B,(HL)
  DC21  23            		INC	HL
  DC22                	SAX1:
  DC22  23            		INC	HL
  DC23  1A            		LD	A,(DE)
  DC24  13            		INC	DE
  DC25  B7            		OR	A
  DC26  2004          		JR	NZ,SAX2
  DC28                	SAX4:
  DC28  360D          		LD	(HL),00DH
  DC2A  1804          		JR	SAX3
  DC2C                	SAX2:
  DC2C  77            		LD	(HL),A
  DC2D  0C            		INC	C
  DC2E  10F2          		DJNZ	SAX1
  DC30                	SAX3:
  DC30  D1            		POP	DE
  DC31  79            		LD	A,C
  DC32  13            		INC	DE
  DC33  12            		LD	(DE),A
  DC34  1B            		DEC	DE
  DC35  E1            		POP	HL
  DC36  C1            		POP	BC
  DC37  A7            		AND	A
  DC38  C9            		RET
                      	
  DC39                	_SYS0B:		;(BDOS)コンソール状態のチェック
  DC39  CDD9DB        		CALL	BREAK
  DC3C  3A92F0        		LD	A,(_KEYD)
  DC3F  B7            		OR	A
  DC40  C8            		RET	Z
  DC41                	CONSTX:
  DC41  CDDFF0        		CALL	_FFLUSH
  DC44  E5            		PUSH	HL
  DC45  2A90F0        		LD	HL,(_KEYPS)
  DC48  7C            		LD	A,H
  DC49  AD            		XOR	L
  DC4A  E1            		POP	HL
  DC4B  C6FF          		ADD	A,0FFH
  DC4D  9F            		SBC	A,A
  DC4E  C9            		RET
                      	
  DC4F                	_SYS2A:		;(BDOS)日付の獲得
  DC4F  C5            		PUSH	BC
  DC50  3EED          		LD	A,0EDH		;Read calendar
  DC52  CDDDDE        		CALL	COMOUT
  DC55  CD87DC        		CALL	IN49SB_BCD	;YY
  DC58  6F            		LD	L,A
  DC59  2600          		LD	H,0
                      	;	LD	DE,1900		;0076CH
                      	;	CP	90		;90以上は1900年代 1990-1999
                      	;	JR	NC,RDDATE1	;90未満は2000年代 2000-2089
                      	;	LD	E,0D0H		;2000 & 0FFH D=007H
  DC5B  11D007        		LD	DE,2000		;すべて2000年代で処理 2000-2099
  DC5E                	RDDATE1:
  DC5E  19            		ADD	HL,DE
  DC5F  CDC2DE        		CALL	IN49SB		;MW
  DC62  57            		LD	D,A
  DC63  CD87DC        		CALL	IN49SB_BCD	;DD
  DC66  5F            		LD	E,A
  DC67  7A            		LD	A,D
  DC68  0604          		LD	B,4
  DC6A                	RDDATE2:
  DC6A  CB3A          		SRL	D
  DC6C  10FC          		DJNZ	RDDATE2
  DC6E  C1            		POP	BC
  DC6F  E607          		AND	7
  DC71  C9            		RET
                      	
  DC72                	_SYS2C:		;(BDOS)時刻の獲得
  DC72  C5            		PUSH	BC
  DC73  3EEF          		LD	A,0EFH		;Read time
  DC75  CDDDDE        		CALL	COMOUT
  DC78  CD87DC        		CALL	IN49SB_BCD	;TT
  DC7B  67            		LD	H,A
  DC7C  CD87DC        		CALL	IN49SB_BCD	;MM
  DC7F  6F            		LD	L,A
  DC80  CD87DC        		CALL	IN49SB_BCD	;SS
  DC83  57            		LD	D,A
  DC84  C1            		POP	BC
  DC85  AF            		XOR	A
  DC86  C9            		RET
                      	
  DC87                	IN49SB_BCD:
  DC87  CDC2DE        		CALL	IN49SB
                      	;------------------------
                      	;BCDの10進数化
                      	;in
                      	;	A  : BCD
                      	;out
                      	;	A  : 10進数
                      	;------------------------
  DC8A  4F            		LD	C,A
  DC8B  E6F0          		AND	0F0H	;10の位
  DC8D  0F            		RRCA
  DC8E  47            		LD	B,A
  DC8F  0F            		RRCA
  DC90  0F            		RRCA
  DC91  80            		ADD	A,B
  DC92  47            		LD	B,A
  DC93  79            		LD	A,C
  DC94  E60F          		AND	00FH	;1の位
  DC96  80            		ADD	A,B
  DC97  C9            		RET
                      	
  DC98                	ESC1:
  DC98  7B            		LD	A,E
  DC99  FE41          		CP	'A'
  DC9B  CAE0DD        		JP	Z,CTRL1E
  DC9E  FE42          		CP	'B'
  DCA0  CA48DF        		JP	Z,CTRL1F
  DCA3  FE43          		CP	'C'
  DCA5  CAEBDD        		JP	Z,CTRL1C
  DCA8  FE44          		CP	'D'
  DCAA  CAD7DD        		JP	Z,CTRL1D
  DCAD  FE45          		CP	'E'
  DCAF  2802          		JR	Z,CT0CX
  DCB1  FE6A          		CP	'j'
  DCB3                	CT0CX:
  DCB3  CA1BDF        		JP	Z,CTRL0C
  DCB6  FE48          		CP	'H'
  DCB8  CA65DE        		JP	Z,CTRL0B
  DCBB  FE4A          		CP	'J'
  DCBD  CA1EDF        		JP	Z,CTRL06
  DCC0  FE4B          		CP	'K'
  DCC2  2807          		JR	Z,CT05X
  DCC4  FE4C          		CP	'L'
  DCC6  CA5DDF        		JP	Z,CTRL0E
  DCC9  FE54          		CP	'T'
  DCCB                	CT05X:
  DCCB  CA24DE        		JP	Z,CTRL05
  DCCE  FE78          		CP	'x'
  DCD0  2804          		JR	Z,ESC1X
  DCD2  FE79          		CP	'y'
  DCD4  2002          		JR	NZ,ESC1Y
  DCD6                	ESC1X:
  DCD6  3601          		LD	(HL),1
  DCD8                	ESC1Y:
  DCD8  FE3D          		CP	'='
  DCDA  2804          		JR	Z,ESC1W
  DCDC  FE59          		CP	'Y'
  DCDE  2002          		JR	NZ,ESC1Z
  DCE0                	ESC1W:
  DCE0  3602          		LD	(HL),2
  DCE2                	ESC1Z:
  DCE2  FE20          		CP	020H
  DCE4  3802          		JR	C,ESC1C
  DCE6  87            		ADD	A,A
  DCE7  D0            		RET	NC
  DCE8                	ESC1C:
  DCE8  E1            		POP	HL
  DCE9                	ANK:
  DCE9  ED4B8EF0      		LD	BC,(_TXADR)
  DCED  78            		LD	A,B
  DCEE  F638          		OR	038H
  DCF0  47            		LD	B,A
  DCF1  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令	kanji
  DCF3  CB98          		RES	3,B
  DCF5  ED59          		OUT	(C),E		;Text
  DCF7                	KANJIE:
  DCF7  CDACDD        		CALL	PRINTE7
  DCFA                	PRINTE5:
  DCFA  E1            		POP	HL
  DCFB  C1            		POP	BC
  DCFC  AF            		XOR	A
  DCFD  C9            		RET
                      	
  DCFE                	ESC:
  DCFE  21FADC        		LD	HL,PRINTE5
  DD01  E5            		PUSH	HL
  DD02  2124DD        		LD	HL,ESCFLG+1
  DD05  3600          		LD	(HL),0
  DD07  3D            		DEC	A
  DD08  288E          		JR	Z,ESC1
  DD0A  3D            		DEC	A
  DD0B  2009          		JR	NZ,ESC2
  DD0D  3603          		LD	(HL),3
  DD0F  7B            		LD	A,E
  DD10  D620          		SUB	020H
  DD12  3219DD        		LD	(ESCYP+1),A
  DD15  C9            		RET
  DD16                	ESC2:
  DD16  3D            		DEC	A
  DD17  C0            		RET	NZ
  DD18  2600          	ESCYP:	LD	H,0
  DD1A  7B            		LD	A,E
  DD1B  D620          		SUB	020H
  DD1D  6F            		LD	L,A
  DD1E  C3D6F0        		JP	_LOC
                      	
  DD21                	PRINT:
  DD21  C5            		PUSH	BC
  DD22  E5            		PUSH	HL
  DD23  3E00          	ESCFLG:	LD	A,000H
  DD25  B7            		OR	A
  DD26  20D6          		JR	NZ,ESC
                      	
  DD28  3E1F          		LD	A,01FH
  DD2A  BB            		CP	E
  DD2B  3020          		JR	NC,CTRL
  DD2D  01E6DE        	INSFLG:	LD	BC,INSERT
                      	
  DD30  3A1800        		LD	A,(00018H)
  DD33  3C            		INC	A
  DD34  28B3          		JR	Z,ANK
  DD36  3E00          	KANFLG:	LD	A,000H
  DD38  B7            		OR	A
  DD39  2025          		JR	NZ,KANJI2
  DD3B  7B            		LD	A,E
  DD3C  FE80          		CP	080H
  DD3E  38A9          		JR	C,ANK
  DD40  FEA0          		CP	0A0H
  DD42  3804          		JR	C,KANJI1
  DD44  FEE0          		CP	0E0H
  DD46  38A1          		JR	C,ANK
  DD48                	KANJI1:
  DD48  3237DD        		LD	(KANFLG+1),A
  DD4B  18AD          		JR	PRINTE5
                      	
  DD4D                	CTRL:
  DD4D  CD93DD        		CALL	KANCLR
  DD50  7B            		LD	A,E
  DD51  87            		ADD	A,A
  DD52  F680          		OR	080H
  DD54  6F            		LD	L,A
  DD55  26F1          		LD	H,CTRLTB/256
  DD57  7E            		LD	A,(HL)
  DD58  2C            		INC	L
  DD59  66            		LD	H,(HL)
  DD5A  6F            		LD	L,A
  DD5B  CD0F00        		CALL	JP_HL
  DD5E  189A          		JR	PRINTE5
                      	
  DD60                	KANJI2:
  DD60  D5            		PUSH	DE
  DD61  57            		LD	D,A
  DD62  01812F        		LD	BC,02F81H	;SFTJIS
  DD65  DF            		RST	018H
  DD66  01C32F        		LD	BC,02FC3H	;Instead or JISVRM
  DD69  DF            		RST	018H
                      	
  DD6A  ED4B8EF0      		LD	BC,(_TXADR)
  DD6E  78            		LD	A,B
  DD6F  F638          		OR	038H
  DD71  47            		LD	B,A
  DD72  ED51          		OUT	(C),D		;kanji
  DD74  CB98          		RES	3,B
  DD76  ED59          		OUT	(C),E		;Text
  DD78  CDACDD        		CALL	PRINTE7
  DD7B  ED4B8EF0      		LD	BC,(_TXADR)
  DD7F  78            		LD	A,B
  DD80  F638          		OR	038H
  DD82  47            		LD	B,A
  DD83  CBF2          		SET	6,D
  DD85  ED51          		OUT	(C),D		;Kanji
  DD87  CB98          		RES	3,B
  DD89  ED59          		OUT	(C),E		;Text
  DD8B  D1            		POP	DE
  DD8C  AF            		XOR	A
  DD8D  3237DD        		LD	(KANFLG+1),A
  DD90  C3F7DC        		JP	KANJIE
                      	
  DD93                	KANCLR:
  DD93  3A37DD        		LD	A,(KANFLG+1)
  DD96  B7            		OR	A
  DD97  C8            		RET	Z
  DD98  ED4B8EF0      		LD	BC,(_TXADR)
  DD9C  78            		LD	A,B
  DD9D  F638          		OR	038H
  DD9F  47            		LD	B,A
  DDA0  AF            		XOR	A
  DDA1  3237DD        		LD	(KANFLG+1),A
  DDA4  ED79          		OUT	(C),A		;Kanji
  DDA6  CB98          		RES	3,B
  DDA8  3E20          		LD	A,020H
  DDAA  ED79          		OUT	(C),A		;Text
  DDAC                	PRINTE7:
  DDAC  CBA0          		RES	4,B
  DDAE                	PRINTE6:
  DDAE  3A96F0        		LD	A,(_COLORF)
  DDB1                	PRINTE4:
  DDB1  ED79          		OUT	(C),A		;Color
  DDB3  78            		LD	A,B
  DDB4  E607          		AND	7
  DDB6  47            		LD	B,A
  DDB7                	PRINTE2:
  DDB7  03            		INC	BC
  DDB8                	PRINTE3:
  DDB8  2ABAF0        		LD	HL,(_PAGE_MINUS)
  DDBB  A7            		AND	A
  DDBC  ED4A          		ADC	HL,BC
  DDBE                	PRINTE8:
  DDBE  2805          		JR	Z,PRINT2
  DDC0  ED438EF0      		LD	(_TXADR),BC
  DDC4                	CTRL00:
  DDC4  C9            		RET
                      	
  DDC5                	PRINT2:
  DDC5  CD63DF        		CALL	SCR
  DDC8  2ABCF0        		LD	HL,(_WIDTH_MINUS)
  DDCB  09            		ADD	HL,BC
  DDCC                	SET_TXADR_HL:
  DDCC  228EF0        		LD	(_TXADR),HL
  DDCF  C9            		RET
                      	
  DDD0                	CTRL08:
  DDD0  3A2DDD        		LD	A,(INSFLG)
  DDD3  FECD          		CP	0CDH		;CALL ????
  DDD5  2829          		JR	Z,CTRL02
  DDD7                	CTRL1D:
  DDD7  2A8EF0        		LD	HL,(_TXADR)
  DDDA  7C            		LD	A,H
  DDDB  B5            		OR	L
  DDDC  C8            		RET	Z
  DDDD  2B            		DEC	HL
  DDDE  18EC          		JR	SET_TXADR_HL
                      	
  DDE0                	CTRL1E:
  DDE0  ED4B8EF0      		LD	BC,(_TXADR)
  DDE4  2ABCF0        		LD	HL,(_WIDTH_MINUS)
  DDE7  09            		ADD	HL,BC
  DDE8  D0            		RET	NC
  DDE9  18E1          		JR	SET_TXADR_HL
                      	
  DDEB                	CTRL1C:
  DDEB  ED4B8EF0      		LD	BC,(_TXADR)
  DDEF  18C6          		JR	PRINTE2
                      	
  DDF1                	CTRL09:
  DDF1  ED4B8EF0      		LD	BC,(_TXADR)
  DDF5  79            		LD	A,C
  DDF6  E6F8          		AND	0F8H
  DDF8  C608          		ADD	A,8
  DDFA  4F            		LD	C,A
  DDFB  88            		ADC	A,B
  DDFC  91            		SUB	C
  DDFD  47            		LD	B,A
  DDFE  18B8          		JR	PRINTE3
                      	
  DE00                	CTRL02:
  DE00  CDD7DD        		CALL	CTRL1D
  DE03  C8            		RET	Z
  DE04  D5            		PUSH	DE
  DE05  CDD3F0        		CALL	_POS
  DE08  3AB1F0        		LD	A,(_WIDTH)
  DE0B  95            		SUB	L
  DE0C  4F            		LD	C,A
  DE0D  0D            		DEC	C
  DE0E  0638          		LD	B,038H
  DE10  2A8EF0        		LD	HL,(_TXADR)
  DE13  09            		ADD	HL,BC
  DE14  44            		LD	B,H
  DE15  4D            		LD	C,L
  DE16  110020        		LD	DE,02000H	;D:Text E:kanji
  DE19  2A96F0        		LD	HL,(_COLORF)	;L:Color
  DE1C                	C8X1:
  DE1C  CD02DF        		CALL	C12S
  DE1F  0B            		DEC	BC
  DE20  20FA          		JR	NZ,C8X1
  DE22  D1            		POP	DE
  DE23  C9            		RET
                      	
  DE24                	CTRL05:
  DE24  CDD3F0        		CALL	_POS
  DE27  3AB1F0        		LD	A,(_WIDTH)
  DE2A  95            		SUB	L
  DE2B  6F            		LD	L,A
  DE2C                	C08X1:
  DE2C  ED4B8EF0      		LD	BC,(_TXADR)
  DE30                	LINECL:
  DE30  2620          		LD	H,020H
  DE32  3A96F0        		LD	A,(_COLORF)
  DE35  CBE8          		SET	5,B
  DE37                	LINECL1:
  DE37  CBD8          		SET	3,B
  DE39  CBE0          		SET	4,B
  DE3B  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令	kanji
  DE3D  CB98          		RES	3,B
  DE3F  ED61          		OUT	(C),H		;Text
  DE41  CBA0          		RES	4,B
  DE43  ED79          		OUT	(C),A		;Color
  DE45  03            		INC	BC
  DE46  2D            		DEC	L
  DE47  20EE          		JR	NZ,LINECL1
  DE49  C9            		RET
                      	
  DE4A                	CTRL0D:
  DE4A  CDD3F0        		CALL	_POS
  DE4D  2E00          		LD	L,0
  DE4F                	LOC:
  DE4F  C5            		PUSH	BC
  DE50  E5            		PUSH	HL
  DE51  CD93DD        		CALL	KANCLR
  DE54  CD72DE        		CALL	LOC1
  DE57  228EF0        		LD	(_TXADR),HL
  DE5A  E1            		POP	HL
  DE5B  C1            		POP	BC
  DE5C  C9            		RET
                      	
  DE5D                	CTRL12:
  DE5D  212DDD        		LD	HL,INSFLG
  DE60  7E            		LD	A,(HL)
  DE61  EECC          		XOR	0CCH		;CD:CALL ???? 1:LD BC,????
  DE63  77            		LD	(HL),A
  DE64  C9            		RET
                      	
  DE65                	CTRL0B:
  DE65  210000        		LD	HL,0
  DE68  228EF0        		LD	(_TXADR),HL
  DE6B  C9            		RET
                      	
  DE6C                	CTRL1B:
  DE6C  3E01          		LD	A,1
  DE6E  3224DD        		LD	(ESCFLG+1),A
  DE71  C9            		RET
                      	
  DE72                	LOC1:
  DE72  D5            		PUSH	DE
  DE73  4D            		LD	C,L
  DE74  0608          		LD	B,8
  DE76  5C            		LD	E,H
  DE77  1600          		LD	D,0
  DE79  2AB0F0        		LD	HL,(CRTCD)
  DE7C  6A            		LD	L,D
  DE7D                	LOC2:
  DE7D  29            		ADD	HL,HL
  DE7E  3001          		JR	NC,LOC3
  DE80  19            		ADD	HL,DE
  DE81                	LOC3:
  DE81  10FA          		DJNZ	LOC2
  DE83  09            		ADD	HL,BC
  DE84  D1            		POP	DE
  DE85  C9            		RET
                      	
  DE86                	CONOUT1:
  DE86  CD98DE        		CALL	CURSOR
  DE89  59            		LD	E,C
  DE8A  CDCDF0        		CALL	_PRINT
  DE8D  7B            		LD	A,E
  DE8E  FE0A          		CP	00AH
  DE90  2006          		JR	NZ,CURSOR
  DE92  CD4ADE        		CALL	CTRL0D
  DE95  CD24DE        		CALL	CTRL05
  DE98                	CURSOR:
  DE98  C5            		PUSH	BC
  DE99  ED4B8EF0      		LD	BC,(_TXADR)
  DE9D  CBE8          		SET	5,B
  DE9F  ED78          		IN	A,(C)
  DEA1  EE18          		XOR	018H
  DEA3  ED79          		OUT	(C),A
  DEA5  C1            		POP	BC
  DEA6  C9            		RET
                      	
  DEA7                	CTRL07:
  DEA7  2161F0        		LD	HL,BEEPD
  DEAA                	BEEP1:
  DEAA  7E            		LD	A,(HL)
  DEAB  23            		INC	HL
  DEAC  FEFF          		CP	0FFH
  DEAE  C8            		RET	Z
  DEAF  061C          		LD	B,01CH
  DEB1  ED79          		OUT	(C),A
  DEB3  EDA3          		OUTI
  DEB5  18F3          		JR	BEEP1
                      	
  DEB7                	OT49SB:
  DEB7  C5            		PUSH	BC
  DEB8  CDD3DE        		CALL	CANW
  DEBB  010019        		LD	BC,01900H
  DEBE  ED79          		OUT	(C),A
  DEC0  C1            		POP	BC
  DEC1  C9            		RET
                      	
  DEC2                	IN49SB:
  DEC2  C5            		PUSH	BC
  DEC3  01011A        		LD	BC,01A01H
  DEC6                	CANR:
  DEC6  ED78          		IN	A,(C)
  DEC8  E620          		AND	020H
  DECA  20FA          		JR	NZ,CANR
  DECC  010019        		LD	BC,01900H
  DECF  ED78          		IN	A,(C)
  DED1  C1            		POP	BC
  DED2  C9            		RET
                      	
  DED3                	CANW:
  DED3  01011A        		LD	BC,01A01H
  DED6  ED48          		IN	C,(C)
  DED8  CB71          		BIT	6,C
  DEDA  20F7          		JR	NZ,CANW
  DEDC  C9            		RET
                      	
  DEDD                	COMOUT:
  DEDD  FB            		EI
  DEDE  CDB7DE        		CALL	OT49SB
  DEE1  CDD3DE        		CALL	CANW
  DEE4  F3            		DI
  DEE5  C9            		RET
                      	
  DEE6                	INSERT:
  DEE6  D5            		PUSH	DE
  DEE7  CDD3F0        		CALL	_POS
  DEEA  3AB1F0        		LD	A,(_WIDTH)
  DEED  95            		SUB	L
  DEEE  ED4B8EF0      		LD	BC,(_TXADR)
  DEF2  110020        		LD	DE,02000H	;D:Text E:Kanji
  DEF5  2A96F0        		LD	HL,(_COLORF)	;L:Color
  DEF8  CBE8          		SET	5,B
  DEFA                	C12X1:
  DEFA  CD02DF        		CALL	C12S
  DEFD  03            		INC	BC
  DEFE  20FA          		JR	NZ,C12X1
  DF00  D1            		POP	DE
  DF01  C9            		RET
                      	
  DF02                	C12S:
  DF02  CBE0          		SET	4,B
  DF04  CBD8          		SET	3,B
  DF06  ED60          		IN	H,(C)
  DF08  ED59          	X1PAT:	OUT	(C),E
  DF0A  5C            		LD	E,H
  DF0B  CB98          		RES	3,B
  DF0D  ED60          		IN	H,(C)
  DF0F  ED51          		OUT	(C),D
  DF11  54            		LD	D,H
  DF12  CBA0          		RES	4,B
  DF14  ED60          		IN	H,(C)
  DF16  ED69          		OUT	(C),L
  DF18  6C            		LD	L,H
  DF19  3D            		DEC	A
  DF1A  C9            		RET
                      	
  DF1B                	CTRL0C:
  DF1B  CD65DE        		CALL	CTRL0B
  DF1E                	CTRL06:
  DF1E  ED4B8EF0      		LD	BC,(_TXADR)
  DF22                	C1AX1:
  DF22  78            		LD	A,B
  DF23  F638          		OR	038H
  DF25  47            		LD	B,A
  DF26  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令	kanji
  DF28  CB98          		RES	3,B
  DF2A  3E20          		LD	A,020H
  DF2C  ED79          		OUT	(C),A		;Text
  DF2E  CBA0          		RES	4,B
  DF30  3A96F0        		LD	A,(_COLORF)
  DF33  ED79          		OUT	(C),A		;Color
  DF35  03            		INC	BC
  DF36  CBA8          		RES	5,B
  DF38  2ABAF0        		LD	HL,(_PAGE_MINUS)
  DF3B  09            		ADD	HL,BC
  DF3C  30E4          		JR	NC,C1AX1
  DF3E  C9            		RET
                      	
  DF3F                	CTRL04:
  DF3F  CDD3F0        		CALL	_POS
  DF42  7D            		LD	A,L
  DF43  B7            		OR	A
  DF44  C8            		RET	Z
  DF45                	CTRL03:
  DF45  CD4ADE        		CALL	CTRL0D
  DF48                	CTRL0A:
  DF48                	CTRL1F:
  DF48  ED4B8EF0      		LD	BC,(_TXADR)
  DF4C  2AB1F0        		LD	HL,(_WIDTH)
  DF4F  2600          		LD	H,0
  DF51  09            		ADD	HL,BC
  DF52  44            		LD	B,H
  DF53  4D            		LD	C,L
  DF54  2ABAF0        		LD	HL,(_PAGE_MINUS)
  DF57  09            		ADD	HL,BC
  DF58  3F            		CCF
  DF59  9F            		SBC	A,A
  DF5A  C3BEDD        		JP	PRINTE8
                      	
  DF5D                	CTRL0E:
  DF5D  CDD3F0        		CALL	_POS
  DF60  7C            		LD	A,H
  DF61  1804          		JR	SCR1
  DF63                	SCR:
  DF63  3A97F0        		LD	A,(_LINE)
  DF66  3D            		DEC	A
  DF67                	SCR1:
  DF67  C5            		PUSH	BC
  DF68  D5            		PUSH	DE
  DF69  F5            		PUSH	AF
  DF6A  3E07          		LD	A,7
  DF6C  219DDF        		LD	HL,SCRDMAD
  DF6F  CD93DF        		CALL	SETDMA
  DF72  F1            		POP	AF
  DF73  210038        		LD	HL,03800H
                      	
  DF76                	SCRUP1:
  DF76  B7            		OR	A
  DF77  284D          		JR	Z,SCRCL
  DF79  F5            		PUSH	AF
  DF7A  CDA4DF        		CALL	UPSUB		;kanji
  DF7D  3ABCF0        		LD	A,(_WIDTH_MINUS)
  DF80  5F            		LD	E,A
  DF81  16F7          		LD	D,0F7H
  DF83  19            		ADD	HL,DE
  DF84  D5            		PUSH	DE
  DF85  CDA4DF        		CALL	UPSUB		;Text
  DF88  D1            		POP	DE
  DF89  19            		ADD	HL,DE
  DF8A  CDA4DF        		CALL	UPSUB		;Color
  DF8D  CBE4          		SET	4,H
  DF8F  F1            		POP	AF
  DF90  3D            		DEC	A
  DF91  18E3          		JR	SCRUP1
                      	
  DF93                	SETDMA:
  DF93  01871F        		LD	BC,01F87H
  DF96                	SDMA:
  DF96  04            		INC	B
  DF97  EDA3          		OUTI
  DF99  3D            		DEC	A
  DF9A  20FA          		JR	NZ,SDMA
  DF9C  C9            		RET
                      	
  DF9D                	SCRDMAD:
  DF9D  C3            		DB	0C3H		;WR6 リセット
  DF9E  9A            		DB	09AH		;WR5 ストップ WAIT READY:HIGH
  DF9F  65            		DB	065H		;WR0 ブロック長(LH)
  DFA0  4F00          		DW	79
  DFA2  1C            		DB	01CH		;WR1 ポートAインクリメント I/O
  DFA3  18            		DB	018H		;WR0 ポートAアドレス(LH)
                      	
  DFA4                	UPSUB:
  DFA4  3AB1F0        		LD	A,(_WIDTH)
  DFA7  5F            		LD	E,A
  DFA8  1600          		LD	D,0
  DFAA  3ECD          		LD	A,0CDH		;WR4 バースト ポートB開始アドレス(LH)
  DFAC  ED79          		OUT	(C),A
  DFAE  ED69          		OUT	(C),L		;SOURCE
  DFB0  ED61          		OUT	(C),H
  DFB2  19            		ADD	HL,DE
  DFB3  3E1D          		LD	A,01DH		;WR0 ポートA開始アドレス(LH) ポートA→ポートB 転送
  DFB5  ED79          		OUT	(C),A
  DFB7  ED69          		OUT	(C),L		;DEST
  DFB9  ED61          		OUT	(C),H
  DFBB                	GO_DMA:
  DFBB  3ECF          		LD	A,0CFH
  DFBD  ED79          		OUT	(C),A		;WR6 ロード
  DFBF  3EB3          		LD	A,0B3H
  DFC1  ED79          		OUT	(C),A		;WR6 強制RDY
  DFC3  ED49          		OUT	(C),C		;WR6 イネーブル
  DFC5  C9            		RET
                      	
  DFC6                	SCRCL:
  DFC6  44            		LD	B,H
  DFC7  4D            		LD	C,L
  DFC8  2AB1F0        		LD	HL,(_WIDTH)
  DFCB  CD30DE        		CALL	LINECL
  DFCE  D1            		POP	DE
  DFCF  C1            		POP	BC
  DFD0  C9            		RET
                      	
  DFD1                	SCRN:
  DFD1  D5            		PUSH	DE
  DFD2  ED58          		IN	E,(C)		;Text
  DFD4  3A1800        		LD	A,(00018H)
  DFD7  3C            		INC	A
  DFD8  281E          		JR	Z,SCRN2
  DFDA  CBD8          		SET	3,B
  DFDC  ED50          		IN	D,(C)		;Kanji
  DFDE  2816          		JR	Z,SCRN1
  DFE0  AF            		XOR	A
  DFE1  C5            		PUSH	BC
  DFE2  013730        		LD	BC,03037H	;VRMJIS
  DFE5  DF            		RST	018H
  DFE6  01522F        		LD	BC,02F52H	;JISSFT
  DFE9  DF            		RST	018H
  DFEA  C1            		POP	BC
  DFEB  ED78          		IN	A,(C)
  DFED  CB98          		RES	3,B
  DFEF  E640          		AND	040H
  DFF1  2005          		JR	NZ,SCRN2
  DFF3  7A            		LD	A,D
  DFF4  D1            		POP	DE
  DFF5  C9            		RET
  DFF6                	SCRN1:
  DFF6  CB98          		RES	3,B
  DFF8                	SCRN2:
  DFF8  7B            		LD	A,E
  DFF9  D1            		POP	DE
  DFFA  C9            		RET
  DFFB                	SCRNE:
  DFFB                	POS:
  DFFB  2A8EF0        		LD	HL,(_TXADR)
  DFFE  C5            		PUSH	BC
  DFFF  ED4BBCF0      		LD	BC,(_WIDTH_MINUS)
  E003  AF            		XOR	A
  E004                	POS1:
  E004  09            		ADD	HL,BC
  E005  3C            		INC	A
  E006  38FC          		JR	C,POS1
  E008  ED42          		SBC	HL,BC
  E00A  3D            		DEC	A
  E00B  67            		LD	H,A
  E00C  C1            		POP	BC
  E00D  A7            		AND	A
  E00E  C9            		RET
                      	
  E00F                	GETL:
  E00F  CDD3F0        		CALL	_POS
  E012  E5            		PUSH	HL
  E013  3ECD          		LD	A,0CDH		;CALL ????
  E015  322DDD        		LD	(INSFLG),A
  E018                	GETL1:
  E018  CDD4DB        		CALL	_SYS08
  E01B  FE09          		CP	9
  E01D  2008          		JR	NZ,GETL1V
  E01F  2120FF        		LD	HL,KBUF
  E022  CD70D8        		CALL	MSX
  E025  18F1          		JR	GETL1
  E027                	GETL1V:
  E027  5F            		LD	E,A
  E028  CDCDF0        		CALL	_PRINT
                      	
  E02B  7B            		LD	A,E
  E02C  FE0D          		CP	00DH
  E02E  20E8          		JR	NZ,GETL1
  E030  3E01          		LD	A,1		;LD BC,????
  E032  322DDD        		LD	(INSFLG),A
  E035  1120FF        		LD	DE,KBUF
  E038  3AB1F0        		LD	A,(_WIDTH)
  E03B  47            		LD	B,A
  E03C  CDD3D5        		CALL	ZERO_MEMORY_DE
                      	
  E03F  D1            		POP	DE
  E040  CDD3F0        		CALL	_POS
  E043  6B            		LD	L,E
  E044  3AB1F0        		LD	A,(_WIDTH)
  E047  95            		SUB	L
  E048  57            		LD	D,A
  E049  CD72DE        		CALL	LOC1
  E04C  4D            		LD	C,L
  E04D  7C            		LD	A,H
  E04E  F630          		OR	030H
  E050  47            		LD	B,A
  E051  5A            		LD	E,D
  E052  2120FF        		LD	HL,KBUF
  E055                	GETL2:
  E055  CDD0F0        		CALL	_SCRN
  E058  03            		INC	BC
  E059  77            		LD	(HL),A
  E05A  23            		INC	HL
  E05B  1D            		DEC	E
  E05C  20F7          		JR	NZ,GETL2
  E05E                	GETL3:
  E05E  2B            		DEC	HL
  E05F  7E            		LD	A,(HL)
  E060  FE21          		CP	021H
  E062  D0            		RET	NC
  E063  3600          		LD	(HL),0
  E065  15            		DEC	D
  E066  20F6          		JR	NZ,GETL3
  E068  C9            		RET
                      	
  E069                	INKEY:
  E069  FB            		EI
  E06A  E5            		PUSH	HL
  E06B  2A90F0        		LD	HL,(_KEYPS)
  E06E  7C            		LD	A,H
  E06F  AD            		XOR	L
  E070  280B          		JR	Z,INKEY1
  E072  7C            		LD	A,H
  E073  3C            		INC	A
  E074  E61F          		AND	01FH
  E076  3291F0        		LD	(_KEYPS+1),A
  E079  6F            		LD	L,A
  E07A  26FF          		LD	H,KEYBF/256
  E07C  7E            		LD	A,(HL)
  E07D                	INKEY1:
  E07D  E1            		POP	HL
  E07E  B7            		OR	A
  E07F  C9            		RET
                      	
  0F4B                	AT_RS	EQU	SCR1-AT_SCR1
                      	
                      	;LDFILE.ASM
                      	
                      	;	LSX-Dodgers FILE
                      	
  E080                	FILEC:
  E080  CD8BE0        		CALL	FILE
  E083                	FILEC2:
  E083  3A15F0        		LD	A,(FDRV+1)
  E086  FE20          		CP	020H
  E088  C8            		RET	Z
  E089  1839          		JR	SETDIR1
                      	
  E08B                	FILE:
  E08B  AF            		XOR	A
  E08C  3214F0        		LD	(FDRV),A
  E08F  67            		LD	H,A
  E090  6F            		LD	L,A
  E091  2222F0        		LD	(FDRV+14),HL
  E094  CD62E1        		CALL	SPCUT
  E097  CD47E1        		CALL	CCHK3
  E09A  2812          		JR	Z,DEVI1
  E09C  13            		INC	DE
  E09D  1A            		LD	A,(DE)
  E09E  1B            		DEC	DE
  E09F  FE3A          		CP	':'
  E0A1  200B          		JR	NZ,DEVI1
  E0A3  1A            		LD	A,(DE)		;DRIVE
  E0A4  CD97E3        		CALL	CAP
  E0A7  D640          		SUB	'@'
  E0A9  13            		INC	DE
  E0AA  13            		INC	DE
  E0AB  3214F0        		LD	(FDRV),A
  E0AE                	DEVI1:
  E0AE  1A            		LD	A,(DE)
  E0AF  D65C          		SUB	05CH		;\
  E0B1  2009          		JR	NZ,NOROOT
  E0B3  6F            		LD	L,A		;A=0でH=0のはずなのでHL=0
  E0B4  222EF0        		LD	(FDRV+26),HL
  E0B7  2C            		INC	L
  E0B8  2222F0        		LD	(FDRV+14),HL
  E0BB  13            		INC	DE
  E0BC                	NOROOT:
                      	
  E0BC                	SETDIR:
  E0BC  CDE8E0        		CALL	FILED
  E0BF  1A            		LD	A,(DE)
  E0C0  FE5C          		CP	05CH		;\
  E0C2  C0            		RET	NZ
  E0C3  13            		INC	DE
  E0C4                	SETDIR1:
  E0C4  3E10          		LD	A,010H		;Directory
  E0C6  3221F0        		LD	(FDRV+13),A
  E0C9  D5            		PUSH	DE
  E0CA  1114F0        		LD	DE,FDRV
  E0CD  2A1EF1        		LD	HL,(STABLE+2*00FH)
  E0D0  CD0F00        		CALL	JP_HL
  E0D3  D1            		POP	DE
  E0D4  B7            		OR	A
  E0D5  C0            		RET	NZ
                      	
  E0D6  3A21F0        		LD	A,(FDRV+13)
  E0D9  CB67          		BIT	4,A
  E0DB  C8            		RET	Z
                      	
  E0DC  CD2FE1        		CALL	FILEI
  E0DF  2A2EF0        		LD	HL,(FDRV+26)
  E0E2  23            		INC	HL
  E0E3  2222F0        		LD	(FDRV+14),HL
  E0E6  18D4          		JR	SETDIR
                      	
  E0E8                	FILED:
  E0E8  CD2FE1        		CALL	FILEI
  E0EB  2115F0        		LD	HL,FNAME
                      	
  E0EE  0608          		LD	B,8
  E0F0                	FILE2:
  E0F0  CD3CE1        		CALL	CCHKF
  E0F3  C8            		RET	Z
  E0F4  FE2A          		CP	'*'
  E0F6  282E          		JR	Z,FILE9
  E0F8  FE2E          		CP	'.'
  E0FA  280C          		JR	Z,FILE4
  E0FC  77            		LD	(HL),A
  E0FD  23            		INC	HL
  E0FE  10F0          		DJNZ	FILE2
                      	
  E100                	FILE3:
  E100  CD3CE1        		CALL	CCHKF
  E103  C8            		RET	Z
  E104  FE2E          		CP	'.'
  E106  20F8          		JR	NZ,FILE3
                      	
  E108                	FILE4:
  E108  211DF0        		LD	HL,FNAME+8
  E10B  0603          		LD	B,3
                      	
  E10D                	FILE4L:
  E10D  CD3CE1        		CALL	CCHKF
  E110  C8            		RET	Z
  E111  FE2E          		CP	'.'
  E113  2008          		JR	NZ,FILE12
  E115  3215F0        		LD	(FNAME),A	;Parent directory(..)
  E118  3216F0        		LD	(FNAME+1),A
  E11B  3E20          		LD	A,020H
  E11D                	FILE12:
  E11D  FE2A          		CP	'*'
  E11F  280A          		JR	Z,FILE10
  E121  77            		LD	(HL),A
  E122  23            		INC	HL
  E123  10E8          		DJNZ	FILE4L
  E125  C9            		RET
                      	
  E126                	FILE9:				;名前の*処理、名前の残りを?で埋める
  E126  CD2BE1        		CALL	FILE10
  E129  18D5          		JR	FILE3
                      	
  E12B                	FILE10:
  E12B  3E3F          		LD	A,'?'
  E12D  1808          		JR	FILL_MEMORY
  E12F                	FILEI:				;名前＋拡張子をスペースで初期化
  E12F  3E20          		LD	A,020H
  E131  01000B        		LD	BC,11*256	;C=0にしておく
  E134  2115F0        		LD	HL,FNAME
  E137                	FILL_MEMORY:			;HLからBバイトAで埋める
  E137  77            		LD	(HL),A
  E138  23            		INC	HL
  E139  10FC          		DJNZ	FILL_MEMORY
  E13B  C9            		RET
                      	
  E13C                	CCHKF:
  E13C  1A            		LD	A,(DE)
  E13D  CD44E1        		CALL	CCHK2
  E140  C8            		RET	Z
  E141  C3AFE4        		JP	FKAN
                      	
  E144                	CCHK2:
  E144  0C            		INC	C
  E145  0D            		DEC	C
  E146  C0            		RET	NZ
  E147                	CCHK3:				;ZF=1 で使えない文字
  E147  FE2B          		CP	'+'
  E149  C8            		RET	Z
  E14A  FE2C          		CP	','
  E14C  C8            		RET	Z
  E14D  FE2F          		CP	'/'
  E14F  C8            		RET	Z
  E150  FE3A          		CP	':'
  E152  C8            		RET	Z
  E153  FE3B          		CP	';'
  E155  C8            		RET	Z
  E156  FE3D          		CP	'='
  E158  C8            		RET	Z
  E159  FE5C          		CP	05CH	;\
  E15B  C8            		RET	Z
  E15C  FE20          		CP	020H
  E15E  D0            		RET	NC
  E15F  BF            		CP	A		;Z=1
  E160  C9            		RET
                      	
  E161                	SS1:
  E161  13            		INC	DE
  E162                	SPCUT:				;スペースをカット
  E162  1A            		LD	A,(DE)
  E163  FE20          		CP	020H
  E165  28FA          		JR	Z,SS1
  E167  C9            		RET
                      	
  E168                	SETDRVF:
  E168  1114F0        		LD	DE,FDRV
  E16B                	SETDRV0:
  E16B  CD74E1        		CALL	SETDRV
  E16E  FDE1          		POP	IY
  E170  C1            		POP	BC
  E171  D1            		POP	DE
  E172  E1            		POP	HL
  E173  C9            		RET
                      	
  E174                	SETDRV:
  E174  E3            		EX	(SP),HL		;HL=RETRN ADDRESS
  E175  D5            		PUSH	DE		;PUSH HL/DE/BC/IY
  E176  C5            		PUSH	BC
  E177  1A            		LD	A,(DE)
  E178  D5            		PUSH	DE
  E179  FDE3          		EX	(SP),IY
                      	
  E17B  CD87E1        		CALL	GETDRV
  E17E  3C            		INC	A
  E17F  FD7700        		LD	(IY+0),A	;(FCB)ドライブ番号
  E182  3D            		DEC	A
  E183  CDD9F0        		CALL	_CHGDRV
                      	
  E186  E9            		JP	(HL)
                      	
  E187                	GETDRV:
  E187  E67F          		AND	07FH
  E189  D601          		SUB	001H
  E18B  3003          		JR	NC,GETDRV1
  E18D  3A87F0        		LD	A,(_DVSW)	;Current Drive
  E190                	GETDRV1:
  E190  3288F0        		LD	(_DRV),A
  E193  C9            		RET
                      	
  E194                	SOPENX:
  E194  1139F0        		LD	DE,SFILE
  E197  1A            		LD	A,(DE)
  E198  FDBE00        		CP	(IY+0)		;(FCB)ドライブ番号
  E19B  2024          		JR	NZ,SOPEN
  E19D  13            		INC	DE
  E19E  FDE5          		PUSH	IY
  E1A0  E1            		POP	HL
  E1A1  23            		INC	HL
  E1A2  CD2FE3        		CALL	CPFILE
  E1A5  201A          		JR	NZ,SOPEN
                      	
  E1A7  2AF4F1        		LD	HL,(SCDIR)
  E1AA  FD750E        		LD	(IY+14),L	;(FCB)アクセスするディレクトリのクラスタ番号+1
  E1AD  FD740F        		LD	(IY+15),H
                      	
  E1B0  2AF8F1        		LD	HL,(SFNDF)	;Direcroty location and Flags
  E1B3  229FF0        		LD	(_FILEN),HL
                      	
  E1B6  ED5BF6F1      		LD	DE,(SFBPS)
  E1BA  2139F0        		LD	HL,SFILE
  E1BD  36FF          		LD	(HL),0FFH
  E1BF  23            		INC	HL
  E1C0  C9            		RET
  E1C1                	SOPEN:
  E1C1  21D7E2        		LD	HL,FILESE
  E1C4                	SOPENC:
  E1C4  22FDE1        		LD	(OPENPAT+1),HL
                      	
  E1C7  CDE2F0        		CALL	_RDFATX		;Detect Media
  E1CA  3856          		JR	C,RDDERR
                      	
  E1CC  AF            		XOR	A
  E1CD  329FF0        		LD	(_FILEN),A
  E1D0  CDDCE3        		CALL	LDDIRX1		;A=0で呼び出す
  E1D3  2818          		JR	Z,SDIRX1
                      	
  E1D5  CDC8E2        		CALL	READ_DIR	;Sub Directory
  E1D8  3808          		JR	C,SDIRX0
  E1DA  2A7EF1        		LD	HL,(_DTBUF)
  E1DD  7E            		LD	A,(HL)
  E1DE  FE2E          		CP	'.'
  E1E0  280F          		JR	Z,SOPEN1
  E1E2                	SDIRX0:
  E1E2  AF            		XOR	A
  E1E3  32A0F0        		LD	(_DIRF),A
  E1E6  FD360E01      		LD	(IY+14),1	;(FCB)レコードサイズ
  E1EA  FD770F        		LD	(IY+15),A
  E1ED                	SDIRX1:
  E1ED  ED5BFCF1      		LD	DE,(_DIRPS)	;Root Directory
  E1F1                	SOPEN1:
  E1F1  0E20          	SDECPAT:LD	C,32		;自己書き換え 1セクタ辺りのディレクトリエントリ数  1024=32 / 512=16 / 256=8
  E1F3                	SOPEN1X:
  E1F3  CDC8E2        		CALL	READ_DIR	;FILE SEARCH
  E1F6  382A          		JR	C,RDDERR
  E1F8  2A7EF1        		LD	HL,(_DTBUF)
  E1FB                	SOPEN2:
  E1FB  D5            		PUSH	DE
  E1FC  CDD7E2        	OPENPAT:CALL	FILESE		;(self-modifying code)
  E1FF  D1            		POP	DE
  E200  386E          		JR	C,SOPENE
  E202  281B          		JR	Z,SCF_FF_RET
  E204                	SOPEN3:
  E204  3AA0F0        		LD	A,(_DIRF)	;ディレクトリか判別
  E207  B7            		OR	A
  E208  200C          		JR	NZ,SOPEN5
  E20A  13            		INC	DE		;ルートディレクトリ
  E20B  E5            		PUSH	HL
  E20C  210C00        	MD_PAT:	LD	HL,12		;(self-modifying code)MAXDIR
  E20F  ED52          		SBC	HL,DE		;CF=0 なので SUB HL,DE
  E211  E1            		POP	HL
  E212  20DD          		JR	NZ,SOPEN1
  E214  1807          		JR	SOPEN6
  E216                	SOPEN5:
  E216  CD0BEB        		CALL	GNCLX		;END DIR
  E219  D8            		RET	C
  E21A  CD8FE3        		CALL	ENDCL
  E21D                	SOPEN6:
  E21D  38D2          		JR	C,SOPEN1
  E21F                	SCF_FF_RET:
  E21F  37            		SCF			;CF=1
  E220  9F            		SBC	A,A		;A=0FFH
  E221  C9            		RET
                      	
  E222                	RDDERR:
  E222  BF            		CP	A		;READ ERR CF=1 ZF=1
  E223  37            		SCF
  E224  C9            		RET
                      	
  E225                	NOPEN:
  E225  21D7E2        		LD	HL,FILESE
  E228  22FDE1        		LD	(OPENPAT+1),HL
  E22B  FD2A98F0      		LD	IY,(_FCB)
  E22F  CDC2E4        		CALL	CHKWILDX
  E232  30EB          		JR	NC,SCF_FF_RET
  E234  FD7E00        		LD	A,(IY+0)	;(FCB)ドライブ番号
  E237  3D            		DEC	A
  E238  3288F0        		LD	(_DRV),A
  E23B  CDD9F0        		CALL	_CHGDRV
  E23E  D8            		RET	C
  E23F  2AF8F1        		LD	HL,(SFNDF)	;Direcroty location and Flags
  E242  229FF0        		LD	(_FILEN),HL
                      	
  E245  CDD7E3        		CALL	LDDIRX
  E248  ED5B9AF0      		LD	DE,(_FBPS)
  E24C  CDC8E2        		CALL	READ_DIR
  E24F  38D1          		JR	C,RDDERR
  E251  3A9EF0        		LD	A,(_FBCNT)
  E254  3D            		DEC	A
  E255  28AD          		JR	Z,SOPEN3
  E257                	NOPEN2:
  E257  2A9CF0        		LD	HL,(_FBAD)
  E25A  012000        		LD	BC,020H
  E25D  09            		ADD	HL,BC
  E25E  4F            		LD	C,A
  E25F  189A          		JR	SOPEN2
                      	
  E261                	SOPENE2:
  E261  229CF0        		LD	(_FBAD),HL
  E264  79            		LD	A,C
  E265  329EF0        		LD	(_FBCNT),A
  E268  ED539AF0      		LD	(_FBPS),DE
  E26C  FD2298F0      		LD	(_FCB),IY
  E270                	SOPENE:
  E270  AF            		XOR	A
  E271  C9            		RET
                      	
  E272                	COPEN:
  E272  FD360D20      		LD	(IY+13),020H	;(FCB)属性(アトリビュート)
                      	
  E276  21F4E2        		LD	HL,NEXTSE
  E279  CDC4E1        		CALL	SOPENC
  E27C  D0            		RET	NC
  E27D  C8            		RET	Z
  E27E  3AA0F0        		LD	A,(_DIRF)	;ディレクトリか判別
  E281  B7            		OR	A
  E282  37            		SCF
  E283  C8            		RET	Z		;ルートディレクトリ
  E284  0601          		LD	B,1
  E286  CD20E5        		CALL	WRDF
  E289  D8            		RET	C
  E28A  ED5BFEF1      		LD	DE,(_CLPS)
  E28E  D5            		PUSH	DE
  E28F  CD58E3        		CALL	DCPAT
  E292  CD96E9        		CALL	DRDNX
  E295  2A7EF1        		LD	HL,(_DTBUF)	;ディレクトリエントリを0クリア
  E298  3A94E8        		LD	A,(SECSZ+2)	;1024=4 / 512=2 / 256=1
  E29B  47            		LD	B,A
  E29C  AF            		XOR	A
  E29D  4F            		LD	C,A
  E29E                	COPENCL:
  E29E  77            		LD	(HL),A
  E29F  EDA1          		CPI			;HL=HL+1 BC=BC-1 BCが0の場合にP/V=0
  E2A1  EA9EE2        		JP	PE,COPENCL
                      	
  E2A4  3A76E3        		LD	A,(SPCPAT+1)	;1クラスタの論理セクタ数
  E2A7  3D            		DEC	A
  E2A8  2819          		JR	Z,COPENE
  E2AA  3E01          		LD	A,1		;1セクタ辺りのセクタ数が2以上の場合
  E2AC  3203EB        		LD	(_SECPS+1),A
  E2AF  D1            		POP	DE		;DE=(_CLPS)
  E2B0  D5            		PUSH	DE
  E2B1                	COPEN1:
  E2B1  D5            		PUSH	DE		;データバッファに入らないセクタもゼロクリア
  E2B2  C5            		PUSH	BC
  E2B3  2A7EF1        		LD	HL,(_DTBUF)
  E2B6  CD72E3        		CALL	CLUSTX
  E2B9  CD9BEC        		CALL	DWT24
  E2BC  C1            		POP	BC
  E2BD  D1            		POP	DE
  E2BE  CD02EB        		CALL	NEXTX
  E2C1  20EE          		JR	NZ,COPEN1
  E2C3                	COPENE:
  E2C3  2A7EF1        		LD	HL,(_DTBUF)
  E2C6  D1            		POP	DE
  E2C7  C9            		RET
                      	
  E2C8                	READ_DIR:
  E2C8  ED53FEF1      		LD	(_CLPS),DE
  E2CC  C5            		PUSH	BC
  E2CD  D5            		PUSH	DE
  E2CE  CD58E3        		CALL	DCPAT
  E2D1  CD76E9        		CALL	DRDX
  E2D4  D1            		POP	DE
  E2D5  C1            		POP	BC
  E2D6  C9            		RET
                      	
  E2D7                	FILESE:
  E2D7  7E            		LD	A,(HL)
  E2D8  B7            		OR	A
  E2D9  C8            		RET	Z		;END:ZF=1 CF=0
  E2DA  FEE5          		CP	0E5H
  E2DC  280E          		JR	Z,FILESE1
  E2DE  FDE5          		PUSH	IY
  E2E0  D1            		POP	DE
  E2E1  13            		INC	DE
  E2E2  E5            		PUSH	HL
  E2E3  CD2FE3        		CALL	CPFILE
  E2E6  CC50E3        		CALL	Z,CPFILE2
  E2E9  E1            		POP	HL
  E2EA  37            		SCF
  E2EB  C8            		RET	Z		;!!!:(ZF=1) CF=1
  E2EC                	FILESE1:
  E2EC  CD03E3        		CALL	FNEXT
  E2EF  20E6          		JR	NZ,FILESE
  E2F1                	ZF0_CF0_AFF_RET:
  E2F1  F6FF          		OR	0FFH		;ZF=0 CF=0
  E2F3  C9            		RET
                      	
  E2F4                	NEXTSE:
  E2F4  7E            		LD	A,(HL)
  E2F5  B7            		OR	A
  E2F6  37            		SCF
  E2F7  C8            		RET	Z		;!!!:ZF=1 CF=1
  E2F8  FEE5          		CP	0E5H
  E2FA  37            		SCF
  E2FB  C8            		RET	Z		;!!!:(ZF=1) CF=1
  E2FC  CD03E3        		CALL	FNEXT
  E2FF  20F3          		JR	NZ,NEXTSE
  E301  18EE          		JR	ZF0_CF0_AFF_RET
                      	
  E303                	FNEXT:
  E303  E5            		PUSH	HL
  E304  219FF0        		LD	HL,_FILEN
  E307  34            		INC	(HL)
  E308  E1            		POP	HL
  E309  112000        		LD	DE,020H
  E30C  19            		ADD	HL,DE
  E30D  0D            		DEC	C
  E30E  C9            		RET
                      	
  E30F                	CPNAME:
  E30F  C5            		PUSH	BC
  E310  D5            		PUSH	DE
  E311  E5            		PUSH	HL
  E312  CD29E3        		CALL	CPFILE4
  E315  E1            		POP	HL
  E316  23            		INC	HL
  E317  23            		INC	HL
  E318  23            		INC	HL
  E319  23            		INC	HL
  E31A  D1            		POP	DE
  E31B  C1            		POP	BC
  E31C  2005          		JR	NZ,CPNAME1
  E31E  7E            		LD	A,(HL)
  E31F  23            		INC	HL
  E320  66            		LD	H,(HL)
  E321  6F            		LD	L,A
  E322  C9            		RET
  E323                	CPNAME1:
  E323  23            		INC	HL
  E324  23            		INC	HL
  E325  10E8          		DJNZ	CPNAME
  E327  37            		SCF
  E328  C9            		RET
                      	
  E329                	CPFILE4:
  E329  C5            		PUSH	BC
  E32A  010004        		LD	BC,00400H
  E32D  1804          		JR	CPSTR1
  E32F                	CPFILE:
  E32F  C5            		PUSH	BC
  E330  01000B        		LD	BC,00B00H
  E333                	CPSTR1:
  E333  1A            		LD	A,(DE)
  E334  FE3F          		CP	'?'		;Wild card
  E336  2812          		JR	Z,CPSTR2
  E338  7E            		LD	A,(HL)
  E339  CDA8E4        		CALL	FKANC
  E33C  E5            		PUSH	HL
  E33D  67            		LD	H,A
  E33E  1A            		LD	A,(DE)
  E33F  CB01          		RLC	C
  E341  CDA8E4        		CALL	FKANC
  E344  CB09          		RRC	C
  E346  BC            		CP	H		;CP (HL),(DE)
  E347  E1            		POP	HL
  E348  2004          		JR	NZ,CPSTR3
  E34A                	CPSTR2:
  E34A  13            		INC	DE
  E34B  23            		INC	HL
  E34C  10E5          		DJNZ	CPSTR1
  E34E                	CPSTR3:
  E34E  C1            		POP	BC
  E34F  C9            		RET
                      	
  E350                	CPFILE2:
  E350  FD7E0D        		LD	A,(IY+13)	;(FCB)属性(アトリビュート)
  E353  F6E1          		OR	0E1H
  E355  2F            		CPL
  E356  A6            		AND	(HL)
  E357  C9            		RET
                      	
  E358                	DCPAT:
  E358  0E00          		LD	C,0
  E35A  2A7EF1        		LD	HL,(_DTBUF)
  E35D  3AA0F0        		LD	A,(_DIRF)	;ディレクトリか判別
  E360  B7            		OR	A
  E361  C8            		RET	Z		;ルートディレクトリの場合はCレジスタを0にしておく(CDEがセクタ番号)
  E362  3A76E3        		LD	A,(SPCPAT+1)
  E365  4F            		LD	C,A
  E366  3A03EB        		LD	A,(_SECPS+1)
  E369  B9            		CP	C
  E36A  3801          		JR	C,DC1
  E36C  AF            		XOR	A
  E36D                	DC1:
  E36D  F680          		OR	080H
  E36F  32A0F0        		LD	(_DIRF),A	;bit0-6:セクタインデックス
  E372                	CLUSTX:
  E372  E5            		PUSH	HL
  E373  EB            		EX	DE,HL
  E374  AF            		XOR	A
  E375  0E01          	SPCPAT:	LD	C,1		;自己書き換え（1クラスタの論理セクタ数）
  E377                	L_CLDBL:
  E377  CB19          		RR	C		;->CF
  E379  3804          		JR	C,E_CLDBL
  E37B  29            		ADD	HL,HL		;*2
  E37C  8F            		ADC	A,A
  E37D  18F8          		JR	L_CLDBL
  E37F                	E_CLDBL:
  E37F  4F            		LD	C,A
  E380  3A03EB        		LD	A,(_SECPS+1)
  E383  B5            		OR	L
  E384  6F            		LD	L,A
  E385  110800        	CLSPAT:	LD	DE,8	;+8 (2D)  !ADDCL (self-modifying code)
  E388  AF            		XOR	A
  E389  19            		ADD	HL,DE	;データ格納領域の先頭論理セクタ番号
  E38A  89            		ADC	A,C
  E38B  4F            		LD	C,A
  E38C  EB            		EX	DE,HL
  E38D  E1            		POP	HL
  E38E  C9            		RET
                      	
  E38F                	ENDCL:
  E38F  7A            		LD	A,D	;END CLUSTER
  E390  FE01          	CLPAT1:	CP	1	;164=356	(self-modifying code)
  E392  C0            		RET	NZ
  E393  7B            		LD	A,E
  E394  FE64          	CLPAT2:	CP	064H	;		(self-modifying code)
  E396  C9            		RET
                      	
  E397                	CAP:
  E397  FE61          		CP	'a'
  E399  D8            		RET	C
  E39A  FE7B          		CP	'z'+1
  E39C  D0            		RET	NC
  E39D  D620          		SUB	020H
  E39F  C9            		RET
  E3A0                	CAP2:
  E3A0  CD97E3        		CALL	CAP
  E3A3                	CAP3:
  E3A3  CDACE3        		CALL	CAP4
  E3A6  FE21          		CP	021H
  E3A8  D0            		RET	NC
  E3A9  3EA0          		LD	A,0A0H
  E3AB  C9            		RET
  E3AC                	CAP4:
  E3AC  FE05          		CP	5
  E3AE  C0            		RET	NZ
  E3AF  3EE5          		LD	A,0E5H
  E3B1  C9            		RET
                      	
  E3B2                	CHDIR:
  E3B2  CDC9ED        		CALL	GETDPBD
  E3B5  381D          		JR	C,CHDIR2
  E3B7  DD751A        		LD	(IX+01AH),L		;_SDIR_
  E3BA  DD741B        		LD	(IX+01BH),H		;_SDIR_+1
  E3BD  1815          		JR	CHDIR2		;POP_IX_RET
                      	
  E3BF                	LDDIR:
  E3BF  CDC9ED        		CALL	GETDPBD
  E3C2  DD5E1A        		LD	E,(IX+01AH)		;_SDIR_
  E3C5  DD561B        		LD	D,(IX+01BH)		;_SDIR_+1
  E3C8  13            		INC	DE
  E3C9  FD730E        		LD	(IY+14),E	;(FCB)アクセスするディレクトリのクラスタ番号+1
  E3CC  FD720F        		LD	(IY+15),D
  E3CF  1B            		DEC	DE
  E3D0  AF            		XOR	A
  E3D1  32A0F0        		LD	(_DIRF),A
  E3D4                	CHDIR2:
  E3D4  DDE1          		POP	IX
  E3D6  C9            		RET
                      	
  E3D7                	LDDIRX:
  E3D7  3AA0F0        		LD	A,(_DIRF)	;(FCB)アクセスするディレクトリのセクタインデックス
  E3DA  E67F          		AND	07FH
  E3DC                	LDDIRX1:
  E3DC  3203EB        		LD	(_SECPS+1),A
  E3DF  FD5E0E        		LD	E,(IY+14)	;(FCB)アクセスするディレクトリのクラスタ番号+1
  E3E2  FD560F        		LD	D,(IY+15)
  E3E5  1B            		DEC	DE
  E3E6  CD8FE3        		CALL	ENDCL
  E3E9  D4BFE3        		CALL	NC,LDDIR
  E3EC                	LDDIRS:
  E3EC  7A            		LD	A,D
  E3ED  B3            		OR	E
  E3EE  32A0F0        		LD	(_DIRF),A	;ディレクトリか判別
  E3F1  C9            		RET
                      	
  E3F2                	KILL:
  E3F2  CDC2E4        		CALL	CHKWILDX
  E3F5  3834          		JR	C,KILLW
  E3F7  CD94E1        		CALL	SOPENX
  E3FA                	KILLS:
  E3FA  3E1F          		LD	A,01FH
  E3FC  D43EE4        		CALL	NC,CHKATT
  E3FF  D8            		RET	C
  E400                	KILLSX:
  E400  36E5          		LD	(HL),0E5H	;DIR
  E402  CD9CE4        		CALL	WTDB
  E405  111A00        		LD	DE,01AH
  E408  19            		ADD	HL,DE
  E409  5E            		LD	E,(HL)
  E40A  23            		INC	HL
  E40B  56            		LD	D,(HL)
  E40C                	KILLS1:
  E40C  CD8FE3        		CALL	ENDCL
  E40F  D0            		RET	NC		;CF=0
  E410  21FEFF        		LD	HL,0-2
  E413  19            		ADD	HL,DE
  E414  D0            		RET	NC		;DE= 0 or 1
  E415  D5            		PUSH	DE
  E416  CDF7F0        		CALL	_GNCL
  E419  ED53FEF1      		LD	(_CLPS),DE
  E41D  D1            		POP	DE
  E41E  210000        		LD	HL,0
  E421  D4FAF0        		CALL	NC,_SNCL
  E424  D8            		RET	C
  E425  ED5BFEF1      		LD	DE,(_CLPS)	;FAT
  E429  18E1          		JR	KILLS1
                      	
  E42B                	KILLW:
  E42B  CDC1E1        		CALL	SOPEN
  E42E                	KILLW1:
  E42E  380B          		JR	C,KILLW2
  E430  CD61E2        		CALL	SOPENE2
  E433  CDFAE3        		CALL	KILLS
  E436  CD25E2        		CALL	NOPEN
  E439  18F3          		JR	KILLW1
  E43B                	KILLW2:
  E43B  C8            		RET	Z
  E43C  3F            		CCF
  E43D  C9            		RET
                      	
  E43E                	CHKATT:
  E43E  E5            		PUSH	HL
  E43F  110B00        		LD	DE,00BH
  E442  19            		ADD	HL,DE
  E443  A6            		AND	(HL)
  E444  E1            		POP	HL
  E445  C8            		RET	Z
  E446  37            		SCF
  E447  C9            		RET
                      	
  E448                	NAME:
  E448  CDC2E4        		CALL	CHKWILDX
  E44B  D8            		RET	C
  E44C  110400        		LD	DE,4
  E44F  19            		ADD	HL,DE
  E450  2268E4        		LD	(NAMEP+2),HL
  E453  23            		INC	HL
  E454  CDC6E4        		CALL	CHKWILD
  E457  D8            		RET	C
                      	
  E458  CD94E1        		CALL	SOPENX
  E45B  3E0F          		LD	A,00FH
  E45D  D43EE4        		CALL	NC,CHKATT
  E460  D8            		RET	C
                      	
  E461  FD7E00        		LD	A,(IY+0)
  E464  FDE5          		PUSH	IY
  E466  FD210000      	NAMEP:	LD	IY,0		;自己書き換え
  E46A  FD7700        		LD	(IY+0),A
  E46D  CD94E1        		CALL	SOPENX
  E470  FDE3          		EX	(SP),IY
  E472  3F            		CCF
  E473  D4C1E1        		CALL	NC,SOPEN
  E476  EB            		EX	DE,HL
  E477  E1            		POP	HL
  E478  D8            		RET	C
                      	
  E479                	SETNAME:
  E479  01000B        		LD	BC,11*256
  E47C  23            		INC	HL
  E47D  7E            		LD	A,(HL)
  E47E  FEE5          		CP	0E5H
  E480  2004          		JR	NZ,SNAME1
  E482  3E05          		LD	A,5
  E484  180E          		JR	SNAME3
  E486                	SNAME1:
  E486  7E            		LD	A,(HL)
  E487  0C            		INC	C
  E488  0D            		DEC	C
  E489  2009          		JR	NZ,SNAME3
  E48B  CD97E3        		CALL	CAP
  E48E  FEA0          		CP	0A0H
  E490  2002          		JR	NZ,SNAME3
  E492  3E20          		LD	A,020H
  E494                	SNAME3:
  E494  12            		LD	(DE),A
  E495  7E            		LD	A,(HL)
  E496  23            		INC	HL
  E497  CDAFE4        		CALL	FKAN
  E49A  10EA          		DJNZ	SNAME1
  E49C                	WTDB:
  E49C  3EFF          		LD	A,0FFH
  E49E  3239F0        		LD	(SFILE),A
  E4A1                	SWTDBF:
  E4A1  3E01          		LD	A,1
  E4A3  32A4F0        		LD	(_WTDBF),A
  E4A6  AF            		XOR	A
  E4A7  C9            		RET
                      	
  E4A8                	FKANC:
  E4A8  CB41          		BIT	0,C
  E4AA  CCA0E3        		CALL	Z,CAP2
  E4AD  1801          		JR	FKANX
  E4AF                	FKAN:			;漢字チェック
  E4AF  13            		INC	DE
  E4B0                	FKANX:
  E4B0  CB41          		BIT	0,C
  E4B2  CB81          		RES	0,C
  E4B4  C0            		RET	NZ
  E4B5  FE80          		CP	080H
  E4B7  D8            		RET	C
  E4B8  FEA0          		CP	0A0H
  E4BA  3803          		JR	C,FKAN1
  E4BC  FEE0          		CP	0E0H
  E4BE  D8            		RET	C
  E4BF                	FKAN1:
  E4BF  0C            		INC	C
  E4C0  A7            		AND	A
  E4C1  C9            		RET
                      	
  E4C2                	CHKWILDX:
  E4C2  FDE5          		PUSH	IY
  E4C4  E1            		POP	HL
  E4C5  23            		INC	HL
  E4C6                	CHKWILD:
  E4C6  060B          		LD	B,11
  E4C8  3E3F          		LD	A,'?'
  E4CA                	CHKWIL1:
  E4CA  BE            		CP	(HL)
  E4CB  23            		INC	HL
  E4CC  37            		SCF
  E4CD  C8            		RET	Z
  E4CE  10FA          		DJNZ	CHKWIL1
  E4D0  AF            		XOR	A
  E4D1  C9            		RET
                      	
  E4D2                	SDIRENT:		;IY=FCB HL=DIR
  E4D2  D5            		PUSH	DE
  E4D3  E5            		PUSH	HL
  E4D4  FDE5          		PUSH	IY
  E4D6  D1            		POP	DE
  E4D7  EB            		EX	DE,HL
  E4D8  CD79E4        		CALL	SETNAME
                      	;				Attribute
  E4DB  FD7E0D        		LD	A,(IY+13)	;(FCB)属性(アトリビュート)
  E4DE  12            		LD	(DE),A
  E4DF  13            		INC	DE
                      	;				Reserved
  E4E0  AF            		XOR	A
  E4E1  060A          		LD	B,10
  E4E3                	SDE1:
  E4E3  12            		LD	(DE),A
  E4E4  13            		INC	DE
  E4E5  10FC          		DJNZ	SDE1
                      						;(FCB)更新時刻
  E4E7  21EAF1        		LD	HL,SDDATA		;(FCB)更新年月日
  E4EA  060A          		LD	B,SDDATAE-SDDATA	;(FCB)ファイルの先頭クラスタ
  E4EC                	SDLOOP:					;(FCB)ファイルのサイズ(バイト単位)
  E4EC  7E            		LD	A,(HL)
  E4ED  23            		INC	HL
  E4EE  32F3E4        		LD	(SDPAT+2),A
  E4F1  FD7E00        	SDPAT:	LD	A,(IY+0)	;LD A,(IY+A)
  E4F4  12            		LD	(DE),A
  E4F5  13            		INC	DE
  E4F6  10F4          		DJNZ	SDLOOP
                      	
  E4F8  AF            		XOR	A
  E4F9  E1            		POP	HL
  E4FA  D1            		POP	DE
  E4FB  C9            		RET
                      	
  E4FC                	WOPEN:
  E4FC  FD7E0D        		LD	A,(IY+13)	;(FCB)属性(アトリビュート)
  E4FF  E61F          		AND	01FH
  E501  37            		SCF
  E502  C0            		RET	NZ
  E503  FD361CFE      		LD	(IY+28),0FEH	;(FCB)オープンモード
  E507                	TOPEN2:
  E507  AF            		XOR	A
  E508                	TOPEN:				;Initializes the time stamp
  E508  FD3617FF      		LD	(IY+23),0FFH	;(FCB)更新時刻
  E50C  C9            		RET
                      	
  E50D                	WRDFX:
  E50D  3A76E3        		LD	A,(SPCPAT+1)	;1クラスタの論理セクタ
  E510                	L_WRFX:
  E510  1F            		RRA			;->CF
  E511  3806          		JR	C,E_WRFX
  E513  CB39          		SRL	C
  E515  CB1C          		RR	H		;CH=CH/2
  E517  18F7          		JR	L_WRFX
  E519                	E_WRFX:
  E519  44            		LD	B,H
  E51A  04            		INC	B
  E51B  3E37          		LD	A,037H		;SCF
  E51D  3293E9        		LD	(DRDN1),A
                      	
  E520                	WRDF:				;Bクラスタ分FATを確保する
  E520  110200        		LD	DE,2
  E523  AF            		XOR	A
  E524  3203EB        		LD	(_SECPS+1),A
  E527                	WRDF1:
  E527  C5            		PUSH	BC
  E528  D5            		PUSH	DE
  E529  CDF7F0        		CALL	_GNCL
  E52C  381C          		JR	C,WRDF3
  E52E  7A            		LD	A,D		;空いているかチェック
  E52F  B3            		OR	E
  E530  2027          		JR	NZ,WRDF4
  E532  E1            		POP	HL		;HL=空いているクラスタ
  E533  E5            		PUSH	HL
  E534  ED5BFEF1      		LD	DE,(_CLPS)	;DE=元の(_CLPS)
  E538  22FEF1        		LD	(_CLPS),HL
  E53B  7A            		LD	A,D		;元の(_CLPS)が 0 か?
  E53C  B3            		OR	E
  E53D  2008          		JR	NZ,WRDF2
  E53F  FD751A        		LD	(IY+26),L	;(FCB)ファイルの先頭クラスタ
  E542  FD741B        		LD	(IY+27),H	;元が空の場合はFCBにクラスタをセットする
  E545  1803          		JR	WRDF3
  E547                	WRDF2:
  E547  CDFAF0        		CALL	_SNCL
  E54A                	WRDF3:
  E54A  D1            		POP	DE
  E54B  C1            		POP	BC
  E54C  D8            		RET	C
  E54D  100C          		DJNZ	WRDF5		;ここでループカウンタチェック
  E54F  ED5BFEF1      		LD	DE,(_CLPS)
  E553  21FFFF        		LD	HL,0FFFFH	;FATエントリ終了(EOCマーク)
  E556  C3FAF0        		JP	_SNCL
                      	
  E559                	WRDF4:				;DEクラスタが空じゃないので次に移動する
  E559  D1            		POP	DE
  E55A  C1            		POP	BC
  E55B                	WRDF5:
  E55B  13            		INC	DE
  E55C  CD8FE3        		CALL	ENDCL
  E55F  38C6          		JR	C,WRDF1
  E561  37            		SCF
  E562  C9            		RET
                      	
  E563                	RWXR:
  E563  3A94E8        		LD	A,(SECSZ+2)	;1024=4 / 512=2 / 256=1
  E566                	L_RWX:
  E566  1F            		RRA		;->CF
  E567  3808          		JR	C,E_RWX
  E569  CB38          		SRL	B	;BCH=BCH/2
  E56B  CB19          		RR	C	;
  E56D  CB1C          		RR	H	;
  E56F  18F5          		JR	L_RWX
  E571                	E_RWX:
  E571  FD5E1A        		LD	E,(IY+26)	;(FCB)ファイルの先頭クラスタ
  E574  FD561B        		LD	D,(IY+27)
  E577  AF            		XOR	A
  E578  3203EB        		LD	(_SECPS+1),A
  E57B                	RWX1:
  E57B  ED53FEF1      		LD	(_CLPS),DE
  E57F  7A            		LD	A,D
  E580  B3            		OR	E
  E581  2813          		JR	Z,SCF_RET	;RET DE==0 => CF=1
                      	
  E583  78            		LD	A,B
  E584  B1            		OR	C
  E585  B4            		OR	H
  E586  C8            		RET	Z		;RET BCH==0 => CF=0
                      	
  E587  CD0BEB        		CALL	GNCLX
  E58A  D8            		RET	C
  E58B  7C            		LD	A,H		;
  E58C  25            		DEC	H		;
  E58D  B7            		OR	A		;DEC BCH
  E58E  2001          		JR	NZ,RWX2		;
  E590  0B            		DEC	BC		;
  E591                	RWX2:
  E591  CD8FE3        		CALL	ENDCL
  E594  38E5          		JR	C,RWX1
  E596                	SCF_RET:
  E596  37            		SCF
  E597  C9            		RET
                      	
  E598                	DSKF:
  E598  110000        	MAXCLP:	LD	DE,0
  E59B  2AACF0        		LD	HL,(_FAKEFREE)
  E59E  7C            		LD	A,H
  E59F  B5            		OR	L
  E5A0  2803          		JR	Z,DSKF1
  E5A2  110100        		LD	DE,1
  E5A5                	DSKF1:
  E5A5  D5            		PUSH	DE
  E5A6  CDF7F0        		CALL	_GNCL
  E5A9  380C          		JR	C,POPSCF
  E5AB  7A            		LD	A,D
  E5AC  B3            		OR	E
  E5AD  2001          		JR	NZ,DSKF2
  E5AF  23            		INC	HL
  E5B0                	DSKF2:
  E5B0  D1            		POP	DE
  E5B1  1B            		DEC	DE
  E5B2  7A            		LD	A,D
  E5B3  B3            		OR	E
  E5B4  20EF          		JR	NZ,DSKF1
  E5B6  C9            		RET
                      	
  E5B7                	POPSCF:
  E5B7  F1            		POP	AF
  E5B8  37            		SCF
  E5B9  C9            		RET
                      	
  E5BA                	SETTMS:
  E5BA  FD7E17        		LD	A,(IY+23)	;(FCB)ファイルを最後に変更した時刻
  E5BD  3C            		INC	A
  E5BE  C0            		RET	NZ		;ファイルが更新されていない
  E5BF                	SETTMSX:			;FCBに日付時刻をセットする
  E5BF  CD72DC        		CALL	_SYS2C		;(BDOS)時刻の獲得
                      					;H←時  L←分  D←秒
  E5C2  CB25          		SLA	L		;   *2
  E5C4  CB25          		SLA	L		;   *4
  E5C6  29            		ADD	HL,HL		;*2 *8
  E5C7  29            		ADD	HL,HL		;*4 *16
  E5C8  29            		ADD	HL,HL		;*8 *32
  E5C9  7A            		LD	A,D
  E5CA  0F            		RRCA			;bit.0->7->->->0->C
  E5CB  E61F          		AND	01FH
  E5CD  B5            		OR	L
  E5CE  FD7716        		LD	(IY+22),A	;(FCB)ファイルを最後に変更した時刻
  E5D1  FD7417        		LD	(IY+23),H
                      	
  E5D4  CD4FDC        		CALL	_SYS2A		;(BDOS)日付の獲得
                      					;HL←年  D←月  E←日
  E5D7  0144F8        		LD	BC,0-1980
  E5DA  09            		ADD	HL,BC
  E5DB  65            		LD	H,L
                      	
  E5DC  7A            		LD	A,D
  E5DD  87            		ADD	A,A		;*2
  E5DE  87            		ADD	A,A		;*4
  E5DF  87            		ADD	A,A		;*8
  E5E0  87            		ADD	A,A		;*16
  E5E1  6F            		LD	L,A
  E5E2  29            		ADD	HL,HL		;*32
  E5E3  7D            		LD	A,L
  E5E4  B3            		OR	E
  E5E5  FD7714        		LD	(IY+20),A	;(FCB)ファイルを最後に変更した日付
  E5E8  FD7415        		LD	(IY+21),H
  E5EB  C9            		RET
                      	
  E5EC                	PUSHRR:
  E5EC  328BE6        		LD	(SETSEQ_SWC_RND),A
  E5EF  229DE6        		LD	(SETSEQ_SWC_SEQ_RR),HL
  E5F2  CD12E6        		CALL	GET_RR_AHL
  E5F5  225AF0        		LD	(HLBUF),HL
  E5F8  325CF0        		LD	(HLBUF+2),A
  E5FB  C9            		RET
                      	
  E5FC                	GET_CPM_R_SIZE:		;バイト単位からCP/Mのレコード単位を求める（1レコード=128バイト）
  E5FC  87            		ADD	A,A		;in BHLA => out AHL
  E5FD  ED6A          		ADC	HL,HL
  E5FF  CB18          		RR	B
  E601  B7            		OR	A
  E602  78            		LD	A,B		;ここでフラグは変化しない
  E603  C8            		RET	Z
  E604  2C            		INC	L		;INC AHL
  E605  C0            		RET	NZ		;
  E606  24            		INC	H		;
  E607  C0            		RET	NZ		;
  E608  3C            		INC	A		;
  E609  C9            		RET
                      	
  E60A                	INIT_RND:
  E60A  3ECD          		LD	A,0CDH		;CALL ????
  E60C  215BE6        		LD	HL,POPRR
  E60F  CDECE5        		CALL	PUSHRR
  E612                	GET_RR_AHL:
  E612  FD6E21        		LD	L,(IY+33)	;(FCB)Random record
  E615  FD6622        		LD	H,(IY+34)	;
  E618  FD7E23        		LD	A,(IY+35)	;
  E61B  C9            		RET
  E61C                	SET_RR_AHL:
  E61C  FD7521        		LD	(IY+33),L	;(FCB)Random record
  E61F  FD7422        		LD	(IY+34),H
  E622  FD7723        		LD	(IY+35),A
  E625  C9            		RET
  E626                	INIT_SEQ:
  E626  3E01          		LD	A,1		;LD BC,????
  E628  2158E6        		LD	HL,SETSEQ
  E62B  CDECE5        		CALL	PUSHRR
  E62E                	GETSEQ:
  E62E  FD6E20        		LD	L,(IY+32)	;(FCB)カレントレコード
  E631  FD660C        		LD	H,(IY+12)	;(FCB)カレントブロック
  E634  AF            		XOR	A
                      	
  E635  CB25          		SLA	L	;L=L*2
                      	
  E637  CB3C          		SRL	H	;HL=HL/2
  E639  CB1D          		RR	L	;
  E63B  C9            		RET
                      	
  E63C                	SETSEQ1:
  E63C  F5            		PUSH	AF
  E63D  E5            		PUSH	HL		;AHL=Random record
  E63E  FD7E21        		LD	A,(IY+33)	;(FCB)ランダムレコード
  E641  FD6E22        		LD	L,(IY+34)
  E644  FD6623        		LD	H,(IY+35)
  E647  0600          		LD	B,0
                      	
  E649  CDFCE5        		CALL	GET_CPM_R_SIZE
                      	
  E64C  29            		ADD	HL,HL
  E64D  CB3D          		SRL	L		;L=L/2
  E64F  FD7520        		LD	(IY+32),L	;(FCB)カレントレコード
  E652  FD740C        		LD	(IY+12),H	;(FCB)カレントブロック
  E655  E1            		POP	HL
  E656  F1            		POP	AF
  E657  C9            		RET
  E658                	SETSEQ:
  E658  CD3CE6        		CALL	SETSEQ1
  E65B                	POPRR:
  E65B  F5            		PUSH	AF
  E65C  E5            		PUSH	HL
  E65D  2A5AF0        		LD	HL,(HLBUF)
  E660  3A5CF0        		LD	A,(HLBUF+2)
  E663  CD1CE6        		CALL	SET_RR_AHL
  E666  E1            		POP	HL
  E667  F1            		POP	AF
  E668  C9            		RET
                      	
  E669                	RB_WRITE:
  E669  C5            		PUSH	BC
  E66A  ED4B4CF1      		LD	BC,(STABLE+2*026H)	;(BDOS)ランダムブロック書き込み
  E66E  1805          		JR	RBRW
  E670                	RB_READ:
  E670  C5            		PUSH	BC
  E671  ED4B4EF1      		LD	BC,(STABLE+2*027H)	;(BDOS)ランダムブロック読み込み
  E675                	RBRW:
  E675  CB3F          		SRL	A	;AHLA' = HL*128
  E677  CB1C          		RR	H	;AHL=AHL/2
  E679  CB1D          		RR	L	;
  E67B  3E00          		LD	A,0
  E67D  1F            		RRA		;A'HLA
  E67E  FD7721        		LD	(IY+33),A	;(FCB)ランダムレコード
  E681  FD7522        		LD	(IY+34),L
  E684  FD7423        		LD	(IY+35),H
  E687  218000        		LD	HL,128
  E68A  C5            		PUSH	BC
  E68B                	SETSEQ_SWC_RND:
  E68B  CD3CE6        		CALL	SETSEQ1
  E68E  C1            		POP	BC
  E68F  FDCB20FE      		SET	7,(IY+32)	;(FCB)カレントレコード
  E693  FDE5          		PUSH	IY
  E695  D1            		POP	DE
  E696  D5            		PUSH	DE
  E697  CDA5E6        		CALL	JP_BC
  E69A  FDE1          		POP	IY
  E69C  CD58E6        		CALL	SETSEQ
  E69D                	SETSEQ_SWC_SEQ_RR	EQU $-2
  E69F  FDCB20BE      		RES	7,(IY+32)	;(FCB)カレントレコード
                      	
  E6A3  C1            		POP	BC
  E6A4  C9            		RET
  E6A5                	JP_BC:
  E6A5  C5            		PUSH	BC
  E6A6  C9            		RET
                      	
  E21F                	_SYS03	EQU	SCF_FF_RET	;(BDOS)外部入力
  E21F                	_SYS2B	EQU	SCF_FF_RET	;(BDOS)日付の設定
  E21F                	_SYS2D	EQU	SCF_FF_RET	;(BDOS)時刻の設定
  E21F                	_SYS39	EQU	SCF_FF_RET	;(BDOS)サブディレクトリの作成
  E21F                	_SYS3A	EQU	SCF_FF_RET	;(BDOS)サブディレクトリの削除
                      	
                      	
                      	;LDFILE2.ASM
                      	
                      	;	LSX-Dodgers FILE2
                      	
                      					;Write random block
  E6A7                	_SYS26:		;(BDOS)ランダムブロック書き込み
  E6A7  AF            		XOR	A
  E6A8  3293E9        		LD	(DRDN1),A	;NOP
  E6AB  22D7E8        		LD	(LEFT+1),HL	;HL←書き込むレコード数
  E6AE  225DF0        		LD	(LEFTX),HL
  E6B1  CD74E1        		CALL	SETDRV
                      	
  E6B4  CD2EE8        		CALL	RBX0
  E6B7  DA51E7        		JP	C,RBWERR
  E6BA  CDFCE4        		CALL	WOPEN
  E6BD  DA51E7        		JP	C,RBWERR
  E6C0  7C            		LD	A,H
  E6C1  B5            		OR	L
  E6C2  CA4AE7        		JP	Z,RBW1
                      	
  E6C5  2B            		DEC	HL
                      	
  E6C6  CDF9E8        		CALL	GET_RR_BCDE	;BCDE=Random record
                      	
  E6C9  19            		ADD	HL,DE		;BCHL=HL+BCDE
  E6CA  3001          		JR	NC,S26X1	;
  E6CC  03            		INC	BC		;
  E6CD                	S26X1:
  E6CD  CD63E5        		CALL	RWXR
  E6D0  DC0DE5        		CALL	C,WRDFX
  E6D3  DA51E7        		JP	C,RBWERR
                      	
  E6D6  CD5DE8        		CALL	RBX2
  E6D9  281A          		JR	Z,RBWB		;NZ=セクタ以下の端数がある
  E6DB  CD7CE8        		CALL	RBXA
  E6DE  3871          		JR	C,RBWERR
  E6E0  EB            		EX	DE,HL
  E6E1  C5            		PUSH	BC
  E6E2  EDB0          		LDIR
  E6E4  225FF0        		LD	(DTAX),HL
                      	
  E6E7  CDA1E4        		CALL	SWTDBF		;バッファデータは更新された
                      	
  E6EA  2A5DF0        		LD	HL,(LEFTX)
  E6ED  D1            		POP	DE
  E6EE  ED52          		SBC	HL,DE
  E6F0  225DF0        		LD	(LEFTX),HL
  E6F3  2833          		JR	Z,RBWEND
                      	
  E6F5                	RBWB:
  E6F5  CDB2E8        		CALL	RBXB
  E6F8  2816          		JR	Z,RBWC
  E6FA                	RBWB1:
  E6FA  C5            		PUSH	BC
  E6FB  D5            		PUSH	DE
  E6FC  CD72E3        		CALL	CLUSTX
  E6FF  CD0DE9        		CALL	DWTC
  E702  D1            		POP	DE
  E703  C1            		POP	BC
  E704  384B          		JR	C,RBWERR
  E706  CD0BEB        		CALL	GNCLX
  E709  3846          		JR	C,RBWERR
  E70B  10ED          		DJNZ	RBWB1
  E70D  CD5DE9        		CALL	DRW_FLUSH
  E710                	RBWC:
  E710  CDCAE8        		CALL	RBXC
  E713  2813          		JR	Z,RBWEND
  E715  C5            		PUSH	BC
  E716  CD72E3        		CALL	CLUSTX
  E719  CD92E9        		CALL	DRDN
  E71C  C1            		POP	BC
  E71D  3832          		JR	C,RBWERR
  E71F  ED5B7EF1      		LD	DE,(_DTBUF)
  E723  EDB0          		LDIR
  E725  CDA1E4        		CALL	SWTDBF		;バッファデータは更新された
  E728                	RBWEND:
  E728  CDD6E8        		CALL	RBXEND
                      	
  E72B  CD3DE8        		CALL	RBX1
  E72E  301A          		JR	NC,RBW1
  E730  2AD7E8        		LD	HL,(LEFT+1)
  E733  FD5E10        		LD	E,(IY+16)	;(FCB)ファイルのサイズ(バイト単位)
  E736  FD5611        		LD	D,(IY+17)	;DE=File size
  E739  19            		ADD	HL,DE
  E73A  FD7510        		LD	(IY+16),L	;(FCB)ファイルのサイズ(バイト単位)
  E73D  FD7411        		LD	(IY+17),H
  E740  3008          		JR	NC,RBW1
  E742  FD3412        		INC	(IY+18)
  E745  2003          		JR	NZ,RBW1
  E747  FD3413        		INC	(IY+19)
  E74A                	RBW1:
  E74A  FDE1          		POP	IY
  E74C  C1            		POP	BC
  E74D  D1            		POP	DE
  E74E  E1            		POP	HL
  E74F                	DD_NUL:
  E74F  AF            		XOR	A
  E750                	DRDF0:
  E750                	DWTF0:
  E750  C9            		RET
                      	
  E751                	RBWERR:
  E751  FDE5          		PUSH	IY
  E753  D1            		POP	DE
  E754  2A20F1        		LD	HL,(STABLE+2*010H)
  E757  CD0F00        		CALL	JP_HL
  E75A                	RBRERR1:
  E75A  3E01          		LD	A,001H
  E75C                	RBRERR2:
  E75C  FDE1          		POP	IY
  E75E  C1            		POP	BC
  E75F  D1            		POP	DE
  E760  E1            		POP	HL
  E761  37            		SCF
  E762  210000        		LD	HL,0
  E765  C9            		RET
                      	
  E766                	RBRERR:
  E766  3EFF          		LD	A,0FFH
  E768  18F2          		JR	RBRERR2
                      	
  E76A                	RBRFL:
  E76A  3E00          	RBRFLP:	LD	A,000H
  E76C  FE0D          		CP	00DH
  E76E  2005          		JR	NZ,RBRFL1
  E770  D5            		PUSH	DE
  E771  1E0A          		LD	E,00AH
  E773  1805          		JR	RBRFL2
  E775                	RBRFL1:
  E775  D5            		PUSH	DE
  E776  CD09F0        		CALL	_SYS07
  E779  5F            		LD	E,A
  E77A                	RBRFL2:
  E77A  CDCDF0        		CALL	_PRINT
  E77D  7B            		LD	A,E
  E77E  D1            		POP	DE
  E77F  326BE7        		LD	(RBRFLP+1),A
  E782  C9            		RET
  E783                	DDX:
  E783  FD7E01        		LD	A,(IY+1)	;(FCB)主ファイル名
  E786  CD97E3        		CALL	CAP
  E789  FE41          		CP	'A'
  E78B  C9            		RET
                      	
                      					;Read random block
  E78C                	_SYS27:		;(BDOS)ランダムブロック読み込み
  E78C  225DF0        		LD	(LEFTX),HL
  E78F  CD74E1        		CALL	SETDRV
                      	
  E792  FDCB0D66      		BIT	4,(IY+13)	;(FCB)属性(アトリビュート)
  E796  C21CE8        		JP	NZ,RBRDIR	;ディレクトリ
  E799  CD2EE8        		CALL	RBX0
  E79C  DA66E7        		JP	C,RBRERR
  E79F  CD3DE8        		CALL	RBX1
  E7A2  DA5AE7        		JP	C,RBRERR1
  E7A5  EB            		EX	DE,HL
  E7A6  ED52          		SBC	HL,DE		;CP 00HL,BCDE
  E7A8  19            		ADD	HL,DE
  E7A9  79            		LD	A,C
  E7AA  DE00          		SBC	A,0
  E7AC  78            		LD	A,B
  E7AD  DE00          		SBC	A,0
  E7AF  3801          		JR	C,RBR1
  E7B1  EB            		EX	DE,HL
  E7B2                	RBR1:
  E7B2  9F            		SBC	A,A
  E7B3  E601          		AND	1
  E7B5  321AE8        		LD	(RBRAP+1),A
                      	
  E7B8  7C            		LD	A,H
  E7B9  B5            		OR	L
  E7BA  2857          		JR	Z,RBREND0
                      	
  E7BC  22D7E8        		LD	(LEFT+1),HL	;Read record byte
  E7BF  225DF0        		LD	(LEFTX),HL
                      	
  E7C2  CD5DE8        		CALL	RBX2
  E7C5  2819          		JR	Z,RBRB
  E7C7  CD7CE8        		CALL	RBXA
  E7CA  DA66E7        		JP	C,RBRERR
  E7CD  C5            		PUSH	BC
  E7CE  EDB0          		LDIR
  E7D0  ED535FF0      		LD	(DTAX),DE
  E7D4  2A5DF0        		LD	HL,(LEFTX)
  E7D7  D1            		POP	DE
  E7D8  A7            		AND	A
  E7D9  ED52          		SBC	HL,DE
  E7DB  225DF0        		LD	(LEFTX),HL
  E7DE  2830          		JR	Z,RBREND
                      	
  E7E0                	RBRB:
  E7E0  CDB2E8        		CALL	RBXB
  E7E3  2815          		JR	Z,RBRC
  E7E5                	RBRB1:
  E7E5  C5            		PUSH	BC
  E7E6  D5            		PUSH	DE
  E7E7  CD72E3        		CALL	CLUSTX
  E7EA  CD13E9        		CALL	DRDC
  E7ED  D1            		POP	DE
  E7EE  C1            		POP	BC
  E7EF  D40BEB        		CALL	NC,GNCLX
  E7F2  DA66E7        		JP	C,RBRERR
  E7F5  10EE          		DJNZ	RBRB1
  E7F7  CD5DE9        		CALL	DRW_FLUSH
  E7FA                	RBRC:
  E7FA  CDCAE8        		CALL	RBXC
  E7FD  2811          		JR	Z,RBREND
  E7FF  C5            		PUSH	BC
  E800  CD72E3        		CALL	CLUSTX
  E803  CD76E9        		CALL	DRDX
  E806  C1            		POP	BC
  E807  DA66E7        		JP	C,RBRERR
  E80A  EB            		EX	DE,HL
  E80B  2A7EF1        		LD	HL,(_DTBUF)
  E80E  EDB0          		LDIR
  E810                	RBREND:
  E810  CDD6E8        		CALL	RBXEND
  E813                	RBREND0:
  E813  FDE1          		POP	IY
  E815  C1            		POP	BC
  E816  D1            		POP	DE
  E817  F1            		POP	AF	;(HL)
  E818  AF            		XOR	A
  E819  3E00          	RBRAP:	LD	A,000H
  E81B  C9            		RET
                      	
  E81C                	RBRDIR:
  E81C  FD6E1A        		LD	L,(IY+26)	;(FCB)ファイルの先頭クラスタ
  E81F  FD661B        		LD	H,(IY+27)
  E822  CDB2E3        		CALL	CHDIR
  E825  AF            		XOR	A
  E826  67            		LD	H,A
  E827  6F            		LD	L,A
  E828  3C            		INC	A
  E829  321AE8        		LD	(RBRAP+1),A
  E82C  18E5          		JR	RBREND0
                      	
  E82E                	RBX0:
  E82E  2A8AF0        		LD	HL,(_DTA)
  E831  225FF0        		LD	(DTAX),HL
  E834  2A5DF0        		LD	HL,(LEFTX)
  E837  FD7E1C        		LD	A,(IY+28)	;(FCB)オープンモード
  E83A  D6FD          		SUB	0FDH
  E83C  C9            		RET
                      	
  E83D                	RBX1:
  E83D  E5            		PUSH	HL		;Record byte
                      					;AHL=File size
  E83E  FD6E10        		LD	L,(IY+16)	;ファイルのサイズ(バイト単位)
  E841  FD6611        		LD	H,(IY+17)	;
  E844  FD7E12        		LD	A,(IY+18)	;
                      	
  E847  CDF9E8        		CALL	GET_RR_BCDE	;BCDE=Random record
                      	
  E84A  A7            		AND	A
  E84B  ED52          		SBC	HL,DE
  E84D  99            		SBC	A,C
  E84E  4F            		LD	C,A
  E84F  FD7E13        		LD	A,(IY+19)	;ファイルのサイズ
  E852  98            		SBC	A,B
  E853  D1            		POP	DE
                      	
  E854  D8            		RET	C
  E855  47            		LD	B,A
  E856  B1            		OR	C
  E857  EB            		EX	DE,HL	;BCDE=File byte	HL=Record byte
  E858  B2            		OR	D
  E859  B3            		OR	E
  E85A  C0            		RET	NZ
  E85B  37            		SCF
  E85C  C9            		RET
                      	
  E85D                	RBX2:				;Cluster settings
  E85D  FD6622        		LD	H,(IY+34)	;(+33)(FCB)ランダムレコード
  E860  FD4E23        		LD	C,(IY+35)
  E863  0600          		LD	B,0
  E865  FDCB207E      		BIT	7,(IY+32)	;(FCB)カレントレコード
  E869  2003          		JR	NZ,RBX3
  E86B  FD4624        		LD	B,(IY+36)
  E86E                	RBX3:
  E86E  CD63E5        		CALL	RWXR
  E871  3A94E8        		LD	A,(SECSZ+2)	;1024=4 / 512=2 / 256=1
  E874  3D            		DEC	A
  E875  FDA622        		AND	(IY+34)
  E878  FDB621        		OR	(IY+33)
  E87B  C9            		RET
                      	
  E87C                	RBXA:
  E87C  C5            		PUSH	BC
  E87D  D5            		PUSH	DE
  E87E  CD72E3        		CALL	CLUSTX
  E881  CD76E9        		CALL	DRDX
  E884  D1            		POP	DE
  E885  C1            		POP	BC
  E886  D8            		RET	C
  E887  CD0BEB        		CALL	GNCLX
  E88A  D8            		RET	C
  E88B  ED53FEF1      		LD	(_CLPS),DE
                      	
  E88F  FD4E21        		LD	C,(IY+33)	;(FCB)ランダムレコード
  E892  210004        	SECSZ:	LD	HL,0400H	;自己書き換え 1024=0400H / 512=0200H ここに1セクタのサイズが格納される
  E895  7C            		LD	A,H
  E896  3D            		DEC	A		;1024=3 / 512=1
  E897  FDA622        		AND	(IY+34)		;(FCB)ランダムレコード
  E89A  47            		LD	B,A		;BCに1セクタ以下の端数が入る
  E89B  ED42          		SBC	HL,BC		;残りを計算
                      	
  E89D  ED5B5DF0      		LD	DE,(LEFTX)
  E8A1  ED52          		SBC	HL,DE		;CP HL,DE
  E8A3  19            		ADD	HL,DE		;
  E8A4  3801          		JR	C,RBXA1		;DEとHLを比較して大きい方をHLに
  E8A6  EB            		EX	DE,HL
  E8A7                	RBXA1:
  E8A7  E5            		PUSH	HL
  E8A8  2A7EF1        		LD	HL,(_DTBUF)
  E8AB  09            		ADD	HL,BC
  E8AC  ED5B5FF0      		LD	DE,(DTAX)
  E8B0  C1            		POP	BC
  E8B1  C9            		RET
                      	
  E8B2                	RBXB:
  E8B2  2A5FF0        		LD	HL,(DTAX)
  E8B5  ED5BFEF1      		LD	DE,(_CLPS)
  E8B9  3A5EF0        		LD	A,(LEFTX+1)
  E8BC  47            		LD	B,A
  E8BD  3A94E8        		LD	A,(SECSZ+2)	;1024=4 / 512=2 / 256=1
  E8C0                	RBXB1:
  E8C0  1F            		RRA		;->CF
  E8C1  3804          		JR	C,RBXB2
  E8C3  CB38          		SRL	B	;B=B/2
  E8C5  18F9          		JR	RBXB1
  E8C7                	RBXB2:
  E8C7  78            		LD	A,B
  E8C8  B7            		OR	A
  E8C9  C9            		RET
                      	
  E8CA                	RBXC:
  E8CA  ED4B5DF0      		LD	BC,(LEFTX)
  E8CE  3A94E8        		LD	A,(SECSZ+2)	;1024=4 / 512=2 / 256=1
  E8D1  3D            		DEC	A
  E8D2  A0            		AND	B
  E8D3  47            		LD	B,A		;1セクタ以下の端数がない場合はZ
  E8D4  B1            		OR	C
  E8D5  C9            		RET
                      	
  E8D6                	RBXEND:
  E8D6  110000        	LEFT:	LD	DE,0
  E8D9  AF            		XOR	A
  E8DA  FD6E21        		LD	L,(IY+33)	;(FCB)ランダムレコード
  E8DD  FD6622        		LD	H,(IY+34)
  E8E0  19            		ADD	HL,DE
  E8E1  FD7521        		LD	(IY+33),L	;(FCB)ランダムレコード
  E8E4  FD7422        		LD	(IY+34),H
  E8E7  300E          		JR	NC,RBXEND1
  E8E9  FD3423        		INC	(IY+35)
  E8EC  2009          		JR	NZ,RBXEND1
  E8EE  FDCB207E      		BIT	7,(IY+32)	;(FCB)カレントレコード
  E8F2  2003          		JR	NZ,RBXEND1
  E8F4  FD3424        		INC	(IY+36)
  E8F7                	RBXEND1:
  E8F7  EB            		EX	DE,HL		;HL=Read byte
  E8F8  C9            		RET
                      	
  E8F9                	GET_RR_BCDE:			;BCDE=Random record
  E8F9  FD5E21        		LD	E,(IY+33)	;(FCB)ランダムレコード
  E8FC  FD5622        		LD	D,(IY+34)
  E8FF  FD4E23        		LD	C,(IY+35)
  E902  FD4624        		LD	B,(IY+36)
  E905  FDCB207E      		BIT	7,(IY+32)	;(FCB)カレントレコード
  E909  C8            		RET	Z
  E90A  0600          		LD	B,0		;CP/M互換のアクセスの場合はFCBは36バイト
  E90C  C9            		RET
                      	
                      	;	ランダムブロックアクセスの連続したセクタをまとめる
                      	
  E90D                	DWTC:
  E90D  E5            		PUSH	HL
  E90E  219DEC        		LD	HL,DWT24B
  E911  1804          		JR	DWTC1
  E913                	DRDC:
  E913  E5            		PUSH	HL
  E914  218DEC        		LD	HL,DRD24B
  E917                	DWTC1:
  E917  2271E9        		LD	(DRWF_MODE),HL
  E91A  E1            		POP	HL
  E91B  3A61E9        		LD	A,(DRWF_B)
  E91E  B7            		OR	A
  E91F  200F          		JR	NZ,DRDC1
  E921                	SAVE_DRWC:
  E921  0601          		LD	B,1
  E923  ED4360E9      		LD	(DRWF_C),BC
  E927  ED5367E9      		LD	(DRWF_E),DE
  E92B  226AE9        		LD	(DRWF_HL),HL
  E92E  1820          		JR	INC_HL_DRWC
  E930                	DRDC1:
  E930  E5            		PUSH	HL
  E931  2167E9        		LD	HL,DRWF_E
  E934  86            		ADD	A,(HL)
  E935  F5            		PUSH	AF
  E936  BB            		CP	E
  E937  201D          		JR	NZ,DRDC2
  E939  F1            		POP	AF
  E93A  23            		INC	HL
  E93B  7E            		LD	A,(HL)
  E93C  CE00          		ADC	A,0
  E93E  F5            		PUSH	AF
  E93F  BA            		CP	D
  E940  2014          		JR	NZ,DRDC2
  E942  F1            		POP	AF
  E943  3A60E9        		LD	A,(DRWF_C)
  E946  CE00          		ADC	A,0
  E948  B9            		CP	C
  E949  200C          		JR	NZ,DRDC3
  E94B  2161E9        		LD	HL,DRWF_B
  E94E  34            		INC	(HL)
  E94F  E1            		POP	HL
  E950                	INC_HL_DRWC:
  E950  3A94E8        		LD	A,(SECSZ+2)		;1セクタのサイズの上位1バイト
  E953  84            		ADD	A,H
  E954  67            		LD	H,A
  E955  C9            		RET
  E956                	DRDC2:
  E956  F1            		POP	AF
  E957                	DRDC3:
  E957  CD5DE9        		CALL	DRW_FLUSH
  E95A  E1            		POP	HL
  E95B  18C4          		JR	SAVE_DRWC
                      	
                      	;	ランダムブロックアクセスの連続したセクタをまとめたものをフラッシュする
  E95D                	DRW_FLUSH:
  E95D  C5            		PUSH	BC
  E95E  D5            		PUSH	DE
  E95F  010000        		LD	BC,0
  E960                	DRWF_C	EQU	$-2
  E961                	DRWF_B	EQU	$-1
  E962  78            		LD	A,B
  E963  B7            		OR	A
  E964  280D          		JR	Z,DRDF1
  E966  110000        		LD	DE,0
  E967                	DRWF_E	EQU	$-2
  E968                	DRWF_D	EQU	$-1
  E969  210000        		LD	HL,0
  E96A                	DRWF_HL	EQU	$-2
  E96C  AF            		XOR	A
  E96D  3261E9        		LD	(DRWF_B),A
  E970  CD8DEC        		CALL	DRD24B
  E971                	DRWF_MODE	EQU	$-2
  E973                	DRDF1:
  E973  D1            		POP	DE
  E974  C1            		POP	BC
  E975  C9            		RET
                      	
                      	;LDDIO.ASM
                      	
                      	;	LSX-Dodgers DIO
                      	
  E976                	DRDX:
  E976  CDB4E9        		CALL	DRDY
  E979  C8            		RET	Z
  E97A  CD9AE9        		CALL	DRDX1		;データバッファの情報を保存
  E97D  D8            		RET	C
  E97E  E5            		PUSH	HL
  E97F  C5            		PUSH	BC
  E980  D5            		PUSH	DE
  E981  2A7EF1        		LD	HL,(_DTBUF)
  E984  3ADDE9        		LD	A,(_DBS24+1)
  E987  4F            		LD	C,A
  E988  CD8BEC        		CALL	DRD24
  E98B  DCAFE9        		CALL	C,DRDNE
  E98E                	POP_DE_BC_HL_RET:
  E98E  D1            		POP	DE
  E98F  C1            		POP	BC
  E990  E1            		POP	HL
  E991  C9            		RET
                      	
                      	;	CDE:セクタ番号
  E992                	DRDN:
  E992  AF            		XOR	A
  E993  00            	DRDN1:	NOP			;自己書き換え NOP / SCF
  E994  30E0          		JR	NC,DRDX
  E996                	DRDNX:
  E996  CDB4E9        		CALL	DRDY
  E999  C8            		RET	Z
  E99A                	DRDX1:
  E99A  CDCAE9        		CALL	DWTX
                      					;データバッファの読み込んだドライブ・セクタ情報を保存
  E99D  ED53A6F0      		LD	(_DBSEC),DE
  E9A1  79            		LD	A,C
  E9A2  32DDE9        		LD	(_DBS24+1),A
                      	
  E9A5  3A88F0        		LD	A,(_DRV)
  E9A8  32A5F0        		LD	(_DBDRV),A
  E9AB  CDD9F0        		CALL	_CHGDRV
  E9AE  D0            		RET	NC
  E9AF                	DRDNE:
  E9AF  9F            		SBC	A,A		;CF=1ならばA=0FFH
  E9B0  32A5F0        		LD	(_DBDRV),A
  E9B3  C9            		RET
                      	
                      	;	CDE:セクタ番号
  E9B4                	DRDY:
  E9B4  3ADDE9        		LD	A,(_DBS24+1)
  E9B7  B9            		CP	C
  E9B8  C0            		RET	NZ
                      	
  E9B9  E5            		PUSH	HL
  E9BA  3A88F0        		LD	A,(_DRV)
  E9BD  21A5F0        		LD	HL,_DBDRV
  E9C0  AE            		XOR	(HL)
  E9C1  2005          		JR	NZ,POP_HL_RET
                      	
  E9C3  2AA6F0        		LD	HL,(_DBSEC)
  E9C6  ED52          		SBC	HL,DE		;CF=0
  E9C8                	POP_HL_RET:
  E9C8  E1            		POP	HL
  E9C9  C9            		RET
                      	
  E9CA                	DWTX:
  E9CA  3AA4F0        		LD	A,(_WTDBF)
  E9CD  B7            		OR	A
  E9CE  C8            		RET	Z
  E9CF  AF            		XOR	A
  E9D0  32A4F0        		LD	(_WTDBF),A
                      	
  E9D3  E5            		PUSH	HL
  E9D4  C5            		PUSH	BC
  E9D5  D5            		PUSH	DE
  E9D6  3AA5F0        		LD	A,(_DBDRV)
  E9D9  CDD9F0        		CALL	_CHGDRV
  E9DC  0E00          	_DBS24:	LD	C,0
  E9DE  ED5BA6F0      		LD	DE,(_DBSEC)
  E9E2  2A7EF1        		LD	HL,(_DTBUF)
  E9E5  D49BEC        		CALL	NC,DWT24
  E9E8                	POP_DE_BC_HL_RET2:
  E9E8  18A4          		JR	POP_DE_BC_HL_RET
                      	
  E9EA                	RDFATX:
  E9EA  E5            		PUSH	HL
  E9EB  3A88F0        		LD	A,(_DRV)
  E9EE  21AAF0        		LD	HL,_FATDRV
  E9F1  AE            		XOR	(HL)
  E9F2  28D4          		JR	Z,POP_HL_RET
                      	
  E9F4  C5            		PUSH	BC
  E9F5  D5            		PUSH	DE
  E9F6  DDE5          		PUSH	IX
  E9F8  CD14EA        		CALL	WTFATX
  E9FB  3813          		JR	C,POP_IX_DE_BC_HL_RET
                      	
  E9FD  AF            		XOR	A
  E9FE  32ABF0        		LD	(_FATIX),A
  EA01  3A88F0        		LD	A,(_DRV)
  EA04  32AAF0        		LD	(_FATDRV),A
  EA07  CDE5F0        		CALL	_RDFAT
  EA0A                	RDFATE2:
  EA0A  3004          		JR	NC,POP_IX_DE_BC_HL_RET
  EA0C  9F            		SBC	A,A		;A=0xFF
  EA0D  32AAF0        		LD	(_FATDRV),A
  EA10                	POP_IX_DE_BC_HL_RET:
  EA10  DDE1          		POP	IX
  EA12  18D4          		JR	POP_DE_BC_HL_RET2
                      	
  EA14                	WTFATX:
  EA14  3AA2F0        		LD	A,(_WTFATF)
  EA17  B7            		OR	A
  EA18  C8            		RET	Z
  EA19  E5            		PUSH	HL
  EA1A  3AAAF0        		LD	A,(_FATDRV)
  EA1D  21A5F0        		LD	HL,_DBDRV
  EA20  AE            		XOR	(HL)
  EA21  CCCAE9        		CALL	Z,DWTX
  EA24  38A2          		JR	C,POP_HL_RET
  EA26  C5            		PUSH	BC
  EA27  D5            		PUSH	DE
  EA28  DDE5          		PUSH	IX
  EA2A  CDA8EC        		CALL	WTFAT
  EA2D  AF            		XOR	A
  EA2E  32A2F0        		LD	(_WTFATF),A
  EA31  18DD          		JR	POP_IX_DE_BC_HL_RET
                      	
  EA33                	NCL1:
  EA33  7A            		LD	A,D
  EA34  B3            		OR	E
  EA35  37            		SCF
  EA36  C8            		RET	Z
                      	
  EA37  7A            		LD	A,D
  EA38  CB3F          		SRL	A	;/2
  EA3A  CB3F          		SRL	A	;/2
                      	
  EA3C  E5            		PUSH	HL
  EA3D  325CEA        		LD	(NCLPAT+2),A	;_FATIX
  EA40  2AAAF0        		LD	HL,(_FATDRV)	;L=_FATDRV H=_FATIX
  EA43  BC            		CP	H
  EA44  3A88F0        		LD	A,(_DRV)	;この間でフラグは変化しない
  EA47  325BEA        		LD	(NCLPAT+1),A	;_FATDRV
  EA4A  2005          		JR	NZ,NCL2		;FATIXが違う
  EA4C  BD            		CP	L
  EA4D  2002          		JR	NZ,NCL2		;ドライブが違う
  EA4F  E1            		POP	HL
  EA50  C9            		RET
  EA51                	NCL2:
  EA51  C5            		PUSH	BC
  EA52  D5            		PUSH	DE
  EA53  DDE5          		PUSH	IX
  EA55  CD14EA        		CALL	WTFATX
  EA58  38B6          		JR	C,POP_IX_DE_BC_HL_RET
  EA5A  010000        	NCLPAT:	LD	BC,0		;自己書き換え C=_FATDRV B=_FATIX
  EA5D  ED43AAF0      		LD	(_FATDRV),BC
  EA61  CD7DEC        		CALL	RDFATS
  EA64  18A4          		JR	RDFATE2
                      	
  EA66                	NCL3:
  EA66  CB9A          		RES	3,D
  EA68  CB92          		RES	2,D
  EA6A  6B            		LD	L,E
  EA6B  62            		LD	H,D
  EA6C  CB3C          		SRL	H	;
  EA6E  CB1D          		RR	L	;HLA=HLA/2
  EA70  1F            		RRA		;
  EA71  F5            		PUSH	AF
  EA72  3AABF0        		LD	A,(_FATIX)
  EA75  0F            		RRCA
  EA76  300B          		JR	NC,NCL3X1
  EA78  3A94E8        		LD	A,(SECSZ+2)
  EA7B  FE04          		CP	4		;1セクタ1024バイトの場合は奇数インデックスの場合に先頭を512バイトずらす
  EA7D  2004          		JR	NZ,NCL3X1
  EA7F  010002        		LD	BC,512
  EA82  09            		ADD	HL,BC
  EA83                	NCL3X1:
  EA83  F1            		POP	AF
  EA84  ED4B7CF1      		LD	BC,(_FATBF)
  EA88  19            		ADD	HL,DE
  EA89  09            		ADD	HL,BC
  EA8A  17            		RLA
  EA8B  C9            		RET
                      	
  EA8C                	GNCL:
  EA8C  CD33EA        		CALL	NCL1		;GET NEXT CLUSTER
  EA8F  D8            		RET	C
  EA90  C5            		PUSH	BC
  EA91  E5            		PUSH	HL
  EA92  CD66EA        		CALL	NCL3
  EA95  3809          		JR	C,GNC1
  EA97  5E            		LD	E,(HL)
  EA98  23            		INC	HL
  EA99  7E            		LD	A,(HL)
  EA9A  E60F          		AND	00FH
  EA9C  57            		LD	D,A
  EA9D  E1            		POP	HL
  EA9E  C1            		POP	BC
  EA9F  C9            		RET
  EAA0                	GNC1:
  EAA0  7E            		LD	A,(HL)
  EAA1  23            		INC	HL
  EAA2  56            		LD	D,(HL)
  EAA3  0604          		LD	B,4
  EAA5                	GNC1L:
  EAA5  CB3A          		SRL	D	;DA=DA/2
  EAA7  1F            		RRA		;
  EAA8  10FB          		DJNZ	GNC1L
                      	
  EAAA  5F            		LD	E,A
  EAAB  E1            		POP	HL
  EAAC  C1            		POP	BC
  EAAD  A7            		AND	A
  EAAE  C9            		RET
                      	
  EAAF                	SNCL:
  EAAF  CD33EA        		CALL	NCL1
  EAB2  D8            		RET	C
                      	;				SET NEXT CLUSTER
  EAB3  E5            		PUSH	HL
  EAB4  C5            		PUSH	BC
  EAB5  D5            		PUSH	DE
  EAB6  E5            		PUSH	HL
  EAB7  CD66EA        		CALL	NCL3
  EABA  D1            		POP	DE
                      	;CF=ODD
  EABB  7E            		LD	A,(HL)
  EABC  73            		LD	(HL),E
  EABD  3806          		JR	C,SNC1
                      	;EVEN
                      	;M[0] = E
                      	;M[1] = (M[1] & 0xF0) | (D & 0x0F)
  EABF  23            		INC	HL
  EAC0  ED67          		RRD		;M={A[3:0],E[3:0]}
  EAC2  7A            		LD	A,D
  EAC3  1804          		JR	SNC11
  EAC5                	SNC1:
                      	;ODD
                      	;HL[0] = (HL[0]&0x0F) | (E<<4)
                      	;HL[1] = DE>>4
  EAC5  ED6F          		RLD		;M={D[3:0],E[7:4]}
  EAC7  23            		INC	HL
  EAC8  72            		LD	(HL),D	;M={D[3:0],E[7:4]}
  EAC9                	SNC11:
  EAC9  ED6F          		RLD		;M={M[7:4],D[3:0]}
  EACB  B7            		OR	A
  EACC  D1            		POP	DE
  EACD  C1            		POP	BC
  EACE  E1            		POP	HL
  EACF                	FAT_CHANGED:
  EACF  3E01          		LD	A,1
  EAD1  32A2F0        		LD	(_WTFATF),A
  EAD4  C9            		RET
                      	
  EAD5                	N16CL3:
  EAD5  C5            		PUSH	BC
  EAD6  6B            		LD	L,E
  EAD7  7A            		LD	A,D
  EAD8  E603          		AND	3
  EADA  67            		LD	H,A
  EADB  29            		ADD	HL,HL
  EADC  ED4B7CF1      		LD	BC,(_FATBF)
  EAE0  09            		ADD	HL,BC
  EAE1  C1            		POP	BC
  EAE2  C9            		RET
                      	
  EAE3                	GNCL16:
  EAE3  CD33EA        		CALL	NCL1		;GET NEXT CLUSTER for FAT16
  EAE6  D8            		RET	C
  EAE7  E5            		PUSH	HL
  EAE8  CDD5EA        		CALL	N16CL3
  EAEB  5E            		LD	E,(HL)
  EAEC  23            		INC	HL
  EAED  56            		LD	D,(HL)
  EAEE  E1            		POP	HL
  EAEF  C9            		RET
                      	
  EAF0                	SNCL16:
  EAF0  CD33EA        		CALL	NCL1		;GET NEXT CLUSTER for FAT16
  EAF3  D8            		RET	C
  EAF4  D5            		PUSH	DE
  EAF5  E5            		PUSH	HL
  EAF6  CDD5EA        		CALL	N16CL3
  EAF9  D1            		POP	DE		;HL
  EAFA  73            		LD	(HL),E
  EAFB  23            		INC	HL
  EAFC  72            		LD	(HL),D
  EAFD  6B            		LD	L,E
  EAFE  62            		LD	H,D
  EAFF  D1            		POP	DE
  EB00  18CD          		JR	FAT_CHANGED
                      	
                      	;------------------------
                      	;次のセクタを探す際に_SECPSの値をチェック
                      	;in
                      	;	DE : セクタ番号
                      	;out
                      	;	DE : 次のセクタ番号
                      	;note
                      	;
                      	;------------------------
  EB02                	NEXTX:
  EB02  3E00          	_SECPS:	LD	A,0	;自己書き換え
  EB04  3C            		INC	A
  EB05  E600          	NCPAT:	AND	0	;自己書き換え　1クラスタの論理セクタ数-1
  EB07  3203EB        		LD	(_SECPS+1),A
  EB0A  C9            		RET
                      	
  EB0B                	GNCLX:
  EB0B  CD02EB        		CALL	NEXTX
  EB0E  C0            		RET	NZ	;1クラスタのセクタ未満の場合は戻る
  EB0F  C3F7F0        		JP	_GNCL	;次のクラスタを探す
                      	
  EB12                	RDFAT:
  EB12  3E80          		LD	A,080H
  EB14  3270F0        		LD	(CHECK),A
  EB17                	RDFAT1:
  EB17  3A88F0        		LD	A,(_DRV)
  EB1A  CDD2ED        		CALL	CHGDRVR
  EB1D  D8            		RET	C
  EB1E  DD7E12        		LD	A,(IX+012H)	;DPB_12_DEVICE
  EB21  CB6F          		BIT	5,A
  EB23  286B          		JR	Z,RDFAT0X
  EB25  2170F0        		LD	HL,CHECK
  EB28  A6            		AND	(HL)
  EB29  77            		LD	(HL),A
  EB2A  110000        		LD	DE,0		;BPB
  EB2D  2A7CF1        		LD	HL,(_FATBF)
  EB30  CD89EC        		CALL	DRD16
  EB33  3024          		JR	NC,GETBPB
  EB35  2170F0        		LD	HL,CHECK
  EB38  CB06          		RLC	(HL)
  EB3A  3F            		CCF
  EB3B  D8            		RET	C
  EB3C  DDCB0A1E      		RR	(IX+00AH)	;DPB_0A_FDMODE
  EB40  3F            		CCF			;フロッピーディスクのFDモードを切り替える
  EB41  DDCB0A16      		RL	(IX+00AH)	;DPB_0A_FDMODE
  EB45  3EFF          		LD	A,0FFH
  EB47  3289F0        		LD	(_DSK),A
  EB4A  3A84F0        		LD	A,(_DRIVE)
  EB4D  E603          		AND	3
  EB4F  F680          		OR	080H
  EB51  6F            		LD	L,A
  EB52  26F0          		LD	H,_CYL0/256
  EB54  3EFF          		LD	A,0FFH
  EB56  77            		LD	(HL),A
  EB57  18BE          		JR	RDFAT1
  EB59                	GETBPB:
  EB59  FDE5          		PUSH	IY
  EB5B  FD2A7CF1      		LD	IY,(_FATBF)	;BPB
  EB5F  CDF1F0        		CALL	_BPB2DPB
  EB62  FDE1          		POP	IY
  EB64  DD7E12        		LD	A,(IX+012H)	;DPB_12_DEVICE
  EB67  3021          		JR	NC,GETBPBOK
  EB69  E60F          		AND	00FH
  EB6B  FE07          		CP	7
  EB6D  37            		SCF
  EB6E  C0            		RET	NZ
  EB6F  DDCB0A46      		BIT	0,(IX+00AH)	;DPB_0A_FDMODE
  EB73  21C0F1        		LD	HL,M2D
  EB76  2002          		JR	NZ,SETFDMODE
  EB78  2ED2          		LD	L,M2HD-STABLE
  EB7A                	SETFDMODE:
  EB7A  DDE5          		PUSH	IX
  EB7C  D1            		POP	DE
  EB7D  EDA0          		LDI
  EB7F  EDA0          		LDI
  EB81  13            		INC	DE
  EB82  13            		INC	DE
  EB83  13            		INC	DE
  EB84  13            		INC	DE
  EB85  010C00        		LD	BC,12
  EB88  EDB0          		LDIR
  EB8A                	GETBPBOK:
  EB8A  3299EB        		LD	(DEVSWC),A
  EB8D  CD31ED        		CALL	CHGDRV2
  EB90                	RDFAT0X:
  EB90  CD7DEC        		CALL	RDFATS
  EB93  D8            		RET	C
  EB94  DDAE06        		XOR	(IX+6)		;DPB_06_FATID
  EB97  C8            		RET	Z
  EB98  3E00          		LD	A,0		;DPB_12_DEVICE
  EB99                	DEVSWC	EQU	$-1
  EB9A  CB6F          		BIT	5,A
  EB9C  C0            		RET	NZ		;BPBを取得している場合はFATIDをチェックしない
  EB9D  37            		SCF
  EB9E  C9            		RET
                      	
  EB9F                	BPB2DPB:
  EB9F  FD7E0B        		LD	A,(IY+11)	;BPB_BytsPerSec
  EBA2  B7            		OR	A
  EBA3  37            		SCF
  EBA4  C0            		RET	NZ
  EBA5                	BPBOK:
  EBA5  FD7E0D        		LD	A,(IY+13)	;BPB_SecPerClus
  EBA8  DD7707        		LD	(IX+7),A	;DPB_07_SECPCL
                      	
  EBAB  FD7E16        		LD	A,(IY+22)	;BPB_FATSz16
  EBAE  DD7700        		LD	(IX+0),A	;DPB_00_FATLN
  EBB1  FD7E17        		LD	A,(IY+23)	;BPB_FATSz16
  EBB4  DD7701        		LD	(IX+1),A	;DPB_00_FATLN
                      	
  EBB7  FD6E0E        		LD	L,(IY+14)	;BPB_RsvdSecCnt
  EBBA  FD660F        		LD	H,(IY+15)
  EBBD  DD750E        		LD	(IX+00EH),L	;DPB_0E_FATPS
  EBC0  FD5E16        		LD	E,(IY+22)	;BPB_FATSz16
  EBC3  FD5617        		LD	D,(IY+23)
  EBC6  FD4610        		LD	B,(IY+16)	;BPB_NumFATs
  EBC9                	BPBDP1:				;BPB_FATSz16 * BPB_NumFATs
  EBC9  19            		ADD	HL,DE
  EBCA  10FD          		DJNZ	BPBDP1
  EBCC                	BPBDP2:
  EBCC  DD7510        		LD	(IX+010H),L	;DPB_10_DIRPS
  EBCF  DD7411        		LD	(IX+011H),H
  EBD2  E5            		PUSH	HL
                      	
  EBD3  FD6E11        		LD	L,(IY+17)	;BPB_RootEntCnt
  EBD6  FD6612        		LD	H,(IY+18)
  EBD9  FD7E0C        		LD	A,(IY+12)	;BPB_BytsPerSec
  EBDC  B7            		OR	A
  EBDD  37            		SCF
  EBDE  C8            		RET	Z
  EBDF  0606          		LD	B,6
  EBE1                	BPBBPS1:
  EBE1  05            		DEC	B
  EBE2  0F            		RRCA
  EBE3  30FC          		JR	NC,BPBBPS1
  EBE5                	BPBDE1:
  EBE5  29            		ADD	HL,HL
  EBE6  10FD          		DJNZ	BPBDE1
                      	
  EBE8  7C            		LD	A,H
  EBE9  DD770B        		LD	(IX+00BH),A	;DPB_0B_DIRSCNT
                      	
  EBEC  D1            		POP	DE		;DPB_10_DIRPS
  EBED  6C            		LD	L,H
  EBEE  2600          		LD	H,0
  EBF0  19            		ADD	HL,DE		;MAXDIR
  EBF1  E5            		PUSH	HL
  EBF2  FD4E0D        		LD	C,(IY+13)	;BPB_SecPerClus
  EBF5  CB21          		SLA	C		;*2
  EBF7  AF            		XOR	A
  EBF8  47            		LD	B,A
  EBF9  ED42          		SBC	HL,BC
  EBFB  DD7514        		LD	(IX+014H),L	;DPB_14_ADDCL16
  EBFE  DD7415        		LD	(IX+015H),H
                      	
  EC01  D1            		POP	DE		;DE=DPB_0B_MAXDIR
  EC02  FD6E13        		LD	L,(IY+19)	;BPB_TotSec16
  EC05  FD6614        		LD	H,(IY+20)
                      	
  EC08  DD7E12        		LD	A,(IX+012H)	;DPB_12_DEVICE
  EC0B  E60F          		AND	00FH
  EC0D  FE07          		CP	7		;フロッピー
  EC0F  2019          		JR	NZ,NOT_FD
  EC11  E5            		PUSH	HL
  EC12  FD4E18        		LD	C,(IY+24)	;BPB_SecPerTr
  EC15  DD710D        		LD	(IX+00DH),C	;DPB_0D_MAXSEC
  EC18  AF            		XOR	A
  EC19  CB21          		SLA	C		;両面なのでセクタ数を２倍
  EC1B  0610          		LD	B,16
  EC1D                	DIVSEC:				;MAXCYL = BPB_TotSec16 / (BPB_SecPerTr * 2)
  EC1D  29            		ADD	HL,HL
  EC1E  17            		RLA
  EC1F  B9            		CP	C
  EC20  3802          	   	JR	C,DIVSEC1
  EC22  91            	   	SUB	C
  EC23  2C            		INC	L
  EC24                	DIVSEC1:
  EC24  10F7          	 	DJNZ	DIVSEC
  EC26  DD750C        		LD	(IX+00CH),L	;DPB_0C_MAXCYL
  EC29  E1            		POP	HL	;ここまでフロッピー専用
  EC2A                	NOT_FD:
  EC2A  7C            		LD	A,H
  EC2B  B5            		OR	L
  EC2C  3E00          		LD	A,0		;LDでフラグは変化しない。BPB_TotSec16を AHL で扱う為、Aに0を入れる
  EC2E  2010          		JR	NZ,BPB16BIT	;BPB_TotSec16が「0」の場合はBPB_TotSec32で計算
  EC30  FD7E23        		LD	A,(IY+35)	;念のために総セクタ数が24ビットを超える場合はエラーを返す
  EC33  B7            		OR	A
  EC34  37            		SCF
  EC35  C0            		RET	NZ
  EC36  FD6E20        		LD	L,(IY+32)	;BPB_TotSec32 は AHL の24ビットで扱う
  EC39  FD6621        		LD	H,(IY+33)	;1クラスタの論理セクタ数(DPB_07_SECPCL)が最大128なので
  EC3C  FD7E22        		LD	A,(IY+34)	;24ビットを超えると必ずクラスタ数が16ビットを超えてしまうのでこれで十分
  EC3F  A7            		AND	A		;CF=0
  EC40                	BPB16BIT:
  EC40  ED52          		SBC	HL,DE
  EC42  DE00          		SBC	A,0
  EC44  FD460D        		LD	B,(IY+13)	;BPB_SecPerClus
  EC47                	BPBTC1:				;総クラスタ数(AHL) = 総セクタ数(AHL) / セクタサイズ(B)
  EC47  CB18          		RR	B		;->CY
  EC49  3808          		JR	C,BPBTC2
  EC4B  CB3F          		SRL	A
  EC4D  CB1C          		RR	H		;AHL=AHL/2
  EC4F  CB1D          		RR	L
  EC51  18F4          		JR	BPBTC1
  EC53                	BPBTC2:
  EC53  B7            		OR	A
  EC54  37            		SCF
  EC55  C0            		RET	NZ		;念のため(クラスタ数が16ビットを超える場合)
  EC56  23            		INC	HL
  EC57  23            		INC	HL
  EC58  DD7508        		LD	(IX+8),L	;DPB_08_MAXCL
  EC5B  DD7409        		LD	(IX+9),H
                      	
  EC5E  FD7E15        		LD	A,(IY+21)	;BPB_Media
  EC61  DD7706        		LD	(IX+6),A	;DPB_06_FATID
                      	
  EC64  FD7E10        		LD	A,(IY+16)	;BPB_NumFATs
  EC67  C6FE          		ADD	A,0-2		;>2:CF=1
  EC69  FD7E0C        		LD	A,(IY+12)	;BPB_BytsPerSec
  EC6C  6F            		LD	L,A
  EC6D  3002          		JR	NC,BPBFAT1
  EC6F  F680          		OR	080H
  EC71                	BPBFAT1:
  EC71  DD770F        		LD	(IX+00FH),A	;DPB_0F_BPS
  EC74  2D            		DEC	L		;以下のセクタサイズに合致しない場合はCF=1でエラーにする
  EC75  C8            		RET	Z		;1セクタ256バイト
  EC76  2D            		DEC	L
  EC77  C8            		RET	Z		;1セクタ512バイト
  EC78  2D            		DEC	L
  EC79  2D            		DEC	L
  EC7A  C8            		RET	Z		;1セクタ1024バイト
  EC7B  37            		SCF
  EC7C  C9            		RET
                      	
  EC7D                	RDFATS:
  EC7D  CDC3EC        		CALL	FATSETUP
  EC80  D8            		RET	C
  EC81  CD8DEC        		CALL	DRD24B
  EC84  2A7CF1        		LD	HL,(_FATBF)
  EC87  7E            		LD	A,(HL)
  EC88  C9            		RET
                      	
  EC89                	DRD16:
  EC89  0E00          		LD	C,0
  EC8B                	DRD24:
  EC8B  0601          		LD	B,1
  EC8D                	DRD24B:
  EC8D  DDE5          		PUSH	IX
  EC8F  DD2AA8F0      		LD	IX,(_DPB)
  EC93  CDEDEE        	DRDPAT:	CALL	FDRD		;自己書き換え（ディスク読み込み）
  EC96                	POP_IX_RET:
  EC96  DDE1          		POP	IX
  EC98  C9            		RET
                      	
  EC99                	DWT16:
  EC99  0E00          		LD	C,0
  EC9B                	DWT24:
  EC9B  0601          		LD	B,1
  EC9D                	DWT24B:
  EC9D  DDE5          		PUSH	IX
  EC9F  DD2AA8F0      		LD	IX,(_DPB)
  ECA3  CDDFEE        	DWTPAT:	CALL	FDWT		;自己書き換え（ディスク書き込み）
  ECA6  18EE          		JR	POP_IX_RET
                      	
  ECA8                	WTFAT:
  ECA8  CDC3EC        		CALL	FATSETUP
  ECAB  D49DEC        		CALL	NC,DWT24B
  ECAE  D8            		RET	C
  ECAF  DDCB0F7E      		BIT	7,(IX+00FH)	;DPB_0F_BPS
  ECB3  C8            		RET	Z		;予備FATが無い
  ECB4  CDCAEC        		CALL	FATS2
  ECB7  E5            		PUSH	HL		;予備FAT
  ECB8  DD6E00        		LD	L,(IX+0)	;DPB_00_FATLN
  ECBB  DD6601        		LD	H,(IX+1)
  ECBE  19            		ADD	HL,DE
  ECBF  EB            		EX	DE,HL
  ECC0  E1            		POP	HL
  ECC1  18DA          		JR	DWT24B
                      	;------------------------
                      	;FATのセットアップ
                      	;out
                      	;	B  : FATセクタ数
                      	;	DE : FAT先頭セクタ番号
                      	;	HL : FATバッファポインタ
                      	;	CF : 1=ドライブ切り替えエラー
                      	;note
                      	;	FATサイズがFATバッファを超える場合は
                      	;	対象クラスタ領域==(_FATIX)によって
                      	;	FAT12:対象クラスタ1024毎に1.5KBを切り替える
                      	;	FAT16:対象クラスタ1024毎に2KBを切り替える
                      	;------------------------
  ECC3                	FATSETUP:
  ECC3  3AAAF0        		LD	A,(_FATDRV)
  ECC6  CDD2ED        		CALL	CHGDRVR		;ドライブ切り替え
  ECC9  D8            		RET	C
  ECCA                	FATS2:
  ECCA  DD7E0F        		LD	A,(IX+00FH)	;DPB_0F_BPS 512=2 1024=4
  ECCD  0F            		RRCA
  ECCE  CDF7EC        	FATSX:	CALL	FATSETUP12	;自己書き換え
  ECD1  210000        		LD	HL,0
  ECD4  4A            		LD	C,D
  ECD5  54            		LD	D,H
  ECD6  3AABF0        		LD	A,(_FATIX)	;範囲FAT12:0-3/FAT16:0-63(0-03FH):65535*2/2048
  ECD9  47            		LD	B,A
  ECDA  04            		INC	B
  ECDB  DD7E00        		LD	A,(IX+0)	;DPB_00_FATLN
  ECDE                	FAT_SKP:
  ECDE  05            		DEC	B
  ECDF  2805          		JR	Z,FAT1
  ECE1  19            		ADD	HL,DE
  ECE2  93            		SUB	E
  ECE3  30F9          		JR	NC,FAT_SKP
  ECE5  C9            		RET
  ECE6                	FAT1:
  ECE6  EB            		EX	DE,HL
  ECE7  B9            		CP	C		;C=FATバッファに読み込めるセクタ数
  ECE8  3801          		JR	C,FAT2
  ECEA  79            		LD	A,C
  ECEB                	FAT2:
  ECEB  47            		LD	B,A
                      	
  ECEC  2AFAF1        		LD	HL,(_FATPS)	;fat sector pos
  ECEF  19            		ADD	HL,DE
  ECF0  EB            		EX	DE,HL
  ECF1  2A7CF1        		LD	HL,(_FATBF)
  ECF4  AF            		XOR	A		;CF=0
  ECF5  4F            		LD	C,A
  ECF6  C9            		RET
                      	;
                      	;	FATバッファに読み込める最大のセクタ数と_FATIXで進めるセクタ数
                      	;	FATSETUP* (FAT12/FAT16)
                      	;out
                      	;	D : FATバッファに読み込める最大のセクタ数
                      	;	E : _FATIXで進めるセクタ数
  ECF7                	FATSETUP12:
  ECF7  110606        		LD	DE,0606H	;256
  ECFA  D8            		RET	C
  ECFB  110303        		LD	DE,0303H	;512
  ECFE  0F            		RRCA
  ECFF  D8            		RET	C
  ED00  110102        		LD	DE,0201H	;1024
  ED03  C9            		RET
                      	
  ED04                	FATSETUP16:
  ED04  110808        		LD	DE,0808H	;256
  ED07  D8            		RET	C
  ED08  110404        		LD	DE,0404H
  ED0B  0F            		RRCA			;512
  ED0C  D8            		RET	C
  ED0D  110202        		LD	DE,0202H	;1024
  ED10  C9            		RET
                      	
  ED11                	CHGDRV:
  ED11  E5            		PUSH	HL
  ED12  2189F0        		LD	HL,_DSK
  ED15  BE            		CP	(HL)
  ED16  280A          		JR	Z,CHGDRVE
  ED18                	CHGDRV1:
  ED18  DDE5          		PUSH	IX
  ED1A  CD24ED        		CALL	CHGDRV0
  ED1D  3A89F0        		LD	A,(_DSK)
  ED20  DDE1          		POP	IX
  ED22                	CHGDRVE:
  ED22  E1            		POP	HL
  ED23  C9            		RET
                      	
  ED24                	CHGDRV0:
  ED24  6F            		LD	L,A
  ED25  CDDCF0        		CALL	_GETDPB
  ED28  D8            		RET	C
  ED29  DD22A8F0      		LD	(_DPB),IX
  ED2D  7D            		LD	A,L
  ED2E  3289F0        		LD	(_DSK),A
  ED31                	CHGDRV2:
  ED31  C5            		PUSH	BC
  ED32  D5            		PUSH	DE
  ED33  ED7388ED      		LD	(SPPAT2+1),SP
  ED37  F3            		DI
  ED38  DDF9          		LD	SP,IX
                      	
  ED3A  E1            		POP	HL		;DPB_00_FATLN
  ED3B  E1            		POP	HL		;DPB_02_DRD
  ED3C  2294EC        		LD	(DRDPAT+1),HL
                      	
  ED3F  E1            		POP	HL
  ED40  22A4EC        		LD	(DWTPAT+1),HL	;DPB_04_DWT
                      	
  ED43  E1            		POP	HL		;L=DPB_06_FATID H=DPB_07_SECPCL
  ED44  7C            		LD	A,H
  ED45  3276E3        		LD	(SPCPAT+1),A	;1クラスタの論理セクタ数
  ED48  3D            		DEC	A
  ED49  3206EB        		LD	(NCPAT+1),A
                      	
  ED4C  E1            		POP	HL		;DPB_08_MAXCL
  ED4D  7D            		LD	A,L
  ED4E  3295E3        		LD	(CLPAT2+1),A
  ED51  7C            		LD	A,H
  ED52  3291E3        		LD	(CLPAT1+1),A
  ED55  2B            		DEC	HL
  ED56  2299E5        		LD	(MAXCLP+1),HL
                      	
  ED59  E1            		POP	HL		;L=DPB_0A_FDMODE H=DPB_0B_DIRSCNT
  ED5A  7D            		LD	A,L
  ED5B  F6FE          		OR	0FEH
  ED5D  3288EE        		LD	(FDMODE+1),A
  ED60  07            		RLCA
  ED61  E603          		AND	3
  ED63  3270EE        		LD	(FSPAT+1),A
  ED66  4C            		LD	C,H
                      	
  ED67  E1            		POP	HL		;L=DPB_0C_MAXCYL H=DPB_0D_MAXSEC
                      	
  ED68  E1            		POP	HL		;L=DPB_0E_FATPS H=DPB_0F_BPS
  ED69  7C            		LD	A,H		;DPB_0F_BPS
  ED6A  E607          		AND	7
  ED6C  3294E8        		LD	(SECSZ+2),A	;1セクタのサイズの上位1バイト 0x400 - 0x200 - 0x100
                      					;1セクタ512 2D/2DD/2HC/2HQ(2HD1.44MB)/EMM/BRAM/EMEM等
                      					;1セクタ1024 2HD/2HDE98
                      					;1セクタ256 GRAM/RAMF/CMOS/等
                      					;1024	512	256
                      					;4	2	1
  ED6F  87            		ADD	A,A		;8	4	2
  ED70  87            		ADD	A,A		;010H	8	4
  ED71  87            		ADD	A,A		;020H	010H	8
  ED72  32F2E1        		LD	(SDECPAT+1),A	;1セクタ辺りのディレクトリエントリ数
                      	
  ED75  2600          		LD	H,0
  ED77  22FAF1        		LD	(_FATPS),HL
                      	
  ED7A  E1            		POP	HL		;DPB_10_DIRPS
  ED7B  22FCF1        		LD	(_DIRPS),HL
                      	
  ED7E  E1            		POP	HL		;L=DPB_12_DEVICE H=DPB_13_UNITNO
  ED7F  7C            		LD	A,H
  ED80  3284F0        		LD	(_DRIVE),A
                      	
  ED83  E1            		POP	HL		;DPB_14_ADDCL16
  ED84  2286E3        		LD	(CLSPAT+1),HL
                      	
  ED87  310000        	SPPAT2:	LD	SP,0		;元のSPを復元
  ED8A  FB            		EI
  ED8B  2AFCF1        		LD	HL,(_DIRPS)
  ED8E  0600          		LD	B,0
  ED90  09            		ADD	HL,BC		;C=DPB_0B_DIRSCNT
  ED91  220DE2        		LD	(MD_PAT+1),HL
                      	
  ED94  2A99E5        		LD	HL,(MAXCLP+1);
  ED97  11F60F        		LD	DE,4086		;クラスタ数が4086未満:FAT12 4086以上:FAT16
  ED9A  ED52          		SBC	HL,DE		;CF=0のはず
  ED9C  300F          		JR	NC,SETFAT16
  ED9E  218CEA        		LD	HL,GNCL		;FAT12
  EDA1  11AFEA        		LD	DE,SNCL
  EDA4  01F7EC        		LD	BC,FATSETUP12
  EDA7  DDCB0FAE      		RES	5,(IX+00FH)	;DPB_0F_BPS(FAT12)
  EDAB  180D          		JR	EXTRA1
  EDAD                	SETFAT16:
  EDAD  21E3EA        		LD	HL,GNCL16	;FAT16
  EDB0  11F0EA        		LD	DE,SNCL16
  EDB3  0104ED        		LD	BC,FATSETUP16
  EDB6  DDCB0FEE      		SET	5,(IX+00FH)	;DPB_0F_BPS(FAT16)
  EDBA                	EXTRA1:
  EDBA  22F8F0        		LD	(GNCPAT+1),HL
  EDBD  ED53FBF0      		LD	(SNCPAT+1),DE
  EDC1  ED43CFEC      		LD	(FATSX+1),BC
  EDC5  D1            		POP	DE
  EDC6  C1            		POP	BC
  EDC7  AF            		XOR	A
  EDC8  C9            		RET
                      	
  EDC9                	GETDPBD:
  EDC9  DDE3          		EX	(SP),IX
  EDCB  DDE5          		PUSH	IX
  EDCD  3A88F0        		LD	A,(_DRV)
  EDD0  1807          		JR	GETDPB1
                      	
  EDD2                	CHGDRVR:
  EDD2  CDD9F0        		CALL	_CHGDRV
  EDD5  D8            		RET	C
  EDD6  3A89F0        		LD	A,(_DSK)
  EDD9                	GETDPB1:
  EDD9  C3DCF0        		JP	_GETDPB
                      	
  EDDC                	GETDPB:
  EDDC  FE08          		CP	8
  EDDE  3F            		CCF
  EDDF  D8            		RET	C
  EDE0  0F            		RRCA
  EDE1  0F            		RRCA
  EDE2  0F            		RRCA
  EDE3  DD            		DB	0DDH		;Z80未定義命令
  EDE4  6F            		LD	L,A		;LD	IXL,A
  EDE5  DD            		DB	0DDH		;Z80未定義命令
  EDE6  26F2          		LD	H,DEVICE/256	;LD	IXH,DEVICE/256
  EDE8  DD7E00        		LD	A,(IX+0)	;DPB_00_FATLN
  EDEB  A7            		AND	A		;CF=0の為
  EDEC  DDCB0F6E      		BIT	5,(IX+00FH)	;DPB_0F_BPS
  EDF0  C0            		RET	NZ		;FAT16
  EDF1  DDCB126E      		BIT	5,(IX+012H)	;DPB_12_DEVICE
  EDF5  C0            		RET	NZ		;BPB
  EDF6  FE01          		CP	001H		;A=0 THEN CF=1
  EDF8  C9            		RET
                      	
  EDF9                	_SYS5F:
  EDF9  AF            		XOR	A
  EDFA                	FFLUSH:
  EDFA  F5            		PUSH	AF
  EDFB  3EFF          		LD	A,0FFH
  EDFD  3239F0        		LD	(SFILE),A
  EE00  CDCAE9        		CALL	DWTX
  EE03  3EFF          		LD	A,0FFH
  EE05  32A5F0        		LD	(_DBDRV),A
  EE08  CD14EA        		CALL	WTFATX
  EE0B  AF            		XOR	A
  EE0C  32ABF0        		LD	(_FATIX),A
  EE0F  2F            		CPL			;0FFH
  EE10  32AAF0        		LD	(_FATDRV),A
  EE13  F1            		POP	AF
  EE14  C9            		RET
                      	
                      	
                      	;X1DISK.ASM
                      	
                      	;	LSX-Dodgers DISK
                      	;	X1/turbo/Z
                      	
  EE15                	SEEK:
  EE15  0610          		LD	B,16
  EE17  DD4E0D        		LD	C,(IX+0DH)	;DPB_0D_MAXSEC
  EE1A  AF            		XOR	A
  EE1B  EB            		EX	DE,HL
  EE1C                	DIV1:
  EE1C  29            		ADD	HL,HL
  EE1D  8F            		ADC	A,A
  EE1E  B9            		CP	C
  EE1F  3802          		JR	C,DIV2
  EE21  91            		SUB	C
  EE22  2C            		INC	L
  EE23                	DIV2:
  EE23  10F7          		DJNZ	DIV1
                      	
  EE25  3C            		INC	A	;最小のセクタは１固定
  EE26  55            		LD	D,L	;TRACK
  EE27  5F            		LD	E,A	;SECTOR
  EE28  CB3A          		SRL	D	;CYLINDER
  EE2A  9F            		SBC	A,A
  EE2B  E610          		AND	010H	;SIDE
  EE2D  4F            		LD	C,A
                      	
  EE2E  3A84F0        		LD	A,(_DRIVE)
  EE31  FE04          		CP	4
  EE33  3F            		CCF
  EE34  D8            		RET	C
  EE35  B1            		OR	C
  EE36  32B4EE        		LD	(MOPAT+1),A	;Motor off data
  EE39  01FC0F        		LD	BC,00FFCH
  EE3C  F680          		OR	080H		;Motor on
  EE3E  ED79          		OUT	(C),A
                      	
  EE40  CD86EE        		CALL	SETMODE
  EE43  D8            		RET	C
                      	
  EE44  CDC9EE        		CALL	DRIVE
  EE47  FEFF          		CP	0FFH		;A=0FFH Unknown CYLINDER
  EE49  CCA8EE        		CALL	Z,FDCRES	;Restore
  EE4C  0EF9          		LD	C,0F9H
  EE4E  ED79          		OUT	(C),A		;Currrent CYLINDER
  EE50  92            		SUB	D
  EE51  C8            		RET	Z		;No seek
                      	
  EE52  3A86F0        		LD	A,(_ISEEK)
  EE55  4F            		LD	C,A
                      	
  EE56  DD7E0C        		LD	A,(IX+00CH)	;DPB_0C_MAXCYL
  EE59  3D            		DEC	A
  EE5A  BA            		CP	D		;Over CYLINDER
  EE5B  D8            		RET	C
                      	
  EE5C  B9            		CP	C		;for Built-in 2DD
  EE5D  3803          		JR	C,SETM2
  EE5F  78            		LD	A,B		;B=00FH
  EE60  DBFE          		IN	A,(0FEH)		;2HD mode for 2DD seek
  EE62                	SETM2:
  EE62  78            		LD	A,B
  EE63  DBFD          		IN	A,(0FDH)		;MFM mode
                      	
  EE65  0EFB          		LD	C,0FBH
  EE67  ED51          		OUT	(C),D
  EE69  72            		LD	(HL),D
  EE6A  0E18          		LD	C,018H		;Seek
  EE6C                	FDCCMD2:
  EE6C  3A85F0        		LD	A,(_SEEKSP)
  EE6F  E6FF          	FSPAT:	AND	0FFH
  EE71  B1            		OR	C
                      	
  EE72                	FDCCMD:
  EE72  CDBFEE        		CALL	COMSET
                      	
  EE75  3E80          	FDCPAT:	LD	A,080H		;FDC COMMAND(Self-modifying code)
  EE77  E620          		AND	020H		;Write data Write track
  EE79  3C            		INC	A
                      	
  EE7A                	SST:
  EE7A  0E00          		LD	C,0
  EE7C                	SST1:
  EE7C  0D            		DEC	C		; 4
  EE7D  20FD          		JR	NZ,SST1		;12 * 256 / 4 = About 1ms
  EE7F  3D            		DEC	A
  EE80  20FA          		JR	NZ,SST1
                      	
  EE82  3C            		INC	A		;A=1
  EE83  CD91EE        		CALL	READY
  EE86                	SETMODE:
  EE86  78            		LD	A,B		;B=00FH
  EE87  DBFF          	FDMODE:	IN	A,(0FFH)	;Floppy mode(2D/2HD) (Self-modifying code)
                      	
  EE89  78            		LD	A,B
  EE8A  DBFD          		IN	A,(0FDH)	;MFM mode
                      	
  EE8C  CDC3EE        		CALL	DELAY0		;Head select time
  EE8F  3E81          		LD	A,081H
  EE91                	READY:
  EE91  329BEE        		LD	(WAITA+1),A
  EE94  E5            		PUSH	HL
  EE95  0EF8          		LD	C,0F8H
  EE97  61            		LD	H,C
  EE98                	READY2:
  EE98  ED78          		IN	A,(C)
  EE9A  E681          	WAITA:	AND	081H		;NOT READY,BUSY
  EE9C  2808          		JR	Z,READYE
  EE9E  E3            		EX	(SP),HL		;wait 19clock
  EE9F  E3            		EX	(SP),HL		; //
  EEA0  2B            		DEC	HL
  EEA1  7C            		LD	A,H
  EEA2  B5            		OR	L
  EEA3  20F3          		JR	NZ,READY2
  EEA5  37            		SCF
  EEA6                	READYE:
  EEA6  E1            		POP	HL
  EEA7  C9            		RET
                      	
  EEA8                	FDCRES:
  EEA8  3600          		LD	(HL),0
  EEAA  0E08          		LD	C,8
  EEAC  18BE          		JR	FDCCMD2
                      	
  EEAE                	FDMOFF:
  EEAE  F5            		PUSH	AF
  EEAF  C5            		PUSH	BC
  EEB0  01FC0F        		LD	BC,00FFCH	;Motor off
  EEB3  3E00          	MOPAT:	LD	A,000H		;(Self-rewriting)
  EEB5  ED79          		OUT	(C),A
  EEB7  C1            		POP	BC
  EEB8  F1            		POP	AF
  EEB9  C9            		RET
                      	
  EEBA                	SECSET:
  EEBA  01FA0F        		LD	BC,00FFAH
  EEBD  ED59          		OUT	(C),E
  EEBF                	COMSET:
  EEBF  0EF8          		LD	C,0F8H
  EEC1  ED79          		OUT	(C),A
  EEC3                	DELAY0:
  EEC3  3E1A          		LD	A,26
  EEC5                	DELAY:
  EEC5  3D            		DEC	A
  EEC6  20FD          		JR	NZ,DELAY
  EEC8  C9            		RET
                      	
  EEC9                	DRIVE:
  EEC9  2A84F0        		LD	HL,(_DRIVE)
  EECC  26F0          		LD	H,_CYL0/256
  EECE  CBFD          		SET	7,L
  EED0  7E            		LD	A,(HL)
  EED1  C9            		RET
                      	
  EED2                	RNF:
  EED2  CDC9EE        		CALL	DRIVE
  EED5  36FF          		LD	(HL),0FFH
  EED7  C9            		RET
                      	
  EED8  02            	RETRY:	DB	2
                      	
                      	
                      	;	FLOPPY DISK DRIVER(DMA)
                      	
                      	
  EED9                	WTTRK:
  EED9  0601          		LD	B,1
  EEDB  3EF4          		LD	A,0F4H
  EEDD  1802          		JR	WTTRK1
  EEDF                	FDWT:
  EEDF  3EA0          		LD	A,0A0H
  EEE1                	WTTRK1:
  EEE1  3276EE        		LD	(FDCPAT+1),A
  EEE4  3E10          		LD	A,16
  EEE6  180C          		JR	DISK
                      	
  EEE8                	DISKOK:
  EEE8  0601          	FDCNT:	LD	B,1
  EEEA  100B          		DJNZ	DISK1
  EEEC  C9            		RET
                      	
  EEED                	FDRD:
  EEED  3E80          		LD	A,080H
  EEEF  3276EE        		LD	(FDCPAT+1),A
  EEF2  3E0E          		LD	A,14
                      	
  EEF4                	DISK:
  EEF4  320BEF        		LD	(DMAPAT+1),A
  EEF7                	DISK1:
  EEF7  78            		LD	A,B
  EEF8  32E9EE        		LD	(FDCNT+1),A
  EEFB  2263EF        		LD	(DMAD+11),HL
  EEFE                	DISKR:
  EEFE  3E02          		LD	A,2		;Retry count
  EF00  32D8EE        		LD	(RETRY),A
  EF03                	DISK2:
  EF03  D5            		PUSH	DE
  EF04  CD15EE        		CALL	SEEK
  EF07  3843          		JR	C,ERRF
  EF09  F3            		DI
                      	
  EF0A  3E0E          	DMAPAT:	LD	A,14		;自己書き換え
  EF0C  2158EF        		LD	HL,DMAD
  EF0F  CD93DF        		CALL	SETDMA
  EF12  ED49          		OUT	(C),C		;OUT 01F87H,087H WR6 イネーブル
  EF14  3A76EE        		LD	A,(FDCPAT+1)
  EF17  C5            		PUSH	BC
  EF18  CDBAEE        		CALL	SECSET
  EF1B  2A63EF        		LD	HL,(DMAHL)
  EF1E  23            		INC	HL
  EF1F  1106BB        		LD	DE,0BB06H	;READ DMA
                      	
  EF22  3E03          		LD	A,3
  EF24  CD91EE        		CALL	READY
  EF27  ED78          		IN	A,(C)
                      	
  EF29  C1            		POP	BC
  EF2A  ED51          		OUT	(C),D		;読み出しマスク設定
  EF2C  ED59          		OUT	(C),E		;バイトカウンタ(LH)
  EF2E  ED58          		IN	E,(C)
  EF30  ED50          		IN	D,(C)
  EF32  19            		ADD	HL,DE
  EF33  D1            		POP	DE
  EF34  13            		INC	DE
  EF35  FB            		EI
  EF36  CDAEEE        		CALL	FDMOFF
  EF39  B7            		OR	A
  EF3A  28AC          		JR	Z,DISKOK
  EF3C  1B            		DEC	DE
  EF3D  CB67          		BIT	4,A
  EF3F  C4D2EE        		CALL	NZ,RNF
  EF42                	DISKE2:
  EF42  21D8EE        		LD	HL,RETRY
  EF45  35            		DEC	(HL)
  EF46  20BB          		JR	NZ,DISK2
  EF48  B7            		OR	A
  EF49  280A          		JR	Z,ERR
  EF4B  D5            		PUSH	DE
  EF4C                	ERRF:
  EF4C  D1            		POP	DE
  EF4D                	DELP:
  EF4D  CDD2EE        		CALL	RNF
  EF50  CDAEEE        		CALL	FDMOFF
  EF53  3EFF          		LD	A,0FFH
  EF55                	ERR:
  EF55  BF            		CP	A
  EF56  37            		SCF
  EF57  C9            		RET
                      	
                      				;X1turbo DISK DMA
  EF58  C3            	DMAD:	DB	0C3H	;WR6 リセット
  EF59  7D            		DB	07DH	;WR0 ポートA→ポートB 転送
  EF5A  FB0F          		DW	00FFBH	;ポートA開始アドレス FDC データレジスタ
  EF5C  FFFF          		DW	0FFFFH	;ブロック長(転送サイズ-1)
  EF5E  2C            		DB	02CH	;WR1 ポートAアドレス固定 I/O
  EF5F  10            		DB	010H	;WR2 ポートBインクリメント
  EF60  80            		DB	080H	;WR3
  EF61  92            		DB	092H	;WR5 WAIT RDY:LOW
  EF62  8D            		DB	08DH	;WR4 バイト ポートB開始アドレス(LH)
  EF63  0000          	DMAHL:	DW	0	;ポートB開始アドレス
  EF65  CF            		DB	0CFH	;WR6 ロード
  EF66  01            		DB	001H	;WR0 ポートB←ポートB 転送
  EF67  CF            		DB	0CFH	;WR6 ロード
                      	
  EF68                	DMAE:
                      	
  1E38                	AT_R	EQU	WTTRK-AT_DWT
  EF68                	AT_TABLE:
                      	
                      	;LDCCPWK.ASM
                      	
                      	;	LSX-Dodgers CCP WORK
                      	
  0040                	PATHX	EQU	64
  EF68                	PATHD:	DS	PATHX
  EFA8  00            	PATHE:	DB	0
                      	
  EFA9                	DTA_CCP:
  EFA9                		DS	37
                      	
  EFCE                	FCB_BAT:
  EFCE                		DS	37
                      	
                      	
  EFF3  20627974657320	FREE:	DB	" bytes free",9,'$'
                      	
                      	;LDWORK.ASM
                      	
                      	;	LSX-Dodgers WORK0
                      	;
                      	;	CP/M互換BIOS
                      	;	BOOT:アドレス下位1バイトが0になるように
  F000                	AT_WORK:
  F000                		DS	WORKAD-AT_WORK
                      	
  F000                	CPM_BOOT:
  F000  C30000        		JP	0
  F003                	_SYS00:		;(BDOS)プログラム終了
  F003                	CPM_WBOOT:
  F003  C309D2        		JP	WBOOT1
  F006                	CPM_CONST:
  F006  C341DC        		JP	CONSTX
  F009                	_SYS07:		;(BDOS)コンソール直接入力
  F009                	CPM_CONIN:
  F009  C3E8DB        		JP	FLGET
  F00C                	CPM_CONOUT:
  F00C  C386DE        		JP	CONOUT1
                      	
  F00F                	DECBF:
  F00F                		DS	5
  F014  00            	FDRV	DB	0
  F015                	FNAME	DS	36
  F039                	SFILE:	DS	33		;DRV FILENAME
  F05A                	HLBUF:	DS	3		;Random record buffer
                      	
  F05D  0000          	LEFTX:	DW	0
  F05F  0000          	DTAX:	DW	0
                      	
  F061                	ZERO:
  F061                	BEEPD:
  F061  008E01000B000C		DB	0,08EH,1,0,00BH,0,00CH,010H
  F069  073E08100D00FF		DB	007H,03EH,008H,010H,00DH,0,0FFH
  F062                	RTC_YY	EQU	BEEPD+1
  F063                	RTC_MW	EQU	BEEPD+2
  F064                	RTC_DD	EQU	BEEPD+3
  F065                	RTC_TT	EQU	BEEPD+4
  F066                	RTC_MM	EQU	BEEPD+5
  F067                	RTC_SS	EQU	BEEPD+6
                      	
  F070  00            	CHECK:	DB	0
                      	
  F071  4F4B24        	OK:	DB	"OK$"
  F074                		DS	5
  F079  4572726F722124	COMERM:	DB	"Error!$"
                      	;	システムワークエリア
                      	;	_CYL0:アドレス下位1バイトが080Hになるように
  F080  FF            	_CYL0:	DB	0FFH	;Cylinder
  F081  FF            	_CYL1:	DB	0FFH	;Cylinder
  F082  FF            	_CYL2:	DB	0FFH	;Cylinder
  F083  FF            	_CYL3:	DB	0FFH	;Cylinder
  F084  00            	_DRIVE:	DB	0	;unit number
  F085  00            	_SEEKSP:DB	0	;Seek speed
  F086  FF            	_ISEEK:	DB	0FFH	;
  F087  00            	_DVSW:	DB	0
  F088  00            	_DRV:	DB	0
  F089  FF            	_DSK:	DB	0FFH
  F08A  8000          	_DTA:	DW	00080H
  F08C  0000          	_CTC:	DW	0
  F08E  0000          	_TXADR:	DW	0
  F090  0000          	_KEYPS:	DW	0
  F092  00FF          	_KEYD:	DW	0FF00H	;キーデータ
  F094  C210          	_KEYSP:	DB	KEYSP_L,KEYSP_H	;オートリピートの速度
  F096  07            	_COLORF:DB	COLORF	;色
  F097  18            	_LINE:	DB	LINE
                      	
  F098  0000          	_FCB:	DW	0	;SEARCH FILES
  F09A  0000          	_FBPS:	DW	0	;    //
  F09C  0000          	_FBAD:	DW	0	;    //
  F09E  00            	_FBCNT:	DB	0	;    //
  F09F  00            	_FILEN:	DB	0	;    //
  F0A0  00            	_DIRF:	DB	0	;bit7:ディレクトリ bit0-6:セクタインデックス
  F0A1                		DS	1
  F0A2  00            	_WTFATF:DB	0	;FATバッファの更新フラグ
  F0A3                		DS	1
  F0A4  00            	_WTDBF:	DB	0	;データバッファの更新フラグ
  F0A5  FF            	_DBDRV:	DB	0FFH	;データバッファにあるデータを読み込んだドライブ
  F0A6  0000          	_DBSEC:	DW	0	;データバッファにあるデータを読み込んだセクタ番号
  F0A8  0000          	_DPB:	DW	0
  F0AA                	_FATDRV:
  F0AA  FF            		DB	0FFH	;FATバッファに読み込んでいるドライブ
  F0AB  00            	_FATIX:	DB	0	;FATバッファに読み込んでいるインデックス
  F0AC                	_FAKEFREE:
  F0AC  0000          		DW	0	;偽の残量（FATサイズが大きくなると重くなるのでその対策）
                      	
  F0AE                		DS	2
                      	
  F0B0                	CRTCD:
  F0B0  6F            		DB	06FH
  F0B1                	_WIDTH:
  F0B1  50            		DB	WIDTH
  F0B2                	TVRAMTOP:
  F0B2  5938          		DB	059H,038H
  F0B4  1F02          		DB	01FH,002H
  F0B6                	_LINE2:
  F0B6  19            		DB	019H
  F0B7                	WKE4:
  F0B7  1C            		DB	01CH
  F0B8                	WKE6:
  F0B8  00            		DB	000H
  F0B9                	WK40:
  F0B9  07            		DB	007H
  F0BA                	_PAGE_MINUS:
  F0BA  80F8          		DW	0-WIDTH*LINE
  F0BC                	_WIDTH_MINUS:
  F0BC  B0FF          		DW	0-WIDTH
  F0BE                	WK30:
  F0BE  0C            		DB	00CH
  F0BF                	WK31:
  F0BF                	WK1FD0:
  F0BF  20            		DB	020H
                      	
  F0C0  2FDB          	CTC0:	DW	INTCTCE
  F0C2  2FDB          	CTC1:	DW	INTCTCE
  F0C4  32DB          	CTC2:	DW	INTCTC2
  F0C6  2FDB          	CTC3:	DW	INTCTCE
  F0C8  1BDB          	INTVEC:	DW	INT
                      	
                      	;	LSX-Dodgers 独自BIOS
                      	
  F0CA  C369E0        	_INKEY:	JP	INKEY
  F0CD  C321DD        	_PRINT:	JP	PRINT
  F0D0  C3D1DF        	_SCRN:	JP	SCRN
  F0D3  C3FBDF        	_POS:	JP	POS
  F0D6  C34FDE        	_LOC:	JP	LOC
  F0D9                	_CHGDRV:
  F0D9  C311ED        		JP	CHGDRV
  F0DC                	_GETDPB:
  F0DC  C3DCED        		JP	GETDPB
  F0DF                	_FFLUSH:
  F0DF  C3FAED        		JP	FFLUSH
  F0E2                	_RDFATX:
  F0E2  C3EAE9        		JP	RDFATX
  F0E5  C312EB        	_RDFAT:	JP	RDFAT
  F0E8  C3D9EE        	_WTTRK:	JP	WTTRK
  F0EB  C3EDEE        	_FDRD:	JP	FDRD
  F0EE  C3DFEE        	_FDWT:	JP	FDWT
  F0F1                	_BPB2DPB:
  F0F1  C39FEB        		JP	BPB2DPB
  F0F4                	_BREAK:
  F0F4  C3C2D3        		JP	END_BATCH
  F0F7                	_GNCL:
  F0F7  C38CEA        	GNCPAT:	JP	GNCL		; self-modifying code
  F0FA                	_SNCL:
  F0FA  C3AFEA        	SNCPAT:	JP	SNCL		; self-modifying code
  F0FD  C37CD2        	_COMANL:JP	COMANL
                      	
  F100                	_WE:
                      	
                      	;LDCALL.ASM
                      	
                      	;	LSX-Dodgers システムコール(BDOS)
                      	;
                      	;	LSX-Dodgers SYSTEM CALL
                      	;	STABLE:アドレス下位1バイトが0になるように
                      	
  F100                	STABLE:
                      	;0
  F100  03F0BBDBC7DB1F		DW	_SYS00,_SYS01,_SYS02,_SYS03
  F108  5FD85FD8CCDB09		DW	_SYS04,_SYS05,_SYS06,_SYS07
  F110  D4DB61D80DDC39		DW	_SYS08,_SYS09,_SYS0A,_SYS0B
  F118  76D87BD88AD89B		DW	_SYS0C,_SYS0D,_SYS0E,_SYS0F
                      	;1
  F120  EFD836D97FD9B5		DW	_SYS10,_SYS11,_SYS12,_SYS13
  F128  BDD9D3D9E8D9E0		DW	_SYS14,_SYS15,_SYS16,_SYS17
  F130  2FDA34DA39DA3F		DW	_SYS18,_SYS19,_SYS1A,_SYS1B
  F138  5FD865DA5FD869		DW	_SYS1C,_SYS1D,_SYS1E,_SYS1F
                      	;2
  F140  5FD81FDA27DA70		DW	_SYS20,_SYS21,_SYS22,_SYS23
  F148  96DA5FD8A7E68C		DW	_SYS24,_ERROR,_SYS26,_SYS27
  F150  27DA9FDA4FDC1F		DW	_SYS28,_SYS29,_SYS2A,_SYS2B
  F158  72DC1FE25FD8C2		DW	_SYS2C,_SYS2D,_SYS2E,_SYS2F
                      	;3
  F160  BCDA5FD85FD85F		DW	_SYS30,_ERROR,_ERROR,_ERROR
  F168  5FD85FD85FD85F		DW	_ERROR,_ERROR,_ERROR,_ERROR
  F170  5FD81FE21FE2E3		DW	_ERROR,_SYS39,_SYS3A,_SYS5A
                      	;DOS2
  F178  42D8          		DW	_DOS2
                      	
  F17A                		DS	2
  F17C  00F3          	_FATBF:	DW	FATBF
  F17E  00FB          	_DTBUF:	DW	DTBUF
                      	
                      	;	コントロールコードテーブル
                      	;	CTRLTB:アドレス下位1バイトが080Hになるように
                      	
  F180                	CTRLTB:
  F180  C4DDC4DD00DE45		DW	CTRL00,CTRL00,CTRL02,CTRL03	;  A,B,C
  F188  3FDF24DE1EDFA7		DW	CTRL04,CTRL05,CTRL06,CTRL07	;D,E,F,G
  F190  D0DDF1DD48DF65		DW	CTRL08,CTRL09,CTRL0A,CTRL0B	;H,I,J,K
  F198  1BDF4ADE5DDFC4		DW	CTRL0C,CTRL0D,CTRL0E,CTRL00	;L,M,N,O
  F1A0  C4DDC4DD5DDEC4		DW	CTRL00,CTRL00,CTRL12,CTRL00	;P,Q,R,S
  F1A8  C4DDC4DDC4DDC4		DW	CTRL00,CTRL00,CTRL00,CTRL00	;T,U,V,W
  F1B0  C4DDC4DD1BDF6C		DW	CTRL00,CTRL00,CTRL0C,CTRL1B	;X,Y,Z,ESC
  F1B8  EBDDD7DDE0DD48		DW	CTRL1C,CTRL1D,CTRL1E,CTRL1F	;→,←,↑,↓
                      	
  F1C0  0200          	M2D:	DW	2
  F1C2  FD02          		DB	0FDH,2
  F1C4  6401          		DW	356
  F1C6  FF0728090182  		DB	0FFH,7,40,9,1,082H
  F1CC  0500A7000800  		DW	5,0A7H,8
                      	
  F1D2  0200          	M2HD:	DW	2
  F1D4  FE01          		DB	0FEH,1
  F1D6  C704          		DW	1223
  F1D8  FE064D080184  		DB	0FEH,6,77,8,1,084H
  F1DE  0500A7000900  		DW	5,0A7H,9
                      	
  F1E4                		DS	6
                      	
  F1EA  1617          	SDDATA:	DB	22,23		;(FCB)ファイルを最後に変更した時刻
  F1EC  1415          		DB	20,21		;(FCB)ファイルを最後に変更した日付
  F1EE  1A1B          		DB	26,27		;(FCB)ファイルの先頭クラスタ
  F1F0  10111213      		DB	16,17,18,19	;(FCB)ファイルのサイズ(バイト単位)
  F1F4                	SDDATAE:
                      	
  F1F4                	SCDIR:	DS	2		;+14 +15
  F1F6                	SFBPS:	DS	2		;FBPS
  F1F8                	SFNDF:	DS	2		;FILEN DIRF
                      	
  F1FA  0000          	_FATPS:	DW	0
  F1FC  0000          	_DIRPS:	DW	0
  F1FE  0000          	_CLPS:	DW	0
                      	
  F200                	_PE:
                      	
                      	;X1DPB.ASM
                      	
                      	;	LSX-Dodgers DPB
                      	;	X1/turbo/Z
                      	
  F200                	DEVICE:
                      	
                      	;	A:
                      	
  F200  0200          		DW	2	;DPB_00_FATLN
  F202  EBF0          		DW	_FDRD	;DPB_02_DRD
  F204  EEF0          		DW	_FDWT	;DPB_04_DWT
  F206  FD            		DB	0FDH	;DPB_06_FATID
  F207  02            		DB	2	;DPB_07_SECPCL
  F208  6401          		DW	356	;DPB_08_MAXCL
  F20A  FF            		DB	0FFH	;DPB_0A_FDMODE	0FFH=2D / 0FEH=2HD
  F20B  07            		DB	7	;DPB_0B_DIRSCNT
  F20C  28            		DB	40	;DPB_0C_MAXCYL
  F20D  09            		DB	9	;DPB_0D_MAXSEC	Number of sectors
  F20E  01            		DB	1	;DPB_0E_FATPS
  F20F  82            		DB	082H	;DPB_0F_BPS
  F210  0500          		DW	5	;DPB_10_DIRPS
  F212  A7            		DB	0A7H	;DPB_12_DEVICE	Device Number
  F213  00            		DB	0	;DPB_13_UNITNO
  F214  0800          		DW	8	;DPB_14_ADDCL16
  F216  0000          		DW	0	;DPB_16
  F218  0000          		DW	0	;DPB_18
  F21A  0000          		DW	0	;DPB_1A_SDIR
  F21C  46444430      		DB	"FDD0"	;DPB_1C_NAME
                      	
                      	;	B:
                      	
  F220  0200          		DW	2	;DPB_00_FATLN
  F222  EBF0          		DW	_FDRD	;DPB_02_DRD
  F224  EEF0          		DW	_FDWT	;DPB_04_DWT
  F226  FD            		DB	0FDH	;DPB_06_FATID
  F227  02            		DB	2	;DPB_07_SECPCL
  F228  6401          		DW	356	;DPB_08_MAXCL
  F22A  FF            		DB	0FFH	;DPB_0A_FDMODE	0FFH=2D / 0FEH=2HD
  F22B  07            		DB	7	;DPB_0B_DIRSCNT
  F22C  28            		DB	40	;DPB_0C_MAXCYL
  F22D  09            		DB	9	;DPB_0D_MAXSEC	Number of sectors
  F22E  01            		DB	1	;DPB_0E_FATPS
  F22F  82            		DB	082H	;DPB_0F_BPS
  F230  0500          		DW	5	;DPB_10_DIRPS
  F232  A7            		DB	0A7H	;DPB_12_DEVICE	Device Number
  F233  01            		DB	1	;DPB_13_UNITNO
  F234  0800          		DW	8	;DPB_14_ADDCL16
  F236  0000          		DW	0	;DPB_16
  F238  0000          		DW	0	;DPB_18
  F23A  0000          		DW	0	;DPB_1A_SDIR
  F23C  46444431      		DB	"FDD1"	;DPB_1C_NAME
                      	
                      	;	C:
                      	
  F240  0200          		DW	2	;DPB_00_FATLN
  F242  EBF0          		DW	_FDRD	;DPB_02_DRD
  F244  EEF0          		DW	_FDWT	;DPB_04_DWT
  F246  FD            		DB	0FDH	;DPB_06_FATID
  F247  02            		DB	2	;DPB_07_SECPCL
  F248  6401          		DW	356	;DPB_08_MAXCL
  F24A  FF            		DB	0FFH	;DPB_0A_FDMODE	0FFH=2D / 0FEH=2HD
  F24B  07            		DB	7	;DPB_0B_DIRSCNT
  F24C  28            		DB	40	;DPB_0C_MAXCYL
  F24D  09            		DB	9	;DPB_0D_MAXSEC	Number of sectors
  F24E  01            		DB	1	;DPB_0E_FATPS
  F24F  82            		DB	082H	;DPB_0F_BPS
  F250  0500          		DW	5	;DPB_10_DIRPS
  F252  A7            		DB	0A7H	;DPB_12_DEVICE	Device Number
  F253  02            		DB	2	;DPB_13_UNITNO
  F254  0800          		DW	8	;DPB_14_ADDCL16
  F256  0000          		DW	0	;DPB_16
  F258  0000          		DW	0	;DPB_18
  F25A  0000          		DW	0	;DPB_1A_SDIR
  F25C  46444432      		DB	"FDD2"	;DPB_1C_NAME
                      	
                      	;	D:
                      	
  F260  0200          		DW	2	;DPB_00_FATLN
  F262  EBF0          		DW	_FDRD	;DPB_02_DRD
  F264  EEF0          		DW	_FDWT	;DPB_04_DWT
  F266  FD            		DB	0FDH	;DPB_06_FATID
  F267  02            		DB	2	;DPB_07_SECPCL
  F268  6401          		DW	356	;DPB_08_MAXCL
  F26A  FF            		DB	0FFH	;DPB_0A_FDMODE	0FFH=2D / 0FEH=2HD
  F26B  07            		DB	7	;DPB_0B_DIRSCNT
  F26C  28            		DB	40	;DPB_0C_MAXCYL
  F26D  09            		DB	9	;DPB_0D_MAXSEC	Number of sectors
  F26E  01            		DB	1	;DPB_0E_FATPS
  F26F  82            		DB	082H	;DPB_0F_BPS
  F270  0500          		DW	5	;DPB_10_DIRPS
  F272  A7            		DB	0A7H	;DPB_12_DEVICE
  F273  03            		DB	3	;DPB_13_UNITNO
  F274  0800          		DW	8	;DPB_14_ADDCL16
  F276  0000          		DW	0	;DPB_16
  F278  0000          		DW	0	;DPB_18
  F27A  0000          		DW	0	;DPB_1A_SDIR
  F27C  46444433      		DB	"FDD3"	;DPB_1C_NAME
                      	
                      	;	E:
                      	
  F280  0000          	EMMFL:	DW	0	;DPB_00_FATLN
  F282  E8D7          	EMMRD:	DW	EDRD	;DPB_02_DRD
  F284  E4D7          	EMMWR:	DW	EDWT	;DPB_04_DWT
  F286  FE            		DB	0FEH	;DPB_06_FATID
  F287  02            		DB	2	;DPB_07_SECPCL
  F288  0000          	EMMCL:	DW	0	;DPB_08_MAXCL
  F28A  00            		DB	0	;DPB_0A_FDMODE
  F28B  0C            		DB	12	;DPB_0B_DIRSCNT
  F28C  00            		DB	0	;DPB_0C_MAXCYL
  F28D  00            		DB	0	;DPB_0D_MAXSEC
  F28E  02            		DB	2	;DPB_0E_FATPS
  F28F  02            		DB	2	;DPB_0F_BPS
  F290  0A00          		DW	10	;DPB_10_DIRPS
  F292  06            	EMMDV:	DB	6	;DPB_12_DEVICE
  F293  00            		DB	0	;DPB_13_UNITNO
  F294  1200          		DW	18	;DPB_14_ADDCL16
  F296  0000          		DW	0	;DPB_16
  F298  0000          		DW	0	;DPB_18
  F29A  0000          		DW	0	;DPB_1A_SDIR
  F29C  454D4D30      		DB	"EMM0"	;DPB_1C_NAME
                      	
                      	;	F:
                      	
  F2A0  0000          	BANKFL:	DW	0	;DPB_00_FATLN
  F2A2  7CD7          		DW	BDRD	;DPB_02_DRD
  F2A4  78D7          		DW	BDWT	;DPB_04_DWT
  F2A6  F9            		DB	0F9H	;DPB_06_FATID
  F2A7  02            		DB	2	;DPB_07_SECPCL
  F2A8  0000          	BANKCL:	DW	0	;DPB_08_MAXCL
  F2AA  00            		DB	0	;DPB_0A_FDMODE
  F2AB  08            		DB	8	;DPB_0B_DIRSCNT
  F2AC  00            		DB	0	;DPB_0C_MAXCYL
  F2AD  01            		DB	1	;DPB_0D_MAXSEC
  F2AE  00            		DB	0	;DPB_0E_FATPS
  F2AF  02            		DB	2	;DPB_0F_BPS
  F2B0  0200          		DW	2	;DPB_10_DIRPS
  F2B2  0B            	BANKDV:	DB	00BH	;DPB_12_DEVICE
  F2B3  00            		DB	0	;DPB_13_UNITNO
  F2B4  0600          		DW	6	;DPB_14_ADDCL16
  F2B6  0000          		DW	0	;DPB_16
  F2B8  0000          		DW	0	;DPB_18
  F2BA  0000          		DW	0	;DPB_1A_SDIR
  F2BC  4252414D      		DB	"BRAM"	;DPB_1C_NAME
                      	
                      	;	G:
                      	
  F2C0  0200          		DW	2	;DPB_00_FATLN
  F2C2  39D7          		DW	GDRD	;DPB_02_DRD
  F2C4  50D7          		DW	GDWT	;DPB_04_DWT
  F2C6  FA            		DB	0FAH	;DPB_06_FATID
  F2C7  01            		DB	1	;DPB_07_SECPCL
  F2C8  B800          		DW	184	;DPB_08_MAXCL
  F2CA  00            		DB	0	;DPB_0A_FDMODE
  F2CB  07            		DB	7	;DPB_0B_DIRSCNT
  F2CC  00            		DB	0	;DPB_0C_MAXCYL
  F2CD  01            		DB	1	;DPB_0D_MAXSEC
  F2CE  01            		DB	1	;DPB_0E_FATPS
  F2CF  01            		DB	1	;DPB_0F_BPS
  F2D0  0300          		DW	3	;DPB_10_DIRPS
  F2D2  05            		DB	5	;DPB_12_DEVICE
  F2D3  01            		DB	1	;DPB_13_UNITNO
  F2D4  0800          		DW	8	;DPB_14_ADDCL16
  F2D6  0000          		DW	0	;DPB_16
  F2D8  0000          		DW	0	;DPB_18
  F2DA  0000          		DW	0	;DPB_1A_SDIR
  F2DC  4752414D      		DB	"GRAM"	;DPB_1C_NAME
                      	
                      	;	H:
  F2E0                		DS	32-8
  F2F8  00            		DB	0
                      	
                      	
  F2F9                	LAST_ADR:
                      	
  F2F9                		END
