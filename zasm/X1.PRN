			  Z80 ASSEMBLER - ZASM VER 1.6
                      	;	LSX-Dodgers for X1/turbo/Z
                      	;	Programmed by
                      	;	Gaku (Lovers/Tablacus)
                      	;X1DEF.ASM
                      	
                      	;	LSX-Dodgers DEF
                      	;	X1/turbo/Z
                      	
  0000                	MAC	EQU	0		;X1
  0000                	DEV EQU 0
                      	
  CC00                	RUN	EQU	0CC00H
  D206                	BDOS	EQU	0D206H
  F000                	WORKAD	EQU	0F000H
  F300                	FATBF	EQU	0F300H
  FB00                	DTBUF	EQU	0FB00H
  FF00                	KEYBF	EQU	0FF00H
  FF20                	KBUF	EQU	0FF20H
  FFCA                	EXTSP	EQU	0FFCAH
  FFD9                	TRAP38	EQU	0FFD9H
  0050                	WIDTH	EQU	80
  0018                	LINE	EQU	24
  0007                	COLORF	EQU	7
  0010                	KEYSP_H	EQU	16
  00C2                	KEYSP_L	EQU	0C2H
  0009                	COMS	EQU	9
                      	
                      	
                      	;LDDEF.ASM
                      	
                      	;	LSX-Dodgers DEF
                      	
  0001                	VER_1   EQU	1
  0005                	VER_2   EQU	5
  0005                	VER_3   EQU	5
  1D00                	MACW	EQU	MAC + 01D00H	;機種フラグとLD判別フラグ
  0000                	MACD	EQU	MAC + DEV * 256	;機種フラグとデバイスフラグ
  0155                	VER	EQU	VER_1 * 256 + VER_2 * 16 + VER_3
                      	
  0005                	SYSTEM	EQU	00005H
  000F                	JP_HL	EQU	0000FH
  005C                	FCB1	EQU	0005CH
  006C                	FCB2	EQU	0006CH
  005D                	FCB1FN	EQU	FCB1+1
  006D                	FCB2FN	EQU	FCB2+1
  0080                	DTA1	EQU	00080H
                      	
  FFCA                	EXTBIO	EQU	0FFCAH
                      	
                      	
                      	
  CBF9                		ORG	RUN-7
                      	
                      	;	MSX BINARY HEADER
  CBF9  FE            		DB	0FEH
                      	;	MSX BINARY START ADDRESS
  CBFA  00CC          		DW	RUN
                      	;	MSX BINARY END ADDRESS
  CBFC  F9F2          		DW	LAST_ADR
                      	;	MSX BINARY EXEC ADDRESS
  CBFE  07CC          		DW	START
                      	;X1INIT.ASM
                      	
                      	;	LSX-Dodgers INIT
                      	;	X1/turbo/Z
                      	
  CC00  C307CC        		JP	START
  CC03  001D          		DW	MACW
  CC05  5501          		DW	VER
                      	
  CC07                	START:
  CC07  F3            		DI
  CC08  ED5E          		IM	2
  CC0A  31CAFF        		LD	SP,EXTSP
  CC0D  CD1BCC        		CALL	INIT		;NZならAUTOEXECを実行
  CC10  210000        		LD	HL,0
  CC13  E5            		PUSH	HL
  CC14  C8            		RET	Z
  CC15  1199CF        		LD	DE,AUTOD
  CC18  C3FDF0        		JP	_COMANL
                      	
  CC1B                	INIT:
  CC1B  3E1E          		LD	A,01EH
  CC1D  D300          		OUT	(0),A
                      	
  CC1F  010000        		LD	BC,0
  CC22  ED438CF0      		LD	(_CTC),BC
  CC26  01040A        		LD	BC,00A04H
  CC29  CD43CF        		CALL	CHKCTC
  CC2C  010407        		LD	BC,00704H
  CC2F  CD43CF        		CALL	CHKCTC
  CC32  01A81F        		LD	BC,01FA8H
  CC35  CD43CF        		CALL	CHKCTC
  CC38  01A01F        		LD	BC,01FA0H
  CC3B  CD43CF        		CALL	CHKCTC
                      	;
  CC3E                	INISIO:
  CC3E  01911F        		LD	BC,01F91H	;INIT SIO
  CC41  1601          		LD	D,1
  CC43  ED51          		OUT	(C),D
                      	
  CC45  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  CC47  0E93          		LD	C,093H
  CC49  ED51          		OUT	(C),D
  CC4B  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  CC4D  0E99          		LD	C,099H		;INIT SIO
  CC4F  1601          		LD	D,1
  CC51  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  CC53  0E9B          		LD	C,09BH
  CC55  ED51          		OUT	(C),D
  CC57  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
                      	
  CC59  0E80          		LD	C,080H		;INIT DMA
  CC5B  2106C3        		LD	HL,0C306H
  CC5E                	INIDMA:
  CC5E  ED61          		OUT	(C),H
  CC60  2D            		DEC	L
  CC61  20FB          		JR	NZ,INIDMA
                      	
  CC63  3EE4          		LD	A,0E4H
  CC65  CDDDDE        		CALL	COMOUT
  CC68  AF            		XOR	A
  CC69  CDB7DE        		CALL	OT49SB
                      	
  CC6C  3EF0          		LD	A,INTVEC/256
  CC6E  ED47          		LD	I,A
                      	
  CC70  ED4B8CF0      		LD	BC,(_CTC)
  CC74  0D            		DEC	C
  CC75  0D            		DEC	C
                      	
  CC76  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  CC78  3EC0          		LD	A,CTC0
  CC7A  ED79          		OUT	(C),A
                      	
  CC7C  0C            		INC	C
  CC7D  3E47          		LD	A,047H
  CC7F  ED79          		OUT	(C),A
  CC81  3E0D          		LD	A,13		;Baudrate 9600-13
  CC83  ED79          		OUT	(C),A
                      	
  CC85  79            		LD	A,C
  CC86  D610          		SUB	010H
  CC88  4F            		LD	C,A
                      	;	LD	(SIOAD+1),BC
                      	;	LD	(SIOAD0+1),BC
                      	;	LD	(SIOAD1+1),BC
                      	
  CC89  21E9CF        		LD	HL,SIODATA
  CC8C                	SINIT1:
  CC8C  7E            		LD	A,(HL)
  CC8D  23            		INC	HL
  CC8E  FEFF          		CP	0FFH
  CC90  2804          		JR	Z,SINIT2
  CC92  ED79          		OUT	(C),A
  CC94  18F6          		JR	SINIT1
  CC96                	SINIT2:
  CC96  3EE4          		LD	A,0E4H
  CC98  CDDDDE        		CALL	COMOUT
  CC9B  3EC8          		LD	A,INTVEC
  CC9D  CDB7DE        		CALL	OT49SB
                      	;
  CCA0  01C41F        		LD	BC,01FC4H
  CCA3  3E0C          		LD	A,00CH
  CCA5  ED79          		OUT	(C),A
                      	
  CCA7  0EC0          		LD	C,0C0H
  CCA9  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
                      	
  CCAB  0C            		INC	C
  CCAC  3E28          		LD	A,40
  CCAE  ED79          		OUT	(C),A
                      	
  CCB0  0C            		INC	C
  CCB1  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
                      	
  CCB3  0C            		INC	C
  CCB4  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
                      	
  CCB6  0EC5          		LD	C,0C5H
  CCB8  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
                      	
  CCBA                	TEXT:
  CCBA  0EB0          		LD	C,0B0H
  CCBC  3E80          		LD	A,080H
  CCBE  ED79          		OUT	(C),A
  CCC0  1607          		LD	D,7
  CCC2  0EB9          		LD	C,0B9H
  CCC4  21E2CF        		LD	HL,TEXTDT
  CCC7                	TEXT1:
  CCC7  04            		INC	B
  CCC8  EDA3          		OUTI
  CCCA  0C            		INC	C
  CCCB  15            		DEC	D
  CCCC  20F9          		JR	NZ,TEXT1
  CCCE  01B01F        		LD	BC,01FB0H
  CCD1  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
                      	
  CCD3  0EC4          		LD	C,0C4H
  CCD5  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
                      	
  CCD7  01011A        		LD	BC,01A01H
  CCDA  ED78          		IN	A,(C)
  CCDC  E608          		AND	8
  CCDE  2809          		JR	Z,PRN
  CCE0  0E03          		LD	C,003H
  CCE2  3E0F          		LD	A,00FH
  CCE4  ED79          		OUT	(C),A
  CCE6  01040A        		LD	BC,00A04H
  CCE9                	PRN:
  CCE9  210000        		LD	HL,0
  CCEC  065C          		LD	B,05CH
  CCEE  3EFF          		LD	A,0FFH		;RST 38H
  CCF0  CD37E1        		CALL	FILL_MEMORY
  CCF3  06A4          		LD	B,0A4H
  CCF5  AF            		XOR	A
  CCF6  CD37E1        		CALL	FILL_MEMORY
                      	
  CCF9  3EC3          		LD	A,0C3H		;JP
  CCFB  2103F0        		LD	HL,CPM_WBOOT
  CCFE  320000        		LD	(00000H),A
  CD01  220100        		LD	(00001H),HL	;IPL
                      	
  CD04  21001D        		LD	HL,MACW	;3 bit7  DPB Compatible LA(1)
  CD07  220300        		LD	(00003H),HL	;  bit6-0 Machine X1(0)
                      	;				;4 LSX-Dodgers(01DH)
  CD0A  2106D2        		LD	HL,BDOS
  CD0D  320500        		LD	(00005H),A
  CD10  220600        		LD	(00006H),HL	;BDOS
                      	
  CD13  21F7DA        		LD	HL,BIOS
  CD16  221900        		LD	(00019H),HL	;BIOS-ROM
                      	
  CD19  21D9FF        		LD	HL,TRAP38	;TRAP38
  CD1C  323800        		LD	(00038H),A
  CD1F  223900        		LD	(00039H),HL	;RST 038H
                      	
  CD22  3EF0          		LD	A,CPM_BOOT/256
  CD24  320B00        		LD	(0000BH),A
                      	
  CD27  3EE9          		LD	A,0E9H		;JP (HL)
  CD29  320F00        		LD	(0000FH),A
                      	
  CD2C  3EE6          		LD	A,0E6H
  CD2E  CDDDDE        		CALL	COMOUT
  CD31  CDC2DE        		CALL	IN49SB
  CD34  F5            		PUSH	AF
  CD35  CDC2DE        		CALL	IN49SB
  CD38  F1            		POP	AF
  CD39  F5            		PUSH	AF
  CD3A  E612          		AND	012H
  CD3C  2005          		JR	NZ,KEYR
  CD3E  3E01          		LD	A,1
  CD40  3296CE        		LD	(KEYREP+1),A
  CD43                	KEYR:
  CD43  F1            		POP	AF
  CD44  E603          		AND	3
  CD46  280E          		JR	Z,NON
                      	
  CD48  01D03F        		LD	BC,03FD0H
  CD4B  ED49          		OUT	(C),C
  CD4D  3E37          		LD	A,037H
  CD4F  D3D0          		OUT	(0D0H),A
  CD51  ED78          		IN	A,(C)
  CD53  B9            		CP	C
  CD54  2865          		JR	Z,TURBO
  CD56                	NON:
  CD56  211CD0        		LD	HL,AT_SCR1
  CD59  1167DF        		LD	DE,SCR1
  CD5C  019400        		LD	BC,SCRNE-SCR1	;転送先のサイズ確認用
  CD5F  018500        		LD	BC,AT_SCRE-AT_SCR1
  CD62  EDB0          		LDIR
                      	
  CD64  21A1D0        		LD	HL,AT_DWT
  CD67  11BFEE        		LD	DE,WTTRK
  CD6A  018F00        		LD	BC,DMAE-WTTRK	;転送先のサイズ確認用
  CD6D  018E00        		LD	BC,AT_CPUE-AT_DWT
  CD70  EDB0          		LDIR
                      	
  CD72  212FD1        		LD	HL,AT_EDWT
  CD75  11E4D7        		LD	DE,EDWT
  CD78  014B00        		LD	BC,EMME-EDWT	;転送先のサイズ確認用
  CD7B  014600        		LD	BC,AT_EMME-AT_EDWT
  CD7E  EDB0          		LDIR
                      	
  CD80  21E2DF        		LD	HL,AT_WTTRK+AT_RS
  CD83  22E9F0        		LD	(_WTTRK+1),HL
  CD86  2108EF        		LD	HL,AT_DRD+AT_R
  CD89  22ECF0        		LD	(_FDRD+1),HL
  CD8C  21BFEE        		LD	HL,AT_DWT+AT_R
  CD8F  22EFF0        		LD	(_FDWT+1),HL
  CD92  21F8D7        		LD	HL,AT_EDRD+AT_RE
  CD95  2282F2        		LD	(EMMRD),HL
  CD98  21E4D7        		LD	HL,AT_EDWT+AT_RE
  CD9B  2284F2        		LD	(EMMWR),HL
  CD9E  21E9DF        		LD	HL,AT_SCRN+AT_RS
  CDA1  22D1F0        		LD	(_SCRN+1),HL
                      	
  CDA4  3E27          		LD	A,027H			;ノンターボはMFM切り替えを行わない
  CDA6  3212F2        		LD	(DEVICE+012H),A		;Aドライブ
  CDA9  3232F2        		LD	(DEVICE+012H+32),A	;Bドライブ
  CDAC  3252F2        		LD	(DEVICE+012H+32*2),A	;Cドライブ
  CDAF  3272F2        		LD	(DEVICE+012H+32*3),A	;Dドライブ
                      	
  CDB2  210000        		LD	HL,0
  CDB5  2208DF        		LD	(X1PAT),HL
  CDB8  C344CE        		JP	NOBANK
                      	
  CDBB                	TURBO:
  CDBB  F3            		DI			;Check BIOS
  CDBC  061D          		LD	B,01DH
  CDBE  ED79          		OUT	(C),A		;BIOS ON
  CDC0  3A512F        		LD	A,(02F51H)
  CDC3  04            		INC	B		;B=01EH
  CDC4  ED79          		OUT	(C),A		;BIOS OFF
  CDC6  FB            		EI
  CDC7  FEC9          		CP	0C9H
  CDC9  2802          		JR	Z,BIOSOK
  CDCB  1805          		JR	NOBIOS
  CDCD                	BIOSOK:
  CDCD  3EC3          		LD	A,0C3H		;JP
  CDCF  321800        		LD	(00018H),A
  CDD2                	NOBIOS:
  CDD2  3E1F          		LD	A,01FH		;スタートポート
  CDD4  DBF0          		IN	A,(0F0H)
  CDD6  0F            		RRCA
  CDD7  380B          		JR	C,CRT1
  CDD9  21D2CF        		LD	HL,_C8025H
  CDDC  11B0F0        		LD	DE,CRTCD
  CDDF  011000        		LD	BC,16
  CDE2  EDB0          		LDIR
  CDE4                	CRT1:
  CDE4  3E1F          		LD	A,01FH		;スタートポート
  CDE6  DBF0          		IN	A,(0F0H)
  CDE8  CB57          		BIT	2,A
  CDEA  2818          		JR	Z,BANK
                      	
  CDEC  AF            		XOR	A
  CDED                	TZ1:				;前面スイッチが2HDの場合はMFMモードを2HDにしておく
  CDED  F5            		PUSH	AF
  CDEE  CDDCF0        		CALL	_GETDPB
  CDF1  DD7E12        		LD	A,(IX+012H)	;DPB_12_DEVICE
  CDF4  E68F          		AND	08FH
  CDF6  FE87          		CP	087H		;フロッピーでMEM切り替えがON
  CDF8  2004          		JR	NZ,TZ2
  CDFA  DDCB0A86      		RES	0,(IX+0AH)	;(DPB_0A_FDMODE)
  CDFE                	TZ2:
  CDFE  F1            		POP	AF
  CDFF  3C            		INC	A
  CE00  FE08          		CP	8
  CE02  38E9          		JR	C,TZ1
                      	
  CE04                	BANK:
  CE04  01000B        		LD	BC,00B00H
  CE07  21007F        		LD	HL,07F00H
  CE0A  F3            		DI
  CE0B  ED69          		OUT	(C),L
  CE0D  3A0000        		LD	A,(0)
  CE10  FEEB          		CP	0EBH
  CE12  2005          		JR	NZ,BANK1
  CE14  3E2B          		LD	A,02BH
  CE16  32B2F2        		LD	(BANKDV),A
  CE19                	BANK1:
  CE19  ED69          		OUT	(C),L
  CE1B  5E            		LD	E,(HL)
  CE1C  7B            		LD	A,E
  CE1D  C6A5          		ADD	A,0A5H
  CE1F  77            		LD	(HL),A
  CE20  BE            		CP	(HL)
  CE21  73            		LD	(HL),E
  CE22  2005          		JR	NZ,BANK2
  CE24  2C            		INC	L
  CE25  CB65          		BIT	4,L
  CE27  28F0          		JR	Z,BANK1
  CE29                	BANK2:
  CE29  3E10          		LD	A,010H
  CE2B  ED79          		OUT	(C),A
  CE2D  7D            		LD	A,L
  CE2E  B7            		OR	A
  CE2F  2813          		JR	Z,NOBANK
  CE31  2600          		LD	H,0
  CE33  29            		ADD	HL,HL	;*2
  CE34  29            		ADD	HL,HL	;*4
  CE35  29            		ADD	HL,HL	;*8
  CE36  29            		ADD	HL,HL	;*16
  CE37  29            		ADD	HL,HL	;*32
  CE38  2B            		DEC	HL	;-1
  CE39  2B            		DEC	HL	;-2
  CE3A  2B            		DEC	HL	;-3
  CE3B  22A8F2        		LD	(BANKCL),HL
  CE3E  CD89CF        		CALL	CALC_FATLN
  CE41  32A0F2        		LD	(BANKFL),A
  CE44                	NOBANK:
  CE44                	EMM:
  CE44  DD2180F2      		LD	IX,EMMFL
  CE48  CD3ACF        		CALL	EADR0
  CE4B  ED78          		IN	A,(C)
  CE4D  F5            		PUSH	AF
                      	
  CE4E  110000        		LD	DE,0
  CE51                	ECHECK1:
  CE51  13            		INC	DE
  CE52  CD1ECF        		CALL	EADR2
  CE55  ED60          		IN	H,(C)
  CE57  CD1ECF        		CALL	EADR2
  CE5A  7C            		LD	A,H
  CE5B  C6E5          		ADD	A,0E5H
  CE5D  ED79          		OUT	(C),A
  CE5F  3C            		INC	A
  CE60  CD3ACF        		CALL	EADR0
  CE63  ED79          		OUT	(C),A
  CE65  3D            		DEC	A
  CE66  CD1ECF        		CALL	EADR2
  CE69  ED68          		IN	L,(C)
  CE6B  CD1ECF        		CALL	EADR2
  CE6E  ED61          		OUT	(C),H
  CE70  BD            		CP	L
  CE71  2004          		JR	NZ,ECHECK2
  CE73  CB5A          		BIT	3,D
  CE75  28DA          		JR	Z,ECHECK1
  CE77                	ECHECK2:
  CE77  CD3ACF        		CALL	EADR0
  CE7A  F1            		POP	AF
  CE7B  ED79          		OUT	(C),A
  CE7D  FEEB          		CP	0EBH
  CE7F  2005          		JR	NZ,EMM_BPB
  CE81  3E26          		LD	A,026H
  CE83  3292F2        		LD	(EMMDV),A
  CE86                	EMM_BPB:
  CE86  21F7FF        		LD	HL,0-9
  CE89  19            		ADD	HL,DE
  CE8A  3009          		JR	NC,NOEMM
  CE8C  2288F2        		LD	(EMMCL),HL
  CE8F  CD89CF        		CALL	CALC_FATLN
  CE92  3280F2        		LD	(EMMFL),A
  CE95                	NOEMM:
  CE95  3E00          	KEYREP:	LD	A,000H
  CE97  B7            		OR	A
  CE98  2807          		JR	Z,KEYR1
  CE9A  010000        		LD	BC,0
  CE9D  ED438CF0      		LD	(_CTC),BC
  CEA1                	KEYR1:
  CEA1  CD6ACF        		CALL	SETCRTC
  CEA4  0130F8        		LD	BC,0-80*25
  CEA7  2ABAF0        		LD	HL,(_PAGE_MINUS)
  CEAA  ED43BAF0      		LD	(_PAGE_MINUS),BC
  CEAE  1E0C          		LD	E,00CH
  CEB0  CDCDF0        		CALL	_PRINT
  CEB3  22BAF0        		LD	(_PAGE_MINUS),HL
                      	
  CEB6  21A5CF        		LD	HL,INIMES
  CEB9  CD70D8        		CALL	MSX
                      	
  CEBC  3A87FF        		LD	A,(0FF87H)
  CEBF  FE08          		CP	8
  CEC1  301E          		JR	NC,INIT0
  CEC3  5F            		LD	E,A
  CEC4  C641          		ADD	A,'A'
  CEC6  32A2CF        		LD	(AUTODV),A
  CEC9  0E0E          		LD	C,00EH
  CECB  CD0500        		CALL	SYSTEM
  CECE  1C            		INC	E
  CECF  2185F0        		LD	HL,_SEEKSP	;Disk error Ignore
  CED2  CBFE          		SET	7,(HL)
  CED4  0E1B          		LD	C,01BH
  CED6  CD0500        		CALL	SYSTEM
                      	
  CED9  2185F0        		LD	HL,_SEEKSP
  CEDC  CBBE          		RES	7,(HL)
                      	
  CEDE  3C            		INC	A
  CEDF  2008          		JR	NZ,INIT1
  CEE1                	INIT0:
  CEE1  1E00          		LD	E,0
  CEE3  0E0E          		LD	C,00EH
  CEE5  CD0500        		CALL	SYSTEM
  CEE8  AF            		XOR	A
  CEE9                	INIT1:
  CEE9  F3            		DI
  CEEA  08            		EX	AF,AF'
  CEEB  2EFE          		LD	L,0-2		;CALLのスタック分減らす
  CEED  39            		ADD	HL,SP
  CEEE  1100FF        		LD	DE,0FF00H
  CEF1  45            		LD	B,L
  CEF2  CDD3D5        		CALL	ZERO_MEMORY_DE
  CEF5  21CAFF        		LD	HL,EXTBIO
  CEF8  36C9          		LD	(HL),0C9H	;RET
  CEFA  23            		INC	HL
  CEFB  060E          		LD	B,TRAP38-EXTBIO-1
  CEFD  3EFF          		LD	A,0FFH		;RST 38H
  CEFF  CD37E1        		CALL	FILL_MEMORY
  CF02  21F5CF        		LD	HL,AT_TRAP38
  CF05  11D9FF        		LD	DE,TRAP38
  CF08  012700        		LD	BC,AT_TRAPE-AT_TRAP38
  CF0B  EDB0          		LDIR
  CF0D  08            		EX	AF,AF'
  CF0E  B7            		OR	A
  CF0F  C8            		RET	Z
                      	
  CF10  3EE6          		LD	A,0E6H
  CF12  CDDDDE        		CALL	COMOUT
  CF15  CDC2DE        		CALL	IN49SB
  CF18  CDC2DE        		CALL	IN49SB
  CF1B  FE1B          		CP	01BH
  CF1D  C9            		RET
                      	
  CF1E                	EADR2:
  CF1E  D5            		PUSH	DE
  CF1F  EB            		EX	DE,HL
  CF20  29            		ADD	HL,HL
  CF21  29            		ADD	HL,HL
  CF22  DD4E0D        		LD	C,(IX+00DH)	;DPB_0D_MAXSEC
  CF25  DD460C        		LD	B,(IX+00CH)	;DPB_0C_MAXCYL
  CF28  09            		ADD	HL,BC
  CF29  DD4E13        		LD	C,(IX+013H)	;DPB_13_UNITNO
  CF2C  060D          		LD	B,00DH
  CF2E  ED49          		OUT	(C),C
  CF30  0C            		INC	C
  CF31  ED69          		OUT	(C),L
  CF33  0C            		INC	C
  CF34  ED61          		OUT	(C),H
  CF36  0C            		INC	C
  CF37  EB            		EX	DE,HL
  CF38  D1            		POP	DE
  CF39  C9            		RET
                      	
  CF3A                	EADR0:
  CF3A  D5            		PUSH	DE
  CF3B  110000        		LD	DE,0
  CF3E  CD1ECF        		CALL	EADR2
  CF41  D1            		POP	DE
  CF42  C9            		RET
                      	
  CF43                	CHKCTC:
  CF43  C5            		PUSH	BC
  CF44  110347        		LD	DE,04703H
  CF47                	INICTC1:
  CF47  0C            		INC	C
  CF48  ED51          		OUT	(C),D
  CF4A  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  CF4C  1D            		DEC	E
  CF4D  20F8          		JR	NZ,INICTC1
  CF4F  C1            		POP	BC
                      	
  CF50  11FA07        		LD	DE,007FAH
  CF53  ED51          		OUT	(C),D
  CF55  ED59          		OUT	(C),E
  CF57  ED78          		IN	A,(C)
  CF59  BB            		CP	E
  CF5A  C0            		RET	NZ
  CF5B  ED51          		OUT	(C),D
  CF5D  ED51          		OUT	(C),D
  CF5F  ED78          		IN	A,(C)
  CF61  BA            		CP	D
  CF62  C0            		RET	NZ
  CF63  0C            		INC	C
  CF64  0C            		INC	C
  CF65  ED438CF0      		LD	(_CTC),BC
  CF69  C9            		RET
                      	
  CF6A                	SETCRTC:
  CF6A  21B0F0        		LD	HL,CRTCD
  CF6D  AF            		XOR	A
  CF6E                	SETCRT1:
  CF6E  010018        		LD	BC,01800H
  CF71  ED79          		OUT	(C),A
  CF73  0C            		INC	C
  CF74  04            		INC	B
  CF75  EDA3          		OUTI
  CF77  3C            		INC	A
  CF78  FE0C          		CP	12
  CF7A  20F2          		JR	NZ,SETCRT1
  CF7C  23            		INC	HL
  CF7D  23            		INC	HL
  CF7E  01031B        		LD	BC,01A03H+00100H
  CF81  EDA3          		OUTI
  CF83  01D020        		LD	BC,01FD0H+00100H
  CF86  EDA3          		OUTI
  CF88  C9            		RET
                      	
  CF89                	CALC_FATLN:	;FAT12のクラスタ数から必要なFATサイズを求める(セクタサイズ512)
  CF89  5D            		LD	E,L
  CF8A  54            		LD	D,H
  CF8B  29            		ADD	HL,HL	;*2
  CF8C  19            		ADD	HL,DE	;*3
  CF8D  CB3C          		SRL	H	;/2
  CF8F  CB1D          		RR	L	;1クラスタ辺り1.5バイト必要
  CF91  11FF01        		LD	DE,511	;切り上げる
  CF94  19            		ADD	HL,DE
  CF95  7C            		LD	A,H
  CF96  CB3F          		SRL	A
  CF98  C9            		RET
                      	
  CF99  4155544F455845	AUTOD:	DB	"AUTOEXEC "
  CFA2  413A00        	AUTODV:	DB	"A:",0
                      	
  CFA5  4C53582D446F64	INIMES:	DB	"LSX-Dodgers for X1/turbo version "
  CFC6  312E          		DB	030H + VER_1, '.'
  CFC8  3535          		DB	030H + VER_2 ,030H + VER_3
                      	;	DB	""
  CFCA  2047616B750D0A		DB	' Gaku',0DH,0AH
  CFD1  00            		DB	0
                      	
  CFD2                	_C8025H:
  CFD2  6B5059881B0119		DB	06BH,050H,059H,088H,01BH,001H,019H,01AH
  CFDA  000F          		DB	000H,00FH
  CFDC  80F8B0FF      		DW	0-80*LINE,0-80
  CFE0  0C23          		DB	00CH,023H
                      	
  CFE2  030C0F30333C3F	TEXTDT:	DB	003H,00CH,00FH,030H,033H,03CH,03FH
                      	
  CFE9                	SIODATA:
  CFE9  18            		DB	018H
  CFEA  0100          		DB	1,0
  CFEC  0200          		DB	2,0
  CFEE  03C1          		DB	3,0C1H
  CFF0  0444          		DB	4,044H
  CFF2  05E8          		DB	5,0E8H
  CFF4  FF            		DB	0FFH
                      	
  CFF5                	AT_TRAP38:
  CFF5  210000        		LD	HL,0
  CFF8  E3            		EX	(SP),HL
  CFF9  3E24          		LD	A,'$'
  CFFB  CDBEDB        		CALL	MSG_A
  CFFE  2B            		DEC	HL
  CFFF  7C            		LD	A,H
  D000  CDE8FF        		CALL	PRHX+AT_RT
  D003  7D            		LD	A,L
  D004                	PRHX:
  D004  F5            		PUSH	AF
  D005  07            		RLCA
  D006  07            		RLCA
  D007  07            		RLCA
  D008  07            		RLCA
  D009  CDF1FF        		CALL	PRHX2+AT_RT
  D00C  F1            		POP	AF
  D00D                	PRHX2:
  D00D  E60F          		AND	00FH
  D00F  FE0A          		CP	10
  D011  3F            		CCF
  D012  CE30          		ADC	A,'0'
  D014  27            		DAA
  D015  C3BEDB        		JP	MSG_A
  D018                		DS	4
  D01C                	AT_TRAPE:
                      	
                      	;X1CPU.ASM
                      	
                      	;	LSX-Dodgers CPU
                      	;	X1/turbo/Z
                      	
                      	;	ノンターボ用パッチ
                      	;	DMAを使って転送している部分をCPUに差し替える
                      	
  D01C                	AT_SCR1:
  D01C  D9            		EXX
  D01D  C5            		PUSH	BC
  D01E  ED4BB1F0      		LD	BC,(_WIDTH)
  D022  0620          		LD	B,020H
  D024  D9            		EXX
  D025  C5            		PUSH	BC
  D026  010020        		LD	BC,02000H
                      	
  D029  67            		LD	H,A
  D02A  B7            		OR	A
  D02B                	AT_SCRUP1:
  D02B  2815          		JR	Z,AT_SCRCL
  D02D  C5            		PUSH	BC
  D02E  CBE0          		SET	4,B
  D030  D9            		EXX
  D031  C5            		PUSH	BC
  D032  CBE0          		SET	4,B
  D034  D9            		EXX
  D035  CD98DF        		CALL	AT_UPSUB+AT_RS
  D038  D9            		EXX
  D039  C1            		POP	BC
  D03A  D9            		EXX
  D03B  C1            		POP	BC
  D03C  CD98DF        		CALL	AT_UPSUB+AT_RS
  D03F  25            		DEC	H
  D040  18E9          		JR	AT_SCRUP1
                      	
  D042                	AT_SCRCL:
  D042  2AB1F0        		LD	HL,(_WIDTH)
  D045  CD30DE        		CALL	LINECL
  D048  C1            		POP	BC
  D049  D9            		EXX
  D04A  C1            		POP	BC
  D04B  D9            		EXX
  D04C  C9            		RET
                      	
  D04D                	AT_UPSUB:
  D04D  3AB1F0        		LD	A,(_WIDTH)
  D050  6F            		LD	L,A
  D051                	AT_UPSUB1:
  D051  D9            		EXX
  D052  ED78          		IN	A,(C)
  D054  03            		INC	BC
  D055  D9            		EXX
  D056  ED79          		OUT	(C),A
  D058  03            		INC	BC
  D059  2D            		DEC	L
  D05A  20F5          		JR	NZ,AT_UPSUB1
  D05C  C9            		RET
                      	
                      	;	FLOPPY DISK DRIVER(CPU)
                      	
  D05D                	DISKC:
  D05D  1B            		DEC	DE
  D05E  CB5F          		BIT	3,A
  D060  C4B8EE        		CALL	NZ,RNF
  D063                	DISKD:
  D063  E5            		PUSH	HL
  D064  21BEEE        		LD	HL,RETRY
  D067  35            		DEC	(HL)
  D068  E1            		POP	HL
  D069  200C          		JR	NZ,AT_ERR		;Retry
  D06B  B7            		OR	A
  D06C  2809          		JR	Z,AT_ERR		;Error
                      	
  D06E                	AT_DELP:
  D06E  CDB8EE        		CALL	RNF
  D071  CD94EE        		CALL	FDMOFF
  D074  3EFF          		LD	A,0FFH
  D076                	AT_ERRZ:
  D076  BF            		CP	A
  D077                	AT_ERR:
  D077  3EFF          		LD	A,0FFH
  D079  C9            		RET
  D07A                	ERRW:
  D07A  3EFF          		LD	A,0FFH
  D07C  BF            		CP	A
  D07D  37            		SCF
  D07E  C394EE        		JP	FDMOFF
                      	
  D081                	ERRDW:
  D081  D1            		POP	DE
  D082  CDB9DF        		CALL	AT_DELP+AT_RS
  D085  C2CDEE        		JP	NZ,DWT0+AT_R
  D088  B7            		OR	A
  D089  20EF          		JR	NZ,ERRW
  D08B  C9            		RET
                      	
  D08C                	ERRDR:
  D08C  D1            		POP	DE
  D08D  CDB9DF        		CALL	AT_DELP+AT_RS
  D090  C216EF        		JP	NZ,DRD0+AT_R
  D093  B7            		OR	A
  D094  20E4          		JR	NZ,ERRW
  D096  C9            		RET
                      	
  D097                	AT_WTTRK:
  D097  0601          		LD	B,1
  D099  3EF4          		LD	A,0F4H
  D09B  C3C1EE        		JP	AT_WTTRK1+AT_R
                      	
  D09E                	AT_SCRN:
  D09E  ED78          		IN	A,(C)
  D0A0  C9            		RET
  D0A1                	AT_SCRE:
                      	
  D0A1                	AT_DWT:
  D0A1  3EA0          		LD	A,0A0H
  D0A3                	AT_WTTRK1:
  D0A3  325CEE        		LD	(FDCPAT+1),A
  D0A6                	DWTBL:
  D0A6  78            		LD	A,B
  D0A7  3204EF        		LD	(AT_WTB+1+AT_R),A
  D0AA  3E02          		LD	A,2		;Retry count
  D0AC  32BEEE        		LD	(RETRY),A
                      	
  D0AF                	DWT0:
  D0AF  D5            		PUSH	DE
  D0B0  E5            		PUSH	HL
  D0B1  CDFBED        		CALL	SEEK		;Write disk
  D0B4  E1            		POP	HL
  D0B5  DACCDF        		JP	C,ERRDW+AT_RS
  D0B8  F3            		DI
  D0B9  3A5CEE        		LD	A,(FDCPAT+1)
  D0BC  CDA0EE        		CALL	SECSET
  D0BF  0EFB          		LD	C,0FBH
                      	
  D0C1                	DWT1:
  D0C1  56            		LD	D,(HL)
  D0C2                	DWT2:
  D0C2  78            		LD	A,B
  D0C3  DBF8          		IN	A,(0F8H)
  D0C5  0F            		RRCA
  D0C6  3008          		JR	NC,DWT4
  D0C8  0F            		RRCA
  D0C9  30F7          		JR	NC,DWT2
  D0CB                	DWT3:
  D0CB  ED51          		OUT	(C),D
  D0CD  23            		INC	HL
  D0CE  18F1          		JR	DWT1
                      	
  D0D0                	DWT4:
  D0D0  3D            		DEC	A
  D0D1  28F8          		JR	Z,DWT3
  D0D3  3C            		INC	A
  D0D4  FB            		EI
  D0D5  D1            		POP	DE
  D0D6  13            		INC	DE
  D0D7  CD94EE        		CALL	FDMOFF
  D0DA  2809          		JR	Z,DISKOK_WT
  D0DC  CDA8DF        		CALL	DISKC+AT_RS
  D0DF  20CE          		JR	NZ,DWT0
  D0E1  B7            		OR	A
  D0E2  C2C5DF        		JP	NZ,ERRW+AT_RS
                      	
  D0E5                	DISKOK_WT:
  D0E5  0601          	AT_WTB:	LD	B,1
  D0E7  10BD          		DJNZ	DWTBL
  D0E9  C9            		RET
                      	
  D0EA                	AT_DRD:
  D0EA  3E80          		LD	A,080H
  D0EC  325CEE        		LD	(FDCPAT+1),A
  D0EF                	DRDBL:
  D0EF  78            		LD	A,B
  D0F0  3249EF        		LD	(AT_RDB+1+AT_R),A
  D0F3  3E02          		LD	A,2		;Retry count
  D0F5  32BEEE        		LD	(RETRY),A
  D0F8                	DRD0:
  D0F8  D5            		PUSH	DE
  D0F9  E5            		PUSH	HL
  D0FA  CDFBED        		CALL	SEEK		;Read disk
  D0FD  E1            		POP	HL
  D0FE  DAD7DF        		JP	C,ERRDR+AT_RS
  D101  F3            		DI
  D102  3A5CEE        		LD	A,(FDCPAT+1)
  D105  CDA0EE        		CALL	SECSET
  D108  0EFB          		LD	C,0FBH
  D10A                	DRD1:
  D10A  78            		LD	A,B
  D10B  DBF8          		IN	A,(0F8H)
  D10D  0F            		RRCA
  D10E  3008          		JR	NC,DRD3
  D110  0F            		RRCA
  D111  30F7          		JR	NC,DRD1
  D113  EDA2          		INI
  D115  04            		INC	B
  D116  18F2          		JR	DRD1
                      	
  D118                	DRD3:
  D118  B7            		OR	A
  D119  FB            		EI
  D11A  D1            		POP	DE
  D11B  13            		INC	DE
  D11C  CD94EE        		CALL	FDMOFF
  D11F  2809          		JR	Z,DISKOK_RD
  D121  CDA8DF        		CALL	DISKC+AT_RS
  D124  20D2          		JR	NZ,DRD0
  D126  B7            		OR	A
  D127  C2C5DF        		JP	NZ,ERRW+AT_RS
                      	
  D12A                	DISKOK_RD:
  D12A  0601          	AT_RDB:	LD	B,1
  D12C  10C1          		DJNZ	DRDBL
  D12E  C9            		RET
                      	
  D12F                	AT_CPUE:
                      	
                      	
                      	;	EMM DRIVER(CPU)
                      	
                      	
  D12F                	AT_EDWT:
  D12F  CD0CD8        		CALL	AT_EADR+AT_RE
  D132                	AT_EDWT0:
  D132  F5            		PUSH	AF
  D133  AF            		XOR	A
  D134                	AT_EDWT1:
  D134  04            		INC	B
  D135  EDA3          		OUTI
  D137  04            		INC	B
  D138  EDA3          		OUTI
  D13A  3D            		DEC	A
  D13B  20F7          		JR	NZ,AT_EDWT1
  D13D  13            		INC	DE
  D13E  F1            		POP	AF
  D13F  3D            		DEC	A
  D140  20F0          		JR	NZ,AT_EDWT0
  D142  C9            		RET
                      	
  D143                	AT_EDRD:
  D143  CD0CD8        		CALL	AT_EADR+AT_RE
  D146                	AT_EDRD0:
  D146  F5            		PUSH	AF
  D147  AF            		XOR	A
  D148                	AT_EDRD1:
  D148  EDA2          		INI
  D14A  04            		INC	B
  D14B  EDA2          		INI
  D14D  04            		INC	B
  D14E  3D            		DEC	A
  D14F  20F7          		JR	NZ,AT_EDRD1
  D151  13            		INC	DE
  D152  F1            		POP	AF
  D153  3D            		DEC	A
  D154  20F0          		JR	NZ,AT_EDRD0
  D156  C9            		RET
                      	
  D157                	AT_EADR:
  D157  C5            		PUSH	BC
  D158  D5            		PUSH	DE
  D159  EB            		EX	DE,HL
  D15A  29            		ADD	HL,HL
  D15B  DD4E0D        		LD	C,(IX+00DH)	;DPB_0D_MAXSEC
  D15E  DD460C        		LD	B,(IX+00CH)	;DPB_0C_MAXCYL
  D161  09            		ADD	HL,BC
  D162  DD4E13        		LD	C,(IX+013H)	;DPB_13_UNITNO
  D165  060D          		LD	B,00DH
  D167  ED49          		OUT	(C),C
  D169  0C            		INC	C
  D16A  ED69          		OUT	(C),L
  D16C  0C            		INC	C
  D16D  ED61          		OUT	(C),H
  D16F  0C            		INC	C
  D170  EB            		EX	DE,HL
  D171  D1            		POP	DE
  D172  F1            		POP	AF
  D173  A7            		AND	A	;CF=0
  D174  C9            		RET
  D175                	AT_EMME:
                      	
  2FE4                	AT_RT	EQU	TRAP38-AT_TRAP38
                      	
  D175                	INITE:
  D175                		DS	BDOS-INITE
  D206  C32FD8        		JP	BDOS0
                      	
                      	;X1CCP.ASM
                      	
                      	;	LSX-Dodgers CCP
                      	;	X1/turbo/Z
                      	
  D209                	WBOOT1:
  D209  F3            		DI
  D20A  ED7B0600      		LD	SP,(SYSTEM+1)
                      	
  D20E  3EF0          		LD	A,INTVEC/256
  D210  ED47          		LD	I,A
                      	
  D212  3EE4          		LD	A,0E4H
  D214  CDDDDE        		CALL	COMOUT
  D217  3EC8          		LD	A,INTVEC
  D219  CDB7DE        		CALL	OT49SB
                      	
  D21C  21B0F0        		LD	HL,CRTCD
  D21F  AF            		XOR	A
  D220                	SETCRT2:
  D220  010018        		LD	BC,01800H
  D223  ED79          		OUT	(C),A
  D225  0C            		INC	C
  D226  56            		LD	D,(HL)
  D227  FE0D          		CP	13
  D229  3802          		JR	C,SETCRT3
  D22B  1600          		LD	D,0
  D22D                	SETCRT3:
  D22D  ED51          		OUT	(C),D
  D22F  23            		INC	HL
  D230  3C            		INC	A
  D231  FE0E          		CP	14
  D233  20EB          		JR	NZ,SETCRT2
                      	
  D235  01031B        		LD	BC,01A03H+00100H
  D238  EDA3          		OUTI
  D23A  01D020        		LD	BC,01FD0H+00100H
  D23D  EDA3          		OUTI
  D23F  2192F0        		LD	HL,_KEYD
  D242  7E            		LD	A,(HL)
  D243  3600          		LD	(HL),0
  D245  CDABDB        		CALL	KEYBC_IFBREAK
  D248  3E04          		LD	A,4
  D24A  CDBEDB        		CALL	MSG_A
                      	
                      	;LDCCP.ASM
                      	
                      	;	LSX-Dodgers CCP
                      	
  D24D                	COMMAND:
  D24D  3AB4EF        		LD	A,(FCB_BAT)
  D250  B7            		OR	A
  D251  C292D3        		JP	NZ,C_BAT1
  D254  CD07D3        		CALL	SETDTA1
  D257  3A87F0        		LD	A,(_DVSW)
  D25A  C641          		ADD	A,'A'
  D25C  CDBEDB        		CALL	MSG_A
  D25F  3E3E          		LD	A,'>'
  D261  CDBEDB        		CALL	MSG_A
  D264  3E50          		LD	A,80
  D266  12            		LD	(DE),A
  D267  CD0DDC        		CALL	_SYS0A		;(BDOS)文字列入力
  D26A  CD95D4        		CALL	LTNL
  D26D                	COMMAND2:
  D26D  118200        		LD	DE,DTA1+2
  D270  CDFDF0        		CALL	_COMANL
  D273  30D8          		JR	NC,COMMAND
  D275  1179F0        		LD	DE,COMERM
  D278  CD61D8        		CALL	_SYS09		;(BDOS)文字列出力
  D27B  C7            		RST	0
                      	
  D27C                	COMANL:
  D27C  CD8BE0        		CALL	FILE
  D27F  3A19F0        		LD	A,(FNAME+4)
  D282  FE20          		CP	020H
  D284  201C          		JR	NZ,COMB2
  D286  D5            		PUSH	DE
  D287  1115F0        		LD	DE,FNAME
  D28A  1A            		LD	A,(DE)
  D28B  FE20          		CP	020H
  D28D  2844          		JR	Z,SDVSW
  D28F  1B            		DEC	DE
  D290  1A            		LD	A,(DE)
  D291  C6FF          		ADD	A,0FFH
  D293  3809          		JR	C,COMB
  D295  13            		INC	DE
                      	
  D296  2103D7        		LD	HL,COMTB
  D299  0609          		LD	B,COMS
  D29B  CD0FE3        		CALL	CPNAME
  D29E                	COMB:
  D29E  D1            		POP	DE
  D29F  D20F00        		JP	NC,JP_HL
  D2A2                	COMB2:
  D2A2  EB            		EX	DE,HL
  D2A3  226FD3        		LD	(COMPAT+1),HL
  D2A6  F5            		PUSH	AF
  D2A7  CD27D3        		CALL	CEXE4
  D2AA  F1            		POP	AF
  D2AB  2115F0        		LD	HL,FNAME
  D2AE  116D00        		LD	DE,FCB2+1	;COMMAND NAME
  D2B1  010B00        		LD	BC,11
  D2B4  EDB0          		LDIR
  D2B6  114EEF        		LD	DE,PATHD
  D2B9                	CEX1:
  D2B9  1A            		LD	A,(DE)
  D2BA  FE20          		CP	020H
  D2BC  D8            		RET	C
  D2BD  CD80E0        		CALL	FILEC
  D2C0  D5            		PUSH	DE
  D2C1  216D00        		LD	HL,FCB2+1	;COMMAND NAME
  D2C4  1115F0        		LD	DE,FNAME
  D2C7  010B00        		LD	BC,11
  D2CA  EDB0          		LDIR
  D2CC  CD27D3        		CALL	CEXE4
  D2CF  D1            		POP	DE
  D2D0  13            		INC	DE
  D2D1  18E6          		JR	CEX1
                      	
  D2D3                	SDVSW:
  D2D3  F1            		POP	AF
  D2D4  3A14F0        		LD	A,(FDRV)
  D2D7  3D            		DEC	A
  D2D8  5F            		LD	E,A
  D2D9  0E0E          		LD	C,00EH		;(BDOS)カレントドライブの設定
  D2DB  1831          		JR	SYSTEM0
                      	
  D2DD                	OPEN1:
  D2DD  2114F0        		LD	HL,FDRV
  D2E0                	OPEN:
  D2E0  0E11          		LD	C,011H		;(BDOS)ファイルの検索
  D2E2                	OPEN3:
  D2E2  D5            		PUSH	DE
  D2E3  118FEF        		LD	DE,DTA_CCP
  D2E6  CD04D3        		CALL	SETDTA
  D2E9  EB            		EX	DE,HL
  D2EA  CD0ED3        		CALL	SYSTEM0
  D2ED  D1            		POP	DE
  D2EE  C9            		RET
                      	
  D2EF                	OPEN2:
  D2EF  0E12          		LD	C,012H
  D2F1  18EF          		JR	OPEN3
                      	
  D2F3                	DEFCB:				;Z=Ok NZ=Error
  D2F3  118FEF        		LD	DE,DTA_CCP
  D2F6  CD0CD3        		CALL	SYSC0F
                      	
  D2F9  11B0EF        		LD	DE,DTA_CCP+33	;(FCB)ランダムレコード
  D2FC  0604          		LD	B,4
  D2FE  CDD3D5        		CALL	ZERO_MEMORY_DE
  D301                	SETDTA100:
  D301  110001        		LD	DE,00100H
  D304                	SETDTA:
  D304  C339DA        		JP	_SYS1A		;(BDOS)DTAの設定
                      	
  D307                	SETDTA1:
  D307  118000        		LD	DE,DTA1
  D30A  18F8          		JR	SETDTA
                      	
  D30C                	SYSC0F:
  D30C  0E0F          		LD	C,00FH		;(BDOS)ファイルのオープン
  D30E                	SYSTEM0:
  D30E  CD0500        		CALL	SYSTEM
  D311  B7            		OR	A
  D312  C9            		RET
                      	
  D313                	C_CD:
  D313  0E5A          		LD	C,5AH
  D315  18F7          		JR	SYSTEM0
                      	
  D317                	S27BUF:
  D317  3A0700        		LD	A,(SYSTEM+2)
  D31A  3D            		DEC	A
  D31B  E6F8          		AND	0F8H
  D31D  67            		LD	H,A
  D31E  2E00          		LD	L,0
  D320                	S27DTA:
  D320  118FEF        		LD	DE,DTA_CCP
  D323                	S27:
  D323  0E27          		LD	C,027H		;(BDOS)ランダムブロック読み込み
  D325  18E7          		JR	SYSTEM0
                      	
  D327                	CEXE4:
  D327  211DF0        		LD	HL,FNAME+8
  D32A  7E            		LD	A,(HL)
  D32B  FE20          		CP	020H
  D32D  2007          		JR	NZ,CEXE7
  D32F  3E3F          		LD	A,'?'
  D331  77            		LD	(HL),A
  D332  23            		INC	HL
  D333  77            		LD	(HL),A
  D334  23            		INC	HL
  D335  77            		LD	(HL),A
  D336                	CEXE7:
  D336  CDDDD2        		CALL	OPEN1
  D339                	CEXE5:
  D339  C0            		RET	NZ
  D33A  2A99EF        		LD	HL,(DTA_CCP+1+9)
  D33D  7C            		LD	A,H
  D33E  CD97E3        		CALL	CAP
  D341  67            		LD	H,A
  D342  7D            		LD	A,L
  D343  CD97E3        		CALL	CAP
  D346  6F            		LD	L,A
  D347  3A98EF        		LD	A,(DTA_CCP+1+8)
  D34A  CD97E3        		CALL	CAP
  D34D  D642          		SUB	'B'
  D34F  282C          		JR	Z,C_BAT
  D351  3D            		DEC	A		;'C'
  D352  2805          		JR	Z,C_EXE
  D354                	CEXE6:
  D354  CDEFD2        		CALL	OPEN2
  D357  18E0          		JR	CEXE5
                      	
  D359                	C_EXE:
  D359  7C            		LD	A,H
  D35A  FE4D          		CP	'M'
  D35C  20F6          		JR	NZ,CEXE6
                      	
  D35E  CDF3D2        		CALL	DEFCB
  D361  CD17D3        		CALL	S27BUF
  D364  3D            		DEC	A
  D365  37            		SCF
  D366  C0            		RET	NZ
  D367  7C            		LD	A,H
  D368  B5            		OR	L
  D369  37            		SCF
  D36A  C8            		RET	Z
  D36B  CD07D3        		CALL	SETDTA1
  D36E  110000        	COMPAT:	LD	DE,0				; self-modifying code
  D371  ED7B0600      		LD	SP,(SYSTEM+1)
  D375  67            		LD	H,A				; A=0 in SETDTA1(_SYS1A)
  D376  6F            		LD	L,A
  D377  E5            		PUSH	HL				; push $0000 (reboot address)
  D378  24            		INC	H
  D379  E5            		PUSH	HL				; push $0100 (TPA address)
  D37A  C39ED5        		JP	SETFCB				; and JP $0100
                      	
  D37D                	C_BAT:
  D37D  114154        		LD	DE,'A'+'T'*256
  D380  ED52          		SBC	HL,DE
  D382  20D0          		JR	NZ,CEXE6
                      	
  D384  CDF3D2        		CALL	DEFCB
                      	
  D387  218FEF        		LD	HL,DTA_CCP
  D38A  11B4EF        		LD	DE,FCB_BAT
  D38D  012500        		LD	BC,37
  D390  EDB0          		LDIR
  D392                	C_BAT1:
  D392  CD01D3        		CALL	SETDTA100
  D395  CDC9D3        		CALL	FGETC_BAT
  D398  218100        		LD	HL,DTA1+1
  D39B  2025          		JR	NZ,END_BATCH
  D39D  FE21          		CP	021H		;スペースや改行など制御文字を飛ばす
  D39F  38F1          		JR	C,C_BAT1
  D3A1  3620          		LD	(HL),' '
  D3A3  23            		INC	HL
  D3A4                	C_BAT2:
  D3A4  77            		LD	(HL),A
  D3A5  23            		INC	HL
  D3A6  7D            		LD	A,L
  D3A7  3C            		INC	A		;L==0FFH
  D3A8  2809          		JR	Z,RUN_BATCH
  D3AA  CDC9D3        		CALL	FGETC_BAT
  D3AD  2004          		JR	NZ,RUN_BATCH
  D3AF  FE20          		CP	020H
  D3B1  30F1          		JR	NC,C_BAT2
  D3B3                	RUN_BATCH:
  D3B3  7D            		LD	A,L
  D3B4  D67F          		SUB	DTA1-1
  D3B6  328000        		LD	(DTA1),A
  D3B9  FE04          		CP	4
  D3BB  3805          		JR	C,END_BATCH
  D3BD  3600          		LD	(HL),0
  D3BF  C36DD2        		JP	COMMAND2
  D3C2                	END_BATCH:
  D3C2  AF            		XOR	A		;バッチファイルを閉じる
  D3C3  32B4EF        		LD	(FCB_BAT),A
  D3C6  C300F0        		JP	CPM_BOOT
                      	
  D3C9                	FGETC_BAT:
  D3C9  11B4EF        		LD	DE,FCB_BAT
  D3CC                	FGETC:				;1文字ずつ読み込む
  D3CC  E5            		PUSH	HL		;Z:成功
  D3CD  210100        		LD	HL,1
  D3D0  CD23D3        		CALL	S27
  D3D3  E1            		POP	HL
  D3D4  3A0001        		LD	A,(00100H)
  D3D7  C9            		RET
                      	
  D3D8                	C_DEL:
  D3D8  CD9ED5        		CALL	SETFCB
  D3DB  CDD4DB        		CALL	_SYS08		;(BDOS)エコーなしコンソール入力
                      	
  D3DE  0E13          		LD	C,013H
  D3E0  180A          		JR	CDEL1		;(BDOS)ファイルの削除
                      	
  D3E2                	C_REN:
  D3E2  CD9ED5        		CALL	SETFCB
  D3E5  3E10          		LD	A,010H		;ディレクトリも対象にする
  D3E7  326900        		LD	(FCB1+13),A	;属性
  D3EA  0E17          		LD	C,017H		;(BDOS)ファイル名の変更
  D3EC                	CDEL1:
  D3EC  115C00        		LD	DE,FCB1
  D3EF  CD0500        		CALL	SYSTEM
  D3F2  C6FF          		ADD	A,0FFH
  D3F4  C9            		RET
                      	
  D3F5                	C_DIR:
  D3F5  CD80E0        		CALL	FILEC
  D3F8  2115F0        		LD	HL,FDRV+1
  D3FB  CDE9D6        		CALL	CWILD1
  D3FE  3EF1          		LD	A,0F1H
  D400  3221F0        		LD	(FDRV+13),A
  D403  CDDDD2        		CALL	OPEN1
  D406                	CDIR1:
  D406  B7            		OR	A
  D407  2008          		JR	NZ,PDSKF
  D409  CD54D4        		CALL	P_NAME
  D40C  CDEFD2        		CALL	OPEN2
  D40F  18F5          		JR	CDIR1
                      	
  D411                	PDSKF:
  D411  3A14F0        		LD	A,(FDRV)
  D414  5F            		LD	E,A
  D415  0E1B          		LD	C,01BH		;(BDOS)ディスク情報の獲得
  D417  CD0500        		CALL	SYSTEM
  D41A  4F            		LD	C,A		;C←1クラスタ辺りの論理セクタ数
  D41B  C601          		ADD	A,001H
  D41D  D8            		RET	C		;Aが0FFHだった場合
  D41E  3E06          		LD	A,8-2
  D420                	PDS1:				;HL=未使用クラスタの総数
  D420  3C            		INC	A
  D421  CB19          		RR	C
  D423  30FB          		JR	NC,PDS1
  D425                	PDS2:				;B←論理セクタのサイズの上位8ビット
  D425  3C            		INC	A
  D426  CB18          		RR	B
  D428  30FB          		JR	NC,PDS2
  D42A  47            		LD	B,A
                      	
  D42B  110000        		LD	DE,0
  D42E                	PDS3:
  D42E  29            		ADD	HL,HL
  D42F  EB            		EX	DE,HL
  D430  ED6A          		ADC	HL,HL
  D432  EB            		EX	DE,HL
  D433  10F9          		DJNZ	PDS3
  D435                	PDSKF1:
  D435  CDCDD4        		CALL	PRDEC_DEHL
  D438  11D9EF        		LD	DE,FREE
  D43B  CD61D8        		CALL	_SYS09		;(BDOS)文字列出力
  D43E  CDBCD4        		CALL	PUTDRV
  D441  3E5C          		LD	A,05CH		;\
  D443  CDBEDB        		CALL	MSG_A
  D446  2A22F0        		LD	HL,(FDRV+14)	;ディレクトリのクラスタ番号
  D449  AF            		XOR	A
  D44A  11FEFF        		LD	DE,0-2
  D44D  19            		ADD	HL,DE
  D44E  23            		INC	HL
  D44F  DCC9D4        		CALL	C,PRDEC_HL
  D452  1841          		JR	LTNL
                      	
  D454                	P_NAME:
  D454  3A90EF        		LD	A,(DTA_CCP+1)
  D457  FE2E          		CP	'.'
  D459  C8            		RET	Z
  D45A  11FFD6        		LD	DE,DIRHD
  D45D  CD61D8        		CALL	_SYS09		;(BDOS)文字列出力
  D460  3A9BEF        		LD	A,(DTA_CCP+1+00BH)
  D463  F5            		PUSH	AF
  D464  0F            		RRCA
  D465  9F            		SBC	A,A
  D466  E60A          		AND	'*'-020H
  D468  C620          		ADD	A,020H
  D46A  CDBEDB        		CALL	MSG_A
  D46D  CDBCD4        		CALL	PUTDRV
  D470  2190EF        		LD	HL,DTA_CCP+1
  D473  CD0DD5        		CALL	FPRNT
                      	
  D476  F1            		POP	AF
  D477  CB67          		BIT	4,A
  D479  2808          		JR	Z,DIR3
  D47B  11F4D6        		LD	DE,DIRMES
  D47E  CD61D8        		CALL	_SYS09		;(BDOS)文字列出力
  D481  180A          		JR	DIR6
  D483                	DIR3:
  D483  ED5BAEEF      		LD	DE,(DTA_CCP+1+01EH)
  D487  2AACEF        		LD	HL,(DTA_CCP+1+01CH)
  D48A  CDCDD4        		CALL	PRDEC_DEHL
  D48D                	DIR6:
  D48D  3AB1F0        		LD	A,(_WIDTH)
  D490  FE29          		CP	40+1
  D492  D42FD5        		CALL	NC,PRTTMS
                      	
  D495                	LTNL:
  D495  1E03          		LD	E,3
  D497  C3CDF0        		JP	_PRINT
                      	
  D49A                	C_PATH:
  D49A  CD62E1        		CALL	SPCUT
  D49D  214EEF        		LD	HL,PATHD
  D4A0  FE21          		CP	021H
  D4A2  300C          		JR	NC,CPATH0
  D4A4                	CPATHP:
  D4A4  7E            		LD	A,(HL)
  D4A5  23            		INC	HL
  D4A6  FE20          		CP	020H
  D4A8  3F            		CCF
  D4A9  30EA          		JR	NC,LTNL
  D4AB  CDBEDB        		CALL	MSG_A
  D4AE  18F4          		JR	CPATHP
  D4B0                	CPATH0:
  D4B0  FE3B          		CP	';'
  D4B2  2001          		JR	NZ,CPATH1
  D4B4  13            		INC	DE
  D4B5                	CPATH1:
  D4B5  EB            		EX	DE,HL
  D4B6  014000        		LD	BC,PATHX
  D4B9  EDB0          		LDIR
  D4BB  C9            		RET
                      	
  D4BC                	PUTDRV:
  D4BC  3A14F0        		LD	A,(FDRV)
  D4BF  C640          		ADD	A,'A'-1
  D4C1  CDBEDB        		CALL	MSG_A
  D4C4  3E3A          		LD	A,':'
  D4C6                	MSG_AR:
  D4C6  C3BEDB        		JP	MSG_A
                      	
  D4C9                	PRDEC_HL:
  D4C9  AF            		XOR	A
  D4CA                	PRDEC_AHL:
  D4CA  5F            		LD	E,A
  D4CB  1600          		LD	D,0
  D4CD                	PRDEC_DEHL:
  D4CD  D5            		PUSH	DE
  D4CE  110FF0        		LD	DE,DECBF
  D4D1  0605          		LD	B,5
  D4D3  CDD3D5        		CALL	ZERO_MEMORY_DE	;A=0
  D4D6  D1            		POP	DE
                      	
  D4D7  0E20          		LD	C,32
  D4D9                	DEC1:
  D4D9  29            		ADD	HL,HL
  D4DA  EB            		EX	DE,HL
  D4DB  ED6A          		ADC	HL,HL
  D4DD  EB            		EX	DE,HL
  D4DE  E5            		PUSH	HL
  D4DF  2113F0        		LD	HL,DECBF+4
  D4E2  0605          		LD	B,5
  D4E4                	DEC2:
  D4E4  7E            		LD	A,(HL)
  D4E5  8F            		ADC	A,A
  D4E6  27            		DAA
  D4E7  77            		LD	(HL),A
  D4E8  2B            		DEC	HL
  D4E9  10F9          		DJNZ	DEC2
  D4EB  E1            		POP	HL
  D4EC  0D            		DEC	C
  D4ED  20EA          		JR	NZ,DEC1
                      	
  D4EF  210FF0        		LD	HL,DECBF
  D4F2  3E20          		LD	A,020H
  D4F4  0604          		LD	B,4
  D4F6                	DEC3:
  D4F6  CD03D5        		CALL	DEC4
  D4F9  CD03D5        		CALL	DEC4
  D4FC  23            		INC	HL
  D4FD  10F7          		DJNZ	DEC3
  D4FF                	DECX:
  D4FF  CD03D5        		CALL	DEC4
  D502  AF            		XOR	A
  D503                	DEC4:
  D503  ED6F          		RLD
  D505  FE20          		CP	020H
  D507  2802          		JR	Z,DEC5
  D509  F630          		OR	030H
  D50B                	DEC5:
  D50B  18B9          		JR	MSG_AR
                      	
  D50D                	FPRNT:
  D50D  0608          		LD	B,8
  D50F  CD20D5        		CALL	P_N1
  D512  7E            		LD	A,(HL)
  D513  C680          		ADD	A,0A0H-020H
  D515  FEA0          		CP	0A0H
  D517  2802          		JR	Z,FPR1
  D519  3E2E          		LD	A,'.'
  D51B                	FPR1:
  D51B  CDBEDB        		CALL	MSG_A
  D51E  0603          		LD	B,3
                      	
  D520                	P_N1:
  D520  C5            		PUSH	BC
  D521  E5            		PUSH	HL
  D522  7E            		LD	A,(HL)
  D523  CDA3E3        		CALL	CAP3
  D526  CDBEDB        		CALL	MSG_A
  D529  E1            		POP	HL
  D52A  C1            		POP	BC
  D52B  23            		INC	HL
  D52C  10F2          		DJNZ	P_N1
  D52E  C9            		RET
                      	
  D52F                	PRTTMS:
  D52F  3E20          		LD	A,020H
  D531  CDBEDB        		CALL	MSG_A
                      	
  D534  2AA8EF        		LD	HL,(DTA_CCP+1+24)
  D537  7D            		LD	A,L
  D538  B7            		OR	A
  D539  C8            		RET	Z
  D53A  CB3C          		SRL	H
  D53C  17            		RLA
  D53D  17            		RLA
  D53E  17            		RLA
  D53F  17            		RLA
  D540  E60F          		AND	00FH
  D542  57            		LD	D,A
  D543  7C            		LD	A,H
  D544  C650          		ADD	A,80
  D546  CD89D5        		CALL	PRDEC_A
  D549  3E2D          		LD	A,'-'
  D54B  CDBEDB        		CALL	MSG_A
  D54E  7A            		LD	A,D
  D54F  CD89D5        		CALL	PRDEC_A
  D552  3E2D          		LD	A,'-'
  D554  CDBEDB        		CALL	MSG_A
  D557  7D            		LD	A,L
  D558  E61F          		AND	01FH
  D55A  CD89D5        		CALL	PRDEC_A
                      	
  D55D  2AA6EF        		LD	HL,(DTA_CCP+1+22)
                      	
  D560  3E20          		LD	A,020H
  D562  CDBEDB        		CALL	MSG_A
  D565  7C            		LD	A,H
  D566  65            		LD	H,L
  D567  0603          		LD	B,3
  D569                	PRTTMS1:
  D569  1F            		RRA
  D56A  CB1D          		RR	L
  D56C  10FB          		DJNZ	PRTTMS1
  D56E  E61F          		AND	01FH
  D570  CD89D5        		CALL	PRDEC_A
  D573  3E3A          		LD	A,':'
  D575  CDBEDB        		CALL	MSG_A
  D578  7D            		LD	A,L
  D579  0F            		RRCA
  D57A  0F            		RRCA
  D57B  E63F          		AND	03FH
  D57D  CD89D5        		CALL	PRDEC_A
  D580  3E3A          		LD	A,':'
  D582  CDBEDB        		CALL	MSG_A
  D585  7C            		LD	A,H
  D586  E61F          		AND	01FH
  D588  87            		ADD	A,A
                      	
                      	;	PRINT10
                      	
  D589                	PRDEC_A:
  D589  E5            		PUSH	HL
  D58A  0608          		LD	B,8
  D58C  4F            		LD	C,A
  D58D  AF            		XOR	A
  D58E                	PRTA1:
  D58E  CB01          		RLC	C
  D590  8F            		ADC	A,A
  D591  27            		DAA
  D592  10FA          		DJNZ	PRTA1
  D594  210FF0        		LD	HL,DECBF
  D597  77            		LD	(HL),A
  D598  AF            		XOR	A
  D599  CDFFD4        		CALL	DECX
  D59C  E1            		POP	HL
  D59D  C9            		RET
                      	
  D59E                	SETFCB:
  D59E  CD62E1        		CALL	SPCUT
  D5A1  1A            		LD	A,(DE)
  D5A2  FE20          		CP	020H
  D5A4  3801          		JR	C,SETFCBA
  D5A6  1B            		DEC	DE
  D5A7                	SETFCBA:
  D5A7  0624          		LD	B,36
  D5A9  215C00        		LD	HL,FCB1
  D5AC  E5            		PUSH	HL
  D5AD  AF            		XOR	A
  D5AE  CD37E1        		CALL	FILL_MEMORY
  D5B1  E1            		POP	HL
  D5B2  D5            		PUSH	DE
  D5B3  CD9FDA        		CALL	_SYS29		;(BDOS)ファイル名の解析
  D5B6  216C00        		LD	HL,FCB2
  D5B9  CD9FDA        		CALL	_SYS29		;(BDOS)ファイル名の解析
  D5BC  E1            		POP	HL
  D5BD  010050        		LD	BC,05000H
  D5C0  118100        		LD	DE,00081H
  D5C3                	SETFCB1:
  D5C3  7E            		LD	A,(HL)
  D5C4  23            		INC	HL
  D5C5  FE20          		CP	020H
  D5C7  3805          		JR	C,SETFCB2
  D5C9  12            		LD	(DE),A
  D5CA  13            		INC	DE
  D5CB  0C            		INC	C
  D5CC  10F5          		DJNZ	SETFCB1
  D5CE                	SETFCB2:
  D5CE  79            		LD	A,C
  D5CF  328000        		LD	(DTA1),A
  D5D2  04            		INC	B
  D5D3                	ZERO_MEMORY_DE:
  D5D3  AF            		XOR	A
  D5D4                	FILL_MEMORY_DE:
  D5D4  12            		LD	(DE),A
  D5D5  13            		INC	DE
  D5D6  10FC          		DJNZ	FILL_MEMORY_DE
  D5D8  C9            		RET
                      	
  D5D9                	C_COPY:
  D5D9  CD9ED5        		CALL	SETFCB
                      	
  D5DC  1161F0        		LD	DE,ZERO
  D5DF  CD83E0        		CALL	FILEC2
  D5E2  216C00        		LD	HL,FCB2
  D5E5  CDA6DA        		CALL	S29X1
                      	
  D5E8  3E10          		LD	A,010H
  D5EA  326900        		LD	(FCB1+13),A
  D5ED  216D00        		LD	HL,FCB2+1
  D5F0  CDE9D6        		CALL	CWILD1
  D5F3                	COPY0:
  D5F3  CDE6D6        		CALL	CWILD
  D5F6  215C00        		LD	HL,FCB1
  D5F9  CDE0D2        		CALL	OPEN
  D5FC  37            		SCF
  D5FD                	COPY1:
  D5FD  C0            		RET	NZ
  D5FE  CDF3D2        		CALL	DEFCB
                      	
  D601  3A9CEF        		LD	A,(DTA_CCP+13)
  D604  CB67          		BIT	4,A
  D606  2821          		JR	Z,COPY1A
                      	
  D608  215D00        		LD	HL,FCB1+1
  D60B  CDC6E4        		CALL	CHKWILD
  D60E  3814          		JR	C,COPY9
                      	
  D610  3E20          		LD	A,020H
  D612  325D00        		LD	(FCB1+1),A
  D615  2AA9EF        		LD	HL,(DTA_CCP+26)
  D618  23            		INC	HL
  D619  226A00        		LD	(FCB1+14),HL
  D61C  18D5          		JR	COPY0
                      	
  D61E                	COPY8:
  D61E  CD61D8        		CALL	_SYS09		;(BDOS)文字列出力
  D621  CD95D4        		CALL	LTNL
  D624                	COPY9:
  D624  CDEFD2        		CALL	OPEN2
  D627  18D4          		JR	COPY1
                      	
  D629                	COPY1A:
  D629  216C00        		LD	HL,FCB2
  D62C  1114F0        		LD	DE,FDRV
  D62F  0191EF        		LD	BC,DTA_CCP+2
  D632  EDA0          		LDI
  D634  3E0B          		LD	A,11
  D636                	COPY2:
  D636  F5            		PUSH	AF
  D637  7E            		LD	A,(HL)
  D638  FE3F          		CP	'?'
  D63A  2001          		JR	NZ,COPY3
  D63C  0A            		LD	A,(BC)
  D63D                	COPY3:
  D63D  12            		LD	(DE),A
  D63E  03            		INC	BC
  D63F  13            		INC	DE
  D640  23            		INC	HL
  D641  F1            		POP	AF
  D642  3D            		DEC	A
  D643  20F1          		JR	NZ,COPY2
  D645  010500        		LD	BC,16-11
  D648  EDB0          		LDIR
  D64A                	PUTNAME:
  D64A  215D00        		LD	HL,FCB1+1
  D64D  CDC6E4        		CALL	CHKWILD
  D650  300B          		JR	NC,PUTN1
  D652  2115F0        		LD	HL,FDRV+1
  D655  CD0DD5        		CALL	FPRNT
  D658  3E20          		LD	A,020H
  D65A  CDBEDB        		CALL	MSG_A
  D65D                	PUTN1:
  D65D  1114F0        		LD	DE,FDRV
  D660  0E16          		LD	C,016H		;(BDOS)ファイルの作成
  D662  CD0ED3        		CALL	SYSTEM0
  D665  2048          		JR	NZ,COPYE2
  D667  67            		LD	H,A		;A=0
  D668  6F            		LD	L,A
  D669  2235F0        		LD	(FDRV+33),HL	;(FCB)ランダムレコード
  D66C  2237F0        		LD	(FDRV+35),HL
  D66F                	COPY6:
  D66F  CD17D3        		CALL	S27BUF
  D672  47            		LD	B,A
  D673  3C            		INC	A
  D674  2831          		JR	Z,COPYE
  D676  7C            		LD	A,H
  D677  B5            		OR	L
  D678  280C          		JR	Z,COPY7
  D67A  1114F0        		LD	DE,FDRV
  D67D  0E26          		LD	C,026H		;(BDOS)ランダムブロック書き込み
  D67F  CD0ED3        		CALL	SYSTEM0
  D682  2023          		JR	NZ,COPYE
  D684  10E9          		DJNZ	COPY6
  D686                	COPY7:
  D686  3A9CEF        		LD	A,(DTA_CCP+13)	;(FCB)属性
  D689  3221F0        		LD	(FDRV+13),A
  D68C  21A3EF        		LD	HL,DTA_CCP+20	;(FCB)タイムスタンプ
  D68F  1128F0        		LD	DE,FDRV+20
  D692  010400        		LD	BC,4
  D695  EDB0          		LDIR
                      	
  D697  1114F0        		LD	DE,FDRV
  D69A  0E10          		LD	C,010H		;(BDOS)ファイルのクローズ
  D69C  CD0ED3        		CALL	SYSTEM0
  D69F  2006          		JR	NZ,COPYE
                      	
  D6A1  1171F0        		LD	DE,OK
  D6A4  C31ED6        		JP	COPY8
                      	
  D6A7                	COPYE:
  D6A7  1114F0        		LD	DE,FDRV
  D6AA  0E13          		LD	C,013H		;(BDOS)ファイルの削除
  D6AC  CD0500        		CALL	SYSTEM
  D6AF                	COPYE2:
  D6AF  37            		SCF
  D6B0  C9            		RET
                      	
  D6B1                	C_TYPE:
  D6B1  CD9ED5        		CALL	SETFCB
  D6B4  215C00        		LD	HL,FCB1
  D6B7  CDE0D2        		CALL	OPEN
  D6BA  37            		SCF
  D6BB                	TYPE1:
  D6BB  C0            		RET	NZ
  D6BC  CDF3D2        		CALL	DEFCB
  D6BF  3E06          		LD	A,6
  D6C1  CDBEDB        		CALL	MSG_A
  D6C4                	TYPE2:
  D6C4  CD17D3        		CALL	S27BUF
  D6C7  C6FE          		ADD	A,0FEH
  D6C9  D8            		RET	C
  D6CA  7C            		LD	A,H
  D6CB  B5            		OR	L
  D6CC  2813          		JR	Z,TYPEE
  D6CE  010001        		LD	BC,00100H
  D6D1                	TYPE3:
  D6D1  0A            		LD	A,(BC)
  D6D2  03            		INC	BC
  D6D3  FE1A          		CP	01AH
  D6D5  280A          		JR	Z,TYPEE
  D6D7  CDBEDB        		CALL	MSG_A
  D6DA  2B            		DEC	HL
  D6DB  7C            		LD	A,H
  D6DC  B5            		OR	L
  D6DD  20F2          		JR	NZ,TYPE3
  D6DF  18E3          		JR	TYPE2
  D6E1                	TYPEE:
  D6E1  CDEFD2        		CALL	OPEN2
  D6E4  18D5          		JR	TYPE1
                      	
  D6E6                	CWILD:
  D6E6  215D00        		LD	HL,FCB1+1
  D6E9                	CWILD1:
  D6E9  7E            		LD	A,(HL)
  D6EA  FE20          		CP	020H
  D6EC  C0            		RET	NZ
  D6ED                	CWILD2:
  D6ED  3E3F          		LD	A,'?'
  D6EF  060B          		LD	B,11
  D6F1  C337E1        		JP	FILL_MEMORY
                      	
  D6F4  20202020203C44	DIRMES:	DB	"     <DIR>$"
  D6FF  20203A24      	DIRHD:	DB	"  :$"
                      	
  D703                	COMTB:
  D703  44202020      		DB	"D   "	;1
  D707  F5D3          		DW	C_DIR
  D709  44495220      		DB	"DIR "	;2
  D70D  F5D3          		DW	C_DIR
  D70F  434F5059      		DB	"COPY"	;3
  D713  D9D5          		DW	C_COPY
  D715  43442020      		DB	"CD  "	;4
  D719  13D3          		DW	C_CD
  D71B  44454C20      		DB	"DEL "	;5
  D71F  D8D3          		DW	C_DEL
  D721  50415448      		DB	"PATH"	;6
  D725  9AD4          		DW	C_PATH
  D727  52454E20      		DB	"REN "	;7
  D72B  E2D3          		DW	C_REN
  D72D  54595045      		DB	"TYPE"	;8
  D731  B1D6          		DW	C_TYPE
  D733  52454D20      		DB	"REM "	;9
  D737  5ED8          		DW	C_REM
                      	
                      	;X1DISK2.ASM
                      	
                      	;	LSX-Dodgers DISK2
                      	;	X1/turbo/Z
                      	
                      	;	GRAPHIC RAM DISK DRIVER
                      	
                      	
  D739                	GDRD:
  D739  C5            		PUSH	BC
  D73A  CD62D7        		CALL	GADR
  D73D  F1            		POP	AF
  D73E                	GDRD1:
  D73E  EDA2          		INI
  D740  04            		INC	B
  D741  0C            		INC	C
  D742  20FA          		JR	NZ,GDRD1
  D744  04            		INC	B
  D745  13            		INC	DE
  D746  3D            		DEC	A
  D747  20F5          		JR	NZ,GDRD1
  D749                	GBANK0:
  D749  3ABFF0        		LD	A,(WK1FD0)
  D74C  E6EF          		AND	0EFH		;BANK0
  D74E  181D          		JR	S1FD0
                      	
  D750                	GDWT:
  D750  C5            		PUSH	BC
  D751  CD62D7        		CALL	GADR
  D754  F1            		POP	AF
  D755                	GDWT1:
  D755  04            		INC	B
  D756  EDA3          		OUTI
  D758  0C            		INC	C
  D759  20FA          		JR	NZ,GDWT1
  D75B  04            		INC	B
  D75C  13            		INC	DE
  D75D  3D            		DEC	A
  D75E  20F5          		JR	NZ,GDWT1
  D760  18E7          		JR	GBANK0
                      	
  D762                	GADR:
  D762  0E00          		LD	C,0
  D764  7B            		LD	A,E
  D765  C640          		ADD	A,040H
  D767  47            		LD	B,A
  D768  3ABFF0        		LD	A,(WK1FD0)
  D76B  F610          		OR	010H		;BANK1
  D76D                	S1FD0:
  D76D  C5            		PUSH	BC
  D76E  32BFF0        		LD	(WK1FD0),A
  D771  01D01F        		LD	BC,01FD0H
  D774  ED79          		OUT	(C),A
  D776  C1            		POP	BC
  D777  C9            		RET
                      	
                      	
                      	;	BANK RAM DISK DRIVER
                      	
  D778                	BDWT:
  D778  3E            		DB	03EH	;LD A,??
  D779  37            		SCF
  D77A  1802          		JR	BRW
                      	
  D77C                	BDRD:
  D77C  3E            		DB	03EH	;LD A,??
  D77D  A7            		AND	A
  D77E                	BRW:
  D77E  F3            		DI
  D77F  32AAD7        		LD	(BRWPAT),A
  D782  ED73CAD7      		LD	(BANKSP),SP
  D786  3ACBD7        		LD	A,(BANKSP_H)
  D789  87            		ADD	A,A
  D78A  3803          		JR	C,BRW0
  D78C  31CAFF        		LD	SP,EXTSP
  D78F                	BRW0:
  D78F  D9            		EXX		;裏レジスタ
  D790  C5            		 PUSH	 BC
  D791  D5            		 PUSH	 DE
  D792  01000B        		 LD	 BC,00B00H	 ;バンクメモリ
  D795  111010        		 LD	 DE,01010H
  D798  D9            		 EXX		;表レジスタ
  D799                	BRW1:
  D799  C5            		PUSH	BC
  D79A  D5            		PUSH	DE
  D79B  EB            		EX	DE,HL
  D79C  29            		ADD	HL,HL
  D79D  29            		ADD	HL,HL
  D79E  7C            		LD	A,H
  D79F  DD860C        		ADD	A,(IX+00CH)	;DPB_0C_MAXCYL
  D7A2  E60F          		AND	00FH	;バンク
  D7A4  65            		LD	H,L
  D7A5  CB3C          		SRL	H	;/2
  D7A7  2E00          		LD	L,0
  D7A9  D9            		EXX		;裏レジスタ
  D7AA  A7            	BRWPAT:	 AND	 A	;自己書き換え(AND A:読み出し/SCF:書き込み)
  D7AB  3808          		 JR	 C,BRWT
  D7AD  57            		 LD	 D,A	 ;D=バンク
  D7AE  D9            		 EXX		;表レジスタ
  D7AF  EB            		EX	DE,HL
  D7B0  CDCED7        		CALL	BTFR
  D7B3  1806          		JR	BRW2
  D7B5                	BRWT:
  D7B5  5F            		 LD	E,A	 ;E=バンク
  D7B6  D9            		 EXX		;表レジスタ
  D7B7  CDCED7        		CALL	BTFR
  D7BA  EB            		EX	DE,HL
  D7BB                	BRW2:
  D7BB  D1            		POP	DE
  D7BC  C1            		POP	BC
  D7BD  13            		INC	DE
  D7BE  10D9          		DJNZ	BRW1
                      	
  D7C0  D9            		EXX		;裏レジスタ
  D7C1  3E10          		 LD	 A,10H
  D7C3  ED79          		 OUT	 (C),A		;メインメモリに切り替える
  D7C5  D1            		 POP	 DE
  D7C6  C1            		 POP	 BC
  D7C7  D9            		 EXX		;表レジスタ
  D7C8  AF            		XOR	A
  D7C9  310000        		LD	SP,0
  D7CB                	BANKSP_H	EQU	$-1
  D7CA                	BANKSP		EQU	$-2
  D7CC  FB            		EI
  D7CD  C9            		RET
                      	
                      	;メインメモリ←→バンクメモリ 512バイトの転送を行う
                      	; DE:転送元アドレス
                      	; HL:転送先アドレス
                      	; 裏BC:バンク切り替えポート(0B00H)
                      	; 裏D:転送元バンク(0-0FH:10Hはメインメモリ)
                      	; 裏E:転送先バンク(0-0FH:10Hはメインメモリ)
                      	
  D7CE                	BTFR:
  D7CE  0600          		LD	B,0	;256回ループ(256*2)
  D7D0                	BTFR1:
  D7D0  D9            		EXX		;裏レジスタ
  D7D1  ED51          		 OUT	 (C),D	 ;BANK(MAIN)
  D7D3  D9            		 EXX		;表レジスタ
  D7D4  1A            		LD	A,(DE)
  D7D5  4F            		LD	C,A
  D7D6  13            		INC	DE
  D7D7  1A            		LD	A,(DE)
  D7D8  13            		INC	DE
  D7D9  D9            		EXX		;裏レジスタ
  D7DA  ED59          		 OUT	 (C),E	 ;MAIN(BANK)
  D7DC  D9            		 EXX		;表レジスタ
  D7DD  71            		LD	(HL),C
  D7DE  23            		INC	HL
  D7DF  77            		LD	(HL),A
  D7E0  23            		INC	HL
  D7E1  10ED          		DJNZ	BTFR1
  D7E3  C9            		RET
                      	
                      	;	EMM DRIVER(DMA)
                      	
                      	
  D7E4                	EDWT:
  D7E4  0E0F          		LD	C,15
  D7E6  1802          		JR	EDWT1
  D7E8                	EDRD:
  D7E8  0E0E          		LD	C,14
  D7EA                	EDWT1:
  D7EA  C5            		PUSH	BC
  D7EB  D5            		PUSH	DE
  D7EC  222CD8        		LD	(DMAB),HL
  D7EF  78            		LD	A,B
  D7F0  87            		ADD	A,A
  D7F1  3D            		DEC	A
  D7F2  3225D8        		LD	(DMALEN+1),A
  D7F5  3C            		INC	A
  D7F6  84            		ADD	A,H	;HL(アドレス)を先に進めておく
  D7F7  67            		LD	H,A
  D7F8  EB            		EX	DE,HL
  D7F9  29            		ADD	HL,HL
  D7FA  DD460C        		LD	B,(IX+00CH)	;DPB_0C_MAXCYL
  D7FD  79            		LD	A,C
  D7FE  DD4E0D        		LD	C,(IX+00DH)	;DPB_0D_MAXSEC
  D801  09            		ADD	HL,BC
  D802  DD4E13        		LD	C,(IX+013H)	;DPB_13_UNITNO
  D805  060D          		LD	B,00DH
  D807  ED49          		OUT	(C),C
  D809  0C            		INC	C
  D80A  ED69          		OUT	(C),L
  D80C  0C            		INC	C
  D80D  ED61          		OUT	(C),H
                      	
  D80F  2120D8        		LD	HL,EDMAD
  D812  CD93DF        		CALL	SETDMA
  D815  CDBBDF        		CALL	GO_DMA
  D818  EB            		EX	DE,HL
  D819  D1            		POP	DE
  D81A  C1            		POP	BC
  D81B                	DMA_ADD_SEC:
  D81B  13            		INC	DE
  D81C  10FD          		DJNZ	DMA_ADD_SEC
  D81E  AF            		XOR	A
  D81F  C9            		RET
                      	
  D820                	EDMAD:
  D820  C3            		DB	0C3H	;WR6 リセット
  D821  7D            		DB	07DH	;WR0 ポートA→ポートB 転送
  D822  030D          		DW	00D03H	;ポートA開始アドレス EMMリード/ライト
  D824  FF01          	DMALEN:	DW	001FFH	;ブロック長(転送サイズ-1)
  D826  2C            		DB	02CH	;WR1 ポートAアドレス固定 I/O
  D827  50            		DB	050H	;WR2 ポートBアドレスインクリメント メモリ
  D828  02            		DB	002H	;ポートBタイミング
  D829  80            		DB	080H	;WR3
  D82A  9A            		DB	09AH	;WR5 WAIT RDY:HIGH
  D82B  AD            		DB	0ADH	;WR4 連続 ポートB開始アドレス
  D82C  0000          	DMAB:	DW	0
  D82E  01            		DB	001H	;WR0 ポートA←ポートB 転送
  D82F                	EMME:
                      	
  06B5                	AT_RE	EQU	EDWT-AT_EDWT
                      	
                      	
                      	;LDOS.ASM
                      	
                      	;	LSX-Dodgers OS
                      	
  D82F                	BDOS0:
  D82F  E5            		PUSH	HL
  D830  79            		LD	A,C
  D831  FE3C          		CP	03CH
  D833  3802          		JR	C,DOS1
  D835  3E3C          		LD	A,03CH
  D837                	DOS1:
  D837  87            		ADD	A,A
  D838  6F            		LD	L,A
  D839  26F1          		LD	H,STABLE/256
  D83B  7E            		LD	A,(HL)
  D83C  2C            		INC	L
  D83D  66            		LD	H,(HL)
  D83E  6F            		LD	L,A
  D83F  E3            		EX	(SP),HL
  D840  79            		LD	A,C
                      	;確認用
                      	;	LD	(0050H),A
  D841  C9            		RET
  D842                	_DOS2:
  D842  FE5A          		CP	05AH		;(BDOS)カレントディレクトリの変更(_CHDIR)
  D844  CAE3DA        		JP	Z,_SYS5A
  D847  FE5C          		CP	05CH		;(BDOS)ファイル名の解析(_PFILE)
  D849  CA9FDA        		JP	Z,_SYS29
  D84C  FE5F          		CP	05FH		;(BDOS)ディスクバッファのフラッシュ(_FLUSH)
  D84E  CADFED        		JP	Z,_SYS5F
  D851  FE6F          		CP	06FH		;(BDOS)MSX-DOS のバージョン番号の獲得(_DOSVER)
  D853  200A          		JR	NZ,_ERROR
  D855  011D01        		LD	BC,011DH
  D858  115501        		LD	DE,VER
  D85B  210000        		LD	HL,MACD
  D85E                	C_REM:
  D85E  AF            		XOR	A
  D85F                	_ERROR:
  D85F  A7            		AND	A
  D860  C9            		RET
                      	
  D861                	_SYS09:		;文字列出力
  D861  D5            		PUSH	DE
  D862                	_SX09:
  D862  1A            		LD	A,(DE)
  D863  13            		INC	DE
  D864  FE24          		CP	'$'
  D866  2831          		JR	Z,SX0E2
  D868  CDBEDB        		CALL	MSG_A
  D86B  18F5          		JR	_SX09
                      	
  D86D                	MSX1:
  D86D  CDBEDB        		CALL	MSG_A
  D870                	MSX:
  D870  7E            		LD	A,(HL)
  D871  23            		INC	HL
  D872  B7            		OR	A
  D873  20F8          		JR	NZ,MSX1
  D875  C9            		RET
                      	
  D876                	_SYS0C:		;(BDOS)バージョン番号の獲得
  D876  212200        		LD	HL,00022H
  D879  7D            		LD	A,L
  D87A  C9            		RET
                      	
  D87B                	_SYS0D:		;(BDOS)ディスクリセット
  D87B  CDDFF0        		CALL	_FFLUSH
  D87E  E5            		PUSH	HL
  D87F  218000        		LD	HL,00080H
  D882  228AF0        		LD	(_DTA),HL
  D885  E1            		POP	HL
  D886  D5            		PUSH	DE
  D887  1E00          		LD	E,0
  D889  3E            		DB	03EH
                      	
  D88A                	_SYS0E:		;(BDOS)カレントドライブの設定
  D88A  D5            		PUSH	DE
  D88B  7B            		LD	A,E
  D88C  DDE5          		PUSH	IX
  D88E  CDDCF0        		CALL	_GETDPB
  D891  DDE1          		POP	IX
  D893  3804          		JR	C,SX0E2
  D895  7B            		LD	A,E
  D896  3287F0        		LD	(_DVSW),A
  D899                	SX0E2:
  D899  D1            		POP	DE
  D89A  C9            		RET
                      	
  D89B                	_SYS0F:		;(BDOS)ファイルのオープン
  D89B  CD74E1        		CALL	SETDRV
  D89E  FD7E1C        		LD	A,(IY+28)	;(FCB)オープンモード
  D8A1  C602          		ADD	A,002H		;Write
  D8A3  2848          		JR	Z,FEND0F
  D8A5  CDC2E4        		CALL	CHKWILDX
                      	
  D8A8  D494E1        		CALL	NC,SOPENX
  D8AB                	_S16XX:
  D8AB  3840          		JR	C,FEND0F
                      					;Directory location
  D8AD  3A9FF0        		LD	A,(_FILEN)
  D8B0  FD7719        		LD	(IY+25),A	;(FCB)ディレクトリロケーション
                      	;				_DIRF
  D8B3  3AA0F0        		LD	A,(_DIRF)
  D8B6  FD771D        		LD	(IY+29),A	;(FCB)ディレクトリモード
                      	;				_FBPS
  D8B9  FD731E        		LD	(IY+30),E	;(FCB)ディレクトリポジション
  D8BC  FD721F        		LD	(IY+31),D
                      	;				Open(Read)
  D8BF  FD361CFF      		LD	(IY+28),0FFH	;(FCB)オープンモード
                      	;				FILENAME
  D8C3  FDE5          		PUSH	IY
  D8C5  D1            		POP	DE
  D8C6  13            		INC	DE
  D8C7  010B00        		LD	BC,11
  D8CA  EDB0          		LDIR
                      	;				Attribute
  D8CC  7E            		LD	A,(HL)
  D8CD  FD770D        		LD	(IY+13),A	;(FCB)属性(アトリビュート)
  D8D0  110B00        		LD	DE,11		;Reserved
  D8D3  19            		ADD	HL,DE
                      						;(FCB)ファイルを最後に変更した時刻
  D8D4  11EAF1        		LD	DE,SDDATA		;(FCB)ファイルを最後に変更した日付
  D8D7  060A          		LD	B,SDDATAE-SDDATA	;(FCB)ファイルの先頭クラスタ
  D8D9                	S16LOOP:				;(FCB)ファイルのサイズ(バイト単位)
  D8D9  1A            		LD	A,(DE)
  D8DA  13            		INC	DE
  D8DB  32E2D8        		LD	(S16PAT+2),A
  D8DE  7E            		LD	A,(HL)
  D8DF  23            		INC	HL
  D8E0  FD7700        	S16PAT:	LD	(IY+0),A
  D8E3  10F4          		DJNZ	S16LOOP
                      	
  D8E5  AF            		XOR	A
  D8E6  FD770C        		LD	(IY+12),A	;(FCB)カレントブロック
  D8E9  FD2291D9      		LD	(OFCB+1),IY
  D8ED                	FEND0F:
  D8ED  1845          		JR	FEND10
                      	
  D8EF                	_SYS10:		;(BDOS)ファイルのクローズ
  D8EF  CD74E1        		CALL	SETDRV
  D8F2  FD7E1C        		LD	A,(IY+28)	;(FCB)オープンモード
  D8F5  D6FE          		SUB	0FEH
  D8F7  37            		SCF
  D8F8  3F            		CCF
  D8F9  2039          		JR	NZ,FEND10
  D8FB                	_S10A:				;Write
  D8FB  FD770E        		LD	(IY+14),A	;(FCB)レコードサイズ/アクセスするディレクトリのクラスタ番号+1
  D8FE  FD770F        		LD	(IY+15),A
                      	
  D901  FD341C        		INC	(IY+28)		;0FEH->0FFH ;オープンモード
  D904  CDBEE5        		CALL	SETTMS
                      	
  D907  FD7E1D        		LD	A,(IY+29)	;(FCB)ディレクトリモード
  D90A  32A0F0        		LD	(_DIRF),A
  D90D  E67F          		AND	07FH
  D90F  32E9EA        		LD	(_SECPS+1),A
  D912  FD5E1E        		LD	E,(IY+30)	;(FCB)ディレクトリポジション
  D915  FD561F        		LD	D,(IY+31)
  D918  CDC8E2        		CALL	READ_DIR
  D91B  3817          		JR	C,FEND10
                      	
  D91D  3AF2E1        	SDECM1:	LD	A,(SDECPAT+1)	;1セクタ辺りのディレクトリエントリ数
  D920  3D            	 	DEC	A		;1024=01FH / 512=00FH / 256=7
  D921  FDA619        		AND	(IY+25)		;(FCB)ディレクトリロケーション
  D924  6F            		LD	L,A
  D925  2600          		LD	H,0
  D927  29            		ADD	HL,HL		;*2
  D928  29            		ADD	HL,HL		;*4
  D929  29            		ADD	HL,HL		;*8
  D92A  29            		ADD	HL,HL		;*16
  D92B  29            		ADD	HL,HL		;*32
  D92C  ED4B7EF1      		LD	BC,(_DTBUF)
  D930  09            		ADD	HL,BC
                      	
  D931  CDD2E4        		CALL	SDIRENT
  D934                	FEND10:
  D934  1842          		JR	FEND
                      	
  D936                	_SYS11:		;(BDOS)最初のファイルの検索
  D936  CD74E1        		CALL	SETDRV
  D939  CDC1E1        		CALL	SOPEN
  D93C                	_S12X1:
  D93C  383A          		JR	C,FEND
  D93E  CD61E2        		CALL	SOPENE2
  D941  ED5B8AF0      		LD	DE,(_DTA)
  D945  3A88F0        		LD	A,(_DRV)
  D948  3C            		INC	A
  D949  12            		LD	(DE),A
  D94A  D5            		PUSH	DE
  D94B  13            		INC	DE
  D94C  012000        		LD	BC,32
  D94F  EDB0          		LDIR
  D951  FD6E0E        		LD	L,(IY+14)	;(FCB)レコードサイズ/アクセスするディレクトリのクラスタ番号+1
  D954  FD660F        		LD	H,(IY+15)
  D957  22F4F1        		LD	(SCDIR),HL
  D95A  2A9AF0        		LD	HL,(_FBPS)
  D95D  22F6F1        		LD	(SFBPS),HL
  D960  2A9FF0        		LD	HL,(_FILEN)
  D963  7C            		LD	A,H
  D964  B7            		OR	A
  D965  2806          		JR	Z,_S12DIR
  D967  3AE9EA        		LD	A,(_SECPS+1)
  D96A  F680          		OR	080H
  D96C  67            		LD	H,A
  D96D                	_S12DIR:
  D96D  22F8F1        		LD	(SFNDF),HL	;Directory position and Flags
  D970  E1            		POP	HL
  D971  1139F0        		LD	DE,SFILE
  D974  0E21          		LD	C,33
  D976                	_S11B:
  D976  EDB0          		LDIR
  D978                	FEND:
  D978  9F            		SBC	A,A		;CF=0 A=0 : CF=1 A=0FFH
  D979                	FENDE:
  D979  FDE1          		POP	IY
  D97B  C1            		POP	BC
  D97C  D1            		POP	DE
  D97D  E1            		POP	HL
  D97E  C9            		RET
                      	
  D97F                	_SYS12:		;(BDOS)次のファイルの検索
  D97F  E5            		PUSH	HL
  D980  D5            		PUSH	DE
  D981  C5            		PUSH	BC
  D982  FDE5          		PUSH	IY
  D984  CD25E2        		CALL	NOPEN
  D987  18B3          		JR	_S12X1
                      	
  D989                	_S16K:
  D989  FD7E1C        		LD	A,(IY+28)	;(FCB)オープンモード
  D98C  FEFD          		CP	0FDH		;Device(0FDH)
  D98E  37            		SCF
  D98F  C8            		RET	Z
                      	
  D990  110000        	OFCB:	LD	DE,0
  D993  D5            		PUSH	DE
  D994  061A          		LD	B,26		;First cluster
  D996                	S16K1:
  D996  13            		INC	DE
  D997  23            		INC	HL
  D998  10FC          		DJNZ	S16K1
                      	
  D99A  1A            		LD	A,(DE)
  D99B  BE            		CP	(HL)
  D99C  2013          		JR	NZ,S16K2
  D99E  13            		INC	DE
  D99F  23            		INC	HL
  D9A0  1A            		LD	A,(DE)
  D9A1  BE            		CP	(HL)
  D9A2  200D          		JR	NZ,S16K2
                      	
  D9A4  E1            		POP	HL
  D9A5  FDE5          		PUSH	IY
  D9A7  D1            		POP	DE
  D9A8  1A            		LD	A,(DE)		;Drive
  D9A9  BE            		CP	(HL)
  D9AA  2006          		JR	NZ,S16K3
                      					;ここはCFが必ず0
  D9AC  ED52          		SBC	HL,DE		;CP HL,DE
  D9AE  37            		SCF
  D9AF  C0            		RET	NZ
  D9B0  E5            		PUSH	HL
  D9B1                	S16K2:
  D9B1  E1            		POP	HL
  D9B2                	S16K3:
  D9B2  FDE5          		PUSH	IY
  D9B4  D1            		POP	DE
  D9B5                	_SYS13:		;(BDOS)ファイルの削除
  D9B5  CD74E1        		CALL	SETDRV
  D9B8  CDF2E3        		CALL	KILL
  D9BB                	FEND13:
  D9BB  18BB          		JR	FEND
                      	
  D9BD                	_SYS14:		;(BDOS)シーケンシャルな読み出し
  D9BD  CD74E1        		CALL	SETDRV
  D9C0  CD2AE6        		CALL	INIT_SEQ
  D9C3                	SREAD:
  D9C3  CD72E6        		CALL	RB_READ
                      	
  D9C6  C601          		ADD	A,001H
  D9C8  38AE          		JR	C,FEND
                      	
  D9CA  7D            		LD	A,L
  D9CB  D601          		SUB	001H
  D9CD                	FENDX:
  D9CD  9F            		SBC	A,A
  D9CE  E603          		AND	3
  D9D0  1F            		RRA
  D9D1  18A6          		JR	FENDE
                      	
  D9D3                	_SYS15:		;(BDOS)シーケンシャルな書き込み
  D9D3  CD74E1        		CALL	SETDRV
  D9D6  CD2AE6        		CALL	INIT_SEQ
  D9D9                	SWRITE:
  D9D9  CD6BE6        		CALL	RB_WRITE
                      	
  D9DC  C6FF          		ADD	A,0FFH
  D9DE  18ED          		JR	FENDX
                      	
  D9E0                	_SYS17:		;(BDOS)ファイル名の変更
  D9E0  CD74E1        		CALL	SETDRV
  D9E3  CD48E4        		CALL	NAME
  D9E6  18D3          		JR	FEND13
                      	
  D9E8                	_SYS16:		;(BDOS)ファイルの作成
  D9E8  CD74E1        		CALL	SETDRV
                      	
  D9EB  CDC2E4        		CALL	CHKWILDX
  D9EE  38CB          		JR	C,FEND13
  D9F0  FD7E01        		LD	A,(IY+1)	;(FCB)主ファイル名
  D9F3  FE05          		CP	5
  D9F5  2805          		JR	Z,_S16X2
  D9F7  FE21          		CP	021H
  D9F9  DABBD9        		JP	C,FEND13
  D9FC                	_S16X2:
                      	;				Clear FCB
  D9FC  FDE5          		PUSH	IY
  D9FE  E1            		POP	HL
  D9FF  011000        		LD	BC,16
  DA02  09            		ADD	HL,BC
  DA03                	_S16X1:
  DA03  70            		LD	(HL),B		;B=0
  DA04  23            		INC	HL
  DA05  0D            		DEC	C
  DA06  20FB          		JR	NZ,_S16X1
                      	
  DA08  CDC3E5        		CALL	SETTMSX
  DA0B  FD360DFF      		LD	(IY+13),0FFH	;(FCB)Attribute
  DA0F  CD94E1        		CALL	SOPENX
  DA12  3F            		CCF
  DA13  CC89D9        		CALL	Z,_S16K
  DA16  D472E2        		CALL	NC,COPEN
  DA19  D4D2E4        		CALL	NC,SDIRENT
  DA1C  C3ABD8        		JP	_S16XX
                      	
  DA1F                	_SYS21:		;(BDOS)ランダムな読み出し
  DA1F  CD74E1        		CALL	SETDRV
  DA22  CD0EE6        		CALL	INIT_RND
  DA25  189C          		JR	SREAD
                      	
  DA27                	_SYS22:		;(BDOS)ランダムな書き込み
  DA27                	_SYS28:		;(BDOS)ランダムな書き込み・その2
  DA27  CD74E1        		CALL	SETDRV
  DA2A  CD0EE6        		CALL	INIT_RND
  DA2D  18AA          		JR	SWRITE
                      	
  DA2F                	_SYS18:		;(BDOS)ログインベクトルの獲得
  DA2F  21FF00        		LD	HL,000FFH
  DA32  AF            		XOR	A
  DA33  C9            		RET
                      	
  DA34                	_SYS19:		;(BDOS)カレントドライブ番号の獲得
  DA34  3A87F0        		LD	A,(_DVSW)
  DA37  A7            		AND	A
  DA38  C9            		RET
                      	
  DA39                	_SYS1A:		;(BDOS)DTAの設定
  DA39  ED538AF0      		LD	(_DTA),DE
  DA3D  AF            		XOR	A
  DA3E  C9            		RET
                      	
  DA3F                	_SYS1B:		;(BDOS)ディスク情報の獲得
  DA3F  7B            		LD	A,E
  DA40  CD87E1        		CALL	GETDRV
  DA43  CDDCF0        		CALL	_GETDPB
  DA46  D4E2F0        		CALL	NC,_RDFATX
  DA49  210000        		LD	HL,0
  DA4C  D49CE5        		CALL	NC,DSKF
                      	
  DA4F  ED5B9DE5      		LD	DE,(MAXCLP+1)	;DPB_08_MAXCL-1
  DA53  1B            		DEC	DE		;DE←クラスタの総数
  DA54  FD2A7CF1      		LD	IY,(_FATBF)	;IY←メモリ上のFATの先頭アドレス
  DA58  9F            		SBC	A,A
  DA59  D8            		RET	C
  DA5A  4F            		LD	C,A		;C=0
  DA5B  DD7E0F        		LD	A,(IX+00FH)	;DPB_0F_BPS
  DA5E  E60F          		AND	00FH
  DA60  47            		LD	B,A
  DA61  DD7E07        		LD	A,(IX+7)	;DPB_07_SECPCL
  DA64  C9            		RET
                      	
  DA65                	_SYS1D:		;(BDOS)書き込みが禁止されているディスクの調査
  DA65  AF            		XOR	A
  DA66  67            		LD	H,A
  DA67  6F            		LD	L,A
  DA68  C9            		RET
                      	
  DA69                	_SYS1F:		;(BDOS)ディスク装置のパラメータの読み出し
  DA69  2100F2        		LD	HL,DEVICE
  DA6C  7B            		LD	A,E
  DA6D  C3DCF0        		JP	_GETDPB
                      	
  DA70                	_SYS23:		;(BDOS)ファイルサイズの獲得
  DA70  E5            		PUSH	HL
  DA71  2A1EF1        		LD	HL,(STABLE+2*00FH)	;ファイルのオープン
  DA74  CD0F00        		CALL	JP_HL
  DA77  381B          		JR	C,_S23X1
                      	
  DA79  D5            		PUSH	DE		;EX DE,IY
  DA7A  FDE3          		EX	(SP),IY		;
                      	;	POP	DE		;
                      	;	PUSH	DE		;DEを破壊しないように注意vv
  DA7C  FD7E10        		LD	A,(IY+16)	;(FCB)ファイルのサイズ(バイト単位)
  DA7F  FD6E11        		LD	L,(IY+17)	;
  DA82  FD6612        		LD	H,(IY+18)	;
  DA85  C5            		PUSH	BC		;
  DA86  FD4613        		LD	B,(IY+19)	;
  DA89  CD00E6        		CALL	GET_CPM_R_SIZE
  DA8C  C1            		POP	BC
  DA8D                	_S24X1:
  DA8D  CD20E6        		CALL	SET_RR_AHL
                      	;	POP	DE		;^^^^^^^^^^^^^^^^^^^^^^^^
                      	;	PUSH	DE		;EX DE,IY
  DA90  FDE3          		EX	(SP),IY		;
  DA92  D1            		POP	DE		;
                      	
  DA93  AF            		XOR	A
  DA94                	_S23X1:
  DA94  E1            		POP	HL
  DA95  C9            		RET
                      	
  DA96                	_SYS24:		;(BDOS)ランダムレコードフィールドの設定
  DA96  E5            		PUSH	HL
  DA97  D5            		PUSH	DE		;EX DE,IY
  DA98  FDE3          		EX	(SP),IY		;
                      	;	POP	DE		;
                      	;	PUSH	DE		;DEを破壊しないように注意vv
  DA9A  CD32E6        		CALL	GETSEQ
  DA9D  18EE          		JR	_S24X1		;^^^^^^^^^^^^^^^^^^^^^^^^
                      	
  DA9F                	_SYS29:		;(BDOS)ファイル名の解析(_PPATH)
  DA9F  C5            		PUSH	BC
  DAA0  E5            		PUSH	HL
  DAA1  CD8BE0        		CALL	FILE
  DAA4  E1            		POP	HL
  DAA5  C1            		POP	BC
  DAA6                	S29X1:
  DAA6  C5            		PUSH	BC
  DAA7  D5            		PUSH	DE
  DAA8  E5            		PUSH	HL
  DAA9  EB            		EX	DE,HL
  DAAA  2114F0        		LD	HL,FDRV
  DAAD  010D00        		LD	BC,13
  DAB0  EDB0          		LDIR
  DAB2  70            		LD	(HL),B		;B=0
  DAB3  0E03          		LD	C,3
  DAB5  EDB0          		LDIR
  DAB7  E1            		POP	HL
  DAB8  D1            		POP	DE
  DAB9  C1            		POP	BC
  DABA  AF            		XOR	A
  DABB  C9            		RET
                      	
  DABC                	_SYS30:		;(BDOS)論理セクタを用いた書き込み
  DABC  C5            		PUSH	BC
  DABD  0183EC        		LD	BC,DWT24B
  DAC0  1804          		JR	S2FX
  DAC2                	_SYS2F:
  DAC2  C5            		PUSH	BC
  DAC3  0173EC        		LD	BC,DRD24B
  DAC6                	S2FX:
  DAC6  ED43DCDA      		LD	(S2FPAT+1),BC
  DACA  CDDFF0        		CALL	_FFLUSH
                      	
  DACD  D5            		PUSH	DE
  DACE  E5            		PUSH	HL
  DACF  7D            		LD	A,L		;Drive
  DAD0  CDD9F0        		CALL	_CHGDRV
  DAD3  3809          		JR	C,S30X2
  DAD5  44            		LD	B,H		;Number of clusters
  DAD6  2A8AF0        		LD	HL,(_DTA)
                      	
  DAD9  0E00          		LD	C,0
  DADB  CD73EC        	S2FPAT:	CALL	DRD24B
  DADE                	S30X2:
  DADE  E1            		POP	HL
  DADF  D1            		POP	DE
  DAE0  C1            		POP	BC
  DAE1  9F            		SBC	A,A
  DAE2  C9            		RET
                      	
  DAE3                	_SYS5A:		;(BDOS)カレントディレクトリの変更
  DAE3  C5            		PUSH	BC
  DAE4  D5            		PUSH	DE
  DAE5  E5            		PUSH	HL
  DAE6  CD80E0        		CALL	FILEC
  DAE9  210000        		LD	HL,0
  DAEC  1114F0        		LD	DE,FDRV
  DAEF  2A4EF1        		LD	HL,(STABLE+2*027H)	;ランダムブロック読み込み
  DAF2  CD0F00        		CALL	JP_HL
  DAF5  18E7          		JR	S30X2
                      	
                      	;X1IO.ASM
                      	
                      	;	LSX-Dodgers IO
                      	;	X1/turbo/Z
                      	
  D85F                	_SYS04	EQU	_ERROR		;(BDOS)外部出力
  D85F                	_SYS05	EQU	_ERROR		;(BDOS)プリンタ出力
  D85F                	_SYS1C	EQU	_ERROR		;(BDOS)ディスクの書き込み禁止化
  D85F                	_SYS1E	EQU	_ERROR		;(BDOS)ファイル属性の設定
  D85F                	_SYS20	EQU	_ERROR		;(BDOS)利用者番号の設定と読み出し
  D85F                	_SYS2E	EQU	_ERROR		;(BDOS)ベリファイ・フラグの設定
                      	
  DAF7                	BIOS:
  DAF7  E5            		PUSH	HL
  DAF8  211080        		LD	HL,08010H
  DAFB  39            		ADD	HL,SP
  DAFC  E1            		POP	HL
  DAFD  300E          		JR	NC,BIOS2
  DAFF                	BIOS1:
  DAFF  CD07DB        		CALL	BIOS3
  DB02  061E          		LD	B,01EH
  DB04  ED79          		OUT	(C),A
  DB06  C9            		RET
  DB07                	BIOS3:
  DB07  C5            		PUSH	BC
  DB08  061D          		LD	B,01DH
  DB0A  ED79          		OUT	(C),A
  DB0C  C9            		RET
  DB0D                	BIOS2:
  DB0D  ED7318DB      		LD	(BIOS_SP),SP	;スタックがBIOS-ROMと被っている場合
  DB11  31CAFF        		LD	SP,EXTSP
  DB14  CDFFDA        		CALL	BIOS1
  DB17  310000        		LD	SP,0
  DB18                	BIOS_SP	EQU	$-2
  DB1A  C9            		RET
                      	
  DB1B                	INT:
  DB1B  F5            		PUSH	AF
  DB1C  E5            		PUSH	HL
  DB1D  C5            		PUSH	BC
                      	
  DB1E  CDC2DE        		CALL	IN49SB
  DB21  67            		LD	H,A
  DB22  CDC2DE        		CALL	IN49SB
  DB25  6F            		LD	L,A
  DB26                	SCEXE:
  DB26  2292F0        		LD	(_KEYD),HL
  DB29  CD59DB        		CALL	KEYSET1
                      	
  DB2C  C1            		POP	BC
  DB2D                	INTPE:
  DB2D  E1            		POP	HL
  DB2E                	INTPE2:
  DB2E  F1            		POP	AF
  DB2F                	INTCTCE:
  DB2F  FB            		EI
  DB30  ED4D          		RETI
                      	
  DB32                	INTCTC2:
  DB32  F5            		PUSH	AF
  DB33  3E00          	INTCPAT:LD	A,000H
  DB35  3D            		DEC	A
  DB36  3234DB        		LD	(INTCPAT+1),A
  DB39  20F3          		JR	NZ,INTPE2
                      	
  DB3B  3A92F0        		LD	A,(_KEYD)
  DB3E  B7            		OR	A
  DB3F  28ED          		JR	Z,INTPE2
  DB41                	KEYSET0:
  DB41  E5            		PUSH	HL
  DB42  2A90F0        		LD	HL,(_KEYPS)
  DB45  7C            		LD	A,H
  DB46  AD            		XOR	L
  DB47  2006          		JR	NZ,INTC2A
                      	
  DB49  2A92F0        		LD	HL,(_KEYD)
  DB4C  CD8DDB        		CALL	KEYSET
  DB4F                	INTC2A:
  DB4F  3A94F0        		LD	A,(_KEYSP)
  DB52  E60F          		AND	00FH
  DB54  3234DB        		LD	(INTCPAT+1),A
                      	
  DB57  18D4          		JR	INTPE
                      	
  DB59                	KEYSET1:
  DB59  CB6C          		BIT	5,H
  DB5B  F5            		PUSH	AF
  DB5C  ED4B8CF0      		LD	BC,(_CTC)
  DB60  78            		LD	A,B
  DB61  B1            		OR	C
  DB62  2006          		JR	NZ,KEYS10E
                      	
  DB64  F1            		POP	AF
  DB65  2026          		JR	NZ,KEYSET
  DB67  F5            		PUSH	AF
  DB68  18D7          		JR	KEYSET0
  DB6A                	KEYS10E:
  DB6A  F1            		POP	AF
  DB6B  C8            		RET	Z
  DB6C  F5            		PUSH	AF
  DB6D  3E03          		LD	A,3		;CTC STOP
  DB6F  ED79          		OUT	(C),A
  DB71  F1            		POP	AF
                      	
  DB72  B7            		OR	A
  DB73  C8            		RET	Z
                      	
  DB74  3EA7          		LD	A,0A7H
  DB76  ED79          		OUT	(C),A
  DB78  3A94F0        		LD	A,(_KEYSP)
  DB7B  ED79          		OUT	(C),A
  DB7D  79            		LD	A,C
  DB7E  E6FC          		AND	0FCH
  DB80  4F            		LD	C,A
  DB81  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  DB83  3EC0          		LD	A,CTC0
  DB85  ED79          		OUT	(C),A
  DB87  3A95F0        		LD	A,(_KEYSP+1)
  DB8A  3234DB        		LD	(INTCPAT+1),A
                      	
  DB8D                	KEYSET:
  DB8D  7D            		LD	A,L
  DB8E  CB74          		BIT	6,H
  DB90  C0            		RET	NZ
  DB91                	KEYBS:
  DB91  B7            		OR	A
  DB92  C8            		RET	Z
  DB93                	KEYBS1:
  DB93  CDABDB        		CALL	KEYBC_IFBREAK
  DB96  E5            		PUSH	HL
  DB97  F5            		PUSH	AF
  DB98  2A90F0        		LD	HL,(_KEYPS)
  DB9B  2C            		INC	L
  DB9C  CBAD          		RES	5,L
  DB9E  7D            		LD	A,L
  DB9F  BC            		CP	H
  DBA0  2815          		JR	Z,POP_AF_HL_SCF_RET
  DBA2  3290F0        		LD	(_KEYPS),A
  DBA5  26FF          		LD	H,KEYBF/256
  DBA7  F1            		POP	AF
  DBA8  77            		LD	(HL),A
  DBA9  E1            		POP	HL
  DBAA  C9            		RET
  DBAB                	KEYBC_IFBREAK:
  DBAB  FE03          		CP	3
  DBAD  C0            		RET	NZ
  DBAE                	KEYBC:
  DBAE  E5            		PUSH	HL
  DBAF  210000        		LD	HL,0
  DBB2  2290F0        		LD	(_KEYPS),HL
  DBB5  E1            		POP	HL
  DBB6  C9            		RET
                      	
  DBB7                	POP_AF_HL_SCF_RET:
  DBB7  F1            		POP	AF
  DBB8  E1            		POP	HL
  DBB9  37            		SCF
  DBBA  C9            		RET
                      	
  DBBB                	_SYS01:		;(BDOS)コンソール入力
  DBBB  CD09F0        		CALL	_SYS07
  DBBE                	MSG_A:
  DBBE  F5            		PUSH	AF
  DBBF  D5            		PUSH	DE
  DBC0  5F            		LD	E,A
  DBC1  CDC7DB        		CALL	_SYS02
  DBC4  D1            		POP	DE
  DBC5  F1            		POP	AF
  DBC6  C9            		RET
                      	
  DBC7                	_SYS02:		;(BDOS)コンソール出力
  DBC7  CDD9DB        		CALL	BREAK
  DBCA  1805          		JR	PRINTX
                      	
  DBCC                	_SYS06:		;(BDOS)コンソール直接入出力
  DBCC  7B            		LD	A,E
  DBCD  3C            		INC	A
  DBCE  CACAF0        		JP	Z,_INKEY
  DBD1                	PRINTX:
  DBD1  C3CDF0        		JP	_PRINT
                      	
  DBD4                	_SYS08:		;(BDOS)エコーなしコンソール入力
  DBD4  CD09F0        		CALL	_SYS07
  DBD7  1804          		JR	BREAK1
  DBD9                	BREAK:
  DBD9  FB            		EI
  DBDA  3A92F0        		LD	A,(_KEYD)
  DBDD                	BREAK1:
  DBDD  FE03          		CP	3		;CTRL+C
  DBDF  CCF4F0        		CALL	Z,_BREAK
  DBE2  FE13          		CP	013H		;CTRL+S
  DBE4  C0            		RET	NZ
                      	
  DBE5                	PAUSE:
  DBE5  CDAEDB        		CALL	KEYBC
                      	
  DBE8                	FLGET:
  DBE8  CDDFF0        		CALL	_FFLUSH
  DBEB  C5            		PUSH	BC
  DBEC  E5            		PUSH	HL
  DBED  ED4B8EF0      		LD	BC,(_TXADR)
  DBF1  CBE8          		SET	5,B
  DBF3  ED60          		IN	H,(C)
  DBF5                	FLGET1:
  DBF5  3A93F0        		LD	A,(_KEYD+1)
  DBF8  0F            		RRCA
  DBF9  0F            		RRCA
  DBFA  E610          		AND	010H
  DBFC  F608          		OR	8
  DBFE  ED68          		IN	L,(C)
  DC00  B5            		OR	L
  DC01  ED79          		OUT	(C),A
  DC03  CDCAF0        		CALL	_INKEY
  DC06  28ED          		JR	Z,FLGET1
  DC08  ED61          		OUT	(C),H
  DC0A  E1            		POP	HL
  DC0B  C1            		POP	BC
  DC0C  C9            		RET
                      	
  DC0D                	_SYS0A:		;(BDOS)文字列入力
  DC0D  C5            		PUSH	BC
  DC0E  E5            		PUSH	HL
  DC0F  D5            		PUSH	DE
  DC10  CD0FE0        		CALL	GETL
  DC13  1120FF        		LD	DE,KBUF
  DC16  E1            		POP	HL
  DC17  E5            		PUSH	HL
  DC18  0E00          		LD	C,0
  DC1A  3004          		JR	NC,SAX0
  DC1C  23            		INC	HL
  DC1D  23            		INC	HL
  DC1E  1808          		JR	SAX4
  DC20                	SAX0:
  DC20  46            		LD	B,(HL)
  DC21  23            		INC	HL
  DC22                	SAX1:
  DC22  23            		INC	HL
  DC23  1A            		LD	A,(DE)
  DC24  13            		INC	DE
  DC25  B7            		OR	A
  DC26  2004          		JR	NZ,SAX2
  DC28                	SAX4:
  DC28  360D          		LD	(HL),00DH
  DC2A  1804          		JR	SAX3
  DC2C                	SAX2:
  DC2C  77            		LD	(HL),A
  DC2D  0C            		INC	C
  DC2E  10F2          		DJNZ	SAX1
  DC30                	SAX3:
  DC30  D1            		POP	DE
  DC31  79            		LD	A,C
  DC32  13            		INC	DE
  DC33  12            		LD	(DE),A
  DC34  1B            		DEC	DE
  DC35  E1            		POP	HL
  DC36  C1            		POP	BC
  DC37  A7            		AND	A
  DC38  C9            		RET
                      	
  DC39                	_SYS0B:		;(BDOS)コンソール状態のチェック
  DC39  CDD9DB        		CALL	BREAK
  DC3C  3A92F0        		LD	A,(_KEYD)
  DC3F  B7            		OR	A
  DC40  C8            		RET	Z
  DC41                	CONSTX:
  DC41  CDDFF0        		CALL	_FFLUSH
  DC44  E5            		PUSH	HL
  DC45  2A90F0        		LD	HL,(_KEYPS)
  DC48  7C            		LD	A,H
  DC49  AD            		XOR	L
  DC4A  E1            		POP	HL
  DC4B  C6FF          		ADD	A,0FFH
  DC4D  9F            		SBC	A,A
  DC4E  C9            		RET
                      	
  DC4F                	_SYS2A:		;(BDOS)日付の獲得
  DC4F  C5            		PUSH	BC
  DC50  3EED          		LD	A,0EDH		;Read calendar
  DC52  CDDDDE        		CALL	COMOUT
  DC55  CD87DC        		CALL	IN49SB_BCD	;YY
  DC58  6F            		LD	L,A
  DC59  2600          		LD	H,0
                      	;	LD	DE,1900		;0076CH
                      	;	CP	90		;90以上は1900年代 1990-1999
                      	;	JR	NC,RDDATE1	;90未満は2000年代 2000-2089
                      	;	LD	E,0D0H		;2000 & 0FFH D=007H
  DC5B  11D007        		LD	DE,2000		;すべて2000年代で処理 2000-2099
  DC5E                	RDDATE1:
  DC5E  19            		ADD	HL,DE
  DC5F  CDC2DE        		CALL	IN49SB		;MW
  DC62  57            		LD	D,A
  DC63  CD87DC        		CALL	IN49SB_BCD	;DD
  DC66  5F            		LD	E,A
  DC67  7A            		LD	A,D
  DC68  0604          		LD	B,4
  DC6A                	RDDATE2:
  DC6A  CB3A          		SRL	D
  DC6C  10FC          		DJNZ	RDDATE2
  DC6E  C1            		POP	BC
  DC6F  E607          		AND	7
  DC71  C9            		RET
                      	
  DC72                	_SYS2C:		;(BDOS)時刻の獲得
  DC72  C5            		PUSH	BC
  DC73  3EEF          		LD	A,0EFH		;Read time
  DC75  CDDDDE        		CALL	COMOUT
  DC78  CD87DC        		CALL	IN49SB_BCD	;TT
  DC7B  67            		LD	H,A
  DC7C  CD87DC        		CALL	IN49SB_BCD	;MM
  DC7F  6F            		LD	L,A
  DC80  CD87DC        		CALL	IN49SB_BCD	;SS
  DC83  57            		LD	D,A
  DC84  C1            		POP	BC
  DC85  AF            		XOR	A
  DC86  C9            		RET
                      	
  DC87                	IN49SB_BCD:
  DC87  CDC2DE        		CALL	IN49SB
                      	;------------------------
                      	;BCDの10進数化
                      	;in
                      	;	A  : BCD
                      	;out
                      	;	A  : 10進数
                      	;------------------------
  DC8A  4F            		LD	C,A
  DC8B  E6F0          		AND	0F0H	;10の位
  DC8D  0F            		RRCA
  DC8E  47            		LD	B,A
  DC8F  0F            		RRCA
  DC90  0F            		RRCA
  DC91  80            		ADD	A,B
  DC92  47            		LD	B,A
  DC93  79            		LD	A,C
  DC94  E60F          		AND	00FH	;1の位
  DC96  80            		ADD	A,B
  DC97  C9            		RET
                      	
  DC98                	ESC1:
  DC98  7B            		LD	A,E
  DC99  FE41          		CP	'A'
  DC9B  CAE0DD        		JP	Z,CTRL1E
  DC9E  FE42          		CP	'B'
  DCA0  CA48DF        		JP	Z,CTRL1F
  DCA3  FE43          		CP	'C'
  DCA5  CAEBDD        		JP	Z,CTRL1C
  DCA8  FE44          		CP	'D'
  DCAA  CAD7DD        		JP	Z,CTRL1D
  DCAD  FE45          		CP	'E'
  DCAF  2802          		JR	Z,CT0CX
  DCB1  FE6A          		CP	'j'
  DCB3                	CT0CX:
  DCB3  CA1BDF        		JP	Z,CTRL0C
  DCB6  FE48          		CP	'H'
  DCB8  CA65DE        		JP	Z,CTRL0B
  DCBB  FE4A          		CP	'J'
  DCBD  CA1EDF        		JP	Z,CTRL06
  DCC0  FE4B          		CP	'K'
  DCC2  2807          		JR	Z,CT05X
  DCC4  FE4C          		CP	'L'
  DCC6  CA5DDF        		JP	Z,CTRL0E
  DCC9  FE54          		CP	'T'
  DCCB                	CT05X:
  DCCB  CA24DE        		JP	Z,CTRL05
  DCCE  FE78          		CP	'x'
  DCD0  2804          		JR	Z,ESC1X
  DCD2  FE79          		CP	'y'
  DCD4  2002          		JR	NZ,ESC1Y
  DCD6                	ESC1X:
  DCD6  3601          		LD	(HL),1
  DCD8                	ESC1Y:
  DCD8  FE3D          		CP	'='
  DCDA  2804          		JR	Z,ESC1W
  DCDC  FE59          		CP	'Y'
  DCDE  2002          		JR	NZ,ESC1Z
  DCE0                	ESC1W:
  DCE0  3602          		LD	(HL),2
  DCE2                	ESC1Z:
  DCE2  FE20          		CP	020H
  DCE4  3802          		JR	C,ESC1C
  DCE6  87            		ADD	A,A
  DCE7  D0            		RET	NC
  DCE8                	ESC1C:
  DCE8  E1            		POP	HL
  DCE9                	ANK:
  DCE9  ED4B8EF0      		LD	BC,(_TXADR)
  DCED  78            		LD	A,B
  DCEE  F638          		OR	038H
  DCF0  47            		LD	B,A
  DCF1  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令	kanji
  DCF3  CB98          		RES	3,B
  DCF5  ED59          		OUT	(C),E		;Text
  DCF7                	KANJIE:
  DCF7  CDACDD        		CALL	PRINTE7
  DCFA                	PRINTE5:
  DCFA  E1            		POP	HL
  DCFB  C1            		POP	BC
  DCFC  AF            		XOR	A
  DCFD  C9            		RET
                      	
  DCFE                	ESC:
  DCFE  21FADC        		LD	HL,PRINTE5
  DD01  E5            		PUSH	HL
  DD02  2124DD        		LD	HL,ESCFLG+1
  DD05  3600          		LD	(HL),0
  DD07  3D            		DEC	A
  DD08  288E          		JR	Z,ESC1
  DD0A  3D            		DEC	A
  DD0B  2009          		JR	NZ,ESC2
  DD0D  3603          		LD	(HL),3
  DD0F  7B            		LD	A,E
  DD10  D620          		SUB	020H
  DD12  3219DD        		LD	(ESCYP+1),A
  DD15  C9            		RET
  DD16                	ESC2:
  DD16  3D            		DEC	A
  DD17  C0            		RET	NZ
  DD18  2600          	ESCYP:	LD	H,0
  DD1A  7B            		LD	A,E
  DD1B  D620          		SUB	020H
  DD1D  6F            		LD	L,A
  DD1E  C3D6F0        		JP	_LOC
                      	
  DD21                	PRINT:
  DD21  C5            		PUSH	BC
  DD22  E5            		PUSH	HL
  DD23  3E00          	ESCFLG:	LD	A,000H
  DD25  B7            		OR	A
  DD26  20D6          		JR	NZ,ESC
                      	
  DD28  3E1F          		LD	A,01FH
  DD2A  BB            		CP	E
  DD2B  3020          		JR	NC,CTRL
  DD2D  01E6DE        	INSFLG:	LD	BC,INSERT
                      	
  DD30  3A1800        		LD	A,(00018H)
  DD33  3C            		INC	A
  DD34  28B3          		JR	Z,ANK
  DD36  3E00          	KANFLG:	LD	A,000H
  DD38  B7            		OR	A
  DD39  2025          		JR	NZ,KANJI2
  DD3B  7B            		LD	A,E
  DD3C  FE80          		CP	080H
  DD3E  38A9          		JR	C,ANK
  DD40  FEA0          		CP	0A0H
  DD42  3804          		JR	C,KANJI1
  DD44  FEE0          		CP	0E0H
  DD46  38A1          		JR	C,ANK
  DD48                	KANJI1:
  DD48  3237DD        		LD	(KANFLG+1),A
  DD4B  18AD          		JR	PRINTE5
                      	
  DD4D                	CTRL:
  DD4D  CD93DD        		CALL	KANCLR
  DD50  7B            		LD	A,E
  DD51  87            		ADD	A,A
  DD52  F680          		OR	080H
  DD54  6F            		LD	L,A
  DD55  26F1          		LD	H,CTRLTB/256
  DD57  7E            		LD	A,(HL)
  DD58  2C            		INC	L
  DD59  66            		LD	H,(HL)
  DD5A  6F            		LD	L,A
  DD5B  CD0F00        		CALL	JP_HL
  DD5E  189A          		JR	PRINTE5
                      	
  DD60                	KANJI2:
  DD60  D5            		PUSH	DE
  DD61  57            		LD	D,A
  DD62  01812F        		LD	BC,02F81H	;SFTJIS
  DD65  DF            		RST	018H
  DD66  01C32F        		LD	BC,02FC3H	;Instead or JISVRM
  DD69  DF            		RST	018H
                      	
  DD6A  ED4B8EF0      		LD	BC,(_TXADR)
  DD6E  78            		LD	A,B
  DD6F  F638          		OR	038H
  DD71  47            		LD	B,A
  DD72  ED51          		OUT	(C),D		;kanji
  DD74  CB98          		RES	3,B
  DD76  ED59          		OUT	(C),E		;Text
  DD78  CDACDD        		CALL	PRINTE7
  DD7B  ED4B8EF0      		LD	BC,(_TXADR)
  DD7F  78            		LD	A,B
  DD80  F638          		OR	038H
  DD82  47            		LD	B,A
  DD83  CBF2          		SET	6,D
  DD85  ED51          		OUT	(C),D		;Kanji
  DD87  CB98          		RES	3,B
  DD89  ED59          		OUT	(C),E		;Text
  DD8B  D1            		POP	DE
  DD8C  AF            		XOR	A
  DD8D  3237DD        		LD	(KANFLG+1),A
  DD90  C3F7DC        		JP	KANJIE
                      	
  DD93                	KANCLR:
  DD93  3A37DD        		LD	A,(KANFLG+1)
  DD96  B7            		OR	A
  DD97  C8            		RET	Z
  DD98  ED4B8EF0      		LD	BC,(_TXADR)
  DD9C  78            		LD	A,B
  DD9D  F638          		OR	038H
  DD9F  47            		LD	B,A
  DDA0  AF            		XOR	A
  DDA1  3237DD        		LD	(KANFLG+1),A
  DDA4  ED79          		OUT	(C),A		;Kanji
  DDA6  CB98          		RES	3,B
  DDA8  3E20          		LD	A,020H
  DDAA  ED79          		OUT	(C),A		;Text
  DDAC                	PRINTE7:
  DDAC  CBA0          		RES	4,B
  DDAE                	PRINTE6:
  DDAE  3A96F0        		LD	A,(_COLORF)
  DDB1                	PRINTE4:
  DDB1  ED79          		OUT	(C),A		;Color
  DDB3  78            		LD	A,B
  DDB4  E607          		AND	7
  DDB6  47            		LD	B,A
  DDB7                	PRINTE2:
  DDB7  03            		INC	BC
  DDB8                	PRINTE3:
  DDB8  2ABAF0        		LD	HL,(_PAGE_MINUS)
  DDBB  A7            		AND	A
  DDBC  ED4A          		ADC	HL,BC
  DDBE                	PRINTE8:
  DDBE  2805          		JR	Z,PRINT2
  DDC0  ED438EF0      		LD	(_TXADR),BC
  DDC4                	CTRL00:
  DDC4  C9            		RET
                      	
  DDC5                	PRINT2:
  DDC5  CD63DF        		CALL	SCR
  DDC8  2ABCF0        		LD	HL,(_WIDTH_MINUS)
  DDCB  09            		ADD	HL,BC
  DDCC                	SET_TXADR_HL:
  DDCC  228EF0        		LD	(_TXADR),HL
  DDCF  C9            		RET
                      	
  DDD0                	CTRL08:
  DDD0  3A2DDD        		LD	A,(INSFLG)
  DDD3  FECD          		CP	0CDH		;CALL ????
  DDD5  2829          		JR	Z,CTRL02
  DDD7                	CTRL1D:
  DDD7  2A8EF0        		LD	HL,(_TXADR)
  DDDA  7C            		LD	A,H
  DDDB  B5            		OR	L
  DDDC  C8            		RET	Z
  DDDD  2B            		DEC	HL
  DDDE  18EC          		JR	SET_TXADR_HL
                      	
  DDE0                	CTRL1E:
  DDE0  ED4B8EF0      		LD	BC,(_TXADR)
  DDE4  2ABCF0        		LD	HL,(_WIDTH_MINUS)
  DDE7  09            		ADD	HL,BC
  DDE8  D0            		RET	NC
  DDE9  18E1          		JR	SET_TXADR_HL
                      	
  DDEB                	CTRL1C:
  DDEB  ED4B8EF0      		LD	BC,(_TXADR)
  DDEF  18C6          		JR	PRINTE2
                      	
  DDF1                	CTRL09:
  DDF1  ED4B8EF0      		LD	BC,(_TXADR)
  DDF5  79            		LD	A,C
  DDF6  E6F8          		AND	0F8H
  DDF8  C608          		ADD	A,8
  DDFA  4F            		LD	C,A
  DDFB  88            		ADC	A,B
  DDFC  91            		SUB	C
  DDFD  47            		LD	B,A
  DDFE  18B8          		JR	PRINTE3
                      	
  DE00                	CTRL02:
  DE00  CDD7DD        		CALL	CTRL1D
  DE03  C8            		RET	Z
  DE04  D5            		PUSH	DE
  DE05  CDD3F0        		CALL	_POS
  DE08  3AB1F0        		LD	A,(_WIDTH)
  DE0B  95            		SUB	L
  DE0C  4F            		LD	C,A
  DE0D  0D            		DEC	C
  DE0E  0638          		LD	B,038H
  DE10  2A8EF0        		LD	HL,(_TXADR)
  DE13  09            		ADD	HL,BC
  DE14  44            		LD	B,H
  DE15  4D            		LD	C,L
  DE16  110020        		LD	DE,02000H	;D:Text E:kanji
  DE19  2A96F0        		LD	HL,(_COLORF)	;L:Color
  DE1C                	C8X1:
  DE1C  CD02DF        		CALL	C12S
  DE1F  0B            		DEC	BC
  DE20  20FA          		JR	NZ,C8X1
  DE22  D1            		POP	DE
  DE23  C9            		RET
                      	
  DE24                	CTRL05:
  DE24  CDD3F0        		CALL	_POS
  DE27  3AB1F0        		LD	A,(_WIDTH)
  DE2A  95            		SUB	L
  DE2B  6F            		LD	L,A
  DE2C                	C08X1:
  DE2C  ED4B8EF0      		LD	BC,(_TXADR)
  DE30                	LINECL:
  DE30  2620          		LD	H,020H
  DE32  3A96F0        		LD	A,(_COLORF)
  DE35  CBE8          		SET	5,B
  DE37                	LINECL1:
  DE37  CBD8          		SET	3,B
  DE39  CBE0          		SET	4,B
  DE3B  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令	kanji
  DE3D  CB98          		RES	3,B
  DE3F  ED61          		OUT	(C),H		;Text
  DE41  CBA0          		RES	4,B
  DE43  ED79          		OUT	(C),A		;Color
  DE45  03            		INC	BC
  DE46  2D            		DEC	L
  DE47  20EE          		JR	NZ,LINECL1
  DE49  C9            		RET
                      	
  DE4A                	CTRL0D:
  DE4A  CDD3F0        		CALL	_POS
  DE4D  2E00          		LD	L,0
  DE4F                	LOC:
  DE4F  C5            		PUSH	BC
  DE50  E5            		PUSH	HL
  DE51  CD93DD        		CALL	KANCLR
  DE54  CD72DE        		CALL	LOC1
  DE57  228EF0        		LD	(_TXADR),HL
  DE5A  E1            		POP	HL
  DE5B  C1            		POP	BC
  DE5C  C9            		RET
                      	
  DE5D                	CTRL12:
  DE5D  212DDD        		LD	HL,INSFLG
  DE60  7E            		LD	A,(HL)
  DE61  EECC          		XOR	0CCH		;CD:CALL ???? 1:LD BC,????
  DE63  77            		LD	(HL),A
  DE64  C9            		RET
                      	
  DE65                	CTRL0B:
  DE65  210000        		LD	HL,0
  DE68  228EF0        		LD	(_TXADR),HL
  DE6B  C9            		RET
                      	
  DE6C                	CTRL1B:
  DE6C  3E01          		LD	A,1
  DE6E  3224DD        		LD	(ESCFLG+1),A
  DE71  C9            		RET
                      	
  DE72                	LOC1:
  DE72  D5            		PUSH	DE
  DE73  4D            		LD	C,L
  DE74  0608          		LD	B,8
  DE76  5C            		LD	E,H
  DE77  1600          		LD	D,0
  DE79  2AB0F0        		LD	HL,(CRTCD)
  DE7C  6A            		LD	L,D
  DE7D                	LOC2:
  DE7D  29            		ADD	HL,HL
  DE7E  3001          		JR	NC,LOC3
  DE80  19            		ADD	HL,DE
  DE81                	LOC3:
  DE81  10FA          		DJNZ	LOC2
  DE83  09            		ADD	HL,BC
  DE84  D1            		POP	DE
  DE85  C9            		RET
                      	
  DE86                	CONOUT1:
  DE86  CD98DE        		CALL	CURSOR
  DE89  59            		LD	E,C
  DE8A  CDCDF0        		CALL	_PRINT
  DE8D  7B            		LD	A,E
  DE8E  FE0A          		CP	00AH
  DE90  2006          		JR	NZ,CURSOR
  DE92  CD4ADE        		CALL	CTRL0D
  DE95  CD24DE        		CALL	CTRL05
  DE98                	CURSOR:
  DE98  C5            		PUSH	BC
  DE99  ED4B8EF0      		LD	BC,(_TXADR)
  DE9D  CBE8          		SET	5,B
  DE9F  ED78          		IN	A,(C)
  DEA1  EE18          		XOR	018H
  DEA3  ED79          		OUT	(C),A
  DEA5  C1            		POP	BC
  DEA6  C9            		RET
                      	
  DEA7                	CTRL07:
  DEA7  2161F0        		LD	HL,BEEPD
  DEAA                	BEEP1:
  DEAA  7E            		LD	A,(HL)
  DEAB  23            		INC	HL
  DEAC  FEFF          		CP	0FFH
  DEAE  C8            		RET	Z
  DEAF  061C          		LD	B,01CH
  DEB1  ED79          		OUT	(C),A
  DEB3  EDA3          		OUTI
  DEB5  18F3          		JR	BEEP1
                      	
  DEB7                	OT49SB:
  DEB7  C5            		PUSH	BC
  DEB8  CDD3DE        		CALL	CANW
  DEBB  010019        		LD	BC,01900H
  DEBE  ED79          		OUT	(C),A
  DEC0  C1            		POP	BC
  DEC1  C9            		RET
                      	
  DEC2                	IN49SB:
  DEC2  C5            		PUSH	BC
  DEC3  01011A        		LD	BC,01A01H
  DEC6                	CANR:
  DEC6  ED78          		IN	A,(C)
  DEC8  E620          		AND	020H
  DECA  20FA          		JR	NZ,CANR
  DECC  010019        		LD	BC,01900H
  DECF  ED78          		IN	A,(C)
  DED1  C1            		POP	BC
  DED2  C9            		RET
                      	
  DED3                	CANW:
  DED3  01011A        		LD	BC,01A01H
  DED6  ED48          		IN	C,(C)
  DED8  CB71          		BIT	6,C
  DEDA  20F7          		JR	NZ,CANW
  DEDC  C9            		RET
                      	
  DEDD                	COMOUT:
  DEDD  FB            		EI
  DEDE  CDB7DE        		CALL	OT49SB
  DEE1  CDD3DE        		CALL	CANW
  DEE4  F3            		DI
  DEE5  C9            		RET
                      	
  DEE6                	INSERT:
  DEE6  D5            		PUSH	DE
  DEE7  CDD3F0        		CALL	_POS
  DEEA  3AB1F0        		LD	A,(_WIDTH)
  DEED  95            		SUB	L
  DEEE  ED4B8EF0      		LD	BC,(_TXADR)
  DEF2  110020        		LD	DE,02000H	;D:Text E:Kanji
  DEF5  2A96F0        		LD	HL,(_COLORF)	;L:Color
  DEF8  CBE8          		SET	5,B
  DEFA                	C12X1:
  DEFA  CD02DF        		CALL	C12S
  DEFD  03            		INC	BC
  DEFE  20FA          		JR	NZ,C12X1
  DF00  D1            		POP	DE
  DF01  C9            		RET
                      	
  DF02                	C12S:
  DF02  CBE0          		SET	4,B
  DF04  CBD8          		SET	3,B
  DF06  ED60          		IN	H,(C)
  DF08  ED59          	X1PAT:	OUT	(C),E
  DF0A  5C            		LD	E,H
  DF0B  CB98          		RES	3,B
  DF0D  ED60          		IN	H,(C)
  DF0F  ED51          		OUT	(C),D
  DF11  54            		LD	D,H
  DF12  CBA0          		RES	4,B
  DF14  ED60          		IN	H,(C)
  DF16  ED69          		OUT	(C),L
  DF18  6C            		LD	L,H
  DF19  3D            		DEC	A
  DF1A  C9            		RET
                      	
  DF1B                	CTRL0C:
  DF1B  CD65DE        		CALL	CTRL0B
  DF1E                	CTRL06:
  DF1E  ED4B8EF0      		LD	BC,(_TXADR)
  DF22                	C1AX1:
  DF22  78            		LD	A,B
  DF23  F638          		OR	038H
  DF25  47            		LD	B,A
  DF26  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令	kanji
  DF28  CB98          		RES	3,B
  DF2A  3E20          		LD	A,020H
  DF2C  ED79          		OUT	(C),A		;Text
  DF2E  CBA0          		RES	4,B
  DF30  3A96F0        		LD	A,(_COLORF)
  DF33  ED79          		OUT	(C),A		;Color
  DF35  03            		INC	BC
  DF36  CBA8          		RES	5,B
  DF38  2ABAF0        		LD	HL,(_PAGE_MINUS)
  DF3B  09            		ADD	HL,BC
  DF3C  30E4          		JR	NC,C1AX1
  DF3E  C9            		RET
                      	
  DF3F                	CTRL04:
  DF3F  CDD3F0        		CALL	_POS
  DF42  7D            		LD	A,L
  DF43  B7            		OR	A
  DF44  C8            		RET	Z
  DF45                	CTRL03:
  DF45  CD4ADE        		CALL	CTRL0D
  DF48                	CTRL0A:
  DF48                	CTRL1F:
  DF48  ED4B8EF0      		LD	BC,(_TXADR)
  DF4C  2AB1F0        		LD	HL,(_WIDTH)
  DF4F  2600          		LD	H,0
  DF51  09            		ADD	HL,BC
  DF52  44            		LD	B,H
  DF53  4D            		LD	C,L
  DF54  2ABAF0        		LD	HL,(_PAGE_MINUS)
  DF57  09            		ADD	HL,BC
  DF58  3F            		CCF
  DF59  9F            		SBC	A,A
  DF5A  C3BEDD        		JP	PRINTE8
                      	
  DF5D                	CTRL0E:
  DF5D  CDD3F0        		CALL	_POS
  DF60  7C            		LD	A,H
  DF61  1804          		JR	SCR1
  DF63                	SCR:
  DF63  3A97F0        		LD	A,(_LINE)
  DF66  3D            		DEC	A
  DF67                	SCR1:
  DF67  C5            		PUSH	BC
  DF68  D5            		PUSH	DE
  DF69  F5            		PUSH	AF
  DF6A  3E07          		LD	A,7
  DF6C  219DDF        		LD	HL,SCRDMAD
  DF6F  CD93DF        		CALL	SETDMA
  DF72  F1            		POP	AF
  DF73  210038        		LD	HL,03800H
                      	
  DF76                	SCRUP1:
  DF76  B7            		OR	A
  DF77  284D          		JR	Z,SCRCL
  DF79  F5            		PUSH	AF
  DF7A  CDA4DF        		CALL	UPSUB		;kanji
  DF7D  3ABCF0        		LD	A,(_WIDTH_MINUS)
  DF80  5F            		LD	E,A
  DF81  16F7          		LD	D,0F7H
  DF83  19            		ADD	HL,DE
  DF84  D5            		PUSH	DE
  DF85  CDA4DF        		CALL	UPSUB		;Text
  DF88  D1            		POP	DE
  DF89  19            		ADD	HL,DE
  DF8A  CDA4DF        		CALL	UPSUB		;Color
  DF8D  CBE4          		SET	4,H
  DF8F  F1            		POP	AF
  DF90  3D            		DEC	A
  DF91  18E3          		JR	SCRUP1
                      	
  DF93                	SETDMA:
  DF93  01871F        		LD	BC,01F87H
  DF96                	SDMA:
  DF96  04            		INC	B
  DF97  EDA3          		OUTI
  DF99  3D            		DEC	A
  DF9A  20FA          		JR	NZ,SDMA
  DF9C  C9            		RET
                      	
  DF9D                	SCRDMAD:
  DF9D  C3            		DB	0C3H		;WR6 リセット
  DF9E  9A            		DB	09AH		;WR5 ストップ WAIT READY:HIGH
  DF9F  65            		DB	065H		;WR0 ブロック長(LH)
  DFA0  4F00          		DW	79
  DFA2  1C            		DB	01CH		;WR1 ポートAインクリメント I/O
  DFA3  18            		DB	018H		;WR0 ポートAアドレス(LH)
                      	
  DFA4                	UPSUB:
  DFA4  3AB1F0        		LD	A,(_WIDTH)
  DFA7  5F            		LD	E,A
  DFA8  1600          		LD	D,0
  DFAA  3ECD          		LD	A,0CDH		;WR4 バースト ポートB開始アドレス(LH)
  DFAC  ED79          		OUT	(C),A
  DFAE  ED69          		OUT	(C),L		;SOURCE
  DFB0  ED61          		OUT	(C),H
  DFB2  19            		ADD	HL,DE
  DFB3  3E1D          		LD	A,01DH		;WR0 ポートA開始アドレス(LH) ポートA→ポートB 転送
  DFB5  ED79          		OUT	(C),A
  DFB7  ED69          		OUT	(C),L		;DEST
  DFB9  ED61          		OUT	(C),H
  DFBB                	GO_DMA:
  DFBB  3ECF          		LD	A,0CFH
  DFBD  ED79          		OUT	(C),A		;WR6 ロード
  DFBF  3EB3          		LD	A,0B3H
  DFC1  ED79          		OUT	(C),A		;WR6 強制RDY
  DFC3  ED49          		OUT	(C),C		;WR6 イネーブル
  DFC5  C9            		RET
                      	
  DFC6                	SCRCL:
  DFC6  44            		LD	B,H
  DFC7  4D            		LD	C,L
  DFC8  2AB1F0        		LD	HL,(_WIDTH)
  DFCB  CD30DE        		CALL	LINECL
  DFCE  D1            		POP	DE
  DFCF  C1            		POP	BC
  DFD0  C9            		RET
                      	
  DFD1                	SCRN:
  DFD1  D5            		PUSH	DE
  DFD2  ED58          		IN	E,(C)		;Text
  DFD4  3A1800        		LD	A,(00018H)
  DFD7  3C            		INC	A
  DFD8  281E          		JR	Z,SCRN2
  DFDA  CBD8          		SET	3,B
  DFDC  ED50          		IN	D,(C)		;Kanji
  DFDE  2816          		JR	Z,SCRN1
  DFE0  AF            		XOR	A
  DFE1  C5            		PUSH	BC
  DFE2  013730        		LD	BC,03037H	;VRMJIS
  DFE5  DF            		RST	018H
  DFE6  01522F        		LD	BC,02F52H	;JISSFT
  DFE9  DF            		RST	018H
  DFEA  C1            		POP	BC
  DFEB  ED78          		IN	A,(C)
  DFED  CB98          		RES	3,B
  DFEF  E640          		AND	040H
  DFF1  2005          		JR	NZ,SCRN2
  DFF3  7A            		LD	A,D
  DFF4  D1            		POP	DE
  DFF5  C9            		RET
  DFF6                	SCRN1:
  DFF6  CB98          		RES	3,B
  DFF8                	SCRN2:
  DFF8  7B            		LD	A,E
  DFF9  D1            		POP	DE
  DFFA  C9            		RET
  DFFB                	SCRNE:
  DFFB                	POS:
  DFFB  2A8EF0        		LD	HL,(_TXADR)
  DFFE  C5            		PUSH	BC
  DFFF  ED4BBCF0      		LD	BC,(_WIDTH_MINUS)
  E003  AF            		XOR	A
  E004                	POS1:
  E004  09            		ADD	HL,BC
  E005  3C            		INC	A
  E006  38FC          		JR	C,POS1
  E008  ED42          		SBC	HL,BC
  E00A  3D            		DEC	A
  E00B  67            		LD	H,A
  E00C  C1            		POP	BC
  E00D  A7            		AND	A
  E00E  C9            		RET
                      	
  E00F                	GETL:
  E00F  CDD3F0        		CALL	_POS
  E012  E5            		PUSH	HL
  E013  3ECD          		LD	A,0CDH		;CALL ????
  E015  322DDD        		LD	(INSFLG),A
  E018                	GETL1:
  E018  CDD4DB        		CALL	_SYS08
  E01B  FE09          		CP	9
  E01D  2008          		JR	NZ,GETL1V
  E01F  2120FF        		LD	HL,KBUF
  E022  CD70D8        		CALL	MSX
  E025  18F1          		JR	GETL1
  E027                	GETL1V:
  E027  5F            		LD	E,A
  E028  CDCDF0        		CALL	_PRINT
                      	
  E02B  7B            		LD	A,E
  E02C  FE0D          		CP	00DH
  E02E  20E8          		JR	NZ,GETL1
  E030  3E01          		LD	A,1		;LD BC,????
  E032  322DDD        		LD	(INSFLG),A
  E035  1120FF        		LD	DE,KBUF
  E038  3AB1F0        		LD	A,(_WIDTH)
  E03B  47            		LD	B,A
  E03C  CDD3D5        		CALL	ZERO_MEMORY_DE
                      	
  E03F  D1            		POP	DE
  E040  CDD3F0        		CALL	_POS
  E043  6B            		LD	L,E
  E044  3AB1F0        		LD	A,(_WIDTH)
  E047  95            		SUB	L
  E048  57            		LD	D,A
  E049  CD72DE        		CALL	LOC1
  E04C  4D            		LD	C,L
  E04D  7C            		LD	A,H
  E04E  F630          		OR	030H
  E050  47            		LD	B,A
  E051  5A            		LD	E,D
  E052  2120FF        		LD	HL,KBUF
  E055                	GETL2:
  E055  CDD0F0        		CALL	_SCRN
  E058  03            		INC	BC
  E059  77            		LD	(HL),A
  E05A  23            		INC	HL
  E05B  1D            		DEC	E
  E05C  20F7          		JR	NZ,GETL2
  E05E                	GETL3:
  E05E  2B            		DEC	HL
  E05F  7E            		LD	A,(HL)
  E060  FE21          		CP	021H
  E062  D0            		RET	NC
  E063  3600          		LD	(HL),0
  E065  15            		DEC	D
  E066  20F6          		JR	NZ,GETL3
  E068  C9            		RET
                      	
  E069                	INKEY:
  E069  FB            		EI
  E06A  E5            		PUSH	HL
  E06B  2A90F0        		LD	HL,(_KEYPS)
  E06E  7C            		LD	A,H
  E06F  AD            		XOR	L
  E070  280B          		JR	Z,INKEY1
  E072  7C            		LD	A,H
  E073  3C            		INC	A
  E074  E61F          		AND	01FH
  E076  3291F0        		LD	(_KEYPS+1),A
  E079  6F            		LD	L,A
  E07A  26FF          		LD	H,KEYBF/256
  E07C  7E            		LD	A,(HL)
  E07D                	INKEY1:
  E07D  E1            		POP	HL
  E07E  B7            		OR	A
  E07F  C9            		RET
                      	
  0F4B                	AT_RS	EQU	SCR1-AT_SCR1
                      	
                      	;LDFILE.ASM
                      	
                      	;	LSX-Dodgers FILE
                      	
  E080                	FILEC:
  E080  CD8BE0        		CALL	FILE
  E083                	FILEC2:
  E083  3A15F0        		LD	A,(FDRV+1)
  E086  FE20          		CP	020H
  E088  C8            		RET	Z
  E089  1839          		JR	SETDIR1
                      	
  E08B                	FILE:
  E08B  AF            		XOR	A
  E08C  3214F0        		LD	(FDRV),A
  E08F  67            		LD	H,A
  E090  6F            		LD	L,A
  E091  2222F0        		LD	(FDRV+14),HL
  E094  CD62E1        		CALL	SPCUT
  E097  CD47E1        		CALL	CCHK3
  E09A  2812          		JR	Z,DEVI1
  E09C  13            		INC	DE
  E09D  1A            		LD	A,(DE)
  E09E  1B            		DEC	DE
  E09F  FE3A          		CP	':'
  E0A1  200B          		JR	NZ,DEVI1
  E0A3  1A            		LD	A,(DE)		;DRIVE
  E0A4  CD97E3        		CALL	CAP
  E0A7  D640          		SUB	'@'
  E0A9  13            		INC	DE
  E0AA  13            		INC	DE
  E0AB  3214F0        		LD	(FDRV),A
  E0AE                	DEVI1:
  E0AE  1A            		LD	A,(DE)
  E0AF  D65C          		SUB	05CH		;\
  E0B1  2009          		JR	NZ,NOROOT
  E0B3  6F            		LD	L,A		;A=0でH=0のはずなのでHL=0
  E0B4  222EF0        		LD	(FDRV+26),HL
  E0B7  2C            		INC	L
  E0B8  2222F0        		LD	(FDRV+14),HL
  E0BB  13            		INC	DE
  E0BC                	NOROOT:
                      	
  E0BC                	SETDIR:
  E0BC  CDE8E0        		CALL	FILED
  E0BF  1A            		LD	A,(DE)
  E0C0  FE5C          		CP	05CH		;\
  E0C2  C0            		RET	NZ
  E0C3  13            		INC	DE
  E0C4                	SETDIR1:
  E0C4  3E10          		LD	A,010H		;Directory
  E0C6  3221F0        		LD	(FDRV+13),A
  E0C9  D5            		PUSH	DE
  E0CA  1114F0        		LD	DE,FDRV
  E0CD  2A1EF1        		LD	HL,(STABLE+2*00FH)
  E0D0  CD0F00        		CALL	JP_HL
  E0D3  D1            		POP	DE
  E0D4  B7            		OR	A
  E0D5  C0            		RET	NZ
                      	
  E0D6  3A21F0        		LD	A,(FDRV+13)
  E0D9  CB67          		BIT	4,A
  E0DB  C8            		RET	Z
                      	
  E0DC  CD2FE1        		CALL	FILEI
  E0DF  2A2EF0        		LD	HL,(FDRV+26)
  E0E2  23            		INC	HL
  E0E3  2222F0        		LD	(FDRV+14),HL
  E0E6  18D4          		JR	SETDIR
                      	
  E0E8                	FILED:
  E0E8  CD2FE1        		CALL	FILEI
  E0EB  2115F0        		LD	HL,FNAME
                      	
  E0EE  0608          		LD	B,8
  E0F0                	FILE2:
  E0F0  CD3CE1        		CALL	CCHKF
  E0F3  C8            		RET	Z
  E0F4  FE2A          		CP	'*'
  E0F6  282E          		JR	Z,FILE9
  E0F8  FE2E          		CP	'.'
  E0FA  280C          		JR	Z,FILE4
  E0FC  77            		LD	(HL),A
  E0FD  23            		INC	HL
  E0FE  10F0          		DJNZ	FILE2
                      	
  E100                	FILE3:
  E100  CD3CE1        		CALL	CCHKF
  E103  C8            		RET	Z
  E104  FE2E          		CP	'.'
  E106  20F8          		JR	NZ,FILE3
                      	
  E108                	FILE4:
  E108  211DF0        		LD	HL,FNAME+8
  E10B  0603          		LD	B,3
                      	
  E10D                	FILE4L:
  E10D  CD3CE1        		CALL	CCHKF
  E110  C8            		RET	Z
  E111  FE2E          		CP	'.'
  E113  2008          		JR	NZ,FILE12
  E115  3215F0        		LD	(FNAME),A	;Parent directory(..)
  E118  3216F0        		LD	(FNAME+1),A
  E11B  3E20          		LD	A,020H
  E11D                	FILE12:
  E11D  FE2A          		CP	'*'
  E11F  280A          		JR	Z,FILE10
  E121  77            		LD	(HL),A
  E122  23            		INC	HL
  E123  10E8          		DJNZ	FILE4L
  E125  C9            		RET
                      	
  E126                	FILE9:				;名前の*処理、名前の残りを?で埋める
  E126  CD2BE1        		CALL	FILE10
  E129  18D5          		JR	FILE3
                      	
  E12B                	FILE10:
  E12B  3E3F          		LD	A,'?'
  E12D  1808          		JR	FILL_MEMORY
  E12F                	FILEI:				;名前＋拡張子をスペースで初期化
  E12F  3E20          		LD	A,020H
  E131  01000B        		LD	BC,11*256	;C=0にしておく
  E134  2115F0        		LD	HL,FNAME
  E137                	FILL_MEMORY:			;HLからBバイトAで埋める
  E137  77            		LD	(HL),A
  E138  23            		INC	HL
  E139  10FC          		DJNZ	FILL_MEMORY
  E13B  C9            		RET
                      	
  E13C                	CCHKF:
  E13C  1A            		LD	A,(DE)
  E13D  CD44E1        		CALL	CCHK2
  E140  C8            		RET	Z
  E141  C3AFE4        		JP	FKAN
                      	
  E144                	CCHK2:
  E144  0C            		INC	C
  E145  0D            		DEC	C
  E146  C0            		RET	NZ
  E147                	CCHK3:				;ZF=1 で使えない文字
  E147  FE2B          		CP	'+'
  E149  C8            		RET	Z
  E14A  FE2C          		CP	','
  E14C  C8            		RET	Z
  E14D  FE2F          		CP	'/'
  E14F  C8            		RET	Z
  E150  FE3A          		CP	':'
  E152  C8            		RET	Z
  E153  FE3B          		CP	';'
  E155  C8            		RET	Z
  E156  FE3D          		CP	'='
  E158  C8            		RET	Z
  E159  FE5C          		CP	05CH	;\
  E15B  C8            		RET	Z
  E15C  FE20          		CP	020H
  E15E  D0            		RET	NC
  E15F  BF            		CP	A		;Z=1
  E160  C9            		RET
                      	
  E161                	SS1:
  E161  13            		INC	DE
  E162                	SPCUT:				;スペースをカット
  E162  1A            		LD	A,(DE)
  E163  FE20          		CP	020H
  E165  28FA          		JR	Z,SS1
  E167  C9            		RET
                      	
  E168                	SETDRVF:
  E168  1114F0        		LD	DE,FDRV
  E16B                	SETDRV0:
  E16B  CD74E1        		CALL	SETDRV
  E16E  FDE1          		POP	IY
  E170  C1            		POP	BC
  E171  D1            		POP	DE
  E172  E1            		POP	HL
  E173  C9            		RET
                      	
  E174                	SETDRV:
  E174  E3            		EX	(SP),HL		;HL=RETRN ADDRESS
  E175  D5            		PUSH	DE		;PUSH HL/DE/BC/IY
  E176  C5            		PUSH	BC
  E177  1A            		LD	A,(DE)
  E178  D5            		PUSH	DE
  E179  FDE3          		EX	(SP),IY
                      	
  E17B  CD87E1        		CALL	GETDRV
  E17E  3C            		INC	A
  E17F  FD7700        		LD	(IY+0),A	;(FCB)ドライブ番号
  E182  3D            		DEC	A
  E183  CDD9F0        		CALL	_CHGDRV
                      	
  E186  E9            		JP	(HL)
                      	
  E187                	GETDRV:
  E187  E67F          		AND	07FH
  E189  D601          		SUB	001H
  E18B  3003          		JR	NC,GETDRV1
  E18D  3A87F0        		LD	A,(_DVSW)	;Current Drive
  E190                	GETDRV1:
  E190  3288F0        		LD	(_DRV),A
  E193  C9            		RET
                      	
  E194                	SOPENX:
  E194  1139F0        		LD	DE,SFILE
  E197  1A            		LD	A,(DE)
  E198  FDBE00        		CP	(IY+0)		;(FCB)ドライブ番号
  E19B  2024          		JR	NZ,SOPEN
  E19D  13            		INC	DE
  E19E  FDE5          		PUSH	IY
  E1A0  E1            		POP	HL
  E1A1  23            		INC	HL
  E1A2  CD2FE3        		CALL	CPFILE
  E1A5  201A          		JR	NZ,SOPEN
                      	
  E1A7  2AF4F1        		LD	HL,(SCDIR)
  E1AA  FD750E        		LD	(IY+14),L	;(FCB)アクセスするディレクトリのクラスタ番号+1
  E1AD  FD740F        		LD	(IY+15),H
                      	
  E1B0  2AF8F1        		LD	HL,(SFNDF)	;Direcroty location and Flags
  E1B3  229FF0        		LD	(_FILEN),HL
                      	
  E1B6  ED5BF6F1      		LD	DE,(SFBPS)
  E1BA  2139F0        		LD	HL,SFILE
  E1BD  36FF          		LD	(HL),0FFH
  E1BF  23            		INC	HL
  E1C0  C9            		RET
  E1C1                	SOPEN:
  E1C1  21D7E2        		LD	HL,FILESE
  E1C4                	SOPENC:
  E1C4  22FDE1        		LD	(OPENPAT+1),HL
                      	
  E1C7  CDE2F0        		CALL	_RDFATX		;Detect Media
  E1CA  3856          		JR	C,RDDERR
                      	
  E1CC  AF            		XOR	A
  E1CD  329FF0        		LD	(_FILEN),A
  E1D0  CDDCE3        		CALL	LDDIRX1		;A=0で呼び出す
  E1D3  2818          		JR	Z,SDIRX1
                      	
  E1D5  CDC8E2        		CALL	READ_DIR	;Sub Directory
  E1D8  3808          		JR	C,SDIRX0
  E1DA  2A7EF1        		LD	HL,(_DTBUF)
  E1DD  7E            		LD	A,(HL)
  E1DE  FE2E          		CP	'.'
  E1E0  280F          		JR	Z,SOPEN1
  E1E2                	SDIRX0:
  E1E2  AF            		XOR	A
  E1E3  32A0F0        		LD	(_DIRF),A
  E1E6  FD360E01      		LD	(IY+14),1	;(FCB)レコードサイズ
  E1EA  FD770F        		LD	(IY+15),A
  E1ED                	SDIRX1:
  E1ED  ED5BFCF1      		LD	DE,(_DIRPS)	;Root Directory
  E1F1                	SOPEN1:
  E1F1  0E20          	SDECPAT:LD	C,32		;自己書き換え 1セクタ辺りのディレクトリエントリ数  1024=32 / 512=16 / 256=8
  E1F3                	SOPEN1X:
  E1F3  CDC8E2        		CALL	READ_DIR	;FILE SEARCH
  E1F6  382A          		JR	C,RDDERR
  E1F8  2A7EF1        		LD	HL,(_DTBUF)
  E1FB                	SOPEN2:
  E1FB  D5            		PUSH	DE
  E1FC  CDD7E2        	OPENPAT:CALL	FILESE		;(self-modifying code)
  E1FF  D1            		POP	DE
  E200  386E          		JR	C,SOPENE
  E202  281B          		JR	Z,SCF_FF_RET
  E204                	SOPEN3:
  E204  3AA0F0        		LD	A,(_DIRF)	;ディレクトリか判別
  E207  B7            		OR	A
  E208  200C          		JR	NZ,SOPEN5
  E20A  13            		INC	DE		;ルートディレクトリ
  E20B  E5            		PUSH	HL
  E20C  210C00        	MD_PAT:	LD	HL,12		;(self-modifying code)MAXDIR
  E20F  ED52          		SBC	HL,DE		;CF=0 なので SUB HL,DE
  E211  E1            		POP	HL
  E212  20DD          		JR	NZ,SOPEN1
  E214  1807          		JR	SOPEN6
  E216                	SOPEN5:
  E216  CDF1EA        		CALL	GNCLX		;END DIR
  E219  D8            		RET	C
  E21A  CD8FE3        		CALL	ENDCL
  E21D                	SOPEN6:
  E21D  38D2          		JR	C,SOPEN1
  E21F                	SCF_FF_RET:
  E21F  37            		SCF			;CF=1
  E220  9F            		SBC	A,A		;A=0FFH
  E221  C9            		RET
                      	
  E222                	RDDERR:
  E222  BF            		CP	A		;READ ERR CF=1 ZF=1
  E223  37            		SCF
  E224  C9            		RET
                      	
  E225                	NOPEN:
  E225  21D7E2        		LD	HL,FILESE
  E228  22FDE1        		LD	(OPENPAT+1),HL
  E22B  FD2A98F0      		LD	IY,(_FCB)
  E22F  CDC2E4        		CALL	CHKWILDX
  E232  30EB          		JR	NC,SCF_FF_RET
  E234  FD7E00        		LD	A,(IY+0)	;(FCB)ドライブ番号
  E237  3D            		DEC	A
  E238  3288F0        		LD	(_DRV),A
  E23B  CDD9F0        		CALL	_CHGDRV
  E23E  D8            		RET	C
  E23F  2AF8F1        		LD	HL,(SFNDF)	;Direcroty location and Flags
  E242  229FF0        		LD	(_FILEN),HL
                      	
  E245  CDD7E3        		CALL	LDDIRX
  E248  ED5B9AF0      		LD	DE,(_FBPS)
  E24C  CDC8E2        		CALL	READ_DIR
  E24F  38D1          		JR	C,RDDERR
  E251  3A9EF0        		LD	A,(_FBCNT)
  E254  3D            		DEC	A
  E255  28AD          		JR	Z,SOPEN3
  E257                	NOPEN2:
  E257  2A9CF0        		LD	HL,(_FBAD)
  E25A  012000        		LD	BC,020H
  E25D  09            		ADD	HL,BC
  E25E  4F            		LD	C,A
  E25F  189A          		JR	SOPEN2
                      	
  E261                	SOPENE2:
  E261  229CF0        		LD	(_FBAD),HL
  E264  79            		LD	A,C
  E265  329EF0        		LD	(_FBCNT),A
  E268  ED539AF0      		LD	(_FBPS),DE
  E26C  FD2298F0      		LD	(_FCB),IY
  E270                	SOPENE:
  E270  AF            		XOR	A
  E271  C9            		RET
                      	
  E272                	COPEN:
  E272  FD360D20      		LD	(IY+13),020H	;(FCB)属性(アトリビュート)
                      	
  E276  21F4E2        		LD	HL,NEXTSE
  E279  CDC4E1        		CALL	SOPENC
  E27C  D0            		RET	NC
  E27D  C8            		RET	Z
  E27E  3AA0F0        		LD	A,(_DIRF)	;ディレクトリか判別
  E281  B7            		OR	A
  E282  37            		SCF
  E283  C8            		RET	Z		;ルートディレクトリ
  E284  0601          		LD	B,1
  E286  CD21E5        		CALL	WRDF
  E289  D8            		RET	C
  E28A  ED5BFEF1      		LD	DE,(_CLPS)
  E28E  D5            		PUSH	DE
  E28F  CD58E3        		CALL	DCPAT
  E292  CD7CE9        		CALL	DRDNX
  E295  2A7EF1        		LD	HL,(_DTBUF)	;ディレクトリエントリを0クリア
  E298  3A86E8        		LD	A,(SECSZ+2)	;1024=4 / 512=2 / 256=1
  E29B  47            		LD	B,A
  E29C  AF            		XOR	A
  E29D  4F            		LD	C,A
  E29E                	COPENCL:
  E29E  77            		LD	(HL),A
  E29F  EDA1          		CPI			;HL=HL+1 BC=BC-1 BCが0の場合にP/V=0
  E2A1  EA9EE2        		JP	PE,COPENCL
                      	
  E2A4  3A76E3        		LD	A,(SPCPAT+1)	;1クラスタの論理セクタ数
  E2A7  3D            		DEC	A
  E2A8  2819          		JR	Z,COPENE
  E2AA  3E01          		LD	A,1		;1セクタ辺りのセクタ数が2以上の場合
  E2AC  32E9EA        		LD	(_SECPS+1),A
  E2AF  D1            		POP	DE		;DE=(_CLPS)
  E2B0  D5            		PUSH	DE
  E2B1                	COPEN1:
  E2B1  D5            		PUSH	DE		;データバッファに入らないセクタもゼロクリア
  E2B2  C5            		PUSH	BC
  E2B3  2A7EF1        		LD	HL,(_DTBUF)
  E2B6  CD72E3        		CALL	CLUSTX
  E2B9  CD81EC        		CALL	DWT24
  E2BC  C1            		POP	BC
  E2BD  D1            		POP	DE
  E2BE  CDE8EA        		CALL	NEXTX
  E2C1  20EE          		JR	NZ,COPEN1
  E2C3                	COPENE:
  E2C3  2A7EF1        		LD	HL,(_DTBUF)
  E2C6  D1            		POP	DE
  E2C7  C9            		RET
                      	
  E2C8                	READ_DIR:
  E2C8  ED53FEF1      		LD	(_CLPS),DE
  E2CC  C5            		PUSH	BC
  E2CD  D5            		PUSH	DE
  E2CE  CD58E3        		CALL	DCPAT
  E2D1  CD5CE9        		CALL	DRDX
  E2D4  D1            		POP	DE
  E2D5  C1            		POP	BC
  E2D6  C9            		RET
                      	
  E2D7                	FILESE:
  E2D7  7E            		LD	A,(HL)
  E2D8  B7            		OR	A
  E2D9  C8            		RET	Z		;END:ZF=1 CF=0
  E2DA  FEE5          		CP	0E5H
  E2DC  280E          		JR	Z,FILESE1
  E2DE  FDE5          		PUSH	IY
  E2E0  D1            		POP	DE
  E2E1  13            		INC	DE
  E2E2  E5            		PUSH	HL
  E2E3  CD2FE3        		CALL	CPFILE
  E2E6  CC50E3        		CALL	Z,CPFILE2
  E2E9  E1            		POP	HL
  E2EA  37            		SCF
  E2EB  C8            		RET	Z		;!!!:(ZF=1) CF=1
  E2EC                	FILESE1:
  E2EC  CD03E3        		CALL	FNEXT
  E2EF  20E6          		JR	NZ,FILESE
  E2F1                	ZF0_CF0_AFF_RET:
  E2F1  F6FF          		OR	0FFH		;ZF=0 CF=0
  E2F3  C9            		RET
                      	
  E2F4                	NEXTSE:
  E2F4  7E            		LD	A,(HL)
  E2F5  B7            		OR	A
  E2F6  37            		SCF
  E2F7  C8            		RET	Z		;!!!:ZF=1 CF=1
  E2F8  FEE5          		CP	0E5H
  E2FA  37            		SCF
  E2FB  C8            		RET	Z		;!!!:(ZF=1) CF=1
  E2FC  CD03E3        		CALL	FNEXT
  E2FF  20F3          		JR	NZ,NEXTSE
  E301  18EE          		JR	ZF0_CF0_AFF_RET
                      	
  E303                	FNEXT:
  E303  E5            		PUSH	HL
  E304  219FF0        		LD	HL,_FILEN
  E307  34            		INC	(HL)
  E308  E1            		POP	HL
  E309  112000        		LD	DE,020H
  E30C  19            		ADD	HL,DE
  E30D  0D            		DEC	C
  E30E  C9            		RET
                      	
  E30F                	CPNAME:
  E30F  C5            		PUSH	BC
  E310  D5            		PUSH	DE
  E311  E5            		PUSH	HL
  E312  CD29E3        		CALL	CPFILE4
  E315  E1            		POP	HL
  E316  23            		INC	HL
  E317  23            		INC	HL
  E318  23            		INC	HL
  E319  23            		INC	HL
  E31A  D1            		POP	DE
  E31B  C1            		POP	BC
  E31C  2005          		JR	NZ,CPNAME1
  E31E  7E            		LD	A,(HL)
  E31F  23            		INC	HL
  E320  66            		LD	H,(HL)
  E321  6F            		LD	L,A
  E322  C9            		RET
  E323                	CPNAME1:
  E323  23            		INC	HL
  E324  23            		INC	HL
  E325  10E8          		DJNZ	CPNAME
  E327  37            		SCF
  E328  C9            		RET
                      	
  E329                	CPFILE4:
  E329  C5            		PUSH	BC
  E32A  010004        		LD	BC,00400H
  E32D  1804          		JR	CPSTR1
  E32F                	CPFILE:
  E32F  C5            		PUSH	BC
  E330  01000B        		LD	BC,00B00H
  E333                	CPSTR1:
  E333  1A            		LD	A,(DE)
  E334  FE3F          		CP	'?'		;Wild card
  E336  2812          		JR	Z,CPSTR2
  E338  7E            		LD	A,(HL)
  E339  CDA8E4        		CALL	FKANC
  E33C  E5            		PUSH	HL
  E33D  67            		LD	H,A
  E33E  1A            		LD	A,(DE)
  E33F  CB01          		RLC	C
  E341  CDA8E4        		CALL	FKANC
  E344  CB09          		RRC	C
  E346  BC            		CP	H		;CP (HL),(DE)
  E347  E1            		POP	HL
  E348  2004          		JR	NZ,CPSTR3
  E34A                	CPSTR2:
  E34A  13            		INC	DE
  E34B  23            		INC	HL
  E34C  10E5          		DJNZ	CPSTR1
  E34E                	CPSTR3:
  E34E  C1            		POP	BC
  E34F  C9            		RET
                      	
  E350                	CPFILE2:
  E350  FD7E0D        		LD	A,(IY+13)	;(FCB)属性(アトリビュート)
  E353  F6E1          		OR	0E1H
  E355  2F            		CPL
  E356  A6            		AND	(HL)
  E357  C9            		RET
                      	
  E358                	DCPAT:
  E358  0E00          		LD	C,0
  E35A  2A7EF1        		LD	HL,(_DTBUF)
  E35D  3AA0F0        		LD	A,(_DIRF)	;ディレクトリか判別
  E360  B7            		OR	A
  E361  C8            		RET	Z		;ルートディレクトリの場合はCレジスタを0にしておく(CDEがセクタ番号)
  E362  3A76E3        		LD	A,(SPCPAT+1)
  E365  4F            		LD	C,A
  E366  3AE9EA        		LD	A,(_SECPS+1)
  E369  B9            		CP	C
  E36A  3801          		JR	C,DC1
  E36C  AF            		XOR	A
  E36D                	DC1:
  E36D  F680          		OR	080H
  E36F  32A0F0        		LD	(_DIRF),A	;bit0-6:セクタインデックス
  E372                	CLUSTX:
  E372  E5            		PUSH	HL
  E373  EB            		EX	DE,HL
  E374  AF            		XOR	A
  E375  0E01          	SPCPAT:	LD	C,1		;自己書き換え（1クラスタの論理セクタ数）
  E377                	L_CLDBL:
  E377  CB19          		RR	C		;->CF
  E379  3804          		JR	C,E_CLDBL
  E37B  29            		ADD	HL,HL		;*2
  E37C  8F            		ADC	A,A
  E37D  18F8          		JR	L_CLDBL
  E37F                	E_CLDBL:
  E37F  4F            		LD	C,A
  E380  3AE9EA        		LD	A,(_SECPS+1)
  E383  B5            		OR	L
  E384  6F            		LD	L,A
  E385  110800        	CLSPAT:	LD	DE,8	;+8 (2D)  !ADDCL (self-modifying code)
  E388  AF            		XOR	A
  E389  19            		ADD	HL,DE	;データ格納領域の先頭論理セクタ番号
  E38A  89            		ADC	A,C
  E38B  4F            		LD	C,A
  E38C  EB            		EX	DE,HL
  E38D  E1            		POP	HL
  E38E  C9            		RET
                      	
  E38F                	ENDCL:
  E38F  7A            		LD	A,D	;END CLUSTER
  E390  FE01          	CLPAT1:	CP	1	;164=356	(self-modifying code)
  E392  C0            		RET	NZ
  E393  7B            		LD	A,E
  E394  FE64          	CLPAT2:	CP	064H	;		(self-modifying code)
  E396  C9            		RET
                      	
  E397                	CAP:
  E397  FE61          		CP	'a'
  E399  D8            		RET	C
  E39A  FE7B          		CP	'z'+1
  E39C  D0            		RET	NC
  E39D  D620          		SUB	020H
  E39F  C9            		RET
  E3A0                	CAP2:
  E3A0  CD97E3        		CALL	CAP
  E3A3                	CAP3:
  E3A3  CDACE3        		CALL	CAP4
  E3A6  FE21          		CP	021H
  E3A8  D0            		RET	NC
  E3A9  3EA0          		LD	A,0A0H
  E3AB  C9            		RET
  E3AC                	CAP4:
  E3AC  FE05          		CP	5
  E3AE  C0            		RET	NZ
  E3AF  3EE5          		LD	A,0E5H
  E3B1  C9            		RET
                      	
  E3B2                	CHDIR:
  E3B2  CDAFED        		CALL	GETDPBD
  E3B5  381D          		JR	C,CHDIR2
  E3B7  DD751A        		LD	(IX+01AH),L		;_SDIR_
  E3BA  DD741B        		LD	(IX+01BH),H		;_SDIR_+1
  E3BD  1815          		JR	CHDIR2		;POP_IX_RET
                      	
  E3BF                	LDDIR:
  E3BF  CDAFED        		CALL	GETDPBD
  E3C2  DD5E1A        		LD	E,(IX+01AH)		;_SDIR_
  E3C5  DD561B        		LD	D,(IX+01BH)		;_SDIR_+1
  E3C8  13            		INC	DE
  E3C9  FD730E        		LD	(IY+14),E	;(FCB)アクセスするディレクトリのクラスタ番号+1
  E3CC  FD720F        		LD	(IY+15),D
  E3CF  1B            		DEC	DE
  E3D0  AF            		XOR	A
  E3D1  32A0F0        		LD	(_DIRF),A
  E3D4                	CHDIR2:
  E3D4  DDE1          		POP	IX
  E3D6  C9            		RET
                      	
  E3D7                	LDDIRX:
  E3D7  3AA0F0        		LD	A,(_DIRF)	;(FCB)アクセスするディレクトリのセクタインデックス
  E3DA  E67F          		AND	07FH
  E3DC                	LDDIRX1:
  E3DC  32E9EA        		LD	(_SECPS+1),A
  E3DF  FD5E0E        		LD	E,(IY+14)	;(FCB)アクセスするディレクトリのクラスタ番号+1
  E3E2  FD560F        		LD	D,(IY+15)
  E3E5  1B            		DEC	DE
  E3E6  CD8FE3        		CALL	ENDCL
  E3E9  D4BFE3        		CALL	NC,LDDIR
  E3EC                	LDDIRS:
  E3EC  7A            		LD	A,D
  E3ED  B3            		OR	E
  E3EE  32A0F0        		LD	(_DIRF),A	;ディレクトリか判別
  E3F1  C9            		RET
                      	
  E3F2                	KILL:
  E3F2  CDC2E4        		CALL	CHKWILDX
  E3F5  3834          		JR	C,KILLW
  E3F7  CD94E1        		CALL	SOPENX
  E3FA                	KILLS:
  E3FA  3E1F          		LD	A,01FH
  E3FC  D43EE4        		CALL	NC,CHKATT
  E3FF  D8            		RET	C
  E400                	KILLSX:
  E400  36E5          		LD	(HL),0E5H	;DIR
  E402  CD9CE4        		CALL	WTDB
  E405  111A00        		LD	DE,01AH
  E408  19            		ADD	HL,DE
  E409  5E            		LD	E,(HL)
  E40A  23            		INC	HL
  E40B  56            		LD	D,(HL)
  E40C                	KILLS1:
  E40C  CD8FE3        		CALL	ENDCL
  E40F  D0            		RET	NC		;CF=0
  E410  21FEFF        		LD	HL,0-2
  E413  19            		ADD	HL,DE
  E414  D0            		RET	NC		;DE= 0 or 1
  E415  D5            		PUSH	DE
  E416  CDF7F0        		CALL	_GNCL
  E419  ED53FEF1      		LD	(_CLPS),DE
  E41D  D1            		POP	DE
  E41E  210000        		LD	HL,0
  E421  D4FAF0        		CALL	NC,_SNCL
  E424  D8            		RET	C
  E425  ED5BFEF1      		LD	DE,(_CLPS)	;FAT
  E429  18E1          		JR	KILLS1
                      	
  E42B                	KILLW:
  E42B  CDC1E1        		CALL	SOPEN
  E42E                	KILLW1:
  E42E  380B          		JR	C,KILLW2
  E430  CD61E2        		CALL	SOPENE2
  E433  CDFAE3        		CALL	KILLS
  E436  CD25E2        		CALL	NOPEN
  E439  18F3          		JR	KILLW1
  E43B                	KILLW2:
  E43B  C8            		RET	Z
  E43C  3F            		CCF
  E43D  C9            		RET
                      	
  E43E                	CHKATT:
  E43E  E5            		PUSH	HL
  E43F  110B00        		LD	DE,00BH
  E442  19            		ADD	HL,DE
  E443  A6            		AND	(HL)
  E444  E1            		POP	HL
  E445  C8            		RET	Z
  E446  37            		SCF
  E447  C9            		RET
                      	
  E448                	NAME:
  E448  CDC2E4        		CALL	CHKWILDX
  E44B  D8            		RET	C
  E44C  110400        		LD	DE,4
  E44F  19            		ADD	HL,DE
  E450  2268E4        		LD	(NAMEP+2),HL
  E453  23            		INC	HL
  E454  CDC6E4        		CALL	CHKWILD
  E457  D8            		RET	C
                      	
  E458  CD94E1        		CALL	SOPENX
  E45B  3E0F          		LD	A,00FH
  E45D  D43EE4        		CALL	NC,CHKATT
  E460  D8            		RET	C
                      	
  E461  FD7E00        		LD	A,(IY+0)
  E464  FDE5          		PUSH	IY
  E466  FD210000      	NAMEP:	LD	IY,0		;自己書き換え
  E46A  FD7700        		LD	(IY+0),A
  E46D  CD94E1        		CALL	SOPENX
  E470  FDE3          		EX	(SP),IY
  E472  3F            		CCF
  E473  D4C1E1        		CALL	NC,SOPEN
  E476  EB            		EX	DE,HL
  E477  E1            		POP	HL
  E478  D8            		RET	C
                      	
  E479                	SETNAME:
  E479  01000B        		LD	BC,11*256
  E47C  23            		INC	HL
  E47D  7E            		LD	A,(HL)
  E47E  FEE5          		CP	0E5H
  E480  2004          		JR	NZ,SNAME1
  E482  3E05          		LD	A,5
  E484  180E          		JR	SNAME3
  E486                	SNAME1:
  E486  7E            		LD	A,(HL)
  E487  0C            		INC	C
  E488  0D            		DEC	C
  E489  2009          		JR	NZ,SNAME3
  E48B  CD97E3        		CALL	CAP
  E48E  FEA0          		CP	0A0H
  E490  2002          		JR	NZ,SNAME3
  E492  3E20          		LD	A,020H
  E494                	SNAME3:
  E494  12            		LD	(DE),A
  E495  7E            		LD	A,(HL)
  E496  23            		INC	HL
  E497  CDAFE4        		CALL	FKAN
  E49A  10EA          		DJNZ	SNAME1
  E49C                	WTDB:
  E49C  3EFF          		LD	A,0FFH
  E49E  3239F0        		LD	(SFILE),A
  E4A1                	SWTDBF:
  E4A1  3E01          		LD	A,1
  E4A3  32A4F0        		LD	(_WTDBF),A
  E4A6  AF            		XOR	A
  E4A7  C9            		RET
                      	
  E4A8                	FKANC:
  E4A8  CB41          		BIT	0,C
  E4AA  CCA0E3        		CALL	Z,CAP2
  E4AD  1801          		JR	FKANX
  E4AF                	FKAN:			;漢字チェック
  E4AF  13            		INC	DE
  E4B0                	FKANX:
  E4B0  CB41          		BIT	0,C
  E4B2  CB81          		RES	0,C
  E4B4  C0            		RET	NZ
  E4B5  FE80          		CP	080H
  E4B7  D8            		RET	C
  E4B8  FEA0          		CP	0A0H
  E4BA  3803          		JR	C,FKAN1
  E4BC  FEE0          		CP	0E0H
  E4BE  D8            		RET	C
  E4BF                	FKAN1:
  E4BF  0C            		INC	C
  E4C0  A7            		AND	A
  E4C1  C9            		RET
                      	
  E4C2                	CHKWILDX:
  E4C2  FDE5          		PUSH	IY
  E4C4  E1            		POP	HL
  E4C5  23            		INC	HL
  E4C6                	CHKWILD:
  E4C6  060B          		LD	B,11
  E4C8  3E3F          		LD	A,'?'
  E4CA                	CHKWIL1:
  E4CA  BE            		CP	(HL)
  E4CB  23            		INC	HL
  E4CC  37            		SCF
  E4CD  C8            		RET	Z
  E4CE  10FA          		DJNZ	CHKWIL1
  E4D0  AF            		XOR	A
  E4D1  C9            		RET
                      	
  E4D2                	SDIRENT:		;IY=FCB HL=DIR
  E4D2  D5            		PUSH	DE
  E4D3  E5            		PUSH	HL
  E4D4  FDE5          		PUSH	IY
  E4D6  D1            		POP	DE
  E4D7  EB            		EX	DE,HL
  E4D8  CD79E4        		CALL	SETNAME
                      	;				Attribute
  E4DB  FD7E0D        		LD	A,(IY+13)	;(FCB)属性(アトリビュート)
  E4DE  12            		LD	(DE),A
  E4DF  13            		INC	DE
                      	;				Reserved
  E4E0  AF            		XOR	A
  E4E1  060A          		LD	B,10
  E4E3                	SDE1:
  E4E3  12            		LD	(DE),A
  E4E4  13            		INC	DE
  E4E5  10FC          		DJNZ	SDE1
                      						;(FCB)更新時刻
  E4E7  21EAF1        		LD	HL,SDDATA		;(FCB)更新年月日
  E4EA  060A          		LD	B,SDDATAE-SDDATA	;(FCB)ファイルの先頭クラスタ
  E4EC                	SDLOOP:					;(FCB)ファイルのサイズ(バイト単位)
  E4EC  7E            		LD	A,(HL)
  E4ED  23            		INC	HL
  E4EE  32F3E4        		LD	(SDPAT+2),A
  E4F1  FD7E00        	SDPAT:	LD	A,(IY+0)	;LD A,(IY+A)
  E4F4  12            		LD	(DE),A
  E4F5  13            		INC	DE
  E4F6  10F4          		DJNZ	SDLOOP
                      	
  E4F8  AF            		XOR	A
  E4F9  E1            		POP	HL
  E4FA  D1            		POP	DE
  E4FB  C9            		RET
                      	
  E4FC                	WOPEN:
  E4FC  FD7E0D        		LD	A,(IY+13)	;(FCB)属性(アトリビュート)
  E4FF  E61F          		AND	01FH
  E501  37            		SCF
  E502  C0            		RET	NZ
  E503  FD361CFE      		LD	(IY+28),0FEH	;(FCB)オープンモード
  E507                	TOPEN2:
  E507  AF            		XOR	A
  E508                	TOPEN:				;Initializes the time stamp
  E508  FD3617FF      		LD	(IY+23),0FFH	;(FCB)更新時刻
  E50C  C9            		RET
                      	
  E50D                	WRDFX:
  E50D  3A76E3        		LD	A,(SPCPAT+1)	;1クラスタの論理セクタ
  E510                	L_WRFX:
  E510  1F            		RRA			;->CF
  E511  3806          		JR	C,E_WRFX
  E513  CB39          		SRL	C
  E515  CB1C          		RR	H		;CH=CH/2
  E517  18F7          		JR	L_WRFX
  E519                	E_WRFX:
  E519  41            		LD	B,C
  E51A  4C            		LD	C,H
  E51B  03            		INC	BC
  E51C  3E37          		LD	A,037H		;SCF
  E51E  3279E9        		LD	(DRDN1),A
                      	
  E521                	WRDF:				;BCクラスタ分FATを確保する
  E521  110200        		LD	DE,2
  E524  AF            		XOR	A
  E525  32E9EA        		LD	(_SECPS+1),A
  E528                	WRDF1:
  E528  C5            		PUSH	BC
  E529  D5            		PUSH	DE
  E52A  CDF7F0        		CALL	_GNCL
  E52D  381C          		JR	C,WRDF3
  E52F  7A            		LD	A,D		;空いているかチェック
  E530  B3            		OR	E
  E531  202A          		JR	NZ,WRDF4
  E533  E1            		POP	HL		;HL=空いているクラスタ
  E534  E5            		PUSH	HL
  E535  ED5BFEF1      		LD	DE,(_CLPS)	;DE=元の(_CLPS)
  E539  22FEF1        		LD	(_CLPS),HL
  E53C  7A            		LD	A,D		;元の(_CLPS)が 0 か?
  E53D  B3            		OR	E
  E53E  2008          		JR	NZ,WRDF2
  E540  FD751A        		LD	(IY+26),L	;(FCB)ファイルの先頭クラスタ
  E543  FD741B        		LD	(IY+27),H	;元が空の場合はFCBにクラスタをセットする
  E546  1803          		JR	WRDF3
  E548                	WRDF2:
  E548  CDFAF0        		CALL	_SNCL
  E54B                	WRDF3:
  E54B  D1            		POP	DE
  E54C  C1            		POP	BC
  E54D  D8            		RET	C
  E54E  0B            		DEC	BC
  E54F  78            		LD	A,B
  E550  B1            		OR	C
  E551  200C          		JR	NZ,WRDF5	;ここでループカウンタチェック
  E553  ED5BFEF1      		LD	DE,(_CLPS)
  E557  21FFFF        		LD	HL,0FFFFH	;FATエントリ終了(EOCマーク)
  E55A  C3FAF0        		JP	_SNCL
                      	
  E55D                	WRDF4:				;DEクラスタが空じゃないので次に移動する
  E55D  D1            		POP	DE
  E55E  C1            		POP	BC
  E55F                	WRDF5:
  E55F  13            		INC	DE
  E560  CD8FE3        		CALL	ENDCL
  E563  38C3          		JR	C,WRDF1
  E565  37            		SCF
  E566  C9            		RET
                      	
  E567                	RWXR:
  E567  3A86E8        		LD	A,(SECSZ+2)	;1024=4 / 512=2 / 256=1
  E56A                	L_RWX:
  E56A  1F            		RRA		;->CF
  E56B  3808          		JR	C,E_RWX
  E56D  CB38          		SRL	B	;BCH=BCH/2
  E56F  CB19          		RR	C	;
  E571  CB1C          		RR	H	;
  E573  18F5          		JR	L_RWX
  E575                	E_RWX:
  E575  FD5E1A        		LD	E,(IY+26)	;(FCB)ファイルの先頭クラスタ
  E578  FD561B        		LD	D,(IY+27)
  E57B  AF            		XOR	A
  E57C  32E9EA        		LD	(_SECPS+1),A
  E57F                	RWX1:
  E57F  ED53FEF1      		LD	(_CLPS),DE
  E583  7A            		LD	A,D
  E584  B3            		OR	E
  E585  2813          		JR	Z,SCF_RET	;RET DE==0 => CF=1
                      	
  E587  78            		LD	A,B
  E588  B1            		OR	C
  E589  B4            		OR	H
  E58A  C8            		RET	Z		;RET BCH==0 => CF=0
                      	
  E58B  CDF1EA        		CALL	GNCLX
  E58E  D8            		RET	C
  E58F  7C            		LD	A,H		;
  E590  25            		DEC	H		;
  E591  B7            		OR	A		;DEC BCH
  E592  2001          		JR	NZ,RWX2		;
  E594  0B            		DEC	BC		;
  E595                	RWX2:
  E595  CD8FE3        		CALL	ENDCL
  E598  38E5          		JR	C,RWX1
  E59A                	SCF_RET:
  E59A  37            		SCF
  E59B  C9            		RET
                      	
  E59C                	DSKF:
  E59C  110000        	MAXCLP:	LD	DE,0
  E59F  2AACF0        		LD	HL,(_FAKEFREE)
  E5A2  7C            		LD	A,H
  E5A3  B5            		OR	L
  E5A4  2803          		JR	Z,DSKF1
  E5A6  110100        		LD	DE,1
  E5A9                	DSKF1:
  E5A9  D5            		PUSH	DE
  E5AA  CDF7F0        		CALL	_GNCL
  E5AD  380C          		JR	C,POPSCF
  E5AF  7A            		LD	A,D
  E5B0  B3            		OR	E
  E5B1  2001          		JR	NZ,DSKF2
  E5B3  23            		INC	HL
  E5B4                	DSKF2:
  E5B4  D1            		POP	DE
  E5B5  1B            		DEC	DE
  E5B6  7A            		LD	A,D
  E5B7  B3            		OR	E
  E5B8  20EF          		JR	NZ,DSKF1
  E5BA  C9            		RET
                      	
  E5BB                	POPSCF:
  E5BB  F1            		POP	AF
  E5BC  37            		SCF
  E5BD  C9            		RET
                      	
  E5BE                	SETTMS:
  E5BE  FD7E17        		LD	A,(IY+23)	;(FCB)ファイルを最後に変更した時刻
  E5C1  3C            		INC	A
  E5C2  C0            		RET	NZ		;ファイルが更新されていない
  E5C3                	SETTMSX:			;FCBに日付時刻をセットする
  E5C3  CD72DC        		CALL	_SYS2C		;(BDOS)時刻の獲得
                      					;H←時  L←分  D←秒
  E5C6  CB25          		SLA	L		;   *2
  E5C8  CB25          		SLA	L		;   *4
  E5CA  29            		ADD	HL,HL		;*2 *8
  E5CB  29            		ADD	HL,HL		;*4 *16
  E5CC  29            		ADD	HL,HL		;*8 *32
  E5CD  7A            		LD	A,D
  E5CE  0F            		RRCA			;bit.0->7->->->0->C
  E5CF  E61F          		AND	01FH
  E5D1  B5            		OR	L
  E5D2  FD7716        		LD	(IY+22),A	;(FCB)ファイルを最後に変更した時刻
  E5D5  FD7417        		LD	(IY+23),H
                      	
  E5D8  CD4FDC        		CALL	_SYS2A		;(BDOS)日付の獲得
                      					;HL←年  D←月  E←日
  E5DB  0144F8        		LD	BC,0-1980
  E5DE  09            		ADD	HL,BC
  E5DF  65            		LD	H,L
                      	
  E5E0  7A            		LD	A,D
  E5E1  87            		ADD	A,A		;*2
  E5E2  87            		ADD	A,A		;*4
  E5E3  87            		ADD	A,A		;*8
  E5E4  87            		ADD	A,A		;*16
  E5E5  6F            		LD	L,A
  E5E6  29            		ADD	HL,HL		;*32
  E5E7  7D            		LD	A,L
  E5E8  B3            		OR	E
  E5E9  FD7714        		LD	(IY+20),A	;(FCB)ファイルを最後に変更した日付
  E5EC  FD7415        		LD	(IY+21),H
  E5EF  C9            		RET
                      	
  E5F0                	PUSHRR:
  E5F0  3288E6        		LD	(SETSEQ_SWC_RND),A
  E5F3  229AE6        		LD	(SETSEQ_SWC_SEQ_RR),HL
  E5F6  CD16E6        		CALL	GET_RR_AHL
  E5F9  225AF0        		LD	(RR_BUF_HL),HL
  E5FC  325CF0        		LD	(RR_BUF_A),A
  E5FF  C9            		RET
                      	
  E600                	GET_CPM_R_SIZE:		;バイト単位からCP/Mのレコード単位を求める（1レコード=128バイト）
  E600  87            		ADD	A,A		;in BHLA => out AHL
  E601  ED6A          		ADC	HL,HL
  E603  CB18          		RR	B
  E605  B7            		OR	A
  E606  78            		LD	A,B		;ここでフラグは変化しない
  E607  C8            		RET	Z
  E608  2C            		INC	L		;INC AHL
  E609  C0            		RET	NZ		;
  E60A  24            		INC	H		;
  E60B  C0            		RET	NZ		;
  E60C  3C            		INC	A		;
  E60D  C9            		RET
                      	
  E60E                	INIT_RND:
  E60E  3ECD          		LD	A,0CDH		;CALL ????
  E610  215DE6        		LD	HL,POPRR
  E613  CDF0E5        		CALL	PUSHRR
  E616                	GET_RR_AHL:
  E616  FD6E21        		LD	L,(IY+33)	;(FCB)Random record
  E619  FD6622        		LD	H,(IY+34)	;
  E61C  FD7E23        		LD	A,(IY+35)	;
  E61F  C9            		RET
  E620                	SET_RR_AHL:
  E620  FD7521        		LD	(IY+33),L	;(FCB)Random record
  E623  FD7422        		LD	(IY+34),H
  E626  FD7723        		LD	(IY+35),A
  E629  C9            		RET
  E62A                	INIT_SEQ:
  E62A  3E01          		LD	A,1		;LD BC,????
  E62C  215AE6        		LD	HL,SETSEQ
  E62F  CDF0E5        		CALL	PUSHRR
  E632                	GETSEQ:
  E632  FD6E20        		LD	L,(IY+32)	;(FCB)カレントレコード
  E635  FD660C        		LD	H,(IY+12)	;(FCB)カレントブロック
  E638  AF            		XOR	A
                      	
  E639  CB25          		SLA	L	;L=L*2
                      	
  E63B  CB3C          		SRL	H	;HL=HL/2
  E63D  CB1D          		RR	L	;
  E63F  C9            		RET
                      	
  E640                	SETSEQ1:
  E640  F5            		PUSH	AF
  E641  E5            		PUSH	HL		;AHL=Random record
  E642  CD16E6        		CALL	GET_RR_AHL
  E645  47            		LD	B,A		;AHL→HLA
  E646  7D            		LD	A,L		;(IY+33)(FCB)ランダムレコード
  E647  6C            		LD	L,H		;(IY+34)
  E648  60            		LD	H,B		;(IY+35)
  E649  0600          		LD	B,0
                      	
  E64B  CD00E6        		CALL	GET_CPM_R_SIZE
                      	
  E64E  29            		ADD	HL,HL
  E64F  CB3D          		SRL	L		;L=L/2
  E651  FD7520        		LD	(IY+32),L	;(FCB)カレントレコード
  E654  FD740C        		LD	(IY+12),H	;(FCB)カレントブロック
  E657  E1            		POP	HL
  E658  F1            		POP	AF
  E659  C9            		RET
  E65A                	SETSEQ:
  E65A  CD40E6        		CALL	SETSEQ1
  E65D                	POPRR:
  E65D  F5            		PUSH	AF
  E65E  E5            		PUSH	HL
  E65F  2A5AF0        		LD	HL,(RR_BUF_HL)
  E662  3A5CF0        		LD	A,(RR_BUF_A)
  E665  CD20E6        		CALL	SET_RR_AHL
  E668  E1            		POP	HL
  E669  F1            		POP	AF
  E66A  C9            		RET
                      	
  E66B                	RB_WRITE:
  E66B  C5            		PUSH	BC
  E66C  ED4B4CF1      		LD	BC,(STABLE+2*026H)	;(BDOS)ランダムブロック書き込み
  E670  1805          		JR	RBRW
  E672                	RB_READ:
  E672  C5            		PUSH	BC
  E673  ED4B4EF1      		LD	BC,(STABLE+2*027H)	;(BDOS)ランダムブロック読み込み
  E677                	RBRW:
  E677  1F            		RRA		;AHL = AHL*128
  E678  7C            		LD	A,H	;AHL = AHL0/2
  E679  1F            		RRA		;A
  E67A  65            		LD	H,L	;
  E67B  CB1C          		RR	H	;H
  E67D  2E00          		LD	L,0	;
  E67F  CB1D          		RR	L	;L
  E681  CD20E6        		CALL	SET_RR_AHL
  E684  218000        		LD	HL,128
  E687  C5            		PUSH	BC
  E688                	SETSEQ_SWC_RND:
  E688  CD40E6        		CALL	SETSEQ1
  E68B  C1            		POP	BC
  E68C  FDCB20FE      		SET	7,(IY+32)	;(FCB)カレントレコード
  E690  FDE5          		PUSH	IY
  E692  D1            		POP	DE
  E693  D5            		PUSH	DE
  E694  CDA2E6        		CALL	JP_BC
  E697  FDE1          		POP	IY
  E699  CD5AE6        		CALL	SETSEQ
  E69A                	SETSEQ_SWC_SEQ_RR	EQU $-2
  E69C  FDCB20BE      		RES	7,(IY+32)	;(FCB)カレントレコード
                      	
  E6A0  C1            		POP	BC
  E6A1  C9            		RET
  E6A2                	JP_BC:
  E6A2  C5            		PUSH	BC
  E6A3  C9            		RET
                      	
  E21F                	_SYS03	EQU	SCF_FF_RET	;(BDOS)外部入力
  E21F                	_SYS2B	EQU	SCF_FF_RET	;(BDOS)日付の設定
  E21F                	_SYS2D	EQU	SCF_FF_RET	;(BDOS)時刻の設定
  E21F                	_SYS39	EQU	SCF_FF_RET	;(BDOS)サブディレクトリの作成
  E21F                	_SYS3A	EQU	SCF_FF_RET	;(BDOS)サブディレクトリの削除
                      	
                      	
                      	;LDFILE2.ASM
                      	
                      	;	LSX-Dodgers FILE2
                      	
                      					;Write random block
  E6A4                	_SYS26:		;(BDOS)ランダムブロック書き込み
  E6A4  AF            		XOR	A
  E6A5  3279E9        		LD	(DRDN1),A	;NOP
  E6A8  22C9E8        		LD	(RBSIZE),HL	;HL←書き込むレコード数
  E6AB  225DF0        		LD	(LEFTX),HL
  E6AE  CD74E1        		CALL	SETDRV
                      	
  E6B1  CD21E8        		CALL	RBX0
  E6B4  DA41E7        		JP	C,RBWERR
  E6B7  CDFCE4        		CALL	WOPEN
  E6BA  DA41E7        		JP	C,RBWERR
  E6BD  7C            		LD	A,H
  E6BE  B5            		OR	L
  E6BF  CA3AE7        		JP	Z,RBW1
                      	
  E6C2  2B            		DEC	HL
                      	
  E6C3  CDDFE8        		CALL	GET_RR_BCDE	;BCDE=Random record
                      	
  E6C6  19            		ADD	HL,DE		;BCHL=HL+BCDE
  E6C7  3001          		JR	NC,S26X1	;
  E6C9  03            		INC	BC		;
  E6CA                	S26X1:
  E6CA  CD67E5        		CALL	RWXR
  E6CD  DC0DE5        		CALL	C,WRDFX
  E6D0  DA41E7        		JP	C,RBWERR
                      	
  E6D3  CD50E8        		CALL	RBX2
  E6D6  281A          		JR	Z,RBWB		;NZ=セクタ以下の端数がある
  E6D8  CD6FE8        		CALL	RBXA
  E6DB  3864          		JR	C,RBWERR
  E6DD  EB            		EX	DE,HL
  E6DE  C5            		PUSH	BC
  E6DF  EDB0          		LDIR
  E6E1  225FF0        		LD	(DTAX),HL
                      	
  E6E4  CDA1E4        		CALL	SWTDBF		;バッファデータは更新された
                      	
  E6E7  2A5DF0        		LD	HL,(LEFTX)
  E6EA  D1            		POP	DE
  E6EB  ED52          		SBC	HL,DE
  E6ED  225DF0        		LD	(LEFTX),HL
  E6F0  2831          		JR	Z,RBWEND
                      	
  E6F2                	RBWB:
  E6F2  CDA4E8        		CALL	RBXB
  E6F5  2814          		JR	Z,RBWC
  E6F7                	RBWB1:
  E6F7  C5            		PUSH	BC
  E6F8  D5            		PUSH	DE
  E6F9  CD72E3        		CALL	CLUSTX
  E6FC  CDF3E8        		CALL	DWTC
  E6FF  D1            		POP	DE
  E700  C1            		POP	BC
  E701  D4F1EA        		CALL	NC,GNCLX
  E704  383B          		JR	C,RBWERR
  E706  10EF          		DJNZ	RBWB1
  E708  CD43E9        		CALL	DRW_FLUSH
  E70B                	RBWC:
  E70B  CDBCE8        		CALL	RBXC
  E70E  2813          		JR	Z,RBWEND
  E710  C5            		PUSH	BC
  E711  CD72E3        		CALL	CLUSTX
  E714  CD78E9        		CALL	DRDN
  E717  C1            		POP	BC
  E718  3827          		JR	C,RBWERR
  E71A  ED5B7EF1      		LD	DE,(_DTBUF)
  E71E  EDB0          		LDIR
  E720  CDA1E4        		CALL	SWTDBF		;バッファデータは更新された
  E723                	RBWEND:
  E723  CDC8E8        		CALL	RBXEND
                      	
  E726  CD30E8        		CALL	RBX1
  E729  300F          		JR	NC,RBW1		;ランダムレコードの方が大きい場合はサイズを合わせる
  E72B  CDDFE8        		CALL	GET_RR_BCDE	;BCDE=Random record
  E72E  FD7310        		LD	(IY+16),E	;ファイルのサイズ(バイト単位)
  E731  FD7211        		LD	(IY+17),D	;
  E734  FD7112        		LD	(IY+18),C	;
  E737  FD7013        		LD	(IY+19),B	;
  E73A                	RBW1:
  E73A  FDE1          		POP	IY
  E73C  C1            		POP	BC
  E73D  D1            		POP	DE
  E73E  E1            		POP	HL
  E73F                	DD_NUL:
  E73F  AF            		XOR	A
  E740                	DRDF0:
  E740                	DWTF0:
  E740  C9            		RET
                      	
  E741                	RBWERR:
  E741  FDE5          		PUSH	IY
  E743  D1            		POP	DE
  E744  2A20F1        		LD	HL,(STABLE+2*010H)
  E747  CD0F00        		CALL	JP_HL
  E74A                	RBRERR1:
  E74A  3E01          		LD	A,001H
  E74C                	RBRERR2:
  E74C  FDE1          		POP	IY
  E74E  C1            		POP	BC
  E74F  D1            		POP	DE
  E750  E1            		POP	HL
  E751  37            		SCF
  E752  210000        		LD	HL,0
  E755  C9            		RET
                      	
  E756                	RBRERR:
  E756  3EFF          		LD	A,0FFH
  E758  18F2          		JR	RBRERR2
                      	
  E75A                	RBRFL:
  E75A  3E00          	RBRFLP:	LD	A,000H
  E75C  FE0D          		CP	00DH
  E75E  2005          		JR	NZ,RBRFL1
  E760  D5            		PUSH	DE
  E761  1E0A          		LD	E,00AH
  E763  1805          		JR	RBRFL2
  E765                	RBRFL1:
  E765  D5            		PUSH	DE
  E766  CD09F0        		CALL	_SYS07
  E769  5F            		LD	E,A
  E76A                	RBRFL2:
  E76A  CDCDF0        		CALL	_PRINT
  E76D  7B            		LD	A,E
  E76E  D1            		POP	DE
  E76F  325BE7        		LD	(RBRFLP+1),A
  E772  C9            		RET
  E773                	DDX:
  E773  FD7E01        		LD	A,(IY+1)	;(FCB)主ファイル名
  E776  CD97E3        		CALL	CAP
  E779  FE41          		CP	'A'
  E77B  C9            		RET
                      	
                      					;Read random block
  E77C                	_SYS27:		;(BDOS)ランダムブロック読み込み
  E77C  225DF0        		LD	(LEFTX),HL
  E77F  CD74E1        		CALL	SETDRV
                      	
  E782  FDCB0D66      		BIT	4,(IY+13)	;(FCB)属性(アトリビュート)
  E786  C20FE8        		JP	NZ,RBRDIR	;ディレクトリ
  E789  CD21E8        		CALL	RBX0
  E78C  DA56E7        		JP	C,RBRERR
  E78F  CD30E8        		CALL	RBX1
  E792  D448E8        		CALL	NC,RBX1R
  E795  DA4AE7        		JP	C,RBRERR1
  E798  EB            		EX	DE,HL
  E799  ED52          		SBC	HL,DE		;CP 00HL,BCDE
  E79B  19            		ADD	HL,DE
  E79C  79            		LD	A,C
  E79D  DE00          		SBC	A,0
  E79F  78            		LD	A,B
  E7A0  DE00          		SBC	A,0
  E7A2  3801          		JR	C,RBR1
  E7A4  EB            		EX	DE,HL
  E7A5                	RBR1:
  E7A5  9F            		SBC	A,A
  E7A6  E601          		AND	1
  E7A8  320DE8        		LD	(RBRAP+1),A
                      	
  E7AB  7C            		LD	A,H
  E7AC  B5            		OR	L
  E7AD  2857          		JR	Z,RBREND0
                      	
  E7AF  22C9E8        		LD	(RBSIZE),HL	;HL←読み込むレコード数
  E7B2  225DF0        		LD	(LEFTX),HL
                      	
  E7B5  CD50E8        		CALL	RBX2
  E7B8  2819          		JR	Z,RBRB
  E7BA  CD6FE8        		CALL	RBXA
  E7BD  DA56E7        		JP	C,RBRERR
  E7C0  C5            		PUSH	BC
  E7C1  EDB0          		LDIR
  E7C3  ED535FF0      		LD	(DTAX),DE
  E7C7  2A5DF0        		LD	HL,(LEFTX)
  E7CA  D1            		POP	DE
  E7CB  A7            		AND	A
  E7CC  ED52          		SBC	HL,DE
  E7CE  225DF0        		LD	(LEFTX),HL
  E7D1  2830          		JR	Z,RBREND
                      	
  E7D3                	RBRB:
  E7D3  CDA4E8        		CALL	RBXB
  E7D6  2815          		JR	Z,RBRC
  E7D8                	RBRB1:
  E7D8  C5            		PUSH	BC
  E7D9  D5            		PUSH	DE
  E7DA  CD72E3        		CALL	CLUSTX
  E7DD  CDF9E8        		CALL	DRDC
  E7E0  D1            		POP	DE
  E7E1  C1            		POP	BC
  E7E2  D4F1EA        		CALL	NC,GNCLX
  E7E5  DA56E7        		JP	C,RBRERR
  E7E8  10EE          		DJNZ	RBRB1
  E7EA  CD43E9        		CALL	DRW_FLUSH
  E7ED                	RBRC:
  E7ED  CDBCE8        		CALL	RBXC
  E7F0  2811          		JR	Z,RBREND
  E7F2  C5            		PUSH	BC
  E7F3  CD72E3        		CALL	CLUSTX
  E7F6  CD5CE9        		CALL	DRDX
  E7F9  C1            		POP	BC
  E7FA  DA56E7        		JP	C,RBRERR
  E7FD  EB            		EX	DE,HL
  E7FE  2A7EF1        		LD	HL,(_DTBUF)
  E801  EDB0          		LDIR
  E803                	RBREND:
  E803  CDC8E8        		CALL	RBXEND
  E806                	RBREND0:
  E806  FDE1          		POP	IY
  E808  C1            		POP	BC
  E809  D1            		POP	DE
  E80A  F1            		POP	AF	;(HL)
  E80B  AF            		XOR	A
  E80C  3E00          	RBRAP:	LD	A,000H
  E80E  C9            		RET
                      	
  E80F                	RBRDIR:
  E80F  FD6E1A        		LD	L,(IY+26)	;(FCB)ファイルの先頭クラスタ
  E812  FD661B        		LD	H,(IY+27)
  E815  CDB2E3        		CALL	CHDIR
  E818  AF            		XOR	A
  E819  67            		LD	H,A
  E81A  6F            		LD	L,A
  E81B  3C            		INC	A
  E81C  320DE8        		LD	(RBRAP+1),A
  E81F  18E5          		JR	RBREND0
                      	
  E821                	RBX0:
  E821  2A8AF0        		LD	HL,(_DTA)
  E824  225FF0        		LD	(DTAX),HL
  E827  2A5DF0        		LD	HL,(LEFTX)
  E82A  FD7E1C        		LD	A,(IY+28)	;(FCB)オープンモード
  E82D  D6FD          		SUB	0FDH
  E82F  C9            		RET
                      	
  E830                	RBX1:				;ファイルサイズとランダムレコードを比べる
  E830  E5            		PUSH	HL		;Record byte
                      					;AHL=File size
  E831  FD6E10        		LD	L,(IY+16)	;ファイルのサイズ(バイト単位)
  E834  FD6611        		LD	H,(IY+17)	;
  E837  FD7E12        		LD	A,(IY+18)	;
                      	
  E83A  CDDFE8        		CALL	GET_RR_BCDE	;BCDE=Random record
                      	
  E83D  A7            		AND	A
  E83E  ED52          		SBC	HL,DE
  E840  99            		SBC	A,C
  E841  4F            		LD	C,A
  E842  FD7E13        		LD	A,(IY+19)	;ファイルのサイズ
  E845  98            		SBC	A,B
  E846  D1            		POP	DE
  E847  C9            		RET
  E848                	RBX1R:
  E848  47            		LD	B,A
  E849  B1            		OR	C
  E84A  EB            		EX	DE,HL	;BCDE=File byte	HL=Record byte
  E84B  B2            		OR	D
  E84C  B3            		OR	E
  E84D  C0            		RET	NZ
  E84E  37            		SCF
  E84F  C9            		RET
                      	
  E850                	RBX2:				;Cluster settings
  E850  FD6622        		LD	H,(IY+34)	;(+33)(FCB)ランダムレコード
  E853  FD4E23        		LD	C,(IY+35)
  E856  0600          		LD	B,0
  E858  FDCB207E      		BIT	7,(IY+32)	;(FCB)カレントレコード
  E85C  2003          		JR	NZ,RBX3
  E85E  FD4624        		LD	B,(IY+36)
  E861                	RBX3:
  E861  CD67E5        		CALL	RWXR
  E864  3A86E8        		LD	A,(SECSZ+2)	;1024=4 / 512=2 / 256=1
  E867  3D            		DEC	A
  E868  FDA622        		AND	(IY+34)
  E86B  FDB621        		OR	(IY+33)
  E86E  C9            		RET
                      	
  E86F                	RBXA:
  E86F  C5            		PUSH	BC
  E870  D5            		PUSH	DE
  E871  CD72E3        		CALL	CLUSTX
  E874  CD5CE9        		CALL	DRDX
  E877  D1            		POP	DE
  E878  C1            		POP	BC
  E879  D4F1EA        		CALL	NC,GNCLX
  E87C  D8            		RET	C
  E87D  ED53FEF1      		LD	(_CLPS),DE
                      	
  E881  FD4E21        		LD	C,(IY+33)	;(FCB)ランダムレコード
  E884  210004        	SECSZ:	LD	HL,0400H	;自己書き換え 1024=0400H / 512=0200H ここに1セクタのサイズが格納される
  E887  7C            		LD	A,H
  E888  3D            		DEC	A		;1024=3 / 512=1
  E889  FDA622        		AND	(IY+34)		;(FCB)ランダムレコード
  E88C  47            		LD	B,A		;BCに1セクタ以下の端数が入る
  E88D  ED42          		SBC	HL,BC		;残りを計算
                      	
  E88F  ED5B5DF0      		LD	DE,(LEFTX)
  E893  ED52          		SBC	HL,DE		;CP HL,DE
  E895  19            		ADD	HL,DE		;
  E896  3801          		JR	C,RBXA1		;DEとHLを比較して大きい方をHLに
  E898  EB            		EX	DE,HL
  E899                	RBXA1:
  E899  E5            		PUSH	HL
  E89A  2A7EF1        		LD	HL,(_DTBUF)
  E89D  09            		ADD	HL,BC
  E89E  ED5B5FF0      		LD	DE,(DTAX)
  E8A2  C1            		POP	BC
  E8A3  C9            		RET
                      	
  E8A4                	RBXB:
  E8A4  2A5FF0        		LD	HL,(DTAX)
  E8A7  ED5BFEF1      		LD	DE,(_CLPS)
  E8AB  3A5EF0        		LD	A,(LEFTX+1)
  E8AE  47            		LD	B,A
  E8AF  3A86E8        		LD	A,(SECSZ+2)	;1024=4 / 512=2 / 256=1
  E8B2                	RBXB1:
  E8B2  1F            		RRA		;->CF
  E8B3  3804          		JR	C,RBXB2
  E8B5  CB38          		SRL	B	;B=B/2
  E8B7  18F9          		JR	RBXB1
  E8B9                	RBXB2:
  E8B9  78            		LD	A,B
  E8BA  B7            		OR	A
  E8BB  C9            		RET
                      	
  E8BC                	RBXC:
  E8BC  ED4B5DF0      		LD	BC,(LEFTX)
  E8C0  3A86E8        		LD	A,(SECSZ+2)	;1024=4 / 512=2 / 256=1
  E8C3  3D            		DEC	A
  E8C4  A0            		AND	B
  E8C5  47            		LD	B,A		;1セクタ以下の端数がない場合はZ
  E8C6  B1            		OR	C
  E8C7  C9            		RET
                      	
  E8C8                	RBXEND:				;レコード数だけランダムレコードを進める
  E8C8  110000        		LD	DE,0		;進めるレコード数(RBSIZE)
  E8C9                	RBSIZE	EQU	$-2
  E8CB  CD16E6        		CALL	GET_RR_AHL
  E8CE  19            		ADD	HL,DE
  E8CF  CE00          		ADC	A,0
  E8D1  CD20E6        		CALL	SET_RR_AHL
  E8D4  EB            		EX	DE,HL		;HL=進めるレコード数
  E8D5  D0            		RET	NC
  E8D6  FDCB207E      		BIT	7,(IY+32)	;(FCB)カレントレコード
  E8DA  C0            		RET	NZ
  E8DB  FD3424        		INC	(IY+36)
  E8DE  C9            		RET
                      	
  E8DF                	GET_RR_BCDE:			;BCDE=Random record
  E8DF  FD5E21        		LD	E,(IY+33)	;(FCB)ランダムレコード
  E8E2  FD5622        		LD	D,(IY+34)
  E8E5  FD4E23        		LD	C,(IY+35)
  E8E8  0600          		LD	B,0		;CP/M互換のアクセスの場合はFCBは36バイト
  E8EA  FDCB207E      		BIT	7,(IY+32)	;(FCB)カレントレコード
  E8EE  C0            		RET	NZ
  E8EF  FD4624        		LD	B,(IY+36)
  E8F2  C9            		RET
                      	
                      	;	ランダムブロックアクセスの連続したセクタをまとめる
                      	
  E8F3                	DWTC:
  E8F3  E5            		PUSH	HL
  E8F4  2183EC        		LD	HL,DWT24B
  E8F7  1804          		JR	DWTC1
  E8F9                	DRDC:
  E8F9  E5            		PUSH	HL
  E8FA  2173EC        		LD	HL,DRD24B
  E8FD                	DWTC1:
  E8FD  2257E9        		LD	(DRWF_MODE),HL
  E900  E1            		POP	HL
  E901  3A47E9        		LD	A,(DRWF_B)
  E904  B7            		OR	A
  E905  200F          		JR	NZ,DRDC1
  E907                	SAVE_DRWC:
  E907  0601          		LD	B,1
  E909  ED4346E9      		LD	(DRWF_C),BC
  E90D  ED534DE9      		LD	(DRWF_E),DE
  E911  2250E9        		LD	(DRWF_HL),HL
  E914  1820          		JR	INC_HL_DRWC
  E916                	DRDC1:
  E916  E5            		PUSH	HL
  E917  214DE9        		LD	HL,DRWF_E
  E91A  86            		ADD	A,(HL)
  E91B  F5            		PUSH	AF
  E91C  BB            		CP	E
  E91D  201D          		JR	NZ,DRDC2
  E91F  F1            		POP	AF
  E920  23            		INC	HL
  E921  7E            		LD	A,(HL)
  E922  CE00          		ADC	A,0
  E924  F5            		PUSH	AF
  E925  BA            		CP	D
  E926  2014          		JR	NZ,DRDC2
  E928  F1            		POP	AF
  E929  3A46E9        		LD	A,(DRWF_C)
  E92C  CE00          		ADC	A,0
  E92E  B9            		CP	C
  E92F  200C          		JR	NZ,DRDC3
  E931  2147E9        		LD	HL,DRWF_B
  E934  34            		INC	(HL)
  E935  E1            		POP	HL
  E936                	INC_HL_DRWC:
  E936  3A86E8        		LD	A,(SECSZ+2)		;1セクタのサイズの上位1バイト
  E939  84            		ADD	A,H
  E93A  67            		LD	H,A
  E93B  C9            		RET
  E93C                	DRDC2:
  E93C  F1            		POP	AF
  E93D                	DRDC3:
  E93D  CD43E9        		CALL	DRW_FLUSH
  E940  E1            		POP	HL
  E941  18C4          		JR	SAVE_DRWC
                      	
                      	;	ランダムブロックアクセスの連続したセクタをまとめたものをフラッシュする
  E943                	DRW_FLUSH:
  E943  C5            		PUSH	BC
  E944  D5            		PUSH	DE
  E945  010000        		LD	BC,0
  E946                	DRWF_C	EQU	$-2
  E947                	DRWF_B	EQU	$-1
  E948  78            		LD	A,B
  E949  B7            		OR	A
  E94A  280D          		JR	Z,DRDF1
  E94C  110000        		LD	DE,0
  E94D                	DRWF_E	EQU	$-2
  E94E                	DRWF_D	EQU	$-1
  E94F  210000        		LD	HL,0
  E950                	DRWF_HL	EQU	$-2
  E952  AF            		XOR	A
  E953  3247E9        		LD	(DRWF_B),A
  E956  CD73EC        		CALL	DRD24B
  E957                	DRWF_MODE	EQU	$-2
  E959                	DRDF1:
  E959  D1            		POP	DE
  E95A  C1            		POP	BC
  E95B  C9            		RET
                      	
                      	;LDDIO.ASM
                      	
                      	;	LSX-Dodgers DIO
                      	
  E95C                	DRDX:
  E95C  CD9AE9        		CALL	DRDY
  E95F  C8            		RET	Z
  E960  CD80E9        		CALL	DRDX1		;データバッファの情報を保存
  E963  D8            		RET	C
  E964  E5            		PUSH	HL
  E965  C5            		PUSH	BC
  E966  D5            		PUSH	DE
  E967  2A7EF1        		LD	HL,(_DTBUF)
  E96A  3AC3E9        		LD	A,(_DBS24+1)
  E96D  4F            		LD	C,A
  E96E  CD71EC        		CALL	DRD24
  E971  DC95E9        		CALL	C,DRDNE
  E974                	POP_DE_BC_HL_RET:
  E974  D1            		POP	DE
  E975  C1            		POP	BC
  E976  E1            		POP	HL
  E977  C9            		RET
                      	
                      	;	CDE:セクタ番号
  E978                	DRDN:
  E978  AF            		XOR	A
  E979  00            	DRDN1:	NOP			;自己書き換え NOP / SCF
  E97A  30E0          		JR	NC,DRDX
  E97C                	DRDNX:
  E97C  CD9AE9        		CALL	DRDY
  E97F  C8            		RET	Z
  E980                	DRDX1:
  E980  CDB0E9        		CALL	DWTX
                      					;データバッファの読み込んだドライブ・セクタ情報を保存
  E983  ED53A6F0      		LD	(_DBSEC),DE
  E987  79            		LD	A,C
  E988  32C3E9        		LD	(_DBS24+1),A
                      	
  E98B  3A88F0        		LD	A,(_DRV)
  E98E  32A5F0        		LD	(_DBDRV),A
  E991  CDD9F0        		CALL	_CHGDRV
  E994  D0            		RET	NC
  E995                	DRDNE:
  E995  9F            		SBC	A,A		;CF=1ならばA=0FFH
  E996  32A5F0        		LD	(_DBDRV),A
  E999  C9            		RET
                      	
                      	;	CDE:セクタ番号
  E99A                	DRDY:
  E99A  3AC3E9        		LD	A,(_DBS24+1)
  E99D  B9            		CP	C
  E99E  C0            		RET	NZ
                      	
  E99F  E5            		PUSH	HL
  E9A0  3A88F0        		LD	A,(_DRV)
  E9A3  21A5F0        		LD	HL,_DBDRV
  E9A6  AE            		XOR	(HL)
  E9A7  2005          		JR	NZ,POP_HL_RET
                      	
  E9A9  2AA6F0        		LD	HL,(_DBSEC)
  E9AC  ED52          		SBC	HL,DE		;CF=0
  E9AE                	POP_HL_RET:
  E9AE  E1            		POP	HL
  E9AF  C9            		RET
                      	
  E9B0                	DWTX:
  E9B0  3AA4F0        		LD	A,(_WTDBF)
  E9B3  B7            		OR	A
  E9B4  C8            		RET	Z
  E9B5  AF            		XOR	A
  E9B6  32A4F0        		LD	(_WTDBF),A
                      	
  E9B9  E5            		PUSH	HL
  E9BA  C5            		PUSH	BC
  E9BB  D5            		PUSH	DE
  E9BC  3AA5F0        		LD	A,(_DBDRV)
  E9BF  CDD9F0        		CALL	_CHGDRV
  E9C2  0E00          	_DBS24:	LD	C,0
  E9C4  ED5BA6F0      		LD	DE,(_DBSEC)
  E9C8  2A7EF1        		LD	HL,(_DTBUF)
  E9CB  D481EC        		CALL	NC,DWT24
  E9CE                	POP_DE_BC_HL_RET2:
  E9CE  18A4          		JR	POP_DE_BC_HL_RET
                      	
  E9D0                	RDFATX:
  E9D0  E5            		PUSH	HL
  E9D1  3A88F0        		LD	A,(_DRV)
  E9D4  21AAF0        		LD	HL,_FATDRV
  E9D7  AE            		XOR	(HL)
  E9D8  28D4          		JR	Z,POP_HL_RET
                      	
  E9DA  C5            		PUSH	BC
  E9DB  D5            		PUSH	DE
  E9DC  DDE5          		PUSH	IX
  E9DE  CDFAE9        		CALL	WTFATX
  E9E1  3813          		JR	C,POP_IX_DE_BC_HL_RET
                      	
  E9E3  AF            		XOR	A
  E9E4  32ABF0        		LD	(_FATIX),A
  E9E7  3A88F0        		LD	A,(_DRV)
  E9EA  32AAF0        		LD	(_FATDRV),A
  E9ED  CDE5F0        		CALL	_RDFAT
  E9F0                	RDFATE2:
  E9F0  3004          		JR	NC,POP_IX_DE_BC_HL_RET
  E9F2  9F            		SBC	A,A		;A=0xFF
  E9F3  32AAF0        		LD	(_FATDRV),A
  E9F6                	POP_IX_DE_BC_HL_RET:
  E9F6  DDE1          		POP	IX
  E9F8  18D4          		JR	POP_DE_BC_HL_RET2
                      	
  E9FA                	WTFATX:
  E9FA  3AA2F0        		LD	A,(_WTFATF)
  E9FD  B7            		OR	A
  E9FE  C8            		RET	Z
  E9FF  E5            		PUSH	HL
  EA00  3AAAF0        		LD	A,(_FATDRV)
  EA03  21A5F0        		LD	HL,_DBDRV
  EA06  AE            		XOR	(HL)
  EA07  CCB0E9        		CALL	Z,DWTX
  EA0A  38A2          		JR	C,POP_HL_RET
  EA0C  C5            		PUSH	BC
  EA0D  D5            		PUSH	DE
  EA0E  DDE5          		PUSH	IX
  EA10  CD8EEC        		CALL	WTFAT
  EA13  AF            		XOR	A
  EA14  32A2F0        		LD	(_WTFATF),A
  EA17  18DD          		JR	POP_IX_DE_BC_HL_RET
                      	
  EA19                	NCL1:
  EA19  7A            		LD	A,D
  EA1A  B3            		OR	E
  EA1B  37            		SCF
  EA1C  C8            		RET	Z
                      	
  EA1D  7A            		LD	A,D
  EA1E  CB3F          		SRL	A	;/2
  EA20  CB3F          		SRL	A	;/2
                      	
  EA22  E5            		PUSH	HL
  EA23  3242EA        		LD	(NCLPAT+2),A	;_FATIX
  EA26  2AAAF0        		LD	HL,(_FATDRV)	;L=_FATDRV H=_FATIX
  EA29  BC            		CP	H
  EA2A  3A88F0        		LD	A,(_DRV)	;この間でフラグは変化しない
  EA2D  3241EA        		LD	(NCLPAT+1),A	;_FATDRV
  EA30  2005          		JR	NZ,NCL2		;FATIXが違う
  EA32  BD            		CP	L
  EA33  2002          		JR	NZ,NCL2		;ドライブが違う
  EA35  E1            		POP	HL
  EA36  C9            		RET
  EA37                	NCL2:
  EA37  C5            		PUSH	BC
  EA38  D5            		PUSH	DE
  EA39  DDE5          		PUSH	IX
  EA3B  CDFAE9        		CALL	WTFATX
  EA3E  38B6          		JR	C,POP_IX_DE_BC_HL_RET
  EA40  010000        	NCLPAT:	LD	BC,0		;自己書き換え C=_FATDRV B=_FATIX
  EA43  ED43AAF0      		LD	(_FATDRV),BC
  EA47  CD63EC        		CALL	RDFATS
  EA4A  18A4          		JR	RDFATE2
                      	
  EA4C                	NCL3:
  EA4C  CB9A          		RES	3,D
  EA4E  CB92          		RES	2,D
  EA50  6B            		LD	L,E
  EA51  62            		LD	H,D
  EA52  CB3C          		SRL	H	;
  EA54  CB1D          		RR	L	;HLA=HLA/2
  EA56  1F            		RRA		;
  EA57  F5            		PUSH	AF
  EA58  3AABF0        		LD	A,(_FATIX)
  EA5B  0F            		RRCA
  EA5C  300B          		JR	NC,NCL3X1
  EA5E  3A86E8        		LD	A,(SECSZ+2)
  EA61  FE04          		CP	4		;1セクタ1024バイトの場合は奇数インデックスの場合に先頭を512バイトずらす
  EA63  2004          		JR	NZ,NCL3X1
  EA65  010002        		LD	BC,512
  EA68  09            		ADD	HL,BC
  EA69                	NCL3X1:
  EA69  F1            		POP	AF
  EA6A  ED4B7CF1      		LD	BC,(_FATBF)
  EA6E  19            		ADD	HL,DE
  EA6F  09            		ADD	HL,BC
  EA70  17            		RLA
  EA71  C9            		RET
                      	
  EA72                	GNCL:
  EA72  CD19EA        		CALL	NCL1		;GET NEXT CLUSTER
  EA75  D8            		RET	C
  EA76  C5            		PUSH	BC
  EA77  E5            		PUSH	HL
  EA78  CD4CEA        		CALL	NCL3
  EA7B  3809          		JR	C,GNC1
  EA7D  5E            		LD	E,(HL)
  EA7E  23            		INC	HL
  EA7F  7E            		LD	A,(HL)
  EA80  E60F          		AND	00FH
  EA82  57            		LD	D,A
  EA83  E1            		POP	HL
  EA84  C1            		POP	BC
  EA85  C9            		RET
  EA86                	GNC1:
  EA86  7E            		LD	A,(HL)
  EA87  23            		INC	HL
  EA88  56            		LD	D,(HL)
  EA89  0604          		LD	B,4
  EA8B                	GNC1L:
  EA8B  CB3A          		SRL	D	;DA=DA/2
  EA8D  1F            		RRA		;
  EA8E  10FB          		DJNZ	GNC1L
                      	
  EA90  5F            		LD	E,A
  EA91  E1            		POP	HL
  EA92  C1            		POP	BC
  EA93  A7            		AND	A
  EA94  C9            		RET
                      	
  EA95                	SNCL:
  EA95  CD19EA        		CALL	NCL1
  EA98  D8            		RET	C
                      	;				SET NEXT CLUSTER
  EA99  E5            		PUSH	HL
  EA9A  C5            		PUSH	BC
  EA9B  D5            		PUSH	DE
  EA9C  E5            		PUSH	HL
  EA9D  CD4CEA        		CALL	NCL3
  EAA0  D1            		POP	DE
                      	;CF=ODD
  EAA1  7E            		LD	A,(HL)
  EAA2  73            		LD	(HL),E
  EAA3  3806          		JR	C,SNC1
                      	;EVEN
                      	;M[0] = E
                      	;M[1] = (M[1] & 0xF0) | (D & 0x0F)
  EAA5  23            		INC	HL
  EAA6  ED67          		RRD		;M={A[3:0],E[3:0]}
  EAA8  7A            		LD	A,D
  EAA9  1804          		JR	SNC11
  EAAB                	SNC1:
                      	;ODD
                      	;HL[0] = (HL[0]&0x0F) | (E<<4)
                      	;HL[1] = DE>>4
  EAAB  ED6F          		RLD		;M={D[3:0],E[7:4]}
  EAAD  23            		INC	HL
  EAAE  72            		LD	(HL),D	;M={D[3:0],E[7:4]}
  EAAF                	SNC11:
  EAAF  ED6F          		RLD		;M={M[7:4],D[3:0]}
  EAB1  B7            		OR	A
  EAB2  D1            		POP	DE
  EAB3  C1            		POP	BC
  EAB4  E1            		POP	HL
  EAB5                	FAT_CHANGED:
  EAB5  3E01          		LD	A,1
  EAB7  32A2F0        		LD	(_WTFATF),A
  EABA  C9            		RET
                      	
  EABB                	N16CL3:
  EABB  C5            		PUSH	BC
  EABC  6B            		LD	L,E
  EABD  7A            		LD	A,D
  EABE  E603          		AND	3
  EAC0  67            		LD	H,A
  EAC1  29            		ADD	HL,HL
  EAC2  ED4B7CF1      		LD	BC,(_FATBF)
  EAC6  09            		ADD	HL,BC
  EAC7  C1            		POP	BC
  EAC8  C9            		RET
                      	
  EAC9                	GNCL16:
  EAC9  CD19EA        		CALL	NCL1		;GET NEXT CLUSTER for FAT16
  EACC  D8            		RET	C
  EACD  E5            		PUSH	HL
  EACE  CDBBEA        		CALL	N16CL3
  EAD1  5E            		LD	E,(HL)
  EAD2  23            		INC	HL
  EAD3  56            		LD	D,(HL)
  EAD4  E1            		POP	HL
  EAD5  C9            		RET
                      	
  EAD6                	SNCL16:
  EAD6  CD19EA        		CALL	NCL1		;GET NEXT CLUSTER for FAT16
  EAD9  D8            		RET	C
  EADA  D5            		PUSH	DE
  EADB  E5            		PUSH	HL
  EADC  CDBBEA        		CALL	N16CL3
  EADF  D1            		POP	DE		;HL
  EAE0  73            		LD	(HL),E
  EAE1  23            		INC	HL
  EAE2  72            		LD	(HL),D
  EAE3  6B            		LD	L,E
  EAE4  62            		LD	H,D
  EAE5  D1            		POP	DE
  EAE6  18CD          		JR	FAT_CHANGED
                      	
                      	;------------------------
                      	;次のセクタを探す際に_SECPSの値をチェック
                      	;in
                      	;	DE : セクタ番号
                      	;out
                      	;	DE : 次のセクタ番号
                      	;note
                      	;
                      	;------------------------
  EAE8                	NEXTX:
  EAE8  3E00          	_SECPS:	LD	A,0	;自己書き換え
  EAEA  3C            		INC	A
  EAEB  E600          	NCPAT:	AND	0	;自己書き換え　1クラスタの論理セクタ数-1
  EAED  32E9EA        		LD	(_SECPS+1),A
  EAF0  C9            		RET
                      	
  EAF1                	GNCLX:
  EAF1  CDE8EA        		CALL	NEXTX
  EAF4  C0            		RET	NZ	;1クラスタのセクタ未満の場合は戻る
  EAF5  C3F7F0        		JP	_GNCL	;次のクラスタを探す
                      	
  EAF8                	RDFAT:
  EAF8  3E80          		LD	A,080H
  EAFA  3270F0        		LD	(CHECK),A
  EAFD                	RDFAT1:
  EAFD  3A88F0        		LD	A,(_DRV)
  EB00  CDB8ED        		CALL	CHGDRVR
  EB03  D8            		RET	C
  EB04  DD7E12        		LD	A,(IX+012H)	;DPB_12_DEVICE
  EB07  CB6F          		BIT	5,A
  EB09  286B          		JR	Z,RDFAT0X
  EB0B  2170F0        		LD	HL,CHECK
  EB0E  A6            		AND	(HL)
  EB0F  77            		LD	(HL),A
  EB10  110000        		LD	DE,0		;BPB
  EB13  2A7CF1        		LD	HL,(_FATBF)
  EB16  CD6FEC        		CALL	DRD16
  EB19  3024          		JR	NC,GETBPB
  EB1B  2170F0        		LD	HL,CHECK
  EB1E  CB06          		RLC	(HL)
  EB20  3F            		CCF
  EB21  D8            		RET	C
  EB22  DDCB0A1E      		RR	(IX+00AH)	;DPB_0A_FDMODE
  EB26  3F            		CCF			;フロッピーディスクのFDモードを切り替える
  EB27  DDCB0A16      		RL	(IX+00AH)	;DPB_0A_FDMODE
  EB2B  3EFF          		LD	A,0FFH
  EB2D  3289F0        		LD	(_DSK),A
  EB30  3A84F0        		LD	A,(_DRIVE)
  EB33  E603          		AND	3
  EB35  F680          		OR	080H
  EB37  6F            		LD	L,A
  EB38  26F0          		LD	H,_CYL0/256
  EB3A  3EFF          		LD	A,0FFH
  EB3C  77            		LD	(HL),A
  EB3D  18BE          		JR	RDFAT1
  EB3F                	GETBPB:
  EB3F  FDE5          		PUSH	IY
  EB41  FD2A7CF1      		LD	IY,(_FATBF)	;BPB
  EB45  CDF1F0        		CALL	_BPB2DPB
  EB48  FDE1          		POP	IY
  EB4A  DD7E12        		LD	A,(IX+012H)	;DPB_12_DEVICE
  EB4D  3021          		JR	NC,GETBPBOK
  EB4F  E60F          		AND	00FH
  EB51  FE07          		CP	7
  EB53  37            		SCF
  EB54  C0            		RET	NZ
  EB55  DDCB0A46      		BIT	0,(IX+00AH)	;DPB_0A_FDMODE
  EB59  21C0F1        		LD	HL,M2D
  EB5C  2002          		JR	NZ,SETFDMODE
  EB5E  2ED2          		LD	L,M2HD-STABLE
  EB60                	SETFDMODE:
  EB60  DDE5          		PUSH	IX
  EB62  D1            		POP	DE
  EB63  EDA0          		LDI
  EB65  EDA0          		LDI
  EB67  13            		INC	DE
  EB68  13            		INC	DE
  EB69  13            		INC	DE
  EB6A  13            		INC	DE
  EB6B  010C00        		LD	BC,12
  EB6E  EDB0          		LDIR
  EB70                	GETBPBOK:
  EB70  327FEB        		LD	(DEVSWC),A
  EB73  CD17ED        		CALL	CHGDRV2
  EB76                	RDFAT0X:
  EB76  CD63EC        		CALL	RDFATS
  EB79  D8            		RET	C
  EB7A  DDAE06        		XOR	(IX+6)		;DPB_06_FATID
  EB7D  C8            		RET	Z
  EB7E  3E00          		LD	A,0		;DPB_12_DEVICE
  EB7F                	DEVSWC	EQU	$-1
  EB80  CB6F          		BIT	5,A
  EB82  C0            		RET	NZ		;BPBを取得している場合はFATIDをチェックしない
  EB83  37            		SCF
  EB84  C9            		RET
                      	
  EB85                	BPB2DPB:
  EB85  FD7E0B        		LD	A,(IY+11)	;BPB_BytsPerSec
  EB88  B7            		OR	A
  EB89  37            		SCF
  EB8A  C0            		RET	NZ
  EB8B                	BPBOK:
  EB8B  FD7E0D        		LD	A,(IY+13)	;BPB_SecPerClus
  EB8E  DD7707        		LD	(IX+7),A	;DPB_07_SECPCL
                      	
  EB91  FD7E16        		LD	A,(IY+22)	;BPB_FATSz16
  EB94  DD7700        		LD	(IX+0),A	;DPB_00_FATLN
  EB97  FD7E17        		LD	A,(IY+23)	;BPB_FATSz16
  EB9A  DD7701        		LD	(IX+1),A	;DPB_00_FATLN
                      	
  EB9D  FD6E0E        		LD	L,(IY+14)	;BPB_RsvdSecCnt
  EBA0  FD660F        		LD	H,(IY+15)
  EBA3  DD750E        		LD	(IX+00EH),L	;DPB_0E_FATPS
  EBA6  FD5E16        		LD	E,(IY+22)	;BPB_FATSz16
  EBA9  FD5617        		LD	D,(IY+23)
  EBAC  FD4610        		LD	B,(IY+16)	;BPB_NumFATs
  EBAF                	BPBDP1:				;BPB_FATSz16 * BPB_NumFATs
  EBAF  19            		ADD	HL,DE
  EBB0  10FD          		DJNZ	BPBDP1
  EBB2                	BPBDP2:
  EBB2  DD7510        		LD	(IX+010H),L	;DPB_10_DIRPS
  EBB5  DD7411        		LD	(IX+011H),H
  EBB8  E5            		PUSH	HL
                      	
  EBB9  FD6E11        		LD	L,(IY+17)	;BPB_RootEntCnt
  EBBC  FD6612        		LD	H,(IY+18)
  EBBF  FD7E0C        		LD	A,(IY+12)	;BPB_BytsPerSec
  EBC2  B7            		OR	A
  EBC3  37            		SCF
  EBC4  C8            		RET	Z
  EBC5  0606          		LD	B,6
  EBC7                	BPBBPS1:
  EBC7  05            		DEC	B
  EBC8  0F            		RRCA
  EBC9  30FC          		JR	NC,BPBBPS1
  EBCB                	BPBDE1:
  EBCB  29            		ADD	HL,HL
  EBCC  10FD          		DJNZ	BPBDE1
                      	
  EBCE  7C            		LD	A,H
  EBCF  DD770B        		LD	(IX+00BH),A	;DPB_0B_DIRSCNT
                      	
  EBD2  D1            		POP	DE		;DPB_10_DIRPS
  EBD3  6C            		LD	L,H
  EBD4  2600          		LD	H,0
  EBD6  19            		ADD	HL,DE		;MAXDIR
  EBD7  E5            		PUSH	HL
  EBD8  FD4E0D        		LD	C,(IY+13)	;BPB_SecPerClus
  EBDB  CB21          		SLA	C		;*2
  EBDD  AF            		XOR	A
  EBDE  47            		LD	B,A
  EBDF  ED42          		SBC	HL,BC
  EBE1  DD7514        		LD	(IX+014H),L	;DPB_14_ADDCL16
  EBE4  DD7415        		LD	(IX+015H),H
                      	
  EBE7  D1            		POP	DE		;DE=DPB_0B_MAXDIR
  EBE8  FD6E13        		LD	L,(IY+19)	;BPB_TotSec16
  EBEB  FD6614        		LD	H,(IY+20)
                      	
  EBEE  DD7E12        		LD	A,(IX+012H)	;DPB_12_DEVICE
  EBF1  E60F          		AND	00FH
  EBF3  FE07          		CP	7		;フロッピー
  EBF5  2019          		JR	NZ,NOT_FD
  EBF7  E5            		PUSH	HL
  EBF8  FD4E18        		LD	C,(IY+24)	;BPB_SecPerTr
  EBFB  DD710D        		LD	(IX+00DH),C	;DPB_0D_MAXSEC
  EBFE  AF            		XOR	A
  EBFF  CB21          		SLA	C		;両面なのでセクタ数を２倍
  EC01  0610          		LD	B,16
  EC03                	DIVSEC:				;MAXCYL = BPB_TotSec16 / (BPB_SecPerTr * 2)
  EC03  29            		ADD	HL,HL
  EC04  17            		RLA
  EC05  B9            		CP	C
  EC06  3802          	   	JR	C,DIVSEC1
  EC08  91            	   	SUB	C
  EC09  2C            		INC	L
  EC0A                	DIVSEC1:
  EC0A  10F7          	 	DJNZ	DIVSEC
  EC0C  DD750C        		LD	(IX+00CH),L	;DPB_0C_MAXCYL
  EC0F  E1            		POP	HL	;ここまでフロッピー専用
  EC10                	NOT_FD:
  EC10  7C            		LD	A,H
  EC11  B5            		OR	L
  EC12  3E00          		LD	A,0		;LDでフラグは変化しない。BPB_TotSec16を AHL で扱う為、Aに0を入れる
  EC14  2010          		JR	NZ,BPB16BIT	;BPB_TotSec16が「0」の場合はBPB_TotSec32で計算
  EC16  FD7E23        		LD	A,(IY+35)	;念のために総セクタ数が24ビットを超える場合はエラーを返す
  EC19  B7            		OR	A
  EC1A  37            		SCF
  EC1B  C0            		RET	NZ
  EC1C  FD6E20        		LD	L,(IY+32)	;BPB_TotSec32 は AHL の24ビットで扱う
  EC1F  FD6621        		LD	H,(IY+33)	;1クラスタの論理セクタ数(DPB_07_SECPCL)が最大128なので
  EC22  FD7E22        		LD	A,(IY+34)	;24ビットを超えると必ずクラスタ数が16ビットを超えてしまうのでこれで十分
  EC25  A7            		AND	A		;CF=0
  EC26                	BPB16BIT:
  EC26  ED52          		SBC	HL,DE
  EC28  DE00          		SBC	A,0
  EC2A  FD460D        		LD	B,(IY+13)	;BPB_SecPerClus
  EC2D                	BPBTC1:				;総クラスタ数(AHL) = 総セクタ数(AHL) / セクタサイズ(B)
  EC2D  CB18          		RR	B		;->CY
  EC2F  3808          		JR	C,BPBTC2
  EC31  CB3F          		SRL	A
  EC33  CB1C          		RR	H		;AHL=AHL/2
  EC35  CB1D          		RR	L
  EC37  18F4          		JR	BPBTC1
  EC39                	BPBTC2:
  EC39  B7            		OR	A
  EC3A  37            		SCF
  EC3B  C0            		RET	NZ		;念のため(クラスタ数が16ビットを超える場合)
  EC3C  23            		INC	HL
  EC3D  23            		INC	HL
  EC3E  DD7508        		LD	(IX+8),L	;DPB_08_MAXCL
  EC41  DD7409        		LD	(IX+9),H
                      	
  EC44  FD7E15        		LD	A,(IY+21)	;BPB_Media
  EC47  DD7706        		LD	(IX+6),A	;DPB_06_FATID
                      	
  EC4A  FD7E10        		LD	A,(IY+16)	;BPB_NumFATs
  EC4D  C6FE          		ADD	A,0-2		;>2:CF=1
  EC4F  FD7E0C        		LD	A,(IY+12)	;BPB_BytsPerSec
  EC52  6F            		LD	L,A
  EC53  3002          		JR	NC,BPBFAT1
  EC55  F680          		OR	080H
  EC57                	BPBFAT1:
  EC57  DD770F        		LD	(IX+00FH),A	;DPB_0F_BPS
  EC5A  2D            		DEC	L		;以下のセクタサイズに合致しない場合はCF=1でエラーにする
  EC5B  C8            		RET	Z		;1セクタ256バイト
  EC5C  2D            		DEC	L
  EC5D  C8            		RET	Z		;1セクタ512バイト
  EC5E  2D            		DEC	L
  EC5F  2D            		DEC	L
  EC60  C8            		RET	Z		;1セクタ1024バイト
  EC61  37            		SCF
  EC62  C9            		RET
                      	
  EC63                	RDFATS:
  EC63  CDA9EC        		CALL	FATSETUP
  EC66  D8            		RET	C
  EC67  CD73EC        		CALL	DRD24B
  EC6A  2A7CF1        		LD	HL,(_FATBF)
  EC6D  7E            		LD	A,(HL)
  EC6E  C9            		RET
                      	
  EC6F                	DRD16:
  EC6F  0E00          		LD	C,0
  EC71                	DRD24:
  EC71  0601          		LD	B,1
  EC73                	DRD24B:
  EC73  DDE5          		PUSH	IX
  EC75  DD2AA8F0      		LD	IX,(_DPB)
  EC79  CDD3EE        	DRDPAT:	CALL	FDRD		;自己書き換え（ディスク読み込み）
  EC7C                	POP_IX_RET:
  EC7C  DDE1          		POP	IX
  EC7E  C9            		RET
                      	
  EC7F                	DWT16:
  EC7F  0E00          		LD	C,0
  EC81                	DWT24:
  EC81  0601          		LD	B,1
  EC83                	DWT24B:
  EC83  DDE5          		PUSH	IX
  EC85  DD2AA8F0      		LD	IX,(_DPB)
  EC89  CDC5EE        	DWTPAT:	CALL	FDWT		;自己書き換え（ディスク書き込み）
  EC8C  18EE          		JR	POP_IX_RET
                      	
  EC8E                	WTFAT:
  EC8E  CDA9EC        		CALL	FATSETUP
  EC91  D483EC        		CALL	NC,DWT24B
  EC94  D8            		RET	C
  EC95  DDCB0F7E      		BIT	7,(IX+00FH)	;DPB_0F_BPS
  EC99  C8            		RET	Z		;予備FATが無い
  EC9A  CDB0EC        		CALL	FATS2
  EC9D  E5            		PUSH	HL		;予備FAT
  EC9E  DD6E00        		LD	L,(IX+0)	;DPB_00_FATLN
  ECA1  DD6601        		LD	H,(IX+1)
  ECA4  19            		ADD	HL,DE
  ECA5  EB            		EX	DE,HL
  ECA6  E1            		POP	HL
  ECA7  18DA          		JR	DWT24B
                      	;------------------------
                      	;FATのセットアップ
                      	;out
                      	;	B  : FATセクタ数
                      	;	DE : FAT先頭セクタ番号
                      	;	HL : FATバッファポインタ
                      	;	CF : 1=ドライブ切り替えエラー
                      	;note
                      	;	FATサイズがFATバッファを超える場合は
                      	;	対象クラスタ領域==(_FATIX)によって
                      	;	FAT12:対象クラスタ1024毎に1.5KBを切り替える
                      	;	FAT16:対象クラスタ1024毎に2KBを切り替える
                      	;------------------------
  ECA9                	FATSETUP:
  ECA9  3AAAF0        		LD	A,(_FATDRV)
  ECAC  CDB8ED        		CALL	CHGDRVR		;ドライブ切り替え
  ECAF  D8            		RET	C
  ECB0                	FATS2:
  ECB0  DD7E0F        		LD	A,(IX+00FH)	;DPB_0F_BPS 512=2 1024=4
  ECB3  0F            		RRCA
  ECB4  CDDDEC        	FATSX:	CALL	FATSETUP12	;自己書き換え
  ECB7  210000        		LD	HL,0
  ECBA  4A            		LD	C,D
  ECBB  54            		LD	D,H
  ECBC  3AABF0        		LD	A,(_FATIX)	;範囲FAT12:0-3/FAT16:0-63(0-03FH):65535*2/2048
  ECBF  47            		LD	B,A
  ECC0  04            		INC	B
  ECC1  DD7E00        		LD	A,(IX+0)	;DPB_00_FATLN
  ECC4                	FAT_SKP:
  ECC4  05            		DEC	B
  ECC5  2805          		JR	Z,FAT1
  ECC7  19            		ADD	HL,DE
  ECC8  93            		SUB	E
  ECC9  30F9          		JR	NC,FAT_SKP
  ECCB  C9            		RET
  ECCC                	FAT1:
  ECCC  EB            		EX	DE,HL
  ECCD  B9            		CP	C		;C=FATバッファに読み込めるセクタ数
  ECCE  3801          		JR	C,FAT2
  ECD0  79            		LD	A,C
  ECD1                	FAT2:
  ECD1  47            		LD	B,A
                      	
  ECD2  2AFAF1        		LD	HL,(_FATPS)	;fat sector pos
  ECD5  19            		ADD	HL,DE
  ECD6  EB            		EX	DE,HL
  ECD7  2A7CF1        		LD	HL,(_FATBF)
  ECDA  AF            		XOR	A		;CF=0
  ECDB  4F            		LD	C,A
  ECDC  C9            		RET
                      	;
                      	;	FATバッファに読み込める最大のセクタ数と_FATIXで進めるセクタ数
                      	;	FATSETUP* (FAT12/FAT16)
                      	;out
                      	;	D : FATバッファに読み込める最大のセクタ数
                      	;	E : _FATIXで進めるセクタ数
  ECDD                	FATSETUP12:
  ECDD  110606        		LD	DE,0606H	;256
  ECE0  D8            		RET	C
  ECE1  110303        		LD	DE,0303H	;512
  ECE4  0F            		RRCA
  ECE5  D8            		RET	C
  ECE6  110102        		LD	DE,0201H	;1024
  ECE9  C9            		RET
                      	
  ECEA                	FATSETUP16:
  ECEA  110808        		LD	DE,0808H	;256
  ECED  D8            		RET	C
  ECEE  110404        		LD	DE,0404H
  ECF1  0F            		RRCA			;512
  ECF2  D8            		RET	C
  ECF3  110202        		LD	DE,0202H	;1024
  ECF6  C9            		RET
                      	
  ECF7                	CHGDRV:
  ECF7  E5            		PUSH	HL
  ECF8  2189F0        		LD	HL,_DSK
  ECFB  BE            		CP	(HL)
  ECFC  280A          		JR	Z,CHGDRVE
  ECFE                	CHGDRV1:
  ECFE  DDE5          		PUSH	IX
  ED00  CD0AED        		CALL	CHGDRV0
  ED03  3A89F0        		LD	A,(_DSK)
  ED06  DDE1          		POP	IX
  ED08                	CHGDRVE:
  ED08  E1            		POP	HL
  ED09  C9            		RET
                      	
  ED0A                	CHGDRV0:
  ED0A  6F            		LD	L,A
  ED0B  CDDCF0        		CALL	_GETDPB
  ED0E  D8            		RET	C
  ED0F  DD22A8F0      		LD	(_DPB),IX
  ED13  7D            		LD	A,L
  ED14  3289F0        		LD	(_DSK),A
  ED17                	CHGDRV2:
  ED17  C5            		PUSH	BC
  ED18  D5            		PUSH	DE
  ED19  ED736EED      		LD	(SPPAT2+1),SP
  ED1D  F3            		DI
  ED1E  DDF9          		LD	SP,IX
                      	
  ED20  E1            		POP	HL		;DPB_00_FATLN
  ED21  E1            		POP	HL		;DPB_02_DRD
  ED22  227AEC        		LD	(DRDPAT+1),HL
                      	
  ED25  E1            		POP	HL
  ED26  228AEC        		LD	(DWTPAT+1),HL	;DPB_04_DWT
                      	
  ED29  E1            		POP	HL		;L=DPB_06_FATID H=DPB_07_SECPCL
  ED2A  7C            		LD	A,H
  ED2B  3276E3        		LD	(SPCPAT+1),A	;1クラスタの論理セクタ数
  ED2E  3D            		DEC	A
  ED2F  32ECEA        		LD	(NCPAT+1),A
                      	
  ED32  E1            		POP	HL		;DPB_08_MAXCL
  ED33  7D            		LD	A,L
  ED34  3295E3        		LD	(CLPAT2+1),A
  ED37  7C            		LD	A,H
  ED38  3291E3        		LD	(CLPAT1+1),A
  ED3B  2B            		DEC	HL
  ED3C  229DE5        		LD	(MAXCLP+1),HL
                      	
  ED3F  E1            		POP	HL		;L=DPB_0A_FDMODE H=DPB_0B_DIRSCNT
  ED40  7D            		LD	A,L
  ED41  F6FE          		OR	0FEH
  ED43  326EEE        		LD	(FDMODE+1),A
  ED46  07            		RLCA
  ED47  E603          		AND	3
  ED49  3256EE        		LD	(FSPAT+1),A
  ED4C  4C            		LD	C,H
                      	
  ED4D  E1            		POP	HL		;L=DPB_0C_MAXCYL H=DPB_0D_MAXSEC
                      	
  ED4E  E1            		POP	HL		;L=DPB_0E_FATPS H=DPB_0F_BPS
  ED4F  7C            		LD	A,H		;DPB_0F_BPS
  ED50  E607          		AND	7
  ED52  3286E8        		LD	(SECSZ+2),A	;1セクタのサイズの上位1バイト 0x400 - 0x200 - 0x100
                      					;1セクタ512 2D/2DD/2HC/2HQ(2HD1.44MB)/EMM/BRAM/EMEM等
                      					;1セクタ1024 2HD/2HDE98
                      					;1セクタ256 GRAM/RAMF/CMOS/等
                      					;1024	512	256
                      					;4	2	1
  ED55  87            		ADD	A,A		;8	4	2
  ED56  87            		ADD	A,A		;010H	8	4
  ED57  87            		ADD	A,A		;020H	010H	8
  ED58  32F2E1        		LD	(SDECPAT+1),A	;1セクタ辺りのディレクトリエントリ数
                      	
  ED5B  2600          		LD	H,0
  ED5D  22FAF1        		LD	(_FATPS),HL
                      	
  ED60  E1            		POP	HL		;DPB_10_DIRPS
  ED61  22FCF1        		LD	(_DIRPS),HL
                      	
  ED64  E1            		POP	HL		;L=DPB_12_DEVICE H=DPB_13_UNITNO
  ED65  7C            		LD	A,H
  ED66  3284F0        		LD	(_DRIVE),A
                      	
  ED69  E1            		POP	HL		;DPB_14_ADDCL16
  ED6A  2286E3        		LD	(CLSPAT+1),HL
                      	
  ED6D  310000        	SPPAT2:	LD	SP,0		;元のSPを復元
  ED70  FB            		EI
  ED71  2AFCF1        		LD	HL,(_DIRPS)
  ED74  0600          		LD	B,0
  ED76  09            		ADD	HL,BC		;C=DPB_0B_DIRSCNT
  ED77  220DE2        		LD	(MD_PAT+1),HL
                      	
  ED7A  2A9DE5        		LD	HL,(MAXCLP+1);
  ED7D  11F60F        		LD	DE,4086		;クラスタ数が4086未満:FAT12 4086以上:FAT16
  ED80  ED52          		SBC	HL,DE		;CF=0のはず
  ED82  300F          		JR	NC,SETFAT16
  ED84  2172EA        		LD	HL,GNCL		;FAT12
  ED87  1195EA        		LD	DE,SNCL
  ED8A  01DDEC        		LD	BC,FATSETUP12
  ED8D  DDCB0FAE      		RES	5,(IX+00FH)	;DPB_0F_BPS(FAT12)
  ED91  180D          		JR	EXTRA1
  ED93                	SETFAT16:
  ED93  21C9EA        		LD	HL,GNCL16	;FAT16
  ED96  11D6EA        		LD	DE,SNCL16
  ED99  01EAEC        		LD	BC,FATSETUP16
  ED9C  DDCB0FEE      		SET	5,(IX+00FH)	;DPB_0F_BPS(FAT16)
  EDA0                	EXTRA1:
  EDA0  22F8F0        		LD	(GNCPAT+1),HL
  EDA3  ED53FBF0      		LD	(SNCPAT+1),DE
  EDA7  ED43B5EC      		LD	(FATSX+1),BC
  EDAB  D1            		POP	DE
  EDAC  C1            		POP	BC
  EDAD  AF            		XOR	A
  EDAE  C9            		RET
                      	
  EDAF                	GETDPBD:
  EDAF  DDE3          		EX	(SP),IX
  EDB1  DDE5          		PUSH	IX
  EDB3  3A88F0        		LD	A,(_DRV)
  EDB6  1807          		JR	GETDPB1
                      	
  EDB8                	CHGDRVR:
  EDB8  CDD9F0        		CALL	_CHGDRV
  EDBB  D8            		RET	C
  EDBC  3A89F0        		LD	A,(_DSK)
  EDBF                	GETDPB1:
  EDBF  C3DCF0        		JP	_GETDPB
                      	
  EDC2                	GETDPB:
  EDC2  FE08          		CP	8
  EDC4  3F            		CCF
  EDC5  D8            		RET	C
  EDC6  0F            		RRCA
  EDC7  0F            		RRCA
  EDC8  0F            		RRCA
  EDC9  DD            		DB	0DDH		;Z80未定義命令
  EDCA  6F            		LD	L,A		;LD	IXL,A
  EDCB  DD            		DB	0DDH		;Z80未定義命令
  EDCC  26F2          		LD	H,DEVICE/256	;LD	IXH,DEVICE/256
  EDCE  DD7E00        		LD	A,(IX+0)	;DPB_00_FATLN
  EDD1  A7            		AND	A		;CF=0の為
  EDD2  DDCB0F6E      		BIT	5,(IX+00FH)	;DPB_0F_BPS
  EDD6  C0            		RET	NZ		;FAT16
  EDD7  DDCB126E      		BIT	5,(IX+012H)	;DPB_12_DEVICE
  EDDB  C0            		RET	NZ		;BPB
  EDDC  FE01          		CP	001H		;A=0 THEN CF=1
  EDDE  C9            		RET
                      	
  EDDF                	_SYS5F:
  EDDF  AF            		XOR	A
  EDE0                	FFLUSH:
  EDE0  F5            		PUSH	AF
  EDE1  3EFF          		LD	A,0FFH
  EDE3  3239F0        		LD	(SFILE),A
  EDE6  CDB0E9        		CALL	DWTX
  EDE9  3EFF          		LD	A,0FFH
  EDEB  32A5F0        		LD	(_DBDRV),A
  EDEE  CDFAE9        		CALL	WTFATX
  EDF1  AF            		XOR	A
  EDF2  32ABF0        		LD	(_FATIX),A
  EDF5  2F            		CPL			;0FFH
  EDF6  32AAF0        		LD	(_FATDRV),A
  EDF9  F1            		POP	AF
  EDFA  C9            		RET
                      	
                      	
                      	;X1DISK.ASM
                      	
                      	;	LSX-Dodgers DISK
                      	;	X1/turbo/Z
                      	
  EDFB                	SEEK:
  EDFB  0610          		LD	B,16
  EDFD  DD4E0D        		LD	C,(IX+0DH)	;DPB_0D_MAXSEC
  EE00  AF            		XOR	A
  EE01  EB            		EX	DE,HL
  EE02                	DIV1:
  EE02  29            		ADD	HL,HL
  EE03  8F            		ADC	A,A
  EE04  B9            		CP	C
  EE05  3802          		JR	C,DIV2
  EE07  91            		SUB	C
  EE08  2C            		INC	L
  EE09                	DIV2:
  EE09  10F7          		DJNZ	DIV1
                      	
  EE0B  3C            		INC	A	;最小のセクタは１固定
  EE0C  55            		LD	D,L	;TRACK
  EE0D  5F            		LD	E,A	;SECTOR
  EE0E  CB3A          		SRL	D	;CYLINDER
  EE10  9F            		SBC	A,A
  EE11  E610          		AND	010H	;SIDE
  EE13  4F            		LD	C,A
                      	
  EE14  3A84F0        		LD	A,(_DRIVE)
  EE17  FE04          		CP	4
  EE19  3F            		CCF
  EE1A  D8            		RET	C
  EE1B  B1            		OR	C
  EE1C  329AEE        		LD	(MOPAT+1),A	;Motor off data
  EE1F  01FC0F        		LD	BC,00FFCH
  EE22  F680          		OR	080H		;Motor on
  EE24  ED79          		OUT	(C),A
                      	
  EE26  CD6CEE        		CALL	SETMODE
  EE29  D8            		RET	C
                      	
  EE2A  CDAFEE        		CALL	DRIVE
  EE2D  FEFF          		CP	0FFH		;A=0FFH Unknown CYLINDER
  EE2F  CC8EEE        		CALL	Z,FDCRES	;Restore
  EE32  0EF9          		LD	C,0F9H
  EE34  ED79          		OUT	(C),A		;Currrent CYLINDER
  EE36  92            		SUB	D
  EE37  C8            		RET	Z		;No seek
                      	
  EE38  3A86F0        		LD	A,(_ISEEK)
  EE3B  4F            		LD	C,A
                      	
  EE3C  DD7E0C        		LD	A,(IX+00CH)	;DPB_0C_MAXCYL
  EE3F  3D            		DEC	A
  EE40  BA            		CP	D		;Over CYLINDER
  EE41  D8            		RET	C
                      	
  EE42  B9            		CP	C		;for Built-in 2DD
  EE43  3803          		JR	C,SETM2
  EE45  78            		LD	A,B		;B=00FH
  EE46  DBFE          		IN	A,(0FEH)		;2HD mode for 2DD seek
  EE48                	SETM2:
  EE48  78            		LD	A,B
  EE49  DBFD          		IN	A,(0FDH)		;MFM mode
                      	
  EE4B  0EFB          		LD	C,0FBH
  EE4D  ED51          		OUT	(C),D
  EE4F  72            		LD	(HL),D
  EE50  0E18          		LD	C,018H		;Seek
  EE52                	FDCCMD2:
  EE52  3A85F0        		LD	A,(_SEEKSP)
  EE55  E6FF          	FSPAT:	AND	0FFH
  EE57  B1            		OR	C
                      	
  EE58                	FDCCMD:
  EE58  CDA5EE        		CALL	COMSET
                      	
  EE5B  3E80          	FDCPAT:	LD	A,080H		;FDC COMMAND(Self-modifying code)
  EE5D  E620          		AND	020H		;Write data Write track
  EE5F  3C            		INC	A
                      	
  EE60                	SST:
  EE60  0E00          		LD	C,0
  EE62                	SST1:
  EE62  0D            		DEC	C		; 4
  EE63  20FD          		JR	NZ,SST1		;12 * 256 / 4 = About 1ms
  EE65  3D            		DEC	A
  EE66  20FA          		JR	NZ,SST1
                      	
  EE68  3C            		INC	A		;A=1
  EE69  CD77EE        		CALL	READY
  EE6C                	SETMODE:
  EE6C  78            		LD	A,B		;B=00FH
  EE6D  DBFF          	FDMODE:	IN	A,(0FFH)	;Floppy mode(2D/2HD) (Self-modifying code)
                      	
  EE6F  78            		LD	A,B
  EE70  DBFD          		IN	A,(0FDH)	;MFM mode
                      	
  EE72  CDA9EE        		CALL	DELAY0		;Head select time
  EE75  3E81          		LD	A,081H
  EE77                	READY:
  EE77  3281EE        		LD	(WAITA+1),A
  EE7A  E5            		PUSH	HL
  EE7B  0EF8          		LD	C,0F8H
  EE7D  61            		LD	H,C
  EE7E                	READY2:
  EE7E  ED78          		IN	A,(C)
  EE80  E681          	WAITA:	AND	081H		;NOT READY,BUSY
  EE82  2808          		JR	Z,READYE
  EE84  E3            		EX	(SP),HL		;wait 19clock
  EE85  E3            		EX	(SP),HL		; //
  EE86  2B            		DEC	HL
  EE87  7C            		LD	A,H
  EE88  B5            		OR	L
  EE89  20F3          		JR	NZ,READY2
  EE8B  37            		SCF
  EE8C                	READYE:
  EE8C  E1            		POP	HL
  EE8D  C9            		RET
                      	
  EE8E                	FDCRES:
  EE8E  3600          		LD	(HL),0
  EE90  0E08          		LD	C,8
  EE92  18BE          		JR	FDCCMD2
                      	
  EE94                	FDMOFF:
  EE94  F5            		PUSH	AF
  EE95  C5            		PUSH	BC
  EE96  01FC0F        		LD	BC,00FFCH	;Motor off
  EE99  3E00          	MOPAT:	LD	A,000H		;(Self-rewriting)
  EE9B  ED79          		OUT	(C),A
  EE9D  C1            		POP	BC
  EE9E  F1            		POP	AF
  EE9F  C9            		RET
                      	
  EEA0                	SECSET:
  EEA0  01FA0F        		LD	BC,00FFAH
  EEA3  ED59          		OUT	(C),E
  EEA5                	COMSET:
  EEA5  0EF8          		LD	C,0F8H
  EEA7  ED79          		OUT	(C),A
  EEA9                	DELAY0:
  EEA9  3E1A          		LD	A,26
  EEAB                	DELAY:
  EEAB  3D            		DEC	A
  EEAC  20FD          		JR	NZ,DELAY
  EEAE  C9            		RET
                      	
  EEAF                	DRIVE:
  EEAF  2A84F0        		LD	HL,(_DRIVE)
  EEB2  26F0          		LD	H,_CYL0/256
  EEB4  CBFD          		SET	7,L
  EEB6  7E            		LD	A,(HL)
  EEB7  C9            		RET
                      	
  EEB8                	RNF:
  EEB8  CDAFEE        		CALL	DRIVE
  EEBB  36FF          		LD	(HL),0FFH
  EEBD  C9            		RET
                      	
  EEBE  02            	RETRY:	DB	2
                      	
                      	
                      	;	FLOPPY DISK DRIVER(DMA)
                      	
                      	
  EEBF                	WTTRK:
  EEBF  0601          		LD	B,1
  EEC1  3EF4          		LD	A,0F4H
  EEC3  1802          		JR	WTTRK1
  EEC5                	FDWT:
  EEC5  3EA0          		LD	A,0A0H
  EEC7                	WTTRK1:
  EEC7  325CEE        		LD	(FDCPAT+1),A
  EECA  3E10          		LD	A,16
  EECC  180C          		JR	DISK
                      	
  EECE                	DISKOK:
  EECE  0601          	FDCNT:	LD	B,1
  EED0  100B          		DJNZ	DISK1
  EED2  C9            		RET
                      	
  EED3                	FDRD:
  EED3  3E80          		LD	A,080H
  EED5  325CEE        		LD	(FDCPAT+1),A
  EED8  3E0E          		LD	A,14
                      	
  EEDA                	DISK:
  EEDA  32F1EE        		LD	(DMAPAT+1),A
  EEDD                	DISK1:
  EEDD  78            		LD	A,B
  EEDE  32CFEE        		LD	(FDCNT+1),A
  EEE1  2249EF        		LD	(DMAD+11),HL
  EEE4                	DISKR:
  EEE4  3E02          		LD	A,2		;Retry count
  EEE6  32BEEE        		LD	(RETRY),A
  EEE9                	DISK2:
  EEE9  D5            		PUSH	DE
  EEEA  CDFBED        		CALL	SEEK
  EEED  3843          		JR	C,ERRF
  EEEF  F3            		DI
                      	
  EEF0  3E0E          	DMAPAT:	LD	A,14		;自己書き換え
  EEF2  213EEF        		LD	HL,DMAD
  EEF5  CD93DF        		CALL	SETDMA
  EEF8  ED49          		OUT	(C),C		;OUT 01F87H,087H WR6 イネーブル
  EEFA  3A5CEE        		LD	A,(FDCPAT+1)
  EEFD  C5            		PUSH	BC
  EEFE  CDA0EE        		CALL	SECSET
  EF01  2A49EF        		LD	HL,(DMAHL)
  EF04  23            		INC	HL
  EF05  1106BB        		LD	DE,0BB06H	;READ DMA
                      	
  EF08  3E03          		LD	A,3
  EF0A  CD77EE        		CALL	READY
  EF0D  ED78          		IN	A,(C)
                      	
  EF0F  C1            		POP	BC
  EF10  ED51          		OUT	(C),D		;読み出しマスク設定
  EF12  ED59          		OUT	(C),E		;バイトカウンタ(LH)
  EF14  ED58          		IN	E,(C)
  EF16  ED50          		IN	D,(C)
  EF18  19            		ADD	HL,DE
  EF19  D1            		POP	DE
  EF1A  13            		INC	DE
  EF1B  FB            		EI
  EF1C  CD94EE        		CALL	FDMOFF
  EF1F  B7            		OR	A
  EF20  28AC          		JR	Z,DISKOK
  EF22  1B            		DEC	DE
  EF23  CB67          		BIT	4,A
  EF25  C4B8EE        		CALL	NZ,RNF
  EF28                	DISKE2:
  EF28  21BEEE        		LD	HL,RETRY
  EF2B  35            		DEC	(HL)
  EF2C  20BB          		JR	NZ,DISK2
  EF2E  B7            		OR	A
  EF2F  280A          		JR	Z,ERR
  EF31  D5            		PUSH	DE
  EF32                	ERRF:
  EF32  D1            		POP	DE
  EF33                	DELP:
  EF33  CDB8EE        		CALL	RNF
  EF36  CD94EE        		CALL	FDMOFF
  EF39  3EFF          		LD	A,0FFH
  EF3B                	ERR:
  EF3B  BF            		CP	A
  EF3C  37            		SCF
  EF3D  C9            		RET
                      	
                      				;X1turbo DISK DMA
  EF3E  C3            	DMAD:	DB	0C3H	;WR6 リセット
  EF3F  7D            		DB	07DH	;WR0 ポートA→ポートB 転送
  EF40  FB0F          		DW	00FFBH	;ポートA開始アドレス FDC データレジスタ
  EF42  FFFF          		DW	0FFFFH	;ブロック長(転送サイズ-1)
  EF44  2C            		DB	02CH	;WR1 ポートAアドレス固定 I/O
  EF45  10            		DB	010H	;WR2 ポートBインクリメント
  EF46  80            		DB	080H	;WR3
  EF47  92            		DB	092H	;WR5 WAIT RDY:LOW
  EF48  8D            		DB	08DH	;WR4 バイト ポートB開始アドレス(LH)
  EF49  0000          	DMAHL:	DW	0	;ポートB開始アドレス
  EF4B  CF            		DB	0CFH	;WR6 ロード
  EF4C  01            		DB	001H	;WR0 ポートB←ポートB 転送
  EF4D  CF            		DB	0CFH	;WR6 ロード
                      	
  EF4E                	DMAE:
                      	
  1E1E                	AT_R	EQU	WTTRK-AT_DWT
  EF4E                	AT_TABLE:
                      	
                      	;LDCCPWK.ASM
                      	
                      	;	LSX-Dodgers CCP WORK
                      	
  0040                	PATHX	EQU	64
  EF4E                	PATHD:	DS	PATHX
  EF8E  00            	PATHE:	DB	0
                      	
  EF8F                	DTA_CCP:
  EF8F                		DS	37
                      	
  EFB4                	FCB_BAT:
  EFB4                		DS	37
                      	
                      	
  EFD9  20627974657320	FREE:	DB	" bytes free",9,'$'
                      	
                      	;LDWORK.ASM
                      	
                      	;	LSX-Dodgers WORK0
                      	;
                      	;	CP/M互換BIOS
                      	;	BOOT:アドレス下位1バイトが0になるように
  EFE6                	AT_WORK:
  EFE6                		DS	WORKAD-AT_WORK
                      	
  F000                	CPM_BOOT:
  F000  C30000        		JP	0
  F003                	_SYS00:		;(BDOS)プログラム終了
  F003                	CPM_WBOOT:
  F003  C309D2        		JP	WBOOT1
  F006                	CPM_CONST:
  F006  C341DC        		JP	CONSTX
  F009                	_SYS07:		;(BDOS)コンソール直接入力
  F009                	CPM_CONIN:
  F009  C3E8DB        		JP	FLGET
  F00C                	CPM_CONOUT:
  F00C  C386DE        		JP	CONOUT1
                      	
  F00F                	DECBF:
  F00F                		DS	5
  F014  00            	FDRV:	DB	0
  F015                	FNAME:	DS	36
  F039                	SFILE:	DS	33		;DRV FILENAME
  F05A                	RR_BUF_HL:
  F05A                		DS	2		;Random record buffer
  F05C                	RR_BUF_A:			;CP/M互換ファイルアクセスの際のランダムレコードを一時的な保管場所
  F05C                		DS	1		;計3バイト
  F05D  0000          	LEFTX:	DW	0
  F05F  0000          	DTAX:	DW	0
                      	
  F061                	ZERO:
  F061                	BEEPD:
  F061  008E01000B000C		DB	0,08EH,1,0,00BH,0,00CH,010H
  F069  073E08100D00FF		DB	007H,03EH,008H,010H,00DH,0,0FFH
  F062                	RTC_YY	EQU	BEEPD+1
  F063                	RTC_MW	EQU	BEEPD+2
  F064                	RTC_DD	EQU	BEEPD+3
  F065                	RTC_TT	EQU	BEEPD+4
  F066                	RTC_MM	EQU	BEEPD+5
  F067                	RTC_SS	EQU	BEEPD+6
                      	
  F070  00            	CHECK:	DB	0
                      	
  F071  4F4B24        	OK:	DB	"OK$"
  F074                		DS	5
  F079  4572726F722124	COMERM:	DB	"Error!$"
                      	;	システムワークエリア
                      	;	_CYL0:アドレス下位1バイトが080Hになるように
  F080  FF            	_CYL0:	DB	0FFH	;Cylinder
  F081  FF            	_CYL1:	DB	0FFH	;Cylinder
  F082  FF            	_CYL2:	DB	0FFH	;Cylinder
  F083  FF            	_CYL3:	DB	0FFH	;Cylinder
  F084  00            	_DRIVE:	DB	0	;unit number
  F085  00            	_SEEKSP:DB	0	;Seek speed
  F086  FF            	_ISEEK:	DB	0FFH	;
  F087  00            	_DVSW:	DB	0
  F088  00            	_DRV:	DB	0
  F089  FF            	_DSK:	DB	0FFH
  F08A  8000          	_DTA:	DW	00080H
  F08C  0000          	_CTC:	DW	0
  F08E  0000          	_TXADR:	DW	0
  F090  0000          	_KEYPS:	DW	0
  F092  00FF          	_KEYD:	DW	0FF00H	;キーデータ
  F094  C210          	_KEYSP:	DB	KEYSP_L,KEYSP_H	;オートリピートの速度
  F096  07            	_COLORF:DB	COLORF	;色
  F097  18            	_LINE:	DB	LINE
                      	
  F098  0000          	_FCB:	DW	0	;SEARCH FILES
  F09A  0000          	_FBPS:	DW	0	;    //
  F09C  0000          	_FBAD:	DW	0	;    //
  F09E  00            	_FBCNT:	DB	0	;    //
  F09F  00            	_FILEN:	DB	0	;    //
  F0A0  00            	_DIRF:	DB	0	;bit7:ディレクトリ bit0-6:セクタインデックス
  F0A1                		DS	1
  F0A2  00            	_WTFATF:DB	0	;FATバッファの更新フラグ
  F0A3                		DS	1
  F0A4  00            	_WTDBF:	DB	0	;データバッファの更新フラグ
  F0A5  FF            	_DBDRV:	DB	0FFH	;データバッファにあるデータを読み込んだドライブ
  F0A6  0000          	_DBSEC:	DW	0	;データバッファにあるデータを読み込んだセクタ番号
  F0A8  0000          	_DPB:	DW	0
  F0AA                	_FATDRV:
  F0AA  FF            		DB	0FFH	;FATバッファに読み込んでいるドライブ
  F0AB  00            	_FATIX:	DB	0	;FATバッファに読み込んでいるインデックス
  F0AC                	_FAKEFREE:
  F0AC  0000          		DW	0	;偽の残量（FATサイズが大きくなると重くなるのでその対策）
                      	
  F0AE                		DS	2
                      	
  F0B0                	CRTCD:
  F0B0  6F            		DB	06FH
  F0B1                	_WIDTH:
  F0B1  50            		DB	WIDTH
  F0B2                	TVRAMTOP:
  F0B2  5938          		DB	059H,038H
  F0B4  1F02          		DB	01FH,002H
  F0B6                	_LINE2:
  F0B6  19            		DB	019H
  F0B7                	WKE4:
  F0B7  1C            		DB	01CH
  F0B8                	WKE6:
  F0B8  00            		DB	000H
  F0B9                	WK40:
  F0B9  07            		DB	007H
  F0BA                	_PAGE_MINUS:
  F0BA  80F8          		DW	0-WIDTH*LINE
  F0BC                	_WIDTH_MINUS:
  F0BC  B0FF          		DW	0-WIDTH
  F0BE                	WK30:
  F0BE  0C            		DB	00CH
  F0BF                	WK31:
  F0BF                	WK1FD0:
  F0BF  20            		DB	020H
                      	
  F0C0  2FDB          	CTC0:	DW	INTCTCE
  F0C2  2FDB          	CTC1:	DW	INTCTCE
  F0C4  32DB          	CTC2:	DW	INTCTC2
  F0C6  2FDB          	CTC3:	DW	INTCTCE
  F0C8  1BDB          	INTVEC:	DW	INT
                      	
                      	;	LSX-Dodgers 独自BIOS
                      	
  F0CA  C369E0        	_INKEY:	JP	INKEY
  F0CD  C321DD        	_PRINT:	JP	PRINT
  F0D0  C3D1DF        	_SCRN:	JP	SCRN
  F0D3  C3FBDF        	_POS:	JP	POS
  F0D6  C34FDE        	_LOC:	JP	LOC
  F0D9                	_CHGDRV:
  F0D9  C3F7EC        		JP	CHGDRV
  F0DC                	_GETDPB:
  F0DC  C3C2ED        		JP	GETDPB
  F0DF                	_FFLUSH:
  F0DF  C3E0ED        		JP	FFLUSH
  F0E2                	_RDFATX:
  F0E2  C3D0E9        		JP	RDFATX
  F0E5  C3F8EA        	_RDFAT:	JP	RDFAT
  F0E8  C3BFEE        	_WTTRK:	JP	WTTRK
  F0EB  C3D3EE        	_FDRD:	JP	FDRD
  F0EE  C3C5EE        	_FDWT:	JP	FDWT
  F0F1                	_BPB2DPB:
  F0F1  C385EB        		JP	BPB2DPB
  F0F4                	_BREAK:
  F0F4  C3C2D3        		JP	END_BATCH
  F0F7                	_GNCL:
  F0F7  C372EA        	GNCPAT:	JP	GNCL		; self-modifying code
  F0FA                	_SNCL:
  F0FA  C395EA        	SNCPAT:	JP	SNCL		; self-modifying code
  F0FD  C37CD2        	_COMANL:JP	COMANL
                      	
  F100                	_WE:
                      	
                      	;LDCALL.ASM
                      	
                      	;	LSX-Dodgers システムコール(BDOS)
                      	;
                      	;	LSX-Dodgers SYSTEM CALL
                      	;	STABLE:アドレス下位1バイトが0になるように
                      	
  F100                	STABLE:
                      	;0
  F100  03F0BBDBC7DB1F		DW	_SYS00,_SYS01,_SYS02,_SYS03
  F108  5FD85FD8CCDB09		DW	_SYS04,_SYS05,_SYS06,_SYS07
  F110  D4DB61D80DDC39		DW	_SYS08,_SYS09,_SYS0A,_SYS0B
  F118  76D87BD88AD89B		DW	_SYS0C,_SYS0D,_SYS0E,_SYS0F
                      	;1
  F120  EFD836D97FD9B5		DW	_SYS10,_SYS11,_SYS12,_SYS13
  F128  BDD9D3D9E8D9E0		DW	_SYS14,_SYS15,_SYS16,_SYS17
  F130  2FDA34DA39DA3F		DW	_SYS18,_SYS19,_SYS1A,_SYS1B
  F138  5FD865DA5FD869		DW	_SYS1C,_SYS1D,_SYS1E,_SYS1F
                      	;2
  F140  5FD81FDA27DA70		DW	_SYS20,_SYS21,_SYS22,_SYS23
  F148  96DA5FD8A4E67C		DW	_SYS24,_ERROR,_SYS26,_SYS27
  F150  27DA9FDA4FDC1F		DW	_SYS28,_SYS29,_SYS2A,_SYS2B
  F158  72DC1FE25FD8C2		DW	_SYS2C,_SYS2D,_SYS2E,_SYS2F
                      	;3
  F160  BCDA5FD85FD85F		DW	_SYS30,_ERROR,_ERROR,_ERROR
  F168  5FD85FD85FD85F		DW	_ERROR,_ERROR,_ERROR,_ERROR
  F170  5FD81FE21FE2E3		DW	_ERROR,_SYS39,_SYS3A,_SYS5A
                      	;DOS2
  F178  42D8          		DW	_DOS2
                      	
  F17A                		DS	2
  F17C  00F3          	_FATBF:	DW	FATBF
  F17E  00FB          	_DTBUF:	DW	DTBUF
                      	
                      	;	コントロールコードテーブル
                      	;	CTRLTB:アドレス下位1バイトが080Hになるように
                      	
  F180                	CTRLTB:
  F180  C4DDC4DD00DE45		DW	CTRL00,CTRL00,CTRL02,CTRL03	;  A,B,C
  F188  3FDF24DE1EDFA7		DW	CTRL04,CTRL05,CTRL06,CTRL07	;D,E,F,G
  F190  D0DDF1DD48DF65		DW	CTRL08,CTRL09,CTRL0A,CTRL0B	;H,I,J,K
  F198  1BDF4ADE5DDFC4		DW	CTRL0C,CTRL0D,CTRL0E,CTRL00	;L,M,N,O
  F1A0  C4DDC4DD5DDEC4		DW	CTRL00,CTRL00,CTRL12,CTRL00	;P,Q,R,S
  F1A8  C4DDC4DDC4DDC4		DW	CTRL00,CTRL00,CTRL00,CTRL00	;T,U,V,W
  F1B0  C4DDC4DD1BDF6C		DW	CTRL00,CTRL00,CTRL0C,CTRL1B	;X,Y,Z,ESC
  F1B8  EBDDD7DDE0DD48		DW	CTRL1C,CTRL1D,CTRL1E,CTRL1F	;→,←,↑,↓
                      	
  F1C0  0200          	M2D:	DW	2
  F1C2  FD02          		DB	0FDH,2
  F1C4  6401          		DW	356
  F1C6  FF0728090182  		DB	0FFH,7,40,9,1,082H
  F1CC  0500A7000800  		DW	5,0A7H,8
                      	
  F1D2  0200          	M2HD:	DW	2
  F1D4  FE01          		DB	0FEH,1
  F1D6  C704          		DW	1223
  F1D8  FE064D080184  		DB	0FEH,6,77,8,1,084H
  F1DE  0500A7000900  		DW	5,0A7H,9
                      	
  F1E4                		DS	6
                      	
  F1EA  1617          	SDDATA:	DB	22,23		;(FCB)ファイルを最後に変更した時刻
  F1EC  1415          		DB	20,21		;(FCB)ファイルを最後に変更した日付
  F1EE  1A1B          		DB	26,27		;(FCB)ファイルの先頭クラスタ
  F1F0  10111213      		DB	16,17,18,19	;(FCB)ファイルのサイズ(バイト単位)
  F1F4                	SDDATAE:
                      	
  F1F4                	SCDIR:	DS	2		;+14 +15
  F1F6                	SFBPS:	DS	2		;FBPS
  F1F8                	SFNDF:	DS	2		;FILEN DIRF
                      	
  F1FA  0000          	_FATPS:	DW	0
  F1FC  0000          	_DIRPS:	DW	0
  F1FE  0000          	_CLPS:	DW	0
                      	
  F200                	_PE:
                      	
                      	;X1DPB.ASM
                      	
                      	;	LSX-Dodgers DPB
                      	;	X1/turbo/Z
                      	
  F200                	DEVICE:
                      	
                      	;	A:
                      	
  F200  0200          		DW	2	;DPB_00_FATLN
  F202  EBF0          		DW	_FDRD	;DPB_02_DRD
  F204  EEF0          		DW	_FDWT	;DPB_04_DWT
  F206  FD            		DB	0FDH	;DPB_06_FATID
  F207  02            		DB	2	;DPB_07_SECPCL
  F208  6401          		DW	356	;DPB_08_MAXCL
  F20A  FF            		DB	0FFH	;DPB_0A_FDMODE	0FFH=2D / 0FEH=2HD
  F20B  07            		DB	7	;DPB_0B_DIRSCNT
  F20C  28            		DB	40	;DPB_0C_MAXCYL
  F20D  09            		DB	9	;DPB_0D_MAXSEC	Number of sectors
  F20E  01            		DB	1	;DPB_0E_FATPS
  F20F  82            		DB	082H	;DPB_0F_BPS
  F210  0500          		DW	5	;DPB_10_DIRPS
  F212  A7            		DB	0A7H	;DPB_12_DEVICE	Device Number
  F213  00            		DB	0	;DPB_13_UNITNO
  F214  0800          		DW	8	;DPB_14_ADDCL16
  F216  0000          		DW	0	;DPB_16
  F218  0000          		DW	0	;DPB_18
  F21A  0000          		DW	0	;DPB_1A_SDIR
  F21C  46444430      		DB	"FDD0"	;DPB_1C_NAME
                      	
                      	;	B:
                      	
  F220  0200          		DW	2	;DPB_00_FATLN
  F222  EBF0          		DW	_FDRD	;DPB_02_DRD
  F224  EEF0          		DW	_FDWT	;DPB_04_DWT
  F226  FD            		DB	0FDH	;DPB_06_FATID
  F227  02            		DB	2	;DPB_07_SECPCL
  F228  6401          		DW	356	;DPB_08_MAXCL
  F22A  FF            		DB	0FFH	;DPB_0A_FDMODE	0FFH=2D / 0FEH=2HD
  F22B  07            		DB	7	;DPB_0B_DIRSCNT
  F22C  28            		DB	40	;DPB_0C_MAXCYL
  F22D  09            		DB	9	;DPB_0D_MAXSEC	Number of sectors
  F22E  01            		DB	1	;DPB_0E_FATPS
  F22F  82            		DB	082H	;DPB_0F_BPS
  F230  0500          		DW	5	;DPB_10_DIRPS
  F232  A7            		DB	0A7H	;DPB_12_DEVICE	Device Number
  F233  01            		DB	1	;DPB_13_UNITNO
  F234  0800          		DW	8	;DPB_14_ADDCL16
  F236  0000          		DW	0	;DPB_16
  F238  0000          		DW	0	;DPB_18
  F23A  0000          		DW	0	;DPB_1A_SDIR
  F23C  46444431      		DB	"FDD1"	;DPB_1C_NAME
                      	
                      	;	C:
                      	
  F240  0200          		DW	2	;DPB_00_FATLN
  F242  EBF0          		DW	_FDRD	;DPB_02_DRD
  F244  EEF0          		DW	_FDWT	;DPB_04_DWT
  F246  FD            		DB	0FDH	;DPB_06_FATID
  F247  02            		DB	2	;DPB_07_SECPCL
  F248  6401          		DW	356	;DPB_08_MAXCL
  F24A  FF            		DB	0FFH	;DPB_0A_FDMODE	0FFH=2D / 0FEH=2HD
  F24B  07            		DB	7	;DPB_0B_DIRSCNT
  F24C  28            		DB	40	;DPB_0C_MAXCYL
  F24D  09            		DB	9	;DPB_0D_MAXSEC	Number of sectors
  F24E  01            		DB	1	;DPB_0E_FATPS
  F24F  82            		DB	082H	;DPB_0F_BPS
  F250  0500          		DW	5	;DPB_10_DIRPS
  F252  A7            		DB	0A7H	;DPB_12_DEVICE	Device Number
  F253  02            		DB	2	;DPB_13_UNITNO
  F254  0800          		DW	8	;DPB_14_ADDCL16
  F256  0000          		DW	0	;DPB_16
  F258  0000          		DW	0	;DPB_18
  F25A  0000          		DW	0	;DPB_1A_SDIR
  F25C  46444432      		DB	"FDD2"	;DPB_1C_NAME
                      	
                      	;	D:
                      	
  F260  0200          		DW	2	;DPB_00_FATLN
  F262  EBF0          		DW	_FDRD	;DPB_02_DRD
  F264  EEF0          		DW	_FDWT	;DPB_04_DWT
  F266  FD            		DB	0FDH	;DPB_06_FATID
  F267  02            		DB	2	;DPB_07_SECPCL
  F268  6401          		DW	356	;DPB_08_MAXCL
  F26A  FF            		DB	0FFH	;DPB_0A_FDMODE	0FFH=2D / 0FEH=2HD
  F26B  07            		DB	7	;DPB_0B_DIRSCNT
  F26C  28            		DB	40	;DPB_0C_MAXCYL
  F26D  09            		DB	9	;DPB_0D_MAXSEC	Number of sectors
  F26E  01            		DB	1	;DPB_0E_FATPS
  F26F  82            		DB	082H	;DPB_0F_BPS
  F270  0500          		DW	5	;DPB_10_DIRPS
  F272  A7            		DB	0A7H	;DPB_12_DEVICE
  F273  03            		DB	3	;DPB_13_UNITNO
  F274  0800          		DW	8	;DPB_14_ADDCL16
  F276  0000          		DW	0	;DPB_16
  F278  0000          		DW	0	;DPB_18
  F27A  0000          		DW	0	;DPB_1A_SDIR
  F27C  46444433      		DB	"FDD3"	;DPB_1C_NAME
                      	
                      	;	E:
                      	
  F280  0000          	EMMFL:	DW	0	;DPB_00_FATLN
  F282  E8D7          	EMMRD:	DW	EDRD	;DPB_02_DRD
  F284  E4D7          	EMMWR:	DW	EDWT	;DPB_04_DWT
  F286  FE            		DB	0FEH	;DPB_06_FATID
  F287  02            		DB	2	;DPB_07_SECPCL
  F288  0000          	EMMCL:	DW	0	;DPB_08_MAXCL
  F28A  00            		DB	0	;DPB_0A_FDMODE
  F28B  0C            		DB	12	;DPB_0B_DIRSCNT
  F28C  00            		DB	0	;DPB_0C_MAXCYL
  F28D  00            		DB	0	;DPB_0D_MAXSEC
  F28E  02            		DB	2	;DPB_0E_FATPS
  F28F  02            		DB	2	;DPB_0F_BPS
  F290  0A00          		DW	10	;DPB_10_DIRPS
  F292  06            	EMMDV:	DB	6	;DPB_12_DEVICE
  F293  00            		DB	0	;DPB_13_UNITNO
  F294  1200          		DW	18	;DPB_14_ADDCL16
  F296  0000          		DW	0	;DPB_16
  F298  0000          		DW	0	;DPB_18
  F29A  0000          		DW	0	;DPB_1A_SDIR
  F29C  454D4D30      		DB	"EMM0"	;DPB_1C_NAME
                      	
                      	;	F:
                      	
  F2A0  0000          	BANKFL:	DW	0	;DPB_00_FATLN
  F2A2  7CD7          		DW	BDRD	;DPB_02_DRD
  F2A4  78D7          		DW	BDWT	;DPB_04_DWT
  F2A6  F9            		DB	0F9H	;DPB_06_FATID
  F2A7  02            		DB	2	;DPB_07_SECPCL
  F2A8  0000          	BANKCL:	DW	0	;DPB_08_MAXCL
  F2AA  00            		DB	0	;DPB_0A_FDMODE
  F2AB  08            		DB	8	;DPB_0B_DIRSCNT
  F2AC  00            		DB	0	;DPB_0C_MAXCYL
  F2AD  01            		DB	1	;DPB_0D_MAXSEC
  F2AE  00            		DB	0	;DPB_0E_FATPS
  F2AF  02            		DB	2	;DPB_0F_BPS
  F2B0  0200          		DW	2	;DPB_10_DIRPS
  F2B2  0B            	BANKDV:	DB	00BH	;DPB_12_DEVICE
  F2B3  00            		DB	0	;DPB_13_UNITNO
  F2B4  0600          		DW	6	;DPB_14_ADDCL16
  F2B6  0000          		DW	0	;DPB_16
  F2B8  0000          		DW	0	;DPB_18
  F2BA  0000          		DW	0	;DPB_1A_SDIR
  F2BC  4252414D      		DB	"BRAM"	;DPB_1C_NAME
                      	
                      	;	G:
                      	
  F2C0  0200          		DW	2	;DPB_00_FATLN
  F2C2  39D7          		DW	GDRD	;DPB_02_DRD
  F2C4  50D7          		DW	GDWT	;DPB_04_DWT
  F2C6  FA            		DB	0FAH	;DPB_06_FATID
  F2C7  01            		DB	1	;DPB_07_SECPCL
  F2C8  B800          		DW	184	;DPB_08_MAXCL
  F2CA  00            		DB	0	;DPB_0A_FDMODE
  F2CB  07            		DB	7	;DPB_0B_DIRSCNT
  F2CC  00            		DB	0	;DPB_0C_MAXCYL
  F2CD  01            		DB	1	;DPB_0D_MAXSEC
  F2CE  01            		DB	1	;DPB_0E_FATPS
  F2CF  01            		DB	1	;DPB_0F_BPS
  F2D0  0300          		DW	3	;DPB_10_DIRPS
  F2D2  05            		DB	5	;DPB_12_DEVICE
  F2D3  01            		DB	1	;DPB_13_UNITNO
  F2D4  0800          		DW	8	;DPB_14_ADDCL16
  F2D6  0000          		DW	0	;DPB_16
  F2D8  0000          		DW	0	;DPB_18
  F2DA  0000          		DW	0	;DPB_1A_SDIR
  F2DC  4752414D      		DB	"GRAM"	;DPB_1C_NAME
                      	
                      	;	H:
  F2E0                		DS	32-8
  F2F8  00            		DB	0
                      	
                      	
  F2F9                	LAST_ADR:
                      	
  F2F9                		END
