			  Z80 ASSEMBLER - ZASM VER 1.6
                      	;	LSX-Dodgers for X1/turbo/Z
                      	;	Programmed by
                      	;	Gaku (Lovers/Tablacus)
                      	;X1DEF.ASM
                      	
                      	;	LSX-Dodgers DEF
                      	;	X1/turbo/Z
                      	
  0000                	MAC	EQU	0		;X1
  0000                	DEV EQU 0
                      	
  CB00                	RUN	EQU	0CB00H
  D106                	BDOS	EQU	0D106H
  EF00                	WORKAD	EQU	0EF00H
  F200                	FATBF	EQU	0F200H
  FA00                	DTBUF	EQU	0FA00H
  FE00                	KEYBF	EQU	0FE00H
  FF00                	KBUF	EQU	0FF00H
  FFCA                	EXTSP	EQU	0FFCAH
  FFD9                	TRAP38	EQU	0FFD9H
  0050                	WIDTH	EQU	80
  0018                	LINE	EQU	24
  0007                	COLORF	EQU	7
  0010                	KEYSP_H	EQU	16
  00C2                	KEYSP_L	EQU	0C2H
  0009                	COMS	EQU	9
                      	
                      	
                      	;LDDEF.ASM
                      	
                      	;	LSX-Dodgers DEF
                      	
  0001                	VER_1   EQU	1
  0005                	VER_2   EQU	5
  0001                	VER_3   EQU	1
  1D00                	MACW	EQU	MAC + 01D00H	;機種フラグとLD判別フラグ
  0000                	MACD	EQU	MAC + DEV * 256	;機種フラグとデバイスフラグ
  0151                	VER	EQU	VER_1 * 256 + VER_2 * 16 + VER_3
                      	
  0005                	SYSTEM	EQU	00005H
  000F                	JP_HL	EQU	0000FH
  005C                	FCB1	EQU	0005CH
  006C                	FCB2	EQU	0006CH
  005D                	FCB1FN	EQU	FCB1+1
  006D                	FCB2FN	EQU	FCB2+1
  0080                	DTA1	EQU	00080H
                      	
  FFCA                	EXTBIO	EQU	0FFCAH
                      	
                      	
                      	
  CAF9                		ORG	RUN-7
                      	
                      	;	MSX BINARY HEADER
  CAF9  FE            		DB	0FEH
                      	;	MSX BINARY START ADDRESS
  CAFA  00CB          		DW	RUN
                      	;	MSX BINARY END ADDRESS
  CAFC  F9F1          		DW	LAST_ADR
                      	;	MSX BINARY EXEC ADDRESS
  CAFE  07CB          		DW	START
                      	;X1INIT.ASM
                      	
                      	;	LSX-Dodgers INIT
                      	;	X1/turbo/Z
                      	
  CB00  C307CB        		JP	START
  CB03  001D          		DW	MACW
  CB05  5101          		DW	VER
                      	
  CB07                	START:
  CB07  F3            		DI
  CB08  ED5E          		IM	2
  CB0A  31CAFF        		LD	SP,EXTSP
  CB0D  CD1BCB        		CALL	INIT		;NZならAUTOEXECを実行
  CB10  210000        		LD	HL,0
  CB13  E5            		PUSH	HL
  CB14  C8            		RET	Z
  CB15  11B5CE        		LD	DE,AUTOD
  CB18  C3FDEF        		JP	_COMANL
                      	
  CB1B                	INIT:
  CB1B  3E1E          		LD	A,01EH
  CB1D  D300          		OUT	(0),A
                      	
  CB1F  010000        		LD	BC,0
  CB22  ED438CEF      		LD	(_CTC),BC
  CB26  01040A        		LD	BC,00A04H
  CB29  CD5FCE        		CALL	CHKCTC
  CB2C  010407        		LD	BC,00704H
  CB2F  CD5FCE        		CALL	CHKCTC
  CB32  01A81F        		LD	BC,01FA8H
  CB35  CD5FCE        		CALL	CHKCTC
  CB38  01A01F        		LD	BC,01FA0H
  CB3B  CD5FCE        		CALL	CHKCTC
                      	;
  CB3E                	INISIO:
  CB3E  01911F        		LD	BC,01F91H	;INIT SIO
  CB41  1601          		LD	D,1
  CB43  ED51          		OUT	(C),D
                      	
  CB45  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  CB47  0E93          		LD	C,093H
  CB49  ED51          		OUT	(C),D
  CB4B  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  CB4D  0E99          		LD	C,099H		;INIT SIO
  CB4F  1601          		LD	D,1
  CB51  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  CB53  0E9B          		LD	C,09BH
  CB55  ED51          		OUT	(C),D
  CB57  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
                      	
  CB59  0E80          		LD	C,080H		;INIT DMA
  CB5B  2106C3        		LD	HL,0C306H
  CB5E                	INIDMA:
  CB5E  ED61          		OUT	(C),H
  CB60  2D            		DEC	L
  CB61  20FB          		JR	NZ,INIDMA
                      	
  CB63  3EE4          		LD	A,0E4H
  CB65  CD61DE        		CALL	COMOUT
  CB68  AF            		XOR	A
  CB69  CD3BDE        		CALL	OT49SB
                      	
  CB6C  3EEF          		LD	A,INTVEC/256
  CB6E  ED47          		LD	I,A
                      	
  CB70  ED4B8CEF      		LD	BC,(_CTC)
  CB74  0D            		DEC	C
  CB75  0D            		DEC	C
                      	
  CB76  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  CB78  3EC0          		LD	A,CTC0
  CB7A  ED79          		OUT	(C),A
                      	
  CB7C  0C            		INC	C
  CB7D  3E47          		LD	A,047H
  CB7F  ED79          		OUT	(C),A
  CB81  3E0D          		LD	A,13		;Baudrate 9600-13
  CB83  ED79          		OUT	(C),A
                      	
  CB85  79            		LD	A,C
  CB86  D610          		SUB	010H
  CB88  4F            		LD	C,A
                      	;	LD	(SIOAD+1),BC
                      	;	LD	(SIOAD0+1),BC
                      	;	LD	(SIOAD1+1),BC
                      	
  CB89  2105CF        		LD	HL,SIODATA
  CB8C                	SINIT1:
  CB8C  7E            		LD	A,(HL)
  CB8D  23            		INC	HL
  CB8E  FEFF          		CP	0FFH
  CB90  2804          		JR	Z,SINIT2
  CB92  ED79          		OUT	(C),A
  CB94  18F6          		JR	SINIT1
  CB96                	SINIT2:
  CB96  3EE4          		LD	A,0E4H
  CB98  CD61DE        		CALL	COMOUT
  CB9B  3EC8          		LD	A,INTVEC
  CB9D  CD3BDE        		CALL	OT49SB
                      	;
  CBA0  01C41F        		LD	BC,01FC4H
  CBA3  3E0C          		LD	A,00CH
  CBA5  ED79          		OUT	(C),A
                      	
  CBA7  0EC0          		LD	C,0C0H
  CBA9  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
                      	
  CBAB  0C            		INC	C
  CBAC  3E28          		LD	A,40
  CBAE  ED79          		OUT	(C),A
                      	
  CBB0  0C            		INC	C
  CBB1  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
                      	
  CBB3  0C            		INC	C
  CBB4  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
                      	
  CBB6  0EC5          		LD	C,0C5H
  CBB8  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
                      	
  CBBA                	TEXT:
  CBBA  0EB0          		LD	C,0B0H
  CBBC  3E80          		LD	A,080H
  CBBE  ED79          		OUT	(C),A
  CBC0  1607          		LD	D,7
  CBC2  0EB9          		LD	C,0B9H
  CBC4  21FECE        		LD	HL,TEXTDT
  CBC7                	TEXT1:
  CBC7  04            		INC	B
  CBC8  EDA3          		OUTI
  CBCA  0C            		INC	C
  CBCB  15            		DEC	D
  CBCC  20F9          		JR	NZ,TEXT1
  CBCE  01B01F        		LD	BC,01FB0H
  CBD1  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
                      	
  CBD3  0EC4          		LD	C,0C4H
  CBD5  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
                      	
  CBD7  01011A        		LD	BC,01A01H
  CBDA  ED78          		IN	A,(C)
  CBDC  E608          		AND	8
  CBDE  2809          		JR	Z,PRN
  CBE0  0E03          		LD	C,003H
  CBE2  3E0F          		LD	A,00FH
  CBE4  ED79          		OUT	(C),A
  CBE6  01040A        		LD	BC,00A04H
  CBE9                	PRN:
  CBE9  210000        		LD	HL,0
  CBEC  065C          		LD	B,05CH
  CBEE  3EFF          		LD	A,0FFH		;RST 38H
  CBF0  CDB9E0        		CALL	FILL_MEMORY
  CBF3  06A4          		LD	B,0A4H
  CBF5  AF            		XOR	A
  CBF6  CDB9E0        		CALL	FILL_MEMORY
                      	
  CBF9  3EC3          		LD	A,0C3H		;JP
  CBFB  2103EF        		LD	HL,CPM_WBOOT
  CBFE  320000        		LD	(00000H),A
  CC01  220100        		LD	(00001H),HL	;IPL
                      	
  CC04  21001D        		LD	HL,MACW	;3 bit7  DPB Compatible LA(1)
  CC07  220300        		LD	(00003H),HL	;  bit6-0 Machine X1(0)
                      	;				;4 LSX-Dodgers(01DH)
  CC0A  2106D1        		LD	HL,BDOS
  CC0D  320500        		LD	(00005H),A
  CC10  220600        		LD	(00006H),HL	;BDOS
                      	
  CC13  2181DA        		LD	HL,BIOS
  CC16  221900        		LD	(00019H),HL	;BIOS-ROM
                      	
  CC19  21D9FF        		LD	HL,TRAP38	;TRAP38
  CC1C  323800        		LD	(00038H),A
  CC1F  223900        		LD	(00039H),HL	;RST 038H
                      	
  CC22  3EEF          		LD	A,CPM_BOOT/256
  CC24  320B00        		LD	(0000BH),A
                      	
  CC27  3EE9          		LD	A,0E9H		;JP (HL)
  CC29  320F00        		LD	(0000FH),A
                      	
  CC2C  3A7DF0        		LD	A,(_FATBF+1)
  CC2F  321300        		LD	(00013H),A
                      	
  CC32  3A7FF0        		LD	A,(_DTBUF+1)
  CC35  321700        		LD	(00017H),A
                      	
  CC38  3EFE          		LD	A,KEYBF/256
  CC3A  321B00        		LD	(0001BH),A
                      	
  CC3D  3EFF          		LD	A,KBUF/256
  CC3F  321F00        		LD	(0001FH),A
                      	
  CC42  215101        		LD	HL,VER
  CC45  225A00        		LD	(0005AH),HL
                      	
  CC48  3EE6          		LD	A,0E6H
  CC4A  CD61DE        		CALL	COMOUT
  CC4D  CD46DE        		CALL	IN49SB
  CC50  F5            		PUSH	AF
  CC51  CD46DE        		CALL	IN49SB
  CC54  F1            		POP	AF
  CC55  F5            		PUSH	AF
  CC56  E612          		AND	012H
  CC58  2005          		JR	NZ,KEYR
  CC5A  3E01          		LD	A,1
  CC5C  32B2CD        		LD	(KEYREP+1),A
  CC5F                	KEYR:
  CC5F  F1            		POP	AF
  CC60  E603          		AND	3
  CC62  280E          		JR	Z,NON
                      	
  CC64  01D03F        		LD	BC,03FD0H
  CC67  ED49          		OUT	(C),C
  CC69  3E37          		LD	A,037H
  CC6B  D3D0          		OUT	(0D0H),A
  CC6D  ED78          		IN	A,(C)
  CC6F  B9            		CP	C
  CC70  2865          		JR	Z,TURBO
  CC72                	NON:
  CC72  2138CF        		LD	HL,AT_SCR1
  CC75  11EBDE        		LD	DE,SCR1
  CC78  019400        		LD	BC,SCRNE-SCR1	;転送先のサイズ確認用
  CC7B  018500        		LD	BC,AT_SCRE-AT_SCR1
  CC7E  EDB0          		LDIR
                      	
  CC80  21BDCF        		LD	HL,AT_DWT
  CC83  115BEE        		LD	DE,WTTRK
  CC86  018F00        		LD	BC,DMAE-WTTRK	;転送先のサイズ確認用
  CC89  018E00        		LD	BC,AT_CPUE-AT_DWT
  CC8C  EDB0          		LDIR
                      	
  CC8E  214BD0        		LD	HL,AT_EDWT
  CC91  116CD7        		LD	DE,EDWT
  CC94  014B00        		LD	BC,EMME-EDWT	;転送先のサイズ確認用
  CC97  014600        		LD	BC,AT_EMME-AT_EDWT
  CC9A  EDB0          		LDIR
                      	
  CC9C  2166DF        		LD	HL,AT_WTTRK+AT_RS
  CC9F  22E9EF        		LD	(_WTTRK+1),HL
  CCA2  21A4EE        		LD	HL,AT_DRD+AT_R
  CCA5  22ECEF        		LD	(_FDRD+1),HL
  CCA8  215BEE        		LD	HL,AT_DWT+AT_R
  CCAB  22EFEF        		LD	(_FDWT+1),HL
  CCAE  2180D7        		LD	HL,AT_EDRD+AT_RE
  CCB1  2282F1        		LD	(EMMRD),HL
  CCB4  216CD7        		LD	HL,AT_EDWT+AT_RE
  CCB7  2284F1        		LD	(EMMWR),HL
  CCBA  216DDF        		LD	HL,AT_SCRN+AT_RS
  CCBD  22D1EF        		LD	(_SCRN+1),HL
                      	
  CCC0  3E27          		LD	A,027H			;ノンターボはMFM切り替えを行わない
  CCC2  3212F1        		LD	(DEVICE+012H),A		;Aドライブ
  CCC5  3232F1        		LD	(DEVICE+012H+32),A	;Bドライブ
  CCC8  3252F1        		LD	(DEVICE+012H+32*2),A	;Cドライブ
  CCCB  3272F1        		LD	(DEVICE+012H+32*3),A	;Dドライブ
                      	
  CCCE  210000        		LD	HL,0
  CCD1  228CDE        		LD	(X1PAT),HL
  CCD4  C360CD        		JP	NOBANK
                      	
  CCD7                	TURBO:
  CCD7  F3            		DI			;Check BIOS
  CCD8  061D          		LD	B,01DH
  CCDA  ED79          		OUT	(C),A		;BIOS ON
  CCDC  3A512F        		LD	A,(02F51H)
  CCDF  04            		INC	B		;B=01EH
  CCE0  ED79          		OUT	(C),A		;BIOS OFF
  CCE2  FB            		EI
  CCE3  FEC9          		CP	0C9H
  CCE5  2802          		JR	Z,BIOSOK
  CCE7  1805          		JR	NOBIOS
  CCE9                	BIOSOK:
  CCE9  3EC3          		LD	A,0C3H		;JP
  CCEB  321800        		LD	(00018H),A
  CCEE                	NOBIOS:
  CCEE  3E1F          		LD	A,01FH		;スタートポート
  CCF0  DBF0          		IN	A,(0F0H)
  CCF2  0F            		RRCA
  CCF3  380B          		JR	C,CRT1
  CCF5  21EECE        		LD	HL,_C8025H
  CCF8  11B0EF        		LD	DE,CRTCD
  CCFB  011000        		LD	BC,16
  CCFE  EDB0          		LDIR
  CD00                	CRT1:
  CD00  3E1F          		LD	A,01FH		;スタートポート
  CD02  DBF0          		IN	A,(0F0H)
  CD04  CB57          		BIT	2,A
  CD06  2818          		JR	Z,BANK
                      	
  CD08  AF            		XOR	A
  CD09                	TZ1:				;前面スイッチが2HDの場合はMFMモードを2HDにしておく
  CD09  F5            		PUSH	AF
  CD0A  CDDCEF        		CALL	_GETDPB
  CD0D  DD7E12        		LD	A,(IX+012H)	;DPB_12_DEVICE
  CD10  E68F          		AND	08FH
  CD12  FE87          		CP	087H		;フロッピーでMEM切り替えがON
  CD14  2004          		JR	NZ,TZ2
  CD16  DDCB0A86      		RES	0,(IX+0AH)	;(DPB_0A_FDMODE)
  CD1A                	TZ2:
  CD1A  F1            		POP	AF
  CD1B  3C            		INC	A
  CD1C  FE08          		CP	8
  CD1E  38E9          		JR	C,TZ1
                      	
  CD20                	BANK:
  CD20  01000B        		LD	BC,00B00H
  CD23  21007F        		LD	HL,07F00H
  CD26  F3            		DI
  CD27  ED69          		OUT	(C),L
  CD29  3A0000        		LD	A,(0)
  CD2C  FEEB          		CP	0EBH
  CD2E  2005          		JR	NZ,BANK1
  CD30  3E2B          		LD	A,02BH
  CD32  32B2F1        		LD	(BANKDV),A
  CD35                	BANK1:
  CD35  ED69          		OUT	(C),L
  CD37  5E            		LD	E,(HL)
  CD38  7B            		LD	A,E
  CD39  C6A5          		ADD	A,0A5H
  CD3B  77            		LD	(HL),A
  CD3C  BE            		CP	(HL)
  CD3D  73            		LD	(HL),E
  CD3E  2005          		JR	NZ,BANK2
  CD40  2C            		INC	L
  CD41  CB65          		BIT	4,L
  CD43  28F0          		JR	Z,BANK1
  CD45                	BANK2:
  CD45  3E10          		LD	A,010H
  CD47  ED79          		OUT	(C),A
  CD49  7D            		LD	A,L
  CD4A  B7            		OR	A
  CD4B  2813          		JR	Z,NOBANK
  CD4D  2600          		LD	H,0
  CD4F  29            		ADD	HL,HL	;*2
  CD50  29            		ADD	HL,HL	;*4
  CD51  29            		ADD	HL,HL	;*8
  CD52  29            		ADD	HL,HL	;*16
  CD53  29            		ADD	HL,HL	;*32
  CD54  2B            		DEC	HL	;-1
  CD55  2B            		DEC	HL	;-2
  CD56  2B            		DEC	HL	;-3
  CD57  22A8F1        		LD	(BANKCL),HL
  CD5A  CDA5CE        		CALL	CALC_FATLN
  CD5D  32A0F1        		LD	(BANKFL),A
  CD60                	NOBANK:
  CD60                	EMM:
  CD60  DD2180F1      		LD	IX,EMMFL
  CD64  CD56CE        		CALL	EADR0
  CD67  ED78          		IN	A,(C)
  CD69  F5            		PUSH	AF
                      	
  CD6A  110000        		LD	DE,0
  CD6D                	ECHECK1:
  CD6D  13            		INC	DE
  CD6E  CD3ACE        		CALL	EADR2
  CD71  ED60          		IN	H,(C)
  CD73  CD3ACE        		CALL	EADR2
  CD76  7C            		LD	A,H
  CD77  C6E5          		ADD	A,0E5H
  CD79  ED79          		OUT	(C),A
  CD7B  3C            		INC	A
  CD7C  CD56CE        		CALL	EADR0
  CD7F  ED79          		OUT	(C),A
  CD81  3D            		DEC	A
  CD82  CD3ACE        		CALL	EADR2
  CD85  ED68          		IN	L,(C)
  CD87  CD3ACE        		CALL	EADR2
  CD8A  ED61          		OUT	(C),H
  CD8C  BD            		CP	L
  CD8D  2004          		JR	NZ,ECHECK2
  CD8F  CB5A          		BIT	3,D
  CD91  28DA          		JR	Z,ECHECK1
  CD93                	ECHECK2:
  CD93  CD56CE        		CALL	EADR0
  CD96  F1            		POP	AF
  CD97  ED79          		OUT	(C),A
  CD99  FEEB          		CP	0EBH
  CD9B  2005          		JR	NZ,EMM_BPB
  CD9D  3E26          		LD	A,026H
  CD9F  3292F1        		LD	(EMMDV),A
  CDA2                	EMM_BPB:
  CDA2  21F7FF        		LD	HL,0-9
  CDA5  19            		ADD	HL,DE
  CDA6  3009          		JR	NC,NOEMM
  CDA8  2288F1        		LD	(EMMCL),HL
  CDAB  CDA5CE        		CALL	CALC_FATLN
  CDAE  3280F1        		LD	(EMMFL),A
  CDB1                	NOEMM:
  CDB1  3E00          	KEYREP:	LD	A,000H
  CDB3  B7            		OR	A
  CDB4  2807          		JR	Z,KEYR1
  CDB6  010000        		LD	BC,0
  CDB9  ED438CEF      		LD	(_CTC),BC
  CDBD                	KEYR1:
  CDBD  CD86CE        		CALL	SETCRTC
  CDC0  0130F8        		LD	BC,0-80*25
  CDC3  2ABAEF        		LD	HL,(_PAGE_MINUS)
  CDC6  ED43BAEF      		LD	(_PAGE_MINUS),BC
  CDCA  1E0C          		LD	E,00CH
  CDCC  CDCDEF        		CALL	_PRINT
  CDCF  22BAEF        		LD	(_PAGE_MINUS),HL
                      	
  CDD2  21C1CE        		LD	HL,INIMES
  CDD5  CDF8D7        		CALL	MSX
                      	
  CDD8  3A87FF        		LD	A,(0FF87H)
  CDDB  FE08          		CP	8
  CDDD  301E          		JR	NC,INIT0
  CDDF  5F            		LD	E,A
  CDE0  C641          		ADD	A,'A'
  CDE2  32BECE        		LD	(AUTODV),A
  CDE5  0E0E          		LD	C,00EH
  CDE7  CD0500        		CALL	SYSTEM
  CDEA  1C            		INC	E
  CDEB  2185EF        		LD	HL,_SEEKSP	;Disk error Ignore
  CDEE  CBFE          		SET	7,(HL)
  CDF0  0E1B          		LD	C,01BH
  CDF2  CD0500        		CALL	SYSTEM
                      	
  CDF5  2185EF        		LD	HL,_SEEKSP
  CDF8  CBBE          		RES	7,(HL)
                      	
  CDFA  3C            		INC	A
  CDFB  2008          		JR	NZ,INIT1
  CDFD                	INIT0:
  CDFD  1E00          		LD	E,0
  CDFF  0E0E          		LD	C,00EH
  CE01  CD0500        		CALL	SYSTEM
  CE04  AF            		XOR	A
  CE05                	INIT1:
  CE05  F3            		DI
  CE06  08            		EX	AF,AF'
  CE07  2EFE          		LD	L,0-2		;CALLのスタック分減らす
  CE09  39            		ADD	HL,SP
  CE0A  1100FF        		LD	DE,0FF00H
  CE0D  45            		LD	B,L
  CE0E  CDE8D4        		CALL	ZERO_MEMORY_DE
  CE11  21CAFF        		LD	HL,EXTBIO
  CE14  36C9          		LD	(HL),0C9H	;RET
  CE16  23            		INC	HL
  CE17  060E          		LD	B,TRAP38-EXTBIO-1
  CE19  3EFF          		LD	A,0FFH		;RST 38H
  CE1B  CDB9E0        		CALL	FILL_MEMORY
  CE1E  2111CF        		LD	HL,AT_TRAP38
  CE21  11D9FF        		LD	DE,TRAP38
  CE24  012700        		LD	BC,AT_TRAPE-AT_TRAP38
  CE27  EDB0          		LDIR
  CE29  08            		EX	AF,AF'
  CE2A  B7            		OR	A
  CE2B  C8            		RET	Z
                      	
  CE2C  3EE6          		LD	A,0E6H
  CE2E  CD61DE        		CALL	COMOUT
  CE31  CD46DE        		CALL	IN49SB
  CE34  CD46DE        		CALL	IN49SB
  CE37  FE1B          		CP	01BH
  CE39  C9            		RET
                      	
  CE3A                	EADR2:
  CE3A  D5            		PUSH	DE
  CE3B  EB            		EX	DE,HL
  CE3C  29            		ADD	HL,HL
  CE3D  29            		ADD	HL,HL
  CE3E  DD4E0D        		LD	C,(IX+00DH)	;DPB_0D_MAXSEC
  CE41  DD460C        		LD	B,(IX+00CH)	;DPB_0C_MAXCYL
  CE44  09            		ADD	HL,BC
  CE45  DD4E13        		LD	C,(IX+013H)	;DPB_13_UNITNO
  CE48  060D          		LD	B,00DH
  CE4A  ED49          		OUT	(C),C
  CE4C  0C            		INC	C
  CE4D  ED69          		OUT	(C),L
  CE4F  0C            		INC	C
  CE50  ED61          		OUT	(C),H
  CE52  0C            		INC	C
  CE53  EB            		EX	DE,HL
  CE54  D1            		POP	DE
  CE55  C9            		RET
                      	
  CE56                	EADR0:
  CE56  D5            		PUSH	DE
  CE57  110000        		LD	DE,0
  CE5A  CD3ACE        		CALL	EADR2
  CE5D  D1            		POP	DE
  CE5E  C9            		RET
                      	
  CE5F                	CHKCTC:
  CE5F  C5            		PUSH	BC
  CE60  110347        		LD	DE,04703H
  CE63                	INICTC1:
  CE63  0C            		INC	C
  CE64  ED51          		OUT	(C),D
  CE66  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  CE68  1D            		DEC	E
  CE69  20F8          		JR	NZ,INICTC1
  CE6B  C1            		POP	BC
                      	
  CE6C  11FA07        		LD	DE,007FAH
  CE6F  ED51          		OUT	(C),D
  CE71  ED59          		OUT	(C),E
  CE73  ED78          		IN	A,(C)
  CE75  BB            		CP	E
  CE76  C0            		RET	NZ
  CE77  ED51          		OUT	(C),D
  CE79  ED51          		OUT	(C),D
  CE7B  ED78          		IN	A,(C)
  CE7D  BA            		CP	D
  CE7E  C0            		RET	NZ
  CE7F  0C            		INC	C
  CE80  0C            		INC	C
  CE81  ED438CEF      		LD	(_CTC),BC
  CE85  C9            		RET
                      	
  CE86                	SETCRTC:
  CE86  21B0EF        		LD	HL,CRTCD
  CE89  AF            		XOR	A
  CE8A                	SETCRT1:
  CE8A  010018        		LD	BC,01800H
  CE8D  ED79          		OUT	(C),A
  CE8F  0C            		INC	C
  CE90  04            		INC	B
  CE91  EDA3          		OUTI
  CE93  3C            		INC	A
  CE94  FE0C          		CP	12
  CE96  20F2          		JR	NZ,SETCRT1
  CE98  23            		INC	HL
  CE99  23            		INC	HL
  CE9A  01031B        		LD	BC,01A03H+00100H
  CE9D  EDA3          		OUTI
  CE9F  01D020        		LD	BC,01FD0H+00100H
  CEA2  EDA3          		OUTI
  CEA4  C9            		RET
                      	
  CEA5                	CALC_FATLN:	;FAT12のクラスタ数から必要なFATサイズを求める(セクタサイズ512)
  CEA5  5D            		LD	E,L
  CEA6  54            		LD	D,H
  CEA7  29            		ADD	HL,HL	;*2
  CEA8  19            		ADD	HL,DE	;*3
  CEA9  CB3C          		SRL	H	;/2
  CEAB  CB1D          		RR	L	;1クラスタ辺り1.5バイト必要
  CEAD  11FF01        		LD	DE,511	;切り上げる
  CEB0  19            		ADD	HL,DE
  CEB1  7C            		LD	A,H
  CEB2  CB3F          		SRL	A
  CEB4  C9            		RET
                      	
  CEB5  4155544F455845	AUTOD:	DB	"AUTOEXEC "
  CEBE  413A00        	AUTODV:	DB	"A:",0
                      	
  CEC1  4C53582D446F64	INIMES:	DB	"LSX-Dodgers for X1/turbo version "
  CEE2  312E          		DB	030H + VER_1, '.'
  CEE4  3531          		DB	030H + VER_2 ,030H + VER_3
                      	;	DB	""
  CEE6  2047616B750D0A		DB	' Gaku',0DH,0AH
  CEED  00            		DB	0
                      	
  CEEE                	_C8025H:
  CEEE  6B5059881B0119		DB	06BH,050H,059H,088H,01BH,001H,019H,01AH
  CEF6  000F          		DB	000H,00FH
  CEF8  80F8B0FF      		DW	0-80*LINE,0-80
  CEFC  0C23          		DB	00CH,023H
                      	
  CEFE  030C0F30333C3F	TEXTDT:	DB	003H,00CH,00FH,030H,033H,03CH,03FH
                      	
  CF05                	SIODATA:
  CF05  18            		DB	018H
  CF06  0100          		DB	1,0
  CF08  0200          		DB	2,0
  CF0A  03C1          		DB	3,0C1H
  CF0C  0444          		DB	4,044H
  CF0E  05E8          		DB	5,0E8H
  CF10  FF            		DB	0FFH
                      	
  CF11                	AT_TRAP38:
  CF11  210000        		LD	HL,0
  CF14  E3            		EX	(SP),HL
  CF15  3E24          		LD	A,'$'
  CF17  CD3EDB        		CALL	MSG_A
  CF1A  2B            		DEC	HL
  CF1B  7C            		LD	A,H
  CF1C  CDE8FF        		CALL	PRHX+AT_RT
  CF1F  7D            		LD	A,L
  CF20                	PRHX:
  CF20  F5            		PUSH	AF
  CF21  07            		RLCA
  CF22  07            		RLCA
  CF23  07            		RLCA
  CF24  07            		RLCA
  CF25  CDF1FF        		CALL	PRHX2+AT_RT
  CF28  F1            		POP	AF
  CF29                	PRHX2:
  CF29  E60F          		AND	00FH
  CF2B  FE0A          		CP	10
  CF2D  3F            		CCF
  CF2E  CE30          		ADC	A,'0'
  CF30  27            		DAA
  CF31  C33EDB        		JP	MSG_A
  CF34                		DS	4
  CF38                	AT_TRAPE:
                      	
                      	;X1CPU.ASM
                      	
                      	;	LSX-Dodgers CPU
                      	;	X1/turbo/Z
                      	
                      	;	ノンターボ用パッチ
                      	;	DMAを使って転送している部分をCPUに差し替える
                      	
  CF38                	AT_SCR1:
  CF38  D9            		EXX
  CF39  C5            		PUSH	BC
  CF3A  ED4BB1EF      		LD	BC,(_WIDTH)
  CF3E  0620          		LD	B,020H
  CF40  D9            		EXX
  CF41  C5            		PUSH	BC
  CF42  010020        		LD	BC,02000H
                      	
  CF45  67            		LD	H,A
  CF46  B7            		OR	A
  CF47                	AT_SCRUP1:
  CF47  2815          		JR	Z,AT_SCRCL
  CF49  C5            		PUSH	BC
  CF4A  CBE0          		SET	4,B
  CF4C  D9            		EXX
  CF4D  C5            		PUSH	BC
  CF4E  CBE0          		SET	4,B
  CF50  D9            		EXX
  CF51  CD1CDF        		CALL	AT_UPSUB+AT_RS
  CF54  D9            		EXX
  CF55  C1            		POP	BC
  CF56  D9            		EXX
  CF57  C1            		POP	BC
  CF58  CD1CDF        		CALL	AT_UPSUB+AT_RS
  CF5B  25            		DEC	H
  CF5C  18E9          		JR	AT_SCRUP1
                      	
  CF5E                	AT_SCRCL:
  CF5E  2AB1EF        		LD	HL,(_WIDTH)
  CF61  CDB2DD        		CALL	LINECL
  CF64  C1            		POP	BC
  CF65  D9            		EXX
  CF66  C1            		POP	BC
  CF67  D9            		EXX
  CF68  C9            		RET
                      	
  CF69                	AT_UPSUB:
  CF69  3AB1EF        		LD	A,(_WIDTH)
  CF6C  6F            		LD	L,A
  CF6D                	AT_UPSUB1:
  CF6D  D9            		EXX
  CF6E  ED78          		IN	A,(C)
  CF70  03            		INC	BC
  CF71  D9            		EXX
  CF72  ED79          		OUT	(C),A
  CF74  03            		INC	BC
  CF75  2D            		DEC	L
  CF76  20F5          		JR	NZ,AT_UPSUB1
  CF78  C9            		RET
                      	
                      	;	FLOPPY DISK DRIVER(CPU)
                      	
  CF79                	DISKC:
  CF79  1B            		DEC	DE
  CF7A  CB5F          		BIT	3,A
  CF7C  C454EE        		CALL	NZ,RNF
  CF7F                	DISKD:
  CF7F  E5            		PUSH	HL
  CF80  215AEE        		LD	HL,RETRY
  CF83  35            		DEC	(HL)
  CF84  E1            		POP	HL
  CF85  200C          		JR	NZ,AT_ERR		;Retry
  CF87  B7            		OR	A
  CF88  2809          		JR	Z,AT_ERR		;Error
                      	
  CF8A                	AT_DELP:
  CF8A  CD54EE        		CALL	RNF
  CF8D  CD30EE        		CALL	FDMOFF
  CF90  3EFF          		LD	A,0FFH
  CF92                	AT_ERRZ:
  CF92  BF            		CP	A
  CF93                	AT_ERR:
  CF93  3EFF          		LD	A,0FFH
  CF95  C9            		RET
  CF96                	ERRW:
  CF96  3EFF          		LD	A,0FFH
  CF98  BF            		CP	A
  CF99  37            		SCF
  CF9A  C330EE        		JP	FDMOFF
                      	
  CF9D                	ERRDW:
  CF9D  D1            		POP	DE
  CF9E  CD3DDF        		CALL	AT_DELP+AT_RS
  CFA1  C269EE        		JP	NZ,DWT0+AT_R
  CFA4  B7            		OR	A
  CFA5  20EF          		JR	NZ,ERRW
  CFA7  C9            		RET
                      	
  CFA8                	ERRDR:
  CFA8  D1            		POP	DE
  CFA9  CD3DDF        		CALL	AT_DELP+AT_RS
  CFAC  C2B2EE        		JP	NZ,DRD0+AT_R
  CFAF  B7            		OR	A
  CFB0  20E4          		JR	NZ,ERRW
  CFB2  C9            		RET
                      	
  CFB3                	AT_WTTRK:
  CFB3  0601          		LD	B,1
  CFB5  3EF4          		LD	A,0F4H
  CFB7  C35DEE        		JP	AT_WTTRK1+AT_R
                      	
  CFBA                	AT_SCRN:
  CFBA  ED78          		IN	A,(C)
  CFBC  C9            		RET
  CFBD                	AT_SCRE:
                      	
  CFBD                	AT_DWT:
  CFBD  3EA0          		LD	A,0A0H
  CFBF                	AT_WTTRK1:
  CFBF  32F8ED        		LD	(FDCPAT+1),A
  CFC2                	DWTBL:
  CFC2  78            		LD	A,B
  CFC3  32A0EE        		LD	(AT_WTB+1+AT_R),A
  CFC6  3E02          		LD	A,2		;Retry count
  CFC8  325AEE        		LD	(RETRY),A
                      	
  CFCB                	DWT0:
  CFCB  D5            		PUSH	DE
  CFCC  E5            		PUSH	HL
  CFCD  CD97ED        		CALL	SEEK		;Write disk
  CFD0  E1            		POP	HL
  CFD1  DA50DF        		JP	C,ERRDW+AT_RS
  CFD4  F3            		DI
  CFD5  3AF8ED        		LD	A,(FDCPAT+1)
  CFD8  CD3CEE        		CALL	SECSET
  CFDB  0EFB          		LD	C,0FBH
                      	
  CFDD                	DWT1:
  CFDD  56            		LD	D,(HL)
  CFDE                	DWT2:
  CFDE  78            		LD	A,B
  CFDF  DBF8          		IN	A,(0F8H)
  CFE1  0F            		RRCA
  CFE2  3008          		JR	NC,DWT4
  CFE4  0F            		RRCA
  CFE5  30F7          		JR	NC,DWT2
  CFE7                	DWT3:
  CFE7  ED51          		OUT	(C),D
  CFE9  23            		INC	HL
  CFEA  18F1          		JR	DWT1
                      	
  CFEC                	DWT4:
  CFEC  3D            		DEC	A
  CFED  28F8          		JR	Z,DWT3
  CFEF  3C            		INC	A
  CFF0  FB            		EI
  CFF1  D1            		POP	DE
  CFF2  13            		INC	DE
  CFF3  CD30EE        		CALL	FDMOFF
  CFF6  2809          		JR	Z,DISKOK_WT
  CFF8  CD2CDF        		CALL	DISKC+AT_RS
  CFFB  20CE          		JR	NZ,DWT0
  CFFD  B7            		OR	A
  CFFE  C249DF        		JP	NZ,ERRW+AT_RS
                      	
  D001                	DISKOK_WT:
  D001  0601          	AT_WTB:	LD	B,1
  D003  10BD          		DJNZ	DWTBL
  D005  C9            		RET
                      	
  D006                	AT_DRD:
  D006  3E80          		LD	A,080H
  D008  32F8ED        		LD	(FDCPAT+1),A
  D00B                	DRDBL:
  D00B  78            		LD	A,B
  D00C  32E5EE        		LD	(AT_RDB+1+AT_R),A
  D00F  3E02          		LD	A,2		;Retry count
  D011  325AEE        		LD	(RETRY),A
  D014                	DRD0:
  D014  D5            		PUSH	DE
  D015  E5            		PUSH	HL
  D016  CD97ED        		CALL	SEEK		;Read disk
  D019  E1            		POP	HL
  D01A  DA5BDF        		JP	C,ERRDR+AT_RS
  D01D  F3            		DI
  D01E  3AF8ED        		LD	A,(FDCPAT+1)
  D021  CD3CEE        		CALL	SECSET
  D024  0EFB          		LD	C,0FBH
  D026                	DRD1:
  D026  78            		LD	A,B
  D027  DBF8          		IN	A,(0F8H)
  D029  0F            		RRCA
  D02A  3008          		JR	NC,DRD3
  D02C  0F            		RRCA
  D02D  30F7          		JR	NC,DRD1
  D02F  EDA2          		INI
  D031  04            		INC	B
  D032  18F2          		JR	DRD1
                      	
  D034                	DRD3:
  D034  B7            		OR	A
  D035  FB            		EI
  D036  D1            		POP	DE
  D037  13            		INC	DE
  D038  CD30EE        		CALL	FDMOFF
  D03B  2809          		JR	Z,DISKOK_RD
  D03D  CD2CDF        		CALL	DISKC+AT_RS
  D040  20D2          		JR	NZ,DRD0
  D042  B7            		OR	A
  D043  C249DF        		JP	NZ,ERRW+AT_RS
                      	
  D046                	DISKOK_RD:
  D046  0601          	AT_RDB:	LD	B,1
  D048  10C1          		DJNZ	DRDBL
  D04A  C9            		RET
                      	
  D04B                	AT_CPUE:
                      	
                      	
                      	;	EMM DRIVER(CPU)
                      	
                      	
  D04B                	AT_EDWT:
  D04B  CD94D7        		CALL	AT_EADR+AT_RE
  D04E                	AT_EDWT0:
  D04E  F5            		PUSH	AF
  D04F  AF            		XOR	A
  D050                	AT_EDWT1:
  D050  04            		INC	B
  D051  EDA3          		OUTI
  D053  04            		INC	B
  D054  EDA3          		OUTI
  D056  3D            		DEC	A
  D057  20F7          		JR	NZ,AT_EDWT1
  D059  13            		INC	DE
  D05A  F1            		POP	AF
  D05B  3D            		DEC	A
  D05C  20F0          		JR	NZ,AT_EDWT0
  D05E  C9            		RET
                      	
  D05F                	AT_EDRD:
  D05F  CD94D7        		CALL	AT_EADR+AT_RE
  D062                	AT_EDRD0:
  D062  F5            		PUSH	AF
  D063  AF            		XOR	A
  D064                	AT_EDRD1:
  D064  EDA2          		INI
  D066  04            		INC	B
  D067  EDA2          		INI
  D069  04            		INC	B
  D06A  3D            		DEC	A
  D06B  20F7          		JR	NZ,AT_EDRD1
  D06D  13            		INC	DE
  D06E  F1            		POP	AF
  D06F  3D            		DEC	A
  D070  20F0          		JR	NZ,AT_EDRD0
  D072  C9            		RET
                      	
  D073                	AT_EADR:
  D073  C5            		PUSH	BC
  D074  D5            		PUSH	DE
  D075  EB            		EX	DE,HL
  D076  29            		ADD	HL,HL
  D077  DD4E0D        		LD	C,(IX+00DH)	;DPB_0D_MAXSEC
  D07A  DD460C        		LD	B,(IX+00CH)	;DPB_0C_MAXCYL
  D07D  09            		ADD	HL,BC
  D07E  DD4E13        		LD	C,(IX+013H)	;DPB_13_UNITNO
  D081  060D          		LD	B,00DH
  D083  ED49          		OUT	(C),C
  D085  0C            		INC	C
  D086  ED69          		OUT	(C),L
  D088  0C            		INC	C
  D089  ED61          		OUT	(C),H
  D08B  0C            		INC	C
  D08C  EB            		EX	DE,HL
  D08D  D1            		POP	DE
  D08E  F1            		POP	AF
  D08F  A7            		AND	A	;CF=0
  D090  C9            		RET
  D091                	AT_EMME:
                      	
  30C8                	AT_RT	EQU	TRAP38-AT_TRAP38
                      	
  D091                	INITE:
  D091                		DS	BDOS-INITE
  D106  C3B7D7        		JP	BDOS0
                      	
                      	;X1CCP.ASM
                      	
                      	;	LSX-Dodgers CCP
                      	;	X1/turbo/Z
                      	
  D109                	WBOOT1:
  D109  F3            		DI
  D10A  ED7B0600      		LD	SP,(SYSTEM+1)
                      	
  D10E  3EEF          		LD	A,INTVEC/256
  D110  ED47          		LD	I,A
                      	
  D112  3EE4          		LD	A,0E4H
  D114  CD61DE        		CALL	COMOUT
  D117  3EC8          		LD	A,INTVEC
  D119  CD3BDE        		CALL	OT49SB
                      	
  D11C  21B0EF        		LD	HL,CRTCD
  D11F  AF            		XOR	A
  D120                	SETCRT2:
  D120  010018        		LD	BC,01800H
  D123  ED79          		OUT	(C),A
  D125  0C            		INC	C
  D126  56            		LD	D,(HL)
  D127  FE0D          		CP	13
  D129  3802          		JR	C,SETCRT3
  D12B  1600          		LD	D,0
  D12D                	SETCRT3:
  D12D  ED51          		OUT	(C),D
  D12F  23            		INC	HL
  D130  3C            		INC	A
  D131  FE0E          		CP	14
  D133  20EB          		JR	NZ,SETCRT2
                      	
  D135  01031B        		LD	BC,01A03H+00100H
  D138  EDA3          		OUTI
  D13A  01D020        		LD	BC,01FD0H+00100H
  D13D  EDA3          		OUTI
  D13F  2192EF        		LD	HL,_KEYD
  D142  7E            		LD	A,(HL)
  D143  3600          		LD	(HL),0
  D145  CD2BDB        		CALL	KEYBC_IFBREAK
  D148  3E04          		LD	A,4
  D14A  CD3EDB        		CALL	MSG_A
                      	
                      	;LDCCP.ASM
                      	
                      	;	LSX-Dodgers CCP
                      	
  D14D                	COMMAND:
  D14D  CD00D2        		CALL	SETDTA1
  D150  3A87EF        		LD	A,(_DVSW)
  D153  C641          		ADD	A,'A'
  D155  CD3EDB        		CALL	MSG_A
  D158  3E3E          		LD	A,'>'
  D15A  CD3EDB        		CALL	MSG_A
  D15D  3E50          		LD	A,80
  D15F  12            		LD	(DE),A
  D160  CD8DDB        		CALL	_SYS0A		;(BDOS)文字列入力
  D163  CDAAD3        		CALL	LTNL
                      	
  D166  118200        		LD	DE,DTA1+2
  D169  CDFDEF        		CALL	_COMANL
  D16C  30DF          		JR	NC,COMMAND
  D16E  1179EF        		LD	DE,COMERM
  D171  CDE9D7        		CALL	_SYS09		;(BDOS)文字列出力
  D174  C7            		RST	0
                      	
  D175                	COMANL:
  D175  CD0DE0        		CALL	FILE
  D178  3A19EF        		LD	A,(FNAME+4)
  D17B  FE20          		CP	020H
  D17D  201C          		JR	NZ,COMB2
  D17F  D5            		PUSH	DE
  D180  1115EF        		LD	DE,FNAME
  D183  1A            		LD	A,(DE)
  D184  FE20          		CP	020H
  D186  2844          		JR	Z,SDVSW
  D188  1B            		DEC	DE
  D189  1A            		LD	A,(DE)
  D18A  C6FF          		ADD	A,0FFH
  D18C  3809          		JR	C,COMB
  D18E  13            		INC	DE
                      	
  D18F  218BD6        		LD	HL,COMTB
  D192  0609          		LD	B,COMS
  D194  CD91E2        		CALL	CPNAME
  D197                	COMB:
  D197  D1            		POP	DE
  D198  D20F00        		JP	NC,JP_HL
  D19B                	COMB2:
  D19B  EB            		EX	DE,HL
  D19C  2274D2        		LD	(COMPAT+1),HL
  D19F  F5            		PUSH	AF
  D1A0  CD20D2        		CALL	CEXE4
  D1A3  F1            		POP	AF
  D1A4  2115EF        		LD	HL,FNAME
  D1A7  116D00        		LD	DE,FCB2+1	;COMMAND NAME
  D1AA  010B00        		LD	BC,11
  D1AD  EDB0          		LDIR
  D1AF  112ED6        		LD	DE,PATHD
  D1B2                	CEX1:
  D1B2  1A            		LD	A,(DE)
  D1B3  FE20          		CP	020H
  D1B5  D8            		RET	C
  D1B6  CD02E0        		CALL	FILEC
  D1B9  D5            		PUSH	DE
  D1BA  216D00        		LD	HL,FCB2+1	;COMMAND NAME
  D1BD  1115EF        		LD	DE,FNAME
  D1C0  010B00        		LD	BC,11
  D1C3  EDB0          		LDIR
  D1C5  CD20D2        		CALL	CEXE4
  D1C8  D1            		POP	DE
  D1C9  13            		INC	DE
  D1CA  18E6          		JR	CEX1
                      	
  D1CC                	SDVSW:
  D1CC  F1            		POP	AF
  D1CD  3A14EF        		LD	A,(FDRV)
  D1D0  3D            		DEC	A
  D1D1  5F            		LD	E,A
  D1D2  0E0E          		LD	C,00EH		;(BDOS)カレントドライブの設定
  D1D4  1831          		JR	SYSTEM0
                      	
  D1D6                	OPEN1:
  D1D6  2114EF        		LD	HL,FDRV
  D1D9                	OPEN:
  D1D9  0E11          		LD	C,011H		;(BDOS)ファイルの検索
  D1DB                	OPEN3:
  D1DB  D5            		PUSH	DE
  D1DC  1109D6        		LD	DE,DTA_CCP
  D1DF  CDFDD1        		CALL	SETDTA
  D1E2  EB            		EX	DE,HL
  D1E3  CD07D2        		CALL	SYSTEM0
  D1E6  D1            		POP	DE
  D1E7  C9            		RET
                      	
  D1E8                	OPEN2:
  D1E8  0E12          		LD	C,012H
  D1EA  18EF          		JR	OPEN3
                      	
  D1EC                	DEFCB:				;Z=Ok NZ=Error
  D1EC  1109D6        		LD	DE,DTA_CCP
  D1EF  CD05D2        		CALL	SYSC0F
                      	
  D1F2  112AD6        		LD	DE,DTA_CCP+33	;(FCB)ランダムレコード
  D1F5  0604          		LD	B,4
  D1F7  CDE8D4        		CALL	ZERO_MEMORY_DE
  D1FA  110001        		LD	DE,00100H
  D1FD                	SETDTA:
  D1FD  C3C3D9        		JP	_SYS1A		;(BDOS)DTAの設定
                      	
  D200                	SETDTA1:
  D200  118000        		LD	DE,DTA1
  D203  18F8          		JR	SETDTA
                      	
  D205                	SYSC0F:
  D205  0E0F          		LD	C,00FH		;(BDOS)ファイルのオープン
  D207                	SYSTEM0:
  D207  CD0500        		CALL	SYSTEM
  D20A  B7            		OR	A
  D20B  C9            		RET
                      	
  D20C                	C_CD:
  D20C  0E5A          		LD	C,5AH
  D20E  18F7          		JR	SYSTEM0
                      	
  D210                	S27BUF:
  D210  3A0700        		LD	A,(SYSTEM+2)
  D213  3D            		DEC	A
  D214  E6F8          		AND	0F8H
  D216  67            		LD	H,A
  D217  2E00          		LD	L,0
  D219                	S27DTA:
  D219  1109D6        		LD	DE,DTA_CCP
  D21C                	S27:
  D21C  0E27          		LD	C,027H		;(BDOS)ランダムブロック読み込み
  D21E  18E7          		JR	SYSTEM0
                      	
  D220                	CEXE4:
  D220  3A14EF        		LD	A,(FDRV)
  D223  325700        		LD	(00057H),A
  D226  2A22EF        		LD	HL,(FDRV+14)
  D229  225800        		LD	(00058H),HL
                      	
  D22C  211DEF        		LD	HL,FNAME+8
  D22F  7E            		LD	A,(HL)
  D230  FE20          		CP	020H
  D232  2007          		JR	NZ,CEXE7
  D234  3E3F          		LD	A,'?'
  D236  77            		LD	(HL),A
  D237  23            		INC	HL
  D238  77            		LD	(HL),A
  D239  23            		INC	HL
  D23A  77            		LD	(HL),A
  D23B                	CEXE7:
  D23B  CDD6D1        		CALL	OPEN1
  D23E                	CEXE5:
  D23E  C0            		RET	NZ
  D23F  2A13D6        		LD	HL,(DTA_CCP+1+9)
  D242  7C            		LD	A,H
  D243  CD19E3        		CALL	CAP
  D246  67            		LD	H,A
  D247  7D            		LD	A,L
  D248  CD19E3        		CALL	CAP
  D24B  6F            		LD	L,A
  D24C  3A12D6        		LD	A,(DTA_CCP+1+8)
  D24F  CD19E3        		CALL	CAP
  D252  D642          		SUB	'B'
  D254  282C          		JR	Z,C_BAT
  D256  3D            		DEC	A		;'C'
  D257  2805          		JR	Z,C_EXE
  D259                	CEXE6:
  D259  CDE8D1        		CALL	OPEN2
  D25C  18E0          		JR	CEXE5
                      	
  D25E                	C_EXE:
  D25E  7C            		LD	A,H
  D25F  FE4D          		CP	'M'
  D261  20F6          		JR	NZ,CEXE6
                      	
  D263  CDECD1        		CALL	DEFCB
  D266  CD10D2        		CALL	S27BUF
  D269  3D            		DEC	A
  D26A  37            		SCF
  D26B  C0            		RET	NZ
  D26C  7C            		LD	A,H
  D26D  B5            		OR	L
  D26E  37            		SCF
  D26F  C8            		RET	Z
  D270  CD00D2        		CALL	SETDTA1
  D273  110000        	COMPAT:	LD	DE,0				; self-modifying code
  D276  ED7B0600      		LD	SP,(SYSTEM+1)
  D27A  67            		LD	H,A				; A=0 in SETDTA1(_SYS1A)
  D27B  6F            		LD	L,A
  D27C  E5            		PUSH	HL				; push $0000 (reboot address)
  D27D  24            		INC	H
  D27E  E5            		PUSH	HL				; push $0100 (TPA address)
  D27F  C3B3D4        		JP	SETFCB				; and JP $0100
                      	
  D282                	C_BAT:
  D282  114154        		LD	DE,'A'+'T'*256
  D285  ED52          		SBC	HL,DE
  D287  20D0          		JR	NZ,CEXE6
                      	
  D289  F1            		POP	AF
  D28A  F1            		POP	AF
  D28B  CDECD1        		CALL	DEFCB
  D28E  210002        		LD	HL,00200H
  D291  CD19D2        		CALL	S27DTA
  D294  C6FE          		ADD	A,0FEH
  D296  D8            		RET	C
  D297  7D            		LD	A,L
  D298  B7            		OR	A
  D299  37            		SCF
  D29A  C8            		RET	Z
  D29B  3C            		INC	A
  D29C  F5            		PUSH	AF
                      	
  D29D  CD2EDB        		CALL	KEYBC
  D2A0  3E06          		LD	A,6
  D2A2  CD3EDB        		CALL	MSG_A
  D2A5  C1            		POP	BC
  D2A6  210001        		LD	HL,00100H
  D2A9                	BAT1:
  D2A9  A7            		AND	A
  D2AA  05            		DEC	B
  D2AB  C8            		RET	Z
  D2AC  7E            		LD	A,(HL)
  D2AD  FE25          		CP	'%'
  D2AF  280C          		JR	Z,BAT2
  D2B1                	BAT1X:
  D2B1  7E            		LD	A,(HL)
  D2B2  23            		INC	HL
  D2B3  FE1A          		CP	01AH
  D2B5  C8            		RET	Z
  D2B6  FE0A          		CP	00AH
  D2B8  C413DB        		CALL	NZ,KEYBS
  D2BB  18EC          		JR	BAT1
                      	
  D2BD                	BAT2:
  D2BD  23            		INC	HL
  D2BE  7E            		LD	A,(HL)
  D2BF  2B            		DEC	HL
  D2C0  D631          		SUB	'1'
  D2C2  38ED          		JR	C,BAT1X
  D2C4  FE09          		CP	9
  D2C6  30E9          		JR	NC,BAT1X
  D2C8  23            		INC	HL
  D2C9  23            		INC	HL
  D2CA  3C            		INC	A
  D2CB  4F            		LD	C,A
  D2CC  ED5B74D2      		LD	DE,(COMPAT+1)
  D2D0                	BAT3:
  D2D0  1A            		LD	A,(DE)
  D2D1  B7            		OR	A
  D2D2  28D5          		JR	Z,BAT1
  D2D4  CDE4E0        		CALL	SPCUT
  D2D7  0D            		DEC	C
  D2D8  2808          		JR	Z,BAT5
  D2DA                	BAT4:
  D2DA  1A            		LD	A,(DE)
  D2DB  FE21          		CP	021H
  D2DD  38F1          		JR	C,BAT3
  D2DF  13            		INC	DE
  D2E0  18F8          		JR	BAT4
  D2E2                	BAT5:
  D2E2  1A            		LD	A,(DE)
  D2E3  FE21          		CP	021H
  D2E5  38C2          		JR	C,BAT1
  D2E7  13            		INC	DE
  D2E8  CD13DB        		CALL	KEYBS
  D2EB  18F5          		JR	BAT5
                      	
  D2ED                	C_DEL:
  D2ED  CDB3D4        		CALL	SETFCB
  D2F0  CD54DB        		CALL	_SYS08		;(BDOS)エコーなしコンソール入力
                      	
  D2F3  0E13          		LD	C,013H
  D2F5  180A          		JR	CDEL1		;(BDOS)ファイルの削除
                      	
  D2F7                	C_REN:
  D2F7  CDB3D4        		CALL	SETFCB
  D2FA  3E10          		LD	A,010H		;ディレクトリも対象にする
  D2FC  326900        		LD	(FCB1+13),A	;属性
  D2FF  0E17          		LD	C,017H		;(BDOS)ファイル名の変更
  D301                	CDEL1:
  D301  115C00        		LD	DE,FCB1
  D304  CD0500        		CALL	SYSTEM
  D307  C6FF          		ADD	A,0FFH
  D309  C9            		RET
                      	
  D30A                	C_DIR:
  D30A  CD02E0        		CALL	FILEC
  D30D  2115EF        		LD	HL,FDRV+1
  D310  CDFED5        		CALL	CWILD1
  D313  3EF1          		LD	A,0F1H
  D315  3221EF        		LD	(FDRV+13),A
  D318  CDD6D1        		CALL	OPEN1
  D31B                	CDIR1:
  D31B  B7            		OR	A
  D31C  2008          		JR	NZ,PDSKF
  D31E  CD69D3        		CALL	P_NAME
  D321  CDE8D1        		CALL	OPEN2
  D324  18F5          		JR	CDIR1
                      	
  D326                	PDSKF:
  D326  3A14EF        		LD	A,(FDRV)
  D329  5F            		LD	E,A
  D32A  0E1B          		LD	C,01BH		;(BDOS)ディスク情報の獲得
  D32C  CD0500        		CALL	SYSTEM
  D32F  4F            		LD	C,A		;C←1クラスタ辺りの論理セクタ数
  D330  C601          		ADD	A,001H
  D332  D8            		RET	C		;Aが0FFHだった場合
  D333  3E06          		LD	A,8-2
  D335                	PDS1:				;HL=未使用クラスタの総数
  D335  3C            		INC	A
  D336  CB19          		RR	C
  D338  30FB          		JR	NC,PDS1
  D33A                	PDS2:				;B←論理セクタのサイズの上位8ビット
  D33A  3C            		INC	A
  D33B  CB18          		RR	B
  D33D  30FB          		JR	NC,PDS2
  D33F  47            		LD	B,A
                      	
  D340  110000        		LD	DE,0
  D343                	PDS3:
  D343  29            		ADD	HL,HL
  D344  EB            		EX	DE,HL
  D345  ED6A          		ADC	HL,HL
  D347  EB            		EX	DE,HL
  D348  10F9          		DJNZ	PDS3
  D34A                	PDSKF1:
  D34A  CDE2D3        		CALL	PRDEC_DEHL
  D34D  116FD6        		LD	DE,FREE
  D350  CDE9D7        		CALL	_SYS09		;(BDOS)文字列出力
  D353  CDD1D3        		CALL	PUTDRV
  D356  3E5C          		LD	A,05CH		;\
  D358  CD3EDB        		CALL	MSG_A
  D35B  2A22EF        		LD	HL,(FDRV+14)	;ディレクトリのクラスタ番号
  D35E  AF            		XOR	A
  D35F  11FEFF        		LD	DE,0-2
  D362  19            		ADD	HL,DE
  D363  23            		INC	HL
  D364  DCDED3        		CALL	C,PRDEC_HL
  D367  1841          		JR	LTNL
                      	
  D369                	P_NAME:
  D369  3A0AD6        		LD	A,(DTA_CCP+1)
  D36C  FE2E          		CP	'.'
  D36E  C8            		RET	Z
  D36F  1187D6        		LD	DE,DIRHD
  D372  CDE9D7        		CALL	_SYS09		;(BDOS)文字列出力
  D375  3A15D6        		LD	A,(DTA_CCP+1+00BH)
  D378  F5            		PUSH	AF
  D379  0F            		RRCA
  D37A  9F            		SBC	A,A
  D37B  E60A          		AND	'*'-020H
  D37D  C620          		ADD	A,020H
  D37F  CD3EDB        		CALL	MSG_A
  D382  CDD1D3        		CALL	PUTDRV
  D385  210AD6        		LD	HL,DTA_CCP+1
  D388  CD22D4        		CALL	FPRNT
                      	
  D38B  F1            		POP	AF
  D38C  CB67          		BIT	4,A
  D38E  2808          		JR	Z,DIR3
  D390  117CD6        		LD	DE,DIRMES
  D393  CDE9D7        		CALL	_SYS09		;(BDOS)文字列出力
  D396  180A          		JR	DIR6
  D398                	DIR3:
  D398  ED5B28D6      		LD	DE,(DTA_CCP+1+01EH)
  D39C  2A26D6        		LD	HL,(DTA_CCP+1+01CH)
  D39F  CDE2D3        		CALL	PRDEC_DEHL
  D3A2                	DIR6:
  D3A2  3AB1EF        		LD	A,(_WIDTH)
  D3A5  FE29          		CP	40+1
  D3A7  D444D4        		CALL	NC,PRTTMS
                      	
  D3AA                	LTNL:
  D3AA  1E03          		LD	E,3
  D3AC  C3CDEF        		JP	_PRINT
                      	
  D3AF                	C_PATH:
  D3AF  CDE4E0        		CALL	SPCUT
  D3B2  212ED6        		LD	HL,PATHD
  D3B5  FE21          		CP	021H
  D3B7  300C          		JR	NC,CPATH0
  D3B9                	CPATHP:
  D3B9  7E            		LD	A,(HL)
  D3BA  23            		INC	HL
  D3BB  FE20          		CP	020H
  D3BD  3F            		CCF
  D3BE  30EA          		JR	NC,LTNL
  D3C0  CD3EDB        		CALL	MSG_A
  D3C3  18F4          		JR	CPATHP
  D3C5                	CPATH0:
  D3C5  FE3B          		CP	';'
  D3C7  2001          		JR	NZ,CPATH1
  D3C9  13            		INC	DE
  D3CA                	CPATH1:
  D3CA  EB            		EX	DE,HL
  D3CB  014000        		LD	BC,PATHX
  D3CE  EDB0          		LDIR
  D3D0  C9            		RET
                      	
  D3D1                	PUTDRV:
  D3D1  3A14EF        		LD	A,(FDRV)
  D3D4  C640          		ADD	A,'A'-1
  D3D6  CD3EDB        		CALL	MSG_A
  D3D9  3E3A          		LD	A,':'
  D3DB                	MSG_AR:
  D3DB  C33EDB        		JP	MSG_A
                      	
  D3DE                	PRDEC_HL:
  D3DE  AF            		XOR	A
  D3DF                	PRDEC_AHL:
  D3DF  5F            		LD	E,A
  D3E0  1600          		LD	D,0
  D3E2                	PRDEC_DEHL:
  D3E2  D5            		PUSH	DE
  D3E3  110FEF        		LD	DE,DECBF
  D3E6  0605          		LD	B,5
  D3E8  CDE8D4        		CALL	ZERO_MEMORY_DE	;A=0
  D3EB  D1            		POP	DE
                      	
  D3EC  0E20          		LD	C,32
  D3EE                	DEC1:
  D3EE  29            		ADD	HL,HL
  D3EF  EB            		EX	DE,HL
  D3F0  ED6A          		ADC	HL,HL
  D3F2  EB            		EX	DE,HL
  D3F3  E5            		PUSH	HL
  D3F4  2113EF        		LD	HL,DECBF+4
  D3F7  0605          		LD	B,5
  D3F9                	DEC2:
  D3F9  7E            		LD	A,(HL)
  D3FA  8F            		ADC	A,A
  D3FB  27            		DAA
  D3FC  77            		LD	(HL),A
  D3FD  2B            		DEC	HL
  D3FE  10F9          		DJNZ	DEC2
  D400  E1            		POP	HL
  D401  0D            		DEC	C
  D402  20EA          		JR	NZ,DEC1
                      	
  D404  210FEF        		LD	HL,DECBF
  D407  3E20          		LD	A,020H
  D409  0604          		LD	B,4
  D40B                	DEC3:
  D40B  CD18D4        		CALL	DEC4
  D40E  CD18D4        		CALL	DEC4
  D411  23            		INC	HL
  D412  10F7          		DJNZ	DEC3
  D414                	DECX:
  D414  CD18D4        		CALL	DEC4
  D417  AF            		XOR	A
  D418                	DEC4:
  D418  ED6F          		RLD
  D41A  FE20          		CP	020H
  D41C  2802          		JR	Z,DEC5
  D41E  F630          		OR	030H
  D420                	DEC5:
  D420  18B9          		JR	MSG_AR
                      	
  D422                	FPRNT:
  D422  0608          		LD	B,8
  D424  CD35D4        		CALL	P_N1
  D427  7E            		LD	A,(HL)
  D428  C680          		ADD	A,0A0H-020H
  D42A  FEA0          		CP	0A0H
  D42C  2802          		JR	Z,FPR1
  D42E  3E2E          		LD	A,'.'
  D430                	FPR1:
  D430  CD3EDB        		CALL	MSG_A
  D433  0603          		LD	B,3
                      	
  D435                	P_N1:
  D435  C5            		PUSH	BC
  D436  E5            		PUSH	HL
  D437  7E            		LD	A,(HL)
  D438  CD25E3        		CALL	CAP3
  D43B  CD3EDB        		CALL	MSG_A
  D43E  E1            		POP	HL
  D43F  C1            		POP	BC
  D440  23            		INC	HL
  D441  10F2          		DJNZ	P_N1
  D443  C9            		RET
                      	
  D444                	PRTTMS:
  D444  3E20          		LD	A,020H
  D446  CD3EDB        		CALL	MSG_A
                      	
  D449  2A22D6        		LD	HL,(DTA_CCP+1+24)
  D44C  7D            		LD	A,L
  D44D  B7            		OR	A
  D44E  C8            		RET	Z
  D44F  CB3C          		SRL	H
  D451  17            		RLA
  D452  17            		RLA
  D453  17            		RLA
  D454  17            		RLA
  D455  E60F          		AND	00FH
  D457  57            		LD	D,A
  D458  7C            		LD	A,H
  D459  C650          		ADD	A,80
  D45B  CD9ED4        		CALL	PRDEC_A
  D45E  3E2D          		LD	A,'-'
  D460  CD3EDB        		CALL	MSG_A
  D463  7A            		LD	A,D
  D464  CD9ED4        		CALL	PRDEC_A
  D467  3E2D          		LD	A,'-'
  D469  CD3EDB        		CALL	MSG_A
  D46C  7D            		LD	A,L
  D46D  E61F          		AND	01FH
  D46F  CD9ED4        		CALL	PRDEC_A
                      	
  D472  2A20D6        		LD	HL,(DTA_CCP+1+22)
                      	
  D475  3E20          		LD	A,020H
  D477  CD3EDB        		CALL	MSG_A
  D47A  7C            		LD	A,H
  D47B  65            		LD	H,L
  D47C  0603          		LD	B,3
  D47E                	PRTTMS1:
  D47E  1F            		RRA
  D47F  CB1D          		RR	L
  D481  10FB          		DJNZ	PRTTMS1
  D483  E61F          		AND	01FH
  D485  CD9ED4        		CALL	PRDEC_A
  D488  3E3A          		LD	A,':'
  D48A  CD3EDB        		CALL	MSG_A
  D48D  7D            		LD	A,L
  D48E  0F            		RRCA
  D48F  0F            		RRCA
  D490  E63F          		AND	03FH
  D492  CD9ED4        		CALL	PRDEC_A
  D495  3E3A          		LD	A,':'
  D497  CD3EDB        		CALL	MSG_A
  D49A  7C            		LD	A,H
  D49B  E61F          		AND	01FH
  D49D  87            		ADD	A,A
                      	
                      	;	PRINT10
                      	
  D49E                	PRDEC_A:
  D49E  E5            		PUSH	HL
  D49F  0608          		LD	B,8
  D4A1  4F            		LD	C,A
  D4A2  AF            		XOR	A
  D4A3                	PRTA1:
  D4A3  CB01          		RLC	C
  D4A5  8F            		ADC	A,A
  D4A6  27            		DAA
  D4A7  10FA          		DJNZ	PRTA1
  D4A9  210FEF        		LD	HL,DECBF
  D4AC  77            		LD	(HL),A
  D4AD  AF            		XOR	A
  D4AE  CD14D4        		CALL	DECX
  D4B1  E1            		POP	HL
  D4B2  C9            		RET
                      	
  D4B3                	SETFCB:
  D4B3  CDE4E0        		CALL	SPCUT
  D4B6  1A            		LD	A,(DE)
  D4B7  FE20          		CP	020H
  D4B9  3801          		JR	C,SETFCBA
  D4BB  1B            		DEC	DE
  D4BC                	SETFCBA:
  D4BC  0624          		LD	B,36
  D4BE  215C00        		LD	HL,FCB1
  D4C1  E5            		PUSH	HL
  D4C2  AF            		XOR	A
  D4C3  CDB9E0        		CALL	FILL_MEMORY
  D4C6  E1            		POP	HL
  D4C7  D5            		PUSH	DE
  D4C8  CD29DA        		CALL	_SYS5C		;(BDOS)ファイル名の解析
  D4CB  216C00        		LD	HL,FCB2
  D4CE  CD29DA        		CALL	_SYS5C		;(BDOS)ファイル名の解析
  D4D1  E1            		POP	HL
  D4D2  010050        		LD	BC,05000H
  D4D5  118100        		LD	DE,00081H
  D4D8                	SETFCB1:
  D4D8  7E            		LD	A,(HL)
  D4D9  23            		INC	HL
  D4DA  FE20          		CP	020H
  D4DC  3805          		JR	C,SETFCB2
  D4DE  12            		LD	(DE),A
  D4DF  13            		INC	DE
  D4E0  0C            		INC	C
  D4E1  10F5          		DJNZ	SETFCB1
  D4E3                	SETFCB2:
  D4E3  79            		LD	A,C
  D4E4  328000        		LD	(DTA1),A
  D4E7  04            		INC	B
  D4E8                	ZERO_MEMORY_DE:
  D4E8  AF            		XOR	A
  D4E9                	FILL_MEMORY_DE:
  D4E9  12            		LD	(DE),A
  D4EA  13            		INC	DE
  D4EB  10FC          		DJNZ	FILL_MEMORY_DE
  D4ED  C9            		RET
                      	
  D4EE                	C_COPY:
  D4EE  CDB3D4        		CALL	SETFCB
                      	
  D4F1  1161EF        		LD	DE,ZERO
  D4F4  CD05E0        		CALL	FILEC2
  D4F7  216C00        		LD	HL,FCB2
  D4FA  CD30DA        		CALL	S29X1
                      	
  D4FD  3E10          		LD	A,010H
  D4FF  326900        		LD	(FCB1+13),A
  D502  216D00        		LD	HL,FCB2+1
  D505  CDFED5        		CALL	CWILD1
  D508                	COPY0:
  D508  CDFBD5        		CALL	CWILD
  D50B  215C00        		LD	HL,FCB1
  D50E  CDD9D1        		CALL	OPEN
  D511  37            		SCF
  D512                	COPY1:
  D512  C0            		RET	NZ
  D513  CDECD1        		CALL	DEFCB
                      	
  D516  3A16D6        		LD	A,(DTA_CCP+13)
  D519  CB67          		BIT	4,A
  D51B  2821          		JR	Z,COPY1A
                      	
  D51D  215D00        		LD	HL,FCB1+1
  D520  CD48E4        		CALL	CHKWILD
  D523  3814          		JR	C,COPY9
                      	
  D525  3E20          		LD	A,020H
  D527  325D00        		LD	(FCB1+1),A
  D52A  2A23D6        		LD	HL,(DTA_CCP+26)
  D52D  23            		INC	HL
  D52E  226A00        		LD	(FCB1+14),HL
  D531  18D5          		JR	COPY0
                      	
  D533                	COPY8:
  D533  CDE9D7        		CALL	_SYS09		;(BDOS)文字列出力
  D536  CDAAD3        		CALL	LTNL
  D539                	COPY9:
  D539  CDE8D1        		CALL	OPEN2
  D53C  18D4          		JR	COPY1
                      	
  D53E                	COPY1A:
  D53E  216C00        		LD	HL,FCB2
  D541  1114EF        		LD	DE,FDRV
  D544  010BD6        		LD	BC,DTA_CCP+2
  D547  EDA0          		LDI
  D549  3E0B          		LD	A,11
  D54B                	COPY2:
  D54B  F5            		PUSH	AF
  D54C  7E            		LD	A,(HL)
  D54D  FE3F          		CP	'?'
  D54F  2001          		JR	NZ,COPY3
  D551  0A            		LD	A,(BC)
  D552                	COPY3:
  D552  12            		LD	(DE),A
  D553  03            		INC	BC
  D554  13            		INC	DE
  D555  23            		INC	HL
  D556  F1            		POP	AF
  D557  3D            		DEC	A
  D558  20F1          		JR	NZ,COPY2
  D55A  010500        		LD	BC,16-11
  D55D  EDB0          		LDIR
  D55F                	PUTNAME:
  D55F  215D00        		LD	HL,FCB1+1
  D562  CD48E4        		CALL	CHKWILD
  D565  300B          		JR	NC,PUTN1
  D567  2115EF        		LD	HL,FDRV+1
  D56A  CD22D4        		CALL	FPRNT
  D56D  3E20          		LD	A,020H
  D56F  CD3EDB        		CALL	MSG_A
  D572                	PUTN1:
  D572  1114EF        		LD	DE,FDRV
  D575  0E16          		LD	C,016H		;(BDOS)ファイルの作成
  D577  CD07D2        		CALL	SYSTEM0
  D57A  2048          		JR	NZ,COPYE2
  D57C  67            		LD	H,A		;A=0
  D57D  6F            		LD	L,A
  D57E  2235EF        		LD	(FDRV+33),HL	;(FCB)ランダムレコード
  D581  2237EF        		LD	(FDRV+35),HL
  D584                	COPY6:
  D584  CD10D2        		CALL	S27BUF
  D587  47            		LD	B,A
  D588  3C            		INC	A
  D589  2831          		JR	Z,COPYE
  D58B  7C            		LD	A,H
  D58C  B5            		OR	L
  D58D  280C          		JR	Z,COPY7
  D58F  1114EF        		LD	DE,FDRV
  D592  0E26          		LD	C,026H		;(BDOS)ランダムブロック書き込み
  D594  CD07D2        		CALL	SYSTEM0
  D597  2023          		JR	NZ,COPYE
  D599  10E9          		DJNZ	COPY6
  D59B                	COPY7:
  D59B  3A16D6        		LD	A,(DTA_CCP+13)	;(FCB)属性
  D59E  3221EF        		LD	(FDRV+13),A
  D5A1  211DD6        		LD	HL,DTA_CCP+20	;(FCB)タイムスタンプ
  D5A4  1128EF        		LD	DE,FDRV+20
  D5A7  010400        		LD	BC,4
  D5AA  EDB0          		LDIR
                      	
  D5AC  1114EF        		LD	DE,FDRV
  D5AF  0E10          		LD	C,010H		;(BDOS)ファイルのクローズ
  D5B1  CD07D2        		CALL	SYSTEM0
  D5B4  2006          		JR	NZ,COPYE
                      	
  D5B6  1171EF        		LD	DE,OK
  D5B9  C333D5        		JP	COPY8
                      	
  D5BC                	COPYE:
  D5BC  1114EF        		LD	DE,FDRV
  D5BF  0E13          		LD	C,013H		;(BDOS)ファイルの削除
  D5C1  CD0500        		CALL	SYSTEM
  D5C4                	COPYE2:
  D5C4  37            		SCF
  D5C5  C9            		RET
                      	
  D5C6                	C_TYPE:
  D5C6  CDB3D4        		CALL	SETFCB
  D5C9  215C00        		LD	HL,FCB1
  D5CC  CDD9D1        		CALL	OPEN
  D5CF  37            		SCF
  D5D0                	TYPE1:
  D5D0  C0            		RET	NZ
  D5D1  CDECD1        		CALL	DEFCB
  D5D4  3E06          		LD	A,6
  D5D6  CD3EDB        		CALL	MSG_A
  D5D9                	TYPE2:
  D5D9  CD10D2        		CALL	S27BUF
  D5DC  C6FE          		ADD	A,0FEH
  D5DE  D8            		RET	C
  D5DF  7C            		LD	A,H
  D5E0  B5            		OR	L
  D5E1  2813          		JR	Z,TYPEE
  D5E3  010001        		LD	BC,00100H
  D5E6                	TYPE3:
  D5E6  0A            		LD	A,(BC)
  D5E7  03            		INC	BC
  D5E8  FE1A          		CP	01AH
  D5EA  280A          		JR	Z,TYPEE
  D5EC  CD3EDB        		CALL	MSG_A
  D5EF  2B            		DEC	HL
  D5F0  7C            		LD	A,H
  D5F1  B5            		OR	L
  D5F2  20F2          		JR	NZ,TYPE3
  D5F4  18E3          		JR	TYPE2
  D5F6                	TYPEE:
  D5F6  CDE8D1        		CALL	OPEN2
  D5F9  18D5          		JR	TYPE1
                      	
  D5FB                	CWILD:
  D5FB  215D00        		LD	HL,FCB1+1
  D5FE                	CWILD1:
  D5FE  7E            		LD	A,(HL)
  D5FF  FE20          		CP	020H
  D601  C0            		RET	NZ
  D602                	CWILD2:
  D602  3E3F          		LD	A,'?'
  D604  060B          		LD	B,11
  D606  C3B9E0        		JP	FILL_MEMORY
                      	
  D609                	DTA_CCP:
  D609                		DS	37
                      	
  0040                	PATHX	EQU	64
  D62E                	PATHD:	DS	PATHX
  D66E  00            	PATHE:	DB	0
                      	
  D66F  20627974657320	FREE:	DB	" bytes free",9,'$'
  D67C  20202020203C44	DIRMES:	DB	"     <DIR>$"
  D687  20203A24      	DIRHD:	DB	"  :$"
                      	
  D68B                	COMTB:
  D68B  44202020      		DB	"D   "	;1
  D68F  0AD3          		DW	C_DIR
  D691  44495220      		DB	"DIR "	;2
  D695  0AD3          		DW	C_DIR
  D697  434F5059      		DB	"COPY"	;3
  D69B  EED4          		DW	C_COPY
  D69D  43442020      		DB	"CD  "	;4
  D6A1  0CD2          		DW	C_CD
  D6A3  44454C20      		DB	"DEL "	;5
  D6A7  EDD2          		DW	C_DEL
  D6A9  50415448      		DB	"PATH"	;6
  D6AD  AFD3          		DW	C_PATH
  D6AF  52454E20      		DB	"REN "	;7
  D6B3  F7D2          		DW	C_REN
  D6B5  54595045      		DB	"TYPE"	;8
  D6B9  C6D5          		DW	C_TYPE
  D6BB  52454D20      		DB	"REM "	;9
  D6BF  E6D7          		DW	C_REM
                      	
                      	;X1DISK2.ASM
                      	
                      	;	LSX-Dodgers DISK2
                      	;	X1/turbo/Z
                      	
                      	;	GRAPHIC RAM DISK DRIVER
                      	
                      	
  D6C1                	GDRD:
  D6C1  C5            		PUSH	BC
  D6C2  CDEAD6        		CALL	GADR
  D6C5  F1            		POP	AF
  D6C6                	GDRD1:
  D6C6  EDA2          		INI
  D6C8  04            		INC	B
  D6C9  0C            		INC	C
  D6CA  20FA          		JR	NZ,GDRD1
  D6CC  04            		INC	B
  D6CD  13            		INC	DE
  D6CE  3D            		DEC	A
  D6CF  20F5          		JR	NZ,GDRD1
  D6D1                	GBANK0:
  D6D1  3ABFEF        		LD	A,(WK1FD0)
  D6D4  E6EF          		AND	0EFH		;BANK0
  D6D6  181D          		JR	S1FD0
                      	
  D6D8                	GDWT:
  D6D8  C5            		PUSH	BC
  D6D9  CDEAD6        		CALL	GADR
  D6DC  F1            		POP	AF
  D6DD                	GDWT1:
  D6DD  04            		INC	B
  D6DE  EDA3          		OUTI
  D6E0  0C            		INC	C
  D6E1  20FA          		JR	NZ,GDWT1
  D6E3  04            		INC	B
  D6E4  13            		INC	DE
  D6E5  3D            		DEC	A
  D6E6  20F5          		JR	NZ,GDWT1
  D6E8  18E7          		JR	GBANK0
                      	
  D6EA                	GADR:
  D6EA  0E00          		LD	C,0
  D6EC  7B            		LD	A,E
  D6ED  C640          		ADD	A,040H
  D6EF  47            		LD	B,A
  D6F0  3ABFEF        		LD	A,(WK1FD0)
  D6F3  F610          		OR	010H		;BANK1
  D6F5                	S1FD0:
  D6F5  C5            		PUSH	BC
  D6F6  32BFEF        		LD	(WK1FD0),A
  D6F9  01D01F        		LD	BC,01FD0H
  D6FC  ED79          		OUT	(C),A
  D6FE  C1            		POP	BC
  D6FF  C9            		RET
                      	
                      	
                      	;	BANK RAM DISK DRIVER
                      	
  D700                	BDWT:
  D700  3E            		DB	03EH	;LD A,??
  D701  37            		SCF
  D702  1802          		JR	BRW
                      	
  D704                	BDRD:
  D704  3E            		DB	03EH	;LD A,??
  D705  A7            		AND	A
  D706                	BRW:
  D706  F3            		DI
  D707  3232D7        		LD	(BRWPAT),A
  D70A  ED7352D7      		LD	(BANKSP+1),SP
  D70E  3A53D7        		LD	A,(BANKSP+2)
  D711  87            		ADD	A,A
  D712  3803          		JR	C,BRW0
  D714  31CAFF        		LD	SP,EXTSP
  D717                	BRW0:
  D717  D9            		EXX		;裏レジスタ
  D718  C5            		 PUSH	 BC
  D719  D5            		 PUSH	 DE
  D71A  01000B        		 LD	 BC,00B00H	 ;バンクメモリ
  D71D  111010        		 LD	 DE,01010H
  D720  D9            		 EXX		;表レジスタ
  D721                	BRW1:
  D721  C5            		PUSH	BC
  D722  D5            		PUSH	DE
  D723  EB            		EX	DE,HL
  D724  29            		ADD	HL,HL
  D725  29            		ADD	HL,HL
  D726  7C            		LD	A,H
  D727  DD860C        		ADD	A,(IX+00CH)	;DPB_0C_MAXCYL
  D72A  E60F          		AND	00FH	;バンク
  D72C  65            		LD	H,L
  D72D  CB3C          		SRL	H	;/2
  D72F  2E00          		LD	L,0
  D731  D9            		EXX		;裏レジスタ
  D732  A7            	BRWPAT:	 AND	 A	;自己書き換え(AND A:読み出し/SCF:書き込み)
  D733  3808          		 JR	 C,BRWT
  D735  57            		 LD	 D,A	 ;D=バンク
  D736  D9            		 EXX		;表レジスタ
  D737  EB            		EX	DE,HL
  D738  CD56D7        		CALL	BTFR
  D73B  1806          		JR	BRW2
  D73D                	BRWT:
  D73D  5F            		 LD	E,A	 ;E=バンク
  D73E  D9            		 EXX		;表レジスタ
  D73F  CD56D7        		CALL	BTFR
  D742  EB            		EX	DE,HL
  D743                	BRW2:
  D743  D1            		POP	DE
  D744  C1            		POP	BC
  D745  13            		INC	DE
  D746  10D9          		DJNZ	BRW1
                      	
  D748  D9            		EXX		;裏レジスタ
  D749  3E10          		 LD	 A,10H
  D74B  ED79          		 OUT	 (C),A		;メインメモリに切り替える
  D74D  D1            		 POP	 DE
  D74E  C1            		 POP	 BC
  D74F  D9            		 EXX		;表レジスタ
  D750  AF            		XOR	A
  D751  310000        	BANKSP:	LD	SP,0
  D754  FB            		EI
  D755  C9            		RET
                      	
                      	;メインメモリ←→バンクメモリ 512バイトの転送を行う
                      	; DE:転送元アドレス
                      	; HL:転送先アドレス
                      	; 裏BC:バンク切り替えポート(0B00H)
                      	; 裏D:転送元バンク(0-0FH:10Hはメインメモリ)
                      	; 裏E:転送先バンク(0-0FH:10Hはメインメモリ)
                      	
  D756                	BTFR:
  D756  0600          		LD	B,0	;256回ループ(256*2)
  D758                	BTFR1:
  D758  D9            		EXX		;裏レジスタ
  D759  ED51          		 OUT	 (C),D	 ;BANK(MAIN)
  D75B  D9            		 EXX		;表レジスタ
  D75C  1A            		LD	A,(DE)
  D75D  4F            		LD	C,A
  D75E  13            		INC	DE
  D75F  1A            		LD	A,(DE)
  D760  13            		INC	DE
  D761  D9            		EXX		;裏レジスタ
  D762  ED59          		 OUT	 (C),E	 ;MAIN(BANK)
  D764  D9            		 EXX		;表レジスタ
  D765  71            		LD	(HL),C
  D766  23            		INC	HL
  D767  77            		LD	(HL),A
  D768  23            		INC	HL
  D769  10ED          		DJNZ	BTFR1
  D76B  C9            		RET
                      	
                      	;	EMM DRIVER(DMA)
                      	
                      	
  D76C                	EDWT:
  D76C  0E0F          		LD	C,15
  D76E  1802          		JR	EDWT1
  D770                	EDRD:
  D770  0E0E          		LD	C,14
  D772                	EDWT1:
  D772  C5            		PUSH	BC
  D773  D5            		PUSH	DE
  D774  22B4D7        		LD	(DMAB),HL
  D777  78            		LD	A,B
  D778  87            		ADD	A,A
  D779  3D            		DEC	A
  D77A  32ADD7        		LD	(DMALEN+1),A
  D77D  3C            		INC	A
  D77E  84            		ADD	A,H	;HL(アドレス)を先に進めておく
  D77F  67            		LD	H,A
  D780  EB            		EX	DE,HL
  D781  29            		ADD	HL,HL
  D782  DD460C        		LD	B,(IX+00CH)	;DPB_0C_MAXCYL
  D785  79            		LD	A,C
  D786  DD4E0D        		LD	C,(IX+00DH)	;DPB_0D_MAXSEC
  D789  09            		ADD	HL,BC
  D78A  DD4E13        		LD	C,(IX+013H)	;DPB_13_UNITNO
  D78D  060D          		LD	B,00DH
  D78F  ED49          		OUT	(C),C
  D791  0C            		INC	C
  D792  ED69          		OUT	(C),L
  D794  0C            		INC	C
  D795  ED61          		OUT	(C),H
                      	
  D797  21A8D7        		LD	HL,EDMAD
  D79A  CD17DF        		CALL	SETDMA
  D79D  CD3FDF        		CALL	GO_DMA
  D7A0  EB            		EX	DE,HL
  D7A1  D1            		POP	DE
  D7A2  C1            		POP	BC
  D7A3                	DMA_ADD_SEC:
  D7A3  13            		INC	DE
  D7A4  10FD          		DJNZ	DMA_ADD_SEC
  D7A6  AF            		XOR	A
  D7A7  C9            		RET
                      	
  D7A8                	EDMAD:
  D7A8  C3            		DB	0C3H	;WR6 リセット
  D7A9  7D            		DB	07DH	;WR0 ポートA→ポートB 転送
  D7AA  030D          		DW	00D03H	;ポートA開始アドレス EMMリード/ライト
  D7AC  FF01          	DMALEN:	DW	001FFH	;ブロック長(転送サイズ-1)
  D7AE  2C            		DB	02CH	;WR1 ポートAアドレス固定 I/O
  D7AF  50            		DB	050H	;WR2 ポートBアドレスインクリメント メモリ
  D7B0  02            		DB	002H	;ポートBタイミング
  D7B1  80            		DB	080H	;WR3
  D7B2  9A            		DB	09AH	;WR5 WAIT RDY:HIGH
  D7B3  AD            		DB	0ADH	;WR4 連続 ポートB開始アドレス
  D7B4  0000          	DMAB:	DW	0
  D7B6  01            		DB	001H	;WR0 ポートA←ポートB 転送
  D7B7                	EMME:
                      	
  0721                	AT_RE	EQU	EDWT-AT_EDWT
                      	
                      	
                      	;LDOS.ASM
                      	
                      	;	LSX-Dodgers OS
                      	
  D7B7                	BDOS0:
  D7B7  E5            		PUSH	HL
  D7B8  79            		LD	A,C
  D7B9  FE3C          		CP	03CH
  D7BB  3802          		JR	C,DOS1
  D7BD  3E3C          		LD	A,03CH
  D7BF                	DOS1:
  D7BF  87            		ADD	A,A
  D7C0  6F            		LD	L,A
  D7C1  26F0          		LD	H,STABLE/256
  D7C3  7E            		LD	A,(HL)
  D7C4  2C            		INC	L
  D7C5  66            		LD	H,(HL)
  D7C6  6F            		LD	L,A
  D7C7  E3            		EX	(SP),HL
  D7C8  79            		LD	A,C
                      	;確認用
                      	;	LD	(0050H),A
  D7C9  C9            		RET
  D7CA                	_DOS2:
  D7CA  FE5A          		CP	05AH		;(BDOS)カレントディレクトリの変更(_CHDIR)
  D7CC  CA6DDA        		JP	Z,_SYS5A
  D7CF  FE5C          		CP	05CH		;(BDOS)ファイル名の解析(_PFILE)
  D7D1  CA29DA        		JP	Z,_SYS5C
  D7D4  FE5F          		CP	05FH		;(BDOS)ディスクバッファのフラッシュ(_FLUSH)
  D7D6  CA7BED        		JP	Z,_SYS5F
  D7D9  FE6F          		CP	06FH		;(BDOS)MSX-DOS のバージョン番号の獲得(_DOSVER)
  D7DB  200A          		JR	NZ,_ERROR
  D7DD  011D01        		LD	BC,011DH
  D7E0  115101        		LD	DE,VER
  D7E3  210000        		LD	HL,MACD
  D7E6                	C_REM:
  D7E6  AF            		XOR	A
  D7E7                	_ERROR:
  D7E7  A7            		AND	A
  D7E8  C9            		RET
                      	
  D7E9                	_SYS09:		;文字列出力
  D7E9  D5            		PUSH	DE
  D7EA                	_SX09:
  D7EA  1A            		LD	A,(DE)
  D7EB  13            		INC	DE
  D7EC  FE24          		CP	'$'
  D7EE  2831          		JR	Z,SX0E2
  D7F0  CD3EDB        		CALL	MSG_A
  D7F3  18F5          		JR	_SX09
                      	
  D7F5                	MSX1:
  D7F5  CD3EDB        		CALL	MSG_A
  D7F8                	MSX:
  D7F8  7E            		LD	A,(HL)
  D7F9  23            		INC	HL
  D7FA  B7            		OR	A
  D7FB  20F8          		JR	NZ,MSX1
  D7FD  C9            		RET
                      	
  D7FE                	_SYS0C:		;(BDOS)バージョン番号の獲得
  D7FE  212200        		LD	HL,00022H
  D801  7D            		LD	A,L
  D802  C9            		RET
                      	
  D803                	_SYS0D:		;(BDOS)ディスクリセット
  D803  CDDFEF        		CALL	_FFLUSH
  D806  E5            		PUSH	HL
  D807  218000        		LD	HL,00080H
  D80A  228AEF        		LD	(_DTA),HL
  D80D  E1            		POP	HL
  D80E  D5            		PUSH	DE
  D80F  1E00          		LD	E,0
  D811  3E            		DB	03EH
                      	
  D812                	_SYS0E:		;(BDOS)カレントドライブの設定
  D812  D5            		PUSH	DE
  D813  7B            		LD	A,E
  D814  DDE5          		PUSH	IX
  D816  CDDCEF        		CALL	_GETDPB
  D819  DDE1          		POP	IX
  D81B  3804          		JR	C,SX0E2
  D81D  7B            		LD	A,E
  D81E  3287EF        		LD	(_DVSW),A
  D821                	SX0E2:
  D821  3E08          		LD	A,8
  D823  D1            		POP	DE
  D824  C9            		RET
                      	
  D825                	_SYS0F:		;(BDOS)ファイルのオープン
  D825  CDF6E0        		CALL	SETDRV
  D828  FD7E1C        		LD	A,(IY+28)	;(FCB)オープンモード
  D82B  C602          		ADD	A,002H		;Write
  D82D  2848          		JR	Z,FEND0F
  D82F  CD44E4        		CALL	CHKWILDX
                      	
  D832  D416E1        		CALL	NC,SOPENX
  D835                	_S16XX:
  D835  3840          		JR	C,FEND0F
                      					;Directory location
  D837  3A9FEF        		LD	A,(_FILEN)
  D83A  FD7719        		LD	(IY+25),A	;(FCB)ディレクトリロケーション
                      	;				_DIRF
  D83D  3AA0EF        		LD	A,(_DIRF)
  D840  FD771D        		LD	(IY+29),A	;(FCB)ディレクトリモード
                      	;				_FBPS
  D843  FD731E        		LD	(IY+30),E	;(FCB)ディレクトリポジション
  D846  FD721F        		LD	(IY+31),D
                      	;				Open(Read)
  D849  FD361CFF      		LD	(IY+28),0FFH	;(FCB)オープンモード
                      	;				FILENAME
  D84D  FDE5          		PUSH	IY
  D84F  D1            		POP	DE
  D850  13            		INC	DE
  D851  010B00        		LD	BC,11
  D854  EDB0          		LDIR
                      	;				Attribute
  D856  7E            		LD	A,(HL)
  D857  FD770D        		LD	(IY+13),A	;(FCB)属性(アトリビュート)
  D85A  110B00        		LD	DE,11		;Reserved
  D85D  19            		ADD	HL,DE
                      						;(FCB)ファイルを最後に変更した時刻
  D85E  11EAF0        		LD	DE,SDDATA		;(FCB)ファイルを最後に変更した日付
  D861  060A          		LD	B,SDDATAE-SDDATA	;(FCB)ファイルの先頭クラスタ
  D863                	S16LOOP:				;(FCB)ファイルのサイズ(バイト単位)
  D863  1A            		LD	A,(DE)
  D864  13            		INC	DE
  D865  326CD8        		LD	(S16PAT+2),A
  D868  7E            		LD	A,(HL)
  D869  23            		INC	HL
  D86A  FD7700        	S16PAT:	LD	(IY+0),A
  D86D  10F4          		DJNZ	S16LOOP
                      	
  D86F  AF            		XOR	A
  D870  FD770C        		LD	(IY+12),A	;(FCB)カレントブロック
  D873  FD221BD9      		LD	(OFCB+1),IY
  D877                	FEND0F:
  D877  1845          		JR	FEND10
                      	
  D879                	_SYS10:		;(BDOS)ファイルのクローズ
  D879  CDF6E0        		CALL	SETDRV
  D87C  FD7E1C        		LD	A,(IY+28)	;(FCB)オープンモード
  D87F  D6FE          		SUB	0FEH
  D881  37            		SCF
  D882  3F            		CCF
  D883  2039          		JR	NZ,FEND10
  D885                	_S10A:				;Write
  D885  FD770E        		LD	(IY+14),A	;(FCB)レコードサイズ/アクセスするディレクトリのクラスタ番号+1
  D888  FD770F        		LD	(IY+15),A
                      	
  D88B  FD341C        		INC	(IY+28)		;0FEH->0FFH ;オープンモード
  D88E  CD3CE5        		CALL	SETTMS
                      	
  D891  FD7E1D        		LD	A,(IY+29)	;(FCB)ディレクトリモード
  D894  32A0EF        		LD	(_DIRF),A
  D897  E67F          		AND	07FH
  D899  3285EA        		LD	(_SECPS+1),A
  D89C  FD5E1E        		LD	E,(IY+30)	;(FCB)ディレクトリポジション
  D89F  FD561F        		LD	D,(IY+31)
  D8A2  CD4AE2        		CALL	READ_DIR
  D8A5  3817          		JR	C,FEND10
                      	
  D8A7  3A74E1        	SDECM1:	LD	A,(SDECPAT+1)	;1セクタ辺りのディレクトリエントリ数
  D8AA  3D            	 	DEC	A		;1024=01FH / 512=00FH / 256=7
  D8AB  FDA619        		AND	(IY+25)		;(FCB)ディレクトリロケーション
  D8AE  6F            		LD	L,A
  D8AF  2600          		LD	H,0
  D8B1  29            		ADD	HL,HL		;*2
  D8B2  29            		ADD	HL,HL		;*4
  D8B3  29            		ADD	HL,HL		;*8
  D8B4  29            		ADD	HL,HL		;*16
  D8B5  29            		ADD	HL,HL		;*32
  D8B6  ED4B7EF0      		LD	BC,(_DTBUF)
  D8BA  09            		ADD	HL,BC
                      	
  D8BB  CD54E4        		CALL	SDIRENT
  D8BE                	FEND10:
  D8BE  1842          		JR	FEND
                      	
  D8C0                	_SYS11:		;(BDOS)最初のファイルの検索
  D8C0  CDF6E0        		CALL	SETDRV
  D8C3  CD43E1        		CALL	SOPEN
  D8C6                	_S12X1:
  D8C6  383A          		JR	C,FEND
  D8C8  CDE3E1        		CALL	SOPENE2
  D8CB  ED5B8AEF      		LD	DE,(_DTA)
  D8CF  3A88EF        		LD	A,(_DRV)
  D8D2  3C            		INC	A
  D8D3  12            		LD	(DE),A
  D8D4  D5            		PUSH	DE
  D8D5  13            		INC	DE
  D8D6  012000        		LD	BC,32
  D8D9  EDB0          		LDIR
  D8DB  FD6E0E        		LD	L,(IY+14)	;(FCB)レコードサイズ/アクセスするディレクトリのクラスタ番号+1
  D8DE  FD660F        		LD	H,(IY+15)
  D8E1  22F4F0        		LD	(SCDIR),HL
  D8E4  2A9AEF        		LD	HL,(_FBPS)
  D8E7  22F6F0        		LD	(SFBPS),HL
  D8EA  2A9FEF        		LD	HL,(_FILEN)
  D8ED  7C            		LD	A,H
  D8EE  B7            		OR	A
  D8EF  2806          		JR	Z,_S12DIR
  D8F1  3A85EA        		LD	A,(_SECPS+1)
  D8F4  F680          		OR	080H
  D8F6  67            		LD	H,A
  D8F7                	_S12DIR:
  D8F7  22F8F0        		LD	(SFNDF),HL	;Directory position and Flags
  D8FA  E1            		POP	HL
  D8FB  1139EF        		LD	DE,SFILE
  D8FE  0E21          		LD	C,33
  D900                	_S11B:
  D900  EDB0          		LDIR
  D902                	FEND:
  D902  9F            		SBC	A,A		;CF=0 A=0 : CF=1 A=0FFH
  D903                	FENDE:
  D903  FDE1          		POP	IY
  D905  C1            		POP	BC
  D906  D1            		POP	DE
  D907  E1            		POP	HL
  D908  C9            		RET
                      	
  D909                	_SYS12:		;(BDOS)次のファイルの検索
  D909  E5            		PUSH	HL
  D90A  D5            		PUSH	DE
  D90B  C5            		PUSH	BC
  D90C  FDE5          		PUSH	IY
  D90E  CDA7E1        		CALL	NOPEN
  D911  18B3          		JR	_S12X1
                      	
  D913                	_S16K:
  D913  FD7E1C        		LD	A,(IY+28)	;(FCB)オープンモード
  D916  FEFD          		CP	0FDH		;Device(0FDH)
  D918  37            		SCF
  D919  C8            		RET	Z
                      	
  D91A  110000        	OFCB:	LD	DE,0
  D91D  D5            		PUSH	DE
  D91E  061A          		LD	B,26		;First cluster
  D920                	S16K1:
  D920  13            		INC	DE
  D921  23            		INC	HL
  D922  10FC          		DJNZ	S16K1
                      	
  D924  1A            		LD	A,(DE)
  D925  BE            		CP	(HL)
  D926  2013          		JR	NZ,S16K2
  D928  13            		INC	DE
  D929  23            		INC	HL
  D92A  1A            		LD	A,(DE)
  D92B  BE            		CP	(HL)
  D92C  200D          		JR	NZ,S16K2
                      	
  D92E  E1            		POP	HL
  D92F  FDE5          		PUSH	IY
  D931  D1            		POP	DE
  D932  1A            		LD	A,(DE)		;Drive
  D933  BE            		CP	(HL)
  D934  2006          		JR	NZ,S16K3
                      					;ここはCFが必ず0
  D936  ED52          		SBC	HL,DE		;CP HL,DE
  D938  37            		SCF
  D939  C0            		RET	NZ
  D93A  E5            		PUSH	HL
  D93B                	S16K2:
  D93B  E1            		POP	HL
  D93C                	S16K3:
  D93C  FDE5          		PUSH	IY
  D93E  D1            		POP	DE
  D93F                	_SYS13:		;(BDOS)ファイルの削除
  D93F  CDF6E0        		CALL	SETDRV
  D942  CD74E3        		CALL	KILL
  D945                	FEND13:
  D945  18BB          		JR	FEND
                      	
  D947                	_SYS14:		;(BDOS)シーケンシャルな読み出し
  D947  CDF6E0        		CALL	SETDRV
  D94A  CDA8E5        		CALL	INIT_SEQ
  D94D                	SREAD:
  D94D  CDF2E5        		CALL	RB_READ
                      	
  D950  C601          		ADD	A,001H
  D952  38AE          		JR	C,FEND
                      	
  D954  7D            		LD	A,L
  D955  D601          		SUB	001H
  D957                	FENDX:
  D957  9F            		SBC	A,A
  D958  E603          		AND	3
  D95A  1F            		RRA
  D95B  18A6          		JR	FENDE
                      	
  D95D                	_SYS15:		;(BDOS)シーケンシャルな書き込み
  D95D  CDF6E0        		CALL	SETDRV
  D960  CDA8E5        		CALL	INIT_SEQ
  D963                	SWRITE:
  D963  CDEBE5        		CALL	RB_WRITE
                      	
  D966  C6FF          		ADD	A,0FFH
  D968  18ED          		JR	FENDX
                      	
  D96A                	_SYS17:		;(BDOS)ファイル名の変更
  D96A  CDF6E0        		CALL	SETDRV
  D96D  CDCAE3        		CALL	NAME
  D970  18D3          		JR	FEND13
                      	
  D972                	_SYS16:		;(BDOS)ファイルの作成
  D972  CDF6E0        		CALL	SETDRV
                      	
  D975  CD44E4        		CALL	CHKWILDX
  D978  38CB          		JR	C,FEND13
  D97A  FD7E01        		LD	A,(IY+1)	;(FCB)主ファイル名
  D97D  FE05          		CP	5
  D97F  2805          		JR	Z,_S16X2
  D981  FE21          		CP	021H
  D983  DA45D9        		JP	C,FEND13
  D986                	_S16X2:
                      	;				Clear FCB
  D986  FDE5          		PUSH	IY
  D988  E1            		POP	HL
  D989  011000        		LD	BC,16
  D98C  09            		ADD	HL,BC
  D98D                	_S16X1:
  D98D  70            		LD	(HL),B		;B=0
  D98E  23            		INC	HL
  D98F  0D            		DEC	C
  D990  20FB          		JR	NZ,_S16X1
                      	
  D992  CD41E5        		CALL	SETTMSX
  D995  FD360DFF      		LD	(IY+13),0FFH	;(FCB)Attribute
  D999  CD16E1        		CALL	SOPENX
  D99C  3F            		CCF
  D99D  CC13D9        		CALL	Z,_S16K
  D9A0  D4F4E1        		CALL	NC,COPEN
  D9A3  D454E4        		CALL	NC,SDIRENT
  D9A6  C335D8        		JP	_S16XX
                      	
  D9A9                	_SYS21:		;(BDOS)ランダムな読み出し
  D9A9  CDF6E0        		CALL	SETDRV
  D9AC  CD8CE5        		CALL	INIT_RND
  D9AF  189C          		JR	SREAD
                      	
  D9B1                	_SYS22:		;(BDOS)ランダムな書き込み
  D9B1                	_SYS28:		;(BDOS)ランダムな書き込み・その2
  D9B1  CDF6E0        		CALL	SETDRV
  D9B4  CD8CE5        		CALL	INIT_RND
  D9B7  18AA          		JR	SWRITE
                      	
  D9B9                	_SYS18:		;(BDOS)ログインベクトルの獲得
  D9B9  21FF00        		LD	HL,000FFH
  D9BC  AF            		XOR	A
  D9BD  C9            		RET
                      	
  D9BE                	_SYS19:		;(BDOS)カレントドライブ番号の獲得
  D9BE  3A87EF        		LD	A,(_DVSW)
  D9C1  A7            		AND	A
  D9C2  C9            		RET
                      	
  D9C3                	_SYS1A:		;(BDOS)DTAの設定
  D9C3  ED538AEF      		LD	(_DTA),DE
  D9C7  AF            		XOR	A
  D9C8  C9            		RET
                      	
  D9C9                	_SYS1B:		;(BDOS)ディスク情報の獲得
  D9C9  7B            		LD	A,E
  D9CA  CD09E1        		CALL	GETDRV
  D9CD  CDDCEF        		CALL	_GETDPB
  D9D0  D4E2EF        		CALL	NC,_RDFATX
  D9D3  210000        		LD	HL,0
  D9D6  D41AE5        		CALL	NC,DSKF
                      	
  D9D9  ED5B1BE5      		LD	DE,(MAXCLP+1)	;DPB_08_MAXCL-1
  D9DD  1B            		DEC	DE		;DE←クラスタの総数
  D9DE  FD2A7CF0      		LD	IY,(_FATBF)	;IY←メモリ上のFATの先頭アドレス
  D9E2  9F            		SBC	A,A
  D9E3  D8            		RET	C
  D9E4  4F            		LD	C,A		;C=0
  D9E5  DD7E0F        		LD	A,(IX+00FH)	;DPB_0F_BPS
  D9E8  E60F          		AND	00FH
  D9EA  47            		LD	B,A
  D9EB  DD7E07        		LD	A,(IX+7)	;DPB_07_SECPCL
  D9EE  C9            		RET
                      	
  D9EF                	_SYS1D:		;(BDOS)書き込みが禁止されているディスクの調査
  D9EF  AF            		XOR	A
  D9F0  67            		LD	H,A
  D9F1  6F            		LD	L,A
  D9F2  C9            		RET
                      	
  D9F3                	_SYS1F:		;(BDOS)ディスク装置のパラメータの読み出し
  D9F3  2100F1        		LD	HL,DEVICE
  D9F6  7B            		LD	A,E
  D9F7  C3DCEF        		JP	_GETDPB
                      	
  D9FA                	_SYS23:		;(BDOS)ファイルサイズの獲得
  D9FA  E5            		PUSH	HL
  D9FB  2A1EF0        		LD	HL,(STABLE+2*00FH)	;ファイルのオープン
  D9FE  CD0F00        		CALL	JP_HL
  DA01  381B          		JR	C,_S23X1
                      	
  DA03  D5            		PUSH	DE		;EX DE,IY
  DA04  FDE3          		EX	(SP),IY		;
                      	;	POP	DE		;
                      	;	PUSH	DE		;DEを破壊しないように注意vv
  DA06  FD7E10        		LD	A,(IY+16)	;(FCB)ファイルのサイズ(バイト単位)
  DA09  FD6E11        		LD	L,(IY+17)	;
  DA0C  FD6612        		LD	H,(IY+18)	;
  DA0F  C5            		PUSH	BC		;
  DA10  FD4613        		LD	B,(IY+19)	;
  DA13  CD7EE5        		CALL	GET_CPM_R_SIZE
  DA16  C1            		POP	BC
  DA17                	_S24X1:
  DA17  CD9EE5        		CALL	SET_RR_AHL
                      	;	POP	DE		;^^^^^^^^^^^^^^^^^^^^^^^^
                      	;	PUSH	DE		;EX DE,IY
  DA1A  FDE3          		EX	(SP),IY		;
  DA1C  D1            		POP	DE		;
                      	
  DA1D  AF            		XOR	A
  DA1E                	_S23X1:
  DA1E  E1            		POP	HL
  DA1F  C9            		RET
                      	
  DA20                	_SYS24:		;(BDOS)ランダムレコードフィールドの設定
  DA20  E5            		PUSH	HL
  DA21  D5            		PUSH	DE		;EX DE,IY
  DA22  FDE3          		EX	(SP),IY		;
                      	;	POP	DE		;
                      	;	PUSH	DE		;DEを破壊しないように注意vv
  DA24  CDB0E5        		CALL	GETSEQ
  DA27  18EE          		JR	_S24X1		;^^^^^^^^^^^^^^^^^^^^^^^^
                      	
  DA29                	_SYS5C:		;(BDOS)ファイル名の解析
  DA29  C5            		PUSH	BC
  DA2A  E5            		PUSH	HL
  DA2B  CD0DE0        		CALL	FILE
  DA2E  E1            		POP	HL
  DA2F  C1            		POP	BC
  DA30                	S29X1:
  DA30  C5            		PUSH	BC
  DA31  D5            		PUSH	DE
  DA32  E5            		PUSH	HL
  DA33  EB            		EX	DE,HL
  DA34  2114EF        		LD	HL,FDRV
  DA37  010D00        		LD	BC,13
  DA3A  EDB0          		LDIR
  DA3C  70            		LD	(HL),B		;B=0
  DA3D  0E03          		LD	C,3
  DA3F  EDB0          		LDIR
  DA41  E1            		POP	HL
  DA42  D1            		POP	DE
  DA43  C1            		POP	BC
  DA44  AF            		XOR	A
  DA45  C9            		RET
                      	
  DA46                	_SYS30:		;(BDOS)論理セクタを用いた書き込み
  DA46  C5            		PUSH	BC
  DA47  011FEC        		LD	BC,DWT24B
  DA4A  1804          		JR	S2FX
  DA4C                	_SYS2F:
  DA4C  C5            		PUSH	BC
  DA4D  010FEC        		LD	BC,DRD24B
  DA50                	S2FX:
  DA50  ED4366DA      		LD	(S2FPAT+1),BC
  DA54  CDDFEF        		CALL	_FFLUSH
                      	
  DA57  D5            		PUSH	DE
  DA58  E5            		PUSH	HL
  DA59  7D            		LD	A,L		;Drive
  DA5A  CDD9EF        		CALL	_CHGDRV
  DA5D  3809          		JR	C,S30X2
  DA5F  44            		LD	B,H		;Number of clusters
  DA60  2A8AEF        		LD	HL,(_DTA)
                      	
  DA63  0E00          		LD	C,0
  DA65  CD0FEC        	S2FPAT:	CALL	DRD24B
  DA68                	S30X2:
  DA68  E1            		POP	HL
  DA69  D1            		POP	DE
  DA6A  C1            		POP	BC
  DA6B  9F            		SBC	A,A
  DA6C  C9            		RET
                      	
  DA6D                	_SYS5A:		;(BDOS)カレントディレクトリの変更
  DA6D  C5            		PUSH	BC
  DA6E  D5            		PUSH	DE
  DA6F  E5            		PUSH	HL
  DA70  CD02E0        		CALL	FILEC
  DA73  210000        		LD	HL,0
  DA76  1114EF        		LD	DE,FDRV
  DA79  2A4EF0        		LD	HL,(STABLE+2*027H)	;ランダムブロック読み込み
  DA7C  CD0F00        		CALL	JP_HL
  DA7F  18E7          		JR	S30X2
                      	
                      	;X1IO.ASM
                      	
                      	;	LSX-Dodgers IO
                      	;	X1/turbo/Z
                      	
  D7E7                	_SYS04	EQU	_ERROR		;(BDOS)外部出力
  D7E7                	_SYS05	EQU	_ERROR		;(BDOS)プリンタ出力
  D7E7                	_SYS1C	EQU	_ERROR		;(BDOS)ディスクの書き込み禁止化
  D7E7                	_SYS1E	EQU	_ERROR		;(BDOS)ファイル属性の設定
  D7E7                	_SYS20	EQU	_ERROR		;(BDOS)利用者番号の設定と読み出し
  D7E7                	_SYS2E	EQU	_ERROR		;(BDOS)ベリファイ・フラグの設定
                      	
  DA81                	BIOS:
  DA81  CD89DA        		CALL	BIOS3
  DA84  061E          		LD	B,01EH
  DA86  ED79          		OUT	(C),A
  DA88  C9            		RET
  DA89                	BIOS3:
  DA89  C5            		PUSH	BC
  DA8A  061D          		LD	B,01DH
  DA8C  ED79          		OUT	(C),A
  DA8E  C9            		RET
                      	
  DA8F                	INT:
  DA8F  F5            		PUSH	AF
  DA90  E5            		PUSH	HL
  DA91  C5            		PUSH	BC
                      	
  DA92  CD46DE        		CALL	IN49SB
  DA95  67            		LD	H,A
  DA96  CD46DE        		CALL	IN49SB
  DA99  6F            		LD	L,A
                      	
  DA9A  FE08          		CP	8		;DELキー
  DA9C  2005          		JR	NZ,SCEXE
  DA9E  7C            		LD	A,H
  DA9F  E611          		AND	011H		;CTRLキー + GRAPHキー
  DAA1  280C          		JR	Z,RESET
  DAA3                	SCEXE:
  DAA3  2292EF        		LD	(_KEYD),HL
  DAA6  CDDBDA        		CALL	KEYSET1
                      	
  DAA9  C1            		POP	BC
  DAAA                	INTPE:
  DAAA  E1            		POP	HL
  DAAB                	INTPE2:
  DAAB  F1            		POP	AF
  DAAC                	INTCTCE:
  DAAC  FB            		EI
  DAAD  ED4D          		RETI
                      	
  DAAF                	RESET:
  DAAF  3E1D          		LD	A,01DH
  DAB1  D300          		OUT	(0),A
  DAB3  C7            		RST	0
                      	
  DAB4                	INTCTC2:
  DAB4  F5            		PUSH	AF
  DAB5  3E00          	INTCPAT:LD	A,000H
  DAB7  3D            		DEC	A
  DAB8  32B6DA        		LD	(INTCPAT+1),A
  DABB  20EE          		JR	NZ,INTPE2
                      	
  DABD  3A92EF        		LD	A,(_KEYD)
  DAC0  B7            		OR	A
  DAC1  28E8          		JR	Z,INTPE2
  DAC3                	KEYSET0:
  DAC3  E5            		PUSH	HL
  DAC4  2A90EF        		LD	HL,(_KEYPS)
  DAC7  7C            		LD	A,H
  DAC8  AD            		XOR	L
  DAC9  2006          		JR	NZ,INTC2A
                      	
  DACB  2A92EF        		LD	HL,(_KEYD)
  DACE  CD0FDB        		CALL	KEYSET
  DAD1                	INTC2A:
  DAD1  3A94EF        		LD	A,(_KEYSP)
  DAD4  E60F          		AND	00FH
  DAD6  32B6DA        		LD	(INTCPAT+1),A
                      	
  DAD9  18CF          		JR	INTPE
                      	
  DADB                	KEYSET1:
  DADB  CB6C          		BIT	5,H
  DADD  F5            		PUSH	AF
  DADE  ED4B8CEF      		LD	BC,(_CTC)
  DAE2  78            		LD	A,B
  DAE3  B1            		OR	C
  DAE4  2006          		JR	NZ,KEYS10E
                      	
  DAE6  F1            		POP	AF
  DAE7  2026          		JR	NZ,KEYSET
  DAE9  F5            		PUSH	AF
  DAEA  18D7          		JR	KEYSET0
  DAEC                	KEYS10E:
  DAEC  F1            		POP	AF
  DAED  C8            		RET	Z
  DAEE  F5            		PUSH	AF
  DAEF  3E03          		LD	A,3		;CTC STOP
  DAF1  ED79          		OUT	(C),A
  DAF3  F1            		POP	AF
                      	
  DAF4  B7            		OR	A
  DAF5  C8            		RET	Z
                      	
  DAF6  3EA7          		LD	A,0A7H
  DAF8  ED79          		OUT	(C),A
  DAFA  3A94EF        		LD	A,(_KEYSP)
  DAFD  ED79          		OUT	(C),A
  DAFF  79            		LD	A,C
  DB00  E6FC          		AND	0FCH
  DB02  4F            		LD	C,A
  DB03  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  DB05  3EC0          		LD	A,CTC0
  DB07  ED79          		OUT	(C),A
  DB09  3A95EF        		LD	A,(_KEYSP+1)
  DB0C  32B6DA        		LD	(INTCPAT+1),A
                      	
  DB0F                	KEYSET:
  DB0F  7D            		LD	A,L
  DB10  CB74          		BIT	6,H
  DB12  C0            		RET	NZ
  DB13                	KEYBS:
  DB13  B7            		OR	A
  DB14  C8            		RET	Z
  DB15                	KEYBS1:
  DB15  CD2BDB        		CALL	KEYBC_IFBREAK
  DB18  E5            		PUSH	HL
  DB19  F5            		PUSH	AF
  DB1A  2A90EF        		LD	HL,(_KEYPS)
  DB1D  2C            		INC	L
  DB1E  7D            		LD	A,L
  DB1F  BC            		CP	H
  DB20  2815          		JR	Z,POP_AF_HL_SCF_RET
  DB22  3290EF        		LD	(_KEYPS),A
  DB25  26FE          		LD	H,KEYBF/256
  DB27  F1            		POP	AF
  DB28  77            		LD	(HL),A
  DB29  E1            		POP	HL
  DB2A  C9            		RET
  DB2B                	KEYBC_IFBREAK:
  DB2B  FE03          		CP	3
  DB2D  C0            		RET	NZ
  DB2E                	KEYBC:
  DB2E  E5            		PUSH	HL
  DB2F  210000        		LD	HL,0
  DB32  2290EF        		LD	(_KEYPS),HL
  DB35  E1            		POP	HL
  DB36  C9            		RET
                      	
  DB37                	POP_AF_HL_SCF_RET:
  DB37  F1            		POP	AF
  DB38  E1            		POP	HL
  DB39  37            		SCF
  DB3A  C9            		RET
                      	
  DB3B                	_SYS01:		;(BDOS)コンソール入力
  DB3B  CD09EF        		CALL	_SYS07
  DB3E                	MSG_A:
  DB3E  F5            		PUSH	AF
  DB3F  D5            		PUSH	DE
  DB40  5F            		LD	E,A
  DB41  CD47DB        		CALL	_SYS02
  DB44  D1            		POP	DE
  DB45  F1            		POP	AF
  DB46  C9            		RET
                      	
  DB47                	_SYS02:		;(BDOS)コンソール出力
  DB47  CD59DB        		CALL	BREAK
  DB4A  1805          		JR	PRINTX
                      	
  DB4C                	_SYS06:		;(BDOS)コンソール直接入出力
  DB4C  7B            		LD	A,E
  DB4D  3C            		INC	A
  DB4E  CACAEF        		JP	Z,_INKEY
  DB51                	PRINTX:
  DB51  C3CDEF        		JP	_PRINT
                      	
  DB54                	_SYS08:		;(BDOS)エコーなしコンソール入力
  DB54  CD09EF        		CALL	_SYS07
  DB57  1804          		JR	BREAK1
  DB59                	BREAK:
  DB59  FB            		EI
  DB5A  3A92EF        		LD	A,(_KEYD)
  DB5D                	BREAK1:
  DB5D  FE03          		CP	3		;CTRL+C
  DB5F  CA00EF        		JP	Z,CPM_BOOT
  DB62  FE13          		CP	013H		;CTRL+S
  DB64  C0            		RET	NZ
                      	
  DB65                	PAUSE:
  DB65  CD2EDB        		CALL	KEYBC
                      	
  DB68                	FLGET:
  DB68  CDDFEF        		CALL	_FFLUSH
  DB6B  C5            		PUSH	BC
  DB6C  E5            		PUSH	HL
  DB6D  ED4B8EEF      		LD	BC,(_TXADR)
  DB71  CBE8          		SET	5,B
  DB73  ED60          		IN	H,(C)
  DB75                	FLGET1:
  DB75  3A93EF        		LD	A,(_KEYD+1)
  DB78  0F            		RRCA
  DB79  0F            		RRCA
  DB7A  E610          		AND	010H
  DB7C  F608          		OR	8
  DB7E  ED68          		IN	L,(C)
  DB80  B5            		OR	L
  DB81  ED79          		OUT	(C),A
  DB83  CDCAEF        		CALL	_INKEY
  DB86  28ED          		JR	Z,FLGET1
  DB88  ED61          		OUT	(C),H
  DB8A  E1            		POP	HL
  DB8B  C1            		POP	BC
  DB8C  C9            		RET
                      	
  DB8D                	_SYS0A:		;(BDOS)文字列入力
  DB8D  C5            		PUSH	BC
  DB8E  E5            		PUSH	HL
  DB8F  D5            		PUSH	DE
  DB90  CD93DF        		CALL	GETL
  DB93  1100FF        		LD	DE,KBUF
  DB96  E1            		POP	HL
  DB97  E5            		PUSH	HL
  DB98  0E00          		LD	C,0
  DB9A  3004          		JR	NC,SAX0
  DB9C  23            		INC	HL
  DB9D  23            		INC	HL
  DB9E  1808          		JR	SAX4
  DBA0                	SAX0:
  DBA0  46            		LD	B,(HL)
  DBA1  23            		INC	HL
  DBA2                	SAX1:
  DBA2  23            		INC	HL
  DBA3  1A            		LD	A,(DE)
  DBA4  13            		INC	DE
  DBA5  B7            		OR	A
  DBA6  2004          		JR	NZ,SAX2
  DBA8                	SAX4:
  DBA8  360D          		LD	(HL),00DH
  DBAA  1804          		JR	SAX3
  DBAC                	SAX2:
  DBAC  77            		LD	(HL),A
  DBAD  0C            		INC	C
  DBAE  10F2          		DJNZ	SAX1
  DBB0                	SAX3:
  DBB0  D1            		POP	DE
  DBB1  79            		LD	A,C
  DBB2  13            		INC	DE
  DBB3  12            		LD	(DE),A
  DBB4  1B            		DEC	DE
  DBB5  E1            		POP	HL
  DBB6  C1            		POP	BC
  DBB7  A7            		AND	A
  DBB8  C9            		RET
                      	
  DBB9                	_SYS0B:		;(BDOS)コンソール状態のチェック
  DBB9  CD59DB        		CALL	BREAK
  DBBC  3A92EF        		LD	A,(_KEYD)
  DBBF  B7            		OR	A
  DBC0  C8            		RET	Z
  DBC1                	CONSTX:
  DBC1  CDDFEF        		CALL	_FFLUSH
  DBC4  E5            		PUSH	HL
  DBC5  2A90EF        		LD	HL,(_KEYPS)
  DBC8  7C            		LD	A,H
  DBC9  AD            		XOR	L
  DBCA  E1            		POP	HL
  DBCB  C6FF          		ADD	A,0FFH
  DBCD  9F            		SBC	A,A
  DBCE  C9            		RET
                      	
  DBCF                	_SYS2A:		;(BDOS)日付の獲得
  DBCF  C5            		PUSH	BC
  DBD0  3EED          		LD	A,0EDH		;Read calendar
  DBD2  CD61DE        		CALL	COMOUT
  DBD5  CD07DC        		CALL	IN49SB_BCD	;YY
  DBD8  6F            		LD	L,A
  DBD9  2600          		LD	H,0
                      	;	LD	DE,1900		;0076CH
                      	;	CP	90		;90以上は1900年代 1990-1999
                      	;	JR	NC,RDDATE1	;90未満は2000年代 2000-2089
                      	;	LD	E,0D0H		;2000 & 0FFH D=007H
  DBDB  11D007        		LD	DE,2000		;すべて2000年代で処理 2000-2099
  DBDE                	RDDATE1:
  DBDE  19            		ADD	HL,DE
  DBDF  CD46DE        		CALL	IN49SB		;MW
  DBE2  57            		LD	D,A
  DBE3  CD07DC        		CALL	IN49SB_BCD	;DD
  DBE6  5F            		LD	E,A
  DBE7  7A            		LD	A,D
  DBE8  0604          		LD	B,4
  DBEA                	RDDATE2:
  DBEA  CB3A          		SRL	D
  DBEC  10FC          		DJNZ	RDDATE2
  DBEE  C1            		POP	BC
  DBEF  E607          		AND	7
  DBF1  C9            		RET
                      	
  DBF2                	_SYS2C:		;(BDOS)時刻の獲得
  DBF2  C5            		PUSH	BC
  DBF3  3EEF          		LD	A,0EFH		;Read time
  DBF5  CD61DE        		CALL	COMOUT
  DBF8  CD07DC        		CALL	IN49SB_BCD	;TT
  DBFB  67            		LD	H,A
  DBFC  CD07DC        		CALL	IN49SB_BCD	;MM
  DBFF  6F            		LD	L,A
  DC00  CD07DC        		CALL	IN49SB_BCD	;SS
  DC03  57            		LD	D,A
  DC04  C1            		POP	BC
  DC05  AF            		XOR	A
  DC06  C9            		RET
                      	
  DC07                	IN49SB_BCD:
  DC07  CD46DE        		CALL	IN49SB
                      	;------------------------
                      	;BCDの10進数化
                      	;in
                      	;	A  : BCD
                      	;out
                      	;	A  : 10進数
                      	;------------------------
  DC0A  4F            		LD	C,A
  DC0B  E6F0          		AND	0F0H	;10の位
  DC0D  0F            		RRCA
  DC0E  47            		LD	B,A
  DC0F  0F            		RRCA
  DC10  0F            		RRCA
  DC11  80            		ADD	A,B
  DC12  47            		LD	B,A
  DC13  79            		LD	A,C
  DC14  E60F          		AND	00FH	;1の位
  DC16  80            		ADD	A,B
  DC17  C9            		RET
                      	
  DC18                	ESC1:
  DC18  7B            		LD	A,E
  DC19  FE41          		CP	'A'
  DC1B  CA62DD        		JP	Z,CTRL1E
  DC1E  FE42          		CP	'B'
  DC20  CACCDE        		JP	Z,CTRL1F
  DC23  FE43          		CP	'C'
  DC25  CA6DDD        		JP	Z,CTRL1C
  DC28  FE44          		CP	'D'
  DC2A  CA59DD        		JP	Z,CTRL1D
  DC2D  FE45          		CP	'E'
  DC2F  2802          		JR	Z,CT0CX
  DC31  FE6A          		CP	'j'
  DC33                	CT0CX:
  DC33  CA9FDE        		JP	Z,CTRL0C
  DC36  FE48          		CP	'H'
  DC38  CAE7DD        		JP	Z,CTRL0B
  DC3B  FE4A          		CP	'J'
  DC3D  CAA2DE        		JP	Z,CTRL06
  DC40  FE4B          		CP	'K'
  DC42  CAA6DD        		JP	Z,CTRL05
  DC45  FE4C          		CP	'L'
  DC47  CAE1DE        		JP	Z,CTRL0E
  DC4A  FE54          		CP	'T'
  DC4C  CAA6DD        		JP	Z,CTRL05
  DC4F  FE78          		CP	'x'
  DC51  2804          		JR	Z,ESC1X
  DC53  FE79          		CP	'y'
  DC55  2002          		JR	NZ,ESC1Y
  DC57                	ESC1X:
  DC57  3601          		LD	(HL),1
  DC59                	ESC1Y:
  DC59  FE3D          		CP	'='
  DC5B  2804          		JR	Z,ESC1W
  DC5D  FE59          		CP	'Y'
  DC5F  2002          		JR	NZ,ESC1Z
  DC61                	ESC1W:
  DC61  3602          		LD	(HL),2
  DC63                	ESC1Z:
  DC63  FE20          		CP	020H
  DC65  3802          		JR	C,ESC1C
  DC67  87            		ADD	A,A
  DC68  D0            		RET	NC
  DC69                	ESC1C:
  DC69  E1            		POP	HL
  DC6A  184F          		JR	ANK
                      	
  DC6C                	ESC:
  DC6C  21CCDC        		LD	HL,PRINTE5
  DC6F  E5            		PUSH	HL
  DC70  2192DC        		LD	HL,ESCFLG+1
  DC73  3600          		LD	(HL),0
  DC75  3D            		DEC	A
  DC76  28A0          		JR	Z,ESC1
  DC78  3D            		DEC	A
  DC79  2009          		JR	NZ,ESC2
  DC7B  3603          		LD	(HL),3
  DC7D  7B            		LD	A,E
  DC7E  D620          		SUB	020H
  DC80  3287DC        		LD	(ESCYP+1),A
  DC83  C9            		RET
  DC84                	ESC2:
  DC84  3D            		DEC	A
  DC85  C0            		RET	NZ
  DC86  2600          	ESCYP:	LD	H,0
  DC88  7B            		LD	A,E
  DC89  D620          		SUB	020H
  DC8B  6F            		LD	L,A
  DC8C  C3D6EF        		JP	_LOC
                      	
  DC8F                	PRINT:
  DC8F  C5            		PUSH	BC
  DC90  E5            		PUSH	HL
  DC91  3E00          	ESCFLG:	LD	A,000H
  DC93  B7            		OR	A
  DC94  20D6          		JR	NZ,ESC
                      	
  DC96  3E1F          		LD	A,01FH
  DC98  BB            		CP	E
  DC99  3035          		JR	NC,CTRL
  DC9B  016ADE        	INSFLG:	LD	BC,INSERT
                      	
  DC9E  3A1800        		LD	A,(00018H)
  DCA1  3C            		INC	A
  DCA2  2817          		JR	Z,ANK
  DCA4  3E00          	KANFLG:	LD	A,000H
  DCA6  B7            		OR	A
  DCA7  203A          		JR	NZ,KANJI2
  DCA9  7B            		LD	A,E
  DCAA  FE80          		CP	080H
  DCAC  380D          		JR	C,ANK
  DCAE  FEA0          		CP	0A0H
  DCB0  3804          		JR	C,KANJI1
  DCB2  FEE0          		CP	0E0H
  DCB4  3805          		JR	C,ANK
  DCB6                	KANJI1:
  DCB6  32A5DC        		LD	(KANFLG+1),A
  DCB9  1811          		JR	PRINTE5
  DCBB                	ANK:
  DCBB  ED4B8EEF      		LD	BC,(_TXADR)
  DCBF  78            		LD	A,B
  DCC0  F638          		OR	038H
  DCC2  47            		LD	B,A
  DCC3  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令	kanji
  DCC5  CB98          		RES	3,B
  DCC7  ED59          		OUT	(C),E		;Text
  DCC9                	KANJIE:
  DCC9  CD2EDD        		CALL	PRINTE7
  DCCC                	PRINTE5:
  DCCC  E1            		POP	HL
  DCCD  C1            		POP	BC
  DCCE  AF            		XOR	A
  DCCF  C9            		RET
                      	
  DCD0                	CTRL:
  DCD0  CD15DD        		CALL	KANCLR
  DCD3  7B            		LD	A,E
  DCD4  87            		ADD	A,A
  DCD5  F680          		OR	080H
  DCD7  6F            		LD	L,A
  DCD8  26F0          		LD	H,CTRLTB/256
  DCDA  7E            		LD	A,(HL)
  DCDB  2C            		INC	L
  DCDC  66            		LD	H,(HL)
  DCDD  6F            		LD	L,A
  DCDE  CD0F00        		CALL	JP_HL
  DCE1  18E9          		JR	PRINTE5
                      	
  DCE3                	KANJI2:
  DCE3  D5            		PUSH	DE
  DCE4  57            		LD	D,A
  DCE5  01812F        		LD	BC,02F81H	;SFTJIS
  DCE8  DF            		RST	018H
  DCE9  01C32F        		LD	BC,02FC3H	;Instead or JISVRM
  DCEC  DF            		RST	018H
                      	
  DCED  ED4B8EEF      		LD	BC,(_TXADR)
  DCF1  78            		LD	A,B
  DCF2  F638          		OR	038H
  DCF4  47            		LD	B,A
  DCF5  ED51          		OUT	(C),D		;kanji
  DCF7  CB98          		RES	3,B
  DCF9  ED59          		OUT	(C),E		;Text
  DCFB  CD2EDD        		CALL	PRINTE7
  DCFE  ED4B8EEF      		LD	BC,(_TXADR)
  DD02  78            		LD	A,B
  DD03  F638          		OR	038H
  DD05  47            		LD	B,A
  DD06  CBF2          		SET	6,D
  DD08  ED51          		OUT	(C),D		;Kanji
  DD0A  CB98          		RES	3,B
  DD0C  ED59          		OUT	(C),E		;Text
  DD0E  D1            		POP	DE
  DD0F  AF            		XOR	A
  DD10  32A5DC        		LD	(KANFLG+1),A
  DD13  18B4          		JR	KANJIE
                      	
  DD15                	KANCLR:
  DD15  3AA5DC        		LD	A,(KANFLG+1)
  DD18  B7            		OR	A
  DD19  C8            		RET	Z
  DD1A  ED4B8EEF      		LD	BC,(_TXADR)
  DD1E  78            		LD	A,B
  DD1F  F638          		OR	038H
  DD21  47            		LD	B,A
  DD22  AF            		XOR	A
  DD23  32A5DC        		LD	(KANFLG+1),A
  DD26  ED79          		OUT	(C),A		;Kanji
  DD28  CB98          		RES	3,B
  DD2A  3E20          		LD	A,020H
  DD2C  ED79          		OUT	(C),A		;Text
  DD2E                	PRINTE7:
  DD2E  CBA0          		RES	4,B
  DD30                	PRINTE6:
  DD30  3A96EF        		LD	A,(_COLORF)
  DD33                	PRINTE4:
  DD33  ED79          		OUT	(C),A		;Color
  DD35  78            		LD	A,B
  DD36  E607          		AND	7
  DD38  47            		LD	B,A
  DD39                	PRINTE2:
  DD39  03            		INC	BC
  DD3A                	PRINTE3:
  DD3A  2ABAEF        		LD	HL,(_PAGE_MINUS)
  DD3D  A7            		AND	A
  DD3E  ED4A          		ADC	HL,BC
  DD40                	PRINTE8:
  DD40  2805          		JR	Z,PRINT2
  DD42  ED438EEF      		LD	(_TXADR),BC
  DD46                	CTRL00:
  DD46  C9            		RET
                      	
  DD47                	PRINT2:
  DD47  CDE7DE        		CALL	SCR
  DD4A  2ABCEF        		LD	HL,(_WIDTH_MINUS)
  DD4D  09            		ADD	HL,BC
  DD4E                	SET_TXADR_HL:
  DD4E  228EEF        		LD	(_TXADR),HL
  DD51  C9            		RET
                      	
  DD52                	CTRL08:
  DD52  3A9BDC        		LD	A,(INSFLG)
  DD55  FECD          		CP	0CDH		;CALL ????
  DD57  2829          		JR	Z,CTRL02
  DD59                	CTRL1D:
  DD59  2A8EEF        		LD	HL,(_TXADR)
  DD5C  7C            		LD	A,H
  DD5D  B5            		OR	L
  DD5E  C8            		RET	Z
  DD5F  2B            		DEC	HL
  DD60  18EC          		JR	SET_TXADR_HL
                      	
  DD62                	CTRL1E:
  DD62  ED4B8EEF      		LD	BC,(_TXADR)
  DD66  2ABCEF        		LD	HL,(_WIDTH_MINUS)
  DD69  09            		ADD	HL,BC
  DD6A  D0            		RET	NC
  DD6B  18E1          		JR	SET_TXADR_HL
                      	
  DD6D                	CTRL1C:
  DD6D  ED4B8EEF      		LD	BC,(_TXADR)
  DD71  18C6          		JR	PRINTE2
                      	
  DD73                	CTRL09:
  DD73  ED4B8EEF      		LD	BC,(_TXADR)
  DD77  79            		LD	A,C
  DD78  E6F8          		AND	0F8H
  DD7A  C608          		ADD	A,8
  DD7C  4F            		LD	C,A
  DD7D  88            		ADC	A,B
  DD7E  91            		SUB	C
  DD7F  47            		LD	B,A
  DD80  18B8          		JR	PRINTE3
                      	
  DD82                	CTRL02:
  DD82  CD59DD        		CALL	CTRL1D
  DD85  C8            		RET	Z
  DD86  D5            		PUSH	DE
  DD87  CDD3EF        		CALL	_POS
  DD8A  3AB1EF        		LD	A,(_WIDTH)
  DD8D  95            		SUB	L
  DD8E  4F            		LD	C,A
  DD8F  0D            		DEC	C
  DD90  0638          		LD	B,038H
  DD92  2A8EEF        		LD	HL,(_TXADR)
  DD95  09            		ADD	HL,BC
  DD96  44            		LD	B,H
  DD97  4D            		LD	C,L
  DD98  110020        		LD	DE,02000H	;D:Text E:kanji
  DD9B  2A96EF        		LD	HL,(_COLORF)	;L:Color
  DD9E                	C8X1:
  DD9E  CD86DE        		CALL	C12S
  DDA1  0B            		DEC	BC
  DDA2  20FA          		JR	NZ,C8X1
  DDA4  D1            		POP	DE
  DDA5  C9            		RET
                      	
  DDA6                	CTRL05:
  DDA6  CDD3EF        		CALL	_POS
  DDA9  3AB1EF        		LD	A,(_WIDTH)
  DDAC  95            		SUB	L
  DDAD  6F            		LD	L,A
  DDAE                	C08X1:
  DDAE  ED4B8EEF      		LD	BC,(_TXADR)
  DDB2                	LINECL:
  DDB2  2620          		LD	H,020H
  DDB4  3A96EF        		LD	A,(_COLORF)
  DDB7  CBE8          		SET	5,B
  DDB9                	LINECL1:
  DDB9  CBD8          		SET	3,B
  DDBB  CBE0          		SET	4,B
  DDBD  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令	kanji
  DDBF  CB98          		RES	3,B
  DDC1  ED61          		OUT	(C),H		;Text
  DDC3  CBA0          		RES	4,B
  DDC5  ED79          		OUT	(C),A		;Color
  DDC7  03            		INC	BC
  DDC8  2D            		DEC	L
  DDC9  20EE          		JR	NZ,LINECL1
  DDCB  C9            		RET
                      	
  DDCC                	CTRL0D:
  DDCC  CDD3EF        		CALL	_POS
  DDCF  2E00          		LD	L,0
  DDD1                	LOC:
  DDD1  C5            		PUSH	BC
  DDD2  E5            		PUSH	HL
  DDD3  CD15DD        		CALL	KANCLR
  DDD6  CDF4DD        		CALL	LOC1
  DDD9  228EEF        		LD	(_TXADR),HL
  DDDC  E1            		POP	HL
  DDDD  C1            		POP	BC
  DDDE  C9            		RET
                      	
  DDDF                	CTRL12:
  DDDF  219BDC        		LD	HL,INSFLG
  DDE2  7E            		LD	A,(HL)
  DDE3  EECC          		XOR	0CCH		;CD:CALL ???? 1:LD BC,????
  DDE5  77            		LD	(HL),A
  DDE6  C9            		RET
                      	
  DDE7                	CTRL0B:
  DDE7  210000        		LD	HL,0
  DDEA  228EEF        		LD	(_TXADR),HL
  DDED  C9            		RET
                      	
  DDEE                	CTRL1B:
  DDEE  3E01          		LD	A,1
  DDF0  3292DC        		LD	(ESCFLG+1),A
  DDF3  C9            		RET
                      	
  DDF4                	LOC1:
  DDF4  D5            		PUSH	DE
  DDF5  4D            		LD	C,L
  DDF6  0608          		LD	B,8
  DDF8  5C            		LD	E,H
  DDF9  1600          		LD	D,0
  DDFB  2AB0EF        		LD	HL,(CRTCD)
  DDFE  6A            		LD	L,D
  DDFF                	LOC2:
  DDFF  29            		ADD	HL,HL
  DE00  3001          		JR	NC,LOC3
  DE02  19            		ADD	HL,DE
  DE03                	LOC3:
  DE03  10FA          		DJNZ	LOC2
  DE05  09            		ADD	HL,BC
  DE06  D1            		POP	DE
  DE07  C9            		RET
                      	
  DE08                	CONOUT1:
  DE08  CD1ADE        		CALL	CURSOR
  DE0B  59            		LD	E,C
  DE0C  CDCDEF        		CALL	_PRINT
  DE0F  7B            		LD	A,E
  DE10  FE0A          		CP	00AH
  DE12  2006          		JR	NZ,CURSOR
  DE14  CDCCDD        		CALL	CTRL0D
  DE17  CDA6DD        		CALL	CTRL05
  DE1A                	CURSOR:
  DE1A  C5            		PUSH	BC
  DE1B  ED4B8EEF      		LD	BC,(_TXADR)
  DE1F  CBE8          		SET	5,B
  DE21  ED78          		IN	A,(C)
  DE23  EE18          		XOR	018H
  DE25  ED79          		OUT	(C),A
  DE27  C1            		POP	BC
  DE28  C9            		RET
                      	
  DE29                	CTRL07:
  DE29  2161EF        		LD	HL,BEEPD
  DE2C                	BEEP1:
  DE2C  7E            		LD	A,(HL)
  DE2D  23            		INC	HL
  DE2E  FEFF          		CP	0FFH
  DE30  C8            		RET	Z
  DE31  F3            		DI
  DE32  061C          		LD	B,01CH
  DE34  ED79          		OUT	(C),A
  DE36  EDA3          		OUTI
  DE38  FB            		EI
  DE39  18F1          		JR	BEEP1
                      	
  DE3B                	OT49SB:
  DE3B  C5            		PUSH	BC
  DE3C  CD57DE        		CALL	CANW
  DE3F  010019        		LD	BC,01900H
  DE42  ED79          		OUT	(C),A
  DE44  C1            		POP	BC
  DE45  C9            		RET
                      	
  DE46                	IN49SB:
  DE46  C5            		PUSH	BC
  DE47  01011A        		LD	BC,01A01H
  DE4A                	CANR:
  DE4A  ED78          		IN	A,(C)
  DE4C  E620          		AND	020H
  DE4E  20FA          		JR	NZ,CANR
  DE50  010019        		LD	BC,01900H
  DE53  ED78          		IN	A,(C)
  DE55  C1            		POP	BC
  DE56  C9            		RET
                      	
  DE57                	CANW:
  DE57  01011A        		LD	BC,01A01H
  DE5A  ED48          		IN	C,(C)
  DE5C  CB71          		BIT	6,C
  DE5E  20F7          		JR	NZ,CANW
  DE60  C9            		RET
                      	
  DE61                	COMOUT:
  DE61  FB            		EI
  DE62  CD3BDE        		CALL	OT49SB
  DE65  CD57DE        		CALL	CANW
  DE68  F3            		DI
  DE69  C9            		RET
                      	
  DE6A                	INSERT:
  DE6A  D5            		PUSH	DE
  DE6B  CDD3EF        		CALL	_POS
  DE6E  3AB1EF        		LD	A,(_WIDTH)
  DE71  95            		SUB	L
  DE72  ED4B8EEF      		LD	BC,(_TXADR)
  DE76  110020        		LD	DE,02000H	;D:Text E:Kanji
  DE79  2A96EF        		LD	HL,(_COLORF)	;L:Color
  DE7C  CBE8          		SET	5,B
  DE7E                	C12X1:
  DE7E  CD86DE        		CALL	C12S
  DE81  03            		INC	BC
  DE82  20FA          		JR	NZ,C12X1
  DE84  D1            		POP	DE
  DE85  C9            		RET
                      	
  DE86                	C12S:
  DE86  CBE0          		SET	4,B
  DE88  CBD8          		SET	3,B
  DE8A  ED60          		IN	H,(C)
  DE8C  ED59          	X1PAT:	OUT	(C),E
  DE8E  5C            		LD	E,H
  DE8F  CB98          		RES	3,B
  DE91  ED60          		IN	H,(C)
  DE93  ED51          		OUT	(C),D
  DE95  54            		LD	D,H
  DE96  CBA0          		RES	4,B
  DE98  ED60          		IN	H,(C)
  DE9A  ED69          		OUT	(C),L
  DE9C  6C            		LD	L,H
  DE9D  3D            		DEC	A
  DE9E  C9            		RET
                      	
  DE9F                	CTRL0C:
  DE9F  CDE7DD        		CALL	CTRL0B
  DEA2                	CTRL06:
  DEA2  ED4B8EEF      		LD	BC,(_TXADR)
  DEA6                	C1AX1:
  DEA6  78            		LD	A,B
  DEA7  F638          		OR	038H
  DEA9  47            		LD	B,A
  DEAA  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令	kanji
  DEAC  CB98          		RES	3,B
  DEAE  3E20          		LD	A,020H
  DEB0  ED79          		OUT	(C),A		;Text
  DEB2  CBA0          		RES	4,B
  DEB4  3A96EF        		LD	A,(_COLORF)
  DEB7  ED79          		OUT	(C),A		;Color
  DEB9  03            		INC	BC
  DEBA  CBA8          		RES	5,B
  DEBC  2ABAEF        		LD	HL,(_PAGE_MINUS)
  DEBF  09            		ADD	HL,BC
  DEC0  30E4          		JR	NC,C1AX1
  DEC2  C9            		RET
                      	
  DEC3                	CTRL04:
  DEC3  CDD3EF        		CALL	_POS
  DEC6  7D            		LD	A,L
  DEC7  B7            		OR	A
  DEC8  C8            		RET	Z
  DEC9                	CTRL03:
  DEC9  CDCCDD        		CALL	CTRL0D
  DECC                	CTRL0A:
  DECC                	CTRL1F:
  DECC  ED4B8EEF      		LD	BC,(_TXADR)
  DED0  2AB1EF        		LD	HL,(_WIDTH)
  DED3  2600          		LD	H,0
  DED5  09            		ADD	HL,BC
  DED6  44            		LD	B,H
  DED7  4D            		LD	C,L
  DED8  2ABAEF        		LD	HL,(_PAGE_MINUS)
  DEDB  09            		ADD	HL,BC
  DEDC  3F            		CCF
  DEDD  9F            		SBC	A,A
  DEDE  C340DD        		JP	PRINTE8
                      	
  DEE1                	CTRL0E:
  DEE1  CDD3EF        		CALL	_POS
  DEE4  7C            		LD	A,H
  DEE5  1804          		JR	SCR1
  DEE7                	SCR:
  DEE7  3A97EF        		LD	A,(_LINE)
  DEEA  3D            		DEC	A
  DEEB                	SCR1:
  DEEB  C5            		PUSH	BC
  DEEC  D5            		PUSH	DE
  DEED  F5            		PUSH	AF
  DEEE  3E07          		LD	A,7
  DEF0  2121DF        		LD	HL,SCRDMAD
  DEF3  CD17DF        		CALL	SETDMA
  DEF6  F1            		POP	AF
  DEF7  210038        		LD	HL,03800H
                      	
  DEFA                	SCRUP1:
  DEFA  B7            		OR	A
  DEFB  284D          		JR	Z,SCRCL
  DEFD  F5            		PUSH	AF
  DEFE  CD28DF        		CALL	UPSUB		;kanji
  DF01  3ABCEF        		LD	A,(_WIDTH_MINUS)
  DF04  5F            		LD	E,A
  DF05  16F7          		LD	D,0F7H
  DF07  19            		ADD	HL,DE
  DF08  D5            		PUSH	DE
  DF09  CD28DF        		CALL	UPSUB		;Text
  DF0C  D1            		POP	DE
  DF0D  19            		ADD	HL,DE
  DF0E  CD28DF        		CALL	UPSUB		;Color
  DF11  CBE4          		SET	4,H
  DF13  F1            		POP	AF
  DF14  3D            		DEC	A
  DF15  18E3          		JR	SCRUP1
                      	
  DF17                	SETDMA:
  DF17  01871F        		LD	BC,01F87H
  DF1A                	SDMA:
  DF1A  04            		INC	B
  DF1B  EDA3          		OUTI
  DF1D  3D            		DEC	A
  DF1E  20FA          		JR	NZ,SDMA
  DF20  C9            		RET
                      	
  DF21                	SCRDMAD:
  DF21  C3            		DB	0C3H		;WR6 リセット
  DF22  9A            		DB	09AH		;WR5 ストップ WAIT READY:HIGH
  DF23  65            		DB	065H		;WR0 ブロック長(LH)
  DF24  4F00          		DW	79
  DF26  1C            		DB	01CH		;WR1 ポートAインクリメント I/O
  DF27  18            		DB	018H		;WR0 ポートAアドレス(LH)
                      	
  DF28                	UPSUB:
  DF28  3AB1EF        		LD	A,(_WIDTH)
  DF2B  5F            		LD	E,A
  DF2C  1600          		LD	D,0
  DF2E  3ECD          		LD	A,0CDH		;WR4 バースト ポートB開始アドレス(LH)
  DF30  ED79          		OUT	(C),A
  DF32  ED69          		OUT	(C),L		;SOURCE
  DF34  ED61          		OUT	(C),H
  DF36  19            		ADD	HL,DE
  DF37  3E1D          		LD	A,01DH		;WR0 ポートA開始アドレス(LH) ポートA→ポートB 転送
  DF39  ED79          		OUT	(C),A
  DF3B  ED69          		OUT	(C),L		;DEST
  DF3D  ED61          		OUT	(C),H
  DF3F                	GO_DMA:
  DF3F  3ECF          		LD	A,0CFH
  DF41  ED79          		OUT	(C),A		;WR6 ロード
  DF43  3EB3          		LD	A,0B3H
  DF45  ED79          		OUT	(C),A		;WR6 強制RDY
  DF47  ED49          		OUT	(C),C		;WR6 イネーブル
  DF49  C9            		RET
                      	
  DF4A                	SCRCL:
  DF4A  44            		LD	B,H
  DF4B  4D            		LD	C,L
  DF4C  2AB1EF        		LD	HL,(_WIDTH)
  DF4F  CDB2DD        		CALL	LINECL
  DF52  D1            		POP	DE
  DF53  C1            		POP	BC
  DF54  C9            		RET
                      	
  DF55                	SCRN:
  DF55  D5            		PUSH	DE
  DF56  ED58          		IN	E,(C)		;Text
  DF58  3A1800        		LD	A,(00018H)
  DF5B  3C            		INC	A
  DF5C  281E          		JR	Z,SCRN2
  DF5E  CBD8          		SET	3,B
  DF60  ED50          		IN	D,(C)		;Kanji
  DF62  2816          		JR	Z,SCRN1
  DF64  AF            		XOR	A
  DF65  C5            		PUSH	BC
  DF66  013730        		LD	BC,03037H	;VRMJIS
  DF69  DF            		RST	018H
  DF6A  01522F        		LD	BC,02F52H	;JISSFT
  DF6D  DF            		RST	018H
  DF6E  C1            		POP	BC
  DF6F  ED78          		IN	A,(C)
  DF71  CB98          		RES	3,B
  DF73  E640          		AND	040H
  DF75  2005          		JR	NZ,SCRN2
  DF77  7A            		LD	A,D
  DF78  D1            		POP	DE
  DF79  C9            		RET
  DF7A                	SCRN1:
  DF7A  CB98          		RES	3,B
  DF7C                	SCRN2:
  DF7C  7B            		LD	A,E
  DF7D  D1            		POP	DE
  DF7E  C9            		RET
  DF7F                	SCRNE:
  DF7F                	POS:
  DF7F  2A8EEF        		LD	HL,(_TXADR)
  DF82  C5            		PUSH	BC
  DF83  ED4BBCEF      		LD	BC,(_WIDTH_MINUS)
  DF87  AF            		XOR	A
  DF88                	POS1:
  DF88  09            		ADD	HL,BC
  DF89  3C            		INC	A
  DF8A  38FC          		JR	C,POS1
  DF8C  ED42          		SBC	HL,BC
  DF8E  3D            		DEC	A
  DF8F  67            		LD	H,A
  DF90  C1            		POP	BC
  DF91  A7            		AND	A
  DF92  C9            		RET
                      	
  DF93                	GETL:
  DF93  CDD3EF        		CALL	_POS
  DF96  E5            		PUSH	HL
  DF97  3ECD          		LD	A,0CDH		;CALL ????
  DF99  329BDC        		LD	(INSFLG),A
  DF9C                	GETL1:
  DF9C  CD54DB        		CALL	_SYS08
  DF9F  FE09          		CP	9
  DFA1  2008          		JR	NZ,GETL1V
  DFA3  2100FF        		LD	HL,KBUF
  DFA6  CDF8D7        		CALL	MSX
  DFA9  18F1          		JR	GETL1
  DFAB                	GETL1V:
  DFAB  5F            		LD	E,A
  DFAC  CDCDEF        		CALL	_PRINT
                      	
  DFAF  7B            		LD	A,E
  DFB0  FE0D          		CP	00DH
  DFB2  20E8          		JR	NZ,GETL1
  DFB4  3E01          		LD	A,1		;LD BC,????
  DFB6  329BDC        		LD	(INSFLG),A
  DFB9  1100FF        		LD	DE,KBUF
  DFBC  3AB1EF        		LD	A,(_WIDTH)
  DFBF  47            		LD	B,A
  DFC0  CDE8D4        		CALL	ZERO_MEMORY_DE
                      	
  DFC3  D1            		POP	DE
  DFC4  CDD3EF        		CALL	_POS
  DFC7  6B            		LD	L,E
  DFC8  3AB1EF        		LD	A,(_WIDTH)
  DFCB  95            		SUB	L
  DFCC  57            		LD	D,A
  DFCD  CDF4DD        		CALL	LOC1
  DFD0  4D            		LD	C,L
  DFD1  7C            		LD	A,H
  DFD2  F630          		OR	030H
  DFD4  47            		LD	B,A
  DFD5  5A            		LD	E,D
  DFD6  2100FF        		LD	HL,KBUF
  DFD9                	GETL2:
  DFD9  CDD0EF        		CALL	_SCRN
  DFDC  03            		INC	BC
  DFDD  77            		LD	(HL),A
  DFDE  23            		INC	HL
  DFDF  1D            		DEC	E
  DFE0  20F7          		JR	NZ,GETL2
  DFE2                	GETL3:
  DFE2  2B            		DEC	HL
  DFE3  7E            		LD	A,(HL)
  DFE4  FE21          		CP	021H
  DFE6  D0            		RET	NC
  DFE7  3600          		LD	(HL),0
  DFE9  15            		DEC	D
  DFEA  20F6          		JR	NZ,GETL3
  DFEC  C9            		RET
                      	
  DFED                	INKEY:
  DFED  FB            		EI
  DFEE  E5            		PUSH	HL
  DFEF  2A90EF        		LD	HL,(_KEYPS)
  DFF2  7C            		LD	A,H
  DFF3  AD            		XOR	L
  DFF4  2809          		JR	Z,INKEY1
  DFF6  7C            		LD	A,H
  DFF7  3C            		INC	A
  DFF8  3291EF        		LD	(_KEYPS+1),A
  DFFB  6F            		LD	L,A
  DFFC  26FE          		LD	H,KEYBF/256
  DFFE  7E            		LD	A,(HL)
  DFFF                	INKEY1:
  DFFF  E1            		POP	HL
  E000  B7            		OR	A
  E001  C9            		RET
                      	
  0FB3                	AT_RS	EQU	SCR1-AT_SCR1
                      	
                      	;LDFILE.ASM
                      	
                      	;	LSX-Dodgers FILE
                      	
  E002                	FILEC:
  E002  CD0DE0        		CALL	FILE
  E005                	FILEC2:
  E005  3A15EF        		LD	A,(FDRV+1)
  E008  FE20          		CP	020H
  E00A  C8            		RET	Z
  E00B  1839          		JR	SETDIR1
                      	
  E00D                	FILE:
  E00D  AF            		XOR	A
  E00E  3214EF        		LD	(FDRV),A
  E011  67            		LD	H,A
  E012  6F            		LD	L,A
  E013  2222EF        		LD	(FDRV+14),HL
  E016  CDE4E0        		CALL	SPCUT
  E019  CDC9E0        		CALL	CCHK3
  E01C  2812          		JR	Z,DEVI1
  E01E  13            		INC	DE
  E01F  1A            		LD	A,(DE)
  E020  1B            		DEC	DE
  E021  FE3A          		CP	':'
  E023  200B          		JR	NZ,DEVI1
  E025  1A            		LD	A,(DE)		;DRIVE
  E026  CD19E3        		CALL	CAP
  E029  D640          		SUB	'@'
  E02B  13            		INC	DE
  E02C  13            		INC	DE
  E02D  3214EF        		LD	(FDRV),A
  E030                	DEVI1:
  E030  1A            		LD	A,(DE)
  E031  D65C          		SUB	05CH		;\
  E033  2009          		JR	NZ,NOROOT
  E035  6F            		LD	L,A		;A=0でH=0のはずなのでHL=0
  E036  222EEF        		LD	(FDRV+26),HL
  E039  2C            		INC	L
  E03A  2222EF        		LD	(FDRV+14),HL
  E03D  13            		INC	DE
  E03E                	NOROOT:
                      	
  E03E                	SETDIR:
  E03E  CD6AE0        		CALL	FILED
  E041  1A            		LD	A,(DE)
  E042  FE5C          		CP	05CH		;\
  E044  C0            		RET	NZ
  E045  13            		INC	DE
  E046                	SETDIR1:
  E046  3E10          		LD	A,010H		;Directory
  E048  3221EF        		LD	(FDRV+13),A
  E04B  D5            		PUSH	DE
  E04C  1114EF        		LD	DE,FDRV
  E04F  2A1EF0        		LD	HL,(STABLE+2*00FH)
  E052  CD0F00        		CALL	JP_HL
  E055  D1            		POP	DE
  E056  B7            		OR	A
  E057  C0            		RET	NZ
                      	
  E058  3A21EF        		LD	A,(FDRV+13)
  E05B  CB67          		BIT	4,A
  E05D  C8            		RET	Z
                      	
  E05E  CDB1E0        		CALL	FILEI
  E061  2A2EEF        		LD	HL,(FDRV+26)
  E064  23            		INC	HL
  E065  2222EF        		LD	(FDRV+14),HL
  E068  18D4          		JR	SETDIR
                      	
  E06A                	FILED:
  E06A  CDB1E0        		CALL	FILEI
  E06D  2115EF        		LD	HL,FNAME
                      	
  E070  0608          		LD	B,8
  E072                	FILE2:
  E072  CDBEE0        		CALL	CCHKF
  E075  C8            		RET	Z
  E076  FE2A          		CP	'*'
  E078  282E          		JR	Z,FILE9
  E07A  FE2E          		CP	'.'
  E07C  280C          		JR	Z,FILE4
  E07E  77            		LD	(HL),A
  E07F  23            		INC	HL
  E080  10F0          		DJNZ	FILE2
                      	
  E082                	FILE3:
  E082  CDBEE0        		CALL	CCHKF
  E085  C8            		RET	Z
  E086  FE2E          		CP	'.'
  E088  20F8          		JR	NZ,FILE3
                      	
  E08A                	FILE4:
  E08A  211DEF        		LD	HL,FNAME+8
  E08D  0603          		LD	B,3
                      	
  E08F                	FILE4L:
  E08F  CDBEE0        		CALL	CCHKF
  E092  C8            		RET	Z
  E093  FE2E          		CP	'.'
  E095  2008          		JR	NZ,FILE12
  E097  3215EF        		LD	(FNAME),A	;Parent directory(..)
  E09A  3216EF        		LD	(FNAME+1),A
  E09D  3E20          		LD	A,020H
  E09F                	FILE12:
  E09F  FE2A          		CP	'*'
  E0A1  280A          		JR	Z,FILE10
  E0A3  77            		LD	(HL),A
  E0A4  23            		INC	HL
  E0A5  10E8          		DJNZ	FILE4L
  E0A7  C9            		RET
                      	
  E0A8                	FILE9:				;名前の*処理、名前の残りを?で埋める
  E0A8  CDADE0        		CALL	FILE10
  E0AB  18D5          		JR	FILE3
                      	
  E0AD                	FILE10:
  E0AD  3E3F          		LD	A,'?'
  E0AF  1808          		JR	FILL_MEMORY
  E0B1                	FILEI:				;名前＋拡張子をスペースで初期化
  E0B1  3E20          		LD	A,020H
  E0B3  01000B        		LD	BC,11*256	;C=0にしておく
  E0B6  2115EF        		LD	HL,FNAME
  E0B9                	FILL_MEMORY:			;HLからBバイトAで埋める
  E0B9  77            		LD	(HL),A
  E0BA  23            		INC	HL
  E0BB  10FC          		DJNZ	FILL_MEMORY
  E0BD  C9            		RET
                      	
  E0BE                	CCHKF:
  E0BE  1A            		LD	A,(DE)
  E0BF  CDC6E0        		CALL	CCHK2
  E0C2  C8            		RET	Z
  E0C3  C331E4        		JP	FKAN
                      	
  E0C6                	CCHK2:
  E0C6  0C            		INC	C
  E0C7  0D            		DEC	C
  E0C8  C0            		RET	NZ
  E0C9                	CCHK3:				;ZF=1 で使えない文字
  E0C9  FE2B          		CP	'+'
  E0CB  C8            		RET	Z
  E0CC  FE2C          		CP	','
  E0CE  C8            		RET	Z
  E0CF  FE2F          		CP	'/'
  E0D1  C8            		RET	Z
  E0D2  FE3A          		CP	':'
  E0D4  C8            		RET	Z
  E0D5  FE3B          		CP	';'
  E0D7  C8            		RET	Z
  E0D8  FE3D          		CP	'='
  E0DA  C8            		RET	Z
  E0DB  FE5C          		CP	05CH	;\
  E0DD  C8            		RET	Z
  E0DE  FE20          		CP	020H
  E0E0  D0            		RET	NC
  E0E1  BF            		CP	A		;Z=1
  E0E2  C9            		RET
                      	
  E0E3                	SS1:
  E0E3  13            		INC	DE
  E0E4                	SPCUT:				;スペースをカット
  E0E4  1A            		LD	A,(DE)
  E0E5  FE20          		CP	020H
  E0E7  28FA          		JR	Z,SS1
  E0E9  C9            		RET
                      	
  E0EA                	SETDRVF:
  E0EA  1114EF        		LD	DE,FDRV
  E0ED                	SETDRV0:
  E0ED  CDF6E0        		CALL	SETDRV
  E0F0  FDE1          		POP	IY
  E0F2  C1            		POP	BC
  E0F3  D1            		POP	DE
  E0F4  E1            		POP	HL
  E0F5  C9            		RET
                      	
  E0F6                	SETDRV:
  E0F6  E3            		EX	(SP),HL		;HL=RETRN ADDRESS
  E0F7  D5            		PUSH	DE		;PUSH HL/DE/BC/IY
  E0F8  C5            		PUSH	BC
  E0F9  1A            		LD	A,(DE)
  E0FA  D5            		PUSH	DE
  E0FB  FDE3          		EX	(SP),IY
                      	
  E0FD  CD09E1        		CALL	GETDRV
  E100  3C            		INC	A
  E101  FD7700        		LD	(IY+0),A	;(FCB)ドライブ番号
  E104  3D            		DEC	A
  E105  CDD9EF        		CALL	_CHGDRV
                      	
  E108  E9            		JP	(HL)
                      	
  E109                	GETDRV:
  E109  E67F          		AND	07FH
  E10B  D601          		SUB	001H
  E10D  3003          		JR	NC,GETDRV1
  E10F  3A87EF        		LD	A,(_DVSW)	;Current Drive
  E112                	GETDRV1:
  E112  3288EF        		LD	(_DRV),A
  E115  C9            		RET
                      	
  E116                	SOPENX:
  E116  1139EF        		LD	DE,SFILE
  E119  1A            		LD	A,(DE)
  E11A  FDBE00        		CP	(IY+0)		;(FCB)ドライブ番号
  E11D  2024          		JR	NZ,SOPEN
  E11F  13            		INC	DE
  E120  FDE5          		PUSH	IY
  E122  E1            		POP	HL
  E123  23            		INC	HL
  E124  CDB1E2        		CALL	CPFILE
  E127  201A          		JR	NZ,SOPEN
                      	
  E129  2AF4F0        		LD	HL,(SCDIR)
  E12C  FD750E        		LD	(IY+14),L	;(FCB)アクセスするディレクトリのクラスタ番号+1
  E12F  FD740F        		LD	(IY+15),H
                      	
  E132  2AF8F0        		LD	HL,(SFNDF)	;Direcroty location and Flags
  E135  229FEF        		LD	(_FILEN),HL
                      	
  E138  ED5BF6F0      		LD	DE,(SFBPS)
  E13C  2139EF        		LD	HL,SFILE
  E13F  36FF          		LD	(HL),0FFH
  E141  23            		INC	HL
  E142  C9            		RET
  E143                	SOPEN:
  E143  2159E2        		LD	HL,FILESE
  E146                	SOPENC:
  E146  227FE1        		LD	(OPENPAT+1),HL
                      	
  E149  CDE2EF        		CALL	_RDFATX		;Detect Media
  E14C  3856          		JR	C,RDDERR
                      	
  E14E  AF            		XOR	A
  E14F  329FEF        		LD	(_FILEN),A
  E152  CD5EE3        		CALL	LDDIRX1		;A=0で呼び出す
  E155  2818          		JR	Z,SDIRX1
                      	
  E157  CD4AE2        		CALL	READ_DIR	;Sub Directory
  E15A  3808          		JR	C,SDIRX0
  E15C  2A7EF0        		LD	HL,(_DTBUF)
  E15F  7E            		LD	A,(HL)
  E160  FE2E          		CP	'.'
  E162  280F          		JR	Z,SOPEN1
  E164                	SDIRX0:
  E164  AF            		XOR	A
  E165  32A0EF        		LD	(_DIRF),A
  E168  FD360E01      		LD	(IY+14),1	;(FCB)レコードサイズ
  E16C  FD770F        		LD	(IY+15),A
  E16F                	SDIRX1:
  E16F  ED5BFCF0      		LD	DE,(_DIRPS)	;Root Directory
  E173                	SOPEN1:
  E173  0E20          	SDECPAT:LD	C,32		;自己書き換え 1セクタ辺りのディレクトリエントリ数  1024=32 / 512=16 / 256=8
  E175                	SOPEN1X:
  E175  CD4AE2        		CALL	READ_DIR	;FILE SEARCH
  E178  382A          		JR	C,RDDERR
  E17A  2A7EF0        		LD	HL,(_DTBUF)
  E17D                	SOPEN2:
  E17D  D5            		PUSH	DE
  E17E  CD59E2        	OPENPAT:CALL	FILESE		;(self-modifying code)
  E181  D1            		POP	DE
  E182  386E          		JR	C,SOPENE
  E184  281B          		JR	Z,SCF_FF_RET
  E186                	SOPEN3:
  E186  3AA0EF        		LD	A,(_DIRF)	;ディレクトリか判別
  E189  B7            		OR	A
  E18A  200C          		JR	NZ,SOPEN5
  E18C  13            		INC	DE		;ルートディレクトリ
  E18D  E5            		PUSH	HL
  E18E  210C00        	MD_PAT:	LD	HL,12		;(self-modifying code)MAXDIR
  E191  ED52          		SBC	HL,DE		;CF=0 なので SUB HL,DE
  E193  E1            		POP	HL
  E194  20DD          		JR	NZ,SOPEN1
  E196  1807          		JR	SOPEN6
  E198                	SOPEN5:
  E198  CD8DEA        		CALL	GNCLX		;END DIR
  E19B  D8            		RET	C
  E19C  CD11E3        		CALL	ENDCL
  E19F                	SOPEN6:
  E19F  38D2          		JR	C,SOPEN1
  E1A1                	SCF_FF_RET:
  E1A1  37            		SCF			;CF=1
  E1A2  9F            		SBC	A,A		;A=0FFH
  E1A3  C9            		RET
                      	
  E1A4                	RDDERR:
  E1A4  BF            		CP	A		;READ ERR CF=1 ZF=1
  E1A5  37            		SCF
  E1A6  C9            		RET
                      	
  E1A7                	NOPEN:
  E1A7  2159E2        		LD	HL,FILESE
  E1AA  227FE1        		LD	(OPENPAT+1),HL
  E1AD  FD2A98EF      		LD	IY,(_FCB)
  E1B1  CD44E4        		CALL	CHKWILDX
  E1B4  30EB          		JR	NC,SCF_FF_RET
  E1B6  FD7E00        		LD	A,(IY+0)	;(FCB)ドライブ番号
  E1B9  3D            		DEC	A
  E1BA  3288EF        		LD	(_DRV),A
  E1BD  CDD9EF        		CALL	_CHGDRV
  E1C0  D8            		RET	C
  E1C1  2AF8F0        		LD	HL,(SFNDF)	;Direcroty location and Flags
  E1C4  229FEF        		LD	(_FILEN),HL
                      	
  E1C7  CD59E3        		CALL	LDDIRX
  E1CA  ED5B9AEF      		LD	DE,(_FBPS)
  E1CE  CD4AE2        		CALL	READ_DIR
  E1D1  38D1          		JR	C,RDDERR
  E1D3  3A9EEF        		LD	A,(_FBCNT)
  E1D6  3D            		DEC	A
  E1D7  28AD          		JR	Z,SOPEN3
  E1D9                	NOPEN2:
  E1D9  2A9CEF        		LD	HL,(_FBAD)
  E1DC  012000        		LD	BC,020H
  E1DF  09            		ADD	HL,BC
  E1E0  4F            		LD	C,A
  E1E1  189A          		JR	SOPEN2
                      	
  E1E3                	SOPENE2:
  E1E3  229CEF        		LD	(_FBAD),HL
  E1E6  79            		LD	A,C
  E1E7  329EEF        		LD	(_FBCNT),A
  E1EA  ED539AEF      		LD	(_FBPS),DE
  E1EE  FD2298EF      		LD	(_FCB),IY
  E1F2                	SOPENE:
  E1F2  AF            		XOR	A
  E1F3  C9            		RET
                      	
  E1F4                	COPEN:
  E1F4  FD360D20      		LD	(IY+13),020H	;(FCB)属性(アトリビュート)
                      	
  E1F8  2176E2        		LD	HL,NEXTSE
  E1FB  CD46E1        		CALL	SOPENC
  E1FE  D0            		RET	NC
  E1FF  C8            		RET	Z
  E200  3AA0EF        		LD	A,(_DIRF)	;ディレクトリか判別
  E203  B7            		OR	A
  E204  37            		SCF
  E205  C8            		RET	Z		;ルートディレクトリ
  E206  0601          		LD	B,1
  E208  CDA2E4        		CALL	WRDF
  E20B  D8            		RET	C
  E20C  ED5BFEF0      		LD	DE,(_CLPS)
  E210  D5            		PUSH	DE
  E211  CDDAE2        		CALL	DCPAT
  E214  CD18E9        		CALL	DRDNX
  E217  2A7EF0        		LD	HL,(_DTBUF)	;ディレクトリエントリを0クリア
  E21A  3A16E8        		LD	A,(SECSZ+2)	;1024=4 / 512=2 / 256=1
  E21D  47            		LD	B,A
  E21E  AF            		XOR	A
  E21F  4F            		LD	C,A
  E220                	COPENCL:
  E220  77            		LD	(HL),A
  E221  EDA1          		CPI			;HL=HL+1 BC=BC-1 BCが0の場合にP/V=0
  E223  EA20E2        		JP	PE,COPENCL
                      	
  E226  3AF8E2        		LD	A,(SPCPAT+1)	;1クラスタの論理セクタ数
  E229  3D            		DEC	A
  E22A  2819          		JR	Z,COPENE
  E22C  3E01          		LD	A,1		;1セクタ辺りのセクタ数が2以上の場合
  E22E  3285EA        		LD	(_SECPS+1),A
  E231  D1            		POP	DE		;DE=(_CLPS)
  E232  D5            		PUSH	DE
  E233                	COPEN1:
  E233  D5            		PUSH	DE		;データバッファに入らないセクタもゼロクリア
  E234  C5            		PUSH	BC
  E235  2A7EF0        		LD	HL,(_DTBUF)
  E238  CDF4E2        		CALL	CLUSTX
  E23B  CD1DEC        		CALL	DWT24
  E23E  C1            		POP	BC
  E23F  D1            		POP	DE
  E240  CD84EA        		CALL	NEXTX
  E243  20EE          		JR	NZ,COPEN1
  E245                	COPENE:
  E245  2A7EF0        		LD	HL,(_DTBUF)
  E248  D1            		POP	DE
  E249  C9            		RET
                      	
  E24A                	READ_DIR:
  E24A  ED53FEF0      		LD	(_CLPS),DE
  E24E  C5            		PUSH	BC
  E24F  D5            		PUSH	DE
  E250  CDDAE2        		CALL	DCPAT
  E253  CDF8E8        		CALL	DRDX
  E256  D1            		POP	DE
  E257  C1            		POP	BC
  E258  C9            		RET
                      	
  E259                	FILESE:
  E259  7E            		LD	A,(HL)
  E25A  B7            		OR	A
  E25B  C8            		RET	Z		;END:ZF=1 CF=0
  E25C  FEE5          		CP	0E5H
  E25E  280E          		JR	Z,FILESE1
  E260  FDE5          		PUSH	IY
  E262  D1            		POP	DE
  E263  13            		INC	DE
  E264  E5            		PUSH	HL
  E265  CDB1E2        		CALL	CPFILE
  E268  CCD2E2        		CALL	Z,CPFILE2
  E26B  E1            		POP	HL
  E26C  37            		SCF
  E26D  C8            		RET	Z		;!!!:(ZF=1) CF=1
  E26E                	FILESE1:
  E26E  CD85E2        		CALL	FNEXT
  E271  20E6          		JR	NZ,FILESE
  E273                	ZF0_CF0_AFF_RET:
  E273  F6FF          		OR	0FFH		;ZF=0 CF=0
  E275  C9            		RET
                      	
  E276                	NEXTSE:
  E276  7E            		LD	A,(HL)
  E277  B7            		OR	A
  E278  37            		SCF
  E279  C8            		RET	Z		;!!!:ZF=1 CF=1
  E27A  FEE5          		CP	0E5H
  E27C  37            		SCF
  E27D  C8            		RET	Z		;!!!:(ZF=1) CF=1
  E27E  CD85E2        		CALL	FNEXT
  E281  20F3          		JR	NZ,NEXTSE
  E283  18EE          		JR	ZF0_CF0_AFF_RET
                      	
  E285                	FNEXT:
  E285  E5            		PUSH	HL
  E286  219FEF        		LD	HL,_FILEN
  E289  34            		INC	(HL)
  E28A  E1            		POP	HL
  E28B  112000        		LD	DE,020H
  E28E  19            		ADD	HL,DE
  E28F  0D            		DEC	C
  E290  C9            		RET
                      	
  E291                	CPNAME:
  E291  C5            		PUSH	BC
  E292  D5            		PUSH	DE
  E293  E5            		PUSH	HL
  E294  CDABE2        		CALL	CPFILE4
  E297  E1            		POP	HL
  E298  23            		INC	HL
  E299  23            		INC	HL
  E29A  23            		INC	HL
  E29B  23            		INC	HL
  E29C  D1            		POP	DE
  E29D  C1            		POP	BC
  E29E  2005          		JR	NZ,CPNAME1
  E2A0  7E            		LD	A,(HL)
  E2A1  23            		INC	HL
  E2A2  66            		LD	H,(HL)
  E2A3  6F            		LD	L,A
  E2A4  C9            		RET
  E2A5                	CPNAME1:
  E2A5  23            		INC	HL
  E2A6  23            		INC	HL
  E2A7  10E8          		DJNZ	CPNAME
  E2A9  37            		SCF
  E2AA  C9            		RET
                      	
  E2AB                	CPFILE4:
  E2AB  C5            		PUSH	BC
  E2AC  010004        		LD	BC,00400H
  E2AF  1804          		JR	CPSTR1
  E2B1                	CPFILE:
  E2B1  C5            		PUSH	BC
  E2B2  01000B        		LD	BC,00B00H
  E2B5                	CPSTR1:
  E2B5  1A            		LD	A,(DE)
  E2B6  FE3F          		CP	'?'		;Wild card
  E2B8  2812          		JR	Z,CPSTR2
  E2BA  7E            		LD	A,(HL)
  E2BB  CD2AE4        		CALL	FKANC
  E2BE  E5            		PUSH	HL
  E2BF  67            		LD	H,A
  E2C0  1A            		LD	A,(DE)
  E2C1  CB01          		RLC	C
  E2C3  CD2AE4        		CALL	FKANC
  E2C6  CB09          		RRC	C
  E2C8  BC            		CP	H		;CP (HL),(DE)
  E2C9  E1            		POP	HL
  E2CA  2004          		JR	NZ,CPSTR3
  E2CC                	CPSTR2:
  E2CC  13            		INC	DE
  E2CD  23            		INC	HL
  E2CE  10E5          		DJNZ	CPSTR1
  E2D0                	CPSTR3:
  E2D0  C1            		POP	BC
  E2D1  C9            		RET
                      	
  E2D2                	CPFILE2:
  E2D2  FD7E0D        		LD	A,(IY+13)	;(FCB)属性(アトリビュート)
  E2D5  F6E1          		OR	0E1H
  E2D7  2F            		CPL
  E2D8  A6            		AND	(HL)
  E2D9  C9            		RET
                      	
  E2DA                	DCPAT:
  E2DA  0E00          		LD	C,0
  E2DC  2A7EF0        		LD	HL,(_DTBUF)
  E2DF  3AA0EF        		LD	A,(_DIRF)	;ディレクトリか判別
  E2E2  B7            		OR	A
  E2E3  C8            		RET	Z		;ルートディレクトリの場合はCレジスタを0にしておく(CDEがセクタ番号)
  E2E4  3AF8E2        		LD	A,(SPCPAT+1)
  E2E7  4F            		LD	C,A
  E2E8  3A85EA        		LD	A,(_SECPS+1)
  E2EB  B9            		CP	C
  E2EC  3801          		JR	C,DC1
  E2EE  AF            		XOR	A
  E2EF                	DC1:
  E2EF  F680          		OR	080H
  E2F1  32A0EF        		LD	(_DIRF),A	;bit0-6:セクタインデックス
  E2F4                	CLUSTX:
  E2F4  E5            		PUSH	HL
  E2F5  EB            		EX	DE,HL
  E2F6  AF            		XOR	A
  E2F7  0E01          	SPCPAT:	LD	C,1		;自己書き換え（1クラスタの論理セクタ数）
  E2F9                	L_CLDBL:
  E2F9  CB19          		RR	C		;->CF
  E2FB  3804          		JR	C,E_CLDBL
  E2FD  29            		ADD	HL,HL		;*2
  E2FE  8F            		ADC	A,A
  E2FF  18F8          		JR	L_CLDBL
  E301                	E_CLDBL:
  E301  4F            		LD	C,A
  E302  3A85EA        		LD	A,(_SECPS+1)
  E305  B5            		OR	L
  E306  6F            		LD	L,A
  E307  110800        	CLSPAT:	LD	DE,8	;+8 (2D)  !ADDCL (self-modifying code)
  E30A  AF            		XOR	A
  E30B  19            		ADD	HL,DE	;データ格納領域の先頭論理セクタ番号
  E30C  89            		ADC	A,C
  E30D  4F            		LD	C,A
  E30E  EB            		EX	DE,HL
  E30F  E1            		POP	HL
  E310  C9            		RET
                      	
  E311                	ENDCL:
  E311  7A            		LD	A,D	;END CLUSTER
  E312  FE01          	CLPAT1:	CP	1	;164=356	(self-modifying code)
  E314  C0            		RET	NZ
  E315  7B            		LD	A,E
  E316  FE64          	CLPAT2:	CP	064H	;		(self-modifying code)
  E318  C9            		RET
                      	
  E319                	CAP:
  E319  FE61          		CP	'a'
  E31B  D8            		RET	C
  E31C  FE7B          		CP	'z'+1
  E31E  D0            		RET	NC
  E31F  D620          		SUB	020H
  E321  C9            		RET
  E322                	CAP2:
  E322  CD19E3        		CALL	CAP
  E325                	CAP3:
  E325  CD2EE3        		CALL	CAP4
  E328  FE21          		CP	021H
  E32A  D0            		RET	NC
  E32B  3EA0          		LD	A,0A0H
  E32D  C9            		RET
  E32E                	CAP4:
  E32E  FE05          		CP	5
  E330  C0            		RET	NZ
  E331  3EE5          		LD	A,0E5H
  E333  C9            		RET
                      	
  E334                	CHDIR:
  E334  CD4BED        		CALL	GETDPBD
  E337  381D          		JR	C,CHDIR2
  E339  DD751A        		LD	(IX+01AH),L		;_SDIR_
  E33C  DD741B        		LD	(IX+01BH),H		;_SDIR_+1
  E33F  1815          		JR	CHDIR2		;POP_IX_RET
                      	
  E341                	LDDIR:
  E341  CD4BED        		CALL	GETDPBD
  E344  DD5E1A        		LD	E,(IX+01AH)		;_SDIR_
  E347  DD561B        		LD	D,(IX+01BH)		;_SDIR_+1
  E34A  13            		INC	DE
  E34B  FD730E        		LD	(IY+14),E	;(FCB)アクセスするディレクトリのクラスタ番号+1
  E34E  FD720F        		LD	(IY+15),D
  E351  1B            		DEC	DE
  E352  AF            		XOR	A
  E353  32A0EF        		LD	(_DIRF),A
  E356                	CHDIR2:
  E356  DDE1          		POP	IX
  E358  C9            		RET
                      	
  E359                	LDDIRX:
  E359  3AA0EF        		LD	A,(_DIRF)	;(FCB)アクセスするディレクトリのセクタインデックス
  E35C  E67F          		AND	07FH
  E35E                	LDDIRX1:
  E35E  3285EA        		LD	(_SECPS+1),A
  E361  FD5E0E        		LD	E,(IY+14)	;(FCB)アクセスするディレクトリのクラスタ番号+1
  E364  FD560F        		LD	D,(IY+15)
  E367  1B            		DEC	DE
  E368  CD11E3        		CALL	ENDCL
  E36B  D441E3        		CALL	NC,LDDIR
  E36E                	LDDIRS:
  E36E  7A            		LD	A,D
  E36F  B3            		OR	E
  E370  32A0EF        		LD	(_DIRF),A	;ディレクトリか判別
  E373  C9            		RET
                      	
  E374                	KILL:
  E374  CD44E4        		CALL	CHKWILDX
  E377  3834          		JR	C,KILLW
  E379  CD16E1        		CALL	SOPENX
  E37C                	KILLS:
  E37C  3E1F          		LD	A,01FH
  E37E  D4C0E3        		CALL	NC,CHKATT
  E381  D8            		RET	C
  E382                	KILLSX:
  E382  36E5          		LD	(HL),0E5H	;DIR
  E384  CD1EE4        		CALL	WTDB
  E387  111A00        		LD	DE,01AH
  E38A  19            		ADD	HL,DE
  E38B  5E            		LD	E,(HL)
  E38C  23            		INC	HL
  E38D  56            		LD	D,(HL)
  E38E                	KILLS1:
  E38E  CD11E3        		CALL	ENDCL
  E391  D0            		RET	NC		;CF=0
  E392  21FEFF        		LD	HL,0-2
  E395  19            		ADD	HL,DE
  E396  D0            		RET	NC		;DE= 0 or 1
  E397  D5            		PUSH	DE
  E398  CDF7EF        		CALL	_GNCL
  E39B  ED53FEF0      		LD	(_CLPS),DE
  E39F  D1            		POP	DE
  E3A0  210000        		LD	HL,0
  E3A3  D4FAEF        		CALL	NC,_SNCL
  E3A6  D8            		RET	C
  E3A7  ED5BFEF0      		LD	DE,(_CLPS)	;FAT
  E3AB  18E1          		JR	KILLS1
                      	
  E3AD                	KILLW:
  E3AD  CD43E1        		CALL	SOPEN
  E3B0                	KILLW1:
  E3B0  380B          		JR	C,KILLW2
  E3B2  CDE3E1        		CALL	SOPENE2
  E3B5  CD7CE3        		CALL	KILLS
  E3B8  CDA7E1        		CALL	NOPEN
  E3BB  18F3          		JR	KILLW1
  E3BD                	KILLW2:
  E3BD  C8            		RET	Z
  E3BE  3F            		CCF
  E3BF  C9            		RET
                      	
  E3C0                	CHKATT:
  E3C0  E5            		PUSH	HL
  E3C1  110B00        		LD	DE,00BH
  E3C4  19            		ADD	HL,DE
  E3C5  A6            		AND	(HL)
  E3C6  E1            		POP	HL
  E3C7  C8            		RET	Z
  E3C8  37            		SCF
  E3C9  C9            		RET
                      	
  E3CA                	NAME:
  E3CA  CD44E4        		CALL	CHKWILDX
  E3CD  D8            		RET	C
  E3CE  110400        		LD	DE,4
  E3D1  19            		ADD	HL,DE
  E3D2  22EAE3        		LD	(NAMEP+2),HL
  E3D5  23            		INC	HL
  E3D6  CD48E4        		CALL	CHKWILD
  E3D9  D8            		RET	C
                      	
  E3DA  CD16E1        		CALL	SOPENX
  E3DD  3E0F          		LD	A,00FH
  E3DF  D4C0E3        		CALL	NC,CHKATT
  E3E2  D8            		RET	C
                      	
  E3E3  FD7E00        		LD	A,(IY+0)
  E3E6  FDE5          		PUSH	IY
  E3E8  FD210000      	NAMEP:	LD	IY,0		;自己書き換え
  E3EC  FD7700        		LD	(IY+0),A
  E3EF  CD16E1        		CALL	SOPENX
  E3F2  FDE3          		EX	(SP),IY
  E3F4  3F            		CCF
  E3F5  D443E1        		CALL	NC,SOPEN
  E3F8  EB            		EX	DE,HL
  E3F9  E1            		POP	HL
  E3FA  D8            		RET	C
                      	
  E3FB                	SETNAME:
  E3FB  01000B        		LD	BC,11*256
  E3FE  23            		INC	HL
  E3FF  7E            		LD	A,(HL)
  E400  FEE5          		CP	0E5H
  E402  2004          		JR	NZ,SNAME1
  E404  3E05          		LD	A,5
  E406  180E          		JR	SNAME3
  E408                	SNAME1:
  E408  7E            		LD	A,(HL)
  E409  0C            		INC	C
  E40A  0D            		DEC	C
  E40B  2009          		JR	NZ,SNAME3
  E40D  CD19E3        		CALL	CAP
  E410  FEA0          		CP	0A0H
  E412  2002          		JR	NZ,SNAME3
  E414  3E20          		LD	A,020H
  E416                	SNAME3:
  E416  12            		LD	(DE),A
  E417  7E            		LD	A,(HL)
  E418  23            		INC	HL
  E419  CD31E4        		CALL	FKAN
  E41C  10EA          		DJNZ	SNAME1
  E41E                	WTDB:
  E41E  3EFF          		LD	A,0FFH
  E420  3239EF        		LD	(SFILE),A
  E423                	SWTDBF:
  E423  3E01          		LD	A,1
  E425  32A4EF        		LD	(_WTDBF),A
  E428  AF            		XOR	A
  E429  C9            		RET
                      	
  E42A                	FKANC:
  E42A  CB41          		BIT	0,C
  E42C  CC22E3        		CALL	Z,CAP2
  E42F  1801          		JR	FKANX
  E431                	FKAN:			;漢字チェック
  E431  13            		INC	DE
  E432                	FKANX:
  E432  CB41          		BIT	0,C
  E434  CB81          		RES	0,C
  E436  C0            		RET	NZ
  E437  FE80          		CP	080H
  E439  D8            		RET	C
  E43A  FEA0          		CP	0A0H
  E43C  3803          		JR	C,FKAN1
  E43E  FEE0          		CP	0E0H
  E440  D8            		RET	C
  E441                	FKAN1:
  E441  0C            		INC	C
  E442  A7            		AND	A
  E443  C9            		RET
                      	
  E444                	CHKWILDX:
  E444  FDE5          		PUSH	IY
  E446  E1            		POP	HL
  E447  23            		INC	HL
  E448                	CHKWILD:
  E448  060B          		LD	B,11
  E44A  3E3F          		LD	A,'?'
  E44C                	CHKWIL1:
  E44C  BE            		CP	(HL)
  E44D  23            		INC	HL
  E44E  37            		SCF
  E44F  C8            		RET	Z
  E450  10FA          		DJNZ	CHKWIL1
  E452  AF            		XOR	A
  E453  C9            		RET
                      	
  E454                	SDIRENT:		;IY=FCB HL=DIR
  E454  D5            		PUSH	DE
  E455  E5            		PUSH	HL
  E456  FDE5          		PUSH	IY
  E458  D1            		POP	DE
  E459  EB            		EX	DE,HL
  E45A  CDFBE3        		CALL	SETNAME
                      	;				Attribute
  E45D  FD7E0D        		LD	A,(IY+13)	;(FCB)属性(アトリビュート)
  E460  12            		LD	(DE),A
  E461  13            		INC	DE
                      	;				Reserved
  E462  AF            		XOR	A
  E463  060A          		LD	B,10
  E465                	SDE1:
  E465  12            		LD	(DE),A
  E466  13            		INC	DE
  E467  10FC          		DJNZ	SDE1
                      						;(FCB)更新時刻
  E469  21EAF0        		LD	HL,SDDATA		;(FCB)更新年月日
  E46C  060A          		LD	B,SDDATAE-SDDATA	;(FCB)ファイルの先頭クラスタ
  E46E                	SDLOOP:					;(FCB)ファイルのサイズ(バイト単位)
  E46E  7E            		LD	A,(HL)
  E46F  23            		INC	HL
  E470  3275E4        		LD	(SDPAT+2),A
  E473  FD7E00        	SDPAT:	LD	A,(IY+0)	;LD A,(IY+A)
  E476  12            		LD	(DE),A
  E477  13            		INC	DE
  E478  10F4          		DJNZ	SDLOOP
                      	
  E47A  AF            		XOR	A
  E47B  E1            		POP	HL
  E47C  D1            		POP	DE
  E47D  C9            		RET
                      	
  E47E                	WOPEN:
  E47E  FD7E0D        		LD	A,(IY+13)	;(FCB)属性(アトリビュート)
  E481  E61F          		AND	01FH
  E483  37            		SCF
  E484  C0            		RET	NZ
  E485  FD361CFE      		LD	(IY+28),0FEH	;(FCB)オープンモード
  E489                	TOPEN2:
  E489  AF            		XOR	A
  E48A                	TOPEN:				;Initializes the time stamp
  E48A  FD3617FF      		LD	(IY+23),0FFH	;(FCB)更新時刻
  E48E  C9            		RET
                      	
  E48F                	WRDFX:
  E48F  3AF8E2        		LD	A,(SPCPAT+1)	;1クラスタの論理セクタ
  E492                	L_WRFX:
  E492  1F            		RRA			;->CF
  E493  3806          		JR	C,E_WRFX
  E495  CB39          		SRL	C
  E497  CB1C          		RR	H		;CH=CH/2
  E499  18F7          		JR	L_WRFX
  E49B                	E_WRFX:
  E49B  44            		LD	B,H
  E49C  04            		INC	B
  E49D  3E37          		LD	A,037H		;SCF
  E49F  3215E9        		LD	(DRDN1),A
                      	
  E4A2                	WRDF:				;Bクラスタ分FATを確保する
  E4A2  110200        		LD	DE,2
  E4A5  AF            		XOR	A
  E4A6  3285EA        		LD	(_SECPS+1),A
  E4A9                	WRDF1:
  E4A9  C5            		PUSH	BC
  E4AA  D5            		PUSH	DE
  E4AB  CDF7EF        		CALL	_GNCL
  E4AE  381C          		JR	C,WRDF3
  E4B0  7A            		LD	A,D		;空いているかチェック
  E4B1  B3            		OR	E
  E4B2  2027          		JR	NZ,WRDF4
  E4B4  E1            		POP	HL		;HL=空いているクラスタ
  E4B5  E5            		PUSH	HL
  E4B6  ED5BFEF0      		LD	DE,(_CLPS)	;DE=元の(_CLPS)
  E4BA  22FEF0        		LD	(_CLPS),HL
  E4BD  7A            		LD	A,D		;元の(_CLPS)が 0 か?
  E4BE  B3            		OR	E
  E4BF  2008          		JR	NZ,WRDF2
  E4C1  FD751A        		LD	(IY+26),L	;(FCB)ファイルの先頭クラスタ
  E4C4  FD741B        		LD	(IY+27),H	;元が空の場合はFCBにクラスタをセットする
  E4C7  1803          		JR	WRDF3
  E4C9                	WRDF2:
  E4C9  CDFAEF        		CALL	_SNCL
  E4CC                	WRDF3:
  E4CC  D1            		POP	DE
  E4CD  C1            		POP	BC
  E4CE  D8            		RET	C
  E4CF  100C          		DJNZ	WRDF5		;ここでループカウンタチェック
  E4D1  ED5BFEF0      		LD	DE,(_CLPS)
  E4D5  21FFFF        		LD	HL,0FFFFH	;FATエントリ終了(EOCマーク)
  E4D8  C3FAEF        		JP	_SNCL
                      	
  E4DB                	WRDF4:				;DEクラスタが空じゃないので次に移動する
  E4DB  D1            		POP	DE
  E4DC  C1            		POP	BC
  E4DD                	WRDF5:
  E4DD  13            		INC	DE
  E4DE  CD11E3        		CALL	ENDCL
  E4E1  38C6          		JR	C,WRDF1
  E4E3  37            		SCF
  E4E4  C9            		RET
                      	
  E4E5                	RWXR:
  E4E5  3A16E8        		LD	A,(SECSZ+2)	;1024=4 / 512=2 / 256=1
  E4E8                	L_RWX:
  E4E8  1F            		RRA		;->CF
  E4E9  3808          		JR	C,E_RWX
  E4EB  CB38          		SRL	B	;BCH=BCH/2
  E4ED  CB19          		RR	C	;
  E4EF  CB1C          		RR	H	;
  E4F1  18F5          		JR	L_RWX
  E4F3                	E_RWX:
  E4F3  FD5E1A        		LD	E,(IY+26)	;(FCB)ファイルの先頭クラスタ
  E4F6  FD561B        		LD	D,(IY+27)
  E4F9  AF            		XOR	A
  E4FA  3285EA        		LD	(_SECPS+1),A
  E4FD                	RWX1:
  E4FD  ED53FEF0      		LD	(_CLPS),DE
  E501  7A            		LD	A,D
  E502  B3            		OR	E
  E503  2813          		JR	Z,SCF_RET	;RET DE==0 => CF=1
                      	
  E505  78            		LD	A,B
  E506  B1            		OR	C
  E507  B4            		OR	H
  E508  C8            		RET	Z		;RET BCH==0 => CF=0
                      	
  E509  CD8DEA        		CALL	GNCLX
  E50C  D8            		RET	C
  E50D  7C            		LD	A,H		;
  E50E  25            		DEC	H		;
  E50F  B7            		OR	A		;DEC BCH
  E510  2001          		JR	NZ,RWX2		;
  E512  0B            		DEC	BC		;
  E513                	RWX2:
  E513  CD11E3        		CALL	ENDCL
  E516  38E5          		JR	C,RWX1
  E518                	SCF_RET:
  E518  37            		SCF
  E519  C9            		RET
                      	
  E51A                	DSKF:
  E51A  110000        	MAXCLP:	LD	DE,0
  E51D  2AACEF        		LD	HL,(_FAKEFREE)
  E520  7C            		LD	A,H
  E521  B5            		OR	L
  E522  2803          		JR	Z,DSKF1
  E524  110100        		LD	DE,1
  E527                	DSKF1:
  E527  D5            		PUSH	DE
  E528  CDF7EF        		CALL	_GNCL
  E52B  380C          		JR	C,POPSCF
  E52D  7A            		LD	A,D
  E52E  B3            		OR	E
  E52F  2001          		JR	NZ,DSKF2
  E531  23            		INC	HL
  E532                	DSKF2:
  E532  D1            		POP	DE
  E533  1B            		DEC	DE
  E534  7A            		LD	A,D
  E535  B3            		OR	E
  E536  20EF          		JR	NZ,DSKF1
  E538  C9            		RET
                      	
  E539                	POPSCF:
  E539  F1            		POP	AF
  E53A  37            		SCF
  E53B  C9            		RET
                      	
  E53C                	SETTMS:
  E53C  FD7E17        		LD	A,(IY+23)	;(FCB)ファイルを最後に変更した時刻
  E53F  3C            		INC	A
  E540  C0            		RET	NZ		;ファイルが更新されていない
  E541                	SETTMSX:			;FCBに日付時刻をセットする
  E541  CDF2DB        		CALL	_SYS2C		;(BDOS)時刻の獲得
                      					;H←時  L←分  D←秒
  E544  CB25          		SLA	L		;   *2
  E546  CB25          		SLA	L		;   *4
  E548  29            		ADD	HL,HL		;*2 *8
  E549  29            		ADD	HL,HL		;*4 *16
  E54A  29            		ADD	HL,HL		;*8 *32
  E54B  7A            		LD	A,D
  E54C  0F            		RRCA			;bit.0->7->->->0->C
  E54D  E61F          		AND	01FH
  E54F  B5            		OR	L
  E550  FD7716        		LD	(IY+22),A	;(FCB)ファイルを最後に変更した時刻
  E553  FD7417        		LD	(IY+23),H
                      	
  E556  CDCFDB        		CALL	_SYS2A		;(BDOS)日付の獲得
                      					;HL←年  D←月  E←日
  E559  0144F8        		LD	BC,0-1980
  E55C  09            		ADD	HL,BC
  E55D  65            		LD	H,L
                      	
  E55E  7A            		LD	A,D
  E55F  87            		ADD	A,A		;*2
  E560  87            		ADD	A,A		;*4
  E561  87            		ADD	A,A		;*8
  E562  87            		ADD	A,A		;*16
  E563  6F            		LD	L,A
  E564  29            		ADD	HL,HL		;*32
  E565  7D            		LD	A,L
  E566  B3            		OR	E
  E567  FD7714        		LD	(IY+20),A	;(FCB)ファイルを最後に変更した日付
  E56A  FD7415        		LD	(IY+21),H
  E56D  C9            		RET
                      	
  E56E                	PUSHRR:
  E56E  320DE6        		LD	(SETSEQ_SWC_RND),A
  E571  221FE6        		LD	(SETSEQ_SWC_SEQ_RR),HL
  E574  CD94E5        		CALL	GET_RR_AHL
  E577  225AEF        		LD	(HLBUF),HL
  E57A  325CEF        		LD	(HLBUF+2),A
  E57D  C9            		RET
                      	
  E57E                	GET_CPM_R_SIZE:		;バイト単位からCP/Mのレコード単位を求める（1レコード=128バイト）
  E57E  87            		ADD	A,A		;in BHLA => out AHL
  E57F  ED6A          		ADC	HL,HL
  E581  CB18          		RR	B
  E583  B7            		OR	A
  E584  78            		LD	A,B		;ここでフラグは変化しない
  E585  C8            		RET	Z
  E586  2C            		INC	L		;INC AHL
  E587  C0            		RET	NZ		;
  E588  24            		INC	H		;
  E589  C0            		RET	NZ		;
  E58A  3C            		INC	A		;
  E58B  C9            		RET
                      	
  E58C                	INIT_RND:
  E58C  3ECD          		LD	A,0CDH		;CALL ????
  E58E  21DDE5        		LD	HL,POPRR
  E591  CD6EE5        		CALL	PUSHRR
  E594                	GET_RR_AHL:
  E594  FD6E21        		LD	L,(IY+33)	;(FCB)Random record
  E597  FD6622        		LD	H,(IY+34)	;
  E59A  FD7E23        		LD	A,(IY+35)	;
  E59D  C9            		RET
  E59E                	SET_RR_AHL:
  E59E  FD7521        		LD	(IY+33),L	;(FCB)Random record
  E5A1  FD7422        		LD	(IY+34),H
  E5A4  FD7723        		LD	(IY+35),A
  E5A7  C9            		RET
  E5A8                	INIT_SEQ:
  E5A8  3E01          		LD	A,1		;LD BC,????
  E5AA  21DAE5        		LD	HL,SETSEQ
  E5AD  CD6EE5        		CALL	PUSHRR
  E5B0                	GETSEQ:
  E5B0  FD6E20        		LD	L,(IY+32)	;(FCB)カレントレコード
  E5B3  FD660C        		LD	H,(IY+12)	;(FCB)カレントブロック
  E5B6  AF            		XOR	A
                      	
  E5B7  CB25          		SLA	L	;L=L*2
                      	
  E5B9  CB3C          		SRL	H	;HL=HL/2
  E5BB  CB1D          		RR	L	;
  E5BD  C9            		RET
                      	
  E5BE                	SETSEQ1:
  E5BE  F5            		PUSH	AF		
  E5BF  E5            		PUSH	HL		;AHL=Random record
  E5C0  FD7E21        		LD	A,(IY+33)	;(FCB)ランダムレコード
  E5C3  FD6E22        		LD	L,(IY+34)
  E5C6  FD6623        		LD	H,(IY+35)
  E5C9  0600          		LD	B,0
                      	
  E5CB  CD7EE5        		CALL	GET_CPM_R_SIZE
                      	
  E5CE  29            		ADD	HL,HL
  E5CF  CB3D          		SRL	L		;L=L/2
  E5D1  FD7520        		LD	(IY+32),L	;(FCB)カレントレコード
  E5D4  FD740C        		LD	(IY+12),H	;(FCB)カレントブロック
  E5D7  E1            		POP	HL
  E5D8  F1            		POP	AF
  E5D9  C9            		RET
  E5DA                	SETSEQ:
  E5DA  CDBEE5        		CALL	SETSEQ1
  E5DD                	POPRR:
  E5DD  F5            		PUSH	AF
  E5DE  E5            		PUSH	HL
  E5DF  2A5AEF        		LD	HL,(HLBUF)
  E5E2  3A5CEF        		LD	A,(HLBUF+2)
  E5E5  CD9EE5        		CALL	SET_RR_AHL
  E5E8  E1            		POP	HL
  E5E9  F1            		POP	AF
  E5EA  C9            		RET
                      	
  E5EB                	RB_WRITE:
  E5EB  C5            		PUSH	BC
  E5EC  ED4B4CF0      		LD	BC,(STABLE+2*026H)	;(BDOS)ランダムブロック書き込み
  E5F0  1805          		JR	RBRW
  E5F2                	RB_READ:
  E5F2  C5            		PUSH	BC
  E5F3  ED4B4EF0      		LD	BC,(STABLE+2*027H)	;(BDOS)ランダムブロック読み込み
  E5F7                	RBRW:
  E5F7  CB3F          		SRL	A	;AHLA' = HL*128
  E5F9  CB1C          		RR	H	;AHL=AHL/2
  E5FB  CB1D          		RR	L	;
  E5FD  3E00          		LD	A,0
  E5FF  1F            		RRA		;A'HLA
  E600  FD7721        		LD	(IY+33),A	;(FCB)ランダムレコード
  E603  FD7522        		LD	(IY+34),L
  E606  FD7423        		LD	(IY+35),H
  E609  218000        		LD	HL,128
  E60C  C5            		PUSH	BC
  E60D                	SETSEQ_SWC_RND:
  E60D  CDBEE5        		CALL	SETSEQ1
  E610  C1            		POP	BC
  E611  FDCB20FE      		SET	7,(IY+32)	;(FCB)カレントレコード
  E615  FDE5          		PUSH	IY
  E617  D1            		POP	DE
  E618  D5            		PUSH	DE
  E619  CD27E6        		CALL	JP_BC
  E61C  FDE1          		POP	IY
  E61F                	SETSEQ_SWC_SEQ_RR	EQU $+1
  E61E  CDDAE5        		CALL	SETSEQ
  E621  FDCB20BE      		RES	7,(IY+32)	;(FCB)カレントレコード
                      	
  E625  C1            		POP	BC
  E626  C9            		RET
  E627                	JP_BC:
  E627  C5            		PUSH	BC
  E628  C9            		RET
                      	
  E1A1                	_SYS03	EQU	SCF_FF_RET	;(BDOS)外部入力
  E1A1                	_SYS2B	EQU	SCF_FF_RET	;(BDOS)日付の設定
  E1A1                	_SYS2D	EQU	SCF_FF_RET	;(BDOS)時刻の設定
  E1A1                	_SYS39	EQU	SCF_FF_RET	;(BDOS)サブディレクトリの作成
  E1A1                	_SYS3A	EQU	SCF_FF_RET	;(BDOS)サブディレクトリの削除
                      	
                      	
                      	;LDFILE2.ASM
                      	
                      	;	LSX-Dodgers FILE2
                      	
                      					;Write random block
  E629                	_SYS26:		;(BDOS)ランダムブロック書き込み
  E629  AF            		XOR	A
  E62A  3215E9        		LD	(DRDN1),A	;NOP
  E62D  2259E8        		LD	(LEFT+1),HL	;HL←書き込むレコード数
  E630  225DEF        		LD	(LEFTX),HL
  E633  CDF6E0        		CALL	SETDRV
                      	
  E636  CDB0E7        		CALL	RBX0
  E639  DAD3E6        		JP	C,RBWERR
  E63C  CD7EE4        		CALL	WOPEN
  E63F  DAD3E6        		JP	C,RBWERR
  E642  7C            		LD	A,H
  E643  B5            		OR	L
  E644  CACCE6        		JP	Z,RBW1
                      	
  E647  2B            		DEC	HL
                      	
  E648  CD7BE8        		CALL	GET_RR_BCDE	;BCDE=Random record
                      	
  E64B  19            		ADD	HL,DE		;BCHL=HL+BCDE
  E64C  3001          		JR	NC,S26X1	;
  E64E  03            		INC	BC		;
  E64F                	S26X1:
  E64F  CDE5E4        		CALL	RWXR
  E652  DC8FE4        		CALL	C,WRDFX
  E655  DAD3E6        		JP	C,RBWERR
                      	
  E658  CDDFE7        		CALL	RBX2
  E65B  281A          		JR	Z,RBWB		;NZ=セクタ以下の端数がある
  E65D  CDFEE7        		CALL	RBXA
  E660  3871          		JR	C,RBWERR
  E662  EB            		EX	DE,HL
  E663  C5            		PUSH	BC
  E664  EDB0          		LDIR
  E666  225FEF        		LD	(DTAX),HL
                      	
  E669  CD23E4        		CALL	SWTDBF		;バッファデータは更新された
                      	
  E66C  2A5DEF        		LD	HL,(LEFTX)
  E66F  D1            		POP	DE
  E670  ED52          		SBC	HL,DE
  E672  225DEF        		LD	(LEFTX),HL
  E675  2833          		JR	Z,RBWEND
                      	
  E677                	RBWB:
  E677  CD34E8        		CALL	RBXB
  E67A  2816          		JR	Z,RBWC
  E67C                	RBWB1:
  E67C  C5            		PUSH	BC
  E67D  D5            		PUSH	DE
  E67E  CDF4E2        		CALL	CLUSTX
  E681  CD8FE8        		CALL	DWTC
  E684  D1            		POP	DE
  E685  C1            		POP	BC
  E686  384B          		JR	C,RBWERR
  E688  CD8DEA        		CALL	GNCLX
  E68B  3846          		JR	C,RBWERR
  E68D  10ED          		DJNZ	RBWB1
  E68F  CDDFE8        		CALL	DRW_FLUSH
  E692                	RBWC:
  E692  CD4CE8        		CALL	RBXC
  E695  2813          		JR	Z,RBWEND
  E697  C5            		PUSH	BC
  E698  CDF4E2        		CALL	CLUSTX
  E69B  CD14E9        		CALL	DRDN
  E69E  C1            		POP	BC
  E69F  3832          		JR	C,RBWERR
  E6A1  ED5B7EF0      		LD	DE,(_DTBUF)
  E6A5  EDB0          		LDIR
  E6A7  CD23E4        		CALL	SWTDBF		;バッファデータは更新された
  E6AA                	RBWEND:
  E6AA  CD58E8        		CALL	RBXEND
                      	
  E6AD  CDBFE7        		CALL	RBX1
  E6B0  301A          		JR	NC,RBW1
  E6B2  2A59E8        		LD	HL,(LEFT+1)
  E6B5  FD5E10        		LD	E,(IY+16)	;(FCB)ファイルのサイズ(バイト単位)
  E6B8  FD5611        		LD	D,(IY+17)	;DE=File size
  E6BB  19            		ADD	HL,DE
  E6BC  FD7510        		LD	(IY+16),L	;(FCB)ファイルのサイズ(バイト単位)
  E6BF  FD7411        		LD	(IY+17),H
  E6C2  3008          		JR	NC,RBW1
  E6C4  FD3412        		INC	(IY+18)
  E6C7  2003          		JR	NZ,RBW1
  E6C9  FD3413        		INC	(IY+19)
  E6CC                	RBW1:
  E6CC  FDE1          		POP	IY
  E6CE  C1            		POP	BC
  E6CF  D1            		POP	DE
  E6D0  E1            		POP	HL
  E6D1                	DD_NUL:
  E6D1  AF            		XOR	A
  E6D2                	DRDF0:
  E6D2                	DWTF0:
  E6D2  C9            		RET
                      	
  E6D3                	RBWERR:
  E6D3  FDE5          		PUSH	IY
  E6D5  D1            		POP	DE
  E6D6  2A20F0        		LD	HL,(STABLE+2*010H)
  E6D9  CD0F00        		CALL	JP_HL
  E6DC                	RBRERR1:
  E6DC  3E01          		LD	A,001H
  E6DE                	RBRERR2:
  E6DE  FDE1          		POP	IY
  E6E0  C1            		POP	BC
  E6E1  D1            		POP	DE
  E6E2  E1            		POP	HL
  E6E3  37            		SCF
  E6E4  210000        		LD	HL,0
  E6E7  C9            		RET
                      	
  E6E8                	RBRERR:
  E6E8  3EFF          		LD	A,0FFH
  E6EA  18F2          		JR	RBRERR2
                      	
  E6EC                	RBRFL:
  E6EC  3E00          	RBRFLP:	LD	A,000H
  E6EE  FE0D          		CP	00DH
  E6F0  2005          		JR	NZ,RBRFL1
  E6F2  D5            		PUSH	DE
  E6F3  1E0A          		LD	E,00AH
  E6F5  1805          		JR	RBRFL2
  E6F7                	RBRFL1:
  E6F7  D5            		PUSH	DE
  E6F8  CD09EF        		CALL	_SYS07
  E6FB  5F            		LD	E,A
  E6FC                	RBRFL2:
  E6FC  CDCDEF        		CALL	_PRINT
  E6FF  7B            		LD	A,E
  E700  D1            		POP	DE
  E701  32EDE6        		LD	(RBRFLP+1),A
  E704  C9            		RET
  E705                	DDX:
  E705  FD7E01        		LD	A,(IY+1)	;(FCB)主ファイル名
  E708  CD19E3        		CALL	CAP
  E70B  FE41          		CP	'A'
  E70D  C9            		RET
                      	
                      					;Read random block
  E70E                	_SYS27:		;(BDOS)ランダムブロック読み込み
  E70E  225DEF        		LD	(LEFTX),HL
  E711  CDF6E0        		CALL	SETDRV
                      	
  E714  FDCB0D66      		BIT	4,(IY+13)	;(FCB)属性(アトリビュート)
  E718  C29EE7        		JP	NZ,RBRDIR	;ディレクトリ
  E71B  CDB0E7        		CALL	RBX0
  E71E  DAE8E6        		JP	C,RBRERR
  E721  CDBFE7        		CALL	RBX1
  E724  DADCE6        		JP	C,RBRERR1
  E727  EB            		EX	DE,HL
  E728  ED52          		SBC	HL,DE		;CP 00HL,BCDE
  E72A  19            		ADD	HL,DE
  E72B  79            		LD	A,C
  E72C  DE00          		SBC	A,0
  E72E  78            		LD	A,B
  E72F  DE00          		SBC	A,0
  E731  3801          		JR	C,RBR1
  E733  EB            		EX	DE,HL
  E734                	RBR1:
  E734  9F            		SBC	A,A
  E735  E601          		AND	1
  E737  329CE7        		LD	(RBRAP+1),A
                      	
  E73A  7C            		LD	A,H
  E73B  B5            		OR	L
  E73C  2857          		JR	Z,RBREND0
                      	
  E73E  2259E8        		LD	(LEFT+1),HL	;Read record byte
  E741  225DEF        		LD	(LEFTX),HL
                      	
  E744  CDDFE7        		CALL	RBX2
  E747  2819          		JR	Z,RBRB
  E749  CDFEE7        		CALL	RBXA
  E74C  DAE8E6        		JP	C,RBRERR
  E74F  C5            		PUSH	BC
  E750  EDB0          		LDIR
  E752  ED535FEF      		LD	(DTAX),DE
  E756  2A5DEF        		LD	HL,(LEFTX)
  E759  D1            		POP	DE
  E75A  A7            		AND	A
  E75B  ED52          		SBC	HL,DE
  E75D  225DEF        		LD	(LEFTX),HL
  E760  2830          		JR	Z,RBREND
                      	
  E762                	RBRB:
  E762  CD34E8        		CALL	RBXB
  E765  2815          		JR	Z,RBRC
  E767                	RBRB1:
  E767  C5            		PUSH	BC
  E768  D5            		PUSH	DE
  E769  CDF4E2        		CALL	CLUSTX
  E76C  CD95E8        		CALL	DRDC
  E76F  D1            		POP	DE
  E770  C1            		POP	BC
  E771  D48DEA        		CALL	NC,GNCLX
  E774  DAE8E6        		JP	C,RBRERR
  E777  10EE          		DJNZ	RBRB1
  E779  CDDFE8        		CALL	DRW_FLUSH
  E77C                	RBRC:
  E77C  CD4CE8        		CALL	RBXC
  E77F  2811          		JR	Z,RBREND
  E781  C5            		PUSH	BC
  E782  CDF4E2        		CALL	CLUSTX
  E785  CDF8E8        		CALL	DRDX
  E788  C1            		POP	BC
  E789  DAE8E6        		JP	C,RBRERR
  E78C  EB            		EX	DE,HL
  E78D  2A7EF0        		LD	HL,(_DTBUF)
  E790  EDB0          		LDIR
  E792                	RBREND:
  E792  CD58E8        		CALL	RBXEND
  E795                	RBREND0:
  E795  FDE1          		POP	IY
  E797  C1            		POP	BC
  E798  D1            		POP	DE
  E799  F1            		POP	AF	;(HL)
  E79A  AF            		XOR	A
  E79B  3E00          	RBRAP:	LD	A,000H
  E79D  C9            		RET
                      	
  E79E                	RBRDIR:
  E79E  FD6E1A        		LD	L,(IY+26)	;(FCB)ファイルの先頭クラスタ
  E7A1  FD661B        		LD	H,(IY+27)
  E7A4  CD34E3        		CALL	CHDIR
  E7A7  AF            		XOR	A
  E7A8  67            		LD	H,A
  E7A9  6F            		LD	L,A
  E7AA  3C            		INC	A
  E7AB  329CE7        		LD	(RBRAP+1),A
  E7AE  18E5          		JR	RBREND0
                      	
  E7B0                	RBX0:
  E7B0  2A8AEF        		LD	HL,(_DTA)
  E7B3  225FEF        		LD	(DTAX),HL
  E7B6  2A5DEF        		LD	HL,(LEFTX)
  E7B9  FD7E1C        		LD	A,(IY+28)	;(FCB)オープンモード
  E7BC  D6FD          		SUB	0FDH
  E7BE  C9            		RET
                      	
  E7BF                	RBX1:
  E7BF  E5            		PUSH	HL		;Record byte
                      					;AHL=File size
  E7C0  FD6E10        		LD	L,(IY+16)	;ファイルのサイズ(バイト単位)
  E7C3  FD6611        		LD	H,(IY+17)	;
  E7C6  FD7E12        		LD	A,(IY+18)	;
                      	
  E7C9  CD7BE8        		CALL	GET_RR_BCDE	;BCDE=Random record
                      	
  E7CC  A7            		AND	A
  E7CD  ED52          		SBC	HL,DE
  E7CF  99            		SBC	A,C
  E7D0  4F            		LD	C,A
  E7D1  FD7E13        		LD	A,(IY+19)	;ファイルのサイズ
  E7D4  98            		SBC	A,B
  E7D5  D1            		POP	DE
                      	
  E7D6  D8            		RET	C
  E7D7  47            		LD	B,A
  E7D8  B1            		OR	C
  E7D9  EB            		EX	DE,HL	;BCDE=File byte	HL=Record byte
  E7DA  B2            		OR	D
  E7DB  B3            		OR	E
  E7DC  C0            		RET	NZ
  E7DD  37            		SCF
  E7DE  C9            		RET
                      	
  E7DF                	RBX2:				;Cluster settings
  E7DF  FD6622        		LD	H,(IY+34)	;(+33)(FCB)ランダムレコード
  E7E2  FD4E23        		LD	C,(IY+35)
  E7E5  0600          		LD	B,0
  E7E7  FDCB207E      		BIT	7,(IY+32)	;(FCB)カレントレコード
  E7EB  2003          		JR	NZ,RBX3
  E7ED  FD4624        		LD	B,(IY+36)
  E7F0                	RBX3:
  E7F0  CDE5E4        		CALL	RWXR
  E7F3  3A16E8        		LD	A,(SECSZ+2)	;1024=4 / 512=2 / 256=1
  E7F6  3D            		DEC	A
  E7F7  FDA622        		AND	(IY+34)
  E7FA  FDB621        		OR	(IY+33)
  E7FD  C9            		RET
                      	
  E7FE                	RBXA:
  E7FE  C5            		PUSH	BC
  E7FF  D5            		PUSH	DE
  E800  CDF4E2        		CALL	CLUSTX
  E803  CDF8E8        		CALL	DRDX
  E806  D1            		POP	DE
  E807  C1            		POP	BC
  E808  D8            		RET	C
  E809  CD8DEA        		CALL	GNCLX
  E80C  D8            		RET	C
  E80D  ED53FEF0      		LD	(_CLPS),DE
                      	
  E811  FD4E21        		LD	C,(IY+33)	;(FCB)ランダムレコード
  E814  210004        	SECSZ:	LD	HL,0400H	;自己書き換え 1024=0400H / 512=0200H ここに1セクタのサイズが格納される
  E817  7C            		LD	A,H
  E818  3D            		DEC	A		;1024=3 / 512=1
  E819  FDA622        		AND	(IY+34)		;(FCB)ランダムレコード
  E81C  47            		LD	B,A		;BCに1セクタ以下の端数が入る
  E81D  ED42          		SBC	HL,BC		;残りを計算
                      	
  E81F  ED5B5DEF      		LD	DE,(LEFTX)
  E823  ED52          		SBC	HL,DE		;CP HL,DE
  E825  19            		ADD	HL,DE		;
  E826  3801          		JR	C,RBXA1		;DEとHLを比較して大きい方をHLに
  E828  EB            		EX	DE,HL
  E829                	RBXA1:
  E829  E5            		PUSH	HL
  E82A  2A7EF0        		LD	HL,(_DTBUF)
  E82D  09            		ADD	HL,BC
  E82E  ED5B5FEF      		LD	DE,(DTAX)
  E832  C1            		POP	BC
  E833  C9            		RET
                      	
  E834                	RBXB:
  E834  2A5FEF        		LD	HL,(DTAX)
  E837  ED5BFEF0      		LD	DE,(_CLPS)
  E83B  3A5EEF        		LD	A,(LEFTX+1)
  E83E  47            		LD	B,A
  E83F  3A16E8        		LD	A,(SECSZ+2)	;1024=4 / 512=2 / 256=1
  E842                	RBXB1:
  E842  1F            		RRA		;->CF
  E843  3804          		JR	C,RBXB2
  E845  CB38          		SRL	B	;B=B/2
  E847  18F9          		JR	RBXB1
  E849                	RBXB2:
  E849  78            		LD	A,B
  E84A  B7            		OR	A
  E84B  C9            		RET
                      	
  E84C                	RBXC:
  E84C  ED4B5DEF      		LD	BC,(LEFTX)
  E850  3A16E8        		LD	A,(SECSZ+2)	;1024=4 / 512=2 / 256=1
  E853  3D            		DEC	A
  E854  A0            		AND	B
  E855  47            		LD	B,A		;1セクタ以下の端数がない場合はZ
  E856  B1            		OR	C
  E857  C9            		RET
                      	
  E858                	RBXEND:
  E858  110000        	LEFT:	LD	DE,0
  E85B  AF            		XOR	A
  E85C  FD6E21        		LD	L,(IY+33)	;(FCB)ランダムレコード
  E85F  FD6622        		LD	H,(IY+34)
  E862  19            		ADD	HL,DE
  E863  FD7521        		LD	(IY+33),L	;(FCB)ランダムレコード
  E866  FD7422        		LD	(IY+34),H
  E869  300E          		JR	NC,RBXEND1
  E86B  FD3423        		INC	(IY+35)
  E86E  2009          		JR	NZ,RBXEND1
  E870  FDCB207E      		BIT	7,(IY+32)	;(FCB)カレントレコード
  E874  2003          		JR	NZ,RBXEND1
  E876  FD3424        		INC	(IY+36)
  E879                	RBXEND1:
  E879  EB            		EX	DE,HL		;HL=Read byte
  E87A  C9            		RET
                      	
  E87B                	GET_RR_BCDE:			;BCDE=Random record
  E87B  FD5E21        		LD	E,(IY+33)	;(FCB)ランダムレコード
  E87E  FD5622        		LD	D,(IY+34)
  E881  FD4E23        		LD	C,(IY+35)
  E884  FD4624        		LD	B,(IY+36)
  E887  FDCB207E      		BIT	7,(IY+32)	;(FCB)カレントレコード
  E88B  C8            		RET	Z
  E88C  0600          		LD	B,0		;CP/M互換のアクセスの場合はFCBは36バイト
  E88E  C9            		RET
                      	
                      	;	ランダムブロックアクセスの連続したセクタをまとめる
                      	
  E88F                	DWTC:
  E88F  E5            		PUSH	HL
  E890  211FEC        		LD	HL,DWT24B
  E893  1804          		JR	DWTC1
  E895                	DRDC:
  E895  E5            		PUSH	HL
  E896  210FEC        		LD	HL,DRD24B
  E899                	DWTC1:
  E899  22F3E8        		LD	(DRWF_MODE),HL
  E89C  E1            		POP	HL
  E89D  3AE3E8        		LD	A,(DRWF_B)
  E8A0  B7            		OR	A
  E8A1  200F          		JR	NZ,DRDC1
  E8A3                	SAVE_DRWC:
  E8A3  0601          		LD	B,1
  E8A5  ED43E2E8      		LD	(DRWF_C),BC
  E8A9  ED53E9E8      		LD	(DRWF_E),DE
  E8AD  22ECE8        		LD	(DRWF_HL),HL
  E8B0  1820          		JR	INC_HL_DRWC
  E8B2                	DRDC1:
  E8B2  E5            		PUSH	HL
  E8B3  21E9E8        		LD	HL,DRWF_E
  E8B6  86            		ADD	A,(HL)
  E8B7  F5            		PUSH	AF
  E8B8  BB            		CP	E
  E8B9  201D          		JR	NZ,DRDC2
  E8BB  F1            		POP	AF
  E8BC  23            		INC	HL
  E8BD  7E            		LD	A,(HL)
  E8BE  CE00          		ADC	A,0
  E8C0  F5            		PUSH	AF
  E8C1  BA            		CP	D
  E8C2  2014          		JR	NZ,DRDC2
  E8C4  F1            		POP	AF
  E8C5  3AE2E8        		LD	A,(DRWF_C)
  E8C8  CE00          		ADC	A,0
  E8CA  B9            		CP	C
  E8CB  200C          		JR	NZ,DRDC3
  E8CD  21E3E8        		LD	HL,DRWF_B
  E8D0  34            		INC	(HL)
  E8D1  E1            		POP	HL
  E8D2                	INC_HL_DRWC:
  E8D2  3A16E8        		LD	A,(SECSZ+2)		;1セクタのサイズの上位1バイト
  E8D5  84            		ADD	A,H
  E8D6  67            		LD	H,A
  E8D7  C9            		RET
  E8D8                	DRDC2:
  E8D8  F1            		POP	AF
  E8D9                	DRDC3:
  E8D9  CDDFE8        		CALL	DRW_FLUSH
  E8DC  E1            		POP	HL
  E8DD  18C4          		JR	SAVE_DRWC
                      	
                      	;	ランダムブロックアクセスの連続したセクタをまとめたものをフラッシュする
  E8DF                	DRW_FLUSH:
  E8DF  C5            		PUSH	BC
  E8E0  D5            		PUSH	DE
  E8E2                	DRWF_C	EQU	$+1
  E8E3                	DRWF_B	EQU	$+2
  E8E1  010000        		LD	BC,0
  E8E4  78            		LD	A,B
  E8E5  B7            		OR	A
  E8E6  280D          		JR	Z,DRDF1
  E8E9                	DRWF_E	EQU	$+1
  E8EA                	DRWF_D	EQU	$+2
  E8E8  110000        		LD	DE,0
  E8EC                	DRWF_HL	EQU	$+1
  E8EB  210000        		LD	HL,0
  E8EE  AF            		XOR	A
  E8EF  32E3E8        		LD	(DRWF_B),A
  E8F3                	DRWF_MODE	EQU	$+1
  E8F2  CD0FEC        		CALL	DRD24B
  E8F5                	DRDF1:
  E8F5  D1            		POP	DE
  E8F6  C1            		POP	BC
  E8F7  C9            		RET
                      	
                      	;LDDIO.ASM
                      	
                      	;	LSX-Dodgers DIO
                      	
  E8F8                	DRDX:
  E8F8  CD36E9        		CALL	DRDY
  E8FB  C8            		RET	Z
  E8FC  CD1CE9        		CALL	DRDX1		;データバッファの情報を保存
  E8FF  D8            		RET	C
  E900  E5            		PUSH	HL
  E901  C5            		PUSH	BC
  E902  D5            		PUSH	DE
  E903  2A7EF0        		LD	HL,(_DTBUF)
  E906  3A5FE9        		LD	A,(_DBS24+1)
  E909  4F            		LD	C,A
  E90A  CD0DEC        		CALL	DRD24
  E90D  DC31E9        		CALL	C,DRDNE
  E910                	POP_DE_BC_HL_RET:
  E910  D1            		POP	DE
  E911  C1            		POP	BC
  E912  E1            		POP	HL
  E913  C9            		RET
                      	
                      	;	CDE:セクタ番号
  E914                	DRDN:
  E914  AF            		XOR	A
  E915  00            	DRDN1:	NOP			;自己書き換え NOP / SCF
  E916  30E0          		JR	NC,DRDX
  E918                	DRDNX:
  E918  CD36E9        		CALL	DRDY
  E91B  C8            		RET	Z
  E91C                	DRDX1:
  E91C  CD4CE9        		CALL	DWTX
                      					;データバッファの読み込んだドライブ・セクタ情報を保存
  E91F  ED53A6EF      		LD	(_DBSEC),DE
  E923  79            		LD	A,C
  E924  325FE9        		LD	(_DBS24+1),A
                      	
  E927  3A88EF        		LD	A,(_DRV)
  E92A  32A5EF        		LD	(_DBDRV),A
  E92D  CDD9EF        		CALL	_CHGDRV
  E930  D0            		RET	NC
  E931                	DRDNE:
  E931  9F            		SBC	A,A		;CF=1ならばA=0FFH
  E932  32A5EF        		LD	(_DBDRV),A
  E935  C9            		RET
                      	
                      	;	CDE:セクタ番号
  E936                	DRDY:
  E936  3A5FE9        		LD	A,(_DBS24+1)
  E939  B9            		CP	C
  E93A  C0            		RET	NZ
                      	
  E93B  E5            		PUSH	HL
  E93C  3A88EF        		LD	A,(_DRV)
  E93F  21A5EF        		LD	HL,_DBDRV
  E942  AE            		XOR	(HL)
  E943  2005          		JR	NZ,POP_HL_RET
                      	
  E945  2AA6EF        		LD	HL,(_DBSEC)
  E948  ED52          		SBC	HL,DE		;CF=0
  E94A                	POP_HL_RET:
  E94A  E1            		POP	HL
  E94B  C9            		RET
                      	
  E94C                	DWTX:
  E94C  3AA4EF        		LD	A,(_WTDBF)
  E94F  B7            		OR	A
  E950  C8            		RET	Z
  E951  AF            		XOR	A
  E952  32A4EF        		LD	(_WTDBF),A
                      	
  E955  E5            		PUSH	HL
  E956  C5            		PUSH	BC
  E957  D5            		PUSH	DE
  E958  3AA5EF        		LD	A,(_DBDRV)
  E95B  CDD9EF        		CALL	_CHGDRV
  E95E  0E00          	_DBS24:	LD	C,0
  E960  ED5BA6EF      		LD	DE,(_DBSEC)
  E964  2A7EF0        		LD	HL,(_DTBUF)
  E967  D41DEC        		CALL	NC,DWT24
  E96A                	POP_DE_BC_HL_RET2:
  E96A  18A4          		JR	POP_DE_BC_HL_RET
                      	
  E96C                	RDFATX:
  E96C  E5            		PUSH	HL
  E96D  3A88EF        		LD	A,(_DRV)
  E970  21AAEF        		LD	HL,_FATDRV
  E973  AE            		XOR	(HL)
  E974  28D4          		JR	Z,POP_HL_RET
                      	
  E976  C5            		PUSH	BC
  E977  D5            		PUSH	DE
  E978  DDE5          		PUSH	IX
  E97A  CD96E9        		CALL	WTFATX
  E97D  3813          		JR	C,POP_IX_DE_BC_HL_RET
                      	
  E97F  AF            		XOR	A
  E980  32ABEF        		LD	(_FATIX),A
  E983  3A88EF        		LD	A,(_DRV)
  E986  32AAEF        		LD	(_FATDRV),A
  E989  CDE5EF        		CALL	_RDFAT
  E98C                	RDFATE2:
  E98C  3004          		JR	NC,POP_IX_DE_BC_HL_RET
  E98E  9F            		SBC	A,A		;A=0xFF
  E98F  32AAEF        		LD	(_FATDRV),A
  E992                	POP_IX_DE_BC_HL_RET:
  E992  DDE1          		POP	IX
  E994  18D4          		JR	POP_DE_BC_HL_RET2
                      	
  E996                	WTFATX:
  E996  3AA2EF        		LD	A,(_WTFATF)
  E999  B7            		OR	A
  E99A  C8            		RET	Z
  E99B  E5            		PUSH	HL
  E99C  3AAAEF        		LD	A,(_FATDRV)
  E99F  21A5EF        		LD	HL,_DBDRV
  E9A2  AE            		XOR	(HL)
  E9A3  CC4CE9        		CALL	Z,DWTX
  E9A6  38A2          		JR	C,POP_HL_RET
  E9A8  C5            		PUSH	BC
  E9A9  D5            		PUSH	DE
  E9AA  DDE5          		PUSH	IX
  E9AC  CD2AEC        		CALL	WTFAT
  E9AF  AF            		XOR	A
  E9B0  32A2EF        		LD	(_WTFATF),A
  E9B3  18DD          		JR	POP_IX_DE_BC_HL_RET
                      	
  E9B5                	NCL1:
  E9B5  7A            		LD	A,D
  E9B6  B3            		OR	E
  E9B7  37            		SCF
  E9B8  C8            		RET	Z
                      	
  E9B9  7A            		LD	A,D
  E9BA  CB3F          		SRL	A	;/2
  E9BC  CB3F          		SRL	A	;/2
                      	
  E9BE  E5            		PUSH	HL
  E9BF  32DEE9        		LD	(NCLPAT+2),A	;_FATIX
  E9C2  2AAAEF        		LD	HL,(_FATDRV)	;L=_FATDRV H=_FATIX
  E9C5  BC            		CP	H
  E9C6  3A88EF        		LD	A,(_DRV)	;この間でフラグは変化しない
  E9C9  32DDE9        		LD	(NCLPAT+1),A	;_FATDRV
  E9CC  2005          		JR	NZ,NCL2		;FATIXが違う
  E9CE  BD            		CP	L
  E9CF  2002          		JR	NZ,NCL2		;ドライブが違う
  E9D1  E1            		POP	HL
  E9D2  C9            		RET
  E9D3                	NCL2:
  E9D3  C5            		PUSH	BC
  E9D4  D5            		PUSH	DE
  E9D5  DDE5          		PUSH	IX
  E9D7  CD96E9        		CALL	WTFATX
  E9DA  38B6          		JR	C,POP_IX_DE_BC_HL_RET
  E9DC  010000        	NCLPAT:	LD	BC,0		;自己書き換え C=_FATDRV B=_FATIX
  E9DF  ED43AAEF      		LD	(_FATDRV),BC
  E9E3  CDFFEB        		CALL	RDFATS
  E9E6  18A4          		JR	RDFATE2
                      	
  E9E8                	NCL3:
  E9E8  CB9A          		RES	3,D
  E9EA  CB92          		RES	2,D
  E9EC  6B            		LD	L,E
  E9ED  62            		LD	H,D
  E9EE  CB3C          		SRL	H	;
  E9F0  CB1D          		RR	L	;HLA=HLA/2
  E9F2  1F            		RRA		;
  E9F3  F5            		PUSH	AF
  E9F4  3AABEF        		LD	A,(_FATIX)
  E9F7  0F            		RRCA
  E9F8  300B          		JR	NC,NCL3X1
  E9FA  3A16E8        		LD	A,(SECSZ+2)
  E9FD  FE04          		CP	4		;1セクタ1024バイトの場合は奇数インデックスの場合に先頭を512バイトずらす
  E9FF  2004          		JR	NZ,NCL3X1
  EA01  010002        		LD	BC,512
  EA04  09            		ADD	HL,BC
  EA05                	NCL3X1:
  EA05  F1            		POP	AF
  EA06  ED4B7CF0      		LD	BC,(_FATBF)
  EA0A  19            		ADD	HL,DE
  EA0B  09            		ADD	HL,BC
  EA0C  17            		RLA
  EA0D  C9            		RET
                      	
  EA0E                	GNCL:
  EA0E  CDB5E9        		CALL	NCL1		;GET NEXT CLUSTER
  EA11  D8            		RET	C
  EA12  C5            		PUSH	BC
  EA13  E5            		PUSH	HL
  EA14  CDE8E9        		CALL	NCL3
  EA17  3809          		JR	C,GNC1
  EA19  5E            		LD	E,(HL)
  EA1A  23            		INC	HL
  EA1B  7E            		LD	A,(HL)
  EA1C  E60F          		AND	00FH
  EA1E  57            		LD	D,A
  EA1F  E1            		POP	HL
  EA20  C1            		POP	BC
  EA21  C9            		RET
  EA22                	GNC1:
  EA22  7E            		LD	A,(HL)
  EA23  23            		INC	HL
  EA24  56            		LD	D,(HL)
  EA25  0604          		LD	B,4
  EA27                	GNC1L:
  EA27  CB3A          		SRL	D	;DA=DA/2
  EA29  1F            		RRA		;
  EA2A  10FB          		DJNZ	GNC1L
                      	
  EA2C  5F            		LD	E,A
  EA2D  E1            		POP	HL
  EA2E  C1            		POP	BC
  EA2F  A7            		AND	A
  EA30  C9            		RET
                      	
  EA31                	SNCL:
  EA31  CDB5E9        		CALL	NCL1
  EA34  D8            		RET	C
                      	;				SET NEXT CLUSTER
  EA35  E5            		PUSH	HL
  EA36  C5            		PUSH	BC
  EA37  D5            		PUSH	DE
  EA38  E5            		PUSH	HL
  EA39  CDE8E9        		CALL	NCL3
  EA3C  D1            		POP	DE
                      	;CF=ODD
  EA3D  7E            		LD	A,(HL)
  EA3E  73            		LD	(HL),E
  EA3F  3806          		JR	C,SNC1
                      	;EVEN
                      	;M[0] = E
                      	;M[1] = (M[1] & 0xF0) | (D & 0x0F)
  EA41  23            		INC	HL
  EA42  ED67          		RRD		;M={A[3:0],E[3:0]}
  EA44  7A            		LD	A,D
  EA45  1804          		JR	SNC11
  EA47                	SNC1:
                      	;ODD
                      	;HL[0] = (HL[0]&0x0F) | (E<<4)
                      	;HL[1] = DE>>4
  EA47  ED6F          		RLD		;M={D[3:0],E[7:4]}
  EA49  23            		INC	HL
  EA4A  72            		LD	(HL),D	;M={D[3:0],E[7:4]}
  EA4B                	SNC11:
  EA4B  ED6F          		RLD		;M={M[7:4],D[3:0]}
  EA4D  B7            		OR	A
  EA4E  D1            		POP	DE
  EA4F  C1            		POP	BC
  EA50  E1            		POP	HL
  EA51                	FAT_CHANGED:
  EA51  3E01          		LD	A,1
  EA53  32A2EF        		LD	(_WTFATF),A
  EA56  C9            		RET
                      	
  EA57                	N16CL3:
  EA57  C5            		PUSH	BC
  EA58  6B            		LD	L,E
  EA59  7A            		LD	A,D
  EA5A  E603          		AND	3
  EA5C  67            		LD	H,A
  EA5D  29            		ADD	HL,HL
  EA5E  ED4B7CF0      		LD	BC,(_FATBF)
  EA62  09            		ADD	HL,BC
  EA63  C1            		POP	BC
  EA64  C9            		RET
                      	
  EA65                	GNCL16:
  EA65  CDB5E9        		CALL	NCL1		;GET NEXT CLUSTER for FAT16
  EA68  D8            		RET	C
  EA69  E5            		PUSH	HL
  EA6A  CD57EA        		CALL	N16CL3
  EA6D  5E            		LD	E,(HL)
  EA6E  23            		INC	HL
  EA6F  56            		LD	D,(HL)
  EA70  E1            		POP	HL
  EA71  C9            		RET
                      	
  EA72                	SNCL16:
  EA72  CDB5E9        		CALL	NCL1		;GET NEXT CLUSTER for FAT16
  EA75  D8            		RET	C
  EA76  D5            		PUSH	DE
  EA77  E5            		PUSH	HL
  EA78  CD57EA        		CALL	N16CL3
  EA7B  D1            		POP	DE		;HL
  EA7C  73            		LD	(HL),E
  EA7D  23            		INC	HL
  EA7E  72            		LD	(HL),D
  EA7F  6B            		LD	L,E
  EA80  62            		LD	H,D
  EA81  D1            		POP	DE
  EA82  18CD          		JR	FAT_CHANGED
                      	
                      	;------------------------
                      	;次のセクタを探す際に_SECPSの値をチェック
                      	;in
                      	;	DE : セクタ番号
                      	;out
                      	;	DE : 次のセクタ番号
                      	;note
                      	;
                      	;------------------------
  EA84                	NEXTX:
  EA84  3E00          	_SECPS:	LD	A,0	;自己書き換え
  EA86  3C            		INC	A
  EA87  E600          	NCPAT:	AND	0	;自己書き換え　1クラスタの論理セクタ数-1
  EA89  3285EA        		LD	(_SECPS+1),A
  EA8C  C9            		RET
                      	
  EA8D                	GNCLX:
  EA8D  CD84EA        		CALL	NEXTX
  EA90  C0            		RET	NZ	;1クラスタのセクタ未満の場合は戻る
  EA91  C3F7EF        		JP	_GNCL	;次のクラスタを探す
                      	
  EA94                	RDFAT:
  EA94  3E80          		LD	A,080H
  EA96  3270EF        		LD	(CHECK),A
  EA99                	RDFAT1:
  EA99  3A88EF        		LD	A,(_DRV)
  EA9C  CD54ED        		CALL	CHGDRVR
  EA9F  D8            		RET	C
  EAA0  DD7E12        		LD	A,(IX+012H)	;DPB_12_DEVICE
  EAA3  CB6F          		BIT	5,A
  EAA5  286B          		JR	Z,RDFAT0X
  EAA7  2170EF        		LD	HL,CHECK
  EAAA  A6            		AND	(HL)
  EAAB  77            		LD	(HL),A
  EAAC  110000        		LD	DE,0		;BPB
  EAAF  2A7CF0        		LD	HL,(_FATBF)
  EAB2  CD0BEC        		CALL	DRD16
  EAB5  3024          		JR	NC,GETBPB
  EAB7  2170EF        		LD	HL,CHECK
  EABA  CB06          		RLC	(HL)
  EABC  3F            		CCF
  EABD  D8            		RET	C
  EABE  DDCB0A1E      		RR	(IX+00AH)	;DPB_0A_FDMODE
  EAC2  3F            		CCF			;フロッピーディスクのFDモードを切り替える
  EAC3  DDCB0A16      		RL	(IX+00AH)	;DPB_0A_FDMODE
  EAC7  3EFF          		LD	A,0FFH
  EAC9  3289EF        		LD	(_DSK),A
  EACC  3A84EF        		LD	A,(_DRIVE)
  EACF  E603          		AND	3
  EAD1  F680          		OR	080H
  EAD3  6F            		LD	L,A
  EAD4  26EF          		LD	H,_CYL0/256
  EAD6  3EFF          		LD	A,0FFH
  EAD8  77            		LD	(HL),A
  EAD9  18BE          		JR	RDFAT1
  EADB                	GETBPB:
  EADB  FDE5          		PUSH	IY
  EADD  FD2A7CF0      		LD	IY,(_FATBF)	;BPB
  EAE1  CDF1EF        		CALL	_BPB2DPB
  EAE4  FDE1          		POP	IY
  EAE6  DD7E12        		LD	A,(IX+012H)	;DPB_12_DEVICE
  EAE9  3021          		JR	NC,GETBPBOK
  EAEB  E60F          		AND	00FH
  EAED  FE07          		CP	7
  EAEF  37            		SCF
  EAF0  C0            		RET	NZ
  EAF1  DDCB0A46      		BIT	0,(IX+00AH)	;DPB_0A_FDMODE
  EAF5  21C0F0        		LD	HL,M2D
  EAF8  2002          		JR	NZ,SETFDMODE
  EAFA  2ED2          		LD	L,M2HD-STABLE
  EAFC                	SETFDMODE:
  EAFC  DDE5          		PUSH	IX
  EAFE  D1            		POP	DE
  EAFF  EDA0          		LDI
  EB01  EDA0          		LDI
  EB03  13            		INC	DE
  EB04  13            		INC	DE
  EB05  13            		INC	DE
  EB06  13            		INC	DE
  EB07  010C00        		LD	BC,12
  EB0A  EDB0          		LDIR
  EB0C                	GETBPBOK:
  EB0C  321BEB        		LD	(DEVSWC),A
  EB0F  CDB3EC        		CALL	CHGDRV2
  EB12                	RDFAT0X:
  EB12  CDFFEB        		CALL	RDFATS
  EB15  D8            		RET	C
  EB16  DDAE06        		XOR	(IX+6)		;DPB_06_FATID
  EB19  C8            		RET	Z
  EB1B                	DEVSWC	EQU	$+1
  EB1A  3E00          		LD	A,0		;DPB_12_DEVICE
  EB1C  CB6F          		BIT	5,A
  EB1E  C0            		RET	NZ		;BPBを取得している場合はFATIDをチェックしない
  EB1F  37            		SCF
  EB20  C9            		RET
                      	
  EB21                	BPB2DPB:
  EB21  FD7E0B        		LD	A,(IY+11)	;BPB_BytsPerSec
  EB24  B7            		OR	A
  EB25  37            		SCF
  EB26  C0            		RET	NZ
  EB27                	BPBOK:
  EB27  FD7E0D        		LD	A,(IY+13)	;BPB_SecPerClus
  EB2A  DD7707        		LD	(IX+7),A	;DPB_07_SECPCL
                      	
  EB2D  FD7E16        		LD	A,(IY+22)	;BPB_FATSz16
  EB30  DD7700        		LD	(IX+0),A	;DPB_00_FATLN
  EB33  FD7E17        		LD	A,(IY+23)	;BPB_FATSz16
  EB36  DD7701        		LD	(IX+1),A	;DPB_00_FATLN
                      	
  EB39  FD6E0E        		LD	L,(IY+14)	;BPB_RsvdSecCnt
  EB3C  FD660F        		LD	H,(IY+15)
  EB3F  DD750E        		LD	(IX+00EH),L	;DPB_0E_FATPS
  EB42  FD5E16        		LD	E,(IY+22)	;BPB_FATSz16
  EB45  FD5617        		LD	D,(IY+23)
  EB48  FD4610        		LD	B,(IY+16)	;BPB_NumFATs
  EB4B                	BPBDP1:				;BPB_FATSz16 * BPB_NumFATs
  EB4B  19            		ADD	HL,DE
  EB4C  10FD          		DJNZ	BPBDP1
  EB4E                	BPBDP2:
  EB4E  DD7510        		LD	(IX+010H),L	;DPB_10_DIRPS
  EB51  DD7411        		LD	(IX+011H),H
  EB54  E5            		PUSH	HL
                      	
  EB55  FD6E11        		LD	L,(IY+17)	;BPB_RootEntCnt
  EB58  FD6612        		LD	H,(IY+18)
  EB5B  FD7E0C        		LD	A,(IY+12)	;BPB_BytsPerSec
  EB5E  B7            		OR	A
  EB5F  37            		SCF
  EB60  C8            		RET	Z
  EB61  0606          		LD	B,6
  EB63                	BPBBPS1:
  EB63  05            		DEC	B
  EB64  0F            		RRCA
  EB65  30FC          		JR	NC,BPBBPS1
  EB67                	BPBDE1:
  EB67  29            		ADD	HL,HL
  EB68  10FD          		DJNZ	BPBDE1
                      	
  EB6A  7C            		LD	A,H
  EB6B  DD770B        		LD	(IX+00BH),A	;DPB_0B_DIRSCNT
                      	
  EB6E  D1            		POP	DE		;DPB_10_DIRPS
  EB6F  6C            		LD	L,H
  EB70  2600          		LD	H,0
  EB72  19            		ADD	HL,DE		;MAXDIR
  EB73  E5            		PUSH	HL
  EB74  FD4E0D        		LD	C,(IY+13)	;BPB_SecPerClus
  EB77  CB21          		SLA	C		;*2
  EB79  AF            		XOR	A
  EB7A  47            		LD	B,A
  EB7B  ED42          		SBC	HL,BC
  EB7D  DD7514        		LD	(IX+014H),L	;DPB_14_ADDCL16
  EB80  DD7415        		LD	(IX+015H),H
                      	
  EB83  D1            		POP	DE		;DE=DPB_0B_MAXDIR
  EB84  FD6E13        		LD	L,(IY+19)	;BPB_TotSec16
  EB87  FD6614        		LD	H,(IY+20)
                      	
  EB8A  DD7E12        		LD	A,(IX+012H)	;DPB_12_DEVICE
  EB8D  E60F          		AND	00FH
  EB8F  FE07          		CP	7		;フロッピー
  EB91  2019          		JR	NZ,NOT_FD
  EB93  E5            		PUSH	HL
  EB94  FD4E18        		LD	C,(IY+24)	;BPB_SecPerTr
  EB97  DD710D        		LD	(IX+00DH),C	;DPB_0D_MAXSEC
  EB9A  AF            		XOR	A
  EB9B  CB21          		SLA	C		;両面なのでセクタ数を２倍
  EB9D  0610          		LD	B,16
  EB9F                	DIVSEC:				;MAXCYL = BPB_TotSec16 / (BPB_SecPerTr * 2)
  EB9F  29            		ADD	HL,HL
  EBA0  17            		RLA
  EBA1  B9            		CP	C
  EBA2  3802          	   	JR	C,DIVSEC1
  EBA4  91            	   	SUB	C
  EBA5  2C            		INC	L
  EBA6                	DIVSEC1:
  EBA6  10F7          	 	DJNZ	DIVSEC
  EBA8  DD750C        		LD	(IX+00CH),L	;DPB_0C_MAXCYL
  EBAB  E1            		POP	HL	;ここまでフロッピー専用
  EBAC                	NOT_FD:
  EBAC  7C            		LD	A,H
  EBAD  B5            		OR	L
  EBAE  3E00          		LD	A,0		;LDでフラグは変化しない。BPB_TotSec16を AHL で扱う為、Aに0を入れる
  EBB0  2010          		JR	NZ,BPB16BIT	;BPB_TotSec16が「0」の場合はBPB_TotSec32で計算
  EBB2  FD7E23        		LD	A,(IY+35)	;念のために総セクタ数が24ビットを超える場合はエラーを返す
  EBB5  B7            		OR	A
  EBB6  37            		SCF
  EBB7  C0            		RET	NZ
  EBB8  FD6E20        		LD	L,(IY+32)	;BPB_TotSec32 は AHL の24ビットで扱う
  EBBB  FD6621        		LD	H,(IY+33)	;1クラスタの論理セクタ数(DPB_07_SECPCL)が最大128なので
  EBBE  FD7E22        		LD	A,(IY+34)	;24ビットを超えると必ずクラスタ数が16ビットを超えてしまうのでこれで十分
  EBC1  A7            		AND	A		;CF=0
  EBC2                	BPB16BIT:
  EBC2  ED52          		SBC	HL,DE
  EBC4  DE00          		SBC	A,0
  EBC6  FD460D        		LD	B,(IY+13)	;BPB_SecPerClus
  EBC9                	BPBTC1:				;総クラスタ数(AHL) = 総セクタ数(AHL) / セクタサイズ(B)
  EBC9  CB18          		RR	B		;->CY
  EBCB  3808          		JR	C,BPBTC2
  EBCD  CB3F          		SRL	A
  EBCF  CB1C          		RR	H		;AHL=AHL/2
  EBD1  CB1D          		RR	L
  EBD3  18F4          		JR	BPBTC1
  EBD5                	BPBTC2:
  EBD5  B7            		OR	A
  EBD6  37            		SCF
  EBD7  C0            		RET	NZ		;念のため(クラスタ数が16ビットを超える場合)
  EBD8  23            		INC	HL
  EBD9  23            		INC	HL
  EBDA  DD7508        		LD	(IX+8),L	;DPB_08_MAXCL
  EBDD  DD7409        		LD	(IX+9),H
                      	
  EBE0  FD7E15        		LD	A,(IY+21)	;BPB_Media
  EBE3  DD7706        		LD	(IX+6),A	;DPB_06_FATID
                      	
  EBE6  FD7E10        		LD	A,(IY+16)	;BPB_NumFATs
  EBE9  C6FE          		ADD	A,0-2		;>2:CF=1
  EBEB  FD7E0C        		LD	A,(IY+12)	;BPB_BytsPerSec
  EBEE  6F            		LD	L,A
  EBEF  3002          		JR	NC,BPBFAT1
  EBF1  F680          		OR	080H
  EBF3                	BPBFAT1:
  EBF3  DD770F        		LD	(IX+00FH),A	;DPB_0F_BPS
  EBF6  2D            		DEC	L		;以下のセクタサイズに合致しない場合はCF=1でエラーにする
  EBF7  C8            		RET	Z		;1セクタ256バイト
  EBF8  2D            		DEC	L
  EBF9  C8            		RET	Z		;1セクタ512バイト
  EBFA  2D            		DEC	L
  EBFB  2D            		DEC	L
  EBFC  C8            		RET	Z		;1セクタ1024バイト
  EBFD  37            		SCF
  EBFE  C9            		RET
                      	
  EBFF                	RDFATS:
  EBFF  CD45EC        		CALL	FATSETUP
  EC02  D8            		RET	C
  EC03  CD0FEC        		CALL	DRD24B
  EC06  2A7CF0        		LD	HL,(_FATBF)
  EC09  7E            		LD	A,(HL)
  EC0A  C9            		RET
                      	
  EC0B                	DRD16:
  EC0B  0E00          		LD	C,0
  EC0D                	DRD24:
  EC0D  0601          		LD	B,1
  EC0F                	DRD24B:
  EC0F  DDE5          		PUSH	IX
  EC11  DD2AA8EF      		LD	IX,(_DPB)
  EC15  CD6FEE        	DRDPAT:	CALL	FDRD		;自己書き換え（ディスク読み込み）
  EC18                	POP_IX_RET:
  EC18  DDE1          		POP	IX
  EC1A  C9            		RET
                      	
  EC1B                	DWT16:
  EC1B  0E00          		LD	C,0
  EC1D                	DWT24:
  EC1D  0601          		LD	B,1
  EC1F                	DWT24B:
  EC1F  DDE5          		PUSH	IX
  EC21  DD2AA8EF      		LD	IX,(_DPB)
  EC25  CD61EE        	DWTPAT:	CALL	FDWT		;自己書き換え（ディスク書き込み）
  EC28  18EE          		JR	POP_IX_RET
                      	
  EC2A                	WTFAT:
  EC2A  CD45EC        		CALL	FATSETUP
  EC2D  D41FEC        		CALL	NC,DWT24B
  EC30  D8            		RET	C
  EC31  DDCB0F7E      		BIT	7,(IX+00FH)	;DPB_0F_BPS
  EC35  C8            		RET	Z		;予備FATが無い
  EC36  CD4CEC        		CALL	FATS2
  EC39  E5            		PUSH	HL		;予備FAT
  EC3A  DD6E00        		LD	L,(IX+0)	;DPB_00_FATLN
  EC3D  DD6601        		LD	H,(IX+1)
  EC40  19            		ADD	HL,DE
  EC41  EB            		EX	DE,HL
  EC42  E1            		POP	HL
  EC43  18DA          		JR	DWT24B
                      	;------------------------
                      	;FATのセットアップ
                      	;out
                      	;	B  : FATセクタ数
                      	;	DE : FAT先頭セクタ番号
                      	;	HL : FATバッファポインタ
                      	;	CF : 1=ドライブ切り替えエラー
                      	;note
                      	;	FATサイズがFATバッファを超える場合は
                      	;	対象クラスタ領域==(_FATIX)によって
                      	;	FAT12:対象クラスタ1024毎に1.5KBを切り替える
                      	;	FAT16:対象クラスタ1024毎に2KBを切り替える
                      	;------------------------
  EC45                	FATSETUP:
  EC45  3AAAEF        		LD	A,(_FATDRV)
  EC48  CD54ED        		CALL	CHGDRVR		;ドライブ切り替え
  EC4B  D8            		RET	C
  EC4C                	FATS2:
  EC4C  DD7E0F        		LD	A,(IX+00FH)	;DPB_0F_BPS 512=2 1024=4
  EC4F  0F            		RRCA
  EC50  CD79EC        	FATSX:	CALL	FATSETUP12	;自己書き換え
  EC53  210000        		LD	HL,0
  EC56  4A            		LD	C,D
  EC57  54            		LD	D,H
  EC58  3AABEF        		LD	A,(_FATIX)	;範囲FAT12:0-3/FAT16:0-63(0-03FH):65535*2/2048
  EC5B  47            		LD	B,A
  EC5C  04            		INC	B
  EC5D  DD7E00        		LD	A,(IX+0)	;DPB_00_FATLN
  EC60                	FAT_SKP:
  EC60  05            		DEC	B
  EC61  2805          		JR	Z,FAT1
  EC63  19            		ADD	HL,DE
  EC64  93            		SUB	E
  EC65  30F9          		JR	NC,FAT_SKP
  EC67  C9            		RET
  EC68                	FAT1:
  EC68  EB            		EX	DE,HL
  EC69  B9            		CP	C		;C=FATバッファに読み込めるセクタ数
  EC6A  3801          		JR	C,FAT2
  EC6C  79            		LD	A,C
  EC6D                	FAT2:
  EC6D  47            		LD	B,A
                      	
  EC6E  2AFAF0        		LD	HL,(_FATPS)	;fat sector pos
  EC71  19            		ADD	HL,DE
  EC72  EB            		EX	DE,HL
  EC73  2A7CF0        		LD	HL,(_FATBF)
  EC76  AF            		XOR	A		;CF=0
  EC77  4F            		LD	C,A
  EC78  C9            		RET
                      	;
                      	;	FATバッファに読み込める最大のセクタ数と_FATIXで進めるセクタ数
                      	;	FATSETUP* (FAT12/FAT16)
                      	;out
                      	;	D : FATバッファに読み込める最大のセクタ数
                      	;	E : _FATIXで進めるセクタ数
  EC79                	FATSETUP12:
  EC79  110606        		LD	DE,0606H	;256
  EC7C  D8            		RET	C
  EC7D  110303        		LD	DE,0303H	;512
  EC80  0F            		RRCA
  EC81  D8            		RET	C
  EC82  110102        		LD	DE,0201H	;1024
  EC85  C9            		RET
                      	
  EC86                	FATSETUP16:
  EC86  110808        		LD	DE,0808H	;256
  EC89  D8            		RET	C
  EC8A  110404        		LD	DE,0404H
  EC8D  0F            		RRCA			;512
  EC8E  D8            		RET	C
  EC8F  110202        		LD	DE,0202H	;1024
  EC92  C9            		RET
                      	
  EC93                	CHGDRV:
  EC93  E5            		PUSH	HL
  EC94  2189EF        		LD	HL,_DSK
  EC97  BE            		CP	(HL)
  EC98  280A          		JR	Z,CHGDRVE
  EC9A                	CHGDRV1:
  EC9A  DDE5          		PUSH	IX
  EC9C  CDA6EC        		CALL	CHGDRV0
  EC9F  3A89EF        		LD	A,(_DSK)
  ECA2  DDE1          		POP	IX
  ECA4                	CHGDRVE:
  ECA4  E1            		POP	HL
  ECA5  C9            		RET
                      	
  ECA6                	CHGDRV0:
  ECA6  6F            		LD	L,A
  ECA7  CDDCEF        		CALL	_GETDPB
  ECAA  D8            		RET	C
  ECAB  DD22A8EF      		LD	(_DPB),IX
  ECAF  7D            		LD	A,L
  ECB0  3289EF        		LD	(_DSK),A
  ECB3                	CHGDRV2:
  ECB3  C5            		PUSH	BC
  ECB4  D5            		PUSH	DE
  ECB5  ED730AED      		LD	(SPPAT2+1),SP
  ECB9  F3            		DI
  ECBA  DDF9          		LD	SP,IX
                      	
  ECBC  E1            		POP	HL		;DPB_00_FATLN
  ECBD  E1            		POP	HL		;DPB_02_DRD
  ECBE  2216EC        		LD	(DRDPAT+1),HL
                      	
  ECC1  E1            		POP	HL
  ECC2  2226EC        		LD	(DWTPAT+1),HL	;DPB_04_DWT
                      	
  ECC5  E1            		POP	HL		;L=DPB_06_FATID H=DPB_07_SECPCL
  ECC6  7C            		LD	A,H
  ECC7  32F8E2        		LD	(SPCPAT+1),A	;1クラスタの論理セクタ数
  ECCA  3D            		DEC	A
  ECCB  3288EA        		LD	(NCPAT+1),A
                      	
  ECCE  E1            		POP	HL		;DPB_08_MAXCL
  ECCF  7D            		LD	A,L
  ECD0  3217E3        		LD	(CLPAT2+1),A
  ECD3  7C            		LD	A,H
  ECD4  3213E3        		LD	(CLPAT1+1),A
  ECD7  2B            		DEC	HL
  ECD8  221BE5        		LD	(MAXCLP+1),HL
                      	
  ECDB  E1            		POP	HL		;L=DPB_0A_FDMODE H=DPB_0B_DIRSCNT
  ECDC  7D            		LD	A,L
  ECDD  F6FE          		OR	0FEH
  ECDF  320AEE        		LD	(FDMODE+1),A
  ECE2  07            		RLCA
  ECE3  E603          		AND	3
  ECE5  32F2ED        		LD	(FSPAT+1),A
  ECE8  4C            		LD	C,H
                      	
  ECE9  E1            		POP	HL		;L=DPB_0C_MAXCYL H=DPB_0D_MAXSEC
                      	
  ECEA  E1            		POP	HL		;L=DPB_0E_FATPS H=DPB_0F_BPS
  ECEB  7C            		LD	A,H		;DPB_0F_BPS
  ECEC  E607          		AND	7
  ECEE  3216E8        		LD	(SECSZ+2),A	;1セクタのサイズの上位1バイト 0x400 - 0x200 - 0x100
                      					;1セクタ512 2D/2DD/2HC/2HQ(2HD1.44MB)/EMM/BRAM/EMEM等
                      					;1セクタ1024 2HD/2HDE98
                      					;1セクタ256 GRAM/RAMF/CMOS/等
                      					;1024	512	256
                      					;4	2	1
  ECF1  87            		ADD	A,A		;8	4	2
  ECF2  87            		ADD	A,A		;010H	8	4
  ECF3  87            		ADD	A,A		;020H	010H	8
  ECF4  3274E1        		LD	(SDECPAT+1),A	;1セクタ辺りのディレクトリエントリ数
                      	
  ECF7  2600          		LD	H,0
  ECF9  22FAF0        		LD	(_FATPS),HL
                      	
  ECFC  E1            		POP	HL		;DPB_10_DIRPS
  ECFD  22FCF0        		LD	(_DIRPS),HL
                      	
  ED00  E1            		POP	HL		;L=DPB_12_DEVICE H=DPB_13_UNITNO
  ED01  7C            		LD	A,H
  ED02  3284EF        		LD	(_DRIVE),A
                      	
  ED05  E1            		POP	HL		;DPB_14_ADDCL16
  ED06  2208E3        		LD	(CLSPAT+1),HL
                      	
  ED09  310000        	SPPAT2:	LD	SP,0		;元のSPを復元
  ED0C  FB            		EI
  ED0D  2AFCF0        		LD	HL,(_DIRPS)
  ED10  0600          		LD	B,0
  ED12  09            		ADD	HL,BC		;C=DPB_0B_DIRSCNT
  ED13  228FE1        		LD	(MD_PAT+1),HL
                      	
  ED16  2A1BE5        		LD	HL,(MAXCLP+1);
  ED19  11F60F        		LD	DE,4086		;クラスタ数が4086未満:FAT12 4086以上:FAT16
  ED1C  ED52          		SBC	HL,DE		;CF=0のはず
  ED1E  300F          		JR	NC,SETFAT16
  ED20  210EEA        		LD	HL,GNCL		;FAT12
  ED23  1131EA        		LD	DE,SNCL
  ED26  0179EC        		LD	BC,FATSETUP12
  ED29  DDCB0FAE      		RES	5,(IX+00FH)	;DPB_0F_BPS(FAT12)
  ED2D  180D          		JR	EXTRA1
  ED2F                	SETFAT16:
  ED2F  2165EA        		LD	HL,GNCL16	;FAT16
  ED32  1172EA        		LD	DE,SNCL16
  ED35  0186EC        		LD	BC,FATSETUP16
  ED38  DDCB0FEE      		SET	5,(IX+00FH)	;DPB_0F_BPS(FAT16)
  ED3C                	EXTRA1:
  ED3C  22F8EF        		LD	(GNCPAT+1),HL
  ED3F  ED53FBEF      		LD	(SNCPAT+1),DE
  ED43  ED4351EC      		LD	(FATSX+1),BC
  ED47  D1            		POP	DE
  ED48  C1            		POP	BC
  ED49  AF            		XOR	A
  ED4A  C9            		RET
                      	
  ED4B                	GETDPBD:
  ED4B  DDE3          		EX	(SP),IX
  ED4D  DDE5          		PUSH	IX
  ED4F  3A88EF        		LD	A,(_DRV)
  ED52  1807          		JR	GETDPB1
                      	
  ED54                	CHGDRVR:
  ED54  CDD9EF        		CALL	_CHGDRV
  ED57  D8            		RET	C
  ED58  3A89EF        		LD	A,(_DSK)
  ED5B                	GETDPB1:
  ED5B  C3DCEF        		JP	_GETDPB
                      	
  ED5E                	GETDPB:
  ED5E  FE08          		CP	8
  ED60  3F            		CCF
  ED61  D8            		RET	C
  ED62  0F            		RRCA
  ED63  0F            		RRCA
  ED64  0F            		RRCA
  ED65  DD            		DB	0DDH		;Z80未定義命令
  ED66  6F            		LD	L,A		;LD	IXL,A
  ED67  DD            		DB	0DDH		;Z80未定義命令
  ED68  26F1          		LD	H,DEVICE/256	;LD	IXH,DEVICE/256
  ED6A  DD7E00        		LD	A,(IX+0)	;DPB_00_FATLN
  ED6D  A7            		AND	A		;CF=0の為
  ED6E  DDCB0F6E      		BIT	5,(IX+00FH)	;DPB_0F_BPS
  ED72  C0            		RET	NZ		;FAT16
  ED73  DDCB126E      		BIT	5,(IX+012H)	;DPB_12_DEVICE
  ED77  C0            		RET	NZ		;BPB
  ED78  FE01          		CP	001H		;A=0 THEN CF=1
  ED7A  C9            		RET
                      	
  ED7B                	_SYS5F:
  ED7B  AF            		XOR	A
  ED7C                	FFLUSH:
  ED7C  F5            		PUSH	AF
  ED7D  3EFF          		LD	A,0FFH
  ED7F  3239EF        		LD	(SFILE),A
  ED82  CD4CE9        		CALL	DWTX
  ED85  3EFF          		LD	A,0FFH
  ED87  32A5EF        		LD	(_DBDRV),A
  ED8A  CD96E9        		CALL	WTFATX
  ED8D  AF            		XOR	A
  ED8E  32ABEF        		LD	(_FATIX),A
  ED91  2F            		CPL			;0FFH
  ED92  32AAEF        		LD	(_FATDRV),A
  ED95  F1            		POP	AF
  ED96  C9            		RET
                      	
                      	
                      	;X1DISK.ASM
                      	
                      	;	LSX-Dodgers DISK
                      	;	X1/turbo/Z
                      	
  ED97                	SEEK:
  ED97  0610          		LD	B,16
  ED99  DD4E0D        		LD	C,(IX+0DH)	;DPB_0D_MAXSEC
  ED9C  AF            		XOR	A
  ED9D  EB            		EX	DE,HL
  ED9E                	DIV1:
  ED9E  29            		ADD	HL,HL
  ED9F  8F            		ADC	A,A
  EDA0  B9            		CP	C
  EDA1  3802          		JR	C,DIV2
  EDA3  91            		SUB	C
  EDA4  2C            		INC	L
  EDA5                	DIV2:
  EDA5  10F7          		DJNZ	DIV1
                      	
  EDA7  3C            		INC	A	;最小のセクタは１固定
  EDA8  55            		LD	D,L	;TRACK
  EDA9  5F            		LD	E,A	;SECTOR
  EDAA  CB3A          		SRL	D	;CYLINDER
  EDAC  9F            		SBC	A,A
  EDAD  E610          		AND	010H	;SIDE
  EDAF  4F            		LD	C,A
                      	
  EDB0  3A84EF        		LD	A,(_DRIVE)
  EDB3  FE04          		CP	4
  EDB5  3F            		CCF
  EDB6  D8            		RET	C
  EDB7  B1            		OR	C
  EDB8  3236EE        		LD	(MOPAT+1),A	;Motor off data
  EDBB  01FC0F        		LD	BC,00FFCH
  EDBE  F680          		OR	080H		;Motor on
  EDC0  ED79          		OUT	(C),A
                      	
  EDC2  CD08EE        		CALL	SETMODE
  EDC5  D8            		RET	C
                      	
  EDC6  CD4BEE        		CALL	DRIVE
  EDC9  FEFF          		CP	0FFH		;A=0FFH Unknown CYLINDER
  EDCB  CC2AEE        		CALL	Z,FDCRES	;Restore
  EDCE  0EF9          		LD	C,0F9H
  EDD0  ED79          		OUT	(C),A		;Currrent CYLINDER
  EDD2  92            		SUB	D
  EDD3  C8            		RET	Z		;No seek
                      	
  EDD4  3A86EF        		LD	A,(_ISEEK)
  EDD7  4F            		LD	C,A
                      	
  EDD8  DD7E0C        		LD	A,(IX+00CH)	;DPB_0C_MAXCYL
  EDDB  3D            		DEC	A
  EDDC  BA            		CP	D		;Over CYLINDER
  EDDD  D8            		RET	C
                      	
  EDDE  B9            		CP	C		;for Built-in 2DD
  EDDF  3803          		JR	C,SETM2
  EDE1  78            		LD	A,B		;B=00FH
  EDE2  DBFE          		IN	A,(0FEH)		;2HD mode for 2DD seek
  EDE4                	SETM2:
  EDE4  78            		LD	A,B
  EDE5  DBFD          		IN	A,(0FDH)		;MFM mode
                      	
  EDE7  0EFB          		LD	C,0FBH
  EDE9  ED51          		OUT	(C),D
  EDEB  72            		LD	(HL),D
  EDEC  0E18          		LD	C,018H		;Seek
  EDEE                	FDCCMD2:
  EDEE  3A85EF        		LD	A,(_SEEKSP)
  EDF1  E6FF          	FSPAT:	AND	0FFH
  EDF3  B1            		OR	C
                      	
  EDF4                	FDCCMD:
  EDF4  CD41EE        		CALL	COMSET
                      	
  EDF7  3E80          	FDCPAT:	LD	A,080H		;FDC COMMAND(Self-modifying code)
  EDF9  E620          		AND	020H		;Write data Write track
  EDFB  3C            		INC	A
                      	
  EDFC                	SST:
  EDFC  0E00          		LD	C,0
  EDFE                	SST1:
  EDFE  0D            		DEC	C		; 4
  EDFF  20FD          		JR	NZ,SST1		;12 * 256 / 4 = About 1ms
  EE01  3D            		DEC	A
  EE02  20FA          		JR	NZ,SST1
                      	
  EE04  3C            		INC	A		;A=1
  EE05  CD13EE        		CALL	READY
  EE08                	SETMODE:
  EE08  78            		LD	A,B		;B=00FH
  EE09  DBFF          	FDMODE:	IN	A,(0FFH)	;Floppy mode(2D/2HD) (Self-modifying code)
                      	
  EE0B  78            		LD	A,B
  EE0C  DBFD          		IN	A,(0FDH)	;MFM mode
                      	
  EE0E  CD45EE        		CALL	DELAY0		;Head select time
  EE11  3E81          		LD	A,081H
  EE13                	READY:
  EE13  321DEE        		LD	(WAITA+1),A
  EE16  E5            		PUSH	HL
  EE17  0EF8          		LD	C,0F8H
  EE19  61            		LD	H,C
  EE1A                	READY2:
  EE1A  ED78          		IN	A,(C)
  EE1C  E681          	WAITA:	AND	081H		;NOT READY,BUSY
  EE1E  2808          		JR	Z,READYE
  EE20  E3            		EX	(SP),HL		;wait 19clock
  EE21  E3            		EX	(SP),HL		; //
  EE22  2B            		DEC	HL
  EE23  7C            		LD	A,H
  EE24  B5            		OR	L
  EE25  20F3          		JR	NZ,READY2
  EE27  37            		SCF
  EE28                	READYE:
  EE28  E1            		POP	HL
  EE29  C9            		RET
                      	
  EE2A                	FDCRES:
  EE2A  3600          		LD	(HL),0
  EE2C  0E08          		LD	C,8
  EE2E  18BE          		JR	FDCCMD2
                      	
  EE30                	FDMOFF:
  EE30  F5            		PUSH	AF
  EE31  C5            		PUSH	BC
  EE32  01FC0F        		LD	BC,00FFCH	;Motor off
  EE35  3E00          	MOPAT:	LD	A,000H		;(Self-rewriting)
  EE37  ED79          		OUT	(C),A
  EE39  C1            		POP	BC
  EE3A  F1            		POP	AF
  EE3B  C9            		RET
                      	
  EE3C                	SECSET:
  EE3C  01FA0F        		LD	BC,00FFAH
  EE3F  ED59          		OUT	(C),E
  EE41                	COMSET:
  EE41  0EF8          		LD	C,0F8H
  EE43  ED79          		OUT	(C),A
  EE45                	DELAY0:
  EE45  3E1A          		LD	A,26
  EE47                	DELAY:
  EE47  3D            		DEC	A
  EE48  20FD          		JR	NZ,DELAY
  EE4A  C9            		RET
                      	
  EE4B                	DRIVE:
  EE4B  2A84EF        		LD	HL,(_DRIVE)
  EE4E  26EF          		LD	H,_CYL0/256
  EE50  CBFD          		SET	7,L
  EE52  7E            		LD	A,(HL)
  EE53  C9            		RET
                      	
  EE54                	RNF:
  EE54  CD4BEE        		CALL	DRIVE
  EE57  36FF          		LD	(HL),0FFH
  EE59  C9            		RET
                      	
  EE5A  02            	RETRY:	DB	2
                      	
                      	
                      	;	FLOPPY DISK DRIVER(DMA)
                      	
                      	
  EE5B                	WTTRK:
  EE5B  0601          		LD	B,1
  EE5D  3EF4          		LD	A,0F4H
  EE5F  1802          		JR	WTTRK1
  EE61                	FDWT:
  EE61  3EA0          		LD	A,0A0H
  EE63                	WTTRK1:
  EE63  32F8ED        		LD	(FDCPAT+1),A
  EE66  3E10          		LD	A,16
  EE68  180C          		JR	DISK
                      	
  EE6A                	DISKOK:
  EE6A  0601          	FDCNT:	LD	B,1
  EE6C  100B          		DJNZ	DISK1
  EE6E  C9            		RET
                      	
  EE6F                	FDRD:
  EE6F  3E80          		LD	A,080H
  EE71  32F8ED        		LD	(FDCPAT+1),A
  EE74  3E0E          		LD	A,14
                      	
  EE76                	DISK:
  EE76  328DEE        		LD	(DMAPAT+1),A
  EE79                	DISK1:
  EE79  78            		LD	A,B
  EE7A  326BEE        		LD	(FDCNT+1),A
  EE7D  22E5EE        		LD	(DMAD+11),HL
  EE80                	DISKR:
  EE80  3E02          		LD	A,2		;Retry count
  EE82  325AEE        		LD	(RETRY),A
  EE85                	DISK2:
  EE85  D5            		PUSH	DE
  EE86  CD97ED        		CALL	SEEK
  EE89  3843          		JR	C,ERRF
  EE8B  F3            		DI
                      	
  EE8C  3E0E          	DMAPAT:	LD	A,14		;自己書き換え
  EE8E  21DAEE        		LD	HL,DMAD
  EE91  CD17DF        		CALL	SETDMA
  EE94  ED49          		OUT	(C),C		;OUT 01F87H,087H WR6 イネーブル
  EE96  3AF8ED        		LD	A,(FDCPAT+1)
  EE99  C5            		PUSH	BC
  EE9A  CD3CEE        		CALL	SECSET
  EE9D  2AE5EE        		LD	HL,(DMAHL)
  EEA0  23            		INC	HL
  EEA1  1106BB        		LD	DE,0BB06H	;READ DMA
                      	
  EEA4  3E03          		LD	A,3
  EEA6  CD13EE        		CALL	READY
  EEA9  ED78          		IN	A,(C)
                      	
  EEAB  C1            		POP	BC
  EEAC  ED51          		OUT	(C),D		;読み出しマスク設定
  EEAE  ED59          		OUT	(C),E		;バイトカウンタ(LH)
  EEB0  ED58          		IN	E,(C)
  EEB2  ED50          		IN	D,(C)
  EEB4  19            		ADD	HL,DE
  EEB5  D1            		POP	DE
  EEB6  13            		INC	DE
  EEB7  FB            		EI
  EEB8  CD30EE        		CALL	FDMOFF
  EEBB  B7            		OR	A
  EEBC  28AC          		JR	Z,DISKOK
  EEBE  1B            		DEC	DE
  EEBF  CB67          		BIT	4,A
  EEC1  C454EE        		CALL	NZ,RNF
  EEC4                	DISKE2:
  EEC4  215AEE        		LD	HL,RETRY
  EEC7  35            		DEC	(HL)
  EEC8  20BB          		JR	NZ,DISK2
  EECA  B7            		OR	A
  EECB  280A          		JR	Z,ERR
  EECD  D5            		PUSH	DE
  EECE                	ERRF:
  EECE  D1            		POP	DE
  EECF                	DELP:
  EECF  CD54EE        		CALL	RNF
  EED2  CD30EE        		CALL	FDMOFF
  EED5  3EFF          		LD	A,0FFH
  EED7                	ERR:
  EED7  BF            		CP	A
  EED8  37            		SCF
  EED9  C9            		RET
                      	
                      				;X1turbo DISK DMA
  EEDA  C3            	DMAD:	DB	0C3H	;WR6 リセット
  EEDB  7D            		DB	07DH	;WR0 ポートA→ポートB 転送
  EEDC  FB0F          		DW	00FFBH	;ポートA開始アドレス FDC データレジスタ
  EEDE  FFFF          		DW	0FFFFH	;ブロック長(転送サイズ-1)
  EEE0  2C            		DB	02CH	;WR1 ポートAアドレス固定 I/O
  EEE1  10            		DB	010H	;WR2 ポートBインクリメント
  EEE2  80            		DB	080H	;WR3
  EEE3  92            		DB	092H	;WR5 WAIT RDY:LOW
  EEE4  8D            		DB	08DH	;WR4 バイト ポートB開始アドレス(LH)
  EEE5  0000          	DMAHL:	DW	0	;ポートB開始アドレス
  EEE7  CF            		DB	0CFH	;WR6 ロード
  EEE8  01            		DB	001H	;WR0 ポートB←ポートB 転送
  EEE9  CF            		DB	0CFH	;WR6 ロード
                      	
  EEEA                	DMAE:
                      	
  1E9E                	AT_R	EQU	WTTRK-AT_DWT
  EEEA                	AT_TABLE:
                      	
                      	;LDWORK.ASM
                      	
                      	;	LSX-Dodgers WORK0
                      	;
                      	;	CP/M互換BIOS
                      	;	BOOT:アドレス下位1バイトが0になるように
  EEEA                	AT_WORK:
  EEEA                		DS	WORKAD-AT_WORK
                      	
  EF00                	CPM_BOOT:
  EF00  C30000        		JP	0
  EF03                	_SYS00:		;(BDOS)プログラム終了
  EF03                	CPM_WBOOT:
  EF03  C309D1        		JP	WBOOT1
  EF06                	CPM_CONST:
  EF06  C3C1DB        		JP	CONSTX
  EF09                	_SYS07:		;(BDOS)コンソール直接入力
  EF09                	CPM_CONIN:
  EF09  C368DB        		JP	FLGET
  EF0C                	CPM_CONOUT:
  EF0C  C308DE        		JP	CONOUT1
                      	
  EF0F                	DECBF:
  EF0F                		DS	5
  EF14  00            	FDRV	DB	0
  EF15                	FNAME	DS	36
  EF39                	SFILE:	DS	33		;DRV FILENAME
  EF5A                	HLBUF:	DS	3		;Random record buffer
                      	
  EF5D  0000          	LEFTX:	DW	0
  EF5F  0000          	DTAX:	DW	0
                      	
  EF61                	ZERO:
  EF61                	BEEPD:
  EF61  008E01000B000C		DB	0,08EH,1,0,00BH,0,00CH,010H
  EF69  073E08100D00FF		DB	007H,03EH,008H,010H,00DH,0,0FFH
  EF62                	RTC_YY	EQU	BEEPD+1
  EF63                	RTC_MW	EQU	BEEPD+2
  EF64                	RTC_DD	EQU	BEEPD+3
  EF65                	RTC_TT	EQU	BEEPD+4
  EF66                	RTC_MM	EQU	BEEPD+5
  EF67                	RTC_SS	EQU	BEEPD+6
                      	
  EF70  00            	CHECK:	DB	0
                      	
  EF71  4F4B24        	OK:	DB	"OK$"
  EF74                		DS	5
  EF79  4572726F722124	COMERM:	DB	"Error!$"
                      	;	システムワークエリア
                      	;	_CYL0:アドレス下位1バイトが080Hになるように
  EF80  FF            	_CYL0:	DB	0FFH	;Cylinder
  EF81  FF            	_CYL1:	DB	0FFH	;Cylinder
  EF82  FF            	_CYL2:	DB	0FFH	;Cylinder
  EF83  FF            	_CYL3:	DB	0FFH	;Cylinder
  EF84  00            	_DRIVE:	DB	0	;unit number
  EF85  00            	_SEEKSP:DB	0	;Seek speed
  EF86  FF            	_ISEEK:	DB	0FFH	;
  EF87  00            	_DVSW:	DB	0
  EF88  00            	_DRV:	DB	0
  EF89  FF            	_DSK:	DB	0FFH
  EF8A  8000          	_DTA:	DW	00080H
  EF8C  0000          	_CTC:	DW	0
  EF8E  0000          	_TXADR:	DW	0
  EF90  0000          	_KEYPS:	DW	0
  EF92  00FF          	_KEYD:	DW	0FF00H	;キーデータ
  EF94  C210          	_KEYSP:	DB	KEYSP_L,KEYSP_H	;オートリピートの速度
  EF96  07            	_COLORF:DB	COLORF	;色
  EF97  18            	_LINE:	DB	LINE
                      	
  EF98  0000          	_FCB:	DW	0	;SEARCH FILES
  EF9A  0000          	_FBPS:	DW	0	;    //
  EF9C  0000          	_FBAD:	DW	0	;    //
  EF9E  00            	_FBCNT:	DB	0	;    //
  EF9F  00            	_FILEN:	DB	0	;    //
  EFA0  00            	_DIRF:	DB	0	;bit7:ディレクトリ bit0-6:セクタインデックス
  EFA1                		DS	1
  EFA2  00            	_WTFATF:DB	0	;FATバッファの更新フラグ
  EFA3                		DS	1
  EFA4  00            	_WTDBF:	DB	0	;データバッファの更新フラグ
  EFA5  FF            	_DBDRV:	DB	0FFH	;データバッファにあるデータを読み込んだドライブ
  EFA6  0000          	_DBSEC:	DW	0	;データバッファにあるデータを読み込んだセクタ番号
  EFA8  0000          	_DPB:	DW	0
  EFAA                	_FATDRV:
  EFAA  FF            		DB	0FFH	;FATバッファに読み込んでいるドライブ
  EFAB  00            	_FATIX:	DB	0	;FATバッファに読み込んでいるインデックス
  EFAC                	_FAKEFREE:
  EFAC  0000          		DW	0	;偽の残量（FATサイズが大きくなると重くなるのでその対策）
                      	
  EFAE                		DS	2
                      	
  EFB0                	CRTCD:	
  EFB0  6F            		DB	06FH
  EFB1                	_WIDTH:	
  EFB1  50            		DB	WIDTH
  EFB2                	TVRAMTOP:
  EFB2  5938          		DB	059H,038H
  EFB4  1F02          		DB	01FH,002H
  EFB6                	_LINE2:
  EFB6  19            		DB	019H
  EFB7                	WKE4:
  EFB7  1C            		DB	01CH
  EFB8                	WKE6:
  EFB8  00            		DB	000H
  EFB9                	WK40:
  EFB9  07            		DB	007H
  EFBA                	_PAGE_MINUS:
  EFBA  80F8          		DW	0-WIDTH*LINE
  EFBC                	_WIDTH_MINUS:
  EFBC  B0FF          		DW	0-WIDTH
  EFBE                	WK30:
  EFBE  0C            		DB	00CH
  EFBF                	WK31:
  EFBF                	WK1FD0:
  EFBF  20            		DB	020H
                      	
  EFC0  ACDA          	CTC0:	DW	INTCTCE
  EFC2  ACDA          	CTC1:	DW	INTCTCE
  EFC4  B4DA          	CTC2:	DW	INTCTC2
  EFC6  ACDA          	CTC3:	DW	INTCTCE
  EFC8  8FDA          	INTVEC:	DW	INT
                      	
                      	;	LSX-Dodgers 独自BIOS
                      	
  EFCA  C3EDDF        	_INKEY:	JP	INKEY
  EFCD  C38FDC        	_PRINT:	JP	PRINT
  EFD0  C355DF        	_SCRN:	JP	SCRN
  EFD3  C37FDF        	_POS:	JP	POS
  EFD6  C3D1DD        	_LOC:	JP	LOC
  EFD9                	_CHGDRV:
  EFD9  C393EC        		JP	CHGDRV
  EFDC                	_GETDPB:
  EFDC  C35EED        		JP	GETDPB
  EFDF                	_FFLUSH:
  EFDF  C37CED        		JP	FFLUSH
  EFE2                	_RDFATX:
  EFE2  C36CE9        		JP	RDFATX
  EFE5  C394EA        	_RDFAT:	JP	RDFAT
  EFE8  C35BEE        	_WTTRK:	JP	WTTRK
  EFEB  C36FEE        	_FDRD:	JP	FDRD
  EFEE  C361EE        	_FDWT:	JP	FDWT
  EFF1                	_BPB2DPB:
  EFF1  C321EB        		JP	BPB2DPB
  EFF4                		DS	3
  EFF7                	_GNCL:
  EFF7  C30EEA        	GNCPAT:	JP	GNCL		; self-modifying code
  EFFA                	_SNCL:
  EFFA  C331EA        	SNCPAT:	JP	SNCL		; self-modifying code
  EFFD  C375D1        	_COMANL:JP	COMANL
                      	
  F000                	_WE:
                      	
                      	;LDCALL.ASM
                      	
                      	;	LSX-Dodgers システムコール(BDOS)
                      	;
                      	;	LSX-Dodgers SYSTEM CALL
                      	;	STABLE:アドレス下位1バイトが0になるように
                      	
  F000                	STABLE:
                      	;0
  F000  03EF3BDB47DBA1		DW	_SYS00,_SYS01,_SYS02,_SYS03
  F008  E7D7E7D74CDB09		DW	_SYS04,_SYS05,_SYS06,_SYS07
  F010  54DBE9D78DDBB9		DW	_SYS08,_SYS09,_SYS0A,_SYS0B
  F018  FED703D812D825		DW	_SYS0C,_SYS0D,_SYS0E,_SYS0F
                      	;1
  F020  79D8C0D809D93F		DW	_SYS10,_SYS11,_SYS12,_SYS13
  F028  47D95DD972D96A		DW	_SYS14,_SYS15,_SYS16,_SYS17
  F030  B9D9BED9C3D9C9		DW	_SYS18,_SYS19,_SYS1A,_SYS1B
  F038  E7D7EFD9E7D7F3		DW	_SYS1C,_SYS1D,_SYS1E,_SYS1F
                      	;2
  F040  E7D7A9D9B1D9FA		DW	_SYS20,_SYS21,_SYS22,_SYS23
  F048  20DAE7D729E60E		DW	_SYS24,_ERROR,_SYS26,_SYS27
  F050  B1D929DACFDBA1		DW	_SYS28,_SYS5C,_SYS2A,_SYS2B
  F058  F2DBA1E1E7D74C		DW	_SYS2C,_SYS2D,_SYS2E,_SYS2F
                      	;3
  F060  46DAE7D7E7D7E7		DW	_SYS30,_ERROR,_ERROR,_ERROR
  F068  E7D7E7D7E7D7E7		DW	_ERROR,_ERROR,_ERROR,_ERROR
  F070  E7D7A1E1A1E16D		DW	_ERROR,_SYS39,_SYS3A,_SYS5A
                      	;DOS2
  F078  CAD7          		DW	_DOS2
                      	
  F07A                		DS	2
  F07C  00F2          	_FATBF:	DW	FATBF
  F07E  00FA          	_DTBUF:	DW	DTBUF
                      	
                      	;	コントロールコードテーブル
                      	;	CTRLTB:アドレス下位1バイトが080Hになるように
                      	
  F080                	CTRLTB:
  F080  46DD46DD82DDC9		DW	CTRL00,CTRL00,CTRL02,CTRL03	;  A,B,C
  F088  C3DEA6DDA2DE29		DW	CTRL04,CTRL05,CTRL06,CTRL07	;D,E,F,G
  F090  52DD73DDCCDEE7		DW	CTRL08,CTRL09,CTRL0A,CTRL0B	;H,I,J,K
  F098  9FDECCDDE1DE46		DW	CTRL0C,CTRL0D,CTRL0E,CTRL00	;L,M,N,O
  F0A0  46DD46DDDFDD46		DW	CTRL00,CTRL00,CTRL12,CTRL00	;P,Q,R,S
  F0A8  46DD46DD46DD46		DW	CTRL00,CTRL00,CTRL00,CTRL00	;T,U,V,W
  F0B0  46DD46DD9FDEEE		DW	CTRL00,CTRL00,CTRL0C,CTRL1B	;X,Y,Z,ESC
  F0B8  6DDD59DD62DDCC		DW	CTRL1C,CTRL1D,CTRL1E,CTRL1F	;→,←,↑,↓
                      	
  F0C0  0200          	M2D:	DW	2
  F0C2  FD02          		DB	0FDH,2
  F0C4  6401          		DW	356
  F0C6  FF0728090182  		DB	0FFH,7,40,9,1,082H
  F0CC  0500A7000800  		DW	5,0A7H,8
                      	
  F0D2  0200          	M2HD:	DW	2
  F0D4  FE01          		DB	0FEH,1
  F0D6  C704          		DW	1223
  F0D8  FE064D080184  		DB	0FEH,6,77,8,1,084H
  F0DE  0500A7000900  		DW	5,0A7H,9
                      	
  F0E4                		DS	6
                      	
  F0EA  1617          	SDDATA:	DB	22,23		;(FCB)ファイルを最後に変更した時刻
  F0EC  1415          		DB	20,21		;(FCB)ファイルを最後に変更した日付
  F0EE  1A1B          		DB	26,27		;(FCB)ファイルの先頭クラスタ
  F0F0  10111213      		DB	16,17,18,19	;(FCB)ファイルのサイズ(バイト単位)
  F0F4                	SDDATAE:
                      	
  F0F4                	SCDIR:	DS	2		;+14 +15
  F0F6                	SFBPS:	DS	2		;FBPS
  F0F8                	SFNDF:	DS	2		;FILEN DIRF
                      	
  F0FA  0000          	_FATPS:	DW	0
  F0FC  0000          	_DIRPS:	DW	0
  F0FE  0000          	_CLPS:	DW	0
                      	
  F100                	_PE:
                      	
                      	;X1DPB.ASM
                      	
                      	;	LSX-Dodgers DPB
                      	;	X1/turbo/Z
                      	
  F100                	DEVICE:
                      	
                      	;	A:
                      	
  F100  0200          		DW	2	;DPB_00_FATLN
  F102  EBEF          		DW	_FDRD	;DPB_02_DRD
  F104  EEEF          		DW	_FDWT	;DPB_04_DWT
  F106  FD            		DB	0FDH	;DPB_06_FATID
  F107  02            		DB	2	;DPB_07_SECPCL
  F108  6401          		DW	356	;DPB_08_MAXCL
  F10A  FF            		DB	0FFH	;DPB_0A_FDMODE	0FFH=2D / 0FEH=2HD
  F10B  07            		DB	7	;DPB_0B_DIRSCNT
  F10C  28            		DB	40	;DPB_0C_MAXCYL
  F10D  09            		DB	9	;DPB_0D_MAXSEC	Number of sectors
  F10E  01            		DB	1	;DPB_0E_FATPS
  F10F  82            		DB	082H	;DPB_0F_BPS
  F110  0500          		DW	5	;DPB_10_DIRPS
  F112  A7            		DB	0A7H	;DPB_12_DEVICE	Device Number
  F113  00            		DB	0	;DPB_13_UNITNO
  F114  0800          		DW	8	;DPB_14_ADDCL16
  F116  0000          		DW	0	;DPB_16
  F118  0000          		DW	0	;DPB_18
  F11A  0000          		DW	0	;DPB_1A_SDIR
  F11C  46444430      		DB	"FDD0"	;DPB_1C_NAME
                      	
                      	;	B:
                      	
  F120  0200          		DW	2	;DPB_00_FATLN
  F122  EBEF          		DW	_FDRD	;DPB_02_DRD
  F124  EEEF          		DW	_FDWT	;DPB_04_DWT
  F126  FD            		DB	0FDH	;DPB_06_FATID
  F127  02            		DB	2	;DPB_07_SECPCL
  F128  6401          		DW	356	;DPB_08_MAXCL
  F12A  FF            		DB	0FFH	;DPB_0A_FDMODE	0FFH=2D / 0FEH=2HD
  F12B  07            		DB	7	;DPB_0B_DIRSCNT
  F12C  28            		DB	40	;DPB_0C_MAXCYL
  F12D  09            		DB	9	;DPB_0D_MAXSEC	Number of sectors
  F12E  01            		DB	1	;DPB_0E_FATPS
  F12F  82            		DB	082H	;DPB_0F_BPS
  F130  0500          		DW	5	;DPB_10_DIRPS
  F132  A7            		DB	0A7H	;DPB_12_DEVICE	Device Number
  F133  01            		DB	1	;DPB_13_UNITNO
  F134  0800          		DW	8	;DPB_14_ADDCL16
  F136  0000          		DW	0	;DPB_16
  F138  0000          		DW	0	;DPB_18
  F13A  0000          		DW	0	;DPB_1A_SDIR
  F13C  46444431      		DB	"FDD1"	;DPB_1C_NAME
                      	
                      	;	C:
                      	
  F140  0200          		DW	2	;DPB_00_FATLN
  F142  EBEF          		DW	_FDRD	;DPB_02_DRD
  F144  EEEF          		DW	_FDWT	;DPB_04_DWT
  F146  FD            		DB	0FDH	;DPB_06_FATID
  F147  02            		DB	2	;DPB_07_SECPCL
  F148  6401          		DW	356	;DPB_08_MAXCL
  F14A  FF            		DB	0FFH	;DPB_0A_FDMODE	0FFH=2D / 0FEH=2HD
  F14B  07            		DB	7	;DPB_0B_DIRSCNT
  F14C  28            		DB	40	;DPB_0C_MAXCYL
  F14D  09            		DB	9	;DPB_0D_MAXSEC	Number of sectors
  F14E  01            		DB	1	;DPB_0E_FATPS
  F14F  82            		DB	082H	;DPB_0F_BPS
  F150  0500          		DW	5	;DPB_10_DIRPS
  F152  A7            		DB	0A7H	;DPB_12_DEVICE	Device Number
  F153  02            		DB	2	;DPB_13_UNITNO
  F154  0800          		DW	8	;DPB_14_ADDCL16
  F156  0000          		DW	0	;DPB_16
  F158  0000          		DW	0	;DPB_18
  F15A  0000          		DW	0	;DPB_1A_SDIR
  F15C  46444432      		DB	"FDD2"	;DPB_1C_NAME
                      	
                      	;	D:
                      	
  F160  0200          		DW	2	;DPB_00_FATLN
  F162  EBEF          		DW	_FDRD	;DPB_02_DRD
  F164  EEEF          		DW	_FDWT	;DPB_04_DWT
  F166  FD            		DB	0FDH	;DPB_06_FATID
  F167  02            		DB	2	;DPB_07_SECPCL
  F168  6401          		DW	356	;DPB_08_MAXCL
  F16A  FF            		DB	0FFH	;DPB_0A_FDMODE	0FFH=2D / 0FEH=2HD
  F16B  07            		DB	7	;DPB_0B_DIRSCNT
  F16C  28            		DB	40	;DPB_0C_MAXCYL
  F16D  09            		DB	9	;DPB_0D_MAXSEC	Number of sectors
  F16E  01            		DB	1	;DPB_0E_FATPS
  F16F  82            		DB	082H	;DPB_0F_BPS
  F170  0500          		DW	5	;DPB_10_DIRPS
  F172  A7            		DB	0A7H	;DPB_12_DEVICE
  F173  03            		DB	3	;DPB_13_UNITNO
  F174  0800          		DW	8	;DPB_14_ADDCL16
  F176  0000          		DW	0	;DPB_16
  F178  0000          		DW	0	;DPB_18
  F17A  0000          		DW	0	;DPB_1A_SDIR
  F17C  46444433      		DB	"FDD3"	;DPB_1C_NAME
                      	
                      	;	E:
                      	
  F180  0000          	EMMFL:	DW	0	;DPB_00_FATLN
  F182  70D7          	EMMRD:	DW	EDRD	;DPB_02_DRD
  F184  6CD7          	EMMWR:	DW	EDWT	;DPB_04_DWT
  F186  FE            		DB	0FEH	;DPB_06_FATID
  F187  02            		DB	2	;DPB_07_SECPCL
  F188  0000          	EMMCL:	DW	0	;DPB_08_MAXCL
  F18A  00            		DB	0	;DPB_0A_FDMODE
  F18B  0C            		DB	12	;DPB_0B_DIRSCNT
  F18C  00            		DB	0	;DPB_0C_MAXCYL
  F18D  00            		DB	0	;DPB_0D_MAXSEC
  F18E  02            		DB	2	;DPB_0E_FATPS
  F18F  02            		DB	2	;DPB_0F_BPS
  F190  0A00          		DW	10	;DPB_10_DIRPS
  F192  06            	EMMDV:	DB	6	;DPB_12_DEVICE
  F193  00            		DB	0	;DPB_13_UNITNO
  F194  1200          		DW	18	;DPB_14_ADDCL16
  F196  0000          		DW	0	;DPB_16
  F198  0000          		DW	0	;DPB_18
  F19A  0000          		DW	0	;DPB_1A_SDIR
  F19C  454D4D30      		DB	"EMM0"	;DPB_1C_NAME
                      	
                      	;	F:
                      	
  F1A0  0000          	BANKFL:	DW	0	;DPB_00_FATLN
  F1A2  04D7          		DW	BDRD	;DPB_02_DRD
  F1A4  00D7          		DW	BDWT	;DPB_04_DWT
  F1A6  F9            		DB	0F9H	;DPB_06_FATID
  F1A7  02            		DB	2	;DPB_07_SECPCL
  F1A8  0000          	BANKCL:	DW	0	;DPB_08_MAXCL
  F1AA  00            		DB	0	;DPB_0A_FDMODE
  F1AB  08            		DB	8	;DPB_0B_DIRSCNT
  F1AC  00            		DB	0	;DPB_0C_MAXCYL
  F1AD  01            		DB	1	;DPB_0D_MAXSEC
  F1AE  00            		DB	0	;DPB_0E_FATPS
  F1AF  02            		DB	2	;DPB_0F_BPS
  F1B0  0200          		DW	2	;DPB_10_DIRPS
  F1B2  0B            	BANKDV:	DB	00BH	;DPB_12_DEVICE
  F1B3  00            		DB	0	;DPB_13_UNITNO
  F1B4  0600          		DW	6	;DPB_14_ADDCL16
  F1B6  0000          		DW	0	;DPB_16
  F1B8  0000          		DW	0	;DPB_18
  F1BA  0000          		DW	0	;DPB_1A_SDIR
  F1BC  4252414D      		DB	"BRAM"	;DPB_1C_NAME
                      	
                      	;	G:
                      	
  F1C0  0200          		DW	2	;DPB_00_FATLN
  F1C2  C1D6          		DW	GDRD	;DPB_02_DRD
  F1C4  D8D6          		DW	GDWT	;DPB_04_DWT
  F1C6  FA            		DB	0FAH	;DPB_06_FATID
  F1C7  01            		DB	1	;DPB_07_SECPCL
  F1C8  B800          		DW	184	;DPB_08_MAXCL
  F1CA  00            		DB	0	;DPB_0A_FDMODE
  F1CB  07            		DB	7	;DPB_0B_DIRSCNT
  F1CC  00            		DB	0	;DPB_0C_MAXCYL
  F1CD  01            		DB	1	;DPB_0D_MAXSEC
  F1CE  01            		DB	1	;DPB_0E_FATPS
  F1CF  01            		DB	1	;DPB_0F_BPS
  F1D0  0300          		DW	3	;DPB_10_DIRPS
  F1D2  05            		DB	5	;DPB_12_DEVICE
  F1D3  01            		DB	1	;DPB_13_UNITNO
  F1D4  0800          		DW	8	;DPB_14_ADDCL16
  F1D6  0000          		DW	0	;DPB_16
  F1D8  0000          		DW	0	;DPB_18
  F1DA  0000          		DW	0	;DPB_1A_SDIR
  F1DC  4752414D      		DB	"GRAM"	;DPB_1C_NAME
                      	
                      	;	H:
  F1E0                		DS	32-8
  F1F8  00            		DB	0
                      	
                      	
  F1F9                	LAST_ADR:
                      	
  F1F9                		END
