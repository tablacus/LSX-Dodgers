			  Z80 ASSEMBLER - ZASM VER 1.6
                      	;	LSX-Dodgers for X1/turbo/Z
                      	;	Programmed by
                      	;	Gaku (Lovers/Tablacus)
                      	;X1DEF.ASM
                      	
                      	;	LSX-Dodgers DEF
                      	;	X1/turbo/Z
                      	
  0000                	MAC	EQU	0		;X1
  0000                	DEV EQU 0
                      	
  CB00                	RUN	EQU	0CB00H
  D106                	BDOS	EQU	0D106H
  EF00                	WORKAD	EQU	0EF00H
  F200                	FATBF	EQU	0F200H
  FA00                	DTBUF	EQU	0FA00H
  FE00                	KEYBF	EQU	0FE00H
  FF00                	KBUF	EQU	0FF00H
  FFCA                	EXTSP	EQU	0FFCAH
  FFD9                	TRAP38	EQU	0FFD9H
  0050                	WIDTH	EQU	80
  0018                	LINE	EQU	24
  0007                	COLORF	EQU	7
  0009                	COMS	EQU	9
                      	
                      	
                      	;LDDEF.ASM
                      	
                      	;	LSX-Dodgers DEF
                      	
  0001                	VER_1   EQU	1
  0004                	VER_2   EQU	4
  0009                	VER_3   EQU	9
  1D00                	MACW	EQU	MAC + 01D00H	;機種フラグとLD判別フラグ
  0000                	MACD	EQU	MAC + DEV * 256	;機種フラグとデバイスフラグ
  0149                	VER	EQU	VER_1 * 256 + VER_2 * 16 + VER_3
                      	
  0005                	SYSTEM	EQU	00005H
  000F                	JP_HL	EQU	0000FH
  005C                	FCB1	EQU	0005CH
  006C                	FCB2	EQU	0006CH
  005D                	FCB1FN	EQU	FCB1+1
  006D                	FCB2FN	EQU	FCB2+1
  0080                	DTA1	EQU	00080H
                      	
  FFCA                	EXTBIO	EQU	0FFCAH
                      	
                      	
                      	
  CAF9                		ORG	RUN-7
                      	
                      	;	MSX BINARY HEADER
  CAF9  FE            		DB	0FEH
                      	;	MSX BINARY START ADDRESS
  CAFA  00CB          		DW	RUN
                      	;	MSX BINARY END ADDRESS
  CAFC  F9F1          		DW	LAST_ADR
                      	;	MSX BINARY EXEC ADDRESS
  CAFE  07CB          		DW	START
                      	;X1INIT.ASM
                      	
                      	;	LSX-Dodgers INIT
                      	;	X1/turbo/Z
                      	
  CB00  C307CB        		JP	START
  CB03  001D          		DW	MACW
  CB05  4901          		DW	VER
                      	
  CB07                	START:
  CB07  F3            		DI
  CB08  ED5E          		IM	2
  CB0A  31CAFF        		LD	SP,EXTSP
  CB0D  CD1BCB        		CALL	INIT		;NZならAUTOEXECを実行
  CB10  210000        		LD	HL,0
  CB13  E5            		PUSH	HL
  CB14  C8            		RET	Z
  CB15  11B2CE        		LD	DE,AUTOD
  CB18  C3FDEF        		JP	_COMANL
                      	
  CB1B                	INIT:
  CB1B  3E1E          		LD	A,01EH
  CB1D  D300          		OUT	(0),A
                      	
  CB1F  010000        		LD	BC,0
  CB22  ED438CEF      		LD	(_CTC),BC
  CB26  01040A        		LD	BC,00A04H
  CB29  CD5CCE        		CALL	CHKCTC
  CB2C  010407        		LD	BC,00704H
  CB2F  CD5CCE        		CALL	CHKCTC
  CB32  01A81F        		LD	BC,01FA8H
  CB35  CD5CCE        		CALL	CHKCTC
  CB38  01A01F        		LD	BC,01FA0H
  CB3B  CD5CCE        		CALL	CHKCTC
                      	;
  CB3E                	INISIO:
  CB3E  01911F        		LD	BC,01F91H	;INIT SIO
  CB41  1601          		LD	D,1
  CB43  ED51          		OUT	(C),D
                      	
  CB45  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  CB47  0E93          		LD	C,093H
  CB49  ED51          		OUT	(C),D
  CB4B  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  CB4D  0E99          		LD	C,099H		;INIT SIO
  CB4F  1601          		LD	D,1
  CB51  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  CB53  0E9B          		LD	C,09BH
  CB55  ED51          		OUT	(C),D
  CB57  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
                      	
  CB59  0E80          		LD	C,080H		;INIT DMA
  CB5B  2106C3        		LD	HL,0C306H
  CB5E                	INIDMA:
  CB5E  ED61          		OUT	(C),H
  CB60  2D            		DEC	L
  CB61  20FB          		JR	NZ,INIDMA
                      	
  CB63  3EE4          		LD	A,0E4H
  CB65  CD5EDE        		CALL	COMOUT
  CB68  AF            		XOR	A
  CB69  CD38DE        		CALL	OT49SB
                      	
  CB6C  3EEF          		LD	A,INTVEC/256
  CB6E  ED47          		LD	I,A
                      	
  CB70  ED4B8CEF      		LD	BC,(_CTC)
  CB74  0D            		DEC	C
  CB75  0D            		DEC	C
                      	
  CB76  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  CB78  3EC0          		LD	A,CTC0
  CB7A  ED79          		OUT	(C),A
                      	
  CB7C  0C            		INC	C
  CB7D  3E47          		LD	A,047H
  CB7F  ED79          		OUT	(C),A
  CB81  3E0D          		LD	A,13		;Baudrate 9600-13
  CB83  ED79          		OUT	(C),A
                      	
  CB85  79            		LD	A,C
  CB86  D610          		SUB	010H
  CB88  4F            		LD	C,A
                      	;	LD	(SIOAD+1),BC
                      	;	LD	(SIOAD0+1),BC
                      	;	LD	(SIOAD1+1),BC
                      	
  CB89  2102CF        		LD	HL,SIODATA
  CB8C                	SINIT1:
  CB8C  7E            		LD	A,(HL)
  CB8D  23            		INC	HL
  CB8E  FEFF          		CP	0FFH
  CB90  2804          		JR	Z,SINIT2
  CB92  ED79          		OUT	(C),A
  CB94  18F6          		JR	SINIT1
  CB96                	SINIT2:
  CB96  3EE4          		LD	A,0E4H
  CB98  CD5EDE        		CALL	COMOUT
  CB9B  3EC8          		LD	A,INTVEC
  CB9D  CD38DE        		CALL	OT49SB
                      	;
  CBA0  01C41F        		LD	BC,01FC4H
  CBA3  3E0C          		LD	A,00CH
  CBA5  ED79          		OUT	(C),A
                      	
  CBA7  0EC0          		LD	C,0C0H
  CBA9  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
                      	
  CBAB  0C            		INC	C
  CBAC  3E28          		LD	A,40
  CBAE  ED79          		OUT	(C),A
                      	
  CBB0  0C            		INC	C
  CBB1  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
                      	
  CBB3  0C            		INC	C
  CBB4  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
                      	
  CBB6  0EC5          		LD	C,0C5H
  CBB8  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
                      	
  CBBA                	TEXT:
  CBBA  0EB0          		LD	C,0B0H
  CBBC  3E80          		LD	A,080H
  CBBE  ED79          		OUT	(C),A
  CBC0  1607          		LD	D,7
  CBC2  0EB9          		LD	C,0B9H
  CBC4  21FBCE        		LD	HL,TEXTDT
  CBC7                	TEXT1:
  CBC7  04            		INC	B
  CBC8  EDA3          		OUTI
  CBCA  0C            		INC	C
  CBCB  15            		DEC	D
  CBCC  20F9          		JR	NZ,TEXT1
  CBCE  01B01F        		LD	BC,01FB0H
  CBD1  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
                      	
  CBD3  0EC4          		LD	C,0C4H
  CBD5  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
                      	
  CBD7  01011A        		LD	BC,01A01H
  CBDA  ED78          		IN	A,(C)
  CBDC  E608          		AND	8
  CBDE  2809          		JR	Z,PRN
  CBE0  0E03          		LD	C,003H
  CBE2  3E0F          		LD	A,00FH
  CBE4  ED79          		OUT	(C),A
  CBE6  01040A        		LD	BC,00A04H
  CBE9                	PRN:
  CBE9  210000        		LD	HL,0
  CBEC  065C          		LD	B,05CH
  CBEE  3EFF          		LD	A,0FFH		;RST 38H
  CBF0  CDB6E0        		CALL	FILL_MEMORY
  CBF3  06A4          		LD	B,0A4H
  CBF5  AF            		XOR	A
  CBF6  CDB6E0        		CALL	FILL_MEMORY
                      	
  CBF9  3EC3          		LD	A,0C3H		;JP
  CBFB  2103EF        		LD	HL,CPM_WBOOT
  CBFE  320000        		LD	(00000H),A
  CC01  220100        		LD	(00001H),HL	;IPL
                      	
  CC04  21001D        		LD	HL,MACW	;3 bit7  DPB Compatible LA(1)
  CC07  220300        		LD	(00003H),HL	;  bit6-0 Machine X1(0)
                      	;				;4 LSX-Dodgers(01DH)
  CC0A  2106D1        		LD	HL,BDOS
  CC0D  320500        		LD	(00005H),A
  CC10  220600        		LD	(00006H),HL	;BDOS
                      	
  CC13  217EDA        		LD	HL,BIOS
  CC16  221900        		LD	(00019H),HL	;BIOS-ROM
                      	
  CC19  21D9FF        		LD	HL,TRAP38	;TRAP38
  CC1C  323800        		LD	(00038H),A
  CC1F  223900        		LD	(00039H),HL	;RST 038H
                      	
  CC22  3EEF          		LD	A,CPM_BOOT/256
  CC24  320B00        		LD	(0000BH),A
                      	
  CC27  3EE9          		LD	A,0E9H		;JP (HL)
  CC29  320F00        		LD	(0000FH),A
                      	
  CC2C  3A7DF0        		LD	A,(_FATBF+1)
  CC2F  321300        		LD	(00013H),A
                      	
  CC32  3A7FF0        		LD	A,(_DTBUF+1)
  CC35  321700        		LD	(00017H),A
                      	
  CC38  3EFE          		LD	A,KEYBF/256
  CC3A  321B00        		LD	(0001BH),A
                      	
  CC3D  3EFF          		LD	A,KBUF/256
  CC3F  321F00        		LD	(0001FH),A
                      	
  CC42  214901        		LD	HL,VER
  CC45  225A00        		LD	(0005AH),HL
                      	
  CC48  3EE6          		LD	A,0E6H
  CC4A  CD5EDE        		CALL	COMOUT
  CC4D  CD43DE        		CALL	IN49SB
  CC50  F5            		PUSH	AF
  CC51  CD43DE        		CALL	IN49SB
  CC54  F1            		POP	AF
  CC55  F5            		PUSH	AF
  CC56  E612          		AND	012H
  CC58  2005          		JR	NZ,KEYR
  CC5A  3E01          		LD	A,1
  CC5C  32B2CD        		LD	(KEYREP+1),A
  CC5F                	KEYR:
  CC5F  F1            		POP	AF
  CC60  E603          		AND	3
  CC62  280E          		JR	Z,NON
                      	
  CC64  01D03F        		LD	BC,03FD0H
  CC67  ED49          		OUT	(C),C
  CC69  3E37          		LD	A,037H
  CC6B  D3D0          		OUT	(0D0H),A
  CC6D  ED78          		IN	A,(C)
  CC6F  B9            		CP	C
  CC70  2865          		JR	Z,TURBO
  CC72                	NON:
  CC72  210ECF        		LD	HL,AT_SCR1
  CC75  11E8DE        		LD	DE,SCR1
  CC78  019400        		LD	BC,SCRNE-SCR1	;転送先のサイズ確認用
  CC7B  018500        		LD	BC,AT_SCRE-AT_SCR1
  CC7E  EDB0          		LDIR
                      	
  CC80  2193CF        		LD	HL,AT_DWT
  CC83  112BEE        		LD	DE,WTTRK
  CC86  018F00        		LD	BC,DMAE-WTTRK	;転送先のサイズ確認用
  CC89  018E00        		LD	BC,AT_CPUE-AT_DWT
  CC8C  EDB0          		LDIR
                      	
  CC8E  2121D0        		LD	HL,AT_EDWT
  CC91  1169D7        		LD	DE,EDWT
  CC94  014B00        		LD	BC,EMME-EDWT	;転送先のサイズ確認用
  CC97  014600        		LD	BC,AT_EMME-AT_EDWT
  CC9A  EDB0          		LDIR
                      	
  CC9C  2163DF        		LD	HL,AT_WTTRK+AT_RS
  CC9F  22E9EF        		LD	(_WTTRK+1),HL
  CCA2  2174EE        		LD	HL,AT_DRD+AT_R
  CCA5  22ECEF        		LD	(_FDRD+1),HL
  CCA8  212BEE        		LD	HL,AT_DWT+AT_R
  CCAB  22EFEF        		LD	(_FDWT+1),HL
  CCAE  217DD7        		LD	HL,AT_EDRD+AT_RE
  CCB1  2282F1        		LD	(EMMRD),HL
  CCB4  2169D7        		LD	HL,AT_EDWT+AT_RE
  CCB7  2284F1        		LD	(EMMWR),HL
  CCBA  216ADF        		LD	HL,AT_SCRN+AT_RS
  CCBD  22D1EF        		LD	(_SCRN+1),HL
                      	
  CCC0  3E27          		LD	A,027H			;ノンターボはMFM切り替えを行わない
  CCC2  3212F1        		LD	(DEVICE+012H),A		;Aドライブ
  CCC5  3232F1        		LD	(DEVICE+012H+32),A	;Bドライブ
  CCC8  3252F1        		LD	(DEVICE+012H+32*2),A	;Cドライブ
  CCCB  3272F1        		LD	(DEVICE+012H+32*3),A	;Dドライブ
                      	
  CCCE  210000        		LD	HL,0
  CCD1  2289DE        		LD	(X1PAT),HL
  CCD4  C360CD        		JP	NOBANK
                      	
  CCD7                	TURBO:
  CCD7  F3            		DI			;Check BIOS
  CCD8  061D          		LD	B,01DH
  CCDA  ED79          		OUT	(C),A		;BIOS ON
  CCDC  3A512F        		LD	A,(02F51H)
  CCDF  04            		INC	B		;B=01EH
  CCE0  ED79          		OUT	(C),A		;BIOS OFF
  CCE2  FB            		EI
  CCE3  FEC9          		CP	0C9H
  CCE5  2802          		JR	Z,BIOSOK
  CCE7  1805          		JR	NOBIOS
  CCE9                	BIOSOK:
  CCE9  3EC3          		LD	A,0C3H		;JP
  CCEB  321800        		LD	(00018H),A
  CCEE                	NOBIOS:
  CCEE  3E1F          		LD	A,01FH		;スタートポート
  CCF0  DBF0          		IN	A,(0F0H)
  CCF2  0F            		RRCA
  CCF3  380B          		JR	C,CRT1
  CCF5  21EBCE        		LD	HL,_C8025H
  CCF8  11B0EF        		LD	DE,CRTCD
  CCFB  011000        		LD	BC,16
  CCFE  EDB0          		LDIR
  CD00                	CRT1:
  CD00  3E1F          		LD	A,01FH		;スタートポート
  CD02  DBF0          		IN	A,(0F0H)
  CD04  CB57          		BIT	2,A
  CD06  2818          		JR	Z,BANK
                      	
  CD08  AF            		XOR	A
  CD09                	TZ1:				;前面スイッチが2HDの場合はMFMモードを2HDにしておく
  CD09  F5            		PUSH	AF
  CD0A  CDDCEF        		CALL	_GETDPB
  CD0D  DD7E12        		LD	A,(IX+012H)	;DPB_12_DEVICE
  CD10  E68F          		AND	08FH
  CD12  FE87          		CP	087H		;フロッピーでMEM切り替えがON
  CD14  2004          		JR	NZ,TZ2
  CD16  DDCB0A86      		RES	0,(IX+0AH)	;(DPB_0A_FDMODE)
  CD1A                	TZ2:
  CD1A  F1            		POP	AF
  CD1B  3C            		INC	A
  CD1C  FE08          		CP	8
  CD1E  38E9          		JR	C,TZ1
                      	
  CD20                	BANK:
  CD20  01000B        		LD	BC,00B00H
  CD23  21007F        		LD	HL,07F00H
  CD26  F3            		DI
  CD27  ED69          		OUT	(C),L
  CD29  3A0000        		LD	A,(0)
  CD2C  FEEB          		CP	0EBH
  CD2E  2005          		JR	NZ,BANK1
  CD30  3E2B          		LD	A,02BH
  CD32  32B2F1        		LD	(BANKDV),A
  CD35                	BANK1:
  CD35  ED69          		OUT	(C),L
  CD37  5E            		LD	E,(HL)
  CD38  7B            		LD	A,E
  CD39  C6A5          		ADD	A,0A5H
  CD3B  77            		LD	(HL),A
  CD3C  BE            		CP	(HL)
  CD3D  73            		LD	(HL),E
  CD3E  2005          		JR	NZ,BANK2
  CD40  2C            		INC	L
  CD41  CB65          		BIT	4,L
  CD43  28F0          		JR	Z,BANK1
  CD45                	BANK2:
  CD45  3E10          		LD	A,010H
  CD47  ED79          		OUT	(C),A
  CD49  7D            		LD	A,L
  CD4A  B7            		OR	A
  CD4B  2813          		JR	Z,NOBANK
  CD4D  2600          		LD	H,0
  CD4F  29            		ADD	HL,HL	;*2
  CD50  29            		ADD	HL,HL	;*4
  CD51  29            		ADD	HL,HL	;*8
  CD52  29            		ADD	HL,HL	;*16
  CD53  29            		ADD	HL,HL	;*32
  CD54  2B            		DEC	HL	;-1
  CD55  2B            		DEC	HL	;-2
  CD56  2B            		DEC	HL	;-3
  CD57  22A8F1        		LD	(BANKCL),HL
  CD5A  CDA2CE        		CALL	CALC_FATLN
  CD5D  32A0F1        		LD	(BANKFL),A
  CD60                	NOBANK:
  CD60                	EMM:
  CD60  DD2180F1      		LD	IX,EMMFL
  CD64  CD53CE        		CALL	EADR0
  CD67  ED78          		IN	A,(C)
  CD69  F5            		PUSH	AF
                      	
  CD6A  110000        		LD	DE,0
  CD6D                	ECHECK1:
  CD6D  13            		INC	DE
  CD6E  CD37CE        		CALL	EADR2
  CD71  ED60          		IN	H,(C)
  CD73  CD37CE        		CALL	EADR2
  CD76  7C            		LD	A,H
  CD77  C6E5          		ADD	A,0E5H
  CD79  ED79          		OUT	(C),A
  CD7B  3C            		INC	A
  CD7C  CD53CE        		CALL	EADR0
  CD7F  ED79          		OUT	(C),A
  CD81  3D            		DEC	A
  CD82  CD37CE        		CALL	EADR2
  CD85  ED68          		IN	L,(C)
  CD87  CD37CE        		CALL	EADR2
  CD8A  ED61          		OUT	(C),H
  CD8C  BD            		CP	L
  CD8D  2004          		JR	NZ,ECHECK2
  CD8F  CB5A          		BIT	3,D
  CD91  28DA          		JR	Z,ECHECK1
  CD93                	ECHECK2:
  CD93  CD53CE        		CALL	EADR0
  CD96  F1            		POP	AF
  CD97  ED79          		OUT	(C),A
  CD99  FEEB          		CP	0EBH
  CD9B  2005          		JR	NZ,EMM_BPB
  CD9D  3E26          		LD	A,026H
  CD9F  3292F1        		LD	(EMMDV),A
  CDA2                	EMM_BPB:
  CDA2  21F7FF        		LD	HL,0-9
  CDA5  19            		ADD	HL,DE
  CDA6  3009          		JR	NC,NOEMM
  CDA8  2288F1        		LD	(EMMCL),HL
  CDAB  CDA2CE        		CALL	CALC_FATLN
  CDAE  3280F1        		LD	(EMMFL),A
  CDB1                	NOEMM:
  CDB1  3E00          	KEYREP:	LD	A,000H
  CDB3  B7            		OR	A
  CDB4  2807          		JR	Z,KEYR1
  CDB6  010000        		LD	BC,0
  CDB9  ED438CEF      		LD	(_CTC),BC
  CDBD                	KEYR1:
  CDBD  CD83CE        		CALL	SETCRTC
  CDC0  0130F8        		LD	BC,0-80*25
  CDC3  2ABAEF        		LD	HL,(_PAGE_MINUS)
  CDC6  ED43BAEF      		LD	(_PAGE_MINUS),BC
  CDCA  1E0C          		LD	E,00CH
  CDCC  CDCDEF        		CALL	_PRINT
  CDCF  22BAEF        		LD	(_PAGE_MINUS),HL
                      	
  CDD2  21BECE        		LD	HL,INIMES
  CDD5  CDF5D7        		CALL	MSX
                      	
  CDD8  3A87FF        		LD	A,(0FF87H)
  CDDB  FE08          		CP	8
  CDDD  301E          		JR	NC,INIT0
  CDDF  5F            		LD	E,A
  CDE0  C641          		ADD	A,'A'
  CDE2  32BBCE        		LD	(AUTODV),A
  CDE5  0E0E          		LD	C,00EH
  CDE7  CD0500        		CALL	SYSTEM
  CDEA  1C            		INC	E
  CDEB  2185EF        		LD	HL,_SEEKSP	;Disk error Ignore
  CDEE  CBFE          		SET	7,(HL)
  CDF0  0E1B          		LD	C,01BH
  CDF2  CD0500        		CALL	SYSTEM
                      	
  CDF5  2185EF        		LD	HL,_SEEKSP
  CDF8  CBBE          		RES	7,(HL)
                      	
  CDFA  3C            		INC	A
  CDFB  2008          		JR	NZ,INIT1
  CDFD                	INIT0:
  CDFD  1E00          		LD	E,0
  CDFF  0E0E          		LD	C,00EH
  CE01  CD0500        		CALL	SYSTEM
  CE04  AF            		XOR	A
  CE05                	INIT1:
  CE05  F3            		DI
  CE06  08            		EX	AF,AF'
  CE07  2EFE          		LD	L,0-2		;CALLのスタック分減らす
  CE09  39            		ADD	HL,SP
  CE0A  1100FF        		LD	DE,0FF00H
  CE0D  45            		LD	B,L
  CE0E  CDE8D4        		CALL	ZERO_MEMORY_DE
  CE11  21CAFF        		LD	HL,EXTSP
  CE14  060F          		LD	B,TRAP38-EXTBIO
  CE16  3EFF          		LD	A,0FFH		;RST 38H
  CE18  CDB6E0        		CALL	FILL_MEMORY
  CE1B  2167D0        		LD	HL,AT_TRAP38
  CE1E  11D9FF        		LD	DE,TRAP38
  CE21  012700        		LD	BC,AT_TRAPE-AT_TRAP38
  CE24  EDB0          		LDIR
  CE26  08            		EX	AF,AF'
  CE27  B7            		OR	A
  CE28  C8            		RET	Z
                      	
  CE29  3EE6          		LD	A,0E6H
  CE2B  CD5EDE        		CALL	COMOUT
  CE2E  CD43DE        		CALL	IN49SB
  CE31  CD43DE        		CALL	IN49SB
  CE34  FE1B          		CP	01BH
  CE36  C9            		RET
                      	
  CE37                	EADR2:
  CE37  D5            		PUSH	DE
  CE38  EB            		EX	DE,HL
  CE39  29            		ADD	HL,HL
  CE3A  29            		ADD	HL,HL
  CE3B  DD4E0D        		LD	C,(IX+00DH)	;DPB_0D_MAXSEC
  CE3E  DD460C        		LD	B,(IX+00CH)	;DPB_0C_MAXCYL
  CE41  09            		ADD	HL,BC
  CE42  DD4E13        		LD	C,(IX+013H)	;DPB_13_UNITNO
  CE45  060D          		LD	B,00DH
  CE47  ED49          		OUT	(C),C
  CE49  0C            		INC	C
  CE4A  ED69          		OUT	(C),L
  CE4C  0C            		INC	C
  CE4D  ED61          		OUT	(C),H
  CE4F  0C            		INC	C
  CE50  EB            		EX	DE,HL
  CE51  D1            		POP	DE
  CE52  C9            		RET
                      	
  CE53                	EADR0:
  CE53  D5            		PUSH	DE
  CE54  110000        		LD	DE,0
  CE57  CD37CE        		CALL	EADR2
  CE5A  D1            		POP	DE
  CE5B  C9            		RET
                      	
  CE5C                	CHKCTC:
  CE5C  C5            		PUSH	BC
  CE5D  110347        		LD	DE,04703H
  CE60                	INICTC1:
  CE60  0C            		INC	C
  CE61  ED51          		OUT	(C),D
  CE63  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  CE65  1D            		DEC	E
  CE66  20F8          		JR	NZ,INICTC1
  CE68  C1            		POP	BC
                      	
  CE69  11FA07        		LD	DE,007FAH
  CE6C  ED51          		OUT	(C),D
  CE6E  ED59          		OUT	(C),E
  CE70  ED78          		IN	A,(C)
  CE72  BB            		CP	E
  CE73  C0            		RET	NZ
  CE74  ED51          		OUT	(C),D
  CE76  ED51          		OUT	(C),D
  CE78  ED78          		IN	A,(C)
  CE7A  BA            		CP	D
  CE7B  C0            		RET	NZ
  CE7C  0C            		INC	C
  CE7D  0C            		INC	C
  CE7E  ED438CEF      		LD	(_CTC),BC
  CE82  C9            		RET
                      	
  CE83                	SETCRTC:
  CE83  21B0EF        		LD	HL,CRTCD
  CE86  AF            		XOR	A
  CE87                	SETCRT1:
  CE87  010018        		LD	BC,01800H
  CE8A  ED79          		OUT	(C),A
  CE8C  0C            		INC	C
  CE8D  04            		INC	B
  CE8E  EDA3          		OUTI
  CE90  3C            		INC	A
  CE91  FE0C          		CP	12
  CE93  20F2          		JR	NZ,SETCRT1
  CE95  23            		INC	HL
  CE96  23            		INC	HL
  CE97  01031B        		LD	BC,01A03H+00100H
  CE9A  EDA3          		OUTI
  CE9C  01D020        		LD	BC,01FD0H+00100H
  CE9F  EDA3          		OUTI
  CEA1  C9            		RET
                      	
  CEA2                	CALC_FATLN:	;FAT12のクラスタ数から必要なFATサイズを求める(セクタサイズ512)
  CEA2  5D            		LD	E,L
  CEA3  54            		LD	D,H
  CEA4  29            		ADD	HL,HL	;*2
  CEA5  19            		ADD	HL,DE	;*3
  CEA6  CB3C          		SRL	H	;/2
  CEA8  CB1D          		RR	L	;1クラスタ辺り1.5バイト必要
  CEAA  11FF01        		LD	DE,511	;切り上げる
  CEAD  19            		ADD	HL,DE
  CEAE  7C            		LD	A,H
  CEAF  CB3F          		SRL	A
  CEB1  C9            		RET
                      	
  CEB2  4155544F455845	AUTOD:	DB	"AUTOEXEC "
  CEBB  413A00        	AUTODV:	DB	"A:",0
                      	
  CEBE  4C53582D446F64	INIMES:	DB	"LSX-Dodgers for X1/turbo version "
  CEDF  312E          		DB	030H + VER_1, '.'
  CEE1  3439          		DB	030H + VER_2 ,030H + VER_3
                      	;	DB	"PR3"
  CEE3  2047616B750D0A		DB	' Gaku',0DH,0AH
  CEEA  00            		DB	0
                      	
  CEEB                	_C8025H:
  CEEB  6B5059881B0119		DB	06BH,050H,059H,088H,01BH,001H,019H,01AH
  CEF3  000F          		DB	000H,00FH
  CEF5  80F8B0FF      		DW	0-80*LINE,0-80
  CEF9  0C23          		DB	00CH,023H
                      	
  CEFB  030C0F30333C3F	TEXTDT:	DB	003H,00CH,00FH,030H,033H,03CH,03FH
                      	
  CF02                	SIODATA:
  CF02  18            		DB	018H
  CF03  0100          		DB	1,0
  CF05  0200          		DB	2,0
  CF07  03C1          		DB	3,0C1H
  CF09  0444          		DB	4,044H
  CF0B  05E8          		DB	5,0E8H
  CF0D  FF            		DB	0FFH
                      	
                      	;	ノンターボ用パッチ
                      	
  CF0E                	AT_SCR1:
  CF0E  D9            		EXX
  CF0F  C5            		PUSH	BC
  CF10  ED4BB1EF      		LD	BC,(_WIDTH)
  CF14  0620          		LD	B,020H
  CF16  D9            		EXX
  CF17  C5            		PUSH	BC
  CF18  010020        		LD	BC,02000H
                      	
  CF1B  67            		LD	H,A
  CF1C  B7            		OR	A
  CF1D                	AT_SCRUP1:
  CF1D  2815          		JR	Z,AT_SCRCL
  CF1F  C5            		PUSH	BC
  CF20  CBE0          		SET	4,B
  CF22  D9            		EXX
  CF23  C5            		PUSH	BC
  CF24  CBE0          		SET	4,B
  CF26  D9            		EXX
  CF27  CD19DF        		CALL	AT_UPSUB+AT_RS
  CF2A  D9            		EXX
  CF2B  C1            		POP	BC
  CF2C  D9            		EXX
  CF2D  C1            		POP	BC
  CF2E  CD19DF        		CALL	AT_UPSUB+AT_RS
  CF31  25            		DEC	H
  CF32  18E9          		JR	AT_SCRUP1
                      	
  CF34                	AT_SCRCL:
  CF34  2AB1EF        		LD	HL,(_WIDTH)
  CF37  CDAFDD        		CALL	LINECL
  CF3A  C1            		POP	BC
  CF3B  D9            		EXX
  CF3C  C1            		POP	BC
  CF3D  D9            		EXX
  CF3E  C9            		RET
                      	
  CF3F                	AT_UPSUB:
  CF3F  3AB1EF        		LD	A,(_WIDTH)
  CF42  6F            		LD	L,A
  CF43                	AT_UPSUB1:
  CF43  D9            		EXX
  CF44  ED78          		IN	A,(C)
  CF46  03            		INC	BC
  CF47  D9            		EXX
  CF48  ED79          		OUT	(C),A
  CF4A  03            		INC	BC
  CF4B  2D            		DEC	L
  CF4C  20F5          		JR	NZ,AT_UPSUB1
  CF4E  C9            		RET
                      	
                      	;	FLOPPY DISK DRIVER(CPU)
                      	
  CF4F                	DISKC:
  CF4F  1B            		DEC	DE
  CF50  CB5F          		BIT	3,A
  CF52  C424EE        		CALL	NZ,RNF
  CF55                	DISKD:
  CF55  E5            		PUSH	HL
  CF56  212AEE        		LD	HL,RETRY
  CF59  35            		DEC	(HL)
  CF5A  E1            		POP	HL
  CF5B  200C          		JR	NZ,AT_ERR		;Retry
  CF5D  B7            		OR	A
  CF5E  2809          		JR	Z,AT_ERR		;Error
                      	
  CF60                	AT_DELP:
  CF60  CD24EE        		CALL	RNF
  CF63  CD00EE        		CALL	FDMOFF
  CF66  3EFF          		LD	A,0FFH
  CF68                	AT_ERRZ:
  CF68  BF            		CP	A
  CF69                	AT_ERR:
  CF69  3EFF          		LD	A,0FFH
  CF6B  C9            		RET
  CF6C                	ERRW:
  CF6C  3EFF          		LD	A,0FFH
  CF6E  BF            		CP	A
  CF6F  37            		SCF
  CF70  C300EE        		JP	FDMOFF
                      	
  CF73                	ERRDW:
  CF73  D1            		POP	DE
  CF74  CD3ADF        		CALL	AT_DELP+AT_RS
  CF77  C239EE        		JP	NZ,DWT0+AT_R
  CF7A  B7            		OR	A
  CF7B  20EF          		JR	NZ,ERRW
  CF7D  C9            		RET
                      	
  CF7E                	ERRDR:
  CF7E  D1            		POP	DE
  CF7F  CD3ADF        		CALL	AT_DELP+AT_RS
  CF82  C282EE        		JP	NZ,DRD0+AT_R
  CF85  B7            		OR	A
  CF86  20E4          		JR	NZ,ERRW
  CF88  C9            		RET
                      	
  CF89                	AT_WTTRK:
  CF89  0601          		LD	B,1
  CF8B  3EF4          		LD	A,0F4H
  CF8D  C32DEE        		JP	AT_WTTRK1+AT_R
                      	
  CF90                	AT_SCRN:
  CF90  ED78          		IN	A,(C)
  CF92  C9            		RET
  CF93                	AT_SCRE:
                      	
  CF93                	AT_DWT:
  CF93  3EA0          		LD	A,0A0H
  CF95                	AT_WTTRK1:
  CF95  32C8ED        		LD	(FDCPAT+1),A
  CF98                	DWTBL:
  CF98  78            		LD	A,B
  CF99  3270EE        		LD	(AT_WTB+1+AT_R),A
  CF9C  3E02          		LD	A,2		;Retry count
  CF9E  322AEE        		LD	(RETRY),A
                      	
  CFA1                	DWT0:
  CFA1  D5            		PUSH	DE
  CFA2  E5            		PUSH	HL
  CFA3  CD67ED        		CALL	SEEK		;Write disk
  CFA6  E1            		POP	HL
  CFA7  DA4DDF        		JP	C,ERRDW+AT_RS
  CFAA  F3            		DI
  CFAB  3AC8ED        		LD	A,(FDCPAT+1)
  CFAE  CD0CEE        		CALL	SECSET
  CFB1  0EFB          		LD	C,0FBH
                      	
  CFB3                	DWT1:
  CFB3  56            		LD	D,(HL)
  CFB4                	DWT2:
  CFB4  78            		LD	A,B
  CFB5  DBF8          		IN	A,(0F8H)
  CFB7  0F            		RRCA
  CFB8  3008          		JR	NC,DWT4
  CFBA  0F            		RRCA
  CFBB  30F7          		JR	NC,DWT2
  CFBD                	DWT3:
  CFBD  ED51          		OUT	(C),D
  CFBF  23            		INC	HL
  CFC0  18F1          		JR	DWT1
                      	
  CFC2                	DWT4:
  CFC2  3D            		DEC	A
  CFC3  28F8          		JR	Z,DWT3
  CFC5  3C            		INC	A
  CFC6  FB            		EI
  CFC7  D1            		POP	DE
  CFC8  13            		INC	DE
  CFC9  CD00EE        		CALL	FDMOFF
  CFCC  2809          		JR	Z,DISKOK_WT
  CFCE  CD29DF        		CALL	DISKC+AT_RS
  CFD1  20CE          		JR	NZ,DWT0
  CFD3  B7            		OR	A
  CFD4  C246DF        		JP	NZ,ERRW+AT_RS
                      	
  CFD7                	DISKOK_WT:
  CFD7  0601          	AT_WTB:	LD	B,1
  CFD9  10BD          		DJNZ	DWTBL
  CFDB  C9            		RET
                      	
  CFDC                	AT_DRD:
  CFDC  3E80          		LD	A,080H
  CFDE  32C8ED        		LD	(FDCPAT+1),A
  CFE1                	DRDBL:
  CFE1  78            		LD	A,B
  CFE2  32B5EE        		LD	(AT_RDB+1+AT_R),A
  CFE5  3E02          		LD	A,2		;Retry count
  CFE7  322AEE        		LD	(RETRY),A
  CFEA                	DRD0:
  CFEA  D5            		PUSH	DE
  CFEB  E5            		PUSH	HL
  CFEC  CD67ED        		CALL	SEEK		;Read disk
  CFEF  E1            		POP	HL
  CFF0  DA58DF        		JP	C,ERRDR+AT_RS
  CFF3  F3            		DI
  CFF4  3AC8ED        		LD	A,(FDCPAT+1)
  CFF7  CD0CEE        		CALL	SECSET
  CFFA  0EFB          		LD	C,0FBH
  CFFC                	DRD1:
  CFFC  78            		LD	A,B
  CFFD  DBF8          		IN	A,(0F8H)
  CFFF  0F            		RRCA
  D000  3008          		JR	NC,DRD3
  D002  0F            		RRCA
  D003  30F7          		JR	NC,DRD1
  D005  EDA2          		INI
  D007  04            		INC	B
  D008  18F2          		JR	DRD1
                      	
  D00A                	DRD3:
  D00A  B7            		OR	A
  D00B  FB            		EI
  D00C  D1            		POP	DE
  D00D  13            		INC	DE
  D00E  CD00EE        		CALL	FDMOFF
  D011  2809          		JR	Z,DISKOK_RD
  D013  CD29DF        		CALL	DISKC+AT_RS
  D016  20D2          		JR	NZ,DRD0
  D018  B7            		OR	A
  D019  C246DF        		JP	NZ,ERRW+AT_RS
                      	
  D01C                	DISKOK_RD:
  D01C  0601          	AT_RDB:	LD	B,1
  D01E  10C1          		DJNZ	DRDBL
  D020  C9            		RET
                      	
  D021                	AT_CPUE:
                      	
                      	
                      	;	EMM DRIVER(CPU)
                      	
                      	
  D021                	AT_EDWT:
  D021  CD91D7        		CALL	AT_EADR+AT_RE
  D024                	AT_EDWT0:
  D024  F5            		PUSH	AF
  D025  AF            		XOR	A
  D026                	AT_EDWT1:
  D026  04            		INC	B
  D027  EDA3          		OUTI
  D029  04            		INC	B
  D02A  EDA3          		OUTI
  D02C  3D            		DEC	A
  D02D  20F7          		JR	NZ,AT_EDWT1
  D02F  13            		INC	DE
  D030  F1            		POP	AF
  D031  3D            		DEC	A
  D032  20F0          		JR	NZ,AT_EDWT0
  D034  C9            		RET
                      	
  D035                	AT_EDRD:
  D035  CD91D7        		CALL	AT_EADR+AT_RE
  D038                	AT_EDRD0:
  D038  F5            		PUSH	AF
  D039  AF            		XOR	A
  D03A                	AT_EDRD1:
  D03A  EDA2          		INI
  D03C  04            		INC	B
  D03D  EDA2          		INI
  D03F  04            		INC	B
  D040  3D            		DEC	A
  D041  20F7          		JR	NZ,AT_EDRD1
  D043  13            		INC	DE
  D044  F1            		POP	AF
  D045  3D            		DEC	A
  D046  20F0          		JR	NZ,AT_EDRD0
  D048  C9            		RET
                      	
  D049                	AT_EADR:
  D049  C5            		PUSH	BC
  D04A  D5            		PUSH	DE
  D04B  EB            		EX	DE,HL
  D04C  29            		ADD	HL,HL
  D04D  DD4E0D        		LD	C,(IX+00DH)	;DPB_0D_MAXSEC
  D050  DD460C        		LD	B,(IX+00CH)	;DPB_0C_MAXCYL
  D053  09            		ADD	HL,BC
  D054  DD4E13        		LD	C,(IX+013H)	;DPB_13_UNITNO
  D057  060D          		LD	B,00DH
  D059  ED49          		OUT	(C),C
  D05B  0C            		INC	C
  D05C  ED69          		OUT	(C),L
  D05E  0C            		INC	C
  D05F  ED61          		OUT	(C),H
  D061  0C            		INC	C
  D062  EB            		EX	DE,HL
  D063  D1            		POP	DE
  D064  F1            		POP	AF
  D065  A7            		AND	A	;CF=0
  D066  C9            		RET
  D067                	AT_EMME:
                      	
  D067                	AT_TRAP38:
  D067  210000        		LD	HL,0
  D06A  E3            		EX	(SP),HL
  D06B  3E24          		LD	A,'$'
  D06D  CD3BDB        		CALL	MSG_A
  D070  2B            		DEC	HL
  D071  7C            		LD	A,H
  D072  CDE8FF        		CALL	PRHX+AT_RT
  D075  7D            		LD	A,L
  D076                	PRHX:
  D076  F5            		PUSH	AF
  D077  07            		RLCA
  D078  07            		RLCA
  D079  07            		RLCA
  D07A  07            		RLCA
  D07B  CDF1FF        		CALL	PRHX2+AT_RT
  D07E  F1            		POP	AF
  D07F                	PRHX2:
  D07F  E60F          		AND	00FH
  D081  FE0A          		CP	10
  D083  3F            		CCF
  D084  CE30          		ADC	A,'0'
  D086  27            		DAA
  D087  C33BDB        		JP	MSG_A
  D08A                		DS	4
  D08E                	AT_TRAPE:
                      	
  2F72                	AT_RT	EQU	TRAP38-AT_TRAP38
                      	
  D08E                	INITE:
  D08E                		DS	BDOS-INITE
                      	
  D106  C3B4D7        		JP	BDOS0
                      	
                      	;X1CCP.ASM
                      	
                      	;	LSX-Dodgers CCP
                      	;	X1/turbo/Z
                      	
  D109                	WBOOT1:
  D109  F3            		DI
  D10A  ED7B0600      		LD	SP,(SYSTEM+1)
                      	
  D10E  3EEF          		LD	A,INTVEC/256
  D110  ED47          		LD	I,A
                      	
  D112  3EE4          		LD	A,0E4H
  D114  CD5EDE        		CALL	COMOUT
  D117  3EC8          		LD	A,INTVEC
  D119  CD38DE        		CALL	OT49SB
                      	
  D11C  21B0EF        		LD	HL,CRTCD
  D11F  AF            		XOR	A
  D120                	SETCRT2:
  D120  010018        		LD	BC,01800H
  D123  ED79          		OUT	(C),A
  D125  0C            		INC	C
  D126  56            		LD	D,(HL)
  D127  FE0D          		CP	13
  D129  3802          		JR	C,SETCRT3
  D12B  1600          		LD	D,0
  D12D                	SETCRT3:
  D12D  ED51          		OUT	(C),D
  D12F  23            		INC	HL
  D130  3C            		INC	A
  D131  FE0E          		CP	14
  D133  20EB          		JR	NZ,SETCRT2
                      	
  D135  01031B        		LD	BC,01A03H+00100H
  D138  EDA3          		OUTI
  D13A  01D020        		LD	BC,01FD0H+00100H
  D13D  EDA3          		OUTI
  D13F  2192EF        		LD	HL,_KEYD
  D142  7E            		LD	A,(HL)
  D143  3600          		LD	(HL),0
  D145  CD28DB        		CALL	KEYBC_IFBREAK
  D148  3E04          		LD	A,4
  D14A  CD3BDB        		CALL	MSG_A
                      	
                      	;LDCCP.ASM
                      	
                      	;	LSX-Dodgers CCP
                      	
  D14D                	COMMAND:
  D14D  CD00D2        		CALL	SETDTA1
  D150  3A87EF        		LD	A,(_DVSW)
  D153  C641          		ADD	A,'A'
  D155  CD3BDB        		CALL	MSG_A
  D158  3E3E          		LD	A,'>'
  D15A  CD3BDB        		CALL	MSG_A
  D15D  3E50          		LD	A,80
  D15F  12            		LD	(DE),A
  D160  CD8ADB        		CALL	_SYS0A		;(BDOS)文字列入力
  D163  CDAAD3        		CALL	LTNL
                      	
  D166  118200        		LD	DE,DTA1+2
  D169  CDFDEF        		CALL	_COMANL
  D16C  30DF          		JR	NC,COMMAND
  D16E  1179EF        		LD	DE,COMERM
  D171  CDE6D7        		CALL	_SYS09		;(BDOS)文字列出力
  D174  C7            		RST	0
                      	
  D175                	COMANL:
  D175  CD0AE0        		CALL	FILE
  D178  3A19EF        		LD	A,(FNAME+4)
  D17B  FE20          		CP	020H
  D17D  201C          		JR	NZ,COMB2
  D17F  D5            		PUSH	DE
  D180  1115EF        		LD	DE,FNAME
  D183  1A            		LD	A,(DE)
  D184  FE20          		CP	020H
  D186  2844          		JR	Z,SDVSW
  D188  1B            		DEC	DE
  D189  1A            		LD	A,(DE)
  D18A  C6FF          		ADD	A,0FFH
  D18C  3809          		JR	C,COMB
  D18E  13            		INC	DE
                      	
  D18F  218BD6        		LD	HL,COMTB
  D192  0609          		LD	B,COMS
  D194  CD8EE2        		CALL	CPNAME
  D197                	COMB:
  D197  D1            		POP	DE
  D198  D20F00        		JP	NC,JP_HL
  D19B                	COMB2:
  D19B  EB            		EX	DE,HL
  D19C  2274D2        		LD	(COMPAT+1),HL
  D19F  F5            		PUSH	AF
  D1A0  CD20D2        		CALL	CEXE4
  D1A3  F1            		POP	AF
  D1A4  2115EF        		LD	HL,FNAME
  D1A7  116D00        		LD	DE,FCB2+1	;COMMAND NAME
  D1AA  010B00        		LD	BC,11
  D1AD  EDB0          		LDIR
  D1AF  112ED6        		LD	DE,PATHD
  D1B2                	CEX1:
  D1B2  1A            		LD	A,(DE)
  D1B3  FE20          		CP	020H
  D1B5  D8            		RET	C
  D1B6  CDFFDF        		CALL	FILEC
  D1B9  D5            		PUSH	DE
  D1BA  216D00        		LD	HL,FCB2+1	;COMMAND NAME
  D1BD  1115EF        		LD	DE,FNAME
  D1C0  010B00        		LD	BC,11
  D1C3  EDB0          		LDIR
  D1C5  CD20D2        		CALL	CEXE4
  D1C8  D1            		POP	DE
  D1C9  13            		INC	DE
  D1CA  18E6          		JR	CEX1
                      	
  D1CC                	SDVSW:
  D1CC  F1            		POP	AF
  D1CD  3A14EF        		LD	A,(FDRV)
  D1D0  3D            		DEC	A
  D1D1  5F            		LD	E,A
  D1D2  0E0E          		LD	C,00EH		;(BDOS)カレントドライブの設定
  D1D4  1831          		JR	SYSTEM0
                      	
  D1D6                	OPEN1:
  D1D6  2114EF        		LD	HL,FDRV
  D1D9                	OPEN:
  D1D9  0E11          		LD	C,011H		;(BDOS)ファイルの検索
  D1DB                	OPEN3:
  D1DB  D5            		PUSH	DE
  D1DC  1109D6        		LD	DE,DTA_CCP
  D1DF  CDFDD1        		CALL	SETDTA
  D1E2  EB            		EX	DE,HL
  D1E3  CD07D2        		CALL	SYSTEM0
  D1E6  D1            		POP	DE
  D1E7  C9            		RET
                      	
  D1E8                	OPEN2:
  D1E8  0E12          		LD	C,012H
  D1EA  18EF          		JR	OPEN3
                      	
  D1EC                	DEFCB:				;Z=Ok NZ=Error
  D1EC  1109D6        		LD	DE,DTA_CCP
  D1EF  CD05D2        		CALL	SYSC0F
                      	
  D1F2  112AD6        		LD	DE,DTA_CCP+33	;(FCB)ランダムレコード
  D1F5  0604          		LD	B,4
  D1F7  CDE8D4        		CALL	ZERO_MEMORY_DE
  D1FA  110001        		LD	DE,00100H
  D1FD                	SETDTA:
  D1FD  C3C0D9        		JP	_SYS1A		;(BDOS)DTAの設定
                      	
  D200                	SETDTA1:
  D200  118000        		LD	DE,DTA1
  D203  18F8          		JR	SETDTA
                      	
  D205                	SYSC0F:
  D205  0E0F          		LD	C,00FH		;(BDOS)ファイルのオープン
  D207                	SYSTEM0:
  D207  CD0500        		CALL	SYSTEM
  D20A  B7            		OR	A
  D20B  C9            		RET
                      	
  D20C                	C_CD:
  D20C  0E5A          		LD	C,5AH
  D20E  18F7          		JR	SYSTEM0
                      	
  D210                	S27BUF:
  D210  3A0700        		LD	A,(SYSTEM+2)
  D213  3D            		DEC	A
  D214  E6F8          		AND	0F8H
  D216  67            		LD	H,A
  D217  2E00          		LD	L,0
  D219                	S27DTA:
  D219  1109D6        		LD	DE,DTA_CCP
  D21C                	S27:
  D21C  0E27          		LD	C,027H		;(BDOS)ランダムブロック読み込み
  D21E  18E7          		JR	SYSTEM0
                      	
  D220                	CEXE4:
  D220  3A14EF        		LD	A,(FDRV)
  D223  325700        		LD	(00057H),A
  D226  2A22EF        		LD	HL,(FDRV+14)
  D229  225800        		LD	(00058H),HL
                      	
  D22C  211DEF        		LD	HL,FNAME+8
  D22F  7E            		LD	A,(HL)
  D230  FE20          		CP	020H
  D232  2007          		JR	NZ,CEXE7
  D234  3E3F          		LD	A,'?'
  D236  77            		LD	(HL),A
  D237  23            		INC	HL
  D238  77            		LD	(HL),A
  D239  23            		INC	HL
  D23A  77            		LD	(HL),A
  D23B                	CEXE7:
  D23B  CDD6D1        		CALL	OPEN1
  D23E                	CEXE5:
  D23E  C0            		RET	NZ
  D23F  2A13D6        		LD	HL,(DTA_CCP+1+9)
  D242  7C            		LD	A,H
  D243  CD16E3        		CALL	CAP
  D246  67            		LD	H,A
  D247  7D            		LD	A,L
  D248  CD16E3        		CALL	CAP
  D24B  6F            		LD	L,A
  D24C  3A12D6        		LD	A,(DTA_CCP+1+8)
  D24F  CD16E3        		CALL	CAP
  D252  D642          		SUB	'B'
  D254  282C          		JR	Z,C_BAT
  D256  3D            		DEC	A		;'C'
  D257  2805          		JR	Z,C_EXE
  D259                	CEXE6:
  D259  CDE8D1        		CALL	OPEN2
  D25C  18E0          		JR	CEXE5
                      	
  D25E                	C_EXE:
  D25E  7C            		LD	A,H
  D25F  FE4D          		CP	'M'
  D261  20F6          		JR	NZ,CEXE6
                      	
  D263  CDECD1        		CALL	DEFCB
  D266  CD10D2        		CALL	S27BUF
  D269  3D            		DEC	A
  D26A  37            		SCF
  D26B  C0            		RET	NZ
  D26C  7C            		LD	A,H
  D26D  B5            		OR	L
  D26E  37            		SCF
  D26F  C8            		RET	Z
  D270  CD00D2        		CALL	SETDTA1
  D273  110000        	COMPAT:	LD	DE,0				; self-modifying code
  D276  ED7B0600      		LD	SP,(SYSTEM+1)
  D27A  67            		LD	H,A				; A=0 in SETDTA1(_SYS1A)
  D27B  6F            		LD	L,A
  D27C  E5            		PUSH	HL				; push $0000 (reboot address)
  D27D  24            		INC	H
  D27E  E5            		PUSH	HL				; push $0100 (TPA address)
  D27F  C3B3D4        		JP	SETFCB				; and JP $0100
                      	
  D282                	C_BAT:
  D282  114154        		LD	DE,'A'+'T'*256
  D285  ED52          		SBC	HL,DE
  D287  20D0          		JR	NZ,CEXE6
                      	
  D289  F1            		POP	AF
  D28A  F1            		POP	AF
  D28B  CDECD1        		CALL	DEFCB
  D28E  210002        		LD	HL,00200H
  D291  CD19D2        		CALL	S27DTA
  D294  C6FE          		ADD	A,0FEH
  D296  D8            		RET	C
  D297  7D            		LD	A,L
  D298  B7            		OR	A
  D299  37            		SCF
  D29A  C8            		RET	Z
  D29B  3C            		INC	A
  D29C  F5            		PUSH	AF
                      	
  D29D  CD2BDB        		CALL	KEYBC
  D2A0  3E06          		LD	A,6
  D2A2  CD3BDB        		CALL	MSG_A
  D2A5  C1            		POP	BC
  D2A6  210001        		LD	HL,00100H
  D2A9                	BAT1:
  D2A9  A7            		AND	A
  D2AA  05            		DEC	B
  D2AB  C8            		RET	Z
  D2AC  7E            		LD	A,(HL)
  D2AD  FE25          		CP	'%'
  D2AF  280C          		JR	Z,BAT2
  D2B1                	BAT1X:
  D2B1  7E            		LD	A,(HL)
  D2B2  23            		INC	HL
  D2B3  FE1A          		CP	01AH
  D2B5  C8            		RET	Z
  D2B6  FE0A          		CP	00AH
  D2B8  C410DB        		CALL	NZ,KEYBS
  D2BB  18EC          		JR	BAT1
                      	
  D2BD                	BAT2:
  D2BD  23            		INC	HL
  D2BE  7E            		LD	A,(HL)
  D2BF  2B            		DEC	HL
  D2C0  D631          		SUB	'1'
  D2C2  38ED          		JR	C,BAT1X
  D2C4  FE09          		CP	9
  D2C6  30E9          		JR	NC,BAT1X
  D2C8  23            		INC	HL
  D2C9  23            		INC	HL
  D2CA  3C            		INC	A
  D2CB  4F            		LD	C,A
  D2CC  ED5B74D2      		LD	DE,(COMPAT+1)
  D2D0                	BAT3:
  D2D0  1A            		LD	A,(DE)
  D2D1  B7            		OR	A
  D2D2  28D5          		JR	Z,BAT1
  D2D4  CDE1E0        		CALL	SPCUT
  D2D7  0D            		DEC	C
  D2D8  2808          		JR	Z,BAT5
  D2DA                	BAT4:
  D2DA  1A            		LD	A,(DE)
  D2DB  FE21          		CP	021H
  D2DD  38F1          		JR	C,BAT3
  D2DF  13            		INC	DE
  D2E0  18F8          		JR	BAT4
  D2E2                	BAT5:
  D2E2  1A            		LD	A,(DE)
  D2E3  FE21          		CP	021H
  D2E5  38C2          		JR	C,BAT1
  D2E7  13            		INC	DE
  D2E8  CD10DB        		CALL	KEYBS
  D2EB  18F5          		JR	BAT5
                      	
  D2ED                	C_DEL:
  D2ED  CDB3D4        		CALL	SETFCB
  D2F0  CD51DB        		CALL	_SYS08		;(BDOS)エコーなしコンソール入力
                      	
  D2F3  0E13          		LD	C,013H
  D2F5  180A          		JR	CDEL1		;(BDOS)ファイルの削除
                      	
  D2F7                	C_REN:
  D2F7  CDB3D4        		CALL	SETFCB
  D2FA  3E10          		LD	A,010H		;ディレクトリも対象にする
  D2FC  326900        		LD	(FCB1+13),A	;属性
  D2FF  0E17          		LD	C,017H		;(BDOS)ファイル名の変更
  D301                	CDEL1:
  D301  115C00        		LD	DE,FCB1
  D304  CD0500        		CALL	SYSTEM
  D307  C6FF          		ADD	A,0FFH
  D309  C9            		RET
                      	
  D30A                	C_DIR:
  D30A  CDFFDF        		CALL	FILEC
  D30D  2115EF        		LD	HL,FDRV+1
  D310  CDFED5        		CALL	CWILD1
  D313  3EF1          		LD	A,0F1H
  D315  3221EF        		LD	(FDRV+13),A
  D318  CDD6D1        		CALL	OPEN1
  D31B                	CDIR1:
  D31B  B7            		OR	A
  D31C  2008          		JR	NZ,PDSKF
  D31E  CD69D3        		CALL	P_NAME
  D321  CDE8D1        		CALL	OPEN2
  D324  18F5          		JR	CDIR1
                      	
  D326                	PDSKF:
  D326  3A14EF        		LD	A,(FDRV)
  D329  5F            		LD	E,A
  D32A  0E1B          		LD	C,01BH		;(BDOS)ディスク情報の獲得
  D32C  CD0500        		CALL	SYSTEM
  D32F  4F            		LD	C,A		;C←1クラスタ辺りの論理セクタ数
  D330  C601          		ADD	A,001H
  D332  D8            		RET	C		;Aが0FFHだった場合
  D333  3E06          		LD	A,8-2
  D335                	PDS1:				;HL=未使用クラスタの総数
  D335  3C            		INC	A
  D336  CB19          		RR	C
  D338  30FB          		JR	NC,PDS1
  D33A                	PDS2:				;B←論理セクタのサイズの上位8ビット
  D33A  3C            		INC	A
  D33B  CB18          		RR	B
  D33D  30FB          		JR	NC,PDS2
  D33F  47            		LD	B,A
                      	
  D340  110000        		LD	DE,0
  D343                	PDS3:
  D343  29            		ADD	HL,HL
  D344  EB            		EX	DE,HL
  D345  ED6A          		ADC	HL,HL
  D347  EB            		EX	DE,HL
  D348  10F9          		DJNZ	PDS3
  D34A                	PDSKF1:
  D34A  CDE2D3        		CALL	PRDEC_DEHL
  D34D  116FD6        		LD	DE,FREE
  D350  CDE6D7        		CALL	_SYS09		;(BDOS)文字列出力
  D353  CDD1D3        		CALL	PUTDRV
  D356  3E5C          		LD	A,05CH		;\
  D358  CD3BDB        		CALL	MSG_A
  D35B  2A22EF        		LD	HL,(FDRV+14)	;ディレクトリのクラスタ番号
  D35E  AF            		XOR	A
  D35F  11FEFF        		LD	DE,0-2
  D362  19            		ADD	HL,DE
  D363  23            		INC	HL
  D364  DCDED3        		CALL	C,PRDEC_HL
  D367  1841          		JR	LTNL
                      	
  D369                	P_NAME:
  D369  3A0AD6        		LD	A,(DTA_CCP+1)
  D36C  FE2E          		CP	'.'
  D36E  C8            		RET	Z
  D36F  1187D6        		LD	DE,DIRHD
  D372  CDE6D7        		CALL	_SYS09		;(BDOS)文字列出力
  D375  3A15D6        		LD	A,(DTA_CCP+1+00BH)
  D378  F5            		PUSH	AF
  D379  0F            		RRCA
  D37A  9F            		SBC	A,A
  D37B  E60A          		AND	'*'-020H
  D37D  C620          		ADD	A,020H
  D37F  CD3BDB        		CALL	MSG_A
  D382  CDD1D3        		CALL	PUTDRV
  D385  210AD6        		LD	HL,DTA_CCP+1
  D388  CD22D4        		CALL	FPRNT
                      	
  D38B  F1            		POP	AF
  D38C  CB67          		BIT	4,A
  D38E  2808          		JR	Z,DIR3
  D390  117CD6        		LD	DE,DIRMES
  D393  CDE6D7        		CALL	_SYS09		;(BDOS)文字列出力
  D396  180A          		JR	DIR6
  D398                	DIR3:
  D398  ED5B28D6      		LD	DE,(DTA_CCP+1+01EH)
  D39C  2A26D6        		LD	HL,(DTA_CCP+1+01CH)
  D39F  CDE2D3        		CALL	PRDEC_DEHL
  D3A2                	DIR6:
  D3A2  3AB1EF        		LD	A,(_WIDTH)
  D3A5  FE29          		CP	40+1
  D3A7  D444D4        		CALL	NC,PRTTMS
                      	
  D3AA                	LTNL:
  D3AA  1E03          		LD	E,3
  D3AC  C3CDEF        		JP	_PRINT
                      	
  D3AF                	C_PATH:
  D3AF  CDE1E0        		CALL	SPCUT
  D3B2  212ED6        		LD	HL,PATHD
  D3B5  FE21          		CP	021H
  D3B7  300C          		JR	NC,CPATH0
  D3B9                	CPATHP:
  D3B9  7E            		LD	A,(HL)
  D3BA  23            		INC	HL
  D3BB  FE20          		CP	020H
  D3BD  3F            		CCF
  D3BE  30EA          		JR	NC,LTNL
  D3C0  CD3BDB        		CALL	MSG_A
  D3C3  18F4          		JR	CPATHP
  D3C5                	CPATH0:
  D3C5  FE3B          		CP	';'
  D3C7  2001          		JR	NZ,CPATH1
  D3C9  13            		INC	DE
  D3CA                	CPATH1:
  D3CA  EB            		EX	DE,HL
  D3CB  014000        		LD	BC,PATHX
  D3CE  EDB0          		LDIR
  D3D0  C9            		RET
                      	
  D3D1                	PUTDRV:
  D3D1  3A14EF        		LD	A,(FDRV)
  D3D4  C640          		ADD	A,'A'-1
  D3D6  CD3BDB        		CALL	MSG_A
  D3D9  3E3A          		LD	A,':'
  D3DB                	MSG_AR:
  D3DB  C33BDB        		JP	MSG_A
                      	
  D3DE                	PRDEC_HL:
  D3DE  AF            		XOR	A
  D3DF                	PRDEC_AHL:
  D3DF  5F            		LD	E,A
  D3E0  1600          		LD	D,0
  D3E2                	PRDEC_DEHL:
  D3E2  D5            		PUSH	DE
  D3E3  110FEF        		LD	DE,DECBF
  D3E6  0605          		LD	B,5
  D3E8  CDE8D4        		CALL	ZERO_MEMORY_DE	;A=0
  D3EB  D1            		POP	DE
                      	
  D3EC  0E20          		LD	C,32
  D3EE                	DEC1:
  D3EE  29            		ADD	HL,HL
  D3EF  EB            		EX	DE,HL
  D3F0  ED6A          		ADC	HL,HL
  D3F2  EB            		EX	DE,HL
  D3F3  E5            		PUSH	HL
  D3F4  2113EF        		LD	HL,DECBF+4
  D3F7  0605          		LD	B,5
  D3F9                	DEC2:
  D3F9  7E            		LD	A,(HL)
  D3FA  8F            		ADC	A,A
  D3FB  27            		DAA
  D3FC  77            		LD	(HL),A
  D3FD  2B            		DEC	HL
  D3FE  10F9          		DJNZ	DEC2
  D400  E1            		POP	HL
  D401  0D            		DEC	C
  D402  20EA          		JR	NZ,DEC1
                      	
  D404  210FEF        		LD	HL,DECBF
  D407  3E20          		LD	A,020H
  D409  0604          		LD	B,4
  D40B                	DEC3:
  D40B  CD18D4        		CALL	DEC4
  D40E  CD18D4        		CALL	DEC4
  D411  23            		INC	HL
  D412  10F7          		DJNZ	DEC3
  D414                	DECX:
  D414  CD18D4        		CALL	DEC4
  D417  AF            		XOR	A
  D418                	DEC4:
  D418  ED6F          		RLD
  D41A  FE20          		CP	020H
  D41C  2802          		JR	Z,DEC5
  D41E  F630          		OR	030H
  D420                	DEC5:
  D420  18B9          		JR	MSG_AR
                      	
  D422                	FPRNT:
  D422  0608          		LD	B,8
  D424  CD35D4        		CALL	P_N1
  D427  7E            		LD	A,(HL)
  D428  C680          		ADD	A,0A0H-020H
  D42A  FEA0          		CP	0A0H
  D42C  2802          		JR	Z,FPR1
  D42E  3E2E          		LD	A,'.'
  D430                	FPR1:
  D430  CD3BDB        		CALL	MSG_A
  D433  0603          		LD	B,3
                      	
  D435                	P_N1:
  D435  C5            		PUSH	BC
  D436  E5            		PUSH	HL
  D437  7E            		LD	A,(HL)
  D438  CD22E3        		CALL	CAP3
  D43B  CD3BDB        		CALL	MSG_A
  D43E  E1            		POP	HL
  D43F  C1            		POP	BC
  D440  23            		INC	HL
  D441  10F2          		DJNZ	P_N1
  D443  C9            		RET
                      	
  D444                	PRTTMS:
  D444  3E20          		LD	A,020H
  D446  CD3BDB        		CALL	MSG_A
                      	
  D449  2A22D6        		LD	HL,(DTA_CCP+1+24)
  D44C  7D            		LD	A,L
  D44D  B7            		OR	A
  D44E  C8            		RET	Z
  D44F  CB3C          		SRL	H
  D451  17            		RLA
  D452  17            		RLA
  D453  17            		RLA
  D454  17            		RLA
  D455  E60F          		AND	00FH
  D457  57            		LD	D,A
  D458  7C            		LD	A,H
  D459  C650          		ADD	A,80
  D45B  CD9ED4        		CALL	PRDEC_A
  D45E  3E2D          		LD	A,'-'
  D460  CD3BDB        		CALL	MSG_A
  D463  7A            		LD	A,D
  D464  CD9ED4        		CALL	PRDEC_A
  D467  3E2D          		LD	A,'-'
  D469  CD3BDB        		CALL	MSG_A
  D46C  7D            		LD	A,L
  D46D  E61F          		AND	01FH
  D46F  CD9ED4        		CALL	PRDEC_A
                      	
  D472  2A20D6        		LD	HL,(DTA_CCP+1+22)
                      	
  D475  3E20          		LD	A,020H
  D477  CD3BDB        		CALL	MSG_A
  D47A  7C            		LD	A,H
  D47B  65            		LD	H,L
  D47C  0603          		LD	B,3
  D47E                	PRTTMS1:
  D47E  1F            		RRA
  D47F  CB1D          		RR	L
  D481  10FB          		DJNZ	PRTTMS1
  D483  E61F          		AND	01FH
  D485  CD9ED4        		CALL	PRDEC_A
  D488  3E3A          		LD	A,':'
  D48A  CD3BDB        		CALL	MSG_A
  D48D  7D            		LD	A,L
  D48E  0F            		RRCA
  D48F  0F            		RRCA
  D490  E63F          		AND	03FH
  D492  CD9ED4        		CALL	PRDEC_A
  D495  3E3A          		LD	A,':'
  D497  CD3BDB        		CALL	MSG_A
  D49A  7C            		LD	A,H
  D49B  E61F          		AND	01FH
  D49D  87            		ADD	A,A
                      	
                      	;	PRINT10
                      	
  D49E                	PRDEC_A:
  D49E  E5            		PUSH	HL
  D49F  0608          		LD	B,8
  D4A1  4F            		LD	C,A
  D4A2  AF            		XOR	A
  D4A3                	PRTA1:
  D4A3  CB01          		RLC	C
  D4A5  8F            		ADC	A,A
  D4A6  27            		DAA
  D4A7  10FA          		DJNZ	PRTA1
  D4A9  210FEF        		LD	HL,DECBF
  D4AC  77            		LD	(HL),A
  D4AD  AF            		XOR	A
  D4AE  CD14D4        		CALL	DECX
  D4B1  E1            		POP	HL
  D4B2  C9            		RET
                      	
  D4B3                	SETFCB:
  D4B3  CDE1E0        		CALL	SPCUT
  D4B6  1A            		LD	A,(DE)
  D4B7  FE20          		CP	020H
  D4B9  3801          		JR	C,SETFCBA
  D4BB  1B            		DEC	DE
  D4BC                	SETFCBA:
  D4BC  0624          		LD	B,36
  D4BE  215C00        		LD	HL,FCB1
  D4C1  E5            		PUSH	HL
  D4C2  AF            		XOR	A
  D4C3  CDB6E0        		CALL	FILL_MEMORY
  D4C6  E1            		POP	HL
  D4C7  D5            		PUSH	DE
  D4C8  CD26DA        		CALL	_SYS5C		;(BDOS)ファイル名の解析
  D4CB  216C00        		LD	HL,FCB2
  D4CE  CD26DA        		CALL	_SYS5C		;(BDOS)ファイル名の解析
  D4D1  E1            		POP	HL
  D4D2  010050        		LD	BC,05000H
  D4D5  118100        		LD	DE,00081H
  D4D8                	SETFCB1:
  D4D8  7E            		LD	A,(HL)
  D4D9  23            		INC	HL
  D4DA  FE20          		CP	020H
  D4DC  3805          		JR	C,SETFCB2
  D4DE  12            		LD	(DE),A
  D4DF  13            		INC	DE
  D4E0  0C            		INC	C
  D4E1  10F5          		DJNZ	SETFCB1
  D4E3                	SETFCB2:
  D4E3  79            		LD	A,C
  D4E4  328000        		LD	(DTA1),A
  D4E7  04            		INC	B
  D4E8                	ZERO_MEMORY_DE:
  D4E8  AF            		XOR	A
  D4E9                	FILL_MEMORY_DE:
  D4E9  12            		LD	(DE),A
  D4EA  13            		INC	DE
  D4EB  10FC          		DJNZ	FILL_MEMORY_DE
  D4ED  C9            		RET
                      	
  D4EE                	C_COPY:
  D4EE  CDB3D4        		CALL	SETFCB
                      	
  D4F1  1161EF        		LD	DE,ZERO
  D4F4  CD02E0        		CALL	FILEC2
  D4F7  216C00        		LD	HL,FCB2
  D4FA  CD2DDA        		CALL	S29X1
                      	
  D4FD  3E10          		LD	A,010H
  D4FF  326900        		LD	(FCB1+13),A
  D502  216D00        		LD	HL,FCB2+1
  D505  CDFED5        		CALL	CWILD1
  D508                	COPY0:
  D508  CDFBD5        		CALL	CWILD
  D50B  215C00        		LD	HL,FCB1
  D50E  CDD9D1        		CALL	OPEN
  D511  37            		SCF
  D512                	COPY1:
  D512  C0            		RET	NZ
  D513  CDECD1        		CALL	DEFCB
                      	
  D516  3A16D6        		LD	A,(DTA_CCP+13)
  D519  CB67          		BIT	4,A
  D51B  2821          		JR	Z,COPY1A
                      	
  D51D  215D00        		LD	HL,FCB1+1
  D520  CD45E4        		CALL	CHKWILD
  D523  3814          		JR	C,COPY9
                      	
  D525  3E20          		LD	A,020H
  D527  325D00        		LD	(FCB1+1),A
  D52A  2A23D6        		LD	HL,(DTA_CCP+26)
  D52D  23            		INC	HL
  D52E  226A00        		LD	(FCB1+14),HL
  D531  18D5          		JR	COPY0
                      	
  D533                	COPY8:
  D533  CDE6D7        		CALL	_SYS09		;(BDOS)文字列出力
  D536  CDAAD3        		CALL	LTNL
  D539                	COPY9:
  D539  CDE8D1        		CALL	OPEN2
  D53C  18D4          		JR	COPY1
                      	
  D53E                	COPY1A:
  D53E  216C00        		LD	HL,FCB2
  D541  1114EF        		LD	DE,FDRV
  D544  010BD6        		LD	BC,DTA_CCP+2
  D547  EDA0          		LDI
  D549  3E0B          		LD	A,11
  D54B                	COPY2:
  D54B  F5            		PUSH	AF
  D54C  7E            		LD	A,(HL)
  D54D  FE3F          		CP	'?'
  D54F  2001          		JR	NZ,COPY3
  D551  0A            		LD	A,(BC)
  D552                	COPY3:
  D552  12            		LD	(DE),A
  D553  03            		INC	BC
  D554  13            		INC	DE
  D555  23            		INC	HL
  D556  F1            		POP	AF
  D557  3D            		DEC	A
  D558  20F1          		JR	NZ,COPY2
  D55A  010500        		LD	BC,16-11
  D55D  EDB0          		LDIR
  D55F                	PUTNAME:
  D55F  215D00        		LD	HL,FCB1+1
  D562  CD45E4        		CALL	CHKWILD
  D565  300B          		JR	NC,PUTN1
  D567  2115EF        		LD	HL,FDRV+1
  D56A  CD22D4        		CALL	FPRNT
  D56D  3E20          		LD	A,020H
  D56F  CD3BDB        		CALL	MSG_A
  D572                	PUTN1:
  D572  1114EF        		LD	DE,FDRV
  D575  0E16          		LD	C,016H		;(BDOS)ファイルの作成
  D577  CD07D2        		CALL	SYSTEM0
  D57A  2048          		JR	NZ,COPYE2
  D57C  67            		LD	H,A		;A=0
  D57D  6F            		LD	L,A
  D57E  2235EF        		LD	(FDRV+33),HL	;(FCB)ランダムレコード
  D581  2237EF        		LD	(FDRV+35),HL
  D584                	COPY6:
  D584  CD10D2        		CALL	S27BUF
  D587  47            		LD	B,A
  D588  3C            		INC	A
  D589  2831          		JR	Z,COPYE
  D58B  7C            		LD	A,H
  D58C  B5            		OR	L
  D58D  280C          		JR	Z,COPY7
  D58F  1114EF        		LD	DE,FDRV
  D592  0E26          		LD	C,026H		;(BDOS)ランダムブロック書き込み
  D594  CD07D2        		CALL	SYSTEM0
  D597  2023          		JR	NZ,COPYE
  D599  10E9          		DJNZ	COPY6
  D59B                	COPY7:
  D59B  3A16D6        		LD	A,(DTA_CCP+13)	;(FCB)属性
  D59E  3221EF        		LD	(FDRV+13),A
  D5A1  211DD6        		LD	HL,DTA_CCP+20	;(FCB)タイムスタンプ
  D5A4  1128EF        		LD	DE,FDRV+20
  D5A7  010400        		LD	BC,4
  D5AA  EDB0          		LDIR
                      	
  D5AC  1114EF        		LD	DE,FDRV
  D5AF  0E10          		LD	C,010H		;(BDOS)ファイルのクローズ
  D5B1  CD07D2        		CALL	SYSTEM0
  D5B4  2006          		JR	NZ,COPYE
                      	
  D5B6  1171EF        		LD	DE,OK
  D5B9  C333D5        		JP	COPY8
                      	
  D5BC                	COPYE:
  D5BC  1114EF        		LD	DE,FDRV
  D5BF  0E13          		LD	C,013H		;(BDOS)ファイルの削除
  D5C1  CD0500        		CALL	SYSTEM
  D5C4                	COPYE2:
  D5C4  37            		SCF
  D5C5  C9            		RET
                      	
  D5C6                	C_TYPE:
  D5C6  CDB3D4        		CALL	SETFCB
  D5C9  215C00        		LD	HL,FCB1
  D5CC  CDD9D1        		CALL	OPEN
  D5CF  37            		SCF
  D5D0                	TYPE1:
  D5D0  C0            		RET	NZ
  D5D1  CDECD1        		CALL	DEFCB
  D5D4  3E06          		LD	A,6
  D5D6  CD3BDB        		CALL	MSG_A
  D5D9                	TYPE2:
  D5D9  CD10D2        		CALL	S27BUF
  D5DC  C6FE          		ADD	A,0FEH
  D5DE  D8            		RET	C
  D5DF  7C            		LD	A,H
  D5E0  B5            		OR	L
  D5E1  2813          		JR	Z,TYPEE
  D5E3  010001        		LD	BC,00100H
  D5E6                	TYPE3:
  D5E6  0A            		LD	A,(BC)
  D5E7  03            		INC	BC
  D5E8  FE1A          		CP	01AH
  D5EA  280A          		JR	Z,TYPEE
  D5EC  CD3BDB        		CALL	MSG_A
  D5EF  2B            		DEC	HL
  D5F0  7C            		LD	A,H
  D5F1  B5            		OR	L
  D5F2  20F2          		JR	NZ,TYPE3
  D5F4  18E3          		JR	TYPE2
  D5F6                	TYPEE:
  D5F6  CDE8D1        		CALL	OPEN2
  D5F9  18D5          		JR	TYPE1
                      	
  D5FB                	CWILD:
  D5FB  215D00        		LD	HL,FCB1+1
  D5FE                	CWILD1:
  D5FE  7E            		LD	A,(HL)
  D5FF  FE20          		CP	020H
  D601  C0            		RET	NZ
  D602                	CWILD2:
  D602  3E3F          		LD	A,'?'
  D604  060B          		LD	B,11
  D606  C3B6E0        		JP	FILL_MEMORY
                      	
  D609                	DTA_CCP:
  D609                		DS	37
                      	
  0040                	PATHX	EQU	64
  D62E                	PATHD:	DS	PATHX
  D66E  00            	PATHE:	DB	0
                      	
  D66F  20627974657320	FREE:	DB	" bytes free",9,'$'
  D67C  20202020203C44	DIRMES:	DB	"     <DIR>$"
  D687  20203A24      	DIRHD:	DB	"  :$"
                      	
  D68B                	COMTB:
  D68B  44202020      		DB	"D   "	;1
  D68F  0AD3          		DW	C_DIR
  D691  44495220      		DB	"DIR "	;2
  D695  0AD3          		DW	C_DIR
  D697  434F5059      		DB	"COPY"	;3
  D69B  EED4          		DW	C_COPY
  D69D  43442020      		DB	"CD  "	;4
  D6A1  0CD2          		DW	C_CD
  D6A3  44454C20      		DB	"DEL "	;5
  D6A7  EDD2          		DW	C_DEL
  D6A9  50415448      		DB	"PATH"	;6
  D6AD  AFD3          		DW	C_PATH
  D6AF  52454E20      		DB	"REN "	;7
  D6B3  F7D2          		DW	C_REN
  D6B5  54595045      		DB	"TYPE"	;8
  D6B9  C6D5          		DW	C_TYPE
  D6BB  52454D20      		DB	"REM "	;9
  D6BF  E3D7          		DW	C_REM
                      	
                      	;X1DISK2.ASM
                      	
                      	;	LSX-Dodgers DISK2
                      	;	X1/turbo/Z
                      	
                      	;	GRAPHIC RAM DISK DRIVER
                      	
                      	
  D6C1                	GDRD:
  D6C1  C5            		PUSH	BC
  D6C2  CDEAD6        		CALL	GADR
  D6C5  F1            		POP	AF
  D6C6                	GDRD1:
  D6C6  EDA2          		INI
  D6C8  04            		INC	B
  D6C9  0C            		INC	C
  D6CA  20FA          		JR	NZ,GDRD1
  D6CC  04            		INC	B
  D6CD  13            		INC	DE
  D6CE  3D            		DEC	A
  D6CF  20F5          		JR	NZ,GDRD1
  D6D1                	GBANK0:
  D6D1  3ABFEF        		LD	A,(WK1FD0)
  D6D4  E6EF          		AND	0EFH		;BANK0
  D6D6  181D          		JR	S1FD0
                      	
  D6D8                	GDWT:
  D6D8  C5            		PUSH	BC
  D6D9  CDEAD6        		CALL	GADR
  D6DC  F1            		POP	AF
  D6DD                	GDWT1:
  D6DD  04            		INC	B
  D6DE  EDA3          		OUTI
  D6E0  0C            		INC	C
  D6E1  20FA          		JR	NZ,GDWT1
  D6E3  04            		INC	B
  D6E4  13            		INC	DE
  D6E5  3D            		DEC	A
  D6E6  20F5          		JR	NZ,GDWT1
  D6E8  18E7          		JR	GBANK0
                      	
  D6EA                	GADR:
  D6EA  0E00          		LD	C,0
  D6EC  7B            		LD	A,E
  D6ED  C640          		ADD	A,040H
  D6EF  47            		LD	B,A
  D6F0  3ABFEF        		LD	A,(WK1FD0)
  D6F3  F610          		OR	010H		;BANK1
  D6F5                	S1FD0:
  D6F5  C5            		PUSH	BC
  D6F6  32BFEF        		LD	(WK1FD0),A
  D6F9  01D01F        		LD	BC,01FD0H
  D6FC  ED79          		OUT	(C),A
  D6FE  C1            		POP	BC
  D6FF  C9            		RET
                      	
                      	
                      	;	BANK RAM DISK DRIVER
                      	
  D700                	BDWT:
  D700  3E            		DB	03EH	;LD A,??
  D701  37            		SCF
  D702  1802          		JR	BRW
                      	
  D704                	BDRD:
  D704  3E            		DB	03EH	;LD A,??
  D705  A7            		AND	A
  D706                	BRW:
  D706  F3            		DI
  D707  322FD7        		LD	(BRWPAT),A
  D70A  ED734FD7      		LD	(BANKSP+1),SP
  D70E  3A50D7        		LD	A,(BANKSP+2)
  D711  87            		ADD	A,A
  D712  3803          		JR	C,BRW0
  D714  31CAFF        		LD	SP,EXTSP
  D717                	BRW0:
  D717  D9            		EXX		;裏レジスタ
  D718  C5            		 PUSH	 BC
  D719  D5            		 PUSH	 DE
  D71A  01000B        		 LD	 BC,00B00H	 ;バンクメモリ
  D71D  111010        		 LD	 DE,01010H
  D720  D9            		 EXX		;表レジスタ
  D721                	BRW1:
  D721  C5            		PUSH	BC
  D722  D5            		PUSH	DE
  D723  EB            		EX	DE,HL
  D724  29            		ADD	HL,HL
  D725  29            		ADD	HL,HL
  D726  7C            		LD	A,H
  D727  E60F          		AND	00FH	;バンク
  D729  65            		LD	H,L
  D72A  CB3C          		SRL	H	;/2
  D72C  2E00          		LD	L,0
  D72E  D9            		EXX		;裏レジスタ
  D72F  A7            	BRWPAT:	 AND	 A	;自己書き換え(AND A:読み出し/SCF:書き込み)
  D730  3808          		 JR	 C,BRWT
  D732  57            		 LD	 D,A	 ;D=バンク
  D733  D9            		 EXX		;表レジスタ
  D734  EB            		EX	DE,HL
  D735  CD53D7        		CALL	BTFR
  D738  1806          		JR	BRW2
  D73A                	BRWT:
  D73A  5F            		 LD	E,A	 ;E=バンク
  D73B  D9            		 EXX		;表レジスタ
  D73C  CD53D7        		CALL	BTFR
  D73F  EB            		EX	DE,HL
  D740                	BRW2:
  D740  D1            		POP	DE
  D741  C1            		POP	BC
  D742  13            		INC	DE
  D743  10DC          		DJNZ	BRW1
                      	
  D745  D9            		EXX		;裏レジスタ
  D746  3E10          		 LD	 A,10H
  D748  ED79          		 OUT	 (C),A		;メインメモリに切り替える
  D74A  D1            		 POP	 DE
  D74B  C1            		 POP	 BC
  D74C  D9            		 EXX		;表レジスタ
  D74D  AF            		XOR	A
  D74E  310000        	BANKSP:	LD	SP,0
  D751  FB            		EI
  D752  C9            		RET
                      	
                      	;メインメモリ←→バンクメモリ 512バイトの転送を行う
                      	; DE:転送元アドレス
                      	; HL:転送先アドレス
                      	; 裏BC:バンク切り替えポート(0B00H)
                      	; 裏D:転送元バンク(0-0FH:10Hはメインメモリ)
                      	; 裏E:転送先バンク(0-0FH:10Hはメインメモリ)
                      	
  D753                	BTFR:
  D753  0600          		LD	B,0	;256回ループ(256*2)
  D755                	BTFR1:
  D755  D9            		EXX		;裏レジスタ
  D756  ED51          		 OUT	 (C),D	 ;BANK(MAIN)
  D758  D9            		 EXX		;表レジスタ
  D759  1A            		LD	A,(DE)
  D75A  4F            		LD	C,A
  D75B  13            		INC	DE
  D75C  1A            		LD	A,(DE)
  D75D  13            		INC	DE
  D75E  D9            		EXX		;裏レジスタ
  D75F  ED59          		 OUT	 (C),E	 ;MAIN(BANK)
  D761  D9            		 EXX		;表レジスタ
  D762  71            		LD	(HL),C
  D763  23            		INC	HL
  D764  77            		LD	(HL),A
  D765  23            		INC	HL
  D766  10ED          		DJNZ	BTFR1
  D768  C9            		RET
                      	
                      	;	EMM DRIVER(DMA)
                      	
                      	
  D769                	EDWT:
  D769  0E0F          		LD	C,15
  D76B  1802          		JR	EDWT1
  D76D                	EDRD:
  D76D  0E0E          		LD	C,14
  D76F                	EDWT1:
  D76F  C5            		PUSH	BC
  D770  D5            		PUSH	DE
  D771  22B1D7        		LD	(DMAB),HL
  D774  78            		LD	A,B
  D775  87            		ADD	A,A
  D776  3D            		DEC	A
  D777  32AAD7        		LD	(DMALEN+1),A
  D77A  3C            		INC	A
  D77B  84            		ADD	A,H	;HL(アドレス)を先に進めておく
  D77C  67            		LD	H,A
  D77D  EB            		EX	DE,HL
  D77E  29            		ADD	HL,HL
  D77F  DD460C        		LD	B,(IX+00CH)	;DPB_0C_MAXCYL
  D782  79            		LD	A,C
  D783  DD4E0D        		LD	C,(IX+00DH)	;DPB_0D_MAXSEC
  D786  09            		ADD	HL,BC
  D787  DD4E13        		LD	C,(IX+013H)	;DPB_13_UNITNO
  D78A  060D          		LD	B,00DH
  D78C  ED49          		OUT	(C),C
  D78E  0C            		INC	C
  D78F  ED69          		OUT	(C),L
  D791  0C            		INC	C
  D792  ED61          		OUT	(C),H
                      	
  D794  21A5D7        		LD	HL,EDMAD
  D797  CD14DF        		CALL	SETDMA
  D79A  CD3CDF        		CALL	GO_DMA
  D79D  EB            		EX	DE,HL
  D79E  D1            		POP	DE
  D79F  C1            		POP	BC
  D7A0                	DMA_ADD_SEC:
  D7A0  13            		INC	DE
  D7A1  10FD          		DJNZ	DMA_ADD_SEC
  D7A3  AF            		XOR	A
  D7A4  C9            		RET
                      	
  D7A5                	EDMAD:
  D7A5  C3            		DB	0C3H	;WR6 リセット
  D7A6  7D            		DB	07DH	;WR0 ポートA→ポートB 転送
  D7A7  030D          		DW	00D03H	;ポートA開始アドレス EMMリード/ライト
  D7A9  FF01          	DMALEN:	DW	001FFH	;ブロック長(転送サイズ-1)
  D7AB  2C            		DB	02CH	;WR1 ポートAアドレス固定 I/O
  D7AC  50            		DB	050H	;WR2 ポートBアドレスインクリメント メモリ
  D7AD  02            		DB	002H	;ポートBタイミング
  D7AE  80            		DB	080H	;WR3
  D7AF  9A            		DB	09AH	;WR5 WAIT RDY:HIGH
  D7B0  AD            		DB	0ADH	;WR4 連続 ポートB開始アドレス
  D7B1  0000          	DMAB:	DW	0
  D7B3  01            		DB	001H	;WR0 ポートA←ポートB 転送
  D7B4                	EMME:
                      	
  0748                	AT_RE	EQU	EDWT-AT_EDWT
                      	
                      	
                      	;LDOS.ASM
                      	
                      	;	LSX-Dodgers OS
                      	
  D7B4                	BDOS0:
  D7B4  E5            		PUSH	HL
  D7B5  79            		LD	A,C
  D7B6  FE3C          		CP	03CH
  D7B8  3802          		JR	C,DOS1
  D7BA  3E3C          		LD	A,03CH
  D7BC                	DOS1:
  D7BC  87            		ADD	A,A
  D7BD  6F            		LD	L,A
  D7BE  26F0          		LD	H,STABLE/256
  D7C0  7E            		LD	A,(HL)
  D7C1  2C            		INC	L
  D7C2  66            		LD	H,(HL)
  D7C3  6F            		LD	L,A
  D7C4  E3            		EX	(SP),HL
  D7C5  79            		LD	A,C
                      	;確認用
                      	;	LD	(0050H),A
  D7C6  C9            		RET
  D7C7                	_DOS2:
  D7C7  FE5A          		CP	05AH		;(BDOS)カレントディレクトリの変更(_CHDIR)
  D7C9  CA6ADA        		JP	Z,_SYS5A
  D7CC  FE5C          		CP	05CH		;(BDOS)ファイル名の解析(_PFILE)
  D7CE  CA26DA        		JP	Z,_SYS5C
  D7D1  FE5F          		CP	05FH		;(BDOS)ディスクバッファのフラッシュ(_FLUSH)
  D7D3  CA4BED        		JP	Z,_SYS5F
  D7D6  FE6F          		CP	06FH		;(BDOS)MSX-DOS のバージョン番号の獲得(_DOSVER)
  D7D8  200A          		JR	NZ,_ERROR
  D7DA  011D01        		LD	BC,011DH
  D7DD  114901        		LD	DE,VER
  D7E0  210000        		LD	HL,MACD
  D7E3                	C_REM:
  D7E3  AF            		XOR	A
  D7E4                	_ERROR:
  D7E4  A7            		AND	A
  D7E5  C9            		RET
                      	
  D7E6                	_SYS09:		;文字列出力
  D7E6  D5            		PUSH	DE
  D7E7                	_SX09:
  D7E7  1A            		LD	A,(DE)
  D7E8  13            		INC	DE
  D7E9  FE24          		CP	'$'
  D7EB  2831          		JR	Z,SX0E2
  D7ED  CD3BDB        		CALL	MSG_A
  D7F0  18F5          		JR	_SX09
                      	
  D7F2                	MSX1:
  D7F2  CD3BDB        		CALL	MSG_A
  D7F5                	MSX:
  D7F5  7E            		LD	A,(HL)
  D7F6  23            		INC	HL
  D7F7  B7            		OR	A
  D7F8  20F8          		JR	NZ,MSX1
  D7FA  C9            		RET
                      	
  D7FB                	_SYS0C:		;(BDOS)バージョン番号の獲得
  D7FB  212200        		LD	HL,00022H
  D7FE  7D            		LD	A,L
  D7FF  C9            		RET
                      	
  D800                	_SYS0D:		;(BDOS)ディスクリセット
  D800  CDDFEF        		CALL	_FFLUSH
  D803  E5            		PUSH	HL
  D804  218000        		LD	HL,00080H
  D807  228AEF        		LD	(_DTA),HL
  D80A  E1            		POP	HL
  D80B  D5            		PUSH	DE
  D80C  1E00          		LD	E,0
  D80E  3E            		DB	03EH
                      	
  D80F                	_SYS0E:		;(BDOS)カレントドライブの設定
  D80F  D5            		PUSH	DE
  D810  7B            		LD	A,E
  D811  DDE5          		PUSH	IX
  D813  CDDCEF        		CALL	_GETDPB
  D816  DDE1          		POP	IX
  D818  3804          		JR	C,SX0E2
  D81A  7B            		LD	A,E
  D81B  3287EF        		LD	(_DVSW),A
  D81E                	SX0E2:
  D81E  3E08          		LD	A,8
  D820  D1            		POP	DE
  D821  C9            		RET
                      	
  D822                	_SYS0F:		;(BDOS)ファイルのオープン
  D822  CDF3E0        		CALL	SETDRV
  D825  FD7E1C        		LD	A,(IY+28)	;(FCB)オープンモード
  D828  C602          		ADD	A,002H		;Write
  D82A  2848          		JR	Z,FEND0F
  D82C  CD41E4        		CALL	CHKWILDX
                      	
  D82F  D413E1        		CALL	NC,SOPENX
  D832                	_S16XX:
  D832  3840          		JR	C,FEND0F
                      					;Directory location
  D834  3A9FEF        		LD	A,(_FILEN)
  D837  FD7719        		LD	(IY+25),A	;(FCB)ディレクトリロケーション
                      	;				_DIRF
  D83A  3AA0EF        		LD	A,(_DIRF)
  D83D  FD771D        		LD	(IY+29),A	;(FCB)ディレクトリモード
                      	;				_FBPS
  D840  FD731E        		LD	(IY+30),E	;(FCB)ディレクトリポジション
  D843  FD721F        		LD	(IY+31),D
                      	;				Open(Read)
  D846  FD361CFF      		LD	(IY+28),0FFH	;(FCB)オープンモード
                      	;				FILENAME
  D84A  FDE5          		PUSH	IY
  D84C  D1            		POP	DE
  D84D  13            		INC	DE
  D84E  010B00        		LD	BC,11
  D851  EDB0          		LDIR
                      	;				Attribute
  D853  7E            		LD	A,(HL)
  D854  FD770D        		LD	(IY+13),A	;(FCB)属性(アトリビュート)
  D857  110B00        		LD	DE,11		;Reserved
  D85A  19            		ADD	HL,DE
                      						;(FCB)ファイルを最後に変更した時刻
  D85B  11EAF0        		LD	DE,SDDATA		;(FCB)ファイルを最後に変更した日付
  D85E  060A          		LD	B,SDDATAE-SDDATA	;(FCB)ファイルの先頭クラスタ
  D860                	S16LOOP:				;(FCB)ファイルのサイズ(バイト単位)
  D860  1A            		LD	A,(DE)
  D861  13            		INC	DE
  D862  3269D8        		LD	(S16PAT+2),A
  D865  7E            		LD	A,(HL)
  D866  23            		INC	HL
  D867  FD7700        	S16PAT:	LD	(IY+0),A
  D86A  10F4          		DJNZ	S16LOOP
                      	
  D86C  AF            		XOR	A
  D86D  FD770C        		LD	(IY+12),A	;(FCB)カレントブロック
  D870  FD2218D9      		LD	(OFCB+1),IY
  D874                	FEND0F:
  D874  1845          		JR	FEND10
                      	
  D876                	_SYS10:		;(BDOS)ファイルのクローズ
  D876  CDF3E0        		CALL	SETDRV
  D879  FD7E1C        		LD	A,(IY+28)	;(FCB)オープンモード
  D87C  D6FE          		SUB	0FEH
  D87E  37            		SCF
  D87F  3F            		CCF
  D880  2039          		JR	NZ,FEND10
  D882                	_S10A:				;Write
  D882  FD770E        		LD	(IY+14),A	;(FCB)レコードサイズ/アクセスするディレクトリのクラスタ番号+1
  D885  FD770F        		LD	(IY+15),A
                      	
  D888  FD341C        		INC	(IY+28)		;0FEH->0FFH ;オープンモード
  D88B  CD39E5        		CALL	SETTMS
                      	
  D88E  FD7E1D        		LD	A,(IY+29)	;(FCB)ディレクトリモード
  D891  32A0EF        		LD	(_DIRF),A
  D894  E67F          		AND	07FH
  D896  3282EA        		LD	(_SECPS+1),A
  D899  FD5E1E        		LD	E,(IY+30)	;(FCB)ディレクトリポジション
  D89C  FD561F        		LD	D,(IY+31)
  D89F  CD47E2        		CALL	READ_DIR
  D8A2  3817          		JR	C,FEND10
                      	
  D8A4  3A71E1        	SDECM1:	LD	A,(SDECPAT+1)	;1セクタ辺りのディレクトリエントリ数
  D8A7  3D            	 	DEC	A		;1024=01FH / 512=00FH / 256=7
  D8A8  FDA619        		AND	(IY+25)		;(FCB)ディレクトリロケーション
  D8AB  6F            		LD	L,A
  D8AC  2600          		LD	H,0
  D8AE  29            		ADD	HL,HL		;*2
  D8AF  29            		ADD	HL,HL		;*4
  D8B0  29            		ADD	HL,HL		;*8
  D8B1  29            		ADD	HL,HL		;*16
  D8B2  29            		ADD	HL,HL		;*32
  D8B3  ED4B7EF0      		LD	BC,(_DTBUF)
  D8B7  09            		ADD	HL,BC
                      	
  D8B8  CD51E4        		CALL	SDIRENT
  D8BB                	FEND10:
  D8BB  1842          		JR	FEND
                      	
  D8BD                	_SYS11:		;(BDOS)最初のファイルの検索
  D8BD  CDF3E0        		CALL	SETDRV
  D8C0  CD40E1        		CALL	SOPEN
  D8C3                	_S12X1:
  D8C3  383A          		JR	C,FEND
  D8C5  CDE0E1        		CALL	SOPENE2
  D8C8  ED5B8AEF      		LD	DE,(_DTA)
  D8CC  3A88EF        		LD	A,(_DRV)
  D8CF  3C            		INC	A
  D8D0  12            		LD	(DE),A
  D8D1  D5            		PUSH	DE
  D8D2  13            		INC	DE
  D8D3  012000        		LD	BC,32
  D8D6  EDB0          		LDIR
  D8D8  FD6E0E        		LD	L,(IY+14)	;(FCB)レコードサイズ/アクセスするディレクトリのクラスタ番号+1
  D8DB  FD660F        		LD	H,(IY+15)
  D8DE  22F4F0        		LD	(SCDIR),HL
  D8E1  2A9AEF        		LD	HL,(_FBPS)
  D8E4  22F6F0        		LD	(SFBPS),HL
  D8E7  2A9FEF        		LD	HL,(_FILEN)
  D8EA  7C            		LD	A,H
  D8EB  B7            		OR	A
  D8EC  2806          		JR	Z,_S12DIR
  D8EE  3A82EA        		LD	A,(_SECPS+1)
  D8F1  F680          		OR	080H
  D8F3  67            		LD	H,A
  D8F4                	_S12DIR:
  D8F4  22F8F0        		LD	(SFNDF),HL	;Directory position and Flags
  D8F7  E1            		POP	HL
  D8F8  1139EF        		LD	DE,SFILE
  D8FB  0E21          		LD	C,33
  D8FD                	_S11B:
  D8FD  EDB0          		LDIR
  D8FF                	FEND:
  D8FF  9F            		SBC	A,A		;CF=0 A=0 : CF=1 A=0FFH
  D900                	FENDE:
  D900  FDE1          		POP	IY
  D902  C1            		POP	BC
  D903  D1            		POP	DE
  D904  E1            		POP	HL
  D905  C9            		RET
                      	
  D906                	_SYS12:		;(BDOS)次のファイルの検索
  D906  E5            		PUSH	HL
  D907  D5            		PUSH	DE
  D908  C5            		PUSH	BC
  D909  FDE5          		PUSH	IY
  D90B  CDA4E1        		CALL	NOPEN
  D90E  18B3          		JR	_S12X1
                      	
  D910                	_S16K:
  D910  FD7E1C        		LD	A,(IY+28)	;(FCB)オープンモード
  D913  FEFD          		CP	0FDH		;Device(0FDH)
  D915  37            		SCF
  D916  C8            		RET	Z
                      	
  D917  110000        	OFCB:	LD	DE,0
  D91A  D5            		PUSH	DE
  D91B  061A          		LD	B,26		;First cluster
  D91D                	S16K1:
  D91D  13            		INC	DE
  D91E  23            		INC	HL
  D91F  10FC          		DJNZ	S16K1
                      	
  D921  1A            		LD	A,(DE)
  D922  BE            		CP	(HL)
  D923  2013          		JR	NZ,S16K2
  D925  13            		INC	DE
  D926  23            		INC	HL
  D927  1A            		LD	A,(DE)
  D928  BE            		CP	(HL)
  D929  200D          		JR	NZ,S16K2
                      	
  D92B  E1            		POP	HL
  D92C  FDE5          		PUSH	IY
  D92E  D1            		POP	DE
  D92F  1A            		LD	A,(DE)		;Drive
  D930  BE            		CP	(HL)
  D931  2006          		JR	NZ,S16K3
                      					;ここはCFが必ず0
  D933  ED52          		SBC	HL,DE		;CP HL,DE
  D935  37            		SCF
  D936  C0            		RET	NZ
  D937  E5            		PUSH	HL
  D938                	S16K2:
  D938  E1            		POP	HL
  D939                	S16K3:
  D939  FDE5          		PUSH	IY
  D93B  D1            		POP	DE
  D93C                	_SYS13:		;(BDOS)ファイルの削除
  D93C  CDF3E0        		CALL	SETDRV
  D93F  CD71E3        		CALL	KILL
  D942                	FEND13:
  D942  18BB          		JR	FEND
                      	
  D944                	_SYS14:		;(BDOS)シーケンシャルな読み出し
  D944  CDF3E0        		CALL	SETDRV
  D947  CDA5E5        		CALL	INIT_SEQ
  D94A                	SREAD:
  D94A  CDEFE5        		CALL	RB_READ
                      	
  D94D  C601          		ADD	A,001H
  D94F  38AE          		JR	C,FEND
                      	
  D951  7D            		LD	A,L
  D952  D601          		SUB	001H
  D954                	FENDX:
  D954  9F            		SBC	A,A
  D955  E603          		AND	3
  D957  1F            		RRA
  D958  18A6          		JR	FENDE
                      	
  D95A                	_SYS15:		;(BDOS)シーケンシャルな書き込み
  D95A  CDF3E0        		CALL	SETDRV
  D95D  CDA5E5        		CALL	INIT_SEQ
  D960                	SWRITE:
  D960  CDE8E5        		CALL	RB_WRITE
                      	
  D963  C6FF          		ADD	A,0FFH
  D965  18ED          		JR	FENDX
                      	
  D967                	_SYS17:		;(BDOS)ファイル名の変更
  D967  CDF3E0        		CALL	SETDRV
  D96A  CDC7E3        		CALL	NAME
  D96D  18D3          		JR	FEND13
                      	
  D96F                	_SYS16:		;(BDOS)ファイルの作成
  D96F  CDF3E0        		CALL	SETDRV
                      	
  D972  CD41E4        		CALL	CHKWILDX
  D975  38CB          		JR	C,FEND13
  D977  FD7E01        		LD	A,(IY+1)	;(FCB)主ファイル名
  D97A  FE05          		CP	5
  D97C  2805          		JR	Z,_S16X2
  D97E  FE21          		CP	021H
  D980  DA42D9        		JP	C,FEND13
  D983                	_S16X2:
                      	;				Clear FCB
  D983  FDE5          		PUSH	IY
  D985  E1            		POP	HL
  D986  011000        		LD	BC,16
  D989  09            		ADD	HL,BC
  D98A                	_S16X1:
  D98A  70            		LD	(HL),B		;B=0
  D98B  23            		INC	HL
  D98C  0D            		DEC	C
  D98D  20FB          		JR	NZ,_S16X1
                      	
  D98F  CD3EE5        		CALL	SETTMSX
  D992  FD360DFF      		LD	(IY+13),0FFH	;(FCB)Attribute
  D996  CD13E1        		CALL	SOPENX
  D999  3F            		CCF
  D99A  CC10D9        		CALL	Z,_S16K
  D99D  D4F1E1        		CALL	NC,COPEN
  D9A0  D451E4        		CALL	NC,SDIRENT
  D9A3  C332D8        		JP	_S16XX
                      	
  D9A6                	_SYS21:		;(BDOS)ランダムな読み出し
  D9A6  CDF3E0        		CALL	SETDRV
  D9A9  CD89E5        		CALL	INIT_RND
  D9AC  189C          		JR	SREAD
                      	
  D9AE                	_SYS22:		;(BDOS)ランダムな書き込み
  D9AE                	_SYS28:		;(BDOS)ランダムな書き込み・その2
  D9AE  CDF3E0        		CALL	SETDRV
  D9B1  CD89E5        		CALL	INIT_RND
  D9B4  18AA          		JR	SWRITE
                      	
  D9B6                	_SYS18:		;(BDOS)ログインベクトルの獲得
  D9B6  21FF00        		LD	HL,000FFH
  D9B9  AF            		XOR	A
  D9BA  C9            		RET
                      	
  D9BB                	_SYS19:		;(BDOS)カレントドライブ番号の獲得
  D9BB  3A87EF        		LD	A,(_DVSW)
  D9BE  A7            		AND	A
  D9BF  C9            		RET
                      	
  D9C0                	_SYS1A:		;(BDOS)DTAの設定
  D9C0  ED538AEF      		LD	(_DTA),DE
  D9C4  AF            		XOR	A
  D9C5  C9            		RET
                      	
  D9C6                	_SYS1B:		;(BDOS)ディスク情報の獲得
  D9C6  7B            		LD	A,E
  D9C7  CD06E1        		CALL	GETDRV
  D9CA  CDDCEF        		CALL	_GETDPB
  D9CD  D4E2EF        		CALL	NC,_RDFATX
  D9D0  210000        		LD	HL,0
  D9D3  D417E5        		CALL	NC,DSKF
                      	
  D9D6  ED5B18E5      		LD	DE,(MAXCLP+1)	;DPB_08_MAXCL-1
  D9DA  1B            		DEC	DE		;DE←クラスタの総数
  D9DB  FD2A7CF0      		LD	IY,(_FATBF)	;IY←メモリ上のFATの先頭アドレス
  D9DF  9F            		SBC	A,A
  D9E0  D8            		RET	C
  D9E1  4F            		LD	C,A		;C=0
  D9E2  DD7E0F        		LD	A,(IX+00FH)	;DPB_0F_BPS
  D9E5  E60F          		AND	00FH
  D9E7  47            		LD	B,A
  D9E8  DD7E07        		LD	A,(IX+7)	;DPB_07_SECPCL
  D9EB  C9            		RET
                      	
  D9EC                	_SYS1D:		;(BDOS)書き込みが禁止されているディスクの調査
  D9EC  AF            		XOR	A
  D9ED  67            		LD	H,A
  D9EE  6F            		LD	L,A
  D9EF  C9            		RET
                      	
  D9F0                	_SYS1F:		;(BDOS)ディスク装置のパラメータの読み出し
  D9F0  2100F1        		LD	HL,DEVICE
  D9F3  7B            		LD	A,E
  D9F4  C3DCEF        		JP	_GETDPB
                      	
  D9F7                	_SYS23:		;(BDOS)ファイルサイズの獲得
  D9F7  E5            		PUSH	HL
  D9F8  2A1EF0        		LD	HL,(STABLE+2*00FH)	;ファイルのオープン
  D9FB  CD0F00        		CALL	JP_HL
  D9FE  381B          		JR	C,_S23X1
                      	
  DA00  D5            		PUSH	DE		;EX DE,IY
  DA01  FDE3          		EX	(SP),IY		;
                      	;	POP	DE		;
                      	;	PUSH	DE		;DEを破壊しないように注意vv
  DA03  FD7E10        		LD	A,(IY+16)	;(FCB)ファイルのサイズ(バイト単位)
  DA06  FD6E11        		LD	L,(IY+17)	;
  DA09  FD6612        		LD	H,(IY+18)	;
  DA0C  C5            		PUSH	BC		;
  DA0D  FD4613        		LD	B,(IY+19)	;
  DA10  CD7BE5        		CALL	GET_CPM_R_SIZE
  DA13  C1            		POP	BC
  DA14                	_S24X1:
  DA14  CD9BE5        		CALL	SET_RR_AHL
                      	;	POP	DE		;^^^^^^^^^^^^^^^^^^^^^^^^
                      	;	PUSH	DE		;EX DE,IY
  DA17  FDE3          		EX	(SP),IY		;
  DA19  D1            		POP	DE		;
                      	
  DA1A  AF            		XOR	A
  DA1B                	_S23X1:
  DA1B  E1            		POP	HL
  DA1C  C9            		RET
                      	
  DA1D                	_SYS24:		;(BDOS)ランダムレコードフィールドの設定
  DA1D  E5            		PUSH	HL
  DA1E  D5            		PUSH	DE		;EX DE,IY
  DA1F  FDE3          		EX	(SP),IY		;
                      	;	POP	DE		;
                      	;	PUSH	DE		;DEを破壊しないように注意vv
  DA21  CDADE5        		CALL	GETSEQ
  DA24  18EE          		JR	_S24X1		;^^^^^^^^^^^^^^^^^^^^^^^^
                      	
  DA26                	_SYS5C:		;(BDOS)ファイル名の解析
  DA26  C5            		PUSH	BC
  DA27  E5            		PUSH	HL
  DA28  CD0AE0        		CALL	FILE
  DA2B  E1            		POP	HL
  DA2C  C1            		POP	BC
  DA2D                	S29X1:
  DA2D  C5            		PUSH	BC
  DA2E  D5            		PUSH	DE
  DA2F  E5            		PUSH	HL
  DA30  EB            		EX	DE,HL
  DA31  2114EF        		LD	HL,FDRV
  DA34  010D00        		LD	BC,13
  DA37  EDB0          		LDIR
  DA39  70            		LD	(HL),B		;B=0
  DA3A  0E03          		LD	C,3
  DA3C  EDB0          		LDIR
  DA3E  E1            		POP	HL
  DA3F  D1            		POP	DE
  DA40  C1            		POP	BC
  DA41  AF            		XOR	A
  DA42  C9            		RET
                      	
  DA43                	_SYS30:		;(BDOS)論理セクタを用いた書き込み
  DA43  C5            		PUSH	BC
  DA44  01EFEB        		LD	BC,DWT24B
  DA47  1804          		JR	S2FX
  DA49                	_SYS2F:
  DA49  C5            		PUSH	BC
  DA4A  01DFEB        		LD	BC,DRD24B
  DA4D                	S2FX:
  DA4D  ED4363DA      		LD	(S2FPAT+1),BC
  DA51  CDDFEF        		CALL	_FFLUSH
                      	
  DA54  D5            		PUSH	DE
  DA55  E5            		PUSH	HL
  DA56  7D            		LD	A,L		;Drive
  DA57  CDD9EF        		CALL	_CHGDRV
  DA5A  3809          		JR	C,S30X2
  DA5C  44            		LD	B,H		;Number of clusters
  DA5D  2A8AEF        		LD	HL,(_DTA)
                      	
  DA60  0E00          		LD	C,0
  DA62  CDDFEB        	S2FPAT:	CALL	DRD24B
  DA65                	S30X2:
  DA65  E1            		POP	HL
  DA66  D1            		POP	DE
  DA67  C1            		POP	BC
  DA68  9F            		SBC	A,A
  DA69  C9            		RET
                      	
  DA6A                	_SYS5A:		;(BDOS)カレントディレクトリの変更
  DA6A  C5            		PUSH	BC
  DA6B  D5            		PUSH	DE
  DA6C  E5            		PUSH	HL
  DA6D  CDFFDF        		CALL	FILEC
  DA70  210000        		LD	HL,0
  DA73  1114EF        		LD	DE,FDRV
  DA76  2A4EF0        		LD	HL,(STABLE+2*027H)	;ランダムブロック読み込み
  DA79  CD0F00        		CALL	JP_HL
  DA7C  18E7          		JR	S30X2
                      	
                      	;X1IO.ASM
                      	
                      	;	LSX-Dodgers IO
                      	;	X1/turbo/Z
                      	
  D7E4                	_SYS04	EQU	_ERROR		;(BDOS)外部出力
  D7E4                	_SYS05	EQU	_ERROR		;(BDOS)プリンタ出力
  D7E4                	_SYS1C	EQU	_ERROR		;(BDOS)ディスクの書き込み禁止化
  D7E4                	_SYS1E	EQU	_ERROR		;(BDOS)ファイル属性の設定
  D7E4                	_SYS20	EQU	_ERROR		;(BDOS)利用者番号の設定と読み出し
  D7E4                	_SYS2E	EQU	_ERROR		;(BDOS)ベリファイ・フラグの設定
                      	
  DA7E                	BIOS:
  DA7E  CD86DA        		CALL	BIOS3
  DA81  061E          		LD	B,01EH
  DA83  ED79          		OUT	(C),A
  DA85  C9            		RET
  DA86                	BIOS3:
  DA86  C5            		PUSH	BC
  DA87  061D          		LD	B,01DH
  DA89  ED79          		OUT	(C),A
  DA8B  C9            		RET
                      	
  DA8C                	INT:
  DA8C  F5            		PUSH	AF
  DA8D  E5            		PUSH	HL
  DA8E  C5            		PUSH	BC
                      	
  DA8F  CD43DE        		CALL	IN49SB
  DA92  67            		LD	H,A
  DA93  CD43DE        		CALL	IN49SB
  DA96  6F            		LD	L,A
                      	
  DA97  FE08          		CP	8		;DELキー
  DA99  2005          		JR	NZ,SCEXE
  DA9B  7C            		LD	A,H
  DA9C  E611          		AND	011H		;CTRLキー + GRAPHキー
  DA9E  280C          		JR	Z,RESET
  DAA0                	SCEXE:
  DAA0  2292EF        		LD	(_KEYD),HL
  DAA3  CDD8DA        		CALL	KEYSET1
                      	
  DAA6  C1            		POP	BC
  DAA7                	INTPE:
  DAA7  E1            		POP	HL
  DAA8                	INTPE2:
  DAA8  F1            		POP	AF
  DAA9                	INTCTCE:
  DAA9  FB            		EI
  DAAA  ED4D          		RETI
                      	
  DAAC                	RESET:
  DAAC  3E1D          		LD	A,01DH
  DAAE  D300          		OUT	(0),A
  DAB0  C7            		RST	0
                      	
  DAB1                	INTCTC2:
  DAB1  F5            		PUSH	AF
  DAB2  3E00          	INTCPAT:LD	A,000H
  DAB4  3D            		DEC	A
  DAB5  32B3DA        		LD	(INTCPAT+1),A
  DAB8  20EE          		JR	NZ,INTPE2
                      	
  DABA  3A92EF        		LD	A,(_KEYD)
  DABD  B7            		OR	A
  DABE  28E8          		JR	Z,INTPE2
  DAC0                	KEYSET0:
  DAC0  E5            		PUSH	HL
  DAC1  2A90EF        		LD	HL,(_KEYPS)
  DAC4  7C            		LD	A,H
  DAC5  AD            		XOR	L
  DAC6  2006          		JR	NZ,INTC2A
                      	
  DAC8  2A92EF        		LD	HL,(_KEYD)
  DACB  CD0CDB        		CALL	KEYSET
  DACE                	INTC2A:
  DACE  3A94EF        		LD	A,(_KEYSP)
  DAD1  E60F          		AND	00FH
  DAD3  32B3DA        		LD	(INTCPAT+1),A
                      	
  DAD6  18CF          		JR	INTPE
                      	
  DAD8                	KEYSET1:
  DAD8  CB6C          		BIT	5,H
  DADA  F5            		PUSH	AF
  DADB  ED4B8CEF      		LD	BC,(_CTC)
  DADF  78            		LD	A,B
  DAE0  B1            		OR	C
  DAE1  2006          		JR	NZ,KEYS10E
                      	
  DAE3  F1            		POP	AF
  DAE4  2026          		JR	NZ,KEYSET
  DAE6  F5            		PUSH	AF
  DAE7  18D7          		JR	KEYSET0
  DAE9                	KEYS10E:
  DAE9  F1            		POP	AF
  DAEA  C8            		RET	Z
  DAEB  F5            		PUSH	AF
  DAEC  3E03          		LD	A,3		;CTC STOP
  DAEE  ED79          		OUT	(C),A
  DAF0  F1            		POP	AF
                      	
  DAF1  B7            		OR	A
  DAF2  C8            		RET	Z
                      	
  DAF3  E5            		PUSH	HL
  DAF4  2A94EF        		LD	HL,(_KEYSP)
  DAF7  3EA7          		LD	A,0A7H
  DAF9  ED79          		OUT	(C),A
  DAFB  ED69          		OUT	(C),L
  DAFD  79            		LD	A,C
  DAFE  E6FC          		AND	0FCH
  DB00  4F            		LD	C,A
  DB01  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  DB03  3EC0          		LD	A,CTC0
  DB05  ED79          		OUT	(C),A
  DB07  7C            		LD	A,H
  DB08  32B3DA        		LD	(INTCPAT+1),A
  DB0B  E1            		POP	HL
                      	
  DB0C                	KEYSET:
  DB0C  7D            		LD	A,L
  DB0D  CB74          		BIT	6,H
  DB0F  C0            		RET	NZ
  DB10                	KEYBS:
  DB10  B7            		OR	A
  DB11  C8            		RET	Z
  DB12                	KEYBS1:
  DB12  CD28DB        		CALL	KEYBC_IFBREAK
  DB15  E5            		PUSH	HL
  DB16  F5            		PUSH	AF
  DB17  2A90EF        		LD	HL,(_KEYPS)
  DB1A  2C            		INC	L
  DB1B  7D            		LD	A,L
  DB1C  BC            		CP	H
  DB1D  2815          		JR	Z,POP_AF_HL_SCF_RET
  DB1F  3290EF        		LD	(_KEYPS),A
  DB22  26FE          		LD	H,KEYBF/256
  DB24  F1            		POP	AF
  DB25  77            		LD	(HL),A
  DB26  E1            		POP	HL
  DB27  C9            		RET
  DB28                	KEYBC_IFBREAK:
  DB28  FE03          		CP	3
  DB2A  C0            		RET	NZ
  DB2B                	KEYBC:
  DB2B  E5            		PUSH	HL
  DB2C  210000        		LD	HL,0
  DB2F  2290EF        		LD	(_KEYPS),HL
  DB32  E1            		POP	HL
  DB33  C9            		RET
                      	
  DB34                	POP_AF_HL_SCF_RET:
  DB34  F1            		POP	AF
  DB35  E1            		POP	HL
  DB36  37            		SCF
  DB37  C9            		RET
                      	
  DB38                	_SYS01:		;(BDOS)コンソール入力
  DB38  CD09EF        		CALL	_SYS07
  DB3B                	MSG_A:
  DB3B  F5            		PUSH	AF
  DB3C  D5            		PUSH	DE
  DB3D  5F            		LD	E,A
  DB3E  CD44DB        		CALL	_SYS02
  DB41  D1            		POP	DE
  DB42  F1            		POP	AF
  DB43  C9            		RET
                      	
  DB44                	_SYS02:		;(BDOS)コンソール出力
  DB44  CD56DB        		CALL	BREAK
  DB47  1805          		JR	PRINTX
                      	
  DB49                	_SYS06:		;(BDOS)コンソール直接入出力
  DB49  7B            		LD	A,E
  DB4A  3C            		INC	A
  DB4B  CACAEF        		JP	Z,_INKEY
  DB4E                	PRINTX:
  DB4E  C3CDEF        		JP	_PRINT
                      	
  DB51                	_SYS08:		;(BDOS)エコーなしコンソール入力
  DB51  CD09EF        		CALL	_SYS07
  DB54  1804          		JR	BREAK1
  DB56                	BREAK:
  DB56  FB            		EI
  DB57  3A92EF        		LD	A,(_KEYD)
  DB5A                	BREAK1:
  DB5A  FE03          		CP	3		;CTRL+C
  DB5C  CA00EF        		JP	Z,CPM_BOOT
  DB5F  FE13          		CP	013H		;CTRL+S
  DB61  C0            		RET	NZ
                      	
  DB62                	PAUSE:
  DB62  CD2BDB        		CALL	KEYBC
                      	
  DB65                	FLGET:
  DB65  CDDFEF        		CALL	_FFLUSH
  DB68  C5            		PUSH	BC
  DB69  E5            		PUSH	HL
  DB6A  ED4B8EEF      		LD	BC,(_TXADR)
  DB6E  CBE8          		SET	5,B
  DB70  ED60          		IN	H,(C)
  DB72                	FLGET1:
  DB72  3A93EF        		LD	A,(_KEYD+1)
  DB75  0F            		RRCA
  DB76  0F            		RRCA
  DB77  E610          		AND	010H
  DB79  F608          		OR	8
  DB7B  ED68          		IN	L,(C)
  DB7D  B5            		OR	L
  DB7E  ED79          		OUT	(C),A
  DB80  CDCAEF        		CALL	_INKEY
  DB83  28ED          		JR	Z,FLGET1
  DB85  ED61          		OUT	(C),H
  DB87  E1            		POP	HL
  DB88  C1            		POP	BC
  DB89  C9            		RET
                      	
  DB8A                	_SYS0A:		;(BDOS)文字列入力
  DB8A  C5            		PUSH	BC
  DB8B  E5            		PUSH	HL
  DB8C  D5            		PUSH	DE
  DB8D  CD90DF        		CALL	GETL
  DB90  1100FF        		LD	DE,KBUF
  DB93  E1            		POP	HL
  DB94  E5            		PUSH	HL
  DB95  0E00          		LD	C,0
  DB97  3004          		JR	NC,SAX0
  DB99  23            		INC	HL
  DB9A  23            		INC	HL
  DB9B  1808          		JR	SAX4
  DB9D                	SAX0:
  DB9D  46            		LD	B,(HL)
  DB9E  23            		INC	HL
  DB9F                	SAX1:
  DB9F  23            		INC	HL
  DBA0  1A            		LD	A,(DE)
  DBA1  13            		INC	DE
  DBA2  B7            		OR	A
  DBA3  2004          		JR	NZ,SAX2
  DBA5                	SAX4:
  DBA5  360D          		LD	(HL),00DH
  DBA7  1804          		JR	SAX3
  DBA9                	SAX2:
  DBA9  77            		LD	(HL),A
  DBAA  0C            		INC	C
  DBAB  10F2          		DJNZ	SAX1
  DBAD                	SAX3:
  DBAD  D1            		POP	DE
  DBAE  79            		LD	A,C
  DBAF  13            		INC	DE
  DBB0  12            		LD	(DE),A
  DBB1  1B            		DEC	DE
  DBB2  E1            		POP	HL
  DBB3  C1            		POP	BC
  DBB4  A7            		AND	A
  DBB5  C9            		RET
                      	
  DBB6                	_SYS0B:		;(BDOS)コンソール状態のチェック
  DBB6  CD56DB        		CALL	BREAK
  DBB9  3A92EF        		LD	A,(_KEYD)
  DBBC  B7            		OR	A
  DBBD  C8            		RET	Z
  DBBE                	CONSTX:
  DBBE  CDDFEF        		CALL	_FFLUSH
  DBC1  E5            		PUSH	HL
  DBC2  2A90EF        		LD	HL,(_KEYPS)
  DBC5  7C            		LD	A,H
  DBC6  AD            		XOR	L
  DBC7  E1            		POP	HL
  DBC8  C6FF          		ADD	A,0FFH
  DBCA  9F            		SBC	A,A
  DBCB  C9            		RET
                      	
  DBCC                	_SYS2A:		;(BDOS)日付の獲得
  DBCC  C5            		PUSH	BC
  DBCD  3EED          		LD	A,0EDH		;Read calendar
  DBCF  CD5EDE        		CALL	COMOUT
  DBD2  CD04DC        		CALL	IN49SB_BCD	;YY
  DBD5  6F            		LD	L,A
  DBD6  2600          		LD	H,0
                      	;	LD	DE,1900		;0076CH
                      	;	CP	90		;90以上は1900年代 1990-1999
                      	;	JR	NC,RDDATE1	;90未満は2000年代 2000-2089
                      	;	LD	E,0D0H		;2000 & 0FFH D=007H
  DBD8  11D007        		LD	DE,2000		;すべて2000年代で処理 2000-2099
  DBDB                	RDDATE1:
  DBDB  19            		ADD	HL,DE
  DBDC  CD43DE        		CALL	IN49SB		;MW
  DBDF  57            		LD	D,A
  DBE0  CD04DC        		CALL	IN49SB_BCD	;DD
  DBE3  5F            		LD	E,A
  DBE4  7A            		LD	A,D
  DBE5  0604          		LD	B,4
  DBE7                	RDDATE2:
  DBE7  CB3A          		SRL	D
  DBE9  10FC          		DJNZ	RDDATE2
  DBEB  C1            		POP	BC
  DBEC  E607          		AND	7
  DBEE  C9            		RET
                      	
  DBEF                	_SYS2C:		;(BDOS)時刻の獲得
  DBEF  C5            		PUSH	BC
  DBF0  3EEF          		LD	A,0EFH		;Read time
  DBF2  CD5EDE        		CALL	COMOUT
  DBF5  CD04DC        		CALL	IN49SB_BCD	;TT
  DBF8  67            		LD	H,A
  DBF9  CD04DC        		CALL	IN49SB_BCD	;MM
  DBFC  6F            		LD	L,A
  DBFD  CD04DC        		CALL	IN49SB_BCD	;SS
  DC00  57            		LD	D,A
  DC01  C1            		POP	BC
  DC02  AF            		XOR	A
  DC03  C9            		RET
                      	
  DC04                	IN49SB_BCD:
  DC04  CD43DE        		CALL	IN49SB
                      	;------------------------
                      	;BCDの10進数化
                      	;in
                      	;	A  : BCD
                      	;out
                      	;	A  : 10進数
                      	;------------------------
  DC07  4F            		LD	C,A
  DC08  E6F0          		AND	0F0H	;10の位
  DC0A  0F            		RRCA
  DC0B  47            		LD	B,A
  DC0C  0F            		RRCA
  DC0D  0F            		RRCA
  DC0E  80            		ADD	A,B
  DC0F  47            		LD	B,A
  DC10  79            		LD	A,C
  DC11  E60F          		AND	00FH	;1の位
  DC13  80            		ADD	A,B
  DC14  C9            		RET
                      	
  DC15                	ESC1:
  DC15  7B            		LD	A,E
  DC16  FE41          		CP	'A'
  DC18  CA5FDD        		JP	Z,CTRL1E
  DC1B  FE42          		CP	'B'
  DC1D  CAC9DE        		JP	Z,CTRL1F
  DC20  FE43          		CP	'C'
  DC22  CA6ADD        		JP	Z,CTRL1C
  DC25  FE44          		CP	'D'
  DC27  CA56DD        		JP	Z,CTRL1D
  DC2A  FE45          		CP	'E'
  DC2C  2802          		JR	Z,CT0CX
  DC2E  FE6A          		CP	'j'
  DC30                	CT0CX:
  DC30  CA9CDE        		JP	Z,CTRL0C
  DC33  FE48          		CP	'H'
  DC35  CAE4DD        		JP	Z,CTRL0B
  DC38  FE4A          		CP	'J'
  DC3A  CA9FDE        		JP	Z,CTRL06
  DC3D  FE4B          		CP	'K'
  DC3F  CAA3DD        		JP	Z,CTRL05
  DC42  FE4C          		CP	'L'
  DC44  CADEDE        		JP	Z,CTRL0E
  DC47  FE54          		CP	'T'
  DC49  CAA3DD        		JP	Z,CTRL05
  DC4C  FE78          		CP	'x'
  DC4E  2804          		JR	Z,ESC1X
  DC50  FE79          		CP	'y'
  DC52  2002          		JR	NZ,ESC1Y
  DC54                	ESC1X:
  DC54  3601          		LD	(HL),1
  DC56                	ESC1Y:
  DC56  FE3D          		CP	'='
  DC58  2804          		JR	Z,ESC1W
  DC5A  FE59          		CP	'Y'
  DC5C  2002          		JR	NZ,ESC1Z
  DC5E                	ESC1W:
  DC5E  3602          		LD	(HL),2
  DC60                	ESC1Z:
  DC60  FE20          		CP	020H
  DC62  3802          		JR	C,ESC1C
  DC64  87            		ADD	A,A
  DC65  D0            		RET	NC
  DC66                	ESC1C:
  DC66  E1            		POP	HL
  DC67  184F          		JR	ANK
                      	
  DC69                	ESC:
  DC69  21C9DC        		LD	HL,PRINTE5
  DC6C  E5            		PUSH	HL
  DC6D  218FDC        		LD	HL,ESCFLG+1
  DC70  3600          		LD	(HL),0
  DC72  3D            		DEC	A
  DC73  28A0          		JR	Z,ESC1
  DC75  3D            		DEC	A
  DC76  2009          		JR	NZ,ESC2
  DC78  3603          		LD	(HL),3
  DC7A  7B            		LD	A,E
  DC7B  D620          		SUB	020H
  DC7D  3284DC        		LD	(ESCYP+1),A
  DC80  C9            		RET
  DC81                	ESC2:
  DC81  3D            		DEC	A
  DC82  C0            		RET	NZ
  DC83  2600          	ESCYP:	LD	H,0
  DC85  7B            		LD	A,E
  DC86  D620          		SUB	020H
  DC88  6F            		LD	L,A
  DC89  C3D6EF        		JP	_LOC
                      	
  DC8C                	PRINT:
  DC8C  C5            		PUSH	BC
  DC8D  E5            		PUSH	HL
  DC8E  3E00          	ESCFLG:	LD	A,000H
  DC90  B7            		OR	A
  DC91  20D6          		JR	NZ,ESC
                      	
  DC93  3E1F          		LD	A,01FH
  DC95  BB            		CP	E
  DC96  3035          		JR	NC,CTRL
  DC98  0167DE        	INSFLG:	LD	BC,INSERT
                      	
  DC9B  3A1800        		LD	A,(00018H)
  DC9E  3C            		INC	A
  DC9F  2817          		JR	Z,ANK
  DCA1  3E00          	KANFLG:	LD	A,000H
  DCA3  B7            		OR	A
  DCA4  203A          		JR	NZ,KANJI2
  DCA6  7B            		LD	A,E
  DCA7  FE80          		CP	080H
  DCA9  380D          		JR	C,ANK
  DCAB  FEA0          		CP	0A0H
  DCAD  3804          		JR	C,KANJI1
  DCAF  FEE0          		CP	0E0H
  DCB1  3805          		JR	C,ANK
  DCB3                	KANJI1:
  DCB3  32A2DC        		LD	(KANFLG+1),A
  DCB6  1811          		JR	PRINTE5
  DCB8                	ANK:
  DCB8  ED4B8EEF      		LD	BC,(_TXADR)
  DCBC  78            		LD	A,B
  DCBD  F638          		OR	038H
  DCBF  47            		LD	B,A
  DCC0  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令	kanji
  DCC2  CB98          		RES	3,B
  DCC4  ED59          		OUT	(C),E		;Text
  DCC6                	KANJIE:
  DCC6  CD2BDD        		CALL	PRINTE7
  DCC9                	PRINTE5:
  DCC9  E1            		POP	HL
  DCCA  C1            		POP	BC
  DCCB  AF            		XOR	A
  DCCC  C9            		RET
                      	
  DCCD                	CTRL:
  DCCD  CD12DD        		CALL	KANCLR
  DCD0  7B            		LD	A,E
  DCD1  87            		ADD	A,A
  DCD2  F680          		OR	080H
  DCD4  6F            		LD	L,A
  DCD5  26F0          		LD	H,CTRLTB/256
  DCD7  7E            		LD	A,(HL)
  DCD8  2C            		INC	L
  DCD9  66            		LD	H,(HL)
  DCDA  6F            		LD	L,A
  DCDB  CD0F00        		CALL	JP_HL
  DCDE  18E9          		JR	PRINTE5
                      	
  DCE0                	KANJI2:
  DCE0  D5            		PUSH	DE
  DCE1  57            		LD	D,A
  DCE2  01812F        		LD	BC,02F81H	;SFTJIS
  DCE5  DF            		RST	018H
  DCE6  01C32F        		LD	BC,02FC3H	;Instead or JISVRM
  DCE9  DF            		RST	018H
                      	
  DCEA  ED4B8EEF      		LD	BC,(_TXADR)
  DCEE  78            		LD	A,B
  DCEF  F638          		OR	038H
  DCF1  47            		LD	B,A
  DCF2  ED51          		OUT	(C),D		;kanji
  DCF4  CB98          		RES	3,B
  DCF6  ED59          		OUT	(C),E		;Text
  DCF8  CD2BDD        		CALL	PRINTE7
  DCFB  ED4B8EEF      		LD	BC,(_TXADR)
  DCFF  78            		LD	A,B
  DD00  F638          		OR	038H
  DD02  47            		LD	B,A
  DD03  CBF2          		SET	6,D
  DD05  ED51          		OUT	(C),D		;Kanji
  DD07  CB98          		RES	3,B
  DD09  ED59          		OUT	(C),E		;Text
  DD0B  D1            		POP	DE
  DD0C  AF            		XOR	A
  DD0D  32A2DC        		LD	(KANFLG+1),A
  DD10  18B4          		JR	KANJIE
                      	
  DD12                	KANCLR:
  DD12  3AA2DC        		LD	A,(KANFLG+1)
  DD15  B7            		OR	A
  DD16  C8            		RET	Z
  DD17  ED4B8EEF      		LD	BC,(_TXADR)
  DD1B  78            		LD	A,B
  DD1C  F638          		OR	038H
  DD1E  47            		LD	B,A
  DD1F  AF            		XOR	A
  DD20  32A2DC        		LD	(KANFLG+1),A
  DD23  ED79          		OUT	(C),A		;Kanji
  DD25  CB98          		RES	3,B
  DD27  3E20          		LD	A,020H
  DD29  ED79          		OUT	(C),A		;Text
  DD2B                	PRINTE7:
  DD2B  CBA0          		RES	4,B
  DD2D                	PRINTE6:
  DD2D  3A96EF        		LD	A,(_COLORF)
  DD30                	PRINTE4:
  DD30  ED79          		OUT	(C),A		;Color
  DD32  78            		LD	A,B
  DD33  E607          		AND	7
  DD35  47            		LD	B,A
  DD36                	PRINTE2:
  DD36  03            		INC	BC
  DD37                	PRINTE3:
  DD37  2ABAEF        		LD	HL,(_PAGE_MINUS)
  DD3A  A7            		AND	A
  DD3B  ED4A          		ADC	HL,BC
  DD3D                	PRINTE8:
  DD3D  2805          		JR	Z,PRINT2
  DD3F  ED438EEF      		LD	(_TXADR),BC
  DD43                	CTRL00:
  DD43  C9            		RET
                      	
  DD44                	PRINT2:
  DD44  CDE4DE        		CALL	SCR
  DD47  2ABCEF        		LD	HL,(_WIDTH_MINUS)
  DD4A  09            		ADD	HL,BC
  DD4B                	SET_TXADR_HL:
  DD4B  228EEF        		LD	(_TXADR),HL
  DD4E  C9            		RET
                      	
  DD4F                	CTRL08:
  DD4F  3A98DC        		LD	A,(INSFLG)
  DD52  FECD          		CP	0CDH		;CALL ????
  DD54  2829          		JR	Z,CTRL02
  DD56                	CTRL1D:
  DD56  2A8EEF        		LD	HL,(_TXADR)
  DD59  7C            		LD	A,H
  DD5A  B5            		OR	L
  DD5B  C8            		RET	Z
  DD5C  2B            		DEC	HL
  DD5D  18EC          		JR	SET_TXADR_HL
                      	
  DD5F                	CTRL1E:
  DD5F  ED4B8EEF      		LD	BC,(_TXADR)
  DD63  2ABCEF        		LD	HL,(_WIDTH_MINUS)
  DD66  09            		ADD	HL,BC
  DD67  D0            		RET	NC
  DD68  18E1          		JR	SET_TXADR_HL
                      	
  DD6A                	CTRL1C:
  DD6A  ED4B8EEF      		LD	BC,(_TXADR)
  DD6E  18C6          		JR	PRINTE2
                      	
  DD70                	CTRL09:
  DD70  ED4B8EEF      		LD	BC,(_TXADR)
  DD74  79            		LD	A,C
  DD75  E6F8          		AND	0F8H
  DD77  C608          		ADD	A,8
  DD79  4F            		LD	C,A
  DD7A  88            		ADC	A,B
  DD7B  91            		SUB	C
  DD7C  47            		LD	B,A
  DD7D  18B8          		JR	PRINTE3
                      	
  DD7F                	CTRL02:
  DD7F  CD56DD        		CALL	CTRL1D
  DD82  C8            		RET	Z
  DD83  D5            		PUSH	DE
  DD84  CDD3EF        		CALL	_POS
  DD87  3AB1EF        		LD	A,(_WIDTH)
  DD8A  95            		SUB	L
  DD8B  4F            		LD	C,A
  DD8C  0D            		DEC	C
  DD8D  0638          		LD	B,038H
  DD8F  2A8EEF        		LD	HL,(_TXADR)
  DD92  09            		ADD	HL,BC
  DD93  44            		LD	B,H
  DD94  4D            		LD	C,L
  DD95  110020        		LD	DE,02000H	;D:Text E:kanji
  DD98  2A96EF        		LD	HL,(_COLORF)	;L:Color
  DD9B                	C8X1:
  DD9B  CD83DE        		CALL	C12S
  DD9E  0B            		DEC	BC
  DD9F  20FA          		JR	NZ,C8X1
  DDA1  D1            		POP	DE
  DDA2  C9            		RET
                      	
  DDA3                	CTRL05:
  DDA3  CDD3EF        		CALL	_POS
  DDA6  3AB1EF        		LD	A,(_WIDTH)
  DDA9  95            		SUB	L
  DDAA  6F            		LD	L,A
  DDAB                	C08X1:
  DDAB  ED4B8EEF      		LD	BC,(_TXADR)
  DDAF                	LINECL:
  DDAF  2620          		LD	H,020H
  DDB1  3A96EF        		LD	A,(_COLORF)
  DDB4  CBE8          		SET	5,B
  DDB6                	LINECL1:
  DDB6  CBD8          		SET	3,B
  DDB8  CBE0          		SET	4,B
  DDBA  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令	kanji
  DDBC  CB98          		RES	3,B
  DDBE  ED61          		OUT	(C),H		;Text
  DDC0  CBA0          		RES	4,B
  DDC2  ED79          		OUT	(C),A		;Color
  DDC4  03            		INC	BC
  DDC5  2D            		DEC	L
  DDC6  20EE          		JR	NZ,LINECL1
  DDC8  C9            		RET
                      	
  DDC9                	CTRL0D:
  DDC9  CDD3EF        		CALL	_POS
  DDCC  2E00          		LD	L,0
  DDCE                	LOC:
  DDCE  C5            		PUSH	BC
  DDCF  E5            		PUSH	HL
  DDD0  CD12DD        		CALL	KANCLR
  DDD3  CDF1DD        		CALL	LOC1
  DDD6  228EEF        		LD	(_TXADR),HL
  DDD9  E1            		POP	HL
  DDDA  C1            		POP	BC
  DDDB  C9            		RET
                      	
  DDDC                	CTRL12:
  DDDC  2198DC        		LD	HL,INSFLG
  DDDF  7E            		LD	A,(HL)
  DDE0  EECC          		XOR	0CCH		;CD:CALL ???? 1:LD BC,????
  DDE2  77            		LD	(HL),A
  DDE3  C9            		RET
                      	
  DDE4                	CTRL0B:
  DDE4  210000        		LD	HL,0
  DDE7  228EEF        		LD	(_TXADR),HL
  DDEA  C9            		RET
                      	
  DDEB                	CTRL1B:
  DDEB  3E01          		LD	A,1
  DDED  328FDC        		LD	(ESCFLG+1),A
  DDF0  C9            		RET
                      	
  DDF1                	LOC1:
  DDF1  D5            		PUSH	DE
  DDF2  4D            		LD	C,L
  DDF3  0608          		LD	B,8
  DDF5  5C            		LD	E,H
  DDF6  1600          		LD	D,0
  DDF8  2AB0EF        		LD	HL,(CRTCD)
  DDFB  6A            		LD	L,D
  DDFC                	LOC2:
  DDFC  29            		ADD	HL,HL
  DDFD  3001          		JR	NC,LOC3
  DDFF  19            		ADD	HL,DE
  DE00                	LOC3:
  DE00  10FA          		DJNZ	LOC2
  DE02  09            		ADD	HL,BC
  DE03  D1            		POP	DE
  DE04  C9            		RET
                      	
  DE05                	CONOUT1:
  DE05  CD17DE        		CALL	CURSOR
  DE08  59            		LD	E,C
  DE09  CDCDEF        		CALL	_PRINT
  DE0C  7B            		LD	A,E
  DE0D  FE0A          		CP	00AH
  DE0F  2006          		JR	NZ,CURSOR
  DE11  CDC9DD        		CALL	CTRL0D
  DE14  CDA3DD        		CALL	CTRL05
  DE17                	CURSOR:
  DE17  C5            		PUSH	BC
  DE18  ED4B8EEF      		LD	BC,(_TXADR)
  DE1C  CBE8          		SET	5,B
  DE1E  ED78          		IN	A,(C)
  DE20  EE18          		XOR	018H
  DE22  ED79          		OUT	(C),A
  DE24  C1            		POP	BC
  DE25  C9            		RET
                      	
  DE26                	CTRL07:
  DE26  2161EF        		LD	HL,BEEPD
  DE29                	BEEP1:
  DE29  7E            		LD	A,(HL)
  DE2A  23            		INC	HL
  DE2B  FEFF          		CP	0FFH
  DE2D  C8            		RET	Z
  DE2E  F3            		DI
  DE2F  061C          		LD	B,01CH
  DE31  ED79          		OUT	(C),A
  DE33  EDA3          		OUTI
  DE35  FB            		EI
  DE36  18F1          		JR	BEEP1
                      	
  DE38                	OT49SB:
  DE38  C5            		PUSH	BC
  DE39  CD54DE        		CALL	CANW
  DE3C  010019        		LD	BC,01900H
  DE3F  ED79          		OUT	(C),A
  DE41  C1            		POP	BC
  DE42  C9            		RET
                      	
  DE43                	IN49SB:
  DE43  C5            		PUSH	BC
  DE44  01011A        		LD	BC,01A01H
  DE47                	CANR:
  DE47  ED78          		IN	A,(C)
  DE49  E620          		AND	020H
  DE4B  20FA          		JR	NZ,CANR
  DE4D  010019        		LD	BC,01900H
  DE50  ED78          		IN	A,(C)
  DE52  C1            		POP	BC
  DE53  C9            		RET
                      	
  DE54                	CANW:
  DE54  01011A        		LD	BC,01A01H
  DE57  ED48          		IN	C,(C)
  DE59  CB71          		BIT	6,C
  DE5B  20F7          		JR	NZ,CANW
  DE5D  C9            		RET
                      	
  DE5E                	COMOUT:
  DE5E  FB            		EI
  DE5F  CD38DE        		CALL	OT49SB
  DE62  CD54DE        		CALL	CANW
  DE65  F3            		DI
  DE66  C9            		RET
                      	
  DE67                	INSERT:
  DE67  D5            		PUSH	DE
  DE68  CDD3EF        		CALL	_POS
  DE6B  3AB1EF        		LD	A,(_WIDTH)
  DE6E  95            		SUB	L
  DE6F  ED4B8EEF      		LD	BC,(_TXADR)
  DE73  110020        		LD	DE,02000H	;D:Text E:Kanji
  DE76  2A96EF        		LD	HL,(_COLORF)	;L:Color
  DE79  CBE8          		SET	5,B
  DE7B                	C12X1:
  DE7B  CD83DE        		CALL	C12S
  DE7E  03            		INC	BC
  DE7F  20FA          		JR	NZ,C12X1
  DE81  D1            		POP	DE
  DE82  C9            		RET
                      	
  DE83                	C12S:
  DE83  CBE0          		SET	4,B
  DE85  CBD8          		SET	3,B
  DE87  ED60          		IN	H,(C)
  DE89  ED59          	X1PAT:	OUT	(C),E
  DE8B  5C            		LD	E,H
  DE8C  CB98          		RES	3,B
  DE8E  ED60          		IN	H,(C)
  DE90  ED51          		OUT	(C),D
  DE92  54            		LD	D,H
  DE93  CBA0          		RES	4,B
  DE95  ED60          		IN	H,(C)
  DE97  ED69          		OUT	(C),L
  DE99  6C            		LD	L,H
  DE9A  3D            		DEC	A
  DE9B  C9            		RET
                      	
  DE9C                	CTRL0C:
  DE9C  CDE4DD        		CALL	CTRL0B
  DE9F                	CTRL06:
  DE9F  ED4B8EEF      		LD	BC,(_TXADR)
  DEA3                	C1AX1:
  DEA3  78            		LD	A,B
  DEA4  F638          		OR	038H
  DEA6  47            		LD	B,A
  DEA7  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令	kanji
  DEA9  CB98          		RES	3,B
  DEAB  3E20          		LD	A,020H
  DEAD  ED79          		OUT	(C),A		;Text
  DEAF  CBA0          		RES	4,B
  DEB1  3A96EF        		LD	A,(_COLORF)
  DEB4  ED79          		OUT	(C),A		;Color
  DEB6  03            		INC	BC
  DEB7  CBA8          		RES	5,B
  DEB9  2ABAEF        		LD	HL,(_PAGE_MINUS)
  DEBC  09            		ADD	HL,BC
  DEBD  30E4          		JR	NC,C1AX1
  DEBF  C9            		RET
                      	
  DEC0                	CTRL04:
  DEC0  CDD3EF        		CALL	_POS
  DEC3  7D            		LD	A,L
  DEC4  B7            		OR	A
  DEC5  C8            		RET	Z
  DEC6                	CTRL03:
  DEC6  CDC9DD        		CALL	CTRL0D
  DEC9                	CTRL0A:
  DEC9                	CTRL1F:
  DEC9  ED4B8EEF      		LD	BC,(_TXADR)
  DECD  2AB1EF        		LD	HL,(_WIDTH)
  DED0  2600          		LD	H,0
  DED2  09            		ADD	HL,BC
  DED3  44            		LD	B,H
  DED4  4D            		LD	C,L
  DED5  2ABAEF        		LD	HL,(_PAGE_MINUS)
  DED8  09            		ADD	HL,BC
  DED9  3F            		CCF
  DEDA  9F            		SBC	A,A
  DEDB  C33DDD        		JP	PRINTE8
                      	
  DEDE                	CTRL0E:
  DEDE  CDD3EF        		CALL	_POS
  DEE1  7C            		LD	A,H
  DEE2  1804          		JR	SCR1
  DEE4                	SCR:
  DEE4  3A97EF        		LD	A,(_LINE)
  DEE7  3D            		DEC	A
  DEE8                	SCR1:
  DEE8  C5            		PUSH	BC
  DEE9  D5            		PUSH	DE
  DEEA  F5            		PUSH	AF
  DEEB  3E07          		LD	A,7
  DEED  211EDF        		LD	HL,SCRDMAD
  DEF0  CD14DF        		CALL	SETDMA
  DEF3  F1            		POP	AF
  DEF4  210038        		LD	HL,03800H
                      	
  DEF7                	SCRUP1:
  DEF7  B7            		OR	A
  DEF8  284D          		JR	Z,SCRCL
  DEFA  F5            		PUSH	AF
  DEFB  CD25DF        		CALL	UPSUB		;kanji
  DEFE  3ABCEF        		LD	A,(_WIDTH_MINUS)
  DF01  5F            		LD	E,A
  DF02  16F7          		LD	D,0F7H
  DF04  19            		ADD	HL,DE
  DF05  D5            		PUSH	DE
  DF06  CD25DF        		CALL	UPSUB		;Text
  DF09  D1            		POP	DE
  DF0A  19            		ADD	HL,DE
  DF0B  CD25DF        		CALL	UPSUB		;Color
  DF0E  CBE4          		SET	4,H
  DF10  F1            		POP	AF
  DF11  3D            		DEC	A
  DF12  18E3          		JR	SCRUP1
                      	
  DF14                	SETDMA:
  DF14  01871F        		LD	BC,01F87H
  DF17                	SDMA:
  DF17  04            		INC	B
  DF18  EDA3          		OUTI
  DF1A  3D            		DEC	A
  DF1B  20FA          		JR	NZ,SDMA
  DF1D  C9            		RET
                      	
  DF1E                	SCRDMAD:
  DF1E  C3            		DB	0C3H		;WR6 リセット
  DF1F  9A            		DB	09AH		;WR5 ストップ WAIT READY:HIGH
  DF20  65            		DB	065H		;WR0 ブロック長(LH)
  DF21  4F00          		DW	79
  DF23  1C            		DB	01CH		;WR1 ポートAインクリメント I/O
  DF24  18            		DB	018H		;WR0 ポートAアドレス(LH)
                      	
  DF25                	UPSUB:
  DF25  3AB1EF        		LD	A,(_WIDTH)
  DF28  5F            		LD	E,A
  DF29  1600          		LD	D,0
  DF2B  3ECD          		LD	A,0CDH		;WR4 バースト ポートB開始アドレス(LH)
  DF2D  ED79          		OUT	(C),A
  DF2F  ED69          		OUT	(C),L		;SOURCE
  DF31  ED61          		OUT	(C),H
  DF33  19            		ADD	HL,DE
  DF34  3E1D          		LD	A,01DH		;WR0 ポートA開始アドレス(LH) ポートA→ポートB 転送
  DF36  ED79          		OUT	(C),A
  DF38  ED69          		OUT	(C),L		;DEST
  DF3A  ED61          		OUT	(C),H
  DF3C                	GO_DMA:
  DF3C  3ECF          		LD	A,0CFH
  DF3E  ED79          		OUT	(C),A		;WR6 ロード
  DF40  3EB3          		LD	A,0B3H
  DF42  ED79          		OUT	(C),A		;WR6 強制RDY
  DF44  ED49          		OUT	(C),C		;WR6 イネーブル
  DF46  C9            		RET
                      	
  DF47                	SCRCL:
  DF47  44            		LD	B,H
  DF48  4D            		LD	C,L
  DF49  2AB1EF        		LD	HL,(_WIDTH)
  DF4C  CDAFDD        		CALL	LINECL
  DF4F  D1            		POP	DE
  DF50  C1            		POP	BC
  DF51  C9            		RET
                      	
  DF52                	SCRN:
  DF52  D5            		PUSH	DE
  DF53  ED58          		IN	E,(C)		;Text
  DF55  3A1800        		LD	A,(00018H)
  DF58  3C            		INC	A
  DF59  281E          		JR	Z,SCRN2
  DF5B  CBD8          		SET	3,B
  DF5D  ED50          		IN	D,(C)		;Kanji
  DF5F  2816          		JR	Z,SCRN1
  DF61  AF            		XOR	A
  DF62  C5            		PUSH	BC
  DF63  013730        		LD	BC,03037H	;VRMJIS
  DF66  DF            		RST	018H
  DF67  01522F        		LD	BC,02F52H	;JISSFT
  DF6A  DF            		RST	018H
  DF6B  C1            		POP	BC
  DF6C  ED78          		IN	A,(C)
  DF6E  CB98          		RES	3,B
  DF70  E640          		AND	040H
  DF72  2005          		JR	NZ,SCRN2
  DF74  7A            		LD	A,D
  DF75  D1            		POP	DE
  DF76  C9            		RET
  DF77                	SCRN1:
  DF77  CB98          		RES	3,B
  DF79                	SCRN2:
  DF79  7B            		LD	A,E
  DF7A  D1            		POP	DE
  DF7B  C9            		RET
  DF7C                	SCRNE:
  DF7C                	POS:
  DF7C  2A8EEF        		LD	HL,(_TXADR)
  DF7F  C5            		PUSH	BC
  DF80  ED4BBCEF      		LD	BC,(_WIDTH_MINUS)
  DF84  AF            		XOR	A
  DF85                	POS1:
  DF85  09            		ADD	HL,BC
  DF86  3C            		INC	A
  DF87  38FC          		JR	C,POS1
  DF89  ED42          		SBC	HL,BC
  DF8B  3D            		DEC	A
  DF8C  67            		LD	H,A
  DF8D  C1            		POP	BC
  DF8E  A7            		AND	A
  DF8F  C9            		RET
                      	
  DF90                	GETL:
  DF90  CDD3EF        		CALL	_POS
  DF93  E5            		PUSH	HL
  DF94  3ECD          		LD	A,0CDH		;CALL ????
  DF96  3298DC        		LD	(INSFLG),A
  DF99                	GETL1:
  DF99  CD51DB        		CALL	_SYS08
  DF9C  FE09          		CP	9
  DF9E  2008          		JR	NZ,GETL1V
  DFA0  2100FF        		LD	HL,KBUF
  DFA3  CDF5D7        		CALL	MSX
  DFA6  18F1          		JR	GETL1
  DFA8                	GETL1V:
  DFA8  5F            		LD	E,A
  DFA9  CDCDEF        		CALL	_PRINT
                      	
  DFAC  7B            		LD	A,E
  DFAD  FE0D          		CP	00DH
  DFAF  20E8          		JR	NZ,GETL1
  DFB1  3E01          		LD	A,1		;LD BC,????
  DFB3  3298DC        		LD	(INSFLG),A
  DFB6  1100FF        		LD	DE,KBUF
  DFB9  3AB1EF        		LD	A,(_WIDTH)
  DFBC  47            		LD	B,A
  DFBD  CDE8D4        		CALL	ZERO_MEMORY_DE
                      	
  DFC0  D1            		POP	DE
  DFC1  CDD3EF        		CALL	_POS
  DFC4  6B            		LD	L,E
  DFC5  3AB1EF        		LD	A,(_WIDTH)
  DFC8  95            		SUB	L
  DFC9  57            		LD	D,A
  DFCA  CDF1DD        		CALL	LOC1
  DFCD  4D            		LD	C,L
  DFCE  7C            		LD	A,H
  DFCF  F630          		OR	030H
  DFD1  47            		LD	B,A
  DFD2  5A            		LD	E,D
  DFD3  2100FF        		LD	HL,KBUF
  DFD6                	GETL2:
  DFD6  CDD0EF        		CALL	_SCRN
  DFD9  03            		INC	BC
  DFDA  77            		LD	(HL),A
  DFDB  23            		INC	HL
  DFDC  1D            		DEC	E
  DFDD  20F7          		JR	NZ,GETL2
  DFDF                	GETL3:
  DFDF  2B            		DEC	HL
  DFE0  7E            		LD	A,(HL)
  DFE1  FE21          		CP	021H
  DFE3  D0            		RET	NC
  DFE4  3600          		LD	(HL),0
  DFE6  15            		DEC	D
  DFE7  20F6          		JR	NZ,GETL3
  DFE9  C9            		RET
                      	
  DFEA                	INKEY:
  DFEA  FB            		EI
  DFEB  E5            		PUSH	HL
  DFEC  2A90EF        		LD	HL,(_KEYPS)
  DFEF  7C            		LD	A,H
  DFF0  AD            		XOR	L
  DFF1  2809          		JR	Z,INKEY1
  DFF3  7C            		LD	A,H
  DFF4  3C            		INC	A
  DFF5  3291EF        		LD	(_KEYPS+1),A
  DFF8  6F            		LD	L,A
  DFF9  26FE          		LD	H,KEYBF/256
  DFFB  7E            		LD	A,(HL)
  DFFC                	INKEY1:
  DFFC  E1            		POP	HL
  DFFD  B7            		OR	A
  DFFE  C9            		RET
                      	
  0FDA                	AT_RS	EQU	SCR1-AT_SCR1
                      	
                      	;LDFILE.ASM
                      	
                      	;	LSX-Dodgers FILE
                      	
  DFFF                	FILEC:
  DFFF  CD0AE0        		CALL	FILE
  E002                	FILEC2:
  E002  3A15EF        		LD	A,(FDRV+1)
  E005  FE20          		CP	020H
  E007  C8            		RET	Z
  E008  1839          		JR	SETDIR1
                      	
  E00A                	FILE:
  E00A  AF            		XOR	A
  E00B  3214EF        		LD	(FDRV),A
  E00E  67            		LD	H,A
  E00F  6F            		LD	L,A
  E010  2222EF        		LD	(FDRV+14),HL
  E013  CDE1E0        		CALL	SPCUT
  E016  CDC6E0        		CALL	CCHK3
  E019  2812          		JR	Z,DEVI1
  E01B  13            		INC	DE
  E01C  1A            		LD	A,(DE)
  E01D  1B            		DEC	DE
  E01E  FE3A          		CP	':'
  E020  200B          		JR	NZ,DEVI1
  E022  1A            		LD	A,(DE)		;DRIVE
  E023  CD16E3        		CALL	CAP
  E026  D640          		SUB	'@'
  E028  13            		INC	DE
  E029  13            		INC	DE
  E02A  3214EF        		LD	(FDRV),A
  E02D                	DEVI1:
  E02D  1A            		LD	A,(DE)
  E02E  D65C          		SUB	05CH		;\
  E030  2009          		JR	NZ,NOROOT
  E032  6F            		LD	L,A		;A=0でH=0のはずなのでHL=0
  E033  222EEF        		LD	(FDRV+26),HL
  E036  2C            		INC	L
  E037  2222EF        		LD	(FDRV+14),HL
  E03A  13            		INC	DE
  E03B                	NOROOT:
                      	
  E03B                	SETDIR:
  E03B  CD67E0        		CALL	FILED
  E03E  1A            		LD	A,(DE)
  E03F  FE5C          		CP	05CH		;\
  E041  C0            		RET	NZ
  E042  13            		INC	DE
  E043                	SETDIR1:
  E043  3E10          		LD	A,010H		;Directory
  E045  3221EF        		LD	(FDRV+13),A
  E048  D5            		PUSH	DE
  E049  1114EF        		LD	DE,FDRV
  E04C  2A1EF0        		LD	HL,(STABLE+2*00FH)
  E04F  CD0F00        		CALL	JP_HL
  E052  D1            		POP	DE
  E053  B7            		OR	A
  E054  C0            		RET	NZ
                      	
  E055  3A21EF        		LD	A,(FDRV+13)
  E058  CB67          		BIT	4,A
  E05A  C8            		RET	Z
                      	
  E05B  CDAEE0        		CALL	FILEI
  E05E  2A2EEF        		LD	HL,(FDRV+26)
  E061  23            		INC	HL
  E062  2222EF        		LD	(FDRV+14),HL
  E065  18D4          		JR	SETDIR
                      	
  E067                	FILED:
  E067  CDAEE0        		CALL	FILEI
  E06A  2115EF        		LD	HL,FNAME
                      	
  E06D  0608          		LD	B,8
  E06F                	FILE2:
  E06F  CDBBE0        		CALL	CCHKF
  E072  C8            		RET	Z
  E073  FE2A          		CP	'*'
  E075  282E          		JR	Z,FILE9
  E077  FE2E          		CP	'.'
  E079  280C          		JR	Z,FILE4
  E07B  77            		LD	(HL),A
  E07C  23            		INC	HL
  E07D  10F0          		DJNZ	FILE2
                      	
  E07F                	FILE3:
  E07F  CDBBE0        		CALL	CCHKF
  E082  C8            		RET	Z
  E083  FE2E          		CP	'.'
  E085  20F8          		JR	NZ,FILE3
                      	
  E087                	FILE4:
  E087  211DEF        		LD	HL,FNAME+8
  E08A  0603          		LD	B,3
                      	
  E08C                	FILE4L:
  E08C  CDBBE0        		CALL	CCHKF
  E08F  C8            		RET	Z
  E090  FE2E          		CP	'.'
  E092  2008          		JR	NZ,FILE12
  E094  3215EF        		LD	(FNAME),A	;Parent directory(..)
  E097  3216EF        		LD	(FNAME+1),A
  E09A  3E20          		LD	A,020H
  E09C                	FILE12:
  E09C  FE2A          		CP	'*'
  E09E  280A          		JR	Z,FILE10
  E0A0  77            		LD	(HL),A
  E0A1  23            		INC	HL
  E0A2  10E8          		DJNZ	FILE4L
  E0A4  C9            		RET
                      	
  E0A5                	FILE9:				;名前の*処理、名前の残りを?で埋める
  E0A5  CDAAE0        		CALL	FILE10
  E0A8  18D5          		JR	FILE3
                      	
  E0AA                	FILE10:
  E0AA  3E3F          		LD	A,'?'
  E0AC  1808          		JR	FILL_MEMORY
  E0AE                	FILEI:				;名前＋拡張子をスペースで初期化
  E0AE  3E20          		LD	A,020H
  E0B0  01000B        		LD	BC,11*256	;C=0にしておく
  E0B3  2115EF        		LD	HL,FNAME
  E0B6                	FILL_MEMORY:			;HLからBバイトAで埋める
  E0B6  77            		LD	(HL),A
  E0B7  23            		INC	HL
  E0B8  10FC          		DJNZ	FILL_MEMORY
  E0BA  C9            		RET
                      	
  E0BB                	CCHKF:
  E0BB  1A            		LD	A,(DE)
  E0BC  CDC3E0        		CALL	CCHK2
  E0BF  C8            		RET	Z
  E0C0  C32EE4        		JP	FKAN
                      	
  E0C3                	CCHK2:
  E0C3  0C            		INC	C
  E0C4  0D            		DEC	C
  E0C5  C0            		RET	NZ
  E0C6                	CCHK3:				;ZF=1 で使えない文字
  E0C6  FE2B          		CP	'+'
  E0C8  C8            		RET	Z
  E0C9  FE2C          		CP	','
  E0CB  C8            		RET	Z
  E0CC  FE2F          		CP	'/'
  E0CE  C8            		RET	Z
  E0CF  FE3A          		CP	':'
  E0D1  C8            		RET	Z
  E0D2  FE3B          		CP	';'
  E0D4  C8            		RET	Z
  E0D5  FE3D          		CP	'='
  E0D7  C8            		RET	Z
  E0D8  FE5C          		CP	05CH	;\
  E0DA  C8            		RET	Z
  E0DB  FE20          		CP	020H
  E0DD  D0            		RET	NC
  E0DE  BF            		CP	A		;Z=1
  E0DF  C9            		RET
                      	
  E0E0                	SS1:
  E0E0  13            		INC	DE
  E0E1                	SPCUT:				;スペースをカット
  E0E1  1A            		LD	A,(DE)
  E0E2  FE20          		CP	020H
  E0E4  28FA          		JR	Z,SS1
  E0E6  C9            		RET
                      	
  E0E7                	SETDRVF:
  E0E7  1114EF        		LD	DE,FDRV
  E0EA                	SETDRV0:
  E0EA  CDF3E0        		CALL	SETDRV
  E0ED  FDE1          		POP	IY
  E0EF  C1            		POP	BC
  E0F0  D1            		POP	DE
  E0F1  E1            		POP	HL
  E0F2  C9            		RET
                      	
  E0F3                	SETDRV:
  E0F3  E3            		EX	(SP),HL		;HL=RETRN ADDRESS
  E0F4  D5            		PUSH	DE		;PUSH HL/DE/BC/IY
  E0F5  C5            		PUSH	BC
  E0F6  1A            		LD	A,(DE)
  E0F7  D5            		PUSH	DE
  E0F8  FDE3          		EX	(SP),IY
                      	
  E0FA  CD06E1        		CALL	GETDRV
  E0FD  3C            		INC	A
  E0FE  FD7700        		LD	(IY+0),A	;(FCB)ドライブ番号
  E101  3D            		DEC	A
  E102  CDD9EF        		CALL	_CHGDRV
                      	
  E105  E9            		JP	(HL)
                      	
  E106                	GETDRV:
  E106  E67F          		AND	07FH
  E108  D601          		SUB	001H
  E10A  3003          		JR	NC,GETDRV1
  E10C  3A87EF        		LD	A,(_DVSW)	;Current Drive
  E10F                	GETDRV1:
  E10F  3288EF        		LD	(_DRV),A
  E112  C9            		RET
                      	
  E113                	SOPENX:
  E113  1139EF        		LD	DE,SFILE
  E116  1A            		LD	A,(DE)
  E117  FDBE00        		CP	(IY+0)		;(FCB)ドライブ番号
  E11A  2024          		JR	NZ,SOPEN
  E11C  13            		INC	DE
  E11D  FDE5          		PUSH	IY
  E11F  E1            		POP	HL
  E120  23            		INC	HL
  E121  CDAEE2        		CALL	CPFILE
  E124  201A          		JR	NZ,SOPEN
                      	
  E126  2AF4F0        		LD	HL,(SCDIR)
  E129  FD750E        		LD	(IY+14),L	;(FCB)アクセスするディレクトリのクラスタ番号+1
  E12C  FD740F        		LD	(IY+15),H
                      	
  E12F  2AF8F0        		LD	HL,(SFNDF)	;Direcroty location and Flags
  E132  229FEF        		LD	(_FILEN),HL
                      	
  E135  ED5BF6F0      		LD	DE,(SFBPS)
  E139  2139EF        		LD	HL,SFILE
  E13C  36FF          		LD	(HL),0FFH
  E13E  23            		INC	HL
  E13F  C9            		RET
  E140                	SOPEN:
  E140  2156E2        		LD	HL,FILESE
  E143                	SOPENC:
  E143  227CE1        		LD	(OPENPAT+1),HL
                      	
  E146  CDE2EF        		CALL	_RDFATX		;Detect Media
  E149  3856          		JR	C,RDDERR
                      	
  E14B  AF            		XOR	A
  E14C  329FEF        		LD	(_FILEN),A
  E14F  CD5BE3        		CALL	LDDIRX1		;A=0で呼び出す
  E152  2818          		JR	Z,SDIRX1
                      	
  E154  CD47E2        		CALL	READ_DIR	;Sub Directory
  E157  3808          		JR	C,SDIRX0
  E159  2A7EF0        		LD	HL,(_DTBUF)
  E15C  7E            		LD	A,(HL)
  E15D  FE2E          		CP	'.'
  E15F  280F          		JR	Z,SOPEN1
  E161                	SDIRX0:
  E161  AF            		XOR	A
  E162  32A0EF        		LD	(_DIRF),A
  E165  FD360E01      		LD	(IY+14),1	;(FCB)レコードサイズ
  E169  FD770F        		LD	(IY+15),A
  E16C                	SDIRX1:
  E16C  ED5BFCF0      		LD	DE,(_DIRPS)	;Root Directory
  E170                	SOPEN1:
  E170  0E20          	SDECPAT:LD	C,32		;自己書き換え 1セクタ辺りのディレクトリエントリ数  1024=32 / 512=16 / 256=8
  E172                	SOPEN1X:
  E172  CD47E2        		CALL	READ_DIR	;FILE SEARCH
  E175  382A          		JR	C,RDDERR
  E177  2A7EF0        		LD	HL,(_DTBUF)
  E17A                	SOPEN2:
  E17A  D5            		PUSH	DE
  E17B  CD56E2        	OPENPAT:CALL	FILESE		;(self-modifying code)
  E17E  D1            		POP	DE
  E17F  386E          		JR	C,SOPENE
  E181  281B          		JR	Z,SCF_FF_RET
  E183                	SOPEN3:
  E183  3AA0EF        		LD	A,(_DIRF)	;ディレクトリか判別
  E186  B7            		OR	A
  E187  200C          		JR	NZ,SOPEN5
  E189  13            		INC	DE		;ルートディレクトリ
  E18A  E5            		PUSH	HL
  E18B  210C00        	MD_PAT:	LD	HL,12		;(self-modifying code)MAXDIR
  E18E  ED52          		SBC	HL,DE		;CF=0 なので SUB HL,DE
  E190  E1            		POP	HL
  E191  20DD          		JR	NZ,SOPEN1
  E193  1807          		JR	SOPEN6
  E195                	SOPEN5:
  E195  CD8AEA        		CALL	GNCLX		;END DIR
  E198  D8            		RET	C
  E199  CD0EE3        		CALL	ENDCL
  E19C                	SOPEN6:
  E19C  38D2          		JR	C,SOPEN1
  E19E                	SCF_FF_RET:
  E19E  37            		SCF			;CF=1
  E19F  9F            		SBC	A,A		;A=0FFH
  E1A0  C9            		RET
                      	
  E1A1                	RDDERR:
  E1A1  BF            		CP	A		;READ ERR CF=1 ZF=1
  E1A2  37            		SCF
  E1A3  C9            		RET
                      	
  E1A4                	NOPEN:
  E1A4  2156E2        		LD	HL,FILESE
  E1A7  227CE1        		LD	(OPENPAT+1),HL
  E1AA  FD2A98EF      		LD	IY,(_FCB)
  E1AE  CD41E4        		CALL	CHKWILDX
  E1B1  30EB          		JR	NC,SCF_FF_RET
  E1B3  FD7E00        		LD	A,(IY+0)	;(FCB)ドライブ番号
  E1B6  3D            		DEC	A
  E1B7  3288EF        		LD	(_DRV),A
  E1BA  CDD9EF        		CALL	_CHGDRV
  E1BD  D8            		RET	C
  E1BE  2AF8F0        		LD	HL,(SFNDF)	;Direcroty location and Flags
  E1C1  229FEF        		LD	(_FILEN),HL
                      	
  E1C4  CD56E3        		CALL	LDDIRX
  E1C7  ED5B9AEF      		LD	DE,(_FBPS)
  E1CB  CD47E2        		CALL	READ_DIR
  E1CE  38D1          		JR	C,RDDERR
  E1D0  3A9EEF        		LD	A,(_FBCNT)
  E1D3  3D            		DEC	A
  E1D4  28AD          		JR	Z,SOPEN3
  E1D6                	NOPEN2:
  E1D6  2A9CEF        		LD	HL,(_FBAD)
  E1D9  012000        		LD	BC,020H
  E1DC  09            		ADD	HL,BC
  E1DD  4F            		LD	C,A
  E1DE  189A          		JR	SOPEN2
                      	
  E1E0                	SOPENE2:
  E1E0  229CEF        		LD	(_FBAD),HL
  E1E3  79            		LD	A,C
  E1E4  329EEF        		LD	(_FBCNT),A
  E1E7  ED539AEF      		LD	(_FBPS),DE
  E1EB  FD2298EF      		LD	(_FCB),IY
  E1EF                	SOPENE:
  E1EF  AF            		XOR	A
  E1F0  C9            		RET
                      	
  E1F1                	COPEN:
  E1F1  FD360D20      		LD	(IY+13),020H	;(FCB)属性(アトリビュート)
                      	
  E1F5  2173E2        		LD	HL,NEXTSE
  E1F8  CD43E1        		CALL	SOPENC
  E1FB  D0            		RET	NC
  E1FC  C8            		RET	Z
  E1FD  3AA0EF        		LD	A,(_DIRF)	;ディレクトリか判別
  E200  B7            		OR	A
  E201  37            		SCF
  E202  C8            		RET	Z		;ルートディレクトリ
  E203  0601          		LD	B,1
  E205  CD9FE4        		CALL	WRDF
  E208  D8            		RET	C
  E209  ED5BFEF0      		LD	DE,(_CLPS)
  E20D  D5            		PUSH	DE
  E20E  CDD7E2        		CALL	DCPAT
  E211  CD15E9        		CALL	DRDNX
  E214  2A7EF0        		LD	HL,(_DTBUF)	;ディレクトリエントリを0クリア
  E217  3A13E8        		LD	A,(SECSZ+2)	;1024=4 / 512=2 / 256=1
  E21A  47            		LD	B,A
  E21B  AF            		XOR	A
  E21C  4F            		LD	C,A
  E21D                	COPENCL:
  E21D  77            		LD	(HL),A
  E21E  EDA1          		CPI			;HL=HL+1 BC=BC-1 BCが0の場合にP/V=0
  E220  EA1DE2        		JP	PE,COPENCL
                      	
  E223  3AF5E2        		LD	A,(SPCPAT+1)	;1クラスタの論理セクタ数
  E226  3D            		DEC	A
  E227  2819          		JR	Z,COPENE
  E229  3E01          		LD	A,1		;1セクタ辺りのセクタ数が2以上の場合
  E22B  3282EA        		LD	(_SECPS+1),A
  E22E  D1            		POP	DE		;DE=(_CLPS)
  E22F  D5            		PUSH	DE
  E230                	COPEN1:
  E230  D5            		PUSH	DE		;データバッファに入らないセクタもゼロクリア
  E231  C5            		PUSH	BC
  E232  2A7EF0        		LD	HL,(_DTBUF)
  E235  CDF1E2        		CALL	CLUSTX
  E238  CDEDEB        		CALL	DWT24
  E23B  C1            		POP	BC
  E23C  D1            		POP	DE
  E23D  CD81EA        		CALL	NEXTX
  E240  20EE          		JR	NZ,COPEN1
  E242                	COPENE:
  E242  2A7EF0        		LD	HL,(_DTBUF)
  E245  D1            		POP	DE
  E246  C9            		RET
                      	
  E247                	READ_DIR:
  E247  ED53FEF0      		LD	(_CLPS),DE
  E24B  C5            		PUSH	BC
  E24C  D5            		PUSH	DE
  E24D  CDD7E2        		CALL	DCPAT
  E250  CDF5E8        		CALL	DRDX
  E253  D1            		POP	DE
  E254  C1            		POP	BC
  E255  C9            		RET
                      	
  E256                	FILESE:
  E256  7E            		LD	A,(HL)
  E257  B7            		OR	A
  E258  C8            		RET	Z		;END:ZF=1 CF=0
  E259  FEE5          		CP	0E5H
  E25B  280E          		JR	Z,FILESE1
  E25D  FDE5          		PUSH	IY
  E25F  D1            		POP	DE
  E260  13            		INC	DE
  E261  E5            		PUSH	HL
  E262  CDAEE2        		CALL	CPFILE
  E265  CCCFE2        		CALL	Z,CPFILE2
  E268  E1            		POP	HL
  E269  37            		SCF
  E26A  C8            		RET	Z		;!!!:(ZF=1) CF=1
  E26B                	FILESE1:
  E26B  CD82E2        		CALL	FNEXT
  E26E  20E6          		JR	NZ,FILESE
  E270                	ZF0_CF0_AFF_RET:
  E270  F6FF          		OR	0FFH		;ZF=0 CF=0
  E272  C9            		RET
                      	
  E273                	NEXTSE:
  E273  7E            		LD	A,(HL)
  E274  B7            		OR	A
  E275  37            		SCF
  E276  C8            		RET	Z		;!!!:ZF=1 CF=1
  E277  FEE5          		CP	0E5H
  E279  37            		SCF
  E27A  C8            		RET	Z		;!!!:(ZF=1) CF=1
  E27B  CD82E2        		CALL	FNEXT
  E27E  20F3          		JR	NZ,NEXTSE
  E280  18EE          		JR	ZF0_CF0_AFF_RET
                      	
  E282                	FNEXT:
  E282  E5            		PUSH	HL
  E283  219FEF        		LD	HL,_FILEN
  E286  34            		INC	(HL)
  E287  E1            		POP	HL
  E288  112000        		LD	DE,020H
  E28B  19            		ADD	HL,DE
  E28C  0D            		DEC	C
  E28D  C9            		RET
                      	
  E28E                	CPNAME:
  E28E  C5            		PUSH	BC
  E28F  D5            		PUSH	DE
  E290  E5            		PUSH	HL
  E291  CDA8E2        		CALL	CPFILE4
  E294  E1            		POP	HL
  E295  23            		INC	HL
  E296  23            		INC	HL
  E297  23            		INC	HL
  E298  23            		INC	HL
  E299  D1            		POP	DE
  E29A  C1            		POP	BC
  E29B  2005          		JR	NZ,CPNAME1
  E29D  7E            		LD	A,(HL)
  E29E  23            		INC	HL
  E29F  66            		LD	H,(HL)
  E2A0  6F            		LD	L,A
  E2A1  C9            		RET
  E2A2                	CPNAME1:
  E2A2  23            		INC	HL
  E2A3  23            		INC	HL
  E2A4  10E8          		DJNZ	CPNAME
  E2A6  37            		SCF
  E2A7  C9            		RET
                      	
  E2A8                	CPFILE4:
  E2A8  C5            		PUSH	BC
  E2A9  010004        		LD	BC,00400H
  E2AC  1804          		JR	CPSTR1
  E2AE                	CPFILE:
  E2AE  C5            		PUSH	BC
  E2AF  01000B        		LD	BC,00B00H
  E2B2                	CPSTR1:
  E2B2  1A            		LD	A,(DE)
  E2B3  FE3F          		CP	'?'		;Wild card
  E2B5  2812          		JR	Z,CPSTR2
  E2B7  7E            		LD	A,(HL)
  E2B8  CD27E4        		CALL	FKANC
  E2BB  E5            		PUSH	HL
  E2BC  67            		LD	H,A
  E2BD  1A            		LD	A,(DE)
  E2BE  CB01          		RLC	C
  E2C0  CD27E4        		CALL	FKANC
  E2C3  CB09          		RRC	C
  E2C5  BC            		CP	H		;CP (HL),(DE)
  E2C6  E1            		POP	HL
  E2C7  2004          		JR	NZ,CPSTR3
  E2C9                	CPSTR2:
  E2C9  13            		INC	DE
  E2CA  23            		INC	HL
  E2CB  10E5          		DJNZ	CPSTR1
  E2CD                	CPSTR3:
  E2CD  C1            		POP	BC
  E2CE  C9            		RET
                      	
  E2CF                	CPFILE2:
  E2CF  FD7E0D        		LD	A,(IY+13)	;(FCB)属性(アトリビュート)
  E2D2  F6E1          		OR	0E1H
  E2D4  2F            		CPL
  E2D5  A6            		AND	(HL)
  E2D6  C9            		RET
                      	
  E2D7                	DCPAT:
  E2D7  0E00          		LD	C,0
  E2D9  2A7EF0        		LD	HL,(_DTBUF)
  E2DC  3AA0EF        		LD	A,(_DIRF)	;ディレクトリか判別
  E2DF  B7            		OR	A
  E2E0  C8            		RET	Z		;ルートディレクトリの場合はCレジスタを0にしておく(CDEがセクタ番号)
  E2E1  3AF5E2        		LD	A,(SPCPAT+1)
  E2E4  4F            		LD	C,A
  E2E5  3A82EA        		LD	A,(_SECPS+1)
  E2E8  B9            		CP	C
  E2E9  3801          		JR	C,DC1
  E2EB  AF            		XOR	A
  E2EC                	DC1:
  E2EC  F680          		OR	080H
  E2EE  32A0EF        		LD	(_DIRF),A	;bit0-6:セクタインデックス
  E2F1                	CLUSTX:
  E2F1  E5            		PUSH	HL
  E2F2  EB            		EX	DE,HL
  E2F3  AF            		XOR	A
  E2F4  0E01          	SPCPAT:	LD	C,1		;自己書き換え（1クラスタの論理セクタ数）
  E2F6                	L_CLDBL:
  E2F6  CB19          		RR	C		;->CF
  E2F8  3804          		JR	C,E_CLDBL
  E2FA  29            		ADD	HL,HL		;*2
  E2FB  8F            		ADC	A,A
  E2FC  18F8          		JR	L_CLDBL
  E2FE                	E_CLDBL:
  E2FE  4F            		LD	C,A
  E2FF  3A82EA        		LD	A,(_SECPS+1)
  E302  B5            		OR	L
  E303  6F            		LD	L,A
  E304  110800        	CLSPAT:	LD	DE,8	;+8 (2D)  !ADDCL (self-modifying code)
  E307  AF            		XOR	A
  E308  19            		ADD	HL,DE	;データ格納領域の先頭論理セクタ番号
  E309  89            		ADC	A,C
  E30A  4F            		LD	C,A
  E30B  EB            		EX	DE,HL
  E30C  E1            		POP	HL
  E30D  C9            		RET
                      	
  E30E                	ENDCL:
  E30E  7A            		LD	A,D	;END CLUSTER
  E30F  FE01          	CLPAT1:	CP	1	;164=356	(self-modifying code)
  E311  C0            		RET	NZ
  E312  7B            		LD	A,E
  E313  FE64          	CLPAT2:	CP	064H	;		(self-modifying code)
  E315  C9            		RET
                      	
  E316                	CAP:
  E316  FE61          		CP	'a'
  E318  D8            		RET	C
  E319  FE7B          		CP	'z'+1
  E31B  D0            		RET	NC
  E31C  D620          		SUB	020H
  E31E  C9            		RET
  E31F                	CAP2:
  E31F  CD16E3        		CALL	CAP
  E322                	CAP3:
  E322  CD2BE3        		CALL	CAP4
  E325  FE21          		CP	021H
  E327  D0            		RET	NC
  E328  3EA0          		LD	A,0A0H
  E32A  C9            		RET
  E32B                	CAP4:
  E32B  FE05          		CP	5
  E32D  C0            		RET	NZ
  E32E  3EE5          		LD	A,0E5H
  E330  C9            		RET
                      	
  E331                	CHDIR:
  E331  CD1BED        		CALL	GETDPBD
  E334  381D          		JR	C,CHDIR2
  E336  DD751A        		LD	(IX+01AH),L		;_SDIR_
  E339  DD741B        		LD	(IX+01BH),H		;_SDIR_+1
  E33C  1815          		JR	CHDIR2		;POP_IX_RET
                      	
  E33E                	LDDIR:
  E33E  CD1BED        		CALL	GETDPBD
  E341  DD5E1A        		LD	E,(IX+01AH)		;_SDIR_
  E344  DD561B        		LD	D,(IX+01BH)		;_SDIR_+1
  E347  13            		INC	DE
  E348  FD730E        		LD	(IY+14),E	;(FCB)アクセスするディレクトリのクラスタ番号+1
  E34B  FD720F        		LD	(IY+15),D
  E34E  1B            		DEC	DE
  E34F  AF            		XOR	A
  E350  32A0EF        		LD	(_DIRF),A
  E353                	CHDIR2:
  E353  DDE1          		POP	IX
  E355  C9            		RET
                      	
  E356                	LDDIRX:
  E356  3AA0EF        		LD	A,(_DIRF)	;(FCB)アクセスするディレクトリのセクタインデックス
  E359  E67F          		AND	07FH
  E35B                	LDDIRX1:
  E35B  3282EA        		LD	(_SECPS+1),A
  E35E  FD5E0E        		LD	E,(IY+14)	;(FCB)アクセスするディレクトリのクラスタ番号+1
  E361  FD560F        		LD	D,(IY+15)
  E364  1B            		DEC	DE
  E365  CD0EE3        		CALL	ENDCL
  E368  D43EE3        		CALL	NC,LDDIR
  E36B                	LDDIRS:
  E36B  7A            		LD	A,D
  E36C  B3            		OR	E
  E36D  32A0EF        		LD	(_DIRF),A	;ディレクトリか判別
  E370  C9            		RET
                      	
  E371                	KILL:
  E371  CD41E4        		CALL	CHKWILDX
  E374  3834          		JR	C,KILLW
  E376  CD13E1        		CALL	SOPENX
  E379                	KILLS:
  E379  3E1F          		LD	A,01FH
  E37B  D4BDE3        		CALL	NC,CHKATT
  E37E  D8            		RET	C
  E37F                	KILLSX:
  E37F  36E5          		LD	(HL),0E5H	;DIR
  E381  CD1BE4        		CALL	WTDB
  E384  111A00        		LD	DE,01AH
  E387  19            		ADD	HL,DE
  E388  5E            		LD	E,(HL)
  E389  23            		INC	HL
  E38A  56            		LD	D,(HL)
  E38B                	KILLS1:
  E38B  CD0EE3        		CALL	ENDCL
  E38E  D0            		RET	NC		;CF=0
  E38F  21FEFF        		LD	HL,0-2
  E392  19            		ADD	HL,DE
  E393  D0            		RET	NC		;DE= 0 or 1
  E394  D5            		PUSH	DE
  E395  CDF7EF        		CALL	_GNCL
  E398  ED53FEF0      		LD	(_CLPS),DE
  E39C  D1            		POP	DE
  E39D  210000        		LD	HL,0
  E3A0  D4FAEF        		CALL	NC,_SNCL
  E3A3  D8            		RET	C
  E3A4  ED5BFEF0      		LD	DE,(_CLPS)	;FAT
  E3A8  18E1          		JR	KILLS1
                      	
  E3AA                	KILLW:
  E3AA  CD40E1        		CALL	SOPEN
  E3AD                	KILLW1:
  E3AD  380B          		JR	C,KILLW2
  E3AF  CDE0E1        		CALL	SOPENE2
  E3B2  CD79E3        		CALL	KILLS
  E3B5  CDA4E1        		CALL	NOPEN
  E3B8  18F3          		JR	KILLW1
  E3BA                	KILLW2:
  E3BA  C8            		RET	Z
  E3BB  3F            		CCF
  E3BC  C9            		RET
                      	
  E3BD                	CHKATT:
  E3BD  E5            		PUSH	HL
  E3BE  110B00        		LD	DE,00BH
  E3C1  19            		ADD	HL,DE
  E3C2  A6            		AND	(HL)
  E3C3  E1            		POP	HL
  E3C4  C8            		RET	Z
  E3C5  37            		SCF
  E3C6  C9            		RET
                      	
  E3C7                	NAME:
  E3C7  CD41E4        		CALL	CHKWILDX
  E3CA  D8            		RET	C
  E3CB  110400        		LD	DE,4
  E3CE  19            		ADD	HL,DE
  E3CF  22E7E3        		LD	(NAMEP+2),HL
  E3D2  23            		INC	HL
  E3D3  CD45E4        		CALL	CHKWILD
  E3D6  D8            		RET	C
                      	
  E3D7  CD13E1        		CALL	SOPENX
  E3DA  3E0F          		LD	A,00FH
  E3DC  D4BDE3        		CALL	NC,CHKATT
  E3DF  D8            		RET	C
                      	
  E3E0  FD7E00        		LD	A,(IY+0)
  E3E3  FDE5          		PUSH	IY
  E3E5  FD210000      	NAMEP:	LD	IY,0		;自己書き換え
  E3E9  FD7700        		LD	(IY+0),A
  E3EC  CD13E1        		CALL	SOPENX
  E3EF  FDE3          		EX	(SP),IY
  E3F1  3F            		CCF
  E3F2  D440E1        		CALL	NC,SOPEN
  E3F5  EB            		EX	DE,HL
  E3F6  E1            		POP	HL
  E3F7  D8            		RET	C
                      	
  E3F8                	SETNAME:
  E3F8  01000B        		LD	BC,11*256
  E3FB  23            		INC	HL
  E3FC  7E            		LD	A,(HL)
  E3FD  FEE5          		CP	0E5H
  E3FF  2004          		JR	NZ,SNAME1
  E401  3E05          		LD	A,5
  E403  180E          		JR	SNAME3
  E405                	SNAME1:
  E405  7E            		LD	A,(HL)
  E406  0C            		INC	C
  E407  0D            		DEC	C
  E408  2009          		JR	NZ,SNAME3
  E40A  CD16E3        		CALL	CAP
  E40D  FEA0          		CP	0A0H
  E40F  2002          		JR	NZ,SNAME3
  E411  3E20          		LD	A,020H
  E413                	SNAME3:
  E413  12            		LD	(DE),A
  E414  7E            		LD	A,(HL)
  E415  23            		INC	HL
  E416  CD2EE4        		CALL	FKAN
  E419  10EA          		DJNZ	SNAME1
  E41B                	WTDB:
  E41B  3EFF          		LD	A,0FFH
  E41D  3239EF        		LD	(SFILE),A
  E420                	SWTDBF:
  E420  3E01          		LD	A,1
  E422  32A4EF        		LD	(_WTDBF),A
  E425  AF            		XOR	A
  E426  C9            		RET
                      	
  E427                	FKANC:
  E427  CB41          		BIT	0,C
  E429  CC1FE3        		CALL	Z,CAP2
  E42C  1801          		JR	FKANX
  E42E                	FKAN:			;漢字チェック
  E42E  13            		INC	DE
  E42F                	FKANX:
  E42F  CB41          		BIT	0,C
  E431  CB81          		RES	0,C
  E433  C0            		RET	NZ
  E434  FE80          		CP	080H
  E436  D8            		RET	C
  E437  FEA0          		CP	0A0H
  E439  3803          		JR	C,FKAN1
  E43B  FEE0          		CP	0E0H
  E43D  D8            		RET	C
  E43E                	FKAN1:
  E43E  0C            		INC	C
  E43F  A7            		AND	A
  E440  C9            		RET
                      	
  E441                	CHKWILDX:
  E441  FDE5          		PUSH	IY
  E443  E1            		POP	HL
  E444  23            		INC	HL
  E445                	CHKWILD:
  E445  060B          		LD	B,11
  E447  3E3F          		LD	A,'?'
  E449                	CHKWIL1:
  E449  BE            		CP	(HL)
  E44A  23            		INC	HL
  E44B  37            		SCF
  E44C  C8            		RET	Z
  E44D  10FA          		DJNZ	CHKWIL1
  E44F  AF            		XOR	A
  E450  C9            		RET
                      	
  E451                	SDIRENT:		;IY=FCB HL=DIR
  E451  D5            		PUSH	DE
  E452  E5            		PUSH	HL
  E453  FDE5          		PUSH	IY
  E455  D1            		POP	DE
  E456  EB            		EX	DE,HL
  E457  CDF8E3        		CALL	SETNAME
                      	;				Attribute
  E45A  FD7E0D        		LD	A,(IY+13)	;(FCB)属性(アトリビュート)
  E45D  12            		LD	(DE),A
  E45E  13            		INC	DE
                      	;				Reserved
  E45F  AF            		XOR	A
  E460  060A          		LD	B,10
  E462                	SDE1:
  E462  12            		LD	(DE),A
  E463  13            		INC	DE
  E464  10FC          		DJNZ	SDE1
                      						;(FCB)更新時刻
  E466  21EAF0        		LD	HL,SDDATA		;(FCB)更新年月日
  E469  060A          		LD	B,SDDATAE-SDDATA	;(FCB)ファイルの先頭クラスタ
  E46B                	SDLOOP:					;(FCB)ファイルのサイズ(バイト単位)
  E46B  7E            		LD	A,(HL)
  E46C  23            		INC	HL
  E46D  3272E4        		LD	(SDPAT+2),A
  E470  FD7E00        	SDPAT:	LD	A,(IY+0)	;LD A,(IY+A)
  E473  12            		LD	(DE),A
  E474  13            		INC	DE
  E475  10F4          		DJNZ	SDLOOP
                      	
  E477  AF            		XOR	A
  E478  E1            		POP	HL
  E479  D1            		POP	DE
  E47A  C9            		RET
                      	
  E47B                	WOPEN:
  E47B  FD7E0D        		LD	A,(IY+13)	;(FCB)属性(アトリビュート)
  E47E  E61F          		AND	01FH
  E480  37            		SCF
  E481  C0            		RET	NZ
  E482  FD361CFE      		LD	(IY+28),0FEH	;(FCB)オープンモード
  E486                	TOPEN2:
  E486  AF            		XOR	A
  E487                	TOPEN:				;Initializes the time stamp
  E487  FD3617FF      		LD	(IY+23),0FFH	;(FCB)更新時刻
  E48B  C9            		RET
                      	
  E48C                	WRDFX:
  E48C  3AF5E2        		LD	A,(SPCPAT+1)	;1クラスタの論理セクタ
  E48F                	L_WRFX:
  E48F  1F            		RRA			;->CF
  E490  3806          		JR	C,E_WRFX
  E492  CB39          		SRL	C
  E494  CB1C          		RR	H		;CH=CH/2
  E496  18F7          		JR	L_WRFX
  E498                	E_WRFX:
  E498  44            		LD	B,H
  E499  04            		INC	B
  E49A  3E37          		LD	A,037H		;SCF
  E49C  3212E9        		LD	(DRDN1),A
                      	
  E49F                	WRDF:				;Bクラスタ分FATを確保する
  E49F  110200        		LD	DE,2
  E4A2  AF            		XOR	A
  E4A3  3282EA        		LD	(_SECPS+1),A
  E4A6                	WRDF1:
  E4A6  C5            		PUSH	BC
  E4A7  D5            		PUSH	DE
  E4A8  CDF7EF        		CALL	_GNCL
  E4AB  381C          		JR	C,WRDF3
  E4AD  7A            		LD	A,D		;空いているかチェック
  E4AE  B3            		OR	E
  E4AF  2027          		JR	NZ,WRDF4
  E4B1  E1            		POP	HL		;HL=空いているクラスタ
  E4B2  E5            		PUSH	HL
  E4B3  ED5BFEF0      		LD	DE,(_CLPS)	;DE=元の(_CLPS)
  E4B7  22FEF0        		LD	(_CLPS),HL
  E4BA  7A            		LD	A,D		;元の(_CLPS)が 0 か?
  E4BB  B3            		OR	E
  E4BC  2008          		JR	NZ,WRDF2
  E4BE  FD751A        		LD	(IY+26),L	;(FCB)ファイルの先頭クラスタ
  E4C1  FD741B        		LD	(IY+27),H	;元が空の場合はFCBにクラスタをセットする
  E4C4  1803          		JR	WRDF3
  E4C6                	WRDF2:
  E4C6  CDFAEF        		CALL	_SNCL
  E4C9                	WRDF3:
  E4C9  D1            		POP	DE
  E4CA  C1            		POP	BC
  E4CB  D8            		RET	C
  E4CC  100C          		DJNZ	WRDF5		;ここでループカウンタチェック
  E4CE  ED5BFEF0      		LD	DE,(_CLPS)
  E4D2  21FFFF        		LD	HL,0FFFFH	;FATエントリ終了(EOCマーク)
  E4D5  C3FAEF        		JP	_SNCL
                      	
  E4D8                	WRDF4:				;DEクラスタが空じゃないので次に移動する
  E4D8  D1            		POP	DE
  E4D9  C1            		POP	BC
  E4DA                	WRDF5:
  E4DA  13            		INC	DE
  E4DB  CD0EE3        		CALL	ENDCL
  E4DE  38C6          		JR	C,WRDF1
  E4E0  37            		SCF
  E4E1  C9            		RET
                      	
  E4E2                	RWXR:
  E4E2  3A13E8        		LD	A,(SECSZ+2)	;1024=4 / 512=2 / 256=1
  E4E5                	L_RWX:
  E4E5  1F            		RRA		;->CF
  E4E6  3808          		JR	C,E_RWX
  E4E8  CB38          		SRL	B	;BCH=BCH/2
  E4EA  CB19          		RR	C	;
  E4EC  CB1C          		RR	H	;
  E4EE  18F5          		JR	L_RWX
  E4F0                	E_RWX:
  E4F0  FD5E1A        		LD	E,(IY+26)	;(FCB)ファイルの先頭クラスタ
  E4F3  FD561B        		LD	D,(IY+27)
  E4F6  AF            		XOR	A
  E4F7  3282EA        		LD	(_SECPS+1),A
  E4FA                	RWX1:
  E4FA  ED53FEF0      		LD	(_CLPS),DE
  E4FE  7A            		LD	A,D
  E4FF  B3            		OR	E
  E500  2813          		JR	Z,SCF_RET	;RET DE==0 => CF=1
                      	
  E502  78            		LD	A,B
  E503  B1            		OR	C
  E504  B4            		OR	H
  E505  C8            		RET	Z		;RET BCH==0 => CF=0
                      	
  E506  CD8AEA        		CALL	GNCLX
  E509  D8            		RET	C
  E50A  7C            		LD	A,H		;
  E50B  25            		DEC	H		;
  E50C  B7            		OR	A		;DEC BCH
  E50D  2001          		JR	NZ,RWX2		;
  E50F  0B            		DEC	BC		;
  E510                	RWX2:
  E510  CD0EE3        		CALL	ENDCL
  E513  38E5          		JR	C,RWX1
  E515                	SCF_RET:
  E515  37            		SCF
  E516  C9            		RET
                      	
  E517                	DSKF:
  E517  110000        	MAXCLP:	LD	DE,0
  E51A  2AACEF        		LD	HL,(_FAKEFREE)
  E51D  7C            		LD	A,H
  E51E  B5            		OR	L
  E51F  2803          		JR	Z,DSKF1
  E521  110100        		LD	DE,1
  E524                	DSKF1:
  E524  D5            		PUSH	DE
  E525  CDF7EF        		CALL	_GNCL
  E528  380C          		JR	C,POPSCF
  E52A  7A            		LD	A,D
  E52B  B3            		OR	E
  E52C  2001          		JR	NZ,DSKF2
  E52E  23            		INC	HL
  E52F                	DSKF2:
  E52F  D1            		POP	DE
  E530  1B            		DEC	DE
  E531  7A            		LD	A,D
  E532  B3            		OR	E
  E533  20EF          		JR	NZ,DSKF1
  E535  C9            		RET
                      	
  E536                	POPSCF:
  E536  F1            		POP	AF
  E537  37            		SCF
  E538  C9            		RET
                      	
  E539                	SETTMS:
  E539  FD7E17        		LD	A,(IY+23)	;(FCB)ファイルを最後に変更した時刻
  E53C  3C            		INC	A
  E53D  C0            		RET	NZ		;ファイルが更新されていない
  E53E                	SETTMSX:			;FCBに日付時刻をセットする
  E53E  CDEFDB        		CALL	_SYS2C		;(BDOS)時刻の獲得
                      					;H←時  L←分  D←秒
  E541  CB25          		SLA	L		;   *2
  E543  CB25          		SLA	L		;   *4
  E545  29            		ADD	HL,HL		;*2 *8
  E546  29            		ADD	HL,HL		;*4 *16
  E547  29            		ADD	HL,HL		;*8 *32
  E548  7A            		LD	A,D
  E549  0F            		RRCA			;bit.0->7->->->0->C
  E54A  E61F          		AND	01FH
  E54C  B5            		OR	L
  E54D  FD7716        		LD	(IY+22),A	;(FCB)ファイルを最後に変更した時刻
  E550  FD7417        		LD	(IY+23),H
                      	
  E553  CDCCDB        		CALL	_SYS2A		;(BDOS)日付の獲得
                      					;HL←年  D←月  E←日
  E556  0144F8        		LD	BC,0-1980
  E559  09            		ADD	HL,BC
  E55A  65            		LD	H,L
                      	
  E55B  7A            		LD	A,D
  E55C  87            		ADD	A,A		;*2
  E55D  87            		ADD	A,A		;*4
  E55E  87            		ADD	A,A		;*8
  E55F  87            		ADD	A,A		;*16
  E560  6F            		LD	L,A
  E561  29            		ADD	HL,HL		;*32
  E562  7D            		LD	A,L
  E563  B3            		OR	E
  E564  FD7714        		LD	(IY+20),A	;(FCB)ファイルを最後に変更した日付
  E567  FD7415        		LD	(IY+21),H
  E56A  C9            		RET
                      	
  E56B                	PUSHRR:
  E56B  320AE6        		LD	(SETSEQ_SWC_RND),A
  E56E  221CE6        		LD	(SETSEQ_SWC_SEQ_RR),HL
  E571  CD91E5        		CALL	GET_RR_AHL
  E574  225AEF        		LD	(HLBUF),HL
  E577  325CEF        		LD	(HLBUF+2),A
  E57A  C9            		RET
                      	
  E57B                	GET_CPM_R_SIZE:		;バイト単位からCP/Mのレコード単位を求める（1レコード=128バイト）
  E57B  87            		ADD	A,A		;in BHLA => out AHL
  E57C  ED6A          		ADC	HL,HL
  E57E  CB18          		RR	B
  E580  B7            		OR	A
  E581  78            		LD	A,B		;ここでフラグは変化しない
  E582  C8            		RET	Z
  E583  2C            		INC	L		;INC AHL
  E584  C0            		RET	NZ		;
  E585  24            		INC	H		;
  E586  C0            		RET	NZ		;
  E587  3C            		INC	A		;
  E588  C9            		RET
                      	
  E589                	INIT_RND:
  E589  3ECD          		LD	A,0CDH		;CALL ????
  E58B  21DAE5        		LD	HL,POPRR
  E58E  CD6BE5        		CALL	PUSHRR
  E591                	GET_RR_AHL:
  E591  FD6E21        		LD	L,(IY+33)	;(FCB)Random record
  E594  FD6622        		LD	H,(IY+34)	;
  E597  FD7E23        		LD	A,(IY+35)	;
  E59A  C9            		RET
  E59B                	SET_RR_AHL:
  E59B  FD7521        		LD	(IY+33),L	;(FCB)Random record
  E59E  FD7422        		LD	(IY+34),H
  E5A1  FD7723        		LD	(IY+35),A
  E5A4  C9            		RET
  E5A5                	INIT_SEQ:
  E5A5  3E01          		LD	A,1		;LD BC,????
  E5A7  21D7E5        		LD	HL,SETSEQ
  E5AA  CD6BE5        		CALL	PUSHRR
  E5AD                	GETSEQ:
  E5AD  FD6E20        		LD	L,(IY+32)	;(FCB)カレントレコード
  E5B0  FD660C        		LD	H,(IY+12)	;(FCB)カレントブロック
  E5B3  AF            		XOR	A
                      	
  E5B4  CB25          		SLA	L	;L=L*2
                      	
  E5B6  CB3C          		SRL	H	;HL=HL/2
  E5B8  CB1D          		RR	L	;
  E5BA  C9            		RET
                      	
  E5BB                	SETSEQ1:
  E5BB  F5            		PUSH	AF		
  E5BC  E5            		PUSH	HL		;AHL=Random record
  E5BD  FD7E21        		LD	A,(IY+33)	;(FCB)ランダムレコード
  E5C0  FD6E22        		LD	L,(IY+34)
  E5C3  FD6623        		LD	H,(IY+35)
  E5C6  0600          		LD	B,0
                      	
  E5C8  CD7BE5        		CALL	GET_CPM_R_SIZE
                      	
  E5CB  29            		ADD	HL,HL
  E5CC  CB3D          		SRL	L		;L=L/2
  E5CE  FD7520        		LD	(IY+32),L	;(FCB)カレントレコード
  E5D1  FD740C        		LD	(IY+12),H	;(FCB)カレントブロック
  E5D4  E1            		POP	HL
  E5D5  F1            		POP	AF
  E5D6  C9            		RET
  E5D7                	SETSEQ:
  E5D7  CDBBE5        		CALL	SETSEQ1
  E5DA                	POPRR:
  E5DA  F5            		PUSH	AF
  E5DB  E5            		PUSH	HL
  E5DC  2A5AEF        		LD	HL,(HLBUF)
  E5DF  3A5CEF        		LD	A,(HLBUF+2)
  E5E2  CD9BE5        		CALL	SET_RR_AHL
  E5E5  E1            		POP	HL
  E5E6  F1            		POP	AF
  E5E7  C9            		RET
                      	
  E5E8                	RB_WRITE:
  E5E8  C5            		PUSH	BC
  E5E9  ED4B4CF0      		LD	BC,(STABLE+2*026H)	;(BDOS)ランダムブロック書き込み
  E5ED  1805          		JR	RBRW
  E5EF                	RB_READ:
  E5EF  C5            		PUSH	BC
  E5F0  ED4B4EF0      		LD	BC,(STABLE+2*027H)	;(BDOS)ランダムブロック読み込み
  E5F4                	RBRW:
  E5F4  CB3F          		SRL	A	;AHLA' = HL*128
  E5F6  CB1C          		RR	H	;AHL=AHL/2
  E5F8  CB1D          		RR	L	;
  E5FA  3E00          		LD	A,0
  E5FC  1F            		RRA		;A'HLA
  E5FD  FD7721        		LD	(IY+33),A	;(FCB)ランダムレコード
  E600  FD7522        		LD	(IY+34),L
  E603  FD7423        		LD	(IY+35),H
  E606  218000        		LD	HL,128
  E609  C5            		PUSH	BC
  E60A                	SETSEQ_SWC_RND:
  E60A  CDBBE5        		CALL	SETSEQ1
  E60D  C1            		POP	BC
  E60E  FDCB20FE      		SET	7,(IY+32)	;(FCB)カレントレコード
  E612  FDE5          		PUSH	IY
  E614  D1            		POP	DE
  E615  D5            		PUSH	DE
  E616  CD24E6        		CALL	JP_BC
  E619  FDE1          		POP	IY
  E61C                	SETSEQ_SWC_SEQ_RR	EQU $+1
  E61B  CDD7E5        		CALL	SETSEQ
  E61E  FDCB20BE      		RES	7,(IY+32)	;(FCB)カレントレコード
                      	
  E622  C1            		POP	BC
  E623  C9            		RET
  E624                	JP_BC:
  E624  C5            		PUSH	BC
  E625  C9            		RET
                      	
  E19E                	_SYS03	EQU	SCF_FF_RET	;(BDOS)外部入力
  E19E                	_SYS2B	EQU	SCF_FF_RET	;(BDOS)日付の設定
  E19E                	_SYS2D	EQU	SCF_FF_RET	;(BDOS)時刻の設定
  E19E                	_SYS39	EQU	SCF_FF_RET	;(BDOS)サブディレクトリの作成
  E19E                	_SYS3A	EQU	SCF_FF_RET	;(BDOS)サブディレクトリの削除
                      	
                      	
                      	;LDFILE2.ASM
                      	
                      	;	LSX-Dodgers FILE2
                      	
                      					;Write random block
  E626                	_SYS26:		;(BDOS)ランダムブロック書き込み
  E626  AF            		XOR	A
  E627  3212E9        		LD	(DRDN1),A	;NOP
  E62A  2256E8        		LD	(LEFT+1),HL	;HL←書き込むレコード数
  E62D  225DEF        		LD	(LEFTX),HL
  E630  CDF3E0        		CALL	SETDRV
                      	
  E633  CDADE7        		CALL	RBX0
  E636  DAD0E6        		JP	C,RBWERR
  E639  CD7BE4        		CALL	WOPEN
  E63C  DAD0E6        		JP	C,RBWERR
  E63F  7C            		LD	A,H
  E640  B5            		OR	L
  E641  CAC9E6        		JP	Z,RBW1
                      	
  E644  2B            		DEC	HL
                      	
  E645  CD78E8        		CALL	GET_RR_BCDE	;BCDE=Random record
                      	
  E648  19            		ADD	HL,DE		;BCHL=HL+BCDE
  E649  3001          		JR	NC,S26X1	;
  E64B  03            		INC	BC		;
  E64C                	S26X1:
  E64C  CDE2E4        		CALL	RWXR
  E64F  DC8CE4        		CALL	C,WRDFX
  E652  DAD0E6        		JP	C,RBWERR
                      	
  E655  CDDCE7        		CALL	RBX2
  E658  281A          		JR	Z,RBWB		;NZ=セクタ以下の端数がある
  E65A  CDFBE7        		CALL	RBXA
  E65D  3871          		JR	C,RBWERR
  E65F  EB            		EX	DE,HL
  E660  C5            		PUSH	BC
  E661  EDB0          		LDIR
  E663  225FEF        		LD	(DTAX),HL
                      	
  E666  CD20E4        		CALL	SWTDBF		;バッファデータは更新された
                      	
  E669  2A5DEF        		LD	HL,(LEFTX)
  E66C  D1            		POP	DE
  E66D  ED52          		SBC	HL,DE
  E66F  225DEF        		LD	(LEFTX),HL
  E672  2833          		JR	Z,RBWEND
                      	
  E674                	RBWB:
  E674  CD31E8        		CALL	RBXB
  E677  2816          		JR	Z,RBWC
  E679                	RBWB1:
  E679  C5            		PUSH	BC
  E67A  D5            		PUSH	DE
  E67B  CDF1E2        		CALL	CLUSTX
  E67E  CD8CE8        		CALL	DWTC
  E681  D1            		POP	DE
  E682  C1            		POP	BC
  E683  384B          		JR	C,RBWERR
  E685  CD8AEA        		CALL	GNCLX
  E688  3846          		JR	C,RBWERR
  E68A  10ED          		DJNZ	RBWB1
  E68C  CDDCE8        		CALL	DRW_FLUSH
  E68F                	RBWC:
  E68F  CD49E8        		CALL	RBXC
  E692  2813          		JR	Z,RBWEND
  E694  C5            		PUSH	BC
  E695  CDF1E2        		CALL	CLUSTX
  E698  CD11E9        		CALL	DRDN
  E69B  C1            		POP	BC
  E69C  3832          		JR	C,RBWERR
  E69E  ED5B7EF0      		LD	DE,(_DTBUF)
  E6A2  EDB0          		LDIR
  E6A4  CD20E4        		CALL	SWTDBF		;バッファデータは更新された
  E6A7                	RBWEND:
  E6A7  CD55E8        		CALL	RBXEND
                      	
  E6AA  CDBCE7        		CALL	RBX1
  E6AD  301A          		JR	NC,RBW1
  E6AF  2A56E8        		LD	HL,(LEFT+1)
  E6B2  FD5E10        		LD	E,(IY+16)	;(FCB)ファイルのサイズ(バイト単位)
  E6B5  FD5611        		LD	D,(IY+17)	;DE=File size
  E6B8  19            		ADD	HL,DE
  E6B9  FD7510        		LD	(IY+16),L	;(FCB)ファイルのサイズ(バイト単位)
  E6BC  FD7411        		LD	(IY+17),H
  E6BF  3008          		JR	NC,RBW1
  E6C1  FD3412        		INC	(IY+18)
  E6C4  2003          		JR	NZ,RBW1
  E6C6  FD3413        		INC	(IY+19)
  E6C9                	RBW1:
  E6C9  FDE1          		POP	IY
  E6CB  C1            		POP	BC
  E6CC  D1            		POP	DE
  E6CD  E1            		POP	HL
  E6CE                	DD_NUL:
  E6CE  AF            		XOR	A
  E6CF                	DRDF0:
  E6CF                	DWTF0:
  E6CF  C9            		RET
                      	
  E6D0                	RBWERR:
  E6D0  FDE5          		PUSH	IY
  E6D2  D1            		POP	DE
  E6D3  2A20F0        		LD	HL,(STABLE+2*010H)
  E6D6  CD0F00        		CALL	JP_HL
  E6D9                	RBRERR1:
  E6D9  3E01          		LD	A,001H
  E6DB                	RBRERR2:
  E6DB  FDE1          		POP	IY
  E6DD  C1            		POP	BC
  E6DE  D1            		POP	DE
  E6DF  E1            		POP	HL
  E6E0  37            		SCF
  E6E1  210000        		LD	HL,0
  E6E4  C9            		RET
                      	
  E6E5                	RBRERR:
  E6E5  3EFF          		LD	A,0FFH
  E6E7  18F2          		JR	RBRERR2
                      	
  E6E9                	RBRFL:
  E6E9  3E00          	RBRFLP:	LD	A,000H
  E6EB  FE0D          		CP	00DH
  E6ED  2005          		JR	NZ,RBRFL1
  E6EF  D5            		PUSH	DE
  E6F0  1E0A          		LD	E,00AH
  E6F2  1805          		JR	RBRFL2
  E6F4                	RBRFL1:
  E6F4  D5            		PUSH	DE
  E6F5  CD09EF        		CALL	_SYS07
  E6F8  5F            		LD	E,A
  E6F9                	RBRFL2:
  E6F9  CDCDEF        		CALL	_PRINT
  E6FC  7B            		LD	A,E
  E6FD  D1            		POP	DE
  E6FE  32EAE6        		LD	(RBRFLP+1),A
  E701  C9            		RET
  E702                	DDX:
  E702  FD7E01        		LD	A,(IY+1)	;(FCB)主ファイル名
  E705  CD16E3        		CALL	CAP
  E708  FE41          		CP	'A'
  E70A  C9            		RET
                      	
                      					;Read random block
  E70B                	_SYS27:		;(BDOS)ランダムブロック読み込み
  E70B  225DEF        		LD	(LEFTX),HL
  E70E  CDF3E0        		CALL	SETDRV
                      	
  E711  FDCB0D66      		BIT	4,(IY+13)	;(FCB)属性(アトリビュート)
  E715  C29BE7        		JP	NZ,RBRDIR	;ディレクトリ
  E718  CDADE7        		CALL	RBX0
  E71B  DAE5E6        		JP	C,RBRERR
  E71E  CDBCE7        		CALL	RBX1
  E721  DAD9E6        		JP	C,RBRERR1
  E724  EB            		EX	DE,HL
  E725  ED52          		SBC	HL,DE		;CP 00HL,BCDE
  E727  19            		ADD	HL,DE
  E728  79            		LD	A,C
  E729  DE00          		SBC	A,0
  E72B  78            		LD	A,B
  E72C  DE00          		SBC	A,0
  E72E  3801          		JR	C,RBR1
  E730  EB            		EX	DE,HL
  E731                	RBR1:
  E731  9F            		SBC	A,A
  E732  E601          		AND	1
  E734  3299E7        		LD	(RBRAP+1),A
                      	
  E737  7C            		LD	A,H
  E738  B5            		OR	L
  E739  2857          		JR	Z,RBREND0
                      	
  E73B  2256E8        		LD	(LEFT+1),HL	;Read record byte
  E73E  225DEF        		LD	(LEFTX),HL
                      	
  E741  CDDCE7        		CALL	RBX2
  E744  2819          		JR	Z,RBRB
  E746  CDFBE7        		CALL	RBXA
  E749  DAE5E6        		JP	C,RBRERR
  E74C  C5            		PUSH	BC
  E74D  EDB0          		LDIR
  E74F  ED535FEF      		LD	(DTAX),DE
  E753  2A5DEF        		LD	HL,(LEFTX)
  E756  D1            		POP	DE
  E757  A7            		AND	A
  E758  ED52          		SBC	HL,DE
  E75A  225DEF        		LD	(LEFTX),HL
  E75D  2830          		JR	Z,RBREND
                      	
  E75F                	RBRB:
  E75F  CD31E8        		CALL	RBXB
  E762  2815          		JR	Z,RBRC
  E764                	RBRB1:
  E764  C5            		PUSH	BC
  E765  D5            		PUSH	DE
  E766  CDF1E2        		CALL	CLUSTX
  E769  CD92E8        		CALL	DRDC
  E76C  D1            		POP	DE
  E76D  C1            		POP	BC
  E76E  D48AEA        		CALL	NC,GNCLX
  E771  DAE5E6        		JP	C,RBRERR
  E774  10EE          		DJNZ	RBRB1
  E776  CDDCE8        		CALL	DRW_FLUSH
  E779                	RBRC:
  E779  CD49E8        		CALL	RBXC
  E77C  2811          		JR	Z,RBREND
  E77E  C5            		PUSH	BC
  E77F  CDF1E2        		CALL	CLUSTX
  E782  CDF5E8        		CALL	DRDX
  E785  C1            		POP	BC
  E786  DAE5E6        		JP	C,RBRERR
  E789  EB            		EX	DE,HL
  E78A  2A7EF0        		LD	HL,(_DTBUF)
  E78D  EDB0          		LDIR
  E78F                	RBREND:
  E78F  CD55E8        		CALL	RBXEND
  E792                	RBREND0:
  E792  FDE1          		POP	IY
  E794  C1            		POP	BC
  E795  D1            		POP	DE
  E796  F1            		POP	AF	;(HL)
  E797  AF            		XOR	A
  E798  3E00          	RBRAP:	LD	A,000H
  E79A  C9            		RET
                      	
  E79B                	RBRDIR:
  E79B  FD6E1A        		LD	L,(IY+26)	;(FCB)ファイルの先頭クラスタ
  E79E  FD661B        		LD	H,(IY+27)
  E7A1  CD31E3        		CALL	CHDIR
  E7A4  AF            		XOR	A
  E7A5  67            		LD	H,A
  E7A6  6F            		LD	L,A
  E7A7  3C            		INC	A
  E7A8  3299E7        		LD	(RBRAP+1),A
  E7AB  18E5          		JR	RBREND0
                      	
  E7AD                	RBX0:
  E7AD  2A8AEF        		LD	HL,(_DTA)
  E7B0  225FEF        		LD	(DTAX),HL
  E7B3  2A5DEF        		LD	HL,(LEFTX)
  E7B6  FD7E1C        		LD	A,(IY+28)	;(FCB)オープンモード
  E7B9  D6FD          		SUB	0FDH
  E7BB  C9            		RET
                      	
  E7BC                	RBX1:
  E7BC  E5            		PUSH	HL		;Record byte
                      					;AHL=File size
  E7BD  FD6E10        		LD	L,(IY+16)	;ファイルのサイズ(バイト単位)
  E7C0  FD6611        		LD	H,(IY+17)	;
  E7C3  FD7E12        		LD	A,(IY+18)	;
                      	
  E7C6  CD78E8        		CALL	GET_RR_BCDE	;BCDE=Random record
                      	
  E7C9  A7            		AND	A
  E7CA  ED52          		SBC	HL,DE
  E7CC  99            		SBC	A,C
  E7CD  4F            		LD	C,A
  E7CE  FD7E13        		LD	A,(IY+19)	;ファイルのサイズ
  E7D1  98            		SBC	A,B
  E7D2  D1            		POP	DE
                      	
  E7D3  D8            		RET	C
  E7D4  47            		LD	B,A
  E7D5  B1            		OR	C
  E7D6  EB            		EX	DE,HL	;BCDE=File byte	HL=Record byte
  E7D7  B2            		OR	D
  E7D8  B3            		OR	E
  E7D9  C0            		RET	NZ
  E7DA  37            		SCF
  E7DB  C9            		RET
                      	
  E7DC                	RBX2:				;Cluster settings
  E7DC  FD6622        		LD	H,(IY+34)	;(+33)(FCB)ランダムレコード
  E7DF  FD4E23        		LD	C,(IY+35)
  E7E2  0600          		LD	B,0
  E7E4  FDCB207E      		BIT	7,(IY+32)	;(FCB)カレントレコード
  E7E8  2003          		JR	NZ,RBX3
  E7EA  FD4624        		LD	B,(IY+36)
  E7ED                	RBX3:
  E7ED  CDE2E4        		CALL	RWXR
  E7F0  3A13E8        		LD	A,(SECSZ+2)	;1024=4 / 512=2 / 256=1
  E7F3  3D            		DEC	A
  E7F4  FDA622        		AND	(IY+34)
  E7F7  FDB621        		OR	(IY+33)
  E7FA  C9            		RET
                      	
  E7FB                	RBXA:
  E7FB  C5            		PUSH	BC
  E7FC  D5            		PUSH	DE
  E7FD  CDF1E2        		CALL	CLUSTX
  E800  CDF5E8        		CALL	DRDX
  E803  D1            		POP	DE
  E804  C1            		POP	BC
  E805  D8            		RET	C
  E806  CD8AEA        		CALL	GNCLX
  E809  D8            		RET	C
  E80A  ED53FEF0      		LD	(_CLPS),DE
                      	
  E80E  FD4E21        		LD	C,(IY+33)	;(FCB)ランダムレコード
  E811  210004        	SECSZ:	LD	HL,0400H	;自己書き換え 1024=0400H / 512=0200H ここに1セクタのサイズが格納される
  E814  7C            		LD	A,H
  E815  3D            		DEC	A		;1024=3 / 512=1
  E816  FDA622        		AND	(IY+34)		;(FCB)ランダムレコード
  E819  47            		LD	B,A		;BCに1セクタ以下の端数が入る
  E81A  ED42          		SBC	HL,BC		;残りを計算
                      	
  E81C  ED5B5DEF      		LD	DE,(LEFTX)
  E820  ED52          		SBC	HL,DE		;CP HL,DE
  E822  19            		ADD	HL,DE		;
  E823  3801          		JR	C,RBXA1		;DEとHLを比較して大きい方をHLに
  E825  EB            		EX	DE,HL
  E826                	RBXA1:
  E826  E5            		PUSH	HL
  E827  2A7EF0        		LD	HL,(_DTBUF)
  E82A  09            		ADD	HL,BC
  E82B  ED5B5FEF      		LD	DE,(DTAX)
  E82F  C1            		POP	BC
  E830  C9            		RET
                      	
  E831                	RBXB:
  E831  2A5FEF        		LD	HL,(DTAX)
  E834  ED5BFEF0      		LD	DE,(_CLPS)
  E838  3A5EEF        		LD	A,(LEFTX+1)
  E83B  47            		LD	B,A
  E83C  3A13E8        		LD	A,(SECSZ+2)	;1024=4 / 512=2 / 256=1
  E83F                	RBXB1:
  E83F  1F            		RRA		;->CF
  E840  3804          		JR	C,RBXB2
  E842  CB38          		SRL	B	;B=B/2
  E844  18F9          		JR	RBXB1
  E846                	RBXB2:
  E846  78            		LD	A,B
  E847  B7            		OR	A
  E848  C9            		RET
                      	
  E849                	RBXC:
  E849  ED4B5DEF      		LD	BC,(LEFTX)
  E84D  3A13E8        		LD	A,(SECSZ+2)	;1024=4 / 512=2 / 256=1
  E850  3D            		DEC	A
  E851  A0            		AND	B
  E852  47            		LD	B,A		;1セクタ以下の端数がない場合はZ
  E853  B1            		OR	C
  E854  C9            		RET
                      	
  E855                	RBXEND:
  E855  110000        	LEFT:	LD	DE,0
  E858  AF            		XOR	A
  E859  FD6E21        		LD	L,(IY+33)	;(FCB)ランダムレコード
  E85C  FD6622        		LD	H,(IY+34)
  E85F  19            		ADD	HL,DE
  E860  FD7521        		LD	(IY+33),L	;(FCB)ランダムレコード
  E863  FD7422        		LD	(IY+34),H
  E866  300E          		JR	NC,RBXEND1
  E868  FD3423        		INC	(IY+35)
  E86B  2009          		JR	NZ,RBXEND1
  E86D  FDCB207E      		BIT	7,(IY+32)	;(FCB)カレントレコード
  E871  2003          		JR	NZ,RBXEND1
  E873  FD3424        		INC	(IY+36)
  E876                	RBXEND1:
  E876  EB            		EX	DE,HL		;HL=Read byte
  E877  C9            		RET
                      	
  E878                	GET_RR_BCDE:			;BCDE=Random record
  E878  FD5E21        		LD	E,(IY+33)	;(FCB)ランダムレコード
  E87B  FD5622        		LD	D,(IY+34)
  E87E  FD4E23        		LD	C,(IY+35)
  E881  FD4624        		LD	B,(IY+36)
  E884  FDCB207E      		BIT	7,(IY+32)	;(FCB)カレントレコード
  E888  C8            		RET	Z
  E889  0600          		LD	B,0		;CP/M互換のアクセスの場合はFCBは36バイト
  E88B  C9            		RET
                      	
                      	;	ランダムブロックアクセスの連続したセクタをまとめる
                      	
  E88C                	DWTC:
  E88C  E5            		PUSH	HL
  E88D  21EFEB        		LD	HL,DWT24B
  E890  1804          		JR	DWTC1
  E892                	DRDC:
  E892  E5            		PUSH	HL
  E893  21DFEB        		LD	HL,DRD24B
  E896                	DWTC1:
  E896  22F0E8        		LD	(DRWF_MODE),HL
  E899  E1            		POP	HL
  E89A  3AE0E8        		LD	A,(DRWF_B)
  E89D  B7            		OR	A
  E89E  200F          		JR	NZ,DRDC1
  E8A0                	SAVE_DRWC:
  E8A0  0601          		LD	B,1
  E8A2  ED43DFE8      		LD	(DRWF_C),BC
  E8A6  ED53E6E8      		LD	(DRWF_E),DE
  E8AA  22E9E8        		LD	(DRWF_HL),HL
  E8AD  1820          		JR	INC_HL_DRWC
  E8AF                	DRDC1:
  E8AF  E5            		PUSH	HL
  E8B0  21E6E8        		LD	HL,DRWF_E
  E8B3  86            		ADD	A,(HL)
  E8B4  F5            		PUSH	AF
  E8B5  BB            		CP	E
  E8B6  201D          		JR	NZ,DRDC2
  E8B8  F1            		POP	AF
  E8B9  23            		INC	HL
  E8BA  7E            		LD	A,(HL)
  E8BB  CE00          		ADC	A,0
  E8BD  F5            		PUSH	AF
  E8BE  BA            		CP	D
  E8BF  2014          		JR	NZ,DRDC2
  E8C1  F1            		POP	AF
  E8C2  3ADFE8        		LD	A,(DRWF_C)
  E8C5  CE00          		ADC	A,0
  E8C7  B9            		CP	C
  E8C8  200C          		JR	NZ,DRDC3
  E8CA  21E0E8        		LD	HL,DRWF_B
  E8CD  34            		INC	(HL)
  E8CE  E1            		POP	HL
  E8CF                	INC_HL_DRWC:
  E8CF  3A13E8        		LD	A,(SECSZ+2)		;1セクタのサイズの上位1バイト
  E8D2  84            		ADD	A,H
  E8D3  67            		LD	H,A
  E8D4  C9            		RET
  E8D5                	DRDC2:
  E8D5  F1            		POP	AF
  E8D6                	DRDC3:
  E8D6  CDDCE8        		CALL	DRW_FLUSH
  E8D9  E1            		POP	HL
  E8DA  18C4          		JR	SAVE_DRWC
                      	
                      	;	ランダムブロックアクセスの連続したセクタをまとめたものをフラッシュする
  E8DC                	DRW_FLUSH:
  E8DC  C5            		PUSH	BC
  E8DD  D5            		PUSH	DE
  E8DF                	DRWF_C	EQU	$+1
  E8E0                	DRWF_B	EQU	$+2
  E8DE  010000        		LD	BC,0
  E8E1  78            		LD	A,B
  E8E2  B7            		OR	A
  E8E3  280D          		JR	Z,DRDF1
  E8E6                	DRWF_E	EQU	$+1
  E8E7                	DRWF_D	EQU	$+2
  E8E5  110000        		LD	DE,0
  E8E9                	DRWF_HL	EQU	$+1
  E8E8  210000        		LD	HL,0
  E8EB  AF            		XOR	A
  E8EC  32E0E8        		LD	(DRWF_B),A
  E8F0                	DRWF_MODE	EQU	$+1
  E8EF  CDDFEB        		CALL	DRD24B
  E8F2                	DRDF1:
  E8F2  D1            		POP	DE
  E8F3  C1            		POP	BC
  E8F4  C9            		RET
                      	
                      	;LDDIO.ASM
                      	
                      	;	LSX-Dodgers DIO
                      	
  E8F5                	DRDX:
  E8F5  CD33E9        		CALL	DRDY
  E8F8  C8            		RET	Z
  E8F9  CD19E9        		CALL	DRDX1		;データバッファの情報を保存
  E8FC  D8            		RET	C
  E8FD  E5            		PUSH	HL
  E8FE  C5            		PUSH	BC
  E8FF  D5            		PUSH	DE
  E900  2A7EF0        		LD	HL,(_DTBUF)
  E903  3A5CE9        		LD	A,(_DBS24+1)
  E906  4F            		LD	C,A
  E907  CDDDEB        		CALL	DRD24
  E90A  DC2EE9        		CALL	C,DRDNE
  E90D                	POP_DE_BC_HL_RET:
  E90D  D1            		POP	DE
  E90E  C1            		POP	BC
  E90F  E1            		POP	HL
  E910  C9            		RET
                      	
                      	;	CDE:セクタ番号
  E911                	DRDN:
  E911  AF            		XOR	A
  E912  00            	DRDN1:	NOP			;自己書き換え NOP / SCF
  E913  30E0          		JR	NC,DRDX
  E915                	DRDNX:
  E915  CD33E9        		CALL	DRDY
  E918  C8            		RET	Z
  E919                	DRDX1:
  E919  CD49E9        		CALL	DWTX
                      					;データバッファの読み込んだドライブ・セクタ情報を保存
  E91C  ED53A6EF      		LD	(_DBSEC),DE
  E920  79            		LD	A,C
  E921  325CE9        		LD	(_DBS24+1),A
                      	
  E924  3A88EF        		LD	A,(_DRV)
  E927  32A5EF        		LD	(_DBDRV),A
  E92A  CDD9EF        		CALL	_CHGDRV
  E92D  D0            		RET	NC
  E92E                	DRDNE:
  E92E  9F            		SBC	A,A		;CF=1ならばA=0FFH
  E92F  32A5EF        		LD	(_DBDRV),A
  E932  C9            		RET
                      	
                      	;	CDE:セクタ番号
  E933                	DRDY:
  E933  3A5CE9        		LD	A,(_DBS24+1)
  E936  B9            		CP	C
  E937  C0            		RET	NZ
                      	
  E938  E5            		PUSH	HL
  E939  3A88EF        		LD	A,(_DRV)
  E93C  21A5EF        		LD	HL,_DBDRV
  E93F  AE            		XOR	(HL)
  E940  2005          		JR	NZ,POP_HL_RET
                      	
  E942  2AA6EF        		LD	HL,(_DBSEC)
  E945  ED52          		SBC	HL,DE		;CF=0
  E947                	POP_HL_RET:
  E947  E1            		POP	HL
  E948  C9            		RET
                      	
  E949                	DWTX:
  E949  3AA4EF        		LD	A,(_WTDBF)
  E94C  B7            		OR	A
  E94D  C8            		RET	Z
  E94E  AF            		XOR	A
  E94F  32A4EF        		LD	(_WTDBF),A
                      	
  E952  E5            		PUSH	HL
  E953  C5            		PUSH	BC
  E954  D5            		PUSH	DE
  E955  3AA5EF        		LD	A,(_DBDRV)
  E958  CDD9EF        		CALL	_CHGDRV
  E95B  0E00          	_DBS24:	LD	C,0
  E95D  ED5BA6EF      		LD	DE,(_DBSEC)
  E961  2A7EF0        		LD	HL,(_DTBUF)
  E964  D4EDEB        		CALL	NC,DWT24
  E967                	POP_DE_BC_HL_RET2:
  E967  18A4          		JR	POP_DE_BC_HL_RET
                      	
  E969                	RDFATX:
  E969  E5            		PUSH	HL
  E96A  3A88EF        		LD	A,(_DRV)
  E96D  21AAEF        		LD	HL,_FATDRV
  E970  AE            		XOR	(HL)
  E971  28D4          		JR	Z,POP_HL_RET
                      	
  E973  C5            		PUSH	BC
  E974  D5            		PUSH	DE
  E975  DDE5          		PUSH	IX
  E977  CD93E9        		CALL	WTFATX
  E97A  3813          		JR	C,POP_IX_DE_BC_HL_RET
                      	
  E97C  AF            		XOR	A
  E97D  32ABEF        		LD	(_FATIX),A
  E980  3A88EF        		LD	A,(_DRV)
  E983  32AAEF        		LD	(_FATDRV),A
  E986  CDE5EF        		CALL	_RDFAT
  E989                	RDFATE2:
  E989  3004          		JR	NC,POP_IX_DE_BC_HL_RET
  E98B  9F            		SBC	A,A		;A=0xFF
  E98C  32AAEF        		LD	(_FATDRV),A
  E98F                	POP_IX_DE_BC_HL_RET:
  E98F  DDE1          		POP	IX
  E991  18D4          		JR	POP_DE_BC_HL_RET2
                      	
  E993                	WTFATX:
  E993  3AA2EF        		LD	A,(_WTFATF)
  E996  B7            		OR	A
  E997  C8            		RET	Z
  E998  E5            		PUSH	HL
  E999  3AAAEF        		LD	A,(_FATDRV)
  E99C  21A5EF        		LD	HL,_DBDRV
  E99F  AE            		XOR	(HL)
  E9A0  CC49E9        		CALL	Z,DWTX
  E9A3  38A2          		JR	C,POP_HL_RET
  E9A5  C5            		PUSH	BC
  E9A6  D5            		PUSH	DE
  E9A7  DDE5          		PUSH	IX
  E9A9  CDFAEB        		CALL	WTFAT
  E9AC  AF            		XOR	A
  E9AD  32A2EF        		LD	(_WTFATF),A
  E9B0  18DD          		JR	POP_IX_DE_BC_HL_RET
                      	
  E9B2                	NCL1:
  E9B2  7A            		LD	A,D
  E9B3  B3            		OR	E
  E9B4  37            		SCF
  E9B5  C8            		RET	Z
                      	
  E9B6  7A            		LD	A,D
  E9B7  CB3F          		SRL	A	;/2
  E9B9  CB3F          		SRL	A	;/2
                      	
  E9BB  E5            		PUSH	HL
  E9BC  32DBE9        		LD	(NCLPAT+2),A	;_FATIX
  E9BF  2AAAEF        		LD	HL,(_FATDRV)	;L=_FATDRV H=_FATIX
  E9C2  BC            		CP	H
  E9C3  3A88EF        		LD	A,(_DRV)	;この間でフラグは変化しない
  E9C6  32DAE9        		LD	(NCLPAT+1),A	;_FATDRV
  E9C9  2005          		JR	NZ,NCL2		;FATIXが違う
  E9CB  BD            		CP	L
  E9CC  2002          		JR	NZ,NCL2		;ドライブが違う
  E9CE  E1            		POP	HL
  E9CF  C9            		RET
  E9D0                	NCL2:
  E9D0  C5            		PUSH	BC
  E9D1  D5            		PUSH	DE
  E9D2  DDE5          		PUSH	IX
  E9D4  CD93E9        		CALL	WTFATX
  E9D7  38B6          		JR	C,POP_IX_DE_BC_HL_RET
  E9D9  010000        	NCLPAT:	LD	BC,0		;自己書き換え C=_FATDRV B=_FATIX
  E9DC  ED43AAEF      		LD	(_FATDRV),BC
  E9E0  CDCFEB        		CALL	RDFATS
  E9E3  18A4          		JR	RDFATE2
                      	
  E9E5                	NCL3:
  E9E5  CB9A          		RES	3,D
  E9E7  CB92          		RES	2,D
  E9E9  6B            		LD	L,E
  E9EA  62            		LD	H,D
  E9EB  CB3C          		SRL	H	;
  E9ED  CB1D          		RR	L	;HLA=HLA/2
  E9EF  1F            		RRA		;
  E9F0  F5            		PUSH	AF
  E9F1  3AABEF        		LD	A,(_FATIX)
  E9F4  0F            		RRCA
  E9F5  300B          		JR	NC,NCL3X1
  E9F7  3A13E8        		LD	A,(SECSZ+2)
  E9FA  FE04          		CP	4		;1セクタ1024バイトの場合は奇数インデックスの場合に先頭を512バイトずらす
  E9FC  2004          		JR	NZ,NCL3X1
  E9FE  010002        		LD	BC,512
  EA01  09            		ADD	HL,BC
  EA02                	NCL3X1:
  EA02  F1            		POP	AF
  EA03  ED4B7CF0      		LD	BC,(_FATBF)
  EA07  19            		ADD	HL,DE
  EA08  09            		ADD	HL,BC
  EA09  17            		RLA
  EA0A  C9            		RET
                      	
  EA0B                	GNCL:
  EA0B  CDB2E9        		CALL	NCL1		;GET NEXT CLUSTER
  EA0E  D8            		RET	C
  EA0F  C5            		PUSH	BC
  EA10  E5            		PUSH	HL
  EA11  CDE5E9        		CALL	NCL3
  EA14  3809          		JR	C,GNC1
  EA16  5E            		LD	E,(HL)
  EA17  23            		INC	HL
  EA18  7E            		LD	A,(HL)
  EA19  E60F          		AND	00FH
  EA1B  57            		LD	D,A
  EA1C  E1            		POP	HL
  EA1D  C1            		POP	BC
  EA1E  C9            		RET
  EA1F                	GNC1:
  EA1F  7E            		LD	A,(HL)
  EA20  23            		INC	HL
  EA21  56            		LD	D,(HL)
  EA22  0604          		LD	B,4
  EA24                	GNC1L:
  EA24  CB3A          		SRL	D	;DA=DA/2
  EA26  1F            		RRA		;
  EA27  10FB          		DJNZ	GNC1L
                      	
  EA29  5F            		LD	E,A
  EA2A  E1            		POP	HL
  EA2B  C1            		POP	BC
  EA2C  A7            		AND	A
  EA2D  C9            		RET
                      	
  EA2E                	SNCL:
  EA2E  CDB2E9        		CALL	NCL1
  EA31  D8            		RET	C
                      	;				SET NEXT CLUSTER
  EA32  E5            		PUSH	HL
  EA33  C5            		PUSH	BC
  EA34  D5            		PUSH	DE
  EA35  E5            		PUSH	HL
  EA36  CDE5E9        		CALL	NCL3
  EA39  D1            		POP	DE
                      	;CF=ODD
  EA3A  7E            		LD	A,(HL)
  EA3B  73            		LD	(HL),E
  EA3C  3806          		JR	C,SNC1
                      	;EVEN
                      	;M[0] = E
                      	;M[1] = (M[1] & 0xF0) | (D & 0x0F)
  EA3E  23            		INC	HL
  EA3F  ED67          		RRD		;M={A[3:0],E[3:0]}
  EA41  7A            		LD	A,D
  EA42  1804          		JR	SNC11
  EA44                	SNC1:
                      	;ODD
                      	;HL[0] = (HL[0]&0x0F) | (E<<4)
                      	;HL[1] = DE>>4
  EA44  ED6F          		RLD		;M={D[3:0],E[7:4]}
  EA46  23            		INC	HL
  EA47  72            		LD	(HL),D	;M={D[3:0],E[7:4]}
  EA48                	SNC11:
  EA48  ED6F          		RLD		;M={M[7:4],D[3:0]}
  EA4A  B7            		OR	A
  EA4B  D1            		POP	DE
  EA4C  C1            		POP	BC
  EA4D  E1            		POP	HL
  EA4E                	FAT_CHANGED:
  EA4E  3E01          		LD	A,1
  EA50  32A2EF        		LD	(_WTFATF),A
  EA53  C9            		RET
                      	
  EA54                	N16CL3:
  EA54  C5            		PUSH	BC
  EA55  6B            		LD	L,E
  EA56  7A            		LD	A,D
  EA57  E603          		AND	3
  EA59  67            		LD	H,A
  EA5A  29            		ADD	HL,HL
  EA5B  ED4B7CF0      		LD	BC,(_FATBF)
  EA5F  09            		ADD	HL,BC
  EA60  C1            		POP	BC
  EA61  C9            		RET
                      	
  EA62                	GNCL16:
  EA62  CDB2E9        		CALL	NCL1		;GET NEXT CLUSTER for FAT16
  EA65  D8            		RET	C
  EA66  E5            		PUSH	HL
  EA67  CD54EA        		CALL	N16CL3
  EA6A  5E            		LD	E,(HL)
  EA6B  23            		INC	HL
  EA6C  56            		LD	D,(HL)
  EA6D  E1            		POP	HL
  EA6E  C9            		RET
                      	
  EA6F                	SNCL16:
  EA6F  CDB2E9        		CALL	NCL1		;GET NEXT CLUSTER for FAT16
  EA72  D8            		RET	C
  EA73  D5            		PUSH	DE
  EA74  E5            		PUSH	HL
  EA75  CD54EA        		CALL	N16CL3
  EA78  D1            		POP	DE		;HL
  EA79  73            		LD	(HL),E
  EA7A  23            		INC	HL
  EA7B  72            		LD	(HL),D
  EA7C  6B            		LD	L,E
  EA7D  62            		LD	H,D
  EA7E  D1            		POP	DE
  EA7F  18CD          		JR	FAT_CHANGED
                      	
                      	;------------------------
                      	;次のセクタを探す際に_SECPSの値をチェック
                      	;in
                      	;	DE : セクタ番号
                      	;out
                      	;	DE : 次のセクタ番号
                      	;note
                      	;
                      	;------------------------
  EA81                	NEXTX:
  EA81  3E00          	_SECPS:	LD	A,0	;自己書き換え
  EA83  3C            		INC	A
  EA84  E600          	NCPAT:	AND	0	;自己書き換え　1クラスタの論理セクタ数-1
  EA86  3282EA        		LD	(_SECPS+1),A
  EA89  C9            		RET
                      	
  EA8A                	GNCLX:
  EA8A  CD81EA        		CALL	NEXTX
  EA8D  C0            		RET	NZ	;1クラスタのセクタ未満の場合は戻る
  EA8E  C3F7EF        		JP	_GNCL	;次のクラスタを探す
                      	
  EA91                	RDFAT:
  EA91  3E80          		LD	A,080H
  EA93  3270EF        		LD	(CHECK),A
  EA96                	RDFAT1:
  EA96  3A88EF        		LD	A,(_DRV)
  EA99  CD24ED        		CALL	CHGDRVR
  EA9C  D8            		RET	C
  EA9D  DD7E12        		LD	A,(IX+012H)	;DPB_12_DEVICE
  EAA0  CB6F          		BIT	5,A
  EAA2  2843          		JR	Z,RDFAT0X
  EAA4  2170EF        		LD	HL,CHECK
  EAA7  A6            		AND	(HL)
  EAA8  77            		LD	(HL),A
  EAA9  110000        		LD	DE,0		;BPB
  EAAC  2A7CF0        		LD	HL,(_FATBF)
  EAAF  CDDBEB        		CALL	DRD16
  EAB2  3024          		JR	NC,GETBPB
  EAB4  2170EF        		LD	HL,CHECK
  EAB7  CB06          		RLC	(HL)
  EAB9  3F            		CCF
  EABA  D8            		RET	C
  EABB  DDCB0A1E      		RR	(IX+00AH)	;DPB_0A_FDMODE
  EABF  3F            		CCF			;フロッピーディスクのMFMモードを切り替える
  EAC0  DDCB0A16      		RL	(IX+00AH)	;DPB_0A_FDMODE
  EAC4  3EFF          		LD	A,0FFH
  EAC6  3289EF        		LD	(_DSK),A
  EAC9  3A84EF        		LD	A,(_DRIVE)
  EACC  E603          		AND	3
  EACE  F680          		OR	080H
  EAD0  6F            		LD	L,A
  EAD1  26EF          		LD	H,_CYL0/256
  EAD3  3EFF          		LD	A,0FFH
  EAD5  77            		LD	(HL),A
  EAD6  18BE          		JR	RDFAT1
  EAD8                	GETBPB:
  EAD8  FDE5          		PUSH	IY
  EADA  FD2A7CF0      		LD	IY,(_FATBF)	;BPB
  EADE  CDF1EF        		CALL	_BPB2DPB
  EAE1  FDE1          		POP	IY
  EAE3  D8            		RET	C
  EAE4  CD83EC        		CALL	CHGDRV2
  EAE7                	RDFAT0X:
  EAE7  CDCFEB        		CALL	RDFATS
  EAEA  D8            		RET	C
  EAEB  DDBE06        		CP	(IX+6)		;DPB_06_FATID
  EAEE  C8            		RET	Z
  EAEF  DDCB126E      		BIT	5,(IX+012H)	;DPB_12_DEVICE
  EAF3  C0            		RET	NZ		;BPBを取得している場合はFATIDをチェックしない
  EAF4  37            		SCF
  EAF5  C9            		RET
                      	
  EAF6                	BPB2DPB:
  EAF6  FD7E0B        		LD	A,(IY+11)	;BPB_BytsPerSec
  EAF9  B7            		OR	A
  EAFA  37            		SCF
  EAFB  C0            		RET	NZ
  EAFC                	BPBOK:
  EAFC  FD7E0D        		LD	A,(IY+13)	;BPB_SecPerClus
  EAFF  DD7707        		LD	(IX+7),A	;DPB_07_SECPCL
                      	
  EB02  FD7E16        		LD	A,(IY+22)	;BPB_FATSz16
  EB05  DD7700        		LD	(IX+0),A	;DPB_00_FATLN
  EB08  FD7E17        		LD	A,(IY+23)	;BPB_FATSz16
  EB0B  DD7701        		LD	(IX+1),A	;DPB_00_FATLN
                      	
  EB0E  FD6E0E        		LD	L,(IY+14)	;BPB_RsvdSecCnt
  EB11  FD660F        		LD	H,(IY+15)
  EB14  DD750E        		LD	(IX+00EH),L	;DPB_0E_FATPS
  EB17  FD5E16        		LD	E,(IY+22)	;BPB_FATSz16
  EB1A  FD5617        		LD	D,(IY+23)
  EB1D  FD4610        		LD	B,(IY+16)	;BPB_NumFATs
  EB20                	BPBDP1:				;BPB_FATSz16 * BPB_NumFATs
  EB20  19            		ADD	HL,DE
  EB21  10FD          		DJNZ	BPBDP1
  EB23                	BPBDP2:
  EB23  DD7510        		LD	(IX+010H),L	;DPB_10_DIRPS
  EB26  DD7411        		LD	(IX+011H),H
  EB29  E5            		PUSH	HL
                      	
  EB2A  FD6E11        		LD	L,(IY+17)	;BPB_RootEntCnt
  EB2D  FD6612        		LD	H,(IY+18)
  EB30  FD7E0C        		LD	A,(IY+12)	;BPB_BytsPerSec
  EB33  B7            		OR	A
  EB34  37            		SCF
  EB35  C8            		RET	Z
  EB36  0606          		LD	B,6
  EB38                	BPBBPS1:
  EB38  05            		DEC	B
  EB39  0F            		RRCA
  EB3A  30FC          		JR	NC,BPBBPS1
  EB3C                	BPBDE1:
  EB3C  29            		ADD	HL,HL
  EB3D  10FD          		DJNZ	BPBDE1
                      	
  EB3F  7C            		LD	A,H
  EB40  DD770B        		LD	(IX+00BH),A	;DPB_0B_DIRSCNT
                      	
  EB43  D1            		POP	DE		;DPB_10_DIRPS
  EB44  6C            		LD	L,H
  EB45  2600          		LD	H,0
  EB47  19            		ADD	HL,DE		;MAXDIR
  EB48  E5            		PUSH	HL
  EB49  FD4E0D        		LD	C,(IY+13)	;BPB_SecPerClus
  EB4C  CB21          		SLA	C		;*2
  EB4E  AF            		XOR	A
  EB4F  47            		LD	B,A
  EB50  ED42          		SBC	HL,BC
  EB52  DD7514        		LD	(IX+014H),L	;DPB_14_ADDCL16
  EB55  DD7415        		LD	(IX+015H),H
                      	
  EB58  D1            		POP	DE		;DE=DPB_0B_MAXDIR
  EB59  FD6E13        		LD	L,(IY+19)	;BPB_TotSec16
  EB5C  FD6614        		LD	H,(IY+20)
                      	
  EB5F  DDCB0A7E      		BIT	7,(IX+00AH)	;DPB_0A_FDMODE
  EB63  2817          		JR	Z,NOT_FD
  EB65  E5            		PUSH	HL
  EB66  FD4E18        		LD	C,(IY+24)	;BPB_SecPerTr
  EB69  DD710D        		LD	(IX+00DH),C	;DPB_0D_MAXSEC
  EB6C  AF            		XOR	A
  EB6D  47            		LD	B,A
  EB6E  CB21          		SLA	C		;両面なのでセクタ数を２倍
  EB70  2B            		DEC	HL
  EB71                	CNTSEC:				;MAXCYL = BPB_TotSec16 / (BPB_SecPerTr * 2)
  EB71  3C            		INC	A
  EB72  2804          		JR	Z,CNTSECE
  EB74  ED42          		SBC	HL,BC
  EB76  30F9          		JR	NC,CNTSEC
  EB78                	CNTSECE:
  EB78  DD770C        		LD	(IX+00CH),A	;DPB_0C_MAXCYL
  EB7B  E1            		POP	HL	;ここまでフロッピー専用
  EB7C                	NOT_FD:
  EB7C  7C            		LD	A,H
  EB7D  B5            		OR	L
  EB7E  3E00          		LD	A,0		;LDでフラグは変化しない。BPB_TotSec16を AHL で扱う為、Aに0を入れる
  EB80  2010          		JR	NZ,BPB16BIT	;BPB_TotSec16が「0」の場合はBPB_TotSec32で計算
  EB82  FD7E23        		LD	A,(IY+35)	;念のために総セクタ数が24ビットを超える場合はエラーを返す
  EB85  B7            		OR	A
  EB86  37            		SCF
  EB87  C0            		RET	NZ
  EB88  FD6E20        		LD	L,(IY+32)	;BPB_TotSec32 は AHL の24ビットで扱う
  EB8B  FD6621        		LD	H,(IY+33)	;1クラスタの論理セクタ数(DPB_07_SECPCL)が最大128なので
  EB8E  FD7E22        		LD	A,(IY+34)	;24ビットを超えると必ずクラスタ数が16ビットを超えてしまうのでこれで十分
  EB91  A7            		AND	A		;CF=0
  EB92                	BPB16BIT:
  EB92  ED52          		SBC	HL,DE
  EB94  DE00          		SBC	A,0
  EB96  FD460D        		LD	B,(IY+13)	;BPB_SecPerClus
  EB99                	BPBTC1:				;総クラスタ数(AHL) = 総セクタ数(AHL) / セクタサイズ(B)
  EB99  CB18          		RR	B		;->CY
  EB9B  3808          		JR	C,BPBTC2
  EB9D  CB3F          		SRL	A
  EB9F  CB1C          		RR	H		;AHL=AHL/2
  EBA1  CB1D          		RR	L
  EBA3  18F4          		JR	BPBTC1
  EBA5                	BPBTC2:
  EBA5  B7            		OR	A
  EBA6  37            		SCF
  EBA7  C0            		RET	NZ		;念のため(クラスタ数が16ビットを超える場合)
  EBA8  23            		INC	HL
  EBA9  23            		INC	HL
  EBAA  DD7508        		LD	(IX+8),L	;DPB_08_MAXCL
  EBAD  DD7409        		LD	(IX+9),H
                      	
  EBB0  FD7E15        		LD	A,(IY+21)	;BPB_Media
  EBB3  DD7706        		LD	(IX+6),A	;DPB_06_FATID
                      	
  EBB6  FD7E10        		LD	A,(IY+16)	;BPB_NumFATs
  EBB9  C6FE          		ADD	A,0-2		;>2:CF=1
  EBBB  FD7E0C        		LD	A,(IY+12)	;BPB_BytsPerSec
  EBBE  6F            		LD	L,A
  EBBF  3002          		JR	NC,BPBFAT1
  EBC1  F680          		OR	080H
  EBC3                	BPBFAT1:
  EBC3  DD770F        		LD	(IX+00FH),A	;DPB_0F_BPS
  EBC6  2D            		DEC	L		;以下のセクタサイズに合致しない場合はCF=1でエラーにする
  EBC7  C8            		RET	Z		;1セクタ256バイト
  EBC8  2D            		DEC	L
  EBC9  C8            		RET	Z		;1セクタ512バイト
  EBCA  2D            		DEC	L
  EBCB  2D            		DEC	L
  EBCC  C8            		RET	Z		;1セクタ1024バイト
  EBCD  37            		SCF
  EBCE  C9            		RET
                      	
  EBCF                	RDFATS:
  EBCF  CD15EC        		CALL	FATSETUP
  EBD2  D8            		RET	C
  EBD3  CDDFEB        		CALL	DRD24B
  EBD6  2A7CF0        		LD	HL,(_FATBF)
  EBD9  7E            		LD	A,(HL)
  EBDA  C9            		RET
                      	
  EBDB                	DRD16:
  EBDB  0E00          		LD	C,0
  EBDD                	DRD24:
  EBDD  0601          		LD	B,1
  EBDF                	DRD24B:
  EBDF  DDE5          		PUSH	IX
  EBE1  DD2AA8EF      		LD	IX,(_DPB)
  EBE5  CD3FEE        	DRDPAT:	CALL	FDRD		;自己書き換え（ディスク読み込み）
  EBE8                	POP_IX_RET:
  EBE8  DDE1          		POP	IX
  EBEA  C9            		RET
                      	
  EBEB                	DWT16:
  EBEB  0E00          		LD	C,0
  EBED                	DWT24:
  EBED  0601          		LD	B,1
  EBEF                	DWT24B:
  EBEF  DDE5          		PUSH	IX
  EBF1  DD2AA8EF      		LD	IX,(_DPB)
  EBF5  CD31EE        	DWTPAT:	CALL	FDWT		;自己書き換え（ディスク書き込み）
  EBF8  18EE          		JR	POP_IX_RET
                      	
  EBFA                	WTFAT:
  EBFA  CD15EC        		CALL	FATSETUP
  EBFD  D4EFEB        		CALL	NC,DWT24B
  EC00  D8            		RET	C
  EC01  DDCB0F7E      		BIT	7,(IX+00FH)	;DPB_0F_BPS
  EC05  C8            		RET	Z		;予備FATが無い
  EC06  CD1CEC        		CALL	FATS2
  EC09  E5            		PUSH	HL		;予備FAT
  EC0A  DD6E00        		LD	L,(IX+0)	;DPB_00_FATLN
  EC0D  DD6601        		LD	H,(IX+1)
  EC10  19            		ADD	HL,DE
  EC11  EB            		EX	DE,HL
  EC12  E1            		POP	HL
  EC13  18DA          		JR	DWT24B
                      	;------------------------
                      	;FATのセットアップ
                      	;out
                      	;	B  : FATセクタ数
                      	;	DE : FAT先頭セクタ番号
                      	;	HL : FATバッファポインタ
                      	;	CF : 1=ドライブ切り替えエラー
                      	;note
                      	;	FATサイズがFATバッファを超える場合は
                      	;	対象クラスタ領域==(_FATIX)によって
                      	;	FAT12:対象クラスタ1024毎に1.5KBを切り替える
                      	;	FAT16:対象クラスタ1024毎に2KBを切り替える
                      	;------------------------
  EC15                	FATSETUP:
  EC15  3AAAEF        		LD	A,(_FATDRV)
  EC18  CD24ED        		CALL	CHGDRVR		;ドライブ切り替え
  EC1B  D8            		RET	C
  EC1C                	FATS2:
  EC1C  DD7E0F        		LD	A,(IX+00FH)	;DPB_0F_BPS 512=2 1024=4
  EC1F  0F            		RRCA
  EC20  CD49EC        	FATSX:	CALL	FATSETUP12	;自己書き換え
  EC23  210000        		LD	HL,0
  EC26  4A            		LD	C,D
  EC27  54            		LD	D,H
  EC28  3AABEF        		LD	A,(_FATIX)	;範囲FAT12:0-3/FAT16:0-63(0-03FH):65535*2/2048
  EC2B  47            		LD	B,A
  EC2C  04            		INC	B
  EC2D  DD7E00        		LD	A,(IX+0)	;DPB_00_FATLN
  EC30                	FAT_SKP:
  EC30  05            		DEC	B
  EC31  2805          		JR	Z,FAT1
  EC33  19            		ADD	HL,DE
  EC34  93            		SUB	E
  EC35  30F9          		JR	NC,FAT_SKP
  EC37  C9            		RET
  EC38                	FAT1:
  EC38  EB            		EX	DE,HL
  EC39  B9            		CP	C		;C=FATバッファに読み込めるセクタ数
  EC3A  3801          		JR	C,FAT2
  EC3C  79            		LD	A,C
  EC3D                	FAT2:
  EC3D  47            		LD	B,A
                      	
  EC3E  2AFAF0        		LD	HL,(_FATPS)	;fat sector pos
  EC41  19            		ADD	HL,DE
  EC42  EB            		EX	DE,HL
  EC43  2A7CF0        		LD	HL,(_FATBF)
  EC46  AF            		XOR	A		;CF=0
  EC47  4F            		LD	C,A
  EC48  C9            		RET
                      	;
                      	;	FATバッファに読み込める最大のセクタ数と_FATIXで進めるセクタ数
                      	;	FATSETUP* (FAT12/FAT16)
                      	;out
                      	;	D : FATバッファに読み込める最大のセクタ数
                      	;	E : _FATIXで進めるセクタ数
  EC49                	FATSETUP12:
  EC49  110606        		LD	DE,0606H	;256
  EC4C  D8            		RET	C
  EC4D  110303        		LD	DE,0303H	;512
  EC50  0F            		RRCA
  EC51  D8            		RET	C
  EC52  110102        		LD	DE,0201H	;1024
  EC55  C9            		RET
                      	
  EC56                	FATSETUP16:
  EC56  110808        		LD	DE,0808H	;256
  EC59  D8            		RET	C
  EC5A  110404        		LD	DE,0404H
  EC5D  0F            		RRCA			;512
  EC5E  D8            		RET	C
  EC5F  110202        		LD	DE,0202H	;1024
  EC62  C9            		RET
                      	
  EC63                	CHGDRV:
  EC63  E5            		PUSH	HL
  EC64  2189EF        		LD	HL,_DSK
  EC67  BE            		CP	(HL)
  EC68  280A          		JR	Z,CHGDRVE
  EC6A                	CHGDRV1:
  EC6A  DDE5          		PUSH	IX
  EC6C  CD76EC        		CALL	CHGDRV0
  EC6F  3A89EF        		LD	A,(_DSK)
  EC72  DDE1          		POP	IX
  EC74                	CHGDRVE:
  EC74  E1            		POP	HL
  EC75  C9            		RET
                      	
  EC76                	CHGDRV0:
  EC76  6F            		LD	L,A
  EC77  CDDCEF        		CALL	_GETDPB
  EC7A  D8            		RET	C
  EC7B  DD22A8EF      		LD	(_DPB),IX
  EC7F  7D            		LD	A,L
  EC80  3289EF        		LD	(_DSK),A
  EC83                	CHGDRV2:
  EC83  C5            		PUSH	BC
  EC84  D5            		PUSH	DE
  EC85  ED73DAEC      		LD	(SPPAT2+1),SP
  EC89  F3            		DI
  EC8A  DDF9          		LD	SP,IX
                      	
  EC8C  E1            		POP	HL		;DPB_00_FATLN
  EC8D  E1            		POP	HL		;DPB_02_DRD
  EC8E  22E6EB        		LD	(DRDPAT+1),HL
                      	
  EC91  E1            		POP	HL
  EC92  22F6EB        		LD	(DWTPAT+1),HL	;DPB_04_DWT
                      	
  EC95  E1            		POP	HL		;L=DPB_06_FATID H=DPB_07_SECPCL
  EC96  7C            		LD	A,H
  EC97  32F5E2        		LD	(SPCPAT+1),A	;1クラスタの論理セクタ数
  EC9A  3D            		DEC	A
  EC9B  3285EA        		LD	(NCPAT+1),A
                      	
  EC9E  E1            		POP	HL		;DPB_08_MAXCL
  EC9F  7D            		LD	A,L
  ECA0  3214E3        		LD	(CLPAT2+1),A
  ECA3  7C            		LD	A,H
  ECA4  3210E3        		LD	(CLPAT1+1),A
  ECA7  2B            		DEC	HL
  ECA8  2218E5        		LD	(MAXCLP+1),HL
                      	
  ECAB  E1            		POP	HL		;L=DPB_0A_FDMODE H=DPB_0B_DIRSCNT
  ECAC  7D            		LD	A,L
  ECAD  F6FE          		OR	0FEH
  ECAF  32DAED        		LD	(FDMODE+1),A
  ECB2  07            		RLCA
  ECB3  E603          		AND	3
  ECB5  32C2ED        		LD	(FSPAT+1),A
  ECB8  4C            		LD	C,H
                      	
  ECB9  E1            		POP	HL		;L=DPB_0C_MAXCYL H=DPB_0D_MAXSEC
                      	
  ECBA  E1            		POP	HL		;L=DPB_0E_FATPS H=DPB_0F_BPS
  ECBB  7C            		LD	A,H		;DPB_0F_BPS
  ECBC  E607          		AND	7
  ECBE  3213E8        		LD	(SECSZ+2),A	;1セクタのサイズの上位1バイト 0x400 - 0x200 - 0x100
                      					;1セクタ512 2D/2DD/2HC/2HQ(2HD1.44MB)/EMM/BRAM/EMEM等
                      					;1セクタ1024 2HD/2HDE98
                      					;1セクタ256 GRAM/RAMF/CMOS/等
                      					;1024	512	256
                      					;4	2	1
  ECC1  87            		ADD	A,A		;8	4	2
  ECC2  87            		ADD	A,A		;010H	8	4
  ECC3  87            		ADD	A,A		;020H	010H	8
  ECC4  3271E1        		LD	(SDECPAT+1),A	;1セクタ辺りのディレクトリエントリ数
                      	
  ECC7  2600          		LD	H,0
  ECC9  22FAF0        		LD	(_FATPS),HL
                      	
  ECCC  E1            		POP	HL		;DPB_10_DIRPS
  ECCD  22FCF0        		LD	(_DIRPS),HL
                      	
  ECD0  E1            		POP	HL		;L=DPB_12_DEVICE H=DPB_13_UNITNO
  ECD1  7C            		LD	A,H
  ECD2  3284EF        		LD	(_DRIVE),A
                      	
  ECD5  E1            		POP	HL		;DPB_14_ADDCL16
  ECD6  2205E3        		LD	(CLSPAT+1),HL
                      	
  ECD9  310000        	SPPAT2:	LD	SP,0		;元のSPを復元
  ECDC  FB            		EI
  ECDD  2AFCF0        		LD	HL,(_DIRPS)
  ECE0  0600          		LD	B,0
  ECE2  09            		ADD	HL,BC		;C=DPB_0B_DIRSCNT
  ECE3  228CE1        		LD	(MD_PAT+1),HL
                      	
  ECE6  2A18E5        		LD	HL,(MAXCLP+1);
  ECE9  11F60F        		LD	DE,4086		;クラスタ数が4086未満:FAT12 4086以上:FAT16
  ECEC  ED52          		SBC	HL,DE		;CF=0のはず
  ECEE  300F          		JR	NC,SETFAT16
  ECF0  210BEA        		LD	HL,GNCL		;FAT12
  ECF3  112EEA        		LD	DE,SNCL
  ECF6  0149EC        		LD	BC,FATSETUP12
  ECF9  DDCB0FAE      		RES	5,(IX+00FH)	;DPB_0F_BPS(FAT12)
  ECFD  180D          		JR	EXTRA1
  ECFF                	SETFAT16:
  ECFF  2162EA        		LD	HL,GNCL16	;FAT16
  ED02  116FEA        		LD	DE,SNCL16
  ED05  0156EC        		LD	BC,FATSETUP16
  ED08  DDCB0FEE      		SET	5,(IX+00FH)	;DPB_0F_BPS(FAT16)
  ED0C                	EXTRA1:
  ED0C  22F8EF        		LD	(GNCPAT+1),HL
  ED0F  ED53FBEF      		LD	(SNCPAT+1),DE
  ED13  ED4321EC      		LD	(FATSX+1),BC
  ED17  D1            		POP	DE
  ED18  C1            		POP	BC
  ED19  AF            		XOR	A
  ED1A  C9            		RET
                      	
  ED1B                	GETDPBD:
  ED1B  DDE3          		EX	(SP),IX
  ED1D  DDE5          		PUSH	IX
  ED1F  3A88EF        		LD	A,(_DRV)
  ED22  1807          		JR	GETDPB1
                      	
  ED24                	CHGDRVR:
  ED24  CDD9EF        		CALL	_CHGDRV
  ED27  D8            		RET	C
  ED28  3A89EF        		LD	A,(_DSK)
  ED2B                	GETDPB1:
  ED2B  C3DCEF        		JP	_GETDPB
                      	
  ED2E                	GETDPB:
  ED2E  FE08          		CP	8
  ED30  3F            		CCF
  ED31  D8            		RET	C
  ED32  0F            		RRCA
  ED33  0F            		RRCA
  ED34  0F            		RRCA
  ED35  DD            		DB	0DDH		;Z80未定義命令
  ED36  6F            		LD	L,A		;LD	IXL,A
  ED37  DD            		DB	0DDH		;Z80未定義命令
  ED38  26F1          		LD	H,DEVICE/256	;LD	IXH,DEVICE/256
  ED3A  DD7E00        		LD	A,(IX+0)	;DPB_00_FATLN
  ED3D  A7            		AND	A		;CF=0の為
  ED3E  DDCB0F6E      		BIT	5,(IX+00FH)	;DPB_0F_BPS
  ED42  C0            		RET	NZ		;FAT16
  ED43  DDCB126E      		BIT	5,(IX+012H)	;DPB_12_DEVICE
  ED47  C0            		RET	NZ		;BPB
  ED48  FE01          		CP	001H		;A=0 THEN CF=1
  ED4A  C9            		RET
                      	
  ED4B                	_SYS5F:
  ED4B  AF            		XOR	A
  ED4C                	FFLUSH:
  ED4C  F5            		PUSH	AF
  ED4D  3EFF          		LD	A,0FFH
  ED4F  3239EF        		LD	(SFILE),A
  ED52  CD49E9        		CALL	DWTX
  ED55  3EFF          		LD	A,0FFH
  ED57  32A5EF        		LD	(_DBDRV),A
  ED5A  CD93E9        		CALL	WTFATX
  ED5D  AF            		XOR	A
  ED5E  32ABEF        		LD	(_FATIX),A
  ED61  2F            		CPL			;0FFH
  ED62  32AAEF        		LD	(_FATDRV),A
  ED65  F1            		POP	AF
  ED66  C9            		RET
                      	
                      	
                      	;X1DISK.ASM
                      	
                      	;	LSX-Dodgers DISK
                      	;	X1/turbo/Z
                      	
  ED67                	SEEK:
  ED67  0610          		LD	B,16
  ED69  DD4E0D        		LD	C,(IX+0DH)	;DPB_0D_MAXSEC
  ED6C  AF            		XOR	A
  ED6D  EB            		EX	DE,HL
  ED6E                	DIV1:
  ED6E  29            		ADD	HL,HL
  ED6F  8F            		ADC	A,A
  ED70  B9            		CP	C
  ED71  3802          		JR	C,DIV2
  ED73  91            		SUB	C
  ED74  2C            		INC	L
  ED75                	DIV2:
  ED75  10F7          		DJNZ	DIV1
                      	
  ED77  3C            		INC	A	;最小のセクタは１固定
  ED78  55            		LD	D,L	;TRACK
  ED79  5F            		LD	E,A	;SECTOR
  ED7A  CB3A          		SRL	D	;CYLINDER
  ED7C  9F            		SBC	A,A
  ED7D  E610          		AND	010H	;SIDE
  ED7F  4F            		LD	C,A
                      	
  ED80  3A84EF        		LD	A,(_DRIVE)
  ED83  FE04          		CP	4
  ED85  3F            		CCF
  ED86  D8            		RET	C
  ED87  B1            		OR	C
  ED88  3206EE        		LD	(MOPAT+1),A	;Motor off data
  ED8B  01FC0F        		LD	BC,00FFCH
  ED8E  F680          		OR	080H		;Motor on
  ED90  ED79          		OUT	(C),A
                      	
  ED92  CDD8ED        		CALL	SETMODE
  ED95  D8            		RET	C
                      	
  ED96  CD1BEE        		CALL	DRIVE
  ED99  FEFF          		CP	0FFH		;A=0FFH Unknown CYLINDER
  ED9B  CCFAED        		CALL	Z,FDCRES	;Restore
  ED9E  0EF9          		LD	C,0F9H
  EDA0  ED79          		OUT	(C),A		;Currrent CYLINDER
  EDA2  92            		SUB	D
  EDA3  C8            		RET	Z		;No seek
                      	
  EDA4  3A86EF        		LD	A,(_ISEEK)
  EDA7  4F            		LD	C,A
                      	
  EDA8  DD7E0C        		LD	A,(IX+00CH)	;DPB_0C_MAXCYL
  EDAB  3D            		DEC	A
  EDAC  BA            		CP	D		;Over CYLINDER
  EDAD  D8            		RET	C
                      	
  EDAE  B9            		CP	C		;for Built-in 2DD
  EDAF  3803          		JR	C,SETM2
  EDB1  78            		LD	A,B		;B=00FH
  EDB2  DBFE          		IN	A,(0FEH)		;2HD mode for 2DD seek
  EDB4                	SETM2:
  EDB4  78            		LD	A,B
  EDB5  DBFD          		IN	A,(0FDH)		;MFM mode
                      	
  EDB7  0EFB          		LD	C,0FBH
  EDB9  ED51          		OUT	(C),D
  EDBB  72            		LD	(HL),D
  EDBC  0E18          		LD	C,018H		;Seek
  EDBE                	FDCCMD2:
  EDBE  3A85EF        		LD	A,(_SEEKSP)
  EDC1  E6FF          	FSPAT:	AND	0FFH
  EDC3  B1            		OR	C
                      	
  EDC4                	FDCCMD:
  EDC4  CD11EE        		CALL	COMSET
                      	
  EDC7  3E80          	FDCPAT:	LD	A,080H		;FDC COMMAND(Self-modifying code)
  EDC9  E620          		AND	020H		;Write data Write track
  EDCB  3C            		INC	A
                      	
  EDCC                	SST:
  EDCC  0E00          		LD	C,0
  EDCE                	SST1:
  EDCE  0D            		DEC	C		; 4
  EDCF  20FD          		JR	NZ,SST1		;12 * 256 / 4 = About 1ms
  EDD1  3D            		DEC	A
  EDD2  20FA          		JR	NZ,SST1
                      	
  EDD4  3C            		INC	A		;A=1
  EDD5  CDE3ED        		CALL	READY
  EDD8                	SETMODE:
  EDD8  78            		LD	A,B		;B=00FH
  EDD9  DBFF          	FDMODE:	IN	A,(0FFH)	;Floppy mode(2D/2HD) (Self-modifying code)
                      	
  EDDB  78            		LD	A,B
  EDDC  DBFD          		IN	A,(0FDH)	;MFM mode
                      	
  EDDE  CD15EE        		CALL	DELAY0		;Head select time
  EDE1  3E81          		LD	A,081H
  EDE3                	READY:
  EDE3  32EDED        		LD	(WAITA+1),A
  EDE6  E5            		PUSH	HL
  EDE7  0EF8          		LD	C,0F8H
  EDE9  61            		LD	H,C
  EDEA                	READY2:
  EDEA  ED78          		IN	A,(C)
  EDEC  E681          	WAITA:	AND	081H		;NOT READY,BUSY
  EDEE  2808          		JR	Z,READYE
  EDF0  E3            		EX	(SP),HL		;wait 19clock
  EDF1  E3            		EX	(SP),HL		; //
  EDF2  2B            		DEC	HL
  EDF3  7C            		LD	A,H
  EDF4  B5            		OR	L
  EDF5  20F3          		JR	NZ,READY2
  EDF7  37            		SCF
  EDF8                	READYE:
  EDF8  E1            		POP	HL
  EDF9  C9            		RET
                      	
  EDFA                	FDCRES:
  EDFA  3600          		LD	(HL),0
  EDFC  0E08          		LD	C,8
  EDFE  18BE          		JR	FDCCMD2
                      	
  EE00                	FDMOFF:
  EE00  F5            		PUSH	AF
  EE01  C5            		PUSH	BC
  EE02  01FC0F        		LD	BC,00FFCH	;Motor off
  EE05  3E00          	MOPAT:	LD	A,000H		;(Self-rewriting)
  EE07  ED79          		OUT	(C),A
  EE09  C1            		POP	BC
  EE0A  F1            		POP	AF
  EE0B  C9            		RET
                      	
  EE0C                	SECSET:
  EE0C  01FA0F        		LD	BC,00FFAH
  EE0F  ED59          		OUT	(C),E
  EE11                	COMSET:
  EE11  0EF8          		LD	C,0F8H
  EE13  ED79          		OUT	(C),A
  EE15                	DELAY0:
  EE15  3E1A          		LD	A,26
  EE17                	DELAY:
  EE17  3D            		DEC	A
  EE18  20FD          		JR	NZ,DELAY
  EE1A  C9            		RET
                      	
  EE1B                	DRIVE:
  EE1B  2A84EF        		LD	HL,(_DRIVE)
  EE1E  26EF          		LD	H,_CYL0/256
  EE20  CBFD          		SET	7,L
  EE22  7E            		LD	A,(HL)
  EE23  C9            		RET
                      	
  EE24                	RNF:
  EE24  CD1BEE        		CALL	DRIVE
  EE27  36FF          		LD	(HL),0FFH
  EE29  C9            		RET
                      	
  EE2A  02            	RETRY:	DB	2
                      	
                      	
                      	;	FLOPPY DISK DRIVER(DMA)
                      	
                      	
  EE2B                	WTTRK:
  EE2B  0601          		LD	B,1
  EE2D  3EF4          		LD	A,0F4H
  EE2F  1802          		JR	WTTRK1
  EE31                	FDWT:
  EE31  3EA0          		LD	A,0A0H
  EE33                	WTTRK1:
  EE33  32C8ED        		LD	(FDCPAT+1),A
  EE36  3E10          		LD	A,16
  EE38  180C          		JR	DISK
                      	
  EE3A                	DISKOK:
  EE3A  0601          	FDCNT:	LD	B,1
  EE3C  100B          		DJNZ	DISK1
  EE3E  C9            		RET
                      	
  EE3F                	FDRD:
  EE3F  3E80          		LD	A,080H
  EE41  32C8ED        		LD	(FDCPAT+1),A
  EE44  3E0E          		LD	A,14
                      	
  EE46                	DISK:
  EE46  325DEE        		LD	(DMAPAT+1),A
  EE49                	DISK1:
  EE49  78            		LD	A,B
  EE4A  323BEE        		LD	(FDCNT+1),A
  EE4D  22B5EE        		LD	(DMAD+11),HL
  EE50                	DISKR:
  EE50  3E02          		LD	A,2		;Retry count
  EE52  322AEE        		LD	(RETRY),A
  EE55                	DISK2:
  EE55  D5            		PUSH	DE
  EE56  CD67ED        		CALL	SEEK
  EE59  3843          		JR	C,ERRF
  EE5B  F3            		DI
                      	
  EE5C  3E0E          	DMAPAT:	LD	A,14		;自己書き換え
  EE5E  21AAEE        		LD	HL,DMAD
  EE61  CD14DF        		CALL	SETDMA
  EE64  ED49          		OUT	(C),C		;OUT 01F87H,087H WR6 イネーブル
  EE66  3AC8ED        		LD	A,(FDCPAT+1)
  EE69  C5            		PUSH	BC
  EE6A  CD0CEE        		CALL	SECSET
  EE6D  2AB5EE        		LD	HL,(DMAHL)
  EE70  23            		INC	HL
  EE71  1106BB        		LD	DE,0BB06H	;READ DMA
                      	
  EE74  3E03          		LD	A,3
  EE76  CDE3ED        		CALL	READY
  EE79  ED78          		IN	A,(C)
                      	
  EE7B  C1            		POP	BC
  EE7C  ED51          		OUT	(C),D		;読み出しマスク設定
  EE7E  ED59          		OUT	(C),E		;バイトカウンタ(LH)
  EE80  ED58          		IN	E,(C)
  EE82  ED50          		IN	D,(C)
  EE84  19            		ADD	HL,DE
  EE85  D1            		POP	DE
  EE86  13            		INC	DE
  EE87  FB            		EI
  EE88  CD00EE        		CALL	FDMOFF
  EE8B  B7            		OR	A
  EE8C  28AC          		JR	Z,DISKOK
  EE8E  1B            		DEC	DE
  EE8F  CB67          		BIT	4,A
  EE91  C424EE        		CALL	NZ,RNF
  EE94                	DISKE2:
  EE94  212AEE        		LD	HL,RETRY
  EE97  35            		DEC	(HL)
  EE98  20BB          		JR	NZ,DISK2
  EE9A  B7            		OR	A
  EE9B  280A          		JR	Z,ERR
  EE9D  D5            		PUSH	DE
  EE9E                	ERRF:
  EE9E  D1            		POP	DE
  EE9F                	DELP:
  EE9F  CD24EE        		CALL	RNF
  EEA2  CD00EE        		CALL	FDMOFF
  EEA5  3EFF          		LD	A,0FFH
  EEA7                	ERR:
  EEA7  BF            		CP	A
  EEA8  37            		SCF
  EEA9  C9            		RET
                      	
                      				;X1turbo DISK DMA
  EEAA  C3            	DMAD:	DB	0C3H	;WR6 リセット
  EEAB  7D            		DB	07DH	;WR0 ポートA→ポートB 転送
  EEAC  FB0F          		DW	00FFBH	;ポートA開始アドレス FDC データレジスタ
  EEAE  FFFF          		DW	0FFFFH	;ブロック長(転送サイズ-1)
  EEB0  2C            		DB	02CH	;WR1 ポートAアドレス固定 I/O
  EEB1  10            		DB	010H	;WR2 ポートBインクリメント
  EEB2  80            		DB	080H	;WR3
  EEB3  92            		DB	092H	;WR5 WAIT RDY:LOW
  EEB4  8D            		DB	08DH	;WR4 バイト ポートB開始アドレス(LH)
  EEB5  0000          	DMAHL:	DW	0	;ポートB開始アドレス
  EEB7  CF            		DB	0CFH	;WR6 ロード
  EEB8  01            		DB	001H	;WR0 ポートB←ポートB 転送
  EEB9  CF            		DB	0CFH	;WR6 ロード
                      	
  EEBA                	DMAE:
                      	
  1E98                	AT_R	EQU	WTTRK-AT_DWT
                      	
                      	;LDWORK.ASM
                      	
                      	;	LSX-Dodgers WORK0
                      	;
                      	;	CP/M互換BIOS
                      	;	BOOT:アドレス下位1バイトが0になるように
  EEBA                	AT_WORK:
  EEBA                		DS	WORKAD-AT_WORK
                      	
  EF00                	CPM_BOOT:
  EF00  C30000        		JP	0
  EF03                	_SYS00:		;(BDOS)プログラム終了
  EF03                	CPM_WBOOT:
  EF03  C309D1        		JP	WBOOT1
  EF06                	CPM_CONST:
  EF06  C3BEDB        		JP	CONSTX
  EF09                	_SYS07:		;(BDOS)コンソール直接入力
  EF09                	CPM_CONIN:
  EF09  C365DB        		JP	FLGET
  EF0C                	CPM_CONOUT:
  EF0C  C305DE        		JP	CONOUT1
                      	
  EF0F                	DECBF:
  EF0F                		DS	5
  EF14  00            	FDRV	DB	0
  EF15                	FNAME	DS	36
  EF39                	SFILE:	DS	33		;DRV FILENAME
  EF5A                	HLBUF:	DS	3		;Random record buffer
                      	
  EF5D  0000          	LEFTX:	DW	0
  EF5F  0000          	DTAX:	DW	0
                      	
  EF61                	ZERO:
  EF61                	BEEPD:
  EF61  008E01000B000C		DB	0,08EH,1,0,00BH,0,00CH,010H
  EF69  073E08100D00FF		DB	007H,03EH,008H,010H,00DH,0,0FFH
  EF62                	RTC_YY	EQU	BEEPD+1
  EF63                	RTC_MW	EQU	BEEPD+2
  EF64                	RTC_DD	EQU	BEEPD+3
  EF65                	RTC_TT	EQU	BEEPD+4
  EF66                	RTC_MM	EQU	BEEPD+5
  EF67                	RTC_SS	EQU	BEEPD+6
                      	
  EF70  00            	CHECK:	DB	0
                      	
  EF71  4F4B24        	OK:	DB	"OK$"
  EF74                		DS	5
  EF79  4572726F722124	COMERM:	DB	"Error!$"
                      	;	システムワークエリア
                      	;	_CYL0:アドレス下位1バイトが080Hになるように
  EF80  FF            	_CYL0:	DB	0FFH	;Cylinder
  EF81  FF            	_CYL1:	DB	0FFH	;Cylinder
  EF82  FF            	_CYL2:	DB	0FFH	;Cylinder
  EF83  FF            	_CYL3:	DB	0FFH	;Cylinder
  EF84  00            	_DRIVE:	DB	0	;unit number
  EF85  00            	_SEEKSP:DB	0	;Seek speed
  EF86  FF            	_ISEEK:	DB	0FFH	;
  EF87  00            	_DVSW:	DB	0
  EF88  00            	_DRV:	DB	0
  EF89  FF            	_DSK:	DB	0FFH
  EF8A  8000          	_DTA:	DW	00080H
  EF8C  0000          	_CTC:	DW	0
  EF8E  0000          	_TXADR:	DW	0
  EF90  0000          	_KEYPS:	DW	0
  EF92  00FF          	_KEYD:	DW	0FF00H	;キーデータ
  EF94  C210          	_KEYSP:	DW	010C2H
  EF96  07            	_COLORF:DB	COLORF	;色
  EF97  18            	_LINE:	DB	LINE
                      	
  EF98  0000          	_FCB:	DW	0
  EF9A  0000          	_FBPS:	DW	0	;SEARCH FILES
  EF9C  0000          	_FBAD:	DW	0	;    //
  EF9E  00            	_FBCNT:	DB	0	;    //
  EF9F  00            	_FILEN:	DB	0
  EFA0  00            	_DIRF:	DB	0	;bit7:ディレクトリ bit0-6:セクタインデックス
  EFA1                		DS	1
  EFA2  00            	_WTFATF:DB	0	;FATバッファの更新フラグ
  EFA3                		DS	1
  EFA4  00            	_WTDBF:	DB	0	;データバッファの更新フラグ
  EFA5  FF            	_DBDRV:	DB	0FFH	;データバッファにあるデータを読み込んだドライブ
  EFA6  0000          	_DBSEC:	DW	0	;データバッファにあるデータを読み込んだセクタ番号
  EFA8  0000          	_DPB:	DW	0
  EFAA                	_FATDRV:
  EFAA  FF            		DB	0FFH	;FATバッファに読み込んでいるドライブ
  EFAB  00            	_FATIX:	DB	0	;FATバッファに読み込んでいるインデックス
  EFAC                	_FAKEFREE:
  EFAC  0000          		DW	0	;偽の残量（FATサイズが大きくなると重くなるのでその対策）
                      	
  EFAE                		DS	2
                      	
  EFB0                	CRTCD:	
  EFB0  6F            		DB	06FH
  EFB1                	_WIDTH:	
  EFB1  50            		DB	WIDTH
  EFB2                	TVRAMTOP:
  EFB2  5938          		DB	059H,038H
  EFB4  1F02          		DB	01FH,002H
  EFB6                	_LINE2:
  EFB6  19            		DB	019H
  EFB7                	WKE4:
  EFB7  1C            		DB	01CH
  EFB8                	WKE6:
  EFB8  00            		DB	000H
  EFB9                	WK40:
  EFB9  07            		DB	007H
  EFBA                	_PAGE_MINUS:
  EFBA  80F8          		DW	0-WIDTH*LINE
  EFBC                	_WIDTH_MINUS:
  EFBC  B0FF          		DW	0-WIDTH
  EFBE                	WK30:
  EFBE  0C            		DB	00CH
  EFBF                	WK31:
  EFBF                	WK1FD0:
  EFBF  20            		DB	020H
                      	
  EFC0  A9DA          	CTC0:	DW	INTCTCE
  EFC2  A9DA          	CTC1:	DW	INTCTCE
  EFC4  B1DA          	CTC2:	DW	INTCTC2
  EFC6  A9DA          	CTC3:	DW	INTCTCE
  EFC8  8CDA          	INTVEC:	DW	INT
                      	
                      	;	LSX-Dodgers 独自BIOS
                      	
  EFCA  C3EADF        	_INKEY:	JP	INKEY
  EFCD  C38CDC        	_PRINT:	JP	PRINT
  EFD0  C352DF        	_SCRN:	JP	SCRN
  EFD3  C37CDF        	_POS:	JP	POS
  EFD6  C3CEDD        	_LOC:	JP	LOC
  EFD9                	_CHGDRV:
  EFD9  C363EC        		JP	CHGDRV
  EFDC                	_GETDPB:
  EFDC  C32EED        		JP	GETDPB
  EFDF                	_FFLUSH:
  EFDF  C34CED        		JP	FFLUSH
  EFE2                	_RDFATX:
  EFE2  C369E9        		JP	RDFATX
  EFE5  C391EA        	_RDFAT:	JP	RDFAT
  EFE8  C32BEE        	_WTTRK:	JP	WTTRK
  EFEB  C33FEE        	_FDRD:	JP	FDRD
  EFEE  C331EE        	_FDWT:	JP	FDWT
  EFF1                	_BPB2DPB:
  EFF1  C3F6EA        		JP	BPB2DPB
  EFF4                		DS	3
  EFF7                	_GNCL:
  EFF7  C30BEA        	GNCPAT:	JP	GNCL		; self-modifying code
  EFFA                	_SNCL:
  EFFA  C32EEA        	SNCPAT:	JP	SNCL		; self-modifying code
  EFFD  C375D1        	_COMANL:JP	COMANL
                      	
  F000                	_WE:
                      	
                      	;LDCALL.ASM
                      	
                      	;	LSX-Dodgers システムコール(BDOS)
                      	;
                      	;	LSX-Dodgers SYSTEM CALL
                      	;	STABLE:アドレス下位1バイトが0になるように
                      	
  F000                	STABLE:
                      	;0
  F000  03EF38DB44DB9E		DW	_SYS00,_SYS01,_SYS02,_SYS03
  F008  E4D7E4D749DB09		DW	_SYS04,_SYS05,_SYS06,_SYS07
  F010  51DBE6D78ADBB6		DW	_SYS08,_SYS09,_SYS0A,_SYS0B
  F018  FBD700D80FD822		DW	_SYS0C,_SYS0D,_SYS0E,_SYS0F
                      	;1
  F020  76D8BDD806D93C		DW	_SYS10,_SYS11,_SYS12,_SYS13
  F028  44D95AD96FD967		DW	_SYS14,_SYS15,_SYS16,_SYS17
  F030  B6D9BBD9C0D9C6		DW	_SYS18,_SYS19,_SYS1A,_SYS1B
  F038  E4D7ECD9E4D7F0		DW	_SYS1C,_SYS1D,_SYS1E,_SYS1F
                      	;2
  F040  E4D7A6D9AED9F7		DW	_SYS20,_SYS21,_SYS22,_SYS23
  F048  1DDAE4D726E60B		DW	_SYS24,_ERROR,_SYS26,_SYS27
  F050  AED926DACCDB9E		DW	_SYS28,_SYS5C,_SYS2A,_SYS2B
  F058  EFDB9EE1E4D749		DW	_SYS2C,_SYS2D,_SYS2E,_SYS2F
                      	;3
  F060  43DAE4D7E4D7E4		DW	_SYS30,_ERROR,_ERROR,_ERROR
  F068  E4D7E4D7E4D7E4		DW	_ERROR,_ERROR,_ERROR,_ERROR
  F070  E4D79EE19EE16A		DW	_ERROR,_SYS39,_SYS3A,_SYS5A
                      	;DOS2
  F078  C7D7          		DW	_DOS2
                      	
  F07A                		DS	2
  F07C  00F2          	_FATBF:	DW	FATBF
  F07E  00FA          	_DTBUF:	DW	DTBUF
                      	
                      	;	コントロールコードテーブル
                      	;	CTRLTB:アドレス下位1バイトが080Hになるように
                      	
  F080                	CTRLTB:
  F080  43DD43DD7FDDC6		DW	CTRL00,CTRL00,CTRL02,CTRL03	;  A,B,C
  F088  C0DEA3DD9FDE26		DW	CTRL04,CTRL05,CTRL06,CTRL07	;D,E,F,G
  F090  4FDD70DDC9DEE4		DW	CTRL08,CTRL09,CTRL0A,CTRL0B	;H,I,J,K
  F098  9CDEC9DDDEDE43		DW	CTRL0C,CTRL0D,CTRL0E,CTRL00	;L,M,N,O
  F0A0  43DD43DDDCDD43		DW	CTRL00,CTRL00,CTRL12,CTRL00	;P,Q,R,S
  F0A8  43DD43DD43DD43		DW	CTRL00,CTRL00,CTRL00,CTRL00	;T,U,V,W
  F0B0  43DD43DD9CDEEB		DW	CTRL00,CTRL00,CTRL0C,CTRL1B	;X,Y,Z,ESC
  F0B8  6ADD56DD5FDDC9		DW	CTRL1C,CTRL1D,CTRL1E,CTRL1F	;→,←,↑,↓
                      	
  F0C0                		DS	02AH
                      	
  F0EA  1617          	SDDATA:	DB	22,23		;(FCB)ファイルを最後に変更した時刻
  F0EC  1415          		DB	20,21		;(FCB)ファイルを最後に変更した日付
  F0EE  1A1B          		DB	26,27		;(FCB)ファイルの先頭クラスタ
  F0F0  10111213      		DB	16,17,18,19	;(FCB)ファイルのサイズ(バイト単位)
  F0F4                	SDDATAE:
                      	
  F0F4                	SCDIR:	DS	2		;+14 +15
  F0F6                	SFBPS:	DS	2		;FBPS
  F0F8                	SFNDF:	DS	2		;FILEN DIRF
                      	
  F0FA  0000          	_FATPS:	DW	0
  F0FC  0000          	_DIRPS:	DW	0
  F0FE  0000          	_CLPS:	DW	0
                      	
  F100                	_PE:
                      	
                      	;X1DPB.ASM
                      	
                      	;	LSX-Dodgers DPB
                      	;	X1/turbo/Z
                      	
  F100                	DEVICE:
                      	
                      	;	A:
                      	
  F100  0200          		DW	2	;DPB_00_FATLN
  F102  EBEF          		DW	_FDRD	;DPB_02_DRD
  F104  EEEF          		DW	_FDWT	;DPB_04_DWT
  F106  FD            		DB	0FDH	;DPB_06_FATID
  F107  02            		DB	2	;DPB_07_SECPCL
  F108  6401          		DW	356	;DPB_08_MAXCL
  F10A  FF            		DB	0FFH	;DPB_0A_FDMODE	0FFH=2D / 0FEH=2HD
  F10B  07            		DB	7	;DPB_0B_DIRSCNT
  F10C  28            		DB	40	;DPB_0C_MAXCYL
  F10D  09            		DB	9	;DPB_0D_MAXSEC	Number of sectors
  F10E  01            		DB	1	;DPB_0E_FATPS
  F10F  82            		DB	082H	;DPB_0F_BPS
  F110  0500          		DW	5	;DPB_10_DIRPS
  F112  A7            		DB	0A7H	;DPB_12_DEVICE	Device Number
  F113  00            		DB	0	;DPB_13_UNITNO
  F114  0800          		DW	8	;DPB_14_ADDCL16
  F116  0000          		DW	0	;DPB_16
  F118  0000          		DW	0	;DPB_18
  F11A  0000          		DW	0	;DPB_1A_SDIR
  F11C  46444430      		DB	"FDD0"	;DPB_1C_NAME
                      	
                      	;	B:
                      	
  F120  0200          		DW	2	;DPB_00_FATLN
  F122  EBEF          		DW	_FDRD	;DPB_02_DRD
  F124  EEEF          		DW	_FDWT	;DPB_04_DWT
  F126  FD            		DB	0FDH	;DPB_06_FATID
  F127  02            		DB	2	;DPB_07_SECPCL
  F128  6401          		DW	356	;DPB_08_MAXCL
  F12A  FF            		DB	0FFH	;DPB_0A_FDMODE	0FFH=2D / 0FEH=2HD
  F12B  07            		DB	7	;DPB_0B_DIRSCNT
  F12C  28            		DB	40	;DPB_0C_MAXCYL
  F12D  09            		DB	9	;DPB_0D_MAXSEC	Number of sectors
  F12E  01            		DB	1	;DPB_0E_FATPS
  F12F  82            		DB	082H	;DPB_0F_BPS
  F130  0500          		DW	5	;DPB_10_DIRPS
  F132  A7            		DB	0A7H	;DPB_12_DEVICE	Device Number
  F133  01            		DB	1	;DPB_13_UNITNO
  F134  0800          		DW	8	;DPB_14_ADDCL16
  F136  0000          		DW	0	;DPB_16
  F138  0000          		DW	0	;DPB_18
  F13A  0000          		DW	0	;DPB_1A_SDIR
  F13C  46444431      		DB	"FDD1"	;DPB_1C_NAME
                      	
                      	;	C:
                      	
  F140  0200          		DW	2	;DPB_00_FATLN
  F142  EBEF          		DW	_FDRD	;DPB_02_DRD
  F144  EEEF          		DW	_FDWT	;DPB_04_DWT
  F146  FD            		DB	0FDH	;DPB_06_FATID
  F147  02            		DB	2	;DPB_07_SECPCL
  F148  6401          		DW	356	;DPB_08_MAXCL
  F14A  FF            		DB	0FFH	;DPB_0A_FDMODE	0FFH=2D / 0FEH=2HD
  F14B  07            		DB	7	;DPB_0B_DIRSCNT
  F14C  28            		DB	40	;DPB_0C_MAXCYL
  F14D  09            		DB	9	;DPB_0D_MAXSEC	Number of sectors
  F14E  01            		DB	1	;DPB_0E_FATPS
  F14F  82            		DB	082H	;DPB_0F_BPS
  F150  0500          		DW	5	;DPB_10_DIRPS
  F152  A7            		DB	0A7H	;DPB_12_DEVICE	Device Number
  F153  02            		DB	2	;DPB_13_UNITNO
  F154  0800          		DW	8	;DPB_14_ADDCL16
  F156  0000          		DW	0	;DPB_16
  F158  0000          		DW	0	;DPB_18
  F15A  0000          		DW	0	;DPB_1A_SDIR
  F15C  46444432      		DB	"FDD2"	;DPB_1C_NAME
                      	
                      	;	D:
                      	
  F160  0200          		DW	2	;DPB_00_FATLN
  F162  EBEF          		DW	_FDRD	;DPB_02_DRD
  F164  EEEF          		DW	_FDWT	;DPB_04_DWT
  F166  FD            		DB	0FDH	;DPB_06_FATID
  F167  02            		DB	2	;DPB_07_SECPCL
  F168  6401          		DW	356	;DPB_08_MAXCL
  F16A  FF            		DB	0FFH	;DPB_0A_FDMODE	0FFH=2D / 0FEH=2HD
  F16B  07            		DB	7	;DPB_0B_DIRSCNT
  F16C  28            		DB	40	;DPB_0C_MAXCYL
  F16D  09            		DB	9	;DPB_0D_MAXSEC	Number of sectors
  F16E  01            		DB	1	;DPB_0E_FATPS
  F16F  82            		DB	082H	;DPB_0F_BPS
  F170  0500          		DW	5	;DPB_10_DIRPS
  F172  A7            		DB	0A7H	;DPB_12_DEVICE
  F173  03            		DB	3	;DPB_13_UNITNO
  F174  0800          		DW	8	;DPB_14_ADDCL16
  F176  0000          		DW	0	;DPB_16
  F178  0000          		DW	0	;DPB_18
  F17A  0000          		DW	0	;DPB_1A_SDIR
  F17C  46444433      		DB	"FDD3"	;DPB_1C_NAME
                      	
                      	;	E:
                      	
  F180  0000          	EMMFL:	DW	0	;DPB_00_FATLN
  F182  6DD7          	EMMRD:	DW	EDRD	;DPB_02_DRD
  F184  69D7          	EMMWR:	DW	EDWT	;DPB_04_DWT
  F186  FE            		DB	0FEH	;DPB_06_FATID
  F187  02            		DB	2	;DPB_07_SECPCL
  F188  0000          	EMMCL:	DW	0	;DPB_08_MAXCL
  F18A  00            		DB	0	;DPB_0A_FDMODE
  F18B  0C            		DB	12	;DPB_0B_DIRSCNT
  F18C  00            		DB	0	;DPB_0C_MAXCYL
  F18D  00            		DB	0	;DPB_0D_MAXSEC
  F18E  02            		DB	2	;DPB_0E_FATPS
  F18F  02            		DB	2	;DPB_0F_BPS
  F190  0A00          		DW	10	;DPB_10_DIRPS
  F192  06            	EMMDV:	DB	6	;DPB_12_DEVICE
  F193  00            		DB	0	;DPB_13_UNITNO
  F194  1200          		DW	18	;DPB_14_ADDCL16
  F196  0000          		DW	0	;DPB_16
  F198  0000          		DW	0	;DPB_18
  F19A  0000          		DW	0	;DPB_1A_SDIR
  F19C  454D4D30      		DB	"EMM0"	;DPB_1C_NAME
                      	
                      	;	F:
                      	
  F1A0  0000          	BANKFL:	DW	0	;DPB_00_FATLN
  F1A2  04D7          		DW	BDRD	;DPB_02_DRD
  F1A4  00D7          		DW	BDWT	;DPB_04_DWT
  F1A6  F9            		DB	0F9H	;DPB_06_FATID
  F1A7  02            		DB	2	;DPB_07_SECPCL
  F1A8  0000          	BANKCL:	DW	0	;DPB_08_MAXCL
  F1AA  00            		DB	0	;DPB_0A_FDMODE
  F1AB  08            		DB	8	;DPB_0B_DIRSCNT
  F1AC  00            		DB	0	;DPB_0C_MAXCYL
  F1AD  01            		DB	1	;DPB_0D_MAXSEC
  F1AE  00            		DB	0	;DPB_0E_FATPS
  F1AF  02            		DB	2	;DPB_0F_BPS
  F1B0  0200          		DW	2	;DPB_10_DIRPS
  F1B2  0B            	BANKDV:	DB	00BH	;DPB_12_DEVICE
  F1B3  00            		DB	0	;DPB_13_UNITNO
  F1B4  0600          		DW	6	;DPB_14_ADDCL16
  F1B6  0000          		DW	0	;DPB_16
  F1B8  0000          		DW	0	;DPB_18
  F1BA  0000          		DW	0	;DPB_1A_SDIR
  F1BC  4252414D      		DB	"BRAM"	;DPB_1C_NAME
                      	
                      	;	G:
                      	
  F1C0  0200          		DW	2	;DPB_00_FATLN
  F1C2  C1D6          		DW	GDRD	;DPB_02_DRD
  F1C4  D8D6          		DW	GDWT	;DPB_04_DWT
  F1C6  FA            		DB	0FAH	;DPB_06_FATID
  F1C7  01            		DB	1	;DPB_07_SECPCL
  F1C8  B800          		DW	184	;DPB_08_MAXCL
  F1CA  00            		DB	0	;DPB_0A_FDMODE
  F1CB  07            		DB	7	;DPB_0B_DIRSCNT
  F1CC  00            		DB	0	;DPB_0C_MAXCYL
  F1CD  01            		DB	1	;DPB_0D_MAXSEC
  F1CE  01            		DB	1	;DPB_0E_FATPS
  F1CF  01            		DB	1	;DPB_0F_BPS
  F1D0  0300          		DW	3	;DPB_10_DIRPS
  F1D2  05            		DB	5	;DPB_12_DEVICE
  F1D3  01            		DB	1	;DPB_13_UNITNO
  F1D4  0800          		DW	8	;DPB_14_ADDCL16
  F1D6  0000          		DW	0	;DPB_16
  F1D8  0000          		DW	0	;DPB_18
  F1DA  0000          		DW	0	;DPB_1A_SDIR
  F1DC  4752414D      		DB	"GRAM"	;DPB_1C_NAME
                      	
                      	;	H:
  F1E0                		DS	32-8
  F1F8  00            		DB	0
                      	
                      	
  F1F9                	LAST_ADR:
                      	
  F1F9                		END
