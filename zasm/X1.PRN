			  Z80 ASSEMBLER - ZASM VER 1.6
                      	;	LSX-Dodgers for X1/turbo/Z
                      	;	Programmed by
                      	;	Gaku (Lovers/Tablacus)
                      	;X1DEF.ASM
                      	
                      	;	LSX-Dodgers DEF
                      	;	X1/turbo/Z
                      	
  0000                	MAC	EQU	0		;X1
  0000                	DEV	EQU	0
                      	
  011D                	VER_6F	EQU	0011DH
  00A0                	NBSP	EQU	0A0H
                      	
  CC00                	RUN	EQU	0CC00H
  D206                	BDOS	EQU	0D206H
  F000                	WORKAD	EQU	0F000H
  F300                	FATBF	EQU	0F300H
  FB00                	DTBUF	EQU	0FB00H
  FF00                	KEYBF	EQU	0FF00H
  FF20                	KBUF	EQU	0FF20H
  FFCA                	EXTSP	EQU	0FFCAH
  FFD9                	TRAP38	EQU	0FFD9H
  0050                	WIDTH	EQU	80
  0018                	LINE	EQU	24
  0007                	COLORF	EQU	7
  0010                	KEYSP_H	EQU	16
  00C2                	KEYSP_L	EQU	0C2H
  0009                	COMS	EQU	9
                      	
                      	
                      	;LDDEF.ASM
                      	
                      	;	LSX-Dodgers DEF
                      	
  0001                	VER_1   EQU	1
  0005                	VER_2   EQU	5
  0007                	VER_3   EQU	7
  1D00                	MACW	EQU	MAC + 01D00H	;機種フラグとLD判別フラグ
  0000                	MACD	EQU	MAC + DEV * 256	;機種フラグとデバイスフラグ
  0157                	VER	EQU	VER_1 * 256 + VER_2 * 16 + VER_3
                      	
  0005                	SYSTEM	EQU	00005H
  000F                	JP_HL	EQU	0000FH
  005C                	FCB1	EQU	0005CH
  006C                	FCB2	EQU	0006CH
  005D                	FCB1FN	EQU	FCB1+1
  006D                	FCB2FN	EQU	FCB2+1
  0080                	DTA1	EQU	00080H
                      	
  FFCA                	EXTBIO	EQU	0FFCAH
                      	
  0000                	DPB_FATLN	EQU	00H
  0002                	DPB_DRD		EQU	02H
  0004                	DPB_DWT		EQU	04H
  0006                	DPB_FATID	EQU	06H
  0007                	DPB_SECPCL	EQU	07H
  0008                	DPB_MAXCL	EQU	08H
  000A                	DPB_FDMODE	EQU	0AH
  000B                	DPB_DIRSCNT	EQU	0BH
  000C                	DPB_MAXCYL	EQU	0CH
  000D                	DPB_MAXSEC	EQU	0DH
  000E                	DPB_FATPS	EQU	0EH
  000F                	DPB_BPS		EQU	0FH
  0010                	DPB_DIRPS	EQU	10H
  0012                	DPB_DEVICE	EQU	12H
  0013                	DPB_UNITNO	EQU	13H
  0014                	DPB_ADDCL	EQU	14H
                      	
  001A                	DPB_SDIR	EQU	1AH
  001C                	DPB_NAME	EQU	1CH
                      	
                      	
                      	
  CBF9                		ORG	RUN-7
                      	
                      	;	MSX BINARY HEADER
  CBF9  FE            		DB	0FEH
                      	;	MSX BINARY START ADDRESS
  CBFA  00CC          		DW	RUN
                      	;	MSX BINARY END ADDRESS
  CBFC  F9F2          		DW	LAST_ADR
                      	;	MSX BINARY EXEC ADDRESS
  CBFE  07CC          		DW	START
                      	;X1INIT.ASM
                      	
                      	;	LSX-Dodgers INIT
                      	;	X1/turbo/Z
                      	
  CC00  C307CC        		JP	START
  CC03  001D          		DW	MACW
  CC05  5701          		DW	VER
                      	
  CC07                	START:
  CC07  F3            		DI
  CC08  ED5E          		IM	2
  CC0A  31CAFF        		LD	SP,EXTSP
  CC0D  CD1BCC        		CALL	INIT		;NZならAUTOEXECを実行
  CC10  210000        		LD	HL,0
  CC13  E5            		PUSH	HL
  CC14  C8            		RET	Z
  CC15  1199CF        		LD	DE,AUTOD
  CC18  C3FDF0        		JP	_COMANL
                      	
  CC1B                	INIT:
  CC1B  3E1E          		LD	A,01EH
  CC1D  D300          		OUT	(0),A
                      	
  CC1F  010000        		LD	BC,0
  CC22  ED438CF0      		LD	(_CTC),BC
  CC26  01040A        		LD	BC,00A04H
  CC29  CD43CF        		CALL	CHKCTC
  CC2C  010407        		LD	BC,00704H
  CC2F  CD43CF        		CALL	CHKCTC
  CC32  01A81F        		LD	BC,01FA8H
  CC35  CD43CF        		CALL	CHKCTC
  CC38  01A01F        		LD	BC,01FA0H
  CC3B  CD43CF        		CALL	CHKCTC
                      	;
  CC3E                	INISIO:
  CC3E  01911F        		LD	BC,01F91H	;INIT SIO
  CC41  1601          		LD	D,1
  CC43  ED51          		OUT	(C),D
                      	
  CC45  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  CC47  0E93          		LD	C,093H
  CC49  ED51          		OUT	(C),D
  CC4B  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  CC4D  0E99          		LD	C,099H		;INIT SIO
  CC4F  1601          		LD	D,1
  CC51  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  CC53  0E9B          		LD	C,09BH
  CC55  ED51          		OUT	(C),D
  CC57  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
                      	
  CC59  0E80          		LD	C,080H		;INIT DMA
  CC5B  2106C3        		LD	HL,0C306H
  CC5E                	INIDMA:
  CC5E  ED61          		OUT	(C),H
  CC60  2D            		DEC	L
  CC61  20FB          		JR	NZ,INIDMA
                      	
  CC63  3EE4          		LD	A,0E4H
  CC65  CDD9DE        		CALL	COMOUT
  CC68  AF            		XOR	A
  CC69  CDB3DE        		CALL	OT49SB
                      	
  CC6C  3EF0          		LD	A,INTVEC/256
  CC6E  ED47          		LD	I,A
                      	
  CC70  ED4B8CF0      		LD	BC,(_CTC)
  CC74  0D            		DEC	C
  CC75  0D            		DEC	C
                      	
  CC76  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  CC78  3EC0          		LD	A,CTC0-CPM_BOOT
  CC7A  ED79          		OUT	(C),A
                      	
  CC7C  0C            		INC	C
  CC7D  3E47          		LD	A,047H
  CC7F  ED79          		OUT	(C),A
  CC81  3E0D          		LD	A,13		;Baudrate 9600-13
  CC83  ED79          		OUT	(C),A
                      	
  CC85  79            		LD	A,C
  CC86  D610          		SUB	010H
  CC88  4F            		LD	C,A
                      	;	LD	(SIOAD+1),BC
                      	;	LD	(SIOAD0+1),BC
                      	;	LD	(SIOAD1+1),BC
                      	
  CC89  21E9CF        		LD	HL,SIODATA
  CC8C                	SINIT1:
  CC8C  7E            		LD	A,(HL)
  CC8D  23            		INC	HL
  CC8E  FEFF          		CP	0FFH
  CC90  2804          		JR	Z,SINIT2
  CC92  ED79          		OUT	(C),A
  CC94  18F6          		JR	SINIT1
  CC96                	SINIT2:
  CC96  3EE4          		LD	A,0E4H
  CC98  CDD9DE        		CALL	COMOUT
  CC9B  3EC8          		LD	A,INTVEC-CPM_BOOT
  CC9D  CDB3DE        		CALL	OT49SB
                      	;
  CCA0  01C41F        		LD	BC,01FC4H
  CCA3  3E0C          		LD	A,00CH
  CCA5  ED79          		OUT	(C),A
                      	
  CCA7  0EC0          		LD	C,0C0H
  CCA9  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
                      	
  CCAB  0C            		INC	C
  CCAC  3E28          		LD	A,40
  CCAE  ED79          		OUT	(C),A
                      	
  CCB0  0C            		INC	C
  CCB1  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
                      	
  CCB3  0C            		INC	C
  CCB4  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
                      	
  CCB6  0EC5          		LD	C,0C5H
  CCB8  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
                      	
  CCBA                	TEXT:
  CCBA  0EB0          		LD	C,0B0H
  CCBC  3E80          		LD	A,080H
  CCBE  ED79          		OUT	(C),A
  CCC0  1607          		LD	D,7
  CCC2  0EB9          		LD	C,0B9H
  CCC4  21E2CF        		LD	HL,TEXTDT
  CCC7                	TEXT1:
  CCC7  04            		INC	B
  CCC8  EDA3          		OUTI
  CCCA  0C            		INC	C
  CCCB  15            		DEC	D
  CCCC  20F9          		JR	NZ,TEXT1
  CCCE  01B01F        		LD	BC,01FB0H
  CCD1  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
                      	
  CCD3  0EC4          		LD	C,0C4H
  CCD5  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
                      	
  CCD7  01011A        		LD	BC,01A01H
  CCDA  ED78          		IN	A,(C)
  CCDC  E608          		AND	8
  CCDE  2809          		JR	Z,PRN
  CCE0  0E03          		LD	C,003H
  CCE2  3E0F          		LD	A,00FH
  CCE4  ED79          		OUT	(C),A
  CCE6  01040A        		LD	BC,00A04H
  CCE9                	PRN:
  CCE9  210000        		LD	HL,0
  CCEC  065C          		LD	B,05CH
  CCEE  3EFF          		LD	A,0FFH		;RST 38H
  CCF0  CD33E1        		CALL	FILL_MEMORY
  CCF3  06A4          		LD	B,0A4H
  CCF5  AF            		XOR	A
  CCF6  CD33E1        		CALL	FILL_MEMORY
                      	
  CCF9  3EC3          		LD	A,0C3H		;JP
  CCFB  2103F0        		LD	HL,CPM_WBOOT
  CCFE  320000        		LD	(00000H),A
  CD01  220100        		LD	(00001H),HL	;IPL
                      	
  CD04  21001D        		LD	HL,MACW	;3 bit7  DPB Compatible LA(1)
  CD07  220300        		LD	(00003H),HL	;  bit6-0 Machine X1(0)
                      	;				;4 LSX-Dodgers(01DH)
  CD0A  2106D2        		LD	HL,BDOS
  CD0D  320500        		LD	(00005H),A
  CD10  220600        		LD	(00006H),HL	;BDOS
                      	
  CD13  21F5DA        		LD	HL,BIOS
  CD16  221900        		LD	(00019H),HL	;BIOS-ROM
                      	
  CD19  21D9FF        		LD	HL,TRAP38	;TRAP38
  CD1C  323800        		LD	(00038H),A
  CD1F  223900        		LD	(00039H),HL	;RST 038H
                      	
  CD22  3EF0          		LD	A,CPM_BOOT/256
  CD24  320B00        		LD	(0000BH),A
                      	
  CD27  3EE9          		LD	A,0E9H		;JP (HL)
  CD29  320F00        		LD	(0000FH),A
                      	
  CD2C  3EE6          		LD	A,0E6H
  CD2E  CDD9DE        		CALL	COMOUT
  CD31  CDBEDE        		CALL	IN49SB
  CD34  F5            		PUSH	AF
  CD35  CDBEDE        		CALL	IN49SB
  CD38  F1            		POP	AF
  CD39  F5            		PUSH	AF
  CD3A  E612          		AND	012H
  CD3C  2005          		JR	NZ,KEYR
  CD3E  3E01          		LD	A,1
  CD40  3296CE        		LD	(KEYREP+1),A
  CD43                	KEYR:
  CD43  F1            		POP	AF
  CD44  E603          		AND	3
  CD46  280E          		JR	Z,NON
                      	
  CD48  01D03F        		LD	BC,03FD0H
  CD4B  ED49          		OUT	(C),C
  CD4D  3E37          		LD	A,037H
  CD4F  D3D0          		OUT	(0D0H),A
  CD51  ED78          		IN	A,(C)
  CD53  B9            		CP	C
  CD54  2865          		JR	Z,TURBO
  CD56                	NON:
  CD56  211CD0        		LD	HL,AT_SCR1
  CD59  1163DF        		LD	DE,SCR1
  CD5C  019400        		LD	BC,SCRNE-SCR1	;転送先のサイズ確認用
  CD5F  018500        		LD	BC,AT_SCRE-AT_SCR1
  CD62  EDB0          		LDIR
                      	
  CD64  21A1D0        		LD	HL,AT_DWT
  CD67  11BBEE        		LD	DE,WTTRK
  CD6A  018F00        		LD	BC,DMAE-WTTRK	;転送先のサイズ確認用
  CD6D  018E00        		LD	BC,AT_CPUE-AT_DWT
  CD70  EDB0          		LDIR
                      	
  CD72  212FD1        		LD	HL,AT_EDWT
  CD75  11E4D7        		LD	DE,EDWT
  CD78  014B00        		LD	BC,EMME-EDWT	;転送先のサイズ確認用
  CD7B  014600        		LD	BC,AT_EMME-AT_EDWT
  CD7E  EDB0          		LDIR
                      	
  CD80  21DEDF        		LD	HL,AT_WTTRK+AT_RS
  CD83  22E9F0        		LD	(_WTTRK+1),HL
  CD86  2104EF        		LD	HL,AT_DRD+AT_R
  CD89  22ECF0        		LD	(_FDRD+1),HL
  CD8C  21BBEE        		LD	HL,AT_DWT+AT_R
  CD8F  22EFF0        		LD	(_FDWT+1),HL
  CD92  21F8D7        		LD	HL,AT_EDRD+AT_RE
  CD95  2282F2        		LD	(EMMRD),HL
  CD98  21E4D7        		LD	HL,AT_EDWT+AT_RE
  CD9B  2284F2        		LD	(EMMWR),HL
  CD9E  21E5DF        		LD	HL,AT_SCRN+AT_RS
  CDA1  22D1F0        		LD	(_SCRN+1),HL
                      	
  CDA4  3E27          		LD	A,027H			;ノンターボはMFM切り替えを行わない
  CDA6  3212F2        		LD	(_DEVICE+012H),A		;Aドライブ
  CDA9  3232F2        		LD	(_DEVICE+012H+32),A	;Bドライブ
  CDAC  3252F2        		LD	(_DEVICE+012H+32*2),A	;Cドライブ
  CDAF  3272F2        		LD	(_DEVICE+012H+32*3),A	;Dドライブ
                      	
  CDB2  210000        		LD	HL,0
  CDB5  2204DF        		LD	(X1PAT),HL
  CDB8  C344CE        		JP	NOBANK
                      	
  CDBB                	TURBO:
  CDBB  F3            		DI			;Check BIOS
  CDBC  061D          		LD	B,01DH
  CDBE  ED79          		OUT	(C),A		;BIOS ON
  CDC0  3A512F        		LD	A,(02F51H)
  CDC3  04            		INC	B		;B=01EH
  CDC4  ED79          		OUT	(C),A		;BIOS OFF
  CDC6  FB            		EI
  CDC7  FEC9          		CP	0C9H
  CDC9  2802          		JR	Z,BIOSOK
  CDCB  1805          		JR	NOBIOS
  CDCD                	BIOSOK:
  CDCD  3EC3          		LD	A,0C3H		;JP
  CDCF  321800        		LD	(00018H),A
  CDD2                	NOBIOS:
  CDD2  3E1F          		LD	A,01FH		;スタートポート
  CDD4  DBF0          		IN	A,(0F0H)
  CDD6  0F            		RRCA
  CDD7  380B          		JR	C,CRT1
  CDD9  21D2CF        		LD	HL,_C8025H
  CDDC  11B0F0        		LD	DE,CRTCD
  CDDF  011000        		LD	BC,16
  CDE2  EDB0          		LDIR
  CDE4                	CRT1:
  CDE4  3E1F          		LD	A,01FH		;スタートポート
  CDE6  DBF0          		IN	A,(0F0H)
  CDE8  CB57          		BIT	2,A
  CDEA  2818          		JR	Z,BANK
                      	
  CDEC  AF            		XOR	A
  CDED                	TZ1:				;前面スイッチが2HDの場合はMFMモードを2HDにしておく
  CDED  F5            		PUSH	AF
  CDEE  CDDCF0        		CALL	_GETDPB
  CDF1  DD7E12        		LD	A,(IX+DPB_DEVICE)
  CDF4  E68F          		AND	08FH
  CDF6  FE87          		CP	087H		;フロッピーでMEM切り替えがON
  CDF8  2004          		JR	NZ,TZ2
  CDFA  DDCB0A86      		RES	0,(IX+DPB_FDMODE)
  CDFE                	TZ2:
  CDFE  F1            		POP	AF
  CDFF  3C            		INC	A
  CE00  FE08          		CP	8
  CE02  38E9          		JR	C,TZ1
                      	
  CE04                	BANK:
  CE04  01000B        		LD	BC,00B00H
  CE07  21007F        		LD	HL,07F00H
  CE0A  F3            		DI
  CE0B  ED69          		OUT	(C),L
  CE0D  3A0000        		LD	A,(0)
  CE10  FEEB          		CP	0EBH
  CE12  2005          		JR	NZ,BANK1
  CE14  3E2B          		LD	A,02BH
  CE16  32B2F2        		LD	(BANKDV),A
  CE19                	BANK1:
  CE19  ED69          		OUT	(C),L
  CE1B  5E            		LD	E,(HL)
  CE1C  7B            		LD	A,E
  CE1D  C6A5          		ADD	A,0A5H
  CE1F  77            		LD	(HL),A
  CE20  BE            		CP	(HL)
  CE21  73            		LD	(HL),E
  CE22  2005          		JR	NZ,BANK2
  CE24  2C            		INC	L
  CE25  CB65          		BIT	4,L
  CE27  28F0          		JR	Z,BANK1
  CE29                	BANK2:
  CE29  3E10          		LD	A,010H
  CE2B  ED79          		OUT	(C),A
  CE2D  7D            		LD	A,L
  CE2E  B7            		OR	A
  CE2F  2813          		JR	Z,NOBANK
  CE31  2600          		LD	H,0
  CE33  29            		ADD	HL,HL	;*2
  CE34  29            		ADD	HL,HL	;*4
  CE35  29            		ADD	HL,HL	;*8
  CE36  29            		ADD	HL,HL	;*16
  CE37  29            		ADD	HL,HL	;*32
  CE38  2B            		DEC	HL	;-1
  CE39  2B            		DEC	HL	;-2
  CE3A  2B            		DEC	HL	;-3
  CE3B  22A8F2        		LD	(BANKCL),HL
  CE3E  CD89CF        		CALL	CALC_FATLN
  CE41  32A0F2        		LD	(BANKFL),A
  CE44                	NOBANK:
  CE44                	EMM:
  CE44  DD2180F2      		LD	IX,EMMFL
  CE48  CD3ACF        		CALL	EADR0
  CE4B  ED78          		IN	A,(C)
  CE4D  F5            		PUSH	AF
                      	
  CE4E  110000        		LD	DE,0
  CE51                	ECHECK1:
  CE51  13            		INC	DE
  CE52  CD1ECF        		CALL	EADR2
  CE55  ED60          		IN	H,(C)
  CE57  CD1ECF        		CALL	EADR2
  CE5A  7C            		LD	A,H
  CE5B  C6E5          		ADD	A,0E5H
  CE5D  ED79          		OUT	(C),A
  CE5F  3C            		INC	A
  CE60  CD3ACF        		CALL	EADR0
  CE63  ED79          		OUT	(C),A
  CE65  3D            		DEC	A
  CE66  CD1ECF        		CALL	EADR2
  CE69  ED68          		IN	L,(C)
  CE6B  CD1ECF        		CALL	EADR2
  CE6E  ED61          		OUT	(C),H
  CE70  BD            		CP	L
  CE71  2004          		JR	NZ,ECHECK2
  CE73  CB5A          		BIT	3,D
  CE75  28DA          		JR	Z,ECHECK1
  CE77                	ECHECK2:
  CE77  CD3ACF        		CALL	EADR0
  CE7A  F1            		POP	AF
  CE7B  ED79          		OUT	(C),A
  CE7D  FEEB          		CP	0EBH
  CE7F  2005          		JR	NZ,EMM_BPB
  CE81  3E26          		LD	A,026H
  CE83  3292F2        		LD	(EMMDV),A
  CE86                	EMM_BPB:
  CE86  21F7FF        		LD	HL,0-9
  CE89  19            		ADD	HL,DE
  CE8A  3009          		JR	NC,NOEMM
  CE8C  2288F2        		LD	(EMMCL),HL
  CE8F  CD89CF        		CALL	CALC_FATLN
  CE92  3280F2        		LD	(EMMFL),A
  CE95                	NOEMM:
  CE95  3E00          	KEYREP:	LD	A,000H
  CE97  B7            		OR	A
  CE98  2807          		JR	Z,KEYR1
  CE9A  010000        		LD	BC,0
  CE9D  ED438CF0      		LD	(_CTC),BC
  CEA1                	KEYR1:
  CEA1  CD6ACF        		CALL	SETCRTC
  CEA4  0130F8        		LD	BC,0-80*25
  CEA7  2ABAF0        		LD	HL,(_PAGE_MINUS)
  CEAA  ED43BAF0      		LD	(_PAGE_MINUS),BC
  CEAE  1E0C          		LD	E,00CH
  CEB0  CDCDF0        		CALL	_PRINT
  CEB3  22BAF0        		LD	(_PAGE_MINUS),HL
                      	
  CEB6  21A5CF        		LD	HL,INIMES
  CEB9  CD70D8        		CALL	MSX
                      	
  CEBC  3A87FF        		LD	A,(0FF87H)
  CEBF  FE08          		CP	8
  CEC1  301E          		JR	NC,INIT0
  CEC3  5F            		LD	E,A
  CEC4  C641          		ADD	A,'A'
  CEC6  32A2CF        		LD	(AUTODV),A
  CEC9  0E0E          		LD	C,00EH
  CECB  CD0500        		CALL	SYSTEM
  CECE  1C            		INC	E
  CECF  2185F0        		LD	HL,_SEEKSP	;Disk error Ignore
  CED2  CBFE          		SET	7,(HL)
  CED4  0E1B          		LD	C,01BH
  CED6  CD0500        		CALL	SYSTEM
                      	
  CED9  2185F0        		LD	HL,_SEEKSP
  CEDC  CBBE          		RES	7,(HL)
                      	
  CEDE  3C            		INC	A
  CEDF  2008          		JR	NZ,INIT1
  CEE1                	INIT0:
  CEE1  1E00          		LD	E,0
  CEE3  0E0E          		LD	C,00EH
  CEE5  CD0500        		CALL	SYSTEM
  CEE8  AF            		XOR	A
  CEE9                	INIT1:
  CEE9  F3            		DI
  CEEA  08            		EX	AF,AF'
  CEEB  2EFE          		LD	L,0-2		;CALLのスタック分減らす
  CEED  39            		ADD	HL,SP
  CEEE  1100FF        		LD	DE,0FF00H
  CEF1  45            		LD	B,L
  CEF2  CDD3D5        		CALL	ZERO_MEMORY_DE
  CEF5  21CAFF        		LD	HL,EXTBIO
  CEF8  36C9          		LD	(HL),0C9H	;RET
  CEFA  23            		INC	HL
  CEFB  060E          		LD	B,TRAP38-EXTBIO-1
  CEFD  3EFF          		LD	A,0FFH		;RST 38H
  CEFF  CD33E1        		CALL	FILL_MEMORY
  CF02  21F5CF        		LD	HL,AT_TRAP38
  CF05  11D9FF        		LD	DE,TRAP38
  CF08  012700        		LD	BC,AT_TRAPE-AT_TRAP38
  CF0B  EDB0          		LDIR
  CF0D  08            		EX	AF,AF'
  CF0E  B7            		OR	A
  CF0F  C8            		RET	Z
                      	
  CF10  3EE6          		LD	A,0E6H
  CF12  CDD9DE        		CALL	COMOUT
  CF15  CDBEDE        		CALL	IN49SB
  CF18  CDBEDE        		CALL	IN49SB
  CF1B  FE1B          		CP	01BH
  CF1D  C9            		RET
                      	
  CF1E                	EADR2:
  CF1E  D5            		PUSH	DE
  CF1F  EB            		EX	DE,HL
  CF20  29            		ADD	HL,HL
  CF21  29            		ADD	HL,HL
  CF22  DD4E0D        		LD	C,(IX+DPB_MAXSEC)
  CF25  DD460C        		LD	B,(IX+DPB_MAXCYL)
  CF28  09            		ADD	HL,BC
  CF29  DD4E13        		LD	C,(IX+DPB_UNITNO)
  CF2C  060D          		LD	B,00DH
  CF2E  ED49          		OUT	(C),C
  CF30  0C            		INC	C
  CF31  ED69          		OUT	(C),L
  CF33  0C            		INC	C
  CF34  ED61          		OUT	(C),H
  CF36  0C            		INC	C
  CF37  EB            		EX	DE,HL
  CF38  D1            		POP	DE
  CF39  C9            		RET
                      	
  CF3A                	EADR0:
  CF3A  D5            		PUSH	DE
  CF3B  110000        		LD	DE,0
  CF3E  CD1ECF        		CALL	EADR2
  CF41  D1            		POP	DE
  CF42  C9            		RET
                      	
  CF43                	CHKCTC:
  CF43  C5            		PUSH	BC
  CF44  110347        		LD	DE,04703H
  CF47                	INICTC1:
  CF47  0C            		INC	C
  CF48  ED51          		OUT	(C),D
  CF4A  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  CF4C  1D            		DEC	E
  CF4D  20F8          		JR	NZ,INICTC1
  CF4F  C1            		POP	BC
                      	
  CF50  11FA07        		LD	DE,007FAH
  CF53  ED51          		OUT	(C),D
  CF55  ED59          		OUT	(C),E
  CF57  ED78          		IN	A,(C)
  CF59  BB            		CP	E
  CF5A  C0            		RET	NZ
  CF5B  ED51          		OUT	(C),D
  CF5D  ED51          		OUT	(C),D
  CF5F  ED78          		IN	A,(C)
  CF61  BA            		CP	D
  CF62  C0            		RET	NZ
  CF63  0C            		INC	C
  CF64  0C            		INC	C
  CF65  ED438CF0      		LD	(_CTC),BC
  CF69  C9            		RET
                      	
  CF6A                	SETCRTC:
  CF6A  21B0F0        		LD	HL,CRTCD
  CF6D  AF            		XOR	A
  CF6E                	SETCRT1:
  CF6E  010018        		LD	BC,01800H
  CF71  ED79          		OUT	(C),A
  CF73  0C            		INC	C
  CF74  04            		INC	B
  CF75  EDA3          		OUTI
  CF77  3C            		INC	A
  CF78  FE0C          		CP	12
  CF7A  20F2          		JR	NZ,SETCRT1
  CF7C  23            		INC	HL
  CF7D  23            		INC	HL
  CF7E  01031B        		LD	BC,01A03H+00100H
  CF81  EDA3          		OUTI
  CF83  01D020        		LD	BC,01FD0H+00100H
  CF86  EDA3          		OUTI
  CF88  C9            		RET
                      	
  CF89                	CALC_FATLN:	;FAT12のクラスタ数から必要なFATサイズを求める(セクタサイズ512)
  CF89  5D            		LD	E,L
  CF8A  54            		LD	D,H
  CF8B  29            		ADD	HL,HL	;*2
  CF8C  19            		ADD	HL,DE	;*3
  CF8D  CB3C          		SRL	H	;/2
  CF8F  CB1D          		RR	L	;1クラスタ辺り1.5バイト必要
  CF91  11FF01        		LD	DE,511	;切り上げる
  CF94  19            		ADD	HL,DE
  CF95  7C            		LD	A,H
  CF96  CB3F          		SRL	A
  CF98  C9            		RET
                      	
  CF99  4155544F455845	AUTOD:	DB	"AUTOEXEC "
  CFA2  413A00        	AUTODV:	DB	"A:",0
                      	
  CFA5  4C53582D446F64	INIMES:	DB	"LSX-Dodgers for X1/turbo version "
  CFC6  312E          		DB	030H + VER_1, '.'
  CFC8  3537          		DB	030H + VER_2 ,030H + VER_3
                      	;	DB	""
  CFCA  2047616B750D0A		DB	' Gaku',0DH,0AH
  CFD1  00            		DB	0
                      	
  CFD2                	_C8025H:
  CFD2  6B5059881B0119		DB	06BH,050H,059H,088H,01BH,001H,019H,01AH
  CFDA  000F          		DB	000H,00FH
  CFDC  80F8B0FF      		DW	0-80*LINE,0-80
  CFE0  0C23          		DB	00CH,023H
                      	
  CFE2  030C0F30333C3F	TEXTDT:	DB	003H,00CH,00FH,030H,033H,03CH,03FH
                      	
  CFE9                	SIODATA:
  CFE9  18            		DB	018H
  CFEA  0100          		DB	1,0
  CFEC  0200          		DB	2,0
  CFEE  03C1          		DB	3,0C1H
  CFF0  0444          		DB	4,044H
  CFF2  05E8          		DB	5,0E8H
  CFF4  FF            		DB	0FFH
                      	
  CFF5                	AT_TRAP38:
  CFF5  210000        		LD	HL,0
  CFF8  E3            		EX	(SP),HL
  CFF9  3E24          		LD	A,'$'
  CFFB  CDBADB        		CALL	MSG_A
  CFFE  2B            		DEC	HL
  CFFF  7C            		LD	A,H
  D000  CDE8FF        		CALL	PRHX+AT_RT
  D003  7D            		LD	A,L
  D004                	PRHX:
  D004  F5            		PUSH	AF
  D005  07            		RLCA
  D006  07            		RLCA
  D007  07            		RLCA
  D008  07            		RLCA
  D009  CDF1FF        		CALL	PRHX2+AT_RT
  D00C  F1            		POP	AF
  D00D                	PRHX2:
  D00D  E60F          		AND	00FH
  D00F  FE0A          		CP	10
  D011  3F            		CCF
  D012  CE30          		ADC	A,'0'
  D014  27            		DAA
  D015  C3BADB        		JP	MSG_A
  D018                		DS	4
  D01C                	AT_TRAPE:
                      	
                      	;X1CPU.ASM
                      	
                      	;	LSX-Dodgers CPU
                      	;	X1/turbo/Z
                      	
                      	;	ノンターボ用パッチ
                      	;	DMAを使って転送している部分をCPUに差し替える
                      	
  D01C                	AT_SCR1:
  D01C  D9            		EXX
  D01D  C5            		PUSH	BC
  D01E  ED4BB1F0      		LD	BC,(_WIDTH)
  D022  0620          		LD	B,020H
  D024  D9            		EXX
  D025  C5            		PUSH	BC
  D026  010020        		LD	BC,02000H
                      	
  D029  67            		LD	H,A
  D02A  B7            		OR	A
  D02B                	AT_SCRUP1:
  D02B  2815          		JR	Z,AT_SCRCL
  D02D  C5            		PUSH	BC
  D02E  CBE0          		SET	4,B
  D030  D9            		EXX
  D031  C5            		PUSH	BC
  D032  CBE0          		SET	4,B
  D034  D9            		EXX
  D035  CD94DF        		CALL	AT_UPSUB+AT_RS
  D038  D9            		EXX
  D039  C1            		POP	BC
  D03A  D9            		EXX
  D03B  C1            		POP	BC
  D03C  CD94DF        		CALL	AT_UPSUB+AT_RS
  D03F  25            		DEC	H
  D040  18E9          		JR	AT_SCRUP1
                      	
  D042                	AT_SCRCL:
  D042  2AB1F0        		LD	HL,(_WIDTH)
  D045  CD2CDE        		CALL	LINECL
  D048  C1            		POP	BC
  D049  D9            		EXX
  D04A  C1            		POP	BC
  D04B  D9            		EXX
  D04C  C9            		RET
                      	
  D04D                	AT_UPSUB:
  D04D  3AB1F0        		LD	A,(_WIDTH)
  D050  6F            		LD	L,A
  D051                	AT_UPSUB1:
  D051  D9            		EXX
  D052  ED78          		IN	A,(C)
  D054  03            		INC	BC
  D055  D9            		EXX
  D056  ED79          		OUT	(C),A
  D058  03            		INC	BC
  D059  2D            		DEC	L
  D05A  20F5          		JR	NZ,AT_UPSUB1
  D05C  C9            		RET
                      	
                      	;	FLOPPY DISK DRIVER(CPU)
                      	
  D05D                	DISKC:
  D05D  1B            		DEC	DE
  D05E  CB5F          		BIT	3,A
  D060  C4B4EE        		CALL	NZ,RNF
  D063                	DISKD:
  D063  E5            		PUSH	HL
  D064  21BAEE        		LD	HL,RETRY
  D067  35            		DEC	(HL)
  D068  E1            		POP	HL
  D069  200C          		JR	NZ,AT_ERR		;Retry
  D06B  B7            		OR	A
  D06C  2809          		JR	Z,AT_ERR		;Error
                      	
  D06E                	AT_DELP:
  D06E  CDB4EE        		CALL	RNF
  D071  CD90EE        		CALL	FDMOFF
  D074  3EFF          		LD	A,0FFH
  D076                	AT_ERRZ:
  D076  BF            		CP	A
  D077                	AT_ERR:
  D077  3EFF          		LD	A,0FFH
  D079  C9            		RET
  D07A                	ERRW:
  D07A  3EFF          		LD	A,0FFH
  D07C  BF            		CP	A
  D07D  37            		SCF
  D07E  C390EE        		JP	FDMOFF
                      	
  D081                	ERRDW:
  D081  D1            		POP	DE
  D082  CDB5DF        		CALL	AT_DELP+AT_RS
  D085  C2C9EE        		JP	NZ,DWT0+AT_R
  D088  B7            		OR	A
  D089  20EF          		JR	NZ,ERRW
  D08B  C9            		RET
                      	
  D08C                	ERRDR:
  D08C  D1            		POP	DE
  D08D  CDB5DF        		CALL	AT_DELP+AT_RS
  D090  C212EF        		JP	NZ,DRD0+AT_R
  D093  B7            		OR	A
  D094  20E4          		JR	NZ,ERRW
  D096  C9            		RET
                      	
  D097                	AT_WTTRK:
  D097  0601          		LD	B,1
  D099  3EF4          		LD	A,0F4H
  D09B  C3BDEE        		JP	AT_WTTRK1+AT_R
                      	
  D09E                	AT_SCRN:
  D09E  ED78          		IN	A,(C)
  D0A0  C9            		RET
  D0A1                	AT_SCRE:
                      	
  D0A1                	AT_DWT:
  D0A1  3EA0          		LD	A,0A0H
  D0A3                	AT_WTTRK1:
  D0A3  3258EE        		LD	(FDCPAT+1),A
  D0A6                	DWTBL:
  D0A6  78            		LD	A,B
  D0A7  3200EF        		LD	(AT_WTB+1+AT_R),A
  D0AA  3E02          		LD	A,2		;Retry count
  D0AC  32BAEE        		LD	(RETRY),A
                      	
  D0AF                	DWT0:
  D0AF  D5            		PUSH	DE
  D0B0  E5            		PUSH	HL
  D0B1  CDF7ED        		CALL	SEEK		;Write disk
  D0B4  E1            		POP	HL
  D0B5  DAC8DF        		JP	C,ERRDW+AT_RS
  D0B8  F3            		DI
  D0B9  3A58EE        		LD	A,(FDCPAT+1)
  D0BC  CD9CEE        		CALL	SECSET
  D0BF  0EFB          		LD	C,0FBH
                      	
  D0C1                	DWT1:
  D0C1  56            		LD	D,(HL)
  D0C2                	DWT2:
  D0C2  78            		LD	A,B
  D0C3  DBF8          		IN	A,(0F8H)
  D0C5  0F            		RRCA
  D0C6  3008          		JR	NC,DWT4
  D0C8  0F            		RRCA
  D0C9  30F7          		JR	NC,DWT2
  D0CB                	DWT3:
  D0CB  ED51          		OUT	(C),D
  D0CD  23            		INC	HL
  D0CE  18F1          		JR	DWT1
                      	
  D0D0                	DWT4:
  D0D0  3D            		DEC	A
  D0D1  28F8          		JR	Z,DWT3
  D0D3  3C            		INC	A
  D0D4  FB            		EI
  D0D5  D1            		POP	DE
  D0D6  13            		INC	DE
  D0D7  CD90EE        		CALL	FDMOFF
  D0DA  2809          		JR	Z,DISKOK_WT
  D0DC  CDA4DF        		CALL	DISKC+AT_RS
  D0DF  20CE          		JR	NZ,DWT0
  D0E1  B7            		OR	A
  D0E2  C2C1DF        		JP	NZ,ERRW+AT_RS
                      	
  D0E5                	DISKOK_WT:
  D0E5  0601          	AT_WTB:	LD	B,1
  D0E7  10BD          		DJNZ	DWTBL
  D0E9  C9            		RET
                      	
  D0EA                	AT_DRD:
  D0EA  3E80          		LD	A,080H
  D0EC  3258EE        		LD	(FDCPAT+1),A
  D0EF                	DRDBL:
  D0EF  78            		LD	A,B
  D0F0  3245EF        		LD	(AT_RDB+1+AT_R),A
  D0F3  3E02          		LD	A,2		;Retry count
  D0F5  32BAEE        		LD	(RETRY),A
  D0F8                	DRD0:
  D0F8  D5            		PUSH	DE
  D0F9  E5            		PUSH	HL
  D0FA  CDF7ED        		CALL	SEEK		;Read disk
  D0FD  E1            		POP	HL
  D0FE  DAD3DF        		JP	C,ERRDR+AT_RS
  D101  F3            		DI
  D102  3A58EE        		LD	A,(FDCPAT+1)
  D105  CD9CEE        		CALL	SECSET
  D108  0EFB          		LD	C,0FBH
  D10A                	DRD1:
  D10A  78            		LD	A,B
  D10B  DBF8          		IN	A,(0F8H)
  D10D  0F            		RRCA
  D10E  3008          		JR	NC,DRD3
  D110  0F            		RRCA
  D111  30F7          		JR	NC,DRD1
  D113  EDA2          		INI
  D115  04            		INC	B
  D116  18F2          		JR	DRD1
                      	
  D118                	DRD3:
  D118  B7            		OR	A
  D119  FB            		EI
  D11A  D1            		POP	DE
  D11B  13            		INC	DE
  D11C  CD90EE        		CALL	FDMOFF
  D11F  2809          		JR	Z,DISKOK_RD
  D121  CDA4DF        		CALL	DISKC+AT_RS
  D124  20D2          		JR	NZ,DRD0
  D126  B7            		OR	A
  D127  C2C1DF        		JP	NZ,ERRW+AT_RS
                      	
  D12A                	DISKOK_RD:
  D12A  0601          	AT_RDB:	LD	B,1
  D12C  10C1          		DJNZ	DRDBL
  D12E  C9            		RET
                      	
  D12F                	AT_CPUE:
                      	
                      	
                      	;	EMM DRIVER(CPU)
                      	
                      	
  D12F                	AT_EDWT:
  D12F  CD0CD8        		CALL	AT_EADR+AT_RE
  D132                	AT_EDWT0:
  D132  F5            		PUSH	AF
  D133  AF            		XOR	A
  D134                	AT_EDWT1:
  D134  04            		INC	B
  D135  EDA3          		OUTI
  D137  04            		INC	B
  D138  EDA3          		OUTI
  D13A  3D            		DEC	A
  D13B  20F7          		JR	NZ,AT_EDWT1
  D13D  13            		INC	DE
  D13E  F1            		POP	AF
  D13F  3D            		DEC	A
  D140  20F0          		JR	NZ,AT_EDWT0
  D142  C9            		RET
                      	
  D143                	AT_EDRD:
  D143  CD0CD8        		CALL	AT_EADR+AT_RE
  D146                	AT_EDRD0:
  D146  F5            		PUSH	AF
  D147  AF            		XOR	A
  D148                	AT_EDRD1:
  D148  EDA2          		INI
  D14A  04            		INC	B
  D14B  EDA2          		INI
  D14D  04            		INC	B
  D14E  3D            		DEC	A
  D14F  20F7          		JR	NZ,AT_EDRD1
  D151  13            		INC	DE
  D152  F1            		POP	AF
  D153  3D            		DEC	A
  D154  20F0          		JR	NZ,AT_EDRD0
  D156  C9            		RET
                      	
  D157                	AT_EADR:
  D157  C5            		PUSH	BC
  D158  D5            		PUSH	DE
  D159  EB            		EX	DE,HL
  D15A  29            		ADD	HL,HL
  D15B  DD4E0D        		LD	C,(IX+DPB_MAXSEC)
  D15E  DD460C        		LD	B,(IX+DPB_MAXCYL)
  D161  09            		ADD	HL,BC
  D162  DD4E13        		LD	C,(IX+DPB_UNITNO)
  D165  060D          		LD	B,00DH
  D167  ED49          		OUT	(C),C
  D169  0C            		INC	C
  D16A  ED69          		OUT	(C),L
  D16C  0C            		INC	C
  D16D  ED61          		OUT	(C),H
  D16F  0C            		INC	C
  D170  EB            		EX	DE,HL
  D171  D1            		POP	DE
  D172  F1            		POP	AF
  D173  A7            		AND	A	;CF=0
  D174  C9            		RET
  D175                	AT_EMME:
                      	
  2FE4                	AT_RT	EQU	TRAP38-AT_TRAP38
                      	
  D175                	INITE:
  D175                		DS	BDOS-INITE
  D206  C32FD8        		JP	BDOS0
                      	
                      	;X1CCP.ASM
                      	
                      	;	LSX-Dodgers CCP
                      	;	X1/turbo/Z
                      	
  D209                	WBOOT1:
  D209  F3            		DI
  D20A  ED7B0600      		LD	SP,(SYSTEM+1)
                      	
  D20E  3EF0          		LD	A,INTVEC/256
  D210  ED47          		LD	I,A
                      	
  D212  3EE4          		LD	A,0E4H
  D214  CDD9DE        		CALL	COMOUT
  D217  3EC8          		LD	A,INTVEC-CPM_BOOT
  D219  CDB3DE        		CALL	OT49SB
                      	
  D21C  21B0F0        		LD	HL,CRTCD
  D21F  AF            		XOR	A
  D220                	SETCRT2:
  D220  010018        		LD	BC,01800H
  D223  ED79          		OUT	(C),A
  D225  0C            		INC	C
  D226  56            		LD	D,(HL)
  D227  FE0D          		CP	13
  D229  3802          		JR	C,SETCRT3
  D22B  1600          		LD	D,0
  D22D                	SETCRT3:
  D22D  ED51          		OUT	(C),D
  D22F  23            		INC	HL
  D230  3C            		INC	A
  D231  FE0E          		CP	14
  D233  20EB          		JR	NZ,SETCRT2
                      	
  D235  01031B        		LD	BC,01A03H+00100H
  D238  EDA3          		OUTI
  D23A  01D020        		LD	BC,01FD0H+00100H
  D23D  EDA3          		OUTI
  D23F  2192F0        		LD	HL,_KEYD
  D242  7E            		LD	A,(HL)
  D243  3600          		LD	(HL),0
  D245  CDA7DB        		CALL	KEYBC_IFBREAK
  D248  3E04          		LD	A,4
  D24A  CDBADB        		CALL	MSG_A
                      	
                      	;LDCCP.ASM
                      	
                      	;	LSX-Dodgers CCP
                      	
  D24D                	COMMAND:
  D24D  3AB0EF        		LD	A,(FCB_BAT)
  D250  B7            		OR	A
  D251  C292D3        		JP	NZ,C_BAT1
  D254  CD07D3        		CALL	SETDTA1
  D257  3A87F0        		LD	A,(_DVSW)
  D25A  C641          		ADD	A,'A'
  D25C  CDBADB        		CALL	MSG_A
  D25F  3E3E          		LD	A,'>'
  D261  CDBADB        		CALL	MSG_A
  D264  3E50          		LD	A,80
  D266  12            		LD	(DE),A
  D267  CD09DC        		CALL	_SYS0A		;(BDOS)文字列入力
  D26A  CD95D4        		CALL	LTNL
  D26D                	COMMAND2:
  D26D  118200        		LD	DE,DTA1+2
  D270  CDFDF0        		CALL	_COMANL
  D273  30D8          		JR	NC,COMMAND
  D275  1179F0        		LD	DE,COMERM
  D278  CD61D8        		CALL	_SYS09		;(BDOS)文字列出力
  D27B  C7            		RST	0
                      	
  D27C                	COMANL:
  D27C  CD87E0        		CALL	FILE
  D27F  3A19F0        		LD	A,(FNAME+4)
  D282  FE20          		CP	020H
  D284  201C          		JR	NZ,COMB2
  D286  D5            		PUSH	DE
  D287  1115F0        		LD	DE,FNAME
  D28A  1A            		LD	A,(DE)
  D28B  FE20          		CP	020H
  D28D  2844          		JR	Z,SDVSW
  D28F  1B            		DEC	DE
  D290  1A            		LD	A,(DE)
  D291  C6FF          		ADD	A,0FFH
  D293  3809          		JR	C,COMB
  D295  13            		INC	DE
                      	
  D296  2103D7        		LD	HL,COMTB
  D299  0609          		LD	B,COMS
  D29B  CD0BE3        		CALL	CPNAME
  D29E                	COMB:
  D29E  D1            		POP	DE
  D29F  D20F00        		JP	NC,JP_HL
  D2A2                	COMB2:
  D2A2  EB            		EX	DE,HL
  D2A3  226FD3        		LD	(COMPAT+1),HL
  D2A6  F5            		PUSH	AF
  D2A7  CD27D3        		CALL	CEXE4
  D2AA  F1            		POP	AF
  D2AB  2115F0        		LD	HL,FNAME
  D2AE  116D00        		LD	DE,FCB2+1	;COMMAND NAME
  D2B1  010B00        		LD	BC,11
  D2B4  EDB0          		LDIR
  D2B6  114AEF        		LD	DE,PATHD
  D2B9                	CEX1:
  D2B9  1A            		LD	A,(DE)
  D2BA  FE20          		CP	020H
  D2BC  D8            		RET	C
  D2BD  CD7CE0        		CALL	FILEC
  D2C0  D5            		PUSH	DE
  D2C1  216D00        		LD	HL,FCB2+1	;COMMAND NAME
  D2C4  1115F0        		LD	DE,FNAME
  D2C7  010B00        		LD	BC,11
  D2CA  EDB0          		LDIR
  D2CC  CD27D3        		CALL	CEXE4
  D2CF  D1            		POP	DE
  D2D0  13            		INC	DE
  D2D1  18E6          		JR	CEX1
                      	
  D2D3                	SDVSW:
  D2D3  F1            		POP	AF
  D2D4  3A14F0        		LD	A,(FDRV)
  D2D7  3D            		DEC	A
  D2D8  5F            		LD	E,A
  D2D9  0E0E          		LD	C,00EH		;(BDOS)カレントドライブの設定
  D2DB  1831          		JR	SYSTEM0
                      	
  D2DD                	OPEN1:
  D2DD  2114F0        		LD	HL,FDRV
  D2E0                	OPEN:
  D2E0  0E11          		LD	C,011H		;(BDOS)ファイルの検索
  D2E2                	OPEN3:
  D2E2  D5            		PUSH	DE
  D2E3  118BEF        		LD	DE,DTA_CCP
  D2E6  CD04D3        		CALL	SETDTA
  D2E9  EB            		EX	DE,HL
  D2EA  CD0ED3        		CALL	SYSTEM0
  D2ED  D1            		POP	DE
  D2EE  C9            		RET
                      	
  D2EF                	OPEN2:
  D2EF  0E12          		LD	C,012H
  D2F1  18EF          		JR	OPEN3
                      	
  D2F3                	DEFCB:				;Z=Ok NZ=Error
  D2F3  118BEF        		LD	DE,DTA_CCP
  D2F6  CD0CD3        		CALL	SYSC0F
                      	
  D2F9  11ACEF        		LD	DE,DTA_CCP+33	;(FCB)ランダムレコード
  D2FC  0604          		LD	B,4
  D2FE  CDD3D5        		CALL	ZERO_MEMORY_DE
  D301                	SETDTA100:
  D301  110001        		LD	DE,00100H
  D304                	SETDTA:
  D304  C339DA        		JP	_SYS1A		;(BDOS)DTAの設定
                      	
  D307                	SETDTA1:
  D307  118000        		LD	DE,DTA1
  D30A  18F8          		JR	SETDTA
                      	
  D30C                	SYSC0F:
  D30C  0E0F          		LD	C,00FH		;(BDOS)ファイルのオープン
  D30E                	SYSTEM0:
  D30E  CD0500        		CALL	SYSTEM
  D311  B7            		OR	A
  D312  C9            		RET
                      	
  D313                	C_CD:
  D313  0E5A          		LD	C,5AH
  D315  18F7          		JR	SYSTEM0
                      	
  D317                	S27BUF:
  D317  3A0700        		LD	A,(SYSTEM+2)
  D31A  3D            		DEC	A
  D31B  E6F8          		AND	0F8H
  D31D  67            		LD	H,A
  D31E  2E00          		LD	L,0
  D320                	S27DTA:
  D320  118BEF        		LD	DE,DTA_CCP
  D323                	S27:
  D323  0E27          		LD	C,027H		;(BDOS)ランダムブロック読み込み
  D325  18E7          		JR	SYSTEM0
                      	
  D327                	CEXE4:
  D327  211DF0        		LD	HL,FNAME+8
  D32A  7E            		LD	A,(HL)
  D32B  FE20          		CP	020H
  D32D  2007          		JR	NZ,CEXE7
  D32F  3E3F          		LD	A,'?'
  D331  77            		LD	(HL),A
  D332  23            		INC	HL
  D333  77            		LD	(HL),A
  D334  23            		INC	HL
  D335  77            		LD	(HL),A
  D336                	CEXE7:
  D336  CDDDD2        		CALL	OPEN1
  D339                	CEXE5:
  D339  C0            		RET	NZ
  D33A  2A95EF        		LD	HL,(DTA_CCP+1+9)
  D33D  7C            		LD	A,H
  D33E  CD93E3        		CALL	CAP
  D341  67            		LD	H,A
  D342  7D            		LD	A,L
  D343  CD93E3        		CALL	CAP
  D346  6F            		LD	L,A
  D347  3A94EF        		LD	A,(DTA_CCP+1+8)
  D34A  CD93E3        		CALL	CAP
  D34D  D642          		SUB	'B'
  D34F  282C          		JR	Z,C_BAT
  D351  3D            		DEC	A		;'C'
  D352  2805          		JR	Z,C_EXE
  D354                	CEXE6:
  D354  CDEFD2        		CALL	OPEN2
  D357  18E0          		JR	CEXE5
                      	
  D359                	C_EXE:
  D359  7C            		LD	A,H
  D35A  FE4D          		CP	'M'
  D35C  20F6          		JR	NZ,CEXE6
                      	
  D35E  CDF3D2        		CALL	DEFCB
  D361  CD17D3        		CALL	S27BUF
  D364  3D            		DEC	A
  D365  37            		SCF
  D366  C0            		RET	NZ
  D367  7C            		LD	A,H
  D368  B5            		OR	L
  D369  37            		SCF
  D36A  C8            		RET	Z
  D36B  CD07D3        		CALL	SETDTA1
  D36E  110000        	COMPAT:	LD	DE,0				; self-modifying code
  D371  ED7B0600      		LD	SP,(SYSTEM+1)
  D375  67            		LD	H,A				; A=0 in SETDTA1(_SYS1A)
  D376  6F            		LD	L,A
  D377  E5            		PUSH	HL				; push $0000 (reboot address)
  D378  24            		INC	H
  D379  E5            		PUSH	HL				; push $0100 (TPA address)
  D37A  C39ED5        		JP	SETFCB				; and JP $0100
                      	
  D37D                	C_BAT:
  D37D  114154        		LD	DE,'A'+'T'*256
  D380  ED52          		SBC	HL,DE
  D382  20D0          		JR	NZ,CEXE6
                      	
  D384  CDF3D2        		CALL	DEFCB
                      	
  D387  218BEF        		LD	HL,DTA_CCP
  D38A  11B0EF        		LD	DE,FCB_BAT
  D38D  012500        		LD	BC,37
  D390  EDB0          		LDIR
  D392                	C_BAT1:
  D392  CD01D3        		CALL	SETDTA100
  D395  CDC9D3        		CALL	FGETC_BAT
  D398  218100        		LD	HL,DTA1+1
  D39B  2025          		JR	NZ,END_BATCH
  D39D  FE21          		CP	021H		;スペースや改行など制御文字を飛ばす
  D39F  38F1          		JR	C,C_BAT1
  D3A1  3620          		LD	(HL),' '
  D3A3  23            		INC	HL
  D3A4                	C_BAT2:
  D3A4  77            		LD	(HL),A
  D3A5  23            		INC	HL
  D3A6  7D            		LD	A,L
  D3A7  3C            		INC	A		;L==0FFH
  D3A8  2809          		JR	Z,RUN_BATCH
  D3AA  CDC9D3        		CALL	FGETC_BAT
  D3AD  2004          		JR	NZ,RUN_BATCH
  D3AF  FE20          		CP	020H
  D3B1  30F1          		JR	NC,C_BAT2
  D3B3                	RUN_BATCH:
  D3B3  7D            		LD	A,L
  D3B4  D67F          		SUB	DTA1-1
  D3B6  328000        		LD	(DTA1),A
  D3B9  FE04          		CP	4
  D3BB  3805          		JR	C,END_BATCH
  D3BD  3600          		LD	(HL),0
  D3BF  C36DD2        		JP	COMMAND2
  D3C2                	END_BATCH:
  D3C2  AF            		XOR	A		;バッチファイルを閉じる
  D3C3  32B0EF        		LD	(FCB_BAT),A
  D3C6  C300F0        		JP	CPM_BOOT
                      	
  D3C9                	FGETC_BAT:
  D3C9  11B0EF        		LD	DE,FCB_BAT
  D3CC                	FGETC:				;1文字ずつ読み込む
  D3CC  E5            		PUSH	HL		;Z:成功
  D3CD  210100        		LD	HL,1
  D3D0  CD23D3        		CALL	S27
  D3D3  E1            		POP	HL
  D3D4  3A0001        		LD	A,(00100H)
  D3D7  C9            		RET
                      	
  D3D8                	C_DEL:
  D3D8  CD9ED5        		CALL	SETFCB
  D3DB  CDD0DB        		CALL	_SYS08		;(BDOS)エコーなしコンソール入力
                      	
  D3DE  0E13          		LD	C,013H
  D3E0  180A          		JR	CDEL1		;(BDOS)ファイルの削除
                      	
  D3E2                	C_REN:
  D3E2  CD9ED5        		CALL	SETFCB
  D3E5  3E10          		LD	A,010H		;ディレクトリも対象にする
  D3E7  326900        		LD	(FCB1+13),A	;属性
  D3EA  0E17          		LD	C,017H		;(BDOS)ファイル名の変更
  D3EC                	CDEL1:
  D3EC  115C00        		LD	DE,FCB1
  D3EF  CD0500        		CALL	SYSTEM
  D3F2  C6FF          		ADD	A,0FFH
  D3F4  C9            		RET
                      	
  D3F5                	C_DIR:
  D3F5  CD7CE0        		CALL	FILEC
  D3F8  2115F0        		LD	HL,FDRV+1
  D3FB  CDE9D6        		CALL	CWILD1
  D3FE  3EF1          		LD	A,0F1H
  D400  3221F0        		LD	(FDRV+13),A
  D403  CDDDD2        		CALL	OPEN1
  D406                	CDIR1:
  D406  B7            		OR	A
  D407  2008          		JR	NZ,PDSKF
  D409  CD54D4        		CALL	P_NAME
  D40C  CDEFD2        		CALL	OPEN2
  D40F  18F5          		JR	CDIR1
                      	
  D411                	PDSKF:
  D411  3A14F0        		LD	A,(FDRV)
  D414  5F            		LD	E,A
  D415  0E1B          		LD	C,01BH		;(BDOS)ディスク情報の獲得
  D417  CD0500        		CALL	SYSTEM
  D41A  4F            		LD	C,A		;C←1クラスタ辺りの論理セクタ数
  D41B  C601          		ADD	A,001H
  D41D  D8            		RET	C		;Aが0FFHだった場合
  D41E  3E06          		LD	A,8-2
  D420                	PDS1:				;HL=未使用クラスタの総数
  D420  3C            		INC	A
  D421  CB19          		RR	C
  D423  30FB          		JR	NC,PDS1
  D425                	PDS2:				;B←論理セクタのサイズの上位8ビット
  D425  3C            		INC	A
  D426  CB18          		RR	B
  D428  30FB          		JR	NC,PDS2
  D42A  47            		LD	B,A
                      	
  D42B  110000        		LD	DE,0
  D42E                	PDS3:
  D42E  29            		ADD	HL,HL
  D42F  EB            		EX	DE,HL
  D430  ED6A          		ADC	HL,HL
  D432  EB            		EX	DE,HL
  D433  10F9          		DJNZ	PDS3
  D435                	PDSKF1:
  D435  CDCDD4        		CALL	PRDEC_DEHL
  D438  11D5EF        		LD	DE,FREE
  D43B  CD61D8        		CALL	_SYS09		;(BDOS)文字列出力
  D43E  CDBCD4        		CALL	PUTDRV
  D441  3E5C          		LD	A,05CH		;\
  D443  CDBADB        		CALL	MSG_A
  D446  2A22F0        		LD	HL,(FDRV+14)	;ディレクトリのクラスタ番号
  D449  AF            		XOR	A
  D44A  11FEFF        		LD	DE,0-2
  D44D  19            		ADD	HL,DE
  D44E  23            		INC	HL
  D44F  DCC9D4        		CALL	C,PRDEC_HL
  D452  1841          		JR	LTNL
                      	
  D454                	P_NAME:
  D454  3A8CEF        		LD	A,(DTA_CCP+1)
  D457  FE2E          		CP	'.'
  D459  C8            		RET	Z
  D45A  11FFD6        		LD	DE,DIRHD
  D45D  CD61D8        		CALL	_SYS09		;(BDOS)文字列出力
  D460  3A97EF        		LD	A,(DTA_CCP+1+00BH)
  D463  F5            		PUSH	AF
  D464  0F            		RRCA
  D465  9F            		SBC	A,A
  D466  E60A          		AND	'*'-020H
  D468  C620          		ADD	A,020H
  D46A  CDBADB        		CALL	MSG_A
  D46D  CDBCD4        		CALL	PUTDRV
  D470  218CEF        		LD	HL,DTA_CCP+1
  D473  CD0DD5        		CALL	FPRNT
                      	
  D476  F1            		POP	AF
  D477  CB67          		BIT	4,A
  D479  2808          		JR	Z,DIR3
  D47B  11F4D6        		LD	DE,DIRMES
  D47E  CD61D8        		CALL	_SYS09		;(BDOS)文字列出力
  D481  180A          		JR	DIR6
  D483                	DIR3:
  D483  ED5BAAEF      		LD	DE,(DTA_CCP+1+01EH)
  D487  2AA8EF        		LD	HL,(DTA_CCP+1+01CH)
  D48A  CDCDD4        		CALL	PRDEC_DEHL
  D48D                	DIR6:
  D48D  3AB1F0        		LD	A,(_WIDTH)
  D490  FE29          		CP	40+1
  D492  D42FD5        		CALL	NC,PRTTMS
                      	
  D495                	LTNL:
  D495  1E03          		LD	E,3
  D497  C3CDF0        		JP	_PRINT
                      	
  D49A                	C_PATH:
  D49A  CD5EE1        		CALL	SPCUT
  D49D  214AEF        		LD	HL,PATHD
  D4A0  FE21          		CP	021H
  D4A2  300C          		JR	NC,CPATH0
  D4A4                	CPATHP:
  D4A4  7E            		LD	A,(HL)
  D4A5  23            		INC	HL
  D4A6  FE20          		CP	020H
  D4A8  3F            		CCF
  D4A9  30EA          		JR	NC,LTNL
  D4AB  CDBADB        		CALL	MSG_A
  D4AE  18F4          		JR	CPATHP
  D4B0                	CPATH0:
  D4B0  FE3B          		CP	';'
  D4B2  2001          		JR	NZ,CPATH1
  D4B4  13            		INC	DE
  D4B5                	CPATH1:
  D4B5  EB            		EX	DE,HL
  D4B6  014000        		LD	BC,PATHX
  D4B9  EDB0          		LDIR
  D4BB  C9            		RET
                      	
  D4BC                	PUTDRV:
  D4BC  3A14F0        		LD	A,(FDRV)
  D4BF  C640          		ADD	A,'A'-1
  D4C1  CDBADB        		CALL	MSG_A
  D4C4  3E3A          		LD	A,':'
  D4C6                	MSG_AR:
  D4C6  C3BADB        		JP	MSG_A
                      	
  D4C9                	PRDEC_HL:
  D4C9  AF            		XOR	A
  D4CA                	PRDEC_AHL:
  D4CA  5F            		LD	E,A
  D4CB  1600          		LD	D,0
  D4CD                	PRDEC_DEHL:
  D4CD  D5            		PUSH	DE
  D4CE  110FF0        		LD	DE,DECBF
  D4D1  0605          		LD	B,5
  D4D3  CDD3D5        		CALL	ZERO_MEMORY_DE	;A=0
  D4D6  D1            		POP	DE
                      	
  D4D7  0E20          		LD	C,32
  D4D9                	DEC1:
  D4D9  29            		ADD	HL,HL
  D4DA  EB            		EX	DE,HL
  D4DB  ED6A          		ADC	HL,HL
  D4DD  EB            		EX	DE,HL
  D4DE  E5            		PUSH	HL
  D4DF  2113F0        		LD	HL,DECBF+4
  D4E2  0605          		LD	B,5
  D4E4                	DEC2:
  D4E4  7E            		LD	A,(HL)
  D4E5  8F            		ADC	A,A
  D4E6  27            		DAA
  D4E7  77            		LD	(HL),A
  D4E8  2B            		DEC	HL
  D4E9  10F9          		DJNZ	DEC2
  D4EB  E1            		POP	HL
  D4EC  0D            		DEC	C
  D4ED  20EA          		JR	NZ,DEC1
                      	
  D4EF  210FF0        		LD	HL,DECBF
  D4F2  3E20          		LD	A,020H
  D4F4  0604          		LD	B,4
  D4F6                	DEC3:
  D4F6  CD03D5        		CALL	DEC4
  D4F9  CD03D5        		CALL	DEC4
  D4FC  23            		INC	HL
  D4FD  10F7          		DJNZ	DEC3
  D4FF                	DECX:
  D4FF  CD03D5        		CALL	DEC4
  D502  AF            		XOR	A
  D503                	DEC4:
  D503  ED6F          		RLD
  D505  FE20          		CP	020H
  D507  2802          		JR	Z,DEC5
  D509  F630          		OR	030H
  D50B                	DEC5:
  D50B  18B9          		JR	MSG_AR
                      	
  D50D                	FPRNT:
  D50D  0608          		LD	B,8
  D50F  CD20D5        		CALL	P_N1
  D512  7E            		LD	A,(HL)
  D513  C680          		ADD	A,NBSP-020H
  D515  FEA0          		CP	NBSP
  D517  2802          		JR	Z,FPR1
  D519  3E2E          		LD	A,'.'
  D51B                	FPR1:
  D51B  CDBADB        		CALL	MSG_A
  D51E  0603          		LD	B,3
                      	
  D520                	P_N1:
  D520  C5            		PUSH	BC
  D521  E5            		PUSH	HL
  D522  7E            		LD	A,(HL)
  D523  CD9FE3        		CALL	CAP3
  D526  CDBADB        		CALL	MSG_A
  D529  E1            		POP	HL
  D52A  C1            		POP	BC
  D52B  23            		INC	HL
  D52C  10F2          		DJNZ	P_N1
  D52E  C9            		RET
                      	
  D52F                	PRTTMS:
  D52F  3E20          		LD	A,020H
  D531  CDBADB        		CALL	MSG_A
                      	
  D534  2AA4EF        		LD	HL,(DTA_CCP+1+24)
  D537  7D            		LD	A,L
  D538  B7            		OR	A
  D539  C8            		RET	Z
  D53A  CB3C          		SRL	H
  D53C  17            		RLA
  D53D  17            		RLA
  D53E  17            		RLA
  D53F  17            		RLA
  D540  E60F          		AND	00FH
  D542  57            		LD	D,A
  D543  7C            		LD	A,H
  D544  C650          		ADD	A,80
  D546  CD89D5        		CALL	PRDEC_A
  D549  3E2D          		LD	A,'-'
  D54B  CDBADB        		CALL	MSG_A
  D54E  7A            		LD	A,D
  D54F  CD89D5        		CALL	PRDEC_A
  D552  3E2D          		LD	A,'-'
  D554  CDBADB        		CALL	MSG_A
  D557  7D            		LD	A,L
  D558  E61F          		AND	01FH
  D55A  CD89D5        		CALL	PRDEC_A
                      	
  D55D  2AA2EF        		LD	HL,(DTA_CCP+1+22)
                      	
  D560  3E20          		LD	A,020H
  D562  CDBADB        		CALL	MSG_A
  D565  7C            		LD	A,H
  D566  65            		LD	H,L
  D567  0603          		LD	B,3
  D569                	PRTTMS1:
  D569  1F            		RRA
  D56A  CB1D          		RR	L
  D56C  10FB          		DJNZ	PRTTMS1
  D56E  E61F          		AND	01FH
  D570  CD89D5        		CALL	PRDEC_A
  D573  3E3A          		LD	A,':'
  D575  CDBADB        		CALL	MSG_A
  D578  7D            		LD	A,L
  D579  0F            		RRCA
  D57A  0F            		RRCA
  D57B  E63F          		AND	03FH
  D57D  CD89D5        		CALL	PRDEC_A
  D580  3E3A          		LD	A,':'
  D582  CDBADB        		CALL	MSG_A
  D585  7C            		LD	A,H
  D586  E61F          		AND	01FH
  D588  87            		ADD	A,A
                      	
                      	;	PRINT10
                      	
  D589                	PRDEC_A:
  D589  E5            		PUSH	HL
  D58A  0608          		LD	B,8
  D58C  4F            		LD	C,A
  D58D  AF            		XOR	A
  D58E                	PRTA1:
  D58E  CB01          		RLC	C
  D590  8F            		ADC	A,A
  D591  27            		DAA
  D592  10FA          		DJNZ	PRTA1
  D594  210FF0        		LD	HL,DECBF
  D597  77            		LD	(HL),A
  D598  AF            		XOR	A
  D599  CDFFD4        		CALL	DECX
  D59C  E1            		POP	HL
  D59D  C9            		RET
                      	
  D59E                	SETFCB:
  D59E  CD5EE1        		CALL	SPCUT
  D5A1  1A            		LD	A,(DE)
  D5A2  FE20          		CP	020H
  D5A4  3801          		JR	C,SETFCBA
  D5A6  1B            		DEC	DE
  D5A7                	SETFCBA:
  D5A7  0624          		LD	B,36
  D5A9  215C00        		LD	HL,FCB1
  D5AC  E5            		PUSH	HL
  D5AD  AF            		XOR	A
  D5AE  CD33E1        		CALL	FILL_MEMORY
  D5B1  E1            		POP	HL
  D5B2  D5            		PUSH	DE
  D5B3  CD9FDA        		CALL	_SYS29		;(BDOS)ファイル名の解析
  D5B6  216C00        		LD	HL,FCB2
  D5B9  CD9FDA        		CALL	_SYS29		;(BDOS)ファイル名の解析
  D5BC  E1            		POP	HL
  D5BD  010050        		LD	BC,05000H
  D5C0  118100        		LD	DE,00081H
  D5C3                	SETFCB1:
  D5C3  7E            		LD	A,(HL)
  D5C4  23            		INC	HL
  D5C5  FE20          		CP	020H
  D5C7  3805          		JR	C,SETFCB2
  D5C9  12            		LD	(DE),A
  D5CA  13            		INC	DE
  D5CB  0C            		INC	C
  D5CC  10F5          		DJNZ	SETFCB1
  D5CE                	SETFCB2:
  D5CE  79            		LD	A,C
  D5CF  328000        		LD	(DTA1),A
  D5D2  04            		INC	B
  D5D3                	ZERO_MEMORY_DE:
  D5D3  AF            		XOR	A
  D5D4                	FILL_MEMORY_DE:
  D5D4  12            		LD	(DE),A
  D5D5  13            		INC	DE
  D5D6  10FC          		DJNZ	FILL_MEMORY_DE
  D5D8  C9            		RET
                      	
  D5D9                	C_COPY:
  D5D9  CD9ED5        		CALL	SETFCB
                      	
  D5DC  1161F0        		LD	DE,ZERO
  D5DF  CD7FE0        		CALL	FILEC2
  D5E2  216C00        		LD	HL,FCB2
  D5E5  CDA6DA        		CALL	S29X1
                      	
  D5E8  3E10          		LD	A,010H
  D5EA  326900        		LD	(FCB1+13),A
  D5ED  216D00        		LD	HL,FCB2+1
  D5F0  CDE9D6        		CALL	CWILD1
  D5F3                	COPY0:
  D5F3  CDE6D6        		CALL	CWILD
  D5F6  215C00        		LD	HL,FCB1
  D5F9  CDE0D2        		CALL	OPEN
  D5FC  37            		SCF
  D5FD                	COPY1:
  D5FD  C0            		RET	NZ
  D5FE  CDF3D2        		CALL	DEFCB
                      	
  D601  3A98EF        		LD	A,(DTA_CCP+13)
  D604  CB67          		BIT	4,A
  D606  2821          		JR	Z,COPY1A
                      	
  D608  215D00        		LD	HL,FCB1+1
  D60B  CDC2E4        		CALL	CHKWILD
  D60E  3814          		JR	C,COPY9
                      	
  D610  3E20          		LD	A,020H
  D612  325D00        		LD	(FCB1+1),A
  D615  2AA5EF        		LD	HL,(DTA_CCP+26)
  D618  23            		INC	HL
  D619  226A00        		LD	(FCB1+14),HL
  D61C  18D5          		JR	COPY0
                      	
  D61E                	COPY8:
  D61E  CD61D8        		CALL	_SYS09		;(BDOS)文字列出力
  D621  CD95D4        		CALL	LTNL
  D624                	COPY9:
  D624  CDEFD2        		CALL	OPEN2
  D627  18D4          		JR	COPY1
                      	
  D629                	COPY1A:
  D629  216C00        		LD	HL,FCB2
  D62C  1114F0        		LD	DE,FDRV
  D62F  018DEF        		LD	BC,DTA_CCP+2
  D632  EDA0          		LDI
  D634  3E0B          		LD	A,11
  D636                	COPY2:
  D636  F5            		PUSH	AF
  D637  7E            		LD	A,(HL)
  D638  FE3F          		CP	'?'
  D63A  2001          		JR	NZ,COPY3
  D63C  0A            		LD	A,(BC)
  D63D                	COPY3:
  D63D  12            		LD	(DE),A
  D63E  03            		INC	BC
  D63F  13            		INC	DE
  D640  23            		INC	HL
  D641  F1            		POP	AF
  D642  3D            		DEC	A
  D643  20F1          		JR	NZ,COPY2
  D645  010500        		LD	BC,16-11
  D648  EDB0          		LDIR
  D64A                	PUTNAME:
  D64A  215D00        		LD	HL,FCB1+1
  D64D  CDC2E4        		CALL	CHKWILD
  D650  300B          		JR	NC,PUTN1
  D652  2115F0        		LD	HL,FDRV+1
  D655  CD0DD5        		CALL	FPRNT
  D658  3E20          		LD	A,020H
  D65A  CDBADB        		CALL	MSG_A
  D65D                	PUTN1:
  D65D  1114F0        		LD	DE,FDRV
  D660  0E16          		LD	C,016H		;(BDOS)ファイルの作成
  D662  CD0ED3        		CALL	SYSTEM0
  D665  2048          		JR	NZ,COPYE2
  D667  67            		LD	H,A		;A=0
  D668  6F            		LD	L,A
  D669  2235F0        		LD	(FDRV+33),HL	;(FCB)ランダムレコード
  D66C  2237F0        		LD	(FDRV+35),HL
  D66F                	COPY6:
  D66F  CD17D3        		CALL	S27BUF
  D672  47            		LD	B,A
  D673  3C            		INC	A
  D674  2831          		JR	Z,COPYE
  D676  7C            		LD	A,H
  D677  B5            		OR	L
  D678  280C          		JR	Z,COPY7
  D67A  1114F0        		LD	DE,FDRV
  D67D  0E26          		LD	C,026H		;(BDOS)ランダムブロック書き込み
  D67F  CD0ED3        		CALL	SYSTEM0
  D682  2023          		JR	NZ,COPYE
  D684  10E9          		DJNZ	COPY6
  D686                	COPY7:
  D686  3A98EF        		LD	A,(DTA_CCP+13)	;(FCB)属性
  D689  3221F0        		LD	(FDRV+13),A
  D68C  219FEF        		LD	HL,DTA_CCP+20	;(FCB)タイムスタンプ
  D68F  1128F0        		LD	DE,FDRV+20
  D692  010400        		LD	BC,4
  D695  EDB0          		LDIR
                      	
  D697  1114F0        		LD	DE,FDRV
  D69A  0E10          		LD	C,010H		;(BDOS)ファイルのクローズ
  D69C  CD0ED3        		CALL	SYSTEM0
  D69F  2006          		JR	NZ,COPYE
                      	
  D6A1  1171F0        		LD	DE,OK
  D6A4  C31ED6        		JP	COPY8
                      	
  D6A7                	COPYE:
  D6A7  1114F0        		LD	DE,FDRV
  D6AA  0E13          		LD	C,013H		;(BDOS)ファイルの削除
  D6AC  CD0500        		CALL	SYSTEM
  D6AF                	COPYE2:
  D6AF  37            		SCF
  D6B0  C9            		RET
                      	
  D6B1                	C_TYPE:
  D6B1  CD9ED5        		CALL	SETFCB
  D6B4  215C00        		LD	HL,FCB1
  D6B7  CDE0D2        		CALL	OPEN
  D6BA  37            		SCF
  D6BB                	TYPE1:
  D6BB  C0            		RET	NZ
  D6BC  CDF3D2        		CALL	DEFCB
  D6BF  3E06          		LD	A,6
  D6C1  CDBADB        		CALL	MSG_A
  D6C4                	TYPE2:
  D6C4  CD17D3        		CALL	S27BUF
  D6C7  C6FE          		ADD	A,0FEH
  D6C9  D8            		RET	C
  D6CA  7C            		LD	A,H
  D6CB  B5            		OR	L
  D6CC  2813          		JR	Z,TYPEE
  D6CE  010001        		LD	BC,00100H
  D6D1                	TYPE3:
  D6D1  0A            		LD	A,(BC)
  D6D2  03            		INC	BC
  D6D3  FE1A          		CP	01AH
  D6D5  280A          		JR	Z,TYPEE
  D6D7  CDBADB        		CALL	MSG_A
  D6DA  2B            		DEC	HL
  D6DB  7C            		LD	A,H
  D6DC  B5            		OR	L
  D6DD  20F2          		JR	NZ,TYPE3
  D6DF  18E3          		JR	TYPE2
  D6E1                	TYPEE:
  D6E1  CDEFD2        		CALL	OPEN2
  D6E4  18D5          		JR	TYPE1
                      	
  D6E6                	CWILD:
  D6E6  215D00        		LD	HL,FCB1+1
  D6E9                	CWILD1:
  D6E9  7E            		LD	A,(HL)
  D6EA  FE20          		CP	020H
  D6EC  C0            		RET	NZ
  D6ED                	CWILD2:
  D6ED  3E3F          		LD	A,'?'
  D6EF  060B          		LD	B,11
  D6F1  C333E1        		JP	FILL_MEMORY
                      	
  D6F4  20202020203C44	DIRMES:	DB	"     <DIR>$"
  D6FF  20203A24      	DIRHD:	DB	"  :$"
                      	
  D703                	COMTB:
  D703  44202020      		DB	"D   "	;1
  D707  F5D3          		DW	C_DIR
  D709  44495220      		DB	"DIR "	;2
  D70D  F5D3          		DW	C_DIR
  D70F  434F5059      		DB	"COPY"	;3
  D713  D9D5          		DW	C_COPY
  D715  43442020      		DB	"CD  "	;4
  D719  13D3          		DW	C_CD
  D71B  44454C20      		DB	"DEL "	;5
  D71F  D8D3          		DW	C_DEL
  D721  50415448      		DB	"PATH"	;6
  D725  9AD4          		DW	C_PATH
  D727  52454E20      		DB	"REN "	;7
  D72B  E2D3          		DW	C_REN
  D72D  54595045      		DB	"TYPE"	;8
  D731  B1D6          		DW	C_TYPE
  D733  52454D20      		DB	"REM "	;9
  D737  5ED8          		DW	C_REM
                      	
                      	;X1DISK2.ASM
                      	
                      	;	LSX-Dodgers DISK2
                      	;	X1/turbo/Z
                      	
                      	;	GRAPHIC RAM DISK DRIVER
                      	
                      	
  D739                	GDRD:
  D739  C5            		PUSH	BC
  D73A  CD62D7        		CALL	GADR
  D73D  F1            		POP	AF
  D73E                	GDRD1:
  D73E  EDA2          		INI
  D740  04            		INC	B
  D741  0C            		INC	C
  D742  20FA          		JR	NZ,GDRD1
  D744  04            		INC	B
  D745  13            		INC	DE
  D746  3D            		DEC	A
  D747  20F5          		JR	NZ,GDRD1
  D749                	GBANK0:
  D749  3ABFF0        		LD	A,(WK1FD0)
  D74C  E6EF          		AND	0EFH		;BANK0
  D74E  181D          		JR	S1FD0
                      	
  D750                	GDWT:
  D750  C5            		PUSH	BC
  D751  CD62D7        		CALL	GADR
  D754  F1            		POP	AF
  D755                	GDWT1:
  D755  04            		INC	B
  D756  EDA3          		OUTI
  D758  0C            		INC	C
  D759  20FA          		JR	NZ,GDWT1
  D75B  04            		INC	B
  D75C  13            		INC	DE
  D75D  3D            		DEC	A
  D75E  20F5          		JR	NZ,GDWT1
  D760  18E7          		JR	GBANK0
                      	
  D762                	GADR:
  D762  0E00          		LD	C,0
  D764  7B            		LD	A,E
  D765  C640          		ADD	A,040H
  D767  47            		LD	B,A
  D768  3ABFF0        		LD	A,(WK1FD0)
  D76B  F610          		OR	010H		;BANK1
  D76D                	S1FD0:
  D76D  C5            		PUSH	BC
  D76E  32BFF0        		LD	(WK1FD0),A
  D771  01D01F        		LD	BC,01FD0H
  D774  ED79          		OUT	(C),A
  D776  C1            		POP	BC
  D777  C9            		RET
                      	
                      	
                      	;	BANK RAM DISK DRIVER
                      	
  D778                	BDWT:
  D778  3E            		DB	03EH	;LD A,??
  D779  37            		SCF
  D77A  1802          		JR	BRW
                      	
  D77C                	BDRD:
  D77C  3E            		DB	03EH	;LD A,??
  D77D  A7            		AND	A
  D77E                	BRW:
  D77E  F3            		DI
  D77F  32AAD7        		LD	(BRWPAT),A
  D782  ED73CAD7      		LD	(BANKSP),SP
  D786  3ACBD7        		LD	A,(BANKSP_H)
  D789  87            		ADD	A,A
  D78A  3803          		JR	C,BRW0
  D78C  31CAFF        		LD	SP,EXTSP
  D78F                	BRW0:
  D78F  D9            		EXX		;裏レジスタ
  D790  C5            		 PUSH	 BC
  D791  D5            		 PUSH	 DE
  D792  01000B        		 LD	 BC,00B00H	 ;バンクメモリ
  D795  111010        		 LD	 DE,01010H
  D798  D9            		 EXX		;表レジスタ
  D799                	BRW1:
  D799  C5            		PUSH	BC
  D79A  D5            		PUSH	DE
  D79B  EB            		EX	DE,HL
  D79C  29            		ADD	HL,HL
  D79D  29            		ADD	HL,HL
  D79E  7C            		LD	A,H
  D79F  DD860C        		ADD	A,(IX+DPB_MAXCYL)
  D7A2  E60F          		AND	00FH	;バンク
  D7A4  65            		LD	H,L
  D7A5  CB3C          		SRL	H	;/2
  D7A7  2E00          		LD	L,0
  D7A9  D9            		EXX		;裏レジスタ
  D7AA  A7            	BRWPAT:	 AND	 A	;自己書き換え(AND A:読み出し/SCF:書き込み)
  D7AB  3808          		 JR	 C,BRWT
  D7AD  57            		 LD	 D,A	 ;D=バンク
  D7AE  D9            		 EXX		;表レジスタ
  D7AF  EB            		EX	DE,HL
  D7B0  CDCED7        		CALL	BTFR
  D7B3  1806          		JR	BRW2
  D7B5                	BRWT:
  D7B5  5F            		 LD	E,A	 ;E=バンク
  D7B6  D9            		 EXX		;表レジスタ
  D7B7  CDCED7        		CALL	BTFR
  D7BA  EB            		EX	DE,HL
  D7BB                	BRW2:
  D7BB  D1            		POP	DE
  D7BC  C1            		POP	BC
  D7BD  13            		INC	DE
  D7BE  10D9          		DJNZ	BRW1
                      	
  D7C0  D9            		EXX		;裏レジスタ
  D7C1  3E10          		 LD	 A,10H
  D7C3  ED79          		 OUT	 (C),A		;メインメモリに切り替える
  D7C5  D1            		 POP	 DE
  D7C6  C1            		 POP	 BC
  D7C7  D9            		 EXX		;表レジスタ
  D7C8  AF            		XOR	A
  D7C9  310000        		LD	SP,0
  D7CB                	BANKSP_H	EQU	$-1
  D7CA                	BANKSP		EQU	$-2
  D7CC  FB            		EI
  D7CD  C9            		RET
                      	
                      	;メインメモリ←→バンクメモリ 512バイトの転送を行う
                      	; DE:転送元アドレス
                      	; HL:転送先アドレス
                      	; 裏BC:バンク切り替えポート(0B00H)
                      	; 裏D:転送元バンク(0-0FH:10Hはメインメモリ)
                      	; 裏E:転送先バンク(0-0FH:10Hはメインメモリ)
                      	
  D7CE                	BTFR:
  D7CE  0600          		LD	B,0	;256回ループ(256*2)
  D7D0                	BTFR1:
  D7D0  D9            		EXX		;裏レジスタ
  D7D1  ED51          		 OUT	 (C),D	 ;BANK(MAIN)
  D7D3  D9            		 EXX		;表レジスタ
  D7D4  1A            		LD	A,(DE)
  D7D5  4F            		LD	C,A
  D7D6  13            		INC	DE
  D7D7  1A            		LD	A,(DE)
  D7D8  13            		INC	DE
  D7D9  D9            		EXX		;裏レジスタ
  D7DA  ED59          		 OUT	 (C),E	 ;MAIN(BANK)
  D7DC  D9            		 EXX		;表レジスタ
  D7DD  71            		LD	(HL),C
  D7DE  23            		INC	HL
  D7DF  77            		LD	(HL),A
  D7E0  23            		INC	HL
  D7E1  10ED          		DJNZ	BTFR1
  D7E3  C9            		RET
                      	
                      	;	EMM DRIVER(DMA)
                      	
                      	
  D7E4                	EDWT:
  D7E4  0E0F          		LD	C,15
  D7E6  1802          		JR	EDWT1
  D7E8                	EDRD:
  D7E8  0E0E          		LD	C,14
  D7EA                	EDWT1:
  D7EA  C5            		PUSH	BC
  D7EB  D5            		PUSH	DE
  D7EC  222CD8        		LD	(DMAB),HL
  D7EF  78            		LD	A,B
  D7F0  87            		ADD	A,A
  D7F1  3D            		DEC	A
  D7F2  3225D8        		LD	(DMALEN+1),A
  D7F5  3C            		INC	A
  D7F6  84            		ADD	A,H	;HL(アドレス)を先に進めておく
  D7F7  67            		LD	H,A
  D7F8  EB            		EX	DE,HL
  D7F9  29            		ADD	HL,HL
  D7FA  DD460C        		LD	B,(IX+DPB_MAXCYL)
  D7FD  79            		LD	A,C
  D7FE  DD4E0D        		LD	C,(IX+DPB_MAXSEC)
  D801  09            		ADD	HL,BC
  D802  DD4E13        		LD	C,(IX+DPB_UNITNO)
  D805  060D          		LD	B,00DH
  D807  ED49          		OUT	(C),C
  D809  0C            		INC	C
  D80A  ED69          		OUT	(C),L
  D80C  0C            		INC	C
  D80D  ED61          		OUT	(C),H
                      	
  D80F  2120D8        		LD	HL,EDMAD
  D812  CD8FDF        		CALL	SETDMA
  D815  CDB7DF        		CALL	GO_DMA
  D818  EB            		EX	DE,HL
  D819  D1            		POP	DE
  D81A  C1            		POP	BC
  D81B                	DMA_ADD_SEC:
  D81B  13            		INC	DE
  D81C  10FD          		DJNZ	DMA_ADD_SEC
  D81E  AF            		XOR	A
  D81F  C9            		RET
                      	
  D820                	EDMAD:
  D820  C3            		DB	0C3H	;WR6 リセット
  D821  7D            		DB	07DH	;WR0 ポートA→ポートB 転送
  D822  030D          		DW	00D03H	;ポートA開始アドレス EMMリード/ライト
  D824  FF01          	DMALEN:	DW	001FFH	;ブロック長(転送サイズ-1)
  D826  2C            		DB	02CH	;WR1 ポートAアドレス固定 I/O
  D827  50            		DB	050H	;WR2 ポートBアドレスインクリメント メモリ
  D828  02            		DB	002H	;ポートBタイミング
  D829  80            		DB	080H	;WR3
  D82A  9A            		DB	09AH	;WR5 WAIT RDY:HIGH
  D82B  AD            		DB	0ADH	;WR4 連続 ポートB開始アドレス
  D82C  0000          	DMAB:	DW	0
  D82E  01            		DB	001H	;WR0 ポートA←ポートB 転送
  D82F                	EMME:
                      	
  06B5                	AT_RE	EQU	EDWT-AT_EDWT
                      	
                      	
                      	;LDOS.ASM
                      	
                      	;	LSX-Dodgers OS
                      	
  D82F                	BDOS0:
  D82F  E5            		PUSH	HL
  D830  79            		LD	A,C
  D831  FE3C          		CP	03CH
  D833  3802          		JR	C,DOS1
  D835  3E3C          		LD	A,03CH
  D837                	DOS1:
  D837  87            		ADD	A,A
  D838  6F            		LD	L,A
  D839  26F1          		LD	H,STABLE/256
  D83B  7E            		LD	A,(HL)
  D83C  2C            		INC	L
  D83D  66            		LD	H,(HL)
  D83E  6F            		LD	L,A
  D83F  E3            		EX	(SP),HL
  D840  79            		LD	A,C
                      	;確認用
                      	;	LD	(0050H),A
  D841  C9            		RET
  D842                	_DOS2:
  D842  FE5A          		CP	05AH		;(BDOS)カレントディレクトリの変更(_CHDIR)
  D844  CAE1DA        		JP	Z,_SYS5A
  D847  FE5C          		CP	05CH		;(BDOS)ファイル名の解析(_PFILE)
  D849  CA9FDA        		JP	Z,_SYS29
  D84C  FE5F          		CP	05FH		;(BDOS)ディスクバッファのフラッシュ(_FLUSH)
  D84E  CADBED        		JP	Z,_SYS5F
  D851  FE6F          		CP	06FH		;(BDOS)MSX-DOS のバージョン番号の獲得(_DOSVER)
  D853  200A          		JR	NZ,_ERROR
  D855  011D01        		LD	BC,VER_6F
  D858  115701        		LD	DE,VER
  D85B  210000        		LD	HL,MACD
  D85E                	C_REM:
  D85E  AF            		XOR	A
  D85F                	_ERROR:
  D85F  A7            		AND	A
  D860  C9            		RET
                      	
  D861                	_SYS09:		;文字列出力
  D861  D5            		PUSH	DE
  D862                	_SX09:
  D862  1A            		LD	A,(DE)
  D863  13            		INC	DE
  D864  FE24          		CP	'$'
  D866  2831          		JR	Z,SX0E2
  D868  CDBADB        		CALL	MSG_A
  D86B  18F5          		JR	_SX09
                      	
  D86D                	MSX1:
  D86D  CDBADB        		CALL	MSG_A
  D870                	MSX:
  D870  7E            		LD	A,(HL)
  D871  23            		INC	HL
  D872  B7            		OR	A
  D873  20F8          		JR	NZ,MSX1
  D875  C9            		RET
                      	
  D876                	_SYS0C:		;(BDOS)バージョン番号の獲得
  D876  212200        		LD	HL,00022H
  D879  7D            		LD	A,L
  D87A  C9            		RET
                      	
  D87B                	_SYS0D:		;(BDOS)ディスクリセット
  D87B  CDDFF0        		CALL	_FFLUSH
  D87E  E5            		PUSH	HL
  D87F  218000        		LD	HL,00080H
  D882  228AF0        		LD	(_DTA),HL
  D885  E1            		POP	HL
  D886  D5            		PUSH	DE
  D887  1E00          		LD	E,0
  D889  3E            		DB	03EH
                      	
  D88A                	_SYS0E:		;(BDOS)カレントドライブの設定
  D88A  D5            		PUSH	DE
  D88B  7B            		LD	A,E
  D88C  DDE5          		PUSH	IX
  D88E  CDDCF0        		CALL	_GETDPB
  D891  DDE1          		POP	IX
  D893  3804          		JR	C,SX0E2
  D895  7B            		LD	A,E
  D896  3287F0        		LD	(_DVSW),A
  D899                	SX0E2:
  D899  D1            		POP	DE
  D89A  C9            		RET
                      	
  D89B                	_SYS0F:		;(BDOS)ファイルのオープン
  D89B  CD70E1        		CALL	SETDRV
  D89E  FD7E1C        		LD	A,(IY+28)	;(FCB)オープンモード
  D8A1  C602          		ADD	A,002H		;Write
  D8A3  2848          		JR	Z,FEND0F
  D8A5  CDBEE4        		CALL	CHKWILDX
                      	
  D8A8  D490E1        		CALL	NC,SOPENX
  D8AB                	_S16XX:
  D8AB  3840          		JR	C,FEND0F
                      					;Directory location
  D8AD  3A9FF0        		LD	A,(_FILEN)
  D8B0  FD7719        		LD	(IY+25),A	;(FCB)ディレクトリロケーション
                      	;				_DIRF
  D8B3  3AA0F0        		LD	A,(_DIRF)
  D8B6  FD771D        		LD	(IY+29),A	;(FCB)ディレクトリモード
                      	;				_FBPS
  D8B9  FD731E        		LD	(IY+30),E	;(FCB)ディレクトリポジション
  D8BC  FD721F        		LD	(IY+31),D
                      	;				Open(Read)
  D8BF  FD361CFF      		LD	(IY+28),0FFH	;(FCB)オープンモード
                      	;				FILENAME
  D8C3  FDE5          		PUSH	IY
  D8C5  D1            		POP	DE
  D8C6  13            		INC	DE
  D8C7  010B00        		LD	BC,11
  D8CA  EDB0          		LDIR
                      	;				Attribute
  D8CC  7E            		LD	A,(HL)
  D8CD  FD770D        		LD	(IY+13),A	;(FCB)属性(アトリビュート)
  D8D0  110B00        		LD	DE,11		;Reserved
  D8D3  19            		ADD	HL,DE
                      						;(FCB)ファイルを最後に変更した時刻
  D8D4  11E4F1        		LD	DE,SDDATA		;(FCB)ファイルを最後に変更した日付
  D8D7  060A          		LD	B,SDDATAE-SDDATA	;(FCB)ファイルの先頭クラスタ
  D8D9                	S16LOOP:				;(FCB)ファイルのサイズ(バイト単位)
  D8D9  1A            		LD	A,(DE)
  D8DA  13            		INC	DE
  D8DB  32E2D8        		LD	(S16PAT+2),A
  D8DE  7E            		LD	A,(HL)
  D8DF  23            		INC	HL
  D8E0  FD7700        	S16PAT:	LD	(IY+0),A
  D8E3  10F4          		DJNZ	S16LOOP
                      	
  D8E5  AF            		XOR	A
  D8E6  FD770C        		LD	(IY+12),A	;(FCB)カレントブロック
  D8E9  FD2291D9      		LD	(OFCB+1),IY
  D8ED                	FEND0F:
  D8ED  1845          		JR	FEND10
                      	
  D8EF                	_SYS10:		;(BDOS)ファイルのクローズ
  D8EF  CD70E1        		CALL	SETDRV
  D8F2  FD7E1C        		LD	A,(IY+28)	;(FCB)オープンモード
  D8F5  D6FE          		SUB	0FEH
  D8F7  37            		SCF
  D8F8  3F            		CCF
  D8F9  2039          		JR	NZ,FEND10
  D8FB                	_S10A:				;Write
  D8FB  FD770E        		LD	(IY+14),A	;(FCB)レコードサイズ/アクセスするディレクトリのクラスタ番号+1
  D8FE  FD770F        		LD	(IY+15),A
                      	
  D901  FD341C        		INC	(IY+28)		;0FEH->0FFH ;オープンモード
  D904  CDBAE5        		CALL	SETTMS
                      	
  D907  FD7E1D        		LD	A,(IY+29)	;(FCB)ディレクトリモード
  D90A  32A0F0        		LD	(_DIRF),A
  D90D  E67F          		AND	07FH
  D90F  32E5EA        		LD	(_SECPS+1),A
  D912  FD5E1E        		LD	E,(IY+30)	;(FCB)ディレクトリポジション
  D915  FD561F        		LD	D,(IY+31)
  D918  CDC4E2        		CALL	READ_DIR
  D91B  3817          		JR	C,FEND10
                      	
  D91D  3AEEE1        	SDECM1:	LD	A,(SDECPAT+1)	;1セクタ辺りのディレクトリエントリ数
  D920  3D            	 	DEC	A		;1024=01FH / 512=00FH / 256=7
  D921  FDA619        		AND	(IY+25)		;(FCB)ディレクトリロケーション
  D924  6F            		LD	L,A
  D925  2600          		LD	H,0
  D927  29            		ADD	HL,HL		;*2
  D928  29            		ADD	HL,HL		;*4
  D929  29            		ADD	HL,HL		;*8
  D92A  29            		ADD	HL,HL		;*16
  D92B  29            		ADD	HL,HL		;*32
  D92C  ED4B7EF1      		LD	BC,(_DTBUF)
  D930  09            		ADD	HL,BC
                      	
  D931  CDCEE4        		CALL	SDIRENT
  D934                	FEND10:
  D934  1842          		JR	FEND
                      	
  D936                	_SYS11:		;(BDOS)最初のファイルの検索
  D936  CD70E1        		CALL	SETDRV
  D939  CDBDE1        		CALL	SOPEN
  D93C                	_S12X1:
  D93C  383A          		JR	C,FEND
  D93E  CD5DE2        		CALL	SOPENE2
  D941  ED5B8AF0      		LD	DE,(_DTA)
  D945  3A88F0        		LD	A,(_DRV)
  D948  3C            		INC	A
  D949  12            		LD	(DE),A
  D94A  D5            		PUSH	DE
  D94B  13            		INC	DE
  D94C  012000        		LD	BC,32
  D94F  EDB0          		LDIR
  D951  FD6E0E        		LD	L,(IY+14)	;(FCB)レコードサイズ/アクセスするディレクトリのクラスタ番号+1
  D954  FD660F        		LD	H,(IY+15)
  D957  22F4F1        		LD	(SCDIR),HL
  D95A  2A9AF0        		LD	HL,(_FBPS)
  D95D  22F6F1        		LD	(SFBPS),HL
  D960  2A9FF0        		LD	HL,(_FILEN)
  D963  7C            		LD	A,H
  D964  B7            		OR	A
  D965  2806          		JR	Z,_S12DIR
  D967  3AE5EA        		LD	A,(_SECPS+1)
  D96A  F680          		OR	080H
  D96C  67            		LD	H,A
  D96D                	_S12DIR:
  D96D  22F8F1        		LD	(SFNDF),HL	;Directory position and Flags
  D970  E1            		POP	HL
  D971  1139F0        		LD	DE,SFILE
  D974  0E21          		LD	C,33
  D976                	_S11B:
  D976  EDB0          		LDIR
  D978                	FEND:
  D978  9F            		SBC	A,A		;CF=0 A=0 : CF=1 A=0FFH
  D979                	FENDE:
  D979  FDE1          		POP	IY
  D97B  C1            		POP	BC
  D97C  D1            		POP	DE
  D97D  E1            		POP	HL
  D97E  C9            		RET
                      	
  D97F                	_SYS12:		;(BDOS)次のファイルの検索
  D97F  E5            		PUSH	HL
  D980  D5            		PUSH	DE
  D981  C5            		PUSH	BC
  D982  FDE5          		PUSH	IY
  D984  CD21E2        		CALL	NOPEN
  D987  18B3          		JR	_S12X1
                      	
  D989                	_S16K:
  D989  FD7E1C        		LD	A,(IY+28)	;(FCB)オープンモード
  D98C  FEFD          		CP	0FDH		;Device(0FDH)
  D98E  37            		SCF
  D98F  C8            		RET	Z
                      	
  D990  110000        	OFCB:	LD	DE,0
  D993  D5            		PUSH	DE
  D994  061A          		LD	B,26		;First cluster
  D996                	S16K1:
  D996  13            		INC	DE
  D997  23            		INC	HL
  D998  10FC          		DJNZ	S16K1
                      	
  D99A  1A            		LD	A,(DE)
  D99B  BE            		CP	(HL)
  D99C  2013          		JR	NZ,S16K2
  D99E  13            		INC	DE
  D99F  23            		INC	HL
  D9A0  1A            		LD	A,(DE)
  D9A1  BE            		CP	(HL)
  D9A2  200D          		JR	NZ,S16K2
                      	
  D9A4  E1            		POP	HL
  D9A5  FDE5          		PUSH	IY
  D9A7  D1            		POP	DE
  D9A8  1A            		LD	A,(DE)		;Drive
  D9A9  BE            		CP	(HL)
  D9AA  2006          		JR	NZ,S16K3
                      					;ここはCFが必ず0
  D9AC  ED52          		SBC	HL,DE		;CP HL,DE
  D9AE  37            		SCF
  D9AF  C0            		RET	NZ
  D9B0  E5            		PUSH	HL
  D9B1                	S16K2:
  D9B1  E1            		POP	HL
  D9B2                	S16K3:
  D9B2  FDE5          		PUSH	IY
  D9B4  D1            		POP	DE
  D9B5                	_SYS13:		;(BDOS)ファイルの削除
  D9B5  CD70E1        		CALL	SETDRV
  D9B8  CDEEE3        		CALL	KILL
  D9BB                	FEND13:
  D9BB  18BB          		JR	FEND
                      	
  D9BD                	_SYS14:		;(BDOS)シーケンシャルな読み出し
  D9BD  CD70E1        		CALL	SETDRV
  D9C0  CD26E6        		CALL	INIT_SEQ
  D9C3                	SREAD:
  D9C3  CD6EE6        		CALL	RB_READ
                      	
  D9C6  C601          		ADD	A,001H
  D9C8  38AE          		JR	C,FEND
                      	
  D9CA  7D            		LD	A,L
  D9CB  D601          		SUB	001H
  D9CD                	FENDX:
  D9CD  9F            		SBC	A,A
  D9CE  E603          		AND	3
  D9D0  1F            		RRA
  D9D1  18A6          		JR	FENDE
                      	
  D9D3                	_SYS15:		;(BDOS)シーケンシャルな書き込み
  D9D3  CD70E1        		CALL	SETDRV
  D9D6  CD26E6        		CALL	INIT_SEQ
  D9D9                	SWRITE:
  D9D9  CD67E6        		CALL	RB_WRITE
                      	
  D9DC  C6FF          		ADD	A,0FFH
  D9DE  18ED          		JR	FENDX
                      	
  D9E0                	_SYS17:		;(BDOS)ファイル名の変更
  D9E0  CD70E1        		CALL	SETDRV
  D9E3  CD44E4        		CALL	NAME
  D9E6  18D3          		JR	FEND13
                      	
  D9E8                	_SYS16:		;(BDOS)ファイルの作成
  D9E8  CD70E1        		CALL	SETDRV
                      	
  D9EB  CDBEE4        		CALL	CHKWILDX
  D9EE  38CB          		JR	C,FEND13
  D9F0  FD7E01        		LD	A,(IY+1)	;(FCB)主ファイル名
  D9F3  FE05          		CP	5
  D9F5  2805          		JR	Z,_S16X2
  D9F7  FE21          		CP	021H
  D9F9  DABBD9        		JP	C,FEND13
  D9FC                	_S16X2:
                      	;				Clear FCB
  D9FC  FDE5          		PUSH	IY
  D9FE  E1            		POP	HL
  D9FF  011000        		LD	BC,16
  DA02  09            		ADD	HL,BC
  DA03                	_S16X1:
  DA03  70            		LD	(HL),B		;B=0
  DA04  23            		INC	HL
  DA05  0D            		DEC	C
  DA06  20FB          		JR	NZ,_S16X1
                      	
  DA08  CDBFE5        		CALL	SETTMSX
  DA0B  FD360DFF      		LD	(IY+13),0FFH	;(FCB)Attribute
  DA0F  CD90E1        		CALL	SOPENX
  DA12  3F            		CCF
  DA13  CC89D9        		CALL	Z,_S16K
  DA16  D46EE2        		CALL	NC,COPEN
  DA19  D4CEE4        		CALL	NC,SDIRENT
  DA1C  C3ABD8        		JP	_S16XX
                      	
  DA1F                	_SYS21:		;(BDOS)ランダムな読み出し
  DA1F  CD70E1        		CALL	SETDRV
  DA22  CD0AE6        		CALL	INIT_RND
  DA25  189C          		JR	SREAD
                      	
  DA27                	_SYS22:		;(BDOS)ランダムな書き込み
  DA27                	_SYS28:		;(BDOS)ランダムな書き込み・その2
  DA27  CD70E1        		CALL	SETDRV
  DA2A  CD0AE6        		CALL	INIT_RND
  DA2D  18AA          		JR	SWRITE
                      	
  DA2F                	_SYS18:		;(BDOS)ログインベクトルの獲得
  DA2F  21FF00        		LD	HL,000FFH
  DA32  AF            		XOR	A
  DA33  C9            		RET
                      	
  DA34                	_SYS19:		;(BDOS)カレントドライブ番号の獲得
  DA34  3A87F0        		LD	A,(_DVSW)
  DA37  A7            		AND	A
  DA38  C9            		RET
                      	
  DA39                	_SYS1A:		;(BDOS)DTAの設定
  DA39  ED538AF0      		LD	(_DTA),DE
  DA3D  AF            		XOR	A
  DA3E  C9            		RET
                      	
  DA3F                	_SYS1B:		;(BDOS)ディスク情報の獲得
  DA3F  7B            		LD	A,E
  DA40  CD83E1        		CALL	GETDRV
  DA43  CDDCF0        		CALL	_GETDPB
  DA46  D4E2F0        		CALL	NC,_RDFATX
  DA49  210000        		LD	HL,0
  DA4C  D498E5        		CALL	NC,DSKF
                      	
  DA4F  ED5B99E5      		LD	DE,(MAXCLP+1)	;DPB_MAXCL-1
  DA53  1B            		DEC	DE		;DE←クラスタの総数
  DA54  FD2A7CF1      		LD	IY,(_FATBF)	;IY←メモリ上のFATの先頭アドレス
  DA58  9F            		SBC	A,A
  DA59  D8            		RET	C
  DA5A  4F            		LD	C,A		;C=0
  DA5B  DD7E0F        		LD	A,(IX+DPB_BPS)
  DA5E  E60F          		AND	00FH
  DA60  47            		LD	B,A
  DA61  DD7E07        		LD	A,(IX+DPB_SECPCL)
  DA64  C9            		RET
                      	
  DA65                	_SYS1D:		;(BDOS)書き込みが禁止されているディスクの調査
  DA65  AF            		XOR	A
  DA66  67            		LD	H,A
  DA67  6F            		LD	L,A
  DA68  C9            		RET
                      	
  DA69                	_SYS1F:		;(BDOS)ディスク装置のパラメータの読み出し
  DA69  2100F2        		LD	HL,_DEVICE
  DA6C  7B            		LD	A,E
  DA6D  C3DCF0        		JP	_GETDPB
                      	
  DA70                	_SYS23:		;(BDOS)ファイルサイズの獲得
  DA70  E5            		PUSH	HL
  DA71  2A1EF1        		LD	HL,(STABLE+2*00FH)	;ファイルのオープン
  DA74  CD0F00        		CALL	JP_HL
  DA77  381B          		JR	C,_S23X1
                      	
  DA79  D5            		PUSH	DE		;EX DE,IY
  DA7A  FDE3          		EX	(SP),IY		;
                      	;	POP	DE		;
                      	;	PUSH	DE		;DEを破壊しないように注意vv
  DA7C  FD7E10        		LD	A,(IY+16)	;(FCB)ファイルのサイズ(バイト単位)
  DA7F  FD6E11        		LD	L,(IY+17)	;
  DA82  FD6612        		LD	H,(IY+18)	;
  DA85  C5            		PUSH	BC		;
  DA86  FD4613        		LD	B,(IY+19)	;
  DA89  CDFCE5        		CALL	GET_CPM_R_SIZE
  DA8C  C1            		POP	BC
  DA8D                	_S24X1:
  DA8D  CD1CE6        		CALL	SET_RR_AHL
                      	;	POP	DE		;^^^^^^^^^^^^^^^^^^^^^^^^
                      	;	PUSH	DE		;EX DE,IY
  DA90  FDE3          		EX	(SP),IY		;
  DA92  D1            		POP	DE		;
                      	
  DA93  AF            		XOR	A
  DA94                	_S23X1:
  DA94  E1            		POP	HL
  DA95  C9            		RET
                      	
  DA96                	_SYS24:		;(BDOS)ランダムレコードフィールドの設定
  DA96  E5            		PUSH	HL
  DA97  D5            		PUSH	DE		;EX DE,IY
  DA98  FDE3          		EX	(SP),IY		;
                      	;	POP	DE		;
                      	;	PUSH	DE		;DEを破壊しないように注意vv
  DA9A  CD2EE6        		CALL	GETSEQ
  DA9D  18EE          		JR	_S24X1		;^^^^^^^^^^^^^^^^^^^^^^^^
                      	
  DA9F                	_SYS29:		;(BDOS)ファイル名の解析(_PPATH)
  DA9F  C5            		PUSH	BC
  DAA0  E5            		PUSH	HL
  DAA1  CD87E0        		CALL	FILE
  DAA4  E1            		POP	HL
  DAA5  C1            		POP	BC
  DAA6                	S29X1:
  DAA6  C5            		PUSH	BC
  DAA7  D5            		PUSH	DE
  DAA8  E5            		PUSH	HL
  DAA9  EB            		EX	DE,HL
  DAAA  AF            		XOR	A
  DAAB  3221F0        		LD	(FDRV+13),A
  DAAE  2114F0        		LD	HL,FDRV
  DAB1  011000        		LD	BC,16
  DAB4  EDB0          		LDIR
  DAB6  E1            		POP	HL
  DAB7  D1            		POP	DE
  DAB8  C1            		POP	BC
  DAB9  C9            		RET
                      	
  DABA                	_SYS30:		;(BDOS)論理セクタを用いた書き込み
  DABA  C5            		PUSH	BC
  DABB  017FEC        		LD	BC,DWT24B
  DABE  1804          		JR	S2FX
  DAC0                	_SYS2F:
  DAC0  C5            		PUSH	BC
  DAC1  016FEC        		LD	BC,DRD24B
  DAC4                	S2FX:
  DAC4  ED43DADA      		LD	(S2FPAT+1),BC
  DAC8  CDDFF0        		CALL	_FFLUSH
                      	
  DACB  D5            		PUSH	DE
  DACC  E5            		PUSH	HL
  DACD  7D            		LD	A,L		;Drive
  DACE  CDD9F0        		CALL	_CHGDRV
  DAD1  3809          		JR	C,S30X2
  DAD3  44            		LD	B,H		;Number of clusters
  DAD4  2A8AF0        		LD	HL,(_DTA)
                      	
  DAD7  0E00          		LD	C,0
  DAD9  CD6FEC        	S2FPAT:	CALL	DRD24B
  DADC                	S30X2:
  DADC  E1            		POP	HL
  DADD  D1            		POP	DE
  DADE  C1            		POP	BC
  DADF  9F            		SBC	A,A
  DAE0  C9            		RET
                      	
  DAE1                	_SYS5A:		;(BDOS)カレントディレクトリの変更
  DAE1  C5            		PUSH	BC
  DAE2  D5            		PUSH	DE
  DAE3  E5            		PUSH	HL
  DAE4  CD7CE0        		CALL	FILEC
  DAE7  210000        		LD	HL,0
  DAEA  1114F0        		LD	DE,FDRV
  DAED  2A4EF1        		LD	HL,(STABLE+2*027H)	;ランダムブロック読み込み
  DAF0  CD0F00        		CALL	JP_HL
  DAF3  18E7          		JR	S30X2
                      	
                      	;X1IO.ASM
                      	
                      	;	LSX-Dodgers IO
                      	;	X1/turbo/Z
                      	
  D85F                	_SYS04	EQU	_ERROR		;(BDOS)外部出力
  D85F                	_SYS05	EQU	_ERROR		;(BDOS)プリンタ出力
  D85F                	_SYS1C	EQU	_ERROR		;(BDOS)ディスクの書き込み禁止化
  D85F                	_SYS1E	EQU	_ERROR		;(BDOS)ファイル属性の設定
  D85F                	_SYS20	EQU	_ERROR		;(BDOS)利用者番号の設定と読み出し
  D85F                	_SYS2E	EQU	_ERROR		;(BDOS)ベリファイ・フラグの設定
                      	
  DAF5                	BIOS:
  DAF5  E5            		PUSH	HL
  DAF6  211080        		LD	HL,08010H
  DAF9  39            		ADD	HL,SP
  DAFA  E1            		POP	HL
  DAFB  300E          		JR	NC,BIOS2
  DAFD                	BIOS1:
  DAFD  CD05DB        		CALL	BIOS3
  DB00  061E          		LD	B,01EH
  DB02  ED79          		OUT	(C),A
  DB04  C9            		RET
  DB05                	BIOS3:
  DB05  C5            		PUSH	BC
  DB06  061D          		LD	B,01DH
  DB08  ED79          		OUT	(C),A
  DB0A  C9            		RET
  DB0B                	BIOS2:
  DB0B  ED7316DB      		LD	(BIOS_SP),SP	;スタックがBIOS-ROMと被っている場合
  DB0F  31CAFF        		LD	SP,EXTSP
  DB12  CDFDDA        		CALL	BIOS1
  DB15  310000        		LD	SP,0
  DB16                	BIOS_SP	EQU	$-2
  DB18  C9            		RET
                      	
  DB19                	INT:
  DB19  F5            		PUSH	AF
  DB1A  E5            		PUSH	HL
  DB1B  C5            		PUSH	BC
                      	
  DB1C  CDBEDE        		CALL	IN49SB
  DB1F  67            		LD	H,A
  DB20  CDBEDE        		CALL	IN49SB
  DB23  6F            		LD	L,A
  DB24                	SCEXE:
  DB24  2292F0        		LD	(_KEYD),HL
  DB27  CD55DB        		CALL	KEYSET1
                      	
  DB2A  C1            		POP	BC
  DB2B                	INTPE:
  DB2B  E1            		POP	HL
  DB2C                	INTPE2:
  DB2C  F1            		POP	AF
  DB2D                	INTCTCE:
  DB2D  FB            		EI
  DB2E  ED4D          		RETI
                      	
  DB30                	INTCTC2:
  DB30  F5            		PUSH	AF
  DB31  3E00          		LD	A,000H
  DB32                	INTCPAT	EQU	$-1
  DB33  3D            		DEC	A
  DB34  3232DB        		LD	(INTCPAT),A
  DB37  20F3          		JR	NZ,INTPE2
                      	
  DB39  3A92F0        		LD	A,(_KEYD)
  DB3C  B7            		OR	A
  DB3D  28ED          		JR	Z,INTPE2
  DB3F                	KEYSET0:
  DB3F  E5            		PUSH	HL
  DB40  2A90F0        		LD	HL,(_KEYPS)
  DB43  7C            		LD	A,H
  DB44  AD            		XOR	L
                      	
  DB45  2A92F0        		LD	HL,(_KEYD)
  DB48  CC89DB        		CALL	Z,KEYSET
                      	
  DB4B  3A94F0        		LD	A,(_KEYSP)
  DB4E  E60F          		AND	00FH
  DB50  3232DB        		LD	(INTCPAT),A
                      	
  DB53  18D6          		JR	INTPE
                      	
  DB55                	KEYSET1:
  DB55  CB6C          		BIT	5,H
  DB57  F5            		PUSH	AF
  DB58  ED4B8CF0      		LD	BC,(_CTC)
  DB5C  78            		LD	A,B
  DB5D  B1            		OR	C
  DB5E  2006          		JR	NZ,KEYS10E
                      	
  DB60  F1            		POP	AF
  DB61  2026          		JR	NZ,KEYSET
  DB63  F5            		PUSH	AF
  DB64  18D9          		JR	KEYSET0
  DB66                	KEYS10E:
  DB66  F1            		POP	AF
  DB67  C8            		RET	Z
  DB68  F5            		PUSH	AF
  DB69  3E03          		LD	A,3		;CTC STOP
  DB6B  ED79          		OUT	(C),A
  DB6D  F1            		POP	AF
                      	
  DB6E  B7            		OR	A
  DB6F  C8            		RET	Z
                      	
  DB70  3EA7          		LD	A,0A7H
  DB72  ED79          		OUT	(C),A
  DB74  3A94F0        		LD	A,(_KEYSP)
  DB77  ED79          		OUT	(C),A
  DB79  79            		LD	A,C
  DB7A  E6FC          		AND	0FCH
  DB7C  4F            		LD	C,A
  DB7D  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  DB7F  3EC0          		LD	A,CTC0-CPM_BOOT
  DB81  ED79          		OUT	(C),A
  DB83  3A95F0        		LD	A,(_KEYSP+1)
  DB86  3232DB        		LD	(INTCPAT),A
                      	
  DB89                	KEYSET:
  DB89  7D            		LD	A,L
  DB8A  CB74          		BIT	6,H
  DB8C  C0            		RET	NZ
  DB8D                	KEYBS:
  DB8D  B7            		OR	A
  DB8E  C8            		RET	Z
  DB8F                	KEYBS1:
  DB8F  CDA7DB        		CALL	KEYBC_IFBREAK
  DB92  E5            		PUSH	HL
  DB93  F5            		PUSH	AF
  DB94  2A90F0        		LD	HL,(_KEYPS)
  DB97  2C            		INC	L
  DB98  CBAD          		RES	5,L
  DB9A  7D            		LD	A,L
  DB9B  BC            		CP	H
  DB9C  2815          		JR	Z,POP_AF_HL_SCF_RET
  DB9E  3290F0        		LD	(_KEYPS),A
  DBA1  26FF          		LD	H,KEYBF/256
  DBA3  F1            		POP	AF
  DBA4  77            		LD	(HL),A
  DBA5  E1            		POP	HL
  DBA6  C9            		RET
  DBA7                	KEYBC_IFBREAK:
  DBA7  FE03          		CP	3
  DBA9  C0            		RET	NZ
  DBAA                	KEYBC:
  DBAA  E5            		PUSH	HL
  DBAB  210000        		LD	HL,0
  DBAE  2290F0        		LD	(_KEYPS),HL
  DBB1  E1            		POP	HL
  DBB2  C9            		RET
                      	
  DBB3                	POP_AF_HL_SCF_RET:
  DBB3  F1            		POP	AF
  DBB4  E1            		POP	HL
  DBB5  37            		SCF
  DBB6  C9            		RET
                      	
  DBB7                	_SYS01:		;(BDOS)コンソール入力
  DBB7  CD09F0        		CALL	_SYS07
  DBBA                	MSG_A:
  DBBA  F5            		PUSH	AF
  DBBB  D5            		PUSH	DE
  DBBC  5F            		LD	E,A
  DBBD  CDC3DB        		CALL	_SYS02
  DBC0  D1            		POP	DE
  DBC1  F1            		POP	AF
  DBC2  C9            		RET
                      	
  DBC3                	_SYS02:		;(BDOS)コンソール出力
  DBC3  CDD5DB        		CALL	BREAK
  DBC6  1805          		JR	PRINTX
                      	
  DBC8                	_SYS06:		;(BDOS)コンソール直接入出力
  DBC8  7B            		LD	A,E
  DBC9  3C            		INC	A
  DBCA  CACAF0        		JP	Z,_INKEY
  DBCD                	PRINTX:
  DBCD  C3CDF0        		JP	_PRINT
                      	
  DBD0                	_SYS08:		;(BDOS)エコーなしコンソール入力
  DBD0  CD09F0        		CALL	_SYS07
  DBD3  1804          		JR	BREAK1
  DBD5                	BREAK:
  DBD5  FB            		EI
  DBD6  3A92F0        		LD	A,(_KEYD)
  DBD9                	BREAK1:
  DBD9  FE03          		CP	3		;CTRL+C
  DBDB  CCF4F0        		CALL	Z,_BREAK
  DBDE  FE13          		CP	013H		;CTRL+S
  DBE0  C0            		RET	NZ
                      	
  DBE1                	PAUSE:
  DBE1  CDAADB        		CALL	KEYBC
                      	
  DBE4                	FLGET:
  DBE4  CDDFF0        		CALL	_FFLUSH
  DBE7  C5            		PUSH	BC
  DBE8  E5            		PUSH	HL
  DBE9  ED4B8EF0      		LD	BC,(_TXADR)
  DBED  CBE8          		SET	5,B
  DBEF  ED60          		IN	H,(C)
  DBF1                	FLGET1:
  DBF1  3A93F0        		LD	A,(_KEYD+1)
  DBF4  0F            		RRCA
  DBF5  0F            		RRCA
  DBF6  E610          		AND	010H
  DBF8  F608          		OR	8
  DBFA  ED68          		IN	L,(C)
  DBFC  B5            		OR	L
  DBFD  ED79          		OUT	(C),A
  DBFF  CDCAF0        		CALL	_INKEY
  DC02  28ED          		JR	Z,FLGET1
  DC04  ED61          		OUT	(C),H
  DC06  E1            		POP	HL
  DC07  C1            		POP	BC
  DC08  C9            		RET
                      	
  DC09                	_SYS0A:		;(BDOS)文字列入力
  DC09  C5            		PUSH	BC
  DC0A  E5            		PUSH	HL
  DC0B  D5            		PUSH	DE
  DC0C  CD0BE0        		CALL	GETL
  DC0F  1120FF        		LD	DE,KBUF
  DC12  E1            		POP	HL
  DC13  E5            		PUSH	HL
  DC14  0E00          		LD	C,0
  DC16  3004          		JR	NC,SAX0
  DC18  23            		INC	HL
  DC19  23            		INC	HL
  DC1A  1808          		JR	SAX4
  DC1C                	SAX0:
  DC1C  46            		LD	B,(HL)
  DC1D  23            		INC	HL
  DC1E                	SAX1:
  DC1E  23            		INC	HL
  DC1F  1A            		LD	A,(DE)
  DC20  13            		INC	DE
  DC21  B7            		OR	A
  DC22  2004          		JR	NZ,SAX2
  DC24                	SAX4:
  DC24  360D          		LD	(HL),00DH
  DC26  1804          		JR	SAX3
  DC28                	SAX2:
  DC28  77            		LD	(HL),A
  DC29  0C            		INC	C
  DC2A  10F2          		DJNZ	SAX1
  DC2C                	SAX3:
  DC2C  D1            		POP	DE
  DC2D  79            		LD	A,C
  DC2E  13            		INC	DE
  DC2F  12            		LD	(DE),A
  DC30  1B            		DEC	DE
  DC31  E1            		POP	HL
  DC32  C1            		POP	BC
  DC33  A7            		AND	A
  DC34  C9            		RET
                      	
  DC35                	_SYS0B:		;(BDOS)コンソール状態のチェック
  DC35  CDD5DB        		CALL	BREAK
  DC38  3A92F0        		LD	A,(_KEYD)
  DC3B  B7            		OR	A
  DC3C  C8            		RET	Z
  DC3D                	CONSTX:
  DC3D  CDDFF0        		CALL	_FFLUSH
  DC40  E5            		PUSH	HL
  DC41  2A90F0        		LD	HL,(_KEYPS)
  DC44  7C            		LD	A,H
  DC45  AD            		XOR	L
  DC46  E1            		POP	HL
  DC47  C6FF          		ADD	A,0FFH
  DC49  9F            		SBC	A,A
  DC4A  C9            		RET
                      	
  DC4B                	_SYS2A:		;(BDOS)日付の獲得
  DC4B  C5            		PUSH	BC
  DC4C  3EED          		LD	A,0EDH		;Read calendar
  DC4E  CDD9DE        		CALL	COMOUT
  DC51  CD83DC        		CALL	IN49SB_BCD	;YY
  DC54  6F            		LD	L,A
  DC55  2600          		LD	H,0
                      	;	LD	DE,1900		;0076CH
                      	;	CP	90		;90以上は1900年代 1990-1999
                      	;	JR	NC,RDDATE1	;90未満は2000年代 2000-2089
                      	;	LD	E,0D0H		;2000 & 0FFH D=007H
  DC57  11D007        		LD	DE,2000		;すべて2000年代で処理 2000-2099
  DC5A                	RDDATE1:
  DC5A  19            		ADD	HL,DE
  DC5B  CDBEDE        		CALL	IN49SB		;MW
  DC5E  57            		LD	D,A
  DC5F  CD83DC        		CALL	IN49SB_BCD	;DD
  DC62  5F            		LD	E,A
  DC63  7A            		LD	A,D
  DC64  0604          		LD	B,4
  DC66                	RDDATE2:
  DC66  CB3A          		SRL	D
  DC68  10FC          		DJNZ	RDDATE2
  DC6A  C1            		POP	BC
  DC6B  E607          		AND	7
  DC6D  C9            		RET
                      	
  DC6E                	_SYS2C:		;(BDOS)時刻の獲得
  DC6E  C5            		PUSH	BC
  DC6F  3EEF          		LD	A,0EFH		;Read time
  DC71  CDD9DE        		CALL	COMOUT
  DC74  CD83DC        		CALL	IN49SB_BCD	;TT
  DC77  67            		LD	H,A
  DC78  CD83DC        		CALL	IN49SB_BCD	;MM
  DC7B  6F            		LD	L,A
  DC7C  CD83DC        		CALL	IN49SB_BCD	;SS
  DC7F  57            		LD	D,A
  DC80  C1            		POP	BC
  DC81  AF            		XOR	A
  DC82  C9            		RET
                      	
  DC83                	IN49SB_BCD:
  DC83  CDBEDE        		CALL	IN49SB
                      	;------------------------
                      	;BCDの10進数化
                      	;in
                      	;	A  : BCD
                      	;out
                      	;	A  : 10進数
                      	;------------------------
  DC86  4F            		LD	C,A
  DC87  E6F0          		AND	0F0H	;10の位
  DC89  0F            		RRCA
  DC8A  47            		LD	B,A
  DC8B  0F            		RRCA
  DC8C  0F            		RRCA
  DC8D  80            		ADD	A,B
  DC8E  47            		LD	B,A
  DC8F  79            		LD	A,C
  DC90  E60F          		AND	00FH	;1の位
  DC92  80            		ADD	A,B
  DC93  C9            		RET
                      	
  DC94                	ESC1:
  DC94  7B            		LD	A,E
  DC95  FE41          		CP	'A'
  DC97  CADCDD        		JP	Z,CTRL1E
  DC9A  FE42          		CP	'B'
  DC9C  CA44DF        		JP	Z,CTRL1F
  DC9F  FE43          		CP	'C'
  DCA1  CAE7DD        		JP	Z,CTRL1C
  DCA4  FE44          		CP	'D'
  DCA6  CAD3DD        		JP	Z,CTRL1D
  DCA9  FE45          		CP	'E'
  DCAB  2802          		JR	Z,CT0CX
  DCAD  FE6A          		CP	'j'
  DCAF                	CT0CX:
  DCAF  CA17DF        		JP	Z,CTRL0C
  DCB2  FE48          		CP	'H'
  DCB4  CA61DE        		JP	Z,CTRL0B
  DCB7  FE4A          		CP	'J'
  DCB9  CA1ADF        		JP	Z,CTRL06
  DCBC  FE4B          		CP	'K'
  DCBE  2807          		JR	Z,CT05X
  DCC0  FE4C          		CP	'L'
  DCC2  CA59DF        		JP	Z,CTRL0E
  DCC5  FE54          		CP	'T'
  DCC7                	CT05X:
  DCC7  CA20DE        		JP	Z,CTRL05
  DCCA  FE78          		CP	'x'
  DCCC  2804          		JR	Z,ESC1X
  DCCE  FE79          		CP	'y'
  DCD0  2002          		JR	NZ,ESC1Y
  DCD2                	ESC1X:
  DCD2  3601          		LD	(HL),1
  DCD4                	ESC1Y:
  DCD4  FE3D          		CP	'='
  DCD6  2804          		JR	Z,ESC1W
  DCD8  FE59          		CP	'Y'
  DCDA  2002          		JR	NZ,ESC1Z
  DCDC                	ESC1W:
  DCDC  3602          		LD	(HL),2
  DCDE                	ESC1Z:
  DCDE  FE20          		CP	020H
  DCE0  3802          		JR	C,ESC1C
  DCE2  87            		ADD	A,A
  DCE3  D0            		RET	NC
  DCE4                	ESC1C:
  DCE4  E1            		POP	HL
  DCE5                	ANK:
  DCE5  ED4B8EF0      		LD	BC,(_TXADR)
  DCE9  78            		LD	A,B
  DCEA  F638          		OR	038H
  DCEC  47            		LD	B,A
  DCED  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令	kanji
  DCEF  CB98          		RES	3,B
  DCF1  ED59          		OUT	(C),E		;Text
  DCF3                	KANJIE:
  DCF3  CDA8DD        		CALL	PRINTE7
  DCF6                	PRINTE5:
  DCF6  E1            		POP	HL
  DCF7  C1            		POP	BC
  DCF8  AF            		XOR	A
  DCF9  C9            		RET
                      	
  DCFA                	ESC:
  DCFA  21F6DC        		LD	HL,PRINTE5
  DCFD  E5            		PUSH	HL
  DCFE  2120DD        		LD	HL,ESCFLG+1
  DD01  3600          		LD	(HL),0
  DD03  3D            		DEC	A
  DD04  288E          		JR	Z,ESC1
  DD06  3D            		DEC	A
  DD07  2009          		JR	NZ,ESC2
  DD09  3603          		LD	(HL),3
  DD0B  7B            		LD	A,E
  DD0C  D620          		SUB	020H
  DD0E  3215DD        		LD	(ESCYP+1),A
  DD11  C9            		RET
  DD12                	ESC2:
  DD12  3D            		DEC	A
  DD13  C0            		RET	NZ
  DD14  2600          	ESCYP:	LD	H,0
  DD16  7B            		LD	A,E
  DD17  D620          		SUB	020H
  DD19  6F            		LD	L,A
  DD1A  C3D6F0        		JP	_LOC
                      	
  DD1D                	PRINT:
  DD1D  C5            		PUSH	BC
  DD1E  E5            		PUSH	HL
  DD1F  3E00          	ESCFLG:	LD	A,000H
  DD21  B7            		OR	A
  DD22  20D6          		JR	NZ,ESC
                      	
  DD24  3E1F          		LD	A,01FH
  DD26  BB            		CP	E
  DD27  3020          		JR	NC,CTRL
  DD29  01E2DE        	INSFLG:	LD	BC,INSERT
                      	
  DD2C  3A1800        		LD	A,(00018H)
  DD2F  3C            		INC	A
  DD30  28B3          		JR	Z,ANK
  DD32  3E00          	KANFLG:	LD	A,000H
  DD34  B7            		OR	A
  DD35  2025          		JR	NZ,KANJI2
  DD37  7B            		LD	A,E
  DD38  FE80          		CP	080H
  DD3A  38A9          		JR	C,ANK
  DD3C  FEA0          		CP	0A0H
  DD3E  3804          		JR	C,KANJI1
  DD40  FEE0          		CP	0E0H
  DD42  38A1          		JR	C,ANK
  DD44                	KANJI1:
  DD44  3233DD        		LD	(KANFLG+1),A
  DD47  18AD          		JR	PRINTE5
                      	
  DD49                	CTRL:
  DD49  CD8FDD        		CALL	KANCLR
  DD4C  7B            		LD	A,E
  DD4D  87            		ADD	A,A
  DD4E  F680          		OR	080H
  DD50  6F            		LD	L,A
  DD51  26F1          		LD	H,CTRLTB/256
  DD53  7E            		LD	A,(HL)
  DD54  2C            		INC	L
  DD55  66            		LD	H,(HL)
  DD56  6F            		LD	L,A
  DD57  CD0F00        		CALL	JP_HL
  DD5A  189A          		JR	PRINTE5
                      	
  DD5C                	KANJI2:
  DD5C  D5            		PUSH	DE
  DD5D  57            		LD	D,A
  DD5E  01812F        		LD	BC,02F81H	;SFTJIS
  DD61  DF            		RST	018H
  DD62  01C32F        		LD	BC,02FC3H	;Instead or JISVRM
  DD65  DF            		RST	018H
                      	
  DD66  ED4B8EF0      		LD	BC,(_TXADR)
  DD6A  78            		LD	A,B
  DD6B  F638          		OR	038H
  DD6D  47            		LD	B,A
  DD6E  ED51          		OUT	(C),D		;kanji
  DD70  CB98          		RES	3,B
  DD72  ED59          		OUT	(C),E		;Text
  DD74  CDA8DD        		CALL	PRINTE7
  DD77  ED4B8EF0      		LD	BC,(_TXADR)
  DD7B  78            		LD	A,B
  DD7C  F638          		OR	038H
  DD7E  47            		LD	B,A
  DD7F  CBF2          		SET	6,D
  DD81  ED51          		OUT	(C),D		;Kanji
  DD83  CB98          		RES	3,B
  DD85  ED59          		OUT	(C),E		;Text
  DD87  D1            		POP	DE
  DD88  AF            		XOR	A
  DD89  3233DD        		LD	(KANFLG+1),A
  DD8C  C3F3DC        		JP	KANJIE
                      	
  DD8F                	KANCLR:
  DD8F  3A33DD        		LD	A,(KANFLG+1)
  DD92  B7            		OR	A
  DD93  C8            		RET	Z
  DD94  ED4B8EF0      		LD	BC,(_TXADR)
  DD98  78            		LD	A,B
  DD99  F638          		OR	038H
  DD9B  47            		LD	B,A
  DD9C  AF            		XOR	A
  DD9D  3233DD        		LD	(KANFLG+1),A
  DDA0  ED79          		OUT	(C),A		;Kanji
  DDA2  CB98          		RES	3,B
  DDA4  3E20          		LD	A,020H
  DDA6  ED79          		OUT	(C),A		;Text
  DDA8                	PRINTE7:
  DDA8  CBA0          		RES	4,B
  DDAA                	PRINTE6:
  DDAA  3A96F0        		LD	A,(_COLORF)
  DDAD                	PRINTE4:
  DDAD  ED79          		OUT	(C),A		;Color
  DDAF  78            		LD	A,B
  DDB0  E607          		AND	7
  DDB2  47            		LD	B,A
  DDB3                	PRINTE2:
  DDB3  03            		INC	BC
  DDB4                	PRINTE3:
  DDB4  2ABAF0        		LD	HL,(_PAGE_MINUS)
  DDB7  A7            		AND	A
  DDB8  ED4A          		ADC	HL,BC
  DDBA                	PRINTE8:
  DDBA  2805          		JR	Z,PRINT2
  DDBC  ED438EF0      		LD	(_TXADR),BC
  DDC0                	CTRL00:
  DDC0  C9            		RET
                      	
  DDC1                	PRINT2:
  DDC1  CD5FDF        		CALL	SCR
  DDC4  2ABCF0        		LD	HL,(_WIDTH_MINUS)
  DDC7  09            		ADD	HL,BC
  DDC8                	SET_TXADR_HL:
  DDC8  228EF0        		LD	(_TXADR),HL
  DDCB  C9            		RET
                      	
  DDCC                	CTRL08:
  DDCC  3A29DD        		LD	A,(INSFLG)
  DDCF  FECD          		CP	0CDH		;CALL ????
  DDD1  2829          		JR	Z,CTRL02
  DDD3                	CTRL1D:
  DDD3  2A8EF0        		LD	HL,(_TXADR)
  DDD6  7C            		LD	A,H
  DDD7  B5            		OR	L
  DDD8  C8            		RET	Z
  DDD9  2B            		DEC	HL
  DDDA  18EC          		JR	SET_TXADR_HL
                      	
  DDDC                	CTRL1E:
  DDDC  ED4B8EF0      		LD	BC,(_TXADR)
  DDE0  2ABCF0        		LD	HL,(_WIDTH_MINUS)
  DDE3  09            		ADD	HL,BC
  DDE4  D0            		RET	NC
  DDE5  18E1          		JR	SET_TXADR_HL
                      	
  DDE7                	CTRL1C:
  DDE7  ED4B8EF0      		LD	BC,(_TXADR)
  DDEB  18C6          		JR	PRINTE2
                      	
  DDED                	CTRL09:
  DDED  ED4B8EF0      		LD	BC,(_TXADR)
  DDF1  79            		LD	A,C
  DDF2  E6F8          		AND	0F8H
  DDF4  C608          		ADD	A,8
  DDF6  4F            		LD	C,A
  DDF7  88            		ADC	A,B
  DDF8  91            		SUB	C
  DDF9  47            		LD	B,A
  DDFA  18B8          		JR	PRINTE3
                      	
  DDFC                	CTRL02:
  DDFC  CDD3DD        		CALL	CTRL1D
  DDFF  C8            		RET	Z
  DE00  D5            		PUSH	DE
  DE01  CDD3F0        		CALL	_POS
  DE04  3AB1F0        		LD	A,(_WIDTH)
  DE07  95            		SUB	L
  DE08  4F            		LD	C,A
  DE09  0D            		DEC	C
  DE0A  0638          		LD	B,038H
  DE0C  2A8EF0        		LD	HL,(_TXADR)
  DE0F  09            		ADD	HL,BC
  DE10  44            		LD	B,H
  DE11  4D            		LD	C,L
  DE12  110020        		LD	DE,02000H	;D:Text E:kanji
  DE15  2A96F0        		LD	HL,(_COLORF)	;L:Color
  DE18                	C8X1:
  DE18  CDFEDE        		CALL	C12S
  DE1B  0B            		DEC	BC
  DE1C  20FA          		JR	NZ,C8X1
  DE1E  D1            		POP	DE
  DE1F  C9            		RET
                      	
  DE20                	CTRL05:
  DE20  CDD3F0        		CALL	_POS
  DE23  3AB1F0        		LD	A,(_WIDTH)
  DE26  95            		SUB	L
  DE27  6F            		LD	L,A
  DE28                	C08X1:
  DE28  ED4B8EF0      		LD	BC,(_TXADR)
  DE2C                	LINECL:
  DE2C  2620          		LD	H,020H
  DE2E  3A96F0        		LD	A,(_COLORF)
  DE31  CBE8          		SET	5,B
  DE33                	LINECL1:
  DE33  CBD8          		SET	3,B
  DE35  CBE0          		SET	4,B
  DE37  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令	kanji
  DE39  CB98          		RES	3,B
  DE3B  ED61          		OUT	(C),H		;Text
  DE3D  CBA0          		RES	4,B
  DE3F  ED79          		OUT	(C),A		;Color
  DE41  03            		INC	BC
  DE42  2D            		DEC	L
  DE43  20EE          		JR	NZ,LINECL1
  DE45  C9            		RET
                      	
  DE46                	CTRL0D:
  DE46  CDD3F0        		CALL	_POS
  DE49  2E00          		LD	L,0
  DE4B                	LOC:
  DE4B  C5            		PUSH	BC
  DE4C  E5            		PUSH	HL
  DE4D  CD8FDD        		CALL	KANCLR
  DE50  CD6EDE        		CALL	LOC1
  DE53  228EF0        		LD	(_TXADR),HL
  DE56  E1            		POP	HL
  DE57  C1            		POP	BC
  DE58  C9            		RET
                      	
  DE59                	CTRL12:
  DE59  2129DD        		LD	HL,INSFLG
  DE5C  7E            		LD	A,(HL)
  DE5D  EECC          		XOR	0CCH		;CD:CALL ???? 1:LD BC,????
  DE5F  77            		LD	(HL),A
  DE60  C9            		RET
                      	
  DE61                	CTRL0B:
  DE61  210000        		LD	HL,0
  DE64  228EF0        		LD	(_TXADR),HL
  DE67  C9            		RET
                      	
  DE68                	CTRL1B:
  DE68  3E01          		LD	A,1
  DE6A  3220DD        		LD	(ESCFLG+1),A
  DE6D  C9            		RET
                      	
  DE6E                	LOC1:
  DE6E  D5            		PUSH	DE
  DE6F  4D            		LD	C,L
  DE70  0608          		LD	B,8
  DE72  5C            		LD	E,H
  DE73  1600          		LD	D,0
  DE75  2AB0F0        		LD	HL,(CRTCD)
  DE78  6A            		LD	L,D
  DE79                	LOC2:
  DE79  29            		ADD	HL,HL
  DE7A  3001          		JR	NC,LOC3
  DE7C  19            		ADD	HL,DE
  DE7D                	LOC3:
  DE7D  10FA          		DJNZ	LOC2
  DE7F  09            		ADD	HL,BC
  DE80  D1            		POP	DE
  DE81  C9            		RET
                      	
  DE82                	CONOUT1:
  DE82  CD94DE        		CALL	CURSOR
  DE85  59            		LD	E,C
  DE86  CDCDF0        		CALL	_PRINT
  DE89  7B            		LD	A,E
  DE8A  FE0A          		CP	00AH
  DE8C  2006          		JR	NZ,CURSOR
  DE8E  CD46DE        		CALL	CTRL0D
  DE91  CD20DE        		CALL	CTRL05
  DE94                	CURSOR:
  DE94  C5            		PUSH	BC
  DE95  ED4B8EF0      		LD	BC,(_TXADR)
  DE99  CBE8          		SET	5,B
  DE9B  ED78          		IN	A,(C)
  DE9D  EE18          		XOR	018H
  DE9F  ED79          		OUT	(C),A
  DEA1  C1            		POP	BC
  DEA2  C9            		RET
                      	
  DEA3                	CTRL07:
  DEA3  2161F0        		LD	HL,BEEPD
  DEA6                	BEEP1:
  DEA6  7E            		LD	A,(HL)
  DEA7  23            		INC	HL
  DEA8  FEFF          		CP	0FFH
  DEAA  C8            		RET	Z
  DEAB  061C          		LD	B,01CH
  DEAD  ED79          		OUT	(C),A
  DEAF  EDA3          		OUTI
  DEB1  18F3          		JR	BEEP1
                      	
  DEB3                	OT49SB:
  DEB3  C5            		PUSH	BC
  DEB4  CDCFDE        		CALL	CANW
  DEB7  010019        		LD	BC,01900H
  DEBA  ED79          		OUT	(C),A
  DEBC  C1            		POP	BC
  DEBD  C9            		RET
                      	
  DEBE                	IN49SB:
  DEBE  C5            		PUSH	BC
  DEBF  01011A        		LD	BC,01A01H
  DEC2                	CANR:
  DEC2  ED78          		IN	A,(C)
  DEC4  E620          		AND	020H
  DEC6  20FA          		JR	NZ,CANR
  DEC8  010019        		LD	BC,01900H
  DECB  ED78          		IN	A,(C)
  DECD  C1            		POP	BC
  DECE  C9            		RET
                      	
  DECF                	CANW:
  DECF  01011A        		LD	BC,01A01H
  DED2  ED48          		IN	C,(C)
  DED4  CB71          		BIT	6,C
  DED6  20F7          		JR	NZ,CANW
  DED8  C9            		RET
                      	
  DED9                	COMOUT:
  DED9  FB            		EI
  DEDA  CDB3DE        		CALL	OT49SB
  DEDD  CDCFDE        		CALL	CANW
  DEE0  F3            		DI
  DEE1  C9            		RET
                      	
  DEE2                	INSERT:
  DEE2  D5            		PUSH	DE
  DEE3  CDD3F0        		CALL	_POS
  DEE6  3AB1F0        		LD	A,(_WIDTH)
  DEE9  95            		SUB	L
  DEEA  ED4B8EF0      		LD	BC,(_TXADR)
  DEEE  110020        		LD	DE,02000H	;D:Text E:Kanji
  DEF1  2A96F0        		LD	HL,(_COLORF)	;L:Color
  DEF4  CBE8          		SET	5,B
  DEF6                	C12X1:
  DEF6  CDFEDE        		CALL	C12S
  DEF9  03            		INC	BC
  DEFA  20FA          		JR	NZ,C12X1
  DEFC  D1            		POP	DE
  DEFD  C9            		RET
                      	
  DEFE                	C12S:
  DEFE  CBE0          		SET	4,B
  DF00  CBD8          		SET	3,B
  DF02  ED60          		IN	H,(C)
  DF04  ED59          	X1PAT:	OUT	(C),E
  DF06  5C            		LD	E,H
  DF07  CB98          		RES	3,B
  DF09  ED60          		IN	H,(C)
  DF0B  ED51          		OUT	(C),D
  DF0D  54            		LD	D,H
  DF0E  CBA0          		RES	4,B
  DF10  ED60          		IN	H,(C)
  DF12  ED69          		OUT	(C),L
  DF14  6C            		LD	L,H
  DF15  3D            		DEC	A
  DF16  C9            		RET
                      	
  DF17                	CTRL0C:
  DF17  CD61DE        		CALL	CTRL0B
  DF1A                	CTRL06:
  DF1A  ED4B8EF0      		LD	BC,(_TXADR)
  DF1E                	C1AX1:
  DF1E  78            		LD	A,B
  DF1F  F638          		OR	038H
  DF21  47            		LD	B,A
  DF22  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令	kanji
  DF24  CB98          		RES	3,B
  DF26  3E20          		LD	A,020H
  DF28  ED79          		OUT	(C),A		;Text
  DF2A  CBA0          		RES	4,B
  DF2C  3A96F0        		LD	A,(_COLORF)
  DF2F  ED79          		OUT	(C),A		;Color
  DF31  03            		INC	BC
  DF32  CBA8          		RES	5,B
  DF34  2ABAF0        		LD	HL,(_PAGE_MINUS)
  DF37  09            		ADD	HL,BC
  DF38  30E4          		JR	NC,C1AX1
  DF3A  C9            		RET
                      	
  DF3B                	CTRL04:
  DF3B  CDD3F0        		CALL	_POS
  DF3E  7D            		LD	A,L
  DF3F  B7            		OR	A
  DF40  C8            		RET	Z
  DF41                	CTRL03:
  DF41  CD46DE        		CALL	CTRL0D
  DF44                	CTRL0A:
  DF44                	CTRL1F:
  DF44  ED4B8EF0      		LD	BC,(_TXADR)
  DF48  2AB1F0        		LD	HL,(_WIDTH)
  DF4B  2600          		LD	H,0
  DF4D  09            		ADD	HL,BC
  DF4E  44            		LD	B,H
  DF4F  4D            		LD	C,L
  DF50  2ABAF0        		LD	HL,(_PAGE_MINUS)
  DF53  09            		ADD	HL,BC
  DF54  3F            		CCF
  DF55  9F            		SBC	A,A
  DF56  C3BADD        		JP	PRINTE8
                      	
  DF59                	CTRL0E:
  DF59  CDD3F0        		CALL	_POS
  DF5C  7C            		LD	A,H
  DF5D  1804          		JR	SCR1
  DF5F                	SCR:
  DF5F  3A97F0        		LD	A,(_LINE)
  DF62  3D            		DEC	A
  DF63                	SCR1:
  DF63  C5            		PUSH	BC
  DF64  D5            		PUSH	DE
  DF65  F5            		PUSH	AF
  DF66  3E07          		LD	A,7
  DF68  2199DF        		LD	HL,SCRDMAD
  DF6B  CD8FDF        		CALL	SETDMA
  DF6E  F1            		POP	AF
  DF6F  210038        		LD	HL,03800H
                      	
  DF72                	SCRUP1:
  DF72  B7            		OR	A
  DF73  284D          		JR	Z,SCRCL
  DF75  F5            		PUSH	AF
  DF76  CDA0DF        		CALL	UPSUB		;kanji
  DF79  3ABCF0        		LD	A,(_WIDTH_MINUS)
  DF7C  5F            		LD	E,A
  DF7D  16F7          		LD	D,0F7H
  DF7F  19            		ADD	HL,DE
  DF80  D5            		PUSH	DE
  DF81  CDA0DF        		CALL	UPSUB		;Text
  DF84  D1            		POP	DE
  DF85  19            		ADD	HL,DE
  DF86  CDA0DF        		CALL	UPSUB		;Color
  DF89  CBE4          		SET	4,H
  DF8B  F1            		POP	AF
  DF8C  3D            		DEC	A
  DF8D  18E3          		JR	SCRUP1
                      	
  DF8F                	SETDMA:
  DF8F  01871F        		LD	BC,01F87H
  DF92                	SDMA:
  DF92  04            		INC	B
  DF93  EDA3          		OUTI
  DF95  3D            		DEC	A
  DF96  20FA          		JR	NZ,SDMA
  DF98  C9            		RET
                      	
  DF99                	SCRDMAD:
  DF99  C3            		DB	0C3H		;WR6 リセット
  DF9A  9A            		DB	09AH		;WR5 ストップ WAIT READY:HIGH
  DF9B  65            		DB	065H		;WR0 ブロック長(LH)
  DF9C  4F00          		DW	79
  DF9E  1C            		DB	01CH		;WR1 ポートAインクリメント I/O
  DF9F  18            		DB	018H		;WR0 ポートAアドレス(LH)
                      	
  DFA0                	UPSUB:
  DFA0  3AB1F0        		LD	A,(_WIDTH)
  DFA3  5F            		LD	E,A
  DFA4  1600          		LD	D,0
  DFA6  3ECD          		LD	A,0CDH		;WR4 バースト ポートB開始アドレス(LH)
  DFA8  ED79          		OUT	(C),A
  DFAA  ED69          		OUT	(C),L		;SOURCE
  DFAC  ED61          		OUT	(C),H
  DFAE  19            		ADD	HL,DE
  DFAF  3E1D          		LD	A,01DH		;WR0 ポートA開始アドレス(LH) ポートA→ポートB 転送
  DFB1  ED79          		OUT	(C),A
  DFB3  ED69          		OUT	(C),L		;DEST
  DFB5  ED61          		OUT	(C),H
  DFB7                	GO_DMA:
  DFB7  3ECF          		LD	A,0CFH
  DFB9  ED79          		OUT	(C),A		;WR6 ロード
  DFBB  3EB3          		LD	A,0B3H
  DFBD  ED79          		OUT	(C),A		;WR6 強制RDY
  DFBF  ED49          		OUT	(C),C		;WR6 イネーブル
  DFC1  C9            		RET
                      	
  DFC2                	SCRCL:
  DFC2  44            		LD	B,H
  DFC3  4D            		LD	C,L
  DFC4  2AB1F0        		LD	HL,(_WIDTH)
  DFC7  CD2CDE        		CALL	LINECL
  DFCA  D1            		POP	DE
  DFCB  C1            		POP	BC
  DFCC  C9            		RET
                      	
  DFCD                	SCRN:
  DFCD  D5            		PUSH	DE
  DFCE  ED58          		IN	E,(C)		;Text
  DFD0  3A1800        		LD	A,(00018H)
  DFD3  3C            		INC	A
  DFD4  281E          		JR	Z,SCRN2
  DFD6  CBD8          		SET	3,B
  DFD8  ED50          		IN	D,(C)		;Kanji
  DFDA  2816          		JR	Z,SCRN1
  DFDC  AF            		XOR	A
  DFDD  C5            		PUSH	BC
  DFDE  013730        		LD	BC,03037H	;VRMJIS
  DFE1  DF            		RST	018H
  DFE2  01522F        		LD	BC,02F52H	;JISSFT
  DFE5  DF            		RST	018H
  DFE6  C1            		POP	BC
  DFE7  ED78          		IN	A,(C)
  DFE9  CB98          		RES	3,B
  DFEB  E640          		AND	040H
  DFED  2005          		JR	NZ,SCRN2
  DFEF  7A            		LD	A,D
  DFF0  D1            		POP	DE
  DFF1  C9            		RET
  DFF2                	SCRN1:
  DFF2  CB98          		RES	3,B
  DFF4                	SCRN2:
  DFF4  7B            		LD	A,E
  DFF5  D1            		POP	DE
  DFF6  C9            		RET
  DFF7                	SCRNE:
  DFF7                	POS:
  DFF7  2A8EF0        		LD	HL,(_TXADR)
  DFFA  C5            		PUSH	BC
  DFFB  ED4BBCF0      		LD	BC,(_WIDTH_MINUS)
  DFFF  AF            		XOR	A
  E000                	POS1:
  E000  09            		ADD	HL,BC
  E001  3C            		INC	A
  E002  38FC          		JR	C,POS1
  E004  ED42          		SBC	HL,BC
  E006  3D            		DEC	A
  E007  67            		LD	H,A
  E008  C1            		POP	BC
  E009  A7            		AND	A
  E00A  C9            		RET
                      	
  E00B                	GETL:
  E00B  CDD3F0        		CALL	_POS
  E00E  E5            		PUSH	HL
  E00F  3ECD          		LD	A,0CDH		;CALL ????
  E011  3229DD        		LD	(INSFLG),A
  E014                	GETL1:
  E014  CDD0DB        		CALL	_SYS08
  E017  FE09          		CP	9
  E019  2008          		JR	NZ,GETL1V
  E01B  2120FF        		LD	HL,KBUF
  E01E  CD70D8        		CALL	MSX
  E021  18F1          		JR	GETL1
  E023                	GETL1V:
  E023  5F            		LD	E,A
  E024  CDCDF0        		CALL	_PRINT
                      	
  E027  7B            		LD	A,E
  E028  FE0D          		CP	00DH
  E02A  20E8          		JR	NZ,GETL1
  E02C  3E01          		LD	A,1		;LD BC,????
  E02E  3229DD        		LD	(INSFLG),A
  E031  1120FF        		LD	DE,KBUF
  E034  3AB1F0        		LD	A,(_WIDTH)
  E037  47            		LD	B,A
  E038  CDD3D5        		CALL	ZERO_MEMORY_DE
                      	
  E03B  D1            		POP	DE
  E03C  CDD3F0        		CALL	_POS
  E03F  6B            		LD	L,E
  E040  3AB1F0        		LD	A,(_WIDTH)
  E043  95            		SUB	L
  E044  57            		LD	D,A
  E045  CD6EDE        		CALL	LOC1
  E048  4D            		LD	C,L
  E049  7C            		LD	A,H
  E04A  F630          		OR	030H
  E04C  47            		LD	B,A
  E04D  5A            		LD	E,D
  E04E  2120FF        		LD	HL,KBUF
  E051                	GETL2:
  E051  CDD0F0        		CALL	_SCRN
  E054  03            		INC	BC
  E055  77            		LD	(HL),A
  E056  23            		INC	HL
  E057  1D            		DEC	E
  E058  20F7          		JR	NZ,GETL2
  E05A                	GETL3:
  E05A  2B            		DEC	HL
  E05B  7E            		LD	A,(HL)
  E05C  FE21          		CP	021H
  E05E  D0            		RET	NC
  E05F  3600          		LD	(HL),0
  E061  15            		DEC	D
  E062  20F6          		JR	NZ,GETL3
  E064  C9            		RET
                      	
  E065                	INKEY:
  E065  FB            		EI
  E066  E5            		PUSH	HL
  E067  2A90F0        		LD	HL,(_KEYPS)
  E06A  7C            		LD	A,H
  E06B  AD            		XOR	L
  E06C  280B          		JR	Z,INKEY1
  E06E  7C            		LD	A,H
  E06F  3C            		INC	A
  E070  E61F          		AND	01FH
  E072  3291F0        		LD	(_KEYPS+1),A
  E075  6F            		LD	L,A
  E076  26FF          		LD	H,KEYBF/256
  E078  7E            		LD	A,(HL)
  E079                	INKEY1:
  E079  E1            		POP	HL
  E07A  B7            		OR	A
  E07B  C9            		RET
                      	
  0F47                	AT_RS	EQU	SCR1-AT_SCR1
                      	
                      	;LDFILE.ASM
                      	
                      	;	LSX-Dodgers FILE
                      	
  E07C                	FILEC:
  E07C  CD87E0        		CALL	FILE
  E07F                	FILEC2:
  E07F  3A15F0        		LD	A,(FDRV+1)
  E082  FE20          		CP	020H
  E084  C8            		RET	Z
  E085  1839          		JR	SETDIR1
                      	
  E087                	FILE:
  E087  AF            		XOR	A
  E088  3214F0        		LD	(FDRV),A
  E08B  67            		LD	H,A
  E08C  6F            		LD	L,A
  E08D  2222F0        		LD	(FDRV+14),HL
  E090  CD5EE1        		CALL	SPCUT
  E093  CD43E1        		CALL	CCHK3
  E096  2812          		JR	Z,DEVI1
  E098  13            		INC	DE
  E099  1A            		LD	A,(DE)
  E09A  1B            		DEC	DE
  E09B  FE3A          		CP	':'
  E09D  200B          		JR	NZ,DEVI1
  E09F  1A            		LD	A,(DE)		;DRIVE
  E0A0  CD93E3        		CALL	CAP
  E0A3  D640          		SUB	'@'
  E0A5  13            		INC	DE
  E0A6  13            		INC	DE
  E0A7  3214F0        		LD	(FDRV),A
  E0AA                	DEVI1:
  E0AA  1A            		LD	A,(DE)
  E0AB  D65C          		SUB	05CH		;\
  E0AD  2009          		JR	NZ,NOROOT
  E0AF  6F            		LD	L,A		;A=0でH=0のはずなのでHL=0
  E0B0  222EF0        		LD	(FDRV+26),HL
  E0B3  2C            		INC	L
  E0B4  2222F0        		LD	(FDRV+14),HL
  E0B7  13            		INC	DE
  E0B8                	NOROOT:
                      	
  E0B8                	SETDIR:
  E0B8  CDE4E0        		CALL	FILED
  E0BB  1A            		LD	A,(DE)
  E0BC  FE5C          		CP	05CH		;\
  E0BE  C0            		RET	NZ
  E0BF  13            		INC	DE
  E0C0                	SETDIR1:
  E0C0  3E10          		LD	A,010H		;Directory
  E0C2  3221F0        		LD	(FDRV+13),A
  E0C5  D5            		PUSH	DE
  E0C6  1114F0        		LD	DE,FDRV
  E0C9  2A1EF1        		LD	HL,(STABLE+2*00FH)
  E0CC  CD0F00        		CALL	JP_HL
  E0CF  D1            		POP	DE
  E0D0  B7            		OR	A
  E0D1  C0            		RET	NZ
                      	
  E0D2  3A21F0        		LD	A,(FDRV+13)
  E0D5  CB67          		BIT	4,A
  E0D7  C8            		RET	Z
                      	
  E0D8  CD2BE1        		CALL	FILEI
  E0DB  2A2EF0        		LD	HL,(FDRV+26)
  E0DE  23            		INC	HL
  E0DF  2222F0        		LD	(FDRV+14),HL
  E0E2  18D4          		JR	SETDIR
                      	
  E0E4                	FILED:
  E0E4  CD2BE1        		CALL	FILEI
  E0E7  2115F0        		LD	HL,FNAME
                      	
  E0EA  0608          		LD	B,8
  E0EC                	FILE2:
  E0EC  CD38E1        		CALL	CCHKF
  E0EF  C8            		RET	Z
  E0F0  FE2A          		CP	'*'
  E0F2  282E          		JR	Z,FILE9
  E0F4  FE2E          		CP	'.'
  E0F6  280C          		JR	Z,FILE4
  E0F8  77            		LD	(HL),A
  E0F9  23            		INC	HL
  E0FA  10F0          		DJNZ	FILE2
                      	
  E0FC                	FILE3:
  E0FC  CD38E1        		CALL	CCHKF
  E0FF  C8            		RET	Z
  E100  FE2E          		CP	'.'
  E102  20F8          		JR	NZ,FILE3
                      	
  E104                	FILE4:
  E104  211DF0        		LD	HL,FNAME+8
  E107  0603          		LD	B,3
                      	
  E109                	FILE4L:
  E109  CD38E1        		CALL	CCHKF
  E10C  C8            		RET	Z
  E10D  FE2E          		CP	'.'
  E10F  2008          		JR	NZ,FILE12
  E111  3215F0        		LD	(FNAME),A	;Parent directory(..)
  E114  3216F0        		LD	(FNAME+1),A
  E117  3E20          		LD	A,020H
  E119                	FILE12:
  E119  FE2A          		CP	'*'
  E11B  280A          		JR	Z,FILE10
  E11D  77            		LD	(HL),A
  E11E  23            		INC	HL
  E11F  10E8          		DJNZ	FILE4L
  E121  C9            		RET
                      	
  E122                	FILE9:				;名前の*処理、名前の残りを?で埋める
  E122  CD27E1        		CALL	FILE10
  E125  18D5          		JR	FILE3
                      	
  E127                	FILE10:
  E127  3E3F          		LD	A,'?'
  E129  1808          		JR	FILL_MEMORY
  E12B                	FILEI:				;名前＋拡張子をスペースで初期化
  E12B  3E20          		LD	A,020H
  E12D  01000B        		LD	BC,11*256	;C=0にしておく
  E130  2115F0        		LD	HL,FNAME
  E133                	FILL_MEMORY:			;HLからBバイトAで埋める
  E133  77            		LD	(HL),A
  E134  23            		INC	HL
  E135  10FC          		DJNZ	FILL_MEMORY
  E137  C9            		RET
                      	
  E138                	CCHKF:
  E138  1A            		LD	A,(DE)
  E139  CD40E1        		CALL	CCHK2
  E13C  C8            		RET	Z
  E13D  C3ABE4        		JP	FKAN
                      	
  E140                	CCHK2:
  E140  0C            		INC	C
  E141  0D            		DEC	C
  E142  C0            		RET	NZ
  E143                	CCHK3:				;ZF=1 で使えない文字
  E143  FE2B          		CP	'+'
  E145  C8            		RET	Z
  E146  FE2C          		CP	','
  E148  C8            		RET	Z
  E149  FE2F          		CP	'/'
  E14B  C8            		RET	Z
  E14C  FE3A          		CP	':'
  E14E  C8            		RET	Z
  E14F  FE3B          		CP	';'
  E151  C8            		RET	Z
  E152  FE3D          		CP	'='
  E154  C8            		RET	Z
  E155  FE5C          		CP	05CH	;\
  E157  C8            		RET	Z
  E158  FE20          		CP	020H
  E15A  D0            		RET	NC
  E15B  BF            		CP	A		;Z=1
  E15C  C9            		RET
                      	
  E15D                	SS1:
  E15D  13            		INC	DE
  E15E                	SPCUT:				;スペースをカット
  E15E  1A            		LD	A,(DE)
  E15F  FE20          		CP	020H
  E161  28FA          		JR	Z,SS1
  E163  C9            		RET
                      	
  E164                	SETDRVF:
  E164  1114F0        		LD	DE,FDRV
  E167                	SETDRV0:
  E167  CD70E1        		CALL	SETDRV
  E16A  FDE1          		POP	IY
  E16C  C1            		POP	BC
  E16D  D1            		POP	DE
  E16E  E1            		POP	HL
  E16F  C9            		RET
                      	
  E170                	SETDRV:
  E170  E3            		EX	(SP),HL		;HL=RETRN ADDRESS
  E171  D5            		PUSH	DE		;PUSH HL/DE/BC/IY
  E172  C5            		PUSH	BC
  E173  1A            		LD	A,(DE)
  E174  D5            		PUSH	DE
  E175  FDE3          		EX	(SP),IY
                      	
  E177  CD83E1        		CALL	GETDRV
  E17A  3C            		INC	A
  E17B  FD7700        		LD	(IY+0),A	;(FCB)ドライブ番号
  E17E  3D            		DEC	A
  E17F  CDD9F0        		CALL	_CHGDRV
                      	
  E182  E9            		JP	(HL)
                      	
  E183                	GETDRV:
  E183  E67F          		AND	07FH
  E185  D601          		SUB	001H
  E187  3003          		JR	NC,GETDRV1
  E189  3A87F0        		LD	A,(_DVSW)	;Current Drive
  E18C                	GETDRV1:
  E18C  3288F0        		LD	(_DRV),A
  E18F  C9            		RET
                      	
  E190                	SOPENX:
  E190  1139F0        		LD	DE,SFILE
  E193  1A            		LD	A,(DE)
  E194  FDBE00        		CP	(IY+0)		;(FCB)ドライブ番号
  E197  2024          		JR	NZ,SOPEN
  E199  13            		INC	DE
  E19A  FDE5          		PUSH	IY
  E19C  E1            		POP	HL
  E19D  23            		INC	HL
  E19E  CD2BE3        		CALL	CPFILE
  E1A1  201A          		JR	NZ,SOPEN
                      	
  E1A3  2AF4F1        		LD	HL,(SCDIR)
  E1A6  FD750E        		LD	(IY+14),L	;(FCB)アクセスするディレクトリのクラスタ番号+1
  E1A9  FD740F        		LD	(IY+15),H
                      	
  E1AC  2AF8F1        		LD	HL,(SFNDF)	;Direcroty location and Flags
  E1AF  229FF0        		LD	(_FILEN),HL
                      	
  E1B2  ED5BF6F1      		LD	DE,(SFBPS)
  E1B6  2139F0        		LD	HL,SFILE
  E1B9  36FF          		LD	(HL),0FFH
  E1BB  23            		INC	HL
  E1BC  C9            		RET
  E1BD                	SOPEN:
  E1BD  21D3E2        		LD	HL,FILESE
  E1C0                	SOPENC:
  E1C0  22F9E1        		LD	(OPENPAT+1),HL
                      	
  E1C3  CDE2F0        		CALL	_RDFATX		;Detect Media
  E1C6  3856          		JR	C,RDDERR
                      	
  E1C8  AF            		XOR	A
  E1C9  329FF0        		LD	(_FILEN),A
  E1CC  CDD8E3        		CALL	LDDIRX1		;A=0で呼び出す
  E1CF  2818          		JR	Z,SDIRX1
                      	
  E1D1  CDC4E2        		CALL	READ_DIR	;Sub Directory
  E1D4  3808          		JR	C,SDIRX0
  E1D6  2A7EF1        		LD	HL,(_DTBUF)
  E1D9  7E            		LD	A,(HL)
  E1DA  FE2E          		CP	'.'
  E1DC  280F          		JR	Z,SOPEN1
  E1DE                	SDIRX0:
  E1DE  AF            		XOR	A
  E1DF  32A0F0        		LD	(_DIRF),A
  E1E2  FD360E01      		LD	(IY+14),1	;(FCB)レコードサイズ
  E1E6  FD770F        		LD	(IY+15),A
  E1E9                	SDIRX1:
  E1E9  ED5BFCF1      		LD	DE,(_DIRPS)	;Root Directory
  E1ED                	SOPEN1:
  E1ED  0E20          	SDECPAT:LD	C,32		;自己書き換え 1セクタ辺りのディレクトリエントリ数  1024=32 / 512=16 / 256=8
  E1EF                	SOPEN1X:
  E1EF  CDC4E2        		CALL	READ_DIR	;FILE SEARCH
  E1F2  382A          		JR	C,RDDERR
  E1F4  2A7EF1        		LD	HL,(_DTBUF)
  E1F7                	SOPEN2:
  E1F7  D5            		PUSH	DE
  E1F8  CDD3E2        	OPENPAT:CALL	FILESE		;(self-modifying code)
  E1FB  D1            		POP	DE
  E1FC  386E          		JR	C,SOPENE
  E1FE  281B          		JR	Z,SCF_FF_RET
  E200                	SOPEN3:
  E200  3AA0F0        		LD	A,(_DIRF)	;ディレクトリか判別
  E203  B7            		OR	A
  E204  200C          		JR	NZ,SOPEN5
  E206  13            		INC	DE		;ルートディレクトリ
  E207  E5            		PUSH	HL
  E208  210C00        	MD_PAT:	LD	HL,12		;(self-modifying code)MAXDIR
  E20B  ED52          		SBC	HL,DE		;CF=0 なので SUB HL,DE
  E20D  E1            		POP	HL
  E20E  20DD          		JR	NZ,SOPEN1
  E210  1807          		JR	SOPEN6
  E212                	SOPEN5:
  E212  CDEDEA        		CALL	GNCLX		;END DIR
  E215  D8            		RET	C
  E216  CD8BE3        		CALL	ENDCL
  E219                	SOPEN6:
  E219  38D2          		JR	C,SOPEN1
  E21B                	SCF_FF_RET:
  E21B  37            		SCF			;CF=1
  E21C  9F            		SBC	A,A		;A=0FFH
  E21D  C9            		RET
                      	
  E21E                	RDDERR:
  E21E  BF            		CP	A		;READ ERR CF=1 ZF=1
  E21F  37            		SCF
  E220  C9            		RET
                      	
  E221                	NOPEN:
  E221  21D3E2        		LD	HL,FILESE
  E224  22F9E1        		LD	(OPENPAT+1),HL
  E227  FD2A98F0      		LD	IY,(_FCB)
  E22B  CDBEE4        		CALL	CHKWILDX
  E22E  30EB          		JR	NC,SCF_FF_RET
  E230  FD7E00        		LD	A,(IY+0)	;(FCB)ドライブ番号
  E233  3D            		DEC	A
  E234  3288F0        		LD	(_DRV),A
  E237  CDD9F0        		CALL	_CHGDRV
  E23A  D8            		RET	C
  E23B  2AF8F1        		LD	HL,(SFNDF)	;Direcroty location and Flags
  E23E  229FF0        		LD	(_FILEN),HL
                      	
  E241  CDD3E3        		CALL	LDDIRX
  E244  ED5B9AF0      		LD	DE,(_FBPS)
  E248  CDC4E2        		CALL	READ_DIR
  E24B  38D1          		JR	C,RDDERR
  E24D  3A9EF0        		LD	A,(_FBCNT)
  E250  3D            		DEC	A
  E251  28AD          		JR	Z,SOPEN3
  E253                	NOPEN2:
  E253  2A9CF0        		LD	HL,(_FBAD)
  E256  012000        		LD	BC,020H
  E259  09            		ADD	HL,BC
  E25A  4F            		LD	C,A
  E25B  189A          		JR	SOPEN2
                      	
  E25D                	SOPENE2:
  E25D  229CF0        		LD	(_FBAD),HL
  E260  79            		LD	A,C
  E261  329EF0        		LD	(_FBCNT),A
  E264  ED539AF0      		LD	(_FBPS),DE
  E268  FD2298F0      		LD	(_FCB),IY
  E26C                	SOPENE:
  E26C  AF            		XOR	A
  E26D  C9            		RET
                      	
  E26E                	COPEN:
  E26E  FD360D20      		LD	(IY+13),020H	;(FCB)属性(アトリビュート)
                      	
  E272  21F0E2        		LD	HL,NEXTSE
  E275  CDC0E1        		CALL	SOPENC
  E278  D0            		RET	NC
  E279  C8            		RET	Z
  E27A  3AA0F0        		LD	A,(_DIRF)	;ディレクトリか判別
  E27D  B7            		OR	A
  E27E  37            		SCF
  E27F  C8            		RET	Z		;ルートディレクトリ
  E280  0601          		LD	B,1
  E282  CD1DE5        		CALL	WRDF
  E285  D8            		RET	C
  E286  ED5BFEF1      		LD	DE,(_CLPS)
  E28A  D5            		PUSH	DE
  E28B  CD54E3        		CALL	DCPAT
  E28E  CD78E9        		CALL	DRDNX
  E291  2A7EF1        		LD	HL,(_DTBUF)	;ディレクトリエントリを0クリア
  E294  3A82E8        		LD	A,(SECSZ+2)	;1024=4 / 512=2 / 256=1
  E297  47            		LD	B,A
  E298  AF            		XOR	A
  E299  4F            		LD	C,A
  E29A                	COPENCL:
  E29A  77            		LD	(HL),A
  E29B  EDA1          		CPI			;HL=HL+1 BC=BC-1 BCが0の場合にP/V=0
  E29D  EA9AE2        		JP	PE,COPENCL
                      	
  E2A0  3A72E3        		LD	A,(SPCPAT+1)	;1クラスタの論理セクタ数
  E2A3  3D            		DEC	A
  E2A4  2819          		JR	Z,COPENE
  E2A6  3E01          		LD	A,1		;1セクタ辺りのセクタ数が2以上の場合
  E2A8  32E5EA        		LD	(_SECPS+1),A
  E2AB  D1            		POP	DE		;DE=(_CLPS)
  E2AC  D5            		PUSH	DE
  E2AD                	COPEN1:
  E2AD  D5            		PUSH	DE		;データバッファに入らないセクタもゼロクリア
  E2AE  C5            		PUSH	BC
  E2AF  2A7EF1        		LD	HL,(_DTBUF)
  E2B2  CD6EE3        		CALL	CLUSTX
  E2B5  CD7DEC        		CALL	DWT24
  E2B8  C1            		POP	BC
  E2B9  D1            		POP	DE
  E2BA  CDE4EA        		CALL	NEXTX
  E2BD  20EE          		JR	NZ,COPEN1
  E2BF                	COPENE:
  E2BF  2A7EF1        		LD	HL,(_DTBUF)
  E2C2  D1            		POP	DE
  E2C3  C9            		RET
                      	
  E2C4                	READ_DIR:
  E2C4  ED53FEF1      		LD	(_CLPS),DE
  E2C8  C5            		PUSH	BC
  E2C9  D5            		PUSH	DE
  E2CA  CD54E3        		CALL	DCPAT
  E2CD  CD58E9        		CALL	DRDX
  E2D0  D1            		POP	DE
  E2D1  C1            		POP	BC
  E2D2  C9            		RET
                      	
  E2D3                	FILESE:
  E2D3  7E            		LD	A,(HL)
  E2D4  B7            		OR	A
  E2D5  C8            		RET	Z		;END:ZF=1 CF=0
  E2D6  FEE5          		CP	0E5H
  E2D8  280E          		JR	Z,FILESE1
  E2DA  FDE5          		PUSH	IY
  E2DC  D1            		POP	DE
  E2DD  13            		INC	DE
  E2DE  E5            		PUSH	HL
  E2DF  CD2BE3        		CALL	CPFILE
  E2E2  CC4CE3        		CALL	Z,CPFILE2
  E2E5  E1            		POP	HL
  E2E6  37            		SCF
  E2E7  C8            		RET	Z		;!!!:(ZF=1) CF=1
  E2E8                	FILESE1:
  E2E8  CDFFE2        		CALL	FNEXT
  E2EB  20E6          		JR	NZ,FILESE
  E2ED                	ZF0_CF0_AFF_RET:
  E2ED  F6FF          		OR	0FFH		;ZF=0 CF=0
  E2EF  C9            		RET
                      	
  E2F0                	NEXTSE:
  E2F0  7E            		LD	A,(HL)
  E2F1  B7            		OR	A
  E2F2  37            		SCF
  E2F3  C8            		RET	Z		;!!!:ZF=1 CF=1
  E2F4  FEE5          		CP	0E5H
  E2F6  37            		SCF
  E2F7  C8            		RET	Z		;!!!:(ZF=1) CF=1
  E2F8  CDFFE2        		CALL	FNEXT
  E2FB  20F3          		JR	NZ,NEXTSE
  E2FD  18EE          		JR	ZF0_CF0_AFF_RET
                      	
  E2FF                	FNEXT:
  E2FF  E5            		PUSH	HL
  E300  219FF0        		LD	HL,_FILEN
  E303  34            		INC	(HL)
  E304  E1            		POP	HL
  E305  112000        		LD	DE,020H
  E308  19            		ADD	HL,DE
  E309  0D            		DEC	C
  E30A  C9            		RET
                      	
  E30B                	CPNAME:
  E30B  C5            		PUSH	BC
  E30C  D5            		PUSH	DE
  E30D  E5            		PUSH	HL
  E30E  CD25E3        		CALL	CPFILE4
  E311  E1            		POP	HL
  E312  23            		INC	HL
  E313  23            		INC	HL
  E314  23            		INC	HL
  E315  23            		INC	HL
  E316  D1            		POP	DE
  E317  C1            		POP	BC
  E318  2005          		JR	NZ,CPNAME1
  E31A  7E            		LD	A,(HL)
  E31B  23            		INC	HL
  E31C  66            		LD	H,(HL)
  E31D  6F            		LD	L,A
  E31E  C9            		RET
  E31F                	CPNAME1:
  E31F  23            		INC	HL
  E320  23            		INC	HL
  E321  10E8          		DJNZ	CPNAME
  E323  37            		SCF
  E324  C9            		RET
                      	
  E325                	CPFILE4:
  E325  C5            		PUSH	BC
  E326  010004        		LD	BC,00400H
  E329  1804          		JR	CPSTR1
  E32B                	CPFILE:
  E32B  C5            		PUSH	BC
  E32C  01000B        		LD	BC,00B00H
  E32F                	CPSTR1:
  E32F  1A            		LD	A,(DE)
  E330  FE3F          		CP	'?'		;Wild card
  E332  2812          		JR	Z,CPSTR2
  E334  7E            		LD	A,(HL)
  E335  CDA4E4        		CALL	FKANC
  E338  E5            		PUSH	HL
  E339  67            		LD	H,A
  E33A  1A            		LD	A,(DE)
  E33B  CB01          		RLC	C
  E33D  CDA4E4        		CALL	FKANC
  E340  CB09          		RRC	C
  E342  BC            		CP	H		;CP (HL),(DE)
  E343  E1            		POP	HL
  E344  2004          		JR	NZ,CPSTR3
  E346                	CPSTR2:
  E346  13            		INC	DE
  E347  23            		INC	HL
  E348  10E5          		DJNZ	CPSTR1
  E34A                	CPSTR3:
  E34A  C1            		POP	BC
  E34B  C9            		RET
                      	
  E34C                	CPFILE2:
  E34C  FD7E0D        		LD	A,(IY+13)	;(FCB)属性(アトリビュート)
  E34F  F6E1          		OR	0E1H
  E351  2F            		CPL
  E352  A6            		AND	(HL)
  E353  C9            		RET
                      	
  E354                	DCPAT:
  E354  0E00          		LD	C,0
  E356  2A7EF1        		LD	HL,(_DTBUF)
  E359  3AA0F0        		LD	A,(_DIRF)	;ディレクトリか判別
  E35C  B7            		OR	A
  E35D  C8            		RET	Z		;ルートディレクトリの場合はCレジスタを0にしておく(CDEがセクタ番号)
  E35E  3A72E3        		LD	A,(SPCPAT+1)
  E361  4F            		LD	C,A
  E362  3AE5EA        		LD	A,(_SECPS+1)
  E365  B9            		CP	C
  E366  3801          		JR	C,DC1
  E368  AF            		XOR	A
  E369                	DC1:
  E369  F680          		OR	080H
  E36B  32A0F0        		LD	(_DIRF),A	;bit0-6:セクタインデックス
  E36E                	CLUSTX:
  E36E  E5            		PUSH	HL
  E36F  EB            		EX	DE,HL
  E370  AF            		XOR	A
  E371  0E01          	SPCPAT:	LD	C,1		;自己書き換え（1クラスタの論理セクタ数）
  E373                	L_CLDBL:
  E373  CB19          		RR	C		;->CF
  E375  3804          		JR	C,E_CLDBL
  E377  29            		ADD	HL,HL		;*2
  E378  8F            		ADC	A,A
  E379  18F8          		JR	L_CLDBL
  E37B                	E_CLDBL:
  E37B  4F            		LD	C,A
  E37C  3AE5EA        		LD	A,(_SECPS+1)
  E37F  B5            		OR	L
  E380  6F            		LD	L,A
  E381  110800        	CLSPAT:	LD	DE,8	;+8 (2D)  !ADDCL (self-modifying code)
  E384  AF            		XOR	A
  E385  19            		ADD	HL,DE	;データ格納領域の先頭論理セクタ番号
  E386  89            		ADC	A,C
  E387  4F            		LD	C,A
  E388  EB            		EX	DE,HL
  E389  E1            		POP	HL
  E38A  C9            		RET
                      	
  E38B                	ENDCL:
  E38B  7A            		LD	A,D	;END CLUSTER
  E38C  FE01          	CLPAT1:	CP	1	;164=356	(self-modifying code)
  E38E  C0            		RET	NZ
  E38F  7B            		LD	A,E
  E390  FE64          	CLPAT2:	CP	064H	;		(self-modifying code)
  E392  C9            		RET
                      	
  E393                	CAP:
  E393  FE61          		CP	'a'
  E395  D8            		RET	C
  E396  FE7B          		CP	'z'+1
  E398  D0            		RET	NC
  E399  D620          		SUB	020H
  E39B  C9            		RET
  E39C                	CAP2:
  E39C  CD93E3        		CALL	CAP
  E39F                	CAP3:
  E39F  CDA8E3        		CALL	CAP4
  E3A2  FE21          		CP	021H
  E3A4  D0            		RET	NC
  E3A5  3EA0          		LD	A,NBSP
  E3A7  C9            		RET
  E3A8                	CAP4:
  E3A8  FE05          		CP	5
  E3AA  C0            		RET	NZ
  E3AB  3EE5          		LD	A,0E5H
  E3AD  C9            		RET
                      	
  E3AE                	CHDIR:
  E3AE  CDABED        		CALL	GETDPBD
  E3B1  381D          		JR	C,CHDIR2
  E3B3  DD751A        		LD	(IX+DPB_SDIR),L
  E3B6  DD741B        		LD	(IX+DPB_SDIR+1),H
  E3B9  1815          		JR	CHDIR2		;POP_IX_RET
                      	
  E3BB                	LDDIR:
  E3BB  CDABED        		CALL	GETDPBD
  E3BE  DD5E1A        		LD	E,(IX+DPB_SDIR)
  E3C1  DD561B        		LD	D,(IX+DPB_SDIR+1)
  E3C4  13            		INC	DE
  E3C5  FD730E        		LD	(IY+14),E	;(FCB)アクセスするディレクトリのクラスタ番号+1
  E3C8  FD720F        		LD	(IY+15),D
  E3CB  1B            		DEC	DE
  E3CC  AF            		XOR	A
  E3CD  32A0F0        		LD	(_DIRF),A
  E3D0                	CHDIR2:
  E3D0  DDE1          		POP	IX
  E3D2  C9            		RET
                      	
  E3D3                	LDDIRX:
  E3D3  3AA0F0        		LD	A,(_DIRF)	;(FCB)アクセスするディレクトリのセクタインデックス
  E3D6  E67F          		AND	07FH
  E3D8                	LDDIRX1:
  E3D8  32E5EA        		LD	(_SECPS+1),A
  E3DB  FD5E0E        		LD	E,(IY+14)	;(FCB)アクセスするディレクトリのクラスタ番号+1
  E3DE  FD560F        		LD	D,(IY+15)
  E3E1  1B            		DEC	DE
  E3E2  CD8BE3        		CALL	ENDCL
  E3E5  D4BBE3        		CALL	NC,LDDIR
  E3E8                	LDDIRS:
  E3E8  7A            		LD	A,D
  E3E9  B3            		OR	E
  E3EA  32A0F0        		LD	(_DIRF),A	;ディレクトリか判別
  E3ED  C9            		RET
                      	
  E3EE                	KILL:
  E3EE  CDBEE4        		CALL	CHKWILDX
  E3F1  3834          		JR	C,KILLW
  E3F3  CD90E1        		CALL	SOPENX
  E3F6                	KILLS:
  E3F6  3E1F          		LD	A,01FH
  E3F8  D43AE4        		CALL	NC,CHKATT
  E3FB  D8            		RET	C
  E3FC                	KILLSX:
  E3FC  36E5          		LD	(HL),0E5H	;DIR
  E3FE  CD98E4        		CALL	WTDB
  E401  111A00        		LD	DE,01AH
  E404  19            		ADD	HL,DE
  E405  5E            		LD	E,(HL)
  E406  23            		INC	HL
  E407  56            		LD	D,(HL)
  E408                	KILLS1:
  E408  CD8BE3        		CALL	ENDCL
  E40B  D0            		RET	NC		;CF=0
  E40C  21FEFF        		LD	HL,0-2
  E40F  19            		ADD	HL,DE
  E410  D0            		RET	NC		;DE= 0 or 1
  E411  D5            		PUSH	DE
  E412  CDF7F0        		CALL	_GNCL
  E415  ED53FEF1      		LD	(_CLPS),DE
  E419  D1            		POP	DE
  E41A  210000        		LD	HL,0
  E41D  D4FAF0        		CALL	NC,_SNCL
  E420  D8            		RET	C
  E421  ED5BFEF1      		LD	DE,(_CLPS)	;FAT
  E425  18E1          		JR	KILLS1
                      	
  E427                	KILLW:
  E427  CDBDE1        		CALL	SOPEN
  E42A                	KILLW1:
  E42A  380B          		JR	C,KILLW2
  E42C  CD5DE2        		CALL	SOPENE2
  E42F  CDF6E3        		CALL	KILLS
  E432  CD21E2        		CALL	NOPEN
  E435  18F3          		JR	KILLW1
  E437                	KILLW2:
  E437  C8            		RET	Z
  E438  3F            		CCF
  E439  C9            		RET
                      	
  E43A                	CHKATT:
  E43A  E5            		PUSH	HL
  E43B  110B00        		LD	DE,00BH
  E43E  19            		ADD	HL,DE
  E43F  A6            		AND	(HL)
  E440  E1            		POP	HL
  E441  C8            		RET	Z
  E442  37            		SCF
  E443  C9            		RET
                      	
  E444                	NAME:
  E444  CDBEE4        		CALL	CHKWILDX
  E447  D8            		RET	C
  E448  110400        		LD	DE,4
  E44B  19            		ADD	HL,DE
  E44C  2264E4        		LD	(NAMEP+2),HL
  E44F  23            		INC	HL
  E450  CDC2E4        		CALL	CHKWILD
  E453  D8            		RET	C
                      	
  E454  CD90E1        		CALL	SOPENX
  E457  3E0F          		LD	A,00FH
  E459  D43AE4        		CALL	NC,CHKATT
  E45C  D8            		RET	C
                      	
  E45D  FD7E00        		LD	A,(IY+0)
  E460  FDE5          		PUSH	IY
  E462  FD210000      	NAMEP:	LD	IY,0		;自己書き換え
  E466  FD7700        		LD	(IY+0),A
  E469  CD90E1        		CALL	SOPENX
  E46C  FDE3          		EX	(SP),IY
  E46E  3F            		CCF
  E46F  D4BDE1        		CALL	NC,SOPEN
  E472  EB            		EX	DE,HL
  E473  E1            		POP	HL
  E474  D8            		RET	C
                      	
  E475                	SETNAME:
  E475  01000B        		LD	BC,11*256
  E478  23            		INC	HL
  E479  7E            		LD	A,(HL)
  E47A  FEE5          		CP	0E5H
  E47C  2004          		JR	NZ,SNAME1
  E47E  3E05          		LD	A,5
  E480  180E          		JR	SNAME3
  E482                	SNAME1:
  E482  7E            		LD	A,(HL)
  E483  0C            		INC	C
  E484  0D            		DEC	C
  E485  2009          		JR	NZ,SNAME3
  E487  CD93E3        		CALL	CAP
  E48A  FEA0          		CP	0A0H
  E48C  2002          		JR	NZ,SNAME3
  E48E  3E20          		LD	A,020H
  E490                	SNAME3:
  E490  12            		LD	(DE),A
  E491  7E            		LD	A,(HL)
  E492  23            		INC	HL
  E493  CDABE4        		CALL	FKAN
  E496  10EA          		DJNZ	SNAME1
  E498                	WTDB:
  E498  3EFF          		LD	A,0FFH
  E49A  3239F0        		LD	(SFILE),A
  E49D                	SWTDBF:
  E49D  3E01          		LD	A,1
  E49F  32A4F0        		LD	(_WTDBF),A
  E4A2  AF            		XOR	A
  E4A3  C9            		RET
                      	
  E4A4                	FKANC:
  E4A4  CB41          		BIT	0,C
  E4A6  CC9CE3        		CALL	Z,CAP2
  E4A9  1801          		JR	FKANX
  E4AB                	FKAN:			;漢字チェック
  E4AB  13            		INC	DE
  E4AC                	FKANX:
  E4AC  CB41          		BIT	0,C
  E4AE  CB81          		RES	0,C
  E4B0  C0            		RET	NZ
  E4B1  FE80          		CP	080H
  E4B3  D8            		RET	C
  E4B4  FEA0          		CP	0A0H
  E4B6  3803          		JR	C,FKAN1
  E4B8  FEE0          		CP	0E0H
  E4BA  D8            		RET	C
  E4BB                	FKAN1:
  E4BB  0C            		INC	C
  E4BC  A7            		AND	A
  E4BD  C9            		RET
                      	
  E4BE                	CHKWILDX:
  E4BE  FDE5          		PUSH	IY
  E4C0  E1            		POP	HL
  E4C1  23            		INC	HL
  E4C2                	CHKWILD:
  E4C2  060B          		LD	B,11
  E4C4  3E3F          		LD	A,'?'
  E4C6                	CHKWIL1:
  E4C6  BE            		CP	(HL)
  E4C7  23            		INC	HL
  E4C8  37            		SCF
  E4C9  C8            		RET	Z
  E4CA  10FA          		DJNZ	CHKWIL1
  E4CC  AF            		XOR	A
  E4CD  C9            		RET
                      	
  E4CE                	SDIRENT:		;IY=FCB HL=DIR
  E4CE  D5            		PUSH	DE
  E4CF  E5            		PUSH	HL
  E4D0  FDE5          		PUSH	IY
  E4D2  D1            		POP	DE
  E4D3  EB            		EX	DE,HL
  E4D4  CD75E4        		CALL	SETNAME
                      	;				Attribute
  E4D7  FD7E0D        		LD	A,(IY+13)	;(FCB)属性(アトリビュート)
  E4DA  12            		LD	(DE),A
  E4DB  13            		INC	DE
                      	;				Reserved
  E4DC  AF            		XOR	A
  E4DD  060A          		LD	B,10
  E4DF                	SDE1:
  E4DF  12            		LD	(DE),A
  E4E0  13            		INC	DE
  E4E1  10FC          		DJNZ	SDE1
                      						;(FCB)更新時刻
  E4E3  21E4F1        		LD	HL,SDDATA		;(FCB)更新年月日
  E4E6  060A          		LD	B,SDDATAE-SDDATA	;(FCB)ファイルの先頭クラスタ
  E4E8                	SDLOOP:					;(FCB)ファイルのサイズ(バイト単位)
  E4E8  7E            		LD	A,(HL)
  E4E9  23            		INC	HL
  E4EA  32EFE4        		LD	(SDPAT+2),A
  E4ED  FD7E00        	SDPAT:	LD	A,(IY+0)	;LD A,(IY+A)
  E4F0  12            		LD	(DE),A
  E4F1  13            		INC	DE
  E4F2  10F4          		DJNZ	SDLOOP
                      	
  E4F4  AF            		XOR	A
  E4F5  E1            		POP	HL
  E4F6  D1            		POP	DE
  E4F7  C9            		RET
                      	
  E4F8                	WOPEN:
  E4F8  FD7E0D        		LD	A,(IY+13)	;(FCB)属性(アトリビュート)
  E4FB  E61F          		AND	01FH
  E4FD  37            		SCF
  E4FE  C0            		RET	NZ
  E4FF  FD361CFE      		LD	(IY+28),0FEH	;(FCB)オープンモード
  E503                	TOPEN2:
  E503  AF            		XOR	A
  E504                	TOPEN:				;Initializes the time stamp
  E504  FD3617FF      		LD	(IY+23),0FFH	;(FCB)更新時刻
  E508  C9            		RET
                      	
  E509                	WRDFX:
  E509  3A72E3        		LD	A,(SPCPAT+1)	;1クラスタの論理セクタ
  E50C                	L_WRFX:
  E50C  1F            		RRA			;->CF
  E50D  3806          		JR	C,E_WRFX
  E50F  CB39          		SRL	C
  E511  CB1C          		RR	H		;CH=CH/2
  E513  18F7          		JR	L_WRFX
  E515                	E_WRFX:
  E515  41            		LD	B,C
  E516  4C            		LD	C,H
  E517  03            		INC	BC
  E518  3E37          		LD	A,037H		;SCF
  E51A  3275E9        		LD	(DRDN1),A
                      	
  E51D                	WRDF:				;BCクラスタ分FATを確保する
  E51D  110200        		LD	DE,2
  E520  AF            		XOR	A
  E521  32E5EA        		LD	(_SECPS+1),A
  E524                	WRDF1:
  E524  C5            		PUSH	BC
  E525  D5            		PUSH	DE
  E526  CDF7F0        		CALL	_GNCL
  E529  381C          		JR	C,WRDF3
  E52B  7A            		LD	A,D		;空いているかチェック
  E52C  B3            		OR	E
  E52D  202A          		JR	NZ,WRDF4
  E52F  E1            		POP	HL		;HL=空いているクラスタ
  E530  E5            		PUSH	HL
  E531  ED5BFEF1      		LD	DE,(_CLPS)	;DE=元の(_CLPS)
  E535  22FEF1        		LD	(_CLPS),HL
  E538  7A            		LD	A,D		;元の(_CLPS)が 0 か?
  E539  B3            		OR	E
  E53A  2008          		JR	NZ,WRDF2
  E53C  FD751A        		LD	(IY+26),L	;(FCB)ファイルの先頭クラスタ
  E53F  FD741B        		LD	(IY+27),H	;元が空の場合はFCBにクラスタをセットする
  E542  1803          		JR	WRDF3
  E544                	WRDF2:
  E544  CDFAF0        		CALL	_SNCL
  E547                	WRDF3:
  E547  D1            		POP	DE
  E548  C1            		POP	BC
  E549  D8            		RET	C
  E54A  0B            		DEC	BC
  E54B  78            		LD	A,B
  E54C  B1            		OR	C
  E54D  200C          		JR	NZ,WRDF5	;ここでループカウンタチェック
  E54F  ED5BFEF1      		LD	DE,(_CLPS)
  E553  21FFFF        		LD	HL,0FFFFH	;FATエントリ終了(EOCマーク)
  E556  C3FAF0        		JP	_SNCL
                      	
  E559                	WRDF4:				;DEクラスタが空じゃないので次に移動する
  E559  D1            		POP	DE
  E55A  C1            		POP	BC
  E55B                	WRDF5:
  E55B  13            		INC	DE
  E55C  CD8BE3        		CALL	ENDCL
  E55F  38C3          		JR	C,WRDF1
  E561  37            		SCF
  E562  C9            		RET
                      	
  E563                	RWXR:
  E563  3A82E8        		LD	A,(SECSZ+2)	;1024=4 / 512=2 / 256=1
  E566                	L_RWX:
  E566  1F            		RRA		;->CF
  E567  3808          		JR	C,E_RWX
  E569  CB38          		SRL	B	;BCH=BCH/2
  E56B  CB19          		RR	C	;
  E56D  CB1C          		RR	H	;
  E56F  18F5          		JR	L_RWX
  E571                	E_RWX:
  E571  FD5E1A        		LD	E,(IY+26)	;(FCB)ファイルの先頭クラスタ
  E574  FD561B        		LD	D,(IY+27)
  E577  AF            		XOR	A
  E578  32E5EA        		LD	(_SECPS+1),A
  E57B                	RWX1:
  E57B  ED53FEF1      		LD	(_CLPS),DE
  E57F  7A            		LD	A,D
  E580  B3            		OR	E
  E581  2813          		JR	Z,SCF_RET	;RET DE==0 => CF=1
                      	
  E583  78            		LD	A,B
  E584  B1            		OR	C
  E585  B4            		OR	H
  E586  C8            		RET	Z		;RET BCH==0 => CF=0
                      	
  E587  CDEDEA        		CALL	GNCLX
  E58A  D8            		RET	C
  E58B  7C            		LD	A,H		;
  E58C  25            		DEC	H		;
  E58D  B7            		OR	A		;DEC BCH
  E58E  2001          		JR	NZ,RWX2		;
  E590  0B            		DEC	BC		;
  E591                	RWX2:
  E591  CD8BE3        		CALL	ENDCL
  E594  38E5          		JR	C,RWX1
  E596                	SCF_RET:
  E596  37            		SCF
  E597  C9            		RET
                      	
  E598                	DSKF:
  E598  110000        	MAXCLP:	LD	DE,0
  E59B  2AACF0        		LD	HL,(_FAKEFREE)
  E59E  7C            		LD	A,H
  E59F  B5            		OR	L
  E5A0  2803          		JR	Z,DSKF1
  E5A2  110100        		LD	DE,1
  E5A5                	DSKF1:
  E5A5  D5            		PUSH	DE
  E5A6  CDF7F0        		CALL	_GNCL
  E5A9  380C          		JR	C,POPSCF
  E5AB  7A            		LD	A,D
  E5AC  B3            		OR	E
  E5AD  2001          		JR	NZ,DSKF2
  E5AF  23            		INC	HL
  E5B0                	DSKF2:
  E5B0  D1            		POP	DE
  E5B1  1B            		DEC	DE
  E5B2  7A            		LD	A,D
  E5B3  B3            		OR	E
  E5B4  20EF          		JR	NZ,DSKF1
  E5B6  C9            		RET
                      	
  E5B7                	POPSCF:
  E5B7  F1            		POP	AF
  E5B8  37            		SCF
  E5B9  C9            		RET
                      	
  E5BA                	SETTMS:
  E5BA  FD7E17        		LD	A,(IY+23)	;(FCB)ファイルを最後に変更した時刻
  E5BD  3C            		INC	A
  E5BE  C0            		RET	NZ		;ファイルが更新されていない
  E5BF                	SETTMSX:			;FCBに日付時刻をセットする
  E5BF  CD6EDC        		CALL	_SYS2C		;(BDOS)時刻の獲得
                      					;H←時  L←分  D←秒
  E5C2  CB25          		SLA	L		;   *2
  E5C4  CB25          		SLA	L		;   *4
  E5C6  29            		ADD	HL,HL		;*2 *8
  E5C7  29            		ADD	HL,HL		;*4 *16
  E5C8  29            		ADD	HL,HL		;*8 *32
  E5C9  7A            		LD	A,D
  E5CA  0F            		RRCA			;bit.0->7->->->0->C
  E5CB  E61F          		AND	01FH
  E5CD  B5            		OR	L
  E5CE  FD7716        		LD	(IY+22),A	;(FCB)ファイルを最後に変更した時刻
  E5D1  FD7417        		LD	(IY+23),H
                      	
  E5D4  CD4BDC        		CALL	_SYS2A		;(BDOS)日付の獲得
                      					;HL←年  D←月  E←日
  E5D7  0144F8        		LD	BC,0-1980
  E5DA  09            		ADD	HL,BC
  E5DB  65            		LD	H,L
                      	
  E5DC  7A            		LD	A,D
  E5DD  87            		ADD	A,A		;*2
  E5DE  87            		ADD	A,A		;*4
  E5DF  87            		ADD	A,A		;*8
  E5E0  87            		ADD	A,A		;*16
  E5E1  6F            		LD	L,A
  E5E2  29            		ADD	HL,HL		;*32
  E5E3  7D            		LD	A,L
  E5E4  B3            		OR	E
  E5E5  FD7714        		LD	(IY+20),A	;(FCB)ファイルを最後に変更した日付
  E5E8  FD7415        		LD	(IY+21),H
  E5EB  C9            		RET
                      	
  E5EC                	PUSHRR:
  E5EC  3284E6        		LD	(SETSEQ_SWC_RND),A
  E5EF  2296E6        		LD	(SETSEQ_SWC_SEQ_RR),HL
  E5F2  CD12E6        		CALL	GET_RR_AHL
  E5F5  220FF0        		LD	(RR_BUF_HL),HL
  E5F8  3211F0        		LD	(RR_BUF_A),A
  E5FB  C9            		RET
                      	
  E5FC                	GET_CPM_R_SIZE:		;バイト単位からCP/Mのレコード単位を求める（1レコード=128バイト）
  E5FC  87            		ADD	A,A		;in BHLA => out AHL
  E5FD  ED6A          		ADC	HL,HL
  E5FF  CB18          		RR	B
  E601  B7            		OR	A
  E602  78            		LD	A,B		;ここでフラグは変化しない
  E603  C8            		RET	Z
  E604  2C            		INC	L		;INC AHL
  E605  C0            		RET	NZ		;
  E606  24            		INC	H		;
  E607  C0            		RET	NZ		;
  E608  3C            		INC	A		;
  E609  C9            		RET
                      	
  E60A                	INIT_RND:
  E60A  3ECD          		LD	A,0CDH		;CALL ????
  E60C  2159E6        		LD	HL,POPRR
  E60F  CDECE5        		CALL	PUSHRR
  E612                	GET_RR_AHL:
  E612  FD6E21        		LD	L,(IY+33)	;(FCB)Random record
  E615  FD6622        		LD	H,(IY+34)	;
  E618  FD7E23        		LD	A,(IY+35)	;
  E61B  C9            		RET
  E61C                	SET_RR_AHL:
  E61C  FD7521        		LD	(IY+33),L	;(FCB)Random record
  E61F  FD7422        		LD	(IY+34),H
  E622  FD7723        		LD	(IY+35),A
  E625  C9            		RET
  E626                	INIT_SEQ:
  E626  3E01          		LD	A,1		;LD BC,????
  E628  2156E6        		LD	HL,SETSEQ
  E62B  CDECE5        		CALL	PUSHRR
  E62E                	GETSEQ:
  E62E  FD6E20        		LD	L,(IY+32)	;(FCB)カレントレコード
  E631  FD660C        		LD	H,(IY+12)	;(FCB)カレントブロック
  E634  AF            		XOR	A
                      	
  E635  CB25          		SLA	L	;L=L*2
                      	
  E637  CB3C          		SRL	H	;HL=HL/2
  E639  CB1D          		RR	L	;
  E63B  C9            		RET
                      	
  E63C                	SETSEQ1:
  E63C  F5            		PUSH	AF
  E63D  E5            		PUSH	HL		;AHL=Random record
  E63E  CD12E6        		CALL	GET_RR_AHL
  E641  47            		LD	B,A		;AHL→HLA
  E642  7D            		LD	A,L		;(IY+33)(FCB)ランダムレコード
  E643  6C            		LD	L,H		;(IY+34)
  E644  60            		LD	H,B		;(IY+35)
  E645  0600          		LD	B,0
                      	
  E647  CDFCE5        		CALL	GET_CPM_R_SIZE
                      	
  E64A  29            		ADD	HL,HL
  E64B  CB3D          		SRL	L		;L=L/2
  E64D  FD7520        		LD	(IY+32),L	;(FCB)カレントレコード
  E650  FD740C        		LD	(IY+12),H	;(FCB)カレントブロック
  E653  E1            		POP	HL
  E654  F1            		POP	AF
  E655  C9            		RET
  E656                	SETSEQ:
  E656  CD3CE6        		CALL	SETSEQ1
  E659                	POPRR:
  E659  F5            		PUSH	AF
  E65A  E5            		PUSH	HL
  E65B  2A0FF0        		LD	HL,(RR_BUF_HL)
  E65E  3A11F0        		LD	A,(RR_BUF_A)
  E661  CD1CE6        		CALL	SET_RR_AHL
  E664  E1            		POP	HL
  E665  F1            		POP	AF
  E666  C9            		RET
                      	
  E667                	RB_WRITE:
  E667  C5            		PUSH	BC
  E668  ED4B4CF1      		LD	BC,(STABLE+2*026H)	;(BDOS)ランダムブロック書き込み
  E66C  1805          		JR	RBRW
  E66E                	RB_READ:
  E66E  C5            		PUSH	BC
  E66F  ED4B4EF1      		LD	BC,(STABLE+2*027H)	;(BDOS)ランダムブロック読み込み
  E673                	RBRW:
  E673  1F            		RRA		;AHL = AHL*128
  E674  7C            		LD	A,H	;AHL = AHL0/2
  E675  1F            		RRA		;A
  E676  65            		LD	H,L	;
  E677  CB1C          		RR	H	;H
  E679  2E00          		LD	L,0	;
  E67B  CB1D          		RR	L	;L
  E67D  CD1CE6        		CALL	SET_RR_AHL
  E680  218000        		LD	HL,128
  E683  C5            		PUSH	BC
  E684                	SETSEQ_SWC_RND:
  E684  CD3CE6        		CALL	SETSEQ1
  E687  C1            		POP	BC
  E688  FDCB20FE      		SET	7,(IY+32)	;(FCB)カレントレコード
  E68C  FDE5          		PUSH	IY
  E68E  D1            		POP	DE
  E68F  D5            		PUSH	DE
  E690  CD9EE6        		CALL	JP_BC
  E693  FDE1          		POP	IY
  E695  CD56E6        		CALL	SETSEQ
  E696                	SETSEQ_SWC_SEQ_RR	EQU $-2
  E698  FDCB20BE      		RES	7,(IY+32)	;(FCB)カレントレコード
                      	
  E69C  C1            		POP	BC
  E69D  C9            		RET
  E69E                	JP_BC:
  E69E  C5            		PUSH	BC
  E69F  C9            		RET
                      	
  E21B                	_SYS03	EQU	SCF_FF_RET	;(BDOS)外部入力
  E21B                	_SYS2B	EQU	SCF_FF_RET	;(BDOS)日付の設定
  E21B                	_SYS2D	EQU	SCF_FF_RET	;(BDOS)時刻の設定
  E21B                	_SYS39	EQU	SCF_FF_RET	;(BDOS)サブディレクトリの作成
  E21B                	_SYS3A	EQU	SCF_FF_RET	;(BDOS)サブディレクトリの削除
                      	
                      	
                      	;LDFILE2.ASM
                      	
                      	;	LSX-Dodgers FILE2
                      	
                      					;Write random block
  E6A0                	_SYS26:		;(BDOS)ランダムブロック書き込み
  E6A0  AF            		XOR	A
  E6A1  3275E9        		LD	(DRDN1),A	;NOP
  E6A4  22C5E8        		LD	(RBSIZE),HL	;HL←書き込むレコード数
  E6A7  225DF0        		LD	(LEFTX),HL
  E6AA  CD70E1        		CALL	SETDRV
                      	
  E6AD  CD1DE8        		CALL	RBX0
  E6B0  DA3DE7        		JP	C,RBWERR
  E6B3  CDF8E4        		CALL	WOPEN
  E6B6  DA3DE7        		JP	C,RBWERR
  E6B9  7C            		LD	A,H
  E6BA  B5            		OR	L
  E6BB  CA36E7        		JP	Z,RBW1
                      	
  E6BE  2B            		DEC	HL
                      	
  E6BF  CDDBE8        		CALL	GET_RR_BCDE	;BCDE=Random record
                      	
  E6C2  19            		ADD	HL,DE		;BCHL=HL+BCDE
  E6C3  3001          		JR	NC,S26X1	;
  E6C5  03            		INC	BC		;
  E6C6                	S26X1:
  E6C6  CD63E5        		CALL	RWXR
  E6C9  DC09E5        		CALL	C,WRDFX
  E6CC  DA3DE7        		JP	C,RBWERR
                      	
  E6CF  CD4CE8        		CALL	RBX2
  E6D2  281A          		JR	Z,RBWB		;NZ=セクタ以下の端数がある
  E6D4  CD6BE8        		CALL	RBXA
  E6D7  3864          		JR	C,RBWERR
  E6D9  EB            		EX	DE,HL
  E6DA  C5            		PUSH	BC
  E6DB  EDB0          		LDIR
  E6DD  225FF0        		LD	(DTAX),HL
                      	
  E6E0  CD9DE4        		CALL	SWTDBF		;バッファデータは更新された
                      	
  E6E3  2A5DF0        		LD	HL,(LEFTX)
  E6E6  D1            		POP	DE
  E6E7  ED52          		SBC	HL,DE
  E6E9  225DF0        		LD	(LEFTX),HL
  E6EC  2831          		JR	Z,RBWEND
                      	
  E6EE                	RBWB:
  E6EE  CDA0E8        		CALL	RBXB
  E6F1  2814          		JR	Z,RBWC
  E6F3                	RBWB1:
  E6F3  C5            		PUSH	BC
  E6F4  D5            		PUSH	DE
  E6F5  CD6EE3        		CALL	CLUSTX
  E6F8  CDEFE8        		CALL	DWTC
  E6FB  D1            		POP	DE
  E6FC  C1            		POP	BC
  E6FD  D4EDEA        		CALL	NC,GNCLX
  E700  383B          		JR	C,RBWERR
  E702  10EF          		DJNZ	RBWB1
  E704  CD3FE9        		CALL	DRW_FLUSH
  E707                	RBWC:
  E707  CDB8E8        		CALL	RBXC
  E70A  2813          		JR	Z,RBWEND
  E70C  C5            		PUSH	BC
  E70D  CD6EE3        		CALL	CLUSTX
  E710  CD74E9        		CALL	DRDN
  E713  C1            		POP	BC
  E714  3827          		JR	C,RBWERR
  E716  ED5B7EF1      		LD	DE,(_DTBUF)
  E71A  EDB0          		LDIR
  E71C  CD9DE4        		CALL	SWTDBF		;バッファデータは更新された
  E71F                	RBWEND:
  E71F  CDC4E8        		CALL	RBXEND
                      	
  E722  CD2CE8        		CALL	RBX1
  E725  300F          		JR	NC,RBW1		;ランダムレコードの方が大きい場合はサイズを合わせる
  E727  CDDBE8        		CALL	GET_RR_BCDE	;BCDE=Random record
  E72A  FD7310        		LD	(IY+16),E	;ファイルのサイズ(バイト単位)
  E72D  FD7211        		LD	(IY+17),D	;
  E730  FD7112        		LD	(IY+18),C	;
  E733  FD7013        		LD	(IY+19),B	;
  E736                	RBW1:
  E736  FDE1          		POP	IY
  E738  C1            		POP	BC
  E739  D1            		POP	DE
  E73A  E1            		POP	HL
  E73B                	DD_NUL:
  E73B  AF            		XOR	A
  E73C                	DRDF0:
  E73C                	DWTF0:
  E73C  C9            		RET
                      	
  E73D                	RBWERR:
  E73D  FDE5          		PUSH	IY
  E73F  D1            		POP	DE
  E740  2A20F1        		LD	HL,(STABLE+2*010H)
  E743  CD0F00        		CALL	JP_HL
  E746                	RBRERR1:
  E746  3E01          		LD	A,001H
  E748                	RBRERR2:
  E748  FDE1          		POP	IY
  E74A  C1            		POP	BC
  E74B  D1            		POP	DE
  E74C  E1            		POP	HL
  E74D  37            		SCF
  E74E  210000        		LD	HL,0
  E751  C9            		RET
                      	
  E752                	RBRERR:
  E752  3EFF          		LD	A,0FFH
  E754  18F2          		JR	RBRERR2
                      	
  E756                	RBRFL:
  E756  3E00          	RBRFLP:	LD	A,000H
  E758  FE0D          		CP	00DH
  E75A  2005          		JR	NZ,RBRFL1
  E75C  D5            		PUSH	DE
  E75D  1E0A          		LD	E,00AH
  E75F  1805          		JR	RBRFL2
  E761                	RBRFL1:
  E761  D5            		PUSH	DE
  E762  CD09F0        		CALL	_SYS07
  E765  5F            		LD	E,A
  E766                	RBRFL2:
  E766  CDCDF0        		CALL	_PRINT
  E769  7B            		LD	A,E
  E76A  D1            		POP	DE
  E76B  3257E7        		LD	(RBRFLP+1),A
  E76E  C9            		RET
  E76F                	DDX:
  E76F  FD7E01        		LD	A,(IY+1)	;(FCB)主ファイル名
  E772  CD93E3        		CALL	CAP
  E775  FE41          		CP	'A'
  E777  C9            		RET
                      	
                      					;Read random block
  E778                	_SYS27:		;(BDOS)ランダムブロック読み込み
  E778  225DF0        		LD	(LEFTX),HL
  E77B  CD70E1        		CALL	SETDRV
                      	
  E77E  FDCB0D66      		BIT	4,(IY+13)	;(FCB)属性(アトリビュート)
  E782  C20BE8        		JP	NZ,RBRDIR	;ディレクトリ
  E785  CD1DE8        		CALL	RBX0
  E788  DA52E7        		JP	C,RBRERR
  E78B  CD2CE8        		CALL	RBX1
  E78E  D444E8        		CALL	NC,RBX1R
  E791  DA46E7        		JP	C,RBRERR1
  E794  EB            		EX	DE,HL
  E795  ED52          		SBC	HL,DE		;CP 00HL,BCDE
  E797  19            		ADD	HL,DE
  E798  79            		LD	A,C
  E799  DE00          		SBC	A,0
  E79B  78            		LD	A,B
  E79C  DE00          		SBC	A,0
  E79E  3801          		JR	C,RBR1
  E7A0  EB            		EX	DE,HL
  E7A1                	RBR1:
  E7A1  9F            		SBC	A,A
  E7A2  E601          		AND	1
  E7A4  3209E8        		LD	(RBRAP+1),A
                      	
  E7A7  7C            		LD	A,H
  E7A8  B5            		OR	L
  E7A9  2857          		JR	Z,RBREND0
                      	
  E7AB  22C5E8        		LD	(RBSIZE),HL	;HL←読み込むレコード数
  E7AE  225DF0        		LD	(LEFTX),HL
                      	
  E7B1  CD4CE8        		CALL	RBX2
  E7B4  2819          		JR	Z,RBRB
  E7B6  CD6BE8        		CALL	RBXA
  E7B9  DA52E7        		JP	C,RBRERR
  E7BC  C5            		PUSH	BC
  E7BD  EDB0          		LDIR
  E7BF  ED535FF0      		LD	(DTAX),DE
  E7C3  2A5DF0        		LD	HL,(LEFTX)
  E7C6  D1            		POP	DE
  E7C7  A7            		AND	A
  E7C8  ED52          		SBC	HL,DE
  E7CA  225DF0        		LD	(LEFTX),HL
  E7CD  2830          		JR	Z,RBREND
                      	
  E7CF                	RBRB:
  E7CF  CDA0E8        		CALL	RBXB
  E7D2  2815          		JR	Z,RBRC
  E7D4                	RBRB1:
  E7D4  C5            		PUSH	BC
  E7D5  D5            		PUSH	DE
  E7D6  CD6EE3        		CALL	CLUSTX
  E7D9  CDF5E8        		CALL	DRDC
  E7DC  D1            		POP	DE
  E7DD  C1            		POP	BC
  E7DE  D4EDEA        		CALL	NC,GNCLX
  E7E1  DA52E7        		JP	C,RBRERR
  E7E4  10EE          		DJNZ	RBRB1
  E7E6  CD3FE9        		CALL	DRW_FLUSH
  E7E9                	RBRC:
  E7E9  CDB8E8        		CALL	RBXC
  E7EC  2811          		JR	Z,RBREND
  E7EE  C5            		PUSH	BC
  E7EF  CD6EE3        		CALL	CLUSTX
  E7F2  CD58E9        		CALL	DRDX
  E7F5  C1            		POP	BC
  E7F6  DA52E7        		JP	C,RBRERR
  E7F9  EB            		EX	DE,HL
  E7FA  2A7EF1        		LD	HL,(_DTBUF)
  E7FD  EDB0          		LDIR
  E7FF                	RBREND:
  E7FF  CDC4E8        		CALL	RBXEND
  E802                	RBREND0:
  E802  FDE1          		POP	IY
  E804  C1            		POP	BC
  E805  D1            		POP	DE
  E806  F1            		POP	AF	;(HL)
  E807  AF            		XOR	A
  E808  3E00          	RBRAP:	LD	A,000H
  E80A  C9            		RET
                      	
  E80B                	RBRDIR:
  E80B  FD6E1A        		LD	L,(IY+26)	;(FCB)ファイルの先頭クラスタ
  E80E  FD661B        		LD	H,(IY+27)
  E811  CDAEE3        		CALL	CHDIR
  E814  AF            		XOR	A
  E815  67            		LD	H,A
  E816  6F            		LD	L,A
  E817  3C            		INC	A
  E818  3209E8        		LD	(RBRAP+1),A
  E81B  18E5          		JR	RBREND0
                      	
  E81D                	RBX0:
  E81D  2A8AF0        		LD	HL,(_DTA)
  E820  225FF0        		LD	(DTAX),HL
  E823  2A5DF0        		LD	HL,(LEFTX)
  E826  FD7E1C        		LD	A,(IY+28)	;(FCB)オープンモード
  E829  D6FD          		SUB	0FDH
  E82B  C9            		RET
                      	
  E82C                	RBX1:				;ファイルサイズとランダムレコードを比べる
  E82C  E5            		PUSH	HL		;Record byte
                      					;AHL=File size
  E82D  FD6E10        		LD	L,(IY+16)	;ファイルのサイズ(バイト単位)
  E830  FD6611        		LD	H,(IY+17)	;
  E833  FD7E12        		LD	A,(IY+18)	;
                      	
  E836  CDDBE8        		CALL	GET_RR_BCDE	;BCDE=Random record
                      	
  E839  A7            		AND	A
  E83A  ED52          		SBC	HL,DE
  E83C  99            		SBC	A,C
  E83D  4F            		LD	C,A
  E83E  FD7E13        		LD	A,(IY+19)	;ファイルのサイズ
  E841  98            		SBC	A,B
  E842  D1            		POP	DE
  E843  C9            		RET
  E844                	RBX1R:
  E844  47            		LD	B,A
  E845  B1            		OR	C
  E846  EB            		EX	DE,HL	;BCDE=File byte	HL=Record byte
  E847  B2            		OR	D
  E848  B3            		OR	E
  E849  C0            		RET	NZ
  E84A  37            		SCF
  E84B  C9            		RET
                      	
  E84C                	RBX2:				;Cluster settings
  E84C  FD6622        		LD	H,(IY+34)	;(+33)(FCB)ランダムレコード
  E84F  FD4E23        		LD	C,(IY+35)
  E852  0600          		LD	B,0
  E854  FDCB207E      		BIT	7,(IY+32)	;(FCB)カレントレコード
  E858  2003          		JR	NZ,RBX3
  E85A  FD4624        		LD	B,(IY+36)
  E85D                	RBX3:
  E85D  CD63E5        		CALL	RWXR
  E860  3A82E8        		LD	A,(SECSZ+2)	;1024=4 / 512=2 / 256=1
  E863  3D            		DEC	A
  E864  FDA622        		AND	(IY+34)
  E867  FDB621        		OR	(IY+33)
  E86A  C9            		RET
                      	
  E86B                	RBXA:
  E86B  C5            		PUSH	BC
  E86C  D5            		PUSH	DE
  E86D  CD6EE3        		CALL	CLUSTX
  E870  CD58E9        		CALL	DRDX
  E873  D1            		POP	DE
  E874  C1            		POP	BC
  E875  D4EDEA        		CALL	NC,GNCLX
  E878  D8            		RET	C
  E879  ED53FEF1      		LD	(_CLPS),DE
                      	
  E87D  FD4E21        		LD	C,(IY+33)	;(FCB)ランダムレコード
  E880  210004        	SECSZ:	LD	HL,0400H	;自己書き換え 1024=0400H / 512=0200H ここに1セクタのサイズが格納される
  E883  7C            		LD	A,H
  E884  3D            		DEC	A		;1024=3 / 512=1
  E885  FDA622        		AND	(IY+34)		;(FCB)ランダムレコード
  E888  47            		LD	B,A		;BCに1セクタ以下の端数が入る
  E889  ED42          		SBC	HL,BC		;残りを計算
                      	
  E88B  ED5B5DF0      		LD	DE,(LEFTX)
  E88F  ED52          		SBC	HL,DE		;CP HL,DE
  E891  19            		ADD	HL,DE		;
  E892  3801          		JR	C,RBXA1		;DEとHLを比較して大きい方をHLに
  E894  EB            		EX	DE,HL
  E895                	RBXA1:
  E895  E5            		PUSH	HL
  E896  2A7EF1        		LD	HL,(_DTBUF)
  E899  09            		ADD	HL,BC
  E89A  ED5B5FF0      		LD	DE,(DTAX)
  E89E  C1            		POP	BC
  E89F  C9            		RET
                      	
  E8A0                	RBXB:
  E8A0  2A5FF0        		LD	HL,(DTAX)
  E8A3  ED5BFEF1      		LD	DE,(_CLPS)
  E8A7  3A5EF0        		LD	A,(LEFTX+1)
  E8AA  47            		LD	B,A
  E8AB  3A82E8        		LD	A,(SECSZ+2)	;1024=4 / 512=2 / 256=1
  E8AE                	RBXB1:
  E8AE  1F            		RRA		;->CF
  E8AF  3804          		JR	C,RBXB2
  E8B1  CB38          		SRL	B	;B=B/2
  E8B3  18F9          		JR	RBXB1
  E8B5                	RBXB2:
  E8B5  78            		LD	A,B
  E8B6  B7            		OR	A
  E8B7  C9            		RET
                      	
  E8B8                	RBXC:
  E8B8  ED4B5DF0      		LD	BC,(LEFTX)
  E8BC  3A82E8        		LD	A,(SECSZ+2)	;1024=4 / 512=2 / 256=1
  E8BF  3D            		DEC	A
  E8C0  A0            		AND	B
  E8C1  47            		LD	B,A		;1セクタ以下の端数がない場合はZ
  E8C2  B1            		OR	C
  E8C3  C9            		RET
                      	
  E8C4                	RBXEND:				;レコード数だけランダムレコードを進める
  E8C4  110000        		LD	DE,0		;進めるレコード数(RBSIZE)
  E8C5                	RBSIZE	EQU	$-2
  E8C7  CD12E6        		CALL	GET_RR_AHL
  E8CA  19            		ADD	HL,DE
  E8CB  CE00          		ADC	A,0
  E8CD  CD1CE6        		CALL	SET_RR_AHL
  E8D0  EB            		EX	DE,HL		;HL=進めるレコード数
  E8D1  D0            		RET	NC
  E8D2  FDCB207E      		BIT	7,(IY+32)	;(FCB)カレントレコード
  E8D6  C0            		RET	NZ
  E8D7  FD3424        		INC	(IY+36)
  E8DA  C9            		RET
                      	
  E8DB                	GET_RR_BCDE:			;BCDE=Random record
  E8DB  FD5E21        		LD	E,(IY+33)	;(FCB)ランダムレコード
  E8DE  FD5622        		LD	D,(IY+34)
  E8E1  FD4E23        		LD	C,(IY+35)
  E8E4  0600          		LD	B,0		;CP/M互換のアクセスの場合はFCBは36バイト
  E8E6  FDCB207E      		BIT	7,(IY+32)	;(FCB)カレントレコード
  E8EA  C0            		RET	NZ
  E8EB  FD4624        		LD	B,(IY+36)
  E8EE  C9            		RET
                      	
                      	;	ランダムブロックアクセスの連続したセクタをまとめる
                      	
  E8EF                	DWTC:
  E8EF  E5            		PUSH	HL
  E8F0  217FEC        		LD	HL,DWT24B
  E8F3  1804          		JR	DWTC1
  E8F5                	DRDC:
  E8F5  E5            		PUSH	HL
  E8F6  216FEC        		LD	HL,DRD24B
  E8F9                	DWTC1:
  E8F9  2253E9        		LD	(DRWF_MODE),HL
  E8FC  E1            		POP	HL
  E8FD  3A43E9        		LD	A,(DRWF_B)
  E900  B7            		OR	A
  E901  200F          		JR	NZ,DRDC1
  E903                	SAVE_DRWC:
  E903  0601          		LD	B,1
  E905  ED4342E9      		LD	(DRWF_C),BC
  E909  ED5349E9      		LD	(DRWF_E),DE
  E90D  224CE9        		LD	(DRWF_HL),HL
  E910  1820          		JR	INC_HL_DRWC
  E912                	DRDC1:
  E912  E5            		PUSH	HL
  E913  2149E9        		LD	HL,DRWF_E
  E916  86            		ADD	A,(HL)
  E917  F5            		PUSH	AF
  E918  BB            		CP	E
  E919  201D          		JR	NZ,DRDC2
  E91B  F1            		POP	AF
  E91C  23            		INC	HL
  E91D  7E            		LD	A,(HL)
  E91E  CE00          		ADC	A,0
  E920  F5            		PUSH	AF
  E921  BA            		CP	D
  E922  2014          		JR	NZ,DRDC2
  E924  F1            		POP	AF
  E925  3A42E9        		LD	A,(DRWF_C)
  E928  CE00          		ADC	A,0
  E92A  B9            		CP	C
  E92B  200C          		JR	NZ,DRDC3
  E92D  2143E9        		LD	HL,DRWF_B
  E930  34            		INC	(HL)
  E931  E1            		POP	HL
  E932                	INC_HL_DRWC:
  E932  3A82E8        		LD	A,(SECSZ+2)		;1セクタのサイズの上位1バイト
  E935  84            		ADD	A,H
  E936  67            		LD	H,A
  E937  C9            		RET
  E938                	DRDC2:
  E938  F1            		POP	AF
  E939                	DRDC3:
  E939  CD3FE9        		CALL	DRW_FLUSH
  E93C  E1            		POP	HL
  E93D  18C4          		JR	SAVE_DRWC
                      	
                      	;	ランダムブロックアクセスの連続したセクタをまとめたものをフラッシュする
  E93F                	DRW_FLUSH:
  E93F  C5            		PUSH	BC
  E940  D5            		PUSH	DE
  E941  010000        		LD	BC,0
  E942                	DRWF_C	EQU	$-2
  E943                	DRWF_B	EQU	$-1
  E944  78            		LD	A,B
  E945  B7            		OR	A
  E946  280D          		JR	Z,DRDF1
  E948  110000        		LD	DE,0
  E949                	DRWF_E	EQU	$-2
  E94A                	DRWF_D	EQU	$-1
  E94B  210000        		LD	HL,0
  E94C                	DRWF_HL	EQU	$-2
  E94E  AF            		XOR	A
  E94F  3243E9        		LD	(DRWF_B),A
  E952  CD6FEC        		CALL	DRD24B
  E953                	DRWF_MODE	EQU	$-2
  E955                	DRDF1:
  E955  D1            		POP	DE
  E956  C1            		POP	BC
  E957  C9            		RET
                      	
                      	;LDDIO.ASM
                      	
                      	;	LSX-Dodgers DIO
                      	
  E958                	DRDX:
  E958  CD96E9        		CALL	DRDY
  E95B  C8            		RET	Z
  E95C  CD7CE9        		CALL	DRDX1		;データバッファの情報を保存
  E95F  D8            		RET	C
  E960  E5            		PUSH	HL
  E961  C5            		PUSH	BC
  E962  D5            		PUSH	DE
  E963  2A7EF1        		LD	HL,(_DTBUF)
  E966  3ABFE9        		LD	A,(_DBS24+1)
  E969  4F            		LD	C,A
  E96A  CD6DEC        		CALL	DRD24
  E96D  DC91E9        		CALL	C,DRDNE
  E970                	POP_DE_BC_HL_RET:
  E970  D1            		POP	DE
  E971  C1            		POP	BC
  E972  E1            		POP	HL
  E973  C9            		RET
                      	
                      	;	CDE:セクタ番号
  E974                	DRDN:
  E974  AF            		XOR	A
  E975  00            	DRDN1:	NOP			;自己書き換え NOP / SCF
  E976  30E0          		JR	NC,DRDX
  E978                	DRDNX:
  E978  CD96E9        		CALL	DRDY
  E97B  C8            		RET	Z
  E97C                	DRDX1:
  E97C  CDACE9        		CALL	DWTX
                      					;データバッファの読み込んだドライブ・セクタ情報を保存
  E97F  ED53A6F0      		LD	(_DBSEC),DE
  E983  79            		LD	A,C
  E984  32BFE9        		LD	(_DBS24+1),A
                      	
  E987  3A88F0        		LD	A,(_DRV)
  E98A  32A5F0        		LD	(_DBDRV),A
  E98D  CDD9F0        		CALL	_CHGDRV
  E990  D0            		RET	NC
  E991                	DRDNE:
  E991  9F            		SBC	A,A		;CF=1ならばA=0FFH
  E992  32A5F0        		LD	(_DBDRV),A
  E995  C9            		RET
                      	
                      	;	CDE:セクタ番号
  E996                	DRDY:
  E996  3ABFE9        		LD	A,(_DBS24+1)
  E999  B9            		CP	C
  E99A  C0            		RET	NZ
                      	
  E99B  E5            		PUSH	HL
  E99C  3A88F0        		LD	A,(_DRV)
  E99F  21A5F0        		LD	HL,_DBDRV
  E9A2  AE            		XOR	(HL)
  E9A3  2005          		JR	NZ,POP_HL_RET
                      	
  E9A5  2AA6F0        		LD	HL,(_DBSEC)
  E9A8  ED52          		SBC	HL,DE		;CF=0
  E9AA                	POP_HL_RET:
  E9AA  E1            		POP	HL
  E9AB  C9            		RET
                      	
  E9AC                	DWTX:
  E9AC  3AA4F0        		LD	A,(_WTDBF)
  E9AF  B7            		OR	A
  E9B0  C8            		RET	Z
  E9B1  AF            		XOR	A
  E9B2  32A4F0        		LD	(_WTDBF),A
                      	
  E9B5  E5            		PUSH	HL
  E9B6  C5            		PUSH	BC
  E9B7  D5            		PUSH	DE
  E9B8  3AA5F0        		LD	A,(_DBDRV)
  E9BB  CDD9F0        		CALL	_CHGDRV
  E9BE  0E00          	_DBS24:	LD	C,0
  E9C0  ED5BA6F0      		LD	DE,(_DBSEC)
  E9C4  2A7EF1        		LD	HL,(_DTBUF)
  E9C7  D47DEC        		CALL	NC,DWT24
  E9CA                	POP_DE_BC_HL_RET2:
  E9CA  18A4          		JR	POP_DE_BC_HL_RET
                      	
  E9CC                	RDFATX:
  E9CC  E5            		PUSH	HL
  E9CD  3A88F0        		LD	A,(_DRV)
  E9D0  21AAF0        		LD	HL,_FATDRV
  E9D3  AE            		XOR	(HL)
  E9D4  28D4          		JR	Z,POP_HL_RET
                      	
  E9D6  C5            		PUSH	BC
  E9D7  D5            		PUSH	DE
  E9D8  DDE5          		PUSH	IX
  E9DA  CDF6E9        		CALL	WTFATX
  E9DD  3813          		JR	C,POP_IX_DE_BC_HL_RET
                      	
  E9DF  AF            		XOR	A
  E9E0  32ABF0        		LD	(_FATIX),A
  E9E3  3A88F0        		LD	A,(_DRV)
  E9E6  32AAF0        		LD	(_FATDRV),A
  E9E9  CDE5F0        		CALL	_RDFAT
  E9EC                	RDFATE2:
  E9EC  3004          		JR	NC,POP_IX_DE_BC_HL_RET
  E9EE  9F            		SBC	A,A		;A=0xFF
  E9EF  32AAF0        		LD	(_FATDRV),A
  E9F2                	POP_IX_DE_BC_HL_RET:
  E9F2  DDE1          		POP	IX
  E9F4  18D4          		JR	POP_DE_BC_HL_RET2
                      	
  E9F6                	WTFATX:
  E9F6  3AA2F0        		LD	A,(_WTFATF)
  E9F9  B7            		OR	A
  E9FA  C8            		RET	Z
  E9FB  E5            		PUSH	HL
  E9FC  3AAAF0        		LD	A,(_FATDRV)
  E9FF  21A5F0        		LD	HL,_DBDRV
  EA02  AE            		XOR	(HL)
  EA03  CCACE9        		CALL	Z,DWTX
  EA06  38A2          		JR	C,POP_HL_RET
  EA08  C5            		PUSH	BC
  EA09  D5            		PUSH	DE
  EA0A  DDE5          		PUSH	IX
  EA0C  CD8AEC        		CALL	WTFAT
  EA0F  AF            		XOR	A
  EA10  32A2F0        		LD	(_WTFATF),A
  EA13  18DD          		JR	POP_IX_DE_BC_HL_RET
                      	
  EA15                	NCL1:
  EA15  7A            		LD	A,D
  EA16  B3            		OR	E
  EA17  37            		SCF
  EA18  C8            		RET	Z
                      	
  EA19  7A            		LD	A,D
  EA1A  CB3F          		SRL	A	;/2
  EA1C  CB3F          		SRL	A	;/2
                      	
  EA1E  E5            		PUSH	HL
  EA1F  323EEA        		LD	(NCLPAT+2),A	;_FATIX
  EA22  2AAAF0        		LD	HL,(_FATDRV)	;L=_FATDRV H=_FATIX
  EA25  BC            		CP	H
  EA26  3A88F0        		LD	A,(_DRV)	;この間でフラグは変化しない
  EA29  323DEA        		LD	(NCLPAT+1),A	;_FATDRV
  EA2C  2005          		JR	NZ,NCL2		;FATIXが違う
  EA2E  BD            		CP	L
  EA2F  2002          		JR	NZ,NCL2		;ドライブが違う
  EA31  E1            		POP	HL
  EA32  C9            		RET
  EA33                	NCL2:
  EA33  C5            		PUSH	BC
  EA34  D5            		PUSH	DE
  EA35  DDE5          		PUSH	IX
  EA37  CDF6E9        		CALL	WTFATX
  EA3A  38B6          		JR	C,POP_IX_DE_BC_HL_RET
  EA3C  010000        	NCLPAT:	LD	BC,0		;自己書き換え C=_FATDRV B=_FATIX
  EA3F  ED43AAF0      		LD	(_FATDRV),BC
  EA43  CD5FEC        		CALL	RDFATS
  EA46  18A4          		JR	RDFATE2
                      	
  EA48                	NCL3:
  EA48  CB9A          		RES	3,D
  EA4A  CB92          		RES	2,D
  EA4C  6B            		LD	L,E
  EA4D  62            		LD	H,D
  EA4E  CB3C          		SRL	H	;
  EA50  CB1D          		RR	L	;HLA=HLA/2
  EA52  1F            		RRA		;
  EA53  F5            		PUSH	AF
  EA54  3AABF0        		LD	A,(_FATIX)
  EA57  0F            		RRCA
  EA58  300B          		JR	NC,NCL3X1
  EA5A  3A82E8        		LD	A,(SECSZ+2)
  EA5D  FE04          		CP	4		;1セクタ1024バイトの場合は奇数インデックスの場合に先頭を512バイトずらす
  EA5F  2004          		JR	NZ,NCL3X1
  EA61  010002        		LD	BC,512
  EA64  09            		ADD	HL,BC
  EA65                	NCL3X1:
  EA65  F1            		POP	AF
  EA66  ED4B7CF1      		LD	BC,(_FATBF)
  EA6A  19            		ADD	HL,DE
  EA6B  09            		ADD	HL,BC
  EA6C  17            		RLA
  EA6D  C9            		RET
                      	
  EA6E                	GNCL:
  EA6E  CD15EA        		CALL	NCL1		;GET NEXT CLUSTER
  EA71  D8            		RET	C
  EA72  C5            		PUSH	BC
  EA73  E5            		PUSH	HL
  EA74  CD48EA        		CALL	NCL3
  EA77  3809          		JR	C,GNC1
  EA79  5E            		LD	E,(HL)
  EA7A  23            		INC	HL
  EA7B  7E            		LD	A,(HL)
  EA7C  E60F          		AND	00FH
  EA7E  57            		LD	D,A
  EA7F  E1            		POP	HL
  EA80  C1            		POP	BC
  EA81  C9            		RET
  EA82                	GNC1:
  EA82  7E            		LD	A,(HL)
  EA83  23            		INC	HL
  EA84  56            		LD	D,(HL)
  EA85  0604          		LD	B,4
  EA87                	GNC1L:
  EA87  CB3A          		SRL	D	;DA=DA/2
  EA89  1F            		RRA		;
  EA8A  10FB          		DJNZ	GNC1L
                      	
  EA8C  5F            		LD	E,A
  EA8D  E1            		POP	HL
  EA8E  C1            		POP	BC
  EA8F  A7            		AND	A
  EA90  C9            		RET
                      	
  EA91                	SNCL:
  EA91  CD15EA        		CALL	NCL1
  EA94  D8            		RET	C
                      	;				SET NEXT CLUSTER
  EA95  E5            		PUSH	HL
  EA96  C5            		PUSH	BC
  EA97  D5            		PUSH	DE
  EA98  E5            		PUSH	HL
  EA99  CD48EA        		CALL	NCL3
  EA9C  D1            		POP	DE
                      	;CF=ODD
  EA9D  7E            		LD	A,(HL)
  EA9E  73            		LD	(HL),E
  EA9F  3806          		JR	C,SNC1
                      	;EVEN
                      	;M[0] = E
                      	;M[1] = (M[1] & 0xF0) | (D & 0x0F)
  EAA1  23            		INC	HL
  EAA2  ED67          		RRD		;M={A[3:0],E[3:0]}
  EAA4  7A            		LD	A,D
  EAA5  1804          		JR	SNC11
  EAA7                	SNC1:
                      	;ODD
                      	;HL[0] = (HL[0]&0x0F) | (E<<4)
                      	;HL[1] = DE>>4
  EAA7  ED6F          		RLD		;M={D[3:0],E[7:4]}
  EAA9  23            		INC	HL
  EAAA  72            		LD	(HL),D	;M={D[3:0],E[7:4]}
  EAAB                	SNC11:
  EAAB  ED6F          		RLD		;M={M[7:4],D[3:0]}
  EAAD  B7            		OR	A
  EAAE  D1            		POP	DE
  EAAF  C1            		POP	BC
  EAB0  E1            		POP	HL
  EAB1                	FAT_CHANGED:
  EAB1  3E01          		LD	A,1
  EAB3  32A2F0        		LD	(_WTFATF),A
  EAB6  C9            		RET
                      	
  EAB7                	N16CL3:
  EAB7  C5            		PUSH	BC
  EAB8  6B            		LD	L,E
  EAB9  7A            		LD	A,D
  EABA  E603          		AND	3
  EABC  67            		LD	H,A
  EABD  29            		ADD	HL,HL
  EABE  ED4B7CF1      		LD	BC,(_FATBF)
  EAC2  09            		ADD	HL,BC
  EAC3  C1            		POP	BC
  EAC4  C9            		RET
                      	
  EAC5                	GNCL16:
  EAC5  CD15EA        		CALL	NCL1		;GET NEXT CLUSTER for FAT16
  EAC8  D8            		RET	C
  EAC9  E5            		PUSH	HL
  EACA  CDB7EA        		CALL	N16CL3
  EACD  5E            		LD	E,(HL)
  EACE  23            		INC	HL
  EACF  56            		LD	D,(HL)
  EAD0  E1            		POP	HL
  EAD1  C9            		RET
                      	
  EAD2                	SNCL16:
  EAD2  CD15EA        		CALL	NCL1		;GET NEXT CLUSTER for FAT16
  EAD5  D8            		RET	C
  EAD6  D5            		PUSH	DE
  EAD7  E5            		PUSH	HL
  EAD8  CDB7EA        		CALL	N16CL3
  EADB  D1            		POP	DE		;HL
  EADC  73            		LD	(HL),E
  EADD  23            		INC	HL
  EADE  72            		LD	(HL),D
  EADF  6B            		LD	L,E
  EAE0  62            		LD	H,D
  EAE1  D1            		POP	DE
  EAE2  18CD          		JR	FAT_CHANGED
                      	
                      	;------------------------
                      	;次のセクタを探す際に_SECPSの値をチェック
                      	;in
                      	;	DE : セクタ番号
                      	;out
                      	;	DE : 次のセクタ番号
                      	;note
                      	;
                      	;------------------------
  EAE4                	NEXTX:
  EAE4  3E00          	_SECPS:	LD	A,0	;自己書き換え
  EAE6  3C            		INC	A
  EAE7  E600          	NCPAT:	AND	0	;自己書き換え　1クラスタの論理セクタ数-1
  EAE9  32E5EA        		LD	(_SECPS+1),A
  EAEC  C9            		RET
                      	
  EAED                	GNCLX:
  EAED  CDE4EA        		CALL	NEXTX
  EAF0  C0            		RET	NZ	;1クラスタのセクタ未満の場合は戻る
  EAF1  C3F7F0        		JP	_GNCL	;次のクラスタを探す
                      	
  EAF4                	RDFAT:
  EAF4  3E80          		LD	A,080H
  EAF6  3270F0        		LD	(CHECK),A
  EAF9                	RDFAT1:
  EAF9  3A88F0        		LD	A,(_DRV)
  EAFC  CDB4ED        		CALL	CHGDRVR
  EAFF  D8            		RET	C
  EB00  DD7E12        		LD	A,(IX+DPB_DEVICE)
  EB03  CB6F          		BIT	5,A
  EB05  286B          		JR	Z,RDFAT0X
  EB07  2170F0        		LD	HL,CHECK
  EB0A  A6            		AND	(HL)
  EB0B  77            		LD	(HL),A
  EB0C  110000        		LD	DE,0		;BPB
  EB0F  2A7CF1        		LD	HL,(_FATBF)
  EB12  CD6BEC        		CALL	DRD16
  EB15  3024          		JR	NC,GETBPB
  EB17  2170F0        		LD	HL,CHECK
  EB1A  CB06          		RLC	(HL)
  EB1C  3F            		CCF
  EB1D  D8            		RET	C
  EB1E  DDCB0A1E      		RR	(IX+DPB_FDMODE)
  EB22  3F            		CCF			;フロッピーディスクのFDモードを切り替える
  EB23  DDCB0A16      		RL	(IX+DPB_FDMODE)
  EB27  3EFF          		LD	A,0FFH
  EB29  3289F0        		LD	(_DSK),A
  EB2C  3A84F0        		LD	A,(_DRIVE)
  EB2F  E603          		AND	3
  EB31  F680          		OR	080H
  EB33  6F            		LD	L,A
  EB34  26F0          		LD	H,_CYL0/256
  EB36  3EFF          		LD	A,0FFH
  EB38  77            		LD	(HL),A
  EB39  18BE          		JR	RDFAT1
  EB3B                	GETBPB:
  EB3B  FDE5          		PUSH	IY
  EB3D  FD2A7CF1      		LD	IY,(_FATBF)	;BPB
  EB41  CDF1F0        		CALL	_BPB2DPB
  EB44  FDE1          		POP	IY
  EB46  DD7E12        		LD	A,(IX+DPB_DEVICE)
  EB49  3021          		JR	NC,GETBPBOK
  EB4B  E60F          		AND	00FH
  EB4D  FE07          		CP	7
  EB4F  37            		SCF
  EB50  C0            		RET	NZ
  EB51  DDCB0A46      		BIT	0,(IX+DPB_FDMODE)
  EB55  21C0F1        		LD	HL,M2D
  EB58  2002          		JR	NZ,SETFDMODE
  EB5A  2ED2          		LD	L,M2HD-STABLE
  EB5C                	SETFDMODE:
  EB5C  DDE5          		PUSH	IX
  EB5E  D1            		POP	DE
  EB5F  EDA0          		LDI
  EB61  EDA0          		LDI
  EB63  13            		INC	DE
  EB64  13            		INC	DE
  EB65  13            		INC	DE
  EB66  13            		INC	DE
  EB67  010C00        		LD	BC,12
  EB6A  EDB0          		LDIR
  EB6C                	GETBPBOK:
  EB6C  327BEB        		LD	(DEVSWC),A
  EB6F  CD13ED        		CALL	CHGDRV2
  EB72                	RDFAT0X:
  EB72  CD5FEC        		CALL	RDFATS
  EB75  D8            		RET	C
  EB76  DDAE06        		XOR	(IX+DPB_FATID)
  EB79  C8            		RET	Z
  EB7A  3E00          		LD	A,0		;DPB_DEVICE
  EB7B                	DEVSWC	EQU	$-1
  EB7C  CB6F          		BIT	5,A
  EB7E  C0            		RET	NZ		;BPBを取得している場合はFATIDをチェックしない
  EB7F  37            		SCF
  EB80  C9            		RET
                      	
  EB81                	BPB2DPB:
  EB81  FD7E0B        		LD	A,(IY+11)	;BPB_BytsPerSec
  EB84  B7            		OR	A
  EB85  37            		SCF
  EB86  C0            		RET	NZ
  EB87                	BPBOK:
  EB87  FD7E0D        		LD	A,(IY+13)	;BPB_SecPerClus
  EB8A  DD7707        		LD	(IX+DPB_SECPCL),A
                      	
  EB8D  FD7E16        		LD	A,(IY+22)	;BPB_FATSz16
  EB90  DD7700        		LD	(IX+DPB_FATLN),A
  EB93  FD7E17        		LD	A,(IY+23)	;BPB_FATSz16
  EB96  DD7701        		LD	(IX+DPB_FATLN+1),A
                      	
  EB99  FD6E0E        		LD	L,(IY+14)	;BPB_RsvdSecCnt
  EB9C  FD660F        		LD	H,(IY+15)
  EB9F  DD750E        		LD	(IX+DPB_FATPS),L
  EBA2  FD5E16        		LD	E,(IY+22)	;BPB_FATSz16
  EBA5  FD5617        		LD	D,(IY+23)
  EBA8  FD4610        		LD	B,(IY+16)	;BPB_NumFATs
  EBAB                	BPBDP1:				;BPB_FATSz16 * BPB_NumFATs
  EBAB  19            		ADD	HL,DE
  EBAC  10FD          		DJNZ	BPBDP1
  EBAE                	BPBDP2:
  EBAE  DD7510        		LD	(IX+DPB_DIRPS),L
  EBB1  DD7411        		LD	(IX+DPB_DIRPS+1),H
  EBB4  E5            		PUSH	HL
                      	
  EBB5  FD6E11        		LD	L,(IY+17)	;BPB_RootEntCnt
  EBB8  FD6612        		LD	H,(IY+18)
  EBBB  FD7E0C        		LD	A,(IY+12)	;BPB_BytsPerSec
  EBBE  B7            		OR	A
  EBBF  37            		SCF
  EBC0  C8            		RET	Z
  EBC1  0606          		LD	B,6
  EBC3                	BPBBPS1:
  EBC3  05            		DEC	B
  EBC4  0F            		RRCA
  EBC5  30FC          		JR	NC,BPBBPS1
  EBC7                	BPBDE1:
  EBC7  29            		ADD	HL,HL
  EBC8  10FD          		DJNZ	BPBDE1
                      	
  EBCA  7C            		LD	A,H
  EBCB  DD770B        		LD	(IX+DPB_DIRSCNT),A	;
                      	
  EBCE  D1            		POP	DE		;DPB_DIRPS
  EBCF  6C            		LD	L,H
  EBD0  2600          		LD	H,0
  EBD2  19            		ADD	HL,DE		;MAXDIR
  EBD3  E5            		PUSH	HL
  EBD4  FD4E0D        		LD	C,(IY+13)	;BPB_SecPerClus
  EBD7  CB21          		SLA	C		;*2
  EBD9  AF            		XOR	A
  EBDA  47            		LD	B,A
  EBDB  ED42          		SBC	HL,BC
  EBDD  DD7514        		LD	(IX+DPB_ADDCL),L
  EBE0  DD7415        		LD	(IX+DPB_ADDCL+1),H
                      	
  EBE3  D1            		POP	DE		;DE=DPB_MAXDIR
  EBE4  FD6E13        		LD	L,(IY+19)	;BPB_TotSec16
  EBE7  FD6614        		LD	H,(IY+20)
                      	
  EBEA  DD7E12        		LD	A,(IX+DPB_DEVICE)
  EBED  E60F          		AND	00FH
  EBEF  FE07          		CP	7		;フロッピー
  EBF1  2019          		JR	NZ,NOT_FD
  EBF3  E5            		PUSH	HL
  EBF4  FD4E18        		LD	C,(IY+24)	;BPB_SecPerTr
  EBF7  DD710D        		LD	(IX+DPB_MAXSEC),C
  EBFA  AF            		XOR	A
  EBFB  CB21          		SLA	C		;両面なのでセクタ数を２倍
  EBFD  0610          		LD	B,16
  EBFF                	DIVSEC:				;MAXCYL = BPB_TotSec16 / (BPB_SecPerTr * 2)
  EBFF  29            		ADD	HL,HL
  EC00  17            		RLA
  EC01  B9            		CP	C
  EC02  3802          	   	JR	C,DIVSEC1
  EC04  91            	   	SUB	C
  EC05  2C            		INC	L
  EC06                	DIVSEC1:
  EC06  10F7          	 	DJNZ	DIVSEC
  EC08  DD750C        		LD	(IX+DPB_MAXCYL),L
  EC0B  E1            		POP	HL	;ここまでフロッピー専用
  EC0C                	NOT_FD:
  EC0C  7C            		LD	A,H
  EC0D  B5            		OR	L
  EC0E  3E00          		LD	A,0		;LDでフラグは変化しない。BPB_TotSec16を AHL で扱う為、Aに0を入れる
  EC10  2010          		JR	NZ,BPB16BIT	;BPB_TotSec16が「0」の場合はBPB_TotSec32で計算
  EC12  FD7E23        		LD	A,(IY+35)	;念のために総セクタ数が24ビットを超える場合はエラーを返す
  EC15  B7            		OR	A
  EC16  37            		SCF
  EC17  C0            		RET	NZ
  EC18  FD6E20        		LD	L,(IY+32)	;BPB_TotSec32 は AHL の24ビットで扱う
  EC1B  FD6621        		LD	H,(IY+33)	;1クラスタの論理セクタ数(DPB_SECPCL)が最大128なので
  EC1E  FD7E22        		LD	A,(IY+34)	;24ビットを超えると必ずクラスタ数が16ビットを超えてしまうのでこれで十分
  EC21  A7            		AND	A		;CF=0
  EC22                	BPB16BIT:
  EC22  ED52          		SBC	HL,DE
  EC24  DE00          		SBC	A,0
  EC26  FD460D        		LD	B,(IY+13)	;BPB_SecPerClus
  EC29                	BPBTC1:				;総クラスタ数(AHL) = 総セクタ数(AHL) / セクタサイズ(B)
  EC29  CB18          		RR	B		;->CY
  EC2B  3808          		JR	C,BPBTC2
  EC2D  CB3F          		SRL	A
  EC2F  CB1C          		RR	H		;AHL=AHL/2
  EC31  CB1D          		RR	L
  EC33  18F4          		JR	BPBTC1
  EC35                	BPBTC2:
  EC35  B7            		OR	A
  EC36  37            		SCF
  EC37  C0            		RET	NZ		;念のため(クラスタ数が16ビットを超える場合)
  EC38  23            		INC	HL
  EC39  23            		INC	HL
  EC3A  DD7508        		LD	(IX+DPB_MAXCL),L
  EC3D  DD7409        		LD	(IX+DPB_MAXCL+1),H
                      	
  EC40  FD7E15        		LD	A,(IY+21)	;BPB_Media
  EC43  DD7706        		LD	(IX+DPB_FATID),A
                      	
  EC46  FD7E10        		LD	A,(IY+16)	;BPB_NumFATs
  EC49  C6FE          		ADD	A,0-2		;>2:CF=1
  EC4B  FD7E0C        		LD	A,(IY+12)	;BPB_BytsPerSec
  EC4E  6F            		LD	L,A
  EC4F  3002          		JR	NC,BPBFAT1
  EC51  F680          		OR	080H
  EC53                	BPBFAT1:			;ここではCF=0
  EC53  DD770F        		LD	(IX+DPB_BPS),A
  EC56  2D            		DEC	L		;以下のセクタサイズに合致しない場合はCF=1でエラーにする
  EC57  C8            		RET	Z		;1セクタ256バイト
  EC58  2D            		DEC	L
  EC59  C8            		RET	Z		;1セクタ512バイト
  EC5A  2D            		DEC	L
  EC5B  2D            		DEC	L
  EC5C  C8            		RET	Z		;1セクタ1024バイト
  EC5D  37            		SCF
  EC5E  C9            		RET
                      	
  EC5F                	RDFATS:
  EC5F  CDA5EC        		CALL	FATSETUP
  EC62  D8            		RET	C
  EC63  CD6FEC        		CALL	DRD24B
  EC66  2A7CF1        		LD	HL,(_FATBF)
  EC69  7E            		LD	A,(HL)
  EC6A  C9            		RET
                      	
  EC6B                	DRD16:
  EC6B  0E00          		LD	C,0
  EC6D                	DRD24:
  EC6D  0601          		LD	B,1
  EC6F                	DRD24B:
  EC6F  DDE5          		PUSH	IX
  EC71  DD2AA8F0      		LD	IX,(_DPB)
  EC75  CDCFEE        	DRDPAT:	CALL	FDRD		;自己書き換え（ディスク読み込み）
  EC78                	POP_IX_RET:
  EC78  DDE1          		POP	IX
  EC7A  C9            		RET
                      	
  EC7B                	DWT16:
  EC7B  0E00          		LD	C,0
  EC7D                	DWT24:
  EC7D  0601          		LD	B,1
  EC7F                	DWT24B:
  EC7F  DDE5          		PUSH	IX
  EC81  DD2AA8F0      		LD	IX,(_DPB)
  EC85  CDC1EE        	DWTPAT:	CALL	FDWT		;自己書き換え（ディスク書き込み）
  EC88  18EE          		JR	POP_IX_RET
                      	
  EC8A                	WTFAT:
  EC8A  CDA5EC        		CALL	FATSETUP
  EC8D  D47FEC        		CALL	NC,DWT24B
  EC90  D8            		RET	C
  EC91  DDCB0F7E      		BIT	7,(IX+DPB_BPS)
  EC95  C8            		RET	Z		;予備FATが無い
  EC96  CDACEC        		CALL	FATS2
  EC99  E5            		PUSH	HL		;予備FAT
  EC9A  DD6E00        		LD	L,(IX+DPB_FATLN)
  EC9D  DD6601        		LD	H,(IX+DPB_FATLN+1)
  ECA0  19            		ADD	HL,DE
  ECA1  EB            		EX	DE,HL
  ECA2  E1            		POP	HL
  ECA3  18DA          		JR	DWT24B
                      	;------------------------
                      	;FATのセットアップ
                      	;out
                      	;	B  : FATセクタ数
                      	;	DE : FAT先頭セクタ番号
                      	;	HL : FATバッファポインタ
                      	;	CF : 1=ドライブ切り替えエラー
                      	;note
                      	;	FATサイズがFATバッファを超える場合は
                      	;	対象クラスタ領域==(_FATIX)によって
                      	;	FAT12:対象クラスタ1024毎に1.5KBを切り替える
                      	;	FAT16:対象クラスタ1024毎に2KBを切り替える
                      	;------------------------
  ECA5                	FATSETUP:
  ECA5  3AAAF0        		LD	A,(_FATDRV)
  ECA8  CDB4ED        		CALL	CHGDRVR		;ドライブ切り替え
  ECAB  D8            		RET	C
  ECAC                	FATS2:
  ECAC  DD7E0F        		LD	A,(IX+DPB_BPS)	;512=2 1024=4
  ECAF  0F            		RRCA
  ECB0  CDD9EC        	FATSX:	CALL	FATSETUP12	;自己書き換え
  ECB3  210000        		LD	HL,0
  ECB6  4A            		LD	C,D
  ECB7  54            		LD	D,H
  ECB8  3AABF0        		LD	A,(_FATIX)	;範囲FAT12:0-3/FAT16:0-63(0-03FH):65535*2/2048
  ECBB  47            		LD	B,A
  ECBC  04            		INC	B
  ECBD  DD7E00        		LD	A,(IX+DPB_FATLN)
  ECC0                	FAT_SKP:
  ECC0  05            		DEC	B
  ECC1  2805          		JR	Z,FAT1
  ECC3  19            		ADD	HL,DE
  ECC4  93            		SUB	E
  ECC5  30F9          		JR	NC,FAT_SKP
  ECC7  C9            		RET
  ECC8                	FAT1:
  ECC8  EB            		EX	DE,HL
  ECC9  B9            		CP	C		;C=FATバッファに読み込めるセクタ数
  ECCA  3801          		JR	C,FAT2
  ECCC  79            		LD	A,C
  ECCD                	FAT2:
  ECCD  47            		LD	B,A
                      	
  ECCE  2AFAF1        		LD	HL,(_FATPS)	;fat sector pos
  ECD1  19            		ADD	HL,DE
  ECD2  EB            		EX	DE,HL
  ECD3  2A7CF1        		LD	HL,(_FATBF)
  ECD6  AF            		XOR	A		;CF=0
  ECD7  4F            		LD	C,A
  ECD8  C9            		RET
                      	;
                      	;	FATバッファに読み込める最大のセクタ数と_FATIXで進めるセクタ数
                      	;	FATSETUP* (FAT12/FAT16)
                      	;out
                      	;	D : FATバッファに読み込める最大のセクタ数
                      	;	E : _FATIXで進めるセクタ数
  ECD9                	FATSETUP12:
  ECD9  110606        		LD	DE,0606H	;256
  ECDC  D8            		RET	C
  ECDD  110303        		LD	DE,0303H	;512
  ECE0  0F            		RRCA
  ECE1  D8            		RET	C
  ECE2  110102        		LD	DE,0201H	;1024
  ECE5  C9            		RET
                      	
  ECE6                	FATSETUP16:
  ECE6  110808        		LD	DE,0808H	;256
  ECE9  D8            		RET	C
  ECEA  110404        		LD	DE,0404H
  ECED  0F            		RRCA			;512
  ECEE  D8            		RET	C
  ECEF  110202        		LD	DE,0202H	;1024
  ECF2  C9            		RET
                      	
  ECF3                	CHGDRV:
  ECF3  E5            		PUSH	HL
  ECF4  2189F0        		LD	HL,_DSK
  ECF7  BE            		CP	(HL)
  ECF8  280A          		JR	Z,CHGDRVE
  ECFA                	CHGDRV1:
  ECFA  DDE5          		PUSH	IX
  ECFC  CD06ED        		CALL	CHGDRV0
  ECFF  3A89F0        		LD	A,(_DSK)
  ED02  DDE1          		POP	IX
  ED04                	CHGDRVE:
  ED04  E1            		POP	HL
  ED05  C9            		RET
                      	
  ED06                	CHGDRV0:
  ED06  6F            		LD	L,A
  ED07  CDDCF0        		CALL	_GETDPB
  ED0A  D8            		RET	C
  ED0B  DD22A8F0      		LD	(_DPB),IX
  ED0F  7D            		LD	A,L
  ED10  3289F0        		LD	(_DSK),A
  ED13                	CHGDRV2:
  ED13  C5            		PUSH	BC
  ED14  D5            		PUSH	DE
  ED15  ED736AED      		LD	(SPPAT2+1),SP
  ED19  F3            		DI
  ED1A  DDF9          		LD	SP,IX
                      	
  ED1C  E1            		POP	HL		;00:DPB_FATLN
  ED1D  E1            		POP	HL		;02:DPB_DRD
  ED1E  2276EC        		LD	(DRDPAT+1),HL
                      	
  ED21  E1            		POP	HL
  ED22  2286EC        		LD	(DWTPAT+1),HL	;04:DPB_DWT
                      	
  ED25  E1            		POP	HL		;L=06:DPB_FATID H=07:DPB_SECPCL
  ED26  7C            		LD	A,H
  ED27  3272E3        		LD	(SPCPAT+1),A	;1クラスタの論理セクタ数
  ED2A  3D            		DEC	A
  ED2B  32E8EA        		LD	(NCPAT+1),A
                      	
  ED2E  E1            		POP	HL		;08:DPB_MAXCL
  ED2F  7D            		LD	A,L
  ED30  3291E3        		LD	(CLPAT2+1),A
  ED33  7C            		LD	A,H
  ED34  328DE3        		LD	(CLPAT1+1),A
  ED37  2B            		DEC	HL
  ED38  2299E5        		LD	(MAXCLP+1),HL
                      	
  ED3B  E1            		POP	HL		;L=0A:DPB_FDMODE H=0B:DPB_DIRSCNT
  ED3C  7D            		LD	A,L
  ED3D  F6FE          		OR	0FEH
  ED3F  326AEE        		LD	(FDMODE+1),A
  ED42  07            		RLCA
  ED43  E603          		AND	3
  ED45  3252EE        		LD	(FSPAT+1),A
  ED48  4C            		LD	C,H
                      	
  ED49  E1            		POP	HL		;L=0C:DPB_MAXCYL H=0D:DPB_MAXSEC
                      	
  ED4A  E1            		POP	HL		;L=0E:DPB_FATPS H=0F:DPB_BPS
  ED4B  7C            		LD	A,H		;DPB_BPS
  ED4C  E607          		AND	7
  ED4E  3282E8        		LD	(SECSZ+2),A	;1セクタのサイズの上位1バイト 0x400 - 0x200 - 0x100
                      					;1セクタ512 2D/2DD/2HC/2HQ(2HD1.44MB)/EMM/BRAM/EMEM等
                      					;1セクタ1024 2HD/2HDE98
                      					;1セクタ256 GRAM/RAMF/CMOS/等
                      					;1024	512	256
                      					;4	2	1
  ED51  87            		ADD	A,A		;8	4	2
  ED52  87            		ADD	A,A		;010H	8	4
  ED53  87            		ADD	A,A		;020H	010H	8
  ED54  32EEE1        		LD	(SDECPAT+1),A	;1セクタ辺りのディレクトリエントリ数
                      	
  ED57  2600          		LD	H,0
  ED59  22FAF1        		LD	(_FATPS),HL
                      	
  ED5C  E1            		POP	HL		;10:DPB_DIRPS
  ED5D  22FCF1        		LD	(_DIRPS),HL
                      	
  ED60  E1            		POP	HL		;L=12:DPB_DEVICE H=13:DPB_UNITNO
  ED61  7C            		LD	A,H
  ED62  3284F0        		LD	(_DRIVE),A
                      	
  ED65  E1            		POP	HL		;14:DPB_ADDCL
  ED66  2282E3        		LD	(CLSPAT+1),HL
                      	
  ED69  310000        	SPPAT2:	LD	SP,0		;元のSPを復元
  ED6C  FB            		EI
  ED6D  2AFCF1        		LD	HL,(_DIRPS)
  ED70  0600          		LD	B,0
  ED72  09            		ADD	HL,BC		;C=DPB_DIRSCNT
  ED73  2209E2        		LD	(MD_PAT+1),HL
                      	
  ED76  2A99E5        		LD	HL,(MAXCLP+1);
  ED79  11F60F        		LD	DE,4086		;クラスタ数が4086未満:FAT12 4086以上:FAT16
  ED7C  ED52          		SBC	HL,DE		;CF=0のはず
  ED7E  300F          		JR	NC,SETFAT16
  ED80  216EEA        		LD	HL,GNCL		;FAT12
  ED83  1191EA        		LD	DE,SNCL
  ED86  01D9EC        		LD	BC,FATSETUP12
  ED89  DDCB0FAE      		RES	5,(IX+DPB_BPS)	;DPB_BPS(FAT12)
  ED8D  180D          		JR	EXTRA1
  ED8F                	SETFAT16:
  ED8F  21C5EA        		LD	HL,GNCL16	;FAT16
  ED92  11D2EA        		LD	DE,SNCL16
  ED95  01E6EC        		LD	BC,FATSETUP16
  ED98  DDCB0FEE      		SET	5,(IX+DPB_BPS)	;DPB_BPS(FAT16)
  ED9C                	EXTRA1:
  ED9C  22F8F0        		LD	(GNCPAT+1),HL
  ED9F  ED53FBF0      		LD	(SNCPAT+1),DE
  EDA3  ED43B1EC      		LD	(FATSX+1),BC
  EDA7  D1            		POP	DE
  EDA8  C1            		POP	BC
  EDA9  AF            		XOR	A
  EDAA  C9            		RET
                      	
  EDAB                	GETDPBD:
  EDAB  DDE3          		EX	(SP),IX
  EDAD  DDE5          		PUSH	IX
  EDAF  3A88F0        		LD	A,(_DRV)
  EDB2  1807          		JR	GETDPB1
                      	
  EDB4                	CHGDRVR:
  EDB4  CDD9F0        		CALL	_CHGDRV
  EDB7  D8            		RET	C
  EDB8  3A89F0        		LD	A,(_DSK)
  EDBB                	GETDPB1:
  EDBB  C3DCF0        		JP	_GETDPB
                      	
  EDBE                	GETDPB:
  EDBE  FE08          		CP	8
  EDC0  3F            		CCF
  EDC1  D8            		RET	C
  EDC2  0F            		RRCA
  EDC3  0F            		RRCA
  EDC4  0F            		RRCA
  EDC5  DD            		DB	0DDH		;Z80未定義命令
  EDC6  6F            		LD	L,A		;LD	IXL,A
  EDC7  DD            		DB	0DDH		;Z80未定義命令
  EDC8  26F2          		LD	H,_DEVICE/256	;LD	IXH,_DEVICE/256
  EDCA  DD7E00        		LD	A,(IX+DPB_FATLN)
  EDCD  A7            		AND	A		;CF=0の為
  EDCE  DDCB0F6E      		BIT	5,(IX+DPB_BPS)
  EDD2  C0            		RET	NZ		;FAT16
  EDD3  DDCB126E      		BIT	5,(IX+DPB_DEVICE)
  EDD7  C0            		RET	NZ		;BPB
  EDD8  FE01          		CP	001H		;A=0 THEN CF=1
  EDDA  C9            		RET
                      	
  EDDB                	_SYS5F:
  EDDB  AF            		XOR	A
  EDDC                	FFLUSH:
  EDDC  F5            		PUSH	AF
  EDDD  CDF6E9        		CALL	WTFATX
  EDE0  AF            		XOR	A
  EDE1  32ABF0        		LD	(_FATIX),A
  EDE4  2F            		CPL			;0FFH
  EDE5  32AAF0        		LD	(_FATDRV),A
  EDE8  3E            		DB	03EH		;次のPUSH AFをスキップ
  EDE9                	FFLUSHBUF:
  EDE9  F5            		PUSH	AF
  EDEA  CDACE9        		CALL	DWTX
  EDED  3EFF          		LD	A,0FFH
  EDEF  3239F0        		LD	(SFILE),A
  EDF2  32A5F0        		LD	(_DBDRV),A
  EDF5  F1            		POP	AF
  EDF6  C9            		RET
                      	
                      	
                      	;X1DISK.ASM
                      	
                      	;	LSX-Dodgers DISK
                      	;	X1/turbo/Z
                      	
  EDF7                	SEEK:
  EDF7  0610          		LD	B,16
  EDF9  DD4E0D        		LD	C,(IX+DPB_MAXSEC)
  EDFC  AF            		XOR	A
  EDFD  EB            		EX	DE,HL
  EDFE                	DIV1:
  EDFE  29            		ADD	HL,HL
  EDFF  8F            		ADC	A,A
  EE00  B9            		CP	C
  EE01  3802          		JR	C,DIV2
  EE03  91            		SUB	C
  EE04  2C            		INC	L
  EE05                	DIV2:
  EE05  10F7          		DJNZ	DIV1
                      	
  EE07  3C            		INC	A	;最小のセクタは１固定
  EE08  55            		LD	D,L	;TRACK
  EE09  5F            		LD	E,A	;SECTOR
  EE0A  CB3A          		SRL	D	;CYLINDER
  EE0C  9F            		SBC	A,A
  EE0D  E610          		AND	010H	;SIDE
  EE0F  4F            		LD	C,A
                      	
  EE10  3A84F0        		LD	A,(_DRIVE)
  EE13  FE04          		CP	4
  EE15  3F            		CCF
  EE16  D8            		RET	C
  EE17  B1            		OR	C
  EE18  3296EE        		LD	(MOPAT+1),A	;Motor off data
  EE1B  01FC0F        		LD	BC,00FFCH
  EE1E  F680          		OR	080H		;Motor on
  EE20  ED79          		OUT	(C),A
                      	
  EE22  CD68EE        		CALL	SETMODE
  EE25  D8            		RET	C
                      	
  EE26  CDABEE        		CALL	DRIVE
  EE29  FEFF          		CP	0FFH		;A=0FFH Unknown CYLINDER
  EE2B  CC8AEE        		CALL	Z,FDCRES	;Restore
  EE2E  0EF9          		LD	C,0F9H
  EE30  ED79          		OUT	(C),A		;Currrent CYLINDER
  EE32  92            		SUB	D
  EE33  C8            		RET	Z		;No seek
                      	
  EE34  3A86F0        		LD	A,(_ISEEK)
  EE37  4F            		LD	C,A
                      	
  EE38  DD7E0C        		LD	A,(IX+DPB_MAXCYL)
  EE3B  3D            		DEC	A
  EE3C  BA            		CP	D		;Over CYLINDER
  EE3D  D8            		RET	C
                      	
  EE3E  B9            		CP	C		;for Built-in 2DD
  EE3F  3803          		JR	C,SETM2
  EE41  78            		LD	A,B		;B=00FH
  EE42  DBFE          		IN	A,(0FEH)		;2HD mode for 2DD seek
  EE44                	SETM2:
  EE44  78            		LD	A,B
  EE45  DBFD          		IN	A,(0FDH)		;MFM mode
                      	
  EE47  0EFB          		LD	C,0FBH
  EE49  ED51          		OUT	(C),D
  EE4B  72            		LD	(HL),D
  EE4C  0E18          		LD	C,018H		;Seek
  EE4E                	FDCCMD2:
  EE4E  3A85F0        		LD	A,(_SEEKSP)
  EE51  E6FF          	FSPAT:	AND	0FFH
  EE53  B1            		OR	C
                      	
  EE54                	FDCCMD:
  EE54  CDA1EE        		CALL	COMSET
                      	
  EE57  3E80          	FDCPAT:	LD	A,080H		;FDC COMMAND(Self-modifying code)
  EE59  E620          		AND	020H		;Write data Write track
  EE5B  3C            		INC	A
                      	
  EE5C                	SST:
  EE5C  0E00          		LD	C,0
  EE5E                	SST1:
  EE5E  0D            		DEC	C		; 4
  EE5F  20FD          		JR	NZ,SST1		;12 * 256 / 4 = About 1ms
  EE61  3D            		DEC	A
  EE62  20FA          		JR	NZ,SST1
                      	
  EE64  3C            		INC	A		;A=1
  EE65  CD73EE        		CALL	READY
  EE68                	SETMODE:
  EE68  78            		LD	A,B		;B=00FH
  EE69  DBFF          	FDMODE:	IN	A,(0FFH)	;Floppy mode(2D/2HD) (Self-modifying code)
                      	
  EE6B  78            		LD	A,B
  EE6C  DBFD          		IN	A,(0FDH)	;MFM mode
                      	
  EE6E  CDA5EE        		CALL	DELAY0		;Head select time
  EE71  3E81          		LD	A,081H
  EE73                	READY:
  EE73  327DEE        		LD	(WAITA+1),A
  EE76  E5            		PUSH	HL
  EE77  0EF8          		LD	C,0F8H
  EE79  61            		LD	H,C
  EE7A                	READY2:
  EE7A  ED78          		IN	A,(C)
  EE7C  E681          	WAITA:	AND	081H		;NOT READY,BUSY
  EE7E  2808          		JR	Z,READYE
  EE80  E3            		EX	(SP),HL		;wait 19clock
  EE81  E3            		EX	(SP),HL		; //
  EE82  2B            		DEC	HL
  EE83  7C            		LD	A,H
  EE84  B5            		OR	L
  EE85  20F3          		JR	NZ,READY2
  EE87  37            		SCF
  EE88                	READYE:
  EE88  E1            		POP	HL
  EE89  C9            		RET
                      	
  EE8A                	FDCRES:
  EE8A  3600          		LD	(HL),0
  EE8C  0E08          		LD	C,8
  EE8E  18BE          		JR	FDCCMD2
                      	
  EE90                	FDMOFF:
  EE90  F5            		PUSH	AF
  EE91  C5            		PUSH	BC
  EE92  01FC0F        		LD	BC,00FFCH	;Motor off
  EE95  3E00          	MOPAT:	LD	A,000H		;(Self-rewriting)
  EE97  ED79          		OUT	(C),A
  EE99  C1            		POP	BC
  EE9A  F1            		POP	AF
  EE9B  C9            		RET
                      	
  EE9C                	SECSET:
  EE9C  01FA0F        		LD	BC,00FFAH
  EE9F  ED59          		OUT	(C),E
  EEA1                	COMSET:
  EEA1  0EF8          		LD	C,0F8H
  EEA3  ED79          		OUT	(C),A
  EEA5                	DELAY0:
  EEA5  3E1A          		LD	A,26
  EEA7                	DELAY:
  EEA7  3D            		DEC	A
  EEA8  20FD          		JR	NZ,DELAY
  EEAA  C9            		RET
                      	
  EEAB                	DRIVE:
  EEAB  2A84F0        		LD	HL,(_DRIVE)
  EEAE  26F0          		LD	H,_CYL0/256
  EEB0  CBFD          		SET	7,L
  EEB2  7E            		LD	A,(HL)
  EEB3  C9            		RET
                      	
  EEB4                	RNF:
  EEB4  CDABEE        		CALL	DRIVE
  EEB7  36FF          		LD	(HL),0FFH
  EEB9  C9            		RET
                      	
  EEBA  02            	RETRY:	DB	2
                      	
                      	
                      	;	FLOPPY DISK DRIVER(DMA)
                      	
                      	
  EEBB                	WTTRK:
  EEBB  0601          		LD	B,1
  EEBD  3EF4          		LD	A,0F4H
  EEBF  1802          		JR	WTTRK1
  EEC1                	FDWT:
  EEC1  3EA0          		LD	A,0A0H
  EEC3                	WTTRK1:
  EEC3  3258EE        		LD	(FDCPAT+1),A
  EEC6  3E10          		LD	A,16
  EEC8  180C          		JR	DISK
                      	
  EECA                	DISKOK:
  EECA  0601          	FDCNT:	LD	B,1
  EECC  100B          		DJNZ	DISK1
  EECE  C9            		RET
                      	
  EECF                	FDRD:
  EECF  3E80          		LD	A,080H
  EED1  3258EE        		LD	(FDCPAT+1),A
  EED4  3E0E          		LD	A,14
                      	
  EED6                	DISK:
  EED6  32EDEE        		LD	(DMAPAT+1),A
  EED9                	DISK1:
  EED9  78            		LD	A,B
  EEDA  32CBEE        		LD	(FDCNT+1),A
  EEDD  2245EF        		LD	(DMAD+11),HL
  EEE0                	DISKR:
  EEE0  3E02          		LD	A,2		;Retry count
  EEE2  32BAEE        		LD	(RETRY),A
  EEE5                	DISK2:
  EEE5  D5            		PUSH	DE
  EEE6  CDF7ED        		CALL	SEEK
  EEE9  3843          		JR	C,ERRF
  EEEB  F3            		DI
                      	
  EEEC  3E0E          	DMAPAT:	LD	A,14		;自己書き換え
  EEEE  213AEF        		LD	HL,DMAD
  EEF1  CD8FDF        		CALL	SETDMA
  EEF4  ED49          		OUT	(C),C		;OUT 01F87H,087H WR6 イネーブル
  EEF6  3A58EE        		LD	A,(FDCPAT+1)
  EEF9  C5            		PUSH	BC
  EEFA  CD9CEE        		CALL	SECSET
  EEFD  2A45EF        		LD	HL,(DMAHL)
  EF00  23            		INC	HL
  EF01  1106BB        		LD	DE,0BB06H	;READ DMA
                      	
  EF04  3E03          		LD	A,3
  EF06  CD73EE        		CALL	READY
  EF09  ED78          		IN	A,(C)
                      	
  EF0B  C1            		POP	BC
  EF0C  ED51          		OUT	(C),D		;読み出しマスク設定
  EF0E  ED59          		OUT	(C),E		;バイトカウンタ(LH)
  EF10  ED58          		IN	E,(C)
  EF12  ED50          		IN	D,(C)
  EF14  19            		ADD	HL,DE
  EF15  D1            		POP	DE
  EF16  13            		INC	DE
  EF17  FB            		EI
  EF18  CD90EE        		CALL	FDMOFF
  EF1B  B7            		OR	A
  EF1C  28AC          		JR	Z,DISKOK
  EF1E  1B            		DEC	DE
  EF1F  CB67          		BIT	4,A
  EF21  C4B4EE        		CALL	NZ,RNF
  EF24                	DISKE2:
  EF24  21BAEE        		LD	HL,RETRY
  EF27  35            		DEC	(HL)
  EF28  20BB          		JR	NZ,DISK2
  EF2A  B7            		OR	A
  EF2B  280A          		JR	Z,ERR
  EF2D  D5            		PUSH	DE
  EF2E                	ERRF:
  EF2E  D1            		POP	DE
  EF2F                	DELP:
  EF2F  CDB4EE        		CALL	RNF
  EF32  CD90EE        		CALL	FDMOFF
  EF35  3EFF          		LD	A,0FFH
  EF37                	ERR:
  EF37  BF            		CP	A
  EF38  37            		SCF
  EF39  C9            		RET
                      	
                      				;X1turbo DISK DMA
  EF3A  C3            	DMAD:	DB	0C3H	;WR6 リセット
  EF3B  7D            		DB	07DH	;WR0 ポートA→ポートB 転送
  EF3C  FB0F          		DW	00FFBH	;ポートA開始アドレス FDC データレジスタ
  EF3E  FFFF          		DW	0FFFFH	;ブロック長(転送サイズ-1)
  EF40  2C            		DB	02CH	;WR1 ポートAアドレス固定 I/O
  EF41  10            		DB	010H	;WR2 ポートBインクリメント
  EF42  80            		DB	080H	;WR3
  EF43  92            		DB	092H	;WR5 WAIT RDY:LOW
  EF44  8D            		DB	08DH	;WR4 バイト ポートB開始アドレス(LH)
  EF45  0000          	DMAHL:	DW	0	;ポートB開始アドレス
  EF47  CF            		DB	0CFH	;WR6 ロード
  EF48  01            		DB	001H	;WR0 ポートB←ポートB 転送
  EF49  CF            		DB	0CFH	;WR6 ロード
                      	
  EF4A                	DMAE:
                      	
  1E1A                	AT_R	EQU	WTTRK-AT_DWT
  EF4A                	AT_TABLE:
                      	
                      	;LDCCPWK.ASM
                      	
                      	;	LSX-Dodgers CCP WORK
                      	
  0040                	PATHX	EQU	64
  EF4A                	PATHD:	DS	PATHX
  EF8A  00            	PATHE:	DB	0
                      	
  EF8B                	DTA_CCP:
  EF8B                		DS	37
                      	
  EFB0                	FCB_BAT:
  EFB0                		DS	37
                      	
                      	
  EFD5  20627974657320	FREE:	DB	" bytes free",9,'$'
                      	
                      	;LDWORK.ASM
                      	
                      	;	LSX-Dodgers WORK0
                      	;
                      	;	CP/M互換BIOS
                      	;	BOOT:アドレス下位1バイトが0になるように
  EFE2                	AT_WORK:
  EFE2                		DS	WORKAD-AT_WORK
                      	
  F000                	CPM_BOOT:
  F000  C30000        		JP	0
  F003                	_SYS00:		;(BDOS)プログラム終了
  F003                	CPM_WBOOT:
  F003  C309D2        		JP	WBOOT1
  F006                	CPM_CONST:
  F006  C33DDC        		JP	CONSTX
  F009                	_SYS07:		;(BDOS)コンソール直接入力
  F009                	CPM_CONIN:
  F009  C3E4DB        		JP	FLGET
  F00C                	CPM_CONOUT:
  F00C  C382DE        		JP	CONOUT1
                      	
  F00F                	DECBF:				;10進数表示時のバッファ(5バイト)
  F00F                		DS	5
  F00F                	RR_BUF_HL	EQU	DECBF	;CP/M互換ファイルアクセスの際のランダムレコードの一時的な保管場所
  F011                	RR_BUF_A	EQU	DECBF+2	;計3バイト
                      	
  F014  00            	FDRV:	DB	0
  F015                	FNAME:	DS	36
  F039                	SFILE:	DS	33		;DRV FILENAME
                      	
  F05A                		DS	3
                      	
  F05D  0000          	LEFTX:	DW	0
  F05F  0000          	DTAX:	DW	0
                      	
  F061                	ZERO:
  F061                	BEEPD:
  F061  008E01000B000C		DB	0,08EH,1,0,00BH,0,00CH,010H
  F069  073E08100D00FF		DB	007H,03EH,008H,010H,00DH,0,0FFH
  F062                	RTC_YY	EQU	BEEPD+1
  F063                	RTC_MW	EQU	BEEPD+2
  F064                	RTC_DD	EQU	BEEPD+3
  F065                	RTC_TT	EQU	BEEPD+4
  F066                	RTC_MM	EQU	BEEPD+5
  F067                	RTC_SS	EQU	BEEPD+6
  F062                	ROM_SLT	EQU	BEEPD+1
                      	
  F070  00            	CHECK:	DB	0
                      	
  F071  4F4B24        	OK:	DB	"OK$"
  F074                		DS	5
  F079  4572726F722124	COMERM:	DB	"Error!$"
                      	;	システムワークエリア
                      	;	_CYL0:アドレス下位1バイトが080Hになるように
  F080  FF            	_CYL0:	DB	0FFH	;Cylinder
  F081  FF            	_CYL1:	DB	0FFH	;Cylinder
  F082  FF            	_CYL2:	DB	0FFH	;Cylinder
  F083  FF            	_CYL3:	DB	0FFH	;Cylinder
  F084  00            	_DRIVE:	DB	0	;unit number
  F085  00            	_SEEKSP:DB	0	;Seek speed
  F086  FF            	_ISEEK:	DB	0FFH	;
  F087  00            	_DVSW:	DB	0
  F088  00            	_DRV:	DB	0
  F089  FF            	_DSK:	DB	0FFH
  F08A  8000          	_DTA:	DW	00080H
  F08C  0000          	_CTC:	DW	0
  F08E  0000          	_TXADR:	DW	0
  F090  0000          	_KEYPS:	DW	0
  F092  00FF          	_KEYD:	DW	0FF00H	;キーデータ
  F094  C210          	_KEYSP:	DB	KEYSP_L,KEYSP_H	;オートリピートの速度
  F096  07            	_COLORF:DB	COLORF	;色
  F097  18            	_LINE:	DB	LINE
                      	
  F098  0000          	_FCB:	DW	0	;SEARCH FILES
  F09A  0000          	_FBPS:	DW	0	;    //
  F09C  0000          	_FBAD:	DW	0	;    //
  F09E  00            	_FBCNT:	DB	0	;    //
  F09F  00            	_FILEN:	DB	0	;    //
  F0A0  00            	_DIRF:	DB	0	;bit7:ディレクトリ bit0-6:セクタインデックス
  F0A1                		DS	1
  F0A2  00            	_WTFATF:DB	0	;FATバッファの更新フラグ
  F0A3                		DS	1
  F0A4  00            	_WTDBF:	DB	0	;データバッファの更新フラグ
  F0A5  FF            	_DBDRV:	DB	0FFH	;データバッファにあるデータを読み込んだドライブ
  F0A6  0000          	_DBSEC:	DW	0	;データバッファにあるデータを読み込んだセクタ番号
  F0A8  0000          	_DPB:	DW	0
  F0AA                	_FATDRV:
  F0AA  FF            		DB	0FFH	;FATバッファに読み込んでいるドライブ
  F0AB  00            	_FATIX:	DB	0	;FATバッファに読み込んでいるインデックス
  F0AC                	_FAKEFREE:
  F0AC  0000          		DW	0	;偽の残量（FATサイズが大きくなると重くなるのでその対策）
                      	
  F0AE                		DS	2
                      	
  F0B0                	CRTCD:
  F0B0  6F            		DB	06FH
  F0B1                	_WIDTH:
  F0B1  50            		DB	WIDTH
  F0B2                	TVRAMTOP:
  F0B2  5938          		DB	059H,038H
  F0B4  1F02          		DB	01FH,002H
  F0B6                	_LINE2:
  F0B6  19            		DB	019H
  F0B7                	WKE4:
  F0B7  1C            		DB	01CH
  F0B8                	WKE6:
  F0B8  00            		DB	000H
  F0B9                	WK40:
  F0B9  07            		DB	007H
  F0BA                	_PAGE_MINUS:
  F0BA  80F8          		DW	0-WIDTH*LINE
  F0BC                	_WIDTH_MINUS:
  F0BC  B0FF          		DW	0-WIDTH
  F0BE                	WK30:
  F0BE  0C            		DB	00CH
  F0BF                	WK31:
  F0BF                	WK1FD0:
  F0BF  20            		DB	020H
                      	
  F0C0  2DDB          	CTC0:	DW	INTCTCE
  F0C2  2DDB          	CTC1:	DW	INTCTCE
  F0C4  30DB          	CTC2:	DW	INTCTC2
  F0C6  2DDB          	CTC3:	DW	INTCTCE
  F0C8  19DB          	INTVEC:	DW	INT
                      	
                      	;	LSX-Dodgers 独自BIOS
                      	
  F0CA  C365E0        	_INKEY:	JP	INKEY
  F0CD  C31DDD        	_PRINT:	JP	PRINT
  F0D0  C3CDDF        	_SCRN:	JP	SCRN
  F0D3  C3F7DF        	_POS:	JP	POS
  F0D6  C34BDE        	_LOC:	JP	LOC
  F0D9                	_CHGDRV:
  F0D9  C3F3EC        		JP	CHGDRV
  F0DC                	_GETDPB:
  F0DC  C3BEED        		JP	GETDPB
  F0DF                	_FFLUSH:
  F0DF  C3DCED        		JP	FFLUSH
  F0E2                	_RDFATX:
  F0E2  C3CCE9        		JP	RDFATX
  F0E5  C3F4EA        	_RDFAT:	JP	RDFAT
  F0E8  C3BBEE        	_WTTRK:	JP	WTTRK
  F0EB  C3CFEE        	_FDRD:	JP	FDRD
  F0EE  C3C1EE        	_FDWT:	JP	FDWT
  F0F1                	_BPB2DPB:
  F0F1  C381EB        		JP	BPB2DPB
  F0F4                	_BREAK:
  F0F4  C3C2D3        		JP	END_BATCH
  F0F7                	_GNCL:
  F0F7  C36EEA        	GNCPAT:	JP	GNCL		; self-modifying code
  F0FA                	_SNCL:
  F0FA  C391EA        	SNCPAT:	JP	SNCL		; self-modifying code
  F0FD  C37CD2        	_COMANL:JP	COMANL
                      	
  F100                	_WE:
                      	
                      	;LDCALL.ASM
                      	
                      	;	LSX-Dodgers システムコール(BDOS)
                      	;
                      	;	LSX-Dodgers SYSTEM CALL
                      	;	STABLE:アドレス下位1バイトが0になるように
                      	
  F100                	STABLE:
                      	;0
  F100  03F0B7DBC3DB1B		DW	_SYS00,_SYS01,_SYS02,_SYS03
  F108  5FD85FD8C8DB09		DW	_SYS04,_SYS05,_SYS06,_SYS07
  F110  D0DB61D809DC35		DW	_SYS08,_SYS09,_SYS0A,_SYS0B
  F118  76D87BD88AD89B		DW	_SYS0C,_SYS0D,_SYS0E,_SYS0F
                      	;1
  F120  EFD836D97FD9B5		DW	_SYS10,_SYS11,_SYS12,_SYS13
  F128  BDD9D3D9E8D9E0		DW	_SYS14,_SYS15,_SYS16,_SYS17
  F130  2FDA34DA39DA3F		DW	_SYS18,_SYS19,_SYS1A,_SYS1B
  F138  5FD865DA5FD869		DW	_SYS1C,_SYS1D,_SYS1E,_SYS1F
                      	;2
  F140  5FD81FDA27DA70		DW	_SYS20,_SYS21,_SYS22,_SYS23
  F148  96DA5FD8A0E678		DW	_SYS24,_ERROR,_SYS26,_SYS27
  F150  27DA9FDA4BDC1B		DW	_SYS28,_SYS29,_SYS2A,_SYS2B
  F158  6EDC1BE25FD8C0		DW	_SYS2C,_SYS2D,_SYS2E,_SYS2F
                      	;3
  F160  BADA5FD85FD85F		DW	_SYS30,_ERROR,_ERROR,_ERROR
  F168  5FD85FD85FD85F		DW	_ERROR,_ERROR,_ERROR,_ERROR
  F170  5FD81BE21BE2E1		DW	_ERROR,_SYS39,_SYS3A,_SYS5A
                      	;DOS2
  F178  42D8          		DW	_DOS2
                      	
  F17A                		DS	2
  F17C  00F3          	_FATBF:	DW	FATBF
  F17E  00FB          	_DTBUF:	DW	DTBUF
                      	
                      	;	コントロールコードテーブル
                      	;	CTRLTB:アドレス下位1バイトが080Hになるように
                      	
  F180                	CTRLTB:
  F180  C0DDC0DDFCDD41		DW	CTRL00,CTRL00,CTRL02,CTRL03	;  A,B,C
  F188  3BDF20DE1ADFA3		DW	CTRL04,CTRL05,CTRL06,CTRL07	;D,E,F,G
  F190  CCDDEDDD44DF61		DW	CTRL08,CTRL09,CTRL0A,CTRL0B	;H,I,J,K
  F198  17DF46DE59DFC0		DW	CTRL0C,CTRL0D,CTRL0E,CTRL00	;L,M,N,O
  F1A0  C0DDC0DD59DEC0		DW	CTRL00,CTRL00,CTRL12,CTRL00	;P,Q,R,S
  F1A8  C0DDC0DDC0DDC0		DW	CTRL00,CTRL00,CTRL00,CTRL00	;T,U,V,W
  F1B0  C0DDC0DD17DF68		DW	CTRL00,CTRL00,CTRL0C,CTRL1B	;X,Y,Z,ESC
  F1B8  E7DDD3DDDCDD44		DW	CTRL1C,CTRL1D,CTRL1E,CTRL1F	;→,←,↑,↓
                      	
  F1C0  0200          	M2D:	DW	2
  F1C2  FD02          		DB	0FDH,2
  F1C4  6401          		DW	356
  F1C6  FF0728090182  		DB	0FFH,7,40,9,1,082H
  F1CC  0500A7000800  		DW	5,0A7H,8
                      	
  F1D2  0200          	M2HD:	DW	2
  F1D4  FE01          		DB	0FEH,1
  F1D6  C704          		DW	1223
  F1D8  FE064D080184  		DB	0FEH,6,77,8,1,084H
  F1DE  0500A7000900  		DW	5,0A7H,9
                      	
  F1E4  1617          	SDDATA:	DB	22,23		;(FCB)ファイルを最後に変更した時刻
  F1E6  1415          		DB	20,21		;(FCB)ファイルを最後に変更した日付
  F1E8  1A1B          		DB	26,27		;(FCB)ファイルの先頭クラスタ
  F1EA  10111213      		DB	16,17,18,19	;(FCB)ファイルのサイズ(バイト単位)
  F1EE                	SDDATAE:
                      	
  F1EE                		DS	2
  F1F0                	_FCB_BAT:
  F1F0  B0EF          		DW	FCB_BAT
  F1F2                	_PATH:
  F1F2  4AEF          		DW	PATHD
                      	
  F1F4                	SCDIR:	DS	2		;+14 +15
  F1F6                	SFBPS:	DS	2		;FBPS
  F1F8                	SFNDF:	DS	2		;FILEN DIRF
                      	
  F1FA  0000          	_FATPS:	DW	0
  F1FC  0000          	_DIRPS:	DW	0
  F1FE  0000          	_CLPS:	DW	0
                      	
  F200                	_PE:
                      	
                      	;X1DPB.ASM
                      	
                      	;	LSX-Dodgers DPB
                      	;	X1/turbo/Z
                      	
  F200                	_DEVICE:
                      	
                      	;	A:
                      	
  F200  0200          		DW	2	;DPB_FATLN
  F202  EBF0          		DW	_FDRD	;DPB_DRD
  F204  EEF0          		DW	_FDWT	;DPB_DWT
  F206  FD            		DB	0FDH	;DPB_FATID
  F207  02            		DB	2	;DPB_SECPCL
  F208  6401          		DW	356	;DPB_MAXCL
  F20A  FF            		DB	0FFH	;DPB_FDMODE	0FFH=2D / 0FEH=2HD
  F20B  07            		DB	7	;DPB_DIRSCNT
  F20C  28            		DB	40	;DPB_MAXCYL
  F20D  09            		DB	9	;DPB_MAXSEC	Number of sectors
  F20E  01            		DB	1	;DPB_FATPS
  F20F  82            		DB	082H	;DPB_BPS
  F210  0500          		DW	5	;DPB_DIRPS
  F212  A7            		DB	0A7H	;DPB_DEVICE	Device Number
  F213  00            		DB	0	;DPB_UNITNO
  F214  0800          		DW	8	;DPB_ADDCL
  F216  0000          		DW	0	;DPB_16
  F218  0000          		DW	0	;DPB_18
  F21A  0000          		DW	0	;DPB_SDIR
  F21C  46444430      		DB	"FDD0"	;DPB_NAME
                      	
                      	;	B:
                      	
  F220  0200          		DW	2	;DPB_FATLN
  F222  EBF0          		DW	_FDRD	;DPB_DRD
  F224  EEF0          		DW	_FDWT	;DPB_DWT
  F226  FD            		DB	0FDH	;DPB_FATID
  F227  02            		DB	2	;DPB_SECPCL
  F228  6401          		DW	356	;DPB_MAXCL
  F22A  FF            		DB	0FFH	;DPB_FDMODE	0FFH=2D / 0FEH=2HD
  F22B  07            		DB	7	;DPB_DIRSCNT
  F22C  28            		DB	40	;DPB_MAXCYL
  F22D  09            		DB	9	;DPB_MAXSEC	Number of sectors
  F22E  01            		DB	1	;DPB_FATPS
  F22F  82            		DB	082H	;DPB_BPS
  F230  0500          		DW	5	;DPB_DIRPS
  F232  A7            		DB	0A7H	;DPB_DEVICE	Device Number
  F233  01            		DB	1	;DPB_UNITNO
  F234  0800          		DW	8	;DPB_ADDCL
  F236  0000          		DW	0	;DPB_16
  F238  0000          		DW	0	;DPB_18
  F23A  0000          		DW	0	;DPB_SDIR
  F23C  46444431      		DB	"FDD1"	;DPB_NAME
                      	
                      	;	C:
                      	
  F240  0200          		DW	2	;DPB_FATLN
  F242  EBF0          		DW	_FDRD	;DPB_DRD
  F244  EEF0          		DW	_FDWT	;DPB_DWT
  F246  FD            		DB	0FDH	;DPB_FATID
  F247  02            		DB	2	;DPB_SECPCL
  F248  6401          		DW	356	;DPB_MAXCL
  F24A  FF            		DB	0FFH	;DPB_FDMODE	0FFH=2D / 0FEH=2HD
  F24B  07            		DB	7	;DPB_DIRSCNT
  F24C  28            		DB	40	;DPB_MAXCYL
  F24D  09            		DB	9	;DPB_MAXSEC	Number of sectors
  F24E  01            		DB	1	;DPB_FATPS
  F24F  82            		DB	082H	;DPB_BPS
  F250  0500          		DW	5	;DPB_DIRPS
  F252  A7            		DB	0A7H	;DPB_DEVICE	Device Number
  F253  02            		DB	2	;DPB_UNITNO
  F254  0800          		DW	8	;DPB_ADDCL
  F256  0000          		DW	0	;DPB_16
  F258  0000          		DW	0	;DPB_18
  F25A  0000          		DW	0	;DPB_SDIR
  F25C  46444432      		DB	"FDD2"	;DPB_NAME
                      	
                      	;	D:
                      	
  F260  0200          		DW	2	;DPB_FATLN
  F262  EBF0          		DW	_FDRD	;DPB_DRD
  F264  EEF0          		DW	_FDWT	;DPB_DWT
  F266  FD            		DB	0FDH	;DPB_FATID
  F267  02            		DB	2	;DPB_SECPCL
  F268  6401          		DW	356	;DPB_MAXCL
  F26A  FF            		DB	0FFH	;DPB_FDMODE	0FFH=2D / 0FEH=2HD
  F26B  07            		DB	7	;DPB_DIRSCNT
  F26C  28            		DB	40	;DPB_MAXCYL
  F26D  09            		DB	9	;DPB_MAXSEC	Number of sectors
  F26E  01            		DB	1	;DPB_FATPS
  F26F  82            		DB	082H	;DPB_BPS
  F270  0500          		DW	5	;DPB_DIRPS
  F272  A7            		DB	0A7H	;DPB_DEVICE
  F273  03            		DB	3	;DPB_UNITNO
  F274  0800          		DW	8	;DPB_ADDCL
  F276  0000          		DW	0	;DPB_16
  F278  0000          		DW	0	;DPB_18
  F27A  0000          		DW	0	;DPB_SDIR
  F27C  46444433      		DB	"FDD3"	;DPB_NAME
                      	
                      	;	E:
                      	
  F280  0000          	EMMFL:	DW	0	;DPB_FATLN
  F282  E8D7          	EMMRD:	DW	EDRD	;DPB_DRD
  F284  E4D7          	EMMWR:	DW	EDWT	;DPB_DWT
  F286  FE            		DB	0FEH	;DPB_FATID
  F287  02            		DB	2	;DPB_SECPCL
  F288  0000          	EMMCL:	DW	0	;DPB_MAXCL
  F28A  00            		DB	0	;DPB_FDMODE
  F28B  0C            		DB	12	;DPB_DIRSCNT
  F28C  00            		DB	0	;DPB_MAXCYL
  F28D  00            		DB	0	;DPB_MAXSEC
  F28E  02            		DB	2	;DPB_FATPS
  F28F  02            		DB	2	;DPB_BPS
  F290  0A00          		DW	10	;DPB_DIRPS
  F292  06            	EMMDV:	DB	6	;DPB_DEVICE
  F293  00            		DB	0	;DPB_UNITNO
  F294  1200          		DW	18	;DPB_ADDCL
  F296  0000          		DW	0	;DPB_16
  F298  0000          		DW	0	;DPB_18
  F29A  0000          		DW	0	;DPB_SDIR
  F29C  454D4D30      		DB	"EMM0"	;DPB_NAME
                      	
                      	;	F:
                      	
  F2A0  0000          	BANKFL:	DW	0	;DPB_FATLN
  F2A2  7CD7          		DW	BDRD	;DPB_DRD
  F2A4  78D7          		DW	BDWT	;DPB_DWT
  F2A6  F9            		DB	0F9H	;DPB_FATID
  F2A7  02            		DB	2	;DPB_SECPCL
  F2A8  0000          	BANKCL:	DW	0	;DPB_MAXCL
  F2AA  00            		DB	0	;DPB_FDMODE
  F2AB  08            		DB	8	;DPB_DIRSCNT
  F2AC  00            		DB	0	;DPB_MAXCYL
  F2AD  01            		DB	1	;DPB_MAXSEC
  F2AE  00            		DB	0	;DPB_FATPS
  F2AF  02            		DB	2	;DPB_BPS
  F2B0  0200          		DW	2	;DPB_DIRPS
  F2B2  0B            	BANKDV:	DB	00BH	;DPB_DEVICE
  F2B3  00            		DB	0	;DPB_UNITNO
  F2B4  0600          		DW	6	;DPB_ADDCL
  F2B6  0000          		DW	0	;DPB_16
  F2B8  0000          		DW	0	;DPB_18
  F2BA  0000          		DW	0	;DPB_SDIR
  F2BC  4252414D      		DB	"BRAM"	;DPB_NAME
                      	
                      	;	G:
                      	
  F2C0  0200          		DW	2	;DPB_FATLN
  F2C2  39D7          		DW	GDRD	;DPB_DRD
  F2C4  50D7          		DW	GDWT	;DPB_DWT
  F2C6  FA            		DB	0FAH	;DPB_FATID
  F2C7  01            		DB	1	;DPB_SECPCL
  F2C8  B800          		DW	184	;DPB_MAXCL
  F2CA  00            		DB	0	;DPB_FDMODE
  F2CB  07            		DB	7	;DPB_DIRSCNT
  F2CC  00            		DB	0	;DPB_MAXCYL
  F2CD  01            		DB	1	;DPB_MAXSEC
  F2CE  01            		DB	1	;DPB_FATPS
  F2CF  01            		DB	1	;DPB_BPS
  F2D0  0300          		DW	3	;DPB_DIRPS
  F2D2  05            		DB	5	;DPB_DEVICE
  F2D3  01            		DB	1	;DPB_UNITNO
  F2D4  0800          		DW	8	;DPB_ADDCL
  F2D6  0000          		DW	0	;DPB_16
  F2D8  0000          		DW	0	;DPB_18
  F2DA  0000          		DW	0	;DPB_SDIR
  F2DC  4752414D      		DB	"GRAM"	;DPB_NAME
                      	
                      	;	H:
  F2E0                		DS	32-8
  F2F8  00            		DB	0
                      	
                      	
  F2F9                	LAST_ADR:
                      	
  F2F9                		END
