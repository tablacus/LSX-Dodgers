			  Z80 ASSEMBLER - ZASM VER 1.6
                      	;	LSX-Dodgers for X1/turbo/Z
                      	;	Programmed by
                      	;	Gaku (Lovers/Tablacus)
                      	
  C600                	RUN	EQU	0C600h
                      	
  C5F9                		ORG	RUN-7
                      	
                      	;	MSX BINARY HEADER
  C5F9  FE            		DB	0FEH
                      	;	MSX BINARY START ADDRESS
  C5FA  00C6          		DW	RUN
                      	;	MSX BINARY END ADDRESS
  C5FC  E0ED          		DW	LDEND
                      	;	MSX BINARY EXEC ADDRESS
  C5FE  00C6          		DW	RUN
                      	;LDDEF.ASM
                      	
                      	;	LSX-Dodgers DEF
                      	
  1D80                	MAC	EQU	01D80H		;X1
  0001                	VER_1   EQU 1
  0002                	VER_2   EQU 2
  0008                	VER_3   EQU 8
  0128                	VER	EQU	VER_1 * 256 + VER_2 * 16 + VER_3
                      	
  0000                	STACK	EQU	00000H
  0005                	SYSTEM	EQU	00005H
  000F                	JP_HL	EQU	0000FH
  005C                	FCB1	EQU	0005CH
  006C                	FCB2	EQU	0006CH
  0080                	DTA1	EQU	00080H
  00DB                	FDRV	EQU	00100H-37
  00DC                	FNAME	EQU	FDRV+1
  00D6                	DECBF	EQU	FDRV-5
  EE00                	FATBF	EQU	0EE00H
  FA00                	DTBUF	EQU	0FA00H
  FE00                	KEYBF	EQU	0FE00H
  FF00                	KBUF	EQU	0FF00H
  FF51                	DTA	EQU	KBUF+81
  FFD4                	EXTSP	EQU	0FFD4H
  0018                	LINE	EQU	24
                      	
                      	;LDINIT.ASM
                      	
                      	;	LSX-Dodgers INIT
                      	
  C600  C307C6        		JP	START
  C603  801D          	MACHINE:DW	MAC
  C605  2801          	VERSION:DW	VER
                      	
  C607                	START:
  C607  F3            		DI
  C608  ED5E          		IM	2
  C60A  310000        		LD	SP,STACK
  C60D  3E1E          		LD	A,01EH
  C60F  D300          		OUT	(0),A
                      	
  C611  010000        		LD	BC,0
  C614  ED438CEC      		LD	(_CTC),BC
  C618  01040A        		LD	BC,00A04H
  C61B  CD63C9        		CALL	CHKCTC
  C61E  010407        		LD	BC,00704H
  C621  CD63C9        		CALL	CHKCTC
  C624  01A81F        		LD	BC,01FA8H
  C627  CD63C9        		CALL	CHKCTC
  C62A  01A01F        		LD	BC,01FA0H
  C62D  CD63C9        		CALL	CHKCTC
                      	;
  C630                	INISIO:
  C630  01911F        		LD	BC,01F91H	;INIT SIO
  C633  1601          		LD	D,1
  C635  ED51          		OUT	(C),D
                      	;	OUT	(C),0		;未定義命令ニーモニック
  C637  ED71          		DB	0EDH,071H
  C639  0E93          		LD	C,093H
  C63B  ED51          		OUT	(C),D
                      	;	OUT	(C),0		;未定義命令ニーモニック
  C63D  ED71          		DB	0EDH,071H
  C63F  0E99          		LD	C,099H		;INIT SIO
  C641  1601          		LD	D,1
  C643  ED51          		OUT	(C),D
                      	;	OUT	(C),0		;未定義命令ニーモニック
  C645  ED71          		DB	0EDH,071H
  C647  0E9B          		LD	C,09BH
  C649  ED51          		OUT	(C),D
                      	;	OUT	(C),0		;未定義命令ニーモニック
  C64B  ED71          		DB	0EDH,071H
                      	
  C64D  0E80          		LD	C,080H		;INIT DMA
  C64F  2106C3        		LD	HL,0C306H
  C652                	INIDMA:
  C652  ED61          		OUT	(C),H
  C654  2D            		DEC	L
  C655  20FB          		JR	NZ,INIDMA
                      	
  C657  3EE4          		LD	A,0E4H
  C659  CD57DA        		CALL	COMOUT
  C65C  AF            		XOR	A
  C65D  CD31DA        		CALL	OT49SB
                      	
  C660  3EEC          		LD	A,INTVEC/256
  C662  ED47          		LD	I,A
                      	
  C664  ED4B8CEC      		LD	BC,(_CTC)
  C668  0B            		DEC	BC
  C669  0B            		DEC	BC
                      	
                      	;	OUT	(C),0		;未定義命令ニーモニック
  C66A  ED71          		DB	0EDH,071H
  C66C  3EC0          		LD	A,CTC0
  C66E  ED79          		OUT	(C),A
                      	
  C670  0C            		INC	C
  C671  3E47          		LD	A,047H
  C673  ED79          		OUT	(C),A
  C675  3E0D          		LD	A,13		;Baudrate 9600-13
  C677  ED79          		OUT	(C),A
                      	
  C679  79            		LD	A,C
  C67A  D610          		SUB	010H
  C67C  4F            		LD	C,A
  C67D  ED43BAD6      		LD	(SIOAD+1),BC
  C681  ED43E3D6      		LD	(SIOAD0+1),BC
  C685  ED43E9D6      		LD	(SIOAD1+1),BC
                      	
  C689  210CCA        		LD	HL,SIODATA
  C68C                	SINIT1:
  C68C  7E            		LD	A,(HL)
  C68D  23            		INC	HL
  C68E  FEFF          		CP	0FFH
  C690  2804          		JR	Z,SINIT2
  C692  ED79          		OUT	(C),A
  C694  18F6          		JR	SINIT1
  C696                	SINIT2:
  C696  3EE4          		LD	A,0E4H
  C698  CD57DA        		CALL	COMOUT
  C69B  3EC8          		LD	A,INTVEC
  C69D  CD31DA        		CALL	OT49SB
                      	;
  C6A0  01C41F        		LD	BC,01FC4H
  C6A3  3E0C          		LD	A,00CH
  C6A5  ED79          		OUT	(C),A
                      	
  C6A7  0EC0          		LD	C,0C0H
                      	;	OUT	(C),0		;未定義命令ニーモニック
  C6A9  ED71          		DB	0EDH,071H
                      	
  C6AB  0C            		INC	C
  C6AC  3E28          		LD	A,40
  C6AE  ED79          		OUT	(C),A
                      	
  C6B0  0C            		INC	C
                      	;	OUT	(C),0		;未定義命令ニーモニック
  C6B1  ED71          		DB	0EDH,071H
                      	
  C6B3  0C            		INC	C
                      	;	OUT	(C),0		;未定義命令ニーモニック
  C6B4  ED71          		DB	0EDH,071H
                      	
  C6B6  0EC5          		LD	C,0C5H
                      	;	OUT	(C),0		;未定義命令ニーモニック
  C6B8  ED71          		DB	0EDH,071H
                      	
  C6BA                	TEXT:
  C6BA  0EB0          		LD	C,0B0H
  C6BC  3E80          		LD	A,080H
  C6BE  ED79          		OUT	(C),A
  C6C0  1607          		LD	D,7
  C6C2  0EB9          		LD	C,0B9H
  C6C4  2105CA        		LD	HL,TEXTDT
  C6C7                	TEXT1:
  C6C7  04            		INC	B
  C6C8  EDA3          		OUTI
  C6CA  0C            		INC	C
  C6CB  15            		DEC	D
  C6CC  20F9          		JR	NZ,TEXT1
  C6CE  01B01F        		LD	BC,01FB0H
                      	;	OUT	(C),0		;未定義命令ニーモニック
  C6D1  ED71          		DB	0EDH,071H
                      	
  C6D3  0EC4          		LD	C,0C4H
                      	;	OUT	(C),0		;未定義命令ニーモニック
  C6D5  ED71          		DB	0EDH,071H
                      	
  C6D7  01011A        		LD	BC,01A01H
  C6DA  ED78          		IN	A,(C)
  C6DC  E608          		AND	8
  C6DE  2809          		JR	Z,PRN
  C6E0  0E03          		LD	C,003H
  C6E2  3E0F          		LD	A,00FH
  C6E4  ED79          		OUT	(C),A
  C6E6  01040A        		LD	BC,00A04H
  C6E9                	PRN:
  C6E9  110100        		LD	DE,1
  C6EC  62            		LD	H,D
  C6ED  6A            		LD	L,D
  C6EE  017F00        		LD	BC,07FH
  C6F1  36FF          		LD	(HL),0FFH
  C6F3  EDB0          		LDIR
  C6F5  017F00        		LD	BC,07FH
  C6F8  3600          		LD	(HL),0
  C6FA  EDB0          		LDIR
                      	
  C6FC  3EC3          		LD	A,0C3H		;JP
  C6FE  21F2D9        		LD	HL,WBOOT
  C701  320000        		LD	(00000H),A
  C704  220100        		LD	(00001H),HL	;IPL
                      	
  C707  2A03C6        		LD	HL,(MACHINE)	;3 bit7  DPB Original(1)
  C70A  220300        		LD	(00003H),HL	;  bit6-0 Machine X1(0)
                      	;				;4 LSX-Dodgers(01DH)
  C70D  2106CC        		LD	HL,BDOS
  C710  320500        		LD	(00005H),A
  C713  220600        		LD	(00006H),HL	;BDOS
                      	
  C716  2173D5        		LD	HL,BIOS
  C719  321800        		LD	(00018H),A	;BIOS-ROM
  C71C  221900        		LD	(00019H),HL
                      	
  C71F  210000        		LD	HL,0
  C722  323800        		LD	(00038H),A	;RST038H
  C725  223900        		LD	(00039H),HL
                      	
  C728  3EEC          		LD	A,STABLE/256
  C72A  320B00        		LD	(0000BH),A
                      	
  C72D  3EE9          		LD	A,0E9H		;JP (HL)
  C72F  320F00        		LD	(0000FH),A
                      	
  C732  3A7DEC        		LD	A,(_FATBF+1)
  C735  321300        		LD	(00013H),A
                      	
  C738  3A7FEC        		LD	A,(_DTBUF+1)
  C73B  321700        		LD	(00017H),A
                      	
  C73E  3EFE          		LD	A,KEYBF/256
  C740  321B00        		LD	(0001BH),A
                      	
  C743  3EFF          		LD	A,KBUF/256
  C745  321F00        		LD	(0001FH),A
                      	
  C748  2A05C6        		LD	HL,(VERSION)
  C74B  225A00        		LD	(0005AH),HL
                      	
  C74E  3EE6          		LD	A,0E6H
  C750  CD57DA        		CALL	COMOUT
  C753  CD3CDA        		CALL	IN49SB
  C756  F5            		PUSH	AF
  C757  CD3CDA        		CALL	IN49SB
  C75A  F1            		POP	AF
  C75B  F5            		PUSH	AF
  C75C  E612          		AND	012H
  C75E  2005          		JR	NZ,KEYR
  C760  3E01          		LD	A,1
  C762  32B8C8        		LD	(KEYREP+1),A
  C765                	KEYR:
  C765  F1            		POP	AF
  C766  E603          		AND	3
  C768  280E          		JR	Z,NON
                      	
  C76A  01D03F        		LD	BC,03FD0H
  C76D  ED49          		OUT	(C),C
  C76F  3E37          		LD	A,037H
  C771  D3D0          		OUT	(0D0H),A
  C773  ED78          		IN	A,(C)
  C775  B9            		CP	C
  C776  285C          		JR	Z,TURBO
  C778                	NON:
  C778  3D            		DEC	A		;A=0FFH
  C779  321800        		LD	(00018H),A	;BIOS-ROM
                      	
  C77C  2118CA        		LD	HL,AT_SCR1
  C77F  11E0DA        		LD	DE,SCR1
  C782  015E00        		LD	BC,AT_SCRE-AT_SCR1
  C785  EDB0          		LDIR
                      	
  C787  2176CA        		LD	HL,AT_WTTRK
  C78A  113FEA        		LD	DE,WTTRK
  C78D  017501        		LD	BC,AT_CPUE-AT_WTTRK
  C790  EDB0          		LDIR
                      	
  C792  2192EA        		LD	HL,AT_DRD+AT_R
  C795  22ECEC        		LD	(_FDRD+1),HL
  C798  2143EA        		LD	HL,AT_DWT+AT_R
  C79B  22EFEC        		LD	(_FDWT+1),HL
  C79E  212AEB        		LD	HL,AT_EDRDC+AT_R
  C7A1  2282ED        		LD	(EMMRD),HL
  C7A4  213EEB        		LD	HL,AT_EDWTC+AT_R
  C7A7  2284ED        		LD	(EMMWR),HL
                      	
  C7AA  2159EA        		LD	HL,DWTPAT+AT_R
  C7AD  22AFE9        		LD	(AT_FDCPAT+1),HL
                      	
  C7B0  210000        		LD	HL,0
  C7B3  2282DA        		LD	(X1PAT),HL
                      	
  C7B6  3EAF          		LD	A,0AFH		;XOR	A
  C7B8  3281D8        		LD	(X1KPAT),A
                      	
  C7BB  217FDB        		LD	HL,SCRNX
  C7BE  22D1EC        		LD	(_SCRN+1),HL
                      	
  C7C1  CD8AC9        		CALL	SETCRTC
  C7C4  0610          		LD	B,010H		;PALET
                      	;	OUT	(C),0		;未定義命令ニーモニック
  C7C6  ED71          		DB	0EDH,071H
  C7C8  04            		INC	B
                      	;	OUT	(C),0		;未定義命令ニーモニック
  C7C9  ED71          		DB	0EDH,071H
  C7CB  04            		INC	B
                      	;	OUT	(C),0		;未定義命令ニーモニック
  C7CC  ED71          		DB	0EDH,071H
  C7CE  04            		INC	B
                      	;	OUT	(C),0		;未定義命令ニーモニック
  C7CF  ED71          		DB	0EDH,071H
  C7D1  C374C8        		JP	NOBANK
                      	
  C7D4                	TURBO:
  C7D4  F3            		DI			;Check BIOS
  C7D5  061D          		LD	B,01DH
  C7D7  ED79          		OUT	(C),A		;BIOS ON
  C7D9  3A512F        		LD	A,(02F51H)
  C7DC  04            		INC	B		;B=01EH
  C7DD  ED79          		OUT	(C),A		;BIOS OFF
  C7DF  FB            		EI
  C7E0  FEC9          		CP	0C9H
  C7E2  280B          		JR	Z,BIOSOK
  C7E4  3EAF          		LD	A,0AFH		;XOR	A
  C7E6  3281D8        		LD	(X1KPAT),A
  C7E9  217FDB        		LD	HL,SCRNX
  C7EC  22D1EC        		LD	(_SCRN+1),HL
  C7EF                	BIOSOK:
  C7EF  3E1F          		LD	A,01FH
  C7F1  DBF0          		IN	A,(0F0H)
  C7F3  0F            		RRCA
  C7F4  380B          		JR	C,CRT1
  C7F6  21F5C9        		LD	HL,_C8025H
  C7F9  11B0EC        		LD	DE,CRTCD
  C7FC  011000        		LD	BC,16
  C7FF  EDB0          		LDIR
  C801                	CRT1:
  C801  CD8AC9        		CALL	SETCRTC
  C804  01AA10        		LD	BC,010AAH	;PALET
  C807  ED49          		OUT	(C),C
  C809  01CC11        		LD	BC,011CCH
  C80C  ED49          		OUT	(C),C
  C80E  01F012        		LD	BC,012F0H
  C811  ED49          		OUT	(C),C
  C813  04            		INC	B
  C814  ED71          		DB	0EDH,071H
                      	
  C816  3E1F          		LD	A,01FH
  C818  DBF0          		IN	A,(0F0H)
  C81A  CB57          		BIT	2,A
  C81C  2825          		JR	Z,BANK
                      	
  C81E  AF            		XOR	A
  C81F                	TZ1:
  C81F  F5            		PUSH	AF
  C820  CDDCEC        		CALL	_GETDPB
  C823  DD7E12        		LD	A,(IX+012H)
  C826  FE87          		CP	087H
  C828  2013          		JR	NZ,TZ2
  C82A  DDE5          		PUSH	IX
  C82C  D1            		POP	DE
  C82D  210FE9        		LD	HL,M2HD
  C830  EDA0          		LDI
  C832  EDA0          		LDI
  C834  13            		INC	DE
  C835  13            		INC	DE
  C836  13            		INC	DE
  C837  13            		INC	DE
  C838  010C00        		LD	BC,12
  C83B  EDB0          		LDIR
  C83D                	TZ2:
  C83D  F1            		POP	AF
  C83E  3C            		INC	A
  C83F  FE08          		CP	8
  C841  38DC          		JR	C,TZ1
                      	
  C843                	BANK:
  C843  01000B        		LD	BC,00B00H
  C846  21007F        		LD	HL,07F00H
  C849  F3            		DI
  C84A                	BANK1:
  C84A  ED69          		OUT	(C),L
  C84C  5E            		LD	E,(HL)
  C84D  7B            		LD	A,E
  C84E  C6A5          		ADD	A,0A5H
  C850  77            		LD	(HL),A
  C851  BE            		CP	(HL)
  C852  73            		LD	(HL),E
  C853  2005          		JR	NZ,BANK2
  C855  2C            		INC	L
  C856  CB65          		BIT	4,L
  C858  28F0          		JR	Z,BANK1
  C85A                	BANK2:
  C85A  3E10          		LD	A,010H
  C85C  ED79          		OUT	(C),A
  C85E  7D            		LD	A,L
  C85F  B7            		OR	A
  C860  2812          		JR	Z,NOBANK
  C862  2600          		LD	H,0
  C864  29            		ADD	HL,HL
  C865  29            		ADD	HL,HL
  C866  29            		ADD	HL,HL
  C867  29            		ADD	HL,HL
  C868  29            		ADD	HL,HL
  C869  2B            		DEC	HL
  C86A  2B            		DEC	HL
  C86B  2B            		DEC	HL
  C86C  22A8ED        		LD	(BANKCL),HL
  C86F  3E01          		LD	A,1
  C871  32A0ED        		LD	(BANKFL),A
  C874                	NOBANK:
  C874                	EMM:
  C874  CD53C9        		CALL	EADR0
  C877  ED78          		IN	A,(C)
  C879  F5            		PUSH	AF
                      	
  C87A  110000        		LD	DE,0
  C87D                	ECHECK1:
  C87D  13            		INC	DE
  C87E  CD36C9        		CALL	EADR2
  C881  ED60          		IN	H,(C)
  C883  CD36C9        		CALL	EADR2
  C886  7C            		LD	A,H
  C887  C6E5          		ADD	A,0E5H
  C889  ED79          		OUT	(C),A
  C88B  3C            		INC	A
  C88C  CD53C9        		CALL	EADR0
  C88F  ED79          		OUT	(C),A
  C891  3D            		DEC	A
  C892  CD36C9        		CALL	EADR2
  C895  ED68          		IN	L,(C)
  C897  CD36C9        		CALL	EADR2
  C89A  ED61          		OUT	(C),H
  C89C  BD            		CP	L
  C89D  2004          		JR	NZ,ECHECK2
  C89F  CB5A          		BIT	3,D
  C8A1  28DA          		JR	Z,ECHECK1
  C8A3                	ECHECK2:
  C8A3  CD53C9        		CALL	EADR0
  C8A6  F1            		POP	AF
  C8A7  ED79          		OUT	(C),A
                      	
  C8A9  21F7FF        		LD	HL,0-9
  C8AC  19            		ADD	HL,DE
  C8AD  3008          		JR	NC,NOEMM
  C8AF  2288ED        		LD	(EMMCL),HL
  C8B2  3E03          		LD	A,3
  C8B4  3280ED        		LD	(EMMFL),A
  C8B7                	NOEMM:
  C8B7  3E00          	KEYREP:	LD	A,000H
  C8B9  B7            		OR	A
  C8BA  2807          		JR	Z,KEYR1
  C8BC  010000        		LD	BC,0
  C8BF  ED438CEC      		LD	(_CTC),BC
  C8C3                	KEYR1:
  C8C3  0130F8        		LD	BC,0-80*25
  C8C6  2ABAEC        		LD	HL,(CRTCD+10)
  C8C9  ED43BAEC      		LD	(CRTCD+10),BC
  C8CD  1E0C          		LD	E,00CH
  C8CF  CDCDEC        		CALL	_PRINT
  C8D2  22BAEC        		LD	(CRTCD+10),HL
                      	
  C8D5  21B5C9        		LD	HL,INIMES
  C8D8                	INIMES1:
  C8D8  7E            		LD	A,(HL)
  C8D9  23            		INC	HL
  C8DA  B7            		OR	A
  C8DB  2806          		JR	Z,INIMES2
  C8DD  5F            		LD	E,A
  C8DE  CDCDEC        		CALL	_PRINT
  C8E1  18F5          		JR	INIMES1
  C8E3                	INIMES2:
  C8E3  3A87FF        		LD	A,(0FF87H)
  C8E6  FE08          		CP	8
  C8E8  301E          		JR	NC,INIT0
  C8EA  5F            		LD	E,A
  C8EB  C641          		ADD	A,'A'
  C8ED  32B2C9        		LD	(AUTODV),A
  C8F0  0E0E          		LD	C,00EH
  C8F2  CD0500        		CALL	SYSTEM
  C8F5  1C            		INC	E
  C8F6  2185EC        		LD	HL,_SEEKSP	;Disk error Ignore
  C8F9  CBFE          		SET	7,(HL)
  C8FB  0E1B          		LD	C,01BH
  C8FD  CD0500        		CALL	SYSTEM
  C900  2185EC        		LD	HL,_SEEKSP
  C903  CBBE          		RES	7,(HL)
                      	
  C905  3C            		INC	A
  C906  2008          		JR	NZ,INIT1
  C908                	INIT0:
  C908  1E00          		LD	E,0
  C90A  0E0E          		LD	C,00EH
  C90C  CD0500        		CALL	SYSTEM
  C90F  AF            		XOR	A
  C910                	INIT1:
  C910  2100FF        		LD	HL,0FF00H
  C913  1101FF        		LD	DE,0FF01H
  C916  01FF00        		LD	BC,000FFH
  C919  75            		LD	(HL),L
  C91A  EDB0          		LDIR
                      	
  C91C  210000        		LD	HL,0
  C91F  E5            		PUSH	HL
  C920  B7            		OR	A
  C921  C8            		RET	Z
                      	
  C922  3EE6          		LD	A,0E6H
  C924  CD57DA        		CALL	COMOUT
  C927  CD3CDA        		CALL	IN49SB
  C92A  CD3CDA        		CALL	IN49SB
  C92D  FE1B          		CP	01BH
  C92F  C8            		RET	Z
  C930  11A9C9        		LD	DE,AUTOD
  C933  C3FDEC        		JP	_COMANL
                      	
  C936                	EADR2:
  C936  D5            		PUSH	DE
  C937  EB            		EX	DE,HL
  C938  29            		ADD	HL,HL
  C939  29            		ADD	HL,HL
  C93A  ED4B8BED      		LD	BC,(EMMBL-1)
  C93E  0E00          		LD	C,0
  C940  09            		ADD	HL,BC
  C941  ED4B93ED      		LD	BC,(EMMDV)
  C945  060D          		LD	B,00DH
  C947  ED49          		OUT	(C),C
  C949  0C            		INC	C
  C94A  ED69          		OUT	(C),L
  C94C  0C            		INC	C
  C94D  ED61          		OUT	(C),H
  C94F  0C            		INC	C
  C950  EB            		EX	DE,HL
  C951  D1            		POP	DE
  C952  C9            		RET
                      	
  C953                	EADR0:
  C953  ED4B93ED      		LD	BC,(EMMDV)
  C957  060D          		LD	B,00DH
                      	;	OUT	(C),0		;未定義命令ニーモニック
  C959  ED71          		DB	0EDH,071H
  C95B  0C            		INC	C
                      	;	OUT	(C),0		;未定義命令ニーモニック
  C95C  ED71          		DB	0EDH,071H
  C95E  0C            		INC	C
                      	;	OUT	(C),0		;未定義命令ニーモニック
  C95F  ED71          		DB	0EDH,071H
  C961  0C            		INC	C
  C962  C9            		RET
                      	
  C963                	CHKCTC:
  C963  C5            		PUSH	BC
  C964  110347        		LD	DE,04703H
  C967                	INICTC1:
  C967  0C            		INC	C
  C968  ED51          		OUT	(C),D
                      	;	OUT	(C),0		;未定義命令ニーモニック
  C96A  ED71          		DB	0EDH,071H
  C96C  1D            		DEC	E
  C96D  20F8          		JR	NZ,INICTC1
  C96F  C1            		POP	BC
                      	
  C970  11FA07        		LD	DE,007FAH
  C973  ED51          		OUT	(C),D
  C975  ED59          		OUT	(C),E
  C977  ED78          		IN	A,(C)
  C979  BB            		CP	E
  C97A  C0            		RET	NZ
  C97B  ED51          		OUT	(C),D
  C97D  ED51          		OUT	(C),D
  C97F  ED78          		IN	A,(C)
  C981  BA            		CP	D
  C982  C0            		RET	NZ
  C983  03            		INC	BC
  C984  03            		INC	BC
  C985  ED438CEC      		LD	(_CTC),BC
  C989  C9            		RET
                      	
  C98A                	SETCRTC:
  C98A  21B0EC        		LD	HL,CRTCD
  C98D  AF            		XOR	A
  C98E                	SETCRT1:
  C98E  010018        		LD	BC,01800H
  C991  ED79          		OUT	(C),A
  C993  0C            		INC	C
  C994  04            		INC	B
  C995  EDA3          		OUTI
  C997  3C            		INC	A
  C998  FE0C          		CP	12
  C99A  20F2          		JR	NZ,SETCRT1
  C99C  23            		INC	HL
  C99D  23            		INC	HL
  C99E  01031B        		LD	BC,01A03H+00100H
  C9A1  EDA3          		OUTI
  C9A3  01D020        		LD	BC,01FD0H+00100H
  C9A6  EDA3          		OUTI
  C9A8  C9            		RET
                      	
  C9A9  4155544F455845	AUTOD:	DB	"AUTOEXEC "
  C9B2  413A00        	AUTODV:	DB	"A:",0
                      	
  C9B5  A54C53582D446F	INIMES:	DB	0A5H, "LSX-Dodgers for X1/turbo version "
  C9D7  312E          		DB	030H + VER_1, '.'
  C9D9  3238          		DB	030H + VER_2 ,030H + VER_3
  C9DB  2047616B752028		DB	' Gaku (Lovers/Tablacus)',0DH,0AH
  C9F4  00            		DB	0
                      	
  C9F5                	_C8025H:
  C9F5  6B5059881B0119		DB	06BH,050H,059H,088H,01BH,001H,019H,01AH
  C9FD  000F          		DB	000H,00FH
  C9FF  80F8B0FF      		DW	0-80*LINE,0-80
  CA03  0CA3          		DB	00CH,0A3H
                      	
  CA05  030C0F30333C3F	TEXTDT:	DB	003H,00CH,00FH,030H,033H,03CH,03FH
                      	
  CA0C                	SIODATA:
  CA0C  18            		DB	018H
  CA0D  0100          		DB	1,0
  CA0F  0200          		DB	2,0
  CA11  03C1          		DB	3,0C1H
  CA13  0444          		DB	4,044H
  CA15  05E8          		DB	5,0E8H
  CA17  FF            		DB	0FFH
                      	
  CA18                	AT_SCR1:
  CA18  D9            		EXX
  CA19  C5            		PUSH	BC
  CA1A  015020        		LD	BC,02000H+80
  CA1D  D9            		EXX
  CA1E  C5            		PUSH	BC
  CA1F  010020        		LD	BC,02000H
                      	
  CA22  67            		LD	H,A
  CA23  B7            		OR	A
  CA24                	AT_SCRUP1:
  CA24  2815          		JR	Z,AT_SCRCL
  CA26  C5            		PUSH	BC
  CA27  CBE0          		SET	4,B
  CA29  D9            		EXX
  CA2A  C5            		PUSH	BC
  CA2B  CBE0          		SET	4,B
  CA2D  D9            		EXX
  CA2E  CD6DEB        		CALL	AT_UPSUB+AT_R
  CA31  D9            		EXX
  CA32  C1            		POP	BC
  CA33  D9            		EXX
  CA34  C1            		POP	BC
  CA35  CD6DEB        		CALL	AT_UPSUB+AT_R
  CA38  25            		DEC	H
  CA39  18E9          		JR	AT_SCRUP1
                      	
  CA3B                	AT_SCRCL:
  CA3B  211020        		LD	HL,02000H+16
  CA3E  3A96EC        		LD	A,(_COLORF)
  CA41                	AT_SCRCL1:
  CA41  CBE0          		SET	4,B
  CA43  ED61          		OUT	(C),H
  CA45  CBA0          		RES	4,B
  CA47  ED79          		OUT	(C),A
  CA49  03            		INC	BC
  CA4A  CBE0          		SET	4,B
  CA4C  ED61          		OUT	(C),H
  CA4E  CBA0          		RES	4,B
  CA50  ED79          		OUT	(C),A
  CA52  03            		INC	BC
  CA53  CBE0          		SET	4,B
  CA55  ED61          		OUT	(C),H
  CA57  CBA0          		RES	4,B
  CA59  ED79          		OUT	(C),A
  CA5B  03            		INC	BC
  CA5C  CBE0          		SET	4,B
  CA5E  ED61          		OUT	(C),H
  CA60  CBA0          		RES	4,B
  CA62  ED79          		OUT	(C),A
  CA64  03            		INC	BC
  CA65  CBE0          		SET	4,B
  CA67  ED61          		OUT	(C),H
  CA69  CBA0          		RES	4,B
  CA6B  ED79          		OUT	(C),A
  CA6D  03            		INC	BC
  CA6E  2D            		DEC	L
  CA6F  20D0          		JR	NZ,AT_SCRCL1
  CA71  C1            		POP	BC
  CA72  D9            		EXX
  CA73  C1            		POP	BC
  CA74  D9            		EXX
  CA75  C9            		RET
                      	
  CA76                	AT_SCRE:
                      	
                      	;	FLOPPY DISK DRIVER(CPU)
                      	
  CA76                	AT_WTTRK:
  CA76  3EF0          		LD	A,0F0H
  CA78  1802          		JR	AT_WTTRK1
                      	
  CA7A                	AT_DWT:
  CA7A  3EA0          		LD	A,0A0H
  CA7C                	AT_WTTRK1:
  CA7C  325AEA        		LD	(DWTPAT+1+AT_R),A
                      	
  CA7F  3E02          		LD	A,2		;Retry count
  CA81  323EEA        		LD	(RETRY),A
                      	
  CA84                	DWT0:
  CA84  D5            		PUSH	DE
  CA85  E5            		PUSH	HL
  CA86  2210EB        		LD	(DHLPAT+1+AT_R),HL
  CA89  CD48E9        		CALL	SEEK		;Write disk
  CA8C  E1            		POP	HL
  CA8D  3830          		JR	C,ERRDW
  CA8F  F3            		DI
  CA90  3EA0          	DWTPAT:	LD	A,0A0H
  CA92  CDF4E9        		CALL	SECSET
  CA95  0EFB          		LD	C,0FBH
                      	
  CA97                	DWT1:
  CA97  56            		LD	D,(HL)
  CA98                	DWT2:
  CA98  78            		LD	A,B
  CA99  DBF8          		IN	A,(0F8H)
  CA9B  0F            		RRCA
  CA9C  3008          		JR	NC,DWT4
  CA9E  0F            		RRCA
  CA9F  30F7          		JR	NC,DWT2
  CAA1                	DWT3:
  CAA1  ED51          		OUT	(C),D
  CAA3  23            		INC	HL
  CAA4  18F1          		JR	DWT1
                      	
  CAA6                	DWT4:
  CAA6  3D            		DEC	A
  CAA7  28F8          		JR	Z,DWT3
  CAA9  3C            		INC	A
  CAAA  FB            		EI
  CAAB  D1            		POP	DE
  CAAC  13            		INC	DE
  CAAD  CDE8E9        		CALL	FDMOFF
  CAB0  C8            		RET	Z
  CAB1  CDDBEA        		CALL	DISKC+AT_R
  CAB4  20CE          		JR	NZ,DWT0
  CAB6  B7            		OR	A
  CAB7  C8            		RET	Z
  CAB8                	ERRW:
  CAB8  3EFF          		LD	A,0FFH
  CABA                	ERRZ:
  CABA  BF            		CP	A
  CABB  37            		SCF
  CABC  C3E8E9        		JP	FDMOFF
                      	
  CABF                	ERRDW:
  CABF  D1            		POP	DE
  CAC0  CDECEA        		CALL	AT_DELP+AT_R
  CAC3  20BF          		JR	NZ,DWT0
  CAC5  B7            		OR	A
  CAC6  20F0          		JR	NZ,ERRW
  CAC8  C9            		RET
                      	
  CAC9                	AT_DRD:
  CAC9  3E80          		LD	A,080H
  CACB  32ACEA        		LD	(DRDPAT+1+AT_R),A
  CACE  325AEA        		LD	(DWTPAT+1+AT_R),A
                      	
  CAD1  3E02          		LD	A,2		;Retry count
  CAD3  323EEA        		LD	(RETRY),A
                      	
  CAD6                	DRD0:
  CAD6  D5            		PUSH	DE
  CAD7  E5            		PUSH	HL
  CAD8  2210EB        		LD	(DHLPAT+1+AT_R),HL
  CADB  CD48E9        		CALL	SEEK		;Read disk
  CADE  E1            		POP	HL
  CADF  3827          		JR	C,ERRDR
  CAE1  F3            		DI
  CAE2                	DRDPAT:
  CAE2  3E80          		LD	A,080H
  CAE4  CDF4E9        		CALL	SECSET
  CAE7  0EFB          		LD	C,0FBH
  CAE9                	DRD1:
  CAE9  78            		LD	A,B
  CAEA  DBF8          		IN	A,(0F8H)
  CAEC  0F            		RRCA
  CAED  3008          		JR	NC,DRD3
  CAEF  0F            		RRCA
  CAF0  30F7          		JR	NC,DRD1
  CAF2  EDA2          		INI
  CAF4  04            		INC	B
  CAF5  18F2          		JR	DRD1
                      	
  CAF7                	DRD3:
  CAF7  B7            		OR	A
  CAF8  FB            		EI
  CAF9  D1            		POP	DE
  CAFA  13            		INC	DE
  CAFB  CDE8E9        		CALL	FDMOFF
  CAFE  C8            		RET	Z
  CAFF  CDDBEA        		CALL	DISKC+AT_R
  CB02  20D2          		JR	NZ,DRD0
  CB04  B7            		OR	A
  CB05  20B1          		JR	NZ,ERRW
  CB07  C9            		RET
                      	
  CB08                	ERRDR:
  CB08  D1            		POP	DE
  CB09  CDECEA        		CALL	AT_DELP+AT_R
  CB0C  20C8          		JR	NZ,DRD0
  CB0E  B7            		OR	A
  CB0F  20A7          		JR	NZ,ERRW
  CB11  C9            		RET
                      	
  CB12                	DISKC:
  CB12  1B            		DEC	DE
  CB13  CB5F          		BIT	3,A
  CB15  C40CEA        		CALL	NZ,RNF
  CB18                	DISKD:
  CB18  E5            		PUSH	HL
  CB19  213EEA        		LD	HL,RETRY
  CB1C  35            		DEC	(HL)
  CB1D  E1            		POP	HL
  CB1E  203E          		JR	NZ,AT_ERR		;Retry
  CB20  B7            		OR	A
  CB21  283B          		JR	Z,AT_ERR		;Error
                      	
  CB23                	AT_DELP:
  CB23  CD0CEA        		CALL	RNF
  CB26  CDE8E9        		CALL	FDMOFF
  CB29  3A85EC        		LD	A,(_SEEKSP)
  CB2C  87            		ADD	A,A
  CB2D  382E          		JR	C,AT_ERRZ
  CB2F                	AT_DELP1:
  CB2F  D5            		PUSH	DE
  CB30  2112EA        		LD	HL,DEMES
  CB33  CDF4D7        		CALL	MSX
  CB36  CD72D6        		CALL	KEYBC
  CB39                	AT_DELP2:
  CB39  CD0FDC        		CALL	INKEY
  CB3C  28FB          		JR	Z,AT_DELP2
                      	
  CB3E  D1            		POP	DE
  CB3F  CD6CDF        		CALL	CAP
  CB42  FE52          		CP	'R'
  CB44  200A          		JR	NZ,AT_DELP3
  CB46  210000        	DHLPAT:	LD	HL,0
  CB49  3E02          		LD	A,2
  CB4B  323EEA        		LD	(RETRY),A
  CB4E  B7            		OR	A
  CB4F  C9            		RET
  CB50                	AT_DELP3:
  CB50  FE49          		CP	'I'
  CB52  2807          		JR	Z,AT_IGNORE
  CB54  FE41          		CP	'A'
  CB56  20D7          		JR	NZ,AT_DELP1
  CB58  C3EFD9        		JP	BOOT
  CB5B                	AT_IGNORE:
  CB5B  3EFF          		LD	A,0FFH
  CB5D                	AT_ERRZ:
  CB5D  BF            		CP	A
  CB5E                	AT_ERR:
  CB5E  3EFF          		LD	A,0FFH
  CB60  C9            		RET
                      	
                      	
                      	;	EMM DRIVER(CPU)
                      	
                      	
  CB61                	AT_EDRDC:
  CB61  CD52EB        		CALL	AT_EADR+AT_R
  CB64                	AT_EDRDC1:
  CB64  EDA2          		INI
  CB66  04            		INC	B
  CB67  EDA2          		INI
  CB69  04            		INC	B
  CB6A  EDA2          		INI
  CB6C  04            		INC	B
  CB6D  EDA2          		INI
  CB6F  04            		INC	B
  CB70  3D            		DEC	A
  CB71  20F1          		JR	NZ,AT_EDRDC1
  CB73  AF            		XOR	A
  CB74  C9            		RET
                      	
  CB75                	AT_EDWTC:
  CB75  CD52EB        		CALL	AT_EADR+AT_R
  CB78                	AT_EDWTC1:
  CB78  04            		INC	B
  CB79  EDA3          		OUTI
  CB7B  04            		INC	B
  CB7C  EDA3          		OUTI
  CB7E  04            		INC	B
  CB7F  EDA3          		OUTI
  CB81  04            		INC	B
  CB82  EDA3          		OUTI
  CB84  3D            		DEC	A
  CB85  20F1          		JR	NZ,AT_EDWTC1
  CB87  AF            		XOR	A
  CB88  C9            		RET
                      	
  CB89                	AT_EADR:
  CB89  D5            		PUSH	DE
  CB8A  EB            		EX	DE,HL
  CB8B  29            		ADD	HL,HL
  CB8C  29            		ADD	HL,HL
  CB8D  ED4BA0EC      		LD	BC,(_MAXCYL-1)
  CB91  0E00          		LD	C,0
  CB93  09            		ADD	HL,BC
  CB94  060D          		LD	B,00DH
  CB96  ED49          		OUT	(C),C
  CB98  0C            		INC	C
  CB99  ED69          		OUT	(C),L
  CB9B  0C            		INC	C
  CB9C  ED61          		OUT	(C),H
  CB9E  0C            		INC	C
  CB9F  EB            		EX	DE,HL
  CBA0  D1            		POP	DE
  CBA1  13            		INC	DE
  CBA2  AF            		XOR	A
  CBA3  C9            		RET
                      	
  CBA4                	AT_UPSUB:
  CBA4  2E0A          		LD	L,10
  CBA6                	AT_UPSUB1:
  CBA6  D9            		EXX
  CBA7  ED78          		IN	A,(C)
  CBA9  03            		INC	BC
  CBAA  D9            		EXX
  CBAB  ED79          		OUT	(C),A
  CBAD  03            		INC	BC
  CBAE  D9            		EXX
  CBAF  ED78          		IN	A,(C)
  CBB1  03            		INC	BC
  CBB2  D9            		EXX
  CBB3  ED79          		OUT	(C),A
  CBB5  03            		INC	BC
  CBB6  D9            		EXX
  CBB7  ED78          		IN	A,(C)
  CBB9  03            		INC	BC
  CBBA  D9            		EXX
  CBBB  ED79          		OUT	(C),A
  CBBD  03            		INC	BC
  CBBE  D9            		EXX
  CBBF  ED78          		IN	A,(C)
  CBC1  03            		INC	BC
  CBC2  D9            		EXX
  CBC3  ED79          		OUT	(C),A
  CBC5  03            		INC	BC
  CBC6  D9            		EXX
  CBC7  ED78          		IN	A,(C)
  CBC9  03            		INC	BC
  CBCA  D9            		EXX
  CBCB  ED79          		OUT	(C),A
  CBCD  03            		INC	BC
  CBCE  D9            		EXX
  CBCF  ED78          		IN	A,(C)
  CBD1  03            		INC	BC
  CBD2  D9            		EXX
  CBD3  ED79          		OUT	(C),A
  CBD5  03            		INC	BC
  CBD6  D9            		EXX
  CBD7  ED78          		IN	A,(C)
  CBD9  03            		INC	BC
  CBDA  D9            		EXX
  CBDB  ED79          		OUT	(C),A
  CBDD  03            		INC	BC
  CBDE  D9            		EXX
  CBDF  ED78          		IN	A,(C)
  CBE1  03            		INC	BC
  CBE2  D9            		EXX
  CBE3  ED79          		OUT	(C),A
  CBE5  03            		INC	BC
  CBE6  2D            		DEC	L
  CBE7  C26FEB        		JP	NZ,AT_UPSUB1+AT_R
  CBEA  C9            		RET
                      	
  CBEB                	AT_CPUE:
  CBEB                	INITE:
  CBEB                		DS	0CC06H-INITE
                      	
                      	;LDCCP.ASM
                      	
                      	;	LSX-Dodgers CCP
                      	
  CC06                	BDOS:
  CC06  C33ED2        		JP	BDOS0
                      	
  CC09  2020          		DB	020H,020H
  0040                	PATHX	EQU	64
  CC0B                	PATHD:	DS	PATHX
  CC4B  00            	PATHE:	DB	0
                      	
  CC4C  4F6B24        	OK:	DB	"Ok$"
  CC4F  536B697024    	SKIP:	DB	"Skip$"
  CC54  6B206279746573	KBFREE:	DB	"k bytes free",9,'$'
  CC62  20202020646972	DIRMES:	DB	"    dir $"
  CC6B  074572726F7221	COMERM:	DB	7,"Error!$"
                      	
  0009                	COMS	EQU	9
  CC73                	COMTB:
  CC73  44202020      		DB	"D   "	;1
  CC77  CECE          		DW	C_DIR
  CC79  44495220      		DB	"DIR "	;2
  CC7D  CECE          		DW	C_DIR
  CC7F  434F5059      		DB	"COPY"	;3
  CC83  C5D0          		DW	C_COPY
  CC85  43442020      		DB	"CD  "	;4
  CC89  C1CD          		DW	C_CD
  CC8B  44454C20      		DB	"DEL "	;5
  CC8F  AFCE          		DW	C_DEL
  CC91  50415448      		DB	"PATH"	;6
  CC95  7ACF          		DW	C_PATH
  CC97  52454E20      		DB	"REN "	;7
  CC9B  BBCE          		DW	C_REN
  CC9D  54595045      		DB	"TYPE"	;8
  CCA1  E8D1          		DW	C_TYPE
  CCA3  52454D20      		DB	"REM "	;9
  CCA7  ADCE          		DW	C_REM
                      	
  CCA9                	_SYS00:
  CCA9  F3            		DI
  CCAA  310000        		LD	SP,STACK
                      	
  CCAD  3EEC          		LD	A,INTVEC/256
  CCAF  ED47          		LD	I,A
                      	
  CCB1  3EE4          		LD	A,0E4H
  CCB3  CD57DA        		CALL	COMOUT
  CCB6  3EC8          		LD	A,INTVEC
  CCB8  CD31DA        		CALL	OT49SB
                      	
  CCBB  3ABCEC        		LD	A,(CRTCD+12)
  CCBE  B7            		OR	A
  CCBF  200C          		JR	NZ,SETCRT0
  CCC1  2180F8        		LD	HL,0-80*LINE
  CCC4  22BAEC        		LD	(CRTCD+10),HL
  CCC7  21B0FF        		LD	HL,0-80
  CCCA  22BCEC        		LD	(CRTCD+12),HL
  CCCD                	SETCRT0:
  CCCD  21B0EC        		LD	HL,CRTCD
  CCD0  AF            		XOR	A
  CCD1                	SETCRT2:
  CCD1  010018        		LD	BC,01800H
  CCD4  ED79          		OUT	(C),A
  CCD6  0C            		INC	C
  CCD7  04            		INC	B
  CCD8  EDA3          		OUTI
  CCDA  3C            		INC	A
  CCDB  FE0C          		CP	12
  CCDD  20F2          		JR	NZ,SETCRT2
  CCDF  0D            		DEC	C
  CCE0  ED79          		OUT	(C),A
  CCE2  0C            		INC	C
                      	;	OUT	(C),0		;未定義命令ニーモニック
  CCE3  ED71          		DB	0EDH,071H
  CCE5  0D            		DEC	C
  CCE6  3C            		INC	A
  CCE7  ED79          		OUT	(C),A
  CCE9  0C            		INC	C
                      	;	OUT	(C),0		;未定義命令ニーモニック
  CCEA  ED71          		DB	0EDH,071H
  CCEC  23            		INC	HL
  CCED  23            		INC	HL
  CCEE  01031B        		LD	BC,01A03H+00100H
  CCF1  EDA3          		OUTI
  CCF3  01D020        		LD	BC,01FD0H+00100H
  CCF6  EDA3          		OUTI
  CCF8  CD70CF        		CALL	LTNL
  CCFB                	COMMAND:
  CCFB  CDB5CD        		CALL	SETDTA1
  CCFE  D5            		PUSH	DE
  CCFF  3A87EC        		LD	A,(_DVSW)
  CD02  C641          		ADD	A,'A'
  CD04  5F            		LD	E,A
  CD05  CDCDEC        		CALL	_PRINT
  CD08  1E3E          		LD	E,'>'
  CD0A  CDCDEC        		CALL	_PRINT
  CD0D  D1            		POP	DE		;DE=DTA1
  CD0E  3E50          		LD	A,80
  CD10  12            		LD	(DE),A
  CD11  0E0A          		LD	C,00AH
  CD13  CD0500        		CALL	SYSTEM
  CD16  CD70CF        		CALL	LTNL
                      	
  CD19  118200        		LD	DE,DTA1+2
  CD1C  CDFDEC        		CALL	_COMANL
  CD1F  30DA          		JR	NC,COMMAND
  CD21  CD72D6        		CALL	KEYBC
  CD24  116BCC        		LD	DE,COMERM
  CD27  CD69D2        		CALL	_SYS09
  CD2A  C7            		RST	0
                      	
  CD2B                	COMANL:
  CD2B  CD81DC        		CALL	FILE
  CD2E  D5            		PUSH	DE
  CD2F  11DC00        		LD	DE,FNAME
  CD32  1A            		LD	A,(DE)
  CD33  FE20          		CP	020H
  CD35  2848          		JR	Z,SDVSW
  CD37  1B            		DEC	DE
  CD38  1A            		LD	A,(DE)
  CD39  C6FF          		ADD	A,0FFH
  CD3B  380A          		JR	C,COMB
  CD3D  13            		INC	DE
                      	
  CD3E  2173CC        		LD	HL,COMTB
  CD41  3E09          		LD	A,COMS
  CD43  47            		LD	B,A
  CD44  CD05DF        		CALL	CPNAME
  CD47                	COMB:
  CD47  D1            		POP	DE
  CD48  D20F00        		JP	NC,JP_HL
  CD4B  EB            		EX	DE,HL
  CD4C  222BCE        		LD	(COMPAT+1),HL
  CD4F  2285CE        		LD	(BATPAT+1),HL
  CD52  F5            		PUSH	AF
  CD53  CDD3CD        		CALL	CEXE4
  CD56  F1            		POP	AF
  CD57  21DC00        		LD	HL,FNAME
  CD5A  116D00        		LD	DE,FCB2+1	;COMMAND NAME
  CD5D  010B00        		LD	BC,11
  CD60  EDB0          		LDIR
  CD62  110BCC        		LD	DE,PATHD
  CD65                	CEX1:
  CD65  1A            		LD	A,(DE)
  CD66  FE20          		CP	020H
  CD68  D8            		RET	C
  CD69  CD76DC        		CALL	FILEC
  CD6C  D5            		PUSH	DE
  CD6D  216D00        		LD	HL,FCB2+1	;COMMAND NAME
  CD70  11DC00        		LD	DE,FNAME
  CD73  010B00        		LD	BC,11
  CD76  EDB0          		LDIR
  CD78  CDD3CD        		CALL	CEXE4
  CD7B  D1            		POP	DE
  CD7C  13            		INC	DE
  CD7D  18E6          		JR	CEX1
                      	
  CD7F                	SDVSW:
  CD7F  F1            		POP	AF
  CD80  3ADB00        		LD	A,(FDRV)
  CD83  3D            		DEC	A
  CD84  5F            		LD	E,A
  CD85  0E0E          		LD	C,00EH
  CD87  1833          		JR	SYSTEM0
                      	
  CD89                	OPEN1:
  CD89  21DB00        		LD	HL,FDRV
  CD8C                	OPEN:
  CD8C  0E11          		LD	C,011H
  CD8E                	OPEN3:
  CD8E  D5            		PUSH	DE
  CD8F  1151FF        		LD	DE,DTA
  CD92  CDB2CD        		CALL	SETDTA
  CD95  EB            		EX	DE,HL
  CD96  CD0500        		CALL	SYSTEM
  CD99  D1            		POP	DE
  CD9A  B7            		OR	A
  CD9B  C9            		RET
                      	
  CD9C                	OPEN2:
  CD9C  0E12          		LD	C,012H
  CD9E  18EE          		JR	OPEN3
                      	
  CDA0                	DEFCB:				;Z=Ok NZ=Error
  CDA0  1151FF        		LD	DE,DTA
  CDA3  CDBACD        		CALL	SYSC0F
                      	
  CDA6  210000        		LD	HL,0
  CDA9  2272FF        		LD	(DTA+33),HL
  CDAC  2274FF        		LD	(DTA+35),HL
  CDAF  110001        		LD	DE,00100H
  CDB2                	SETDTA:
  CDB2  C3AED4        		JP	_SYS1A
                      	
  CDB5                	SETDTA1:
  CDB5  118000        		LD	DE,DTA1
  CDB8  18F8          		JR	SETDTA
                      	
  CDBA                	SYSC0F:
  CDBA  0E0F          		LD	C,00FH
  CDBC                	SYSTEM0:
  CDBC  CD0500        		CALL	SYSTEM
  CDBF  B7            		OR	A
  CDC0  C9            		RET
                      	
  CDC1                	C_CD:
  CDC1  CD76DC        		CALL	FILEC
  CDC4  210000        		LD	HL,0
  CDC7  11DB00        		LD	DE,FDRV
  CDCA  1803          		JR	S27
                      	
  CDCC                	S27DTA:
  CDCC  1151FF        		LD	DE,DTA
  CDCF                	S27:
  CDCF  0E27          		LD	C,027H
  CDD1  18E9          		JR	SYSTEM0
                      	
  CDD3                	CEXE4:
  CDD3  3ADB00        		LD	A,(FDRV)
  CDD6  325700        		LD	(00057H),A
  CDD9  2AE900        		LD	HL,(FDRV+14)
  CDDC  225800        		LD	(00058H),HL
                      	
  CDDF  21E400        		LD	HL,FNAME+8
  CDE2  7E            		LD	A,(HL)
  CDE3  FE20          		CP	020H
  CDE5  2007          		JR	NZ,CEXE7
  CDE7  3E3F          		LD	A,'?'
  CDE9  77            		LD	(HL),A
  CDEA  23            		INC	HL
  CDEB  77            		LD	(HL),A
  CDEC  23            		INC	HL
  CDED  77            		LD	(HL),A
  CDEE                	CEXE7:
  CDEE  CD89CD        		CALL	OPEN1
  CDF1                	CEXE5:
  CDF1  C0            		RET	NZ
  CDF2  2A5BFF        		LD	HL,(DTA+1+9)
  CDF5  7C            		LD	A,H
  CDF6  CD6CDF        		CALL	CAP
  CDF9  67            		LD	H,A
  CDFA  7D            		LD	A,L
  CDFB  CD6CDF        		CALL	CAP
  CDFE  6F            		LD	L,A
  CDFF  3A5AFF        		LD	A,(DTA+1+8)
  CE02  CD6CDF        		CALL	CAP
  CE05  D642          		SUB	'B'
  CE07  2831          		JR	Z,C_BAT
  CE09  3D            		DEC	A		;'C'
  CE0A  2805          		JR	Z,C_EXE
  CE0C                	CEXE6:
  CE0C  CD9CCD        		CALL	OPEN2
  CE0F  18E0          		JR	CEXE5
                      	
  CE11                	C_EXE:
  CE11  7C            		LD	A,H
  CE12  FE4D          		CP	'M'
  CE14  20F6          		JR	NZ,CEXE6
                      	
  CE16  CDA0CD        		CALL	DEFCB
  CE19  2A0600        		LD	HL,(SYSTEM+1)
  CE1C  25            		DEC	H
  CE1D  CDCCCD        		CALL	S27DTA
  CE20  3D            		DEC	A
  CE21  37            		SCF
  CE22  C0            		RET	NZ
  CE23  7C            		LD	A,H
  CE24  B5            		OR	L
  CE25  37            		SCF
  CE26  C8            		RET	Z
  CE27  CDB5CD        		CALL	SETDTA1
  CE2A  110000        	COMPAT:	LD	DE,0
  CE2D  CD80D0        		CALL	SETFCB
  CE30  AF            		XOR	A
  CE31  67            		LD	H,A
  CE32  6F            		LD	L,A
  CE33  310000        		LD	SP,STACK
  CE36  E5            		PUSH	HL
  CE37  C30001        		JP	00100H
                      	
  CE3A                	C_BAT:
  CE3A  114154        		LD	DE,'A'+'T'*256
  CE3D  ED52          		SBC	HL,DE
  CE3F  20CB          		JR	NZ,CEXE6
                      	
  CE41  F1            		POP	AF
  CE42  F1            		POP	AF
  CE43  CDA0CD        		CALL	DEFCB
  CE46  210002        		LD	HL,00200H
  CE49  CDCCCD        		CALL	S27DTA
  CE4C  C6FE          		ADD	A,0FEH
  CE4E  D8            		RET	C
  CE4F  7D            		LD	A,L
  CE50  B7            		OR	A
  CE51  37            		SCF
  CE52  C8            		RET	Z
  CE53  3C            		INC	A
  CE54  F5            		PUSH	AF
                      	
  CE55  CD72D6        		CALL	KEYBC
  CE58  1E1A          		LD	E,01AH
  CE5A  CDCDEC        		CALL	_PRINT
  CE5D  C1            		POP	BC
  CE5E  210001        		LD	HL,00100H
  CE61                	BAT1:
  CE61  A7            		AND	A
  CE62  05            		DEC	B
  CE63  C8            		RET	Z
  CE64  7E            		LD	A,(HL)
  CE65  FE25          		CP	'%'
  CE67  280C          		JR	Z,BAT2
  CE69                	BAT1X:
  CE69  7E            		LD	A,(HL)
  CE6A  23            		INC	HL
  CE6B  FE1A          		CP	01AH
  CE6D  C8            		RET	Z
  CE6E  FE0A          		CP	00AH
  CE70  C458D6        		CALL	NZ,KEYBS
  CE73  18EC          		JR	BAT1
                      	
  CE75                	BAT2:
  CE75  23            		INC	HL
  CE76  7E            		LD	A,(HL)
  CE77  2B            		DEC	HL
  CE78  D631          		SUB	'1'
  CE7A  38ED          		JR	C,BAT1X
  CE7C  FE09          		CP	9
  CE7E  30E9          		JR	NC,BAT1X
  CE80  23            		INC	HL
  CE81  23            		INC	HL
  CE82  3C            		INC	A
  CE83  4F            		LD	C,A
  CE84  110000        	BATPAT:	LD	DE,0
  CE87                	BAT3:
  CE87  1A            		LD	A,(DE)
  CE88  B7            		OR	A
  CE89  28D6          		JR	Z,BAT1
  CE8B  CD5BDD        		CALL	SPCUT
  CE8E  0D            		DEC	C
  CE8F  2808          		JR	Z,BAT5
  CE91                	BAT4:
  CE91  1A            		LD	A,(DE)
  CE92  FE21          		CP	021H
  CE94  38F1          		JR	C,BAT3
  CE96  13            		INC	DE
  CE97  18F8          		JR	BAT4
  CE99                	BAT5:
  CE99  1A            		LD	A,(DE)
  CE9A  FE21          		CP	021H
  CE9C  38C3          		JR	C,BAT1
  CE9E  13            		INC	DE
  CE9F  CD58D6        		CALL	KEYBS
  CEA2  18F5          		JR	BAT5
                      	
  CEA4                	SWITCH:
  CEA4  1A            		LD	A,(DE)
  CEA5                	SW1:
  CEA5  13            		INC	DE
  CEA6  B9            		CP	C
  CEA7  1A            		LD	A,(DE)
  CEA8  C8            		RET	Z
  CEA9  FE20          		CP	020H
  CEAB  30F8          		JR	NC,SW1
  CEAD                	C_REM:
  CEAD  AF            		XOR	A
  CEAE  C9            		RET
                      	
  CEAF                	C_DEL:
  CEAF  CD80D0        		CALL	SETFCB
  CEB2  0E08          		LD	C,8
  CEB4  CD0500        		CALL	SYSTEM
                      	
  CEB7  0E13          		LD	C,013H
  CEB9  180A          		JR	CDEL1
                      	
  CEBB                	C_REN:
  CEBB  CD80D0        		CALL	SETFCB
  CEBE  3E10          		LD	A,010H		;ディレクトリも対象にする
  CEC0  326900        		LD	(FCB1+13),A	;属性
  CEC3  0E17          		LD	C,017H
  CEC5                	CDEL1:
  CEC5  115C00        		LD	DE,FCB1
  CEC8  CD0500        		CALL	SYSTEM
  CECB  C6FF          		ADD	A,0FFH
  CECD  C9            		RET
                      	
  CECE                	C_DIR:
  CECE  CD76DC        		CALL	FILEC
  CED1  21DC00        		LD	HL,FDRV+1
  CED4  CD24D2        		CALL	CWILD1
  CED7  3EF1          		LD	A,0F1H
  CED9  32E800        		LD	(FDRV+13),A
  CEDC  CD89CD        		CALL	OPEN1
  CEDF                	CDIR1:
  CEDF  B7            		OR	A
  CEE0  2008          		JR	NZ,PDSKF
  CEE2  CD29CF        		CALL	P_NAME
  CEE5  CD9CCD        		CALL	OPEN2
  CEE8  18F5          		JR	CDIR1
                      	
  CEEA                	PDSKF:
  CEEA  3ADB00        		LD	A,(FDRV)
  CEED  5F            		LD	E,A
  CEEE  0E1B          		LD	C,01BH
  CEF0  CD0500        		CALL	SYSTEM
  CEF3  4F            		LD	C,A
  CEF4  C601          		ADD	A,001H
  CEF6  D8            		RET	C
  CEF7  AF            		XOR	A
  CEF8                	PDS1:
  CEF8  0D            		DEC	C
  CEF9  2804          		JR	Z,PDS2
  CEFB  29            		ADD	HL,HL
  CEFC  8F            		ADC	A,A
  CEFD  18F9          		JR	PDS1
  CEFF                	PDS2:
  CEFF  CB50          		BIT	2,B
  CF01  2006          		JR	NZ,PDSKF1
  CF03  CB3F          		SRL	A
  CF05  CB1C          		RR	H
  CF07  CB1D          		RR	L
  CF09                	PDSKF1:
  CF09  CDACCF        		CALL	PRDEC
  CF0C  1154CC        		LD	DE,KBFREE
  CF0F  CD69D2        		CALL	_SYS09
  CF12  CD9ECF        		CALL	PUTDRV
  CF15  3E5C          		LD	A,05CH
  CF17  CDA9D6        		CALL	MSG_
  CF1A  2AE900        		LD	HL,(FDRV+14)
  CF1D  7C            		LD	A,H
  CF1E  B5            		OR	L
  CF1F  284F          		JR	Z,LTNL
  CF21  2B            		DEC	HL
  CF22  7C            		LD	A,H
  CF23  B5            		OR	L
  CF24  C4ABCF        		CALL	NZ,PRDEC0
  CF27  1847          		JR	LTNL
                      	
  CF29                	P_NAME:
  CF29  3A52FF        		LD	A,(DTA+1)
  CF2C  FE2E          		CP	'.'
  CF2E  C8            		RET	Z
  CF2F  3E20          		LD	A,020H
  CF31  CDA9D6        		CALL	MSG_
  CF34  CDA9D6        		CALL	MSG_
  CF37  3E3A          		LD	A,':'
  CF39  CDA9D6        		CALL	MSG_
  CF3C  3A5DFF        		LD	A,(DTA+1+00BH)
  CF3F  F5            		PUSH	AF
  CF40  0F            		RRCA
  CF41  9F            		SBC	A,A
  CF42  E60A          		AND	'*'-020H
  CF44  C620          		ADD	A,020H
  CF46  CDA9D6        		CALL	MSG_
  CF49  CD9ECF        		CALL	PUTDRV
  CF4C  2152FF        		LD	HL,DTA+1
  CF4F  CDEDCF        		CALL	FPRNT
                      	
  CF52  F1            		POP	AF
  CF53  CB67          		BIT	4,A
  CF55  2808          		JR	Z,DIR3
  CF57  1162CC        		LD	DE,DIRMES
  CF5A  CD69D2        		CALL	_SYS09
  CF5D  1809          		JR	DIR6
  CF5F                	DIR3:
  CF5F  3A70FF        		LD	A,(DTA+1+01EH)
  CF62  2A6EFF        		LD	HL,(DTA+1+01CH)
  CF65  CDACCF        		CALL	PRDEC
  CF68                	DIR6:
  CF68  3AB1EC        		LD	A,(CRTCD+1)
  CF6B  FE29          		CP	40+1
  CF6D  D40FD0        		CALL	NC,PRTTMS
                      	
  CF70                	LTNL:
  CF70  1E0D          		LD	E,00DH
  CF72  CD23D7        		CALL	PRINTX
  CF75  1E0A          		LD	E,00AH
  CF77  C323D7        		JP	PRINTX
                      	
  CF7A                	C_PATH:
  CF7A  CD5BDD        		CALL	SPCUT
  CF7D  210BCC        		LD	HL,PATHD
  CF80  FE21          		CP	021H
  CF82  300E          		JR	NC,CPATH0
  CF84  2B            		DEC	HL
  CF85  2B            		DEC	HL
  CF86                	CPATHP:
  CF86  7E            		LD	A,(HL)
  CF87  23            		INC	HL
  CF88  FE20          		CP	020H
  CF8A  3F            		CCF
  CF8B  30E3          		JR	NC,LTNL
  CF8D  CDA9D6        		CALL	MSG_
  CF90  18F4          		JR	CPATHP
  CF92                	CPATH0:
  CF92  FE3B          		CP	';'
  CF94  2001          		JR	NZ,CPATH1
  CF96  13            		INC	DE
  CF97                	CPATH1:
  CF97  EB            		EX	DE,HL
  CF98  014000        		LD	BC,PATHX
  CF9B  EDB0          		LDIR
  CF9D  C9            		RET
                      	
  CF9E                	PUTDRV:
  CF9E  3ADB00        		LD	A,(FDRV)
  CFA1  C640          		ADD	A,'A'-1
  CFA3  CDA9D6        		CALL	MSG_
  CFA6  3E3A          		LD	A,':'
  CFA8                	MSGR:
  CFA8  C3A9D6        		JP	MSG_
                      	
  CFAB                	PRDEC0:
  CFAB  AF            		XOR	A
  CFAC                	PRDEC:
  CFAC  5F            		LD	E,A
  CFAD  010000        		LD	BC,0
  CFB0  ED43D600      		LD	(DECBF),BC
  CFB4  ED43D800      		LD	(DECBF+2),BC
                      	
  CFB8  0E18          		LD	C,24
  CFBA                	DEC1:
  CFBA  29            		ADD	HL,HL
  CFBB  7B            		LD	A,E
  CFBC  8F            		ADC	A,A
  CFBD  5F            		LD	E,A
  CFBE  E5            		PUSH	HL
  CFBF  21D900        		LD	HL,DECBF+3
  CFC2  0604          		LD	B,4
  CFC4                	DEC2:
  CFC4  7E            		LD	A,(HL)
  CFC5  8F            		ADC	A,A
  CFC6  27            		DAA
  CFC7  77            		LD	(HL),A
  CFC8  2B            		DEC	HL
  CFC9  10F9          		DJNZ	DEC2
  CFCB  E1            		POP	HL
  CFCC  0D            		DEC	C
  CFCD  20EB          		JR	NZ,DEC1
                      	
  CFCF  21D600        		LD	HL,DECBF
  CFD2  3E20          		LD	A,020H
  CFD4  0603          		LD	B,3
  CFD6                	DEC3:
  CFD6  CDE3CF        		CALL	DEC4
  CFD9  CDE3CF        		CALL	DEC4
  CFDC  23            		INC	HL
  CFDD  10F7          		DJNZ	DEC3
  CFDF                	DECX:
  CFDF  CDE3CF        		CALL	DEC4
  CFE2  AF            		XOR	A
  CFE3                	DEC4:
  CFE3  ED6F          		RLD
  CFE5  FE20          		CP	020H
  CFE7  2802          		JR	Z,DEC5
  CFE9  F630          		OR	030H
  CFEB                	DEC5:
  CFEB  18BB          		JR	MSGR
                      	
  CFED                	FPRNT:
  CFED  0608          		LD	B,8
  CFEF  CD00D0        		CALL	P_N1
  CFF2  7E            		LD	A,(HL)
  CFF3  C680          		ADD	A,0A0H-020H
  CFF5  FEA0          		CP	0A0H
  CFF7  2802          		JR	Z,FPR1
  CFF9  3E2E          		LD	A,'.'
  CFFB                	FPR1:
  CFFB  CDA9D6        		CALL	MSG_
  CFFE  0603          		LD	B,3
                      	
  D000                	P_N1:
  D000  C5            		PUSH	BC
  D001  E5            		PUSH	HL
  D002  7E            		LD	A,(HL)
  D003  CD78DF        		CALL	CAP3
  D006  CDA9D6        		CALL	MSG_
  D009  E1            		POP	HL
  D00A  C1            		POP	BC
  D00B  23            		INC	HL
  D00C  10F2          		DJNZ	P_N1
  D00E  C9            		RET
                      	
  D00F                	PRTTMS:
  D00F  3E20          		LD	A,020H
  D011  CDA9D6        		CALL	MSG_
                      	
  D014  2A6AFF        		LD	HL,(DTA+1+24)
  D017  7D            		LD	A,L
  D018  B7            		OR	A
  D019  C8            		RET	Z
  D01A  CB3C          		SRL	H
  D01C  17            		RLA
  D01D  17            		RLA
  D01E  17            		RLA
  D01F  17            		RLA
  D020  E60F          		AND	00FH
  D022  57            		LD	D,A
  D023  7C            		LD	A,H
  D024  C650          		ADD	A,80
  D026  CD6BD0        		CALL	PRTA
  D029  3E2D          		LD	A,'-'
  D02B  CDA9D6        		CALL	MSG_
  D02E  7A            		LD	A,D
  D02F  CD6BD0        		CALL	PRTA
  D032  3E2D          		LD	A,'-'
  D034  CDA9D6        		CALL	MSG_
  D037  7D            		LD	A,L
  D038  E61F          		AND	01FH
  D03A  CD6BD0        		CALL	PRTA
                      	
  D03D  2A68FF        		LD	HL,(DTA+1+22)
                      	
  D040  3E20          		LD	A,020H
  D042  CDA9D6        		CALL	MSG_
  D045  7C            		LD	A,H
  D046  65            		LD	H,L
  D047  1F            		RRA
  D048  CB1D          		RR	L
  D04A  1F            		RRA
  D04B  CB1D          		RR	L
  D04D  1F            		RRA
  D04E  CB1D          		RR	L
  D050  E61F          		AND	01FH
  D052  CD6BD0        		CALL	PRTA
  D055  3E3A          		LD	A,':'
  D057  CDA9D6        		CALL	MSG_
  D05A  7D            		LD	A,L
  D05B  0F            		RRCA
  D05C  0F            		RRCA
  D05D  E63F          		AND	03FH
  D05F  CD6BD0        		CALL	PRTA
  D062  3E3A          		LD	A,':'
  D064  CDA9D6        		CALL	MSG_
  D067  7C            		LD	A,H
  D068  E61F          		AND	01FH
  D06A  87            		ADD	A,A
                      	
                      	;	PRINT10
                      	
  D06B                	PRTA:
  D06B  E5            		PUSH	HL
  D06C  0608          		LD	B,8
  D06E  4F            		LD	C,A
  D06F  AF            		XOR	A
  D070                	PRTA1:
  D070  CB01          		RLC	C
  D072  8F            		ADC	A,A
  D073  27            		DAA
  D074  10FA          		DJNZ	PRTA1
  D076  21D600        		LD	HL,DECBF
  D079  77            		LD	(HL),A
  D07A  AF            		XOR	A
  D07B  CDDFCF        		CALL	DECX
  D07E  E1            		POP	HL
  D07F  C9            		RET
                      	
  D080                	SETFCB:
  D080  CD5BDD        		CALL	SPCUT
  D083  1A            		LD	A,(DE)
  D084  FE20          		CP	020H
  D086  3801          		JR	C,SETFCBA
  D088  1B            		DEC	DE
  D089                	SETFCBA:
  D089  D5            		PUSH	DE
  D08A  215C00        		LD	HL,FCB1
  D08D  115D00        		LD	DE,FCB1+1
  D090  012300        		LD	BC,00023H
  D093  70            		LD	(HL),B		;B=0
  D094  EDB0          		LDIR
  D096  D1            		POP	DE
  D097  D5            		PUSH	DE
  D098  215C00        		LD	HL,FCB1
  D09B  0E29          		LD	C,029H
  D09D  CD0500        		CALL	SYSTEM
  D0A0  216C00        		LD	HL,FCB2
  D0A3  0E29          		LD	C,029H
  D0A5  CD0500        		CALL	SYSTEM
  D0A8  E1            		POP	HL
  D0A9  010050        		LD	BC,05000H
  D0AC  118100        		LD	DE,00081H
  D0AF                	SETFCB1:
  D0AF  7E            		LD	A,(HL)
  D0B0  23            		INC	HL
  D0B1  FE20          		CP	020H
  D0B3  3805          		JR	C,SETFCB2
  D0B5  12            		LD	(DE),A
  D0B6  13            		INC	DE
  D0B7  0C            		INC	C
  D0B8  10F5          		DJNZ	SETFCB1
  D0BA                	SETFCB2:
  D0BA  79            		LD	A,C
  D0BB  328000        		LD	(DTA1),A
  D0BE  04            		INC	B
  D0BF  AF            		XOR	A
  D0C0                	SETFCB3:
  D0C0  12            		LD	(DE),A
  D0C1  13            		INC	DE
  D0C2  10FC          		DJNZ	SETFCB3
  D0C4  C9            		RET
                      	
  D0C5                	C_COPY:
  D0C5  CD80D0        		CALL	SETFCB
  D0C8  118100        		LD	DE,DTA1+1
  D0CB  0E2F          		LD	C,'/'
  D0CD  CDA4CE        		CALL	SWITCH
  D0D0  CD6CDF        		CALL	CAP
  D0D3  325BD1        		LD	(SW+1),A
                      	
  D0D6  1164DC        		LD	DE,BEEPD
  D0D9  CD79DC        		CALL	FILEC2
  D0DC  216C00        		LD	HL,FCB2
  D0DF  CD32D5        		CALL	S29X1
                      	
  D0E2  3E10          		LD	A,010H
  D0E4  326900        		LD	(FCB1+13),A
  D0E7  216D00        		LD	HL,FCB2+1
  D0EA  CD24D2        		CALL	CWILD1
  D0ED                	COPY0:
  D0ED  CD21D2        		CALL	CWILD
  D0F0  215C00        		LD	HL,FCB1
  D0F3  CD8CCD        		CALL	OPEN
  D0F6  37            		SCF
  D0F7                	COPY1:
  D0F7  C0            		RET	NZ
  D0F8  CDA0CD        		CALL	DEFCB
                      	
  D0FB  3A5EFF        		LD	A,(DTA+13)
  D0FE  CB67          		BIT	4,A
  D100  2824          		JR	Z,COPY1A
                      	
  D102  215D00        		LD	HL,FCB1+1
  D105  CD95E0        		CALL	CHKWILD
  D108  3817          		JR	C,COPY9
                      	
  D10A  3E20          		LD	A,020H
  D10C  325D00        		LD	(FCB1+1),A
  D10F  2A6BFF        		LD	HL,(DTA+26)
  D112  23            		INC	HL
  D113  226A00        		LD	(FCB1+14),HL
  D116  18D5          		JR	COPY0
                      	
  D118                	COPYS:
  D118  114FCC        		LD	DE,SKIP
  D11B                	COPY8:
  D11B  CD69D2        		CALL	_SYS09
  D11E  CD70CF        		CALL	LTNL
  D121                	COPY9:
  D121  CD9CCD        		CALL	OPEN2
  D124  18D1          		JR	COPY1
                      	
  D126                	COPY1A:
  D126  216C00        		LD	HL,FCB2
  D129  11DB00        		LD	DE,FDRV
  D12C  0153FF        		LD	BC,DTA+2
  D12F  EDA0          		LDI
  D131  3E0B          		LD	A,11
  D133                	COPY2:
  D133  F5            		PUSH	AF
  D134  7E            		LD	A,(HL)
  D135  FE3F          		CP	'?'
  D137  2001          		JR	NZ,COPY3
  D139  0A            		LD	A,(BC)
  D13A                	COPY3:
  D13A  12            		LD	(DE),A
  D13B  03            		INC	BC
  D13C  13            		INC	DE
  D13D  23            		INC	HL
  D13E  F1            		POP	AF
  D13F  3D            		DEC	A
  D140  20F1          		JR	NZ,COPY2
  D142  010500        		LD	BC,16-11
  D145  EDB0          		LDIR
  D147                	PUTNAME:
  D147  215D00        		LD	HL,FCB1+1
  D14A  CD95E0        		CALL	CHKWILD
  D14D  300B          		JR	NC,PUTN1
  D14F  21DC00        		LD	HL,FDRV+1
  D152  CDEDCF        		CALL	FPRNT
  D155  3E20          		LD	A,020H
  D157  CDA9D6        		CALL	MSG_
  D15A                	PUTN1:
  D15A  3E00          	SW:	LD	A,000H
  D15C  FE54          		CP	'T'
  D15E  2005          		JR	NZ,CSW1
  D160  217AD1        		LD	HL,SWNE
  D163  1807          		JR	SWT1
  D165                	CSW1:
  D165  FE4E          		CP	'N'
  D167  2011          		JR	NZ,SWNE
  D169  2118D1        		LD	HL,COPYS
  D16C                	SWT1:
  D16C  11DB00        		LD	DE,FDRV
  D16F  CDBACD        		CALL	SYSC0F
  D172  2801          		JR	Z,SWN1
  D174  E9            		JP	(HL)
  D175                	SWN1:
  D175  CDD3D1        		CALL	CTIME
  D178  309E          		JR	NC,COPYS
  D17A                	SWNE:
  D17A  11DB00        		LD	DE,FDRV
  D17D  0E16          		LD	C,016H
  D17F  CDBCCD        		CALL	SYSTEM0
  D182  204D          		JR	NZ,COPYE2
  D184  67            		LD	H,A		;A=0
  D185  6F            		LD	L,A
  D186  22FC00        		LD	(FDRV+33),HL
  D189  22FE00        		LD	(FDRV+35),HL
  D18C                	COPY6:
  D18C  CD33D2        		CALL	BUFSIZ
  D18F  CDCCCD        		CALL	S27DTA
  D192  47            		LD	B,A
  D193  3C            		INC	A
  D194  2833          		JR	Z,COPYE
  D196  7C            		LD	A,H
  D197  B5            		OR	L
  D198  280E          		JR	Z,COPY7
  D19A  11DB00        		LD	DE,FDRV
  D19D  0E26          		LD	C,026H
  D19F  CD0500        		CALL	SYSTEM
  D1A2  B7            		OR	A
  D1A3  2024          		JR	NZ,COPYE
  D1A5  05            		DEC	B
  D1A6  20E4          		JR	NZ,COPY6
  D1A8                	COPY7:
  D1A8  3A5EFF        		LD	A,(DTA+13)
  D1AB  32E800        		LD	(FDRV+13),A
  D1AE  2165FF        		LD	HL,DTA+20
  D1B1  11EF00        		LD	DE,FDRV+20
  D1B4  010400        		LD	BC,4
  D1B7  EDB0          		LDIR
                      	
  D1B9  11DB00        		LD	DE,FDRV
  D1BC  0E10          		LD	C,010H
  D1BE  CDBCCD        		CALL	SYSTEM0
  D1C1  2006          		JR	NZ,COPYE
                      	
  D1C3  114CCC        		LD	DE,OK
  D1C6  C31BD1        		JP	COPY8
                      	
  D1C9                	COPYE:
  D1C9  11DB00        		LD	DE,FDRV
  D1CC  0E13          		LD	C,013H
  D1CE  CD0500        		CALL	SYSTEM
  D1D1                	COPYE2:
  D1D1  37            		SCF
  D1D2  C9            		RET
                      	
  D1D3                	CTIME:
  D1D3  ED5B65FF      		LD	DE,(DTA+20)
  D1D7  2AEF00        		LD	HL,(FDRV+20)
  D1DA  A7            		AND	A
  D1DB  ED52          		SBC	HL,DE
  D1DD  C0            		RET	NZ
  D1DE  ED5B67FF      		LD	DE,(DTA+22)
  D1E2  2AF100        		LD	HL,(FDRV+22)
  D1E5  ED52          		SBC	HL,DE
  D1E7  C9            		RET
                      	
  D1E8                	C_TYPE:
  D1E8  CD80D0        		CALL	SETFCB
  D1EB  215C00        		LD	HL,FCB1
  D1EE  CD8CCD        		CALL	OPEN
  D1F1  37            		SCF
  D1F2                	TYPE1:
  D1F2  C0            		RET	NZ
  D1F3  CDA0CD        		CALL	DEFCB
  D1F6  1E1A          		LD	E,01AH
  D1F8  CDCDEC        		CALL	_PRINT
  D1FB                	TYPE2:
  D1FB  CD33D2        		CALL	BUFSIZ
  D1FE  CDCCCD        		CALL	S27DTA
  D201  C6FE          		ADD	A,0FEH
  D203  D8            		RET	C
  D204  7C            		LD	A,H
  D205  B5            		OR	L
  D206  2814          		JR	Z,TYPEE
  D208  010001        		LD	BC,00100H
  D20B                	TYPE3:
  D20B  0A            		LD	A,(BC)
  D20C  03            		INC	BC
  D20D  FE1A          		CP	01AH
  D20F  280B          		JR	Z,TYPEE
  D211  5F            		LD	E,A
  D212  CDB2D6        		CALL	_SYS02
  D215  2B            		DEC	HL
  D216  7C            		LD	A,H
  D217  B5            		OR	L
  D218  20F1          		JR	NZ,TYPE3
  D21A  18DF          		JR	TYPE2
  D21C                	TYPEE:
  D21C  CD9CCD        		CALL	OPEN2
  D21F  18D1          		JR	TYPE1
                      	
  D221                	CWILD:
  D221  215D00        		LD	HL,FCB1+1
  D224                	CWILD1:
  D224  7E            		LD	A,(HL)
  D225  FE20          		CP	020H
  D227  C0            		RET	NZ
  D228                	CWILD2:
  D228  54            		LD	D,H
  D229  5D            		LD	E,L
  D22A  13            		INC	DE
  D22B  010A00        		LD	BC,10
  D22E  363F          		LD	(HL),'?'
  D230  EDB0          		LDIR
  D232  C9            		RET
                      	
  D233                	BUFSIZ:
  D233  3A0700        		LD	A,(SYSTEM+2)
  D236  D603          		SUB	3
  D238  E6FC          		AND	0FCH
  D23A  67            		LD	H,A
  D23B  2E00          		LD	L,0
  D23D  C9            		RET
                      	
                      	
                      	;LDOS.ASM
                      	
                      	;	LSX-Dodgers OS
                      	
  D23E                	BDOS0:
  D23E  79            		LD	A,C
  D23F  FE31          		CP	031H
  D241  301E          		JR	NC,_ERROR
  D243  ED735ED2      		LD	(BDSP+1),SP
  D247  31D4FF        		LD	SP,EXTSP
  D24A  E5            		PUSH	HL
  D24B  C5            		PUSH	BC
  D24C  CB21          		SLA	C
  D24E  06EC          		LD	B,STABLE/256
  D250  0A            		LD	A,(BC)
  D251  6F            		LD	L,A
  D252  03            		INC	BC
  D253  0A            		LD	A,(BC)
  D254  67            		LD	H,A
  D255  225BD2        		LD	(BDOS1+1),HL
  D258  C1            		POP	BC
  D259  E1            		POP	HL
  D25A  CD0000        	BDOS1:	CALL	0
                      	
  D25D  310000        	BDSP:	LD	SP,0
  D260  C9            		RET
                      	
  D261                	_ERROR:
  D261  013201        		LD	BC,00132H
  D264  112801        		LD	DE,VER
  D267                	_SYS1C:
  D267                	_SYS1E:
  D267                	_SYS20:
  D267                	_SYS2E:
  D267  AF            		XOR	A
  D268  C9            		RET
                      	
  D269                	_SYS09:
  D269  D5            		PUSH	DE
  D26A                	_SX09:
  D26A  1A            		LD	A,(DE)
  D26B  13            		INC	DE
  D26C  FE24          		CP	'$'
  D26E  282C          		JR	Z,SX0E2
  D270  D5            		PUSH	DE
  D271  5F            		LD	E,A
  D272  CDB2D6        		CALL	_SYS02
  D275  D1            		POP	DE
  D276  18F2          		JR	_SX09
                      	
  D278                	_SYS0C:
  D278  212200        		LD	HL,00022H
  D27B  AF            		XOR	A
  D27C  7D            		LD	A,L
  D27D  C9            		RET
                      	
  D27E                	_SYS0D:
  D27E  CDDFEC        		CALL	_FFLUSH
  D281  E5            		PUSH	HL
  D282  218000        		LD	HL,00080H
  D285  228AEC        		LD	(_DTA),HL
  D288  E1            		POP	HL
  D289  D5            		PUSH	DE
  D28A  1E00          		LD	E,0
  D28C  3E            		DB	03EH
                      	
  D28D                	_SYS0E:
  D28D  D5            		PUSH	DE
  D28E  7B            		LD	A,E
  D28F  DDE5          		PUSH	IX
  D291  CDDCEC        		CALL	_GETDPB
  D294  DDE1          		POP	IX
  D296  3804          		JR	C,SX0E2
  D298  7B            		LD	A,E
  D299  3287EC        		LD	(_DVSW),A
  D29C                	SX0E2:
  D29C  3E08          		LD	A,8
  D29E  D1            		POP	DE
  D29F  C9            		RET
                      	
  D2A0                	_SYS0F:
  D2A0  CD6DDD        		CALL	SETDRV
  D2A3  FD7E1C        		LD	A,(IY+28)	;Open
  D2A6  C602          		ADD	A,002H		;Write
  D2A8  2868          		JR	Z,FEND0F
  D2AA  CD91E0        		CALL	CHKWILDX
                      	
  D2AD  D48FDD        		CALL	NC,SOPENX
  D2B0                	_S16XX:
  D2B0  3860          		JR	C,FEND0F
                      					;Directory location
  D2B2  3A9FEC        		LD	A,(_FILEN)
  D2B5  FD7719        		LD	(IY+25),A
                      	;				_DIRF
  D2B8  3AA0EC        		LD	A,(_DIRF)
  D2BB  FD771D        		LD	(IY+29),A
                      	;				_FBPS
  D2BE  FD731E        		LD	(IY+30),E
  D2C1  FD721F        		LD	(IY+31),D
                      	;				Open(Read)
  D2C4  FD361CFF      		LD	(IY+28),0FFH
                      	;				FILENAME
  D2C8  FDE5          		PUSH	IY
  D2CA  D1            		POP	DE
  D2CB  13            		INC	DE
  D2CC  010B00        		LD	BC,11
  D2CF  EDB0          		LDIR
                      	;				Attribute
  D2D1  7E            		LD	A,(HL)
  D2D2  FD770D        		LD	(IY+13),A
                      	;				TIME
  D2D5  110B00        		LD	DE,11
  D2D8  19            		ADD	HL,DE
  D2D9  7E            		LD	A,(HL)
  D2DA  23            		INC	HL
  D2DB  FD7716        		LD	(IY+22),A
  D2DE  7E            		LD	A,(HL)
  D2DF  23            		INC	HL
  D2E0  FD7717        		LD	(IY+23),A
                      	;				DATE
  D2E3  7E            		LD	A,(HL)
  D2E4  23            		INC	HL
  D2E5  FD7714        		LD	(IY+20),A
  D2E8  7E            		LD	A,(HL)
  D2E9  23            		INC	HL
  D2EA  FD7715        		LD	(IY+21),A
                      	;				First cluster
  D2ED  7E            		LD	A,(HL)
  D2EE  23            		INC	HL
  D2EF  FD771A        		LD	(IY+26),A
  D2F2  7E            		LD	A,(HL)
  D2F3  23            		INC	HL
  D2F4  FD771B        		LD	(IY+27),A
                      	;				SIZE
  D2F7  7E            		LD	A,(HL)
  D2F8  23            		INC	HL
  D2F9  FD7710        		LD	(IY+16),A
  D2FC  7E            		LD	A,(HL)
  D2FD  23            		INC	HL
  D2FE  FD7711        		LD	(IY+17),A
  D301  7E            		LD	A,(HL)
  D302  23            		INC	HL
  D303  FD7712        		LD	(IY+18),A
  D306  7E            		LD	A,(HL)
  D307  FD7713        		LD	(IY+19),A
  D30A  AF            		XOR	A
  D30B  FD770C        		LD	(IY+12),A
  D30E  FD22D0D3      		LD	(OFCB+1),IY
  D312                	FEND0F:
  D312  C3B7D3        		JP	FEND
                      	
  D315                	_SYS10:
  D315  CD6DDD        		CALL	SETDRV
  D318  FD7E1C        		LD	A,(IY+28)	;Open
  D31B  D6FE          		SUB	0FEH
  D31D  37            		SCF
  D31E  3F            		CCF
  D31F  2032          		JR	NZ,FEND10
  D321                	_S10A:				;Write
  D321  FD770E        		LD	(IY+14),A
  D324  FD770F        		LD	(IY+15),A
                      	
  D327  FD341C        		INC	(IY+28)		;0FEH->0FFH
  D32A  CD82E1        		CALL	SETTMS
                      	
  D32D  FD7E1D        		LD	A,(IY+29)
  D330  32A0EC        		LD	(_DIRF),A
  D333  FD5E1E        		LD	E,(IY+30)
  D336  FD561F        		LD	D,(IY+31)
  D339  CDB1DE        		CALL	DC
  D33C  3879          		JR	C,FEND
                      	
  D33E  FD7E19        		LD	A,(IY+25)
  D341  87            		ADD	A,A
  D342  87            		ADD	A,A
  D343  87            		ADD	A,A
  D344  E6FF          	IBM2:	AND	0FFH		;自己書き換え 1024=0FFH / 512=07FH
  D346  6F            		LD	L,A
  D347  2600          		LD	H,0
  D349  29            		ADD	HL,HL
  D34A  29            		ADD	HL,HL
  D34B  ED4B7EEC      		LD	BC,(_DTBUF)
  D34F  09            		ADD	HL,BC
                      	
  D350  CDA1E0        		CALL	SDIRENT
  D353                	FEND10:
  D353  1862          		JR	FEND
                      	
  D355                	OPENDD:
  D355  FD361CFD      		LD	(IY+28),0FDH
  D359  FD360D20      		LD	(IY+13),020H
  D35D  CD87E1        		CALL	SETTMSX
  D360  1855          		JR	FEND
                      	
  D362                	_SYS11:
  D362  CD6DDD        		CALL	SETDRV
  D365  CDF8DE        		CALL	CHKDDX
  D368  3818          		JR	C,_S11A
  D36A  FDE5          		PUSH	IY
  D36C  E1            		POP	HL
  D36D  ED5B8AEC      		LD	DE,(_DTA)
  D371  010C00        		LD	BC,12
  D374  EDB0          		LDIR
  D376  3E20          		LD	A,020H
  D378  12            		LD	(DE),A
  D379  13            		INC	DE
  D37A  62            		LD	H,D
  D37B  6B            		LD	L,E
  D37C  13            		INC	DE
  D37D  0E13          		LD	C,19
  D37F  70            		LD	(HL),B
  D380  1833          		JR	_S11B
  D382                	_S11A:
  D382  CDC3DD        		CALL	SOPEN
  D385                	_S12X1:
  D385  3830          		JR	C,FEND
  D387  CD6CDE        		CALL	SOPENE2
  D38A  ED5B8AEC      		LD	DE,(_DTA)
  D38E  3A88EC        		LD	A,(_DRV)
  D391  3C            		INC	A
  D392  12            		LD	(DE),A
  D393  D5            		PUSH	DE
  D394  13            		INC	DE
  D395  012000        		LD	BC,32
  D398  EDB0          		LDIR
  D39A  FD6E0E        		LD	L,(IY+14)
  D39D  FD660F        		LD	H,(IY+15)
  D3A0  222FE2        		LD	(SCDIR),HL
  D3A3  2A9AEC        		LD	HL,(_FBPS)
  D3A6  2231E2        		LD	(SFBPS),HL
  D3A9  2A9FEC        		LD	HL,(_FILEN)
  D3AC  2233E2        		LD	(SFNDF),HL	;Directory position and Flags
  D3AF  E1            		POP	HL
  D3B0  1135E2        		LD	DE,SFILE
  D3B3  0E21          		LD	C,33
  D3B5                	_S11B:
  D3B5  EDB0          		LDIR
  D3B7                	FEND:
  D3B7  9F            		SBC	A,A		;CF=0 A=0 : CF=1 A=0FFH
  D3B8                	FENDE:
  D3B8  FDE1          		POP	IY
  D3BA  C1            		POP	BC
  D3BB  D1            		POP	DE
  D3BC  E1            		POP	HL
  D3BD  C9            		RET
                      	
  D3BE                	_SYS12:
  D3BE  E5            		PUSH	HL
  D3BF  D5            		PUSH	DE
  D3C0  C5            		PUSH	BC
  D3C1  FDE5          		PUSH	IY
  D3C3  CD28DE        		CALL	NOPEN
  D3C6  18BD          		JR	_S12X1
                      	
  D3C8                	_S16K:
  D3C8  FD7E1C        		LD	A,(IY+28)	;Device
  D3CB  FEFD          		CP	0FDH
  D3CD  37            		SCF
  D3CE  C8            		RET	Z
                      	
  D3CF  110000        	OFCB:	LD	DE,0
  D3D2  D5            		PUSH	DE
  D3D3  061A          		LD	B,26		;First cluster
  D3D5                	S16K1:
  D3D5  13            		INC	DE
  D3D6  23            		INC	HL
  D3D7  10FC          		DJNZ	S16K1
                      	
  D3D9  1A            		LD	A,(DE)
  D3DA  BE            		CP	(HL)
  D3DB  2013          		JR	NZ,S16K2
  D3DD  13            		INC	DE
  D3DE  23            		INC	HL
  D3DF  1A            		LD	A,(DE)
  D3E0  BE            		CP	(HL)
  D3E1  200D          		JR	NZ,S16K2
                      	
  D3E3  E1            		POP	HL
  D3E4  FDE5          		PUSH	IY
  D3E6  D1            		POP	DE
  D3E7  1A            		LD	A,(DE)		;Drive
  D3E8  BE            		CP	(HL)
  D3E9  2005          		JR	NZ,S16K2
                      	
  D3EB  ED52          		SBC	HL,DE		;CP HL,DE
  D3ED  37            		SCF
  D3EE  C0            		RET	NZ
  D3EF  E5            		PUSH	HL
  D3F0                	S16K2:
  D3F0  E1            		POP	HL
  D3F1  FDE5          		PUSH	IY
  D3F3  D1            		POP	DE
  D3F4                	_SYS13:
  D3F4  CD6DDD        		CALL	SETDRV
  D3F7  CDBBDF        		CALL	KILL
  D3FA                	FEND13:
  D3FA  18BB          		JR	FEND
                      	
  D3FC                	_SYS14:
  D3FC  CD6DDD        		CALL	SETDRV
  D3FF  CDB6E1        		CALL	PUSHRR
  D402  CDF7E1        		CALL	GETSEQ
  D405  CD04E2        		CALL	SETRBR
                      	
  D408  CD1DE2        		CALL	K_DE27
                      	
  D40B  E5            		PUSH	HL
  D40C  CDCAE1        		CALL	SETSEQ
  D40F                	SREAD:
  D40F  E1            		POP	HL
                      	
  D410  C601          		ADD	A,001H
  D412  38A3          		JR	C,FEND
                      	
  D414  7D            		LD	A,L
  D415  D601          		SUB	001H
  D417                	FENDX:
  D417  9F            		SBC	A,A
  D418  E603          		AND	3
  D41A  1F            		RRA
  D41B  189B          		JR	FENDE
                      	
  D41D                	_SYS15:
  D41D  CD6DDD        		CALL	SETDRV
  D420  CDB6E1        		CALL	PUSHRR
  D423  CDF7E1        		CALL	GETSEQ
  D426  CD04E2        		CALL	SETRBR
                      	
  D429  CD17E2        		CALL	K_DE26
  D42C  E5            		PUSH	HL
  D42D  CDCAE1        		CALL	SETSEQ
  D430                	SWRITE:
  D430  E1            		POP	HL
                      	
  D431  C6FF          		ADD	A,0FFH
  D433  18E2          		JR	FENDX
                      	
  D435                	_SYS17:
  D435  CD6DDD        		CALL	SETDRV
  D438  CD17E0        		CALL	NAME
  D43B  18BD          		JR	FEND13
                      	
  D43D                	_SYS16:
  D43D  CD6DDD        		CALL	SETDRV
                      	
  D440  CD91E0        		CALL	CHKWILDX
  D443  38B5          		JR	C,FEND13
  D445  FD7E01        		LD	A,(IY+1)
  D448  FE05          		CP	5
  D44A  2805          		JR	Z,_S16X2
  D44C  FE21          		CP	021H
  D44E  DAFAD3        		JP	C,FEND13
  D451                	_S16X2:
                      	;				Clear FCB
  D451  FDE5          		PUSH	IY
  D453  E1            		POP	HL
  D454  011000        		LD	BC,16
  D457  09            		ADD	HL,BC
  D458                	_S16X1:
  D458  70            		LD	(HL),B
  D459  23            		INC	HL
  D45A  0D            		DEC	C
  D45B  20FB          		JR	NZ,_S16X1
                      	
  D45D  CD87E1        		CALL	SETTMSX
  D460  FD360DFF      		LD	(IY+13),0FFH	;Attribute
  D464  CD8FDD        		CALL	SOPENX
  D467  3F            		CCF
  D468  CCC8D3        		CALL	Z,_S16K
  D46B  D47DDE        		CALL	NC,COPEN
  D46E  D4A1E0        		CALL	NC,SDIRENT
  D471  C3B0D2        		JP	_S16XX
                      	
  D474                	_SYS21:
  D474  CD6DDD        		CALL	SETDRV
  D477  CDB6E1        		CALL	PUSHRR
  D47A  FD6E21        		LD	L,(IY+33)	;Random record
  D47D  FD6622        		LD	H,(IY+34)
  D480  CD04E2        		CALL	SETRBR
                      	
  D483  CD1DE2        		CALL	K_DE27
  D486  E5            		PUSH	HL
  D487  CDE1E1        		CALL	POPRR
  D48A  1883          		JR	SREAD
                      	
  D48C                	_SYS22:
  D48C                	_SYS28:
  D48C  CD6DDD        		CALL	SETDRV
  D48F  CDB6E1        		CALL	PUSHRR
  D492  FD6E21        		LD	L,(IY+33)	;Random record
  D495  FD6622        		LD	H,(IY+34)
  D498  CD04E2        		CALL	SETRBR
                      	
  D49B  CD17E2        		CALL	K_DE26
  D49E  E5            		PUSH	HL
  D49F  CDE1E1        		CALL	POPRR
  D4A2  188C          		JR	SWRITE
                      	
  D4A4                	_SYS18:
  D4A4  21FF00        		LD	HL,000FFH
  D4A7  AF            		XOR	A
  D4A8  C9            		RET
                      	
  D4A9                	_SYS19:
  D4A9  3A87EC        		LD	A,(_DVSW)
  D4AC  A7            		AND	A
  D4AD  C9            		RET
                      	
  D4AE                	_SYS1A:
  D4AE  ED538AEC      		LD	(_DTA),DE
  D4B2  AF            		XOR	A
  D4B3  C9            		RET
                      	
  D4B4                	_SYS1B:
  D4B4  7B            		LD	A,E
  D4B5  CD82DD        		CALL	GETDRV
  D4B8  CDDCEC        		CALL	_GETDPB
  D4BB  D4E2EC        		CALL	NC,_RDFATX
  D4BE  210000        		LD	HL,0
  D4C1  D467E1        		CALL	NC,DSKF
                      	
  D4C4  DD5E08        		LD	E,(IX+8)	;DPB_08_MAXCL_LOW
  D4C7  DD5609        		LD	D,(IX+9)	;DPB_08_MAXCL_HIGH
  D4CA  1B            		DEC	DE
  D4CB  1B            		DEC	DE
  D4CC  FD2A7CEC      		LD	IY,(_FATBF)
  D4D0  9F            		SBC	A,A
  D4D1  D8            		RET	C
  D4D2  DD7E07        		LD	A,(IX+7)	;DPB_07_DBLCL
  D4D5  B7            		OR	A
  D4D6  010002        		LD	BC,00200H
  D4D9  78            		LD	A,B		;A=2
  D4DA  C0            		RET	NZ
  D4DB  3D            		DEC	A		;A=1
  D4DC  DDCB0F7E      		BIT	7,(IX+00FH)	;DPB_0F_FATS
  D4E0  C0            		RET	NZ
  D4E1  0604          		LD	B,004H
  D4E3  C9            		RET
                      	
  D4E4                	_SYS1D:
  D4E4  AF            		XOR	A
  D4E5  67            		LD	H,A
  D4E6  6F            		LD	L,A
  D4E7  C9            		RET
                      	
  D4E8                	_SYS1F:
  D4E8  2100ED        		LD	HL,DEVICE
  D4EB  3A89EC        		LD	A,(_DSK)
  D4EE  C3DCEC        		JP	_GETDPB
                      	
  D4F1                	_SYS23:
  D4F1  E5            		PUSH	HL
  D4F2  2A1EEC        		LD	HL,(STABLE+2*00FH)
  D4F5  CD0F00        		CALL	JP_HL
  D4F8  3814          		JR	C,FSIZE1
                      	;	EX	DE,IY
  D4FA  D5            		PUSH	DE
  D4FB  FDE3          		EX	(SP),IY
  D4FD  D1            		POP	DE
                      	;
  D4FE  D5            		PUSH	DE
  D4FF  CDE7E1        		CALL	GETSIZE
  D502  FD7521        		LD	(IY+33),L	;Random record
  D505  FD7422        		LD	(IY+34),H
  D508  D1            		POP	DE
                      	;	EX	DE,IY
  D509  D5            		PUSH	DE
  D50A  FDE3          		EX	(SP),IY
  D50C  D1            		POP	DE
                      	;
  D50D  AF            		XOR	A
  D50E                	FSIZE1:
  D50E  E1            		POP	HL
  D50F  C9            		RET
                      	
  D510                	_SYS24:
  D510  C5            		PUSH	BC
                      	;	EX	DE,IY
  D511  D5            		PUSH	DE
  D512  FDE3          		EX	(SP),IY
  D514  D1            		POP	DE
                      	;
  D515  D5            		PUSH	DE
  D516  CDF7E1        		CALL	GETSEQ
  D519  FD7521        		LD	(IY+33),L	;Random record
  D51C  FD7422        		LD	(IY+34),H
  D51F  FD362300      		LD	(IY+35),0
  D523  D1            		POP	DE
                      	;	EX	DE,IY
  D524  D5            		PUSH	DE
  D525  FDE3          		EX	(SP),IY
  D527  D1            		POP	DE
                      	;
  D528  C1            		POP	BC
  D529  AF            		XOR	A
  D52A  C9            		RET
                      	
  D52B                	_SYS29:
  D52B  C5            		PUSH	BC
  D52C  E5            		PUSH	HL
  D52D  CD81DC        		CALL	FILE
  D530  E1            		POP	HL
  D531  C1            		POP	BC
  D532                	S29X1:
  D532  C5            		PUSH	BC
  D533  D5            		PUSH	DE
  D534  E5            		PUSH	HL
  D535  EB            		EX	DE,HL
  D536  21DB00        		LD	HL,FDRV
  D539  010D00        		LD	BC,13
  D53C  EDB0          		LDIR
  D53E  70            		LD	(HL),B
  D53F  0E03          		LD	C,3
  D541  EDB0          		LDIR
  D543  E1            		POP	HL
  D544  D1            		POP	DE
  D545  C1            		POP	BC
  D546  AF            		XOR	A
  D547  C9            		RET
                      	
  D548                	_SYS30:
  D548  C5            		PUSH	BC
  D549  01F4EC        		LD	BC,_DWT
  D54C  1804          		JR	S2FX
  D54E                	_SYS2F:
  D54E  C5            		PUSH	BC
  D54F  01F1EC        		LD	BC,_DRD
  D552                	S2FX:
  D552  ED4367D5      		LD	(S2FPAT+1),BC
  D556  CDBFE8        		CALL	FFLUSH
                      	
  D559  D5            		PUSH	DE
  D55A  E5            		PUSH	HL
  D55B  7D            		LD	A,L		;Drive
  D55C  CDD9EC        		CALL	_CHGDRV
  D55F  380D          		JR	C,S30X2
  D561  44            		LD	B,H		;Number of clusters
  D562  2A8AEC        		LD	HL,(_DTA)
  D565                	S30X:
  D565  C5            		PUSH	BC
  D566  CDF1EC        	S2FPAT:	CALL	_DRD
  D569  C1            		POP	BC
  D56A  3802          		JR	C,S30X2
  D56C  10F7          		DJNZ	S30X
  D56E                	S30X2:
  D56E  E1            		POP	HL
  D56F  D1            		POP	DE
  D570  C1            		POP	BC
  D571  9F            		SBC	A,A
  D572  C9            		RET
                      	
                      	;LDIO.ASM
                      	
                      	;	LSX-Dodgers IO
                      	
                      	
  D573                	BIOS:
  D573  ED738DD5      		LD	(SPPAT+1),SP
  D577  F5            		PUSH	AF
  D578  3A8ED5        		LD	A,(SPPAT+2)
  D57B  3C            		INC	A
  D57C  2806          		JR	Z,BIOS2
  D57E  F1            		POP	AF
  D57F  31D4FF        		LD	SP,EXTSP
  D582  1801          		JR	BIOS3
  D584                	BIOS2:
  D584  F1            		POP	AF
  D585                	BIOS3:
  D585  CD90D5        		CALL	BIOS1
  D588  061E          		LD	B,01EH
  D58A  ED79          		OUT	(C),A
  D58C  310000        	SPPAT:	LD	SP,0
  D58F  C9            		RET
  D590                	BIOS1:
  D590  C5            		PUSH	BC
  D591  061D          		LD	B,01DH
  D593  ED79          		OUT	(C),A
  D595  C9            		RET
                      	
  D596                	INT:
  D596  F5            		PUSH	AF
  D597  E5            		PUSH	HL
  D598  C5            		PUSH	BC
  D599  210001        		LD	HL,00100H
  D59C  39            		ADD	HL,SP
  D59D  3807          		JR	C,INTP1
  D59F  ED73D1D5      		LD	(INTSP+1),SP
  D5A3  31D4FF        		LD	SP,EXTSP
  D5A6                	INTP1:
  D5A6  CD3CDA        		CALL	IN49SB
  D5A9  67            		LD	H,A
  D5AA  CD3CDA        		CALL	IN49SB
  D5AD  6F            		LD	L,A
                      	
  D5AE  CB64          		BIT	4,H		;[GRAPH]
  D5B0  2010          		JR	NZ,SCEXE
  D5B2  7D            		LD	A,L
  D5B3  EE09          		XOR	9
  D5B5  2839          		JR	Z,DIAN
  D5B7  7C            		LD	A,H
  D5B8  0F            		RRCA			;[CTRL]
  D5B9  301E          		JR	NC,SCL
  D5BB  0F            		RRCA			;[SHIFT]
  D5BC  3804          		JR	C,SCEXE
  D5BE  3E80          		LD	A,080H
  D5C0  181E          		JR	SCG1
  D5C2                	SCEXE:
  D5C2  2292EC        		LD	(_KEYD),HL
  D5C5  CD25D6        		CALL	KEYSET1
                      	
  D5C8  21D4FF        		LD	HL,EXTSP
  D5CB  A7            		AND	A
  D5CC  ED72          		SBC	HL,SP
  D5CE  2003          		JR	NZ,INTPE1
                      	
  D5D0  310000        	INTSP:	LD	SP,0
  D5D3                	INTPE1:
  D5D3  C1            		POP	BC
  D5D4                	INTPE:
  D5D4  E1            		POP	HL
  D5D5                	INTPE2:
  D5D5  F1            		POP	AF
  D5D6                	INTCTCE:
  D5D6  FB            		EI
  D5D7  ED4D          		RETI
                      	
  D5D9                	SCL:
  D5D9  7D            		LD	A,L
  D5DA  FE08          		CP	008H
  D5DC  280D          		JR	Z,RESET
                      	
  D5DE  3E02          		LD	A,002H
  D5E0                	SCG1:
  D5E0  E5            		PUSH	HL
  D5E1  21BFEC        		LD	HL,WK1FD0
  D5E4  AE            		XOR	(HL)
  D5E5  CDF5EB        		CALL	S1FD0
  D5E8  E1            		POP	HL
  D5E9  18D7          		JR	SCEXE
                      	
  D5EB                	RESET:
  D5EB  3E1D          		LD	A,01DH
  D5ED  D300          		OUT	(0),A
  D5EF  C7            		RST	0
                      	
  D5F0                	DIAN:
  D5F0  6F            		LD	L,A
  D5F1  C5            		PUSH	BC
  D5F2  01B01F        		LD	BC,01FB0H
  D5F5  ED78          		IN	A,(C)
  D5F7  EE80          		XOR	080H
  D5F9  ED79          		OUT	(C),A
  D5FB  C1            		POP	BC
  D5FC  18C4          		JR	SCEXE
                      	
  D5FE                	INTCTC2:
  D5FE  F5            		PUSH	AF
  D5FF  3E00          	INTCPAT:LD	A,000H
  D601  3D            		DEC	A
  D602  3200D6        		LD	(INTCPAT+1),A
  D605  20CE          		JR	NZ,INTPE2
                      	
  D607  3A92EC        		LD	A,(_KEYD)
  D60A  B7            		OR	A
  D60B  28C8          		JR	Z,INTPE2
  D60D                	KEYSET0:
  D60D  E5            		PUSH	HL
  D60E  2A90EC        		LD	HL,(_KEYPS)
  D611  7C            		LD	A,H
  D612  AD            		XOR	L
  D613  2006          		JR	NZ,INTC2A
                      	
  D615  2A92EC        		LD	HL,(_KEYD)
  D618  CD4FD6        		CALL	KEYSET
  D61B                	INTC2A:
  D61B  3A94EC        		LD	A,(_KEYSP)
  D61E  E60F          		AND	00FH
  D620  3200D6        		LD	(INTCPAT+1),A
                      	
  D623  18AF          		JR	INTPE
                      	
  D625                	KEYSET1:
  D625  CB6C          		BIT	5,H
  D627  F5            		PUSH	AF
  D628  ED4B8CEC      		LD	BC,(_CTC)
  D62C  78            		LD	A,B
  D62D  B1            		OR	C
  D62E  2006          		JR	NZ,KEYS10E
                      	
  D630  F1            		POP	AF
  D631  201C          		JR	NZ,KEYSET
  D633  F5            		PUSH	AF
  D634  18D7          		JR	KEYSET0
  D636                	KEYS10E:
  D636  F1            		POP	AF
  D637  C8            		RET	Z
  D638  F5            		PUSH	AF
  D639  3E03          		LD	A,3		;CTC STOP
  D63B  ED79          		OUT	(C),A
  D63D  F1            		POP	AF
                      	
  D63E  B7            		OR	A
  D63F  C8            		RET	Z
                      	
  D640  E5            		PUSH	HL
  D641  2A94EC        		LD	HL,(_KEYSP)
  D644  3EA7          		LD	A,0A7H
  D646  ED79          		OUT	(C),A
  D648  ED69          		OUT	(C),L
  D64A  7C            		LD	A,H
  D64B  3200D6        		LD	(INTCPAT+1),A
  D64E  E1            		POP	HL
                      	
  D64F                	KEYSET:
  D64F  7D            		LD	A,L
  D650  CB7C          		BIT	7,H
  D652  CC7FD6        		CALL	Z,FKEY
  D655  CB74          		BIT	6,H
  D657  C0            		RET	NZ
  D658                	KEYBS:
  D658  B7            		OR	A
  D659  C8            		RET	Z
  D65A                	KEYBS1:
  D65A  FE03          		CP	3
  D65C  CC72D6        		CALL	Z,KEYBC
  D65F  E5            		PUSH	HL
  D660  F5            		PUSH	AF
  D661  2A90EC        		LD	HL,(_KEYPS)
  D664  2C            		INC	L
  D665  7D            		LD	A,L
  D666  BC            		CP	H
  D667  2812          		JR	Z,KEYBE
  D669  3290EC        		LD	(_KEYPS),A
  D66C  26FE          		LD	H,KEYBF/256
  D66E  F1            		POP	AF
  D66F  77            		LD	(HL),A
  D670  E1            		POP	HL
  D671  C9            		RET
                      	
  D672                	KEYBC:
  D672  E5            		PUSH	HL
  D673  210000        		LD	HL,0
  D676  2290EC        		LD	(_KEYPS),HL
  D679  E1            		POP	HL
  D67A  C9            		RET
                      	
  D67B                	KEYBE:
  D67B  F1            		POP	AF
  D67C  E1            		POP	HL
  D67D  37            		SCF
  D67E  C9            		RET
                      	
  D67F                	FKEY:
  D67F  CB75          		BIT	6,L
  D681  C8            		RET	Z
  D682  3E1B          		LD	A,01BH
  D684  CD5AD6        		CALL	KEYBS1
  D687  7D            		LD	A,L
  D688  C6AF          		ADD	A,020H-'q'
  D68A  CB7D          		BIT	7,L
  D68C  C8            		RET	Z
  D68D  2E50          		LD	L,'P'
  D68F  D690          		SUB	0E1H+020H-'q'
  D691  2810          		JR	Z,KEYBSL
  D693  2C            		INC	L
  D694  3D            		DEC	A
  D695  280C          		JR	Z,KEYBSL
  D697  2C            		INC	L
  D698  D609          		SUB	0EBH-0E2H
  D69A  2807          		JR	Z,KEYBSL
  D69C  2E43          		LD	L,'C'
  D69E  3D            		DEC	A
  D69F  2802          		JR	Z,KEYBSL
  D6A1  2E58          		LD	L,'X'
  D6A3                	KEYBSL:
  D6A3  7D            		LD	A,L
  D6A4  18B4          		JR	KEYBS1
                      	
  D6A6                	_SYS01:
  D6A6  CDF8D9        		CALL	_SYS07
  D6A9                	MSG_:
  D6A9  F5            		PUSH	AF
  D6AA  D5            		PUSH	DE
  D6AB  5F            		LD	E,A
  D6AC  CDB2D6        		CALL	_SYS02
  D6AF  D1            		POP	DE
  D6B0  F1            		POP	AF
  D6B1  C9            		RET
                      	
  D6B2                	_SYS02:
  D6B2  CD2BD7        		CALL	BREAK
  D6B5  186C          		JR	PRINTX
                      	
  D6B7                	_SYS03:
  D6B7  F3            		DI
  D6B8  C5            		PUSH	BC
  D6B9  01911F        	SIOAD:	LD	BC,01F91H
  D6BC  3E05          		LD	A,5
  D6BE  ED79          		OUT	(C),A
  D6C0  3EEA          		LD	A,0EAH		;RTS ON
  D6C2  ED79          		OUT	(C),A
  D6C4                	REC1:
  D6C4  CDDBD6        		CALL	BREAK2
  D6C7  ED78          		IN	A,(C)
  D6C9  0F            		RRCA			;Arrival
  D6CA  30F8          		JR	NC,REC1
  D6CC                	BREAK2X:
  D6CC  3F            		CCF
  D6CD  3E05          		LD	A,5
  D6CF  ED79          		OUT	(C),A
  D6D1  3EE8          		LD	A,0E8H		;RTS OFF
  D6D3  ED79          		OUT	(C),A
                      	
  D6D5  0D            		DEC	C
  D6D6  ED78          		IN	A,(C)		;Read data
  D6D8  C1            		POP	BC
  D6D9  FB            		EI
  D6DA  C9            		RET
                      	
  D6DB                	BREAK2:
  D6DB  3E1A          		LD	A,01AH
  D6DD  DB01          		IN	A,(1)
  D6DF  0F            		RRCA
  D6E0  D8            		RET	C
  D6E1  C1            		POP	BC		;PC
  D6E2  01911F        	SIOAD0:	LD	BC,01F91H
  D6E5  18E5          		JR	BREAK2X
                      	
  D6E7                	_SYS04:
  D6E7  C5            		PUSH	BC
  D6E8  01911F        	SIOAD1:	LD	BC,01F91H
  D6EB                	XMIT1:
  D6EB  CDDBD6        		CALL	BREAK2
  D6EE  3E10          		LD	A,010H		;Reset status
  D6F0  ED79          		OUT	(C),A
  D6F2  ED78          		IN	A,(C)
  D6F4  2F            		CPL
  D6F5  E624          		AND	024H		;CTS Send Empty
  D6F7  20F2          		JR	NZ,XMIT1
  D6F9  0D            		DEC	C
  D6FA  ED59          		OUT	(C),E
  D6FC  C1            		POP	BC
  D6FD  C9            		RET
                      	
  D6FE                	_SYS05:
  D6FE  C5            		PUSH	BC
  D6FF  01011A        		LD	BC,01A01H
  D702                	_S05X1:
  D702  CDDBD6        		CALL	BREAK2
  D705  ED78          		IN	A,(C)
  D707  E608          		AND	8
  D709  20F7          		JR	NZ,_S05X1
  D70B  F3            		DI
  D70C  0D            		DEC	C
  D70D  ED59          		OUT	(C),E
  D70F  0E03          		LD	C,3
  D711  3E0E          		LD	A,00EH
  D713  ED79          		OUT	(C),A
  D715  3C            		INC	A
  D716  03            		INC	BC
  D717  0B            		DEC	BC
  D718  ED79          		OUT	(C),A
  D71A  FB            		EI
  D71B  C1            		POP	BC
  D71C  AF            		XOR	A
  D71D  C9            		RET
                      	
  D71E                	_SYS06:
  D71E  7B            		LD	A,E
  D71F  3C            		INC	A
  D720  CACAEC        		JP	Z,_INKEY
  D723                	PRINTX:
  D723  C3CDEC        		JP	_PRINT
                      	
  D726                	_SYS08:
  D726  CDF8D9        		CALL	_SYS07
  D729  1804          		JR	BREAK1
  D72B                	BREAK:
  D72B  FB            		EI
  D72C  3A92EC        		LD	A,(_KEYD)
  D72F                	BREAK1:
  D72F  FE03          		CP	3
  D731  CA0000        		JP	Z,0
  D734  FE13          		CP	013H
  D736  C0            		RET	NZ
                      	
  D737                	PAUSE:
  D737  CD72D6        		CALL	KEYBC
                      	
  D73A                	FLGET:
  D73A  CDDFEC        		CALL	_FFLUSH
  D73D  C5            		PUSH	BC
  D73E  E5            		PUSH	HL
  D73F  ED4B8EEC      		LD	BC,(_TXADR)
  D743  CBE8          		SET	5,B
  D745  ED60          		IN	H,(C)
  D747                	FLGET1:
  D747  3A93EC        		LD	A,(_KEYD+1)
  D74A  0F            		RRCA
  D74B  0F            		RRCA
  D74C  E610          		AND	010H
  D74E  F608          		OR	8
  D750  ED68          		IN	L,(C)
  D752  B5            		OR	L
  D753  ED79          		OUT	(C),A
  D755  CDCAEC        		CALL	_INKEY
  D758  28ED          		JR	Z,FLGET1
  D75A  ED61          		OUT	(C),H
  D75C  E1            		POP	HL
  D75D  C1            		POP	BC
  D75E  C9            		RET
                      	
  D75F                	_SYS0A:
  D75F  C5            		PUSH	BC
  D760  E5            		PUSH	HL
  D761  D5            		PUSH	DE
  D762  CD96DB        		CALL	GETL
  D765  1100FF        		LD	DE,KBUF
  D768  E1            		POP	HL
  D769  E5            		PUSH	HL
  D76A  0E00          		LD	C,0
  D76C  3004          		JR	NC,SAX0
  D76E  23            		INC	HL
  D76F  23            		INC	HL
  D770  1808          		JR	SAX4
  D772                	SAX0:
  D772  46            		LD	B,(HL)
  D773  23            		INC	HL
  D774                	SAX1:
  D774  23            		INC	HL
  D775  1A            		LD	A,(DE)
  D776  13            		INC	DE
  D777  B7            		OR	A
  D778  2004          		JR	NZ,SAX2
  D77A                	SAX4:
  D77A  360D          		LD	(HL),00DH
  D77C  1804          		JR	SAX3
  D77E                	SAX2:
  D77E  77            		LD	(HL),A
  D77F  0C            		INC	C
  D780  10F2          		DJNZ	SAX1
  D782                	SAX3:
  D782  D1            		POP	DE
  D783  79            		LD	A,C
  D784  13            		INC	DE
  D785  12            		LD	(DE),A
  D786  1B            		DEC	DE
  D787  E1            		POP	HL
  D788  C1            		POP	BC
  D789  A7            		AND	A
  D78A  C9            		RET
                      	
  D78B                	_SYS0B:
  D78B  CD2BD7        		CALL	BREAK
  D78E  3A92EC        		LD	A,(_KEYD)
  D791  B7            		OR	A
  D792  C8            		RET	Z
  D793                	CONSTX:
  D793  CDDFEC        		CALL	_FFLUSH
  D796  E5            		PUSH	HL
  D797  2A90EC        		LD	HL,(_KEYPS)
  D79A  7C            		LD	A,H
  D79B  AD            		XOR	L
  D79C  E1            		POP	HL
  D79D  C6FF          		ADD	A,0FFH
  D79F  9F            		SBC	A,A
  D7A0  C9            		RET
                      	
  D7A1                	_SYS2A:
  D7A1  C5            		PUSH	BC
  D7A2  3EED          		LD	A,0EDH		;Read calendar
  D7A4  CD57DA        		CALL	COMOUT
  D7A7  CDCAD7        		CALL	IN49SB_BCD		;YY
  D7AA  6F            		LD	L,A
  D7AB  2600          		LD	H,0
  D7AD  116C07        		LD	DE,1900		;0076CH
  D7B0  FE5A          		CP	90
  D7B2  3002          		JR	NC,RDDATE1
  D7B4  1ED0          		LD	E,0D0H		;2000 & 0FFH D=007H
  D7B6                	RDDATE1:
  D7B6  19            		ADD	HL,DE
  D7B7  CD3CDA        		CALL	IN49SB		;MM
  D7BA  57            		LD	D,A
  D7BB  CDCAD7        		CALL	IN49SB_BCD	;DD
  D7BE  5F            		LD	E,A
  D7BF  7A            		LD	A,D
  D7C0  E607          		AND	7
  D7C2  0604          		LD	B,4
  D7C4                	RDDATE2:
  D7C4  CB3A          		SRL	D
  D7C6  10FC          		DJNZ	RDDATE2
  D7C8  C1            		POP	BC
  D7C9  C9            		RET
  D7CA                	IN49SB_BCD:
  D7CA  CD3CDA        		CALL	IN49SB
  D7CD                	BCD:
  D7CD  4F            		LD	C,A
  D7CE  E6F0          		AND	0F0H
  D7D0  0F            		RRCA
  D7D1  47            		LD	B,A
  D7D2  0F            		RRCA
  D7D3  0F            		RRCA
  D7D4  80            		ADD	A,B
  D7D5  47            		LD	B,A
  D7D6  79            		LD	A,C
  D7D7  E60F          		AND	00FH
  D7D9  80            		ADD	A,B
  D7DA  C9            		RET
                      	
  D7DB                	_SYS2C:
  D7DB  C5            		PUSH	BC
  D7DC  3EEF          		LD	A,0EFH		;Read time
  D7DE  CD57DA        		CALL	COMOUT
  D7E1  CDCAD7        		CALL	IN49SB_BCD	;TT
  D7E4  67            		LD	H,A
  D7E5  CDCAD7        		CALL	IN49SB_BCD	;MM
  D7E8  6F            		LD	L,A
  D7E9  CDCAD7        		CALL	IN49SB_BCD	;SS
  D7EC  57            		LD	D,A
  D7ED  C1            		POP	BC
  D7EE  AF            		XOR	A
  D7EF  C9            		RET
                      	
  D7F0                	MSX1:
  D7F0  5F            		LD	E,A
  D7F1  CDCDEC        		CALL	_PRINT
  D7F4                	MSX:
  D7F4  7E            		LD	A,(HL)
  D7F5  23            		INC	HL
  D7F6  B7            		OR	A
  D7F7  20F7          		JR	NZ,MSX1
  D7F9  C9            		RET
                      	
  D7FA                	ESC1:
  D7FA  7B            		LD	A,E
  D7FB  FE41          		CP	'A'
  D7FD  CA3BD9        		JP	Z,CTRL1E
  D800  FE42          		CP	'B'
  D802  CAC2DA        		JP	Z,CTRL1F
  D805  FE43          		CP	'C'
  D807  CA48D9        		JP	Z,CTRL1C
  D80A  FE44          		CP	'D'
  D80C  CA31D9        		JP	Z,CTRL1D
  D80F  FE45          		CP	'E'
  D811  2802          		JR	Z,CT0CX
  D813  FE6A          		CP	'j'
  D815                	CT0CX:
  D815  CA95DA        		JP	Z,CTRL0C
  D818  FE48          		CP	'H'
  D81A  CAC6D9        		JP	Z,CTRL0B
  D81D  FE4A          		CP	'J'
  D81F  CA98DA        		JP	Z,CTRL1A
  D822  FE4B          		CP	'K'
  D824  CA88D9        		JP	Z,CTRL05
  D827  FE4C          		CP	'L'
  D829  CAD7DA        		JP	Z,CTRL0E
  D82C  FE78          		CP	'x'
  D82E  2804          		JR	Z,ESC1X
  D830  FE79          		CP	'y'
  D832  2002          		JR	NZ,ESC1Y
  D834                	ESC1X:
  D834  3601          		LD	(HL),1
  D836                	ESC1Y:
  D836  FE3D          		CP	'='
  D838  2804          		JR	Z,ESC1W
  D83A  FE59          		CP	'Y'
  D83C  2002          		JR	NZ,ESC1Z
  D83E                	ESC1W:
  D83E  3602          		LD	(HL),2
  D840                	ESC1Z:
  D840  FE20          		CP	020H
  D842  3802          		JR	C,ESC1C
  D844  87            		ADD	A,A
  D845  D0            		RET	NC
  D846                	ESC1C:
  D846  E1            		POP	HL
  D847  184A          		JR	ANK
                      	
  D849                	ESC:
  D849  21A4D8        		LD	HL,PRINTE5
  D84C  E5            		PUSH	HL
  D84D  216FD8        		LD	HL,ESCFLG+1
  D850  3600          		LD	(HL),0
  D852  3D            		DEC	A
  D853  28A5          		JR	Z,ESC1
  D855  3D            		DEC	A
  D856  2009          		JR	NZ,ESC2
  D858  3603          		LD	(HL),3
  D85A  7B            		LD	A,E
  D85B  D620          		SUB	020H
  D85D  3264D8        		LD	(ESCYP+1),A
  D860  C9            		RET
  D861                	ESC2:
  D861  3D            		DEC	A
  D862  C0            		RET	NZ
  D863  2600          	ESCYP:	LD	H,0
  D865  7B            		LD	A,E
  D866  D620          		SUB	020H
  D868  6F            		LD	L,A
  D869  C3D6EC        		JP	_LOC
                      	
  D86C                	PRINT:
  D86C  C5            		PUSH	BC
  D86D  E5            		PUSH	HL
  D86E  3E00          	ESCFLG:	LD	A,000H
  D870  B7            		OR	A
  D871  20D6          		JR	NZ,ESC
                      	
  D873  3E1F          		LD	A,01FH
  D875  BB            		CP	E
  D876  3030          		JR	NC,CTRL
  D878                	PRINTC:
  D878  A7            	INSFLG:	AND	A
  D879  DC60DA        		CALL	C,CTRL12
                      	
  D87C  3E00          	KANFLG:	LD	A,000H
  D87E  B7            		OR	A
  D87F  2041          		JR	NZ,KANJI2
  D881  7B            	X1KPAT:	LD	A,E
  D882  FE80          		CP	080H
  D884  380D          		JR	C,ANK
  D886  FEA0          		CP	0A0H
  D888  3804          		JR	C,KANJI1
  D88A  FEE0          		CP	0E0H
  D88C  3805          		JR	C,ANK
  D88E                	KANJI1:
  D88E  327DD8        		LD	(KANFLG+1),A
  D891  1811          		JR	PRINTE5
  D893                	ANK:
  D893  ED4B8EEC      		LD	BC,(_TXADR)
  D897  78            		LD	A,B
  D898  F638          		OR	038H
  D89A  47            		LD	B,A
                      	;	OUT	(C),0		;未定義命令ニーモニック
  D89B  ED71          		DB	0EDH,071H		;Kanji
  D89D  CB98          		RES	3,B
  D89F  ED59          		OUT	(C),E		;Text
  D8A1                	KANJIE:
  D8A1  CD0DD9        		CALL	PRINTE7
  D8A4                	PRINTE5:
  D8A4  E1            		POP	HL
  D8A5  C1            		POP	BC
  D8A6  AF            		XOR	A
  D8A7  C9            		RET
                      	
  D8A8                	CTRL:
  D8A8  CDF4D8        		CALL	KANCLR
  D8AB  3EA7          		LD	A,0A7H		;AND	A
  D8AD  3278D8        		LD	(INSFLG),A
  D8B0  7B            		LD	A,E
  D8B1  87            		ADD	A,A
  D8B2  4F            		LD	C,A
  D8B3  0600          		LD	B,0
  D8B5  2124DC        		LD	HL,CTRLTB
  D8B8  09            		ADD	HL,BC
  D8B9  7E            		LD	A,(HL)
  D8BA  23            		INC	HL
  D8BB  66            		LD	H,(HL)
  D8BC  6F            		LD	L,A
  D8BD  CD0F00        		CALL	JP_HL
  D8C0  18E2          		JR	PRINTE5
                      	
  D8C2                	KANJI2:
  D8C2  D5            		PUSH	DE
  D8C3  57            		LD	D,A
  D8C4  01812F        		LD	BC,02F81H	;SFTJIS
  D8C7  DF            		RST	018H
  D8C8  01C32F        		LD	BC,02FC3H	;Instead or JISVRM
  D8CB  DF            		RST	018H
                      	
  D8CC  ED4B8EEC      		LD	BC,(_TXADR)
  D8D0  78            		LD	A,B
  D8D1  F638          		OR	038H
  D8D3  47            		LD	B,A
  D8D4  ED51          		OUT	(C),D		;kanji
  D8D6  CB98          		RES	3,B
  D8D8  ED59          		OUT	(C),E		;Text
  D8DA  CD0DD9        		CALL	PRINTE7
  D8DD  ED4B8EEC      		LD	BC,(_TXADR)
  D8E1  78            		LD	A,B
  D8E2  F638          		OR	038H
  D8E4  47            		LD	B,A
  D8E5  CBF2          		SET	6,D
  D8E7  ED51          		OUT	(C),D		;Kanji
  D8E9  CB98          		RES	3,B
  D8EB  ED59          		OUT	(C),E		;Text
  D8ED  D1            		POP	DE
  D8EE  AF            		XOR	A
  D8EF  327DD8        		LD	(KANFLG+1),A
  D8F2  18AD          		JR	KANJIE
                      	
  D8F4                	KANCLR:
  D8F4  3A7DD8        		LD	A,(KANFLG+1)
  D8F7  B7            		OR	A
  D8F8  C8            		RET	Z
  D8F9  ED4B8EEC      		LD	BC,(_TXADR)
  D8FD  78            		LD	A,B
  D8FE  F638          		OR	038H
  D900  47            		LD	B,A
  D901  AF            		XOR	A
  D902  327DD8        		LD	(KANFLG+1),A
  D905  ED79          		OUT	(C),A		;Kanji
  D907  CB98          		RES	3,B
  D909  3E20          		LD	A,020H
  D90B  ED79          		OUT	(C),A		;Text
  D90D                	PRINTE7:
  D90D  CBA0          		RES	4,B
  D90F                	PRINTE6:
  D90F  3A96EC        		LD	A,(_COLORF)
  D912                	PRINTE4:
  D912  ED79          		OUT	(C),A		;Color
  D914  78            		LD	A,B
  D915  E607          		AND	7
  D917  47            		LD	B,A
  D918                	PRINTE2:
  D918  03            		INC	BC
  D919                	PRINTE3:
  D919  2ABAEC        		LD	HL,(CRTCD+10)
  D91C  A7            		AND	A
  D91D  ED4A          		ADC	HL,BC
  D91F                	PRINTE8:
  D91F  2805          		JR	Z,PRINT2
  D921                	PRINTE1:
  D921  ED438EEC      		LD	(_TXADR),BC
  D925                	PRINTE:
  D925  C9            		RET
                      	
  D926                	PRINT2:
  D926  CDDCDA        		CALL	SCR
  D929  2ABCEC        		LD	HL,(CRTCD+12)
  D92C  09            		ADD	HL,BC
  D92D  228EEC        		LD	(_TXADR),HL
  D930  C9            		RET
                      	
  D931                	CTRL08:
  D931                	CTRL1D:
  D931  ED4B8EEC      		LD	BC,(_TXADR)
  D935  78            		LD	A,B
  D936  B1            		OR	C
  D937  C8            		RET	Z
  D938  0B            		DEC	BC
  D939  18E6          		JR	PRINTE1
                      	
  D93B                	CTRL1E:
  D93B  ED4B8EEC      		LD	BC,(_TXADR)
  D93F  2ABCEC        		LD	HL,(CRTCD+12)
  D942  09            		ADD	HL,BC
  D943  D0            		RET	NC
  D944  44            		LD	B,H
  D945  4D            		LD	C,L
  D946  18D9          		JR	PRINTE1
                      	
  D948                	CTRL1C:
  D948  ED4B8EEC      		LD	BC,(_TXADR)
  D94C  18CA          		JR	PRINTE2
                      	
  D94E                	CTRL09:
  D94E  ED4B8EEC      		LD	BC,(_TXADR)
  D952  79            		LD	A,C
  D953  E6F8          		AND	0F8H
  D955  C608          		ADD	A,8
  D957  4F            		LD	C,A
  D958  88            		ADC	A,B
  D959  91            		SUB	C
  D95A  47            		LD	B,A
  D95B  18BC          		JR	PRINTE3
                      	
  D95D                	CTRL02:
  D95D  2A8EEC        		LD	HL,(_TXADR)
  D960  7C            		LD	A,H
  D961  B5            		OR	L
  D962  C8            		RET	Z
  D963  2B            		DEC	HL
  D964  228EEC        		LD	(_TXADR),HL
  D967  D5            		PUSH	DE
  D968  CDD3EC        		CALL	_POS
  D96B  3AB1EC        		LD	A,(CRTCD+1)
  D96E  95            		SUB	L
  D96F  6F            		LD	L,A
  D970  2D            		DEC	L
  D971  2638          		LD	H,038H
  D973  ED4B8EEC      		LD	BC,(_TXADR)
  D977  09            		ADD	HL,BC
  D978  44            		LD	B,H
  D979  4D            		LD	C,L
  D97A  110020        		LD	DE,02000H	;D:Text E:kanji
  D97D  2A96EC        		LD	HL,(_COLORF)	;L:Color
  D980                	C8X1:
  D980  CD7CDA        		CALL	C12S
  D983  0B            		DEC	BC
  D984  20FA          		JR	NZ,C8X1
  D986  D1            		POP	DE
  D987  C9            		RET
                      	
  D988                	CTRL05:
  D988  CDD3EC        		CALL	_POS
  D98B  3AB1EC        		LD	A,(CRTCD+1)
  D98E  95            		SUB	L
  D98F  6F            		LD	L,A
  D990  2620          		LD	H,020H
  D992  ED4B8EEC      		LD	BC,(_TXADR)
  D996                	C05X1:
  D996  78            		LD	A,B
  D997  F638          		OR	038H
  D999  47            		LD	B,A
                      	;	OUT	(C),0		;未定義命令ニーモニック
  D99A  ED71          		DB	0EDH,071H		;kanji
  D99C  CB98          		RES	3,B
  D99E  ED61          		OUT	(C),H		;Text
  D9A0  CBA0          		RES	4,B
  D9A2  3A96EC        		LD	A,(_COLORF)
  D9A5  ED79          		OUT	(C),A		;Color
  D9A7  03            		INC	BC
  D9A8  2D            		DEC	L
  D9A9  20EB          		JR	NZ,C05X1
  D9AB  C9            		RET
                      	
  D9AC                	CTRL0D:
  D9AC  CDD3EC        		CALL	_POS
  D9AF  2E00          		LD	L,0
  D9B1                	LOC:
  D9B1  C5            		PUSH	BC
  D9B2  E5            		PUSH	HL
  D9B3  CDF4D8        		CALL	KANCLR
  D9B6  CDD9D9        		CALL	LOC1
  D9B9  ED438EEC      		LD	(_TXADR),BC
  D9BD  E1            		POP	HL
  D9BE  C1            		POP	BC
  D9BF  C9            		RET
                      	
  D9C0                	CTRL01:
  D9C0  3E37          		LD	A,037H		;SCF
  D9C2  3278D8        		LD	(INSFLG),A
  D9C5  C9            		RET
                      	
  D9C6                	CTRL0B:
  D9C6  210000        		LD	HL,0
  D9C9  228EEC        		LD	(_TXADR),HL
  D9CC  C9            		RET
                      	
  D9CD                	PRINTS:
  D9CD  CD2BD7        		CALL	BREAK
  D9D0  C3CDEC        		JP	_PRINT
                      	
  D9D3                	CTRL1B:
  D9D3  3E01          		LD	A,1
  D9D5  326FD8        		LD	(ESCFLG+1),A
  D9D8  C9            		RET
                      	
  D9D9                	LOC1:
  D9D9  44            		LD	B,H
  D9DA  4D            		LD	C,L
  D9DB  04            		INC	B
  D9DC  05            		DEC	B
  D9DD  C8            		RET	Z
  D9DE  D5            		PUSH	DE
  D9DF  ED5BB1EC      		LD	DE,(CRTCD+1)
  D9E3  210000        		LD	HL,0
  D9E6  55            		LD	D,L
  D9E7                	LOC2:
  D9E7  19            		ADD	HL,DE
  D9E8  10FD          		DJNZ	LOC2
  D9EA  09            		ADD	HL,BC
  D9EB  D1            		POP	DE
  D9EC                	LOC3:
  D9EC  44            		LD	B,H
  D9ED  4D            		LD	C,L
  D9EE  C9            		RET
                      	
  D9EF                	BOOT:
  D9EF  C30000        		JP	0
  D9F2                	WBOOT:
  D9F2  C3A9CC        		JP	_SYS00
  D9F5                	CONST_:
  D9F5  C393D7        		JP	CONSTX
  D9F8                	_SYS07:
  D9F8                	CONIN:
  D9F8  C33AD7        		JP	FLGET
  D9FB                	CONOUT0:
  D9FB  C3FED9        		JP	CONOUT
  D9FE                	CONOUT:
  D9FE  CD10DA        		CALL	CURSOR
  DA01  59            		LD	E,C
  DA02  CDCDEC        		CALL	_PRINT
  DA05  7B            		LD	A,E
  DA06  FE0A          		CP	00AH
  DA08  2006          		JR	NZ,CURSOR
  DA0A  CDACD9        		CALL	CTRL0D
  DA0D  CD88D9        		CALL	CTRL05
  DA10                	CURSOR:
  DA10  C5            		PUSH	BC
  DA11  ED4B8EEC      		LD	BC,(_TXADR)
  DA15  CBE8          		SET	5,B
  DA17  ED78          		IN	A,(C)
  DA19  EE18          		XOR	018H
  DA1B  ED79          		OUT	(C),A
  DA1D  C1            		POP	BC
  DA1E  C9            		RET
                      	
  DA1F                	CTRL07:
  DA1F  2164DC        		LD	HL,BEEPD
  DA22                	BEEP1:
  DA22  7E            		LD	A,(HL)
  DA23  23            		INC	HL
  DA24  FEFF          		CP	0FFH
  DA26  C8            		RET	Z
  DA27  F3            		DI
  DA28  061C          		LD	B,01CH
  DA2A  ED79          		OUT	(C),A
  DA2C  EDA3          		OUTI
  DA2E  FB            		EI
  DA2F  18F1          		JR	BEEP1
                      	
  DA31                	OT49SB:
  DA31  C5            		PUSH	BC
  DA32  CD4DDA        		CALL	CANW
  DA35  010019        		LD	BC,01900H
  DA38  ED79          		OUT	(C),A
  DA3A  C1            		POP	BC
  DA3B  C9            		RET
                      	
  DA3C                	IN49SB:
  DA3C  C5            		PUSH	BC
  DA3D  01011A        		LD	BC,01A01H
  DA40                	CANR:
  DA40  ED78          		IN	A,(C)
  DA42  E620          		AND	020H
  DA44  20FA          		JR	NZ,CANR
  DA46  010019        		LD	BC,01900H
  DA49  ED78          		IN	A,(C)
  DA4B  C1            		POP	BC
  DA4C  C9            		RET
                      	
  DA4D                	CANW:
  DA4D  01011A        		LD	BC,01A01H
  DA50  ED48          		IN	C,(C)
  DA52  CB71          		BIT	6,C
  DA54  20F7          		JR	NZ,CANW
  DA56  C9            		RET
                      	
  DA57                	COMOUT:
  DA57  FB            		EI
  DA58  CD31DA        		CALL	OT49SB
  DA5B  CD4DDA        		CALL	CANW
  DA5E  F3            		DI
  DA5F  C9            		RET
                      	
  DA60                	CTRL12:
  DA60  D5            		PUSH	DE
  DA61  CDD3EC        		CALL	_POS
  DA64  3AB1EC        		LD	A,(CRTCD+1)
  DA67  95            		SUB	L
  DA68  ED4B8EEC      		LD	BC,(_TXADR)
  DA6C  110020        		LD	DE,02000H	;D:Text E:Kanji
  DA6F  2A96EC        		LD	HL,(_COLORF)	;L:Color
  DA72  CBE8          		SET	5,B
  DA74                	C12X1:
  DA74  CD7CDA        		CALL	C12S
  DA77  03            		INC	BC
  DA78  20FA          		JR	NZ,C12X1
  DA7A  D1            		POP	DE
  DA7B  C9            		RET
                      	
  DA7C                	C12S:
  DA7C  CBE0          		SET	4,B
  DA7E  CBD8          		SET	3,B
  DA80  ED60          		IN	H,(C)
  DA82  ED59          	X1PAT:	OUT	(C),E
  DA84  5C            		LD	E,H
  DA85  CB98          		RES	3,B
  DA87  ED60          		IN	H,(C)
  DA89  ED51          		OUT	(C),D
  DA8B  54            		LD	D,H
  DA8C  CBA0          		RES	4,B
  DA8E  ED60          		IN	H,(C)
  DA90  ED69          		OUT	(C),L
  DA92  6C            		LD	L,H
  DA93  3D            		DEC	A
  DA94  C9            		RET
                      	
  DA95                	CTRL0C:
  DA95  CDC6D9        		CALL	CTRL0B
  DA98                	CTRL1A:
  DA98  ED4B8EEC      		LD	BC,(_TXADR)
  DA9C                	C1AX1:
  DA9C  78            		LD	A,B
  DA9D  F638          		OR	038H
  DA9F  47            		LD	B,A
                      	;	OUT	(C),0		;未定義命令ニーモニック
  DAA0  ED71          		DB	0EDH,071H		;kanji
  DAA2  CB98          		RES	3,B
  DAA4  3E20          		LD	A,020H
  DAA6  ED79          		OUT	(C),A		;Text
  DAA8  CBA0          		RES	4,B
  DAAA  3A96EC        		LD	A,(_COLORF)
  DAAD  ED79          		OUT	(C),A		;Color
  DAAF  03            		INC	BC
  DAB0  CBA8          		RES	5,B
  DAB2  2ABAEC        		LD	HL,(CRTCD+10)
  DAB5  09            		ADD	HL,BC
  DAB6  30E4          		JR	NC,C1AX1
  DAB8  C9            		RET
                      	
  DAB9                	CTRL04:
  DAB9  CDD3EC        		CALL	_POS
  DABC  7D            		LD	A,L
  DABD  B7            		OR	A
  DABE  C8            		RET	Z
  DABF                	CTRL03:
  DABF  CDACD9        		CALL	CTRL0D
  DAC2                	CTRL0A:
  DAC2                	CTRL1F:
  DAC2  ED4B8EEC      		LD	BC,(_TXADR)
  DAC6  2AB1EC        		LD	HL,(CRTCD+1)
  DAC9  2600          		LD	H,0
  DACB  09            		ADD	HL,BC
  DACC  44            		LD	B,H
  DACD  4D            		LD	C,L
  DACE  2ABAEC        		LD	HL,(CRTCD+10)
  DAD1  09            		ADD	HL,BC
  DAD2  3F            		CCF
  DAD3  9F            		SBC	A,A
  DAD4  C31FD9        		JP	PRINTE8
                      	
  DAD7                	CTRL0E:
  DAD7  CDD3EC        		CALL	_POS
  DADA  7C            		LD	A,H
  DADB  01            		DB	001H
  DADC                	SCR:
  DADC  3A97EC        		LD	A,(_LINE)
  DADF  3D            		DEC	A
  DAE0                	SCR1:
  DAE0  C5            		PUSH	BC
  DAE1  D5            		PUSH	DE
  DAE2  01801F        		LD	BC,01F80H	;DMA
  DAE5  1EC3          		LD	E,0C3H
  DAE7  ED59          		OUT	(C),E
  DAE9  119A65        		LD	DE,0659AH
  DAEC  ED59          		OUT	(C),E
  DAEE  ED51          		OUT	(C),D
  DAF0  114F00        		LD	DE,79
  DAF3  ED59          		OUT	(C),E
  DAF5  ED51          		OUT	(C),D
                      	
  DAF7  210038        		LD	HL,03800H
  DAFA  11181C        		LD	DE,01C18H
  DAFD  ED51          		OUT	(C),D
  DAFF  ED59          		OUT	(C),E
                      	
  DB01                	SCRUP1:
  DB01  B7            		OR	A
  DB02  2839          		JR	Z,SCRCL
  DB04  F5            		PUSH	AF
  DB05  CD1EDB        		CALL	UPSUB		;kanji
  DB08  ED5BBCEC      		LD	DE,(CRTCD+12)
  DB0C  16F7          		LD	D,0F7H
  DB0E  19            		ADD	HL,DE
  DB0F  D5            		PUSH	DE
  DB10  CD1EDB        		CALL	UPSUB		;Text
  DB13  D1            		POP	DE
  DB14  19            		ADD	HL,DE
  DB15  CD1EDB        		CALL	UPSUB		;Color
  DB18  CBE4          		SET	4,H
  DB1A  F1            		POP	AF
  DB1B  3D            		DEC	A
  DB1C  18E3          		JR	SCRUP1
                      	
  DB1E                	UPSUB:
  DB1E  ED5BB1EC      		LD	DE,(CRTCD+1)
  DB22  1600          		LD	D,0
  DB24  3ECD          		LD	A,0CDH
  DB26  ED79          		OUT	(C),A
  DB28  ED69          		OUT	(C),L		;SOURCE
  DB2A  ED61          		OUT	(C),H
  DB2C  19            		ADD	HL,DE
  DB2D  3E1D          		LD	A,01DH
  DB2F  ED79          		OUT	(C),A		;DIST
  DB31  ED69          		OUT	(C),L
  DB33  ED61          		OUT	(C),H
  DB35  1187CF        		LD	DE,0CF87H
  DB38  ED51          		OUT	(C),D
  DB3A  ED59          		OUT	(C),E
  DB3C  C9            		RET
                      	
  DB3D                	SCRCL:
  DB3D  44            		LD	B,H
  DB3E  4D            		LD	C,L
  DB3F  215020        		LD	HL,02000H+80
  DB42  3A96EC        		LD	A,(_COLORF)
  DB45                	SCRCL1:
                      	;	OUT	(C),0		;未定義命令ニーモニック
  DB45  ED71          		DB	0EDH,071H
  DB47  CB98          		RES	3,B
  DB49  ED61          		OUT	(C),H
  DB4B  CBA0          		RES	4,B
  DB4D  ED79          		OUT	(C),A
  DB4F  CBD8          		SET	3,B
  DB51  CBE0          		SET	4,B
  DB53  03            		INC	BC
  DB54  2D            		DEC	L
  DB55  20EE          		JR	NZ,SCRCL1
  DB57  D1            		POP	DE
  DB58  C1            		POP	BC
  DB59  C9            		RET
                      	
  DB5A                	SCRN:
  DB5A  D5            		PUSH	DE
  DB5B  ED58          		IN	E,(C)		;Text
  DB5D  CBD8          		SET	3,B
  DB5F  ED50          		IN	D,(C)		;Kanji
  DB61  2819          		JR	Z,SCRNE
  DB63  AF            		XOR	A
  DB64  C5            		PUSH	BC
  DB65  013730        		LD	BC,03037H	;VRMJIS
  DB68  DF            		RST	018H
  DB69  01522F        		LD	BC,02F52H	;JISSFT
  DB6C  DF            		RST	018H
  DB6D  C1            		POP	BC
  DB6E  ED78          		IN	A,(C)
  DB70  CB98          		RES	3,B
  DB72  E640          		AND	040H
  DB74  2003          		JR	NZ,SCRN1
  DB76  7A            		LD	A,D
  DB77  D1            		POP	DE
  DB78  C9            		RET
  DB79                	SCRN1:
  DB79  7B            		LD	A,E
  DB7A  D1            		POP	DE
  DB7B  C9            		RET
                      	
  DB7C                	SCRNE:
  DB7C  D1            		POP	DE
  DB7D  CB98          		RES	3,B
  DB7F                	SCRNX:
  DB7F  ED78          		IN	A,(C)
  DB81  C9            		RET
                      	
  DB82                	POS:
  DB82  2A8EEC        		LD	HL,(_TXADR)
  DB85  C5            		PUSH	BC
  DB86  ED4BBCEC      		LD	BC,(CRTCD+12)
  DB8A  AF            		XOR	A
  DB8B                	POS1:
  DB8B  09            		ADD	HL,BC
  DB8C  3C            		INC	A
  DB8D  38FC          		JR	C,POS1
  DB8F  ED42          		SBC	HL,BC
  DB91  3D            		DEC	A
  DB92  67            		LD	H,A
  DB93  C1            		POP	BC
  DB94  A7            		AND	A
  DB95  C9            		RET
                      	
  DB96                	GETL:
  DB96  CDD3EC        		CALL	_POS
  DB99  E5            		PUSH	HL
  DB9A                	GETL1:
  DB9A  CDD3EC        		CALL	_POS
  DB9D  C1            		POP	BC
  DB9E  C5            		PUSH	BC
  DB9F  7D            		LD	A,L
  DBA0  91            		SUB	C
  DBA1  69            		LD	L,C
  DBA2  4F            		LD	C,A
  DBA3  DCD6EC        		CALL	C,_LOC
  DBA6                	GET1W:
  DBA6  CD26D7        		CALL	_SYS08
  DBA9  FE08          		CP	8
  DBAB  2007          		JR	NZ,GETL1X
  DBAD  0D            		DEC	C
  DBAE  CB79          		BIT	7,C
  DBB0  2002          		JR	NZ,GETL1X
  DBB2  3E02          		LD	A,2
  DBB4                	GETL1X:
  DBB4  FE1B          		CP	01BH
  DBB6  2016          		JR	NZ,GETL1V
  DBB8  CD26D7        		CALL	_SYS08
  DBBB  FE22          		CP	022H
  DBBD  2008          		JR	NZ,GETL1Y
  DBBF  2100FF        		LD	HL,KBUF
  DBC2  CDF4D7        		CALL	MSX
  DBC5  180E          		JR	GETL1Z
  DBC7                	GETL1Y:
  DBC7  F5            		PUSH	AF
  DBC8  1E1B          		LD	E,01BH
  DBCA  CDCDEC        		CALL	_PRINT
  DBCD  F1            		POP	AF
  DBCE                	GETL1V:
  DBCE  5F            		LD	E,A
  DBCF  CDC0D9        		CALL	CTRL01
  DBD2  CDCDEC        		CALL	_PRINT
  DBD5                	GETL1Z:
  DBD5  7B            		LD	A,E
  DBD6  FE0D          		CP	00DH
  DBD8  20C0          		JR	NZ,GETL1
                      	
  DBDA  2100FF        		LD	HL,KBUF
  DBDD  AF            		XOR	A
  DBDE  ED4BB0EC      		LD	BC,(CRTCD)
  DBE2                	GETL0:
  DBE2  77            		LD	(HL),A
  DBE3  23            		INC	HL
  DBE4  10FC          		DJNZ	GETL0
                      	
  DBE6  D1            		POP	DE
  DBE7  CDD3EC        		CALL	_POS
  DBEA  6B            		LD	L,E
  DBEB  3AB1EC        		LD	A,(CRTCD+1)
  DBEE  95            		SUB	L
  DBEF  57            		LD	D,A
  DBF0  CDD9D9        		CALL	LOC1
  DBF3  78            		LD	A,B
  DBF4  F630          		OR	030H
  DBF6  47            		LD	B,A
  DBF7  5A            		LD	E,D
  DBF8  2100FF        		LD	HL,KBUF
  DBFB                	GETL2:
  DBFB  CDD0EC        		CALL	_SCRN
  DBFE  03            		INC	BC
  DBFF  77            		LD	(HL),A
  DC00  23            		INC	HL
  DC01  1D            		DEC	E
  DC02  20F7          		JR	NZ,GETL2
  DC04                	GETL3:
  DC04  2B            		DEC	HL
  DC05  7E            		LD	A,(HL)
  DC06  FE21          		CP	021H
  DC08  D0            		RET	NC
  DC09  3600          		LD	(HL),0
  DC0B  15            		DEC	D
  DC0C  20F6          		JR	NZ,GETL3
  DC0E  C9            		RET
                      	
  DC0F                	INKEY:
  DC0F  FB            		EI
  DC10  E5            		PUSH	HL
  DC11  2A90EC        		LD	HL,(_KEYPS)
  DC14  7C            		LD	A,H
  DC15  AD            		XOR	L
  DC16  2809          		JR	Z,INKEY1
  DC18  7C            		LD	A,H
  DC19  3C            		INC	A
  DC1A  3291EC        		LD	(_KEYPS+1),A
  DC1D  6F            		LD	L,A
  DC1E  26FE          		LD	H,KEYBF/256
  DC20  7E            		LD	A,(HL)
  DC21                	INKEY1:
  DC21  E1            		POP	HL
  DC22  B7            		OR	A
  DC23  C9            		RET
                      	
  DC24                	CTRLTB:
  DC24  25D9C0D95DD9BF		DW	PRINTE,CTRL01,CTRL02,CTRL03
  DC2C  B9DA88D998DA1F		DW	CTRL04,CTRL05,CTRL1A,CTRL07
  DC34  31D94ED9C2DAC6		DW	CTRL08,CTRL09,CTRL0A,CTRL0B
  DC3C  95DAACD9D7DA25		DW	CTRL0C,CTRL0D,CTRL0E,PRINTE
  DC44  25D925D9C0D925		DW	PRINTE,PRINTE,CTRL01,PRINTE
  DC4C  25D925D925D925		DW	PRINTE,PRINTE,PRINTE,PRINTE
  DC54  25D925D998DAD3		DW	PRINTE,PRINTE,CTRL1A,CTRL1B
  DC5C  48D931D93BD9C2		DW	CTRL1C,CTRL1D,CTRL1E,CTRL1F
                      	
  DC64                	BEEPD:
  DC64  008E01000B000C		DB	0,08EH,1,0,00BH,0,00CH,010H
  DC6C  073E08100D00FF		DB	007H,03EH,008H,010H,00DH,0,0FFH
                      	
  DC73  00            	REDDATA:DB	0
                      	
  DC74                		DS	2	;余りの数合わせ
                      	
                      	
                      	;LDFILE.ASM
                      	
                      	;	LSX-Dodgers FILE
                      	
  DC76                	FILEC:
  DC76  CD81DC        		CALL	FILE
  DC79                	FILEC2:
  DC79  3ADC00        		LD	A,(FDRV+1)
  DC7C  FE20          		CP	020H
  DC7E  C8            		RET	Z
  DC7F  183B          		JR	SETDIR1
                      	
  DC81                	FILE:
  DC81  AF            		XOR	A
  DC82  32DB00        		LD	(FDRV),A
  DC85  67            		LD	H,A
  DC86  6F            		LD	L,A
  DC87  22E900        		LD	(FDRV+14),HL
  DC8A  CD5BDD        		CALL	SPCUT
  DC8D  CD40DD        		CALL	CCHK3
  DC90  2812          		JR	Z,DEVI1
  DC92  13            		INC	DE
  DC93  1A            		LD	A,(DE)
  DC94  1B            		DEC	DE
  DC95  FE3A          		CP	':'
  DC97  200B          		JR	NZ,DEVI1
  DC99  1A            		LD	A,(DE)		;DRIVE
  DC9A  CD6CDF        		CALL	CAP
  DC9D  D640          		SUB	'@'
  DC9F  13            		INC	DE
  DCA0  13            		INC	DE
  DCA1  32DB00        		LD	(FDRV),A
  DCA4                	DEVI1:
  DCA4  1A            		LD	A,(DE)
  DCA5  D65C          		SUB	05CH
  DCA7  200B          		JR	NZ,NOROOT
  DCA9  210000        		LD	HL,0
  DCAC  22F500        		LD	(FDRV+26),HL
  DCAF  2C            		INC	L
  DCB0  22E900        		LD	(FDRV+14),HL
  DCB3  13            		INC	DE
  DCB4                	NOROOT:
                      	
  DCB4                	SETDIR:
  DCB4  CDE0DC        		CALL	FILED
  DCB7  1A            		LD	A,(DE)
  DCB8  FE5C          		CP	05CH
  DCBA  C0            		RET	NZ
  DCBB  13            		INC	DE
  DCBC                	SETDIR1:
  DCBC  3E10          		LD	A,010H		;Directory
  DCBE  32E800        		LD	(FDRV+13),A
  DCC1  D5            		PUSH	DE
  DCC2  11DB00        		LD	DE,FDRV
  DCC5  2A1EEC        		LD	HL,(STABLE+2*00FH)
  DCC8  CD0F00        		CALL	JP_HL
  DCCB  D1            		POP	DE
  DCCC  B7            		OR	A
  DCCD  C0            		RET	NZ
                      	
  DCCE  3AE800        		LD	A,(FDRV+13)
  DCD1  CB67          		BIT	4,A
  DCD3  C8            		RET	Z
                      	
  DCD4  CD27DD        		CALL	FILEI
  DCD7  2AF500        		LD	HL,(FDRV+26)
  DCDA  23            		INC	HL
  DCDB  22E900        		LD	(FDRV+14),HL
  DCDE  18D4          		JR	SETDIR
                      	
  DCE0                	FILED:
  DCE0  CD27DD        		CALL	FILEI
                      	
  DCE3  0608          		LD	B,8
  DCE5                	FILE2:
  DCE5  CD35DD        		CALL	CCHKF
  DCE8  C8            		RET	Z
  DCE9  FE2A          		CP	'*'
  DCEB  282E          		JR	Z,FILE9
  DCED  FE2E          		CP	'.'
  DCEF  280C          		JR	Z,FILE4
  DCF1  77            		LD	(HL),A
  DCF2  23            		INC	HL
  DCF3  10F0          		DJNZ	FILE2
                      	
  DCF5                	FILE3:
  DCF5  CD35DD        		CALL	CCHKF
  DCF8  C8            		RET	Z
  DCF9  FE2E          		CP	'.'
  DCFB  20F8          		JR	NZ,FILE3
                      	
  DCFD                	FILE4:
  DCFD  21E400        		LD	HL,FNAME+8
  DD00  0603          		LD	B,3
                      	
  DD02                	FILE4L:
  DD02  CD35DD        		CALL	CCHKF
  DD05  C8            		RET	Z
  DD06  FE2E          		CP	'.'
  DD08  2008          		JR	NZ,FILE12
  DD0A  32DC00        		LD	(FNAME),A	;Parent directory(..)
  DD0D  32DD00        		LD	(FNAME+1),A
  DD10  3E20          		LD	A,020H
  DD12                	FILE12:
  DD12  FE2A          		CP	'*'
  DD14  280A          		JR	Z,FILE10
  DD16  77            		LD	(HL),A
  DD17  23            		INC	HL
  DD18  10E8          		DJNZ	FILE4L
  DD1A  C9            		RET
                      	
  DD1B                	FILE9:
  DD1B  CD20DD        		CALL	FILE10
  DD1E  18D5          		JR	FILE3
                      	
  DD20                	FILE10:
  DD20  3E3F          		LD	A,'?'
                      	
  DD22                	FILE7:
  DD22  77            		LD	(HL),A
  DD23  23            		INC	HL
  DD24  10FC          		DJNZ	FILE7
  DD26  C9            		RET
                      	
  DD27                	FILEI:
  DD27  3E20          		LD	A,020H
  DD29  01000B        		LD	BC,11*256
  DD2C  21DC00        		LD	HL,FNAME
  DD2F  E5            		PUSH	HL
  DD30  CD22DD        		CALL	FILE7
  DD33  E1            		POP	HL
  DD34  C9            		RET
                      	
  DD35                	CCHKF:
  DD35  1A            		LD	A,(DE)
  DD36  CD3DDD        		CALL	CCHK2
  DD39  C8            		RET	Z
  DD3A  C37EE0        		JP	FKAN
                      	
  DD3D                	CCHK2:
  DD3D  0C            		INC	C
  DD3E  0D            		DEC	C
  DD3F  C0            		RET	NZ
  DD40                	CCHK3:
  DD40  FE2B          		CP	'+'
  DD42  C8            		RET	Z
  DD43  FE2C          		CP	','
  DD45  C8            		RET	Z
  DD46  FE2F          		CP	'/'
  DD48  C8            		RET	Z
  DD49  FE3A          		CP	':'
  DD4B  C8            		RET	Z
  DD4C  FE3B          		CP	';'
  DD4E  C8            		RET	Z
  DD4F  FE3D          		CP	'='
  DD51  C8            		RET	Z
  DD52  FE5C          		CP	05CH
  DD54  C8            		RET	Z
  DD55  FE20          		CP	020H
  DD57  D0            		RET	NC
  DD58  BF            		CP	A		;Z=1
  DD59  C9            		RET
                      	
  DD5A                	SS1:
  DD5A  13            		INC	DE
  DD5B                	SPCUT:
  DD5B  1A            		LD	A,(DE)
  DD5C  FE20          		CP	020H
  DD5E  28FA          		JR	Z,SS1
  DD60  C9            		RET
                      	
  DD61                	SETDRVF:
  DD61  11DB00        		LD	DE,FDRV
  DD64                	SETDRV0:
  DD64  CD6DDD        		CALL	SETDRV
  DD67  FDE1          		POP	IY
  DD69  C1            		POP	BC
  DD6A  D1            		POP	DE
  DD6B  E1            		POP	HL
  DD6C  C9            		RET
                      	
  DD6D                	SETDRV:
  DD6D  E3            		EX	(SP),HL		;HL=RETRN ADDRESS
  DD6E  D5            		PUSH	DE		;PUSH HL/DE/BC/IY
  DD6F  C5            		PUSH	BC
  DD70  1A            		LD	A,(DE)
                      	;	EX	DE,IY
  DD71  D5            		PUSH	DE
  DD72  FDE3          		EX	(SP),IY
  DD74  D1            		POP	DE
                      	;
  DD75  D5            		PUSH	DE
  DD76  CD82DD        		CALL	GETDRV
  DD79  3C            		INC	A
  DD7A  FD7700        		LD	(IY+0),A
  DD7D  3D            		DEC	A
  DD7E  CDD9EC        		CALL	_CHGDRV
                      	
  DD81  E9            		JP	(HL)
                      	
  DD82                	GETDRV:
  DD82  E67F          		AND	07FH
  DD84  D601          		SUB	001H
  DD86  3003          		JR	NC,GETDRV1
  DD88  3A87EC        		LD	A,(_DVSW)	;Current Drive
  DD8B                	GETDRV1:
  DD8B  3288EC        		LD	(_DRV),A
  DD8E  C9            		RET
                      	
  DD8F                	SOPENX:
  DD8F  CDF8DE        		CALL	CHKDDX
  DD92  3802          		JR	C,SOPENX1
  DD94  C1            		POP	BC
  DD95  E9            		JP	(HL)
  DD96                	SOPENX1:
  DD96  1135E2        		LD	DE,SFILE
  DD99  1A            		LD	A,(DE)
  DD9A  FDBE00        		CP	(IY+0)
  DD9D  2024          		JR	NZ,SOPEN
  DD9F  13            		INC	DE
  DDA0  FDE5          		PUSH	IY
  DDA2  E1            		POP	HL
  DDA3  23            		INC	HL
  DDA4  CD28DF        		CALL	CPFILE
  DDA7  201A          		JR	NZ,SOPEN
                      	
  DDA9  2A2FE2        		LD	HL,(SCDIR)
  DDAC  FD750E        		LD	(IY+14),L
  DDAF  FD740F        		LD	(IY+15),H
                      	
  DDB2  2A33E2        		LD	HL,(SFNDF)	;Direcroty location and Flags
  DDB5  229FEC        		LD	(_FILEN),HL
                      	
  DDB8  ED5B31E2      		LD	DE,(SFBPS)
  DDBC  2135E2        		LD	HL,SFILE
  DDBF  36FF          		LD	(HL),0FFH
  DDC1  23            		INC	HL
  DDC2  C9            		RET
  DDC3                	SOPEN:
  DDC3  21C0DE        		LD	HL,FILESE
  DDC6                	SOPENC:
  DDC6  2200DE        		LD	(OPENPAT+1),HL
                      	
  DDC9  CDE2EC        		CALL	_RDFATX		;Detect Media
  DDCC  3857          		JR	C,RDDERR
                      	
  DDCE  AF            		XOR	A
  DDCF  329FEC        		LD	(_FILEN),A
  DDD2                	SOPEN0:
  DDD2  CDA8DF        		CALL	LDDIRX
  DDD5  2819          		JR	Z,SDIRX1
                      	
  DDD7  CDB1DE        		CALL	DC		;Sub Directory
  DDDA  3808          		JR	C,SDIRX0
  DDDC  2A7EEC        		LD	HL,(_DTBUF)
  DDDF  7E            		LD	A,(HL)
  DDE0  FE2E          		CP	'.'
  DDE2  2810          		JR	Z,SOPEN1
  DDE4                	SDIRX0:
  DDE4  AF            		XOR	A
  DDE5  32A0EC        		LD	(_DIRF),A
  DDE8  FD360E01      		LD	(IY+14),1
  DDEC  FD360F00      		LD	(IY+15),0
  DDF0                	SDIRX1:
  DDF0  ED5B5BE2      		LD	DE,(_DIRPS)	;Root Directory
                      	
  DDF4                	SOPEN1:
  DDF4  0E20          	IBM1:	LD	C,32		;自己書き換え 1クラスタ辺りのディレクトリエントリ数  1024=32 / 512=16
  DDF6                	SOPEN1X:
  DDF6  CDB1DE        		CALL	DC		;FILE SEARCH
  DDF9  382A          		JR	C,RDDERR
  DDFB  2A7EEC        		LD	HL,(_DTBUF)
  DDFE                	SOPEN2:
  DDFE  D5            		PUSH	DE
  DDFF  CDC0DE        	OPENPAT:CALL	FILESE		;(Self-rewriting)
  DE02  D1            		POP	DE
  DE03  3876          		JR	C,SOPENE
  DE05  281B          		JR	Z,NOTSE
  DE07                	SOPEN3:
  DE07  3AA0EC        		LD	A,(_DIRF)
  DE0A  B7            		OR	A
  DE0B  200C          		JR	NZ,SOPEN5
                      	
  DE0D  CD5EDE        		CALL	ENDRDI
  DE10  280E          		JR	Z,SOPEN6
  DE12  3C            		INC	A
  DE13  200B          		JR	NZ,SOPEN6
  DE15  0E10          		LD	C,16
  DE17  18DD          		JR	SOPEN1X
  DE19                	SOPEN5:
  DE19  CDF7EC        		CALL	_GNCL	;END DIR
  DE1C  D8            		RET	C
  DE1D  CD64DF        		CALL	ENDCL
  DE20                	SOPEN6:
  DE20  38D2          		JR	C,SOPEN1
                      	
  DE22                	_SYS2B:
  DE22                	_SYS2D:
  DE22                	NOTSE:
  DE22  37            		SCF			;CF=1
  DE23  9F            		SBC	A,A		;A=0FFH
  DE24  C9            		RET
                      	
  DE25                	RDDERR:
  DE25  BF            		CP	A		;READ ERR CF=1 ZF=1
  DE26  37            		SCF
  DE27  C9            		RET
                      	
  DE28                	NOPEN:
  DE28  21C0DE        		LD	HL,FILESE
  DE2B  2200DE        		LD	(OPENPAT+1),HL
  DE2E  FD2A98EC      		LD	IY,(_FCB)
  DE32  CD91E0        		CALL	CHKWILDX
  DE35  30EB          		JR	NC,NOTSE
  DE37  FD7E00        		LD	A,(IY+0)
  DE3A  3D            		DEC	A
  DE3B  3288EC        		LD	(_DRV),A
  DE3E  CDD9EC        		CALL	_CHGDRV
  DE41  D8            		RET	C
                      	
  DE42  CDA8DF        		CALL	LDDIRX
  DE45  ED5B9AEC      		LD	DE,(_FBPS)
  DE49  CDB1DE        		CALL	DC
  DE4C  38D7          		JR	C,RDDERR
  DE4E  3A9EEC        		LD	A,(_FBCNT)
  DE51  3D            		DEC	A
  DE52  28B3          		JR	Z,SOPEN3
  DE54                	NOPEN2:
  DE54  2A9CEC        		LD	HL,(_FBAD)
  DE57  012000        		LD	BC,020H
  DE5A  09            		ADD	HL,BC
  DE5B  4F            		LD	C,A
  DE5C  18A0          		JR	SOPEN2
                      	
  DE5E                	ENDRDI:
  DE5E  3A5CDF        		LD	A,(DBLPAT)	;A=029H or 0
  DE61  E601          		AND	1
  DE63  4F            		LD	C,A
  DE64  3C            		INC	A
  DE65  83            		ADD	A,E
  DE66  5F            		LD	E,A
  DE67  D60C          	RTEPAT:	SUB	12		;(Self-rewriting)
  DE69  CB41          		BIT	0,C
  DE6B  C9            		RET
                      	
  DE6C                	SOPENE2:
  DE6C  229CEC        		LD	(_FBAD),HL
  DE6F  79            		LD	A,C
  DE70  329EEC        		LD	(_FBCNT),A
  DE73  ED539AEC      		LD	(_FBPS),DE
  DE77  FD2298EC      		LD	(_FCB),IY
  DE7B                	SOPENE:
  DE7B  AF            		XOR	A
  DE7C  C9            		RET
                      	
  DE7D                	COPEN:
  DE7D  FD360D20      		LD	(IY+13),020H		;Attribute
                      	
  DE81  21DDDE        		LD	HL,NEXTSE
  DE84  CDC6DD        		CALL	SOPENC
  DE87  D0            		RET	NC
  DE88  C8            		RET	Z
  DE89  3AA0EC        		LD	A,(_DIRF)
  DE8C  D601          		SUB	001H
  DE8E  D8            		RET	C
  DE8F  0601          		LD	B,1
  DE91  CD03E1        		CALL	WRDF
  DE94  D8            		RET	C
  DE95  ED5B5DE2      		LD	DE,(_CLPS)
  DE99  D5            		PUSH	DE
  DE9A  CD51DF        		CALL	DCPAT
  DE9D  CD2CE5        		CALL	DRDNX
  DEA0  2A7EEC        		LD	HL,(_DTBUF)
  DEA3  5D            		LD	E,L
  DEA4  54            		LD	D,H
  DEA5  13            		INC	DE		;DE,DTBUF+1
  DEA6  01FF03        		LD	BC,1023
  DEA9  AF            		XOR	A
  DEAA  77            		LD	(HL),A
  DEAB  E5            		PUSH	HL
  DEAC  EDB0          		LDIR
  DEAE  E1            		POP	HL
  DEAF  D1            		POP	DE
  DEB0  C9            		RET
                      	
  DEB1                	DC:
  DEB1  ED535DE2      		LD	(_CLPS),DE
  DEB5  C5            		PUSH	BC
  DEB6  D5            		PUSH	DE
  DEB7  CD51DF        		CALL	DCPAT
  DEBA  CD10E5        		CALL	DRDX
  DEBD  D1            		POP	DE
  DEBE  C1            		POP	BC
  DEBF  C9            		RET
                      	
  DEC0                	FILESE:
  DEC0  7E            		LD	A,(HL)
  DEC1  B7            		OR	A
  DEC2  C8            		RET	Z		;END:ZF=1 CF=0
  DEC3  FEE5          		CP	0E5H
  DEC5  280E          		JR	Z,FILESE1
  DEC7  FDE5          		PUSH	IY
  DEC9  D1            		POP	DE
  DECA  13            		INC	DE
  DECB  E5            		PUSH	HL
  DECC  CD28DF        		CALL	CPFILE
  DECF  CC49DF        		CALL	Z,CPFILE2
  DED2  E1            		POP	HL
  DED3  37            		SCF
  DED4  C8            		RET	Z		;!!!:(ZF=1) CF=1
  DED5                	FILESE1:
  DED5  CDECDE        		CALL	FNEXT
  DED8  20E6          		JR	NZ,FILESE
  DEDA                	ZFCF0:
  DEDA  F6FF          		OR	0FFH		;ZF=0 CF=0
  DEDC  C9            		RET
                      	
  DEDD                	NEXTSE:
  DEDD  7E            		LD	A,(HL)
  DEDE  B7            		OR	A
  DEDF  37            		SCF
  DEE0  C8            		RET	Z		;!!!:ZF=1 CF=1
  DEE1  FEE5          		CP	0E5H
  DEE3  37            		SCF
  DEE4  C8            		RET	Z		;!!!:(ZF=1) CF=1
  DEE5  CDECDE        		CALL	FNEXT
  DEE8  20F3          		JR	NZ,NEXTSE
  DEEA  18EE          		JR	ZFCF0
                      	
  DEEC                	FNEXT:
  DEEC  E5            		PUSH	HL
  DEED  219FEC        		LD	HL,_FILEN
  DEF0  34            		INC	(HL)
  DEF1  E1            		POP	HL
  DEF2  112000        		LD	DE,020H
  DEF5  19            		ADD	HL,DE
  DEF6  0D            		DEC	C
  DEF7  C9            		RET
                      	
  DEF8                	CHKDDX:
  DEF8  CD91E0        		CALL	CHKWILDX
  DEFB  D8            		RET	C
  DEFC  FDE5          		PUSH	IY
  DEFE  D1            		POP	DE
  DEFF  13            		INC	DE
  DF00  2162EC        		LD	HL,DDTB
  DF03  0604          		LD	B,DDS
  DF05                	CPNAME:
  DF05  C5            		PUSH	BC
  DF06  D5            		PUSH	DE
  DF07  1105E5        		LD	DE,CPBUF
  DF0A  010400        		LD	BC,4
  DF0D  EDB0          		LDIR
  DF0F  D1            		POP	DE
  DF10  D5            		PUSH	DE
  DF11  E5            		PUSH	HL
  DF12  2105E5        		LD	HL,CPBUF
  DF15  CD28DF        		CALL	CPFILE
  DF18  E1            		POP	HL
  DF19  D1            		POP	DE
  DF1A  C1            		POP	BC
  DF1B  2005          		JR	NZ,CPNAME1
  DF1D  7E            		LD	A,(HL)
  DF1E  23            		INC	HL
  DF1F  66            		LD	H,(HL)
  DF20  6F            		LD	L,A
  DF21  C9            		RET
  DF22                	CPNAME1:
  DF22  23            		INC	HL
  DF23  23            		INC	HL
  DF24  10DF          		DJNZ	CPNAME
  DF26  37            		SCF
  DF27  C9            		RET
                      	
  DF28                	CPFILE:
  DF28  C5            		PUSH	BC
  DF29  01000B        		LD	BC,00B00H
  DF2C                	CPSTR1:
  DF2C  1A            		LD	A,(DE)
  DF2D  FE3F          		CP	'?'		;Wild card
  DF2F  2812          		JR	Z,CPSTR2
  DF31  7E            		LD	A,(HL)
  DF32  CD77E0        		CALL	FKANC
  DF35  E5            		PUSH	HL
  DF36  67            		LD	H,A
  DF37  1A            		LD	A,(DE)
  DF38  CB01          		RLC	C
  DF3A  CD77E0        		CALL	FKANC
  DF3D  CB09          		RRC	C
  DF3F  BC            		CP	H		;CP (HL),(DE)
  DF40  E1            		POP	HL
  DF41  2004          		JR	NZ,CPSTR3
  DF43                	CPSTR2:
  DF43  13            		INC	DE
  DF44  23            		INC	HL
  DF45  10E5          		DJNZ	CPSTR1
  DF47                	CPSTR3:
  DF47  C1            		POP	BC
  DF48  C9            		RET
                      	
  DF49                	CPFILE2:
  DF49  FD7E0D        		LD	A,(IY+13)
  DF4C  F6E1          		OR	0E1H
  DF4E  2F            		CPL
  DF4F  A6            		AND	(HL)
  DF50  C9            		RET
                      	
  DF51                	DCPAT:
  DF51  2A7EEC        		LD	HL,(_DTBUF)
  DF54  3AA0EC        		LD	A,(_DIRF)
  DF57  B7            		OR	A
  DF58  C8            		RET	Z
                      	
  DF59                	CLUST:
  DF59  EB            		EX	DE,HL
  DF5A  3E08          	CLSPAT:	LD	A,8	;DE=DE+8 (2D)  !ADDCL (Self-rewriting)
  DF5C  29            	DBLPAT:	ADD	HL,HL	;DE=DE*2 (512) !DBLCL (Self-rewriting)
  DF5D  EB            		EX	DE,HL
  DF5E  83            		ADD	A,E
  DF5F  5F            		LD	E,A
  DF60  8A            		ADC	A,D
  DF61  93            		SUB	E
  DF62  57            		LD	D,A
  DF63  C9            		RET
                      	
  DF64                	ENDCL:
  DF64  7A            		LD	A,D	;END CLUSTER
  DF65  FE01          	CLPAT1:	CP	1	;164=356	(Self-rewriting)
  DF67  C0            		RET	NZ
  DF68  7B            		LD	A,E
  DF69  FE64          	CLPAT2:	CP	064H	;		(Self-rewriting)
  DF6B  C9            		RET
                      	
  DF6C                	CAP:
  DF6C  FE61          		CP	'a'
  DF6E  D8            		RET	C
  DF6F  FE7B          		CP	'z'+1
  DF71  D0            		RET	NC
  DF72  D620          		SUB	020H
  DF74  C9            		RET
  DF75                	CAP2:
  DF75  CD6CDF        		CALL	CAP
  DF78                	CAP3:
  DF78  CD81DF        		CALL	CAP4
  DF7B  FE21          		CP	021H
  DF7D  D0            		RET	NC
  DF7E  3EA0          		LD	A,0A0H
  DF80  C9            		RET
  DF81                	CAP4:
  DF81  FE05          		CP	5
  DF83  C0            		RET	NZ
  DF84  3EE5          		LD	A,0E5H
  DF86  C9            		RET
                      	
  DF87                	CHDIR:
  DF87  CD98E8        		CALL	GETDPBD
  DF8A  3806          		JR	C,CHDIR2
  DF8C  DD751A        		LD	(IX+01AH),L		;_SDIR_
  DF8F  DD741B        		LD	(IX+01BH),H		;_SDIR_+1
  DF92                	CHDIR2:
  DF92  DDE1          		POP	IX
  DF94  C9            		RET
                      	
  DF95                	LDDIR:
  DF95  CD98E8        		CALL	GETDPBD
  DF98  DD5E1A        		LD	E,(IX+01AH)		;_SDIR_
  DF9B  DD561B        		LD	D,(IX+01BH)		;_SDIR_+1
  DF9E  13            		INC	DE
  DF9F  FD730E        		LD	(IY+14),E
  DFA2  FD720F        		LD	(IY+15),D
  DFA5  1B            		DEC	DE
  DFA6  18EA          		JR	CHDIR2
                      	
  DFA8                	LDDIRX:
  DFA8  FD5E0E        		LD	E,(IY+14)
  DFAB  FD560F        		LD	D,(IY+15)
  DFAE  1B            		DEC	DE
  DFAF  CD64DF        		CALL	ENDCL
  DFB2  D495DF        		CALL	NC,LDDIR
  DFB5                	LDDIRS:
  DFB5  7A            		LD	A,D
  DFB6  B3            		OR	E
  DFB7  32A0EC        		LD	(_DIRF),A
  DFBA  C9            		RET
                      	
  DFBB                	KILL:
  DFBB  CD91E0        		CALL	CHKWILDX
  DFBE  383A          		JR	C,KILLW
  DFC0  CDF8DE        		CALL	CHKDDX
  DFC3  3F            		CCF
  DFC4  D496DD        		CALL	NC,SOPENX1
  DFC7                	KILLS:
  DFC7  3E1F          		LD	A,01FH
  DFC9  D40DE0        		CALL	NC,CHKATT
  DFCC  D8            		RET	C
  DFCD                	KILLSX:
  DFCD  36E5          		LD	(HL),0E5H	;DIR
  DFCF  CD6BE0        		CALL	WTDB
  DFD2  111A00        		LD	DE,01AH
  DFD5  19            		ADD	HL,DE
  DFD6  5E            		LD	E,(HL)
  DFD7  23            		INC	HL
  DFD8  56            		LD	D,(HL)
  DFD9  1804          		JR	KILLS2
  DFDB                	KILLS1:
  DFDB  ED5B5DE2      		LD	DE,(_CLPS)	;FAT
  DFDF                	KILLS2:
  DFDF  CD64DF        		CALL	ENDCL
  DFE2  D0            		RET	NC		;CF=0
  DFE3  21FEFF        		LD	HL,0-2
  DFE6  19            		ADD	HL,DE
  DFE7  D0            		RET	NC		;DE= 0 or 1
  DFE8  D5            		PUSH	DE
  DFE9  CDF7EC        		CALL	_GNCL
  DFEC  ED535DE2      		LD	(_CLPS),DE
  DFF0  D1            		POP	DE
  DFF1  210000        		LD	HL,0
  DFF4  D4FAEC        		CALL	NC,_SNCL
  DFF7  30E2          		JR	NC,KILLS1
  DFF9  C9            		RET
                      	
  DFFA                	KILLW:
  DFFA  CDC3DD        		CALL	SOPEN
  DFFD                	KILLW1:
  DFFD  380B          		JR	C,KILLW2
  DFFF  CD6CDE        		CALL	SOPENE2
  E002  CDC7DF        		CALL	KILLS
  E005  CD28DE        		CALL	NOPEN
  E008  18F3          		JR	KILLW1
  E00A                	KILLW2:
  E00A  C8            		RET	Z
  E00B  3F            		CCF
  E00C  C9            		RET
                      	
  E00D                	CHKATT:
  E00D  E5            		PUSH	HL
  E00E  110B00        		LD	DE,00BH
  E011  19            		ADD	HL,DE
  E012  A6            		AND	(HL)
  E013  E1            		POP	HL
  E014  C8            		RET	Z
  E015  37            		SCF
  E016  C9            		RET
                      	
  E017                	NAME:
  E017  CD91E0        		CALL	CHKWILDX
  E01A  D8            		RET	C
  E01B  110400        		LD	DE,4
  E01E  19            		ADD	HL,DE
  E01F  2237E0        		LD	(NAMEP+2),HL
  E022  23            		INC	HL
  E023  CD95E0        		CALL	CHKWILD
  E026  D8            		RET	C
                      	
  E027  CD96DD        		CALL	SOPENX1
  E02A  3E0F          		LD	A,00FH
  E02C  D40DE0        		CALL	NC,CHKATT
  E02F  D8            		RET	C
                      	
  E030  FD7E00        		LD	A,(IY+0)
  E033  FDE5          		PUSH	IY
  E035  FD210000      	NAMEP:	LD	IY,0
  E039  FD7700        		LD	(IY+0),A
  E03C  CD96DD        		CALL	SOPENX1
  E03F  FDE3          		EX	(SP),IY
  E041  3F            		CCF
  E042  D4C3DD        		CALL	NC,SOPEN
  E045  EB            		EX	DE,HL
  E046  E1            		POP	HL
  E047  D8            		RET	C
                      	
  E048                	SETNAME:
  E048  01000B        		LD	BC,11*256
  E04B  23            		INC	HL
  E04C  7E            		LD	A,(HL)
  E04D  FEE5          		CP	0E5H
  E04F  2004          		JR	NZ,SNAME1
  E051  3E05          		LD	A,5
  E053  180E          		JR	SNAME3
  E055                	SNAME1:
  E055  7E            		LD	A,(HL)
  E056  0C            		INC	C
  E057  0D            		DEC	C
  E058  2009          		JR	NZ,SNAME3
  E05A  CD6CDF        		CALL	CAP
  E05D  FEA0          		CP	0A0H
  E05F  2002          		JR	NZ,SNAME3
  E061  3E20          		LD	A,020H
  E063                	SNAME3:
  E063  12            		LD	(DE),A
  E064  7E            		LD	A,(HL)
  E065  23            		INC	HL
  E066  CD7EE0        		CALL	FKAN
  E069  10EA          		DJNZ	SNAME1
  E06B                	WTDB:
  E06B  3EFF          		LD	A,0FFH
  E06D  3235E2        		LD	(SFILE),A
  E070                	SWTDBF:
  E070  3E01          		LD	A,1
  E072  32A4EC        		LD	(_WTDBF),A
  E075  AF            		XOR	A
  E076  C9            		RET
                      	
  E077                	FKANC:
  E077  CB41          		BIT	0,C
  E079  CC75DF        		CALL	Z,CAP2
  E07C  1801          		JR	FKANX
  E07E                	FKAN:
  E07E  13            		INC	DE
  E07F                	FKANX:
  E07F  CB41          		BIT	0,C
  E081  CB81          		RES	0,C
  E083  C0            		RET	NZ
  E084  FE80          		CP	080H
  E086  D8            		RET	C
  E087  FEA0          		CP	0A0H
  E089  3803          		JR	C,FKAN1
  E08B  FEE0          		CP	0E0H
  E08D  D8            		RET	C
  E08E                	FKAN1:
  E08E  0C            		INC	C
  E08F  A7            		AND	A
  E090  C9            		RET
                      	
  E091                	CHKWILDX:
  E091  FDE5          		PUSH	IY
  E093  E1            		POP	HL
  E094  23            		INC	HL
  E095                	CHKWILD:
  E095  060B          		LD	B,11
  E097  3E3F          		LD	A,'?'
  E099                	CHKWIL1:
  E099  BE            		CP	(HL)
  E09A  23            		INC	HL
  E09B  37            		SCF
  E09C  C8            		RET	Z
  E09D  10FA          		DJNZ	CHKWIL1
  E09F  AF            		XOR	A
  E0A0  C9            		RET
                      	
  E0A1                	SDIRENT:		;IY=FCB HL=DIR
  E0A1  D5            		PUSH	DE
  E0A2  E5            		PUSH	HL
  E0A3  FDE5          		PUSH	IY
  E0A5  D1            		POP	DE
  E0A6  EB            		EX	DE,HL
  E0A7  CD48E0        		CALL	SETNAME
                      	;				Attribute
  E0AA  FD7E0D        		LD	A,(IY+13)
  E0AD  12            		LD	(DE),A
  E0AE  13            		INC	DE
                      	;				Reserved
  E0AF  AF            		XOR	A
  E0B0  060A          		LD	B,10
  E0B2                	SDE1:
  E0B2  12            		LD	(DE),A
  E0B3  13            		INC	DE
  E0B4  10FC          		DJNZ	SDE1
                      	;				TIME
  E0B6  FD7E16        		LD	A,(IY+22)
  E0B9  12            		LD	(DE),A
  E0BA  13            		INC	DE
  E0BB  FD7E17        		LD	A,(IY+23)
  E0BE  12            		LD	(DE),A
  E0BF  13            		INC	DE
                      	;				DATE
  E0C0  FD7E14        		LD	A,(IY+20)
  E0C3  12            		LD	(DE),A
  E0C4  13            		INC	DE
  E0C5  FD7E15        		LD	A,(IY+21)
  E0C8  12            		LD	(DE),A
  E0C9  13            		INC	DE
                      	;				First cluster
  E0CA  FD7E1A        		LD	A,(IY+26)
  E0CD  12            		LD	(DE),A
  E0CE  13            		INC	DE
  E0CF  FD7E1B        		LD	A,(IY+27)
  E0D2  12            		LD	(DE),A
  E0D3  13            		INC	DE
                      	;				SIZE
  E0D4  FD7E10        		LD	A,(IY+16)
  E0D7  12            		LD	(DE),A
  E0D8  13            		INC	DE
  E0D9  FD7E11        		LD	A,(IY+17)
  E0DC  12            		LD	(DE),A
  E0DD  13            		INC	DE
  E0DE  FD7E12        		LD	A,(IY+18)
  E0E1  12            		LD	(DE),A
  E0E2  13            		INC	DE
  E0E3  FD7E13        		LD	A,(IY+19)
  E0E6  12            		LD	(DE),A
                      	
  E0E7  AF            		XOR	A
  E0E8  E1            		POP	HL
  E0E9  D1            		POP	DE
  E0EA  C9            		RET
                      	
  E0EB                	WOPEN:
  E0EB  FD7E0D        		LD	A,(IY+13)
  E0EE  E61F          		AND	01FH
  E0F0  37            		SCF
  E0F1  C0            		RET	NZ
  E0F2  FD361CFE      		LD	(IY+28),0FEH	;Open
  E0F6                	TOPEN2:
  E0F6  AF            		XOR	A
  E0F7                	TOPEN:
  E0F7  FD3617FF      		LD	(IY+23),0FFH	;Initializes the time stamp
  E0FB  C9            		RET
                      	
  E0FC                	WRDFX:
  E0FC  41            		LD	B,C
  E0FD  04            		INC	B
  E0FE  3E37          		LD	A,037H
  E100  3229E5        		LD	(DRDN1),A
                      	
  E103                	WRDF:
  E103  110200        		LD	DE,2
  E106                	WRDF1:
  E106  C5            		PUSH	BC
  E107  D5            		PUSH	DE
  E108  CDF7EC        		CALL	_GNCL
  E10B  381C          		JR	C,WRDF3
  E10D  7A            		LD	A,D
  E10E  B3            		OR	E
  E10F  2027          		JR	NZ,WRDF4
  E111  E1            		POP	HL
  E112  E5            		PUSH	HL
  E113  ED5B5DE2      		LD	DE,(_CLPS)
  E117  225DE2        		LD	(_CLPS),HL
  E11A  7A            		LD	A,D
  E11B  B3            		OR	E
  E11C  2008          		JR	NZ,WRDF2
  E11E  FD751A        		LD	(IY+26),L	;Start cluster
  E121  FD741B        		LD	(IY+27),H
  E124  1803          		JR	WRDF3
  E126                	WRDF2:
  E126  CDFAEC        		CALL	_SNCL
  E129                	WRDF3:
  E129  D1            		POP	DE
  E12A  C1            		POP	BC
  E12B  D8            		RET	C
  E12C  100C          		DJNZ	WRDF5
  E12E  ED5B5DE2      		LD	DE,(_CLPS)
  E132  21FFFF        		LD	HL,0FFFFH
  E135  C3FAEC        		JP	_SNCL
                      	
  E138                	WRDF4:
  E138  D1            		POP	DE
  E139  C1            		POP	BC
  E13A                	WRDF5:
  E13A  13            		INC	DE
  E13B  CD64DF        		CALL	ENDCL
  E13E  38C6          		JR	C,WRDF1
  E140  37            		SCF
  E141  C9            		RET
                      	
  E142                	RWXR:
  E142  CB38          		SRL	B
  E144  CB19          		RR	C
  E146  CB38          	IBM4:	SRL	B	;自己書き換え 1024=SRL B / 512=JR +2(直後のRR Cを飛ばす)
  E148  CB19          		RR	C
                      	
  E14A  FD5E1A        		LD	E,(IY+26)	;Cluster
  E14D  FD561B        		LD	D,(IY+27)
  E150                	RWX1:
  E150  ED535DE2      		LD	(_CLPS),DE
  E154  7A            		LD	A,D
  E155  B3            		OR	E
  E156  37            		SCF
  E157  C8            		RET	Z
                      	
  E158  78            		LD	A,B
  E159  B1            		OR	C
  E15A  C8            		RET	Z
                      	
  E15B  CDF7EC        		CALL	_GNCL
  E15E  D8            		RET	C
  E15F  0B            		DEC	BC
  E160  CD64DF        		CALL	ENDCL
  E163  38EB          		JR	C,RWX1
  E165  37            		SCF
  E166  C9            		RET
                      	
  E167                	DSKF:
  E167  110000        	MAXCLP:	LD	DE,0
  E16A  210000        		LD	HL,0
  E16D                	DSKF1:
  E16D  D5            		PUSH	DE
  E16E  CDF7EC        		CALL	_GNCL
  E171  380C          		JR	C,POPSCF
  E173  7A            		LD	A,D
  E174  B3            		OR	E
  E175  2001          		JR	NZ,DSKF2
  E177  23            		INC	HL
  E178                	DSKF2:
  E178  D1            		POP	DE
  E179  1B            		DEC	DE
  E17A  7A            		LD	A,D
  E17B  B3            		OR	E
  E17C  20EF          		JR	NZ,DSKF1
  E17E  C9            		RET
                      	
  E17F                	POPSCF:
  E17F  F1            		POP	AF
  E180  37            		SCF
  E181  C9            		RET
                      	
  E182                	SETTMS:
  E182  FD7E17        		LD	A,(IY+23)
  E185  3C            		INC	A
  E186  C0            		RET	NZ
  E187                	SETTMSX:
  E187  CDDBD7        		CALL	_SYS2C
                      	
  E18A  CB25          		SLA	L
  E18C  CB25          		SLA	L
  E18E  29            		ADD	HL,HL
  E18F  29            		ADD	HL,HL
  E190  29            		ADD	HL,HL
  E191  7A            		LD	A,D
  E192  0F            		RRCA
  E193  E61F          		AND	01FH
  E195  B5            		OR	L
  E196  6F            		LD	L,A
  E197  FD7516        		LD	(IY+22),L
  E19A  FD7417        		LD	(IY+23),H
                      	
  E19D  CDA1D7        		CALL	_SYS2A
                      	
  E1A0  0144F8        		LD	BC,0-1980
  E1A3  09            		ADD	HL,BC
  E1A4  65            		LD	H,L
                      	
  E1A5  7A            		LD	A,D
  E1A6  87            		ADD	A,A
  E1A7  87            		ADD	A,A
  E1A8  87            		ADD	A,A
  E1A9  87            		ADD	A,A
  E1AA  6F            		LD	L,A
  E1AB  29            		ADD	HL,HL
  E1AC  7D            		LD	A,L
  E1AD  B3            		OR	E
  E1AE  6F            		LD	L,A
  E1AF  FD7514        		LD	(IY+20),L
  E1B2  FD7415        		LD	(IY+21),H
  E1B5  C9            		RET
                      	
  E1B6                	PUSHRR:
  E1B6  CDBCE1        		CALL	SUBRR
  E1B9                	POPRR1:
  E1B9  EDB0          		LDIR
  E1BB  C9            		RET
                      	
  E1BC                	SUBRR:
  E1BC  FDE5          		PUSH	IY
  E1BE  E1            		POP	HL
  E1BF  112100        		LD	DE,33
  E1C2  19            		ADD	HL,DE
  E1C3  1156E2        		LD	DE,HLBUF
  E1C6  010300        		LD	BC,3
  E1C9  C9            		RET
                      	
  E1CA                	SETSEQ:
  E1CA  F5            		PUSH	AF
  E1CB  FD7E21        		LD	A,(IY+33)
  E1CE  FD6E22        		LD	L,(IY+34)
  E1D1  FD6623        		LD	H,(IY+35)
                      	
  E1D4  CDF0E1        		CALL	SSQ1
                      	
  E1D7  29            		ADD	HL,HL
  E1D8  CB3D          		SRL	L
  E1DA  FD7520        		LD	(IY+32),L
  E1DD  FD740C        		LD	(IY+12),H
  E1E0  F1            		POP	AF
                      	
  E1E1                	POPRR:
  E1E1  CDBCE1        		CALL	SUBRR
  E1E4  EB            		EX	DE,HL
  E1E5  18D2          		JR	POPRR1
                      	
  E1E7                	GETSIZE:
  E1E7  FD7E10        		LD	A,(IY+16)
  E1EA  FD6E11        		LD	L,(IY+17)
  E1ED  FD6612        		LD	H,(IY+18)
  E1F0                	SSQ1:
  E1F0  87            		ADD	A,A
  E1F1  ED6A          		ADC	HL,HL
  E1F3  B7            		OR	A
  E1F4  C8            		RET	Z
  E1F5  23            		INC	HL
  E1F6  C9            		RET
                      	
  E1F7                	GETSEQ:
  E1F7  FD6E20        		LD	L,(IY+32)
  E1FA  FD660C        		LD	H,(IY+12)
                      	
  E1FD  CB25          		SLA	L
                      	
  E1FF  CB3C          		SRL	H
  E201  CB1D          		RR	L
  E203  C9            		RET
                      	
  E204                	SETRBR:
  E204  AF            		XOR	A	;HLA = HL*128
  E205  CB3C          		SRL	H
  E207  CB1D          		RR	L
  E209  1F            		RRA
  E20A  FD7721        		LD	(IY+33),A
  E20D  FD7522        		LD	(IY+34),L
  E210  FD7423        		LD	(IY+35),H
  E213  218000        		LD	HL,128
  E216  C9            		RET
                      	
  E217                	K_DE26:
  E217  ED5B4CEC      		LD	DE,(STABLE+2*026H)
  E21B  1804          		JR	K_DE1
  E21D                	K_DE27:
  E21D  ED5B4EEC      		LD	DE,(STABLE+2*027H)
  E221                	K_DE1:
  E221  CD29E2        		CALL	K_DE
                      	;	EX	DE,IY
  E224  D5            		PUSH	DE
  E225  FDE3          		EX	(SP),IY
  E227  D1            		POP	DE
                      	;
  E228  C9            		RET
  E229                	K_DE:
                      	;	EX	DE,IY
  E229  D5            		PUSH	DE
  E22A  FDE3          		EX	(SP),IY
  E22C  D1            		POP	DE
  E22D  FDE9          		JP	(IY)
                      	
  E22F                	SCDIR:	DS	2		;+14 +15
  E231                	SFBPS:	DS	2		;FBPS
  E233                	SFNDF:	DS	2		;FILEN DIRF
  E235                	SFILE:	DS	33		;DRV FILENAME
  E256                	HLBUF:	DS	3		;Random record buffer
                      	
  E259  0000          	_FATPS:	DW	0
  E25B  0000          	_DIRPS:	DW	0
  E25D  0000          	_CLPS:	DW	0
                      	
                      	;LDFILE2.ASM
                      	
                      	;	LSX-Dodgers FILE2
                      	
  E25F                	RBWDD:
  E25F  E5            		PUSH	HL
  E260  C1            		POP	BC
  E261  2139E3        		LD	HL,NUL
  E264  CD6DE3        		CALL	DDX
  E267  2003          		JR	NZ,RBWDD2
  E269  2A08EC        		LD	HL,(STABLE+2*4)
  E26C                	RBWDD2:
  E26C  FE43          		CP	'C'
  E26E  2003          		JR	NZ,RBWDD3
  E270  21CDD9        		LD	HL,PRINTS
  E273                	RBWDD3:
  E273  FE50          		CP	'P'
  E275  2003          		JR	NZ,RBWDD4
  E277  2A0AEC        		LD	HL,(STABLE+2*5)
  E27A                	RBWDD4:
  E27A  2288E2        		LD	(RBWDDP+1),HL
  E27D  2A8AEC        		LD	HL,(_DTA)
  E280                	RBWDD1:
  E280  78            		LD	A,B
  E281  B1            		OR	C
  E282                	RBWDD5:
  E282  CA34E3        		JP	Z,RBW1
  E285  5E            		LD	E,(HL)
  E286  23            		INC	HL
  E287  CDB2D6        	RBWDDP:	CALL	_SYS02
  E28A  DA50E3        		JP	C,RBRERR
  E28D  3E1A          		LD	A,01AH
  E28F  BB            		CP	E
  E290  28F0          		JR	Z,RBWDD5
  E292  0B            		DEC	BC
  E293  18EB          		JR	RBWDD1
                      	
                      					;Write random block
  E295                	_SYS26:
  E295  AF            		XOR	A
  E296  3229E5        		LD	(DRDN1),A
  E299  22E3E4        		LD	(LEFT+1),HL	;Write record byte
  E29C  2205E5        		LD	(LEFTX),HL
  E29F  CD6DDD        		CALL	SETDRV
                      	
  E2A2  CD57E4        		CALL	RBX0
  E2A5  DA3BE3        		JP	C,RBWERR
  E2A8  28B5          		JR	Z,RBWDD
  E2AA  CDEBE0        		CALL	WOPEN
  E2AD  DA3BE3        		JP	C,RBWERR
  E2B0  7C            		LD	A,H
  E2B1  B5            		OR	L
  E2B2  CA34E3        		JP	Z,RBW1
                      	
  E2B5  2B            		DEC	HL
                      	
  E2B6  CDFBE4        		CALL	CDERR		;CDE=Random record
                      	
  E2B9  AF            		XOR	A
  E2BA  19            		ADD	HL,DE
  E2BB  89            		ADC	A,C
  E2BC  47            		LD	B,A
  E2BD  4C            		LD	C,H
  E2BE  CD42E1        		CALL	RWXR
  E2C1  DCFCE0        		CALL	C,WRDFX
  E2C4  DA3BE3        		JP	C,RBWERR
                      	
  E2C7  CD80E4        		CALL	RBX2
  E2CA  281A          		JR	Z,RBWB
  E2CC  CD93E4        		CALL	RBXA
  E2CF  386A          		JR	C,RBWERR
  E2D1  EB            		EX	DE,HL
  E2D2  C5            		PUSH	BC
  E2D3  EDB0          		LDIR
  E2D5  2207E5        		LD	(DTAX),HL
                      	
  E2D8  CD70E0        		CALL	SWTDBF
                      	
  E2DB  2A05E5        		LD	HL,(LEFTX)
  E2DE  D1            		POP	DE
  E2DF  ED52          		SBC	HL,DE
  E2E1  2205E5        		LD	(LEFTX),HL
  E2E4  282E          		JR	Z,RBWEND
                      	
  E2E6                	RBWB:
  E2E6  CDC7E4        		CALL	RBXB
  E2E9  2813          		JR	Z,RBWC
  E2EB                	RBWB1:
  E2EB  C5            		PUSH	BC
  E2EC  D5            		PUSH	DE
  E2ED  CD59DF        		CALL	CLUST
  E2F0  CD33E7        		CALL	DWTC
  E2F3  D1            		POP	DE
  E2F4  C1            		POP	BC
  E2F5  3844          		JR	C,RBWERR
  E2F7  CDF7EC        		CALL	_GNCL
  E2FA  383F          		JR	C,RBWERR
  E2FC  10ED          		DJNZ	RBWB1
  E2FE                	RBWC:
  E2FE  CDD7E4        		CALL	RBXC
  E301  2811          		JR	Z,RBWEND
                      	
  E303  CD59DF        		CALL	CLUST
  E306  CD28E5        		CALL	DRDN
  E309  3830          		JR	C,RBWERR
  E30B  ED5B7EEC      		LD	DE,(_DTBUF)
  E30F  EDB0          		LDIR
  E311  CD70E0        		CALL	SWTDBF
  E314                	RBWEND:
  E314  CDE2E4        		CALL	RBXEND
                      	
  E317  CD66E4        		CALL	RBX1
  E31A  3018          		JR	NC,RBW1
  E31C  2AE3E4        		LD	HL,(LEFT+1)
  E31F  FD5E10        		LD	E,(IY+16)	;CDE=File size
  E322  FD5611        		LD	D,(IY+17)
  E325  FD4E12        		LD	C,(IY+18)
  E328  AF            		XOR	A
  E329  19            		ADD	HL,DE
  E32A  89            		ADC	A,C
  E32B  FD7510        		LD	(IY+16),L
  E32E  FD7411        		LD	(IY+17),H
  E331  FD7712        		LD	(IY+18),A
  E334                	RBW1:
  E334  FDE1          		POP	IY
  E336  C1            		POP	BC
  E337  D1            		POP	DE
  E338  E1            		POP	HL
  E339                	NUL:
  E339  AF            		XOR	A
  E33A  C9            		RET
                      	
  E33B                	RBWERR:
  E33B  FDE5          		PUSH	IY
  E33D  D1            		POP	DE
  E33E  2A20EC        		LD	HL,(STABLE+2*010H)
  E341  CD0F00        		CALL	JP_HL
  E344                	RBRERR1:
  E344  3E01          		LD	A,001H
  E346                	RBRERR2:
  E346  FDE1          		POP	IY
  E348  C1            		POP	BC
  E349  D1            		POP	DE
  E34A  E1            		POP	HL
  E34B  37            		SCF
  E34C  210000        		LD	HL,0
  E34F  C9            		RET
                      	
  E350                	RBRERR:
  E350  3EFF          		LD	A,0FFH
  E352  18F2          		JR	RBRERR2
                      	
  E354                	RBRFL:
  E354  3E00          	RBRFLP:	LD	A,000H
  E356  FE0D          		CP	00DH
  E358  2005          		JR	NZ,RBRFL1
  E35A  D5            		PUSH	DE
  E35B  1E0A          		LD	E,00AH
  E35D  1805          		JR	RBRFL2
  E35F                	RBRFL1:
  E35F  D5            		PUSH	DE
  E360  CDF8D9        		CALL	_SYS07
  E363  5F            		LD	E,A
  E364                	RBRFL2:
  E364  CDCDEC        		CALL	_PRINT
  E367  7B            		LD	A,E
  E368  D1            		POP	DE
  E369  3255E3        		LD	(RBRFLP+1),A
  E36C  C9            		RET
  E36D                	DDX:
  E36D  FD7E01        		LD	A,(IY+1)
  E370  CD6CDF        		CALL	CAP
  E373  FE41          		CP	'A'
  E375  C9            		RET
                      	
  E376                	RBRDD:
  E376  E5            		PUSH	HL
  E377  C1            		POP	BC
  E378  2154E3        		LD	HL,RBRFL
  E37B  CD6DE3        		CALL	DDX
  E37E  2005          		JR	NZ,RBRDD2
  E380  2A06EC        		LD	HL,(STABLE+2*3)
  E383  1804          		JR	RBRDD3
  E385                	RBRDD2:
  E385  FE43          		CP	'C'
  E387  202C          		JR	NZ,RBRDERR
  E389                	RBRDD3:
  E389  2299E3        		LD	(RBRDDP+1),HL
                      	
  E38C  ED5B8AEC      		LD	DE,(_DTA)
  E390  210000        		LD	HL,0
  E393                	RBRDD1:
  E393  78            		LD	A,B
  E394  B1            		OR	C
  E395  2818          		JR	Z,RBRDDE1
  E397  23            		INC	HL
  E398  CD54E3        	RBRDDP:	CALL	RBRFL
  E39B  380D          		JR	C,RBRDDE
  E39D  FE1A          		CP	01AH
  E39F  2809          		JR	Z,RBRDDE
  E3A1  FE03          		CP	3
  E3A3  2805          		JR	Z,RBRDDE
  E3A5  12            		LD	(DE),A
  E3A6  13            		INC	DE
  E3A7  0B            		DEC	BC
  E3A8  18E9          		JR	RBRDD1
                      	
  E3AA                	RBRDDE:
  E3AA  3E1A          		LD	A,01AH
  E3AC  12            		LD	(DE),A
  E3AD                	RBRDDE2:
  E3AD  AF            		XOR	A
  E3AE  3C            		INC	A
  E3AF                	RBRDDE1:
  E3AF  3243E4        		LD	(RBRAP+1),A
  E3B2  C33CE4        		JP	RBREND0
  E3B5                	RBRDERR:
  E3B5  210000        		LD	HL,0
  E3B8  18F3          		JR	RBRDDE2
                      	
                      					;Read random block
  E3BA                	_SYS27:
  E3BA  2205E5        		LD	(LEFTX),HL
  E3BD  CD6DDD        		CALL	SETDRV
                      	
  E3C0  FDCB0D66      		BIT	4,(IY+13)
  E3C4  C245E4        		JP	NZ,RBRDIR
  E3C7  CD57E4        		CALL	RBX0
  E3CA  DA50E3        		JP	C,RBRERR
  E3CD  28A7          		JR	Z,RBRDD
  E3CF  CD66E4        		CALL	RBX1
  E3D2  DA44E3        		JP	C,RBRERR1
  E3D5  79            		LD	A,C
  E3D6  EB            		EX	DE,HL
  E3D7  ED52          		SBC	HL,DE		;CP 0HL,CDE
  E3D9  19            		ADD	HL,DE
  E3DA  DE00          		SBC	A,000H
  E3DC  3801          		JR	C,RBR1
  E3DE  EB            		EX	DE,HL
  E3DF                	RBR1:
  E3DF  9F            		SBC	A,A
  E3E0  E601          		AND	1
  E3E2  3243E4        		LD	(RBRAP+1),A
                      	
  E3E5  7C            		LD	A,H
  E3E6  B5            		OR	L
  E3E7  CA3CE4        		JP	Z,RBREND0
                      	
  E3EA  22E3E4        		LD	(LEFT+1),HL	;Read record byte
  E3ED  2205E5        		LD	(LEFTX),HL
                      	
  E3F0  CD80E4        		CALL	RBX2
  E3F3  2819          		JR	Z,RBRB
  E3F5  CD93E4        		CALL	RBXA
  E3F8  DA50E3        		JP	C,RBRERR
  E3FB  C5            		PUSH	BC
  E3FC  EDB0          		LDIR
  E3FE  ED5307E5      		LD	(DTAX),DE
  E402  2A05E5        		LD	HL,(LEFTX)
  E405  D1            		POP	DE
  E406  A7            		AND	A
  E407  ED52          		SBC	HL,DE
  E409  2205E5        		LD	(LEFTX),HL
  E40C  282B          		JR	Z,RBREND
                      	
  E40E                	RBRB:
  E40E  CDC7E4        		CALL	RBXB
  E411  2812          		JR	Z,RBRC
  E413                	RBRB1:
  E413  C5            		PUSH	BC
  E414  D5            		PUSH	DE
  E415  CD59DF        		CALL	CLUST
  E418  CD27E7        		CALL	DRDC
  E41B  D1            		POP	DE
  E41C  C1            		POP	BC
  E41D  D4F7EC        		CALL	NC,_GNCL
  E420  DA50E3        		JP	C,RBRERR
  E423  10EE          		DJNZ	RBRB1
  E425                	RBRC:
  E425  CDD7E4        		CALL	RBXC
  E428  280F          		JR	Z,RBREND
                      	
  E42A  CD59DF        		CALL	CLUST
  E42D  CD10E5        		CALL	DRDX
  E430  DA50E3        		JP	C,RBRERR
  E433  EB            		EX	DE,HL
  E434  2A7EEC        		LD	HL,(_DTBUF)
  E437  EDB0          		LDIR
  E439                	RBREND:
  E439  CDE2E4        		CALL	RBXEND
  E43C                	RBREND0:
  E43C  FDE1          		POP	IY
  E43E  C1            		POP	BC
  E43F  D1            		POP	DE
  E440  F1            		POP	AF	;(HL)
  E441  AF            		XOR	A
  E442  3E00          	RBRAP:	LD	A,000H
  E444  C9            		RET
                      	
  E445                	RBRDIR:
  E445  FD6E1A        		LD	L,(IY+26)
  E448  FD661B        		LD	H,(IY+27)
  E44B  CD87DF        		CALL	CHDIR
  E44E  AF            		XOR	A
  E44F  67            		LD	H,A
  E450  6F            		LD	L,A
  E451  3C            		INC	A
  E452  3243E4        		LD	(RBRAP+1),A
  E455  18E5          		JR	RBREND0
                      	
  E457                	RBX0:
  E457  2A8AEC        		LD	HL,(_DTA)
  E45A  2207E5        		LD	(DTAX),HL
  E45D  2A05E5        		LD	HL,(LEFTX)
  E460  FD7E1C        		LD	A,(IY+28)	;Open
  E463  D6FD          		SUB	0FDH
  E465  C9            		RET
                      	
  E466                	RBX1:
  E466  E5            		PUSH	HL		;Record byte
                      	
  E467  FD6E10        		LD	L,(IY+16)	;AHL=File size
  E46A  FD6611        		LD	H,(IY+17)
  E46D  FD7E12        		LD	A,(IY+18)
                      	
  E470  CDFBE4        		CALL	CDERR		;CDE=Random record
                      	
  E473  A7            		AND	A
  E474  ED52          		SBC	HL,DE
  E476  99            		SBC	A,C
  E477  D1            		POP	DE
                      	
  E478  D8            		RET	C
  E479  4F            		LD	C,A
  E47A  EB            		EX	DE,HL	;CDE=File byte	HL=Record byte
  E47B  B2            		OR	D
  E47C  B3            		OR	E
  E47D  C0            		RET	NZ
  E47E  37            		SCF
  E47F  C9            		RET
                      	
  E480                	RBX2:
  E480  FD4E22        		LD	C,(IY+34)	;Cluster settings
  E483  FD4623        		LD	B,(IY+35)
  E486  CD42E1        		CALL	RWXR
  E489  3AA8E4        		LD	A,(IBM5+1)	;1024=3 / 512=1
  E48C  FDA622        		AND	(IY+34)
  E48F  FDB621        		OR	(IY+33)
  E492  C9            		RET
                      	
  E493                	RBXA:
  E493  D5            		PUSH	DE
  E494  CD59DF        		CALL	CLUST
  E497  CD10E5        		CALL	DRDX
  E49A  D1            		POP	DE
  E49B  D8            		RET	C
  E49C  CDF7EC        		CALL	_GNCL
  E49F  D8            		RET	C
  E4A0  ED535DE2      		LD	(_CLPS),DE
                      	
  E4A4  FD4E21        		LD	C,(IY+33)
  E4A7  3E03          	IBM5:	LD	A,3		;自己書き換え 1024=3 / 512=1
  E4A9  FDA622        		AND	(IY+34)
  E4AC  47            		LD	B,A
  E4AD  210004        	IBM7:	LD	HL,1024		;自己書き換え 1024=0400H / 512=0200H ここに1クラスタのサイズが格納される
  E4B0  ED42          		SBC	HL,BC		;remaining cluster
                      	
  E4B2  ED5B05E5      		LD	DE,(LEFTX)
  E4B6  ED52          		SBC	HL,DE		;CP HL,DE
  E4B8  19            		ADD	HL,DE
  E4B9  3801          		JR	C,RBXA1
  E4BB  EB            		EX	DE,HL
  E4BC                	RBXA1:
  E4BC  E5            		PUSH	HL
  E4BD  2A7EEC        		LD	HL,(_DTBUF)
  E4C0  09            		ADD	HL,BC
  E4C1  ED5B07E5      		LD	DE,(DTAX)
  E4C5  C1            		POP	BC
  E4C6  C9            		RET
                      	
  E4C7                	RBXB:
  E4C7  2A07E5        		LD	HL,(DTAX)
  E4CA  ED5B5DE2      		LD	DE,(_CLPS)
  E4CE  3A06E5        		LD	A,(LEFTX+1)
  E4D1  CB3F          		SRL	A
  E4D3  CB3F          	IBM8:	SRL	A		;自己書き換え 1024=SRL A / 512=NOP NOP
  E4D5  47            		LD	B,A
  E4D6  C9            		RET
                      	
  E4D7                	RBXC:
  E4D7  ED4B05E5      		LD	BC,(LEFTX)
  E4DB  3AA8E4        		LD	A,(IBM5+1)	;1024=3 / 512=1
  E4DE  A0            		AND	B
  E4DF  47            		LD	B,A
  E4E0  B1            		OR	C
  E4E1  C9            		RET
                      	
  E4E2                	RBXEND:
  E4E2  110000        	LEFT:	LD	DE,0
  E4E5  AF            		XOR	A
  E4E6  FD6E21        		LD	L,(IY+33)
  E4E9  FD6622        		LD	H,(IY+34)
  E4EC  19            		ADD	HL,DE
  E4ED  FD8E23        		ADC	A,(IY+35)
  E4F0  FD7521        		LD	(IY+33),L
  E4F3  FD7422        		LD	(IY+34),H
  E4F6  FD7723        		LD	(IY+35),A
  E4F9  EB            		EX	DE,HL		;HL=Read byte
  E4FA  C9            		RET
                      	
  E4FB                	CDERR:
  E4FB  FD5E21        		LD	E,(IY+33)	;CDE=Random record
  E4FE  FD5622        		LD	D,(IY+34)
  E501  FD4E23        		LD	C,(IY+35)
  E504  C9            		RET
                      	
  E505                	CPBUF:
  E505  0000          	LEFTX:	DW	0
  E507  0000          	DTAX:	DW	0
  E509  20            		DB	020H	;DS 7,20h
  E50A  20            		DB	020H
  E50B  20            		DB	020H
  E50C  20            		DB	020H
  E50D  20            		DB	020H
  E50E  20            		DB	020H
  E50F  20            		DB	020H
                      	;
                      	;LDDIO.ASM
                      	
                      	;	LSX-Dodgers DIO
                      	
  E510                	DRDX:
  E510  CD46E5        		CALL	DRDY
  E513  C8            		RET	Z
  E514  CD30E5        		CALL	DRDX1
  E517  D8            		RET	C
  E518  E5            		PUSH	HL
  E519  C5            		PUSH	BC
  E51A  D5            		PUSH	DE
  E51B  2A7EEC        		LD	HL,(_DTBUF)
  E51E  CD27E7        		CALL	DRDC
  E521  DC41E5        		CALL	C,DRDNE
  E524                	POP_DE_BC_HL_RET:
  E524  D1            		POP	DE
  E525  C1            		POP	BC
  E526  E1            		POP	HL
  E527  C9            		RET
                      	
  E528                	DRDN:
  E528  AF            		XOR	A
  E529  00            	DRDN1:	NOP
  E52A  30E4          		JR	NC,DRDX
  E52C                	DRDNX:
  E52C  CD46E5        		CALL	DRDY
  E52F  C8            		RET	Z
  E530                	DRDX1:
  E530  CD57E5        		CALL	DWTX
  E533  ED53A6EC      		LD	(_DCLPS),DE
  E537  3A88EC        		LD	A,(_DRV)
  E53A  32A5EC        		LD	(_DBDRV),A
  E53D  CDD9EC        		CALL	_CHGDRV
  E540  D0            		RET	NC
  E541                	DRDNE:
  E541  9F            		SBC	A,A
  E542  32A5EC        		LD	(_DBDRV),A
  E545  C9            		RET
                      	
  E546                	DRDY:
  E546  E5            		PUSH	HL
  E547  3A88EC        		LD	A,(_DRV)
  E54A  21A5EC        		LD	HL,_DBDRV
  E54D  AE            		XOR	(HL)
  E54E  2005          		JR	NZ,POP_HL_RET
                      	
  E550  2AA6EC        		LD	HL,(_DCLPS)
  E553  ED52          		SBC	HL,DE		;CF=0
  E555                	POP_HL_RET:
  E555  E1            		POP	HL
  E556  C9            		RET
                      	
  E557                	DWTX:
  E557  3AA4EC        		LD	A,(_WTDBF)
  E55A  B7            		OR	A
  E55B  C8            		RET	Z
  E55C  AF            		XOR	A
  E55D  32A4EC        		LD	(_WTDBF),A
                      	
  E560  E5            		PUSH	HL
  E561  C5            		PUSH	BC
  E562  D5            		PUSH	DE
  E563  3AA5EC        		LD	A,(_DBDRV)
  E566  CDD9EC        		CALL	_CHGDRV
  E569  ED5BA6EC      		LD	DE,(_DCLPS)
  E56D  2A7EEC        		LD	HL,(_DTBUF)
  E570  D433E7        		CALL	NC,DWTC
  E573  18AF          		JR	POP_DE_BC_HL_RET
                      	
  E575                	RDFATX:
  E575  E5            		PUSH	HL
  E576  3A88EC        		LD	A,(_DRV)
  E579  21A3EC        		LD	HL,_FATDRV
  E57C  AE            		XOR	(HL)
  E57D  E67F          		AND	07FH
  E57F  28D4          		JR	Z,POP_HL_RET
                      	
  E581  C5            		PUSH	BC
  E582  D5            		PUSH	DE
  E583  DDE5          		PUSH	IX
  E585  CD9DE5        		CALL	WTFATX
  E588  380F          		JR	C,RDFATE1
                      	
  E58A  3A88EC        		LD	A,(_DRV)
  E58D  32A3EC        		LD	(_FATDRV),A
  E590  CDE5EC        		CALL	_RDFAT
  E593                	RDFATE2:
  E593  3004          		JR	NC,RDFATE1
  E595  9F            		SBC	A,A
  E596  32A3EC        		LD	(_FATDRV),A
  E599                	RDFATE1:
  E599  DDE1          		POP	IX
  E59B  1887          		JR	POP_DE_BC_HL_RET
                      	
  E59D                	WTFATX:
  E59D  3AA2EC        		LD	A,(_WTFATF)
  E5A0  B7            		OR	A
  E5A1  C8            		RET	Z
  E5A2  E5            		PUSH	HL
  E5A3  3AA3EC        		LD	A,(_FATDRV)
  E5A6  21A5EC        		LD	HL,_DBDRV
  E5A9  AE            		XOR	(HL)
  E5AA  E67F          		AND	07FH
  E5AC  CC57E5        		CALL	Z,DWTX
  E5AF  38A4          		JR	C,POP_HL_RET
  E5B1  C5            		PUSH	BC
  E5B2  D5            		PUSH	DE
  E5B3  DDE5          		PUSH	IX
  E5B5  CD87E7        		CALL	WTFAT
  E5B8  AF            		XOR	A
  E5B9  32A2EC        		LD	(_WTFATF),A
  E5BC  18DB          		JR	RDFATE1
                      	
  E5BE                	NCL1:
  E5BE  7A            		LD	A,D
  E5BF  B3            		OR	E
  E5C0  37            		SCF
  E5C1  C8            		RET	Z
                      	
  E5C2  3A88EC        		LD	A,(_DRV)
  E5C5  CB5A          		BIT	3,D
  E5C7  2802          		JR	Z,NCL2
  E5C9  F680          		OR	080H
  E5CB                	NCL2:
  E5CB  E5            		PUSH	HL
  E5CC  21A3EC        		LD	HL,_FATDRV
  E5CF  BE            		CP	(HL)
  E5D0  2883          		JR	Z,POP_HL_RET
                      	
  E5D2  C5            		PUSH	BC
  E5D3  D5            		PUSH	DE
  E5D4  DDE5          		PUSH	IX
  E5D6  F5            		PUSH	AF
  E5D7  CD9DE5        		CALL	WTFATX
  E5DA  C1            		POP	BC
  E5DB  38BC          		JR	C,RDFATE1
  E5DD  78            		LD	A,B
  E5DE  32A3EC        		LD	(_FATDRV),A
  E5E1  CD76E7        		CALL	RDFATS
  E5E4  18AD          		JR	RDFATE2
                      	
  E5E6                	NCL3:
  E5E6  CB9A          		RES	3,D
  E5E8  6B            		LD	L,E
  E5E9  62            		LD	H,D
  E5EA  CB3C          		SRL	H
  E5EC  CB1D          		RR	L
  E5EE  1F            		RRA
  E5EF  ED4B7CEC      		LD	BC,(_FATBF)
  E5F3  19            		ADD	HL,DE
  E5F4  09            		ADD	HL,BC
  E5F5  17            		RLA
  E5F6  C9            		RET
                      	
  E5F7                	GNCL:
  E5F7  CDBEE5        		CALL	NCL1		;GET NEW CLUSTER
  E5FA  D8            		RET	C
  E5FB  C5            		PUSH	BC
  E5FC  E5            		PUSH	HL
  E5FD  CDE6E5        		CALL	NCL3
  E600  3809          		JR	C,GNC1
  E602  5E            		LD	E,(HL)
  E603  23            		INC	HL
  E604  7E            		LD	A,(HL)
  E605  E60F          		AND	00FH
  E607  57            		LD	D,A
  E608  E1            		POP	HL
  E609  C1            		POP	BC
  E60A  C9            		RET
  E60B                	GNC1:
  E60B  7E            		LD	A,(HL)
  E60C  23            		INC	HL
  E60D  56            		LD	D,(HL)
  E60E  0604          		LD	B,4
  E610                	GNC1L:
  E610  CB3A          		SRL	D
  E612  1F            		RRA
  E613  10FB          		DJNZ	GNC1L
                      	
  E615  5F            		LD	E,A
  E616  E1            		POP	HL
  E617  C1            		POP	BC
  E618  A7            		AND	A
  E619  C9            		RET
                      	
  E61A                	SNCL:
  E61A  CDBEE5        		CALL	NCL1
  E61D  D8            		RET	C
  E61E  3E01          		LD	A,1
  E620  32A2EC        		LD	(_WTFATF),A
                      	;				SET NEW CLUSTER
  E623  E5            		PUSH	HL
  E624  C5            		PUSH	BC
  E625  D5            		PUSH	DE
  E626  E5            		PUSH	HL
  E627  CDE6E5        		CALL	NCL3
  E62A  D1            		POP	DE
                      	;CF=ODD
  E62B  7E            		LD	A,(HL)
  E62C  73            		LD	(HL),E
  E62D  3806          		JR	C,SNC1
                      	;EVEN
                      	;M[0] = E
                      	;M[1] = (M[1] & 0xF0) | (D & 0x0F)
  E62F  23            		INC	HL
  E630  ED67          		RRD		;M={A[3:0],E[3:0]}
  E632  7A            		LD	A,D
  E633  1804          		JR	SNC11
  E635                	SNC1:
                      	;ODD
                      	;HL[0] = (HL[0]&0x0F) | (E<<4)
                      	;HL[1] = DE>>4
  E635  ED6F          		RLD		;M={D[3:0],E[7:4]}
  E637  23            		INC	HL
  E638  72            		LD	(HL),D	;M={D[3:0],E[7:4]}
  E639                	SNC11:
  E639  ED6F          		RLD		;M={M[7:4],D[3:0]}
  E63B  B7            		OR	A
  E63C  D1            		POP	DE
  E63D  C1            		POP	BC
  E63E  E1            		POP	HL
  E63F  C9            		RET
                      	
  E640                	RDFAT0X:
  E640  CD76E7        		CALL	RDFATS
  E643  D8            		RET	C
  E644  DDBE01        		CP	(IX+1)		;DPB_01_FATID
  E647  C8            		RET	Z
  E648  37            		SCF
  E649  C9            		RET
                      	
  E64A                	RDFAT:
  E64A  3A88EC        		LD	A,(_DRV)
  E64D  CDA1E8        		CALL	CHGDRVR
  E650  D8            		RET	C
  E651  DD7E12        		LD	A,(IX+012H)	;DPB_12_DEVNO
  E654  FE87          		CP	087H
  E656  20E8          		JR	NZ,RDFAT0X
                      	
  E658  3E7F          		LD	A,07FH
  E65A  3247E9        		LD	(CHECK),A	;A=07FH
  E65D  DDCB0A46      		BIT	0,(IX+00AH)	;DPB_0A_FDMODE
  E661  284D          		JR	Z,X2HX
  E663                	E2DX:
  E663  21D7E8        		LD	HL,M2D
  E666  CD3FE7        		CALL	DRDF
  E669  383D          		JR	C,E2HX
  E66B  FEFD          		CP	0FDH		;2D
  E66D  C8            		RET	Z
  E66E  FEF9          		CP	0F9H		;2DD9
  E670  CA1AE7        		JP	Z,E2DD9
  E673  FEFB          		CP	0FBH		;2DD8
  E675  37            		SCF
  E676  C0            		RET	NZ		;NOT 2DD
  E677  21E5E8        		LD	HL,M2DD8
  E67A                	CHGTYPE:
  E67A  D5            		PUSH	DE
  E67B  CD8DE6        		CALL	CHGDV
  E67E  3A84EC        		LD	A,(_DRIVE)
  E681  E603          		AND	3
  E683  F680          		OR	080H
  E685  6F            		LD	L,A
  E686  26EC          		LD	H,_CYL0/256
  E688  3EFF          		LD	A,0FFH
  E68A  77            		LD	(HL),A
  E68B  D1            		POP	DE
  E68C  C9            		RET
                      	
  E68D                	CHGDV:
  E68D  DDE5          		PUSH	IX
  E68F  D1            		POP	DE
  E690  EDA0          		LDI
  E692  EDA0          		LDI
  E694  13            		INC	DE
  E695  13            		INC	DE
  E696  13            		INC	DE
  E697  13            		INC	DE
  E698  010C00        		LD	BC,12
  E69B  EDB0          		LDIR
  E69D                	CHGDV2:
  E69D  3EFF          		LD	A,0FFH
  E69F  3289EC        		LD	(_DSK),A
  E6A2  3A88EC        		LD	A,(_DRV)
  E6A5  C3D9EC        		JP	_CHGDRV
                      	
  E6A8                	E2HX:
  E6A8  3C            		INC	A
  E6A9  C8            		RET	Z
  E6AA  2147E9        		LD	HL,CHECK
  E6AD  CB06          		RLC	(HL)
  E6AF  D8            		RET	C
  E6B0                	X2HX:
  E6B0  210FE9        		LD	HL,M2HD
  E6B3  110000        		LD	DE,0
  E6B6  CD43E7        		CALL	DRDD
  E6B9  300A          		JR	NC,X2HX1
  E6BB  3C            		INC	A
  E6BC  C8            		RET	Z
  E6BD  2147E9        		LD	HL,CHECK
  E6C0  CB06          		RLC	(HL)
  E6C2  D8            		RET	C
  E6C3  189E          		JR	E2DX
  E6C5                	X2HX1:
  E6C5  23            		INC	HL
  E6C6  7E            		LD	A,(HL)
  E6C7  06FE          		LD	B,0FEH
  E6C9  FE0C          		CP	00CH
  E6CB  2838          		JR	Z,X2HDE
  E6CD  06F8          		LD	B,0F8H
  E6CF  D620          		SUB	020H		;020H
  E6D1  2832          		JR	Z,X2HDE
  E6D3  3C            		INC	A		;01FH
  E6D4  282F          		JR	Z,X2HDE
  E6D6  3C            		INC	A		;01EH
  E6D7  2078          		JR	NZ,C2HX		;2HD/2HC/2HQ
  E6D9                	X2HS:
  E6D9  2139E9        		LD	HL,M2HS
  E6DC  CD0BE7        		CALL	X2HSS
  E6DF  D8            		RET	C
  E6E0  2A7CEC        		LD	HL,(_FATBF)
  E6E3  23            		INC	HL
  E6E4  7E            		LD	A,(HL)		;FATBF+1
  E6E5  FE50          		CP	80
  E6E7  3F            		CCF
  E6E8  D0            		RET	NC
  E6E9  FE5A          		CP	90
  E6EB  D0            		RET	NC
  E6EC  DD770C        		LD	(IX+00CH),A	;DPB_0C_MAXCYL
  E6EF  D650          		SUB	80
  E6F1  87            		ADD	A,A	;*2
  E6F2  4F            		LD	C,A
  E6F3  87            		ADD	A,A	;*4
  E6F4  87            		ADD	A,A	;*8
  E6F5  87            		ADD	A,A	;*16
  E6F6  81            		ADD	A,C	;*18
  E6F7  C698          		ADD	A,098H
  E6F9  DD7708        		LD	(IX+8),A	;DPB_08_MAXCL_LOW
  E6FC  3E05          		LD	A,5
  E6FE  CE00          		ADC	A,0
  E700  DD7709        		LD	(IX+9),A	;DPB_08_MAXCL_HIGH
  E703  1898          		JR	CHGDV2
  E705                	X2HDE:
  E705  212BE9        		LD	HL,M2HDE
  E708  23            		INC	HL
  E709  70            		LD	(HL),B
  E70A  2B            		DEC	HL
  E70B                	X2HSS:
  E70B  CD3FE7        		CALL	DRDF
  E70E  D8            		RET	C
  E70F  DDBE01        		CP	(IX+1)		;DPB_01_FATID
  E712  37            		SCF
  E713  C0            		RET	NZ
  E714  CD23E7        		CALL	INCDRD
  E717  300E          		JR	NC,DRDC
  E719  C9            		RET
                      	
  E71A                	E2DD9:
  E71A  21F3E8        		LD	HL,M2DD
  E71D  CD7AE6        		CALL	CHGTYPE
  E720  2A7CEC        		LD	HL,(_FATBF)
  E723                	INCDRD:
  E723  24            		INC	H
  E724  24            		INC	H
  E725  24            		INC	H
  E726  24            		INC	H
  E727                	DRDC:
  E727  CDF1EC        		CALL	_DRD
  E72A  D8            		RET	C
  E72B  3A5CDF        		LD	A,(DBLPAT)
  E72E  B7            		OR	A
  E72F  C2F1EC        		JP	NZ,_DRD
  E732  C9            		RET
                      	
  E733                	DWTC:
  E733  CDF4EC        		CALL	_DWT
  E736  D8            		RET	C
  E737  3A5CDF        		LD	A,(DBLPAT)
  E73A  B7            		OR	A
  E73B  C2F4EC        		JP	NZ,_DWT
  E73E  C9            		RET
                      	
  E73F                	DRDF:
  E73F  ED5B59E2      		LD	DE,(_FATPS)
  E743                	DRDD:
  E743  CD7AE6        		CALL	CHGTYPE
  E746  2A7CEC        		LD	HL,(_FATBF)
  E749  E5            		PUSH	HL
  E74A  CD27E7        		CALL	DRDC
  E74D  E1            		POP	HL
  E74E  D8            		RET	C
  E74F  7E            		LD	A,(HL)
  E750  C9            		RET
                      	
  E751                	C2HX:
  E751  CD76E7        		CALL	RDFATS
  E754  D8            		RET	C
  E755  FEFE          		CP	0FEH	;2HD
  E757  C8            		RET	Z
  E758  211DE9        		LD	HL,M2HQ
  E75B  FEF0          		CP	0F0H
  E75D  2807          		JR	Z,X2HQ
  E75F  FEF9          		CP	0F9H
  E761  37            		SCF
  E762  C0            		RET	NZ
  E763  2101E9        		LD	HL,M2HC
  E766                	X2HQ:
  E766  CD7AE6        		CALL	CHGTYPE
  E769  CDADE7        		CALL	FATS2
  E76C  24            		INC	H	;前2クラスタはすでに読み込まれているのでスキップ
  E76D  24            		INC	H
  E76E  05            		DEC	B
  E76F  13            		INC	DE
  E770  24            		INC	H	;
  E771  24            		INC	H
  E772  05            		DEC	B
  E773  13            		INC	DE
  E774  1804          		JR	RDFATL
  E776                	RDFATS:
  E776  CDA6E7        		CALL	FATS
  E779  D8            		RET	C
  E77A                	RDFATL:
  E77A  C5            		PUSH	BC
  E77B  CDF1EC        		CALL	_DRD
  E77E  C1            		POP	BC
  E77F  D8            		RET	C
  E780  10F8          		DJNZ	RDFATL
  E782  2A7CEC        		LD	HL,(_FATBF)
  E785  7E            		LD	A,(HL)
  E786  C9            		RET
                      	
  E787                	WTFAT:
  E787  CDA6E7        		CALL	FATS
  E78A  D49DE7        		CALL	NC,WTFATL
  E78D  D8            		RET	C
  E78E  DDCB0F4E      		BIT	1,(IX+00FH)	;DPB_0F_FATS
  E792  C8            		RET	Z
  E793  CDADE7        		CALL	FATS2
  E796  DD7E00        		LD	A,(IX+0)	;DPB_00_FATLN
  E799                	WTFAT2:
  E799  13            		INC	DE
  E79A  3D            		DEC	A
  E79B  20FC          		JR	NZ,WTFAT2
  E79D                	WTFATL:
  E79D  C5            		PUSH	BC
  E79E  CDF4EC        		CALL	_DWT
  E7A1  C1            		POP	BC
  E7A2  D8            		RET	C
  E7A3  10F8          		DJNZ	WTFATL
  E7A5  C9            		RET
                      	;------------------------
                      	;FATのセットアップ
                      	;out
                      	;	B  : FATセクタ数
                      	;	DE : FAT先頭セクタ番号
                      	;	HL : FATバッファポインタ
                      	;	CF : 1=ドライブ切り替えエラー
                      	;note
                      	;	FATサイズがFATバッファを超える場合は
                      	;	対象クラスタ領域==(_FATDRV).bit7によって
                      	;	FATの前半3KBと後半3KBを切り替える
                      	;------------------------
  E7A6                	FATS:
  E7A6  3AA3EC        		LD	A,(_FATDRV)
  E7A9  CDA1E8        		CALL	CHGDRVR		;ドライブ切り替え
  E7AC  D8            		RET	C
  E7AD                	FATS2:
  E7AD  ED5B59E2      		LD	DE,(_FATPS)	;fat sector pos
  E7B1  2A7CEC        		LD	HL,(_FATBF)
  E7B4  DD4600        		LD	B,(IX+0)	;DPB_00_FATLN
  E7B7  DD7E07        		LD	A,(IX+7)	;DPB_07_DBLCL $29=512 / 0=1024
  E7BA  B7            		OR	A
  E7BB  3E06          		LD	A,6		;3072 / 512 FATバッファに読み込めるセクタ数
  E7BD  2007          		JR	NZ,FATS512
  E7BF  DDCB0F7E      		BIT	7,(IX+00FH)	;DPB_0F_FATS
  E7C3  2001          		JR	NZ,FATS512
  E7C5  1F            		RRA			;A=3 (3072÷1024: 1セクタ1024バイトの場合)
  E7C6                	FATS512:
  E7C6  B8            		CP	B
  E7C7  D0            		RET	NC		;DPB_0F_FATS x sectorSize < fatBufSize
                      	;targetCluster
  E7C8  4F            		LD	C,A		;C = skipCount
  E7C9  3AA3EC        		LD	A,(_FATDRV)	;bit7 = (targetCluster >= 0x800)
  E7CC  87            		ADD	A,A		;CF=(_FATDRV).bit7
  E7CD  3006          		JR	NC,FATS3
                      	;(targerCluster>=0x800)
  E7CF                	FAT_SKP:
  E7CF  13            		INC	DE		;FATPS++
  E7D0  05            		DEC	B		;FATSIZE--
  E7D1  0D            		DEC	C		;skipCnt--
  E7D2  20FB          		JR	NZ,FAT_SKP
  E7D4  48            		LD	C,B
  E7D5                	FATS3:
  E7D5  41            		LD	B,C		;3 or 6
  E7D6  AF            		XOR	A
  E7D7  C9            		RET
                      	
  E7D8                	CHGDRV:
  E7D8  E67F          		AND	07FH
  E7DA  E5            		PUSH	HL
  E7DB  2189EC        		LD	HL,_DSK
  E7DE  BE            		CP	(HL)
  E7DF  280A          		JR	Z,CHGDRVE
  E7E1                	CHGDRV1:
  E7E1  DDE5          		PUSH	IX
  E7E3  CDEDE7        		CALL	CHGDRV0
  E7E6  3A89EC        		LD	A,(_DSK)
  E7E9  DDE1          		POP	IX
  E7EB                	CHGDRVE:
  E7EB  E1            		POP	HL
  E7EC  C9            		RET
                      	
  E7ED                	CHGDRV0:
  E7ED  6F            		LD	L,A
  E7EE  CDDCEC        		CALL	_GETDPB
  E7F1  D8            		RET	C
                      	
  E7F2  7D            		LD	A,L
  E7F3  3289EC        		LD	(_DSK),A
                      	
  E7F6  F3            		DI
  E7F7  ED735EE8      		LD	(SPPAT2+1),SP
                      	
  E7FB  DDF9          		LD	SP,IX
                      	
  E7FD  E1            		POP	HL
  E7FE  E1            		POP	HL
  E7FF  22F2EC        		LD	(_DRD+1),HL
                      	
  E802  E1            		POP	HL
  E803  22F5EC        		LD	(_DWT+1),HL
                      	
  E806  E1            		POP	HL
  E807  225BDF        		LD	(CLSPAT+1),HL	;ADDCL
                      	
  E80A  E1            		POP	HL		;MAXCL
  E80B  7D            		LD	A,L
  E80C  326ADF        		LD	(CLPAT2+1),A
  E80F  7C            		LD	A,H
  E810  3266DF        		LD	(CLPAT1+1),A
  E813  2B            		DEC	HL
  E814  2268E1        		LD	(MAXCLP+1),HL
                      	
  E817  E1            		POP	HL		;H=MAXDIR L=FDMODE
  E818  7D            		LD	A,L
  E819  F6FE          		OR	0FEH
  E81B  32C2E9        		LD	(FDMODE+1),A
  E81E  07            		RLCA
  E81F  E603          		AND	3
  E821  32A9E9        		LD	(FSPAT+1),A
  E824  7C            		LD	A,H
  E825  3268DE        		LD	(RTEPAT+1),A
                      	
  E828  E1            		POP	HL
  E829  7D            		LD	A,L
  E82A  32A1EC        		LD	(_MAXCYL),A
  E82D  7C            		LD	A,H
  E82E  3251E9        		LD	(MAXSEC+1),A
                      	
  E831  E1            		POP	HL
  E832  2600          		LD	H,0
  E834  2259E2        		LD	(_FATPS),HL
                      	
  E837  E1            		POP	HL
  E838  7C            		LD	A,H
  E839  325EE9        		LD	(SECPAT+1),A
  E83C  2600          		LD	H,0
  E83E  225BE2        		LD	(_DIRPS),HL
                      	
  E841  E1            		POP	HL
  E842  7C            		LD	A,H
  E843  3284EC        		LD	(_DRIVE),A
                      	
  E846  E1            		POP	HL
  E847  E1            		POP	HL
  E848  7C            		LD	A,H
  E849  B5            		OR	L
  E84A  2003          		JR	NZ,OGNCL
  E84C  21F7E5        		LD	HL,GNCL		;FAT12(default)
  E84F                	OGNCL:
  E84F  22F8EC        		LD	(_GNCL+1),HL
                      	
  E852  E1            		POP	HL
  E853  7C            		LD	A,H
  E854  B5            		OR	L
  E855  2003          		JR	NZ,OSNCL
  E857  211AE6        		LD	HL,SNCL		;FAT12(default)
  E85A                	OSNCL:
  E85A  22FBEC        		LD	(_SNCL+1),HL
                      	
  E85D  310000        	SPPAT2:	LD	SP,0		;元のSPを復元
  E860  FB            		EI
  E861  D5            		PUSH	DE
  E862  DDCB0F7E      		BIT	7,(IX+00FH)	;DPB_0F_FATS
  E866  280A          		JR	Z,NEC
                      					;1クラスタ512 2HC/2HQ(2HD1.44MB)等
  E868  111802        		LD	DE,00218H	;JR +2(直後のRR Cを飛ばす)
  E86B  210000        		LD	HL,0
                      	
  E86E  3E01          		LD	A,1
  E870  1808          		JR	NEC1
  E872                	NEC:
                      					;1クラスタ1024 2D/2DD/2HD/EMM/BRAM/GRAM等
  E872  11            		DB	011H		;LD DE,SRL B
  E873  CB38          		SRL B			;
  E875  21            		DB	021H		;LD HL,SRL A
  E876  CB3F          		SRL A			;
                      	
  E878  3E03          		LD	A,3
  E87A                	NEC1:				;1024	512
  E87A  32A8E4        		LD	(IBM5+1),A	;3	1	1クラスタのサイズ-1したものの上位1バイト (0x3FF - 0x1FF)
  E87D  3C            		INC	A		;4	2
  E87E  32AFE4        		LD	(IBM7+2),A	;1クラスタのサイズの上位1バイト 0x400 - 0x200
  E881  87            		ADD	A,A		;8	4
  E882  87            		ADD	A,A		;010H	8
  E883  87            		ADD	A,A		;020H	010H
  E884  32F5DD        		LD	(IBM1+1),A	;1クラスタ辺りのディレクトリエントリ数
  E887  87            		ADD	A,A		;040H	020H
  E888  87            		ADD	A,A		;080H	040H
  E889  87            		ADD	A,A		;000H	080H
  E88A  2F            		CPL			;0FFH	07FH
  E88B  3245D3        		LD	(IBM2+1),A
  E88E  ED5346E1      		LD	(IBM4),DE
  E892  22D3E4        		LD	(IBM8),HL
  E895  D1            		POP	DE
  E896  AF            		XOR	A
  E897  C9            		RET
                      	
  E898                	GETDPBD:
  E898  DDE3          		EX	(SP),IX
  E89A  DDE5          		PUSH	IX
  E89C  3A88EC        		LD	A,(_DRV)
  E89F  1807          		JR	GETDPB1
                      	
  E8A1                	CHGDRVR:
  E8A1  CDD9EC        		CALL	_CHGDRV
  E8A4  D8            		RET	C
  E8A5  3A89EC        		LD	A,(_DSK)
  E8A8                	GETDPB1:
  E8A8  C3DCEC        		JP	_GETDPB
                      	
  E8AB                	GETDPB:
  E8AB  FE08          		CP	8
  E8AD  3F            		CCF
  E8AE  D8            		RET	C
  E8AF  87            		ADD	A,A	;*2
  E8B0  87            		ADD	A,A	;*4
  E8B1  87            		ADD	A,A	;*8
  E8B2  87            		ADD	A,A	;*16
  E8B3  87            		ADD	A,A	;*32
                      	;	LD	IXL,A		;OHM-Z80固有マクロ
  E8B4  DD            		DB	0DDH		;Z80未定義命令
  E8B5  6F            		LD	L,A		;
                      	;	LD	IXH,DEVICE/256	;OHM-Z80固有マクロ
  E8B6  DD            		DB	0DDH		;Z80未定義命令
  E8B7  26ED          		LD	H,DEVICE/256	;
  E8B9  DD7E00        		LD	A,(IX+0)	;DPB_00_FATLN
  E8BC  FE01          		CP	001H		;A=0 THEN CF=1
  E8BE  C9            		RET
                      	
  E8BF                	FFLUSH:
  E8BF  F5            		PUSH	AF
  E8C0  3EFF          		LD	A,0FFH
  E8C2  3235E2        		LD	(SFILE),A
  E8C5  CD57E5        		CALL	DWTX
  E8C8  3EFF          		LD	A,0FFH
  E8CA  32A5EC        		LD	(_DBDRV),A
  E8CD  CD9DE5        		CALL	WTFATX
  E8D0  3EFF          		LD	A,0FFH
  E8D2  32A3EC        		LD	(_FATDRV),A
  E8D5  F1            		POP	AF
  E8D6  C9            		RET
                      	
  E8D7                	M2D:
  E8D7  02FD0829      		DB	2,0FDH,8,029H
  E8DB  6401          		DW	356
  E8DD  FF0C2809010205		DB	0FFH,12,40,9,1,2,5,1
                      	
  E8E5                	M2DD8:
  E8E5  02FB0829      		DB	2,0FBH,8,029H
  E8E9  7C02          		DW	636
  E8EB  FF0C5008010205		DB	0FFH,12,80,8,1,2,5,1
                      	
  E8F3                	M2DD:
  E8F3  03F90A29      		DB	3,0F9H,0AH,029H
  E8F7  CB02          		DW	715
  E8F9  FF0E5009010207		DB	0FFH,14,80,9,1,2,7,1
                      	
  E901                	M2HC:
  E901  07F91B00      		DB	7,0F9H,27,0
  E905  4509          		DW	2373
  E907  FE1D500F01820F		DB	0FEH,29,80,15,1,082H,15,1
                      	
  E90F                	M2HD:
  E90F  02FE0900      		DB	2,0FEH,9,0
  E913  C704          		DW	1223
  E915  FE0B4D08010205		DB	0FEH,11,77,8,1,2,5,1
                      	
  E91D                	M2HQ:
  E91D  09F01F00      		DB	9,0F0H,31,0
  E921  210B          		DW	2849
  E923  FE215012018213		DB	0FEH,33,80,18,1,082H,19,1
                      	
  E92B                	M2HDE:
  E92B  03FE0B00      		DB	3,0FEH,11,0
  E92F  9505          		DW	1429
  E931  FE0D5009010207		DB	0FEH,13,80,9,1,2,7,1
                      	
  E939                	M2HS:
  E939  03FB0800      		DB	3,0FBH,8,0
  E93D  9805          		DW	1432
  E93F  FE0A5009010104		DB	0FEH,10,80,9,1,1,4,10
                      	
  E947  00            	CHECK:	DB	0
                      	
                      	;LDDISK.ASM
                      	
                      	;	LSX-Dodgers DISK
                      	
                      	
  E948                	SEEK:
  E948  7A            		LD	A,D
  E949  B3            		OR	E
  E94A  3E01          		LD	A,001H
  E94C  2812          		JR	Z,DIV3
                      	
  E94E  0610          		LD	B,16
  E950  0E00          	MAXSEC:	LD	C,000H
  E952  AF            		XOR	A
  E953  EB            		EX	DE,HL
  E954                	DIV1:
  E954  29            		ADD	HL,HL
  E955  8F            		ADC	A,A
  E956  B9            		CP	C
  E957  3802          		JR	C,DIV2
  E959  91            		SUB	C
  E95A  2C            		INC	L
  E95B                	DIV2:
  E95B  10F7          		DJNZ	DIV1
                      	
  E95D  C601          	SECPAT:	ADD	A,001H		;(Self-rewriting)
  E95F  55            		LD	D,L	;Quotient(TRACK)
  E960                	DIV3:
  E960  5F            		LD	E,A	;Remainder
  E961  CB3A          		SRL	D	;CYLINDER
  E963  9F            		SBC	A,A
  E964  E610          		AND	010H	;SIDE
  E966  4F            		LD	C,A
                      	
  E967  3A84EC        		LD	A,(_DRIVE)
  E96A  FE04          		CP	4
  E96C  3F            		CCF
  E96D  D8            		RET	C
  E96E  B1            		OR	C
  E96F  32EEE9        		LD	(MOPAT+1),A	;Motor off data
  E972  01FC0F        		LD	BC,00FFCH
  E975  F680          		OR	080H		;Mortor on
  E977  ED79          		OUT	(C),A
                      	
  E979  CDC0E9        		CALL	SETMODE
  E97C  D8            		RET	C
                      	
  E97D  CD03EA        		CALL	DRIVE
  E980  FEFF          		CP	0FFH		;A=0FFH Unknown CYLINDER
  E982  CCE2E9        		CALL	Z,FDCRES	;Restore
  E985  0EF9          		LD	C,0F9H
  E987  ED79          		OUT	(C),A		;Currrent CYLINDER
  E989  92            		SUB	D
  E98A  C8            		RET	Z		;No seek
                      	
  E98B  3A86EC        		LD	A,(_ISEEK)
  E98E  4F            		LD	C,A
                      	
  E98F  3AA1EC        		LD	A,(_MAXCYL)	;Max CYLINDER
  E992  3D            		DEC	A
  E993  BA            		CP	D		;Over CYLINDER
  E994  D8            		RET	C
                      	
  E995  B9            		CP	C		;for Built-in 2DD
  E996  3803          		JR	C,SETM2
  E998  78            		LD	A,B		;B=00FH
  E999  DBFE          		IN	A,(0FEH)		;2HD mode for 2DD seek
  E99B                	SETM2:
  E99B  78            		LD	A,B
  E99C  DBFD          		IN	A,(0FDH)		;MFM mode
                      	
  E99E  0EFB          		LD	C,0FBH
  E9A0  ED51          		OUT	(C),D
  E9A2  72            		LD	(HL),D
  E9A3  0E18          		LD	C,018H		;Seek
  E9A5                	FDCCMD2:
  E9A5  3A85EC        		LD	A,(_SEEKSP)
  E9A8  E6FF          	FSPAT:	AND	0FFH
  E9AA  B1            		OR	C
                      	
  E9AB                	FDCCMD:
  E9AB  CDF9E9        		CALL	COMSET
                      	
  E9AE  3A70EA        	AT_FDCPAT:LD	A,(FDCPAT+1)
  E9B1  E620          		AND	020H		;Write data Write track
  E9B3  3C            		INC	A
                      	
  E9B4                	SST:
  E9B4  0E00          		LD	C,0
  E9B6                	SST1:
  E9B6  0D            		DEC	C		; 4
  E9B7  20FD          		JR	NZ,SST1		;12 * 256 / 4 = About 1ms
  E9B9  3D            		DEC	A
  E9BA  20FA          		JR	NZ,SST1
                      	
  E9BC  3C            		INC	A		;A=1
  E9BD  CDCBE9        		CALL	READY
  E9C0                	SETMODE:
  E9C0  78            		LD	A,B		;B=00FH
  E9C1  DBFF          	FDMODE:	IN	A,(0FFH)		;Floppy mode(2D/2HD) (Self-rewriting)
                      	
  E9C3  78            		LD	A,B
  E9C4  DBFD          		IN	A,(0FDH)		;MFM mode
                      	
  E9C6  CDFDE9        		CALL	DELAY0		;Head select time
  E9C9  3E81          		LD	A,081H
  E9CB                	READY:
  E9CB  32D5E9        		LD	(WAITA+1),A
  E9CE  E5            		PUSH	HL
  E9CF  0EF8          		LD	C,0F8H
  E9D1  61            		LD	H,C
  E9D2                	READY2:
  E9D2  ED78          		IN	A,(C)
  E9D4  E681          	WAITA:	AND	081H		;NOT READY,BUSY
  E9D6  2808          		JR	Z,READYE
  E9D8  E3            		EX	(SP),HL		;wait
  E9D9  E3            		EX	(SP),HL		; //
  E9DA  2B            		DEC	HL
  E9DB  7C            		LD	A,H
  E9DC  B5            		OR	L
  E9DD  20F3          		JR	NZ,READY2
  E9DF  37            		SCF
  E9E0                	READYE:
  E9E0  E1            		POP	HL
  E9E1  C9            		RET
                      	
  E9E2                	FDCRES:
  E9E2  3600          		LD	(HL),0
  E9E4  0E08          		LD	C,8
  E9E6  18BD          		JR	FDCCMD2
                      	
  E9E8                	FDMOFF:
  E9E8  F5            		PUSH	AF
  E9E9  C5            		PUSH	BC
  E9EA  01FC0F        		LD	BC,00FFCH	;Motor off
  E9ED  3E00          	MOPAT:	LD	A,000H		;(Self-rewriting)
  E9EF  ED79          		OUT	(C),A
  E9F1  C1            		POP	BC
  E9F2  F1            		POP	AF
  E9F3  C9            		RET
                      	
  E9F4                	SECSET:
  E9F4  01FA0F        		LD	BC,00FFAH
  E9F7  ED59          		OUT	(C),E
  E9F9                	COMSET:
  E9F9  0EF8          		LD	C,0F8H
  E9FB  ED79          		OUT	(C),A
  E9FD                	DELAY0:
  E9FD  3E1A          		LD	A,26
  E9FF                	DELAY:
  E9FF  3D            		DEC	A
  EA00  20FD          		JR	NZ,DELAY
  EA02  C9            		RET
                      	
  EA03                	DRIVE:
  EA03  2A84EC        		LD	HL,(_DRIVE)
  EA06  26EC          		LD	H,_CYL0/256
  EA08  CBFD          		SET	7,L
  EA0A  7E            		LD	A,(HL)
  EA0B  C9            		RET
                      	
  EA0C                	RNF:
  EA0C  CD03EA        		CALL	DRIVE
  EA0F  36FF          		LD	(HL),0FFH
  EA11  C9            		RET
                      	
  EA12  0307          	DEMES:	DB	3,7
  EA14  A5446576696365		DB	0A5H, "Device I/O Error!",5,3
  EA28  41626F72742052		DB	"Abort Retry Ignore?",5,3,0
                      	
  EA3E  02            	RETRY:	DB	2
                      	
                      	
                      	;	FLOPPY DISK DRIVER(DMA)
                      	
                      	
  EA3F                	WTTRK:
  EA3F  3EF4          		LD	A,0F4H
  EA41  01            		DB	1	;JR	WTTRK1
  EA42                	FDWT:
  EA42  3EA0          		LD	A,0A0H
  EA44                	WTTRK1:
  EA44  3270EA        		LD	(FDCPAT+1),A
  EA47  3E10          		LD	A,16
  EA49  F3            		DI
  EA4A  1808          		JR	DISK
                      	
  EA4C                	FDRD:
  EA4C  3E80          		LD	A,080H
  EA4E  00            		NOP
                      	
  EA4F  3270EA        		LD	(FDCPAT+1),A
  EA52  3E0E          		LD	A,14
                      	
  EA54                	DISK:
  EA54  3266EA        		LD	(DMAPAT+1),A
                      	
  EA57  22F0EA        		LD	(DMAD+11),HL
  EA5A                	DISKR:
  EA5A  3E02          		LD	A,2		;Retry count
  EA5C  323EEA        		LD	(RETRY),A
  EA5F                	DISK2:
  EA5F  D5            		PUSH	DE
  EA60  CD48E9        		CALL	SEEK
  EA63  3840          		JR	C,ERRF
                      	
  EA65  3E0E          	DMAPAT:	LD	A,14
  EA67  21E5EA        		LD	HL,DMAD
  EA6A  CDDBEA        		CALL	SETDMA
  EA6D  ED49          		OUT	(C),C		;OUT 01F87H,087H
  EA6F  3E80          	FDCPAT:	LD	A,080H		;FDC COMMAND(Self-rewriting)
  EA71  C5            		PUSH	BC
  EA72  CDF4E9        		CALL	SECSET
  EA75  2AF0EA        		LD	HL,(DMAD+11)
  EA78  23            		INC	HL
  EA79  1106BB        		LD	DE,0BB06H	;READ DMA
                      	
  EA7C  3E03          		LD	A,3
  EA7E  CDCBE9        		CALL	READY
  EA81  ED78          		IN	A,(C)
                      	
  EA83  C1            		POP	BC
  EA84  ED51          		OUT	(C),D
  EA86  ED59          		OUT	(C),E
  EA88  ED58          		IN	E,(C)
  EA8A  ED50          		IN	D,(C)
  EA8C  19            		ADD	HL,DE
  EA8D  D1            		POP	DE
  EA8E  13            		INC	DE
  EA8F  FB            		EI
  EA90  CDE8E9        		CALL	FDMOFF
  EA93  B7            		OR	A
  EA94  C8            		RET	Z
  EA95  1B            		DEC	DE
  EA96  CB67          		BIT	4,A
  EA98  C40CEA        		CALL	NZ,RNF
  EA9B                	DISKE2:
  EA9B  213EEA        		LD	HL,RETRY
  EA9E  35            		DEC	(HL)
  EA9F  20BE          		JR	NZ,DISK2
  EAA1  B7            		OR	A
  EAA2  2834          		JR	Z,ERR
  EAA4  D5            		PUSH	DE
  EAA5                	ERRF:
  EAA5  D1            		POP	DE
  EAA6                	DELP:
  EAA6  CD0CEA        		CALL	RNF
  EAA9  CDE8E9        		CALL	FDMOFF
  EAAC  3A85EC        		LD	A,(_SEEKSP)
  EAAF  87            		ADD	A,A
  EAB0  9F            		SBC	A,A
  EAB1  3825          		JR	C,ERR
  EAB3                	DELP1:
  EAB3  D5            		PUSH	DE
  EAB4  2112EA        		LD	HL,DEMES
  EAB7  CDF4D7        		CALL	MSX
  EABA  CD72D6        		CALL	KEYBC
  EABD                	DELP2:
  EABD  CD0FDC        		CALL	INKEY
  EAC0  28FB          		JR	Z,DELP2
                      	
  EAC2  D1            		POP	DE
  EAC3  CD6CDF        		CALL	CAP
  EAC6  FE52          		CP	'R'
  EAC8  CA5AEA        		JP	Z,DISKR
  EACB  FE49          		CP	'I'
  EACD  2807          		JR	Z,IGNORE
  EACF  FE41          		CP	'A'
  EAD1  20E0          		JR	NZ,DELP1
  EAD3  C3EFD9        		JP	BOOT
  EAD6                	IGNORE:
  EAD6  3EFF          		LD	A,0FFH
  EAD8                	ERR:
  EAD8  BF            		CP	A
  EAD9  37            		SCF
  EADA  C9            		RET
                      	
  EADB                	SETDMA:
  EADB  01871F        		LD	BC,01F87H
  EADE                	SDMA:
  EADE  04            		INC	B
  EADF  EDA3          		OUTI
  EAE1  3D            		DEC	A
  EAE2  20FA          		JR	NZ,SDMA
  EAE4  C9            		RET
                      	
  EAE5  C37DFB0FFFFF2C	DMAD:	DB	0C3H,07DH,0FBH,00FH,0FFH,0FFH,02CH,010H		;X1turbo
  EAED  80928D0000CF01		DB	080H,092H,08DH,000H,000H,0CFH,001H,0CFH		;DISK DMA
                      	
                      	
                      	;	EMM DRIVER(DMA)
                      	
                      	
  EAF5                	EDWTC:
  EAF5  3E11          		LD	A,17
  EAF7  01            		DB	1
  EAF8                	EDRDC:
  EAF8  3E0F          		LD	A,15
  EAFA                	EDWTC1:
  EAFA  D5            		PUSH	DE
  EAFB  2237EB        		LD	(EDMAD+12),HL
  EAFE  EB            		EX	DE,HL
  EAFF  29            		ADD	HL,HL
  EB00  29            		ADD	HL,HL
  EB01  ED4BA0EC      		LD	BC,(_MAXCYL-1)
  EB05  0E00          		LD	C,0
  EB07  09            		ADD	HL,BC
  EB08  ED4B84EC      		LD	BC,(_DRIVE)
  EB0C  060D          		LD	B,00DH
  EB0E  ED49          		OUT	(C),C
  EB10  0C            		INC	C
  EB11  ED69          		OUT	(C),L
  EB13  0C            		INC	C
  EB14  ED61          		OUT	(C),H
                      	
  EB16  212BEB        		LD	HL,EDMAD
  EB19  CDDBEA        		CALL	SETDMA
  EB1C  3EB3          		LD	A,0B3H
  EB1E  ED79          		OUT	(C),A
  EB20  ED49          		OUT	(C),C		;OUT 01F87H,087H
  EB22  EB            		EX	DE,HL
  EB23  24            		INC	H
  EB24  24            		INC	H
  EB25  24            		INC	H
  EB26  24            		INC	H
  EB27  D1            		POP	DE
  EB28  13            		INC	DE
  EB29  AF            		XOR	A
  EB2A  C9            		RET
                      	
  EB2B  C37D030DFF032C	EDMAD:	DB	0C3H,07DH,003H,00DH,0FFH,003H,02CH,050H,002H
  EB34  809AAD0000CF01		DB	080H,09AH,0ADH,000H,000H,0CFH,001H,0CFH
                      	
                      	
                      	;	BANK RAM DISK DRIVER
                      	
                      	
  EB3C                	BDRDC:
  EB3C  ED735BEB      		LD	(BANKSP+1),SP
  EB40  3A5CEB        		LD	A,(BANKSP+2)
  EB43  87            		ADD	A,A
  EB44  3803          		JR	C,BDRDC1
  EB46  31D4FF        		LD	SP,EXTSP
  EB49                	BDRDC1:
  EB49  D5            		PUSH	DE
  EB4A  D9            		EXX
  EB4B  C5            		 PUSH	 BC
  EB4C  D5            		 PUSH	 DE
  EB4D  CD81EB        		 CALL	 BADR
  EB50  CD9EEB        		CALL	BTFR
  EB53  D9            		EXX
  EB54                	BDWTCE:
  EB54  D1            		 POP	 DE
  EB55  C1            		 POP	 BC
  EB56  D9            		 EXX
  EB57  D1            		POP	DE
  EB58  13            		INC	DE
  EB59  FB            		EI
  EB5A  310000        	BANKSP:	LD	SP,0
  EB5D  AF            		XOR	A
  EB5E  C9            		RET
                      	
  EB5F                	BDWTC:
  EB5F  ED735BEB      		LD	(BANKSP+1),SP
  EB63  3A5CEB        		LD	A,(BANKSP+2)
  EB66  87            		ADD	A,A
  EB67  3803          		JR	C,BDWTC1
  EB69  31D4FF        		LD	SP,EXTSP
  EB6C                	BDWTC1:
  EB6C  D5            		PUSH	DE
  EB6D  D9            		EXX
  EB6E  C5            		 PUSH	 BC
  EB6F  D5            		 PUSH	 DE
  EB70  CD81EB        		 CALL	 BADR
  EB73  D9            		EXX
  EB74  53            		 LD	D,E
  EB75  5F            		 LD	E,A
  EB76  D9            		 EXX
  EB77  EB            		EX	DE,HL
  EB78  CD9EEB        		CALL	BTFR
  EB7B  EB            		EX	DE,HL
  EB7C  D9            		EXX
  EB7D  ED51          		 OUT	 (C),D	 ;MAIN
  EB7F  18D3          		 JR	 BDWTCE
                      	
  EB81                	BADR:
  EB81  D9            		 EXX
  EB82  7B            		LD	A,E
  EB83  87            		ADD	A,A
  EB84  CB12          		RL	D
  EB86  87            		ADD	A,A
  EB87  CB12          		RL	D
  EB89  F5            		PUSH	AF
  EB8A  87            		ADD	A,A
  EB8B  7A            		LD	A,D
  EB8C  8F            		ADC	A,A
  EB8D  E60F          		AND	00FH
  EB8F  D9            		EXX
  EB90  01000B        		 LD	 BC,00B00H
  EB93  57            		 LD	 D,A	  ;BANK
  EB94  1E10          		 LD	 E,010H	  ;MAIN
  EB96  D9            		 EXX
  EB97  D1            		POP	DE
  EB98  0600          		LD	B,0
  EB9A  58            		LD	E,B
  EB9B  CBBA          		RES	7,D
  EB9D  C9            		RET
                      	
  EB9E                	BTFR:
  EB9E  D5            		PUSH	DE
  EB9F  F3            		DI
                      	
  EBA0                	BTFR1:
  EBA0  D9            		EXX
  EBA1  ED51          		 OUT	 (C),D	 ;BANK(MAIN)
  EBA3  D9            		 EXX
  EBA4  E3            		EX	(SP),HL
  EBA5  7E            		LD	A,(HL)
  EBA6  23            		INC	HL
  EBA7  4E            		LD	C,(HL)
  EBA8  23            		INC	HL
  EBA9  56            		LD	D,(HL)
  EBAA  23            		INC	HL
  EBAB  5E            		LD	E,(HL)
  EBAC  23            		INC	HL
  EBAD  E3            		EX	(SP),HL
  EBAE  D9            		EXX
  EBAF  ED59          		 OUT	 (C),E	 ;MAIN(BANK)
  EBB1  D9            		 EXX
  EBB2  77            		LD	(HL),A
  EBB3  23            		INC	HL
  EBB4  71            		LD	(HL),C
  EBB5  23            		INC	HL
  EBB6  72            		LD	(HL),D
  EBB7  23            		INC	HL
  EBB8  73            		LD	(HL),E
  EBB9  23            		INC	HL
  EBBA  10E4          		DJNZ	BTFR1
  EBBC  D1            		POP	DE
  EBBD  C9            		RET
                      	
                      	
                      	;	GRAPHIC RAM DISK DRIVER
                      	
                      	
  EBBE                	GDRDC:
  EBBE  CDE7EB        		CALL	GADR
  EBC1  D5            		PUSH	DE
  EBC2  110004        		LD	DE,0400H
  EBC5                	GDRDC1:
  EBC5  EDA2          		INI
  EBC7  04            		INC	B
  EBC8  03            		INC	BC
  EBC9  1D            		DEC	E
  EBCA  20F9          		JR	NZ,GDRDC1
  EBCC  15            		DEC	D
  EBCD  20F6          		JR	NZ,GDRDC1
  EBCF                	GDWTC2:
  EBCF  D1            		POP	DE
  EBD0  E6EF          		AND	0EFH		;BANK0
  EBD2  1821          		JR	S1FD0
                      	
  EBD4                	GDWTC:
  EBD4  CDE7EB        		CALL	GADR
  EBD7  D5            		PUSH	DE
  EBD8  110004        		LD	DE,0400H
  EBDB                	GDWTC1:
  EBDB  04            		INC	B
  EBDC  EDA3          		OUTI
  EBDE  03            		INC	BC
  EBDF  1D            		DEC	E
  EBE0  20F9          		JR	NZ,GDWTC1
  EBE2  15            		DEC	D
  EBE3  20F6          		JR	NZ,GDWTC1
  EBE5  18E8          		JR	GDWTC2
                      	
  EBE7                	GADR:
  EBE7  0E00          		LD	C,0
  EBE9  7B            		LD	A,E
  EBEA  87            		ADD	A,A
  EBEB  87            		ADD	A,A
  EBEC  C640          		ADD	A,040H
  EBEE  47            		LD	B,A
  EBEF  13            		INC	DE
  EBF0  3ABFEC        		LD	A,(WK1FD0)
  EBF3  F610          		OR	010H		;BANK1
  EBF5                	S1FD0:
  EBF5  C5            		PUSH	BC
  EBF6  32BFEC        		LD	(WK1FD0),A
  EBF9  01D01F        		LD	BC,01FD0H
  EBFC  ED79          		OUT	(C),A
  EBFE  C1            		POP	BC
  EBFF  C9            		RET
                      	
  1FC9                	AT_R	EQU	WTTRK-AT_WTTRK
                      	
  EC00                	_PE:
                      	
                      	;LDCALL.ASM
                      	
                      	;	LSX-Dodgers SYSTEM CALL
                      	
  EC00                		ORG	0EC00H
                      	
  EC00                	STABLE:
                      	;0
  EC00  0000A6D6B2D6B7		DW	 00000H,_SYS01,_SYS02,_SYS03
  EC08  E7D6FED61ED7F8		DW	_SYS04,_SYS05,_SYS06,_SYS07
  EC10  26D769D25FD78B		DW	_SYS08,_SYS09,_SYS0A,_SYS0B
  EC18  78D27ED28DD2A0		DW	_SYS0C,_SYS0D,_SYS0E,_SYS0F
                      	;1
  EC20  15D362D3BED3F4		DW	_SYS10,_SYS11,_SYS12,_SYS13
  EC28  FCD31DD43DD435		DW	_SYS14,_SYS15,_SYS16,_SYS17
  EC30  A4D4A9D4AED4B4		DW	_SYS18,_SYS19,_SYS1A,_SYS1B
  EC38  67D2E4D467D2E8		DW	_SYS1C,_SYS1D,_SYS1E,_SYS1F
                      	;2
  EC40  67D274D48CD4F1		DW	_SYS20,_SYS21,_SYS22,_SYS23
  EC48  10D561D295E2BA		DW	_SYS24,_ERROR,_SYS26,_SYS27
  EC50  8CD42BD5A1D722		DW	_SYS28,_SYS29,_SYS2A,_SYS2B
  EC58  DBD722DE67D24E		DW	_SYS2C,_SYS2D,_SYS2E,_SYS2F
                      	;3
  EC60  48D5          		DW	_SYS30
                      	
                      	;LDWORK.ASM
                      	
                      	;	LSX-Dodgers WORK
                      	
  0004                	DDS	EQU	4
  EC62                	DDTB:
  EC62  434F4E20      		DB	"CON "
  EC66  55D3          		DW	OPENDD
  EC68  41555820      		DB	"AUX "
  EC6C  55D3          		DW	OPENDD
  EC6E  50524E20      		DB	"PRN "
  EC72  55D3          		DW	OPENDD
  EC74  4E554C20      		DB	"NUL "
  EC78  55D3          		DW	OPENDD
                      	
  EC7A                		DS	2
  EC7C  00EE          	_FATBF:	DW	FATBF
  EC7E  00FA          	_DTBUF:	DW	DTBUF
                      	
  EC80  FF            	_CYL0:	DB	0FFH	;Cylinder
  EC81  FF            	_CYL1:	DB	0FFH	;Cylinder
  EC82  FF            	_CYL2:	DB	0FFH	;Cylinder
  EC83  FF            	_CYL3:	DB	0FFH	;Cylinder
  EC84  00            	_DRIVE:	DB	0	;unit number
  EC85  00            	_SEEKSP:DB	0	;Seek speed
  EC86  FF            	_ISEEK:	DB	0FFH	;
  EC87  00            	_DVSW:	DB	0
  EC88  00            	_DRV:	DB	0
  EC89  FF            	_DSK:	DB	0FFH
  EC8A  8000          	_DTA:	DW	00080H
  EC8C  0000          	_CTC:	DW	0
  EC8E  0000          	_TXADR:	DW	0
  EC90  0000          	_KEYPS	DW	0
  EC92  00FF          	_KEYD	DW	0FF00H
  EC94  C210          	_KEYSP:	DW	010C2H
  EC96  07            	_COLORF:DB	7
  EC97  18            	_LINE:	DB	LINE
                      	
  EC98  0000          	_FCB:	DW	0
  EC9A  0000          	_FBPS:	DW	0	;SEARCH FILES
  EC9C  0000          	_FBAD:	DW	0	;    //
  EC9E  00            	_FBCNT:	DB	0	;    //
  EC9F  00            	_FILEN:	DB	0
  ECA0  00            	_DIRF:	DB	0
  ECA1  00            	_MAXCYL:DB	0
  ECA2  00            	_WTFATF:DB	0
  ECA3  FF            	_FATDRV:DB	0FFH
  ECA4  00            	_WTDBF:	DB	0
  ECA5  FF            	_DBDRV:	DB	0FFH
  ECA6  0000          	_DCLPS:	DW	0
                      	
  ECA8                		DS	8
                      	
  ECB0  6F5059381F0219	CRTCD:	DB	06FH,050H,059H,038H,01FH,002H,019H,01CH
  ECB8  0007          		DB	000H,007H
  ECBA  80F8B0FF      		DW	0-80*LINE,0-80
  ECBE  0C            		DB	00CH
  ECBF  A0            	WK1FD0:	DB	0A0H
                      	
  ECC0  D6D5          	CTC0:	DW	INTCTCE
  ECC2  D6D5          	CTC1:	DW	INTCTCE
  ECC4  FED5          	CTC2:	DW	INTCTC2
  ECC6  D6D5          	CTC3:	DW	INTCTCE
  ECC8  96D5          	INTVEC:	DW	INT
                      	
                      	;	JUMP
                      	
  ECCA  C30FDC        	_INKEY:	JP	INKEY
  ECCD  C36CD8        	_PRINT:	JP	PRINT
  ECD0  C35ADB        	_SCRN:	JP	SCRN
  ECD3  C382DB        	_POS:	JP	POS
  ECD6  C3B1D9        	_LOC:	JP	LOC
  ECD9  C3D8E7        	_CHGDRV:JP	CHGDRV
  ECDC  C3ABE8        	_GETDPB:JP	GETDPB
  ECDF  C3BFE8        	_FFLUSH:JP	FFLUSH
  ECE2  C375E5        	_RDFATX:JP	RDFATX
  ECE5  C34AE6        	_RDFAT:	JP	RDFAT
  ECE8  C33FEA        	_WTTRK:	JP	WTTRK
  ECEB  C34CEA        	_FDRD:	JP	FDRD
  ECEE  C342EA        	_FDWT:	JP	FDWT
  ECF1  C3EBEC        	_DRD:	JP	_FDRD	;(Self-rewriting)
  ECF4  C3EEEC        	_DWT:	JP	_FDWT	;(Self-rewriting)
  ECF7  C3F7E5        	_GNCL:	JP	GNCL	;(Self-rewriting)
  ECFA  C31AE6        	_SNCL:	JP	SNCL	;(Self-rewriting)
  ECFD  C32BCD        	_COMANL:JP	COMANL
                      	
  ED00                	WE:
                      	
                      	;LDDPB.ASM
                      	
                      	;	LSX-Dodgers DPB
                      	
  ED00                	DEVICE:
                      	
                      	;	A:
                      	
  ED00  02            	DPB_00_FATLN:	DB	2
  ED01  FD            	DPB_01_FATID:	DB	0FDH
  ED02  EBEC          	DPB_02_DRDC:	DW	_FDRD
  ED04  EEEC          	DPB_04_DWTC:	DW	_FDWT
  ED06  08            	DPB_06_ADDCL:	DB	8
  ED07  29            	DPB_07_DBLCL:	DB	029H	;029H=1 sector:512 / 0=1 sector:1024
  ED08  6401          	DPB_08_MAXCL:	DW	356
  ED0A  FF            	DPB_0A_FDMODE:	DB	0FFH	;0FFH=2D / 0FEH=2HD
  ED0B  0C            	DPB_0B_MAXDIR:	DB	12
  ED0C  28            	DPB_0C_MAXCYL:	DB	40
  ED0D  09            	DPB_0D_MAXSEC:	DB	9	;Number of sectors
  ED0E  01            	DPB_0E_FATPS:	DB	1
  ED0F  02            	DPB_0F_FATS:	DB	2	;bit7.0:1 cluster=1024 / bit7.1:1 cluster=512 | bit1.1=2FATS(use reserve)
  ED10  05            	DPB_10_DIRPS:	DB	5
  ED11  01            	DPB_11_MINSEC:	DB	1	;Minimum sector
  ED12  87            	DPB_12_DEVNO:	DB	087H	;Device Number
  ED13  00            	DPB_13_UNITNO:	DB	0
  ED14  0000          	DPB_14		DW	0
  ED16  0000          	DPB_16_GNCL:	DW	0
  ED18  0000          	DPB_18_SNCL:	DW	0
  ED1A  0000          	DPB_1A_SDIR:	DW	0
  ED1C  46444430      	DPB_1C_NAME:	DB	"FDD0"
                      	
                      	;	B:
                      	
  ED20  02            		DB	2
  ED21  FD            		DB	0FDH
  ED22  EBEC          		DW	_FDRD
  ED24  EEEC          		DW	_FDWT
  ED26  08            		DB	8
  ED27  29            		DB	029H	;029H=512 / 0=1024
  ED28  6401          		DW	356
  ED2A  FF            		DB	0FFH	;0FFH=2D / 0FEH=2HD
  ED2B  0C            		DB	12
  ED2C  28            		DB	40
  ED2D  09            		DB	9
  ED2E  01            		DB	1
  ED2F  02            		DB	2
  ED30  05            		DB	5
  ED31  01            		DB	1
  ED32  87            		DB	087H	;Device Number
  ED33  01            		DB	1
  ED34  0000          		DW	0
  ED36  0000          		DW	0
  ED38  0000          		DW	0
  ED3A  0000          		DW	0
  ED3C  46444431      		DB	"FDD1"
                      	
                      	;	C:
                      	
  ED40  02            		DB	2
  ED41  FD            		DB	0FDH
  ED42  EBEC          		DW	_FDRD
  ED44  EEEC          		DW	_FDWT
  ED46  08            		DB	8
  ED47  29            		DB	029H	;029H=512 / 0=1024
  ED48  6401          		DW	356
  ED4A  FF            		DB	0FFH	;0FFH=2D / 0FEH=2HD
  ED4B  0C            		DB	12
  ED4C  28            		DB	40
  ED4D  09            		DB	9
  ED4E  01            		DB	1
  ED4F  02            		DB	2
  ED50  05            		DB	5
  ED51  01            		DB	1
  ED52  87            		DB	087H	;Device Number
  ED53  02            		DB	2
  ED54  0000          		DW	0
  ED56  0000          		DW	0
  ED58  0000          		DW	0
  ED5A  0000          		DW	0
  ED5C  46444432      		DB	"FDD2"
                      	
                      	;	D:
                      	
  ED60  02            		DB	2
  ED61  FD            		DB	0FDH
  ED62  EBEC          		DW	_FDRD
  ED64  EEEC          		DW	_FDWT
  ED66  08            		DB	8
  ED67  29            		DB	029H	;029H=512 / 0=1024
  ED68  6401          		DW	356
  ED6A  FF            		DB	0FFH	;0FFH=2D / 0FEH=2HD
  ED6B  0C            		DB	12
  ED6C  28            		DB	40
  ED6D  09            		DB	9
  ED6E  01            		DB	1
  ED6F  02            		DB	2
  ED70  05            		DB	5
  ED71  01            		DB	1
  ED72  87            		DB	087H	;Device Number
  ED73  03            		DB	3
  ED74  0000          		DW	0
  ED76  0000          		DW	0
  ED78  0000          		DW	0
  ED7A  0000          		DW	0
  ED7C  46444433      		DB	"FDD3"
                      	
                      	;	E:
                      	
  ED80  00            	EMMFL:	DB	0
  ED81  FE            		DB	0FEH
  ED82  F8EA          	EMMRD:	DW	EDRDC
  ED84  F5EA          	EMMWR:	DW	EDWTC
  ED86  09            		DB	9
  ED87  00            		DB	0
  ED88  0000          	EMMCL:	DW	0
  ED8A  00            		DB	0
  ED8B  0B            		DB	11
  ED8C  00            	EMMBL:	DB	0
  ED8D  01            		DB	1
  ED8E  01            		DB	1
  ED8F  01            		DB	1
  ED90  05            		DB	5
  ED91  01            		DB	1
  ED92  06            		DB	6	;Device Number
  ED93  00            	EMMDV:	DB	0
  ED94  0000          		DW	0
  ED96  0000          		DW	0
  ED98  0000          		DW	0
  ED9A  0000          		DW	0
  ED9C  454D4D30      		DB	"EMM0"
                      	
                      	;	F:
                      	
  EDA0  00            	BANKFL:	DB	0
  EDA1  F9            		DB	0F9H
  EDA2  3CEB          		DW	BDRDC
  EDA4  5FEB          		DW	BDWTC
  EDA6  03            		DB	3
  EDA7  00            		DB	0
  EDA8  0000          	BANKCL:	DW	0
  EDAA  00            		DB	0
  EDAB  05            		DB	5
  EDAC  00            		DB	0
  EDAD  01            		DB	1
  EDAE  00            		DB	0
  EDAF  01            		DB	1
  EDB0  01            		DB	1
  EDB1  01            		DB	1
  EDB2  0B            		DB	00BH	;Device Number
  EDB3  00            		DB	0
  EDB4  0000          		DW	0
  EDB6  0000          		DW	0
  EDB8  0000          		DW	0
  EDBA  0000          		DW	0
  EDBC  4252414D      		DB	"BRAM"
                      	
                      	;	G:
                      	
  EDC0  01            		DB	1
  EDC1  F9            		DB	0F9H
  EDC2  BEEB          		DW	GDRDC
  EDC4  D4EB          		DW	GDWTC
  EDC6  00            		DB	0
  EDC7  00            		DB	0
  EDC8  3000          		DW	48
  EDCA  00            		DB	0
  EDCB  02            		DB	2
  EDCC  00            		DB	0
  EDCD  01            		DB	1
  EDCE  00            		DB	0
  EDCF  01            		DB	1
  EDD0  01            		DB	1
  EDD1  01            		DB	1
  EDD2  05            		DB	5	;Device Number
  EDD3  01            		DB	1
  EDD4  0000          		DW	0
  EDD6  0000          		DW	0
  EDD8  0000          		DW	0
  EDDA  0000          		DW	0
  EDDC  4752414D      		DB	"GRAM"
                      	
                      	
                      	
  EDE0  00            	LDEND:	DB	0
                      	
  EDE1                		END
