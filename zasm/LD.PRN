			  Z80 ASSEMBLER - ZASM VER 1.6
                      	;	LSX-Dodgers for X1/turbo/Z
                      	;	Programmed by
                      	;	Gaku (Lovers/Tablacus)
                      	
  C600                	RUN	EQU	0C600h
                      	
  C5F9                		ORG	RUN-7
                      	
                      	;	MSX BINARY HEADER
  C5F9  FE            		DB	0FEH
                      	;	MSX BINARY START ADDRESS
  C5FA  00C6          		DW	RUN
                      	;	MSX BINARY END ADDRESS
  C5FC  E0ED          		DW	LDEND
                      	;	MSX BINARY EXEC ADDRESS
  C5FE  00C6          		DW	RUN
                      	;LDDEF.ASM
                      	
                      	;	LSX-Dodgers DEF
                      	
  1D80                	MAC	EQU	01D80H		;X1
  0001                	VER_1   EQU	1
  0003                	VER_2   EQU	3
  0000                	VER_3   EQU	0
  0130                	VER	EQU	VER_1 * 256 + VER_2 * 16 + VER_3
                      	
  0000                	STACK	EQU	00000H
  0005                	SYSTEM	EQU	00005H
  000F                	JP_HL	EQU	0000FH
  005C                	FCB1	EQU	0005CH
  006C                	FCB2	EQU	0006CH
  0080                	DTA1	EQU	00080H
  00DB                	FDRV	EQU	00100H-37
  00DC                	FNAME	EQU	FDRV+1
  00D6                	DECBF	EQU	FDRV-5
  EE00                	FATBF	EQU	0EE00H
  FA00                	DTBUF	EQU	0FA00H
  FE00                	KEYBF	EQU	0FE00H
  FF00                	KBUF	EQU	0FF00H
  FF51                	DTA	EQU	KBUF+81
  FFD4                	EXTSP	EQU	0FFD4H
  0019                	LINE	EQU	25
                      	
                      	;LDINIT.ASM
                      	
                      	;	LSX-Dodgers INIT
                      	
  C600  C307C6        		JP	START
  C603  801D          	MACHINE:DW	MAC
  C605  3001          	VERSION:DW	VER
                      	
  C607                	START:
  C607  F3            		DI
  C608  ED5E          		IM	2
  C60A  310000        		LD	SP,STACK
  C60D  3E1E          		LD	A,01EH
  C60F  D300          		OUT	(0),A
                      	
  C611  010000        		LD	BC,0
  C614  ED438CEC      		LD	(_CTC),BC
  C618  01040A        		LD	BC,00A04H
  C61B  CD69C9        		CALL	CHKCTC
  C61E  010407        		LD	BC,00704H
  C621  CD69C9        		CALL	CHKCTC
  C624  01A81F        		LD	BC,01FA8H
  C627  CD69C9        		CALL	CHKCTC
  C62A  01A01F        		LD	BC,01FA0H
  C62D  CD69C9        		CALL	CHKCTC
                      	;
  C630                	INISIO:
  C630  01911F        		LD	BC,01F91H	;INIT SIO
  C633  1601          		LD	D,1
  C635  ED51          		OUT	(C),D
                      	;	OUT	(C),0		;未定義命令ニーモニック
  C637  ED71          		DB	0EDH,071H
  C639  0E93          		LD	C,093H
  C63B  ED51          		OUT	(C),D
                      	;	OUT	(C),0		;未定義命令ニーモニック
  C63D  ED71          		DB	0EDH,071H
  C63F  0E99          		LD	C,099H		;INIT SIO
  C641  1601          		LD	D,1
  C643  ED51          		OUT	(C),D
                      	;	OUT	(C),0		;未定義命令ニーモニック
  C645  ED71          		DB	0EDH,071H
  C647  0E9B          		LD	C,09BH
  C649  ED51          		OUT	(C),D
                      	;	OUT	(C),0		;未定義命令ニーモニック
  C64B  ED71          		DB	0EDH,071H
                      	
  C64D  0E80          		LD	C,080H		;INIT DMA
  C64F  2106C3        		LD	HL,0C306H
  C652                	INIDMA:
  C652  ED61          		OUT	(C),H
  C654  2D            		DEC	L
  C655  20FB          		JR	NZ,INIDMA
                      	
  C657  3EE4          		LD	A,0E4H
  C659  CD1BDB        		CALL	COMOUT
  C65C  AF            		XOR	A
  C65D  CDF5DA        		CALL	OT49SB
                      	
  C660  3EEC          		LD	A,INTVEC/256
  C662  ED47          		LD	I,A
                      	
  C664  ED4B8CEC      		LD	BC,(_CTC)
  C668  0B            		DEC	BC
  C669  0B            		DEC	BC
                      	
                      	;	OUT	(C),0		;未定義命令ニーモニック
  C66A  ED71          		DB	0EDH,071H
  C66C  3EC0          		LD	A,CTC0
  C66E  ED79          		OUT	(C),A
                      	
  C670  0C            		INC	C
  C671  3E47          		LD	A,047H
  C673  ED79          		OUT	(C),A
  C675  3E0D          		LD	A,13		;Baudrate 9600-13
  C677  ED79          		OUT	(C),A
                      	
  C679  79            		LD	A,C
  C67A  D610          		SUB	010H
  C67C  4F            		LD	C,A
  C67D  ED431CCC      		LD	(SIOAD+1),BC
  C681  ED4345CC      		LD	(SIOAD0+1),BC
  C685  ED434BCC      		LD	(SIOAD1+1),BC
                      	
  C689  2111CA        		LD	HL,SIODATA
  C68C                	SINIT1:
  C68C  7E            		LD	A,(HL)
  C68D  23            		INC	HL
  C68E  FEFF          		CP	0FFH
  C690  2804          		JR	Z,SINIT2
  C692  ED79          		OUT	(C),A
  C694  18F6          		JR	SINIT1
  C696                	SINIT2:
  C696  3EE4          		LD	A,0E4H
  C698  CD1BDB        		CALL	COMOUT
  C69B  3EC8          		LD	A,INTVEC
  C69D  CDF5DA        		CALL	OT49SB
                      	;
  C6A0  01C41F        		LD	BC,01FC4H
  C6A3  3E0C          		LD	A,00CH
  C6A5  ED79          		OUT	(C),A
                      	
  C6A7  0EC0          		LD	C,0C0H
                      	;	OUT	(C),0		;未定義命令ニーモニック
  C6A9  ED71          		DB	0EDH,071H
                      	
  C6AB  0C            		INC	C
  C6AC  3E28          		LD	A,40
  C6AE  ED79          		OUT	(C),A
                      	
  C6B0  0C            		INC	C
                      	;	OUT	(C),0		;未定義命令ニーモニック
  C6B1  ED71          		DB	0EDH,071H
                      	
  C6B3  0C            		INC	C
                      	;	OUT	(C),0		;未定義命令ニーモニック
  C6B4  ED71          		DB	0EDH,071H
                      	
  C6B6  0EC5          		LD	C,0C5H
                      	;	OUT	(C),0		;未定義命令ニーモニック
  C6B8  ED71          		DB	0EDH,071H
                      	
  C6BA                	TEXT:
  C6BA  0EB0          		LD	C,0B0H
  C6BC  3E80          		LD	A,080H
  C6BE  ED79          		OUT	(C),A
  C6C0  1607          		LD	D,7
  C6C2  0EB9          		LD	C,0B9H
  C6C4  210ACA        		LD	HL,TEXTDT
  C6C7                	TEXT1:
  C6C7  04            		INC	B
  C6C8  EDA3          		OUTI
  C6CA  0C            		INC	C
  C6CB  15            		DEC	D
  C6CC  20F9          		JR	NZ,TEXT1
  C6CE  01B01F        		LD	BC,01FB0H
                      	;	OUT	(C),0		;未定義命令ニーモニック
  C6D1  ED71          		DB	0EDH,071H
                      	
  C6D3  0EC4          		LD	C,0C4H
                      	;	OUT	(C),0		;未定義命令ニーモニック
  C6D5  ED71          		DB	0EDH,071H
                      	
  C6D7  01011A        		LD	BC,01A01H
  C6DA  ED78          		IN	A,(C)
  C6DC  E608          		AND	8
  C6DE  2809          		JR	Z,PRN
  C6E0  0E03          		LD	C,003H
  C6E2  3E0F          		LD	A,00FH
  C6E4  ED79          		OUT	(C),A
  C6E6  01040A        		LD	BC,00A04H
  C6E9                	PRN:
  C6E9  110100        		LD	DE,1
  C6EC  62            		LD	H,D
  C6ED  6A            		LD	L,D
  C6EE  017F00        		LD	BC,07FH
  C6F1  36FF          		LD	(HL),0FFH
  C6F3  EDB0          		LDIR
  C6F5  017F00        		LD	BC,07FH
  C6F8  3600          		LD	(HL),0
  C6FA  EDB0          		LDIR
                      	
  C6FC  3EC3          		LD	A,0C3H		;JP
  C6FE  21B7D3        		LD	HL,WBOOT
  C701  320000        		LD	(00000H),A
  C704  220100        		LD	(00001H),HL	;IPL
                      	
  C707  2A03C6        		LD	HL,(MACHINE)	;3 bit7  DPB Original(1)
  C70A  220300        		LD	(00003H),HL	;  bit6-0 Machine X1(0)
                      	;				;4 LSX-Dodgers(01DH)
  C70D  2106CC        		LD	HL,BDOS
  C710  320500        		LD	(00005H),A
  C713  220600        		LD	(00006H),HL	;BDOS
                      	
  C716  21B0D6        		LD	HL,BIOS
  C719  321800        		LD	(00018H),A	;BIOS-ROM
  C71C  221900        		LD	(00019H),HL
                      	
  C71F  210000        		LD	HL,0
  C722  323800        		LD	(00038H),A	;RST038H
  C725  223900        		LD	(00039H),HL
                      	
  C728  3EEC          		LD	A,STABLE/256
  C72A  320B00        		LD	(0000BH),A
                      	
  C72D  3EE9          		LD	A,0E9H		;JP (HL)
  C72F  320F00        		LD	(0000FH),A
                      	
  C732  3A7DEC        		LD	A,(_FATBF+1)
  C735  321300        		LD	(00013H),A
                      	
  C738  3A7FEC        		LD	A,(_DTBUF+1)
  C73B  321700        		LD	(00017H),A
                      	
  C73E  3EFE          		LD	A,KEYBF/256
  C740  321B00        		LD	(0001BH),A
                      	
  C743  3EFF          		LD	A,KBUF/256
  C745  321F00        		LD	(0001FH),A
                      	
  C748  2A05C6        		LD	HL,(VERSION)
  C74B  225A00        		LD	(0005AH),HL
                      	
  C74E  3EE6          		LD	A,0E6H
  C750  CD1BDB        		CALL	COMOUT
  C753  CD00DB        		CALL	IN49SB
  C756  F5            		PUSH	AF
  C757  CD00DB        		CALL	IN49SB
  C75A  F1            		POP	AF
  C75B  F5            		PUSH	AF
  C75C  E612          		AND	012H
  C75E  2005          		JR	NZ,KEYR
  C760  3E01          		LD	A,1
  C762  32C6C8        		LD	(KEYREP+1),A
  C765                	KEYR:
  C765  F1            		POP	AF
  C766  E603          		AND	3
  C768  280E          		JR	Z,NON
                      	
  C76A  01D03F        		LD	BC,03FD0H
  C76D  ED49          		OUT	(C),C
  C76F  3E37          		LD	A,037H
  C771  D3D0          		OUT	(0D0H),A
  C773  ED78          		IN	A,(C)
  C775  B9            		CP	C
  C776  286A          		JR	Z,TURBO
  C778                	NON:
  C778  3D            		DEC	A		;A=0FFH
  C779  321800        		LD	(00018H),A	;BIOS-ROM
                      	
  C77C  211DCA        		LD	HL,AT_SCR1
  C77F  11A5DB        		LD	DE,SCR1
  C782  019F00        		LD	BC,SCRNX-SCR1	;転送先のサイズ確認用
  C785  019F00        		LD	BC,AT_SCRE-AT_SCR1
  C788  EDB0          		LDIR
                      	
  C78A  21BCCA        		LD	HL,AT_WTTRK
  C78D  1149EA        		LD	DE,WTTRK
  C790  01B700        		LD	BC,DMAE-WTTRK	;転送先のサイズ確認用
  C793  019B00        		LD	BC,AT_CPUE-AT_WTTRK
  C796  EDB0          		LDIR
                      	
  C798  2157CB        		LD	HL,AT_EDWTC
  C79B  1144CD        		LD	DE,EDWTC
  C79E  014700        		LD	BC,EMME-EDWTC	;転送先のサイズ確認用
  C7A1  014300        		LD	BC,AT_EMME-AT_EDWTC
  C7A4  EDB0          		LDIR
                      	
  C7A6  219DEA        		LD	HL,AT_DRD+AT_R
  C7A9  22ECEC        		LD	(_FDRD+1),HL
  C7AC  214DEA        		LD	HL,AT_DWT+AT_R
  C7AF  22EFEC        		LD	(_FDWT+1),HL
  C7B2  2158CD        		LD	HL,AT_EDRDC+AT_RE
  C7B5  2282ED        		LD	(EMMRD),HL
  C7B8  2144CD        		LD	HL,AT_EDWTC+AT_RE
  C7BB  2284ED        		LD	(EMMWR),HL
                      	
  C7BE  210000        		LD	HL,0
  C7C1  2246DB        		LD	(X1PAT),HL
                      	
  C7C4  3EAF          		LD	A,0AFH		;XOR	A
  C7C6  3258D9        		LD	(X1KPAT),A
                      	
  C7C9  2144DC        		LD	HL,SCRNX
  C7CC  22D1EC        		LD	(_SCRN+1),HL
                      	
  C7CF  CD90C9        		CALL	SETCRTC
  C7D2  0610          		LD	B,010H		;PALET
                      	;	OUT	(C),0		;未定義命令ニーモニック
  C7D4  ED71          		DB	0EDH,071H
  C7D6  04            		INC	B
                      	;	OUT	(C),0		;未定義命令ニーモニック
  C7D7  ED71          		DB	0EDH,071H
  C7D9  04            		INC	B
                      	;	OUT	(C),0		;未定義命令ニーモニック
  C7DA  ED71          		DB	0EDH,071H
  C7DC  04            		INC	B
                      	;	OUT	(C),0		;未定義命令ニーモニック
  C7DD  ED71          		DB	0EDH,071H
  C7DF  C382C8        		JP	NOBANK
                      	
  C7E2                	TURBO:
  C7E2  F3            		DI			;Check BIOS
  C7E3  061D          		LD	B,01DH
  C7E5  ED79          		OUT	(C),A		;BIOS ON
  C7E7  3A512F        		LD	A,(02F51H)
  C7EA  04            		INC	B		;B=01EH
  C7EB  ED79          		OUT	(C),A		;BIOS OFF
  C7ED  FB            		EI
  C7EE  FEC9          		CP	0C9H
  C7F0  280B          		JR	Z,BIOSOK
  C7F2  3EAF          		LD	A,0AFH		;XOR	A
  C7F4  3258D9        		LD	(X1KPAT),A
  C7F7  2144DC        		LD	HL,SCRNX
  C7FA  22D1EC        		LD	(_SCRN+1),HL
  C7FD                	BIOSOK:
  C7FD  3E1F          		LD	A,01FH
  C7FF  DBF0          		IN	A,(0F0H)
  C801  0F            		RRCA
  C802  380B          		JR	C,CRT1
  C804  21FAC9        		LD	HL,_C8025H
  C807  11B0EC        		LD	DE,CRTCD
  C80A  011000        		LD	BC,16
  C80D  EDB0          		LDIR
  C80F                	CRT1:
  C80F  CD90C9        		CALL	SETCRTC
  C812  01AA10        		LD	BC,010AAH	;PALET
  C815  ED49          		OUT	(C),C
  C817  01CC11        		LD	BC,011CCH
  C81A  ED49          		OUT	(C),C
  C81C  01F012        		LD	BC,012F0H
  C81F  ED49          		OUT	(C),C
  C821  04            		INC	B
  C822  ED71          		DB	0EDH,071H
                      	
  C824  3E1F          		LD	A,01FH
  C826  DBF0          		IN	A,(0F0H)
  C828  CB57          		BIT	2,A
  C82A  2825          		JR	Z,BANK
                      	
  C82C  AF            		XOR	A
  C82D                	TZ1:
  C82D  F5            		PUSH	AF
  C82E  CDDCEC        		CALL	_GETDPB
  C831  DD7E12        		LD	A,(IX+012H)
  C834  FE87          		CP	087H
  C836  2013          		JR	NZ,TZ2
  C838  DDE5          		PUSH	IX
  C83A  D1            		POP	DE
  C83B  2178EB        		LD	HL,M2HD
  C83E  EDA0          		LDI
  C840  EDA0          		LDI
  C842  13            		INC	DE
  C843  13            		INC	DE
  C844  13            		INC	DE
  C845  13            		INC	DE
  C846  010C00        		LD	BC,12
  C849  EDB0          		LDIR
  C84B                	TZ2:
  C84B  F1            		POP	AF
  C84C  3C            		INC	A
  C84D  FE08          		CP	8
  C84F  38DC          		JR	C,TZ1
                      	
  C851                	BANK:
  C851  01000B        		LD	BC,00B00H
  C854  21007F        		LD	HL,07F00H
  C857  F3            		DI
  C858                	BANK1:
  C858  ED69          		OUT	(C),L
  C85A  5E            		LD	E,(HL)
  C85B  7B            		LD	A,E
  C85C  C6A5          		ADD	A,0A5H
  C85E  77            		LD	(HL),A
  C85F  BE            		CP	(HL)
  C860  73            		LD	(HL),E
  C861  2005          		JR	NZ,BANK2
  C863  2C            		INC	L
  C864  CB65          		BIT	4,L
  C866  28F0          		JR	Z,BANK1
  C868                	BANK2:
  C868  3E10          		LD	A,010H
  C86A  ED79          		OUT	(C),A
  C86C  7D            		LD	A,L
  C86D  B7            		OR	A
  C86E  2812          		JR	Z,NOBANK
  C870  2600          		LD	H,0
  C872  29            		ADD	HL,HL	;*2
  C873  29            		ADD	HL,HL	;*4
  C874  29            		ADD	HL,HL	;*8
  C875  29            		ADD	HL,HL	;*16
  C876  29            		ADD	HL,HL	;*32
  C877  2B            		DEC	HL	;-1
  C878  2B            		DEC	HL	;-2
  C879  2B            		DEC	HL	;-3
  C87A  22A8ED        		LD	(BANKCL),HL
  C87D  3E01          		LD	A,1
  C87F  32A0ED        		LD	(BANKFL),A
  C882                	NOBANK:
  C882                	EMM:
  C882  CD59C9        		CALL	EADR0
  C885  ED78          		IN	A,(C)
  C887  F5            		PUSH	AF
                      	
  C888  110000        		LD	DE,0
  C88B                	ECHECK1:
  C88B  13            		INC	DE
  C88C  CD3CC9        		CALL	EADR2
  C88F  ED60          		IN	H,(C)
  C891  CD3CC9        		CALL	EADR2
  C894  7C            		LD	A,H
  C895  C6E5          		ADD	A,0E5H
  C897  ED79          		OUT	(C),A
  C899  3C            		INC	A
  C89A  CD59C9        		CALL	EADR0
  C89D  ED79          		OUT	(C),A
  C89F  3D            		DEC	A
  C8A0  CD3CC9        		CALL	EADR2
  C8A3  ED68          		IN	L,(C)
  C8A5  CD3CC9        		CALL	EADR2
  C8A8  ED61          		OUT	(C),H
  C8AA  BD            		CP	L
  C8AB  2004          		JR	NZ,ECHECK2
  C8AD  CB5A          		BIT	3,D
  C8AF  28DA          		JR	Z,ECHECK1
  C8B1                	ECHECK2:
  C8B1  CD59C9        		CALL	EADR0
  C8B4  F1            		POP	AF
  C8B5  ED79          		OUT	(C),A
                      	
  C8B7  21F7FF        		LD	HL,0-9
  C8BA  19            		ADD	HL,DE
  C8BB  3008          		JR	NC,NOEMM
  C8BD  2288ED        		LD	(EMMCL),HL
  C8C0  3E03          		LD	A,3
  C8C2  3280ED        		LD	(EMMFL),A
  C8C5                	NOEMM:
  C8C5  3E00          	KEYREP:	LD	A,000H
  C8C7  B7            		OR	A
  C8C8  2807          		JR	Z,KEYR1
  C8CA  010000        		LD	BC,0
  C8CD  ED438CEC      		LD	(_CTC),BC
  C8D1                	KEYR1:
  C8D1  0130F8        		LD	BC,0-80*25
  C8D4  2ABAEC        		LD	HL,(CRTCD+10)
  C8D7  ED43BAEC      		LD	(CRTCD+10),BC
  C8DB  1E0C          		LD	E,00CH
  C8DD  CDCDEC        		CALL	_PRINT
  C8E0  22BAEC        		LD	(CRTCD+10),HL
                      	
  C8E3  21BBC9        		LD	HL,INIMES
  C8E6  CDCBD8        		CALL	MSX
                      	
  C8E9  3A87FF        		LD	A,(0FF87H)
  C8EC  FE08          		CP	8
  C8EE  301E          		JR	NC,INIT0
  C8F0  5F            		LD	E,A
  C8F1  C641          		ADD	A,'A'
  C8F3  32B8C9        		LD	(AUTODV),A
  C8F6  0E0E          		LD	C,00EH
  C8F8  CD0500        		CALL	SYSTEM
  C8FB  1C            		INC	E
  C8FC  2185EC        		LD	HL,_SEEKSP	;Disk error Ignore
  C8FF  CBFE          		SET	7,(HL)
  C901  0E1B          		LD	C,01BH
  C903  CD0500        		CALL	SYSTEM
                      	
  C906  2185EC        		LD	HL,_SEEKSP
  C909  CBBE          		RES	7,(HL)
                      	
  C90B  3C            		INC	A
  C90C  2008          		JR	NZ,INIT1
  C90E                	INIT0:
  C90E  1E00          		LD	E,0
  C910  0E0E          		LD	C,00EH
  C912  CD0500        		CALL	SYSTEM
  C915  AF            		XOR	A
  C916                	INIT1:
  C916  2100FF        		LD	HL,0FF00H
  C919  1101FF        		LD	DE,0FF01H
  C91C  01FF00        		LD	BC,000FFH
  C91F  75            		LD	(HL),L
  C920  EDB0          		LDIR
                      	
  C922  210000        		LD	HL,0
  C925  E5            		PUSH	HL
  C926  B7            		OR	A
  C927  C8            		RET	Z
                      	
  C928  3EE6          		LD	A,0E6H
  C92A  CD1BDB        		CALL	COMOUT
  C92D  CD00DB        		CALL	IN49SB
  C930  CD00DB        		CALL	IN49SB
  C933  FE1B          		CP	01BH
  C935  C8            		RET	Z
  C936  11AFC9        		LD	DE,AUTOD
  C939  C3FDEC        		JP	_COMANL
                      	
  C93C                	EADR2:
  C93C  D5            		PUSH	DE
  C93D  EB            		EX	DE,HL
  C93E  29            		ADD	HL,HL
  C93F  29            		ADD	HL,HL
  C940  ED4B8BED      		LD	BC,(EMMBL-1)
  C944  0E00          		LD	C,0
  C946  09            		ADD	HL,BC
  C947  ED4B93ED      		LD	BC,(EMMDV)
  C94B  060D          		LD	B,00DH
  C94D  ED49          		OUT	(C),C
  C94F  0C            		INC	C
  C950  ED69          		OUT	(C),L
  C952  0C            		INC	C
  C953  ED61          		OUT	(C),H
  C955  0C            		INC	C
  C956  EB            		EX	DE,HL
  C957  D1            		POP	DE
  C958  C9            		RET
                      	
  C959                	EADR0:
  C959  ED4B93ED      		LD	BC,(EMMDV)
  C95D  060D          		LD	B,00DH
                      	;	OUT	(C),0		;未定義命令ニーモニック
  C95F  ED71          		DB	0EDH,071H
  C961  0C            		INC	C
                      	;	OUT	(C),0		;未定義命令ニーモニック
  C962  ED71          		DB	0EDH,071H
  C964  0C            		INC	C
                      	;	OUT	(C),0		;未定義命令ニーモニック
  C965  ED71          		DB	0EDH,071H
  C967  0C            		INC	C
  C968  C9            		RET
                      	
  C969                	CHKCTC:
  C969  C5            		PUSH	BC
  C96A  110347        		LD	DE,04703H
  C96D                	INICTC1:
  C96D  0C            		INC	C
  C96E  ED51          		OUT	(C),D
                      	;	OUT	(C),0		;未定義命令ニーモニック
  C970  ED71          		DB	0EDH,071H
  C972  1D            		DEC	E
  C973  20F8          		JR	NZ,INICTC1
  C975  C1            		POP	BC
                      	
  C976  11FA07        		LD	DE,007FAH
  C979  ED51          		OUT	(C),D
  C97B  ED59          		OUT	(C),E
  C97D  ED78          		IN	A,(C)
  C97F  BB            		CP	E
  C980  C0            		RET	NZ
  C981  ED51          		OUT	(C),D
  C983  ED51          		OUT	(C),D
  C985  ED78          		IN	A,(C)
  C987  BA            		CP	D
  C988  C0            		RET	NZ
  C989  03            		INC	BC
  C98A  03            		INC	BC
  C98B  ED438CEC      		LD	(_CTC),BC
  C98F  C9            		RET
                      	
  C990                	SETCRTC:
  C990  21B0EC        		LD	HL,CRTCD
  C993  AF            		XOR	A
  C994                	SETCRT1:
  C994  010018        		LD	BC,01800H
  C997  ED79          		OUT	(C),A
  C999  0C            		INC	C
  C99A  04            		INC	B
  C99B  EDA3          		OUTI
  C99D  3C            		INC	A
  C99E  FE0C          		CP	12
  C9A0  20F2          		JR	NZ,SETCRT1
  C9A2  23            		INC	HL
  C9A3  23            		INC	HL
  C9A4  01031B        		LD	BC,01A03H+00100H
  C9A7  EDA3          		OUTI
  C9A9  01D020        		LD	BC,01FD0H+00100H
  C9AC  EDA3          		OUTI
  C9AE  C9            		RET
                      	
  C9AF  4155544F455845	AUTOD:	DB	"AUTOEXEC "
  C9B8  413A00        	AUTODV:	DB	"A:",0
                      	
  C9BB  4C53582D446F64	INIMES:	DB	"LSX-Dodgers for X1/turbo version "
  C9DC  312E          		DB	030H + VER_1, '.'
  C9DE  3330          		DB	030H + VER_2 ,030H + VER_3
  C9E0  2047616B752028		DB	' Gaku (Lovers/Tablacus)',0DH,0AH
  C9F9  00            		DB	0
                      	
  C9FA                	_C8025H:
  C9FA  6B5059881B0119		DB	06BH,050H,059H,088H,01BH,001H,019H,01AH
  CA02  000F          		DB	000H,00FH
  CA04  30F8B0FF      		DW	0-80*LINE,0-80
  CA08  0CA3          		DB	00CH,0A3H
                      	
  CA0A  030C0F30333C3F	TEXTDT:	DB	003H,00CH,00FH,030H,033H,03CH,03FH
                      	
  CA11                	SIODATA:
  CA11  18            		DB	018H
  CA12  0100          		DB	1,0
  CA14  0200          		DB	2,0
  CA16  03C1          		DB	3,0C1H
  CA18  0444          		DB	4,044H
  CA1A  05E8          		DB	5,0E8H
  CA1C  FF            		DB	0FFH
                      	
                      	;	ノンターボ用パッチ
                      	
  CA1D                	AT_SCR1:
  CA1D  D9            		EXX
  CA1E  C5            		PUSH	BC
  CA1F  015020        		LD	BC,02000H+80
  CA22  D9            		EXX
  CA23  C5            		PUSH	BC
  CA24  010020        		LD	BC,02000H
                      	
  CA27  67            		LD	H,A
  CA28  B7            		OR	A
  CA29                	AT_SCRUP1:
  CA29  2815          		JR	Z,AT_SCRCL
  CA2B  C5            		PUSH	BC
  CA2C  CBE0          		SET	4,B
  CA2E  D9            		EXX
  CA2F  C5            		PUSH	BC
  CA30  CBE0          		SET	4,B
  CA32  D9            		EXX
  CA33  CDDFDB        		CALL	AT_UPSUB+AT_RS
  CA36  D9            		EXX
  CA37  C1            		POP	BC
  CA38  D9            		EXX
  CA39  C1            		POP	BC
  CA3A  CDDFDB        		CALL	AT_UPSUB+AT_RS
  CA3D  25            		DEC	H
  CA3E  18E9          		JR	AT_SCRUP1
                      	
  CA40                	AT_SCRCL:
  CA40  215020        		LD	HL,02000H+80
  CA43  3A96EC        		LD	A,(_COLORF)
  CA46                	AT_SCRCL1:
  CA46  CBE0          		SET	4,B
  CA48  ED61          		OUT	(C),H
  CA4A  CBA0          		RES	4,B
  CA4C  ED79          		OUT	(C),A
  CA4E  03            		INC	BC
  CA4F  2D            		DEC	L
  CA50  20F4          		JR	NZ,AT_SCRCL1
  CA52  C1            		POP	BC
  CA53  D9            		EXX
  CA54  C1            		POP	BC
  CA55  D9            		EXX
  CA56  C9            		RET
                      	
  CA57                	AT_UPSUB:
  CA57  2E28          		LD	L,40
  CA59                	AT_UPSUB1:
  CA59  D9            		EXX
  CA5A  ED78          		IN	A,(C)
  CA5C  03            		INC	BC
  CA5D  D9            		EXX
  CA5E  ED79          		OUT	(C),A
  CA60  03            		INC	BC
  CA61  D9            		EXX
  CA62  ED78          		IN	A,(C)
  CA64  03            		INC	BC
  CA65  D9            		EXX
  CA66  ED79          		OUT	(C),A
  CA68  03            		INC	BC
  CA69  2D            		DEC	L
  CA6A  20ED          		JR	NZ,AT_UPSUB1
  CA6C  C9            		RET
                      	
                      	;	FLOPPY DISK DRIVER(CPU)
                      	
  CA6D                	DISKC:
  CA6D  1B            		DEC	DE
  CA6E  CB5F          		BIT	3,A
  CA70  C442EA        		CALL	NZ,RNF
  CA73                	DISKD:
  CA73  E5            		PUSH	HL
  CA74  2148EA        		LD	HL,RETRY
  CA77  35            		DEC	(HL)
  CA78  E1            		POP	HL
  CA79  203E          		JR	NZ,AT_ERR		;Retry
  CA7B  B7            		OR	A
  CA7C  283B          		JR	Z,AT_ERR		;Error
                      	
  CA7E                	AT_DELP:
  CA7E  CD42EA        		CALL	RNF
  CA81  CD1EEA        		CALL	FDMOFF
  CA84  3A85EC        		LD	A,(_SEEKSP)
  CA87  87            		ADD	A,A
  CA88  382E          		JR	C,AT_ERRZ
  CA8A                	AT_DELP1:
  CA8A  D5            		PUSH	DE
  CA8B  21B0EB        		LD	HL,DEMES
  CA8E  CDCBD8        		CALL	MSX
  CA91  CDB0D7        		CALL	KEYBC
  CA94                	AT_DELP2:
  CA94  CDCAEC        		CALL	_INKEY
  CA97  28FB          		JR	Z,AT_DELP2
                      	
  CA99  D1            		POP	DE
  CA9A  CDE7DF        		CALL	CAP
  CA9D  FE52          		CP	'R'		;Retry
  CA9F  200A          		JR	NZ,AT_DELP3
  CAA1  210000        	DHLPAT:	LD	HL,0
  CAA4  3E02          		LD	A,2
  CAA6  3248EA        		LD	(RETRY),A
  CAA9  B7            		OR	A
  CAAA  C9            		RET
  CAAB                	AT_DELP3:
  CAAB  FE49          		CP	'I'		;Ignore
  CAAD  2807          		JR	Z,AT_IGNORE
  CAAF  FE41          		CP	'A'		;Abort
  CAB1  20D7          		JR	NZ,AT_DELP1
  CAB3  C3B4D3        		JP	BOOT
  CAB6                	AT_IGNORE:
  CAB6  3EFF          		LD	A,0FFH
  CAB8                	AT_ERRZ:
  CAB8  BF            		CP	A
  CAB9                	AT_ERR:
  CAB9  3EFF          		LD	A,0FFH
  CABB  C9            		RET
                      	
  CABC                	AT_SCRE:
                      	
  CABC                	AT_WTTRK:
  CABC  3EF0          		LD	A,0F0H
  CABE  1802          		JR	AT_WTTRK1
                      	
  CAC0                	AT_DWT:
  CAC0  3EA0          		LD	A,0A0H
  CAC2                	AT_WTTRK1:
  CAC2  32E6E9        		LD	(FDCPAT+1),A
                      	
  CAC5  3E02          		LD	A,2		;Retry count
  CAC7  3248EA        		LD	(RETRY),A
                      	
  CACA                	DWT0:
  CACA  D5            		PUSH	DE
  CACB  E5            		PUSH	HL
  CACC  222ADC        		LD	(DHLPAT+1+AT_RS),HL
  CACF  CD7FE9        		CALL	SEEK		;Write disk
  CAD2  E1            		POP	HL
  CAD3  3831          		JR	C,ERRDW
  CAD5  F3            		DI
  CAD6  3AE6E9        		LD	A,(FDCPAT+1)
  CAD9  CD2AEA        		CALL	SECSET
  CADC  0EFB          		LD	C,0FBH
                      	
  CADE                	DWT1:
  CADE  56            		LD	D,(HL)
  CADF                	DWT2:
  CADF  78            		LD	A,B
  CAE0  DBF8          		IN	A,(0F8H)
  CAE2  0F            		RRCA
  CAE3  3008          		JR	NC,DWT4
  CAE5  0F            		RRCA
  CAE6  30F7          		JR	NC,DWT2
  CAE8                	DWT3:
  CAE8  ED51          		OUT	(C),D
  CAEA  23            		INC	HL
  CAEB  18F1          		JR	DWT1
                      	
  CAED                	DWT4:
  CAED  3D            		DEC	A
  CAEE  28F8          		JR	Z,DWT3
  CAF0  3C            		INC	A
  CAF1  FB            		EI
  CAF2  D1            		POP	DE
  CAF3  13            		INC	DE
  CAF4  CD1EEA        		CALL	FDMOFF
  CAF7  C8            		RET	Z
  CAF8  CDF5DB        		CALL	DISKC+AT_RS
  CAFB  20CD          		JR	NZ,DWT0
  CAFD  B7            		OR	A
  CAFE  C8            		RET	Z
  CAFF                	ERRW:
  CAFF  3EFF          		LD	A,0FFH
  CB01                	ERRZ:
  CB01  BF            		CP	A
  CB02  37            		SCF
  CB03  C31EEA        		JP	FDMOFF
                      	
  CB06                	ERRDW:
  CB06  D1            		POP	DE
  CB07  CD06DC        		CALL	AT_DELP+AT_RS
  CB0A  20BE          		JR	NZ,DWT0
  CB0C  B7            		OR	A
  CB0D  20F0          		JR	NZ,ERRW
  CB0F  C9            		RET
                      	
  CB10                	AT_DRD:
  CB10  3E80          		LD	A,080H
  CB12  32E6E9        		LD	(FDCPAT+1),A
                      	
  CB15  3E02          		LD	A,2		;Retry count
  CB17  3248EA        		LD	(RETRY),A
                      	
  CB1A                	DRD0:
  CB1A  D5            		PUSH	DE
  CB1B  E5            		PUSH	HL
  CB1C  222ADC        		LD	(DHLPAT+1+AT_RS),HL
  CB1F  CD7FE9        		CALL	SEEK		;Read disk
  CB22  E1            		POP	HL
  CB23  3828          		JR	C,ERRDR
  CB25  F3            		DI
  CB26  3AE6E9        		LD	A,(FDCPAT+1)
  CB29  CD2AEA        		CALL	SECSET
  CB2C  0EFB          		LD	C,0FBH
  CB2E                	DRD1:
  CB2E  78            		LD	A,B
  CB2F  DBF8          		IN	A,(0F8H)
  CB31  0F            		RRCA
  CB32  3008          		JR	NC,DRD3
  CB34  0F            		RRCA
  CB35  30F7          		JR	NC,DRD1
  CB37  EDA2          		INI
  CB39  04            		INC	B
  CB3A  18F2          		JR	DRD1
                      	
  CB3C                	DRD3:
  CB3C  B7            		OR	A
  CB3D  FB            		EI
  CB3E  D1            		POP	DE
  CB3F  13            		INC	DE
  CB40  CD1EEA        		CALL	FDMOFF
  CB43  C8            		RET	Z
  CB44  CDF5DB        		CALL	DISKC+AT_RS
  CB47  20D1          		JR	NZ,DRD0
  CB49  B7            		OR	A
  CB4A  20B3          		JR	NZ,ERRW
  CB4C  C9            		RET
                      	
  CB4D                	ERRDR:
  CB4D  D1            		POP	DE
  CB4E  CD06DC        		CALL	AT_DELP+AT_RS
  CB51  20C7          		JR	NZ,DRD0
  CB53  B7            		OR	A
  CB54  20A9          		JR	NZ,ERRW
  CB56  C9            		RET
                      	
  CB57                	AT_CPUE:
                      	
                      	
                      	;	EMM DRIVER(CPU)
                      	
                      	
  CB57                	AT_EDWTC:
  CB57  CD6CCD        		CALL	AT_EADR+AT_RE
  CB5A                	AT_EDWTC1:
  CB5A  04            		INC	B
  CB5B  EDA3          		OUTI
  CB5D  04            		INC	B
  CB5E  EDA3          		OUTI
  CB60  04            		INC	B
  CB61  EDA3          		OUTI
  CB63  04            		INC	B
  CB64  EDA3          		OUTI
  CB66  3D            		DEC	A
  CB67  20F1          		JR	NZ,AT_EDWTC1
  CB69  AF            		XOR	A
  CB6A  C9            		RET
                      	
  CB6B                	AT_EDRDC:
  CB6B  CD6CCD        		CALL	AT_EADR+AT_RE
  CB6E                	AT_EDRDC1:
  CB6E  EDA2          		INI
  CB70  04            		INC	B
  CB71  EDA2          		INI
  CB73  04            		INC	B
  CB74  EDA2          		INI
  CB76  04            		INC	B
  CB77  EDA2          		INI
  CB79  04            		INC	B
  CB7A  3D            		DEC	A
  CB7B  20F1          		JR	NZ,AT_EDRDC1
  CB7D  AF            		XOR	A
  CB7E  C9            		RET
                      	
  CB7F                	AT_EADR:
  CB7F  D5            		PUSH	DE
  CB80  EB            		EX	DE,HL
  CB81  29            		ADD	HL,HL
  CB82  29            		ADD	HL,HL
  CB83  ED4BA0EC      		LD	BC,(_MAXCYL-1)
  CB87  0E00          		LD	C,0
  CB89  09            		ADD	HL,BC
  CB8A  060D          		LD	B,00DH
  CB8C  ED49          		OUT	(C),C
  CB8E  0C            		INC	C
  CB8F  ED69          		OUT	(C),L
  CB91  0C            		INC	C
  CB92  ED61          		OUT	(C),H
  CB94  0C            		INC	C
  CB95  EB            		EX	DE,HL
  CB96  D1            		POP	DE
  CB97  13            		INC	DE
  CB98  AF            		XOR	A
  CB99  C9            		RET
                      	
  CB9A                	AT_EMME:
                      	
  CB9A                	INITE:
  CB9A                		DS	0CC06H-INITE
                      	
  CC06                	BDOS:
  CC06  C3C3D3        		JP	BDOS0
  CC09                		DS	16	;Reserved
                      	
                      	;LDIO2.ASM
                      	
                      	;	LSX-Dodgers IO2
                      	
  CC19                	_SYS03:		;(BDOS)外部入力
  CC19  F3            		DI
  CC1A  C5            		PUSH	BC
  CC1B  01911F        	SIOAD:	LD	BC,01F91H
  CC1E  3E05          		LD	A,5
  CC20  ED79          		OUT	(C),A
  CC22  3EEA          		LD	A,0EAH		;RTS ON
  CC24  ED79          		OUT	(C),A
  CC26                	REC1:
  CC26  CD3DCC        		CALL	BREAK2
  CC29  ED78          		IN	A,(C)
  CC2B  0F            		RRCA			;Arrival
  CC2C  30F8          		JR	NC,REC1
  CC2E                	BREAK2X:
  CC2E  3F            		CCF
  CC2F  3E05          		LD	A,5
  CC31  ED79          		OUT	(C),A
  CC33  3EE8          		LD	A,0E8H		;RTS OFF
  CC35  ED79          		OUT	(C),A
                      	
  CC37  0D            		DEC	C
  CC38  ED78          		IN	A,(C)		;Read data
  CC3A  C1            		POP	BC
  CC3B  FB            		EI
  CC3C  C9            		RET
                      	
  CC3D                	BREAK2:
  CC3D  3E1A          		LD	A,01AH
  CC3F  DB01          		IN	A,(1)
  CC41  0F            		RRCA
  CC42  D8            		RET	C
  CC43  C1            		POP	BC		;PC
  CC44  01911F        	SIOAD0:	LD	BC,01F91H
  CC47  18E5          		JR	BREAK2X
                      	
  CC49                	_SYS04:		;(BDOS)外部出力
  CC49  C5            		PUSH	BC
  CC4A  01911F        	SIOAD1:	LD	BC,01F91H
  CC4D                	XMIT1:
  CC4D  CD3DCC        		CALL	BREAK2
  CC50  3E10          		LD	A,010H		;Reset status
  CC52  ED79          		OUT	(C),A
  CC54  ED78          		IN	A,(C)
  CC56  2F            		CPL
  CC57  E624          		AND	024H		;CTS Send Empty
  CC59  20F2          		JR	NZ,XMIT1
  CC5B  0D            		DEC	C
  CC5C  ED59          		OUT	(C),E
  CC5E  C1            		POP	BC
  CC5F  C9            		RET
                      	
  CC60                	_SYS05:		;(BDOS)プリンタ出力
  CC60  C5            		PUSH	BC
  CC61  01011A        		LD	BC,01A01H
  CC64                	_S05X1:
  CC64  CD3DCC        		CALL	BREAK2
  CC67  ED78          		IN	A,(C)
  CC69  E608          		AND	8
  CC6B  20F7          		JR	NZ,_S05X1
  CC6D  F3            		DI
  CC6E  0D            		DEC	C
  CC6F  ED59          		OUT	(C),E
  CC71  0E03          		LD	C,3
  CC73  3E0E          		LD	A,00EH
  CC75  ED79          		OUT	(C),A
  CC77  3C            		INC	A
  CC78  03            		INC	BC
  CC79  0B            		DEC	BC
  CC7A  ED79          		OUT	(C),A
  CC7C  FB            		EI
  CC7D  C1            		POP	BC
  CC7E  AF            		XOR	A
  CC7F  C9            		RET
                      	
                      	
                      	;LDDISK2.ASM
                      	
                      	;	LSX-Dodgers DISK2
                      	
                      	
                      	;	GRAPHIC RAM DISK DRIVER
                      	
                      	
  CC80                	GDRDC:
  CC80  CDA9CC        		CALL	GADR
  CC83  D5            		PUSH	DE
  CC84  110004        		LD	DE,0400H
  CC87                	GDRDC1:
  CC87  EDA2          		INI
  CC89  04            		INC	B
  CC8A  03            		INC	BC
  CC8B  1D            		DEC	E
  CC8C  20F9          		JR	NZ,GDRDC1
  CC8E  15            		DEC	D
  CC8F  20F6          		JR	NZ,GDRDC1
  CC91                	GDWTC2:
  CC91  D1            		POP	DE
  CC92  E6EF          		AND	0EFH		;BANK0
  CC94  1821          		JR	S1FD0
                      	
  CC96                	GDWTC:
  CC96  CDA9CC        		CALL	GADR
  CC99  D5            		PUSH	DE
  CC9A  110004        		LD	DE,0400H
  CC9D                	GDWTC1:
  CC9D  04            		INC	B
  CC9E  EDA3          		OUTI
  CCA0  03            		INC	BC
  CCA1  1D            		DEC	E
  CCA2  20F9          		JR	NZ,GDWTC1
  CCA4  15            		DEC	D
  CCA5  20F6          		JR	NZ,GDWTC1
  CCA7  18E8          		JR	GDWTC2
                      	
  CCA9                	GADR:
  CCA9  0E00          		LD	C,0
  CCAB  7B            		LD	A,E
  CCAC  87            		ADD	A,A
  CCAD  87            		ADD	A,A
  CCAE  C640          		ADD	A,040H
  CCB0  47            		LD	B,A
  CCB1  13            		INC	DE
  CCB2  3ABFEC        		LD	A,(WK1FD0)
  CCB5  F610          		OR	010H		;BANK1
  CCB7                	S1FD0:
  CCB7  C5            		PUSH	BC
  CCB8  32BFEC        		LD	(WK1FD0),A
  CCBB  01D01F        		LD	BC,01FD0H
  CCBE  ED79          		OUT	(C),A
  CCC0  C1            		POP	BC
  CCC1  C9            		RET
                      	
                      	
                      	;	BANK RAM DISK DRIVER
                      	
                      	
  CCC2                	BDRDC:
  CCC2  ED73E1CC      		LD	(BANKSP+1),SP
  CCC6  3AE2CC        		LD	A,(BANKSP+2)
  CCC9  87            		ADD	A,A
  CCCA  3803          		JR	C,BDRDC1
  CCCC  31D4FF        		LD	SP,EXTSP
  CCCF                	BDRDC1:
  CCCF  D5            		PUSH	DE
  CCD0  D9            		EXX
  CCD1  C5            		 PUSH	 BC
  CCD2  D5            		 PUSH	 DE
  CCD3  CD07CD        		 CALL	 BADR
  CCD6  CD24CD        		CALL	BTFR
  CCD9  D9            		EXX
  CCDA                	BDWTCE:
  CCDA  D1            		 POP	 DE
  CCDB  C1            		 POP	 BC
  CCDC  D9            		 EXX
  CCDD  D1            		POP	DE
  CCDE  13            		INC	DE
  CCDF  FB            		EI
  CCE0  310000        	BANKSP:	LD	SP,0
  CCE3  AF            		XOR	A
  CCE4  C9            		RET
                      	
  CCE5                	BDWTC:
  CCE5  ED73E1CC      		LD	(BANKSP+1),SP
  CCE9  3AE2CC        		LD	A,(BANKSP+2)
  CCEC  87            		ADD	A,A
  CCED  3803          		JR	C,BDWTC1
  CCEF  31D4FF        		LD	SP,EXTSP
  CCF2                	BDWTC1:
  CCF2  D5            		PUSH	DE
  CCF3  D9            		EXX
  CCF4  C5            		 PUSH	 BC
  CCF5  D5            		 PUSH	 DE
  CCF6  CD07CD        		 CALL	 BADR
  CCF9  D9            		EXX
  CCFA  53            		 LD	D,E
  CCFB  5F            		 LD	E,A
  CCFC  D9            		 EXX
  CCFD  EB            		EX	DE,HL
  CCFE  CD24CD        		CALL	BTFR
  CD01  EB            		EX	DE,HL
  CD02  D9            		EXX
  CD03  ED51          		 OUT	 (C),D	 ;MAIN
  CD05  18D3          		 JR	 BDWTCE
                      	
  CD07                	BADR:
  CD07  D9            		 EXX
  CD08  7B            		LD	A,E
  CD09  87            		ADD	A,A
  CD0A  CB12          		RL	D
  CD0C  87            		ADD	A,A
  CD0D  CB12          		RL	D
  CD0F  F5            		PUSH	AF
  CD10  87            		ADD	A,A
  CD11  7A            		LD	A,D
  CD12  8F            		ADC	A,A
  CD13  E60F          		AND	00FH
  CD15  D9            		EXX
  CD16  01000B        		 LD	 BC,00B00H
  CD19  57            		 LD	 D,A	  ;BANK
  CD1A  1E10          		 LD	 E,010H	  ;MAIN
  CD1C  D9            		 EXX
  CD1D  D1            		POP	DE
  CD1E  0600          		LD	B,0
  CD20  58            		LD	E,B
  CD21  CBBA          		RES	7,D
  CD23  C9            		RET
                      	
  CD24                	BTFR:
  CD24  D5            		PUSH	DE
  CD25  F3            		DI
                      	
  CD26                	BTFR1:
  CD26  D9            		EXX
  CD27  ED51          		 OUT	 (C),D	 ;BANK(MAIN)
  CD29  D9            		 EXX
  CD2A  E3            		EX	(SP),HL
  CD2B  7E            		LD	A,(HL)
  CD2C  23            		INC	HL
  CD2D  4E            		LD	C,(HL)
  CD2E  23            		INC	HL
  CD2F  56            		LD	D,(HL)
  CD30  23            		INC	HL
  CD31  5E            		LD	E,(HL)
  CD32  23            		INC	HL
  CD33  E3            		EX	(SP),HL
  CD34  D9            		EXX
  CD35  ED59          		 OUT	 (C),E	 ;MAIN(BANK)
  CD37  D9            		 EXX
  CD38  77            		LD	(HL),A
  CD39  23            		INC	HL
  CD3A  71            		LD	(HL),C
  CD3B  23            		INC	HL
  CD3C  72            		LD	(HL),D
  CD3D  23            		INC	HL
  CD3E  73            		LD	(HL),E
  CD3F  23            		INC	HL
  CD40  10E4          		DJNZ	BTFR1
  CD42  D1            		POP	DE
  CD43  C9            		RET
                      	
                      	
                      	;	EMM DRIVER(DMA)
                      	
                      	
  CD44                	EDWTC:
  CD44  3E11          		LD	A,17
  CD46  01            		DB	1
  CD47                	EDRDC:
  CD47  3E0F          		LD	A,15
  CD49                	EDWTC1:
  CD49  D5            		PUSH	DE
  CD4A  2286CD        		LD	(EDMAD+12),HL
  CD4D  EB            		EX	DE,HL
  CD4E  29            		ADD	HL,HL
  CD4F  29            		ADD	HL,HL
  CD50  ED4BA0EC      		LD	BC,(_MAXCYL-1)
  CD54  0E00          		LD	C,0
  CD56  09            		ADD	HL,BC
  CD57  ED4B84EC      		LD	BC,(_DRIVE)
  CD5B  060D          		LD	B,00DH
  CD5D  ED49          		OUT	(C),C
  CD5F  0C            		INC	C
  CD60  ED69          		OUT	(C),L
  CD62  0C            		INC	C
  CD63  ED61          		OUT	(C),H
                      	
  CD65  217ACD        		LD	HL,EDMAD
  CD68  CDE6EA        		CALL	SETDMA
  CD6B  3EB3          		LD	A,0B3H
  CD6D  ED79          		OUT	(C),A
  CD6F  ED49          		OUT	(C),C		;OUT 01F87H,087H
  CD71  EB            		EX	DE,HL
  CD72  24            		INC	H
  CD73  24            		INC	H
  CD74  24            		INC	H
  CD75  24            		INC	H
  CD76  D1            		POP	DE
  CD77  13            		INC	DE
  CD78  AF            		XOR	A
  CD79  C9            		RET
                      	
  CD7A  C37D030DFF032C	EDMAD:	DB	0C3H,07DH,003H,00DH,0FFH,003H,02CH,050H,002H
  CD83  809AAD0000CF01		DB	080H,09AH,0ADH,000H,000H,0CFH,001H,0CFH
                      	
  CD8B                	EMME:
                      	
  01ED                	AT_RE	EQU	EDWTC-AT_EDWTC
                      	
                      	
                      	;LDCCP.ASM
                      	
                      	;	LSX-Dodgers CCP
                      	
  0040                	PATHX	EQU	64
  CD8B                	PATHD:	DS	PATHX
  CDCB  00            	PATHE:	DB	0
                      	
  CDCC  4F4B24        	OK:	DB	"OK$"
  CDCF  536B697024    	SKIP:	DB	"Skip$"
  CDD4  6B206279746573	KBFREE:	DB	"k bytes free",9,'$'
  CDE2  20202020646972	DIRMES:	DB	"    dir $"
  CDEB  074572726F7221	COMERM:	DB	7,"Error!$"
                      	
  0009                	COMS	EQU	9
  CDF3                	COMTB:
  CDF3  44202020      		DB	"D   "	;1
  CDF7  47D0          		DW	C_DIR
  CDF9  44495220      		DB	"DIR "	;2
  CDFD  47D0          		DW	C_DIR
  CDFF  434F5059      		DB	"COPY"	;3
  CE03  3BD2          		DW	C_COPY
  CE05  43442020      		DB	"CD  "	;4
  CE09  3FCF          		DW	C_CD
  CE0B  44454C20      		DB	"DEL "	;5
  CE0F  2AD0          		DW	C_DEL
  CE11  50415448      		DB	"PATH"	;6
  CE15  F4D0          		DW	C_PATH
  CE17  52454E20      		DB	"REN "	;7
  CE1B  34D0          		DW	C_REN
  CE1D  54595045      		DB	"TYPE"	;8
  CE21  5ED3          		DW	C_TYPE
  CE23  52454D20      		DB	"REM "	;9
  CE27  28D0          		DW	C_REM
                      	
  CE29                	WBOOT1:
  CE29  F3            		DI
  CE2A  310000        		LD	SP,STACK
                      	
  CE2D  3EEC          		LD	A,INTVEC/256
  CE2F  ED47          		LD	I,A
                      	
  CE31  3EE4          		LD	A,0E4H
  CE33  CD1BDB        		CALL	COMOUT
  CE36  3EC8          		LD	A,INTVEC
  CE38  CDF5DA        		CALL	OT49SB
                      	
  CE3B  3ABCEC        		LD	A,(CRTCD+12)
  CE3E  B7            		OR	A
  CE3F  200C          		JR	NZ,SETCRT0
  CE41  2130F8        		LD	HL,0-80*LINE
  CE44  22BAEC        		LD	(CRTCD+10),HL
  CE47  21B0FF        		LD	HL,0-80
  CE4A  22BCEC        		LD	(CRTCD+12),HL
  CE4D                	SETCRT0:
  CE4D  21B0EC        		LD	HL,CRTCD
  CE50  AF            		XOR	A
  CE51                	SETCRT2:
  CE51  010018        		LD	BC,01800H
  CE54  ED79          		OUT	(C),A
  CE56  0C            		INC	C
  CE57  04            		INC	B
  CE58  EDA3          		OUTI
  CE5A  3C            		INC	A
  CE5B  FE0C          		CP	12
  CE5D  20F2          		JR	NZ,SETCRT2
  CE5F  0D            		DEC	C
  CE60  ED79          		OUT	(C),A
  CE62  0C            		INC	C
                      	;	OUT	(C),0		;未定義命令ニーモニック
  CE63  ED71          		DB	0EDH,071H
  CE65  0D            		DEC	C
  CE66  3C            		INC	A
  CE67  ED79          		OUT	(C),A
  CE69  0C            		INC	C
                      	;	OUT	(C),0		;未定義命令ニーモニック
  CE6A  ED71          		DB	0EDH,071H
  CE6C  23            		INC	HL
  CE6D  23            		INC	HL
  CE6E  01031B        		LD	BC,01A03H+00100H
  CE71  EDA3          		OUTI
  CE73  01D020        		LD	BC,01FD0H+00100H
  CE76  EDA3          		OUTI
  CE78  CDEAD0        		CALL	LTNL
  CE7B                	COMMAND:
  CE7B  CD33CF        		CALL	SETDTA1
  CE7E  D5            		PUSH	DE
  CE7F  3A87EC        		LD	A,(_DVSW)
  CE82  C641          		ADD	A,'A'
  CE84  5F            		LD	E,A
  CE85  CDCDEC        		CALL	_PRINT
  CE88  1E3E          		LD	E,'>'
  CE8A  CDCDEC        		CALL	_PRINT
  CE8D  D1            		POP	DE		;DE=DTA1
  CE8E  3E50          		LD	A,80
  CE90  12            		LD	(DE),A
  CE91  CD36D8        		CALL	_SYS0A		;(BDOS)文字列入力
  CE94  CDEAD0        		CALL	LTNL
                      	
  CE97  118200        		LD	DE,DTA1+2
  CE9A  CDFDEC        		CALL	_COMANL
  CE9D  30DC          		JR	NC,COMMAND
  CE9F  CDB0D7        		CALL	KEYBC
  CEA2  11EBCD        		LD	DE,COMERM
  CEA5  CDF1D3        		CALL	_SYS09		;(BDOS)文字列出力
  CEA8  C7            		RST	0
                      	
  CEA9                	COMANL:
  CEA9  CDF4DC        		CALL	FILE
  CEAC  D5            		PUSH	DE
  CEAD  11DC00        		LD	DE,FNAME
  CEB0  1A            		LD	A,(DE)
  CEB1  FE20          		CP	020H
  CEB3  2848          		JR	Z,SDVSW
  CEB5  1B            		DEC	DE
  CEB6  1A            		LD	A,(DE)
  CEB7  C6FF          		ADD	A,0FFH
  CEB9  380A          		JR	C,COMB
  CEBB  13            		INC	DE
                      	
  CEBC  21F3CD        		LD	HL,COMTB
  CEBF  3E09          		LD	A,COMS
  CEC1  47            		LD	B,A
  CEC2  CD83DF        		CALL	CPNAME
  CEC5                	COMB:
  CEC5  D1            		POP	DE
  CEC6  D20F00        		JP	NC,JP_HL
  CEC9  EB            		EX	DE,HL
  CECA  22A9CF        		LD	(COMPAT+1),HL
  CECD  2200D0        		LD	(BATPAT+1),HL
  CED0  F5            		PUSH	AF
  CED1  CD51CF        		CALL	CEXE4
  CED4  F1            		POP	AF
  CED5  21DC00        		LD	HL,FNAME
  CED8  116D00        		LD	DE,FCB2+1	;COMMAND NAME
  CEDB  010B00        		LD	BC,11
  CEDE  EDB0          		LDIR
  CEE0  118BCD        		LD	DE,PATHD
  CEE3                	CEX1:
  CEE3  1A            		LD	A,(DE)
  CEE4  FE20          		CP	020H
  CEE6  D8            		RET	C
  CEE7  CDE9DC        		CALL	FILEC
  CEEA  D5            		PUSH	DE
  CEEB  216D00        		LD	HL,FCB2+1	;COMMAND NAME
  CEEE  11DC00        		LD	DE,FNAME
  CEF1  010B00        		LD	BC,11
  CEF4  EDB0          		LDIR
  CEF6  CD51CF        		CALL	CEXE4
  CEF9  D1            		POP	DE
  CEFA  13            		INC	DE
  CEFB  18E6          		JR	CEX1
                      	
  CEFD                	SDVSW:
  CEFD  F1            		POP	AF
  CEFE  3ADB00        		LD	A,(FDRV)
  CF01  3D            		DEC	A
  CF02  5F            		LD	E,A
  CF03  0E0E          		LD	C,00EH		;(BDOS)カレント・ドライブの設定
  CF05  1833          		JR	SYSTEM0
                      	
  CF07                	OPEN1:
  CF07  21DB00        		LD	HL,FDRV
  CF0A                	OPEN:
  CF0A  0E11          		LD	C,011H		;(BDOS)最初のファイルの検索
  CF0C                	OPEN3:
  CF0C  D5            		PUSH	DE
  CF0D  1151FF        		LD	DE,DTA
  CF10  CD30CF        		CALL	SETDTA
  CF13  EB            		EX	DE,HL
  CF14  CD0500        		CALL	SYSTEM
  CF17  D1            		POP	DE
  CF18  B7            		OR	A
  CF19  C9            		RET
                      	
  CF1A                	OPEN2:
  CF1A  0E12          		LD	C,012H
  CF1C  18EE          		JR	OPEN3
                      	
  CF1E                	DEFCB:				;Z=Ok NZ=Error
  CF1E  1151FF        		LD	DE,DTA
  CF21  CD38CF        		CALL	SYSC0F
                      	
  CF24  210000        		LD	HL,0
  CF27  2272FF        		LD	(DTA+33),HL
  CF2A  2274FF        		LD	(DTA+35),HL
  CF2D  110001        		LD	DE,00100H
  CF30                	SETDTA:
  CF30  C30AD6        		JP	_SYS1A		;(BDOS)DTAの設定
                      	
  CF33                	SETDTA1:
  CF33  118000        		LD	DE,DTA1
  CF36  18F8          		JR	SETDTA
                      	
  CF38                	SYSC0F:
  CF38  0E0F          		LD	C,00FH		;(BDOS)ファイルのオープン
  CF3A                	SYSTEM0:
  CF3A  CD0500        		CALL	SYSTEM
  CF3D  B7            		OR	A
  CF3E  C9            		RET
                      	
  CF3F                	C_CD:
  CF3F  CDE9DC        		CALL	FILEC
  CF42  210000        		LD	HL,0
  CF45  11DB00        		LD	DE,FDRV
  CF48  1803          		JR	S27
                      	
  CF4A                	S27DTA:
  CF4A  1151FF        		LD	DE,DTA
  CF4D                	S27:
  CF4D  0E27          		LD	C,027H		;(BDOS)ランダム・ブロック・リード
  CF4F  18E9          		JR	SYSTEM0
                      	
  CF51                	CEXE4:
  CF51  3ADB00        		LD	A,(FDRV)
  CF54  325700        		LD	(00057H),A
  CF57  2AE900        		LD	HL,(FDRV+14)
  CF5A  225800        		LD	(00058H),HL
                      	
  CF5D  21E400        		LD	HL,FNAME+8
  CF60  7E            		LD	A,(HL)
  CF61  FE20          		CP	020H
  CF63  2007          		JR	NZ,CEXE7
  CF65  3E3F          		LD	A,'?'
  CF67  77            		LD	(HL),A
  CF68  23            		INC	HL
  CF69  77            		LD	(HL),A
  CF6A  23            		INC	HL
  CF6B  77            		LD	(HL),A
  CF6C                	CEXE7:
  CF6C  CD07CF        		CALL	OPEN1
  CF6F                	CEXE5:
  CF6F  C0            		RET	NZ
  CF70  2A5BFF        		LD	HL,(DTA+1+9)
  CF73  7C            		LD	A,H
  CF74  CDE7DF        		CALL	CAP
  CF77  67            		LD	H,A
  CF78  7D            		LD	A,L
  CF79  CDE7DF        		CALL	CAP
  CF7C  6F            		LD	L,A
  CF7D  3A5AFF        		LD	A,(DTA+1+8)
  CF80  CDE7DF        		CALL	CAP
  CF83  D642          		SUB	'B'
  CF85  282E          		JR	Z,C_BAT
  CF87  3D            		DEC	A		;'C'
  CF88  2805          		JR	Z,C_EXE
  CF8A                	CEXE6:
  CF8A  CD1ACF        		CALL	OPEN2
  CF8D  18E0          		JR	CEXE5
                      	
  CF8F                	C_EXE:
  CF8F  7C            		LD	A,H
  CF90  FE4D          		CP	'M'
  CF92  20F6          		JR	NZ,CEXE6
                      	
  CF94  CD1ECF        		CALL	DEFCB
  CF97  2A0600        		LD	HL,(SYSTEM+1)
  CF9A  25            		DEC	H
  CF9B  CD4ACF        		CALL	S27DTA
  CF9E  3D            		DEC	A
  CF9F  37            		SCF
  CFA0  C0            		RET	NZ
  CFA1  7C            		LD	A,H
  CFA2  B5            		OR	L
  CFA3  37            		SCF
  CFA4  C8            		RET	Z
  CFA5  CD33CF        		CALL	SETDTA1
  CFA8  110000        	COMPAT:	LD	DE,0
  CFAB  CDFAD1        		CALL	SETFCB
  CFAE  AF            		XOR	A
  CFAF  67            		LD	H,A
  CFB0  6F            		LD	L,A	;HL=0x0000
  CFB1  F9            		LD	SP,HL	;STACK=0
  CFB2  E5            		PUSH	HL
  CFB3  24            		INC	H	;HL=0x0100
  CFB4  E9            		JP	(HL)
                      	
  CFB5                	C_BAT:
  CFB5  114154        		LD	DE,'A'+'T'*256
  CFB8  ED52          		SBC	HL,DE
  CFBA  20CE          		JR	NZ,CEXE6
                      	
  CFBC  F1            		POP	AF
  CFBD  F1            		POP	AF
  CFBE  CD1ECF        		CALL	DEFCB
  CFC1  210002        		LD	HL,00200H
  CFC4  CD4ACF        		CALL	S27DTA
  CFC7  C6FE          		ADD	A,0FEH
  CFC9  D8            		RET	C
  CFCA  7D            		LD	A,L
  CFCB  B7            		OR	A
  CFCC  37            		SCF
  CFCD  C8            		RET	Z
  CFCE  3C            		INC	A
  CFCF  F5            		PUSH	AF
                      	
  CFD0  CDB0D7        		CALL	KEYBC
  CFD3  1E1A          		LD	E,01AH
  CFD5  CDCDEC        		CALL	_PRINT
  CFD8  C1            		POP	BC
  CFD9  210001        		LD	HL,00100H
  CFDC                	BAT1:
  CFDC  A7            		AND	A
  CFDD  05            		DEC	B
  CFDE  C8            		RET	Z
  CFDF  7E            		LD	A,(HL)
  CFE0  FE25          		CP	'%'
  CFE2  280C          		JR	Z,BAT2
  CFE4                	BAT1X:
  CFE4  7E            		LD	A,(HL)
  CFE5  23            		INC	HL
  CFE6  FE1A          		CP	01AH
  CFE8  C8            		RET	Z
  CFE9  FE0A          		CP	00AH
  CFEB  C496D7        		CALL	NZ,KEYBS
  CFEE  18EC          		JR	BAT1
                      	
  CFF0                	BAT2:
  CFF0  23            		INC	HL
  CFF1  7E            		LD	A,(HL)
  CFF2  2B            		DEC	HL
  CFF3  D631          		SUB	'1'
  CFF5  38ED          		JR	C,BAT1X
  CFF7  FE09          		CP	9
  CFF9  30E9          		JR	NC,BAT1X
  CFFB  23            		INC	HL
  CFFC  23            		INC	HL
  CFFD  3C            		INC	A
  CFFE  4F            		LD	C,A
  CFFF  110000        	BATPAT:	LD	DE,0
  D002                	BAT3:
  D002  1A            		LD	A,(DE)
  D003  B7            		OR	A
  D004  28D6          		JR	Z,BAT1
  D006  CDCEDD        		CALL	SPCUT
  D009  0D            		DEC	C
  D00A  2808          		JR	Z,BAT5
  D00C                	BAT4:
  D00C  1A            		LD	A,(DE)
  D00D  FE21          		CP	021H
  D00F  38F1          		JR	C,BAT3
  D011  13            		INC	DE
  D012  18F8          		JR	BAT4
  D014                	BAT5:
  D014  1A            		LD	A,(DE)
  D015  FE21          		CP	021H
  D017  38C3          		JR	C,BAT1
  D019  13            		INC	DE
  D01A  CD96D7        		CALL	KEYBS
  D01D  18F5          		JR	BAT5
                      	
  D01F                	SWITCH:
  D01F  1A            		LD	A,(DE)
  D020                	SW1:
  D020  13            		INC	DE
  D021  B9            		CP	C
  D022  1A            		LD	A,(DE)
  D023  C8            		RET	Z
  D024  FE20          		CP	020H
  D026  30F8          		JR	NC,SW1
  D028                	C_REM:
  D028  AF            		XOR	A
  D029  C9            		RET
                      	
  D02A                	C_DEL:
  D02A  CDFAD1        		CALL	SETFCB
  D02D  CDFDD7        		CALL	_SYS08		;(BDOS)エコーなしコンソール入力
                      	
  D030  0E13          		LD	C,013H
  D032  180A          		JR	CDEL1
                      	
  D034                	C_REN:
  D034  CDFAD1        		CALL	SETFCB
  D037  3E10          		LD	A,010H		;ディレクトリも対象にする
  D039  326900        		LD	(FCB1+13),A	;属性
  D03C  0E17          		LD	C,017H		;(BDOS)ファイル名の変更
  D03E                	CDEL1:
  D03E  115C00        		LD	DE,FCB1
  D041  CD0500        		CALL	SYSTEM
  D044  C6FF          		ADD	A,0FFH
  D046  C9            		RET
                      	
  D047                	C_DIR:
  D047  CDE9DC        		CALL	FILEC
  D04A  21DC00        		LD	HL,FDRV+1
  D04D  CD9AD3        		CALL	CWILD1
  D050  3EF1          		LD	A,0F1H
  D052  32E800        		LD	(FDRV+13),A
  D055  CD07CF        		CALL	OPEN1
  D058                	CDIR1:
  D058  B7            		OR	A
  D059  2008          		JR	NZ,PDSKF
  D05B  CDA3D0        		CALL	P_NAME
  D05E  CD1ACF        		CALL	OPEN2
  D061  18F5          		JR	CDIR1
                      	
  D063                	PDSKF:
  D063  3ADB00        		LD	A,(FDRV)
  D066  5F            		LD	E,A
  D067  0E1B          		LD	C,01BH		;(BDOS)ディスク情報の獲得
  D069  CD0500        		CALL	SYSTEM
  D06C  4F            		LD	C,A
  D06D  C601          		ADD	A,001H
  D06F  D8            		RET	C
  D070  AF            		XOR	A
  D071                	PDS1:
  D071  CB19          		RR	C
  D073  2804          		JR	Z,PDS2
  D075  29            		ADD	HL,HL
  D076  8F            		ADC	A,A
  D077  18F8          		JR	PDS1
  D079                	PDS2:
  D079  CB50          		BIT	2,B
  D07B  2006          		JR	NZ,PDSKF1
  D07D  CB3F          		SRL	A
  D07F  CB1C          		RR	H
  D081  CB1D          		RR	L
  D083                	PDSKF1:
  D083  CD26D1        		CALL	PRDEC
  D086  11D4CD        		LD	DE,KBFREE
  D089  CDF1D3        		CALL	_SYS09		;(BDOS)文字列出力
  D08C  CD18D1        		CALL	PUTDRV
  D08F  3E5C          		LD	A,05CH
  D091  CDE7D7        		CALL	MSG_
  D094  2AE900        		LD	HL,(FDRV+14)
  D097  7C            		LD	A,H
  D098  B5            		OR	L
  D099  284F          		JR	Z,LTNL
  D09B  2B            		DEC	HL
  D09C  7C            		LD	A,H
  D09D  B5            		OR	L
  D09E  C425D1        		CALL	NZ,PRDEC0
  D0A1  1847          		JR	LTNL
                      	
  D0A3                	P_NAME:
  D0A3  3A52FF        		LD	A,(DTA+1)
  D0A6  FE2E          		CP	'.'
  D0A8  C8            		RET	Z
  D0A9  3E20          		LD	A,020H
  D0AB  CDE7D7        		CALL	MSG_
  D0AE  CDE7D7        		CALL	MSG_
  D0B1  3E3A          		LD	A,':'
  D0B3  CDE7D7        		CALL	MSG_
  D0B6  3A5DFF        		LD	A,(DTA+1+00BH)
  D0B9  F5            		PUSH	AF
  D0BA  0F            		RRCA
  D0BB  9F            		SBC	A,A
  D0BC  E60A          		AND	'*'-020H
  D0BE  C620          		ADD	A,020H
  D0C0  CDE7D7        		CALL	MSG_
  D0C3  CD18D1        		CALL	PUTDRV
  D0C6  2152FF        		LD	HL,DTA+1
  D0C9  CD67D1        		CALL	FPRNT
                      	
  D0CC  F1            		POP	AF
  D0CD  CB67          		BIT	4,A
  D0CF  2808          		JR	Z,DIR3
  D0D1  11E2CD        		LD	DE,DIRMES
  D0D4  CDF1D3        		CALL	_SYS09		;(BDOS)文字列出力
  D0D7  1809          		JR	DIR6
  D0D9                	DIR3:
  D0D9  3A70FF        		LD	A,(DTA+1+01EH)
  D0DC  2A6EFF        		LD	HL,(DTA+1+01CH)
  D0DF  CD26D1        		CALL	PRDEC
  D0E2                	DIR6:
  D0E2  3AB1EC        		LD	A,(CRTCD+1)
  D0E5  FE29          		CP	40+1
  D0E7  D489D1        		CALL	NC,PRTTMS
                      	
  D0EA                	LTNL:
  D0EA  1E0D          		LD	E,00DH
  D0EC  CDFAD7        		CALL	PRINTX
  D0EF  1E0A          		LD	E,00AH
  D0F1  C3FAD7        		JP	PRINTX
                      	
  D0F4                	C_PATH:
  D0F4  CDCEDD        		CALL	SPCUT
  D0F7  218BCD        		LD	HL,PATHD
  D0FA  FE21          		CP	021H
  D0FC  300E          		JR	NC,CPATH0
  D0FE  2B            		DEC	HL
  D0FF  2B            		DEC	HL
  D100                	CPATHP:
  D100  7E            		LD	A,(HL)
  D101  23            		INC	HL
  D102  FE20          		CP	020H
  D104  3F            		CCF
  D105  30E3          		JR	NC,LTNL
  D107  CDE7D7        		CALL	MSG_
  D10A  18F4          		JR	CPATHP
  D10C                	CPATH0:
  D10C  FE3B          		CP	';'
  D10E  2001          		JR	NZ,CPATH1
  D110  13            		INC	DE
  D111                	CPATH1:
  D111  EB            		EX	DE,HL
  D112  014000        		LD	BC,PATHX
  D115  EDB0          		LDIR
  D117  C9            		RET
                      	
  D118                	PUTDRV:
  D118  3ADB00        		LD	A,(FDRV)
  D11B  C640          		ADD	A,'A'-1
  D11D  CDE7D7        		CALL	MSG_
  D120  3E3A          		LD	A,':'
  D122                	MSGR:
  D122  C3E7D7        		JP	MSG_
                      	
  D125                	PRDEC0:
  D125  AF            		XOR	A
  D126                	PRDEC:
  D126  5F            		LD	E,A
  D127  010000        		LD	BC,0
  D12A  ED43D600      		LD	(DECBF),BC
  D12E  ED43D800      		LD	(DECBF+2),BC
                      	
  D132  0E18          		LD	C,24
  D134                	DEC1:
  D134  29            		ADD	HL,HL
  D135  7B            		LD	A,E
  D136  8F            		ADC	A,A
  D137  5F            		LD	E,A
  D138  E5            		PUSH	HL
  D139  21D900        		LD	HL,DECBF+3
  D13C  0604          		LD	B,4
  D13E                	DEC2:
  D13E  7E            		LD	A,(HL)
  D13F  8F            		ADC	A,A
  D140  27            		DAA
  D141  77            		LD	(HL),A
  D142  2B            		DEC	HL
  D143  10F9          		DJNZ	DEC2
  D145  E1            		POP	HL
  D146  0D            		DEC	C
  D147  20EB          		JR	NZ,DEC1
                      	
  D149  21D600        		LD	HL,DECBF
  D14C  3E20          		LD	A,020H
  D14E  0603          		LD	B,3
  D150                	DEC3:
  D150  CD5DD1        		CALL	DEC4
  D153  CD5DD1        		CALL	DEC4
  D156  23            		INC	HL
  D157  10F7          		DJNZ	DEC3
  D159                	DECX:
  D159  CD5DD1        		CALL	DEC4
  D15C  AF            		XOR	A
  D15D                	DEC4:
  D15D  ED6F          		RLD
  D15F  FE20          		CP	020H
  D161  2802          		JR	Z,DEC5
  D163  F630          		OR	030H
  D165                	DEC5:
  D165  18BB          		JR	MSGR
                      	
  D167                	FPRNT:
  D167  0608          		LD	B,8
  D169  CD7AD1        		CALL	P_N1
  D16C  7E            		LD	A,(HL)
  D16D  C680          		ADD	A,0A0H-020H
  D16F  FEA0          		CP	0A0H
  D171  2802          		JR	Z,FPR1
  D173  3E2E          		LD	A,'.'
  D175                	FPR1:
  D175  CDE7D7        		CALL	MSG_
  D178  0603          		LD	B,3
                      	
  D17A                	P_N1:
  D17A  C5            		PUSH	BC
  D17B  E5            		PUSH	HL
  D17C  7E            		LD	A,(HL)
  D17D  CDF3DF        		CALL	CAP3
  D180  CDE7D7        		CALL	MSG_
  D183  E1            		POP	HL
  D184  C1            		POP	BC
  D185  23            		INC	HL
  D186  10F2          		DJNZ	P_N1
  D188  C9            		RET
                      	
  D189                	PRTTMS:
  D189  3E20          		LD	A,020H
  D18B  CDE7D7        		CALL	MSG_
                      	
  D18E  2A6AFF        		LD	HL,(DTA+1+24)
  D191  7D            		LD	A,L
  D192  B7            		OR	A
  D193  C8            		RET	Z
  D194  CB3C          		SRL	H
  D196  17            		RLA
  D197  17            		RLA
  D198  17            		RLA
  D199  17            		RLA
  D19A  E60F          		AND	00FH
  D19C  57            		LD	D,A
  D19D  7C            		LD	A,H
  D19E  C650          		ADD	A,80
  D1A0  CDE5D1        		CALL	PRTA
  D1A3  3E2D          		LD	A,'-'
  D1A5  CDE7D7        		CALL	MSG_
  D1A8  7A            		LD	A,D
  D1A9  CDE5D1        		CALL	PRTA
  D1AC  3E2D          		LD	A,'-'
  D1AE  CDE7D7        		CALL	MSG_
  D1B1  7D            		LD	A,L
  D1B2  E61F          		AND	01FH
  D1B4  CDE5D1        		CALL	PRTA
                      	
  D1B7  2A68FF        		LD	HL,(DTA+1+22)
                      	
  D1BA  3E20          		LD	A,020H
  D1BC  CDE7D7        		CALL	MSG_
  D1BF  7C            		LD	A,H
  D1C0  65            		LD	H,L
  D1C1  1F            		RRA
  D1C2  CB1D          		RR	L
  D1C4  1F            		RRA
  D1C5  CB1D          		RR	L
  D1C7  1F            		RRA
  D1C8  CB1D          		RR	L
  D1CA  E61F          		AND	01FH
  D1CC  CDE5D1        		CALL	PRTA
  D1CF  3E3A          		LD	A,':'
  D1D1  CDE7D7        		CALL	MSG_
  D1D4  7D            		LD	A,L
  D1D5  0F            		RRCA
  D1D6  0F            		RRCA
  D1D7  E63F          		AND	03FH
  D1D9  CDE5D1        		CALL	PRTA
  D1DC  3E3A          		LD	A,':'
  D1DE  CDE7D7        		CALL	MSG_
  D1E1  7C            		LD	A,H
  D1E2  E61F          		AND	01FH
  D1E4  87            		ADD	A,A
                      	
                      	;	PRINT10
                      	
  D1E5                	PRTA:
  D1E5  E5            		PUSH	HL
  D1E6  0608          		LD	B,8
  D1E8  4F            		LD	C,A
  D1E9  AF            		XOR	A
  D1EA                	PRTA1:
  D1EA  CB01          		RLC	C
  D1EC  8F            		ADC	A,A
  D1ED  27            		DAA
  D1EE  10FA          		DJNZ	PRTA1
  D1F0  21D600        		LD	HL,DECBF
  D1F3  77            		LD	(HL),A
  D1F4  AF            		XOR	A
  D1F5  CD59D1        		CALL	DECX
  D1F8  E1            		POP	HL
  D1F9  C9            		RET
                      	
  D1FA                	SETFCB:
  D1FA  CDCEDD        		CALL	SPCUT
  D1FD  1A            		LD	A,(DE)
  D1FE  FE20          		CP	020H
  D200  3801          		JR	C,SETFCBA
  D202  1B            		DEC	DE
  D203                	SETFCBA:
  D203  D5            		PUSH	DE
  D204  215C00        		LD	HL,FCB1
  D207  115D00        		LD	DE,FCB1+1
  D20A  012300        		LD	BC,00023H
  D20D  70            		LD	(HL),B		;B=0
  D20E  EDB0          		LDIR
  D210  D1            		POP	DE
  D211  D5            		PUSH	DE
  D212  215C00        		LD	HL,FCB1
  D215  CD68D6        		CALL	_SYS29		;(BDOS)ファイル名の解析
  D218  216C00        		LD	HL,FCB2
  D21B  CD68D6        		CALL	_SYS29		;(BDOS)ファイル名の解析
  D21E  E1            		POP	HL
  D21F  010050        		LD	BC,05000H
  D222  118100        		LD	DE,00081H
  D225                	SETFCB1:
  D225  7E            		LD	A,(HL)
  D226  23            		INC	HL
  D227  FE20          		CP	020H
  D229  3805          		JR	C,SETFCB2
  D22B  12            		LD	(DE),A
  D22C  13            		INC	DE
  D22D  0C            		INC	C
  D22E  10F5          		DJNZ	SETFCB1
  D230                	SETFCB2:
  D230  79            		LD	A,C
  D231  328000        		LD	(DTA1),A
  D234  04            		INC	B
  D235  AF            		XOR	A
  D236                	SETFCB3:
  D236  12            		LD	(DE),A
  D237  13            		INC	DE
  D238  10FC          		DJNZ	SETFCB3
  D23A  C9            		RET
                      	
  D23B                	C_COPY:
  D23B  CDFAD1        		CALL	SETFCB
  D23E  118100        		LD	DE,DTA1+1
  D241  0E2F          		LD	C,'/'
  D243  CD1FD0        		CALL	SWITCH
  D246  CDE7DF        		CALL	CAP
  D249  32D1D2        		LD	(SW+1),A
                      	
  D24C  11E4EB        		LD	DE,BEEPD
  D24F  CDECDC        		CALL	FILEC2
  D252  216C00        		LD	HL,FCB2
  D255  CD6FD6        		CALL	S29X1
                      	
  D258  3E10          		LD	A,010H
  D25A  326900        		LD	(FCB1+13),A
  D25D  216D00        		LD	HL,FCB2+1
  D260  CD9AD3        		CALL	CWILD1
  D263                	COPY0:
  D263  CD97D3        		CALL	CWILD
  D266  215C00        		LD	HL,FCB1
  D269  CD0ACF        		CALL	OPEN
  D26C  37            		SCF
  D26D                	COPY1:
  D26D  C0            		RET	NZ
  D26E  CD1ECF        		CALL	DEFCB
                      	
  D271  3A5EFF        		LD	A,(DTA+13)
  D274  CB67          		BIT	4,A
  D276  2824          		JR	Z,COPY1A
                      	
  D278  215D00        		LD	HL,FCB1+1
  D27B  CD10E1        		CALL	CHKWILD
  D27E  3817          		JR	C,COPY9
                      	
  D280  3E20          		LD	A,020H
  D282  325D00        		LD	(FCB1+1),A
  D285  2A6BFF        		LD	HL,(DTA+26)
  D288  23            		INC	HL
  D289  226A00        		LD	(FCB1+14),HL
  D28C  18D5          		JR	COPY0
                      	
  D28E                	COPYS:
  D28E  11CFCD        		LD	DE,SKIP
  D291                	COPY8:
  D291  CDF1D3        		CALL	_SYS09		;(BDOS)文字列出力
  D294  CDEAD0        		CALL	LTNL
  D297                	COPY9:
  D297  CD1ACF        		CALL	OPEN2
  D29A  18D1          		JR	COPY1
                      	
  D29C                	COPY1A:
  D29C  216C00        		LD	HL,FCB2
  D29F  11DB00        		LD	DE,FDRV
  D2A2  0153FF        		LD	BC,DTA+2
  D2A5  EDA0          		LDI
  D2A7  3E0B          		LD	A,11
  D2A9                	COPY2:
  D2A9  F5            		PUSH	AF
  D2AA  7E            		LD	A,(HL)
  D2AB  FE3F          		CP	'?'
  D2AD  2001          		JR	NZ,COPY3
  D2AF  0A            		LD	A,(BC)
  D2B0                	COPY3:
  D2B0  12            		LD	(DE),A
  D2B1  03            		INC	BC
  D2B2  13            		INC	DE
  D2B3  23            		INC	HL
  D2B4  F1            		POP	AF
  D2B5  3D            		DEC	A
  D2B6  20F1          		JR	NZ,COPY2
  D2B8  010500        		LD	BC,16-11
  D2BB  EDB0          		LDIR
  D2BD                	PUTNAME:
  D2BD  215D00        		LD	HL,FCB1+1
  D2C0  CD10E1        		CALL	CHKWILD
  D2C3  300B          		JR	NC,PUTN1
  D2C5  21DC00        		LD	HL,FDRV+1
  D2C8  CD67D1        		CALL	FPRNT
  D2CB  3E20          		LD	A,020H
  D2CD  CDE7D7        		CALL	MSG_
  D2D0                	PUTN1:
  D2D0  3E00          	SW:	LD	A,000H
  D2D2  FE54          		CP	'T'
  D2D4  2005          		JR	NZ,CSW1
  D2D6  21F0D2        		LD	HL,SWNE
  D2D9  1807          		JR	SWT1
  D2DB                	CSW1:
  D2DB  FE4E          		CP	'N'
  D2DD  2011          		JR	NZ,SWNE
  D2DF  218ED2        		LD	HL,COPYS
  D2E2                	SWT1:
  D2E2  11DB00        		LD	DE,FDRV
  D2E5  CD38CF        		CALL	SYSC0F
  D2E8  2801          		JR	Z,SWN1
  D2EA  E9            		JP	(HL)
  D2EB                	SWN1:
  D2EB  CD49D3        		CALL	CTIME
  D2EE  309E          		JR	NC,COPYS
  D2F0                	SWNE:
  D2F0  11DB00        		LD	DE,FDRV
  D2F3  0E16          		LD	C,016H		;(BDOS)ファイルの作成
  D2F5  CD3ACF        		CALL	SYSTEM0
  D2F8  204D          		JR	NZ,COPYE2
  D2FA  67            		LD	H,A		;A=0
  D2FB  6F            		LD	L,A
  D2FC  22FC00        		LD	(FDRV+33),HL
  D2FF  22FE00        		LD	(FDRV+35),HL
  D302                	COPY6:
  D302  CDA9D3        		CALL	BUFSIZ
  D305  CD4ACF        		CALL	S27DTA
  D308  47            		LD	B,A
  D309  3C            		INC	A
  D30A  2833          		JR	Z,COPYE
  D30C  7C            		LD	A,H
  D30D  B5            		OR	L
  D30E  280E          		JR	Z,COPY7
  D310  11DB00        		LD	DE,FDRV
  D313  0E26          		LD	C,026H		;(BDOS)ランダム・ブロック・ライト
  D315  CD0500        		CALL	SYSTEM
  D318  B7            		OR	A
  D319  2024          		JR	NZ,COPYE
  D31B  05            		DEC	B
  D31C  20E4          		JR	NZ,COPY6
  D31E                	COPY7:
  D31E  3A5EFF        		LD	A,(DTA+13)
  D321  32E800        		LD	(FDRV+13),A
  D324  2165FF        		LD	HL,DTA+20
  D327  11EF00        		LD	DE,FDRV+20
  D32A  010400        		LD	BC,4
  D32D  EDB0          		LDIR
                      	
  D32F  11DB00        		LD	DE,FDRV
  D332  0E10          		LD	C,010H		;(BDOS)ファイルのクローズ
  D334  CD3ACF        		CALL	SYSTEM0
  D337  2006          		JR	NZ,COPYE
                      	
  D339  11CCCD        		LD	DE,OK
  D33C  C391D2        		JP	COPY8
                      	
  D33F                	COPYE:
  D33F  11DB00        		LD	DE,FDRV
  D342  0E13          		LD	C,013H		;(BDOS)ファイルの削除
  D344  CD0500        		CALL	SYSTEM
  D347                	COPYE2:
  D347  37            		SCF
  D348  C9            		RET
                      	
  D349                	CTIME:
  D349  ED5B65FF      		LD	DE,(DTA+20)
  D34D  2AEF00        		LD	HL,(FDRV+20)
  D350  A7            		AND	A
  D351  ED52          		SBC	HL,DE
  D353  C0            		RET	NZ
  D354  ED5B67FF      		LD	DE,(DTA+22)
  D358  2AF100        		LD	HL,(FDRV+22)
  D35B  ED52          		SBC	HL,DE
  D35D  C9            		RET
                      	
  D35E                	C_TYPE:
  D35E  CDFAD1        		CALL	SETFCB
  D361  215C00        		LD	HL,FCB1
  D364  CD0ACF        		CALL	OPEN
  D367  37            		SCF
  D368                	TYPE1:
  D368  C0            		RET	NZ
  D369  CD1ECF        		CALL	DEFCB
  D36C  1E1A          		LD	E,01AH
  D36E  CDCDEC        		CALL	_PRINT
  D371                	TYPE2:
  D371  CDA9D3        		CALL	BUFSIZ
  D374  CD4ACF        		CALL	S27DTA
  D377  C6FE          		ADD	A,0FEH
  D379  D8            		RET	C
  D37A  7C            		LD	A,H
  D37B  B5            		OR	L
  D37C  2814          		JR	Z,TYPEE
  D37E  010001        		LD	BC,00100H
  D381                	TYPE3:
  D381  0A            		LD	A,(BC)
  D382  03            		INC	BC
  D383  FE1A          		CP	01AH
  D385  280B          		JR	Z,TYPEE
  D387  5F            		LD	E,A
  D388  CDF0D7        		CALL	_SYS02		;(BDOS)コンソール出力
  D38B  2B            		DEC	HL
  D38C  7C            		LD	A,H
  D38D  B5            		OR	L
  D38E  20F1          		JR	NZ,TYPE3
  D390  18DF          		JR	TYPE2
  D392                	TYPEE:
  D392  CD1ACF        		CALL	OPEN2
  D395  18D1          		JR	TYPE1
                      	
  D397                	CWILD:
  D397  215D00        		LD	HL,FCB1+1
  D39A                	CWILD1:
  D39A  7E            		LD	A,(HL)
  D39B  FE20          		CP	020H
  D39D  C0            		RET	NZ
  D39E                	CWILD2:
  D39E  54            		LD	D,H
  D39F  5D            		LD	E,L
  D3A0  13            		INC	DE
  D3A1  010A00        		LD	BC,10
  D3A4  363F          		LD	(HL),'?'
  D3A6  EDB0          		LDIR
  D3A8  C9            		RET
                      	
  D3A9                	BUFSIZ:
  D3A9  3A0700        		LD	A,(SYSTEM+2)
  D3AC  D603          		SUB	3
  D3AE  E6FC          		AND	0FCH
  D3B0  67            		LD	H,A
  D3B1  2E00          		LD	L,0
  D3B3  C9            		RET
                      	
                      	
                      	;LDOS.ASM
                      	
                      	;	LSX-Dodgers OS
                      	
  D3B4                	BOOT:
  D3B4  C30000        		JP	0
  D3B7                	_SYS00:		;(BDOS)プログラム終了
  D3B7                	WBOOT:
  D3B7  C329CE        		JP	WBOOT1
  D3BA                	CONST_:
  D3BA  C36AD8        		JP	CONSTX
  D3BD                	_SYS07:		;(BDOS)コンソール直接入力
  D3BD                	CONIN:
  D3BD  C311D8        		JP	FLGET
  D3C0                	CONOUT:
  D3C0  C3C2DA        		JP	CONOUT1
                      	
  D3C3                	BDOS0:
  D3C3  E5            		PUSH	HL
  D3C4  210001        		LD	HL,00100H
  D3C7  39            		ADD	HL,SP
  D3C8  3810          		JR	C,BDOS1X	;EXTSP = 0FFD4H
  D3CA                	BDOS2:
  D3CA  E1            		POP	HL
  D3CB  ED73D6D3      		LD	(BDSP+1),SP
  D3CF  31D4FF        		LD	SP,EXTSP
  D3D2  CDD9D3        		CALL	BDOS1
  D3D5  310000        	BDSP:	LD	SP,0
  D3D8  C9            		RET
  D3D9                	BDOS1:
  D3D9  E5            		PUSH	HL
  D3DA                	BDOS1X:
  D3DA  79            		LD	A,C
  D3DB  FE31          		CP	031H
  D3DD  300A          		JR	NC,_ERROR
  D3DF  87            		ADD	A,A
  D3E0  6F            		LD	L,A
  D3E1  26EC          		LD	H,STABLE/256
  D3E3  7E            		LD	A,(HL)
  D3E4  2C            		INC	L
  D3E5  66            		LD	H,(HL)
  D3E6  6F            		LD	L,A
  D3E7  E3            		EX	(SP),HL
  D3E8  C9            		RET
                      	
  D3E9                	_ERROR:
  D3E9  013201        		LD	BC,00132H
  D3EC  113001        		LD	DE,VER
  D3EF                	_SYS1C:		;(BDOS)ディスクの書き込み禁止化
  D3EF                	_SYS1E:		;(BDOS)ファイル属性の設定
  D3EF                	_SYS20:		;(BDOS)利用者番号の設定と読み出し
  D3EF                	_SYS2E:		;(BDOS)ベリファイ・フラグの設定
  D3EF  AF            		XOR	A
  D3F0  C9            		RET
                      	
  D3F1                	_SYS09:		;文字列出力
  D3F1  D5            		PUSH	DE
  D3F2                	_SX09:
  D3F2  1A            		LD	A,(DE)
  D3F3  13            		INC	DE
  D3F4  FE24          		CP	'$'
  D3F6  282C          		JR	Z,SX0E2
  D3F8  D5            		PUSH	DE
  D3F9  5F            		LD	E,A
  D3FA  CDF0D7        		CALL	_SYS02
  D3FD  D1            		POP	DE
  D3FE  18F2          		JR	_SX09
                      	
  D400                	_SYS0C:		;(BDOS)バージョン番号の獲得
  D400  212200        		LD	HL,00022H
  D403  AF            		XOR	A
  D404  7D            		LD	A,L
  D405  C9            		RET
                      	
  D406                	_SYS0D:		;(BDOS)ディスク・リセット
  D406  CDDFEC        		CALL	_FFLUSH
  D409  E5            		PUSH	HL
  D40A  218000        		LD	HL,00080H
  D40D  228AEC        		LD	(_DTA),HL
  D410  E1            		POP	HL
  D411  D5            		PUSH	DE
  D412  1E00          		LD	E,0
  D414  3E            		DB	03EH
                      	
  D415                	_SYS0E:		;(BDOS)カレント・ドライブの設定
  D415  D5            		PUSH	DE
  D416  7B            		LD	A,E
  D417  DDE5          		PUSH	IX
  D419  CDDCEC        		CALL	_GETDPB
  D41C  DDE1          		POP	IX
  D41E  3804          		JR	C,SX0E2
  D420  7B            		LD	A,E
  D421  3287EC        		LD	(_DVSW),A
  D424                	SX0E2:
  D424  3E08          		LD	A,8
  D426  D1            		POP	DE
  D427  C9            		RET
                      	
  D428                	_SYS0F:		;(BDOS)ファイルのオープン
  D428  CDE0DD        		CALL	SETDRV
  D42B  FD7E1C        		LD	A,(IY+28)	;(FCB)オープン・モード
  D42E  C602          		ADD	A,002H		;Write
  D430  2848          		JR	Z,FEND0F
  D432  CD0CE1        		CALL	CHKWILDX
                      	
  D435  D400DE        		CALL	NC,SOPENX
  D438                	_S16XX:
  D438  3840          		JR	C,FEND0F
                      					;Directory location
  D43A  3A9FEC        		LD	A,(_FILEN)
  D43D  FD7719        		LD	(IY+25),A	;(FCB)ディレクトリ・ロケーション
                      	;				_DIRF
  D440  3AA0EC        		LD	A,(_DIRF)
  D443  FD771D        		LD	(IY+29),A	;(FCB)ディレクトリ・モード
                      	;				_FBPS
  D446  FD731E        		LD	(IY+30),E	;(FCB)ディレクトリ・ポジション
  D449  FD721F        		LD	(IY+31),D
                      	;				Open(Read)
  D44C  FD361CFF      		LD	(IY+28),0FFH	;(FCB)オープン・モード
                      	;				FILENAME
  D450  FDE5          		PUSH	IY
  D452  D1            		POP	DE
  D453  13            		INC	DE
  D454  010B00        		LD	BC,11
  D457  EDB0          		LDIR
                      	;				Attribute
  D459  7E            		LD	A,(HL)
  D45A  FD770D        		LD	(IY+13),A	;(FCB)属性(アトリビュート)
  D45D  110B00        		LD	DE,11		;Reserved
  D460  19            		ADD	HL,DE
                      						;(FCB)ファイルを最後に変更した時刻
  D461  11DAEB        		LD	DE,SDDATA		;(FCB)ファイルを最後に変更した日付
  D464  060A          		LD	B,SDDATAE-SDDATA	;(FCB)ファイルの先頭クラスタ
  D466                	S16LOOP:				;(FCB)ファイルのサイズ(バイト単位)
  D466  1A            		LD	A,(DE)
  D467  13            		INC	DE
  D468  326FD4        		LD	(S16PAT+2),A
  D46B  7E            		LD	A,(HL)
  D46C  23            		INC	HL
  D46D  FD7700        	S16PAT:	LD	(IY+0),A
  D470  10F4          		DJNZ	S16LOOP
                      	
  D472  AF            		XOR	A
  D473  FD770C        		LD	(IY+12),A	;(FCB)カレント・ブロック
  D476  FD2238D5      		LD	(OFCB+1),IY
  D47A                	FEND0F:
  D47A  C31FD5        		JP	FEND
                      	
  D47D                	_SYS10:		;(BDOS)ファイルのクローズ
  D47D  CDE0DD        		CALL	SETDRV
  D480  FD7E1C        		LD	A,(IY+28)	;(FCB)オープン・モード
  D483  D6FE          		SUB	0FEH
  D485  37            		SCF
  D486  3F            		CCF
  D487  2032          		JR	NZ,FEND10
  D489                	_S10A:				;Write
  D489  FD770E        		LD	(IY+14),A	;(FCB)レコード・サイズ/アクセスするディレクトリのクラスタ番号+1
  D48C  FD770F        		LD	(IY+15),A
                      	
  D48F  FD341C        		INC	(IY+28)		;0FEH->0FFH ;オープン・モード
  D492  CD09E2        		CALL	SETTMS
                      	
  D495  FD7E1D        		LD	A,(IY+29)	;(FCB)ディレクトリ・モード
  D498  32A0EC        		LD	(_DIRF),A
  D49B  FD5E1E        		LD	E,(IY+30)	;(FCB)ディレクトリ・ポジション
  D49E  FD561F        		LD	D,(IY+31)
  D4A1  CD2FDF        		CALL	DC
  D4A4  3879          		JR	C,FEND
                      	
  D4A6  FD7E19        		LD	A,(IY+25)	;(FCB)ディレクトリ・ロケーション
  D4A9  87            		ADD	A,A		;*2
  D4AA  87            		ADD	A,A		;*4
  D4AB  87            		ADD	A,A		;*8
  D4AC  E6FF          	IBM2:	AND	0FFH		;自己書き換え 1024=0FFH / 512=07FH
  D4AE  6F            		LD	L,A
  D4AF  2600          		LD	H,0
  D4B1  29            		ADD	HL,HL		;*16
  D4B2  29            		ADD	HL,HL		;*32
  D4B3  ED4B7EEC      		LD	BC,(_DTBUF)
  D4B7  09            		ADD	HL,BC
                      	
  D4B8  CD1CE1        		CALL	SDIRENT
  D4BB                	FEND10:
  D4BB  1862          		JR	FEND
                      	
  D4BD                	OPENDD:
  D4BD  FD361CFD      		LD	(IY+28),0FDH	;(FCB)オープン・モード
  D4C1  FD360D20      		LD	(IY+13),020H	;(FCB)属性(アトリビュート)
  D4C5  CD0EE2        		CALL	SETTMSX
  D4C8  1855          		JR	FEND
                      	
  D4CA                	_SYS11:		;(BDOS)最初のファイルの検索
  D4CA  CDE0DD        		CALL	SETDRV
  D4CD  CD76DF        		CALL	CHKDDX
  D4D0  3818          		JR	C,_S11A
  D4D2  FDE5          		PUSH	IY
  D4D4  E1            		POP	HL
  D4D5  ED5B8AEC      		LD	DE,(_DTA)
  D4D9  010C00        		LD	BC,12
  D4DC  EDB0          		LDIR
  D4DE  3E20          		LD	A,020H
  D4E0  12            		LD	(DE),A
  D4E1  13            		INC	DE
  D4E2  62            		LD	H,D
  D4E3  6B            		LD	L,E
  D4E4  13            		INC	DE
  D4E5  0E13          		LD	C,19
  D4E7  70            		LD	(HL),B
  D4E8  1833          		JR	_S11B
  D4EA                	_S11A:
  D4EA  CD34DE        		CALL	SOPEN
  D4ED                	_S12X1:
  D4ED  3830          		JR	C,FEND
  D4EF  CDCEDE        		CALL	SOPENE2
  D4F2  ED5B8AEC      		LD	DE,(_DTA)
  D4F6  3A88EC        		LD	A,(_DRV)
  D4F9  3C            		INC	A
  D4FA  12            		LD	(DE),A
  D4FB  D5            		PUSH	DE
  D4FC  13            		INC	DE
  D4FD  012000        		LD	BC,32
  D500  EDB0          		LDIR
  D502  FD6E0E        		LD	L,(IY+14)	;(FCB)レコード・サイズ/アクセスするディレクトリのクラスタ番号+1
  D505  FD660F        		LD	H,(IY+15)
  D508  22F4EB        		LD	(SCDIR),HL
  D50B  2A9AEC        		LD	HL,(_FBPS)
  D50E  22F6EB        		LD	(SFBPS),HL
  D511  2A9FEC        		LD	HL,(_FILEN)
  D514  22F8EB        		LD	(SFNDF),HL	;Directory position and Flags
  D517  E1            		POP	HL
  D518  11B4E2        		LD	DE,SFILE
  D51B  0E21          		LD	C,33
  D51D                	_S11B:
  D51D  EDB0          		LDIR
  D51F                	FEND:
  D51F  9F            		SBC	A,A		;CF=0 A=0 : CF=1 A=0FFH
  D520                	FENDE:
  D520  FDE1          		POP	IY
  D522  C1            		POP	BC
  D523  D1            		POP	DE
  D524  E1            		POP	HL
  D525  C9            		RET
                      	
  D526                	_SYS12:		;(BDOS)次のファイルの検索
  D526  E5            		PUSH	HL
  D527  D5            		PUSH	DE
  D528  C5            		PUSH	BC
  D529  FDE5          		PUSH	IY
  D52B  CD98DE        		CALL	NOPEN
  D52E  18BD          		JR	_S12X1
                      	
  D530                	_S16K:
  D530  FD7E1C        		LD	A,(IY+28)	;(FCB)オープン・モード
  D533  FEFD          		CP	0FDH		;Device(0FDH)
  D535  37            		SCF
  D536  C8            		RET	Z
                      	
  D537  110000        	OFCB:	LD	DE,0
  D53A  D5            		PUSH	DE
  D53B  061A          		LD	B,26		;First cluster
  D53D                	S16K1:
  D53D  13            		INC	DE
  D53E  23            		INC	HL
  D53F  10FC          		DJNZ	S16K1
                      	
  D541  1A            		LD	A,(DE)
  D542  BE            		CP	(HL)
  D543  2013          		JR	NZ,S16K2
  D545  13            		INC	DE
  D546  23            		INC	HL
  D547  1A            		LD	A,(DE)
  D548  BE            		CP	(HL)
  D549  200D          		JR	NZ,S16K2
                      	
  D54B  E1            		POP	HL
  D54C  FDE5          		PUSH	IY
  D54E  D1            		POP	DE
  D54F  1A            		LD	A,(DE)		;Drive
  D550  BE            		CP	(HL)
  D551  2005          		JR	NZ,S16K2
                      	
  D553  ED52          		SBC	HL,DE		;CP HL,DE
  D555  37            		SCF
  D556  C0            		RET	NZ
  D557  E5            		PUSH	HL
  D558                	S16K2:
  D558  E1            		POP	HL
  D559  FDE5          		PUSH	IY
  D55B  D1            		POP	DE
  D55C                	_SYS13:		;(BDOS)ファイルの削除
  D55C  CDE0DD        		CALL	SETDRV
  D55F  CD36E0        		CALL	KILL
  D562                	FEND13:
  D562  18BB          		JR	FEND
                      	
  D564                	_SYS14:		;(BDOS)シーケンシャルな読み出し
  D564  CDE0DD        		CALL	SETDRV
  D567  CD3BE2        		CALL	PUSHRR
  D56A  CD7CE2        		CALL	GETSEQ
                      	
  D56D  CD90E2        		CALL	RB_READ
  D570  E5            		PUSH	HL
  D571  CD4FE2        		CALL	SETSEQ
  D574                	SREAD:
  D574  E1            		POP	HL
                      	
  D575  C601          		ADD	A,001H
  D577  38A6          		JR	C,FEND
                      	
  D579  7D            		LD	A,L
  D57A  D601          		SUB	001H
  D57C                	FENDX:
  D57C  9F            		SBC	A,A
  D57D  E603          		AND	3
  D57F  1F            		RRA
  D580  189E          		JR	FENDE
                      	
  D582                	_SYS15:		;(BDOS)シーケンシャルな書き込み
  D582  CDE0DD        		CALL	SETDRV
  D585  CD3BE2        		CALL	PUSHRR
  D588  CD7CE2        		CALL	GETSEQ
                      	
  D58B  CD89E2        		CALL	RB_WRITE
  D58E  E5            		PUSH	HL
  D58F  CD4FE2        		CALL	SETSEQ
  D592                	SWRITE:
  D592  E1            		POP	HL
                      	
  D593  C6FF          		ADD	A,0FFH
  D595  18E5          		JR	FENDX
                      	
  D597                	_SYS17:		;(BDOS)ファイル名の変更
  D597  CDE0DD        		CALL	SETDRV
  D59A  CD92E0        		CALL	NAME
  D59D  18C3          		JR	FEND13
                      	
  D59F                	_SYS16:		;(BDOS)ファイルの作成
  D59F  CDE0DD        		CALL	SETDRV
                      	
  D5A2  CD0CE1        		CALL	CHKWILDX
  D5A5  38BB          		JR	C,FEND13
  D5A7  FD7E01        		LD	A,(IY+1)	;(FCB)主ファイル名
  D5AA  FE05          		CP	5
  D5AC  2805          		JR	Z,_S16X2
  D5AE  FE21          		CP	021H
  D5B0  DA62D5        		JP	C,FEND13
  D5B3                	_S16X2:
                      	;				Clear FCB
  D5B3  FDE5          		PUSH	IY
  D5B5  E1            		POP	HL
  D5B6  011000        		LD	BC,16
  D5B9  09            		ADD	HL,BC
  D5BA                	_S16X1:
  D5BA  70            		LD	(HL),B		;B=0
  D5BB  23            		INC	HL
  D5BC  0D            		DEC	C
  D5BD  20FB          		JR	NZ,_S16X1
                      	
  D5BF  CD0EE2        		CALL	SETTMSX
  D5C2  FD360DFF      		LD	(IY+13),0FFH	;(FCB)Attribute
  D5C6  CD00DE        		CALL	SOPENX
  D5C9  3F            		CCF
  D5CA  CC30D5        		CALL	Z,_S16K
  D5CD  D4DFDE        		CALL	NC,COPEN
  D5D0  D41CE1        		CALL	NC,SDIRENT
  D5D3  C338D4        		JP	_S16XX
                      	
  D5D6                	_SYS21:		;(BDOS)ランダムな読み出し
                      	
  D5D6  CDE0DD        		CALL	SETDRV
  D5D9  CD3BE2        		CALL	PUSHRR
  D5DC  FD6E21        		LD	L,(IY+33)	;(FCB)Random record
  D5DF  FD6622        		LD	H,(IY+34)
                      	
  D5E2  CD90E2        		CALL	RB_READ
  D5E5  E5            		PUSH	HL
  D5E6  CD66E2        		CALL	POPRR
  D5E9  1889          		JR	SREAD
                      	
  D5EB                	_SYS22:		;(BDOS)ランダムな書き込み
  D5EB                	_SYS28:		;(BDOS)ランダムな書き込み・その2
  D5EB  CDE0DD        		CALL	SETDRV
  D5EE  CD3BE2        		CALL	PUSHRR
  D5F1  FD6E21        		LD	L,(IY+33)	;(FCB)Random record
  D5F4  FD6622        		LD	H,(IY+34)
                      	
  D5F7  CD89E2        		CALL	RB_WRITE
  D5FA  E5            		PUSH	HL
  D5FB  CD66E2        		CALL	POPRR
  D5FE  1892          		JR	SWRITE
                      	
  D600                	_SYS18:		;(BDOS)ログイン・ベクトルの獲得
  D600  21FF00        		LD	HL,000FFH
  D603  AF            		XOR	A
  D604  C9            		RET
                      	
  D605                	_SYS19:		;(BDOS)カレント・ドライブ番号の獲得
  D605  3A87EC        		LD	A,(_DVSW)
  D608  A7            		AND	A
  D609  C9            		RET
                      	
  D60A                	_SYS1A:		;(BDOS)DTAの設定
  D60A  ED538AEC      		LD	(_DTA),DE
  D60E  AF            		XOR	A
  D60F  C9            		RET
                      	
  D610                	_SYS1B:		;(BDOS)ディスク情報の獲得
  D610  7B            		LD	A,E
  D611  CDF3DD        		CALL	GETDRV
  D614  CDDCEC        		CALL	_GETDPB
  D617  D4E2EC        		CALL	NC,_RDFATX
  D61A  210000        		LD	HL,0
  D61D  D4EEE1        		CALL	NC,DSKF
                      	
  D620  ED5BEFE1      		LD	DE,(MAXCLP+1)	;DPB_08_MAXCL-1
  D624  1B            		DEC	DE		;DE←クラスタの総数
  D625  FD2A7CEC      		LD	IY,(_FATBF)	;IY←メモリ上のFATの先頭アドレス
  D629  9F            		SBC	A,A
  D62A  D8            		RET	C
  D62B  4F            		LD	C,A		;C=0
  D62C  DD460F        		LD	B,(IX+00FH)	;DPB_0F_BPS
  D62F  CBB8          		RES	7,B
  D631  DD7E07        		LD	A,(IX+7)	;DPB_07_SECPCL
  D634  C9            		RET
                      	
  D635                	_SYS1D:		;(BDOS)書き込みが禁止されているディスクの調査
  D635  AF            		XOR	A
  D636  67            		LD	H,A
  D637  6F            		LD	L,A
  D638  C9            		RET
                      	
  D639                	_SYS1F:		;(BDOS)ディスク装置のパラメータの読み出し
  D639  2100ED        		LD	HL,DEVICE
  D63C  7B            		LD	A,E
  D63D  C3DCEC        		JP	_GETDPB
                      	
  D640                	_SYS23:		;(BDOS)ファイル・サイズの獲得
  D640  E5            		PUSH	HL
  D641  2A1EEC        		LD	HL,(STABLE+2*00FH)	;ファイルのオープン
  D644  CD0F00        		CALL	JP_HL
  D647  3814          		JR	C,_S23X1
                      	
  D649  D5            		PUSH	DE		;EX DE,IY
  D64A  FDE3          		EX	(SP),IY		;
                      	;	POP	DE		;
                      	;	PUSH	DE		;DEを破壊しないように注意vv
  D64C  CD6CE2        		CALL	GETSIZE
  D64F                	_S24X1:
  D64F  FD7521        		LD	(IY+33),L	;(FCB)Random record
  D652  FD7422        		LD	(IY+34),H
  D655  FD362300      		LD	(IY+35),0
                      	;	POP	DE		;^^^^^^^^^^^^^^^^^^^^^^^^
                      	;	PUSH	DE		;EX DE,IY
  D659  FDE3          		EX	(SP),IY		;
  D65B  D1            		POP	DE		;
                      	
  D65C  AF            		XOR	A
  D65D                	_S23X1:
  D65D  E1            		POP	HL
  D65E  C9            		RET
                      	
  D65F                	_SYS24:		;(BDOS)ランダム・レコード・フィールドの設定
  D65F  E5            		PUSH	HL
  D660  D5            		PUSH	DE		;EX DE,IY
  D661  FDE3          		EX	(SP),IY		;
                      	;	POP	DE		;
                      	;	PUSH	DE		;DEを破壊しないように注意vv
  D663  CD7CE2        		CALL	GETSEQ
  D666  18E7          		JR	_S24X1		;^^^^^^^^^^^^^^^^^^^^^^^^
                      	
  D668                	_SYS29:		;(BDOS)ファイル名の解析
  D668  C5            		PUSH	BC
  D669  E5            		PUSH	HL
  D66A  CDF4DC        		CALL	FILE
  D66D  E1            		POP	HL
  D66E  C1            		POP	BC
  D66F                	S29X1:
  D66F  C5            		PUSH	BC
  D670  D5            		PUSH	DE
  D671  E5            		PUSH	HL
  D672  EB            		EX	DE,HL
  D673  21DB00        		LD	HL,FDRV
  D676  010D00        		LD	BC,13
  D679  EDB0          		LDIR
  D67B  70            		LD	(HL),B
  D67C  0E03          		LD	C,3
  D67E  EDB0          		LDIR
  D680  E1            		POP	HL
  D681  D1            		POP	DE
  D682  C1            		POP	BC
  D683  AF            		XOR	A
  D684  C9            		RET
                      	
  D685                	_SYS30:		;(BDOS)論理セクタを用いた書き込み
  D685  C5            		PUSH	BC
  D686  011CE8        		LD	BC,DWT_DPB
  D689  1804          		JR	S2FX
  D68B                	_SYS2F:
  D68B  C5            		PUSH	BC
  D68C  01CCE7        		LD	BC,DRD_DPB
  D68F                	S2FX:
  D68F  ED43A4D6      		LD	(S2FPAT+1),BC
  D693  CDDFEC        		CALL	_FFLUSH
                      	
  D696  D5            		PUSH	DE
  D697  E5            		PUSH	HL
  D698  7D            		LD	A,L		;Drive
  D699  CDD9EC        		CALL	_CHGDRV
  D69C  380D          		JR	C,S30X2
  D69E  44            		LD	B,H		;Number of clusters
  D69F  2A8AEC        		LD	HL,(_DTA)
  D6A2                	S30X:
  D6A2  C5            		PUSH	BC
  D6A3  CDCCE7        	S2FPAT:	CALL	DRD_DPB
  D6A6  C1            		POP	BC
  D6A7  3802          		JR	C,S30X2
  D6A9  10F7          		DJNZ	S30X
  D6AB                	S30X2:
  D6AB  E1            		POP	HL
  D6AC  D1            		POP	DE
  D6AD  C1            		POP	BC
  D6AE  9F            		SBC	A,A
  D6AF  C9            		RET
                      	
                      	;LDIO.ASM
                      	
                      	;	LSX-Dodgers IO
                      	
                      	
  D6B0                	BIOS:
  D6B0  E5            		PUSH	HL
  D6B1  210081        		LD	HL,08100H
  D6B4  39            		ADD	HL,SP
  D6B5  E1            		POP	HL
  D6B6  300E          		JR	NC,BIOS2
  D6B8                	BIOS1:
  D6B8  CDC0D6        		CALL	BIOS3
  D6BB  061E          		LD	B,01EH
  D6BD  ED79          		OUT	(C),A
  D6BF  C9            		RET
  D6C0                	BIOS3:
  D6C0  C5            		PUSH	BC
  D6C1  061D          		LD	B,01DH
  D6C3  ED79          		OUT	(C),A
  D6C5  C9            		RET
  D6C6                	BIOS2:
  D6C6  ED73D1D6      		LD	(SPPAT+1),SP	;スタックがBIOS-ROMと被っている場合
  D6CA  31D4FF        		LD	SP,EXTSP
  D6CD  CDB8D6        		CALL	BIOS1
  D6D0  310000        	SPPAT:	LD	SP,0
  D6D3  C9            		RET
                      	
  D6D4                	INT:
  D6D4  F5            		PUSH	AF
  D6D5  E5            		PUSH	HL
  D6D6  C5            		PUSH	BC
  D6D7  210001        		LD	HL,00100H
  D6DA  39            		ADD	HL,SP
  D6DB  3807          		JR	C,INTP1
  D6DD  ED730FD7      		LD	(INTSP+1),SP
  D6E1  31D4FF        		LD	SP,EXTSP
  D6E4                	INTP1:
  D6E4  CD00DB        		CALL	IN49SB
  D6E7  67            		LD	H,A
  D6E8  CD00DB        		CALL	IN49SB
  D6EB  6F            		LD	L,A
                      	
  D6EC  CB64          		BIT	4,H		;[GRAPH]
  D6EE  2010          		JR	NZ,SCEXE
  D6F0  7D            		LD	A,L
  D6F1  EE09          		XOR	9
  D6F3  2839          		JR	Z,DIAN
  D6F5  7C            		LD	A,H
  D6F6  0F            		RRCA			;[CTRL]
  D6F7  301E          		JR	NC,SCL
  D6F9  0F            		RRCA			;[SHIFT]
  D6FA  3804          		JR	C,SCEXE
  D6FC  3E80          		LD	A,080H
  D6FE  181E          		JR	SCG1
  D700                	SCEXE:
  D700  2292EC        		LD	(_KEYD),HL
  D703  CD63D7        		CALL	KEYSET1
                      	
  D706  21D4FF        		LD	HL,EXTSP
  D709  A7            		AND	A
  D70A  ED72          		SBC	HL,SP
  D70C  2003          		JR	NZ,INTPE1
                      	
  D70E  310000        	INTSP:	LD	SP,0
  D711                	INTPE1:
  D711  C1            		POP	BC
  D712                	INTPE:
  D712  E1            		POP	HL
  D713                	INTPE2:
  D713  F1            		POP	AF
  D714                	INTCTCE:
  D714  FB            		EI
  D715  ED4D          		RETI
                      	
  D717                	SCL:
  D717  7D            		LD	A,L
  D718  FE08          		CP	008H
  D71A  280D          		JR	Z,RESET
                      	
  D71C  3E02          		LD	A,002H
  D71E                	SCG1:
  D71E  E5            		PUSH	HL
  D71F  21BFEC        		LD	HL,WK1FD0
  D722  AE            		XOR	(HL)
  D723  CDB7CC        		CALL	S1FD0
  D726  E1            		POP	HL
  D727  18D7          		JR	SCEXE
                      	
  D729                	RESET:
  D729  3E1D          		LD	A,01DH
  D72B  D300          		OUT	(0),A
  D72D  C7            		RST	0
                      	
  D72E                	DIAN:
  D72E  6F            		LD	L,A
  D72F  C5            		PUSH	BC
  D730  01B01F        		LD	BC,01FB0H
  D733  ED78          		IN	A,(C)
  D735  EE80          		XOR	080H
  D737  ED79          		OUT	(C),A
  D739  C1            		POP	BC
  D73A  18C4          		JR	SCEXE
                      	
  D73C                	INTCTC2:
  D73C  F5            		PUSH	AF
  D73D  3E00          	INTCPAT:LD	A,000H
  D73F  3D            		DEC	A
  D740  323ED7        		LD	(INTCPAT+1),A
  D743  20CE          		JR	NZ,INTPE2
                      	
  D745  3A92EC        		LD	A,(_KEYD)
  D748  B7            		OR	A
  D749  28C8          		JR	Z,INTPE2
  D74B                	KEYSET0:
  D74B  E5            		PUSH	HL
  D74C  2A90EC        		LD	HL,(_KEYPS)
  D74F  7C            		LD	A,H
  D750  AD            		XOR	L
  D751  2006          		JR	NZ,INTC2A
                      	
  D753  2A92EC        		LD	HL,(_KEYD)
  D756  CD8DD7        		CALL	KEYSET
  D759                	INTC2A:
  D759  3A94EC        		LD	A,(_KEYSP)
  D75C  E60F          		AND	00FH
  D75E  323ED7        		LD	(INTCPAT+1),A
                      	
  D761  18AF          		JR	INTPE
                      	
  D763                	KEYSET1:
  D763  CB6C          		BIT	5,H
  D765  F5            		PUSH	AF
  D766  ED4B8CEC      		LD	BC,(_CTC)
  D76A  78            		LD	A,B
  D76B  B1            		OR	C
  D76C  2006          		JR	NZ,KEYS10E
                      	
  D76E  F1            		POP	AF
  D76F  201C          		JR	NZ,KEYSET
  D771  F5            		PUSH	AF
  D772  18D7          		JR	KEYSET0
  D774                	KEYS10E:
  D774  F1            		POP	AF
  D775  C8            		RET	Z
  D776  F5            		PUSH	AF
  D777  3E03          		LD	A,3		;CTC STOP
  D779  ED79          		OUT	(C),A
  D77B  F1            		POP	AF
                      	
  D77C  B7            		OR	A
  D77D  C8            		RET	Z
                      	
  D77E  E5            		PUSH	HL
  D77F  2A94EC        		LD	HL,(_KEYSP)
  D782  3EA7          		LD	A,0A7H
  D784  ED79          		OUT	(C),A
  D786  ED69          		OUT	(C),L
  D788  7C            		LD	A,H
  D789  323ED7        		LD	(INTCPAT+1),A
  D78C  E1            		POP	HL
                      	
  D78D                	KEYSET:
  D78D  7D            		LD	A,L
  D78E  CB7C          		BIT	7,H
  D790  CCBDD7        		CALL	Z,FKEY
  D793  CB74          		BIT	6,H
  D795  C0            		RET	NZ
  D796                	KEYBS:
  D796  B7            		OR	A
  D797  C8            		RET	Z
  D798                	KEYBS1:
  D798  FE03          		CP	3
  D79A  CCB0D7        		CALL	Z,KEYBC
  D79D  E5            		PUSH	HL
  D79E  F5            		PUSH	AF
  D79F  2A90EC        		LD	HL,(_KEYPS)
  D7A2  2C            		INC	L
  D7A3  7D            		LD	A,L
  D7A4  BC            		CP	H
  D7A5  2812          		JR	Z,KEYBE
  D7A7  3290EC        		LD	(_KEYPS),A
  D7AA  26FE          		LD	H,KEYBF/256
  D7AC  F1            		POP	AF
  D7AD  77            		LD	(HL),A
  D7AE  E1            		POP	HL
  D7AF  C9            		RET
                      	
  D7B0                	KEYBC:
  D7B0  E5            		PUSH	HL
  D7B1  210000        		LD	HL,0
  D7B4  2290EC        		LD	(_KEYPS),HL
  D7B7  E1            		POP	HL
  D7B8  C9            		RET
                      	
  D7B9                	KEYBE:
  D7B9  F1            		POP	AF
  D7BA  E1            		POP	HL
  D7BB  37            		SCF
  D7BC  C9            		RET
                      	
  D7BD                	FKEY:
  D7BD  CB75          		BIT	6,L
  D7BF  C8            		RET	Z
  D7C0  3E1B          		LD	A,01BH
  D7C2  CD98D7        		CALL	KEYBS1
  D7C5  7D            		LD	A,L
  D7C6  C6AF          		ADD	A,020H-'q'
  D7C8  CB7D          		BIT	7,L
  D7CA  C8            		RET	Z
  D7CB  2E50          		LD	L,'P'
  D7CD  D690          		SUB	0E1H+020H-'q'
  D7CF  2810          		JR	Z,KEYBSL
  D7D1  2C            		INC	L
  D7D2  3D            		DEC	A
  D7D3  280C          		JR	Z,KEYBSL
  D7D5  2C            		INC	L
  D7D6  D609          		SUB	0EBH-0E2H
  D7D8  2807          		JR	Z,KEYBSL
  D7DA  2E43          		LD	L,'C'
  D7DC  3D            		DEC	A
  D7DD  2802          		JR	Z,KEYBSL
  D7DF  2E58          		LD	L,'X'
  D7E1                	KEYBSL:
  D7E1  7D            		LD	A,L
  D7E2  18B4          		JR	KEYBS1
                      	
  D7E4                	_SYS01:		;(BDOS)コンソール入力
  D7E4  CDBDD3        		CALL	_SYS07
  D7E7                	MSG_:
  D7E7  F5            		PUSH	AF
  D7E8  D5            		PUSH	DE
  D7E9  5F            		LD	E,A
  D7EA  CDF0D7        		CALL	_SYS02
  D7ED  D1            		POP	DE
  D7EE  F1            		POP	AF
  D7EF  C9            		RET
                      	
  D7F0                	_SYS02:		;(BDOS)コンソール出力
  D7F0  CD02D8        		CALL	BREAK
  D7F3  1805          		JR	PRINTX
                      	
  D7F5                	_SYS06:		;(BDOS)コンソール直接入出力
  D7F5  7B            		LD	A,E
  D7F6  3C            		INC	A
  D7F7  CACAEC        		JP	Z,_INKEY
  D7FA                	PRINTX:
  D7FA  C3CDEC        		JP	_PRINT
                      	
  D7FD                	_SYS08:		;(BDOS)エコーなしコンソール入力
  D7FD  CDBDD3        		CALL	_SYS07
  D800  1804          		JR	BREAK1
  D802                	BREAK:
  D802  FB            		EI
  D803  3A92EC        		LD	A,(_KEYD)
  D806                	BREAK1:
  D806  FE03          		CP	3
  D808  CA0000        		JP	Z,0
  D80B  FE13          		CP	013H
  D80D  C0            		RET	NZ
                      	
  D80E                	PAUSE:
  D80E  CDB0D7        		CALL	KEYBC
                      	
  D811                	FLGET:
  D811  CDDFEC        		CALL	_FFLUSH
  D814  C5            		PUSH	BC
  D815  E5            		PUSH	HL
  D816  ED4B8EEC      		LD	BC,(_TXADR)
  D81A  CBE8          		SET	5,B
  D81C  ED60          		IN	H,(C)
  D81E                	FLGET1:
  D81E  3A93EC        		LD	A,(_KEYD+1)
  D821  0F            		RRCA
  D822  0F            		RRCA
  D823  E610          		AND	010H
  D825  F608          		OR	8
  D827  ED68          		IN	L,(C)
  D829  B5            		OR	L
  D82A  ED79          		OUT	(C),A
  D82C  CDCAEC        		CALL	_INKEY
  D82F  28ED          		JR	Z,FLGET1
  D831  ED61          		OUT	(C),H
  D833  E1            		POP	HL
  D834  C1            		POP	BC
  D835  C9            		RET
                      	
  D836                	_SYS0A:		;(BDOS)文字列入力
  D836  C5            		PUSH	BC
  D837  E5            		PUSH	HL
  D838  D5            		PUSH	DE
  D839  CD5BDC        		CALL	GETL
  D83C  1100FF        		LD	DE,KBUF
  D83F  E1            		POP	HL
  D840  E5            		PUSH	HL
  D841  0E00          		LD	C,0
  D843  3004          		JR	NC,SAX0
  D845  23            		INC	HL
  D846  23            		INC	HL
  D847  1808          		JR	SAX4
  D849                	SAX0:
  D849  46            		LD	B,(HL)
  D84A  23            		INC	HL
  D84B                	SAX1:
  D84B  23            		INC	HL
  D84C  1A            		LD	A,(DE)
  D84D  13            		INC	DE
  D84E  B7            		OR	A
  D84F  2004          		JR	NZ,SAX2
  D851                	SAX4:
  D851  360D          		LD	(HL),00DH
  D853  1804          		JR	SAX3
  D855                	SAX2:
  D855  77            		LD	(HL),A
  D856  0C            		INC	C
  D857  10F2          		DJNZ	SAX1
  D859                	SAX3:
  D859  D1            		POP	DE
  D85A  79            		LD	A,C
  D85B  13            		INC	DE
  D85C  12            		LD	(DE),A
  D85D  1B            		DEC	DE
  D85E  E1            		POP	HL
  D85F  C1            		POP	BC
  D860  A7            		AND	A
  D861  C9            		RET
                      	
  D862                	_SYS0B:		;(BDOS)コンソール状態のチェック
  D862  CD02D8        		CALL	BREAK
  D865  3A92EC        		LD	A,(_KEYD)
  D868  B7            		OR	A
  D869  C8            		RET	Z
  D86A                	CONSTX:
  D86A  CDDFEC        		CALL	_FFLUSH
  D86D  E5            		PUSH	HL
  D86E  2A90EC        		LD	HL,(_KEYPS)
  D871  7C            		LD	A,H
  D872  AD            		XOR	L
  D873  E1            		POP	HL
  D874  C6FF          		ADD	A,0FFH
  D876  9F            		SBC	A,A
  D877  C9            		RET
                      	
  D878                	_SYS2A:		;(BDOS)日付の獲得
  D878  C5            		PUSH	BC
  D879  3EED          		LD	A,0EDH		;Read calendar
  D87B  CD1BDB        		CALL	COMOUT
  D87E  CDA1D8        		CALL	IN49SB_BCD	;YY
  D881  6F            		LD	L,A
  D882  2600          		LD	H,0
  D884  116C07        		LD	DE,1900		;0076CH
  D887  FE5A          		CP	90		;90以上は1900年代 1990-1999
  D889  3002          		JR	NC,RDDATE1	;90未満は2000年代 2000-2089
  D88B  1ED0          		LD	E,0D0H		;2000 & 0FFH D=007H
  D88D                	RDDATE1:
  D88D  19            		ADD	HL,DE
  D88E  CD00DB        		CALL	IN49SB		;MM
  D891  57            		LD	D,A
  D892  CDA1D8        		CALL	IN49SB_BCD	;DD
  D895  5F            		LD	E,A
  D896  7A            		LD	A,D
  D897  E607          		AND	7
  D899  0604          		LD	B,4
  D89B                	RDDATE2:
  D89B  CB3A          		SRL	D
  D89D  10FC          		DJNZ	RDDATE2
  D89F  C1            		POP	BC
  D8A0  C9            		RET
  D8A1                	IN49SB_BCD:
  D8A1  CD00DB        		CALL	IN49SB
                      	;------------------------
                      	;BCDの10進数化
                      	;in
                      	;	A  : BCD
                      	;out
                      	;	A  : 10進数
                      	;------------------------
  D8A4  4F            		LD	C,A
  D8A5  E6F0          		AND	0F0H	;10の位
  D8A7  0F            		RRCA
  D8A8  47            		LD	B,A
  D8A9  0F            		RRCA
  D8AA  0F            		RRCA
  D8AB  80            		ADD	A,B
  D8AC  47            		LD	B,A
  D8AD  79            		LD	A,C
  D8AE  E60F          		AND	00FH	;1の位
  D8B0  80            		ADD	A,B
  D8B1  C9            		RET
                      	
  D8B2                	_SYS2C:		;(BDOS)時刻の獲得
  D8B2  C5            		PUSH	BC
  D8B3  3EEF          		LD	A,0EFH		;Read time
  D8B5  CD1BDB        		CALL	COMOUT
  D8B8  CDA1D8        		CALL	IN49SB_BCD	;TT
  D8BB  67            		LD	H,A
  D8BC  CDA1D8        		CALL	IN49SB_BCD	;MM
  D8BF  6F            		LD	L,A
  D8C0  CDA1D8        		CALL	IN49SB_BCD	;SS
  D8C3  57            		LD	D,A
  D8C4  C1            		POP	BC
  D8C5  AF            		XOR	A
  D8C6  C9            		RET
                      	
  D8C7                	MSX1:
  D8C7  5F            		LD	E,A
  D8C8  CDCDEC        		CALL	_PRINT
  D8CB                	MSX:
  D8CB  7E            		LD	A,(HL)
  D8CC  23            		INC	HL
  D8CD  B7            		OR	A
  D8CE  20F7          		JR	NZ,MSX1
  D8D0  C9            		RET
                      	
  D8D1                	ESC1:
  D8D1  7B            		LD	A,E
  D8D2  FE41          		CP	'A'
  D8D4  CA0EDA        		JP	Z,CTRL1E
  D8D7  FE42          		CP	'B'
  D8D9  CA86DB        		JP	Z,CTRL1F
  D8DC  FE43          		CP	'C'
  D8DE  CA1BDA        		JP	Z,CTRL1C
  D8E1  FE44          		CP	'D'
  D8E3  CA04DA        		JP	Z,CTRL1D
  D8E6  FE45          		CP	'E'
  D8E8  2802          		JR	Z,CT0CX
  D8EA  FE6A          		CP	'j'
  D8EC                	CT0CX:
  D8EC  CA59DB        		JP	Z,CTRL0C
  D8EF  FE48          		CP	'H'
  D8F1  CA99DA        		JP	Z,CTRL0B
  D8F4  FE4A          		CP	'J'
  D8F6  CA5CDB        		JP	Z,CTRL1A
  D8F9  FE4B          		CP	'K'
  D8FB  CA5BDA        		JP	Z,CTRL05
  D8FE  FE4C          		CP	'L'
  D900  CA9BDB        		JP	Z,CTRL0E
  D903  FE78          		CP	'x'
  D905  2804          		JR	Z,ESC1X
  D907  FE79          		CP	'y'
  D909  2002          		JR	NZ,ESC1Y
  D90B                	ESC1X:
  D90B  3601          		LD	(HL),1
  D90D                	ESC1Y:
  D90D  FE3D          		CP	'='
  D90F  2804          		JR	Z,ESC1W
  D911  FE59          		CP	'Y'
  D913  2002          		JR	NZ,ESC1Z
  D915                	ESC1W:
  D915  3602          		LD	(HL),2
  D917                	ESC1Z:
  D917  FE20          		CP	020H
  D919  3802          		JR	C,ESC1C
  D91B  87            		ADD	A,A
  D91C  D0            		RET	NC
  D91D                	ESC1C:
  D91D  E1            		POP	HL
  D91E  184A          		JR	ANK
                      	
  D920                	ESC:
  D920  217BD9        		LD	HL,PRINTE5
  D923  E5            		PUSH	HL
  D924  2146D9        		LD	HL,ESCFLG+1
  D927  3600          		LD	(HL),0
  D929  3D            		DEC	A
  D92A  28A5          		JR	Z,ESC1
  D92C  3D            		DEC	A
  D92D  2009          		JR	NZ,ESC2
  D92F  3603          		LD	(HL),3
  D931  7B            		LD	A,E
  D932  D620          		SUB	020H
  D934  323BD9        		LD	(ESCYP+1),A
  D937  C9            		RET
  D938                	ESC2:
  D938  3D            		DEC	A
  D939  C0            		RET	NZ
  D93A  2600          	ESCYP:	LD	H,0
  D93C  7B            		LD	A,E
  D93D  D620          		SUB	020H
  D93F  6F            		LD	L,A
  D940  C3D6EC        		JP	_LOC
                      	
  D943                	PRINT:
  D943  C5            		PUSH	BC
  D944  E5            		PUSH	HL
  D945  3E00          	ESCFLG:	LD	A,000H
  D947  B7            		OR	A
  D948  20D6          		JR	NZ,ESC
                      	
  D94A  3E1F          		LD	A,01FH
  D94C  BB            		CP	E
  D94D  3030          		JR	NC,CTRL
  D94F                	PRINTC:
  D94F  A7            	INSFLG:	AND	A
  D950  DC24DB        		CALL	C,CTRL12
                      	
  D953  3E00          	KANFLG:	LD	A,000H
  D955  B7            		OR	A
  D956  203D          		JR	NZ,KANJI2
  D958  7B            	X1KPAT:	LD	A,E
  D959  FE80          		CP	080H
  D95B  380D          		JR	C,ANK
  D95D  FEA0          		CP	0A0H
  D95F  3804          		JR	C,KANJI1
  D961  FEE0          		CP	0E0H
  D963  3805          		JR	C,ANK
  D965                	KANJI1:
  D965  3254D9        		LD	(KANFLG+1),A
  D968  1811          		JR	PRINTE5
  D96A                	ANK:
  D96A  ED4B8EEC      		LD	BC,(_TXADR)
  D96E  78            		LD	A,B
  D96F  F638          		OR	038H
  D971  47            		LD	B,A
                      	;	OUT	(C),0		;未定義命令ニーモニック
  D972  ED71          		DB	0EDH,071H	;Kanji
  D974  CB98          		RES	3,B
  D976  ED59          		OUT	(C),E		;Text
  D978                	KANJIE:
  D978  CDE0D9        		CALL	PRINTE7
  D97B                	PRINTE5:
  D97B  E1            		POP	HL
  D97C  C1            		POP	BC
  D97D  AF            		XOR	A
  D97E  C9            		RET
                      	
  D97F                	CTRL:
  D97F  CDC7D9        		CALL	KANCLR
  D982  3EA7          		LD	A,0A7H		;AND	A
  D984  324FD9        		LD	(INSFLG),A
  D987  7B            		LD	A,E
  D988  87            		ADD	A,A
  D989  6F            		LD	L,A
  D98A  26EB          		LD	H,CTRLTB/256
  D98C  7E            		LD	A,(HL)
  D98D  2C            		INC	L
  D98E  66            		LD	H,(HL)
  D98F  6F            		LD	L,A
  D990  CD0F00        		CALL	JP_HL
  D993  18E6          		JR	PRINTE5
                      	
  D995                	KANJI2:
  D995  D5            		PUSH	DE
  D996  57            		LD	D,A
  D997  01812F        		LD	BC,02F81H	;SFTJIS
  D99A  DF            		RST	018H
  D99B  01C32F        		LD	BC,02FC3H	;Instead or JISVRM
  D99E  DF            		RST	018H
                      	
  D99F  ED4B8EEC      		LD	BC,(_TXADR)
  D9A3  78            		LD	A,B
  D9A4  F638          		OR	038H
  D9A6  47            		LD	B,A
  D9A7  ED51          		OUT	(C),D		;kanji
  D9A9  CB98          		RES	3,B
  D9AB  ED59          		OUT	(C),E		;Text
  D9AD  CDE0D9        		CALL	PRINTE7
  D9B0  ED4B8EEC      		LD	BC,(_TXADR)
  D9B4  78            		LD	A,B
  D9B5  F638          		OR	038H
  D9B7  47            		LD	B,A
  D9B8  CBF2          		SET	6,D
  D9BA  ED51          		OUT	(C),D		;Kanji
  D9BC  CB98          		RES	3,B
  D9BE  ED59          		OUT	(C),E		;Text
  D9C0  D1            		POP	DE
  D9C1  AF            		XOR	A
  D9C2  3254D9        		LD	(KANFLG+1),A
  D9C5  18B1          		JR	KANJIE
                      	
  D9C7                	KANCLR:
  D9C7  3A54D9        		LD	A,(KANFLG+1)
  D9CA  B7            		OR	A
  D9CB  C8            		RET	Z
  D9CC  ED4B8EEC      		LD	BC,(_TXADR)
  D9D0  78            		LD	A,B
  D9D1  F638          		OR	038H
  D9D3  47            		LD	B,A
  D9D4  AF            		XOR	A
  D9D5  3254D9        		LD	(KANFLG+1),A
  D9D8  ED79          		OUT	(C),A		;Kanji
  D9DA  CB98          		RES	3,B
  D9DC  3E20          		LD	A,020H
  D9DE  ED79          		OUT	(C),A		;Text
  D9E0                	PRINTE7:
  D9E0  CBA0          		RES	4,B
  D9E2                	PRINTE6:
  D9E2  3A96EC        		LD	A,(_COLORF)
  D9E5                	PRINTE4:
  D9E5  ED79          		OUT	(C),A		;Color
  D9E7  78            		LD	A,B
  D9E8  E607          		AND	7
  D9EA  47            		LD	B,A
  D9EB                	PRINTE2:
  D9EB  03            		INC	BC
  D9EC                	PRINTE3:
  D9EC  2ABAEC        		LD	HL,(CRTCD+10)
  D9EF  A7            		AND	A
  D9F0  ED4A          		ADC	HL,BC
  D9F2                	PRINTE8:
  D9F2  2805          		JR	Z,PRINT2
  D9F4                	PRINTE1:
  D9F4  ED438EEC      		LD	(_TXADR),BC
  D9F8                	PRINTE:
  D9F8  C9            		RET
                      	
  D9F9                	PRINT2:
  D9F9  CDA1DB        		CALL	SCR
  D9FC  2ABCEC        		LD	HL,(CRTCD+12)
  D9FF  09            		ADD	HL,BC
  DA00  228EEC        		LD	(_TXADR),HL
  DA03  C9            		RET
                      	
  DA04                	CTRL08:
  DA04                	CTRL1D:
  DA04  ED4B8EEC      		LD	BC,(_TXADR)
  DA08  78            		LD	A,B
  DA09  B1            		OR	C
  DA0A  C8            		RET	Z
  DA0B  0B            		DEC	BC
  DA0C  18E6          		JR	PRINTE1
                      	
  DA0E                	CTRL1E:
  DA0E  ED4B8EEC      		LD	BC,(_TXADR)
  DA12  2ABCEC        		LD	HL,(CRTCD+12)
  DA15  09            		ADD	HL,BC
  DA16  D0            		RET	NC
  DA17  44            		LD	B,H
  DA18  4D            		LD	C,L
  DA19  18D9          		JR	PRINTE1
                      	
  DA1B                	CTRL1C:
  DA1B  ED4B8EEC      		LD	BC,(_TXADR)
  DA1F  18CA          		JR	PRINTE2
                      	
  DA21                	CTRL09:
  DA21  ED4B8EEC      		LD	BC,(_TXADR)
  DA25  79            		LD	A,C
  DA26  E6F8          		AND	0F8H
  DA28  C608          		ADD	A,8
  DA2A  4F            		LD	C,A
  DA2B  88            		ADC	A,B
  DA2C  91            		SUB	C
  DA2D  47            		LD	B,A
  DA2E  18BC          		JR	PRINTE3
                      	
  DA30                	CTRL02:
  DA30  2A8EEC        		LD	HL,(_TXADR)
  DA33  7C            		LD	A,H
  DA34  B5            		OR	L
  DA35  C8            		RET	Z
  DA36  2B            		DEC	HL
  DA37  228EEC        		LD	(_TXADR),HL
  DA3A  D5            		PUSH	DE
  DA3B  CDD3EC        		CALL	_POS
  DA3E  3AB1EC        		LD	A,(CRTCD+1)
  DA41  95            		SUB	L
  DA42  6F            		LD	L,A
  DA43  2D            		DEC	L
  DA44  2638          		LD	H,038H
  DA46  ED4B8EEC      		LD	BC,(_TXADR)
  DA4A  09            		ADD	HL,BC
  DA4B  44            		LD	B,H
  DA4C  4D            		LD	C,L
  DA4D  110020        		LD	DE,02000H	;D:Text E:kanji
  DA50  2A96EC        		LD	HL,(_COLORF)	;L:Color
  DA53                	C8X1:
  DA53  CD40DB        		CALL	C12S
  DA56  0B            		DEC	BC
  DA57  20FA          		JR	NZ,C8X1
  DA59  D1            		POP	DE
  DA5A  C9            		RET
                      	
  DA5B                	CTRL05:
  DA5B  CDD3EC        		CALL	_POS
  DA5E  3AB1EC        		LD	A,(CRTCD+1)
  DA61  95            		SUB	L
  DA62  6F            		LD	L,A
  DA63  2620          		LD	H,020H
  DA65  ED4B8EEC      		LD	BC,(_TXADR)
  DA69                	C05X1:
  DA69  78            		LD	A,B
  DA6A  F638          		OR	038H
  DA6C  47            		LD	B,A
                      	;	OUT	(C),0		;未定義命令ニーモニック
  DA6D  ED71          		DB	0EDH,071H	;kanji
  DA6F  CB98          		RES	3,B
  DA71  ED61          		OUT	(C),H		;Text
  DA73  CBA0          		RES	4,B
  DA75  3A96EC        		LD	A,(_COLORF)
  DA78  ED79          		OUT	(C),A		;Color
  DA7A  03            		INC	BC
  DA7B  2D            		DEC	L
  DA7C  20EB          		JR	NZ,C05X1
  DA7E  C9            		RET
                      	
  DA7F                	CTRL0D:
  DA7F  CDD3EC        		CALL	_POS
  DA82  2E00          		LD	L,0
  DA84                	LOC:
  DA84  C5            		PUSH	BC
  DA85  E5            		PUSH	HL
  DA86  CDC7D9        		CALL	KANCLR
  DA89  CDACDA        		CALL	LOC1
  DA8C  ED438EEC      		LD	(_TXADR),BC
  DA90  E1            		POP	HL
  DA91  C1            		POP	BC
  DA92  C9            		RET
                      	
  DA93                	CTRL01:
  DA93  3E37          		LD	A,037H		;SCF
  DA95  324FD9        		LD	(INSFLG),A
  DA98  C9            		RET
                      	
  DA99                	CTRL0B:
  DA99  210000        		LD	HL,0
  DA9C  228EEC        		LD	(_TXADR),HL
  DA9F  C9            		RET
                      	
  DAA0                	PRINTS:
  DAA0  CD02D8        		CALL	BREAK
  DAA3  C3CDEC        		JP	_PRINT
                      	
  DAA6                	CTRL1B:
  DAA6  3E01          		LD	A,1
  DAA8  3246D9        		LD	(ESCFLG+1),A
  DAAB  C9            		RET
                      	
  DAAC                	LOC1:
  DAAC  44            		LD	B,H
  DAAD  4D            		LD	C,L
  DAAE  04            		INC	B
  DAAF  05            		DEC	B
  DAB0  C8            		RET	Z
  DAB1  D5            		PUSH	DE
  DAB2  ED5BB1EC      		LD	DE,(CRTCD+1)
  DAB6  210000        		LD	HL,0
  DAB9  55            		LD	D,L
  DABA                	LOC2:
  DABA  19            		ADD	HL,DE
  DABB  10FD          		DJNZ	LOC2
  DABD  09            		ADD	HL,BC
  DABE  D1            		POP	DE
  DABF                	LOC3:
  DABF  44            		LD	B,H
  DAC0  4D            		LD	C,L
  DAC1  C9            		RET
                      	
  DAC2                	CONOUT1:
  DAC2  CDD4DA        		CALL	CURSOR
  DAC5  59            		LD	E,C
  DAC6  CDCDEC        		CALL	_PRINT
  DAC9  7B            		LD	A,E
  DACA  FE0A          		CP	00AH
  DACC  2006          		JR	NZ,CURSOR
  DACE  CD7FDA        		CALL	CTRL0D
  DAD1  CD5BDA        		CALL	CTRL05
  DAD4                	CURSOR:
  DAD4  C5            		PUSH	BC
  DAD5  ED4B8EEC      		LD	BC,(_TXADR)
  DAD9  CBE8          		SET	5,B
  DADB  ED78          		IN	A,(C)
  DADD  EE18          		XOR	018H
  DADF  ED79          		OUT	(C),A
  DAE1  C1            		POP	BC
  DAE2  C9            		RET
                      	
  DAE3                	CTRL07:
  DAE3  21E4EB        		LD	HL,BEEPD
  DAE6                	BEEP1:
  DAE6  7E            		LD	A,(HL)
  DAE7  23            		INC	HL
  DAE8  FEFF          		CP	0FFH
  DAEA  C8            		RET	Z
  DAEB  F3            		DI
  DAEC  061C          		LD	B,01CH
  DAEE  ED79          		OUT	(C),A
  DAF0  EDA3          		OUTI
  DAF2  FB            		EI
  DAF3  18F1          		JR	BEEP1
                      	
  DAF5                	OT49SB:
  DAF5  C5            		PUSH	BC
  DAF6  CD11DB        		CALL	CANW
  DAF9  010019        		LD	BC,01900H
  DAFC  ED79          		OUT	(C),A
  DAFE  C1            		POP	BC
  DAFF  C9            		RET
                      	
  DB00                	IN49SB:
  DB00  C5            		PUSH	BC
  DB01  01011A        		LD	BC,01A01H
  DB04                	CANR:
  DB04  ED78          		IN	A,(C)
  DB06  E620          		AND	020H
  DB08  20FA          		JR	NZ,CANR
  DB0A  010019        		LD	BC,01900H
  DB0D  ED78          		IN	A,(C)
  DB0F  C1            		POP	BC
  DB10  C9            		RET
                      	
  DB11                	CANW:
  DB11  01011A        		LD	BC,01A01H
  DB14  ED48          		IN	C,(C)
  DB16  CB71          		BIT	6,C
  DB18  20F7          		JR	NZ,CANW
  DB1A  C9            		RET
                      	
  DB1B                	COMOUT:
  DB1B  FB            		EI
  DB1C  CDF5DA        		CALL	OT49SB
  DB1F  CD11DB        		CALL	CANW
  DB22  F3            		DI
  DB23  C9            		RET
                      	
  DB24                	CTRL12:
  DB24  D5            		PUSH	DE
  DB25  CDD3EC        		CALL	_POS
  DB28  3AB1EC        		LD	A,(CRTCD+1)
  DB2B  95            		SUB	L
  DB2C  ED4B8EEC      		LD	BC,(_TXADR)
  DB30  110020        		LD	DE,02000H	;D:Text E:Kanji
  DB33  2A96EC        		LD	HL,(_COLORF)	;L:Color
  DB36  CBE8          		SET	5,B
  DB38                	C12X1:
  DB38  CD40DB        		CALL	C12S
  DB3B  03            		INC	BC
  DB3C  20FA          		JR	NZ,C12X1
  DB3E  D1            		POP	DE
  DB3F  C9            		RET
                      	
  DB40                	C12S:
  DB40  CBE0          		SET	4,B
  DB42  CBD8          		SET	3,B
  DB44  ED60          		IN	H,(C)
  DB46  ED59          	X1PAT:	OUT	(C),E
  DB48  5C            		LD	E,H
  DB49  CB98          		RES	3,B
  DB4B  ED60          		IN	H,(C)
  DB4D  ED51          		OUT	(C),D
  DB4F  54            		LD	D,H
  DB50  CBA0          		RES	4,B
  DB52  ED60          		IN	H,(C)
  DB54  ED69          		OUT	(C),L
  DB56  6C            		LD	L,H
  DB57  3D            		DEC	A
  DB58  C9            		RET
                      	
  DB59                	CTRL0C:
  DB59  CD99DA        		CALL	CTRL0B
  DB5C                	CTRL1A:
  DB5C  ED4B8EEC      		LD	BC,(_TXADR)
  DB60                	C1AX1:
  DB60  78            		LD	A,B
  DB61  F638          		OR	038H
  DB63  47            		LD	B,A
                      	;	OUT	(C),0		;未定義命令ニーモニック
  DB64  ED71          		DB	0EDH,071H	;kanji
  DB66  CB98          		RES	3,B
  DB68  3E20          		LD	A,020H
  DB6A  ED79          		OUT	(C),A		;Text
  DB6C  CBA0          		RES	4,B
  DB6E  3A96EC        		LD	A,(_COLORF)
  DB71  ED79          		OUT	(C),A		;Color
  DB73  03            		INC	BC
  DB74  CBA8          		RES	5,B
  DB76  2ABAEC        		LD	HL,(CRTCD+10)
  DB79  09            		ADD	HL,BC
  DB7A  30E4          		JR	NC,C1AX1
  DB7C  C9            		RET
                      	
  DB7D                	CTRL04:
  DB7D  CDD3EC        		CALL	_POS
  DB80  7D            		LD	A,L
  DB81  B7            		OR	A
  DB82  C8            		RET	Z
  DB83                	CTRL03:
  DB83  CD7FDA        		CALL	CTRL0D
  DB86                	CTRL0A:
  DB86                	CTRL1F:
  DB86  ED4B8EEC      		LD	BC,(_TXADR)
  DB8A  2AB1EC        		LD	HL,(CRTCD+1)
  DB8D  2600          		LD	H,0
  DB8F  09            		ADD	HL,BC
  DB90  44            		LD	B,H
  DB91  4D            		LD	C,L
  DB92  2ABAEC        		LD	HL,(CRTCD+10)
  DB95  09            		ADD	HL,BC
  DB96  3F            		CCF
  DB97  9F            		SBC	A,A
  DB98  C3F2D9        		JP	PRINTE8
                      	
  DB9B                	CTRL0E:
  DB9B  CDD3EC        		CALL	_POS
  DB9E  7C            		LD	A,H
  DB9F  1804          		JR	SCR1
  DBA1                	SCR:
  DBA1  3A97EC        		LD	A,(_LINE)
  DBA4  3D            		DEC	A
  DBA5                	SCR1:
  DBA5  C5            		PUSH	BC
  DBA6  D5            		PUSH	DE
  DBA7  01801F        		LD	BC,01F80H	;DMA
  DBAA  1EC3          		LD	E,0C3H
  DBAC  ED59          		OUT	(C),E
  DBAE  119A65        		LD	DE,0659AH
  DBB1  ED59          		OUT	(C),E
  DBB3  ED51          		OUT	(C),D
  DBB5  114F00        		LD	DE,79
  DBB8  ED59          		OUT	(C),E
  DBBA  ED51          		OUT	(C),D
                      	
  DBBC  210038        		LD	HL,03800H
  DBBF  11181C        		LD	DE,01C18H
  DBC2  ED51          		OUT	(C),D
  DBC4  ED59          		OUT	(C),E
                      	
  DBC6                	SCRUP1:
  DBC6  B7            		OR	A
  DBC7  2839          		JR	Z,SCRCL
  DBC9  F5            		PUSH	AF
  DBCA  CDE3DB        		CALL	UPSUB		;kanji
  DBCD  ED5BBCEC      		LD	DE,(CRTCD+12)
  DBD1  16F7          		LD	D,0F7H
  DBD3  19            		ADD	HL,DE
  DBD4  D5            		PUSH	DE
  DBD5  CDE3DB        		CALL	UPSUB		;Text
  DBD8  D1            		POP	DE
  DBD9  19            		ADD	HL,DE
  DBDA  CDE3DB        		CALL	UPSUB		;Color
  DBDD  CBE4          		SET	4,H
  DBDF  F1            		POP	AF
  DBE0  3D            		DEC	A
  DBE1  18E3          		JR	SCRUP1
                      	
  DBE3                	UPSUB:
  DBE3  ED5BB1EC      		LD	DE,(CRTCD+1)
  DBE7  1600          		LD	D,0
  DBE9  3ECD          		LD	A,0CDH
  DBEB  ED79          		OUT	(C),A
  DBED  ED69          		OUT	(C),L		;SOURCE
  DBEF  ED61          		OUT	(C),H
  DBF1  19            		ADD	HL,DE
  DBF2  3E1D          		LD	A,01DH
  DBF4  ED79          		OUT	(C),A		;DEST
  DBF6  ED69          		OUT	(C),L
  DBF8  ED61          		OUT	(C),H
  DBFA  1187CF        		LD	DE,0CF87H
  DBFD  ED51          		OUT	(C),D
  DBFF  ED59          		OUT	(C),E
  DC01  C9            		RET
                      	
  DC02                	SCRCL:
  DC02  44            		LD	B,H
  DC03  4D            		LD	C,L
  DC04  215020        		LD	HL,02000H+80
  DC07  3A96EC        		LD	A,(_COLORF)
  DC0A                	SCRCL1:
                      	;	OUT	(C),0		;未定義命令ニーモニック
  DC0A  ED71          		DB	0EDH,071H
  DC0C  CB98          		RES	3,B
  DC0E  ED61          		OUT	(C),H
  DC10  CBA0          		RES	4,B
  DC12  ED79          		OUT	(C),A
  DC14  CBD8          		SET	3,B
  DC16  CBE0          		SET	4,B
  DC18  03            		INC	BC
  DC19  2D            		DEC	L
  DC1A  20EE          		JR	NZ,SCRCL1
  DC1C  D1            		POP	DE
  DC1D  C1            		POP	BC
  DC1E  C9            		RET
                      	
  DC1F                	SCRN:
  DC1F  D5            		PUSH	DE
  DC20  ED58          		IN	E,(C)		;Text
  DC22  CBD8          		SET	3,B
  DC24  ED50          		IN	D,(C)		;Kanji
  DC26  2819          		JR	Z,SCRNE
  DC28  AF            		XOR	A
  DC29  C5            		PUSH	BC
  DC2A  013730        		LD	BC,03037H	;VRMJIS
  DC2D  DF            		RST	018H
  DC2E  01522F        		LD	BC,02F52H	;JISSFT
  DC31  DF            		RST	018H
  DC32  C1            		POP	BC
  DC33  ED78          		IN	A,(C)
  DC35  CB98          		RES	3,B
  DC37  E640          		AND	040H
  DC39  2003          		JR	NZ,SCRN1
  DC3B  7A            		LD	A,D
  DC3C  D1            		POP	DE
  DC3D  C9            		RET
  DC3E                	SCRN1:
  DC3E  7B            		LD	A,E
  DC3F  D1            		POP	DE
  DC40  C9            		RET
                      	
  DC41                	SCRNE:
  DC41  D1            		POP	DE
  DC42  CB98          		RES	3,B
  DC44                	SCRNX:
  DC44  ED78          		IN	A,(C)
  DC46  C9            		RET
                      	
  DC47                	POS:
  DC47  2A8EEC        		LD	HL,(_TXADR)
  DC4A  C5            		PUSH	BC
  DC4B  ED4BBCEC      		LD	BC,(CRTCD+12)
  DC4F  AF            		XOR	A
  DC50                	POS1:
  DC50  09            		ADD	HL,BC
  DC51  3C            		INC	A
  DC52  38FC          		JR	C,POS1
  DC54  ED42          		SBC	HL,BC
  DC56  3D            		DEC	A
  DC57  67            		LD	H,A
  DC58  C1            		POP	BC
  DC59  A7            		AND	A
  DC5A  C9            		RET
                      	
  DC5B                	GETL:
  DC5B  CDD3EC        		CALL	_POS
  DC5E  E5            		PUSH	HL
  DC5F                	GETL1:
  DC5F  CDD3EC        		CALL	_POS
  DC62  C1            		POP	BC
  DC63  C5            		PUSH	BC
  DC64  7D            		LD	A,L
  DC65  91            		SUB	C
  DC66  69            		LD	L,C
  DC67  4F            		LD	C,A
  DC68  DCD6EC        		CALL	C,_LOC
  DC6B                	GET1W:
  DC6B  CDFDD7        		CALL	_SYS08
  DC6E  FE08          		CP	8
  DC70  2007          		JR	NZ,GETL1X
  DC72  0D            		DEC	C
  DC73  CB79          		BIT	7,C
  DC75  2002          		JR	NZ,GETL1X
  DC77  3E02          		LD	A,2
  DC79                	GETL1X:
  DC79  FE1B          		CP	01BH
  DC7B  2016          		JR	NZ,GETL1V
  DC7D  CDFDD7        		CALL	_SYS08
  DC80  FE22          		CP	022H
  DC82  2008          		JR	NZ,GETL1Y
  DC84  2100FF        		LD	HL,KBUF
  DC87  CDCBD8        		CALL	MSX
  DC8A  180E          		JR	GETL1Z
  DC8C                	GETL1Y:
  DC8C  F5            		PUSH	AF
  DC8D  1E1B          		LD	E,01BH
  DC8F  CDCDEC        		CALL	_PRINT
  DC92  F1            		POP	AF
  DC93                	GETL1V:
  DC93  5F            		LD	E,A
  DC94  CD93DA        		CALL	CTRL01
  DC97  CDCDEC        		CALL	_PRINT
  DC9A                	GETL1Z:
  DC9A  7B            		LD	A,E
  DC9B  FE0D          		CP	00DH
  DC9D  20C0          		JR	NZ,GETL1
                      	
  DC9F  2100FF        		LD	HL,KBUF
  DCA2  AF            		XOR	A
  DCA3  ED4BB0EC      		LD	BC,(CRTCD)
  DCA7                	GETL0:
  DCA7  77            		LD	(HL),A
  DCA8  23            		INC	HL
  DCA9  10FC          		DJNZ	GETL0
                      	
  DCAB  D1            		POP	DE
  DCAC  CDD3EC        		CALL	_POS
  DCAF  6B            		LD	L,E
  DCB0  3AB1EC        		LD	A,(CRTCD+1)
  DCB3  95            		SUB	L
  DCB4  57            		LD	D,A
  DCB5  CDACDA        		CALL	LOC1
  DCB8  78            		LD	A,B
  DCB9  F630          		OR	030H
  DCBB  47            		LD	B,A
  DCBC  5A            		LD	E,D
  DCBD  2100FF        		LD	HL,KBUF
  DCC0                	GETL2:
  DCC0  CDD0EC        		CALL	_SCRN
  DCC3  03            		INC	BC
  DCC4  77            		LD	(HL),A
  DCC5  23            		INC	HL
  DCC6  1D            		DEC	E
  DCC7  20F7          		JR	NZ,GETL2
  DCC9                	GETL3:
  DCC9  2B            		DEC	HL
  DCCA  7E            		LD	A,(HL)
  DCCB  FE21          		CP	021H
  DCCD  D0            		RET	NC
  DCCE  3600          		LD	(HL),0
  DCD0  15            		DEC	D
  DCD1  20F6          		JR	NZ,GETL3
  DCD3  C9            		RET
                      	
  DCD4                	INKEY:
  DCD4  FB            		EI
  DCD5  E5            		PUSH	HL
  DCD6  2A90EC        		LD	HL,(_KEYPS)
  DCD9  7C            		LD	A,H
  DCDA  AD            		XOR	L
  DCDB  2809          		JR	Z,INKEY1
  DCDD  7C            		LD	A,H
  DCDE  3C            		INC	A
  DCDF  3291EC        		LD	(_KEYPS+1),A
  DCE2  6F            		LD	L,A
  DCE3  26FE          		LD	H,KEYBF/256
  DCE5  7E            		LD	A,(HL)
  DCE6                	INKEY1:
  DCE6  E1            		POP	HL
  DCE7  B7            		OR	A
  DCE8  C9            		RET
                      	
  1188                	AT_RS	EQU	SCR1-AT_SCR1
                      	
                      	;LDFILE.ASM
                      	
                      	;	LSX-Dodgers FILE
                      	
  DCE9                	FILEC:
  DCE9  CDF4DC        		CALL	FILE
  DCEC                	FILEC2:
  DCEC  3ADC00        		LD	A,(FDRV+1)
  DCEF  FE20          		CP	020H
  DCF1  C8            		RET	Z
  DCF2  183B          		JR	SETDIR1
                      	
  DCF4                	FILE:
  DCF4  AF            		XOR	A
  DCF5  32DB00        		LD	(FDRV),A
  DCF8  67            		LD	H,A
  DCF9  6F            		LD	L,A
  DCFA  22E900        		LD	(FDRV+14),HL
  DCFD  CDCEDD        		CALL	SPCUT
  DD00  CDB3DD        		CALL	CCHK3
  DD03  2812          		JR	Z,DEVI1
  DD05  13            		INC	DE
  DD06  1A            		LD	A,(DE)
  DD07  1B            		DEC	DE
  DD08  FE3A          		CP	':'
  DD0A  200B          		JR	NZ,DEVI1
  DD0C  1A            		LD	A,(DE)		;DRIVE
  DD0D  CDE7DF        		CALL	CAP
  DD10  D640          		SUB	'@'
  DD12  13            		INC	DE
  DD13  13            		INC	DE
  DD14  32DB00        		LD	(FDRV),A
  DD17                	DEVI1:
  DD17  1A            		LD	A,(DE)
  DD18  D65C          		SUB	05CH
  DD1A  200B          		JR	NZ,NOROOT
  DD1C  210000        		LD	HL,0
  DD1F  22F500        		LD	(FDRV+26),HL
  DD22  2C            		INC	L
  DD23  22E900        		LD	(FDRV+14),HL
  DD26  13            		INC	DE
  DD27                	NOROOT:
                      	
  DD27                	SETDIR:
  DD27  CD53DD        		CALL	FILED
  DD2A  1A            		LD	A,(DE)
  DD2B  FE5C          		CP	05CH
  DD2D  C0            		RET	NZ
  DD2E  13            		INC	DE
  DD2F                	SETDIR1:
  DD2F  3E10          		LD	A,010H		;Directory
  DD31  32E800        		LD	(FDRV+13),A
  DD34  D5            		PUSH	DE
  DD35  11DB00        		LD	DE,FDRV
  DD38  2A1EEC        		LD	HL,(STABLE+2*00FH)
  DD3B  CD0F00        		CALL	JP_HL
  DD3E  D1            		POP	DE
  DD3F  B7            		OR	A
  DD40  C0            		RET	NZ
                      	
  DD41  3AE800        		LD	A,(FDRV+13)
  DD44  CB67          		BIT	4,A
  DD46  C8            		RET	Z
                      	
  DD47  CD9ADD        		CALL	FILEI
  DD4A  2AF500        		LD	HL,(FDRV+26)
  DD4D  23            		INC	HL
  DD4E  22E900        		LD	(FDRV+14),HL
  DD51  18D4          		JR	SETDIR
                      	
  DD53                	FILED:
  DD53  CD9ADD        		CALL	FILEI
                      	
  DD56  0608          		LD	B,8
  DD58                	FILE2:
  DD58  CDA8DD        		CALL	CCHKF
  DD5B  C8            		RET	Z
  DD5C  FE2A          		CP	'*'
  DD5E  282E          		JR	Z,FILE9
  DD60  FE2E          		CP	'.'
  DD62  280C          		JR	Z,FILE4
  DD64  77            		LD	(HL),A
  DD65  23            		INC	HL
  DD66  10F0          		DJNZ	FILE2
                      	
  DD68                	FILE3:
  DD68  CDA8DD        		CALL	CCHKF
  DD6B  C8            		RET	Z
  DD6C  FE2E          		CP	'.'
  DD6E  20F8          		JR	NZ,FILE3
                      	
  DD70                	FILE4:
  DD70  21E400        		LD	HL,FNAME+8
  DD73  0603          		LD	B,3
                      	
  DD75                	FILE4L:
  DD75  CDA8DD        		CALL	CCHKF
  DD78  C8            		RET	Z
  DD79  FE2E          		CP	'.'
  DD7B  2008          		JR	NZ,FILE12
  DD7D  32DC00        		LD	(FNAME),A	;Parent directory(..)
  DD80  32DD00        		LD	(FNAME+1),A
  DD83  3E20          		LD	A,020H
  DD85                	FILE12:
  DD85  FE2A          		CP	'*'
  DD87  280A          		JR	Z,FILE10
  DD89  77            		LD	(HL),A
  DD8A  23            		INC	HL
  DD8B  10E8          		DJNZ	FILE4L
  DD8D  C9            		RET
                      	
  DD8E                	FILE9:
  DD8E  CD93DD        		CALL	FILE10
  DD91  18D5          		JR	FILE3
                      	
  DD93                	FILE10:
  DD93  3E3F          		LD	A,'?'
                      	
  DD95                	FILE7:
  DD95  77            		LD	(HL),A
  DD96  23            		INC	HL
  DD97  10FC          		DJNZ	FILE7
  DD99  C9            		RET
                      	
  DD9A                	FILEI:
  DD9A  3E20          		LD	A,020H
  DD9C  01000B        		LD	BC,11*256
  DD9F  21DC00        		LD	HL,FNAME
  DDA2  E5            		PUSH	HL
  DDA3  CD95DD        		CALL	FILE7
  DDA6  E1            		POP	HL
  DDA7  C9            		RET
                      	
  DDA8                	CCHKF:
  DDA8  1A            		LD	A,(DE)
  DDA9  CDB0DD        		CALL	CCHK2
  DDAC  C8            		RET	Z
  DDAD  C3F9E0        		JP	FKAN
                      	
  DDB0                	CCHK2:
  DDB0  0C            		INC	C
  DDB1  0D            		DEC	C
  DDB2  C0            		RET	NZ
  DDB3                	CCHK3:
  DDB3  FE2B          		CP	'+'
  DDB5  C8            		RET	Z
  DDB6  FE2C          		CP	','
  DDB8  C8            		RET	Z
  DDB9  FE2F          		CP	'/'
  DDBB  C8            		RET	Z
  DDBC  FE3A          		CP	':'
  DDBE  C8            		RET	Z
  DDBF  FE3B          		CP	';'
  DDC1  C8            		RET	Z
  DDC2  FE3D          		CP	'='
  DDC4  C8            		RET	Z
  DDC5  FE5C          		CP	05CH
  DDC7  C8            		RET	Z
  DDC8  FE20          		CP	020H
  DDCA  D0            		RET	NC
  DDCB  BF            		CP	A		;Z=1
  DDCC  C9            		RET
                      	
  DDCD                	SS1:
  DDCD  13            		INC	DE
  DDCE                	SPCUT:
  DDCE  1A            		LD	A,(DE)
  DDCF  FE20          		CP	020H
  DDD1  28FA          		JR	Z,SS1
  DDD3  C9            		RET
                      	
  DDD4                	SETDRVF:
  DDD4  11DB00        		LD	DE,FDRV
  DDD7                	SETDRV0:
  DDD7  CDE0DD        		CALL	SETDRV
  DDDA  FDE1          		POP	IY
  DDDC  C1            		POP	BC
  DDDD  D1            		POP	DE
  DDDE  E1            		POP	HL
  DDDF  C9            		RET
                      	
  DDE0                	SETDRV:
  DDE0  E3            		EX	(SP),HL		;HL=RETRN ADDRESS
  DDE1  D5            		PUSH	DE		;PUSH HL/DE/BC/IY
  DDE2  C5            		PUSH	BC
  DDE3  1A            		LD	A,(DE)
  DDE4  D5            		PUSH	DE
  DDE5  FDE3          		EX	(SP),IY
                      	
  DDE7  CDF3DD        		CALL	GETDRV
  DDEA  3C            		INC	A
  DDEB  FD7700        		LD	(IY+0),A	;(FCB)ドライブ番号
  DDEE  3D            		DEC	A
  DDEF  CDD9EC        		CALL	_CHGDRV
                      	
  DDF2  E9            		JP	(HL)
                      	
  DDF3                	GETDRV:
  DDF3  E67F          		AND	07FH
  DDF5  D601          		SUB	001H
  DDF7  3003          		JR	NC,GETDRV1
  DDF9  3A87EC        		LD	A,(_DVSW)	;Current Drive
  DDFC                	GETDRV1:
  DDFC  3288EC        		LD	(_DRV),A
  DDFF  C9            		RET
                      	
  DE00                	SOPENX:
  DE00  CD76DF        		CALL	CHKDDX
  DE03  3802          		JR	C,SOPENX1
  DE05  C1            		POP	BC
  DE06  E9            		JP	(HL)
  DE07                	SOPENX1:
  DE07  11B4E2        		LD	DE,SFILE
  DE0A  1A            		LD	A,(DE)
  DE0B  FDBE00        		CP	(IY+0)		;(FCB)ドライブ番号
  DE0E  2024          		JR	NZ,SOPEN
  DE10  13            		INC	DE
  DE11  FDE5          		PUSH	IY
  DE13  E1            		POP	HL
  DE14  23            		INC	HL
  DE15  CDA6DF        		CALL	CPFILE
  DE18  201A          		JR	NZ,SOPEN
                      	
  DE1A  2AF4EB        		LD	HL,(SCDIR)
  DE1D  FD750E        		LD	(IY+14),L	;(FCB)アクセスするディレクトリのクラスタ番号+1
  DE20  FD740F        		LD	(IY+15),H
                      	
  DE23  2AF8EB        		LD	HL,(SFNDF)	;Direcroty location and Flags
  DE26  229FEC        		LD	(_FILEN),HL
                      	
  DE29  ED5BF6EB      		LD	DE,(SFBPS)
  DE2D  21B4E2        		LD	HL,SFILE
  DE30  36FF          		LD	(HL),0FFH
  DE32  23            		INC	HL
  DE33  C9            		RET
  DE34                	SOPEN:
  DE34  213EDF        		LD	HL,FILESE
  DE37                	SOPENC:
  DE37  2274DE        		LD	(OPENPAT+1),HL
                      	
  DE3A  CDE2EC        		CALL	_RDFATX		;Detect Media
  DE3D  3856          		JR	C,RDDERR
                      	
  DE3F  AF            		XOR	A
  DE40  329FEC        		LD	(_FILEN),A
  DE43                	SOPEN0:
  DE43  CD23E0        		CALL	LDDIRX
  DE46  281C          		JR	Z,SDIRX1
                      	
  DE48  CDCBE6        		CALL	MULSPC
  DE4B  CD2FDF        		CALL	DC		;Sub Directory
  DE4E  3808          		JR	C,SDIRX0
  DE50  2A7EEC        		LD	HL,(_DTBUF)
  DE53  7E            		LD	A,(HL)
  DE54  FE2E          		CP	'.'
  DE56  2810          		JR	Z,SOPEN1
  DE58                	SDIRX0:
  DE58  AF            		XOR	A
  DE59  32A0EC        		LD	(_DIRF),A
  DE5C  FD360E01      		LD	(IY+14),1	;(FCB)レコード・サイズ
  DE60  FD360F00      		LD	(IY+15),0
  DE64                	SDIRX1:
  DE64  ED5BFCEB      		LD	DE,(_DIRPS)	;Root Directory
                      	
  DE68                	SOPEN1:
  DE68  0E20          	IBM1:	LD	C,32		;自己書き換え 1セクタ辺りのディレクトリエントリ数  1024=32 / 512=16
  DE6A                	SOPEN1X:
  DE6A  CD2FDF        		CALL	DC		;FILE SEARCH
  DE6D  3826          		JR	C,RDDERR
  DE6F  2A7EEC        		LD	HL,(_DTBUF)
  DE72                	SOPEN2:
  DE72  D5            		PUSH	DE
  DE73  CD3EDF        	OPENPAT:CALL	FILESE		;(Self-rewriting)
  DE76  D1            		POP	DE
  DE77  3864          		JR	C,SOPENE
  DE79  2817          		JR	Z,NOTSE
  DE7B                	SOPEN3:
  DE7B  3AA0EC        		LD	A,(_DIRF)
  DE7E  B7            		OR	A
  DE7F  2008          		JR	NZ,SOPEN5
  DE81  1C            		INC	E		;ルートディレクトリ
  DE82  7B            		LD	A,E
  DE83  D60C          	RTEPAT:	SUB	12		;(Self-rewriting)DPB_0B_MAXDIR
  DE85  20E1          		JR	NZ,SOPEN1
  DE87  1807          		JR	SOPEN6
  DE89                	SOPEN5:
  DE89  CDBDE6        		CALL	GNCLX	;END DIR
  DE8C  D8            		RET	C
  DE8D  CDDFDF        		CALL	ENDCL
  DE90                	SOPEN6:
  DE90  38D6          		JR	C,SOPEN1
                      	
  DE92                	_SYS2B:		;(BDOS)日付の設定
  DE92                	_SYS2D:		;(BDOS)時刻の設定
  DE92                	NOTSE:
  DE92  37            		SCF			;CF=1
  DE93  9F            		SBC	A,A		;A=0FFH
  DE94  C9            		RET
                      	
  DE95                	RDDERR:
  DE95  BF            		CP	A		;READ ERR CF=1 ZF=1
  DE96  37            		SCF
  DE97  C9            		RET
                      	
  DE98                	NOPEN:
  DE98  213EDF        		LD	HL,FILESE
  DE9B  2274DE        		LD	(OPENPAT+1),HL
  DE9E  FD2A98EC      		LD	IY,(_FCB)
  DEA2  CD0CE1        		CALL	CHKWILDX
  DEA5  30EB          		JR	NC,NOTSE
  DEA7  FD7E00        		LD	A,(IY+0)	;(FCB)ドライブ番号
  DEAA  3D            		DEC	A
  DEAB  3288EC        		LD	(_DRV),A
  DEAE  CDD9EC        		CALL	_CHGDRV
  DEB1  D8            		RET	C
                      	
  DEB2  CD23E0        		CALL	LDDIRX
  DEB5  ED5B9AEC      		LD	DE,(_FBPS)
  DEB9  CD2FDF        		CALL	DC
  DEBC  38D7          		JR	C,RDDERR
  DEBE  3A9EEC        		LD	A,(_FBCNT)
  DEC1  3D            		DEC	A
  DEC2  28B7          		JR	Z,SOPEN3
  DEC4                	NOPEN2:
  DEC4  2A9CEC        		LD	HL,(_FBAD)
  DEC7  012000        		LD	BC,020H
  DECA  09            		ADD	HL,BC
  DECB  4F            		LD	C,A
  DECC  18A4          		JR	SOPEN2
                      	
  DECE                	SOPENE2:
  DECE  229CEC        		LD	(_FBAD),HL
  DED1  79            		LD	A,C
  DED2  329EEC        		LD	(_FBCNT),A
  DED5  ED539AEC      		LD	(_FBPS),DE
  DED9  FD2298EC      		LD	(_FCB),IY
  DEDD                	SOPENE:
  DEDD  AF            		XOR	A
  DEDE  C9            		RET
                      	
  DEDF                	COPEN:
  DEDF  FD360D20      		LD	(IY+13),020H	;(FCB)属性(アトリビュート)
                      	
  DEE3  215BDF        		LD	HL,NEXTSE
  DEE6  CD37DE        		CALL	SOPENC
  DEE9  D0            		RET	NC
  DEEA  C8            		RET	Z
  DEEB  3AA0EC        		LD	A,(_DIRF)
  DEEE  D601          		SUB	001H
  DEF0  D8            		RET	C
  DEF1  0601          		LD	B,1
  DEF3  CD5EE1        		CALL	WRDF
  DEF6  D8            		RET	C
  DEF7  ED5BFEEB      		LD	DE,(_CLPS)
  DEFB  D5            		PUSH	DE
  DEFC  CDCFDF        		CALL	DCPAT
  DEFF  CDA9E5        		CALL	DRDNX
  DF02  2A7EEC        		LD	HL,(_DTBUF)	;ディレクトリエントリを0クリア
  DF05  5D            		LD	E,L
  DF06  54            		LD	D,H
  DF07  13            		INC	DE		;DE,DTBUF+1
  DF08  01FF03        	SECSZM1:LD	BC,003FFH	;自己書き換え セクタサイズ-1(0x3FF:1023 or 0x1FF:511)
  DF0B  AF            		XOR	A		;データバッファをセクタサイズ分ゼロクリア
  DF0C  77            		LD	(HL),A
  DF0D  EDB0          		LDIR
                      	
  DF0F  3AA0EC        		LD	A,(_DIRF)
  DF12  B7            		OR	A
  DF13  2815          		JR	Z,COPENE	;ルートディレクトリ
                      	
  DF15  D1            		POP	DE		;DE=(_CLPS)
  DF16  D5            		PUSH	DE
  DF17  3ACEE6        		LD	A,(SPCPAT+1)	;1クラスタの論理セクタ数
  DF1A                	COPEN1:
  DF1A  3D            		DEC	A
  DF1B  280D          		JR	Z,COPENE	;1セクタ辺りのセクタ数が2以上の場合
  DF1D  F5            		PUSH	AF		;データバッファに入らないセクタもゼロクリア
  DF1E  13            		INC	DE
  DF1F  D5            		PUSH	DE
  DF20  CDCFDF        		CALL	DCPAT
  DF23  CD1CE8        		CALL	DWT_DPB
  DF26  D1            		POP	DE
  DF27  F1            		POP	AF
  DF28  18F0          		JR	COPEN1
  DF2A                	COPENE:
  DF2A  2A7EEC        		LD	HL,(_DTBUF)
  DF2D  D1            		POP	DE
  DF2E  C9            		RET
                      	
  DF2F                	DC:
  DF2F  ED53FEEB      		LD	(_CLPS),DE
  DF33  C5            		PUSH	BC
  DF34  D5            		PUSH	DE
  DF35  CDCFDF        		CALL	DCPAT
  DF38  CD8DE5        		CALL	DRDX
  DF3B  D1            		POP	DE
  DF3C  C1            		POP	BC
  DF3D  C9            		RET
                      	
  DF3E                	FILESE:
  DF3E  7E            		LD	A,(HL)
  DF3F  B7            		OR	A
  DF40  C8            		RET	Z		;END:ZF=1 CF=0
  DF41  FEE5          		CP	0E5H
  DF43  280E          		JR	Z,FILESE1
  DF45  FDE5          		PUSH	IY
  DF47  D1            		POP	DE
  DF48  13            		INC	DE
  DF49  E5            		PUSH	HL
  DF4A  CDA6DF        		CALL	CPFILE
  DF4D  CCC7DF        		CALL	Z,CPFILE2
  DF50  E1            		POP	HL
  DF51  37            		SCF
  DF52  C8            		RET	Z		;!!!:(ZF=1) CF=1
  DF53                	FILESE1:
  DF53  CD6ADF        		CALL	FNEXT
  DF56  20E6          		JR	NZ,FILESE
  DF58                	ZFCF0:
  DF58  F6FF          		OR	0FFH		;ZF=0 CF=0
  DF5A  C9            		RET
                      	
  DF5B                	NEXTSE:
  DF5B  7E            		LD	A,(HL)
  DF5C  B7            		OR	A
  DF5D  37            		SCF
  DF5E  C8            		RET	Z		;!!!:ZF=1 CF=1
  DF5F  FEE5          		CP	0E5H
  DF61  37            		SCF
  DF62  C8            		RET	Z		;!!!:(ZF=1) CF=1
  DF63  CD6ADF        		CALL	FNEXT
  DF66  20F3          		JR	NZ,NEXTSE
  DF68  18EE          		JR	ZFCF0
                      	
  DF6A                	FNEXT:
  DF6A  E5            		PUSH	HL
  DF6B  219FEC        		LD	HL,_FILEN
  DF6E  34            		INC	(HL)
  DF6F  E1            		POP	HL
  DF70  112000        		LD	DE,020H
  DF73  19            		ADD	HL,DE
  DF74  0D            		DEC	C
  DF75  C9            		RET
                      	
  DF76                	CHKDDX:
  DF76  CD0CE1        		CALL	CHKWILDX
  DF79  D8            		RET	C
  DF7A  FDE5          		PUSH	IY
  DF7C  D1            		POP	DE
  DF7D  13            		INC	DE
  DF7E  2162EC        		LD	HL,DDTB
  DF81  0604          		LD	B,DDS
  DF83                	CPNAME:
  DF83  C5            		PUSH	BC
  DF84  D5            		PUSH	DE
  DF85  1182E5        		LD	DE,CPBUF
  DF88  010400        		LD	BC,4
  DF8B  EDB0          		LDIR
  DF8D  D1            		POP	DE
  DF8E  D5            		PUSH	DE
  DF8F  E5            		PUSH	HL
  DF90  2182E5        		LD	HL,CPBUF
  DF93  CDA6DF        		CALL	CPFILE
  DF96  E1            		POP	HL
  DF97  D1            		POP	DE
  DF98  C1            		POP	BC
  DF99  2005          		JR	NZ,CPNAME1
  DF9B  7E            		LD	A,(HL)
  DF9C  23            		INC	HL
  DF9D  66            		LD	H,(HL)
  DF9E  6F            		LD	L,A
  DF9F  C9            		RET
  DFA0                	CPNAME1:
  DFA0  23            		INC	HL
  DFA1  23            		INC	HL
  DFA2  10DF          		DJNZ	CPNAME
  DFA4  37            		SCF
  DFA5  C9            		RET
                      	
  DFA6                	CPFILE:
  DFA6  C5            		PUSH	BC
  DFA7  01000B        		LD	BC,00B00H
  DFAA                	CPSTR1:
  DFAA  1A            		LD	A,(DE)
  DFAB  FE3F          		CP	'?'		;Wild card
  DFAD  2812          		JR	Z,CPSTR2
  DFAF  7E            		LD	A,(HL)
  DFB0  CDF2E0        		CALL	FKANC
  DFB3  E5            		PUSH	HL
  DFB4  67            		LD	H,A
  DFB5  1A            		LD	A,(DE)
  DFB6  CB01          		RLC	C
  DFB8  CDF2E0        		CALL	FKANC
  DFBB  CB09          		RRC	C
  DFBD  BC            		CP	H		;CP (HL),(DE)
  DFBE  E1            		POP	HL
  DFBF  2004          		JR	NZ,CPSTR3
  DFC1                	CPSTR2:
  DFC1  13            		INC	DE
  DFC2  23            		INC	HL
  DFC3  10E5          		DJNZ	CPSTR1
  DFC5                	CPSTR3:
  DFC5  C1            		POP	BC
  DFC6  C9            		RET
                      	
  DFC7                	CPFILE2:
  DFC7  FD7E0D        		LD	A,(IY+13)	;(FCB)属性(アトリビュート)
  DFCA  F6E1          		OR	0E1H
  DFCC  2F            		CPL
  DFCD  A6            		AND	(HL)
  DFCE  C9            		RET
                      	
  DFCF                	DCPAT:
  DFCF  2A7EEC        		LD	HL,(_DTBUF)
  DFD2  3AA0EC        		LD	A,(_DIRF)
  DFD5  B7            		OR	A
  DFD6  C8            		RET	Z
                      	
  DFD7                	CLUST:
  DFD7  3E08          	CLSPAT:	LD	A,8	;+8 (2D)  !ADDCL (Self-rewriting)
  DFD9                	ADD_DE_A:
  DFD9  83            		ADD	A,E	;DE=DE+A
  DFDA  5F            		LD	E,A
  DFDB  8A            		ADC	A,D
  DFDC  93            		SUB	E
  DFDD  57            		LD	D,A
  DFDE  C9            		RET
                      	
  DFDF                	ENDCL:
  DFDF  7A            		LD	A,D	;END CLUSTER
  DFE0  FE01          	CLPAT1:	CP	1	;164=356	(Self-rewriting)
  DFE2  C0            		RET	NZ
  DFE3  7B            		LD	A,E
  DFE4  FE64          	CLPAT2:	CP	064H	;		(Self-rewriting)
  DFE6  C9            		RET
                      	
  DFE7                	CAP:
  DFE7  FE61          		CP	'a'
  DFE9  D8            		RET	C
  DFEA  FE7B          		CP	'z'+1
  DFEC  D0            		RET	NC
  DFED  D620          		SUB	020H
  DFEF  C9            		RET
  DFF0                	CAP2:
  DFF0  CDE7DF        		CALL	CAP
  DFF3                	CAP3:
  DFF3  CDFCDF        		CALL	CAP4
  DFF6  FE21          		CP	021H
  DFF8  D0            		RET	NC
  DFF9  3EA0          		LD	A,0A0H
  DFFB  C9            		RET
  DFFC                	CAP4:
  DFFC  FE05          		CP	5
  DFFE  C0            		RET	NZ
  DFFF  3EE5          		LD	A,0E5H
  E001  C9            		RET
                      	
  E002                	CHDIR:
  E002  CD40E9        		CALL	GETDPBD
  E005  3806          		JR	C,CHDIR2
  E007  DD751A        		LD	(IX+01AH),L		;_SDIR_
  E00A  DD741B        		LD	(IX+01BH),H		;_SDIR_+1
  E00D                	CHDIR2:
  E00D  DDE1          		POP	IX
  E00F  C9            		RET
                      	
  E010                	LDDIR:
  E010  CD40E9        		CALL	GETDPBD
  E013  DD5E1A        		LD	E,(IX+01AH)		;_SDIR_
  E016  DD561B        		LD	D,(IX+01BH)		;_SDIR_+1
  E019  13            		INC	DE
  E01A  FD730E        		LD	(IY+14),E	;(FCB)アクセスするディレクトリのクラスタ番号+1
  E01D  FD720F        		LD	(IY+15),D
  E020  1B            		DEC	DE
  E021  18EA          		JR	CHDIR2
                      	
  E023                	LDDIRX:
  E023  FD5E0E        		LD	E,(IY+14)	;(FCB)アクセスするディレクトリのクラスタ番号+1
  E026  FD560F        		LD	D,(IY+15)
  E029  1B            		DEC	DE
  E02A  CDDFDF        		CALL	ENDCL
  E02D  D410E0        		CALL	NC,LDDIR
  E030                	LDDIRS:
  E030  7A            		LD	A,D
  E031  B3            		OR	E
  E032  32A0EC        		LD	(_DIRF),A
  E035  C9            		RET
                      	
  E036                	KILL:
  E036  CD0CE1        		CALL	CHKWILDX
  E039  383A          		JR	C,KILLW
  E03B  CD76DF        		CALL	CHKDDX
  E03E  3F            		CCF
  E03F  D407DE        		CALL	NC,SOPENX1
  E042                	KILLS:
  E042  3E1F          		LD	A,01FH
  E044  D488E0        		CALL	NC,CHKATT
  E047  D8            		RET	C
  E048                	KILLSX:
  E048  36E5          		LD	(HL),0E5H	;DIR
  E04A  CDE6E0        		CALL	WTDB
  E04D  111A00        		LD	DE,01AH
  E050  19            		ADD	HL,DE
  E051  5E            		LD	E,(HL)
  E052  23            		INC	HL
  E053  56            		LD	D,(HL)
  E054  1804          		JR	KILLS2
  E056                	KILLS1:
  E056  ED5BFEEB      		LD	DE,(_CLPS)	;FAT
  E05A                	KILLS2:
  E05A  CDDFDF        		CALL	ENDCL
  E05D  D0            		RET	NC		;CF=0
  E05E  21FEFF        		LD	HL,0-2
  E061  19            		ADD	HL,DE
  E062  D0            		RET	NC		;DE= 0 or 1
  E063  D5            		PUSH	DE
  E064  CDF7EC        		CALL	_GNCL
  E067  ED53FEEB      		LD	(_CLPS),DE
  E06B  D1            		POP	DE
  E06C  210000        		LD	HL,0
  E06F  D4FAEC        		CALL	NC,_SNCL
  E072  30E2          		JR	NC,KILLS1
  E074  C9            		RET
                      	
  E075                	KILLW:
  E075  CD34DE        		CALL	SOPEN
  E078                	KILLW1:
  E078  380B          		JR	C,KILLW2
  E07A  CDCEDE        		CALL	SOPENE2
  E07D  CD42E0        		CALL	KILLS
  E080  CD98DE        		CALL	NOPEN
  E083  18F3          		JR	KILLW1
  E085                	KILLW2:
  E085  C8            		RET	Z
  E086  3F            		CCF
  E087  C9            		RET
                      	
  E088                	CHKATT:
  E088  E5            		PUSH	HL
  E089  110B00        		LD	DE,00BH
  E08C  19            		ADD	HL,DE
  E08D  A6            		AND	(HL)
  E08E  E1            		POP	HL
  E08F  C8            		RET	Z
  E090  37            		SCF
  E091  C9            		RET
                      	
  E092                	NAME:
  E092  CD0CE1        		CALL	CHKWILDX
  E095  D8            		RET	C
  E096  110400        		LD	DE,4
  E099  19            		ADD	HL,DE
  E09A  22B2E0        		LD	(NAMEP+2),HL
  E09D  23            		INC	HL
  E09E  CD10E1        		CALL	CHKWILD
  E0A1  D8            		RET	C
                      	
  E0A2  CD07DE        		CALL	SOPENX1
  E0A5  3E0F          		LD	A,00FH
  E0A7  D488E0        		CALL	NC,CHKATT
  E0AA  D8            		RET	C
                      	
  E0AB  FD7E00        		LD	A,(IY+0)
  E0AE  FDE5          		PUSH	IY
  E0B0  FD210000      	NAMEP:	LD	IY,0
  E0B4  FD7700        		LD	(IY+0),A
  E0B7  CD07DE        		CALL	SOPENX1
  E0BA  FDE3          		EX	(SP),IY
  E0BC  3F            		CCF
  E0BD  D434DE        		CALL	NC,SOPEN
  E0C0  EB            		EX	DE,HL
  E0C1  E1            		POP	HL
  E0C2  D8            		RET	C
                      	
  E0C3                	SETNAME:
  E0C3  01000B        		LD	BC,11*256
  E0C6  23            		INC	HL
  E0C7  7E            		LD	A,(HL)
  E0C8  FEE5          		CP	0E5H
  E0CA  2004          		JR	NZ,SNAME1
  E0CC  3E05          		LD	A,5
  E0CE  180E          		JR	SNAME3
  E0D0                	SNAME1:
  E0D0  7E            		LD	A,(HL)
  E0D1  0C            		INC	C
  E0D2  0D            		DEC	C
  E0D3  2009          		JR	NZ,SNAME3
  E0D5  CDE7DF        		CALL	CAP
  E0D8  FEA0          		CP	0A0H
  E0DA  2002          		JR	NZ,SNAME3
  E0DC  3E20          		LD	A,020H
  E0DE                	SNAME3:
  E0DE  12            		LD	(DE),A
  E0DF  7E            		LD	A,(HL)
  E0E0  23            		INC	HL
  E0E1  CDF9E0        		CALL	FKAN
  E0E4  10EA          		DJNZ	SNAME1
  E0E6                	WTDB:
  E0E6  3EFF          		LD	A,0FFH
  E0E8  32B4E2        		LD	(SFILE),A
  E0EB                	SWTDBF:
  E0EB  3E01          		LD	A,1
  E0ED  32A4EC        		LD	(_WTDBF),A
  E0F0  AF            		XOR	A
  E0F1  C9            		RET
                      	
  E0F2                	FKANC:
  E0F2  CB41          		BIT	0,C
  E0F4  CCF0DF        		CALL	Z,CAP2
  E0F7  1801          		JR	FKANX
  E0F9                	FKAN:
  E0F9  13            		INC	DE
  E0FA                	FKANX:
  E0FA  CB41          		BIT	0,C
  E0FC  CB81          		RES	0,C
  E0FE  C0            		RET	NZ
  E0FF  FE80          		CP	080H
  E101  D8            		RET	C
  E102  FEA0          		CP	0A0H
  E104  3803          		JR	C,FKAN1
  E106  FEE0          		CP	0E0H
  E108  D8            		RET	C
  E109                	FKAN1:
  E109  0C            		INC	C
  E10A  A7            		AND	A
  E10B  C9            		RET
                      	
  E10C                	CHKWILDX:
  E10C  FDE5          		PUSH	IY
  E10E  E1            		POP	HL
  E10F  23            		INC	HL
  E110                	CHKWILD:
  E110  060B          		LD	B,11
  E112  3E3F          		LD	A,'?'
  E114                	CHKWIL1:
  E114  BE            		CP	(HL)
  E115  23            		INC	HL
  E116  37            		SCF
  E117  C8            		RET	Z
  E118  10FA          		DJNZ	CHKWIL1
  E11A  AF            		XOR	A
  E11B  C9            		RET
                      	
  E11C                	SDIRENT:		;IY=FCB HL=DIR
  E11C  D5            		PUSH	DE
  E11D  E5            		PUSH	HL
  E11E  FDE5          		PUSH	IY
  E120  D1            		POP	DE
  E121  EB            		EX	DE,HL
  E122  CDC3E0        		CALL	SETNAME
                      	;				Attribute
  E125  FD7E0D        		LD	A,(IY+13)	;(FCB)属性(アトリビュート)
  E128  12            		LD	(DE),A
  E129  13            		INC	DE
                      	;				Reserved
  E12A  AF            		XOR	A
  E12B  060A          		LD	B,10
  E12D                	SDE1:
  E12D  12            		LD	(DE),A
  E12E  13            		INC	DE
  E12F  10FC          		DJNZ	SDE1
                      						;(FCB)ファイルを最後に変更した時刻
  E131  21DAEB        		LD	HL,SDDATA		;(FCB)ファイルを最後に変更した日付
  E134  060A          		LD	B,SDDATAE-SDDATA	;(FCB)ファイルの先頭クラスタ
  E136                	SDLOOP:					;(FCB)ファイルのサイズ(バイト単位)
  E136  7E            		LD	A,(HL)
  E137  23            		INC	HL
  E138  323DE1        		LD	(SDPAT+2),A
  E13B  FD7E00        	SDPAT:	LD	A,(IY+0)	;LD A,(IY+A)
  E13E  12            		LD	(DE),A
  E13F  13            		INC	DE
  E140  10F4          		DJNZ	SDLOOP
                      	
  E142  AF            		XOR	A
  E143  E1            		POP	HL
  E144  D1            		POP	DE
  E145  C9            		RET
                      	
  E146                	WOPEN:
  E146  FD7E0D        		LD	A,(IY+13)	;(FCB)属性(アトリビュート)
  E149  E61F          		AND	01FH
  E14B  37            		SCF
  E14C  C0            		RET	NZ
  E14D  FD361CFE      		LD	(IY+28),0FEH	;(FCB)オープン・モード
  E151                	TOPEN2:
  E151  AF            		XOR	A
  E152                	TOPEN:				;Initializes the time stamp
  E152  FD3617FF      		LD	(IY+23),0FFH	;(FCB)ファイルを最後に変更した時刻
  E156  C9            		RET
                      	
  E157                	WRDFX:
  E157  41            		LD	B,C
  E158  04            		INC	B
  E159  3E37          		LD	A,037H		;SCF
  E15B  32A6E5        		LD	(DRDN1),A
                      	
  E15E                	WRDF:				;Bクラスタ分確保する
  E15E  110200        		LD	DE,2
  E161  CDCBE6        		CALL	MULSPC
  E164                	WRDF1:
  E164  C5            		PUSH	BC
  E165  D5            		PUSH	DE
  E166  CDD8E6        		CALL	DIVSPC
  E169  CDF7EC        		CALL	_GNCL
  E16C  3827          		JR	C,WRDF3
  E16E  7A            		LD	A,D		;空いているかチェック
  E16F  B3            		OR	E
  E170  CDCBE6        		CALL	MULSPC
  E173  2032          		JR	NZ,WRDF4
  E175  E1            		POP	HL		;HL=空いているクラスタ
  E176  E5            		PUSH	HL
  E177  ED5BFEEB      		LD	DE,(_CLPS)	;DE=元の(_CLPS)
  E17B  22FEEB        		LD	(_CLPS),HL
  E17E  7A            		LD	A,D		;元の(_CLPS)が 0 か?
  E17F  B3            		OR	E
  E180  EB            		EX	DE,HL		;
  E181  CDD8E6        		CALL	DIVSPC		;ここでフラグは変化しない
  E184  EB            		EX	DE,HL		;
  E185  2008          		JR	NZ,WRDF2
  E187  FD751A        		LD	(IY+26),L	;(FCB)ファイルの先頭クラスタ
  E18A  FD741B        		LD	(IY+27),H	;元が空の場合はFCBにクラスタをセットする
  E18D  1806          		JR	WRDF3
  E18F                	WRDF2:
  E18F  CDD8E6        		CALL	DIVSPC
  E192  CDFAEC        		CALL	_SNCL
  E195                	WRDF3:
  E195  D1            		POP	DE
  E196  C1            		POP	BC
  E197  D8            		RET	C
  E198  100F          		DJNZ	WRDF5		;ここでループカウンタチェック
  E19A  ED5BFEEB      		LD	DE,(_CLPS)
  E19E  CDD8E6        		CALL	DIVSPC
  E1A1  21FFFF        		LD	HL,0FFFFH	;FATエントリ終了(EOCマーク)
  E1A4  C3FAEC        		JP	_SNCL
                      	
  E1A7                	WRDF4:				;DEクラスタが空じゃないので次に移動する
  E1A7  D1            		POP	DE
  E1A8  C1            		POP	BC
  E1A9                	WRDF5:
  E1A9  CDD8E6        		CALL	DIVSPC
  E1AC  13            		INC	DE
  E1AD  CDDFDF        		CALL	ENDCL
  E1B0  CDCBE6        		CALL	MULSPC
  E1B3  38AF          		JR	C,WRDF1
  E1B5  37            		SCF
  E1B6  C9            		RET
                      	
  E1B7                	RWXR:			;in BC0(24ビット) にサイズ
  E1B7  CB38          		SRL	B	;BC=BC/2
  E1B9  CB19          		RR	C	;
  E1BB  CB38          	IBM4:	SRL	B	;自己書き換え 1024=SRL B / 512=JR +2(直後のRR Cを飛ばす)
  E1BD  CB19          		RR	C	;BC=BC/2
                      	
  E1BF  3ACEE6        		LD	A,(SPCPAT+1)	;1クラスタの論理セクタ数
  E1C2                	CLDBL4:
  E1C2  0F            		RRCA
  E1C3  3806          		JR	C,CLDBL5
  E1C5  CB38          		SRL	B	;BC=BC/2
  E1C7  CB19          		RR	C	;
  E1C9  18F7          		JR	CLDBL4
  E1CB                	CLDBL5:
  E1CB  FD5E1A        		LD	E,(IY+26)	;(FCB)ファイルの先頭クラスタ
  E1CE  FD561B        		LD	D,(IY+27)
  E1D1                	RWX1:
  E1D1  CDCBE6        		CALL	MULSPC
  E1D4  ED53FEEB      		LD	(_CLPS),DE
  E1D8  7A            		LD	A,D
  E1D9  B3            		OR	E
  E1DA  37            		SCF
  E1DB  C8            		RET	Z	;RET DE==0
                      	
  E1DC  78            		LD	A,B
  E1DD  B1            		OR	C
  E1DE  C8            		RET	Z	;RET BC==0
                      	
  E1DF  CDD8E6        		CALL	DIVSPC
  E1E2  CDF7EC        		CALL	_GNCL
  E1E5  D8            		RET	C
  E1E6  0B            		DEC	BC
  E1E7  CDDFDF        		CALL	ENDCL
  E1EA  38E5          		JR	C,RWX1
  E1EC  37            		SCF
  E1ED  C9            		RET
                      	
  E1EE                	DSKF:
  E1EE  110000        	MAXCLP:	LD	DE,0
  E1F1  210000        		LD	HL,0
  E1F4                	DSKF1:
  E1F4  D5            		PUSH	DE
  E1F5  CDF7EC        		CALL	_GNCL
  E1F8  380C          		JR	C,POPSCF
  E1FA  7A            		LD	A,D
  E1FB  B3            		OR	E
  E1FC  2001          		JR	NZ,DSKF2
  E1FE  23            		INC	HL
  E1FF                	DSKF2:
  E1FF  D1            		POP	DE
  E200  1B            		DEC	DE
  E201  7A            		LD	A,D
  E202  B3            		OR	E
  E203  20EF          		JR	NZ,DSKF1
  E205  C9            		RET
                      	
  E206                	POPSCF:
  E206  F1            		POP	AF
  E207  37            		SCF
  E208  C9            		RET
                      	
  E209                	SETTMS:
  E209  FD7E17        		LD	A,(IY+23)	;(FCB)ファイルを最後に変更した時刻
  E20C  3C            		INC	A
  E20D  C0            		RET	NZ		;ファイルが更新されていない
  E20E                	SETTMSX:			;FCBに日付時刻をセットする
  E20E  CDB2D8        		CALL	_SYS2C		;(BDOS)時刻の獲得
                      					;H←時  L←分  D←秒
  E211  CB25          		SLA	L		;L=L/2
  E213  CB25          		SLA	L		;L=L/2
  E215  29            		ADD	HL,HL		;*2
  E216  29            		ADD	HL,HL		;*4
  E217  29            		ADD	HL,HL		;*8
  E218  7A            		LD	A,D
  E219  0F            		RRCA			;bit.0->7->->->0->C
  E21A  E61F          		AND	01FH
  E21C  B5            		OR	L
  E21D  FD7716        		LD	(IY+22),A	;(FCB)ファイルを最後に変更した時刻
  E220  FD7417        		LD	(IY+23),H
                      	
  E223  CD78D8        		CALL	_SYS2A		;(BDOS)日付の獲得
                      					;HL←年  D←月  E←日
  E226  0144F8        		LD	BC,0-1980
  E229  09            		ADD	HL,BC
  E22A  65            		LD	H,L
                      	
  E22B  7A            		LD	A,D
  E22C  87            		ADD	A,A		;*2
  E22D  87            		ADD	A,A		;*4
  E22E  87            		ADD	A,A		;*8
  E22F  87            		ADD	A,A		;*16
  E230  6F            		LD	L,A
  E231  29            		ADD	HL,HL		;*32
  E232  7D            		LD	A,L
  E233  B3            		OR	E
  E234  FD7714        		LD	(IY+20),A	;(FCB)ファイルを最後に変更した日付
  E237  FD7415        		LD	(IY+21),H
  E23A  C9            		RET
                      	
  E23B                	PUSHRR:
  E23B  CD41E2        		CALL	SUBRR
  E23E                	POPRR1:
  E23E  EDB0          		LDIR
  E240  C9            		RET
                      	
  E241                	SUBRR:
  E241  FDE5          		PUSH	IY
  E243  E1            		POP	HL
  E244  112100        		LD	DE,33
  E247  19            		ADD	HL,DE
  E248  11D5E2        		LD	DE,HLBUF
  E24B  010300        		LD	BC,3
  E24E  C9            		RET
                      	
  E24F                	SETSEQ:
  E24F  F5            		PUSH	AF		;AHL=Random record
  E250  FD7E21        		LD	A,(IY+33)	;(FCB)ランダム・レコード
  E253  FD6E22        		LD	L,(IY+34)
  E256  FD6623        		LD	H,(IY+35)
                      	
  E259  CD75E2        		CALL	SSQ1
                      	
  E25C  29            		ADD	HL,HL
  E25D  CB3D          		SRL	L		;L=L/2
  E25F  FD7520        		LD	(IY+32),L	;(FCB)カレント・レコード
  E262  FD740C        		LD	(IY+12),H	;(FCB)カレント・ブロック
  E265  F1            		POP	AF
                      	
  E266                	POPRR:
  E266  CD41E2        		CALL	SUBRR
  E269  EB            		EX	DE,HL
  E26A  18D2          		JR	POPRR1
                      	
  E26C                	GETSIZE:
  E26C  FD7E10        		LD	A,(IY+16)	;(FCB)ファイルのサイズ(バイト単位)
  E26F  FD6E11        		LD	L,(IY+17)
  E272  FD6612        		LD	H,(IY+18)
  E275                	SSQ1:				;バイト単位からCP/Mのレコード単位を求める（1レコード=128バイト）
  E275  87            		ADD	A,A		;in HLA => out HL
  E276  ED6A          		ADC	HL,HL
  E278  B7            		OR	A
  E279  C8            		RET	Z
  E27A  23            		INC	HL
  E27B  C9            		RET
                      	
  E27C                	GETSEQ:
  E27C  FD6E20        		LD	L,(IY+32)	;(FCB)カレント・レコード
  E27F  FD660C        		LD	H,(IY+12)	;(FCB)カレント・ブロック
                      	
  E282  CB25          		SLA	L	;L=L*2
                      	
  E284  CB3C          		SRL	H	;HL=HL/2
  E286  CB1D          		RR	L	;
  E288  C9            		RET
                      	
  E289                	RB_WRITE:
  E289  C5            		PUSH	BC
  E28A  ED4B4CEC      		LD	BC,(STABLE+2*026H)	;(BDOS)ランダム・ブロック・ライト
  E28E  1805          		JR	RBRW
  E290                	RB_READ:
  E290  C5            		PUSH	BC
  E291  ED4B4EEC      		LD	BC,(STABLE+2*027H)	;(BDOS)ランダム・ブロック・リード
  E295                	RBRW:
  E295  AF            		XOR	A	;HLA = HL*128
  E296  CB3C          		SRL	H	;HL=HL/2
  E298  CB1D          		RR	L	;
  E29A  1F            		RRA			;HLA
  E29B  FD7721        		LD	(IY+33),A	;(FCB)ランダム・レコード
  E29E  FD7522        		LD	(IY+34),L
  E2A1  FD7423        		LD	(IY+35),H
  E2A4  218000        		LD	HL,128
                      	
  E2A7  FDE5          		PUSH	IY
  E2A9  D1            		POP	DE
  E2AA  D5            		PUSH	DE
  E2AB  CDB2E2        		CALL	JP_BC
  E2AE  FDE1          		POP	IY
  E2B0  C1            		POP	BC
  E2B1  C9            		RET
  E2B2                	JP_BC:
  E2B2  C5            		PUSH	BC
  E2B3  C9            		RET
                      	
  E2B4                	SFILE:	DS	33		;DRV FILENAME
  E2D5                	HLBUF:	DS	3		;Random record buffer
                      	
                      	;LDFILE2.ASM
                      	
                      	;	LSX-Dodgers FILE2
                      	
  E2D8                	RBWDD:
  E2D8  E5            		PUSH	HL
  E2D9  C1            		POP	BC
  E2DA  21B5E3        		LD	HL,NUL
  E2DD  CDE9E3        		CALL	DDX
  E2E0  2003          		JR	NZ,RBWDD2
  E2E2  2A08EC        		LD	HL,(STABLE+2*4)
  E2E5                	RBWDD2:
  E2E5  FE43          		CP	'C'
  E2E7  2003          		JR	NZ,RBWDD3
  E2E9  21A0DA        		LD	HL,PRINTS
  E2EC                	RBWDD3:
  E2EC  FE50          		CP	'P'
  E2EE  2003          		JR	NZ,RBWDD4
  E2F0  2A0AEC        		LD	HL,(STABLE+2*5)
  E2F3                	RBWDD4:
  E2F3  2201E3        		LD	(RBWDDP+1),HL
  E2F6  2A8AEC        		LD	HL,(_DTA)
  E2F9                	RBWDD1:
  E2F9  78            		LD	A,B
  E2FA  B1            		OR	C
  E2FB                	RBWDD5:
  E2FB  CAB0E3        		JP	Z,RBW1
  E2FE  5E            		LD	E,(HL)
  E2FF  23            		INC	HL
  E300  CDF0D7        	RBWDDP:	CALL	_SYS02
  E303  DACCE3        		JP	C,RBRERR
  E306  3E1A          		LD	A,01AH
  E308  BB            		CP	E
  E309  28F0          		JR	Z,RBWDD5
  E30B  0B            		DEC	BC
  E30C  18EB          		JR	RBWDD1
                      	
                      					;Write random block
  E30E                	_SYS26:		;(BDOS)ランダム・ブロック・ライト
  E30E  AF            		XOR	A
  E30F  32A6E5        		LD	(DRDN1),A	;NOP
  E312  2260E5        		LD	(LEFT+1),HL	;HL←書き込むレコード数
  E315  2282E5        		LD	(LEFTX),HL
  E318  CDE0DD        		CALL	SETDRV
                      	
  E31B  CDD3E4        		CALL	RBX0
  E31E  DAB7E3        		JP	C,RBWERR
  E321  28B5          		JR	Z,RBWDD
  E323  CD46E1        		CALL	WOPEN
  E326  DAB7E3        		JP	C,RBWERR
  E329  7C            		LD	A,H
  E32A  B5            		OR	L
  E32B  CAB0E3        		JP	Z,RBW1
                      	
  E32E  2B            		DEC	HL
                      	
  E32F  CD78E5        		CALL	GET_RR_CDE	;CDE=Random record
                      	
  E332  AF            		XOR	A	;AHL=HL+CDE
  E333  19            		ADD	HL,DE
  E334  89            		ADC	A,C
                      	
  E335  47            		LD	B,A
  E336  4C            		LD	C,H
                      	
  E337  CDB7E1        		CALL	RWXR
  E33A  DC57E1        		CALL	C,WRDFX
  E33D  DAB7E3        		JP	C,RBWERR
                      		
  E340  CDFCE4        		CALL	RBX2
  E343  281A          		JR	Z,RBWB
  E345  CD0FE5        		CALL	RBXA
  E348  386D          		JR	C,RBWERR
  E34A  EB            		EX	DE,HL
  E34B  C5            		PUSH	BC
  E34C  EDB0          		LDIR
  E34E  2284E5        		LD	(DTAX),HL
                      	
  E351  CDEBE0        		CALL	SWTDBF
                      	
  E354  2A82E5        		LD	HL,(LEFTX)
  E357  D1            		POP	DE
  E358  ED52          		SBC	HL,DE
  E35A  2282E5        		LD	(LEFTX),HL
  E35D  2831          		JR	Z,RBWEND
                      	
  E35F                	RBWB:
  E35F  CD44E5        		CALL	RBXB
  E362  2816          		JR	Z,RBWC
  E364                	RBWB1:
  E364  C5            		PUSH	BC
  E365  D5            		PUSH	DE
  E366  CDD7DF        		CALL	CLUST
  E369  CD1CE8        		CALL	DWT_DPB
  E36C  D1            		POP	DE
  E36D  C1            		POP	BC
  E36E  3847          		JR	C,RBWERR
  E370  05            		DEC	B
  E371  2807          		JR	Z,RBWC
  E373  CDBDE6        		CALL	GNCLX
  E376  30EC          		JR	NC,RBWB1
  E378  183D          		JR	RBWERR
  E37A                	RBWC:
  E37A  CD54E5        		CALL	RBXC
  E37D  2811          		JR	Z,RBWEND
                      	
  E37F  CDD7DF        		CALL	CLUST
  E382  CDA5E5        		CALL	DRDN
  E385  3830          		JR	C,RBWERR
  E387  ED5B7EEC      		LD	DE,(_DTBUF)
  E38B  EDB0          		LDIR
  E38D  CDEBE0        		CALL	SWTDBF
  E390                	RBWEND:
  E390  CD5FE5        		CALL	RBXEND
                      	
  E393  CDE2E4        		CALL	RBX1
  E396  3018          		JR	NC,RBW1
  E398  2A60E5        		LD	HL,(LEFT+1)
  E39B  FD5E10        		LD	E,(IY+16)	;(FCB)ファイルのサイズ(バイト単位)
  E39E  FD5611        		LD	D,(IY+17)	;CDE=File size
  E3A1  FD4E12        		LD	C,(IY+18)
  E3A4  AF            		XOR	A
  E3A5  19            		ADD	HL,DE
  E3A6  89            		ADC	A,C
  E3A7  FD7510        		LD	(IY+16),L	;(FCB)ファイルのサイズ(バイト単位)
  E3AA  FD7411        		LD	(IY+17),H
  E3AD  FD7712        		LD	(IY+18),A
  E3B0                	RBW1:
  E3B0  FDE1          		POP	IY
  E3B2  C1            		POP	BC
  E3B3  D1            		POP	DE
  E3B4  E1            		POP	HL
  E3B5                	NUL:
  E3B5  AF            		XOR	A
  E3B6  C9            		RET
                      	
  E3B7                	RBWERR:
  E3B7  FDE5          		PUSH	IY
  E3B9  D1            		POP	DE
  E3BA  2A20EC        		LD	HL,(STABLE+2*010H)
  E3BD  CD0F00        		CALL	JP_HL
  E3C0                	RBRERR1:
  E3C0  3E01          		LD	A,001H
  E3C2                	RBRERR2:
  E3C2  FDE1          		POP	IY
  E3C4  C1            		POP	BC
  E3C5  D1            		POP	DE
  E3C6  E1            		POP	HL
  E3C7  37            		SCF
  E3C8  210000        		LD	HL,0
  E3CB  C9            		RET
                      	
  E3CC                	RBRERR:
  E3CC  3EFF          		LD	A,0FFH
  E3CE  18F2          		JR	RBRERR2
                      	
  E3D0                	RBRFL:
  E3D0  3E00          	RBRFLP:	LD	A,000H
  E3D2  FE0D          		CP	00DH
  E3D4  2005          		JR	NZ,RBRFL1
  E3D6  D5            		PUSH	DE
  E3D7  1E0A          		LD	E,00AH
  E3D9  1805          		JR	RBRFL2
  E3DB                	RBRFL1:
  E3DB  D5            		PUSH	DE
  E3DC  CDBDD3        		CALL	_SYS07
  E3DF  5F            		LD	E,A
  E3E0                	RBRFL2:
  E3E0  CDCDEC        		CALL	_PRINT
  E3E3  7B            		LD	A,E
  E3E4  D1            		POP	DE
  E3E5  32D1E3        		LD	(RBRFLP+1),A
  E3E8  C9            		RET
  E3E9                	DDX:
  E3E9  FD7E01        		LD	A,(IY+1)	;(FCB)主ファイル名
  E3EC  CDE7DF        		CALL	CAP
  E3EF  FE41          		CP	'A'
  E3F1  C9            		RET
                      	
  E3F2                	RBRDD:
  E3F2  E5            		PUSH	HL
  E3F3  C1            		POP	BC
  E3F4  21D0E3        		LD	HL,RBRFL
  E3F7  CDE9E3        		CALL	DDX
  E3FA  2005          		JR	NZ,RBRDD2
  E3FC  2A06EC        		LD	HL,(STABLE+2*3)
  E3FF  1804          		JR	RBRDD3
  E401                	RBRDD2:
  E401  FE43          		CP	'C'
  E403  202C          		JR	NZ,RBRDERR
  E405                	RBRDD3:
  E405  2215E4        		LD	(RBRDDP+1),HL
                      	
  E408  ED5B8AEC      		LD	DE,(_DTA)
  E40C  210000        		LD	HL,0
  E40F                	RBRDD1:
  E40F  78            		LD	A,B
  E410  B1            		OR	C
  E411  2818          		JR	Z,RBRDDE1
  E413  23            		INC	HL
  E414  CDD0E3        	RBRDDP:	CALL	RBRFL
  E417  380D          		JR	C,RBRDDE
  E419  FE1A          		CP	01AH
  E41B  2809          		JR	Z,RBRDDE
  E41D  FE03          		CP	3
  E41F  2805          		JR	Z,RBRDDE
  E421  12            		LD	(DE),A
  E422  13            		INC	DE
  E423  0B            		DEC	BC
  E424  18E9          		JR	RBRDD1
                      	
  E426                	RBRDDE:
  E426  3E1A          		LD	A,01AH
  E428  12            		LD	(DE),A
  E429                	RBRDDE2:
  E429  AF            		XOR	A
  E42A  3C            		INC	A
  E42B                	RBRDDE1:
  E42B  32BFE4        		LD	(RBRAP+1),A
  E42E  C3B8E4        		JP	RBREND0
  E431                	RBRDERR:
  E431  210000        		LD	HL,0
  E434  18F3          		JR	RBRDDE2
                      	
                      					;Read random block
  E436                	_SYS27:		;(BDOS)ランダム・ブロック・リード
  E436  2282E5        		LD	(LEFTX),HL
  E439  CDE0DD        		CALL	SETDRV
                      	
  E43C  FDCB0D66      		BIT	4,(IY+13)	;(FCB)属性(アトリビュート)
  E440  C2C1E4        		JP	NZ,RBRDIR	;ディレクトリ
  E443  CDD3E4        		CALL	RBX0
  E446  DACCE3        		JP	C,RBRERR
  E449  28A7          		JR	Z,RBRDD
  E44B  CDE2E4        		CALL	RBX1
  E44E  DAC0E3        		JP	C,RBRERR1
  E451  79            		LD	A,C
  E452  EB            		EX	DE,HL
  E453  ED52          		SBC	HL,DE		;CP 0HL,CDE
  E455  19            		ADD	HL,DE
  E456  DE00          		SBC	A,000H
  E458  3801          		JR	C,RBR1
  E45A  EB            		EX	DE,HL
  E45B                	RBR1:
  E45B  9F            		SBC	A,A
  E45C  E601          		AND	1
  E45E  32BFE4        		LD	(RBRAP+1),A
                      	
  E461  7C            		LD	A,H
  E462  B5            		OR	L
  E463  CAB8E4        		JP	Z,RBREND0
                      	
  E466  2260E5        		LD	(LEFT+1),HL	;Read record byte
  E469  2282E5        		LD	(LEFTX),HL
                      	
  E46C  CDFCE4        		CALL	RBX2
  E46F  2819          		JR	Z,RBRB
  E471  CD0FE5        		CALL	RBXA
  E474  DACCE3        		JP	C,RBRERR
  E477  C5            		PUSH	BC
  E478  EDB0          		LDIR
  E47A  ED5384E5      		LD	(DTAX),DE
  E47E  2A82E5        		LD	HL,(LEFTX)
  E481  D1            		POP	DE
  E482  A7            		AND	A
  E483  ED52          		SBC	HL,DE
  E485  2282E5        		LD	(LEFTX),HL
  E488  282B          		JR	Z,RBREND
                      	
  E48A                	RBRB:
  E48A  CD44E5        		CALL	RBXB
  E48D  2812          		JR	Z,RBRC
  E48F                	RBRB1:
  E48F  C5            		PUSH	BC
  E490  D5            		PUSH	DE
  E491  CDD7DF        		CALL	CLUST
  E494  CDCCE7        		CALL	DRD_DPB
  E497  D1            		POP	DE
  E498  C1            		POP	BC
  E499  D4BDE6        		CALL	NC,GNCLX
  E49C  DACCE3        		JP	C,RBRERR
  E49F  10EE          		DJNZ	RBRB1
  E4A1                	RBRC:
  E4A1  CD54E5        		CALL	RBXC
  E4A4  280F          		JR	Z,RBREND
                      	
  E4A6  CDD7DF        		CALL	CLUST
  E4A9  CD8DE5        		CALL	DRDX
  E4AC  DACCE3        		JP	C,RBRERR
  E4AF  EB            		EX	DE,HL
  E4B0  2A7EEC        		LD	HL,(_DTBUF)
  E4B3  EDB0          		LDIR
  E4B5                	RBREND:
  E4B5  CD5FE5        		CALL	RBXEND
  E4B8                	RBREND0:
  E4B8  FDE1          		POP	IY
  E4BA  C1            		POP	BC
  E4BB  D1            		POP	DE
  E4BC  F1            		POP	AF	;(HL)
  E4BD  AF            		XOR	A
  E4BE  3E00          	RBRAP:	LD	A,000H
  E4C0  C9            		RET
                      	
  E4C1                	RBRDIR:
  E4C1  FD6E1A        		LD	L,(IY+26)	;(FCB)ファイルの先頭クラスタ
  E4C4  FD661B        		LD	H,(IY+27)
  E4C7  CD02E0        		CALL	CHDIR
  E4CA  AF            		XOR	A
  E4CB  67            		LD	H,A
  E4CC  6F            		LD	L,A
  E4CD  3C            		INC	A
  E4CE  32BFE4        		LD	(RBRAP+1),A
  E4D1  18E5          		JR	RBREND0
                      	
  E4D3                	RBX0:
  E4D3  2A8AEC        		LD	HL,(_DTA)
  E4D6  2284E5        		LD	(DTAX),HL
  E4D9  2A82E5        		LD	HL,(LEFTX)
  E4DC  FD7E1C        		LD	A,(IY+28)	;(FCB)オープン・モード
  E4DF  D6FD          		SUB	0FDH
  E4E1  C9            		RET
                      	
  E4E2                	RBX1:
  E4E2  E5            		PUSH	HL		;Record byte
                      					;AHL=File size
  E4E3  FD6E10        		LD	L,(IY+16)	;ファイルのサイズ(バイト単位)
  E4E6  FD6611        		LD	H,(IY+17)
  E4E9  FD7E12        		LD	A,(IY+18)
                      	
  E4EC  CD78E5        		CALL	GET_RR_CDE	;CDE=Random record
                      	
  E4EF  A7            		AND	A
  E4F0  ED52          		SBC	HL,DE
  E4F2  99            		SBC	A,C
  E4F3  D1            		POP	DE
                      	
  E4F4  D8            		RET	C
  E4F5  4F            		LD	C,A
  E4F6  EB            		EX	DE,HL	;CDE=File byte	HL=Record byte
  E4F7  B2            		OR	D
  E4F8  B3            		OR	E
  E4F9  C0            		RET	NZ
  E4FA  37            		SCF
  E4FB  C9            		RET
                      	
  E4FC                	RBX2:				;Cluster settings
  E4FC  FD4E22        		LD	C,(IY+34)	;(+33)(FCB)ランダム・レコード
  E4FF  FD4623        		LD	B,(IY+35)
  E502  CDB7E1        		CALL	RWXR
  E505  3A0ADF        		LD	A,(SECSZM1+2)	;1024=3 / 512=1
  E508  FDA622        		AND	(IY+34)
  E50B  FDB621        		OR	(IY+33)
  E50E  C9            		RET
                      	
  E50F                	RBXA:
  E50F  D5            		PUSH	DE
  E510  CDD7DF        		CALL	CLUST
  E513  CD8DE5        		CALL	DRDX
  E516  D1            		POP	DE
  E517  D8            		RET	C
  E518  CDBDE6        		CALL	GNCLX
  E51B  D8            		RET	C
  E51C  ED53FEEB      		LD	(_CLPS),DE
                      	
  E520  FD4E21        		LD	C,(IY+33)	;(FCB)ランダム・レコード
  E523  3A0ADF        		LD	A,(SECSZM1+2)	;1024=3 / 512=1
  E526  FDA622        		AND	(IY+34)
  E529  47            		LD	B,A
  E52A  210004        	SECSZ:	LD	HL,0400H	;自己書き換え 1024=0400H / 512=0200H ここに1セクタのサイズが格納される
  E52D  ED42          		SBC	HL,BC		;remaining cluster
                      	
  E52F  ED5B82E5      		LD	DE,(LEFTX)
  E533  ED52          		SBC	HL,DE		;CP HL,DE
  E535  19            		ADD	HL,DE		;
  E536  3801          		JR	C,RBXA1
  E538  EB            		EX	DE,HL
  E539                	RBXA1:
  E539  E5            		PUSH	HL
  E53A  2A7EEC        		LD	HL,(_DTBUF)
  E53D  09            		ADD	HL,BC
  E53E  ED5B84E5      		LD	DE,(DTAX)
  E542  C1            		POP	BC
  E543  C9            		RET
                      	
  E544                	RBXB:
  E544  2A84E5        		LD	HL,(DTAX)
  E547  ED5BFEEB      		LD	DE,(_CLPS)
  E54B  3A83E5        		LD	A,(LEFTX+1)
  E54E  CB3F          		SRL	A		;A=A/2
  E550  CB3F          	IBM8:	SRL	A		;自己書き換え 1024=SRL A / 512=NOP NOP
  E552  47            		LD	B,A
  E553  C9            		RET
                      	
  E554                	RBXC:
  E554  ED4B82E5      		LD	BC,(LEFTX)
  E558  3A0ADF        		LD	A,(SECSZM1+2)	;1024=3 / 512=1
  E55B  A0            		AND	B
  E55C  47            		LD	B,A
  E55D  B1            		OR	C
  E55E  C9            		RET
                      	
  E55F                	RBXEND:
  E55F  110000        	LEFT:	LD	DE,0
  E562  AF            		XOR	A
  E563  FD6E21        		LD	L,(IY+33)	;(FCB)ランダム・レコード
  E566  FD6622        		LD	H,(IY+34)
  E569  19            		ADD	HL,DE
  E56A  FD8E23        		ADC	A,(IY+35)
  E56D  FD7521        		LD	(IY+33),L	;(FCB)ランダム・レコード
  E570  FD7422        		LD	(IY+34),H
  E573  FD7723        		LD	(IY+35),A
  E576  EB            		EX	DE,HL		;HL=Read byte
  E577  C9            		RET
                      	
  E578                	GET_RR_CDE:			;CDE=Random record
  E578  FD5E21        		LD	E,(IY+33)	;(FCB)ランダム・レコード
  E57B  FD5622        		LD	D,(IY+34)
  E57E  FD4E23        		LD	C,(IY+35)
  E581  C9            		RET
                      	
  E582                	CPBUF:
  E582  0000          	LEFTX:	DW	0
  E584  0000          	DTAX:	DW	0
  E586  20            		DB	020H	;DS 7,20h
  E587  20            		DB	020H
  E588  20            		DB	020H
  E589  20            		DB	020H
  E58A  20            		DB	020H
  E58B  20            		DB	020H
  E58C  20            		DB	020H
                      	;
                      	
                      	;LDDIO.ASM
                      	
                      	;	LSX-Dodgers DIO
                      	
  E58D                	DRDX:
  E58D  CDC3E5        		CALL	DRDY
  E590  C8            		RET	Z
  E591  CDADE5        		CALL	DRDX1
  E594  D8            		RET	C
  E595  E5            		PUSH	HL
  E596  C5            		PUSH	BC
  E597  D5            		PUSH	DE
  E598  2A7EEC        		LD	HL,(_DTBUF)
  E59B  CDCCE7        		CALL	DRD_DPB
  E59E  DCBEE5        		CALL	C,DRDNE
  E5A1                	POP_DE_BC_HL_RET:
  E5A1  D1            		POP	DE
  E5A2  C1            		POP	BC
  E5A3  E1            		POP	HL
  E5A4  C9            		RET
                      	
  E5A5                	DRDN:
  E5A5  AF            		XOR	A
  E5A6  00            	DRDN1:	NOP			;自己書き換え NOP / SCF
  E5A7  30E4          		JR	NC,DRDX
  E5A9                	DRDNX:
  E5A9  CDC3E5        		CALL	DRDY
  E5AC  C8            		RET	Z
  E5AD                	DRDX1:
  E5AD  CDD4E5        		CALL	DWTX
  E5B0  ED53A6EC      		LD	(_DCLPS),DE
  E5B4  3A88EC        		LD	A,(_DRV)
  E5B7  32A5EC        		LD	(_DBDRV),A
  E5BA  CDD9EC        		CALL	_CHGDRV
  E5BD  D0            		RET	NC
  E5BE                	DRDNE:
  E5BE  9F            		SBC	A,A
  E5BF  32A5EC        		LD	(_DBDRV),A
  E5C2  C9            		RET
                      	
  E5C3                	DRDY:
  E5C3  E5            		PUSH	HL
  E5C4  3A88EC        		LD	A,(_DRV)
  E5C7  21A5EC        		LD	HL,_DBDRV
  E5CA  AE            		XOR	(HL)
  E5CB  2005          		JR	NZ,POP_HL_RET
                      	
  E5CD  2AA6EC        		LD	HL,(_DCLPS)
  E5D0  ED52          		SBC	HL,DE		;CF=0
  E5D2                	POP_HL_RET:
  E5D2  E1            		POP	HL
  E5D3  C9            		RET
                      	
  E5D4                	DWTX:
  E5D4  3AA4EC        		LD	A,(_WTDBF)
  E5D7  B7            		OR	A
  E5D8  C8            		RET	Z
  E5D9  AF            		XOR	A
  E5DA  32A4EC        		LD	(_WTDBF),A
                      	
  E5DD  E5            		PUSH	HL
  E5DE  C5            		PUSH	BC
  E5DF  D5            		PUSH	DE
  E5E0  3AA5EC        		LD	A,(_DBDRV)
  E5E3  CDD9EC        		CALL	_CHGDRV
  E5E6  ED5BA6EC      		LD	DE,(_DCLPS)
  E5EA  2A7EEC        		LD	HL,(_DTBUF)
  E5ED  D41CE8        		CALL	NC,DWT_DPB
  E5F0  18AF          		JR	POP_DE_BC_HL_RET
                      	
  E5F2                	RDFATX:
  E5F2  E5            		PUSH	HL
  E5F3  3A88EC        		LD	A,(_DRV)
  E5F6  21A3EC        		LD	HL,_FATDRV
  E5F9  AE            		XOR	(HL)
  E5FA  E67F          		AND	07FH
  E5FC  28D4          		JR	Z,POP_HL_RET
                      	
  E5FE  C5            		PUSH	BC
  E5FF  D5            		PUSH	DE
  E600  DDE5          		PUSH	IX
  E602  CD1AE6        		CALL	WTFATX
  E605  380F          		JR	C,RDFATE1
                      	
  E607  3A88EC        		LD	A,(_DRV)
  E60A  32A3EC        		LD	(_FATDRV),A
  E60D  CDE5EC        		CALL	_RDFAT
  E610                	RDFATE2:
  E610  3004          		JR	NC,RDFATE1
  E612  9F            		SBC	A,A
  E613  32A3EC        		LD	(_FATDRV),A
  E616                	RDFATE1:
  E616  DDE1          		POP	IX
  E618  1887          		JR	POP_DE_BC_HL_RET
                      	
  E61A                	WTFATX:
  E61A  3AA2EC        		LD	A,(_WTFATF)
  E61D  B7            		OR	A
  E61E  C8            		RET	Z
  E61F  E5            		PUSH	HL
  E620  3AA3EC        		LD	A,(_FATDRV)
  E623  21A5EC        		LD	HL,_DBDRV
  E626  AE            		XOR	(HL)
  E627  E67F          		AND	07FH
  E629  CCD4E5        		CALL	Z,DWTX
  E62C  38A4          		JR	C,POP_HL_RET
  E62E  C5            		PUSH	BC
  E62F  D5            		PUSH	DE
  E630  DDE5          		PUSH	IX
  E632  CD28E8        		CALL	WTFAT
  E635  AF            		XOR	A
  E636  32A2EC        		LD	(_WTFATF),A
  E639  18DB          		JR	RDFATE1
                      	
  E63B                	NCL1:
  E63B  7A            		LD	A,D
  E63C  B3            		OR	E
  E63D  37            		SCF
  E63E  C8            		RET	Z
                      	
  E63F  3A88EC        		LD	A,(_DRV)
  E642  CB5A          		BIT	3,D
  E644  2802          		JR	Z,NCL2
  E646  F680          		OR	080H
  E648                	NCL2:
  E648  E5            		PUSH	HL
  E649  21A3EC        		LD	HL,_FATDRV
  E64C  BE            		CP	(HL)
  E64D  2883          		JR	Z,POP_HL_RET
                      	
  E64F  C5            		PUSH	BC
  E650  D5            		PUSH	DE
  E651  DDE5          		PUSH	IX
  E653  F5            		PUSH	AF
  E654  CD1AE6        		CALL	WTFATX
  E657  C1            		POP	BC
  E658  38BC          		JR	C,RDFATE1
  E65A  78            		LD	A,B
  E65B  32A3EC        		LD	(_FATDRV),A
  E65E  CD0BE8        		CALL	RDFATS
  E661  18AD          		JR	RDFATE2
                      	
  E663                	NCL3:
  E663  CB9A          		RES	3,D
  E665  6B            		LD	L,E
  E666  62            		LD	H,D
  E667  CB3C          		SRL	H	;
  E669  CB1D          		RR	L	;HLA=HLA/2
  E66B  1F            		RRA		;
  E66C  ED4B7CEC      		LD	BC,(_FATBF)
  E670  19            		ADD	HL,DE
  E671  09            		ADD	HL,BC
  E672  17            		RLA
  E673  C9            		RET
                      	
  E674                	GNCL:
  E674  CD3BE6        		CALL	NCL1		;GET NEW CLUSTER
  E677  D8            		RET	C
  E678  C5            		PUSH	BC
  E679  E5            		PUSH	HL
  E67A  CD63E6        		CALL	NCL3
  E67D  3809          		JR	C,GNC1
  E67F  5E            		LD	E,(HL)
  E680  23            		INC	HL
  E681  7E            		LD	A,(HL)
  E682  E60F          		AND	00FH
  E684  57            		LD	D,A
  E685  E1            		POP	HL
  E686  C1            		POP	BC
  E687  C9            		RET
  E688                	GNC1:
  E688  7E            		LD	A,(HL)
  E689  23            		INC	HL
  E68A  56            		LD	D,(HL)
  E68B  0604          		LD	B,4
  E68D                	GNC1L:
  E68D  CB3A          		SRL	D	;DA=DA/2
  E68F  1F            		RRA		;
  E690  10FB          		DJNZ	GNC1L
                      	
  E692  5F            		LD	E,A
  E693  E1            		POP	HL
  E694  C1            		POP	BC
  E695  A7            		AND	A
  E696  C9            		RET
                      	
  E697                	SNCL:
  E697  CD3BE6        		CALL	NCL1
  E69A  D8            		RET	C
  E69B  3E01          		LD	A,1
  E69D  32A2EC        		LD	(_WTFATF),A
                      	;				SET NEW CLUSTER
  E6A0  E5            		PUSH	HL
  E6A1  C5            		PUSH	BC
  E6A2  D5            		PUSH	DE
  E6A3  E5            		PUSH	HL
  E6A4  CD63E6        		CALL	NCL3
  E6A7  D1            		POP	DE
                      	;CF=ODD
  E6A8  7E            		LD	A,(HL)
  E6A9  73            		LD	(HL),E
  E6AA  3806          		JR	C,SNC1
                      	;EVEN
                      	;M[0] = E
                      	;M[1] = (M[1] & 0xF0) | (D & 0x0F)
  E6AC  23            		INC	HL
  E6AD  ED67          		RRD		;M={A[3:0],E[3:0]}
  E6AF  7A            		LD	A,D
  E6B0  1804          		JR	SNC11
  E6B2                	SNC1:
                      	;ODD
                      	;HL[0] = (HL[0]&0x0F) | (E<<4)
                      	;HL[1] = DE>>4
  E6B2  ED6F          		RLD		;M={D[3:0],E[7:4]}
  E6B4  23            		INC	HL
  E6B5  72            		LD	(HL),D	;M={D[3:0],E[7:4]}
  E6B6                	SNC11:
  E6B6  ED6F          		RLD		;M={M[7:4],D[3:0]}
  E6B8  B7            		OR	A
  E6B9  D1            		POP	DE
  E6BA  C1            		POP	BC
  E6BB  E1            		POP	HL
  E6BC  C9            		RET
                      	
                      	
                      	;------------------------
                      	;次のセクタを探す際に「1クラスタの論理セクタ数」を掛けてまとめて扱う
                      	;in
                      	;	DE : セクタ番号
                      	;out
                      	;	DE : まとめた値
                      	;note
                      	;	「FAT12」最大12ビット + 「1クラスタの論理セクタ数」4ビットで計16ビットとして扱う
                      	;------------------------
  E6BD                	GNCLX:
  E6BD  7B            		LD	A,E
  E6BE  3C            		INC	A
  E6BF  E600          	NCPAT:	AND	0	;自己書き換え　1クラスタの論理セクタ数-1
  E6C1  2802          		JR	Z,GNCLX1
  E6C3  13            		INC	DE	;クラスタを跨がない場合は単純に+1する
  E6C4  C9            		RET
  E6C5                	GNCLX1:
  E6C5  CDD8E6        		CALL	DIVSPC	;クラスタを跨ぐ場合は
  E6C8  CDF7EC        		CALL	_GNCL	;次のクラスタを探す
                      	
                      	;------------------------
                      	;クラスタと「1クラスタの論理セクタ数」を掛ける
                      	;in
                      	;	DE : セクタ番号
                      	;out
                      	;	DE : 掛けられた値
                      	;note
                      	;	DE以外のレジスタとフラグは保持する
                      	;------------------------
  E6CB                	MULSPC:
  E6CB  F5            		PUSH	AF
  E6CC  EB            		EX	DE,HL
  E6CD  3E01          	SPCPAT:	LD	A,1		;自己書き換え（1クラスタの論理セクタ数）
  E6CF                	CLDBL:
  E6CF  0F            		RRCA			;->CF
  E6D0  3803          		JR	C,CLDBL_RET
  E6D2  29            		ADD	HL,HL		;*2
  E6D3  18FA          		JR	CLDBL
  E6D5                	CLDBL_RET:
  E6D5  EB            		EX	DE,HL
  E6D6                	POP_AF_RET
  E6D6  F1            		POP	AF
  E6D7  C9            		RET
                      	
                      	;------------------------
                      	;「1クラスタの論理セクタ数」を割って論理セクタだけに戻す
                      	;in
                      	;	DE : 掛けられた値
                      	;out
                      	;	DE : セクタ番号
                      	;note
                      	;	DE以外のレジスタとフラグは保持する
                      	;------------------------
  E6D8                	DIVSPC:
  E6D8  F5            		PUSH	AF
  E6D9  3ACEE6        		LD	A,(SPCPAT+1)	;1クラスタの論理セクタ
  E6DC                	CLDIV1:
  E6DC  0F            		RRCA			;->CF
  E6DD  38F7          		JR	C,POP_AF_RET
  E6DF  CB3A          		SRL	D		;DE=DE/2
  E6E1  CB1B          		RR	E		; 
  E6E3  18F7          		JR	CLDIV1
                      	
  E6E5                	RDFAT0X:
  E6E5  CD0BE8        		CALL	RDFATS
  E6E8  D8            		RET	C
  E6E9  DDBE01        		CP	(IX+1)		;DPB_01_FATID
  E6EC  C8            		RET	Z
  E6ED  37            		SCF
  E6EE  C9            		RET
                      	
  E6EF                	RDFAT:
  E6EF  3A88EC        		LD	A,(_DRV)
  E6F2  CD49E9        		CALL	CHGDRVR
  E6F5  D8            		RET	C
  E6F6  DD7E12        		LD	A,(IX+012H)	;DPB_12_DEVNO
  E6F9  FE87          		CP	087H
  E6FB  20E8          		JR	NZ,RDFAT0X
                      	
  E6FD  3E7F          		LD	A,07FH
  E6FF  32F3EB        		LD	(CHECK),A	;A=07FH
  E702  DDCB0A46      		BIT	0,(IX+00AH)	;DPB_0A_FDMODE
  E706  284D          		JR	Z,X2HX
  E708                	E2DX:
  E708  2140EB        		LD	HL,M2D
  E70B  CDD8E7        		CALL	DRDF
  E70E  383D          		JR	C,E2HX
  E710  FEFD          		CP	0FDH		;2D
  E712  C8            		RET	Z
  E713  FEF9          		CP	0F9H		;2DD9
  E715  CABFE7        		JP	Z,E2DD9
  E718  FEFB          		CP	0FBH		;2DD8
  E71A  37            		SCF
  E71B  C0            		RET	NZ		;NOT 2DD
  E71C  214EEB        		LD	HL,M2DD8
  E71F                	CHGTYPE:
  E71F  D5            		PUSH	DE
  E720  CD32E7        		CALL	CHGDV
  E723  3A84EC        		LD	A,(_DRIVE)
  E726  E603          		AND	3
  E728  F680          		OR	080H
  E72A  6F            		LD	L,A
  E72B  26EC          		LD	H,_CYL0/256
  E72D  3EFF          		LD	A,0FFH
  E72F  77            		LD	(HL),A
  E730  D1            		POP	DE
  E731  C9            		RET
                      	
  E732                	CHGDV:
  E732  DDE5          		PUSH	IX
  E734  D1            		POP	DE
  E735  EDA0          		LDI
  E737  EDA0          		LDI
  E739  13            		INC	DE
  E73A  13            		INC	DE
  E73B  13            		INC	DE
  E73C  13            		INC	DE
  E73D  010C00        		LD	BC,12
  E740  EDB0          		LDIR
  E742                	CHGDV2:
  E742  3EFF          		LD	A,0FFH
  E744  3289EC        		LD	(_DSK),A
  E747  3A88EC        		LD	A,(_DRV)
  E74A  C3D9EC        		JP	_CHGDRV
                      	
  E74D                	E2HX:
  E74D  3C            		INC	A
  E74E  C8            		RET	Z
  E74F  21F3EB        		LD	HL,CHECK
  E752  CB06          		RLC	(HL)
  E754  D8            		RET	C
  E755                	X2HX:
  E755  2178EB        		LD	HL,M2HD
  E758  110000        		LD	DE,0
  E75B  CDDCE7        		CALL	DRDD
  E75E  300A          		JR	NC,X2HX1
  E760  3C            		INC	A
  E761  C8            		RET	Z
  E762  21F3EB        		LD	HL,CHECK
  E765  CB06          		RLC	(HL)
  E767  D8            		RET	C
  E768  189E          		JR	E2DX
  E76A                	X2HX1:
  E76A  23            		INC	HL
  E76B  7E            		LD	A,(HL)
  E76C  06FE          		LD	B,0FEH
  E76E  FE0C          		CP	00CH
  E770  2838          		JR	Z,X2HDE
  E772  06F8          		LD	B,0F8H
  E774  D620          		SUB	020H		;020H
  E776  2832          		JR	Z,X2HDE
  E778  3C            		INC	A		;01FH
  E779  282F          		JR	Z,X2HDE
  E77B  3C            		INC	A		;01EH
  E77C  206C          		JR	NZ,C2HX		;2HD/2HC/2HQ
  E77E                	X2HS:
  E77E  21A2EB        		LD	HL,M2HS
  E781  CDB0E7        		CALL	X2HSS
  E784  D8            		RET	C
  E785  2A7CEC        		LD	HL,(_FATBF)
  E788  23            		INC	HL
  E789  7E            		LD	A,(HL)		;FATBF+1
  E78A  FE50          		CP	80
  E78C  3F            		CCF
  E78D  D0            		RET	NC
  E78E  FE5A          		CP	90
  E790  D0            		RET	NC
  E791  DD770C        		LD	(IX+00CH),A	;DPB_0C_MAXCYL
  E794  D650          		SUB	80
  E796  87            		ADD	A,A	;*2
  E797  4F            		LD	C,A
  E798  87            		ADD	A,A	;*4
  E799  87            		ADD	A,A	;*8
  E79A  87            		ADD	A,A	;*16
  E79B  81            		ADD	A,C	;*18
  E79C  C698          		ADD	A,098H
  E79E  DD7708        		LD	(IX+8),A	;DPB_08_MAXCL_LOW
  E7A1  3E05          		LD	A,5
  E7A3  CE00          		ADC	A,0
  E7A5  DD7709        		LD	(IX+9),A	;DPB_08_MAXCL_HIGH
  E7A8  1898          		JR	CHGDV2
  E7AA                	X2HDE:
  E7AA  2194EB        		LD	HL,M2HDE
  E7AD  23            		INC	HL
  E7AE  70            		LD	(HL),B
  E7AF  2B            		DEC	HL
  E7B0                	X2HSS:
  E7B0  CDD8E7        		CALL	DRDF
  E7B3  D8            		RET	C
  E7B4  DDBE01        		CP	(IX+1)		;DPB_01_FATID
  E7B7  37            		SCF
  E7B8  C0            		RET	NZ
  E7B9  CDC8E7        		CALL	INCDRD
  E7BC  300E          		JR	NC,DRD_DPB
  E7BE  C9            		RET
                      	
  E7BF                	E2DD9:
  E7BF  215CEB        		LD	HL,M2DD
  E7C2  CD1FE7        		CALL	CHGTYPE
  E7C5  2A7CEC        		LD	HL,(_FATBF)
  E7C8                	INCDRD:
  E7C8  24            		INC	H
  E7C9  24            		INC	H
  E7CA  24            		INC	H
  E7CB  24            		INC	H
  E7CC                	DRD_DPB:
  E7CC  DDE5          		PUSH	IX
  E7CE  DD2AA8EC      		LD	IX,(_DPB)
  E7D2  CD56EA        	DRDPAT:	CALL	FDRD		;自己書き換え（ディスク読み込み）
  E7D5  DDE1          		POP	IX
  E7D7  C9            		RET
                      	
  E7D8                	DRDF:
  E7D8  ED5BFAEB      		LD	DE,(_FATPS)
  E7DC                	DRDD:
  E7DC  CD1FE7        		CALL	CHGTYPE
  E7DF  2A7CEC        		LD	HL,(_FATBF)
  E7E2  E5            		PUSH	HL
  E7E3  CDCCE7        		CALL	DRD_DPB
  E7E6  E1            		POP	HL
  E7E7  D8            		RET	C
  E7E8  7E            		LD	A,(HL)
  E7E9  C9            		RET
                      	
  E7EA                	C2HX:
  E7EA  CD0BE8        		CALL	RDFATS
  E7ED  D8            		RET	C
  E7EE  FEFE          		CP	0FEH	;2HD
  E7F0  C8            		RET	Z
  E7F1  2186EB        		LD	HL,M2HQ
  E7F4  FEF0          		CP	0F0H
  E7F6  2807          		JR	Z,X2HQ
  E7F8  FEF9          		CP	0F9H
  E7FA  37            		SCF
  E7FB  C0            		RET	NZ
  E7FC  216AEB        		LD	HL,M2HC
  E7FF                	X2HQ:
  E7FF  CD1FE7        		CALL	CHGTYPE
  E802  CD4EE8        		CALL	FATS2
  E805  24            		INC	H	;先頭の1セクタはすでに読み込まれているのでスキップ
  E806  24            		INC	H
  E807  05            		DEC	B
  E808  13            		INC	DE
  E809  1804          		JR	RDFATL
  E80B                	RDFATS:
  E80B  CD47E8        		CALL	FATS
  E80E  D8            		RET	C
  E80F                	RDFATL:
  E80F  C5            		PUSH	BC
  E810  CDCCE7        		CALL	DRD_DPB
  E813  C1            		POP	BC
  E814  D8            		RET	C
  E815  10F8          		DJNZ	RDFATL
  E817  2A7CEC        		LD	HL,(_FATBF)
  E81A  7E            		LD	A,(HL)
  E81B  C9            		RET
                      	
  E81C                	DWT_DPB:
  E81C  DDE5          		PUSH	IX
  E81E  DD2AA8EC      		LD	IX,(_DPB)
  E822  CD4DEA        	DWTPAT:	CALL	FDWT		;自己書き換え（ディスク書き込み）
  E825  DDE1          		POP	IX
  E827  C9            		RET
                      	
  E828                	WTFAT:
  E828  CD47E8        		CALL	FATS
  E82B  D43EE8        		CALL	NC,WTFATL
  E82E  D8            		RET	C
  E82F  DDCB0F7E      		BIT	7,(IX+00FH)	;DPB_0F_BPS
  E833  C8            		RET	Z		;予備FATが無い
  E834  CD4EE8        		CALL	FATS2
  E837  DD7E00        		LD	A,(IX+0)	;DPB_00_FATLN
  E83A                	WTFAT2:
  E83A  13            		INC	DE
  E83B  3D            		DEC	A
  E83C  20FC          		JR	NZ,WTFAT2
  E83E                	WTFATL:
  E83E  C5            		PUSH	BC
  E83F  CD1CE8        		CALL	DWT_DPB
  E842  C1            		POP	BC
  E843  D8            		RET	C
  E844  10F8          		DJNZ	WTFATL
  E846  C9            		RET
                      	;------------------------
                      	;FATのセットアップ
                      	;out
                      	;	B  : FATセクタ数
                      	;	DE : FAT先頭セクタ番号
                      	;	HL : FATバッファポインタ
                      	;	CF : 1=ドライブ切り替えエラー
                      	;note
                      	;	FATサイズがFATバッファを超える場合は
                      	;	対象クラスタ領域==(_FATDRV).bit7によって
                      	;	FATの前半3KBと後半3KBを切り替える
                      	;------------------------
  E847                	FATS:
  E847  3AA3EC        		LD	A,(_FATDRV)
  E84A  CD49E9        		CALL	CHGDRVR		;ドライブ切り替え
  E84D  D8            		RET	C
  E84E                	FATS2:
  E84E  ED5BFAEB      		LD	DE,(_FATPS)	;fat sector pos
  E852  2A7CEC        		LD	HL,(_FATBF)
  E855  DD4600        		LD	B,(IX+0)	;DPB_00_FATLN
  E858  3E06          		LD	A,6		;3072 / 512 FATバッファに読み込めるセクタ数
  E85A  DDCB0F56      		BIT	2,(IX+00FH)	;DPB_0F_BPS
  E85E  2801          		JR	Z,FATS512
  E860  1F            		RRA			;A=3 (3072÷1024: 1セクタ1024バイトの場合)
  E861                	FATS512:
  E861  B8            		CP	B
  E862  D0            		RET	NC		;DPB_00_FATLN x sectorSize < fatBufSize
                      	;targetCluster
  E863  4F            		LD	C,A		;C = skipCount
  E864  3AA3EC        		LD	A,(_FATDRV)	;bit7 = (targetCluster >= 0x800)
  E867  87            		ADD	A,A		;CF=(_FATDRV).bit7
  E868  3006          		JR	NC,FATS3
                      	;(targerCluster>=0x800)
  E86A                	FAT_SKP:
  E86A  13            		INC	DE		;FATPS++
  E86B  05            		DEC	B		;FATSIZE--
  E86C  0D            		DEC	C		;skipCnt--
  E86D  20FB          		JR	NZ,FAT_SKP
  E86F  48            		LD	C,B
  E870                	FATS3:
  E870  41            		LD	B,C		;3 or 6
  E871  AF            		XOR	A
  E872  C9            		RET
                      	
  E873                	CHGDRV:
  E873  E67F          		AND	07FH
  E875  E5            		PUSH	HL
  E876  2189EC        		LD	HL,_DSK
  E879  BE            		CP	(HL)
  E87A  280A          		JR	Z,CHGDRVE
  E87C                	CHGDRV1:
  E87C  DDE5          		PUSH	IX
  E87E  CD88E8        		CALL	CHGDRV0
  E881  3A89EC        		LD	A,(_DSK)
  E884  DDE1          		POP	IX
  E886                	CHGDRVE:
  E886  E1            		POP	HL
  E887  C9            		RET
                      	
  E888                	CHGDRV0:
  E888  6F            		LD	L,A
  E889  CDDCEC        		CALL	_GETDPB
  E88C  D8            		RET	C
                      	
  E88D  DD22A8EC      		LD	(_DPB),IX
  E891  7D            		LD	A,L
  E892  3289EC        		LD	(_DSK),A
                      	
  E895  F3            		DI
  E896  ED7306E9      		LD	(SPPAT2+1),SP
                      	
  E89A  DDF9          		LD	SP,IX
                      	
  E89C  E1            		POP	HL		;L=DPB_00_FATLN H=DPB_01_FATID
  E89D  E1            		POP	HL		;DPB_02_DRD
  E89E  22D3E7        		LD	(DRDPAT+1),HL
                      	
  E8A1  E1            		POP	HL
  E8A2  2223E8        		LD	(DWTPAT+1),HL	;DPB_04_DWT
                      	
  E8A5  E1            		POP	HL		;L=DPB_06_ADDCL H=DPB_07_SECPCL
  E8A6  7D            		LD	A,L
  E8A7  32D8DF        		LD	(CLSPAT+1),A
  E8AA  7C            		LD	A,H
  E8AB  32CEE6        		LD	(SPCPAT+1),A	;1クラスタの論理セクタ数
  E8AE  3D            		DEC	A
  E8AF  32C0E6        		LD	(NCPAT+1),A
                      	
  E8B2  E1            		POP	HL		;DPB_08_MAXCL
  E8B3  7D            		LD	A,L
  E8B4  32E5DF        		LD	(CLPAT2+1),A
  E8B7  7C            		LD	A,H
  E8B8  32E1DF        		LD	(CLPAT1+1),A
  E8BB  2B            		DEC	HL
  E8BC  22EFE1        		LD	(MAXCLP+1),HL
                      	
  E8BF  E1            		POP	HL		;L=DPB_0A_FDMODE H=DPB_0B_MAXDIR
  E8C0  7D            		LD	A,L
  E8C1  F6FE          		OR	0FEH
  E8C3  32F8E9        		LD	(FDMODE+1),A
  E8C6  07            		RLCA
  E8C7  E603          		AND	3
  E8C9  32E0E9        		LD	(FSPAT+1),A
  E8CC  7C            		LD	A,H
  E8CD  3284DE        		LD	(RTEPAT+1),A	;DPB_0B_MAXDIR
                      	
  E8D0  E1            		POP	HL		;L=DPB_0C_MAXCYL H=DPB_0D_MAXSEC
  E8D1  7D            		LD	A,L
  E8D2  32A1EC        		LD	(_MAXCYL),A
  E8D5  7C            		LD	A,H
  E8D6  3288E9        		LD	(MAXSEC+1),A
                      	
  E8D9  E1            		POP	HL		;L=DPB_0E_FATPS H=DPB_0F_BPS
  E8DA  2600          		LD	H,0
  E8DC  22FAEB        		LD	(_FATPS),HL
                      	
  E8DF  E1            		POP	HL		;L=DPB_10_DIRPS H=DPB_11_MINSEC
  E8E0  7C            		LD	A,H
  E8E1  3295E9        		LD	(SECPAT+1),A
  E8E4  2600          		LD	H,0
  E8E6  22FCEB        		LD	(_DIRPS),HL
                      	
  E8E9  E1            		POP	HL		;L=DPB_12_DEVNO H=DPB_13_UNITNO
  E8EA  7C            		LD	A,H
  E8EB  3284EC        		LD	(_DRIVE),A
                      	
  E8EE  E1            		POP	HL		;DPB_14
  E8EF  E1            		POP	HL		;DPB_16_GNCL
  E8F0  7C            		LD	A,H
  E8F1  B5            		OR	L
  E8F2  2003          		JR	NZ,OGNCL
  E8F4  2174E6        		LD	HL,GNCL		;FAT12(default)
  E8F7                	OGNCL:
  E8F7  22F8EC        		LD	(_GNCL+1),HL
                      	
  E8FA  E1            		POP	HL		;DPB_18_SNCL
  E8FB  7C            		LD	A,H
  E8FC  B5            		OR	L
  E8FD  2003          		JR	NZ,OSNCL
  E8FF  2197E6        		LD	HL,SNCL		;FAT12(default)
  E902                	OSNCL:
  E902  22FBEC        		LD	(_SNCL+1),HL
                      	
  E905  310000        	SPPAT2:	LD	SP,0		;元のSPを復元
  E908  FB            		EI
  E909  D5            		PUSH	DE
  E90A  DDCB0F56      		BIT	2,(IX+00FH)	;DPB_0F_BPS
  E90E  200A          		JR	NZ,NEC1024
                      					;1セクタ512 2D/2DD/2HC/2HQ(2HD1.44MB)等
  E910  111802        		LD	DE,00218H	;JR +2(直後のRR Cを飛ばす)
  E913  210000        		LD	HL,0
                      	
  E916  3E01          		LD	A,1
  E918  1808          		JR	NEC1
  E91A                	NEC1024:
                      					;1セクタ1024 2HD/EMM/BRAM/GRAM等
  E91A  11            		DB	011H		;LD DE,SRL B
  E91B  CB38          		SRL B			;
  E91D  21            		DB	021H		;LD HL,SRL A
  E91E  CB3F          		SRL A			;
                      	
  E920  3E03          		LD	A,3
  E922                	NEC1:				;1024	512
  E922  320ADF        		LD	(SECSZM1+2),A	;3	1	1セクタのサイズ-1したものの上位1バイト (0x3FF - 0x1FF)
  E925  3C            		INC	A		;4	2
  E926  322CE5        		LD	(SECSZ+2),A	;1セクタのサイズの上位1バイト 0x400 - 0x200
  E929  87            		ADD	A,A		;8	4
  E92A  87            		ADD	A,A		;010H	8
  E92B  87            		ADD	A,A		;020H	010H
  E92C  3269DE        		LD	(IBM1+1),A	;1セクタ辺りのディレクトリエントリ数
  E92F  87            		ADD	A,A		;040H	020H
  E930  87            		ADD	A,A		;080H	040H
  E931  87            		ADD	A,A		;000H	080H
  E932  2F            		CPL			;0FFH	07FH
  E933  32ADD4        		LD	(IBM2+1),A
  E936  ED53BBE1      		LD	(IBM4),DE
  E93A  2250E5        		LD	(IBM8),HL
  E93D  D1            		POP	DE
  E93E  AF            		XOR	A
  E93F  C9            		RET
                      	
  E940                	GETDPBD:
  E940  DDE3          		EX	(SP),IX
  E942  DDE5          		PUSH	IX
  E944  3A88EC        		LD	A,(_DRV)
  E947  1807          		JR	GETDPB1
                      	
  E949                	CHGDRVR:
  E949  CDD9EC        		CALL	_CHGDRV
  E94C  D8            		RET	C
  E94D  3A89EC        		LD	A,(_DSK)
  E950                	GETDPB1:
  E950  C3DCEC        		JP	_GETDPB
                      	
  E953                	GETDPB:
  E953  FE08          		CP	8
  E955  3F            		CCF
  E956  D8            		RET	C
  E957  87            		ADD	A,A	;*2
  E958  87            		ADD	A,A	;*4
  E959  87            		ADD	A,A	;*8
  E95A  87            		ADD	A,A	;*16
  E95B  87            		ADD	A,A	;*32
                      	;	LD	IXL,A		;OHM-Z80固有マクロ
  E95C  DD            		DB	0DDH		;Z80未定義命令
  E95D  6F            		LD	L,A		;
                      	;	LD	IXH,DEVICE/256	;OHM-Z80固有マクロ
  E95E  DD            		DB	0DDH		;Z80未定義命令
  E95F  26ED          		LD	H,DEVICE/256	;
  E961  DD7E00        		LD	A,(IX+0)	;DPB_00_FATLN
  E964  FE01          		CP	001H		;A=0 THEN CF=1
  E966  C9            		RET
                      	
  E967                	FFLUSH:
  E967  F5            		PUSH	AF
  E968  3EFF          		LD	A,0FFH
  E96A  32B4E2        		LD	(SFILE),A
  E96D  CDD4E5        		CALL	DWTX
  E970  3EFF          		LD	A,0FFH
  E972  32A5EC        		LD	(_DBDRV),A
  E975  CD1AE6        		CALL	WTFATX
  E978  3EFF          		LD	A,0FFH
  E97A  32A3EC        		LD	(_FATDRV),A
  E97D  F1            		POP	AF
  E97E  C9            		RET
                      	
                      	
                      	;LDDISK.ASM
                      	
                      	;	LSX-Dodgers DISK
                      	
                      	
  E97F                	SEEK:
  E97F  7A            		LD	A,D
  E980  B3            		OR	E
  E981  3E01          		LD	A,001H
  E983  2812          		JR	Z,DIV3
                      	
  E985  0610          		LD	B,16
  E987  0E00          	MAXSEC:	LD	C,000H
  E989  AF            		XOR	A
  E98A  EB            		EX	DE,HL
  E98B                	DIV1:
  E98B  29            		ADD	HL,HL
  E98C  8F            		ADC	A,A
  E98D  B9            		CP	C
  E98E  3802          		JR	C,DIV2
  E990  91            		SUB	C
  E991  2C            		INC	L
  E992                	DIV2:
  E992  10F7          		DJNZ	DIV1
                      	
  E994  C601          	SECPAT:	ADD	A,001H		;(Self-rewriting)
  E996  55            		LD	D,L	;Quotient(TRACK)
  E997                	DIV3:
  E997  5F            		LD	E,A	;Remainder
  E998  CB3A          		SRL	D	;CYLINDER
  E99A  9F            		SBC	A,A
  E99B  E610          		AND	010H	;SIDE
  E99D  4F            		LD	C,A
                      	
  E99E  3A84EC        		LD	A,(_DRIVE)
  E9A1  FE04          		CP	4
  E9A3  3F            		CCF
  E9A4  D8            		RET	C
  E9A5  B1            		OR	C
  E9A6  3224EA        		LD	(MOPAT+1),A	;Motor off data
  E9A9  01FC0F        		LD	BC,00FFCH
  E9AC  F680          		OR	080H		;Mortor on
  E9AE  ED79          		OUT	(C),A
                      	
  E9B0  CDF6E9        		CALL	SETMODE
  E9B3  D8            		RET	C
                      	
  E9B4  CD39EA        		CALL	DRIVE
  E9B7  FEFF          		CP	0FFH		;A=0FFH Unknown CYLINDER
  E9B9  CC18EA        		CALL	Z,FDCRES	;Restore
  E9BC  0EF9          		LD	C,0F9H
  E9BE  ED79          		OUT	(C),A		;Currrent CYLINDER
  E9C0  92            		SUB	D
  E9C1  C8            		RET	Z		;No seek
                      	
  E9C2  3A86EC        		LD	A,(_ISEEK)
  E9C5  4F            		LD	C,A
                      	
  E9C6  3AA1EC        		LD	A,(_MAXCYL)	;Max CYLINDER
  E9C9  3D            		DEC	A
  E9CA  BA            		CP	D		;Over CYLINDER
  E9CB  D8            		RET	C
                      	
  E9CC  B9            		CP	C		;for Built-in 2DD
  E9CD  3803          		JR	C,SETM2
  E9CF  78            		LD	A,B		;B=00FH
  E9D0  DBFE          		IN	A,(0FEH)		;2HD mode for 2DD seek
  E9D2                	SETM2:
  E9D2  78            		LD	A,B
  E9D3  DBFD          		IN	A,(0FDH)		;MFM mode
                      	
  E9D5  0EFB          		LD	C,0FBH
  E9D7  ED51          		OUT	(C),D
  E9D9  72            		LD	(HL),D
  E9DA  0E18          		LD	C,018H		;Seek
  E9DC                	FDCCMD2:
  E9DC  3A85EC        		LD	A,(_SEEKSP)
  E9DF  E6FF          	FSPAT:	AND	0FFH
  E9E1  B1            		OR	C
                      	
  E9E2                	FDCCMD:
  E9E2  CD2FEA        		CALL	COMSET
                      	
  E9E5  3E80          	FDCPAT:	LD	A,080H		;FDC COMMAND(Self-rewriting)
  E9E7  E620          		AND	020H		;Write data Write track
  E9E9  3C            		INC	A
                      	
  E9EA                	SST:
  E9EA  0E00          		LD	C,0
  E9EC                	SST1:
  E9EC  0D            		DEC	C		; 4
  E9ED  20FD          		JR	NZ,SST1		;12 * 256 / 4 = About 1ms
  E9EF  3D            		DEC	A
  E9F0  20FA          		JR	NZ,SST1
                      	
  E9F2  3C            		INC	A		;A=1
  E9F3  CD01EA        		CALL	READY
  E9F6                	SETMODE:
  E9F6  78            		LD	A,B		;B=00FH
  E9F7  DBFF          	FDMODE:	IN	A,(0FFH)		;Floppy mode(2D/2HD) (Self-rewriting)
                      	
  E9F9  78            		LD	A,B
  E9FA  DBFD          		IN	A,(0FDH)		;MFM mode
                      	
  E9FC  CD33EA        		CALL	DELAY0		;Head select time
  E9FF  3E81          		LD	A,081H
  EA01                	READY:
  EA01  320BEA        		LD	(WAITA+1),A
  EA04  E5            		PUSH	HL
  EA05  0EF8          		LD	C,0F8H
  EA07  61            		LD	H,C
  EA08                	READY2:
  EA08  ED78          		IN	A,(C)
  EA0A  E681          	WAITA:	AND	081H		;NOT READY,BUSY
  EA0C  2808          		JR	Z,READYE
  EA0E  E3            		EX	(SP),HL		;wait 19clock
  EA0F  E3            		EX	(SP),HL		; //
  EA10  2B            		DEC	HL
  EA11  7C            		LD	A,H
  EA12  B5            		OR	L
  EA13  20F3          		JR	NZ,READY2
  EA15  37            		SCF
  EA16                	READYE:
  EA16  E1            		POP	HL
  EA17  C9            		RET
                      	
  EA18                	FDCRES:
  EA18  3600          		LD	(HL),0
  EA1A  0E08          		LD	C,8
  EA1C  18BE          		JR	FDCCMD2
                      	
  EA1E                	FDMOFF:
  EA1E  F5            		PUSH	AF
  EA1F  C5            		PUSH	BC
  EA20  01FC0F        		LD	BC,00FFCH	;Motor off
  EA23  3E00          	MOPAT:	LD	A,000H		;(Self-rewriting)
  EA25  ED79          		OUT	(C),A
  EA27  C1            		POP	BC
  EA28  F1            		POP	AF
  EA29  C9            		RET
                      	
  EA2A                	SECSET:
  EA2A  01FA0F        		LD	BC,00FFAH
  EA2D  ED59          		OUT	(C),E
  EA2F                	COMSET:
  EA2F  0EF8          		LD	C,0F8H
  EA31  ED79          		OUT	(C),A
  EA33                	DELAY0:
  EA33  3E1A          		LD	A,26
  EA35                	DELAY:
  EA35  3D            		DEC	A
  EA36  20FD          		JR	NZ,DELAY
  EA38  C9            		RET
                      	
  EA39                	DRIVE:
  EA39  2A84EC        		LD	HL,(_DRIVE)
  EA3C  26EC          		LD	H,_CYL0/256
  EA3E  CBFD          		SET	7,L
  EA40  7E            		LD	A,(HL)
  EA41  C9            		RET
                      	
  EA42                	RNF:
  EA42  CD39EA        		CALL	DRIVE
  EA45  36FF          		LD	(HL),0FFH
  EA47  C9            		RET
                      	
  EA48  02            	RETRY:	DB	2
                      	
                      	
                      	;	FLOPPY DISK DRIVER(DMA)
                      	
                      	
  EA49                	WTTRK:
  EA49  3EF4          		LD	A,0F4H
  EA4B  1802          		JR	WTTRK1
  EA4D                	FDWT:
  EA4D  3EA0          		LD	A,0A0H
  EA4F                	WTTRK1:
  EA4F  32E6E9        		LD	(FDCPAT+1),A
  EA52  3E10          		LD	A,16
  EA54  1807          		JR	DISK
                      	
  EA56                	FDRD:
  EA56  3E80          		LD	A,080H
  EA58  32E6E9        		LD	(FDCPAT+1),A
  EA5B  3E0E          		LD	A,14
                      	
  EA5D                	DISK:
  EA5D  3270EA        		LD	(DMAPAT+1),A
                      	
  EA60  22FBEA        		LD	(DMAD+11),HL
  EA63                	DISKR:
  EA63  3E02          		LD	A,2		;Retry count
  EA65  3248EA        		LD	(RETRY),A
  EA68                	DISK2:
  EA68  D5            		PUSH	DE
  EA69  CD7FE9        		CALL	SEEK
  EA6C  3842          		JR	C,ERRF
  EA6E  F3            		DI
                      	
  EA6F  3E0E          	DMAPAT:	LD	A,14		;・ｽ・ｽ・ｽﾈ擾ｿｽ・ｽ・ｽ・ｽ・ｽ・ｽ・ｽ
  EA71  21F0EA        		LD	HL,DMAD
  EA74  CDE6EA        		CALL	SETDMA
  EA77  ED49          		OUT	(C),C		;OUT 01F87H,087H
  EA79  3AE6E9        		LD	A,(FDCPAT+1)
  EA7C  C5            		PUSH	BC
  EA7D  CD2AEA        		CALL	SECSET
  EA80  2AFBEA        		LD	HL,(DMAD+11)
  EA83  23            		INC	HL
  EA84  1106BB        		LD	DE,0BB06H	;READ DMA
                      	
  EA87  3E03          		LD	A,3
  EA89  CD01EA        		CALL	READY
  EA8C  ED78          		IN	A,(C)
                      	
  EA8E  C1            		POP	BC
  EA8F  ED51          		OUT	(C),D
  EA91  ED59          		OUT	(C),E
  EA93  ED58          		IN	E,(C)
  EA95  ED50          		IN	D,(C)
  EA97  19            		ADD	HL,DE
  EA98  D1            		POP	DE
  EA99  13            		INC	DE
  EA9A  FB            		EI
  EA9B  CD1EEA        		CALL	FDMOFF
  EA9E  B7            		OR	A
  EA9F  C8            		RET	Z
  EAA0  1B            		DEC	DE
  EAA1  CB67          		BIT	4,A
  EAA3  C442EA        		CALL	NZ,RNF
  EAA6                	DISKE2:
  EAA6  2148EA        		LD	HL,RETRY
  EAA9  35            		DEC	(HL)
  EAAA  20BC          		JR	NZ,DISK2
  EAAC  B7            		OR	A
  EAAD  2834          		JR	Z,ERR
  EAAF  D5            		PUSH	DE
  EAB0                	ERRF:
  EAB0  D1            		POP	DE
  EAB1                	DELP:
  EAB1  CD42EA        		CALL	RNF
  EAB4  CD1EEA        		CALL	FDMOFF
  EAB7  3A85EC        		LD	A,(_SEEKSP)
  EABA  87            		ADD	A,A
  EABB  9F            		SBC	A,A
  EABC  3825          		JR	C,ERR
  EABE                	DELP1:
  EABE  D5            		PUSH	DE
  EABF  21B0EB        		LD	HL,DEMES
  EAC2  CDCBD8        		CALL	MSX
  EAC5  CDB0D7        		CALL	KEYBC
  EAC8                	DELP2:
  EAC8  CDCAEC        		CALL	_INKEY
  EACB  28FB          		JR	Z,DELP2
                      	
  EACD  D1            		POP	DE
  EACE  CDE7DF        		CALL	CAP
  EAD1  FE52          		CP	'R'		;Retry
  EAD3  CA63EA        		JP	Z,DISKR
  EAD6  FE49          		CP	'I'		;Ignore
  EAD8  2807          		JR	Z,IGNORE
  EADA  FE41          		CP	'A'		;Abort
  EADC  20E0          		JR	NZ,DELP1
  EADE  C3B4D3        		JP	BOOT
  EAE1                	IGNORE:
  EAE1  3EFF          		LD	A,0FFH
  EAE3                	ERR:
  EAE3  BF            		CP	A
  EAE4  37            		SCF
  EAE5  C9            		RET
                      	
  EAE6                	SETDMA:
  EAE6  01871F        		LD	BC,01F87H
  EAE9                	SDMA:
  EAE9  04            		INC	B
  EAEA  EDA3          		OUTI
  EAEC  3D            		DEC	A
  EAED  20FA          		JR	NZ,SDMA
  EAEF  C9            		RET
                      	
  EAF0  C37DFB0FFFFF2C	DMAD:	DB	0C3H,07DH,0FBH,00FH,0FFH,0FFH,02CH,010H		;X1turbo
  EAF8  80928D0000CF01		DB	080H,092H,08DH,000H,000H,0CFH,001H,0CFH		;DISK DMA
                      	
  EB00                	DMAE:
                      	
  1F8D                	AT_R	EQU	WTTRK-AT_WTTRK
                      	
                      	;LDCALL.ASM
                      	
                      	;	LSX-Dodgers TABLES
                      	;	CTRLTB:アドレス下位1バイトが0になるように
                      	
  EB00                	CTRLTB:
  EB00  F8D993DA30DA83		DW	PRINTE,CTRL01,CTRL02,CTRL03
  EB08  7DDB5BDA5CDBE3		DW	CTRL04,CTRL05,CTRL1A,CTRL07
  EB10  04DA21DA86DB99		DW	CTRL08,CTRL09,CTRL0A,CTRL0B
  EB18  59DB7FDA9BDBF8		DW	CTRL0C,CTRL0D,CTRL0E,PRINTE
  EB20  F8D9F8D993DAF8		DW	PRINTE,PRINTE,CTRL01,PRINTE
  EB28  F8D9F8D9F8D9F8		DW	PRINTE,PRINTE,PRINTE,PRINTE
  EB30  F8D9F8D95CDBA6		DW	PRINTE,PRINTE,CTRL1A,CTRL1B
  EB38  1BDA04DA0EDA86		DW	CTRL1C,CTRL1D,CTRL1E,CTRL1F
                      	
  EB40                	M2D:
  EB40  02FD0802      		DB	2,0FDH,8,2
  EB44  6401          		DW	356
  EB46  FF0C2809018205		DB	0FFH,12,40,9,1,082H,5,1
                      	
  EB4E                	M2DD8:
  EB4E  02FB0802      		DB	2,0FBH,8,2
  EB52  7C02          		DW	636
  EB54  FF0C5008018205		DB	0FFH,12,80,8,1,082H,5,1
                      	
  EB5C                	M2DD:
  EB5C  03F90A02      		DB	3,0F9H,10,2
  EB60  CB02          		DW	715
  EB62  FF0E5009018207		DB	0FFH,14,80,9,1,082H,7,1
                      	
  EB6A                	M2HC:
  EB6A  07F91B01      		DB	7,0F9H,27,1
  EB6E  4509          		DW	2373
  EB70  FE1D500F01820F		DB	0FEH,29,80,15,1,082H,15,1
                      	
  EB78                	M2HD:
  EB78  02FE0901      		DB	2,0FEH,9,1
  EB7C  C704          		DW	1223
  EB7E  FE0B4D08018405		DB	0FEH,11,77,8,1,084H,5,1
                      	
  EB86                	M2HQ:
  EB86  09F01F01      		DB	9,0F0H,31,1
  EB8A  210B          		DW	2849
  EB8C  FE215012018213		DB	0FEH,33,80,18,1,082H,19,1
                      	
  EB94                	M2HDE:
  EB94  03FE0B01      		DB	3,0FEH,11,1
  EB98  9505          		DW	1429
  EB9A  FE0D5009018407		DB	0FEH,13,80,9,1,084H,7,1
                      	
  EBA2                	M2HS:
  EBA2  03FB0801      		DB	3,0FBH,8,1
  EBA6  9805          		DW	1432
  EBA8  FE0A5009010404		DB	0FEH,10,80,9,1,4,4,10
                      	
  EBB0  0307          	DEMES:	DB	3,7
  EBB2  44657669636520		DB	"Device I/O Error",5,3
  EBC4  41626F72742052		DB	"Abort Retry Ignore?",5,3,0
                      	
  EBDA  1617          	SDDATA:	DB	22,23		;(FCB)ファイルを最後に変更した時刻
  EBDC  1415          		DB	20,21		;(FCB)ファイルを最後に変更した日付
  EBDE  1A1B          		DB	26,27		;(FCB)ファイルの先頭クラスタ
  EBE0  10111213      		DB	16,17,18,19	;(FCB)ファイルのサイズ(バイト単位)
  EBE4                	SDDATAE:
                      	
  EBE4  008E01000B000C	BEEPD:	DB	0,08EH,1,0,00BH,0,00CH,010H
  EBEC  073E08100D00FF		DB	007H,03EH,008H,010H,00DH,0,0FFH
                      	
  EBF3  00            	CHECK:	DB	0
                      	
  EBF4                	SCDIR:	DS	2		;+14 +15
  EBF6                	SFBPS:	DS	2		;FBPS
  EBF8                	SFNDF:	DS	2		;FILEN DIRF
                      	
  EBFA  0000          	_FATPS:	DW	0
  EBFC  0000          	_DIRPS:	DW	0
  EBFE  0000          	_CLPS:	DW	0
                      	
  EC00                	_PE:
                      	
                      	;	LSX-Dodgers SYSTEM CALL
                      	;	STABLE:アドレス下位1バイトが0になるように
                      	
  EC00                	STABLE:
                      	;0
  EC00  0000E4D7F0D719		DW	 00000H,_SYS01,_SYS02,_SYS03
  EC08  49CC60CCF5D7BD		DW	_SYS04,_SYS05,_SYS06,_SYS07
  EC10  FDD7F1D336D862		DW	_SYS08,_SYS09,_SYS0A,_SYS0B
  EC18  00D406D415D428		DW	_SYS0C,_SYS0D,_SYS0E,_SYS0F
                      	;1
  EC20  7DD4CAD426D55C		DW	_SYS10,_SYS11,_SYS12,_SYS13
  EC28  64D582D59FD597		DW	_SYS14,_SYS15,_SYS16,_SYS17
  EC30  00D605D60AD610		DW	_SYS18,_SYS19,_SYS1A,_SYS1B
  EC38  EFD335D6EFD339		DW	_SYS1C,_SYS1D,_SYS1E,_SYS1F
                      	;2
  EC40  EFD3D6D5EBD540		DW	_SYS20,_SYS21,_SYS22,_SYS23
  EC48  5FD6E9D30EE336		DW	_SYS24,_ERROR,_SYS26,_SYS27
  EC50  EBD568D678D892		DW	_SYS28,_SYS29,_SYS2A,_SYS2B
  EC58  B2D892DEEFD38B		DW	_SYS2C,_SYS2D,_SYS2E,_SYS2F
                      	;3
  EC60  85D6          		DW	_SYS30
                      	
                      	;LDWORK.ASM
                      	
                      	;	LSX-Dodgers WORK
                      	
  0004                	DDS	EQU	4
  EC62                	DDTB:
  EC62  434F4E20      		DB	"CON "
  EC66  BDD4          		DW	OPENDD
  EC68  41555820      		DB	"AUX "
  EC6C  BDD4          		DW	OPENDD
  EC6E  50524E20      		DB	"PRN "
  EC72  BDD4          		DW	OPENDD
  EC74  4E554C20      		DB	"NUL "
  EC78  BDD4          		DW	OPENDD
                      	
  EC7A                		DS	2
  EC7C  00EE          	_FATBF:	DW	FATBF
  EC7E  00FA          	_DTBUF:	DW	DTBUF
                      	
  EC80  FF            	_CYL0:	DB	0FFH	;Cylinder
  EC81  FF            	_CYL1:	DB	0FFH	;Cylinder
  EC82  FF            	_CYL2:	DB	0FFH	;Cylinder
  EC83  FF            	_CYL3:	DB	0FFH	;Cylinder
  EC84  00            	_DRIVE:	DB	0	;unit number
  EC85  00            	_SEEKSP:DB	0	;Seek speed
  EC86  FF            	_ISEEK:	DB	0FFH	;
  EC87  00            	_DVSW:	DB	0
  EC88  00            	_DRV:	DB	0
  EC89  FF            	_DSK:	DB	0FFH
  EC8A  8000          	_DTA:	DW	00080H
  EC8C  0000          	_CTC:	DW	0
  EC8E  0000          	_TXADR:	DW	0
  EC90  0000          	_KEYPS	DW	0
  EC92  00FF          	_KEYD	DW	0FF00H
  EC94  C210          	_KEYSP:	DW	010C2H
  EC96  07            	_COLORF:DB	7
  EC97  19            	_LINE:	DB	LINE
                      	
  EC98  0000          	_FCB:	DW	0
  EC9A  0000          	_FBPS:	DW	0	;SEARCH FILES
  EC9C  0000          	_FBAD:	DW	0	;    //
  EC9E  00            	_FBCNT:	DB	0	;    //
  EC9F  00            	_FILEN:	DB	0
  ECA0  00            	_DIRF:	DB	0
  ECA1  00            	_MAXCYL:DB	0
  ECA2  00            	_WTFATF:DB	0
  ECA3  FF            	_FATDRV:DB	0FFH
  ECA4  00            	_WTDBF:	DB	0
  ECA5  FF            	_DBDRV:	DB	0FFH
  ECA6  0000          	_DCLPS:	DW	0
  ECA8  0000          	_DPB:	DW	0
                      	
  ECAA                		DS	6
                      	
  ECB0  6F5059381F0219	CRTCD:	DB	06FH,050H,059H,038H,01FH,002H,019H,01CH
  ECB8  0007          		DB	000H,007H
  ECBA  30F8B0FF      		DW	0-80*LINE,0-80
  ECBE  0C            		DB	00CH
  ECBF  A0            	WK1FD0:	DB	0A0H
                      	
  ECC0  14D7          	CTC0:	DW	INTCTCE
  ECC2  14D7          	CTC1:	DW	INTCTCE
  ECC4  3CD7          	CTC2:	DW	INTCTC2
  ECC6  14D7          	CTC3:	DW	INTCTCE
  ECC8  D4D6          	INTVEC:	DW	INT
                      	
                      	;	JUMP
                      	
  ECCA  C3D4DC        	_INKEY:	JP	INKEY
  ECCD  C343D9        	_PRINT:	JP	PRINT
  ECD0  C31FDC        	_SCRN:	JP	SCRN
  ECD3  C347DC        	_POS:	JP	POS
  ECD6  C384DA        	_LOC:	JP	LOC
  ECD9  C373E8        	_CHGDRV:JP	CHGDRV
  ECDC  C353E9        	_GETDPB:JP	GETDPB
  ECDF  C367E9        	_FFLUSH:JP	FFLUSH
  ECE2  C3F2E5        	_RDFATX:JP	RDFATX
  ECE5  C3EFE6        	_RDFAT:	JP	RDFAT
  ECE8  C349EA        	_WTTRK:	JP	WTTRK
  ECEB  C356EA        	_FDRD:	JP	FDRD
  ECEE  C34DEA        	_FDWT:	JP	FDWT
  ECF1  C3CCE7        	_DRD:	JP	DRD_DPB
  ECF4  C31CE8        	_DWT:	JP	DWT_DPB
  ECF7  C374E6        	_GNCL:	JP	GNCL	;(Self-rewriting)
  ECFA  C397E6        	_SNCL:	JP	SNCL	;(Self-rewriting)
  ECFD  C3A9CE        	_COMANL:JP	COMANL
                      	
  ED00                	WE:
                      	
                      	;LDDPB.ASM
                      	
                      	;	LSX-Dodgers DPB
                      	
  ED00                	DEVICE:
                      	
                      	;	A:
                      	
  ED00  02            	DPB_00_FATLN:	DB	2
  ED01  FD            	DPB_01_FATID:	DB	0FDH
  ED02  EBEC          	DPB_02_DRD:	DW	_FDRD
  ED04  EEEC          	DPB_04_DWT:	DW	_FDWT
  ED06  08            	DPB_06_ADDCL:	DB	8
  ED07  02            	DPB_07_SECPCL:	DB	2
  ED08  6401          	DPB_08_MAXCL:	DW	356
  ED0A  FF            	DPB_0A_FDMODE:	DB	0FFH	;0FFH=2D / 0FEH=2HD
  ED0B  0C            	DPB_0B_MAXDIR:	DB	12
  ED0C  28            	DPB_0C_MAXCYL:	DB	40
  ED0D  09            	DPB_0D_MAXSEC:	DB	9	;Number of sectors
  ED0E  01            	DPB_0E_FATPS:	DB	1
  ED0F  82            	DPB_0F_BPS:	DB	082H
  ED10  05            	DPB_10_DIRPS:	DB	5
  ED11  01            	DPB_11_MINSEC:	DB	1	;Minimum sector
  ED12  87            	DPB_12_DEVNO:	DB	087H	;Device Number
  ED13  00            	DPB_13_UNITNO:	DB	0
  ED14  0000          	DPB_14		DW	0
  ED16  0000          	DPB_16_GNCL:	DW	0
  ED18  0000          	DPB_18_SNCL:	DW	0
  ED1A  0000          	DPB_1A_SDIR:	DW	0
  ED1C  46444430      	DPB_1C_NAME:	DB	"FDD0"
                      	
                      	;	B:
                      	
  ED20  02            		DB	2
  ED21  FD            		DB	0FDH
  ED22  EBEC          		DW	_FDRD
  ED24  EEEC          		DW	_FDWT
  ED26  08            		DB	8
  ED27  02            		DB	2
  ED28  6401          		DW	356
  ED2A  FF            		DB	0FFH	;0FFH=2D / 0FEH=2HD
  ED2B  0C            		DB	12
  ED2C  28            		DB	40
  ED2D  09            		DB	9
  ED2E  01            		DB	1
  ED2F  82            		DB	082H
  ED30  05            		DB	5
  ED31  01            		DB	1
  ED32  87            		DB	087H	;Device Number
  ED33  01            		DB	1
  ED34  0000          		DW	0
  ED36  0000          		DW	0
  ED38  0000          		DW	0
  ED3A  0000          		DW	0
  ED3C  46444431      		DB	"FDD1"
                      	
                      	;	C:
                      	
  ED40  02            		DB	2
  ED41  FD            		DB	0FDH
  ED42  EBEC          		DW	_FDRD
  ED44  EEEC          		DW	_FDWT
  ED46  08            		DB	8
  ED47  02            		DB	2
  ED48  6401          		DW	356
  ED4A  FF            		DB	0FFH	;0FFH=2D / 0FEH=2HD
  ED4B  0C            		DB	12
  ED4C  28            		DB	40
  ED4D  09            		DB	9
  ED4E  01            		DB	1
  ED4F  82            		DB	082H
  ED50  05            		DB	5
  ED51  01            		DB	1
  ED52  87            		DB	087H	;Device Number
  ED53  02            		DB	2
  ED54  0000          		DW	0
  ED56  0000          		DW	0
  ED58  0000          		DW	0
  ED5A  0000          		DW	0
  ED5C  46444432      		DB	"FDD2"
                      	
                      	;	D:
                      	
  ED60  02            		DB	2
  ED61  FD            		DB	0FDH
  ED62  EBEC          		DW	_FDRD
  ED64  EEEC          		DW	_FDWT
  ED66  08            		DB	8
  ED67  02            		DB	2
  ED68  6401          		DW	356
  ED6A  FF            		DB	0FFH	;0FFH=2D / 0FEH=2HD
  ED6B  0C            		DB	12
  ED6C  28            		DB	40
  ED6D  09            		DB	9
  ED6E  01            		DB	1
  ED6F  82            		DB	082H
  ED70  05            		DB	5
  ED71  01            		DB	1
  ED72  87            		DB	087H	;Device Number
  ED73  03            		DB	3
  ED74  0000          		DW	0
  ED76  0000          		DW	0
  ED78  0000          		DW	0
  ED7A  0000          		DW	0
  ED7C  46444433      		DB	"FDD3"
                      	
                      	;	E:
                      	
  ED80  00            	EMMFL:	DB	0
  ED81  FE            		DB	0FEH
  ED82  47CD          	EMMRD:	DW	EDRDC
  ED84  44CD          	EMMWR:	DW	EDWTC
  ED86  09            		DB	9
  ED87  01            		DB	1
  ED88  0000          	EMMCL:	DW	0
  ED8A  00            		DB	0
  ED8B  0B            		DB	11
  ED8C  00            	EMMBL:	DB	0
  ED8D  01            		DB	1
  ED8E  01            		DB	1
  ED8F  04            		DB	4
  ED90  05            		DB	5
  ED91  01            		DB	1
  ED92  06            		DB	6	;Device Number
  ED93  00            	EMMDV:	DB	0
  ED94  0000          		DW	0
  ED96  0000          		DW	0
  ED98  0000          		DW	0
  ED9A  0000          		DW	0
  ED9C  454D4D30      		DB	"EMM0"
                      	
                      	;	F:
                      	
  EDA0  00            	BANKFL:	DB	0
  EDA1  F9            		DB	0F9H
  EDA2  C2CC          		DW	BDRDC
  EDA4  E5CC          		DW	BDWTC
  EDA6  03            		DB	3
  EDA7  01            		DB	1
  EDA8  0000          	BANKCL:	DW	0
  EDAA  00            		DB	0
  EDAB  05            		DB	5
  EDAC  00            		DB	0
  EDAD  01            		DB	1
  EDAE  00            		DB	0
  EDAF  04            		DB	4
  EDB0  01            		DB	1
  EDB1  01            		DB	1
  EDB2  0B            		DB	00BH	;Device Number
  EDB3  00            		DB	0
  EDB4  0000          		DW	0
  EDB6  0000          		DW	0
  EDB8  0000          		DW	0
  EDBA  0000          		DW	0
  EDBC  4252414D      		DB	"BRAM"
                      	
                      	;	G:
                      	
  EDC0  01            		DB	1
  EDC1  F9            		DB	0F9H
                      	;	DB	0F2H	;テスト
  EDC2  80CC          		DW	GDRDC
  EDC4  96CC          		DW	GDWTC
  EDC6  00            		DB	0
                      	;	DB	4	;テスト
                      	;	DW	12	;テスト
  EDC7  01            		DB	1
  EDC8  3000          		DW	48
  EDCA  00            		DB	0
  EDCB  02            		DB	2
  EDCC  00            		DB	0
  EDCD  01            		DB	1
  EDCE  00            		DB	0
  EDCF  04            		DB	4
  EDD0  01            		DB	1
  EDD1  01            		DB	1
  EDD2  05            		DB	5	;Device Number
  EDD3  01            		DB	1
  EDD4  0000          		DW	0
  EDD6  0000          		DW	0
  EDD8  0000          		DW	0
  EDDA  0000          		DW	0
  EDDC  4752414D      		DB	"GRAM"
                      	
                      	
                      	
  EDE0  00            	LDEND:	DB	0
                      	
  EDE1                		END
