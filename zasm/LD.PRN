			  Z80 ASSEMBLER - ZASM VER 1.6
                      	;	LSX-Dodgers for X1/turbo/Z
                      	;	Programmed by
                      	;	Gaku (Lovers/Tablacus)
                      	
  C600                	RUN	EQU	0C600h
                      	
  C5F9                		ORG	RUN-7
                      	
                      	;	MSX BINARY HEADER
  C5F9  FE            		DB	0FEH
                      	;	MSX BINARY START ADDRESS
  C5FA  00C6          		DW	RUN
                      	;	MSX BINARY END ADDRESS
  C5FC  E0ED          		DW	LDEND
                      	;	MSX BINARY EXEC ADDRESS
  C5FE  00C6          		DW	RUN
                      	;LDDEF.ASM
                      	
                      	;	LSX-Dodgers DEF
                      	
  1D90                	MAC	EQU	01D90H		;X1
  0001                	VER_1   EQU	1
  0003                	VER_2   EQU	3
  0008                	VER_3   EQU	8
  013B                	VER	EQU	VER_1 * 256 + VER_2 * 17 + VER_3
                      	
  0005                	SYSTEM	EQU	00005H
  000F                	JP_HL	EQU	0000FH
  005C                	FCB1	EQU	0005CH
  006C                	FCB2	EQU	0006CH
  005D                	FCB1FN	EQU	FCB1+1
  006D                	FCB2FN	EQU	FCB2+1
  0080                	DTA1	EQU	00080H
  EE00                	FATBF	EQU	0EE00H
  FA00                	DTBUF	EQU	0FA00H
  FE00                	KEYBF	EQU	0FE00H
  FF00                	KBUF	EQU	0FF00H
  FFA0                	STACK	EQU	0FFA0H
  0000                	EXTSP	EQU	00000H
  0019                	LINE	EQU	25
                      	
                      	;LDINIT.ASM
                      	
                      	;	LSX-Dodgers INIT
                      	
  C600  C307C6        		JP	START
  C603  901D          	MACHINE:DW	MAC
  C605  3B01          	VERSION:DW	VER
                      	
  C607                	START:
  C607  F3            		DI
  C608  ED5E          		IM	2
  C60A  310000        		LD	SP,EXTSP
  C60D  CD1BC6        		CALL	INIT		;NZならAUTOEXECを実行
  C610  210000        		LD	HL,0
  C613  E5            		PUSH	HL
  C614  C8            		RET	Z
  C615  11B6C9        		LD	DE,AUTOD
  C618  C3FDEC        		JP	_COMANL
                      	
  C61B                	INIT:
  C61B  3E1E          		LD	A,01EH
  C61D  D300          		OUT	(0),A
                      	
  C61F  010000        		LD	BC,0
  C622  ED438CEC      		LD	(_CTC),BC
  C626  01040A        		LD	BC,00A04H
  C629  CD60C9        		CALL	CHKCTC
  C62C  010407        		LD	BC,00704H
  C62F  CD60C9        		CALL	CHKCTC
  C632  01A81F        		LD	BC,01FA8H
  C635  CD60C9        		CALL	CHKCTC
  C638  01A01F        		LD	BC,01FA0H
  C63B  CD60C9        		CALL	CHKCTC
                      	;
  C63E                	INISIO:
  C63E  01911F        		LD	BC,01F91H	;INIT SIO
  C641  1601          		LD	D,1
  C643  ED51          		OUT	(C),D
                      	
  C645  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  C647  0E93          		LD	C,093H
  C649  ED51          		OUT	(C),D
  C64B  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  C64D  0E99          		LD	C,099H		;INIT SIO
  C64F  1601          		LD	D,1
  C651  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  C653  0E9B          		LD	C,09BH
  C655  ED51          		OUT	(C),D
  C657  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
                      	
  C659  0E80          		LD	C,080H		;INIT DMA
  C65B  2106C3        		LD	HL,0C306H
  C65E                	INIDMA:
  C65E  ED61          		OUT	(C),H
  C660  2D            		DEC	L
  C661  20FB          		JR	NZ,INIDMA
                      	
  C663  3EE4          		LD	A,0E4H
  C665  CD76DA        		CALL	COMOUT
  C668  AF            		XOR	A
  C669  CD50DA        		CALL	OT49SB
                      	
  C66C  3EEC          		LD	A,INTVEC/256
  C66E  ED47          		LD	I,A
                      	
  C670  ED4B8CEC      		LD	BC,(_CTC)
  C674  0B            		DEC	BC
  C675  0B            		DEC	BC
                      	
  C676  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  C678  3EC0          		LD	A,CTC0
  C67A  ED79          		OUT	(C),A
                      	
  C67C  0C            		INC	C
  C67D  3E47          		LD	A,047H
  C67F  ED79          		OUT	(C),A
  C681  3E0D          		LD	A,13		;Baudrate 9600-13
  C683  ED79          		OUT	(C),A
                      	
  C685  79            		LD	A,C
  C686  D610          		SUB	010H
  C688  4F            		LD	C,A
                      	;	LD	(SIOAD+1),BC
                      	;	LD	(SIOAD0+1),BC
                      	;	LD	(SIOAD1+1),BC
                      	
  C689  2118CA        		LD	HL,SIODATA
  C68C                	SINIT1:
  C68C  7E            		LD	A,(HL)
  C68D  23            		INC	HL
  C68E  FEFF          		CP	0FFH
  C690  2804          		JR	Z,SINIT2
  C692  ED79          		OUT	(C),A
  C694  18F6          		JR	SINIT1
  C696                	SINIT2:
  C696  3EE4          		LD	A,0E4H
  C698  CD76DA        		CALL	COMOUT
  C69B  3EC8          		LD	A,INTVEC
  C69D  CD50DA        		CALL	OT49SB
                      	;
  C6A0  01C41F        		LD	BC,01FC4H
  C6A3  3E0C          		LD	A,00CH
  C6A5  ED79          		OUT	(C),A
                      	
  C6A7  0EC0          		LD	C,0C0H
  C6A9  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
                      	
  C6AB  0C            		INC	C
  C6AC  3E28          		LD	A,40
  C6AE  ED79          		OUT	(C),A
                      	
  C6B0  0C            		INC	C
  C6B1  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
                      	
  C6B3  0C            		INC	C
  C6B4  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
                      	
  C6B6  0EC5          		LD	C,0C5H
  C6B8  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
                      	
  C6BA                	TEXT:
  C6BA  0EB0          		LD	C,0B0H
  C6BC  3E80          		LD	A,080H
  C6BE  ED79          		OUT	(C),A
  C6C0  1607          		LD	D,7
  C6C2  0EB9          		LD	C,0B9H
  C6C4  2111CA        		LD	HL,TEXTDT
  C6C7                	TEXT1:
  C6C7  04            		INC	B
  C6C8  EDA3          		OUTI
  C6CA  0C            		INC	C
  C6CB  15            		DEC	D
  C6CC  20F9          		JR	NZ,TEXT1
  C6CE  01B01F        		LD	BC,01FB0H
  C6D1  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
                      	
  C6D3  0EC4          		LD	C,0C4H
  C6D5  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
                      	
  C6D7  01011A        		LD	BC,01A01H
  C6DA  ED78          		IN	A,(C)
  C6DC  E608          		AND	8
  C6DE  2809          		JR	Z,PRN
  C6E0  0E03          		LD	C,003H
  C6E2  3E0F          		LD	A,00FH
  C6E4  ED79          		OUT	(C),A
  C6E6  01040A        		LD	BC,00A04H
  C6E9                	PRN:
  C6E9  210000        		LD	HL,0
  C6EC  065C          		LD	B,05CH
  C6EE  3EC9          		LD	A,0C9H	;C9=RET
  C6F0  CDFDDC        		CALL	FILL_MEMORY
  C6F3  06A4          		LD	B,0A4H
  C6F5  AF            		XOR	A
  C6F6  CDFDDC        		CALL	FILL_MEMORY
                      	
  C6F9  3EC3          		LD	A,0C3H		;JP
  C6FB  2103EB        		LD	HL,WBOOT
  C6FE  320000        		LD	(00000H),A
  C701  220100        		LD	(00001H),HL	;IPL
                      	
  C704  2A03C6        		LD	HL,(MACHINE)	;3 bit7  DPB Original(1)
                      					;  bit6-4 DPB_LEVEL
  C707  220300        		LD	(00003H),HL	;  bit3-0 Machine X1(0)
                      	;				;4 LSX-Dodgers(01DH)
  C70A  2106CC        		LD	HL,BDOS
  C70D  320500        		LD	(00005H),A
  C710  220600        		LD	(00006H),HL	;BDOS
                      	
  C713  213FD6        		LD	HL,BIOS
  C716  321800        		LD	(00018H),A	;BIOS-ROM
  C719  221900        		LD	(00019H),HL
                      	
  C71C  210000        		LD	HL,0
  C71F  323800        		LD	(00038H),A	;RST038H
  C722  223900        		LD	(00039H),HL
                      	
  C725  3EEC          		LD	A,STABLE/256
  C727  320B00        		LD	(0000BH),A
                      	
  C72A  3EE9          		LD	A,0E9H		;JP (HL)
  C72C  320F00        		LD	(0000FH),A
                      	
  C72F  3A7DEC        		LD	A,(_FATBF+1)
  C732  321300        		LD	(00013H),A
                      	
  C735  3A7FEC        		LD	A,(_DTBUF+1)
  C738  321700        		LD	(00017H),A
                      	
  C73B  3EFE          		LD	A,KEYBF/256
  C73D  321B00        		LD	(0001BH),A
                      	
  C740  3EFF          		LD	A,KBUF/256
  C742  321F00        		LD	(0001FH),A
                      	
  C745  2A05C6        		LD	HL,(VERSION)
  C748  225A00        		LD	(0005AH),HL
                      	
  C74B  3EE6          		LD	A,0E6H
  C74D  CD76DA        		CALL	COMOUT
  C750  CD5BDA        		CALL	IN49SB
  C753  F5            		PUSH	AF
  C754  CD5BDA        		CALL	IN49SB
  C757  F1            		POP	AF
  C758  F5            		PUSH	AF
  C759  E612          		AND	012H
  C75B  2005          		JR	NZ,KEYR
  C75D  3E01          		LD	A,1
  C75F  32C6C8        		LD	(KEYREP+1),A
  C762                	KEYR:
  C762  F1            		POP	AF
  C763  E603          		AND	3
  C765  280E          		JR	Z,NON
                      	
  C767  01D03F        		LD	BC,03FD0H
  C76A  ED49          		OUT	(C),C
  C76C  3E37          		LD	A,037H
  C76E  D3D0          		OUT	(0D0H),A
  C770  ED78          		IN	A,(C)
  C772  B9            		CP	C
  C773  2878          		JR	Z,TURBO
  C775                	NON:
  C775  3D            		DEC	A		;A=0FFH
  C776  321800        		LD	(00018H),A	;BIOS-ROM
                      	
  C779  2124CA        		LD	HL,AT_SCR1
  C77C  1100DB        		LD	DE,SCR1
  C77F  01A100        		LD	BC,SCRNX-SCR1	;転送先のサイズ確認用
  C782  019F00        		LD	BC,AT_SCRE-AT_SCR1
  C785  EDB0          		LDIR
                      	
  C787  21C3CA        		LD	HL,AT_WTTRK
  C78A  1147EA        		LD	DE,WTTRK
  C78D  01B900        		LD	BC,DMAE-WTTRK	;転送先のサイズ確認用
  C790  01B100        		LD	BC,AT_CPUE-AT_WTTRK
  C793  EDB0          		LDIR
                      	
  C795  2174CB        		LD	HL,AT_EDWT
  C798  11ECD2        		LD	DE,EDWT
  C79B  014C00        		LD	BC,EMME-EDWT	;転送先のサイズ確認用
  C79E  014400        		LD	BC,AT_EMME-AT_EDWT
  C7A1  EDB0          		LDIR
                      	
  C7A3  21A8EA        		LD	HL,AT_DRD+AT_R
  C7A6  22ECEC        		LD	(_FDRD+1),HL
  C7A9  214DEA        		LD	HL,AT_DWT+AT_R
  C7AC  22EFEC        		LD	(_FDWT+1),HL
  C7AF  2100D3        		LD	HL,AT_EDRD+AT_RE
  C7B2  2282ED        		LD	(EMMRD),HL
  C7B5  21ECD2        		LD	HL,AT_EDWT+AT_RE
  C7B8  2284ED        		LD	(EMMWR),HL
                      	
  C7BB  3E27          		LD	A,027H			;ノンターボはMFM切り替えを行わない
  C7BD  3212ED        		LD	(DEVICE+012H),A		;Aドライブ
  C7C0  3232ED        		LD	(DEVICE+012H+32),A	;Bドライブ
  C7C3  3252ED        		LD	(DEVICE+012H+32*2),A	;Cドライブ
  C7C6  3272ED        		LD	(DEVICE+012H+32*3),A	;Dドライブ
                      	
  C7C9  210000        		LD	HL,0
  C7CC  22A1DA        		LD	(X1PAT),HL
                      	
  C7CF  3EAF          		LD	A,0AFH		;XOR	A
  C7D1  32B2D8        		LD	(X1KPAT),A
                      	
  C7D4  21A1DB        		LD	HL,SCRNX
  C7D7  22D1EC        		LD	(_SCRN+1),HL
                      	
  C7DA  CD87C9        		CALL	SETCRTC
  C7DD  0610          		LD	B,010H		;PALET
  C7DF  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  C7E1  04            		INC	B
  C7E2  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  C7E4  04            		INC	B
  C7E5  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  C7E7  04            		INC	B
  C7E8  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  C7EA  C381C8        		JP	NOBANK
                      	
  C7ED                	TURBO:
  C7ED  F3            		DI			;Check BIOS
  C7EE  061D          		LD	B,01DH
  C7F0  ED79          		OUT	(C),A		;BIOS ON
  C7F2  3A512F        		LD	A,(02F51H)
  C7F5  04            		INC	B		;B=01EH
  C7F6  ED79          		OUT	(C),A		;BIOS OFF
  C7F8  FB            		EI
  C7F9  FEC9          		CP	0C9H
  C7FB  280B          		JR	Z,BIOSOK
  C7FD  3EAF          		LD	A,0AFH		;XOR	A
  C7FF  32B2D8        		LD	(X1KPAT),A
  C802  21A1DB        		LD	HL,SCRNX
  C805  22D1EC        		LD	(_SCRN+1),HL
  C808                	BIOSOK:
  C808  3E1F          		LD	A,01FH
  C80A  DBF0          		IN	A,(0F0H)
  C80C  0F            		RRCA
  C80D  380B          		JR	C,CRT1
  C80F  2101CA        		LD	HL,_C8025H
  C812  11B0EC        		LD	DE,CRTCD
  C815  011000        		LD	BC,16
  C818  EDB0          		LDIR
  C81A                	CRT1:
  C81A  CD87C9        		CALL	SETCRTC
  C81D  01AA10        		LD	BC,010AAH	;PALET
  C820  ED49          		OUT	(C),C
  C822  01CC11        		LD	BC,011CCH
  C825  ED49          		OUT	(C),C
  C827  01F012        		LD	BC,012F0H
  C82A  ED49          		OUT	(C),C
  C82C  04            		INC	B
  C82D  ED71          		DB	0EDH,071H
                      	
  C82F  3E1F          		LD	A,01FH		;スタートポート
  C831  DBF0          		IN	A,(0F0H)
  C833  CB57          		BIT	2,A
  C835  2818          		JR	Z,BANK
                      	
  C837  AF            		XOR	A
  C838                	TZ1:				;前面スイッチが2HDの場合はMFMモードを2HDにしておく
  C838  F5            		PUSH	AF
  C839  CDDCEC        		CALL	_GETDPB
  C83C  DD7E12        		LD	A,(IX+012H)	;DPB_12_DEVICE
  C83F  E68F          		AND	08FH
  C841  FE87          		CP	087H		;フロッピーでMEM切り替えがON
  C843  2004          		JR	NZ,TZ2
  C845  DDCB0A86      		RES	0,(IX+0AH)	;(DPB_0A_FDMODE)
  C849                	TZ2:
  C849  F1            		POP	AF
  C84A  3C            		INC	A
  C84B  FE08          		CP	8
  C84D  38E9          		JR	C,TZ1
                      	
  C84F                	BANK:
  C84F  01000B        		LD	BC,00B00H
  C852  21007F        		LD	HL,07F00H
  C855  F3            		DI
  C856                	BANK1:
  C856  ED69          		OUT	(C),L
  C858  5E            		LD	E,(HL)
  C859  7B            		LD	A,E
  C85A  C6A5          		ADD	A,0A5H
  C85C  77            		LD	(HL),A
  C85D  BE            		CP	(HL)
  C85E  73            		LD	(HL),E
  C85F  2005          		JR	NZ,BANK2
  C861  2C            		INC	L
  C862  CB65          		BIT	4,L
  C864  28F0          		JR	Z,BANK1
  C866                	BANK2:
  C866  3E10          		LD	A,010H
  C868  ED79          		OUT	(C),A
  C86A  7D            		LD	A,L
  C86B  B7            		OR	A
  C86C  2813          		JR	Z,NOBANK
  C86E  2600          		LD	H,0
  C870  29            		ADD	HL,HL	;*2
  C871  29            		ADD	HL,HL	;*4
  C872  29            		ADD	HL,HL	;*8
  C873  29            		ADD	HL,HL	;*16
  C874  29            		ADD	HL,HL	;*32
  C875  2B            		DEC	HL	;-1
  C876  2B            		DEC	HL	;-2
  C877  2B            		DEC	HL	;-3
  C878  22A8ED        		LD	(BANKCL),HL
  C87B  CDA6C9        		CALL	CALC_FATLN
  C87E  32A0ED        		LD	(BANKFL),A
  C881                	NOBANK:
  C881                	EMM:
  C881  CD50C9        		CALL	EADR0
  C884  ED78          		IN	A,(C)
  C886  F5            		PUSH	AF
                      	
  C887  110000        		LD	DE,0
  C88A                	ECHECK1:
  C88A  13            		INC	DE
  C88B  CD33C9        		CALL	EADR2
  C88E  ED60          		IN	H,(C)
  C890  CD33C9        		CALL	EADR2
  C893  7C            		LD	A,H
  C894  C6E5          		ADD	A,0E5H
  C896  ED79          		OUT	(C),A
  C898  3C            		INC	A
  C899  CD50C9        		CALL	EADR0
  C89C  ED79          		OUT	(C),A
  C89E  3D            		DEC	A
  C89F  CD33C9        		CALL	EADR2
  C8A2  ED68          		IN	L,(C)
  C8A4  CD33C9        		CALL	EADR2
  C8A7  ED61          		OUT	(C),H
  C8A9  BD            		CP	L
  C8AA  2004          		JR	NZ,ECHECK2
  C8AC  CB5A          		BIT	3,D
  C8AE  28DA          		JR	Z,ECHECK1
  C8B0                	ECHECK2:
  C8B0  CD50C9        		CALL	EADR0
  C8B3  F1            		POP	AF
  C8B4  ED79          		OUT	(C),A
                      	
  C8B6  21F7FF        		LD	HL,0-9
  C8B9  19            		ADD	HL,DE
  C8BA  3009          		JR	NC,NOEMM
  C8BC  2288ED        		LD	(EMMCL),HL
  C8BF  CDA6C9        		CALL	CALC_FATLN
  C8C2  3280ED        		LD	(EMMFL),A
  C8C5                	NOEMM:
  C8C5  3E00          	KEYREP:	LD	A,000H
  C8C7  B7            		OR	A
  C8C8  2807          		JR	Z,KEYR1
  C8CA  010000        		LD	BC,0
  C8CD  ED438CEC      		LD	(_CTC),BC
  C8D1                	KEYR1:
  C8D1  0130F8        		LD	BC,0-80*25
  C8D4  2ABAEC        		LD	HL,(CRTCD+10)
  C8D7  ED43BAEC      		LD	(CRTCD+10),BC
  C8DB  1E0C          		LD	E,00CH
  C8DD  CDCDEC        		CALL	_PRINT
  C8E0  22BAEC        		LD	(CRTCD+10),HL
                      	
  C8E3  21C2C9        		LD	HL,INIMES
  C8E6  CD7AD3        		CALL	MSX
                      	
  C8E9  3A87FF        		LD	A,(0FF87H)
  C8EC  FE08          		CP	8
  C8EE  301E          		JR	NC,INIT0
  C8F0  5F            		LD	E,A
  C8F1  C641          		ADD	A,'A'
  C8F3  32BFC9        		LD	(AUTODV),A
  C8F6  0E0E          		LD	C,00EH
  C8F8  CD0500        		CALL	SYSTEM
  C8FB  1C            		INC	E
  C8FC  2185EC        		LD	HL,_SEEKSP	;Disk error Ignore
  C8FF  CBFE          		SET	7,(HL)
  C901  0E1B          		LD	C,01BH
  C903  CD0500        		CALL	SYSTEM
                      	
  C906  2185EC        		LD	HL,_SEEKSP
  C909  CBBE          		RES	7,(HL)
                      	
  C90B  3C            		INC	A
  C90C  2008          		JR	NZ,INIT1
  C90E                	INIT0:
  C90E  1E00          		LD	E,0
  C910  0E0E          		LD	C,00EH
  C912  CD0500        		CALL	SYSTEM
  C915  AF            		XOR	A
  C916                	INIT1:
  C916  F3            		DI
  C917  08            		EX	AF,AF'
  C918  2EFE          		LD	L,0-2		;CALLのスタック分減らす
  C91A  39            		ADD	HL,SP
  C91B  1100FF        		LD	DE,0FF00H
  C91E  45            		LD	B,L
  C91F  CD14D0        		CALL	ZERO_MEMORY_DE
  C922  08            		EX	AF,AF'
  C923  B7            		OR	A
  C924  C8            		RET	Z
                      	
  C925  3EE6          		LD	A,0E6H
  C927  CD76DA        		CALL	COMOUT
  C92A  CD5BDA        		CALL	IN49SB
  C92D  CD5BDA        		CALL	IN49SB
  C930  FE1B          		CP	01BH
  C932  C9            		RET
                      	
  C933                	EADR2:
  C933  D5            		PUSH	DE
  C934  EB            		EX	DE,HL
  C935  29            		ADD	HL,HL
  C936  29            		ADD	HL,HL
  C937  ED4B8BED      		LD	BC,(EMMBL-1)
  C93B  0E00          		LD	C,0
  C93D  09            		ADD	HL,BC
  C93E  ED4B93ED      		LD	BC,(EMMDV)
  C942  060D          		LD	B,00DH
  C944  ED49          		OUT	(C),C
  C946  0C            		INC	C
  C947  ED69          		OUT	(C),L
  C949  0C            		INC	C
  C94A  ED61          		OUT	(C),H
  C94C  0C            		INC	C
  C94D  EB            		EX	DE,HL
  C94E  D1            		POP	DE
  C94F  C9            		RET
                      	
  C950                	EADR0:
  C950  ED4B93ED      		LD	BC,(EMMDV)
  C954  060D          		LD	B,00DH
  C956  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  C958  0C            		INC	C
  C959  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  C95B  0C            		INC	C
  C95C  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  C95E  0C            		INC	C
  C95F  C9            		RET
                      	
  C960                	CHKCTC:
  C960  C5            		PUSH	BC
  C961  110347        		LD	DE,04703H
  C964                	INICTC1:
  C964  0C            		INC	C
  C965  ED51          		OUT	(C),D
  C967  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  C969  1D            		DEC	E
  C96A  20F8          		JR	NZ,INICTC1
  C96C  C1            		POP	BC
                      	
  C96D  11FA07        		LD	DE,007FAH
  C970  ED51          		OUT	(C),D
  C972  ED59          		OUT	(C),E
  C974  ED78          		IN	A,(C)
  C976  BB            		CP	E
  C977  C0            		RET	NZ
  C978  ED51          		OUT	(C),D
  C97A  ED51          		OUT	(C),D
  C97C  ED78          		IN	A,(C)
  C97E  BA            		CP	D
  C97F  C0            		RET	NZ
  C980  03            		INC	BC
  C981  03            		INC	BC
  C982  ED438CEC      		LD	(_CTC),BC
  C986  C9            		RET
                      	
  C987                	SETCRTC:
  C987  21B0EC        		LD	HL,CRTCD
  C98A  AF            		XOR	A
  C98B                	SETCRT1:
  C98B  010018        		LD	BC,01800H
  C98E  ED79          		OUT	(C),A
  C990  0C            		INC	C
  C991  04            		INC	B
  C992  EDA3          		OUTI
  C994  3C            		INC	A
  C995  FE0C          		CP	12
  C997  20F2          		JR	NZ,SETCRT1
  C999  23            		INC	HL
  C99A  23            		INC	HL
  C99B  01031B        		LD	BC,01A03H+00100H
  C99E  EDA3          		OUTI
  C9A0  01D020        		LD	BC,01FD0H+00100H
  C9A3  EDA3          		OUTI
  C9A5  C9            		RET
                      	
  C9A6                	CALC_FATLN:	;FAT12のクラスタ数から必要なFATサイズを求める(セクタサイズ512)
  C9A6  5D            		LD	E,L
  C9A7  54            		LD	D,H
  C9A8  29            		ADD	HL,HL	;*2
  C9A9  19            		ADD	HL,DE	;*3
  C9AA  CB3C          		SRL	H	;/2
  C9AC  CB1D          		RR	L	;1クラスタ辺り1.5バイト必要
  C9AE  11FF01        		LD	DE,511	;切り上げる
  C9B1  19            		ADD	HL,DE
  C9B2  7C            		LD	A,H
  C9B3  CB3F          		SRL	A
  C9B5  C9            		RET
                      	
  C9B6  4155544F455845	AUTOD:	DB	"AUTOEXEC "
  C9BF  413A00        	AUTODV:	DB	"A:",0
                      	
  C9C2  4C53582D446F64	INIMES:	DB	"LSX-Dodgers for X1/turbo version "
  C9E3  312E          		DB	030H + VER_1, '.'
  C9E5  3338          		DB	030H + VER_2 ,030H + VER_3
  C9E7  2047616B752028		DB	' Gaku (Lovers/Tablacus)',0DH,0AH
  CA00  00            		DB	0
                      	
  CA01                	_C8025H:
  CA01  6B5059881B0119		DB	06BH,050H,059H,088H,01BH,001H,019H,01AH
  CA09  000F          		DB	000H,00FH
  CA0B  30F8B0FF      		DW	0-80*LINE,0-80
  CA0F  0CA3          		DB	00CH,0A3H
                      	
  CA11  030C0F30333C3F	TEXTDT:	DB	003H,00CH,00FH,030H,033H,03CH,03FH
                      	
  CA18                	SIODATA:
  CA18  18            		DB	018H
  CA19  0100          		DB	1,0
  CA1B  0200          		DB	2,0
  CA1D  03C1          		DB	3,0C1H
  CA1F  0444          		DB	4,044H
  CA21  05E8          		DB	5,0E8H
  CA23  FF            		DB	0FFH
                      	
                      	;	ノンターボ用パッチ
                      	
  CA24                	AT_SCR1:
  CA24  D9            		EXX
  CA25  C5            		PUSH	BC
  CA26  015020        		LD	BC,02000H+80
  CA29  D9            		EXX
  CA2A  C5            		PUSH	BC
  CA2B  010020        		LD	BC,02000H
                      	
  CA2E  67            		LD	H,A
  CA2F  B7            		OR	A
  CA30                	AT_SCRUP1:
  CA30  2815          		JR	Z,AT_SCRCL
  CA32  C5            		PUSH	BC
  CA33  CBE0          		SET	4,B
  CA35  D9            		EXX
  CA36  C5            		PUSH	BC
  CA37  CBE0          		SET	4,B
  CA39  D9            		EXX
  CA3A  CD3ADB        		CALL	AT_UPSUB+AT_RS
  CA3D  D9            		EXX
  CA3E  C1            		POP	BC
  CA3F  D9            		EXX
  CA40  C1            		POP	BC
  CA41  CD3ADB        		CALL	AT_UPSUB+AT_RS
  CA44  25            		DEC	H
  CA45  18E9          		JR	AT_SCRUP1
                      	
  CA47                	AT_SCRCL:
  CA47  215020        		LD	HL,02000H+80
  CA4A  3A96EC        		LD	A,(_COLORF)
  CA4D                	AT_SCRCL1:
  CA4D  CBE0          		SET	4,B
  CA4F  ED61          		OUT	(C),H
  CA51  CBA0          		RES	4,B
  CA53  ED79          		OUT	(C),A
  CA55  03            		INC	BC
  CA56  2D            		DEC	L
  CA57  20F4          		JR	NZ,AT_SCRCL1
  CA59  C1            		POP	BC
  CA5A  D9            		EXX
  CA5B  C1            		POP	BC
  CA5C  D9            		EXX
  CA5D  C9            		RET
                      	
  CA5E                	AT_UPSUB:
  CA5E  2E28          		LD	L,40
  CA60                	AT_UPSUB1:
  CA60  D9            		EXX
  CA61  ED78          		IN	A,(C)
  CA63  03            		INC	BC
  CA64  D9            		EXX
  CA65  ED79          		OUT	(C),A
  CA67  03            		INC	BC
  CA68  D9            		EXX
  CA69  ED78          		IN	A,(C)
  CA6B  03            		INC	BC
  CA6C  D9            		EXX
  CA6D  ED79          		OUT	(C),A
  CA6F  03            		INC	BC
  CA70  2D            		DEC	L
  CA71  20ED          		JR	NZ,AT_UPSUB1
  CA73  C9            		RET
                      	
                      	;	FLOPPY DISK DRIVER(CPU)
                      	
  CA74                	DISKC:
  CA74  1B            		DEC	DE
  CA75  CB5F          		BIT	3,A
  CA77  C440EA        		CALL	NZ,RNF
  CA7A                	DISKD:
  CA7A  E5            		PUSH	HL
  CA7B  2146EA        		LD	HL,RETRY
  CA7E  35            		DEC	(HL)
  CA7F  E1            		POP	HL
  CA80  203E          		JR	NZ,AT_ERR		;Retry
  CA82  B7            		OR	A
  CA83  283B          		JR	Z,AT_ERR		;Error
                      	
  CA85                	AT_DELP:
  CA85  CD40EA        		CALL	RNF
  CA88  CD1CEA        		CALL	FDMOFF
  CA8B  3A85EC        		LD	A,(_SEEKSP)
  CA8E  87            		ADD	A,A
  CA8F  382E          		JR	C,AT_ERRZ
  CA91                	AT_DELP1:
  CA91  D5            		PUSH	DE
  CA92  21C0EB        		LD	HL,DEMES
  CA95  CD7AD3        		CALL	MSX
  CA98  CD15D7        		CALL	KEYBC
  CA9B                	AT_DELP2:
  CA9B  CDCAEC        		CALL	_INKEY
  CA9E  28FB          		JR	Z,AT_DELP2
                      	
  CAA0  D1            		POP	DE
  CAA1  CD6FDF        		CALL	CAP
  CAA4  FE52          		CP	'R'		;Retry
  CAA6  200A          		JR	NZ,AT_DELP3
  CAA8  210000        	DHLPAT:	LD	HL,0
  CAAB  3E02          		LD	A,2
  CAAD  3246EA        		LD	(RETRY),A
  CAB0  B7            		OR	A
  CAB1  C9            		RET
  CAB2                	AT_DELP3:
  CAB2  FE49          		CP	'I'		;Ignore
  CAB4  2807          		JR	Z,AT_IGNORE
  CAB6  FE41          		CP	'A'		;Abort
  CAB8  20D7          		JR	NZ,AT_DELP1
  CABA  C300EB        		JP	BOOT
  CABD                	AT_IGNORE:
  CABD  3EFF          		LD	A,0FFH
  CABF                	AT_ERRZ:
  CABF  BF            		CP	A
  CAC0                	AT_ERR:
  CAC0  3EFF          		LD	A,0FFH
  CAC2  C9            		RET
                      	
  CAC3                	AT_SCRE:
                      	
  CAC3                	AT_WTTRK:
  CAC3  0601          		LD	B,1
  CAC5  3EF0          		LD	A,0F0H
  CAC7  1802          		JR	AT_WTTRK1
  CAC9                	AT_DWT:
  CAC9  3EA0          		LD	A,0A0H
  CACB                	AT_WTTRK1:
  CACB  32E4E9        		LD	(FDCPAT+1),A
  CACE  78            		LD	A,B
  CACF  3293EA        		LD	(AT_WTB+1+AT_R),A
  CAD2                	DWTBL:
  CAD2  3E02          		LD	A,2		;Retry count
  CAD4  3246EA        		LD	(RETRY),A
                      	
  CAD7                	DWT0:
  CAD7  D5            		PUSH	DE
  CAD8  E5            		PUSH	HL
  CAD9  2285DB        		LD	(DHLPAT+1+AT_RS),HL
  CADC  CD7EE9        		CALL	SEEK		;Write disk
  CADF  E1            		POP	HL
  CAE0  3838          		JR	C,ERRDW
  CAE2  F3            		DI
  CAE3  3AE4E9        		LD	A,(FDCPAT+1)
  CAE6  CD28EA        		CALL	SECSET
  CAE9  0EFB          		LD	C,0FBH
                      	
  CAEB                	DWT1:
  CAEB  56            		LD	D,(HL)
  CAEC                	DWT2:
  CAEC  78            		LD	A,B
  CAED  DBF8          		IN	A,(0F8H)
  CAEF  0F            		RRCA
  CAF0  3008          		JR	NC,DWT4
  CAF2  0F            		RRCA
  CAF3  30F7          		JR	NC,DWT2
  CAF5                	DWT3:
  CAF5  ED51          		OUT	(C),D
  CAF7  23            		INC	HL
  CAF8  18F1          		JR	DWT1
                      	
  CAFA                	DWT4:
  CAFA  3D            		DEC	A
  CAFB  28F8          		JR	Z,DWT3
  CAFD  3C            		INC	A
  CAFE  FB            		EI
  CAFF  D1            		POP	DE
  CB00  13            		INC	DE
  CB01  CD1CEA        		CALL	FDMOFF
  CB04  2808          		JR	Z,DISKOK_WT
  CB06  CD50DB        		CALL	DISKC+AT_RS
  CB09  20CC          		JR	NZ,DWT0
  CB0B  B7            		OR	A
  CB0C  2005          		JR	NZ,ERRW
                      	
  CB0E                	DISKOK_WT:
  CB0E  0601          	AT_WTB:	LD	B,1
  CB10  10C0          		DJNZ	DWTBL
  CB12  C9            		RET
                      	
  CB13                	ERRW:
  CB13  3EFF          		LD	A,0FFH
  CB15                	ERRZ:
  CB15  BF            		CP	A
  CB16  37            		SCF
  CB17  C31CEA        		JP	FDMOFF
                      	
  CB1A                	ERRDW:
  CB1A  D1            		POP	DE
  CB1B  CD61DB        		CALL	AT_DELP+AT_RS
  CB1E  20B7          		JR	NZ,DWT0
  CB20  B7            		OR	A
  CB21  20F0          		JR	NZ,ERRW
  CB23  C9            		RET
                      	
  CB24                	AT_DRD:
  CB24  3E80          		LD	A,080H
  CB26  32E4E9        		LD	(FDCPAT+1),A
  CB29                	DRDBL:
  CB29  78            		LD	A,B
  CB2A  32EAEA        		LD	(AT_RDB+1+AT_R),A
  CB2D  3E02          		LD	A,2		;Retry count
  CB2F  3246EA        		LD	(RETRY),A
  CB32                	DRD0:
  CB32  D5            		PUSH	DE
  CB33  E5            		PUSH	HL
  CB34  2285DB        		LD	(DHLPAT+1+AT_RS),HL
  CB37  CD7EE9        		CALL	SEEK		;Read disk
  CB3A  E1            		POP	HL
  CB3B  382D          		JR	C,ERRDR
  CB3D  F3            		DI
  CB3E  3AE4E9        		LD	A,(FDCPAT+1)
  CB41  CD28EA        		CALL	SECSET
  CB44  0EFB          		LD	C,0FBH
  CB46                	DRD1:
  CB46  78            		LD	A,B
  CB47  DBF8          		IN	A,(0F8H)
  CB49  0F            		RRCA
  CB4A  3008          		JR	NC,DRD3
  CB4C  0F            		RRCA
  CB4D  30F7          		JR	NC,DRD1
  CB4F  EDA2          		INI
  CB51  04            		INC	B
  CB52  18F2          		JR	DRD1
                      	
  CB54                	DRD3:
  CB54  B7            		OR	A
  CB55  FB            		EI
  CB56  D1            		POP	DE
  CB57  13            		INC	DE
  CB58  CD1CEA        		CALL	FDMOFF
  CB5B  2808          		JR	Z,DISKOK_RD
  CB5D  CD50DB        		CALL	DISKC+AT_RS
  CB60  20D0          		JR	NZ,DRD0
  CB62  B7            		OR	A
  CB63  20AE          		JR	NZ,ERRW
                      	
  CB65                	DISKOK_RD:
  CB65  0601          	AT_RDB:	LD	B,1
  CB67  10C0          		DJNZ	DRDBL
  CB69  C9            		RET
                      	
  CB6A                	ERRDR:
  CB6A  D1            		POP	DE
  CB6B  CD61DB        		CALL	AT_DELP+AT_RS
  CB6E  20C2          		JR	NZ,DRD0
  CB70  B7            		OR	A
  CB71  20A0          		JR	NZ,ERRW
  CB73  C9            		RET
                      	
  CB74                	AT_CPUE:
                      	
                      	
                      	;	EMM DRIVER(CPU)
                      	
                      	
  CB74                	AT_EDWT:
  CB74  CD14D3        		CALL	AT_EADR+AT_RE
  CB77                	AT_EDWT0:
  CB77  F5            		PUSH	AF
  CB78  AF            		XOR	A
  CB79                	AT_EDWT1:
  CB79  04            		INC	B
  CB7A  EDA3          		OUTI
  CB7C  04            		INC	B
  CB7D  EDA3          		OUTI
  CB7F  3D            		DEC	A
  CB80  20F7          		JR	NZ,AT_EDWT1
  CB82  13            		INC	DE
  CB83  F1            		POP	AF
  CB84  3D            		DEC	A
  CB85  20F0          		JR	NZ,AT_EDWT0
  CB87  C9            		RET
                      	
  CB88                	AT_EDRD:
  CB88  CD14D3        		CALL	AT_EADR+AT_RE
  CB8B                	AT_EDRD0:
  CB8B  F5            		PUSH	AF
  CB8C  AF            		XOR	A
  CB8D                	AT_EDRD1:
  CB8D  EDA2          		INI
  CB8F  04            		INC	B
  CB90  EDA2          		INI
  CB92  04            		INC	B
  CB93  3D            		DEC	A
  CB94  20F7          		JR	NZ,AT_EDRD1
  CB96  13            		INC	DE
  CB97  F1            		POP	AF
  CB98  3D            		DEC	A
  CB99  20F0          		JR	NZ,AT_EDRD0
  CB9B  C9            		RET
                      	
  CB9C                	AT_EADR:
  CB9C  C5            		PUSH	BC
  CB9D  D5            		PUSH	DE
  CB9E  EB            		EX	DE,HL
  CB9F  29            		ADD	HL,HL
  CBA0  29            		ADD	HL,HL
  CBA1  ED4BA0EC      		LD	BC,(_MAXCYL-1)
  CBA5  0E00          		LD	C,0
  CBA7  09            		ADD	HL,BC
  CBA8  060D          		LD	B,00DH
  CBAA  ED49          		OUT	(C),C
  CBAC  0C            		INC	C
  CBAD  ED69          		OUT	(C),L
  CBAF  0C            		INC	C
  CBB0  ED61          		OUT	(C),H
  CBB2  0C            		INC	C
  CBB3  EB            		EX	DE,HL
  CBB4  D1            		POP	DE
  CBB5  F1            		POP	AF
  CBB6  B7            		OR	A	;CF=0
  CBB7  C9            		RET
                      	
  CBB8                	AT_EMME:
                      	
  CBB8                	INITE:
  CBB8                		DS	0CC06H-INITE
                      	
  CC06                	BDOS:
  CC06  C338D3        		JP	BDOS0
  CC09                		DS	2	;Reserved
                      	
                      	;LDCCP.ASM
                      	
                      	;	LSX-Dodgers CCP
                      	
  CC0B                	WBOOT1:
  CC0B  F3            		DI
  CC0C  31A0FF        		LD	SP,STACK
                      	
  CC0F  3EEC          		LD	A,INTVEC/256
  CC11  ED47          		LD	I,A
                      	
  CC13  3EE4          		LD	A,0E4H
  CC15  CD76DA        		CALL	COMOUT
  CC18  3EC8          		LD	A,INTVEC
  CC1A  CD50DA        		CALL	OT49SB
                      	
  CC1D  3ABCEC        		LD	A,(CRTCD+12)
  CC20  B7            		OR	A
  CC21  200C          		JR	NZ,SETCRT0
  CC23  2130F8        		LD	HL,0-80*LINE
  CC26  22BAEC        		LD	(CRTCD+10),HL
  CC29  21B0FF        		LD	HL,0-80
  CC2C  22BCEC        		LD	(CRTCD+12),HL
  CC2F                	SETCRT0:
  CC2F  21B0EC        		LD	HL,CRTCD
  CC32  AF            		XOR	A
  CC33                	SETCRT2:
  CC33  010018        		LD	BC,01800H
  CC36  ED79          		OUT	(C),A
  CC38  0C            		INC	C
  CC39  04            		INC	B
  CC3A  EDA3          		OUTI
  CC3C  3C            		INC	A
  CC3D  FE0C          		CP	12
  CC3F  20F2          		JR	NZ,SETCRT2
  CC41  0D            		DEC	C
  CC42  ED79          		OUT	(C),A
  CC44  0C            		INC	C
  CC45  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
                      	
  CC47  0D            		DEC	C
  CC48  3C            		INC	A
  CC49  ED79          		OUT	(C),A
  CC4B  0C            		INC	C
  CC4C  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  CC4E  23            		INC	HL
  CC4F  23            		INC	HL
  CC50  01031B        		LD	BC,01A03H+00100H
  CC53  EDA3          		OUTI
  CC55  01D020        		LD	BC,01FD0H+00100H
  CC58  EDA3          		OUTI
  CC5A  2192EC        		LD	HL,_KEYD
  CC5D  3E03          		LD	A,3
  CC5F  BE            		CP	(HL)
  CC60  CC15D7        		CALL	Z,KEYBC
  CC63  3600          		LD	(HL),0
  CC65  3E04          		LD	A,4
  CC67  CD4CD7        		CALL	MSG_A
  CC6A                	COMMAND:
  CC6A  CD1DCD        		CALL	SETDTA1
  CC6D  3A87EC        		LD	A,(_DVSW)
  CC70  C641          		ADD	A,'A'
  CC72  CD4CD7        		CALL	MSG_A
  CC75  3E3E          		LD	A,'>'
  CC77  CD4CD7        		CALL	MSG_A
  CC7A  3E50          		LD	A,80
  CC7C  12            		LD	(DE),A
  CC7D  CD9BD7        		CALL	_SYS0A		;(BDOS)文字列入力
  CC80  CDD4CE        		CALL	LTNL
                      	
  CC83  118200        		LD	DE,DTA1+2
  CC86  CDFDEC        		CALL	_COMANL
  CC89  30DF          		JR	NC,COMMAND
  CC8B  1179EB        		LD	DE,COMERM
  CC8E  CD6BD3        		CALL	_SYS09		;(BDOS)文字列出力
  CC91  C7            		RST	0
                      	
  CC92                	COMANL:
  CC92  CD51DC        		CALL	FILE
  CC95  3A19EB        		LD	A,(FNAME+4)
  CC98  FE20          		CP	020H
  CC9A  201C          		JR	NZ,COMB2
  CC9C  D5            		PUSH	DE
  CC9D  1115EB        		LD	DE,FNAME
  CCA0  1A            		LD	A,(DE)
  CCA1  FE20          		CP	020H
  CCA3  2844          		JR	Z,SDVSW
  CCA5  1B            		DEC	DE
  CCA6  1A            		LD	A,(DE)
  CCA7  C6FF          		ADD	A,0FFH
  CCA9  3809          		JR	C,COMB
  CCAB  13            		INC	DE
                      	
  CCAC  21F1D1        		LD	HL,COMTB
  CCAF  0609          		LD	B,COMS
  CCB1  CDE7DE        		CALL	CPNAME
  CCB4                	COMB:
  CCB4  D1            		POP	DE
  CCB5  D20F00        		JP	NC,JP_HL
  CCB8                	COMB2:
  CCB8  EB            		EX	DE,HL
  CCB9  2293CD        		LD	(COMPAT+1),HL
  CCBC  F5            		PUSH	AF
  CCBD  CD3BCD        		CALL	CEXE4
  CCC0  F1            		POP	AF
  CCC1  2115EB        		LD	HL,FNAME
  CCC4  116D00        		LD	DE,FCB2+1	;COMMAND NAME
  CCC7  010B00        		LD	BC,11
  CCCA  EDB0          		LDIR
  CCCC  11B0D1        		LD	DE,PATHD
  CCCF                	CEX1:
  CCCF  1A            		LD	A,(DE)
  CCD0  FE20          		CP	020H
  CCD2  D8            		RET	C
  CCD3  CD46DC        		CALL	FILEC
  CCD6  D5            		PUSH	DE
  CCD7  216D00        		LD	HL,FCB2+1	;COMMAND NAME
  CCDA  1115EB        		LD	DE,FNAME
  CCDD  010B00        		LD	BC,11
  CCE0  EDB0          		LDIR
  CCE2  CD3BCD        		CALL	CEXE4
  CCE5  D1            		POP	DE
  CCE6  13            		INC	DE
  CCE7  18E6          		JR	CEX1
                      	
  CCE9                	SDVSW:
  CCE9  F1            		POP	AF
  CCEA  3A14EB        		LD	A,(FDRV)
  CCED  3D            		DEC	A
  CCEE  5F            		LD	E,A
  CCEF  0E0E          		LD	C,00EH		;(BDOS)カレントドライブの設定
  CCF1  1831          		JR	SYSTEM0
                      	
  CCF3                	OPEN1:
  CCF3  2114EB        		LD	HL,FDRV
  CCF6                	OPEN:
  CCF6  0E11          		LD	C,011H		;(BDOS)ファイルの検索
  CCF8                	OPEN3:
  CCF8  D5            		PUSH	DE
  CCF9  118BD1        		LD	DE,DTA_CCP
  CCFC  CD1ACD        		CALL	SETDTA
  CCFF  EB            		EX	DE,HL
  CD00  CD24CD        		CALL	SYSTEM0
  CD03  D1            		POP	DE
  CD04  C9            		RET
                      	
  CD05                	OPEN2:
  CD05  0E12          		LD	C,012H
  CD07  18EF          		JR	OPEN3
                      	
  CD09                	DEFCB:				;Z=Ok NZ=Error
  CD09  118BD1        		LD	DE,DTA_CCP
  CD0C  CD22CD        		CALL	SYSC0F
                      	
  CD0F  11ACD1        		LD	DE,DTA_CCP+33	;(FCB)ランダムレコード
  CD12  0604          		LD	B,4
  CD14  CD14D0        		CALL	ZERO_MEMORY_DE
  CD17  110001        		LD	DE,00100H
  CD1A                	SETDTA:
  CD1A  C398D5        		JP	_SYS1A		;(BDOS)DTAの設定
                      	
  CD1D                	SETDTA1:
  CD1D  118000        		LD	DE,DTA1
  CD20  18F8          		JR	SETDTA
                      	
  CD22                	SYSC0F:
  CD22  0E0F          		LD	C,00FH		;(BDOS)ファイルのオープン
  CD24                	SYSTEM0:
  CD24  CD0500        		CALL	SYSTEM
  CD27  B7            		OR	A
  CD28  C9            		RET
                      	
  CD29                	C_CD:
  CD29  CD46DC        		CALL	FILEC
  CD2C  210000        		LD	HL,0
  CD2F  1114EB        		LD	DE,FDRV
  CD32  1803          		JR	S27
                      	
  CD34                	S27DTA:
  CD34  118BD1        		LD	DE,DTA_CCP
  CD37                	S27:
  CD37  0E27          		LD	C,027H		;(BDOS)ランダムブロック読み込み
  CD39  18E9          		JR	SYSTEM0
                      	
  CD3B                	CEXE4:
  CD3B  3A14EB        		LD	A,(FDRV)
  CD3E  325700        		LD	(00057H),A
  CD41  2A22EB        		LD	HL,(FDRV+14)
  CD44  225800        		LD	(00058H),HL
                      	
  CD47  211DEB        		LD	HL,FNAME+8
  CD4A  7E            		LD	A,(HL)
  CD4B  FE20          		CP	020H
  CD4D  2007          		JR	NZ,CEXE7
  CD4F  3E3F          		LD	A,'?'
  CD51  77            		LD	(HL),A
  CD52  23            		INC	HL
  CD53  77            		LD	(HL),A
  CD54  23            		INC	HL
  CD55  77            		LD	(HL),A
  CD56                	CEXE7:
  CD56  CDF3CC        		CALL	OPEN1
  CD59                	CEXE5:
  CD59  C0            		RET	NZ
  CD5A  2A95D1        		LD	HL,(DTA_CCP+1+9)
  CD5D  7C            		LD	A,H
  CD5E  CD6FDF        		CALL	CAP
  CD61  67            		LD	H,A
  CD62  7D            		LD	A,L
  CD63  CD6FDF        		CALL	CAP
  CD66  6F            		LD	L,A
  CD67  3A94D1        		LD	A,(DTA_CCP+1+8)
  CD6A  CD6FDF        		CALL	CAP
  CD6D  D642          		SUB	'B'
  CD6F  2830          		JR	Z,C_BAT
  CD71  3D            		DEC	A		;'C'
  CD72  2805          		JR	Z,C_EXE
  CD74                	CEXE6:
  CD74  CD05CD        		CALL	OPEN2
  CD77  18E0          		JR	CEXE5
                      	
  CD79                	C_EXE:
  CD79  7C            		LD	A,H
  CD7A  FE4D          		CP	'M'
  CD7C  20F6          		JR	NZ,CEXE6
                      	
  CD7E  CD09CD        		CALL	DEFCB
  CD81  2A0600        		LD	HL,(SYSTEM+1)
  CD84  25            		DEC	H
  CD85  CD34CD        		CALL	S27DTA
  CD88  3D            		DEC	A
  CD89  37            		SCF
  CD8A  C0            		RET	NZ
  CD8B  7C            		LD	A,H
  CD8C  B5            		OR	L
  CD8D  37            		SCF
  CD8E  C8            		RET	Z
  CD8F  CD1DCD        		CALL	SETDTA1
  CD92  110000        	COMPAT:	LD	DE,0
  CD95  CDDFCF        		CALL	SETFCB
  CD98  AF            		XOR	A
  CD99  67            		LD	H,A
  CD9A  6F            		LD	L,A	;HL=0x0000
  CD9B  31A0FF        		LD	SP,STACK
  CD9E  E5            		PUSH	HL
  CD9F  24            		INC	H	;HL=0x0100
  CDA0  E9            		JP	(HL)
                      	
  CDA1                	C_BAT:
  CDA1  114154        		LD	DE,'A'+'T'*256
  CDA4  ED52          		SBC	HL,DE
  CDA6  20CC          		JR	NZ,CEXE6
                      	
  CDA8  F1            		POP	AF
  CDA9  F1            		POP	AF
  CDAA  CD09CD        		CALL	DEFCB
  CDAD  210002        		LD	HL,00200H
  CDB0  CD34CD        		CALL	S27DTA
  CDB3  C6FE          		ADD	A,0FEH
  CDB5  D8            		RET	C
  CDB6  7D            		LD	A,L
  CDB7  B7            		OR	A
  CDB8  37            		SCF
  CDB9  C8            		RET	Z
  CDBA  3C            		INC	A
  CDBB  F5            		PUSH	AF
                      	
  CDBC  CD15D7        		CALL	KEYBC
  CDBF  3E1A          		LD	A,01AH
  CDC1  CD4CD7        		CALL	MSG_A
  CDC4  C1            		POP	BC
  CDC5  210001        		LD	HL,00100H
  CDC8                	BAT1:
  CDC8  A7            		AND	A
  CDC9  05            		DEC	B
  CDCA  C8            		RET	Z
  CDCB  7E            		LD	A,(HL)
  CDCC  FE25          		CP	'%'
  CDCE  280C          		JR	Z,BAT2
  CDD0                	BAT1X:
  CDD0  7E            		LD	A,(HL)
  CDD1  23            		INC	HL
  CDD2  FE1A          		CP	01AH
  CDD4  C8            		RET	Z
  CDD5  FE0A          		CP	00AH
  CDD7  C4FBD6        		CALL	NZ,KEYBS
  CDDA  18EC          		JR	BAT1
                      	
  CDDC                	BAT2:
  CDDC  23            		INC	HL
  CDDD  7E            		LD	A,(HL)
  CDDE  2B            		DEC	HL
  CDDF  D631          		SUB	'1'
  CDE1  38ED          		JR	C,BAT1X
  CDE3  FE09          		CP	9
  CDE5  30E9          		JR	NC,BAT1X
  CDE7  23            		INC	HL
  CDE8  23            		INC	HL
  CDE9  3C            		INC	A
  CDEA  4F            		LD	C,A
  CDEB  ED5B93CD      		LD	DE,(COMPAT+1)
  CDEF                	BAT3:
  CDEF  1A            		LD	A,(DE)
  CDF0  B7            		OR	A
  CDF1  28D5          		JR	Z,BAT1
  CDF3  CD28DD        		CALL	SPCUT
  CDF6  0D            		DEC	C
  CDF7  2808          		JR	Z,BAT5
  CDF9                	BAT4:
  CDF9  1A            		LD	A,(DE)
  CDFA  FE21          		CP	021H
  CDFC  38F1          		JR	C,BAT3
  CDFE  13            		INC	DE
  CDFF  18F8          		JR	BAT4
  CE01                	BAT5:
  CE01  1A            		LD	A,(DE)
  CE02  FE21          		CP	021H
  CE04  38C2          		JR	C,BAT1
  CE06  13            		INC	DE
  CE07  CDFBD6        		CALL	KEYBS
  CE0A  18F5          		JR	BAT5
                      	
  CE0C                	SWITCH:
  CE0C  1A            		LD	A,(DE)
  CE0D                	SW1:
  CE0D  13            		INC	DE
  CE0E  B9            		CP	C
  CE0F  1A            		LD	A,(DE)
  CE10  C8            		RET	Z
  CE11  FE20          		CP	020H
  CE13  30F8          		JR	NC,SW1
  CE15                	C_REM:
  CE15  AF            		XOR	A
  CE16  C9            		RET
                      	
  CE17                	C_DEL:
  CE17  CDDFCF        		CALL	SETFCB
  CE1A  CD62D7        		CALL	_SYS08		;(BDOS)エコーなしコンソール入力
                      	
  CE1D  0E13          		LD	C,013H
  CE1F  180A          		JR	CDEL1		;(BDOS)ファイルの削除
                      	
  CE21                	C_REN:
  CE21  CDDFCF        		CALL	SETFCB
  CE24  3E10          		LD	A,010H		;ディレクトリも対象にする
  CE26  326900        		LD	(FCB1+13),A	;属性
  CE29  0E17          		LD	C,017H		;(BDOS)ファイル名の変更
  CE2B                	CDEL1:
  CE2B  115C00        		LD	DE,FCB1
  CE2E  CD0500        		CALL	SYSTEM
  CE31  C6FF          		ADD	A,0FFH
  CE33  C9            		RET
                      	
  CE34                	C_DIR:
  CE34  CD46DC        		CALL	FILEC
  CE37  2115EB        		LD	HL,FDRV+1
  CE3A  CD76D1        		CALL	CWILD1
  CE3D  3EF1          		LD	A,0F1H
  CE3F  3221EB        		LD	(FDRV+13),A
  CE42  CDF3CC        		CALL	OPEN1
  CE45                	CDIR1:
  CE45  B7            		OR	A
  CE46  2008          		JR	NZ,PDSKF
  CE48  CD93CE        		CALL	P_NAME
  CE4B  CD05CD        		CALL	OPEN2
  CE4E  18F5          		JR	CDIR1
                      	
  CE50                	PDSKF:
  CE50  3A14EB        		LD	A,(FDRV)
  CE53  5F            		LD	E,A
  CE54  0E1B          		LD	C,01BH		;(BDOS)ディスク情報の獲得
  CE56  CD0500        		CALL	SYSTEM
  CE59  4F            		LD	C,A		;C←1クラスタ辺りの論理セクタ数
  CE5A  C601          		ADD	A,001H
  CE5C  D8            		RET	C		;Aが0FFHだった場合
  CE5D  AF            		XOR	A
  CE5E                	PDS1:				;HL=未使用クラスタの総数
  CE5E  CB19          		RR	C
  CE60  3804          		JR	C,PDS2
  CE62  29            		ADD	HL,HL
  CE63  8F            		ADC	A,A
  CE64  18F8          		JR	PDS1
  CE66                	PDS2:
  CE66  CB50          		BIT	2,B		;B←論理セクタのサイズの上位8ビット
  CE68  200A          		JR	NZ,PDSKF1	;K単位(4)になるまで未使用を2で割る
  CE6A  CB3F          		SRL	A
  CE6C  CB1C          		RR	H
  CE6E  CB1D          		RR	L
  CE70  CB10          		RL	B
  CE72  18F2          		JR	PDS2
  CE74                	PDSKF1:
  CE74  CD0BCF        		CALL	PRDEC_AHL
  CE77  1127D2        		LD	DE,KBFREE
  CE7A  CD6BD3        		CALL	_SYS09		;(BDOS)文字列出力
  CE7D  CDFDCE        		CALL	PUTDRV
  CE80  3E5C          		LD	A,05CH
  CE82  CD4CD7        		CALL	MSG_A
  CE85  2A22EB        		LD	HL,(FDRV+14)	;ディレクトリのクラスタ番号
  CE88  AF            		XOR	A
  CE89  11FEFF        		LD	DE,0-2
  CE8C  19            		ADD	HL,DE
  CE8D  23            		INC	HL
  CE8E  DC0ACF        		CALL	C,PRDEC_HL
  CE91  1841          		JR	LTNL
                      	
  CE93                	P_NAME:
  CE93  3A8CD1        		LD	A,(DTA_CCP+1)
  CE96  FE2E          		CP	'.'
  CE98  C8            		RET	Z
  CE99  1140D2        		LD	DE,DIRHD
  CE9C  CD6BD3        		CALL	_SYS09		;(BDOS)文字列出力
  CE9F  3A97D1        		LD	A,(DTA_CCP+1+00BH)
  CEA2  F5            		PUSH	AF
  CEA3  0F            		RRCA
  CEA4  9F            		SBC	A,A
  CEA5  E60A          		AND	'*'-020H
  CEA7  C620          		ADD	A,020H
  CEA9  CD4CD7        		CALL	MSG_A
  CEAC  CDFDCE        		CALL	PUTDRV
  CEAF  218CD1        		LD	HL,DTA_CCP+1
  CEB2  CD4ECF        		CALL	FPRNT
                      	
  CEB5  F1            		POP	AF
  CEB6  CB67          		BIT	4,A
  CEB8  2808          		JR	Z,DIR3
  CEBA  1135D2        		LD	DE,DIRMES
  CEBD  CD6BD3        		CALL	_SYS09		;(BDOS)文字列出力
  CEC0  180A          		JR	DIR6
  CEC2                	DIR3:
  CEC2  ED5BAAD1      		LD	DE,(DTA_CCP+1+01EH)
  CEC6  2AA8D1        		LD	HL,(DTA_CCP+1+01CH)
  CEC9  CD0ECF        		CALL	PRDEC_DEHL
  CECC                	DIR6:
  CECC  3AB1EC        		LD	A,(CRTCD+1)
  CECF  FE29          		CP	40+1
  CED1  D470CF        		CALL	NC,PRTTMS
                      	
  CED4                	LTNL:
  CED4  1E03          		LD	E,3
  CED6  C3CDEC        		JP	_PRINT
                      	
  CED9                	C_PATH:
  CED9  CD28DD        		CALL	SPCUT
  CEDC  21B0D1        		LD	HL,PATHD
  CEDF  FE21          		CP	021H
  CEE1  300E          		JR	NC,CPATH0
  CEE3  2B            		DEC	HL
  CEE4  2B            		DEC	HL
  CEE5                	CPATHP:
  CEE5  7E            		LD	A,(HL)
  CEE6  23            		INC	HL
  CEE7  FE20          		CP	020H
  CEE9  3F            		CCF
  CEEA  30E8          		JR	NC,LTNL
  CEEC  CD4CD7        		CALL	MSG_A
  CEEF  18F4          		JR	CPATHP
  CEF1                	CPATH0:
  CEF1  FE3B          		CP	';'
  CEF3  2001          		JR	NZ,CPATH1
  CEF5  13            		INC	DE
  CEF6                	CPATH1:
  CEF6  EB            		EX	DE,HL
  CEF7  014000        		LD	BC,PATHX
  CEFA  EDB0          		LDIR
  CEFC  C9            		RET
                      	
  CEFD                	PUTDRV:
  CEFD  3A14EB        		LD	A,(FDRV)
  CF00  C640          		ADD	A,'A'-1
  CF02  CD4CD7        		CALL	MSG_A
  CF05  3E3A          		LD	A,':'
  CF07                	MSG_AR:
  CF07  C34CD7        		JP	MSG_A
                      	
  CF0A                	PRDEC_HL:
  CF0A  AF            		XOR	A
  CF0B                	PRDEC_AHL:
  CF0B  5F            		LD	E,A
  CF0C  1600          		LD	D,0
  CF0E                	PRDEC_DEHL:
  CF0E  D5            		PUSH	DE
  CF0F  110FEB        		LD	DE,DECBF
  CF12  0605          		LD	B,5
  CF14  CD14D0        		CALL	ZERO_MEMORY_DE	;A=0
  CF17  D1            		POP	DE
                      	
  CF18  0E20          		LD	C,32
  CF1A                	DEC1:
  CF1A  29            		ADD	HL,HL
  CF1B  EB            		EX	DE,HL
  CF1C  ED6A          		ADC	HL,HL
  CF1E  EB            		EX	DE,HL
  CF1F  E5            		PUSH	HL
  CF20  2113EB        		LD	HL,DECBF+4
  CF23  0605          		LD	B,5
  CF25                	DEC2:
  CF25  7E            		LD	A,(HL)
  CF26  8F            		ADC	A,A
  CF27  27            		DAA
  CF28  77            		LD	(HL),A
  CF29  2B            		DEC	HL
  CF2A  10F9          		DJNZ	DEC2
  CF2C  E1            		POP	HL
  CF2D  0D            		DEC	C
  CF2E  20EA          		JR	NZ,DEC1
                      	
  CF30  210FEB        		LD	HL,DECBF
  CF33  3E20          		LD	A,020H
  CF35  0604          		LD	B,4
  CF37                	DEC3:
  CF37  CD44CF        		CALL	DEC4
  CF3A  CD44CF        		CALL	DEC4
  CF3D  23            		INC	HL
  CF3E  10F7          		DJNZ	DEC3
  CF40                	DECX:
  CF40  CD44CF        		CALL	DEC4
  CF43  AF            		XOR	A
  CF44                	DEC4:
  CF44  ED6F          		RLD
  CF46  FE20          		CP	020H
  CF48  2802          		JR	Z,DEC5
  CF4A  F630          		OR	030H
  CF4C                	DEC5:
  CF4C  18B9          		JR	MSG_AR
                      	
  CF4E                	FPRNT:
  CF4E  0608          		LD	B,8
  CF50  CD61CF        		CALL	P_N1
  CF53  7E            		LD	A,(HL)
  CF54  C680          		ADD	A,0A0H-020H
  CF56  FEA0          		CP	0A0H
  CF58  2802          		JR	Z,FPR1
  CF5A  3E2E          		LD	A,'.'
  CF5C                	FPR1:
  CF5C  CD4CD7        		CALL	MSG_A
  CF5F  0603          		LD	B,3
                      	
  CF61                	P_N1:
  CF61  C5            		PUSH	BC
  CF62  E5            		PUSH	HL
  CF63  7E            		LD	A,(HL)
  CF64  CD7BDF        		CALL	CAP3
  CF67  CD4CD7        		CALL	MSG_A
  CF6A  E1            		POP	HL
  CF6B  C1            		POP	BC
  CF6C  23            		INC	HL
  CF6D  10F2          		DJNZ	P_N1
  CF6F  C9            		RET
                      	
  CF70                	PRTTMS:
  CF70  3E20          		LD	A,020H
  CF72  CD4CD7        		CALL	MSG_A
                      	
  CF75  2AA4D1        		LD	HL,(DTA_CCP+1+24)
  CF78  7D            		LD	A,L
  CF79  B7            		OR	A
  CF7A  C8            		RET	Z
  CF7B  CB3C          		SRL	H
  CF7D  17            		RLA
  CF7E  17            		RLA
  CF7F  17            		RLA
  CF80  17            		RLA
  CF81  E60F          		AND	00FH
  CF83  57            		LD	D,A
  CF84  7C            		LD	A,H
  CF85  C650          		ADD	A,80
  CF87  CDCACF        		CALL	PRDEC_A
  CF8A  3E2D          		LD	A,'-'
  CF8C  CD4CD7        		CALL	MSG_A
  CF8F  7A            		LD	A,D
  CF90  CDCACF        		CALL	PRDEC_A
  CF93  3E2D          		LD	A,'-'
  CF95  CD4CD7        		CALL	MSG_A
  CF98  7D            		LD	A,L
  CF99  E61F          		AND	01FH
  CF9B  CDCACF        		CALL	PRDEC_A
                      	
  CF9E  2AA2D1        		LD	HL,(DTA_CCP+1+22)
                      	
  CFA1  3E20          		LD	A,020H
  CFA3  CD4CD7        		CALL	MSG_A
  CFA6  7C            		LD	A,H
  CFA7  65            		LD	H,L
  CFA8  0603          		LD	B,3
  CFAA                	PRTTMS1:
  CFAA  1F            		RRA
  CFAB  CB1D          		RR	L
  CFAD  10FB          		DJNZ	PRTTMS1
  CFAF  E61F          		AND	01FH
  CFB1  CDCACF        		CALL	PRDEC_A
  CFB4  3E3A          		LD	A,':'
  CFB6  CD4CD7        		CALL	MSG_A
  CFB9  7D            		LD	A,L
  CFBA  0F            		RRCA
  CFBB  0F            		RRCA
  CFBC  E63F          		AND	03FH
  CFBE  CDCACF        		CALL	PRDEC_A
  CFC1  3E3A          		LD	A,':'
  CFC3  CD4CD7        		CALL	MSG_A
  CFC6  7C            		LD	A,H
  CFC7  E61F          		AND	01FH
  CFC9  87            		ADD	A,A
                      	
                      	;	PRINT10
                      	
  CFCA                	PRDEC_A:
  CFCA  E5            		PUSH	HL
  CFCB  0608          		LD	B,8
  CFCD  4F            		LD	C,A
  CFCE  AF            		XOR	A
  CFCF                	PRTA1:
  CFCF  CB01          		RLC	C
  CFD1  8F            		ADC	A,A
  CFD2  27            		DAA
  CFD3  10FA          		DJNZ	PRTA1
  CFD5  210FEB        		LD	HL,DECBF
  CFD8  77            		LD	(HL),A
  CFD9  AF            		XOR	A
  CFDA  CD40CF        		CALL	DECX
  CFDD  E1            		POP	HL
  CFDE  C9            		RET
                      	
  CFDF                	SETFCB:
  CFDF  CD28DD        		CALL	SPCUT
  CFE2  1A            		LD	A,(DE)
  CFE3  FE20          		CP	020H
  CFE5  3801          		JR	C,SETFCBA
  CFE7  1B            		DEC	DE
  CFE8                	SETFCBA:
  CFE8  0624          		LD	B,36
  CFEA  215C00        		LD	HL,FCB1
  CFED  E5            		PUSH	HL
  CFEE  AF            		XOR	A
  CFEF  CDFDDC        		CALL	FILL_MEMORY
  CFF2  E1            		POP	HL
  CFF3  D5            		PUSH	DE
  CFF4  CDF7D5        		CALL	_SYS29		;(BDOS)ファイル名の解析
  CFF7  216C00        		LD	HL,FCB2
  CFFA  CDF7D5        		CALL	_SYS29		;(BDOS)ファイル名の解析
  CFFD  E1            		POP	HL
  CFFE  010050        		LD	BC,05000H
  D001  118100        		LD	DE,00081H
  D004                	SETFCB1:
  D004  7E            		LD	A,(HL)
  D005  23            		INC	HL
  D006  FE20          		CP	020H
  D008  3805          		JR	C,SETFCB2
  D00A  12            		LD	(DE),A
  D00B  13            		INC	DE
  D00C  0C            		INC	C
  D00D  10F5          		DJNZ	SETFCB1
  D00F                	SETFCB2:
  D00F  79            		LD	A,C
  D010  328000        		LD	(DTA1),A
  D013  04            		INC	B
  D014                	ZERO_MEMORY_DE:
  D014  AF            		XOR	A
  D015                	FILL_MEMORY_DE:
  D015  12            		LD	(DE),A
  D016  13            		INC	DE
  D017  10FC          		DJNZ	FILL_MEMORY_DE
  D019  C9            		RET
                      	
  D01A                	C_COPY:
  D01A  CDDFCF        		CALL	SETFCB
  D01D  118100        		LD	DE,DTA1+1
  D020  0E2F          		LD	C,'/'
  D022  CD0CCE        		CALL	SWITCH
  D025  CD6FDF        		CALL	CAP
  D028  32B0D0        		LD	(SW+1),A
                      	
  D02B  1161EB        		LD	DE,BEEPD
  D02E  CD49DC        		CALL	FILEC2
  D031  216C00        		LD	HL,FCB2
  D034  CDFED5        		CALL	S29X1
                      	
  D037  3E10          		LD	A,010H
  D039  326900        		LD	(FCB1+13),A
  D03C  216D00        		LD	HL,FCB2+1
  D03F  CD76D1        		CALL	CWILD1
  D042                	COPY0:
  D042  CD73D1        		CALL	CWILD
  D045  215C00        		LD	HL,FCB1
  D048  CDF6CC        		CALL	OPEN
  D04B  37            		SCF
  D04C                	COPY1:
  D04C  C0            		RET	NZ
  D04D  CD09CD        		CALL	DEFCB
                      	
  D050  3A98D1        		LD	A,(DTA_CCP+13)
  D053  CB67          		BIT	4,A
  D055  2824          		JR	Z,COPY1A
                      	
  D057  215D00        		LD	HL,FCB1+1
  D05A  CDA4E0        		CALL	CHKWILD
  D05D  3817          		JR	C,COPY9
                      	
  D05F  3E20          		LD	A,020H
  D061  325D00        		LD	(FCB1+1),A
  D064  2AA5D1        		LD	HL,(DTA_CCP+26)
  D067  23            		INC	HL
  D068  226A00        		LD	(FCB1+14),HL
  D06B  18D5          		JR	COPY0
                      	
  D06D                	COPYS:
  D06D  1174EB        		LD	DE,SKIP
  D070                	COPY8:
  D070  CD6BD3        		CALL	_SYS09		;(BDOS)文字列出力
  D073  CDD4CE        		CALL	LTNL
  D076                	COPY9:
  D076  CD05CD        		CALL	OPEN2
  D079  18D1          		JR	COPY1
                      	
  D07B                	COPY1A:
  D07B  216C00        		LD	HL,FCB2
  D07E  1114EB        		LD	DE,FDRV
  D081  018DD1        		LD	BC,DTA_CCP+2
  D084  EDA0          		LDI
  D086  3E0B          		LD	A,11
  D088                	COPY2:
  D088  F5            		PUSH	AF
  D089  7E            		LD	A,(HL)
  D08A  FE3F          		CP	'?'
  D08C  2001          		JR	NZ,COPY3
  D08E  0A            		LD	A,(BC)
  D08F                	COPY3:
  D08F  12            		LD	(DE),A
  D090  03            		INC	BC
  D091  13            		INC	DE
  D092  23            		INC	HL
  D093  F1            		POP	AF
  D094  3D            		DEC	A
  D095  20F1          		JR	NZ,COPY2
  D097  010500        		LD	BC,16-11
  D09A  EDB0          		LDIR
  D09C                	PUTNAME:
  D09C  215D00        		LD	HL,FCB1+1
  D09F  CDA4E0        		CALL	CHKWILD
  D0A2  300B          		JR	NC,PUTN1
  D0A4  2115EB        		LD	HL,FDRV+1
  D0A7  CD4ECF        		CALL	FPRNT
  D0AA  3E20          		LD	A,020H
  D0AC  CD4CD7        		CALL	MSG_A
  D0AF                	PUTN1:
  D0AF  3E00          	SW:	LD	A,000H
  D0B1  FE54          		CP	'T'
  D0B3  2005          		JR	NZ,CSW1
  D0B5  21CFD0        		LD	HL,SWNE
  D0B8  1807          		JR	SWT1
  D0BA                	CSW1:
  D0BA  FE4E          		CP	'N'
  D0BC  2011          		JR	NZ,SWNE
  D0BE  216DD0        		LD	HL,COPYS
  D0C1                	SWT1:
  D0C1  1114EB        		LD	DE,FDRV
  D0C4  CD22CD        		CALL	SYSC0F
  D0C7  2801          		JR	Z,SWN1
  D0C9  E9            		JP	(HL)
  D0CA                	SWN1:
  D0CA  CD26D1        		CALL	CTIME
  D0CD  309E          		JR	NC,COPYS
  D0CF                	SWNE:
  D0CF  1114EB        		LD	DE,FDRV
  D0D2  0E16          		LD	C,016H		;(BDOS)ファイルの作成
  D0D4  CD24CD        		CALL	SYSTEM0
  D0D7  204B          		JR	NZ,COPYE2
  D0D9  67            		LD	H,A		;A=0
  D0DA  6F            		LD	L,A
  D0DB  2235EB        		LD	(FDRV+33),HL	;(FCB)ランダムレコード
  D0DE  2237EB        		LD	(FDRV+35),HL
  D0E1                	COPY6:
  D0E1  CD81D1        		CALL	BUFSIZ
  D0E4  CD34CD        		CALL	S27DTA
  D0E7  47            		LD	B,A
  D0E8  3C            		INC	A
  D0E9  2831          		JR	Z,COPYE
  D0EB  7C            		LD	A,H
  D0EC  B5            		OR	L
  D0ED  280C          		JR	Z,COPY7
  D0EF  1114EB        		LD	DE,FDRV
  D0F2  0E26          		LD	C,026H		;(BDOS)ランダムブロック書き込み
  D0F4  CD24CD        		CALL	SYSTEM0
  D0F7  2023          		JR	NZ,COPYE
  D0F9  10E6          		DJNZ	COPY6
  D0FB                	COPY7:
  D0FB  3A98D1        		LD	A,(DTA_CCP+13)	;(FCB)属性
  D0FE  3221EB        		LD	(FDRV+13),A
  D101  219FD1        		LD	HL,DTA_CCP+20	;(FCB)タイムスタンプ
  D104  1128EB        		LD	DE,FDRV+20
  D107  010400        		LD	BC,4
  D10A  EDB0          		LDIR
                      	
  D10C  1114EB        		LD	DE,FDRV
  D10F  0E10          		LD	C,010H		;(BDOS)ファイルのクローズ
  D111  CD24CD        		CALL	SYSTEM0
  D114  2006          		JR	NZ,COPYE
                      	
  D116  1171EB        		LD	DE,OK
  D119  C370D0        		JP	COPY8
                      	
  D11C                	COPYE:
  D11C  1114EB        		LD	DE,FDRV
  D11F  0E13          		LD	C,013H		;(BDOS)ファイルの削除
  D121  CD0500        		CALL	SYSTEM
  D124                	COPYE2:
  D124  37            		SCF
  D125  C9            		RET
                      	
  D126                	CTIME:
  D126  ED5B9FD1      		LD	DE,(DTA_CCP+20)
  D12A  2A28EB        		LD	HL,(FDRV+20)
  D12D  A7            		AND	A
  D12E  ED52          		SBC	HL,DE
  D130  C0            		RET	NZ
  D131  ED5BA1D1      		LD	DE,(DTA_CCP+22)
  D135  2A2AEB        		LD	HL,(FDRV+22)
  D138  ED52          		SBC	HL,DE
  D13A  C9            		RET
                      	
  D13B                	C_TYPE:
  D13B  CDDFCF        		CALL	SETFCB
  D13E  215C00        		LD	HL,FCB1
  D141  CDF6CC        		CALL	OPEN
  D144  37            		SCF
  D145                	TYPE1:
  D145  C0            		RET	NZ
  D146  CD09CD        		CALL	DEFCB
  D149  3E1A          		LD	A,01AH
  D14B  CD4CD7        		CALL	MSG_A
  D14E                	TYPE2:
  D14E  CD81D1        		CALL	BUFSIZ
  D151  CD34CD        		CALL	S27DTA
  D154  C6FE          		ADD	A,0FEH
  D156  D8            		RET	C
  D157  7C            		LD	A,H
  D158  B5            		OR	L
  D159  2813          		JR	Z,TYPEE
  D15B  010001        		LD	BC,00100H
  D15E                	TYPE3:
  D15E  0A            		LD	A,(BC)
  D15F  03            		INC	BC
  D160  FE1A          		CP	01AH
  D162  280A          		JR	Z,TYPEE
  D164  CD4CD7        		CALL	MSG_A
  D167  2B            		DEC	HL
  D168  7C            		LD	A,H
  D169  B5            		OR	L
  D16A  20F2          		JR	NZ,TYPE3
  D16C  18E0          		JR	TYPE2
  D16E                	TYPEE:
  D16E  CD05CD        		CALL	OPEN2
  D171  18D2          		JR	TYPE1
                      	
  D173                	CWILD:
  D173  215D00        		LD	HL,FCB1+1
  D176                	CWILD1:
  D176  7E            		LD	A,(HL)
  D177  FE20          		CP	020H
  D179  C0            		RET	NZ
  D17A                	CWILD2:
  D17A  3E3F          		LD	A,'?'
  D17C  060B          		LD	B,11
  D17E  C3FDDC        		JP	FILL_MEMORY
                      	
  D181                	BUFSIZ:
  D181  3A0700        		LD	A,(SYSTEM+2)
  D184  3D            		DEC	A
  D185  E6F8          		AND	0F8H
  D187  67            		LD	H,A
  D188  2E00          		LD	L,0
  D18A  C9            		RET
                      	
  D18B                	DTA_CCP:
  D18B                		DS	37
                      	
  0040                	PATHX	EQU	64
  D1B0                	PATHD:	DS	PATHX
  D1F0  00            	PATHE:	DB	0
                      	
  0009                	COMS	EQU	9
  D1F1                	COMTB:
  D1F1  44202020      		DB	"D   "	;1
  D1F5  34CE          		DW	C_DIR
  D1F7  44495220      		DB	"DIR "	;2
  D1FB  34CE          		DW	C_DIR
  D1FD  434F5059      		DB	"COPY"	;3
  D201  1AD0          		DW	C_COPY
  D203  43442020      		DB	"CD  "	;4
  D207  29CD          		DW	C_CD
  D209  44454C20      		DB	"DEL "	;5
  D20D  17CE          		DW	C_DEL
  D20F  50415448      		DB	"PATH"	;6
  D213  D9CE          		DW	C_PATH
  D215  52454E20      		DB	"REN "	;7
  D219  21CE          		DW	C_REN
  D21B  54595045      		DB	"TYPE"	;8
  D21F  3BD1          		DW	C_TYPE
  D221  52454D20      		DB	"REM "	;9
  D225  15CE          		DW	C_REM
                      	
  D227  6B206279746573	KBFREE:	DB	"k bytes free",9,'$'
  D235  20202020203C44	DIRMES:	DB	"     <DIR>$"
  D240  20203A24      	DIRHD:	DB	"  :$"
                      	
                      	;LDDISK2.ASM
                      	
                      	;	LSX-Dodgers DISK2
                      	
                      	
                      	;	GRAPHIC RAM DISK DRIVER
                      	
                      	
  D244                	GDRD:
  D244  C5            		PUSH	BC
  D245  CD6DD2        		CALL	GADR
  D248  F1            		POP	AF
  D249                	GDRD1:
  D249  EDA2          		INI
  D24B  04            		INC	B
  D24C  0C            		INC	C
  D24D  20FA          		JR	NZ,GDRD1
  D24F  04            		INC	B
  D250  13            		INC	DE
  D251  3D            		DEC	A
  D252  20F5          		JR	NZ,GDRD1
  D254                	GBANK0:
  D254  3ABFEC        		LD	A,(WK1FD0)
  D257  E6EF          		AND	0EFH		;BANK0
  D259  181D          		JR	S1FD0
                      	
  D25B                	GDWT:
  D25B  C5            		PUSH	BC
  D25C  CD6DD2        		CALL	GADR
  D25F  F1            		POP	AF
  D260                	GDWT1:
  D260  04            		INC	B
  D261  EDA3          		OUTI
  D263  0C            		INC	C
  D264  20FA          		JR	NZ,GDWT1
  D266  04            		INC	B
  D267  13            		INC	DE
  D268  3D            		DEC	A
  D269  20F5          		JR	NZ,GDWT1
  D26B  18E7          		JR	GBANK0
                      	
  D26D                	GADR:
  D26D  0E00          		LD	C,0
  D26F  7B            		LD	A,E
  D270  C640          		ADD	A,040H
  D272  47            		LD	B,A
  D273  3ABFEC        		LD	A,(WK1FD0)
  D276  F610          		OR	010H		;BANK1
  D278                	S1FD0:
  D278  C5            		PUSH	BC
  D279  32BFEC        		LD	(WK1FD0),A
  D27C  01D01F        		LD	BC,01FD0H
  D27F  ED79          		OUT	(C),A
  D281  C1            		POP	BC
  D282  C9            		RET
                      	
                      	
                      	;	BANK RAM DISK DRIVER
                      	
  D283                	BDWT:
  D283  3E            		DB	03EH	;LD A,??
  D284  37            		SCF
  D285  1802          		JR	BRW
                      	
  D287                	BDRD:
  D287  3E            		DB	03EH	;LD A,??
  D288  A7            		AND	A
  D289                	BRW:
  D289  F3            		DI
  D28A  32B2D2        		LD	(BRWPAT),A
  D28D  ED73D2D2      		LD	(BANKSP+1),SP
  D291  3AD3D2        		LD	A,(BANKSP+2)
  D294  87            		ADD	A,A
  D295  3803          		JR	C,BRW0
  D297  310000        		LD	SP,EXTSP
  D29A                	BRW0:
  D29A  D9            		EXX		;裏レジスタ
  D29B  C5            		 PUSH	 BC
  D29C  D5            		 PUSH	 DE
  D29D  01000B        		 LD	 BC,00B00H	 ;バンクメモリ
  D2A0  111010        		 LD	 DE,01010H
  D2A3  D9            		 EXX		;表レジスタ
  D2A4                	BRW1:
  D2A4  C5            		PUSH	BC
  D2A5  D5            		PUSH	DE
  D2A6  EB            		EX	DE,HL
  D2A7  29            		ADD	HL,HL
  D2A8  29            		ADD	HL,HL
  D2A9  7C            		LD	A,H
  D2AA  E60F          		AND	00FH	;バンク
  D2AC  65            		LD	H,L
  D2AD  CB3C          		SRL	H	;/2
  D2AF  2E00          		LD	L,0
  D2B1  D9            		EXX		;裏レジスタ
  D2B2  A7            	BRWPAT:	 AND	 A	;自己書き換え(AND A:読み出し/SCF:書き込み)
  D2B3  3808          		 JR	 C,BRWT
  D2B5  57            		 LD	 D,A	 ;D=バンク
  D2B6  D9            		 EXX		;表レジスタ
  D2B7  EB            		EX	DE,HL
  D2B8  CDD6D2        		CALL	BTFR
  D2BB  1806          		JR	BRW2
  D2BD                	BRWT:
  D2BD  5F            		 LD	E,A	 ;E=バンク
  D2BE  D9            		 EXX		;表レジスタ
  D2BF  CDD6D2        		CALL	BTFR
  D2C2  EB            		EX	DE,HL
  D2C3                	BRW2:
  D2C3  D1            		POP	DE
  D2C4  C1            		POP	BC
  D2C5  13            		INC	DE
  D2C6  10DC          		DJNZ	BRW1
                      	
  D2C8  D9            		EXX		;裏レジスタ
  D2C9  3E10          		 LD	 A,10H
  D2CB  ED79          		 OUT	 (C),A		;メインメモリに切り替える
  D2CD  D1            		 POP	 DE
  D2CE  C1            		 POP	 BC
  D2CF  D9            		 EXX		;表レジスタ
  D2D0  AF            		XOR	A
  D2D1  310000        	BANKSP:	LD	SP,0
  D2D4  FB            		EI
  D2D5  C9            		RET
                      	
                      	;メインメモリ←→バンクメモリ 512バイトの転送を行う
                      	; DE:転送元アドレス
                      	; HL:転送先アドレス
                      	; 裏BC:バンク切り替えポート(0B00H)
                      	; 裏D:転送元バンク(0-0FH:10Hはメインメモリ)
                      	; 裏E:転送先バンク(0-0FH:10Hはメインメモリ)
                      	
  D2D6                	BTFR:
  D2D6  0600          		LD	B,0	;256回ループ(256*2)
  D2D8                	BTFR1:
  D2D8  D9            		EXX		;裏レジスタ
  D2D9  ED51          		 OUT	 (C),D	 ;BANK(MAIN)
  D2DB  D9            		 EXX		;表レジスタ
  D2DC  1A            		LD	A,(DE)
  D2DD  4F            		LD	C,A
  D2DE  13            		INC	DE
  D2DF  1A            		LD	A,(DE)
  D2E0  13            		INC	DE
  D2E1  D9            		EXX		;裏レジスタ
  D2E2  ED59          		 OUT	 (C),E	 ;MAIN(BANK)
  D2E4  D9            		 EXX		;表レジスタ
  D2E5  71            		LD	(HL),C
  D2E6  23            		INC	HL
  D2E7  77            		LD	(HL),A
  D2E8  23            		INC	HL
  D2E9  10ED          		DJNZ	BTFR1
  D2EB  C9            		RET
                      	
                      	;	EMM DRIVER(DMA)
                      	
                      	
  D2EC                	EDWT:
  D2EC  0E0F          		LD	C,15
  D2EE  1802          		JR	EDWT1
  D2F0                	EDRD:
  D2F0  0E0E          		LD	C,14
  D2F2                	EDWT1:
  D2F2  C5            		PUSH	BC
  D2F3  D5            		PUSH	DE
  D2F4  2235D3        		LD	(DMAB),HL
  D2F7  78            		LD	A,B
  D2F8  87            		ADD	A,A
  D2F9  3D            		DEC	A
  D2FA  322ED3        		LD	(DMALEN+1),A
  D2FD  3C            		INC	A
  D2FE  84            		ADD	A,H	;HL(アドレス)を先に進めておく
  D2FF  67            		LD	H,A
  D300  79            		LD	A,C
  D301  EB            		EX	DE,HL
  D302  29            		ADD	HL,HL
  D303  ED4BA0EC      		LD	BC,(_MAXCYL-1)
  D307  0E00          		LD	C,0
  D309  09            		ADD	HL,BC
  D30A  ED4B84EC      		LD	BC,(_DRIVE)
  D30E  060D          		LD	B,00DH
  D310  ED49          		OUT	(C),C
  D312  0C            		INC	C
  D313  ED69          		OUT	(C),L
  D315  0C            		INC	C
  D316  ED61          		OUT	(C),H
                      	
  D318  2129D3        		LD	HL,EDMAD
  D31B  CD2CDB        		CALL	SETDMA
  D31E  CD54DB        		CALL	GO_DMA
  D321  EB            		EX	DE,HL
  D322  D1            		POP	DE
  D323  C1            		POP	BC
  D324                	DMA_ADD_SEC:
  D324  13            		INC	DE
  D325  10FD          		DJNZ	DMA_ADD_SEC
  D327  AF            		XOR	A
  D328  C9            		RET
                      	
  D329                	EDMAD:
  D329  C3            		DB	0C3H	;WR6 リセット
  D32A  7D            		DB	07DH	;WR0 ポートA→ポートB 転送
  D32B  030D          		DW	00D03H	;ポートA開始アドレス EMMリード/ライト
  D32D  FF01          	DMALEN:	DW	001FFH	;ブロック長(転送サイズ-1)
  D32F  2C            		DB	02CH	;WR1 ポートAアドレス固定 I/O
  D330  50            		DB	050H	;WR2 ポートBアドレスインクリメント メモリ
  D331  02            		DB	002H	;ポートBタイミング
  D332  80            		DB	080H	;WR3
  D333  9A            		DB	09AH	;WR5 WAIT RDY:HIGH
  D334  AD            		DB	0ADH	;WR4 連続 ポートB開始アドレス
  D335  0000          	DMAB:	DW	0
  D337  01            		DB	001H	;WR0 ポートA←ポートB 転送
  D338                	EMME:
                      	
  0778                	AT_RE	EQU	EDWT-AT_EDWT
                      	
                      	
                      	;LDOS.ASM
                      	
                      	;	LSX-Dodgers OS
                      	
  D338                	BDOS0:
  D338  E5            		PUSH	HL
  D339  216000        		LD	HL,010000H-STACK
  D33C  39            		ADD	HL,SP
  D33D  3810          		JR	C,BDOS1X
  D33F                	BDOS2:
  D33F  E1            		POP	HL
  D340  ED734BD3      		LD	(BDSP+1),SP
  D344  310000        		LD	SP,EXTSP
  D347  CD4ED3        		CALL	BDOS1
  D34A  310000        	BDSP:	LD	SP,0
  D34D  C9            		RET
  D34E                	BDOS1:
  D34E  E5            		PUSH	HL
  D34F                	BDOS1X:
  D34F  79            		LD	A,C
  D350  FE31          		CP	031H
  D352  300A          		JR	NC,OVERFN
  D354  87            		ADD	A,A
  D355  6F            		LD	L,A
  D356  26EC          		LD	H,STABLE/256
  D358  7E            		LD	A,(HL)
  D359  2C            		INC	L
  D35A  66            		LD	H,(HL)
  D35B  6F            		LD	L,A
  D35C  E3            		EX	(SP),HL
  D35D  C9            		RET
  D35E                	OVERFN
  D35E  E1            		POP	HL
  D35F  FE6F          		CP	06FH		;DOSVER MSX-DOS のバージョン番号の獲得
  D361  2006          		JR	NZ,_ERROR
  D363  011D01        		LD	BC,011DH
  D366  113B01        		LD	DE,VER
  D369                	_ERROR:
  D369  AF            		XOR	A
  D36A  C9            		RET
                      	
  D36B                	_SYS09:		;文字列出力
  D36B  D5            		PUSH	DE
  D36C                	_SX09:
  D36C  1A            		LD	A,(DE)
  D36D  13            		INC	DE
  D36E  FE24          		CP	'$'
  D370  2832          		JR	Z,SX0E2
  D372  CD4CD7        		CALL	MSG_A
  D375  18F5          		JR	_SX09
                      	
  D377                	MSX1:
  D377  CD4CD7        		CALL	MSG_A
  D37A                	MSX:
  D37A  7E            		LD	A,(HL)
  D37B  23            		INC	HL
  D37C  B7            		OR	A
  D37D  20F8          		JR	NZ,MSX1
  D37F  C9            		RET
                      	
  D380                	_SYS0C:		;(BDOS)バージョン番号の獲得
  D380  212200        		LD	HL,00022H
  D383  AF            		XOR	A
  D384  7D            		LD	A,L
  D385  C9            		RET
                      	
  D386                	_SYS0D:		;(BDOS)ディスクリセット
  D386  CDDFEC        		CALL	_FFLUSH
  D389  E5            		PUSH	HL
  D38A  218000        		LD	HL,00080H
  D38D  228AEC        		LD	(_DTA),HL
  D390  E1            		POP	HL
  D391  D5            		PUSH	DE
  D392  1E00          		LD	E,0
  D394  3E            		DB	03EH
                      	
  D395                	_SYS0E:		;(BDOS)カレントドライブの設定
  D395  D5            		PUSH	DE
  D396  7B            		LD	A,E
  D397  DDE5          		PUSH	IX
  D399  CDDCEC        		CALL	_GETDPB
  D39C  DDE1          		POP	IX
  D39E  3804          		JR	C,SX0E2
  D3A0  7B            		LD	A,E
  D3A1  3287EC        		LD	(_DVSW),A
  D3A4                	SX0E2:
  D3A4  3E08          		LD	A,8
  D3A6  D1            		POP	DE
  D3A7  C9            		RET
                      	
  D3A8                	_SYS0F:		;(BDOS)ファイルのオープン
  D3A8  CD3ADD        		CALL	SETDRV
  D3AB  FD7E1C        		LD	A,(IY+28)	;(FCB)オープンモード
  D3AE  C602          		ADD	A,002H		;Write
  D3B0  2848          		JR	Z,FEND0F
  D3B2  CDA0E0        		CALL	CHKWILDX
                      	
  D3B5  D45ADD        		CALL	NC,SOPENX
  D3B8                	_S16XX:
  D3B8  3840          		JR	C,FEND0F
                      					;Directory location
  D3BA  3A9FEC        		LD	A,(_FILEN)
  D3BD  FD7719        		LD	(IY+25),A	;(FCB)ディレクトリロケーション
                      	;				_DIRF
  D3C0  3AA0EC        		LD	A,(_DIRF)
  D3C3  FD771D        		LD	(IY+29),A	;(FCB)ディレクトリモード
                      	;				_FBPS
  D3C6  FD731E        		LD	(IY+30),E	;(FCB)ディレクトリポジション
  D3C9  FD721F        		LD	(IY+31),D
                      	;				Open(Read)
  D3CC  FD361CFF      		LD	(IY+28),0FFH	;(FCB)オープンモード
                      	;				FILENAME
  D3D0  FDE5          		PUSH	IY
  D3D2  D1            		POP	DE
  D3D3  13            		INC	DE
  D3D4  010B00        		LD	BC,11
  D3D7  EDB0          		LDIR
                      	;				Attribute
  D3D9  7E            		LD	A,(HL)
  D3DA  FD770D        		LD	(IY+13),A	;(FCB)属性(アトリビュート)
  D3DD  110B00        		LD	DE,11		;Reserved
  D3E0  19            		ADD	HL,DE
                      						;(FCB)ファイルを最後に変更した時刻
  D3E1  11EAEB        		LD	DE,SDDATA		;(FCB)ファイルを最後に変更した日付
  D3E4  060A          		LD	B,SDDATAE-SDDATA	;(FCB)ファイルの先頭クラスタ
  D3E6                	S16LOOP:				;(FCB)ファイルのサイズ(バイト単位)
  D3E6  1A            		LD	A,(DE)
  D3E7  13            		INC	DE
  D3E8  32EFD3        		LD	(S16PAT+2),A
  D3EB  7E            		LD	A,(HL)
  D3EC  23            		INC	HL
  D3ED  FD7700        	S16PAT:	LD	(IY+0),A
  D3F0  10F4          		DJNZ	S16LOOP
                      	
  D3F2  AF            		XOR	A
  D3F3  FD770C        		LD	(IY+12),A	;(FCB)カレントブロック
  D3F6  FD22C6D4      		LD	(OFCB+1),IY
  D3FA                	FEND0F:
  D3FA  1843          		JR	FEND10
                      	
  D3FC                	_SYS10:		;(BDOS)ファイルのクローズ
  D3FC  CD3ADD        		CALL	SETDRV
  D3FF  FD7E1C        		LD	A,(IY+28)	;(FCB)オープンモード
  D402  D6FE          		SUB	0FEH
  D404  37            		SCF
  D405  3F            		CCF
  D406  2037          		JR	NZ,FEND10
  D408                	_S10A:				;Write
  D408  FD770E        		LD	(IY+14),A	;(FCB)レコードサイズ/アクセスするディレクトリのクラスタ番号+1
  D40B  FD770F        		LD	(IY+15),A
                      	
  D40E  FD341C        		INC	(IY+28)		;0FEH->0FFH ;オープンモード
  D411  CD8EE1        		CALL	SETTMS
                      	
  D414  FD7E1D        		LD	A,(IY+29)	;(FCB)ディレクトリモード
  D417  32A0EC        		LD	(_DIRF),A
  D41A  E67F          		AND	07FH
  D41C  326EE6        		LD	(_SECPS+1),A
  D41F  FD5E1E        		LD	E,(IY+30)	;(FCB)ディレクトリポジション
  D422  FD561F        		LD	D,(IY+31)
  D425  CD93DE        		CALL	READ_DIR
  D428  3815          		JR	C,FEND10
                      	
  D42A  FD7E19        		LD	A,(IY+25)	;(FCB)ディレクトリロケーション
  D42D  E61F          	SDECM1:	AND	01FH		;自己書き換え(1セクタ辺りのディレクトリエントリ数-1) 1024=01FH / 512=00FH / 256=7
  D42F  6F            		LD	L,A
  D430  2600          		LD	H,0
  D432  29            		ADD	HL,HL		;*2
  D433  29            		ADD	HL,HL		;*4
  D434  29            		ADD	HL,HL		;*8
  D435  29            		ADD	HL,HL		;*16
  D436  29            		ADD	HL,HL		;*32
  D437  ED4B7EEC      		LD	BC,(_DTBUF)
  D43B  09            		ADD	HL,BC
                      	
  D43C  CDB0E0        		CALL	SDIRENT
  D43F                	FEND10:
  D43F  186C          		JR	FEND
                      	
  D441                	OPENDD:
  D441  FD361CFD      		LD	(IY+28),0FDH	;(FCB)オープンモード
  D445  FD360D20      		LD	(IY+13),020H	;(FCB)属性(アトリビュート)
  D449  CD93E1        		CALL	SETTMSX
  D44C  185F          		JR	FEND
                      	
  D44E                	_SYS11:		;(BDOS)最初のファイルの検索
  D44E  CD3ADD        		CALL	SETDRV
  D451  CDDADE        		CALL	CHKDDX
  D454  3818          		JR	C,_S11A
  D456  FDE5          		PUSH	IY
  D458  E1            		POP	HL
  D459  ED5B8AEC      		LD	DE,(_DTA)
  D45D  010C00        		LD	BC,12
  D460  EDB0          		LDIR
  D462  3E20          		LD	A,020H
  D464  12            		LD	(DE),A
  D465  13            		INC	DE
  D466  62            		LD	H,D
  D467  6B            		LD	L,E
  D468  13            		INC	DE
  D469  0E13          		LD	C,19
  D46B  70            		LD	(HL),B
  D46C  183D          		JR	_S11B
  D46E                	_S11A:
  D46E  CD8EDD        		CALL	SOPEN
  D471                	_S12X1:
  D471  383A          		JR	C,FEND
  D473  CD2EDE        		CALL	SOPENE2
  D476  ED5B8AEC      		LD	DE,(_DTA)
  D47A  3A88EC        		LD	A,(_DRV)
  D47D  3C            		INC	A
  D47E  12            		LD	(DE),A
  D47F  D5            		PUSH	DE
  D480  13            		INC	DE
  D481  012000        		LD	BC,32
  D484  EDB0          		LDIR
  D486  FD6E0E        		LD	L,(IY+14)	;(FCB)レコードサイズ/アクセスするディレクトリのクラスタ番号+1
  D489  FD660F        		LD	H,(IY+15)
  D48C  22F4EB        		LD	(SCDIR),HL
  D48F  2A9AEC        		LD	HL,(_FBPS)
  D492  22F6EB        		LD	(SFBPS),HL
  D495  2A9FEC        		LD	HL,(_FILEN)
  D498  7C            		LD	A,H
  D499  B7            		OR	A
  D49A  2806          		JR	Z,_S12DIR
  D49C  3A6EE6        		LD	A,(_SECPS+1)
  D49F  F680          		OR	080H
  D4A1  67            		LD	H,A
  D4A2                	_S12DIR
  D4A2  22F8EB        		LD	(SFNDF),HL	;Directory position and Flags
  D4A5  E1            		POP	HL
  D4A6  1139EB        		LD	DE,SFILE
  D4A9  0E21          		LD	C,33
  D4AB                	_S11B:
  D4AB  EDB0          		LDIR
  D4AD                	FEND:
  D4AD  9F            		SBC	A,A		;CF=0 A=0 : CF=1 A=0FFH
  D4AE                	FENDE:
  D4AE  FDE1          		POP	IY
  D4B0  C1            		POP	BC
  D4B1  D1            		POP	DE
  D4B2  E1            		POP	HL
  D4B3  C9            		RET
                      	
  D4B4                	_SYS12:		;(BDOS)次のファイルの検索
  D4B4  E5            		PUSH	HL
  D4B5  D5            		PUSH	DE
  D4B6  C5            		PUSH	BC
  D4B7  FDE5          		PUSH	IY
  D4B9  CDF2DD        		CALL	NOPEN
  D4BC  18B3          		JR	_S12X1
                      	
  D4BE                	_S16K:
  D4BE  FD7E1C        		LD	A,(IY+28)	;(FCB)オープンモード
  D4C1  FEFD          		CP	0FDH		;Device(0FDH)
  D4C3  37            		SCF
  D4C4  C8            		RET	Z
                      	
  D4C5  110000        	OFCB:	LD	DE,0
  D4C8  D5            		PUSH	DE
  D4C9  061A          		LD	B,26		;First cluster
  D4CB                	S16K1:
  D4CB  13            		INC	DE
  D4CC  23            		INC	HL
  D4CD  10FC          		DJNZ	S16K1
                      	
  D4CF  1A            		LD	A,(DE)
  D4D0  BE            		CP	(HL)
  D4D1  2013          		JR	NZ,S16K2
  D4D3  13            		INC	DE
  D4D4  23            		INC	HL
  D4D5  1A            		LD	A,(DE)
  D4D6  BE            		CP	(HL)
  D4D7  200D          		JR	NZ,S16K2
                      	
  D4D9  E1            		POP	HL
  D4DA  FDE5          		PUSH	IY
  D4DC  D1            		POP	DE
  D4DD  1A            		LD	A,(DE)		;Drive
  D4DE  BE            		CP	(HL)
  D4DF  2006          		JR	NZ,S16K3
                      					;ここはCFが必ず0
  D4E1  ED52          		SBC	HL,DE		;CP HL,DE
  D4E3  37            		SCF
  D4E4  C0            		RET	NZ
  D4E5  E5            		PUSH	HL
  D4E6                	S16K2:
  D4E6  E1            		POP	HL
  D4E7                	S16K3:
  D4E7  FDE5          		PUSH	IY
  D4E9  D1            		POP	DE
  D4EA                	_SYS13:		;(BDOS)ファイルの削除
  D4EA  CD3ADD        		CALL	SETDRV
  D4ED  CDCADF        		CALL	KILL
  D4F0                	FEND13:
  D4F0  18BB          		JR	FEND
                      	
  D4F2                	_SYS14:		;(BDOS)シーケンシャルな読み出し
  D4F2  CD3ADD        		CALL	SETDRV
  D4F5  CDC0E1        		CALL	PUSHRR
  D4F8  CD01E2        		CALL	GETSEQ
                      	
  D4FB  CD15E2        		CALL	RB_READ
  D4FE  E5            		PUSH	HL
  D4FF  CDD4E1        		CALL	SETSEQ
  D502                	SREAD:
  D502  E1            		POP	HL
                      	
  D503  C601          		ADD	A,001H
  D505  38A6          		JR	C,FEND
                      	
  D507  7D            		LD	A,L
  D508  D601          		SUB	001H
  D50A                	FENDX:
  D50A  9F            		SBC	A,A
  D50B  E603          		AND	3
  D50D  1F            		RRA
  D50E  189E          		JR	FENDE
                      	
  D510                	_SYS15:		;(BDOS)シーケンシャルな書き込み
  D510  CD3ADD        		CALL	SETDRV
  D513  CDC0E1        		CALL	PUSHRR
  D516  CD01E2        		CALL	GETSEQ
                      	
  D519  CD0EE2        		CALL	RB_WRITE
  D51C  E5            		PUSH	HL
  D51D  CDD4E1        		CALL	SETSEQ
  D520                	SWRITE:
  D520  E1            		POP	HL
                      	
  D521  C6FF          		ADD	A,0FFH
  D523  18E5          		JR	FENDX
                      	
  D525                	_SYS17:		;(BDOS)ファイル名の変更
  D525  CD3ADD        		CALL	SETDRV
  D528  CD26E0        		CALL	NAME
  D52B  18C3          		JR	FEND13
                      	
  D52D                	_SYS16:		;(BDOS)ファイルの作成
  D52D  CD3ADD        		CALL	SETDRV
                      	
  D530  CDA0E0        		CALL	CHKWILDX
  D533  38BB          		JR	C,FEND13
  D535  FD7E01        		LD	A,(IY+1)	;(FCB)主ファイル名
  D538  FE05          		CP	5
  D53A  2805          		JR	Z,_S16X2
  D53C  FE21          		CP	021H
  D53E  DAF0D4        		JP	C,FEND13
  D541                	_S16X2:
                      	;				Clear FCB
  D541  FDE5          		PUSH	IY
  D543  E1            		POP	HL
  D544  011000        		LD	BC,16
  D547  09            		ADD	HL,BC
  D548                	_S16X1:
  D548  70            		LD	(HL),B		;B=0
  D549  23            		INC	HL
  D54A  0D            		DEC	C
  D54B  20FB          		JR	NZ,_S16X1
                      	
  D54D  CD93E1        		CALL	SETTMSX
  D550  FD360DFF      		LD	(IY+13),0FFH	;(FCB)Attribute
  D554  CD5ADD        		CALL	SOPENX
  D557  3F            		CCF
  D558  CCBED4        		CALL	Z,_S16K
  D55B  D43FDE        		CALL	NC,COPEN
  D55E  D4B0E0        		CALL	NC,SDIRENT
  D561  C3B8D3        		JP	_S16XX
                      	
  D564                	_SYS21:		;(BDOS)ランダムな読み出し
                      	
  D564  CD3ADD        		CALL	SETDRV
  D567  CDC0E1        		CALL	PUSHRR
  D56A  FD6E21        		LD	L,(IY+33)	;(FCB)Random record
  D56D  FD6622        		LD	H,(IY+34)
                      	
  D570  CD15E2        		CALL	RB_READ
  D573  E5            		PUSH	HL
  D574  CDEBE1        		CALL	POPRR
  D577  1889          		JR	SREAD
                      	
  D579                	_SYS22:		;(BDOS)ランダムな書き込み
  D579                	_SYS28:		;(BDOS)ランダムな書き込み・その2
  D579  CD3ADD        		CALL	SETDRV
  D57C  CDC0E1        		CALL	PUSHRR
  D57F  FD6E21        		LD	L,(IY+33)	;(FCB)Random record
  D582  FD6622        		LD	H,(IY+34)
                      	
  D585  CD0EE2        		CALL	RB_WRITE
  D588  E5            		PUSH	HL
  D589  CDEBE1        		CALL	POPRR
  D58C  1892          		JR	SWRITE
                      	
  D58E                	_SYS18:		;(BDOS)ログインベクトルの獲得
  D58E  21FF00        		LD	HL,000FFH
  D591  AF            		XOR	A
  D592  C9            		RET
                      	
  D593                	_SYS19:		;(BDOS)カレントドライブ番号の獲得
  D593  3A87EC        		LD	A,(_DVSW)
  D596  A7            		AND	A
  D597  C9            		RET
                      	
  D598                	_SYS1A:		;(BDOS)DTAの設定
  D598  ED538AEC      		LD	(_DTA),DE
  D59C  AF            		XOR	A
  D59D  C9            		RET
                      	
  D59E                	_SYS1B:		;(BDOS)ディスク情報の獲得
  D59E  7B            		LD	A,E
  D59F  CD4DDD        		CALL	GETDRV
  D5A2  CDDCEC        		CALL	_GETDPB
  D5A5  D4E2EC        		CALL	NC,_RDFATX
  D5A8  210000        		LD	HL,0
  D5AB  D46CE1        		CALL	NC,DSKF
                      	
  D5AE  ED5B6DE1      		LD	DE,(MAXCLP+1)	;DPB_08_MAXCL-1
  D5B2  1B            		DEC	DE		;DE←クラスタの総数
  D5B3  FD2A7CEC      		LD	IY,(_FATBF)	;IY←メモリ上のFATの先頭アドレス
  D5B7  9F            		SBC	A,A
  D5B8  D8            		RET	C
  D5B9  4F            		LD	C,A		;C=0
  D5BA  DD7E0F        		LD	A,(IX+00FH)	;DPB_0F_BPS
  D5BD  E60F          		AND	00FH
  D5BF  47            		LD	B,A
  D5C0  DD7E07        		LD	A,(IX+7)	;DPB_07_SECPCL
  D5C3  C9            		RET
                      	
  D5C4                	_SYS1D:		;(BDOS)書き込みが禁止されているディスクの調査
  D5C4  AF            		XOR	A
  D5C5  67            		LD	H,A
  D5C6  6F            		LD	L,A
  D5C7  C9            		RET
                      	
  D5C8                	_SYS1F:		;(BDOS)ディスク装置のパラメータの読み出し
  D5C8  2100ED        		LD	HL,DEVICE
  D5CB  7B            		LD	A,E
  D5CC  C3DCEC        		JP	_GETDPB
                      	
  D5CF                	_SYS23:		;(BDOS)ファイルサイズの獲得
  D5CF  E5            		PUSH	HL
  D5D0  2A1EEC        		LD	HL,(STABLE+2*00FH)	;ファイルのオープン
  D5D3  CD0F00        		CALL	JP_HL
  D5D6  3814          		JR	C,_S23X1
                      	
  D5D8  D5            		PUSH	DE		;EX DE,IY
  D5D9  FDE3          		EX	(SP),IY		;
                      	;	POP	DE		;
                      	;	PUSH	DE		;DEを破壊しないように注意vv
  D5DB  CDF1E1        		CALL	GETSIZE
  D5DE                	_S24X1:
  D5DE  FD7521        		LD	(IY+33),L	;(FCB)Random record
  D5E1  FD7422        		LD	(IY+34),H
  D5E4  FD362300      		LD	(IY+35),0
                      	;	POP	DE		;^^^^^^^^^^^^^^^^^^^^^^^^
                      	;	PUSH	DE		;EX DE,IY
  D5E8  FDE3          		EX	(SP),IY		;
  D5EA  D1            		POP	DE		;
                      	
  D5EB  AF            		XOR	A
  D5EC                	_S23X1:
  D5EC  E1            		POP	HL
  D5ED  C9            		RET
                      	
  D5EE                	_SYS24:		;(BDOS)ランダムレコードフィールドの設定
  D5EE  E5            		PUSH	HL
  D5EF  D5            		PUSH	DE		;EX DE,IY
  D5F0  FDE3          		EX	(SP),IY		;
                      	;	POP	DE		;
                      	;	PUSH	DE		;DEを破壊しないように注意vv
  D5F2  CD01E2        		CALL	GETSEQ
  D5F5  18E7          		JR	_S24X1		;^^^^^^^^^^^^^^^^^^^^^^^^
                      	
  D5F7                	_SYS29:		;(BDOS)ファイル名の解析
  D5F7  C5            		PUSH	BC
  D5F8  E5            		PUSH	HL
  D5F9  CD51DC        		CALL	FILE
  D5FC  E1            		POP	HL
  D5FD  C1            		POP	BC
  D5FE                	S29X1:
  D5FE  C5            		PUSH	BC
  D5FF  D5            		PUSH	DE
  D600  E5            		PUSH	HL
  D601  EB            		EX	DE,HL
  D602  2114EB        		LD	HL,FDRV
  D605  010D00        		LD	BC,13
  D608  EDB0          		LDIR
  D60A  70            		LD	(HL),B		;B=0
  D60B  0E03          		LD	C,3
  D60D  EDB0          		LDIR
  D60F  E1            		POP	HL
  D610  D1            		POP	DE
  D611  C1            		POP	BC
  D612  AF            		XOR	A
  D613  C9            		RET
                      	
  D614                	_SYS30:		;(BDOS)論理セクタを用いた書き込み
  D614  C5            		PUSH	BC
  D615  01DDE7        		LD	BC,DWT16
  D618  1804          		JR	S2FX
  D61A                	_SYS2F:
  D61A  C5            		PUSH	BC
  D61B  01CDE7        		LD	BC,DRD16
  D61E                	S2FX:
  D61E  ED4333D6      		LD	(S2FPAT+1),BC
  D622  CDDFEC        		CALL	_FFLUSH
                      	
  D625  D5            		PUSH	DE
  D626  E5            		PUSH	HL
  D627  7D            		LD	A,L		;Drive
  D628  CDD9EC        		CALL	_CHGDRV
  D62B  380D          		JR	C,S30X2
  D62D  44            		LD	B,H		;Number of clusters
  D62E  2A8AEC        		LD	HL,(_DTA)
  D631                	S30X:
  D631  C5            		PUSH	BC
  D632  CDCDE7        	S2FPAT:	CALL	DRD16
  D635  C1            		POP	BC
  D636  3802          		JR	C,S30X2
  D638  10F7          		DJNZ	S30X
  D63A                	S30X2:
  D63A  E1            		POP	HL
  D63B  D1            		POP	DE
  D63C  C1            		POP	BC
  D63D  9F            		SBC	A,A
  D63E  C9            		RET
                      	
                      	;LDIO.ASM
                      	
                      	;	LSX-Dodgers IO
                      	
  D369                	_SYS04	EQU	_ERROR		;(BDOS)外部出力
  D369                	_SYS05	EQU	_ERROR		;(BDOS)プリンタ出力
  D369                	_SYS1C	EQU	_ERROR		;(BDOS)ディスクの書き込み禁止化
  D369                	_SYS1E	EQU	_ERROR		;(BDOS)ファイル属性の設定
  D369                	_SYS20	EQU	_ERROR		;(BDOS)利用者番号の設定と読み出し
  D369                	_SYS2E	EQU	_ERROR		;(BDOS)ベリファイ・フラグの設定
                      	
  D63F                	BIOS:
  D63F  E5            		PUSH	HL
  D640  211080        		LD	HL,08010H
  D643  39            		ADD	HL,SP
  D644  E1            		POP	HL
  D645  300E          		JR	NC,BIOS2
  D647                	BIOS1:
  D647  CD4FD6        		CALL	BIOS3
  D64A  061E          		LD	B,01EH
  D64C  ED79          		OUT	(C),A
  D64E  C9            		RET
  D64F                	BIOS3:
  D64F  C5            		PUSH	BC
  D650  061D          		LD	B,01DH
  D652  ED79          		OUT	(C),A
  D654  C9            		RET
  D655                	BIOS2:
  D655  ED7360D6      		LD	(SPPAT+1),SP	;スタックがBIOS-ROMと被っている場合
  D659  310000        		LD	SP,EXTSP
  D65C  CD47D6        		CALL	BIOS1
  D65F  310000        	SPPAT:	LD	SP,0
  D662  C9            		RET
                      	
  D663                	INT:
  D663  F5            		PUSH	AF
  D664  E5            		PUSH	HL
  D665  216000        		LD	HL,010000H-STACK
  D668  39            		ADD	HL,SP
  D669  380F          		JR	C,INTP1X
  D66B  ED7376D6      		LD	(INTSP+1),SP
  D66F  310000        		LD	SP,EXTSP
  D672  CD82D6        		CALL	INTP1
  D675  310000        	INTSP:	LD	SP,0
  D678  1803          		JR	INTPE
  D67A                	INTP1X:
  D67A  CD82D6        		CALL	INTP1
  D67D                	INTPE:
  D67D  E1            		POP	HL
  D67E                	INTPE2:
  D67E  F1            		POP	AF
  D67F                	INTCTCE:
  D67F  FB            		EI
  D680  ED4D          		RETI
  D682                	INTP1:
  D682  C5            		PUSH	BC
                      	
  D683  CD5BDA        		CALL	IN49SB
  D686  67            		LD	H,A
  D687  CD5BDA        		CALL	IN49SB
  D68A  6F            		LD	L,A
                      	
  D68B  FE08          		CP	8		;DELキー
  D68D  2005          		JR	NZ,SCEXE
  D68F  7C            		LD	A,H
  D690  E611          		AND	011H		;CTRLキー + GRAPHキー
  D692  2808          		JR	Z,RESET
  D694                	SCEXE:
  D694  2292EC        		LD	(_KEYD),HL
  D697  CDC8D6        		CALL	KEYSET1
                      	
  D69A  C1            		POP	BC
  D69B  C9            		RET
                      	
  D69C                	RESET:
  D69C  3E1D          		LD	A,01DH
  D69E  D300          		OUT	(0),A
  D6A0  C7            		RST	0
                      	
  D6A1                	INTCTC2:
  D6A1  F5            		PUSH	AF
  D6A2  3E00          	INTCPAT:LD	A,000H
  D6A4  3D            		DEC	A
  D6A5  32A3D6        		LD	(INTCPAT+1),A
  D6A8  20D4          		JR	NZ,INTPE2
                      	
  D6AA  3A92EC        		LD	A,(_KEYD)
  D6AD  B7            		OR	A
  D6AE  28CE          		JR	Z,INTPE2
  D6B0                	KEYSET0:
  D6B0  E5            		PUSH	HL
  D6B1  2A90EC        		LD	HL,(_KEYPS)
  D6B4  7C            		LD	A,H
  D6B5  AD            		XOR	L
  D6B6  2006          		JR	NZ,INTC2A
                      	
  D6B8  2A92EC        		LD	HL,(_KEYD)
  D6BB  CDF2D6        		CALL	KEYSET
  D6BE                	INTC2A:
  D6BE  3A94EC        		LD	A,(_KEYSP)
  D6C1  E60F          		AND	00FH
  D6C3  32A3D6        		LD	(INTCPAT+1),A
                      	
  D6C6  18B5          		JR	INTPE
                      	
  D6C8                	KEYSET1:
  D6C8  CB6C          		BIT	5,H
  D6CA  F5            		PUSH	AF
  D6CB  ED4B8CEC      		LD	BC,(_CTC)
  D6CF  78            		LD	A,B
  D6D0  B1            		OR	C
  D6D1  2006          		JR	NZ,KEYS10E
                      	
  D6D3  F1            		POP	AF
  D6D4  201C          		JR	NZ,KEYSET
  D6D6  F5            		PUSH	AF
  D6D7  18D7          		JR	KEYSET0
  D6D9                	KEYS10E:
  D6D9  F1            		POP	AF
  D6DA  C8            		RET	Z
  D6DB  F5            		PUSH	AF
  D6DC  3E03          		LD	A,3		;CTC STOP
  D6DE  ED79          		OUT	(C),A
  D6E0  F1            		POP	AF
                      	
  D6E1  B7            		OR	A
  D6E2  C8            		RET	Z
                      	
  D6E3  E5            		PUSH	HL
  D6E4  2A94EC        		LD	HL,(_KEYSP)
  D6E7  3EA7          		LD	A,0A7H
  D6E9  ED79          		OUT	(C),A
  D6EB  ED69          		OUT	(C),L
  D6ED  7C            		LD	A,H
  D6EE  32A3D6        		LD	(INTCPAT+1),A
  D6F1  E1            		POP	HL
                      	
  D6F2                	KEYSET:
  D6F2  7D            		LD	A,L
  D6F3  CB7C          		BIT	7,H
  D6F5  CC22D7        		CALL	Z,FKEY
  D6F8  CB74          		BIT	6,H
  D6FA  C0            		RET	NZ
  D6FB                	KEYBS:
  D6FB  B7            		OR	A
  D6FC  C8            		RET	Z
  D6FD                	KEYBS1:
  D6FD  FE03          		CP	3
  D6FF  CC15D7        		CALL	Z,KEYBC
  D702  E5            		PUSH	HL
  D703  F5            		PUSH	AF
  D704  2A90EC        		LD	HL,(_KEYPS)
  D707  2C            		INC	L
  D708  7D            		LD	A,L
  D709  BC            		CP	H
  D70A  2812          		JR	Z,POP_AF_HL_SCF_RET
  D70C  3290EC        		LD	(_KEYPS),A
  D70F  26FE          		LD	H,KEYBF/256
  D711  F1            		POP	AF
  D712  77            		LD	(HL),A
  D713  E1            		POP	HL
  D714  C9            		RET
                      	
  D715                	KEYBC:
  D715  E5            		PUSH	HL
  D716  210000        		LD	HL,0
  D719  2290EC        		LD	(_KEYPS),HL
  D71C  E1            		POP	HL
  D71D  C9            		RET
                      	
  D71E                	POP_AF_HL_SCF_RET:
  D71E  F1            		POP	AF
  D71F  E1            		POP	HL
  D720  37            		SCF
  D721  C9            		RET
                      	
  D722                	FKEY:
  D722  CB75          		BIT	6,L
  D724  C8            		RET	Z
  D725  3E1B          		LD	A,01BH
  D727  CDFDD6        		CALL	KEYBS1
  D72A  7D            		LD	A,L
  D72B  C6AF          		ADD	A,020H-'q'
  D72D  CB7D          		BIT	7,L
  D72F  C8            		RET	Z
  D730  2E50          		LD	L,'P'
  D732  D690          		SUB	0E1H+020H-'q'
  D734  2810          		JR	Z,KEYBSL
  D736  2C            		INC	L
  D737  3D            		DEC	A
  D738  280C          		JR	Z,KEYBSL
  D73A  2C            		INC	L
  D73B  D609          		SUB	0EBH-0E2H
  D73D  2807          		JR	Z,KEYBSL
  D73F  2E43          		LD	L,'C'
  D741  3D            		DEC	A
  D742  2802          		JR	Z,KEYBSL
  D744  2E58          		LD	L,'X'
  D746                	KEYBSL:
  D746  7D            		LD	A,L
  D747  18B4          		JR	KEYBS1
                      	
  D749                	_SYS01:		;(BDOS)コンソール入力
  D749  CD09EB        		CALL	_SYS07
  D74C                	MSG_A:
  D74C  F5            		PUSH	AF
  D74D  D5            		PUSH	DE
  D74E  5F            		LD	E,A
  D74F  CD55D7        		CALL	_SYS02
  D752  D1            		POP	DE
  D753  F1            		POP	AF
  D754  C9            		RET
                      	
  D755                	_SYS02:		;(BDOS)コンソール出力
  D755  CD67D7        		CALL	BREAK
  D758  1805          		JR	PRINTX
                      	
  D75A                	_SYS06:		;(BDOS)コンソール直接入出力
  D75A  7B            		LD	A,E
  D75B  3C            		INC	A
  D75C  CACAEC        		JP	Z,_INKEY
  D75F                	PRINTX:
  D75F  C3CDEC        		JP	_PRINT
                      	
  D762                	_SYS08:		;(BDOS)エコーなしコンソール入力
  D762  CD09EB        		CALL	_SYS07
  D765  1804          		JR	BREAK1
  D767                	BREAK:
  D767  FB            		EI
  D768  3A92EC        		LD	A,(_KEYD)
  D76B                	BREAK1:
  D76B  FE03          		CP	3
  D76D  CA0000        		JP	Z,0
  D770  FE13          		CP	013H
  D772  C0            		RET	NZ
                      	
  D773                	PAUSE:
  D773  CD15D7        		CALL	KEYBC
                      	
  D776                	FLGET:
  D776  CDDFEC        		CALL	_FFLUSH
  D779  C5            		PUSH	BC
  D77A  E5            		PUSH	HL
  D77B  ED4B8EEC      		LD	BC,(_TXADR)
  D77F  CBE8          		SET	5,B
  D781  ED60          		IN	H,(C)
  D783                	FLGET1:
  D783  3A93EC        		LD	A,(_KEYD+1)
  D786  0F            		RRCA
  D787  0F            		RRCA
  D788  E610          		AND	010H
  D78A  F608          		OR	8
  D78C  ED68          		IN	L,(C)
  D78E  B5            		OR	L
  D78F  ED79          		OUT	(C),A
  D791  CDCAEC        		CALL	_INKEY
  D794  28ED          		JR	Z,FLGET1
  D796  ED61          		OUT	(C),H
  D798  E1            		POP	HL
  D799  C1            		POP	BC
  D79A  C9            		RET
                      	
  D79B                	_SYS0A:		;(BDOS)文字列入力
  D79B  C5            		PUSH	BC
  D79C  E5            		PUSH	HL
  D79D  D5            		PUSH	DE
  D79E  CDB8DB        		CALL	GETL
  D7A1  1100FF        		LD	DE,KBUF
  D7A4  E1            		POP	HL
  D7A5  E5            		PUSH	HL
  D7A6  0E00          		LD	C,0
  D7A8  3004          		JR	NC,SAX0
  D7AA  23            		INC	HL
  D7AB  23            		INC	HL
  D7AC  1808          		JR	SAX4
  D7AE                	SAX0:
  D7AE  46            		LD	B,(HL)
  D7AF  23            		INC	HL
  D7B0                	SAX1:
  D7B0  23            		INC	HL
  D7B1  1A            		LD	A,(DE)
  D7B2  13            		INC	DE
  D7B3  B7            		OR	A
  D7B4  2004          		JR	NZ,SAX2
  D7B6                	SAX4:
  D7B6  360D          		LD	(HL),00DH
  D7B8  1804          		JR	SAX3
  D7BA                	SAX2:
  D7BA  77            		LD	(HL),A
  D7BB  0C            		INC	C
  D7BC  10F2          		DJNZ	SAX1
  D7BE                	SAX3:
  D7BE  D1            		POP	DE
  D7BF  79            		LD	A,C
  D7C0  13            		INC	DE
  D7C1  12            		LD	(DE),A
  D7C2  1B            		DEC	DE
  D7C3  E1            		POP	HL
  D7C4  C1            		POP	BC
  D7C5  A7            		AND	A
  D7C6  C9            		RET
                      	
  D7C7                	_SYS0B:		;(BDOS)コンソール状態のチェック
  D7C7  CD67D7        		CALL	BREAK
  D7CA  3A92EC        		LD	A,(_KEYD)
  D7CD  B7            		OR	A
  D7CE  C8            		RET	Z
  D7CF                	CONSTX:
  D7CF  CDDFEC        		CALL	_FFLUSH
  D7D2  E5            		PUSH	HL
  D7D3  2A90EC        		LD	HL,(_KEYPS)
  D7D6  7C            		LD	A,H
  D7D7  AD            		XOR	L
  D7D8  E1            		POP	HL
  D7D9  C6FF          		ADD	A,0FFH
  D7DB  9F            		SBC	A,A
  D7DC  C9            		RET
                      	
  D7DD                	_SYS2A:		;(BDOS)日付の獲得
  D7DD  C5            		PUSH	BC
  D7DE  3EED          		LD	A,0EDH		;Read calendar
  D7E0  CD76DA        		CALL	COMOUT
  D7E3  CD00D8        		CALL	IN49SB_BCD	;YY
  D7E6  6F            		LD	L,A
  D7E7  2600          		LD	H,0
                      	;	LD	DE,1900		;0076CH
                      	;	CP	90		;90以上は1900年代 1990-1999
                      	;	JR	NC,RDDATE1	;90未満は2000年代 2000-2089
                      	;	LD	E,0D0H		;2000 & 0FFH D=007H
  D7E9  11D007        		LD	DE,2000		;すべて2000年代で処理 2000-2099
  D7EC                	RDDATE1:
  D7EC  19            		ADD	HL,DE
  D7ED  CD5BDA        		CALL	IN49SB		;MM
  D7F0  57            		LD	D,A
  D7F1  CD00D8        		CALL	IN49SB_BCD	;DD
  D7F4  5F            		LD	E,A
  D7F5  7A            		LD	A,D
  D7F6  E607          		AND	7
  D7F8  0604          		LD	B,4
  D7FA                	RDDATE2:
  D7FA  CB3A          		SRL	D
  D7FC  10FC          		DJNZ	RDDATE2
  D7FE  C1            		POP	BC
  D7FF  C9            		RET
  D800                	IN49SB_BCD:
  D800  CD5BDA        		CALL	IN49SB
                      	;------------------------
                      	;BCDの10進数化
                      	;in
                      	;	A  : BCD
                      	;out
                      	;	A  : 10進数
                      	;------------------------
  D803  4F            		LD	C,A
  D804  E6F0          		AND	0F0H	;10の位
  D806  0F            		RRCA
  D807  47            		LD	B,A
  D808  0F            		RRCA
  D809  0F            		RRCA
  D80A  80            		ADD	A,B
  D80B  47            		LD	B,A
  D80C  79            		LD	A,C
  D80D  E60F          		AND	00FH	;1の位
  D80F  80            		ADD	A,B
  D810  C9            		RET
                      	
  D811                	_SYS2C:		;(BDOS)時刻の獲得
  D811  C5            		PUSH	BC
  D812  3EEF          		LD	A,0EFH		;Read time
  D814  CD76DA        		CALL	COMOUT
  D817  CD00D8        		CALL	IN49SB_BCD	;TT
  D81A  67            		LD	H,A
  D81B  CD00D8        		CALL	IN49SB_BCD	;MM
  D81E  6F            		LD	L,A
  D81F  CD00D8        		CALL	IN49SB_BCD	;SS
  D822  57            		LD	D,A
  D823  C1            		POP	BC
  D824  AF            		XOR	A
  D825  C9            		RET
                      	
  D826                	ESC1:
  D826  7B            		LD	A,E
  D827  FE41          		CP	'A'
  D829  CA6AD9        		JP	Z,CTRL1E
  D82C  FE42          		CP	'B'
  D82E  CAE1DA        		JP	Z,CTRL1F
  D831  FE43          		CP	'C'
  D833  CA77D9        		JP	Z,CTRL1C
  D836  FE44          		CP	'D'
  D838  CA60D9        		JP	Z,CTRL1D
  D83B  FE45          		CP	'E'
  D83D  2802          		JR	Z,CT0CX
  D83F  FE6A          		CP	'j'
  D841                	CT0CX:
  D841  CAB4DA        		JP	Z,CTRL0C
  D844  FE48          		CP	'H'
  D846  CAF5D9        		JP	Z,CTRL0B
  D849  FE4A          		CP	'J'
  D84B  CAB7DA        		JP	Z,CTRL1A
  D84E  FE4B          		CP	'K'
  D850  CAB7D9        		JP	Z,CTRL05
  D853  FE4C          		CP	'L'
  D855  CAF6DA        		JP	Z,CTRL0E
  D858  FE54          		CP	'T'
  D85A  CAB7D9        		JP	Z,CTRL05
  D85D  FE78          		CP	'x'
  D85F  2804          		JR	Z,ESC1X
  D861  FE79          		CP	'y'
  D863  2002          		JR	NZ,ESC1Y
  D865                	ESC1X:
  D865  3601          		LD	(HL),1
  D867                	ESC1Y:
  D867  FE3D          		CP	'='
  D869  2804          		JR	Z,ESC1W
  D86B  FE59          		CP	'Y'
  D86D  2002          		JR	NZ,ESC1Z
  D86F                	ESC1W:
  D86F  3602          		LD	(HL),2
  D871                	ESC1Z:
  D871  FE20          		CP	020H
  D873  3802          		JR	C,ESC1C
  D875  87            		ADD	A,A
  D876  D0            		RET	NC
  D877                	ESC1C:
  D877  E1            		POP	HL
  D878  184A          		JR	ANK
                      	
  D87A                	ESC:
  D87A  21D5D8        		LD	HL,PRINTE5
  D87D  E5            		PUSH	HL
  D87E  21A0D8        		LD	HL,ESCFLG+1
  D881  3600          		LD	(HL),0
  D883  3D            		DEC	A
  D884  28A0          		JR	Z,ESC1
  D886  3D            		DEC	A
  D887  2009          		JR	NZ,ESC2
  D889  3603          		LD	(HL),3
  D88B  7B            		LD	A,E
  D88C  D620          		SUB	020H
  D88E  3295D8        		LD	(ESCYP+1),A
  D891  C9            		RET
  D892                	ESC2:
  D892  3D            		DEC	A
  D893  C0            		RET	NZ
  D894  2600          	ESCYP:	LD	H,0
  D896  7B            		LD	A,E
  D897  D620          		SUB	020H
  D899  6F            		LD	L,A
  D89A  C3D6EC        		JP	_LOC
                      	
  D89D                	PRINT:
  D89D  C5            		PUSH	BC
  D89E  E5            		PUSH	HL
  D89F  3E00          	ESCFLG:	LD	A,000H
  D8A1  B7            		OR	A
  D8A2  20D6          		JR	NZ,ESC
                      	
  D8A4  3E1F          		LD	A,01FH
  D8A6  BB            		CP	E
  D8A7  3030          		JR	NC,CTRL
  D8A9                	PRINTC:
  D8A9  A7            	INSFLG:	AND	A
  D8AA  DC7FDA        		CALL	C,CTRL12
                      	
  D8AD  3E00          	KANFLG:	LD	A,000H
  D8AF  B7            		OR	A
  D8B0  203F          		JR	NZ,KANJI2
  D8B2  7B            	X1KPAT:	LD	A,E
  D8B3  FE80          		CP	080H
  D8B5  380D          		JR	C,ANK
  D8B7  FEA0          		CP	0A0H
  D8B9  3804          		JR	C,KANJI1
  D8BB  FEE0          		CP	0E0H
  D8BD  3805          		JR	C,ANK
  D8BF                	KANJI1:
  D8BF  32AED8        		LD	(KANFLG+1),A
  D8C2  1811          		JR	PRINTE5
  D8C4                	ANK:
  D8C4  ED4B8EEC      		LD	BC,(_TXADR)
  D8C8  78            		LD	A,B
  D8C9  F638          		OR	038H
  D8CB  47            		LD	B,A
  D8CC  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令	kanji
  D8CE  CB98          		RES	3,B
  D8D0  ED59          		OUT	(C),E		;Text
  D8D2                	KANJIE:
  D8D2  CD3CD9        		CALL	PRINTE7
  D8D5                	PRINTE5:
  D8D5  E1            		POP	HL
  D8D6  C1            		POP	BC
  D8D7  AF            		XOR	A
  D8D8  C9            		RET
                      	
  D8D9                	CTRL:
  D8D9  CD23D9        		CALL	KANCLR
  D8DC  3EA7          		LD	A,0A7H		;AND	A
  D8DE  32A9D8        		LD	(INSFLG),A
  D8E1  7B            		LD	A,E
  D8E2  87            		ADD	A,A
  D8E3  F680          		OR	080H
  D8E5  6F            		LD	L,A
  D8E6  26EB          		LD	H,CTRLTB/256
  D8E8  7E            		LD	A,(HL)
  D8E9  2C            		INC	L
  D8EA  66            		LD	H,(HL)
  D8EB  6F            		LD	L,A
  D8EC  CD0F00        		CALL	JP_HL
  D8EF  18E4          		JR	PRINTE5
                      	
  D8F1                	KANJI2:
  D8F1  D5            		PUSH	DE
  D8F2  57            		LD	D,A
  D8F3  01812F        		LD	BC,02F81H	;SFTJIS
  D8F6  DF            		RST	018H
  D8F7  01C32F        		LD	BC,02FC3H	;Instead or JISVRM
  D8FA  DF            		RST	018H
                      	
  D8FB  ED4B8EEC      		LD	BC,(_TXADR)
  D8FF  78            		LD	A,B
  D900  F638          		OR	038H
  D902  47            		LD	B,A
  D903  ED51          		OUT	(C),D		;kanji
  D905  CB98          		RES	3,B
  D907  ED59          		OUT	(C),E		;Text
  D909  CD3CD9        		CALL	PRINTE7
  D90C  ED4B8EEC      		LD	BC,(_TXADR)
  D910  78            		LD	A,B
  D911  F638          		OR	038H
  D913  47            		LD	B,A
  D914  CBF2          		SET	6,D
  D916  ED51          		OUT	(C),D		;Kanji
  D918  CB98          		RES	3,B
  D91A  ED59          		OUT	(C),E		;Text
  D91C  D1            		POP	DE
  D91D  AF            		XOR	A
  D91E  32AED8        		LD	(KANFLG+1),A
  D921  18AF          		JR	KANJIE
                      	
  D923                	KANCLR:
  D923  3AAED8        		LD	A,(KANFLG+1)
  D926  B7            		OR	A
  D927  C8            		RET	Z
  D928  ED4B8EEC      		LD	BC,(_TXADR)
  D92C  78            		LD	A,B
  D92D  F638          		OR	038H
  D92F  47            		LD	B,A
  D930  AF            		XOR	A
  D931  32AED8        		LD	(KANFLG+1),A
  D934  ED79          		OUT	(C),A		;Kanji
  D936  CB98          		RES	3,B
  D938  3E20          		LD	A,020H
  D93A  ED79          		OUT	(C),A		;Text
  D93C                	PRINTE7:
  D93C  CBA0          		RES	4,B
  D93E                	PRINTE6:
  D93E  3A96EC        		LD	A,(_COLORF)
  D941                	PRINTE4:
  D941  ED79          		OUT	(C),A		;Color
  D943  78            		LD	A,B
  D944  E607          		AND	7
  D946  47            		LD	B,A
  D947                	PRINTE2:
  D947  03            		INC	BC
  D948                	PRINTE3:
  D948  2ABAEC        		LD	HL,(CRTCD+10)
  D94B  A7            		AND	A
  D94C  ED4A          		ADC	HL,BC
  D94E                	PRINTE8:
  D94E  2805          		JR	Z,PRINT2
  D950                	PRINTE1:
  D950  ED438EEC      		LD	(_TXADR),BC
  D954                	PRINTE:
  D954  C9            		RET
                      	
  D955                	PRINT2:
  D955  CDFCDA        		CALL	SCR
  D958  2ABCEC        		LD	HL,(CRTCD+12)
  D95B  09            		ADD	HL,BC
  D95C  228EEC        		LD	(_TXADR),HL
  D95F  C9            		RET
                      	
  D960                	CTRL08:
  D960                	CTRL1D:
  D960  ED4B8EEC      		LD	BC,(_TXADR)
  D964  78            		LD	A,B
  D965  B1            		OR	C
  D966  C8            		RET	Z
  D967  0B            		DEC	BC
  D968  18E6          		JR	PRINTE1
                      	
  D96A                	CTRL1E:
  D96A  ED4B8EEC      		LD	BC,(_TXADR)
  D96E  2ABCEC        		LD	HL,(CRTCD+12)
  D971  09            		ADD	HL,BC
  D972  D0            		RET	NC
  D973  44            		LD	B,H
  D974  4D            		LD	C,L
  D975  18D9          		JR	PRINTE1
                      	
  D977                	CTRL1C:
  D977  ED4B8EEC      		LD	BC,(_TXADR)
  D97B  18CA          		JR	PRINTE2
                      	
  D97D                	CTRL09:
  D97D  ED4B8EEC      		LD	BC,(_TXADR)
  D981  79            		LD	A,C
  D982  E6F8          		AND	0F8H
  D984  C608          		ADD	A,8
  D986  4F            		LD	C,A
  D987  88            		ADC	A,B
  D988  91            		SUB	C
  D989  47            		LD	B,A
  D98A  18BC          		JR	PRINTE3
                      	
  D98C                	CTRL02:
  D98C  2A8EEC        		LD	HL,(_TXADR)
  D98F  7C            		LD	A,H
  D990  B5            		OR	L
  D991  C8            		RET	Z
  D992  2B            		DEC	HL
  D993  228EEC        		LD	(_TXADR),HL
  D996  D5            		PUSH	DE
  D997  CDD3EC        		CALL	_POS
  D99A  3AB1EC        		LD	A,(CRTCD+1)
  D99D  95            		SUB	L
  D99E  6F            		LD	L,A
  D99F  2D            		DEC	L
  D9A0  2638          		LD	H,038H
  D9A2  ED4B8EEC      		LD	BC,(_TXADR)
  D9A6  09            		ADD	HL,BC
  D9A7  44            		LD	B,H
  D9A8  4D            		LD	C,L
  D9A9  110020        		LD	DE,02000H	;D:Text E:kanji
  D9AC  2A96EC        		LD	HL,(_COLORF)	;L:Color
  D9AF                	C8X1:
  D9AF  CD9BDA        		CALL	C12S
  D9B2  0B            		DEC	BC
  D9B3  20FA          		JR	NZ,C8X1
  D9B5  D1            		POP	DE
  D9B6  C9            		RET
                      	
  D9B7                	CTRL05:
  D9B7  CDD3EC        		CALL	_POS
  D9BA  3AB1EC        		LD	A,(CRTCD+1)
  D9BD  95            		SUB	L
  D9BE  6F            		LD	L,A
  D9BF  2620          		LD	H,020H
  D9C1  ED4B8EEC      		LD	BC,(_TXADR)
  D9C5                	C05X1:
  D9C5  78            		LD	A,B
  D9C6  F638          		OR	038H
  D9C8  47            		LD	B,A
  D9C9  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令	kanji
  D9CB  CB98          		RES	3,B
  D9CD  ED61          		OUT	(C),H		;Text
  D9CF  CBA0          		RES	4,B
  D9D1  3A96EC        		LD	A,(_COLORF)
  D9D4  ED79          		OUT	(C),A		;Color
  D9D6  03            		INC	BC
  D9D7  2D            		DEC	L
  D9D8  20EB          		JR	NZ,C05X1
  D9DA  C9            		RET
                      	
  D9DB                	CTRL0D:
  D9DB  CDD3EC        		CALL	_POS
  D9DE  2E00          		LD	L,0
  D9E0                	LOC:
  D9E0  C5            		PUSH	BC
  D9E1  E5            		PUSH	HL
  D9E2  CD23D9        		CALL	KANCLR
  D9E5  CD02DA        		CALL	LOC1
  D9E8  ED438EEC      		LD	(_TXADR),BC
  D9EC  E1            		POP	HL
  D9ED  C1            		POP	BC
  D9EE  C9            		RET
                      	
  D9EF                	CTRL01:
  D9EF  3E37          		LD	A,037H		;SCF
  D9F1  32A9D8        		LD	(INSFLG),A
  D9F4  C9            		RET
                      	
  D9F5                	CTRL0B:
  D9F5  210000        		LD	HL,0
  D9F8  228EEC        		LD	(_TXADR),HL
  D9FB  C9            		RET
                      	
  D9FC                	CTRL1B:
  D9FC  3E01          		LD	A,1
  D9FE  32A0D8        		LD	(ESCFLG+1),A
  DA01  C9            		RET
                      	
  DA02                	LOC1:
  DA02  44            		LD	B,H
  DA03  4D            		LD	C,L
  DA04  04            		INC	B
  DA05  05            		DEC	B
  DA06  C8            		RET	Z
  DA07  D5            		PUSH	DE
  DA08  ED5BB1EC      		LD	DE,(CRTCD+1)
  DA0C  210000        		LD	HL,0
  DA0F  55            		LD	D,L
  DA10                	LOC2:
  DA10  19            		ADD	HL,DE
  DA11  10FD          		DJNZ	LOC2
  DA13  09            		ADD	HL,BC
  DA14  D1            		POP	DE
  DA15                	LOC3:
  DA15  44            		LD	B,H
  DA16  4D            		LD	C,L
  DA17  C9            		RET
                      	
  DA18                	CONOUT1:
  DA18  CD2FDA        		CALL	CURSOR
  DA1B  59            		LD	E,C
  DA1C  CDCDEC        		CALL	_PRINT
  DA1F  7B            		LD	A,E
  DA20  FE1A          		CP	01AH
  DA22  CAB4DA        		JP	Z,CTRL0C
  DA25  FE0A          		CP	00AH
  DA27  2006          		JR	NZ,CURSOR
  DA29  CDDBD9        		CALL	CTRL0D
  DA2C  CDB7D9        		CALL	CTRL05
  DA2F                	CURSOR:
  DA2F  C5            		PUSH	BC
  DA30  ED4B8EEC      		LD	BC,(_TXADR)
  DA34  CBE8          		SET	5,B
  DA36  ED78          		IN	A,(C)
  DA38  EE18          		XOR	018H
  DA3A  ED79          		OUT	(C),A
  DA3C  C1            		POP	BC
  DA3D  C9            		RET
                      	
  DA3E                	CTRL07:
  DA3E  2161EB        		LD	HL,BEEPD
  DA41                	BEEP1:
  DA41  7E            		LD	A,(HL)
  DA42  23            		INC	HL
  DA43  FEFF          		CP	0FFH
  DA45  C8            		RET	Z
  DA46  F3            		DI
  DA47  061C          		LD	B,01CH
  DA49  ED79          		OUT	(C),A
  DA4B  EDA3          		OUTI
  DA4D  FB            		EI
  DA4E  18F1          		JR	BEEP1
                      	
  DA50                	OT49SB:
  DA50  C5            		PUSH	BC
  DA51  CD6CDA        		CALL	CANW
  DA54  010019        		LD	BC,01900H
  DA57  ED79          		OUT	(C),A
  DA59  C1            		POP	BC
  DA5A  C9            		RET
                      	
  DA5B                	IN49SB:
  DA5B  C5            		PUSH	BC
  DA5C  01011A        		LD	BC,01A01H
  DA5F                	CANR:
  DA5F  ED78          		IN	A,(C)
  DA61  E620          		AND	020H
  DA63  20FA          		JR	NZ,CANR
  DA65  010019        		LD	BC,01900H
  DA68  ED78          		IN	A,(C)
  DA6A  C1            		POP	BC
  DA6B  C9            		RET
                      	
  DA6C                	CANW:
  DA6C  01011A        		LD	BC,01A01H
  DA6F  ED48          		IN	C,(C)
  DA71  CB71          		BIT	6,C
  DA73  20F7          		JR	NZ,CANW
  DA75  C9            		RET
                      	
  DA76                	COMOUT:
  DA76  FB            		EI
  DA77  CD50DA        		CALL	OT49SB
  DA7A  CD6CDA        		CALL	CANW
  DA7D  F3            		DI
  DA7E  C9            		RET
                      	
  DA7F                	CTRL12:
  DA7F  D5            		PUSH	DE
  DA80  CDD3EC        		CALL	_POS
  DA83  3AB1EC        		LD	A,(CRTCD+1)
  DA86  95            		SUB	L
  DA87  ED4B8EEC      		LD	BC,(_TXADR)
  DA8B  110020        		LD	DE,02000H	;D:Text E:Kanji
  DA8E  2A96EC        		LD	HL,(_COLORF)	;L:Color
  DA91  CBE8          		SET	5,B
  DA93                	C12X1:
  DA93  CD9BDA        		CALL	C12S
  DA96  03            		INC	BC
  DA97  20FA          		JR	NZ,C12X1
  DA99  D1            		POP	DE
  DA9A  C9            		RET
                      	
  DA9B                	C12S:
  DA9B  CBE0          		SET	4,B
  DA9D  CBD8          		SET	3,B
  DA9F  ED60          		IN	H,(C)
  DAA1  ED59          	X1PAT:	OUT	(C),E
  DAA3  5C            		LD	E,H
  DAA4  CB98          		RES	3,B
  DAA6  ED60          		IN	H,(C)
  DAA8  ED51          		OUT	(C),D
  DAAA  54            		LD	D,H
  DAAB  CBA0          		RES	4,B
  DAAD  ED60          		IN	H,(C)
  DAAF  ED69          		OUT	(C),L
  DAB1  6C            		LD	L,H
  DAB2  3D            		DEC	A
  DAB3  C9            		RET
                      	
  DAB4                	CTRL0C:
  DAB4  CDF5D9        		CALL	CTRL0B
  DAB7                	CTRL1A:
  DAB7  ED4B8EEC      		LD	BC,(_TXADR)
  DABB                	C1AX1:
  DABB  78            		LD	A,B
  DABC  F638          		OR	038H
  DABE  47            		LD	B,A
  DABF  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令	kanji
  DAC1  CB98          		RES	3,B
  DAC3  3E20          		LD	A,020H
  DAC5  ED79          		OUT	(C),A		;Text
  DAC7  CBA0          		RES	4,B
  DAC9  3A96EC        		LD	A,(_COLORF)
  DACC  ED79          		OUT	(C),A		;Color
  DACE  03            		INC	BC
  DACF  CBA8          		RES	5,B
  DAD1  2ABAEC        		LD	HL,(CRTCD+10)
  DAD4  09            		ADD	HL,BC
  DAD5  30E4          		JR	NC,C1AX1
  DAD7  C9            		RET
                      	
  DAD8                	CTRL04:
  DAD8  CDD3EC        		CALL	_POS
  DADB  7D            		LD	A,L
  DADC  B7            		OR	A
  DADD  C8            		RET	Z
  DADE                	CTRL03:
  DADE  CDDBD9        		CALL	CTRL0D
  DAE1                	CTRL0A:
  DAE1                	CTRL1F:
  DAE1  ED4B8EEC      		LD	BC,(_TXADR)
  DAE5  2AB1EC        		LD	HL,(CRTCD+1)
  DAE8  2600          		LD	H,0
  DAEA  09            		ADD	HL,BC
  DAEB  44            		LD	B,H
  DAEC  4D            		LD	C,L
  DAED  2ABAEC        		LD	HL,(CRTCD+10)
  DAF0  09            		ADD	HL,BC
  DAF1  3F            		CCF
  DAF2  9F            		SBC	A,A
  DAF3  C34ED9        		JP	PRINTE8
                      	
  DAF6                	CTRL0E:
  DAF6  CDD3EC        		CALL	_POS
  DAF9  7C            		LD	A,H
  DAFA  1804          		JR	SCR1
  DAFC                	SCR:
  DAFC  3A97EC        		LD	A,(_LINE)
  DAFF  3D            		DEC	A
  DB00                	SCR1:
  DB00  C5            		PUSH	BC
  DB01  D5            		PUSH	DE
  DB02  F5            		PUSH	AF
  DB03  3E07          		LD	A,7
  DB05  2136DB        		LD	HL,SCRDMAD
  DB08  CD2CDB        		CALL	SETDMA
  DB0B  F1            		POP	AF
  DB0C  210038        		LD	HL,03800H
                      	
  DB0F                	SCRUP1:
  DB0F  B7            		OR	A
  DB10  284D          		JR	Z,SCRCL
  DB12  F5            		PUSH	AF
  DB13  CD3DDB        		CALL	UPSUB		;kanji
  DB16  ED5BBCEC      		LD	DE,(CRTCD+12)
  DB1A  16F7          		LD	D,0F7H
  DB1C  19            		ADD	HL,DE
  DB1D  D5            		PUSH	DE
  DB1E  CD3DDB        		CALL	UPSUB		;Text
  DB21  D1            		POP	DE
  DB22  19            		ADD	HL,DE
  DB23  CD3DDB        		CALL	UPSUB		;Color
  DB26  CBE4          		SET	4,H
  DB28  F1            		POP	AF
  DB29  3D            		DEC	A
  DB2A  18E3          		JR	SCRUP1
                      	
  DB2C                	SETDMA:
  DB2C  01871F        		LD	BC,01F87H
  DB2F                	SDMA:
  DB2F  04            		INC	B
  DB30  EDA3          		OUTI
  DB32  3D            		DEC	A
  DB33  20FA          		JR	NZ,SDMA
  DB35  C9            		RET
                      	
  DB36                	SCRDMAD:
  DB36  C3            		DB	0C3H		;WR6 リセット
  DB37  9A            		DB	09AH		;WR5 ストップ WAIT READY:HIGH
  DB38  65            		DB	065H		;WR0 ブロック長(LH)
  DB39  4F00          		DW	79
  DB3B  1C            		DB	01CH		;WR1 ポートAインクリメント I/O
  DB3C  18            		DB	018H		;WR0 ポートAアドレス(LH)
                      	
  DB3D                	UPSUB:
  DB3D  ED5BB1EC      		LD	DE,(CRTCD+1)
  DB41  1600          		LD	D,0
  DB43  3ECD          		LD	A,0CDH		;WR4 バースト ポートB開始アドレス(LH)
  DB45  ED79          		OUT	(C),A
  DB47  ED69          		OUT	(C),L		;SOURCE
  DB49  ED61          		OUT	(C),H
  DB4B  19            		ADD	HL,DE
  DB4C  3E1D          		LD	A,01DH		;WR0 ポートA開始アドレス(LH) ポートA→ポートB 転送
  DB4E  ED79          		OUT	(C),A
  DB50  ED69          		OUT	(C),L		;DEST
  DB52  ED61          		OUT	(C),H
  DB54                	GO_DMA:
  DB54  3ECF          		LD	A,0CFH
  DB56  ED79          		OUT	(C),A		;WR6 ロード
  DB58  3EB3          		LD	A,0B3H
  DB5A  ED79          		OUT	(C),A		;WR6 強制RDY
  DB5C  ED49          		OUT	(C),C		;WR6 イネーブル
  DB5E  C9            		RET
                      	
  DB5F                	SCRCL:
  DB5F  44            		LD	B,H
  DB60  4D            		LD	C,L
  DB61  215020        		LD	HL,02000H+80
  DB64  3A96EC        		LD	A,(_COLORF)
  DB67                	SCRCL1:
  DB67  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  DB69  CB98          		RES	3,B
  DB6B  ED61          		OUT	(C),H
  DB6D  CBA0          		RES	4,B
  DB6F  ED79          		OUT	(C),A
  DB71  CBD8          		SET	3,B
  DB73  CBE0          		SET	4,B
  DB75  03            		INC	BC
  DB76  2D            		DEC	L
  DB77  20EE          		JR	NZ,SCRCL1
  DB79  D1            		POP	DE
  DB7A  C1            		POP	BC
  DB7B  C9            		RET
                      	
  DB7C                	SCRN:
  DB7C  D5            		PUSH	DE
  DB7D  ED58          		IN	E,(C)		;Text
  DB7F  CBD8          		SET	3,B
  DB81  ED50          		IN	D,(C)		;Kanji
  DB83  2819          		JR	Z,SCRNE
  DB85  AF            		XOR	A
  DB86  C5            		PUSH	BC
  DB87  013730        		LD	BC,03037H	;VRMJIS
  DB8A  DF            		RST	018H
  DB8B  01522F        		LD	BC,02F52H	;JISSFT
  DB8E  DF            		RST	018H
  DB8F  C1            		POP	BC
  DB90  ED78          		IN	A,(C)
  DB92  CB98          		RES	3,B
  DB94  E640          		AND	040H
  DB96  2003          		JR	NZ,SCRN1
  DB98  7A            		LD	A,D
  DB99  D1            		POP	DE
  DB9A  C9            		RET
  DB9B                	SCRN1:
  DB9B  7B            		LD	A,E
  DB9C  D1            		POP	DE
  DB9D  C9            		RET
                      	
  DB9E                	SCRNE:
  DB9E  D1            		POP	DE
  DB9F  CB98          		RES	3,B
  DBA1                	SCRNX:
  DBA1  ED78          		IN	A,(C)
  DBA3  C9            		RET
                      	
  DBA4                	POS:
  DBA4  2A8EEC        		LD	HL,(_TXADR)
  DBA7  C5            		PUSH	BC
  DBA8  ED4BBCEC      		LD	BC,(CRTCD+12)
  DBAC  AF            		XOR	A
  DBAD                	POS1:
  DBAD  09            		ADD	HL,BC
  DBAE  3C            		INC	A
  DBAF  38FC          		JR	C,POS1
  DBB1  ED42          		SBC	HL,BC
  DBB3  3D            		DEC	A
  DBB4  67            		LD	H,A
  DBB5  C1            		POP	BC
  DBB6  A7            		AND	A
  DBB7  C9            		RET
                      	
  DBB8                	GETL:
  DBB8  CDD3EC        		CALL	_POS
  DBBB  E5            		PUSH	HL
  DBBC                	GETL1:
  DBBC  CDD3EC        		CALL	_POS
  DBBF  C1            		POP	BC
  DBC0  C5            		PUSH	BC
  DBC1  7D            		LD	A,L
  DBC2  91            		SUB	C
  DBC3  69            		LD	L,C
  DBC4  4F            		LD	C,A
  DBC5  DCD6EC        		CALL	C,_LOC
  DBC8                	GET1W:
  DBC8  CD62D7        		CALL	_SYS08
  DBCB  FE08          		CP	8
  DBCD  2007          		JR	NZ,GETL1X
  DBCF  0D            		DEC	C
  DBD0  CB79          		BIT	7,C
  DBD2  2002          		JR	NZ,GETL1X
  DBD4  3E02          		LD	A,2
  DBD6                	GETL1X:
  DBD6  FE1B          		CP	01BH
  DBD8  2016          		JR	NZ,GETL1V
  DBDA  CD62D7        		CALL	_SYS08
  DBDD  FE22          		CP	022H
  DBDF  2008          		JR	NZ,GETL1Y
  DBE1  2100FF        		LD	HL,KBUF
  DBE4  CD7AD3        		CALL	MSX
  DBE7  180E          		JR	GETL1Z
  DBE9                	GETL1Y:
  DBE9  F5            		PUSH	AF
  DBEA  1E1B          		LD	E,01BH
  DBEC  CDCDEC        		CALL	_PRINT
  DBEF  F1            		POP	AF
  DBF0                	GETL1V:
  DBF0  5F            		LD	E,A
  DBF1  CDEFD9        		CALL	CTRL01
  DBF4  CDCDEC        		CALL	_PRINT
  DBF7                	GETL1Z:
  DBF7  7B            		LD	A,E
  DBF8  FE0D          		CP	00DH
  DBFA  20C0          		JR	NZ,GETL1
                      	
  DBFC  2100FF        		LD	HL,KBUF
  DBFF  AF            		XOR	A
  DC00  ED4BB0EC      		LD	BC,(CRTCD)
  DC04                	GETL0:
  DC04  77            		LD	(HL),A
  DC05  23            		INC	HL
  DC06  10FC          		DJNZ	GETL0
                      	
  DC08  D1            		POP	DE
  DC09  CDD3EC        		CALL	_POS
  DC0C  6B            		LD	L,E
  DC0D  3AB1EC        		LD	A,(CRTCD+1)
  DC10  95            		SUB	L
  DC11  57            		LD	D,A
  DC12  CD02DA        		CALL	LOC1
  DC15  78            		LD	A,B
  DC16  F630          		OR	030H
  DC18  47            		LD	B,A
  DC19  5A            		LD	E,D
  DC1A  2100FF        		LD	HL,KBUF
  DC1D                	GETL2:
  DC1D  CDD0EC        		CALL	_SCRN
  DC20  03            		INC	BC
  DC21  77            		LD	(HL),A
  DC22  23            		INC	HL
  DC23  1D            		DEC	E
  DC24  20F7          		JR	NZ,GETL2
  DC26                	GETL3:
  DC26  2B            		DEC	HL
  DC27  7E            		LD	A,(HL)
  DC28  FE21          		CP	021H
  DC2A  D0            		RET	NC
  DC2B  3600          		LD	(HL),0
  DC2D  15            		DEC	D
  DC2E  20F6          		JR	NZ,GETL3
  DC30  C9            		RET
                      	
  DC31                	INKEY:
  DC31  FB            		EI
  DC32  E5            		PUSH	HL
  DC33  2A90EC        		LD	HL,(_KEYPS)
  DC36  7C            		LD	A,H
  DC37  AD            		XOR	L
  DC38  2809          		JR	Z,INKEY1
  DC3A  7C            		LD	A,H
  DC3B  3C            		INC	A
  DC3C  3291EC        		LD	(_KEYPS+1),A
  DC3F  6F            		LD	L,A
  DC40  26FE          		LD	H,KEYBF/256
  DC42  7E            		LD	A,(HL)
  DC43                	INKEY1:
  DC43  E1            		POP	HL
  DC44  B7            		OR	A
  DC45  C9            		RET
                      	
  10DC                	AT_RS	EQU	SCR1-AT_SCR1
                      	
                      	;LDFILE.ASM
                      	
                      	;	LSX-Dodgers FILE
                      	
  DC46                	FILEC:
  DC46  CD51DC        		CALL	FILE
  DC49                	FILEC2:
  DC49  3A15EB        		LD	A,(FDRV+1)
  DC4C  FE20          		CP	020H
  DC4E  C8            		RET	Z
  DC4F  1839          		JR	SETDIR1
                      	
  DC51                	FILE:
  DC51  AF            		XOR	A
  DC52  3214EB        		LD	(FDRV),A
  DC55  67            		LD	H,A
  DC56  6F            		LD	L,A
  DC57  2222EB        		LD	(FDRV+14),HL
  DC5A  CD28DD        		CALL	SPCUT
  DC5D  CD0DDD        		CALL	CCHK3
  DC60  2812          		JR	Z,DEVI1
  DC62  13            		INC	DE
  DC63  1A            		LD	A,(DE)
  DC64  1B            		DEC	DE
  DC65  FE3A          		CP	':'
  DC67  200B          		JR	NZ,DEVI1
  DC69  1A            		LD	A,(DE)		;DRIVE
  DC6A  CD6FDF        		CALL	CAP
  DC6D  D640          		SUB	'@'
  DC6F  13            		INC	DE
  DC70  13            		INC	DE
  DC71  3214EB        		LD	(FDRV),A
  DC74                	DEVI1:
  DC74  1A            		LD	A,(DE)
  DC75  D65C          		SUB	05CH		;\
  DC77  2009          		JR	NZ,NOROOT
  DC79  6F            		LD	L,A		;A=0でH=0のはずなのでHL=0
  DC7A  222EEB        		LD	(FDRV+26),HL
  DC7D  2C            		INC	L
  DC7E  2222EB        		LD	(FDRV+14),HL
  DC81  13            		INC	DE
  DC82                	NOROOT:
                      	
  DC82                	SETDIR:
  DC82  CDAEDC        		CALL	FILED
  DC85  1A            		LD	A,(DE)
  DC86  FE5C          		CP	05CH		;\
  DC88  C0            		RET	NZ
  DC89  13            		INC	DE
  DC8A                	SETDIR1:
  DC8A  3E10          		LD	A,010H		;Directory
  DC8C  3221EB        		LD	(FDRV+13),A
  DC8F  D5            		PUSH	DE
  DC90  1114EB        		LD	DE,FDRV
  DC93  2A1EEC        		LD	HL,(STABLE+2*00FH)
  DC96  CD0F00        		CALL	JP_HL
  DC99  D1            		POP	DE
  DC9A  B7            		OR	A
  DC9B  C0            		RET	NZ
                      	
  DC9C  3A21EB        		LD	A,(FDRV+13)
  DC9F  CB67          		BIT	4,A
  DCA1  C8            		RET	Z
                      	
  DCA2  CDF5DC        		CALL	FILEI
  DCA5  2A2EEB        		LD	HL,(FDRV+26)
  DCA8  23            		INC	HL
  DCA9  2222EB        		LD	(FDRV+14),HL
  DCAC  18D4          		JR	SETDIR
                      	
  DCAE                	FILED:
  DCAE  CDF5DC        		CALL	FILEI
  DCB1  2115EB        		LD	HL,FNAME
                      	
  DCB4  0608          		LD	B,8
  DCB6                	FILE2:
  DCB6  CD02DD        		CALL	CCHKF
  DCB9  C8            		RET	Z
  DCBA  FE2A          		CP	'*'
  DCBC  282E          		JR	Z,FILE9
  DCBE  FE2E          		CP	'.'
  DCC0  280C          		JR	Z,FILE4
  DCC2  77            		LD	(HL),A
  DCC3  23            		INC	HL
  DCC4  10F0          		DJNZ	FILE2
                      	
  DCC6                	FILE3:
  DCC6  CD02DD        		CALL	CCHKF
  DCC9  C8            		RET	Z
  DCCA  FE2E          		CP	'.'
  DCCC  20F8          		JR	NZ,FILE3
                      	
  DCCE                	FILE4:
  DCCE  211DEB        		LD	HL,FNAME+8
  DCD1  0603          		LD	B,3
                      	
  DCD3                	FILE4L:
  DCD3  CD02DD        		CALL	CCHKF
  DCD6  C8            		RET	Z
  DCD7  FE2E          		CP	'.'
  DCD9  2008          		JR	NZ,FILE12
  DCDB  3215EB        		LD	(FNAME),A	;Parent directory(..)
  DCDE  3216EB        		LD	(FNAME+1),A
  DCE1  3E20          		LD	A,020H
  DCE3                	FILE12:
  DCE3  FE2A          		CP	'*'
  DCE5  280A          		JR	Z,FILE10
  DCE7  77            		LD	(HL),A
  DCE8  23            		INC	HL
  DCE9  10E8          		DJNZ	FILE4L
  DCEB  C9            		RET
                      	
  DCEC                	FILE9:				;名前の*処理、名前の残りを?で埋める
  DCEC  CDF1DC        		CALL	FILE10
  DCEF  18D5          		JR	FILE3
                      	
  DCF1                	FILE10:
  DCF1  3E3F          		LD	A,'?'
  DCF3  1808          		JR	FILL_MEMORY
  DCF5                	FILEI:				;名前＋拡張子をスペースで初期化
  DCF5  3E20          		LD	A,020H
  DCF7  01000B        		LD	BC,11*256	;C=0にしておく
  DCFA  2115EB        		LD	HL,FNAME
  DCFD                	FILL_MEMORY:			;HLからBバイトAで埋める
  DCFD  77            		LD	(HL),A
  DCFE  23            		INC	HL
  DCFF  10FC          		DJNZ	FILL_MEMORY
  DD01  C9            		RET
                      	
  DD02                	CCHKF:
  DD02  1A            		LD	A,(DE)
  DD03  CD0ADD        		CALL	CCHK2
  DD06  C8            		RET	Z
  DD07  C38DE0        		JP	FKAN
                      	
  DD0A                	CCHK2:
  DD0A  0C            		INC	C
  DD0B  0D            		DEC	C
  DD0C  C0            		RET	NZ
  DD0D                	CCHK3:				;ZF=1 で使えない文字
  DD0D  FE2B          		CP	'+'
  DD0F  C8            		RET	Z
  DD10  FE2C          		CP	','
  DD12  C8            		RET	Z
  DD13  FE2F          		CP	'/'
  DD15  C8            		RET	Z
  DD16  FE3A          		CP	':'
  DD18  C8            		RET	Z
  DD19  FE3B          		CP	';'
  DD1B  C8            		RET	Z
  DD1C  FE3D          		CP	'='
  DD1E  C8            		RET	Z
  DD1F  FE5C          		CP	05CH	;\
  DD21  C8            		RET	Z
  DD22  FE20          		CP	020H
  DD24  D0            		RET	NC
  DD25  BF            		CP	A		;Z=1
  DD26  C9            		RET
                      	
  DD27                	SS1:
  DD27  13            		INC	DE
  DD28                	SPCUT:				;スペースをカット
  DD28  1A            		LD	A,(DE)
  DD29  FE20          		CP	020H
  DD2B  28FA          		JR	Z,SS1
  DD2D  C9            		RET
                      	
  DD2E                	SETDRVF:
  DD2E  1114EB        		LD	DE,FDRV
  DD31                	SETDRV0:
  DD31  CD3ADD        		CALL	SETDRV
  DD34  FDE1          		POP	IY
  DD36  C1            		POP	BC
  DD37  D1            		POP	DE
  DD38  E1            		POP	HL
  DD39  C9            		RET
                      	
  DD3A                	SETDRV:
  DD3A  E3            		EX	(SP),HL		;HL=RETRN ADDRESS
  DD3B  D5            		PUSH	DE		;PUSH HL/DE/BC/IY
  DD3C  C5            		PUSH	BC
  DD3D  1A            		LD	A,(DE)
  DD3E  D5            		PUSH	DE
  DD3F  FDE3          		EX	(SP),IY
                      	
  DD41  CD4DDD        		CALL	GETDRV
  DD44  3C            		INC	A
  DD45  FD7700        		LD	(IY+0),A	;(FCB)ドライブ番号
  DD48  3D            		DEC	A
  DD49  CDD9EC        		CALL	_CHGDRV
                      	
  DD4C  E9            		JP	(HL)
                      	
  DD4D                	GETDRV:
  DD4D  E67F          		AND	07FH
  DD4F  D601          		SUB	001H
  DD51  3003          		JR	NC,GETDRV1
  DD53  3A87EC        		LD	A,(_DVSW)	;Current Drive
  DD56                	GETDRV1:
  DD56  3288EC        		LD	(_DRV),A
  DD59  C9            		RET
                      	
  DD5A                	SOPENX:
  DD5A  CDDADE        		CALL	CHKDDX
  DD5D  3802          		JR	C,SOPENX1
  DD5F  C1            		POP	BC
  DD60  E9            		JP	(HL)
  DD61                	SOPENX1:
  DD61  1139EB        		LD	DE,SFILE
  DD64  1A            		LD	A,(DE)
  DD65  FDBE00        		CP	(IY+0)		;(FCB)ドライブ番号
  DD68  2024          		JR	NZ,SOPEN
  DD6A  13            		INC	DE
  DD6B  FDE5          		PUSH	IY
  DD6D  E1            		POP	HL
  DD6E  23            		INC	HL
  DD6F  CD07DF        		CALL	CPFILE
  DD72  201A          		JR	NZ,SOPEN
                      	
  DD74  2AF4EB        		LD	HL,(SCDIR)
  DD77  FD750E        		LD	(IY+14),L	;(FCB)アクセスするディレクトリのクラスタ番号+1
  DD7A  FD740F        		LD	(IY+15),H
                      	
  DD7D  2AF8EB        		LD	HL,(SFNDF)	;Direcroty location and Flags
  DD80  229FEC        		LD	(_FILEN),HL
                      	
  DD83  ED5BF6EB      		LD	DE,(SFBPS)
  DD87  2139EB        		LD	HL,SFILE
  DD8A  36FF          		LD	(HL),0FFH
  DD8C  23            		INC	HL
  DD8D  C9            		RET
  DD8E                	SOPEN:
  DD8E  21A2DE        		LD	HL,FILESE
  DD91                	SOPENC:
  DD91  22CADD        		LD	(OPENPAT+1),HL
                      	
  DD94  CDE2EC        		CALL	_RDFATX		;Detect Media
  DD97  3856          		JR	C,RDDERR
                      	
  DD99  AF            		XOR	A
  DD9A  329FEC        		LD	(_FILEN),A
  DD9D  CDB4DF        		CALL	LDDIRX1		;A=0で呼び出す
  DDA0  2818          		JR	Z,SDIRX1
                      	
  DDA2  CD93DE        		CALL	READ_DIR	;Sub Directory
  DDA5  3808          		JR	C,SDIRX0
  DDA7  2A7EEC        		LD	HL,(_DTBUF)
  DDAA  7E            		LD	A,(HL)
  DDAB  FE2E          		CP	'.'
  DDAD  280F          		JR	Z,SOPEN1
  DDAF                	SDIRX0:
  DDAF  AF            		XOR	A
  DDB0  32A0EC        		LD	(_DIRF),A
  DDB3  FD360E01      		LD	(IY+14),1	;(FCB)レコードサイズ
  DDB7  FD770F        		LD	(IY+15),A
  DDBA                	SDIRX1:
  DDBA  ED5BFCEB      		LD	DE,(_DIRPS)	;Root Directory
  DDBE                	SOPEN1:
  DDBE  0E20          	SDECPAT:LD	C,32		;自己書き換え 1セクタ辺りのディレクトリエントリ数  1024=32 / 512=16
  DDC0                	SOPEN1X:
  DDC0  CD93DE        		CALL	READ_DIR	;FILE SEARCH
  DDC3  382A          		JR	C,RDDERR
  DDC5  2A7EEC        		LD	HL,(_DTBUF)
  DDC8                	SOPEN2:
  DDC8  D5            		PUSH	DE
  DDC9  CDA2DE        	OPENPAT:CALL	FILESE		;(Self-rewriting)
  DDCC  D1            		POP	DE
  DDCD  386E          		JR	C,SOPENE
  DDCF  281B          		JR	Z,SCF_FF_RET
  DDD1                	SOPEN3:
  DDD1  3AA0EC        		LD	A,(_DIRF)	;ディレクトリか判別
  DDD4  B7            		OR	A
  DDD5  200C          		JR	NZ,SOPEN5
  DDD7  13            		INC	DE		;ルートディレクトリ
  DDD8  E5            		PUSH	HL
  DDD9  210C00        	MD_PAT:	LD	HL,12		;(Self-rewriting)MAXDIR
  DDDC  ED52          		SBC	HL,DE		;CF=0 なので SUB HL,DE
  DDDE  E1            		POP	HL
  DDDF  20DD          		JR	NZ,SOPEN1
  DDE1  1807          		JR	SOPEN6
  DDE3                	SOPEN5:
  DDE3  CD76E6        		CALL	GNCLX		;END DIR
  DDE6  D8            		RET	C
  DDE7  CD67DF        		CALL	ENDCL
  DDEA                	SOPEN6:
  DDEA  38D2          		JR	C,SOPEN1
  DDEC                	SCF_FF_RET:
  DDEC  37            		SCF			;CF=1
  DDED  9F            		SBC	A,A		;A=0FFH
  DDEE  C9            		RET
                      	
  DDEF                	RDDERR:
  DDEF  BF            		CP	A		;READ ERR CF=1 ZF=1
  DDF0  37            		SCF
  DDF1  C9            		RET
                      	
  DDF2                	NOPEN:
  DDF2  21A2DE        		LD	HL,FILESE
  DDF5  22CADD        		LD	(OPENPAT+1),HL
  DDF8  FD2A98EC      		LD	IY,(_FCB)
  DDFC  CDA0E0        		CALL	CHKWILDX
  DDFF  30EB          		JR	NC,SCF_FF_RET
  DE01  FD7E00        		LD	A,(IY+0)	;(FCB)ドライブ番号
  DE04  3D            		DEC	A
  DE05  3288EC        		LD	(_DRV),A
  DE08  CDD9EC        		CALL	_CHGDRV
  DE0B  D8            		RET	C
  DE0C  2AF8EB        		LD	HL,(SFNDF)	;Direcroty location and Flags
  DE0F  229FEC        		LD	(_FILEN),HL
                      	
  DE12  CDAFDF        		CALL	LDDIRX
  DE15  ED5B9AEC      		LD	DE,(_FBPS)
  DE19  CD93DE        		CALL	READ_DIR
  DE1C  38D1          		JR	C,RDDERR
  DE1E  3A9EEC        		LD	A,(_FBCNT)
  DE21  3D            		DEC	A
  DE22  28AD          		JR	Z,SOPEN3
  DE24                	NOPEN2:
  DE24  2A9CEC        		LD	HL,(_FBAD)
  DE27  012000        		LD	BC,020H
  DE2A  09            		ADD	HL,BC
  DE2B  4F            		LD	C,A
  DE2C  189A          		JR	SOPEN2
                      	
  DE2E                	SOPENE2:
  DE2E  229CEC        		LD	(_FBAD),HL
  DE31  79            		LD	A,C
  DE32  329EEC        		LD	(_FBCNT),A
  DE35  ED539AEC      		LD	(_FBPS),DE
  DE39  FD2298EC      		LD	(_FCB),IY
  DE3D                	SOPENE:
  DE3D  AF            		XOR	A
  DE3E  C9            		RET
                      	
  DE3F                	COPEN:
  DE3F  FD360D20      		LD	(IY+13),020H	;(FCB)属性(アトリビュート)
                      	
  DE43  21BFDE        		LD	HL,NEXTSE
  DE46  CD91DD        		CALL	SOPENC
  DE49  D0            		RET	NC
  DE4A  C8            		RET	Z
  DE4B  3AA0EC        		LD	A,(_DIRF)	;ディレクトリか判別
  DE4E  B7            		OR	A
  DE4F  37            		SCF
  DE50  C8            		RET	Z		;ルートディレクトリ
  DE51  0601          		LD	B,1
  DE53  CDFCE0        		CALL	WRDF
  DE56  D8            		RET	C
  DE57  ED5BFEEB      		LD	DE,(_CLPS)
  DE5B  D5            		PUSH	DE
  DE5C  CD30DF        		CALL	DCPAT
  DE5F  CD0DE5        		CALL	DRDNX
  DE62  2A7EEC        		LD	HL,(_DTBUF)	;ディレクトリエントリを0クリア
  DE65  5D            		LD	E,L
  DE66  54            		LD	D,H
  DE67  13            		INC	DE		;DE,DTBUF+1
  DE68  01FF03        	SECSZM1:LD	BC,003FFH	;自己書き換え セクタサイズ-1(0x3FF:1023 or 0x1FF:511 or 0xFF:255)
  DE6B  AF            		XOR	A		;データバッファをセクタサイズ分ゼロクリア
  DE6C  77            		LD	(HL),A
  DE6D  EDB0          		LDIR
  DE6F  D1            		POP	DE		;DE=(_CLPS)
  DE70  D5            		PUSH	DE
  DE71  3A4EDF        		LD	A,(SPCPAT+1)	;1クラスタの論理セクタ数
  DE74  3D            		DEC	A
  DE75  2817          		JR	Z,COPENE
  DE77  3E01          		LD	A,1		;1セクタ辺りのセクタ数が2以上の場合
  DE79  326EE6        		LD	(_SECPS+1),A
  DE7C                	COPEN1:
  DE7C  D5            		PUSH	DE		;データバッファに入らないセクタもゼロクリア
  DE7D  C5            		PUSH	BC
  DE7E  2A7EEC        		LD	HL,(_DTBUF)
  DE81  CD4ADF        		CALL	CLUSTX
  DE84  CDDFE7        		CALL	DWT24
  DE87  C1            		POP	BC
  DE88  D1            		POP	DE
  DE89  CD6DE6        		CALL	NEXTX
  DE8C  20EE          		JR	NZ,COPEN1
  DE8E                	COPENE:
  DE8E  2A7EEC        		LD	HL,(_DTBUF)
  DE91  D1            		POP	DE
  DE92  C9            		RET
                      	
  DE93                	READ_DIR:
  DE93  ED53FEEB      		LD	(_CLPS),DE
  DE97  C5            		PUSH	BC
  DE98  D5            		PUSH	DE
  DE99  CD30DF        		CALL	DCPAT
  DE9C  CDEDE4        		CALL	DRDX
  DE9F  D1            		POP	DE
  DEA0  C1            		POP	BC
  DEA1  C9            		RET
                      	
  DEA2                	FILESE:
  DEA2  7E            		LD	A,(HL)
  DEA3  B7            		OR	A
  DEA4  C8            		RET	Z		;END:ZF=1 CF=0
  DEA5  FEE5          		CP	0E5H
  DEA7  280E          		JR	Z,FILESE1
  DEA9  FDE5          		PUSH	IY
  DEAB  D1            		POP	DE
  DEAC  13            		INC	DE
  DEAD  E5            		PUSH	HL
  DEAE  CD07DF        		CALL	CPFILE
  DEB1  CC28DF        		CALL	Z,CPFILE2
  DEB4  E1            		POP	HL
  DEB5  37            		SCF
  DEB6  C8            		RET	Z		;!!!:(ZF=1) CF=1
  DEB7                	FILESE1:
  DEB7  CDCEDE        		CALL	FNEXT
  DEBA  20E6          		JR	NZ,FILESE
  DEBC                	ZF0_CF0_AFF_RET:
  DEBC  F6FF          		OR	0FFH		;ZF=0 CF=0
  DEBE  C9            		RET
                      	
  DEBF                	NEXTSE:
  DEBF  7E            		LD	A,(HL)
  DEC0  B7            		OR	A
  DEC1  37            		SCF
  DEC2  C8            		RET	Z		;!!!:ZF=1 CF=1
  DEC3  FEE5          		CP	0E5H
  DEC5  37            		SCF
  DEC6  C8            		RET	Z		;!!!:(ZF=1) CF=1
  DEC7  CDCEDE        		CALL	FNEXT
  DECA  20F3          		JR	NZ,NEXTSE
  DECC  18EE          		JR	ZF0_CF0_AFF_RET
                      	
  DECE                	FNEXT:
  DECE  E5            		PUSH	HL
  DECF  219FEC        		LD	HL,_FILEN
  DED2  34            		INC	(HL)
  DED3  E1            		POP	HL
  DED4  112000        		LD	DE,020H
  DED7  19            		ADD	HL,DE
  DED8  0D            		DEC	C
  DED9  C9            		RET
                      	
  DEDA                	CHKDDX:
  DEDA  CDA0E0        		CALL	CHKWILDX
  DEDD  D8            		RET	C
  DEDE  FDE5          		PUSH	IY
  DEE0  D1            		POP	DE
  DEE1  13            		INC	DE
  DEE2  2162EC        		LD	HL,DDTB
  DEE5  0604          		LD	B,DDS
  DEE7                	CPNAME:
  DEE7  C5            		PUSH	BC
  DEE8  D5            		PUSH	DE
  DEE9  E5            		PUSH	HL
  DEEA  CD01DF        		CALL	CPFILE4
  DEED  E1            		POP	HL
  DEEE  23            		INC	HL
  DEEF  23            		INC	HL
  DEF0  23            		INC	HL
  DEF1  23            		INC	HL
  DEF2  D1            		POP	DE
  DEF3  C1            		POP	BC
  DEF4  2005          		JR	NZ,CPNAME1
  DEF6  7E            		LD	A,(HL)
  DEF7  23            		INC	HL
  DEF8  66            		LD	H,(HL)
  DEF9  6F            		LD	L,A
  DEFA  C9            		RET
  DEFB                	CPNAME1:
  DEFB  23            		INC	HL
  DEFC  23            		INC	HL
  DEFD  10E8          		DJNZ	CPNAME
  DEFF  37            		SCF
  DF00  C9            		RET
                      	
  DF01                	CPFILE4:
  DF01  C5            		PUSH	BC
  DF02  010004        		LD	BC,00400H
  DF05  1804          		JR	CPSTR1
  DF07                	CPFILE:
  DF07  C5            		PUSH	BC
  DF08  01000B        		LD	BC,00B00H
  DF0B                	CPSTR1:
  DF0B  1A            		LD	A,(DE)
  DF0C  FE3F          		CP	'?'		;Wild card
  DF0E  2812          		JR	Z,CPSTR2
  DF10  7E            		LD	A,(HL)
  DF11  CD86E0        		CALL	FKANC
  DF14  E5            		PUSH	HL
  DF15  67            		LD	H,A
  DF16  1A            		LD	A,(DE)
  DF17  CB01          		RLC	C
  DF19  CD86E0        		CALL	FKANC
  DF1C  CB09          		RRC	C
  DF1E  BC            		CP	H		;CP (HL),(DE)
  DF1F  E1            		POP	HL
  DF20  2004          		JR	NZ,CPSTR3
  DF22                	CPSTR2:
  DF22  13            		INC	DE
  DF23  23            		INC	HL
  DF24  10E5          		DJNZ	CPSTR1
  DF26                	CPSTR3:
  DF26  C1            		POP	BC
  DF27  C9            		RET
                      	
  DF28                	CPFILE2:
  DF28  FD7E0D        		LD	A,(IY+13)	;(FCB)属性(アトリビュート)
  DF2B  F6E1          		OR	0E1H
  DF2D  2F            		CPL
  DF2E  A6            		AND	(HL)
  DF2F  C9            		RET
                      	
  DF30                	DCPAT:
  DF30  0E00          		LD	C,0
  DF32  2A7EEC        		LD	HL,(_DTBUF)
  DF35  3AA0EC        		LD	A,(_DIRF)	;ディレクトリか判別
  DF38  B7            		OR	A
  DF39  C8            		RET	Z		;ルートディレクトリの場合はCレジスタを0にしておく(CDEがセクタ番号)
  DF3A  3A4EDF        		LD	A,(SPCPAT+1)
  DF3D  4F            		LD	C,A
  DF3E  3A6EE6        		LD	A,(_SECPS+1)
  DF41  B9            		CP	C
  DF42  3001          		JR	NC,DC1
  DF44  AF            		XOR	A
  DF45                	DC1:
  DF45  F680          		OR	080H
  DF47  32A0EC        		LD	(_DIRF),A	;bit0-6:セクタインデックス
  DF4A                	CLUSTX:
  DF4A  E5            		PUSH	HL
  DF4B  EB            		EX	DE,HL
  DF4C  AF            		XOR	A
  DF4D  0E01          	SPCPAT:	LD	C,1		;自己書き換え（1クラスタの論理セクタ数）
  DF4F                	L_CLDBL:
  DF4F  CB19          		RR	C		;->CF
  DF51  3804          		JR	C,E_CLDBL
  DF53  29            		ADD	HL,HL		;*2
  DF54  8F            		ADC	A,A
  DF55  18F8          		JR	L_CLDBL
  DF57                	E_CLDBL
  DF57  4F            		LD	C,A
  DF58  3A6EE6        		LD	A,(_SECPS+1)
  DF5B  B5            		OR	L
  DF5C  6F            		LD	L,A
  DF5D  110800        	CLSPAT:	LD	DE,8	;+8 (2D)  !ADDCL (Self-rewriting)
  DF60  AF            		XOR	A
  DF61  19            		ADD	HL,DE	;データ格納領域の先頭論理セクタ番号
  DF62  89            		ADC	A,C
  DF63  4F            		LD	C,A
  DF64  EB            		EX	DE,HL
  DF65  E1            		POP	HL
  DF66  C9            		RET
                      	
  DF67                	ENDCL:
  DF67  7A            		LD	A,D	;END CLUSTER
  DF68  FE01          	CLPAT1:	CP	1	;164=356	(Self-rewriting)
  DF6A  C0            		RET	NZ
  DF6B  7B            		LD	A,E
  DF6C  FE64          	CLPAT2:	CP	064H	;		(Self-rewriting)
  DF6E  C9            		RET
                      	
  DF6F                	CAP:
  DF6F  FE61          		CP	'a'
  DF71  D8            		RET	C
  DF72  FE7B          		CP	'z'+1
  DF74  D0            		RET	NC
  DF75  D620          		SUB	020H
  DF77  C9            		RET
  DF78                	CAP2:
  DF78  CD6FDF        		CALL	CAP
  DF7B                	CAP3:
  DF7B  CD84DF        		CALL	CAP4
  DF7E  FE21          		CP	021H
  DF80  D0            		RET	NC
  DF81  3EA0          		LD	A,0A0H
  DF83  C9            		RET
  DF84                	CAP4:
  DF84  FE05          		CP	5
  DF86  C0            		RET	NZ
  DF87  3EE5          		LD	A,0E5H
  DF89  C9            		RET
                      	
  DF8A                	CHDIR:
  DF8A  CD33E9        		CALL	GETDPBD
  DF8D  381D          		JR	C,CHDIR2
  DF8F  DD751A        		LD	(IX+01AH),L		;_SDIR_
  DF92  DD741B        		LD	(IX+01BH),H		;_SDIR_+1
  DF95  1815          		JR	CHDIR2		;POP_IX_RET
                      	
  DF97                	LDDIR:
  DF97  CD33E9        		CALL	GETDPBD
  DF9A  DD5E1A        		LD	E,(IX+01AH)		;_SDIR_
  DF9D  DD561B        		LD	D,(IX+01BH)		;_SDIR_+1
  DFA0  13            		INC	DE
  DFA1  FD730E        		LD	(IY+14),E	;(FCB)アクセスするディレクトリのクラスタ番号+1
  DFA4  FD720F        		LD	(IY+15),D
  DFA7  1B            		DEC	DE
  DFA8  AF            		XOR	A
  DFA9  32A0EC        		LD	(_DIRF),A
  DFAC                	CHDIR2:
  DFAC  DDE1          		POP	IX
  DFAE  C9            		RET
                      	
  DFAF                	LDDIRX:
  DFAF  3AA0EC        		LD	A,(_DIRF)	;(FCB)アクセスするディレクトリのセクタインデックス
  DFB2  E67F          		AND	07FH
  DFB4                	LDDIRX1:
  DFB4  326EE6        		LD	(_SECPS+1),A
  DFB7  FD5E0E        		LD	E,(IY+14)	;(FCB)アクセスするディレクトリのクラスタ番号+1
  DFBA  FD560F        		LD	D,(IY+15)
  DFBD  1B            		DEC	DE
  DFBE  CD67DF        		CALL	ENDCL
  DFC1  D497DF        		CALL	NC,LDDIR
  DFC4                	LDDIRS:
  DFC4  7A            		LD	A,D
  DFC5  B3            		OR	E
  DFC6  32A0EC        		LD	(_DIRF),A	;ディレクトリか判別
  DFC9  C9            		RET
                      	
  DFCA                	KILL:
  DFCA  CDA0E0        		CALL	CHKWILDX
  DFCD  383A          		JR	C,KILLW
  DFCF  CDDADE        		CALL	CHKDDX
  DFD2  3F            		CCF
  DFD3  D461DD        		CALL	NC,SOPENX1
  DFD6                	KILLS:
  DFD6  3E1F          		LD	A,01FH
  DFD8  D41CE0        		CALL	NC,CHKATT
  DFDB  D8            		RET	C
  DFDC                	KILLSX:
  DFDC  36E5          		LD	(HL),0E5H	;DIR
  DFDE  CD7AE0        		CALL	WTDB
  DFE1  111A00        		LD	DE,01AH
  DFE4  19            		ADD	HL,DE
  DFE5  5E            		LD	E,(HL)
  DFE6  23            		INC	HL
  DFE7  56            		LD	D,(HL)
  DFE8  1804          		JR	KILLS2
  DFEA                	KILLS1:
  DFEA  ED5BFEEB      		LD	DE,(_CLPS)	;FAT
  DFEE                	KILLS2:
  DFEE  CD67DF        		CALL	ENDCL
  DFF1  D0            		RET	NC		;CF=0
  DFF2  21FEFF        		LD	HL,0-2
  DFF5  19            		ADD	HL,DE
  DFF6  D0            		RET	NC		;DE= 0 or 1
  DFF7  D5            		PUSH	DE
  DFF8  CDF7EC        		CALL	_GNCL
  DFFB  ED53FEEB      		LD	(_CLPS),DE
  DFFF  D1            		POP	DE
  E000  210000        		LD	HL,0
  E003  D4FAEC        		CALL	NC,_SNCL
  E006  30E2          		JR	NC,KILLS1
  E008  C9            		RET
                      	
  E009                	KILLW:
  E009  CD8EDD        		CALL	SOPEN
  E00C                	KILLW1:
  E00C  380B          		JR	C,KILLW2
  E00E  CD2EDE        		CALL	SOPENE2
  E011  CDD6DF        		CALL	KILLS
  E014  CDF2DD        		CALL	NOPEN
  E017  18F3          		JR	KILLW1
  E019                	KILLW2:
  E019  C8            		RET	Z
  E01A  3F            		CCF
  E01B  C9            		RET
                      	
  E01C                	CHKATT:
  E01C  E5            		PUSH	HL
  E01D  110B00        		LD	DE,00BH
  E020  19            		ADD	HL,DE
  E021  A6            		AND	(HL)
  E022  E1            		POP	HL
  E023  C8            		RET	Z
  E024  37            		SCF
  E025  C9            		RET
                      	
  E026                	NAME:
  E026  CDA0E0        		CALL	CHKWILDX
  E029  D8            		RET	C
  E02A  110400        		LD	DE,4
  E02D  19            		ADD	HL,DE
  E02E  2246E0        		LD	(NAMEP+2),HL
  E031  23            		INC	HL
  E032  CDA4E0        		CALL	CHKWILD
  E035  D8            		RET	C
                      	
  E036  CD61DD        		CALL	SOPENX1
  E039  3E0F          		LD	A,00FH
  E03B  D41CE0        		CALL	NC,CHKATT
  E03E  D8            		RET	C
                      	
  E03F  FD7E00        		LD	A,(IY+0)
  E042  FDE5          		PUSH	IY
  E044  FD210000      	NAMEP:	LD	IY,0
  E048  FD7700        		LD	(IY+0),A
  E04B  CD61DD        		CALL	SOPENX1
  E04E  FDE3          		EX	(SP),IY
  E050  3F            		CCF
  E051  D48EDD        		CALL	NC,SOPEN
  E054  EB            		EX	DE,HL
  E055  E1            		POP	HL
  E056  D8            		RET	C
                      	
  E057                	SETNAME:
  E057  01000B        		LD	BC,11*256
  E05A  23            		INC	HL
  E05B  7E            		LD	A,(HL)
  E05C  FEE5          		CP	0E5H
  E05E  2004          		JR	NZ,SNAME1
  E060  3E05          		LD	A,5
  E062  180E          		JR	SNAME3
  E064                	SNAME1:
  E064  7E            		LD	A,(HL)
  E065  0C            		INC	C
  E066  0D            		DEC	C
  E067  2009          		JR	NZ,SNAME3
  E069  CD6FDF        		CALL	CAP
  E06C  FEA0          		CP	0A0H
  E06E  2002          		JR	NZ,SNAME3
  E070  3E20          		LD	A,020H
  E072                	SNAME3:
  E072  12            		LD	(DE),A
  E073  7E            		LD	A,(HL)
  E074  23            		INC	HL
  E075  CD8DE0        		CALL	FKAN
  E078  10EA          		DJNZ	SNAME1
  E07A                	WTDB:
  E07A  3EFF          		LD	A,0FFH
  E07C  3239EB        		LD	(SFILE),A
  E07F                	SWTDBF:
  E07F  3E01          		LD	A,1
  E081  32A4EC        		LD	(_WTDBF),A
  E084  AF            		XOR	A
  E085  C9            		RET
                      	
  E086                	FKANC:
  E086  CB41          		BIT	0,C
  E088  CC78DF        		CALL	Z,CAP2
  E08B  1801          		JR	FKANX
  E08D                	FKAN:			;漢字チェック
  E08D  13            		INC	DE
  E08E                	FKANX:
  E08E  CB41          		BIT	0,C
  E090  CB81          		RES	0,C
  E092  C0            		RET	NZ
  E093  FE80          		CP	080H
  E095  D8            		RET	C
  E096  FEA0          		CP	0A0H
  E098  3803          		JR	C,FKAN1
  E09A  FEE0          		CP	0E0H
  E09C  D8            		RET	C
  E09D                	FKAN1:
  E09D  0C            		INC	C
  E09E  A7            		AND	A
  E09F  C9            		RET
                      	
  E0A0                	CHKWILDX:
  E0A0  FDE5          		PUSH	IY
  E0A2  E1            		POP	HL
  E0A3  23            		INC	HL
  E0A4                	CHKWILD:
  E0A4  060B          		LD	B,11
  E0A6  3E3F          		LD	A,'?'
  E0A8                	CHKWIL1:
  E0A8  BE            		CP	(HL)
  E0A9  23            		INC	HL
  E0AA  37            		SCF
  E0AB  C8            		RET	Z
  E0AC  10FA          		DJNZ	CHKWIL1
  E0AE  AF            		XOR	A
  E0AF  C9            		RET
                      	
  E0B0                	SDIRENT:		;IY=FCB HL=DIR
  E0B0  D5            		PUSH	DE
  E0B1  E5            		PUSH	HL
  E0B2  FDE5          		PUSH	IY
  E0B4  D1            		POP	DE
  E0B5  EB            		EX	DE,HL
  E0B6  CD57E0        		CALL	SETNAME
                      	;				Attribute
  E0B9  FD7E0D        		LD	A,(IY+13)	;(FCB)属性(アトリビュート)
  E0BC  12            		LD	(DE),A
  E0BD  13            		INC	DE
                      	;				Reserved
  E0BE  AF            		XOR	A
  E0BF  060A          		LD	B,10
  E0C1                	SDE1:
  E0C1  12            		LD	(DE),A
  E0C2  13            		INC	DE
  E0C3  10FC          		DJNZ	SDE1
                      						;(FCB)更新時刻
  E0C5  21EAEB        		LD	HL,SDDATA		;(FCB)更新年月日
  E0C8  060A          		LD	B,SDDATAE-SDDATA	;(FCB)ファイルの先頭クラスタ
  E0CA                	SDLOOP:					;(FCB)ファイルのサイズ(バイト単位)
  E0CA  7E            		LD	A,(HL)
  E0CB  23            		INC	HL
  E0CC  32D1E0        		LD	(SDPAT+2),A
  E0CF  FD7E00        	SDPAT:	LD	A,(IY+0)	;LD A,(IY+A)
  E0D2  12            		LD	(DE),A
  E0D3  13            		INC	DE
  E0D4  10F4          		DJNZ	SDLOOP
                      	
  E0D6  AF            		XOR	A
  E0D7  E1            		POP	HL
  E0D8  D1            		POP	DE
  E0D9  C9            		RET
                      	
  E0DA                	WOPEN:
  E0DA  FD7E0D        		LD	A,(IY+13)	;(FCB)属性(アトリビュート)
  E0DD  E61F          		AND	01FH
  E0DF  37            		SCF
  E0E0  C0            		RET	NZ
  E0E1  FD361CFE      		LD	(IY+28),0FEH	;(FCB)オープンモード
  E0E5                	TOPEN2:
  E0E5  AF            		XOR	A
  E0E6                	TOPEN:				;Initializes the time stamp
  E0E6  FD3617FF      		LD	(IY+23),0FFH	;(FCB)更新時刻
  E0EA  C9            		RET
                      	
  E0EB                	WRDFX:
  E0EB  3A4EDF        		LD	A,(SPCPAT+1)	;1クラスタの論理セクタ
  E0EE                	L_WRFX:
  E0EE  1F            		RRA		;->CF
  E0EF  3804          		JR	C,E_WRFX
  E0F1  CB39          		SRL	C	;C=C/2
  E0F3  18F9          		JR	L_WRFX
  E0F5                	E_WRFX:
  E0F5  41            		LD	B,C
  E0F6  04            		INC	B
  E0F7  3E37          		LD	A,037H		;SCF
  E0F9  320AE5        		LD	(DRDN1),A
                      	
  E0FC                	WRDF:				;Bクラスタ分FATを確保する
  E0FC  110200        		LD	DE,2
  E0FF  AF            		XOR	A
  E100  326EE6        		LD	(_SECPS+1),A
  E103                	WRDF1:
  E103  C5            		PUSH	BC
  E104  D5            		PUSH	DE
  E105  CDF7EC        		CALL	_GNCL
  E108  381C          		JR	C,WRDF3
  E10A  7A            		LD	A,D		;空いているかチェック
  E10B  B3            		OR	E
  E10C  2027          		JR	NZ,WRDF4
  E10E  E1            		POP	HL		;HL=空いているクラスタ
  E10F  E5            		PUSH	HL
  E110  ED5BFEEB      		LD	DE,(_CLPS)	;DE=元の(_CLPS)
  E114  22FEEB        		LD	(_CLPS),HL
  E117  7A            		LD	A,D		;元の(_CLPS)が 0 か?
  E118  B3            		OR	E
  E119  2008          		JR	NZ,WRDF2
  E11B  FD751A        		LD	(IY+26),L	;(FCB)ファイルの先頭クラスタ
  E11E  FD741B        		LD	(IY+27),H	;元が空の場合はFCBにクラスタをセットする
  E121  1803          		JR	WRDF3
  E123                	WRDF2:
  E123  CDFAEC        		CALL	_SNCL
  E126                	WRDF3:
  E126  D1            		POP	DE
  E127  C1            		POP	BC
  E128  D8            		RET	C
  E129  100C          		DJNZ	WRDF5		;ここでループカウンタチェック
  E12B  ED5BFEEB      		LD	DE,(_CLPS)
  E12F  21FFFF        		LD	HL,0FFFFH	;FATエントリ終了(EOCマーク)
  E132  C3FAEC        		JP	_SNCL
                      	
  E135                	WRDF4:				;DEクラスタが空じゃないので次に移動する
  E135  D1            		POP	DE
  E136  C1            		POP	BC
  E137                	WRDF5:
  E137  13            		INC	DE
  E138  CD67DF        		CALL	ENDCL
  E13B  38C6          		JR	C,WRDF1
  E13D  37            		SCF
  E13E  C9            		RET
                      	
  E13F                	RWXR:
  E13F  3A89E4        		LD	A,(SECSZ+2)	;1024=4 / 512=2 / 256=1
  E142                	L_RWX:
  E142  1F            		RRA		;->CF
  E143  3806          		JR	C,E_RWX
  E145  CB38          		SRL	B	;BC=BC/2
  E147  CB19          		RR	C	;
  E149  18F7          		JR	L_RWX
  E14B                	E_RWX:
  E14B  FD5E1A        		LD	E,(IY+26)	;(FCB)ファイルの先頭クラスタ
  E14E  FD561B        		LD	D,(IY+27)
  E151  AF            		XOR	A
  E152  326EE6        		LD	(_SECPS+1),A
  E155                	RWX1:
  E155  ED53FEEB      		LD	(_CLPS),DE
  E159  7A            		LD	A,D
  E15A  B3            		OR	E
  E15B  280D          		JR	Z,SCF_RET	;RET DE==0 => CF=1
                      	
  E15D  78            		LD	A,B
  E15E  B1            		OR	C
  E15F  C8            		RET	Z		;RET BC==0 => CF=0
                      	
  E160  CD76E6        		CALL	GNCLX
  E163  D8            		RET	C
  E164  0B            		DEC	BC
                      	
  E165  CD67DF        		CALL	ENDCL
  E168  38EB          		JR	C,RWX1
  E16A                	SCF_RET:
  E16A  37            		SCF
  E16B  C9            		RET
                      	
  E16C                	DSKF:
  E16C  110000        	MAXCLP:	LD	DE,0
  E16F  2AACEC        		LD	HL,(_FAKEFREE)
  E172  7C            		LD	A,H
  E173  B5            		OR	L
  E174  2803          		JR	Z,DSKF1
  E176  110100        		LD	DE,1
  E179                	DSKF1:
  E179  D5            		PUSH	DE
  E17A  CDF7EC        		CALL	_GNCL
  E17D  380C          		JR	C,POPSCF
  E17F  7A            		LD	A,D
  E180  B3            		OR	E
  E181  2001          		JR	NZ,DSKF2
  E183  23            		INC	HL
  E184                	DSKF2:
  E184  D1            		POP	DE
  E185  1B            		DEC	DE
  E186  7A            		LD	A,D
  E187  B3            		OR	E
  E188  20EF          		JR	NZ,DSKF1
  E18A  C9            		RET
                      	
  E18B                	POPSCF:
  E18B  F1            		POP	AF
  E18C  37            		SCF
  E18D  C9            		RET
                      	
  E18E                	SETTMS:
  E18E  FD7E17        		LD	A,(IY+23)	;(FCB)ファイルを最後に変更した時刻
  E191  3C            		INC	A
  E192  C0            		RET	NZ		;ファイルが更新されていない
  E193                	SETTMSX:			;FCBに日付時刻をセットする
  E193  CD11D8        		CALL	_SYS2C		;(BDOS)時刻の獲得
                      					;H←時  L←分  D←秒
  E196  CB25          		SLA	L		;L=L/2
  E198  CB25          		SLA	L		;L=L/2
  E19A  29            		ADD	HL,HL		;*2
  E19B  29            		ADD	HL,HL		;*4
  E19C  29            		ADD	HL,HL		;*8
  E19D  7A            		LD	A,D
  E19E  0F            		RRCA			;bit.0->7->->->0->C
  E19F  E61F          		AND	01FH
  E1A1  B5            		OR	L
  E1A2  FD7716        		LD	(IY+22),A	;(FCB)ファイルを最後に変更した時刻
  E1A5  FD7417        		LD	(IY+23),H
                      	
  E1A8  CDDDD7        		CALL	_SYS2A		;(BDOS)日付の獲得
                      					;HL←年  D←月  E←日
  E1AB  0144F8        		LD	BC,0-1980
  E1AE  09            		ADD	HL,BC
  E1AF  65            		LD	H,L
                      	
  E1B0  7A            		LD	A,D
  E1B1  87            		ADD	A,A		;*2
  E1B2  87            		ADD	A,A		;*4
  E1B3  87            		ADD	A,A		;*8
  E1B4  87            		ADD	A,A		;*16
  E1B5  6F            		LD	L,A
  E1B6  29            		ADD	HL,HL		;*32
  E1B7  7D            		LD	A,L
  E1B8  B3            		OR	E
  E1B9  FD7714        		LD	(IY+20),A	;(FCB)ファイルを最後に変更した日付
  E1BC  FD7415        		LD	(IY+21),H
  E1BF  C9            		RET
                      	
  E1C0                	PUSHRR:
  E1C0  CDC6E1        		CALL	SUBRR
  E1C3                	POPRR1:
  E1C3  EDB0          		LDIR
  E1C5  C9            		RET
                      	
  E1C6                	SUBRR:
  E1C6  FDE5          		PUSH	IY
  E1C8  E1            		POP	HL
  E1C9  112100        		LD	DE,33
  E1CC  19            		ADD	HL,DE
  E1CD  115AEB        		LD	DE,HLBUF
  E1D0  010300        		LD	BC,3
  E1D3  C9            		RET
                      	
  E1D4                	SETSEQ:
  E1D4  F5            		PUSH	AF		;AHL=Random record
  E1D5  FD7E21        		LD	A,(IY+33)	;(FCB)ランダムレコード
  E1D8  FD6E22        		LD	L,(IY+34)
  E1DB  FD6623        		LD	H,(IY+35)
                      	
  E1DE  CDFAE1        		CALL	SSQ1
                      	
  E1E1  29            		ADD	HL,HL
  E1E2  CB3D          		SRL	L		;L=L/2
  E1E4  FD7520        		LD	(IY+32),L	;(FCB)カレントレコード
  E1E7  FD740C        		LD	(IY+12),H	;(FCB)カレントブロック
  E1EA  F1            		POP	AF
                      	
  E1EB                	POPRR:
  E1EB  CDC6E1        		CALL	SUBRR
  E1EE  EB            		EX	DE,HL
  E1EF  18D2          		JR	POPRR1
                      	
  E1F1                	GETSIZE:
  E1F1  FD7E10        		LD	A,(IY+16)	;(FCB)ファイルのサイズ(バイト単位)
  E1F4  FD6E11        		LD	L,(IY+17)
  E1F7  FD6612        		LD	H,(IY+18)
  E1FA                	SSQ1:				;バイト単位からCP/Mのレコード単位を求める（1レコード=128バイト）
  E1FA  87            		ADD	A,A		;in HLA => out HL
  E1FB  ED6A          		ADC	HL,HL
  E1FD  B7            		OR	A
  E1FE  C8            		RET	Z
  E1FF  23            		INC	HL
  E200  C9            		RET
                      	
  E201                	GETSEQ:
  E201  FD6E20        		LD	L,(IY+32)	;(FCB)カレントレコード
  E204  FD660C        		LD	H,(IY+12)	;(FCB)カレントブロック
                      	
  E207  CB25          		SLA	L	;L=L*2
                      	
  E209  CB3C          		SRL	H	;HL=HL/2
  E20B  CB1D          		RR	L	;
  E20D  C9            		RET
                      	
  E20E                	RB_WRITE:
  E20E  C5            		PUSH	BC
  E20F  ED4B4CEC      		LD	BC,(STABLE+2*026H)	;(BDOS)ランダムブロック書き込み
  E213  1805          		JR	RBRW
  E215                	RB_READ:
  E215  C5            		PUSH	BC
  E216  ED4B4EEC      		LD	BC,(STABLE+2*027H)	;(BDOS)ランダムブロック読み込み
  E21A                	RBRW:
  E21A  AF            		XOR	A	;HLA = HL*128
  E21B  CB3C          		SRL	H	;HL=HL/2
  E21D  CB1D          		RR	L	;
  E21F  1F            		RRA			;HLA
  E220  FD7721        		LD	(IY+33),A	;(FCB)ランダムレコード
  E223  FD7522        		LD	(IY+34),L
  E226  FD7423        		LD	(IY+35),H
  E229  218000        		LD	HL,128
                      	
  E22C  FDE5          		PUSH	IY
  E22E  D1            		POP	DE
  E22F  D5            		PUSH	DE
  E230  CD37E2        		CALL	JP_BC
  E233  FDE1          		POP	IY
  E235  C1            		POP	BC
  E236  C9            		RET
  E237                	JP_BC:
  E237  C5            		PUSH	BC
  E238  C9            		RET
                      	
  DDEC                	_SYS03	EQU	SCF_FF_RET	;(BDOS)外部入力
  DDEC                	_SYS2B	EQU	SCF_FF_RET	;(BDOS)日付の設定
  DDEC                	_SYS2D	EQU	SCF_FF_RET	;(BDOS)時刻の設定
                      	
                      	;LDFILE2.ASM
                      	
                      	;	LSX-Dodgers FILE2
                      	
  E239                	RBWDD:
  E239  E5            		PUSH	HL
  E23A  C1            		POP	BC
  E23B  2115E3        		LD	HL,NUL
  E23E  CD49E3        		CALL	DDX
  E241  2003          		JR	NZ,RBWDD2
  E243  2A08EC        		LD	HL,(STABLE+2*4)
  E246                	RBWDD2:
  E246  FE43          		CP	'C'
  E248  2003          		JR	NZ,RBWDD3
  E24A  2A04EC        		LD	HL,(STABLE+2*2)
  E24D                	RBWDD3:
  E24D  FE50          		CP	'P'
  E24F  2003          		JR	NZ,RBWDD4
  E251  2A0AEC        		LD	HL,(STABLE+2*5)
  E254                	RBWDD4:
  E254  2262E2        		LD	(RBWDDP+1),HL
  E257  2A8AEC        		LD	HL,(_DTA)
  E25A                	RBWDD1:
  E25A  78            		LD	A,B
  E25B  B1            		OR	C
  E25C                	RBWDD5:
  E25C  CA10E3        		JP	Z,RBW1
  E25F  5E            		LD	E,(HL)
  E260  23            		INC	HL
  E261  CD55D7        	RBWDDP:	CALL	_SYS02
  E264  DA2CE3        		JP	C,RBRERR
  E267  3E1A          		LD	A,01AH
  E269  BB            		CP	E
  E26A  28F0          		JR	Z,RBWDD5
  E26C  0B            		DEC	BC
  E26D  18EB          		JR	RBWDD1
                      	
                      					;Write random block
  E26F                	_SYS26:		;(BDOS)ランダムブロック書き込み
  E26F  AF            		XOR	A
  E270  320AE5        		LD	(DRDN1),A	;NOP
  E273  22CBE4        		LD	(LEFT+1),HL	;HL←書き込むレコード数
  E276  225DEB        		LD	(LEFTX),HL
  E279  CD3ADD        		CALL	SETDRV
                      	
  E27C  CD35E4        		CALL	RBX0
  E27F  DA17E3        		JP	C,RBWERR
  E282  28B5          		JR	Z,RBWDD		;デバイスデスクプリタ
  E284  CDDAE0        		CALL	WOPEN
  E287  DA17E3        		JP	C,RBWERR
  E28A  7C            		LD	A,H
  E28B  B5            		OR	L
  E28C  CA10E3        		JP	Z,RBW1
                      	
  E28F  2B            		DEC	HL
                      	
  E290  CDE3E4        		CALL	GET_RR_CDE	;CDE=Random record
                      	
  E293  AF            		XOR	A	;AHL=HL+CDE
  E294  19            		ADD	HL,DE
  E295  89            		ADC	A,C
                      	
  E296  47            		LD	B,A
  E297  4C            		LD	C,H
                      	
  E298  CD3FE1        		CALL	RWXR
  E29B  DCEBE0        		CALL	C,WRDFX
  E29E  DA17E3        		JP	C,RBWERR
                      	
  E2A1  CD5EE4        		CALL	RBX2
  E2A4  281A          		JR	Z,RBWB		;NZ=セクタ以下の端数がある
  E2A6  CD71E4        		CALL	RBXA
  E2A9  386C          		JR	C,RBWERR
  E2AB  EB            		EX	DE,HL
  E2AC  C5            		PUSH	BC
  E2AD  EDB0          		LDIR
  E2AF  225FEB        		LD	(DTAX),HL
                      	
  E2B2  CD7FE0        		CALL	SWTDBF		;バッファデータは更新された
                      	
  E2B5  2A5DEB        		LD	HL,(LEFTX)
  E2B8  D1            		POP	DE
  E2B9  ED52          		SBC	HL,DE
  E2BB  225DEB        		LD	(LEFTX),HL
  E2BE  2830          		JR	Z,RBWEND
                      	
  E2C0                	RBWB:
  E2C0  CDA7E4        		CALL	RBXB
  E2C3  2813          		JR	Z,RBWC
  E2C5                	RBWB1:
  E2C5  C5            		PUSH	BC
  E2C6  D5            		PUSH	DE
  E2C7  CD4ADF        		CALL	CLUSTX
  E2CA  CDDFE7        		CALL	DWT24
  E2CD  D1            		POP	DE
  E2CE  C1            		POP	BC
  E2CF  3846          		JR	C,RBWERR
  E2D1  CD76E6        		CALL	GNCLX
  E2D4  3841          		JR	C,RBWERR
  E2D6  10ED          		DJNZ	RBWB1
  E2D8                	RBWC:
  E2D8  CDBFE4        		CALL	RBXC
  E2DB  2813          		JR	Z,RBWEND
  E2DD  C5            		PUSH	BC
  E2DE  CD4ADF        		CALL	CLUSTX
  E2E1  CD09E5        		CALL	DRDN
  E2E4  C1            		POP	BC
  E2E5  3830          		JR	C,RBWERR
  E2E7  ED5B7EEC      		LD	DE,(_DTBUF)
  E2EB  EDB0          		LDIR
  E2ED  CD7FE0        		CALL	SWTDBF		;バッファデータは更新された
  E2F0                	RBWEND:
  E2F0  CDCAE4        		CALL	RBXEND
                      	
  E2F3  CD44E4        		CALL	RBX1
  E2F6  3018          		JR	NC,RBW1
  E2F8  2ACBE4        		LD	HL,(LEFT+1)
  E2FB  FD5E10        		LD	E,(IY+16)	;(FCB)ファイルのサイズ(バイト単位)
  E2FE  FD5611        		LD	D,(IY+17)	;CDE=File size
  E301  FD4E12        		LD	C,(IY+18)
  E304  AF            		XOR	A
  E305  19            		ADD	HL,DE
  E306  89            		ADC	A,C
  E307  FD7510        		LD	(IY+16),L	;(FCB)ファイルのサイズ(バイト単位)
  E30A  FD7411        		LD	(IY+17),H
  E30D  FD7712        		LD	(IY+18),A
  E310                	RBW1:
  E310  FDE1          		POP	IY
  E312  C1            		POP	BC
  E313  D1            		POP	DE
  E314  E1            		POP	HL
  E315                	NUL:
  E315  AF            		XOR	A
  E316  C9            		RET
                      	
  E317                	RBWERR:
  E317  FDE5          		PUSH	IY
  E319  D1            		POP	DE
  E31A  2A20EC        		LD	HL,(STABLE+2*010H)
  E31D  CD0F00        		CALL	JP_HL
  E320                	RBRERR1:
  E320  3E01          		LD	A,001H
  E322                	RBRERR2:
  E322  FDE1          		POP	IY
  E324  C1            		POP	BC
  E325  D1            		POP	DE
  E326  E1            		POP	HL
  E327  37            		SCF
  E328  210000        		LD	HL,0
  E32B  C9            		RET
                      	
  E32C                	RBRERR:
  E32C  3EFF          		LD	A,0FFH
  E32E  18F2          		JR	RBRERR2
                      	
  E330                	RBRFL:
  E330  3E00          	RBRFLP:	LD	A,000H
  E332  FE0D          		CP	00DH
  E334  2005          		JR	NZ,RBRFL1
  E336  D5            		PUSH	DE
  E337  1E0A          		LD	E,00AH
  E339  1805          		JR	RBRFL2
  E33B                	RBRFL1:
  E33B  D5            		PUSH	DE
  E33C  CD09EB        		CALL	_SYS07
  E33F  5F            		LD	E,A
  E340                	RBRFL2:
  E340  CDCDEC        		CALL	_PRINT
  E343  7B            		LD	A,E
  E344  D1            		POP	DE
  E345  3231E3        		LD	(RBRFLP+1),A
  E348  C9            		RET
  E349                	DDX:
  E349  FD7E01        		LD	A,(IY+1)	;(FCB)主ファイル名
  E34C  CD6FDF        		CALL	CAP
  E34F  FE41          		CP	'A'
  E351  C9            		RET
                      	
  E352                	RBRDD:
  E352  E5            		PUSH	HL
  E353  C1            		POP	BC
  E354  2130E3        		LD	HL,RBRFL
  E357  CD49E3        		CALL	DDX
  E35A  2005          		JR	NZ,RBRDD2
  E35C  2A06EC        		LD	HL,(STABLE+2*3)
  E35F  1804          		JR	RBRDD3
  E361                	RBRDD2:
  E361  FE43          		CP	'C'
  E363  202C          		JR	NZ,RBRDERR
  E365                	RBRDD3:
  E365  2275E3        		LD	(RBRDDP+1),HL
                      	
  E368  ED5B8AEC      		LD	DE,(_DTA)
  E36C  210000        		LD	HL,0
  E36F                	RBRDD1:
  E36F  78            		LD	A,B
  E370  B1            		OR	C
  E371  2818          		JR	Z,RBRDDE1
  E373  23            		INC	HL
  E374  CD30E3        	RBRDDP:	CALL	RBRFL
  E377  380D          		JR	C,RBRDDE
  E379  FE1A          		CP	01AH
  E37B  2809          		JR	Z,RBRDDE
  E37D  FE03          		CP	3
  E37F  2805          		JR	Z,RBRDDE
  E381  12            		LD	(DE),A
  E382  13            		INC	DE
  E383  0B            		DEC	BC
  E384  18E9          		JR	RBRDD1
                      	
  E386                	RBRDDE:
  E386  3E1A          		LD	A,01AH
  E388  12            		LD	(DE),A
  E389                	RBRDDE2:
  E389  AF            		XOR	A
  E38A  3C            		INC	A
  E38B                	RBRDDE1:
  E38B  3221E4        		LD	(RBRAP+1),A
  E38E  C31AE4        		JP	RBREND0
  E391                	RBRDERR:
  E391  210000        		LD	HL,0
  E394  18F3          		JR	RBRDDE2
                      	
                      					;Read random block
  E396                	_SYS27:		;(BDOS)ランダムブロック読み込み
  E396  225DEB        		LD	(LEFTX),HL
  E399  CD3ADD        		CALL	SETDRV
                      	
  E39C  FDCB0D66      		BIT	4,(IY+13)	;(FCB)属性(アトリビュート)
  E3A0  C223E4        		JP	NZ,RBRDIR	;ディレクトリ
  E3A3  CD35E4        		CALL	RBX0
  E3A6  DA2CE3        		JP	C,RBRERR
  E3A9  28A7          		JR	Z,RBRDD
  E3AB  CD44E4        		CALL	RBX1
  E3AE  DA20E3        		JP	C,RBRERR1
  E3B1  79            		LD	A,C
  E3B2  EB            		EX	DE,HL
  E3B3  ED52          		SBC	HL,DE		;CP 0HL,CDE
  E3B5  19            		ADD	HL,DE
  E3B6  DE00          		SBC	A,000H
  E3B8  3801          		JR	C,RBR1
  E3BA  EB            		EX	DE,HL
  E3BB                	RBR1:
  E3BB  9F            		SBC	A,A
  E3BC  E601          		AND	1
  E3BE  3221E4        		LD	(RBRAP+1),A
                      	
  E3C1  7C            		LD	A,H
  E3C2  B5            		OR	L
  E3C3  CA1AE4        		JP	Z,RBREND0
                      	
  E3C6  22CBE4        		LD	(LEFT+1),HL	;Read record byte
  E3C9  225DEB        		LD	(LEFTX),HL
                      	
  E3CC  CD5EE4        		CALL	RBX2
  E3CF  2819          		JR	Z,RBRB
  E3D1  CD71E4        		CALL	RBXA
  E3D4  DA2CE3        		JP	C,RBRERR
  E3D7  C5            		PUSH	BC
  E3D8  EDB0          		LDIR
  E3DA  ED535FEB      		LD	(DTAX),DE
  E3DE  2A5DEB        		LD	HL,(LEFTX)
  E3E1  D1            		POP	DE
  E3E2  A7            		AND	A
  E3E3  ED52          		SBC	HL,DE
  E3E5  225DEB        		LD	(LEFTX),HL
  E3E8  282D          		JR	Z,RBREND
                      	
  E3EA                	RBRB:
  E3EA  CDA7E4        		CALL	RBXB
  E3ED  2812          		JR	Z,RBRC
  E3EF                	RBRB1:
  E3EF  C5            		PUSH	BC
  E3F0  D5            		PUSH	DE
  E3F1  CD4ADF        		CALL	CLUSTX
  E3F4  CDCFE7        		CALL	DRD24
  E3F7  D1            		POP	DE
  E3F8  C1            		POP	BC
  E3F9  D476E6        		CALL	NC,GNCLX
  E3FC  DA2CE3        		JP	C,RBRERR
  E3FF  10EE          		DJNZ	RBRB1
  E401                	RBRC:
  E401  CDBFE4        		CALL	RBXC
  E404  2811          		JR	Z,RBREND
  E406  C5            		PUSH	BC
  E407  CD4ADF        		CALL	CLUSTX
  E40A  CDEDE4        		CALL	DRDX
  E40D  C1            		POP	BC
  E40E  DA2CE3        		JP	C,RBRERR
  E411  EB            		EX	DE,HL
  E412  2A7EEC        		LD	HL,(_DTBUF)
  E415  EDB0          		LDIR
  E417                	RBREND:
  E417  CDCAE4        		CALL	RBXEND
  E41A                	RBREND0:
  E41A  FDE1          		POP	IY
  E41C  C1            		POP	BC
  E41D  D1            		POP	DE
  E41E  F1            		POP	AF	;(HL)
  E41F  AF            		XOR	A
  E420  3E00          	RBRAP:	LD	A,000H
  E422  C9            		RET
                      	
  E423                	RBRDIR:
  E423  FD6E1A        		LD	L,(IY+26)	;(FCB)ファイルの先頭クラスタ
  E426  FD661B        		LD	H,(IY+27)
  E429  CD8ADF        		CALL	CHDIR
  E42C  AF            		XOR	A
  E42D  67            		LD	H,A
  E42E  6F            		LD	L,A
  E42F  3C            		INC	A
  E430  3221E4        		LD	(RBRAP+1),A
  E433  18E5          		JR	RBREND0
                      	
  E435                	RBX0:
  E435  2A8AEC        		LD	HL,(_DTA)
  E438  225FEB        		LD	(DTAX),HL
  E43B  2A5DEB        		LD	HL,(LEFTX)
  E43E  FD7E1C        		LD	A,(IY+28)	;(FCB)オープンモード
  E441  D6FD          		SUB	0FDH
  E443  C9            		RET
                      	
  E444                	RBX1:
  E444  E5            		PUSH	HL		;Record byte
                      					;AHL=File size
  E445  FD6E10        		LD	L,(IY+16)	;ファイルのサイズ(バイト単位)
  E448  FD6611        		LD	H,(IY+17)
  E44B  FD7E12        		LD	A,(IY+18)
                      	
  E44E  CDE3E4        		CALL	GET_RR_CDE	;CDE=Random record
                      	
  E451  A7            		AND	A
  E452  ED52          		SBC	HL,DE
  E454  99            		SBC	A,C
  E455  D1            		POP	DE
                      	
  E456  D8            		RET	C
  E457  4F            		LD	C,A
  E458  EB            		EX	DE,HL	;CDE=File byte	HL=Record byte
  E459  B2            		OR	D
  E45A  B3            		OR	E
  E45B  C0            		RET	NZ
  E45C  37            		SCF
  E45D  C9            		RET
                      	
  E45E                	RBX2:				;Cluster settings
  E45E  FD4E22        		LD	C,(IY+34)	;(+33)(FCB)ランダムレコード
  E461  FD4623        		LD	B,(IY+35)
  E464  CD3FE1        		CALL	RWXR
  E467  3A6ADE        		LD	A,(SECSZM1+2)	;1024=3 / 512=1 / 256=0
  E46A  FDA622        		AND	(IY+34)
  E46D  FDB621        		OR	(IY+33)
  E470  C9            		RET
                      	
  E471                	RBXA:
  E471  C5            		PUSH	BC
  E472  D5            		PUSH	DE
  E473  CD4ADF        		CALL	CLUSTX
  E476  CDEDE4        		CALL	DRDX
  E479  D1            		POP	DE
  E47A  C1            		POP	BC
  E47B  D8            		RET	C
  E47C  CD76E6        		CALL	GNCLX
  E47F  D8            		RET	C
  E480  ED53FEEB      		LD	(_CLPS),DE
                      	
  E484  FD4E21        		LD	C,(IY+33)	;(FCB)ランダムレコード
  E487  210004        	SECSZ:	LD	HL,0400H	;自己書き換え 1024=0400H / 512=0200H ここに1セクタのサイズが格納される
  E48A  7C            		LD	A,H
  E48B  3D            		DEC	A		;1024=3 / 512=1
  E48C  FDA622        		AND	(IY+34)		;(FCB)ランダムレコード
  E48F  47            		LD	B,A		;BCに1セクタ以下の端数が入る
  E490  ED42          		SBC	HL,BC		;残りを計算
                      	
  E492  ED5B5DEB      		LD	DE,(LEFTX)
  E496  ED52          		SBC	HL,DE		;CP HL,DE
  E498  19            		ADD	HL,DE		;
  E499  3801          		JR	C,RBXA1		;DEとHLを比較して大きい方をHLに
  E49B  EB            		EX	DE,HL
  E49C                	RBXA1:
  E49C  E5            		PUSH	HL
  E49D  2A7EEC        		LD	HL,(_DTBUF)
  E4A0  09            		ADD	HL,BC
  E4A1  ED5B5FEB      		LD	DE,(DTAX)
  E4A5  C1            		POP	BC
  E4A6  C9            		RET
                      	
  E4A7                	RBXB:
  E4A7  2A5FEB        		LD	HL,(DTAX)
  E4AA  ED5BFEEB      		LD	DE,(_CLPS)
  E4AE  3A5EEB        		LD	A,(LEFTX+1)
  E4B1  47            		LD	B,A
  E4B2  3A89E4        		LD	A,(SECSZ+2)	;1024=4 / 512=2 / 256=1
  E4B5                	RBXB1:
  E4B5  1F            		RRA		;->CF
  E4B6  3804          		JR	C,RBXB2
  E4B8  CB38          		SRL	B	;B=B/2
  E4BA  18F9          		JR	RBXB1
  E4BC                	RBXB2:
  E4BC  78            		LD	A,B
  E4BD  B7            		OR	A
  E4BE  C9            		RET
                      	
  E4BF                	RBXC:
  E4BF  ED4B5DEB      		LD	BC,(LEFTX)
  E4C3  3A6ADE        		LD	A,(SECSZM1+2)	;1024=3 / 512=1 / 256=0
  E4C6  A0            		AND	B
  E4C7  47            		LD	B,A		;1セクタ以下の端数がない場合はZ
  E4C8  B1            		OR	C
  E4C9  C9            		RET
                      	
  E4CA                	RBXEND:
  E4CA  110000        	LEFT:	LD	DE,0
  E4CD  AF            		XOR	A
  E4CE  FD6E21        		LD	L,(IY+33)	;(FCB)ランダムレコード
  E4D1  FD6622        		LD	H,(IY+34)
  E4D4  19            		ADD	HL,DE
  E4D5  FD8E23        		ADC	A,(IY+35)
  E4D8  FD7521        		LD	(IY+33),L	;(FCB)ランダムレコード
  E4DB  FD7422        		LD	(IY+34),H
  E4DE  FD7723        		LD	(IY+35),A
  E4E1  EB            		EX	DE,HL		;HL=Read byte
  E4E2  C9            		RET
                      	
  E4E3                	GET_RR_CDE:			;CDE=Random record
  E4E3  FD5E21        		LD	E,(IY+33)	;(FCB)ランダムレコード
  E4E6  FD5622        		LD	D,(IY+34)
  E4E9  FD4E23        		LD	C,(IY+35)
  E4EC  C9            		RET
                      	
                      	
                      	;LDDIO.ASM
                      	
                      	;	LSX-Dodgers DIO
                      	
  E4ED                	DRDX:
  E4ED  CD2BE5        		CALL	DRDY
  E4F0  C8            		RET	Z
  E4F1  CD11E5        		CALL	DRDX1		;データバッファの情報を保存
  E4F4  D8            		RET	C
  E4F5  E5            		PUSH	HL
  E4F6  C5            		PUSH	BC
  E4F7  D5            		PUSH	DE
  E4F8  2A7EEC        		LD	HL,(_DTBUF)
  E4FB  3A54E5        		LD	A,(_DBS24+1)
  E4FE  4F            		LD	C,A
  E4FF  CDCFE7        		CALL	DRD24
  E502  DC26E5        		CALL	C,DRDNE
  E505                	POP_DE_BC_HL_RET:
  E505  D1            		POP	DE
  E506  C1            		POP	BC
  E507  E1            		POP	HL
  E508  C9            		RET
                      	
                      	;	CDE:セクタ番号
  E509                	DRDN:
  E509  AF            		XOR	A
  E50A  00            	DRDN1:	NOP			;自己書き換え NOP / SCF
  E50B  30E0          		JR	NC,DRDX
  E50D                	DRDNX:
  E50D  CD2BE5        		CALL	DRDY
  E510  C8            		RET	Z
  E511                	DRDX1:
  E511  CD41E5        		CALL	DWTX
                      					;データバッファの読み込んだドライブ・セクタ情報を保存
  E514  ED53A6EC      		LD	(_DBSEC),DE
  E518  79            		LD	A,C
  E519  3254E5        		LD	(_DBS24+1),A
                      	
  E51C  3A88EC        		LD	A,(_DRV)
  E51F  32A5EC        		LD	(_DBDRV),A
  E522  CDD9EC        		CALL	_CHGDRV
  E525  D0            		RET	NC
  E526                	DRDNE:
  E526  9F            		SBC	A,A		;CF=1ならばA=0FFH
  E527  32A5EC        		LD	(_DBDRV),A
  E52A  C9            		RET
                      	
                      	;	CDE:セクタ番号
  E52B                	DRDY:
  E52B  3A54E5        		LD	A,(_DBS24+1)
  E52E  B9            		CP	C
  E52F  C0            		RET	NZ
                      	
  E530  E5            		PUSH	HL
  E531  3A88EC        		LD	A,(_DRV)
  E534  21A5EC        		LD	HL,_DBDRV
  E537  AE            		XOR	(HL)
  E538  2005          		JR	NZ,POP_HL_RET
                      	
  E53A  2AA6EC        		LD	HL,(_DBSEC)
  E53D  ED52          		SBC	HL,DE		;CF=0
  E53F                	POP_HL_RET:
  E53F  E1            		POP	HL
  E540  C9            		RET
                      	
  E541                	DWTX:
  E541  3AA4EC        		LD	A,(_WTDBF)
  E544  B7            		OR	A
  E545  C8            		RET	Z
  E546  AF            		XOR	A
  E547  32A4EC        		LD	(_WTDBF),A
                      	
  E54A  E5            		PUSH	HL
  E54B  C5            		PUSH	BC
  E54C  D5            		PUSH	DE
  E54D  3AA5EC        		LD	A,(_DBDRV)
  E550  CDD9EC        		CALL	_CHGDRV
  E553  0E00          	_DBS24:	LD	C,0
  E555  ED5BA6EC      		LD	DE,(_DBSEC)
  E559  2A7EEC        		LD	HL,(_DTBUF)
  E55C  D4DFE7        		CALL	NC,DWT24
  E55F                	POP_DE_BC_HL_RET2:
  E55F  18A4          		JR	POP_DE_BC_HL_RET
                      	
  E561                	RDFATX:
  E561  E5            		PUSH	HL
  E562  3A88EC        		LD	A,(_DRV)
  E565  21AAEC        		LD	HL,_FATDRV
  E568  AE            		XOR	(HL)
  E569  28D4          		JR	Z,POP_HL_RET
                      	
  E56B  C5            		PUSH	BC
  E56C  D5            		PUSH	DE
  E56D  DDE5          		PUSH	IX
  E56F  CD8BE5        		CALL	WTFATX
  E572  3813          		JR	C,POP_IX_DE_BC_HL_RET
                      	
  E574  AF            		XOR	A
  E575  32ABEC        		LD	(_FATIX),A
  E578  3A88EC        		LD	A,(_DRV)
  E57B  32AAEC        		LD	(_FATDRV),A
  E57E  CDE5EC        		CALL	_RDFAT
  E581                	RDFATE2:
  E581  3004          		JR	NC,POP_IX_DE_BC_HL_RET
  E583  9F            		SBC	A,A		;A=0xFF
  E584  32AAEC        		LD	(_FATDRV),A
  E587                	POP_IX_DE_BC_HL_RET:
  E587  DDE1          		POP	IX
  E589  18D4          		JR	POP_DE_BC_HL_RET2
                      	
  E58B                	WTFATX:
  E58B  3AA2EC        		LD	A,(_WTFATF)
  E58E  B7            		OR	A
  E58F  C8            		RET	Z
  E590  E5            		PUSH	HL
  E591  3AAAEC        		LD	A,(_FATDRV)
  E594  21A5EC        		LD	HL,_DBDRV
  E597  AE            		XOR	(HL)
  E598  CC41E5        		CALL	Z,DWTX
  E59B  38A2          		JR	C,POP_HL_RET
  E59D  C5            		PUSH	BC
  E59E  D5            		PUSH	DE
  E59F  DDE5          		PUSH	IX
  E5A1  CDECE7        		CALL	WTFAT
  E5A4  AF            		XOR	A
  E5A5  32A2EC        		LD	(_WTFATF),A
  E5A8  18DD          		JR	POP_IX_DE_BC_HL_RET
                      	
  E5AA                	NCL1:
  E5AA  7A            		LD	A,D
  E5AB  B3            		OR	E
  E5AC  37            		SCF
  E5AD  C8            		RET	Z
                      	
  E5AE  7A            		LD	A,D
  E5AF  E608          		AND	8		;DE(targetCluster >= 0x800)
  E5B1                	N16CL1X:
  E5B1  E5            		PUSH	HL
  E5B2  32D1E5        		LD	(NCLPAT+2),A	;_FATIX
  E5B5  2AAAEC        		LD	HL,(_FATDRV)	;L=_FATDRV H=_FATIX
  E5B8  BC            		CP	H
  E5B9  3A88EC        		LD	A,(_DRV)	;この間でフラグは変化しない
  E5BC  32D0E5        		LD	(NCLPAT+1),A	;_FATDRV
  E5BF  2005          		JR	NZ,NCL2		;FATIXが違う
  E5C1  BD            		CP	L
  E5C2  2002          		JR	NZ,NCL2		;ドライブが違う
  E5C4  E1            		POP	HL
  E5C5  C9            		RET
  E5C6                	NCL2:
  E5C6  C5            		PUSH	BC
  E5C7  D5            		PUSH	DE
  E5C8  DDE5          		PUSH	IX
  E5CA  CD8BE5        		CALL	WTFATX
  E5CD  38B8          		JR	C,POP_IX_DE_BC_HL_RET
  E5CF  010000        	NCLPAT:	LD	BC,0		;自己書き換え C=_FATDRV B=_FATIX
  E5D2  ED43AAEC      		LD	(_FATDRV),BC
  E5D6  CDBCE7        		CALL	RDFATS
  E5D9  18A6          		JR	RDFATE2
                      	
  E5DB                	NCL3:
  E5DB  CB9A          		RES	3,D
  E5DD  6B            		LD	L,E
  E5DE  62            		LD	H,D
  E5DF  CB3C          		SRL	H	;
  E5E1  CB1D          		RR	L	;HLA=HLA/2
  E5E3  1F            		RRA		;
  E5E4  ED4B7CEC      		LD	BC,(_FATBF)
  E5E8  19            		ADD	HL,DE
  E5E9  09            		ADD	HL,BC
  E5EA  17            		RLA
  E5EB  C9            		RET
                      	
  E5EC                	N16CL1:
  E5EC  7A            		LD	A,D
  E5ED  B3            		OR	E
  E5EE  37            		SCF
  E5EF  C8            		RET	Z
                      	
  E5F0  7A            		LD	A,D
  E5F1  CB3F          		SRL	A	;/2
  E5F3  CB3F          		SRL	A	;/2
  E5F5  18BA          		JR	N16CL1X
                      	
  E5F7                	GNCL:
  E5F7  CDAAE5        		CALL	NCL1		;GET NEXT CLUSTER
  E5FA  D8            		RET	C
  E5FB  C5            		PUSH	BC
  E5FC  E5            		PUSH	HL
  E5FD  CDDBE5        		CALL	NCL3
  E600  3809          		JR	C,GNC1
  E602  5E            		LD	E,(HL)
  E603  23            		INC	HL
  E604  7E            		LD	A,(HL)
  E605  E60F          		AND	00FH
  E607  57            		LD	D,A
  E608  E1            		POP	HL
  E609  C1            		POP	BC
  E60A  C9            		RET
  E60B                	GNC1:
  E60B  7E            		LD	A,(HL)
  E60C  23            		INC	HL
  E60D  56            		LD	D,(HL)
  E60E  0604          		LD	B,4
  E610                	GNC1L:
  E610  CB3A          		SRL	D	;DA=DA/2
  E612  1F            		RRA		;
  E613  10FB          		DJNZ	GNC1L
                      	
  E615  5F            		LD	E,A
  E616  E1            		POP	HL
  E617  C1            		POP	BC
  E618  A7            		AND	A
  E619  C9            		RET
                      	
  E61A                	SNCL:
  E61A  CDAAE5        		CALL	NCL1
  E61D  D8            		RET	C
                      	;				SET NEXT CLUSTER
  E61E  E5            		PUSH	HL
  E61F  C5            		PUSH	BC
  E620  D5            		PUSH	DE
  E621  E5            		PUSH	HL
  E622  CDDBE5        		CALL	NCL3
  E625  D1            		POP	DE
                      	;CF=ODD
  E626  7E            		LD	A,(HL)
  E627  73            		LD	(HL),E
  E628  3806          		JR	C,SNC1
                      	;EVEN
                      	;M[0] = E
                      	;M[1] = (M[1] & 0xF0) | (D & 0x0F)
  E62A  23            		INC	HL
  E62B  ED67          		RRD		;M={A[3:0],E[3:0]}
  E62D  7A            		LD	A,D
  E62E  1804          		JR	SNC11
  E630                	SNC1:
                      	;ODD
                      	;HL[0] = (HL[0]&0x0F) | (E<<4)
                      	;HL[1] = DE>>4
  E630  ED6F          		RLD		;M={D[3:0],E[7:4]}
  E632  23            		INC	HL
  E633  72            		LD	(HL),D	;M={D[3:0],E[7:4]}
  E634                	SNC11:
  E634  ED6F          		RLD		;M={M[7:4],D[3:0]}
  E636  B7            		OR	A
  E637  D1            		POP	DE
  E638  C1            		POP	BC
  E639  E1            		POP	HL
  E63A                	FAT_CHANGED:
  E63A  3E01          		LD	A,1
  E63C  32A2EC        		LD	(_WTFATF),A
  E63F  C9            		RET
                      	
  E640                	N16CL3:
  E640  C5            		PUSH	BC
  E641  6B            		LD	L,E
  E642  7A            		LD	A,D
  E643  E603          		AND	3
  E645  67            		LD	H,A
  E646  29            		ADD	HL,HL
  E647  ED4B7CEC      		LD	BC,(_FATBF)
  E64B  09            		ADD	HL,BC
  E64C  C1            		POP	BC
  E64D  C9            		RET
                      	
  E64E                	GNCL16:
  E64E  CDECE5        		CALL	N16CL1		;GET NEXT CLUSTER for FAT16
  E651  D8            		RET	C
  E652  E5            		PUSH	HL
  E653  CD40E6        		CALL	N16CL3
  E656  5E            		LD	E,(HL)
  E657  23            		INC	HL
  E658  56            		LD	D,(HL)
  E659  E1            		POP	HL
  E65A  C9            		RET
                      	
  E65B                	SNCL16:
  E65B  CDECE5        		CALL	N16CL1		;GET NEXT CLUSTER for FAT16
  E65E  D8            		RET	C
  E65F  D5            		PUSH	DE
  E660  E5            		PUSH	HL
  E661  CD40E6        		CALL	N16CL3
  E664  D1            		POP	DE		;HL
  E665  73            		LD	(HL),E
  E666  23            		INC	HL
  E667  72            		LD	(HL),D
  E668  6B            		LD	L,E
  E669  62            		LD	H,D
  E66A  D1            		POP	DE
  E66B  18CD          		JR	FAT_CHANGED
                      	
                      	;------------------------
                      	;次のセクタを探す際に_SECPSの値をチェック
                      	;in
                      	;	DE : セクタ番号
                      	;out
                      	;	DE : 次のセクタ番号
                      	;note
                      	;
                      	;------------------------
  E66D                	NEXTX:
  E66D  3E00          	_SECPS:	LD	A,0
  E66F  3C            		INC	A
  E670  E600          	NCPAT:	AND	0	;自己書き換え　1クラスタの論理セクタ数-1
  E672  326EE6        		LD	(_SECPS+1),A
  E675  C9            		RET
                      	
  E676                	GNCLX:
  E676  CD6DE6        		CALL	NEXTX
  E679  C0            		RET	NZ	;1クラスタのセクタ未満の場合は戻る
  E67A  C3F7EC        		JP	_GNCL	;次のクラスタを探す
                      	
  E67D                	RDFAT:
  E67D  3E80          		LD	A,080H
  E67F  3270EB        		LD	(CHECK),A
  E682                	RDFAT1:
  E682  3A88EC        		LD	A,(_DRV)
  E685  CD3CE9        		CALL	CHGDRVR
  E688  D8            		RET	C
  E689  DD7E12        		LD	A,(IX+012H)	;DPB_12_DEVICE
  E68C  CB6F          		BIT	5,A
  E68E  CAADE7        		JP	Z,RDFAT0X
  E691  2170EB        		LD	HL,CHECK
  E694  A6            		AND	(HL)
  E695  77            		LD	(HL),A
  E696  110000        		LD	DE,0		;BPB
  E699  2A7CEC        		LD	HL,(_FATBF)
  E69C  CDCDE7        		CALL	DRD16
  E69F  3024          		JR	NC,GET_BPB
  E6A1  2170EB        		LD	HL,CHECK
  E6A4  CB06          		RLC	(HL)
  E6A6  3F            		CCF
  E6A7  D8            		RET	C
  E6A8  DDCB0A1E      		RR	(IX+00AH)	;DPB_0A_FDMODE
  E6AC  3F            		CCF			;フロッピーディスクのMFMモードを切り替える
  E6AD  DDCB0A16      		RL	(IX+00AH)	;DPB_0A_FDMODE
  E6B1  3EFF          		LD	A,0FFH
  E6B3  3289EC        		LD	(_DSK),A
  E6B6  3A84EC        		LD	A,(_DRIVE)
  E6B9  E603          		AND	3
  E6BB  F680          		OR	080H
  E6BD  6F            		LD	L,A
  E6BE  26EC          		LD	H,_CYL0/256
  E6C0  3EFF          		LD	A,0FFH
  E6C2  77            		LD	(HL),A
  E6C3  18BD          		JR	RDFAT1
  E6C5                	GET_BPB:
  E6C5  FDE5          		PUSH	IY
  E6C7  FD2A7CEC      		LD	IY,(_FATBF)	;BPB
                      	
  E6CB  FD7E00        		LD	A,(IY+0)	;BS_JmpBoot
  E6CE  FEEB          		CP	0EBH		;Short jump
  E6D0  280C          		JR	Z,BPBOK
  E6D2  FEE9          		CP	0E9H		;Near jump
  E6D4  2808          		JR	Z,BPBOK
  E6D6  FE60          		CP	060H		;X68k
  E6D8  2804          		JR	Z,BPBOK
  E6DA                	NOT_BPB
  E6DA  FDE1          		POP	IY
  E6DC  37            		SCF
  E6DD  C9            		RET
  E6DE                	BPBOK:
  E6DE  FD7E0D        		LD	A,(IY+13)	;BPB_SecPerClus
  E6E1  DD7707        		LD	(IX+7),A	;DPB_07_SECPCL
                      	
  E6E4  FD7E10        		LD	A,(IY+16)	;BPB_NumFATs
  E6E7  FE02          		CP	2		;>2:NC
  E6E9  FD7E0C        		LD	A,(IY+12)	;BPB_BytsPerSec
  E6EC  3806          		JR	C,BPBFAT1
  E6EE  FE05          		CP	5
  E6F0  30E8          		JR	NC,NOT_BPB	;1セクタ1024以上は無効
  E6F2  F680          		OR	080H
  E6F4                	BPBFAT1:
  E6F4  DD770F        		LD	(IX+00FH),A	;DPB_0F_BPS
                      	
  E6F7  FD7E16        		LD	A,(IY+22)	;BPB_FATSz16
  E6FA  DD7700        		LD	(IX+0),A	;DPB_00_FATLN
  E6FD  FD7E17        		LD	A,(IY+23)	;BPB_FATSz16
  E700  DD7701        		LD	(IX+1),A	;DPB_00_FATLN
                      	
  E703  FD6E0E        		LD	L,(IY+14)	;BPB_RsvdSecCnt
  E706  FD660F        		LD	H,(IY+15)
  E709  DD750E        		LD	(IX+00EH),L	;DPB_0E_FATPS
  E70C  FD5E16        		LD	E,(IY+22)	;BPB_FATSz16
  E70F  FD5617        		LD	D,(IY+23)
  E712  FD4610        		LD	B,(IY+16)	;BPB_NumFATs
  E715                	BPBDP1:				;BPB_FATSz16 * BPB_NumFATs
  E715  19            		ADD	HL,DE
  E716  10FD          		DJNZ	BPBDP1
  E718                	BPBDP2:
  E718  DD7510        		LD	(IX+010H),L	;DPB_10_DIRPS
  E71B  DD7411        		LD	(IX+011H),H
  E71E  E5            		PUSH	HL
                      	
  E71F  FD6E11        		LD	L,(IY+17)	;BPB_RootEntCnt
  E722  FD6612        		LD	H,(IY+18)
  E725  FD7E0C        		LD	A,(IY+12)	;BPB_BytsPerSec
  E728  0606          		LD	B,6
  E72A                	BPBBPS1:
  E72A  05            		DEC	B
  E72B  0F            		RRCA
  E72C  30FC          		JR	NC,BPBBPS1
  E72E                	BPBDE1:
  E72E  29            		ADD	HL,HL
  E72F  10FD          		DJNZ	BPBDE1
                      	
  E731  7C            		LD	A,H
  E732  DD770B        		LD	(IX+00BH),A	;DPB_0B_DIRSCNT
                      	
  E735  D1            		POP	DE		;DPB_10_DIRPS
  E736  6C            		LD	L,H
  E737  2600          		LD	H,0
  E739  19            		ADD	HL,DE		;MAXDIR
  E73A  E5            		PUSH	HL
  E73B  FD4E0D        		LD	C,(IY+13)	;BPB_SecPerClus
  E73E  CB21          		SLA	C		;*2
  E740  AF            		XOR	A
  E741  47            		LD	B,A
  E742  ED42          		SBC	HL,BC
  E744  DD7514        		LD	(IX+014H),L	;DPB_14_ADDCL16
  E747  DD7415        		LD	(IX+015H),H
                      	
  E74A  D1            		POP	DE		;DE=DPB_0B_MAXDIR
  E74B  FD6E13        		LD	L,(IY+19)	;BPB_TotSec16
  E74E  FD6614        		LD	H,(IY+20)
  E751  7C            		LD	A,H
  E752  B5            		OR	L		;ここでCF=0
  E753  3E00          		LD	A,0		;LDでフラグは変化しない。BPB_TotSec16を AHL で扱う為、Aに0を入れる
  E755  2010          		JR	NZ,BPB16BIT
  E757  FD7E23        		LD	A,(IY+35)	;BPB_TotSec16が「0」の場合はBPB_TotSec32で計算
  E75A  B7            		OR	A
  E75B                	NOT_BPB1:
  E75B  C2DAE6        		JP	NZ,NOT_BPB	;念のため(総セクタ数が24ビットを超える場合)
  E75E  FD6E20        		LD	L,(IY+32)	;BPB_TotSec32 は AHL の24ビットで扱う
  E761  FD6621        		LD	H,(IY+33)	;1クラスタの論理セクタ数(DPB_07_SECPCL)が最大128なので
  E764  FD7E22        		LD	A,(IY+34)	;24ビットを超えると必ずクラスタ数が16ビットを超えてしまうのでこれで十分
  E767                	BPB16BIT:
  E767  ED52          		SBC	HL,DE		;CF=0のはず
  E769  DE00          		SBC	A,0
  E76B  FD460D        		LD	B,(IY+13)	;BPB_SecPerClus
  E76E                	BPBTC1:				;総クラスタ数(AHL) = 総セクタ数(AHL) / セクタサイズ(B)
  E76E  CB18          		RR	B		;->CY
  E770  3808          		JR	C,BPBTC2
  E772  CB3F          		SRL	A
  E774  CB1C          		RR	H		;AHL=AHL/2
  E776  CB1D          		RR	L
  E778  18F4          		JR	BPBTC1
  E77A                	BPBTC2:
  E77A  B7            		OR	A
  E77B  20DE          		JR	NZ,NOT_BPB1	;念のため(クラスタ数が16ビットを超える場合)
  E77D  23            		INC	HL
  E77E  23            		INC	HL
  E77F  DD7508        		LD	(IX+8),L	;DPB_08_MAXCL
  E782  DD7409        		LD	(IX+9),H
                      	
  E785  FD7E15        		LD	A,(IY+21)	;BPB_Media
  E788  DD7706        		LD	(IX+6),A	;DPB_06_FATID
                      	
  E78B  DDCB0A7E      		BIT	7,(IX+00AH)	;DPB_0A_FDMODE
  E78F  2817          		JR	Z,NOT_FD
  E791  2E28          		LD	L,40		;MAXCYLの設定（要検討）ここから下はフロッピーのみ書き換える
  E793  FEFD          		CP	0FDH	;2D
  E795  2808          		JR	Z,SETCYL
  E797  2E4D          		LD	L,77
  E799  FEFE          		CP	0FEH	;2HD
  E79B  2802          		JR	Z,SETCYL
  E79D  2E50          		LD	L,80	;その他2DD等
  E79F                	SETCYL:
  E79F  DD750C        		LD	(IX+00CH),L	;DPB_0C_MAXCYL
  E7A2  FD7E18        		LD	A,(IY+24)	;BPB_SecPerTr
  E7A5  DD770D        		LD	(IX+00DH),A	;DPB_0D_MAXSEC
  E7A8                	NOT_FD:
  E7A8  FDE1          		POP	IY
  E7AA  CD89E8        		CALL	CHGDRV2
  E7AD                	RDFAT0X:
  E7AD  CDBCE7        		CALL	RDFATS
  E7B0  D8            		RET	C
  E7B1  DDBE06        		CP	(IX+6)		;DPB_06_FATID
  E7B4  C8            		RET	Z
  E7B5  DDCB126E      		BIT	5,(IX+012H)	;DPB_12_DEVICE
  E7B9  C0            		RET	NZ		;BPBを取得している場合はFATIDをチェックしない
  E7BA  37            		SCF
  E7BB  C9            		RET
                      	
  E7BC                	RDFATS:
  E7BC  CD0EE8        		CALL	FATSETUP
  E7BF  D8            		RET	C
  E7C0                	RDFATL:
  E7C0  C5            		PUSH	BC
  E7C1  CDCDE7        		CALL	DRD16
  E7C4  C1            		POP	BC
  E7C5  D8            		RET	C
  E7C6  10F8          		DJNZ	RDFATL
  E7C8  2A7CEC        		LD	HL,(_FATBF)
  E7CB  7E            		LD	A,(HL)
  E7CC  C9            		RET
                      	
  E7CD                	DRD16:
  E7CD  0E00          		LD	C,0
  E7CF                	DRD24:
  E7CF  0601          		LD	B,1
  E7D1  DDE5          		PUSH	IX
  E7D3  DD2AA8EC      		LD	IX,(_DPB)
  E7D7  CD5BEA        	DRDPAT:	CALL	FDRD		;自己書き換え（ディスク読み込み）
  E7DA                	POP_IX_RET:
  E7DA  DDE1          		POP	IX
  E7DC  C9            		RET
                      	
  E7DD                	DWT16:
  E7DD  0E00          		LD	C,0
  E7DF                	DWT24:
  E7DF  0601          		LD	B,1
  E7E1  DDE5          		PUSH	IX
  E7E3  DD2AA8EC      		LD	IX,(_DPB)
  E7E7  CD4DEA        	DWTPAT:	CALL	FDWT		;自己書き換え（ディスク書き込み）
  E7EA  18EE          		JR	POP_IX_RET
                      	
  E7EC                	WTFAT:
  E7EC  CD0EE8        		CALL	FATSETUP
  E7EF  D405E8        		CALL	NC,WTFATL
  E7F2  D8            		RET	C
  E7F3  DDCB0F7E      		BIT	7,(IX+00FH)	;DPB_0F_BPS
  E7F7  C8            		RET	Z		;予備FATが無い
  E7F8  CD15E8        		CALL	FATS2
  E7FB  E5            		PUSH	HL		;予備FAT
  E7FC  DD6E00        		LD	L,(IX+0)	;DPB_00_FATLN
  E7FF  DD6601        		LD	H,(IX+1)
  E802  19            		ADD	HL,DE
  E803  EB            		EX	DE,HL
  E804  E1            		POP	HL
  E805                	WTFATL:
  E805  C5            		PUSH	BC
  E806  CDDDE7        		CALL	DWT16
  E809  C1            		POP	BC
  E80A  D8            		RET	C
  E80B  10F8          		DJNZ	WTFATL
  E80D  C9            		RET
                      	;------------------------
                      	;FATのセットアップ
                      	;out
                      	;	B  : FATセクタ数
                      	;	DE : FAT先頭セクタ番号
                      	;	HL : FATバッファポインタ
                      	;	CF : 1=ドライブ切り替えエラー
                      	;note
                      	;	FATサイズがFATバッファを超える場合は
                      	;	対象クラスタ領域==(_FATIX)によって
                      	;	FAT12:FATの前半3KBと後半3KBを切り替える
                      	;	FAT16:対象クラスタ1024毎に2KBを切り替える
                      	;------------------------
  E80E                	FATSETUP:
  E80E  3AAAEC        		LD	A,(_FATDRV)
  E811  CD3CE9        		CALL	CHGDRVR		;ドライブ切り替え
  E814  D8            		RET	C
  E815                	FATS2:
  E815  ED5BFAEB      		LD	DE,(_FATPS)	;fat sector pos
  E819  C31CE8        	FATSX:	JP	FATSETUP12	;自己書き換え
                      	
  E81C                	FATSETUP12:
  E81C  2A7CEC        		LD	HL,(_FATBF)
  E81F  3E18          		LD	A,24		;3072 / 256 FATバッファに読み込めるセクタ数
  E821  DD460F        		LD	B,(IX+00FH)	;DPB_0F_BPS
  E824                	L_FATS2:
  E824  1F            		RRA			;CF=0 なので A=A/2
  E825  CB18          		RR	B		;->CF
  E827  30FB          		JR	NC,L_FATS2
                      	
  E829  DD4600        		LD	B,(IX+0)	;DPB_00_FATLN
  E82C  B8            		CP	B
  E82D  D0            		RET	NC		;DPB_00_FATLN x sectorSize < fatBufSize
                      	;targetCluster
  E82E  4F            		LD	C,A		;C = skipCount
  E82F  3AABEC        		LD	A,(_FATIX)	;(targetCluster >= 0x800)
  E832  B7            		OR	A
  E833  2806          		JR	Z,FATS3
                      	;(targerCluster>=0x800)
  E835                	FAT_SKP:
  E835  13            		INC	DE		;FATPS++
  E836  05            		DEC	B		;FATSIZE--
  E837  0D            		DEC	C		;skipCnt--
  E838  20FB          		JR	NZ,FAT_SKP
  E83A  48            		LD	C,B
  E83B                	FATS3:
  E83B  41            		LD	B,C		;3 or 6 or 12
  E83C  AF            		XOR	A
  E83D  C9            		RET
                      	
  E83E                	FATSETUP16:
  E83E  DD7E0F        		LD	A,(IX+00FH)	;DPB_0F_BPS 512=2 1024=4
  E841  0610          		LD	B,16		;2048 / 256 FATバッファに読み込むセクタ数 512=4/1024=2
  E843  67            		LD	H,A		;DPB_0F_BPS
  E844                	L_F16S2:
  E844  CB38          		SRL	B		;/2
  E846  1F            		RRA			;->CF
  E847  30FB          		JR	NC,L_F16S2
                      	
  E849  7C            		LD	A,H		;DPB_0F_BPS
  E84A  2AABEC        		LD	HL,(_FATIX)	;範囲は0-63(0-03FH):65535*2/2048
  E84D  2600          		LD	H,0
  E84F  4D            		LD	C,L		;_FATIX
  E850                	L_F16S3:
  E850  29            		ADD	HL,HL
  E851  87            		ADD	A,A
  E852  CB5F          		BIT	3,A
  E854  28FA          		JR	Z,L_F16S3
                      	
  E856  19            		ADD	HL,DE
  E857  EB            		EX	DE,HL
                      	
  E858  79            		LD	A,C		;_FATIX
  E859  DD6E00        		LD	L,(IX+0)	;DPB_00_FATLN
  E85C  2D            		DEC	L		;DPB_00_FATLN-1
  E85D  AD            		XOR	L		;Lと同じか比較してCFを0に
  E85E  2005          		JR	NZ,F16E		;FATバッファが最後の場合はFATセクタ数を調整
  E860  7D            		LD	A,L		;DPB_00_FATLN-1
  E861  05            		DEC	B
  E862  A0            		AND	B
  E863  47            		LD	B,A
  E864  04            		INC	B
  E865                	F16E:
  E865  2A7CEC        		LD	HL,(_FATBF)
  E868  C9            		RET
                      	
  E869                	CHGDRV:
  E869  E5            		PUSH	HL
  E86A  2189EC        		LD	HL,_DSK
  E86D  BE            		CP	(HL)
  E86E  280A          		JR	Z,CHGDRVE
  E870                	CHGDRV1:
  E870  DDE5          		PUSH	IX
  E872  CD7CE8        		CALL	CHGDRV0
  E875  3A89EC        		LD	A,(_DSK)
  E878  DDE1          		POP	IX
  E87A                	CHGDRVE:
  E87A  E1            		POP	HL
  E87B  C9            		RET
                      	
  E87C                	CHGDRV0:
  E87C  6F            		LD	L,A
  E87D  CDDCEC        		CALL	_GETDPB
  E880  D8            		RET	C
  E881  DD22A8EC      		LD	(_DPB),IX
  E885  7D            		LD	A,L
  E886  3289EC        		LD	(_DSK),A
  E889                	CHGDRV2:
  E889  F3            		DI
  E88A  C5            		PUSH	BC
  E88B  D5            		PUSH	DE
  E88C  ED73F1E8      		LD	(SPPAT2+1),SP
                      	
  E890  DDF9          		LD	SP,IX
                      	
  E892  E1            		POP	HL		;DPB_00_FATLN
  E893  E1            		POP	HL		;DPB_02_DRD
  E894  22D8E7        		LD	(DRDPAT+1),HL
                      	
  E897  E1            		POP	HL
  E898  22E8E7        		LD	(DWTPAT+1),HL	;DPB_04_DWT
                      	
  E89B  E1            		POP	HL		;L=DPB_06_FATID H=DPB_07_SECPCL
  E89C  7C            		LD	A,H
  E89D  324EDF        		LD	(SPCPAT+1),A	;1クラスタの論理セクタ数
  E8A0  3D            		DEC	A
  E8A1  3271E6        		LD	(NCPAT+1),A
                      	
  E8A4  E1            		POP	HL		;DPB_08_MAXCL
  E8A5  7D            		LD	A,L
  E8A6  326DDF        		LD	(CLPAT2+1),A
  E8A9  7C            		LD	A,H
  E8AA  3269DF        		LD	(CLPAT1+1),A
  E8AD  2B            		DEC	HL
  E8AE  226DE1        		LD	(MAXCLP+1),HL
                      	
  E8B1  E1            		POP	HL		;L=DPB_0A_FDMODE H=DPB_0B_DIRSCNT
  E8B2  7D            		LD	A,L
  E8B3  F6FE          		OR	0FEH
  E8B5  32F6E9        		LD	(FDMODE+1),A
  E8B8  07            		RLCA
  E8B9  E603          		AND	3
  E8BB  32DEE9        		LD	(FSPAT+1),A
  E8BE  4C            		LD	C,H
                      	
  E8BF  E1            		POP	HL		;L=DPB_0C_MAXCYL H=DPB_0D_MAXSEC
  E8C0  7D            		LD	A,L
  E8C1  32A1EC        		LD	(_MAXCYL),A
  E8C4  7C            		LD	A,H
  E8C5  3287E9        		LD	(MAXSEC+1),A
                      	
  E8C8  E1            		POP	HL		;L=DPB_0E_FATPS H=DPB_0F_BPS
  E8C9  7C            		LD	A,H		;DPB_0F_BPS
  E8CA  E607          		AND	7
  E8CC  3289E4        		LD	(SECSZ+2),A	;1セクタのサイズの上位1バイト 0x400 - 0x200 - 0x100
  E8CF  3D            		DEC	A		;1セクタ512 2D/2DD/2HC/2HQ(2HD1.44MB)等
                      					;1セクタ1024 2HD/EMM/BRAM
                      					;1セクタ256 GRAM等
                      					;1024	512	256
  E8D0  326ADE        		LD	(SECSZM1+2),A	;3	1	0	1セクタのサイズ-1したものの上位1バイト (0x3FF - 0x1FF - 0xFF)
  E8D3  3C            		INC	A		;4	2	1
  E8D4  87            		ADD	A,A		;8	4	2
  E8D5  87            		ADD	A,A		;010H	8	4
  E8D6  87            		ADD	A,A		;020H	010H	8
  E8D7  32BFDD        		LD	(SDECPAT+1),A	;1セクタ辺りのディレクトリエントリ数
  E8DA  3D            		DEC	A		;01FH	00FH	7
  E8DB  322ED4        		LD	(SDECM1+1),A	;1セクタ辺りのディレクトリエントリ数-1
                      	
  E8DE  2600          		LD	H,0
  E8E0  22FAEB        		LD	(_FATPS),HL
                      	
  E8E3  E1            		POP	HL		;L=DPB_10_DIRPS
  E8E4  22FCEB        		LD	(_DIRPS),HL
                      	
  E8E7  E1            		POP	HL		;L=DPB_12_DEVICE H=DPB_13_UNITNO
  E8E8  7C            		LD	A,H
  E8E9  3284EC        		LD	(_DRIVE),A
                      	
  E8EC  E1            		POP	HL		;DPB_14_ADDCL16
  E8ED  225EDF        		LD	(CLSPAT+1),HL
                      	
  E8F0  310000        	SPPAT2:	LD	SP,0		;元のSPを復元
  E8F3  FB            		EI
  E8F4  2AFCEB        		LD	HL,(_DIRPS)
  E8F7  0600          		LD	B,0
  E8F9  09            		ADD	HL,BC
  E8FA  22DADD        		LD	(MD_PAT+1),HL
                      	
  E8FD  2A6DE1        		LD	HL,(MAXCLP+1);
  E900  11F60F        		LD	DE,4086
  E903  B7            		OR	A
  E904  ED52          		SBC	HL,DE
  E906  300F          		JR	NC,SETFAT16
  E908  21F7E5        		LD	HL,GNCL		;FAT12
  E90B  111AE6        		LD	DE,SNCL
  E90E  011CE8        		LD	BC,FATSETUP12
  E911  DDCB0FAE      		RES	5,(IX+00FH)	;DPB_0F_BPS(FAT12)
  E915  180D          		JR	EXTRA1
  E917                	SETFAT16:
  E917  214EE6        		LD	HL,GNCL16	;FAT16
  E91A  115BE6        		LD	DE,SNCL16
  E91D  013EE8        		LD	BC,FATSETUP16
  E920  DDCB0FEE      		SET	5,(IX+00FH)	;DPB_0F_BPS(FAT16)
  E924                	EXTRA1:
  E924  22F8EC        		LD	(GNCPAT+1),HL
  E927  ED53FBEC      		LD	(SNCPAT+1),DE
  E92B  ED431AE8      		LD	(FATSX+1),BC
  E92F  D1            		POP	DE
  E930  C1            		POP	BC
  E931  AF            		XOR	A
  E932  C9            		RET
                      	
  E933                	GETDPBD:
  E933  DDE3          		EX	(SP),IX
  E935  DDE5          		PUSH	IX
  E937  3A88EC        		LD	A,(_DRV)
  E93A  1807          		JR	GETDPB1
                      	
  E93C                	CHGDRVR:
  E93C  CDD9EC        		CALL	_CHGDRV
  E93F  D8            		RET	C
  E940  3A89EC        		LD	A,(_DSK)
  E943                	GETDPB1:
  E943  C3DCEC        		JP	_GETDPB
                      	
  E946                	GETDPB:
  E946  FE08          		CP	8
  E948  3F            		CCF
  E949  D8            		RET	C
  E94A  0F            		RRCA
  E94B  0F            		RRCA
  E94C  0F            		RRCA
  E94D  DD            		DB	0DDH		;Z80未定義命令
  E94E  6F            		LD	L,A		;LD	IXL,A
  E94F  DD            		DB	0DDH		;Z80未定義命令
  E950  26ED          		LD	H,DEVICE/256	;LD	IXH,DEVICE/256
  E952  DD7E00        		LD	A,(IX+0)	;DPB_00_FATLN
  E955  B7            		OR	A		;CF=0の為
  E956  DDCB0F76      		BIT	6,(IX+00FH)	;DPB_0F_BPS
  E95A  C0            		RET	NZ		;FAT16
  E95B  DDCB126E      		BIT	5,(IX+012H)	;DPB_12_DEVICE
  E95F  C0            		RET	NZ		;BPB
  E960  FE01          		CP	001H		;A=0 THEN CF=1
  E962  C9            		RET
                      	
  E963                	FFLUSH:
  E963  F5            		PUSH	AF
  E964  3EFF          		LD	A,0FFH
  E966  3239EB        		LD	(SFILE),A
  E969  CD41E5        		CALL	DWTX
  E96C  3EFF          		LD	A,0FFH
  E96E  32A5EC        		LD	(_DBDRV),A
  E971  CD8BE5        		CALL	WTFATX
  E974  AF            		XOR	A
  E975  32ABEC        		LD	(_FATIX),A
  E978  2F            		CPL
  E979  32AAEC        		LD	(_FATDRV),A
  E97C  F1            		POP	AF
  E97D  C9            		RET
                      	
                      	
                      	;LDDISK.ASM
                      	
                      	;	LSX-Dodgers DISK
                      	
                      	
  E97E                	SEEK:
  E97E  7A            		LD	A,D
  E97F  B3            		OR	E
  E980  3E01          		LD	A,001H
  E982  2811          		JR	Z,DIV3
                      	
  E984  0610          		LD	B,16
  E986  0E00          	MAXSEC:	LD	C,000H
  E988  AF            		XOR	A
  E989  EB            		EX	DE,HL
  E98A                	DIV1:
  E98A  29            		ADD	HL,HL
  E98B  8F            		ADC	A,A
  E98C  B9            		CP	C
  E98D  3802          		JR	C,DIV2
  E98F  91            		SUB	C
  E990  2C            		INC	L
  E991                	DIV2:
  E991  10F7          		DJNZ	DIV1
                      	
  E993  3C            		INC	A	;最小のセクタは１固定
  E994  55            		LD	D,L	;Quotient(TRACK)
  E995                	DIV3:
  E995  5F            		LD	E,A	;Remainder
  E996  CB3A          		SRL	D	;CYLINDER
  E998  9F            		SBC	A,A
  E999  E610          		AND	010H	;SIDE
  E99B  4F            		LD	C,A
                      	
  E99C  3A84EC        		LD	A,(_DRIVE)
  E99F  FE04          		CP	4
  E9A1  3F            		CCF
  E9A2  D8            		RET	C
  E9A3  B1            		OR	C
  E9A4  3222EA        		LD	(MOPAT+1),A	;Motor off data
  E9A7  01FC0F        		LD	BC,00FFCH
  E9AA  F680          		OR	080H		;Mortor on
  E9AC  ED79          		OUT	(C),A
                      	
  E9AE  CDF4E9        		CALL	SETMODE
  E9B1  D8            		RET	C
                      	
  E9B2  CD37EA        		CALL	DRIVE
  E9B5  FEFF          		CP	0FFH		;A=0FFH Unknown CYLINDER
  E9B7  CC16EA        		CALL	Z,FDCRES	;Restore
  E9BA  0EF9          		LD	C,0F9H
  E9BC  ED79          		OUT	(C),A		;Currrent CYLINDER
  E9BE  92            		SUB	D
  E9BF  C8            		RET	Z		;No seek
                      	
  E9C0  3A86EC        		LD	A,(_ISEEK)
  E9C3  4F            		LD	C,A
                      	
  E9C4  3AA1EC        		LD	A,(_MAXCYL)	;Max CYLINDER
  E9C7  3D            		DEC	A
  E9C8  BA            		CP	D		;Over CYLINDER
  E9C9  D8            		RET	C
                      	
  E9CA  B9            		CP	C		;for Built-in 2DD
  E9CB  3803          		JR	C,SETM2
  E9CD  78            		LD	A,B		;B=00FH
  E9CE  DBFE          		IN	A,(0FEH)		;2HD mode for 2DD seek
  E9D0                	SETM2:
  E9D0  78            		LD	A,B
  E9D1  DBFD          		IN	A,(0FDH)		;MFM mode
                      	
  E9D3  0EFB          		LD	C,0FBH
  E9D5  ED51          		OUT	(C),D
  E9D7  72            		LD	(HL),D
  E9D8  0E18          		LD	C,018H		;Seek
  E9DA                	FDCCMD2:
  E9DA  3A85EC        		LD	A,(_SEEKSP)
  E9DD  E6FF          	FSPAT:	AND	0FFH
  E9DF  B1            		OR	C
                      	
  E9E0                	FDCCMD:
  E9E0  CD2DEA        		CALL	COMSET
                      	
  E9E3  3E80          	FDCPAT:	LD	A,080H		;FDC COMMAND(Self-rewriting)
  E9E5  E620          		AND	020H		;Write data Write track
  E9E7  3C            		INC	A
                      	
  E9E8                	SST:
  E9E8  0E00          		LD	C,0
  E9EA                	SST1:
  E9EA  0D            		DEC	C		; 4
  E9EB  20FD          		JR	NZ,SST1		;12 * 256 / 4 = About 1ms
  E9ED  3D            		DEC	A
  E9EE  20FA          		JR	NZ,SST1
                      	
  E9F0  3C            		INC	A		;A=1
  E9F1  CDFFE9        		CALL	READY
  E9F4                	SETMODE:
  E9F4  78            		LD	A,B		;B=00FH
  E9F5  DBFF          	FDMODE:	IN	A,(0FFH)		;Floppy mode(2D/2HD) (Self-rewriting)
                      	
  E9F7  78            		LD	A,B
  E9F8  DBFD          		IN	A,(0FDH)		;MFM mode
                      	
  E9FA  CD31EA        		CALL	DELAY0		;Head select time
  E9FD  3E81          		LD	A,081H
  E9FF                	READY:
  E9FF  3209EA        		LD	(WAITA+1),A
  EA02  E5            		PUSH	HL
  EA03  0EF8          		LD	C,0F8H
  EA05  61            		LD	H,C
  EA06                	READY2:
  EA06  ED78          		IN	A,(C)
  EA08  E681          	WAITA:	AND	081H		;NOT READY,BUSY
  EA0A  2808          		JR	Z,READYE
  EA0C  E3            		EX	(SP),HL		;wait 19clock
  EA0D  E3            		EX	(SP),HL		; //
  EA0E  2B            		DEC	HL
  EA0F  7C            		LD	A,H
  EA10  B5            		OR	L
  EA11  20F3          		JR	NZ,READY2
  EA13  37            		SCF
  EA14                	READYE:
  EA14  E1            		POP	HL
  EA15  C9            		RET
                      	
  EA16                	FDCRES:
  EA16  3600          		LD	(HL),0
  EA18  0E08          		LD	C,8
  EA1A  18BE          		JR	FDCCMD2
                      	
  EA1C                	FDMOFF:
  EA1C  F5            		PUSH	AF
  EA1D  C5            		PUSH	BC
  EA1E  01FC0F        		LD	BC,00FFCH	;Motor off
  EA21  3E00          	MOPAT:	LD	A,000H		;(Self-rewriting)
  EA23  ED79          		OUT	(C),A
  EA25  C1            		POP	BC
  EA26  F1            		POP	AF
  EA27  C9            		RET
                      	
  EA28                	SECSET:
  EA28  01FA0F        		LD	BC,00FFAH
  EA2B  ED59          		OUT	(C),E
  EA2D                	COMSET:
  EA2D  0EF8          		LD	C,0F8H
  EA2F  ED79          		OUT	(C),A
  EA31                	DELAY0:
  EA31  3E1A          		LD	A,26
  EA33                	DELAY:
  EA33  3D            		DEC	A
  EA34  20FD          		JR	NZ,DELAY
  EA36  C9            		RET
                      	
  EA37                	DRIVE:
  EA37  2A84EC        		LD	HL,(_DRIVE)
  EA3A  26EC          		LD	H,_CYL0/256
  EA3C  CBFD          		SET	7,L
  EA3E  7E            		LD	A,(HL)
  EA3F  C9            		RET
                      	
  EA40                	RNF:
  EA40  CD37EA        		CALL	DRIVE
  EA43  36FF          		LD	(HL),0FFH
  EA45  C9            		RET
                      	
  EA46  02            	RETRY:	DB	2
                      	
                      	
                      	;	FLOPPY DISK DRIVER(DMA)
                      	
                      	
  EA47                	WTTRK:
  EA47  0601          		LD	B,1
  EA49  3EF4          		LD	A,0F4H
  EA4B  1802          		JR	WTTRK1
  EA4D                	FDWT:
  EA4D  3EA0          		LD	A,0A0H
  EA4F                	WTTRK1:
  EA4F  32E4E9        		LD	(FDCPAT+1),A
  EA52  3E10          		LD	A,16
  EA54  180C          		JR	DISK
                      	
  EA56                	DISKOK:
  EA56  0601          	FDCNT:	LD	B,1
  EA58  100B          		DJNZ	DISK1
  EA5A  C9            		RET
                      	
  EA5B                	FDRD:
  EA5B  3E80          		LD	A,080H
  EA5D  32E4E9        		LD	(FDCPAT+1),A
  EA60  3E0E          		LD	A,14
                      	
  EA62                	DISK:
  EA62  3279EA        		LD	(DMAPAT+1),A
  EA65                	DISK1:
  EA65  78            		LD	A,B
  EA66  3257EA        		LD	(FDCNT+1),A
  EA69  22FBEA        		LD	(DMAD+11),HL
  EA6C                	DISKR:
  EA6C  3E02          		LD	A,2		;Retry count
  EA6E  3246EA        		LD	(RETRY),A
  EA71                	DISK2:
  EA71  D5            		PUSH	DE
  EA72  CD7EE9        		CALL	SEEK
  EA75  3843          		JR	C,ERRF
  EA77  F3            		DI
                      	
  EA78  3E0E          	DMAPAT:	LD	A,14		;自己書き換え
  EA7A  21F0EA        		LD	HL,DMAD
  EA7D  CD2CDB        		CALL	SETDMA
  EA80  ED49          		OUT	(C),C		;OUT 01F87H,087H WR6 イネーブル
  EA82  3AE4E9        		LD	A,(FDCPAT+1)
  EA85  C5            		PUSH	BC
  EA86  CD28EA        		CALL	SECSET
  EA89  2AFBEA        		LD	HL,(DMAHL)
  EA8C  23            		INC	HL
  EA8D  1106BB        		LD	DE,0BB06H	;READ DMA
                      	
  EA90  3E03          		LD	A,3
  EA92  CDFFE9        		CALL	READY
  EA95  ED78          		IN	A,(C)
                      	
  EA97  C1            		POP	BC
  EA98  ED51          		OUT	(C),D		;読み出しマスク設定
  EA9A  ED59          		OUT	(C),E		;バイトカウンタ(LH)
  EA9C  ED58          		IN	E,(C)
  EA9E  ED50          		IN	D,(C)
  EAA0  19            		ADD	HL,DE
  EAA1  D1            		POP	DE
  EAA2  13            		INC	DE
  EAA3  FB            		EI
  EAA4  CD1CEA        		CALL	FDMOFF
  EAA7  B7            		OR	A
  EAA8  28AC          		JR	Z,DISKOK
  EAAA  1B            		DEC	DE
  EAAB  CB67          		BIT	4,A
  EAAD  C440EA        		CALL	NZ,RNF
  EAB0                	DISKE2:
  EAB0  2146EA        		LD	HL,RETRY
  EAB3  35            		DEC	(HL)
  EAB4  20BB          		JR	NZ,DISK2
  EAB6  B7            		OR	A
  EAB7  2834          		JR	Z,ERR
  EAB9  D5            		PUSH	DE
  EABA                	ERRF:
  EABA  D1            		POP	DE
  EABB                	DELP:
  EABB  CD40EA        		CALL	RNF
  EABE  CD1CEA        		CALL	FDMOFF
  EAC1  3A85EC        		LD	A,(_SEEKSP)
  EAC4  87            		ADD	A,A
  EAC5  9F            		SBC	A,A
  EAC6  3825          		JR	C,ERR
  EAC8                	DELP1:
  EAC8  D5            		PUSH	DE
  EAC9  21C0EB        		LD	HL,DEMES
  EACC  CD7AD3        		CALL	MSX
  EACF  CD15D7        		CALL	KEYBC
  EAD2                	DELP2:
  EAD2  CDCAEC        		CALL	_INKEY
  EAD5  28FB          		JR	Z,DELP2
                      	
  EAD7  D1            		POP	DE
  EAD8  CD6FDF        		CALL	CAP
  EADB  FE52          		CP	'R'		;Retry
  EADD  CA6CEA        		JP	Z,DISKR
  EAE0  FE49          		CP	'I'		;Ignore
  EAE2  2807          		JR	Z,IGNORE
  EAE4  FE41          		CP	'A'		;Abort
  EAE6  20E0          		JR	NZ,DELP1
  EAE8  C300EB        		JP	BOOT
  EAEB                	IGNORE:
  EAEB  3EFF          		LD	A,0FFH
  EAED                	ERR:
  EAED  BF            		CP	A
  EAEE  37            		SCF
  EAEF  C9            		RET
                      	
                      				;X1turbo DISK DMA
  EAF0  C3            	DMAD:	DB	0C3H	;WR6 リセット
  EAF1  7D            		DB	07DH	;WR0 ポートA→ポートB 転送
  EAF2  FB0F          		DW	00FFBH	;ポートA開始アドレス FDC データレジスタ
  EAF4  FFFF          		DW	0FFFFH	;ブロック長(転送サイズ-1)
  EAF6  2C            		DB	02CH	;WR1 ポートAアドレス固定 I/O
  EAF7  10            		DB	010H	;WR2 ポートBインクリメント
  EAF8  80            		DB	080H	;WR3
  EAF9  92            		DB	092H	;WR5 WAIT RDY:LOW
  EAFA  8D            		DB	08DH	;WR4 バイト ポートB開始アドレス(LH)
  EAFB  0000          	DMAHL:	DW	0	;ポートB開始アドレス
  EAFD  CF            		DB	0CFH	;WR6 ロード
  EAFE  01            		DB	001H	;WR0 ポートB←ポートB 転送
  EAFF  CF            		DB	0CFH	;WR6 ロード
                      	
  EB00                	DMAE:
                      	
  1F84                	AT_R	EQU	WTTRK-AT_WTTRK
                      	
                      	;LDCALL.ASM
                      	
                      	;	LSX-Dodgers TABLES
                      	;
                      	;	CP/M互換BIOS
                      	;	BOOT:アドレス下位1バイトが0になるように
  EB00                	BOOT:
  EB00  C30000        		JP	0
  EB03                	_SYS00:		;(BDOS)プログラム終了
  EB03                	WBOOT:
  EB03  C30BCC        		JP	WBOOT1
  EB06                	CONST_:
  EB06  C3CFD7        		JP	CONSTX
  EB09                	_SYS07:		;(BDOS)コンソール直接入力
  EB09                	CONIN:
  EB09  C376D7        		JP	FLGET
  EB0C                	CONOUT:
  EB0C  C318DA        		JP	CONOUT1
                      	
  EB0F                	DECBF:
  EB0F                		DS	5
  EB14  00            	FDRV	DB	0
  EB15                	FNAME	DS	36
  EB39                	SFILE:	DS	33		;DRV FILENAME
  EB5A                	HLBUF:	DS	3		;Random record buffer
                      	
  EB5D  0000          	LEFTX:	DW	0
  EB5F  0000          	DTAX:	DW	0
                      	
  EB61  008E01000B000C	BEEPD:	DB	0,08EH,1,0,00BH,0,00CH,010H
  EB69  073E08100D00FF		DB	007H,03EH,008H,010H,00DH,0,0FFH
                      	
  EB70  00            	CHECK:	DB	0
                      	
  EB71  4F4B24        	OK:	DB	"OK$"
  EB74  536B697024    	SKIP:	DB	"Skip$"
  EB79  4572726F722124	COMERM:	DB	"Error!$"
                      	
                      	;	CTRLTB:アドレス下位1バイトが080Hになるように
                      	
  EB80                	CTRLTB:
  EB80  54D9EFD98CD9DE		DW	PRINTE,CTRL01,CTRL02,CTRL03
  EB88  D8DAB7D9B7DA3E		DW	CTRL04,CTRL05,CTRL1A,CTRL07
  EB90  60D97DD9E1DAF5		DW	CTRL08,CTRL09,CTRL0A,CTRL0B
  EB98  B4DADBD9F6DA54		DW	CTRL0C,CTRL0D,CTRL0E,PRINTE
  EBA0  54D954D9EFD954		DW	PRINTE,PRINTE,CTRL01,PRINTE
  EBA8  54D954D954D954		DW	PRINTE,PRINTE,PRINTE,PRINTE
  EBB0  54D954D9B7DAFC		DW	PRINTE,PRINTE,CTRL1A,CTRL1B
  EBB8  77D960D96AD9E1		DW	CTRL1C,CTRL1D,CTRL1E,CTRL1F
                      	
  EBC0  0307          	DEMES:	DB	3,7
  EBC2  44657669636520		DB	"Device I/O Error",5,3
  EBD4  41626F72742052		DB	"Abort Retry Ignore?",5,3,0
                      	
  EBEA  1617          	SDDATA:	DB	22,23		;(FCB)ファイルを最後に変更した時刻
  EBEC  1415          		DB	20,21		;(FCB)ファイルを最後に変更した日付
  EBEE  1A1B          		DB	26,27		;(FCB)ファイルの先頭クラスタ
  EBF0  10111213      		DB	16,17,18,19	;(FCB)ファイルのサイズ(バイト単位)
  EBF4                	SDDATAE:
                      	
  EBF4                	SCDIR:	DS	2		;+14 +15
  EBF6                	SFBPS:	DS	2		;FBPS
  EBF8                	SFNDF:	DS	2		;FILEN DIRF
                      	
  EBFA  0000          	_FATPS:	DW	0
  EBFC  0000          	_DIRPS:	DW	0
  EBFE  0000          	_CLPS:	DW	0
                      	
  EC00                	_PE:
                      	
                      	;	LSX-Dodgers SYSTEM CALL
                      	;	STABLE:アドレス下位1バイトが0になるように
                      	
  EC00                	STABLE:
                      	;0
  EC00  03EB49D755D7EC		DW	_SYS00,_SYS01,_SYS02,_SYS03
  EC08  69D369D35AD709		DW	_SYS04,_SYS05,_SYS06,_SYS07
  EC10  62D76BD39BD7C7		DW	_SYS08,_SYS09,_SYS0A,_SYS0B
  EC18  80D386D395D3A8		DW	_SYS0C,_SYS0D,_SYS0E,_SYS0F
                      	;1
  EC20  FCD34ED4B4D4EA		DW	_SYS10,_SYS11,_SYS12,_SYS13
  EC28  F2D410D52DD525		DW	_SYS14,_SYS15,_SYS16,_SYS17
  EC30  8ED593D598D59E		DW	_SYS18,_SYS19,_SYS1A,_SYS1B
  EC38  69D3C4D569D3C8		DW	_SYS1C,_SYS1D,_SYS1E,_SYS1F
                      	;2
  EC40  69D364D579D5CF		DW	_SYS20,_SYS21,_SYS22,_SYS23
  EC48  EED569D36FE296		DW	_SYS24,_ERROR,_SYS26,_SYS27
  EC50  79D5F7D5DDD7EC		DW	_SYS28,_SYS29,_SYS2A,_SYS2B
  EC58  11D8ECDD69D31A		DW	_SYS2C,_SYS2D,_SYS2E,_SYS2F
                      	;3
  EC60  14D6          		DW	_SYS30
                      	
                      	;LDWORK.ASM
                      	
                      	;	LSX-Dodgers WORK
                      	
  0004                	DDS	EQU	4
  EC62                	DDTB:
  EC62  434F4E20      		DB	"CON "
  EC66  41D4          		DW	OPENDD
  EC68  41555820      		DB	"AUX "
  EC6C  41D4          		DW	OPENDD
  EC6E  50524E20      		DB	"PRN "
  EC72  41D4          		DW	OPENDD
  EC74  4E554C20      		DB	"NUL "
  EC78  41D4          		DW	OPENDD
                      	
  EC7A                		DS	2
  EC7C  00EE          	_FATBF:	DW	FATBF
  EC7E  00FA          	_DTBUF:	DW	DTBUF
                      	
                      	;	_CYL0:アドレス下位1バイトが080Hになるように
  EC80  FF            	_CYL0:	DB	0FFH	;Cylinder
  EC81  FF            	_CYL1:	DB	0FFH	;Cylinder
  EC82  FF            	_CYL2:	DB	0FFH	;Cylinder
  EC83  FF            	_CYL3:	DB	0FFH	;Cylinder
  EC84  00            	_DRIVE:	DB	0	;unit number
  EC85  00            	_SEEKSP:DB	0	;Seek speed
  EC86  FF            	_ISEEK:	DB	0FFH	;
  EC87  00            	_DVSW:	DB	0
  EC88  00            	_DRV:	DB	0
  EC89  FF            	_DSK:	DB	0FFH
  EC8A  8000          	_DTA:	DW	00080H
  EC8C  0000          	_CTC:	DW	0
  EC8E  0000          	_TXADR:	DW	0
  EC90  0000          	_KEYPS	DW	0
  EC92  00FF          	_KEYD	DW	0FF00H
  EC94  C210          	_KEYSP:	DW	010C2H
  EC96  07            	_COLORF:DB	7
  EC97  19            	_LINE:	DB	LINE
                      	
  EC98  0000          	_FCB:	DW	0
  EC9A  0000          	_FBPS:	DW	0	;SEARCH FILES
  EC9C  0000          	_FBAD:	DW	0	;    //
  EC9E  00            	_FBCNT:	DB	0	;    //
  EC9F  00            	_FILEN:	DB	0
  ECA0  00            	_DIRF:	DB	0	;bit7:ディレクトリ bit0-6:セクタインデックス 
  ECA1  00            	_MAXCYL:DB	0
  ECA2  00            	_WTFATF:DB	0	;FATバッファの更新フラグ
  ECA3                			DS	1
  ECA4  00            	_WTDBF:	DB	0	;データバッファの更新フラグ
  ECA5  FF            	_DBDRV:	DB	0FFH	;データバッファにあるデータを読み込んだドライブ
  ECA6  0000          	_DBSEC:	DW	0	;データバッファにあるデータを読み込んだセクタ番号
  ECA8  0000          	_DPB:	DW	0
  ECAA  FF            	_FATDRV:DB	0FFH	;FATバッファに読み込んでいるドライブ
  ECAB  00            	_FATIX:	DB	0	;FATバッファに読み込んでいるインデックス
  ECAC  0000          	_FAKEFREE:	DW	0	;偽の残量（FATサイズが大きくなると重くなるのでその対策）
                      	
  ECAE                		DS	2
                      	
  ECB0  6F5059381F0219	CRTCD:	DB	06FH,050H,059H,038H,01FH,002H,019H,01CH
  ECB8  0007          		DB	000H,007H
  ECBA  30F8B0FF      		DW	0-80*LINE,0-80
  ECBE  0C            		DB	00CH
  ECBF  A0            	WK1FD0:	DB	0A0H
                      	
  ECC0  7FD6          	CTC0:	DW	INTCTCE
  ECC2  7FD6          	CTC1:	DW	INTCTCE
  ECC4  A1D6          	CTC2:	DW	INTCTC2
  ECC6  7FD6          	CTC3:	DW	INTCTCE
  ECC8  63D6          	INTVEC:	DW	INT
                      	
                      	;	JUMP
                      	
  ECCA  C331DC        	_INKEY:	JP	INKEY
  ECCD  C39DD8        	_PRINT:	JP	PRINT
  ECD0  C37CDB        	_SCRN:	JP	SCRN
  ECD3  C3A4DB        	_POS:	JP	POS
  ECD6  C3E0D9        	_LOC:	JP	LOC
  ECD9  C369E8        	_CHGDRV:JP	CHGDRV
  ECDC  C346E9        	_GETDPB:JP	GETDPB
  ECDF  C363E9        	_FFLUSH:JP	FFLUSH
  ECE2  C361E5        	_RDFATX:JP	RDFATX
  ECE5  C37DE6        	_RDFAT:	JP	RDFAT
  ECE8  C347EA        	_WTTRK:	JP	WTTRK
  ECEB  C35BEA        	_FDRD:	JP	FDRD
  ECEE  C34DEA        	_FDWT:	JP	FDWT
  ECF1  C3CDE7        	_DRD:	JP	DRD16
  ECF4  C3DDE7        	_DWT:	JP	DWT16
  ECF7                	_GNCL:
  ECF7  C3F7E5        	GNCPAT:	JP	GNCL		;自己書き換え
  ECFA                	_SNCL:
  ECFA  C31AE6        	SNCPAT:	JP	SNCL		;自己書き換え
  ECFD  C392CC        	_COMANL:JP	COMANL
                      	
  ED00                	WE:
                      	
                      	;LDDPB.ASM
                      	
                      	;	LSX-Dodgers DPB
                      	
  ED00                	DEVICE:
                      	
                      	;	A:
                      	
  ED00  0200          		DW	2	;DPB_00_FATLN
  ED02  EBEC          		DW	_FDRD	;DPB_02_DRD
  ED04  EEEC          		DW	_FDWT	;DPB_04_DWT
  ED06  FD            		DB	0FDH	;DPB_06_FATID
  ED07  02            		DB	2	;DPB_07_SECPCL
  ED08  6401          		DW	356	;DPB_08_MAXCL
  ED0A  FF            		DB	0FFH	;DPB_0A_FDMODE	0FFH=2D / 0FEH=2HD
  ED0B  07            		DB	7	;DPB_0B_DIRSCNT
  ED0C  28            		DB	40	;DPB_0C_MAXCYL
  ED0D  09            		DB	9	;DPB_0D_MAXSEC	Number of sectors
  ED0E  01            		DB	1	;DPB_0E_FATPS
  ED0F  82            		DB	082H	;DPB_0F_BPS
  ED10  0500          		DW	5	;DPB_10_DIRPS
  ED12  A7            		DB	0A7H	;DPB_12_DEVICE	Device Number
  ED13  00            		DB	0	;DPB_13_UNITNO
  ED14  0800          		DW	8	;DPB_14_ADDCL16
  ED16  0000          		DW	0	;DPB_16
  ED18  0000          		DW	0	;DPB_18
  ED1A  0000          		DW	0	;DPB_1A_SDIR
  ED1C  46444430      		DB	"FDD0"	;DPB_1C_NAME
                      	
                      	;	B:
                      	
  ED20  0200          		DW	2	;DPB_00_FATLN
  ED22  EBEC          		DW	_FDRD	;DPB_02_DRD
  ED24  EEEC          		DW	_FDWT	;DPB_04_DWT
  ED26  FD            		DB	0FDH	;DPB_06_FATID
  ED27  02            		DB	2	;DPB_07_SECPCL
  ED28  6401          		DW	356	;DPB_08_MAXCL
  ED2A  FF            		DB	0FFH	;DPB_0A_FDMODE	0FFH=2D / 0FEH=2HD
  ED2B  07            		DB	7	;DPB_0B_DIRSCNT
  ED2C  28            		DB	40	;DPB_0C_MAXCYL
  ED2D  09            		DB	9	;DPB_0D_MAXSEC	Number of sectors
  ED2E  01            		DB	1	;DPB_0E_FATPS
  ED2F  82            		DB	082H	;DPB_0F_BPS
  ED30  0500          		DW	5	;DPB_10_DIRPS
  ED32  A7            		DB	0A7H	;DPB_12_DEVICE	Device Number
  ED33  01            		DB	1	;DPB_13_UNITNO
  ED34  0800          		DW	8	;DPB_14_ADDCL16
  ED36  0000          		DW	0	;DPB_16
  ED38  0000          		DW	0	;DPB_18
  ED3A  0000          		DW	0	;DPB_1A_SDIR
  ED3C  46444431      		DB	"FDD1"	;DPB_1C_NAME
                      	
                      	;	C:
                      	
  ED40  0200          		DW	2	;DPB_00_FATLN
  ED42  EBEC          		DW	_FDRD	;DPB_02_DRD
  ED44  EEEC          		DW	_FDWT	;DPB_04_DWT
  ED46  FD            		DB	0FDH	;DPB_06_FATID
  ED47  02            		DB	2	;DPB_07_SECPCL
  ED48  6401          		DW	356	;DPB_08_MAXCL
  ED4A  FF            		DB	0FFH	;DPB_0A_FDMODE	0FFH=2D / 0FEH=2HD
  ED4B  07            		DB	7	;DPB_0B_DIRSCNT
  ED4C  28            		DB	40	;DPB_0C_MAXCYL
  ED4D  09            		DB	9	;DPB_0D_MAXSEC	Number of sectors
  ED4E  01            		DB	1	;DPB_0E_FATPS
  ED4F  82            		DB	082H	;DPB_0F_BPS
  ED50  0500          		DW	5	;DPB_10_DIRPS
  ED52  A7            		DB	0A7H	;DPB_12_DEVICE	Device Number
  ED53  02            		DB	2	;DPB_13_UNITNO
  ED54  0800          		DW	8	;DPB_14_ADDCL16
  ED56  0000          		DW	0	;DPB_16
  ED58  0000          		DW	0	;DPB_18
  ED5A  0000          		DW	0	;DPB_1A_SDIR
  ED5C  46444432      		DB	"FDD2"	;DPB_1C_NAME
                      	
                      	;	D:
                      	
  ED60  0200          		DW	2	;DPB_00_FATLN
  ED62  EBEC          		DW	_FDRD	;DPB_02_DRD
  ED64  EEEC          		DW	_FDWT	;DPB_04_DWT
  ED66  FD            		DB	0FDH	;DPB_06_FATID
  ED67  02            		DB	2	;DPB_07_SECPCL
  ED68  6401          		DW	356	;DPB_08_MAXCL
  ED6A  FF            		DB	0FFH	;DPB_0A_FDMODE	0FFH=2D / 0FEH=2HD
  ED6B  07            		DB	7	;DPB_0B_DIRSCNT
  ED6C  28            		DB	40	;DPB_0C_MAXCYL
  ED6D  09            		DB	9	;DPB_0D_MAXSEC	Number of sectors
  ED6E  01            		DB	1	;DPB_0E_FATPS
  ED6F  82            		DB	082H	;DPB_0F_BPS
  ED70  0500          		DW	5	;DPB_10_DIRPS
  ED72  A7            		DB	0A7H	;DPB_12_DEVICE
  ED73  03            		DB	3	;DPB_13_UNITNO
  ED74  0800          		DW	8	;DPB_14_ADDCL16
  ED76  0000          		DW	0	;DPB_16
  ED78  0000          		DW	0	;DPB_18
  ED7A  0000          		DW	0	;DPB_1A_SDIR
  ED7C  46444433      		DB	"FDD3"	;DPB_1C_NAME
                      	
                      	;	E:
                      	
  ED80  0000          	EMMFL:	DW	0	;DPB_00_FATLN
  ED82  F0D2          	EMMRD:	DW	EDRD	;DPB_02_DRD
  ED84  ECD2          	EMMWR:	DW	EDWT	;DPB_04_DWT
  ED86  FE            		DB	0FEH	;DPB_06_FATID
  ED87  02            		DB	2	;DPB_07_SECPCL
  ED88  0000          	EMMCL:	DW	0	;DPB_08_MAXCL
  ED8A  00            		DB	0	;DPB_0A_FDMODE
  ED8B  0C            		DB	12	;DPB_0B_DIRSCNT
  ED8C  00            	EMMBL:	DB	0	;DPB_0C_MAXCYL
  ED8D  01            		DB	1	;DPB_0D_MAXSEC
  ED8E  02            		DB	2	;DPB_0E_FATPS
  ED8F  02            		DB	2	;DPB_0F_BPS
  ED90  0A00          		DW	10	;DPB_10_DIRPS
  ED92  06            		DB	6	;DPB_12_DEVICE
  ED93  00            	EMMDV:	DB	0	;DPB_13_UNITNO
  ED94  1200          		DW	18	;DPB_14_ADDCL16
  ED96  0000          		DW	0	;DPB_16
  ED98  0000          		DW	0	;DPB_18
  ED9A  0000          		DW	0	;DPB_1A_SDIR
  ED9C  454D4D30      		DB	"EMM0"	;DPB_1C_NAME
                      	
                      	;	F:
                      	
  EDA0  0000          	BANKFL:	DW	0	;DPB_00_FATLN
  EDA2  87D2          		DW	BDRD	;DPB_02_DRD
  EDA4  83D2          		DW	BDWT	;DPB_04_DWT
  EDA6  F9            		DB	0F9H	;DPB_06_FATID
  EDA7  02            		DB	2	;DPB_07_SECPCL
  EDA8  0000          	BANKCL:	DW	0	;DPB_08_MAXCL
  EDAA  00            		DB	0	;DPB_0A_FDMODE
  EDAB  08            		DB	8	;DPB_0B_DIRSCNT
  EDAC  00            		DB	0	;DPB_0C_MAXCYL
  EDAD  01            		DB	1	;DPB_0D_MAXSEC
  EDAE  00            		DB	0	;DPB_0E_FATPS
  EDAF  02            		DB	2	;DPB_0F_BPS
  EDB0  0200          		DW	2	;DPB_10_DIRPS
  EDB2  0B            		DB	00BH	;DPB_12_DEVICE
  EDB3  00            		DB	0	;DPB_13_UNITNO
  EDB4  0600          		DW	6	;DPB_14_ADDCL16
  EDB6  0000          		DW	0	;DPB_16
  EDB8  0000          		DW	0	;DPB_18
  EDBA  0000          		DW	0	;DPB_1A_SDIR
  EDBC  4252414D      		DB	"BRAM"	;DPB_1C_NAME
                      	
                      	;	G:
                      	
  EDC0  0100          		DW	1	;DPB_00_FATLN
  EDC2  44D2          		DW	GDRD	;DPB_02_DRD
  EDC4  5BD2          		DW	GDWT	;DPB_04_DWT
  EDC6  F9            		DB	0F9H	;DPB_06_FATID
  EDC7  04            		DB	4	;DPB_07_SECPCL
  EDC8  3000          		DW	48	;DPB_08_MAXCL
  EDCA  00            		DB	0	;DPB_0A_FDMODE
  EDCB  04            		DB	4	;DPB_0B_DIRSCNT
  EDCC  00            		DB	0	;DPB_0C_MAXCYL
  EDCD  01            		DB	1	;DPB_0D_MAXSEC
  EDCE  00            		DB	0	;DPB_0E_FATPS
  EDCF  01            		DB	1	;DPB_0F_BPS
  EDD0  0400          		DW	4	;DPB_10_DIRPS
  EDD2  05            		DB	5	;DPB_12_DEVICE
  EDD3  01            		DB	1	;DPB_13_UNITNO
  EDD4  0000          		DW	0	;DPB_14_ADDCL16
  EDD6  0000          		DW	0	;DPB_16
  EDD8  0000          		DW	0	;DPB_18
  EDDA  0000          		DW	0	;DPB_1A_SDIR
  EDDC  4752414D      		DB	"GRAM"	;DPB_1C_NAME
                      	
                      	
                      	
  EDE0  00            	LDEND:	DB	0
                      	
  EDE1                		END
