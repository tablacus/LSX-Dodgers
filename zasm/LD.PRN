			  Z80 ASSEMBLER - ZASM VER 1.6
                      	;	LSX-Dodgers for X1/turbo/Z
                      	;	Programmed by
                      	;	Gaku (Lovers/Tablacus)
                      	;LDDEF.ASM
                      	
                      	;	LSX-Dodgers DEF
                      	
  1D00                	MAC	EQU	01D00H		;X1
  0001                	VER_1   EQU	1
  0004                	VER_2   EQU	4
  0002                	VER_3   EQU	2
  0146                	VER	EQU	VER_1 * 256 + VER_2 * 17 + VER_3
                      	
  0005                	SYSTEM	EQU	00005H
  000F                	JP_HL	EQU	0000FH
  005C                	FCB1	EQU	0005CH
  006C                	FCB2	EQU	0006CH
  005D                	FCB1FN	EQU	FCB1+1
  006D                	FCB2FN	EQU	FCB2+1
  0080                	DTA1	EQU	00080H
                      	
  CB00                	RUN	EQU	0CB00H
  D106                	BDOS	EQU	0D106H
  F200                	FATBF	EQU	0F200H
  FA00                	DTBUF	EQU	0FA00H
  FE00                	KEYBF	EQU	0FE00H
  FF00                	KBUF	EQU	0FF00H
  FFCA                	EXTSP	EQU	0FFCAH
  FFCA                	EXTBIO	EQU	0FFCAH
  FFD9                	TRAP38	EQU	0FFD9H
  0018                	LINE	EQU	24
                      	
                      	
  CAF9                		ORG	RUN-7
                      	
                      	;	MSX BINARY HEADER
  CAF9  FE            		DB	0FEH
                      	;	MSX BINARY START ADDRESS
  CAFA  00CB          		DW	RUN
                      	;	MSX BINARY END ADDRESS
  CAFC  00F2          		DW	LDEND
                      	;	MSX BINARY EXEC ADDRESS
  CAFE  00CB          		DW	RUN
                      	;LDINIT.ASM
                      	
                      	;	LSX-Dodgers INIT
                      	
  CB00  C307CB        		JP	START
  CB03  001D          	MACHINE:DW	MAC
  CB05  4601          	VERSION:DW	VER
                      	
  CB07                	START:
  CB07  F3            		DI
  CB08  ED5E          		IM	2
  CB0A  31CAFF        		LD	SP,EXTSP
  CB0D  CD1BCB        		CALL	INIT		;NZならAUTOEXECを実行
  CB10  210000        		LD	HL,0
  CB13  E5            		PUSH	HL
  CB14  C8            		RET	Z
  CB15  11BBCE        		LD	DE,AUTOD
  CB18  C3FDEF        		JP	_COMANL
                      	
  CB1B                	INIT:
  CB1B  3E1E          		LD	A,01EH
  CB1D  D300          		OUT	(0),A
                      	
  CB1F  010000        		LD	BC,0
  CB22  ED438CEF      		LD	(_CTC),BC
  CB26  01040A        		LD	BC,00A04H
  CB29  CD65CE        		CALL	CHKCTC
  CB2C  010407        		LD	BC,00704H
  CB2F  CD65CE        		CALL	CHKCTC
  CB32  01A81F        		LD	BC,01FA8H
  CB35  CD65CE        		CALL	CHKCTC
  CB38  01A01F        		LD	BC,01FA0H
  CB3B  CD65CE        		CALL	CHKCTC
                      	;
  CB3E                	INISIO:
  CB3E  01911F        		LD	BC,01F91H	;INIT SIO
  CB41  1601          		LD	D,1
  CB43  ED51          		OUT	(C),D
                      	
  CB45  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  CB47  0E93          		LD	C,093H
  CB49  ED51          		OUT	(C),D
  CB4B  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  CB4D  0E99          		LD	C,099H		;INIT SIO
  CB4F  1601          		LD	D,1
  CB51  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  CB53  0E9B          		LD	C,09BH
  CB55  ED51          		OUT	(C),D
  CB57  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
                      	
  CB59  0E80          		LD	C,080H		;INIT DMA
  CB5B  2106C3        		LD	HL,0C306H
  CB5E                	INIDMA:
  CB5E  ED61          		OUT	(C),H
  CB60  2D            		DEC	L
  CB61  20FB          		JR	NZ,INIDMA
                      	
  CB63  3EE4          		LD	A,0E4H
  CB65  CD3FDF        		CALL	COMOUT
  CB68  AF            		XOR	A
  CB69  CD19DF        		CALL	OT49SB
                      	
  CB6C  3EEF          		LD	A,INTVEC/256
  CB6E  ED47          		LD	I,A
                      	
  CB70  ED4B8CEF      		LD	BC,(_CTC)
  CB74  0B            		DEC	BC
  CB75  0B            		DEC	BC
                      	
  CB76  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  CB78  3EC0          		LD	A,CTC0
  CB7A  ED79          		OUT	(C),A
                      	
  CB7C  0C            		INC	C
  CB7D  3E47          		LD	A,047H
  CB7F  ED79          		OUT	(C),A
  CB81  3E0D          		LD	A,13		;Baudrate 9600-13
  CB83  ED79          		OUT	(C),A
                      	
  CB85  79            		LD	A,C
  CB86  D610          		SUB	010H
  CB88  4F            		LD	C,A
                      	;	LD	(SIOAD+1),BC
                      	;	LD	(SIOAD0+1),BC
                      	;	LD	(SIOAD1+1),BC
                      	
  CB89  211DCF        		LD	HL,SIODATA
  CB8C                	SINIT1:
  CB8C  7E            		LD	A,(HL)
  CB8D  23            		INC	HL
  CB8E  FEFF          		CP	0FFH
  CB90  2804          		JR	Z,SINIT2
  CB92  ED79          		OUT	(C),A
  CB94  18F6          		JR	SINIT1
  CB96                	SINIT2:
  CB96  3EE4          		LD	A,0E4H
  CB98  CD3FDF        		CALL	COMOUT
  CB9B  3EC8          		LD	A,INTVEC
  CB9D  CD19DF        		CALL	OT49SB
                      	;
  CBA0  01C41F        		LD	BC,01FC4H
  CBA3  3E0C          		LD	A,00CH
  CBA5  ED79          		OUT	(C),A
                      	
  CBA7  0EC0          		LD	C,0C0H
  CBA9  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
                      	
  CBAB  0C            		INC	C
  CBAC  3E28          		LD	A,40
  CBAE  ED79          		OUT	(C),A
                      	
  CBB0  0C            		INC	C
  CBB1  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
                      	
  CBB3  0C            		INC	C
  CBB4  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
                      	
  CBB6  0EC5          		LD	C,0C5H
  CBB8  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
                      	
  CBBA                	TEXT:
  CBBA  0EB0          		LD	C,0B0H
  CBBC  3E80          		LD	A,080H
  CBBE  ED79          		OUT	(C),A
  CBC0  1607          		LD	D,7
  CBC2  0EB9          		LD	C,0B9H
  CBC4  2116CF        		LD	HL,TEXTDT
  CBC7                	TEXT1:
  CBC7  04            		INC	B
  CBC8  EDA3          		OUTI
  CBCA  0C            		INC	C
  CBCB  15            		DEC	D
  CBCC  20F9          		JR	NZ,TEXT1
  CBCE  01B01F        		LD	BC,01FB0H
  CBD1  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
                      	
  CBD3  0EC4          		LD	C,0C4H
  CBD5  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
                      	
  CBD7  01011A        		LD	BC,01A01H
  CBDA  ED78          		IN	A,(C)
  CBDC  E608          		AND	8
  CBDE  2809          		JR	Z,PRN
  CBE0  0E03          		LD	C,003H
  CBE2  3E0F          		LD	A,00FH
  CBE4  ED79          		OUT	(C),A
  CBE6  01040A        		LD	BC,00A04H
  CBE9                	PRN:
  CBE9  210000        		LD	HL,0
  CBEC  065C          		LD	B,05CH
  CBEE  3EFF          		LD	A,0FFH		;RST 38H
  CBF0  CDA7E1        		CALL	FILL_MEMORY
  CBF3  06A4          		LD	B,0A4H
  CBF5  AF            		XOR	A
  CBF6  CDA7E1        		CALL	FILL_MEMORY
                      	
  CBF9  3EC3          		LD	A,0C3H		;JP
  CBFB  2103EF        		LD	HL,CPM_WBOOT
  CBFE  320000        		LD	(00000H),A
  CC01  220100        		LD	(00001H),HL	;IPL
                      	
  CC04  2A03CB        		LD	HL,(MACHINE)	;3 bit7  DPB Compatible LA(1)
  CC07  220300        		LD	(00003H),HL	;  bit6-0 Machine X1(0)
                      	;				;4 LSX-Dodgers(01DH)
  CC0A  2106D1        		LD	HL,BDOS
  CC0D  320500        		LD	(00005H),A
  CC10  220600        		LD	(00006H),HL	;BDOS
                      	
  CC13  211BDB        		LD	HL,BIOS
  CC16  221900        		LD	(00019H),HL	;BIOS-ROM
                      	
  CC19  21D9FF        		LD	HL,TRAP38	;TRAP38
  CC1C  323800        		LD	(00038H),A
  CC1F  223900        		LD	(00039H),HL	;RST 038H
                      	
  CC22  3EEF          		LD	A,CPM_BOOT/256
  CC24  320B00        		LD	(0000BH),A
                      	
  CC27  3EE9          		LD	A,0E9H		;JP (HL)
  CC29  320F00        		LD	(0000FH),A
                      	
  CC2C  3A7DF0        		LD	A,(_FATBF+1)
  CC2F  321300        		LD	(00013H),A
                      	
  CC32  3A7FF0        		LD	A,(_DTBUF+1)
  CC35  321700        		LD	(00017H),A
                      	
  CC38  3EFE          		LD	A,KEYBF/256
  CC3A  321B00        		LD	(0001BH),A
                      	
  CC3D  3EFF          		LD	A,KBUF/256
  CC3F  321F00        		LD	(0001FH),A
                      	
  CC42  2A05CB        		LD	HL,(VERSION)
  CC45  225A00        		LD	(0005AH),HL
                      	
  CC48  3EE6          		LD	A,0E6H
  CC4A  CD3FDF        		CALL	COMOUT
  CC4D  CD24DF        		CALL	IN49SB
  CC50  F5            		PUSH	AF
  CC51  CD24DF        		CALL	IN49SB
  CC54  F1            		POP	AF
  CC55  F5            		PUSH	AF
  CC56  E612          		AND	012H
  CC58  2005          		JR	NZ,KEYR
  CC5A  3E01          		LD	A,1
  CC5C  32A1CD        		LD	(KEYREP+1),A
  CC5F                	KEYR:
  CC5F  F1            		POP	AF
  CC60  E603          		AND	3
  CC62  280E          		JR	Z,NON
                      	
  CC64  01D03F        		LD	BC,03FD0H
  CC67  ED49          		OUT	(C),C
  CC69  3E37          		LD	A,037H
  CC6B  D3D0          		OUT	(0D0H),A
  CC6D  ED78          		IN	A,(C)
  CC6F  B9            		CP	C
  CC70  2864          		JR	Z,TURBO
  CC72                	NON:
  CC72  2129CF        		LD	HL,AT_SCR1
  CC75  11C9DF        		LD	DE,SCR1
  CC78  01A100        		LD	BC,SCRNX-SCR1	;転送先のサイズ確認用
  CC7B  019F00        		LD	BC,AT_SCRE-AT_SCR1
  CC7E  EDB0          		LDIR
                      	
  CC80  21C8CF        		LD	HL,AT_WTTRK
  CC83  1147EE        		LD	DE,WTTRK
  CC86  01B900        		LD	BC,DMAE-WTTRK	;転送先のサイズ確認用
  CC89  01B100        		LD	BC,AT_CPUE-AT_WTTRK
  CC8C  EDB0          		LDIR
                      	
  CC8E  2179D0        		LD	HL,AT_EDWT
  CC91  11CFD7        		LD	DE,EDWT
  CC94  014C00        		LD	BC,EMME-EDWT	;転送先のサイズ確認用
  CC97  014800        		LD	BC,AT_EMME-AT_EDWT
  CC9A  EDB0          		LDIR
                      	
  CC9C  21A8EE        		LD	HL,AT_DRD+AT_R
  CC9F  22ECEF        		LD	(_FDRD+1),HL
  CCA2  214DEE        		LD	HL,AT_DWT+AT_R
  CCA5  22EFEF        		LD	(_FDWT+1),HL
  CCA8  21E3D7        		LD	HL,AT_EDRD+AT_RE
  CCAB  2282F1        		LD	(EMMRD),HL
  CCAE  21CFD7        		LD	HL,AT_EDWT+AT_RE
  CCB1  2284F1        		LD	(EMMWR),HL
                      	
  CCB4  3E27          		LD	A,027H			;ノンターボはMFM切り替えを行わない
  CCB6  3212F1        		LD	(DEVICE+012H),A		;Aドライブ
  CCB9  3232F1        		LD	(DEVICE+012H+32),A	;Bドライブ
  CCBC  3252F1        		LD	(DEVICE+012H+32*2),A	;Cドライブ
  CCBF  3272F1        		LD	(DEVICE+012H+32*3),A	;Dドライブ
                      	
  CCC2  210000        		LD	HL,0
  CCC5  226ADF        		LD	(X1PAT),HL
                      	
  CCC8  3EAF          		LD	A,0AFH		;XOR	A
  CCCA  3289DD        		LD	(X1KPAT),A
                      	
  CCCD  216AE0        		LD	HL,SCRNX
  CCD0  22D1EF        		LD	(_SCRN+1),HL
                      	
  CCD3  C35CCD        		JP	NOBANK
                      	
  CCD6                	TURBO:
  CCD6  F3            		DI			;Check BIOS
  CCD7  061D          		LD	B,01DH
  CCD9  ED79          		OUT	(C),A		;BIOS ON
  CCDB  3A512F        		LD	A,(02F51H)
  CCDE  04            		INC	B		;B=01EH
  CCDF  ED79          		OUT	(C),A		;BIOS OFF
  CCE1  FB            		EI
  CCE2  FEC9          		CP	0C9H
  CCE4  280D          		JR	Z,BIOSOK
  CCE6  3EAF          		LD	A,0AFH		;XOR	A
  CCE8  3289DD        		LD	(X1KPAT),A
  CCEB  216AE0        		LD	HL,SCRNX
  CCEE  22D1EF        		LD	(_SCRN+1),HL
  CCF1  1805          		JR	NOBIOS
  CCF3                	BIOSOK:
  CCF3  3EC3          		LD	A,0C3H		;JP
  CCF5  321800        		LD	(00018H),A
  CCF8                	NOBIOS:
  CCF8  3E1F          		LD	A,01FH		;スタートポート
  CCFA  DBF0          		IN	A,(0F0H)
  CCFC  0F            		RRCA
  CCFD  380B          		JR	C,CRT1
  CCFF  2106CF        		LD	HL,_C8025H
  CD02  11B0EF        		LD	DE,CRTCD
  CD05  011000        		LD	BC,16
  CD08  EDB0          		LDIR
  CD0A                	CRT1:
  CD0A  3E1F          		LD	A,01FH		;スタートポート
  CD0C  DBF0          		IN	A,(0F0H)
  CD0E  CB57          		BIT	2,A
  CD10  2818          		JR	Z,BANK
                      	
  CD12  AF            		XOR	A
  CD13                	TZ1:				;前面スイッチが2HDの場合はMFMモードを2HDにしておく
  CD13  F5            		PUSH	AF
  CD14  CDDCEF        		CALL	_GETDPB
  CD17  DD7E12        		LD	A,(IX+012H)	;DPB_12_DEVICE
  CD1A  E68F          		AND	08FH
  CD1C  FE87          		CP	087H		;フロッピーでMEM切り替えがON
  CD1E  2004          		JR	NZ,TZ2
  CD20  DDCB0A86      		RES	0,(IX+0AH)	;(DPB_0A_FDMODE)
  CD24                	TZ2:
  CD24  F1            		POP	AF
  CD25  3C            		INC	A
  CD26  FE08          		CP	8
  CD28  38E9          		JR	C,TZ1
                      	
  CD2A                	BANK:
  CD2A  01000B        		LD	BC,00B00H
  CD2D  21007F        		LD	HL,07F00H
  CD30  F3            		DI
  CD31                	BANK1:
  CD31  ED69          		OUT	(C),L
  CD33  5E            		LD	E,(HL)
  CD34  7B            		LD	A,E
  CD35  C6A5          		ADD	A,0A5H
  CD37  77            		LD	(HL),A
  CD38  BE            		CP	(HL)
  CD39  73            		LD	(HL),E
  CD3A  2005          		JR	NZ,BANK2
  CD3C  2C            		INC	L
  CD3D  CB65          		BIT	4,L
  CD3F  28F0          		JR	Z,BANK1
  CD41                	BANK2:
  CD41  3E10          		LD	A,010H
  CD43  ED79          		OUT	(C),A
  CD45  7D            		LD	A,L
  CD46  B7            		OR	A
  CD47  2813          		JR	Z,NOBANK
  CD49  2600          		LD	H,0
  CD4B  29            		ADD	HL,HL	;*2
  CD4C  29            		ADD	HL,HL	;*4
  CD4D  29            		ADD	HL,HL	;*8
  CD4E  29            		ADD	HL,HL	;*16
  CD4F  29            		ADD	HL,HL	;*32
  CD50  2B            		DEC	HL	;-1
  CD51  2B            		DEC	HL	;-2
  CD52  2B            		DEC	HL	;-3
  CD53  22A8F1        		LD	(BANKCL),HL
  CD56  CDABCE        		CALL	CALC_FATLN
  CD59  32A0F1        		LD	(BANKFL),A
  CD5C                	NOBANK:
  CD5C                	EMM:
  CD5C  CD55CE        		CALL	EADR0
  CD5F  ED78          		IN	A,(C)
  CD61  F5            		PUSH	AF
                      	
  CD62  110000        		LD	DE,0
  CD65                	ECHECK1:
  CD65  13            		INC	DE
  CD66  CD38CE        		CALL	EADR2
  CD69  ED60          		IN	H,(C)
  CD6B  CD38CE        		CALL	EADR2
  CD6E  7C            		LD	A,H
  CD6F  C6E5          		ADD	A,0E5H
  CD71  ED79          		OUT	(C),A
  CD73  3C            		INC	A
  CD74  CD55CE        		CALL	EADR0
  CD77  ED79          		OUT	(C),A
  CD79  3D            		DEC	A
  CD7A  CD38CE        		CALL	EADR2
  CD7D  ED68          		IN	L,(C)
  CD7F  CD38CE        		CALL	EADR2
  CD82  ED61          		OUT	(C),H
  CD84  BD            		CP	L
  CD85  2004          		JR	NZ,ECHECK2
  CD87  CB5A          		BIT	3,D
  CD89  28DA          		JR	Z,ECHECK1
  CD8B                	ECHECK2:
  CD8B  CD55CE        		CALL	EADR0
  CD8E  F1            		POP	AF
  CD8F  ED79          		OUT	(C),A
                      	
  CD91  21F7FF        		LD	HL,0-9
  CD94  19            		ADD	HL,DE
  CD95  3009          		JR	NC,NOEMM
  CD97  2288F1        		LD	(EMMCL),HL
  CD9A  CDABCE        		CALL	CALC_FATLN
  CD9D  3280F1        		LD	(EMMFL),A
  CDA0                	NOEMM:
  CDA0  3E00          	KEYREP:	LD	A,000H
  CDA2  B7            		OR	A
  CDA3  2807          		JR	Z,KEYR1
  CDA5  010000        		LD	BC,0
  CDA8  ED438CEF      		LD	(_CTC),BC
  CDAC                	KEYR1:
  CDAC  CD8CCE        		CALL	SETCRTC
  CDAF  01AA10        		LD	BC,010AAH	;PALET
  CDB2  ED49          		OUT	(C),C
  CDB4  01CC11        		LD	BC,011CCH
  CDB7  ED49          		OUT	(C),C
  CDB9  01F012        		LD	BC,012F0H
  CDBC  ED49          		OUT	(C),C
  CDBE  04            		INC	B
  CDBF  ED71          		DB	0EDH,071H
                      	
  CDC1  0130F8        		LD	BC,0-80*25
  CDC4  2ABAEF        		LD	HL,(CRTCD+10)
  CDC7  ED43BAEF      		LD	(CRTCD+10),BC
  CDCB  1E0C          		LD	E,00CH
  CDCD  CDCDEF        		CALL	_PRINT
  CDD0  22BAEF        		LD	(CRTCD+10),HL
                      	
  CDD3  21C7CE        		LD	HL,INIMES
  CDD6  CD6FD8        		CALL	MSX
                      	
  CDD9  3A87FF        		LD	A,(0FF87H)
  CDDC  FE08          		CP	8
  CDDE  301E          		JR	NC,INIT0
  CDE0  5F            		LD	E,A
  CDE1  C641          		ADD	A,'A'
  CDE3  32C4CE        		LD	(AUTODV),A
  CDE6  0E0E          		LD	C,00EH
  CDE8  CD0500        		CALL	SYSTEM
  CDEB  1C            		INC	E
  CDEC  2185EF        		LD	HL,_SEEKSP	;Disk error Ignore
  CDEF  CBFE          		SET	7,(HL)
  CDF1  0E1B          		LD	C,01BH
  CDF3  CD0500        		CALL	SYSTEM
                      	
  CDF6  2185EF        		LD	HL,_SEEKSP
  CDF9  CBBE          		RES	7,(HL)
                      	
  CDFB  3C            		INC	A
  CDFC  2008          		JR	NZ,INIT1
  CDFE                	INIT0:
  CDFE  1E00          		LD	E,0
  CE00  0E0E          		LD	C,00EH
  CE02  CD0500        		CALL	SYSTEM
  CE05  AF            		XOR	A
  CE06                	INIT1:
  CE06  F3            		DI
  CE07  08            		EX	AF,AF'
  CE08  2EFE          		LD	L,0-2		;CALLのスタック分減らす
  CE0A  39            		ADD	HL,SP
  CE0B  1100FF        		LD	DE,0FF00H
  CE0E  45            		LD	B,L
  CE0F  CD08D5        		CALL	ZERO_MEMORY_DE
  CE12  21CAFF        		LD	HL,EXTSP
  CE15  060F          		LD	B,TRAP38-EXTBIO
  CE17  3EFF          		LD	A,0FFH		;RST 38H
  CE19  CDA7E1        		CALL	FILL_MEMORY
  CE1C  21C1D0        		LD	HL,AT_TRAP38
  CE1F  11D9FF        		LD	DE,TRAP38
  CE22  012700        		LD	BC,AT_TRAPE-AT_TRAP38
  CE25  EDB0          		LDIR
  CE27  08            		EX	AF,AF'
  CE28  B7            		OR	A
  CE29  C8            		RET	Z
                      	
  CE2A  3EE6          		LD	A,0E6H
  CE2C  CD3FDF        		CALL	COMOUT
  CE2F  CD24DF        		CALL	IN49SB
  CE32  CD24DF        		CALL	IN49SB
  CE35  FE1B          		CP	01BH
  CE37  C9            		RET
                      	
  CE38                	EADR2:
  CE38  D5            		PUSH	DE
  CE39  EB            		EX	DE,HL
  CE3A  29            		ADD	HL,HL
  CE3B  29            		ADD	HL,HL
  CE3C  ED4B8BF1      		LD	BC,(EMMBL-1)
  CE40  0E00          		LD	C,0
  CE42  09            		ADD	HL,BC
  CE43  ED4B93F1      		LD	BC,(EMMDV)
  CE47  060D          		LD	B,00DH
  CE49  ED49          		OUT	(C),C
  CE4B  0C            		INC	C
  CE4C  ED69          		OUT	(C),L
  CE4E  0C            		INC	C
  CE4F  ED61          		OUT	(C),H
  CE51  0C            		INC	C
  CE52  EB            		EX	DE,HL
  CE53  D1            		POP	DE
  CE54  C9            		RET
                      	
  CE55                	EADR0:
  CE55  ED4B93F1      		LD	BC,(EMMDV)
  CE59  060D          		LD	B,00DH
  CE5B  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  CE5D  0C            		INC	C
  CE5E  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  CE60  0C            		INC	C
  CE61  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  CE63  0C            		INC	C
  CE64  C9            		RET
                      	
  CE65                	CHKCTC:
  CE65  C5            		PUSH	BC
  CE66  110347        		LD	DE,04703H
  CE69                	INICTC1:
  CE69  0C            		INC	C
  CE6A  ED51          		OUT	(C),D
  CE6C  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  CE6E  1D            		DEC	E
  CE6F  20F8          		JR	NZ,INICTC1
  CE71  C1            		POP	BC
                      	
  CE72  11FA07        		LD	DE,007FAH
  CE75  ED51          		OUT	(C),D
  CE77  ED59          		OUT	(C),E
  CE79  ED78          		IN	A,(C)
  CE7B  BB            		CP	E
  CE7C  C0            		RET	NZ
  CE7D  ED51          		OUT	(C),D
  CE7F  ED51          		OUT	(C),D
  CE81  ED78          		IN	A,(C)
  CE83  BA            		CP	D
  CE84  C0            		RET	NZ
  CE85  03            		INC	BC
  CE86  03            		INC	BC
  CE87  ED438CEF      		LD	(_CTC),BC
  CE8B  C9            		RET
                      	
  CE8C                	SETCRTC:
  CE8C  21B0EF        		LD	HL,CRTCD
  CE8F  AF            		XOR	A
  CE90                	SETCRT1:
  CE90  010018        		LD	BC,01800H
  CE93  ED79          		OUT	(C),A
  CE95  0C            		INC	C
  CE96  04            		INC	B
  CE97  EDA3          		OUTI
  CE99  3C            		INC	A
  CE9A  FE0C          		CP	12
  CE9C  20F2          		JR	NZ,SETCRT1
  CE9E  23            		INC	HL
  CE9F  23            		INC	HL
  CEA0  01031B        		LD	BC,01A03H+00100H
  CEA3  EDA3          		OUTI
  CEA5  01D020        		LD	BC,01FD0H+00100H
  CEA8  EDA3          		OUTI
  CEAA  C9            		RET
                      	
  CEAB                	CALC_FATLN:	;FAT12のクラスタ数から必要なFATサイズを求める(セクタサイズ512)
  CEAB  5D            		LD	E,L
  CEAC  54            		LD	D,H
  CEAD  29            		ADD	HL,HL	;*2
  CEAE  19            		ADD	HL,DE	;*3
  CEAF  CB3C          		SRL	H	;/2
  CEB1  CB1D          		RR	L	;1クラスタ辺り1.5バイト必要
  CEB3  11FF01        		LD	DE,511	;切り上げる
  CEB6  19            		ADD	HL,DE
  CEB7  7C            		LD	A,H
  CEB8  CB3F          		SRL	A
  CEBA  C9            		RET
                      	
  CEBB  4155544F455845	AUTOD:	DB	"AUTOEXEC "
  CEC4  413A00        	AUTODV:	DB	"A:",0
                      	
  CEC7  4C53582D446F64	INIMES:	DB	"LSX-Dodgers for X1/turbo version "
  CEE8  312E          		DB	030H + VER_1, '.'
  CEEA  3432          		DB	030H + VER_2 ,030H + VER_3
  CEEC  2047616B752028		DB	' Gaku (Lovers/Tablacus)',0DH,0AH
  CF05  00            		DB	0
                      	
  CF06                	_C8025H:
  CF06  6B5059881B0119		DB	06BH,050H,059H,088H,01BH,001H,019H,01AH
  CF0E  000F          		DB	000H,00FH
  CF10  80F8B0FF      		DW	0-80*LINE,0-80
  CF14  0C23          		DB	00CH,023H
                      	
  CF16  030C0F30333C3F	TEXTDT:	DB	003H,00CH,00FH,030H,033H,03CH,03FH
                      	
  CF1D                	SIODATA:
  CF1D  18            		DB	018H
  CF1E  0100          		DB	1,0
  CF20  0200          		DB	2,0
  CF22  03C1          		DB	3,0C1H
  CF24  0444          		DB	4,044H
  CF26  05E8          		DB	5,0E8H
  CF28  FF            		DB	0FFH
                      	
                      	;	ノンターボ用パッチ
                      	
  CF29                	AT_SCR1:
  CF29  D9            		EXX
  CF2A  C5            		PUSH	BC
  CF2B  015020        		LD	BC,02000H+80
  CF2E  D9            		EXX
  CF2F  C5            		PUSH	BC
  CF30  010020        		LD	BC,02000H
                      	
  CF33  67            		LD	H,A
  CF34  B7            		OR	A
  CF35                	AT_SCRUP1:
  CF35  2815          		JR	Z,AT_SCRCL
  CF37  C5            		PUSH	BC
  CF38  CBE0          		SET	4,B
  CF3A  D9            		EXX
  CF3B  C5            		PUSH	BC
  CF3C  CBE0          		SET	4,B
  CF3E  D9            		EXX
  CF3F  CD03E0        		CALL	AT_UPSUB+AT_RS
  CF42  D9            		EXX
  CF43  C1            		POP	BC
  CF44  D9            		EXX
  CF45  C1            		POP	BC
  CF46  CD03E0        		CALL	AT_UPSUB+AT_RS
  CF49  25            		DEC	H
  CF4A  18E9          		JR	AT_SCRUP1
                      	
  CF4C                	AT_SCRCL:
  CF4C  215020        		LD	HL,02000H+80
  CF4F  3A96EF        		LD	A,(_COLORF)
  CF52                	AT_SCRCL1:
  CF52  CBE0          		SET	4,B
  CF54  ED61          		OUT	(C),H
  CF56  CBA0          		RES	4,B
  CF58  ED79          		OUT	(C),A
  CF5A  03            		INC	BC
  CF5B  2D            		DEC	L
  CF5C  20F4          		JR	NZ,AT_SCRCL1
  CF5E  C1            		POP	BC
  CF5F  D9            		EXX
  CF60  C1            		POP	BC
  CF61  D9            		EXX
  CF62  C9            		RET
                      	
  CF63                	AT_UPSUB:
  CF63  2E28          		LD	L,40
  CF65                	AT_UPSUB1:
  CF65  D9            		EXX
  CF66  ED78          		IN	A,(C)
  CF68  03            		INC	BC
  CF69  D9            		EXX
  CF6A  ED79          		OUT	(C),A
  CF6C  03            		INC	BC
  CF6D  D9            		EXX
  CF6E  ED78          		IN	A,(C)
  CF70  03            		INC	BC
  CF71  D9            		EXX
  CF72  ED79          		OUT	(C),A
  CF74  03            		INC	BC
  CF75  2D            		DEC	L
  CF76  20ED          		JR	NZ,AT_UPSUB1
  CF78  C9            		RET
                      	
                      	;	FLOPPY DISK DRIVER(CPU)
                      	
  CF79                	DISKC:
  CF79  1B            		DEC	DE
  CF7A  CB5F          		BIT	3,A
  CF7C  C440EE        		CALL	NZ,RNF
  CF7F                	DISKD:
  CF7F  E5            		PUSH	HL
  CF80  2146EE        		LD	HL,RETRY
  CF83  35            		DEC	(HL)
  CF84  E1            		POP	HL
  CF85  203E          		JR	NZ,AT_ERR		;Retry
  CF87  B7            		OR	A
  CF88  283B          		JR	Z,AT_ERR		;Error
                      	
  CF8A                	AT_DELP:
  CF8A  CD40EE        		CALL	RNF
  CF8D  CD1CEE        		CALL	FDMOFF
  CF90  3A85EF        		LD	A,(_SEEKSP)
  CF93  87            		ADD	A,A
  CF94  382E          		JR	C,AT_ERRZ
  CF96                	AT_DELP1:
  CF96  D5            		PUSH	DE
  CF97  21C0F0        		LD	HL,DEMES
  CF9A  CD6FD8        		CALL	MSX
  CF9D  CDEDDB        		CALL	KEYBC
  CFA0                	AT_DELP2:
  CFA0  CDCAEF        		CALL	_INKEY
  CFA3  28FB          		JR	Z,AT_DELP2
                      	
  CFA5  D1            		POP	DE
  CFA6  CD07E4        		CALL	CAP
  CFA9  FE52          		CP	'R'		;Retry
  CFAB  200A          		JR	NZ,AT_DELP3
  CFAD  210000        	DHLPAT:	LD	HL,0
  CFB0  3E02          		LD	A,2
  CFB2  3246EE        		LD	(RETRY),A
  CFB5  B7            		OR	A
  CFB6  C9            		RET
  CFB7                	AT_DELP3:
  CFB7  FE49          		CP	'I'		;Ignore
  CFB9  2807          		JR	Z,AT_IGNORE
  CFBB  FE41          		CP	'A'		;Abort
  CFBD  20D7          		JR	NZ,AT_DELP1
  CFBF  C300EF        		JP	CPM_BOOT
  CFC2                	AT_IGNORE:
  CFC2  3EFF          		LD	A,0FFH
  CFC4                	AT_ERRZ:
  CFC4  BF            		CP	A
  CFC5                	AT_ERR:
  CFC5  3EFF          		LD	A,0FFH
  CFC7  C9            		RET
                      	
  CFC8                	AT_SCRE:
                      	
  CFC8                	AT_WTTRK:
  CFC8  0601          		LD	B,1
  CFCA  3EF0          		LD	A,0F0H
  CFCC  1802          		JR	AT_WTTRK1
  CFCE                	AT_DWT:
  CFCE  3EA0          		LD	A,0A0H
  CFD0                	AT_WTTRK1:
  CFD0  32E4ED        		LD	(FDCPAT+1),A
  CFD3                	DWTBL:
  CFD3  78            		LD	A,B
  CFD4  3293EE        		LD	(AT_WTB+1+AT_R),A
  CFD7  3E02          		LD	A,2		;Retry count
  CFD9  3246EE        		LD	(RETRY),A
                      	
  CFDC                	DWT0:
  CFDC  D5            		PUSH	DE
  CFDD  E5            		PUSH	HL
  CFDE  224EE0        		LD	(DHLPAT+1+AT_RS),HL
  CFE1  CD7EED        		CALL	SEEK		;Write disk
  CFE4  E1            		POP	HL
  CFE5  3838          		JR	C,ERRDW
  CFE7  F3            		DI
  CFE8  3AE4ED        		LD	A,(FDCPAT+1)
  CFEB  CD28EE        		CALL	SECSET
  CFEE  0EFB          		LD	C,0FBH
                      	
  CFF0                	DWT1:
  CFF0  56            		LD	D,(HL)
  CFF1                	DWT2:
  CFF1  78            		LD	A,B
  CFF2  DBF8          		IN	A,(0F8H)
  CFF4  0F            		RRCA
  CFF5  3008          		JR	NC,DWT4
  CFF7  0F            		RRCA
  CFF8  30F7          		JR	NC,DWT2
  CFFA                	DWT3:
  CFFA  ED51          		OUT	(C),D
  CFFC  23            		INC	HL
  CFFD  18F1          		JR	DWT1
                      	
  CFFF                	DWT4:
  CFFF  3D            		DEC	A
  D000  28F8          		JR	Z,DWT3
  D002  3C            		INC	A
  D003  FB            		EI
  D004  D1            		POP	DE
  D005  13            		INC	DE
  D006  CD1CEE        		CALL	FDMOFF
  D009  2808          		JR	Z,DISKOK_WT
  D00B  CD19E0        		CALL	DISKC+AT_RS
  D00E  20CC          		JR	NZ,DWT0
  D010  B7            		OR	A
  D011  2005          		JR	NZ,ERRW
                      	
  D013                	DISKOK_WT:
  D013  0601          	AT_WTB:	LD	B,1
  D015  10BC          		DJNZ	DWTBL
  D017  C9            		RET
                      	
  D018                	ERRW:
  D018  3EFF          		LD	A,0FFH
  D01A                	ERRZ:
  D01A  BF            		CP	A
  D01B  37            		SCF
  D01C  C31CEE        		JP	FDMOFF
                      	
  D01F                	ERRDW:
  D01F  D1            		POP	DE
  D020  CD2AE0        		CALL	AT_DELP+AT_RS
  D023  20B7          		JR	NZ,DWT0
  D025  B7            		OR	A
  D026  20F0          		JR	NZ,ERRW
  D028  C9            		RET
                      	
  D029                	AT_DRD:
  D029  3E80          		LD	A,080H
  D02B  32E4ED        		LD	(FDCPAT+1),A
  D02E                	DRDBL:
  D02E  78            		LD	A,B
  D02F  32EAEE        		LD	(AT_RDB+1+AT_R),A
  D032  3E02          		LD	A,2		;Retry count
  D034  3246EE        		LD	(RETRY),A
  D037                	DRD0:
  D037  D5            		PUSH	DE
  D038  E5            		PUSH	HL
  D039  224EE0        		LD	(DHLPAT+1+AT_RS),HL
  D03C  CD7EED        		CALL	SEEK		;Read disk
  D03F  E1            		POP	HL
  D040  382D          		JR	C,ERRDR
  D042  F3            		DI
  D043  3AE4ED        		LD	A,(FDCPAT+1)
  D046  CD28EE        		CALL	SECSET
  D049  0EFB          		LD	C,0FBH
  D04B                	DRD1:
  D04B  78            		LD	A,B
  D04C  DBF8          		IN	A,(0F8H)
  D04E  0F            		RRCA
  D04F  3008          		JR	NC,DRD3
  D051  0F            		RRCA
  D052  30F7          		JR	NC,DRD1
  D054  EDA2          		INI
  D056  04            		INC	B
  D057  18F2          		JR	DRD1
                      	
  D059                	DRD3:
  D059  B7            		OR	A
  D05A  FB            		EI
  D05B  D1            		POP	DE
  D05C  13            		INC	DE
  D05D  CD1CEE        		CALL	FDMOFF
  D060  2808          		JR	Z,DISKOK_RD
  D062  CD19E0        		CALL	DISKC+AT_RS
  D065  20D0          		JR	NZ,DRD0
  D067  B7            		OR	A
  D068  20AE          		JR	NZ,ERRW
                      	
  D06A                	DISKOK_RD:
  D06A  0601          	AT_RDB:	LD	B,1
  D06C  10C0          		DJNZ	DRDBL
  D06E  C9            		RET
                      	
  D06F                	ERRDR:
  D06F  D1            		POP	DE
  D070  CD2AE0        		CALL	AT_DELP+AT_RS
  D073  20C2          		JR	NZ,DRD0
  D075  B7            		OR	A
  D076  20A0          		JR	NZ,ERRW
  D078  C9            		RET
                      	
  D079                	AT_CPUE:
                      	
                      	
                      	;	EMM DRIVER(CPU)
                      	
                      	
  D079                	AT_EDWT:
  D079  CDF7D7        		CALL	AT_EADR+AT_RE
  D07C                	AT_EDWT0:
  D07C  F5            		PUSH	AF
  D07D  AF            		XOR	A
  D07E                	AT_EDWT1:
  D07E  04            		INC	B
  D07F  EDA3          		OUTI
  D081  04            		INC	B
  D082  EDA3          		OUTI
  D084  3D            		DEC	A
  D085  20F7          		JR	NZ,AT_EDWT1
  D087  13            		INC	DE
  D088  F1            		POP	AF
  D089  3D            		DEC	A
  D08A  20F0          		JR	NZ,AT_EDWT0
  D08C  C9            		RET
                      	
  D08D                	AT_EDRD:
  D08D  CDF7D7        		CALL	AT_EADR+AT_RE
  D090                	AT_EDRD0:
  D090  F5            		PUSH	AF
  D091  AF            		XOR	A
  D092                	AT_EDRD1:
  D092  EDA2          		INI
  D094  04            		INC	B
  D095  EDA2          		INI
  D097  04            		INC	B
  D098  3D            		DEC	A
  D099  20F7          		JR	NZ,AT_EDRD1
  D09B  13            		INC	DE
  D09C  F1            		POP	AF
  D09D  3D            		DEC	A
  D09E  20F0          		JR	NZ,AT_EDRD0
  D0A0  C9            		RET
                      	
  D0A1                	AT_EADR:
  D0A1  C5            		PUSH	BC
  D0A2  D5            		PUSH	DE
  D0A3  EB            		EX	DE,HL
  D0A4  29            		ADD	HL,HL
  D0A5  29            		ADD	HL,HL
  D0A6  0E00          		LD	C,0
  D0A8  3AA1EF        		LD	A,(_MAXCYL)
  D0AB  47            		LD	B,A
  D0AC  09            		ADD	HL,BC
  D0AD  3A84EF        		LD	A,(_DRIVE)
  D0B0  4F            		LD	C,A
  D0B1  060D          		LD	B,00DH
  D0B3  ED49          		OUT	(C),C
  D0B5  0C            		INC	C
  D0B6  ED69          		OUT	(C),L
  D0B8  0C            		INC	C
  D0B9  ED61          		OUT	(C),H
  D0BB  0C            		INC	C
  D0BC  EB            		EX	DE,HL
  D0BD  D1            		POP	DE
  D0BE  F1            		POP	AF
  D0BF  A7            		AND	A	;CF=0
  D0C0  C9            		RET
  D0C1                	AT_EMME:
                      	
  D0C1                	AT_TRAP38:
  D0C1  210000        		LD	HL,0
  D0C4  E3            		EX	(SP),HL
  D0C5  3E24          		LD	A,'$'
  D0C7  CD24DC        		CALL	MSG_A
  D0CA  2B            		DEC	HL
  D0CB  7C            		LD	A,H
  D0CC  CDE8FF        		CALL	PRHX+AT_RT
  D0CF  7D            		LD	A,L
  D0D0                	PRHX:
  D0D0  F5            		PUSH	AF
  D0D1  07            		RLCA
  D0D2  07            		RLCA
  D0D3  07            		RLCA
  D0D4  07            		RLCA
  D0D5  CDF1FF        		CALL	PRHX2+AT_RT
  D0D8  F1            		POP	AF
  D0D9                	PRHX2:
  D0D9  E60F          		AND	00FH
  D0DB  FE0A          		CP	10
  D0DD  3802          		JR	C,PRHX3
  D0DF  C607          		ADD	A,'A'-'0'-10
  D0E1                	PRHX3:
  D0E1  C630          		ADD	A,'0'
  D0E3  C324DC        		JP	MSG_A
  D0E6                		DS	2
  D0E8                	AT_TRAPE:
                      	
  2F18                	AT_RT	EQU	TRAP38-AT_TRAP38
                      	
  D0E8                	INITE:
  D0E8                		DS	BDOS-INITE
                      	
  D106  C31BD8        		JP	BDOS0
  D109                		DS	3	;Reserved
                      	
                      	;LDCCP.ASM
                      	
                      	;	LSX-Dodgers CCP
                      	
  D10C                	WBOOT1:
  D10C  F3            		DI
  D10D  ED7B0600      		LD	SP,(SYSTEM+1)
                      	
  D111  3EEF          		LD	A,INTVEC/256
  D113  ED47          		LD	I,A
                      	
  D115  3EE4          		LD	A,0E4H
  D117  CD3FDF        		CALL	COMOUT
  D11A  3EC8          		LD	A,INTVEC
  D11C  CD19DF        		CALL	OT49SB
                      	
  D11F  3ABCEF        		LD	A,(CRTCD+12)
  D122  B7            		OR	A
  D123  200C          		JR	NZ,SETCRT0
  D125  2180F8        		LD	HL,0-80*LINE
  D128  22BAEF        		LD	(CRTCD+10),HL
  D12B  21B0FF        		LD	HL,0-80
  D12E  22BCEF        		LD	(CRTCD+12),HL
  D131                	SETCRT0:
  D131  21B0EF        		LD	HL,CRTCD
  D134  AF            		XOR	A
  D135                	SETCRT2:
  D135  010018        		LD	BC,01800H
  D138  ED79          		OUT	(C),A
  D13A  0C            		INC	C
  D13B  56            		LD	D,(HL)
  D13C  FE0D          		CP	13
  D13E  3802          		JR	C,SETCRT3
  D140  1600          		LD	D,0
  D142                	SETCRT3:
  D142  ED51          		OUT	(C),D
  D144  23            		INC	HL
  D145  3C            		INC	A
  D146  FE0E          		CP	14
  D148  20EB          		JR	NZ,SETCRT2
                      	
  D14A  01031B        		LD	BC,01A03H+00100H
  D14D  EDA3          		OUTI
  D14F  01D020        		LD	BC,01FD0H+00100H
  D152  EDA3          		OUTI
  D154  2192EF        		LD	HL,_KEYD
  D157  7E            		LD	A,(HL)
  D158  3600          		LD	(HL),0
  D15A  CDEADB        		CALL	KEYBC_IFBREAK
  D15D  3E04          		LD	A,4
  D15F  CD24DC        		CALL	MSG_A
  D162                	COMMAND:
  D162  CD15D2        		CALL	SETDTA1
  D165  3A87EF        		LD	A,(_DVSW)
  D168  C641          		ADD	A,'A'
  D16A  CD24DC        		CALL	MSG_A
  D16D  3E3E          		LD	A,'>'
  D16F  CD24DC        		CALL	MSG_A
  D172  3E50          		LD	A,80
  D174  12            		LD	(DE),A
  D175  CD73DC        		CALL	_SYS0A		;(BDOS)文字列入力
  D178  CDCAD3        		CALL	LTNL
                      	
  D17B  118200        		LD	DE,DTA1+2
  D17E  CDFDEF        		CALL	_COMANL
  D181  30DF          		JR	NC,COMMAND
  D183  1179EF        		LD	DE,COMERM
  D186  CD60D8        		CALL	_SYS09		;(BDOS)文字列出力
  D189  C7            		RST	0
                      	
  D18A                	COMANL:
  D18A  CDFBE0        		CALL	FILE
  D18D  3A19EF        		LD	A,(FNAME+4)
  D190  FE20          		CP	020H
  D192  201C          		JR	NZ,COMB2
  D194  D5            		PUSH	DE
  D195  1115EF        		LD	DE,FNAME
  D198  1A            		LD	A,(DE)
  D199  FE20          		CP	020H
  D19B  2844          		JR	Z,SDVSW
  D19D  1B            		DEC	DE
  D19E  1A            		LD	A,(DE)
  D19F  C6FF          		ADD	A,0FFH
  D1A1  3809          		JR	C,COMB
  D1A3  13            		INC	DE
                      	
  D1A4  21D5D6        		LD	HL,COMTB
  D1A7  0609          		LD	B,COMS
  D1A9  CD7FE3        		CALL	CPNAME
  D1AC                	COMB:
  D1AC  D1            		POP	DE
  D1AD  D20F00        		JP	NC,JP_HL
  D1B0                	COMB2:
  D1B0  EB            		EX	DE,HL
  D1B1  2289D2        		LD	(COMPAT+1),HL
  D1B4  F5            		PUSH	AF
  D1B5  CD35D2        		CALL	CEXE4
  D1B8  F1            		POP	AF
  D1B9  2115EF        		LD	HL,FNAME
  D1BC  116D00        		LD	DE,FCB2+1	;COMMAND NAME
  D1BF  010B00        		LD	BC,11
  D1C2  EDB0          		LDIR
  D1C4  1194D6        		LD	DE,PATHD
  D1C7                	CEX1:
  D1C7  1A            		LD	A,(DE)
  D1C8  FE20          		CP	020H
  D1CA  D8            		RET	C
  D1CB  CDF0E0        		CALL	FILEC
  D1CE  D5            		PUSH	DE
  D1CF  216D00        		LD	HL,FCB2+1	;COMMAND NAME
  D1D2  1115EF        		LD	DE,FNAME
  D1D5  010B00        		LD	BC,11
  D1D8  EDB0          		LDIR
  D1DA  CD35D2        		CALL	CEXE4
  D1DD  D1            		POP	DE
  D1DE  13            		INC	DE
  D1DF  18E6          		JR	CEX1
                      	
  D1E1                	SDVSW:
  D1E1  F1            		POP	AF
  D1E2  3A14EF        		LD	A,(FDRV)
  D1E5  3D            		DEC	A
  D1E6  5F            		LD	E,A
  D1E7  0E0E          		LD	C,00EH		;(BDOS)カレントドライブの設定
  D1E9  1831          		JR	SYSTEM0
                      	
  D1EB                	OPEN1:
  D1EB  2114EF        		LD	HL,FDRV
  D1EE                	OPEN:
  D1EE  0E11          		LD	C,011H		;(BDOS)ファイルの検索
  D1F0                	OPEN3:
  D1F0  D5            		PUSH	DE
  D1F1  116FD6        		LD	DE,DTA_CCP
  D1F4  CD12D2        		CALL	SETDTA
  D1F7  EB            		EX	DE,HL
  D1F8  CD1CD2        		CALL	SYSTEM0
  D1FB  D1            		POP	DE
  D1FC  C9            		RET
                      	
  D1FD                	OPEN2:
  D1FD  0E12          		LD	C,012H
  D1FF  18EF          		JR	OPEN3
                      	
  D201                	DEFCB:				;Z=Ok NZ=Error
  D201  116FD6        		LD	DE,DTA_CCP
  D204  CD1AD2        		CALL	SYSC0F
                      	
  D207  1190D6        		LD	DE,DTA_CCP+33	;(FCB)ランダムレコード
  D20A  0604          		LD	B,4
  D20C  CD08D5        		CALL	ZERO_MEMORY_DE
  D20F  110001        		LD	DE,00100H
  D212                	SETDTA:
  D212  C364DA        		JP	_SYS1A		;(BDOS)DTAの設定
                      	
  D215                	SETDTA1:
  D215  118000        		LD	DE,DTA1
  D218  18F8          		JR	SETDTA
                      	
  D21A                	SYSC0F:
  D21A  0E0F          		LD	C,00FH		;(BDOS)ファイルのオープン
  D21C                	SYSTEM0:
  D21C  CD0500        		CALL	SYSTEM
  D21F  B7            		OR	A
  D220  C9            		RET
                      	
  D221                	C_CD:
  D221  0E5A          		LD	C,5AH
  D223  18F7          		JR	SYSTEM0
                      	
  D225                	S27BUF:
  D225  3A0700        		LD	A,(SYSTEM+2)
  D228  3D            		DEC	A
  D229  E6F8          		AND	0F8H
  D22B  67            		LD	H,A
  D22C  2E00          		LD	L,0
  D22E                	S27DTA:
  D22E  116FD6        		LD	DE,DTA_CCP
  D231                	S27:
  D231  0E27          		LD	C,027H		;(BDOS)ランダムブロック読み込み
  D233  18E7          		JR	SYSTEM0
                      	
  D235                	CEXE4:
  D235  3A14EF        		LD	A,(FDRV)
  D238  325700        		LD	(00057H),A
  D23B  2A22EF        		LD	HL,(FDRV+14)
  D23E  225800        		LD	(00058H),HL
                      	
  D241  211DEF        		LD	HL,FNAME+8
  D244  7E            		LD	A,(HL)
  D245  FE20          		CP	020H
  D247  2007          		JR	NZ,CEXE7
  D249  3E3F          		LD	A,'?'
  D24B  77            		LD	(HL),A
  D24C  23            		INC	HL
  D24D  77            		LD	(HL),A
  D24E  23            		INC	HL
  D24F  77            		LD	(HL),A
  D250                	CEXE7:
  D250  CDEBD1        		CALL	OPEN1
  D253                	CEXE5:
  D253  C0            		RET	NZ
  D254  2A79D6        		LD	HL,(DTA_CCP+1+9)
  D257  7C            		LD	A,H
  D258  CD07E4        		CALL	CAP
  D25B  67            		LD	H,A
  D25C  7D            		LD	A,L
  D25D  CD07E4        		CALL	CAP
  D260  6F            		LD	L,A
  D261  3A78D6        		LD	A,(DTA_CCP+1+8)
  D264  CD07E4        		CALL	CAP
  D267  D642          		SUB	'B'
  D269  282C          		JR	Z,C_BAT
  D26B  3D            		DEC	A		;'C'
  D26C  2805          		JR	Z,C_EXE
  D26E                	CEXE6:
  D26E  CDFDD1        		CALL	OPEN2
  D271  18E0          		JR	CEXE5
                      	
  D273                	C_EXE:
  D273  7C            		LD	A,H
  D274  FE4D          		CP	'M'
  D276  20F6          		JR	NZ,CEXE6
                      	
  D278  CD01D2        		CALL	DEFCB
  D27B  CD25D2        		CALL	S27BUF
  D27E  3D            		DEC	A
  D27F  37            		SCF
  D280  C0            		RET	NZ
  D281  7C            		LD	A,H
  D282  B5            		OR	L
  D283  37            		SCF
  D284  C8            		RET	Z
  D285  CD15D2        		CALL	SETDTA1
  D288  110000        	COMPAT:	LD	DE,0				; self-modifying code
  D28B  ED7B0600      		LD	SP,(SYSTEM+1)
  D28F  67            		LD	H,A				; A=0 in SETDTA1(_SYS1A)
  D290  6F            		LD	L,A
  D291  E5            		PUSH	HL				; push $0000 (reboot address)
  D292  24            		INC	H
  D293  E5            		PUSH	HL				; push $0100 (TPA address)
  D294  C3D3D4        		JP	SETFCB				; and JP $0100
                      	
  D297                	C_BAT:
  D297  114154        		LD	DE,'A'+'T'*256
  D29A  ED52          		SBC	HL,DE
  D29C  20D0          		JR	NZ,CEXE6
                      	
  D29E  F1            		POP	AF
  D29F  F1            		POP	AF
  D2A0  CD01D2        		CALL	DEFCB
  D2A3  210002        		LD	HL,00200H
  D2A6  CD2ED2        		CALL	S27DTA
  D2A9  C6FE          		ADD	A,0FEH
  D2AB  D8            		RET	C
  D2AC  7D            		LD	A,L
  D2AD  B7            		OR	A
  D2AE  37            		SCF
  D2AF  C8            		RET	Z
  D2B0  3C            		INC	A
  D2B1  F5            		PUSH	AF
                      	
  D2B2  CDEDDB        		CALL	KEYBC
  D2B5  3E06          		LD	A,6
  D2B7  CD24DC        		CALL	MSG_A
  D2BA  C1            		POP	BC
  D2BB  210001        		LD	HL,00100H
  D2BE                	BAT1:
  D2BE  A7            		AND	A
  D2BF  05            		DEC	B
  D2C0  C8            		RET	Z
  D2C1  7E            		LD	A,(HL)
  D2C2  FE25          		CP	'%'
  D2C4  280C          		JR	Z,BAT2
  D2C6                	BAT1X:
  D2C6  7E            		LD	A,(HL)
  D2C7  23            		INC	HL
  D2C8  FE1A          		CP	01AH
  D2CA  C8            		RET	Z
  D2CB  FE0A          		CP	00AH
  D2CD  C4D2DB        		CALL	NZ,KEYBS
  D2D0  18EC          		JR	BAT1
                      	
  D2D2                	BAT2:
  D2D2  23            		INC	HL
  D2D3  7E            		LD	A,(HL)
  D2D4  2B            		DEC	HL
  D2D5  D631          		SUB	'1'
  D2D7  38ED          		JR	C,BAT1X
  D2D9  FE09          		CP	9
  D2DB  30E9          		JR	NC,BAT1X
  D2DD  23            		INC	HL
  D2DE  23            		INC	HL
  D2DF  3C            		INC	A
  D2E0  4F            		LD	C,A
  D2E1  ED5B89D2      		LD	DE,(COMPAT+1)
  D2E5                	BAT3:
  D2E5  1A            		LD	A,(DE)
  D2E6  B7            		OR	A
  D2E7  28D5          		JR	Z,BAT1
  D2E9  CDD2E1        		CALL	SPCUT
  D2EC  0D            		DEC	C
  D2ED  2808          		JR	Z,BAT5
  D2EF                	BAT4:
  D2EF  1A            		LD	A,(DE)
  D2F0  FE21          		CP	021H
  D2F2  38F1          		JR	C,BAT3
  D2F4  13            		INC	DE
  D2F5  18F8          		JR	BAT4
  D2F7                	BAT5:
  D2F7  1A            		LD	A,(DE)
  D2F8  FE21          		CP	021H
  D2FA  38C2          		JR	C,BAT1
  D2FC  13            		INC	DE
  D2FD  CDD2DB        		CALL	KEYBS
  D300  18F5          		JR	BAT5
                      	
  D302                	SWITCH:
  D302  1A            		LD	A,(DE)
  D303                	SW1:
  D303  13            		INC	DE
  D304  B9            		CP	C
  D305  1A            		LD	A,(DE)
  D306  C8            		RET	Z
  D307  FE20          		CP	020H
  D309  30F8          		JR	NC,SW1
  D30B                	C_REM:
  D30B  AF            		XOR	A
  D30C  C9            		RET
                      	
  D30D                	C_DEL:
  D30D  CDD3D4        		CALL	SETFCB
  D310  CD3ADC        		CALL	_SYS08		;(BDOS)エコーなしコンソール入力
                      	
  D313  0E13          		LD	C,013H
  D315  180A          		JR	CDEL1		;(BDOS)ファイルの削除
                      	
  D317                	C_REN:
  D317  CDD3D4        		CALL	SETFCB
  D31A  3E10          		LD	A,010H		;ディレクトリも対象にする
  D31C  326900        		LD	(FCB1+13),A	;属性
  D31F  0E17          		LD	C,017H		;(BDOS)ファイル名の変更
  D321                	CDEL1:
  D321  115C00        		LD	DE,FCB1
  D324  CD0500        		CALL	SYSTEM
  D327  C6FF          		ADD	A,0FFH
  D329  C9            		RET
                      	
  D32A                	C_DIR:
  D32A  CDF0E0        		CALL	FILEC
  D32D  2115EF        		LD	HL,FDRV+1
  D330  CD64D6        		CALL	CWILD1
  D333  3EF1          		LD	A,0F1H
  D335  3221EF        		LD	(FDRV+13),A
  D338  CDEBD1        		CALL	OPEN1
  D33B                	CDIR1:
  D33B  B7            		OR	A
  D33C  2008          		JR	NZ,PDSKF
  D33E  CD89D3        		CALL	P_NAME
  D341  CDFDD1        		CALL	OPEN2
  D344  18F5          		JR	CDIR1
                      	
  D346                	PDSKF:
  D346  3A14EF        		LD	A,(FDRV)
  D349  5F            		LD	E,A
  D34A  0E1B          		LD	C,01BH		;(BDOS)ディスク情報の獲得
  D34C  CD0500        		CALL	SYSTEM
  D34F  4F            		LD	C,A		;C←1クラスタ辺りの論理セクタ数
  D350  C601          		ADD	A,001H
  D352  D8            		RET	C		;Aが0FFHだった場合
  D353  3E06          		LD	A,8-2
  D355                	PDS1:				;HL=未使用クラスタの総数
  D355  3C            		INC	A
  D356  CB19          		RR	C
  D358  30FB          		JR	NC,PDS1
  D35A                	PDS2:				;B←論理セクタのサイズの上位8ビット
  D35A  3C            		INC	A
  D35B  CB18          		RR	B
  D35D  30FB          		JR	NC,PDS2
  D35F  47            		LD	B,A
                      	
  D360  110000        		LD	DE,0
  D363                	PDS3:
  D363  29            		ADD	HL,HL
  D364  CB13          		RL	E
  D366  CB12          		RL	D
  D368  10F9          		DJNZ	PDS3
  D36A                	PDSKF1:
  D36A  CD02D4        		CALL	PRDEC_DEHL
  D36D  110BD7        		LD	DE,FREE
  D370  CD60D8        		CALL	_SYS09		;(BDOS)文字列出力
  D373  CDF1D3        		CALL	PUTDRV
  D376  3E5C          		LD	A,05CH
  D378  CD24DC        		CALL	MSG_A
  D37B  2A22EF        		LD	HL,(FDRV+14)	;ディレクトリのクラスタ番号
  D37E  AF            		XOR	A
  D37F  11FEFF        		LD	DE,0-2
  D382  19            		ADD	HL,DE
  D383  23            		INC	HL
  D384  DCFED3        		CALL	C,PRDEC_HL
  D387  1841          		JR	LTNL
                      	
  D389                	P_NAME:
  D389  3A70D6        		LD	A,(DTA_CCP+1)
  D38C  FE2E          		CP	'.'
  D38E  C8            		RET	Z
  D38F  1123D7        		LD	DE,DIRHD
  D392  CD60D8        		CALL	_SYS09		;(BDOS)文字列出力
  D395  3A7BD6        		LD	A,(DTA_CCP+1+00BH)
  D398  F5            		PUSH	AF
  D399  0F            		RRCA
  D39A  9F            		SBC	A,A
  D39B  E60A          		AND	'*'-020H
  D39D  C620          		ADD	A,020H
  D39F  CD24DC        		CALL	MSG_A
  D3A2  CDF1D3        		CALL	PUTDRV
  D3A5  2170D6        		LD	HL,DTA_CCP+1
  D3A8  CD42D4        		CALL	FPRNT
                      	
  D3AB  F1            		POP	AF
  D3AC  CB67          		BIT	4,A
  D3AE  2808          		JR	Z,DIR3
  D3B0  1118D7        		LD	DE,DIRMES
  D3B3  CD60D8        		CALL	_SYS09		;(BDOS)文字列出力
  D3B6  180A          		JR	DIR6
  D3B8                	DIR3:
  D3B8  ED5B8ED6      		LD	DE,(DTA_CCP+1+01EH)
  D3BC  2A8CD6        		LD	HL,(DTA_CCP+1+01CH)
  D3BF  CD02D4        		CALL	PRDEC_DEHL
  D3C2                	DIR6:
  D3C2  3AB1EF        		LD	A,(CRTCD+1)
  D3C5  FE29          		CP	40+1
  D3C7  D464D4        		CALL	NC,PRTTMS
                      	
  D3CA                	LTNL:
  D3CA  1E03          		LD	E,3
  D3CC  C3CDEF        		JP	_PRINT
                      	
  D3CF                	C_PATH:
  D3CF  CDD2E1        		CALL	SPCUT
  D3D2  2194D6        		LD	HL,PATHD
  D3D5  FE21          		CP	021H
  D3D7  300C          		JR	NC,CPATH0
  D3D9                	CPATHP:
  D3D9  7E            		LD	A,(HL)
  D3DA  23            		INC	HL
  D3DB  FE20          		CP	020H
  D3DD  3F            		CCF
  D3DE  30EA          		JR	NC,LTNL
  D3E0  CD24DC        		CALL	MSG_A
  D3E3  18F4          		JR	CPATHP
  D3E5                	CPATH0:
  D3E5  FE3B          		CP	';'
  D3E7  2001          		JR	NZ,CPATH1
  D3E9  13            		INC	DE
  D3EA                	CPATH1:
  D3EA  EB            		EX	DE,HL
  D3EB  014000        		LD	BC,PATHX
  D3EE  EDB0          		LDIR
  D3F0  C9            		RET
                      	
  D3F1                	PUTDRV:
  D3F1  3A14EF        		LD	A,(FDRV)
  D3F4  C640          		ADD	A,'A'-1
  D3F6  CD24DC        		CALL	MSG_A
  D3F9  3E3A          		LD	A,':'
  D3FB                	MSG_AR:
  D3FB  C324DC        		JP	MSG_A
                      	
  D3FE                	PRDEC_HL:
  D3FE  AF            		XOR	A
  D3FF                	PRDEC_AHL:
  D3FF  5F            		LD	E,A
  D400  1600          		LD	D,0
  D402                	PRDEC_DEHL:
  D402  D5            		PUSH	DE
  D403  110FEF        		LD	DE,DECBF
  D406  0605          		LD	B,5
  D408  CD08D5        		CALL	ZERO_MEMORY_DE	;A=0
  D40B  D1            		POP	DE
                      	
  D40C  0E20          		LD	C,32
  D40E                	DEC1:
  D40E  29            		ADD	HL,HL
  D40F  EB            		EX	DE,HL
  D410  ED6A          		ADC	HL,HL
  D412  EB            		EX	DE,HL
  D413  E5            		PUSH	HL
  D414  2113EF        		LD	HL,DECBF+4
  D417  0605          		LD	B,5
  D419                	DEC2:
  D419  7E            		LD	A,(HL)
  D41A  8F            		ADC	A,A
  D41B  27            		DAA
  D41C  77            		LD	(HL),A
  D41D  2B            		DEC	HL
  D41E  10F9          		DJNZ	DEC2
  D420  E1            		POP	HL
  D421  0D            		DEC	C
  D422  20EA          		JR	NZ,DEC1
                      	
  D424  210FEF        		LD	HL,DECBF
  D427  3E20          		LD	A,020H
  D429  0604          		LD	B,4
  D42B                	DEC3:
  D42B  CD38D4        		CALL	DEC4
  D42E  CD38D4        		CALL	DEC4
  D431  23            		INC	HL
  D432  10F7          		DJNZ	DEC3
  D434                	DECX:
  D434  CD38D4        		CALL	DEC4
  D437  AF            		XOR	A
  D438                	DEC4:
  D438  ED6F          		RLD
  D43A  FE20          		CP	020H
  D43C  2802          		JR	Z,DEC5
  D43E  F630          		OR	030H
  D440                	DEC5:
  D440  18B9          		JR	MSG_AR
                      	
  D442                	FPRNT:
  D442  0608          		LD	B,8
  D444  CD55D4        		CALL	P_N1
  D447  7E            		LD	A,(HL)
  D448  C680          		ADD	A,0A0H-020H
  D44A  FEA0          		CP	0A0H
  D44C  2802          		JR	Z,FPR1
  D44E  3E2E          		LD	A,'.'
  D450                	FPR1:
  D450  CD24DC        		CALL	MSG_A
  D453  0603          		LD	B,3
                      	
  D455                	P_N1:
  D455  C5            		PUSH	BC
  D456  E5            		PUSH	HL
  D457  7E            		LD	A,(HL)
  D458  CD13E4        		CALL	CAP3
  D45B  CD24DC        		CALL	MSG_A
  D45E  E1            		POP	HL
  D45F  C1            		POP	BC
  D460  23            		INC	HL
  D461  10F2          		DJNZ	P_N1
  D463  C9            		RET
                      	
  D464                	PRTTMS:
  D464  3E20          		LD	A,020H
  D466  CD24DC        		CALL	MSG_A
                      	
  D469  2A88D6        		LD	HL,(DTA_CCP+1+24)
  D46C  7D            		LD	A,L
  D46D  B7            		OR	A
  D46E  C8            		RET	Z
  D46F  CB3C          		SRL	H
  D471  17            		RLA
  D472  17            		RLA
  D473  17            		RLA
  D474  17            		RLA
  D475  E60F          		AND	00FH
  D477  57            		LD	D,A
  D478  7C            		LD	A,H
  D479  C650          		ADD	A,80
  D47B  CDBED4        		CALL	PRDEC_A
  D47E  3E2D          		LD	A,'-'
  D480  CD24DC        		CALL	MSG_A
  D483  7A            		LD	A,D
  D484  CDBED4        		CALL	PRDEC_A
  D487  3E2D          		LD	A,'-'
  D489  CD24DC        		CALL	MSG_A
  D48C  7D            		LD	A,L
  D48D  E61F          		AND	01FH
  D48F  CDBED4        		CALL	PRDEC_A
                      	
  D492  2A86D6        		LD	HL,(DTA_CCP+1+22)
                      	
  D495  3E20          		LD	A,020H
  D497  CD24DC        		CALL	MSG_A
  D49A  7C            		LD	A,H
  D49B  65            		LD	H,L
  D49C  0603          		LD	B,3
  D49E                	PRTTMS1:
  D49E  1F            		RRA
  D49F  CB1D          		RR	L
  D4A1  10FB          		DJNZ	PRTTMS1
  D4A3  E61F          		AND	01FH
  D4A5  CDBED4        		CALL	PRDEC_A
  D4A8  3E3A          		LD	A,':'
  D4AA  CD24DC        		CALL	MSG_A
  D4AD  7D            		LD	A,L
  D4AE  0F            		RRCA
  D4AF  0F            		RRCA
  D4B0  E63F          		AND	03FH
  D4B2  CDBED4        		CALL	PRDEC_A
  D4B5  3E3A          		LD	A,':'
  D4B7  CD24DC        		CALL	MSG_A
  D4BA  7C            		LD	A,H
  D4BB  E61F          		AND	01FH
  D4BD  87            		ADD	A,A
                      	
                      	;	PRINT10
                      	
  D4BE                	PRDEC_A:
  D4BE  E5            		PUSH	HL
  D4BF  0608          		LD	B,8
  D4C1  4F            		LD	C,A
  D4C2  AF            		XOR	A
  D4C3                	PRTA1:
  D4C3  CB01          		RLC	C
  D4C5  8F            		ADC	A,A
  D4C6  27            		DAA
  D4C7  10FA          		DJNZ	PRTA1
  D4C9  210FEF        		LD	HL,DECBF
  D4CC  77            		LD	(HL),A
  D4CD  AF            		XOR	A
  D4CE  CD34D4        		CALL	DECX
  D4D1  E1            		POP	HL
  D4D2  C9            		RET
                      	
  D4D3                	SETFCB:
  D4D3  CDD2E1        		CALL	SPCUT
  D4D6  1A            		LD	A,(DE)
  D4D7  FE20          		CP	020H
  D4D9  3801          		JR	C,SETFCBA
  D4DB  1B            		DEC	DE
  D4DC                	SETFCBA:
  D4DC  0624          		LD	B,36
  D4DE  215C00        		LD	HL,FCB1
  D4E1  E5            		PUSH	HL
  D4E2  AF            		XOR	A
  D4E3  CDA7E1        		CALL	FILL_MEMORY
  D4E6  E1            		POP	HL
  D4E7  D5            		PUSH	DE
  D4E8  CDC3DA        		CALL	_SYS5C		;(BDOS)ファイル名の解析
  D4EB  216C00        		LD	HL,FCB2
  D4EE  CDC3DA        		CALL	_SYS5C		;(BDOS)ファイル名の解析
  D4F1  E1            		POP	HL
  D4F2  010050        		LD	BC,05000H
  D4F5  118100        		LD	DE,00081H
  D4F8                	SETFCB1:
  D4F8  7E            		LD	A,(HL)
  D4F9  23            		INC	HL
  D4FA  FE20          		CP	020H
  D4FC  3805          		JR	C,SETFCB2
  D4FE  12            		LD	(DE),A
  D4FF  13            		INC	DE
  D500  0C            		INC	C
  D501  10F5          		DJNZ	SETFCB1
  D503                	SETFCB2:
  D503  79            		LD	A,C
  D504  328000        		LD	(DTA1),A
  D507  04            		INC	B
  D508                	ZERO_MEMORY_DE:
  D508  AF            		XOR	A
  D509                	FILL_MEMORY_DE:
  D509  12            		LD	(DE),A
  D50A  13            		INC	DE
  D50B  10FC          		DJNZ	FILL_MEMORY_DE
  D50D  C9            		RET
                      	
  D50E                	C_COPY:
  D50E  CDD3D4        		CALL	SETFCB
  D511  118100        		LD	DE,DTA1+1
  D514  0E2F          		LD	C,'/'
  D516  CD02D3        		CALL	SWITCH
  D519  CD07E4        		CALL	CAP
  D51C  32A4D5        		LD	(SW+1),A
                      	
  D51F  1161EF        		LD	DE,BEEPD
  D522  CDF3E0        		CALL	FILEC2
  D525  216C00        		LD	HL,FCB2
  D528  CDCADA        		CALL	S29X1
                      	
  D52B  3E10          		LD	A,010H
  D52D  326900        		LD	(FCB1+13),A
  D530  216D00        		LD	HL,FCB2+1
  D533  CD64D6        		CALL	CWILD1
  D536                	COPY0:
  D536  CD61D6        		CALL	CWILD
  D539  215C00        		LD	HL,FCB1
  D53C  CDEED1        		CALL	OPEN
  D53F  37            		SCF
  D540                	COPY1:
  D540  C0            		RET	NZ
  D541  CD01D2        		CALL	DEFCB
                      	
  D544  3A7CD6        		LD	A,(DTA_CCP+13)
  D547  CB67          		BIT	4,A
  D549  2824          		JR	Z,COPY1A
                      	
  D54B  215D00        		LD	HL,FCB1+1
  D54E  CD36E5        		CALL	CHKWILD
  D551  3817          		JR	C,COPY9
                      	
  D553  3E20          		LD	A,020H
  D555  325D00        		LD	(FCB1+1),A
  D558  2A89D6        		LD	HL,(DTA_CCP+26)
  D55B  23            		INC	HL
  D55C  226A00        		LD	(FCB1+14),HL
  D55F  18D5          		JR	COPY0
                      	
  D561                	COPYS:
  D561  1174EF        		LD	DE,SKIP
  D564                	COPY8:
  D564  CD60D8        		CALL	_SYS09		;(BDOS)文字列出力
  D567  CDCAD3        		CALL	LTNL
  D56A                	COPY9:
  D56A  CDFDD1        		CALL	OPEN2
  D56D  18D1          		JR	COPY1
                      	
  D56F                	COPY1A:
  D56F  216C00        		LD	HL,FCB2
  D572  1114EF        		LD	DE,FDRV
  D575  0171D6        		LD	BC,DTA_CCP+2
  D578  EDA0          		LDI
  D57A  3E0B          		LD	A,11
  D57C                	COPY2:
  D57C  F5            		PUSH	AF
  D57D  7E            		LD	A,(HL)
  D57E  FE3F          		CP	'?'
  D580  2001          		JR	NZ,COPY3
  D582  0A            		LD	A,(BC)
  D583                	COPY3:
  D583  12            		LD	(DE),A
  D584  03            		INC	BC
  D585  13            		INC	DE
  D586  23            		INC	HL
  D587  F1            		POP	AF
  D588  3D            		DEC	A
  D589  20F1          		JR	NZ,COPY2
  D58B  010500        		LD	BC,16-11
  D58E  EDB0          		LDIR
  D590                	PUTNAME:
  D590  215D00        		LD	HL,FCB1+1
  D593  CD36E5        		CALL	CHKWILD
  D596  300B          		JR	NC,PUTN1
  D598  2115EF        		LD	HL,FDRV+1
  D59B  CD42D4        		CALL	FPRNT
  D59E  3E20          		LD	A,020H
  D5A0  CD24DC        		CALL	MSG_A
  D5A3                	PUTN1:
  D5A3  3E00          	SW:	LD	A,000H
  D5A5  FE54          		CP	'T'
  D5A7  2005          		JR	NZ,CSW1
  D5A9  21C3D5        		LD	HL,SWNE
  D5AC  1807          		JR	SWT1
  D5AE                	CSW1:
  D5AE  FE4E          		CP	'N'
  D5B0  2011          		JR	NZ,SWNE
  D5B2  2161D5        		LD	HL,COPYS
  D5B5                	SWT1:
  D5B5  1114EF        		LD	DE,FDRV
  D5B8  CD1AD2        		CALL	SYSC0F
  D5BB  2801          		JR	Z,SWN1
  D5BD  E9            		JP	(HL)
  D5BE                	SWN1:
  D5BE  CD17D6        		CALL	CTIME
  D5C1  309E          		JR	NC,COPYS
  D5C3                	SWNE:
  D5C3  1114EF        		LD	DE,FDRV
  D5C6  0E16          		LD	C,016H		;(BDOS)ファイルの作成
  D5C8  CD1CD2        		CALL	SYSTEM0
  D5CB  2048          		JR	NZ,COPYE2
  D5CD  67            		LD	H,A		;A=0
  D5CE  6F            		LD	L,A
  D5CF  2235EF        		LD	(FDRV+33),HL	;(FCB)ランダムレコード
  D5D2  2237EF        		LD	(FDRV+35),HL
  D5D5                	COPY6:
  D5D5  CD25D2        		CALL	S27BUF
  D5D8  47            		LD	B,A
  D5D9  3C            		INC	A
  D5DA  2831          		JR	Z,COPYE
  D5DC  7C            		LD	A,H
  D5DD  B5            		OR	L
  D5DE  280C          		JR	Z,COPY7
  D5E0  1114EF        		LD	DE,FDRV
  D5E3  0E26          		LD	C,026H		;(BDOS)ランダムブロック書き込み
  D5E5  CD1CD2        		CALL	SYSTEM0
  D5E8  2023          		JR	NZ,COPYE
  D5EA  10E9          		DJNZ	COPY6
  D5EC                	COPY7:
  D5EC  3A7CD6        		LD	A,(DTA_CCP+13)	;(FCB)属性
  D5EF  3221EF        		LD	(FDRV+13),A
  D5F2  2183D6        		LD	HL,DTA_CCP+20	;(FCB)タイムスタンプ
  D5F5  1128EF        		LD	DE,FDRV+20
  D5F8  010400        		LD	BC,4
  D5FB  EDB0          		LDIR
                      	
  D5FD  1114EF        		LD	DE,FDRV
  D600  0E10          		LD	C,010H		;(BDOS)ファイルのクローズ
  D602  CD1CD2        		CALL	SYSTEM0
  D605  2006          		JR	NZ,COPYE
                      	
  D607  1171EF        		LD	DE,OK
  D60A  C364D5        		JP	COPY8
                      	
  D60D                	COPYE:
  D60D  1114EF        		LD	DE,FDRV
  D610  0E13          		LD	C,013H		;(BDOS)ファイルの削除
  D612  CD0500        		CALL	SYSTEM
  D615                	COPYE2:
  D615  37            		SCF
  D616  C9            		RET
                      	
  D617                	CTIME:
  D617  ED5B83D6      		LD	DE,(DTA_CCP+20)
  D61B  2A28EF        		LD	HL,(FDRV+20)
  D61E  A7            		AND	A
  D61F  ED52          		SBC	HL,DE
  D621  C0            		RET	NZ
  D622  ED5B85D6      		LD	DE,(DTA_CCP+22)
  D626  2A2AEF        		LD	HL,(FDRV+22)
  D629  ED52          		SBC	HL,DE
  D62B  C9            		RET
                      	
  D62C                	C_TYPE:
  D62C  CDD3D4        		CALL	SETFCB
  D62F  215C00        		LD	HL,FCB1
  D632  CDEED1        		CALL	OPEN
  D635  37            		SCF
  D636                	TYPE1:
  D636  C0            		RET	NZ
  D637  CD01D2        		CALL	DEFCB
  D63A  3E06          		LD	A,6
  D63C  CD24DC        		CALL	MSG_A
  D63F                	TYPE2:
  D63F  CD25D2        		CALL	S27BUF
  D642  C6FE          		ADD	A,0FEH
  D644  D8            		RET	C
  D645  7C            		LD	A,H
  D646  B5            		OR	L
  D647  2813          		JR	Z,TYPEE
  D649  010001        		LD	BC,00100H
  D64C                	TYPE3:
  D64C  0A            		LD	A,(BC)
  D64D  03            		INC	BC
  D64E  FE1A          		CP	01AH
  D650  280A          		JR	Z,TYPEE
  D652  CD24DC        		CALL	MSG_A
  D655  2B            		DEC	HL
  D656  7C            		LD	A,H
  D657  B5            		OR	L
  D658  20F2          		JR	NZ,TYPE3
  D65A  18E3          		JR	TYPE2
  D65C                	TYPEE:
  D65C  CDFDD1        		CALL	OPEN2
  D65F  18D5          		JR	TYPE1
                      	
  D661                	CWILD:
  D661  215D00        		LD	HL,FCB1+1
  D664                	CWILD1:
  D664  7E            		LD	A,(HL)
  D665  FE20          		CP	020H
  D667  C0            		RET	NZ
  D668                	CWILD2:
  D668  3E3F          		LD	A,'?'
  D66A  060B          		LD	B,11
  D66C  C3A7E1        		JP	FILL_MEMORY
                      	
  D66F                	DTA_CCP:
  D66F                		DS	37
                      	
  0040                	PATHX	EQU	64
  D694                	PATHD:	DS	PATHX
  D6D4  00            	PATHE:	DB	0
                      	
  0009                	COMS	EQU	9
  D6D5                	COMTB:
  D6D5  44202020      		DB	"D   "	;1
  D6D9  2AD3          		DW	C_DIR
  D6DB  44495220      		DB	"DIR "	;2
  D6DF  2AD3          		DW	C_DIR
  D6E1  434F5059      		DB	"COPY"	;3
  D6E5  0ED5          		DW	C_COPY
  D6E7  43442020      		DB	"CD  "	;4
  D6EB  21D2          		DW	C_CD
  D6ED  44454C20      		DB	"DEL "	;5
  D6F1  0DD3          		DW	C_DEL
  D6F3  50415448      		DB	"PATH"	;6
  D6F7  CFD3          		DW	C_PATH
  D6F9  52454E20      		DB	"REN "	;7
  D6FD  17D3          		DW	C_REN
  D6FF  54595045      		DB	"TYPE"	;8
  D703  2CD6          		DW	C_TYPE
  D705  52454D20      		DB	"REM "	;9
  D709  0BD3          		DW	C_REM
                      	
  D70B  20627974657320	FREE:	DB	" bytes free",9,'$'
  D718  20202020203C44	DIRMES:	DB	"     <DIR>$"
  D723  20203A24      	DIRHD:	DB	"  :$"
                      	
                      	;LDDISK2.ASM
                      	
                      	;	LSX-Dodgers DISK2
                      	
                      	
                      	;	GRAPHIC RAM DISK DRIVER
                      	
                      	
  D727                	GDRD:
  D727  C5            		PUSH	BC
  D728  CD50D7        		CALL	GADR
  D72B  F1            		POP	AF
  D72C                	GDRD1:
  D72C  EDA2          		INI
  D72E  04            		INC	B
  D72F  0C            		INC	C
  D730  20FA          		JR	NZ,GDRD1
  D732  04            		INC	B
  D733  13            		INC	DE
  D734  3D            		DEC	A
  D735  20F5          		JR	NZ,GDRD1
  D737                	GBANK0:
  D737  3ABFEF        		LD	A,(WK1FD0)
  D73A  E6EF          		AND	0EFH		;BANK0
  D73C  181D          		JR	S1FD0
                      	
  D73E                	GDWT:
  D73E  C5            		PUSH	BC
  D73F  CD50D7        		CALL	GADR
  D742  F1            		POP	AF
  D743                	GDWT1:
  D743  04            		INC	B
  D744  EDA3          		OUTI
  D746  0C            		INC	C
  D747  20FA          		JR	NZ,GDWT1
  D749  04            		INC	B
  D74A  13            		INC	DE
  D74B  3D            		DEC	A
  D74C  20F5          		JR	NZ,GDWT1
  D74E  18E7          		JR	GBANK0
                      	
  D750                	GADR:
  D750  0E00          		LD	C,0
  D752  7B            		LD	A,E
  D753  C640          		ADD	A,040H
  D755  47            		LD	B,A
  D756  3ABFEF        		LD	A,(WK1FD0)
  D759  F610          		OR	010H		;BANK1
  D75B                	S1FD0:
  D75B  C5            		PUSH	BC
  D75C  32BFEF        		LD	(WK1FD0),A
  D75F  01D01F        		LD	BC,01FD0H
  D762  ED79          		OUT	(C),A
  D764  C1            		POP	BC
  D765  C9            		RET
                      	
                      	
                      	;	BANK RAM DISK DRIVER
                      	
  D766                	BDWT:
  D766  3E            		DB	03EH	;LD A,??
  D767  37            		SCF
  D768  1802          		JR	BRW
                      	
  D76A                	BDRD:
  D76A  3E            		DB	03EH	;LD A,??
  D76B  A7            		AND	A
  D76C                	BRW:
  D76C  F3            		DI
  D76D  3295D7        		LD	(BRWPAT),A
  D770  ED73B5D7      		LD	(BANKSP+1),SP
  D774  3AB6D7        		LD	A,(BANKSP+2)
  D777  87            		ADD	A,A
  D778  3803          		JR	C,BRW0
  D77A  31CAFF        		LD	SP,EXTSP
  D77D                	BRW0:
  D77D  D9            		EXX		;裏レジスタ
  D77E  C5            		 PUSH	 BC
  D77F  D5            		 PUSH	 DE
  D780  01000B        		 LD	 BC,00B00H	 ;バンクメモリ
  D783  111010        		 LD	 DE,01010H
  D786  D9            		 EXX		;表レジスタ
  D787                	BRW1:
  D787  C5            		PUSH	BC
  D788  D5            		PUSH	DE
  D789  EB            		EX	DE,HL
  D78A  29            		ADD	HL,HL
  D78B  29            		ADD	HL,HL
  D78C  7C            		LD	A,H
  D78D  E60F          		AND	00FH	;バンク
  D78F  65            		LD	H,L
  D790  CB3C          		SRL	H	;/2
  D792  2E00          		LD	L,0
  D794  D9            		EXX		;裏レジスタ
  D795  A7            	BRWPAT:	 AND	 A	;自己書き換え(AND A:読み出し/SCF:書き込み)
  D796  3808          		 JR	 C,BRWT
  D798  57            		 LD	 D,A	 ;D=バンク
  D799  D9            		 EXX		;表レジスタ
  D79A  EB            		EX	DE,HL
  D79B  CDB9D7        		CALL	BTFR
  D79E  1806          		JR	BRW2
  D7A0                	BRWT:
  D7A0  5F            		 LD	E,A	 ;E=バンク
  D7A1  D9            		 EXX		;表レジスタ
  D7A2  CDB9D7        		CALL	BTFR
  D7A5  EB            		EX	DE,HL
  D7A6                	BRW2:
  D7A6  D1            		POP	DE
  D7A7  C1            		POP	BC
  D7A8  13            		INC	DE
  D7A9  10DC          		DJNZ	BRW1
                      	
  D7AB  D9            		EXX		;裏レジスタ
  D7AC  3E10          		 LD	 A,10H
  D7AE  ED79          		 OUT	 (C),A		;メインメモリに切り替える
  D7B0  D1            		 POP	 DE
  D7B1  C1            		 POP	 BC
  D7B2  D9            		 EXX		;表レジスタ
  D7B3  AF            		XOR	A
  D7B4  310000        	BANKSP:	LD	SP,0
  D7B7  FB            		EI
  D7B8  C9            		RET
                      	
                      	;メインメモリ←→バンクメモリ 512バイトの転送を行う
                      	; DE:転送元アドレス
                      	; HL:転送先アドレス
                      	; 裏BC:バンク切り替えポート(0B00H)
                      	; 裏D:転送元バンク(0-0FH:10Hはメインメモリ)
                      	; 裏E:転送先バンク(0-0FH:10Hはメインメモリ)
                      	
  D7B9                	BTFR:
  D7B9  0600          		LD	B,0	;256回ループ(256*2)
  D7BB                	BTFR1:
  D7BB  D9            		EXX		;裏レジスタ
  D7BC  ED51          		 OUT	 (C),D	 ;BANK(MAIN)
  D7BE  D9            		 EXX		;表レジスタ
  D7BF  1A            		LD	A,(DE)
  D7C0  4F            		LD	C,A
  D7C1  13            		INC	DE
  D7C2  1A            		LD	A,(DE)
  D7C3  13            		INC	DE
  D7C4  D9            		EXX		;裏レジスタ
  D7C5  ED59          		 OUT	 (C),E	 ;MAIN(BANK)
  D7C7  D9            		 EXX		;表レジスタ
  D7C8  71            		LD	(HL),C
  D7C9  23            		INC	HL
  D7CA  77            		LD	(HL),A
  D7CB  23            		INC	HL
  D7CC  10ED          		DJNZ	BTFR1
  D7CE  C9            		RET
                      	
                      	;	EMM DRIVER(DMA)
                      	
                      	
  D7CF                	EDWT:
  D7CF  0E0F          		LD	C,15
  D7D1  1802          		JR	EDWT1
  D7D3                	EDRD:
  D7D3  0E0E          		LD	C,14
  D7D5                	EDWT1:
  D7D5  C5            		PUSH	BC
  D7D6  D5            		PUSH	DE
  D7D7  2218D8        		LD	(DMAB),HL
  D7DA  78            		LD	A,B
  D7DB  87            		ADD	A,A
  D7DC  3D            		DEC	A
  D7DD  3211D8        		LD	(DMALEN+1),A
  D7E0  3C            		INC	A
  D7E1  84            		ADD	A,H	;HL(アドレス)を先に進めておく
  D7E2  67            		LD	H,A
  D7E3  EB            		EX	DE,HL
  D7E4  29            		ADD	HL,HL
  D7E5  3AA1EF        		LD	A,(_MAXCYL)
  D7E8  47            		LD	B,A
  D7E9  79            		LD	A,C
  D7EA  0E00          		LD	C,0
  D7EC  09            		ADD	HL,BC
  D7ED  ED4B84EF      		LD	BC,(_DRIVE)
  D7F1  060D          		LD	B,00DH
  D7F3  ED49          		OUT	(C),C
  D7F5  0C            		INC	C
  D7F6  ED69          		OUT	(C),L
  D7F8  0C            		INC	C
  D7F9  ED61          		OUT	(C),H
                      	
  D7FB  210CD8        		LD	HL,EDMAD
  D7FE  CDF5DF        		CALL	SETDMA
  D801  CD1DE0        		CALL	GO_DMA
  D804  EB            		EX	DE,HL
  D805  D1            		POP	DE
  D806  C1            		POP	BC
  D807                	DMA_ADD_SEC:
  D807  13            		INC	DE
  D808  10FD          		DJNZ	DMA_ADD_SEC
  D80A  AF            		XOR	A
  D80B  C9            		RET
                      	
  D80C                	EDMAD:
  D80C  C3            		DB	0C3H	;WR6 リセット
  D80D  7D            		DB	07DH	;WR0 ポートA→ポートB 転送
  D80E  030D          		DW	00D03H	;ポートA開始アドレス EMMリード/ライト
  D810  FF01          	DMALEN:	DW	001FFH	;ブロック長(転送サイズ-1)
  D812  2C            		DB	02CH	;WR1 ポートAアドレス固定 I/O
  D813  50            		DB	050H	;WR2 ポートBアドレスインクリメント メモリ
  D814  02            		DB	002H	;ポートBタイミング
  D815  80            		DB	080H	;WR3
  D816  9A            		DB	09AH	;WR5 WAIT RDY:HIGH
  D817  AD            		DB	0ADH	;WR4 連続 ポートB開始アドレス
  D818  0000          	DMAB:	DW	0
  D81A  01            		DB	001H	;WR0 ポートA←ポートB 転送
  D81B                	EMME:
                      	
  0756                	AT_RE	EQU	EDWT-AT_EDWT
                      	
                      	
                      	;LDOS.ASM
                      	
                      	;	LSX-Dodgers OS
                      	
  D81B                	BDOS0:
  D81B  E5            		PUSH	HL
  D81C  210001        		LD	HL,00100H
  D81F  39            		ADD	HL,SP
  D820  3810          		JR	C,BDOS1X
  D822                	BDOS2:
  D822  E1            		POP	HL
  D823  ED732ED8      		LD	(BDSP+1),SP
  D827  31CAFF        		LD	SP,EXTSP
  D82A  CD31D8        		CALL	BDOS1
  D82D  310000        	BDSP:	LD	SP,0
  D830  C9            		RET
  D831                	BDOS1:
  D831  E5            		PUSH	HL
  D832                	BDOS1X:
  D832  79            		LD	A,C
  D833  FE3C          		CP	03CH
  D835  3802          		JR	C,DOS1
  D837  3E3C          		LD	A,03CH
  D839                	DOS1:
  D839  87            		ADD	A,A
  D83A  6F            		LD	L,A
  D83B  26F0          		LD	H,STABLE/256
  D83D  7E            		LD	A,(HL)
  D83E  2C            		INC	L
  D83F  66            		LD	H,(HL)
  D840  6F            		LD	L,A
  D841  E3            		EX	(SP),HL
  D842  79            		LD	A,C
  D843  C9            		RET
  D844                	_DOS2:
  D844  FE5A          		CP	05AH		;(BDOS)カレントディレクトリの変更(_CHDIR)
  D846  CA07DB        		JP	Z,_SYS5A
  D849  FE5C          		CP	05CH		;(BDOS)ファイル名の解析(_PFILE)
  D84B  CAC3DA        		JP	Z,_SYS5C
  D84E  FE5F          		CP	05FH		;(BDOS)ディスクバッファのフラッシュ(_FLUSH)
  D850  CA62ED        		JP	Z,_SYS5F
  D853  FE6F          		CP	06FH		;(BDOS)MSX-DOS のバージョン番号の獲得(_DOSVER)
  D855  2007          		JR	NZ,_ERROR
  D857  011D01        		LD	BC,011DH
  D85A  114601        		LD	DE,VER
  D85D  AF            		XOR	A
  D85E                	_ERROR:
  D85E  A7            		AND	A
  D85F  C9            		RET
                      	
  D860                	_SYS09:		;文字列出力
  D860  D5            		PUSH	DE
  D861                	_SX09:
  D861  1A            		LD	A,(DE)
  D862  13            		INC	DE
  D863  FE24          		CP	'$'
  D865  2831          		JR	Z,SX0E2
  D867  CD24DC        		CALL	MSG_A
  D86A  18F5          		JR	_SX09
                      	
  D86C                	MSX1:
  D86C  CD24DC        		CALL	MSG_A
  D86F                	MSX:
  D86F  7E            		LD	A,(HL)
  D870  23            		INC	HL
  D871  B7            		OR	A
  D872  20F8          		JR	NZ,MSX1
  D874  C9            		RET
                      	
  D875                	_SYS0C:		;(BDOS)バージョン番号の獲得
  D875  212200        		LD	HL,00022H
  D878  7D            		LD	A,L
  D879  C9            		RET
                      	
  D87A                	_SYS0D:		;(BDOS)ディスクリセット
  D87A  CDDFEF        		CALL	_FFLUSH
  D87D  E5            		PUSH	HL
  D87E  218000        		LD	HL,00080H
  D881  228AEF        		LD	(_DTA),HL
  D884  E1            		POP	HL
  D885  D5            		PUSH	DE
  D886  1E00          		LD	E,0
  D888  3E            		DB	03EH
                      	
  D889                	_SYS0E:		;(BDOS)カレントドライブの設定
  D889  D5            		PUSH	DE
  D88A  7B            		LD	A,E
  D88B  DDE5          		PUSH	IX
  D88D  CDDCEF        		CALL	_GETDPB
  D890  DDE1          		POP	IX
  D892  3804          		JR	C,SX0E2
  D894  7B            		LD	A,E
  D895  3287EF        		LD	(_DVSW),A
  D898                	SX0E2:
  D898  3E08          		LD	A,8
  D89A  D1            		POP	DE
  D89B  C9            		RET
                      	
  D89C                	_SYS0F:		;(BDOS)ファイルのオープン
  D89C  CDE4E1        		CALL	SETDRV
  D89F  FD7E1C        		LD	A,(IY+28)	;(FCB)オープンモード
  D8A2  C602          		ADD	A,002H		;Write
  D8A4  2848          		JR	Z,FEND0F
  D8A6  CD32E5        		CALL	CHKWILDX
                      	
  D8A9  D404E2        		CALL	NC,SOPENX
  D8AC                	_S16XX:
  D8AC  3840          		JR	C,FEND0F
                      					;Directory location
  D8AE  3A9FEF        		LD	A,(_FILEN)
  D8B1  FD7719        		LD	(IY+25),A	;(FCB)ディレクトリロケーション
                      	;				_DIRF
  D8B4  3AA0EF        		LD	A,(_DIRF)
  D8B7  FD771D        		LD	(IY+29),A	;(FCB)ディレクトリモード
                      	;				_FBPS
  D8BA  FD731E        		LD	(IY+30),E	;(FCB)ディレクトリポジション
  D8BD  FD721F        		LD	(IY+31),D
                      	;				Open(Read)
  D8C0  FD361CFF      		LD	(IY+28),0FFH	;(FCB)オープンモード
                      	;				FILENAME
  D8C4  FDE5          		PUSH	IY
  D8C6  D1            		POP	DE
  D8C7  13            		INC	DE
  D8C8  010B00        		LD	BC,11
  D8CB  EDB0          		LDIR
                      	;				Attribute
  D8CD  7E            		LD	A,(HL)
  D8CE  FD770D        		LD	(IY+13),A	;(FCB)属性(アトリビュート)
  D8D1  110B00        		LD	DE,11		;Reserved
  D8D4  19            		ADD	HL,DE
                      						;(FCB)ファイルを最後に変更した時刻
  D8D5  11EAF0        		LD	DE,SDDATA		;(FCB)ファイルを最後に変更した日付
  D8D8  060A          		LD	B,SDDATAE-SDDATA	;(FCB)ファイルの先頭クラスタ
  D8DA                	S16LOOP:				;(FCB)ファイルのサイズ(バイト単位)
  D8DA  1A            		LD	A,(DE)
  D8DB  13            		INC	DE
  D8DC  32E3D8        		LD	(S16PAT+2),A
  D8DF  7E            		LD	A,(HL)
  D8E0  23            		INC	HL
  D8E1  FD7700        	S16PAT:	LD	(IY+0),A
  D8E4  10F4          		DJNZ	S16LOOP
                      	
  D8E6  AF            		XOR	A
  D8E7  FD770C        		LD	(IY+12),A	;(FCB)カレントブロック
  D8EA  FD2292D9      		LD	(OFCB+1),IY
  D8EE                	FEND0F:
  D8EE  1845          		JR	FEND10
                      	
  D8F0                	_SYS10:		;(BDOS)ファイルのクローズ
  D8F0  CDE4E1        		CALL	SETDRV
  D8F3  FD7E1C        		LD	A,(IY+28)	;(FCB)オープンモード
  D8F6  D6FE          		SUB	0FEH
  D8F8  37            		SCF
  D8F9  3F            		CCF
  D8FA  2039          		JR	NZ,FEND10
  D8FC                	_S10A:				;Write
  D8FC  FD770E        		LD	(IY+14),A	;(FCB)レコードサイズ/アクセスするディレクトリのクラスタ番号+1
  D8FF  FD770F        		LD	(IY+15),A
                      	
  D902  FD341C        		INC	(IY+28)		;0FEH->0FFH ;オープンモード
  D905  CD20E6        		CALL	SETTMS
                      	
  D908  FD7E1D        		LD	A,(IY+29)	;(FCB)ディレクトリモード
  D90B  32A0EF        		LD	(_DIRF),A
  D90E  E67F          		AND	07FH
  D910  328FEA        		LD	(_SECPS+1),A
  D913  FD5E1E        		LD	E,(IY+30)	;(FCB)ディレクトリポジション
  D916  FD561F        		LD	D,(IY+31)
  D919  CD38E3        		CALL	READ_DIR
  D91C  3817          		JR	C,FEND10
                      	
  D91E  3A62E2        	SDECM1:	LD	A,(SDECPAT+1)	;1セクタ辺りのディレクトリエントリ数
  D921  3D            	 	DEC	A		;1024=01FH / 512=00FH / 256=7
  D922  FDA619        		AND	(IY+25)		;(FCB)ディレクトリロケーション
  D925  6F            		LD	L,A
  D926  2600          		LD	H,0
  D928  29            		ADD	HL,HL		;*2
  D929  29            		ADD	HL,HL		;*4
  D92A  29            		ADD	HL,HL		;*8
  D92B  29            		ADD	HL,HL		;*16
  D92C  29            		ADD	HL,HL		;*32
  D92D  ED4B7EF0      		LD	BC,(_DTBUF)
  D931  09            		ADD	HL,BC
                      	
  D932  CD42E5        		CALL	SDIRENT
  D935                	FEND10:
  D935  1842          		JR	FEND
                      	
  D937                	_SYS11:		;(BDOS)最初のファイルの検索
  D937  CDE4E1        		CALL	SETDRV
  D93A  CD31E2        		CALL	SOPEN
  D93D                	_S12X1:
  D93D  383A          		JR	C,FEND
  D93F  CDD1E2        		CALL	SOPENE2
  D942  ED5B8AEF      		LD	DE,(_DTA)
  D946  3A88EF        		LD	A,(_DRV)
  D949  3C            		INC	A
  D94A  12            		LD	(DE),A
  D94B  D5            		PUSH	DE
  D94C  13            		INC	DE
  D94D  012000        		LD	BC,32
  D950  EDB0          		LDIR
  D952  FD6E0E        		LD	L,(IY+14)	;(FCB)レコードサイズ/アクセスするディレクトリのクラスタ番号+1
  D955  FD660F        		LD	H,(IY+15)
  D958  22F4F0        		LD	(SCDIR),HL
  D95B  2A9AEF        		LD	HL,(_FBPS)
  D95E  22F6F0        		LD	(SFBPS),HL
  D961  2A9FEF        		LD	HL,(_FILEN)
  D964  7C            		LD	A,H
  D965  B7            		OR	A
  D966  2806          		JR	Z,_S12DIR
  D968  3A8FEA        		LD	A,(_SECPS+1)
  D96B  F680          		OR	080H
  D96D  67            		LD	H,A
  D96E                	_S12DIR
  D96E  22F8F0        		LD	(SFNDF),HL	;Directory position and Flags
  D971  E1            		POP	HL
  D972  1139EF        		LD	DE,SFILE
  D975  0E21          		LD	C,33
  D977                	_S11B:
  D977  EDB0          		LDIR
  D979                	FEND:
  D979  9F            		SBC	A,A		;CF=0 A=0 : CF=1 A=0FFH
  D97A                	FENDE:
  D97A  FDE1          		POP	IY
  D97C  C1            		POP	BC
  D97D  D1            		POP	DE
  D97E  E1            		POP	HL
  D97F  C9            		RET
                      	
  D980                	_SYS12:		;(BDOS)次のファイルの検索
  D980  E5            		PUSH	HL
  D981  D5            		PUSH	DE
  D982  C5            		PUSH	BC
  D983  FDE5          		PUSH	IY
  D985  CD95E2        		CALL	NOPEN
  D988  18B3          		JR	_S12X1
                      	
  D98A                	_S16K:
  D98A  FD7E1C        		LD	A,(IY+28)	;(FCB)オープンモード
  D98D  FEFD          		CP	0FDH		;Device(0FDH)
  D98F  37            		SCF
  D990  C8            		RET	Z
                      	
  D991  110000        	OFCB:	LD	DE,0
  D994  D5            		PUSH	DE
  D995  061A          		LD	B,26		;First cluster
  D997                	S16K1:
  D997  13            		INC	DE
  D998  23            		INC	HL
  D999  10FC          		DJNZ	S16K1
                      	
  D99B  1A            		LD	A,(DE)
  D99C  BE            		CP	(HL)
  D99D  2013          		JR	NZ,S16K2
  D99F  13            		INC	DE
  D9A0  23            		INC	HL
  D9A1  1A            		LD	A,(DE)
  D9A2  BE            		CP	(HL)
  D9A3  200D          		JR	NZ,S16K2
                      	
  D9A5  E1            		POP	HL
  D9A6  FDE5          		PUSH	IY
  D9A8  D1            		POP	DE
  D9A9  1A            		LD	A,(DE)		;Drive
  D9AA  BE            		CP	(HL)
  D9AB  2006          		JR	NZ,S16K3
                      					;ここはCFが必ず0
  D9AD  ED52          		SBC	HL,DE		;CP HL,DE
  D9AF  37            		SCF
  D9B0  C0            		RET	NZ
  D9B1  E5            		PUSH	HL
  D9B2                	S16K2:
  D9B2  E1            		POP	HL
  D9B3                	S16K3:
  D9B3  FDE5          		PUSH	IY
  D9B5  D1            		POP	DE
  D9B6                	_SYS13:		;(BDOS)ファイルの削除
  D9B6  CDE4E1        		CALL	SETDRV
  D9B9  CD62E4        		CALL	KILL
  D9BC                	FEND13:
  D9BC  18BB          		JR	FEND
                      	
  D9BE                	_SYS14:		;(BDOS)シーケンシャルな読み出し
  D9BE  CDE4E1        		CALL	SETDRV
  D9C1  CD52E6        		CALL	PUSHRR
  D9C4  CD93E6        		CALL	GETSEQ
                      	
  D9C7  CDA7E6        		CALL	RB_READ
  D9CA  E5            		PUSH	HL
  D9CB  CD66E6        		CALL	SETSEQ
  D9CE                	SREAD:
  D9CE  E1            		POP	HL
                      	
  D9CF  C601          		ADD	A,001H
  D9D1  38A6          		JR	C,FEND
                      	
  D9D3  7D            		LD	A,L
  D9D4  D601          		SUB	001H
  D9D6                	FENDX:
  D9D6  9F            		SBC	A,A
  D9D7  E603          		AND	3
  D9D9  1F            		RRA
  D9DA  189E          		JR	FENDE
                      	
  D9DC                	_SYS15:		;(BDOS)シーケンシャルな書き込み
  D9DC  CDE4E1        		CALL	SETDRV
  D9DF  CD52E6        		CALL	PUSHRR
  D9E2  CD93E6        		CALL	GETSEQ
                      	
  D9E5  CDA0E6        		CALL	RB_WRITE
  D9E8  E5            		PUSH	HL
  D9E9  CD66E6        		CALL	SETSEQ
  D9EC                	SWRITE:
  D9EC  E1            		POP	HL
                      	
  D9ED  C6FF          		ADD	A,0FFH
  D9EF  18E5          		JR	FENDX
                      	
  D9F1                	_SYS17:		;(BDOS)ファイル名の変更
  D9F1  CDE4E1        		CALL	SETDRV
  D9F4  CDB8E4        		CALL	NAME
  D9F7  18C3          		JR	FEND13
                      	
  D9F9                	_SYS16:		;(BDOS)ファイルの作成
  D9F9  CDE4E1        		CALL	SETDRV
                      	
  D9FC  CD32E5        		CALL	CHKWILDX
  D9FF  38BB          		JR	C,FEND13
  DA01  FD7E01        		LD	A,(IY+1)	;(FCB)主ファイル名
  DA04  FE05          		CP	5
  DA06  2805          		JR	Z,_S16X2
  DA08  FE21          		CP	021H
  DA0A  DABCD9        		JP	C,FEND13
  DA0D                	_S16X2:
                      	;				Clear FCB
  DA0D  FDE5          		PUSH	IY
  DA0F  E1            		POP	HL
  DA10  011000        		LD	BC,16
  DA13  09            		ADD	HL,BC
  DA14                	_S16X1:
  DA14  70            		LD	(HL),B		;B=0
  DA15  23            		INC	HL
  DA16  0D            		DEC	C
  DA17  20FB          		JR	NZ,_S16X1
                      	
  DA19  CD25E6        		CALL	SETTMSX
  DA1C  FD360DFF      		LD	(IY+13),0FFH	;(FCB)Attribute
  DA20  CD04E2        		CALL	SOPENX
  DA23  3F            		CCF
  DA24  CC8AD9        		CALL	Z,_S16K
  DA27  D4E2E2        		CALL	NC,COPEN
  DA2A  D442E5        		CALL	NC,SDIRENT
  DA2D  C3ACD8        		JP	_S16XX
                      	
  DA30                	_SYS21:		;(BDOS)ランダムな読み出し
                      	
  DA30  CDE4E1        		CALL	SETDRV
  DA33  CD52E6        		CALL	PUSHRR
  DA36  FD6E21        		LD	L,(IY+33)	;(FCB)Random record
  DA39  FD6622        		LD	H,(IY+34)
                      	
  DA3C  CDA7E6        		CALL	RB_READ
  DA3F  E5            		PUSH	HL
  DA40  CD7DE6        		CALL	POPRR
  DA43  1889          		JR	SREAD
                      	
  DA45                	_SYS22:		;(BDOS)ランダムな書き込み
  DA45                	_SYS28:		;(BDOS)ランダムな書き込み・その2
  DA45  CDE4E1        		CALL	SETDRV
  DA48  CD52E6        		CALL	PUSHRR
  DA4B  FD6E21        		LD	L,(IY+33)	;(FCB)Random record
  DA4E  FD6622        		LD	H,(IY+34)
                      	
  DA51  CDA0E6        		CALL	RB_WRITE
  DA54  E5            		PUSH	HL
  DA55  CD7DE6        		CALL	POPRR
  DA58  1892          		JR	SWRITE
                      	
  DA5A                	_SYS18:		;(BDOS)ログインベクトルの獲得
  DA5A  21FF00        		LD	HL,000FFH
  DA5D  AF            		XOR	A
  DA5E  C9            		RET
                      	
  DA5F                	_SYS19:		;(BDOS)カレントドライブ番号の獲得
  DA5F  3A87EF        		LD	A,(_DVSW)
  DA62  A7            		AND	A
  DA63  C9            		RET
                      	
  DA64                	_SYS1A:		;(BDOS)DTAの設定
  DA64  ED538AEF      		LD	(_DTA),DE
  DA68  AF            		XOR	A
  DA69  C9            		RET
                      	
  DA6A                	_SYS1B:		;(BDOS)ディスク情報の獲得
  DA6A  7B            		LD	A,E
  DA6B  CDF7E1        		CALL	GETDRV
  DA6E  CDDCEF        		CALL	_GETDPB
  DA71  D4E2EF        		CALL	NC,_RDFATX
  DA74  210000        		LD	HL,0
  DA77  D4FEE5        		CALL	NC,DSKF
                      	
  DA7A  ED5BFFE5      		LD	DE,(MAXCLP+1)	;DPB_08_MAXCL-1
  DA7E  1B            		DEC	DE		;DE←クラスタの総数
  DA7F  FD2A7CF0      		LD	IY,(_FATBF)	;IY←メモリ上のFATの先頭アドレス
  DA83  9F            		SBC	A,A
  DA84  D8            		RET	C
  DA85  4F            		LD	C,A		;C=0
  DA86  DD7E0F        		LD	A,(IX+00FH)	;DPB_0F_BPS
  DA89  E60F          		AND	00FH
  DA8B  47            		LD	B,A
  DA8C  DD7E07        		LD	A,(IX+7)	;DPB_07_SECPCL
  DA8F  C9            		RET
                      	
  DA90                	_SYS1D:		;(BDOS)書き込みが禁止されているディスクの調査
  DA90  AF            		XOR	A
  DA91  67            		LD	H,A
  DA92  6F            		LD	L,A
  DA93  C9            		RET
                      	
  DA94                	_SYS1F:		;(BDOS)ディスク装置のパラメータの読み出し
  DA94  2100F1        		LD	HL,DEVICE
  DA97  7B            		LD	A,E
  DA98  C3DCEF        		JP	_GETDPB
                      	
  DA9B                	_SYS23:		;(BDOS)ファイルサイズの獲得
  DA9B  E5            		PUSH	HL
  DA9C  2A1EF0        		LD	HL,(STABLE+2*00FH)	;ファイルのオープン
  DA9F  CD0F00        		CALL	JP_HL
  DAA2  3814          		JR	C,_S23X1
                      	
  DAA4  D5            		PUSH	DE		;EX DE,IY
  DAA5  FDE3          		EX	(SP),IY		;
                      	;	POP	DE		;
                      	;	PUSH	DE		;DEを破壊しないように注意vv
  DAA7  CD83E6        		CALL	GETSIZE
  DAAA                	_S24X1:
  DAAA  FD7521        		LD	(IY+33),L	;(FCB)Random record
  DAAD  FD7422        		LD	(IY+34),H
  DAB0  FD362300      		LD	(IY+35),0
                      	;	POP	DE		;^^^^^^^^^^^^^^^^^^^^^^^^
                      	;	PUSH	DE		;EX DE,IY
  DAB4  FDE3          		EX	(SP),IY		;
  DAB6  D1            		POP	DE		;
                      	
  DAB7  AF            		XOR	A
  DAB8                	_S23X1:
  DAB8  E1            		POP	HL
  DAB9  C9            		RET
                      	
  DABA                	_SYS24:		;(BDOS)ランダムレコードフィールドの設定
  DABA  E5            		PUSH	HL
  DABB  D5            		PUSH	DE		;EX DE,IY
  DABC  FDE3          		EX	(SP),IY		;
                      	;	POP	DE		;
                      	;	PUSH	DE		;DEを破壊しないように注意vv
  DABE  CD93E6        		CALL	GETSEQ
  DAC1  18E7          		JR	_S24X1		;^^^^^^^^^^^^^^^^^^^^^^^^
                      	
  DAC3                	_SYS5C:		;(BDOS)ファイル名の解析
  DAC3  C5            		PUSH	BC
  DAC4  E5            		PUSH	HL
  DAC5  CDFBE0        		CALL	FILE
  DAC8  E1            		POP	HL
  DAC9  C1            		POP	BC
  DACA                	S29X1:
  DACA  C5            		PUSH	BC
  DACB  D5            		PUSH	DE
  DACC  E5            		PUSH	HL
  DACD  EB            		EX	DE,HL
  DACE  2114EF        		LD	HL,FDRV
  DAD1  010D00        		LD	BC,13
  DAD4  EDB0          		LDIR
  DAD6  70            		LD	(HL),B		;B=0
  DAD7  0E03          		LD	C,3
  DAD9  EDB0          		LDIR
  DADB  E1            		POP	HL
  DADC  D1            		POP	DE
  DADD  C1            		POP	BC
  DADE  AF            		XOR	A
  DADF  C9            		RET
                      	
  DAE0                	_SYS30:		;(BDOS)論理セクタを用いた書き込み
  DAE0  C5            		PUSH	BC
  DAE1  01FDEB        		LD	BC,DWT24B
  DAE4  1804          		JR	S2FX
  DAE6                	_SYS2F:
  DAE6  C5            		PUSH	BC
  DAE7  01EDEB        		LD	BC,DRD24B
  DAEA                	S2FX:
  DAEA  ED4300DB      		LD	(S2FPAT+1),BC
  DAEE  CDDFEF        		CALL	_FFLUSH
                      	
  DAF1  D5            		PUSH	DE
  DAF2  E5            		PUSH	HL
  DAF3  7D            		LD	A,L		;Drive
  DAF4  CDD9EF        		CALL	_CHGDRV
  DAF7  3809          		JR	C,S30X2
  DAF9  44            		LD	B,H		;Number of clusters
  DAFA  2A8AEF        		LD	HL,(_DTA)
                      	
  DAFD  0E00          		LD	C,0
  DAFF  CDEDEB        	S2FPAT:	CALL	DRD24B
  DB02                	S30X2:
  DB02  E1            		POP	HL
  DB03  D1            		POP	DE
  DB04  C1            		POP	BC
  DB05  9F            		SBC	A,A
  DB06  C9            		RET
                      	
  DB07                	_SYS5A:		;(BDOS)カレントディレクトリの変更
  DB07  C5            		PUSH	BC
  DB08  D5            		PUSH	DE
  DB09  E5            		PUSH	HL
  DB0A  CDF0E0        		CALL	FILEC
  DB0D  210000        		LD	HL,0
  DB10  1114EF        		LD	DE,FDRV
  DB13  2A4EF0        		LD	HL,(STABLE+2*027H)	;ランダムブロック読み込み
  DB16  CD0F00        		CALL	JP_HL
  DB19  18E7          		JR	S30X2
                      	
                      	;LDIO.ASM
                      	
                      	;	LSX-Dodgers IO
                      	
  D85E                	_SYS04	EQU	_ERROR		;(BDOS)外部出力
  D85E                	_SYS05	EQU	_ERROR		;(BDOS)プリンタ出力
  D85E                	_SYS1C	EQU	_ERROR		;(BDOS)ディスクの書き込み禁止化
  D85E                	_SYS1E	EQU	_ERROR		;(BDOS)ファイル属性の設定
  D85E                	_SYS20	EQU	_ERROR		;(BDOS)利用者番号の設定と読み出し
  D85E                	_SYS2E	EQU	_ERROR		;(BDOS)ベリファイ・フラグの設定
                      	
  DB1B                	BIOS:
  DB1B  E5            		PUSH	HL
  DB1C  211080        		LD	HL,08010H
  DB1F  39            		ADD	HL,SP
  DB20  E1            		POP	HL
  DB21  300E          		JR	NC,BIOS2
  DB23                	BIOS1:
  DB23  CD2BDB        		CALL	BIOS3
  DB26  061E          		LD	B,01EH
  DB28  ED79          		OUT	(C),A
  DB2A  C9            		RET
  DB2B                	BIOS3:
  DB2B  C5            		PUSH	BC
  DB2C  061D          		LD	B,01DH
  DB2E  ED79          		OUT	(C),A
  DB30  C9            		RET
  DB31                	BIOS2:
  DB31  ED733CDB      		LD	(SPPAT+1),SP	;スタックがBIOS-ROMと被っている場合
  DB35  31CAFF        		LD	SP,EXTSP
  DB38  CD23DB        		CALL	BIOS1
  DB3B  310000        	SPPAT:	LD	SP,0
  DB3E  C9            		RET
                      	
  DB3F                	INT:
  DB3F  F5            		PUSH	AF
  DB40  E5            		PUSH	HL
  DB41  ED7352DB      		LD	(INTSP+1),SP
  DB45  210001        		LD	HL,00100H
  DB48  39            		ADD	HL,SP
  DB49  3803          		JR	C,INTP1X
  DB4B  31CAFF        		LD	SP,EXTSP
  DB4E                	INTP1X:
  DB4E  CD59DB        		CALL	INTP1
  DB51  310000        	INTSP:	LD	SP,0
  DB54                	INTPE:
  DB54  E1            		POP	HL
  DB55                	INTPE2:
  DB55  F1            		POP	AF
  DB56                	INTCTCE:
  DB56  FB            		EI
  DB57  ED4D          		RETI
  DB59                	INTP1:
  DB59  C5            		PUSH	BC
                      	
  DB5A  CD24DF        		CALL	IN49SB
  DB5D  67            		LD	H,A
  DB5E  CD24DF        		CALL	IN49SB
  DB61  6F            		LD	L,A
                      	
  DB62  FE08          		CP	8		;DELキー
  DB64  2005          		JR	NZ,SCEXE
  DB66  7C            		LD	A,H
  DB67  E611          		AND	011H		;CTRLキー + GRAPHキー
  DB69  2808          		JR	Z,RESET
  DB6B                	SCEXE:
  DB6B  2292EF        		LD	(_KEYD),HL
  DB6E  CD9FDB        		CALL	KEYSET1
                      	
  DB71  C1            		POP	BC
  DB72  C9            		RET
                      	
  DB73                	RESET:
  DB73  3E1D          		LD	A,01DH
  DB75  D300          		OUT	(0),A
  DB77  C7            		RST	0
                      	
  DB78                	INTCTC2:
  DB78  F5            		PUSH	AF
  DB79  3E00          	INTCPAT:LD	A,000H
  DB7B  3D            		DEC	A
  DB7C  327ADB        		LD	(INTCPAT+1),A
  DB7F  20D4          		JR	NZ,INTPE2
                      	
  DB81  3A92EF        		LD	A,(_KEYD)
  DB84  B7            		OR	A
  DB85  28CE          		JR	Z,INTPE2
  DB87                	KEYSET0:
  DB87  E5            		PUSH	HL
  DB88  2A90EF        		LD	HL,(_KEYPS)
  DB8B  7C            		LD	A,H
  DB8C  AD            		XOR	L
  DB8D  2006          		JR	NZ,INTC2A
                      	
  DB8F  2A92EF        		LD	HL,(_KEYD)
  DB92  CDC9DB        		CALL	KEYSET
  DB95                	INTC2A:
  DB95  3A94EF        		LD	A,(_KEYSP)
  DB98  E60F          		AND	00FH
  DB9A  327ADB        		LD	(INTCPAT+1),A
                      	
  DB9D  18B5          		JR	INTPE
                      	
  DB9F                	KEYSET1:
  DB9F  CB6C          		BIT	5,H
  DBA1  F5            		PUSH	AF
  DBA2  ED4B8CEF      		LD	BC,(_CTC)
  DBA6  78            		LD	A,B
  DBA7  B1            		OR	C
  DBA8  2006          		JR	NZ,KEYS10E
                      	
  DBAA  F1            		POP	AF
  DBAB  201C          		JR	NZ,KEYSET
  DBAD  F5            		PUSH	AF
  DBAE  18D7          		JR	KEYSET0
  DBB0                	KEYS10E:
  DBB0  F1            		POP	AF
  DBB1  C8            		RET	Z
  DBB2  F5            		PUSH	AF
  DBB3  3E03          		LD	A,3		;CTC STOP
  DBB5  ED79          		OUT	(C),A
  DBB7  F1            		POP	AF
                      	
  DBB8  B7            		OR	A
  DBB9  C8            		RET	Z
                      	
  DBBA  E5            		PUSH	HL
  DBBB  2A94EF        		LD	HL,(_KEYSP)
  DBBE  3EA7          		LD	A,0A7H
  DBC0  ED79          		OUT	(C),A
  DBC2  ED69          		OUT	(C),L
  DBC4  7C            		LD	A,H
  DBC5  327ADB        		LD	(INTCPAT+1),A
  DBC8  E1            		POP	HL
                      	
  DBC9                	KEYSET:
  DBC9  7D            		LD	A,L
  DBCA  CB7C          		BIT	7,H
  DBCC  CCFADB        		CALL	Z,FKEY
  DBCF  CB74          		BIT	6,H
  DBD1  C0            		RET	NZ
  DBD2                	KEYBS:
  DBD2  B7            		OR	A
  DBD3  C8            		RET	Z
  DBD4                	KEYBS1:
  DBD4  CDEADB        		CALL	KEYBC_IFBREAK
  DBD7  E5            		PUSH	HL
  DBD8  F5            		PUSH	AF
  DBD9  2A90EF        		LD	HL,(_KEYPS)
  DBDC  2C            		INC	L
  DBDD  7D            		LD	A,L
  DBDE  BC            		CP	H
  DBDF  2815          		JR	Z,POP_AF_HL_SCF_RET
  DBE1  3290EF        		LD	(_KEYPS),A
  DBE4  26FE          		LD	H,KEYBF/256
  DBE6  F1            		POP	AF
  DBE7  77            		LD	(HL),A
  DBE8  E1            		POP	HL
  DBE9  C9            		RET
  DBEA                	KEYBC_IFBREAK:
  DBEA  FE03          		CP	3
  DBEC  C0            		RET	NZ
  DBED                	KEYBC:
  DBED  E5            		PUSH	HL
  DBEE  210000        		LD	HL,0
  DBF1  2290EF        		LD	(_KEYPS),HL
  DBF4  E1            		POP	HL
  DBF5  C9            		RET
                      	
  DBF6                	POP_AF_HL_SCF_RET:
  DBF6  F1            		POP	AF
  DBF7  E1            		POP	HL
  DBF8  37            		SCF
  DBF9  C9            		RET
                      	
  DBFA                	FKEY:
  DBFA  CB75          		BIT	6,L
  DBFC  C8            		RET	Z
  DBFD  3E1B          		LD	A,01BH
  DBFF  CDD4DB        		CALL	KEYBS1
  DC02  7D            		LD	A,L
  DC03  C6AF          		ADD	A,020H-'q'
  DC05  CB7D          		BIT	7,L
  DC07  C8            		RET	Z
  DC08  2E50          		LD	L,'P'
  DC0A  D690          		SUB	0E1H+020H-'q'
  DC0C  2810          		JR	Z,KEYBSL
  DC0E  2C            		INC	L
  DC0F  3D            		DEC	A
  DC10  280C          		JR	Z,KEYBSL
  DC12  2C            		INC	L
  DC13  D609          		SUB	0EBH-0E2H
  DC15  2807          		JR	Z,KEYBSL
  DC17  2E43          		LD	L,'C'
  DC19  3D            		DEC	A
  DC1A  2802          		JR	Z,KEYBSL
  DC1C  2E58          		LD	L,'X'
  DC1E                	KEYBSL:
  DC1E  7D            		LD	A,L
  DC1F  18B3          		JR	KEYBS1
                      	
  DC21                	_SYS01:		;(BDOS)コンソール入力
  DC21  CD09EF        		CALL	_SYS07
  DC24                	MSG_A:
  DC24  F5            		PUSH	AF
  DC25  D5            		PUSH	DE
  DC26  5F            		LD	E,A
  DC27  CD2DDC        		CALL	_SYS02
  DC2A  D1            		POP	DE
  DC2B  F1            		POP	AF
  DC2C  C9            		RET
                      	
  DC2D                	_SYS02:		;(BDOS)コンソール出力
  DC2D  CD3FDC        		CALL	BREAK
  DC30  1805          		JR	PRINTX
                      	
  DC32                	_SYS06:		;(BDOS)コンソール直接入出力
  DC32  7B            		LD	A,E
  DC33  3C            		INC	A
  DC34  CACAEF        		JP	Z,_INKEY
  DC37                	PRINTX:
  DC37  C3CDEF        		JP	_PRINT
                      	
  DC3A                	_SYS08:		;(BDOS)エコーなしコンソール入力
  DC3A  CD09EF        		CALL	_SYS07
  DC3D  1804          		JR	BREAK1
  DC3F                	BREAK:
  DC3F  FB            		EI
  DC40  3A92EF        		LD	A,(_KEYD)
  DC43                	BREAK1:
  DC43  FE03          		CP	3		;CTRL+C
  DC45  CA00EF        		JP	Z,CPM_BOOT
  DC48  FE13          		CP	013H		;CTRL+S
  DC4A  C0            		RET	NZ
                      	
  DC4B                	PAUSE:
  DC4B  CDEDDB        		CALL	KEYBC
                      	
  DC4E                	FLGET:
  DC4E  CDDFEF        		CALL	_FFLUSH
  DC51  C5            		PUSH	BC
  DC52  E5            		PUSH	HL
  DC53  ED4B8EEF      		LD	BC,(_TXADR)
  DC57  CBE8          		SET	5,B
  DC59  ED60          		IN	H,(C)
  DC5B                	FLGET1:
  DC5B  3A93EF        		LD	A,(_KEYD+1)
  DC5E  0F            		RRCA
  DC5F  0F            		RRCA
  DC60  E610          		AND	010H
  DC62  F608          		OR	8
  DC64  ED68          		IN	L,(C)
  DC66  B5            		OR	L
  DC67  ED79          		OUT	(C),A
  DC69  CDCAEF        		CALL	_INKEY
  DC6C  28ED          		JR	Z,FLGET1
  DC6E  ED61          		OUT	(C),H
  DC70  E1            		POP	HL
  DC71  C1            		POP	BC
  DC72  C9            		RET
                      	
  DC73                	_SYS0A:		;(BDOS)文字列入力
  DC73  C5            		PUSH	BC
  DC74  E5            		PUSH	HL
  DC75  D5            		PUSH	DE
  DC76  CD81E0        		CALL	GETL
  DC79  1100FF        		LD	DE,KBUF
  DC7C  E1            		POP	HL
  DC7D  E5            		PUSH	HL
  DC7E  0E00          		LD	C,0
  DC80  3004          		JR	NC,SAX0
  DC82  23            		INC	HL
  DC83  23            		INC	HL
  DC84  1808          		JR	SAX4
  DC86                	SAX0:
  DC86  46            		LD	B,(HL)
  DC87  23            		INC	HL
  DC88                	SAX1:
  DC88  23            		INC	HL
  DC89  1A            		LD	A,(DE)
  DC8A  13            		INC	DE
  DC8B  B7            		OR	A
  DC8C  2004          		JR	NZ,SAX2
  DC8E                	SAX4:
  DC8E  360D          		LD	(HL),00DH
  DC90  1804          		JR	SAX3
  DC92                	SAX2:
  DC92  77            		LD	(HL),A
  DC93  0C            		INC	C
  DC94  10F2          		DJNZ	SAX1
  DC96                	SAX3:
  DC96  D1            		POP	DE
  DC97  79            		LD	A,C
  DC98  13            		INC	DE
  DC99  12            		LD	(DE),A
  DC9A  1B            		DEC	DE
  DC9B  E1            		POP	HL
  DC9C  C1            		POP	BC
  DC9D  A7            		AND	A
  DC9E  C9            		RET
                      	
  DC9F                	_SYS0B:		;(BDOS)コンソール状態のチェック
  DC9F  CD3FDC        		CALL	BREAK
  DCA2  3A92EF        		LD	A,(_KEYD)
  DCA5  B7            		OR	A
  DCA6  C8            		RET	Z
  DCA7                	CONSTX:
  DCA7  CDDFEF        		CALL	_FFLUSH
  DCAA  E5            		PUSH	HL
  DCAB  2A90EF        		LD	HL,(_KEYPS)
  DCAE  7C            		LD	A,H
  DCAF  AD            		XOR	L
  DCB0  E1            		POP	HL
  DCB1  C6FF          		ADD	A,0FFH
  DCB3  9F            		SBC	A,A
  DCB4  C9            		RET
                      	
  DCB5                	_SYS2A:		;(BDOS)日付の獲得
  DCB5  C5            		PUSH	BC
  DCB6  3EED          		LD	A,0EDH		;Read calendar
  DCB8  CD3FDF        		CALL	COMOUT
  DCBB  CDD8DC        		CALL	IN49SB_BCD	;YY
  DCBE  6F            		LD	L,A
  DCBF  2600          		LD	H,0
                      	;	LD	DE,1900		;0076CH
                      	;	CP	90		;90以上は1900年代 1990-1999
                      	;	JR	NC,RDDATE1	;90未満は2000年代 2000-2089
                      	;	LD	E,0D0H		;2000 & 0FFH D=007H
  DCC1  11D007        		LD	DE,2000		;すべて2000年代で処理 2000-2099
  DCC4                	RDDATE1:
  DCC4  19            		ADD	HL,DE
  DCC5  CD24DF        		CALL	IN49SB		;MM
  DCC8  57            		LD	D,A
  DCC9  CDD8DC        		CALL	IN49SB_BCD	;DD
  DCCC  5F            		LD	E,A
  DCCD  7A            		LD	A,D
  DCCE  E607          		AND	7
  DCD0  0604          		LD	B,4
  DCD2                	RDDATE2:
  DCD2  CB3A          		SRL	D
  DCD4  10FC          		DJNZ	RDDATE2
  DCD6  C1            		POP	BC
  DCD7  C9            		RET
  DCD8                	IN49SB_BCD:
  DCD8  CD24DF        		CALL	IN49SB
                      	;------------------------
                      	;BCDの10進数化
                      	;in
                      	;	A  : BCD
                      	;out
                      	;	A  : 10進数
                      	;------------------------
  DCDB  4F            		LD	C,A
  DCDC  E6F0          		AND	0F0H	;10の位
  DCDE  0F            		RRCA
  DCDF  47            		LD	B,A
  DCE0  0F            		RRCA
  DCE1  0F            		RRCA
  DCE2  80            		ADD	A,B
  DCE3  47            		LD	B,A
  DCE4  79            		LD	A,C
  DCE5  E60F          		AND	00FH	;1の位
  DCE7  80            		ADD	A,B
  DCE8  C9            		RET
                      	
  DCE9                	_SYS2C:		;(BDOS)時刻の獲得
  DCE9  C5            		PUSH	BC
  DCEA  3EEF          		LD	A,0EFH		;Read time
  DCEC  CD3FDF        		CALL	COMOUT
  DCEF  CDD8DC        		CALL	IN49SB_BCD	;TT
  DCF2  67            		LD	H,A
  DCF3  CDD8DC        		CALL	IN49SB_BCD	;MM
  DCF6  6F            		LD	L,A
  DCF7  CDD8DC        		CALL	IN49SB_BCD	;SS
  DCFA  57            		LD	D,A
  DCFB  C1            		POP	BC
  DCFC  AF            		XOR	A
  DCFD  C9            		RET
                      	
  DCFE                	ESC1:
  DCFE  7B            		LD	A,E
  DCFF  FE41          		CP	'A'
  DD01  CA42DE        		JP	Z,CTRL1E
  DD04  FE42          		CP	'B'
  DD06  CAAADF        		JP	Z,CTRL1F
  DD09  FE43          		CP	'C'
  DD0B  CA4DDE        		JP	Z,CTRL1C
  DD0E  FE44          		CP	'D'
  DD10  CA39DE        		JP	Z,CTRL1D
  DD13  FE45          		CP	'E'
  DD15  2802          		JR	Z,CT0CX
  DD17  FE6A          		CP	'j'
  DD19                	CT0CX:
  DD19  CA7DDF        		JP	Z,CTRL0C
  DD1C  FE48          		CP	'H'
  DD1E  CAC5DE        		JP	Z,CTRL0B
  DD21  FE4A          		CP	'J'
  DD23  CA80DF        		JP	Z,CTRL06
  DD26  FE4B          		CP	'K'
  DD28  CA86DE        		JP	Z,CTRL05
  DD2B  FE4C          		CP	'L'
  DD2D  CABFDF        		JP	Z,CTRL0E
  DD30  FE54          		CP	'T'
  DD32  CA86DE        		JP	Z,CTRL05
  DD35  FE78          		CP	'x'
  DD37  2804          		JR	Z,ESC1X
  DD39  FE79          		CP	'y'
  DD3B  2002          		JR	NZ,ESC1Y
  DD3D                	ESC1X:
  DD3D  3601          		LD	(HL),1
  DD3F                	ESC1Y:
  DD3F  FE3D          		CP	'='
  DD41  2804          		JR	Z,ESC1W
  DD43  FE59          		CP	'Y'
  DD45  2002          		JR	NZ,ESC1Z
  DD47                	ESC1W:
  DD47  3602          		LD	(HL),2
  DD49                	ESC1Z:
  DD49  FE20          		CP	020H
  DD4B  3802          		JR	C,ESC1C
  DD4D  87            		ADD	A,A
  DD4E  D0            		RET	NC
  DD4F                	ESC1C:
  DD4F  E1            		POP	HL
  DD50  1849          		JR	ANK
                      	
  DD52                	ESC:
  DD52  21ACDD        		LD	HL,PRINTE5
  DD55  E5            		PUSH	HL
  DD56  2178DD        		LD	HL,ESCFLG+1
  DD59  3600          		LD	(HL),0
  DD5B  3D            		DEC	A
  DD5C  28A0          		JR	Z,ESC1
  DD5E  3D            		DEC	A
  DD5F  2009          		JR	NZ,ESC2
  DD61  3603          		LD	(HL),3
  DD63  7B            		LD	A,E
  DD64  D620          		SUB	020H
  DD66  326DDD        		LD	(ESCYP+1),A
  DD69  C9            		RET
  DD6A                	ESC2:
  DD6A  3D            		DEC	A
  DD6B  C0            		RET	NZ
  DD6C  2600          	ESCYP:	LD	H,0
  DD6E  7B            		LD	A,E
  DD6F  D620          		SUB	020H
  DD71  6F            		LD	L,A
  DD72  C3D6EF        		JP	_LOC
                      	
  DD75                	PRINT:
  DD75  C5            		PUSH	BC
  DD76  E5            		PUSH	HL
  DD77  3E00          	ESCFLG:	LD	A,000H
  DD79  B7            		OR	A
  DD7A  20D6          		JR	NZ,ESC
                      	
  DD7C  3E1F          		LD	A,01FH
  DD7E  BB            		CP	E
  DD7F  302F          		JR	NC,CTRL
  DD81  0148DF        	INSFLG:	LD	BC,INSERT
                      	
  DD84  3E00          	KANFLG:	LD	A,000H
  DD86  B7            		OR	A
  DD87  203A          		JR	NZ,KANJI2
  DD89  7B            	X1KPAT:	LD	A,E
  DD8A  FE80          		CP	080H
  DD8C  380D          		JR	C,ANK
  DD8E  FEA0          		CP	0A0H
  DD90  3804          		JR	C,KANJI1
  DD92  FEE0          		CP	0E0H
  DD94  3805          		JR	C,ANK
  DD96                	KANJI1:
  DD96  3285DD        		LD	(KANFLG+1),A
  DD99  1811          		JR	PRINTE5
  DD9B                	ANK:
  DD9B  ED4B8EEF      		LD	BC,(_TXADR)
  DD9F  78            		LD	A,B
  DDA0  F638          		OR	038H
  DDA2  47            		LD	B,A
  DDA3  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令	kanji
  DDA5  CB98          		RES	3,B
  DDA7  ED59          		OUT	(C),E		;Text
  DDA9                	KANJIE:
  DDA9  CD0EDE        		CALL	PRINTE7
  DDAC                	PRINTE5:
  DDAC  E1            		POP	HL
  DDAD  C1            		POP	BC
  DDAE  AF            		XOR	A
  DDAF  C9            		RET
                      	
  DDB0                	CTRL:
  DDB0  CDF5DD        		CALL	KANCLR
  DDB3  7B            		LD	A,E
  DDB4  87            		ADD	A,A
  DDB5  F680          		OR	080H
  DDB7  6F            		LD	L,A
  DDB8  26F0          		LD	H,CTRLTB/256
  DDBA  7E            		LD	A,(HL)
  DDBB  2C            		INC	L
  DDBC  66            		LD	H,(HL)
  DDBD  6F            		LD	L,A
  DDBE  CD0F00        		CALL	JP_HL
  DDC1  18E9          		JR	PRINTE5
                      	
  DDC3                	KANJI2:
  DDC3  D5            		PUSH	DE
  DDC4  57            		LD	D,A
  DDC5  01812F        		LD	BC,02F81H	;SFTJIS
  DDC8  DF            		RST	018H
  DDC9  01C32F        		LD	BC,02FC3H	;Instead or JISVRM
  DDCC  DF            		RST	018H
                      	
  DDCD  ED4B8EEF      		LD	BC,(_TXADR)
  DDD1  78            		LD	A,B
  DDD2  F638          		OR	038H
  DDD4  47            		LD	B,A
  DDD5  ED51          		OUT	(C),D		;kanji
  DDD7  CB98          		RES	3,B
  DDD9  ED59          		OUT	(C),E		;Text
  DDDB  CD0EDE        		CALL	PRINTE7
  DDDE  ED4B8EEF      		LD	BC,(_TXADR)
  DDE2  78            		LD	A,B
  DDE3  F638          		OR	038H
  DDE5  47            		LD	B,A
  DDE6  CBF2          		SET	6,D
  DDE8  ED51          		OUT	(C),D		;Kanji
  DDEA  CB98          		RES	3,B
  DDEC  ED59          		OUT	(C),E		;Text
  DDEE  D1            		POP	DE
  DDEF  AF            		XOR	A
  DDF0  3285DD        		LD	(KANFLG+1),A
  DDF3  18B4          		JR	KANJIE
                      	
  DDF5                	KANCLR:
  DDF5  3A85DD        		LD	A,(KANFLG+1)
  DDF8  B7            		OR	A
  DDF9  C8            		RET	Z
  DDFA  ED4B8EEF      		LD	BC,(_TXADR)
  DDFE  78            		LD	A,B
  DDFF  F638          		OR	038H
  DE01  47            		LD	B,A
  DE02  AF            		XOR	A
  DE03  3285DD        		LD	(KANFLG+1),A
  DE06  ED79          		OUT	(C),A		;Kanji
  DE08  CB98          		RES	3,B
  DE0A  3E20          		LD	A,020H
  DE0C  ED79          		OUT	(C),A		;Text
  DE0E                	PRINTE7:
  DE0E  CBA0          		RES	4,B
  DE10                	PRINTE6:
  DE10  3A96EF        		LD	A,(_COLORF)
  DE13                	PRINTE4:
  DE13  ED79          		OUT	(C),A		;Color
  DE15  78            		LD	A,B
  DE16  E607          		AND	7
  DE18  47            		LD	B,A
  DE19                	PRINTE2:
  DE19  03            		INC	BC
  DE1A                	PRINTE3:
  DE1A  2ABAEF        		LD	HL,(CRTCD+10)
  DE1D  A7            		AND	A
  DE1E  ED4A          		ADC	HL,BC
  DE20                	PRINTE8:
  DE20  2805          		JR	Z,PRINT2
  DE22  ED438EEF      		LD	(_TXADR),BC
  DE26                	CTRL00:
  DE26  C9            		RET
                      	
  DE27                	PRINT2:
  DE27  CDC5DF        		CALL	SCR
  DE2A  2ABCEF        		LD	HL,(CRTCD+12)
  DE2D  09            		ADD	HL,BC
  DE2E                	SET_TXADR_HL:
  DE2E  228EEF        		LD	(_TXADR),HL
  DE31  C9            		RET
                      	
  DE32                	CTRL08:
  DE32  3A81DD        		LD	A,(INSFLG)
  DE35  FECD          		CP	0CDH		;CALL ????
  DE37  2829          		JR	Z,CTRL02
  DE39                	CTRL1D:
  DE39  2A8EEF        		LD	HL,(_TXADR)
  DE3C  7C            		LD	A,H
  DE3D  B5            		OR	L
  DE3E  C8            		RET	Z
  DE3F  2B            		DEC	HL
  DE40  18EC          		JR	SET_TXADR_HL
                      	
  DE42                	CTRL1E:
  DE42  ED4B8EEF      		LD	BC,(_TXADR)
  DE46  2ABCEF        		LD	HL,(CRTCD+12)
  DE49  09            		ADD	HL,BC
  DE4A  D0            		RET	NC
  DE4B  18E1          		JR	SET_TXADR_HL
                      	
  DE4D                	CTRL1C:
  DE4D  ED4B8EEF      		LD	BC,(_TXADR)
  DE51  18C6          		JR	PRINTE2
                      	
  DE53                	CTRL09:
  DE53  ED4B8EEF      		LD	BC,(_TXADR)
  DE57  79            		LD	A,C
  DE58  E6F8          		AND	0F8H
  DE5A  C608          		ADD	A,8
  DE5C  4F            		LD	C,A
  DE5D  88            		ADC	A,B
  DE5E  91            		SUB	C
  DE5F  47            		LD	B,A
  DE60  18B8          		JR	PRINTE3
                      	
  DE62                	CTRL02:
  DE62  CD39DE        		CALL	CTRL1D
  DE65  C8            		RET	Z
  DE66  D5            		PUSH	DE
  DE67  CDD3EF        		CALL	_POS
  DE6A  3AB1EF        		LD	A,(CRTCD+1)
  DE6D  95            		SUB	L
  DE6E  4F            		LD	C,A
  DE6F  0D            		DEC	C
  DE70  0638          		LD	B,038H
  DE72  2A8EEF        		LD	HL,(_TXADR)
  DE75  09            		ADD	HL,BC
  DE76  44            		LD	B,H
  DE77  4D            		LD	C,L
  DE78  110020        		LD	DE,02000H	;D:Text E:kanji
  DE7B  2A96EF        		LD	HL,(_COLORF)	;L:Color
  DE7E                	C8X1:
  DE7E  CD64DF        		CALL	C12S
  DE81  0B            		DEC	BC
  DE82  20FA          		JR	NZ,C8X1
  DE84  D1            		POP	DE
  DE85  C9            		RET
                      	
  DE86                	CTRL05:
  DE86  CDD3EF        		CALL	_POS
  DE89  3AB1EF        		LD	A,(CRTCD+1)
  DE8C  95            		SUB	L
  DE8D  6F            		LD	L,A
  DE8E                	C08X1:
  DE8E  2620          		LD	H,020H
  DE90  ED4B8EEF      		LD	BC,(_TXADR)
  DE94                	C05X1:
  DE94  78            		LD	A,B
  DE95  F638          		OR	038H
  DE97  47            		LD	B,A
  DE98  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令	kanji
  DE9A  CB98          		RES	3,B
  DE9C  ED61          		OUT	(C),H		;Text
  DE9E  CBA0          		RES	4,B
  DEA0  3A96EF        		LD	A,(_COLORF)
  DEA3  ED79          		OUT	(C),A		;Color
  DEA5  03            		INC	BC
  DEA6  2D            		DEC	L
  DEA7  20EB          		JR	NZ,C05X1
  DEA9  C9            		RET
                      	
  DEAA                	CTRL0D:
  DEAA  CDD3EF        		CALL	_POS
  DEAD  2E00          		LD	L,0
  DEAF                	LOC:
  DEAF  C5            		PUSH	BC
  DEB0  E5            		PUSH	HL
  DEB1  CDF5DD        		CALL	KANCLR
  DEB4  CDD2DE        		CALL	LOC1
  DEB7  228EEF        		LD	(_TXADR),HL
  DEBA  E1            		POP	HL
  DEBB  C1            		POP	BC
  DEBC  C9            		RET
                      	
  DEBD                	CTRL12:
  DEBD  2181DD        		LD	HL,INSFLG
  DEC0  7E            		LD	A,(HL)
  DEC1  EECC          		XOR	0CCH		;CD:CALL ???? 1:LD BC,????
  DEC3  77            		LD	(HL),A
  DEC4  C9            		RET
                      	
  DEC5                	CTRL0B:
  DEC5  210000        		LD	HL,0
  DEC8  228EEF        		LD	(_TXADR),HL
  DECB  C9            		RET
                      	
  DECC                	CTRL1B:
  DECC  3E01          		LD	A,1
  DECE  3278DD        		LD	(ESCFLG+1),A
  DED1  C9            		RET
                      	
  DED2                	LOC1:
  DED2  D5            		PUSH	DE
  DED3  4D            		LD	C,L
  DED4  0608          		LD	B,8
  DED6  5C            		LD	E,H
  DED7  1600          		LD	D,0
  DED9  2AB0EF        		LD	HL,(CRTCD)
  DEDC  6A            		LD	L,D
  DEDD                	LOC2:
  DEDD  29            		ADD	HL,HL
  DEDE  3001          		JR	NC,LOC3
  DEE0  19            		ADD	HL,DE
  DEE1                	LOC3:
  DEE1  10FA          		DJNZ	LOC2
  DEE3  09            		ADD	HL,BC
  DEE4  D1            		POP	DE
  DEE5  C9            		RET
                      	
  DEE6                	CONOUT1:
  DEE6  CDF8DE        		CALL	CURSOR
  DEE9  59            		LD	E,C
  DEEA  CDCDEF        		CALL	_PRINT
  DEED  7B            		LD	A,E
  DEEE  FE0A          		CP	00AH
  DEF0  2006          		JR	NZ,CURSOR
  DEF2  CDAADE        		CALL	CTRL0D
  DEF5  CD86DE        		CALL	CTRL05
  DEF8                	CURSOR:
  DEF8  C5            		PUSH	BC
  DEF9  ED4B8EEF      		LD	BC,(_TXADR)
  DEFD  CBE8          		SET	5,B
  DEFF  ED78          		IN	A,(C)
  DF01  EE18          		XOR	018H
  DF03  ED79          		OUT	(C),A
  DF05  C1            		POP	BC
  DF06  C9            		RET
                      	
  DF07                	CTRL07:
  DF07  2161EF        		LD	HL,BEEPD
  DF0A                	BEEP1:
  DF0A  7E            		LD	A,(HL)
  DF0B  23            		INC	HL
  DF0C  FEFF          		CP	0FFH
  DF0E  C8            		RET	Z
  DF0F  F3            		DI
  DF10  061C          		LD	B,01CH
  DF12  ED79          		OUT	(C),A
  DF14  EDA3          		OUTI
  DF16  FB            		EI
  DF17  18F1          		JR	BEEP1
                      	
  DF19                	OT49SB:
  DF19  C5            		PUSH	BC
  DF1A  CD35DF        		CALL	CANW
  DF1D  010019        		LD	BC,01900H
  DF20  ED79          		OUT	(C),A
  DF22  C1            		POP	BC
  DF23  C9            		RET
                      	
  DF24                	IN49SB:
  DF24  C5            		PUSH	BC
  DF25  01011A        		LD	BC,01A01H
  DF28                	CANR:
  DF28  ED78          		IN	A,(C)
  DF2A  E620          		AND	020H
  DF2C  20FA          		JR	NZ,CANR
  DF2E  010019        		LD	BC,01900H
  DF31  ED78          		IN	A,(C)
  DF33  C1            		POP	BC
  DF34  C9            		RET
                      	
  DF35                	CANW:
  DF35  01011A        		LD	BC,01A01H
  DF38  ED48          		IN	C,(C)
  DF3A  CB71          		BIT	6,C
  DF3C  20F7          		JR	NZ,CANW
  DF3E  C9            		RET
                      	
  DF3F                	COMOUT:
  DF3F  FB            		EI
  DF40  CD19DF        		CALL	OT49SB
  DF43  CD35DF        		CALL	CANW
  DF46  F3            		DI
  DF47  C9            		RET
                      	
  DF48                	INSERT:
  DF48  D5            		PUSH	DE
  DF49  CDD3EF        		CALL	_POS
  DF4C  3AB1EF        		LD	A,(CRTCD+1)
  DF4F  95            		SUB	L
  DF50  ED4B8EEF      		LD	BC,(_TXADR)
  DF54  110020        		LD	DE,02000H	;D:Text E:Kanji
  DF57  2A96EF        		LD	HL,(_COLORF)	;L:Color
  DF5A  CBE8          		SET	5,B
  DF5C                	C12X1:
  DF5C  CD64DF        		CALL	C12S
  DF5F  03            		INC	BC
  DF60  20FA          		JR	NZ,C12X1
  DF62  D1            		POP	DE
  DF63  C9            		RET
                      	
  DF64                	C12S:
  DF64  CBE0          		SET	4,B
  DF66  CBD8          		SET	3,B
  DF68  ED60          		IN	H,(C)
  DF6A  ED59          	X1PAT:	OUT	(C),E
  DF6C  5C            		LD	E,H
  DF6D  CB98          		RES	3,B
  DF6F  ED60          		IN	H,(C)
  DF71  ED51          		OUT	(C),D
  DF73  54            		LD	D,H
  DF74  CBA0          		RES	4,B
  DF76  ED60          		IN	H,(C)
  DF78  ED69          		OUT	(C),L
  DF7A  6C            		LD	L,H
  DF7B  3D            		DEC	A
  DF7C  C9            		RET
                      	
  DF7D                	CTRL0C:
  DF7D  CDC5DE        		CALL	CTRL0B
  DF80                	CTRL06:
  DF80  ED4B8EEF      		LD	BC,(_TXADR)
  DF84                	C1AX1:
  DF84  78            		LD	A,B
  DF85  F638          		OR	038H
  DF87  47            		LD	B,A
  DF88  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令	kanji
  DF8A  CB98          		RES	3,B
  DF8C  3E20          		LD	A,020H
  DF8E  ED79          		OUT	(C),A		;Text
  DF90  CBA0          		RES	4,B
  DF92  3A96EF        		LD	A,(_COLORF)
  DF95  ED79          		OUT	(C),A		;Color
  DF97  03            		INC	BC
  DF98  CBA8          		RES	5,B
  DF9A  2ABAEF        		LD	HL,(CRTCD+10)
  DF9D  09            		ADD	HL,BC
  DF9E  30E4          		JR	NC,C1AX1
  DFA0  C9            		RET
                      	
  DFA1                	CTRL04:
  DFA1  CDD3EF        		CALL	_POS
  DFA4  7D            		LD	A,L
  DFA5  B7            		OR	A
  DFA6  C8            		RET	Z
  DFA7                	CTRL03:
  DFA7  CDAADE        		CALL	CTRL0D
  DFAA                	CTRL0A:
  DFAA                	CTRL1F:
  DFAA  ED4B8EEF      		LD	BC,(_TXADR)
  DFAE  2AB1EF        		LD	HL,(CRTCD+1)
  DFB1  2600          		LD	H,0
  DFB3  09            		ADD	HL,BC
  DFB4  44            		LD	B,H
  DFB5  4D            		LD	C,L
  DFB6  2ABAEF        		LD	HL,(CRTCD+10)
  DFB9  09            		ADD	HL,BC
  DFBA  3F            		CCF
  DFBB  9F            		SBC	A,A
  DFBC  C320DE        		JP	PRINTE8
                      	
  DFBF                	CTRL0E:
  DFBF  CDD3EF        		CALL	_POS
  DFC2  7C            		LD	A,H
  DFC3  1804          		JR	SCR1
  DFC5                	SCR:
  DFC5  3A97EF        		LD	A,(_LINE)
  DFC8  3D            		DEC	A
  DFC9                	SCR1:
  DFC9  C5            		PUSH	BC
  DFCA  D5            		PUSH	DE
  DFCB  F5            		PUSH	AF
  DFCC  3E07          		LD	A,7
  DFCE  21FFDF        		LD	HL,SCRDMAD
  DFD1  CDF5DF        		CALL	SETDMA
  DFD4  F1            		POP	AF
  DFD5  210038        		LD	HL,03800H
                      	
  DFD8                	SCRUP1:
  DFD8  B7            		OR	A
  DFD9  284D          		JR	Z,SCRCL
  DFDB  F5            		PUSH	AF
  DFDC  CD06E0        		CALL	UPSUB		;kanji
  DFDF  3ABCEF        		LD	A,(CRTCD+12)
  DFE2  5F            		LD	E,A
  DFE3  16F7          		LD	D,0F7H
  DFE5  19            		ADD	HL,DE
  DFE6  D5            		PUSH	DE
  DFE7  CD06E0        		CALL	UPSUB		;Text
  DFEA  D1            		POP	DE
  DFEB  19            		ADD	HL,DE
  DFEC  CD06E0        		CALL	UPSUB		;Color
  DFEF  CBE4          		SET	4,H
  DFF1  F1            		POP	AF
  DFF2  3D            		DEC	A
  DFF3  18E3          		JR	SCRUP1
                      	
  DFF5                	SETDMA:
  DFF5  01871F        		LD	BC,01F87H
  DFF8                	SDMA:
  DFF8  04            		INC	B
  DFF9  EDA3          		OUTI
  DFFB  3D            		DEC	A
  DFFC  20FA          		JR	NZ,SDMA
  DFFE  C9            		RET
                      	
  DFFF                	SCRDMAD:
  DFFF  C3            		DB	0C3H		;WR6 リセット
  E000  9A            		DB	09AH		;WR5 ストップ WAIT READY:HIGH
  E001  65            		DB	065H		;WR0 ブロック長(LH)
  E002  4F00          		DW	79
  E004  1C            		DB	01CH		;WR1 ポートAインクリメント I/O
  E005  18            		DB	018H		;WR0 ポートAアドレス(LH)
                      	
  E006                	UPSUB:
  E006  3AB1EF        		LD	A,(CRTCD+1)
  E009  5F            		LD	E,A
  E00A  1600          		LD	D,0
  E00C  3ECD          		LD	A,0CDH		;WR4 バースト ポートB開始アドレス(LH)
  E00E  ED79          		OUT	(C),A
  E010  ED69          		OUT	(C),L		;SOURCE
  E012  ED61          		OUT	(C),H
  E014  19            		ADD	HL,DE
  E015  3E1D          		LD	A,01DH		;WR0 ポートA開始アドレス(LH) ポートA→ポートB 転送
  E017  ED79          		OUT	(C),A
  E019  ED69          		OUT	(C),L		;DEST
  E01B  ED61          		OUT	(C),H
  E01D                	GO_DMA:
  E01D  3ECF          		LD	A,0CFH
  E01F  ED79          		OUT	(C),A		;WR6 ロード
  E021  3EB3          		LD	A,0B3H
  E023  ED79          		OUT	(C),A		;WR6 強制RDY
  E025  ED49          		OUT	(C),C		;WR6 イネーブル
  E027  C9            		RET
                      	
  E028                	SCRCL:
  E028  44            		LD	B,H
  E029  4D            		LD	C,L
  E02A  215020        		LD	HL,02000H+80
  E02D  3A96EF        		LD	A,(_COLORF)
  E030                	SCRCL1:
  E030  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  E032  CB98          		RES	3,B
  E034  ED61          		OUT	(C),H
  E036  CBA0          		RES	4,B
  E038  ED79          		OUT	(C),A
  E03A  CBD8          		SET	3,B
  E03C  CBE0          		SET	4,B
  E03E  03            		INC	BC
  E03F  2D            		DEC	L
  E040  20EE          		JR	NZ,SCRCL1
  E042  D1            		POP	DE
  E043  C1            		POP	BC
  E044  C9            		RET
                      	
  E045                	SCRN:
  E045  D5            		PUSH	DE
  E046  ED58          		IN	E,(C)		;Text
  E048  CBD8          		SET	3,B
  E04A  ED50          		IN	D,(C)		;Kanji
  E04C  2819          		JR	Z,SCRNE
  E04E  AF            		XOR	A
  E04F  C5            		PUSH	BC
  E050  013730        		LD	BC,03037H	;VRMJIS
  E053  DF            		RST	018H
  E054  01522F        		LD	BC,02F52H	;JISSFT
  E057  DF            		RST	018H
  E058  C1            		POP	BC
  E059  ED78          		IN	A,(C)
  E05B  CB98          		RES	3,B
  E05D  E640          		AND	040H
  E05F  2003          		JR	NZ,SCRN1
  E061  7A            		LD	A,D
  E062  D1            		POP	DE
  E063  C9            		RET
  E064                	SCRN1:
  E064  7B            		LD	A,E
  E065  D1            		POP	DE
  E066  C9            		RET
                      	
  E067                	SCRNE:
  E067  D1            		POP	DE
  E068  CB98          		RES	3,B
  E06A                	SCRNX:
  E06A  ED78          		IN	A,(C)
  E06C  C9            		RET
                      	
  E06D                	POS:
  E06D  2A8EEF        		LD	HL,(_TXADR)
  E070  C5            		PUSH	BC
  E071  ED4BBCEF      		LD	BC,(CRTCD+12)
  E075  AF            		XOR	A
  E076                	POS1:
  E076  09            		ADD	HL,BC
  E077  3C            		INC	A
  E078  38FC          		JR	C,POS1
  E07A  ED42          		SBC	HL,BC
  E07C  3D            		DEC	A
  E07D  67            		LD	H,A
  E07E  C1            		POP	BC
  E07F  A7            		AND	A
  E080  C9            		RET
                      	
  E081                	GETL:
  E081  CDD3EF        		CALL	_POS
  E084  E5            		PUSH	HL
  E085  3ECD          		LD	A,0CDH		;CALL ????
  E087  3281DD        		LD	(INSFLG),A
  E08A                	GETL1:
  E08A  CD3ADC        		CALL	_SYS08
  E08D  FE09          		CP	9
  E08F  2008          		JR	NZ,GETL1V
  E091  2100FF        		LD	HL,KBUF
  E094  CD6FD8        		CALL	MSX
  E097  18F1          		JR	GETL1
  E099                	GETL1V:
  E099  5F            		LD	E,A
  E09A  CDCDEF        		CALL	_PRINT
                      	
  E09D  7B            		LD	A,E
  E09E  FE0D          		CP	00DH
  E0A0  20E8          		JR	NZ,GETL1
  E0A2  3E01          		LD	A,1		;LD BC,????
  E0A4  3281DD        		LD	(INSFLG),A
  E0A7  1100FF        		LD	DE,KBUF
  E0AA  3AB1EF        		LD	A,(CRTCD+1)
  E0AD  47            		LD	B,A
  E0AE  CD08D5        		CALL	ZERO_MEMORY_DE
                      	
  E0B1  D1            		POP	DE
  E0B2  CDD3EF        		CALL	_POS
  E0B5  6B            		LD	L,E
  E0B6  3AB1EF        		LD	A,(CRTCD+1)
  E0B9  95            		SUB	L
  E0BA  57            		LD	D,A
  E0BB  CDD2DE        		CALL	LOC1
  E0BE  4D            		LD	C,L
  E0BF  7C            		LD	A,H
  E0C0  F630          		OR	030H
  E0C2  47            		LD	B,A
  E0C3  5A            		LD	E,D
  E0C4  2100FF        		LD	HL,KBUF
  E0C7                	GETL2:
  E0C7  CDD0EF        		CALL	_SCRN
  E0CA  03            		INC	BC
  E0CB  77            		LD	(HL),A
  E0CC  23            		INC	HL
  E0CD  1D            		DEC	E
  E0CE  20F7          		JR	NZ,GETL2
  E0D0                	GETL3:
  E0D0  2B            		DEC	HL
  E0D1  7E            		LD	A,(HL)
  E0D2  FE21          		CP	021H
  E0D4  D0            		RET	NC
  E0D5  3600          		LD	(HL),0
  E0D7  15            		DEC	D
  E0D8  20F6          		JR	NZ,GETL3
  E0DA  C9            		RET
                      	
  E0DB                	INKEY:
  E0DB  FB            		EI
  E0DC  E5            		PUSH	HL
  E0DD  2A90EF        		LD	HL,(_KEYPS)
  E0E0  7C            		LD	A,H
  E0E1  AD            		XOR	L
  E0E2  2809          		JR	Z,INKEY1
  E0E4  7C            		LD	A,H
  E0E5  3C            		INC	A
  E0E6  3291EF        		LD	(_KEYPS+1),A
  E0E9  6F            		LD	L,A
  E0EA  26FE          		LD	H,KEYBF/256
  E0EC  7E            		LD	A,(HL)
  E0ED                	INKEY1:
  E0ED  E1            		POP	HL
  E0EE  B7            		OR	A
  E0EF  C9            		RET
                      	
  10A0                	AT_RS	EQU	SCR1-AT_SCR1
                      	
                      	;LDFILE.ASM
                      	
                      	;	LSX-Dodgers FILE
                      	
  E0F0                	FILEC:
  E0F0  CDFBE0        		CALL	FILE
  E0F3                	FILEC2:
  E0F3  3A15EF        		LD	A,(FDRV+1)
  E0F6  FE20          		CP	020H
  E0F8  C8            		RET	Z
  E0F9  1839          		JR	SETDIR1
                      	
  E0FB                	FILE:
  E0FB  AF            		XOR	A
  E0FC  3214EF        		LD	(FDRV),A
  E0FF  67            		LD	H,A
  E100  6F            		LD	L,A
  E101  2222EF        		LD	(FDRV+14),HL
  E104  CDD2E1        		CALL	SPCUT
  E107  CDB7E1        		CALL	CCHK3
  E10A  2812          		JR	Z,DEVI1
  E10C  13            		INC	DE
  E10D  1A            		LD	A,(DE)
  E10E  1B            		DEC	DE
  E10F  FE3A          		CP	':'
  E111  200B          		JR	NZ,DEVI1
  E113  1A            		LD	A,(DE)		;DRIVE
  E114  CD07E4        		CALL	CAP
  E117  D640          		SUB	'@'
  E119  13            		INC	DE
  E11A  13            		INC	DE
  E11B  3214EF        		LD	(FDRV),A
  E11E                	DEVI1:
  E11E  1A            		LD	A,(DE)
  E11F  D65C          		SUB	05CH		;\
  E121  2009          		JR	NZ,NOROOT
  E123  6F            		LD	L,A		;A=0でH=0のはずなのでHL=0
  E124  222EEF        		LD	(FDRV+26),HL
  E127  2C            		INC	L
  E128  2222EF        		LD	(FDRV+14),HL
  E12B  13            		INC	DE
  E12C                	NOROOT:
                      	
  E12C                	SETDIR:
  E12C  CD58E1        		CALL	FILED
  E12F  1A            		LD	A,(DE)
  E130  FE5C          		CP	05CH		;\
  E132  C0            		RET	NZ
  E133  13            		INC	DE
  E134                	SETDIR1:
  E134  3E10          		LD	A,010H		;Directory
  E136  3221EF        		LD	(FDRV+13),A
  E139  D5            		PUSH	DE
  E13A  1114EF        		LD	DE,FDRV
  E13D  2A1EF0        		LD	HL,(STABLE+2*00FH)
  E140  CD0F00        		CALL	JP_HL
  E143  D1            		POP	DE
  E144  B7            		OR	A
  E145  C0            		RET	NZ
                      	
  E146  3A21EF        		LD	A,(FDRV+13)
  E149  CB67          		BIT	4,A
  E14B  C8            		RET	Z
                      	
  E14C  CD9FE1        		CALL	FILEI
  E14F  2A2EEF        		LD	HL,(FDRV+26)
  E152  23            		INC	HL
  E153  2222EF        		LD	(FDRV+14),HL
  E156  18D4          		JR	SETDIR
                      	
  E158                	FILED:
  E158  CD9FE1        		CALL	FILEI
  E15B  2115EF        		LD	HL,FNAME
                      	
  E15E  0608          		LD	B,8
  E160                	FILE2:
  E160  CDACE1        		CALL	CCHKF
  E163  C8            		RET	Z
  E164  FE2A          		CP	'*'
  E166  282E          		JR	Z,FILE9
  E168  FE2E          		CP	'.'
  E16A  280C          		JR	Z,FILE4
  E16C  77            		LD	(HL),A
  E16D  23            		INC	HL
  E16E  10F0          		DJNZ	FILE2
                      	
  E170                	FILE3:
  E170  CDACE1        		CALL	CCHKF
  E173  C8            		RET	Z
  E174  FE2E          		CP	'.'
  E176  20F8          		JR	NZ,FILE3
                      	
  E178                	FILE4:
  E178  211DEF        		LD	HL,FNAME+8
  E17B  0603          		LD	B,3
                      	
  E17D                	FILE4L:
  E17D  CDACE1        		CALL	CCHKF
  E180  C8            		RET	Z
  E181  FE2E          		CP	'.'
  E183  2008          		JR	NZ,FILE12
  E185  3215EF        		LD	(FNAME),A	;Parent directory(..)
  E188  3216EF        		LD	(FNAME+1),A
  E18B  3E20          		LD	A,020H
  E18D                	FILE12:
  E18D  FE2A          		CP	'*'
  E18F  280A          		JR	Z,FILE10
  E191  77            		LD	(HL),A
  E192  23            		INC	HL
  E193  10E8          		DJNZ	FILE4L
  E195  C9            		RET
                      	
  E196                	FILE9:				;名前の*処理、名前の残りを?で埋める
  E196  CD9BE1        		CALL	FILE10
  E199  18D5          		JR	FILE3
                      	
  E19B                	FILE10:
  E19B  3E3F          		LD	A,'?'
  E19D  1808          		JR	FILL_MEMORY
  E19F                	FILEI:				;名前＋拡張子をスペースで初期化
  E19F  3E20          		LD	A,020H
  E1A1  01000B        		LD	BC,11*256	;C=0にしておく
  E1A4  2115EF        		LD	HL,FNAME
  E1A7                	FILL_MEMORY:			;HLからBバイトAで埋める
  E1A7  77            		LD	(HL),A
  E1A8  23            		INC	HL
  E1A9  10FC          		DJNZ	FILL_MEMORY
  E1AB  C9            		RET
                      	
  E1AC                	CCHKF:
  E1AC  1A            		LD	A,(DE)
  E1AD  CDB4E1        		CALL	CCHK2
  E1B0  C8            		RET	Z
  E1B1  C31FE5        		JP	FKAN
                      	
  E1B4                	CCHK2:
  E1B4  0C            		INC	C
  E1B5  0D            		DEC	C
  E1B6  C0            		RET	NZ
  E1B7                	CCHK3:				;ZF=1 で使えない文字
  E1B7  FE2B          		CP	'+'
  E1B9  C8            		RET	Z
  E1BA  FE2C          		CP	','
  E1BC  C8            		RET	Z
  E1BD  FE2F          		CP	'/'
  E1BF  C8            		RET	Z
  E1C0  FE3A          		CP	':'
  E1C2  C8            		RET	Z
  E1C3  FE3B          		CP	';'
  E1C5  C8            		RET	Z
  E1C6  FE3D          		CP	'='
  E1C8  C8            		RET	Z
  E1C9  FE5C          		CP	05CH	;\
  E1CB  C8            		RET	Z
  E1CC  FE20          		CP	020H
  E1CE  D0            		RET	NC
  E1CF  BF            		CP	A		;Z=1
  E1D0  C9            		RET
                      	
  E1D1                	SS1:
  E1D1  13            		INC	DE
  E1D2                	SPCUT:				;スペースをカット
  E1D2  1A            		LD	A,(DE)
  E1D3  FE20          		CP	020H
  E1D5  28FA          		JR	Z,SS1
  E1D7  C9            		RET
                      	
  E1D8                	SETDRVF:
  E1D8  1114EF        		LD	DE,FDRV
  E1DB                	SETDRV0:
  E1DB  CDE4E1        		CALL	SETDRV
  E1DE  FDE1          		POP	IY
  E1E0  C1            		POP	BC
  E1E1  D1            		POP	DE
  E1E2  E1            		POP	HL
  E1E3  C9            		RET
                      	
  E1E4                	SETDRV:
  E1E4  E3            		EX	(SP),HL		;HL=RETRN ADDRESS
  E1E5  D5            		PUSH	DE		;PUSH HL/DE/BC/IY
  E1E6  C5            		PUSH	BC
  E1E7  1A            		LD	A,(DE)
  E1E8  D5            		PUSH	DE
  E1E9  FDE3          		EX	(SP),IY
                      	
  E1EB  CDF7E1        		CALL	GETDRV
  E1EE  3C            		INC	A
  E1EF  FD7700        		LD	(IY+0),A	;(FCB)ドライブ番号
  E1F2  3D            		DEC	A
  E1F3  CDD9EF        		CALL	_CHGDRV
                      	
  E1F6  E9            		JP	(HL)
                      	
  E1F7                	GETDRV:
  E1F7  E67F          		AND	07FH
  E1F9  D601          		SUB	001H
  E1FB  3003          		JR	NC,GETDRV1
  E1FD  3A87EF        		LD	A,(_DVSW)	;Current Drive
  E200                	GETDRV1:
  E200  3288EF        		LD	(_DRV),A
  E203  C9            		RET
                      	
  E204                	SOPENX:
  E204  1139EF        		LD	DE,SFILE
  E207  1A            		LD	A,(DE)
  E208  FDBE00        		CP	(IY+0)		;(FCB)ドライブ番号
  E20B  2024          		JR	NZ,SOPEN
  E20D  13            		INC	DE
  E20E  FDE5          		PUSH	IY
  E210  E1            		POP	HL
  E211  23            		INC	HL
  E212  CD9FE3        		CALL	CPFILE
  E215  201A          		JR	NZ,SOPEN
                      	
  E217  2AF4F0        		LD	HL,(SCDIR)
  E21A  FD750E        		LD	(IY+14),L	;(FCB)アクセスするディレクトリのクラスタ番号+1
  E21D  FD740F        		LD	(IY+15),H
                      	
  E220  2AF8F0        		LD	HL,(SFNDF)	;Direcroty location and Flags
  E223  229FEF        		LD	(_FILEN),HL
                      	
  E226  ED5BF6F0      		LD	DE,(SFBPS)
  E22A  2139EF        		LD	HL,SFILE
  E22D  36FF          		LD	(HL),0FFH
  E22F  23            		INC	HL
  E230  C9            		RET
  E231                	SOPEN:
  E231  2147E3        		LD	HL,FILESE
  E234                	SOPENC:
  E234  226DE2        		LD	(OPENPAT+1),HL
                      	
  E237  CDE2EF        		CALL	_RDFATX		;Detect Media
  E23A  3856          		JR	C,RDDERR
                      	
  E23C  AF            		XOR	A
  E23D  329FEF        		LD	(_FILEN),A
  E240  CD4CE4        		CALL	LDDIRX1		;A=0で呼び出す
  E243  2818          		JR	Z,SDIRX1
                      	
  E245  CD38E3        		CALL	READ_DIR	;Sub Directory
  E248  3808          		JR	C,SDIRX0
  E24A  2A7EF0        		LD	HL,(_DTBUF)
  E24D  7E            		LD	A,(HL)
  E24E  FE2E          		CP	'.'
  E250  280F          		JR	Z,SOPEN1
  E252                	SDIRX0:
  E252  AF            		XOR	A
  E253  32A0EF        		LD	(_DIRF),A
  E256  FD360E01      		LD	(IY+14),1	;(FCB)レコードサイズ
  E25A  FD770F        		LD	(IY+15),A
  E25D                	SDIRX1:
  E25D  ED5BFCF0      		LD	DE,(_DIRPS)	;Root Directory
  E261                	SOPEN1:
  E261  0E20          	SDECPAT:LD	C,32		;自己書き換え 1セクタ辺りのディレクトリエントリ数  1024=32 / 512=16 / 256=8
  E263                	SOPEN1X:
  E263  CD38E3        		CALL	READ_DIR	;FILE SEARCH
  E266  382A          		JR	C,RDDERR
  E268  2A7EF0        		LD	HL,(_DTBUF)
  E26B                	SOPEN2:
  E26B  D5            		PUSH	DE
  E26C  CD47E3        	OPENPAT:CALL	FILESE		;(self-modifying code)
  E26F  D1            		POP	DE
  E270  386E          		JR	C,SOPENE
  E272  281B          		JR	Z,SCF_FF_RET
  E274                	SOPEN3:
  E274  3AA0EF        		LD	A,(_DIRF)	;ディレクトリか判別
  E277  B7            		OR	A
  E278  200C          		JR	NZ,SOPEN5
  E27A  13            		INC	DE		;ルートディレクトリ
  E27B  E5            		PUSH	HL
  E27C  210C00        	MD_PAT:	LD	HL,12		;(self-modifying code)MAXDIR
  E27F  ED52          		SBC	HL,DE		;CF=0 なので SUB HL,DE
  E281  E1            		POP	HL
  E282  20DD          		JR	NZ,SOPEN1
  E284  1807          		JR	SOPEN6
  E286                	SOPEN5:
  E286  CD97EA        		CALL	GNCLX		;END DIR
  E289  D8            		RET	C
  E28A  CDFFE3        		CALL	ENDCL
  E28D                	SOPEN6:
  E28D  38D2          		JR	C,SOPEN1
  E28F                	SCF_FF_RET:
  E28F  37            		SCF			;CF=1
  E290  9F            		SBC	A,A		;A=0FFH
  E291  C9            		RET
                      	
  E292                	RDDERR:
  E292  BF            		CP	A		;READ ERR CF=1 ZF=1
  E293  37            		SCF
  E294  C9            		RET
                      	
  E295                	NOPEN:
  E295  2147E3        		LD	HL,FILESE
  E298  226DE2        		LD	(OPENPAT+1),HL
  E29B  FD2A98EF      		LD	IY,(_FCB)
  E29F  CD32E5        		CALL	CHKWILDX
  E2A2  30EB          		JR	NC,SCF_FF_RET
  E2A4  FD7E00        		LD	A,(IY+0)	;(FCB)ドライブ番号
  E2A7  3D            		DEC	A
  E2A8  3288EF        		LD	(_DRV),A
  E2AB  CDD9EF        		CALL	_CHGDRV
  E2AE  D8            		RET	C
  E2AF  2AF8F0        		LD	HL,(SFNDF)	;Direcroty location and Flags
  E2B2  229FEF        		LD	(_FILEN),HL
                      	
  E2B5  CD47E4        		CALL	LDDIRX
  E2B8  ED5B9AEF      		LD	DE,(_FBPS)
  E2BC  CD38E3        		CALL	READ_DIR
  E2BF  38D1          		JR	C,RDDERR
  E2C1  3A9EEF        		LD	A,(_FBCNT)
  E2C4  3D            		DEC	A
  E2C5  28AD          		JR	Z,SOPEN3
  E2C7                	NOPEN2:
  E2C7  2A9CEF        		LD	HL,(_FBAD)
  E2CA  012000        		LD	BC,020H
  E2CD  09            		ADD	HL,BC
  E2CE  4F            		LD	C,A
  E2CF  189A          		JR	SOPEN2
                      	
  E2D1                	SOPENE2:
  E2D1  229CEF        		LD	(_FBAD),HL
  E2D4  79            		LD	A,C
  E2D5  329EEF        		LD	(_FBCNT),A
  E2D8  ED539AEF      		LD	(_FBPS),DE
  E2DC  FD2298EF      		LD	(_FCB),IY
  E2E0                	SOPENE:
  E2E0  AF            		XOR	A
  E2E1  C9            		RET
                      	
  E2E2                	COPEN:
  E2E2  FD360D20      		LD	(IY+13),020H	;(FCB)属性(アトリビュート)
                      	
  E2E6  2164E3        		LD	HL,NEXTSE
  E2E9  CD34E2        		CALL	SOPENC
  E2EC  D0            		RET	NC
  E2ED  C8            		RET	Z
  E2EE  3AA0EF        		LD	A,(_DIRF)	;ディレクトリか判別
  E2F1  B7            		OR	A
  E2F2  37            		SCF
  E2F3  C8            		RET	Z		;ルートディレクトリ
  E2F4  0601          		LD	B,1
  E2F6  CD8EE5        		CALL	WRDF
  E2F9  D8            		RET	C
  E2FA  ED5BFEF0      		LD	DE,(_CLPS)
  E2FE  D5            		PUSH	DE
  E2FF  CDC8E3        		CALL	DCPAT
  E302  CD22E9        		CALL	DRDNX
  E305  2A7EF0        		LD	HL,(_DTBUF)	;ディレクトリエントリを0クリア
  E308  3A9DE8        		LD	A,(SECSZ+2)	;1024=4 / 512=2 / 256=1
  E30B  47            		LD	B,A
  E30C  AF            		XOR	A
  E30D  4F            		LD	C,A
  E30E                	COPENCL:
  E30E  77            		LD	(HL),A
  E30F  EDA1          		CPI			;HL=HL+1 BC=BC-1 BCが0の場合にP/V=0
  E311  EA0EE3        		JP	PE,COPENCL
                      	
  E314  3AE6E3        		LD	A,(SPCPAT+1)	;1クラスタの論理セクタ数
  E317  3D            		DEC	A
  E318  2819          		JR	Z,COPENE
  E31A  3E01          		LD	A,1		;1セクタ辺りのセクタ数が2以上の場合
  E31C  328FEA        		LD	(_SECPS+1),A
  E31F  D1            		POP	DE		;DE=(_CLPS)
  E320  D5            		PUSH	DE
  E321                	COPEN1:
  E321  D5            		PUSH	DE		;データバッファに入らないセクタもゼロクリア
  E322  C5            		PUSH	BC
  E323  2A7EF0        		LD	HL,(_DTBUF)
  E326  CDE2E3        		CALL	CLUSTX
  E329  CDFBEB        		CALL	DWT24
  E32C  C1            		POP	BC
  E32D  D1            		POP	DE
  E32E  CD8EEA        		CALL	NEXTX
  E331  20EE          		JR	NZ,COPEN1
  E333                	COPENE:
  E333  2A7EF0        		LD	HL,(_DTBUF)
  E336  D1            		POP	DE
  E337  C9            		RET
                      	
  E338                	READ_DIR:
  E338  ED53FEF0      		LD	(_CLPS),DE
  E33C  C5            		PUSH	BC
  E33D  D5            		PUSH	DE
  E33E  CDC8E3        		CALL	DCPAT
  E341  CD02E9        		CALL	DRDX
  E344  D1            		POP	DE
  E345  C1            		POP	BC
  E346  C9            		RET
                      	
  E347                	FILESE:
  E347  7E            		LD	A,(HL)
  E348  B7            		OR	A
  E349  C8            		RET	Z		;END:ZF=1 CF=0
  E34A  FEE5          		CP	0E5H
  E34C  280E          		JR	Z,FILESE1
  E34E  FDE5          		PUSH	IY
  E350  D1            		POP	DE
  E351  13            		INC	DE
  E352  E5            		PUSH	HL
  E353  CD9FE3        		CALL	CPFILE
  E356  CCC0E3        		CALL	Z,CPFILE2
  E359  E1            		POP	HL
  E35A  37            		SCF
  E35B  C8            		RET	Z		;!!!:(ZF=1) CF=1
  E35C                	FILESE1:
  E35C  CD73E3        		CALL	FNEXT
  E35F  20E6          		JR	NZ,FILESE
  E361                	ZF0_CF0_AFF_RET:
  E361  F6FF          		OR	0FFH		;ZF=0 CF=0
  E363  C9            		RET
                      	
  E364                	NEXTSE:
  E364  7E            		LD	A,(HL)
  E365  B7            		OR	A
  E366  37            		SCF
  E367  C8            		RET	Z		;!!!:ZF=1 CF=1
  E368  FEE5          		CP	0E5H
  E36A  37            		SCF
  E36B  C8            		RET	Z		;!!!:(ZF=1) CF=1
  E36C  CD73E3        		CALL	FNEXT
  E36F  20F3          		JR	NZ,NEXTSE
  E371  18EE          		JR	ZF0_CF0_AFF_RET
                      	
  E373                	FNEXT:
  E373  E5            		PUSH	HL
  E374  219FEF        		LD	HL,_FILEN
  E377  34            		INC	(HL)
  E378  E1            		POP	HL
  E379  112000        		LD	DE,020H
  E37C  19            		ADD	HL,DE
  E37D  0D            		DEC	C
  E37E  C9            		RET
                      	
  E37F                	CPNAME:
  E37F  C5            		PUSH	BC
  E380  D5            		PUSH	DE
  E381  E5            		PUSH	HL
  E382  CD99E3        		CALL	CPFILE4
  E385  E1            		POP	HL
  E386  23            		INC	HL
  E387  23            		INC	HL
  E388  23            		INC	HL
  E389  23            		INC	HL
  E38A  D1            		POP	DE
  E38B  C1            		POP	BC
  E38C  2005          		JR	NZ,CPNAME1
  E38E  7E            		LD	A,(HL)
  E38F  23            		INC	HL
  E390  66            		LD	H,(HL)
  E391  6F            		LD	L,A
  E392  C9            		RET
  E393                	CPNAME1:
  E393  23            		INC	HL
  E394  23            		INC	HL
  E395  10E8          		DJNZ	CPNAME
  E397  37            		SCF
  E398  C9            		RET
                      	
  E399                	CPFILE4:
  E399  C5            		PUSH	BC
  E39A  010004        		LD	BC,00400H
  E39D  1804          		JR	CPSTR1
  E39F                	CPFILE:
  E39F  C5            		PUSH	BC
  E3A0  01000B        		LD	BC,00B00H
  E3A3                	CPSTR1:
  E3A3  1A            		LD	A,(DE)
  E3A4  FE3F          		CP	'?'		;Wild card
  E3A6  2812          		JR	Z,CPSTR2
  E3A8  7E            		LD	A,(HL)
  E3A9  CD18E5        		CALL	FKANC
  E3AC  E5            		PUSH	HL
  E3AD  67            		LD	H,A
  E3AE  1A            		LD	A,(DE)
  E3AF  CB01          		RLC	C
  E3B1  CD18E5        		CALL	FKANC
  E3B4  CB09          		RRC	C
  E3B6  BC            		CP	H		;CP (HL),(DE)
  E3B7  E1            		POP	HL
  E3B8  2004          		JR	NZ,CPSTR3
  E3BA                	CPSTR2:
  E3BA  13            		INC	DE
  E3BB  23            		INC	HL
  E3BC  10E5          		DJNZ	CPSTR1
  E3BE                	CPSTR3:
  E3BE  C1            		POP	BC
  E3BF  C9            		RET
                      	
  E3C0                	CPFILE2:
  E3C0  FD7E0D        		LD	A,(IY+13)	;(FCB)属性(アトリビュート)
  E3C3  F6E1          		OR	0E1H
  E3C5  2F            		CPL
  E3C6  A6            		AND	(HL)
  E3C7  C9            		RET
                      	
  E3C8                	DCPAT:
  E3C8  0E00          		LD	C,0
  E3CA  2A7EF0        		LD	HL,(_DTBUF)
  E3CD  3AA0EF        		LD	A,(_DIRF)	;ディレクトリか判別
  E3D0  B7            		OR	A
  E3D1  C8            		RET	Z		;ルートディレクトリの場合はCレジスタを0にしておく(CDEがセクタ番号)
  E3D2  3AE6E3        		LD	A,(SPCPAT+1)
  E3D5  4F            		LD	C,A
  E3D6  3A8FEA        		LD	A,(_SECPS+1)
  E3D9  B9            		CP	C
  E3DA  3801          		JR	C,DC1
  E3DC  AF            		XOR	A
  E3DD                	DC1:
  E3DD  F680          		OR	080H
  E3DF  32A0EF        		LD	(_DIRF),A	;bit0-6:セクタインデックス
  E3E2                	CLUSTX:
  E3E2  E5            		PUSH	HL
  E3E3  EB            		EX	DE,HL
  E3E4  AF            		XOR	A
  E3E5  0E01          	SPCPAT:	LD	C,1		;自己書き換え（1クラスタの論理セクタ数）
  E3E7                	L_CLDBL:
  E3E7  CB19          		RR	C		;->CF
  E3E9  3804          		JR	C,E_CLDBL
  E3EB  29            		ADD	HL,HL		;*2
  E3EC  8F            		ADC	A,A
  E3ED  18F8          		JR	L_CLDBL
  E3EF                	E_CLDBL
  E3EF  4F            		LD	C,A
  E3F0  3A8FEA        		LD	A,(_SECPS+1)
  E3F3  B5            		OR	L
  E3F4  6F            		LD	L,A
  E3F5  110800        	CLSPAT:	LD	DE,8	;+8 (2D)  !ADDCL (self-modifying code)
  E3F8  AF            		XOR	A
  E3F9  19            		ADD	HL,DE	;データ格納領域の先頭論理セクタ番号
  E3FA  89            		ADC	A,C
  E3FB  4F            		LD	C,A
  E3FC  EB            		EX	DE,HL
  E3FD  E1            		POP	HL
  E3FE  C9            		RET
                      	
  E3FF                	ENDCL:
  E3FF  7A            		LD	A,D	;END CLUSTER
  E400  FE01          	CLPAT1:	CP	1	;164=356	(self-modifying code)
  E402  C0            		RET	NZ
  E403  7B            		LD	A,E
  E404  FE64          	CLPAT2:	CP	064H	;		(self-modifying code)
  E406  C9            		RET
                      	
  E407                	CAP:
  E407  FE61          		CP	'a'
  E409  D8            		RET	C
  E40A  FE7B          		CP	'z'+1
  E40C  D0            		RET	NC
  E40D  D620          		SUB	020H
  E40F  C9            		RET
  E410                	CAP2:
  E410  CD07E4        		CALL	CAP
  E413                	CAP3:
  E413  CD1CE4        		CALL	CAP4
  E416  FE21          		CP	021H
  E418  D0            		RET	NC
  E419  3EA0          		LD	A,0A0H
  E41B  C9            		RET
  E41C                	CAP4:
  E41C  FE05          		CP	5
  E41E  C0            		RET	NZ
  E41F  3EE5          		LD	A,0E5H
  E421  C9            		RET
                      	
  E422                	CHDIR:
  E422  CD32ED        		CALL	GETDPBD
  E425  381D          		JR	C,CHDIR2
  E427  DD751A        		LD	(IX+01AH),L		;_SDIR_
  E42A  DD741B        		LD	(IX+01BH),H		;_SDIR_+1
  E42D  1815          		JR	CHDIR2		;POP_IX_RET
                      	
  E42F                	LDDIR:
  E42F  CD32ED        		CALL	GETDPBD
  E432  DD5E1A        		LD	E,(IX+01AH)		;_SDIR_
  E435  DD561B        		LD	D,(IX+01BH)		;_SDIR_+1
  E438  13            		INC	DE
  E439  FD730E        		LD	(IY+14),E	;(FCB)アクセスするディレクトリのクラスタ番号+1
  E43C  FD720F        		LD	(IY+15),D
  E43F  1B            		DEC	DE
  E440  AF            		XOR	A
  E441  32A0EF        		LD	(_DIRF),A
  E444                	CHDIR2:
  E444  DDE1          		POP	IX
  E446  C9            		RET
                      	
  E447                	LDDIRX:
  E447  3AA0EF        		LD	A,(_DIRF)	;(FCB)アクセスするディレクトリのセクタインデックス
  E44A  E67F          		AND	07FH
  E44C                	LDDIRX1:
  E44C  328FEA        		LD	(_SECPS+1),A
  E44F  FD5E0E        		LD	E,(IY+14)	;(FCB)アクセスするディレクトリのクラスタ番号+1
  E452  FD560F        		LD	D,(IY+15)
  E455  1B            		DEC	DE
  E456  CDFFE3        		CALL	ENDCL
  E459  D42FE4        		CALL	NC,LDDIR
  E45C                	LDDIRS:
  E45C  7A            		LD	A,D
  E45D  B3            		OR	E
  E45E  32A0EF        		LD	(_DIRF),A	;ディレクトリか判別
  E461  C9            		RET
                      	
  E462                	KILL:
  E462  CD32E5        		CALL	CHKWILDX
  E465  3834          		JR	C,KILLW
  E467  CD04E2        		CALL	SOPENX
  E46A                	KILLS:
  E46A  3E1F          		LD	A,01FH
  E46C  D4AEE4        		CALL	NC,CHKATT
  E46F  D8            		RET	C
  E470                	KILLSX:
  E470  36E5          		LD	(HL),0E5H	;DIR
  E472  CD0CE5        		CALL	WTDB
  E475  111A00        		LD	DE,01AH
  E478  19            		ADD	HL,DE
  E479  5E            		LD	E,(HL)
  E47A  23            		INC	HL
  E47B  56            		LD	D,(HL)
  E47C                	KILLS1:
  E47C  CDFFE3        		CALL	ENDCL
  E47F  D0            		RET	NC		;CF=0
  E480  21FEFF        		LD	HL,0-2
  E483  19            		ADD	HL,DE
  E484  D0            		RET	NC		;DE= 0 or 1
  E485  D5            		PUSH	DE
  E486  CDF7EF        		CALL	_GNCL
  E489  ED53FEF0      		LD	(_CLPS),DE
  E48D  D1            		POP	DE
  E48E  210000        		LD	HL,0
  E491  D4FAEF        		CALL	NC,_SNCL
  E494  D8            		RET	C
  E495  ED5BFEF0      		LD	DE,(_CLPS)	;FAT
  E499  18E1          		JR	KILLS1
                      	
  E49B                	KILLW:
  E49B  CD31E2        		CALL	SOPEN
  E49E                	KILLW1:
  E49E  380B          		JR	C,KILLW2
  E4A0  CDD1E2        		CALL	SOPENE2
  E4A3  CD6AE4        		CALL	KILLS
  E4A6  CD95E2        		CALL	NOPEN
  E4A9  18F3          		JR	KILLW1
  E4AB                	KILLW2:
  E4AB  C8            		RET	Z
  E4AC  3F            		CCF
  E4AD  C9            		RET
                      	
  E4AE                	CHKATT:
  E4AE  E5            		PUSH	HL
  E4AF  110B00        		LD	DE,00BH
  E4B2  19            		ADD	HL,DE
  E4B3  A6            		AND	(HL)
  E4B4  E1            		POP	HL
  E4B5  C8            		RET	Z
  E4B6  37            		SCF
  E4B7  C9            		RET
                      	
  E4B8                	NAME:
  E4B8  CD32E5        		CALL	CHKWILDX
  E4BB  D8            		RET	C
  E4BC  110400        		LD	DE,4
  E4BF  19            		ADD	HL,DE
  E4C0  22D8E4        		LD	(NAMEP+2),HL
  E4C3  23            		INC	HL
  E4C4  CD36E5        		CALL	CHKWILD
  E4C7  D8            		RET	C
                      	
  E4C8  CD04E2        		CALL	SOPENX
  E4CB  3E0F          		LD	A,00FH
  E4CD  D4AEE4        		CALL	NC,CHKATT
  E4D0  D8            		RET	C
                      	
  E4D1  FD7E00        		LD	A,(IY+0)
  E4D4  FDE5          		PUSH	IY
  E4D6  FD210000      	NAMEP:	LD	IY,0		;自己書き換え
  E4DA  FD7700        		LD	(IY+0),A
  E4DD  CD04E2        		CALL	SOPENX
  E4E0  FDE3          		EX	(SP),IY
  E4E2  3F            		CCF
  E4E3  D431E2        		CALL	NC,SOPEN
  E4E6  EB            		EX	DE,HL
  E4E7  E1            		POP	HL
  E4E8  D8            		RET	C
                      	
  E4E9                	SETNAME:
  E4E9  01000B        		LD	BC,11*256
  E4EC  23            		INC	HL
  E4ED  7E            		LD	A,(HL)
  E4EE  FEE5          		CP	0E5H
  E4F0  2004          		JR	NZ,SNAME1
  E4F2  3E05          		LD	A,5
  E4F4  180E          		JR	SNAME3
  E4F6                	SNAME1:
  E4F6  7E            		LD	A,(HL)
  E4F7  0C            		INC	C
  E4F8  0D            		DEC	C
  E4F9  2009          		JR	NZ,SNAME3
  E4FB  CD07E4        		CALL	CAP
  E4FE  FEA0          		CP	0A0H
  E500  2002          		JR	NZ,SNAME3
  E502  3E20          		LD	A,020H
  E504                	SNAME3:
  E504  12            		LD	(DE),A
  E505  7E            		LD	A,(HL)
  E506  23            		INC	HL
  E507  CD1FE5        		CALL	FKAN
  E50A  10EA          		DJNZ	SNAME1
  E50C                	WTDB:
  E50C  3EFF          		LD	A,0FFH
  E50E  3239EF        		LD	(SFILE),A
  E511                	SWTDBF:
  E511  3E01          		LD	A,1
  E513  32A4EF        		LD	(_WTDBF),A
  E516  AF            		XOR	A
  E517  C9            		RET
                      	
  E518                	FKANC:
  E518  CB41          		BIT	0,C
  E51A  CC10E4        		CALL	Z,CAP2
  E51D  1801          		JR	FKANX
  E51F                	FKAN:			;漢字チェック
  E51F  13            		INC	DE
  E520                	FKANX:
  E520  CB41          		BIT	0,C
  E522  CB81          		RES	0,C
  E524  C0            		RET	NZ
  E525  FE80          		CP	080H
  E527  D8            		RET	C
  E528  FEA0          		CP	0A0H
  E52A  3803          		JR	C,FKAN1
  E52C  FEE0          		CP	0E0H
  E52E  D8            		RET	C
  E52F                	FKAN1:
  E52F  0C            		INC	C
  E530  A7            		AND	A
  E531  C9            		RET
                      	
  E532                	CHKWILDX:
  E532  FDE5          		PUSH	IY
  E534  E1            		POP	HL
  E535  23            		INC	HL
  E536                	CHKWILD:
  E536  060B          		LD	B,11
  E538  3E3F          		LD	A,'?'
  E53A                	CHKWIL1:
  E53A  BE            		CP	(HL)
  E53B  23            		INC	HL
  E53C  37            		SCF
  E53D  C8            		RET	Z
  E53E  10FA          		DJNZ	CHKWIL1
  E540  AF            		XOR	A
  E541  C9            		RET
                      	
  E542                	SDIRENT:		;IY=FCB HL=DIR
  E542  D5            		PUSH	DE
  E543  E5            		PUSH	HL
  E544  FDE5          		PUSH	IY
  E546  D1            		POP	DE
  E547  EB            		EX	DE,HL
  E548  CDE9E4        		CALL	SETNAME
                      	;				Attribute
  E54B  FD7E0D        		LD	A,(IY+13)	;(FCB)属性(アトリビュート)
  E54E  12            		LD	(DE),A
  E54F  13            		INC	DE
                      	;				Reserved
  E550  AF            		XOR	A
  E551  060A          		LD	B,10
  E553                	SDE1:
  E553  12            		LD	(DE),A
  E554  13            		INC	DE
  E555  10FC          		DJNZ	SDE1
                      						;(FCB)更新時刻
  E557  21EAF0        		LD	HL,SDDATA		;(FCB)更新年月日
  E55A  060A          		LD	B,SDDATAE-SDDATA	;(FCB)ファイルの先頭クラスタ
  E55C                	SDLOOP:					;(FCB)ファイルのサイズ(バイト単位)
  E55C  7E            		LD	A,(HL)
  E55D  23            		INC	HL
  E55E  3263E5        		LD	(SDPAT+2),A
  E561  FD7E00        	SDPAT:	LD	A,(IY+0)	;LD A,(IY+A)
  E564  12            		LD	(DE),A
  E565  13            		INC	DE
  E566  10F4          		DJNZ	SDLOOP
                      	
  E568  AF            		XOR	A
  E569  E1            		POP	HL
  E56A  D1            		POP	DE
  E56B  C9            		RET
                      	
  E56C                	WOPEN:
  E56C  FD7E0D        		LD	A,(IY+13)	;(FCB)属性(アトリビュート)
  E56F  E61F          		AND	01FH
  E571  37            		SCF
  E572  C0            		RET	NZ
  E573  FD361CFE      		LD	(IY+28),0FEH	;(FCB)オープンモード
  E577                	TOPEN2:
  E577  AF            		XOR	A
  E578                	TOPEN:				;Initializes the time stamp
  E578  FD3617FF      		LD	(IY+23),0FFH	;(FCB)更新時刻
  E57C  C9            		RET
                      	
  E57D                	WRDFX:
  E57D  3AE6E3        		LD	A,(SPCPAT+1)	;1クラスタの論理セクタ
  E580                	L_WRFX:
  E580  1F            		RRA		;->CF
  E581  3804          		JR	C,E_WRFX
  E583  CB39          		SRL	C	;C=C/2
  E585  18F9          		JR	L_WRFX
  E587                	E_WRFX:
  E587  41            		LD	B,C
  E588  04            		INC	B
  E589  3E37          		LD	A,037H		;SCF
  E58B  321FE9        		LD	(DRDN1),A
                      	
  E58E                	WRDF:				;Bクラスタ分FATを確保する
  E58E  110200        		LD	DE,2
  E591  AF            		XOR	A
  E592  328FEA        		LD	(_SECPS+1),A
  E595                	WRDF1:
  E595  C5            		PUSH	BC
  E596  D5            		PUSH	DE
  E597  CDF7EF        		CALL	_GNCL
  E59A  381C          		JR	C,WRDF3
  E59C  7A            		LD	A,D		;空いているかチェック
  E59D  B3            		OR	E
  E59E  2027          		JR	NZ,WRDF4
  E5A0  E1            		POP	HL		;HL=空いているクラスタ
  E5A1  E5            		PUSH	HL
  E5A2  ED5BFEF0      		LD	DE,(_CLPS)	;DE=元の(_CLPS)
  E5A6  22FEF0        		LD	(_CLPS),HL
  E5A9  7A            		LD	A,D		;元の(_CLPS)が 0 か?
  E5AA  B3            		OR	E
  E5AB  2008          		JR	NZ,WRDF2
  E5AD  FD751A        		LD	(IY+26),L	;(FCB)ファイルの先頭クラスタ
  E5B0  FD741B        		LD	(IY+27),H	;元が空の場合はFCBにクラスタをセットする
  E5B3  1803          		JR	WRDF3
  E5B5                	WRDF2:
  E5B5  CDFAEF        		CALL	_SNCL
  E5B8                	WRDF3:
  E5B8  D1            		POP	DE
  E5B9  C1            		POP	BC
  E5BA  D8            		RET	C
  E5BB  100C          		DJNZ	WRDF5		;ここでループカウンタチェック
  E5BD  ED5BFEF0      		LD	DE,(_CLPS)
  E5C1  21FFFF        		LD	HL,0FFFFH	;FATエントリ終了(EOCマーク)
  E5C4  C3FAEF        		JP	_SNCL
                      	
  E5C7                	WRDF4:				;DEクラスタが空じゃないので次に移動する
  E5C7  D1            		POP	DE
  E5C8  C1            		POP	BC
  E5C9                	WRDF5:
  E5C9  13            		INC	DE
  E5CA  CDFFE3        		CALL	ENDCL
  E5CD  38C6          		JR	C,WRDF1
  E5CF  37            		SCF
  E5D0  C9            		RET
                      	
  E5D1                	RWXR:
  E5D1  3A9DE8        		LD	A,(SECSZ+2)	;1024=4 / 512=2 / 256=1
  E5D4                	L_RWX:
  E5D4  1F            		RRA		;->CF
  E5D5  3806          		JR	C,E_RWX
  E5D7  CB38          		SRL	B	;BC=BC/2
  E5D9  CB19          		RR	C	;
  E5DB  18F7          		JR	L_RWX
  E5DD                	E_RWX:
  E5DD  FD5E1A        		LD	E,(IY+26)	;(FCB)ファイルの先頭クラスタ
  E5E0  FD561B        		LD	D,(IY+27)
  E5E3  AF            		XOR	A
  E5E4  328FEA        		LD	(_SECPS+1),A
  E5E7                	RWX1:
  E5E7  ED53FEF0      		LD	(_CLPS),DE
  E5EB  7A            		LD	A,D
  E5EC  B3            		OR	E
  E5ED  280D          		JR	Z,SCF_RET	;RET DE==0 => CF=1
                      	
  E5EF  78            		LD	A,B
  E5F0  B1            		OR	C
  E5F1  C8            		RET	Z		;RET BC==0 => CF=0
                      	
  E5F2  CD97EA        		CALL	GNCLX
  E5F5  D8            		RET	C
  E5F6  0B            		DEC	BC
                      	
  E5F7  CDFFE3        		CALL	ENDCL
  E5FA  38EB          		JR	C,RWX1
  E5FC                	SCF_RET:
  E5FC  37            		SCF
  E5FD  C9            		RET
                      	
  E5FE                	DSKF:
  E5FE  110000        	MAXCLP:	LD	DE,0
  E601  2AACEF        		LD	HL,(_FAKEFREE)
  E604  7C            		LD	A,H
  E605  B5            		OR	L
  E606  2803          		JR	Z,DSKF1
  E608  110100        		LD	DE,1
  E60B                	DSKF1:
  E60B  D5            		PUSH	DE
  E60C  CDF7EF        		CALL	_GNCL
  E60F  380C          		JR	C,POPSCF
  E611  7A            		LD	A,D
  E612  B3            		OR	E
  E613  2001          		JR	NZ,DSKF2
  E615  23            		INC	HL
  E616                	DSKF2:
  E616  D1            		POP	DE
  E617  1B            		DEC	DE
  E618  7A            		LD	A,D
  E619  B3            		OR	E
  E61A  20EF          		JR	NZ,DSKF1
  E61C  C9            		RET
                      	
  E61D                	POPSCF:
  E61D  F1            		POP	AF
  E61E  37            		SCF
  E61F  C9            		RET
                      	
  E620                	SETTMS:
  E620  FD7E17        		LD	A,(IY+23)	;(FCB)ファイルを最後に変更した時刻
  E623  3C            		INC	A
  E624  C0            		RET	NZ		;ファイルが更新されていない
  E625                	SETTMSX:			;FCBに日付時刻をセットする
  E625  CDE9DC        		CALL	_SYS2C		;(BDOS)時刻の獲得
                      					;H←時  L←分  D←秒
  E628  CB25          		SLA	L		;   *2
  E62A  CB25          		SLA	L		;   *4
  E62C  29            		ADD	HL,HL		;*2 *8
  E62D  29            		ADD	HL,HL		;*4 *16
  E62E  29            		ADD	HL,HL		;*8 *32
  E62F  7A            		LD	A,D
  E630  0F            		RRCA			;bit.0->7->->->0->C
  E631  E61F          		AND	01FH
  E633  B5            		OR	L
  E634  FD7716        		LD	(IY+22),A	;(FCB)ファイルを最後に変更した時刻
  E637  FD7417        		LD	(IY+23),H
                      	
  E63A  CDB5DC        		CALL	_SYS2A		;(BDOS)日付の獲得
                      					;HL←年  D←月  E←日
  E63D  0144F8        		LD	BC,0-1980
  E640  09            		ADD	HL,BC
  E641  65            		LD	H,L
                      	
  E642  7A            		LD	A,D
  E643  87            		ADD	A,A		;*2
  E644  87            		ADD	A,A		;*4
  E645  87            		ADD	A,A		;*8
  E646  87            		ADD	A,A		;*16
  E647  6F            		LD	L,A
  E648  29            		ADD	HL,HL		;*32
  E649  7D            		LD	A,L
  E64A  B3            		OR	E
  E64B  FD7714        		LD	(IY+20),A	;(FCB)ファイルを最後に変更した日付
  E64E  FD7415        		LD	(IY+21),H
  E651  C9            		RET
                      	
  E652                	PUSHRR:
  E652  CD58E6        		CALL	SUBRR
  E655                	POPRR1:
  E655  EDB0          		LDIR
  E657  C9            		RET
                      	
  E658                	SUBRR:
  E658  FDE5          		PUSH	IY
  E65A  E1            		POP	HL
  E65B  112100        		LD	DE,33
  E65E  19            		ADD	HL,DE
  E65F  115AEF        		LD	DE,HLBUF
  E662  010300        		LD	BC,3
  E665  C9            		RET
                      	
  E666                	SETSEQ:
  E666  F5            		PUSH	AF		;AHL=Random record
  E667  FD7E21        		LD	A,(IY+33)	;(FCB)ランダムレコード
  E66A  FD6E22        		LD	L,(IY+34)
  E66D  FD6623        		LD	H,(IY+35)
                      	
  E670  CD8CE6        		CALL	SSQ1
                      	
  E673  29            		ADD	HL,HL
  E674  CB3D          		SRL	L		;L=L/2
  E676  FD7520        		LD	(IY+32),L	;(FCB)カレントレコード
  E679  FD740C        		LD	(IY+12),H	;(FCB)カレントブロック
  E67C  F1            		POP	AF
                      	
  E67D                	POPRR:
  E67D  CD58E6        		CALL	SUBRR
  E680  EB            		EX	DE,HL
  E681  18D2          		JR	POPRR1
                      	
  E683                	GETSIZE:
  E683  FD7E10        		LD	A,(IY+16)	;(FCB)ファイルのサイズ(バイト単位)
  E686  FD6E11        		LD	L,(IY+17)
  E689  FD6612        		LD	H,(IY+18)
  E68C                	SSQ1:				;バイト単位からCP/Mのレコード単位を求める（1レコード=128バイト）
  E68C  87            		ADD	A,A		;in HLA => out HL
  E68D  ED6A          		ADC	HL,HL
  E68F  B7            		OR	A
  E690  C8            		RET	Z
  E691  23            		INC	HL
  E692  C9            		RET
                      	
  E693                	GETSEQ:
  E693  FD6E20        		LD	L,(IY+32)	;(FCB)カレントレコード
  E696  FD660C        		LD	H,(IY+12)	;(FCB)カレントブロック
                      	
  E699  CB25          		SLA	L	;L=L*2
                      	
  E69B  CB3C          		SRL	H	;HL=HL/2
  E69D  CB1D          		RR	L	;
  E69F  C9            		RET
                      	
  E6A0                	RB_WRITE:
  E6A0  C5            		PUSH	BC
  E6A1  ED4B4CF0      		LD	BC,(STABLE+2*026H)	;(BDOS)ランダムブロック書き込み
  E6A5  1805          		JR	RBRW
  E6A7                	RB_READ:
  E6A7  C5            		PUSH	BC
  E6A8  ED4B4EF0      		LD	BC,(STABLE+2*027H)	;(BDOS)ランダムブロック読み込み
  E6AC                	RBRW:
  E6AC  AF            		XOR	A	;HLA = HL*128
  E6AD  CB3C          		SRL	H	;HL=HL/2
  E6AF  CB1D          		RR	L	;
  E6B1  1F            		RRA			;HLA
  E6B2  FD7721        		LD	(IY+33),A	;(FCB)ランダムレコード
  E6B5  FD7522        		LD	(IY+34),L
  E6B8  FD7423        		LD	(IY+35),H
  E6BB  218000        		LD	HL,128
                      	
  E6BE  FDE5          		PUSH	IY
  E6C0  D1            		POP	DE
  E6C1  D5            		PUSH	DE
  E6C2  CDC9E6        		CALL	JP_BC
  E6C5  FDE1          		POP	IY
  E6C7  C1            		POP	BC
  E6C8  C9            		RET
  E6C9                	JP_BC:
  E6C9  C5            		PUSH	BC
  E6CA  C9            		RET
                      	
  E28F                	_SYS03	EQU	SCF_FF_RET	;(BDOS)外部入力
  E28F                	_SYS2B	EQU	SCF_FF_RET	;(BDOS)日付の設定
  E28F                	_SYS2D	EQU	SCF_FF_RET	;(BDOS)時刻の設定
  E28F                	_SYS39	EQU	SCF_FF_RET	;(BDOS)サブディレクトリの作成
  E28F                	_SYS3A	EQU	SCF_FF_RET	;(BDOS)サブディレクトリの削除
                      	
                      	
                      	;LDFILE2.ASM
                      	
                      	;	LSX-Dodgers FILE2
                      	
                      					;Write random block
  E6CB                	_SYS26:		;(BDOS)ランダムブロック書き込み
  E6CB  AF            		XOR	A
  E6CC  321FE9        		LD	(DRDN1),A	;NOP
  E6CF  22E0E8        		LD	(LEFT+1),HL	;HL←書き込むレコード数
  E6D2  225DEF        		LD	(LEFTX),HL
  E6D5  CDE4E1        		CALL	SETDRV
                      	
  E6D8  CD48E8        		CALL	RBX0
  E6DB  DA71E7        		JP	C,RBWERR
  E6DE  CD6CE5        		CALL	WOPEN
  E6E1  DA71E7        		JP	C,RBWERR
  E6E4  7C            		LD	A,H
  E6E5  B5            		OR	L
  E6E6  CA6AE7        		JP	Z,RBW1
                      	
  E6E9  2B            		DEC	HL
                      	
  E6EA  CDF8E8        		CALL	GET_RR_CDE	;CDE=Random record
                      	
  E6ED  AF            		XOR	A	;AHL=HL+CDE
  E6EE  19            		ADD	HL,DE
  E6EF  89            		ADC	A,C
                      	
  E6F0  47            		LD	B,A
  E6F1  4C            		LD	C,H
                      	
  E6F2  CDD1E5        		CALL	RWXR
  E6F5  DC7DE5        		CALL	C,WRDFX
  E6F8  DA71E7        		JP	C,RBWERR
                      	
  E6FB  CD71E8        		CALL	RBX2
  E6FE  281A          		JR	Z,RBWB		;NZ=セクタ以下の端数がある
  E700  CD85E8        		CALL	RBXA
  E703  386C          		JR	C,RBWERR
  E705  EB            		EX	DE,HL
  E706  C5            		PUSH	BC
  E707  EDB0          		LDIR
  E709  225FEF        		LD	(DTAX),HL
                      	
  E70C  CD11E5        		CALL	SWTDBF		;バッファデータは更新された
                      	
  E70F  2A5DEF        		LD	HL,(LEFTX)
  E712  D1            		POP	DE
  E713  ED52          		SBC	HL,DE
  E715  225DEF        		LD	(LEFTX),HL
  E718  2830          		JR	Z,RBWEND
                      	
  E71A                	RBWB:
  E71A  CDBBE8        		CALL	RBXB
  E71D  2813          		JR	Z,RBWC
  E71F                	RBWB1:
  E71F  C5            		PUSH	BC
  E720  D5            		PUSH	DE
  E721  CDE2E3        		CALL	CLUSTX
  E724  CDFBEB        		CALL	DWT24
  E727  D1            		POP	DE
  E728  C1            		POP	BC
  E729  3846          		JR	C,RBWERR
  E72B  CD97EA        		CALL	GNCLX
  E72E  3841          		JR	C,RBWERR
  E730  10ED          		DJNZ	RBWB1
  E732                	RBWC:
  E732  CDD3E8        		CALL	RBXC
  E735  2813          		JR	Z,RBWEND
  E737  C5            		PUSH	BC
  E738  CDE2E3        		CALL	CLUSTX
  E73B  CD1EE9        		CALL	DRDN
  E73E  C1            		POP	BC
  E73F  3830          		JR	C,RBWERR
  E741  ED5B7EF0      		LD	DE,(_DTBUF)
  E745  EDB0          		LDIR
  E747  CD11E5        		CALL	SWTDBF		;バッファデータは更新された
  E74A                	RBWEND:
  E74A  CDDFE8        		CALL	RBXEND
                      	
  E74D  CD57E8        		CALL	RBX1
  E750  3018          		JR	NC,RBW1
  E752  2AE0E8        		LD	HL,(LEFT+1)
  E755  FD5E10        		LD	E,(IY+16)	;(FCB)ファイルのサイズ(バイト単位)
  E758  FD5611        		LD	D,(IY+17)	;CDE=File size
  E75B  FD4E12        		LD	C,(IY+18)
  E75E  AF            		XOR	A
  E75F  19            		ADD	HL,DE
  E760  89            		ADC	A,C
  E761  FD7510        		LD	(IY+16),L	;(FCB)ファイルのサイズ(バイト単位)
  E764  FD7411        		LD	(IY+17),H
  E767  FD7712        		LD	(IY+18),A
  E76A                	RBW1:
  E76A  FDE1          		POP	IY
  E76C  C1            		POP	BC
  E76D  D1            		POP	DE
  E76E  E1            		POP	HL
  E76F                	DD_NUL:
  E76F  AF            		XOR	A
  E770  C9            		RET
                      	
  E771                	RBWERR:
  E771  FDE5          		PUSH	IY
  E773  D1            		POP	DE
  E774  2A20F0        		LD	HL,(STABLE+2*010H)
  E777  CD0F00        		CALL	JP_HL
  E77A                	RBRERR1:
  E77A  3E01          		LD	A,001H
  E77C                	RBRERR2:
  E77C  FDE1          		POP	IY
  E77E  C1            		POP	BC
  E77F  D1            		POP	DE
  E780  E1            		POP	HL
  E781  37            		SCF
  E782  210000        		LD	HL,0
  E785  C9            		RET
                      	
  E786                	RBRERR:
  E786  3EFF          		LD	A,0FFH
  E788  18F2          		JR	RBRERR2
                      	
  E78A                	RBRFL:
  E78A  3E00          	RBRFLP:	LD	A,000H
  E78C  FE0D          		CP	00DH
  E78E  2005          		JR	NZ,RBRFL1
  E790  D5            		PUSH	DE
  E791  1E0A          		LD	E,00AH
  E793  1805          		JR	RBRFL2
  E795                	RBRFL1:
  E795  D5            		PUSH	DE
  E796  CD09EF        		CALL	_SYS07
  E799  5F            		LD	E,A
  E79A                	RBRFL2:
  E79A  CDCDEF        		CALL	_PRINT
  E79D  7B            		LD	A,E
  E79E  D1            		POP	DE
  E79F  328BE7        		LD	(RBRFLP+1),A
  E7A2  C9            		RET
  E7A3                	DDX:
  E7A3  FD7E01        		LD	A,(IY+1)	;(FCB)主ファイル名
  E7A6  CD07E4        		CALL	CAP
  E7A9  FE41          		CP	'A'
  E7AB  C9            		RET
                      	
                      					;Read random block
  E7AC                	_SYS27:		;(BDOS)ランダムブロック読み込み
  E7AC  225DEF        		LD	(LEFTX),HL
  E7AF  CDE4E1        		CALL	SETDRV
                      	
  E7B2  FDCB0D66      		BIT	4,(IY+13)	;(FCB)属性(アトリビュート)
  E7B6  C236E8        		JP	NZ,RBRDIR	;ディレクトリ
  E7B9  CD48E8        		CALL	RBX0
  E7BC  DA86E7        		JP	C,RBRERR
  E7BF  CD57E8        		CALL	RBX1
  E7C2  DA7AE7        		JP	C,RBRERR1
  E7C5  79            		LD	A,C
  E7C6  EB            		EX	DE,HL
  E7C7  ED52          		SBC	HL,DE		;CP 0HL,CDE
  E7C9  19            		ADD	HL,DE
  E7CA  DE00          		SBC	A,000H
  E7CC  3801          		JR	C,RBR1
  E7CE  EB            		EX	DE,HL
  E7CF                	RBR1:
  E7CF  9F            		SBC	A,A
  E7D0  E601          		AND	1
  E7D2  3234E8        		LD	(RBRAP+1),A
                      	
  E7D5  7C            		LD	A,H
  E7D6  B5            		OR	L
  E7D7  2854          		JR	Z,RBREND0
                      	
  E7D9  22E0E8        		LD	(LEFT+1),HL	;Read record byte
  E7DC  225DEF        		LD	(LEFTX),HL
                      	
  E7DF  CD71E8        		CALL	RBX2
  E7E2  2819          		JR	Z,RBRB
  E7E4  CD85E8        		CALL	RBXA
  E7E7  DA86E7        		JP	C,RBRERR
  E7EA  C5            		PUSH	BC
  E7EB  EDB0          		LDIR
  E7ED  ED535FEF      		LD	(DTAX),DE
  E7F1  2A5DEF        		LD	HL,(LEFTX)
  E7F4  D1            		POP	DE
  E7F5  A7            		AND	A
  E7F6  ED52          		SBC	HL,DE
  E7F8  225DEF        		LD	(LEFTX),HL
  E7FB  282D          		JR	Z,RBREND
                      	
  E7FD                	RBRB:
  E7FD  CDBBE8        		CALL	RBXB
  E800  2812          		JR	Z,RBRC
  E802                	RBRB1:
  E802  C5            		PUSH	BC
  E803  D5            		PUSH	DE
  E804  CDE2E3        		CALL	CLUSTX
  E807  CDEBEB        		CALL	DRD24
  E80A  D1            		POP	DE
  E80B  C1            		POP	BC
  E80C  D497EA        		CALL	NC,GNCLX
  E80F  DA86E7        		JP	C,RBRERR
  E812  10EE          		DJNZ	RBRB1
  E814                	RBRC:
  E814  CDD3E8        		CALL	RBXC
  E817  2811          		JR	Z,RBREND
  E819  C5            		PUSH	BC
  E81A  CDE2E3        		CALL	CLUSTX
  E81D  CD02E9        		CALL	DRDX
  E820  C1            		POP	BC
  E821  DA86E7        		JP	C,RBRERR
  E824  EB            		EX	DE,HL
  E825  2A7EF0        		LD	HL,(_DTBUF)
  E828  EDB0          		LDIR
  E82A                	RBREND:
  E82A  CDDFE8        		CALL	RBXEND
  E82D                	RBREND0:
  E82D  FDE1          		POP	IY
  E82F  C1            		POP	BC
  E830  D1            		POP	DE
  E831  F1            		POP	AF	;(HL)
  E832  AF            		XOR	A
  E833  3E00          	RBRAP:	LD	A,000H
  E835  C9            		RET
                      	
  E836                	RBRDIR:
  E836  FD6E1A        		LD	L,(IY+26)	;(FCB)ファイルの先頭クラスタ
  E839  FD661B        		LD	H,(IY+27)
  E83C  CD22E4        		CALL	CHDIR
  E83F  AF            		XOR	A
  E840  67            		LD	H,A
  E841  6F            		LD	L,A
  E842  3C            		INC	A
  E843  3234E8        		LD	(RBRAP+1),A
  E846  18E5          		JR	RBREND0
                      	
  E848                	RBX0:
  E848  2A8AEF        		LD	HL,(_DTA)
  E84B  225FEF        		LD	(DTAX),HL
  E84E  2A5DEF        		LD	HL,(LEFTX)
  E851  FD7E1C        		LD	A,(IY+28)	;(FCB)オープンモード
  E854  D6FD          		SUB	0FDH
  E856  C9            		RET
                      	
  E857                	RBX1:
  E857  E5            		PUSH	HL		;Record byte
                      					;AHL=File size
  E858  FD6E10        		LD	L,(IY+16)	;ファイルのサイズ(バイト単位)
  E85B  FD6611        		LD	H,(IY+17)
  E85E  FD7E12        		LD	A,(IY+18)
                      	
  E861  CDF8E8        		CALL	GET_RR_CDE	;CDE=Random record
                      	
  E864  A7            		AND	A
  E865  ED52          		SBC	HL,DE
  E867  99            		SBC	A,C
  E868  D1            		POP	DE
                      	
  E869  D8            		RET	C
  E86A  4F            		LD	C,A
  E86B  EB            		EX	DE,HL	;CDE=File byte	HL=Record byte
  E86C  B2            		OR	D
  E86D  B3            		OR	E
  E86E  C0            		RET	NZ
  E86F  37            		SCF
  E870  C9            		RET
                      	
  E871                	RBX2:				;Cluster settings
  E871  FD4E22        		LD	C,(IY+34)	;(+33)(FCB)ランダムレコード
  E874  FD4623        		LD	B,(IY+35)
  E877  CDD1E5        		CALL	RWXR
  E87A  3A9DE8        		LD	A,(SECSZ+2)	;1024=4 / 512=2 / 256=1
  E87D  3D            		DEC	A
  E87E  FDA622        		AND	(IY+34)
  E881  FDB621        		OR	(IY+33)
  E884  C9            		RET
                      	
  E885                	RBXA:
  E885  C5            		PUSH	BC
  E886  D5            		PUSH	DE
  E887  CDE2E3        		CALL	CLUSTX
  E88A  CD02E9        		CALL	DRDX
  E88D  D1            		POP	DE
  E88E  C1            		POP	BC
  E88F  D8            		RET	C
  E890  CD97EA        		CALL	GNCLX
  E893  D8            		RET	C
  E894  ED53FEF0      		LD	(_CLPS),DE
                      	
  E898  FD4E21        		LD	C,(IY+33)	;(FCB)ランダムレコード
  E89B  210004        	SECSZ:	LD	HL,0400H	;自己書き換え 1024=0400H / 512=0200H ここに1セクタのサイズが格納される
  E89E  7C            		LD	A,H
  E89F  3D            		DEC	A		;1024=3 / 512=1
  E8A0  FDA622        		AND	(IY+34)		;(FCB)ランダムレコード
  E8A3  47            		LD	B,A		;BCに1セクタ以下の端数が入る
  E8A4  ED42          		SBC	HL,BC		;残りを計算
                      	
  E8A6  ED5B5DEF      		LD	DE,(LEFTX)
  E8AA  ED52          		SBC	HL,DE		;CP HL,DE
  E8AC  19            		ADD	HL,DE		;
  E8AD  3801          		JR	C,RBXA1		;DEとHLを比較して大きい方をHLに
  E8AF  EB            		EX	DE,HL
  E8B0                	RBXA1:
  E8B0  E5            		PUSH	HL
  E8B1  2A7EF0        		LD	HL,(_DTBUF)
  E8B4  09            		ADD	HL,BC
  E8B5  ED5B5FEF      		LD	DE,(DTAX)
  E8B9  C1            		POP	BC
  E8BA  C9            		RET
                      	
  E8BB                	RBXB:
  E8BB  2A5FEF        		LD	HL,(DTAX)
  E8BE  ED5BFEF0      		LD	DE,(_CLPS)
  E8C2  3A5EEF        		LD	A,(LEFTX+1)
  E8C5  47            		LD	B,A
  E8C6  3A9DE8        		LD	A,(SECSZ+2)	;1024=4 / 512=2 / 256=1
  E8C9                	RBXB1:
  E8C9  1F            		RRA		;->CF
  E8CA  3804          		JR	C,RBXB2
  E8CC  CB38          		SRL	B	;B=B/2
  E8CE  18F9          		JR	RBXB1
  E8D0                	RBXB2:
  E8D0  78            		LD	A,B
  E8D1  B7            		OR	A
  E8D2  C9            		RET
                      	
  E8D3                	RBXC:
  E8D3  ED4B5DEF      		LD	BC,(LEFTX)
  E8D7  3A9DE8        		LD	A,(SECSZ+2)	;1024=4 / 512=2 / 256=1
  E8DA  3D            		DEC	A
  E8DB  A0            		AND	B
  E8DC  47            		LD	B,A		;1セクタ以下の端数がない場合はZ
  E8DD  B1            		OR	C
  E8DE  C9            		RET
                      	
  E8DF                	RBXEND:
  E8DF  110000        	LEFT:	LD	DE,0
  E8E2  AF            		XOR	A
  E8E3  FD6E21        		LD	L,(IY+33)	;(FCB)ランダムレコード
  E8E6  FD6622        		LD	H,(IY+34)
  E8E9  19            		ADD	HL,DE
  E8EA  FD8E23        		ADC	A,(IY+35)
  E8ED  FD7521        		LD	(IY+33),L	;(FCB)ランダムレコード
  E8F0  FD7422        		LD	(IY+34),H
  E8F3  FD7723        		LD	(IY+35),A
  E8F6  EB            		EX	DE,HL		;HL=Read byte
  E8F7  C9            		RET
                      	
  E8F8                	GET_RR_CDE:			;CDE=Random record
  E8F8  FD5E21        		LD	E,(IY+33)	;(FCB)ランダムレコード
  E8FB  FD5622        		LD	D,(IY+34)
  E8FE  FD4E23        		LD	C,(IY+35)
  E901  C9            		RET
                      	
                      	
                      	;LDDIO.ASM
                      	
                      	;	LSX-Dodgers DIO
                      	
  E902                	DRDX:
  E902  CD40E9        		CALL	DRDY
  E905  C8            		RET	Z
  E906  CD26E9        		CALL	DRDX1		;データバッファの情報を保存
  E909  D8            		RET	C
  E90A  E5            		PUSH	HL
  E90B  C5            		PUSH	BC
  E90C  D5            		PUSH	DE
  E90D  2A7EF0        		LD	HL,(_DTBUF)
  E910  3A69E9        		LD	A,(_DBS24+1)
  E913  4F            		LD	C,A
  E914  CDEBEB        		CALL	DRD24
  E917  DC3BE9        		CALL	C,DRDNE
  E91A                	POP_DE_BC_HL_RET:
  E91A  D1            		POP	DE
  E91B  C1            		POP	BC
  E91C  E1            		POP	HL
  E91D  C9            		RET
                      	
                      	;	CDE:セクタ番号
  E91E                	DRDN:
  E91E  AF            		XOR	A
  E91F  00            	DRDN1:	NOP			;自己書き換え NOP / SCF
  E920  30E0          		JR	NC,DRDX
  E922                	DRDNX:
  E922  CD40E9        		CALL	DRDY
  E925  C8            		RET	Z
  E926                	DRDX1:
  E926  CD56E9        		CALL	DWTX
                      					;データバッファの読み込んだドライブ・セクタ情報を保存
  E929  ED53A6EF      		LD	(_DBSEC),DE
  E92D  79            		LD	A,C
  E92E  3269E9        		LD	(_DBS24+1),A
                      	
  E931  3A88EF        		LD	A,(_DRV)
  E934  32A5EF        		LD	(_DBDRV),A
  E937  CDD9EF        		CALL	_CHGDRV
  E93A  D0            		RET	NC
  E93B                	DRDNE:
  E93B  9F            		SBC	A,A		;CF=1ならばA=0FFH
  E93C  32A5EF        		LD	(_DBDRV),A
  E93F  C9            		RET
                      	
                      	;	CDE:セクタ番号
  E940                	DRDY:
  E940  3A69E9        		LD	A,(_DBS24+1)
  E943  B9            		CP	C
  E944  C0            		RET	NZ
                      	
  E945  E5            		PUSH	HL
  E946  3A88EF        		LD	A,(_DRV)
  E949  21A5EF        		LD	HL,_DBDRV
  E94C  AE            		XOR	(HL)
  E94D  2005          		JR	NZ,POP_HL_RET
                      	
  E94F  2AA6EF        		LD	HL,(_DBSEC)
  E952  ED52          		SBC	HL,DE		;CF=0
  E954                	POP_HL_RET:
  E954  E1            		POP	HL
  E955  C9            		RET
                      	
  E956                	DWTX:
  E956  3AA4EF        		LD	A,(_WTDBF)
  E959  B7            		OR	A
  E95A  C8            		RET	Z
  E95B  AF            		XOR	A
  E95C  32A4EF        		LD	(_WTDBF),A
                      	
  E95F  E5            		PUSH	HL
  E960  C5            		PUSH	BC
  E961  D5            		PUSH	DE
  E962  3AA5EF        		LD	A,(_DBDRV)
  E965  CDD9EF        		CALL	_CHGDRV
  E968  0E00          	_DBS24:	LD	C,0
  E96A  ED5BA6EF      		LD	DE,(_DBSEC)
  E96E  2A7EF0        		LD	HL,(_DTBUF)
  E971  D4FBEB        		CALL	NC,DWT24
  E974                	POP_DE_BC_HL_RET2:
  E974  18A4          		JR	POP_DE_BC_HL_RET
                      	
  E976                	RDFATX:
  E976  E5            		PUSH	HL
  E977  3A88EF        		LD	A,(_DRV)
  E97A  21AAEF        		LD	HL,_FATDRV
  E97D  AE            		XOR	(HL)
  E97E  28D4          		JR	Z,POP_HL_RET
                      	
  E980  C5            		PUSH	BC
  E981  D5            		PUSH	DE
  E982  DDE5          		PUSH	IX
  E984  CDA0E9        		CALL	WTFATX
  E987  3813          		JR	C,POP_IX_DE_BC_HL_RET
                      	
  E989  AF            		XOR	A
  E98A  32ABEF        		LD	(_FATIX),A
  E98D  3A88EF        		LD	A,(_DRV)
  E990  32AAEF        		LD	(_FATDRV),A
  E993  CDE5EF        		CALL	_RDFAT
  E996                	RDFATE2:
  E996  3004          		JR	NC,POP_IX_DE_BC_HL_RET
  E998  9F            		SBC	A,A		;A=0xFF
  E999  32AAEF        		LD	(_FATDRV),A
  E99C                	POP_IX_DE_BC_HL_RET:
  E99C  DDE1          		POP	IX
  E99E  18D4          		JR	POP_DE_BC_HL_RET2
                      	
  E9A0                	WTFATX:
  E9A0  3AA2EF        		LD	A,(_WTFATF)
  E9A3  B7            		OR	A
  E9A4  C8            		RET	Z
  E9A5  E5            		PUSH	HL
  E9A6  3AAAEF        		LD	A,(_FATDRV)
  E9A9  21A5EF        		LD	HL,_DBDRV
  E9AC  AE            		XOR	(HL)
  E9AD  CC56E9        		CALL	Z,DWTX
  E9B0  38A2          		JR	C,POP_HL_RET
  E9B2  C5            		PUSH	BC
  E9B3  D5            		PUSH	DE
  E9B4  DDE5          		PUSH	IX
  E9B6  CD08EC        		CALL	WTFAT
  E9B9  AF            		XOR	A
  E9BA  32A2EF        		LD	(_WTFATF),A
  E9BD  18DD          		JR	POP_IX_DE_BC_HL_RET
                      	
  E9BF                	NCL1:
  E9BF  7A            		LD	A,D
  E9C0  B3            		OR	E
  E9C1  37            		SCF
  E9C2  C8            		RET	Z
                      	
  E9C3  7A            		LD	A,D
  E9C4  CB3F          		SRL	A	;/2
  E9C6  CB3F          		SRL	A	;/2
                      	
  E9C8  E5            		PUSH	HL
  E9C9  32E8E9        		LD	(NCLPAT+2),A	;_FATIX
  E9CC  2AAAEF        		LD	HL,(_FATDRV)	;L=_FATDRV H=_FATIX
  E9CF  BC            		CP	H
  E9D0  3A88EF        		LD	A,(_DRV)	;この間でフラグは変化しない
  E9D3  32E7E9        		LD	(NCLPAT+1),A	;_FATDRV
  E9D6  2005          		JR	NZ,NCL2		;FATIXが違う
  E9D8  BD            		CP	L
  E9D9  2002          		JR	NZ,NCL2		;ドライブが違う
  E9DB  E1            		POP	HL
  E9DC  C9            		RET
  E9DD                	NCL2:
  E9DD  C5            		PUSH	BC
  E9DE  D5            		PUSH	DE
  E9DF  DDE5          		PUSH	IX
  E9E1  CDA0E9        		CALL	WTFATX
  E9E4  38B6          		JR	C,POP_IX_DE_BC_HL_RET
  E9E6  010000        	NCLPAT:	LD	BC,0		;自己書き換え C=_FATDRV B=_FATIX
  E9E9  ED43AAEF      		LD	(_FATDRV),BC
  E9ED  CDDDEB        		CALL	RDFATS
  E9F0  18A4          		JR	RDFATE2
                      	
  E9F2                	NCL3:
  E9F2  CB9A          		RES	3,D
  E9F4  CB92          		RES	2,D
  E9F6  6B            		LD	L,E
  E9F7  62            		LD	H,D
  E9F8  CB3C          		SRL	H	;
  E9FA  CB1D          		RR	L	;HLA=HLA/2
  E9FC  1F            		RRA		;
  E9FD  F5            		PUSH	AF
  E9FE  3AABEF        		LD	A,(_FATIX)
  EA01  0F            		RRCA
  EA02  300B          		JR	NC,NCL3X1
  EA04  3A9DE8        		LD	A,(SECSZ+2)
  EA07  FE04          		CP	4		;1セクタ1024バイトの場合は奇数インデックスの場合に先頭を512バイトずらす
  EA09  2004          		JR	NZ,NCL3X1
  EA0B  010002        		LD	BC,512
  EA0E  09            		ADD	HL,BC
  EA0F                	NCL3X1:
  EA0F  F1            		POP	AF
  EA10  ED4B7CF0      		LD	BC,(_FATBF)
  EA14  19            		ADD	HL,DE
  EA15  09            		ADD	HL,BC
  EA16  17            		RLA
  EA17  C9            		RET
                      	
  EA18                	GNCL:
  EA18  CDBFE9        		CALL	NCL1		;GET NEXT CLUSTER
  EA1B  D8            		RET	C
  EA1C  C5            		PUSH	BC
  EA1D  E5            		PUSH	HL
  EA1E  CDF2E9        		CALL	NCL3
  EA21  3809          		JR	C,GNC1
  EA23  5E            		LD	E,(HL)
  EA24  23            		INC	HL
  EA25  7E            		LD	A,(HL)
  EA26  E60F          		AND	00FH
  EA28  57            		LD	D,A
  EA29  E1            		POP	HL
  EA2A  C1            		POP	BC
  EA2B  C9            		RET
  EA2C                	GNC1:
  EA2C  7E            		LD	A,(HL)
  EA2D  23            		INC	HL
  EA2E  56            		LD	D,(HL)
  EA2F  0604          		LD	B,4
  EA31                	GNC1L:
  EA31  CB3A          		SRL	D	;DA=DA/2
  EA33  1F            		RRA		;
  EA34  10FB          		DJNZ	GNC1L
                      	
  EA36  5F            		LD	E,A
  EA37  E1            		POP	HL
  EA38  C1            		POP	BC
  EA39  A7            		AND	A
  EA3A  C9            		RET
                      	
  EA3B                	SNCL:
  EA3B  CDBFE9        		CALL	NCL1
  EA3E  D8            		RET	C
                      	;				SET NEXT CLUSTER
  EA3F  E5            		PUSH	HL
  EA40  C5            		PUSH	BC
  EA41  D5            		PUSH	DE
  EA42  E5            		PUSH	HL
  EA43  CDF2E9        		CALL	NCL3
  EA46  D1            		POP	DE
                      	;CF=ODD
  EA47  7E            		LD	A,(HL)
  EA48  73            		LD	(HL),E
  EA49  3806          		JR	C,SNC1
                      	;EVEN
                      	;M[0] = E
                      	;M[1] = (M[1] & 0xF0) | (D & 0x0F)
  EA4B  23            		INC	HL
  EA4C  ED67          		RRD		;M={A[3:0],E[3:0]}
  EA4E  7A            		LD	A,D
  EA4F  1804          		JR	SNC11
  EA51                	SNC1:
                      	;ODD
                      	;HL[0] = (HL[0]&0x0F) | (E<<4)
                      	;HL[1] = DE>>4
  EA51  ED6F          		RLD		;M={D[3:0],E[7:4]}
  EA53  23            		INC	HL
  EA54  72            		LD	(HL),D	;M={D[3:0],E[7:4]}
  EA55                	SNC11:
  EA55  ED6F          		RLD		;M={M[7:4],D[3:0]}
  EA57  B7            		OR	A
  EA58  D1            		POP	DE
  EA59  C1            		POP	BC
  EA5A  E1            		POP	HL
  EA5B                	FAT_CHANGED:
  EA5B  3E01          		LD	A,1
  EA5D  32A2EF        		LD	(_WTFATF),A
  EA60  C9            		RET
                      	
  EA61                	N16CL3:
  EA61  C5            		PUSH	BC
  EA62  6B            		LD	L,E
  EA63  7A            		LD	A,D
  EA64  E603          		AND	3
  EA66  67            		LD	H,A
  EA67  29            		ADD	HL,HL
  EA68  ED4B7CF0      		LD	BC,(_FATBF)
  EA6C  09            		ADD	HL,BC
  EA6D  C1            		POP	BC
  EA6E  C9            		RET
                      	
  EA6F                	GNCL16:
  EA6F  CDBFE9        		CALL	NCL1		;GET NEXT CLUSTER for FAT16
  EA72  D8            		RET	C
  EA73  E5            		PUSH	HL
  EA74  CD61EA        		CALL	N16CL3
  EA77  5E            		LD	E,(HL)
  EA78  23            		INC	HL
  EA79  56            		LD	D,(HL)
  EA7A  E1            		POP	HL
  EA7B  C9            		RET
                      	
  EA7C                	SNCL16:
  EA7C  CDBFE9        		CALL	NCL1		;GET NEXT CLUSTER for FAT16
  EA7F  D8            		RET	C
  EA80  D5            		PUSH	DE
  EA81  E5            		PUSH	HL
  EA82  CD61EA        		CALL	N16CL3
  EA85  D1            		POP	DE		;HL
  EA86  73            		LD	(HL),E
  EA87  23            		INC	HL
  EA88  72            		LD	(HL),D
  EA89  6B            		LD	L,E
  EA8A  62            		LD	H,D
  EA8B  D1            		POP	DE
  EA8C  18CD          		JR	FAT_CHANGED
                      	
                      	;------------------------
                      	;次のセクタを探す際に_SECPSの値をチェック
                      	;in
                      	;	DE : セクタ番号
                      	;out
                      	;	DE : 次のセクタ番号
                      	;note
                      	;
                      	;------------------------
  EA8E                	NEXTX:
  EA8E  3E00          	_SECPS:	LD	A,0	;自己書き換え
  EA90  3C            		INC	A
  EA91  E600          	NCPAT:	AND	0	;自己書き換え　1クラスタの論理セクタ数-1
  EA93  328FEA        		LD	(_SECPS+1),A
  EA96  C9            		RET
                      	
  EA97                	GNCLX:
  EA97  CD8EEA        		CALL	NEXTX
  EA9A  C0            		RET	NZ	;1クラスタのセクタ未満の場合は戻る
  EA9B  C3F7EF        		JP	_GNCL	;次のクラスタを探す
                      	
  EA9E                	RDFAT:
  EA9E  3E80          		LD	A,080H
  EAA0  3270EF        		LD	(CHECK),A
  EAA3                	RDFAT1:
  EAA3  3A88EF        		LD	A,(_DRV)
  EAA6  CD3BED        		CALL	CHGDRVR
  EAA9  D8            		RET	C
  EAAA  DD7E12        		LD	A,(IX+012H)	;DPB_12_DEVICE
  EAAD  CB6F          		BIT	5,A
  EAAF  2843          		JR	Z,RDFAT0X
  EAB1  2170EF        		LD	HL,CHECK
  EAB4  A6            		AND	(HL)
  EAB5  77            		LD	(HL),A
  EAB6  110000        		LD	DE,0		;BPB
  EAB9  2A7CF0        		LD	HL,(_FATBF)
  EABC  CDE9EB        		CALL	DRD16
  EABF  3024          		JR	NC,GETBPB
  EAC1  2170EF        		LD	HL,CHECK
  EAC4  CB06          		RLC	(HL)
  EAC6  3F            		CCF
  EAC7  D8            		RET	C
  EAC8  DDCB0A1E      		RR	(IX+00AH)	;DPB_0A_FDMODE
  EACC  3F            		CCF			;フロッピーディスクのMFMモードを切り替える
  EACD  DDCB0A16      		RL	(IX+00AH)	;DPB_0A_FDMODE
  EAD1  3EFF          		LD	A,0FFH
  EAD3  3289EF        		LD	(_DSK),A
  EAD6  3A84EF        		LD	A,(_DRIVE)
  EAD9  E603          		AND	3
  EADB  F680          		OR	080H
  EADD  6F            		LD	L,A
  EADE  26EF          		LD	H,_CYL0/256
  EAE0  3EFF          		LD	A,0FFH
  EAE2  77            		LD	(HL),A
  EAE3  18BE          		JR	RDFAT1
  EAE5                	GETBPB:
  EAE5  FDE5          		PUSH	IY
  EAE7  FD2A7CF0      		LD	IY,(_FATBF)	;BPB
  EAEB  CDF1EF        		CALL	_BPB2DPB
  EAEE  FDE1          		POP	IY
  EAF0  D8            		RET	C
  EAF1  CD91EC        		CALL	CHGDRV2
  EAF4                	RDFAT0X:
  EAF4  CDDDEB        		CALL	RDFATS
  EAF7  D8            		RET	C
  EAF8  DDBE06        		CP	(IX+6)		;DPB_06_FATID
  EAFB  C8            		RET	Z
  EAFC  DDCB126E      		BIT	5,(IX+012H)	;DPB_12_DEVICE
  EB00  C0            		RET	NZ		;BPBを取得している場合はFATIDをチェックしない
  EB01  37            		SCF
  EB02  C9            		RET
                      	
  EB03                	BPB2DPB:
  EB03  FD7E00        		LD	A,(IY+0)	;BS_JmpBoot
  EB06  FEEB          		CP	0EBH		;Short jump
  EB08  2808          		JR	Z,BPBOK
  EB0A  FEE9          		CP	0E9H		;Near jump
  EB0C  2804          		JR	Z,BPBOK
  EB0E  FE60          		CP	060H		;X68k
  EB10  37            		SCF
  EB11  C0            		RET	NZ
  EB12                	BPBOK:
  EB12  FD7E0D        		LD	A,(IY+13)	;BPB_SecPerClus
  EB15  DD7707        		LD	(IX+7),A	;DPB_07_SECPCL
                      	
  EB18  FD7E16        		LD	A,(IY+22)	;BPB_FATSz16
  EB1B  DD7700        		LD	(IX+0),A	;DPB_00_FATLN
  EB1E  FD7E17        		LD	A,(IY+23)	;BPB_FATSz16
  EB21  DD7701        		LD	(IX+1),A	;DPB_00_FATLN
                      	
  EB24  FD6E0E        		LD	L,(IY+14)	;BPB_RsvdSecCnt
  EB27  FD660F        		LD	H,(IY+15)
  EB2A  DD750E        		LD	(IX+00EH),L	;DPB_0E_FATPS
  EB2D  FD5E16        		LD	E,(IY+22)	;BPB_FATSz16
  EB30  FD5617        		LD	D,(IY+23)
  EB33  FD4610        		LD	B,(IY+16)	;BPB_NumFATs
  EB36                	BPBDP1:				;BPB_FATSz16 * BPB_NumFATs
  EB36  19            		ADD	HL,DE
  EB37  10FD          		DJNZ	BPBDP1
  EB39                	BPBDP2:
  EB39  DD7510        		LD	(IX+010H),L	;DPB_10_DIRPS
  EB3C  DD7411        		LD	(IX+011H),H
  EB3F  E5            		PUSH	HL
                      	
  EB40  FD6E11        		LD	L,(IY+17)	;BPB_RootEntCnt
  EB43  FD6612        		LD	H,(IY+18)
  EB46  FD7E0C        		LD	A,(IY+12)	;BPB_BytsPerSec
  EB49  0606          		LD	B,6
  EB4B                	BPBBPS1:
  EB4B  05            		DEC	B
  EB4C  0F            		RRCA
  EB4D  30FC          		JR	NC,BPBBPS1
  EB4F                	BPBDE1:
  EB4F  29            		ADD	HL,HL
  EB50  10FD          		DJNZ	BPBDE1
                      	
  EB52  7C            		LD	A,H
  EB53  DD770B        		LD	(IX+00BH),A	;DPB_0B_DIRSCNT
                      	
  EB56  D1            		POP	DE		;DPB_10_DIRPS
  EB57  6C            		LD	L,H
  EB58  2600          		LD	H,0
  EB5A  19            		ADD	HL,DE		;MAXDIR
  EB5B  E5            		PUSH	HL
  EB5C  FD4E0D        		LD	C,(IY+13)	;BPB_SecPerClus
  EB5F  CB21          		SLA	C		;*2
  EB61  AF            		XOR	A
  EB62  47            		LD	B,A
  EB63  ED42          		SBC	HL,BC
  EB65  DD7514        		LD	(IX+014H),L	;DPB_14_ADDCL16
  EB68  DD7415        		LD	(IX+015H),H
                      	
  EB6B  D1            		POP	DE		;DE=DPB_0B_MAXDIR
  EB6C  FD6E13        		LD	L,(IY+19)	;BPB_TotSec16
  EB6F  FD6614        		LD	H,(IY+20)
  EB72  7C            		LD	A,H
  EB73  B5            		OR	L
  EB74  3E00          		LD	A,0		;LDでフラグは変化しない。BPB_TotSec16を AHL で扱う為、Aに0を入れる
  EB76  2010          		JR	NZ,BPB16BIT	;BPB_TotSec16が「0」の場合はBPB_TotSec32で計算
  EB78  FD7E23        		LD	A,(IY+35)	;念のために総セクタ数が24ビットを超える場合はエラーを返す
  EB7B  B7            		OR	A
  EB7C  37            		SCF
  EB7D  C0            		RET	NZ
  EB7E  FD6E20        		LD	L,(IY+32)	;BPB_TotSec32 は AHL の24ビットで扱う
  EB81  FD6621        		LD	H,(IY+33)	;1クラスタの論理セクタ数(DPB_07_SECPCL)が最大128なので
  EB84  FD7E22        		LD	A,(IY+34)	;24ビットを超えると必ずクラスタ数が16ビットを超えてしまうのでこれで十分
  EB87  A7            		AND	A		;CF=0
  EB88                	BPB16BIT:
  EB88  ED52          		SBC	HL,DE
  EB8A  DE00          		SBC	A,0
  EB8C  FD460D        		LD	B,(IY+13)	;BPB_SecPerClus
  EB8F                	BPBTC1:				;総クラスタ数(AHL) = 総セクタ数(AHL) / セクタサイズ(B)
  EB8F  CB18          		RR	B		;->CY
  EB91  3808          		JR	C,BPBTC2
  EB93  CB3F          		SRL	A
  EB95  CB1C          		RR	H		;AHL=AHL/2
  EB97  CB1D          		RR	L
  EB99  18F4          		JR	BPBTC1
  EB9B                	BPBTC2:
  EB9B  B7            		OR	A
  EB9C  37            		SCF
  EB9D  C0            		RET	NZ		;念のため(クラスタ数が16ビットを超える場合)
  EB9E  23            		INC	HL
  EB9F  23            		INC	HL
  EBA0  DD7508        		LD	(IX+8),L	;DPB_08_MAXCL
  EBA3  DD7409        		LD	(IX+9),H
                      	
  EBA6  FD7E15        		LD	A,(IY+21)	;BPB_Media
  EBA9  DD7706        		LD	(IX+6),A	;DPB_06_FATID
                      	
  EBAC  DDCB0A7E      		BIT	7,(IX+00AH)	;DPB_0A_FDMODE
  EBB0  2817          		JR	Z,NOT_FD
  EBB2  2E28          		LD	L,40		;MAXCYLの設定（要検討）ここから下はフロッピーのみ書き換える
  EBB4  FEFD          		CP	0FDH	;2D
  EBB6  2808          		JR	Z,SETCYL
  EBB8  2E4D          		LD	L,77
  EBBA  FEFE          		CP	0FEH	;2HD
  EBBC  2802          		JR	Z,SETCYL
  EBBE  2E50          		LD	L,80	;その他2DD等
  EBC0                	SETCYL:
  EBC0  DD750C        		LD	(IX+00CH),L	;DPB_0C_MAXCYL
  EBC3  FD7E18        		LD	A,(IY+24)	;BPB_SecPerTr
  EBC6  DD770D        		LD	(IX+00DH),A	;DPB_0D_MAXSEC	;ここまでフロッピー専用
  EBC9                	NOT_FD:
  EBC9  FD7E10        		LD	A,(IY+16)	;BPB_NumFATs
  EBCC  FE02          		CP	2		;>2:NC
  EBCE  FD7E0C        		LD	A,(IY+12)	;BPB_BytsPerSec
  EBD1  3802          		JR	C,BPBFAT1
  EBD3  F680          		OR	080H
  EBD5                	BPBFAT1:
  EBD5  DD770F        		LD	(IX+00FH),A	;DPB_0F_BPS
                      	
  EBD8  E67F          		AND	07FH		;セクタバッファが1KBしかないので1KBを超える場合はCF=1でエラーにする
  EBDA  C6FB          		ADD	A,0-5		;0-4:CF=0 5以上:CF=1
  EBDC  C9            		RET
                      	
  EBDD                	RDFATS:
  EBDD  CD23EC        		CALL	FATSETUP
  EBE0  D8            		RET	C
  EBE1  CDEDEB        		CALL	DRD24B
  EBE4  2A7CF0        		LD	HL,(_FATBF)
  EBE7  7E            		LD	A,(HL)
  EBE8  C9            		RET
                      	
  EBE9                	DRD16:
  EBE9  0E00          		LD	C,0
  EBEB                	DRD24:
  EBEB  0601          		LD	B,1
  EBED                	DRD24B:
  EBED  DDE5          		PUSH	IX
  EBEF  DD2AA8EF      		LD	IX,(_DPB)
  EBF3  CD5BEE        	DRDPAT:	CALL	FDRD		;自己書き換え（ディスク読み込み）
  EBF6                	POP_IX_RET:
  EBF6  DDE1          		POP	IX
  EBF8  C9            		RET
                      	
  EBF9                	DWT16:
  EBF9  0E00          		LD	C,0
  EBFB                	DWT24:
  EBFB  0601          		LD	B,1
  EBFD                	DWT24B:
  EBFD  DDE5          		PUSH	IX
  EBFF  DD2AA8EF      		LD	IX,(_DPB)
  EC03  CD4DEE        	DWTPAT:	CALL	FDWT		;自己書き換え（ディスク書き込み）
  EC06  18EE          		JR	POP_IX_RET
                      	
  EC08                	WTFAT:
  EC08  CD23EC        		CALL	FATSETUP
  EC0B  D4FDEB        		CALL	NC,DWT24B
  EC0E  D8            		RET	C
  EC0F  DDCB0F7E      		BIT	7,(IX+00FH)	;DPB_0F_BPS
  EC13  C8            		RET	Z		;予備FATが無い
  EC14  CD2AEC        		CALL	FATS2
  EC17  E5            		PUSH	HL		;予備FAT
  EC18  DD6E00        		LD	L,(IX+0)	;DPB_00_FATLN
  EC1B  DD6601        		LD	H,(IX+1)
  EC1E  19            		ADD	HL,DE
  EC1F  EB            		EX	DE,HL
  EC20  E1            		POP	HL
  EC21  18DA          		JR	DWT24B
                      	;------------------------
                      	;FATのセットアップ
                      	;out
                      	;	B  : FATセクタ数
                      	;	DE : FAT先頭セクタ番号
                      	;	HL : FATバッファポインタ
                      	;	CF : 1=ドライブ切り替えエラー
                      	;note
                      	;	FATサイズがFATバッファを超える場合は
                      	;	対象クラスタ領域==(_FATIX)によって
                      	;	FAT12:対象クラスタ1024毎に1.5KBを切り替える
                      	;	FAT16:対象クラスタ1024毎に2KBを切り替える
                      	;------------------------
  EC23                	FATSETUP:
  EC23  3AAAEF        		LD	A,(_FATDRV)
  EC26  CD3BED        		CALL	CHGDRVR		;ドライブ切り替え
  EC29  D8            		RET	C
  EC2A                	FATS2:
  EC2A  DD7E0F        		LD	A,(IX+00FH)	;DPB_0F_BPS 512=2 1024=4
  EC2D  0F            		RRCA
  EC2E  CD57EC        	FATSX:	CALL	FATSETUP12	;自己書き換え
  EC31  210000        		LD	HL,0
  EC34  4A            		LD	C,D
  EC35  54            		LD	D,H
  EC36  3AABEF        		LD	A,(_FATIX)	;範囲FAT12:0-3/FAT16:0-63(0-03FH):65535*2/2048
  EC39  47            		LD	B,A
  EC3A  04            		INC	B
  EC3B  DD7E00        		LD	A,(IX+0)	;DPB_00_FATLN
  EC3E                	FAT_SKP:
  EC3E  05            		DEC	B
  EC3F  2805          		JR	Z,FAT1
  EC41  19            		ADD	HL,DE
  EC42  93            		SUB	E
  EC43  30F9          		JR	NC,FAT_SKP
  EC45  C9            		RET
  EC46                	FAT1:
  EC46  EB            		EX	DE,HL
  EC47  B9            		CP	C		;C=FATバッファに読み込めるセクタ数
  EC48  3801          		JR	C,FAT2
  EC4A  79            		LD	A,C
  EC4B                	FAT2:
  EC4B  47            		LD	B,A
                      	
  EC4C  2AFAF0        		LD	HL,(_FATPS)	;fat sector pos
  EC4F  19            		ADD	HL,DE
  EC50  EB            		EX	DE,HL
  EC51  2A7CF0        		LD	HL,(_FATBF)
  EC54  AF            		XOR	A		;CF=0
  EC55  4F            		LD	C,A
  EC56  C9            		RET
                      	;
                      	;	FATバッファに読み込める最大のセクタ数と_FATIXで進めるセクタ数
                      	;	FATSETUP* (FAT12/FAT16)
                      	;out
                      	;	D : FATバッファに読み込める最大のセクタ数
                      	;	E : _FATIXで進めるセクタ数
  EC57                	FATSETUP12:
  EC57  110606        		LD	DE,0606H	;256
  EC5A  D8            		RET	C
  EC5B  110303        		LD	DE,0303H	;512
  EC5E  0F            		RRCA
  EC5F  D8            		RET	C
  EC60  110102        		LD	DE,0201H	;1024
  EC63  C9            		RET
                      	
  EC64                	FATSETUP16:
  EC64  110808        		LD	DE,0808H	;256
  EC67  D8            		RET	C
  EC68  110404        		LD	DE,0404H
  EC6B  0F            		RRCA			;512
  EC6C  D8            		RET	C
  EC6D  110202        		LD	DE,0202H	;1024
  EC70  C9            		RET
                      	
  EC71                	CHGDRV:
  EC71  E5            		PUSH	HL
  EC72  2189EF        		LD	HL,_DSK
  EC75  BE            		CP	(HL)
  EC76  280A          		JR	Z,CHGDRVE
  EC78                	CHGDRV1:
  EC78  DDE5          		PUSH	IX
  EC7A  CD84EC        		CALL	CHGDRV0
  EC7D  3A89EF        		LD	A,(_DSK)
  EC80  DDE1          		POP	IX
  EC82                	CHGDRVE:
  EC82  E1            		POP	HL
  EC83  C9            		RET
                      	
  EC84                	CHGDRV0:
  EC84  6F            		LD	L,A
  EC85  CDDCEF        		CALL	_GETDPB
  EC88  D8            		RET	C
  EC89  DD22A8EF      		LD	(_DPB),IX
  EC8D  7D            		LD	A,L
  EC8E  3289EF        		LD	(_DSK),A
  EC91                	CHGDRV2:
  EC91  C5            		PUSH	BC
  EC92  D5            		PUSH	DE
  EC93  ED73F0EC      		LD	(SPPAT2+1),SP
  EC97  F3            		DI
  EC98  DDF9          		LD	SP,IX
                      	
  EC9A  E1            		POP	HL		;DPB_00_FATLN
  EC9B  E1            		POP	HL		;DPB_02_DRD
  EC9C  22F4EB        		LD	(DRDPAT+1),HL
                      	
  EC9F  E1            		POP	HL
  ECA0  2204EC        		LD	(DWTPAT+1),HL	;DPB_04_DWT
                      	
  ECA3  E1            		POP	HL		;L=DPB_06_FATID H=DPB_07_SECPCL
  ECA4  7C            		LD	A,H
  ECA5  32E6E3        		LD	(SPCPAT+1),A	;1クラスタの論理セクタ数
  ECA8  3D            		DEC	A
  ECA9  3292EA        		LD	(NCPAT+1),A
                      	
  ECAC  E1            		POP	HL		;DPB_08_MAXCL
  ECAD  7D            		LD	A,L
  ECAE  3205E4        		LD	(CLPAT2+1),A
  ECB1  7C            		LD	A,H
  ECB2  3201E4        		LD	(CLPAT1+1),A
  ECB5  2B            		DEC	HL
  ECB6  22FFE5        		LD	(MAXCLP+1),HL
                      	
  ECB9  E1            		POP	HL		;L=DPB_0A_FDMODE H=DPB_0B_DIRSCNT
  ECBA  7D            		LD	A,L
  ECBB  F6FE          		OR	0FEH
  ECBD  32F6ED        		LD	(FDMODE+1),A
  ECC0  07            		RLCA
  ECC1  E603          		AND	3
  ECC3  32DEED        		LD	(FSPAT+1),A
  ECC6  4C            		LD	C,H
                      	
  ECC7  E1            		POP	HL		;L=DPB_0C_MAXCYL H=DPB_0D_MAXSEC
  ECC8  7D            		LD	A,L
  ECC9  32A1EF        		LD	(_MAXCYL),A
  ECCC  7C            		LD	A,H
  ECCD  3287ED        		LD	(MAXSEC+1),A
                      	
  ECD0  E1            		POP	HL		;L=DPB_0E_FATPS H=DPB_0F_BPS
  ECD1  7C            		LD	A,H		;DPB_0F_BPS
  ECD2  E607          		AND	7
  ECD4  329DE8        		LD	(SECSZ+2),A	;1セクタのサイズの上位1バイト 0x400 - 0x200 - 0x100
                      					;1セクタ512 2D/2DD/2HC/2HQ(2HD1.44MB)/EMM/BRAM等
                      					;1セクタ1024 2HD/2HDE98
                      					;1セクタ256 GRAM等
                      					;1024	512	256
                      					;4	2	1
  ECD7  87            		ADD	A,A		;8	4	2
  ECD8  87            		ADD	A,A		;010H	8	4
  ECD9  87            		ADD	A,A		;020H	010H	8
  ECDA  3262E2        		LD	(SDECPAT+1),A	;1セクタ辺りのディレクトリエントリ数
                      	
  ECDD  2600          		LD	H,0
  ECDF  22FAF0        		LD	(_FATPS),HL
                      	
  ECE2  E1            		POP	HL		;L=DPB_10_DIRPS
  ECE3  22FCF0        		LD	(_DIRPS),HL
                      	
  ECE6  E1            		POP	HL		;L=DPB_12_DEVICE H=DPB_13_UNITNO
  ECE7  7C            		LD	A,H
  ECE8  3284EF        		LD	(_DRIVE),A
                      	
  ECEB  E1            		POP	HL		;DPB_14_ADDCL16
  ECEC  22F6E3        		LD	(CLSPAT+1),HL
                      	
  ECEF  310000        	SPPAT2:	LD	SP,0		;元のSPを復元
  ECF2  FB            		EI
  ECF3  2AFCF0        		LD	HL,(_DIRPS)
  ECF6  0600          		LD	B,0
  ECF8  09            		ADD	HL,BC
  ECF9  227DE2        		LD	(MD_PAT+1),HL
                      	
  ECFC  2AFFE5        		LD	HL,(MAXCLP+1);
  ECFF  11F60F        		LD	DE,4086
  ED02  B7            		OR	A
  ED03  ED52          		SBC	HL,DE
  ED05  300F          		JR	NC,SETFAT16
  ED07  2118EA        		LD	HL,GNCL		;FAT12
  ED0A  113BEA        		LD	DE,SNCL
  ED0D  0157EC        		LD	BC,FATSETUP12
  ED10  DDCB0FAE      		RES	5,(IX+00FH)	;DPB_0F_BPS(FAT12)
  ED14  180D          		JR	EXTRA1
  ED16                	SETFAT16:
  ED16  216FEA        		LD	HL,GNCL16	;FAT16
  ED19  117CEA        		LD	DE,SNCL16
  ED1C  0164EC        		LD	BC,FATSETUP16
  ED1F  DDCB0FEE      		SET	5,(IX+00FH)	;DPB_0F_BPS(FAT16)
  ED23                	EXTRA1:
  ED23  22F8EF        		LD	(GNCPAT+1),HL
  ED26  ED53FBEF      		LD	(SNCPAT+1),DE
  ED2A  ED432FEC      		LD	(FATSX+1),BC
  ED2E  D1            		POP	DE
  ED2F  C1            		POP	BC
  ED30  AF            		XOR	A
  ED31  C9            		RET
                      	
  ED32                	GETDPBD:
  ED32  DDE3          		EX	(SP),IX
  ED34  DDE5          		PUSH	IX
  ED36  3A88EF        		LD	A,(_DRV)
  ED39  1807          		JR	GETDPB1
                      	
  ED3B                	CHGDRVR:
  ED3B  CDD9EF        		CALL	_CHGDRV
  ED3E  D8            		RET	C
  ED3F  3A89EF        		LD	A,(_DSK)
  ED42                	GETDPB1:
  ED42  C3DCEF        		JP	_GETDPB
                      	
  ED45                	GETDPB:
  ED45  FE08          		CP	8
  ED47  3F            		CCF
  ED48  D8            		RET	C
  ED49  0F            		RRCA
  ED4A  0F            		RRCA
  ED4B  0F            		RRCA
  ED4C  DD            		DB	0DDH		;Z80未定義命令
  ED4D  6F            		LD	L,A		;LD	IXL,A
  ED4E  DD            		DB	0DDH		;Z80未定義命令
  ED4F  26F1          		LD	H,DEVICE/256	;LD	IXH,DEVICE/256
  ED51  DD7E00        		LD	A,(IX+0)	;DPB_00_FATLN
  ED54  B7            		OR	A		;CF=0の為
  ED55  DDCB0F6E      		BIT	5,(IX+00FH)	;DPB_0F_BPS
  ED59  C0            		RET	NZ		;FAT16
  ED5A  DDCB126E      		BIT	5,(IX+012H)	;DPB_12_DEVICE
  ED5E  C0            		RET	NZ		;BPB
  ED5F  FE01          		CP	001H		;A=0 THEN CF=1
  ED61  C9            		RET
                      	
  ED62                	_SYS5F:
  ED62  AF            		XOR	A
  ED63                	FFLUSH:
  ED63  F5            		PUSH	AF
  ED64  3EFF          		LD	A,0FFH
  ED66  3239EF        		LD	(SFILE),A
  ED69  CD56E9        		CALL	DWTX
  ED6C  3EFF          		LD	A,0FFH
  ED6E  32A5EF        		LD	(_DBDRV),A
  ED71  CDA0E9        		CALL	WTFATX
  ED74  AF            		XOR	A
  ED75  32ABEF        		LD	(_FATIX),A
  ED78  2F            		CPL
  ED79  32AAEF        		LD	(_FATDRV),A
  ED7C  F1            		POP	AF
  ED7D  C9            		RET
                      	
                      	
                      	;LDDISK.ASM
                      	
                      	;	LSX-Dodgers DISK
                      	
                      	
  ED7E                	SEEK:
  ED7E  7A            		LD	A,D
  ED7F  B3            		OR	E
  ED80  3E01          		LD	A,001H
  ED82  2811          		JR	Z,DIV3
                      	
  ED84  0610          		LD	B,16
  ED86  0E00          	MAXSEC:	LD	C,000H
  ED88  AF            		XOR	A
  ED89  EB            		EX	DE,HL
  ED8A                	DIV1:
  ED8A  29            		ADD	HL,HL
  ED8B  8F            		ADC	A,A
  ED8C  B9            		CP	C
  ED8D  3802          		JR	C,DIV2
  ED8F  91            		SUB	C
  ED90  2C            		INC	L
  ED91                	DIV2:
  ED91  10F7          		DJNZ	DIV1
                      	
  ED93  3C            		INC	A	;最小のセクタは１固定
  ED94  55            		LD	D,L	;Quotient(TRACK)
  ED95                	DIV3:
  ED95  5F            		LD	E,A	;Remainder
  ED96  CB3A          		SRL	D	;CYLINDER
  ED98  9F            		SBC	A,A
  ED99  E610          		AND	010H	;SIDE
  ED9B  4F            		LD	C,A
                      	
  ED9C  3A84EF        		LD	A,(_DRIVE)
  ED9F  FE04          		CP	4
  EDA1  3F            		CCF
  EDA2  D8            		RET	C
  EDA3  B1            		OR	C
  EDA4  3222EE        		LD	(MOPAT+1),A	;Motor off data
  EDA7  01FC0F        		LD	BC,00FFCH
  EDAA  F680          		OR	080H		;Mortor on
  EDAC  ED79          		OUT	(C),A
                      	
  EDAE  CDF4ED        		CALL	SETMODE
  EDB1  D8            		RET	C
                      	
  EDB2  CD37EE        		CALL	DRIVE
  EDB5  FEFF          		CP	0FFH		;A=0FFH Unknown CYLINDER
  EDB7  CC16EE        		CALL	Z,FDCRES	;Restore
  EDBA  0EF9          		LD	C,0F9H
  EDBC  ED79          		OUT	(C),A		;Currrent CYLINDER
  EDBE  92            		SUB	D
  EDBF  C8            		RET	Z		;No seek
                      	
  EDC0  3A86EF        		LD	A,(_ISEEK)
  EDC3  4F            		LD	C,A
                      	
  EDC4  3AA1EF        		LD	A,(_MAXCYL)	;Max CYLINDER
  EDC7  3D            		DEC	A
  EDC8  BA            		CP	D		;Over CYLINDER
  EDC9  D8            		RET	C
                      	
  EDCA  B9            		CP	C		;for Built-in 2DD
  EDCB  3803          		JR	C,SETM2
  EDCD  78            		LD	A,B		;B=00FH
  EDCE  DBFE          		IN	A,(0FEH)		;2HD mode for 2DD seek
  EDD0                	SETM2:
  EDD0  78            		LD	A,B
  EDD1  DBFD          		IN	A,(0FDH)		;MFM mode
                      	
  EDD3  0EFB          		LD	C,0FBH
  EDD5  ED51          		OUT	(C),D
  EDD7  72            		LD	(HL),D
  EDD8  0E18          		LD	C,018H		;Seek
  EDDA                	FDCCMD2:
  EDDA  3A85EF        		LD	A,(_SEEKSP)
  EDDD  E6FF          	FSPAT:	AND	0FFH
  EDDF  B1            		OR	C
                      	
  EDE0                	FDCCMD:
  EDE0  CD2DEE        		CALL	COMSET
                      	
  EDE3  3E80          	FDCPAT:	LD	A,080H		;FDC COMMAND(Self-rewriting)
  EDE5  E620          		AND	020H		;Write data Write track
  EDE7  3C            		INC	A
                      	
  EDE8                	SST:
  EDE8  0E00          		LD	C,0
  EDEA                	SST1:
  EDEA  0D            		DEC	C		; 4
  EDEB  20FD          		JR	NZ,SST1		;12 * 256 / 4 = About 1ms
  EDED  3D            		DEC	A
  EDEE  20FA          		JR	NZ,SST1
                      	
  EDF0  3C            		INC	A		;A=1
  EDF1  CDFFED        		CALL	READY
  EDF4                	SETMODE:
  EDF4  78            		LD	A,B		;B=00FH
  EDF5  DBFF          	FDMODE:	IN	A,(0FFH)		;Floppy mode(2D/2HD) (Self-rewriting)
                      	
  EDF7  78            		LD	A,B
  EDF8  DBFD          		IN	A,(0FDH)		;MFM mode
                      	
  EDFA  CD31EE        		CALL	DELAY0		;Head select time
  EDFD  3E81          		LD	A,081H
  EDFF                	READY:
  EDFF  3209EE        		LD	(WAITA+1),A
  EE02  E5            		PUSH	HL
  EE03  0EF8          		LD	C,0F8H
  EE05  61            		LD	H,C
  EE06                	READY2:
  EE06  ED78          		IN	A,(C)
  EE08  E681          	WAITA:	AND	081H		;NOT READY,BUSY
  EE0A  2808          		JR	Z,READYE
  EE0C  E3            		EX	(SP),HL		;wait 19clock
  EE0D  E3            		EX	(SP),HL		; //
  EE0E  2B            		DEC	HL
  EE0F  7C            		LD	A,H
  EE10  B5            		OR	L
  EE11  20F3          		JR	NZ,READY2
  EE13  37            		SCF
  EE14                	READYE:
  EE14  E1            		POP	HL
  EE15  C9            		RET
                      	
  EE16                	FDCRES:
  EE16  3600          		LD	(HL),0
  EE18  0E08          		LD	C,8
  EE1A  18BE          		JR	FDCCMD2
                      	
  EE1C                	FDMOFF:
  EE1C  F5            		PUSH	AF
  EE1D  C5            		PUSH	BC
  EE1E  01FC0F        		LD	BC,00FFCH	;Motor off
  EE21  3E00          	MOPAT:	LD	A,000H		;(Self-rewriting)
  EE23  ED79          		OUT	(C),A
  EE25  C1            		POP	BC
  EE26  F1            		POP	AF
  EE27  C9            		RET
                      	
  EE28                	SECSET:
  EE28  01FA0F        		LD	BC,00FFAH
  EE2B  ED59          		OUT	(C),E
  EE2D                	COMSET:
  EE2D  0EF8          		LD	C,0F8H
  EE2F  ED79          		OUT	(C),A
  EE31                	DELAY0:
  EE31  3E1A          		LD	A,26
  EE33                	DELAY:
  EE33  3D            		DEC	A
  EE34  20FD          		JR	NZ,DELAY
  EE36  C9            		RET
                      	
  EE37                	DRIVE:
  EE37  2A84EF        		LD	HL,(_DRIVE)
  EE3A  26EF          		LD	H,_CYL0/256
  EE3C  CBFD          		SET	7,L
  EE3E  7E            		LD	A,(HL)
  EE3F  C9            		RET
                      	
  EE40                	RNF:
  EE40  CD37EE        		CALL	DRIVE
  EE43  36FF          		LD	(HL),0FFH
  EE45  C9            		RET
                      	
  EE46  02            	RETRY:	DB	2
                      	
                      	
                      	;	FLOPPY DISK DRIVER(DMA)
                      	
                      	
  EE47                	WTTRK:
  EE47  0601          		LD	B,1
  EE49  3EF4          		LD	A,0F4H
  EE4B  1802          		JR	WTTRK1
  EE4D                	FDWT:
  EE4D  3EA0          		LD	A,0A0H
  EE4F                	WTTRK1:
  EE4F  32E4ED        		LD	(FDCPAT+1),A
  EE52  3E10          		LD	A,16
  EE54  180C          		JR	DISK
                      	
  EE56                	DISKOK:
  EE56  0601          	FDCNT:	LD	B,1
  EE58  100B          		DJNZ	DISK1
  EE5A  C9            		RET
                      	
  EE5B                	FDRD:
  EE5B  3E80          		LD	A,080H
  EE5D  32E4ED        		LD	(FDCPAT+1),A
  EE60  3E0E          		LD	A,14
                      	
  EE62                	DISK:
  EE62  3279EE        		LD	(DMAPAT+1),A
  EE65                	DISK1:
  EE65  78            		LD	A,B
  EE66  3257EE        		LD	(FDCNT+1),A
  EE69  22FBEE        		LD	(DMAD+11),HL
  EE6C                	DISKR:
  EE6C  3E02          		LD	A,2		;Retry count
  EE6E  3246EE        		LD	(RETRY),A
  EE71                	DISK2:
  EE71  D5            		PUSH	DE
  EE72  CD7EED        		CALL	SEEK
  EE75  3843          		JR	C,ERRF
  EE77  F3            		DI
                      	
  EE78  3E0E          	DMAPAT:	LD	A,14		;自己書き換え
  EE7A  21F0EE        		LD	HL,DMAD
  EE7D  CDF5DF        		CALL	SETDMA
  EE80  ED49          		OUT	(C),C		;OUT 01F87H,087H WR6 イネーブル
  EE82  3AE4ED        		LD	A,(FDCPAT+1)
  EE85  C5            		PUSH	BC
  EE86  CD28EE        		CALL	SECSET
  EE89  2AFBEE        		LD	HL,(DMAHL)
  EE8C  23            		INC	HL
  EE8D  1106BB        		LD	DE,0BB06H	;READ DMA
                      	
  EE90  3E03          		LD	A,3
  EE92  CDFFED        		CALL	READY
  EE95  ED78          		IN	A,(C)
                      	
  EE97  C1            		POP	BC
  EE98  ED51          		OUT	(C),D		;読み出しマスク設定
  EE9A  ED59          		OUT	(C),E		;バイトカウンタ(LH)
  EE9C  ED58          		IN	E,(C)
  EE9E  ED50          		IN	D,(C)
  EEA0  19            		ADD	HL,DE
  EEA1  D1            		POP	DE
  EEA2  13            		INC	DE
  EEA3  FB            		EI
  EEA4  CD1CEE        		CALL	FDMOFF
  EEA7  B7            		OR	A
  EEA8  28AC          		JR	Z,DISKOK
  EEAA  1B            		DEC	DE
  EEAB  CB67          		BIT	4,A
  EEAD  C440EE        		CALL	NZ,RNF
  EEB0                	DISKE2:
  EEB0  2146EE        		LD	HL,RETRY
  EEB3  35            		DEC	(HL)
  EEB4  20BB          		JR	NZ,DISK2
  EEB6  B7            		OR	A
  EEB7  2834          		JR	Z,ERR
  EEB9  D5            		PUSH	DE
  EEBA                	ERRF:
  EEBA  D1            		POP	DE
  EEBB                	DELP:
  EEBB  CD40EE        		CALL	RNF
  EEBE  CD1CEE        		CALL	FDMOFF
  EEC1  3A85EF        		LD	A,(_SEEKSP)
  EEC4  87            		ADD	A,A
  EEC5  9F            		SBC	A,A
  EEC6  3825          		JR	C,ERR
  EEC8                	DELP1:
  EEC8  D5            		PUSH	DE
  EEC9  21C0F0        		LD	HL,DEMES
  EECC  CD6FD8        		CALL	MSX
  EECF  CDEDDB        		CALL	KEYBC
  EED2                	DELP2:
  EED2  CDCAEF        		CALL	_INKEY
  EED5  28FB          		JR	Z,DELP2
                      	
  EED7  D1            		POP	DE
  EED8  CD07E4        		CALL	CAP
  EEDB  FE52          		CP	'R'		;Retry
  EEDD  CA6CEE        		JP	Z,DISKR
  EEE0  FE49          		CP	'I'		;Ignore
  EEE2  2807          		JR	Z,IGNORE
  EEE4  FE41          		CP	'A'		;Abort
  EEE6  20E0          		JR	NZ,DELP1
  EEE8  C300EF        		JP	CPM_BOOT
  EEEB                	IGNORE:
  EEEB  3EFF          		LD	A,0FFH
  EEED                	ERR:
  EEED  BF            		CP	A
  EEEE  37            		SCF
  EEEF  C9            		RET
                      	
                      				;X1turbo DISK DMA
  EEF0  C3            	DMAD:	DB	0C3H	;WR6 リセット
  EEF1  7D            		DB	07DH	;WR0 ポートA→ポートB 転送
  EEF2  FB0F          		DW	00FFBH	;ポートA開始アドレス FDC データレジスタ
  EEF4  FFFF          		DW	0FFFFH	;ブロック長(転送サイズ-1)
  EEF6  2C            		DB	02CH	;WR1 ポートAアドレス固定 I/O
  EEF7  10            		DB	010H	;WR2 ポートBインクリメント
  EEF8  80            		DB	080H	;WR3
  EEF9  92            		DB	092H	;WR5 WAIT RDY:LOW
  EEFA  8D            		DB	08DH	;WR4 バイト ポートB開始アドレス(LH)
  EEFB  0000          	DMAHL:	DW	0	;ポートB開始アドレス
  EEFD  CF            		DB	0CFH	;WR6 ロード
  EEFE  01            		DB	001H	;WR0 ポートB←ポートB 転送
  EEFF  CF            		DB	0CFH	;WR6 ロード
                      	
  EF00                	DMAE:
                      	
  1E7F                	AT_R	EQU	WTTRK-AT_WTTRK
                      	
                      	;LDWORK.ASM
                      	
                      	;	LSX-Dodgers WORK
                      	;
                      	;	CP/M互換BIOS
                      	;	BOOT:アドレス下位1バイトが0になるように
  EF00                	CPM_BOOT:
  EF00  C30000        		JP	0
  EF03                	_SYS00:		;(BDOS)プログラム終了
  EF03                	CPM_WBOOT:
  EF03  C30CD1        		JP	WBOOT1
  EF06                	CPM_CONST:
  EF06  C3A7DC        		JP	CONSTX
  EF09                	_SYS07:		;(BDOS)コンソール直接入力
  EF09                	CPM_CONIN:
  EF09  C34EDC        		JP	FLGET
  EF0C                	CPM_CONOUT:
  EF0C  C3E6DE        		JP	CONOUT1
                      	
  EF0F                	DECBF:
  EF0F                		DS	5
  EF14  00            	FDRV	DB	0
  EF15                	FNAME	DS	36
  EF39                	SFILE:	DS	33		;DRV FILENAME
  EF5A                	HLBUF:	DS	3		;Random record buffer
                      	
  EF5D  0000          	LEFTX:	DW	0
  EF5F  0000          	DTAX:	DW	0
                      	
  EF61  008E01000B000C	BEEPD:	DB	0,08EH,1,0,00BH,0,00CH,010H
  EF69  073E08100D00FF		DB	007H,03EH,008H,010H,00DH,0,0FFH
                      	
  EF70  00            	CHECK:	DB	0
                      	
  EF71  4F4B24        	OK:	DB	"OK$"
  EF74  536B697024    	SKIP:	DB	"Skip$"
  EF79  4572726F722124	COMERM:	DB	"Error!$"
                      	;	システムワークエリア
                      	;	_CYL0:アドレス下位1バイトが080Hになるように
  EF80  FF            	_CYL0:	DB	0FFH	;Cylinder
  EF81  FF            	_CYL1:	DB	0FFH	;Cylinder
  EF82  FF            	_CYL2:	DB	0FFH	;Cylinder
  EF83  FF            	_CYL3:	DB	0FFH	;Cylinder
  EF84  00            	_DRIVE:	DB	0	;unit number
  EF85  00            	_SEEKSP:DB	0	;Seek speed
  EF86  FF            	_ISEEK:	DB	0FFH	;
  EF87  00            	_DVSW:	DB	0
  EF88  00            	_DRV:	DB	0
  EF89  FF            	_DSK:	DB	0FFH
  EF8A  8000          	_DTA:	DW	00080H
  EF8C  0000          	_CTC:	DW	0
  EF8E  0000          	_TXADR:	DW	0
  EF90  0000          	_KEYPS:	DW	0
  EF92  00FF          	_KEYD:	DW	0FF00H	;キーデータ
  EF94  C210          	_KEYSP:	DW	010C2H
  EF96  07            	_COLORF:DB	7	;色
  EF97  18            	_LINE:	DB	LINE
                      	
  EF98  0000          	_FCB:	DW	0
  EF9A  0000          	_FBPS:	DW	0	;SEARCH FILES
  EF9C  0000          	_FBAD:	DW	0	;    //
  EF9E  00            	_FBCNT:	DB	0	;    //
  EF9F  00            	_FILEN:	DB	0
  EFA0  00            	_DIRF:	DB	0	;bit7:ディレクトリ bit0-6:セクタインデックス
  EFA1  00            	_MAXCYL:DB	0
  EFA2  00            	_WTFATF:DB	0	;FATバッファの更新フラグ
  EFA3                			DS	1
  EFA4  00            	_WTDBF:	DB	0	;データバッファの更新フラグ
  EFA5  FF            	_DBDRV:	DB	0FFH	;データバッファにあるデータを読み込んだドライブ
  EFA6  0000          	_DBSEC:	DW	0	;データバッファにあるデータを読み込んだセクタ番号
  EFA8  0000          	_DPB:	DW	0
  EFAA                	_FATDRV:
  EFAA  FF            		DB	0FFH	;FATバッファに読み込んでいるドライブ
  EFAB  00            	_FATIX:	DB	0	;FATバッファに読み込んでいるインデックス
  EFAC                	_FAKEFREE:
  EFAC  0000          		DW	0	;偽の残量（FATサイズが大きくなると重くなるのでその対策）
                      	
  EFAE                		DS	2
                      	
  EFB0  6F5059381F0219	CRTCD:	DB	06FH,050H,059H,038H,01FH,002H,019H,01CH
  EFB8  0007          		DB	000H,007H
  EFBA  80F8B0FF      		DW	0-80*LINE,0-80
  EFBE  0C            		DB	00CH
  EFBF  20            	WK1FD0:	DB	020H
                      	
  EFC0  56DB          	CTC0:	DW	INTCTCE
  EFC2  56DB          	CTC1:	DW	INTCTCE
  EFC4  78DB          	CTC2:	DW	INTCTC2
  EFC6  56DB          	CTC3:	DW	INTCTCE
  EFC8  3FDB          	INTVEC:	DW	INT
                      	
                      	;	LSX-Dodgers 独自BIOS
                      	
  EFCA  C3DBE0        	_INKEY:	JP	INKEY
  EFCD  C375DD        	_PRINT:	JP	PRINT
  EFD0  C345E0        	_SCRN:	JP	SCRN
  EFD3  C36DE0        	_POS:	JP	POS
  EFD6  C3AFDE        	_LOC:	JP	LOC
  EFD9                	_CHGDRV:
  EFD9  C371EC        		JP	CHGDRV
  EFDC                	_GETDPB:
  EFDC  C345ED        		JP	GETDPB
  EFDF                	_FFLUSH:
  EFDF  C363ED        		JP	FFLUSH
  EFE2                	_RDFATX:
  EFE2  C376E9        		JP	RDFATX
  EFE5  C39EEA        	_RDFAT:	JP	RDFAT
  EFE8  C347EE        	_WTTRK:	JP	WTTRK
  EFEB  C35BEE        	_FDRD:	JP	FDRD
  EFEE  C34DEE        	_FDWT:	JP	FDWT
  EFF1                	_BPB2DPB:
  EFF1  C303EB        		JP	BPB2DPB
  EFF4                		DS	3
  EFF7                	_GNCL:
  EFF7  C318EA        	GNCPAT:	JP	GNCL		; self-modifying code
  EFFA                	_SNCL:
  EFFA  C33BEA        	SNCPAT:	JP	SNCL		; self-modifying code
  EFFD  C38AD1        	_COMANL:JP	COMANL
                      	
  F000                	_WE:
                      	
                      	;LDCALL.ASM
                      	
                      	;	LSX-Dodgers システムコール(BDOS)
                      	;
                      	;	LSX-Dodgers SYSTEM CALL
                      	;	STABLE:アドレス下位1バイトが0になるように
                      	
  F000                	STABLE:
                      	;0
  F000  03EF21DC2DDC8F		DW	_SYS00,_SYS01,_SYS02,_SYS03
  F008  5ED85ED832DC09		DW	_SYS04,_SYS05,_SYS06,_SYS07
  F010  3ADC60D873DC9F		DW	_SYS08,_SYS09,_SYS0A,_SYS0B
  F018  75D87AD889D89C		DW	_SYS0C,_SYS0D,_SYS0E,_SYS0F
                      	;1
  F020  F0D837D980D9B6		DW	_SYS10,_SYS11,_SYS12,_SYS13
  F028  BED9DCD9F9D9F1		DW	_SYS14,_SYS15,_SYS16,_SYS17
  F030  5ADA5FDA64DA6A		DW	_SYS18,_SYS19,_SYS1A,_SYS1B
  F038  5ED890DA5ED894		DW	_SYS1C,_SYS1D,_SYS1E,_SYS1F
                      	;2
  F040  5ED830DA45DA9B		DW	_SYS20,_SYS21,_SYS22,_SYS23
  F048  BADA5ED8CBE6AC		DW	_SYS24,_ERROR,_SYS26,_SYS27
  F050  45DAC3DAB5DC8F		DW	_SYS28,_SYS5C,_SYS2A,_SYS2B
  F058  E9DC8FE25ED8E6		DW	_SYS2C,_SYS2D,_SYS2E,_SYS2F
                      	;3
  F060  E0DA5ED85ED85E		DW	_SYS30,_ERROR,_ERROR,_ERROR
  F068  5ED85ED85ED85E		DW	_ERROR,_ERROR,_ERROR,_ERROR
  F070  5ED88FE28FE207		DW	_ERROR,_SYS39,_SYS3A,_SYS5A
                      	;DOS2
  F078  44D8          		DW	_DOS2
                      	
  F07A                		DS	2
  F07C  00F2          	_FATBF:	DW	FATBF
  F07E  00FA          	_DTBUF:	DW	DTBUF
                      	
                      	;	コントロールコードテーブル
                      	;	CTRLTB:アドレス下位1バイトが080Hになるように
                      	
  F080                	CTRLTB:
  F080  26DE26DE62DEA7		DW	CTRL00,CTRL00,CTRL02,CTRL03	;  A,B,C
  F088  A1DF86DE80DF07		DW	CTRL04,CTRL05,CTRL06,CTRL07	;D,E,F,G
  F090  32DE53DEAADFC5		DW	CTRL08,CTRL09,CTRL0A,CTRL0B	;H,I,J,K
  F098  7DDFAADEBFDF26		DW	CTRL0C,CTRL0D,CTRL0E,CTRL00	;L,M,N,O
  F0A0  26DE26DEBDDE26		DW	CTRL00,CTRL00,CTRL12,CTRL00	;P,Q,R,S
  F0A8  26DE26DE26DE26		DW	CTRL00,CTRL00,CTRL00,CTRL00	;T,U,V,W
  F0B0  26DE26DE7DDFCC		DW	CTRL00,CTRL00,CTRL0C,CTRL1B	;X,Y,Z,ESC
  F0B8  4DDE39DE42DEAA		DW	CTRL1C,CTRL1D,CTRL1E,CTRL1F	;→,←,↑,↓
                      	
  F0C0  0307          	DEMES:	DB	3,7
  F0C2  44657669636520		DB	"Device I/O Error",5,3
  F0D4  41626F72742052		DB	"Abort Retry Ignore?",5,3,0
                      	
  F0EA  1617          	SDDATA:	DB	22,23		;(FCB)ファイルを最後に変更した時刻
  F0EC  1415          		DB	20,21		;(FCB)ファイルを最後に変更した日付
  F0EE  1A1B          		DB	26,27		;(FCB)ファイルの先頭クラスタ
  F0F0  10111213      		DB	16,17,18,19	;(FCB)ファイルのサイズ(バイト単位)
  F0F4                	SDDATAE:
                      	
  F0F4                	SCDIR:	DS	2		;+14 +15
  F0F6                	SFBPS:	DS	2		;FBPS
  F0F8                	SFNDF:	DS	2		;FILEN DIRF
                      	
  F0FA  0000          	_FATPS:	DW	0
  F0FC  0000          	_DIRPS:	DW	0
  F0FE  0000          	_CLPS:	DW	0
                      	
  F100                	_PE:
                      	
                      	;LDDPB.ASM
                      	
                      	;	LSX-Dodgers DPB
                      	
  F100                	DEVICE:
                      	
                      	;	A:
                      	
  F100  0200          		DW	2	;DPB_00_FATLN
  F102  EBEF          		DW	_FDRD	;DPB_02_DRD
  F104  EEEF          		DW	_FDWT	;DPB_04_DWT
  F106  FD            		DB	0FDH	;DPB_06_FATID
  F107  02            		DB	2	;DPB_07_SECPCL
  F108  6401          		DW	356	;DPB_08_MAXCL
  F10A  FF            		DB	0FFH	;DPB_0A_FDMODE	0FFH=2D / 0FEH=2HD
  F10B  07            		DB	7	;DPB_0B_DIRSCNT
  F10C  28            		DB	40	;DPB_0C_MAXCYL
  F10D  09            		DB	9	;DPB_0D_MAXSEC	Number of sectors
  F10E  01            		DB	1	;DPB_0E_FATPS
  F10F  82            		DB	082H	;DPB_0F_BPS
  F110  0500          		DW	5	;DPB_10_DIRPS
  F112  A7            		DB	0A7H	;DPB_12_DEVICE	Device Number
  F113  00            		DB	0	;DPB_13_UNITNO
  F114  0800          		DW	8	;DPB_14_ADDCL16
  F116  0000          		DW	0	;DPB_16
  F118  0000          		DW	0	;DPB_18
  F11A  0000          		DW	0	;DPB_1A_SDIR
  F11C  46444430      		DB	"FDD0"	;DPB_1C_NAME
                      	
                      	;	B:
                      	
  F120  0200          		DW	2	;DPB_00_FATLN
  F122  EBEF          		DW	_FDRD	;DPB_02_DRD
  F124  EEEF          		DW	_FDWT	;DPB_04_DWT
  F126  FD            		DB	0FDH	;DPB_06_FATID
  F127  02            		DB	2	;DPB_07_SECPCL
  F128  6401          		DW	356	;DPB_08_MAXCL
  F12A  FF            		DB	0FFH	;DPB_0A_FDMODE	0FFH=2D / 0FEH=2HD
  F12B  07            		DB	7	;DPB_0B_DIRSCNT
  F12C  28            		DB	40	;DPB_0C_MAXCYL
  F12D  09            		DB	9	;DPB_0D_MAXSEC	Number of sectors
  F12E  01            		DB	1	;DPB_0E_FATPS
  F12F  82            		DB	082H	;DPB_0F_BPS
  F130  0500          		DW	5	;DPB_10_DIRPS
  F132  A7            		DB	0A7H	;DPB_12_DEVICE	Device Number
  F133  01            		DB	1	;DPB_13_UNITNO
  F134  0800          		DW	8	;DPB_14_ADDCL16
  F136  0000          		DW	0	;DPB_16
  F138  0000          		DW	0	;DPB_18
  F13A  0000          		DW	0	;DPB_1A_SDIR
  F13C  46444431      		DB	"FDD1"	;DPB_1C_NAME
                      	
                      	;	C:
                      	
  F140  0200          		DW	2	;DPB_00_FATLN
  F142  EBEF          		DW	_FDRD	;DPB_02_DRD
  F144  EEEF          		DW	_FDWT	;DPB_04_DWT
  F146  FD            		DB	0FDH	;DPB_06_FATID
  F147  02            		DB	2	;DPB_07_SECPCL
  F148  6401          		DW	356	;DPB_08_MAXCL
  F14A  FF            		DB	0FFH	;DPB_0A_FDMODE	0FFH=2D / 0FEH=2HD
  F14B  07            		DB	7	;DPB_0B_DIRSCNT
  F14C  28            		DB	40	;DPB_0C_MAXCYL
  F14D  09            		DB	9	;DPB_0D_MAXSEC	Number of sectors
  F14E  01            		DB	1	;DPB_0E_FATPS
  F14F  82            		DB	082H	;DPB_0F_BPS
  F150  0500          		DW	5	;DPB_10_DIRPS
  F152  A7            		DB	0A7H	;DPB_12_DEVICE	Device Number
  F153  02            		DB	2	;DPB_13_UNITNO
  F154  0800          		DW	8	;DPB_14_ADDCL16
  F156  0000          		DW	0	;DPB_16
  F158  0000          		DW	0	;DPB_18
  F15A  0000          		DW	0	;DPB_1A_SDIR
  F15C  46444432      		DB	"FDD2"	;DPB_1C_NAME
                      	
                      	;	D:
                      	
  F160  0200          		DW	2	;DPB_00_FATLN
  F162  EBEF          		DW	_FDRD	;DPB_02_DRD
  F164  EEEF          		DW	_FDWT	;DPB_04_DWT
  F166  FD            		DB	0FDH	;DPB_06_FATID
  F167  02            		DB	2	;DPB_07_SECPCL
  F168  6401          		DW	356	;DPB_08_MAXCL
  F16A  FF            		DB	0FFH	;DPB_0A_FDMODE	0FFH=2D / 0FEH=2HD
  F16B  07            		DB	7	;DPB_0B_DIRSCNT
  F16C  28            		DB	40	;DPB_0C_MAXCYL
  F16D  09            		DB	9	;DPB_0D_MAXSEC	Number of sectors
  F16E  01            		DB	1	;DPB_0E_FATPS
  F16F  82            		DB	082H	;DPB_0F_BPS
  F170  0500          		DW	5	;DPB_10_DIRPS
  F172  A7            		DB	0A7H	;DPB_12_DEVICE
  F173  03            		DB	3	;DPB_13_UNITNO
  F174  0800          		DW	8	;DPB_14_ADDCL16
  F176  0000          		DW	0	;DPB_16
  F178  0000          		DW	0	;DPB_18
  F17A  0000          		DW	0	;DPB_1A_SDIR
  F17C  46444433      		DB	"FDD3"	;DPB_1C_NAME
                      	
                      	;	E:
                      	
  F180  0000          	EMMFL:	DW	0	;DPB_00_FATLN
  F182  D3D7          	EMMRD:	DW	EDRD	;DPB_02_DRD
  F184  CFD7          	EMMWR:	DW	EDWT	;DPB_04_DWT
  F186  FE            		DB	0FEH	;DPB_06_FATID
  F187  02            		DB	2	;DPB_07_SECPCL
  F188  0000          	EMMCL:	DW	0	;DPB_08_MAXCL
  F18A  00            		DB	0	;DPB_0A_FDMODE
  F18B  0C            		DB	12	;DPB_0B_DIRSCNT
  F18C  00            	EMMBL:	DB	0	;DPB_0C_MAXCYL
  F18D  01            		DB	1	;DPB_0D_MAXSEC
  F18E  02            		DB	2	;DPB_0E_FATPS
  F18F  02            		DB	2	;DPB_0F_BPS
  F190  0A00          		DW	10	;DPB_10_DIRPS
  F192  06            		DB	6	;DPB_12_DEVICE
  F193  00            	EMMDV:	DB	0	;DPB_13_UNITNO
  F194  1200          		DW	18	;DPB_14_ADDCL16
  F196  0000          		DW	0	;DPB_16
  F198  0000          		DW	0	;DPB_18
  F19A  0000          		DW	0	;DPB_1A_SDIR
  F19C  454D4D30      		DB	"EMM0"	;DPB_1C_NAME
                      	
                      	;	F:
                      	
  F1A0  0000          	BANKFL:	DW	0	;DPB_00_FATLN
  F1A2  6AD7          		DW	BDRD	;DPB_02_DRD
  F1A4  66D7          		DW	BDWT	;DPB_04_DWT
  F1A6  F9            		DB	0F9H	;DPB_06_FATID
  F1A7  02            		DB	2	;DPB_07_SECPCL
  F1A8  0000          	BANKCL:	DW	0	;DPB_08_MAXCL
  F1AA  00            		DB	0	;DPB_0A_FDMODE
  F1AB  08            		DB	8	;DPB_0B_DIRSCNT
  F1AC  00            		DB	0	;DPB_0C_MAXCYL
  F1AD  01            		DB	1	;DPB_0D_MAXSEC
  F1AE  00            		DB	0	;DPB_0E_FATPS
  F1AF  02            		DB	2	;DPB_0F_BPS
  F1B0  0200          		DW	2	;DPB_10_DIRPS
  F1B2  0B            		DB	00BH	;DPB_12_DEVICE
  F1B3  00            		DB	0	;DPB_13_UNITNO
  F1B4  0600          		DW	6	;DPB_14_ADDCL16
  F1B6  0000          		DW	0	;DPB_16
  F1B8  0000          		DW	0	;DPB_18
  F1BA  0000          		DW	0	;DPB_1A_SDIR
  F1BC  4252414D      		DB	"BRAM"	;DPB_1C_NAME
                      	
                      	;	G:
                      	
  F1C0  0100          		DW	1	;DPB_00_FATLN
  F1C2  27D7          		DW	GDRD	;DPB_02_DRD
  F1C4  3ED7          		DW	GDWT	;DPB_04_DWT
  F1C6  F9            		DB	0F9H	;DPB_06_FATID
  F1C7  04            		DB	4	;DPB_07_SECPCL
  F1C8  3000          		DW	48	;DPB_08_MAXCL
  F1CA  00            		DB	0	;DPB_0A_FDMODE
  F1CB  04            		DB	4	;DPB_0B_DIRSCNT
  F1CC  00            		DB	0	;DPB_0C_MAXCYL
  F1CD  01            		DB	1	;DPB_0D_MAXSEC
  F1CE  00            		DB	0	;DPB_0E_FATPS
  F1CF  01            		DB	1	;DPB_0F_BPS
  F1D0  0400          		DW	4	;DPB_10_DIRPS
  F1D2  05            		DB	5	;DPB_12_DEVICE
  F1D3  01            		DB	1	;DPB_13_UNITNO
  F1D4  0000          		DW	0	;DPB_14_ADDCL16
  F1D6  0000          		DW	0	;DPB_16
  F1D8  0000          		DW	0	;DPB_18
  F1DA  0000          		DW	0	;DPB_1A_SDIR
  F1DC  4752414D      		DB	"GRAM"	;DPB_1C_NAME
                      	
                      	;	H:
  F1E0                		DS	31
  F1FF  00            		DB	0
                      	
                      	
  F200                	LDEND:
                      	
  F200                		END
