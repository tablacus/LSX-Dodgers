			  Z80 ASSEMBLER - ZASM VER 1.6
                      	;	LSX-Dodgers for X1/turbo/Z
                      	;	Programmed by
                      	;	Gaku (Lovers/Tablacus)
                      	
  C600                	RUN	EQU	0C600h
                      	
  C5F9                		ORG	RUN-7
                      	
                      	;	MSX BINARY HEADER
  C5F9  FE            		DB	0FEH
                      	;	MSX BINARY START ADDRESS
  C5FA  00C6          		DW	RUN
                      	;	MSX BINARY END ADDRESS
  C5FC  E0ED          		DW	LDEND
                      	;	MSX BINARY EXEC ADDRESS
  C5FE  00C6          		DW	RUN
                      	;LDDEF.ASM
                      	
                      	;	LSX-Dodgers DEF
                      	
  1D90                	MAC	EQU	01D90H		;X1
  0001                	VER_1   EQU	1
  0003                	VER_2   EQU	3
  0007                	VER_3   EQU	7
  0137                	VER	EQU	VER_1 * 256 + VER_2 * 16 + VER_3
                      	
  0000                	STACK	EQU	00000H
  0005                	SYSTEM	EQU	00005H
  000F                	JP_HL	EQU	0000FH
  005C                	FCB1	EQU	0005CH
  006C                	FCB2	EQU	0006CH
  0080                	DTA1	EQU	00080H
  00DB                	FDRV	EQU	00100H-37
  00DC                	FNAME	EQU	FDRV+1
  00D5                	DECBF	EQU	FDRV-6
  EE00                	FATBF	EQU	0EE00H
  FA00                	DTBUF	EQU	0FA00H
  FE00                	KEYBF	EQU	0FE00H
  FF00                	KBUF	EQU	0FF00H
  FF51                	DTA	EQU	KBUF+81
  FFD4                	EXTSP	EQU	0FFD4H
  0019                	LINE	EQU	25
                      	
                      	;LDINIT.ASM
                      	
                      	;	LSX-Dodgers INIT
                      	
  C600  C307C6        		JP	START
  C603  901D          	MACHINE:DW	MAC
  C605  3701          	VERSION:DW	VER
                      	
  C607                	START:
  C607  F3            		DI
  C608  ED5E          		IM	2
  C60A  310000        		LD	SP,STACK
  C60D  CD1BC6        		CALL	INIT		;NZならAUTOEXECを実行
  C610  210000        		LD	HL,0
  C613  E5            		PUSH	HL
  C614  C8            		RET	Z
  C615  11A6C9        		LD	DE,AUTOD
  C618  C3FDEC        		JP	_COMANL
                      	
  C61B                	INIT:
  C61B  3E1E          		LD	A,01EH
  C61D  D300          		OUT	(0),A
                      	
  C61F  010000        		LD	BC,0
  C622  ED438CEC      		LD	(_CTC),BC
  C626  01040A        		LD	BC,00A04H
  C629  CD60C9        		CALL	CHKCTC
  C62C  010407        		LD	BC,00704H
  C62F  CD60C9        		CALL	CHKCTC
  C632  01A81F        		LD	BC,01FA8H
  C635  CD60C9        		CALL	CHKCTC
  C638  01A01F        		LD	BC,01FA0H
  C63B  CD60C9        		CALL	CHKCTC
                      	;
  C63E                	INISIO:
  C63E  01911F        		LD	BC,01F91H	;INIT SIO
  C641  1601          		LD	D,1
  C643  ED51          		OUT	(C),D
                      	
  C645  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  C647  0E93          		LD	C,093H
  C649  ED51          		OUT	(C),D
  C64B  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  C64D  0E99          		LD	C,099H		;INIT SIO
  C64F  1601          		LD	D,1
  C651  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  C653  0E9B          		LD	C,09BH
  C655  ED51          		OUT	(C),D
  C657  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
                      	
  C659  0E80          		LD	C,080H		;INIT DMA
  C65B  2106C3        		LD	HL,0C306H
  C65E                	INIDMA:
  C65E  ED61          		OUT	(C),H
  C660  2D            		DEC	L
  C661  20FB          		JR	NZ,INIDMA
                      	
  C663  3EE4          		LD	A,0E4H
  C665  CDB3DA        		CALL	COMOUT
  C668  AF            		XOR	A
  C669  CD8DDA        		CALL	OT49SB
                      	
  C66C  3EEC          		LD	A,INTVEC/256
  C66E  ED47          		LD	I,A
                      	
  C670  ED4B8CEC      		LD	BC,(_CTC)
  C674  0B            		DEC	BC
  C675  0B            		DEC	BC
                      	
  C676  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  C678  3EC0          		LD	A,CTC0
  C67A  ED79          		OUT	(C),A
                      	
  C67C  0C            		INC	C
  C67D  3E47          		LD	A,047H
  C67F  ED79          		OUT	(C),A
  C681  3E0D          		LD	A,13		;Baudrate 9600-13
  C683  ED79          		OUT	(C),A
                      	
  C685  79            		LD	A,C
  C686  D610          		SUB	010H
  C688  4F            		LD	C,A
                      	;	LD	(SIOAD+1),BC
                      	;	LD	(SIOAD0+1),BC
                      	;	LD	(SIOAD1+1),BC
                      	
  C689  2108CA        		LD	HL,SIODATA
  C68C                	SINIT1:
  C68C  7E            		LD	A,(HL)
  C68D  23            		INC	HL
  C68E  FEFF          		CP	0FFH
  C690  2804          		JR	Z,SINIT2
  C692  ED79          		OUT	(C),A
  C694  18F6          		JR	SINIT1
  C696                	SINIT2:
  C696  3EE4          		LD	A,0E4H
  C698  CDB3DA        		CALL	COMOUT
  C69B  3EC8          		LD	A,INTVEC
  C69D  CD8DDA        		CALL	OT49SB
                      	;
  C6A0  01C41F        		LD	BC,01FC4H
  C6A3  3E0C          		LD	A,00CH
  C6A5  ED79          		OUT	(C),A
                      	
  C6A7  0EC0          		LD	C,0C0H
  C6A9  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
                      	
  C6AB  0C            		INC	C
  C6AC  3E28          		LD	A,40
  C6AE  ED79          		OUT	(C),A
                      	
  C6B0  0C            		INC	C
  C6B1  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
                      	
  C6B3  0C            		INC	C
  C6B4  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
                      	
  C6B6  0EC5          		LD	C,0C5H
  C6B8  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
                      	
  C6BA                	TEXT:
  C6BA  0EB0          		LD	C,0B0H
  C6BC  3E80          		LD	A,080H
  C6BE  ED79          		OUT	(C),A
  C6C0  1607          		LD	D,7
  C6C2  0EB9          		LD	C,0B9H
  C6C4  2101CA        		LD	HL,TEXTDT
  C6C7                	TEXT1:
  C6C7  04            		INC	B
  C6C8  EDA3          		OUTI
  C6CA  0C            		INC	C
  C6CB  15            		DEC	D
  C6CC  20F9          		JR	NZ,TEXT1
  C6CE  01B01F        		LD	BC,01FB0H
  C6D1  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
                      	
  C6D3  0EC4          		LD	C,0C4H
  C6D5  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
                      	
  C6D7  01011A        		LD	BC,01A01H
  C6DA  ED78          		IN	A,(C)
  C6DC  E608          		AND	8
  C6DE  2809          		JR	Z,PRN
  C6E0  0E03          		LD	C,003H
  C6E2  3E0F          		LD	A,00FH
  C6E4  ED79          		OUT	(C),A
  C6E6  01040A        		LD	BC,00A04H
  C6E9                	PRN:
  C6E9  110100        		LD	DE,1
  C6EC  62            		LD	H,D
  C6ED  6A            		LD	L,D
  C6EE  017F00        		LD	BC,07FH
  C6F1  36FF          		LD	(HL),0FFH
  C6F3  EDB0          		LDIR
  C6F5  017F00        		LD	BC,07FH
  C6F8  3600          		LD	(HL),0
  C6FA  EDB0          		LDIR
                      	
  C6FC  3EC3          		LD	A,0C3H		;JP
  C6FE  2169D3        		LD	HL,WBOOT
  C701  320000        		LD	(00000H),A
  C704  220100        		LD	(00001H),HL	;IPL
                      	
  C707  2A03C6        		LD	HL,(MACHINE)	;3 bit7  DPB Original(1)
                      					;  bit6-4 DPB_LEVEL
  C70A  220300        		LD	(00003H),HL	;  bit3-0 Machine X1(0)
                      	;				;4 LSX-Dodgers(01DH)
  C70D  2106CC        		LD	HL,BDOS
  C710  320500        		LD	(00005H),A
  C713  220600        		LD	(00006H),HL	;BDOS
                      	
  C716  2179D6        		LD	HL,BIOS
  C719  321800        		LD	(00018H),A	;BIOS-ROM
  C71C  221900        		LD	(00019H),HL
                      	
  C71F  210000        		LD	HL,0
  C722  323800        		LD	(00038H),A	;RST038H
  C725  223900        		LD	(00039H),HL
                      	
  C728  3EEC          		LD	A,STABLE/256
  C72A  320B00        		LD	(0000BH),A
                      	
  C72D  3EE9          		LD	A,0E9H		;JP (HL)
  C72F  320F00        		LD	(0000FH),A
                      	
  C732  3A7DEC        		LD	A,(_FATBF+1)
  C735  321300        		LD	(00013H),A
                      	
  C738  3A7FEC        		LD	A,(_DTBUF+1)
  C73B  321700        		LD	(00017H),A
                      	
  C73E  3EFE          		LD	A,KEYBF/256
  C740  321B00        		LD	(0001BH),A
                      	
  C743  3EFF          		LD	A,KBUF/256
  C745  321F00        		LD	(0001FH),A
                      	
  C748  2A05C6        		LD	HL,(VERSION)
  C74B  225A00        		LD	(0005AH),HL
                      	
  C74E  3EE6          		LD	A,0E6H
  C750  CDB3DA        		CALL	COMOUT
  C753  CD98DA        		CALL	IN49SB
  C756  F5            		PUSH	AF
  C757  CD98DA        		CALL	IN49SB
  C75A  F1            		POP	AF
  C75B  F5            		PUSH	AF
  C75C  E612          		AND	012H
  C75E  2005          		JR	NZ,KEYR
  C760  3E01          		LD	A,1
  C762  32C7C8        		LD	(KEYREP+1),A
  C765                	KEYR:
  C765  F1            		POP	AF
  C766  E603          		AND	3
  C768  280E          		JR	Z,NON
                      	
  C76A  01D03F        		LD	BC,03FD0H
  C76D  ED49          		OUT	(C),C
  C76F  3E37          		LD	A,037H
  C771  D3D0          		OUT	(0D0H),A
  C773  ED78          		IN	A,(C)
  C775  B9            		CP	C
  C776  2878          		JR	Z,TURBO
  C778                	NON:
  C778  3D            		DEC	A		;A=0FFH
  C779  321800        		LD	(00018H),A	;BIOS-ROM
                      	
  C77C  2114CA        		LD	HL,AT_SCR1
  C77F  113DDB        		LD	DE,SCR1
  C782  01A100        		LD	BC,SCRNX-SCR1	;転送先のサイズ確認用
  C785  019F00        		LD	BC,AT_SCRE-AT_SCR1
  C788  EDB0          		LDIR
                      	
  C78A  21B3CA        		LD	HL,AT_WTTRK
  C78D  11B7EA        		LD	DE,WTTRK
  C790  01B900        		LD	BC,DMAE-WTTRK	;転送先のサイズ確認用
  C793  01B100        		LD	BC,AT_CPUE-AT_WTTRK
  C796  EDB0          		LDIR
                      	
  C798  2164CB        		LD	HL,AT_EDWT
  C79B  1116D3        		LD	DE,EDWT
  C79E  015000        		LD	BC,EMME-EDWT	;転送先のサイズ確認用
  C7A1  015000        		LD	BC,AT_EMME-AT_EDWT
  C7A4  EDB0          		LDIR
                      	
  C7A6  2118EB        		LD	HL,AT_DRD+AT_R
  C7A9  22ECEC        		LD	(_FDRD+1),HL
  C7AC  21BDEA        		LD	HL,AT_DWT+AT_R
  C7AF  22EFEC        		LD	(_FDWT+1),HL
  C7B2  2130D3        		LD	HL,AT_EDRD+AT_RE
  C7B5  2282ED        		LD	(EMMRD),HL
  C7B8  2116D3        		LD	HL,AT_EDWT+AT_RE
  C7BB  2284ED        		LD	(EMMWR),HL
                      	
  C7BE  3E27          		LD	A,027H			;ノンターボはMFM切り替えを行わない
  C7C0  3212ED        		LD	(DEVICE+012H),A		;Aドライブ
  C7C3  3232ED        		LD	(DEVICE+012H+32),A	;Bドライブ
  C7C6  3252ED        		LD	(DEVICE+012H+32*2),A	;Cドライブ
  C7C9  3272ED        		LD	(DEVICE+012H+32*3),A	;Dドライブ
                      	
  C7CC  210000        		LD	HL,0
  C7CF  22DEDA        		LD	(X1PAT),HL
                      	
  C7D2  3EAF          		LD	A,0AFH		;XOR	A
  C7D4  32EED8        		LD	(X1KPAT),A
                      	
  C7D7  21DEDB        		LD	HL,SCRNX
  C7DA  22D1EC        		LD	(_SCRN+1),HL
                      	
  C7DD  CD87C9        		CALL	SETCRTC
  C7E0  0610          		LD	B,010H		;PALET
  C7E2  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  C7E4  04            		INC	B
  C7E5  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  C7E7  04            		INC	B
  C7E8  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  C7EA  04            		INC	B
  C7EB  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  C7ED  C383C8        		JP	NOBANK
                      	
  C7F0                	TURBO:
  C7F0  F3            		DI			;Check BIOS
  C7F1  061D          		LD	B,01DH
  C7F3  ED79          		OUT	(C),A		;BIOS ON
  C7F5  3A512F        		LD	A,(02F51H)
  C7F8  04            		INC	B		;B=01EH
  C7F9  ED79          		OUT	(C),A		;BIOS OFF
  C7FB  FB            		EI
  C7FC  FEC9          		CP	0C9H
  C7FE  280B          		JR	Z,BIOSOK
  C800  3EAF          		LD	A,0AFH		;XOR	A
  C802  32EED8        		LD	(X1KPAT),A
  C805  21DEDB        		LD	HL,SCRNX
  C808  22D1EC        		LD	(_SCRN+1),HL
  C80B                	BIOSOK:
  C80B  3E1F          		LD	A,01FH
  C80D  DBF0          		IN	A,(0F0H)
  C80F  0F            		RRCA
  C810  380B          		JR	C,CRT1
  C812  21F1C9        		LD	HL,_C8025H
  C815  11B0EC        		LD	DE,CRTCD
  C818  011000        		LD	BC,16
  C81B  EDB0          		LDIR
  C81D                	CRT1:
  C81D  CD87C9        		CALL	SETCRTC
  C820  01AA10        		LD	BC,010AAH	;PALET
  C823  ED49          		OUT	(C),C
  C825  01CC11        		LD	BC,011CCH
  C828  ED49          		OUT	(C),C
  C82A  01F012        		LD	BC,012F0H
  C82D  ED49          		OUT	(C),C
  C82F  04            		INC	B
  C830  ED71          		DB	0EDH,071H
                      	
  C832  3E1F          		LD	A,01FH		;スタートポート
  C834  DBF0          		IN	A,(0F0H)
  C836  CB57          		BIT	2,A
  C838  2818          		JR	Z,BANK
                      	
  C83A  AF            		XOR	A
  C83B                	TZ1:				;前面スイッチが2HDの場合はMFMモードを2HDにしておく
  C83B  F5            		PUSH	AF
  C83C  CDDCEC        		CALL	_GETDPB
  C83F  DD7E12        		LD	A,(IX+012H)	;DPB_12_DEVICE
  C842  E68F          		AND	08FH
  C844  FE87          		CP	087H		;フロッピーでMEM切り替えがON
  C846  2004          		JR	NZ,TZ2
  C848  DDCB0A86      		RES	0,(IX+0AH)	;(DPB_0A_FDMODE)
  C84C                	TZ2:
  C84C  F1            		POP	AF
  C84D  3C            		INC	A
  C84E  FE08          		CP	8
  C850  38E9          		JR	C,TZ1
                      	
  C852                	BANK:
  C852  01000B        		LD	BC,00B00H
  C855  21007F        		LD	HL,07F00H
  C858  F3            		DI
  C859                	BANK1:
  C859  ED69          		OUT	(C),L
  C85B  5E            		LD	E,(HL)
  C85C  7B            		LD	A,E
  C85D  C6A5          		ADD	A,0A5H
  C85F  77            		LD	(HL),A
  C860  BE            		CP	(HL)
  C861  73            		LD	(HL),E
  C862  2005          		JR	NZ,BANK2
  C864  2C            		INC	L
  C865  CB65          		BIT	4,L
  C867  28F0          		JR	Z,BANK1
  C869                	BANK2:
  C869  3E10          		LD	A,010H
  C86B  ED79          		OUT	(C),A
  C86D  7D            		LD	A,L
  C86E  B7            		OR	A
  C86F  2812          		JR	Z,NOBANK
  C871  2600          		LD	H,0
  C873  29            		ADD	HL,HL	;*2
  C874  29            		ADD	HL,HL	;*4
  C875  29            		ADD	HL,HL	;*8
  C876  29            		ADD	HL,HL	;*16
  C877  29            		ADD	HL,HL	;*32
  C878  2B            		DEC	HL	;-1
  C879  2B            		DEC	HL	;-2
  C87A  2B            		DEC	HL	;-3
  C87B  22A8ED        		LD	(BANKCL),HL
  C87E  3E01          		LD	A,1
  C880  32A0ED        		LD	(BANKFL),A
  C883                	NOBANK:
  C883                	EMM:
  C883  CD50C9        		CALL	EADR0
  C886  ED78          		IN	A,(C)
  C888  F5            		PUSH	AF
                      	
  C889  110000        		LD	DE,0
  C88C                	ECHECK1:
  C88C  13            		INC	DE
  C88D  CD33C9        		CALL	EADR2
  C890  ED60          		IN	H,(C)
  C892  CD33C9        		CALL	EADR2
  C895  7C            		LD	A,H
  C896  C6E5          		ADD	A,0E5H
  C898  ED79          		OUT	(C),A
  C89A  3C            		INC	A
  C89B  CD50C9        		CALL	EADR0
  C89E  ED79          		OUT	(C),A
  C8A0  3D            		DEC	A
  C8A1  CD33C9        		CALL	EADR2
  C8A4  ED68          		IN	L,(C)
  C8A6  CD33C9        		CALL	EADR2
  C8A9  ED61          		OUT	(C),H
  C8AB  BD            		CP	L
  C8AC  2004          		JR	NZ,ECHECK2
  C8AE  CB5A          		BIT	3,D
  C8B0  28DA          		JR	Z,ECHECK1
  C8B2                	ECHECK2:
  C8B2  CD50C9        		CALL	EADR0
  C8B5  F1            		POP	AF
  C8B6  ED79          		OUT	(C),A
                      	
  C8B8  21F7FF        		LD	HL,0-9
  C8BB  19            		ADD	HL,DE
  C8BC  3008          		JR	NC,NOEMM
  C8BE  2288ED        		LD	(EMMCL),HL
  C8C1  3E03          		LD	A,3
  C8C3  3280ED        		LD	(EMMFL),A
  C8C6                	NOEMM:
  C8C6  3E00          	KEYREP:	LD	A,000H
  C8C8  B7            		OR	A
  C8C9  2807          		JR	Z,KEYR1
  C8CB  010000        		LD	BC,0
  C8CE  ED438CEC      		LD	(_CTC),BC
  C8D2                	KEYR1:
  C8D2  0130F8        		LD	BC,0-80*25
  C8D5  2ABAEC        		LD	HL,(CRTCD+10)
  C8D8  ED43BAEC      		LD	(CRTCD+10),BC
  C8DC  1E0C          		LD	E,00CH
  C8DE  CDCDEC        		CALL	_PRINT
  C8E1  22BAEC        		LD	(CRTCD+10),HL
                      	
  C8E4  21B2C9        		LD	HL,INIMES
  C8E7  CD61D8        		CALL	MSX
                      	
  C8EA  3A87FF        		LD	A,(0FF87H)
  C8ED  FE08          		CP	8
  C8EF  301E          		JR	NC,INIT0
  C8F1  5F            		LD	E,A
  C8F2  C641          		ADD	A,'A'
  C8F4  32AFC9        		LD	(AUTODV),A
  C8F7  0E0E          		LD	C,00EH
  C8F9  CD0500        		CALL	SYSTEM
  C8FC  1C            		INC	E
  C8FD  2185EC        		LD	HL,_SEEKSP	;Disk error Ignore
  C900  CBFE          		SET	7,(HL)
  C902  0E1B          		LD	C,01BH
  C904  CD0500        		CALL	SYSTEM
                      	
  C907  2185EC        		LD	HL,_SEEKSP
  C90A  CBBE          		RES	7,(HL)
                      	
  C90C  3C            		INC	A
  C90D  2008          		JR	NZ,INIT1
  C90F                	INIT0:
  C90F  1E00          		LD	E,0
  C911  0E0E          		LD	C,00EH
  C913  CD0500        		CALL	SYSTEM
  C916  AF            		XOR	A
  C917                	INIT1:
  C917  2100FF        		LD	HL,0FF00H
  C91A  1101FF        		LD	DE,0FF01H
  C91D  01CF00        		LD	BC,0CFH
  C920  75            		LD	(HL),L
  C921  EDB0          		LDIR
                      	
  C923  B7            		OR	A
  C924  C8            		RET	Z
                      	
  C925  3EE6          		LD	A,0E6H
  C927  CDB3DA        		CALL	COMOUT
  C92A  CD98DA        		CALL	IN49SB
  C92D  CD98DA        		CALL	IN49SB
  C930  FE1B          		CP	01BH
  C932  C9            		RET
                      	
  C933                	EADR2:
  C933  D5            		PUSH	DE
  C934  EB            		EX	DE,HL
  C935  29            		ADD	HL,HL
  C936  29            		ADD	HL,HL
  C937  ED4B8BED      		LD	BC,(EMMBL-1)
  C93B  0E00          		LD	C,0
  C93D  09            		ADD	HL,BC
  C93E  ED4B93ED      		LD	BC,(EMMDV)
  C942  060D          		LD	B,00DH
  C944  ED49          		OUT	(C),C
  C946  0C            		INC	C
  C947  ED69          		OUT	(C),L
  C949  0C            		INC	C
  C94A  ED61          		OUT	(C),H
  C94C  0C            		INC	C
  C94D  EB            		EX	DE,HL
  C94E  D1            		POP	DE
  C94F  C9            		RET
                      	
  C950                	EADR0:
  C950  ED4B93ED      		LD	BC,(EMMDV)
  C954  060D          		LD	B,00DH
  C956  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  C958  0C            		INC	C
  C959  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  C95B  0C            		INC	C
  C95C  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  C95E  0C            		INC	C
  C95F  C9            		RET
                      	
  C960                	CHKCTC:
  C960  C5            		PUSH	BC
  C961  110347        		LD	DE,04703H
  C964                	INICTC1:
  C964  0C            		INC	C
  C965  ED51          		OUT	(C),D
  C967  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  C969  1D            		DEC	E
  C96A  20F8          		JR	NZ,INICTC1
  C96C  C1            		POP	BC
                      	
  C96D  11FA07        		LD	DE,007FAH
  C970  ED51          		OUT	(C),D
  C972  ED59          		OUT	(C),E
  C974  ED78          		IN	A,(C)
  C976  BB            		CP	E
  C977  C0            		RET	NZ
  C978  ED51          		OUT	(C),D
  C97A  ED51          		OUT	(C),D
  C97C  ED78          		IN	A,(C)
  C97E  BA            		CP	D
  C97F  C0            		RET	NZ
  C980  03            		INC	BC
  C981  03            		INC	BC
  C982  ED438CEC      		LD	(_CTC),BC
  C986  C9            		RET
                      	
  C987                	SETCRTC:
  C987  21B0EC        		LD	HL,CRTCD
  C98A  AF            		XOR	A
  C98B                	SETCRT1:
  C98B  010018        		LD	BC,01800H
  C98E  ED79          		OUT	(C),A
  C990  0C            		INC	C
  C991  04            		INC	B
  C992  EDA3          		OUTI
  C994  3C            		INC	A
  C995  FE0C          		CP	12
  C997  20F2          		JR	NZ,SETCRT1
  C999  23            		INC	HL
  C99A  23            		INC	HL
  C99B  01031B        		LD	BC,01A03H+00100H
  C99E  EDA3          		OUTI
  C9A0  01D020        		LD	BC,01FD0H+00100H
  C9A3  EDA3          		OUTI
  C9A5  C9            		RET
                      	
  C9A6  4155544F455845	AUTOD:	DB	"AUTOEXEC "
  C9AF  413A00        	AUTODV:	DB	"A:",0
                      	
  C9B2  4C53582D446F64	INIMES:	DB	"LSX-Dodgers for X1/turbo version "
  C9D3  312E          		DB	030H + VER_1, '.'
  C9D5  3337          		DB	030H + VER_2 ,030H + VER_3
  C9D7  2047616B752028		DB	' Gaku (Lovers/Tablacus)',0DH,0AH
  C9F0  00            		DB	0
                      	
  C9F1                	_C8025H:
  C9F1  6B5059881B0119		DB	06BH,050H,059H,088H,01BH,001H,019H,01AH
  C9F9  000F          		DB	000H,00FH
  C9FB  30F8B0FF      		DW	0-80*LINE,0-80
  C9FF  0CA3          		DB	00CH,0A3H
                      	
  CA01  030C0F30333C3F	TEXTDT:	DB	003H,00CH,00FH,030H,033H,03CH,03FH
                      	
  CA08                	SIODATA:
  CA08  18            		DB	018H
  CA09  0100          		DB	1,0
  CA0B  0200          		DB	2,0
  CA0D  03C1          		DB	3,0C1H
  CA0F  0444          		DB	4,044H
  CA11  05E8          		DB	5,0E8H
  CA13  FF            		DB	0FFH
                      	
                      	;	ノンターボ用パッチ
                      	
  CA14                	AT_SCR1:
  CA14  D9            		EXX
  CA15  C5            		PUSH	BC
  CA16  015020        		LD	BC,02000H+80
  CA19  D9            		EXX
  CA1A  C5            		PUSH	BC
  CA1B  010020        		LD	BC,02000H
                      	
  CA1E  67            		LD	H,A
  CA1F  B7            		OR	A
  CA20                	AT_SCRUP1:
  CA20  2815          		JR	Z,AT_SCRCL
  CA22  C5            		PUSH	BC
  CA23  CBE0          		SET	4,B
  CA25  D9            		EXX
  CA26  C5            		PUSH	BC
  CA27  CBE0          		SET	4,B
  CA29  D9            		EXX
  CA2A  CD77DB        		CALL	AT_UPSUB+AT_RS
  CA2D  D9            		EXX
  CA2E  C1            		POP	BC
  CA2F  D9            		EXX
  CA30  C1            		POP	BC
  CA31  CD77DB        		CALL	AT_UPSUB+AT_RS
  CA34  25            		DEC	H
  CA35  18E9          		JR	AT_SCRUP1
                      	
  CA37                	AT_SCRCL:
  CA37  215020        		LD	HL,02000H+80
  CA3A  3A96EC        		LD	A,(_COLORF)
  CA3D                	AT_SCRCL1:
  CA3D  CBE0          		SET	4,B
  CA3F  ED61          		OUT	(C),H
  CA41  CBA0          		RES	4,B
  CA43  ED79          		OUT	(C),A
  CA45  03            		INC	BC
  CA46  2D            		DEC	L
  CA47  20F4          		JR	NZ,AT_SCRCL1
  CA49  C1            		POP	BC
  CA4A  D9            		EXX
  CA4B  C1            		POP	BC
  CA4C  D9            		EXX
  CA4D  C9            		RET
                      	
  CA4E                	AT_UPSUB:
  CA4E  2E28          		LD	L,40
  CA50                	AT_UPSUB1:
  CA50  D9            		EXX
  CA51  ED78          		IN	A,(C)
  CA53  03            		INC	BC
  CA54  D9            		EXX
  CA55  ED79          		OUT	(C),A
  CA57  03            		INC	BC
  CA58  D9            		EXX
  CA59  ED78          		IN	A,(C)
  CA5B  03            		INC	BC
  CA5C  D9            		EXX
  CA5D  ED79          		OUT	(C),A
  CA5F  03            		INC	BC
  CA60  2D            		DEC	L
  CA61  20ED          		JR	NZ,AT_UPSUB1
  CA63  C9            		RET
                      	
                      	;	FLOPPY DISK DRIVER(CPU)
                      	
  CA64                	DISKC:
  CA64  1B            		DEC	DE
  CA65  CB5F          		BIT	3,A
  CA67  C4B0EA        		CALL	NZ,RNF
  CA6A                	DISKD:
  CA6A  E5            		PUSH	HL
  CA6B  21B6EA        		LD	HL,RETRY
  CA6E  35            		DEC	(HL)
  CA6F  E1            		POP	HL
  CA70  203E          		JR	NZ,AT_ERR		;Retry
  CA72  B7            		OR	A
  CA73  283B          		JR	Z,AT_ERR		;Error
                      	
  CA75                	AT_DELP:
  CA75  CDB0EA        		CALL	RNF
  CA78  CD8CEA        		CALL	FDMOFF
  CA7B  3A85EC        		LD	A,(_SEEKSP)
  CA7E  87            		ADD	A,A
  CA7F  382E          		JR	C,AT_ERRZ
  CA81                	AT_DELP1:
  CA81  D5            		PUSH	DE
  CA82  21C0EB        		LD	HL,DEMES
  CA85  CD61D8        		CALL	MSX
  CA88  CD4CD7        		CALL	KEYBC
  CA8B                	AT_DELP2:
  CA8B  CDCAEC        		CALL	_INKEY
  CA8E  28FB          		JR	Z,AT_DELP2
                      	
  CA90  D1            		POP	DE
  CA91  CDB0DF        		CALL	CAP
  CA94  FE52          		CP	'R'		;Retry
  CA96  200A          		JR	NZ,AT_DELP3
  CA98  210000        	DHLPAT:	LD	HL,0
  CA9B  3E02          		LD	A,2
  CA9D  32B6EA        		LD	(RETRY),A
  CAA0  B7            		OR	A
  CAA1  C9            		RET
  CAA2                	AT_DELP3:
  CAA2  FE49          		CP	'I'		;Ignore
  CAA4  2807          		JR	Z,AT_IGNORE
  CAA6  FE41          		CP	'A'		;Abort
  CAA8  20D7          		JR	NZ,AT_DELP1
  CAAA  C366D3        		JP	BOOT
  CAAD                	AT_IGNORE:
  CAAD  3EFF          		LD	A,0FFH
  CAAF                	AT_ERRZ:
  CAAF  BF            		CP	A
  CAB0                	AT_ERR:
  CAB0  3EFF          		LD	A,0FFH
  CAB2  C9            		RET
                      	
  CAB3                	AT_SCRE:
                      	
  CAB3                	AT_WTTRK:
  CAB3  0601          		LD	B,1
  CAB5  3EF0          		LD	A,0F0H
  CAB7  1802          		JR	AT_WTTRK1
  CAB9                	AT_DWT:
  CAB9  3EA0          		LD	A,0A0H
  CABB                	AT_WTTRK1:
  CABB  3254EA        		LD	(FDCPAT+1),A
  CABE  78            		LD	A,B
  CABF  3203EB        		LD	(AT_WTB+1+AT_R),A
  CAC2                	DWTBL:
  CAC2  3E02          		LD	A,2		;Retry count
  CAC4  32B6EA        		LD	(RETRY),A
                      	
  CAC7                	DWT0:
  CAC7  D5            		PUSH	DE
  CAC8  E5            		PUSH	HL
  CAC9  22C2DB        		LD	(DHLPAT+1+AT_RS),HL
  CACC  CDEEE9        		CALL	SEEK		;Write disk
  CACF  E1            		POP	HL
  CAD0  3838          		JR	C,ERRDW
  CAD2  F3            		DI
  CAD3  3A54EA        		LD	A,(FDCPAT+1)
  CAD6  CD98EA        		CALL	SECSET
  CAD9  0EFB          		LD	C,0FBH
                      	
  CADB                	DWT1:
  CADB  56            		LD	D,(HL)
  CADC                	DWT2:
  CADC  78            		LD	A,B
  CADD  DBF8          		IN	A,(0F8H)
  CADF  0F            		RRCA
  CAE0  3008          		JR	NC,DWT4
  CAE2  0F            		RRCA
  CAE3  30F7          		JR	NC,DWT2
  CAE5                	DWT3:
  CAE5  ED51          		OUT	(C),D
  CAE7  23            		INC	HL
  CAE8  18F1          		JR	DWT1
                      	
  CAEA                	DWT4:
  CAEA  3D            		DEC	A
  CAEB  28F8          		JR	Z,DWT3
  CAED  3C            		INC	A
  CAEE  FB            		EI
  CAEF  D1            		POP	DE
  CAF0  13            		INC	DE
  CAF1  CD8CEA        		CALL	FDMOFF
  CAF4  2808          		JR	Z,DISKOK_WT
  CAF6  CD8DDB        		CALL	DISKC+AT_RS
  CAF9  20CC          		JR	NZ,DWT0
  CAFB  B7            		OR	A
  CAFC  2005          		JR	NZ,ERRW
                      	
  CAFE                	DISKOK_WT:
  CAFE  0601          	AT_WTB:	LD	B,1
  CB00  10C0          		DJNZ	DWTBL
  CB02  C9            		RET
                      	
  CB03                	ERRW:
  CB03  3EFF          		LD	A,0FFH
  CB05                	ERRZ:
  CB05  BF            		CP	A
  CB06  37            		SCF
  CB07  C38CEA        		JP	FDMOFF
                      	
  CB0A                	ERRDW:
  CB0A  D1            		POP	DE
  CB0B  CD9EDB        		CALL	AT_DELP+AT_RS
  CB0E  20B7          		JR	NZ,DWT0
  CB10  B7            		OR	A
  CB11  20F0          		JR	NZ,ERRW
  CB13  C9            		RET
                      	
  CB14                	AT_DRD:
  CB14  3E80          		LD	A,080H
  CB16  3254EA        		LD	(FDCPAT+1),A
  CB19                	DRDBL:
  CB19  78            		LD	A,B
  CB1A  325AEB        		LD	(AT_RDB+1+AT_R),A
  CB1D  3E02          		LD	A,2		;Retry count
  CB1F  32B6EA        		LD	(RETRY),A
  CB22                	DRD0:
  CB22  D5            		PUSH	DE
  CB23  E5            		PUSH	HL
  CB24  22C2DB        		LD	(DHLPAT+1+AT_RS),HL
  CB27  CDEEE9        		CALL	SEEK		;Read disk
  CB2A  E1            		POP	HL
  CB2B  382D          		JR	C,ERRDR
  CB2D  F3            		DI
  CB2E  3A54EA        		LD	A,(FDCPAT+1)
  CB31  CD98EA        		CALL	SECSET
  CB34  0EFB          		LD	C,0FBH
  CB36                	DRD1:
  CB36  78            		LD	A,B
  CB37  DBF8          		IN	A,(0F8H)
  CB39  0F            		RRCA
  CB3A  3008          		JR	NC,DRD3
  CB3C  0F            		RRCA
  CB3D  30F7          		JR	NC,DRD1
  CB3F  EDA2          		INI
  CB41  04            		INC	B
  CB42  18F2          		JR	DRD1
                      	
  CB44                	DRD3:
  CB44  B7            		OR	A
  CB45  FB            		EI
  CB46  D1            		POP	DE
  CB47  13            		INC	DE
  CB48  CD8CEA        		CALL	FDMOFF
  CB4B  2808          		JR	Z,DISKOK_RD
  CB4D  CD8DDB        		CALL	DISKC+AT_RS
  CB50  20D0          		JR	NZ,DRD0
  CB52  B7            		OR	A
  CB53  20AE          		JR	NZ,ERRW
                      	
  CB55                	DISKOK_RD:
  CB55  0601          	AT_RDB:	LD	B,1
  CB57  10C0          		DJNZ	DRDBL
  CB59  C9            		RET
                      	
  CB5A                	ERRDR:
  CB5A  D1            		POP	DE
  CB5B  CD9EDB        		CALL	AT_DELP+AT_RS
  CB5E  20C2          		JR	NZ,DRD0
  CB60  B7            		OR	A
  CB61  20A0          		JR	NZ,ERRW
  CB63  C9            		RET
                      	
  CB64                	AT_CPUE:
                      	
                      	
                      	;	EMM DRIVER(CPU)
                      	
                      	
  CB64                	AT_EDWT:
  CB64  CD4AD3        		CALL	AT_EADR+AT_RE
  CB67                	AT_EDWT0:
  CB67  F5            		PUSH	AF
  CB68  AF            		XOR	A
  CB69                	AT_EDWT1:
  CB69  04            		INC	B
  CB6A  EDA3          		OUTI
  CB6C  04            		INC	B
  CB6D  EDA3          		OUTI
  CB6F  04            		INC	B
  CB70  EDA3          		OUTI
  CB72  04            		INC	B
  CB73  EDA3          		OUTI
  CB75  3D            		DEC	A
  CB76  20F1          		JR	NZ,AT_EDWT1
  CB78  13            		INC	DE
  CB79  F1            		POP	AF
  CB7A  3D            		DEC	A
  CB7B  20EA          		JR	NZ,AT_EDWT0
  CB7D  C9            		RET
                      	
  CB7E                	AT_EDRD:
  CB7E  CD4AD3        		CALL	AT_EADR+AT_RE
  CB81                	AT_EDRD0:
  CB81  F5            		PUSH	AF
  CB82  AF            		XOR	A
  CB83                	AT_EDRD1:
  CB83  EDA2          		INI
  CB85  04            		INC	B
  CB86  EDA2          		INI
  CB88  04            		INC	B
  CB89  EDA2          		INI
  CB8B  04            		INC	B
  CB8C  EDA2          		INI
  CB8E  04            		INC	B
  CB8F  3D            		DEC	A
  CB90  20F1          		JR	NZ,AT_EDRD1
  CB92  13            		INC	DE
  CB93  F1            		POP	AF
  CB94  3D            		DEC	A
  CB95  20EA          		JR	NZ,AT_EDRD0
  CB97  C9            		RET
                      	
  CB98                	AT_EADR:
  CB98  C5            		PUSH	BC
  CB99  D5            		PUSH	DE
  CB9A  EB            		EX	DE,HL
  CB9B  29            		ADD	HL,HL
  CB9C  29            		ADD	HL,HL
  CB9D  ED4BA0EC      		LD	BC,(_MAXCYL-1)
  CBA1  0E00          		LD	C,0
  CBA3  09            		ADD	HL,BC
  CBA4  060D          		LD	B,00DH
  CBA6  ED49          		OUT	(C),C
  CBA8  0C            		INC	C
  CBA9  ED69          		OUT	(C),L
  CBAB  0C            		INC	C
  CBAC  ED61          		OUT	(C),H
  CBAE  0C            		INC	C
  CBAF  EB            		EX	DE,HL
  CBB0  D1            		POP	DE
  CBB1  F1            		POP	AF
  CBB2  B7            		OR	A	;CF=0
  CBB3  C9            		RET
                      	
  CBB4                	AT_EMME:
                      	
  CBB4                	INITE:
  CBB4                		DS	0CC06H-INITE
                      	
  CC06                	BDOS:
  CC06  C375D3        		JP	BDOS0
  CC09                		DS	20	;Reserved
                      	
                      	;LDCCP.ASM
                      	
                      	;	LSX-Dodgers CCP
                      	
  CC1D                	WBOOT1:
  CC1D  F3            		DI
  CC1E  310000        		LD	SP,STACK
                      	
  CC21  3EEC          		LD	A,INTVEC/256
  CC23  ED47          		LD	I,A
                      	
  CC25  3EE4          		LD	A,0E4H
  CC27  CDB3DA        		CALL	COMOUT
  CC2A  3EC8          		LD	A,INTVEC
  CC2C  CD8DDA        		CALL	OT49SB
                      	
  CC2F  3ABCEC        		LD	A,(CRTCD+12)
  CC32  B7            		OR	A
  CC33  200C          		JR	NZ,SETCRT0
  CC35  2130F8        		LD	HL,0-80*LINE
  CC38  22BAEC        		LD	(CRTCD+10),HL
  CC3B  21B0FF        		LD	HL,0-80
  CC3E  22BCEC        		LD	(CRTCD+12),HL
  CC41                	SETCRT0:
  CC41  21B0EC        		LD	HL,CRTCD
  CC44  AF            		XOR	A
  CC45                	SETCRT2:
  CC45  010018        		LD	BC,01800H
  CC48  ED79          		OUT	(C),A
  CC4A  0C            		INC	C
  CC4B  04            		INC	B
  CC4C  EDA3          		OUTI
  CC4E  3C            		INC	A
  CC4F  FE0C          		CP	12
  CC51  20F2          		JR	NZ,SETCRT2
  CC53  0D            		DEC	C
  CC54  ED79          		OUT	(C),A
  CC56  0C            		INC	C
                      	;	OUT	(C),0		;未定義命令ニーモニック
  CC57  ED71          		DB	0EDH,071H
  CC59  0D            		DEC	C
  CC5A  3C            		INC	A
  CC5B  ED79          		OUT	(C),A
  CC5D  0C            		INC	C
                      	;	OUT	(C),0		;未定義命令ニーモニック
  CC5E  ED71          		DB	0EDH,071H
  CC60  23            		INC	HL
  CC61  23            		INC	HL
  CC62  01031B        		LD	BC,01A03H+00100H
  CC65  EDA3          		OUTI
  CC67  01D020        		LD	BC,01FD0H+00100H
  CC6A  EDA3          		OUTI
  CC6C  1E04          		LD	E,4
  CC6E  CDCDEC        		CALL	_PRINT
  CC71                	COMMAND:
  CC71  CD29CD        		CALL	SETDTA1
  CC74  D5            		PUSH	DE
  CC75  3A87EC        		LD	A,(_DVSW)
  CC78  C641          		ADD	A,'A'
  CC7A  5F            		LD	E,A
  CC7B  CDCDEC        		CALL	_PRINT
  CC7E  1E3E          		LD	E,'>'
  CC80  CDCDEC        		CALL	_PRINT
  CC83  D1            		POP	DE		;DE=DTA1
  CC84  3E50          		LD	A,80
  CC86  12            		LD	(DE),A
  CC87  CDD2D7        		CALL	_SYS0A		;(BDOS)文字列入力
  CC8A  CDE4CE        		CALL	LTNL
                      	
  CC8D  118200        		LD	DE,DTA1+2
  CC90  CDFDEC        		CALL	_COMANL
  CC93  30DC          		JR	NC,COMMAND
  CC95  CD4CD7        		CALL	KEYBC
  CC98  1149D2        		LD	DE,COMERM
  CC9B  CDABD3        		CALL	_SYS09		;(BDOS)文字列出力
  CC9E  C7            		RST	0
                      	
  CC9F                	COMANL:
  CC9F  CD8EDC        		CALL	FILE
  CCA2  D5            		PUSH	DE
  CCA3  11DC00        		LD	DE,FNAME
  CCA6  1A            		LD	A,(DE)
  CCA7  FE20          		CP	020H
  CCA9  2848          		JR	Z,SDVSW
  CCAB  1B            		DEC	DE
  CCAC  1A            		LD	A,(DE)
  CCAD  C6FF          		ADD	A,0FFH
  CCAF  380A          		JR	C,COMB
  CCB1  13            		INC	DE
                      	
  CCB2  21F2D1        		LD	HL,COMTB
  CCB5  3E09          		LD	A,COMS
  CCB7  47            		LD	B,A
  CCB8  CD25DF        		CALL	CPNAME
  CCBB                	COMB:
  CCBB  D1            		POP	DE
  CCBC  D20F00        		JP	NC,JP_HL
  CCBF  EB            		EX	DE,HL
  CCC0  229FCD        		LD	(COMPAT+1),HL
  CCC3  22F6CD        		LD	(BATPAT+1),HL
  CCC6  F5            		PUSH	AF
  CCC7  CD47CD        		CALL	CEXE4
  CCCA  F1            		POP	AF
  CCCB  21DC00        		LD	HL,FNAME
  CCCE  116D00        		LD	DE,FCB2+1	;COMMAND NAME
  CCD1  010B00        		LD	BC,11
  CCD4  EDB0          		LDIR
  CCD6  11B1D1        		LD	DE,PATHD
  CCD9                	CEX1:
  CCD9  1A            		LD	A,(DE)
  CCDA  FE20          		CP	020H
  CCDC  D8            		RET	C
  CCDD  CD83DC        		CALL	FILEC
  CCE0  D5            		PUSH	DE
  CCE1  216D00        		LD	HL,FCB2+1	;COMMAND NAME
  CCE4  11DC00        		LD	DE,FNAME
  CCE7  010B00        		LD	BC,11
  CCEA  EDB0          		LDIR
  CCEC  CD47CD        		CALL	CEXE4
  CCEF  D1            		POP	DE
  CCF0  13            		INC	DE
  CCF1  18E6          		JR	CEX1
                      	
  CCF3                	SDVSW:
  CCF3  F1            		POP	AF
  CCF4  3ADB00        		LD	A,(FDRV)
  CCF7  3D            		DEC	A
  CCF8  5F            		LD	E,A
  CCF9  0E0E          		LD	C,00EH		;(BDOS)カレント・ドライブの設定
  CCFB  1833          		JR	SYSTEM0
                      	
  CCFD                	OPEN1:
  CCFD  21DB00        		LD	HL,FDRV
  CD00                	OPEN:
  CD00  0E11          		LD	C,011H		;(BDOS)最初のファイルの検索
  CD02                	OPEN3:
  CD02  D5            		PUSH	DE
  CD03  1151FF        		LD	DE,DTA
  CD06  CD26CD        		CALL	SETDTA
  CD09  EB            		EX	DE,HL
  CD0A  CD0500        		CALL	SYSTEM
  CD0D  D1            		POP	DE
  CD0E  B7            		OR	A
  CD0F  C9            		RET
                      	
  CD10                	OPEN2:
  CD10  0E12          		LD	C,012H
  CD12  18EE          		JR	OPEN3
                      	
  CD14                	DEFCB:				;Z=Ok NZ=Error
  CD14  1151FF        		LD	DE,DTA
  CD17  CD2ECD        		CALL	SYSC0F
                      	
  CD1A  210000        		LD	HL,0
  CD1D  2272FF        		LD	(DTA+33),HL
  CD20  2274FF        		LD	(DTA+35),HL
  CD23  110001        		LD	DE,00100H
  CD26                	SETDTA:
  CD26  C3D2D5        		JP	_SYS1A		;(BDOS)DTAの設定
                      	
  CD29                	SETDTA1:
  CD29  118000        		LD	DE,DTA1
  CD2C  18F8          		JR	SETDTA
                      	
  CD2E                	SYSC0F:
  CD2E  0E0F          		LD	C,00FH		;(BDOS)ファイルのオープン
  CD30                	SYSTEM0:
  CD30  CD0500        		CALL	SYSTEM
  CD33  B7            		OR	A
  CD34  C9            		RET
                      	
  CD35                	C_CD:
  CD35  CD83DC        		CALL	FILEC
  CD38  210000        		LD	HL,0
  CD3B  11DB00        		LD	DE,FDRV
  CD3E  1803          		JR	S27
                      	
  CD40                	S27DTA:
  CD40  1151FF        		LD	DE,DTA
  CD43                	S27:
  CD43  0E27          		LD	C,027H		;(BDOS)ランダム・ブロック・リード
  CD45  18E9          		JR	SYSTEM0
                      	
  CD47                	CEXE4:
  CD47  3ADB00        		LD	A,(FDRV)
  CD4A  325700        		LD	(00057H),A
  CD4D  2AE900        		LD	HL,(FDRV+14)
  CD50  225800        		LD	(00058H),HL
                      	
  CD53  21E400        		LD	HL,FNAME+8
  CD56  7E            		LD	A,(HL)
  CD57  FE20          		CP	020H
  CD59  2007          		JR	NZ,CEXE7
  CD5B  3E3F          		LD	A,'?'
  CD5D  77            		LD	(HL),A
  CD5E  23            		INC	HL
  CD5F  77            		LD	(HL),A
  CD60  23            		INC	HL
  CD61  77            		LD	(HL),A
  CD62                	CEXE7:
  CD62  CDFDCC        		CALL	OPEN1
  CD65                	CEXE5:
  CD65  C0            		RET	NZ
  CD66  2A5BFF        		LD	HL,(DTA+1+9)
  CD69  7C            		LD	A,H
  CD6A  CDB0DF        		CALL	CAP
  CD6D  67            		LD	H,A
  CD6E  7D            		LD	A,L
  CD6F  CDB0DF        		CALL	CAP
  CD72  6F            		LD	L,A
  CD73  3A5AFF        		LD	A,(DTA+1+8)
  CD76  CDB0DF        		CALL	CAP
  CD79  D642          		SUB	'B'
  CD7B  282E          		JR	Z,C_BAT
  CD7D  3D            		DEC	A		;'C'
  CD7E  2805          		JR	Z,C_EXE
  CD80                	CEXE6:
  CD80  CD10CD        		CALL	OPEN2
  CD83  18E0          		JR	CEXE5
                      	
  CD85                	C_EXE:
  CD85  7C            		LD	A,H
  CD86  FE4D          		CP	'M'
  CD88  20F6          		JR	NZ,CEXE6
                      	
  CD8A  CD14CD        		CALL	DEFCB
  CD8D  2A0600        		LD	HL,(SYSTEM+1)
  CD90  25            		DEC	H
  CD91  CD40CD        		CALL	S27DTA
  CD94  3D            		DEC	A
  CD95  37            		SCF
  CD96  C0            		RET	NZ
  CD97  7C            		LD	A,H
  CD98  B5            		OR	L
  CD99  37            		SCF
  CD9A  C8            		RET	Z
  CD9B  CD29CD        		CALL	SETDTA1
  CD9E  110000        	COMPAT:	LD	DE,0
  CDA1  CDF7CF        		CALL	SETFCB
  CDA4  AF            		XOR	A
  CDA5  67            		LD	H,A
  CDA6  6F            		LD	L,A	;HL=0x0000
  CDA7  F9            		LD	SP,HL	;STACK=0
  CDA8  E5            		PUSH	HL
  CDA9  24            		INC	H	;HL=0x0100
  CDAA  E9            		JP	(HL)
                      	
  CDAB                	C_BAT:
  CDAB  114154        		LD	DE,'A'+'T'*256
  CDAE  ED52          		SBC	HL,DE
  CDB0  20CE          		JR	NZ,CEXE6
                      	
  CDB2  F1            		POP	AF
  CDB3  F1            		POP	AF
  CDB4  CD14CD        		CALL	DEFCB
  CDB7  210002        		LD	HL,00200H
  CDBA  CD40CD        		CALL	S27DTA
  CDBD  C6FE          		ADD	A,0FEH
  CDBF  D8            		RET	C
  CDC0  7D            		LD	A,L
  CDC1  B7            		OR	A
  CDC2  37            		SCF
  CDC3  C8            		RET	Z
  CDC4  3C            		INC	A
  CDC5  F5            		PUSH	AF
                      	
  CDC6  CD4CD7        		CALL	KEYBC
  CDC9  3E1A          		LD	A,01AH
  CDCB  CD83D7        		CALL	MSG_A
  CDCE  C1            		POP	BC
  CDCF  210001        		LD	HL,00100H
  CDD2                	BAT1:
  CDD2  A7            		AND	A
  CDD3  05            		DEC	B
  CDD4  C8            		RET	Z
  CDD5  7E            		LD	A,(HL)
  CDD6  FE25          		CP	'%'
  CDD8  280C          		JR	Z,BAT2
  CDDA                	BAT1X:
  CDDA  7E            		LD	A,(HL)
  CDDB  23            		INC	HL
  CDDC  FE1A          		CP	01AH
  CDDE  C8            		RET	Z
  CDDF  FE0A          		CP	00AH
  CDE1  C432D7        		CALL	NZ,KEYBS
  CDE4  18EC          		JR	BAT1
                      	
  CDE6                	BAT2:
  CDE6  23            		INC	HL
  CDE7  7E            		LD	A,(HL)
  CDE8  2B            		DEC	HL
  CDE9  D631          		SUB	'1'
  CDEB  38ED          		JR	C,BAT1X
  CDED  FE09          		CP	9
  CDEF  30E9          		JR	NC,BAT1X
  CDF1  23            		INC	HL
  CDF2  23            		INC	HL
  CDF3  3C            		INC	A
  CDF4  4F            		LD	C,A
  CDF5  110000        	BATPAT:	LD	DE,0
  CDF8                	BAT3:
  CDF8  1A            		LD	A,(DE)
  CDF9  B7            		OR	A
  CDFA  28D6          		JR	Z,BAT1
  CDFC  CD66DD        		CALL	SPCUT
  CDFF  0D            		DEC	C
  CE00  2808          		JR	Z,BAT5
  CE02                	BAT4:
  CE02  1A            		LD	A,(DE)
  CE03  FE21          		CP	021H
  CE05  38F1          		JR	C,BAT3
  CE07  13            		INC	DE
  CE08  18F8          		JR	BAT4
  CE0A                	BAT5:
  CE0A  1A            		LD	A,(DE)
  CE0B  FE21          		CP	021H
  CE0D  38C3          		JR	C,BAT1
  CE0F  13            		INC	DE
  CE10  CD32D7        		CALL	KEYBS
  CE13  18F5          		JR	BAT5
                      	
  CE15                	SWITCH:
  CE15  1A            		LD	A,(DE)
  CE16                	SW1:
  CE16  13            		INC	DE
  CE17  B9            		CP	C
  CE18  1A            		LD	A,(DE)
  CE19  C8            		RET	Z
  CE1A  FE20          		CP	020H
  CE1C  30F8          		JR	NC,SW1
  CE1E                	C_REM:
  CE1E  AF            		XOR	A
  CE1F  C9            		RET
                      	
  CE20                	C_DEL:
  CE20  CDF7CF        		CALL	SETFCB
  CE23  CD99D7        		CALL	_SYS08		;(BDOS)エコーなしコンソール入力
                      	
  CE26  0E13          		LD	C,013H
  CE28  180A          		JR	CDEL1		;(BDOS)ファイルの削除
                      	
  CE2A                	C_REN:
  CE2A  CDF7CF        		CALL	SETFCB
  CE2D  3E10          		LD	A,010H		;ディレクトリも対象にする
  CE2F  326900        		LD	(FCB1+13),A	;属性
  CE32  0E17          		LD	C,017H		;(BDOS)ファイル名の変更
  CE34                	CDEL1:
  CE34  115C00        		LD	DE,FCB1
  CE37  CD0500        		CALL	SYSTEM
  CE3A  C6FF          		ADD	A,0FFH
  CE3C  C9            		RET
                      	
  CE3D                	C_DIR:
  CE3D  CD83DC        		CALL	FILEC
  CE40  21DC00        		LD	HL,FDRV+1
  CE43  CD97D1        		CALL	CWILD1
  CE46  3EF1          		LD	A,0F1H
  CE48  32E800        		LD	(FDRV+13),A
  CE4B  CDFDCC        		CALL	OPEN1
  CE4E                	CDIR1:
  CE4E  B7            		OR	A
  CE4F  2008          		JR	NZ,PDSKF
  CE51  CD9CCE        		CALL	P_NAME
  CE54  CD10CD        		CALL	OPEN2
  CE57  18F5          		JR	CDIR1
                      	
  CE59                	PDSKF:
  CE59  3ADB00        		LD	A,(FDRV)
  CE5C  5F            		LD	E,A
  CE5D  0E1B          		LD	C,01BH		;(BDOS)ディスク情報の獲得
  CE5F  CD0500        		CALL	SYSTEM
  CE62  4F            		LD	C,A		;C←1クラスタ辺りの論理セクタ数
  CE63  C601          		ADD	A,001H
  CE65  D8            		RET	C		;Aが0FFHだった場合
  CE66  AF            		XOR	A
  CE67                	PDS1:				;HL=未使用クラスタの総数
  CE67  CB19          		RR	C
  CE69  3804          		JR	C,PDS2
  CE6B  29            		ADD	HL,HL
  CE6C  8F            		ADC	A,A
  CE6D  18F8          		JR	PDS1
  CE6F                	PDS2:
  CE6F  CB50          		BIT	2,B		;B←論理セクタのサイズの上位8ビット
  CE71  200A          		JR	NZ,PDSKF1	;K単位(4)になるまで未使用を2で割る
  CE73  CB3F          		SRL	A
  CE75  CB1C          		RR	H
  CE77  CB1D          		RR	L
  CE79  CB10          		RL	B
  CE7B  18F2          		JR	PDS2
  CE7D                	PDSKF1:
  CE7D  CD20CF        		CALL	PRDEC_AHL
  CE80  1128D2        		LD	DE,KBFREE
  CE83  CDABD3        		CALL	_SYS09		;(BDOS)文字列出力
  CE86  CD12CF        		CALL	PUTDRV
  CE89  3E5C          		LD	A,05CH
  CE8B  CD83D7        		CALL	MSG_A
  CE8E  2AE900        		LD	HL,(FDRV+14)
  CE91  AF            		XOR	A
  CE92  11FEFF        		LD	DE,0-2
  CE95  19            		ADD	HL,DE
  CE96  23            		INC	HL
  CE97  DC1FCF        		CALL	C,PRDEC_HL
  CE9A  1848          		JR	LTNL
                      	
  CE9C                	P_NAME:
  CE9C  3A52FF        		LD	A,(DTA+1)
  CE9F  FE2E          		CP	'.'
  CEA1  C8            		RET	Z
  CEA2  3E20          		LD	A,020H
  CEA4  CD83D7        		CALL	MSG_A
  CEA7  CD83D7        		CALL	MSG_A
  CEAA  3E3A          		LD	A,':'
  CEAC  CD83D7        		CALL	MSG_A
  CEAF  3A5DFF        		LD	A,(DTA+1+00BH)
  CEB2  F5            		PUSH	AF
  CEB3  0F            		RRCA
  CEB4  9F            		SBC	A,A
  CEB5  E60A          		AND	'*'-020H
  CEB7  C620          		ADD	A,020H
  CEB9  CD83D7        		CALL	MSG_A
  CEBC  CD12CF        		CALL	PUTDRV
  CEBF  2152FF        		LD	HL,DTA+1
  CEC2  CD64CF        		CALL	FPRNT
                      	
  CEC5  F1            		POP	AF
  CEC6  CB67          		BIT	4,A
  CEC8  2808          		JR	Z,DIR3
  CECA  1136D2        		LD	DE,DIRMES
  CECD  CDABD3        		CALL	_SYS09		;(BDOS)文字列出力
  CED0  180A          		JR	DIR6
  CED2                	DIR3:
  CED2  ED5B70FF      		LD	DE,(DTA+1+01EH)
  CED6  2A6EFF        		LD	HL,(DTA+1+01CH)
  CED9  CD23CF        		CALL	PRDEC_DEHL
  CEDC                	DIR6:
  CEDC  3AB1EC        		LD	A,(CRTCD+1)
  CEDF  FE29          		CP	40+1
  CEE1  D486CF        		CALL	NC,PRTTMS
                      	
  CEE4                	LTNL:
  CEE4  1E0D          		LD	E,00DH
  CEE6  CDCDEC        		CALL	_PRINT
  CEE9  1E0A          		LD	E,00AH
  CEEB  C3CDEC        		JP	_PRINT
                      	
  CEEE                	C_PATH:
  CEEE  CD66DD        		CALL	SPCUT
  CEF1  21B1D1        		LD	HL,PATHD
  CEF4  FE21          		CP	021H
  CEF6  300E          		JR	NC,CPATH0
  CEF8  2B            		DEC	HL
  CEF9  2B            		DEC	HL
  CEFA                	CPATHP:
  CEFA  7E            		LD	A,(HL)
  CEFB  23            		INC	HL
  CEFC  FE20          		CP	020H
  CEFE  3F            		CCF
  CEFF  30E3          		JR	NC,LTNL
  CF01  CD83D7        		CALL	MSG_A
  CF04  18F4          		JR	CPATHP
  CF06                	CPATH0:
  CF06  FE3B          		CP	';'
  CF08  2001          		JR	NZ,CPATH1
  CF0A  13            		INC	DE
  CF0B                	CPATH1:
  CF0B  EB            		EX	DE,HL
  CF0C  014000        		LD	BC,PATHX
  CF0F  EDB0          		LDIR
  CF11  C9            		RET
                      	
  CF12                	PUTDRV:
  CF12  3ADB00        		LD	A,(FDRV)
  CF15  C640          		ADD	A,'A'-1
  CF17  CD83D7        		CALL	MSG_A
  CF1A  3E3A          		LD	A,':'
  CF1C                	MSG_AR:
  CF1C  C383D7        		JP	MSG_A
                      	
  CF1F                	PRDEC_HL:
  CF1F  AF            		XOR	A
  CF20                	PRDEC_AHL:
  CF20  5F            		LD	E,A
  CF21  1600          		LD	D,0
  CF23                	PRDEC_DEHL:
  CF23  AF            		XOR	A
  CF24  E5            		PUSH	HL
  CF25  21D500        		LD	HL,DECBF
  CF28  0605          		LD	B,5
  CF2A  CD2DDD        		CALL	FILL_MEMORY
  CF2D  E1            		POP	HL
                      	
  CF2E  0E20          		LD	C,32
  CF30                	DEC1:
  CF30  29            		ADD	HL,HL
  CF31  EB            		EX	DE,HL
  CF32  ED6A          		ADC	HL,HL
  CF34  EB            		EX	DE,HL
  CF35  E5            		PUSH	HL
  CF36  21D900        		LD	HL,DECBF+4
  CF39  0605          		LD	B,5
  CF3B                	DEC2:
  CF3B  7E            		LD	A,(HL)
  CF3C  8F            		ADC	A,A
  CF3D  27            		DAA
  CF3E  77            		LD	(HL),A
  CF3F  2B            		DEC	HL
  CF40  10F9          		DJNZ	DEC2
  CF42  E1            		POP	HL
  CF43  0D            		DEC	C
  CF44  20EA          		JR	NZ,DEC1
                      	
  CF46  21D500        		LD	HL,DECBF
  CF49  3E20          		LD	A,020H
  CF4B  0604          		LD	B,4
  CF4D                	DEC3:
  CF4D  CD5ACF        		CALL	DEC4
  CF50  CD5ACF        		CALL	DEC4
  CF53  23            		INC	HL
  CF54  10F7          		DJNZ	DEC3
  CF56                	DECX:
  CF56  CD5ACF        		CALL	DEC4
  CF59  AF            		XOR	A
  CF5A                	DEC4:
  CF5A  ED6F          		RLD
  CF5C  FE20          		CP	020H
  CF5E  2802          		JR	Z,DEC5
  CF60  F630          		OR	030H
  CF62                	DEC5:
  CF62  18B8          		JR	MSG_AR
                      	
  CF64                	FPRNT:
  CF64  0608          		LD	B,8
  CF66  CD77CF        		CALL	P_N1
  CF69  7E            		LD	A,(HL)
  CF6A  C680          		ADD	A,0A0H-020H
  CF6C  FEA0          		CP	0A0H
  CF6E  2802          		JR	Z,FPR1
  CF70  3E2E          		LD	A,'.'
  CF72                	FPR1:
  CF72  CD83D7        		CALL	MSG_A
  CF75  0603          		LD	B,3
                      	
  CF77                	P_N1:
  CF77  C5            		PUSH	BC
  CF78  E5            		PUSH	HL
  CF79  7E            		LD	A,(HL)
  CF7A  CDBCDF        		CALL	CAP3
  CF7D  CD83D7        		CALL	MSG_A
  CF80  E1            		POP	HL
  CF81  C1            		POP	BC
  CF82  23            		INC	HL
  CF83  10F2          		DJNZ	P_N1
  CF85  C9            		RET
                      	
  CF86                	PRTTMS:
  CF86  3E20          		LD	A,020H
  CF88  CD83D7        		CALL	MSG_A
                      	
  CF8B  2A6AFF        		LD	HL,(DTA+1+24)
  CF8E  7D            		LD	A,L
  CF8F  B7            		OR	A
  CF90  C8            		RET	Z
  CF91  CB3C          		SRL	H
  CF93  17            		RLA
  CF94  17            		RLA
  CF95  17            		RLA
  CF96  17            		RLA
  CF97  E60F          		AND	00FH
  CF99  57            		LD	D,A
  CF9A  7C            		LD	A,H
  CF9B  C650          		ADD	A,80
  CF9D  CDE2CF        		CALL	PRTA
  CFA0  3E2D          		LD	A,'-'
  CFA2  CD83D7        		CALL	MSG_A
  CFA5  7A            		LD	A,D
  CFA6  CDE2CF        		CALL	PRTA
  CFA9  3E2D          		LD	A,'-'
  CFAB  CD83D7        		CALL	MSG_A
  CFAE  7D            		LD	A,L
  CFAF  E61F          		AND	01FH
  CFB1  CDE2CF        		CALL	PRTA
                      	
  CFB4  2A68FF        		LD	HL,(DTA+1+22)
                      	
  CFB7  3E20          		LD	A,020H
  CFB9  CD83D7        		CALL	MSG_A
  CFBC  7C            		LD	A,H
  CFBD  65            		LD	H,L
  CFBE  1F            		RRA
  CFBF  CB1D          		RR	L
  CFC1  1F            		RRA
  CFC2  CB1D          		RR	L
  CFC4  1F            		RRA
  CFC5  CB1D          		RR	L
  CFC7  E61F          		AND	01FH
  CFC9  CDE2CF        		CALL	PRTA
  CFCC  3E3A          		LD	A,':'
  CFCE  CD83D7        		CALL	MSG_A
  CFD1  7D            		LD	A,L
  CFD2  0F            		RRCA
  CFD3  0F            		RRCA
  CFD4  E63F          		AND	03FH
  CFD6  CDE2CF        		CALL	PRTA
  CFD9  3E3A          		LD	A,':'
  CFDB  CD83D7        		CALL	MSG_A
  CFDE  7C            		LD	A,H
  CFDF  E61F          		AND	01FH
  CFE1  87            		ADD	A,A
                      	
                      	;	PRINT10
                      	
  CFE2                	PRTA:
  CFE2  E5            		PUSH	HL
  CFE3  0608          		LD	B,8
  CFE5  4F            		LD	C,A
  CFE6  AF            		XOR	A
  CFE7                	PRTA1:
  CFE7  CB01          		RLC	C
  CFE9  8F            		ADC	A,A
  CFEA  27            		DAA
  CFEB  10FA          		DJNZ	PRTA1
  CFED  21D500        		LD	HL,DECBF
  CFF0  77            		LD	(HL),A
  CFF1  AF            		XOR	A
  CFF2  CD56CF        		CALL	DECX
  CFF5  E1            		POP	HL
  CFF6  C9            		RET
                      	
  CFF7                	SETFCB:
  CFF7  CD66DD        		CALL	SPCUT
  CFFA  1A            		LD	A,(DE)
  CFFB  FE20          		CP	020H
  CFFD  3801          		JR	C,SETFCBA
  CFFF  1B            		DEC	DE
  D000                	SETFCBA:
  D000  D5            		PUSH	DE
  D001  215C00        		LD	HL,FCB1
  D004  115D00        		LD	DE,FCB1+1
  D007  012300        		LD	BC,00023H
  D00A  70            		LD	(HL),B		;B=0
  D00B  EDB0          		LDIR
  D00D  D1            		POP	DE
  D00E  D5            		PUSH	DE
  D00F  215C00        		LD	HL,FCB1
  D012  CD31D6        		CALL	_SYS29		;(BDOS)ファイル名の解析
  D015  216C00        		LD	HL,FCB2
  D018  CD31D6        		CALL	_SYS29		;(BDOS)ファイル名の解析
  D01B  E1            		POP	HL
  D01C  010050        		LD	BC,05000H
  D01F  118100        		LD	DE,00081H
  D022                	SETFCB1:
  D022  7E            		LD	A,(HL)
  D023  23            		INC	HL
  D024  FE20          		CP	020H
  D026  3805          		JR	C,SETFCB2
  D028  12            		LD	(DE),A
  D029  13            		INC	DE
  D02A  0C            		INC	C
  D02B  10F5          		DJNZ	SETFCB1
  D02D                	SETFCB2:
  D02D  79            		LD	A,C
  D02E  328000        		LD	(DTA1),A
  D031  04            		INC	B
  D032  AF            		XOR	A
  D033                	SETFCB3:
  D033  12            		LD	(DE),A
  D034  13            		INC	DE
  D035  10FC          		DJNZ	SETFCB3
  D037  C9            		RET
                      	
  D038                	C_COPY:
  D038  CDF7CF        		CALL	SETFCB
  D03B  118100        		LD	DE,DTA1+1
  D03E  0E2F          		LD	C,'/'
  D040  CD15CE        		CALL	SWITCH
  D043  CDB0DF        		CALL	CAP
  D046  32CED0        		LD	(SW+1),A
                      	
  D049  1170EB        		LD	DE,BEEPD
  D04C  CD86DC        		CALL	FILEC2
  D04F  216C00        		LD	HL,FCB2
  D052  CD38D6        		CALL	S29X1
                      	
  D055  3E10          		LD	A,010H
  D057  326900        		LD	(FCB1+13),A
  D05A  216D00        		LD	HL,FCB2+1
  D05D  CD97D1        		CALL	CWILD1
  D060                	COPY0:
  D060  CD94D1        		CALL	CWILD
  D063  215C00        		LD	HL,FCB1
  D066  CD00CD        		CALL	OPEN
  D069  37            		SCF
  D06A                	COPY1:
  D06A  C0            		RET	NZ
  D06B  CD14CD        		CALL	DEFCB
                      	
  D06E  3A5EFF        		LD	A,(DTA+13)
  D071  CB67          		BIT	4,A
  D073  2824          		JR	Z,COPY1A
                      	
  D075  215D00        		LD	HL,FCB1+1
  D078  CDE5E0        		CALL	CHKWILD
  D07B  3817          		JR	C,COPY9
                      	
  D07D  3E20          		LD	A,020H
  D07F  325D00        		LD	(FCB1+1),A
  D082  2A6BFF        		LD	HL,(DTA+26)
  D085  23            		INC	HL
  D086  226A00        		LD	(FCB1+14),HL
  D089  18D5          		JR	COPY0
                      	
  D08B                	COPYS:
  D08B  1144D2        		LD	DE,SKIP
  D08E                	COPY8:
  D08E  CDABD3        		CALL	_SYS09		;(BDOS)文字列出力
  D091  CDE4CE        		CALL	LTNL
  D094                	COPY9:
  D094  CD10CD        		CALL	OPEN2
  D097  18D1          		JR	COPY1
                      	
  D099                	COPY1A:
  D099  216C00        		LD	HL,FCB2
  D09C  11DB00        		LD	DE,FDRV
  D09F  0153FF        		LD	BC,DTA+2
  D0A2  EDA0          		LDI
  D0A4  3E0B          		LD	A,11
  D0A6                	COPY2:
  D0A6  F5            		PUSH	AF
  D0A7  7E            		LD	A,(HL)
  D0A8  FE3F          		CP	'?'
  D0AA  2001          		JR	NZ,COPY3
  D0AC  0A            		LD	A,(BC)
  D0AD                	COPY3:
  D0AD  12            		LD	(DE),A
  D0AE  03            		INC	BC
  D0AF  13            		INC	DE
  D0B0  23            		INC	HL
  D0B1  F1            		POP	AF
  D0B2  3D            		DEC	A
  D0B3  20F1          		JR	NZ,COPY2
  D0B5  010500        		LD	BC,16-11
  D0B8  EDB0          		LDIR
  D0BA                	PUTNAME:
  D0BA  215D00        		LD	HL,FCB1+1
  D0BD  CDE5E0        		CALL	CHKWILD
  D0C0  300B          		JR	NC,PUTN1
  D0C2  21DC00        		LD	HL,FDRV+1
  D0C5  CD64CF        		CALL	FPRNT
  D0C8  3E20          		LD	A,020H
  D0CA  CD83D7        		CALL	MSG_A
  D0CD                	PUTN1:
  D0CD  3E00          	SW:	LD	A,000H
  D0CF  FE54          		CP	'T'
  D0D1  2005          		JR	NZ,CSW1
  D0D3  21EDD0        		LD	HL,SWNE
  D0D6  1807          		JR	SWT1
  D0D8                	CSW1:
  D0D8  FE4E          		CP	'N'
  D0DA  2011          		JR	NZ,SWNE
  D0DC  218BD0        		LD	HL,COPYS
  D0DF                	SWT1:
  D0DF  11DB00        		LD	DE,FDRV
  D0E2  CD2ECD        		CALL	SYSC0F
  D0E5  2801          		JR	Z,SWN1
  D0E7  E9            		JP	(HL)
  D0E8                	SWN1:
  D0E8  CD46D1        		CALL	CTIME
  D0EB  309E          		JR	NC,COPYS
  D0ED                	SWNE:
  D0ED  11DB00        		LD	DE,FDRV
  D0F0  0E16          		LD	C,016H		;(BDOS)ファイルの作成
  D0F2  CD30CD        		CALL	SYSTEM0
  D0F5  204D          		JR	NZ,COPYE2
  D0F7  67            		LD	H,A		;A=0
  D0F8  6F            		LD	L,A
  D0F9  22FC00        		LD	(FDRV+33),HL
  D0FC  32FE00        		LD	(FDRV+35),A
  D0FF                	COPY6:
  D0FF  CDA6D1        		CALL	BUFSIZ
  D102  CD40CD        		CALL	S27DTA
  D105  47            		LD	B,A
  D106  3C            		INC	A
  D107  2833          		JR	Z,COPYE
  D109  7C            		LD	A,H
  D10A  B5            		OR	L
  D10B  280E          		JR	Z,COPY7
  D10D  11DB00        		LD	DE,FDRV
  D110  0E26          		LD	C,026H		;(BDOS)ランダム・ブロック・ライト
  D112  CD0500        		CALL	SYSTEM
  D115  B7            		OR	A
  D116  2024          		JR	NZ,COPYE
  D118  05            		DEC	B
  D119  20E4          		JR	NZ,COPY6
  D11B                	COPY7:
  D11B  3A5EFF        		LD	A,(DTA+13)
  D11E  32E800        		LD	(FDRV+13),A
  D121  2165FF        		LD	HL,DTA+20
  D124  11EF00        		LD	DE,FDRV+20
  D127  010400        		LD	BC,4
  D12A  EDB0          		LDIR
                      	
  D12C  11DB00        		LD	DE,FDRV
  D12F  0E10          		LD	C,010H		;(BDOS)ファイルのクローズ
  D131  CD30CD        		CALL	SYSTEM0
  D134  2006          		JR	NZ,COPYE
                      	
  D136  1141D2        		LD	DE,OK
  D139  C38ED0        		JP	COPY8
                      	
  D13C                	COPYE:
  D13C  11DB00        		LD	DE,FDRV
  D13F  0E13          		LD	C,013H		;(BDOS)ファイルの削除
  D141  CD0500        		CALL	SYSTEM
  D144                	COPYE2:
  D144  37            		SCF
  D145  C9            		RET
                      	
  D146                	CTIME:
  D146  ED5B65FF      		LD	DE,(DTA+20)
  D14A  2AEF00        		LD	HL,(FDRV+20)
  D14D  A7            		AND	A
  D14E  ED52          		SBC	HL,DE
  D150  C0            		RET	NZ
  D151  ED5B67FF      		LD	DE,(DTA+22)
  D155  2AF100        		LD	HL,(FDRV+22)
  D158  ED52          		SBC	HL,DE
  D15A  C9            		RET
                      	
  D15B                	C_TYPE:
  D15B  CDF7CF        		CALL	SETFCB
  D15E  215C00        		LD	HL,FCB1
  D161  CD00CD        		CALL	OPEN
  D164  37            		SCF
  D165                	TYPE1:
  D165  C0            		RET	NZ
  D166  CD14CD        		CALL	DEFCB
  D169  3E1A          		LD	A,01AH
  D16B  CD83D7        		CALL	MSG_A
  D16E                	TYPE2:
  D16E  CDA6D1        		CALL	BUFSIZ
  D171  CD40CD        		CALL	S27DTA
  D174  C6FE          		ADD	A,0FEH
  D176  D8            		RET	C
  D177  7C            		LD	A,H
  D178  B5            		OR	L
  D179  2814          		JR	Z,TYPEE
  D17B  010001        		LD	BC,00100H
  D17E                	TYPE3:
  D17E  0A            		LD	A,(BC)
  D17F  03            		INC	BC
  D180  FE1A          		CP	01AH
  D182  280B          		JR	Z,TYPEE
  D184  5F            		LD	E,A
  D185  CD8CD7        		CALL	_SYS02		;(BDOS)コンソール出力
  D188  2B            		DEC	HL
  D189  7C            		LD	A,H
  D18A  B5            		OR	L
  D18B  20F1          		JR	NZ,TYPE3
  D18D  18DF          		JR	TYPE2
  D18F                	TYPEE:
  D18F  CD10CD        		CALL	OPEN2
  D192  18D1          		JR	TYPE1
                      	
  D194                	CWILD:
  D194  215D00        		LD	HL,FCB1+1
  D197                	CWILD1:
  D197  7E            		LD	A,(HL)
  D198  FE20          		CP	020H
  D19A  C0            		RET	NZ
  D19B                	CWILD2:
  D19B  54            		LD	D,H
  D19C  5D            		LD	E,L
  D19D  13            		INC	DE
  D19E  010A00        		LD	BC,10
  D1A1  363F          		LD	(HL),'?'
  D1A3  EDB0          		LDIR
  D1A5  C9            		RET
                      	
  D1A6                	BUFSIZ:
  D1A6  3A0700        		LD	A,(SYSTEM+2)
  D1A9  D603          		SUB	3
  D1AB  E6F8          		AND	0F8H
  D1AD  67            		LD	H,A
  D1AE  2E00          		LD	L,0
  D1B0  C9            		RET
                      	
  0040                	PATHX	EQU	64
  D1B1                	PATHD:	DS	PATHX
  D1F1  00            	PATHE:	DB	0
                      	
  0009                	COMS	EQU	9
  D1F2                	COMTB:
  D1F2  44202020      		DB	"D   "	;1
  D1F6  3DCE          		DW	C_DIR
  D1F8  44495220      		DB	"DIR "	;2
  D1FC  3DCE          		DW	C_DIR
  D1FE  434F5059      		DB	"COPY"	;3
  D202  38D0          		DW	C_COPY
  D204  43442020      		DB	"CD  "	;4
  D208  35CD          		DW	C_CD
  D20A  44454C20      		DB	"DEL "	;5
  D20E  20CE          		DW	C_DEL
  D210  50415448      		DB	"PATH"	;6
  D214  EECE          		DW	C_PATH
  D216  52454E20      		DB	"REN "	;7
  D21A  2ACE          		DW	C_REN
  D21C  54595045      		DB	"TYPE"	;8
  D220  5BD1          		DW	C_TYPE
  D222  52454D20      		DB	"REM "	;9
  D226  1ECE          		DW	C_REM
                      	
  D228  6B206279746573	KBFREE:	DB	"k bytes free",9,'$'
  D236  20202020203C44	DIRMES:	DB	"     <DIR>$"
  D241  4F4B24        	OK:	DB	"OK$"
  D244  536B697024    	SKIP:	DB	"Skip$"
  D249  4572726F722124	COMERM:	DB	"Error!$"
                      	
                      	;LDDISK2.ASM
                      	
                      	;	LSX-Dodgers DISK2
                      	
                      	
                      	;	GRAPHIC RAM DISK DRIVER
                      	
                      	
  D250                	GDRD:
  D250  C5            		PUSH	BC
  D251  CD79D2        		CALL	GADR
  D254  F1            		POP	AF
  D255                	GDRD1:
  D255  EDA2          		INI
  D257  04            		INC	B
  D258  0C            		INC	C
  D259  20FA          		JR	NZ,GDRD1
  D25B  04            		INC	B
  D25C  13            		INC	DE
  D25D  3D            		DEC	A
  D25E  20F5          		JR	NZ,GDRD1
  D260                	GBANK0:
  D260  3ABFEC        		LD	A,(WK1FD0)
  D263  E6EF          		AND	0EFH		;BANK0
  D265  181D          		JR	S1FD0
                      	
  D267                	GDWT:
  D267  C5            		PUSH	BC
  D268  CD79D2        		CALL	GADR
  D26B  F1            		POP	AF
  D26C                	GDWT1:
  D26C  04            		INC	B
  D26D  EDA3          		OUTI
  D26F  0C            		INC	C
  D270  20FA          		JR	NZ,GDWT1
  D272  04            		INC	B
  D273  13            		INC	DE
  D274  3D            		DEC	A
  D275  20F5          		JR	NZ,GDWT1
  D277  18E7          		JR	GBANK0
                      	
  D279                	GADR:
  D279  0E00          		LD	C,0
  D27B  7B            		LD	A,E
  D27C  C640          		ADD	A,040H
  D27E  47            		LD	B,A
  D27F  3ABFEC        		LD	A,(WK1FD0)
  D282  F610          		OR	010H		;BANK1
  D284                	S1FD0:
  D284  C5            		PUSH	BC
  D285  32BFEC        		LD	(WK1FD0),A
  D288  01D01F        		LD	BC,01FD0H
  D28B  ED79          		OUT	(C),A
  D28D  C1            		POP	BC
  D28E  C9            		RET
                      	
                      	
                      	;	BANK RAM DISK DRIVER
                      	
  D28F                	BDRD:
  D28F  ED73ADD2      		LD	(BANKSP+1),SP
  D293  3AAED2        		LD	A,(BANKSP+2)
  D296  87            		ADD	A,A
  D297  3803          		JR	C,BDRD1
  D299  31D4FF        		LD	SP,EXTSP
  D29C                	BDRD1:
  D29C  D5            		PUSH	DE
  D29D  D9            		EXX		;裏レジスタ
  D29E  C5            		 PUSH	 BC
  D29F  D5            		 PUSH	 DE
  D2A0  CDD3D2        		 CALL	 BADR
  D2A3  CDEFD2        		CALL	BTFR
  D2A6  D9            		EXX		;裏レジスタ
  D2A7                	BDWTE:
  D2A7  D1            		 POP	 DE
  D2A8  C1            		 POP	 BC
  D2A9  D9            		 EXX		;表レジスタ
  D2AA  D1            		POP	DE
  D2AB  AF            		XOR	A
  D2AC  310000        	BANKSP:	LD	SP,0
  D2AF  FB            		EI
  D2B0  C9            		RET
                      	
  D2B1                	BDWT:
  D2B1  ED73ADD2      		LD	(BANKSP+1),SP
  D2B5  3AAED2        		LD	A,(BANKSP+2)
  D2B8  87            		ADD	A,A
  D2B9  3803          		JR	C,BDWT1
  D2BB  31D4FF        		LD	SP,EXTSP
  D2BE                	BDWT1:
  D2BE  D5            		PUSH	DE
  D2BF  D9            		EXX		;裏レジスタ
  D2C0  C5            		 PUSH	 BC
  D2C1  D5            		 PUSH	 DE
  D2C2  CDD3D2        		 CALL	 BADR
  D2C5  D9            		EXX		;裏レジスタ
  D2C6  53            		 LD	D,E
  D2C7  5F            		 LD	E,A
  D2C8  D9            		 EXX		;表レジスタ
  D2C9  EB            		EX	DE,HL
  D2CA  CDEFD2        		CALL	BTFR
  D2CD  EB            		EX	DE,HL
  D2CE  D9            		EXX		;裏レジスタ
  D2CF  ED51          		 OUT	 (C),D	 ;MAIN
  D2D1  18D4          		 JR	 BDWTE
                      	
  D2D3                	BADR:
  D2D3  D9            		 EXX		;表レジスタ
  D2D4  7B            		LD	A,E
  D2D5  87            		ADD	A,A
  D2D6  CB12          		RL	D
  D2D8  87            		ADD	A,A
  D2D9  CB12          		RL	D
  D2DB  F5            		PUSH	AF
  D2DC  87            		ADD	A,A
  D2DD  7A            		LD	A,D
  D2DE  8F            		ADC	A,A
  D2DF  E60F          		AND	00FH
  D2E1  D9            		EXX		;裏レジスタ
  D2E2  01000B        		 LD	 BC,00B00H
  D2E5  57            		 LD	 D,A	  ;BANK
  D2E6  1E10          		 LD	 E,010H	  ;MAIN
  D2E8  D9            		 EXX		;表レジスタ
  D2E9  D1            		POP	DE
  D2EA  1E00          		LD	E,0
  D2EC  CBBA          		RES	7,D
  D2EE  C9            		RET
                      	
  D2EF                	BTFR:
  D2EF  F3            		DI
  D2F0                	BTFR0:
  D2F0  C5            		PUSH	BC
  D2F1  D5            		PUSH	DE
  D2F2  0600          		LD	B,0	;256回ループ(256*4)
  D2F4                	BTFR1:
  D2F4  D9            		EXX		;裏レジスタ
  D2F5  ED51          		 OUT	 (C),D	 ;BANK(MAIN)
  D2F7  D9            		 EXX		;表レジスタ
  D2F8  E3            		EX	(SP),HL
  D2F9  7E            		LD	A,(HL)
  D2FA  23            		INC	HL
  D2FB  4E            		LD	C,(HL)
  D2FC  23            		INC	HL
  D2FD  56            		LD	D,(HL)
  D2FE  23            		INC	HL
  D2FF  5E            		LD	E,(HL)
  D300  23            		INC	HL
  D301  E3            		EX	(SP),HL
  D302  D9            		EXX		;裏レジスタ
  D303  ED59          		 OUT	 (C),E	 ;MAIN(BANK)
  D305  D9            		 EXX		;表レジスタ
  D306  77            		LD	(HL),A
  D307  23            		INC	HL
  D308  71            		LD	(HL),C
  D309  23            		INC	HL
  D30A  72            		LD	(HL),D
  D30B  23            		INC	HL
  D30C  73            		LD	(HL),E
  D30D  23            		INC	HL
  D30E  10E4          		DJNZ	BTFR1
  D310  D1            		POP	DE
  D311  13            		INC	DE
  D312  C1            		POP	BC
  D313  10DB          		DJNZ	BTFR0
  D315  C9            		RET
                      	
                      	;	EMM DRIVER(DMA)
                      	
                      	
  D316                	EDWT:
  D316  0E0F          		LD	C,15
  D318  1802          		JR	EDWT1
  D31A                	EDRD:
  D31A  0E0E          		LD	C,14
  D31C                	EDWT1:
  D31C  C5            		PUSH	BC
  D31D  D5            		PUSH	DE
  D31E  2262D3        		LD	(DMAB),HL
  D321  78            		LD	A,B
  D322  87            		ADD	A,A
  D323  87            		ADD	A,A
  D324  F5            		PUSH	AF
  D325  3D            		DEC	A
  D326  325BD3        		LD	(DMALEN+1),A
  D329  79            		LD	A,C
  D32A  EB            		EX	DE,HL
  D32B  29            		ADD	HL,HL
  D32C  29            		ADD	HL,HL
  D32D  ED4BA0EC      		LD	BC,(_MAXCYL-1)
  D331  0E00          		LD	C,0
  D333  09            		ADD	HL,BC
  D334  ED4B84EC      		LD	BC,(_DRIVE)
  D338  060D          		LD	B,00DH
  D33A  ED49          		OUT	(C),C
  D33C  0C            		INC	C
  D33D  ED69          		OUT	(C),L
  D33F  0C            		INC	C
  D340  ED61          		OUT	(C),H
                      	
  D342  2156D3        		LD	HL,EDMAD
  D345  CD69DB        		CALL	SETDMA
  D348  CD91DB        		CALL	GO_DMA
  D34B  EB            		EX	DE,HL
  D34C  F1            		POP	AF
  D34D  84            		ADD	A,H
  D34E  6F            		LD	L,A
  D34F  D1            		POP	DE
  D350  C1            		POP	BC
  D351                	DMA_ADD_SEC:
  D351  13            		INC	DE
  D352  10FD          		DJNZ	DMA_ADD_SEC
  D354  AF            		XOR	A
  D355  C9            		RET
                      	
  D356                	EDMAD:
  D356  C3            		DB	0C3H	;WR6 リセット
  D357  7D            		DB	07DH	;WR0 ポートA→ポートB 転送
  D358  030D          		DW	00D03H	;ポートA開始アドレス EMMリード/ライト
  D35A  FF03          	DMALEN:	DW	003FFH	;ブロック長(転送サイズ-1)
  D35C  2C            		DB	02CH	;WR1 ポートAアドレス固定 I/O
  D35D  50            		DB	050H	;WR2 ポートBアドレスインクリメント メモリ
  D35E  02            		DB	002H	;ポートBタイミング
  D35F  80            		DB	080H	;WR3
  D360  9A            		DB	09AH	;WR5 WAIT RDY:HIGH
  D361  AD            		DB	0ADH	;WR4 連続 ポートB開始アドレス
  D362  0000          	DMAB:	DW	0
  D364  01            		DB	001H	;WR0 ポートB←ポートB 転送
  D365                		DS	1	;ノンターボ版との差分
  D366                	EMME:
                      	
  07B2                	AT_RE	EQU	EDWT-AT_EDWT
                      	
                      	
                      	;LDOS.ASM
                      	
                      	;	LSX-Dodgers OS
                      	
  D366                	BOOT:
  D366  C30000        		JP	0
  D369                	_SYS00:		;(BDOS)プログラム終了
  D369                	WBOOT:
  D369  C31DCC        		JP	WBOOT1
  D36C                	CONST_:
  D36C  C306D8        		JP	CONSTX
  D36F                	_SYS07:		;(BDOS)コンソール直接入力
  D36F                	CONIN:
  D36F  C3ADD7        		JP	FLGET
  D372                	CONOUT:
  D372  C35ADA        		JP	CONOUT1
                      	
  D375                	BDOS0:
  D375  E5            		PUSH	HL
  D376  210001        		LD	HL,00100H
  D379  39            		ADD	HL,SP
  D37A  3810          		JR	C,BDOS1X	;EXTSP = 0FFD4H
  D37C                	BDOS2:
  D37C  E1            		POP	HL
  D37D  ED7388D3      		LD	(BDSP+1),SP
  D381  31D4FF        		LD	SP,EXTSP
  D384  CD8BD3        		CALL	BDOS1
  D387  310000        	BDSP:	LD	SP,0
  D38A  C9            		RET
  D38B                	BDOS1:
  D38B  E5            		PUSH	HL
  D38C                	BDOS1X:
  D38C  79            		LD	A,C
  D38D  FE31          		CP	031H
  D38F  300A          		JR	NC,OVERFN
  D391  87            		ADD	A,A
  D392  6F            		LD	L,A
  D393  26EC          		LD	H,STABLE/256
  D395  7E            		LD	A,(HL)
  D396  2C            		INC	L
  D397  66            		LD	H,(HL)
  D398  6F            		LD	L,A
  D399  E3            		EX	(SP),HL
  D39A  C9            		RET
  D39B                	OVERFN
  D39B  E1            		POP	HL
  D39C  FE6F          		CP	06FH		;DOSVER MSX-DOS のバージョン番号の獲得
  D39E  2006          		JR	NZ,_ERROR
  D3A0  011D01        		LD	BC,011DH
  D3A3  113701        		LD	DE,VER
  D3A6                	_ERROR:
  D3A6                	_SYS04:		;(BDOS)外部出力
  D3A6                	_SYS05:		;(BDOS)プリンタ出力
  D3A6                	_SYS1C:		;(BDOS)ディスクの書き込み禁止化
  D3A6                	_SYS1E:		;(BDOS)ファイル属性の設定
  D3A6                	_SYS20:		;(BDOS)利用者番号の設定と読み出し
  D3A6                	_SYS2E:		;(BDOS)ベリファイ・フラグの設定
  D3A6  AF            		XOR	A
  D3A7  C9            		RET
  D3A8                	_SYS03:		;(BDOS)外部入力
  D3A8                	_SYS2B:		;(BDOS)日付の設定
  D3A8                	_SYS2D:		;(BDOS)時刻の設定
  D3A8  37            		SCF			;CF=1
  D3A9  9F            		SBC	A,A		;A=0FFH
  D3AA  C9            		RET
                      	
  D3AB                	_SYS09:		;文字列出力
  D3AB  D5            		PUSH	DE
  D3AC                	_SX09:
  D3AC  1A            		LD	A,(DE)
  D3AD  13            		INC	DE
  D3AE  FE24          		CP	'$'
  D3B0  282C          		JR	Z,SX0E2
  D3B2  D5            		PUSH	DE
  D3B3  5F            		LD	E,A
  D3B4  CD8CD7        		CALL	_SYS02
  D3B7  D1            		POP	DE
  D3B8  18F2          		JR	_SX09
                      	
  D3BA                	_SYS0C:		;(BDOS)バージョン番号の獲得
  D3BA  212200        		LD	HL,00022H
  D3BD  AF            		XOR	A
  D3BE  7D            		LD	A,L
  D3BF  C9            		RET
                      	
  D3C0                	_SYS0D:		;(BDOS)ディスク・リセット
  D3C0  CDDFEC        		CALL	_FFLUSH
  D3C3  E5            		PUSH	HL
  D3C4  218000        		LD	HL,00080H
  D3C7  228AEC        		LD	(_DTA),HL
  D3CA  E1            		POP	HL
  D3CB  D5            		PUSH	DE
  D3CC  1E00          		LD	E,0
  D3CE  3E            		DB	03EH
                      	
  D3CF                	_SYS0E:		;(BDOS)カレント・ドライブの設定
  D3CF  D5            		PUSH	DE
  D3D0  7B            		LD	A,E
  D3D1  DDE5          		PUSH	IX
  D3D3  CDDCEC        		CALL	_GETDPB
  D3D6  DDE1          		POP	IX
  D3D8  3804          		JR	C,SX0E2
  D3DA  7B            		LD	A,E
  D3DB  3287EC        		LD	(_DVSW),A
  D3DE                	SX0E2:
  D3DE  3E08          		LD	A,8
  D3E0  D1            		POP	DE
  D3E1  C9            		RET
                      	
  D3E2                	_SYS0F:		;(BDOS)ファイルのオープン
  D3E2  CD78DD        		CALL	SETDRV
  D3E5  FD7E1C        		LD	A,(IY+28)	;(FCB)オープン・モード
  D3E8  C602          		ADD	A,002H		;Write
  D3EA  2848          		JR	Z,FEND0F
  D3EC  CDE1E0        		CALL	CHKWILDX
                      	
  D3EF  D498DD        		CALL	NC,SOPENX
  D3F2                	_S16XX:
  D3F2  3840          		JR	C,FEND0F
                      					;Directory location
  D3F4  3A9FEC        		LD	A,(_FILEN)
  D3F7  FD7719        		LD	(IY+25),A	;(FCB)ディレクトリ・ロケーション
                      	;				_DIRF
  D3FA  3AA0EC        		LD	A,(_DIRF)
  D3FD  FD771D        		LD	(IY+29),A	;(FCB)ディレクトリ・モード
                      	;				_FBPS
  D400  FD731E        		LD	(IY+30),E	;(FCB)ディレクトリ・ポジション
  D403  FD721F        		LD	(IY+31),D
                      	;				Open(Read)
  D406  FD361CFF      		LD	(IY+28),0FFH	;(FCB)オープン・モード
                      	;				FILENAME
  D40A  FDE5          		PUSH	IY
  D40C  D1            		POP	DE
  D40D  13            		INC	DE
  D40E  010B00        		LD	BC,11
  D411  EDB0          		LDIR
                      	;				Attribute
  D413  7E            		LD	A,(HL)
  D414  FD770D        		LD	(IY+13),A	;(FCB)属性(アトリビュート)
  D417  110B00        		LD	DE,11		;Reserved
  D41A  19            		ADD	HL,DE
                      						;(FCB)ファイルを最後に変更した時刻
  D41B  11EAEB        		LD	DE,SDDATA		;(FCB)ファイルを最後に変更した日付
  D41E  060A          		LD	B,SDDATAE-SDDATA	;(FCB)ファイルの先頭クラスタ
  D420                	S16LOOP:				;(FCB)ファイルのサイズ(バイト単位)
  D420  1A            		LD	A,(DE)
  D421  13            		INC	DE
  D422  3229D4        		LD	(S16PAT+2),A
  D425  7E            		LD	A,(HL)
  D426  23            		INC	HL
  D427  FD7700        	S16PAT:	LD	(IY+0),A
  D42A  10F4          		DJNZ	S16LOOP
                      	
  D42C  AF            		XOR	A
  D42D  FD770C        		LD	(IY+12),A	;(FCB)カレント・ブロック
  D430  FD2200D5      		LD	(OFCB+1),IY
  D434                	FEND0F:
  D434  1843          		JR	FEND10
                      	
  D436                	_SYS10:		;(BDOS)ファイルのクローズ
  D436  CD78DD        		CALL	SETDRV
  D439  FD7E1C        		LD	A,(IY+28)	;(FCB)オープン・モード
  D43C  D6FE          		SUB	0FEH
  D43E  37            		SCF
  D43F  3F            		CCF
  D440  2037          		JR	NZ,FEND10
  D442                	_S10A:				;Write
  D442  FD770E        		LD	(IY+14),A	;(FCB)レコード・サイズ/アクセスするディレクトリのクラスタ番号+1
  D445  FD770F        		LD	(IY+15),A
                      	
  D448  FD341C        		INC	(IY+28)		;0FEH->0FFH ;オープン・モード
  D44B  CDCFE1        		CALL	SETTMS
                      	
  D44E  FD7E1D        		LD	A,(IY+29)	;(FCB)ディレクトリ・モード
  D451  32A0EC        		LD	(_DIRF),A
  D454  E67F          		AND	07FH
  D456  32DEE6        		LD	(_SECPS+1),A
  D459  FD5E1E        		LD	E,(IY+30)	;(FCB)ディレクトリ・ポジション
  D45C  FD561F        		LD	D,(IY+31)
  D45F  CDD1DE        		CALL	READ_DIR
  D462  3815          		JR	C,FEND10
                      	
  D464  FD7E19        		LD	A,(IY+25)	;(FCB)ディレクトリ・ロケーション
  D467  E61F          	SDECM1:	AND	01FH		;自己書き換え(1セクタ辺りのディレクトリエントリ数-1) 1024=01FH / 512=00FH / 256=7
  D469  6F            		LD	L,A
  D46A  2600          		LD	H,0
  D46C  29            		ADD	HL,HL		;*2
  D46D  29            		ADD	HL,HL		;*4
  D46E  29            		ADD	HL,HL		;*8
  D46F  29            		ADD	HL,HL		;*16
  D470  29            		ADD	HL,HL		;*32
  D471  ED4B7EEC      		LD	BC,(_DTBUF)
  D475  09            		ADD	HL,BC
                      	
  D476  CDF1E0        		CALL	SDIRENT
  D479                	FEND10:
  D479  186C          		JR	FEND
                      	
  D47B                	OPENDD:
  D47B  FD361CFD      		LD	(IY+28),0FDH	;(FCB)オープン・モード
  D47F  FD360D20      		LD	(IY+13),020H	;(FCB)属性(アトリビュート)
  D483  CDD4E1        		CALL	SETTMSX
  D486  185F          		JR	FEND
                      	
  D488                	_SYS11:		;(BDOS)最初のファイルの検索
  D488  CD78DD        		CALL	SETDRV
  D48B  CD18DF        		CALL	CHKDDX
  D48E  3818          		JR	C,_S11A
  D490  FDE5          		PUSH	IY
  D492  E1            		POP	HL
  D493  ED5B8AEC      		LD	DE,(_DTA)
  D497  010C00        		LD	BC,12
  D49A  EDB0          		LDIR
  D49C  3E20          		LD	A,020H
  D49E  12            		LD	(DE),A
  D49F  13            		INC	DE
  D4A0  62            		LD	H,D
  D4A1  6B            		LD	L,E
  D4A2  13            		INC	DE
  D4A3  0E13          		LD	C,19
  D4A5  70            		LD	(HL),B
  D4A6  183D          		JR	_S11B
  D4A8                	_S11A:
  D4A8  CDCCDD        		CALL	SOPEN
  D4AB                	_S12X1:
  D4AB  383A          		JR	C,FEND
  D4AD  CD6CDE        		CALL	SOPENE2
  D4B0  ED5B8AEC      		LD	DE,(_DTA)
  D4B4  3A88EC        		LD	A,(_DRV)
  D4B7  3C            		INC	A
  D4B8  12            		LD	(DE),A
  D4B9  D5            		PUSH	DE
  D4BA  13            		INC	DE
  D4BB  012000        		LD	BC,32
  D4BE  EDB0          		LDIR
  D4C0  FD6E0E        		LD	L,(IY+14)	;(FCB)レコード・サイズ/アクセスするディレクトリのクラスタ番号+1
  D4C3  FD660F        		LD	H,(IY+15)
  D4C6  22F4EB        		LD	(SCDIR),HL
  D4C9  2A9AEC        		LD	HL,(_FBPS)
  D4CC  22F6EB        		LD	(SFBPS),HL
  D4CF  2A9FEC        		LD	HL,(_FILEN)
  D4D2  7C            		LD	A,H
  D4D3  B7            		OR	A
  D4D4  2806          		JR	Z,_S12DIR
  D4D6  3ADEE6        		LD	A,(_SECPS+1)
  D4D9  F680          		OR	080H
  D4DB  67            		LD	H,A
  D4DC                	_S12DIR
  D4DC  22F8EB        		LD	(SFNDF),HL	;Directory position and Flags
  D4DF  E1            		POP	HL
  D4E0  117AE2        		LD	DE,SFILE
  D4E3  0E21          		LD	C,33
  D4E5                	_S11B:
  D4E5  EDB0          		LDIR
  D4E7                	FEND:
  D4E7  9F            		SBC	A,A		;CF=0 A=0 : CF=1 A=0FFH
  D4E8                	FENDE:
  D4E8  FDE1          		POP	IY
  D4EA  C1            		POP	BC
  D4EB  D1            		POP	DE
  D4EC  E1            		POP	HL
  D4ED  C9            		RET
                      	
  D4EE                	_SYS12:		;(BDOS)次のファイルの検索
  D4EE  E5            		PUSH	HL
  D4EF  D5            		PUSH	DE
  D4F0  C5            		PUSH	BC
  D4F1  FDE5          		PUSH	IY
  D4F3  CD30DE        		CALL	NOPEN
  D4F6  18B3          		JR	_S12X1
                      	
  D4F8                	_S16K:
  D4F8  FD7E1C        		LD	A,(IY+28)	;(FCB)オープン・モード
  D4FB  FEFD          		CP	0FDH		;Device(0FDH)
  D4FD  37            		SCF
  D4FE  C8            		RET	Z
                      	
  D4FF  110000        	OFCB:	LD	DE,0
  D502  D5            		PUSH	DE
  D503  061A          		LD	B,26		;First cluster
  D505                	S16K1:
  D505  13            		INC	DE
  D506  23            		INC	HL
  D507  10FC          		DJNZ	S16K1
                      	
  D509  1A            		LD	A,(DE)
  D50A  BE            		CP	(HL)
  D50B  2013          		JR	NZ,S16K2
  D50D  13            		INC	DE
  D50E  23            		INC	HL
  D50F  1A            		LD	A,(DE)
  D510  BE            		CP	(HL)
  D511  200D          		JR	NZ,S16K2
                      	
  D513  E1            		POP	HL
  D514  FDE5          		PUSH	IY
  D516  D1            		POP	DE
  D517  1A            		LD	A,(DE)		;Drive
  D518  BE            		CP	(HL)
  D519  2005          		JR	NZ,S16K2
                      					;ここはCFが必ず0
  D51B  ED52          		SBC	HL,DE		;CP HL,DE
  D51D  37            		SCF
  D51E  C0            		RET	NZ
  D51F  E5            		PUSH	HL
  D520                	S16K2:
  D520  E1            		POP	HL
  D521  FDE5          		PUSH	IY
  D523  D1            		POP	DE
  D524                	_SYS13:		;(BDOS)ファイルの削除
  D524  CD78DD        		CALL	SETDRV
  D527  CD0BE0        		CALL	KILL
  D52A                	FEND13:
  D52A  18BB          		JR	FEND
                      	
  D52C                	_SYS14:		;(BDOS)シーケンシャルな読み出し
  D52C  CD78DD        		CALL	SETDRV
  D52F  CD01E2        		CALL	PUSHRR
  D532  CD42E2        		CALL	GETSEQ
                      	
  D535  CD56E2        		CALL	RB_READ
  D538  E5            		PUSH	HL
  D539  CD15E2        		CALL	SETSEQ
  D53C                	SREAD:
  D53C  E1            		POP	HL
                      	
  D53D  C601          		ADD	A,001H
  D53F  38A6          		JR	C,FEND
                      	
  D541  7D            		LD	A,L
  D542  D601          		SUB	001H
  D544                	FENDX:
  D544  9F            		SBC	A,A
  D545  E603          		AND	3
  D547  1F            		RRA
  D548  189E          		JR	FENDE
                      	
  D54A                	_SYS15:		;(BDOS)シーケンシャルな書き込み
  D54A  CD78DD        		CALL	SETDRV
  D54D  CD01E2        		CALL	PUSHRR
  D550  CD42E2        		CALL	GETSEQ
                      	
  D553  CD4FE2        		CALL	RB_WRITE
  D556  E5            		PUSH	HL
  D557  CD15E2        		CALL	SETSEQ
  D55A                	SWRITE:
  D55A  E1            		POP	HL
                      	
  D55B  C6FF          		ADD	A,0FFH
  D55D  18E5          		JR	FENDX
                      	
  D55F                	_SYS17:		;(BDOS)ファイル名の変更
  D55F  CD78DD        		CALL	SETDRV
  D562  CD67E0        		CALL	NAME
  D565  18C3          		JR	FEND13
                      	
  D567                	_SYS16:		;(BDOS)ファイルの作成
  D567  CD78DD        		CALL	SETDRV
                      	
  D56A  CDE1E0        		CALL	CHKWILDX
  D56D  38BB          		JR	C,FEND13
  D56F  FD7E01        		LD	A,(IY+1)	;(FCB)主ファイル名
  D572  FE05          		CP	5
  D574  2805          		JR	Z,_S16X2
  D576  FE21          		CP	021H
  D578  DA2AD5        		JP	C,FEND13
  D57B                	_S16X2:
                      	;				Clear FCB
  D57B  FDE5          		PUSH	IY
  D57D  E1            		POP	HL
  D57E  011000        		LD	BC,16
  D581  09            		ADD	HL,BC
  D582                	_S16X1:
  D582  70            		LD	(HL),B		;B=0
  D583  23            		INC	HL
  D584  0D            		DEC	C
  D585  20FB          		JR	NZ,_S16X1
                      	
  D587  CDD4E1        		CALL	SETTMSX
  D58A  FD360DFF      		LD	(IY+13),0FFH	;(FCB)Attribute
  D58E  CD98DD        		CALL	SOPENX
  D591  3F            		CCF
  D592  CCF8D4        		CALL	Z,_S16K
  D595  D47DDE        		CALL	NC,COPEN
  D598  D4F1E0        		CALL	NC,SDIRENT
  D59B  C3F2D3        		JP	_S16XX
                      	
  D59E                	_SYS21:		;(BDOS)ランダムな読み出し
                      	
  D59E  CD78DD        		CALL	SETDRV
  D5A1  CD01E2        		CALL	PUSHRR
  D5A4  FD6E21        		LD	L,(IY+33)	;(FCB)Random record
  D5A7  FD6622        		LD	H,(IY+34)
                      	
  D5AA  CD56E2        		CALL	RB_READ
  D5AD  E5            		PUSH	HL
  D5AE  CD2CE2        		CALL	POPRR
  D5B1  1889          		JR	SREAD
                      	
  D5B3                	_SYS22:		;(BDOS)ランダムな書き込み
  D5B3                	_SYS28:		;(BDOS)ランダムな書き込み・その2
  D5B3  CD78DD        		CALL	SETDRV
  D5B6  CD01E2        		CALL	PUSHRR
  D5B9  FD6E21        		LD	L,(IY+33)	;(FCB)Random record
  D5BC  FD6622        		LD	H,(IY+34)
                      	
  D5BF  CD4FE2        		CALL	RB_WRITE
  D5C2  E5            		PUSH	HL
  D5C3  CD2CE2        		CALL	POPRR
  D5C6  1892          		JR	SWRITE
                      	
  D5C8                	_SYS18:		;(BDOS)ログイン・ベクトルの獲得
  D5C8  21FF00        		LD	HL,000FFH
  D5CB  AF            		XOR	A
  D5CC  C9            		RET
                      	
  D5CD                	_SYS19:		;(BDOS)カレント・ドライブ番号の獲得
  D5CD  3A87EC        		LD	A,(_DVSW)
  D5D0  A7            		AND	A
  D5D1  C9            		RET
                      	
  D5D2                	_SYS1A:		;(BDOS)DTAの設定
  D5D2  ED538AEC      		LD	(_DTA),DE
  D5D6  AF            		XOR	A
  D5D7  C9            		RET
                      	
  D5D8                	_SYS1B:		;(BDOS)ディスク情報の獲得
  D5D8  7B            		LD	A,E
  D5D9  CD8BDD        		CALL	GETDRV
  D5DC  CDDCEC        		CALL	_GETDPB
  D5DF  D4E2EC        		CALL	NC,_RDFATX
  D5E2  210000        		LD	HL,0
  D5E5  D4ADE1        		CALL	NC,DSKF
                      	
  D5E8  ED5BAEE1      		LD	DE,(MAXCLP+1)	;DPB_08_MAXCL-1
  D5EC  1B            		DEC	DE		;DE←クラスタの総数
  D5ED  FD2A7CEC      		LD	IY,(_FATBF)	;IY←メモリ上のFATの先頭アドレス
  D5F1  9F            		SBC	A,A
  D5F2  D8            		RET	C
  D5F3  4F            		LD	C,A		;C=0
  D5F4  DD7E0F        		LD	A,(IX+00FH)	;DPB_0F_BPS
  D5F7  E60F          		AND	00FH
  D5F9  47            		LD	B,A
  D5FA  DD7E07        		LD	A,(IX+7)	;DPB_07_SECPCL
  D5FD  C9            		RET
                      	
  D5FE                	_SYS1D:		;(BDOS)書き込みが禁止されているディスクの調査
  D5FE  AF            		XOR	A
  D5FF  67            		LD	H,A
  D600  6F            		LD	L,A
  D601  C9            		RET
                      	
  D602                	_SYS1F:		;(BDOS)ディスク装置のパラメータの読み出し
  D602  2100ED        		LD	HL,DEVICE
  D605  7B            		LD	A,E
  D606  C3DCEC        		JP	_GETDPB
                      	
  D609                	_SYS23:		;(BDOS)ファイル・サイズの獲得
  D609  E5            		PUSH	HL
  D60A  2A1EEC        		LD	HL,(STABLE+2*00FH)	;ファイルのオープン
  D60D  CD0F00        		CALL	JP_HL
  D610  3814          		JR	C,_S23X1
                      	
  D612  D5            		PUSH	DE		;EX DE,IY
  D613  FDE3          		EX	(SP),IY		;
                      	;	POP	DE		;
                      	;	PUSH	DE		;DEを破壊しないように注意vv
  D615  CD32E2        		CALL	GETSIZE
  D618                	_S24X1:
  D618  FD7521        		LD	(IY+33),L	;(FCB)Random record
  D61B  FD7422        		LD	(IY+34),H
  D61E  FD362300      		LD	(IY+35),0
                      	;	POP	DE		;^^^^^^^^^^^^^^^^^^^^^^^^
                      	;	PUSH	DE		;EX DE,IY
  D622  FDE3          		EX	(SP),IY		;
  D624  D1            		POP	DE		;
                      	
  D625  AF            		XOR	A
  D626                	_S23X1:
  D626  E1            		POP	HL
  D627  C9            		RET
                      	
  D628                	_SYS24:		;(BDOS)ランダム・レコード・フィールドの設定
  D628  E5            		PUSH	HL
  D629  D5            		PUSH	DE		;EX DE,IY
  D62A  FDE3          		EX	(SP),IY		;
                      	;	POP	DE		;
                      	;	PUSH	DE		;DEを破壊しないように注意vv
  D62C  CD42E2        		CALL	GETSEQ
  D62F  18E7          		JR	_S24X1		;^^^^^^^^^^^^^^^^^^^^^^^^
                      	
  D631                	_SYS29:		;(BDOS)ファイル名の解析
  D631  C5            		PUSH	BC
  D632  E5            		PUSH	HL
  D633  CD8EDC        		CALL	FILE
  D636  E1            		POP	HL
  D637  C1            		POP	BC
  D638                	S29X1:
  D638  C5            		PUSH	BC
  D639  D5            		PUSH	DE
  D63A  E5            		PUSH	HL
  D63B  EB            		EX	DE,HL
  D63C  21DB00        		LD	HL,FDRV
  D63F  010D00        		LD	BC,13
  D642  EDB0          		LDIR
  D644  70            		LD	(HL),B		;B=0
  D645  0E03          		LD	C,3
  D647  EDB0          		LDIR
  D649  E1            		POP	HL
  D64A  D1            		POP	DE
  D64B  C1            		POP	BC
  D64C  AF            		XOR	A
  D64D  C9            		RET
                      	
  D64E                	_SYS30:		;(BDOS)論理セクタを用いた書き込み
  D64E  C5            		PUSH	BC
  D64F  014DE8        		LD	BC,DWT16
  D652  1804          		JR	S2FX
  D654                	_SYS2F:
  D654  C5            		PUSH	BC
  D655  013DE8        		LD	BC,DRD16
  D658                	S2FX:
  D658  ED436DD6      		LD	(S2FPAT+1),BC
  D65C  CDDFEC        		CALL	_FFLUSH
                      	
  D65F  D5            		PUSH	DE
  D660  E5            		PUSH	HL
  D661  7D            		LD	A,L		;Drive
  D662  CDD9EC        		CALL	_CHGDRV
  D665  380D          		JR	C,S30X2
  D667  44            		LD	B,H		;Number of clusters
  D668  2A8AEC        		LD	HL,(_DTA)
  D66B                	S30X:
  D66B  C5            		PUSH	BC
  D66C  CD3DE8        	S2FPAT:	CALL	DRD16
  D66F  C1            		POP	BC
  D670  3802          		JR	C,S30X2
  D672  10F7          		DJNZ	S30X
  D674                	S30X2:
  D674  E1            		POP	HL
  D675  D1            		POP	DE
  D676  C1            		POP	BC
  D677  9F            		SBC	A,A
  D678  C9            		RET
                      	
                      	;LDIO.ASM
                      	
                      	;	LSX-Dodgers IO
                      	
                      	
  D679                	BIOS:
  D679  E5            		PUSH	HL
  D67A  210081        		LD	HL,08100H
  D67D  39            		ADD	HL,SP
  D67E  E1            		POP	HL
  D67F  300E          		JR	NC,BIOS2
  D681                	BIOS1:
  D681  CD89D6        		CALL	BIOS3
  D684  061E          		LD	B,01EH
  D686  ED79          		OUT	(C),A
  D688  C9            		RET
  D689                	BIOS3:
  D689  C5            		PUSH	BC
  D68A  061D          		LD	B,01DH
  D68C  ED79          		OUT	(C),A
  D68E  C9            		RET
  D68F                	BIOS2:
  D68F  ED739AD6      		LD	(SPPAT+1),SP	;スタックがBIOS-ROMと被っている場合
  D693  31D4FF        		LD	SP,EXTSP
  D696  CD81D6        		CALL	BIOS1
  D699  310000        	SPPAT:	LD	SP,0
  D69C  C9            		RET
                      	
  D69D                	INT:
  D69D  F5            		PUSH	AF
  D69E  E5            		PUSH	HL
  D69F  210001        		LD	HL,00100H
  D6A2  39            		ADD	HL,SP
  D6A3  380C          		JR	C,INTP1X
  D6A5  ED73ADD6      		LD	(INTSP+1),SP
  D6A9  CDB9D6        		CALL	INTP1
  D6AC  310000        	INTSP:	LD	SP,0
  D6AF  1803          		JR	INTPE
  D6B1                	INTP1X:
  D6B1  CDB9D6        		CALL	INTP1
  D6B4                	INTPE:
  D6B4  E1            		POP	HL
  D6B5                	INTPE2:
  D6B5  F1            		POP	AF
  D6B6                	INTCTCE:
  D6B6  FB            		EI
  D6B7  ED4D          		RETI
  D6B9                	INTP1:
  D6B9  C5            		PUSH	BC
                      	
  D6BA  CD98DA        		CALL	IN49SB
  D6BD  67            		LD	H,A
  D6BE  CD98DA        		CALL	IN49SB
  D6C1  6F            		LD	L,A
                      	
  D6C2  FE08          		CP	8		;DELキー
  D6C4  2005          		JR	NZ,SCEXE
  D6C6  7C            		LD	A,H
  D6C7  E611          		AND	011H		;CTRLキー + GRAPHキー
  D6C9  2808          		JR	Z,RESET
  D6CB                	SCEXE:
  D6CB  2292EC        		LD	(_KEYD),HL
  D6CE  CDFFD6        		CALL	KEYSET1
                      	
  D6D1  C1            		POP	BC
  D6D2  C9            		RET
                      	
  D6D3                	RESET:
  D6D3  3E1D          		LD	A,01DH
  D6D5  D300          		OUT	(0),A
  D6D7  C7            		RST	0
                      	
  D6D8                	INTCTC2:
  D6D8  F5            		PUSH	AF
  D6D9  3E00          	INTCPAT:LD	A,000H
  D6DB  3D            		DEC	A
  D6DC  32DAD6        		LD	(INTCPAT+1),A
  D6DF  20D4          		JR	NZ,INTPE2
                      	
  D6E1  3A92EC        		LD	A,(_KEYD)
  D6E4  B7            		OR	A
  D6E5  28CE          		JR	Z,INTPE2
  D6E7                	KEYSET0:
  D6E7  E5            		PUSH	HL
  D6E8  2A90EC        		LD	HL,(_KEYPS)
  D6EB  7C            		LD	A,H
  D6EC  AD            		XOR	L
  D6ED  2006          		JR	NZ,INTC2A
                      	
  D6EF  2A92EC        		LD	HL,(_KEYD)
  D6F2  CD29D7        		CALL	KEYSET
  D6F5                	INTC2A:
  D6F5  3A94EC        		LD	A,(_KEYSP)
  D6F8  E60F          		AND	00FH
  D6FA  32DAD6        		LD	(INTCPAT+1),A
                      	
  D6FD  18B5          		JR	INTPE
                      	
  D6FF                	KEYSET1:
  D6FF  CB6C          		BIT	5,H
  D701  F5            		PUSH	AF
  D702  ED4B8CEC      		LD	BC,(_CTC)
  D706  78            		LD	A,B
  D707  B1            		OR	C
  D708  2006          		JR	NZ,KEYS10E
                      	
  D70A  F1            		POP	AF
  D70B  201C          		JR	NZ,KEYSET
  D70D  F5            		PUSH	AF
  D70E  18D7          		JR	KEYSET0
  D710                	KEYS10E:
  D710  F1            		POP	AF
  D711  C8            		RET	Z
  D712  F5            		PUSH	AF
  D713  3E03          		LD	A,3		;CTC STOP
  D715  ED79          		OUT	(C),A
  D717  F1            		POP	AF
                      	
  D718  B7            		OR	A
  D719  C8            		RET	Z
                      	
  D71A  E5            		PUSH	HL
  D71B  2A94EC        		LD	HL,(_KEYSP)
  D71E  3EA7          		LD	A,0A7H
  D720  ED79          		OUT	(C),A
  D722  ED69          		OUT	(C),L
  D724  7C            		LD	A,H
  D725  32DAD6        		LD	(INTCPAT+1),A
  D728  E1            		POP	HL
                      	
  D729                	KEYSET:
  D729  7D            		LD	A,L
  D72A  CB7C          		BIT	7,H
  D72C  CC59D7        		CALL	Z,FKEY
  D72F  CB74          		BIT	6,H
  D731  C0            		RET	NZ
  D732                	KEYBS:
  D732  B7            		OR	A
  D733  C8            		RET	Z
  D734                	KEYBS1:
  D734  FE03          		CP	3
  D736  CC4CD7        		CALL	Z,KEYBC
  D739  E5            		PUSH	HL
  D73A  F5            		PUSH	AF
  D73B  2A90EC        		LD	HL,(_KEYPS)
  D73E  2C            		INC	L
  D73F  7D            		LD	A,L
  D740  BC            		CP	H
  D741  2812          		JR	Z,POP_AF_HL_SCF_RET
  D743  3290EC        		LD	(_KEYPS),A
  D746  26FE          		LD	H,KEYBF/256
  D748  F1            		POP	AF
  D749  77            		LD	(HL),A
  D74A  E1            		POP	HL
  D74B  C9            		RET
                      	
  D74C                	KEYBC:
  D74C  E5            		PUSH	HL
  D74D  210000        		LD	HL,0
  D750  2290EC        		LD	(_KEYPS),HL
  D753  E1            		POP	HL
  D754  C9            		RET
                      	
  D755                	POP_AF_HL_SCF_RET:
  D755  F1            		POP	AF
  D756  E1            		POP	HL
  D757  37            		SCF
  D758  C9            		RET
                      	
  D759                	FKEY:
  D759  CB75          		BIT	6,L
  D75B  C8            		RET	Z
  D75C  3E1B          		LD	A,01BH
  D75E  CD34D7        		CALL	KEYBS1
  D761  7D            		LD	A,L
  D762  C6AF          		ADD	A,020H-'q'
  D764  CB7D          		BIT	7,L
  D766  C8            		RET	Z
  D767  2E50          		LD	L,'P'
  D769  D690          		SUB	0E1H+020H-'q'
  D76B  2810          		JR	Z,KEYBSL
  D76D  2C            		INC	L
  D76E  3D            		DEC	A
  D76F  280C          		JR	Z,KEYBSL
  D771  2C            		INC	L
  D772  D609          		SUB	0EBH-0E2H
  D774  2807          		JR	Z,KEYBSL
  D776  2E43          		LD	L,'C'
  D778  3D            		DEC	A
  D779  2802          		JR	Z,KEYBSL
  D77B  2E58          		LD	L,'X'
  D77D                	KEYBSL:
  D77D  7D            		LD	A,L
  D77E  18B4          		JR	KEYBS1
                      	
  D780                	_SYS01:		;(BDOS)コンソール入力
  D780  CD6FD3        		CALL	_SYS07
  D783                	MSG_A:
  D783  F5            		PUSH	AF
  D784  D5            		PUSH	DE
  D785  5F            		LD	E,A
  D786  CD8CD7        		CALL	_SYS02
  D789  D1            		POP	DE
  D78A  F1            		POP	AF
  D78B  C9            		RET
                      	
  D78C                	_SYS02:		;(BDOS)コンソール出力
  D78C  CD9ED7        		CALL	BREAK
  D78F  1805          		JR	PRINTX
                      	
  D791                	_SYS06:		;(BDOS)コンソール直接入出力
  D791  7B            		LD	A,E
  D792  3C            		INC	A
  D793  CACAEC        		JP	Z,_INKEY
  D796                	PRINTX:
  D796  C3CDEC        		JP	_PRINT
                      	
  D799                	_SYS08:		;(BDOS)エコーなしコンソール入力
  D799  CD6FD3        		CALL	_SYS07
  D79C  1804          		JR	BREAK1
  D79E                	BREAK:
  D79E  FB            		EI
  D79F  3A92EC        		LD	A,(_KEYD)
  D7A2                	BREAK1:
  D7A2  FE03          		CP	3
  D7A4  CA0000        		JP	Z,0
  D7A7  FE13          		CP	013H
  D7A9  C0            		RET	NZ
                      	
  D7AA                	PAUSE:
  D7AA  CD4CD7        		CALL	KEYBC
                      	
  D7AD                	FLGET:
  D7AD  CDDFEC        		CALL	_FFLUSH
  D7B0  C5            		PUSH	BC
  D7B1  E5            		PUSH	HL
  D7B2  ED4B8EEC      		LD	BC,(_TXADR)
  D7B6  CBE8          		SET	5,B
  D7B8  ED60          		IN	H,(C)
  D7BA                	FLGET1:
  D7BA  3A93EC        		LD	A,(_KEYD+1)
  D7BD  0F            		RRCA
  D7BE  0F            		RRCA
  D7BF  E610          		AND	010H
  D7C1  F608          		OR	8
  D7C3  ED68          		IN	L,(C)
  D7C5  B5            		OR	L
  D7C6  ED79          		OUT	(C),A
  D7C8  CDCAEC        		CALL	_INKEY
  D7CB  28ED          		JR	Z,FLGET1
  D7CD  ED61          		OUT	(C),H
  D7CF  E1            		POP	HL
  D7D0  C1            		POP	BC
  D7D1  C9            		RET
                      	
  D7D2                	_SYS0A:		;(BDOS)文字列入力
  D7D2  C5            		PUSH	BC
  D7D3  E5            		PUSH	HL
  D7D4  D5            		PUSH	DE
  D7D5  CDF5DB        		CALL	GETL
  D7D8  1100FF        		LD	DE,KBUF
  D7DB  E1            		POP	HL
  D7DC  E5            		PUSH	HL
  D7DD  0E00          		LD	C,0
  D7DF  3004          		JR	NC,SAX0
  D7E1  23            		INC	HL
  D7E2  23            		INC	HL
  D7E3  1808          		JR	SAX4
  D7E5                	SAX0:
  D7E5  46            		LD	B,(HL)
  D7E6  23            		INC	HL
  D7E7                	SAX1:
  D7E7  23            		INC	HL
  D7E8  1A            		LD	A,(DE)
  D7E9  13            		INC	DE
  D7EA  B7            		OR	A
  D7EB  2004          		JR	NZ,SAX2
  D7ED                	SAX4:
  D7ED  360D          		LD	(HL),00DH
  D7EF  1804          		JR	SAX3
  D7F1                	SAX2:
  D7F1  77            		LD	(HL),A
  D7F2  0C            		INC	C
  D7F3  10F2          		DJNZ	SAX1
  D7F5                	SAX3:
  D7F5  D1            		POP	DE
  D7F6  79            		LD	A,C
  D7F7  13            		INC	DE
  D7F8  12            		LD	(DE),A
  D7F9  1B            		DEC	DE
  D7FA  E1            		POP	HL
  D7FB  C1            		POP	BC
  D7FC  A7            		AND	A
  D7FD  C9            		RET
                      	
  D7FE                	_SYS0B:		;(BDOS)コンソール状態のチェック
  D7FE  CD9ED7        		CALL	BREAK
  D801  3A92EC        		LD	A,(_KEYD)
  D804  B7            		OR	A
  D805  C8            		RET	Z
  D806                	CONSTX:
  D806  CDDFEC        		CALL	_FFLUSH
  D809  E5            		PUSH	HL
  D80A  2A90EC        		LD	HL,(_KEYPS)
  D80D  7C            		LD	A,H
  D80E  AD            		XOR	L
  D80F  E1            		POP	HL
  D810  C6FF          		ADD	A,0FFH
  D812  9F            		SBC	A,A
  D813  C9            		RET
                      	
  D814                	_SYS2A:		;(BDOS)日付の獲得
  D814  C5            		PUSH	BC
  D815  3EED          		LD	A,0EDH		;Read calendar
  D817  CDB3DA        		CALL	COMOUT
  D81A  CD37D8        		CALL	IN49SB_BCD	;YY
  D81D  6F            		LD	L,A
  D81E  2600          		LD	H,0
                      	;	LD	DE,1900		;0076CH
                      	;	CP	90		;90以上は1900年代 1990-1999
                      	;	JR	NC,RDDATE1	;90未満は2000年代 2000-2089
                      	;	LD	E,0D0H		;2000 & 0FFH D=007H
  D820  11D007        		LD	DE,2000		;すべて2000年代で処理 2000-2099
  D823                	RDDATE1:
  D823  19            		ADD	HL,DE
  D824  CD98DA        		CALL	IN49SB		;MM
  D827  57            		LD	D,A
  D828  CD37D8        		CALL	IN49SB_BCD	;DD
  D82B  5F            		LD	E,A
  D82C  7A            		LD	A,D
  D82D  E607          		AND	7
  D82F  0604          		LD	B,4
  D831                	RDDATE2:
  D831  CB3A          		SRL	D
  D833  10FC          		DJNZ	RDDATE2
  D835  C1            		POP	BC
  D836  C9            		RET
  D837                	IN49SB_BCD:
  D837  CD98DA        		CALL	IN49SB
                      	;------------------------
                      	;BCDの10進数化
                      	;in
                      	;	A  : BCD
                      	;out
                      	;	A  : 10進数
                      	;------------------------
  D83A  4F            		LD	C,A
  D83B  E6F0          		AND	0F0H	;10の位
  D83D  0F            		RRCA
  D83E  47            		LD	B,A
  D83F  0F            		RRCA
  D840  0F            		RRCA
  D841  80            		ADD	A,B
  D842  47            		LD	B,A
  D843  79            		LD	A,C
  D844  E60F          		AND	00FH	;1の位
  D846  80            		ADD	A,B
  D847  C9            		RET
                      	
  D848                	_SYS2C:		;(BDOS)時刻の獲得
  D848  C5            		PUSH	BC
  D849  3EEF          		LD	A,0EFH		;Read time
  D84B  CDB3DA        		CALL	COMOUT
  D84E  CD37D8        		CALL	IN49SB_BCD	;TT
  D851  67            		LD	H,A
  D852  CD37D8        		CALL	IN49SB_BCD	;MM
  D855  6F            		LD	L,A
  D856  CD37D8        		CALL	IN49SB_BCD	;SS
  D859  57            		LD	D,A
  D85A  C1            		POP	BC
  D85B  AF            		XOR	A
  D85C  C9            		RET
                      	
  D85D                	MSX1:
  D85D  5F            		LD	E,A
  D85E  CDCDEC        		CALL	_PRINT
  D861                	MSX:
  D861  7E            		LD	A,(HL)
  D862  23            		INC	HL
  D863  B7            		OR	A
  D864  20F7          		JR	NZ,MSX1
  D866  C9            		RET
                      	
  D867                	ESC1:
  D867  7B            		LD	A,E
  D868  FE41          		CP	'A'
  D86A  CAA6D9        		JP	Z,CTRL1E
  D86D  FE42          		CP	'B'
  D86F  CA1EDB        		JP	Z,CTRL1F
  D872  FE43          		CP	'C'
  D874  CAB3D9        		JP	Z,CTRL1C
  D877  FE44          		CP	'D'
  D879  CA9CD9        		JP	Z,CTRL1D
  D87C  FE45          		CP	'E'
  D87E  2802          		JR	Z,CT0CX
  D880  FE6A          		CP	'j'
  D882                	CT0CX:
  D882  CAF1DA        		JP	Z,CTRL0C
  D885  FE48          		CP	'H'
  D887  CA31DA        		JP	Z,CTRL0B
  D88A  FE4A          		CP	'J'
  D88C  CAF4DA        		JP	Z,CTRL1A
  D88F  FE4B          		CP	'K'
  D891  CAF3D9        		JP	Z,CTRL05
  D894  FE4C          		CP	'L'
  D896  CA33DB        		JP	Z,CTRL0E
  D899  FE78          		CP	'x'
  D89B  2804          		JR	Z,ESC1X
  D89D  FE79          		CP	'y'
  D89F  2002          		JR	NZ,ESC1Y
  D8A1                	ESC1X:
  D8A1  3601          		LD	(HL),1
  D8A3                	ESC1Y:
  D8A3  FE3D          		CP	'='
  D8A5  2804          		JR	Z,ESC1W
  D8A7  FE59          		CP	'Y'
  D8A9  2002          		JR	NZ,ESC1Z
  D8AB                	ESC1W:
  D8AB  3602          		LD	(HL),2
  D8AD                	ESC1Z:
  D8AD  FE20          		CP	020H
  D8AF  3802          		JR	C,ESC1C
  D8B1  87            		ADD	A,A
  D8B2  D0            		RET	NC
  D8B3                	ESC1C:
  D8B3  E1            		POP	HL
  D8B4  184A          		JR	ANK
                      	
  D8B6                	ESC:
  D8B6  2111D9        		LD	HL,PRINTE5
  D8B9  E5            		PUSH	HL
  D8BA  21DCD8        		LD	HL,ESCFLG+1
  D8BD  3600          		LD	(HL),0
  D8BF  3D            		DEC	A
  D8C0  28A5          		JR	Z,ESC1
  D8C2  3D            		DEC	A
  D8C3  2009          		JR	NZ,ESC2
  D8C5  3603          		LD	(HL),3
  D8C7  7B            		LD	A,E
  D8C8  D620          		SUB	020H
  D8CA  32D1D8        		LD	(ESCYP+1),A
  D8CD  C9            		RET
  D8CE                	ESC2:
  D8CE  3D            		DEC	A
  D8CF  C0            		RET	NZ
  D8D0  2600          	ESCYP:	LD	H,0
  D8D2  7B            		LD	A,E
  D8D3  D620          		SUB	020H
  D8D5  6F            		LD	L,A
  D8D6  C3D6EC        		JP	_LOC
                      	
  D8D9                	PRINT:
  D8D9  C5            		PUSH	BC
  D8DA  E5            		PUSH	HL
  D8DB  3E00          	ESCFLG:	LD	A,000H
  D8DD  B7            		OR	A
  D8DE  20D6          		JR	NZ,ESC
                      	
  D8E0  3E1F          		LD	A,01FH
  D8E2  BB            		CP	E
  D8E3  3030          		JR	NC,CTRL
  D8E5                	PRINTC:
  D8E5  A7            	INSFLG:	AND	A
  D8E6  DCBCDA        		CALL	C,CTRL12
                      	
  D8E9  3E00          	KANFLG:	LD	A,000H
  D8EB  B7            		OR	A
  D8EC  203F          		JR	NZ,KANJI2
  D8EE  7B            	X1KPAT:	LD	A,E
  D8EF  FE80          		CP	080H
  D8F1  380D          		JR	C,ANK
  D8F3  FEA0          		CP	0A0H
  D8F5  3804          		JR	C,KANJI1
  D8F7  FEE0          		CP	0E0H
  D8F9  3805          		JR	C,ANK
  D8FB                	KANJI1:
  D8FB  32EAD8        		LD	(KANFLG+1),A
  D8FE  1811          		JR	PRINTE5
  D900                	ANK:
  D900  ED4B8EEC      		LD	BC,(_TXADR)
  D904  78            		LD	A,B
  D905  F638          		OR	038H
  D907  47            		LD	B,A
  D908  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令	kanji
  D90A  CB98          		RES	3,B
  D90C  ED59          		OUT	(C),E		;Text
  D90E                	KANJIE:
  D90E  CD78D9        		CALL	PRINTE7
  D911                	PRINTE5:
  D911  E1            		POP	HL
  D912  C1            		POP	BC
  D913  AF            		XOR	A
  D914  C9            		RET
                      	
  D915                	CTRL:
  D915  CD5FD9        		CALL	KANCLR
  D918  3EA7          		LD	A,0A7H		;AND	A
  D91A  32E5D8        		LD	(INSFLG),A
  D91D  7B            		LD	A,E
  D91E  87            		ADD	A,A
  D91F  F680          		OR	080H
  D921  6F            		LD	L,A
  D922  26EB          		LD	H,CTRLTB/256
  D924  7E            		LD	A,(HL)
  D925  2C            		INC	L
  D926  66            		LD	H,(HL)
  D927  6F            		LD	L,A
  D928  CD0F00        		CALL	JP_HL
  D92B  18E4          		JR	PRINTE5
                      	
  D92D                	KANJI2:
  D92D  D5            		PUSH	DE
  D92E  57            		LD	D,A
  D92F  01812F        		LD	BC,02F81H	;SFTJIS
  D932  DF            		RST	018H
  D933  01C32F        		LD	BC,02FC3H	;Instead or JISVRM
  D936  DF            		RST	018H
                      	
  D937  ED4B8EEC      		LD	BC,(_TXADR)
  D93B  78            		LD	A,B
  D93C  F638          		OR	038H
  D93E  47            		LD	B,A
  D93F  ED51          		OUT	(C),D		;kanji
  D941  CB98          		RES	3,B
  D943  ED59          		OUT	(C),E		;Text
  D945  CD78D9        		CALL	PRINTE7
  D948  ED4B8EEC      		LD	BC,(_TXADR)
  D94C  78            		LD	A,B
  D94D  F638          		OR	038H
  D94F  47            		LD	B,A
  D950  CBF2          		SET	6,D
  D952  ED51          		OUT	(C),D		;Kanji
  D954  CB98          		RES	3,B
  D956  ED59          		OUT	(C),E		;Text
  D958  D1            		POP	DE
  D959  AF            		XOR	A
  D95A  32EAD8        		LD	(KANFLG+1),A
  D95D  18AF          		JR	KANJIE
                      	
  D95F                	KANCLR:
  D95F  3AEAD8        		LD	A,(KANFLG+1)
  D962  B7            		OR	A
  D963  C8            		RET	Z
  D964  ED4B8EEC      		LD	BC,(_TXADR)
  D968  78            		LD	A,B
  D969  F638          		OR	038H
  D96B  47            		LD	B,A
  D96C  AF            		XOR	A
  D96D  32EAD8        		LD	(KANFLG+1),A
  D970  ED79          		OUT	(C),A		;Kanji
  D972  CB98          		RES	3,B
  D974  3E20          		LD	A,020H
  D976  ED79          		OUT	(C),A		;Text
  D978                	PRINTE7:
  D978  CBA0          		RES	4,B
  D97A                	PRINTE6:
  D97A  3A96EC        		LD	A,(_COLORF)
  D97D                	PRINTE4:
  D97D  ED79          		OUT	(C),A		;Color
  D97F  78            		LD	A,B
  D980  E607          		AND	7
  D982  47            		LD	B,A
  D983                	PRINTE2:
  D983  03            		INC	BC
  D984                	PRINTE3:
  D984  2ABAEC        		LD	HL,(CRTCD+10)
  D987  A7            		AND	A
  D988  ED4A          		ADC	HL,BC
  D98A                	PRINTE8:
  D98A  2805          		JR	Z,PRINT2
  D98C                	PRINTE1:
  D98C  ED438EEC      		LD	(_TXADR),BC
  D990                	PRINTE:
  D990  C9            		RET
                      	
  D991                	PRINT2:
  D991  CD39DB        		CALL	SCR
  D994  2ABCEC        		LD	HL,(CRTCD+12)
  D997  09            		ADD	HL,BC
  D998  228EEC        		LD	(_TXADR),HL
  D99B  C9            		RET
                      	
  D99C                	CTRL08:
  D99C                	CTRL1D:
  D99C  ED4B8EEC      		LD	BC,(_TXADR)
  D9A0  78            		LD	A,B
  D9A1  B1            		OR	C
  D9A2  C8            		RET	Z
  D9A3  0B            		DEC	BC
  D9A4  18E6          		JR	PRINTE1
                      	
  D9A6                	CTRL1E:
  D9A6  ED4B8EEC      		LD	BC,(_TXADR)
  D9AA  2ABCEC        		LD	HL,(CRTCD+12)
  D9AD  09            		ADD	HL,BC
  D9AE  D0            		RET	NC
  D9AF  44            		LD	B,H
  D9B0  4D            		LD	C,L
  D9B1  18D9          		JR	PRINTE1
                      	
  D9B3                	CTRL1C:
  D9B3  ED4B8EEC      		LD	BC,(_TXADR)
  D9B7  18CA          		JR	PRINTE2
                      	
  D9B9                	CTRL09:
  D9B9  ED4B8EEC      		LD	BC,(_TXADR)
  D9BD  79            		LD	A,C
  D9BE  E6F8          		AND	0F8H
  D9C0  C608          		ADD	A,8
  D9C2  4F            		LD	C,A
  D9C3  88            		ADC	A,B
  D9C4  91            		SUB	C
  D9C5  47            		LD	B,A
  D9C6  18BC          		JR	PRINTE3
                      	
  D9C8                	CTRL02:
  D9C8  2A8EEC        		LD	HL,(_TXADR)
  D9CB  7C            		LD	A,H
  D9CC  B5            		OR	L
  D9CD  C8            		RET	Z
  D9CE  2B            		DEC	HL
  D9CF  228EEC        		LD	(_TXADR),HL
  D9D2  D5            		PUSH	DE
  D9D3  CDD3EC        		CALL	_POS
  D9D6  3AB1EC        		LD	A,(CRTCD+1)
  D9D9  95            		SUB	L
  D9DA  6F            		LD	L,A
  D9DB  2D            		DEC	L
  D9DC  2638          		LD	H,038H
  D9DE  ED4B8EEC      		LD	BC,(_TXADR)
  D9E2  09            		ADD	HL,BC
  D9E3  44            		LD	B,H
  D9E4  4D            		LD	C,L
  D9E5  110020        		LD	DE,02000H	;D:Text E:kanji
  D9E8  2A96EC        		LD	HL,(_COLORF)	;L:Color
  D9EB                	C8X1:
  D9EB  CDD8DA        		CALL	C12S
  D9EE  0B            		DEC	BC
  D9EF  20FA          		JR	NZ,C8X1
  D9F1  D1            		POP	DE
  D9F2  C9            		RET
                      	
  D9F3                	CTRL05:
  D9F3  CDD3EC        		CALL	_POS
  D9F6  3AB1EC        		LD	A,(CRTCD+1)
  D9F9  95            		SUB	L
  D9FA  6F            		LD	L,A
  D9FB  2620          		LD	H,020H
  D9FD  ED4B8EEC      		LD	BC,(_TXADR)
  DA01                	C05X1:
  DA01  78            		LD	A,B
  DA02  F638          		OR	038H
  DA04  47            		LD	B,A
  DA05  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令	kanji
  DA07  CB98          		RES	3,B
  DA09  ED61          		OUT	(C),H		;Text
  DA0B  CBA0          		RES	4,B
  DA0D  3A96EC        		LD	A,(_COLORF)
  DA10  ED79          		OUT	(C),A		;Color
  DA12  03            		INC	BC
  DA13  2D            		DEC	L
  DA14  20EB          		JR	NZ,C05X1
  DA16  C9            		RET
                      	
  DA17                	CTRL0D:
  DA17  CDD3EC        		CALL	_POS
  DA1A  2E00          		LD	L,0
  DA1C                	LOC:
  DA1C  C5            		PUSH	BC
  DA1D  E5            		PUSH	HL
  DA1E  CD5FD9        		CALL	KANCLR
  DA21  CD44DA        		CALL	LOC1
  DA24  ED438EEC      		LD	(_TXADR),BC
  DA28  E1            		POP	HL
  DA29  C1            		POP	BC
  DA2A  C9            		RET
                      	
  DA2B                	CTRL01:
  DA2B  3E37          		LD	A,037H		;SCF
  DA2D  32E5D8        		LD	(INSFLG),A
  DA30  C9            		RET
                      	
  DA31                	CTRL0B:
  DA31  210000        		LD	HL,0
  DA34  228EEC        		LD	(_TXADR),HL
  DA37  C9            		RET
                      	
  DA38                	PRINTS:
  DA38  CD9ED7        		CALL	BREAK
  DA3B  C3CDEC        		JP	_PRINT
                      	
  DA3E                	CTRL1B:
  DA3E  3E01          		LD	A,1
  DA40  32DCD8        		LD	(ESCFLG+1),A
  DA43  C9            		RET
                      	
  DA44                	LOC1:
  DA44  44            		LD	B,H
  DA45  4D            		LD	C,L
  DA46  04            		INC	B
  DA47  05            		DEC	B
  DA48  C8            		RET	Z
  DA49  D5            		PUSH	DE
  DA4A  ED5BB1EC      		LD	DE,(CRTCD+1)
  DA4E  210000        		LD	HL,0
  DA51  55            		LD	D,L
  DA52                	LOC2:
  DA52  19            		ADD	HL,DE
  DA53  10FD          		DJNZ	LOC2
  DA55  09            		ADD	HL,BC
  DA56  D1            		POP	DE
  DA57                	LOC3:
  DA57  44            		LD	B,H
  DA58  4D            		LD	C,L
  DA59  C9            		RET
                      	
  DA5A                	CONOUT1:
  DA5A  CD6CDA        		CALL	CURSOR
  DA5D  59            		LD	E,C
  DA5E  CDCDEC        		CALL	_PRINT
  DA61  7B            		LD	A,E
  DA62  FE0A          		CP	00AH
  DA64  2006          		JR	NZ,CURSOR
  DA66  CD17DA        		CALL	CTRL0D
  DA69  CDF3D9        		CALL	CTRL05
  DA6C                	CURSOR:
  DA6C  C5            		PUSH	BC
  DA6D  ED4B8EEC      		LD	BC,(_TXADR)
  DA71  CBE8          		SET	5,B
  DA73  ED78          		IN	A,(C)
  DA75  EE18          		XOR	018H
  DA77  ED79          		OUT	(C),A
  DA79  C1            		POP	BC
  DA7A  C9            		RET
                      	
  DA7B                	CTRL07:
  DA7B  2170EB        		LD	HL,BEEPD
  DA7E                	BEEP1:
  DA7E  7E            		LD	A,(HL)
  DA7F  23            		INC	HL
  DA80  FEFF          		CP	0FFH
  DA82  C8            		RET	Z
  DA83  F3            		DI
  DA84  061C          		LD	B,01CH
  DA86  ED79          		OUT	(C),A
  DA88  EDA3          		OUTI
  DA8A  FB            		EI
  DA8B  18F1          		JR	BEEP1
                      	
  DA8D                	OT49SB:
  DA8D  C5            		PUSH	BC
  DA8E  CDA9DA        		CALL	CANW
  DA91  010019        		LD	BC,01900H
  DA94  ED79          		OUT	(C),A
  DA96  C1            		POP	BC
  DA97  C9            		RET
                      	
  DA98                	IN49SB:
  DA98  C5            		PUSH	BC
  DA99  01011A        		LD	BC,01A01H
  DA9C                	CANR:
  DA9C  ED78          		IN	A,(C)
  DA9E  E620          		AND	020H
  DAA0  20FA          		JR	NZ,CANR
  DAA2  010019        		LD	BC,01900H
  DAA5  ED78          		IN	A,(C)
  DAA7  C1            		POP	BC
  DAA8  C9            		RET
                      	
  DAA9                	CANW:
  DAA9  01011A        		LD	BC,01A01H
  DAAC  ED48          		IN	C,(C)
  DAAE  CB71          		BIT	6,C
  DAB0  20F7          		JR	NZ,CANW
  DAB2  C9            		RET
                      	
  DAB3                	COMOUT:
  DAB3  FB            		EI
  DAB4  CD8DDA        		CALL	OT49SB
  DAB7  CDA9DA        		CALL	CANW
  DABA  F3            		DI
  DABB  C9            		RET
                      	
  DABC                	CTRL12:
  DABC  D5            		PUSH	DE
  DABD  CDD3EC        		CALL	_POS
  DAC0  3AB1EC        		LD	A,(CRTCD+1)
  DAC3  95            		SUB	L
  DAC4  ED4B8EEC      		LD	BC,(_TXADR)
  DAC8  110020        		LD	DE,02000H	;D:Text E:Kanji
  DACB  2A96EC        		LD	HL,(_COLORF)	;L:Color
  DACE  CBE8          		SET	5,B
  DAD0                	C12X1:
  DAD0  CDD8DA        		CALL	C12S
  DAD3  03            		INC	BC
  DAD4  20FA          		JR	NZ,C12X1
  DAD6  D1            		POP	DE
  DAD7  C9            		RET
                      	
  DAD8                	C12S:
  DAD8  CBE0          		SET	4,B
  DADA  CBD8          		SET	3,B
  DADC  ED60          		IN	H,(C)
  DADE  ED59          	X1PAT:	OUT	(C),E
  DAE0  5C            		LD	E,H
  DAE1  CB98          		RES	3,B
  DAE3  ED60          		IN	H,(C)
  DAE5  ED51          		OUT	(C),D
  DAE7  54            		LD	D,H
  DAE8  CBA0          		RES	4,B
  DAEA  ED60          		IN	H,(C)
  DAEC  ED69          		OUT	(C),L
  DAEE  6C            		LD	L,H
  DAEF  3D            		DEC	A
  DAF0  C9            		RET
                      	
  DAF1                	CTRL0C:
  DAF1  CD31DA        		CALL	CTRL0B
  DAF4                	CTRL1A:
  DAF4  ED4B8EEC      		LD	BC,(_TXADR)
  DAF8                	C1AX1:
  DAF8  78            		LD	A,B
  DAF9  F638          		OR	038H
  DAFB  47            		LD	B,A
  DAFC  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令	kanji
  DAFE  CB98          		RES	3,B
  DB00  3E20          		LD	A,020H
  DB02  ED79          		OUT	(C),A		;Text
  DB04  CBA0          		RES	4,B
  DB06  3A96EC        		LD	A,(_COLORF)
  DB09  ED79          		OUT	(C),A		;Color
  DB0B  03            		INC	BC
  DB0C  CBA8          		RES	5,B
  DB0E  2ABAEC        		LD	HL,(CRTCD+10)
  DB11  09            		ADD	HL,BC
  DB12  30E4          		JR	NC,C1AX1
  DB14  C9            		RET
                      	
  DB15                	CTRL04:
  DB15  CDD3EC        		CALL	_POS
  DB18  7D            		LD	A,L
  DB19  B7            		OR	A
  DB1A  C8            		RET	Z
  DB1B                	CTRL03:
  DB1B  CD17DA        		CALL	CTRL0D
  DB1E                	CTRL0A:
  DB1E                	CTRL1F:
  DB1E  ED4B8EEC      		LD	BC,(_TXADR)
  DB22  2AB1EC        		LD	HL,(CRTCD+1)
  DB25  2600          		LD	H,0
  DB27  09            		ADD	HL,BC
  DB28  44            		LD	B,H
  DB29  4D            		LD	C,L
  DB2A  2ABAEC        		LD	HL,(CRTCD+10)
  DB2D  09            		ADD	HL,BC
  DB2E  3F            		CCF
  DB2F  9F            		SBC	A,A
  DB30  C38AD9        		JP	PRINTE8
                      	
  DB33                	CTRL0E:
  DB33  CDD3EC        		CALL	_POS
  DB36  7C            		LD	A,H
  DB37  1804          		JR	SCR1
  DB39                	SCR:
  DB39  3A97EC        		LD	A,(_LINE)
  DB3C  3D            		DEC	A
  DB3D                	SCR1:
  DB3D  C5            		PUSH	BC
  DB3E  D5            		PUSH	DE
  DB3F  F5            		PUSH	AF
  DB40  3E07          		LD	A,7
  DB42  2173DB        		LD	HL,SCRDMAD
  DB45  CD69DB        		CALL	SETDMA
  DB48  F1            		POP	AF
  DB49  210038        		LD	HL,03800H
                      	
  DB4C                	SCRUP1:
  DB4C  B7            		OR	A
  DB4D  284D          		JR	Z,SCRCL
  DB4F  F5            		PUSH	AF
  DB50  CD7ADB        		CALL	UPSUB		;kanji
  DB53  ED5BBCEC      		LD	DE,(CRTCD+12)
  DB57  16F7          		LD	D,0F7H
  DB59  19            		ADD	HL,DE
  DB5A  D5            		PUSH	DE
  DB5B  CD7ADB        		CALL	UPSUB		;Text
  DB5E  D1            		POP	DE
  DB5F  19            		ADD	HL,DE
  DB60  CD7ADB        		CALL	UPSUB		;Color
  DB63  CBE4          		SET	4,H
  DB65  F1            		POP	AF
  DB66  3D            		DEC	A
  DB67  18E3          		JR	SCRUP1
                      	
  DB69                	SETDMA:
  DB69  01871F        		LD	BC,01F87H
  DB6C                	SDMA:
  DB6C  04            		INC	B
  DB6D  EDA3          		OUTI
  DB6F  3D            		DEC	A
  DB70  20FA          		JR	NZ,SDMA
  DB72  C9            		RET
                      	
  DB73                	SCRDMAD:
  DB73  C3            		DB	0C3H		;WR6 リセット
  DB74  9A            		DB	09AH		;WR5 ストップ WAIT READY:HIGH
  DB75  65            		DB	065H		;WR0 ブロック長(LH)
  DB76  4F00          		DW	79
  DB78  1C            		DB	01CH		;WR1 ポートAインクリメント I/O
  DB79  18            		DB	018H		;WR0 ポートAアドレス(LH)
                      	
  DB7A                	UPSUB:
  DB7A  ED5BB1EC      		LD	DE,(CRTCD+1)
  DB7E  1600          		LD	D,0
  DB80  3ECD          		LD	A,0CDH		;WR4 バースト ポートB開始アドレス(LH)
  DB82  ED79          		OUT	(C),A
  DB84  ED69          		OUT	(C),L		;SOURCE
  DB86  ED61          		OUT	(C),H
  DB88  19            		ADD	HL,DE
  DB89  3E1D          		LD	A,01DH		;WR0 ポートA開始アドレス(LH) ポートA→ポートB 転送
  DB8B  ED79          		OUT	(C),A
  DB8D  ED69          		OUT	(C),L		;DEST
  DB8F  ED61          		OUT	(C),H
  DB91                	GO_DMA:
  DB91  3ECF          		LD	A,0CFH
  DB93  ED79          		OUT	(C),A		;WR6 ロード
  DB95  3EB3          		LD	A,0B3H
  DB97  ED79          		OUT	(C),A		;WR6 強制RDY
  DB99  ED49          		OUT	(C),C		;WR6 イネーブル
  DB9B  C9            		RET
                      	
  DB9C                	SCRCL:
  DB9C  44            		LD	B,H
  DB9D  4D            		LD	C,L
  DB9E  215020        		LD	HL,02000H+80
  DBA1  3A96EC        		LD	A,(_COLORF)
  DBA4                	SCRCL1:
  DBA4  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  DBA6  CB98          		RES	3,B
  DBA8  ED61          		OUT	(C),H
  DBAA  CBA0          		RES	4,B
  DBAC  ED79          		OUT	(C),A
  DBAE  CBD8          		SET	3,B
  DBB0  CBE0          		SET	4,B
  DBB2  03            		INC	BC
  DBB3  2D            		DEC	L
  DBB4  20EE          		JR	NZ,SCRCL1
  DBB6  D1            		POP	DE
  DBB7  C1            		POP	BC
  DBB8  C9            		RET
                      	
  DBB9                	SCRN:
  DBB9  D5            		PUSH	DE
  DBBA  ED58          		IN	E,(C)		;Text
  DBBC  CBD8          		SET	3,B
  DBBE  ED50          		IN	D,(C)		;Kanji
  DBC0  2819          		JR	Z,SCRNE
  DBC2  AF            		XOR	A
  DBC3  C5            		PUSH	BC
  DBC4  013730        		LD	BC,03037H	;VRMJIS
  DBC7  DF            		RST	018H
  DBC8  01522F        		LD	BC,02F52H	;JISSFT
  DBCB  DF            		RST	018H
  DBCC  C1            		POP	BC
  DBCD  ED78          		IN	A,(C)
  DBCF  CB98          		RES	3,B
  DBD1  E640          		AND	040H
  DBD3  2003          		JR	NZ,SCRN1
  DBD5  7A            		LD	A,D
  DBD6  D1            		POP	DE
  DBD7  C9            		RET
  DBD8                	SCRN1:
  DBD8  7B            		LD	A,E
  DBD9  D1            		POP	DE
  DBDA  C9            		RET
                      	
  DBDB                	SCRNE:
  DBDB  D1            		POP	DE
  DBDC  CB98          		RES	3,B
  DBDE                	SCRNX:
  DBDE  ED78          		IN	A,(C)
  DBE0  C9            		RET
                      	
  DBE1                	POS:
  DBE1  2A8EEC        		LD	HL,(_TXADR)
  DBE4  C5            		PUSH	BC
  DBE5  ED4BBCEC      		LD	BC,(CRTCD+12)
  DBE9  AF            		XOR	A
  DBEA                	POS1:
  DBEA  09            		ADD	HL,BC
  DBEB  3C            		INC	A
  DBEC  38FC          		JR	C,POS1
  DBEE  ED42          		SBC	HL,BC
  DBF0  3D            		DEC	A
  DBF1  67            		LD	H,A
  DBF2  C1            		POP	BC
  DBF3  A7            		AND	A
  DBF4  C9            		RET
                      	
  DBF5                	GETL:
  DBF5  CDD3EC        		CALL	_POS
  DBF8  E5            		PUSH	HL
  DBF9                	GETL1:
  DBF9  CDD3EC        		CALL	_POS
  DBFC  C1            		POP	BC
  DBFD  C5            		PUSH	BC
  DBFE  7D            		LD	A,L
  DBFF  91            		SUB	C
  DC00  69            		LD	L,C
  DC01  4F            		LD	C,A
  DC02  DCD6EC        		CALL	C,_LOC
  DC05                	GET1W:
  DC05  CD99D7        		CALL	_SYS08
  DC08  FE08          		CP	8
  DC0A  2007          		JR	NZ,GETL1X
  DC0C  0D            		DEC	C
  DC0D  CB79          		BIT	7,C
  DC0F  2002          		JR	NZ,GETL1X
  DC11  3E02          		LD	A,2
  DC13                	GETL1X:
  DC13  FE1B          		CP	01BH
  DC15  2016          		JR	NZ,GETL1V
  DC17  CD99D7        		CALL	_SYS08
  DC1A  FE22          		CP	022H
  DC1C  2008          		JR	NZ,GETL1Y
  DC1E  2100FF        		LD	HL,KBUF
  DC21  CD61D8        		CALL	MSX
  DC24  180E          		JR	GETL1Z
  DC26                	GETL1Y:
  DC26  F5            		PUSH	AF
  DC27  1E1B          		LD	E,01BH
  DC29  CDCDEC        		CALL	_PRINT
  DC2C  F1            		POP	AF
  DC2D                	GETL1V:
  DC2D  5F            		LD	E,A
  DC2E  CD2BDA        		CALL	CTRL01
  DC31  CDCDEC        		CALL	_PRINT
  DC34                	GETL1Z:
  DC34  7B            		LD	A,E
  DC35  FE0D          		CP	00DH
  DC37  20C0          		JR	NZ,GETL1
                      	
  DC39  2100FF        		LD	HL,KBUF
  DC3C  AF            		XOR	A
  DC3D  ED4BB0EC      		LD	BC,(CRTCD)
  DC41                	GETL0:
  DC41  77            		LD	(HL),A
  DC42  23            		INC	HL
  DC43  10FC          		DJNZ	GETL0
                      	
  DC45  D1            		POP	DE
  DC46  CDD3EC        		CALL	_POS
  DC49  6B            		LD	L,E
  DC4A  3AB1EC        		LD	A,(CRTCD+1)
  DC4D  95            		SUB	L
  DC4E  57            		LD	D,A
  DC4F  CD44DA        		CALL	LOC1
  DC52  78            		LD	A,B
  DC53  F630          		OR	030H
  DC55  47            		LD	B,A
  DC56  5A            		LD	E,D
  DC57  2100FF        		LD	HL,KBUF
  DC5A                	GETL2:
  DC5A  CDD0EC        		CALL	_SCRN
  DC5D  03            		INC	BC
  DC5E  77            		LD	(HL),A
  DC5F  23            		INC	HL
  DC60  1D            		DEC	E
  DC61  20F7          		JR	NZ,GETL2
  DC63                	GETL3:
  DC63  2B            		DEC	HL
  DC64  7E            		LD	A,(HL)
  DC65  FE21          		CP	021H
  DC67  D0            		RET	NC
  DC68  3600          		LD	(HL),0
  DC6A  15            		DEC	D
  DC6B  20F6          		JR	NZ,GETL3
  DC6D  C9            		RET
                      	
  DC6E                	INKEY:
  DC6E  FB            		EI
  DC6F  E5            		PUSH	HL
  DC70  2A90EC        		LD	HL,(_KEYPS)
  DC73  7C            		LD	A,H
  DC74  AD            		XOR	L
  DC75  2809          		JR	Z,INKEY1
  DC77  7C            		LD	A,H
  DC78  3C            		INC	A
  DC79  3291EC        		LD	(_KEYPS+1),A
  DC7C  6F            		LD	L,A
  DC7D  26FE          		LD	H,KEYBF/256
  DC7F  7E            		LD	A,(HL)
  DC80                	INKEY1:
  DC80  E1            		POP	HL
  DC81  B7            		OR	A
  DC82  C9            		RET
                      	
  1129                	AT_RS	EQU	SCR1-AT_SCR1
                      	
                      	;LDFILE.ASM
                      	
                      	;	LSX-Dodgers FILE
                      	
  DC83                	FILEC:
  DC83  CD8EDC        		CALL	FILE
  DC86                	FILEC2:
  DC86  3ADC00        		LD	A,(FDRV+1)
  DC89  FE20          		CP	020H
  DC8B  C8            		RET	Z
  DC8C  1839          		JR	SETDIR1
                      	
  DC8E                	FILE:
  DC8E  AF            		XOR	A
  DC8F  32DB00        		LD	(FDRV),A
  DC92  67            		LD	H,A
  DC93  6F            		LD	L,A
  DC94  22E900        		LD	(FDRV+14),HL
  DC97  CD66DD        		CALL	SPCUT
  DC9A  CD4BDD        		CALL	CCHK3
  DC9D  2812          		JR	Z,DEVI1
  DC9F  13            		INC	DE
  DCA0  1A            		LD	A,(DE)
  DCA1  1B            		DEC	DE
  DCA2  FE3A          		CP	':'
  DCA4  200B          		JR	NZ,DEVI1
  DCA6  1A            		LD	A,(DE)		;DRIVE
  DCA7  CDB0DF        		CALL	CAP
  DCAA  D640          		SUB	'@'
  DCAC  13            		INC	DE
  DCAD  13            		INC	DE
  DCAE  32DB00        		LD	(FDRV),A
  DCB1                	DEVI1:
  DCB1  1A            		LD	A,(DE)
  DCB2  D65C          		SUB	05CH		;\
  DCB4  2009          		JR	NZ,NOROOT
  DCB6  6F            		LD	L,A		;A=0でH=0のはずなのでHL=0
  DCB7  22F500        		LD	(FDRV+26),HL
  DCBA  2C            		INC	L
  DCBB  22E900        		LD	(FDRV+14),HL
  DCBE  13            		INC	DE
  DCBF                	NOROOT:
                      	
  DCBF                	SETDIR:
  DCBF  CDEBDC        		CALL	FILED
  DCC2  1A            		LD	A,(DE)
  DCC3  FE5C          		CP	05CH		;\
  DCC5  C0            		RET	NZ
  DCC6  13            		INC	DE
  DCC7                	SETDIR1:
  DCC7  3E10          		LD	A,010H		;Directory
  DCC9  32E800        		LD	(FDRV+13),A
  DCCC  D5            		PUSH	DE
  DCCD  11DB00        		LD	DE,FDRV
  DCD0  2A1EEC        		LD	HL,(STABLE+2*00FH)
  DCD3  CD0F00        		CALL	JP_HL
  DCD6  D1            		POP	DE
  DCD7  B7            		OR	A
  DCD8  C0            		RET	NZ
                      	
  DCD9  3AE800        		LD	A,(FDRV+13)
  DCDC  CB67          		BIT	4,A
  DCDE  C8            		RET	Z
                      	
  DCDF  CD32DD        		CALL	FILEI
  DCE2  2AF500        		LD	HL,(FDRV+26)
  DCE5  23            		INC	HL
  DCE6  22E900        		LD	(FDRV+14),HL
  DCE9  18D4          		JR	SETDIR
                      	
  DCEB                	FILED:
  DCEB  CD32DD        		CALL	FILEI
                      	
  DCEE  0608          		LD	B,8
  DCF0                	FILE2:
  DCF0  CD40DD        		CALL	CCHKF
  DCF3  C8            		RET	Z
  DCF4  FE2A          		CP	'*'
  DCF6  282E          		JR	Z,FILE9
  DCF8  FE2E          		CP	'.'
  DCFA  280C          		JR	Z,FILE4
  DCFC  77            		LD	(HL),A
  DCFD  23            		INC	HL
  DCFE  10F0          		DJNZ	FILE2
                      	
  DD00                	FILE3:
  DD00  CD40DD        		CALL	CCHKF
  DD03  C8            		RET	Z
  DD04  FE2E          		CP	'.'
  DD06  20F8          		JR	NZ,FILE3
                      	
  DD08                	FILE4:
  DD08  21E400        		LD	HL,FNAME+8
  DD0B  0603          		LD	B,3
                      	
  DD0D                	FILE4L:
  DD0D  CD40DD        		CALL	CCHKF
  DD10  C8            		RET	Z
  DD11  FE2E          		CP	'.'
  DD13  2008          		JR	NZ,FILE12
  DD15  32DC00        		LD	(FNAME),A	;Parent directory(..)
  DD18  32DD00        		LD	(FNAME+1),A
  DD1B  3E20          		LD	A,020H
  DD1D                	FILE12:
  DD1D  FE2A          		CP	'*'
  DD1F  280A          		JR	Z,FILE10
  DD21  77            		LD	(HL),A
  DD22  23            		INC	HL
  DD23  10E8          		DJNZ	FILE4L
  DD25  C9            		RET
                      	
  DD26                	FILE9:				;名前の*処理、名前の残りを?で埋める
  DD26  CD2BDD        		CALL	FILE10
  DD29  18D5          		JR	FILE3
                      	
  DD2B                	FILE10:
  DD2B  3E3F          		LD	A,'?'
                      	
  DD2D                	FILL_MEMORY:				;HLからBバイトAで埋める
  DD2D  77            		LD	(HL),A
  DD2E  23            		INC	HL
  DD2F  10FC          		DJNZ	FILL_MEMORY
  DD31  C9            		RET
                      	
  DD32                	FILEI:				;名前＋拡張子をスペースで初期化
  DD32  3E20          		LD	A,020H
  DD34  01000B        		LD	BC,11*256
  DD37  21DC00        		LD	HL,FNAME
  DD3A  E5            		PUSH	HL
  DD3B  CD2DDD        		CALL	FILL_MEMORY
  DD3E  E1            		POP	HL
  DD3F  C9            		RET
                      	
  DD40                	CCHKF:
  DD40  1A            		LD	A,(DE)
  DD41  CD48DD        		CALL	CCHK2
  DD44  C8            		RET	Z
  DD45  C3CEE0        		JP	FKAN
                      	
  DD48                	CCHK2:
  DD48  0C            		INC	C
  DD49  0D            		DEC	C
  DD4A  C0            		RET	NZ
  DD4B                	CCHK3:				;ZF=1 で使えない文字
  DD4B  FE2B          		CP	'+'
  DD4D  C8            		RET	Z
  DD4E  FE2C          		CP	','
  DD50  C8            		RET	Z
  DD51  FE2F          		CP	'/'
  DD53  C8            		RET	Z
  DD54  FE3A          		CP	':'
  DD56  C8            		RET	Z
  DD57  FE3B          		CP	';'
  DD59  C8            		RET	Z
  DD5A  FE3D          		CP	'='
  DD5C  C8            		RET	Z
  DD5D  FE5C          		CP	05CH	;\
  DD5F  C8            		RET	Z
  DD60  FE20          		CP	020H
  DD62  D0            		RET	NC
  DD63  BF            		CP	A		;Z=1
  DD64  C9            		RET
                      	
  DD65                	SS1:
  DD65  13            		INC	DE
  DD66                	SPCUT:				;スペースをカット
  DD66  1A            		LD	A,(DE)
  DD67  FE20          		CP	020H
  DD69  28FA          		JR	Z,SS1
  DD6B  C9            		RET
                      	
  DD6C                	SETDRVF:
  DD6C  11DB00        		LD	DE,FDRV
  DD6F                	SETDRV0:
  DD6F  CD78DD        		CALL	SETDRV
  DD72  FDE1          		POP	IY
  DD74  C1            		POP	BC
  DD75  D1            		POP	DE
  DD76  E1            		POP	HL
  DD77  C9            		RET
                      	
  DD78                	SETDRV:
  DD78  E3            		EX	(SP),HL		;HL=RETRN ADDRESS
  DD79  D5            		PUSH	DE		;PUSH HL/DE/BC/IY
  DD7A  C5            		PUSH	BC
  DD7B  1A            		LD	A,(DE)
  DD7C  D5            		PUSH	DE
  DD7D  FDE3          		EX	(SP),IY
                      	
  DD7F  CD8BDD        		CALL	GETDRV
  DD82  3C            		INC	A
  DD83  FD7700        		LD	(IY+0),A	;(FCB)ドライブ番号
  DD86  3D            		DEC	A
  DD87  CDD9EC        		CALL	_CHGDRV
                      	
  DD8A  E9            		JP	(HL)
                      	
  DD8B                	GETDRV:
  DD8B  E67F          		AND	07FH
  DD8D  D601          		SUB	001H
  DD8F  3003          		JR	NC,GETDRV1
  DD91  3A87EC        		LD	A,(_DVSW)	;Current Drive
  DD94                	GETDRV1:
  DD94  3288EC        		LD	(_DRV),A
  DD97  C9            		RET
                      	
  DD98                	SOPENX:
  DD98  CD18DF        		CALL	CHKDDX
  DD9B  3802          		JR	C,SOPENX1
  DD9D  C1            		POP	BC
  DD9E  E9            		JP	(HL)
  DD9F                	SOPENX1:
  DD9F  117AE2        		LD	DE,SFILE
  DDA2  1A            		LD	A,(DE)
  DDA3  FDBE00        		CP	(IY+0)		;(FCB)ドライブ番号
  DDA6  2024          		JR	NZ,SOPEN
  DDA8  13            		INC	DE
  DDA9  FDE5          		PUSH	IY
  DDAB  E1            		POP	HL
  DDAC  23            		INC	HL
  DDAD  CD48DF        		CALL	CPFILE
  DDB0  201A          		JR	NZ,SOPEN
                      	
  DDB2  2AF4EB        		LD	HL,(SCDIR)
  DDB5  FD750E        		LD	(IY+14),L	;(FCB)アクセスするディレクトリのクラスタ番号+1
  DDB8  FD740F        		LD	(IY+15),H
                      	
  DDBB  2AF8EB        		LD	HL,(SFNDF)	;Direcroty location and Flags
  DDBE  229FEC        		LD	(_FILEN),HL
                      	
  DDC1  ED5BF6EB      		LD	DE,(SFBPS)
  DDC5  217AE2        		LD	HL,SFILE
  DDC8  36FF          		LD	(HL),0FFH
  DDCA  23            		INC	HL
  DDCB  C9            		RET
  DDCC                	SOPEN:
  DDCC  21E0DE        		LD	HL,FILESE
  DDCF                	SOPENC:
  DDCF  2208DE        		LD	(OPENPAT+1),HL
                      	
  DDD2  CDE2EC        		CALL	_RDFATX		;Detect Media
  DDD5  3856          		JR	C,RDDERR
                      	
  DDD7  AF            		XOR	A
  DDD8  329FEC        		LD	(_FILEN),A
  DDDB  CDF5DF        		CALL	LDDIRX1		;A=0で呼び出す
  DDDE  2818          		JR	Z,SDIRX1
                      	
  DDE0  CDD1DE        		CALL	READ_DIR	;Sub Directory
  DDE3  3808          		JR	C,SDIRX0
  DDE5  2A7EEC        		LD	HL,(_DTBUF)
  DDE8  7E            		LD	A,(HL)
  DDE9  FE2E          		CP	'.'
  DDEB  280F          		JR	Z,SOPEN1
  DDED                	SDIRX0:
  DDED  AF            		XOR	A
  DDEE  32A0EC        		LD	(_DIRF),A
  DDF1  FD360E01      		LD	(IY+14),1	;(FCB)レコード・サイズ
  DDF5  FD770F        		LD	(IY+15),A
  DDF8                	SDIRX1:
  DDF8  ED5BFCEB      		LD	DE,(_DIRPS)	;Root Directory
  DDFC                	SOPEN1:
  DDFC  0E20          	SDECPAT:LD	C,32		;自己書き換え 1セクタ辺りのディレクトリエントリ数  1024=32 / 512=16
  DDFE                	SOPEN1X:
  DDFE  CDD1DE        		CALL	READ_DIR	;FILE SEARCH
  DE01  382A          		JR	C,RDDERR
  DE03  2A7EEC        		LD	HL,(_DTBUF)
  DE06                	SOPEN2:
  DE06  D5            		PUSH	DE
  DE07  CDE0DE        	OPENPAT:CALL	FILESE		;(Self-rewriting)
  DE0A  D1            		POP	DE
  DE0B  386E          		JR	C,SOPENE
  DE0D  281B          		JR	Z,NOTSE
  DE0F                	SOPEN3:
  DE0F  3AA0EC        		LD	A,(_DIRF)	;ディレクトリか判別
  DE12  B7            		OR	A
  DE13  200C          		JR	NZ,SOPEN5
  DE15  13            		INC	DE		;ルートディレクトリ
  DE16  E5            		PUSH	HL
  DE17  210C00        	MD_PAT:	LD	HL,12		;(Self-rewriting)MAXDIR
  DE1A  ED52          		SBC	HL,DE		;CF=0 なので SUB HL,DE
  DE1C  E1            		POP	HL
  DE1D  20DD          		JR	NZ,SOPEN1
  DE1F  1807          		JR	SOPEN6
  DE21                	SOPEN5:
  DE21  CDE6E6        		CALL	GNCLX		;END DIR
  DE24  D8            		RET	C
  DE25  CDA8DF        		CALL	ENDCL
  DE28                	SOPEN6:
  DE28  38D2          		JR	C,SOPEN1
  DE2A                	NOTSE:
  DE2A  37            		SCF			;CF=1
  DE2B  9F            		SBC	A,A		;A=0FFH
  DE2C  C9            		RET
                      	
  DE2D                	RDDERR:
  DE2D  BF            		CP	A		;READ ERR CF=1 ZF=1
  DE2E  37            		SCF
  DE2F  C9            		RET
                      	
  DE30                	NOPEN:
  DE30  21E0DE        		LD	HL,FILESE
  DE33  2208DE        		LD	(OPENPAT+1),HL
  DE36  FD2A98EC      		LD	IY,(_FCB)
  DE3A  CDE1E0        		CALL	CHKWILDX
  DE3D  30EB          		JR	NC,NOTSE
  DE3F  FD7E00        		LD	A,(IY+0)	;(FCB)ドライブ番号
  DE42  3D            		DEC	A
  DE43  3288EC        		LD	(_DRV),A
  DE46  CDD9EC        		CALL	_CHGDRV
  DE49  D8            		RET	C
  DE4A  2AF8EB        		LD	HL,(SFNDF)	;Direcroty location and Flags
  DE4D  229FEC        		LD	(_FILEN),HL
                      	
  DE50  CDF0DF        		CALL	LDDIRX
  DE53  ED5B9AEC      		LD	DE,(_FBPS)
  DE57  CDD1DE        		CALL	READ_DIR
  DE5A  38D1          		JR	C,RDDERR
  DE5C  3A9EEC        		LD	A,(_FBCNT)
  DE5F  3D            		DEC	A
  DE60  28AD          		JR	Z,SOPEN3
  DE62                	NOPEN2:
  DE62  2A9CEC        		LD	HL,(_FBAD)
  DE65  012000        		LD	BC,020H
  DE68  09            		ADD	HL,BC
  DE69  4F            		LD	C,A
  DE6A  189A          		JR	SOPEN2
                      	
  DE6C                	SOPENE2:
  DE6C  229CEC        		LD	(_FBAD),HL
  DE6F  79            		LD	A,C
  DE70  329EEC        		LD	(_FBCNT),A
  DE73  ED539AEC      		LD	(_FBPS),DE
  DE77  FD2298EC      		LD	(_FCB),IY
  DE7B                	SOPENE:
  DE7B  AF            		XOR	A
  DE7C  C9            		RET
                      	
  DE7D                	COPEN:
  DE7D  FD360D20      		LD	(IY+13),020H	;(FCB)属性(アトリビュート)
                      	
  DE81  21FDDE        		LD	HL,NEXTSE
  DE84  CDCFDD        		CALL	SOPENC
  DE87  D0            		RET	NC
  DE88  C8            		RET	Z
  DE89  3AA0EC        		LD	A,(_DIRF)	;ディレクトリか判別
  DE8C  B7            		OR	A
  DE8D  37            		SCF
  DE8E  C8            		RET	Z		;ルートディレクトリ
  DE8F  0601          		LD	B,1
  DE91  CD3DE1        		CALL	WRDF
  DE94  D8            		RET	C
  DE95  ED5BFEEB      		LD	DE,(_CLPS)
  DE99  D5            		PUSH	DE
  DE9A  CD71DF        		CALL	DCPAT
  DE9D  CD7DE5        		CALL	DRDNX
  DEA0  2A7EEC        		LD	HL,(_DTBUF)	;ディレクトリエントリを0クリア
  DEA3  5D            		LD	E,L
  DEA4  54            		LD	D,H
  DEA5  13            		INC	DE		;DE,DTBUF+1
  DEA6  01FF03        	SECSZM1:LD	BC,003FFH	;自己書き換え セクタサイズ-1(0x3FF:1023 or 0x1FF:511 or 0xFF:255)
  DEA9  AF            		XOR	A		;データバッファをセクタサイズ分ゼロクリア
  DEAA  77            		LD	(HL),A
  DEAB  EDB0          		LDIR
                      	
  DEAD  D1            		POP	DE		;DE=(_CLPS)
  DEAE  D5            		PUSH	DE
  DEAF  3A8FDF        		LD	A,(SPCPAT+1)	;1クラスタの論理セクタ数
  DEB2  3D            		DEC	A
  DEB3  2817          		JR	Z,COPENE
  DEB5  3E01          		LD	A,1		;1セクタ辺りのセクタ数が2以上の場合
  DEB7  32DEE6        		LD	(_SECPS+1),A
  DEBA                	COPEN1:
  DEBA  D5            		PUSH	DE		;データバッファに入らないセクタもゼロクリア
  DEBB  C5            		PUSH	BC
  DEBC  2A7EEC        		LD	HL,(_DTBUF)
  DEBF  CD8BDF        		CALL	CLUSTX
  DEC2  CD4FE8        		CALL	DWT24
  DEC5  C1            		POP	BC
  DEC6  D1            		POP	DE
  DEC7  CDDDE6        		CALL	NEXTX
  DECA  20EE          		JR	NZ,COPEN1
  DECC                	COPENE:
  DECC  2A7EEC        		LD	HL,(_DTBUF)
  DECF  D1            		POP	DE
  DED0  C9            		RET
                      	
  DED1                	READ_DIR:
  DED1  ED53FEEB      		LD	(_CLPS),DE
  DED5  C5            		PUSH	BC
  DED6  D5            		PUSH	DE
  DED7  CD71DF        		CALL	DCPAT
  DEDA  CD5DE5        		CALL	DRDX
  DEDD  D1            		POP	DE
  DEDE  C1            		POP	BC
  DEDF  C9            		RET
                      	
  DEE0                	FILESE:
  DEE0  7E            		LD	A,(HL)
  DEE1  B7            		OR	A
  DEE2  C8            		RET	Z		;END:ZF=1 CF=0
  DEE3  FEE5          		CP	0E5H
  DEE5  280E          		JR	Z,FILESE1
  DEE7  FDE5          		PUSH	IY
  DEE9  D1            		POP	DE
  DEEA  13            		INC	DE
  DEEB  E5            		PUSH	HL
  DEEC  CD48DF        		CALL	CPFILE
  DEEF  CC69DF        		CALL	Z,CPFILE2
  DEF2  E1            		POP	HL
  DEF3  37            		SCF
  DEF4  C8            		RET	Z		;!!!:(ZF=1) CF=1
  DEF5                	FILESE1:
  DEF5  CD0CDF        		CALL	FNEXT
  DEF8  20E6          		JR	NZ,FILESE
  DEFA                	ZF0_CF0_AFF_RET:
  DEFA  F6FF          		OR	0FFH		;ZF=0 CF=0
  DEFC  C9            		RET
                      	
  DEFD                	NEXTSE:
  DEFD  7E            		LD	A,(HL)
  DEFE  B7            		OR	A
  DEFF  37            		SCF
  DF00  C8            		RET	Z		;!!!:ZF=1 CF=1
  DF01  FEE5          		CP	0E5H
  DF03  37            		SCF
  DF04  C8            		RET	Z		;!!!:(ZF=1) CF=1
  DF05  CD0CDF        		CALL	FNEXT
  DF08  20F3          		JR	NZ,NEXTSE
  DF0A  18EE          		JR	ZF0_CF0_AFF_RET
                      	
  DF0C                	FNEXT:
  DF0C  E5            		PUSH	HL
  DF0D  219FEC        		LD	HL,_FILEN
  DF10  34            		INC	(HL)
  DF11  E1            		POP	HL
  DF12  112000        		LD	DE,020H
  DF15  19            		ADD	HL,DE
  DF16  0D            		DEC	C
  DF17  C9            		RET
                      	
  DF18                	CHKDDX:
  DF18  CDE1E0        		CALL	CHKWILDX
  DF1B  D8            		RET	C
  DF1C  FDE5          		PUSH	IY
  DF1E  D1            		POP	DE
  DF1F  13            		INC	DE
  DF20  2162EC        		LD	HL,DDTB
  DF23  0604          		LD	B,DDS
  DF25                	CPNAME:
  DF25  C5            		PUSH	BC
  DF26  D5            		PUSH	DE
  DF27  1152E5        		LD	DE,CPBUF
  DF2A  010400        		LD	BC,4
  DF2D  EDB0          		LDIR
  DF2F  D1            		POP	DE
  DF30  D5            		PUSH	DE
  DF31  E5            		PUSH	HL
  DF32  2152E5        		LD	HL,CPBUF
  DF35  CD48DF        		CALL	CPFILE
  DF38  E1            		POP	HL
  DF39  D1            		POP	DE
  DF3A  C1            		POP	BC
  DF3B  2005          		JR	NZ,CPNAME1
  DF3D  7E            		LD	A,(HL)
  DF3E  23            		INC	HL
  DF3F  66            		LD	H,(HL)
  DF40  6F            		LD	L,A
  DF41  C9            		RET
  DF42                	CPNAME1:
  DF42  23            		INC	HL
  DF43  23            		INC	HL
  DF44  10DF          		DJNZ	CPNAME
  DF46  37            		SCF
  DF47  C9            		RET
                      	
  DF48                	CPFILE:
  DF48  C5            		PUSH	BC
  DF49  01000B        		LD	BC,00B00H
  DF4C                	CPSTR1:
  DF4C  1A            		LD	A,(DE)
  DF4D  FE3F          		CP	'?'		;Wild card
  DF4F  2812          		JR	Z,CPSTR2
  DF51  7E            		LD	A,(HL)
  DF52  CDC7E0        		CALL	FKANC
  DF55  E5            		PUSH	HL
  DF56  67            		LD	H,A
  DF57  1A            		LD	A,(DE)
  DF58  CB01          		RLC	C
  DF5A  CDC7E0        		CALL	FKANC
  DF5D  CB09          		RRC	C
  DF5F  BC            		CP	H		;CP (HL),(DE)
  DF60  E1            		POP	HL
  DF61  2004          		JR	NZ,CPSTR3
  DF63                	CPSTR2:
  DF63  13            		INC	DE
  DF64  23            		INC	HL
  DF65  10E5          		DJNZ	CPSTR1
  DF67                	CPSTR3:
  DF67  C1            		POP	BC
  DF68  C9            		RET
                      	
  DF69                	CPFILE2:
  DF69  FD7E0D        		LD	A,(IY+13)	;(FCB)属性(アトリビュート)
  DF6C  F6E1          		OR	0E1H
  DF6E  2F            		CPL
  DF6F  A6            		AND	(HL)
  DF70  C9            		RET
                      	
  DF71                	DCPAT:
  DF71  0E00          		LD	C,0
  DF73  2A7EEC        		LD	HL,(_DTBUF)
  DF76  3AA0EC        		LD	A,(_DIRF)	;ディレクトリか判別
  DF79  B7            		OR	A
  DF7A  C8            		RET	Z		;ルートディレクトリの場合はCレジスタを0にしておく(CDEがセクタ番号)
  DF7B  3A8FDF        		LD	A,(SPCPAT+1)
  DF7E  4F            		LD	C,A
  DF7F  3ADEE6        		LD	A,(_SECPS+1)
  DF82  B9            		CP	C
  DF83  3001          		JR	NC,DC1
  DF85  AF            		XOR	A
  DF86                	DC1:
  DF86  F680          		OR	080H
  DF88  32A0EC        		LD	(_DIRF),A	;bit0-6:セクタインデックス
  DF8B                	CLUSTX:
  DF8B  E5            		PUSH	HL
  DF8C  EB            		EX	DE,HL
  DF8D  AF            		XOR	A
  DF8E  0E01          	SPCPAT:	LD	C,1		;自己書き換え（1クラスタの論理セクタ数）
  DF90                	L_CLDBL:
  DF90  CB19          		RR	C		;->CF
  DF92  3804          		JR	C,E_CLDBL
  DF94  29            		ADD	HL,HL		;*2
  DF95  8F            		ADC	A,A
  DF96  18F8          		JR	L_CLDBL
  DF98                	E_CLDBL
  DF98  4F            		LD	C,A
  DF99  3ADEE6        		LD	A,(_SECPS+1)
  DF9C  B5            		OR	L
  DF9D  6F            		LD	L,A
  DF9E  110800        	CLSPAT:	LD	DE,8	;+8 (2D)  !ADDCL (Self-rewriting)
  DFA1  AF            		XOR	A
  DFA2  19            		ADD	HL,DE	;データ格納領域の先頭論理セクタ番号
  DFA3  89            		ADC	A,C
  DFA4  4F            		LD	C,A
  DFA5  EB            		EX	DE,HL
  DFA6  E1            		POP	HL
  DFA7  C9            		RET
                      	
  DFA8                	ENDCL:
  DFA8  7A            		LD	A,D	;END CLUSTER
  DFA9  FE01          	CLPAT1:	CP	1	;164=356	(Self-rewriting)
  DFAB  C0            		RET	NZ
  DFAC  7B            		LD	A,E
  DFAD  FE64          	CLPAT2:	CP	064H	;		(Self-rewriting)
  DFAF  C9            		RET
                      	
  DFB0                	CAP:
  DFB0  FE61          		CP	'a'
  DFB2  D8            		RET	C
  DFB3  FE7B          		CP	'z'+1
  DFB5  D0            		RET	NC
  DFB6  D620          		SUB	020H
  DFB8  C9            		RET
  DFB9                	CAP2:
  DFB9  CDB0DF        		CALL	CAP
  DFBC                	CAP3:
  DFBC  CDC5DF        		CALL	CAP4
  DFBF  FE21          		CP	021H
  DFC1  D0            		RET	NC
  DFC2  3EA0          		LD	A,0A0H
  DFC4  C9            		RET
  DFC5                	CAP4:
  DFC5  FE05          		CP	5
  DFC7  C0            		RET	NZ
  DFC8  3EE5          		LD	A,0E5H
  DFCA  C9            		RET
                      	
  DFCB                	CHDIR:
  DFCB  CDA3E9        		CALL	GETDPBD
  DFCE  381D          		JR	C,CHDIR2
  DFD0  DD751A        		LD	(IX+01AH),L		;_SDIR_
  DFD3  DD741B        		LD	(IX+01BH),H		;_SDIR_+1
  DFD6  1815          		JR	CHDIR2		;POP_IX_RET
                      	
  DFD8                	LDDIR:
  DFD8  CDA3E9        		CALL	GETDPBD
  DFDB  DD5E1A        		LD	E,(IX+01AH)		;_SDIR_
  DFDE  DD561B        		LD	D,(IX+01BH)		;_SDIR_+1
  DFE1  13            		INC	DE
  DFE2  FD730E        		LD	(IY+14),E	;(FCB)アクセスするディレクトリのクラスタ番号+1
  DFE5  FD720F        		LD	(IY+15),D
  DFE8  1B            		DEC	DE
  DFE9  AF            		XOR	A
  DFEA  32A0EC        		LD	(_DIRF),A
  DFED                	CHDIR2:
  DFED  DDE1          		POP	IX
  DFEF  C9            		RET
                      	
  DFF0                	LDDIRX:
  DFF0  3AA0EC        		LD	A,(_DIRF)	;(FCB)アクセスするディレクトリのセクタインデックス
  DFF3  E67F          		AND	07FH
  DFF5                	LDDIRX1:
  DFF5  32DEE6        		LD	(_SECPS+1),A
  DFF8  FD5E0E        		LD	E,(IY+14)	;(FCB)アクセスするディレクトリのクラスタ番号+1
  DFFB  FD560F        		LD	D,(IY+15)
  DFFE  1B            		DEC	DE
  DFFF  CDA8DF        		CALL	ENDCL
  E002  D4D8DF        		CALL	NC,LDDIR
  E005                	LDDIRS:
  E005  7A            		LD	A,D
  E006  B3            		OR	E
  E007  32A0EC        		LD	(_DIRF),A	;ディレクトリか判別
  E00A  C9            		RET
                      	
  E00B                	KILL:
  E00B  CDE1E0        		CALL	CHKWILDX
  E00E  383A          		JR	C,KILLW
  E010  CD18DF        		CALL	CHKDDX
  E013  3F            		CCF
  E014  D49FDD        		CALL	NC,SOPENX1
  E017                	KILLS:
  E017  3E1F          		LD	A,01FH
  E019  D45DE0        		CALL	NC,CHKATT
  E01C  D8            		RET	C
  E01D                	KILLSX:
  E01D  36E5          		LD	(HL),0E5H	;DIR
  E01F  CDBBE0        		CALL	WTDB
  E022  111A00        		LD	DE,01AH
  E025  19            		ADD	HL,DE
  E026  5E            		LD	E,(HL)
  E027  23            		INC	HL
  E028  56            		LD	D,(HL)
  E029  1804          		JR	KILLS2
  E02B                	KILLS1:
  E02B  ED5BFEEB      		LD	DE,(_CLPS)	;FAT
  E02F                	KILLS2:
  E02F  CDA8DF        		CALL	ENDCL
  E032  D0            		RET	NC		;CF=0
  E033  21FEFF        		LD	HL,0-2
  E036  19            		ADD	HL,DE
  E037  D0            		RET	NC		;DE= 0 or 1
  E038  D5            		PUSH	DE
  E039  CDF7EC        		CALL	_GNCL
  E03C  ED53FEEB      		LD	(_CLPS),DE
  E040  D1            		POP	DE
  E041  210000        		LD	HL,0
  E044  D4FAEC        		CALL	NC,_SNCL
  E047  30E2          		JR	NC,KILLS1
  E049  C9            		RET
                      	
  E04A                	KILLW:
  E04A  CDCCDD        		CALL	SOPEN
  E04D                	KILLW1:
  E04D  380B          		JR	C,KILLW2
  E04F  CD6CDE        		CALL	SOPENE2
  E052  CD17E0        		CALL	KILLS
  E055  CD30DE        		CALL	NOPEN
  E058  18F3          		JR	KILLW1
  E05A                	KILLW2:
  E05A  C8            		RET	Z
  E05B  3F            		CCF
  E05C  C9            		RET
                      	
  E05D                	CHKATT:
  E05D  E5            		PUSH	HL
  E05E  110B00        		LD	DE,00BH
  E061  19            		ADD	HL,DE
  E062  A6            		AND	(HL)
  E063  E1            		POP	HL
  E064  C8            		RET	Z
  E065  37            		SCF
  E066  C9            		RET
                      	
  E067                	NAME:
  E067  CDE1E0        		CALL	CHKWILDX
  E06A  D8            		RET	C
  E06B  110400        		LD	DE,4
  E06E  19            		ADD	HL,DE
  E06F  2287E0        		LD	(NAMEP+2),HL
  E072  23            		INC	HL
  E073  CDE5E0        		CALL	CHKWILD
  E076  D8            		RET	C
                      	
  E077  CD9FDD        		CALL	SOPENX1
  E07A  3E0F          		LD	A,00FH
  E07C  D45DE0        		CALL	NC,CHKATT
  E07F  D8            		RET	C
                      	
  E080  FD7E00        		LD	A,(IY+0)
  E083  FDE5          		PUSH	IY
  E085  FD210000      	NAMEP:	LD	IY,0
  E089  FD7700        		LD	(IY+0),A
  E08C  CD9FDD        		CALL	SOPENX1
  E08F  FDE3          		EX	(SP),IY
  E091  3F            		CCF
  E092  D4CCDD        		CALL	NC,SOPEN
  E095  EB            		EX	DE,HL
  E096  E1            		POP	HL
  E097  D8            		RET	C
                      	
  E098                	SETNAME:
  E098  01000B        		LD	BC,11*256
  E09B  23            		INC	HL
  E09C  7E            		LD	A,(HL)
  E09D  FEE5          		CP	0E5H
  E09F  2004          		JR	NZ,SNAME1
  E0A1  3E05          		LD	A,5
  E0A3  180E          		JR	SNAME3
  E0A5                	SNAME1:
  E0A5  7E            		LD	A,(HL)
  E0A6  0C            		INC	C
  E0A7  0D            		DEC	C
  E0A8  2009          		JR	NZ,SNAME3
  E0AA  CDB0DF        		CALL	CAP
  E0AD  FEA0          		CP	0A0H
  E0AF  2002          		JR	NZ,SNAME3
  E0B1  3E20          		LD	A,020H
  E0B3                	SNAME3:
  E0B3  12            		LD	(DE),A
  E0B4  7E            		LD	A,(HL)
  E0B5  23            		INC	HL
  E0B6  CDCEE0        		CALL	FKAN
  E0B9  10EA          		DJNZ	SNAME1
  E0BB                	WTDB:
  E0BB  3EFF          		LD	A,0FFH
  E0BD  327AE2        		LD	(SFILE),A
  E0C0                	SWTDBF:
  E0C0  3E01          		LD	A,1
  E0C2  32A4EC        		LD	(_WTDBF),A
  E0C5  AF            		XOR	A
  E0C6  C9            		RET
                      	
  E0C7                	FKANC:
  E0C7  CB41          		BIT	0,C
  E0C9  CCB9DF        		CALL	Z,CAP2
  E0CC  1801          		JR	FKANX
  E0CE                	FKAN:			;漢字チェック
  E0CE  13            		INC	DE
  E0CF                	FKANX:
  E0CF  CB41          		BIT	0,C
  E0D1  CB81          		RES	0,C
  E0D3  C0            		RET	NZ
  E0D4  FE80          		CP	080H
  E0D6  D8            		RET	C
  E0D7  FEA0          		CP	0A0H
  E0D9  3803          		JR	C,FKAN1
  E0DB  FEE0          		CP	0E0H
  E0DD  D8            		RET	C
  E0DE                	FKAN1:
  E0DE  0C            		INC	C
  E0DF  A7            		AND	A
  E0E0  C9            		RET
                      	
  E0E1                	CHKWILDX:
  E0E1  FDE5          		PUSH	IY
  E0E3  E1            		POP	HL
  E0E4  23            		INC	HL
  E0E5                	CHKWILD:
  E0E5  060B          		LD	B,11
  E0E7  3E3F          		LD	A,'?'
  E0E9                	CHKWIL1:
  E0E9  BE            		CP	(HL)
  E0EA  23            		INC	HL
  E0EB  37            		SCF
  E0EC  C8            		RET	Z
  E0ED  10FA          		DJNZ	CHKWIL1
  E0EF  AF            		XOR	A
  E0F0  C9            		RET
                      	
  E0F1                	SDIRENT:		;IY=FCB HL=DIR
  E0F1  D5            		PUSH	DE
  E0F2  E5            		PUSH	HL
  E0F3  FDE5          		PUSH	IY
  E0F5  D1            		POP	DE
  E0F6  EB            		EX	DE,HL
  E0F7  CD98E0        		CALL	SETNAME
                      	;				Attribute
  E0FA  FD7E0D        		LD	A,(IY+13)	;(FCB)属性(アトリビュート)
  E0FD  12            		LD	(DE),A
  E0FE  13            		INC	DE
                      	;				Reserved
  E0FF  AF            		XOR	A
  E100  060A          		LD	B,10
  E102                	SDE1:
  E102  12            		LD	(DE),A
  E103  13            		INC	DE
  E104  10FC          		DJNZ	SDE1
                      						;(FCB)ファイルを最後に変更した時刻
  E106  21EAEB        		LD	HL,SDDATA		;(FCB)ファイルを最後に変更した日付
  E109  060A          		LD	B,SDDATAE-SDDATA	;(FCB)ファイルの先頭クラスタ
  E10B                	SDLOOP:					;(FCB)ファイルのサイズ(バイト単位)
  E10B  7E            		LD	A,(HL)
  E10C  23            		INC	HL
  E10D  3212E1        		LD	(SDPAT+2),A
  E110  FD7E00        	SDPAT:	LD	A,(IY+0)	;LD A,(IY+A)
  E113  12            		LD	(DE),A
  E114  13            		INC	DE
  E115  10F4          		DJNZ	SDLOOP
                      	
  E117  AF            		XOR	A
  E118  E1            		POP	HL
  E119  D1            		POP	DE
  E11A  C9            		RET
                      	
  E11B                	WOPEN:
  E11B  FD7E0D        		LD	A,(IY+13)	;(FCB)属性(アトリビュート)
  E11E  E61F          		AND	01FH
  E120  37            		SCF
  E121  C0            		RET	NZ
  E122  FD361CFE      		LD	(IY+28),0FEH	;(FCB)オープン・モード
  E126                	TOPEN2:
  E126  AF            		XOR	A
  E127                	TOPEN:				;Initializes the time stamp
  E127  FD3617FF      		LD	(IY+23),0FFH	;(FCB)ファイルを最後に変更した時刻
  E12B  C9            		RET
                      	
  E12C                	WRDFX:
  E12C  3A8FDF        		LD	A,(SPCPAT+1)	;1クラスタの論理セクタ
  E12F                	L_WRFX:
  E12F  1F            		RRA		;->CF
  E130  3804          		JR	C,E_WRFX
  E132  CB39          		SRL	C	;C=C/2
  E134  18F9          		JR	L_WRFX
  E136                	E_WRFX:
  E136  41            		LD	B,C
  E137  04            		INC	B
  E138  3E37          		LD	A,037H		;SCF
  E13A  327AE5        		LD	(DRDN1),A
                      	
  E13D                	WRDF:				;Bクラスタ分FATを確保する
  E13D  110200        		LD	DE,2
  E140  AF            		XOR	A
  E141  32DEE6        		LD	(_SECPS+1),A
  E144                	WRDF1:
  E144  C5            		PUSH	BC
  E145  D5            		PUSH	DE
  E146  CDF7EC        		CALL	_GNCL
  E149  381C          		JR	C,WRDF3
  E14B  7A            		LD	A,D		;空いているかチェック
  E14C  B3            		OR	E
  E14D  2027          		JR	NZ,WRDF4
  E14F  E1            		POP	HL		;HL=空いているクラスタ
  E150  E5            		PUSH	HL
  E151  ED5BFEEB      		LD	DE,(_CLPS)	;DE=元の(_CLPS)
  E155  22FEEB        		LD	(_CLPS),HL
  E158  7A            		LD	A,D		;元の(_CLPS)が 0 か?
  E159  B3            		OR	E
  E15A  2008          		JR	NZ,WRDF2
  E15C  FD751A        		LD	(IY+26),L	;(FCB)ファイルの先頭クラスタ
  E15F  FD741B        		LD	(IY+27),H	;元が空の場合はFCBにクラスタをセットする
  E162  1803          		JR	WRDF3
  E164                	WRDF2:
  E164  CDFAEC        		CALL	_SNCL
  E167                	WRDF3:
  E167  D1            		POP	DE
  E168  C1            		POP	BC
  E169  D8            		RET	C
  E16A  100C          		DJNZ	WRDF5		;ここでループカウンタチェック
  E16C  ED5BFEEB      		LD	DE,(_CLPS)
  E170  21FFFF        		LD	HL,0FFFFH	;FATエントリ終了(EOCマーク)
  E173  C3FAEC        		JP	_SNCL
                      	
  E176                	WRDF4:				;DEクラスタが空じゃないので次に移動する
  E176  D1            		POP	DE
  E177  C1            		POP	BC
  E178                	WRDF5:
  E178  13            		INC	DE
  E179  CDA8DF        		CALL	ENDCL
  E17C  38C6          		JR	C,WRDF1
  E17E  37            		SCF
  E17F  C9            		RET
                      	
  E180                	RWXR:
  E180  3AEEE4        		LD	A,(SECSZ+2)	;1024=4 / 512=2 / 256=1
  E183                	L_RWX:
  E183  1F            		RRA		;->CF
  E184  3806          		JR	C,E_RWX
  E186  CB38          		SRL	B	;BC=BC/2
  E188  CB19          		RR	C	;
  E18A  18F7          		JR	L_RWX
  E18C                	E_RWX:
  E18C  FD5E1A        		LD	E,(IY+26)	;(FCB)ファイルの先頭クラスタ
  E18F  FD561B        		LD	D,(IY+27)
  E192  AF            		XOR	A
  E193  32DEE6        		LD	(_SECPS+1),A
  E196                	RWX1:
  E196  ED53FEEB      		LD	(_CLPS),DE
  E19A  7A            		LD	A,D
  E19B  B3            		OR	E
  E19C  280D          		JR	Z,SCF_RET	;RET DE==0 => CF=1
                      	
  E19E  78            		LD	A,B
  E19F  B1            		OR	C
  E1A0  C8            		RET	Z		;RET BC==0 => CF=0
                      	
  E1A1  CDE6E6        		CALL	GNCLX
  E1A4  D8            		RET	C
  E1A5  0B            		DEC	BC
                      	
  E1A6  CDA8DF        		CALL	ENDCL
  E1A9  38EB          		JR	C,RWX1
  E1AB                	SCF_RET:
  E1AB  37            		SCF
  E1AC  C9            		RET
                      	
  E1AD                	DSKF:
  E1AD  110000        	MAXCLP:	LD	DE,0
  E1B0  2AACEC        		LD	HL,(_FAKEFREE)
  E1B3  7C            		LD	A,H
  E1B4  B5            		OR	L
  E1B5  2803          		JR	Z,DSKF1
  E1B7  110100        		LD	DE,1
  E1BA                	DSKF1:
  E1BA  D5            		PUSH	DE
  E1BB  CDF7EC        		CALL	_GNCL
  E1BE  380C          		JR	C,POPSCF
  E1C0  7A            		LD	A,D
  E1C1  B3            		OR	E
  E1C2  2001          		JR	NZ,DSKF2
  E1C4  23            		INC	HL
  E1C5                	DSKF2:
  E1C5  D1            		POP	DE
  E1C6  1B            		DEC	DE
  E1C7  7A            		LD	A,D
  E1C8  B3            		OR	E
  E1C9  20EF          		JR	NZ,DSKF1
  E1CB  C9            		RET
                      	
  E1CC                	POPSCF:
  E1CC  F1            		POP	AF
  E1CD  37            		SCF
  E1CE  C9            		RET
                      	
  E1CF                	SETTMS:
  E1CF  FD7E17        		LD	A,(IY+23)	;(FCB)ファイルを最後に変更した時刻
  E1D2  3C            		INC	A
  E1D3  C0            		RET	NZ		;ファイルが更新されていない
  E1D4                	SETTMSX:			;FCBに日付時刻をセットする
  E1D4  CD48D8        		CALL	_SYS2C		;(BDOS)時刻の獲得
                      					;H←時  L←分  D←秒
  E1D7  CB25          		SLA	L		;L=L/2
  E1D9  CB25          		SLA	L		;L=L/2
  E1DB  29            		ADD	HL,HL		;*2
  E1DC  29            		ADD	HL,HL		;*4
  E1DD  29            		ADD	HL,HL		;*8
  E1DE  7A            		LD	A,D
  E1DF  0F            		RRCA			;bit.0->7->->->0->C
  E1E0  E61F          		AND	01FH
  E1E2  B5            		OR	L
  E1E3  FD7716        		LD	(IY+22),A	;(FCB)ファイルを最後に変更した時刻
  E1E6  FD7417        		LD	(IY+23),H
                      	
  E1E9  CD14D8        		CALL	_SYS2A		;(BDOS)日付の獲得
                      					;HL←年  D←月  E←日
  E1EC  0144F8        		LD	BC,0-1980
  E1EF  09            		ADD	HL,BC
  E1F0  65            		LD	H,L
                      	
  E1F1  7A            		LD	A,D
  E1F2  87            		ADD	A,A		;*2
  E1F3  87            		ADD	A,A		;*4
  E1F4  87            		ADD	A,A		;*8
  E1F5  87            		ADD	A,A		;*16
  E1F6  6F            		LD	L,A
  E1F7  29            		ADD	HL,HL		;*32
  E1F8  7D            		LD	A,L
  E1F9  B3            		OR	E
  E1FA  FD7714        		LD	(IY+20),A	;(FCB)ファイルを最後に変更した日付
  E1FD  FD7415        		LD	(IY+21),H
  E200  C9            		RET
                      	
  E201                	PUSHRR:
  E201  CD07E2        		CALL	SUBRR
  E204                	POPRR1:
  E204  EDB0          		LDIR
  E206  C9            		RET
                      	
  E207                	SUBRR:
  E207  FDE5          		PUSH	IY
  E209  E1            		POP	HL
  E20A  112100        		LD	DE,33
  E20D  19            		ADD	HL,DE
  E20E  119BE2        		LD	DE,HLBUF
  E211  010300        		LD	BC,3
  E214  C9            		RET
                      	
  E215                	SETSEQ:
  E215  F5            		PUSH	AF		;AHL=Random record
  E216  FD7E21        		LD	A,(IY+33)	;(FCB)ランダム・レコード
  E219  FD6E22        		LD	L,(IY+34)
  E21C  FD6623        		LD	H,(IY+35)
                      	
  E21F  CD3BE2        		CALL	SSQ1
                      	
  E222  29            		ADD	HL,HL
  E223  CB3D          		SRL	L		;L=L/2
  E225  FD7520        		LD	(IY+32),L	;(FCB)カレント・レコード
  E228  FD740C        		LD	(IY+12),H	;(FCB)カレント・ブロック
  E22B  F1            		POP	AF
                      	
  E22C                	POPRR:
  E22C  CD07E2        		CALL	SUBRR
  E22F  EB            		EX	DE,HL
  E230  18D2          		JR	POPRR1
                      	
  E232                	GETSIZE:
  E232  FD7E10        		LD	A,(IY+16)	;(FCB)ファイルのサイズ(バイト単位)
  E235  FD6E11        		LD	L,(IY+17)
  E238  FD6612        		LD	H,(IY+18)
  E23B                	SSQ1:				;バイト単位からCP/Mのレコード単位を求める（1レコード=128バイト）
  E23B  87            		ADD	A,A		;in HLA => out HL
  E23C  ED6A          		ADC	HL,HL
  E23E  B7            		OR	A
  E23F  C8            		RET	Z
  E240  23            		INC	HL
  E241  C9            		RET
                      	
  E242                	GETSEQ:
  E242  FD6E20        		LD	L,(IY+32)	;(FCB)カレント・レコード
  E245  FD660C        		LD	H,(IY+12)	;(FCB)カレント・ブロック
                      	
  E248  CB25          		SLA	L	;L=L*2
                      	
  E24A  CB3C          		SRL	H	;HL=HL/2
  E24C  CB1D          		RR	L	;
  E24E  C9            		RET
                      	
  E24F                	RB_WRITE:
  E24F  C5            		PUSH	BC
  E250  ED4B4CEC      		LD	BC,(STABLE+2*026H)	;(BDOS)ランダム・ブロック・ライト
  E254  1805          		JR	RBRW
  E256                	RB_READ:
  E256  C5            		PUSH	BC
  E257  ED4B4EEC      		LD	BC,(STABLE+2*027H)	;(BDOS)ランダム・ブロック・リード
  E25B                	RBRW:
  E25B  AF            		XOR	A	;HLA = HL*128
  E25C  CB3C          		SRL	H	;HL=HL/2
  E25E  CB1D          		RR	L	;
  E260  1F            		RRA			;HLA
  E261  FD7721        		LD	(IY+33),A	;(FCB)ランダム・レコード
  E264  FD7522        		LD	(IY+34),L
  E267  FD7423        		LD	(IY+35),H
  E26A  218000        		LD	HL,128
                      	
  E26D  FDE5          		PUSH	IY
  E26F  D1            		POP	DE
  E270  D5            		PUSH	DE
  E271  CD78E2        		CALL	JP_BC
  E274  FDE1          		POP	IY
  E276  C1            		POP	BC
  E277  C9            		RET
  E278                	JP_BC:
  E278  C5            		PUSH	BC
  E279  C9            		RET
                      	
  E27A                	SFILE:	DS	33		;DRV FILENAME
  E29B                	HLBUF:	DS	3		;Random record buffer
                      	
                      	;LDFILE2.ASM
                      	
                      	;	LSX-Dodgers FILE2
                      	
  E29E                	RBWDD:
  E29E  E5            		PUSH	HL
  E29F  C1            		POP	BC
  E2A0  217AE3        		LD	HL,NUL
  E2A3  CDAEE3        		CALL	DDX
  E2A6  2003          		JR	NZ,RBWDD2
  E2A8  2A08EC        		LD	HL,(STABLE+2*4)
  E2AB                	RBWDD2:
  E2AB  FE43          		CP	'C'
  E2AD  2003          		JR	NZ,RBWDD3
  E2AF  2138DA        		LD	HL,PRINTS
  E2B2                	RBWDD3:
  E2B2  FE50          		CP	'P'
  E2B4  2003          		JR	NZ,RBWDD4
  E2B6  2A0AEC        		LD	HL,(STABLE+2*5)
  E2B9                	RBWDD4:
  E2B9  22C7E2        		LD	(RBWDDP+1),HL
  E2BC  2A8AEC        		LD	HL,(_DTA)
  E2BF                	RBWDD1:
  E2BF  78            		LD	A,B
  E2C0  B1            		OR	C
  E2C1                	RBWDD5:
  E2C1  CA75E3        		JP	Z,RBW1
  E2C4  5E            		LD	E,(HL)
  E2C5  23            		INC	HL
  E2C6  CD8CD7        	RBWDDP:	CALL	_SYS02
  E2C9  DA91E3        		JP	C,RBRERR
  E2CC  3E1A          		LD	A,01AH
  E2CE  BB            		CP	E
  E2CF  28F0          		JR	Z,RBWDD5
  E2D1  0B            		DEC	BC
  E2D2  18EB          		JR	RBWDD1
                      	
                      					;Write random block
  E2D4                	_SYS26:		;(BDOS)ランダム・ブロック・ライト
  E2D4  AF            		XOR	A
  E2D5  327AE5        		LD	(DRDN1),A	;NOP
  E2D8  2230E5        		LD	(LEFT+1),HL	;HL←書き込むレコード数
  E2DB  2252E5        		LD	(LEFTX),HL
  E2DE  CD78DD        		CALL	SETDRV
                      	
  E2E1  CD9AE4        		CALL	RBX0
  E2E4  DA7CE3        		JP	C,RBWERR
  E2E7  28B5          		JR	Z,RBWDD		;デバイスデスクプリタ
  E2E9  CD1BE1        		CALL	WOPEN
  E2EC  DA7CE3        		JP	C,RBWERR
  E2EF  7C            		LD	A,H
  E2F0  B5            		OR	L
  E2F1  CA75E3        		JP	Z,RBW1
                      	
  E2F4  2B            		DEC	HL
                      	
  E2F5  CD48E5        		CALL	GET_RR_CDE	;CDE=Random record
                      	
  E2F8  AF            		XOR	A	;AHL=HL+CDE
  E2F9  19            		ADD	HL,DE
  E2FA  89            		ADC	A,C
                      	
  E2FB  47            		LD	B,A
  E2FC  4C            		LD	C,H
                      	
  E2FD  CD80E1        		CALL	RWXR
  E300  DC2CE1        		CALL	C,WRDFX
  E303  DA7CE3        		JP	C,RBWERR
                      		
  E306  CDC3E4        		CALL	RBX2
  E309  281A          		JR	Z,RBWB		;NZ=セクタ以下の端数がある
  E30B  CDD6E4        		CALL	RBXA		
  E30E  386C          		JR	C,RBWERR
  E310  EB            		EX	DE,HL
  E311  C5            		PUSH	BC
  E312  EDB0          		LDIR
  E314  2254E5        		LD	(DTAX),HL
                      	
  E317  CDC0E0        		CALL	SWTDBF		;バッファデータは更新された
                      	
  E31A  2A52E5        		LD	HL,(LEFTX)
  E31D  D1            		POP	DE
  E31E  ED52          		SBC	HL,DE
  E320  2252E5        		LD	(LEFTX),HL
  E323  2830          		JR	Z,RBWEND
                      	
  E325                	RBWB:
  E325  CD0CE5        		CALL	RBXB
  E328  2813          		JR	Z,RBWC
  E32A                	RBWB1:
  E32A  C5            		PUSH	BC
  E32B  D5            		PUSH	DE
  E32C  CD8BDF        		CALL	CLUSTX
  E32F  CD4FE8        		CALL	DWT24
  E332  D1            		POP	DE
  E333  C1            		POP	BC
  E334  3846          		JR	C,RBWERR
  E336  CDE6E6        		CALL	GNCLX
  E339  3841          		JR	C,RBWERR
  E33B  10ED          		DJNZ	RBWB1
  E33D                	RBWC:
  E33D  CD24E5        		CALL	RBXC
  E340  2813          		JR	Z,RBWEND
  E342  C5            		PUSH	BC
  E343  CD8BDF        		CALL	CLUSTX
  E346  CD79E5        		CALL	DRDN
  E349  C1            		POP	BC
  E34A  3830          		JR	C,RBWERR
  E34C  ED5B7EEC      		LD	DE,(_DTBUF)
  E350  EDB0          		LDIR
  E352  CDC0E0        		CALL	SWTDBF		;バッファデータは更新された
  E355                	RBWEND:
  E355  CD2FE5        		CALL	RBXEND
                      	
  E358  CDA9E4        		CALL	RBX1
  E35B  3018          		JR	NC,RBW1
  E35D  2A30E5        		LD	HL,(LEFT+1)
  E360  FD5E10        		LD	E,(IY+16)	;(FCB)ファイルのサイズ(バイト単位)
  E363  FD5611        		LD	D,(IY+17)	;CDE=File size
  E366  FD4E12        		LD	C,(IY+18)
  E369  AF            		XOR	A
  E36A  19            		ADD	HL,DE
  E36B  89            		ADC	A,C
  E36C  FD7510        		LD	(IY+16),L	;(FCB)ファイルのサイズ(バイト単位)
  E36F  FD7411        		LD	(IY+17),H
  E372  FD7712        		LD	(IY+18),A
  E375                	RBW1:
  E375  FDE1          		POP	IY
  E377  C1            		POP	BC
  E378  D1            		POP	DE
  E379  E1            		POP	HL
  E37A                	NUL:
  E37A  AF            		XOR	A
  E37B  C9            		RET
                      	
  E37C                	RBWERR:
  E37C  FDE5          		PUSH	IY
  E37E  D1            		POP	DE
  E37F  2A20EC        		LD	HL,(STABLE+2*010H)
  E382  CD0F00        		CALL	JP_HL
  E385                	RBRERR1:
  E385  3E01          		LD	A,001H
  E387                	RBRERR2:
  E387  FDE1          		POP	IY
  E389  C1            		POP	BC
  E38A  D1            		POP	DE
  E38B  E1            		POP	HL
  E38C  37            		SCF
  E38D  210000        		LD	HL,0
  E390  C9            		RET
                      	
  E391                	RBRERR:
  E391  3EFF          		LD	A,0FFH
  E393  18F2          		JR	RBRERR2
                      	
  E395                	RBRFL:
  E395  3E00          	RBRFLP:	LD	A,000H
  E397  FE0D          		CP	00DH
  E399  2005          		JR	NZ,RBRFL1
  E39B  D5            		PUSH	DE
  E39C  1E0A          		LD	E,00AH
  E39E  1805          		JR	RBRFL2
  E3A0                	RBRFL1:
  E3A0  D5            		PUSH	DE
  E3A1  CD6FD3        		CALL	_SYS07
  E3A4  5F            		LD	E,A
  E3A5                	RBRFL2:
  E3A5  CDCDEC        		CALL	_PRINT
  E3A8  7B            		LD	A,E
  E3A9  D1            		POP	DE
  E3AA  3296E3        		LD	(RBRFLP+1),A
  E3AD  C9            		RET
  E3AE                	DDX:
  E3AE  FD7E01        		LD	A,(IY+1)	;(FCB)主ファイル名
  E3B1  CDB0DF        		CALL	CAP
  E3B4  FE41          		CP	'A'
  E3B6  C9            		RET
                      	
  E3B7                	RBRDD:
  E3B7  E5            		PUSH	HL
  E3B8  C1            		POP	BC
  E3B9  2195E3        		LD	HL,RBRFL
  E3BC  CDAEE3        		CALL	DDX
  E3BF  2005          		JR	NZ,RBRDD2
  E3C1  2A06EC        		LD	HL,(STABLE+2*3)
  E3C4  1804          		JR	RBRDD3
  E3C6                	RBRDD2:
  E3C6  FE43          		CP	'C'
  E3C8  202C          		JR	NZ,RBRDERR
  E3CA                	RBRDD3:
  E3CA  22DAE3        		LD	(RBRDDP+1),HL
                      	
  E3CD  ED5B8AEC      		LD	DE,(_DTA)
  E3D1  210000        		LD	HL,0
  E3D4                	RBRDD1:
  E3D4  78            		LD	A,B
  E3D5  B1            		OR	C
  E3D6  2818          		JR	Z,RBRDDE1
  E3D8  23            		INC	HL
  E3D9  CD95E3        	RBRDDP:	CALL	RBRFL
  E3DC  380D          		JR	C,RBRDDE
  E3DE  FE1A          		CP	01AH
  E3E0  2809          		JR	Z,RBRDDE
  E3E2  FE03          		CP	3
  E3E4  2805          		JR	Z,RBRDDE
  E3E6  12            		LD	(DE),A
  E3E7  13            		INC	DE
  E3E8  0B            		DEC	BC
  E3E9  18E9          		JR	RBRDD1
                      	
  E3EB                	RBRDDE:
  E3EB  3E1A          		LD	A,01AH
  E3ED  12            		LD	(DE),A
  E3EE                	RBRDDE2:
  E3EE  AF            		XOR	A
  E3EF  3C            		INC	A
  E3F0                	RBRDDE1:
  E3F0  3286E4        		LD	(RBRAP+1),A
  E3F3  C37FE4        		JP	RBREND0
  E3F6                	RBRDERR:
  E3F6  210000        		LD	HL,0
  E3F9  18F3          		JR	RBRDDE2
                      	
                      					;Read random block
  E3FB                	_SYS27:		;(BDOS)ランダム・ブロック・リード
  E3FB  2252E5        		LD	(LEFTX),HL
  E3FE  CD78DD        		CALL	SETDRV
                      	
  E401  FDCB0D66      		BIT	4,(IY+13)	;(FCB)属性(アトリビュート)
  E405  C288E4        		JP	NZ,RBRDIR	;ディレクトリ
  E408  CD9AE4        		CALL	RBX0
  E40B  DA91E3        		JP	C,RBRERR
  E40E  28A7          		JR	Z,RBRDD
  E410  CDA9E4        		CALL	RBX1
  E413  DA85E3        		JP	C,RBRERR1
  E416  79            		LD	A,C
  E417  EB            		EX	DE,HL
  E418  ED52          		SBC	HL,DE		;CP 0HL,CDE
  E41A  19            		ADD	HL,DE
  E41B  DE00          		SBC	A,000H
  E41D  3801          		JR	C,RBR1
  E41F  EB            		EX	DE,HL
  E420                	RBR1:
  E420  9F            		SBC	A,A
  E421  E601          		AND	1
  E423  3286E4        		LD	(RBRAP+1),A
                      	
  E426  7C            		LD	A,H
  E427  B5            		OR	L
  E428  CA7FE4        		JP	Z,RBREND0
                      	
  E42B  2230E5        		LD	(LEFT+1),HL	;Read record byte
  E42E  2252E5        		LD	(LEFTX),HL
                      	
  E431  CDC3E4        		CALL	RBX2
  E434  2819          		JR	Z,RBRB
  E436  CDD6E4        		CALL	RBXA
  E439  DA91E3        		JP	C,RBRERR
  E43C  C5            		PUSH	BC
  E43D  EDB0          		LDIR
  E43F  ED5354E5      		LD	(DTAX),DE
  E443  2A52E5        		LD	HL,(LEFTX)
  E446  D1            		POP	DE
  E447  A7            		AND	A
  E448  ED52          		SBC	HL,DE
  E44A  2252E5        		LD	(LEFTX),HL
  E44D  282D          		JR	Z,RBREND
                      	
  E44F                	RBRB:
  E44F  CD0CE5        		CALL	RBXB
  E452  2812          		JR	Z,RBRC
  E454                	RBRB1:
  E454  C5            		PUSH	BC
  E455  D5            		PUSH	DE
  E456  CD8BDF        		CALL	CLUSTX
  E459  CD3FE8        		CALL	DRD24
  E45C  D1            		POP	DE
  E45D  C1            		POP	BC
  E45E  D4E6E6        		CALL	NC,GNCLX
  E461  DA91E3        		JP	C,RBRERR
  E464  10EE          		DJNZ	RBRB1
  E466                	RBRC:
  E466  CD24E5        		CALL	RBXC
  E469  2811          		JR	Z,RBREND
  E46B  C5            		PUSH	BC
  E46C  CD8BDF        		CALL	CLUSTX
  E46F  CD5DE5        		CALL	DRDX
  E472  C1            		POP	BC
  E473  DA91E3        		JP	C,RBRERR
  E476  EB            		EX	DE,HL
  E477  2A7EEC        		LD	HL,(_DTBUF)
  E47A  EDB0          		LDIR
  E47C                	RBREND:
  E47C  CD2FE5        		CALL	RBXEND
  E47F                	RBREND0:
  E47F  FDE1          		POP	IY
  E481  C1            		POP	BC
  E482  D1            		POP	DE
  E483  F1            		POP	AF	;(HL)
  E484  AF            		XOR	A
  E485  3E00          	RBRAP:	LD	A,000H
  E487  C9            		RET
                      	
  E488                	RBRDIR:
  E488  FD6E1A        		LD	L,(IY+26)	;(FCB)ファイルの先頭クラスタ
  E48B  FD661B        		LD	H,(IY+27)
  E48E  CDCBDF        		CALL	CHDIR
  E491  AF            		XOR	A
  E492  67            		LD	H,A
  E493  6F            		LD	L,A
  E494  3C            		INC	A
  E495  3286E4        		LD	(RBRAP+1),A
  E498  18E5          		JR	RBREND0
                      	
  E49A                	RBX0:
  E49A  2A8AEC        		LD	HL,(_DTA)
  E49D  2254E5        		LD	(DTAX),HL
  E4A0  2A52E5        		LD	HL,(LEFTX)
  E4A3  FD7E1C        		LD	A,(IY+28)	;(FCB)オープン・モード
  E4A6  D6FD          		SUB	0FDH
  E4A8  C9            		RET
                      	
  E4A9                	RBX1:
  E4A9  E5            		PUSH	HL		;Record byte
                      					;AHL=File size
  E4AA  FD6E10        		LD	L,(IY+16)	;ファイルのサイズ(バイト単位)
  E4AD  FD6611        		LD	H,(IY+17)
  E4B0  FD7E12        		LD	A,(IY+18)
                      	
  E4B3  CD48E5        		CALL	GET_RR_CDE	;CDE=Random record
                      	
  E4B6  A7            		AND	A
  E4B7  ED52          		SBC	HL,DE
  E4B9  99            		SBC	A,C
  E4BA  D1            		POP	DE
                      	
  E4BB  D8            		RET	C
  E4BC  4F            		LD	C,A
  E4BD  EB            		EX	DE,HL	;CDE=File byte	HL=Record byte
  E4BE  B2            		OR	D
  E4BF  B3            		OR	E
  E4C0  C0            		RET	NZ
  E4C1  37            		SCF
  E4C2  C9            		RET
                      	
  E4C3                	RBX2:				;Cluster settings
  E4C3  FD4E22        		LD	C,(IY+34)	;(+33)(FCB)ランダム・レコード
  E4C6  FD4623        		LD	B,(IY+35)
  E4C9  CD80E1        		CALL	RWXR
  E4CC  3AA8DE        		LD	A,(SECSZM1+2)	;1024=3 / 512=1 / 256=0
  E4CF  FDA622        		AND	(IY+34)
  E4D2  FDB621        		OR	(IY+33)
  E4D5  C9            		RET
                      	
  E4D6                	RBXA:
  E4D6  C5            		PUSH	BC
  E4D7  D5            		PUSH	DE
  E4D8  CD8BDF        		CALL	CLUSTX
  E4DB  CD5DE5        		CALL	DRDX
  E4DE  D1            		POP	DE
  E4DF  C1            		POP	BC
  E4E0  D8            		RET	C
  E4E1  CDE6E6        		CALL	GNCLX
  E4E4  D8            		RET	C
  E4E5  ED53FEEB      		LD	(_CLPS),DE
                      	
  E4E9  FD4E21        		LD	C,(IY+33)	;(FCB)ランダム・レコード
  E4EC  210004        	SECSZ:	LD	HL,0400H	;自己書き換え 1024=0400H / 512=0200H ここに1セクタのサイズが格納される
  E4EF  7C            		LD	A,H
  E4F0  3D            		DEC	A		;1024=3 / 512=1
  E4F1  FDA622        		AND	(IY+34)		;(FCB)ランダム・レコード
  E4F4  47            		LD	B,A		;BCに1セクタ以下の端数が入る
  E4F5  ED42          		SBC	HL,BC		;残りを計算
                      	
  E4F7  ED5B52E5      		LD	DE,(LEFTX)
  E4FB  ED52          		SBC	HL,DE		;CP HL,DE
  E4FD  19            		ADD	HL,DE		;
  E4FE  3801          		JR	C,RBXA1		;DEとHLを比較して大きい方をHLに
  E500  EB            		EX	DE,HL
  E501                	RBXA1:
  E501  E5            		PUSH	HL
  E502  2A7EEC        		LD	HL,(_DTBUF)
  E505  09            		ADD	HL,BC
  E506  ED5B54E5      		LD	DE,(DTAX)
  E50A  C1            		POP	BC
  E50B  C9            		RET
                      	
  E50C                	RBXB:
  E50C  2A54E5        		LD	HL,(DTAX)
  E50F  ED5BFEEB      		LD	DE,(_CLPS)
  E513  3A53E5        		LD	A,(LEFTX+1)
  E516  47            		LD	B,A
  E517  3AEEE4        		LD	A,(SECSZ+2)	;1024=4 / 512=2 / 256=1
  E51A                	RBXB1:
  E51A  1F            		RRA		;->CF
  E51B  3804          		JR	C,RBXB2
  E51D  CB38          		SRL	B	;B=B/2
  E51F  18F9          		JR	RBXB1
  E521                	RBXB2:
  E521  78            		LD	A,B
  E522  B7            		OR	A
  E523  C9            		RET
                      	
  E524                	RBXC:
  E524  ED4B52E5      		LD	BC,(LEFTX)
  E528  3AA8DE        		LD	A,(SECSZM1+2)	;1024=3 / 512=1 / 256=0
  E52B  A0            		AND	B
  E52C  47            		LD	B,A		;1セクタ以下の端数がない場合はZ
  E52D  B1            		OR	C
  E52E  C9            		RET
                      	
  E52F                	RBXEND:
  E52F  110000        	LEFT:	LD	DE,0
  E532  AF            		XOR	A
  E533  FD6E21        		LD	L,(IY+33)	;(FCB)ランダム・レコード
  E536  FD6622        		LD	H,(IY+34)
  E539  19            		ADD	HL,DE
  E53A  FD8E23        		ADC	A,(IY+35)
  E53D  FD7521        		LD	(IY+33),L	;(FCB)ランダム・レコード
  E540  FD7422        		LD	(IY+34),H
  E543  FD7723        		LD	(IY+35),A
  E546  EB            		EX	DE,HL		;HL=Read byte
  E547  C9            		RET
                      	
  E548                	GET_RR_CDE:			;CDE=Random record
  E548  FD5E21        		LD	E,(IY+33)	;(FCB)ランダム・レコード
  E54B  FD5622        		LD	D,(IY+34)
  E54E  FD4E23        		LD	C,(IY+35)
  E551  C9            		RET
                      	
  E552                	CPBUF:
  E552  0000          	LEFTX:	DW	0
  E554  0000          	DTAX:	DW	0
  E556  20            		DB	020H	;CPBUFで使う
  E557  20            		DB	020H
  E558  20            		DB	020H
  E559  20            		DB	020H
  E55A  20            		DB	020H
  E55B  20            		DB	020H
  E55C  20            		DB	020H
                      	;
                      	
                      	;LDDIO.ASM
                      	
                      	;	LSX-Dodgers DIO
                      	
  E55D                	DRDX:
  E55D  CD9BE5        		CALL	DRDY
  E560  C8            		RET	Z
  E561  CD81E5        		CALL	DRDX1		;データバッファの情報を保存
  E564  D8            		RET	C
  E565  E5            		PUSH	HL
  E566  C5            		PUSH	BC
  E567  D5            		PUSH	DE
  E568  2A7EEC        		LD	HL,(_DTBUF)
  E56B  3AC4E5        		LD	A,(_DBS24+1)
  E56E  4F            		LD	C,A
  E56F  CD3FE8        		CALL	DRD24
  E572  DC96E5        		CALL	C,DRDNE
  E575                	POP_DE_BC_HL_RET:
  E575  D1            		POP	DE
  E576  C1            		POP	BC
  E577  E1            		POP	HL
  E578  C9            		RET
                      	
                      	;	CDE:セクタ番号
  E579                	DRDN:
  E579  AF            		XOR	A
  E57A  00            	DRDN1:	NOP			;自己書き換え NOP / SCF
  E57B  30E0          		JR	NC,DRDX
  E57D                	DRDNX:
  E57D  CD9BE5        		CALL	DRDY
  E580  C8            		RET	Z
  E581                	DRDX1:
  E581  CDB1E5        		CALL	DWTX
                      					;データバッファの読み込んだドライブ・セクタ情報を保存
  E584  ED53A6EC      		LD	(_DBSEC),DE
  E588  79            		LD	A,C
  E589  32C4E5        		LD	(_DBS24+1),A
                      	
  E58C  3A88EC        		LD	A,(_DRV)
  E58F  32A5EC        		LD	(_DBDRV),A
  E592  CDD9EC        		CALL	_CHGDRV
  E595  D0            		RET	NC
  E596                	DRDNE:
  E596  9F            		SBC	A,A		;CF=1ならばA=0FFH
  E597  32A5EC        		LD	(_DBDRV),A
  E59A  C9            		RET
                      	
                      	;	CDE:セクタ番号
  E59B                	DRDY:
  E59B  3AC4E5        		LD	A,(_DBS24+1)
  E59E  B9            		CP	C
  E59F  C0            		RET	NZ
                      	
  E5A0  E5            		PUSH	HL
  E5A1  3A88EC        		LD	A,(_DRV)
  E5A4  21A5EC        		LD	HL,_DBDRV
  E5A7  AE            		XOR	(HL)
  E5A8  2005          		JR	NZ,POP_HL_RET
                      	
  E5AA  2AA6EC        		LD	HL,(_DBSEC)
  E5AD  ED52          		SBC	HL,DE		;CF=0
  E5AF                	POP_HL_RET:
  E5AF  E1            		POP	HL
  E5B0  C9            		RET
                      	
  E5B1                	DWTX:
  E5B1  3AA4EC        		LD	A,(_WTDBF)
  E5B4  B7            		OR	A
  E5B5  C8            		RET	Z
  E5B6  AF            		XOR	A
  E5B7  32A4EC        		LD	(_WTDBF),A
                      	
  E5BA  E5            		PUSH	HL
  E5BB  C5            		PUSH	BC
  E5BC  D5            		PUSH	DE
  E5BD  3AA5EC        		LD	A,(_DBDRV)
  E5C0  CDD9EC        		CALL	_CHGDRV
  E5C3  0E00          	_DBS24:	LD	C,0
  E5C5  ED5BA6EC      		LD	DE,(_DBSEC)
  E5C9  2A7EEC        		LD	HL,(_DTBUF)
  E5CC  D44FE8        		CALL	NC,DWT24
  E5CF                	POP_DE_BC_HL_RET2:
  E5CF  18A4          		JR	POP_DE_BC_HL_RET
                      	
  E5D1                	RDFATX:
  E5D1  E5            		PUSH	HL
  E5D2  3A88EC        		LD	A,(_DRV)
  E5D5  21AAEC        		LD	HL,_FATDRV
  E5D8  AE            		XOR	(HL)
  E5D9  28D4          		JR	Z,POP_HL_RET
                      	
  E5DB  C5            		PUSH	BC
  E5DC  D5            		PUSH	DE
  E5DD  DDE5          		PUSH	IX
  E5DF  CDFBE5        		CALL	WTFATX
  E5E2  3813          		JR	C,POP_IX_DE_BC_HL_RET
                      	
  E5E4  AF            		XOR	A
  E5E5  32ABEC        		LD	(_FATIX),A
  E5E8  3A88EC        		LD	A,(_DRV)
  E5EB  32AAEC        		LD	(_FATDRV),A
  E5EE  CDE5EC        		CALL	_RDFAT
  E5F1                	RDFATE2:
  E5F1  3004          		JR	NC,POP_IX_DE_BC_HL_RET
  E5F3  9F            		SBC	A,A		;A=0xFF
  E5F4  32AAEC        		LD	(_FATDRV),A
  E5F7                	POP_IX_DE_BC_HL_RET:
  E5F7  DDE1          		POP	IX
  E5F9  18D4          		JR	POP_DE_BC_HL_RET2
                      	
  E5FB                	WTFATX:
  E5FB  3AA2EC        		LD	A,(_WTFATF)
  E5FE  B7            		OR	A
  E5FF  C8            		RET	Z
  E600  E5            		PUSH	HL
  E601  3AAAEC        		LD	A,(_FATDRV)
  E604  21A5EC        		LD	HL,_DBDRV
  E607  AE            		XOR	(HL)
  E608  CCB1E5        		CALL	Z,DWTX
  E60B  38A2          		JR	C,POP_HL_RET
  E60D  C5            		PUSH	BC
  E60E  D5            		PUSH	DE
  E60F  DDE5          		PUSH	IX
  E611  CD5CE8        		CALL	WTFAT
  E614  AF            		XOR	A
  E615  32A2EC        		LD	(_WTFATF),A
  E618  18DD          		JR	POP_IX_DE_BC_HL_RET
                      	
  E61A                	NCL1:
  E61A  7A            		LD	A,D
  E61B  B3            		OR	E
  E61C  37            		SCF
  E61D  C8            		RET	Z
                      	
  E61E  7A            		LD	A,D
  E61F  E608          		AND	8		;DE(targetCluster >= 0x800)
  E621                	N16CL1X:
  E621  E5            		PUSH	HL
  E622  3241E6        		LD	(NCLPAT+2),A	;_FATIX
  E625  2AAAEC        		LD	HL,(_FATDRV)	;L=_FATDRV H=_FATIX
  E628  BC            		CP	H
  E629  3A88EC        		LD	A,(_DRV)	;この間でフラグは変化しない
  E62C  3240E6        		LD	(NCLPAT+1),A	;_FATDRV
  E62F  2005          		JR	NZ,NCL2		;FATIXが違う
  E631  BD            		CP	L
  E632  2002          		JR	NZ,NCL2		;ドライブが違う
  E634  E1            		POP	HL
  E635  C9            		RET
  E636                	NCL2:
  E636  C5            		PUSH	BC
  E637  D5            		PUSH	DE
  E638  DDE5          		PUSH	IX
  E63A  CDFBE5        		CALL	WTFATX
  E63D  38B8          		JR	C,POP_IX_DE_BC_HL_RET
  E63F  010000        	NCLPAT:	LD	BC,0		;自己書き換え C=_FATDRV B=_FATIX
  E642  ED43AAEC      		LD	(_FATDRV),BC
  E646  CD2CE8        		CALL	RDFATS
  E649  18A6          		JR	RDFATE2
                      	
  E64B                	NCL3:
  E64B  CB9A          		RES	3,D
  E64D  6B            		LD	L,E
  E64E  62            		LD	H,D
  E64F  CB3C          		SRL	H	;
  E651  CB1D          		RR	L	;HLA=HLA/2
  E653  1F            		RRA		;
  E654  ED4B7CEC      		LD	BC,(_FATBF)
  E658  19            		ADD	HL,DE
  E659  09            		ADD	HL,BC
  E65A  17            		RLA
  E65B  C9            		RET
                      	
  E65C                	N16CL1:
  E65C  7A            		LD	A,D
  E65D  B3            		OR	E
  E65E  37            		SCF
  E65F  C8            		RET	Z
                      	
  E660  7A            		LD	A,D
  E661  CB3F          		SRL	A	;/2
  E663  CB3F          		SRL	A	;/2
  E665  18BA          		JR	N16CL1X
                      	
  E667                	GNCL:
  E667  CD1AE6        		CALL	NCL1		;GET NEXT CLUSTER
  E66A  D8            		RET	C
  E66B  C5            		PUSH	BC
  E66C  E5            		PUSH	HL
  E66D  CD4BE6        		CALL	NCL3
  E670  3809          		JR	C,GNC1
  E672  5E            		LD	E,(HL)
  E673  23            		INC	HL
  E674  7E            		LD	A,(HL)
  E675  E60F          		AND	00FH
  E677  57            		LD	D,A
  E678  E1            		POP	HL
  E679  C1            		POP	BC
  E67A  C9            		RET
  E67B                	GNC1:
  E67B  7E            		LD	A,(HL)
  E67C  23            		INC	HL
  E67D  56            		LD	D,(HL)
  E67E  0604          		LD	B,4
  E680                	GNC1L:
  E680  CB3A          		SRL	D	;DA=DA/2
  E682  1F            		RRA		;
  E683  10FB          		DJNZ	GNC1L
                      	
  E685  5F            		LD	E,A
  E686  E1            		POP	HL
  E687  C1            		POP	BC
  E688  A7            		AND	A
  E689  C9            		RET
                      	
  E68A                	SNCL:
  E68A  CD1AE6        		CALL	NCL1
  E68D  D8            		RET	C
                      	;				SET NEXT CLUSTER
  E68E  E5            		PUSH	HL
  E68F  C5            		PUSH	BC
  E690  D5            		PUSH	DE
  E691  E5            		PUSH	HL
  E692  CD4BE6        		CALL	NCL3
  E695  D1            		POP	DE
                      	;CF=ODD
  E696  7E            		LD	A,(HL)
  E697  73            		LD	(HL),E
  E698  3806          		JR	C,SNC1
                      	;EVEN
                      	;M[0] = E
                      	;M[1] = (M[1] & 0xF0) | (D & 0x0F)
  E69A  23            		INC	HL
  E69B  ED67          		RRD		;M={A[3:0],E[3:0]}
  E69D  7A            		LD	A,D
  E69E  1804          		JR	SNC11
  E6A0                	SNC1:
                      	;ODD
                      	;HL[0] = (HL[0]&0x0F) | (E<<4)
                      	;HL[1] = DE>>4
  E6A0  ED6F          		RLD		;M={D[3:0],E[7:4]}
  E6A2  23            		INC	HL
  E6A3  72            		LD	(HL),D	;M={D[3:0],E[7:4]}
  E6A4                	SNC11:
  E6A4  ED6F          		RLD		;M={M[7:4],D[3:0]}
  E6A6  B7            		OR	A
  E6A7  D1            		POP	DE
  E6A8  C1            		POP	BC
  E6A9  E1            		POP	HL
  E6AA                	FAT_CHANGED:
  E6AA  3E01          		LD	A,1
  E6AC  32A2EC        		LD	(_WTFATF),A
  E6AF  C9            		RET
                      	
  E6B0                	N16CL3:
  E6B0  C5            		PUSH	BC
  E6B1  6B            		LD	L,E
  E6B2  7A            		LD	A,D
  E6B3  E603          		AND	3
  E6B5  67            		LD	H,A
  E6B6  29            		ADD	HL,HL
  E6B7  ED4B7CEC      		LD	BC,(_FATBF)
  E6BB  09            		ADD	HL,BC
  E6BC  C1            		POP	BC
  E6BD  C9            		RET
                      	
  E6BE                	GNCL16:
  E6BE  CD5CE6        		CALL	N16CL1		;GET NEXT CLUSTER for FAT16
  E6C1  D8            		RET	C
  E6C2  E5            		PUSH	HL
  E6C3  CDB0E6        		CALL	N16CL3
  E6C6  5E            		LD	E,(HL)
  E6C7  23            		INC	HL
  E6C8  56            		LD	D,(HL)
  E6C9  E1            		POP	HL
  E6CA  C9            		RET
                      	
  E6CB                	SNCL16:
  E6CB  CD5CE6        		CALL	N16CL1		;GET NEXT CLUSTER for FAT16
  E6CE  D8            		RET	C
  E6CF  D5            		PUSH	DE
  E6D0  E5            		PUSH	HL
  E6D1  CDB0E6        		CALL	N16CL3
  E6D4  D1            		POP	DE		;HL
  E6D5  73            		LD	(HL),E
  E6D6  23            		INC	HL
  E6D7  72            		LD	(HL),D
  E6D8  6B            		LD	L,E
  E6D9  62            		LD	H,D
  E6DA  D1            		POP	DE
  E6DB  18CD          		JR	FAT_CHANGED
                      	
                      	;------------------------
                      	;次のセクタを探す際に_SECPSの値をチェック
                      	;in
                      	;	DE : セクタ番号
                      	;out
                      	;	DE : 次のセクタ番号
                      	;note
                      	;
                      	;------------------------
  E6DD                	NEXTX:
  E6DD  3E00          	_SECPS:	LD	A,0
  E6DF  3C            		INC	A
  E6E0  E600          	NCPAT:	AND	0	;自己書き換え　1クラスタの論理セクタ数-1
  E6E2  32DEE6        		LD	(_SECPS+1),A
  E6E5  C9            		RET
                      	
  E6E6                	GNCLX:
  E6E6  CDDDE6        		CALL	NEXTX
  E6E9  C0            		RET	NZ	;1クラスタのセクタ未満の場合は戻る
  E6EA  C3F7EC        		JP	_GNCL	;次のクラスタを探す
                      	
  E6ED                	RDFAT:
  E6ED  3E80          		LD	A,080H
  E6EF  327FEB        		LD	(CHECK),A
  E6F2                	RDFAT1:
  E6F2  3A88EC        		LD	A,(_DRV)
  E6F5  CDACE9        		CALL	CHGDRVR
  E6F8  D8            		RET	C
  E6F9  DD7E12        		LD	A,(IX+012H)	;DPB_12_DEVICE
  E6FC  CB6F          		BIT	5,A
  E6FE  CA1DE8        		JP	Z,RDFAT0X
  E701  217FEB        		LD	HL,CHECK
  E704  A6            		AND	(HL)
  E705  77            		LD	(HL),A
  E706  110000        		LD	DE,0		;BPB
  E709  2A7CEC        		LD	HL,(_FATBF)
  E70C  CD3DE8        		CALL	DRD16
  E70F  3024          		JR	NC,GET_BPB
  E711  217FEB        		LD	HL,CHECK
  E714  CB06          		RLC	(HL)
  E716  3F            		CCF
  E717  D8            		RET	C
  E718  DDCB0A1E      		RR	(IX+00AH)	;DPB_0A_FDMODE
  E71C  3F            		CCF			;フロッピーディスクのMFMモードを切り替える
  E71D  DDCB0A16      		RL	(IX+00AH)	;DPB_0A_FDMODE
  E721  3EFF          		LD	A,0FFH
  E723  3289EC        		LD	(_DSK),A
  E726  3A84EC        		LD	A,(_DRIVE)
  E729  E603          		AND	3
  E72B  F680          		OR	080H
  E72D  6F            		LD	L,A
  E72E  26EC          		LD	H,_CYL0/256
  E730  3EFF          		LD	A,0FFH
  E732  77            		LD	(HL),A
  E733  18BD          		JR	RDFAT1
  E735                	GET_BPB:
  E735  FDE5          		PUSH	IY
  E737  FD2A7CEC      		LD	IY,(_FATBF)	;BPB
                      	
  E73B  FD7E00        		LD	A,(IY+0)	;BS_JmpBoot
  E73E  FEEB          		CP	0EBH		;Short jump
  E740  280C          		JR	Z,BPBOK
  E742  FEE9          		CP	0E9H		;Near jump
  E744  2808          		JR	Z,BPBOK
  E746  FE60          		CP	060H		;X68k
  E748  2804          		JR	Z,BPBOK
  E74A                	NOT_BPB
  E74A  FDE1          		POP	IY
  E74C  37            		SCF
  E74D  C9            		RET
  E74E                	BPBOK:
  E74E  FD7E0D        		LD	A,(IY+13)	;BPB_SecPerClus
  E751  DD7707        		LD	(IX+7),A	;DPB_07_SECPCL
                      	
  E754  FD7E10        		LD	A,(IY+16)	;BPB_NumFATs
  E757  FE02          		CP	2		;>2:NC
  E759  FD7E0C        		LD	A,(IY+12)	;BPB_BytsPerSec
  E75C  3806          		JR	C,BPBFAT1
  E75E  FE05          		CP	5
  E760  30E8          		JR	NC,NOT_BPB	;1セクタ1024以上は無効
  E762  F680          		OR	080H
  E764                	BPBFAT1:
  E764  DD770F        		LD	(IX+00FH),A	;DPB_0F_BPS
                      	
  E767  FD7E16        		LD	A,(IY+22)	;BPB_FATSz16
  E76A  DD7700        		LD	(IX+0),A	;DPB_00_FATLN
  E76D  FD7E17        		LD	A,(IY+23)	;BPB_FATSz16
  E770  DD7701        		LD	(IX+1),A	;DPB_00_FATLN
                      	
  E773  FD6E0E        		LD	L,(IY+14)	;BPB_RsvdSecCnt
  E776  FD660F        		LD	H,(IY+15)
  E779  DD750E        		LD	(IX+00EH),L	;DPB_0E_FATPS
  E77C  FD5E16        		LD	E,(IY+22)	;BPB_FATSz16
  E77F  FD5617        		LD	D,(IY+23)
  E782  FD4610        		LD	B,(IY+16)	;BPB_NumFATs
  E785                	BPBDP1:				;BPB_FATSz16 * BPB_NumFATs
  E785  19            		ADD	HL,DE
  E786  10FD          		DJNZ	BPBDP1
  E788                	BPBDP2:
  E788  DD7510        		LD	(IX+010H),L	;DPB_10_DIRPS
  E78B  DD7411        		LD	(IX+011H),H
  E78E  E5            		PUSH	HL
                      	
  E78F  FD6E11        		LD	L,(IY+17)	;BPB_RootEntCnt
  E792  FD6612        		LD	H,(IY+18)
  E795  FD7E0C        		LD	A,(IY+12)	;BPB_BytsPerSec
  E798  0606          		LD	B,6
  E79A                	BPBBPS1:
  E79A  05            		DEC	B
  E79B  0F            		RRCA
  E79C  30FC          		JR	NC,BPBBPS1
  E79E                	BPBDE1:
  E79E  29            		ADD	HL,HL
  E79F  10FD          		DJNZ	BPBDE1
                      	
  E7A1  7C            		LD	A,H
  E7A2  DD770B        		LD	(IX+00BH),A	;DPB_0B_DIRSCNT
                      	
  E7A5  D1            		POP	DE		;DPB_10_DIRPS
  E7A6  6C            		LD	L,H
  E7A7  2600          		LD	H,0
  E7A9  19            		ADD	HL,DE		;MAXDIR
  E7AA  E5            		PUSH	HL
  E7AB  FD4E0D        		LD	C,(IY+13)	;BPB_SecPerClus
  E7AE  CB21          		SLA	C		;*2
  E7B0  AF            		XOR	A
  E7B1  47            		LD	B,A
  E7B2  ED42          		SBC	HL,BC
  E7B4  DD7514        		LD	(IX+014H),L	;DPB_14_ADDCL16
  E7B7  DD7415        		LD	(IX+015H),H
                      	
  E7BA  D1            		POP	DE		;DE=DPB_0B_MAXDIR
  E7BB  FD6E13        		LD	L,(IY+19)	;BPB_TotSec16
  E7BE  FD6614        		LD	H,(IY+20)
  E7C1  7C            		LD	A,H
  E7C2  B5            		OR	L		;ここでCF=0
  E7C3  3E00          		LD	A,0		;LDでフラグは変化しない。BPB_TotSec16を AHL で扱う為、Aに0を入れる
  E7C5  2010          		JR	NZ,BPB16BIT
  E7C7  FD7E23        		LD	A,(IY+35)	;BPB_TotSec16が「0」の場合はBPB_TotSec32で計算
  E7CA  B7            		OR	A
  E7CB                	NOT_BPB1:
  E7CB  C24AE7        		JP	NZ,NOT_BPB	;念のため(総セクタ数が24ビットを超える場合)
  E7CE  FD6E20        		LD	L,(IY+32)	;BPB_TotSec32 は AHL の24ビットで扱う
  E7D1  FD6621        		LD	H,(IY+33)	;1クラスタの論理セクタ数(DPB_07_SECPCL)が最大128なので
  E7D4  FD7E22        		LD	A,(IY+34)	;24ビットを超えると必ずクラスタ数が16ビットを超えてしまうのでこれで十分
  E7D7                	BPB16BIT:
  E7D7  ED52          		SBC	HL,DE		;CF=0のはず
  E7D9  DE00          		SBC	A,0
  E7DB  FD460D        		LD	B,(IY+13)	;BPB_SecPerClus
  E7DE                	BPBTC1:				;総クラスタ数(AHL) = 総セクタ数(AHL) / セクタサイズ(B)
  E7DE  CB18          		RR	B		;->CY
  E7E0  3808          		JR	C,BPBTC2
  E7E2  CB3F          		SRL	A
  E7E4  CB1C          		RR	H		;AHL=AHL/2
  E7E6  CB1D          		RR	L
  E7E8  18F4          		JR	BPBTC1
  E7EA                	BPBTC2:
  E7EA  B7            		OR	A
  E7EB  20DE          		JR	NZ,NOT_BPB1	;念のため(クラスタ数が16ビットを超える場合)
  E7ED  23            		INC	HL
  E7EE  23            		INC	HL
  E7EF  DD7508        		LD	(IX+8),L	;DPB_08_MAXCL
  E7F2  DD7409        		LD	(IX+9),H
                      	
  E7F5  FD7E15        		LD	A,(IY+21)	;BPB_Media
  E7F8  DD7706        		LD	(IX+6),A	;DPB_06_FATID
                      	
  E7FB  DDCB0A7E      		BIT	7,(IX+00AH)	;DPB_0A_FDMODE
  E7FF  2817          		JR	Z,NOT_FD
  E801  2E28          		LD	L,40		;MAXCYLの設定（要検討）ここから下はフロッピーのみ書き換える
  E803  FEFD          		CP	0FDH	;2D
  E805  2808          		JR	Z,SETCYL
  E807  2E4D          		LD	L,77
  E809  FEFE          		CP	0FEH	;2HD
  E80B  2802          		JR	Z,SETCYL
  E80D  2E50          		LD	L,80	;その他2DD等
  E80F                	SETCYL:
  E80F  DD750C        		LD	(IX+00CH),L	;DPB_0C_MAXCYL
  E812  FD7E18        		LD	A,(IY+24)	;BPB_SecPerTr
  E815  DD770D        		LD	(IX+00DH),A	;DPB_0D_MAXSEC
  E818                	NOT_FD:
  E818  FDE1          		POP	IY
  E81A  CDF9E8        		CALL	CHGDRV2
  E81D                	RDFAT0X:
  E81D  CD2CE8        		CALL	RDFATS
  E820  D8            		RET	C
  E821  DDBE06        		CP	(IX+6)		;DPB_06_FATID
  E824  C8            		RET	Z
  E825  DDCB126E      		BIT	5,(IX+012H)	;DPB_12_DEVICE
  E829  C0            		RET	NZ		;BPBを取得している場合はFATIDをチェックしない
  E82A  37            		SCF
  E82B  C9            		RET
                      	
  E82C                	RDFATS:
  E82C  CD7EE8        		CALL	FATSETUP
  E82F  D8            		RET	C
  E830                	RDFATL:
  E830  C5            		PUSH	BC
  E831  CD3DE8        		CALL	DRD16
  E834  C1            		POP	BC
  E835  D8            		RET	C
  E836  10F8          		DJNZ	RDFATL
  E838  2A7CEC        		LD	HL,(_FATBF)
  E83B  7E            		LD	A,(HL)
  E83C  C9            		RET
                      	
  E83D                	DRD16:
  E83D  0E00          		LD	C,0
  E83F                	DRD24:
  E83F  0601          		LD	B,1
  E841  DDE5          		PUSH	IX
  E843  DD2AA8EC      		LD	IX,(_DPB)
  E847  CDCBEA        	DRDPAT:	CALL	FDRD		;自己書き換え（ディスク読み込み）
  E84A                	POP_IX_RET:
  E84A  DDE1          		POP	IX
  E84C  C9            		RET
                      	
  E84D                	DWT16:
  E84D  0E00          		LD	C,0
  E84F                	DWT24:
  E84F  0601          		LD	B,1
  E851  DDE5          		PUSH	IX
  E853  DD2AA8EC      		LD	IX,(_DPB)
  E857  CDBDEA        	DWTPAT:	CALL	FDWT		;自己書き換え（ディスク書き込み）
  E85A  18EE          		JR	POP_IX_RET
                      	
  E85C                	WTFAT:
  E85C  CD7EE8        		CALL	FATSETUP
  E85F  D475E8        		CALL	NC,WTFATL
  E862  D8            		RET	C
  E863  DDCB0F7E      		BIT	7,(IX+00FH)	;DPB_0F_BPS
  E867  C8            		RET	Z		;予備FATが無い
  E868  CD85E8        		CALL	FATS2
  E86B  E5            		PUSH	HL		;予備FAT
  E86C  DD6E00        		LD	L,(IX+0)	;DPB_00_FATLN
  E86F  DD6601        		LD	H,(IX+1)
  E872  19            		ADD	HL,DE
  E873  EB            		EX	DE,HL
  E874  E1            		POP	HL
  E875                	WTFATL:
  E875  C5            		PUSH	BC
  E876  CD4DE8        		CALL	DWT16
  E879  C1            		POP	BC
  E87A  D8            		RET	C
  E87B  10F8          		DJNZ	WTFATL
  E87D  C9            		RET
                      	;------------------------
                      	;FATのセットアップ
                      	;out
                      	;	B  : FATセクタ数
                      	;	DE : FAT先頭セクタ番号
                      	;	HL : FATバッファポインタ
                      	;	CF : 1=ドライブ切り替えエラー
                      	;note
                      	;	FATサイズがFATバッファを超える場合は
                      	;	対象クラスタ領域==(_FATIX)によって
                      	;	FAT12:FATの前半3KBと後半3KBを切り替える
                      	;	FAT16:対象クラスタ1024毎に2KBを切り替える
                      	;------------------------
  E87E                	FATSETUP:
  E87E  3AAAEC        		LD	A,(_FATDRV)
  E881  CDACE9        		CALL	CHGDRVR		;ドライブ切り替え
  E884  D8            		RET	C
  E885                	FATS2:
  E885  ED5BFAEB      		LD	DE,(_FATPS)	;fat sector pos
  E889  C38CE8        	FATSX:	JP	FATSETUP12	;自己書き換え
                      	
  E88C                	FATSETUP12:
  E88C  2A7CEC        		LD	HL,(_FATBF)
  E88F  3E18          		LD	A,24		;3072 / 256 FATバッファに読み込めるセクタ数
  E891  DD460F        		LD	B,(IX+00FH)	;DPB_0F_BPS
  E894                	L_FATS2:
  E894  1F            		RRA			;CF=0 なので A=A/2
  E895  CB18          		RR	B		;->CF
  E897  30FB          		JR	NC,L_FATS2
                      	
  E899  DD4600        		LD	B,(IX+0)	;DPB_00_FATLN
  E89C  B8            		CP	B
  E89D  D0            		RET	NC		;DPB_00_FATLN x sectorSize < fatBufSize
                      	;targetCluster
  E89E  4F            		LD	C,A		;C = skipCount
  E89F  3AABEC        		LD	A,(_FATIX)	;(targetCluster >= 0x800)
  E8A2  B7            		OR	A
  E8A3  2806          		JR	Z,FATS3
                      	;(targerCluster>=0x800)
  E8A5                	FAT_SKP:
  E8A5  13            		INC	DE		;FATPS++
  E8A6  05            		DEC	B		;FATSIZE--
  E8A7  0D            		DEC	C		;skipCnt--
  E8A8  20FB          		JR	NZ,FAT_SKP
  E8AA  48            		LD	C,B
  E8AB                	FATS3:
  E8AB  41            		LD	B,C		;3 or 6 or 12
  E8AC  AF            		XOR	A
  E8AD  C9            		RET
                      	
  E8AE                	FATSETUP16:
  E8AE  DD7E0F        		LD	A,(IX+00FH)	;DPB_0F_BPS 512=2 1024=4
  E8B1  0610          		LD	B,16		;2048 / 256 FATバッファに読み込むセクタ数 512=4/1024=2
  E8B3  67            		LD	H,A		;DPB_0F_BPS
  E8B4                	L_F16S2:
  E8B4  CB38          		SRL	B		;/2
  E8B6  1F            		RRA			;->CF
  E8B7  30FB          		JR	NC,L_F16S2
                      	
  E8B9  7C            		LD	A,H		;DPB_0F_BPS
  E8BA  2AABEC        		LD	HL,(_FATIX)	;範囲は0-63(0-03FH):65535*2/2048
  E8BD  2600          		LD	H,0
  E8BF  4D            		LD	C,L		;_FATIX
  E8C0                	L_F16S3:
  E8C0  29            		ADD	HL,HL
  E8C1  87            		ADD	A,A
  E8C2  CB5F          		BIT	3,A
  E8C4  28FA          		JR	Z,L_F16S3
                      	
  E8C6  19            		ADD	HL,DE
  E8C7  EB            		EX	DE,HL
                      	
  E8C8  79            		LD	A,C		;_FATIX
  E8C9  DD6E00        		LD	L,(IX+0)	;DPB_00_FATLN
  E8CC  2D            		DEC	L		;DPB_00_FATLN-1
  E8CD  AD            		XOR	L		;Lと同じか比較してCFを0に
  E8CE  2005          		JR	NZ,F16E		;FATバッファが最後の場合はFATセクタ数を調整
  E8D0  7D            		LD	A,L		;DPB_00_FATLN-1
  E8D1  05            		DEC	B
  E8D2  A0            		AND	B
  E8D3  47            		LD	B,A
  E8D4  04            		INC	B
  E8D5                	F16E:
  E8D5  2A7CEC        		LD	HL,(_FATBF)
  E8D8  C9            		RET
                      	
  E8D9                	CHGDRV:
  E8D9  E5            		PUSH	HL
  E8DA  2189EC        		LD	HL,_DSK
  E8DD  BE            		CP	(HL)
  E8DE  280A          		JR	Z,CHGDRVE
  E8E0                	CHGDRV1:
  E8E0  DDE5          		PUSH	IX
  E8E2  CDECE8        		CALL	CHGDRV0
  E8E5  3A89EC        		LD	A,(_DSK)
  E8E8  DDE1          		POP	IX
  E8EA                	CHGDRVE:
  E8EA  E1            		POP	HL
  E8EB  C9            		RET
                      	
  E8EC                	CHGDRV0:
  E8EC  6F            		LD	L,A
  E8ED  CDDCEC        		CALL	_GETDPB
  E8F0  D8            		RET	C
  E8F1  DD22A8EC      		LD	(_DPB),IX
  E8F5  7D            		LD	A,L
  E8F6  3289EC        		LD	(_DSK),A
  E8F9                	CHGDRV2:
  E8F9  F3            		DI
  E8FA  C5            		PUSH	BC
  E8FB  D5            		PUSH	DE
  E8FC  ED7361E9      		LD	(SPPAT2+1),SP
                      	
  E900  DDF9          		LD	SP,IX
                      	
  E902  E1            		POP	HL		;DPB_00_FATLN
  E903  E1            		POP	HL		;DPB_02_DRD
  E904  2248E8        		LD	(DRDPAT+1),HL
                      	
  E907  E1            		POP	HL
  E908  2258E8        		LD	(DWTPAT+1),HL	;DPB_04_DWT
                      	
  E90B  E1            		POP	HL		;L=DPB_06_FATID H=DPB_07_SECPCL
  E90C  7C            		LD	A,H
  E90D  328FDF        		LD	(SPCPAT+1),A	;1クラスタの論理セクタ数
  E910  3D            		DEC	A
  E911  32E1E6        		LD	(NCPAT+1),A
                      	
  E914  E1            		POP	HL		;DPB_08_MAXCL
  E915  7D            		LD	A,L
  E916  32AEDF        		LD	(CLPAT2+1),A
  E919  7C            		LD	A,H
  E91A  32AADF        		LD	(CLPAT1+1),A
  E91D  2B            		DEC	HL
  E91E  22AEE1        		LD	(MAXCLP+1),HL
                      	
  E921  E1            		POP	HL		;L=DPB_0A_FDMODE H=DPB_0B_DIRSCNT
  E922  7D            		LD	A,L
  E923  F6FE          		OR	0FEH
  E925  3266EA        		LD	(FDMODE+1),A
  E928  07            		RLCA
  E929  E603          		AND	3
  E92B  324EEA        		LD	(FSPAT+1),A
  E92E  4C            		LD	C,H
                      	
  E92F  E1            		POP	HL		;L=DPB_0C_MAXCYL H=DPB_0D_MAXSEC
  E930  7D            		LD	A,L
  E931  32A1EC        		LD	(_MAXCYL),A
  E934  7C            		LD	A,H
  E935  32F7E9        		LD	(MAXSEC+1),A
                      	
  E938  E1            		POP	HL		;L=DPB_0E_FATPS H=DPB_0F_BPS
  E939  7C            		LD	A,H		;DPB_0F_BPS
  E93A  E607          		AND	7
  E93C  32EEE4        		LD	(SECSZ+2),A	;1セクタのサイズの上位1バイト 0x400 - 0x200 - 0x100
  E93F  3D            		DEC	A		;1セクタ512 2D/2DD/2HC/2HQ(2HD1.44MB)等
                      					;1セクタ1024 2HD/EMM/BRAM
                      					;1セクタ256 GRAM等
                      					;1024	512	256
  E940  32A8DE        		LD	(SECSZM1+2),A	;3	1	0	1セクタのサイズ-1したものの上位1バイト (0x3FF - 0x1FF - 0xFF)
  E943  3C            		INC	A		;4	2	1
  E944  87            		ADD	A,A		;8	4	2
  E945  87            		ADD	A,A		;010H	8	4
  E946  87            		ADD	A,A		;020H	010H	8
  E947  32FDDD        		LD	(SDECPAT+1),A	;1セクタ辺りのディレクトリエントリ数
  E94A  3D            		DEC	A		;01FH	00FH	7
  E94B  3268D4        		LD	(SDECM1+1),A	;1セクタ辺りのディレクトリエントリ数-1
                      	
  E94E  2600          		LD	H,0
  E950  22FAEB        		LD	(_FATPS),HL
                      	
  E953  E1            		POP	HL		;L=DPB_10_DIRPS
  E954  22FCEB        		LD	(_DIRPS),HL
                      	
  E957  E1            		POP	HL		;L=DPB_12_DEVICE H=DPB_13_UNITNO
  E958  7C            		LD	A,H
  E959  3284EC        		LD	(_DRIVE),A
                      	
  E95C  E1            		POP	HL		;DPB_14_ADDCL16
  E95D  229FDF        		LD	(CLSPAT+1),HL
                      	
  E960  310000        	SPPAT2:	LD	SP,0		;元のSPを復元
  E963  FB            		EI
  E964  2AFCEB        		LD	HL,(_DIRPS)
  E967  0600          		LD	B,0
  E969  09            		ADD	HL,BC
  E96A  2218DE        		LD	(MD_PAT+1),HL
                      	
  E96D  2AAEE1        		LD	HL,(MAXCLP+1);
  E970  11F60F        		LD	DE,4086
  E973  B7            		OR	A
  E974  ED52          		SBC	HL,DE
  E976  300F          		JR	NC,SETFAT16
  E978  2167E6        		LD	HL,GNCL		;FAT12
  E97B  118AE6        		LD	DE,SNCL
  E97E  018CE8        		LD	BC,FATSETUP12
  E981  DDCB0FAE      		RES	5,(IX+00FH)	;DPB_0F_BPS(FAT12)
  E985  180D          		JR	EXTRA1
  E987                	SETFAT16:
  E987  21BEE6        		LD	HL,GNCL16	;FAT16
  E98A  11CBE6        		LD	DE,SNCL16
  E98D  01AEE8        		LD	BC,FATSETUP16
  E990  DDCB0FEE      		SET	5,(IX+00FH)	;DPB_0F_BPS(FAT16)
  E994                	EXTRA1:
  E994  22F8EC        		LD	(GNCPAT+1),HL
  E997  ED53FBEC      		LD	(SNCPAT+1),DE
  E99B  ED438AE8      		LD	(FATSX+1),BC
  E99F  D1            		POP	DE
  E9A0  C1            		POP	BC
  E9A1  AF            		XOR	A
  E9A2  C9            		RET
                      	
  E9A3                	GETDPBD:
  E9A3  DDE3          		EX	(SP),IX
  E9A5  DDE5          		PUSH	IX
  E9A7  3A88EC        		LD	A,(_DRV)
  E9AA  1807          		JR	GETDPB1
                      	
  E9AC                	CHGDRVR:
  E9AC  CDD9EC        		CALL	_CHGDRV
  E9AF  D8            		RET	C
  E9B0  3A89EC        		LD	A,(_DSK)
  E9B3                	GETDPB1:
  E9B3  C3DCEC        		JP	_GETDPB
                      	
  E9B6                	GETDPB:
  E9B6  FE08          		CP	8
  E9B8  3F            		CCF
  E9B9  D8            		RET	C
  E9BA  0F            		RRCA
  E9BB  0F            		RRCA
  E9BC  0F            		RRCA
  E9BD  DD            		DB	0DDH		;Z80未定義命令
  E9BE  6F            		LD	L,A		;LD	IXL,A
  E9BF  DD            		DB	0DDH		;Z80未定義命令
  E9C0  26ED          		LD	H,DEVICE/256	;LD	IXH,DEVICE/256
  E9C2  DD7E00        		LD	A,(IX+0)	;DPB_00_FATLN
  E9C5  B7            		OR	A		;CF=0の為
  E9C6  DDCB0F76      		BIT	6,(IX+00FH)	;DPB_0F_BPS
  E9CA  C0            		RET	NZ		;FAT16
  E9CB  DDCB126E      		BIT	5,(IX+012H)	;DPB_12_DEVICE
  E9CF  C0            		RET	NZ		;BPB
  E9D0  FE01          		CP	001H		;A=0 THEN CF=1
  E9D2  C9            		RET
                      	
  E9D3                	FFLUSH:
  E9D3  F5            		PUSH	AF
  E9D4  3EFF          		LD	A,0FFH
  E9D6  327AE2        		LD	(SFILE),A
  E9D9  CDB1E5        		CALL	DWTX
  E9DC  3EFF          		LD	A,0FFH
  E9DE  32A5EC        		LD	(_DBDRV),A
  E9E1  CDFBE5        		CALL	WTFATX
  E9E4  AF            		XOR	A
  E9E5  32ABEC        		LD	(_FATIX),A
  E9E8  2F            		CPL
  E9E9  32AAEC        		LD	(_FATDRV),A
  E9EC  F1            		POP	AF
  E9ED  C9            		RET
                      	
                      	
                      	;LDDISK.ASM
                      	
                      	;	LSX-Dodgers DISK
                      	
                      	
  E9EE                	SEEK:
  E9EE  7A            		LD	A,D
  E9EF  B3            		OR	E
  E9F0  3E01          		LD	A,001H
  E9F2  2811          		JR	Z,DIV3
                      	
  E9F4  0610          		LD	B,16
  E9F6  0E00          	MAXSEC:	LD	C,000H
  E9F8  AF            		XOR	A
  E9F9  EB            		EX	DE,HL
  E9FA                	DIV1:
  E9FA  29            		ADD	HL,HL
  E9FB  8F            		ADC	A,A
  E9FC  B9            		CP	C
  E9FD  3802          		JR	C,DIV2
  E9FF  91            		SUB	C
  EA00  2C            		INC	L
  EA01                	DIV2:
  EA01  10F7          		DJNZ	DIV1
                      	
  EA03  3C            		INC	A	;最小のセクタは１固定
  EA04  55            		LD	D,L	;Quotient(TRACK)
  EA05                	DIV3:
  EA05  5F            		LD	E,A	;Remainder
  EA06  CB3A          		SRL	D	;CYLINDER
  EA08  9F            		SBC	A,A
  EA09  E610          		AND	010H	;SIDE
  EA0B  4F            		LD	C,A
                      	
  EA0C  3A84EC        		LD	A,(_DRIVE)
  EA0F  FE04          		CP	4
  EA11  3F            		CCF
  EA12  D8            		RET	C
  EA13  B1            		OR	C
  EA14  3292EA        		LD	(MOPAT+1),A	;Motor off data
  EA17  01FC0F        		LD	BC,00FFCH
  EA1A  F680          		OR	080H		;Mortor on
  EA1C  ED79          		OUT	(C),A
                      	
  EA1E  CD64EA        		CALL	SETMODE
  EA21  D8            		RET	C
                      	
  EA22  CDA7EA        		CALL	DRIVE
  EA25  FEFF          		CP	0FFH		;A=0FFH Unknown CYLINDER
  EA27  CC86EA        		CALL	Z,FDCRES	;Restore
  EA2A  0EF9          		LD	C,0F9H
  EA2C  ED79          		OUT	(C),A		;Currrent CYLINDER
  EA2E  92            		SUB	D
  EA2F  C8            		RET	Z		;No seek
                      	
  EA30  3A86EC        		LD	A,(_ISEEK)
  EA33  4F            		LD	C,A
                      	
  EA34  3AA1EC        		LD	A,(_MAXCYL)	;Max CYLINDER
  EA37  3D            		DEC	A
  EA38  BA            		CP	D		;Over CYLINDER
  EA39  D8            		RET	C
                      	
  EA3A  B9            		CP	C		;for Built-in 2DD
  EA3B  3803          		JR	C,SETM2
  EA3D  78            		LD	A,B		;B=00FH
  EA3E  DBFE          		IN	A,(0FEH)		;2HD mode for 2DD seek
  EA40                	SETM2:
  EA40  78            		LD	A,B
  EA41  DBFD          		IN	A,(0FDH)		;MFM mode
                      	
  EA43  0EFB          		LD	C,0FBH
  EA45  ED51          		OUT	(C),D
  EA47  72            		LD	(HL),D
  EA48  0E18          		LD	C,018H		;Seek
  EA4A                	FDCCMD2:
  EA4A  3A85EC        		LD	A,(_SEEKSP)
  EA4D  E6FF          	FSPAT:	AND	0FFH
  EA4F  B1            		OR	C
                      	
  EA50                	FDCCMD:
  EA50  CD9DEA        		CALL	COMSET
                      	
  EA53  3E80          	FDCPAT:	LD	A,080H		;FDC COMMAND(Self-rewriting)
  EA55  E620          		AND	020H		;Write data Write track
  EA57  3C            		INC	A
                      	
  EA58                	SST:
  EA58  0E00          		LD	C,0
  EA5A                	SST1:
  EA5A  0D            		DEC	C		; 4
  EA5B  20FD          		JR	NZ,SST1		;12 * 256 / 4 = About 1ms
  EA5D  3D            		DEC	A
  EA5E  20FA          		JR	NZ,SST1
                      	
  EA60  3C            		INC	A		;A=1
  EA61  CD6FEA        		CALL	READY
  EA64                	SETMODE:
  EA64  78            		LD	A,B		;B=00FH
  EA65  DBFF          	FDMODE:	IN	A,(0FFH)		;Floppy mode(2D/2HD) (Self-rewriting)
                      	
  EA67  78            		LD	A,B
  EA68  DBFD          		IN	A,(0FDH)		;MFM mode
                      	
  EA6A  CDA1EA        		CALL	DELAY0		;Head select time
  EA6D  3E81          		LD	A,081H
  EA6F                	READY:
  EA6F  3279EA        		LD	(WAITA+1),A
  EA72  E5            		PUSH	HL
  EA73  0EF8          		LD	C,0F8H
  EA75  61            		LD	H,C
  EA76                	READY2:
  EA76  ED78          		IN	A,(C)
  EA78  E681          	WAITA:	AND	081H		;NOT READY,BUSY
  EA7A  2808          		JR	Z,READYE
  EA7C  E3            		EX	(SP),HL		;wait 19clock
  EA7D  E3            		EX	(SP),HL		; //
  EA7E  2B            		DEC	HL
  EA7F  7C            		LD	A,H
  EA80  B5            		OR	L
  EA81  20F3          		JR	NZ,READY2
  EA83  37            		SCF
  EA84                	READYE:
  EA84  E1            		POP	HL
  EA85  C9            		RET
                      	
  EA86                	FDCRES:
  EA86  3600          		LD	(HL),0
  EA88  0E08          		LD	C,8
  EA8A  18BE          		JR	FDCCMD2
                      	
  EA8C                	FDMOFF:
  EA8C  F5            		PUSH	AF
  EA8D  C5            		PUSH	BC
  EA8E  01FC0F        		LD	BC,00FFCH	;Motor off
  EA91  3E00          	MOPAT:	LD	A,000H		;(Self-rewriting)
  EA93  ED79          		OUT	(C),A
  EA95  C1            		POP	BC
  EA96  F1            		POP	AF
  EA97  C9            		RET
                      	
  EA98                	SECSET:
  EA98  01FA0F        		LD	BC,00FFAH
  EA9B  ED59          		OUT	(C),E
  EA9D                	COMSET:
  EA9D  0EF8          		LD	C,0F8H
  EA9F  ED79          		OUT	(C),A
  EAA1                	DELAY0:
  EAA1  3E1A          		LD	A,26
  EAA3                	DELAY:
  EAA3  3D            		DEC	A
  EAA4  20FD          		JR	NZ,DELAY
  EAA6  C9            		RET
                      	
  EAA7                	DRIVE:
  EAA7  2A84EC        		LD	HL,(_DRIVE)
  EAAA  26EC          		LD	H,_CYL0/256
  EAAC  CBFD          		SET	7,L
  EAAE  7E            		LD	A,(HL)
  EAAF  C9            		RET
                      	
  EAB0                	RNF:
  EAB0  CDA7EA        		CALL	DRIVE
  EAB3  36FF          		LD	(HL),0FFH
  EAB5  C9            		RET
                      	
  EAB6  02            	RETRY:	DB	2
                      	
                      	
                      	;	FLOPPY DISK DRIVER(DMA)
                      	
                      	
  EAB7                	WTTRK:
  EAB7  0601          		LD	B,1
  EAB9  3EF4          		LD	A,0F4H
  EABB  1802          		JR	WTTRK1
  EABD                	FDWT:
  EABD  3EA0          		LD	A,0A0H
  EABF                	WTTRK1:
  EABF  3254EA        		LD	(FDCPAT+1),A
  EAC2  3E10          		LD	A,16
  EAC4  180C          		JR	DISK
                      	
  EAC6                	DISKOK:
  EAC6  0601          	FDCNT:	LD	B,1
  EAC8  100B          		DJNZ	DISK1
  EACA  C9            		RET
                      	
  EACB                	FDRD:
  EACB  3E80          		LD	A,080H
  EACD  3254EA        		LD	(FDCPAT+1),A
  EAD0  3E0E          		LD	A,14
                      	
  EAD2                	DISK:
  EAD2  32E9EA        		LD	(DMAPAT+1),A
  EAD5                	DISK1:
  EAD5  78            		LD	A,B
  EAD6  32C7EA        		LD	(FDCNT+1),A
  EAD9  226BEB        		LD	(DMAD+11),HL
  EADC                	DISKR:
  EADC  3E02          		LD	A,2		;Retry count
  EADE  32B6EA        		LD	(RETRY),A
  EAE1                	DISK2:
  EAE1  D5            		PUSH	DE
  EAE2  CDEEE9        		CALL	SEEK
  EAE5  3843          		JR	C,ERRF
  EAE7  F3            		DI
                      	
  EAE8  3E0E          	DMAPAT:	LD	A,14		;自己書き換え
  EAEA  2160EB        		LD	HL,DMAD
  EAED  CD69DB        		CALL	SETDMA
  EAF0  ED49          		OUT	(C),C		;OUT 01F87H,087H WR6 イネーブル
  EAF2  3A54EA        		LD	A,(FDCPAT+1)
  EAF5  C5            		PUSH	BC
  EAF6  CD98EA        		CALL	SECSET
  EAF9  2A6BEB        		LD	HL,(DMAHL)
  EAFC  23            		INC	HL
  EAFD  1106BB        		LD	DE,0BB06H	;READ DMA
                      	
  EB00  3E03          		LD	A,3
  EB02  CD6FEA        		CALL	READY
  EB05  ED78          		IN	A,(C)
                      	
  EB07  C1            		POP	BC
  EB08  ED51          		OUT	(C),D		;読み出しマスク設定
  EB0A  ED59          		OUT	(C),E		;バイトカウンタ(LH)
  EB0C  ED58          		IN	E,(C)
  EB0E  ED50          		IN	D,(C)
  EB10  19            		ADD	HL,DE
  EB11  D1            		POP	DE
  EB12  13            		INC	DE
  EB13  FB            		EI
  EB14  CD8CEA        		CALL	FDMOFF
  EB17  B7            		OR	A
  EB18  28AC          		JR	Z,DISKOK
  EB1A  1B            		DEC	DE
  EB1B  CB67          		BIT	4,A
  EB1D  C4B0EA        		CALL	NZ,RNF
  EB20                	DISKE2:
  EB20  21B6EA        		LD	HL,RETRY
  EB23  35            		DEC	(HL)
  EB24  20BB          		JR	NZ,DISK2
  EB26  B7            		OR	A
  EB27  2834          		JR	Z,ERR
  EB29  D5            		PUSH	DE
  EB2A                	ERRF:
  EB2A  D1            		POP	DE
  EB2B                	DELP:
  EB2B  CDB0EA        		CALL	RNF
  EB2E  CD8CEA        		CALL	FDMOFF
  EB31  3A85EC        		LD	A,(_SEEKSP)
  EB34  87            		ADD	A,A
  EB35  9F            		SBC	A,A
  EB36  3825          		JR	C,ERR
  EB38                	DELP1:
  EB38  D5            		PUSH	DE
  EB39  21C0EB        		LD	HL,DEMES
  EB3C  CD61D8        		CALL	MSX
  EB3F  CD4CD7        		CALL	KEYBC
  EB42                	DELP2:
  EB42  CDCAEC        		CALL	_INKEY
  EB45  28FB          		JR	Z,DELP2
                      	
  EB47  D1            		POP	DE
  EB48  CDB0DF        		CALL	CAP
  EB4B  FE52          		CP	'R'		;Retry
  EB4D  CADCEA        		JP	Z,DISKR
  EB50  FE49          		CP	'I'		;Ignore
  EB52  2807          		JR	Z,IGNORE
  EB54  FE41          		CP	'A'		;Abort
  EB56  20E0          		JR	NZ,DELP1
  EB58  C366D3        		JP	BOOT
  EB5B                	IGNORE:
  EB5B  3EFF          		LD	A,0FFH
  EB5D                	ERR:
  EB5D  BF            		CP	A
  EB5E  37            		SCF
  EB5F  C9            		RET
                      	
                      				;X1turbo DISK DMA
  EB60  C3            	DMAD:	DB	0C3H	;WR6 リセット
  EB61  7D            		DB	07DH	;WR0 ポートA→ポートB 転送
  EB62  FB0F          		DW	00FFBH	;ポートA開始アドレス FDC データレジスタ
  EB64  FFFF          		DW	0FFFFH	;ブロック長(転送サイズ-1)
  EB66  2C            		DB	02CH	;WR1 ポートAアドレス固定 I/O
  EB67  10            		DB	010H	;WR2 ポートBインクリメント
  EB68  80            		DB	080H	;WR3
  EB69  92            		DB	092H	;WR5 WAIT RDY:LOW
  EB6A  8D            		DB	08DH	;WR4 バイト ポートB開始アドレス(LH)
  EB6B  0000          	DMAHL:	DW	0	;ポートB開始アドレス
  EB6D  CF            		DB	0CFH	;WR6 ロード
  EB6E  01            		DB	001H	;WR0 ポートB←ポートB 転送
  EB6F  CF            		DB	0CFH	;WR6 ロード
                      	
  EB70                	DMAE:
                      	
  2004                	AT_R	EQU	WTTRK-AT_WTTRK
                      	
                      	;LDCALL.ASM
                      	
                      	;	LSX-Dodgers TABLES
                      	
  EB70  008E01000B000C	BEEPD:	DB	0,08EH,1,0,00BH,0,00CH,010H
  EB78  073E08100D00FF		DB	007H,03EH,008H,010H,00DH,0,0FFH
                      	
  EB7F  00            	CHECK:	DB	0
                      	
                      	;	CTRLTB:アドレス下位1バイトが080Hになるように
                      	
  EB80                	CTRLTB:
  EB80  90D92BDAC8D91B		DW	PRINTE,CTRL01,CTRL02,CTRL03
  EB88  15DBF3D9F4DA7B		DW	CTRL04,CTRL05,CTRL1A,CTRL07
  EB90  9CD9B9D91EDB31		DW	CTRL08,CTRL09,CTRL0A,CTRL0B
  EB98  F1DA17DA33DB90		DW	CTRL0C,CTRL0D,CTRL0E,PRINTE
  EBA0  90D990D92BDA90		DW	PRINTE,PRINTE,CTRL01,PRINTE
  EBA8  90D990D990D990		DW	PRINTE,PRINTE,PRINTE,PRINTE
  EBB0  90D990D9F4DA3E		DW	PRINTE,PRINTE,CTRL1A,CTRL1B
  EBB8  B3D99CD9A6D91E		DW	CTRL1C,CTRL1D,CTRL1E,CTRL1F
                      	
  EBC0  0307          	DEMES:	DB	3,7
  EBC2  44657669636520		DB	"Device I/O Error",5,3
  EBD4  41626F72742052		DB	"Abort Retry Ignore?",5,3,0
                      	
  EBEA  1617          	SDDATA:	DB	22,23		;(FCB)ファイルを最後に変更した時刻
  EBEC  1415          		DB	20,21		;(FCB)ファイルを最後に変更した日付
  EBEE  1A1B          		DB	26,27		;(FCB)ファイルの先頭クラスタ
  EBF0  10111213      		DB	16,17,18,19	;(FCB)ファイルのサイズ(バイト単位)
  EBF4                	SDDATAE:
                      	
  EBF4                	SCDIR:	DS	2		;+14 +15
  EBF6                	SFBPS:	DS	2		;FBPS
  EBF8                	SFNDF:	DS	2		;FILEN DIRF
                      	
  EBFA  0000          	_FATPS:	DW	0
  EBFC  0000          	_DIRPS:	DW	0
  EBFE  0000          	_CLPS:	DW	0
                      	
  EC00                	_PE:
                      	
                      	;	LSX-Dodgers SYSTEM CALL
                      	;	STABLE:アドレス下位1バイトが0になるように
                      	
  EC00                	STABLE:
                      	;0
  EC00  000080D78CD7A8		DW	 00000H,_SYS01,_SYS02,_SYS03
  EC08  A6D3A6D391D76F		DW	_SYS04,_SYS05,_SYS06,_SYS07
  EC10  99D7ABD3D2D7FE		DW	_SYS08,_SYS09,_SYS0A,_SYS0B
  EC18  BAD3C0D3CFD3E2		DW	_SYS0C,_SYS0D,_SYS0E,_SYS0F
                      	;1
  EC20  36D488D4EED424		DW	_SYS10,_SYS11,_SYS12,_SYS13
  EC28  2CD54AD567D55F		DW	_SYS14,_SYS15,_SYS16,_SYS17
  EC30  C8D5CDD5D2D5D8		DW	_SYS18,_SYS19,_SYS1A,_SYS1B
  EC38  A6D3FED5A6D302		DW	_SYS1C,_SYS1D,_SYS1E,_SYS1F
                      	;2
  EC40  A6D39ED5B3D509		DW	_SYS20,_SYS21,_SYS22,_SYS23
  EC48  28D6A6D3D4E2FB		DW	_SYS24,_ERROR,_SYS26,_SYS27
  EC50  B3D531D614D8A8		DW	_SYS28,_SYS29,_SYS2A,_SYS2B
  EC58  48D8A8D3A6D354		DW	_SYS2C,_SYS2D,_SYS2E,_SYS2F
                      	;3
  EC60  4ED6          		DW	_SYS30
                      	
                      	;LDWORK.ASM
                      	
                      	;	LSX-Dodgers WORK
                      	
  0004                	DDS	EQU	4
  EC62                	DDTB:
  EC62  434F4E20      		DB	"CON "
  EC66  7BD4          		DW	OPENDD
  EC68  41555820      		DB	"AUX "
  EC6C  7BD4          		DW	OPENDD
  EC6E  50524E20      		DB	"PRN "
  EC72  7BD4          		DW	OPENDD
  EC74  4E554C20      		DB	"NUL "
  EC78  7BD4          		DW	OPENDD
                      	
  EC7A                		DS	2
  EC7C  00EE          	_FATBF:	DW	FATBF
  EC7E  00FA          	_DTBUF:	DW	DTBUF
                      	
                      	;	_CYL0:アドレス下位1バイトが080Hになるように
  EC80  FF            	_CYL0:	DB	0FFH	;Cylinder
  EC81  FF            	_CYL1:	DB	0FFH	;Cylinder
  EC82  FF            	_CYL2:	DB	0FFH	;Cylinder
  EC83  FF            	_CYL3:	DB	0FFH	;Cylinder
  EC84  00            	_DRIVE:	DB	0	;unit number
  EC85  00            	_SEEKSP:DB	0	;Seek speed
  EC86  FF            	_ISEEK:	DB	0FFH	;
  EC87  00            	_DVSW:	DB	0
  EC88  00            	_DRV:	DB	0
  EC89  FF            	_DSK:	DB	0FFH
  EC8A  8000          	_DTA:	DW	00080H
  EC8C  0000          	_CTC:	DW	0
  EC8E  0000          	_TXADR:	DW	0
  EC90  0000          	_KEYPS	DW	0
  EC92  00FF          	_KEYD	DW	0FF00H
  EC94  C210          	_KEYSP:	DW	010C2H
  EC96  07            	_COLORF:DB	7
  EC97  19            	_LINE:	DB	LINE
                      	
  EC98  0000          	_FCB:	DW	0
  EC9A  0000          	_FBPS:	DW	0	;SEARCH FILES
  EC9C  0000          	_FBAD:	DW	0	;    //
  EC9E  00            	_FBCNT:	DB	0	;    //
  EC9F  00            	_FILEN:	DB	0
  ECA0  00            	_DIRF:	DB	0	;bit7:ディレクトリ bit0-6:セクタインデックス 
  ECA1  00            	_MAXCYL:DB	0
  ECA2  00            	_WTFATF:DB	0	;FATバッファの更新フラグ
  ECA3                			DS	1
  ECA4  00            	_WTDBF:	DB	0	;データバッファの更新フラグ
  ECA5  FF            	_DBDRV:	DB	0FFH	;データバッファにあるデータを読み込んだドライブ
  ECA6  0000          	_DBSEC:	DW	0	;データバッファにあるデータを読み込んだセクタ番号
  ECA8  0000          	_DPB:	DW	0
  ECAA  FF            	_FATDRV:DB	0FFH	;FATバッファに読み込んでいるドライブ
  ECAB  00            	_FATIX:	DB	0	;FATバッファに読み込んでいるインデックス
  ECAC  0000          	_FAKEFREE:	DW	0	;偽の残量（FATサイズが大きくなると重くなるのでその対策）
                      	
  ECAE                		DS	2
                      	
  ECB0  6F5059381F0219	CRTCD:	DB	06FH,050H,059H,038H,01FH,002H,019H,01CH
  ECB8  0007          		DB	000H,007H
  ECBA  30F8B0FF      		DW	0-80*LINE,0-80
  ECBE  0C            		DB	00CH
  ECBF  A0            	WK1FD0:	DB	0A0H
                      	
  ECC0  B6D6          	CTC0:	DW	INTCTCE
  ECC2  B6D6          	CTC1:	DW	INTCTCE
  ECC4  D8D6          	CTC2:	DW	INTCTC2
  ECC6  B6D6          	CTC3:	DW	INTCTCE
  ECC8  9DD6          	INTVEC:	DW	INT
                      	
                      	;	JUMP
                      	
  ECCA  C36EDC        	_INKEY:	JP	INKEY
  ECCD  C3D9D8        	_PRINT:	JP	PRINT
  ECD0  C3B9DB        	_SCRN:	JP	SCRN
  ECD3  C3E1DB        	_POS:	JP	POS
  ECD6  C31CDA        	_LOC:	JP	LOC
  ECD9  C3D9E8        	_CHGDRV:JP	CHGDRV
  ECDC  C3B6E9        	_GETDPB:JP	GETDPB
  ECDF  C3D3E9        	_FFLUSH:JP	FFLUSH
  ECE2  C3D1E5        	_RDFATX:JP	RDFATX
  ECE5  C3EDE6        	_RDFAT:	JP	RDFAT
  ECE8  C3B7EA        	_WTTRK:	JP	WTTRK
  ECEB  C3CBEA        	_FDRD:	JP	FDRD
  ECEE  C3BDEA        	_FDWT:	JP	FDWT
  ECF1  C33DE8        	_DRD:	JP	DRD16
  ECF4  C34DE8        	_DWT:	JP	DWT16
  ECF7                	_GNCL:
  ECF7  C367E6        	GNCPAT:	JP	GNCL		;自己書き換え
  ECFA                	_SNCL:
  ECFA  C38AE6        	SNCPAT:	JP	SNCL		;自己書き換え
  ECFD  C39FCC        	_COMANL:JP	COMANL
                      	
  ED00                	WE:
                      	
                      	;LDDPB.ASM
                      	
                      	;	LSX-Dodgers DPB
                      	
  ED00                	DEVICE:
                      	
                      	;	A:
                      	
  ED00  0200          		DW	2	;DPB_00_FATLN
  ED02  EBEC          		DW	_FDRD	;DPB_02_DRD
  ED04  EEEC          		DW	_FDWT	;DPB_04_DWT
  ED06  FD            		DB	0FDH	;DPB_06_FATID
  ED07  02            		DB	2	;DPB_07_SECPCL
  ED08  6401          		DW	356	;DPB_08_MAXCL
  ED0A  FF            		DB	0FFH	;DPB_0A_FDMODE	0FFH=2D / 0FEH=2HD
  ED0B  07            		DB	7	;DPB_0B_DIRSCNT
  ED0C  28            		DB	40	;DPB_0C_MAXCYL
  ED0D  09            		DB	9	;DPB_0D_MAXSEC	Number of sectors
  ED0E  01            		DB	1	;DPB_0E_FATPS
  ED0F  82            		DB	082H	;DPB_0F_BPS
  ED10  0500          		DW	5	;DPB_10_DIRPS
  ED12  A7            		DB	0A7H	;DPB_12_DEVICE	Device Number
  ED13  00            		DB	0	;DPB_13_UNITNO
  ED14  0800          		DW	8	;DPB_14_ADDCL16
  ED16  0000          		DW	0	;DPB_16
  ED18  0000          		DW	0	;DPB_18
  ED1A  0000          		DW	0	;DPB_1A_SDIR
  ED1C  46444430      		DB	"FDD0"	;DPB_1C_NAME
                      	
                      	;	B:
                      	
  ED20  0200          		DW	2	;DPB_00_FATLN
  ED22  EBEC          		DW	_FDRD	;DPB_02_DRD
  ED24  EEEC          		DW	_FDWT	;DPB_04_DWT
  ED26  FD            		DB	0FDH	;DPB_06_FATID
  ED27  02            		DB	2	;DPB_07_SECPCL
  ED28  6401          		DW	356	;DPB_08_MAXCL
  ED2A  FF            		DB	0FFH	;DPB_0A_FDMODE	0FFH=2D / 0FEH=2HD
  ED2B  07            		DB	7	;DPB_0B_DIRSCNT
  ED2C  28            		DB	40	;DPB_0C_MAXCYL
  ED2D  09            		DB	9	;DPB_0D_MAXSEC	Number of sectors
  ED2E  01            		DB	1	;DPB_0E_FATPS
  ED2F  82            		DB	082H	;DPB_0F_BPS
  ED30  0500          		DW	5	;DPB_10_DIRPS
  ED32  A7            		DB	0A7H	;DPB_12_DEVICE	Device Number
  ED33  01            		DB	1	;DPB_13_UNITNO
  ED34  0800          		DW	8	;DPB_14_ADDCL16
  ED36  0000          		DW	0	;DPB_16
  ED38  0000          		DW	0	;DPB_18
  ED3A  0000          		DW	0	;DPB_1A_SDIR
  ED3C  46444431      		DB	"FDD1"	;DPB_1C_NAME
                      	
                      	;	C:
                      	
  ED40  0200          		DW	2	;DPB_00_FATLN
  ED42  EBEC          		DW	_FDRD	;DPB_02_DRD
  ED44  EEEC          		DW	_FDWT	;DPB_04_DWT
  ED46  FD            		DB	0FDH	;DPB_06_FATID
  ED47  02            		DB	2	;DPB_07_SECPCL
  ED48  6401          		DW	356	;DPB_08_MAXCL
  ED4A  FF            		DB	0FFH	;DPB_0A_FDMODE	0FFH=2D / 0FEH=2HD
  ED4B  07            		DB	7	;DPB_0B_DIRSCNT
  ED4C  28            		DB	40	;DPB_0C_MAXCYL
  ED4D  09            		DB	9	;DPB_0D_MAXSEC	Number of sectors
  ED4E  01            		DB	1	;DPB_0E_FATPS
  ED4F  82            		DB	082H	;DPB_0F_BPS
  ED50  0500          		DW	5	;DPB_10_DIRPS
  ED52  A7            		DB	0A7H	;DPB_12_DEVICE	Device Number
  ED53  02            		DB	2	;DPB_13_UNITNO
  ED54  0800          		DW	8	;DPB_14_ADDCL16
  ED56  0000          		DW	0	;DPB_16
  ED58  0000          		DW	0	;DPB_18
  ED5A  0000          		DW	0	;DPB_1A_SDIR
  ED5C  46444432      		DB	"FDD2"	;DPB_1C_NAME
                      	
                      	;	D:
                      	
  ED60  0200          		DW	2	;DPB_00_FATLN
  ED62  EBEC          		DW	_FDRD	;DPB_02_DRD
  ED64  EEEC          		DW	_FDWT	;DPB_04_DWT
  ED66  FD            		DB	0FDH	;DPB_06_FATID
  ED67  02            		DB	2	;DPB_07_SECPCL
  ED68  6401          		DW	356	;DPB_08_MAXCL
  ED6A  FF            		DB	0FFH	;DPB_0A_FDMODE	0FFH=2D / 0FEH=2HD
  ED6B  07            		DB	7	;DPB_0B_DIRSCNT
  ED6C  28            		DB	40	;DPB_0C_MAXCYL
  ED6D  09            		DB	9	;DPB_0D_MAXSEC	Number of sectors
  ED6E  01            		DB	1	;DPB_0E_FATPS
  ED6F  82            		DB	082H	;DPB_0F_BPS
  ED70  0500          		DW	5	;DPB_10_DIRPS
  ED72  A7            		DB	0A7H	;DPB_12_DEVICE
  ED73  03            		DB	3	;DPB_13_UNITNO
  ED74  0800          		DW	8	;DPB_14_ADDCL16
  ED76  0000          		DW	0	;DPB_16
  ED78  0000          		DW	0	;DPB_18
  ED7A  0000          		DW	0	;DPB_1A_SDIR
  ED7C  46444433      		DB	"FDD3"	;DPB_1C_NAME
                      	
                      	;	E:
                      	
  ED80  0000          	EMMFL:	DW	0	;DPB_00_FATLN
  ED82  1AD3          	EMMRD:	DW	EDRD	;DPB_02_DRD
  ED84  16D3          	EMMWR:	DW	EDWT	;DPB_04_DWT
  ED86  FE            		DB	0FEH	;DPB_06_FATID
  ED87  01            		DB	1	;DPB_07_SECPCL
  ED88  0000          	EMMCL:	DW	0	;DPB_08_MAXCL
  ED8A  00            		DB	0	;DPB_0A_FDMODE
  ED8B  06            		DB	6	;DPB_0B_DIRSCNT
  ED8C  00            	EMMBL:	DB	0	;DPB_0C_MAXCYL
  ED8D  01            		DB	1	;DPB_0D_MAXSEC
  ED8E  01            		DB	1	;DPB_0E_FATPS
  ED8F  04            		DB	4	;DPB_0F_BPS
  ED90  0500          		DW	5	;DPB_10_DIRPS
  ED92  06            		DB	6	;DPB_12_DEVICE
  ED93  00            	EMMDV:	DB	0	;DPB_13_UNITNO
  ED94  0900          		DW	9	;DPB_14_ADDCL16
  ED96  0000          		DW	0	;DPB_16
  ED98  0000          		DW	0	;DPB_18
  ED9A  0000          		DW	0	;DPB_1A_SDIR
  ED9C  454D4D30      		DB	"EMM0"	;DPB_1C_NAME
                      	
                      	;	F:
                      	
  EDA0  0000          	BANKFL:	DW	0	;DPB_00_FATLN
  EDA2  8FD2          		DW	BDRD	;DPB_02_DRD
  EDA4  B1D2          		DW	BDWT	;DPB_04_DWT
  EDA6  F9            		DB	0F9H	;DPB_06_FATID
  EDA7  01            		DB	1	;DPB_07_SECPCL
  EDA8  0000          	BANKCL:	DW	0	;DPB_08_MAXCL
  EDAA  00            		DB	0	;DPB_0A_FDMODE
  EDAB  04            		DB	4	;DPB_0B_DIRSCNT
  EDAC  00            		DB	0	;DPB_0C_MAXCYL
  EDAD  01            		DB	1	;DPB_0D_MAXSEC
  EDAE  00            		DB	0	;DPB_0E_FATPS
  EDAF  04            		DB	4	;DPB_0F_BPS
  EDB0  0100          		DW	1	;DPB_10_DIRPS
  EDB2  0B            		DB	00BH	;DPB_12_DEVICE
  EDB3  00            		DB	0	;DPB_13_UNITNO
  EDB4  0300          		DW	3	;DPB_14_ADDCL16
  EDB6  0000          		DW	0	;DPB_16
  EDB8  0000          		DW	0	;DPB_18
  EDBA  0000          		DW	0	;DPB_1A_SDIR
  EDBC  4252414D      		DB	"BRAM"	;DPB_1C_NAME
                      	
                      	;	G:
                      	
  EDC0  0100          		DW	1	;DPB_00_FATLN
  EDC2  50D2          		DW	GDRD	;DPB_02_DRD
  EDC4  67D2          		DW	GDWT	;DPB_04_DWT
  EDC6  F9            		DB	0F9H	;DPB_06_FATID
  EDC7  04            		DB	4	;DPB_07_SECPCL
  EDC8  3000          		DW	48	;DPB_08_MAXCL
  EDCA  00            		DB	0	;DPB_0A_FDMODE
  EDCB  04            		DB	4	;DPB_0B_DIRSCNT
  EDCC  00            		DB	0	;DPB_0C_MAXCYL
  EDCD  01            		DB	1	;DPB_0D_MAXSEC
  EDCE  00            		DB	0	;DPB_0E_FATPS
  EDCF  01            		DB	1	;DPB_0F_BPS
  EDD0  0400          		DW	4	;DPB_10_DIRPS
  EDD2  05            		DB	5	;DPB_12_DEVICE
  EDD3  01            		DB	1	;DPB_13_UNITNO
  EDD4  0000          		DW	0	;DPB_14_ADDCL16
  EDD6  0000          		DW	0	;DPB_16
  EDD8  0000          		DW	0	;DPB_18
  EDDA  0000          		DW	0	;DPB_1A_SDIR
  EDDC  4752414D      		DB	"GRAM"	;DPB_1C_NAME
                      	
                      	
                      	
  EDE0  00            	LDEND:	DB	0
                      	
  EDE1                		END
