			  Z80 ASSEMBLER - ZASM VER 1.6
                      	;	LSX-Dodgers for X1/turbo/Z
                      	;	Programmed by
                      	;	Gaku (Lovers/Tablacus)
                      	
  C600                	RUN	EQU	0C600h
                      	
  C5F9                		ORG	RUN-7
                      	
                      	;	MSX BINARY HEADER
  C5F9  FE            		DB	0FEH
                      	;	MSX BINARY START ADDRESS
  C5FA  00C6          		DW	RUN
                      	;	MSX BINARY END ADDRESS
  C5FC  E0ED          		DW	LDEND
                      	;	MSX BINARY EXEC ADDRESS
  C5FE  00C6          		DW	RUN
                      	;LDDEF.ASM
                      	
                      	;	LSX-Dodgers DEF
                      	
  1D80                	MAC	EQU	01D80H		;X1
  0001                	VER_1   EQU	1
  0003                	VER_2   EQU	3
  0001                	VER_3   EQU	1
  0131                	VER	EQU	VER_1 * 256 + VER_2 * 16 + VER_3
                      	
  0000                	STACK	EQU	00000H
  0005                	SYSTEM	EQU	00005H
  000F                	JP_HL	EQU	0000FH
  005C                	FCB1	EQU	0005CH
  006C                	FCB2	EQU	0006CH
  0080                	DTA1	EQU	00080H
  00DB                	FDRV	EQU	00100H-37
  00DC                	FNAME	EQU	FDRV+1
  00D6                	DECBF	EQU	FDRV-5
  EE00                	FATBF	EQU	0EE00H
  FA00                	DTBUF	EQU	0FA00H
  FE00                	KEYBF	EQU	0FE00H
  FF00                	KBUF	EQU	0FF00H
  FF51                	DTA	EQU	KBUF+81
  FFD4                	EXTSP	EQU	0FFD4H
  0019                	LINE	EQU	25
                      	
                      	;LDINIT.ASM
                      	
                      	;	LSX-Dodgers INIT
                      	
  C600  C307C6        		JP	START
  C603  801D          	MACHINE:DW	MAC
  C605  3101          	VERSION:DW	VER
                      	
  C607                	START:
  C607  F3            		DI
  C608  ED5E          		IM	2
  C60A  310000        		LD	SP,STACK
  C60D  CD1BC6        		CALL	INIT		;NZならAUTOEXECを実行
  C610  210000        		LD	HL,0
  C613  E5            		PUSH	HL
  C614  C8            		RET	Z
  C615  11B3C9        		LD	DE,AUTOD
  C618  C3FDEC        		JP	_COMANL
                      	
  C61B                	INIT:
  C61B  3E1E          		LD	A,01EH
  C61D  D300          		OUT	(0),A
                      	
  C61F  010000        		LD	BC,0
  C622  ED438CEC      		LD	(_CTC),BC
  C626  01040A        		LD	BC,00A04H
  C629  CD6DC9        		CALL	CHKCTC
  C62C  010407        		LD	BC,00704H
  C62F  CD6DC9        		CALL	CHKCTC
  C632  01A81F        		LD	BC,01FA8H
  C635  CD6DC9        		CALL	CHKCTC
  C638  01A01F        		LD	BC,01FA0H
  C63B  CD6DC9        		CALL	CHKCTC
                      	;
  C63E                	INISIO:
  C63E  01911F        		LD	BC,01F91H	;INIT SIO
  C641  1601          		LD	D,1
  C643  ED51          		OUT	(C),D
                      	;	OUT	(C),0		;未定義命令ニーモニック
  C645  ED71          		DB	0EDH,071H
  C647  0E93          		LD	C,093H
  C649  ED51          		OUT	(C),D
                      	;	OUT	(C),0		;未定義命令ニーモニック
  C64B  ED71          		DB	0EDH,071H
  C64D  0E99          		LD	C,099H		;INIT SIO
  C64F  1601          		LD	D,1
  C651  ED51          		OUT	(C),D
                      	;	OUT	(C),0		;未定義命令ニーモニック
  C653  ED71          		DB	0EDH,071H
  C655  0E9B          		LD	C,09BH
  C657  ED51          		OUT	(C),D
                      	;	OUT	(C),0		;未定義命令ニーモニック
  C659  ED71          		DB	0EDH,071H
                      	
  C65B  0E80          		LD	C,080H		;INIT DMA
  C65D  2106C3        		LD	HL,0C306H
  C660                	INIDMA:
  C660  ED61          		OUT	(C),H
  C662  2D            		DEC	L
  C663  20FB          		JR	NZ,INIDMA
                      	
  C665  3EE4          		LD	A,0E4H
  C667  CD0DDB        		CALL	COMOUT
  C66A  AF            		XOR	A
  C66B  CDE7DA        		CALL	OT49SB
                      	
  C66E  3EEC          		LD	A,INTVEC/256
  C670  ED47          		LD	I,A
                      	
  C672  ED4B8CEC      		LD	BC,(_CTC)
  C676  0B            		DEC	BC
  C677  0B            		DEC	BC
                      	
                      	;	OUT	(C),0		;未定義命令ニーモニック
  C678  ED71          		DB	0EDH,071H
  C67A  3EC0          		LD	A,CTC0
  C67C  ED79          		OUT	(C),A
                      	
  C67E  0C            		INC	C
  C67F  3E47          		LD	A,047H
  C681  ED79          		OUT	(C),A
  C683  3E0D          		LD	A,13		;Baudrate 9600-13
  C685  ED79          		OUT	(C),A
                      	
  C687  79            		LD	A,C
  C688  D610          		SUB	010H
  C68A  4F            		LD	C,A
  C68B  ED431DCC      		LD	(SIOAD+1),BC
  C68F  ED4346CC      		LD	(SIOAD0+1),BC
  C693  ED434CCC      		LD	(SIOAD1+1),BC
                      	
  C697  2115CA        		LD	HL,SIODATA
  C69A                	SINIT1:
  C69A  7E            		LD	A,(HL)
  C69B  23            		INC	HL
  C69C  FEFF          		CP	0FFH
  C69E  2804          		JR	Z,SINIT2
  C6A0  ED79          		OUT	(C),A
  C6A2  18F6          		JR	SINIT1
  C6A4                	SINIT2:
  C6A4  3EE4          		LD	A,0E4H
  C6A6  CD0DDB        		CALL	COMOUT
  C6A9  3EC8          		LD	A,INTVEC
  C6AB  CDE7DA        		CALL	OT49SB
                      	;
  C6AE  01C41F        		LD	BC,01FC4H
  C6B1  3E0C          		LD	A,00CH
  C6B3  ED79          		OUT	(C),A
                      	
  C6B5  0EC0          		LD	C,0C0H
                      	;	OUT	(C),0		;未定義命令ニーモニック
  C6B7  ED71          		DB	0EDH,071H
                      	
  C6B9  0C            		INC	C
  C6BA  3E28          		LD	A,40
  C6BC  ED79          		OUT	(C),A
                      	
  C6BE  0C            		INC	C
                      	;	OUT	(C),0		;未定義命令ニーモニック
  C6BF  ED71          		DB	0EDH,071H
                      	
  C6C1  0C            		INC	C
                      	;	OUT	(C),0		;未定義命令ニーモニック
  C6C2  ED71          		DB	0EDH,071H
                      	
  C6C4  0EC5          		LD	C,0C5H
                      	;	OUT	(C),0		;未定義命令ニーモニック
  C6C6  ED71          		DB	0EDH,071H
                      	
  C6C8                	TEXT:
  C6C8  0EB0          		LD	C,0B0H
  C6CA  3E80          		LD	A,080H
  C6CC  ED79          		OUT	(C),A
  C6CE  1607          		LD	D,7
  C6D0  0EB9          		LD	C,0B9H
  C6D2  210ECA        		LD	HL,TEXTDT
  C6D5                	TEXT1:
  C6D5  04            		INC	B
  C6D6  EDA3          		OUTI
  C6D8  0C            		INC	C
  C6D9  15            		DEC	D
  C6DA  20F9          		JR	NZ,TEXT1
  C6DC  01B01F        		LD	BC,01FB0H
                      	;	OUT	(C),0		;未定義命令ニーモニック
  C6DF  ED71          		DB	0EDH,071H
                      	
  C6E1  0EC4          		LD	C,0C4H
                      	;	OUT	(C),0		;未定義命令ニーモニック
  C6E3  ED71          		DB	0EDH,071H
                      	
  C6E5  01011A        		LD	BC,01A01H
  C6E8  ED78          		IN	A,(C)
  C6EA  E608          		AND	8
  C6EC  2809          		JR	Z,PRN
  C6EE  0E03          		LD	C,003H
  C6F0  3E0F          		LD	A,00FH
  C6F2  ED79          		OUT	(C),A
  C6F4  01040A        		LD	BC,00A04H
  C6F7                	PRN:
  C6F7  110100        		LD	DE,1
  C6FA  62            		LD	H,D
  C6FB  6A            		LD	L,D
  C6FC  017F00        		LD	BC,07FH
  C6FF  36FF          		LD	(HL),0FFH
  C701  EDB0          		LDIR
  C703  017F00        		LD	BC,07FH
  C706  3600          		LD	(HL),0
  C708  EDB0          		LDIR
                      	
  C70A  3EC3          		LD	A,0C3H		;JP
  C70C  21A9D3        		LD	HL,WBOOT
  C70F  320000        		LD	(00000H),A
  C712  220100        		LD	(00001H),HL	;IPL
                      	
  C715  2A03C6        		LD	HL,(MACHINE)	;3 bit7  DPB Original(1)
  C718  220300        		LD	(00003H),HL	;  bit6-0 Machine X1(0)
                      	;				;4 LSX-Dodgers(01DH)
  C71B  2106CC        		LD	HL,BDOS
  C71E  320500        		LD	(00005H),A
  C721  220600        		LD	(00006H),HL	;BDOS
                      	
  C724  21A2D6        		LD	HL,BIOS
  C727  321800        		LD	(00018H),A	;BIOS-ROM
  C72A  221900        		LD	(00019H),HL
                      	
  C72D  210000        		LD	HL,0
  C730  323800        		LD	(00038H),A	;RST038H
  C733  223900        		LD	(00039H),HL
                      	
  C736  3EEC          		LD	A,STABLE/256
  C738  320B00        		LD	(0000BH),A
                      	
  C73B  3EE9          		LD	A,0E9H		;JP (HL)
  C73D  320F00        		LD	(0000FH),A
                      	
  C740  3A7DEC        		LD	A,(_FATBF+1)
  C743  321300        		LD	(00013H),A
                      	
  C746  3A7FEC        		LD	A,(_DTBUF+1)
  C749  321700        		LD	(00017H),A
                      	
  C74C  3EFE          		LD	A,KEYBF/256
  C74E  321B00        		LD	(0001BH),A
                      	
  C751  3EFF          		LD	A,KBUF/256
  C753  321F00        		LD	(0001FH),A
                      	
  C756  2A05C6        		LD	HL,(VERSION)
  C759  225A00        		LD	(0005AH),HL
                      	
  C75C  3EE6          		LD	A,0E6H
  C75E  CD0DDB        		CALL	COMOUT
  C761  CDF2DA        		CALL	IN49SB
  C764  F5            		PUSH	AF
  C765  CDF2DA        		CALL	IN49SB
  C768  F1            		POP	AF
  C769  F5            		PUSH	AF
  C76A  E612          		AND	012H
  C76C  2005          		JR	NZ,KEYR
  C76E  3E01          		LD	A,1
  C770  32D4C8        		LD	(KEYREP+1),A
  C773                	KEYR:
  C773  F1            		POP	AF
  C774  E603          		AND	3
  C776  280E          		JR	Z,NON
                      	
  C778  01D03F        		LD	BC,03FD0H
  C77B  ED49          		OUT	(C),C
  C77D  3E37          		LD	A,037H
  C77F  D3D0          		OUT	(0D0H),A
  C781  ED78          		IN	A,(C)
  C783  B9            		CP	C
  C784  286A          		JR	Z,TURBO
  C786                	NON:
  C786  3D            		DEC	A		;A=0FFH
  C787  321800        		LD	(00018H),A	;BIOS-ROM
                      	
  C78A  2121CA        		LD	HL,AT_SCR1
  C78D  1197DB        		LD	DE,SCR1
  C790  019F00        		LD	BC,SCRNX-SCR1	;転送先のサイズ確認用
  C793  019F00        		LD	BC,AT_SCRE-AT_SCR1
  C796  EDB0          		LDIR
                      	
  C798  21C0CA        		LD	HL,AT_WTTRK
  C79B  1149EA        		LD	DE,WTTRK
  C79E  01B700        		LD	BC,DMAE-WTTRK	;転送先のサイズ確認用
  C7A1  019B00        		LD	BC,AT_CPUE-AT_WTTRK
  C7A4  EDB0          		LDIR
                      	
  C7A6  215BCB        		LD	HL,AT_EDWTC
  C7A9  1132CD        		LD	DE,EDWTC
  C7AC  014700        		LD	BC,EMME-EDWTC	;転送先のサイズ確認用
  C7AF  014300        		LD	BC,AT_EMME-AT_EDWTC
  C7B2  EDB0          		LDIR
                      	
  C7B4  219DEA        		LD	HL,AT_DRD+AT_R
  C7B7  22ECEC        		LD	(_FDRD+1),HL
  C7BA  214DEA        		LD	HL,AT_DWT+AT_R
  C7BD  22EFEC        		LD	(_FDWT+1),HL
  C7C0  2146CD        		LD	HL,AT_EDRDC+AT_RE
  C7C3  2282ED        		LD	(EMMRD),HL
  C7C6  2132CD        		LD	HL,AT_EDWTC+AT_RE
  C7C9  2284ED        		LD	(EMMWR),HL
                      	
  C7CC  210000        		LD	HL,0
  C7CF  2238DB        		LD	(X1PAT),HL
                      	
  C7D2  3EAF          		LD	A,0AFH		;XOR	A
  C7D4  324AD9        		LD	(X1KPAT),A
                      	
  C7D7  2136DC        		LD	HL,SCRNX
  C7DA  22D1EC        		LD	(_SCRN+1),HL
                      	
  C7DD  CD94C9        		CALL	SETCRTC
  C7E0  0610          		LD	B,010H		;PALET
                      	;	OUT	(C),0		;未定義命令ニーモニック
  C7E2  ED71          		DB	0EDH,071H
  C7E4  04            		INC	B
                      	;	OUT	(C),0		;未定義命令ニーモニック
  C7E5  ED71          		DB	0EDH,071H
  C7E7  04            		INC	B
                      	;	OUT	(C),0		;未定義命令ニーモニック
  C7E8  ED71          		DB	0EDH,071H
  C7EA  04            		INC	B
                      	;	OUT	(C),0		;未定義命令ニーモニック
  C7EB  ED71          		DB	0EDH,071H
  C7ED  C390C8        		JP	NOBANK
                      	
  C7F0                	TURBO:
  C7F0  F3            		DI			;Check BIOS
  C7F1  061D          		LD	B,01DH
  C7F3  ED79          		OUT	(C),A		;BIOS ON
  C7F5  3A512F        		LD	A,(02F51H)
  C7F8  04            		INC	B		;B=01EH
  C7F9  ED79          		OUT	(C),A		;BIOS OFF
  C7FB  FB            		EI
  C7FC  FEC9          		CP	0C9H
  C7FE  280B          		JR	Z,BIOSOK
  C800  3EAF          		LD	A,0AFH		;XOR	A
  C802  324AD9        		LD	(X1KPAT),A
  C805  2136DC        		LD	HL,SCRNX
  C808  22D1EC        		LD	(_SCRN+1),HL
  C80B                	BIOSOK:
  C80B  3E1F          		LD	A,01FH
  C80D  DBF0          		IN	A,(0F0H)
  C80F  0F            		RRCA
  C810  380B          		JR	C,CRT1
  C812  21FEC9        		LD	HL,_C8025H
  C815  11B0EC        		LD	DE,CRTCD
  C818  011000        		LD	BC,16
  C81B  EDB0          		LDIR
  C81D                	CRT1:
  C81D  CD94C9        		CALL	SETCRTC
  C820  01AA10        		LD	BC,010AAH	;PALET
  C823  ED49          		OUT	(C),C
  C825  01CC11        		LD	BC,011CCH
  C828  ED49          		OUT	(C),C
  C82A  01F012        		LD	BC,012F0H
  C82D  ED49          		OUT	(C),C
  C82F  04            		INC	B
  C830  ED71          		DB	0EDH,071H
                      	
  C832  3E1F          		LD	A,01FH
  C834  DBF0          		IN	A,(0F0H)
  C836  CB57          		BIT	2,A
  C838  2825          		JR	Z,BANK
                      	
  C83A  AF            		XOR	A
  C83B                	TZ1:
  C83B  F5            		PUSH	AF
  C83C  CDDCEC        		CALL	_GETDPB
  C83F  DD7E12        		LD	A,(IX+012H)
  C842  FE87          		CP	087H
  C844  2013          		JR	NZ,TZ2
  C846  DDE5          		PUSH	IX
  C848  D1            		POP	DE
  C849  2178EB        		LD	HL,M2HD
  C84C  EDA0          		LDI
  C84E  EDA0          		LDI
  C850  13            		INC	DE
  C851  13            		INC	DE
  C852  13            		INC	DE
  C853  13            		INC	DE
  C854  010C00        		LD	BC,12
  C857  EDB0          		LDIR
  C859                	TZ2:
  C859  F1            		POP	AF
  C85A  3C            		INC	A
  C85B  FE08          		CP	8
  C85D  38DC          		JR	C,TZ1
                      	
  C85F                	BANK:
  C85F  01000B        		LD	BC,00B00H
  C862  21007F        		LD	HL,07F00H
  C865  F3            		DI
  C866                	BANK1:
  C866  ED69          		OUT	(C),L
  C868  5E            		LD	E,(HL)
  C869  7B            		LD	A,E
  C86A  C6A5          		ADD	A,0A5H
  C86C  77            		LD	(HL),A
  C86D  BE            		CP	(HL)
  C86E  73            		LD	(HL),E
  C86F  2005          		JR	NZ,BANK2
  C871  2C            		INC	L
  C872  CB65          		BIT	4,L
  C874  28F0          		JR	Z,BANK1
  C876                	BANK2:
  C876  3E10          		LD	A,010H
  C878  ED79          		OUT	(C),A
  C87A  7D            		LD	A,L
  C87B  B7            		OR	A
  C87C  2812          		JR	Z,NOBANK
  C87E  2600          		LD	H,0
  C880  29            		ADD	HL,HL	;*2
  C881  29            		ADD	HL,HL	;*4
  C882  29            		ADD	HL,HL	;*8
  C883  29            		ADD	HL,HL	;*16
  C884  29            		ADD	HL,HL	;*32
  C885  2B            		DEC	HL	;-1
  C886  2B            		DEC	HL	;-2
  C887  2B            		DEC	HL	;-3
  C888  22A8ED        		LD	(BANKCL),HL
  C88B  3E01          		LD	A,1
  C88D  32A0ED        		LD	(BANKFL),A
  C890                	NOBANK:
  C890                	EMM:
  C890  CD5DC9        		CALL	EADR0
  C893  ED78          		IN	A,(C)
  C895  F5            		PUSH	AF
                      	
  C896  110000        		LD	DE,0
  C899                	ECHECK1:
  C899  13            		INC	DE
  C89A  CD40C9        		CALL	EADR2
  C89D  ED60          		IN	H,(C)
  C89F  CD40C9        		CALL	EADR2
  C8A2  7C            		LD	A,H
  C8A3  C6E5          		ADD	A,0E5H
  C8A5  ED79          		OUT	(C),A
  C8A7  3C            		INC	A
  C8A8  CD5DC9        		CALL	EADR0
  C8AB  ED79          		OUT	(C),A
  C8AD  3D            		DEC	A
  C8AE  CD40C9        		CALL	EADR2
  C8B1  ED68          		IN	L,(C)
  C8B3  CD40C9        		CALL	EADR2
  C8B6  ED61          		OUT	(C),H
  C8B8  BD            		CP	L
  C8B9  2004          		JR	NZ,ECHECK2
  C8BB  CB5A          		BIT	3,D
  C8BD  28DA          		JR	Z,ECHECK1
  C8BF                	ECHECK2:
  C8BF  CD5DC9        		CALL	EADR0
  C8C2  F1            		POP	AF
  C8C3  ED79          		OUT	(C),A
                      	
  C8C5  21F7FF        		LD	HL,0-9
  C8C8  19            		ADD	HL,DE
  C8C9  3008          		JR	NC,NOEMM
  C8CB  2288ED        		LD	(EMMCL),HL
  C8CE  3E03          		LD	A,3
  C8D0  3280ED        		LD	(EMMFL),A
  C8D3                	NOEMM:
  C8D3  3E00          	KEYREP:	LD	A,000H
  C8D5  B7            		OR	A
  C8D6  2807          		JR	Z,KEYR1
  C8D8  010000        		LD	BC,0
  C8DB  ED438CEC      		LD	(_CTC),BC
  C8DF                	KEYR1:
  C8DF  0130F8        		LD	BC,0-80*25
  C8E2  2ABAEC        		LD	HL,(CRTCD+10)
  C8E5  ED43BAEC      		LD	(CRTCD+10),BC
  C8E9  1E0C          		LD	E,00CH
  C8EB  CDCDEC        		CALL	_PRINT
  C8EE  22BAEC        		LD	(CRTCD+10),HL
                      	
  C8F1  21BFC9        		LD	HL,INIMES
  C8F4  CDBDD8        		CALL	MSX
                      	
  C8F7  3A87FF        		LD	A,(0FF87H)
  C8FA  FE08          		CP	8
  C8FC  301E          		JR	NC,INIT0
  C8FE  5F            		LD	E,A
  C8FF  C641          		ADD	A,'A'
  C901  32BCC9        		LD	(AUTODV),A
  C904  0E0E          		LD	C,00EH
  C906  CD0500        		CALL	SYSTEM
  C909  1C            		INC	E
  C90A  2185EC        		LD	HL,_SEEKSP	;Disk error Ignore
  C90D  CBFE          		SET	7,(HL)
  C90F  0E1B          		LD	C,01BH
  C911  CD0500        		CALL	SYSTEM
                      	
  C914  2185EC        		LD	HL,_SEEKSP
  C917  CBBE          		RES	7,(HL)
                      	
  C919  3C            		INC	A
  C91A  2008          		JR	NZ,INIT1
  C91C                	INIT0:
  C91C  1E00          		LD	E,0
  C91E  0E0E          		LD	C,00EH
  C920  CD0500        		CALL	SYSTEM
  C923  AF            		XOR	A
  C924                	INIT1:
  C924  2100FF        		LD	HL,0FF00H
  C927  1101FF        		LD	DE,0FF01H
  C92A  01FF00        		LD	BC,000FFH
  C92D  75            		LD	(HL),L
  C92E  EDB0          		LDIR
                      	
  C930  B7            		OR	A
  C931  C8            		RET	Z
                      	
  C932  3EE6          		LD	A,0E6H
  C934  CD0DDB        		CALL	COMOUT
  C937  CDF2DA        		CALL	IN49SB
  C93A  CDF2DA        		CALL	IN49SB
  C93D  FE1B          		CP	01BH
  C93F  C9            		RET
                      	
  C940                	EADR2:
  C940  D5            		PUSH	DE
  C941  EB            		EX	DE,HL
  C942  29            		ADD	HL,HL
  C943  29            		ADD	HL,HL
  C944  ED4B8BED      		LD	BC,(EMMBL-1)
  C948  0E00          		LD	C,0
  C94A  09            		ADD	HL,BC
  C94B  ED4B93ED      		LD	BC,(EMMDV)
  C94F  060D          		LD	B,00DH
  C951  ED49          		OUT	(C),C
  C953  0C            		INC	C
  C954  ED69          		OUT	(C),L
  C956  0C            		INC	C
  C957  ED61          		OUT	(C),H
  C959  0C            		INC	C
  C95A  EB            		EX	DE,HL
  C95B  D1            		POP	DE
  C95C  C9            		RET
                      	
  C95D                	EADR0:
  C95D  ED4B93ED      		LD	BC,(EMMDV)
  C961  060D          		LD	B,00DH
                      	;	OUT	(C),0		;未定義命令ニーモニック
  C963  ED71          		DB	0EDH,071H
  C965  0C            		INC	C
                      	;	OUT	(C),0		;未定義命令ニーモニック
  C966  ED71          		DB	0EDH,071H
  C968  0C            		INC	C
                      	;	OUT	(C),0		;未定義命令ニーモニック
  C969  ED71          		DB	0EDH,071H
  C96B  0C            		INC	C
  C96C  C9            		RET
                      	
  C96D                	CHKCTC:
  C96D  C5            		PUSH	BC
  C96E  110347        		LD	DE,04703H
  C971                	INICTC1:
  C971  0C            		INC	C
  C972  ED51          		OUT	(C),D
                      	;	OUT	(C),0		;未定義命令ニーモニック
  C974  ED71          		DB	0EDH,071H
  C976  1D            		DEC	E
  C977  20F8          		JR	NZ,INICTC1
  C979  C1            		POP	BC
                      	
  C97A  11FA07        		LD	DE,007FAH
  C97D  ED51          		OUT	(C),D
  C97F  ED59          		OUT	(C),E
  C981  ED78          		IN	A,(C)
  C983  BB            		CP	E
  C984  C0            		RET	NZ
  C985  ED51          		OUT	(C),D
  C987  ED51          		OUT	(C),D
  C989  ED78          		IN	A,(C)
  C98B  BA            		CP	D
  C98C  C0            		RET	NZ
  C98D  03            		INC	BC
  C98E  03            		INC	BC
  C98F  ED438CEC      		LD	(_CTC),BC
  C993  C9            		RET
                      	
  C994                	SETCRTC:
  C994  21B0EC        		LD	HL,CRTCD
  C997  AF            		XOR	A
  C998                	SETCRT1:
  C998  010018        		LD	BC,01800H
  C99B  ED79          		OUT	(C),A
  C99D  0C            		INC	C
  C99E  04            		INC	B
  C99F  EDA3          		OUTI
  C9A1  3C            		INC	A
  C9A2  FE0C          		CP	12
  C9A4  20F2          		JR	NZ,SETCRT1
  C9A6  23            		INC	HL
  C9A7  23            		INC	HL
  C9A8  01031B        		LD	BC,01A03H+00100H
  C9AB  EDA3          		OUTI
  C9AD  01D020        		LD	BC,01FD0H+00100H
  C9B0  EDA3          		OUTI
  C9B2  C9            		RET
                      	
  C9B3  4155544F455845	AUTOD:	DB	"AUTOEXEC "
  C9BC  413A00        	AUTODV:	DB	"A:",0
                      	
  C9BF  4C53582D446F64	INIMES:	DB	"LSX-Dodgers for X1/turbo version "
  C9E0  312E          		DB	030H + VER_1, '.'
  C9E2  3331          		DB	030H + VER_2 ,030H + VER_3
  C9E4  2047616B752028		DB	' Gaku (Lovers/Tablacus)',0DH,0AH
  C9FD  00            		DB	0
                      	
  C9FE                	_C8025H:
  C9FE  6B5059881B0119		DB	06BH,050H,059H,088H,01BH,001H,019H,01AH
  CA06  000F          		DB	000H,00FH
  CA08  30F8B0FF      		DW	0-80*LINE,0-80
  CA0C  0CA3          		DB	00CH,0A3H
                      	
  CA0E  030C0F30333C3F	TEXTDT:	DB	003H,00CH,00FH,030H,033H,03CH,03FH
                      	
  CA15                	SIODATA:
  CA15  18            		DB	018H
  CA16  0100          		DB	1,0
  CA18  0200          		DB	2,0
  CA1A  03C1          		DB	3,0C1H
  CA1C  0444          		DB	4,044H
  CA1E  05E8          		DB	5,0E8H
  CA20  FF            		DB	0FFH
                      	
                      	;	ノンターボ用パッチ
                      	
  CA21                	AT_SCR1:
  CA21  D9            		EXX
  CA22  C5            		PUSH	BC
  CA23  015020        		LD	BC,02000H+80
  CA26  D9            		EXX
  CA27  C5            		PUSH	BC
  CA28  010020        		LD	BC,02000H
                      	
  CA2B  67            		LD	H,A
  CA2C  B7            		OR	A
  CA2D                	AT_SCRUP1:
  CA2D  2815          		JR	Z,AT_SCRCL
  CA2F  C5            		PUSH	BC
  CA30  CBE0          		SET	4,B
  CA32  D9            		EXX
  CA33  C5            		PUSH	BC
  CA34  CBE0          		SET	4,B
  CA36  D9            		EXX
  CA37  CDD1DB        		CALL	AT_UPSUB+AT_RS
  CA3A  D9            		EXX
  CA3B  C1            		POP	BC
  CA3C  D9            		EXX
  CA3D  C1            		POP	BC
  CA3E  CDD1DB        		CALL	AT_UPSUB+AT_RS
  CA41  25            		DEC	H
  CA42  18E9          		JR	AT_SCRUP1
                      	
  CA44                	AT_SCRCL:
  CA44  215020        		LD	HL,02000H+80
  CA47  3A96EC        		LD	A,(_COLORF)
  CA4A                	AT_SCRCL1:
  CA4A  CBE0          		SET	4,B
  CA4C  ED61          		OUT	(C),H
  CA4E  CBA0          		RES	4,B
  CA50  ED79          		OUT	(C),A
  CA52  03            		INC	BC
  CA53  2D            		DEC	L
  CA54  20F4          		JR	NZ,AT_SCRCL1
  CA56  C1            		POP	BC
  CA57  D9            		EXX
  CA58  C1            		POP	BC
  CA59  D9            		EXX
  CA5A  C9            		RET
                      	
  CA5B                	AT_UPSUB:
  CA5B  2E28          		LD	L,40
  CA5D                	AT_UPSUB1:
  CA5D  D9            		EXX
  CA5E  ED78          		IN	A,(C)
  CA60  03            		INC	BC
  CA61  D9            		EXX
  CA62  ED79          		OUT	(C),A
  CA64  03            		INC	BC
  CA65  D9            		EXX
  CA66  ED78          		IN	A,(C)
  CA68  03            		INC	BC
  CA69  D9            		EXX
  CA6A  ED79          		OUT	(C),A
  CA6C  03            		INC	BC
  CA6D  2D            		DEC	L
  CA6E  20ED          		JR	NZ,AT_UPSUB1
  CA70  C9            		RET
                      	
                      	;	FLOPPY DISK DRIVER(CPU)
                      	
  CA71                	DISKC:
  CA71  1B            		DEC	DE
  CA72  CB5F          		BIT	3,A
  CA74  C442EA        		CALL	NZ,RNF
  CA77                	DISKD:
  CA77  E5            		PUSH	HL
  CA78  2148EA        		LD	HL,RETRY
  CA7B  35            		DEC	(HL)
  CA7C  E1            		POP	HL
  CA7D  203E          		JR	NZ,AT_ERR		;Retry
  CA7F  B7            		OR	A
  CA80  283B          		JR	Z,AT_ERR		;Error
                      	
  CA82                	AT_DELP:
  CA82  CD42EA        		CALL	RNF
  CA85  CD1EEA        		CALL	FDMOFF
  CA88  3A85EC        		LD	A,(_SEEKSP)
  CA8B  87            		ADD	A,A
  CA8C  382E          		JR	C,AT_ERRZ
  CA8E                	AT_DELP1:
  CA8E  D5            		PUSH	DE
  CA8F  21B0EB        		LD	HL,DEMES
  CA92  CDBDD8        		CALL	MSX
  CA95  CDA2D7        		CALL	KEYBC
  CA98                	AT_DELP2:
  CA98  CDCAEC        		CALL	_INKEY
  CA9B  28FB          		JR	Z,AT_DELP2
                      	
  CA9D  D1            		POP	DE
  CA9E  CDE2DF        		CALL	CAP
  CAA1  FE52          		CP	'R'		;Retry
  CAA3  200A          		JR	NZ,AT_DELP3
  CAA5  210000        	DHLPAT:	LD	HL,0
  CAA8  3E02          		LD	A,2
  CAAA  3248EA        		LD	(RETRY),A
  CAAD  B7            		OR	A
  CAAE  C9            		RET
  CAAF                	AT_DELP3:
  CAAF  FE49          		CP	'I'		;Ignore
  CAB1  2807          		JR	Z,AT_IGNORE
  CAB3  FE41          		CP	'A'		;Abort
  CAB5  20D7          		JR	NZ,AT_DELP1
  CAB7  C3A6D3        		JP	BOOT
  CABA                	AT_IGNORE:
  CABA  3EFF          		LD	A,0FFH
  CABC                	AT_ERRZ:
  CABC  BF            		CP	A
  CABD                	AT_ERR:
  CABD  3EFF          		LD	A,0FFH
  CABF  C9            		RET
                      	
  CAC0                	AT_SCRE:
                      	
  CAC0                	AT_WTTRK:
  CAC0  3EF0          		LD	A,0F0H
  CAC2  1802          		JR	AT_WTTRK1
                      	
  CAC4                	AT_DWT:
  CAC4  3EA0          		LD	A,0A0H
  CAC6                	AT_WTTRK1:
  CAC6  32E6E9        		LD	(FDCPAT+1),A
                      	
  CAC9  3E02          		LD	A,2		;Retry count
  CACB  3248EA        		LD	(RETRY),A
                      	
  CACE                	DWT0:
  CACE  D5            		PUSH	DE
  CACF  E5            		PUSH	HL
  CAD0  221CDC        		LD	(DHLPAT+1+AT_RS),HL
  CAD3  CD7FE9        		CALL	SEEK		;Write disk
  CAD6  E1            		POP	HL
  CAD7  3831          		JR	C,ERRDW
  CAD9  F3            		DI
  CADA  3AE6E9        		LD	A,(FDCPAT+1)
  CADD  CD2AEA        		CALL	SECSET
  CAE0  0EFB          		LD	C,0FBH
                      	
  CAE2                	DWT1:
  CAE2  56            		LD	D,(HL)
  CAE3                	DWT2:
  CAE3  78            		LD	A,B
  CAE4  DBF8          		IN	A,(0F8H)
  CAE6  0F            		RRCA
  CAE7  3008          		JR	NC,DWT4
  CAE9  0F            		RRCA
  CAEA  30F7          		JR	NC,DWT2
  CAEC                	DWT3:
  CAEC  ED51          		OUT	(C),D
  CAEE  23            		INC	HL
  CAEF  18F1          		JR	DWT1
                      	
  CAF1                	DWT4:
  CAF1  3D            		DEC	A
  CAF2  28F8          		JR	Z,DWT3
  CAF4  3C            		INC	A
  CAF5  FB            		EI
  CAF6  D1            		POP	DE
  CAF7  13            		INC	DE
  CAF8  CD1EEA        		CALL	FDMOFF
  CAFB  C8            		RET	Z
  CAFC  CDE7DB        		CALL	DISKC+AT_RS
  CAFF  20CD          		JR	NZ,DWT0
  CB01  B7            		OR	A
  CB02  C8            		RET	Z
  CB03                	ERRW:
  CB03  3EFF          		LD	A,0FFH
  CB05                	ERRZ:
  CB05  BF            		CP	A
  CB06  37            		SCF
  CB07  C31EEA        		JP	FDMOFF
                      	
  CB0A                	ERRDW:
  CB0A  D1            		POP	DE
  CB0B  CDF8DB        		CALL	AT_DELP+AT_RS
  CB0E  20BE          		JR	NZ,DWT0
  CB10  B7            		OR	A
  CB11  20F0          		JR	NZ,ERRW
  CB13  C9            		RET
                      	
  CB14                	AT_DRD:
  CB14  3E80          		LD	A,080H
  CB16  32E6E9        		LD	(FDCPAT+1),A
                      	
  CB19  3E02          		LD	A,2		;Retry count
  CB1B  3248EA        		LD	(RETRY),A
                      	
  CB1E                	DRD0:
  CB1E  D5            		PUSH	DE
  CB1F  E5            		PUSH	HL
  CB20  221CDC        		LD	(DHLPAT+1+AT_RS),HL
  CB23  CD7FE9        		CALL	SEEK		;Read disk
  CB26  E1            		POP	HL
  CB27  3828          		JR	C,ERRDR
  CB29  F3            		DI
  CB2A  3AE6E9        		LD	A,(FDCPAT+1)
  CB2D  CD2AEA        		CALL	SECSET
  CB30  0EFB          		LD	C,0FBH
  CB32                	DRD1:
  CB32  78            		LD	A,B
  CB33  DBF8          		IN	A,(0F8H)
  CB35  0F            		RRCA
  CB36  3008          		JR	NC,DRD3
  CB38  0F            		RRCA
  CB39  30F7          		JR	NC,DRD1
  CB3B  EDA2          		INI
  CB3D  04            		INC	B
  CB3E  18F2          		JR	DRD1
                      	
  CB40                	DRD3:
  CB40  B7            		OR	A
  CB41  FB            		EI
  CB42  D1            		POP	DE
  CB43  13            		INC	DE
  CB44  CD1EEA        		CALL	FDMOFF
  CB47  C8            		RET	Z
  CB48  CDE7DB        		CALL	DISKC+AT_RS
  CB4B  20D1          		JR	NZ,DRD0
  CB4D  B7            		OR	A
  CB4E  20B3          		JR	NZ,ERRW
  CB50  C9            		RET
                      	
  CB51                	ERRDR:
  CB51  D1            		POP	DE
  CB52  CDF8DB        		CALL	AT_DELP+AT_RS
  CB55  20C7          		JR	NZ,DRD0
  CB57  B7            		OR	A
  CB58  20A9          		JR	NZ,ERRW
  CB5A  C9            		RET
                      	
  CB5B                	AT_CPUE:
                      	
                      	
                      	;	EMM DRIVER(CPU)
                      	
                      	
  CB5B                	AT_EDWTC:
  CB5B  CD5ACD        		CALL	AT_EADR+AT_RE
  CB5E                	AT_EDWTC1:
  CB5E  04            		INC	B
  CB5F  EDA3          		OUTI
  CB61  04            		INC	B
  CB62  EDA3          		OUTI
  CB64  04            		INC	B
  CB65  EDA3          		OUTI
  CB67  04            		INC	B
  CB68  EDA3          		OUTI
  CB6A  3D            		DEC	A
  CB6B  20F1          		JR	NZ,AT_EDWTC1
  CB6D  AF            		XOR	A
  CB6E  C9            		RET
                      	
  CB6F                	AT_EDRDC:
  CB6F  CD5ACD        		CALL	AT_EADR+AT_RE
  CB72                	AT_EDRDC1:
  CB72  EDA2          		INI
  CB74  04            		INC	B
  CB75  EDA2          		INI
  CB77  04            		INC	B
  CB78  EDA2          		INI
  CB7A  04            		INC	B
  CB7B  EDA2          		INI
  CB7D  04            		INC	B
  CB7E  3D            		DEC	A
  CB7F  20F1          		JR	NZ,AT_EDRDC1
  CB81  AF            		XOR	A
  CB82  C9            		RET
                      	
  CB83                	AT_EADR:
  CB83  D5            		PUSH	DE
  CB84  EB            		EX	DE,HL
  CB85  29            		ADD	HL,HL
  CB86  29            		ADD	HL,HL
  CB87  ED4BA0EC      		LD	BC,(_MAXCYL-1)
  CB8B  0E00          		LD	C,0
  CB8D  09            		ADD	HL,BC
  CB8E  060D          		LD	B,00DH
  CB90  ED49          		OUT	(C),C
  CB92  0C            		INC	C
  CB93  ED69          		OUT	(C),L
  CB95  0C            		INC	C
  CB96  ED61          		OUT	(C),H
  CB98  0C            		INC	C
  CB99  EB            		EX	DE,HL
  CB9A  D1            		POP	DE
  CB9B  13            		INC	DE
  CB9C  AF            		XOR	A
  CB9D  C9            		RET
                      	
  CB9E                	AT_EMME:
                      	
  CB9E                	INITE:
  CB9E                		DS	0CC06H-INITE
                      	
  CC06                	BDOS:
  CC06  C3B5D3        		JP	BDOS0
  CC09                		DS	17	;Reserved
                      	
                      	;LDIO2.ASM
                      	
                      	;	LSX-Dodgers IO2
                      	
  CC1A                	_SYS03:		;(BDOS)外部入力
  CC1A  F3            		DI
  CC1B  C5            		PUSH	BC
  CC1C  01911F        	SIOAD:	LD	BC,01F91H
  CC1F  3E05          		LD	A,5
  CC21  ED79          		OUT	(C),A
  CC23  3EEA          		LD	A,0EAH		;RTS ON
  CC25  ED79          		OUT	(C),A
  CC27                	REC1:
  CC27  CD3ECC        		CALL	BREAK2
  CC2A  ED78          		IN	A,(C)
  CC2C  0F            		RRCA			;Arrival
  CC2D  30F8          		JR	NC,REC1
  CC2F                	BREAK2X:
  CC2F  3F            		CCF
  CC30  3E05          		LD	A,5
  CC32  ED79          		OUT	(C),A
  CC34  3EE8          		LD	A,0E8H		;RTS OFF
  CC36  ED79          		OUT	(C),A
                      	
  CC38  0D            		DEC	C
  CC39  ED78          		IN	A,(C)		;Read data
  CC3B  C1            		POP	BC
  CC3C  FB            		EI
  CC3D  C9            		RET
                      	
  CC3E                	BREAK2:
  CC3E  3E1A          		LD	A,01AH
  CC40  DB01          		IN	A,(1)
  CC42  0F            		RRCA
  CC43  D8            		RET	C
  CC44  C1            		POP	BC		;PC
  CC45  01911F        	SIOAD0:	LD	BC,01F91H
  CC48  18E5          		JR	BREAK2X
                      	
  CC4A                	_SYS04:		;(BDOS)外部出力
  CC4A  C5            		PUSH	BC
  CC4B  01911F        	SIOAD1:	LD	BC,01F91H
  CC4E                	XMIT1:
  CC4E  CD3ECC        		CALL	BREAK2
  CC51  3E10          		LD	A,010H		;Reset status
  CC53  ED79          		OUT	(C),A
  CC55  ED78          		IN	A,(C)
  CC57  2F            		CPL
  CC58  E624          		AND	024H		;CTS Send Empty
  CC5A  20F2          		JR	NZ,XMIT1
  CC5C  0D            		DEC	C
  CC5D  ED59          		OUT	(C),E
  CC5F  C1            		POP	BC
  CC60  C9            		RET
                      	
  CC61                	_SYS05:		;(BDOS)プリンタ出力
  CC61  C5            		PUSH	BC
  CC62  01011A        		LD	BC,01A01H
  CC65                	_S05X1:
  CC65  CD3ECC        		CALL	BREAK2
  CC68  ED78          		IN	A,(C)
  CC6A  E608          		AND	8
  CC6C  20F7          		JR	NZ,_S05X1
  CC6E  F3            		DI
  CC6F  0D            		DEC	C
  CC70  ED59          		OUT	(C),E
  CC72  0E03          		LD	C,3
  CC74  3E0E          		LD	A,00EH
  CC76  ED79          		OUT	(C),A
  CC78  3C            		INC	A
  CC79  03            		INC	BC
  CC7A  0B            		DEC	BC
  CC7B  ED79          		OUT	(C),A
  CC7D  FB            		EI
  CC7E  C1            		POP	BC
  CC7F  AF            		XOR	A
  CC80  C9            		RET
                      	
                      	
                      	;LDDISK2.ASM
                      	
                      	;	LSX-Dodgers DISK2
                      	
                      	
                      	;	GRAPHIC RAM DISK DRIVER
                      	
                      	
  CC81                	GDRD:
  CC81  CD97CC        		CALL	GADR
  CC84                	GDRDC1:
  CC84  EDA2          		INI
  CC86  04            		INC	B
  CC87  0C            		INC	C
  CC88  20FA          		JR	NZ,GDRDC1
  CC8A  1817          		JR	S1FD0
                      	
  CC8C                	GDWT:
  CC8C  CD97CC        		CALL	GADR
  CC8F                	GDWTC1:
  CC8F  04            		INC	B
  CC90  EDA3          		OUTI
  CC92  0C            		INC	C
  CC93  20FA          		JR	NZ,GDWTC1
  CC95  180C          		JR	S1FD0
                      	
  CC97                	GADR:
  CC97  0E00          		LD	C,0
  CC99  7B            		LD	A,E
  CC9A  C640          		ADD	A,040H
  CC9C  47            		LD	B,A
  CC9D  13            		INC	DE
  CC9E  3ABFEC        		LD	A,(WK1FD0)
  CCA1  F610          		OR	010H		;BANK1
  CCA3                	S1FD0:
  CCA3  C5            		PUSH	BC
  CCA4  32BFEC        		LD	(WK1FD0),A
  CCA7  01D01F        		LD	BC,01FD0H
  CCAA  ED79          		OUT	(C),A
  CCAC  C1            		POP	BC
  CCAD  E6EF          		AND	0EFH		;BANK0
  CCAF  C9            		RET
                      	
                      	
                      	;	BANK RAM DISK DRIVER
                      	
                      	
  CCB0                	BDRDC:
  CCB0  ED73CFCC      		LD	(BANKSP+1),SP
  CCB4  3AD0CC        		LD	A,(BANKSP+2)
  CCB7  87            		ADD	A,A
  CCB8  3803          		JR	C,BDRDC1
  CCBA  31D4FF        		LD	SP,EXTSP
  CCBD                	BDRDC1:
  CCBD  D5            		PUSH	DE
  CCBE  D9            		EXX
  CCBF  C5            		 PUSH	 BC
  CCC0  D5            		 PUSH	 DE
  CCC1  CDF5CC        		 CALL	 BADR
  CCC4  CD12CD        		CALL	BTFR
  CCC7  D9            		EXX
  CCC8                	BDWTCE:
  CCC8  D1            		 POP	 DE
  CCC9  C1            		 POP	 BC
  CCCA  D9            		 EXX
  CCCB  D1            		POP	DE
  CCCC  13            		INC	DE
  CCCD  FB            		EI
  CCCE  310000        	BANKSP:	LD	SP,0
  CCD1  AF            		XOR	A
  CCD2  C9            		RET
                      	
  CCD3                	BDWTC:
  CCD3  ED73CFCC      		LD	(BANKSP+1),SP
  CCD7  3AD0CC        		LD	A,(BANKSP+2)
  CCDA  87            		ADD	A,A
  CCDB  3803          		JR	C,BDWTC1
  CCDD  31D4FF        		LD	SP,EXTSP
  CCE0                	BDWTC1:
  CCE0  D5            		PUSH	DE
  CCE1  D9            		EXX
  CCE2  C5            		 PUSH	 BC
  CCE3  D5            		 PUSH	 DE
  CCE4  CDF5CC        		 CALL	 BADR
  CCE7  D9            		EXX
  CCE8  53            		 LD	D,E
  CCE9  5F            		 LD	E,A
  CCEA  D9            		 EXX
  CCEB  EB            		EX	DE,HL
  CCEC  CD12CD        		CALL	BTFR
  CCEF  EB            		EX	DE,HL
  CCF0  D9            		EXX
  CCF1  ED51          		 OUT	 (C),D	 ;MAIN
  CCF3  18D3          		 JR	 BDWTCE
                      	
  CCF5                	BADR:
  CCF5  D9            		 EXX
  CCF6  7B            		LD	A,E
  CCF7  87            		ADD	A,A
  CCF8  CB12          		RL	D
  CCFA  87            		ADD	A,A
  CCFB  CB12          		RL	D
  CCFD  F5            		PUSH	AF
  CCFE  87            		ADD	A,A
  CCFF  7A            		LD	A,D
  CD00  8F            		ADC	A,A
  CD01  E60F          		AND	00FH
  CD03  D9            		EXX
  CD04  01000B        		 LD	 BC,00B00H
  CD07  57            		 LD	 D,A	  ;BANK
  CD08  1E10          		 LD	 E,010H	  ;MAIN
  CD0A  D9            		 EXX
  CD0B  D1            		POP	DE
  CD0C  0600          		LD	B,0
  CD0E  58            		LD	E,B
  CD0F  CBBA          		RES	7,D
  CD11  C9            		RET
                      	
  CD12                	BTFR:
  CD12  D5            		PUSH	DE
  CD13  F3            		DI
                      	
  CD14                	BTFR1:
  CD14  D9            		EXX
  CD15  ED51          		 OUT	 (C),D	 ;BANK(MAIN)
  CD17  D9            		 EXX
  CD18  E3            		EX	(SP),HL
  CD19  7E            		LD	A,(HL)
  CD1A  23            		INC	HL
  CD1B  4E            		LD	C,(HL)
  CD1C  23            		INC	HL
  CD1D  56            		LD	D,(HL)
  CD1E  23            		INC	HL
  CD1F  5E            		LD	E,(HL)
  CD20  23            		INC	HL
  CD21  E3            		EX	(SP),HL
  CD22  D9            		EXX
  CD23  ED59          		 OUT	 (C),E	 ;MAIN(BANK)
  CD25  D9            		 EXX
  CD26  77            		LD	(HL),A
  CD27  23            		INC	HL
  CD28  71            		LD	(HL),C
  CD29  23            		INC	HL
  CD2A  72            		LD	(HL),D
  CD2B  23            		INC	HL
  CD2C  73            		LD	(HL),E
  CD2D  23            		INC	HL
  CD2E  10E4          		DJNZ	BTFR1
  CD30  D1            		POP	DE
  CD31  C9            		RET
                      	
                      	
                      	;	EMM DRIVER(DMA)
                      	
                      	
  CD32                	EDWTC:
  CD32  3E11          		LD	A,17
  CD34  01            		DB	1
  CD35                	EDRDC:
  CD35  3E0F          		LD	A,15
  CD37                	EDWTC1:
  CD37  D5            		PUSH	DE
  CD38  2274CD        		LD	(EDMAD+12),HL
  CD3B  EB            		EX	DE,HL
  CD3C  29            		ADD	HL,HL
  CD3D  29            		ADD	HL,HL
  CD3E  ED4BA0EC      		LD	BC,(_MAXCYL-1)
  CD42  0E00          		LD	C,0
  CD44  09            		ADD	HL,BC
  CD45  ED4B84EC      		LD	BC,(_DRIVE)
  CD49  060D          		LD	B,00DH
  CD4B  ED49          		OUT	(C),C
  CD4D  0C            		INC	C
  CD4E  ED69          		OUT	(C),L
  CD50  0C            		INC	C
  CD51  ED61          		OUT	(C),H
                      	
  CD53  2168CD        		LD	HL,EDMAD
  CD56  CDE6EA        		CALL	SETDMA
  CD59  3EB3          		LD	A,0B3H
  CD5B  ED79          		OUT	(C),A
  CD5D  ED49          		OUT	(C),C		;OUT 01F87H,087H
  CD5F  EB            		EX	DE,HL
  CD60  24            		INC	H
  CD61  24            		INC	H
  CD62  24            		INC	H
  CD63  24            		INC	H
  CD64  D1            		POP	DE
  CD65  13            		INC	DE
  CD66  AF            		XOR	A
  CD67  C9            		RET
                      	
  CD68  C37D030DFF032C	EDMAD:	DB	0C3H,07DH,003H,00DH,0FFH,003H,02CH,050H,002H
  CD71  809AAD0000CF01		DB	080H,09AH,0ADH,000H,000H,0CFH,001H,0CFH
                      	
  CD79                	EMME:
                      	
  01D7                	AT_RE	EQU	EDWTC-AT_EDWTC
                      	
                      	
                      	;LDCCP.ASM
                      	
                      	;	LSX-Dodgers CCP
                      	
  0040                	PATHX	EQU	64
  CD79                	PATHD:	DS	PATHX
  CDB9  00            	PATHE:	DB	0
                      	
  CDBA  4F4B24        	OK:	DB	"OK$"
  CDBD  536B697024    	SKIP:	DB	"Skip$"
  CDC2  6B206279746573	KBFREE:	DB	"k bytes free",9,'$'
  CDD0  20202020646972	DIRMES:	DB	"    dir $"
  CDD9  074572726F7221	COMERM:	DB	7,"Error!$"
                      	
  0009                	COMS	EQU	9
  CDE1                	COMTB:
  CDE1  44202020      		DB	"D   "	;1
  CDE5  35D0          		DW	C_DIR
  CDE7  44495220      		DB	"DIR "	;2
  CDEB  35D0          		DW	C_DIR
  CDED  434F5059      		DB	"COPY"	;3
  CDF1  2DD2          		DW	C_COPY
  CDF3  43442020      		DB	"CD  "	;4
  CDF7  2DCF          		DW	C_CD
  CDF9  44454C20      		DB	"DEL "	;5
  CDFD  18D0          		DW	C_DEL
  CDFF  50415448      		DB	"PATH"	;6
  CE03  E6D0          		DW	C_PATH
  CE05  52454E20      		DB	"REN "	;7
  CE09  22D0          		DW	C_REN
  CE0B  54595045      		DB	"TYPE"	;8
  CE0F  50D3          		DW	C_TYPE
  CE11  52454D20      		DB	"REM "	;9
  CE15  16D0          		DW	C_REM
                      	
  CE17                	WBOOT1:
  CE17  F3            		DI
  CE18  310000        		LD	SP,STACK
                      	
  CE1B  3EEC          		LD	A,INTVEC/256
  CE1D  ED47          		LD	I,A
                      	
  CE1F  3EE4          		LD	A,0E4H
  CE21  CD0DDB        		CALL	COMOUT
  CE24  3EC8          		LD	A,INTVEC
  CE26  CDE7DA        		CALL	OT49SB
                      	
  CE29  3ABCEC        		LD	A,(CRTCD+12)
  CE2C  B7            		OR	A
  CE2D  200C          		JR	NZ,SETCRT0
  CE2F  2130F8        		LD	HL,0-80*LINE
  CE32  22BAEC        		LD	(CRTCD+10),HL
  CE35  21B0FF        		LD	HL,0-80
  CE38  22BCEC        		LD	(CRTCD+12),HL
  CE3B                	SETCRT0:
  CE3B  21B0EC        		LD	HL,CRTCD
  CE3E  AF            		XOR	A
  CE3F                	SETCRT2:
  CE3F  010018        		LD	BC,01800H
  CE42  ED79          		OUT	(C),A
  CE44  0C            		INC	C
  CE45  04            		INC	B
  CE46  EDA3          		OUTI
  CE48  3C            		INC	A
  CE49  FE0C          		CP	12
  CE4B  20F2          		JR	NZ,SETCRT2
  CE4D  0D            		DEC	C
  CE4E  ED79          		OUT	(C),A
  CE50  0C            		INC	C
                      	;	OUT	(C),0		;未定義命令ニーモニック
  CE51  ED71          		DB	0EDH,071H
  CE53  0D            		DEC	C
  CE54  3C            		INC	A
  CE55  ED79          		OUT	(C),A
  CE57  0C            		INC	C
                      	;	OUT	(C),0		;未定義命令ニーモニック
  CE58  ED71          		DB	0EDH,071H
  CE5A  23            		INC	HL
  CE5B  23            		INC	HL
  CE5C  01031B        		LD	BC,01A03H+00100H
  CE5F  EDA3          		OUTI
  CE61  01D020        		LD	BC,01FD0H+00100H
  CE64  EDA3          		OUTI
  CE66  CDDCD0        		CALL	LTNL
  CE69                	COMMAND:
  CE69  CD21CF        		CALL	SETDTA1
  CE6C  D5            		PUSH	DE
  CE6D  3A87EC        		LD	A,(_DVSW)
  CE70  C641          		ADD	A,'A'
  CE72  5F            		LD	E,A
  CE73  CDCDEC        		CALL	_PRINT
  CE76  1E3E          		LD	E,'>'
  CE78  CDCDEC        		CALL	_PRINT
  CE7B  D1            		POP	DE		;DE=DTA1
  CE7C  3E50          		LD	A,80
  CE7E  12            		LD	(DE),A
  CE7F  CD28D8        		CALL	_SYS0A		;(BDOS)文字列入力
  CE82  CDDCD0        		CALL	LTNL
                      	
  CE85  118200        		LD	DE,DTA1+2
  CE88  CDFDEC        		CALL	_COMANL
  CE8B  30DC          		JR	NC,COMMAND
  CE8D  CDA2D7        		CALL	KEYBC
  CE90  11D9CD        		LD	DE,COMERM
  CE93  CDE3D3        		CALL	_SYS09		;(BDOS)文字列出力
  CE96  C7            		RST	0
                      	
  CE97                	COMANL:
  CE97  CDE6DC        		CALL	FILE
  CE9A  D5            		PUSH	DE
  CE9B  11DC00        		LD	DE,FNAME
  CE9E  1A            		LD	A,(DE)
  CE9F  FE20          		CP	020H
  CEA1  2848          		JR	Z,SDVSW
  CEA3  1B            		DEC	DE
  CEA4  1A            		LD	A,(DE)
  CEA5  C6FF          		ADD	A,0FFH
  CEA7  380A          		JR	C,COMB
  CEA9  13            		INC	DE
                      	
  CEAA  21E1CD        		LD	HL,COMTB
  CEAD  3E09          		LD	A,COMS
  CEAF  47            		LD	B,A
  CEB0  CD75DF        		CALL	CPNAME
  CEB3                	COMB:
  CEB3  D1            		POP	DE
  CEB4  D20F00        		JP	NC,JP_HL
  CEB7  EB            		EX	DE,HL
  CEB8  2297CF        		LD	(COMPAT+1),HL
  CEBB  22EECF        		LD	(BATPAT+1),HL
  CEBE  F5            		PUSH	AF
  CEBF  CD3FCF        		CALL	CEXE4
  CEC2  F1            		POP	AF
  CEC3  21DC00        		LD	HL,FNAME
  CEC6  116D00        		LD	DE,FCB2+1	;COMMAND NAME
  CEC9  010B00        		LD	BC,11
  CECC  EDB0          		LDIR
  CECE  1179CD        		LD	DE,PATHD
  CED1                	CEX1:
  CED1  1A            		LD	A,(DE)
  CED2  FE20          		CP	020H
  CED4  D8            		RET	C
  CED5  CDDBDC        		CALL	FILEC
  CED8  D5            		PUSH	DE
  CED9  216D00        		LD	HL,FCB2+1	;COMMAND NAME
  CEDC  11DC00        		LD	DE,FNAME
  CEDF  010B00        		LD	BC,11
  CEE2  EDB0          		LDIR
  CEE4  CD3FCF        		CALL	CEXE4
  CEE7  D1            		POP	DE
  CEE8  13            		INC	DE
  CEE9  18E6          		JR	CEX1
                      	
  CEEB                	SDVSW:
  CEEB  F1            		POP	AF
  CEEC  3ADB00        		LD	A,(FDRV)
  CEEF  3D            		DEC	A
  CEF0  5F            		LD	E,A
  CEF1  0E0E          		LD	C,00EH		;(BDOS)カレント・ドライブの設定
  CEF3  1833          		JR	SYSTEM0
                      	
  CEF5                	OPEN1:
  CEF5  21DB00        		LD	HL,FDRV
  CEF8                	OPEN:
  CEF8  0E11          		LD	C,011H		;(BDOS)最初のファイルの検索
  CEFA                	OPEN3:
  CEFA  D5            		PUSH	DE
  CEFB  1151FF        		LD	DE,DTA
  CEFE  CD1ECF        		CALL	SETDTA
  CF01  EB            		EX	DE,HL
  CF02  CD0500        		CALL	SYSTEM
  CF05  D1            		POP	DE
  CF06  B7            		OR	A
  CF07  C9            		RET
                      	
  CF08                	OPEN2:
  CF08  0E12          		LD	C,012H
  CF0A  18EE          		JR	OPEN3
                      	
  CF0C                	DEFCB:				;Z=Ok NZ=Error
  CF0C  1151FF        		LD	DE,DTA
  CF0F  CD26CF        		CALL	SYSC0F
                      	
  CF12  210000        		LD	HL,0
  CF15  2272FF        		LD	(DTA+33),HL
  CF18  2274FF        		LD	(DTA+35),HL
  CF1B  110001        		LD	DE,00100H
  CF1E                	SETDTA:
  CF1E  C3FCD5        		JP	_SYS1A		;(BDOS)DTAの設定
                      	
  CF21                	SETDTA1:
  CF21  118000        		LD	DE,DTA1
  CF24  18F8          		JR	SETDTA
                      	
  CF26                	SYSC0F:
  CF26  0E0F          		LD	C,00FH		;(BDOS)ファイルのオープン
  CF28                	SYSTEM0:
  CF28  CD0500        		CALL	SYSTEM
  CF2B  B7            		OR	A
  CF2C  C9            		RET
                      	
  CF2D                	C_CD:
  CF2D  CDDBDC        		CALL	FILEC
  CF30  210000        		LD	HL,0
  CF33  11DB00        		LD	DE,FDRV
  CF36  1803          		JR	S27
                      	
  CF38                	S27DTA:
  CF38  1151FF        		LD	DE,DTA
  CF3B                	S27:
  CF3B  0E27          		LD	C,027H		;(BDOS)ランダム・ブロック・リード
  CF3D  18E9          		JR	SYSTEM0
                      	
  CF3F                	CEXE4:
  CF3F  3ADB00        		LD	A,(FDRV)
  CF42  325700        		LD	(00057H),A
  CF45  2AE900        		LD	HL,(FDRV+14)
  CF48  225800        		LD	(00058H),HL
                      	
  CF4B  21E400        		LD	HL,FNAME+8
  CF4E  7E            		LD	A,(HL)
  CF4F  FE20          		CP	020H
  CF51  2007          		JR	NZ,CEXE7
  CF53  3E3F          		LD	A,'?'
  CF55  77            		LD	(HL),A
  CF56  23            		INC	HL
  CF57  77            		LD	(HL),A
  CF58  23            		INC	HL
  CF59  77            		LD	(HL),A
  CF5A                	CEXE7:
  CF5A  CDF5CE        		CALL	OPEN1
  CF5D                	CEXE5:
  CF5D  C0            		RET	NZ
  CF5E  2A5BFF        		LD	HL,(DTA+1+9)
  CF61  7C            		LD	A,H
  CF62  CDE2DF        		CALL	CAP
  CF65  67            		LD	H,A
  CF66  7D            		LD	A,L
  CF67  CDE2DF        		CALL	CAP
  CF6A  6F            		LD	L,A
  CF6B  3A5AFF        		LD	A,(DTA+1+8)
  CF6E  CDE2DF        		CALL	CAP
  CF71  D642          		SUB	'B'
  CF73  282E          		JR	Z,C_BAT
  CF75  3D            		DEC	A		;'C'
  CF76  2805          		JR	Z,C_EXE
  CF78                	CEXE6:
  CF78  CD08CF        		CALL	OPEN2
  CF7B  18E0          		JR	CEXE5
                      	
  CF7D                	C_EXE:
  CF7D  7C            		LD	A,H
  CF7E  FE4D          		CP	'M'
  CF80  20F6          		JR	NZ,CEXE6
                      	
  CF82  CD0CCF        		CALL	DEFCB
  CF85  2A0600        		LD	HL,(SYSTEM+1)
  CF88  25            		DEC	H
  CF89  CD38CF        		CALL	S27DTA
  CF8C  3D            		DEC	A
  CF8D  37            		SCF
  CF8E  C0            		RET	NZ
  CF8F  7C            		LD	A,H
  CF90  B5            		OR	L
  CF91  37            		SCF
  CF92  C8            		RET	Z
  CF93  CD21CF        		CALL	SETDTA1
  CF96  110000        	COMPAT:	LD	DE,0
  CF99  CDECD1        		CALL	SETFCB
  CF9C  AF            		XOR	A
  CF9D  67            		LD	H,A
  CF9E  6F            		LD	L,A	;HL=0x0000
  CF9F  F9            		LD	SP,HL	;STACK=0
  CFA0  E5            		PUSH	HL
  CFA1  24            		INC	H	;HL=0x0100
  CFA2  E9            		JP	(HL)
                      	
  CFA3                	C_BAT:
  CFA3  114154        		LD	DE,'A'+'T'*256
  CFA6  ED52          		SBC	HL,DE
  CFA8  20CE          		JR	NZ,CEXE6
                      	
  CFAA  F1            		POP	AF
  CFAB  F1            		POP	AF
  CFAC  CD0CCF        		CALL	DEFCB
  CFAF  210002        		LD	HL,00200H
  CFB2  CD38CF        		CALL	S27DTA
  CFB5  C6FE          		ADD	A,0FEH
  CFB7  D8            		RET	C
  CFB8  7D            		LD	A,L
  CFB9  B7            		OR	A
  CFBA  37            		SCF
  CFBB  C8            		RET	Z
  CFBC  3C            		INC	A
  CFBD  F5            		PUSH	AF
                      	
  CFBE  CDA2D7        		CALL	KEYBC
  CFC1  1E1A          		LD	E,01AH
  CFC3  CDCDEC        		CALL	_PRINT
  CFC6  C1            		POP	BC
  CFC7  210001        		LD	HL,00100H
  CFCA                	BAT1:
  CFCA  A7            		AND	A
  CFCB  05            		DEC	B
  CFCC  C8            		RET	Z
  CFCD  7E            		LD	A,(HL)
  CFCE  FE25          		CP	'%'
  CFD0  280C          		JR	Z,BAT2
  CFD2                	BAT1X:
  CFD2  7E            		LD	A,(HL)
  CFD3  23            		INC	HL
  CFD4  FE1A          		CP	01AH
  CFD6  C8            		RET	Z
  CFD7  FE0A          		CP	00AH
  CFD9  C488D7        		CALL	NZ,KEYBS
  CFDC  18EC          		JR	BAT1
                      	
  CFDE                	BAT2:
  CFDE  23            		INC	HL
  CFDF  7E            		LD	A,(HL)
  CFE0  2B            		DEC	HL
  CFE1  D631          		SUB	'1'
  CFE3  38ED          		JR	C,BAT1X
  CFE5  FE09          		CP	9
  CFE7  30E9          		JR	NC,BAT1X
  CFE9  23            		INC	HL
  CFEA  23            		INC	HL
  CFEB  3C            		INC	A
  CFEC  4F            		LD	C,A
  CFED  110000        	BATPAT:	LD	DE,0
  CFF0                	BAT3:
  CFF0  1A            		LD	A,(DE)
  CFF1  B7            		OR	A
  CFF2  28D6          		JR	Z,BAT1
  CFF4  CDC0DD        		CALL	SPCUT
  CFF7  0D            		DEC	C
  CFF8  2808          		JR	Z,BAT5
  CFFA                	BAT4:
  CFFA  1A            		LD	A,(DE)
  CFFB  FE21          		CP	021H
  CFFD  38F1          		JR	C,BAT3
  CFFF  13            		INC	DE
  D000  18F8          		JR	BAT4
  D002                	BAT5:
  D002  1A            		LD	A,(DE)
  D003  FE21          		CP	021H
  D005  38C3          		JR	C,BAT1
  D007  13            		INC	DE
  D008  CD88D7        		CALL	KEYBS
  D00B  18F5          		JR	BAT5
                      	
  D00D                	SWITCH:
  D00D  1A            		LD	A,(DE)
  D00E                	SW1:
  D00E  13            		INC	DE
  D00F  B9            		CP	C
  D010  1A            		LD	A,(DE)
  D011  C8            		RET	Z
  D012  FE20          		CP	020H
  D014  30F8          		JR	NC,SW1
  D016                	C_REM:
  D016  AF            		XOR	A
  D017  C9            		RET
                      	
  D018                	C_DEL:
  D018  CDECD1        		CALL	SETFCB
  D01B  CDEFD7        		CALL	_SYS08		;(BDOS)エコーなしコンソール入力
                      	
  D01E  0E13          		LD	C,013H
  D020  180A          		JR	CDEL1
                      	
  D022                	C_REN:
  D022  CDECD1        		CALL	SETFCB
  D025  3E10          		LD	A,010H		;ディレクトリも対象にする
  D027  326900        		LD	(FCB1+13),A	;属性
  D02A  0E17          		LD	C,017H		;(BDOS)ファイル名の変更
  D02C                	CDEL1:
  D02C  115C00        		LD	DE,FCB1
  D02F  CD0500        		CALL	SYSTEM
  D032  C6FF          		ADD	A,0FFH
  D034  C9            		RET
                      	
  D035                	C_DIR:
  D035  CDDBDC        		CALL	FILEC
  D038  21DC00        		LD	HL,FDRV+1
  D03B  CD8CD3        		CALL	CWILD1
  D03E  3EF1          		LD	A,0F1H
  D040  32E800        		LD	(FDRV+13),A
  D043  CDF5CE        		CALL	OPEN1
  D046                	CDIR1:
  D046  B7            		OR	A
  D047  2008          		JR	NZ,PDSKF
  D049  CD95D0        		CALL	P_NAME
  D04C  CD08CF        		CALL	OPEN2
  D04F  18F5          		JR	CDIR1
                      	
  D051                	PDSKF:
  D051  3ADB00        		LD	A,(FDRV)
  D054  5F            		LD	E,A
  D055  0E1B          		LD	C,01BH		;(BDOS)ディスク情報の獲得
  D057  CD0500        		CALL	SYSTEM
  D05A  4F            		LD	C,A
  D05B  C601          		ADD	A,001H
  D05D  D8            		RET	C
  D05E  AF            		XOR	A
  D05F                	PDS1:
  D05F  CB19          		RR	C
  D061  3804          		JR	C,PDS2
  D063  29            		ADD	HL,HL
  D064  8F            		ADC	A,A
  D065  18F8          		JR	PDS1
  D067                	PDS2:
  D067  CB50          		BIT	2,B
  D069  200A          		JR	NZ,PDSKF1
  D06B  CB3F          		SRL	A
  D06D  CB1C          		RR	H
  D06F  CB1D          		RR	L
  D071  CB10          		RL	B
  D073  18F2          		JR	PDS2
  D075                	PDSKF1:
  D075  CD18D1        		CALL	PRDEC
  D078  11C2CD        		LD	DE,KBFREE
  D07B  CDE3D3        		CALL	_SYS09		;(BDOS)文字列出力
  D07E  CD0AD1        		CALL	PUTDRV
  D081  3E5C          		LD	A,05CH
  D083  CDD9D7        		CALL	MSG_
  D086  2AE900        		LD	HL,(FDRV+14)
  D089  7C            		LD	A,H
  D08A  B5            		OR	L
  D08B  284F          		JR	Z,LTNL
  D08D  2B            		DEC	HL
  D08E  7C            		LD	A,H
  D08F  B5            		OR	L
  D090  C417D1        		CALL	NZ,PRDEC0
  D093  1847          		JR	LTNL
                      	
  D095                	P_NAME:
  D095  3A52FF        		LD	A,(DTA+1)
  D098  FE2E          		CP	'.'
  D09A  C8            		RET	Z
  D09B  3E20          		LD	A,020H
  D09D  CDD9D7        		CALL	MSG_
  D0A0  CDD9D7        		CALL	MSG_
  D0A3  3E3A          		LD	A,':'
  D0A5  CDD9D7        		CALL	MSG_
  D0A8  3A5DFF        		LD	A,(DTA+1+00BH)
  D0AB  F5            		PUSH	AF
  D0AC  0F            		RRCA
  D0AD  9F            		SBC	A,A
  D0AE  E60A          		AND	'*'-020H
  D0B0  C620          		ADD	A,020H
  D0B2  CDD9D7        		CALL	MSG_
  D0B5  CD0AD1        		CALL	PUTDRV
  D0B8  2152FF        		LD	HL,DTA+1
  D0BB  CD59D1        		CALL	FPRNT
                      	
  D0BE  F1            		POP	AF
  D0BF  CB67          		BIT	4,A
  D0C1  2808          		JR	Z,DIR3
  D0C3  11D0CD        		LD	DE,DIRMES
  D0C6  CDE3D3        		CALL	_SYS09		;(BDOS)文字列出力
  D0C9  1809          		JR	DIR6
  D0CB                	DIR3:
  D0CB  3A70FF        		LD	A,(DTA+1+01EH)
  D0CE  2A6EFF        		LD	HL,(DTA+1+01CH)
  D0D1  CD18D1        		CALL	PRDEC
  D0D4                	DIR6:
  D0D4  3AB1EC        		LD	A,(CRTCD+1)
  D0D7  FE29          		CP	40+1
  D0D9  D47BD1        		CALL	NC,PRTTMS
                      	
  D0DC                	LTNL:
  D0DC  1E0D          		LD	E,00DH
  D0DE  CDECD7        		CALL	PRINTX
  D0E1  1E0A          		LD	E,00AH
  D0E3  C3ECD7        		JP	PRINTX
                      	
  D0E6                	C_PATH:
  D0E6  CDC0DD        		CALL	SPCUT
  D0E9  2179CD        		LD	HL,PATHD
  D0EC  FE21          		CP	021H
  D0EE  300E          		JR	NC,CPATH0
  D0F0  2B            		DEC	HL
  D0F1  2B            		DEC	HL
  D0F2                	CPATHP:
  D0F2  7E            		LD	A,(HL)
  D0F3  23            		INC	HL
  D0F4  FE20          		CP	020H
  D0F6  3F            		CCF
  D0F7  30E3          		JR	NC,LTNL
  D0F9  CDD9D7        		CALL	MSG_
  D0FC  18F4          		JR	CPATHP
  D0FE                	CPATH0:
  D0FE  FE3B          		CP	';'
  D100  2001          		JR	NZ,CPATH1
  D102  13            		INC	DE
  D103                	CPATH1:
  D103  EB            		EX	DE,HL
  D104  014000        		LD	BC,PATHX
  D107  EDB0          		LDIR
  D109  C9            		RET
                      	
  D10A                	PUTDRV:
  D10A  3ADB00        		LD	A,(FDRV)
  D10D  C640          		ADD	A,'A'-1
  D10F  CDD9D7        		CALL	MSG_
  D112  3E3A          		LD	A,':'
  D114                	MSGR:
  D114  C3D9D7        		JP	MSG_
                      	
  D117                	PRDEC0:
  D117  AF            		XOR	A
  D118                	PRDEC:
  D118  5F            		LD	E,A
  D119  010000        		LD	BC,0
  D11C  ED43D600      		LD	(DECBF),BC
  D120  ED43D800      		LD	(DECBF+2),BC
                      	
  D124  0E18          		LD	C,24
  D126                	DEC1:
  D126  29            		ADD	HL,HL
  D127  7B            		LD	A,E
  D128  8F            		ADC	A,A
  D129  5F            		LD	E,A
  D12A  E5            		PUSH	HL
  D12B  21D900        		LD	HL,DECBF+3
  D12E  0604          		LD	B,4
  D130                	DEC2:
  D130  7E            		LD	A,(HL)
  D131  8F            		ADC	A,A
  D132  27            		DAA
  D133  77            		LD	(HL),A
  D134  2B            		DEC	HL
  D135  10F9          		DJNZ	DEC2
  D137  E1            		POP	HL
  D138  0D            		DEC	C
  D139  20EB          		JR	NZ,DEC1
                      	
  D13B  21D600        		LD	HL,DECBF
  D13E  3E20          		LD	A,020H
  D140  0603          		LD	B,3
  D142                	DEC3:
  D142  CD4FD1        		CALL	DEC4
  D145  CD4FD1        		CALL	DEC4
  D148  23            		INC	HL
  D149  10F7          		DJNZ	DEC3
  D14B                	DECX:
  D14B  CD4FD1        		CALL	DEC4
  D14E  AF            		XOR	A
  D14F                	DEC4:
  D14F  ED6F          		RLD
  D151  FE20          		CP	020H
  D153  2802          		JR	Z,DEC5
  D155  F630          		OR	030H
  D157                	DEC5:
  D157  18BB          		JR	MSGR
                      	
  D159                	FPRNT:
  D159  0608          		LD	B,8
  D15B  CD6CD1        		CALL	P_N1
  D15E  7E            		LD	A,(HL)
  D15F  C680          		ADD	A,0A0H-020H
  D161  FEA0          		CP	0A0H
  D163  2802          		JR	Z,FPR1
  D165  3E2E          		LD	A,'.'
  D167                	FPR1:
  D167  CDD9D7        		CALL	MSG_
  D16A  0603          		LD	B,3
                      	
  D16C                	P_N1:
  D16C  C5            		PUSH	BC
  D16D  E5            		PUSH	HL
  D16E  7E            		LD	A,(HL)
  D16F  CDEEDF        		CALL	CAP3
  D172  CDD9D7        		CALL	MSG_
  D175  E1            		POP	HL
  D176  C1            		POP	BC
  D177  23            		INC	HL
  D178  10F2          		DJNZ	P_N1
  D17A  C9            		RET
                      	
  D17B                	PRTTMS:
  D17B  3E20          		LD	A,020H
  D17D  CDD9D7        		CALL	MSG_
                      	
  D180  2A6AFF        		LD	HL,(DTA+1+24)
  D183  7D            		LD	A,L
  D184  B7            		OR	A
  D185  C8            		RET	Z
  D186  CB3C          		SRL	H
  D188  17            		RLA
  D189  17            		RLA
  D18A  17            		RLA
  D18B  17            		RLA
  D18C  E60F          		AND	00FH
  D18E  57            		LD	D,A
  D18F  7C            		LD	A,H
  D190  C650          		ADD	A,80
  D192  CDD7D1        		CALL	PRTA
  D195  3E2D          		LD	A,'-'
  D197  CDD9D7        		CALL	MSG_
  D19A  7A            		LD	A,D
  D19B  CDD7D1        		CALL	PRTA
  D19E  3E2D          		LD	A,'-'
  D1A0  CDD9D7        		CALL	MSG_
  D1A3  7D            		LD	A,L
  D1A4  E61F          		AND	01FH
  D1A6  CDD7D1        		CALL	PRTA
                      	
  D1A9  2A68FF        		LD	HL,(DTA+1+22)
                      	
  D1AC  3E20          		LD	A,020H
  D1AE  CDD9D7        		CALL	MSG_
  D1B1  7C            		LD	A,H
  D1B2  65            		LD	H,L
  D1B3  1F            		RRA
  D1B4  CB1D          		RR	L
  D1B6  1F            		RRA
  D1B7  CB1D          		RR	L
  D1B9  1F            		RRA
  D1BA  CB1D          		RR	L
  D1BC  E61F          		AND	01FH
  D1BE  CDD7D1        		CALL	PRTA
  D1C1  3E3A          		LD	A,':'
  D1C3  CDD9D7        		CALL	MSG_
  D1C6  7D            		LD	A,L
  D1C7  0F            		RRCA
  D1C8  0F            		RRCA
  D1C9  E63F          		AND	03FH
  D1CB  CDD7D1        		CALL	PRTA
  D1CE  3E3A          		LD	A,':'
  D1D0  CDD9D7        		CALL	MSG_
  D1D3  7C            		LD	A,H
  D1D4  E61F          		AND	01FH
  D1D6  87            		ADD	A,A
                      	
                      	;	PRINT10
                      	
  D1D7                	PRTA:
  D1D7  E5            		PUSH	HL
  D1D8  0608          		LD	B,8
  D1DA  4F            		LD	C,A
  D1DB  AF            		XOR	A
  D1DC                	PRTA1:
  D1DC  CB01          		RLC	C
  D1DE  8F            		ADC	A,A
  D1DF  27            		DAA
  D1E0  10FA          		DJNZ	PRTA1
  D1E2  21D600        		LD	HL,DECBF
  D1E5  77            		LD	(HL),A
  D1E6  AF            		XOR	A
  D1E7  CD4BD1        		CALL	DECX
  D1EA  E1            		POP	HL
  D1EB  C9            		RET
                      	
  D1EC                	SETFCB:
  D1EC  CDC0DD        		CALL	SPCUT
  D1EF  1A            		LD	A,(DE)
  D1F0  FE20          		CP	020H
  D1F2  3801          		JR	C,SETFCBA
  D1F4  1B            		DEC	DE
  D1F5                	SETFCBA:
  D1F5  D5            		PUSH	DE
  D1F6  215C00        		LD	HL,FCB1
  D1F9  115D00        		LD	DE,FCB1+1
  D1FC  012300        		LD	BC,00023H
  D1FF  70            		LD	(HL),B		;B=0
  D200  EDB0          		LDIR
  D202  D1            		POP	DE
  D203  D5            		PUSH	DE
  D204  215C00        		LD	HL,FCB1
  D207  CD5AD6        		CALL	_SYS29		;(BDOS)ファイル名の解析
  D20A  216C00        		LD	HL,FCB2
  D20D  CD5AD6        		CALL	_SYS29		;(BDOS)ファイル名の解析
  D210  E1            		POP	HL
  D211  010050        		LD	BC,05000H
  D214  118100        		LD	DE,00081H
  D217                	SETFCB1:
  D217  7E            		LD	A,(HL)
  D218  23            		INC	HL
  D219  FE20          		CP	020H
  D21B  3805          		JR	C,SETFCB2
  D21D  12            		LD	(DE),A
  D21E  13            		INC	DE
  D21F  0C            		INC	C
  D220  10F5          		DJNZ	SETFCB1
  D222                	SETFCB2:
  D222  79            		LD	A,C
  D223  328000        		LD	(DTA1),A
  D226  04            		INC	B
  D227  AF            		XOR	A
  D228                	SETFCB3:
  D228  12            		LD	(DE),A
  D229  13            		INC	DE
  D22A  10FC          		DJNZ	SETFCB3
  D22C  C9            		RET
                      	
  D22D                	C_COPY:
  D22D  CDECD1        		CALL	SETFCB
  D230  118100        		LD	DE,DTA1+1
  D233  0E2F          		LD	C,'/'
  D235  CD0DD0        		CALL	SWITCH
  D238  CDE2DF        		CALL	CAP
  D23B  32C3D2        		LD	(SW+1),A
                      	
  D23E  11E4EB        		LD	DE,BEEPD
  D241  CDDEDC        		CALL	FILEC2
  D244  216C00        		LD	HL,FCB2
  D247  CD61D6        		CALL	S29X1
                      	
  D24A  3E10          		LD	A,010H
  D24C  326900        		LD	(FCB1+13),A
  D24F  216D00        		LD	HL,FCB2+1
  D252  CD8CD3        		CALL	CWILD1
  D255                	COPY0:
  D255  CD89D3        		CALL	CWILD
  D258  215C00        		LD	HL,FCB1
  D25B  CDF8CE        		CALL	OPEN
  D25E  37            		SCF
  D25F                	COPY1:
  D25F  C0            		RET	NZ
  D260  CD0CCF        		CALL	DEFCB
                      	
  D263  3A5EFF        		LD	A,(DTA+13)
  D266  CB67          		BIT	4,A
  D268  2824          		JR	Z,COPY1A
                      	
  D26A  215D00        		LD	HL,FCB1+1
  D26D  CD0BE1        		CALL	CHKWILD
  D270  3817          		JR	C,COPY9
                      	
  D272  3E20          		LD	A,020H
  D274  325D00        		LD	(FCB1+1),A
  D277  2A6BFF        		LD	HL,(DTA+26)
  D27A  23            		INC	HL
  D27B  226A00        		LD	(FCB1+14),HL
  D27E  18D5          		JR	COPY0
                      	
  D280                	COPYS:
  D280  11BDCD        		LD	DE,SKIP
  D283                	COPY8:
  D283  CDE3D3        		CALL	_SYS09		;(BDOS)文字列出力
  D286  CDDCD0        		CALL	LTNL
  D289                	COPY9:
  D289  CD08CF        		CALL	OPEN2
  D28C  18D1          		JR	COPY1
                      	
  D28E                	COPY1A:
  D28E  216C00        		LD	HL,FCB2
  D291  11DB00        		LD	DE,FDRV
  D294  0153FF        		LD	BC,DTA+2
  D297  EDA0          		LDI
  D299  3E0B          		LD	A,11
  D29B                	COPY2:
  D29B  F5            		PUSH	AF
  D29C  7E            		LD	A,(HL)
  D29D  FE3F          		CP	'?'
  D29F  2001          		JR	NZ,COPY3
  D2A1  0A            		LD	A,(BC)
  D2A2                	COPY3:
  D2A2  12            		LD	(DE),A
  D2A3  03            		INC	BC
  D2A4  13            		INC	DE
  D2A5  23            		INC	HL
  D2A6  F1            		POP	AF
  D2A7  3D            		DEC	A
  D2A8  20F1          		JR	NZ,COPY2
  D2AA  010500        		LD	BC,16-11
  D2AD  EDB0          		LDIR
  D2AF                	PUTNAME:
  D2AF  215D00        		LD	HL,FCB1+1
  D2B2  CD0BE1        		CALL	CHKWILD
  D2B5  300B          		JR	NC,PUTN1
  D2B7  21DC00        		LD	HL,FDRV+1
  D2BA  CD59D1        		CALL	FPRNT
  D2BD  3E20          		LD	A,020H
  D2BF  CDD9D7        		CALL	MSG_
  D2C2                	PUTN1:
  D2C2  3E00          	SW:	LD	A,000H
  D2C4  FE54          		CP	'T'
  D2C6  2005          		JR	NZ,CSW1
  D2C8  21E2D2        		LD	HL,SWNE
  D2CB  1807          		JR	SWT1
  D2CD                	CSW1:
  D2CD  FE4E          		CP	'N'
  D2CF  2011          		JR	NZ,SWNE
  D2D1  2180D2        		LD	HL,COPYS
  D2D4                	SWT1:
  D2D4  11DB00        		LD	DE,FDRV
  D2D7  CD26CF        		CALL	SYSC0F
  D2DA  2801          		JR	Z,SWN1
  D2DC  E9            		JP	(HL)
  D2DD                	SWN1:
  D2DD  CD3BD3        		CALL	CTIME
  D2E0  309E          		JR	NC,COPYS
  D2E2                	SWNE:
  D2E2  11DB00        		LD	DE,FDRV
  D2E5  0E16          		LD	C,016H		;(BDOS)ファイルの作成
  D2E7  CD28CF        		CALL	SYSTEM0
  D2EA  204D          		JR	NZ,COPYE2
  D2EC  67            		LD	H,A		;A=0
  D2ED  6F            		LD	L,A
  D2EE  22FC00        		LD	(FDRV+33),HL
  D2F1  22FE00        		LD	(FDRV+35),HL
  D2F4                	COPY6:
  D2F4  CD9BD3        		CALL	BUFSIZ
  D2F7  CD38CF        		CALL	S27DTA
  D2FA  47            		LD	B,A
  D2FB  3C            		INC	A
  D2FC  2833          		JR	Z,COPYE
  D2FE  7C            		LD	A,H
  D2FF  B5            		OR	L
  D300  280E          		JR	Z,COPY7
  D302  11DB00        		LD	DE,FDRV
  D305  0E26          		LD	C,026H		;(BDOS)ランダム・ブロック・ライト
  D307  CD0500        		CALL	SYSTEM
  D30A  B7            		OR	A
  D30B  2024          		JR	NZ,COPYE
  D30D  05            		DEC	B
  D30E  20E4          		JR	NZ,COPY6
  D310                	COPY7:
  D310  3A5EFF        		LD	A,(DTA+13)
  D313  32E800        		LD	(FDRV+13),A
  D316  2165FF        		LD	HL,DTA+20
  D319  11EF00        		LD	DE,FDRV+20
  D31C  010400        		LD	BC,4
  D31F  EDB0          		LDIR
                      	
  D321  11DB00        		LD	DE,FDRV
  D324  0E10          		LD	C,010H		;(BDOS)ファイルのクローズ
  D326  CD28CF        		CALL	SYSTEM0
  D329  2006          		JR	NZ,COPYE
                      	
  D32B  11BACD        		LD	DE,OK
  D32E  C383D2        		JP	COPY8
                      	
  D331                	COPYE:
  D331  11DB00        		LD	DE,FDRV
  D334  0E13          		LD	C,013H		;(BDOS)ファイルの削除
  D336  CD0500        		CALL	SYSTEM
  D339                	COPYE2:
  D339  37            		SCF
  D33A  C9            		RET
                      	
  D33B                	CTIME:
  D33B  ED5B65FF      		LD	DE,(DTA+20)
  D33F  2AEF00        		LD	HL,(FDRV+20)
  D342  A7            		AND	A
  D343  ED52          		SBC	HL,DE
  D345  C0            		RET	NZ
  D346  ED5B67FF      		LD	DE,(DTA+22)
  D34A  2AF100        		LD	HL,(FDRV+22)
  D34D  ED52          		SBC	HL,DE
  D34F  C9            		RET
                      	
  D350                	C_TYPE:
  D350  CDECD1        		CALL	SETFCB
  D353  215C00        		LD	HL,FCB1
  D356  CDF8CE        		CALL	OPEN
  D359  37            		SCF
  D35A                	TYPE1:
  D35A  C0            		RET	NZ
  D35B  CD0CCF        		CALL	DEFCB
  D35E  1E1A          		LD	E,01AH
  D360  CDCDEC        		CALL	_PRINT
  D363                	TYPE2:
  D363  CD9BD3        		CALL	BUFSIZ
  D366  CD38CF        		CALL	S27DTA
  D369  C6FE          		ADD	A,0FEH
  D36B  D8            		RET	C
  D36C  7C            		LD	A,H
  D36D  B5            		OR	L
  D36E  2814          		JR	Z,TYPEE
  D370  010001        		LD	BC,00100H
  D373                	TYPE3:
  D373  0A            		LD	A,(BC)
  D374  03            		INC	BC
  D375  FE1A          		CP	01AH
  D377  280B          		JR	Z,TYPEE
  D379  5F            		LD	E,A
  D37A  CDE2D7        		CALL	_SYS02		;(BDOS)コンソール出力
  D37D  2B            		DEC	HL
  D37E  7C            		LD	A,H
  D37F  B5            		OR	L
  D380  20F1          		JR	NZ,TYPE3
  D382  18DF          		JR	TYPE2
  D384                	TYPEE:
  D384  CD08CF        		CALL	OPEN2
  D387  18D1          		JR	TYPE1
                      	
  D389                	CWILD:
  D389  215D00        		LD	HL,FCB1+1
  D38C                	CWILD1:
  D38C  7E            		LD	A,(HL)
  D38D  FE20          		CP	020H
  D38F  C0            		RET	NZ
  D390                	CWILD2:
  D390  54            		LD	D,H
  D391  5D            		LD	E,L
  D392  13            		INC	DE
  D393  010A00        		LD	BC,10
  D396  363F          		LD	(HL),'?'
  D398  EDB0          		LDIR
  D39A  C9            		RET
                      	
  D39B                	BUFSIZ:
  D39B  3A0700        		LD	A,(SYSTEM+2)
  D39E  D603          		SUB	3
  D3A0  E6F8          		AND	0F8H
  D3A2  67            		LD	H,A
  D3A3  2E00          		LD	L,0
  D3A5  C9            		RET
                      	
                      	
                      	;LDOS.ASM
                      	
                      	;	LSX-Dodgers OS
                      	
  D3A6                	BOOT:
  D3A6  C30000        		JP	0
  D3A9                	_SYS00:		;(BDOS)プログラム終了
  D3A9                	WBOOT:
  D3A9  C317CE        		JP	WBOOT1
  D3AC                	CONST_:
  D3AC  C35CD8        		JP	CONSTX
  D3AF                	_SYS07:		;(BDOS)コンソール直接入力
  D3AF                	CONIN:
  D3AF  C303D8        		JP	FLGET
  D3B2                	CONOUT:
  D3B2  C3B4DA        		JP	CONOUT1
                      	
  D3B5                	BDOS0:
  D3B5  E5            		PUSH	HL
  D3B6  210001        		LD	HL,00100H
  D3B9  39            		ADD	HL,SP
  D3BA  3810          		JR	C,BDOS1X	;EXTSP = 0FFD4H
  D3BC                	BDOS2:
  D3BC  E1            		POP	HL
  D3BD  ED73C8D3      		LD	(BDSP+1),SP
  D3C1  31D4FF        		LD	SP,EXTSP
  D3C4  CDCBD3        		CALL	BDOS1
  D3C7  310000        	BDSP:	LD	SP,0
  D3CA  C9            		RET
  D3CB                	BDOS1:
  D3CB  E5            		PUSH	HL
  D3CC                	BDOS1X:
  D3CC  79            		LD	A,C
  D3CD  FE31          		CP	031H
  D3CF  300A          		JR	NC,_ERROR
  D3D1  87            		ADD	A,A
  D3D2  6F            		LD	L,A
  D3D3  26EC          		LD	H,STABLE/256
  D3D5  7E            		LD	A,(HL)
  D3D6  2C            		INC	L
  D3D7  66            		LD	H,(HL)
  D3D8  6F            		LD	L,A
  D3D9  E3            		EX	(SP),HL
  D3DA  C9            		RET
                      	
  D3DB                	_ERROR:
  D3DB  013201        		LD	BC,00132H
  D3DE  113101        		LD	DE,VER
  D3E1                	_SYS1C:		;(BDOS)ディスクの書き込み禁止化
  D3E1                	_SYS1E:		;(BDOS)ファイル属性の設定
  D3E1                	_SYS20:		;(BDOS)利用者番号の設定と読み出し
  D3E1                	_SYS2E:		;(BDOS)ベリファイ・フラグの設定
  D3E1  AF            		XOR	A
  D3E2  C9            		RET
                      	
  D3E3                	_SYS09:		;文字列出力
  D3E3  D5            		PUSH	DE
  D3E4                	_SX09:
  D3E4  1A            		LD	A,(DE)
  D3E5  13            		INC	DE
  D3E6  FE24          		CP	'$'
  D3E8  282C          		JR	Z,SX0E2
  D3EA  D5            		PUSH	DE
  D3EB  5F            		LD	E,A
  D3EC  CDE2D7        		CALL	_SYS02
  D3EF  D1            		POP	DE
  D3F0  18F2          		JR	_SX09
                      	
  D3F2                	_SYS0C:		;(BDOS)バージョン番号の獲得
  D3F2  212200        		LD	HL,00022H
  D3F5  AF            		XOR	A
  D3F6  7D            		LD	A,L
  D3F7  C9            		RET
                      	
  D3F8                	_SYS0D:		;(BDOS)ディスク・リセット
  D3F8  CDDFEC        		CALL	_FFLUSH
  D3FB  E5            		PUSH	HL
  D3FC  218000        		LD	HL,00080H
  D3FF  228AEC        		LD	(_DTA),HL
  D402  E1            		POP	HL
  D403  D5            		PUSH	DE
  D404  1E00          		LD	E,0
  D406  3E            		DB	03EH
                      	
  D407                	_SYS0E:		;(BDOS)カレント・ドライブの設定
  D407  D5            		PUSH	DE
  D408  7B            		LD	A,E
  D409  DDE5          		PUSH	IX
  D40B  CDDCEC        		CALL	_GETDPB
  D40E  DDE1          		POP	IX
  D410  3804          		JR	C,SX0E2
  D412  7B            		LD	A,E
  D413  3287EC        		LD	(_DVSW),A
  D416                	SX0E2:
  D416  3E08          		LD	A,8
  D418  D1            		POP	DE
  D419  C9            		RET
                      	
  D41A                	_SYS0F:		;(BDOS)ファイルのオープン
  D41A  CDD2DD        		CALL	SETDRV
  D41D  FD7E1C        		LD	A,(IY+28)	;(FCB)オープン・モード
  D420  C602          		ADD	A,002H		;Write
  D422  2848          		JR	Z,FEND0F
  D424  CD07E1        		CALL	CHKWILDX
                      	
  D427  D4F2DD        		CALL	NC,SOPENX
  D42A                	_S16XX:
  D42A  3840          		JR	C,FEND0F
                      					;Directory location
  D42C  3A9FEC        		LD	A,(_FILEN)
  D42F  FD7719        		LD	(IY+25),A	;(FCB)ディレクトリ・ロケーション
                      	;				_DIRF
  D432  3AA0EC        		LD	A,(_DIRF)
  D435  FD771D        		LD	(IY+29),A	;(FCB)ディレクトリ・モード
                      	;				_FBPS
  D438  FD731E        		LD	(IY+30),E	;(FCB)ディレクトリ・ポジション
  D43B  FD721F        		LD	(IY+31),D
                      	;				Open(Read)
  D43E  FD361CFF      		LD	(IY+28),0FFH	;(FCB)オープン・モード
                      	;				FILENAME
  D442  FDE5          		PUSH	IY
  D444  D1            		POP	DE
  D445  13            		INC	DE
  D446  010B00        		LD	BC,11
  D449  EDB0          		LDIR
                      	;				Attribute
  D44B  7E            		LD	A,(HL)
  D44C  FD770D        		LD	(IY+13),A	;(FCB)属性(アトリビュート)
  D44F  110B00        		LD	DE,11		;Reserved
  D452  19            		ADD	HL,DE
                      						;(FCB)ファイルを最後に変更した時刻
  D453  11DAEB        		LD	DE,SDDATA		;(FCB)ファイルを最後に変更した日付
  D456  060A          		LD	B,SDDATAE-SDDATA	;(FCB)ファイルの先頭クラスタ
  D458                	S16LOOP:				;(FCB)ファイルのサイズ(バイト単位)
  D458  1A            		LD	A,(DE)
  D459  13            		INC	DE
  D45A  3261D4        		LD	(S16PAT+2),A
  D45D  7E            		LD	A,(HL)
  D45E  23            		INC	HL
  D45F  FD7700        	S16PAT:	LD	(IY+0),A
  D462  10F4          		DJNZ	S16LOOP
                      	
  D464  AF            		XOR	A
  D465  FD770C        		LD	(IY+12),A	;(FCB)カレント・ブロック
  D468  FD222AD5      		LD	(OFCB+1),IY
  D46C                	FEND0F:
  D46C  C311D5        		JP	FEND
                      	
  D46F                	_SYS10:		;(BDOS)ファイルのクローズ
  D46F  CDD2DD        		CALL	SETDRV
  D472  FD7E1C        		LD	A,(IY+28)	;(FCB)オープン・モード
  D475  D6FE          		SUB	0FEH
  D477  37            		SCF
  D478  3F            		CCF
  D479  2032          		JR	NZ,FEND10
  D47B                	_S10A:				;Write
  D47B  FD770E        		LD	(IY+14),A	;(FCB)レコード・サイズ/アクセスするディレクトリのクラスタ番号+1
  D47E  FD770F        		LD	(IY+15),A
                      	
  D481  FD341C        		INC	(IY+28)		;0FEH->0FFH ;オープン・モード
  D484  CD00E2        		CALL	SETTMS
                      	
  D487  FD7E1D        		LD	A,(IY+29)	;(FCB)ディレクトリ・モード
  D48A  32A0EC        		LD	(_DIRF),A
  D48D  FD5E1E        		LD	E,(IY+30)	;(FCB)ディレクトリ・ポジション
  D490  FD561F        		LD	D,(IY+31)
  D493  CD21DF        		CALL	DC
  D496  3879          		JR	C,FEND
                      	
  D498  FD7E19        		LD	A,(IY+25)	;(FCB)ディレクトリ・ロケーション
  D49B  E61F          	SDECM1:	AND	01FH		;自己書き換え(1セクタ辺りのディレクトリエントリ数-1) 1024=01FH / 512=00FH / 256=7
  D49D  6F            		LD	L,A
  D49E  2600          		LD	H,0
  D4A0  29            		ADD	HL,HL		;*2
  D4A1  29            		ADD	HL,HL		;*4
  D4A2  29            		ADD	HL,HL		;*8
  D4A3  29            		ADD	HL,HL		;*16
  D4A4  29            		ADD	HL,HL		;*32
  D4A5  ED4B7EEC      		LD	BC,(_DTBUF)
  D4A9  09            		ADD	HL,BC
                      	
  D4AA  CD17E1        		CALL	SDIRENT
  D4AD                	FEND10:
  D4AD  1862          		JR	FEND
                      	
  D4AF                	OPENDD:
  D4AF  FD361CFD      		LD	(IY+28),0FDH	;(FCB)オープン・モード
  D4B3  FD360D20      		LD	(IY+13),020H	;(FCB)属性(アトリビュート)
  D4B7  CD05E2        		CALL	SETTMSX
  D4BA  1855          		JR	FEND
                      	
  D4BC                	_SYS11:		;(BDOS)最初のファイルの検索
  D4BC  CDD2DD        		CALL	SETDRV
  D4BF  CD68DF        		CALL	CHKDDX
  D4C2  3818          		JR	C,_S11A
  D4C4  FDE5          		PUSH	IY
  D4C6  E1            		POP	HL
  D4C7  ED5B8AEC      		LD	DE,(_DTA)
  D4CB  010C00        		LD	BC,12
  D4CE  EDB0          		LDIR
  D4D0  3E20          		LD	A,020H
  D4D2  12            		LD	(DE),A
  D4D3  13            		INC	DE
  D4D4  62            		LD	H,D
  D4D5  6B            		LD	L,E
  D4D6  13            		INC	DE
  D4D7  0E13          		LD	C,19
  D4D9  70            		LD	(HL),B
  D4DA  1833          		JR	_S11B
  D4DC                	_S11A:
  D4DC  CD26DE        		CALL	SOPEN
  D4DF                	_S12X1:
  D4DF  3830          		JR	C,FEND
  D4E1  CDC0DE        		CALL	SOPENE2
  D4E4  ED5B8AEC      		LD	DE,(_DTA)
  D4E8  3A88EC        		LD	A,(_DRV)
  D4EB  3C            		INC	A
  D4EC  12            		LD	(DE),A
  D4ED  D5            		PUSH	DE
  D4EE  13            		INC	DE
  D4EF  012000        		LD	BC,32
  D4F2  EDB0          		LDIR
  D4F4  FD6E0E        		LD	L,(IY+14)	;(FCB)レコード・サイズ/アクセスするディレクトリのクラスタ番号+1
  D4F7  FD660F        		LD	H,(IY+15)
  D4FA  22F4EB        		LD	(SCDIR),HL
  D4FD  2A9AEC        		LD	HL,(_FBPS)
  D500  22F6EB        		LD	(SFBPS),HL
  D503  2A9FEC        		LD	HL,(_FILEN)
  D506  22F8EB        		LD	(SFNDF),HL	;Directory position and Flags
  D509  E1            		POP	HL
  D50A  11ABE2        		LD	DE,SFILE
  D50D  0E21          		LD	C,33
  D50F                	_S11B:
  D50F  EDB0          		LDIR
  D511                	FEND:
  D511  9F            		SBC	A,A		;CF=0 A=0 : CF=1 A=0FFH
  D512                	FENDE:
  D512  FDE1          		POP	IY
  D514  C1            		POP	BC
  D515  D1            		POP	DE
  D516  E1            		POP	HL
  D517  C9            		RET
                      	
  D518                	_SYS12:		;(BDOS)次のファイルの検索
  D518  E5            		PUSH	HL
  D519  D5            		PUSH	DE
  D51A  C5            		PUSH	BC
  D51B  FDE5          		PUSH	IY
  D51D  CD8ADE        		CALL	NOPEN
  D520  18BD          		JR	_S12X1
                      	
  D522                	_S16K:
  D522  FD7E1C        		LD	A,(IY+28)	;(FCB)オープン・モード
  D525  FEFD          		CP	0FDH		;Device(0FDH)
  D527  37            		SCF
  D528  C8            		RET	Z
                      	
  D529  110000        	OFCB:	LD	DE,0
  D52C  D5            		PUSH	DE
  D52D  061A          		LD	B,26		;First cluster
  D52F                	S16K1:
  D52F  13            		INC	DE
  D530  23            		INC	HL
  D531  10FC          		DJNZ	S16K1
                      	
  D533  1A            		LD	A,(DE)
  D534  BE            		CP	(HL)
  D535  2013          		JR	NZ,S16K2
  D537  13            		INC	DE
  D538  23            		INC	HL
  D539  1A            		LD	A,(DE)
  D53A  BE            		CP	(HL)
  D53B  200D          		JR	NZ,S16K2
                      	
  D53D  E1            		POP	HL
  D53E  FDE5          		PUSH	IY
  D540  D1            		POP	DE
  D541  1A            		LD	A,(DE)		;Drive
  D542  BE            		CP	(HL)
  D543  2005          		JR	NZ,S16K2
                      	
  D545  ED52          		SBC	HL,DE		;CP HL,DE
  D547  37            		SCF
  D548  C0            		RET	NZ
  D549  E5            		PUSH	HL
  D54A                	S16K2:
  D54A  E1            		POP	HL
  D54B  FDE5          		PUSH	IY
  D54D  D1            		POP	DE
  D54E                	_SYS13:		;(BDOS)ファイルの削除
  D54E  CDD2DD        		CALL	SETDRV
  D551  CD31E0        		CALL	KILL
  D554                	FEND13:
  D554  18BB          		JR	FEND
                      	
  D556                	_SYS14:		;(BDOS)シーケンシャルな読み出し
  D556  CDD2DD        		CALL	SETDRV
  D559  CD32E2        		CALL	PUSHRR
  D55C  CD73E2        		CALL	GETSEQ
                      	
  D55F  CD87E2        		CALL	RB_READ
  D562  E5            		PUSH	HL
  D563  CD46E2        		CALL	SETSEQ
  D566                	SREAD:
  D566  E1            		POP	HL
                      	
  D567  C601          		ADD	A,001H
  D569  38A6          		JR	C,FEND
                      	
  D56B  7D            		LD	A,L
  D56C  D601          		SUB	001H
  D56E                	FENDX:
  D56E  9F            		SBC	A,A
  D56F  E603          		AND	3
  D571  1F            		RRA
  D572  189E          		JR	FENDE
                      	
  D574                	_SYS15:		;(BDOS)シーケンシャルな書き込み
  D574  CDD2DD        		CALL	SETDRV
  D577  CD32E2        		CALL	PUSHRR
  D57A  CD73E2        		CALL	GETSEQ
                      	
  D57D  CD80E2        		CALL	RB_WRITE
  D580  E5            		PUSH	HL
  D581  CD46E2        		CALL	SETSEQ
  D584                	SWRITE:
  D584  E1            		POP	HL
                      	
  D585  C6FF          		ADD	A,0FFH
  D587  18E5          		JR	FENDX
                      	
  D589                	_SYS17:		;(BDOS)ファイル名の変更
  D589  CDD2DD        		CALL	SETDRV
  D58C  CD8DE0        		CALL	NAME
  D58F  18C3          		JR	FEND13
                      	
  D591                	_SYS16:		;(BDOS)ファイルの作成
  D591  CDD2DD        		CALL	SETDRV
                      	
  D594  CD07E1        		CALL	CHKWILDX
  D597  38BB          		JR	C,FEND13
  D599  FD7E01        		LD	A,(IY+1)	;(FCB)主ファイル名
  D59C  FE05          		CP	5
  D59E  2805          		JR	Z,_S16X2
  D5A0  FE21          		CP	021H
  D5A2  DA54D5        		JP	C,FEND13
  D5A5                	_S16X2:
                      	;				Clear FCB
  D5A5  FDE5          		PUSH	IY
  D5A7  E1            		POP	HL
  D5A8  011000        		LD	BC,16
  D5AB  09            		ADD	HL,BC
  D5AC                	_S16X1:
  D5AC  70            		LD	(HL),B		;B=0
  D5AD  23            		INC	HL
  D5AE  0D            		DEC	C
  D5AF  20FB          		JR	NZ,_S16X1
                      	
  D5B1  CD05E2        		CALL	SETTMSX
  D5B4  FD360DFF      		LD	(IY+13),0FFH	;(FCB)Attribute
  D5B8  CDF2DD        		CALL	SOPENX
  D5BB  3F            		CCF
  D5BC  CC22D5        		CALL	Z,_S16K
  D5BF  D4D1DE        		CALL	NC,COPEN
  D5C2  D417E1        		CALL	NC,SDIRENT
  D5C5  C32AD4        		JP	_S16XX
                      	
  D5C8                	_SYS21:		;(BDOS)ランダムな読み出し
                      	
  D5C8  CDD2DD        		CALL	SETDRV
  D5CB  CD32E2        		CALL	PUSHRR
  D5CE  FD6E21        		LD	L,(IY+33)	;(FCB)Random record
  D5D1  FD6622        		LD	H,(IY+34)
                      	
  D5D4  CD87E2        		CALL	RB_READ
  D5D7  E5            		PUSH	HL
  D5D8  CD5DE2        		CALL	POPRR
  D5DB  1889          		JR	SREAD
                      	
  D5DD                	_SYS22:		;(BDOS)ランダムな書き込み
  D5DD                	_SYS28:		;(BDOS)ランダムな書き込み・その2
  D5DD  CDD2DD        		CALL	SETDRV
  D5E0  CD32E2        		CALL	PUSHRR
  D5E3  FD6E21        		LD	L,(IY+33)	;(FCB)Random record
  D5E6  FD6622        		LD	H,(IY+34)
                      	
  D5E9  CD80E2        		CALL	RB_WRITE
  D5EC  E5            		PUSH	HL
  D5ED  CD5DE2        		CALL	POPRR
  D5F0  1892          		JR	SWRITE
                      	
  D5F2                	_SYS18:		;(BDOS)ログイン・ベクトルの獲得
  D5F2  21FF00        		LD	HL,000FFH
  D5F5  AF            		XOR	A
  D5F6  C9            		RET
                      	
  D5F7                	_SYS19:		;(BDOS)カレント・ドライブ番号の獲得
  D5F7  3A87EC        		LD	A,(_DVSW)
  D5FA  A7            		AND	A
  D5FB  C9            		RET
                      	
  D5FC                	_SYS1A:		;(BDOS)DTAの設定
  D5FC  ED538AEC      		LD	(_DTA),DE
  D600  AF            		XOR	A
  D601  C9            		RET
                      	
  D602                	_SYS1B:		;(BDOS)ディスク情報の獲得
  D602  7B            		LD	A,E
  D603  CDE5DD        		CALL	GETDRV
  D606  CDDCEC        		CALL	_GETDPB
  D609  D4E2EC        		CALL	NC,_RDFATX
  D60C  210000        		LD	HL,0
  D60F  D4E5E1        		CALL	NC,DSKF
                      	
  D612  ED5BE6E1      		LD	DE,(MAXCLP+1)	;DPB_08_MAXCL-1
  D616  1B            		DEC	DE		;DE←クラスタの総数
  D617  FD2A7CEC      		LD	IY,(_FATBF)	;IY←メモリ上のFATの先頭アドレス
  D61B  9F            		SBC	A,A
  D61C  D8            		RET	C
  D61D  4F            		LD	C,A		;C=0
  D61E  DD460F        		LD	B,(IX+00FH)	;DPB_0F_BPS
  D621  CBB8          		RES	7,B
  D623  DD7E07        		LD	A,(IX+7)	;DPB_07_SECPCL
  D626  C9            		RET
                      	
  D627                	_SYS1D:		;(BDOS)書き込みが禁止されているディスクの調査
  D627  AF            		XOR	A
  D628  67            		LD	H,A
  D629  6F            		LD	L,A
  D62A  C9            		RET
                      	
  D62B                	_SYS1F:		;(BDOS)ディスク装置のパラメータの読み出し
  D62B  2100ED        		LD	HL,DEVICE
  D62E  7B            		LD	A,E
  D62F  C3DCEC        		JP	_GETDPB
                      	
  D632                	_SYS23:		;(BDOS)ファイル・サイズの獲得
  D632  E5            		PUSH	HL
  D633  2A1EEC        		LD	HL,(STABLE+2*00FH)	;ファイルのオープン
  D636  CD0F00        		CALL	JP_HL
  D639  3814          		JR	C,_S23X1
                      	
  D63B  D5            		PUSH	DE		;EX DE,IY
  D63C  FDE3          		EX	(SP),IY		;
                      	;	POP	DE		;
                      	;	PUSH	DE		;DEを破壊しないように注意vv
  D63E  CD63E2        		CALL	GETSIZE
  D641                	_S24X1:
  D641  FD7521        		LD	(IY+33),L	;(FCB)Random record
  D644  FD7422        		LD	(IY+34),H
  D647  FD362300      		LD	(IY+35),0
                      	;	POP	DE		;^^^^^^^^^^^^^^^^^^^^^^^^
                      	;	PUSH	DE		;EX DE,IY
  D64B  FDE3          		EX	(SP),IY		;
  D64D  D1            		POP	DE		;
                      	
  D64E  AF            		XOR	A
  D64F                	_S23X1:
  D64F  E1            		POP	HL
  D650  C9            		RET
                      	
  D651                	_SYS24:		;(BDOS)ランダム・レコード・フィールドの設定
  D651  E5            		PUSH	HL
  D652  D5            		PUSH	DE		;EX DE,IY
  D653  FDE3          		EX	(SP),IY		;
                      	;	POP	DE		;
                      	;	PUSH	DE		;DEを破壊しないように注意vv
  D655  CD73E2        		CALL	GETSEQ
  D658  18E7          		JR	_S24X1		;^^^^^^^^^^^^^^^^^^^^^^^^
                      	
  D65A                	_SYS29:		;(BDOS)ファイル名の解析
  D65A  C5            		PUSH	BC
  D65B  E5            		PUSH	HL
  D65C  CDE6DC        		CALL	FILE
  D65F  E1            		POP	HL
  D660  C1            		POP	BC
  D661                	S29X1:
  D661  C5            		PUSH	BC
  D662  D5            		PUSH	DE
  D663  E5            		PUSH	HL
  D664  EB            		EX	DE,HL
  D665  21DB00        		LD	HL,FDRV
  D668  010D00        		LD	BC,13
  D66B  EDB0          		LDIR
  D66D  70            		LD	(HL),B
  D66E  0E03          		LD	C,3
  D670  EDB0          		LDIR
  D672  E1            		POP	HL
  D673  D1            		POP	DE
  D674  C1            		POP	BC
  D675  AF            		XOR	A
  D676  C9            		RET
                      	
  D677                	_SYS30:		;(BDOS)論理セクタを用いた書き込み
  D677  C5            		PUSH	BC
  D678  0120E8        		LD	BC,DWT_DPB
  D67B  1804          		JR	S2FX
  D67D                	_SYS2F:
  D67D  C5            		PUSH	BC
  D67E  01D0E7        		LD	BC,DRD_DPB
  D681                	S2FX:
  D681  ED4396D6      		LD	(S2FPAT+1),BC
  D685  CDDFEC        		CALL	_FFLUSH
                      	
  D688  D5            		PUSH	DE
  D689  E5            		PUSH	HL
  D68A  7D            		LD	A,L		;Drive
  D68B  CDD9EC        		CALL	_CHGDRV
  D68E  380D          		JR	C,S30X2
  D690  44            		LD	B,H		;Number of clusters
  D691  2A8AEC        		LD	HL,(_DTA)
  D694                	S30X:
  D694  C5            		PUSH	BC
  D695  CDD0E7        	S2FPAT:	CALL	DRD_DPB
  D698  C1            		POP	BC
  D699  3802          		JR	C,S30X2
  D69B  10F7          		DJNZ	S30X
  D69D                	S30X2:
  D69D  E1            		POP	HL
  D69E  D1            		POP	DE
  D69F  C1            		POP	BC
  D6A0  9F            		SBC	A,A
  D6A1  C9            		RET
                      	
                      	;LDIO.ASM
                      	
                      	;	LSX-Dodgers IO
                      	
                      	
  D6A2                	BIOS:
  D6A2  E5            		PUSH	HL
  D6A3  210081        		LD	HL,08100H
  D6A6  39            		ADD	HL,SP
  D6A7  E1            		POP	HL
  D6A8  300E          		JR	NC,BIOS2
  D6AA                	BIOS1:
  D6AA  CDB2D6        		CALL	BIOS3
  D6AD  061E          		LD	B,01EH
  D6AF  ED79          		OUT	(C),A
  D6B1  C9            		RET
  D6B2                	BIOS3:
  D6B2  C5            		PUSH	BC
  D6B3  061D          		LD	B,01DH
  D6B5  ED79          		OUT	(C),A
  D6B7  C9            		RET
  D6B8                	BIOS2:
  D6B8  ED73C3D6      		LD	(SPPAT+1),SP	;スタックがBIOS-ROMと被っている場合
  D6BC  31D4FF        		LD	SP,EXTSP
  D6BF  CDAAD6        		CALL	BIOS1
  D6C2  310000        	SPPAT:	LD	SP,0
  D6C5  C9            		RET
                      	
  D6C6                	INT:
  D6C6  F5            		PUSH	AF
  D6C7  E5            		PUSH	HL
  D6C8  C5            		PUSH	BC
  D6C9  210001        		LD	HL,00100H
  D6CC  39            		ADD	HL,SP
  D6CD  3807          		JR	C,INTP1
  D6CF  ED7301D7      		LD	(INTSP+1),SP
  D6D3  31D4FF        		LD	SP,EXTSP
  D6D6                	INTP1:
  D6D6  CDF2DA        		CALL	IN49SB
  D6D9  67            		LD	H,A
  D6DA  CDF2DA        		CALL	IN49SB
  D6DD  6F            		LD	L,A
                      	
  D6DE  CB64          		BIT	4,H		;[GRAPH]
  D6E0  2010          		JR	NZ,SCEXE
  D6E2  7D            		LD	A,L
  D6E3  EE09          		XOR	9
  D6E5  2839          		JR	Z,DIAN
  D6E7  7C            		LD	A,H
  D6E8  0F            		RRCA			;[CTRL]
  D6E9  301E          		JR	NC,SCL
  D6EB  0F            		RRCA			;[SHIFT]
  D6EC  3804          		JR	C,SCEXE
  D6EE  3E80          		LD	A,080H
  D6F0  181E          		JR	SCG1
  D6F2                	SCEXE:
  D6F2  2292EC        		LD	(_KEYD),HL
  D6F5  CD55D7        		CALL	KEYSET1
                      	
  D6F8  21D4FF        		LD	HL,EXTSP
  D6FB  A7            		AND	A
  D6FC  ED72          		SBC	HL,SP
  D6FE  2003          		JR	NZ,INTPE1
                      	
  D700  310000        	INTSP:	LD	SP,0
  D703                	INTPE1:
  D703  C1            		POP	BC
  D704                	INTPE:
  D704  E1            		POP	HL
  D705                	INTPE2:
  D705  F1            		POP	AF
  D706                	INTCTCE:
  D706  FB            		EI
  D707  ED4D          		RETI
                      	
  D709                	SCL:
  D709  7D            		LD	A,L
  D70A  FE08          		CP	008H
  D70C  280D          		JR	Z,RESET
                      	
  D70E  3E02          		LD	A,002H
  D710                	SCG1:
  D710  E5            		PUSH	HL
  D711  21BFEC        		LD	HL,WK1FD0
  D714  AE            		XOR	(HL)
  D715  CDA3CC        		CALL	S1FD0
  D718  E1            		POP	HL
  D719  18D7          		JR	SCEXE
                      	
  D71B                	RESET:
  D71B  3E1D          		LD	A,01DH
  D71D  D300          		OUT	(0),A
  D71F  C7            		RST	0
                      	
  D720                	DIAN:
  D720  6F            		LD	L,A
  D721  C5            		PUSH	BC
  D722  01B01F        		LD	BC,01FB0H
  D725  ED78          		IN	A,(C)
  D727  EE80          		XOR	080H
  D729  ED79          		OUT	(C),A
  D72B  C1            		POP	BC
  D72C  18C4          		JR	SCEXE
                      	
  D72E                	INTCTC2:
  D72E  F5            		PUSH	AF
  D72F  3E00          	INTCPAT:LD	A,000H
  D731  3D            		DEC	A
  D732  3230D7        		LD	(INTCPAT+1),A
  D735  20CE          		JR	NZ,INTPE2
                      	
  D737  3A92EC        		LD	A,(_KEYD)
  D73A  B7            		OR	A
  D73B  28C8          		JR	Z,INTPE2
  D73D                	KEYSET0:
  D73D  E5            		PUSH	HL
  D73E  2A90EC        		LD	HL,(_KEYPS)
  D741  7C            		LD	A,H
  D742  AD            		XOR	L
  D743  2006          		JR	NZ,INTC2A
                      	
  D745  2A92EC        		LD	HL,(_KEYD)
  D748  CD7FD7        		CALL	KEYSET
  D74B                	INTC2A:
  D74B  3A94EC        		LD	A,(_KEYSP)
  D74E  E60F          		AND	00FH
  D750  3230D7        		LD	(INTCPAT+1),A
                      	
  D753  18AF          		JR	INTPE
                      	
  D755                	KEYSET1:
  D755  CB6C          		BIT	5,H
  D757  F5            		PUSH	AF
  D758  ED4B8CEC      		LD	BC,(_CTC)
  D75C  78            		LD	A,B
  D75D  B1            		OR	C
  D75E  2006          		JR	NZ,KEYS10E
                      	
  D760  F1            		POP	AF
  D761  201C          		JR	NZ,KEYSET
  D763  F5            		PUSH	AF
  D764  18D7          		JR	KEYSET0
  D766                	KEYS10E:
  D766  F1            		POP	AF
  D767  C8            		RET	Z
  D768  F5            		PUSH	AF
  D769  3E03          		LD	A,3		;CTC STOP
  D76B  ED79          		OUT	(C),A
  D76D  F1            		POP	AF
                      	
  D76E  B7            		OR	A
  D76F  C8            		RET	Z
                      	
  D770  E5            		PUSH	HL
  D771  2A94EC        		LD	HL,(_KEYSP)
  D774  3EA7          		LD	A,0A7H
  D776  ED79          		OUT	(C),A
  D778  ED69          		OUT	(C),L
  D77A  7C            		LD	A,H
  D77B  3230D7        		LD	(INTCPAT+1),A
  D77E  E1            		POP	HL
                      	
  D77F                	KEYSET:
  D77F  7D            		LD	A,L
  D780  CB7C          		BIT	7,H
  D782  CCAFD7        		CALL	Z,FKEY
  D785  CB74          		BIT	6,H
  D787  C0            		RET	NZ
  D788                	KEYBS:
  D788  B7            		OR	A
  D789  C8            		RET	Z
  D78A                	KEYBS1:
  D78A  FE03          		CP	3
  D78C  CCA2D7        		CALL	Z,KEYBC
  D78F  E5            		PUSH	HL
  D790  F5            		PUSH	AF
  D791  2A90EC        		LD	HL,(_KEYPS)
  D794  2C            		INC	L
  D795  7D            		LD	A,L
  D796  BC            		CP	H
  D797  2812          		JR	Z,KEYBE
  D799  3290EC        		LD	(_KEYPS),A
  D79C  26FE          		LD	H,KEYBF/256
  D79E  F1            		POP	AF
  D79F  77            		LD	(HL),A
  D7A0  E1            		POP	HL
  D7A1  C9            		RET
                      	
  D7A2                	KEYBC:
  D7A2  E5            		PUSH	HL
  D7A3  210000        		LD	HL,0
  D7A6  2290EC        		LD	(_KEYPS),HL
  D7A9  E1            		POP	HL
  D7AA  C9            		RET
                      	
  D7AB                	KEYBE:
  D7AB  F1            		POP	AF
  D7AC  E1            		POP	HL
  D7AD  37            		SCF
  D7AE  C9            		RET
                      	
  D7AF                	FKEY:
  D7AF  CB75          		BIT	6,L
  D7B1  C8            		RET	Z
  D7B2  3E1B          		LD	A,01BH
  D7B4  CD8AD7        		CALL	KEYBS1
  D7B7  7D            		LD	A,L
  D7B8  C6AF          		ADD	A,020H-'q'
  D7BA  CB7D          		BIT	7,L
  D7BC  C8            		RET	Z
  D7BD  2E50          		LD	L,'P'
  D7BF  D690          		SUB	0E1H+020H-'q'
  D7C1  2810          		JR	Z,KEYBSL
  D7C3  2C            		INC	L
  D7C4  3D            		DEC	A
  D7C5  280C          		JR	Z,KEYBSL
  D7C7  2C            		INC	L
  D7C8  D609          		SUB	0EBH-0E2H
  D7CA  2807          		JR	Z,KEYBSL
  D7CC  2E43          		LD	L,'C'
  D7CE  3D            		DEC	A
  D7CF  2802          		JR	Z,KEYBSL
  D7D1  2E58          		LD	L,'X'
  D7D3                	KEYBSL:
  D7D3  7D            		LD	A,L
  D7D4  18B4          		JR	KEYBS1
                      	
  D7D6                	_SYS01:		;(BDOS)コンソール入力
  D7D6  CDAFD3        		CALL	_SYS07
  D7D9                	MSG_:
  D7D9  F5            		PUSH	AF
  D7DA  D5            		PUSH	DE
  D7DB  5F            		LD	E,A
  D7DC  CDE2D7        		CALL	_SYS02
  D7DF  D1            		POP	DE
  D7E0  F1            		POP	AF
  D7E1  C9            		RET
                      	
  D7E2                	_SYS02:		;(BDOS)コンソール出力
  D7E2  CDF4D7        		CALL	BREAK
  D7E5  1805          		JR	PRINTX
                      	
  D7E7                	_SYS06:		;(BDOS)コンソール直接入出力
  D7E7  7B            		LD	A,E
  D7E8  3C            		INC	A
  D7E9  CACAEC        		JP	Z,_INKEY
  D7EC                	PRINTX:
  D7EC  C3CDEC        		JP	_PRINT
                      	
  D7EF                	_SYS08:		;(BDOS)エコーなしコンソール入力
  D7EF  CDAFD3        		CALL	_SYS07
  D7F2  1804          		JR	BREAK1
  D7F4                	BREAK:
  D7F4  FB            		EI
  D7F5  3A92EC        		LD	A,(_KEYD)
  D7F8                	BREAK1:
  D7F8  FE03          		CP	3
  D7FA  CA0000        		JP	Z,0
  D7FD  FE13          		CP	013H
  D7FF  C0            		RET	NZ
                      	
  D800                	PAUSE:
  D800  CDA2D7        		CALL	KEYBC
                      	
  D803                	FLGET:
  D803  CDDFEC        		CALL	_FFLUSH
  D806  C5            		PUSH	BC
  D807  E5            		PUSH	HL
  D808  ED4B8EEC      		LD	BC,(_TXADR)
  D80C  CBE8          		SET	5,B
  D80E  ED60          		IN	H,(C)
  D810                	FLGET1:
  D810  3A93EC        		LD	A,(_KEYD+1)
  D813  0F            		RRCA
  D814  0F            		RRCA
  D815  E610          		AND	010H
  D817  F608          		OR	8
  D819  ED68          		IN	L,(C)
  D81B  B5            		OR	L
  D81C  ED79          		OUT	(C),A
  D81E  CDCAEC        		CALL	_INKEY
  D821  28ED          		JR	Z,FLGET1
  D823  ED61          		OUT	(C),H
  D825  E1            		POP	HL
  D826  C1            		POP	BC
  D827  C9            		RET
                      	
  D828                	_SYS0A:		;(BDOS)文字列入力
  D828  C5            		PUSH	BC
  D829  E5            		PUSH	HL
  D82A  D5            		PUSH	DE
  D82B  CD4DDC        		CALL	GETL
  D82E  1100FF        		LD	DE,KBUF
  D831  E1            		POP	HL
  D832  E5            		PUSH	HL
  D833  0E00          		LD	C,0
  D835  3004          		JR	NC,SAX0
  D837  23            		INC	HL
  D838  23            		INC	HL
  D839  1808          		JR	SAX4
  D83B                	SAX0:
  D83B  46            		LD	B,(HL)
  D83C  23            		INC	HL
  D83D                	SAX1:
  D83D  23            		INC	HL
  D83E  1A            		LD	A,(DE)
  D83F  13            		INC	DE
  D840  B7            		OR	A
  D841  2004          		JR	NZ,SAX2
  D843                	SAX4:
  D843  360D          		LD	(HL),00DH
  D845  1804          		JR	SAX3
  D847                	SAX2:
  D847  77            		LD	(HL),A
  D848  0C            		INC	C
  D849  10F2          		DJNZ	SAX1
  D84B                	SAX3:
  D84B  D1            		POP	DE
  D84C  79            		LD	A,C
  D84D  13            		INC	DE
  D84E  12            		LD	(DE),A
  D84F  1B            		DEC	DE
  D850  E1            		POP	HL
  D851  C1            		POP	BC
  D852  A7            		AND	A
  D853  C9            		RET
                      	
  D854                	_SYS0B:		;(BDOS)コンソール状態のチェック
  D854  CDF4D7        		CALL	BREAK
  D857  3A92EC        		LD	A,(_KEYD)
  D85A  B7            		OR	A
  D85B  C8            		RET	Z
  D85C                	CONSTX:
  D85C  CDDFEC        		CALL	_FFLUSH
  D85F  E5            		PUSH	HL
  D860  2A90EC        		LD	HL,(_KEYPS)
  D863  7C            		LD	A,H
  D864  AD            		XOR	L
  D865  E1            		POP	HL
  D866  C6FF          		ADD	A,0FFH
  D868  9F            		SBC	A,A
  D869  C9            		RET
                      	
  D86A                	_SYS2A:		;(BDOS)日付の獲得
  D86A  C5            		PUSH	BC
  D86B  3EED          		LD	A,0EDH		;Read calendar
  D86D  CD0DDB        		CALL	COMOUT
  D870  CD93D8        		CALL	IN49SB_BCD	;YY
  D873  6F            		LD	L,A
  D874  2600          		LD	H,0
  D876  116C07        		LD	DE,1900		;0076CH
  D879  FE5A          		CP	90		;90以上は1900年代 1990-1999
  D87B  3002          		JR	NC,RDDATE1	;90未満は2000年代 2000-2089
  D87D  1ED0          		LD	E,0D0H		;2000 & 0FFH D=007H
  D87F                	RDDATE1:
  D87F  19            		ADD	HL,DE
  D880  CDF2DA        		CALL	IN49SB		;MM
  D883  57            		LD	D,A
  D884  CD93D8        		CALL	IN49SB_BCD	;DD
  D887  5F            		LD	E,A
  D888  7A            		LD	A,D
  D889  E607          		AND	7
  D88B  0604          		LD	B,4
  D88D                	RDDATE2:
  D88D  CB3A          		SRL	D
  D88F  10FC          		DJNZ	RDDATE2
  D891  C1            		POP	BC
  D892  C9            		RET
  D893                	IN49SB_BCD:
  D893  CDF2DA        		CALL	IN49SB
                      	;------------------------
                      	;BCDの10進数化
                      	;in
                      	;	A  : BCD
                      	;out
                      	;	A  : 10進数
                      	;------------------------
  D896  4F            		LD	C,A
  D897  E6F0          		AND	0F0H	;10の位
  D899  0F            		RRCA
  D89A  47            		LD	B,A
  D89B  0F            		RRCA
  D89C  0F            		RRCA
  D89D  80            		ADD	A,B
  D89E  47            		LD	B,A
  D89F  79            		LD	A,C
  D8A0  E60F          		AND	00FH	;1の位
  D8A2  80            		ADD	A,B
  D8A3  C9            		RET
                      	
  D8A4                	_SYS2C:		;(BDOS)時刻の獲得
  D8A4  C5            		PUSH	BC
  D8A5  3EEF          		LD	A,0EFH		;Read time
  D8A7  CD0DDB        		CALL	COMOUT
  D8AA  CD93D8        		CALL	IN49SB_BCD	;TT
  D8AD  67            		LD	H,A
  D8AE  CD93D8        		CALL	IN49SB_BCD	;MM
  D8B1  6F            		LD	L,A
  D8B2  CD93D8        		CALL	IN49SB_BCD	;SS
  D8B5  57            		LD	D,A
  D8B6  C1            		POP	BC
  D8B7  AF            		XOR	A
  D8B8  C9            		RET
                      	
  D8B9                	MSX1:
  D8B9  5F            		LD	E,A
  D8BA  CDCDEC        		CALL	_PRINT
  D8BD                	MSX:
  D8BD  7E            		LD	A,(HL)
  D8BE  23            		INC	HL
  D8BF  B7            		OR	A
  D8C0  20F7          		JR	NZ,MSX1
  D8C2  C9            		RET
                      	
  D8C3                	ESC1:
  D8C3  7B            		LD	A,E
  D8C4  FE41          		CP	'A'
  D8C6  CA00DA        		JP	Z,CTRL1E
  D8C9  FE42          		CP	'B'
  D8CB  CA78DB        		JP	Z,CTRL1F
  D8CE  FE43          		CP	'C'
  D8D0  CA0DDA        		JP	Z,CTRL1C
  D8D3  FE44          		CP	'D'
  D8D5  CAF6D9        		JP	Z,CTRL1D
  D8D8  FE45          		CP	'E'
  D8DA  2802          		JR	Z,CT0CX
  D8DC  FE6A          		CP	'j'
  D8DE                	CT0CX:
  D8DE  CA4BDB        		JP	Z,CTRL0C
  D8E1  FE48          		CP	'H'
  D8E3  CA8BDA        		JP	Z,CTRL0B
  D8E6  FE4A          		CP	'J'
  D8E8  CA4EDB        		JP	Z,CTRL1A
  D8EB  FE4B          		CP	'K'
  D8ED  CA4DDA        		JP	Z,CTRL05
  D8F0  FE4C          		CP	'L'
  D8F2  CA8DDB        		JP	Z,CTRL0E
  D8F5  FE78          		CP	'x'
  D8F7  2804          		JR	Z,ESC1X
  D8F9  FE79          		CP	'y'
  D8FB  2002          		JR	NZ,ESC1Y
  D8FD                	ESC1X:
  D8FD  3601          		LD	(HL),1
  D8FF                	ESC1Y:
  D8FF  FE3D          		CP	'='
  D901  2804          		JR	Z,ESC1W
  D903  FE59          		CP	'Y'
  D905  2002          		JR	NZ,ESC1Z
  D907                	ESC1W:
  D907  3602          		LD	(HL),2
  D909                	ESC1Z:
  D909  FE20          		CP	020H
  D90B  3802          		JR	C,ESC1C
  D90D  87            		ADD	A,A
  D90E  D0            		RET	NC
  D90F                	ESC1C:
  D90F  E1            		POP	HL
  D910  184A          		JR	ANK
                      	
  D912                	ESC:
  D912  216DD9        		LD	HL,PRINTE5
  D915  E5            		PUSH	HL
  D916  2138D9        		LD	HL,ESCFLG+1
  D919  3600          		LD	(HL),0
  D91B  3D            		DEC	A
  D91C  28A5          		JR	Z,ESC1
  D91E  3D            		DEC	A
  D91F  2009          		JR	NZ,ESC2
  D921  3603          		LD	(HL),3
  D923  7B            		LD	A,E
  D924  D620          		SUB	020H
  D926  322DD9        		LD	(ESCYP+1),A
  D929  C9            		RET
  D92A                	ESC2:
  D92A  3D            		DEC	A
  D92B  C0            		RET	NZ
  D92C  2600          	ESCYP:	LD	H,0
  D92E  7B            		LD	A,E
  D92F  D620          		SUB	020H
  D931  6F            		LD	L,A
  D932  C3D6EC        		JP	_LOC
                      	
  D935                	PRINT:
  D935  C5            		PUSH	BC
  D936  E5            		PUSH	HL
  D937  3E00          	ESCFLG:	LD	A,000H
  D939  B7            		OR	A
  D93A  20D6          		JR	NZ,ESC
                      	
  D93C  3E1F          		LD	A,01FH
  D93E  BB            		CP	E
  D93F  3030          		JR	NC,CTRL
  D941                	PRINTC:
  D941  A7            	INSFLG:	AND	A
  D942  DC16DB        		CALL	C,CTRL12
                      	
  D945  3E00          	KANFLG:	LD	A,000H
  D947  B7            		OR	A
  D948  203D          		JR	NZ,KANJI2
  D94A  7B            	X1KPAT:	LD	A,E
  D94B  FE80          		CP	080H
  D94D  380D          		JR	C,ANK
  D94F  FEA0          		CP	0A0H
  D951  3804          		JR	C,KANJI1
  D953  FEE0          		CP	0E0H
  D955  3805          		JR	C,ANK
  D957                	KANJI1:
  D957  3246D9        		LD	(KANFLG+1),A
  D95A  1811          		JR	PRINTE5
  D95C                	ANK:
  D95C  ED4B8EEC      		LD	BC,(_TXADR)
  D960  78            		LD	A,B
  D961  F638          		OR	038H
  D963  47            		LD	B,A
                      	;	OUT	(C),0		;未定義命令ニーモニック
  D964  ED71          		DB	0EDH,071H	;Kanji
  D966  CB98          		RES	3,B
  D968  ED59          		OUT	(C),E		;Text
  D96A                	KANJIE:
  D96A  CDD2D9        		CALL	PRINTE7
  D96D                	PRINTE5:
  D96D  E1            		POP	HL
  D96E  C1            		POP	BC
  D96F  AF            		XOR	A
  D970  C9            		RET
                      	
  D971                	CTRL:
  D971  CDB9D9        		CALL	KANCLR
  D974  3EA7          		LD	A,0A7H		;AND	A
  D976  3241D9        		LD	(INSFLG),A
  D979  7B            		LD	A,E
  D97A  87            		ADD	A,A
  D97B  6F            		LD	L,A
  D97C  26EB          		LD	H,CTRLTB/256
  D97E  7E            		LD	A,(HL)
  D97F  2C            		INC	L
  D980  66            		LD	H,(HL)
  D981  6F            		LD	L,A
  D982  CD0F00        		CALL	JP_HL
  D985  18E6          		JR	PRINTE5
                      	
  D987                	KANJI2:
  D987  D5            		PUSH	DE
  D988  57            		LD	D,A
  D989  01812F        		LD	BC,02F81H	;SFTJIS
  D98C  DF            		RST	018H
  D98D  01C32F        		LD	BC,02FC3H	;Instead or JISVRM
  D990  DF            		RST	018H
                      	
  D991  ED4B8EEC      		LD	BC,(_TXADR)
  D995  78            		LD	A,B
  D996  F638          		OR	038H
  D998  47            		LD	B,A
  D999  ED51          		OUT	(C),D		;kanji
  D99B  CB98          		RES	3,B
  D99D  ED59          		OUT	(C),E		;Text
  D99F  CDD2D9        		CALL	PRINTE7
  D9A2  ED4B8EEC      		LD	BC,(_TXADR)
  D9A6  78            		LD	A,B
  D9A7  F638          		OR	038H
  D9A9  47            		LD	B,A
  D9AA  CBF2          		SET	6,D
  D9AC  ED51          		OUT	(C),D		;Kanji
  D9AE  CB98          		RES	3,B
  D9B0  ED59          		OUT	(C),E		;Text
  D9B2  D1            		POP	DE
  D9B3  AF            		XOR	A
  D9B4  3246D9        		LD	(KANFLG+1),A
  D9B7  18B1          		JR	KANJIE
                      	
  D9B9                	KANCLR:
  D9B9  3A46D9        		LD	A,(KANFLG+1)
  D9BC  B7            		OR	A
  D9BD  C8            		RET	Z
  D9BE  ED4B8EEC      		LD	BC,(_TXADR)
  D9C2  78            		LD	A,B
  D9C3  F638          		OR	038H
  D9C5  47            		LD	B,A
  D9C6  AF            		XOR	A
  D9C7  3246D9        		LD	(KANFLG+1),A
  D9CA  ED79          		OUT	(C),A		;Kanji
  D9CC  CB98          		RES	3,B
  D9CE  3E20          		LD	A,020H
  D9D0  ED79          		OUT	(C),A		;Text
  D9D2                	PRINTE7:
  D9D2  CBA0          		RES	4,B
  D9D4                	PRINTE6:
  D9D4  3A96EC        		LD	A,(_COLORF)
  D9D7                	PRINTE4:
  D9D7  ED79          		OUT	(C),A		;Color
  D9D9  78            		LD	A,B
  D9DA  E607          		AND	7
  D9DC  47            		LD	B,A
  D9DD                	PRINTE2:
  D9DD  03            		INC	BC
  D9DE                	PRINTE3:
  D9DE  2ABAEC        		LD	HL,(CRTCD+10)
  D9E1  A7            		AND	A
  D9E2  ED4A          		ADC	HL,BC
  D9E4                	PRINTE8:
  D9E4  2805          		JR	Z,PRINT2
  D9E6                	PRINTE1:
  D9E6  ED438EEC      		LD	(_TXADR),BC
  D9EA                	PRINTE:
  D9EA  C9            		RET
                      	
  D9EB                	PRINT2:
  D9EB  CD93DB        		CALL	SCR
  D9EE  2ABCEC        		LD	HL,(CRTCD+12)
  D9F1  09            		ADD	HL,BC
  D9F2  228EEC        		LD	(_TXADR),HL
  D9F5  C9            		RET
                      	
  D9F6                	CTRL08:
  D9F6                	CTRL1D:
  D9F6  ED4B8EEC      		LD	BC,(_TXADR)
  D9FA  78            		LD	A,B
  D9FB  B1            		OR	C
  D9FC  C8            		RET	Z
  D9FD  0B            		DEC	BC
  D9FE  18E6          		JR	PRINTE1
                      	
  DA00                	CTRL1E:
  DA00  ED4B8EEC      		LD	BC,(_TXADR)
  DA04  2ABCEC        		LD	HL,(CRTCD+12)
  DA07  09            		ADD	HL,BC
  DA08  D0            		RET	NC
  DA09  44            		LD	B,H
  DA0A  4D            		LD	C,L
  DA0B  18D9          		JR	PRINTE1
                      	
  DA0D                	CTRL1C:
  DA0D  ED4B8EEC      		LD	BC,(_TXADR)
  DA11  18CA          		JR	PRINTE2
                      	
  DA13                	CTRL09:
  DA13  ED4B8EEC      		LD	BC,(_TXADR)
  DA17  79            		LD	A,C
  DA18  E6F8          		AND	0F8H
  DA1A  C608          		ADD	A,8
  DA1C  4F            		LD	C,A
  DA1D  88            		ADC	A,B
  DA1E  91            		SUB	C
  DA1F  47            		LD	B,A
  DA20  18BC          		JR	PRINTE3
                      	
  DA22                	CTRL02:
  DA22  2A8EEC        		LD	HL,(_TXADR)
  DA25  7C            		LD	A,H
  DA26  B5            		OR	L
  DA27  C8            		RET	Z
  DA28  2B            		DEC	HL
  DA29  228EEC        		LD	(_TXADR),HL
  DA2C  D5            		PUSH	DE
  DA2D  CDD3EC        		CALL	_POS
  DA30  3AB1EC        		LD	A,(CRTCD+1)
  DA33  95            		SUB	L
  DA34  6F            		LD	L,A
  DA35  2D            		DEC	L
  DA36  2638          		LD	H,038H
  DA38  ED4B8EEC      		LD	BC,(_TXADR)
  DA3C  09            		ADD	HL,BC
  DA3D  44            		LD	B,H
  DA3E  4D            		LD	C,L
  DA3F  110020        		LD	DE,02000H	;D:Text E:kanji
  DA42  2A96EC        		LD	HL,(_COLORF)	;L:Color
  DA45                	C8X1:
  DA45  CD32DB        		CALL	C12S
  DA48  0B            		DEC	BC
  DA49  20FA          		JR	NZ,C8X1
  DA4B  D1            		POP	DE
  DA4C  C9            		RET
                      	
  DA4D                	CTRL05:
  DA4D  CDD3EC        		CALL	_POS
  DA50  3AB1EC        		LD	A,(CRTCD+1)
  DA53  95            		SUB	L
  DA54  6F            		LD	L,A
  DA55  2620          		LD	H,020H
  DA57  ED4B8EEC      		LD	BC,(_TXADR)
  DA5B                	C05X1:
  DA5B  78            		LD	A,B
  DA5C  F638          		OR	038H
  DA5E  47            		LD	B,A
                      	;	OUT	(C),0		;未定義命令ニーモニック
  DA5F  ED71          		DB	0EDH,071H	;kanji
  DA61  CB98          		RES	3,B
  DA63  ED61          		OUT	(C),H		;Text
  DA65  CBA0          		RES	4,B
  DA67  3A96EC        		LD	A,(_COLORF)
  DA6A  ED79          		OUT	(C),A		;Color
  DA6C  03            		INC	BC
  DA6D  2D            		DEC	L
  DA6E  20EB          		JR	NZ,C05X1
  DA70  C9            		RET
                      	
  DA71                	CTRL0D:
  DA71  CDD3EC        		CALL	_POS
  DA74  2E00          		LD	L,0
  DA76                	LOC:
  DA76  C5            		PUSH	BC
  DA77  E5            		PUSH	HL
  DA78  CDB9D9        		CALL	KANCLR
  DA7B  CD9EDA        		CALL	LOC1
  DA7E  ED438EEC      		LD	(_TXADR),BC
  DA82  E1            		POP	HL
  DA83  C1            		POP	BC
  DA84  C9            		RET
                      	
  DA85                	CTRL01:
  DA85  3E37          		LD	A,037H		;SCF
  DA87  3241D9        		LD	(INSFLG),A
  DA8A  C9            		RET
                      	
  DA8B                	CTRL0B:
  DA8B  210000        		LD	HL,0
  DA8E  228EEC        		LD	(_TXADR),HL
  DA91  C9            		RET
                      	
  DA92                	PRINTS:
  DA92  CDF4D7        		CALL	BREAK
  DA95  C3CDEC        		JP	_PRINT
                      	
  DA98                	CTRL1B:
  DA98  3E01          		LD	A,1
  DA9A  3238D9        		LD	(ESCFLG+1),A
  DA9D  C9            		RET
                      	
  DA9E                	LOC1:
  DA9E  44            		LD	B,H
  DA9F  4D            		LD	C,L
  DAA0  04            		INC	B
  DAA1  05            		DEC	B
  DAA2  C8            		RET	Z
  DAA3  D5            		PUSH	DE
  DAA4  ED5BB1EC      		LD	DE,(CRTCD+1)
  DAA8  210000        		LD	HL,0
  DAAB  55            		LD	D,L
  DAAC                	LOC2:
  DAAC  19            		ADD	HL,DE
  DAAD  10FD          		DJNZ	LOC2
  DAAF  09            		ADD	HL,BC
  DAB0  D1            		POP	DE
  DAB1                	LOC3:
  DAB1  44            		LD	B,H
  DAB2  4D            		LD	C,L
  DAB3  C9            		RET
                      	
  DAB4                	CONOUT1:
  DAB4  CDC6DA        		CALL	CURSOR
  DAB7  59            		LD	E,C
  DAB8  CDCDEC        		CALL	_PRINT
  DABB  7B            		LD	A,E
  DABC  FE0A          		CP	00AH
  DABE  2006          		JR	NZ,CURSOR
  DAC0  CD71DA        		CALL	CTRL0D
  DAC3  CD4DDA        		CALL	CTRL05
  DAC6                	CURSOR:
  DAC6  C5            		PUSH	BC
  DAC7  ED4B8EEC      		LD	BC,(_TXADR)
  DACB  CBE8          		SET	5,B
  DACD  ED78          		IN	A,(C)
  DACF  EE18          		XOR	018H
  DAD1  ED79          		OUT	(C),A
  DAD3  C1            		POP	BC
  DAD4  C9            		RET
                      	
  DAD5                	CTRL07:
  DAD5  21E4EB        		LD	HL,BEEPD
  DAD8                	BEEP1:
  DAD8  7E            		LD	A,(HL)
  DAD9  23            		INC	HL
  DADA  FEFF          		CP	0FFH
  DADC  C8            		RET	Z
  DADD  F3            		DI
  DADE  061C          		LD	B,01CH
  DAE0  ED79          		OUT	(C),A
  DAE2  EDA3          		OUTI
  DAE4  FB            		EI
  DAE5  18F1          		JR	BEEP1
                      	
  DAE7                	OT49SB:
  DAE7  C5            		PUSH	BC
  DAE8  CD03DB        		CALL	CANW
  DAEB  010019        		LD	BC,01900H
  DAEE  ED79          		OUT	(C),A
  DAF0  C1            		POP	BC
  DAF1  C9            		RET
                      	
  DAF2                	IN49SB:
  DAF2  C5            		PUSH	BC
  DAF3  01011A        		LD	BC,01A01H
  DAF6                	CANR:
  DAF6  ED78          		IN	A,(C)
  DAF8  E620          		AND	020H
  DAFA  20FA          		JR	NZ,CANR
  DAFC  010019        		LD	BC,01900H
  DAFF  ED78          		IN	A,(C)
  DB01  C1            		POP	BC
  DB02  C9            		RET
                      	
  DB03                	CANW:
  DB03  01011A        		LD	BC,01A01H
  DB06  ED48          		IN	C,(C)
  DB08  CB71          		BIT	6,C
  DB0A  20F7          		JR	NZ,CANW
  DB0C  C9            		RET
                      	
  DB0D                	COMOUT:
  DB0D  FB            		EI
  DB0E  CDE7DA        		CALL	OT49SB
  DB11  CD03DB        		CALL	CANW
  DB14  F3            		DI
  DB15  C9            		RET
                      	
  DB16                	CTRL12:
  DB16  D5            		PUSH	DE
  DB17  CDD3EC        		CALL	_POS
  DB1A  3AB1EC        		LD	A,(CRTCD+1)
  DB1D  95            		SUB	L
  DB1E  ED4B8EEC      		LD	BC,(_TXADR)
  DB22  110020        		LD	DE,02000H	;D:Text E:Kanji
  DB25  2A96EC        		LD	HL,(_COLORF)	;L:Color
  DB28  CBE8          		SET	5,B
  DB2A                	C12X1:
  DB2A  CD32DB        		CALL	C12S
  DB2D  03            		INC	BC
  DB2E  20FA          		JR	NZ,C12X1
  DB30  D1            		POP	DE
  DB31  C9            		RET
                      	
  DB32                	C12S:
  DB32  CBE0          		SET	4,B
  DB34  CBD8          		SET	3,B
  DB36  ED60          		IN	H,(C)
  DB38  ED59          	X1PAT:	OUT	(C),E
  DB3A  5C            		LD	E,H
  DB3B  CB98          		RES	3,B
  DB3D  ED60          		IN	H,(C)
  DB3F  ED51          		OUT	(C),D
  DB41  54            		LD	D,H
  DB42  CBA0          		RES	4,B
  DB44  ED60          		IN	H,(C)
  DB46  ED69          		OUT	(C),L
  DB48  6C            		LD	L,H
  DB49  3D            		DEC	A
  DB4A  C9            		RET
                      	
  DB4B                	CTRL0C:
  DB4B  CD8BDA        		CALL	CTRL0B
  DB4E                	CTRL1A:
  DB4E  ED4B8EEC      		LD	BC,(_TXADR)
  DB52                	C1AX1:
  DB52  78            		LD	A,B
  DB53  F638          		OR	038H
  DB55  47            		LD	B,A
                      	;	OUT	(C),0		;未定義命令ニーモニック
  DB56  ED71          		DB	0EDH,071H	;kanji
  DB58  CB98          		RES	3,B
  DB5A  3E20          		LD	A,020H
  DB5C  ED79          		OUT	(C),A		;Text
  DB5E  CBA0          		RES	4,B
  DB60  3A96EC        		LD	A,(_COLORF)
  DB63  ED79          		OUT	(C),A		;Color
  DB65  03            		INC	BC
  DB66  CBA8          		RES	5,B
  DB68  2ABAEC        		LD	HL,(CRTCD+10)
  DB6B  09            		ADD	HL,BC
  DB6C  30E4          		JR	NC,C1AX1
  DB6E  C9            		RET
                      	
  DB6F                	CTRL04:
  DB6F  CDD3EC        		CALL	_POS
  DB72  7D            		LD	A,L
  DB73  B7            		OR	A
  DB74  C8            		RET	Z
  DB75                	CTRL03:
  DB75  CD71DA        		CALL	CTRL0D
  DB78                	CTRL0A:
  DB78                	CTRL1F:
  DB78  ED4B8EEC      		LD	BC,(_TXADR)
  DB7C  2AB1EC        		LD	HL,(CRTCD+1)
  DB7F  2600          		LD	H,0
  DB81  09            		ADD	HL,BC
  DB82  44            		LD	B,H
  DB83  4D            		LD	C,L
  DB84  2ABAEC        		LD	HL,(CRTCD+10)
  DB87  09            		ADD	HL,BC
  DB88  3F            		CCF
  DB89  9F            		SBC	A,A
  DB8A  C3E4D9        		JP	PRINTE8
                      	
  DB8D                	CTRL0E:
  DB8D  CDD3EC        		CALL	_POS
  DB90  7C            		LD	A,H
  DB91  1804          		JR	SCR1
  DB93                	SCR:
  DB93  3A97EC        		LD	A,(_LINE)
  DB96  3D            		DEC	A
  DB97                	SCR1:
  DB97  C5            		PUSH	BC
  DB98  D5            		PUSH	DE
  DB99  01801F        		LD	BC,01F80H	;DMA
  DB9C  1EC3          		LD	E,0C3H
  DB9E  ED59          		OUT	(C),E
  DBA0  119A65        		LD	DE,0659AH
  DBA3  ED59          		OUT	(C),E
  DBA5  ED51          		OUT	(C),D
  DBA7  114F00        		LD	DE,79
  DBAA  ED59          		OUT	(C),E
  DBAC  ED51          		OUT	(C),D
                      	
  DBAE  210038        		LD	HL,03800H
  DBB1  11181C        		LD	DE,01C18H
  DBB4  ED51          		OUT	(C),D
  DBB6  ED59          		OUT	(C),E
                      	
  DBB8                	SCRUP1:
  DBB8  B7            		OR	A
  DBB9  2839          		JR	Z,SCRCL
  DBBB  F5            		PUSH	AF
  DBBC  CDD5DB        		CALL	UPSUB		;kanji
  DBBF  ED5BBCEC      		LD	DE,(CRTCD+12)
  DBC3  16F7          		LD	D,0F7H
  DBC5  19            		ADD	HL,DE
  DBC6  D5            		PUSH	DE
  DBC7  CDD5DB        		CALL	UPSUB		;Text
  DBCA  D1            		POP	DE
  DBCB  19            		ADD	HL,DE
  DBCC  CDD5DB        		CALL	UPSUB		;Color
  DBCF  CBE4          		SET	4,H
  DBD1  F1            		POP	AF
  DBD2  3D            		DEC	A
  DBD3  18E3          		JR	SCRUP1
                      	
  DBD5                	UPSUB:
  DBD5  ED5BB1EC      		LD	DE,(CRTCD+1)
  DBD9  1600          		LD	D,0
  DBDB  3ECD          		LD	A,0CDH
  DBDD  ED79          		OUT	(C),A
  DBDF  ED69          		OUT	(C),L		;SOURCE
  DBE1  ED61          		OUT	(C),H
  DBE3  19            		ADD	HL,DE
  DBE4  3E1D          		LD	A,01DH
  DBE6  ED79          		OUT	(C),A		;DEST
  DBE8  ED69          		OUT	(C),L
  DBEA  ED61          		OUT	(C),H
  DBEC  1187CF        		LD	DE,0CF87H
  DBEF  ED51          		OUT	(C),D
  DBF1  ED59          		OUT	(C),E
  DBF3  C9            		RET
                      	
  DBF4                	SCRCL:
  DBF4  44            		LD	B,H
  DBF5  4D            		LD	C,L
  DBF6  215020        		LD	HL,02000H+80
  DBF9  3A96EC        		LD	A,(_COLORF)
  DBFC                	SCRCL1:
                      	;	OUT	(C),0		;未定義命令ニーモニック
  DBFC  ED71          		DB	0EDH,071H
  DBFE  CB98          		RES	3,B
  DC00  ED61          		OUT	(C),H
  DC02  CBA0          		RES	4,B
  DC04  ED79          		OUT	(C),A
  DC06  CBD8          		SET	3,B
  DC08  CBE0          		SET	4,B
  DC0A  03            		INC	BC
  DC0B  2D            		DEC	L
  DC0C  20EE          		JR	NZ,SCRCL1
  DC0E  D1            		POP	DE
  DC0F  C1            		POP	BC
  DC10  C9            		RET
                      	
  DC11                	SCRN:
  DC11  D5            		PUSH	DE
  DC12  ED58          		IN	E,(C)		;Text
  DC14  CBD8          		SET	3,B
  DC16  ED50          		IN	D,(C)		;Kanji
  DC18  2819          		JR	Z,SCRNE
  DC1A  AF            		XOR	A
  DC1B  C5            		PUSH	BC
  DC1C  013730        		LD	BC,03037H	;VRMJIS
  DC1F  DF            		RST	018H
  DC20  01522F        		LD	BC,02F52H	;JISSFT
  DC23  DF            		RST	018H
  DC24  C1            		POP	BC
  DC25  ED78          		IN	A,(C)
  DC27  CB98          		RES	3,B
  DC29  E640          		AND	040H
  DC2B  2003          		JR	NZ,SCRN1
  DC2D  7A            		LD	A,D
  DC2E  D1            		POP	DE
  DC2F  C9            		RET
  DC30                	SCRN1:
  DC30  7B            		LD	A,E
  DC31  D1            		POP	DE
  DC32  C9            		RET
                      	
  DC33                	SCRNE:
  DC33  D1            		POP	DE
  DC34  CB98          		RES	3,B
  DC36                	SCRNX:
  DC36  ED78          		IN	A,(C)
  DC38  C9            		RET
                      	
  DC39                	POS:
  DC39  2A8EEC        		LD	HL,(_TXADR)
  DC3C  C5            		PUSH	BC
  DC3D  ED4BBCEC      		LD	BC,(CRTCD+12)
  DC41  AF            		XOR	A
  DC42                	POS1:
  DC42  09            		ADD	HL,BC
  DC43  3C            		INC	A
  DC44  38FC          		JR	C,POS1
  DC46  ED42          		SBC	HL,BC
  DC48  3D            		DEC	A
  DC49  67            		LD	H,A
  DC4A  C1            		POP	BC
  DC4B  A7            		AND	A
  DC4C  C9            		RET
                      	
  DC4D                	GETL:
  DC4D  CDD3EC        		CALL	_POS
  DC50  E5            		PUSH	HL
  DC51                	GETL1:
  DC51  CDD3EC        		CALL	_POS
  DC54  C1            		POP	BC
  DC55  C5            		PUSH	BC
  DC56  7D            		LD	A,L
  DC57  91            		SUB	C
  DC58  69            		LD	L,C
  DC59  4F            		LD	C,A
  DC5A  DCD6EC        		CALL	C,_LOC
  DC5D                	GET1W:
  DC5D  CDEFD7        		CALL	_SYS08
  DC60  FE08          		CP	8
  DC62  2007          		JR	NZ,GETL1X
  DC64  0D            		DEC	C
  DC65  CB79          		BIT	7,C
  DC67  2002          		JR	NZ,GETL1X
  DC69  3E02          		LD	A,2
  DC6B                	GETL1X:
  DC6B  FE1B          		CP	01BH
  DC6D  2016          		JR	NZ,GETL1V
  DC6F  CDEFD7        		CALL	_SYS08
  DC72  FE22          		CP	022H
  DC74  2008          		JR	NZ,GETL1Y
  DC76  2100FF        		LD	HL,KBUF
  DC79  CDBDD8        		CALL	MSX
  DC7C  180E          		JR	GETL1Z
  DC7E                	GETL1Y:
  DC7E  F5            		PUSH	AF
  DC7F  1E1B          		LD	E,01BH
  DC81  CDCDEC        		CALL	_PRINT
  DC84  F1            		POP	AF
  DC85                	GETL1V:
  DC85  5F            		LD	E,A
  DC86  CD85DA        		CALL	CTRL01
  DC89  CDCDEC        		CALL	_PRINT
  DC8C                	GETL1Z:
  DC8C  7B            		LD	A,E
  DC8D  FE0D          		CP	00DH
  DC8F  20C0          		JR	NZ,GETL1
                      	
  DC91  2100FF        		LD	HL,KBUF
  DC94  AF            		XOR	A
  DC95  ED4BB0EC      		LD	BC,(CRTCD)
  DC99                	GETL0:
  DC99  77            		LD	(HL),A
  DC9A  23            		INC	HL
  DC9B  10FC          		DJNZ	GETL0
                      	
  DC9D  D1            		POP	DE
  DC9E  CDD3EC        		CALL	_POS
  DCA1  6B            		LD	L,E
  DCA2  3AB1EC        		LD	A,(CRTCD+1)
  DCA5  95            		SUB	L
  DCA6  57            		LD	D,A
  DCA7  CD9EDA        		CALL	LOC1
  DCAA  78            		LD	A,B
  DCAB  F630          		OR	030H
  DCAD  47            		LD	B,A
  DCAE  5A            		LD	E,D
  DCAF  2100FF        		LD	HL,KBUF
  DCB2                	GETL2:
  DCB2  CDD0EC        		CALL	_SCRN
  DCB5  03            		INC	BC
  DCB6  77            		LD	(HL),A
  DCB7  23            		INC	HL
  DCB8  1D            		DEC	E
  DCB9  20F7          		JR	NZ,GETL2
  DCBB                	GETL3:
  DCBB  2B            		DEC	HL
  DCBC  7E            		LD	A,(HL)
  DCBD  FE21          		CP	021H
  DCBF  D0            		RET	NC
  DCC0  3600          		LD	(HL),0
  DCC2  15            		DEC	D
  DCC3  20F6          		JR	NZ,GETL3
  DCC5  C9            		RET
                      	
  DCC6                	INKEY:
  DCC6  FB            		EI
  DCC7  E5            		PUSH	HL
  DCC8  2A90EC        		LD	HL,(_KEYPS)
  DCCB  7C            		LD	A,H
  DCCC  AD            		XOR	L
  DCCD  2809          		JR	Z,INKEY1
  DCCF  7C            		LD	A,H
  DCD0  3C            		INC	A
  DCD1  3291EC        		LD	(_KEYPS+1),A
  DCD4  6F            		LD	L,A
  DCD5  26FE          		LD	H,KEYBF/256
  DCD7  7E            		LD	A,(HL)
  DCD8                	INKEY1:
  DCD8  E1            		POP	HL
  DCD9  B7            		OR	A
  DCDA  C9            		RET
                      	
  1176                	AT_RS	EQU	SCR1-AT_SCR1
                      	
                      	;LDFILE.ASM
                      	
                      	;	LSX-Dodgers FILE
                      	
  DCDB                	FILEC:
  DCDB  CDE6DC        		CALL	FILE
  DCDE                	FILEC2:
  DCDE  3ADC00        		LD	A,(FDRV+1)
  DCE1  FE20          		CP	020H
  DCE3  C8            		RET	Z
  DCE4  183B          		JR	SETDIR1
                      	
  DCE6                	FILE:
  DCE6  AF            		XOR	A
  DCE7  32DB00        		LD	(FDRV),A
  DCEA  67            		LD	H,A
  DCEB  6F            		LD	L,A
  DCEC  22E900        		LD	(FDRV+14),HL
  DCEF  CDC0DD        		CALL	SPCUT
  DCF2  CDA5DD        		CALL	CCHK3
  DCF5  2812          		JR	Z,DEVI1
  DCF7  13            		INC	DE
  DCF8  1A            		LD	A,(DE)
  DCF9  1B            		DEC	DE
  DCFA  FE3A          		CP	':'
  DCFC  200B          		JR	NZ,DEVI1
  DCFE  1A            		LD	A,(DE)		;DRIVE
  DCFF  CDE2DF        		CALL	CAP
  DD02  D640          		SUB	'@'
  DD04  13            		INC	DE
  DD05  13            		INC	DE
  DD06  32DB00        		LD	(FDRV),A
  DD09                	DEVI1:
  DD09  1A            		LD	A,(DE)
  DD0A  D65C          		SUB	05CH
  DD0C  200B          		JR	NZ,NOROOT
  DD0E  210000        		LD	HL,0
  DD11  22F500        		LD	(FDRV+26),HL
  DD14  2C            		INC	L
  DD15  22E900        		LD	(FDRV+14),HL
  DD18  13            		INC	DE
  DD19                	NOROOT:
                      	
  DD19                	SETDIR:
  DD19  CD45DD        		CALL	FILED
  DD1C  1A            		LD	A,(DE)
  DD1D  FE5C          		CP	05CH
  DD1F  C0            		RET	NZ
  DD20  13            		INC	DE
  DD21                	SETDIR1:
  DD21  3E10          		LD	A,010H		;Directory
  DD23  32E800        		LD	(FDRV+13),A
  DD26  D5            		PUSH	DE
  DD27  11DB00        		LD	DE,FDRV
  DD2A  2A1EEC        		LD	HL,(STABLE+2*00FH)
  DD2D  CD0F00        		CALL	JP_HL
  DD30  D1            		POP	DE
  DD31  B7            		OR	A
  DD32  C0            		RET	NZ
                      	
  DD33  3AE800        		LD	A,(FDRV+13)
  DD36  CB67          		BIT	4,A
  DD38  C8            		RET	Z
                      	
  DD39  CD8CDD        		CALL	FILEI
  DD3C  2AF500        		LD	HL,(FDRV+26)
  DD3F  23            		INC	HL
  DD40  22E900        		LD	(FDRV+14),HL
  DD43  18D4          		JR	SETDIR
                      	
  DD45                	FILED:
  DD45  CD8CDD        		CALL	FILEI
                      	
  DD48  0608          		LD	B,8
  DD4A                	FILE2:
  DD4A  CD9ADD        		CALL	CCHKF
  DD4D  C8            		RET	Z
  DD4E  FE2A          		CP	'*'
  DD50  282E          		JR	Z,FILE9
  DD52  FE2E          		CP	'.'
  DD54  280C          		JR	Z,FILE4
  DD56  77            		LD	(HL),A
  DD57  23            		INC	HL
  DD58  10F0          		DJNZ	FILE2
                      	
  DD5A                	FILE3:
  DD5A  CD9ADD        		CALL	CCHKF
  DD5D  C8            		RET	Z
  DD5E  FE2E          		CP	'.'
  DD60  20F8          		JR	NZ,FILE3
                      	
  DD62                	FILE4:
  DD62  21E400        		LD	HL,FNAME+8
  DD65  0603          		LD	B,3
                      	
  DD67                	FILE4L:
  DD67  CD9ADD        		CALL	CCHKF
  DD6A  C8            		RET	Z
  DD6B  FE2E          		CP	'.'
  DD6D  2008          		JR	NZ,FILE12
  DD6F  32DC00        		LD	(FNAME),A	;Parent directory(..)
  DD72  32DD00        		LD	(FNAME+1),A
  DD75  3E20          		LD	A,020H
  DD77                	FILE12:
  DD77  FE2A          		CP	'*'
  DD79  280A          		JR	Z,FILE10
  DD7B  77            		LD	(HL),A
  DD7C  23            		INC	HL
  DD7D  10E8          		DJNZ	FILE4L
  DD7F  C9            		RET
                      	
  DD80                	FILE9:
  DD80  CD85DD        		CALL	FILE10
  DD83  18D5          		JR	FILE3
                      	
  DD85                	FILE10:
  DD85  3E3F          		LD	A,'?'
                      	
  DD87                	FILE7:
  DD87  77            		LD	(HL),A
  DD88  23            		INC	HL
  DD89  10FC          		DJNZ	FILE7
  DD8B  C9            		RET
                      	
  DD8C                	FILEI:
  DD8C  3E20          		LD	A,020H
  DD8E  01000B        		LD	BC,11*256
  DD91  21DC00        		LD	HL,FNAME
  DD94  E5            		PUSH	HL
  DD95  CD87DD        		CALL	FILE7
  DD98  E1            		POP	HL
  DD99  C9            		RET
                      	
  DD9A                	CCHKF:
  DD9A  1A            		LD	A,(DE)
  DD9B  CDA2DD        		CALL	CCHK2
  DD9E  C8            		RET	Z
  DD9F  C3F4E0        		JP	FKAN
                      	
  DDA2                	CCHK2:
  DDA2  0C            		INC	C
  DDA3  0D            		DEC	C
  DDA4  C0            		RET	NZ
  DDA5                	CCHK3:
  DDA5  FE2B          		CP	'+'
  DDA7  C8            		RET	Z
  DDA8  FE2C          		CP	','
  DDAA  C8            		RET	Z
  DDAB  FE2F          		CP	'/'
  DDAD  C8            		RET	Z
  DDAE  FE3A          		CP	':'
  DDB0  C8            		RET	Z
  DDB1  FE3B          		CP	';'
  DDB3  C8            		RET	Z
  DDB4  FE3D          		CP	'='
  DDB6  C8            		RET	Z
  DDB7  FE5C          		CP	05CH
  DDB9  C8            		RET	Z
  DDBA  FE20          		CP	020H
  DDBC  D0            		RET	NC
  DDBD  BF            		CP	A		;Z=1
  DDBE  C9            		RET
                      	
  DDBF                	SS1:
  DDBF  13            		INC	DE
  DDC0                	SPCUT:
  DDC0  1A            		LD	A,(DE)
  DDC1  FE20          		CP	020H
  DDC3  28FA          		JR	Z,SS1
  DDC5  C9            		RET
                      	
  DDC6                	SETDRVF:
  DDC6  11DB00        		LD	DE,FDRV
  DDC9                	SETDRV0:
  DDC9  CDD2DD        		CALL	SETDRV
  DDCC  FDE1          		POP	IY
  DDCE  C1            		POP	BC
  DDCF  D1            		POP	DE
  DDD0  E1            		POP	HL
  DDD1  C9            		RET
                      	
  DDD2                	SETDRV:
  DDD2  E3            		EX	(SP),HL		;HL=RETRN ADDRESS
  DDD3  D5            		PUSH	DE		;PUSH HL/DE/BC/IY
  DDD4  C5            		PUSH	BC
  DDD5  1A            		LD	A,(DE)
  DDD6  D5            		PUSH	DE
  DDD7  FDE3          		EX	(SP),IY
                      	
  DDD9  CDE5DD        		CALL	GETDRV
  DDDC  3C            		INC	A
  DDDD  FD7700        		LD	(IY+0),A	;(FCB)ドライブ番号
  DDE0  3D            		DEC	A
  DDE1  CDD9EC        		CALL	_CHGDRV
                      	
  DDE4  E9            		JP	(HL)
                      	
  DDE5                	GETDRV:
  DDE5  E67F          		AND	07FH
  DDE7  D601          		SUB	001H
  DDE9  3003          		JR	NC,GETDRV1
  DDEB  3A87EC        		LD	A,(_DVSW)	;Current Drive
  DDEE                	GETDRV1:
  DDEE  3288EC        		LD	(_DRV),A
  DDF1  C9            		RET
                      	
  DDF2                	SOPENX:
  DDF2  CD68DF        		CALL	CHKDDX
  DDF5  3802          		JR	C,SOPENX1
  DDF7  C1            		POP	BC
  DDF8  E9            		JP	(HL)
  DDF9                	SOPENX1:
  DDF9  11ABE2        		LD	DE,SFILE
  DDFC  1A            		LD	A,(DE)
  DDFD  FDBE00        		CP	(IY+0)		;(FCB)ドライブ番号
  DE00  2024          		JR	NZ,SOPEN
  DE02  13            		INC	DE
  DE03  FDE5          		PUSH	IY
  DE05  E1            		POP	HL
  DE06  23            		INC	HL
  DE07  CD98DF        		CALL	CPFILE
  DE0A  201A          		JR	NZ,SOPEN
                      	
  DE0C  2AF4EB        		LD	HL,(SCDIR)
  DE0F  FD750E        		LD	(IY+14),L	;(FCB)アクセスするディレクトリのクラスタ番号+1
  DE12  FD740F        		LD	(IY+15),H
                      	
  DE15  2AF8EB        		LD	HL,(SFNDF)	;Direcroty location and Flags
  DE18  229FEC        		LD	(_FILEN),HL
                      	
  DE1B  ED5BF6EB      		LD	DE,(SFBPS)
  DE1F  21ABE2        		LD	HL,SFILE
  DE22  36FF          		LD	(HL),0FFH
  DE24  23            		INC	HL
  DE25  C9            		RET
  DE26                	SOPEN:
  DE26  2130DF        		LD	HL,FILESE
  DE29                	SOPENC:
  DE29  2266DE        		LD	(OPENPAT+1),HL
                      	
  DE2C  CDE2EC        		CALL	_RDFATX		;Detect Media
  DE2F  3856          		JR	C,RDDERR
                      	
  DE31  AF            		XOR	A
  DE32  329FEC        		LD	(_FILEN),A
  DE35                	SOPEN0:
  DE35  CD1EE0        		CALL	LDDIRX
  DE38  281C          		JR	Z,SDIRX1
                      	
  DE3A  CDCFE6        		CALL	MULSPC
  DE3D  CD21DF        		CALL	DC		;Sub Directory
  DE40  3808          		JR	C,SDIRX0
  DE42  2A7EEC        		LD	HL,(_DTBUF)
  DE45  7E            		LD	A,(HL)
  DE46  FE2E          		CP	'.'
  DE48  2810          		JR	Z,SOPEN1
  DE4A                	SDIRX0:
  DE4A  AF            		XOR	A
  DE4B  32A0EC        		LD	(_DIRF),A
  DE4E  FD360E01      		LD	(IY+14),1	;(FCB)レコード・サイズ
  DE52  FD360F00      		LD	(IY+15),0
  DE56                	SDIRX1:
  DE56  ED5BFCEB      		LD	DE,(_DIRPS)	;Root Directory
                      	
  DE5A                	SOPEN1:
  DE5A  0E20          	SDECPAT:LD	C,32		;自己書き換え 1セクタ辺りのディレクトリエントリ数  1024=32 / 512=16
  DE5C                	SOPEN1X:
  DE5C  CD21DF        		CALL	DC		;FILE SEARCH
  DE5F  3826          		JR	C,RDDERR
  DE61  2A7EEC        		LD	HL,(_DTBUF)
  DE64                	SOPEN2:
  DE64  D5            		PUSH	DE
  DE65  CD30DF        	OPENPAT:CALL	FILESE		;(Self-rewriting)
  DE68  D1            		POP	DE
  DE69  3864          		JR	C,SOPENE
  DE6B  2817          		JR	Z,NOTSE
  DE6D                	SOPEN3:
  DE6D  3AA0EC        		LD	A,(_DIRF)
  DE70  B7            		OR	A
  DE71  2008          		JR	NZ,SOPEN5
  DE73  1C            		INC	E		;ルートディレクトリ
  DE74  7B            		LD	A,E
  DE75  D60C          	RTEPAT:	SUB	12		;(Self-rewriting)DPB_0B_MAXDIR
  DE77  20E1          		JR	NZ,SOPEN1
  DE79  1807          		JR	SOPEN6
  DE7B                	SOPEN5:
  DE7B  CDC1E6        		CALL	GNCLX	;END DIR
  DE7E  D8            		RET	C
  DE7F  CDD9DF        		CALL	ENDCLX
  DE82                	SOPEN6:
  DE82  38D6          		JR	C,SOPEN1
                      	
  DE84                	_SYS2B:		;(BDOS)日付の設定
  DE84                	_SYS2D:		;(BDOS)時刻の設定
  DE84                	NOTSE:
  DE84  37            		SCF			;CF=1
  DE85  9F            		SBC	A,A		;A=0FFH
  DE86  C9            		RET
                      	
  DE87                	RDDERR:
  DE87  BF            		CP	A		;READ ERR CF=1 ZF=1
  DE88  37            		SCF
  DE89  C9            		RET
                      	
  DE8A                	NOPEN:
  DE8A  2130DF        		LD	HL,FILESE
  DE8D  2266DE        		LD	(OPENPAT+1),HL
  DE90  FD2A98EC      		LD	IY,(_FCB)
  DE94  CD07E1        		CALL	CHKWILDX
  DE97  30EB          		JR	NC,NOTSE
  DE99  FD7E00        		LD	A,(IY+0)	;(FCB)ドライブ番号
  DE9C  3D            		DEC	A
  DE9D  3288EC        		LD	(_DRV),A
  DEA0  CDD9EC        		CALL	_CHGDRV
  DEA3  D8            		RET	C
                      	
  DEA4  CD1EE0        		CALL	LDDIRX
  DEA7  ED5B9AEC      		LD	DE,(_FBPS)
  DEAB  CD21DF        		CALL	DC
  DEAE  38D7          		JR	C,RDDERR
  DEB0  3A9EEC        		LD	A,(_FBCNT)
  DEB3  3D            		DEC	A
  DEB4  28B7          		JR	Z,SOPEN3
  DEB6                	NOPEN2:
  DEB6  2A9CEC        		LD	HL,(_FBAD)
  DEB9  012000        		LD	BC,020H
  DEBC  09            		ADD	HL,BC
  DEBD  4F            		LD	C,A
  DEBE  18A4          		JR	SOPEN2
                      	
  DEC0                	SOPENE2:
  DEC0  229CEC        		LD	(_FBAD),HL
  DEC3  79            		LD	A,C
  DEC4  329EEC        		LD	(_FBCNT),A
  DEC7  ED539AEC      		LD	(_FBPS),DE
  DECB  FD2298EC      		LD	(_FCB),IY
  DECF                	SOPENE:
  DECF  AF            		XOR	A
  DED0  C9            		RET
                      	
  DED1                	COPEN:
  DED1  FD360D20      		LD	(IY+13),020H	;(FCB)属性(アトリビュート)
                      	
  DED5  214DDF        		LD	HL,NEXTSE
  DED8  CD29DE        		CALL	SOPENC
  DEDB  D0            		RET	NC
  DEDC  C8            		RET	Z
  DEDD  3AA0EC        		LD	A,(_DIRF)
  DEE0  D601          		SUB	001H
  DEE2  D8            		RET	C
  DEE3  0601          		LD	B,1
  DEE5  CD63E1        		CALL	WRDF
  DEE8  D8            		RET	C
  DEE9  ED5BFEEB      		LD	DE,(_CLPS)
  DEED  D5            		PUSH	DE
  DEEE  CDC1DF        		CALL	DCPAT
  DEF1  CDA4E5        		CALL	DRDNX
  DEF4  2A7EEC        		LD	HL,(_DTBUF)	;ディレクトリエントリを0クリア
  DEF7  5D            		LD	E,L
  DEF8  54            		LD	D,H
  DEF9  13            		INC	DE		;DE,DTBUF+1
  DEFA  01FF03        	SECSZM1:LD	BC,003FFH	;自己書き換え セクタサイズ-1(0x3FF:1023 or 0x1FF:511 or 0xFF:255)
  DEFD  AF            		XOR	A		;データバッファをセクタサイズ分ゼロクリア
  DEFE  77            		LD	(HL),A
  DEFF  EDB0          		LDIR
                      	
  DF01  3AA0EC        		LD	A,(_DIRF)
  DF04  B7            		OR	A
  DF05  2815          		JR	Z,COPENE	;ルートディレクトリ
                      	
  DF07  D1            		POP	DE		;DE=(_CLPS)
  DF08  D5            		PUSH	DE
  DF09  3AD2E6        		LD	A,(SPCPAT+1)	;1クラスタの論理セクタ数
  DF0C                	COPEN1:
  DF0C  3D            		DEC	A
  DF0D  280D          		JR	Z,COPENE	;1セクタ辺りのセクタ数が2以上の場合
  DF0F  F5            		PUSH	AF		;データバッファに入らないセクタもゼロクリア
  DF10  13            		INC	DE
  DF11  D5            		PUSH	DE
  DF12  CDC1DF        		CALL	DCPAT
  DF15  CD20E8        		CALL	DWT_DPB
  DF18  D1            		POP	DE
  DF19  F1            		POP	AF
  DF1A  18F0          		JR	COPEN1
  DF1C                	COPENE:
  DF1C  2A7EEC        		LD	HL,(_DTBUF)
  DF1F  D1            		POP	DE
  DF20  C9            		RET
                      	
  DF21                	DC:
  DF21  ED53FEEB      		LD	(_CLPS),DE
  DF25  C5            		PUSH	BC
  DF26  D5            		PUSH	DE
  DF27  CDC1DF        		CALL	DCPAT
  DF2A  CD88E5        		CALL	DRDX
  DF2D  D1            		POP	DE
  DF2E  C1            		POP	BC
  DF2F  C9            		RET
                      	
  DF30                	FILESE:
  DF30  7E            		LD	A,(HL)
  DF31  B7            		OR	A
  DF32  C8            		RET	Z		;END:ZF=1 CF=0
  DF33  FEE5          		CP	0E5H
  DF35  280E          		JR	Z,FILESE1
  DF37  FDE5          		PUSH	IY
  DF39  D1            		POP	DE
  DF3A  13            		INC	DE
  DF3B  E5            		PUSH	HL
  DF3C  CD98DF        		CALL	CPFILE
  DF3F  CCB9DF        		CALL	Z,CPFILE2
  DF42  E1            		POP	HL
  DF43  37            		SCF
  DF44  C8            		RET	Z		;!!!:(ZF=1) CF=1
  DF45                	FILESE1:
  DF45  CD5CDF        		CALL	FNEXT
  DF48  20E6          		JR	NZ,FILESE
  DF4A                	ZFCF0:
  DF4A  F6FF          		OR	0FFH		;ZF=0 CF=0
  DF4C  C9            		RET
                      	
  DF4D                	NEXTSE:
  DF4D  7E            		LD	A,(HL)
  DF4E  B7            		OR	A
  DF4F  37            		SCF
  DF50  C8            		RET	Z		;!!!:ZF=1 CF=1
  DF51  FEE5          		CP	0E5H
  DF53  37            		SCF
  DF54  C8            		RET	Z		;!!!:(ZF=1) CF=1
  DF55  CD5CDF        		CALL	FNEXT
  DF58  20F3          		JR	NZ,NEXTSE
  DF5A  18EE          		JR	ZFCF0
                      	
  DF5C                	FNEXT:
  DF5C  E5            		PUSH	HL
  DF5D  219FEC        		LD	HL,_FILEN
  DF60  34            		INC	(HL)
  DF61  E1            		POP	HL
  DF62  112000        		LD	DE,020H
  DF65  19            		ADD	HL,DE
  DF66  0D            		DEC	C
  DF67  C9            		RET
                      	
  DF68                	CHKDDX:
  DF68  CD07E1        		CALL	CHKWILDX
  DF6B  D8            		RET	C
  DF6C  FDE5          		PUSH	IY
  DF6E  D1            		POP	DE
  DF6F  13            		INC	DE
  DF70  2162EC        		LD	HL,DDTB
  DF73  0604          		LD	B,DDS
  DF75                	CPNAME:
  DF75  C5            		PUSH	BC
  DF76  D5            		PUSH	DE
  DF77  117DE5        		LD	DE,CPBUF
  DF7A  010400        		LD	BC,4
  DF7D  EDB0          		LDIR
  DF7F  D1            		POP	DE
  DF80  D5            		PUSH	DE
  DF81  E5            		PUSH	HL
  DF82  217DE5        		LD	HL,CPBUF
  DF85  CD98DF        		CALL	CPFILE
  DF88  E1            		POP	HL
  DF89  D1            		POP	DE
  DF8A  C1            		POP	BC
  DF8B  2005          		JR	NZ,CPNAME1
  DF8D  7E            		LD	A,(HL)
  DF8E  23            		INC	HL
  DF8F  66            		LD	H,(HL)
  DF90  6F            		LD	L,A
  DF91  C9            		RET
  DF92                	CPNAME1:
  DF92  23            		INC	HL
  DF93  23            		INC	HL
  DF94  10DF          		DJNZ	CPNAME
  DF96  37            		SCF
  DF97  C9            		RET
                      	
  DF98                	CPFILE:
  DF98  C5            		PUSH	BC
  DF99  01000B        		LD	BC,00B00H
  DF9C                	CPSTR1:
  DF9C  1A            		LD	A,(DE)
  DF9D  FE3F          		CP	'?'		;Wild card
  DF9F  2812          		JR	Z,CPSTR2
  DFA1  7E            		LD	A,(HL)
  DFA2  CDEDE0        		CALL	FKANC
  DFA5  E5            		PUSH	HL
  DFA6  67            		LD	H,A
  DFA7  1A            		LD	A,(DE)
  DFA8  CB01          		RLC	C
  DFAA  CDEDE0        		CALL	FKANC
  DFAD  CB09          		RRC	C
  DFAF  BC            		CP	H		;CP (HL),(DE)
  DFB0  E1            		POP	HL
  DFB1  2004          		JR	NZ,CPSTR3
  DFB3                	CPSTR2:
  DFB3  13            		INC	DE
  DFB4  23            		INC	HL
  DFB5  10E5          		DJNZ	CPSTR1
  DFB7                	CPSTR3:
  DFB7  C1            		POP	BC
  DFB8  C9            		RET
                      	
  DFB9                	CPFILE2:
  DFB9  FD7E0D        		LD	A,(IY+13)	;(FCB)属性(アトリビュート)
  DFBC  F6E1          		OR	0E1H
  DFBE  2F            		CPL
  DFBF  A6            		AND	(HL)
  DFC0  C9            		RET
                      	
  DFC1                	DCPAT:
  DFC1  2A7EEC        		LD	HL,(_DTBUF)
  DFC4  3AA0EC        		LD	A,(_DIRF)
  DFC7  B7            		OR	A
  DFC8  C8            		RET	Z
                      	
  DFC9                	CLUST:
  DFC9  3E08          	CLSPAT:	LD	A,8	;+8 (2D)  !ADDCL (Self-rewriting)
  DFCB                	ADD_DE_A:
  DFCB  83            		ADD	A,E	;DE=DE+A
  DFCC  5F            		LD	E,A
  DFCD  8A            		ADC	A,D
  DFCE  93            		SUB	E
  DFCF  57            		LD	D,A
  DFD0  C9            		RET
                      	
  DFD1                	ENDCL:
  DFD1  7A            		LD	A,D	;END CLUSTER
  DFD2  FE01          	CLPAT1:	CP	1	;164=356	(Self-rewriting)
  DFD4  C0            		RET	NZ
  DFD5  7B            		LD	A,E
  DFD6  FE64          	CLPAT2:	CP	064H	;		(Self-rewriting)
  DFD8  C9            		RET
                      	
  DFD9                	ENDCLX:
  DFD9  D5            		PUSH	DE
  DFDA  CDDCE6        		CALL	DIVSPC
  DFDD  CDD1DF        		CALL	ENDCL
  DFE0  D1            		POP	DE
  DFE1  C9            		RET
  DFE2                	CAP:
  DFE2  FE61          		CP	'a'
  DFE4  D8            		RET	C
  DFE5  FE7B          		CP	'z'+1
  DFE7  D0            		RET	NC
  DFE8  D620          		SUB	020H
  DFEA  C9            		RET
  DFEB                	CAP2:
  DFEB  CDE2DF        		CALL	CAP
  DFEE                	CAP3:
  DFEE  CDF7DF        		CALL	CAP4
  DFF1  FE21          		CP	021H
  DFF3  D0            		RET	NC
  DFF4  3EA0          		LD	A,0A0H
  DFF6  C9            		RET
  DFF7                	CAP4:
  DFF7  FE05          		CP	5
  DFF9  C0            		RET	NZ
  DFFA  3EE5          		LD	A,0E5H
  DFFC  C9            		RET
                      	
  DFFD                	CHDIR:
  DFFD  CD3DE9        		CALL	GETDPBD
  E000  3806          		JR	C,CHDIR2
  E002  DD751A        		LD	(IX+01AH),L		;_SDIR_
  E005  DD741B        		LD	(IX+01BH),H		;_SDIR_+1
  E008                	CHDIR2:
  E008  DDE1          		POP	IX
  E00A  C9            		RET
                      	
  E00B                	LDDIR:
  E00B  CD3DE9        		CALL	GETDPBD
  E00E  DD5E1A        		LD	E,(IX+01AH)		;_SDIR_
  E011  DD561B        		LD	D,(IX+01BH)		;_SDIR_+1
  E014  13            		INC	DE
  E015  FD730E        		LD	(IY+14),E	;(FCB)アクセスするディレクトリのクラスタ番号+1
  E018  FD720F        		LD	(IY+15),D
  E01B  1B            		DEC	DE
  E01C  18EA          		JR	CHDIR2
                      	
  E01E                	LDDIRX:
  E01E  FD5E0E        		LD	E,(IY+14)	;(FCB)アクセスするディレクトリのクラスタ番号+1
  E021  FD560F        		LD	D,(IY+15)
  E024  1B            		DEC	DE
  E025  CDD1DF        		CALL	ENDCL
  E028  D40BE0        		CALL	NC,LDDIR
  E02B                	LDDIRS:
  E02B  7A            		LD	A,D
  E02C  B3            		OR	E
  E02D  32A0EC        		LD	(_DIRF),A
  E030  C9            		RET
                      	
  E031                	KILL:
  E031  CD07E1        		CALL	CHKWILDX
  E034  383A          		JR	C,KILLW
  E036  CD68DF        		CALL	CHKDDX
  E039  3F            		CCF
  E03A  D4F9DD        		CALL	NC,SOPENX1
  E03D                	KILLS:
  E03D  3E1F          		LD	A,01FH
  E03F  D483E0        		CALL	NC,CHKATT
  E042  D8            		RET	C
  E043                	KILLSX:
  E043  36E5          		LD	(HL),0E5H	;DIR
  E045  CDE1E0        		CALL	WTDB
  E048  111A00        		LD	DE,01AH
  E04B  19            		ADD	HL,DE
  E04C  5E            		LD	E,(HL)
  E04D  23            		INC	HL
  E04E  56            		LD	D,(HL)
  E04F  1804          		JR	KILLS2
  E051                	KILLS1:
  E051  ED5BFEEB      		LD	DE,(_CLPS)	;FAT
  E055                	KILLS2:
  E055  CDD1DF        		CALL	ENDCL
  E058  D0            		RET	NC		;CF=0
  E059  21FEFF        		LD	HL,0-2
  E05C  19            		ADD	HL,DE
  E05D  D0            		RET	NC		;DE= 0 or 1
  E05E  D5            		PUSH	DE
  E05F  CD2BE8        		CALL	_GNCL
  E062  ED53FEEB      		LD	(_CLPS),DE
  E066  D1            		POP	DE
  E067  210000        		LD	HL,0
  E06A  D42EE8        		CALL	NC,_SNCL
  E06D  30E2          		JR	NC,KILLS1
  E06F  C9            		RET
                      	
  E070                	KILLW:
  E070  CD26DE        		CALL	SOPEN
  E073                	KILLW1:
  E073  380B          		JR	C,KILLW2
  E075  CDC0DE        		CALL	SOPENE2
  E078  CD3DE0        		CALL	KILLS
  E07B  CD8ADE        		CALL	NOPEN
  E07E  18F3          		JR	KILLW1
  E080                	KILLW2:
  E080  C8            		RET	Z
  E081  3F            		CCF
  E082  C9            		RET
                      	
  E083                	CHKATT:
  E083  E5            		PUSH	HL
  E084  110B00        		LD	DE,00BH
  E087  19            		ADD	HL,DE
  E088  A6            		AND	(HL)
  E089  E1            		POP	HL
  E08A  C8            		RET	Z
  E08B  37            		SCF
  E08C  C9            		RET
                      	
  E08D                	NAME:
  E08D  CD07E1        		CALL	CHKWILDX
  E090  D8            		RET	C
  E091  110400        		LD	DE,4
  E094  19            		ADD	HL,DE
  E095  22ADE0        		LD	(NAMEP+2),HL
  E098  23            		INC	HL
  E099  CD0BE1        		CALL	CHKWILD
  E09C  D8            		RET	C
                      	
  E09D  CDF9DD        		CALL	SOPENX1
  E0A0  3E0F          		LD	A,00FH
  E0A2  D483E0        		CALL	NC,CHKATT
  E0A5  D8            		RET	C
                      	
  E0A6  FD7E00        		LD	A,(IY+0)
  E0A9  FDE5          		PUSH	IY
  E0AB  FD210000      	NAMEP:	LD	IY,0
  E0AF  FD7700        		LD	(IY+0),A
  E0B2  CDF9DD        		CALL	SOPENX1
  E0B5  FDE3          		EX	(SP),IY
  E0B7  3F            		CCF
  E0B8  D426DE        		CALL	NC,SOPEN
  E0BB  EB            		EX	DE,HL
  E0BC  E1            		POP	HL
  E0BD  D8            		RET	C
                      	
  E0BE                	SETNAME:
  E0BE  01000B        		LD	BC,11*256
  E0C1  23            		INC	HL
  E0C2  7E            		LD	A,(HL)
  E0C3  FEE5          		CP	0E5H
  E0C5  2004          		JR	NZ,SNAME1
  E0C7  3E05          		LD	A,5
  E0C9  180E          		JR	SNAME3
  E0CB                	SNAME1:
  E0CB  7E            		LD	A,(HL)
  E0CC  0C            		INC	C
  E0CD  0D            		DEC	C
  E0CE  2009          		JR	NZ,SNAME3
  E0D0  CDE2DF        		CALL	CAP
  E0D3  FEA0          		CP	0A0H
  E0D5  2002          		JR	NZ,SNAME3
  E0D7  3E20          		LD	A,020H
  E0D9                	SNAME3:
  E0D9  12            		LD	(DE),A
  E0DA  7E            		LD	A,(HL)
  E0DB  23            		INC	HL
  E0DC  CDF4E0        		CALL	FKAN
  E0DF  10EA          		DJNZ	SNAME1
  E0E1                	WTDB:
  E0E1  3EFF          		LD	A,0FFH
  E0E3  32ABE2        		LD	(SFILE),A
  E0E6                	SWTDBF:
  E0E6  3E01          		LD	A,1
  E0E8  32A4EC        		LD	(_WTDBF),A
  E0EB  AF            		XOR	A
  E0EC  C9            		RET
                      	
  E0ED                	FKANC:
  E0ED  CB41          		BIT	0,C
  E0EF  CCEBDF        		CALL	Z,CAP2
  E0F2  1801          		JR	FKANX
  E0F4                	FKAN:
  E0F4  13            		INC	DE
  E0F5                	FKANX:
  E0F5  CB41          		BIT	0,C
  E0F7  CB81          		RES	0,C
  E0F9  C0            		RET	NZ
  E0FA  FE80          		CP	080H
  E0FC  D8            		RET	C
  E0FD  FEA0          		CP	0A0H
  E0FF  3803          		JR	C,FKAN1
  E101  FEE0          		CP	0E0H
  E103  D8            		RET	C
  E104                	FKAN1:
  E104  0C            		INC	C
  E105  A7            		AND	A
  E106  C9            		RET
                      	
  E107                	CHKWILDX:
  E107  FDE5          		PUSH	IY
  E109  E1            		POP	HL
  E10A  23            		INC	HL
  E10B                	CHKWILD:
  E10B  060B          		LD	B,11
  E10D  3E3F          		LD	A,'?'
  E10F                	CHKWIL1:
  E10F  BE            		CP	(HL)
  E110  23            		INC	HL
  E111  37            		SCF
  E112  C8            		RET	Z
  E113  10FA          		DJNZ	CHKWIL1
  E115  AF            		XOR	A
  E116  C9            		RET
                      	
  E117                	SDIRENT:		;IY=FCB HL=DIR
  E117  D5            		PUSH	DE
  E118  E5            		PUSH	HL
  E119  FDE5          		PUSH	IY
  E11B  D1            		POP	DE
  E11C  EB            		EX	DE,HL
  E11D  CDBEE0        		CALL	SETNAME
                      	;				Attribute
  E120  FD7E0D        		LD	A,(IY+13)	;(FCB)属性(アトリビュート)
  E123  12            		LD	(DE),A
  E124  13            		INC	DE
                      	;				Reserved
  E125  AF            		XOR	A
  E126  060A          		LD	B,10
  E128                	SDE1:
  E128  12            		LD	(DE),A
  E129  13            		INC	DE
  E12A  10FC          		DJNZ	SDE1
                      						;(FCB)ファイルを最後に変更した時刻
  E12C  21DAEB        		LD	HL,SDDATA		;(FCB)ファイルを最後に変更した日付
  E12F  060A          		LD	B,SDDATAE-SDDATA	;(FCB)ファイルの先頭クラスタ
  E131                	SDLOOP:					;(FCB)ファイルのサイズ(バイト単位)
  E131  7E            		LD	A,(HL)
  E132  23            		INC	HL
  E133  3238E1        		LD	(SDPAT+2),A
  E136  FD7E00        	SDPAT:	LD	A,(IY+0)	;LD A,(IY+A)
  E139  12            		LD	(DE),A
  E13A  13            		INC	DE
  E13B  10F4          		DJNZ	SDLOOP
                      	
  E13D  AF            		XOR	A
  E13E  E1            		POP	HL
  E13F  D1            		POP	DE
  E140  C9            		RET
                      	
  E141                	WOPEN:
  E141  FD7E0D        		LD	A,(IY+13)	;(FCB)属性(アトリビュート)
  E144  E61F          		AND	01FH
  E146  37            		SCF
  E147  C0            		RET	NZ
  E148  FD361CFE      		LD	(IY+28),0FEH	;(FCB)オープン・モード
  E14C                	TOPEN2:
  E14C  AF            		XOR	A
  E14D                	TOPEN:				;Initializes the time stamp
  E14D  FD3617FF      		LD	(IY+23),0FFH	;(FCB)ファイルを最後に変更した時刻
  E151  C9            		RET
                      	
  E152                	WRDFX:
  E152  3AD2E6        		LD	A,(SPCPAT+1)	;1クラスタの論理セクタ
  E155                	L_WRFX:
  E155  1F            		RRA		;->CF
  E156  3804          		JR	C,E_WRFX
  E158  CB39          		SRL	C	;C=C/2
  E15A  18F9          		JR	L_WRFX
  E15C                	E_WRFX:
  E15C  41            		LD	B,C
  E15D  04            		INC	B
  E15E  3E37          		LD	A,037H		;SCF
  E160  32A1E5        		LD	(DRDN1),A
                      	
  E163                	WRDF:				;Bクラスタ分FATを確保する
  E163  110200        		LD	DE,2
  E166  CDCFE6        		CALL	MULSPC
  E169                	WRDF1:
  E169  C5            		PUSH	BC
  E16A  D5            		PUSH	DE
  E16B  CDDCE6        		CALL	DIVSPC
  E16E  CD2BE8        		CALL	_GNCL
  E171  3824          		JR	C,WRDF3
  E173  7A            		LD	A,D		;空いているかチェック
  E174  B3            		OR	E
  E175  2032          		JR	NZ,WRDF4
  E177  E1            		POP	HL		;HL=空いているクラスタ
  E178  E5            		PUSH	HL
  E179  ED5BFEEB      		LD	DE,(_CLPS)	;DE=元の(_CLPS)
  E17D  22FEEB        		LD	(_CLPS),HL
  E180  7A            		LD	A,D		;元の(_CLPS)が 0 か?
  E181  B3            		OR	E
  E182  EB            		EX	DE,HL		;
  E183  CDDCE6        		CALL	DIVSPC		;ここでフラグは変化しない
  E186  EB            		EX	DE,HL		;
  E187  2008          		JR	NZ,WRDF2
  E189  FD751A        		LD	(IY+26),L	;(FCB)ファイルの先頭クラスタ
  E18C  FD741B        		LD	(IY+27),H	;元が空の場合はFCBにクラスタをセットする
  E18F  1806          		JR	WRDF3
  E191                	WRDF2:
  E191  CDDCE6        		CALL	DIVSPC
  E194  CD2EE8        		CALL	_SNCL
  E197                	WRDF3:
  E197  D1            		POP	DE
  E198  C1            		POP	BC
  E199  D8            		RET	C
  E19A  100F          		DJNZ	WRDF5		;ここでループカウンタチェック
  E19C  ED5BFEEB      		LD	DE,(_CLPS)
  E1A0  CDDCE6        		CALL	DIVSPC
  E1A3  21FFFF        		LD	HL,0FFFFH	;FATエントリ終了(EOCマーク)
  E1A6  C32EE8        		JP	_SNCL
                      	
  E1A9                	WRDF4:				;DEクラスタが空じゃないので次に移動する
  E1A9  D1            		POP	DE
  E1AA  C1            		POP	BC
  E1AB                	WRDF5:
  E1AB  CDDCE6        		CALL	DIVSPC
  E1AE  13            		INC	DE
  E1AF  CDD1DF        		CALL	ENDCL
  E1B2  CDCFE6        		CALL	MULSPC
  E1B5  38B2          		JR	C,WRDF1
  E1B7  37            		SCF
  E1B8  C9            		RET
                      	
  E1B9                	RWXR:
  E1B9  3A19E5        		LD	A,(SECSZ+2)	;1024=4 / 512=2 / 256=1
  E1BC                	L_RWX:
  E1BC  1F            		RRA		;->CF
  E1BD  3806          		JR	C,E_RWX
  E1BF  CB38          		SRL	B	;BC=BC/2
  E1C1  CB19          		RR	C	;
  E1C3  18F7          		JR	L_RWX
  E1C5                	E_RWX:
  E1C5  FD5E1A        		LD	E,(IY+26)	;(FCB)ファイルの先頭クラスタ
  E1C8  FD561B        		LD	D,(IY+27)
  E1CB  CDCFE6        		CALL	MULSPC
  E1CE                	RWX1:
  E1CE  ED53FEEB      		LD	(_CLPS),DE
  E1D2  7A            		LD	A,D
  E1D3  B3            		OR	E
  E1D4  37            		SCF
  E1D5  C8            		RET	Z	;RET DE==0
                      	
  E1D6  78            		LD	A,B
  E1D7  B1            		OR	C
  E1D8  C8            		RET	Z	;RET BC==0
                      	
  E1D9  CDC1E6        		CALL	GNCLX
  E1DC  D8            		RET	C
  E1DD  0B            		DEC	BC
                      	
  E1DE  CDD9DF        		CALL	ENDCLX
  E1E1  38EB          		JR	C,RWX1
  E1E3  37            		SCF
  E1E4  C9            		RET
                      	
  E1E5                	DSKF:
  E1E5  110000        	MAXCLP:	LD	DE,0
  E1E8  210000        		LD	HL,0
  E1EB                	DSKF1:
  E1EB  D5            		PUSH	DE
  E1EC  CD2BE8        		CALL	_GNCL
  E1EF  380C          		JR	C,POPSCF
  E1F1  7A            		LD	A,D
  E1F2  B3            		OR	E
  E1F3  2001          		JR	NZ,DSKF2
  E1F5  23            		INC	HL
  E1F6                	DSKF2:
  E1F6  D1            		POP	DE
  E1F7  1B            		DEC	DE
  E1F8  7A            		LD	A,D
  E1F9  B3            		OR	E
  E1FA  20EF          		JR	NZ,DSKF1
  E1FC  C9            		RET
                      	
  E1FD                	POPSCF:
  E1FD  F1            		POP	AF
  E1FE  37            		SCF
  E1FF  C9            		RET
                      	
  E200                	SETTMS:
  E200  FD7E17        		LD	A,(IY+23)	;(FCB)ファイルを最後に変更した時刻
  E203  3C            		INC	A
  E204  C0            		RET	NZ		;ファイルが更新されていない
  E205                	SETTMSX:			;FCBに日付時刻をセットする
  E205  CDA4D8        		CALL	_SYS2C		;(BDOS)時刻の獲得
                      					;H←時  L←分  D←秒
  E208  CB25          		SLA	L		;L=L/2
  E20A  CB25          		SLA	L		;L=L/2
  E20C  29            		ADD	HL,HL		;*2
  E20D  29            		ADD	HL,HL		;*4
  E20E  29            		ADD	HL,HL		;*8
  E20F  7A            		LD	A,D
  E210  0F            		RRCA			;bit.0->7->->->0->C
  E211  E61F          		AND	01FH
  E213  B5            		OR	L
  E214  FD7716        		LD	(IY+22),A	;(FCB)ファイルを最後に変更した時刻
  E217  FD7417        		LD	(IY+23),H
                      	
  E21A  CD6AD8        		CALL	_SYS2A		;(BDOS)日付の獲得
                      					;HL←年  D←月  E←日
  E21D  0144F8        		LD	BC,0-1980
  E220  09            		ADD	HL,BC
  E221  65            		LD	H,L
                      	
  E222  7A            		LD	A,D
  E223  87            		ADD	A,A		;*2
  E224  87            		ADD	A,A		;*4
  E225  87            		ADD	A,A		;*8
  E226  87            		ADD	A,A		;*16
  E227  6F            		LD	L,A
  E228  29            		ADD	HL,HL		;*32
  E229  7D            		LD	A,L
  E22A  B3            		OR	E
  E22B  FD7714        		LD	(IY+20),A	;(FCB)ファイルを最後に変更した日付
  E22E  FD7415        		LD	(IY+21),H
  E231  C9            		RET
                      	
  E232                	PUSHRR:
  E232  CD38E2        		CALL	SUBRR
  E235                	POPRR1:
  E235  EDB0          		LDIR
  E237  C9            		RET
                      	
  E238                	SUBRR:
  E238  FDE5          		PUSH	IY
  E23A  E1            		POP	HL
  E23B  112100        		LD	DE,33
  E23E  19            		ADD	HL,DE
  E23F  11CCE2        		LD	DE,HLBUF
  E242  010300        		LD	BC,3
  E245  C9            		RET
                      	
  E246                	SETSEQ:
  E246  F5            		PUSH	AF		;AHL=Random record
  E247  FD7E21        		LD	A,(IY+33)	;(FCB)ランダム・レコード
  E24A  FD6E22        		LD	L,(IY+34)
  E24D  FD6623        		LD	H,(IY+35)
                      	
  E250  CD6CE2        		CALL	SSQ1
                      	
  E253  29            		ADD	HL,HL
  E254  CB3D          		SRL	L		;L=L/2
  E256  FD7520        		LD	(IY+32),L	;(FCB)カレント・レコード
  E259  FD740C        		LD	(IY+12),H	;(FCB)カレント・ブロック
  E25C  F1            		POP	AF
                      	
  E25D                	POPRR:
  E25D  CD38E2        		CALL	SUBRR
  E260  EB            		EX	DE,HL
  E261  18D2          		JR	POPRR1
                      	
  E263                	GETSIZE:
  E263  FD7E10        		LD	A,(IY+16)	;(FCB)ファイルのサイズ(バイト単位)
  E266  FD6E11        		LD	L,(IY+17)
  E269  FD6612        		LD	H,(IY+18)
  E26C                	SSQ1:				;バイト単位からCP/Mのレコード単位を求める（1レコード=128バイト）
  E26C  87            		ADD	A,A		;in HLA => out HL
  E26D  ED6A          		ADC	HL,HL
  E26F  B7            		OR	A
  E270  C8            		RET	Z
  E271  23            		INC	HL
  E272  C9            		RET
                      	
  E273                	GETSEQ:
  E273  FD6E20        		LD	L,(IY+32)	;(FCB)カレント・レコード
  E276  FD660C        		LD	H,(IY+12)	;(FCB)カレント・ブロック
                      	
  E279  CB25          		SLA	L	;L=L*2
                      	
  E27B  CB3C          		SRL	H	;HL=HL/2
  E27D  CB1D          		RR	L	;
  E27F  C9            		RET
                      	
  E280                	RB_WRITE:
  E280  C5            		PUSH	BC
  E281  ED4B4CEC      		LD	BC,(STABLE+2*026H)	;(BDOS)ランダム・ブロック・ライト
  E285  1805          		JR	RBRW
  E287                	RB_READ:
  E287  C5            		PUSH	BC
  E288  ED4B4EEC      		LD	BC,(STABLE+2*027H)	;(BDOS)ランダム・ブロック・リード
  E28C                	RBRW:
  E28C  AF            		XOR	A	;HLA = HL*128
  E28D  CB3C          		SRL	H	;HL=HL/2
  E28F  CB1D          		RR	L	;
  E291  1F            		RRA			;HLA
  E292  FD7721        		LD	(IY+33),A	;(FCB)ランダム・レコード
  E295  FD7522        		LD	(IY+34),L
  E298  FD7423        		LD	(IY+35),H
  E29B  218000        		LD	HL,128
                      	
  E29E  FDE5          		PUSH	IY
  E2A0  D1            		POP	DE
  E2A1  D5            		PUSH	DE
  E2A2  CDA9E2        		CALL	JP_BC
  E2A5  FDE1          		POP	IY
  E2A7  C1            		POP	BC
  E2A8  C9            		RET
  E2A9                	JP_BC:
  E2A9  C5            		PUSH	BC
  E2AA  C9            		RET
                      	
  E2AB                	SFILE:	DS	33		;DRV FILENAME
  E2CC                	HLBUF:	DS	3		;Random record buffer
                      	
                      	;LDFILE2.ASM
                      	
                      	;	LSX-Dodgers FILE2
                      	
  E2CF                	RBWDD:
  E2CF  E5            		PUSH	HL
  E2D0  C1            		POP	BC
  E2D1  21A9E3        		LD	HL,NUL
  E2D4  CDDDE3        		CALL	DDX
  E2D7  2003          		JR	NZ,RBWDD2
  E2D9  2A08EC        		LD	HL,(STABLE+2*4)
  E2DC                	RBWDD2:
  E2DC  FE43          		CP	'C'
  E2DE  2003          		JR	NZ,RBWDD3
  E2E0  2192DA        		LD	HL,PRINTS
  E2E3                	RBWDD3:
  E2E3  FE50          		CP	'P'
  E2E5  2003          		JR	NZ,RBWDD4
  E2E7  2A0AEC        		LD	HL,(STABLE+2*5)
  E2EA                	RBWDD4:
  E2EA  22F8E2        		LD	(RBWDDP+1),HL
  E2ED  2A8AEC        		LD	HL,(_DTA)
  E2F0                	RBWDD1:
  E2F0  78            		LD	A,B
  E2F1  B1            		OR	C
  E2F2                	RBWDD5:
  E2F2  CAA4E3        		JP	Z,RBW1
  E2F5  5E            		LD	E,(HL)
  E2F6  23            		INC	HL
  E2F7  CDE2D7        	RBWDDP:	CALL	_SYS02
  E2FA  DAC0E3        		JP	C,RBRERR
  E2FD  3E1A          		LD	A,01AH
  E2FF  BB            		CP	E
  E300  28F0          		JR	Z,RBWDD5
  E302  0B            		DEC	BC
  E303  18EB          		JR	RBWDD1
                      	
                      					;Write random block
  E305                	_SYS26:		;(BDOS)ランダム・ブロック・ライト
  E305  AF            		XOR	A
  E306  32A1E5        		LD	(DRDN1),A	;NOP
  E309  225BE5        		LD	(LEFT+1),HL	;HL←書き込むレコード数
  E30C  227DE5        		LD	(LEFTX),HL
  E30F  CDD2DD        		CALL	SETDRV
                      	
  E312  CDC7E4        		CALL	RBX0
  E315  DAABE3        		JP	C,RBWERR
  E318  28B5          		JR	Z,RBWDD		;デバイスデスクプリタ
  E31A  CD41E1        		CALL	WOPEN
  E31D  DAABE3        		JP	C,RBWERR
  E320  7C            		LD	A,H
  E321  B5            		OR	L
  E322  CAA4E3        		JP	Z,RBW1
                      	
  E325  2B            		DEC	HL
                      	
  E326  CD73E5        		CALL	GET_RR_CDE	;CDE=Random record
                      	
  E329  AF            		XOR	A	;AHL=HL+CDE
  E32A  19            		ADD	HL,DE
  E32B  89            		ADC	A,C
                      	
  E32C  47            		LD	B,A
  E32D  4C            		LD	C,H
                      	
  E32E  CDB9E1        		CALL	RWXR
  E331  DC52E1        		CALL	C,WRDFX
  E334  DAABE3        		JP	C,RBWERR
                      		
  E337  CDF0E4        		CALL	RBX2
  E33A  281A          		JR	Z,RBWB		;NZ=セクタ以下の端数がある
  E33C  CD03E5        		CALL	RBXA		
  E33F  386A          		JR	C,RBWERR
  E341  EB            		EX	DE,HL
  E342  C5            		PUSH	BC
  E343  EDB0          		LDIR
  E345  227FE5        		LD	(DTAX),HL
                      	
  E348  CDE6E0        		CALL	SWTDBF		;バッファデータは更新された
                      	
  E34B  2A7DE5        		LD	HL,(LEFTX)
  E34E  D1            		POP	DE
  E34F  ED52          		SBC	HL,DE
  E351  227DE5        		LD	(LEFTX),HL
  E354  282E          		JR	Z,RBWEND
                      	
  E356                	RBWB:
  E356  CD37E5        		CALL	RBXB
  E359  2813          		JR	Z,RBWC
  E35B                	RBWB1:
  E35B  C5            		PUSH	BC
  E35C  D5            		PUSH	DE
  E35D  CDC9DF        		CALL	CLUST
  E360  CD20E8        		CALL	DWT_DPB
  E363  D1            		POP	DE
  E364  C1            		POP	BC
  E365  3844          		JR	C,RBWERR
  E367  CDC1E6        		CALL	GNCLX
  E36A  383F          		JR	C,RBWERR
  E36C  10ED          		DJNZ	RBWB1
  E36E                	RBWC:
  E36E  CD4FE5        		CALL	RBXC
  E371  2811          		JR	Z,RBWEND
                      	
  E373  CDC9DF        		CALL	CLUST
  E376  CDA0E5        		CALL	DRDN
  E379  3830          		JR	C,RBWERR
  E37B  ED5B7EEC      		LD	DE,(_DTBUF)
  E37F  EDB0          		LDIR
  E381  CDE6E0        		CALL	SWTDBF		;バッファデータは更新された
  E384                	RBWEND:
  E384  CD5AE5        		CALL	RBXEND
                      	
  E387  CDD6E4        		CALL	RBX1
  E38A  3018          		JR	NC,RBW1
  E38C  2A5BE5        		LD	HL,(LEFT+1)
  E38F  FD5E10        		LD	E,(IY+16)	;(FCB)ファイルのサイズ(バイト単位)
  E392  FD5611        		LD	D,(IY+17)	;CDE=File size
  E395  FD4E12        		LD	C,(IY+18)
  E398  AF            		XOR	A
  E399  19            		ADD	HL,DE
  E39A  89            		ADC	A,C
  E39B  FD7510        		LD	(IY+16),L	;(FCB)ファイルのサイズ(バイト単位)
  E39E  FD7411        		LD	(IY+17),H
  E3A1  FD7712        		LD	(IY+18),A
  E3A4                	RBW1:
  E3A4  FDE1          		POP	IY
  E3A6  C1            		POP	BC
  E3A7  D1            		POP	DE
  E3A8  E1            		POP	HL
  E3A9                	NUL:
  E3A9  AF            		XOR	A
  E3AA  C9            		RET
                      	
  E3AB                	RBWERR:
  E3AB  FDE5          		PUSH	IY
  E3AD  D1            		POP	DE
  E3AE  2A20EC        		LD	HL,(STABLE+2*010H)
  E3B1  CD0F00        		CALL	JP_HL
  E3B4                	RBRERR1:
  E3B4  3E01          		LD	A,001H
  E3B6                	RBRERR2:
  E3B6  FDE1          		POP	IY
  E3B8  C1            		POP	BC
  E3B9  D1            		POP	DE
  E3BA  E1            		POP	HL
  E3BB  37            		SCF
  E3BC  210000        		LD	HL,0
  E3BF  C9            		RET
                      	
  E3C0                	RBRERR:
  E3C0  3EFF          		LD	A,0FFH
  E3C2  18F2          		JR	RBRERR2
                      	
  E3C4                	RBRFL:
  E3C4  3E00          	RBRFLP:	LD	A,000H
  E3C6  FE0D          		CP	00DH
  E3C8  2005          		JR	NZ,RBRFL1
  E3CA  D5            		PUSH	DE
  E3CB  1E0A          		LD	E,00AH
  E3CD  1805          		JR	RBRFL2
  E3CF                	RBRFL1:
  E3CF  D5            		PUSH	DE
  E3D0  CDAFD3        		CALL	_SYS07
  E3D3  5F            		LD	E,A
  E3D4                	RBRFL2:
  E3D4  CDCDEC        		CALL	_PRINT
  E3D7  7B            		LD	A,E
  E3D8  D1            		POP	DE
  E3D9  32C5E3        		LD	(RBRFLP+1),A
  E3DC  C9            		RET
  E3DD                	DDX:
  E3DD  FD7E01        		LD	A,(IY+1)	;(FCB)主ファイル名
  E3E0  CDE2DF        		CALL	CAP
  E3E3  FE41          		CP	'A'
  E3E5  C9            		RET
                      	
  E3E6                	RBRDD:
  E3E6  E5            		PUSH	HL
  E3E7  C1            		POP	BC
  E3E8  21C4E3        		LD	HL,RBRFL
  E3EB  CDDDE3        		CALL	DDX
  E3EE  2005          		JR	NZ,RBRDD2
  E3F0  2A06EC        		LD	HL,(STABLE+2*3)
  E3F3  1804          		JR	RBRDD3
  E3F5                	RBRDD2:
  E3F5  FE43          		CP	'C'
  E3F7  202C          		JR	NZ,RBRDERR
  E3F9                	RBRDD3:
  E3F9  2209E4        		LD	(RBRDDP+1),HL
                      	
  E3FC  ED5B8AEC      		LD	DE,(_DTA)
  E400  210000        		LD	HL,0
  E403                	RBRDD1:
  E403  78            		LD	A,B
  E404  B1            		OR	C
  E405  2818          		JR	Z,RBRDDE1
  E407  23            		INC	HL
  E408  CDC4E3        	RBRDDP:	CALL	RBRFL
  E40B  380D          		JR	C,RBRDDE
  E40D  FE1A          		CP	01AH
  E40F  2809          		JR	Z,RBRDDE
  E411  FE03          		CP	3
  E413  2805          		JR	Z,RBRDDE
  E415  12            		LD	(DE),A
  E416  13            		INC	DE
  E417  0B            		DEC	BC
  E418  18E9          		JR	RBRDD1
                      	
  E41A                	RBRDDE:
  E41A  3E1A          		LD	A,01AH
  E41C  12            		LD	(DE),A
  E41D                	RBRDDE2:
  E41D  AF            		XOR	A
  E41E  3C            		INC	A
  E41F                	RBRDDE1:
  E41F  32B3E4        		LD	(RBRAP+1),A
  E422  C3ACE4        		JP	RBREND0
  E425                	RBRDERR:
  E425  210000        		LD	HL,0
  E428  18F3          		JR	RBRDDE2
                      	
                      					;Read random block
  E42A                	_SYS27:		;(BDOS)ランダム・ブロック・リード
  E42A  227DE5        		LD	(LEFTX),HL
  E42D  CDD2DD        		CALL	SETDRV
                      	
  E430  FDCB0D66      		BIT	4,(IY+13)	;(FCB)属性(アトリビュート)
  E434  C2B5E4        		JP	NZ,RBRDIR	;ディレクトリ
  E437  CDC7E4        		CALL	RBX0
  E43A  DAC0E3        		JP	C,RBRERR
  E43D  28A7          		JR	Z,RBRDD
  E43F  CDD6E4        		CALL	RBX1
  E442  DAB4E3        		JP	C,RBRERR1
  E445  79            		LD	A,C
  E446  EB            		EX	DE,HL
  E447  ED52          		SBC	HL,DE		;CP 0HL,CDE
  E449  19            		ADD	HL,DE
  E44A  DE00          		SBC	A,000H
  E44C  3801          		JR	C,RBR1
  E44E  EB            		EX	DE,HL
  E44F                	RBR1:
  E44F  9F            		SBC	A,A
  E450  E601          		AND	1
  E452  32B3E4        		LD	(RBRAP+1),A
                      	
  E455  7C            		LD	A,H
  E456  B5            		OR	L
  E457  CAACE4        		JP	Z,RBREND0
                      	
  E45A  225BE5        		LD	(LEFT+1),HL	;Read record byte
  E45D  227DE5        		LD	(LEFTX),HL
                      	
  E460  CDF0E4        		CALL	RBX2
  E463  2819          		JR	Z,RBRB
  E465  CD03E5        		CALL	RBXA
  E468  DAC0E3        		JP	C,RBRERR
  E46B  C5            		PUSH	BC
  E46C  EDB0          		LDIR
  E46E  ED537FE5      		LD	(DTAX),DE
  E472  2A7DE5        		LD	HL,(LEFTX)
  E475  D1            		POP	DE
  E476  A7            		AND	A
  E477  ED52          		SBC	HL,DE
  E479  227DE5        		LD	(LEFTX),HL
  E47C  282B          		JR	Z,RBREND
                      	
  E47E                	RBRB:
  E47E  CD37E5        		CALL	RBXB
  E481  2812          		JR	Z,RBRC
  E483                	RBRB1:
  E483  C5            		PUSH	BC
  E484  D5            		PUSH	DE
  E485  CDC9DF        		CALL	CLUST
  E488  CDD0E7        		CALL	DRD_DPB
  E48B  D1            		POP	DE
  E48C  C1            		POP	BC
  E48D  D4C1E6        		CALL	NC,GNCLX
  E490  DAC0E3        		JP	C,RBRERR
  E493  10EE          		DJNZ	RBRB1
  E495                	RBRC:
  E495  CD4FE5        		CALL	RBXC
  E498  280F          		JR	Z,RBREND
                      	
  E49A  CDC9DF        		CALL	CLUST
  E49D  CD88E5        		CALL	DRDX
  E4A0  DAC0E3        		JP	C,RBRERR
  E4A3  EB            		EX	DE,HL
  E4A4  2A7EEC        		LD	HL,(_DTBUF)
  E4A7  EDB0          		LDIR
  E4A9                	RBREND:
  E4A9  CD5AE5        		CALL	RBXEND
  E4AC                	RBREND0:
  E4AC  FDE1          		POP	IY
  E4AE  C1            		POP	BC
  E4AF  D1            		POP	DE
  E4B0  F1            		POP	AF	;(HL)
  E4B1  AF            		XOR	A
  E4B2  3E00          	RBRAP:	LD	A,000H
  E4B4  C9            		RET
                      	
  E4B5                	RBRDIR:
  E4B5  FD6E1A        		LD	L,(IY+26)	;(FCB)ファイルの先頭クラスタ
  E4B8  FD661B        		LD	H,(IY+27)
  E4BB  CDFDDF        		CALL	CHDIR
  E4BE  AF            		XOR	A
  E4BF  67            		LD	H,A
  E4C0  6F            		LD	L,A
  E4C1  3C            		INC	A
  E4C2  32B3E4        		LD	(RBRAP+1),A
  E4C5  18E5          		JR	RBREND0
                      	
  E4C7                	RBX0:
  E4C7  2A8AEC        		LD	HL,(_DTA)
  E4CA  227FE5        		LD	(DTAX),HL
  E4CD  2A7DE5        		LD	HL,(LEFTX)
  E4D0  FD7E1C        		LD	A,(IY+28)	;(FCB)オープン・モード
  E4D3  D6FD          		SUB	0FDH
  E4D5  C9            		RET
                      	
  E4D6                	RBX1:
  E4D6  E5            		PUSH	HL		;Record byte
                      					;AHL=File size
  E4D7  FD6E10        		LD	L,(IY+16)	;ファイルのサイズ(バイト単位)
  E4DA  FD6611        		LD	H,(IY+17)
  E4DD  FD7E12        		LD	A,(IY+18)
                      	
  E4E0  CD73E5        		CALL	GET_RR_CDE	;CDE=Random record
                      	
  E4E3  A7            		AND	A
  E4E4  ED52          		SBC	HL,DE
  E4E6  99            		SBC	A,C
  E4E7  D1            		POP	DE
                      	
  E4E8  D8            		RET	C
  E4E9  4F            		LD	C,A
  E4EA  EB            		EX	DE,HL	;CDE=File byte	HL=Record byte
  E4EB  B2            		OR	D
  E4EC  B3            		OR	E
  E4ED  C0            		RET	NZ
  E4EE  37            		SCF
  E4EF  C9            		RET
                      	
  E4F0                	RBX2:				;Cluster settings
  E4F0  FD4E22        		LD	C,(IY+34)	;(+33)(FCB)ランダム・レコード
  E4F3  FD4623        		LD	B,(IY+35)
  E4F6  CDB9E1        		CALL	RWXR
  E4F9  3AFCDE        		LD	A,(SECSZM1+2)	;1024=3 / 512=1 / 256=0
  E4FC  FDA622        		AND	(IY+34)
  E4FF  FDB621        		OR	(IY+33)
  E502  C9            		RET
                      	
  E503                	RBXA:
  E503  D5            		PUSH	DE
  E504  CDC9DF        		CALL	CLUST
  E507  CD88E5        		CALL	DRDX
  E50A  D1            		POP	DE
  E50B  D8            		RET	C
  E50C  CDC1E6        		CALL	GNCLX
  E50F  D8            		RET	C
  E510  ED53FEEB      		LD	(_CLPS),DE
                      	
  E514  FD4E21        		LD	C,(IY+33)	;(FCB)ランダム・レコード
  E517  210004        	SECSZ:	LD	HL,0400H	;自己書き換え 1024=0400H / 512=0200H ここに1セクタのサイズが格納される
  E51A  7C            		LD	A,H
  E51B  3D            		DEC	A		;1024=3 / 512=1
  E51C  FDA622        		AND	(IY+34)		;(FCB)ランダム・レコード
  E51F  47            		LD	B,A		;BCに1セクタ以下の端数が入る
  E520  ED42          		SBC	HL,BC		;残りを計算
                      	
  E522  ED5B7DE5      		LD	DE,(LEFTX)
  E526  ED52          		SBC	HL,DE		;CP HL,DE
  E528  19            		ADD	HL,DE		;
  E529  3801          		JR	C,RBXA1		;DEとHLを比較して大きい方をHLに
  E52B  EB            		EX	DE,HL
  E52C                	RBXA1:
  E52C  E5            		PUSH	HL
  E52D  2A7EEC        		LD	HL,(_DTBUF)
  E530  09            		ADD	HL,BC
  E531  ED5B7FE5      		LD	DE,(DTAX)
  E535  C1            		POP	BC
  E536  C9            		RET
                      	
  E537                	RBXB:
  E537  2A7FE5        		LD	HL,(DTAX)
  E53A  ED5BFEEB      		LD	DE,(_CLPS)
  E53E  3A7EE5        		LD	A,(LEFTX+1)
  E541  47            		LD	B,A
  E542  3A19E5        		LD	A,(SECSZ+2)	;1024=4 / 512=2 / 256=1
  E545                	RBXB1:
  E545  1F            		RRA		;->CF
  E546  3804          		JR	C,RBXB2
  E548  CB38          		SRL	B	;B=B/2
  E54A  18F9          		JR	RBXB1
  E54C                	RBXB2:
  E54C  78            		LD	A,B
  E54D  B7            		OR	A
  E54E  C9            		RET
                      	
  E54F                	RBXC:
  E54F  ED4B7DE5      		LD	BC,(LEFTX)
  E553  3AFCDE        		LD	A,(SECSZM1+2)	;1024=3 / 512=1 / 256=0
  E556  A0            		AND	B
  E557  47            		LD	B,A		;1セクタ以下の端数がない場合はZ
  E558  B1            		OR	C
  E559  C9            		RET
                      	
  E55A                	RBXEND:
  E55A  110000        	LEFT:	LD	DE,0
  E55D  AF            		XOR	A
  E55E  FD6E21        		LD	L,(IY+33)	;(FCB)ランダム・レコード
  E561  FD6622        		LD	H,(IY+34)
  E564  19            		ADD	HL,DE
  E565  FD8E23        		ADC	A,(IY+35)
  E568  FD7521        		LD	(IY+33),L	;(FCB)ランダム・レコード
  E56B  FD7422        		LD	(IY+34),H
  E56E  FD7723        		LD	(IY+35),A
  E571  EB            		EX	DE,HL		;HL=Read byte
  E572  C9            		RET
                      	
  E573                	GET_RR_CDE:			;CDE=Random record
  E573  FD5E21        		LD	E,(IY+33)	;(FCB)ランダム・レコード
  E576  FD5622        		LD	D,(IY+34)
  E579  FD4E23        		LD	C,(IY+35)
  E57C  C9            		RET
                      	
  E57D                	CPBUF:
  E57D  0000          	LEFTX:	DW	0
  E57F  0000          	DTAX:	DW	0
  E581  20            		DB	020H	;DS 7,20h
  E582  20            		DB	020H
  E583  20            		DB	020H
  E584  20            		DB	020H
  E585  20            		DB	020H
  E586  20            		DB	020H
  E587  20            		DB	020H
                      	;
                      	
                      	;LDDIO.ASM
                      	
                      	;	LSX-Dodgers DIO
                      	
  E588                	DRDX:
  E588  CDBEE5        		CALL	DRDY
  E58B  C8            		RET	Z
  E58C  CDA8E5        		CALL	DRDX1		;データバッファの情報を保存
  E58F  D8            		RET	C
  E590  E5            		PUSH	HL
  E591  C5            		PUSH	BC
  E592  D5            		PUSH	DE
  E593  2A7EEC        		LD	HL,(_DTBUF)
  E596  CDD0E7        		CALL	DRD_DPB
  E599  DCB9E5        		CALL	C,DRDNE
  E59C                	POP_DE_BC_HL_RET:
  E59C  D1            		POP	DE
  E59D  C1            		POP	BC
  E59E  E1            		POP	HL
  E59F  C9            		RET
                      	
  E5A0                	DRDN:
  E5A0  AF            		XOR	A
  E5A1  00            	DRDN1:	NOP			;自己書き換え NOP / SCF
  E5A2  30E4          		JR	NC,DRDX
  E5A4                	DRDNX:
  E5A4  CDBEE5        		CALL	DRDY
  E5A7  C8            		RET	Z
  E5A8                	DRDX1:				;データバッファの情報を保存
  E5A8  CDCFE5        		CALL	DWTX
  E5AB  ED53A6EC      		LD	(_DBSEC),DE
  E5AF  3A88EC        		LD	A,(_DRV)
  E5B2  32A5EC        		LD	(_DBDRV),A
  E5B5  CDD9EC        		CALL	_CHGDRV
  E5B8  D0            		RET	NC
  E5B9                	DRDNE:
  E5B9  9F            		SBC	A,A
  E5BA  32A5EC        		LD	(_DBDRV),A
  E5BD  C9            		RET
                      	
  E5BE                	DRDY:
  E5BE  E5            		PUSH	HL
  E5BF  3A88EC        		LD	A,(_DRV)
  E5C2  21A5EC        		LD	HL,_DBDRV
  E5C5  AE            		XOR	(HL)
  E5C6  2005          		JR	NZ,POP_HL_RET
                      	
  E5C8  2AA6EC        		LD	HL,(_DBSEC)
  E5CB  ED52          		SBC	HL,DE		;CF=0
  E5CD                	POP_HL_RET:
  E5CD  E1            		POP	HL
  E5CE  C9            		RET
                      	
  E5CF                	DWTX:
  E5CF  3AA4EC        		LD	A,(_WTDBF)
  E5D2  B7            		OR	A
  E5D3  C8            		RET	Z
  E5D4  AF            		XOR	A
  E5D5  32A4EC        		LD	(_WTDBF),A
                      	
  E5D8  E5            		PUSH	HL
  E5D9  C5            		PUSH	BC
  E5DA  D5            		PUSH	DE
  E5DB  3AA5EC        		LD	A,(_DBDRV)
  E5DE  CDD9EC        		CALL	_CHGDRV
  E5E1  ED5BA6EC      		LD	DE,(_DBSEC)
  E5E5  2A7EEC        		LD	HL,(_DTBUF)
  E5E8  D420E8        		CALL	NC,DWT_DPB
  E5EB  18AF          		JR	POP_DE_BC_HL_RET
                      	
  E5ED                	RDFATX:
  E5ED  E5            		PUSH	HL
  E5EE  3A88EC        		LD	A,(_DRV)
  E5F1  21AAEC        		LD	HL,_FATDRV
  E5F4  AE            		XOR	(HL)
  E5F5  28D6          		JR	Z,POP_HL_RET
                      	
  E5F7  C5            		PUSH	BC
  E5F8  D5            		PUSH	DE
  E5F9  DDE5          		PUSH	IX
  E5FB  CD17E6        		CALL	WTFATX
  E5FE  3813          		JR	C,POP_IX_DE_BC_HL_RET
                      	
  E600  AF            		XOR	A
  E601  32ABEC        		LD	(_FATIX),A
  E604  3A88EC        		LD	A,(_DRV)
  E607  32AAEC        		LD	(_FATDRV),A
  E60A  CDE5EC        		CALL	_RDFAT
  E60D                	RDFATE2:
  E60D  3004          		JR	NC,POP_IX_DE_BC_HL_RET
  E60F  9F            		SBC	A,A		;A=0xFF
  E610  32AAEC        		LD	(_FATDRV),A
  E613                	POP_IX_DE_BC_HL_RET:
  E613  DDE1          		POP	IX
  E615  1885          		JR	POP_DE_BC_HL_RET
                      	
  E617                	WTFATX:
  E617  3AA2EC        		LD	A,(_WTFATF)
  E61A  B7            		OR	A
  E61B  C8            		RET	Z
  E61C  E5            		PUSH	HL
  E61D  3AAAEC        		LD	A,(_FATDRV)
  E620  21A5EC        		LD	HL,_DBDRV
  E623  AE            		XOR	(HL)
  E624  CCCFE5        		CALL	Z,DWTX
  E627  38A4          		JR	C,POP_HL_RET
  E629  C5            		PUSH	BC
  E62A  D5            		PUSH	DE
  E62B  DDE5          		PUSH	IX
  E62D  CD31E8        		CALL	WTFAT
  E630  AF            		XOR	A
  E631  32A2EC        		LD	(_WTFATF),A
  E634  18DD          		JR	POP_IX_DE_BC_HL_RET
                      	
  E636                	NCL1:
  E636  7A            		LD	A,D
  E637  B3            		OR	E
  E638  37            		SCF
  E639  C8            		RET	Z
                      	
  E63A  E5            		PUSH	HL
  E63B  7A            		LD	A,D
  E63C  E608          		AND	8		;DE(targetCluster >= 0x800)
  E63E  325DE6        		LD	(NCLPAT+2),A
  E641  2AAAEC        		LD	HL,(_FATDRV)	;L=_FATDRV H=FATIX
  E644  BC            		CP	H
  E645  3A88EC        		LD	A,(_DRV)	;この間でフラグは変化しない
  E648  325CE6        		LD	(NCLPAT+1),A	;
  E64B  2005          		JR	NZ,NCL2		;FATIXが違う
  E64D  BD            		CP	L
  E64E  2002          		JR	NZ,NCL2		;ドライブが違う
  E650  E1            		POP	HL
  E651  C9            		RET
  E652                	NCL2:
  E652  C5            		PUSH	BC
  E653  D5            		PUSH	DE
  E654  DDE5          		PUSH	IX
  E656  CD17E6        		CALL	WTFATX
  E659  38B8          		JR	C,POP_IX_DE_BC_HL_RET
  E65B  010000        	NCLPAT:	LD	BC,0
  E65E  ED43AAEC      		LD	(_FATDRV),BC
  E662  CD0FE8        		CALL	RDFATS
  E665  18A6          		JR	RDFATE2
                      	
  E667                	NCL3:
  E667  CB9A          		RES	3,D
  E669  6B            		LD	L,E
  E66A  62            		LD	H,D
  E66B  CB3C          		SRL	H	;
  E66D  CB1D          		RR	L	;HLA=HLA/2
  E66F  1F            		RRA		;
  E670  ED4B7CEC      		LD	BC,(_FATBF)
  E674  19            		ADD	HL,DE
  E675  09            		ADD	HL,BC
  E676  17            		RLA
  E677  C9            		RET
                      	
  E678                	GNCL:
  E678  CD36E6        		CALL	NCL1		;GET NEXT CLUSTER
  E67B  D8            		RET	C
  E67C  C5            		PUSH	BC
  E67D  E5            		PUSH	HL
  E67E  CD67E6        		CALL	NCL3
  E681  3809          		JR	C,GNC1
  E683  5E            		LD	E,(HL)
  E684  23            		INC	HL
  E685  7E            		LD	A,(HL)
  E686  E60F          		AND	00FH
  E688  57            		LD	D,A
  E689  E1            		POP	HL
  E68A  C1            		POP	BC
  E68B  C9            		RET
  E68C                	GNC1:
  E68C  7E            		LD	A,(HL)
  E68D  23            		INC	HL
  E68E  56            		LD	D,(HL)
  E68F  0604          		LD	B,4
  E691                	GNC1L:
  E691  CB3A          		SRL	D	;DA=DA/2
  E693  1F            		RRA		;
  E694  10FB          		DJNZ	GNC1L
                      	
  E696  5F            		LD	E,A
  E697  E1            		POP	HL
  E698  C1            		POP	BC
  E699  A7            		AND	A
  E69A  C9            		RET
                      	
  E69B                	SNCL:
  E69B  CD36E6        		CALL	NCL1
  E69E  D8            		RET	C
  E69F  3E01          		LD	A,1
  E6A1  32A2EC        		LD	(_WTFATF),A
                      	;				SET NEXT CLUSTER
  E6A4  E5            		PUSH	HL
  E6A5  C5            		PUSH	BC
  E6A6  D5            		PUSH	DE
  E6A7  E5            		PUSH	HL
  E6A8  CD67E6        		CALL	NCL3
  E6AB  D1            		POP	DE
                      	;CF=ODD
  E6AC  7E            		LD	A,(HL)
  E6AD  73            		LD	(HL),E
  E6AE  3806          		JR	C,SNC1
                      	;EVEN
                      	;M[0] = E
                      	;M[1] = (M[1] & 0xF0) | (D & 0x0F)
  E6B0  23            		INC	HL
  E6B1  ED67          		RRD		;M={A[3:0],E[3:0]}
  E6B3  7A            		LD	A,D
  E6B4  1804          		JR	SNC11
  E6B6                	SNC1:
                      	;ODD
                      	;HL[0] = (HL[0]&0x0F) | (E<<4)
                      	;HL[1] = DE>>4
  E6B6  ED6F          		RLD		;M={D[3:0],E[7:4]}
  E6B8  23            		INC	HL
  E6B9  72            		LD	(HL),D	;M={D[3:0],E[7:4]}
  E6BA                	SNC11:
  E6BA  ED6F          		RLD		;M={M[7:4],D[3:0]}
  E6BC  B7            		OR	A
  E6BD  D1            		POP	DE
  E6BE  C1            		POP	BC
  E6BF  E1            		POP	HL
  E6C0  C9            		RET
                      	
                      	
                      	;------------------------
                      	;次のセクタを探す際に「1クラスタの論理セクタ数」を掛けてまとめて扱う
                      	;in
                      	;	DE : セクタ番号
                      	;out
                      	;	DE : まとめた値
                      	;note
                      	;	「FAT12」最大12ビット + 「1クラスタの論理セクタ数」4ビットで計16ビットとして扱う
                      	;------------------------
  E6C1                	GNCLX:
  E6C1  7B            		LD	A,E
  E6C2  3C            		INC	A
  E6C3  E600          	NCPAT:	AND	0	;自己書き換え　1クラスタの論理セクタ数-1
  E6C5  2802          		JR	Z,GNCLX1
  E6C7  13            		INC	DE	;クラスタを跨がない場合は単純に+1する
  E6C8  C9            		RET
  E6C9                	GNCLX1:
  E6C9  CDDCE6        		CALL	DIVSPC	;クラスタを跨ぐ場合は
  E6CC  CD2BE8        		CALL	_GNCL	;次のクラスタを探す
                      	
                      	;------------------------
                      	;クラスタと「1クラスタの論理セクタ数」を掛ける
                      	;in
                      	;	DE : セクタ番号
                      	;out
                      	;	DE : 掛けられた値
                      	;note
                      	;	DE以外のレジスタとフラグは保持する
                      	;------------------------
  E6CF                	MULSPC:
  E6CF  F5            		PUSH	AF
  E6D0  EB            		EX	DE,HL
  E6D1  3E01          	SPCPAT:	LD	A,1		;自己書き換え（1クラスタの論理セクタ数）
  E6D3                	CLDBL:
  E6D3  0F            		RRCA			;->CF
  E6D4  3803          		JR	C,CLDBL_RET
  E6D6  29            		ADD	HL,HL		;*2
  E6D7  18FA          		JR	CLDBL
  E6D9                	CLDBL_RET:
  E6D9  EB            		EX	DE,HL
  E6DA                	POP_AF_RET
  E6DA  F1            		POP	AF
  E6DB  C9            		RET
                      	
                      	;------------------------
                      	;「1クラスタの論理セクタ数」を割って論理セクタだけに戻す
                      	;in
                      	;	DE : 掛けられた値
                      	;out
                      	;	DE : セクタ番号
                      	;note
                      	;	DE以外のレジスタとフラグは保持する
                      	;------------------------
  E6DC                	DIVSPC:
  E6DC  F5            		PUSH	AF
  E6DD  3AD2E6        		LD	A,(SPCPAT+1)	;1クラスタの論理セクタ
  E6E0                	CLDIV1:
  E6E0  0F            		RRCA			;->CF
  E6E1  38F7          		JR	C,POP_AF_RET
  E6E3  CB3A          		SRL	D		;DE=DE/2
  E6E5  CB1B          		RR	E		;
  E6E7  18F7          		JR	CLDIV1
                      	
  E6E9                	RDFAT0X:
  E6E9  CD0FE8        		CALL	RDFATS
  E6EC  D8            		RET	C
  E6ED  DDBE01        		CP	(IX+1)		;DPB_01_FATID
  E6F0  C8            		RET	Z
  E6F1  37            		SCF
  E6F2  C9            		RET
                      	
  E6F3                	RDFAT:
  E6F3  3A88EC        		LD	A,(_DRV)
  E6F6  CD46E9        		CALL	CHGDRVR
  E6F9  D8            		RET	C
  E6FA  DD7E12        		LD	A,(IX+012H)	;DPB_12_DEVNO
  E6FD  FE87          		CP	087H
  E6FF  20E8          		JR	NZ,RDFAT0X
                      	
  E701  3E7F          		LD	A,07FH
  E703  32F3EB        		LD	(CHECK),A	;A=07FH
  E706  DDCB0A46      		BIT	0,(IX+00AH)	;DPB_0A_FDMODE
  E70A  284D          		JR	Z,X2HX
  E70C                	E2DX:
  E70C  2140EB        		LD	HL,M2D
  E70F  CDDCE7        		CALL	DRDF
  E712  383D          		JR	C,E2HX
  E714  FEFD          		CP	0FDH		;2D
  E716  C8            		RET	Z
  E717  FEF9          		CP	0F9H		;2DD9
  E719  CAC3E7        		JP	Z,E2DD9
  E71C  FEFB          		CP	0FBH		;2DD8
  E71E  37            		SCF
  E71F  C0            		RET	NZ		;NOT 2DD
  E720  214EEB        		LD	HL,M2DD8
  E723                	CHGTYPE:
  E723  D5            		PUSH	DE
  E724  CD36E7        		CALL	CHGDV
  E727  3A84EC        		LD	A,(_DRIVE)
  E72A  E603          		AND	3
  E72C  F680          		OR	080H
  E72E  6F            		LD	L,A
  E72F  26EC          		LD	H,_CYL0/256
  E731  3EFF          		LD	A,0FFH
  E733  77            		LD	(HL),A
  E734  D1            		POP	DE
  E735  C9            		RET
                      	
  E736                	CHGDV:
  E736  DDE5          		PUSH	IX
  E738  D1            		POP	DE
  E739  EDA0          		LDI
  E73B  EDA0          		LDI
  E73D  13            		INC	DE
  E73E  13            		INC	DE
  E73F  13            		INC	DE
  E740  13            		INC	DE
  E741  010C00        		LD	BC,12
  E744  EDB0          		LDIR
  E746                	CHGDV2:
  E746  3EFF          		LD	A,0FFH
  E748  3289EC        		LD	(_DSK),A
  E74B  3A88EC        		LD	A,(_DRV)
  E74E  C3D9EC        		JP	_CHGDRV
                      	
  E751                	E2HX:
  E751  3C            		INC	A
  E752  C8            		RET	Z
  E753  21F3EB        		LD	HL,CHECK
  E756  CB06          		RLC	(HL)
  E758  D8            		RET	C
  E759                	X2HX:
  E759  2178EB        		LD	HL,M2HD
  E75C  110000        		LD	DE,0
  E75F  CDE0E7        		CALL	DRDD
  E762  300A          		JR	NC,X2HX1
  E764  3C            		INC	A
  E765  C8            		RET	Z
  E766  21F3EB        		LD	HL,CHECK
  E769  CB06          		RLC	(HL)
  E76B  D8            		RET	C
  E76C  189E          		JR	E2DX
  E76E                	X2HX1:
  E76E  23            		INC	HL
  E76F  7E            		LD	A,(HL)
  E770  06FE          		LD	B,0FEH
  E772  FE0C          		CP	00CH
  E774  2838          		JR	Z,X2HDE
  E776  06F8          		LD	B,0F8H
  E778  D620          		SUB	020H		;020H
  E77A  2832          		JR	Z,X2HDE
  E77C  3C            		INC	A		;01FH
  E77D  282F          		JR	Z,X2HDE
  E77F  3C            		INC	A		;01EH
  E780  206C          		JR	NZ,C2HX		;2HD/2HC/2HQ
  E782                	X2HS:
  E782  21A2EB        		LD	HL,M2HS
  E785  CDB4E7        		CALL	X2HSS
  E788  D8            		RET	C
  E789  2A7CEC        		LD	HL,(_FATBF)
  E78C  23            		INC	HL
  E78D  7E            		LD	A,(HL)		;FATBF+1
  E78E  FE50          		CP	80
  E790  3F            		CCF
  E791  D0            		RET	NC
  E792  FE5A          		CP	90
  E794  D0            		RET	NC
  E795  DD770C        		LD	(IX+00CH),A	;DPB_0C_MAXCYL
  E798  D650          		SUB	80
  E79A  87            		ADD	A,A	;*2
  E79B  4F            		LD	C,A
  E79C  87            		ADD	A,A	;*4
  E79D  87            		ADD	A,A	;*8
  E79E  87            		ADD	A,A	;*16
  E79F  81            		ADD	A,C	;*18
  E7A0  C698          		ADD	A,098H
  E7A2  DD7708        		LD	(IX+8),A	;DPB_08_MAXCL_LOW
  E7A5  3E05          		LD	A,5
  E7A7  CE00          		ADC	A,0
  E7A9  DD7709        		LD	(IX+9),A	;DPB_08_MAXCL_HIGH
  E7AC  1898          		JR	CHGDV2
  E7AE                	X2HDE:
  E7AE  2194EB        		LD	HL,M2HDE
  E7B1  23            		INC	HL
  E7B2  70            		LD	(HL),B
  E7B3  2B            		DEC	HL
  E7B4                	X2HSS:
  E7B4  CDDCE7        		CALL	DRDF
  E7B7  D8            		RET	C
  E7B8  DDBE01        		CP	(IX+1)		;DPB_01_FATID
  E7BB  37            		SCF
  E7BC  C0            		RET	NZ
  E7BD  CDCCE7        		CALL	INCDRD
  E7C0  300E          		JR	NC,DRD_DPB
  E7C2  C9            		RET
                      	
  E7C3                	E2DD9:
  E7C3  215CEB        		LD	HL,M2DD
  E7C6  CD23E7        		CALL	CHGTYPE
  E7C9  2A7CEC        		LD	HL,(_FATBF)
  E7CC                	INCDRD:
  E7CC  24            		INC	H
  E7CD  24            		INC	H
  E7CE  24            		INC	H
  E7CF  24            		INC	H
  E7D0                	DRD_DPB:
  E7D0  DDE5          		PUSH	IX
  E7D2  DD2AA8EC      		LD	IX,(_DPB)
  E7D6  CD56EA        	DRDPAT:	CALL	FDRD		;自己書き換え（ディスク読み込み）
  E7D9                	POP_IX_RET:
  E7D9  DDE1          		POP	IX
  E7DB  C9            		RET
                      	
  E7DC                	DRDF:
  E7DC  ED5BFAEB      		LD	DE,(_FATPS)
  E7E0                	DRDD:
  E7E0  CD23E7        		CALL	CHGTYPE
  E7E3  2A7CEC        		LD	HL,(_FATBF)
  E7E6  E5            		PUSH	HL
  E7E7  CDD0E7        		CALL	DRD_DPB
  E7EA  E1            		POP	HL
  E7EB  D8            		RET	C
  E7EC  7E            		LD	A,(HL)
  E7ED  C9            		RET
                      	
  E7EE                	C2HX:
  E7EE  CD0FE8        		CALL	RDFATS
  E7F1  D8            		RET	C
  E7F2  FEFE          		CP	0FEH	;2HD
  E7F4  C8            		RET	Z
  E7F5  2186EB        		LD	HL,M2HQ
  E7F8  FEF0          		CP	0F0H
  E7FA  2807          		JR	Z,X2HQ
  E7FC  FEF9          		CP	0F9H
  E7FE  37            		SCF
  E7FF  C0            		RET	NZ
  E800  216AEB        		LD	HL,M2HC
  E803                	X2HQ:
  E803  CD23E7        		CALL	CHGTYPE
  E806  CD57E8        		CALL	FATS2
  E809  24            		INC	H	;先頭の1セクタはすでに読み込まれているのでスキップ
  E80A  24            		INC	H
  E80B  05            		DEC	B
  E80C  13            		INC	DE
  E80D  1804          		JR	RDFATL
  E80F                	RDFATS:
  E80F  CD50E8        		CALL	FATS
  E812  D8            		RET	C
  E813                	RDFATL:
  E813  C5            		PUSH	BC
  E814  CDD0E7        		CALL	DRD_DPB
  E817  C1            		POP	BC
  E818  D8            		RET	C
  E819  10F8          		DJNZ	RDFATL
  E81B  2A7CEC        		LD	HL,(_FATBF)
  E81E  7E            		LD	A,(HL)
  E81F  C9            		RET
                      	
  E820                	DWT_DPB:
  E820  DDE5          		PUSH	IX
  E822  DD2AA8EC      		LD	IX,(_DPB)
  E826  CD4DEA        	DWTPAT:	CALL	FDWT		;自己書き換え（ディスク書き込み）
  E829  18AE          		JR	POP_IX_RET
                      	
  E82B                	_GNCL:
  E82B  C378E6        	GNCPAT:	JP	GNCL		;自己書き換え
                      	
  E82E                	_SNCL:
  E82E  C39BE6        	SNCPAT:	JP	SNCL		;自己書き換え
                      	
  E831                	WTFAT:
  E831  CD50E8        		CALL	FATS
  E834  D447E8        		CALL	NC,WTFATL
  E837  D8            		RET	C
  E838  DDCB0F7E      		BIT	7,(IX+00FH)	;DPB_0F_BPS
  E83C  C8            		RET	Z		;予備FATが無い
  E83D  CD57E8        		CALL	FATS2
  E840  DD7E00        		LD	A,(IX+0)	;DPB_00_FATLN
  E843                	WTFAT2:
  E843  13            		INC	DE
  E844  3D            		DEC	A
  E845  20FC          		JR	NZ,WTFAT2
  E847                	WTFATL:
  E847  C5            		PUSH	BC
  E848  CD20E8        		CALL	DWT_DPB
  E84B  C1            		POP	BC
  E84C  D8            		RET	C
  E84D  10F8          		DJNZ	WTFATL
  E84F  C9            		RET
                      	;------------------------
                      	;FATのセットアップ
                      	;out
                      	;	B  : FATセクタ数
                      	;	DE : FAT先頭セクタ番号
                      	;	HL : FATバッファポインタ
                      	;	CF : 1=ドライブ切り替えエラー
                      	;note
                      	;	FATサイズがFATバッファを超える場合は
                      	;	対象クラスタ領域==(_FATIX)によって
                      	;	FATの前半3KBと後半3KBを切り替える
                      	;------------------------
  E850                	FATS:
  E850  3AAAEC        		LD	A,(_FATDRV)
  E853  CD46E9        		CALL	CHGDRVR		;ドライブ切り替え
  E856  D8            		RET	C
  E857                	FATS2:
  E857  ED5BFAEB      		LD	DE,(_FATPS)	;fat sector pos
  E85B  2A7CEC        		LD	HL,(_FATBF)
  E85E  C361E8        	FATSX:	JP	FATS_FAT12	;自己書き換え
                      	
  E861                	FATS_FAT12:
  E861  DD460F        		LD	B,(IX+00FH)	;DPB_0F_BPS
  E864  3E0C          		LD	A,12		;3072 / 256 FATバッファに読み込めるセクタ数
  E866                	L_FATS2:
  E866  CB18          		RR	B		;->CF
  E868  3803          		JR	C,E_FATS2
  E86A  1F            		RRA			;CF=0 なので A=A/2
  E86B  18F9          		JR	L_FATS2
  E86D                	E_FATS2:
  E86D  DD4600        		LD	B,(IX+0)	;DPB_00_FATLN
  E870  B8            		CP	B
  E871  D0            		RET	NC		;DPB_00_FATLN x sectorSize < fatBufSize
                      	;targetCluster
  E872  4F            		LD	C,A		;C = skipCount
  E873  3AABEC        		LD	A,(_FATIX)	;(targetCluster >= 0x800)
  E876  B7            		OR	A
  E877  2806          		JR	Z,FATS3
                      	;(targerCluster>=0x800)
  E879                	FAT_SKP:
  E879  13            		INC	DE		;FATPS++
  E87A  05            		DEC	B		;FATSIZE--
  E87B  0D            		DEC	C		;skipCnt--
  E87C  20FB          		JR	NZ,FAT_SKP
  E87E  48            		LD	C,B
  E87F                	FATS3:
  E87F  41            		LD	B,C		;3 or 6 or 12
  E880  AF            		XOR	A
  E881  C9            		RET
                      	
  E882                	CHGDRV:
  E882  E67F          		AND	07FH
  E884  E5            		PUSH	HL
  E885  2189EC        		LD	HL,_DSK
  E888  BE            		CP	(HL)
  E889  280A          		JR	Z,CHGDRVE
  E88B                	CHGDRV1:
  E88B  DDE5          		PUSH	IX
  E88D  CD97E8        		CALL	CHGDRV0
  E890  3A89EC        		LD	A,(_DSK)
  E893  DDE1          		POP	IX
  E895                	CHGDRVE:
  E895  E1            		POP	HL
  E896  C9            		RET
                      	
  E897                	CHGDRV0:
  E897  6F            		LD	L,A
  E898  CDDCEC        		CALL	_GETDPB
  E89B  D8            		RET	C
                      	
  E89C  DD22A8EC      		LD	(_DPB),IX
  E8A0  7D            		LD	A,L
  E8A1  3289EC        		LD	(_DSK),A
                      	
  E8A4  F3            		DI
  E8A5  ED7338E9      		LD	(SPPAT2+1),SP
                      	
  E8A9  DDF9          		LD	SP,IX
                      	
  E8AB  E1            		POP	HL		;L=DPB_00_FATLN H=DPB_01_FATID
  E8AC  E1            		POP	HL		;DPB_02_DRD
  E8AD  22D7E7        		LD	(DRDPAT+1),HL
                      	
  E8B0  E1            		POP	HL
  E8B1  2227E8        		LD	(DWTPAT+1),HL	;DPB_04_DWT
                      	
  E8B4  E1            		POP	HL		;L=DPB_06_ADDCL H=DPB_07_SECPCL
  E8B5  7D            		LD	A,L
  E8B6  32CADF        		LD	(CLSPAT+1),A
  E8B9  7C            		LD	A,H
  E8BA  32D2E6        		LD	(SPCPAT+1),A	;1クラスタの論理セクタ数
  E8BD  3D            		DEC	A
  E8BE  32C4E6        		LD	(NCPAT+1),A
                      	
  E8C1  E1            		POP	HL		;DPB_08_MAXCL
  E8C2  7D            		LD	A,L
  E8C3  32D7DF        		LD	(CLPAT2+1),A
  E8C6  7C            		LD	A,H
  E8C7  32D3DF        		LD	(CLPAT1+1),A
  E8CA  2B            		DEC	HL
  E8CB  22E6E1        		LD	(MAXCLP+1),HL
                      	
  E8CE  E1            		POP	HL		;L=DPB_0A_FDMODE H=DPB_0B_MAXDIR
  E8CF  7D            		LD	A,L
  E8D0  F6FE          		OR	0FEH
  E8D2  32F8E9        		LD	(FDMODE+1),A
  E8D5  07            		RLCA
  E8D6  E603          		AND	3
  E8D8  32E0E9        		LD	(FSPAT+1),A
  E8DB  7C            		LD	A,H
  E8DC  3276DE        		LD	(RTEPAT+1),A	;DPB_0B_MAXDIR
                      	
  E8DF  E1            		POP	HL		;L=DPB_0C_MAXCYL H=DPB_0D_MAXSEC
  E8E0  7D            		LD	A,L
  E8E1  32A1EC        		LD	(_MAXCYL),A
  E8E4  7C            		LD	A,H
  E8E5  3288E9        		LD	(MAXSEC+1),A
                      	
  E8E8  E1            		POP	HL		;L=DPB_0E_FATPS H=DPB_0F_BPS
  E8E9  7C            		LD	A,H		;DPB_0F_BPS
  E8EA  E607          		AND	7
  E8EC  3219E5        		LD	(SECSZ+2),A	;1セクタのサイズの上位1バイト 0x400 - 0x200 - 0x100
  E8EF  3D            		DEC	A		;1セクタ512 2D/2DD/2HC/2HQ(2HD1.44MB)等
                      					;1セクタ1024 2HD/EMM/BRAM
                      					;1セクタ256 GRAM等
                      					;1024	512	256
  E8F0  32FCDE        		LD	(SECSZM1+2),A	;3	1	0	1セクタのサイズ-1したものの上位1バイト (0x3FF - 0x1FF - 0xFF)
  E8F3  3C            		INC	A		;4	2	1
  E8F4  87            		ADD	A,A		;8	4	2
  E8F5  87            		ADD	A,A		;010H	8	4
  E8F6  87            		ADD	A,A		;020H	010H	8
  E8F7  325BDE        		LD	(SDECPAT+1),A	;1セクタ辺りのディレクトリエントリ数
  E8FA  3D            		DEC	A		;01FH	00FH	7
  E8FB  329CD4        		LD	(SDECM1+1),A	;1セクタ辺りのディレクトリエントリ数-1
                      	
  E8FE  2600          		LD	H,0
  E900  22FAEB        		LD	(_FATPS),HL
                      	
  E903  E1            		POP	HL		;L=DPB_10_DIRPS H=DPB_11_MINSEC
  E904  7C            		LD	A,H
  E905  3295E9        		LD	(SECPAT+1),A
  E908  2600          		LD	H,0
  E90A  22FCEB        		LD	(_DIRPS),HL
                      	
  E90D  E1            		POP	HL		;L=DPB_12_DEVNO H=DPB_13_UNITNO
  E90E  7C            		LD	A,H
  E90F  3284EC        		LD	(_DRIVE),A
                      	
  E912  E1            		POP	HL		;DPB_14_EXTRA
  E913  7C            		LD	A,H
  E914  B5            		OR	L
  E915  2011          		JR	NZ,EXTRA
  E917  2178E6        		LD	HL,GNCL		;FAT12(default)
  E91A  222CE8        		LD	(GNCPAT+1),HL
  E91D  219BE6        		LD	HL,SNCL
  E920  222FE8        		LD	(SNCPAT+1),HL
  E923  2161E8        		LD	HL,FATS_FAT12
  E926  180C          		JR	EXTRA1
  E928                	EXTRA:
  E928  222CE8        		LD	(GNCPAT+1),HL
  E92B  23            		INC	HL
  E92C  23            		INC	HL
  E92D  23            		INC	HL
  E92E  222FE8        		LD	(SNCPAT+1),HL
  E931  23            		INC	HL
  E932  23            		INC	HL
  E933  23            		INC	HL
  E934                	EXTRA1:
  E934  225FE8        		LD	(FATSX+1),HL
                      	
  E937  310000        	SPPAT2:	LD	SP,0		;元のSPを復元
  E93A  FB            		EI
  E93B  AF            		XOR	A
  E93C  C9            		RET
                      	
  E93D                	GETDPBD:
  E93D  DDE3          		EX	(SP),IX
  E93F  DDE5          		PUSH	IX
  E941  3A88EC        		LD	A,(_DRV)
  E944  1807          		JR	GETDPB1
                      	
  E946                	CHGDRVR:
  E946  CDD9EC        		CALL	_CHGDRV
  E949  D8            		RET	C
  E94A  3A89EC        		LD	A,(_DSK)
  E94D                	GETDPB1:
  E94D  C3DCEC        		JP	_GETDPB
                      	
  E950                	GETDPB:
  E950  FE08          		CP	8
  E952  3F            		CCF
  E953  D8            		RET	C
  E954  87            		ADD	A,A	;*2
  E955  87            		ADD	A,A	;*4
  E956  87            		ADD	A,A	;*8
  E957  87            		ADD	A,A	;*16
  E958  87            		ADD	A,A	;*32
                      	;	LD	IXL,A		;OHM-Z80固有マクロ
  E959  DD            		DB	0DDH		;Z80未定義命令
  E95A  6F            		LD	L,A		;
                      	;	LD	IXH,DEVICE/256	;OHM-Z80固有マクロ
  E95B  DD            		DB	0DDH		;Z80未定義命令
  E95C  26ED          		LD	H,DEVICE/256	;
  E95E  DD7E00        		LD	A,(IX+0)	;DPB_00_FATLN
  E961  FE01          		CP	001H		;A=0 THEN CF=1
  E963  C9            		RET
                      	
  E964                	FFLUSH:
  E964  F5            		PUSH	AF
  E965  3EFF          		LD	A,0FFH
  E967  32ABE2        		LD	(SFILE),A
  E96A  CDCFE5        		CALL	DWTX
  E96D  3EFF          		LD	A,0FFH
  E96F  32A5EC        		LD	(_DBDRV),A
  E972  CD17E6        		CALL	WTFATX
  E975  AF            		XOR	A
  E976  32ABEC        		LD	(_FATIX),A
  E979  2F            		CPL
  E97A  32AAEC        		LD	(_FATDRV),A
  E97D  F1            		POP	AF
  E97E  C9            		RET
                      	
                      	
                      	;LDDISK.ASM
                      	
                      	;	LSX-Dodgers DISK
                      	
                      	
  E97F                	SEEK:
  E97F  7A            		LD	A,D
  E980  B3            		OR	E
  E981  3E01          		LD	A,001H
  E983  2812          		JR	Z,DIV3
                      	
  E985  0610          		LD	B,16
  E987  0E00          	MAXSEC:	LD	C,000H
  E989  AF            		XOR	A
  E98A  EB            		EX	DE,HL
  E98B                	DIV1:
  E98B  29            		ADD	HL,HL
  E98C  8F            		ADC	A,A
  E98D  B9            		CP	C
  E98E  3802          		JR	C,DIV2
  E990  91            		SUB	C
  E991  2C            		INC	L
  E992                	DIV2:
  E992  10F7          		DJNZ	DIV1
                      	
  E994  C601          	SECPAT:	ADD	A,001H		;(Self-rewriting)
  E996  55            		LD	D,L	;Quotient(TRACK)
  E997                	DIV3:
  E997  5F            		LD	E,A	;Remainder
  E998  CB3A          		SRL	D	;CYLINDER
  E99A  9F            		SBC	A,A
  E99B  E610          		AND	010H	;SIDE
  E99D  4F            		LD	C,A
                      	
  E99E  3A84EC        		LD	A,(_DRIVE)
  E9A1  FE04          		CP	4
  E9A3  3F            		CCF
  E9A4  D8            		RET	C
  E9A5  B1            		OR	C
  E9A6  3224EA        		LD	(MOPAT+1),A	;Motor off data
  E9A9  01FC0F        		LD	BC,00FFCH
  E9AC  F680          		OR	080H		;Mortor on
  E9AE  ED79          		OUT	(C),A
                      	
  E9B0  CDF6E9        		CALL	SETMODE
  E9B3  D8            		RET	C
                      	
  E9B4  CD39EA        		CALL	DRIVE
  E9B7  FEFF          		CP	0FFH		;A=0FFH Unknown CYLINDER
  E9B9  CC18EA        		CALL	Z,FDCRES	;Restore
  E9BC  0EF9          		LD	C,0F9H
  E9BE  ED79          		OUT	(C),A		;Currrent CYLINDER
  E9C0  92            		SUB	D
  E9C1  C8            		RET	Z		;No seek
                      	
  E9C2  3A86EC        		LD	A,(_ISEEK)
  E9C5  4F            		LD	C,A
                      	
  E9C6  3AA1EC        		LD	A,(_MAXCYL)	;Max CYLINDER
  E9C9  3D            		DEC	A
  E9CA  BA            		CP	D		;Over CYLINDER
  E9CB  D8            		RET	C
                      	
  E9CC  B9            		CP	C		;for Built-in 2DD
  E9CD  3803          		JR	C,SETM2
  E9CF  78            		LD	A,B		;B=00FH
  E9D0  DBFE          		IN	A,(0FEH)		;2HD mode for 2DD seek
  E9D2                	SETM2:
  E9D2  78            		LD	A,B
  E9D3  DBFD          		IN	A,(0FDH)		;MFM mode
                      	
  E9D5  0EFB          		LD	C,0FBH
  E9D7  ED51          		OUT	(C),D
  E9D9  72            		LD	(HL),D
  E9DA  0E18          		LD	C,018H		;Seek
  E9DC                	FDCCMD2:
  E9DC  3A85EC        		LD	A,(_SEEKSP)
  E9DF  E6FF          	FSPAT:	AND	0FFH
  E9E1  B1            		OR	C
                      	
  E9E2                	FDCCMD:
  E9E2  CD2FEA        		CALL	COMSET
                      	
  E9E5  3E80          	FDCPAT:	LD	A,080H		;FDC COMMAND(Self-rewriting)
  E9E7  E620          		AND	020H		;Write data Write track
  E9E9  3C            		INC	A
                      	
  E9EA                	SST:
  E9EA  0E00          		LD	C,0
  E9EC                	SST1:
  E9EC  0D            		DEC	C		; 4
  E9ED  20FD          		JR	NZ,SST1		;12 * 256 / 4 = About 1ms
  E9EF  3D            		DEC	A
  E9F0  20FA          		JR	NZ,SST1
                      	
  E9F2  3C            		INC	A		;A=1
  E9F3  CD01EA        		CALL	READY
  E9F6                	SETMODE:
  E9F6  78            		LD	A,B		;B=00FH
  E9F7  DBFF          	FDMODE:	IN	A,(0FFH)		;Floppy mode(2D/2HD) (Self-rewriting)
                      	
  E9F9  78            		LD	A,B
  E9FA  DBFD          		IN	A,(0FDH)		;MFM mode
                      	
  E9FC  CD33EA        		CALL	DELAY0		;Head select time
  E9FF  3E81          		LD	A,081H
  EA01                	READY:
  EA01  320BEA        		LD	(WAITA+1),A
  EA04  E5            		PUSH	HL
  EA05  0EF8          		LD	C,0F8H
  EA07  61            		LD	H,C
  EA08                	READY2:
  EA08  ED78          		IN	A,(C)
  EA0A  E681          	WAITA:	AND	081H		;NOT READY,BUSY
  EA0C  2808          		JR	Z,READYE
  EA0E  E3            		EX	(SP),HL		;wait 19clock
  EA0F  E3            		EX	(SP),HL		; //
  EA10  2B            		DEC	HL
  EA11  7C            		LD	A,H
  EA12  B5            		OR	L
  EA13  20F3          		JR	NZ,READY2
  EA15  37            		SCF
  EA16                	READYE:
  EA16  E1            		POP	HL
  EA17  C9            		RET
                      	
  EA18                	FDCRES:
  EA18  3600          		LD	(HL),0
  EA1A  0E08          		LD	C,8
  EA1C  18BE          		JR	FDCCMD2
                      	
  EA1E                	FDMOFF:
  EA1E  F5            		PUSH	AF
  EA1F  C5            		PUSH	BC
  EA20  01FC0F        		LD	BC,00FFCH	;Motor off
  EA23  3E00          	MOPAT:	LD	A,000H		;(Self-rewriting)
  EA25  ED79          		OUT	(C),A
  EA27  C1            		POP	BC
  EA28  F1            		POP	AF
  EA29  C9            		RET
                      	
  EA2A                	SECSET:
  EA2A  01FA0F        		LD	BC,00FFAH
  EA2D  ED59          		OUT	(C),E
  EA2F                	COMSET:
  EA2F  0EF8          		LD	C,0F8H
  EA31  ED79          		OUT	(C),A
  EA33                	DELAY0:
  EA33  3E1A          		LD	A,26
  EA35                	DELAY:
  EA35  3D            		DEC	A
  EA36  20FD          		JR	NZ,DELAY
  EA38  C9            		RET
                      	
  EA39                	DRIVE:
  EA39  2A84EC        		LD	HL,(_DRIVE)
  EA3C  26EC          		LD	H,_CYL0/256
  EA3E  CBFD          		SET	7,L
  EA40  7E            		LD	A,(HL)
  EA41  C9            		RET
                      	
  EA42                	RNF:
  EA42  CD39EA        		CALL	DRIVE
  EA45  36FF          		LD	(HL),0FFH
  EA47  C9            		RET
                      	
  EA48  02            	RETRY:	DB	2
                      	
                      	
                      	;	FLOPPY DISK DRIVER(DMA)
                      	
                      	
  EA49                	WTTRK:
  EA49  3EF4          		LD	A,0F4H
  EA4B  1802          		JR	WTTRK1
  EA4D                	FDWT:
  EA4D  3EA0          		LD	A,0A0H
  EA4F                	WTTRK1:
  EA4F  32E6E9        		LD	(FDCPAT+1),A
  EA52  3E10          		LD	A,16
  EA54  1807          		JR	DISK
                      	
  EA56                	FDRD:
  EA56  3E80          		LD	A,080H
  EA58  32E6E9        		LD	(FDCPAT+1),A
  EA5B  3E0E          		LD	A,14
                      	
  EA5D                	DISK:
  EA5D  3270EA        		LD	(DMAPAT+1),A
                      	
  EA60  22FBEA        		LD	(DMAD+11),HL
  EA63                	DISKR:
  EA63  3E02          		LD	A,2		;Retry count
  EA65  3248EA        		LD	(RETRY),A
  EA68                	DISK2:
  EA68  D5            		PUSH	DE
  EA69  CD7FE9        		CALL	SEEK
  EA6C  3842          		JR	C,ERRF
  EA6E  F3            		DI
                      	
  EA6F  3E0E          	DMAPAT:	LD	A,14		;自己書き換え
  EA71  21F0EA        		LD	HL,DMAD
  EA74  CDE6EA        		CALL	SETDMA
  EA77  ED49          		OUT	(C),C		;OUT 01F87H,087H
  EA79  3AE6E9        		LD	A,(FDCPAT+1)
  EA7C  C5            		PUSH	BC
  EA7D  CD2AEA        		CALL	SECSET
  EA80  2AFBEA        		LD	HL,(DMAD+11)
  EA83  23            		INC	HL
  EA84  1106BB        		LD	DE,0BB06H	;READ DMA
                      	
  EA87  3E03          		LD	A,3
  EA89  CD01EA        		CALL	READY
  EA8C  ED78          		IN	A,(C)
                      	
  EA8E  C1            		POP	BC
  EA8F  ED51          		OUT	(C),D
  EA91  ED59          		OUT	(C),E
  EA93  ED58          		IN	E,(C)
  EA95  ED50          		IN	D,(C)
  EA97  19            		ADD	HL,DE
  EA98  D1            		POP	DE
  EA99  13            		INC	DE
  EA9A  FB            		EI
  EA9B  CD1EEA        		CALL	FDMOFF
  EA9E  B7            		OR	A
  EA9F  C8            		RET	Z
  EAA0  1B            		DEC	DE
  EAA1  CB67          		BIT	4,A
  EAA3  C442EA        		CALL	NZ,RNF
  EAA6                	DISKE2:
  EAA6  2148EA        		LD	HL,RETRY
  EAA9  35            		DEC	(HL)
  EAAA  20BC          		JR	NZ,DISK2
  EAAC  B7            		OR	A
  EAAD  2834          		JR	Z,ERR
  EAAF  D5            		PUSH	DE
  EAB0                	ERRF:
  EAB0  D1            		POP	DE
  EAB1                	DELP:
  EAB1  CD42EA        		CALL	RNF
  EAB4  CD1EEA        		CALL	FDMOFF
  EAB7  3A85EC        		LD	A,(_SEEKSP)
  EABA  87            		ADD	A,A
  EABB  9F            		SBC	A,A
  EABC  3825          		JR	C,ERR
  EABE                	DELP1:
  EABE  D5            		PUSH	DE
  EABF  21B0EB        		LD	HL,DEMES
  EAC2  CDBDD8        		CALL	MSX
  EAC5  CDA2D7        		CALL	KEYBC
  EAC8                	DELP2:
  EAC8  CDCAEC        		CALL	_INKEY
  EACB  28FB          		JR	Z,DELP2
                      	
  EACD  D1            		POP	DE
  EACE  CDE2DF        		CALL	CAP
  EAD1  FE52          		CP	'R'		;Retry
  EAD3  CA63EA        		JP	Z,DISKR
  EAD6  FE49          		CP	'I'		;Ignore
  EAD8  2807          		JR	Z,IGNORE
  EADA  FE41          		CP	'A'		;Abort
  EADC  20E0          		JR	NZ,DELP1
  EADE  C3A6D3        		JP	BOOT
  EAE1                	IGNORE:
  EAE1  3EFF          		LD	A,0FFH
  EAE3                	ERR:
  EAE3  BF            		CP	A
  EAE4  37            		SCF
  EAE5  C9            		RET
                      	
  EAE6                	SETDMA:
  EAE6  01871F        		LD	BC,01F87H
  EAE9                	SDMA:
  EAE9  04            		INC	B
  EAEA  EDA3          		OUTI
  EAEC  3D            		DEC	A
  EAED  20FA          		JR	NZ,SDMA
  EAEF  C9            		RET
                      	
  EAF0  C37DFB0FFFFF2C	DMAD:	DB	0C3H,07DH,0FBH,00FH,0FFH,0FFH,02CH,010H		;X1turbo
  EAF8  80928D0000CF01		DB	080H,092H,08DH,000H,000H,0CFH,001H,0CFH		;DISK DMA
                      	
  EB00                	DMAE:
                      	
  1F89                	AT_R	EQU	WTTRK-AT_WTTRK
                      	
                      	;LDCALL.ASM
                      	
                      	;	LSX-Dodgers TABLES
                      	;	CTRLTB:アドレス下位1バイトが0になるように
                      	
  EB00                	CTRLTB:
  EB00  EAD985DA22DA75		DW	PRINTE,CTRL01,CTRL02,CTRL03
  EB08  6FDB4DDA4EDBD5		DW	CTRL04,CTRL05,CTRL1A,CTRL07
  EB10  F6D913DA78DB8B		DW	CTRL08,CTRL09,CTRL0A,CTRL0B
  EB18  4BDB71DA8DDBEA		DW	CTRL0C,CTRL0D,CTRL0E,PRINTE
  EB20  EAD9EAD985DAEA		DW	PRINTE,PRINTE,CTRL01,PRINTE
  EB28  EAD9EAD9EAD9EA		DW	PRINTE,PRINTE,PRINTE,PRINTE
  EB30  EAD9EAD94EDB98		DW	PRINTE,PRINTE,CTRL1A,CTRL1B
  EB38  0DDAF6D900DA78		DW	CTRL1C,CTRL1D,CTRL1E,CTRL1F
                      	
  EB40                	M2D:
  EB40  02FD0802      		DB	2,0FDH,8,2
  EB44  6401          		DW	356
  EB46  FF0C2809018205		DB	0FFH,12,40,9,1,082H,5,1
                      	
  EB4E                	M2DD8:
  EB4E  02FB0802      		DB	2,0FBH,8,2
  EB52  7C02          		DW	636
  EB54  FF0C5008018205		DB	0FFH,12,80,8,1,082H,5,1
                      	
  EB5C                	M2DD:
  EB5C  03F90A02      		DB	3,0F9H,10,2
  EB60  CB02          		DW	715
  EB62  FF0E5009018207		DB	0FFH,14,80,9,1,082H,7,1
                      	
  EB6A                	M2HC:
  EB6A  07F91B01      		DB	7,0F9H,27,1
  EB6E  4509          		DW	2373
  EB70  FE1D500F01820F		DB	0FEH,29,80,15,1,082H,15,1
                      	
  EB78                	M2HD:
  EB78  02FE0901      		DB	2,0FEH,9,1
  EB7C  C704          		DW	1223
  EB7E  FE0B4D08018405		DB	0FEH,11,77,8,1,084H,5,1
                      	
  EB86                	M2HQ:
  EB86  09F01F01      		DB	9,0F0H,31,1
  EB8A  210B          		DW	2849
  EB8C  FE215012018213		DB	0FEH,33,80,18,1,082H,19,1
                      	
  EB94                	M2HDE:
  EB94  03FE0B01      		DB	3,0FEH,11,1
  EB98  9505          		DW	1429
  EB9A  FE0D5009018407		DB	0FEH,13,80,9,1,084H,7,1
                      	
  EBA2                	M2HS:
  EBA2  03FB0801      		DB	3,0FBH,8,1
  EBA6  9805          		DW	1432
  EBA8  FE0A5009010404		DB	0FEH,10,80,9,1,4,4,10
                      	
  EBB0  0307          	DEMES:	DB	3,7
  EBB2  44657669636520		DB	"Device I/O Error",5,3
  EBC4  41626F72742052		DB	"Abort Retry Ignore?",5,3,0
                      	
  EBDA  1617          	SDDATA:	DB	22,23		;(FCB)ファイルを最後に変更した時刻
  EBDC  1415          		DB	20,21		;(FCB)ファイルを最後に変更した日付
  EBDE  1A1B          		DB	26,27		;(FCB)ファイルの先頭クラスタ
  EBE0  10111213      		DB	16,17,18,19	;(FCB)ファイルのサイズ(バイト単位)
  EBE4                	SDDATAE:
                      	
  EBE4  008E01000B000C	BEEPD:	DB	0,08EH,1,0,00BH,0,00CH,010H
  EBEC  073E08100D00FF		DB	007H,03EH,008H,010H,00DH,0,0FFH
                      	
  EBF3  00            	CHECK:	DB	0
                      	
  EBF4                	SCDIR:	DS	2		;+14 +15
  EBF6                	SFBPS:	DS	2		;FBPS
  EBF8                	SFNDF:	DS	2		;FILEN DIRF
                      	
  EBFA  0000          	_FATPS:	DW	0
  EBFC  0000          	_DIRPS:	DW	0
  EBFE  0000          	_CLPS:	DW	0
                      	
  EC00                	_PE:
                      	
                      	;	LSX-Dodgers SYSTEM CALL
                      	;	STABLE:アドレス下位1バイトが0になるように
                      	
  EC00                	STABLE:
                      	;0
  EC00  0000D6D7E2D71A		DW	 00000H,_SYS01,_SYS02,_SYS03
  EC08  4ACC61CCE7D7AF		DW	_SYS04,_SYS05,_SYS06,_SYS07
  EC10  EFD7E3D328D854		DW	_SYS08,_SYS09,_SYS0A,_SYS0B
  EC18  F2D3F8D307D41A		DW	_SYS0C,_SYS0D,_SYS0E,_SYS0F
                      	;1
  EC20  6FD4BCD418D54E		DW	_SYS10,_SYS11,_SYS12,_SYS13
  EC28  56D574D591D589		DW	_SYS14,_SYS15,_SYS16,_SYS17
  EC30  F2D5F7D5FCD502		DW	_SYS18,_SYS19,_SYS1A,_SYS1B
  EC38  E1D327D6E1D32B		DW	_SYS1C,_SYS1D,_SYS1E,_SYS1F
                      	;2
  EC40  E1D3C8D5DDD532		DW	_SYS20,_SYS21,_SYS22,_SYS23
  EC48  51D6DBD305E32A		DW	_SYS24,_ERROR,_SYS26,_SYS27
  EC50  DDD55AD66AD884		DW	_SYS28,_SYS29,_SYS2A,_SYS2B
  EC58  A4D884DEE1D37D		DW	_SYS2C,_SYS2D,_SYS2E,_SYS2F
                      	;3
  EC60  77D6          		DW	_SYS30
                      	
                      	;LDWORK.ASM
                      	
                      	;	LSX-Dodgers WORK
                      	
  0004                	DDS	EQU	4
  EC62                	DDTB:
  EC62  434F4E20      		DB	"CON "
  EC66  AFD4          		DW	OPENDD
  EC68  41555820      		DB	"AUX "
  EC6C  AFD4          		DW	OPENDD
  EC6E  50524E20      		DB	"PRN "
  EC72  AFD4          		DW	OPENDD
  EC74  4E554C20      		DB	"NUL "
  EC78  AFD4          		DW	OPENDD
                      	
  EC7A                		DS	2
  EC7C  00EE          	_FATBF:	DW	FATBF
  EC7E  00FA          	_DTBUF:	DW	DTBUF
                      	
  EC80  FF            	_CYL0:	DB	0FFH	;Cylinder
  EC81  FF            	_CYL1:	DB	0FFH	;Cylinder
  EC82  FF            	_CYL2:	DB	0FFH	;Cylinder
  EC83  FF            	_CYL3:	DB	0FFH	;Cylinder
  EC84  00            	_DRIVE:	DB	0	;unit number
  EC85  00            	_SEEKSP:DB	0	;Seek speed
  EC86  FF            	_ISEEK:	DB	0FFH	;
  EC87  00            	_DVSW:	DB	0
  EC88  00            	_DRV:	DB	0
  EC89  FF            	_DSK:	DB	0FFH
  EC8A  8000          	_DTA:	DW	00080H
  EC8C  0000          	_CTC:	DW	0
  EC8E  0000          	_TXADR:	DW	0
  EC90  0000          	_KEYPS	DW	0
  EC92  00FF          	_KEYD	DW	0FF00H
  EC94  C210          	_KEYSP:	DW	010C2H
  EC96  07            	_COLORF:DB	7
  EC97  19            	_LINE:	DB	LINE
                      	
  EC98  0000          	_FCB:	DW	0
  EC9A  0000          	_FBPS:	DW	0	;SEARCH FILES
  EC9C  0000          	_FBAD:	DW	0	;    //
  EC9E  00            	_FBCNT:	DB	0	;    //
  EC9F  00            	_FILEN:	DB	0
  ECA0  00            	_DIRF:	DB	0
  ECA1  00            	_MAXCYL:DB	0
  ECA2  00            	_WTFATF:DB	0	;FATバッファの更新フラグ
  ECA3                			DS	1
  ECA4  00            	_WTDBF:	DB	0	;データバッファの更新フラグ
  ECA5  FF            	_DBDRV:	DB	0FFH	;データバッファにあるデータを読み込んだドライブ
  ECA6  0000          	_DBSEC:	DW	0	;データバッファにあるデータを読み込んだセクタ番号
  ECA8  0000          	_DPB:	DW	0
  ECAA  FF            	_FATDRV:DB	0FFH	;FATバッファに読み込んでいるドライブ
  ECAB  00            	_FATIX:	DB	0	;FATバッファに読み込んでいるインデックス
                      	
  ECAC                		DS	4
                      	
  ECB0  6F5059381F0219	CRTCD:	DB	06FH,050H,059H,038H,01FH,002H,019H,01CH
  ECB8  0007          		DB	000H,007H
  ECBA  30F8B0FF      		DW	0-80*LINE,0-80
  ECBE  0C            		DB	00CH
  ECBF  A0            	WK1FD0:	DB	0A0H
                      	
  ECC0  06D7          	CTC0:	DW	INTCTCE
  ECC2  06D7          	CTC1:	DW	INTCTCE
  ECC4  2ED7          	CTC2:	DW	INTCTC2
  ECC6  06D7          	CTC3:	DW	INTCTCE
  ECC8  C6D6          	INTVEC:	DW	INT
                      	
                      	;	JUMP
                      	
  ECCA  C3C6DC        	_INKEY:	JP	INKEY
  ECCD  C335D9        	_PRINT:	JP	PRINT
  ECD0  C311DC        	_SCRN:	JP	SCRN
  ECD3  C339DC        	_POS:	JP	POS
  ECD6  C376DA        	_LOC:	JP	LOC
  ECD9  C382E8        	_CHGDRV:JP	CHGDRV
  ECDC  C350E9        	_GETDPB:JP	GETDPB
  ECDF  C364E9        	_FFLUSH:JP	FFLUSH
  ECE2  C3EDE5        	_RDFATX:JP	RDFATX
  ECE5  C3F3E6        	_RDFAT:	JP	RDFAT
  ECE8  C349EA        	_WTTRK:	JP	WTTRK
  ECEB  C356EA        	_FDRD:	JP	FDRD
  ECEE  C34DEA        	_FDWT:	JP	FDWT
  ECF1  C3D0E7        	_DRD:	JP	DRD_DPB
  ECF4  C320E8        	_DWT:	JP	DWT_DPB
  ECF7  C317E6        	_WTFATX:JP	WTFATX
  ECFA                		DS	3
  ECFD  C397CE        	_COMANL:JP	COMANL
                      	
  ED00                	WE:
                      	
                      	;LDDPB.ASM
                      	
                      	;	LSX-Dodgers DPB
                      	
  ED00                	DEVICE:
                      	
                      	;	A:
                      	
  ED00  02            	DPB_00_FATLN:	DB	2
  ED01  FD            	DPB_01_FATID:	DB	0FDH
  ED02  EBEC          	DPB_02_DRD:	DW	_FDRD
  ED04  EEEC          	DPB_04_DWT:	DW	_FDWT
  ED06  08            	DPB_06_ADDCL:	DB	8
  ED07  02            	DPB_07_SECPCL:	DB	2
  ED08  6401          	DPB_08_MAXCL:	DW	356
  ED0A  FF            	DPB_0A_FDMODE:	DB	0FFH	;0FFH=2D / 0FEH=2HD
  ED0B  0C            	DPB_0B_MAXDIR:	DB	12
  ED0C  28            	DPB_0C_MAXCYL:	DB	40
  ED0D  09            	DPB_0D_MAXSEC:	DB	9	;Number of sectors
  ED0E  01            	DPB_0E_FATPS:	DB	1
  ED0F  82            	DPB_0F_BPS:	DB	082H
  ED10  05            	DPB_10_DIRPS:	DB	5
  ED11  01            	DPB_11_MINSEC:	DB	1	;Minimum sector
  ED12  87            	DPB_12_DEVNO:	DB	087H	;Device Number
  ED13  00            	DPB_13_UNITNO:	DB	0
  ED14  0000          	DPB_14_EXTEND:	DW	0
  ED16  0000          	DPB_16:		DW	0
  ED18  0000          	DPB_18:		DW	0
  ED1A  0000          	DPB_1A_SDIR:	DW	0
  ED1C  46444430      	DPB_1C_NAME:	DB	"FDD0"
                      	
                      	;	B:
                      	
  ED20  02            		DB	2
  ED21  FD            		DB	0FDH
  ED22  EBEC          		DW	_FDRD
  ED24  EEEC          		DW	_FDWT
  ED26  08            		DB	8
  ED27  02            		DB	2
  ED28  6401          		DW	356
  ED2A  FF            		DB	0FFH	;0FFH=2D / 0FEH=2HD
  ED2B  0C            		DB	12
  ED2C  28            		DB	40
  ED2D  09            		DB	9
  ED2E  01            		DB	1
  ED2F  82            		DB	082H
  ED30  05            		DB	5
  ED31  01            		DB	1
  ED32  87            		DB	087H	;Device Number
  ED33  01            		DB	1
  ED34  0000          		DW	0
  ED36  0000          		DW	0
  ED38  0000          		DW	0
  ED3A  0000          		DW	0
  ED3C  46444431      		DB	"FDD1"
                      	
                      	;	C:
                      	
  ED40  02            		DB	2
  ED41  FD            		DB	0FDH
  ED42  EBEC          		DW	_FDRD
  ED44  EEEC          		DW	_FDWT
  ED46  08            		DB	8
  ED47  02            		DB	2
  ED48  6401          		DW	356
  ED4A  FF            		DB	0FFH	;0FFH=2D / 0FEH=2HD
  ED4B  0C            		DB	12
  ED4C  28            		DB	40
  ED4D  09            		DB	9
  ED4E  01            		DB	1
  ED4F  82            		DB	082H
  ED50  05            		DB	5
  ED51  01            		DB	1
  ED52  87            		DB	087H	;Device Number
  ED53  02            		DB	2
  ED54  0000          		DW	0
  ED56  0000          		DW	0
  ED58  0000          		DW	0
  ED5A  0000          		DW	0
  ED5C  46444432      		DB	"FDD2"
                      	
                      	;	D:
                      	
  ED60  02            		DB	2
  ED61  FD            		DB	0FDH
  ED62  EBEC          		DW	_FDRD
  ED64  EEEC          		DW	_FDWT
  ED66  08            		DB	8
  ED67  02            		DB	2
  ED68  6401          		DW	356
  ED6A  FF            		DB	0FFH	;0FFH=2D / 0FEH=2HD
  ED6B  0C            		DB	12
  ED6C  28            		DB	40
  ED6D  09            		DB	9
  ED6E  01            		DB	1
  ED6F  82            		DB	082H
  ED70  05            		DB	5
  ED71  01            		DB	1
  ED72  87            		DB	087H	;Device Number
  ED73  03            		DB	3
  ED74  0000          		DW	0
  ED76  0000          		DW	0
  ED78  0000          		DW	0
  ED7A  0000          		DW	0
  ED7C  46444433      		DB	"FDD3"
                      	
                      	;	E:
                      	
  ED80  00            	EMMFL:	DB	0
  ED81  FE            		DB	0FEH
  ED82  35CD          	EMMRD:	DW	EDRDC
  ED84  32CD          	EMMWR:	DW	EDWTC
  ED86  09            		DB	9
  ED87  01            		DB	1
  ED88  0000          	EMMCL:	DW	0
  ED8A  00            		DB	0
  ED8B  0B            		DB	11
  ED8C  00            	EMMBL:	DB	0
  ED8D  01            		DB	1
  ED8E  01            		DB	1
  ED8F  04            		DB	4
  ED90  05            		DB	5
  ED91  01            		DB	1
  ED92  06            		DB	6	;Device Number
  ED93  00            	EMMDV:	DB	0
  ED94  0000          		DW	0
  ED96  0000          		DW	0
  ED98  0000          		DW	0
  ED9A  0000          		DW	0
  ED9C  454D4D30      		DB	"EMM0"
                      	
                      	;	F:
                      	
  EDA0  00            	BANKFL:	DB	0
  EDA1  F9            		DB	0F9H
  EDA2  B0CC          		DW	BDRDC
  EDA4  D3CC          		DW	BDWTC
  EDA6  03            		DB	3
  EDA7  01            		DB	1
  EDA8  0000          	BANKCL:	DW	0
  EDAA  00            		DB	0
  EDAB  05            		DB	5
  EDAC  00            		DB	0
  EDAD  01            		DB	1
  EDAE  00            		DB	0
  EDAF  04            		DB	4
  EDB0  01            		DB	1
  EDB1  01            		DB	1
  EDB2  0B            		DB	00BH	;Device Number
  EDB3  00            		DB	0
  EDB4  0000          		DW	0
  EDB6  0000          		DW	0
  EDB8  0000          		DW	0
  EDBA  0000          		DW	0
  EDBC  4252414D      		DB	"BRAM"
                      	
                      	;	G:
                      	
  EDC0  01            		DB	1
  EDC1  F9            		DB	0F9H
  EDC2  81CC          		DW	GDRD
  EDC4  8CCC          		DW	GDWT
  EDC6  00            		DB	0
  EDC7  04            		DB	4
  EDC8  3000          		DW	48
  EDCA  00            		DB	0
  EDCB  08            		DB	8
  EDCC  00            		DB	0
  EDCD  01            		DB	1
  EDCE  00            		DB	0
  EDCF  01            		DB	1
  EDD0  04            		DB	4
  EDD1  01            		DB	1
  EDD2  05            		DB	5	;Device Number
  EDD3  01            		DB	1
  EDD4  0000          		DW	0
  EDD6  0000          		DW	0
  EDD8  0000          		DW	0
  EDDA  0000          		DW	0
  EDDC  4752414D      		DB	"GRAM"
                      	
                      	
                      	
  EDE0  00            	LDEND:	DB	0
                      	
  EDE1                		END
