			  Z80 ASSEMBLER - ZASM VER 1.6
                      	;	LSX-Dodgers for X1/turbo/Z
                      	;	Programmed by
                      	;	Gaku (Lovers/Tablacus)
                      	;LDDEF.ASM
                      	
                      	;	LSX-Dodgers DEF
                      	
  1D00                	MAC	EQU	01D00H		;X1
  0001                	VER_1   EQU	1
  0004                	VER_2   EQU	4
  0001                	VER_3   EQU	1
  0145                	VER	EQU	VER_1 * 256 + VER_2 * 17 + VER_3
                      	
  0005                	SYSTEM	EQU	00005H
  000F                	JP_HL	EQU	0000FH
  005C                	FCB1	EQU	0005CH
  006C                	FCB2	EQU	0006CH
  005D                	FCB1FN	EQU	FCB1+1
  006D                	FCB2FN	EQU	FCB2+1
  0080                	DTA1	EQU	00080H
                      	
  CB00                	RUN	EQU	0CB00H
  D106                	BDOS	EQU	0D106H
  F200                	FATBF	EQU	0F200H
  FA00                	DTBUF	EQU	0FA00H
  FE00                	KEYBF	EQU	0FE00H
  FF00                	KBUF	EQU	0FF00H
  FFCA                	EXTSP	EQU	0FFCAH
  FFCA                	EXTBIO	EQU	0FFCAH
  FFD9                	TRAP38	EQU	0FFD9H
  0018                	LINE	EQU	24
                      	
                      	
  CAF9                		ORG	RUN-7
                      	
                      	;	MSX BINARY HEADER
  CAF9  FE            		DB	0FEH
                      	;	MSX BINARY START ADDRESS
  CAFA  00CB          		DW	RUN
                      	;	MSX BINARY END ADDRESS
  CAFC  00F2          		DW	LDEND
                      	;	MSX BINARY EXEC ADDRESS
  CAFE  00CB          		DW	RUN
                      	;LDINIT.ASM
                      	
                      	;	LSX-Dodgers INIT
                      	
  CB00  C307CB        		JP	START
  CB03  001D          	MACHINE:DW	MAC
  CB05  4501          	VERSION:DW	VER
                      	
  CB07                	START:
  CB07  F3            		DI
  CB08  ED5E          		IM	2
  CB0A  31CAFF        		LD	SP,EXTSP
  CB0D  CD1BCB        		CALL	INIT		;NZならAUTOEXECを実行
  CB10  210000        		LD	HL,0
  CB13  E5            		PUSH	HL
  CB14  C8            		RET	Z
  CB15  11CBCE        		LD	DE,AUTOD
  CB18  C3FDEF        		JP	_COMANL
                      	
  CB1B                	INIT:
  CB1B  3E1E          		LD	A,01EH
  CB1D  D300          		OUT	(0),A
                      	
  CB1F  010000        		LD	BC,0
  CB22  ED438CEF      		LD	(_CTC),BC
  CB26  01040A        		LD	BC,00A04H
  CB29  CD75CE        		CALL	CHKCTC
  CB2C  010407        		LD	BC,00704H
  CB2F  CD75CE        		CALL	CHKCTC
  CB32  01A81F        		LD	BC,01FA8H
  CB35  CD75CE        		CALL	CHKCTC
  CB38  01A01F        		LD	BC,01FA0H
  CB3B  CD75CE        		CALL	CHKCTC
                      	;
  CB3E                	INISIO:
  CB3E  01911F        		LD	BC,01F91H	;INIT SIO
  CB41  1601          		LD	D,1
  CB43  ED51          		OUT	(C),D
                      	
  CB45  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  CB47  0E93          		LD	C,093H
  CB49  ED51          		OUT	(C),D
  CB4B  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  CB4D  0E99          		LD	C,099H		;INIT SIO
  CB4F  1601          		LD	D,1
  CB51  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  CB53  0E9B          		LD	C,09BH
  CB55  ED51          		OUT	(C),D
  CB57  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
                      	
  CB59  0E80          		LD	C,080H		;INIT DMA
  CB5B  2106C3        		LD	HL,0C306H
  CB5E                	INIDMA:
  CB5E  ED61          		OUT	(C),H
  CB60  2D            		DEC	L
  CB61  20FB          		JR	NZ,INIDMA
                      	
  CB63  3EE4          		LD	A,0E4H
  CB65  CD36DF        		CALL	COMOUT
  CB68  AF            		XOR	A
  CB69  CD10DF        		CALL	OT49SB
                      	
  CB6C  3EEF          		LD	A,INTVEC/256
  CB6E  ED47          		LD	I,A
                      	
  CB70  ED4B8CEF      		LD	BC,(_CTC)
  CB74  0B            		DEC	BC
  CB75  0B            		DEC	BC
                      	
  CB76  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  CB78  3EC0          		LD	A,CTC0
  CB7A  ED79          		OUT	(C),A
                      	
  CB7C  0C            		INC	C
  CB7D  3E47          		LD	A,047H
  CB7F  ED79          		OUT	(C),A
  CB81  3E0D          		LD	A,13		;Baudrate 9600-13
  CB83  ED79          		OUT	(C),A
                      	
  CB85  79            		LD	A,C
  CB86  D610          		SUB	010H
  CB88  4F            		LD	C,A
                      	;	LD	(SIOAD+1),BC
                      	;	LD	(SIOAD0+1),BC
                      	;	LD	(SIOAD1+1),BC
                      	
  CB89  212DCF        		LD	HL,SIODATA
  CB8C                	SINIT1:
  CB8C  7E            		LD	A,(HL)
  CB8D  23            		INC	HL
  CB8E  FEFF          		CP	0FFH
  CB90  2804          		JR	Z,SINIT2
  CB92  ED79          		OUT	(C),A
  CB94  18F6          		JR	SINIT1
  CB96                	SINIT2:
  CB96  3EE4          		LD	A,0E4H
  CB98  CD36DF        		CALL	COMOUT
  CB9B  3EC8          		LD	A,INTVEC
  CB9D  CD10DF        		CALL	OT49SB
                      	;
  CBA0  01C41F        		LD	BC,01FC4H
  CBA3  3E0C          		LD	A,00CH
  CBA5  ED79          		OUT	(C),A
                      	
  CBA7  0EC0          		LD	C,0C0H
  CBA9  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
                      	
  CBAB  0C            		INC	C
  CBAC  3E28          		LD	A,40
  CBAE  ED79          		OUT	(C),A
                      	
  CBB0  0C            		INC	C
  CBB1  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
                      	
  CBB3  0C            		INC	C
  CBB4  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
                      	
  CBB6  0EC5          		LD	C,0C5H
  CBB8  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
                      	
  CBBA                	TEXT:
  CBBA  0EB0          		LD	C,0B0H
  CBBC  3E80          		LD	A,080H
  CBBE  ED79          		OUT	(C),A
  CBC0  1607          		LD	D,7
  CBC2  0EB9          		LD	C,0B9H
  CBC4  2126CF        		LD	HL,TEXTDT
  CBC7                	TEXT1:
  CBC7  04            		INC	B
  CBC8  EDA3          		OUTI
  CBCA  0C            		INC	C
  CBCB  15            		DEC	D
  CBCC  20F9          		JR	NZ,TEXT1
  CBCE  01B01F        		LD	BC,01FB0H
  CBD1  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
                      	
  CBD3  0EC4          		LD	C,0C4H
  CBD5  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
                      	
  CBD7  01011A        		LD	BC,01A01H
  CBDA  ED78          		IN	A,(C)
  CBDC  E608          		AND	8
  CBDE  2809          		JR	Z,PRN
  CBE0  0E03          		LD	C,003H
  CBE2  3E0F          		LD	A,00FH
  CBE4  ED79          		OUT	(C),A
  CBE6  01040A        		LD	BC,00A04H
  CBE9                	PRN:
  CBE9  210000        		LD	HL,0
  CBEC  065C          		LD	B,05CH
  CBEE  3EFF          		LD	A,0FFH		;RST 38H
  CBF0  CD9EE1        		CALL	FILL_MEMORY
  CBF3  06A4          		LD	B,0A4H
  CBF5  AF            		XOR	A
  CBF6  CD9EE1        		CALL	FILL_MEMORY
                      	
  CBF9  3EC3          		LD	A,0C3H		;JP
  CBFB  2103EF        		LD	HL,WBOOT
  CBFE  320000        		LD	(00000H),A
  CC01  220100        		LD	(00001H),HL	;IPL
                      	
  CC04  2A03CB        		LD	HL,(MACHINE)	;3 bit7  DPB Compatible LA(1)
  CC07  220300        		LD	(00003H),HL	;  bit6-0 Machine X1(0)
                      	;				;4 LSX-Dodgers(01DH)
  CC0A  2106D1        		LD	HL,BDOS
  CC0D  320500        		LD	(00005H),A
  CC10  220600        		LD	(00006H),HL	;BDOS
                      	
  CC13  2113DB        		LD	HL,BIOS
  CC16  321800        		LD	(00018H),A
  CC19  221900        		LD	(00019H),HL	;BIOS-ROM
                      	
  CC1C  21D9FF        		LD	HL,TRAP38	;TRAP38
  CC1F  323800        		LD	(00038H),A
  CC22  223900        		LD	(00039H),HL	;RST 038H
                      	
  CC25  3EEF          		LD	A,BOOT/256
  CC27  320B00        		LD	(0000BH),A
                      	
  CC2A  3EE9          		LD	A,0E9H		;JP (HL)
  CC2C  320F00        		LD	(0000FH),A
                      	
  CC2F  3A7DF0        		LD	A,(_FATBF+1)
  CC32  321300        		LD	(00013H),A
                      	
  CC35  3A7FF0        		LD	A,(_DTBUF+1)
  CC38  321700        		LD	(00017H),A
                      	
  CC3B  3EFE          		LD	A,KEYBF/256
  CC3D  321B00        		LD	(0001BH),A
                      	
  CC40  3EFF          		LD	A,KBUF/256
  CC42  321F00        		LD	(0001FH),A
                      	
  CC45  2A05CB        		LD	HL,(VERSION)
  CC48  225A00        		LD	(0005AH),HL
                      	
  CC4B  3EE6          		LD	A,0E6H
  CC4D  CD36DF        		CALL	COMOUT
  CC50  CD1BDF        		CALL	IN49SB
  CC53  F5            		PUSH	AF
  CC54  CD1BDF        		CALL	IN49SB
  CC57  F1            		POP	AF
  CC58  F5            		PUSH	AF
  CC59  E612          		AND	012H
  CC5B  2005          		JR	NZ,KEYR
  CC5D  3E01          		LD	A,1
  CC5F  32C6CD        		LD	(KEYREP+1),A
  CC62                	KEYR:
  CC62  F1            		POP	AF
  CC63  E603          		AND	3
  CC65  280E          		JR	Z,NON
                      	
  CC67  01D03F        		LD	BC,03FD0H
  CC6A  ED49          		OUT	(C),C
  CC6C  3E37          		LD	A,037H
  CC6E  D3D0          		OUT	(0D0H),A
  CC70  ED78          		IN	A,(C)
  CC72  B9            		CP	C
  CC73  2878          		JR	Z,TURBO
  CC75                	NON:
  CC75  3D            		DEC	A		;A=0FFH
  CC76  321800        		LD	(00018H),A	;BIOS-ROM
                      	
  CC79  2139CF        		LD	HL,AT_SCR1
  CC7C  11C0DF        		LD	DE,SCR1
  CC7F  01A100        		LD	BC,SCRNX-SCR1	;転送先のサイズ確認用
  CC82  019F00        		LD	BC,AT_SCRE-AT_SCR1
  CC85  EDB0          		LDIR
                      	
  CC87  21D8CF        		LD	HL,AT_WTTRK
  CC8A  1147EE        		LD	DE,WTTRK
  CC8D  01B900        		LD	BC,DMAE-WTTRK	;転送先のサイズ確認用
  CC90  01B100        		LD	BC,AT_CPUE-AT_WTTRK
  CC93  EDB0          		LDIR
                      	
  CC95  2189D0        		LD	HL,AT_EDWT
  CC98  11D9D7        		LD	DE,EDWT
  CC9B  014C00        		LD	BC,EMME-EDWT	;転送先のサイズ確認用
  CC9E  014800        		LD	BC,AT_EMME-AT_EDWT
  CCA1  EDB0          		LDIR
                      	
  CCA3  21A8EE        		LD	HL,AT_DRD+AT_R
  CCA6  22ECEF        		LD	(_FDRD+1),HL
  CCA9  214DEE        		LD	HL,AT_DWT+AT_R
  CCAC  22EFEF        		LD	(_FDWT+1),HL
  CCAF  21EDD7        		LD	HL,AT_EDRD+AT_RE
  CCB2  2282F1        		LD	(EMMRD),HL
  CCB5  21D9D7        		LD	HL,AT_EDWT+AT_RE
  CCB8  2284F1        		LD	(EMMWR),HL
                      	
  CCBB  3E27          		LD	A,027H			;ノンターボはMFM切り替えを行わない
  CCBD  3212F1        		LD	(DEVICE+012H),A		;Aドライブ
  CCC0  3232F1        		LD	(DEVICE+012H+32),A	;Bドライブ
  CCC3  3252F1        		LD	(DEVICE+012H+32*2),A	;Cドライブ
  CCC6  3272F1        		LD	(DEVICE+012H+32*3),A	;Dドライブ
                      	
  CCC9  210000        		LD	HL,0
  CCCC  2261DF        		LD	(X1PAT),HL
                      	
  CCCF  3EAF          		LD	A,0AFH		;XOR	A
  CCD1  3280DD        		LD	(X1KPAT),A
                      	
  CCD4  2161E0        		LD	HL,SCRNX
  CCD7  22D1EF        		LD	(_SCRN+1),HL
                      	
  CCDA  CD9CCE        		CALL	SETCRTC
  CCDD  0610          		LD	B,010H		;PALET
  CCDF  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  CCE1  04            		INC	B
  CCE2  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  CCE4  04            		INC	B
  CCE5  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  CCE7  04            		INC	B
  CCE8  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  CCEA  C381CD        		JP	NOBANK
                      	
  CCED                	TURBO:
  CCED  F3            		DI			;Check BIOS
  CCEE  061D          		LD	B,01DH
  CCF0  ED79          		OUT	(C),A		;BIOS ON
  CCF2  3A512F        		LD	A,(02F51H)
  CCF5  04            		INC	B		;B=01EH
  CCF6  ED79          		OUT	(C),A		;BIOS OFF
  CCF8  FB            		EI
  CCF9  FEC9          		CP	0C9H
  CCFB  280B          		JR	Z,BIOSOK
  CCFD  3EAF          		LD	A,0AFH		;XOR	A
  CCFF  3280DD        		LD	(X1KPAT),A
  CD02  2161E0        		LD	HL,SCRNX
  CD05  22D1EF        		LD	(_SCRN+1),HL
  CD08                	BIOSOK:
  CD08  3E1F          		LD	A,01FH		;スタートポート
  CD0A  DBF0          		IN	A,(0F0H)
  CD0C  0F            		RRCA
  CD0D  380B          		JR	C,CRT1
  CD0F  2116CF        		LD	HL,_C8025H
  CD12  11B0EF        		LD	DE,CRTCD
  CD15  011000        		LD	BC,16
  CD18  EDB0          		LDIR
  CD1A                	CRT1:
  CD1A  CD9CCE        		CALL	SETCRTC
  CD1D  01AA10        		LD	BC,010AAH	;PALET
  CD20  ED49          		OUT	(C),C
  CD22  01CC11        		LD	BC,011CCH
  CD25  ED49          		OUT	(C),C
  CD27  01F012        		LD	BC,012F0H
  CD2A  ED49          		OUT	(C),C
  CD2C  04            		INC	B
  CD2D  ED71          		DB	0EDH,071H
                      	
  CD2F  3E1F          		LD	A,01FH		;スタートポート
  CD31  DBF0          		IN	A,(0F0H)
  CD33  CB57          		BIT	2,A
  CD35  2818          		JR	Z,BANK
                      	
  CD37  AF            		XOR	A
  CD38                	TZ1:				;前面スイッチが2HDの場合はMFMモードを2HDにしておく
  CD38  F5            		PUSH	AF
  CD39  CDDCEF        		CALL	_GETDPB
  CD3C  DD7E12        		LD	A,(IX+012H)	;DPB_12_DEVICE
  CD3F  E68F          		AND	08FH
  CD41  FE87          		CP	087H		;フロッピーでMEM切り替えがON
  CD43  2004          		JR	NZ,TZ2
  CD45  DDCB0A86      		RES	0,(IX+0AH)	;(DPB_0A_FDMODE)
  CD49                	TZ2:
  CD49  F1            		POP	AF
  CD4A  3C            		INC	A
  CD4B  FE08          		CP	8
  CD4D  38E9          		JR	C,TZ1
                      	
  CD4F                	BANK:
  CD4F  01000B        		LD	BC,00B00H
  CD52  21007F        		LD	HL,07F00H
  CD55  F3            		DI
  CD56                	BANK1:
  CD56  ED69          		OUT	(C),L
  CD58  5E            		LD	E,(HL)
  CD59  7B            		LD	A,E
  CD5A  C6A5          		ADD	A,0A5H
  CD5C  77            		LD	(HL),A
  CD5D  BE            		CP	(HL)
  CD5E  73            		LD	(HL),E
  CD5F  2005          		JR	NZ,BANK2
  CD61  2C            		INC	L
  CD62  CB65          		BIT	4,L
  CD64  28F0          		JR	Z,BANK1
  CD66                	BANK2:
  CD66  3E10          		LD	A,010H
  CD68  ED79          		OUT	(C),A
  CD6A  7D            		LD	A,L
  CD6B  B7            		OR	A
  CD6C  2813          		JR	Z,NOBANK
  CD6E  2600          		LD	H,0
  CD70  29            		ADD	HL,HL	;*2
  CD71  29            		ADD	HL,HL	;*4
  CD72  29            		ADD	HL,HL	;*8
  CD73  29            		ADD	HL,HL	;*16
  CD74  29            		ADD	HL,HL	;*32
  CD75  2B            		DEC	HL	;-1
  CD76  2B            		DEC	HL	;-2
  CD77  2B            		DEC	HL	;-3
  CD78  22A8F1        		LD	(BANKCL),HL
  CD7B  CDBBCE        		CALL	CALC_FATLN
  CD7E  32A0F1        		LD	(BANKFL),A
  CD81                	NOBANK:
  CD81                	EMM:
  CD81  CD65CE        		CALL	EADR0
  CD84  ED78          		IN	A,(C)
  CD86  F5            		PUSH	AF
                      	
  CD87  110000        		LD	DE,0
  CD8A                	ECHECK1:
  CD8A  13            		INC	DE
  CD8B  CD48CE        		CALL	EADR2
  CD8E  ED60          		IN	H,(C)
  CD90  CD48CE        		CALL	EADR2
  CD93  7C            		LD	A,H
  CD94  C6E5          		ADD	A,0E5H
  CD96  ED79          		OUT	(C),A
  CD98  3C            		INC	A
  CD99  CD65CE        		CALL	EADR0
  CD9C  ED79          		OUT	(C),A
  CD9E  3D            		DEC	A
  CD9F  CD48CE        		CALL	EADR2
  CDA2  ED68          		IN	L,(C)
  CDA4  CD48CE        		CALL	EADR2
  CDA7  ED61          		OUT	(C),H
  CDA9  BD            		CP	L
  CDAA  2004          		JR	NZ,ECHECK2
  CDAC  CB5A          		BIT	3,D
  CDAE  28DA          		JR	Z,ECHECK1
  CDB0                	ECHECK2:
  CDB0  CD65CE        		CALL	EADR0
  CDB3  F1            		POP	AF
  CDB4  ED79          		OUT	(C),A
                      	
  CDB6  21F7FF        		LD	HL,0-9
  CDB9  19            		ADD	HL,DE
  CDBA  3009          		JR	NC,NOEMM
  CDBC  2288F1        		LD	(EMMCL),HL
  CDBF  CDBBCE        		CALL	CALC_FATLN
  CDC2  3280F1        		LD	(EMMFL),A
  CDC5                	NOEMM:
  CDC5  3E00          	KEYREP:	LD	A,000H
  CDC7  B7            		OR	A
  CDC8  2807          		JR	Z,KEYR1
  CDCA  010000        		LD	BC,0
  CDCD  ED438CEF      		LD	(_CTC),BC
  CDD1                	KEYR1:
  CDD1  0130F8        		LD	BC,0-80*25
  CDD4  2ABAEF        		LD	HL,(CRTCD+10)
  CDD7  ED43BAEF      		LD	(CRTCD+10),BC
  CDDB  1E0C          		LD	E,00CH
  CDDD  CDCDEF        		CALL	_PRINT
  CDE0  22BAEF        		LD	(CRTCD+10),HL
                      	
  CDE3  21D7CE        		LD	HL,INIMES
  CDE6  CD69D8        		CALL	MSX
                      	
  CDE9  3A87FF        		LD	A,(0FF87H)
  CDEC  FE08          		CP	8
  CDEE  301E          		JR	NC,INIT0
  CDF0  5F            		LD	E,A
  CDF1  C641          		ADD	A,'A'
  CDF3  32D4CE        		LD	(AUTODV),A
  CDF6  0E0E          		LD	C,00EH
  CDF8  CD0500        		CALL	SYSTEM
  CDFB  1C            		INC	E
  CDFC  2185EF        		LD	HL,_SEEKSP	;Disk error Ignore
  CDFF  CBFE          		SET	7,(HL)
  CE01  0E1B          		LD	C,01BH
  CE03  CD0500        		CALL	SYSTEM
                      	
  CE06  2185EF        		LD	HL,_SEEKSP
  CE09  CBBE          		RES	7,(HL)
                      	
  CE0B  3C            		INC	A
  CE0C  2008          		JR	NZ,INIT1
  CE0E                	INIT0:
  CE0E  1E00          		LD	E,0
  CE10  0E0E          		LD	C,00EH
  CE12  CD0500        		CALL	SYSTEM
  CE15  AF            		XOR	A
  CE16                	INIT1:
  CE16  F3            		DI
  CE17  08            		EX	AF,AF'
  CE18  2EFE          		LD	L,0-2		;CALLのスタック分減らす
  CE1A  39            		ADD	HL,SP
  CE1B  1100FF        		LD	DE,0FF00H
  CE1E  45            		LD	B,L
  CE1F  CD11D5        		CALL	ZERO_MEMORY_DE
  CE22  21CAFF        		LD	HL,EXTSP
  CE25  060F          		LD	B,TRAP38-EXTBIO
  CE27  3EFF          		LD	A,0FFH		;RST 38H
  CE29  CD9EE1        		CALL	FILL_MEMORY
  CE2C  21D1D0        		LD	HL,AT_TRAP38
  CE2F  11D9FF        		LD	DE,TRAP38
  CE32  012700        		LD	BC,AT_TRAPE-AT_TRAP38
  CE35  EDB0          		LDIR
  CE37  08            		EX	AF,AF'
  CE38  B7            		OR	A
  CE39  C8            		RET	Z
                      	
  CE3A  3EE6          		LD	A,0E6H
  CE3C  CD36DF        		CALL	COMOUT
  CE3F  CD1BDF        		CALL	IN49SB
  CE42  CD1BDF        		CALL	IN49SB
  CE45  FE1B          		CP	01BH
  CE47  C9            		RET
                      	
  CE48                	EADR2:
  CE48  D5            		PUSH	DE
  CE49  EB            		EX	DE,HL
  CE4A  29            		ADD	HL,HL
  CE4B  29            		ADD	HL,HL
  CE4C  ED4B8BF1      		LD	BC,(EMMBL-1)
  CE50  0E00          		LD	C,0
  CE52  09            		ADD	HL,BC
  CE53  ED4B93F1      		LD	BC,(EMMDV)
  CE57  060D          		LD	B,00DH
  CE59  ED49          		OUT	(C),C
  CE5B  0C            		INC	C
  CE5C  ED69          		OUT	(C),L
  CE5E  0C            		INC	C
  CE5F  ED61          		OUT	(C),H
  CE61  0C            		INC	C
  CE62  EB            		EX	DE,HL
  CE63  D1            		POP	DE
  CE64  C9            		RET
                      	
  CE65                	EADR0:
  CE65  ED4B93F1      		LD	BC,(EMMDV)
  CE69  060D          		LD	B,00DH
  CE6B  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  CE6D  0C            		INC	C
  CE6E  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  CE70  0C            		INC	C
  CE71  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  CE73  0C            		INC	C
  CE74  C9            		RET
                      	
  CE75                	CHKCTC:
  CE75  C5            		PUSH	BC
  CE76  110347        		LD	DE,04703H
  CE79                	INICTC1:
  CE79  0C            		INC	C
  CE7A  ED51          		OUT	(C),D
  CE7C  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  CE7E  1D            		DEC	E
  CE7F  20F8          		JR	NZ,INICTC1
  CE81  C1            		POP	BC
                      	
  CE82  11FA07        		LD	DE,007FAH
  CE85  ED51          		OUT	(C),D
  CE87  ED59          		OUT	(C),E
  CE89  ED78          		IN	A,(C)
  CE8B  BB            		CP	E
  CE8C  C0            		RET	NZ
  CE8D  ED51          		OUT	(C),D
  CE8F  ED51          		OUT	(C),D
  CE91  ED78          		IN	A,(C)
  CE93  BA            		CP	D
  CE94  C0            		RET	NZ
  CE95  03            		INC	BC
  CE96  03            		INC	BC
  CE97  ED438CEF      		LD	(_CTC),BC
  CE9B  C9            		RET
                      	
  CE9C                	SETCRTC:
  CE9C  21B0EF        		LD	HL,CRTCD
  CE9F  AF            		XOR	A
  CEA0                	SETCRT1:
  CEA0  010018        		LD	BC,01800H
  CEA3  ED79          		OUT	(C),A
  CEA5  0C            		INC	C
  CEA6  04            		INC	B
  CEA7  EDA3          		OUTI
  CEA9  3C            		INC	A
  CEAA  FE0C          		CP	12
  CEAC  20F2          		JR	NZ,SETCRT1
  CEAE  23            		INC	HL
  CEAF  23            		INC	HL
  CEB0  01031B        		LD	BC,01A03H+00100H
  CEB3  EDA3          		OUTI
  CEB5  01D020        		LD	BC,01FD0H+00100H
  CEB8  EDA3          		OUTI
  CEBA  C9            		RET
                      	
  CEBB                	CALC_FATLN:	;FAT12のクラスタ数から必要なFATサイズを求める(セクタサイズ512)
  CEBB  5D            		LD	E,L
  CEBC  54            		LD	D,H
  CEBD  29            		ADD	HL,HL	;*2
  CEBE  19            		ADD	HL,DE	;*3
  CEBF  CB3C          		SRL	H	;/2
  CEC1  CB1D          		RR	L	;1クラスタ辺り1.5バイト必要
  CEC3  11FF01        		LD	DE,511	;切り上げる
  CEC6  19            		ADD	HL,DE
  CEC7  7C            		LD	A,H
  CEC8  CB3F          		SRL	A
  CECA  C9            		RET
                      	
  CECB  4155544F455845	AUTOD:	DB	"AUTOEXEC "
  CED4  413A00        	AUTODV:	DB	"A:",0
                      	
  CED7  4C53582D446F64	INIMES:	DB	"LSX-Dodgers for X1/turbo version "
  CEF8  312E          		DB	030H + VER_1, '.'
  CEFA  3431          		DB	030H + VER_2 ,030H + VER_3
  CEFC  2047616B752028		DB	' Gaku (Lovers/Tablacus)',0DH,0AH
  CF15  00            		DB	0
                      	
  CF16                	_C8025H:
  CF16  6B5059881B0119		DB	06BH,050H,059H,088H,01BH,001H,019H,01AH
  CF1E  000F          		DB	000H,00FH
  CF20  80F8B0FF      		DW	0-80*LINE,0-80
  CF24  0CA3          		DB	00CH,0A3H
                      	
  CF26  030C0F30333C3F	TEXTDT:	DB	003H,00CH,00FH,030H,033H,03CH,03FH
                      	
  CF2D                	SIODATA:
  CF2D  18            		DB	018H
  CF2E  0100          		DB	1,0
  CF30  0200          		DB	2,0
  CF32  03C1          		DB	3,0C1H
  CF34  0444          		DB	4,044H
  CF36  05E8          		DB	5,0E8H
  CF38  FF            		DB	0FFH
                      	
                      	;	ノンターボ用パッチ
                      	
  CF39                	AT_SCR1:
  CF39  D9            		EXX
  CF3A  C5            		PUSH	BC
  CF3B  015020        		LD	BC,02000H+80
  CF3E  D9            		EXX
  CF3F  C5            		PUSH	BC
  CF40  010020        		LD	BC,02000H
                      	
  CF43  67            		LD	H,A
  CF44  B7            		OR	A
  CF45                	AT_SCRUP1:
  CF45  2815          		JR	Z,AT_SCRCL
  CF47  C5            		PUSH	BC
  CF48  CBE0          		SET	4,B
  CF4A  D9            		EXX
  CF4B  C5            		PUSH	BC
  CF4C  CBE0          		SET	4,B
  CF4E  D9            		EXX
  CF4F  CDFADF        		CALL	AT_UPSUB+AT_RS
  CF52  D9            		EXX
  CF53  C1            		POP	BC
  CF54  D9            		EXX
  CF55  C1            		POP	BC
  CF56  CDFADF        		CALL	AT_UPSUB+AT_RS
  CF59  25            		DEC	H
  CF5A  18E9          		JR	AT_SCRUP1
                      	
  CF5C                	AT_SCRCL:
  CF5C  215020        		LD	HL,02000H+80
  CF5F  3A96EF        		LD	A,(_COLORF)
  CF62                	AT_SCRCL1:
  CF62  CBE0          		SET	4,B
  CF64  ED61          		OUT	(C),H
  CF66  CBA0          		RES	4,B
  CF68  ED79          		OUT	(C),A
  CF6A  03            		INC	BC
  CF6B  2D            		DEC	L
  CF6C  20F4          		JR	NZ,AT_SCRCL1
  CF6E  C1            		POP	BC
  CF6F  D9            		EXX
  CF70  C1            		POP	BC
  CF71  D9            		EXX
  CF72  C9            		RET
                      	
  CF73                	AT_UPSUB:
  CF73  2E28          		LD	L,40
  CF75                	AT_UPSUB1:
  CF75  D9            		EXX
  CF76  ED78          		IN	A,(C)
  CF78  03            		INC	BC
  CF79  D9            		EXX
  CF7A  ED79          		OUT	(C),A
  CF7C  03            		INC	BC
  CF7D  D9            		EXX
  CF7E  ED78          		IN	A,(C)
  CF80  03            		INC	BC
  CF81  D9            		EXX
  CF82  ED79          		OUT	(C),A
  CF84  03            		INC	BC
  CF85  2D            		DEC	L
  CF86  20ED          		JR	NZ,AT_UPSUB1
  CF88  C9            		RET
                      	
                      	;	FLOPPY DISK DRIVER(CPU)
                      	
  CF89                	DISKC:
  CF89  1B            		DEC	DE
  CF8A  CB5F          		BIT	3,A
  CF8C  C440EE        		CALL	NZ,RNF
  CF8F                	DISKD:
  CF8F  E5            		PUSH	HL
  CF90  2146EE        		LD	HL,RETRY
  CF93  35            		DEC	(HL)
  CF94  E1            		POP	HL
  CF95  203E          		JR	NZ,AT_ERR		;Retry
  CF97  B7            		OR	A
  CF98  283B          		JR	Z,AT_ERR		;Error
                      	
  CF9A                	AT_DELP:
  CF9A  CD40EE        		CALL	RNF
  CF9D  CD1CEE        		CALL	FDMOFF
  CFA0  3A85EF        		LD	A,(_SEEKSP)
  CFA3  87            		ADD	A,A
  CFA4  382E          		JR	C,AT_ERRZ
  CFA6                	AT_DELP1:
  CFA6  D5            		PUSH	DE
  CFA7  21C0F0        		LD	HL,DEMES
  CFAA  CD69D8        		CALL	MSX
  CFAD  CDE4DB        		CALL	KEYBC
  CFB0                	AT_DELP2:
  CFB0  CDCAEF        		CALL	_INKEY
  CFB3  28FB          		JR	Z,AT_DELP2
                      	
  CFB5  D1            		POP	DE
  CFB6  CDFEE3        		CALL	CAP
  CFB9  FE52          		CP	'R'		;Retry
  CFBB  200A          		JR	NZ,AT_DELP3
  CFBD  210000        	DHLPAT:	LD	HL,0
  CFC0  3E02          		LD	A,2
  CFC2  3246EE        		LD	(RETRY),A
  CFC5  B7            		OR	A
  CFC6  C9            		RET
  CFC7                	AT_DELP3:
  CFC7  FE49          		CP	'I'		;Ignore
  CFC9  2807          		JR	Z,AT_IGNORE
  CFCB  FE41          		CP	'A'		;Abort
  CFCD  20D7          		JR	NZ,AT_DELP1
  CFCF  C300EF        		JP	BOOT
  CFD2                	AT_IGNORE:
  CFD2  3EFF          		LD	A,0FFH
  CFD4                	AT_ERRZ:
  CFD4  BF            		CP	A
  CFD5                	AT_ERR:
  CFD5  3EFF          		LD	A,0FFH
  CFD7  C9            		RET
                      	
  CFD8                	AT_SCRE:
                      	
  CFD8                	AT_WTTRK:
  CFD8  0601          		LD	B,1
  CFDA  3EF0          		LD	A,0F0H
  CFDC  1802          		JR	AT_WTTRK1
  CFDE                	AT_DWT:
  CFDE  3EA0          		LD	A,0A0H
  CFE0                	AT_WTTRK1:
  CFE0  32E4ED        		LD	(FDCPAT+1),A
  CFE3                	DWTBL:
  CFE3  78            		LD	A,B
  CFE4  3293EE        		LD	(AT_WTB+1+AT_R),A
  CFE7  3E02          		LD	A,2		;Retry count
  CFE9  3246EE        		LD	(RETRY),A
                      	
  CFEC                	DWT0:
  CFEC  D5            		PUSH	DE
  CFED  E5            		PUSH	HL
  CFEE  2245E0        		LD	(DHLPAT+1+AT_RS),HL
  CFF1  CD7EED        		CALL	SEEK		;Write disk
  CFF4  E1            		POP	HL
  CFF5  3838          		JR	C,ERRDW
  CFF7  F3            		DI
  CFF8  3AE4ED        		LD	A,(FDCPAT+1)
  CFFB  CD28EE        		CALL	SECSET
  CFFE  0EFB          		LD	C,0FBH
                      	
  D000                	DWT1:
  D000  56            		LD	D,(HL)
  D001                	DWT2:
  D001  78            		LD	A,B
  D002  DBF8          		IN	A,(0F8H)
  D004  0F            		RRCA
  D005  3008          		JR	NC,DWT4
  D007  0F            		RRCA
  D008  30F7          		JR	NC,DWT2
  D00A                	DWT3:
  D00A  ED51          		OUT	(C),D
  D00C  23            		INC	HL
  D00D  18F1          		JR	DWT1
                      	
  D00F                	DWT4:
  D00F  3D            		DEC	A
  D010  28F8          		JR	Z,DWT3
  D012  3C            		INC	A
  D013  FB            		EI
  D014  D1            		POP	DE
  D015  13            		INC	DE
  D016  CD1CEE        		CALL	FDMOFF
  D019  2808          		JR	Z,DISKOK_WT
  D01B  CD10E0        		CALL	DISKC+AT_RS
  D01E  20CC          		JR	NZ,DWT0
  D020  B7            		OR	A
  D021  2005          		JR	NZ,ERRW
                      	
  D023                	DISKOK_WT:
  D023  0601          	AT_WTB:	LD	B,1
  D025  10BC          		DJNZ	DWTBL
  D027  C9            		RET
                      	
  D028                	ERRW:
  D028  3EFF          		LD	A,0FFH
  D02A                	ERRZ:
  D02A  BF            		CP	A
  D02B  37            		SCF
  D02C  C31CEE        		JP	FDMOFF
                      	
  D02F                	ERRDW:
  D02F  D1            		POP	DE
  D030  CD21E0        		CALL	AT_DELP+AT_RS
  D033  20B7          		JR	NZ,DWT0
  D035  B7            		OR	A
  D036  20F0          		JR	NZ,ERRW
  D038  C9            		RET
                      	
  D039                	AT_DRD:
  D039  3E80          		LD	A,080H
  D03B  32E4ED        		LD	(FDCPAT+1),A
  D03E                	DRDBL:
  D03E  78            		LD	A,B
  D03F  32EAEE        		LD	(AT_RDB+1+AT_R),A
  D042  3E02          		LD	A,2		;Retry count
  D044  3246EE        		LD	(RETRY),A
  D047                	DRD0:
  D047  D5            		PUSH	DE
  D048  E5            		PUSH	HL
  D049  2245E0        		LD	(DHLPAT+1+AT_RS),HL
  D04C  CD7EED        		CALL	SEEK		;Read disk
  D04F  E1            		POP	HL
  D050  382D          		JR	C,ERRDR
  D052  F3            		DI
  D053  3AE4ED        		LD	A,(FDCPAT+1)
  D056  CD28EE        		CALL	SECSET
  D059  0EFB          		LD	C,0FBH
  D05B                	DRD1:
  D05B  78            		LD	A,B
  D05C  DBF8          		IN	A,(0F8H)
  D05E  0F            		RRCA
  D05F  3008          		JR	NC,DRD3
  D061  0F            		RRCA
  D062  30F7          		JR	NC,DRD1
  D064  EDA2          		INI
  D066  04            		INC	B
  D067  18F2          		JR	DRD1
                      	
  D069                	DRD3:
  D069  B7            		OR	A
  D06A  FB            		EI
  D06B  D1            		POP	DE
  D06C  13            		INC	DE
  D06D  CD1CEE        		CALL	FDMOFF
  D070  2808          		JR	Z,DISKOK_RD
  D072  CD10E0        		CALL	DISKC+AT_RS
  D075  20D0          		JR	NZ,DRD0
  D077  B7            		OR	A
  D078  20AE          		JR	NZ,ERRW
                      	
  D07A                	DISKOK_RD:
  D07A  0601          	AT_RDB:	LD	B,1
  D07C  10C0          		DJNZ	DRDBL
  D07E  C9            		RET
                      	
  D07F                	ERRDR:
  D07F  D1            		POP	DE
  D080  CD21E0        		CALL	AT_DELP+AT_RS
  D083  20C2          		JR	NZ,DRD0
  D085  B7            		OR	A
  D086  20A0          		JR	NZ,ERRW
  D088  C9            		RET
                      	
  D089                	AT_CPUE:
                      	
                      	
                      	;	EMM DRIVER(CPU)
                      	
                      	
  D089                	AT_EDWT:
  D089  CD01D8        		CALL	AT_EADR+AT_RE
  D08C                	AT_EDWT0:
  D08C  F5            		PUSH	AF
  D08D  AF            		XOR	A
  D08E                	AT_EDWT1:
  D08E  04            		INC	B
  D08F  EDA3          		OUTI
  D091  04            		INC	B
  D092  EDA3          		OUTI
  D094  3D            		DEC	A
  D095  20F7          		JR	NZ,AT_EDWT1
  D097  13            		INC	DE
  D098  F1            		POP	AF
  D099  3D            		DEC	A
  D09A  20F0          		JR	NZ,AT_EDWT0
  D09C  C9            		RET
                      	
  D09D                	AT_EDRD:
  D09D  CD01D8        		CALL	AT_EADR+AT_RE
  D0A0                	AT_EDRD0:
  D0A0  F5            		PUSH	AF
  D0A1  AF            		XOR	A
  D0A2                	AT_EDRD1:
  D0A2  EDA2          		INI
  D0A4  04            		INC	B
  D0A5  EDA2          		INI
  D0A7  04            		INC	B
  D0A8  3D            		DEC	A
  D0A9  20F7          		JR	NZ,AT_EDRD1
  D0AB  13            		INC	DE
  D0AC  F1            		POP	AF
  D0AD  3D            		DEC	A
  D0AE  20F0          		JR	NZ,AT_EDRD0
  D0B0  C9            		RET
                      	
  D0B1                	AT_EADR:
  D0B1  C5            		PUSH	BC
  D0B2  D5            		PUSH	DE
  D0B3  EB            		EX	DE,HL
  D0B4  29            		ADD	HL,HL
  D0B5  29            		ADD	HL,HL
  D0B6  0E00          		LD	C,0
  D0B8  3AA1EF        		LD	A,(_MAXCYL)
  D0BB  47            		LD	B,A
  D0BC  09            		ADD	HL,BC
  D0BD  3A84EF        		LD	A,(_DRIVE)
  D0C0  4F            		LD	C,A
  D0C1  060D          		LD	B,00DH
  D0C3  ED49          		OUT	(C),C
  D0C5  0C            		INC	C
  D0C6  ED69          		OUT	(C),L
  D0C8  0C            		INC	C
  D0C9  ED61          		OUT	(C),H
  D0CB  0C            		INC	C
  D0CC  EB            		EX	DE,HL
  D0CD  D1            		POP	DE
  D0CE  F1            		POP	AF
  D0CF  A7            		AND	A	;CF=0
  D0D0  C9            		RET
  D0D1                	AT_EMME:
                      	
  D0D1                	AT_TRAP38:
  D0D1  210000        		LD	HL,0
  D0D4  E3            		EX	(SP),HL
  D0D5  3E24          		LD	A,'$'
  D0D7  CD1BDC        		CALL	MSG_A
  D0DA  2B            		DEC	HL
  D0DB  7C            		LD	A,H
  D0DC  CDE8FF        		CALL	PRHX+AT_RT
  D0DF  7D            		LD	A,L
  D0E0                	PRHX:
  D0E0  F5            		PUSH	AF
  D0E1  07            		RLCA
  D0E2  07            		RLCA
  D0E3  07            		RLCA
  D0E4  07            		RLCA
  D0E5  CDF1FF        		CALL	PRHX2+AT_RT
  D0E8  F1            		POP	AF
  D0E9                	PRHX2:
  D0E9  E60F          		AND	00FH
  D0EB  FE0A          		CP	10
  D0ED  3802          		JR	C,PRHX3
  D0EF  C607          		ADD	A,'A'-'0'-10
  D0F1                	PRHX3:
  D0F1  C630          		ADD	A,'0'
  D0F3  C31BDC        		JP	MSG_A
  D0F6                		DS	2
  D0F8                	AT_TRAPE:
                      	
  2F08                	AT_RT	EQU	TRAP38-AT_TRAP38
                      	
  D0F8                	INITE:
  D0F8                		DS	BDOS-INITE
                      	
  D106  C325D8        		JP	BDOS0
  D109                		DS	2	;Reserved
                      	
                      	;LDCCP.ASM
                      	
                      	;	LSX-Dodgers CCP
                      	
  D10B                	WBOOT1:
  D10B  F3            		DI
  D10C  ED7B0600      		LD	SP,(SYSTEM+1)
                      	
  D110  3EEF          		LD	A,INTVEC/256
  D112  ED47          		LD	I,A
                      	
  D114  3EE4          		LD	A,0E4H
  D116  CD36DF        		CALL	COMOUT
  D119  3EC8          		LD	A,INTVEC
  D11B  CD10DF        		CALL	OT49SB
                      	
  D11E  3ABCEF        		LD	A,(CRTCD+12)
  D121  B7            		OR	A
  D122  200C          		JR	NZ,SETCRT0
  D124  2180F8        		LD	HL,0-80*LINE
  D127  22BAEF        		LD	(CRTCD+10),HL
  D12A  21B0FF        		LD	HL,0-80
  D12D  22BCEF        		LD	(CRTCD+12),HL
  D130                	SETCRT0:
  D130  21B0EF        		LD	HL,CRTCD
  D133  AF            		XOR	A
  D134                	SETCRT2:
  D134  010018        		LD	BC,01800H
  D137  ED79          		OUT	(C),A
  D139  0C            		INC	C
  D13A  04            		INC	B
  D13B  EDA3          		OUTI
  D13D  3C            		INC	A
  D13E  FE0C          		CP	12
  D140  20F2          		JR	NZ,SETCRT2
  D142  0D            		DEC	C
  D143  ED79          		OUT	(C),A
  D145  0C            		INC	C
  D146  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
                      	
  D148  0D            		DEC	C
  D149  3C            		INC	A
  D14A  ED79          		OUT	(C),A
  D14C  0C            		INC	C
  D14D  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  D14F  23            		INC	HL
  D150  23            		INC	HL
  D151  01031B        		LD	BC,01A03H+00100H
  D154  EDA3          		OUTI
  D156  01D020        		LD	BC,01FD0H+00100H
  D159  EDA3          		OUTI
  D15B  2192EF        		LD	HL,_KEYD
  D15E  3E03          		LD	A,3
  D160  BE            		CP	(HL)
  D161  CCE4DB        		CALL	Z,KEYBC
  D164  3600          		LD	(HL),0
  D166  3E04          		LD	A,4
  D168  CD1BDC        		CALL	MSG_A
  D16B                	COMMAND:
  D16B  CD1ED2        		CALL	SETDTA1
  D16E  3A87EF        		LD	A,(_DVSW)
  D171  C641          		ADD	A,'A'
  D173  CD1BDC        		CALL	MSG_A
  D176  3E3E          		LD	A,'>'
  D178  CD1BDC        		CALL	MSG_A
  D17B  3E50          		LD	A,80
  D17D  12            		LD	(DE),A
  D17E  CD6ADC        		CALL	_SYS0A		;(BDOS)文字列入力
  D181  CDD3D3        		CALL	LTNL
                      	
  D184  118200        		LD	DE,DTA1+2
  D187  CDFDEF        		CALL	_COMANL
  D18A  30DF          		JR	NC,COMMAND
  D18C  1179EF        		LD	DE,COMERM
  D18F  CD5AD8        		CALL	_SYS09		;(BDOS)文字列出力
  D192  C7            		RST	0
                      	
  D193                	COMANL:
  D193  CDF2E0        		CALL	FILE
  D196  3A19EF        		LD	A,(FNAME+4)
  D199  FE20          		CP	020H
  D19B  201C          		JR	NZ,COMB2
  D19D  D5            		PUSH	DE
  D19E  1115EF        		LD	DE,FNAME
  D1A1  1A            		LD	A,(DE)
  D1A2  FE20          		CP	020H
  D1A4  2844          		JR	Z,SDVSW
  D1A6  1B            		DEC	DE
  D1A7  1A            		LD	A,(DE)
  D1A8  C6FF          		ADD	A,0FFH
  D1AA  3809          		JR	C,COMB
  D1AC  13            		INC	DE
                      	
  D1AD  21DED6        		LD	HL,COMTB
  D1B0  0609          		LD	B,COMS
  D1B2  CD76E3        		CALL	CPNAME
  D1B5                	COMB:
  D1B5  D1            		POP	DE
  D1B6  D20F00        		JP	NC,JP_HL
  D1B9                	COMB2:
  D1B9  EB            		EX	DE,HL
  D1BA  2292D2        		LD	(COMPAT+1),HL
  D1BD  F5            		PUSH	AF
  D1BE  CD3ED2        		CALL	CEXE4
  D1C1  F1            		POP	AF
  D1C2  2115EF        		LD	HL,FNAME
  D1C5  116D00        		LD	DE,FCB2+1	;COMMAND NAME
  D1C8  010B00        		LD	BC,11
  D1CB  EDB0          		LDIR
  D1CD  119DD6        		LD	DE,PATHD
  D1D0                	CEX1:
  D1D0  1A            		LD	A,(DE)
  D1D1  FE20          		CP	020H
  D1D3  D8            		RET	C
  D1D4  CDE7E0        		CALL	FILEC
  D1D7  D5            		PUSH	DE
  D1D8  216D00        		LD	HL,FCB2+1	;COMMAND NAME
  D1DB  1115EF        		LD	DE,FNAME
  D1DE  010B00        		LD	BC,11
  D1E1  EDB0          		LDIR
  D1E3  CD3ED2        		CALL	CEXE4
  D1E6  D1            		POP	DE
  D1E7  13            		INC	DE
  D1E8  18E6          		JR	CEX1
                      	
  D1EA                	SDVSW:
  D1EA  F1            		POP	AF
  D1EB  3A14EF        		LD	A,(FDRV)
  D1EE  3D            		DEC	A
  D1EF  5F            		LD	E,A
  D1F0  0E0E          		LD	C,00EH		;(BDOS)カレントドライブの設定
  D1F2  1831          		JR	SYSTEM0
                      	
  D1F4                	OPEN1:
  D1F4  2114EF        		LD	HL,FDRV
  D1F7                	OPEN:
  D1F7  0E11          		LD	C,011H		;(BDOS)ファイルの検索
  D1F9                	OPEN3:
  D1F9  D5            		PUSH	DE
  D1FA  1178D6        		LD	DE,DTA_CCP
  D1FD  CD1BD2        		CALL	SETDTA
  D200  EB            		EX	DE,HL
  D201  CD25D2        		CALL	SYSTEM0
  D204  D1            		POP	DE
  D205  C9            		RET
                      	
  D206                	OPEN2:
  D206  0E12          		LD	C,012H
  D208  18EF          		JR	OPEN3
                      	
  D20A                	DEFCB:				;Z=Ok NZ=Error
  D20A  1178D6        		LD	DE,DTA_CCP
  D20D  CD23D2        		CALL	SYSC0F
                      	
  D210  1199D6        		LD	DE,DTA_CCP+33	;(FCB)ランダムレコード
  D213  0604          		LD	B,4
  D215  CD11D5        		CALL	ZERO_MEMORY_DE
  D218  110001        		LD	DE,00100H
  D21B                	SETDTA:
  D21B  C35CDA        		JP	_SYS1A		;(BDOS)DTAの設定
                      	
  D21E                	SETDTA1:
  D21E  118000        		LD	DE,DTA1
  D221  18F8          		JR	SETDTA
                      	
  D223                	SYSC0F:
  D223  0E0F          		LD	C,00FH		;(BDOS)ファイルのオープン
  D225                	SYSTEM0:
  D225  CD0500        		CALL	SYSTEM
  D228  B7            		OR	A
  D229  C9            		RET
                      	
  D22A                	C_CD:
  D22A  0E3B          		LD	C,3BH
  D22C  18F7          		JR	SYSTEM0
                      	
  D22E                	S27BUF:
  D22E  3A0700        		LD	A,(SYSTEM+2)
  D231  3D            		DEC	A
  D232  E6F8          		AND	0F8H
  D234  67            		LD	H,A
  D235  2E00          		LD	L,0
  D237                	S27DTA:
  D237  1178D6        		LD	DE,DTA_CCP
  D23A                	S27:
  D23A  0E27          		LD	C,027H		;(BDOS)ランダムブロック読み込み
  D23C  18E7          		JR	SYSTEM0
                      	
  D23E                	CEXE4:
  D23E  3A14EF        		LD	A,(FDRV)
  D241  325700        		LD	(00057H),A
  D244  2A22EF        		LD	HL,(FDRV+14)
  D247  225800        		LD	(00058H),HL
                      	
  D24A  211DEF        		LD	HL,FNAME+8
  D24D  7E            		LD	A,(HL)
  D24E  FE20          		CP	020H
  D250  2007          		JR	NZ,CEXE7
  D252  3E3F          		LD	A,'?'
  D254  77            		LD	(HL),A
  D255  23            		INC	HL
  D256  77            		LD	(HL),A
  D257  23            		INC	HL
  D258  77            		LD	(HL),A
  D259                	CEXE7:
  D259  CDF4D1        		CALL	OPEN1
  D25C                	CEXE5:
  D25C  C0            		RET	NZ
  D25D  2A82D6        		LD	HL,(DTA_CCP+1+9)
  D260  7C            		LD	A,H
  D261  CDFEE3        		CALL	CAP
  D264  67            		LD	H,A
  D265  7D            		LD	A,L
  D266  CDFEE3        		CALL	CAP
  D269  6F            		LD	L,A
  D26A  3A81D6        		LD	A,(DTA_CCP+1+8)
  D26D  CDFEE3        		CALL	CAP
  D270  D642          		SUB	'B'
  D272  282C          		JR	Z,C_BAT
  D274  3D            		DEC	A		;'C'
  D275  2805          		JR	Z,C_EXE
  D277                	CEXE6:
  D277  CD06D2        		CALL	OPEN2
  D27A  18E0          		JR	CEXE5
                      	
  D27C                	C_EXE:
  D27C  7C            		LD	A,H
  D27D  FE4D          		CP	'M'
  D27F  20F6          		JR	NZ,CEXE6
                      	
  D281  CD0AD2        		CALL	DEFCB
  D284  CD2ED2        		CALL	S27BUF
  D287  3D            		DEC	A
  D288  37            		SCF
  D289  C0            		RET	NZ
  D28A  7C            		LD	A,H
  D28B  B5            		OR	L
  D28C  37            		SCF
  D28D  C8            		RET	Z
  D28E  CD1ED2        		CALL	SETDTA1
  D291  110000        	COMPAT:	LD	DE,0				; self-modifying code
  D294  ED7B0600      		LD	SP,(SYSTEM+1)
  D298  67            		LD	H,A				; A=0 in SETDTA1(_SYS1A)
  D299  6F            		LD	L,A
  D29A  E5            		PUSH	HL				; push $0000 (reboot address)
  D29B  24            		INC	H
  D29C  E5            		PUSH	HL				; push $0100 (TPA address)
  D29D  C3DCD4        		JP	SETFCB				; and JP $0100
                      	
  D2A0                	C_BAT:
  D2A0  114154        		LD	DE,'A'+'T'*256
  D2A3  ED52          		SBC	HL,DE
  D2A5  20D0          		JR	NZ,CEXE6
                      	
  D2A7  F1            		POP	AF
  D2A8  F1            		POP	AF
  D2A9  CD0AD2        		CALL	DEFCB
  D2AC  210002        		LD	HL,00200H
  D2AF  CD37D2        		CALL	S27DTA
  D2B2  C6FE          		ADD	A,0FEH
  D2B4  D8            		RET	C
  D2B5  7D            		LD	A,L
  D2B6  B7            		OR	A
  D2B7  37            		SCF
  D2B8  C8            		RET	Z
  D2B9  3C            		INC	A
  D2BA  F5            		PUSH	AF
                      	
  D2BB  CDE4DB        		CALL	KEYBC
  D2BE  3E06          		LD	A,6
  D2C0  CD1BDC        		CALL	MSG_A
  D2C3  C1            		POP	BC
  D2C4  210001        		LD	HL,00100H
  D2C7                	BAT1:
  D2C7  A7            		AND	A
  D2C8  05            		DEC	B
  D2C9  C8            		RET	Z
  D2CA  7E            		LD	A,(HL)
  D2CB  FE25          		CP	'%'
  D2CD  280C          		JR	Z,BAT2
  D2CF                	BAT1X:
  D2CF  7E            		LD	A,(HL)
  D2D0  23            		INC	HL
  D2D1  FE1A          		CP	01AH
  D2D3  C8            		RET	Z
  D2D4  FE0A          		CP	00AH
  D2D6  C4CADB        		CALL	NZ,KEYBS
  D2D9  18EC          		JR	BAT1
                      	
  D2DB                	BAT2:
  D2DB  23            		INC	HL
  D2DC  7E            		LD	A,(HL)
  D2DD  2B            		DEC	HL
  D2DE  D631          		SUB	'1'
  D2E0  38ED          		JR	C,BAT1X
  D2E2  FE09          		CP	9
  D2E4  30E9          		JR	NC,BAT1X
  D2E6  23            		INC	HL
  D2E7  23            		INC	HL
  D2E8  3C            		INC	A
  D2E9  4F            		LD	C,A
  D2EA  ED5B92D2      		LD	DE,(COMPAT+1)
  D2EE                	BAT3:
  D2EE  1A            		LD	A,(DE)
  D2EF  B7            		OR	A
  D2F0  28D5          		JR	Z,BAT1
  D2F2  CDC9E1        		CALL	SPCUT
  D2F5  0D            		DEC	C
  D2F6  2808          		JR	Z,BAT5
  D2F8                	BAT4:
  D2F8  1A            		LD	A,(DE)
  D2F9  FE21          		CP	021H
  D2FB  38F1          		JR	C,BAT3
  D2FD  13            		INC	DE
  D2FE  18F8          		JR	BAT4
  D300                	BAT5:
  D300  1A            		LD	A,(DE)
  D301  FE21          		CP	021H
  D303  38C2          		JR	C,BAT1
  D305  13            		INC	DE
  D306  CDCADB        		CALL	KEYBS
  D309  18F5          		JR	BAT5
                      	
  D30B                	SWITCH:
  D30B  1A            		LD	A,(DE)
  D30C                	SW1:
  D30C  13            		INC	DE
  D30D  B9            		CP	C
  D30E  1A            		LD	A,(DE)
  D30F  C8            		RET	Z
  D310  FE20          		CP	020H
  D312  30F8          		JR	NC,SW1
  D314                	C_REM:
  D314  AF            		XOR	A
  D315  C9            		RET
                      	
  D316                	C_DEL:
  D316  CDDCD4        		CALL	SETFCB
  D319  CD31DC        		CALL	_SYS08		;(BDOS)エコーなしコンソール入力
                      	
  D31C  0E13          		LD	C,013H
  D31E  180A          		JR	CDEL1		;(BDOS)ファイルの削除
                      	
  D320                	C_REN:
  D320  CDDCD4        		CALL	SETFCB
  D323  3E10          		LD	A,010H		;ディレクトリも対象にする
  D325  326900        		LD	(FCB1+13),A	;属性
  D328  0E17          		LD	C,017H		;(BDOS)ファイル名の変更
  D32A                	CDEL1:
  D32A  115C00        		LD	DE,FCB1
  D32D  CD0500        		CALL	SYSTEM
  D330  C6FF          		ADD	A,0FFH
  D332  C9            		RET
                      	
  D333                	C_DIR:
  D333  CDE7E0        		CALL	FILEC
  D336  2115EF        		LD	HL,FDRV+1
  D339  CD6DD6        		CALL	CWILD1
  D33C  3EF1          		LD	A,0F1H
  D33E  3221EF        		LD	(FDRV+13),A
  D341  CDF4D1        		CALL	OPEN1
  D344                	CDIR1:
  D344  B7            		OR	A
  D345  2008          		JR	NZ,PDSKF
  D347  CD92D3        		CALL	P_NAME
  D34A  CD06D2        		CALL	OPEN2
  D34D  18F5          		JR	CDIR1
                      	
  D34F                	PDSKF:
  D34F  3A14EF        		LD	A,(FDRV)
  D352  5F            		LD	E,A
  D353  0E1B          		LD	C,01BH		;(BDOS)ディスク情報の獲得
  D355  CD0500        		CALL	SYSTEM
  D358  4F            		LD	C,A		;C←1クラスタ辺りの論理セクタ数
  D359  C601          		ADD	A,001H
  D35B  D8            		RET	C		;Aが0FFHだった場合
  D35C  AF            		XOR	A
  D35D                	PDS1:				;HL=未使用クラスタの総数
  D35D  CB19          		RR	C
  D35F  3804          		JR	C,PDS2
  D361  29            		ADD	HL,HL
  D362  8F            		ADC	A,A
  D363  18F8          		JR	PDS1
  D365                	PDS2:
  D365  CB50          		BIT	2,B		;B←論理セクタのサイズの上位8ビット
  D367  200A          		JR	NZ,PDSKF1	;K単位(4)になるまで未使用を2で割る
  D369  CB3F          		SRL	A
  D36B  CB1C          		RR	H
  D36D  CB1D          		RR	L
  D36F  CB10          		RL	B
  D371  18F2          		JR	PDS2
  D373                	PDSKF1:
  D373  CD08D4        		CALL	PRDEC_AHL
  D376  1114D7        		LD	DE,KBFREE
  D379  CD5AD8        		CALL	_SYS09		;(BDOS)文字列出力
  D37C  CDFAD3        		CALL	PUTDRV
  D37F  3E5C          		LD	A,05CH
  D381  CD1BDC        		CALL	MSG_A
  D384  2A22EF        		LD	HL,(FDRV+14)	;ディレクトリのクラスタ番号
  D387  AF            		XOR	A
  D388  11FEFF        		LD	DE,0-2
  D38B  19            		ADD	HL,DE
  D38C  23            		INC	HL
  D38D  DC07D4        		CALL	C,PRDEC_HL
  D390  1841          		JR	LTNL
                      	
  D392                	P_NAME:
  D392  3A79D6        		LD	A,(DTA_CCP+1)
  D395  FE2E          		CP	'.'
  D397  C8            		RET	Z
  D398  112DD7        		LD	DE,DIRHD
  D39B  CD5AD8        		CALL	_SYS09		;(BDOS)文字列出力
  D39E  3A84D6        		LD	A,(DTA_CCP+1+00BH)
  D3A1  F5            		PUSH	AF
  D3A2  0F            		RRCA
  D3A3  9F            		SBC	A,A
  D3A4  E60A          		AND	'*'-020H
  D3A6  C620          		ADD	A,020H
  D3A8  CD1BDC        		CALL	MSG_A
  D3AB  CDFAD3        		CALL	PUTDRV
  D3AE  2179D6        		LD	HL,DTA_CCP+1
  D3B1  CD4BD4        		CALL	FPRNT
                      	
  D3B4  F1            		POP	AF
  D3B5  CB67          		BIT	4,A
  D3B7  2808          		JR	Z,DIR3
  D3B9  1122D7        		LD	DE,DIRMES
  D3BC  CD5AD8        		CALL	_SYS09		;(BDOS)文字列出力
  D3BF  180A          		JR	DIR6
  D3C1                	DIR3:
  D3C1  ED5B97D6      		LD	DE,(DTA_CCP+1+01EH)
  D3C5  2A95D6        		LD	HL,(DTA_CCP+1+01CH)
  D3C8  CD0BD4        		CALL	PRDEC_DEHL
  D3CB                	DIR6:
  D3CB  3AB1EF        		LD	A,(CRTCD+1)
  D3CE  FE29          		CP	40+1
  D3D0  D46DD4        		CALL	NC,PRTTMS
                      	
  D3D3                	LTNL:
  D3D3  1E03          		LD	E,3
  D3D5  C3CDEF        		JP	_PRINT
                      	
  D3D8                	C_PATH:
  D3D8  CDC9E1        		CALL	SPCUT
  D3DB  219DD6        		LD	HL,PATHD
  D3DE  FE21          		CP	021H
  D3E0  300C          		JR	NC,CPATH0
  D3E2                	CPATHP:
  D3E2  7E            		LD	A,(HL)
  D3E3  23            		INC	HL
  D3E4  FE20          		CP	020H
  D3E6  3F            		CCF
  D3E7  30EA          		JR	NC,LTNL
  D3E9  CD1BDC        		CALL	MSG_A
  D3EC  18F4          		JR	CPATHP
  D3EE                	CPATH0:
  D3EE  FE3B          		CP	';'
  D3F0  2001          		JR	NZ,CPATH1
  D3F2  13            		INC	DE
  D3F3                	CPATH1:
  D3F3  EB            		EX	DE,HL
  D3F4  014000        		LD	BC,PATHX
  D3F7  EDB0          		LDIR
  D3F9  C9            		RET
                      	
  D3FA                	PUTDRV:
  D3FA  3A14EF        		LD	A,(FDRV)
  D3FD  C640          		ADD	A,'A'-1
  D3FF  CD1BDC        		CALL	MSG_A
  D402  3E3A          		LD	A,':'
  D404                	MSG_AR:
  D404  C31BDC        		JP	MSG_A
                      	
  D407                	PRDEC_HL:
  D407  AF            		XOR	A
  D408                	PRDEC_AHL:
  D408  5F            		LD	E,A
  D409  1600          		LD	D,0
  D40B                	PRDEC_DEHL:
  D40B  D5            		PUSH	DE
  D40C  110FEF        		LD	DE,DECBF
  D40F  0605          		LD	B,5
  D411  CD11D5        		CALL	ZERO_MEMORY_DE	;A=0
  D414  D1            		POP	DE
                      	
  D415  0E20          		LD	C,32
  D417                	DEC1:
  D417  29            		ADD	HL,HL
  D418  EB            		EX	DE,HL
  D419  ED6A          		ADC	HL,HL
  D41B  EB            		EX	DE,HL
  D41C  E5            		PUSH	HL
  D41D  2113EF        		LD	HL,DECBF+4
  D420  0605          		LD	B,5
  D422                	DEC2:
  D422  7E            		LD	A,(HL)
  D423  8F            		ADC	A,A
  D424  27            		DAA
  D425  77            		LD	(HL),A
  D426  2B            		DEC	HL
  D427  10F9          		DJNZ	DEC2
  D429  E1            		POP	HL
  D42A  0D            		DEC	C
  D42B  20EA          		JR	NZ,DEC1
                      	
  D42D  210FEF        		LD	HL,DECBF
  D430  3E20          		LD	A,020H
  D432  0604          		LD	B,4
  D434                	DEC3:
  D434  CD41D4        		CALL	DEC4
  D437  CD41D4        		CALL	DEC4
  D43A  23            		INC	HL
  D43B  10F7          		DJNZ	DEC3
  D43D                	DECX:
  D43D  CD41D4        		CALL	DEC4
  D440  AF            		XOR	A
  D441                	DEC4:
  D441  ED6F          		RLD
  D443  FE20          		CP	020H
  D445  2802          		JR	Z,DEC5
  D447  F630          		OR	030H
  D449                	DEC5:
  D449  18B9          		JR	MSG_AR
                      	
  D44B                	FPRNT:
  D44B  0608          		LD	B,8
  D44D  CD5ED4        		CALL	P_N1
  D450  7E            		LD	A,(HL)
  D451  C680          		ADD	A,0A0H-020H
  D453  FEA0          		CP	0A0H
  D455  2802          		JR	Z,FPR1
  D457  3E2E          		LD	A,'.'
  D459                	FPR1:
  D459  CD1BDC        		CALL	MSG_A
  D45C  0603          		LD	B,3
                      	
  D45E                	P_N1:
  D45E  C5            		PUSH	BC
  D45F  E5            		PUSH	HL
  D460  7E            		LD	A,(HL)
  D461  CD0AE4        		CALL	CAP3
  D464  CD1BDC        		CALL	MSG_A
  D467  E1            		POP	HL
  D468  C1            		POP	BC
  D469  23            		INC	HL
  D46A  10F2          		DJNZ	P_N1
  D46C  C9            		RET
                      	
  D46D                	PRTTMS:
  D46D  3E20          		LD	A,020H
  D46F  CD1BDC        		CALL	MSG_A
                      	
  D472  2A91D6        		LD	HL,(DTA_CCP+1+24)
  D475  7D            		LD	A,L
  D476  B7            		OR	A
  D477  C8            		RET	Z
  D478  CB3C          		SRL	H
  D47A  17            		RLA
  D47B  17            		RLA
  D47C  17            		RLA
  D47D  17            		RLA
  D47E  E60F          		AND	00FH
  D480  57            		LD	D,A
  D481  7C            		LD	A,H
  D482  C650          		ADD	A,80
  D484  CDC7D4        		CALL	PRDEC_A
  D487  3E2D          		LD	A,'-'
  D489  CD1BDC        		CALL	MSG_A
  D48C  7A            		LD	A,D
  D48D  CDC7D4        		CALL	PRDEC_A
  D490  3E2D          		LD	A,'-'
  D492  CD1BDC        		CALL	MSG_A
  D495  7D            		LD	A,L
  D496  E61F          		AND	01FH
  D498  CDC7D4        		CALL	PRDEC_A
                      	
  D49B  2A8FD6        		LD	HL,(DTA_CCP+1+22)
                      	
  D49E  3E20          		LD	A,020H
  D4A0  CD1BDC        		CALL	MSG_A
  D4A3  7C            		LD	A,H
  D4A4  65            		LD	H,L
  D4A5  0603          		LD	B,3
  D4A7                	PRTTMS1:
  D4A7  1F            		RRA
  D4A8  CB1D          		RR	L
  D4AA  10FB          		DJNZ	PRTTMS1
  D4AC  E61F          		AND	01FH
  D4AE  CDC7D4        		CALL	PRDEC_A
  D4B1  3E3A          		LD	A,':'
  D4B3  CD1BDC        		CALL	MSG_A
  D4B6  7D            		LD	A,L
  D4B7  0F            		RRCA
  D4B8  0F            		RRCA
  D4B9  E63F          		AND	03FH
  D4BB  CDC7D4        		CALL	PRDEC_A
  D4BE  3E3A          		LD	A,':'
  D4C0  CD1BDC        		CALL	MSG_A
  D4C3  7C            		LD	A,H
  D4C4  E61F          		AND	01FH
  D4C6  87            		ADD	A,A
                      	
                      	;	PRINT10
                      	
  D4C7                	PRDEC_A:
  D4C7  E5            		PUSH	HL
  D4C8  0608          		LD	B,8
  D4CA  4F            		LD	C,A
  D4CB  AF            		XOR	A
  D4CC                	PRTA1:
  D4CC  CB01          		RLC	C
  D4CE  8F            		ADC	A,A
  D4CF  27            		DAA
  D4D0  10FA          		DJNZ	PRTA1
  D4D2  210FEF        		LD	HL,DECBF
  D4D5  77            		LD	(HL),A
  D4D6  AF            		XOR	A
  D4D7  CD3DD4        		CALL	DECX
  D4DA  E1            		POP	HL
  D4DB  C9            		RET
                      	
  D4DC                	SETFCB:
  D4DC  CDC9E1        		CALL	SPCUT
  D4DF  1A            		LD	A,(DE)
  D4E0  FE20          		CP	020H
  D4E2  3801          		JR	C,SETFCBA
  D4E4  1B            		DEC	DE
  D4E5                	SETFCBA:
  D4E5  0624          		LD	B,36
  D4E7  215C00        		LD	HL,FCB1
  D4EA  E5            		PUSH	HL
  D4EB  AF            		XOR	A
  D4EC  CD9EE1        		CALL	FILL_MEMORY
  D4EF  E1            		POP	HL
  D4F0  D5            		PUSH	DE
  D4F1  CDBBDA        		CALL	_SYS29		;(BDOS)ファイル名の解析
  D4F4  216C00        		LD	HL,FCB2
  D4F7  CDBBDA        		CALL	_SYS29		;(BDOS)ファイル名の解析
  D4FA  E1            		POP	HL
  D4FB  010050        		LD	BC,05000H
  D4FE  118100        		LD	DE,00081H
  D501                	SETFCB1:
  D501  7E            		LD	A,(HL)
  D502  23            		INC	HL
  D503  FE20          		CP	020H
  D505  3805          		JR	C,SETFCB2
  D507  12            		LD	(DE),A
  D508  13            		INC	DE
  D509  0C            		INC	C
  D50A  10F5          		DJNZ	SETFCB1
  D50C                	SETFCB2:
  D50C  79            		LD	A,C
  D50D  328000        		LD	(DTA1),A
  D510  04            		INC	B
  D511                	ZERO_MEMORY_DE:
  D511  AF            		XOR	A
  D512                	FILL_MEMORY_DE:
  D512  12            		LD	(DE),A
  D513  13            		INC	DE
  D514  10FC          		DJNZ	FILL_MEMORY_DE
  D516  C9            		RET
                      	
  D517                	C_COPY:
  D517  CDDCD4        		CALL	SETFCB
  D51A  118100        		LD	DE,DTA1+1
  D51D  0E2F          		LD	C,'/'
  D51F  CD0BD3        		CALL	SWITCH
  D522  CDFEE3        		CALL	CAP
  D525  32ADD5        		LD	(SW+1),A
                      	
  D528  1161EF        		LD	DE,BEEPD
  D52B  CDEAE0        		CALL	FILEC2
  D52E  216C00        		LD	HL,FCB2
  D531  CDC2DA        		CALL	S29X1
                      	
  D534  3E10          		LD	A,010H
  D536  326900        		LD	(FCB1+13),A
  D539  216D00        		LD	HL,FCB2+1
  D53C  CD6DD6        		CALL	CWILD1
  D53F                	COPY0:
  D53F  CD6AD6        		CALL	CWILD
  D542  215C00        		LD	HL,FCB1
  D545  CDF7D1        		CALL	OPEN
  D548  37            		SCF
  D549                	COPY1:
  D549  C0            		RET	NZ
  D54A  CD0AD2        		CALL	DEFCB
                      	
  D54D  3A85D6        		LD	A,(DTA_CCP+13)
  D550  CB67          		BIT	4,A
  D552  2824          		JR	Z,COPY1A
                      	
  D554  215D00        		LD	HL,FCB1+1
  D557  CD2FE5        		CALL	CHKWILD
  D55A  3817          		JR	C,COPY9
                      	
  D55C  3E20          		LD	A,020H
  D55E  325D00        		LD	(FCB1+1),A
  D561  2A92D6        		LD	HL,(DTA_CCP+26)
  D564  23            		INC	HL
  D565  226A00        		LD	(FCB1+14),HL
  D568  18D5          		JR	COPY0
                      	
  D56A                	COPYS:
  D56A  1174EF        		LD	DE,SKIP
  D56D                	COPY8:
  D56D  CD5AD8        		CALL	_SYS09		;(BDOS)文字列出力
  D570  CDD3D3        		CALL	LTNL
  D573                	COPY9:
  D573  CD06D2        		CALL	OPEN2
  D576  18D1          		JR	COPY1
                      	
  D578                	COPY1A:
  D578  216C00        		LD	HL,FCB2
  D57B  1114EF        		LD	DE,FDRV
  D57E  017AD6        		LD	BC,DTA_CCP+2
  D581  EDA0          		LDI
  D583  3E0B          		LD	A,11
  D585                	COPY2:
  D585  F5            		PUSH	AF
  D586  7E            		LD	A,(HL)
  D587  FE3F          		CP	'?'
  D589  2001          		JR	NZ,COPY3
  D58B  0A            		LD	A,(BC)
  D58C                	COPY3:
  D58C  12            		LD	(DE),A
  D58D  03            		INC	BC
  D58E  13            		INC	DE
  D58F  23            		INC	HL
  D590  F1            		POP	AF
  D591  3D            		DEC	A
  D592  20F1          		JR	NZ,COPY2
  D594  010500        		LD	BC,16-11
  D597  EDB0          		LDIR
  D599                	PUTNAME:
  D599  215D00        		LD	HL,FCB1+1
  D59C  CD2FE5        		CALL	CHKWILD
  D59F  300B          		JR	NC,PUTN1
  D5A1  2115EF        		LD	HL,FDRV+1
  D5A4  CD4BD4        		CALL	FPRNT
  D5A7  3E20          		LD	A,020H
  D5A9  CD1BDC        		CALL	MSG_A
  D5AC                	PUTN1:
  D5AC  3E00          	SW:	LD	A,000H
  D5AE  FE54          		CP	'T'
  D5B0  2005          		JR	NZ,CSW1
  D5B2  21CCD5        		LD	HL,SWNE
  D5B5  1807          		JR	SWT1
  D5B7                	CSW1:
  D5B7  FE4E          		CP	'N'
  D5B9  2011          		JR	NZ,SWNE
  D5BB  216AD5        		LD	HL,COPYS
  D5BE                	SWT1:
  D5BE  1114EF        		LD	DE,FDRV
  D5C1  CD23D2        		CALL	SYSC0F
  D5C4  2801          		JR	Z,SWN1
  D5C6  E9            		JP	(HL)
  D5C7                	SWN1:
  D5C7  CD20D6        		CALL	CTIME
  D5CA  309E          		JR	NC,COPYS
  D5CC                	SWNE:
  D5CC  1114EF        		LD	DE,FDRV
  D5CF  0E16          		LD	C,016H		;(BDOS)ファイルの作成
  D5D1  CD25D2        		CALL	SYSTEM0
  D5D4  2048          		JR	NZ,COPYE2
  D5D6  67            		LD	H,A		;A=0
  D5D7  6F            		LD	L,A
  D5D8  2235EF        		LD	(FDRV+33),HL	;(FCB)ランダムレコード
  D5DB  2237EF        		LD	(FDRV+35),HL
  D5DE                	COPY6:
  D5DE  CD2ED2        		CALL	S27BUF
  D5E1  47            		LD	B,A
  D5E2  3C            		INC	A
  D5E3  2831          		JR	Z,COPYE
  D5E5  7C            		LD	A,H
  D5E6  B5            		OR	L
  D5E7  280C          		JR	Z,COPY7
  D5E9  1114EF        		LD	DE,FDRV
  D5EC  0E26          		LD	C,026H		;(BDOS)ランダムブロック書き込み
  D5EE  CD25D2        		CALL	SYSTEM0
  D5F1  2023          		JR	NZ,COPYE
  D5F3  10E9          		DJNZ	COPY6
  D5F5                	COPY7:
  D5F5  3A85D6        		LD	A,(DTA_CCP+13)	;(FCB)属性
  D5F8  3221EF        		LD	(FDRV+13),A
  D5FB  218CD6        		LD	HL,DTA_CCP+20	;(FCB)タイムスタンプ
  D5FE  1128EF        		LD	DE,FDRV+20
  D601  010400        		LD	BC,4
  D604  EDB0          		LDIR
                      	
  D606  1114EF        		LD	DE,FDRV
  D609  0E10          		LD	C,010H		;(BDOS)ファイルのクローズ
  D60B  CD25D2        		CALL	SYSTEM0
  D60E  2006          		JR	NZ,COPYE
                      	
  D610  1171EF        		LD	DE,OK
  D613  C36DD5        		JP	COPY8
                      	
  D616                	COPYE:
  D616  1114EF        		LD	DE,FDRV
  D619  0E13          		LD	C,013H		;(BDOS)ファイルの削除
  D61B  CD0500        		CALL	SYSTEM
  D61E                	COPYE2:
  D61E  37            		SCF
  D61F  C9            		RET
                      	
  D620                	CTIME:
  D620  ED5B8CD6      		LD	DE,(DTA_CCP+20)
  D624  2A28EF        		LD	HL,(FDRV+20)
  D627  A7            		AND	A
  D628  ED52          		SBC	HL,DE
  D62A  C0            		RET	NZ
  D62B  ED5B8ED6      		LD	DE,(DTA_CCP+22)
  D62F  2A2AEF        		LD	HL,(FDRV+22)
  D632  ED52          		SBC	HL,DE
  D634  C9            		RET
                      	
  D635                	C_TYPE:
  D635  CDDCD4        		CALL	SETFCB
  D638  215C00        		LD	HL,FCB1
  D63B  CDF7D1        		CALL	OPEN
  D63E  37            		SCF
  D63F                	TYPE1:
  D63F  C0            		RET	NZ
  D640  CD0AD2        		CALL	DEFCB
  D643  3E06          		LD	A,6
  D645  CD1BDC        		CALL	MSG_A
  D648                	TYPE2:
  D648  CD2ED2        		CALL	S27BUF
  D64B  C6FE          		ADD	A,0FEH
  D64D  D8            		RET	C
  D64E  7C            		LD	A,H
  D64F  B5            		OR	L
  D650  2813          		JR	Z,TYPEE
  D652  010001        		LD	BC,00100H
  D655                	TYPE3:
  D655  0A            		LD	A,(BC)
  D656  03            		INC	BC
  D657  FE1A          		CP	01AH
  D659  280A          		JR	Z,TYPEE
  D65B  CD1BDC        		CALL	MSG_A
  D65E  2B            		DEC	HL
  D65F  7C            		LD	A,H
  D660  B5            		OR	L
  D661  20F2          		JR	NZ,TYPE3
  D663  18E3          		JR	TYPE2
  D665                	TYPEE:
  D665  CD06D2        		CALL	OPEN2
  D668  18D5          		JR	TYPE1
                      	
  D66A                	CWILD:
  D66A  215D00        		LD	HL,FCB1+1
  D66D                	CWILD1:
  D66D  7E            		LD	A,(HL)
  D66E  FE20          		CP	020H
  D670  C0            		RET	NZ
  D671                	CWILD2:
  D671  3E3F          		LD	A,'?'
  D673  060B          		LD	B,11
  D675  C39EE1        		JP	FILL_MEMORY
                      	
  D678                	DTA_CCP:
  D678                		DS	37
                      	
  0040                	PATHX	EQU	64
  D69D                	PATHD:	DS	PATHX
  D6DD  00            	PATHE:	DB	0
                      	
  0009                	COMS	EQU	9
  D6DE                	COMTB:
  D6DE  44202020      		DB	"D   "	;1
  D6E2  33D3          		DW	C_DIR
  D6E4  44495220      		DB	"DIR "	;2
  D6E8  33D3          		DW	C_DIR
  D6EA  434F5059      		DB	"COPY"	;3
  D6EE  17D5          		DW	C_COPY
  D6F0  43442020      		DB	"CD  "	;4
  D6F4  2AD2          		DW	C_CD
  D6F6  44454C20      		DB	"DEL "	;5
  D6FA  16D3          		DW	C_DEL
  D6FC  50415448      		DB	"PATH"	;6
  D700  D8D3          		DW	C_PATH
  D702  52454E20      		DB	"REN "	;7
  D706  20D3          		DW	C_REN
  D708  54595045      		DB	"TYPE"	;8
  D70C  35D6          		DW	C_TYPE
  D70E  52454D20      		DB	"REM "	;9
  D712  14D3          		DW	C_REM
                      	
  D714  6B206279746573	KBFREE:	DB	"k bytes free",9,'$'
  D722  20202020203C44	DIRMES:	DB	"     <DIR>$"
  D72D  20203A24      	DIRHD:	DB	"  :$"
                      	
                      	;LDDISK2.ASM
                      	
                      	;	LSX-Dodgers DISK2
                      	
                      	
                      	;	GRAPHIC RAM DISK DRIVER
                      	
                      	
  D731                	GDRD:
  D731  C5            		PUSH	BC
  D732  CD5AD7        		CALL	GADR
  D735  F1            		POP	AF
  D736                	GDRD1:
  D736  EDA2          		INI
  D738  04            		INC	B
  D739  0C            		INC	C
  D73A  20FA          		JR	NZ,GDRD1
  D73C  04            		INC	B
  D73D  13            		INC	DE
  D73E  3D            		DEC	A
  D73F  20F5          		JR	NZ,GDRD1
  D741                	GBANK0:
  D741  3ABFEF        		LD	A,(WK1FD0)
  D744  E6EF          		AND	0EFH		;BANK0
  D746  181D          		JR	S1FD0
                      	
  D748                	GDWT:
  D748  C5            		PUSH	BC
  D749  CD5AD7        		CALL	GADR
  D74C  F1            		POP	AF
  D74D                	GDWT1:
  D74D  04            		INC	B
  D74E  EDA3          		OUTI
  D750  0C            		INC	C
  D751  20FA          		JR	NZ,GDWT1
  D753  04            		INC	B
  D754  13            		INC	DE
  D755  3D            		DEC	A
  D756  20F5          		JR	NZ,GDWT1
  D758  18E7          		JR	GBANK0
                      	
  D75A                	GADR:
  D75A  0E00          		LD	C,0
  D75C  7B            		LD	A,E
  D75D  C640          		ADD	A,040H
  D75F  47            		LD	B,A
  D760  3ABFEF        		LD	A,(WK1FD0)
  D763  F610          		OR	010H		;BANK1
  D765                	S1FD0:
  D765  C5            		PUSH	BC
  D766  32BFEF        		LD	(WK1FD0),A
  D769  01D01F        		LD	BC,01FD0H
  D76C  ED79          		OUT	(C),A
  D76E  C1            		POP	BC
  D76F  C9            		RET
                      	
                      	
                      	;	BANK RAM DISK DRIVER
                      	
  D770                	BDWT:
  D770  3E            		DB	03EH	;LD A,??
  D771  37            		SCF
  D772  1802          		JR	BRW
                      	
  D774                	BDRD:
  D774  3E            		DB	03EH	;LD A,??
  D775  A7            		AND	A
  D776                	BRW:
  D776  F3            		DI
  D777  329FD7        		LD	(BRWPAT),A
  D77A  ED73BFD7      		LD	(BANKSP+1),SP
  D77E  3AC0D7        		LD	A,(BANKSP+2)
  D781  87            		ADD	A,A
  D782  3803          		JR	C,BRW0
  D784  31CAFF        		LD	SP,EXTSP
  D787                	BRW0:
  D787  D9            		EXX		;裏レジスタ
  D788  C5            		 PUSH	 BC
  D789  D5            		 PUSH	 DE
  D78A  01000B        		 LD	 BC,00B00H	 ;バンクメモリ
  D78D  111010        		 LD	 DE,01010H
  D790  D9            		 EXX		;表レジスタ
  D791                	BRW1:
  D791  C5            		PUSH	BC
  D792  D5            		PUSH	DE
  D793  EB            		EX	DE,HL
  D794  29            		ADD	HL,HL
  D795  29            		ADD	HL,HL
  D796  7C            		LD	A,H
  D797  E60F          		AND	00FH	;バンク
  D799  65            		LD	H,L
  D79A  CB3C          		SRL	H	;/2
  D79C  2E00          		LD	L,0
  D79E  D9            		EXX		;裏レジスタ
  D79F  A7            	BRWPAT:	 AND	 A	;自己書き換え(AND A:読み出し/SCF:書き込み)
  D7A0  3808          		 JR	 C,BRWT
  D7A2  57            		 LD	 D,A	 ;D=バンク
  D7A3  D9            		 EXX		;表レジスタ
  D7A4  EB            		EX	DE,HL
  D7A5  CDC3D7        		CALL	BTFR
  D7A8  1806          		JR	BRW2
  D7AA                	BRWT:
  D7AA  5F            		 LD	E,A	 ;E=バンク
  D7AB  D9            		 EXX		;表レジスタ
  D7AC  CDC3D7        		CALL	BTFR
  D7AF  EB            		EX	DE,HL
  D7B0                	BRW2:
  D7B0  D1            		POP	DE
  D7B1  C1            		POP	BC
  D7B2  13            		INC	DE
  D7B3  10DC          		DJNZ	BRW1
                      	
  D7B5  D9            		EXX		;裏レジスタ
  D7B6  3E10          		 LD	 A,10H
  D7B8  ED79          		 OUT	 (C),A		;メインメモリに切り替える
  D7BA  D1            		 POP	 DE
  D7BB  C1            		 POP	 BC
  D7BC  D9            		 EXX		;表レジスタ
  D7BD  AF            		XOR	A
  D7BE  310000        	BANKSP:	LD	SP,0
  D7C1  FB            		EI
  D7C2  C9            		RET
                      	
                      	;メインメモリ←→バンクメモリ 512バイトの転送を行う
                      	; DE:転送元アドレス
                      	; HL:転送先アドレス
                      	; 裏BC:バンク切り替えポート(0B00H)
                      	; 裏D:転送元バンク(0-0FH:10Hはメインメモリ)
                      	; 裏E:転送先バンク(0-0FH:10Hはメインメモリ)
                      	
  D7C3                	BTFR:
  D7C3  0600          		LD	B,0	;256回ループ(256*2)
  D7C5                	BTFR1:
  D7C5  D9            		EXX		;裏レジスタ
  D7C6  ED51          		 OUT	 (C),D	 ;BANK(MAIN)
  D7C8  D9            		 EXX		;表レジスタ
  D7C9  1A            		LD	A,(DE)
  D7CA  4F            		LD	C,A
  D7CB  13            		INC	DE
  D7CC  1A            		LD	A,(DE)
  D7CD  13            		INC	DE
  D7CE  D9            		EXX		;裏レジスタ
  D7CF  ED59          		 OUT	 (C),E	 ;MAIN(BANK)
  D7D1  D9            		 EXX		;表レジスタ
  D7D2  71            		LD	(HL),C
  D7D3  23            		INC	HL
  D7D4  77            		LD	(HL),A
  D7D5  23            		INC	HL
  D7D6  10ED          		DJNZ	BTFR1
  D7D8  C9            		RET
                      	
                      	;	EMM DRIVER(DMA)
                      	
                      	
  D7D9                	EDWT:
  D7D9  0E0F          		LD	C,15
  D7DB  1802          		JR	EDWT1
  D7DD                	EDRD:
  D7DD  0E0E          		LD	C,14
  D7DF                	EDWT1:
  D7DF  C5            		PUSH	BC
  D7E0  D5            		PUSH	DE
  D7E1  2222D8        		LD	(DMAB),HL
  D7E4  78            		LD	A,B
  D7E5  87            		ADD	A,A
  D7E6  3D            		DEC	A
  D7E7  321BD8        		LD	(DMALEN+1),A
  D7EA  3C            		INC	A
  D7EB  84            		ADD	A,H	;HL(アドレス)を先に進めておく
  D7EC  67            		LD	H,A
  D7ED  EB            		EX	DE,HL
  D7EE  29            		ADD	HL,HL
  D7EF  3AA1EF        		LD	A,(_MAXCYL)
  D7F2  47            		LD	B,A
  D7F3  79            		LD	A,C
  D7F4  0E00          		LD	C,0
  D7F6  09            		ADD	HL,BC
  D7F7  ED4B84EF      		LD	BC,(_DRIVE)
  D7FB  060D          		LD	B,00DH
  D7FD  ED49          		OUT	(C),C
  D7FF  0C            		INC	C
  D800  ED69          		OUT	(C),L
  D802  0C            		INC	C
  D803  ED61          		OUT	(C),H
                      	
  D805  2116D8        		LD	HL,EDMAD
  D808  CDECDF        		CALL	SETDMA
  D80B  CD14E0        		CALL	GO_DMA
  D80E  EB            		EX	DE,HL
  D80F  D1            		POP	DE
  D810  C1            		POP	BC
  D811                	DMA_ADD_SEC:
  D811  13            		INC	DE
  D812  10FD          		DJNZ	DMA_ADD_SEC
  D814  AF            		XOR	A
  D815  C9            		RET
                      	
  D816                	EDMAD:
  D816  C3            		DB	0C3H	;WR6 リセット
  D817  7D            		DB	07DH	;WR0 ポートA→ポートB 転送
  D818  030D          		DW	00D03H	;ポートA開始アドレス EMMリード/ライト
  D81A  FF01          	DMALEN:	DW	001FFH	;ブロック長(転送サイズ-1)
  D81C  2C            		DB	02CH	;WR1 ポートAアドレス固定 I/O
  D81D  50            		DB	050H	;WR2 ポートBアドレスインクリメント メモリ
  D81E  02            		DB	002H	;ポートBタイミング
  D81F  80            		DB	080H	;WR3
  D820  9A            		DB	09AH	;WR5 WAIT RDY:HIGH
  D821  AD            		DB	0ADH	;WR4 連続 ポートB開始アドレス
  D822  0000          	DMAB:	DW	0
  D824  01            		DB	001H	;WR0 ポートA←ポートB 転送
  D825                	EMME:
                      	
  0750                	AT_RE	EQU	EDWT-AT_EDWT
                      	
                      	
                      	;LDOS.ASM
                      	
                      	;	LSX-Dodgers OS
                      	
  D825                	BDOS0:
  D825  E5            		PUSH	HL
  D826  210001        		LD	HL,00100H
  D829  39            		ADD	HL,SP
  D82A  3810          		JR	C,BDOS1X
  D82C                	BDOS2:
  D82C  E1            		POP	HL
  D82D  ED7338D8      		LD	(BDSP+1),SP
  D831  31CAFF        		LD	SP,EXTSP
  D834  CD3BD8        		CALL	BDOS1
  D837  310000        	BDSP:	LD	SP,0
  D83A  C9            		RET
  D83B                	BDOS1:
  D83B  E5            		PUSH	HL
  D83C                	BDOS1X:
  D83C  79            		LD	A,C
  D83D  FE3C          		CP	03CH
  D83F  300B          		JR	NC,OVERFN
  D841  87            		ADD	A,A
  D842  6F            		LD	L,A
  D843  26F0          		LD	H,STABLE/256
  D845  7E            		LD	A,(HL)
  D846  2C            		INC	L
  D847  66            		LD	H,(HL)
  D848  6F            		LD	L,A
  D849  E3            		EX	(SP),HL
  D84A  79            		LD	A,C
  D84B  C9            		RET
  D84C                	OVERFN
  D84C  E1            		POP	HL
  D84D  FE6F          		CP	06FH		;DOSVER MSX-DOS のバージョン番号の獲得
  D84F  2007          		JR	NZ,_ERROR
  D851  011D01        		LD	BC,011DH
  D854  114501        		LD	DE,VER
  D857  AF            		XOR	A
  D858                	_ERROR:
  D858  A7            		AND	A
  D859  C9            		RET
                      	
  D85A                	_SYS09:		;文字列出力
  D85A  D5            		PUSH	DE
  D85B                	_SX09:
  D85B  1A            		LD	A,(DE)
  D85C  13            		INC	DE
  D85D  FE24          		CP	'$'
  D85F  2831          		JR	Z,SX0E2
  D861  CD1BDC        		CALL	MSG_A
  D864  18F5          		JR	_SX09
                      	
  D866                	MSX1:
  D866  CD1BDC        		CALL	MSG_A
  D869                	MSX:
  D869  7E            		LD	A,(HL)
  D86A  23            		INC	HL
  D86B  B7            		OR	A
  D86C  20F8          		JR	NZ,MSX1
  D86E  C9            		RET
                      	
  D86F                	_SYS0C:		;(BDOS)バージョン番号の獲得
  D86F  212200        		LD	HL,00022H
  D872  7D            		LD	A,L
  D873  C9            		RET
                      	
  D874                	_SYS0D:		;(BDOS)ディスクリセット
  D874  CDDFEF        		CALL	_FFLUSH
  D877  E5            		PUSH	HL
  D878  218000        		LD	HL,00080H
  D87B  228AEF        		LD	(_DTA),HL
  D87E  E1            		POP	HL
  D87F  D5            		PUSH	DE
  D880  1E00          		LD	E,0
  D882  3E            		DB	03EH
                      	
  D883                	_SYS0E:		;(BDOS)カレントドライブの設定
  D883  D5            		PUSH	DE
  D884  7B            		LD	A,E
  D885  DDE5          		PUSH	IX
  D887  CDDCEF        		CALL	_GETDPB
  D88A  DDE1          		POP	IX
  D88C  3804          		JR	C,SX0E2
  D88E  7B            		LD	A,E
  D88F  3287EF        		LD	(_DVSW),A
  D892                	SX0E2:
  D892  3E08          		LD	A,8
  D894  D1            		POP	DE
  D895  C9            		RET
                      	
  D896                	_SYS0F:		;(BDOS)ファイルのオープン
  D896  CDDBE1        		CALL	SETDRV
  D899  FD7E1C        		LD	A,(IY+28)	;(FCB)オープンモード
  D89C  C602          		ADD	A,002H		;Write
  D89E  2848          		JR	Z,FEND0F
  D8A0  CD2BE5        		CALL	CHKWILDX
                      	
  D8A3  D4FBE1        		CALL	NC,SOPENX
  D8A6                	_S16XX:
  D8A6  3840          		JR	C,FEND0F
                      					;Directory location
  D8A8  3A9FEF        		LD	A,(_FILEN)
  D8AB  FD7719        		LD	(IY+25),A	;(FCB)ディレクトリロケーション
                      	;				_DIRF
  D8AE  3AA0EF        		LD	A,(_DIRF)
  D8B1  FD771D        		LD	(IY+29),A	;(FCB)ディレクトリモード
                      	;				_FBPS
  D8B4  FD731E        		LD	(IY+30),E	;(FCB)ディレクトリポジション
  D8B7  FD721F        		LD	(IY+31),D
                      	;				Open(Read)
  D8BA  FD361CFF      		LD	(IY+28),0FFH	;(FCB)オープンモード
                      	;				FILENAME
  D8BE  FDE5          		PUSH	IY
  D8C0  D1            		POP	DE
  D8C1  13            		INC	DE
  D8C2  010B00        		LD	BC,11
  D8C5  EDB0          		LDIR
                      	;				Attribute
  D8C7  7E            		LD	A,(HL)
  D8C8  FD770D        		LD	(IY+13),A	;(FCB)属性(アトリビュート)
  D8CB  110B00        		LD	DE,11		;Reserved
  D8CE  19            		ADD	HL,DE
                      						;(FCB)ファイルを最後に変更した時刻
  D8CF  11EAF0        		LD	DE,SDDATA		;(FCB)ファイルを最後に変更した日付
  D8D2  060A          		LD	B,SDDATAE-SDDATA	;(FCB)ファイルの先頭クラスタ
  D8D4                	S16LOOP:				;(FCB)ファイルのサイズ(バイト単位)
  D8D4  1A            		LD	A,(DE)
  D8D5  13            		INC	DE
  D8D6  32DDD8        		LD	(S16PAT+2),A
  D8D9  7E            		LD	A,(HL)
  D8DA  23            		INC	HL
  D8DB  FD7700        	S16PAT:	LD	(IY+0),A
  D8DE  10F4          		DJNZ	S16LOOP
                      	
  D8E0  AF            		XOR	A
  D8E1  FD770C        		LD	(IY+12),A	;(FCB)カレントブロック
  D8E4  FD228AD9      		LD	(OFCB+1),IY
  D8E8                	FEND0F:
  D8E8  1843          		JR	FEND10
                      	
  D8EA                	_SYS10:		;(BDOS)ファイルのクローズ
  D8EA  CDDBE1        		CALL	SETDRV
  D8ED  FD7E1C        		LD	A,(IY+28)	;(FCB)オープンモード
  D8F0  D6FE          		SUB	0FEH
  D8F2  37            		SCF
  D8F3  3F            		CCF
  D8F4  2037          		JR	NZ,FEND10
  D8F6                	_S10A:				;Write
  D8F6  FD770E        		LD	(IY+14),A	;(FCB)レコードサイズ/アクセスするディレクトリのクラスタ番号+1
  D8F9  FD770F        		LD	(IY+15),A
                      	
  D8FC  FD341C        		INC	(IY+28)		;0FEH->0FFH ;オープンモード
  D8FF  CD19E6        		CALL	SETTMS
                      	
  D902  FD7E1D        		LD	A,(IY+29)	;(FCB)ディレクトリモード
  D905  32A0EF        		LD	(_DIRF),A
  D908  E67F          		AND	07FH
  D90A  3288EA        		LD	(_SECPS+1),A
  D90D  FD5E1E        		LD	E,(IY+30)	;(FCB)ディレクトリポジション
  D910  FD561F        		LD	D,(IY+31)
  D913  CD2FE3        		CALL	READ_DIR
  D916  3815          		JR	C,FEND10
                      	
  D918  FD7E19        		LD	A,(IY+25)	;(FCB)ディレクトリロケーション
  D91B  E61F          	SDECM1:	AND	01FH		;自己書き換え(1セクタ辺りのディレクトリエントリ数-1) 1024=01FH / 512=00FH / 256=7
  D91D  6F            		LD	L,A
  D91E  2600          		LD	H,0
  D920  29            		ADD	HL,HL		;*2
  D921  29            		ADD	HL,HL		;*4
  D922  29            		ADD	HL,HL		;*8
  D923  29            		ADD	HL,HL		;*16
  D924  29            		ADD	HL,HL		;*32
  D925  ED4B7EF0      		LD	BC,(_DTBUF)
  D929  09            		ADD	HL,BC
                      	
  D92A  CD3BE5        		CALL	SDIRENT
  D92D                	FEND10:
  D92D  1842          		JR	FEND
                      	
  D92F                	_SYS11:		;(BDOS)最初のファイルの検索
  D92F  CDDBE1        		CALL	SETDRV
  D932  CD28E2        		CALL	SOPEN
  D935                	_S12X1:
  D935  383A          		JR	C,FEND
  D937  CDC8E2        		CALL	SOPENE2
  D93A  ED5B8AEF      		LD	DE,(_DTA)
  D93E  3A88EF        		LD	A,(_DRV)
  D941  3C            		INC	A
  D942  12            		LD	(DE),A
  D943  D5            		PUSH	DE
  D944  13            		INC	DE
  D945  012000        		LD	BC,32
  D948  EDB0          		LDIR
  D94A  FD6E0E        		LD	L,(IY+14)	;(FCB)レコードサイズ/アクセスするディレクトリのクラスタ番号+1
  D94D  FD660F        		LD	H,(IY+15)
  D950  22F4F0        		LD	(SCDIR),HL
  D953  2A9AEF        		LD	HL,(_FBPS)
  D956  22F6F0        		LD	(SFBPS),HL
  D959  2A9FEF        		LD	HL,(_FILEN)
  D95C  7C            		LD	A,H
  D95D  B7            		OR	A
  D95E  2806          		JR	Z,_S12DIR
  D960  3A88EA        		LD	A,(_SECPS+1)
  D963  F680          		OR	080H
  D965  67            		LD	H,A
  D966                	_S12DIR
  D966  22F8F0        		LD	(SFNDF),HL	;Directory position and Flags
  D969  E1            		POP	HL
  D96A  1139EF        		LD	DE,SFILE
  D96D  0E21          		LD	C,33
  D96F                	_S11B:
  D96F  EDB0          		LDIR
  D971                	FEND:
  D971  9F            		SBC	A,A		;CF=0 A=0 : CF=1 A=0FFH
  D972                	FENDE:
  D972  FDE1          		POP	IY
  D974  C1            		POP	BC
  D975  D1            		POP	DE
  D976  E1            		POP	HL
  D977  C9            		RET
                      	
  D978                	_SYS12:		;(BDOS)次のファイルの検索
  D978  E5            		PUSH	HL
  D979  D5            		PUSH	DE
  D97A  C5            		PUSH	BC
  D97B  FDE5          		PUSH	IY
  D97D  CD8CE2        		CALL	NOPEN
  D980  18B3          		JR	_S12X1
                      	
  D982                	_S16K:
  D982  FD7E1C        		LD	A,(IY+28)	;(FCB)オープンモード
  D985  FEFD          		CP	0FDH		;Device(0FDH)
  D987  37            		SCF
  D988  C8            		RET	Z
                      	
  D989  110000        	OFCB:	LD	DE,0
  D98C  D5            		PUSH	DE
  D98D  061A          		LD	B,26		;First cluster
  D98F                	S16K1:
  D98F  13            		INC	DE
  D990  23            		INC	HL
  D991  10FC          		DJNZ	S16K1
                      	
  D993  1A            		LD	A,(DE)
  D994  BE            		CP	(HL)
  D995  2013          		JR	NZ,S16K2
  D997  13            		INC	DE
  D998  23            		INC	HL
  D999  1A            		LD	A,(DE)
  D99A  BE            		CP	(HL)
  D99B  200D          		JR	NZ,S16K2
                      	
  D99D  E1            		POP	HL
  D99E  FDE5          		PUSH	IY
  D9A0  D1            		POP	DE
  D9A1  1A            		LD	A,(DE)		;Drive
  D9A2  BE            		CP	(HL)
  D9A3  2006          		JR	NZ,S16K3
                      					;ここはCFが必ず0
  D9A5  ED52          		SBC	HL,DE		;CP HL,DE
  D9A7  37            		SCF
  D9A8  C0            		RET	NZ
  D9A9  E5            		PUSH	HL
  D9AA                	S16K2:
  D9AA  E1            		POP	HL
  D9AB                	S16K3:
  D9AB  FDE5          		PUSH	IY
  D9AD  D1            		POP	DE
  D9AE                	_SYS13:		;(BDOS)ファイルの削除
  D9AE  CDDBE1        		CALL	SETDRV
  D9B1  CD59E4        		CALL	KILL
  D9B4                	FEND13:
  D9B4  18BB          		JR	FEND
                      	
  D9B6                	_SYS14:		;(BDOS)シーケンシャルな読み出し
  D9B6  CDDBE1        		CALL	SETDRV
  D9B9  CD4BE6        		CALL	PUSHRR
  D9BC  CD8CE6        		CALL	GETSEQ
                      	
  D9BF  CDA0E6        		CALL	RB_READ
  D9C2  E5            		PUSH	HL
  D9C3  CD5FE6        		CALL	SETSEQ
  D9C6                	SREAD:
  D9C6  E1            		POP	HL
                      	
  D9C7  C601          		ADD	A,001H
  D9C9  38A6          		JR	C,FEND
                      	
  D9CB  7D            		LD	A,L
  D9CC  D601          		SUB	001H
  D9CE                	FENDX:
  D9CE  9F            		SBC	A,A
  D9CF  E603          		AND	3
  D9D1  1F            		RRA
  D9D2  189E          		JR	FENDE
                      	
  D9D4                	_SYS15:		;(BDOS)シーケンシャルな書き込み
  D9D4  CDDBE1        		CALL	SETDRV
  D9D7  CD4BE6        		CALL	PUSHRR
  D9DA  CD8CE6        		CALL	GETSEQ
                      	
  D9DD  CD99E6        		CALL	RB_WRITE
  D9E0  E5            		PUSH	HL
  D9E1  CD5FE6        		CALL	SETSEQ
  D9E4                	SWRITE:
  D9E4  E1            		POP	HL
                      	
  D9E5  C6FF          		ADD	A,0FFH
  D9E7  18E5          		JR	FENDX
                      	
  D9E9                	_SYS17:		;(BDOS)ファイル名の変更
  D9E9  CDDBE1        		CALL	SETDRV
  D9EC  CDB1E4        		CALL	NAME
  D9EF  18C3          		JR	FEND13
                      	
  D9F1                	_SYS16:		;(BDOS)ファイルの作成
  D9F1  CDDBE1        		CALL	SETDRV
                      	
  D9F4  CD2BE5        		CALL	CHKWILDX
  D9F7  38BB          		JR	C,FEND13
  D9F9  FD7E01        		LD	A,(IY+1)	;(FCB)主ファイル名
  D9FC  FE05          		CP	5
  D9FE  2805          		JR	Z,_S16X2
  DA00  FE21          		CP	021H
  DA02  DAB4D9        		JP	C,FEND13
  DA05                	_S16X2:
                      	;				Clear FCB
  DA05  FDE5          		PUSH	IY
  DA07  E1            		POP	HL
  DA08  011000        		LD	BC,16
  DA0B  09            		ADD	HL,BC
  DA0C                	_S16X1:
  DA0C  70            		LD	(HL),B		;B=0
  DA0D  23            		INC	HL
  DA0E  0D            		DEC	C
  DA0F  20FB          		JR	NZ,_S16X1
                      	
  DA11  CD1EE6        		CALL	SETTMSX
  DA14  FD360DFF      		LD	(IY+13),0FFH	;(FCB)Attribute
  DA18  CDFBE1        		CALL	SOPENX
  DA1B  3F            		CCF
  DA1C  CC82D9        		CALL	Z,_S16K
  DA1F  D4D9E2        		CALL	NC,COPEN
  DA22  D43BE5        		CALL	NC,SDIRENT
  DA25  C3A6D8        		JP	_S16XX
                      	
  DA28                	_SYS21:		;(BDOS)ランダムな読み出し
                      	
  DA28  CDDBE1        		CALL	SETDRV
  DA2B  CD4BE6        		CALL	PUSHRR
  DA2E  FD6E21        		LD	L,(IY+33)	;(FCB)Random record
  DA31  FD6622        		LD	H,(IY+34)
                      	
  DA34  CDA0E6        		CALL	RB_READ
  DA37  E5            		PUSH	HL
  DA38  CD76E6        		CALL	POPRR
  DA3B  1889          		JR	SREAD
                      	
  DA3D                	_SYS22:		;(BDOS)ランダムな書き込み
  DA3D                	_SYS28:		;(BDOS)ランダムな書き込み・その2
  DA3D  CDDBE1        		CALL	SETDRV
  DA40  CD4BE6        		CALL	PUSHRR
  DA43  FD6E21        		LD	L,(IY+33)	;(FCB)Random record
  DA46  FD6622        		LD	H,(IY+34)
                      	
  DA49  CD99E6        		CALL	RB_WRITE
  DA4C  E5            		PUSH	HL
  DA4D  CD76E6        		CALL	POPRR
  DA50  1892          		JR	SWRITE
                      	
  DA52                	_SYS18:		;(BDOS)ログインベクトルの獲得
  DA52  21FF00        		LD	HL,000FFH
  DA55  AF            		XOR	A
  DA56  C9            		RET
                      	
  DA57                	_SYS19:		;(BDOS)カレントドライブ番号の獲得
  DA57  3A87EF        		LD	A,(_DVSW)
  DA5A  A7            		AND	A
  DA5B  C9            		RET
                      	
  DA5C                	_SYS1A:		;(BDOS)DTAの設定
  DA5C  ED538AEF      		LD	(_DTA),DE
  DA60  AF            		XOR	A
  DA61  C9            		RET
                      	
  DA62                	_SYS1B:		;(BDOS)ディスク情報の獲得
  DA62  7B            		LD	A,E
  DA63  CDEEE1        		CALL	GETDRV
  DA66  CDDCEF        		CALL	_GETDPB
  DA69  D4E2EF        		CALL	NC,_RDFATX
  DA6C  210000        		LD	HL,0
  DA6F  D4F7E5        		CALL	NC,DSKF
                      	
  DA72  ED5BF8E5      		LD	DE,(MAXCLP+1)	;DPB_08_MAXCL-1
  DA76  1B            		DEC	DE		;DE←クラスタの総数
  DA77  FD2A7CF0      		LD	IY,(_FATBF)	;IY←メモリ上のFATの先頭アドレス
  DA7B  9F            		SBC	A,A
  DA7C  D8            		RET	C
  DA7D  4F            		LD	C,A		;C=0
  DA7E  DD7E0F        		LD	A,(IX+00FH)	;DPB_0F_BPS
  DA81  E60F          		AND	00FH
  DA83  47            		LD	B,A
  DA84  DD7E07        		LD	A,(IX+7)	;DPB_07_SECPCL
  DA87  C9            		RET
                      	
  DA88                	_SYS1D:		;(BDOS)書き込みが禁止されているディスクの調査
  DA88  AF            		XOR	A
  DA89  67            		LD	H,A
  DA8A  6F            		LD	L,A
  DA8B  C9            		RET
                      	
  DA8C                	_SYS1F:		;(BDOS)ディスク装置のパラメータの読み出し
  DA8C  2100F1        		LD	HL,DEVICE
  DA8F  7B            		LD	A,E
  DA90  C3DCEF        		JP	_GETDPB
                      	
  DA93                	_SYS23:		;(BDOS)ファイルサイズの獲得
  DA93  E5            		PUSH	HL
  DA94  2A1EF0        		LD	HL,(STABLE+2*00FH)	;ファイルのオープン
  DA97  CD0F00        		CALL	JP_HL
  DA9A  3814          		JR	C,_S23X1
                      	
  DA9C  D5            		PUSH	DE		;EX DE,IY
  DA9D  FDE3          		EX	(SP),IY		;
                      	;	POP	DE		;
                      	;	PUSH	DE		;DEを破壊しないように注意vv
  DA9F  CD7CE6        		CALL	GETSIZE
  DAA2                	_S24X1:
  DAA2  FD7521        		LD	(IY+33),L	;(FCB)Random record
  DAA5  FD7422        		LD	(IY+34),H
  DAA8  FD362300      		LD	(IY+35),0
                      	;	POP	DE		;^^^^^^^^^^^^^^^^^^^^^^^^
                      	;	PUSH	DE		;EX DE,IY
  DAAC  FDE3          		EX	(SP),IY		;
  DAAE  D1            		POP	DE		;
                      	
  DAAF  AF            		XOR	A
  DAB0                	_S23X1:
  DAB0  E1            		POP	HL
  DAB1  C9            		RET
                      	
  DAB2                	_SYS24:		;(BDOS)ランダムレコードフィールドの設定
  DAB2  E5            		PUSH	HL
  DAB3  D5            		PUSH	DE		;EX DE,IY
  DAB4  FDE3          		EX	(SP),IY		;
                      	;	POP	DE		;
                      	;	PUSH	DE		;DEを破壊しないように注意vv
  DAB6  CD8CE6        		CALL	GETSEQ
  DAB9  18E7          		JR	_S24X1		;^^^^^^^^^^^^^^^^^^^^^^^^
                      	
  DABB                	_SYS29:		;(BDOS)ファイル名の解析
  DABB  C5            		PUSH	BC
  DABC  E5            		PUSH	HL
  DABD  CDF2E0        		CALL	FILE
  DAC0  E1            		POP	HL
  DAC1  C1            		POP	BC
  DAC2                	S29X1:
  DAC2  C5            		PUSH	BC
  DAC3  D5            		PUSH	DE
  DAC4  E5            		PUSH	HL
  DAC5  EB            		EX	DE,HL
  DAC6  2114EF        		LD	HL,FDRV
  DAC9  010D00        		LD	BC,13
  DACC  EDB0          		LDIR
  DACE  70            		LD	(HL),B		;B=0
  DACF  0E03          		LD	C,3
  DAD1  EDB0          		LDIR
  DAD3  E1            		POP	HL
  DAD4  D1            		POP	DE
  DAD5  C1            		POP	BC
  DAD6  AF            		XOR	A
  DAD7  C9            		RET
                      	
  DAD8                	_SYS30:		;(BDOS)論理セクタを用いた書き込み
  DAD8  C5            		PUSH	BC
  DAD9  01F8EB        		LD	BC,DWT24B
  DADC  1804          		JR	S2FX
  DADE                	_SYS2F:
  DADE  C5            		PUSH	BC
  DADF  01E8EB        		LD	BC,DRD24B
  DAE2                	S2FX:
  DAE2  ED43F8DA      		LD	(S2FPAT+1),BC
  DAE6  CDDFEF        		CALL	_FFLUSH
                      	
  DAE9  D5            		PUSH	DE
  DAEA  E5            		PUSH	HL
  DAEB  7D            		LD	A,L		;Drive
  DAEC  CDD9EF        		CALL	_CHGDRV
  DAEF  3809          		JR	C,S30X2
  DAF1  44            		LD	B,H		;Number of clusters
  DAF2  2A8AEF        		LD	HL,(_DTA)
                      	
  DAF5  0E00          		LD	C,0
  DAF7  CDE8EB        	S2FPAT:	CALL	DRD24B
  DAFA                	S30X2:
  DAFA  E1            		POP	HL
  DAFB  D1            		POP	DE
  DAFC  C1            		POP	BC
  DAFD  9F            		SBC	A,A
  DAFE  C9            		RET
                      	
  DAFF                	_SYS3B:		;(BDOS)カレントディレクトリの変更
  DAFF  C5            		PUSH	BC
  DB00  D5            		PUSH	DE
  DB01  E5            		PUSH	HL
  DB02  CDE7E0        		CALL	FILEC
  DB05  210000        		LD	HL,0
  DB08  1114EF        		LD	DE,FDRV
  DB0B  2A4EF0        		LD	HL,(STABLE+2*027H)	;ランダムブロック読み込み
  DB0E  CD0F00        		CALL	JP_HL
  DB11  18E7          		JR	S30X2
                      	
                      	;LDIO.ASM
                      	
                      	;	LSX-Dodgers IO
                      	
  D858                	_SYS04	EQU	_ERROR		;(BDOS)外部出力
  D858                	_SYS05	EQU	_ERROR		;(BDOS)プリンタ出力
  D858                	_SYS1C	EQU	_ERROR		;(BDOS)ディスクの書き込み禁止化
  D858                	_SYS1E	EQU	_ERROR		;(BDOS)ファイル属性の設定
  D858                	_SYS20	EQU	_ERROR		;(BDOS)利用者番号の設定と読み出し
  D858                	_SYS2E	EQU	_ERROR		;(BDOS)ベリファイ・フラグの設定
                      	
  DB13                	BIOS:
  DB13  E5            		PUSH	HL
  DB14  211080        		LD	HL,08010H
  DB17  39            		ADD	HL,SP
  DB18  E1            		POP	HL
  DB19  300E          		JR	NC,BIOS2
  DB1B                	BIOS1:
  DB1B  CD23DB        		CALL	BIOS3
  DB1E  061E          		LD	B,01EH
  DB20  ED79          		OUT	(C),A
  DB22  C9            		RET
  DB23                	BIOS3:
  DB23  C5            		PUSH	BC
  DB24  061D          		LD	B,01DH
  DB26  ED79          		OUT	(C),A
  DB28  C9            		RET
  DB29                	BIOS2:
  DB29  ED7334DB      		LD	(SPPAT+1),SP	;スタックがBIOS-ROMと被っている場合
  DB2D  31CAFF        		LD	SP,EXTSP
  DB30  CD1BDB        		CALL	BIOS1
  DB33  310000        	SPPAT:	LD	SP,0
  DB36  C9            		RET
                      	
  DB37                	INT:
  DB37  F5            		PUSH	AF
  DB38  E5            		PUSH	HL
  DB39  ED734ADB      		LD	(INTSP+1),SP
  DB3D  210001        		LD	HL,00100H
  DB40  39            		ADD	HL,SP
  DB41  3803          		JR	C,INTP1X
  DB43  31CAFF        		LD	SP,EXTSP
  DB46                	INTP1X:
  DB46  CD51DB        		CALL	INTP1
  DB49  310000        	INTSP:	LD	SP,0
  DB4C                	INTPE:
  DB4C  E1            		POP	HL
  DB4D                	INTPE2:
  DB4D  F1            		POP	AF
  DB4E                	INTCTCE:
  DB4E  FB            		EI
  DB4F  ED4D          		RETI
  DB51                	INTP1:
  DB51  C5            		PUSH	BC
                      	
  DB52  CD1BDF        		CALL	IN49SB
  DB55  67            		LD	H,A
  DB56  CD1BDF        		CALL	IN49SB
  DB59  6F            		LD	L,A
                      	
  DB5A  FE08          		CP	8		;DELキー
  DB5C  2005          		JR	NZ,SCEXE
  DB5E  7C            		LD	A,H
  DB5F  E611          		AND	011H		;CTRLキー + GRAPHキー
  DB61  2808          		JR	Z,RESET
  DB63                	SCEXE:
  DB63  2292EF        		LD	(_KEYD),HL
  DB66  CD97DB        		CALL	KEYSET1
                      	
  DB69  C1            		POP	BC
  DB6A  C9            		RET
                      	
  DB6B                	RESET:
  DB6B  3E1D          		LD	A,01DH
  DB6D  D300          		OUT	(0),A
  DB6F  C7            		RST	0
                      	
  DB70                	INTCTC2:
  DB70  F5            		PUSH	AF
  DB71  3E00          	INTCPAT:LD	A,000H
  DB73  3D            		DEC	A
  DB74  3272DB        		LD	(INTCPAT+1),A
  DB77  20D4          		JR	NZ,INTPE2
                      	
  DB79  3A92EF        		LD	A,(_KEYD)
  DB7C  B7            		OR	A
  DB7D  28CE          		JR	Z,INTPE2
  DB7F                	KEYSET0:
  DB7F  E5            		PUSH	HL
  DB80  2A90EF        		LD	HL,(_KEYPS)
  DB83  7C            		LD	A,H
  DB84  AD            		XOR	L
  DB85  2006          		JR	NZ,INTC2A
                      	
  DB87  2A92EF        		LD	HL,(_KEYD)
  DB8A  CDC1DB        		CALL	KEYSET
  DB8D                	INTC2A:
  DB8D  3A94EF        		LD	A,(_KEYSP)
  DB90  E60F          		AND	00FH
  DB92  3272DB        		LD	(INTCPAT+1),A
                      	
  DB95  18B5          		JR	INTPE
                      	
  DB97                	KEYSET1:
  DB97  CB6C          		BIT	5,H
  DB99  F5            		PUSH	AF
  DB9A  ED4B8CEF      		LD	BC,(_CTC)
  DB9E  78            		LD	A,B
  DB9F  B1            		OR	C
  DBA0  2006          		JR	NZ,KEYS10E
                      	
  DBA2  F1            		POP	AF
  DBA3  201C          		JR	NZ,KEYSET
  DBA5  F5            		PUSH	AF
  DBA6  18D7          		JR	KEYSET0
  DBA8                	KEYS10E:
  DBA8  F1            		POP	AF
  DBA9  C8            		RET	Z
  DBAA  F5            		PUSH	AF
  DBAB  3E03          		LD	A,3		;CTC STOP
  DBAD  ED79          		OUT	(C),A
  DBAF  F1            		POP	AF
                      	
  DBB0  B7            		OR	A
  DBB1  C8            		RET	Z
                      	
  DBB2  E5            		PUSH	HL
  DBB3  2A94EF        		LD	HL,(_KEYSP)
  DBB6  3EA7          		LD	A,0A7H
  DBB8  ED79          		OUT	(C),A
  DBBA  ED69          		OUT	(C),L
  DBBC  7C            		LD	A,H
  DBBD  3272DB        		LD	(INTCPAT+1),A
  DBC0  E1            		POP	HL
                      	
  DBC1                	KEYSET:
  DBC1  7D            		LD	A,L
  DBC2  CB7C          		BIT	7,H
  DBC4  CCF1DB        		CALL	Z,FKEY
  DBC7  CB74          		BIT	6,H
  DBC9  C0            		RET	NZ
  DBCA                	KEYBS:
  DBCA  B7            		OR	A
  DBCB  C8            		RET	Z
  DBCC                	KEYBS1:
  DBCC  FE03          		CP	3
  DBCE  CCE4DB        		CALL	Z,KEYBC
  DBD1  E5            		PUSH	HL
  DBD2  F5            		PUSH	AF
  DBD3  2A90EF        		LD	HL,(_KEYPS)
  DBD6  2C            		INC	L
  DBD7  7D            		LD	A,L
  DBD8  BC            		CP	H
  DBD9  2812          		JR	Z,POP_AF_HL_SCF_RET
  DBDB  3290EF        		LD	(_KEYPS),A
  DBDE  26FE          		LD	H,KEYBF/256
  DBE0  F1            		POP	AF
  DBE1  77            		LD	(HL),A
  DBE2  E1            		POP	HL
  DBE3  C9            		RET
                      	
  DBE4                	KEYBC:
  DBE4  E5            		PUSH	HL
  DBE5  210000        		LD	HL,0
  DBE8  2290EF        		LD	(_KEYPS),HL
  DBEB  E1            		POP	HL
  DBEC  C9            		RET
                      	
  DBED                	POP_AF_HL_SCF_RET:
  DBED  F1            		POP	AF
  DBEE  E1            		POP	HL
  DBEF  37            		SCF
  DBF0  C9            		RET
                      	
  DBF1                	FKEY:
  DBF1  CB75          		BIT	6,L
  DBF3  C8            		RET	Z
  DBF4  3E1B          		LD	A,01BH
  DBF6  CDCCDB        		CALL	KEYBS1
  DBF9  7D            		LD	A,L
  DBFA  C6AF          		ADD	A,020H-'q'
  DBFC  CB7D          		BIT	7,L
  DBFE  C8            		RET	Z
  DBFF  2E50          		LD	L,'P'
  DC01  D690          		SUB	0E1H+020H-'q'
  DC03  2810          		JR	Z,KEYBSL
  DC05  2C            		INC	L
  DC06  3D            		DEC	A
  DC07  280C          		JR	Z,KEYBSL
  DC09  2C            		INC	L
  DC0A  D609          		SUB	0EBH-0E2H
  DC0C  2807          		JR	Z,KEYBSL
  DC0E  2E43          		LD	L,'C'
  DC10  3D            		DEC	A
  DC11  2802          		JR	Z,KEYBSL
  DC13  2E58          		LD	L,'X'
  DC15                	KEYBSL:
  DC15  7D            		LD	A,L
  DC16  18B4          		JR	KEYBS1
                      	
  DC18                	_SYS01:		;(BDOS)コンソール入力
  DC18  CD09EF        		CALL	_SYS07
  DC1B                	MSG_A:
  DC1B  F5            		PUSH	AF
  DC1C  D5            		PUSH	DE
  DC1D  5F            		LD	E,A
  DC1E  CD24DC        		CALL	_SYS02
  DC21  D1            		POP	DE
  DC22  F1            		POP	AF
  DC23  C9            		RET
                      	
  DC24                	_SYS02:		;(BDOS)コンソール出力
  DC24  CD36DC        		CALL	BREAK
  DC27  1805          		JR	PRINTX
                      	
  DC29                	_SYS06:		;(BDOS)コンソール直接入出力
  DC29  7B            		LD	A,E
  DC2A  3C            		INC	A
  DC2B  CACAEF        		JP	Z,_INKEY
  DC2E                	PRINTX:
  DC2E  C3CDEF        		JP	_PRINT
                      	
  DC31                	_SYS08:		;(BDOS)エコーなしコンソール入力
  DC31  CD09EF        		CALL	_SYS07
  DC34  1804          		JR	BREAK1
  DC36                	BREAK:
  DC36  FB            		EI
  DC37  3A92EF        		LD	A,(_KEYD)
  DC3A                	BREAK1:
  DC3A  FE03          		CP	3
  DC3C  CA0000        		JP	Z,0
  DC3F  FE13          		CP	013H
  DC41  C0            		RET	NZ
                      	
  DC42                	PAUSE:
  DC42  CDE4DB        		CALL	KEYBC
                      	
  DC45                	FLGET:
  DC45  CDDFEF        		CALL	_FFLUSH
  DC48  C5            		PUSH	BC
  DC49  E5            		PUSH	HL
  DC4A  ED4B8EEF      		LD	BC,(_TXADR)
  DC4E  CBE8          		SET	5,B
  DC50  ED60          		IN	H,(C)
  DC52                	FLGET1:
  DC52  3A93EF        		LD	A,(_KEYD+1)
  DC55  0F            		RRCA
  DC56  0F            		RRCA
  DC57  E610          		AND	010H
  DC59  F608          		OR	8
  DC5B  ED68          		IN	L,(C)
  DC5D  B5            		OR	L
  DC5E  ED79          		OUT	(C),A
  DC60  CDCAEF        		CALL	_INKEY
  DC63  28ED          		JR	Z,FLGET1
  DC65  ED61          		OUT	(C),H
  DC67  E1            		POP	HL
  DC68  C1            		POP	BC
  DC69  C9            		RET
                      	
  DC6A                	_SYS0A:		;(BDOS)文字列入力
  DC6A  C5            		PUSH	BC
  DC6B  E5            		PUSH	HL
  DC6C  D5            		PUSH	DE
  DC6D  CD78E0        		CALL	GETL
  DC70  1100FF        		LD	DE,KBUF
  DC73  E1            		POP	HL
  DC74  E5            		PUSH	HL
  DC75  0E00          		LD	C,0
  DC77  3004          		JR	NC,SAX0
  DC79  23            		INC	HL
  DC7A  23            		INC	HL
  DC7B  1808          		JR	SAX4
  DC7D                	SAX0:
  DC7D  46            		LD	B,(HL)
  DC7E  23            		INC	HL
  DC7F                	SAX1:
  DC7F  23            		INC	HL
  DC80  1A            		LD	A,(DE)
  DC81  13            		INC	DE
  DC82  B7            		OR	A
  DC83  2004          		JR	NZ,SAX2
  DC85                	SAX4:
  DC85  360D          		LD	(HL),00DH
  DC87  1804          		JR	SAX3
  DC89                	SAX2:
  DC89  77            		LD	(HL),A
  DC8A  0C            		INC	C
  DC8B  10F2          		DJNZ	SAX1
  DC8D                	SAX3:
  DC8D  D1            		POP	DE
  DC8E  79            		LD	A,C
  DC8F  13            		INC	DE
  DC90  12            		LD	(DE),A
  DC91  1B            		DEC	DE
  DC92  E1            		POP	HL
  DC93  C1            		POP	BC
  DC94  A7            		AND	A
  DC95  C9            		RET
                      	
  DC96                	_SYS0B:		;(BDOS)コンソール状態のチェック
  DC96  CD36DC        		CALL	BREAK
  DC99  3A92EF        		LD	A,(_KEYD)
  DC9C  B7            		OR	A
  DC9D  C8            		RET	Z
  DC9E                	CONSTX:
  DC9E  CDDFEF        		CALL	_FFLUSH
  DCA1  E5            		PUSH	HL
  DCA2  2A90EF        		LD	HL,(_KEYPS)
  DCA5  7C            		LD	A,H
  DCA6  AD            		XOR	L
  DCA7  E1            		POP	HL
  DCA8  C6FF          		ADD	A,0FFH
  DCAA  9F            		SBC	A,A
  DCAB  C9            		RET
                      	
  DCAC                	_SYS2A:		;(BDOS)日付の獲得
  DCAC  C5            		PUSH	BC
  DCAD  3EED          		LD	A,0EDH		;Read calendar
  DCAF  CD36DF        		CALL	COMOUT
  DCB2  CDCFDC        		CALL	IN49SB_BCD	;YY
  DCB5  6F            		LD	L,A
  DCB6  2600          		LD	H,0
                      	;	LD	DE,1900		;0076CH
                      	;	CP	90		;90以上は1900年代 1990-1999
                      	;	JR	NC,RDDATE1	;90未満は2000年代 2000-2089
                      	;	LD	E,0D0H		;2000 & 0FFH D=007H
  DCB8  11D007        		LD	DE,2000		;すべて2000年代で処理 2000-2099
  DCBB                	RDDATE1:
  DCBB  19            		ADD	HL,DE
  DCBC  CD1BDF        		CALL	IN49SB		;MM
  DCBF  57            		LD	D,A
  DCC0  CDCFDC        		CALL	IN49SB_BCD	;DD
  DCC3  5F            		LD	E,A
  DCC4  7A            		LD	A,D
  DCC5  E607          		AND	7
  DCC7  0604          		LD	B,4
  DCC9                	RDDATE2:
  DCC9  CB3A          		SRL	D
  DCCB  10FC          		DJNZ	RDDATE2
  DCCD  C1            		POP	BC
  DCCE  C9            		RET
  DCCF                	IN49SB_BCD:
  DCCF  CD1BDF        		CALL	IN49SB
                      	;------------------------
                      	;BCDの10進数化
                      	;in
                      	;	A  : BCD
                      	;out
                      	;	A  : 10進数
                      	;------------------------
  DCD2  4F            		LD	C,A
  DCD3  E6F0          		AND	0F0H	;10の位
  DCD5  0F            		RRCA
  DCD6  47            		LD	B,A
  DCD7  0F            		RRCA
  DCD8  0F            		RRCA
  DCD9  80            		ADD	A,B
  DCDA  47            		LD	B,A
  DCDB  79            		LD	A,C
  DCDC  E60F          		AND	00FH	;1の位
  DCDE  80            		ADD	A,B
  DCDF  C9            		RET
                      	
  DCE0                	_SYS2C:		;(BDOS)時刻の獲得
  DCE0  C5            		PUSH	BC
  DCE1  3EEF          		LD	A,0EFH		;Read time
  DCE3  CD36DF        		CALL	COMOUT
  DCE6  CDCFDC        		CALL	IN49SB_BCD	;TT
  DCE9  67            		LD	H,A
  DCEA  CDCFDC        		CALL	IN49SB_BCD	;MM
  DCED  6F            		LD	L,A
  DCEE  CDCFDC        		CALL	IN49SB_BCD	;SS
  DCF1  57            		LD	D,A
  DCF2  C1            		POP	BC
  DCF3  AF            		XOR	A
  DCF4  C9            		RET
                      	
  DCF5                	ESC1:
  DCF5  7B            		LD	A,E
  DCF6  FE41          		CP	'A'
  DCF8  CA39DE        		JP	Z,CTRL1E
  DCFB  FE42          		CP	'B'
  DCFD  CAA1DF        		JP	Z,CTRL1F
  DD00  FE43          		CP	'C'
  DD02  CA44DE        		JP	Z,CTRL1C
  DD05  FE44          		CP	'D'
  DD07  CA30DE        		JP	Z,CTRL1D
  DD0A  FE45          		CP	'E'
  DD0C  2802          		JR	Z,CT0CX
  DD0E  FE6A          		CP	'j'
  DD10                	CT0CX:
  DD10  CA74DF        		JP	Z,CTRL0C
  DD13  FE48          		CP	'H'
  DD15  CABCDE        		JP	Z,CTRL0B
  DD18  FE4A          		CP	'J'
  DD1A  CA77DF        		JP	Z,CTRL06
  DD1D  FE4B          		CP	'K'
  DD1F  CA7DDE        		JP	Z,CTRL05
  DD22  FE4C          		CP	'L'
  DD24  CAB6DF        		JP	Z,CTRL0E
  DD27  FE54          		CP	'T'
  DD29  CA7DDE        		JP	Z,CTRL05
  DD2C  FE78          		CP	'x'
  DD2E  2804          		JR	Z,ESC1X
  DD30  FE79          		CP	'y'
  DD32  2002          		JR	NZ,ESC1Y
  DD34                	ESC1X:
  DD34  3601          		LD	(HL),1
  DD36                	ESC1Y:
  DD36  FE3D          		CP	'='
  DD38  2804          		JR	Z,ESC1W
  DD3A  FE59          		CP	'Y'
  DD3C  2002          		JR	NZ,ESC1Z
  DD3E                	ESC1W:
  DD3E  3602          		LD	(HL),2
  DD40                	ESC1Z:
  DD40  FE20          		CP	020H
  DD42  3802          		JR	C,ESC1C
  DD44  87            		ADD	A,A
  DD45  D0            		RET	NC
  DD46                	ESC1C:
  DD46  E1            		POP	HL
  DD47  1849          		JR	ANK
                      	
  DD49                	ESC:
  DD49  21A3DD        		LD	HL,PRINTE5
  DD4C  E5            		PUSH	HL
  DD4D  216FDD        		LD	HL,ESCFLG+1
  DD50  3600          		LD	(HL),0
  DD52  3D            		DEC	A
  DD53  28A0          		JR	Z,ESC1
  DD55  3D            		DEC	A
  DD56  2009          		JR	NZ,ESC2
  DD58  3603          		LD	(HL),3
  DD5A  7B            		LD	A,E
  DD5B  D620          		SUB	020H
  DD5D  3264DD        		LD	(ESCYP+1),A
  DD60  C9            		RET
  DD61                	ESC2:
  DD61  3D            		DEC	A
  DD62  C0            		RET	NZ
  DD63  2600          	ESCYP:	LD	H,0
  DD65  7B            		LD	A,E
  DD66  D620          		SUB	020H
  DD68  6F            		LD	L,A
  DD69  C3D6EF        		JP	_LOC
                      	
  DD6C                	PRINT:
  DD6C  C5            		PUSH	BC
  DD6D  E5            		PUSH	HL
  DD6E  3E00          	ESCFLG:	LD	A,000H
  DD70  B7            		OR	A
  DD71  20D6          		JR	NZ,ESC
                      	
  DD73  3E1F          		LD	A,01FH
  DD75  BB            		CP	E
  DD76  302F          		JR	NC,CTRL
  DD78  013FDF        	INSFLG:	LD	BC,INSERT
                      	
  DD7B  3E00          	KANFLG:	LD	A,000H
  DD7D  B7            		OR	A
  DD7E  203A          		JR	NZ,KANJI2
  DD80  7B            	X1KPAT:	LD	A,E
  DD81  FE80          		CP	080H
  DD83  380D          		JR	C,ANK
  DD85  FEA0          		CP	0A0H
  DD87  3804          		JR	C,KANJI1
  DD89  FEE0          		CP	0E0H
  DD8B  3805          		JR	C,ANK
  DD8D                	KANJI1:
  DD8D  327CDD        		LD	(KANFLG+1),A
  DD90  1811          		JR	PRINTE5
  DD92                	ANK:
  DD92  ED4B8EEF      		LD	BC,(_TXADR)
  DD96  78            		LD	A,B
  DD97  F638          		OR	038H
  DD99  47            		LD	B,A
  DD9A  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令	kanji
  DD9C  CB98          		RES	3,B
  DD9E  ED59          		OUT	(C),E		;Text
  DDA0                	KANJIE:
  DDA0  CD05DE        		CALL	PRINTE7
  DDA3                	PRINTE5:
  DDA3  E1            		POP	HL
  DDA4  C1            		POP	BC
  DDA5  AF            		XOR	A
  DDA6  C9            		RET
                      	
  DDA7                	CTRL:
  DDA7  CDECDD        		CALL	KANCLR
  DDAA  7B            		LD	A,E
  DDAB  87            		ADD	A,A
  DDAC  F680          		OR	080H
  DDAE  6F            		LD	L,A
  DDAF  26F0          		LD	H,CTRLTB/256
  DDB1  7E            		LD	A,(HL)
  DDB2  2C            		INC	L
  DDB3  66            		LD	H,(HL)
  DDB4  6F            		LD	L,A
  DDB5  CD0F00        		CALL	JP_HL
  DDB8  18E9          		JR	PRINTE5
                      	
  DDBA                	KANJI2:
  DDBA  D5            		PUSH	DE
  DDBB  57            		LD	D,A
  DDBC  01812F        		LD	BC,02F81H	;SFTJIS
  DDBF  DF            		RST	018H
  DDC0  01C32F        		LD	BC,02FC3H	;Instead or JISVRM
  DDC3  DF            		RST	018H
                      	
  DDC4  ED4B8EEF      		LD	BC,(_TXADR)
  DDC8  78            		LD	A,B
  DDC9  F638          		OR	038H
  DDCB  47            		LD	B,A
  DDCC  ED51          		OUT	(C),D		;kanji
  DDCE  CB98          		RES	3,B
  DDD0  ED59          		OUT	(C),E		;Text
  DDD2  CD05DE        		CALL	PRINTE7
  DDD5  ED4B8EEF      		LD	BC,(_TXADR)
  DDD9  78            		LD	A,B
  DDDA  F638          		OR	038H
  DDDC  47            		LD	B,A
  DDDD  CBF2          		SET	6,D
  DDDF  ED51          		OUT	(C),D		;Kanji
  DDE1  CB98          		RES	3,B
  DDE3  ED59          		OUT	(C),E		;Text
  DDE5  D1            		POP	DE
  DDE6  AF            		XOR	A
  DDE7  327CDD        		LD	(KANFLG+1),A
  DDEA  18B4          		JR	KANJIE
                      	
  DDEC                	KANCLR:
  DDEC  3A7CDD        		LD	A,(KANFLG+1)
  DDEF  B7            		OR	A
  DDF0  C8            		RET	Z
  DDF1  ED4B8EEF      		LD	BC,(_TXADR)
  DDF5  78            		LD	A,B
  DDF6  F638          		OR	038H
  DDF8  47            		LD	B,A
  DDF9  AF            		XOR	A
  DDFA  327CDD        		LD	(KANFLG+1),A
  DDFD  ED79          		OUT	(C),A		;Kanji
  DDFF  CB98          		RES	3,B
  DE01  3E20          		LD	A,020H
  DE03  ED79          		OUT	(C),A		;Text
  DE05                	PRINTE7:
  DE05  CBA0          		RES	4,B
  DE07                	PRINTE6:
  DE07  3A96EF        		LD	A,(_COLORF)
  DE0A                	PRINTE4:
  DE0A  ED79          		OUT	(C),A		;Color
  DE0C  78            		LD	A,B
  DE0D  E607          		AND	7
  DE0F  47            		LD	B,A
  DE10                	PRINTE2:
  DE10  03            		INC	BC
  DE11                	PRINTE3:
  DE11  2ABAEF        		LD	HL,(CRTCD+10)
  DE14  A7            		AND	A
  DE15  ED4A          		ADC	HL,BC
  DE17                	PRINTE8:
  DE17  2805          		JR	Z,PRINT2
  DE19  ED438EEF      		LD	(_TXADR),BC
  DE1D                	CTRL00:
  DE1D  C9            		RET
                      	
  DE1E                	PRINT2:
  DE1E  CDBCDF        		CALL	SCR
  DE21  2ABCEF        		LD	HL,(CRTCD+12)
  DE24  09            		ADD	HL,BC
  DE25                	SET_TXADR_HL:
  DE25  228EEF        		LD	(_TXADR),HL
  DE28  C9            		RET
                      	
  DE29                	CTRL08:
  DE29  3A78DD        		LD	A,(INSFLG)
  DE2C  FECD          		CP	0CDH		;CALL ????
  DE2E  2829          		JR	Z,CTRL02
  DE30                	CTRL1D:
  DE30  2A8EEF        		LD	HL,(_TXADR)
  DE33  7C            		LD	A,H
  DE34  B5            		OR	L
  DE35  C8            		RET	Z
  DE36  2B            		DEC	HL
  DE37  18EC          		JR	SET_TXADR_HL
                      	
  DE39                	CTRL1E:
  DE39  ED4B8EEF      		LD	BC,(_TXADR)
  DE3D  2ABCEF        		LD	HL,(CRTCD+12)
  DE40  09            		ADD	HL,BC
  DE41  D0            		RET	NC
  DE42  18E1          		JR	SET_TXADR_HL
                      	
  DE44                	CTRL1C:
  DE44  ED4B8EEF      		LD	BC,(_TXADR)
  DE48  18C6          		JR	PRINTE2
                      	
  DE4A                	CTRL09:
  DE4A  ED4B8EEF      		LD	BC,(_TXADR)
  DE4E  79            		LD	A,C
  DE4F  E6F8          		AND	0F8H
  DE51  C608          		ADD	A,8
  DE53  4F            		LD	C,A
  DE54  88            		ADC	A,B
  DE55  91            		SUB	C
  DE56  47            		LD	B,A
  DE57  18B8          		JR	PRINTE3
                      	
  DE59                	CTRL02:
  DE59  CD30DE        		CALL	CTRL1D
  DE5C  C8            		RET	Z
  DE5D  D5            		PUSH	DE
  DE5E  CDD3EF        		CALL	_POS
  DE61  3AB1EF        		LD	A,(CRTCD+1)
  DE64  95            		SUB	L
  DE65  4F            		LD	C,A
  DE66  0D            		DEC	C
  DE67  0638          		LD	B,038H
  DE69  2A8EEF        		LD	HL,(_TXADR)
  DE6C  09            		ADD	HL,BC
  DE6D  44            		LD	B,H
  DE6E  4D            		LD	C,L
  DE6F  110020        		LD	DE,02000H	;D:Text E:kanji
  DE72  2A96EF        		LD	HL,(_COLORF)	;L:Color
  DE75                	C8X1:
  DE75  CD5BDF        		CALL	C12S
  DE78  0B            		DEC	BC
  DE79  20FA          		JR	NZ,C8X1
  DE7B  D1            		POP	DE
  DE7C  C9            		RET
                      	
  DE7D                	CTRL05:
  DE7D  CDD3EF        		CALL	_POS
  DE80  3AB1EF        		LD	A,(CRTCD+1)
  DE83  95            		SUB	L
  DE84  6F            		LD	L,A
  DE85                	C08X1:
  DE85  2620          		LD	H,020H
  DE87  ED4B8EEF      		LD	BC,(_TXADR)
  DE8B                	C05X1:
  DE8B  78            		LD	A,B
  DE8C  F638          		OR	038H
  DE8E  47            		LD	B,A
  DE8F  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令	kanji
  DE91  CB98          		RES	3,B
  DE93  ED61          		OUT	(C),H		;Text
  DE95  CBA0          		RES	4,B
  DE97  3A96EF        		LD	A,(_COLORF)
  DE9A  ED79          		OUT	(C),A		;Color
  DE9C  03            		INC	BC
  DE9D  2D            		DEC	L
  DE9E  20EB          		JR	NZ,C05X1
  DEA0  C9            		RET
                      	
  DEA1                	CTRL0D:
  DEA1  CDD3EF        		CALL	_POS
  DEA4  2E00          		LD	L,0
  DEA6                	LOC:
  DEA6  C5            		PUSH	BC
  DEA7  E5            		PUSH	HL
  DEA8  CDECDD        		CALL	KANCLR
  DEAB  CDC9DE        		CALL	LOC1
  DEAE  228EEF        		LD	(_TXADR),HL
  DEB1  E1            		POP	HL
  DEB2  C1            		POP	BC
  DEB3  C9            		RET
                      	
  DEB4                	CTRL12:
  DEB4  2178DD        		LD	HL,INSFLG
  DEB7  7E            		LD	A,(HL)
  DEB8  EECC          		XOR	0CCH		;CD:CALL ???? 1:LD BC,????
  DEBA  77            		LD	(HL),A
  DEBB  C9            		RET
                      	
  DEBC                	CTRL0B:
  DEBC  210000        		LD	HL,0
  DEBF  228EEF        		LD	(_TXADR),HL
  DEC2  C9            		RET
                      	
  DEC3                	CTRL1B:
  DEC3  3E01          		LD	A,1
  DEC5  326FDD        		LD	(ESCFLG+1),A
  DEC8  C9            		RET
                      	
  DEC9                	LOC1:
  DEC9  D5            		PUSH	DE
  DECA  4D            		LD	C,L
  DECB  0608          		LD	B,8
  DECD  5C            		LD	E,H
  DECE  1600          		LD	D,0
  DED0  2AB0EF        		LD	HL,(CRTCD)
  DED3  6A            		LD	L,D
  DED4                	LOC2:
  DED4  29            		ADD	HL,HL
  DED5  3001          		JR	NC,LOC3
  DED7  19            		ADD	HL,DE
  DED8                	LOC3:
  DED8  10FA          		DJNZ	LOC2
  DEDA  09            		ADD	HL,BC
  DEDB  D1            		POP	DE
  DEDC  C9            		RET
                      	
  DEDD                	CONOUT1:
  DEDD  CDEFDE        		CALL	CURSOR
  DEE0  59            		LD	E,C
  DEE1  CDCDEF        		CALL	_PRINT
  DEE4  7B            		LD	A,E
  DEE5  FE0A          		CP	00AH
  DEE7  2006          		JR	NZ,CURSOR
  DEE9  CDA1DE        		CALL	CTRL0D
  DEEC  CD7DDE        		CALL	CTRL05
  DEEF                	CURSOR:
  DEEF  C5            		PUSH	BC
  DEF0  ED4B8EEF      		LD	BC,(_TXADR)
  DEF4  CBE8          		SET	5,B
  DEF6  ED78          		IN	A,(C)
  DEF8  EE18          		XOR	018H
  DEFA  ED79          		OUT	(C),A
  DEFC  C1            		POP	BC
  DEFD  C9            		RET
                      	
  DEFE                	CTRL07:
  DEFE  2161EF        		LD	HL,BEEPD
  DF01                	BEEP1:
  DF01  7E            		LD	A,(HL)
  DF02  23            		INC	HL
  DF03  FEFF          		CP	0FFH
  DF05  C8            		RET	Z
  DF06  F3            		DI
  DF07  061C          		LD	B,01CH
  DF09  ED79          		OUT	(C),A
  DF0B  EDA3          		OUTI
  DF0D  FB            		EI
  DF0E  18F1          		JR	BEEP1
                      	
  DF10                	OT49SB:
  DF10  C5            		PUSH	BC
  DF11  CD2CDF        		CALL	CANW
  DF14  010019        		LD	BC,01900H
  DF17  ED79          		OUT	(C),A
  DF19  C1            		POP	BC
  DF1A  C9            		RET
                      	
  DF1B                	IN49SB:
  DF1B  C5            		PUSH	BC
  DF1C  01011A        		LD	BC,01A01H
  DF1F                	CANR:
  DF1F  ED78          		IN	A,(C)
  DF21  E620          		AND	020H
  DF23  20FA          		JR	NZ,CANR
  DF25  010019        		LD	BC,01900H
  DF28  ED78          		IN	A,(C)
  DF2A  C1            		POP	BC
  DF2B  C9            		RET
                      	
  DF2C                	CANW:
  DF2C  01011A        		LD	BC,01A01H
  DF2F  ED48          		IN	C,(C)
  DF31  CB71          		BIT	6,C
  DF33  20F7          		JR	NZ,CANW
  DF35  C9            		RET
                      	
  DF36                	COMOUT:
  DF36  FB            		EI
  DF37  CD10DF        		CALL	OT49SB
  DF3A  CD2CDF        		CALL	CANW
  DF3D  F3            		DI
  DF3E  C9            		RET
                      	
  DF3F                	INSERT:
  DF3F  D5            		PUSH	DE
  DF40  CDD3EF        		CALL	_POS
  DF43  3AB1EF        		LD	A,(CRTCD+1)
  DF46  95            		SUB	L
  DF47  ED4B8EEF      		LD	BC,(_TXADR)
  DF4B  110020        		LD	DE,02000H	;D:Text E:Kanji
  DF4E  2A96EF        		LD	HL,(_COLORF)	;L:Color
  DF51  CBE8          		SET	5,B
  DF53                	C12X1:
  DF53  CD5BDF        		CALL	C12S
  DF56  03            		INC	BC
  DF57  20FA          		JR	NZ,C12X1
  DF59  D1            		POP	DE
  DF5A  C9            		RET
                      	
  DF5B                	C12S:
  DF5B  CBE0          		SET	4,B
  DF5D  CBD8          		SET	3,B
  DF5F  ED60          		IN	H,(C)
  DF61  ED59          	X1PAT:	OUT	(C),E
  DF63  5C            		LD	E,H
  DF64  CB98          		RES	3,B
  DF66  ED60          		IN	H,(C)
  DF68  ED51          		OUT	(C),D
  DF6A  54            		LD	D,H
  DF6B  CBA0          		RES	4,B
  DF6D  ED60          		IN	H,(C)
  DF6F  ED69          		OUT	(C),L
  DF71  6C            		LD	L,H
  DF72  3D            		DEC	A
  DF73  C9            		RET
                      	
  DF74                	CTRL0C:
  DF74  CDBCDE        		CALL	CTRL0B
  DF77                	CTRL06:
  DF77  ED4B8EEF      		LD	BC,(_TXADR)
  DF7B                	C1AX1:
  DF7B  78            		LD	A,B
  DF7C  F638          		OR	038H
  DF7E  47            		LD	B,A
  DF7F  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令	kanji
  DF81  CB98          		RES	3,B
  DF83  3E20          		LD	A,020H
  DF85  ED79          		OUT	(C),A		;Text
  DF87  CBA0          		RES	4,B
  DF89  3A96EF        		LD	A,(_COLORF)
  DF8C  ED79          		OUT	(C),A		;Color
  DF8E  03            		INC	BC
  DF8F  CBA8          		RES	5,B
  DF91  2ABAEF        		LD	HL,(CRTCD+10)
  DF94  09            		ADD	HL,BC
  DF95  30E4          		JR	NC,C1AX1
  DF97  C9            		RET
                      	
  DF98                	CTRL04:
  DF98  CDD3EF        		CALL	_POS
  DF9B  7D            		LD	A,L
  DF9C  B7            		OR	A
  DF9D  C8            		RET	Z
  DF9E                	CTRL03:
  DF9E  CDA1DE        		CALL	CTRL0D
  DFA1                	CTRL0A:
  DFA1                	CTRL1F:
  DFA1  ED4B8EEF      		LD	BC,(_TXADR)
  DFA5  2AB1EF        		LD	HL,(CRTCD+1)
  DFA8  2600          		LD	H,0
  DFAA  09            		ADD	HL,BC
  DFAB  44            		LD	B,H
  DFAC  4D            		LD	C,L
  DFAD  2ABAEF        		LD	HL,(CRTCD+10)
  DFB0  09            		ADD	HL,BC
  DFB1  3F            		CCF
  DFB2  9F            		SBC	A,A
  DFB3  C317DE        		JP	PRINTE8
                      	
  DFB6                	CTRL0E:
  DFB6  CDD3EF        		CALL	_POS
  DFB9  7C            		LD	A,H
  DFBA  1804          		JR	SCR1
  DFBC                	SCR:
  DFBC  3A97EF        		LD	A,(_LINE)
  DFBF  3D            		DEC	A
  DFC0                	SCR1:
  DFC0  C5            		PUSH	BC
  DFC1  D5            		PUSH	DE
  DFC2  F5            		PUSH	AF
  DFC3  3E07          		LD	A,7
  DFC5  21F6DF        		LD	HL,SCRDMAD
  DFC8  CDECDF        		CALL	SETDMA
  DFCB  F1            		POP	AF
  DFCC  210038        		LD	HL,03800H
                      	
  DFCF                	SCRUP1:
  DFCF  B7            		OR	A
  DFD0  284D          		JR	Z,SCRCL
  DFD2  F5            		PUSH	AF
  DFD3  CDFDDF        		CALL	UPSUB		;kanji
  DFD6  3ABCEF        		LD	A,(CRTCD+12)
  DFD9  5F            		LD	E,A
  DFDA  16F7          		LD	D,0F7H
  DFDC  19            		ADD	HL,DE
  DFDD  D5            		PUSH	DE
  DFDE  CDFDDF        		CALL	UPSUB		;Text
  DFE1  D1            		POP	DE
  DFE2  19            		ADD	HL,DE
  DFE3  CDFDDF        		CALL	UPSUB		;Color
  DFE6  CBE4          		SET	4,H
  DFE8  F1            		POP	AF
  DFE9  3D            		DEC	A
  DFEA  18E3          		JR	SCRUP1
                      	
  DFEC                	SETDMA:
  DFEC  01871F        		LD	BC,01F87H
  DFEF                	SDMA:
  DFEF  04            		INC	B
  DFF0  EDA3          		OUTI
  DFF2  3D            		DEC	A
  DFF3  20FA          		JR	NZ,SDMA
  DFF5  C9            		RET
                      	
  DFF6                	SCRDMAD:
  DFF6  C3            		DB	0C3H		;WR6 リセット
  DFF7  9A            		DB	09AH		;WR5 ストップ WAIT READY:HIGH
  DFF8  65            		DB	065H		;WR0 ブロック長(LH)
  DFF9  4F00          		DW	79
  DFFB  1C            		DB	01CH		;WR1 ポートAインクリメント I/O
  DFFC  18            		DB	018H		;WR0 ポートAアドレス(LH)
                      	
  DFFD                	UPSUB:
  DFFD  3AB1EF        		LD	A,(CRTCD+1)
  E000  5F            		LD	E,A
  E001  1600          		LD	D,0
  E003  3ECD          		LD	A,0CDH		;WR4 バースト ポートB開始アドレス(LH)
  E005  ED79          		OUT	(C),A
  E007  ED69          		OUT	(C),L		;SOURCE
  E009  ED61          		OUT	(C),H
  E00B  19            		ADD	HL,DE
  E00C  3E1D          		LD	A,01DH		;WR0 ポートA開始アドレス(LH) ポートA→ポートB 転送
  E00E  ED79          		OUT	(C),A
  E010  ED69          		OUT	(C),L		;DEST
  E012  ED61          		OUT	(C),H
  E014                	GO_DMA:
  E014  3ECF          		LD	A,0CFH
  E016  ED79          		OUT	(C),A		;WR6 ロード
  E018  3EB3          		LD	A,0B3H
  E01A  ED79          		OUT	(C),A		;WR6 強制RDY
  E01C  ED49          		OUT	(C),C		;WR6 イネーブル
  E01E  C9            		RET
                      	
  E01F                	SCRCL:
  E01F  44            		LD	B,H
  E020  4D            		LD	C,L
  E021  215020        		LD	HL,02000H+80
  E024  3A96EF        		LD	A,(_COLORF)
  E027                	SCRCL1:
  E027  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  E029  CB98          		RES	3,B
  E02B  ED61          		OUT	(C),H
  E02D  CBA0          		RES	4,B
  E02F  ED79          		OUT	(C),A
  E031  CBD8          		SET	3,B
  E033  CBE0          		SET	4,B
  E035  03            		INC	BC
  E036  2D            		DEC	L
  E037  20EE          		JR	NZ,SCRCL1
  E039  D1            		POP	DE
  E03A  C1            		POP	BC
  E03B  C9            		RET
                      	
  E03C                	SCRN:
  E03C  D5            		PUSH	DE
  E03D  ED58          		IN	E,(C)		;Text
  E03F  CBD8          		SET	3,B
  E041  ED50          		IN	D,(C)		;Kanji
  E043  2819          		JR	Z,SCRNE
  E045  AF            		XOR	A
  E046  C5            		PUSH	BC
  E047  013730        		LD	BC,03037H	;VRMJIS
  E04A  DF            		RST	018H
  E04B  01522F        		LD	BC,02F52H	;JISSFT
  E04E  DF            		RST	018H
  E04F  C1            		POP	BC
  E050  ED78          		IN	A,(C)
  E052  CB98          		RES	3,B
  E054  E640          		AND	040H
  E056  2003          		JR	NZ,SCRN1
  E058  7A            		LD	A,D
  E059  D1            		POP	DE
  E05A  C9            		RET
  E05B                	SCRN1:
  E05B  7B            		LD	A,E
  E05C  D1            		POP	DE
  E05D  C9            		RET
                      	
  E05E                	SCRNE:
  E05E  D1            		POP	DE
  E05F  CB98          		RES	3,B
  E061                	SCRNX:
  E061  ED78          		IN	A,(C)
  E063  C9            		RET
                      	
  E064                	POS:
  E064  2A8EEF        		LD	HL,(_TXADR)
  E067  C5            		PUSH	BC
  E068  ED4BBCEF      		LD	BC,(CRTCD+12)
  E06C  AF            		XOR	A
  E06D                	POS1:
  E06D  09            		ADD	HL,BC
  E06E  3C            		INC	A
  E06F  38FC          		JR	C,POS1
  E071  ED42          		SBC	HL,BC
  E073  3D            		DEC	A
  E074  67            		LD	H,A
  E075  C1            		POP	BC
  E076  A7            		AND	A
  E077  C9            		RET
                      	
  E078                	GETL:
  E078  CDD3EF        		CALL	_POS
  E07B  E5            		PUSH	HL
  E07C  3ECD          		LD	A,0CDH		;CALL ????
  E07E  3278DD        		LD	(INSFLG),A
  E081                	GETL1:
  E081  CD31DC        		CALL	_SYS08
  E084  FE09          		CP	9
  E086  2008          		JR	NZ,GETL1V
  E088  2100FF        		LD	HL,KBUF
  E08B  CD69D8        		CALL	MSX
  E08E  18F1          		JR	GETL1
  E090                	GETL1V:
  E090  5F            		LD	E,A
  E091  CDCDEF        		CALL	_PRINT
                      	
  E094  7B            		LD	A,E
  E095  FE0D          		CP	00DH
  E097  20E8          		JR	NZ,GETL1
  E099  3E01          		LD	A,1		;LD BC,????
  E09B  3278DD        		LD	(INSFLG),A
  E09E  1100FF        		LD	DE,KBUF
  E0A1  3AB1EF        		LD	A,(CRTCD+1)
  E0A4  47            		LD	B,A
  E0A5  CD11D5        		CALL	ZERO_MEMORY_DE
                      	
  E0A8  D1            		POP	DE
  E0A9  CDD3EF        		CALL	_POS
  E0AC  6B            		LD	L,E
  E0AD  3AB1EF        		LD	A,(CRTCD+1)
  E0B0  95            		SUB	L
  E0B1  57            		LD	D,A
  E0B2  CDC9DE        		CALL	LOC1
  E0B5  4D            		LD	C,L
  E0B6  7C            		LD	A,H
  E0B7  F630          		OR	030H
  E0B9  47            		LD	B,A
  E0BA  5A            		LD	E,D
  E0BB  2100FF        		LD	HL,KBUF
  E0BE                	GETL2:
  E0BE  CDD0EF        		CALL	_SCRN
  E0C1  03            		INC	BC
  E0C2  77            		LD	(HL),A
  E0C3  23            		INC	HL
  E0C4  1D            		DEC	E
  E0C5  20F7          		JR	NZ,GETL2
  E0C7                	GETL3:
  E0C7  2B            		DEC	HL
  E0C8  7E            		LD	A,(HL)
  E0C9  FE21          		CP	021H
  E0CB  D0            		RET	NC
  E0CC  3600          		LD	(HL),0
  E0CE  15            		DEC	D
  E0CF  20F6          		JR	NZ,GETL3
  E0D1  C9            		RET
                      	
  E0D2                	INKEY:
  E0D2  FB            		EI
  E0D3  E5            		PUSH	HL
  E0D4  2A90EF        		LD	HL,(_KEYPS)
  E0D7  7C            		LD	A,H
  E0D8  AD            		XOR	L
  E0D9  2809          		JR	Z,INKEY1
  E0DB  7C            		LD	A,H
  E0DC  3C            		INC	A
  E0DD  3291EF        		LD	(_KEYPS+1),A
  E0E0  6F            		LD	L,A
  E0E1  26FE          		LD	H,KEYBF/256
  E0E3  7E            		LD	A,(HL)
  E0E4                	INKEY1:
  E0E4  E1            		POP	HL
  E0E5  B7            		OR	A
  E0E6  C9            		RET
                      	
  1087                	AT_RS	EQU	SCR1-AT_SCR1
                      	
                      	;LDFILE.ASM
                      	
                      	;	LSX-Dodgers FILE
                      	
  E0E7                	FILEC:
  E0E7  CDF2E0        		CALL	FILE
  E0EA                	FILEC2:
  E0EA  3A15EF        		LD	A,(FDRV+1)
  E0ED  FE20          		CP	020H
  E0EF  C8            		RET	Z
  E0F0  1839          		JR	SETDIR1
                      	
  E0F2                	FILE:
  E0F2  AF            		XOR	A
  E0F3  3214EF        		LD	(FDRV),A
  E0F6  67            		LD	H,A
  E0F7  6F            		LD	L,A
  E0F8  2222EF        		LD	(FDRV+14),HL
  E0FB  CDC9E1        		CALL	SPCUT
  E0FE  CDAEE1        		CALL	CCHK3
  E101  2812          		JR	Z,DEVI1
  E103  13            		INC	DE
  E104  1A            		LD	A,(DE)
  E105  1B            		DEC	DE
  E106  FE3A          		CP	':'
  E108  200B          		JR	NZ,DEVI1
  E10A  1A            		LD	A,(DE)		;DRIVE
  E10B  CDFEE3        		CALL	CAP
  E10E  D640          		SUB	'@'
  E110  13            		INC	DE
  E111  13            		INC	DE
  E112  3214EF        		LD	(FDRV),A
  E115                	DEVI1:
  E115  1A            		LD	A,(DE)
  E116  D65C          		SUB	05CH		;\
  E118  2009          		JR	NZ,NOROOT
  E11A  6F            		LD	L,A		;A=0でH=0のはずなのでHL=0
  E11B  222EEF        		LD	(FDRV+26),HL
  E11E  2C            		INC	L
  E11F  2222EF        		LD	(FDRV+14),HL
  E122  13            		INC	DE
  E123                	NOROOT:
                      	
  E123                	SETDIR:
  E123  CD4FE1        		CALL	FILED
  E126  1A            		LD	A,(DE)
  E127  FE5C          		CP	05CH		;\
  E129  C0            		RET	NZ
  E12A  13            		INC	DE
  E12B                	SETDIR1:
  E12B  3E10          		LD	A,010H		;Directory
  E12D  3221EF        		LD	(FDRV+13),A
  E130  D5            		PUSH	DE
  E131  1114EF        		LD	DE,FDRV
  E134  2A1EF0        		LD	HL,(STABLE+2*00FH)
  E137  CD0F00        		CALL	JP_HL
  E13A  D1            		POP	DE
  E13B  B7            		OR	A
  E13C  C0            		RET	NZ
                      	
  E13D  3A21EF        		LD	A,(FDRV+13)
  E140  CB67          		BIT	4,A
  E142  C8            		RET	Z
                      	
  E143  CD96E1        		CALL	FILEI
  E146  2A2EEF        		LD	HL,(FDRV+26)
  E149  23            		INC	HL
  E14A  2222EF        		LD	(FDRV+14),HL
  E14D  18D4          		JR	SETDIR
                      	
  E14F                	FILED:
  E14F  CD96E1        		CALL	FILEI
  E152  2115EF        		LD	HL,FNAME
                      	
  E155  0608          		LD	B,8
  E157                	FILE2:
  E157  CDA3E1        		CALL	CCHKF
  E15A  C8            		RET	Z
  E15B  FE2A          		CP	'*'
  E15D  282E          		JR	Z,FILE9
  E15F  FE2E          		CP	'.'
  E161  280C          		JR	Z,FILE4
  E163  77            		LD	(HL),A
  E164  23            		INC	HL
  E165  10F0          		DJNZ	FILE2
                      	
  E167                	FILE3:
  E167  CDA3E1        		CALL	CCHKF
  E16A  C8            		RET	Z
  E16B  FE2E          		CP	'.'
  E16D  20F8          		JR	NZ,FILE3
                      	
  E16F                	FILE4:
  E16F  211DEF        		LD	HL,FNAME+8
  E172  0603          		LD	B,3
                      	
  E174                	FILE4L:
  E174  CDA3E1        		CALL	CCHKF
  E177  C8            		RET	Z
  E178  FE2E          		CP	'.'
  E17A  2008          		JR	NZ,FILE12
  E17C  3215EF        		LD	(FNAME),A	;Parent directory(..)
  E17F  3216EF        		LD	(FNAME+1),A
  E182  3E20          		LD	A,020H
  E184                	FILE12:
  E184  FE2A          		CP	'*'
  E186  280A          		JR	Z,FILE10
  E188  77            		LD	(HL),A
  E189  23            		INC	HL
  E18A  10E8          		DJNZ	FILE4L
  E18C  C9            		RET
                      	
  E18D                	FILE9:				;名前の*処理、名前の残りを?で埋める
  E18D  CD92E1        		CALL	FILE10
  E190  18D5          		JR	FILE3
                      	
  E192                	FILE10:
  E192  3E3F          		LD	A,'?'
  E194  1808          		JR	FILL_MEMORY
  E196                	FILEI:				;名前＋拡張子をスペースで初期化
  E196  3E20          		LD	A,020H
  E198  01000B        		LD	BC,11*256	;C=0にしておく
  E19B  2115EF        		LD	HL,FNAME
  E19E                	FILL_MEMORY:			;HLからBバイトAで埋める
  E19E  77            		LD	(HL),A
  E19F  23            		INC	HL
  E1A0  10FC          		DJNZ	FILL_MEMORY
  E1A2  C9            		RET
                      	
  E1A3                	CCHKF:
  E1A3  1A            		LD	A,(DE)
  E1A4  CDABE1        		CALL	CCHK2
  E1A7  C8            		RET	Z
  E1A8  C318E5        		JP	FKAN
                      	
  E1AB                	CCHK2:
  E1AB  0C            		INC	C
  E1AC  0D            		DEC	C
  E1AD  C0            		RET	NZ
  E1AE                	CCHK3:				;ZF=1 で使えない文字
  E1AE  FE2B          		CP	'+'
  E1B0  C8            		RET	Z
  E1B1  FE2C          		CP	','
  E1B3  C8            		RET	Z
  E1B4  FE2F          		CP	'/'
  E1B6  C8            		RET	Z
  E1B7  FE3A          		CP	':'
  E1B9  C8            		RET	Z
  E1BA  FE3B          		CP	';'
  E1BC  C8            		RET	Z
  E1BD  FE3D          		CP	'='
  E1BF  C8            		RET	Z
  E1C0  FE5C          		CP	05CH	;\
  E1C2  C8            		RET	Z
  E1C3  FE20          		CP	020H
  E1C5  D0            		RET	NC
  E1C6  BF            		CP	A		;Z=1
  E1C7  C9            		RET
                      	
  E1C8                	SS1:
  E1C8  13            		INC	DE
  E1C9                	SPCUT:				;スペースをカット
  E1C9  1A            		LD	A,(DE)
  E1CA  FE20          		CP	020H
  E1CC  28FA          		JR	Z,SS1
  E1CE  C9            		RET
                      	
  E1CF                	SETDRVF:
  E1CF  1114EF        		LD	DE,FDRV
  E1D2                	SETDRV0:
  E1D2  CDDBE1        		CALL	SETDRV
  E1D5  FDE1          		POP	IY
  E1D7  C1            		POP	BC
  E1D8  D1            		POP	DE
  E1D9  E1            		POP	HL
  E1DA  C9            		RET
                      	
  E1DB                	SETDRV:
  E1DB  E3            		EX	(SP),HL		;HL=RETRN ADDRESS
  E1DC  D5            		PUSH	DE		;PUSH HL/DE/BC/IY
  E1DD  C5            		PUSH	BC
  E1DE  1A            		LD	A,(DE)
  E1DF  D5            		PUSH	DE
  E1E0  FDE3          		EX	(SP),IY
                      	
  E1E2  CDEEE1        		CALL	GETDRV
  E1E5  3C            		INC	A
  E1E6  FD7700        		LD	(IY+0),A	;(FCB)ドライブ番号
  E1E9  3D            		DEC	A
  E1EA  CDD9EF        		CALL	_CHGDRV
                      	
  E1ED  E9            		JP	(HL)
                      	
  E1EE                	GETDRV:
  E1EE  E67F          		AND	07FH
  E1F0  D601          		SUB	001H
  E1F2  3003          		JR	NC,GETDRV1
  E1F4  3A87EF        		LD	A,(_DVSW)	;Current Drive
  E1F7                	GETDRV1:
  E1F7  3288EF        		LD	(_DRV),A
  E1FA  C9            		RET
                      	
  E1FB                	SOPENX:
  E1FB                	SOPENX1:
  E1FB  1139EF        		LD	DE,SFILE
  E1FE  1A            		LD	A,(DE)
  E1FF  FDBE00        		CP	(IY+0)		;(FCB)ドライブ番号
  E202  2024          		JR	NZ,SOPEN
  E204  13            		INC	DE
  E205  FDE5          		PUSH	IY
  E207  E1            		POP	HL
  E208  23            		INC	HL
  E209  CD96E3        		CALL	CPFILE
  E20C  201A          		JR	NZ,SOPEN
                      	
  E20E  2AF4F0        		LD	HL,(SCDIR)
  E211  FD750E        		LD	(IY+14),L	;(FCB)アクセスするディレクトリのクラスタ番号+1
  E214  FD740F        		LD	(IY+15),H
                      	
  E217  2AF8F0        		LD	HL,(SFNDF)	;Direcroty location and Flags
  E21A  229FEF        		LD	(_FILEN),HL
                      	
  E21D  ED5BF6F0      		LD	DE,(SFBPS)
  E221  2139EF        		LD	HL,SFILE
  E224  36FF          		LD	(HL),0FFH
  E226  23            		INC	HL
  E227  C9            		RET
  E228                	SOPEN:
  E228  213EE3        		LD	HL,FILESE
  E22B                	SOPENC:
  E22B  2264E2        		LD	(OPENPAT+1),HL
                      	
  E22E  CDE2EF        		CALL	_RDFATX		;Detect Media
  E231  3856          		JR	C,RDDERR
                      	
  E233  AF            		XOR	A
  E234  329FEF        		LD	(_FILEN),A
  E237  CD43E4        		CALL	LDDIRX1		;A=0で呼び出す
  E23A  2818          		JR	Z,SDIRX1
                      	
  E23C  CD2FE3        		CALL	READ_DIR	;Sub Directory
  E23F  3808          		JR	C,SDIRX0
  E241  2A7EF0        		LD	HL,(_DTBUF)
  E244  7E            		LD	A,(HL)
  E245  FE2E          		CP	'.'
  E247  280F          		JR	Z,SOPEN1
  E249                	SDIRX0:
  E249  AF            		XOR	A
  E24A  32A0EF        		LD	(_DIRF),A
  E24D  FD360E01      		LD	(IY+14),1	;(FCB)レコードサイズ
  E251  FD770F        		LD	(IY+15),A
  E254                	SDIRX1:
  E254  ED5BFCF0      		LD	DE,(_DIRPS)	;Root Directory
  E258                	SOPEN1:
  E258  0E20          	SDECPAT:LD	C,32		;自己書き換え 1セクタ辺りのディレクトリエントリ数  1024=32 / 512=16
  E25A                	SOPEN1X:
  E25A  CD2FE3        		CALL	READ_DIR	;FILE SEARCH
  E25D  382A          		JR	C,RDDERR
  E25F  2A7EF0        		LD	HL,(_DTBUF)
  E262                	SOPEN2:
  E262  D5            		PUSH	DE
  E263  CD3EE3        	OPENPAT:CALL	FILESE		;(Self-rewriting)
  E266  D1            		POP	DE
  E267  386E          		JR	C,SOPENE
  E269  281B          		JR	Z,SCF_FF_RET
  E26B                	SOPEN3:
  E26B  3AA0EF        		LD	A,(_DIRF)	;ディレクトリか判別
  E26E  B7            		OR	A
  E26F  200C          		JR	NZ,SOPEN5
  E271  13            		INC	DE		;ルートディレクトリ
  E272  E5            		PUSH	HL
  E273  210C00        	MD_PAT:	LD	HL,12		;(Self-rewriting)MAXDIR
  E276  ED52          		SBC	HL,DE		;CF=0 なので SUB HL,DE
  E278  E1            		POP	HL
  E279  20DD          		JR	NZ,SOPEN1
  E27B  1807          		JR	SOPEN6
  E27D                	SOPEN5:
  E27D  CD90EA        		CALL	GNCLX		;END DIR
  E280  D8            		RET	C
  E281  CDF6E3        		CALL	ENDCL
  E284                	SOPEN6:
  E284  38D2          		JR	C,SOPEN1
  E286                	SCF_FF_RET:
  E286  37            		SCF			;CF=1
  E287  9F            		SBC	A,A		;A=0FFH
  E288  C9            		RET
                      	
  E289                	RDDERR:
  E289  BF            		CP	A		;READ ERR CF=1 ZF=1
  E28A  37            		SCF
  E28B  C9            		RET
                      	
  E28C                	NOPEN:
  E28C  213EE3        		LD	HL,FILESE
  E28F  2264E2        		LD	(OPENPAT+1),HL
  E292  FD2A98EF      		LD	IY,(_FCB)
  E296  CD2BE5        		CALL	CHKWILDX
  E299  30EB          		JR	NC,SCF_FF_RET
  E29B  FD7E00        		LD	A,(IY+0)	;(FCB)ドライブ番号
  E29E  3D            		DEC	A
  E29F  3288EF        		LD	(_DRV),A
  E2A2  CDD9EF        		CALL	_CHGDRV
  E2A5  D8            		RET	C
  E2A6  2AF8F0        		LD	HL,(SFNDF)	;Direcroty location and Flags
  E2A9  229FEF        		LD	(_FILEN),HL
                      	
  E2AC  CD3EE4        		CALL	LDDIRX
  E2AF  ED5B9AEF      		LD	DE,(_FBPS)
  E2B3  CD2FE3        		CALL	READ_DIR
  E2B6  38D1          		JR	C,RDDERR
  E2B8  3A9EEF        		LD	A,(_FBCNT)
  E2BB  3D            		DEC	A
  E2BC  28AD          		JR	Z,SOPEN3
  E2BE                	NOPEN2:
  E2BE  2A9CEF        		LD	HL,(_FBAD)
  E2C1  012000        		LD	BC,020H
  E2C4  09            		ADD	HL,BC
  E2C5  4F            		LD	C,A
  E2C6  189A          		JR	SOPEN2
                      	
  E2C8                	SOPENE2:
  E2C8  229CEF        		LD	(_FBAD),HL
  E2CB  79            		LD	A,C
  E2CC  329EEF        		LD	(_FBCNT),A
  E2CF  ED539AEF      		LD	(_FBPS),DE
  E2D3  FD2298EF      		LD	(_FCB),IY
  E2D7                	SOPENE:
  E2D7  AF            		XOR	A
  E2D8  C9            		RET
                      	
  E2D9                	COPEN:
  E2D9  FD360D20      		LD	(IY+13),020H	;(FCB)属性(アトリビュート)
                      	
  E2DD  215BE3        		LD	HL,NEXTSE
  E2E0  CD2BE2        		CALL	SOPENC
  E2E3  D0            		RET	NC
  E2E4  C8            		RET	Z
  E2E5  3AA0EF        		LD	A,(_DIRF)	;ディレクトリか判別
  E2E8  B7            		OR	A
  E2E9  37            		SCF
  E2EA  C8            		RET	Z		;ルートディレクトリ
  E2EB  0601          		LD	B,1
  E2ED  CD87E5        		CALL	WRDF
  E2F0  D8            		RET	C
  E2F1  ED5BFEF0      		LD	DE,(_CLPS)
  E2F5  D5            		PUSH	DE
  E2F6  CDBFE3        		CALL	DCPAT
  E2F9  CD1BE9        		CALL	DRDNX
  E2FC  2A7EF0        		LD	HL,(_DTBUF)	;ディレクトリエントリを0クリア
  E2FF  3A96E8        		LD	A,(SECSZ+2)	;1024=4 / 512=2 / 256=1
  E302  47            		LD	B,A
  E303  AF            		XOR	A
  E304  4F            		LD	C,A
  E305                	COPENCL:
  E305  77            		LD	(HL),A
  E306  EDA1          		CPI			;HL=HL+1 BC=BC-1 BCが0の場合にP/V=0
  E308  EA05E3        		JP	PE,COPENCL
                      	
  E30B  3ADDE3        		LD	A,(SPCPAT+1)	;1クラスタの論理セクタ数
  E30E  3D            		DEC	A
  E30F  2819          		JR	Z,COPENE
  E311  3E01          		LD	A,1		;1セクタ辺りのセクタ数が2以上の場合
  E313  3288EA        		LD	(_SECPS+1),A
  E316  D1            		POP	DE		;DE=(_CLPS)
  E317  D5            		PUSH	DE
  E318                	COPEN1:
  E318  D5            		PUSH	DE		;データバッファに入らないセクタもゼロクリア
  E319  C5            		PUSH	BC
  E31A  2A7EF0        		LD	HL,(_DTBUF)
  E31D  CDD9E3        		CALL	CLUSTX
  E320  CDF6EB        		CALL	DWT24
  E323  C1            		POP	BC
  E324  D1            		POP	DE
  E325  CD87EA        		CALL	NEXTX
  E328  20EE          		JR	NZ,COPEN1
  E32A                	COPENE:
  E32A  2A7EF0        		LD	HL,(_DTBUF)
  E32D  D1            		POP	DE
  E32E  C9            		RET
                      	
  E32F                	READ_DIR:
  E32F  ED53FEF0      		LD	(_CLPS),DE
  E333  C5            		PUSH	BC
  E334  D5            		PUSH	DE
  E335  CDBFE3        		CALL	DCPAT
  E338  CDFBE8        		CALL	DRDX
  E33B  D1            		POP	DE
  E33C  C1            		POP	BC
  E33D  C9            		RET
                      	
  E33E                	FILESE:
  E33E  7E            		LD	A,(HL)
  E33F  B7            		OR	A
  E340  C8            		RET	Z		;END:ZF=1 CF=0
  E341  FEE5          		CP	0E5H
  E343  280E          		JR	Z,FILESE1
  E345  FDE5          		PUSH	IY
  E347  D1            		POP	DE
  E348  13            		INC	DE
  E349  E5            		PUSH	HL
  E34A  CD96E3        		CALL	CPFILE
  E34D  CCB7E3        		CALL	Z,CPFILE2
  E350  E1            		POP	HL
  E351  37            		SCF
  E352  C8            		RET	Z		;!!!:(ZF=1) CF=1
  E353                	FILESE1:
  E353  CD6AE3        		CALL	FNEXT
  E356  20E6          		JR	NZ,FILESE
  E358                	ZF0_CF0_AFF_RET:
  E358  F6FF          		OR	0FFH		;ZF=0 CF=0
  E35A  C9            		RET
                      	
  E35B                	NEXTSE:
  E35B  7E            		LD	A,(HL)
  E35C  B7            		OR	A
  E35D  37            		SCF
  E35E  C8            		RET	Z		;!!!:ZF=1 CF=1
  E35F  FEE5          		CP	0E5H
  E361  37            		SCF
  E362  C8            		RET	Z		;!!!:(ZF=1) CF=1
  E363  CD6AE3        		CALL	FNEXT
  E366  20F3          		JR	NZ,NEXTSE
  E368  18EE          		JR	ZF0_CF0_AFF_RET
                      	
  E36A                	FNEXT:
  E36A  E5            		PUSH	HL
  E36B  219FEF        		LD	HL,_FILEN
  E36E  34            		INC	(HL)
  E36F  E1            		POP	HL
  E370  112000        		LD	DE,020H
  E373  19            		ADD	HL,DE
  E374  0D            		DEC	C
  E375  C9            		RET
                      	
  E376                	CPNAME:
  E376  C5            		PUSH	BC
  E377  D5            		PUSH	DE
  E378  E5            		PUSH	HL
  E379  CD90E3        		CALL	CPFILE4
  E37C  E1            		POP	HL
  E37D  23            		INC	HL
  E37E  23            		INC	HL
  E37F  23            		INC	HL
  E380  23            		INC	HL
  E381  D1            		POP	DE
  E382  C1            		POP	BC
  E383  2005          		JR	NZ,CPNAME1
  E385  7E            		LD	A,(HL)
  E386  23            		INC	HL
  E387  66            		LD	H,(HL)
  E388  6F            		LD	L,A
  E389  C9            		RET
  E38A                	CPNAME1:
  E38A  23            		INC	HL
  E38B  23            		INC	HL
  E38C  10E8          		DJNZ	CPNAME
  E38E  37            		SCF
  E38F  C9            		RET
                      	
  E390                	CPFILE4:
  E390  C5            		PUSH	BC
  E391  010004        		LD	BC,00400H
  E394  1804          		JR	CPSTR1
  E396                	CPFILE:
  E396  C5            		PUSH	BC
  E397  01000B        		LD	BC,00B00H
  E39A                	CPSTR1:
  E39A  1A            		LD	A,(DE)
  E39B  FE3F          		CP	'?'		;Wild card
  E39D  2812          		JR	Z,CPSTR2
  E39F  7E            		LD	A,(HL)
  E3A0  CD11E5        		CALL	FKANC
  E3A3  E5            		PUSH	HL
  E3A4  67            		LD	H,A
  E3A5  1A            		LD	A,(DE)
  E3A6  CB01          		RLC	C
  E3A8  CD11E5        		CALL	FKANC
  E3AB  CB09          		RRC	C
  E3AD  BC            		CP	H		;CP (HL),(DE)
  E3AE  E1            		POP	HL
  E3AF  2004          		JR	NZ,CPSTR3
  E3B1                	CPSTR2:
  E3B1  13            		INC	DE
  E3B2  23            		INC	HL
  E3B3  10E5          		DJNZ	CPSTR1
  E3B5                	CPSTR3:
  E3B5  C1            		POP	BC
  E3B6  C9            		RET
                      	
  E3B7                	CPFILE2:
  E3B7  FD7E0D        		LD	A,(IY+13)	;(FCB)属性(アトリビュート)
  E3BA  F6E1          		OR	0E1H
  E3BC  2F            		CPL
  E3BD  A6            		AND	(HL)
  E3BE  C9            		RET
                      	
  E3BF                	DCPAT:
  E3BF  0E00          		LD	C,0
  E3C1  2A7EF0        		LD	HL,(_DTBUF)
  E3C4  3AA0EF        		LD	A,(_DIRF)	;ディレクトリか判別
  E3C7  B7            		OR	A
  E3C8  C8            		RET	Z		;ルートディレクトリの場合はCレジスタを0にしておく(CDEがセクタ番号)
  E3C9  3ADDE3        		LD	A,(SPCPAT+1)
  E3CC  4F            		LD	C,A
  E3CD  3A88EA        		LD	A,(_SECPS+1)
  E3D0  B9            		CP	C
  E3D1  3801          		JR	C,DC1
  E3D3  AF            		XOR	A
  E3D4                	DC1:
  E3D4  F680          		OR	080H
  E3D6  32A0EF        		LD	(_DIRF),A	;bit0-6:セクタインデックス
  E3D9                	CLUSTX:
  E3D9  E5            		PUSH	HL
  E3DA  EB            		EX	DE,HL
  E3DB  AF            		XOR	A
  E3DC  0E01          	SPCPAT:	LD	C,1		;自己書き換え（1クラスタの論理セクタ数）
  E3DE                	L_CLDBL:
  E3DE  CB19          		RR	C		;->CF
  E3E0  3804          		JR	C,E_CLDBL
  E3E2  29            		ADD	HL,HL		;*2
  E3E3  8F            		ADC	A,A
  E3E4  18F8          		JR	L_CLDBL
  E3E6                	E_CLDBL
  E3E6  4F            		LD	C,A
  E3E7  3A88EA        		LD	A,(_SECPS+1)
  E3EA  B5            		OR	L
  E3EB  6F            		LD	L,A
  E3EC  110800        	CLSPAT:	LD	DE,8	;+8 (2D)  !ADDCL (Self-rewriting)
  E3EF  AF            		XOR	A
  E3F0  19            		ADD	HL,DE	;データ格納領域の先頭論理セクタ番号
  E3F1  89            		ADC	A,C
  E3F2  4F            		LD	C,A
  E3F3  EB            		EX	DE,HL
  E3F4  E1            		POP	HL
  E3F5  C9            		RET
                      	
  E3F6                	ENDCL:
  E3F6  7A            		LD	A,D	;END CLUSTER
  E3F7  FE01          	CLPAT1:	CP	1	;164=356	(Self-rewriting)
  E3F9  C0            		RET	NZ
  E3FA  7B            		LD	A,E
  E3FB  FE64          	CLPAT2:	CP	064H	;		(Self-rewriting)
  E3FD  C9            		RET
                      	
  E3FE                	CAP:
  E3FE  FE61          		CP	'a'
  E400  D8            		RET	C
  E401  FE7B          		CP	'z'+1
  E403  D0            		RET	NC
  E404  D620          		SUB	020H
  E406  C9            		RET
  E407                	CAP2:
  E407  CDFEE3        		CALL	CAP
  E40A                	CAP3:
  E40A  CD13E4        		CALL	CAP4
  E40D  FE21          		CP	021H
  E40F  D0            		RET	NC
  E410  3EA0          		LD	A,0A0H
  E412  C9            		RET
  E413                	CAP4:
  E413  FE05          		CP	5
  E415  C0            		RET	NZ
  E416  3EE5          		LD	A,0E5H
  E418  C9            		RET
                      	
  E419                	CHDIR:
  E419  CD33ED        		CALL	GETDPBD
  E41C  381D          		JR	C,CHDIR2
  E41E  DD751A        		LD	(IX+01AH),L		;_SDIR_
  E421  DD741B        		LD	(IX+01BH),H		;_SDIR_+1
  E424  1815          		JR	CHDIR2		;POP_IX_RET
                      	
  E426                	LDDIR:
  E426  CD33ED        		CALL	GETDPBD
  E429  DD5E1A        		LD	E,(IX+01AH)		;_SDIR_
  E42C  DD561B        		LD	D,(IX+01BH)		;_SDIR_+1
  E42F  13            		INC	DE
  E430  FD730E        		LD	(IY+14),E	;(FCB)アクセスするディレクトリのクラスタ番号+1
  E433  FD720F        		LD	(IY+15),D
  E436  1B            		DEC	DE
  E437  AF            		XOR	A
  E438  32A0EF        		LD	(_DIRF),A
  E43B                	CHDIR2:
  E43B  DDE1          		POP	IX
  E43D  C9            		RET
                      	
  E43E                	LDDIRX:
  E43E  3AA0EF        		LD	A,(_DIRF)	;(FCB)アクセスするディレクトリのセクタインデックス
  E441  E67F          		AND	07FH
  E443                	LDDIRX1:
  E443  3288EA        		LD	(_SECPS+1),A
  E446  FD5E0E        		LD	E,(IY+14)	;(FCB)アクセスするディレクトリのクラスタ番号+1
  E449  FD560F        		LD	D,(IY+15)
  E44C  1B            		DEC	DE
  E44D  CDF6E3        		CALL	ENDCL
  E450  D426E4        		CALL	NC,LDDIR
  E453                	LDDIRS:
  E453  7A            		LD	A,D
  E454  B3            		OR	E
  E455  32A0EF        		LD	(_DIRF),A	;ディレクトリか判別
  E458  C9            		RET
                      	
  E459                	KILL:
  E459  CD2BE5        		CALL	CHKWILDX
  E45C  3836          		JR	C,KILLW
  E45E  CDFBE1        		CALL	SOPENX1
  E461                	KILLS:
  E461  3E1F          		LD	A,01FH
  E463  D4A7E4        		CALL	NC,CHKATT
  E466  D8            		RET	C
  E467                	KILLSX:
  E467  36E5          		LD	(HL),0E5H	;DIR
  E469  CD05E5        		CALL	WTDB
  E46C  111A00        		LD	DE,01AH
  E46F  19            		ADD	HL,DE
  E470  5E            		LD	E,(HL)
  E471  23            		INC	HL
  E472  56            		LD	D,(HL)
  E473  1804          		JR	KILLS2
  E475                	KILLS1:
  E475  ED5BFEF0      		LD	DE,(_CLPS)	;FAT
  E479                	KILLS2:
  E479  CDF6E3        		CALL	ENDCL
  E47C  D0            		RET	NC		;CF=0
  E47D  21FEFF        		LD	HL,0-2
  E480  19            		ADD	HL,DE
  E481  D0            		RET	NC		;DE= 0 or 1
  E482  D5            		PUSH	DE
  E483  CDF7EF        		CALL	_GNCL
  E486  ED53FEF0      		LD	(_CLPS),DE
  E48A  D1            		POP	DE
  E48B  210000        		LD	HL,0
  E48E  D4FAEF        		CALL	NC,_SNCL
  E491  30E2          		JR	NC,KILLS1
  E493  C9            		RET
                      	
  E494                	KILLW:
  E494  CD28E2        		CALL	SOPEN
  E497                	KILLW1:
  E497  380B          		JR	C,KILLW2
  E499  CDC8E2        		CALL	SOPENE2
  E49C  CD61E4        		CALL	KILLS
  E49F  CD8CE2        		CALL	NOPEN
  E4A2  18F3          		JR	KILLW1
  E4A4                	KILLW2:
  E4A4  C8            		RET	Z
  E4A5  3F            		CCF
  E4A6  C9            		RET
                      	
  E4A7                	CHKATT:
  E4A7  E5            		PUSH	HL
  E4A8  110B00        		LD	DE,00BH
  E4AB  19            		ADD	HL,DE
  E4AC  A6            		AND	(HL)
  E4AD  E1            		POP	HL
  E4AE  C8            		RET	Z
  E4AF  37            		SCF
  E4B0  C9            		RET
                      	
  E4B1                	NAME:
  E4B1  CD2BE5        		CALL	CHKWILDX
  E4B4  D8            		RET	C
  E4B5  110400        		LD	DE,4
  E4B8  19            		ADD	HL,DE
  E4B9  22D1E4        		LD	(NAMEP+2),HL
  E4BC  23            		INC	HL
  E4BD  CD2FE5        		CALL	CHKWILD
  E4C0  D8            		RET	C
                      	
  E4C1  CDFBE1        		CALL	SOPENX1
  E4C4  3E0F          		LD	A,00FH
  E4C6  D4A7E4        		CALL	NC,CHKATT
  E4C9  D8            		RET	C
                      	
  E4CA  FD7E00        		LD	A,(IY+0)
  E4CD  FDE5          		PUSH	IY
  E4CF  FD210000      	NAMEP:	LD	IY,0
  E4D3  FD7700        		LD	(IY+0),A
  E4D6  CDFBE1        		CALL	SOPENX1
  E4D9  FDE3          		EX	(SP),IY
  E4DB  3F            		CCF
  E4DC  D428E2        		CALL	NC,SOPEN
  E4DF  EB            		EX	DE,HL
  E4E0  E1            		POP	HL
  E4E1  D8            		RET	C
                      	
  E4E2                	SETNAME:
  E4E2  01000B        		LD	BC,11*256
  E4E5  23            		INC	HL
  E4E6  7E            		LD	A,(HL)
  E4E7  FEE5          		CP	0E5H
  E4E9  2004          		JR	NZ,SNAME1
  E4EB  3E05          		LD	A,5
  E4ED  180E          		JR	SNAME3
  E4EF                	SNAME1:
  E4EF  7E            		LD	A,(HL)
  E4F0  0C            		INC	C
  E4F1  0D            		DEC	C
  E4F2  2009          		JR	NZ,SNAME3
  E4F4  CDFEE3        		CALL	CAP
  E4F7  FEA0          		CP	0A0H
  E4F9  2002          		JR	NZ,SNAME3
  E4FB  3E20          		LD	A,020H
  E4FD                	SNAME3:
  E4FD  12            		LD	(DE),A
  E4FE  7E            		LD	A,(HL)
  E4FF  23            		INC	HL
  E500  CD18E5        		CALL	FKAN
  E503  10EA          		DJNZ	SNAME1
  E505                	WTDB:
  E505  3EFF          		LD	A,0FFH
  E507  3239EF        		LD	(SFILE),A
  E50A                	SWTDBF:
  E50A  3E01          		LD	A,1
  E50C  32A4EF        		LD	(_WTDBF),A
  E50F  AF            		XOR	A
  E510  C9            		RET
                      	
  E511                	FKANC:
  E511  CB41          		BIT	0,C
  E513  CC07E4        		CALL	Z,CAP2
  E516  1801          		JR	FKANX
  E518                	FKAN:			;漢字チェック
  E518  13            		INC	DE
  E519                	FKANX:
  E519  CB41          		BIT	0,C
  E51B  CB81          		RES	0,C
  E51D  C0            		RET	NZ
  E51E  FE80          		CP	080H
  E520  D8            		RET	C
  E521  FEA0          		CP	0A0H
  E523  3803          		JR	C,FKAN1
  E525  FEE0          		CP	0E0H
  E527  D8            		RET	C
  E528                	FKAN1:
  E528  0C            		INC	C
  E529  A7            		AND	A
  E52A  C9            		RET
                      	
  E52B                	CHKWILDX:
  E52B  FDE5          		PUSH	IY
  E52D  E1            		POP	HL
  E52E  23            		INC	HL
  E52F                	CHKWILD:
  E52F  060B          		LD	B,11
  E531  3E3F          		LD	A,'?'
  E533                	CHKWIL1:
  E533  BE            		CP	(HL)
  E534  23            		INC	HL
  E535  37            		SCF
  E536  C8            		RET	Z
  E537  10FA          		DJNZ	CHKWIL1
  E539  AF            		XOR	A
  E53A  C9            		RET
                      	
  E53B                	SDIRENT:		;IY=FCB HL=DIR
  E53B  D5            		PUSH	DE
  E53C  E5            		PUSH	HL
  E53D  FDE5          		PUSH	IY
  E53F  D1            		POP	DE
  E540  EB            		EX	DE,HL
  E541  CDE2E4        		CALL	SETNAME
                      	;				Attribute
  E544  FD7E0D        		LD	A,(IY+13)	;(FCB)属性(アトリビュート)
  E547  12            		LD	(DE),A
  E548  13            		INC	DE
                      	;				Reserved
  E549  AF            		XOR	A
  E54A  060A          		LD	B,10
  E54C                	SDE1:
  E54C  12            		LD	(DE),A
  E54D  13            		INC	DE
  E54E  10FC          		DJNZ	SDE1
                      						;(FCB)更新時刻
  E550  21EAF0        		LD	HL,SDDATA		;(FCB)更新年月日
  E553  060A          		LD	B,SDDATAE-SDDATA	;(FCB)ファイルの先頭クラスタ
  E555                	SDLOOP:					;(FCB)ファイルのサイズ(バイト単位)
  E555  7E            		LD	A,(HL)
  E556  23            		INC	HL
  E557  325CE5        		LD	(SDPAT+2),A
  E55A  FD7E00        	SDPAT:	LD	A,(IY+0)	;LD A,(IY+A)
  E55D  12            		LD	(DE),A
  E55E  13            		INC	DE
  E55F  10F4          		DJNZ	SDLOOP
                      	
  E561  AF            		XOR	A
  E562  E1            		POP	HL
  E563  D1            		POP	DE
  E564  C9            		RET
                      	
  E565                	WOPEN:
  E565  FD7E0D        		LD	A,(IY+13)	;(FCB)属性(アトリビュート)
  E568  E61F          		AND	01FH
  E56A  37            		SCF
  E56B  C0            		RET	NZ
  E56C  FD361CFE      		LD	(IY+28),0FEH	;(FCB)オープンモード
  E570                	TOPEN2:
  E570  AF            		XOR	A
  E571                	TOPEN:				;Initializes the time stamp
  E571  FD3617FF      		LD	(IY+23),0FFH	;(FCB)更新時刻
  E575  C9            		RET
                      	
  E576                	WRDFX:
  E576  3ADDE3        		LD	A,(SPCPAT+1)	;1クラスタの論理セクタ
  E579                	L_WRFX:
  E579  1F            		RRA		;->CF
  E57A  3804          		JR	C,E_WRFX
  E57C  CB39          		SRL	C	;C=C/2
  E57E  18F9          		JR	L_WRFX
  E580                	E_WRFX:
  E580  41            		LD	B,C
  E581  04            		INC	B
  E582  3E37          		LD	A,037H		;SCF
  E584  3218E9        		LD	(DRDN1),A
                      	
  E587                	WRDF:				;Bクラスタ分FATを確保する
  E587  110200        		LD	DE,2
  E58A  AF            		XOR	A
  E58B  3288EA        		LD	(_SECPS+1),A
  E58E                	WRDF1:
  E58E  C5            		PUSH	BC
  E58F  D5            		PUSH	DE
  E590  CDF7EF        		CALL	_GNCL
  E593  381C          		JR	C,WRDF3
  E595  7A            		LD	A,D		;空いているかチェック
  E596  B3            		OR	E
  E597  2027          		JR	NZ,WRDF4
  E599  E1            		POP	HL		;HL=空いているクラスタ
  E59A  E5            		PUSH	HL
  E59B  ED5BFEF0      		LD	DE,(_CLPS)	;DE=元の(_CLPS)
  E59F  22FEF0        		LD	(_CLPS),HL
  E5A2  7A            		LD	A,D		;元の(_CLPS)が 0 か?
  E5A3  B3            		OR	E
  E5A4  2008          		JR	NZ,WRDF2
  E5A6  FD751A        		LD	(IY+26),L	;(FCB)ファイルの先頭クラスタ
  E5A9  FD741B        		LD	(IY+27),H	;元が空の場合はFCBにクラスタをセットする
  E5AC  1803          		JR	WRDF3
  E5AE                	WRDF2:
  E5AE  CDFAEF        		CALL	_SNCL
  E5B1                	WRDF3:
  E5B1  D1            		POP	DE
  E5B2  C1            		POP	BC
  E5B3  D8            		RET	C
  E5B4  100C          		DJNZ	WRDF5		;ここでループカウンタチェック
  E5B6  ED5BFEF0      		LD	DE,(_CLPS)
  E5BA  21FFFF        		LD	HL,0FFFFH	;FATエントリ終了(EOCマーク)
  E5BD  C3FAEF        		JP	_SNCL
                      	
  E5C0                	WRDF4:				;DEクラスタが空じゃないので次に移動する
  E5C0  D1            		POP	DE
  E5C1  C1            		POP	BC
  E5C2                	WRDF5:
  E5C2  13            		INC	DE
  E5C3  CDF6E3        		CALL	ENDCL
  E5C6  38C6          		JR	C,WRDF1
  E5C8  37            		SCF
  E5C9  C9            		RET
                      	
  E5CA                	RWXR:
  E5CA  3A96E8        		LD	A,(SECSZ+2)	;1024=4 / 512=2 / 256=1
  E5CD                	L_RWX:
  E5CD  1F            		RRA		;->CF
  E5CE  3806          		JR	C,E_RWX
  E5D0  CB38          		SRL	B	;BC=BC/2
  E5D2  CB19          		RR	C	;
  E5D4  18F7          		JR	L_RWX
  E5D6                	E_RWX:
  E5D6  FD5E1A        		LD	E,(IY+26)	;(FCB)ファイルの先頭クラスタ
  E5D9  FD561B        		LD	D,(IY+27)
  E5DC  AF            		XOR	A
  E5DD  3288EA        		LD	(_SECPS+1),A
  E5E0                	RWX1:
  E5E0  ED53FEF0      		LD	(_CLPS),DE
  E5E4  7A            		LD	A,D
  E5E5  B3            		OR	E
  E5E6  280D          		JR	Z,SCF_RET	;RET DE==0 => CF=1
                      	
  E5E8  78            		LD	A,B
  E5E9  B1            		OR	C
  E5EA  C8            		RET	Z		;RET BC==0 => CF=0
                      	
  E5EB  CD90EA        		CALL	GNCLX
  E5EE  D8            		RET	C
  E5EF  0B            		DEC	BC
                      	
  E5F0  CDF6E3        		CALL	ENDCL
  E5F3  38EB          		JR	C,RWX1
  E5F5                	SCF_RET:
  E5F5  37            		SCF
  E5F6  C9            		RET
                      	
  E5F7                	DSKF:
  E5F7  110000        	MAXCLP:	LD	DE,0
  E5FA  2AACEF        		LD	HL,(_FAKEFREE)
  E5FD  7C            		LD	A,H
  E5FE  B5            		OR	L
  E5FF  2803          		JR	Z,DSKF1
  E601  110100        		LD	DE,1
  E604                	DSKF1:
  E604  D5            		PUSH	DE
  E605  CDF7EF        		CALL	_GNCL
  E608  380C          		JR	C,POPSCF
  E60A  7A            		LD	A,D
  E60B  B3            		OR	E
  E60C  2001          		JR	NZ,DSKF2
  E60E  23            		INC	HL
  E60F                	DSKF2:
  E60F  D1            		POP	DE
  E610  1B            		DEC	DE
  E611  7A            		LD	A,D
  E612  B3            		OR	E
  E613  20EF          		JR	NZ,DSKF1
  E615  C9            		RET
                      	
  E616                	POPSCF:
  E616  F1            		POP	AF
  E617  37            		SCF
  E618  C9            		RET
                      	
  E619                	SETTMS:
  E619  FD7E17        		LD	A,(IY+23)	;(FCB)ファイルを最後に変更した時刻
  E61C  3C            		INC	A
  E61D  C0            		RET	NZ		;ファイルが更新されていない
  E61E                	SETTMSX:			;FCBに日付時刻をセットする
  E61E  CDE0DC        		CALL	_SYS2C		;(BDOS)時刻の獲得
                      					;H←時  L←分  D←秒
  E621  CB25          		SLA	L		;   *2
  E623  CB25          		SLA	L		;   *4
  E625  29            		ADD	HL,HL		;*2 *8
  E626  29            		ADD	HL,HL		;*4 *16
  E627  29            		ADD	HL,HL		;*8 *32
  E628  7A            		LD	A,D
  E629  0F            		RRCA			;bit.0->7->->->0->C
  E62A  E61F          		AND	01FH
  E62C  B5            		OR	L
  E62D  FD7716        		LD	(IY+22),A	;(FCB)ファイルを最後に変更した時刻
  E630  FD7417        		LD	(IY+23),H
                      	
  E633  CDACDC        		CALL	_SYS2A		;(BDOS)日付の獲得
                      					;HL←年  D←月  E←日
  E636  0144F8        		LD	BC,0-1980
  E639  09            		ADD	HL,BC
  E63A  65            		LD	H,L
                      	
  E63B  7A            		LD	A,D
  E63C  87            		ADD	A,A		;*2
  E63D  87            		ADD	A,A		;*4
  E63E  87            		ADD	A,A		;*8
  E63F  87            		ADD	A,A		;*16
  E640  6F            		LD	L,A
  E641  29            		ADD	HL,HL		;*32
  E642  7D            		LD	A,L
  E643  B3            		OR	E
  E644  FD7714        		LD	(IY+20),A	;(FCB)ファイルを最後に変更した日付
  E647  FD7415        		LD	(IY+21),H
  E64A  C9            		RET
                      	
  E64B                	PUSHRR:
  E64B  CD51E6        		CALL	SUBRR
  E64E                	POPRR1:
  E64E  EDB0          		LDIR
  E650  C9            		RET
                      	
  E651                	SUBRR:
  E651  FDE5          		PUSH	IY
  E653  E1            		POP	HL
  E654  112100        		LD	DE,33
  E657  19            		ADD	HL,DE
  E658  115AEF        		LD	DE,HLBUF
  E65B  010300        		LD	BC,3
  E65E  C9            		RET
                      	
  E65F                	SETSEQ:
  E65F  F5            		PUSH	AF		;AHL=Random record
  E660  FD7E21        		LD	A,(IY+33)	;(FCB)ランダムレコード
  E663  FD6E22        		LD	L,(IY+34)
  E666  FD6623        		LD	H,(IY+35)
                      	
  E669  CD85E6        		CALL	SSQ1
                      	
  E66C  29            		ADD	HL,HL
  E66D  CB3D          		SRL	L		;L=L/2
  E66F  FD7520        		LD	(IY+32),L	;(FCB)カレントレコード
  E672  FD740C        		LD	(IY+12),H	;(FCB)カレントブロック
  E675  F1            		POP	AF
                      	
  E676                	POPRR:
  E676  CD51E6        		CALL	SUBRR
  E679  EB            		EX	DE,HL
  E67A  18D2          		JR	POPRR1
                      	
  E67C                	GETSIZE:
  E67C  FD7E10        		LD	A,(IY+16)	;(FCB)ファイルのサイズ(バイト単位)
  E67F  FD6E11        		LD	L,(IY+17)
  E682  FD6612        		LD	H,(IY+18)
  E685                	SSQ1:				;バイト単位からCP/Mのレコード単位を求める（1レコード=128バイト）
  E685  87            		ADD	A,A		;in HLA => out HL
  E686  ED6A          		ADC	HL,HL
  E688  B7            		OR	A
  E689  C8            		RET	Z
  E68A  23            		INC	HL
  E68B  C9            		RET
                      	
  E68C                	GETSEQ:
  E68C  FD6E20        		LD	L,(IY+32)	;(FCB)カレントレコード
  E68F  FD660C        		LD	H,(IY+12)	;(FCB)カレントブロック
                      	
  E692  CB25          		SLA	L	;L=L*2
                      	
  E694  CB3C          		SRL	H	;HL=HL/2
  E696  CB1D          		RR	L	;
  E698  C9            		RET
                      	
  E699                	RB_WRITE:
  E699  C5            		PUSH	BC
  E69A  ED4B4CF0      		LD	BC,(STABLE+2*026H)	;(BDOS)ランダムブロック書き込み
  E69E  1805          		JR	RBRW
  E6A0                	RB_READ:
  E6A0  C5            		PUSH	BC
  E6A1  ED4B4EF0      		LD	BC,(STABLE+2*027H)	;(BDOS)ランダムブロック読み込み
  E6A5                	RBRW:
  E6A5  AF            		XOR	A	;HLA = HL*128
  E6A6  CB3C          		SRL	H	;HL=HL/2
  E6A8  CB1D          		RR	L	;
  E6AA  1F            		RRA			;HLA
  E6AB  FD7721        		LD	(IY+33),A	;(FCB)ランダムレコード
  E6AE  FD7522        		LD	(IY+34),L
  E6B1  FD7423        		LD	(IY+35),H
  E6B4  218000        		LD	HL,128
                      	
  E6B7  FDE5          		PUSH	IY
  E6B9  D1            		POP	DE
  E6BA  D5            		PUSH	DE
  E6BB  CDC2E6        		CALL	JP_BC
  E6BE  FDE1          		POP	IY
  E6C0  C1            		POP	BC
  E6C1  C9            		RET
  E6C2                	JP_BC:
  E6C2  C5            		PUSH	BC
  E6C3  C9            		RET
                      	
  E286                	_SYS03	EQU	SCF_FF_RET	;(BDOS)外部入力
  E286                	_SYS2B	EQU	SCF_FF_RET	;(BDOS)日付の設定
  E286                	_SYS2D	EQU	SCF_FF_RET	;(BDOS)時刻の設定
                      	
                      	;LDFILE2.ASM
                      	
                      	;	LSX-Dodgers FILE2
                      	
                      					;Write random block
  E6C4                	_SYS26:		;(BDOS)ランダムブロック書き込み
  E6C4  AF            		XOR	A
  E6C5  3218E9        		LD	(DRDN1),A	;NOP
  E6C8  22D9E8        		LD	(LEFT+1),HL	;HL←書き込むレコード数
  E6CB  225DEF        		LD	(LEFTX),HL
  E6CE  CDDBE1        		CALL	SETDRV
                      	
  E6D1  CD41E8        		CALL	RBX0
  E6D4  DA6AE7        		JP	C,RBWERR
  E6D7  CD65E5        		CALL	WOPEN
  E6DA  DA6AE7        		JP	C,RBWERR
  E6DD  7C            		LD	A,H
  E6DE  B5            		OR	L
  E6DF  CA63E7        		JP	Z,RBW1
                      	
  E6E2  2B            		DEC	HL
                      	
  E6E3  CDF1E8        		CALL	GET_RR_CDE	;CDE=Random record
                      	
  E6E6  AF            		XOR	A	;AHL=HL+CDE
  E6E7  19            		ADD	HL,DE
  E6E8  89            		ADC	A,C
                      	
  E6E9  47            		LD	B,A
  E6EA  4C            		LD	C,H
                      	
  E6EB  CDCAE5        		CALL	RWXR
  E6EE  DC76E5        		CALL	C,WRDFX
  E6F1  DA6AE7        		JP	C,RBWERR
                      	
  E6F4  CD6AE8        		CALL	RBX2
  E6F7  281A          		JR	Z,RBWB		;NZ=セクタ以下の端数がある
  E6F9  CD7EE8        		CALL	RBXA
  E6FC  386C          		JR	C,RBWERR
  E6FE  EB            		EX	DE,HL
  E6FF  C5            		PUSH	BC
  E700  EDB0          		LDIR
  E702  225FEF        		LD	(DTAX),HL
                      	
  E705  CD0AE5        		CALL	SWTDBF		;バッファデータは更新された
                      	
  E708  2A5DEF        		LD	HL,(LEFTX)
  E70B  D1            		POP	DE
  E70C  ED52          		SBC	HL,DE
  E70E  225DEF        		LD	(LEFTX),HL
  E711  2830          		JR	Z,RBWEND
                      	
  E713                	RBWB:
  E713  CDB4E8        		CALL	RBXB
  E716  2813          		JR	Z,RBWC
  E718                	RBWB1:
  E718  C5            		PUSH	BC
  E719  D5            		PUSH	DE
  E71A  CDD9E3        		CALL	CLUSTX
  E71D  CDF6EB        		CALL	DWT24
  E720  D1            		POP	DE
  E721  C1            		POP	BC
  E722  3846          		JR	C,RBWERR
  E724  CD90EA        		CALL	GNCLX
  E727  3841          		JR	C,RBWERR
  E729  10ED          		DJNZ	RBWB1
  E72B                	RBWC:
  E72B  CDCCE8        		CALL	RBXC
  E72E  2813          		JR	Z,RBWEND
  E730  C5            		PUSH	BC
  E731  CDD9E3        		CALL	CLUSTX
  E734  CD17E9        		CALL	DRDN
  E737  C1            		POP	BC
  E738  3830          		JR	C,RBWERR
  E73A  ED5B7EF0      		LD	DE,(_DTBUF)
  E73E  EDB0          		LDIR
  E740  CD0AE5        		CALL	SWTDBF		;バッファデータは更新された
  E743                	RBWEND:
  E743  CDD8E8        		CALL	RBXEND
                      	
  E746  CD50E8        		CALL	RBX1
  E749  3018          		JR	NC,RBW1
  E74B  2AD9E8        		LD	HL,(LEFT+1)
  E74E  FD5E10        		LD	E,(IY+16)	;(FCB)ファイルのサイズ(バイト単位)
  E751  FD5611        		LD	D,(IY+17)	;CDE=File size
  E754  FD4E12        		LD	C,(IY+18)
  E757  AF            		XOR	A
  E758  19            		ADD	HL,DE
  E759  89            		ADC	A,C
  E75A  FD7510        		LD	(IY+16),L	;(FCB)ファイルのサイズ(バイト単位)
  E75D  FD7411        		LD	(IY+17),H
  E760  FD7712        		LD	(IY+18),A
  E763                	RBW1:
  E763  FDE1          		POP	IY
  E765  C1            		POP	BC
  E766  D1            		POP	DE
  E767  E1            		POP	HL
  E768                	DD_NUL:
  E768  AF            		XOR	A
  E769  C9            		RET
                      	
  E76A                	RBWERR:
  E76A  FDE5          		PUSH	IY
  E76C  D1            		POP	DE
  E76D  2A20F0        		LD	HL,(STABLE+2*010H)
  E770  CD0F00        		CALL	JP_HL
  E773                	RBRERR1:
  E773  3E01          		LD	A,001H
  E775                	RBRERR2:
  E775  FDE1          		POP	IY
  E777  C1            		POP	BC
  E778  D1            		POP	DE
  E779  E1            		POP	HL
  E77A  37            		SCF
  E77B  210000        		LD	HL,0
  E77E  C9            		RET
                      	
  E77F                	RBRERR:
  E77F  3EFF          		LD	A,0FFH
  E781  18F2          		JR	RBRERR2
                      	
  E783                	RBRFL:
  E783  3E00          	RBRFLP:	LD	A,000H
  E785  FE0D          		CP	00DH
  E787  2005          		JR	NZ,RBRFL1
  E789  D5            		PUSH	DE
  E78A  1E0A          		LD	E,00AH
  E78C  1805          		JR	RBRFL2
  E78E                	RBRFL1:
  E78E  D5            		PUSH	DE
  E78F  CD09EF        		CALL	_SYS07
  E792  5F            		LD	E,A
  E793                	RBRFL2:
  E793  CDCDEF        		CALL	_PRINT
  E796  7B            		LD	A,E
  E797  D1            		POP	DE
  E798  3284E7        		LD	(RBRFLP+1),A
  E79B  C9            		RET
  E79C                	DDX:
  E79C  FD7E01        		LD	A,(IY+1)	;(FCB)主ファイル名
  E79F  CDFEE3        		CALL	CAP
  E7A2  FE41          		CP	'A'
  E7A4  C9            		RET
                      	
                      					;Read random block
  E7A5                	_SYS27:		;(BDOS)ランダムブロック読み込み
  E7A5  225DEF        		LD	(LEFTX),HL
  E7A8  CDDBE1        		CALL	SETDRV
                      	
  E7AB  FDCB0D66      		BIT	4,(IY+13)	;(FCB)属性(アトリビュート)
  E7AF  C22FE8        		JP	NZ,RBRDIR	;ディレクトリ
  E7B2  CD41E8        		CALL	RBX0
  E7B5  DA7FE7        		JP	C,RBRERR
  E7B8  CD50E8        		CALL	RBX1
  E7BB  DA73E7        		JP	C,RBRERR1
  E7BE  79            		LD	A,C
  E7BF  EB            		EX	DE,HL
  E7C0  ED52          		SBC	HL,DE		;CP 0HL,CDE
  E7C2  19            		ADD	HL,DE
  E7C3  DE00          		SBC	A,000H
  E7C5  3801          		JR	C,RBR1
  E7C7  EB            		EX	DE,HL
  E7C8                	RBR1:
  E7C8  9F            		SBC	A,A
  E7C9  E601          		AND	1
  E7CB  322DE8        		LD	(RBRAP+1),A
                      	
  E7CE  7C            		LD	A,H
  E7CF  B5            		OR	L
  E7D0  2854          		JR	Z,RBREND0
                      	
  E7D2  22D9E8        		LD	(LEFT+1),HL	;Read record byte
  E7D5  225DEF        		LD	(LEFTX),HL
                      	
  E7D8  CD6AE8        		CALL	RBX2
  E7DB  2819          		JR	Z,RBRB
  E7DD  CD7EE8        		CALL	RBXA
  E7E0  DA7FE7        		JP	C,RBRERR
  E7E3  C5            		PUSH	BC
  E7E4  EDB0          		LDIR
  E7E6  ED535FEF      		LD	(DTAX),DE
  E7EA  2A5DEF        		LD	HL,(LEFTX)
  E7ED  D1            		POP	DE
  E7EE  A7            		AND	A
  E7EF  ED52          		SBC	HL,DE
  E7F1  225DEF        		LD	(LEFTX),HL
  E7F4  282D          		JR	Z,RBREND
                      	
  E7F6                	RBRB:
  E7F6  CDB4E8        		CALL	RBXB
  E7F9  2812          		JR	Z,RBRC
  E7FB                	RBRB1:
  E7FB  C5            		PUSH	BC
  E7FC  D5            		PUSH	DE
  E7FD  CDD9E3        		CALL	CLUSTX
  E800  CDE6EB        		CALL	DRD24
  E803  D1            		POP	DE
  E804  C1            		POP	BC
  E805  D490EA        		CALL	NC,GNCLX
  E808  DA7FE7        		JP	C,RBRERR
  E80B  10EE          		DJNZ	RBRB1
  E80D                	RBRC:
  E80D  CDCCE8        		CALL	RBXC
  E810  2811          		JR	Z,RBREND
  E812  C5            		PUSH	BC
  E813  CDD9E3        		CALL	CLUSTX
  E816  CDFBE8        		CALL	DRDX
  E819  C1            		POP	BC
  E81A  DA7FE7        		JP	C,RBRERR
  E81D  EB            		EX	DE,HL
  E81E  2A7EF0        		LD	HL,(_DTBUF)
  E821  EDB0          		LDIR
  E823                	RBREND:
  E823  CDD8E8        		CALL	RBXEND
  E826                	RBREND0:
  E826  FDE1          		POP	IY
  E828  C1            		POP	BC
  E829  D1            		POP	DE
  E82A  F1            		POP	AF	;(HL)
  E82B  AF            		XOR	A
  E82C  3E00          	RBRAP:	LD	A,000H
  E82E  C9            		RET
                      	
  E82F                	RBRDIR:
  E82F  FD6E1A        		LD	L,(IY+26)	;(FCB)ファイルの先頭クラスタ
  E832  FD661B        		LD	H,(IY+27)
  E835  CD19E4        		CALL	CHDIR
  E838  AF            		XOR	A
  E839  67            		LD	H,A
  E83A  6F            		LD	L,A
  E83B  3C            		INC	A
  E83C  322DE8        		LD	(RBRAP+1),A
  E83F  18E5          		JR	RBREND0
                      	
  E841                	RBX0:
  E841  2A8AEF        		LD	HL,(_DTA)
  E844  225FEF        		LD	(DTAX),HL
  E847  2A5DEF        		LD	HL,(LEFTX)
  E84A  FD7E1C        		LD	A,(IY+28)	;(FCB)オープンモード
  E84D  D6FD          		SUB	0FDH
  E84F  C9            		RET
                      	
  E850                	RBX1:
  E850  E5            		PUSH	HL		;Record byte
                      					;AHL=File size
  E851  FD6E10        		LD	L,(IY+16)	;ファイルのサイズ(バイト単位)
  E854  FD6611        		LD	H,(IY+17)
  E857  FD7E12        		LD	A,(IY+18)
                      	
  E85A  CDF1E8        		CALL	GET_RR_CDE	;CDE=Random record
                      	
  E85D  A7            		AND	A
  E85E  ED52          		SBC	HL,DE
  E860  99            		SBC	A,C
  E861  D1            		POP	DE
                      	
  E862  D8            		RET	C
  E863  4F            		LD	C,A
  E864  EB            		EX	DE,HL	;CDE=File byte	HL=Record byte
  E865  B2            		OR	D
  E866  B3            		OR	E
  E867  C0            		RET	NZ
  E868  37            		SCF
  E869  C9            		RET
                      	
  E86A                	RBX2:				;Cluster settings
  E86A  FD4E22        		LD	C,(IY+34)	;(+33)(FCB)ランダムレコード
  E86D  FD4623        		LD	B,(IY+35)
  E870  CDCAE5        		CALL	RWXR
  E873  3A96E8        		LD	A,(SECSZ+2)	;1024=4 / 512=2 / 256=1
  E876  3D            		DEC	A
  E877  FDA622        		AND	(IY+34)
  E87A  FDB621        		OR	(IY+33)
  E87D  C9            		RET
                      	
  E87E                	RBXA:
  E87E  C5            		PUSH	BC
  E87F  D5            		PUSH	DE
  E880  CDD9E3        		CALL	CLUSTX
  E883  CDFBE8        		CALL	DRDX
  E886  D1            		POP	DE
  E887  C1            		POP	BC
  E888  D8            		RET	C
  E889  CD90EA        		CALL	GNCLX
  E88C  D8            		RET	C
  E88D  ED53FEF0      		LD	(_CLPS),DE
                      	
  E891  FD4E21        		LD	C,(IY+33)	;(FCB)ランダムレコード
  E894  210004        	SECSZ:	LD	HL,0400H	;自己書き換え 1024=0400H / 512=0200H ここに1セクタのサイズが格納される
  E897  7C            		LD	A,H
  E898  3D            		DEC	A		;1024=3 / 512=1
  E899  FDA622        		AND	(IY+34)		;(FCB)ランダムレコード
  E89C  47            		LD	B,A		;BCに1セクタ以下の端数が入る
  E89D  ED42          		SBC	HL,BC		;残りを計算
                      	
  E89F  ED5B5DEF      		LD	DE,(LEFTX)
  E8A3  ED52          		SBC	HL,DE		;CP HL,DE
  E8A5  19            		ADD	HL,DE		;
  E8A6  3801          		JR	C,RBXA1		;DEとHLを比較して大きい方をHLに
  E8A8  EB            		EX	DE,HL
  E8A9                	RBXA1:
  E8A9  E5            		PUSH	HL
  E8AA  2A7EF0        		LD	HL,(_DTBUF)
  E8AD  09            		ADD	HL,BC
  E8AE  ED5B5FEF      		LD	DE,(DTAX)
  E8B2  C1            		POP	BC
  E8B3  C9            		RET
                      	
  E8B4                	RBXB:
  E8B4  2A5FEF        		LD	HL,(DTAX)
  E8B7  ED5BFEF0      		LD	DE,(_CLPS)
  E8BB  3A5EEF        		LD	A,(LEFTX+1)
  E8BE  47            		LD	B,A
  E8BF  3A96E8        		LD	A,(SECSZ+2)	;1024=4 / 512=2 / 256=1
  E8C2                	RBXB1:
  E8C2  1F            		RRA		;->CF
  E8C3  3804          		JR	C,RBXB2
  E8C5  CB38          		SRL	B	;B=B/2
  E8C7  18F9          		JR	RBXB1
  E8C9                	RBXB2:
  E8C9  78            		LD	A,B
  E8CA  B7            		OR	A
  E8CB  C9            		RET
                      	
  E8CC                	RBXC:
  E8CC  ED4B5DEF      		LD	BC,(LEFTX)
  E8D0  3A96E8        		LD	A,(SECSZ+2)	;1024=4 / 512=2 / 256=1
  E8D3  3D            		DEC	A
  E8D4  A0            		AND	B
  E8D5  47            		LD	B,A		;1セクタ以下の端数がない場合はZ
  E8D6  B1            		OR	C
  E8D7  C9            		RET
                      	
  E8D8                	RBXEND:
  E8D8  110000        	LEFT:	LD	DE,0
  E8DB  AF            		XOR	A
  E8DC  FD6E21        		LD	L,(IY+33)	;(FCB)ランダムレコード
  E8DF  FD6622        		LD	H,(IY+34)
  E8E2  19            		ADD	HL,DE
  E8E3  FD8E23        		ADC	A,(IY+35)
  E8E6  FD7521        		LD	(IY+33),L	;(FCB)ランダムレコード
  E8E9  FD7422        		LD	(IY+34),H
  E8EC  FD7723        		LD	(IY+35),A
  E8EF  EB            		EX	DE,HL		;HL=Read byte
  E8F0  C9            		RET
                      	
  E8F1                	GET_RR_CDE:			;CDE=Random record
  E8F1  FD5E21        		LD	E,(IY+33)	;(FCB)ランダムレコード
  E8F4  FD5622        		LD	D,(IY+34)
  E8F7  FD4E23        		LD	C,(IY+35)
  E8FA  C9            		RET
                      	
                      	
                      	;LDDIO.ASM
                      	
                      	;	LSX-Dodgers DIO
                      	
  E8FB                	DRDX:
  E8FB  CD39E9        		CALL	DRDY
  E8FE  C8            		RET	Z
  E8FF  CD1FE9        		CALL	DRDX1		;データバッファの情報を保存
  E902  D8            		RET	C
  E903  E5            		PUSH	HL
  E904  C5            		PUSH	BC
  E905  D5            		PUSH	DE
  E906  2A7EF0        		LD	HL,(_DTBUF)
  E909  3A62E9        		LD	A,(_DBS24+1)
  E90C  4F            		LD	C,A
  E90D  CDE6EB        		CALL	DRD24
  E910  DC34E9        		CALL	C,DRDNE
  E913                	POP_DE_BC_HL_RET:
  E913  D1            		POP	DE
  E914  C1            		POP	BC
  E915  E1            		POP	HL
  E916  C9            		RET
                      	
                      	;	CDE:セクタ番号
  E917                	DRDN:
  E917  AF            		XOR	A
  E918  00            	DRDN1:	NOP			;自己書き換え NOP / SCF
  E919  30E0          		JR	NC,DRDX
  E91B                	DRDNX:
  E91B  CD39E9        		CALL	DRDY
  E91E  C8            		RET	Z
  E91F                	DRDX1:
  E91F  CD4FE9        		CALL	DWTX
                      					;データバッファの読み込んだドライブ・セクタ情報を保存
  E922  ED53A6EF      		LD	(_DBSEC),DE
  E926  79            		LD	A,C
  E927  3262E9        		LD	(_DBS24+1),A
                      	
  E92A  3A88EF        		LD	A,(_DRV)
  E92D  32A5EF        		LD	(_DBDRV),A
  E930  CDD9EF        		CALL	_CHGDRV
  E933  D0            		RET	NC
  E934                	DRDNE:
  E934  9F            		SBC	A,A		;CF=1ならばA=0FFH
  E935  32A5EF        		LD	(_DBDRV),A
  E938  C9            		RET
                      	
                      	;	CDE:セクタ番号
  E939                	DRDY:
  E939  3A62E9        		LD	A,(_DBS24+1)
  E93C  B9            		CP	C
  E93D  C0            		RET	NZ
                      	
  E93E  E5            		PUSH	HL
  E93F  3A88EF        		LD	A,(_DRV)
  E942  21A5EF        		LD	HL,_DBDRV
  E945  AE            		XOR	(HL)
  E946  2005          		JR	NZ,POP_HL_RET
                      	
  E948  2AA6EF        		LD	HL,(_DBSEC)
  E94B  ED52          		SBC	HL,DE		;CF=0
  E94D                	POP_HL_RET:
  E94D  E1            		POP	HL
  E94E  C9            		RET
                      	
  E94F                	DWTX:
  E94F  3AA4EF        		LD	A,(_WTDBF)
  E952  B7            		OR	A
  E953  C8            		RET	Z
  E954  AF            		XOR	A
  E955  32A4EF        		LD	(_WTDBF),A
                      	
  E958  E5            		PUSH	HL
  E959  C5            		PUSH	BC
  E95A  D5            		PUSH	DE
  E95B  3AA5EF        		LD	A,(_DBDRV)
  E95E  CDD9EF        		CALL	_CHGDRV
  E961  0E00          	_DBS24:	LD	C,0
  E963  ED5BA6EF      		LD	DE,(_DBSEC)
  E967  2A7EF0        		LD	HL,(_DTBUF)
  E96A  D4F6EB        		CALL	NC,DWT24
  E96D                	POP_DE_BC_HL_RET2:
  E96D  18A4          		JR	POP_DE_BC_HL_RET
                      	
  E96F                	RDFATX:
  E96F  E5            		PUSH	HL
  E970  3A88EF        		LD	A,(_DRV)
  E973  21AAEF        		LD	HL,_FATDRV
  E976  AE            		XOR	(HL)
  E977  28D4          		JR	Z,POP_HL_RET
                      	
  E979  C5            		PUSH	BC
  E97A  D5            		PUSH	DE
  E97B  DDE5          		PUSH	IX
  E97D  CD99E9        		CALL	WTFATX
  E980  3813          		JR	C,POP_IX_DE_BC_HL_RET
                      	
  E982  AF            		XOR	A
  E983  32ABEF        		LD	(_FATIX),A
  E986  3A88EF        		LD	A,(_DRV)
  E989  32AAEF        		LD	(_FATDRV),A
  E98C  CDE5EF        		CALL	_RDFAT
  E98F                	RDFATE2:
  E98F  3004          		JR	NC,POP_IX_DE_BC_HL_RET
  E991  9F            		SBC	A,A		;A=0xFF
  E992  32AAEF        		LD	(_FATDRV),A
  E995                	POP_IX_DE_BC_HL_RET:
  E995  DDE1          		POP	IX
  E997  18D4          		JR	POP_DE_BC_HL_RET2
                      	
  E999                	WTFATX:
  E999  3AA2EF        		LD	A,(_WTFATF)
  E99C  B7            		OR	A
  E99D  C8            		RET	Z
  E99E  E5            		PUSH	HL
  E99F  3AAAEF        		LD	A,(_FATDRV)
  E9A2  21A5EF        		LD	HL,_DBDRV
  E9A5  AE            		XOR	(HL)
  E9A6  CC4FE9        		CALL	Z,DWTX
  E9A9  38A2          		JR	C,POP_HL_RET
  E9AB  C5            		PUSH	BC
  E9AC  D5            		PUSH	DE
  E9AD  DDE5          		PUSH	IX
  E9AF  CD03EC        		CALL	WTFAT
  E9B2  AF            		XOR	A
  E9B3  32A2EF        		LD	(_WTFATF),A
  E9B6  18DD          		JR	POP_IX_DE_BC_HL_RET
                      	
  E9B8                	NCL1:
  E9B8  7A            		LD	A,D
  E9B9  B3            		OR	E
  E9BA  37            		SCF
  E9BB  C8            		RET	Z
                      	
  E9BC  7A            		LD	A,D
  E9BD  CB3F          		SRL	A	;/2
  E9BF  CB3F          		SRL	A	;/2
                      	
  E9C1  E5            		PUSH	HL
  E9C2  32E1E9        		LD	(NCLPAT+2),A	;_FATIX
  E9C5  2AAAEF        		LD	HL,(_FATDRV)	;L=_FATDRV H=_FATIX
  E9C8  BC            		CP	H
  E9C9  3A88EF        		LD	A,(_DRV)	;この間でフラグは変化しない
  E9CC  32E0E9        		LD	(NCLPAT+1),A	;_FATDRV
  E9CF  2005          		JR	NZ,NCL2		;FATIXが違う
  E9D1  BD            		CP	L
  E9D2  2002          		JR	NZ,NCL2		;ドライブが違う
  E9D4  E1            		POP	HL
  E9D5  C9            		RET
  E9D6                	NCL2:
  E9D6  C5            		PUSH	BC
  E9D7  D5            		PUSH	DE
  E9D8  DDE5          		PUSH	IX
  E9DA  CD99E9        		CALL	WTFATX
  E9DD  38B6          		JR	C,POP_IX_DE_BC_HL_RET
  E9DF  010000        	NCLPAT:	LD	BC,0		;自己書き換え C=_FATDRV B=_FATIX
  E9E2  ED43AAEF      		LD	(_FATDRV),BC
  E9E6  CDD6EB        		CALL	RDFATS
  E9E9  18A4          		JR	RDFATE2
                      	
  E9EB                	NCL3:
  E9EB  CB9A          		RES	3,D
  E9ED  CB92          		RES	2,D
  E9EF  6B            		LD	L,E
  E9F0  62            		LD	H,D
  E9F1  CB3C          		SRL	H	;
  E9F3  CB1D          		RR	L	;HLA=HLA/2
  E9F5  1F            		RRA		;
  E9F6  F5            		PUSH	AF
  E9F7  3AABEF        		LD	A,(_FATIX)
  E9FA  0F            		RRCA
  E9FB  300B          		JR	NC,NCL3X1
  E9FD  3A96E8        		LD	A,(SECSZ+2)
  EA00  FE04          		CP	4		;1セクタ1024バイトの場合は奇数インデックスの場合に先頭を512バイトずらす
  EA02  2004          		JR	NZ,NCL3X1
  EA04  010002        		LD	BC,512
  EA07  09            		ADD	HL,BC
  EA08                	NCL3X1:
  EA08  F1            		POP	AF
  EA09  ED4B7CF0      		LD	BC,(_FATBF)
  EA0D  19            		ADD	HL,DE
  EA0E  09            		ADD	HL,BC
  EA0F  17            		RLA
  EA10  C9            		RET
                      	
  EA11                	GNCL:
  EA11  CDB8E9        		CALL	NCL1		;GET NEXT CLUSTER
  EA14  D8            		RET	C
  EA15  C5            		PUSH	BC
  EA16  E5            		PUSH	HL
  EA17  CDEBE9        		CALL	NCL3
  EA1A  3809          		JR	C,GNC1
  EA1C  5E            		LD	E,(HL)
  EA1D  23            		INC	HL
  EA1E  7E            		LD	A,(HL)
  EA1F  E60F          		AND	00FH
  EA21  57            		LD	D,A
  EA22  E1            		POP	HL
  EA23  C1            		POP	BC
  EA24  C9            		RET
  EA25                	GNC1:
  EA25  7E            		LD	A,(HL)
  EA26  23            		INC	HL
  EA27  56            		LD	D,(HL)
  EA28  0604          		LD	B,4
  EA2A                	GNC1L:
  EA2A  CB3A          		SRL	D	;DA=DA/2
  EA2C  1F            		RRA		;
  EA2D  10FB          		DJNZ	GNC1L
                      	
  EA2F  5F            		LD	E,A
  EA30  E1            		POP	HL
  EA31  C1            		POP	BC
  EA32  A7            		AND	A
  EA33  C9            		RET
                      	
  EA34                	SNCL:
  EA34  CDB8E9        		CALL	NCL1
  EA37  D8            		RET	C
                      	;				SET NEXT CLUSTER
  EA38  E5            		PUSH	HL
  EA39  C5            		PUSH	BC
  EA3A  D5            		PUSH	DE
  EA3B  E5            		PUSH	HL
  EA3C  CDEBE9        		CALL	NCL3
  EA3F  D1            		POP	DE
                      	;CF=ODD
  EA40  7E            		LD	A,(HL)
  EA41  73            		LD	(HL),E
  EA42  3806          		JR	C,SNC1
                      	;EVEN
                      	;M[0] = E
                      	;M[1] = (M[1] & 0xF0) | (D & 0x0F)
  EA44  23            		INC	HL
  EA45  ED67          		RRD		;M={A[3:0],E[3:0]}
  EA47  7A            		LD	A,D
  EA48  1804          		JR	SNC11
  EA4A                	SNC1:
                      	;ODD
                      	;HL[0] = (HL[0]&0x0F) | (E<<4)
                      	;HL[1] = DE>>4
  EA4A  ED6F          		RLD		;M={D[3:0],E[7:4]}
  EA4C  23            		INC	HL
  EA4D  72            		LD	(HL),D	;M={D[3:0],E[7:4]}
  EA4E                	SNC11:
  EA4E  ED6F          		RLD		;M={M[7:4],D[3:0]}
  EA50  B7            		OR	A
  EA51  D1            		POP	DE
  EA52  C1            		POP	BC
  EA53  E1            		POP	HL
  EA54                	FAT_CHANGED:
  EA54  3E01          		LD	A,1
  EA56  32A2EF        		LD	(_WTFATF),A
  EA59  C9            		RET
                      	
  EA5A                	N16CL3:
  EA5A  C5            		PUSH	BC
  EA5B  6B            		LD	L,E
  EA5C  7A            		LD	A,D
  EA5D  E603          		AND	3
  EA5F  67            		LD	H,A
  EA60  29            		ADD	HL,HL
  EA61  ED4B7CF0      		LD	BC,(_FATBF)
  EA65  09            		ADD	HL,BC
  EA66  C1            		POP	BC
  EA67  C9            		RET
                      	
  EA68                	GNCL16:
  EA68  CDB8E9        		CALL	NCL1		;GET NEXT CLUSTER for FAT16
  EA6B  D8            		RET	C
  EA6C  E5            		PUSH	HL
  EA6D  CD5AEA        		CALL	N16CL3
  EA70  5E            		LD	E,(HL)
  EA71  23            		INC	HL
  EA72  56            		LD	D,(HL)
  EA73  E1            		POP	HL
  EA74  C9            		RET
                      	
  EA75                	SNCL16:
  EA75  CDB8E9        		CALL	NCL1		;GET NEXT CLUSTER for FAT16
  EA78  D8            		RET	C
  EA79  D5            		PUSH	DE
  EA7A  E5            		PUSH	HL
  EA7B  CD5AEA        		CALL	N16CL3
  EA7E  D1            		POP	DE		;HL
  EA7F  73            		LD	(HL),E
  EA80  23            		INC	HL
  EA81  72            		LD	(HL),D
  EA82  6B            		LD	L,E
  EA83  62            		LD	H,D
  EA84  D1            		POP	DE
  EA85  18CD          		JR	FAT_CHANGED
                      	
                      	;------------------------
                      	;次のセクタを探す際に_SECPSの値をチェック
                      	;in
                      	;	DE : セクタ番号
                      	;out
                      	;	DE : 次のセクタ番号
                      	;note
                      	;
                      	;------------------------
  EA87                	NEXTX:
  EA87  3E00          	_SECPS:	LD	A,0	;自己書き換え
  EA89  3C            		INC	A
  EA8A  E600          	NCPAT:	AND	0	;自己書き換え　1クラスタの論理セクタ数-1
  EA8C  3288EA        		LD	(_SECPS+1),A
  EA8F  C9            		RET
                      	
  EA90                	GNCLX:
  EA90  CD87EA        		CALL	NEXTX
  EA93  C0            		RET	NZ	;1クラスタのセクタ未満の場合は戻る
  EA94  C3F7EF        		JP	_GNCL	;次のクラスタを探す
                      	
  EA97                	RDFAT:
  EA97  3E80          		LD	A,080H
  EA99  3270EF        		LD	(CHECK),A
  EA9C                	RDFAT1:
  EA9C  3A88EF        		LD	A,(_DRV)
  EA9F  CD3CED        		CALL	CHGDRVR
  EAA2  D8            		RET	C
  EAA3  DD7E12        		LD	A,(IX+012H)	;DPB_12_DEVICE
  EAA6  CB6F          		BIT	5,A
  EAA8  2843          		JR	Z,RDFAT0X
  EAAA  2170EF        		LD	HL,CHECK
  EAAD  A6            		AND	(HL)
  EAAE  77            		LD	(HL),A
  EAAF  110000        		LD	DE,0		;BPB
  EAB2  2A7CF0        		LD	HL,(_FATBF)
  EAB5  CDE4EB        		CALL	DRD16
  EAB8  3024          		JR	NC,GETBPB
  EABA  2170EF        		LD	HL,CHECK
  EABD  CB06          		RLC	(HL)
  EABF  3F            		CCF
  EAC0  D8            		RET	C
  EAC1  DDCB0A1E      		RR	(IX+00AH)	;DPB_0A_FDMODE
  EAC5  3F            		CCF			;フロッピーディスクのMFMモードを切り替える
  EAC6  DDCB0A16      		RL	(IX+00AH)	;DPB_0A_FDMODE
  EACA  3EFF          		LD	A,0FFH
  EACC  3289EF        		LD	(_DSK),A
  EACF  3A84EF        		LD	A,(_DRIVE)
  EAD2  E603          		AND	3
  EAD4  F680          		OR	080H
  EAD6  6F            		LD	L,A
  EAD7  26EF          		LD	H,_CYL0/256
  EAD9  3EFF          		LD	A,0FFH
  EADB  77            		LD	(HL),A
  EADC  18BE          		JR	RDFAT1
  EADE                	GETBPB:
  EADE  FDE5          		PUSH	IY
  EAE0  FD2A7CF0      		LD	IY,(_FATBF)	;BPB
  EAE4  CDF1EF        		CALL	_BPB2DPB
  EAE7  FDE1          		POP	IY
  EAE9  D8            		RET	C
  EAEA  CD8EEC        		CALL	CHGDRV2
  EAED                	RDFAT0X:
  EAED  CDD6EB        		CALL	RDFATS
  EAF0  D8            		RET	C
  EAF1  DDBE06        		CP	(IX+6)		;DPB_06_FATID
  EAF4  C8            		RET	Z
  EAF5  DDCB126E      		BIT	5,(IX+012H)	;DPB_12_DEVICE
  EAF9  C0            		RET	NZ		;BPBを取得している場合はFATIDをチェックしない
  EAFA  37            		SCF
  EAFB  C9            		RET
                      	
  EAFC                	BPB2DPB:
  EAFC  FD7E00        		LD	A,(IY+0)	;BS_JmpBoot
  EAFF  FEEB          		CP	0EBH		;Short jump
  EB01  2808          		JR	Z,BPBOK
  EB03  FEE9          		CP	0E9H		;Near jump
  EB05  2804          		JR	Z,BPBOK
  EB07  FE60          		CP	060H		;X68k
  EB09  37            		SCF
  EB0A  C0            		RET	NZ
  EB0B                	BPBOK:
  EB0B  FD7E0D        		LD	A,(IY+13)	;BPB_SecPerClus
  EB0E  DD7707        		LD	(IX+7),A	;DPB_07_SECPCL
                      	
  EB11  FD7E16        		LD	A,(IY+22)	;BPB_FATSz16
  EB14  DD7700        		LD	(IX+0),A	;DPB_00_FATLN
  EB17  FD7E17        		LD	A,(IY+23)	;BPB_FATSz16
  EB1A  DD7701        		LD	(IX+1),A	;DPB_00_FATLN
                      	
  EB1D  FD6E0E        		LD	L,(IY+14)	;BPB_RsvdSecCnt
  EB20  FD660F        		LD	H,(IY+15)
  EB23  DD750E        		LD	(IX+00EH),L	;DPB_0E_FATPS
  EB26  FD5E16        		LD	E,(IY+22)	;BPB_FATSz16
  EB29  FD5617        		LD	D,(IY+23)
  EB2C  FD4610        		LD	B,(IY+16)	;BPB_NumFATs
  EB2F                	BPBDP1:				;BPB_FATSz16 * BPB_NumFATs
  EB2F  19            		ADD	HL,DE
  EB30  10FD          		DJNZ	BPBDP1
  EB32                	BPBDP2:
  EB32  DD7510        		LD	(IX+010H),L	;DPB_10_DIRPS
  EB35  DD7411        		LD	(IX+011H),H
  EB38  E5            		PUSH	HL
                      	
  EB39  FD6E11        		LD	L,(IY+17)	;BPB_RootEntCnt
  EB3C  FD6612        		LD	H,(IY+18)
  EB3F  FD7E0C        		LD	A,(IY+12)	;BPB_BytsPerSec
  EB42  0606          		LD	B,6
  EB44                	BPBBPS1:
  EB44  05            		DEC	B
  EB45  0F            		RRCA
  EB46  30FC          		JR	NC,BPBBPS1
  EB48                	BPBDE1:
  EB48  29            		ADD	HL,HL
  EB49  10FD          		DJNZ	BPBDE1
                      	
  EB4B  7C            		LD	A,H
  EB4C  DD770B        		LD	(IX+00BH),A	;DPB_0B_DIRSCNT
                      	
  EB4F  D1            		POP	DE		;DPB_10_DIRPS
  EB50  6C            		LD	L,H
  EB51  2600          		LD	H,0
  EB53  19            		ADD	HL,DE		;MAXDIR
  EB54  E5            		PUSH	HL
  EB55  FD4E0D        		LD	C,(IY+13)	;BPB_SecPerClus
  EB58  CB21          		SLA	C		;*2
  EB5A  AF            		XOR	A
  EB5B  47            		LD	B,A
  EB5C  ED42          		SBC	HL,BC
  EB5E  DD7514        		LD	(IX+014H),L	;DPB_14_ADDCL16
  EB61  DD7415        		LD	(IX+015H),H
                      	
  EB64  D1            		POP	DE		;DE=DPB_0B_MAXDIR
  EB65  FD6E13        		LD	L,(IY+19)	;BPB_TotSec16
  EB68  FD6614        		LD	H,(IY+20)
  EB6B  7C            		LD	A,H
  EB6C  B5            		OR	L
  EB6D  3E00          		LD	A,0		;LDでフラグは変化しない。BPB_TotSec16を AHL で扱う為、Aに0を入れる
  EB6F  2010          		JR	NZ,BPB16BIT	;BPB_TotSec16が「0」の場合はBPB_TotSec32で計算
  EB71  FD7E23        		LD	A,(IY+35)	;念のために総セクタ数が24ビットを超える場合はエラーを返す
  EB74  B7            		OR	A
  EB75  37            		SCF
  EB76  C0            		RET	NZ
  EB77  FD6E20        		LD	L,(IY+32)	;BPB_TotSec32 は AHL の24ビットで扱う
  EB7A  FD6621        		LD	H,(IY+33)	;1クラスタの論理セクタ数(DPB_07_SECPCL)が最大128なので
  EB7D  FD7E22        		LD	A,(IY+34)	;24ビットを超えると必ずクラスタ数が16ビットを超えてしまうのでこれで十分
  EB80  A7            		AND	A		;CF=0
  EB81                	BPB16BIT:
  EB81  ED52          		SBC	HL,DE
  EB83  DE00          		SBC	A,0
  EB85  FD460D        		LD	B,(IY+13)	;BPB_SecPerClus
  EB88                	BPBTC1:				;総クラスタ数(AHL) = 総セクタ数(AHL) / セクタサイズ(B)
  EB88  CB18          		RR	B		;->CY
  EB8A  3808          		JR	C,BPBTC2
  EB8C  CB3F          		SRL	A
  EB8E  CB1C          		RR	H		;AHL=AHL/2
  EB90  CB1D          		RR	L
  EB92  18F4          		JR	BPBTC1
  EB94                	BPBTC2:
  EB94  B7            		OR	A
  EB95  37            		SCF
  EB96  C0            		RET	NZ		;念のため(クラスタ数が16ビットを超える場合)
  EB97  23            		INC	HL
  EB98  23            		INC	HL
  EB99  DD7508        		LD	(IX+8),L	;DPB_08_MAXCL
  EB9C  DD7409        		LD	(IX+9),H
                      	
  EB9F  FD7E15        		LD	A,(IY+21)	;BPB_Media
  EBA2  DD7706        		LD	(IX+6),A	;DPB_06_FATID
                      	
  EBA5  DDCB0A7E      		BIT	7,(IX+00AH)	;DPB_0A_FDMODE
  EBA9  2817          		JR	Z,NOT_FD
  EBAB  2E28          		LD	L,40		;MAXCYLの設定（要検討）ここから下はフロッピーのみ書き換える
  EBAD  FEFD          		CP	0FDH	;2D
  EBAF  2808          		JR	Z,SETCYL
  EBB1  2E4D          		LD	L,77
  EBB3  FEFE          		CP	0FEH	;2HD
  EBB5  2802          		JR	Z,SETCYL
  EBB7  2E50          		LD	L,80	;その他2DD等
  EBB9                	SETCYL:
  EBB9  DD750C        		LD	(IX+00CH),L	;DPB_0C_MAXCYL
  EBBC  FD7E18        		LD	A,(IY+24)	;BPB_SecPerTr
  EBBF  DD770D        		LD	(IX+00DH),A	;DPB_0D_MAXSEC	;ここまでフロッピー専用
  EBC2                	NOT_FD:
  EBC2  FD7E10        		LD	A,(IY+16)	;BPB_NumFATs
  EBC5  FE02          		CP	2		;>2:NC
  EBC7  FD7E0C        		LD	A,(IY+12)	;BPB_BytsPerSec
  EBCA  3802          		JR	C,BPBFAT1
  EBCC  F680          		OR	080H
  EBCE                	BPBFAT1:
  EBCE  DD770F        		LD	(IX+00FH),A	;DPB_0F_BPS
                      	
  EBD1  E67F          		AND	07FH		;セクタバッファが1KBしかないので1KBを超える場合はCF=1でエラーにする
  EBD3  C6FB          		ADD	A,0-5		;0-4:NC 5以上:C
  EBD5  C9            		RET
                      	
  EBD6                	RDFATS:
  EBD6  CD21EC        		CALL	FATSETUP
  EBD9  D8            		RET	C
  EBDA                	RDFATL:
  EBDA  0E00          		LD	C,0
  EBDC  CDE8EB        		CALL	DRD24B
  EBDF  2A7CF0        		LD	HL,(_FATBF)
  EBE2  7E            		LD	A,(HL)
  EBE3  C9            		RET
                      	
  EBE4                	DRD16:
  EBE4  0E00          		LD	C,0
  EBE6                	DRD24:
  EBE6  0601          		LD	B,1
  EBE8                	DRD24B:
  EBE8  DDE5          		PUSH	IX
  EBEA  DD2AA8EF      		LD	IX,(_DPB)
  EBEE  CD5BEE        	DRDPAT:	CALL	FDRD		;自己書き換え（ディスク読み込み）
  EBF1                	POP_IX_RET:
  EBF1  DDE1          		POP	IX
  EBF3  C9            		RET
                      	
  EBF4                	DWT16:
  EBF4  0E00          		LD	C,0
  EBF6                	DWT24:
  EBF6  0601          		LD	B,1
  EBF8                	DWT24B:
  EBF8  DDE5          		PUSH	IX
  EBFA  DD2AA8EF      		LD	IX,(_DPB)
  EBFE  CD4DEE        	DWTPAT:	CALL	FDWT		;自己書き換え（ディスク書き込み）
  EC01  18EE          		JR	POP_IX_RET
                      	
  EC03                	WTFAT:
  EC03  CD21EC        		CALL	FATSETUP
  EC06  D41CEC        		CALL	NC,WTFATL
  EC09  D8            		RET	C
  EC0A  DDCB0F7E      		BIT	7,(IX+00FH)	;DPB_0F_BPS
  EC0E  C8            		RET	Z		;予備FATが無い
  EC0F  CD28EC        		CALL	FATS2
  EC12  E5            		PUSH	HL		;予備FAT
  EC13  DD6E00        		LD	L,(IX+0)	;DPB_00_FATLN
  EC16  DD6601        		LD	H,(IX+1)
  EC19  19            		ADD	HL,DE
  EC1A  EB            		EX	DE,HL
  EC1B  E1            		POP	HL
  EC1C                	WTFATL:
  EC1C  0E00          		LD	C,0
  EC1E  C3F8EB        		JP	DWT24B
                      	;------------------------
                      	;FATのセットアップ
                      	;out
                      	;	B  : FATセクタ数
                      	;	DE : FAT先頭セクタ番号
                      	;	HL : FATバッファポインタ
                      	;	CF : 1=ドライブ切り替えエラー
                      	;note
                      	;	FATサイズがFATバッファを超える場合は
                      	;	対象クラスタ領域==(_FATIX)によって
                      	;	FAT12:対象クラスタ1024毎に1.5KBを切り替える
                      	;	FAT16:対象クラスタ1024毎に2KBを切り替える
                      	;------------------------
  EC21                	FATSETUP:
  EC21  3AAAEF        		LD	A,(_FATDRV)
  EC24  CD3CED        		CALL	CHGDRVR		;ドライブ切り替え
  EC27  D8            		RET	C
  EC28                	FATS2:
  EC28  DD7E0F        		LD	A,(IX+00FH)	;DPB_0F_BPS 512=2 1024=4
  EC2B  0F            		RRCA
  EC2C  CD54EC        	FATSX:	CALL	FATSETUP12	;自己書き換え
  EC2F  210000        		LD	HL,0
  EC32  4A            		LD	C,D
  EC33  54            		LD	D,H
  EC34  3AABEF        		LD	A,(_FATIX)	;範囲FAT12:0-3/FAT16:0-63(0-03FH):65535*2/2048
  EC37  47            		LD	B,A
  EC38  04            		INC	B
  EC39  DD7E00        		LD	A,(IX+0)	;DPB_00_FATLN
  EC3C                	FAT_SKP:
  EC3C  05            		DEC	B
  EC3D  2805          		JR	Z,FAT1
  EC3F  19            		ADD	HL,DE
  EC40  93            		SUB	E
  EC41  30F9          		JR	NC,FAT_SKP
  EC43  C9            		RET
  EC44                	FAT1:
  EC44  EB            		EX	DE,HL
  EC45  B9            		CP	C		;C=FATバッファに読み込めるセクタ数
  EC46  3801          		JR	C,FAT2
  EC48  79            		LD	A,C
  EC49                	FAT2:
  EC49  47            		LD	B,A
                      	
  EC4A  2AFAF0        		LD	HL,(_FATPS)	;fat sector pos
  EC4D  19            		ADD	HL,DE
  EC4E  EB            		EX	DE,HL
  EC4F  2A7CF0        		LD	HL,(_FATBF)
  EC52  AF            		XOR	A		;CF=0
  EC53  C9            		RET
                      	;
                      	;	FATバッファに読み込める最大のセクタ数と_FATIXで進めるセクタ数
                      	;	FATSETUP* (FAT12/FAT16)
                      	;out
                      	;	D : FATバッファに読み込める最大のセクタ数
                      	;	E : _FATIXで進めるセクタ数
  EC54                	FATSETUP12:
  EC54  110606        		LD	DE,0606H	;256
  EC57  D8            		RET	C
  EC58  110303        		LD	DE,0303H	;512
  EC5B  0F            		RRCA
  EC5C  D8            		RET	C
  EC5D  110102        		LD	DE,0201H	;1024
  EC60  C9            		RET
                      	
  EC61                	FATSETUP16:
  EC61  110808        		LD	DE,0808H	;256
  EC64  D8            		RET	C
  EC65  110404        		LD	DE,0404H
  EC68  0F            		RRCA			;512
  EC69  D8            		RET	C
  EC6A  110202        		LD	DE,0202H	;1024
  EC6D  C9            		RET
                      	
  EC6E                	CHGDRV:
  EC6E  E5            		PUSH	HL
  EC6F  2189EF        		LD	HL,_DSK
  EC72  BE            		CP	(HL)
  EC73  280A          		JR	Z,CHGDRVE
  EC75                	CHGDRV1:
  EC75  DDE5          		PUSH	IX
  EC77  CD81EC        		CALL	CHGDRV0
  EC7A  3A89EF        		LD	A,(_DSK)
  EC7D  DDE1          		POP	IX
  EC7F                	CHGDRVE:
  EC7F  E1            		POP	HL
  EC80  C9            		RET
                      	
  EC81                	CHGDRV0:
  EC81  6F            		LD	L,A
  EC82  CDDCEF        		CALL	_GETDPB
  EC85  D8            		RET	C
  EC86  DD22A8EF      		LD	(_DPB),IX
  EC8A  7D            		LD	A,L
  EC8B  3289EF        		LD	(_DSK),A
  EC8E                	CHGDRV2:
  EC8E  F3            		DI
  EC8F  C5            		PUSH	BC
  EC90  D5            		PUSH	DE
  EC91  ED73F1EC      		LD	(SPPAT2+1),SP
                      	
  EC95  DDF9          		LD	SP,IX
                      	
  EC97  E1            		POP	HL		;DPB_00_FATLN
  EC98  E1            		POP	HL		;DPB_02_DRD
  EC99  22EFEB        		LD	(DRDPAT+1),HL
                      	
  EC9C  E1            		POP	HL
  EC9D  22FFEB        		LD	(DWTPAT+1),HL	;DPB_04_DWT
                      	
  ECA0  E1            		POP	HL		;L=DPB_06_FATID H=DPB_07_SECPCL
  ECA1  7C            		LD	A,H
  ECA2  32DDE3        		LD	(SPCPAT+1),A	;1クラスタの論理セクタ数
  ECA5  3D            		DEC	A
  ECA6  328BEA        		LD	(NCPAT+1),A
                      	
  ECA9  E1            		POP	HL		;DPB_08_MAXCL
  ECAA  7D            		LD	A,L
  ECAB  32FCE3        		LD	(CLPAT2+1),A
  ECAE  7C            		LD	A,H
  ECAF  32F8E3        		LD	(CLPAT1+1),A
  ECB2  2B            		DEC	HL
  ECB3  22F8E5        		LD	(MAXCLP+1),HL
                      	
  ECB6  E1            		POP	HL		;L=DPB_0A_FDMODE H=DPB_0B_DIRSCNT
  ECB7  7D            		LD	A,L
  ECB8  F6FE          		OR	0FEH
  ECBA  32F6ED        		LD	(FDMODE+1),A
  ECBD  07            		RLCA
  ECBE  E603          		AND	3
  ECC0  32DEED        		LD	(FSPAT+1),A
  ECC3  4C            		LD	C,H
                      	
  ECC4  E1            		POP	HL		;L=DPB_0C_MAXCYL H=DPB_0D_MAXSEC
  ECC5  7D            		LD	A,L
  ECC6  32A1EF        		LD	(_MAXCYL),A
  ECC9  7C            		LD	A,H
  ECCA  3287ED        		LD	(MAXSEC+1),A
                      	
  ECCD  E1            		POP	HL		;L=DPB_0E_FATPS H=DPB_0F_BPS
  ECCE  7C            		LD	A,H		;DPB_0F_BPS
  ECCF  E607          		AND	7
  ECD1  3296E8        		LD	(SECSZ+2),A	;1セクタのサイズの上位1バイト 0x400 - 0x200 - 0x100
                      					;1セクタ512 2D/2DD/2HC/2HQ(2HD1.44MB)等
                      					;1セクタ1024 2HD/EMM/BRAM
                      					;1セクタ256 GRAM等
                      					;1024	512	256
                      					;4	2	1
  ECD4  87            		ADD	A,A		;8	4	2
  ECD5  87            		ADD	A,A		;010H	8	4
  ECD6  87            		ADD	A,A		;020H	010H	8
  ECD7  3259E2        		LD	(SDECPAT+1),A	;1セクタ辺りのディレクトリエントリ数
  ECDA  3D            		DEC	A		;01FH	00FH	7
  ECDB  321CD9        		LD	(SDECM1+1),A	;1セクタ辺りのディレクトリエントリ数-1
                      	
  ECDE  2600          		LD	H,0
  ECE0  22FAF0        		LD	(_FATPS),HL
                      	
  ECE3  E1            		POP	HL		;L=DPB_10_DIRPS
  ECE4  22FCF0        		LD	(_DIRPS),HL
                      	
  ECE7  E1            		POP	HL		;L=DPB_12_DEVICE H=DPB_13_UNITNO
  ECE8  7C            		LD	A,H
  ECE9  3284EF        		LD	(_DRIVE),A
                      	
  ECEC  E1            		POP	HL		;DPB_14_ADDCL16
  ECED  22EDE3        		LD	(CLSPAT+1),HL
                      	
  ECF0  310000        	SPPAT2:	LD	SP,0		;元のSPを復元
  ECF3  FB            		EI
  ECF4  2AFCF0        		LD	HL,(_DIRPS)
  ECF7  0600          		LD	B,0
  ECF9  09            		ADD	HL,BC
  ECFA  2274E2        		LD	(MD_PAT+1),HL
                      	
  ECFD  2AF8E5        		LD	HL,(MAXCLP+1);
  ED00  11F60F        		LD	DE,4086
  ED03  B7            		OR	A
  ED04  ED52          		SBC	HL,DE
  ED06  300F          		JR	NC,SETFAT16
  ED08  2111EA        		LD	HL,GNCL		;FAT12
  ED0B  1134EA        		LD	DE,SNCL
  ED0E  0154EC        		LD	BC,FATSETUP12
  ED11  DDCB0FAE      		RES	5,(IX+00FH)	;DPB_0F_BPS(FAT12)
  ED15  180D          		JR	EXTRA1
  ED17                	SETFAT16:
  ED17  2168EA        		LD	HL,GNCL16	;FAT16
  ED1A  1175EA        		LD	DE,SNCL16
  ED1D  0161EC        		LD	BC,FATSETUP16
  ED20  DDCB0FEE      		SET	5,(IX+00FH)	;DPB_0F_BPS(FAT16)
  ED24                	EXTRA1:
  ED24  22F8EF        		LD	(GNCPAT+1),HL
  ED27  ED53FBEF      		LD	(SNCPAT+1),DE
  ED2B  ED432DEC      		LD	(FATSX+1),BC
  ED2F  D1            		POP	DE
  ED30  C1            		POP	BC
  ED31  AF            		XOR	A
  ED32  C9            		RET
                      	
  ED33                	GETDPBD:
  ED33  DDE3          		EX	(SP),IX
  ED35  DDE5          		PUSH	IX
  ED37  3A88EF        		LD	A,(_DRV)
  ED3A  1807          		JR	GETDPB1
                      	
  ED3C                	CHGDRVR:
  ED3C  CDD9EF        		CALL	_CHGDRV
  ED3F  D8            		RET	C
  ED40  3A89EF        		LD	A,(_DSK)
  ED43                	GETDPB1:
  ED43  C3DCEF        		JP	_GETDPB
                      	
  ED46                	GETDPB:
  ED46  FE08          		CP	8
  ED48  3F            		CCF
  ED49  D8            		RET	C
  ED4A  0F            		RRCA
  ED4B  0F            		RRCA
  ED4C  0F            		RRCA
  ED4D  DD            		DB	0DDH		;Z80未定義命令
  ED4E  6F            		LD	L,A		;LD	IXL,A
  ED4F  DD            		DB	0DDH		;Z80未定義命令
  ED50  26F1          		LD	H,DEVICE/256	;LD	IXH,DEVICE/256
  ED52  DD7E00        		LD	A,(IX+0)	;DPB_00_FATLN
  ED55  B7            		OR	A		;CF=0の為
  ED56  DDCB0F76      		BIT	6,(IX+00FH)	;DPB_0F_BPS
  ED5A  C0            		RET	NZ		;FAT16
  ED5B  DDCB126E      		BIT	5,(IX+012H)	;DPB_12_DEVICE
  ED5F  C0            		RET	NZ		;BPB
  ED60  FE01          		CP	001H		;A=0 THEN CF=1
  ED62  C9            		RET
                      	
  ED63                	FFLUSH:
  ED63  F5            		PUSH	AF
  ED64  3EFF          		LD	A,0FFH
  ED66  3239EF        		LD	(SFILE),A
  ED69  CD4FE9        		CALL	DWTX
  ED6C  3EFF          		LD	A,0FFH
  ED6E  32A5EF        		LD	(_DBDRV),A
  ED71  CD99E9        		CALL	WTFATX
  ED74  AF            		XOR	A
  ED75  32ABEF        		LD	(_FATIX),A
  ED78  2F            		CPL
  ED79  32AAEF        		LD	(_FATDRV),A
  ED7C  F1            		POP	AF
  ED7D  C9            		RET
                      	
                      	
                      	;LDDISK.ASM
                      	
                      	;	LSX-Dodgers DISK
                      	
                      	
  ED7E                	SEEK:
  ED7E  7A            		LD	A,D
  ED7F  B3            		OR	E
  ED80  3E01          		LD	A,001H
  ED82  2811          		JR	Z,DIV3
                      	
  ED84  0610          		LD	B,16
  ED86  0E00          	MAXSEC:	LD	C,000H
  ED88  AF            		XOR	A
  ED89  EB            		EX	DE,HL
  ED8A                	DIV1:
  ED8A  29            		ADD	HL,HL
  ED8B  8F            		ADC	A,A
  ED8C  B9            		CP	C
  ED8D  3802          		JR	C,DIV2
  ED8F  91            		SUB	C
  ED90  2C            		INC	L
  ED91                	DIV2:
  ED91  10F7          		DJNZ	DIV1
                      	
  ED93  3C            		INC	A	;最小のセクタは１固定
  ED94  55            		LD	D,L	;Quotient(TRACK)
  ED95                	DIV3:
  ED95  5F            		LD	E,A	;Remainder
  ED96  CB3A          		SRL	D	;CYLINDER
  ED98  9F            		SBC	A,A
  ED99  E610          		AND	010H	;SIDE
  ED9B  4F            		LD	C,A
                      	
  ED9C  3A84EF        		LD	A,(_DRIVE)
  ED9F  FE04          		CP	4
  EDA1  3F            		CCF
  EDA2  D8            		RET	C
  EDA3  B1            		OR	C
  EDA4  3222EE        		LD	(MOPAT+1),A	;Motor off data
  EDA7  01FC0F        		LD	BC,00FFCH
  EDAA  F680          		OR	080H		;Mortor on
  EDAC  ED79          		OUT	(C),A
                      	
  EDAE  CDF4ED        		CALL	SETMODE
  EDB1  D8            		RET	C
                      	
  EDB2  CD37EE        		CALL	DRIVE
  EDB5  FEFF          		CP	0FFH		;A=0FFH Unknown CYLINDER
  EDB7  CC16EE        		CALL	Z,FDCRES	;Restore
  EDBA  0EF9          		LD	C,0F9H
  EDBC  ED79          		OUT	(C),A		;Currrent CYLINDER
  EDBE  92            		SUB	D
  EDBF  C8            		RET	Z		;No seek
                      	
  EDC0  3A86EF        		LD	A,(_ISEEK)
  EDC3  4F            		LD	C,A
                      	
  EDC4  3AA1EF        		LD	A,(_MAXCYL)	;Max CYLINDER
  EDC7  3D            		DEC	A
  EDC8  BA            		CP	D		;Over CYLINDER
  EDC9  D8            		RET	C
                      	
  EDCA  B9            		CP	C		;for Built-in 2DD
  EDCB  3803          		JR	C,SETM2
  EDCD  78            		LD	A,B		;B=00FH
  EDCE  DBFE          		IN	A,(0FEH)		;2HD mode for 2DD seek
  EDD0                	SETM2:
  EDD0  78            		LD	A,B
  EDD1  DBFD          		IN	A,(0FDH)		;MFM mode
                      	
  EDD3  0EFB          		LD	C,0FBH
  EDD5  ED51          		OUT	(C),D
  EDD7  72            		LD	(HL),D
  EDD8  0E18          		LD	C,018H		;Seek
  EDDA                	FDCCMD2:
  EDDA  3A85EF        		LD	A,(_SEEKSP)
  EDDD  E6FF          	FSPAT:	AND	0FFH
  EDDF  B1            		OR	C
                      	
  EDE0                	FDCCMD:
  EDE0  CD2DEE        		CALL	COMSET
                      	
  EDE3  3E80          	FDCPAT:	LD	A,080H		;FDC COMMAND(Self-rewriting)
  EDE5  E620          		AND	020H		;Write data Write track
  EDE7  3C            		INC	A
                      	
  EDE8                	SST:
  EDE8  0E00          		LD	C,0
  EDEA                	SST1:
  EDEA  0D            		DEC	C		; 4
  EDEB  20FD          		JR	NZ,SST1		;12 * 256 / 4 = About 1ms
  EDED  3D            		DEC	A
  EDEE  20FA          		JR	NZ,SST1
                      	
  EDF0  3C            		INC	A		;A=1
  EDF1  CDFFED        		CALL	READY
  EDF4                	SETMODE:
  EDF4  78            		LD	A,B		;B=00FH
  EDF5  DBFF          	FDMODE:	IN	A,(0FFH)		;Floppy mode(2D/2HD) (Self-rewriting)
                      	
  EDF7  78            		LD	A,B
  EDF8  DBFD          		IN	A,(0FDH)		;MFM mode
                      	
  EDFA  CD31EE        		CALL	DELAY0		;Head select time
  EDFD  3E81          		LD	A,081H
  EDFF                	READY:
  EDFF  3209EE        		LD	(WAITA+1),A
  EE02  E5            		PUSH	HL
  EE03  0EF8          		LD	C,0F8H
  EE05  61            		LD	H,C
  EE06                	READY2:
  EE06  ED78          		IN	A,(C)
  EE08  E681          	WAITA:	AND	081H		;NOT READY,BUSY
  EE0A  2808          		JR	Z,READYE
  EE0C  E3            		EX	(SP),HL		;wait 19clock
  EE0D  E3            		EX	(SP),HL		; //
  EE0E  2B            		DEC	HL
  EE0F  7C            		LD	A,H
  EE10  B5            		OR	L
  EE11  20F3          		JR	NZ,READY2
  EE13  37            		SCF
  EE14                	READYE:
  EE14  E1            		POP	HL
  EE15  C9            		RET
                      	
  EE16                	FDCRES:
  EE16  3600          		LD	(HL),0
  EE18  0E08          		LD	C,8
  EE1A  18BE          		JR	FDCCMD2
                      	
  EE1C                	FDMOFF:
  EE1C  F5            		PUSH	AF
  EE1D  C5            		PUSH	BC
  EE1E  01FC0F        		LD	BC,00FFCH	;Motor off
  EE21  3E00          	MOPAT:	LD	A,000H		;(Self-rewriting)
  EE23  ED79          		OUT	(C),A
  EE25  C1            		POP	BC
  EE26  F1            		POP	AF
  EE27  C9            		RET
                      	
  EE28                	SECSET:
  EE28  01FA0F        		LD	BC,00FFAH
  EE2B  ED59          		OUT	(C),E
  EE2D                	COMSET:
  EE2D  0EF8          		LD	C,0F8H
  EE2F  ED79          		OUT	(C),A
  EE31                	DELAY0:
  EE31  3E1A          		LD	A,26
  EE33                	DELAY:
  EE33  3D            		DEC	A
  EE34  20FD          		JR	NZ,DELAY
  EE36  C9            		RET
                      	
  EE37                	DRIVE:
  EE37  2A84EF        		LD	HL,(_DRIVE)
  EE3A  26EF          		LD	H,_CYL0/256
  EE3C  CBFD          		SET	7,L
  EE3E  7E            		LD	A,(HL)
  EE3F  C9            		RET
                      	
  EE40                	RNF:
  EE40  CD37EE        		CALL	DRIVE
  EE43  36FF          		LD	(HL),0FFH
  EE45  C9            		RET
                      	
  EE46  02            	RETRY:	DB	2
                      	
                      	
                      	;	FLOPPY DISK DRIVER(DMA)
                      	
                      	
  EE47                	WTTRK:
  EE47  0601          		LD	B,1
  EE49  3EF4          		LD	A,0F4H
  EE4B  1802          		JR	WTTRK1
  EE4D                	FDWT:
  EE4D  3EA0          		LD	A,0A0H
  EE4F                	WTTRK1:
  EE4F  32E4ED        		LD	(FDCPAT+1),A
  EE52  3E10          		LD	A,16
  EE54  180C          		JR	DISK
                      	
  EE56                	DISKOK:
  EE56  0601          	FDCNT:	LD	B,1
  EE58  100B          		DJNZ	DISK1
  EE5A  C9            		RET
                      	
  EE5B                	FDRD:
  EE5B  3E80          		LD	A,080H
  EE5D  32E4ED        		LD	(FDCPAT+1),A
  EE60  3E0E          		LD	A,14
                      	
  EE62                	DISK:
  EE62  3279EE        		LD	(DMAPAT+1),A
  EE65                	DISK1:
  EE65  78            		LD	A,B
  EE66  3257EE        		LD	(FDCNT+1),A
  EE69  22FBEE        		LD	(DMAD+11),HL
  EE6C                	DISKR:
  EE6C  3E02          		LD	A,2		;Retry count
  EE6E  3246EE        		LD	(RETRY),A
  EE71                	DISK2:
  EE71  D5            		PUSH	DE
  EE72  CD7EED        		CALL	SEEK
  EE75  3843          		JR	C,ERRF
  EE77  F3            		DI
                      	
  EE78  3E0E          	DMAPAT:	LD	A,14		;自己書き換え
  EE7A  21F0EE        		LD	HL,DMAD
  EE7D  CDECDF        		CALL	SETDMA
  EE80  ED49          		OUT	(C),C		;OUT 01F87H,087H WR6 イネーブル
  EE82  3AE4ED        		LD	A,(FDCPAT+1)
  EE85  C5            		PUSH	BC
  EE86  CD28EE        		CALL	SECSET
  EE89  2AFBEE        		LD	HL,(DMAHL)
  EE8C  23            		INC	HL
  EE8D  1106BB        		LD	DE,0BB06H	;READ DMA
                      	
  EE90  3E03          		LD	A,3
  EE92  CDFFED        		CALL	READY
  EE95  ED78          		IN	A,(C)
                      	
  EE97  C1            		POP	BC
  EE98  ED51          		OUT	(C),D		;読み出しマスク設定
  EE9A  ED59          		OUT	(C),E		;バイトカウンタ(LH)
  EE9C  ED58          		IN	E,(C)
  EE9E  ED50          		IN	D,(C)
  EEA0  19            		ADD	HL,DE
  EEA1  D1            		POP	DE
  EEA2  13            		INC	DE
  EEA3  FB            		EI
  EEA4  CD1CEE        		CALL	FDMOFF
  EEA7  B7            		OR	A
  EEA8  28AC          		JR	Z,DISKOK
  EEAA  1B            		DEC	DE
  EEAB  CB67          		BIT	4,A
  EEAD  C440EE        		CALL	NZ,RNF
  EEB0                	DISKE2:
  EEB0  2146EE        		LD	HL,RETRY
  EEB3  35            		DEC	(HL)
  EEB4  20BB          		JR	NZ,DISK2
  EEB6  B7            		OR	A
  EEB7  2834          		JR	Z,ERR
  EEB9  D5            		PUSH	DE
  EEBA                	ERRF:
  EEBA  D1            		POP	DE
  EEBB                	DELP:
  EEBB  CD40EE        		CALL	RNF
  EEBE  CD1CEE        		CALL	FDMOFF
  EEC1  3A85EF        		LD	A,(_SEEKSP)
  EEC4  87            		ADD	A,A
  EEC5  9F            		SBC	A,A
  EEC6  3825          		JR	C,ERR
  EEC8                	DELP1:
  EEC8  D5            		PUSH	DE
  EEC9  21C0F0        		LD	HL,DEMES
  EECC  CD69D8        		CALL	MSX
  EECF  CDE4DB        		CALL	KEYBC
  EED2                	DELP2:
  EED2  CDCAEF        		CALL	_INKEY
  EED5  28FB          		JR	Z,DELP2
                      	
  EED7  D1            		POP	DE
  EED8  CDFEE3        		CALL	CAP
  EEDB  FE52          		CP	'R'		;Retry
  EEDD  CA6CEE        		JP	Z,DISKR
  EEE0  FE49          		CP	'I'		;Ignore
  EEE2  2807          		JR	Z,IGNORE
  EEE4  FE41          		CP	'A'		;Abort
  EEE6  20E0          		JR	NZ,DELP1
  EEE8  C300EF        		JP	BOOT
  EEEB                	IGNORE:
  EEEB  3EFF          		LD	A,0FFH
  EEED                	ERR:
  EEED  BF            		CP	A
  EEEE  37            		SCF
  EEEF  C9            		RET
                      	
                      				;X1turbo DISK DMA
  EEF0  C3            	DMAD:	DB	0C3H	;WR6 リセット
  EEF1  7D            		DB	07DH	;WR0 ポートA→ポートB 転送
  EEF2  FB0F          		DW	00FFBH	;ポートA開始アドレス FDC データレジスタ
  EEF4  FFFF          		DW	0FFFFH	;ブロック長(転送サイズ-1)
  EEF6  2C            		DB	02CH	;WR1 ポートAアドレス固定 I/O
  EEF7  10            		DB	010H	;WR2 ポートBインクリメント
  EEF8  80            		DB	080H	;WR3
  EEF9  92            		DB	092H	;WR5 WAIT RDY:LOW
  EEFA  8D            		DB	08DH	;WR4 バイト ポートB開始アドレス(LH)
  EEFB  0000          	DMAHL:	DW	0	;ポートB開始アドレス
  EEFD  CF            		DB	0CFH	;WR6 ロード
  EEFE  01            		DB	001H	;WR0 ポートB←ポートB 転送
  EEFF  CF            		DB	0CFH	;WR6 ロード
                      	
  EF00                	DMAE:
                      	
  1E6F                	AT_R	EQU	WTTRK-AT_WTTRK
                      	
                      	;LDWORK.ASM
                      	
                      	;	LSX-Dodgers WORK
                      	;
                      	;	CP/M互換BIOS
                      	;	BOOT:アドレス下位1バイトが0になるように
  EF00                	BOOT:
  EF00  C30000        		JP	0
  EF03                	_SYS00:		;(BDOS)プログラム終了
  EF03                	WBOOT:
  EF03  C30BD1        		JP	WBOOT1
  EF06                	CONST_:
  EF06  C39EDC        		JP	CONSTX
  EF09                	_SYS07:		;(BDOS)コンソール直接入力
  EF09                	CONIN:
  EF09  C345DC        		JP	FLGET
  EF0C                	CONOUT:
  EF0C  C3DDDE        		JP	CONOUT1
                      	
  EF0F                	DECBF:
  EF0F                		DS	5
  EF14  00            	FDRV	DB	0
  EF15                	FNAME	DS	36
  EF39                	SFILE:	DS	33		;DRV FILENAME
  EF5A                	HLBUF:	DS	3		;Random record buffer
                      	
  EF5D  0000          	LEFTX:	DW	0
  EF5F  0000          	DTAX:	DW	0
                      	
  EF61  008E01000B000C	BEEPD:	DB	0,08EH,1,0,00BH,0,00CH,010H
  EF69  073E08100D00FF		DB	007H,03EH,008H,010H,00DH,0,0FFH
                      	
  EF70  00            	CHECK:	DB	0
                      	
  EF71  4F4B24        	OK:	DB	"OK$"
  EF74  536B697024    	SKIP:	DB	"Skip$"
  EF79  4572726F722124	COMERM:	DB	"Error!$"
                      	
                      	;	_CYL0:アドレス下位1バイトが080Hになるように
  EF80  FF            	_CYL0:	DB	0FFH	;Cylinder
  EF81  FF            	_CYL1:	DB	0FFH	;Cylinder
  EF82  FF            	_CYL2:	DB	0FFH	;Cylinder
  EF83  FF            	_CYL3:	DB	0FFH	;Cylinder
  EF84  00            	_DRIVE:	DB	0	;unit number
  EF85  00            	_SEEKSP:DB	0	;Seek speed
  EF86  FF            	_ISEEK:	DB	0FFH	;
  EF87  00            	_DVSW:	DB	0
  EF88  00            	_DRV:	DB	0
  EF89  FF            	_DSK:	DB	0FFH
  EF8A  8000          	_DTA:	DW	00080H
  EF8C  0000          	_CTC:	DW	0
  EF8E  0000          	_TXADR:	DW	0
  EF90  0000          	_KEYPS:	DW	0
  EF92  00FF          	_KEYD:	DW	0FF00H	;キーデータ
  EF94  C210          	_KEYSP:	DW	010C2H
  EF96  07            	_COLORF:DB	7	;色
  EF97  18            	_LINE:	DB	LINE
                      	
  EF98  0000          	_FCB:	DW	0
  EF9A  0000          	_FBPS:	DW	0	;SEARCH FILES
  EF9C  0000          	_FBAD:	DW	0	;    //
  EF9E  00            	_FBCNT:	DB	0	;    //
  EF9F  00            	_FILEN:	DB	0
  EFA0  00            	_DIRF:	DB	0	;bit7:ディレクトリ bit0-6:セクタインデックス
  EFA1  00            	_MAXCYL:DB	0
  EFA2  00            	_WTFATF:DB	0	;FATバッファの更新フラグ
  EFA3                			DS	1
  EFA4  00            	_WTDBF:	DB	0	;データバッファの更新フラグ
  EFA5  FF            	_DBDRV:	DB	0FFH	;データバッファにあるデータを読み込んだドライブ
  EFA6  0000          	_DBSEC:	DW	0	;データバッファにあるデータを読み込んだセクタ番号
  EFA8  0000          	_DPB:	DW	0
  EFAA                	_FATDRV:
  EFAA  FF            		DB	0FFH	;FATバッファに読み込んでいるドライブ
  EFAB  00            	_FATIX:	DB	0	;FATバッファに読み込んでいるインデックス
  EFAC                	_FAKEFREE:
  EFAC  0000          		DW	0	;偽の残量（FATサイズが大きくなると重くなるのでその対策）
                      	
  EFAE                		DS	2
                      	
  EFB0  6F5059381F0219	CRTCD:	DB	06FH,050H,059H,038H,01FH,002H,019H,01CH
  EFB8  0007          		DB	000H,007H
  EFBA  80F8B0FF      		DW	0-80*LINE,0-80
  EFBE  0C            		DB	00CH
  EFBF  A0            	WK1FD0:	DB	0A0H
                      	
  EFC0  4EDB          	CTC0:	DW	INTCTCE
  EFC2  4EDB          	CTC1:	DW	INTCTCE
  EFC4  70DB          	CTC2:	DW	INTCTC2
  EFC6  4EDB          	CTC3:	DW	INTCTCE
  EFC8  37DB          	INTVEC:	DW	INT
                      	
                      	;	JUMP
                      	
  EFCA  C3D2E0        	_INKEY:	JP	INKEY
  EFCD  C36CDD        	_PRINT:	JP	PRINT
  EFD0  C33CE0        	_SCRN:	JP	SCRN
  EFD3  C364E0        	_POS:	JP	POS
  EFD6  C3A6DE        	_LOC:	JP	LOC
  EFD9                	_CHGDRV:
  EFD9  C36EEC        		JP	CHGDRV
  EFDC                	_GETDPB:
  EFDC  C346ED        		JP	GETDPB
  EFDF                	_FFLUSH:
  EFDF  C363ED        		JP	FFLUSH
  EFE2                	_RDFATX:
  EFE2  C36FE9        		JP	RDFATX
  EFE5  C397EA        	_RDFAT:	JP	RDFAT
  EFE8  C347EE        	_WTTRK:	JP	WTTRK
  EFEB  C35BEE        	_FDRD:	JP	FDRD
  EFEE  C34DEE        	_FDWT:	JP	FDWT
  EFF1                	_BPB2DPB:
  EFF1  C3FCEA        		JP	BPB2DPB
  EFF4                		DS	3
  EFF7                	_GNCL:
  EFF7  C311EA        	GNCPAT:	JP	GNCL		; self-modifying code
  EFFA                	_SNCL:
  EFFA  C334EA        	SNCPAT:	JP	SNCL		; self-modifying code
  EFFD  C393D1        	_COMANL:JP	COMANL
                      	
  F000                	_WE:
                      	
                      	;LDCALL.ASM
                      	
                      	;	LSX-Dodgers システムコール(BDOS)
                      	;
                      	;	LSX-Dodgers SYSTEM CALL
                      	;	STABLE:アドレス下位1バイトが0になるように
                      	
  F000                	STABLE:
                      	;0
  F000  03EF18DC24DC86		DW	_SYS00,_SYS01,_SYS02,_SYS03
  F008  58D858D829DC09		DW	_SYS04,_SYS05,_SYS06,_SYS07
  F010  31DC5AD86ADC96		DW	_SYS08,_SYS09,_SYS0A,_SYS0B
  F018  6FD874D883D896		DW	_SYS0C,_SYS0D,_SYS0E,_SYS0F
                      	;1
  F020  EAD82FD978D9AE		DW	_SYS10,_SYS11,_SYS12,_SYS13
  F028  B6D9D4D9F1D9E9		DW	_SYS14,_SYS15,_SYS16,_SYS17
  F030  52DA57DA5CDA62		DW	_SYS18,_SYS19,_SYS1A,_SYS1B
  F038  58D888DA58D88C		DW	_SYS1C,_SYS1D,_SYS1E,_SYS1F
                      	;2
  F040  58D828DA3DDA93		DW	_SYS20,_SYS21,_SYS22,_SYS23
  F048  B2DA58D8C4E6A5		DW	_SYS24,_ERROR,_SYS26,_SYS27
  F050  3DDABBDAACDC86		DW	_SYS28,_SYS29,_SYS2A,_SYS2B
  F058  E0DC86E258D8DE		DW	_SYS2C,_SYS2D,_SYS2E,_SYS2F
                      	;3
  F060  D8DA58D858D858		DW	_SYS30,_ERROR,_ERROR,_ERROR
  F068  58D858D858D858		DW	_ERROR,_ERROR,_ERROR,_ERROR
  F070  58D886E286E2FF		DW	_ERROR,SCF_FF_RET,SCF_FF_RET,_SYS3B
                      	
  F078                		DS	4
  F07C  00F2          	_FATBF:	DW	FATBF
  F07E  00FA          	_DTBUF:	DW	DTBUF
                      	
                      	;	CTRLTB:アドレス下位1バイトが080Hになるように
                      	
  F080                	CTRLTB:
  F080  1DDE1DDE59DE9E		DW	CTRL00,CTRL00,CTRL02,CTRL03
  F088  98DF7DDE77DFFE		DW	CTRL04,CTRL05,CTRL06,CTRL07
  F090  29DE4ADEA1DFBC		DW	CTRL08,CTRL09,CTRL0A,CTRL0B
  F098  74DFA1DEB6DF1D		DW	CTRL0C,CTRL0D,CTRL0E,CTRL00
  F0A0  1DDE1DDEB4DE1D		DW	CTRL00,CTRL00,CTRL12,CTRL00
  F0A8  1DDE1DDE1DDE1D		DW	CTRL00,CTRL00,CTRL00,CTRL00
  F0B0  1DDE1DDE74DFC3		DW	CTRL00,CTRL00,CTRL0C,CTRL1B
  F0B8  44DE30DE39DEA1		DW	CTRL1C,CTRL1D,CTRL1E,CTRL1F
                      	
  F0C0  0307          	DEMES:	DB	3,7
  F0C2  44657669636520		DB	"Device I/O Error",5,3
  F0D4  41626F72742052		DB	"Abort Retry Ignore?",5,3,0
                      	
  F0EA  1617          	SDDATA:	DB	22,23		;(FCB)ファイルを最後に変更した時刻
  F0EC  1415          		DB	20,21		;(FCB)ファイルを最後に変更した日付
  F0EE  1A1B          		DB	26,27		;(FCB)ファイルの先頭クラスタ
  F0F0  10111213      		DB	16,17,18,19	;(FCB)ファイルのサイズ(バイト単位)
  F0F4                	SDDATAE:
                      	
  F0F4                	SCDIR:	DS	2		;+14 +15
  F0F6                	SFBPS:	DS	2		;FBPS
  F0F8                	SFNDF:	DS	2		;FILEN DIRF
                      	
  F0FA  0000          	_FATPS:	DW	0
  F0FC  0000          	_DIRPS:	DW	0
  F0FE  0000          	_CLPS:	DW	0
                      	
  F100                	_PE:
                      	
                      	;LDDPB.ASM
                      	
                      	;	LSX-Dodgers DPB
                      	
  F100                	DEVICE:
                      	
                      	;	A:
                      	
  F100  0200          		DW	2	;DPB_00_FATLN
  F102  EBEF          		DW	_FDRD	;DPB_02_DRD
  F104  EEEF          		DW	_FDWT	;DPB_04_DWT
  F106  FD            		DB	0FDH	;DPB_06_FATID
  F107  02            		DB	2	;DPB_07_SECPCL
  F108  6401          		DW	356	;DPB_08_MAXCL
  F10A  FF            		DB	0FFH	;DPB_0A_FDMODE	0FFH=2D / 0FEH=2HD
  F10B  07            		DB	7	;DPB_0B_DIRSCNT
  F10C  28            		DB	40	;DPB_0C_MAXCYL
  F10D  09            		DB	9	;DPB_0D_MAXSEC	Number of sectors
  F10E  01            		DB	1	;DPB_0E_FATPS
  F10F  82            		DB	082H	;DPB_0F_BPS
  F110  0500          		DW	5	;DPB_10_DIRPS
  F112  A7            		DB	0A7H	;DPB_12_DEVICE	Device Number
  F113  00            		DB	0	;DPB_13_UNITNO
  F114  0800          		DW	8	;DPB_14_ADDCL16
  F116  0000          		DW	0	;DPB_16
  F118  0000          		DW	0	;DPB_18
  F11A  0000          		DW	0	;DPB_1A_SDIR
  F11C  46444430      		DB	"FDD0"	;DPB_1C_NAME
                      	
                      	;	B:
                      	
  F120  0200          		DW	2	;DPB_00_FATLN
  F122  EBEF          		DW	_FDRD	;DPB_02_DRD
  F124  EEEF          		DW	_FDWT	;DPB_04_DWT
  F126  FD            		DB	0FDH	;DPB_06_FATID
  F127  02            		DB	2	;DPB_07_SECPCL
  F128  6401          		DW	356	;DPB_08_MAXCL
  F12A  FF            		DB	0FFH	;DPB_0A_FDMODE	0FFH=2D / 0FEH=2HD
  F12B  07            		DB	7	;DPB_0B_DIRSCNT
  F12C  28            		DB	40	;DPB_0C_MAXCYL
  F12D  09            		DB	9	;DPB_0D_MAXSEC	Number of sectors
  F12E  01            		DB	1	;DPB_0E_FATPS
  F12F  82            		DB	082H	;DPB_0F_BPS
  F130  0500          		DW	5	;DPB_10_DIRPS
  F132  A7            		DB	0A7H	;DPB_12_DEVICE	Device Number
  F133  01            		DB	1	;DPB_13_UNITNO
  F134  0800          		DW	8	;DPB_14_ADDCL16
  F136  0000          		DW	0	;DPB_16
  F138  0000          		DW	0	;DPB_18
  F13A  0000          		DW	0	;DPB_1A_SDIR
  F13C  46444431      		DB	"FDD1"	;DPB_1C_NAME
                      	
                      	;	C:
                      	
  F140  0200          		DW	2	;DPB_00_FATLN
  F142  EBEF          		DW	_FDRD	;DPB_02_DRD
  F144  EEEF          		DW	_FDWT	;DPB_04_DWT
  F146  FD            		DB	0FDH	;DPB_06_FATID
  F147  02            		DB	2	;DPB_07_SECPCL
  F148  6401          		DW	356	;DPB_08_MAXCL
  F14A  FF            		DB	0FFH	;DPB_0A_FDMODE	0FFH=2D / 0FEH=2HD
  F14B  07            		DB	7	;DPB_0B_DIRSCNT
  F14C  28            		DB	40	;DPB_0C_MAXCYL
  F14D  09            		DB	9	;DPB_0D_MAXSEC	Number of sectors
  F14E  01            		DB	1	;DPB_0E_FATPS
  F14F  82            		DB	082H	;DPB_0F_BPS
  F150  0500          		DW	5	;DPB_10_DIRPS
  F152  A7            		DB	0A7H	;DPB_12_DEVICE	Device Number
  F153  02            		DB	2	;DPB_13_UNITNO
  F154  0800          		DW	8	;DPB_14_ADDCL16
  F156  0000          		DW	0	;DPB_16
  F158  0000          		DW	0	;DPB_18
  F15A  0000          		DW	0	;DPB_1A_SDIR
  F15C  46444432      		DB	"FDD2"	;DPB_1C_NAME
                      	
                      	;	D:
                      	
  F160  0200          		DW	2	;DPB_00_FATLN
  F162  EBEF          		DW	_FDRD	;DPB_02_DRD
  F164  EEEF          		DW	_FDWT	;DPB_04_DWT
  F166  FD            		DB	0FDH	;DPB_06_FATID
  F167  02            		DB	2	;DPB_07_SECPCL
  F168  6401          		DW	356	;DPB_08_MAXCL
  F16A  FF            		DB	0FFH	;DPB_0A_FDMODE	0FFH=2D / 0FEH=2HD
  F16B  07            		DB	7	;DPB_0B_DIRSCNT
  F16C  28            		DB	40	;DPB_0C_MAXCYL
  F16D  09            		DB	9	;DPB_0D_MAXSEC	Number of sectors
  F16E  01            		DB	1	;DPB_0E_FATPS
  F16F  82            		DB	082H	;DPB_0F_BPS
  F170  0500          		DW	5	;DPB_10_DIRPS
  F172  A7            		DB	0A7H	;DPB_12_DEVICE
  F173  03            		DB	3	;DPB_13_UNITNO
  F174  0800          		DW	8	;DPB_14_ADDCL16
  F176  0000          		DW	0	;DPB_16
  F178  0000          		DW	0	;DPB_18
  F17A  0000          		DW	0	;DPB_1A_SDIR
  F17C  46444433      		DB	"FDD3"	;DPB_1C_NAME
                      	
                      	;	E:
                      	
  F180  0000          	EMMFL:	DW	0	;DPB_00_FATLN
  F182  DDD7          	EMMRD:	DW	EDRD	;DPB_02_DRD
  F184  D9D7          	EMMWR:	DW	EDWT	;DPB_04_DWT
  F186  FE            		DB	0FEH	;DPB_06_FATID
  F187  02            		DB	2	;DPB_07_SECPCL
  F188  0000          	EMMCL:	DW	0	;DPB_08_MAXCL
  F18A  00            		DB	0	;DPB_0A_FDMODE
  F18B  0C            		DB	12	;DPB_0B_DIRSCNT
  F18C  00            	EMMBL:	DB	0	;DPB_0C_MAXCYL
  F18D  01            		DB	1	;DPB_0D_MAXSEC
  F18E  02            		DB	2	;DPB_0E_FATPS
  F18F  02            		DB	2	;DPB_0F_BPS
  F190  0A00          		DW	10	;DPB_10_DIRPS
  F192  06            		DB	6	;DPB_12_DEVICE
  F193  00            	EMMDV:	DB	0	;DPB_13_UNITNO
  F194  1200          		DW	18	;DPB_14_ADDCL16
  F196  0000          		DW	0	;DPB_16
  F198  0000          		DW	0	;DPB_18
  F19A  0000          		DW	0	;DPB_1A_SDIR
  F19C  454D4D30      		DB	"EMM0"	;DPB_1C_NAME
                      	
                      	;	F:
                      	
  F1A0  0000          	BANKFL:	DW	0	;DPB_00_FATLN
  F1A2  74D7          		DW	BDRD	;DPB_02_DRD
  F1A4  70D7          		DW	BDWT	;DPB_04_DWT
  F1A6  F9            		DB	0F9H	;DPB_06_FATID
  F1A7  02            		DB	2	;DPB_07_SECPCL
  F1A8  0000          	BANKCL:	DW	0	;DPB_08_MAXCL
  F1AA  00            		DB	0	;DPB_0A_FDMODE
  F1AB  08            		DB	8	;DPB_0B_DIRSCNT
  F1AC  00            		DB	0	;DPB_0C_MAXCYL
  F1AD  01            		DB	1	;DPB_0D_MAXSEC
  F1AE  00            		DB	0	;DPB_0E_FATPS
  F1AF  02            		DB	2	;DPB_0F_BPS
  F1B0  0200          		DW	2	;DPB_10_DIRPS
  F1B2  0B            		DB	00BH	;DPB_12_DEVICE
  F1B3  00            		DB	0	;DPB_13_UNITNO
  F1B4  0600          		DW	6	;DPB_14_ADDCL16
  F1B6  0000          		DW	0	;DPB_16
  F1B8  0000          		DW	0	;DPB_18
  F1BA  0000          		DW	0	;DPB_1A_SDIR
  F1BC  4252414D      		DB	"BRAM"	;DPB_1C_NAME
                      	
                      	;	G:
                      	
  F1C0  0100          		DW	1	;DPB_00_FATLN
  F1C2  31D7          		DW	GDRD	;DPB_02_DRD
  F1C4  48D7          		DW	GDWT	;DPB_04_DWT
  F1C6  F9            		DB	0F9H	;DPB_06_FATID
  F1C7  04            		DB	4	;DPB_07_SECPCL
  F1C8  3000          		DW	48	;DPB_08_MAXCL
  F1CA  00            		DB	0	;DPB_0A_FDMODE
  F1CB  04            		DB	4	;DPB_0B_DIRSCNT
  F1CC  00            		DB	0	;DPB_0C_MAXCYL
  F1CD  01            		DB	1	;DPB_0D_MAXSEC
  F1CE  00            		DB	0	;DPB_0E_FATPS
  F1CF  01            		DB	1	;DPB_0F_BPS
  F1D0  0400          		DW	4	;DPB_10_DIRPS
  F1D2  05            		DB	5	;DPB_12_DEVICE
  F1D3  01            		DB	1	;DPB_13_UNITNO
  F1D4  0000          		DW	0	;DPB_14_ADDCL16
  F1D6  0000          		DW	0	;DPB_16
  F1D8  0000          		DW	0	;DPB_18
  F1DA  0000          		DW	0	;DPB_1A_SDIR
  F1DC  4752414D      		DB	"GRAM"	;DPB_1C_NAME
                      	
                      	;	H:
  F1E0                		DS	31
  F1FF  00            		DB	0
                      	
                      	
  F200                	LDEND:
                      	
  F200                		END
