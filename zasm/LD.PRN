			  Z80 ASSEMBLER - ZASM VER 1.6
                      	;	LSX-Dodgers for X1/turbo/Z
                      	;	Programmed by
                      	;	Gaku (Lovers/Tablacus)
                      	
  C600                	RUN	EQU	0C600h
                      	
  C5F9                		ORG	RUN-7
                      	
                      	;	MSX BINARY HEADER
  C5F9  FE            		DB	0FEH
                      	;	MSX BINARY START ADDRESS
  C5FA  00C6          		DW	RUN
                      	;	MSX BINARY END ADDRESS
  C5FC  E0ED          		DW	LDEND
                      	;	MSX BINARY EXEC ADDRESS
  C5FE  00C6          		DW	RUN
                      	;LDDEF.ASM
                      	
                      	;	LSX-Dodgers DEF
                      	
  1D80                	MAC	EQU	01D80H		;X1
  0001                	VER_1   EQU	1
  0003                	VER_2   EQU	3
  0002                	VER_3   EQU	2
  0132                	VER	EQU	VER_1 * 256 + VER_2 * 16 + VER_3
                      	
  0000                	STACK	EQU	00000H
  0005                	SYSTEM	EQU	00005H
  000F                	JP_HL	EQU	0000FH
  005C                	FCB1	EQU	0005CH
  006C                	FCB2	EQU	0006CH
  0080                	DTA1	EQU	00080H
  00DB                	FDRV	EQU	00100H-37
  00DC                	FNAME	EQU	FDRV+1
  00D6                	DECBF	EQU	FDRV-5
  EE00                	FATBF	EQU	0EE00H
  FA00                	DTBUF	EQU	0FA00H
  FE00                	KEYBF	EQU	0FE00H
  FF00                	KBUF	EQU	0FF00H
  FF51                	DTA	EQU	KBUF+81
  FFD4                	EXTSP	EQU	0FFD4H
  0019                	LINE	EQU	25
                      	
                      	;LDINIT.ASM
                      	
                      	;	LSX-Dodgers INIT
                      	
  C600  C307C6        		JP	START
  C603  801D          	MACHINE:DW	MAC
  C605  3201          	VERSION:DW	VER
                      	
  C607                	START:
  C607  F3            		DI
  C608  ED5E          		IM	2
  C60A  310000        		LD	SP,STACK
  C60D  CD1BC6        		CALL	INIT		;NZならAUTOEXECを実行
  C610  210000        		LD	HL,0
  C613  E5            		PUSH	HL
  C614  C8            		RET	Z
  C615  11B3C9        		LD	DE,AUTOD
  C618  C3FDEC        		JP	_COMANL
                      	
  C61B                	INIT:
  C61B  3E1E          		LD	A,01EH
  C61D  D300          		OUT	(0),A
                      	
  C61F  010000        		LD	BC,0
  C622  ED438CEC      		LD	(_CTC),BC
  C626  01040A        		LD	BC,00A04H
  C629  CD6DC9        		CALL	CHKCTC
  C62C  010407        		LD	BC,00704H
  C62F  CD6DC9        		CALL	CHKCTC
  C632  01A81F        		LD	BC,01FA8H
  C635  CD6DC9        		CALL	CHKCTC
  C638  01A01F        		LD	BC,01FA0H
  C63B  CD6DC9        		CALL	CHKCTC
                      	;
  C63E                	INISIO:
  C63E  01911F        		LD	BC,01F91H	;INIT SIO
  C641  1601          		LD	D,1
  C643  ED51          		OUT	(C),D
                      	;	OUT	(C),0		;未定義命令ニーモニック
  C645  ED71          		DB	0EDH,071H
  C647  0E93          		LD	C,093H
  C649  ED51          		OUT	(C),D
                      	;	OUT	(C),0		;未定義命令ニーモニック
  C64B  ED71          		DB	0EDH,071H
  C64D  0E99          		LD	C,099H		;INIT SIO
  C64F  1601          		LD	D,1
  C651  ED51          		OUT	(C),D
                      	;	OUT	(C),0		;未定義命令ニーモニック
  C653  ED71          		DB	0EDH,071H
  C655  0E9B          		LD	C,09BH
  C657  ED51          		OUT	(C),D
                      	;	OUT	(C),0		;未定義命令ニーモニック
  C659  ED71          		DB	0EDH,071H
                      	
  C65B  0E80          		LD	C,080H		;INIT DMA
  C65D  2106C3        		LD	HL,0C306H
  C660                	INIDMA:
  C660  ED61          		OUT	(C),H
  C662  2D            		DEC	L
  C663  20FB          		JR	NZ,INIDMA
                      	
  C665  3EE4          		LD	A,0E4H
  C667  CD04DB        		CALL	COMOUT
  C66A  AF            		XOR	A
  C66B  CDDEDA        		CALL	OT49SB
                      	
  C66E  3EEC          		LD	A,INTVEC/256
  C670  ED47          		LD	I,A
                      	
  C672  ED4B8CEC      		LD	BC,(_CTC)
  C676  0B            		DEC	BC
  C677  0B            		DEC	BC
                      	
                      	;	OUT	(C),0		;未定義命令ニーモニック
  C678  ED71          		DB	0EDH,071H
  C67A  3EC0          		LD	A,CTC0
  C67C  ED79          		OUT	(C),A
                      	
  C67E  0C            		INC	C
  C67F  3E47          		LD	A,047H
  C681  ED79          		OUT	(C),A
  C683  3E0D          		LD	A,13		;Baudrate 9600-13
  C685  ED79          		OUT	(C),A
                      	
  C687  79            		LD	A,C
  C688  D610          		SUB	010H
  C68A  4F            		LD	C,A
  C68B  ED4316CC      		LD	(SIOAD+1),BC
  C68F  ED433FCC      		LD	(SIOAD0+1),BC
  C693  ED4345CC      		LD	(SIOAD1+1),BC
                      	
  C697  2115CA        		LD	HL,SIODATA
  C69A                	SINIT1:
  C69A  7E            		LD	A,(HL)
  C69B  23            		INC	HL
  C69C  FEFF          		CP	0FFH
  C69E  2804          		JR	Z,SINIT2
  C6A0  ED79          		OUT	(C),A
  C6A2  18F6          		JR	SINIT1
  C6A4                	SINIT2:
  C6A4  3EE4          		LD	A,0E4H
  C6A6  CD04DB        		CALL	COMOUT
  C6A9  3EC8          		LD	A,INTVEC
  C6AB  CDDEDA        		CALL	OT49SB
                      	;
  C6AE  01C41F        		LD	BC,01FC4H
  C6B1  3E0C          		LD	A,00CH
  C6B3  ED79          		OUT	(C),A
                      	
  C6B5  0EC0          		LD	C,0C0H
                      	;	OUT	(C),0		;未定義命令ニーモニック
  C6B7  ED71          		DB	0EDH,071H
                      	
  C6B9  0C            		INC	C
  C6BA  3E28          		LD	A,40
  C6BC  ED79          		OUT	(C),A
                      	
  C6BE  0C            		INC	C
                      	;	OUT	(C),0		;未定義命令ニーモニック
  C6BF  ED71          		DB	0EDH,071H
                      	
  C6C1  0C            		INC	C
                      	;	OUT	(C),0		;未定義命令ニーモニック
  C6C2  ED71          		DB	0EDH,071H
                      	
  C6C4  0EC5          		LD	C,0C5H
                      	;	OUT	(C),0		;未定義命令ニーモニック
  C6C6  ED71          		DB	0EDH,071H
                      	
  C6C8                	TEXT:
  C6C8  0EB0          		LD	C,0B0H
  C6CA  3E80          		LD	A,080H
  C6CC  ED79          		OUT	(C),A
  C6CE  1607          		LD	D,7
  C6D0  0EB9          		LD	C,0B9H
  C6D2  210ECA        		LD	HL,TEXTDT
  C6D5                	TEXT1:
  C6D5  04            		INC	B
  C6D6  EDA3          		OUTI
  C6D8  0C            		INC	C
  C6D9  15            		DEC	D
  C6DA  20F9          		JR	NZ,TEXT1
  C6DC  01B01F        		LD	BC,01FB0H
                      	;	OUT	(C),0		;未定義命令ニーモニック
  C6DF  ED71          		DB	0EDH,071H
                      	
  C6E1  0EC4          		LD	C,0C4H
                      	;	OUT	(C),0		;未定義命令ニーモニック
  C6E3  ED71          		DB	0EDH,071H
                      	
  C6E5  01011A        		LD	BC,01A01H
  C6E8  ED78          		IN	A,(C)
  C6EA  E608          		AND	8
  C6EC  2809          		JR	Z,PRN
  C6EE  0E03          		LD	C,003H
  C6F0  3E0F          		LD	A,00FH
  C6F2  ED79          		OUT	(C),A
  C6F4  01040A        		LD	BC,00A04H
  C6F7                	PRN:
  C6F7  110100        		LD	DE,1
  C6FA  62            		LD	H,D
  C6FB  6A            		LD	L,D
  C6FC  017F00        		LD	BC,07FH
  C6FF  36FF          		LD	(HL),0FFH
  C701  EDB0          		LDIR
  C703  017F00        		LD	BC,07FH
  C706  3600          		LD	(HL),0
  C708  EDB0          		LDIR
                      	
  C70A  3EC3          		LD	A,0C3H		;JP
  C70C  21A2D3        		LD	HL,WBOOT
  C70F  320000        		LD	(00000H),A
  C712  220100        		LD	(00001H),HL	;IPL
                      	
  C715  2A03C6        		LD	HL,(MACHINE)	;3 bit7  DPB Original(1)
  C718  220300        		LD	(00003H),HL	;  bit6-0 Machine X1(0)
                      	;				;4 LSX-Dodgers(01DH)
  C71B  2106CC        		LD	HL,BDOS
  C71E  320500        		LD	(00005H),A
  C721  220600        		LD	(00006H),HL	;BDOS
                      	
  C724  2199D6        		LD	HL,BIOS
  C727  321800        		LD	(00018H),A	;BIOS-ROM
  C72A  221900        		LD	(00019H),HL
                      	
  C72D  210000        		LD	HL,0
  C730  323800        		LD	(00038H),A	;RST038H
  C733  223900        		LD	(00039H),HL
                      	
  C736  3EEC          		LD	A,STABLE/256
  C738  320B00        		LD	(0000BH),A
                      	
  C73B  3EE9          		LD	A,0E9H		;JP (HL)
  C73D  320F00        		LD	(0000FH),A
                      	
  C740  3A7DEC        		LD	A,(_FATBF+1)
  C743  321300        		LD	(00013H),A
                      	
  C746  3A7FEC        		LD	A,(_DTBUF+1)
  C749  321700        		LD	(00017H),A
                      	
  C74C  3EFE          		LD	A,KEYBF/256
  C74E  321B00        		LD	(0001BH),A
                      	
  C751  3EFF          		LD	A,KBUF/256
  C753  321F00        		LD	(0001FH),A
                      	
  C756  2A05C6        		LD	HL,(VERSION)
  C759  225A00        		LD	(0005AH),HL
                      	
  C75C  3EE6          		LD	A,0E6H
  C75E  CD04DB        		CALL	COMOUT
  C761  CDE9DA        		CALL	IN49SB
  C764  F5            		PUSH	AF
  C765  CDE9DA        		CALL	IN49SB
  C768  F1            		POP	AF
  C769  F5            		PUSH	AF
  C76A  E612          		AND	012H
  C76C  2005          		JR	NZ,KEYR
  C76E  3E01          		LD	A,1
  C770  32D4C8        		LD	(KEYREP+1),A
  C773                	KEYR:
  C773  F1            		POP	AF
  C774  E603          		AND	3
  C776  280E          		JR	Z,NON
                      	
  C778  01D03F        		LD	BC,03FD0H
  C77B  ED49          		OUT	(C),C
  C77D  3E37          		LD	A,037H
  C77F  D3D0          		OUT	(0D0H),A
  C781  ED78          		IN	A,(C)
  C783  B9            		CP	C
  C784  286A          		JR	Z,TURBO
  C786                	NON:
  C786  3D            		DEC	A		;A=0FFH
  C787  321800        		LD	(00018H),A	;BIOS-ROM
                      	
  C78A  2121CA        		LD	HL,AT_SCR1
  C78D  118EDB        		LD	DE,SCR1
  C790  019F00        		LD	BC,SCRNX-SCR1	;転送先のサイズ確認用
  C793  019F00        		LD	BC,AT_SCRE-AT_SCR1
  C796  EDB0          		LDIR
                      	
  C798  21C0CA        		LD	HL,AT_WTTRK
  C79B  1149EA        		LD	DE,WTTRK
  C79E  01B700        		LD	BC,DMAE-WTTRK	;転送先のサイズ確認用
  C7A1  019B00        		LD	BC,AT_CPUE-AT_WTTRK
  C7A4  EDB0          		LDIR
                      	
  C7A6  215BCB        		LD	HL,AT_EDWTC
  C7A9  112BCD        		LD	DE,EDWTC
  C7AC  014700        		LD	BC,EMME-EDWTC	;転送先のサイズ確認用
  C7AF  014300        		LD	BC,AT_EMME-AT_EDWTC
  C7B2  EDB0          		LDIR
                      	
  C7B4  219DEA        		LD	HL,AT_DRD+AT_R
  C7B7  22ECEC        		LD	(_FDRD+1),HL
  C7BA  214DEA        		LD	HL,AT_DWT+AT_R
  C7BD  22EFEC        		LD	(_FDWT+1),HL
  C7C0  213FCD        		LD	HL,AT_EDRDC+AT_RE
  C7C3  2282ED        		LD	(EMMRD),HL
  C7C6  212BCD        		LD	HL,AT_EDWTC+AT_RE
  C7C9  2284ED        		LD	(EMMWR),HL
                      	
  C7CC  210000        		LD	HL,0
  C7CF  222FDB        		LD	(X1PAT),HL
                      	
  C7D2  3EAF          		LD	A,0AFH		;XOR	A
  C7D4  3241D9        		LD	(X1KPAT),A
                      	
  C7D7  212DDC        		LD	HL,SCRNX
  C7DA  22D1EC        		LD	(_SCRN+1),HL
                      	
  C7DD  CD94C9        		CALL	SETCRTC
  C7E0  0610          		LD	B,010H		;PALET
                      	;	OUT	(C),0		;未定義命令ニーモニック
  C7E2  ED71          		DB	0EDH,071H
  C7E4  04            		INC	B
                      	;	OUT	(C),0		;未定義命令ニーモニック
  C7E5  ED71          		DB	0EDH,071H
  C7E7  04            		INC	B
                      	;	OUT	(C),0		;未定義命令ニーモニック
  C7E8  ED71          		DB	0EDH,071H
  C7EA  04            		INC	B
                      	;	OUT	(C),0		;未定義命令ニーモニック
  C7EB  ED71          		DB	0EDH,071H
  C7ED  C390C8        		JP	NOBANK
                      	
  C7F0                	TURBO:
  C7F0  F3            		DI			;Check BIOS
  C7F1  061D          		LD	B,01DH
  C7F3  ED79          		OUT	(C),A		;BIOS ON
  C7F5  3A512F        		LD	A,(02F51H)
  C7F8  04            		INC	B		;B=01EH
  C7F9  ED79          		OUT	(C),A		;BIOS OFF
  C7FB  FB            		EI
  C7FC  FEC9          		CP	0C9H
  C7FE  280B          		JR	Z,BIOSOK
  C800  3EAF          		LD	A,0AFH		;XOR	A
  C802  3241D9        		LD	(X1KPAT),A
  C805  212DDC        		LD	HL,SCRNX
  C808  22D1EC        		LD	(_SCRN+1),HL
  C80B                	BIOSOK:
  C80B  3E1F          		LD	A,01FH
  C80D  DBF0          		IN	A,(0F0H)
  C80F  0F            		RRCA
  C810  380B          		JR	C,CRT1
  C812  21FEC9        		LD	HL,_C8025H
  C815  11B0EC        		LD	DE,CRTCD
  C818  011000        		LD	BC,16
  C81B  EDB0          		LDIR
  C81D                	CRT1:
  C81D  CD94C9        		CALL	SETCRTC
  C820  01AA10        		LD	BC,010AAH	;PALET
  C823  ED49          		OUT	(C),C
  C825  01CC11        		LD	BC,011CCH
  C828  ED49          		OUT	(C),C
  C82A  01F012        		LD	BC,012F0H
  C82D  ED49          		OUT	(C),C
  C82F  04            		INC	B
  C830  ED71          		DB	0EDH,071H
                      	
  C832  3E1F          		LD	A,01FH
  C834  DBF0          		IN	A,(0F0H)
  C836  CB57          		BIT	2,A
  C838  2825          		JR	Z,BANK
                      	
  C83A  AF            		XOR	A
  C83B                	TZ1:
  C83B  F5            		PUSH	AF
  C83C  CDDCEC        		CALL	_GETDPB
  C83F  DD7E12        		LD	A,(IX+012H)
  C842  FE87          		CP	087H
  C844  2013          		JR	NZ,TZ2
  C846  DDE5          		PUSH	IX
  C848  D1            		POP	DE
  C849  2178EB        		LD	HL,M2HD
  C84C  EDA0          		LDI
  C84E  EDA0          		LDI
  C850  13            		INC	DE
  C851  13            		INC	DE
  C852  13            		INC	DE
  C853  13            		INC	DE
  C854  010C00        		LD	BC,12
  C857  EDB0          		LDIR
  C859                	TZ2:
  C859  F1            		POP	AF
  C85A  3C            		INC	A
  C85B  FE08          		CP	8
  C85D  38DC          		JR	C,TZ1
                      	
  C85F                	BANK:
  C85F  01000B        		LD	BC,00B00H
  C862  21007F        		LD	HL,07F00H
  C865  F3            		DI
  C866                	BANK1:
  C866  ED69          		OUT	(C),L
  C868  5E            		LD	E,(HL)
  C869  7B            		LD	A,E
  C86A  C6A5          		ADD	A,0A5H
  C86C  77            		LD	(HL),A
  C86D  BE            		CP	(HL)
  C86E  73            		LD	(HL),E
  C86F  2005          		JR	NZ,BANK2
  C871  2C            		INC	L
  C872  CB65          		BIT	4,L
  C874  28F0          		JR	Z,BANK1
  C876                	BANK2:
  C876  3E10          		LD	A,010H
  C878  ED79          		OUT	(C),A
  C87A  7D            		LD	A,L
  C87B  B7            		OR	A
  C87C  2812          		JR	Z,NOBANK
  C87E  2600          		LD	H,0
  C880  29            		ADD	HL,HL	;*2
  C881  29            		ADD	HL,HL	;*4
  C882  29            		ADD	HL,HL	;*8
  C883  29            		ADD	HL,HL	;*16
  C884  29            		ADD	HL,HL	;*32
  C885  2B            		DEC	HL	;-1
  C886  2B            		DEC	HL	;-2
  C887  2B            		DEC	HL	;-3
  C888  22A8ED        		LD	(BANKCL),HL
  C88B  3E01          		LD	A,1
  C88D  32A0ED        		LD	(BANKFL),A
  C890                	NOBANK:
  C890                	EMM:
  C890  CD5DC9        		CALL	EADR0
  C893  ED78          		IN	A,(C)
  C895  F5            		PUSH	AF
                      	
  C896  110000        		LD	DE,0
  C899                	ECHECK1:
  C899  13            		INC	DE
  C89A  CD40C9        		CALL	EADR2
  C89D  ED60          		IN	H,(C)
  C89F  CD40C9        		CALL	EADR2
  C8A2  7C            		LD	A,H
  C8A3  C6E5          		ADD	A,0E5H
  C8A5  ED79          		OUT	(C),A
  C8A7  3C            		INC	A
  C8A8  CD5DC9        		CALL	EADR0
  C8AB  ED79          		OUT	(C),A
  C8AD  3D            		DEC	A
  C8AE  CD40C9        		CALL	EADR2
  C8B1  ED68          		IN	L,(C)
  C8B3  CD40C9        		CALL	EADR2
  C8B6  ED61          		OUT	(C),H
  C8B8  BD            		CP	L
  C8B9  2004          		JR	NZ,ECHECK2
  C8BB  CB5A          		BIT	3,D
  C8BD  28DA          		JR	Z,ECHECK1
  C8BF                	ECHECK2:
  C8BF  CD5DC9        		CALL	EADR0
  C8C2  F1            		POP	AF
  C8C3  ED79          		OUT	(C),A
                      	
  C8C5  21F7FF        		LD	HL,0-9
  C8C8  19            		ADD	HL,DE
  C8C9  3008          		JR	NC,NOEMM
  C8CB  2288ED        		LD	(EMMCL),HL
  C8CE  3E03          		LD	A,3
  C8D0  3280ED        		LD	(EMMFL),A
  C8D3                	NOEMM:
  C8D3  3E00          	KEYREP:	LD	A,000H
  C8D5  B7            		OR	A
  C8D6  2807          		JR	Z,KEYR1
  C8D8  010000        		LD	BC,0
  C8DB  ED438CEC      		LD	(_CTC),BC
  C8DF                	KEYR1:
  C8DF  0130F8        		LD	BC,0-80*25
  C8E2  2ABAEC        		LD	HL,(CRTCD+10)
  C8E5  ED43BAEC      		LD	(CRTCD+10),BC
  C8E9  1E0C          		LD	E,00CH
  C8EB  CDCDEC        		CALL	_PRINT
  C8EE  22BAEC        		LD	(CRTCD+10),HL
                      	
  C8F1  21BFC9        		LD	HL,INIMES
  C8F4  CDB4D8        		CALL	MSX
                      	
  C8F7  3A87FF        		LD	A,(0FF87H)
  C8FA  FE08          		CP	8
  C8FC  301E          		JR	NC,INIT0
  C8FE  5F            		LD	E,A
  C8FF  C641          		ADD	A,'A'
  C901  32BCC9        		LD	(AUTODV),A
  C904  0E0E          		LD	C,00EH
  C906  CD0500        		CALL	SYSTEM
  C909  1C            		INC	E
  C90A  2185EC        		LD	HL,_SEEKSP	;Disk error Ignore
  C90D  CBFE          		SET	7,(HL)
  C90F  0E1B          		LD	C,01BH
  C911  CD0500        		CALL	SYSTEM
                      	
  C914  2185EC        		LD	HL,_SEEKSP
  C917  CBBE          		RES	7,(HL)
                      	
  C919  3C            		INC	A
  C91A  2008          		JR	NZ,INIT1
  C91C                	INIT0:
  C91C  1E00          		LD	E,0
  C91E  0E0E          		LD	C,00EH
  C920  CD0500        		CALL	SYSTEM
  C923  AF            		XOR	A
  C924                	INIT1:
  C924  2100FF        		LD	HL,0FF00H
  C927  1101FF        		LD	DE,0FF01H
  C92A  01FF00        		LD	BC,000FFH
  C92D  75            		LD	(HL),L
  C92E  EDB0          		LDIR
                      	
  C930  B7            		OR	A
  C931  C8            		RET	Z
                      	
  C932  3EE6          		LD	A,0E6H
  C934  CD04DB        		CALL	COMOUT
  C937  CDE9DA        		CALL	IN49SB
  C93A  CDE9DA        		CALL	IN49SB
  C93D  FE1B          		CP	01BH
  C93F  C9            		RET
                      	
  C940                	EADR2:
  C940  D5            		PUSH	DE
  C941  EB            		EX	DE,HL
  C942  29            		ADD	HL,HL
  C943  29            		ADD	HL,HL
  C944  ED4B8BED      		LD	BC,(EMMBL-1)
  C948  0E00          		LD	C,0
  C94A  09            		ADD	HL,BC
  C94B  ED4B93ED      		LD	BC,(EMMDV)
  C94F  060D          		LD	B,00DH
  C951  ED49          		OUT	(C),C
  C953  0C            		INC	C
  C954  ED69          		OUT	(C),L
  C956  0C            		INC	C
  C957  ED61          		OUT	(C),H
  C959  0C            		INC	C
  C95A  EB            		EX	DE,HL
  C95B  D1            		POP	DE
  C95C  C9            		RET
                      	
  C95D                	EADR0:
  C95D  ED4B93ED      		LD	BC,(EMMDV)
  C961  060D          		LD	B,00DH
                      	;	OUT	(C),0		;未定義命令ニーモニック
  C963  ED71          		DB	0EDH,071H
  C965  0C            		INC	C
                      	;	OUT	(C),0		;未定義命令ニーモニック
  C966  ED71          		DB	0EDH,071H
  C968  0C            		INC	C
                      	;	OUT	(C),0		;未定義命令ニーモニック
  C969  ED71          		DB	0EDH,071H
  C96B  0C            		INC	C
  C96C  C9            		RET
                      	
  C96D                	CHKCTC:
  C96D  C5            		PUSH	BC
  C96E  110347        		LD	DE,04703H
  C971                	INICTC1:
  C971  0C            		INC	C
  C972  ED51          		OUT	(C),D
                      	;	OUT	(C),0		;未定義命令ニーモニック
  C974  ED71          		DB	0EDH,071H
  C976  1D            		DEC	E
  C977  20F8          		JR	NZ,INICTC1
  C979  C1            		POP	BC
                      	
  C97A  11FA07        		LD	DE,007FAH
  C97D  ED51          		OUT	(C),D
  C97F  ED59          		OUT	(C),E
  C981  ED78          		IN	A,(C)
  C983  BB            		CP	E
  C984  C0            		RET	NZ
  C985  ED51          		OUT	(C),D
  C987  ED51          		OUT	(C),D
  C989  ED78          		IN	A,(C)
  C98B  BA            		CP	D
  C98C  C0            		RET	NZ
  C98D  03            		INC	BC
  C98E  03            		INC	BC
  C98F  ED438CEC      		LD	(_CTC),BC
  C993  C9            		RET
                      	
  C994                	SETCRTC:
  C994  21B0EC        		LD	HL,CRTCD
  C997  AF            		XOR	A
  C998                	SETCRT1:
  C998  010018        		LD	BC,01800H
  C99B  ED79          		OUT	(C),A
  C99D  0C            		INC	C
  C99E  04            		INC	B
  C99F  EDA3          		OUTI
  C9A1  3C            		INC	A
  C9A2  FE0C          		CP	12
  C9A4  20F2          		JR	NZ,SETCRT1
  C9A6  23            		INC	HL
  C9A7  23            		INC	HL
  C9A8  01031B        		LD	BC,01A03H+00100H
  C9AB  EDA3          		OUTI
  C9AD  01D020        		LD	BC,01FD0H+00100H
  C9B0  EDA3          		OUTI
  C9B2  C9            		RET
                      	
  C9B3  4155544F455845	AUTOD:	DB	"AUTOEXEC "
  C9BC  413A00        	AUTODV:	DB	"A:",0
                      	
  C9BF  4C53582D446F64	INIMES:	DB	"LSX-Dodgers for X1/turbo version "
  C9E0  312E          		DB	030H + VER_1, '.'
  C9E2  3332          		DB	030H + VER_2 ,030H + VER_3
  C9E4  2047616B752028		DB	' Gaku (Lovers/Tablacus)',0DH,0AH
  C9FD  00            		DB	0
                      	
  C9FE                	_C8025H:
  C9FE  6B5059881B0119		DB	06BH,050H,059H,088H,01BH,001H,019H,01AH
  CA06  000F          		DB	000H,00FH
  CA08  30F8B0FF      		DW	0-80*LINE,0-80
  CA0C  0CA3          		DB	00CH,0A3H
                      	
  CA0E  030C0F30333C3F	TEXTDT:	DB	003H,00CH,00FH,030H,033H,03CH,03FH
                      	
  CA15                	SIODATA:
  CA15  18            		DB	018H
  CA16  0100          		DB	1,0
  CA18  0200          		DB	2,0
  CA1A  03C1          		DB	3,0C1H
  CA1C  0444          		DB	4,044H
  CA1E  05E8          		DB	5,0E8H
  CA20  FF            		DB	0FFH
                      	
                      	;	ノンターボ用パッチ
                      	
  CA21                	AT_SCR1:
  CA21  D9            		EXX
  CA22  C5            		PUSH	BC
  CA23  015020        		LD	BC,02000H+80
  CA26  D9            		EXX
  CA27  C5            		PUSH	BC
  CA28  010020        		LD	BC,02000H
                      	
  CA2B  67            		LD	H,A
  CA2C  B7            		OR	A
  CA2D                	AT_SCRUP1:
  CA2D  2815          		JR	Z,AT_SCRCL
  CA2F  C5            		PUSH	BC
  CA30  CBE0          		SET	4,B
  CA32  D9            		EXX
  CA33  C5            		PUSH	BC
  CA34  CBE0          		SET	4,B
  CA36  D9            		EXX
  CA37  CDC8DB        		CALL	AT_UPSUB+AT_RS
  CA3A  D9            		EXX
  CA3B  C1            		POP	BC
  CA3C  D9            		EXX
  CA3D  C1            		POP	BC
  CA3E  CDC8DB        		CALL	AT_UPSUB+AT_RS
  CA41  25            		DEC	H
  CA42  18E9          		JR	AT_SCRUP1
                      	
  CA44                	AT_SCRCL:
  CA44  215020        		LD	HL,02000H+80
  CA47  3A96EC        		LD	A,(_COLORF)
  CA4A                	AT_SCRCL1:
  CA4A  CBE0          		SET	4,B
  CA4C  ED61          		OUT	(C),H
  CA4E  CBA0          		RES	4,B
  CA50  ED79          		OUT	(C),A
  CA52  03            		INC	BC
  CA53  2D            		DEC	L
  CA54  20F4          		JR	NZ,AT_SCRCL1
  CA56  C1            		POP	BC
  CA57  D9            		EXX
  CA58  C1            		POP	BC
  CA59  D9            		EXX
  CA5A  C9            		RET
                      	
  CA5B                	AT_UPSUB:
  CA5B  2E28          		LD	L,40
  CA5D                	AT_UPSUB1:
  CA5D  D9            		EXX
  CA5E  ED78          		IN	A,(C)
  CA60  03            		INC	BC
  CA61  D9            		EXX
  CA62  ED79          		OUT	(C),A
  CA64  03            		INC	BC
  CA65  D9            		EXX
  CA66  ED78          		IN	A,(C)
  CA68  03            		INC	BC
  CA69  D9            		EXX
  CA6A  ED79          		OUT	(C),A
  CA6C  03            		INC	BC
  CA6D  2D            		DEC	L
  CA6E  20ED          		JR	NZ,AT_UPSUB1
  CA70  C9            		RET
                      	
                      	;	FLOPPY DISK DRIVER(CPU)
                      	
  CA71                	DISKC:
  CA71  1B            		DEC	DE
  CA72  CB5F          		BIT	3,A
  CA74  C442EA        		CALL	NZ,RNF
  CA77                	DISKD:
  CA77  E5            		PUSH	HL
  CA78  2148EA        		LD	HL,RETRY
  CA7B  35            		DEC	(HL)
  CA7C  E1            		POP	HL
  CA7D  203E          		JR	NZ,AT_ERR		;Retry
  CA7F  B7            		OR	A
  CA80  283B          		JR	Z,AT_ERR		;Error
                      	
  CA82                	AT_DELP:
  CA82  CD42EA        		CALL	RNF
  CA85  CD1EEA        		CALL	FDMOFF
  CA88  3A85EC        		LD	A,(_SEEKSP)
  CA8B  87            		ADD	A,A
  CA8C  382E          		JR	C,AT_ERRZ
  CA8E                	AT_DELP1:
  CA8E  D5            		PUSH	DE
  CA8F  21B0EB        		LD	HL,DEMES
  CA92  CDB4D8        		CALL	MSX
  CA95  CD99D7        		CALL	KEYBC
  CA98                	AT_DELP2:
  CA98  CDCAEC        		CALL	_INKEY
  CA9B  28FB          		JR	Z,AT_DELP2
                      	
  CA9D  D1            		POP	DE
  CA9E  CDDDDF        		CALL	CAP
  CAA1  FE52          		CP	'R'		;Retry
  CAA3  200A          		JR	NZ,AT_DELP3
  CAA5  210000        	DHLPAT:	LD	HL,0
  CAA8  3E02          		LD	A,2
  CAAA  3248EA        		LD	(RETRY),A
  CAAD  B7            		OR	A
  CAAE  C9            		RET
  CAAF                	AT_DELP3:
  CAAF  FE49          		CP	'I'		;Ignore
  CAB1  2807          		JR	Z,AT_IGNORE
  CAB3  FE41          		CP	'A'		;Abort
  CAB5  20D7          		JR	NZ,AT_DELP1
  CAB7  C39FD3        		JP	BOOT
  CABA                	AT_IGNORE:
  CABA  3EFF          		LD	A,0FFH
  CABC                	AT_ERRZ:
  CABC  BF            		CP	A
  CABD                	AT_ERR:
  CABD  3EFF          		LD	A,0FFH
  CABF  C9            		RET
                      	
  CAC0                	AT_SCRE:
                      	
  CAC0                	AT_WTTRK:
  CAC0  3EF0          		LD	A,0F0H
  CAC2  1802          		JR	AT_WTTRK1
                      	
  CAC4                	AT_DWT:
  CAC4  3EA0          		LD	A,0A0H
  CAC6                	AT_WTTRK1:
  CAC6  32E6E9        		LD	(FDCPAT+1),A
                      	
  CAC9  3E02          		LD	A,2		;Retry count
  CACB  3248EA        		LD	(RETRY),A
                      	
  CACE                	DWT0:
  CACE  D5            		PUSH	DE
  CACF  E5            		PUSH	HL
  CAD0  2213DC        		LD	(DHLPAT+1+AT_RS),HL
  CAD3  CD7FE9        		CALL	SEEK		;Write disk
  CAD6  E1            		POP	HL
  CAD7  3831          		JR	C,ERRDW
  CAD9  F3            		DI
  CADA  3AE6E9        		LD	A,(FDCPAT+1)
  CADD  CD2AEA        		CALL	SECSET
  CAE0  0EFB          		LD	C,0FBH
                      	
  CAE2                	DWT1:
  CAE2  56            		LD	D,(HL)
  CAE3                	DWT2:
  CAE3  78            		LD	A,B
  CAE4  DBF8          		IN	A,(0F8H)
  CAE6  0F            		RRCA
  CAE7  3008          		JR	NC,DWT4
  CAE9  0F            		RRCA
  CAEA  30F7          		JR	NC,DWT2
  CAEC                	DWT3:
  CAEC  ED51          		OUT	(C),D
  CAEE  23            		INC	HL
  CAEF  18F1          		JR	DWT1
                      	
  CAF1                	DWT4:
  CAF1  3D            		DEC	A
  CAF2  28F8          		JR	Z,DWT3
  CAF4  3C            		INC	A
  CAF5  FB            		EI
  CAF6  D1            		POP	DE
  CAF7  13            		INC	DE
  CAF8  CD1EEA        		CALL	FDMOFF
  CAFB  C8            		RET	Z
  CAFC  CDDEDB        		CALL	DISKC+AT_RS
  CAFF  20CD          		JR	NZ,DWT0
  CB01  B7            		OR	A
  CB02  C8            		RET	Z
  CB03                	ERRW:
  CB03  3EFF          		LD	A,0FFH
  CB05                	ERRZ:
  CB05  BF            		CP	A
  CB06  37            		SCF
  CB07  C31EEA        		JP	FDMOFF
                      	
  CB0A                	ERRDW:
  CB0A  D1            		POP	DE
  CB0B  CDEFDB        		CALL	AT_DELP+AT_RS
  CB0E  20BE          		JR	NZ,DWT0
  CB10  B7            		OR	A
  CB11  20F0          		JR	NZ,ERRW
  CB13  C9            		RET
                      	
  CB14                	AT_DRD:
  CB14  3E80          		LD	A,080H
  CB16  32E6E9        		LD	(FDCPAT+1),A
                      	
  CB19  3E02          		LD	A,2		;Retry count
  CB1B  3248EA        		LD	(RETRY),A
                      	
  CB1E                	DRD0:
  CB1E  D5            		PUSH	DE
  CB1F  E5            		PUSH	HL
  CB20  2213DC        		LD	(DHLPAT+1+AT_RS),HL
  CB23  CD7FE9        		CALL	SEEK		;Read disk
  CB26  E1            		POP	HL
  CB27  3828          		JR	C,ERRDR
  CB29  F3            		DI
  CB2A  3AE6E9        		LD	A,(FDCPAT+1)
  CB2D  CD2AEA        		CALL	SECSET
  CB30  0EFB          		LD	C,0FBH
  CB32                	DRD1:
  CB32  78            		LD	A,B
  CB33  DBF8          		IN	A,(0F8H)
  CB35  0F            		RRCA
  CB36  3008          		JR	NC,DRD3
  CB38  0F            		RRCA
  CB39  30F7          		JR	NC,DRD1
  CB3B  EDA2          		INI
  CB3D  04            		INC	B
  CB3E  18F2          		JR	DRD1
                      	
  CB40                	DRD3:
  CB40  B7            		OR	A
  CB41  FB            		EI
  CB42  D1            		POP	DE
  CB43  13            		INC	DE
  CB44  CD1EEA        		CALL	FDMOFF
  CB47  C8            		RET	Z
  CB48  CDDEDB        		CALL	DISKC+AT_RS
  CB4B  20D1          		JR	NZ,DRD0
  CB4D  B7            		OR	A
  CB4E  20B3          		JR	NZ,ERRW
  CB50  C9            		RET
                      	
  CB51                	ERRDR:
  CB51  D1            		POP	DE
  CB52  CDEFDB        		CALL	AT_DELP+AT_RS
  CB55  20C7          		JR	NZ,DRD0
  CB57  B7            		OR	A
  CB58  20A9          		JR	NZ,ERRW
  CB5A  C9            		RET
                      	
  CB5B                	AT_CPUE:
                      	
                      	
                      	;	EMM DRIVER(CPU)
                      	
                      	
  CB5B                	AT_EDWTC:
  CB5B  CD53CD        		CALL	AT_EADR+AT_RE
  CB5E                	AT_EDWTC1:
  CB5E  04            		INC	B
  CB5F  EDA3          		OUTI
  CB61  04            		INC	B
  CB62  EDA3          		OUTI
  CB64  04            		INC	B
  CB65  EDA3          		OUTI
  CB67  04            		INC	B
  CB68  EDA3          		OUTI
  CB6A  3D            		DEC	A
  CB6B  20F1          		JR	NZ,AT_EDWTC1
  CB6D  AF            		XOR	A
  CB6E  C9            		RET
                      	
  CB6F                	AT_EDRDC:
  CB6F  CD53CD        		CALL	AT_EADR+AT_RE
  CB72                	AT_EDRDC1:
  CB72  EDA2          		INI
  CB74  04            		INC	B
  CB75  EDA2          		INI
  CB77  04            		INC	B
  CB78  EDA2          		INI
  CB7A  04            		INC	B
  CB7B  EDA2          		INI
  CB7D  04            		INC	B
  CB7E  3D            		DEC	A
  CB7F  20F1          		JR	NZ,AT_EDRDC1
  CB81  AF            		XOR	A
  CB82  C9            		RET
                      	
  CB83                	AT_EADR:
  CB83  D5            		PUSH	DE
  CB84  EB            		EX	DE,HL
  CB85  29            		ADD	HL,HL
  CB86  29            		ADD	HL,HL
  CB87  ED4BA0EC      		LD	BC,(_MAXCYL-1)
  CB8B  0E00          		LD	C,0
  CB8D  09            		ADD	HL,BC
  CB8E  060D          		LD	B,00DH
  CB90  ED49          		OUT	(C),C
  CB92  0C            		INC	C
  CB93  ED69          		OUT	(C),L
  CB95  0C            		INC	C
  CB96  ED61          		OUT	(C),H
  CB98  0C            		INC	C
  CB99  EB            		EX	DE,HL
  CB9A  D1            		POP	DE
  CB9B  13            		INC	DE
  CB9C  AF            		XOR	A
  CB9D  C9            		RET
                      	
  CB9E                	AT_EMME:
                      	
  CB9E                	INITE:
  CB9E                		DS	0CC06H-INITE
                      	
  CC06                	BDOS:
  CC06  C3AED3        		JP	BDOS0
  CC09                		DS	10	;Reserved
                      	
                      	;LDIO2.ASM
                      	
                      	;	LSX-Dodgers IO2
                      	
  CC13                	_SYS03:		;(BDOS)外部入力
  CC13  F3            		DI
  CC14  C5            		PUSH	BC
  CC15  01911F        	SIOAD:	LD	BC,01F91H
  CC18  3E05          		LD	A,5
  CC1A  ED79          		OUT	(C),A
  CC1C  3EEA          		LD	A,0EAH		;RTS ON
  CC1E  ED79          		OUT	(C),A
  CC20                	REC1:
  CC20  CD37CC        		CALL	BREAK2
  CC23  ED78          		IN	A,(C)
  CC25  0F            		RRCA			;Arrival
  CC26  30F8          		JR	NC,REC1
  CC28                	BREAK2X:
  CC28  3F            		CCF
  CC29  3E05          		LD	A,5
  CC2B  ED79          		OUT	(C),A
  CC2D  3EE8          		LD	A,0E8H		;RTS OFF
  CC2F  ED79          		OUT	(C),A
                      	
  CC31  0D            		DEC	C
  CC32  ED78          		IN	A,(C)		;Read data
  CC34  C1            		POP	BC
  CC35  FB            		EI
  CC36  C9            		RET
                      	
  CC37                	BREAK2:
  CC37  3E1A          		LD	A,01AH
  CC39  DB01          		IN	A,(1)
  CC3B  0F            		RRCA
  CC3C  D8            		RET	C
  CC3D  C1            		POP	BC		;PC
  CC3E  01911F        	SIOAD0:	LD	BC,01F91H
  CC41  18E5          		JR	BREAK2X
                      	
  CC43                	_SYS04:		;(BDOS)外部出力
  CC43  C5            		PUSH	BC
  CC44  01911F        	SIOAD1:	LD	BC,01F91H
  CC47                	XMIT1:
  CC47  CD37CC        		CALL	BREAK2
  CC4A  3E10          		LD	A,010H		;Reset status
  CC4C  ED79          		OUT	(C),A
  CC4E  ED78          		IN	A,(C)
  CC50  2F            		CPL
  CC51  E624          		AND	024H		;CTS Send Empty
  CC53  20F2          		JR	NZ,XMIT1
  CC55  0D            		DEC	C
  CC56  ED59          		OUT	(C),E
  CC58  C1            		POP	BC
  CC59  C9            		RET
                      	
  CC5A                	_SYS05:		;(BDOS)プリンタ出力
  CC5A  C5            		PUSH	BC
  CC5B  01011A        		LD	BC,01A01H
  CC5E                	_S05X1:
  CC5E  CD37CC        		CALL	BREAK2
  CC61  ED78          		IN	A,(C)
  CC63  E608          		AND	8
  CC65  20F7          		JR	NZ,_S05X1
  CC67  F3            		DI
  CC68  0D            		DEC	C
  CC69  ED59          		OUT	(C),E
  CC6B  0E03          		LD	C,3
  CC6D  3E0E          		LD	A,00EH
  CC6F  ED79          		OUT	(C),A
  CC71  3C            		INC	A
  CC72  03            		INC	BC
  CC73  0B            		DEC	BC
  CC74  ED79          		OUT	(C),A
  CC76  FB            		EI
  CC77  C1            		POP	BC
  CC78  AF            		XOR	A
  CC79  C9            		RET
                      	
                      	
                      	;LDDISK2.ASM
                      	
                      	;	LSX-Dodgers DISK2
                      	
                      	
                      	;	GRAPHIC RAM DISK DRIVER
                      	
                      	
  CC7A                	GDRD:
  CC7A  CD90CC        		CALL	GADR
  CC7D                	GDRDC1:
  CC7D  EDA2          		INI
  CC7F  04            		INC	B
  CC80  0C            		INC	C
  CC81  20FA          		JR	NZ,GDRDC1
  CC83  1817          		JR	S1FD0
                      	
  CC85                	GDWT:
  CC85  CD90CC        		CALL	GADR
  CC88                	GDWTC1:
  CC88  04            		INC	B
  CC89  EDA3          		OUTI
  CC8B  0C            		INC	C
  CC8C  20FA          		JR	NZ,GDWTC1
  CC8E  180C          		JR	S1FD0
                      	
  CC90                	GADR:
  CC90  0E00          		LD	C,0
  CC92  7B            		LD	A,E
  CC93  C640          		ADD	A,040H
  CC95  47            		LD	B,A
  CC96  13            		INC	DE
  CC97  3ABFEC        		LD	A,(WK1FD0)
  CC9A  F610          		OR	010H		;BANK1
  CC9C                	S1FD0:
  CC9C  C5            		PUSH	BC
  CC9D  32BFEC        		LD	(WK1FD0),A
  CCA0  01D01F        		LD	BC,01FD0H
  CCA3  ED79          		OUT	(C),A
  CCA5  C1            		POP	BC
  CCA6  E6EF          		AND	0EFH		;BANK0
  CCA8  C9            		RET
                      	
                      	
                      	;	BANK RAM DISK DRIVER
                      	
                      	
  CCA9                	BDRDC:
  CCA9  ED73C8CC      		LD	(BANKSP+1),SP
  CCAD  3AC9CC        		LD	A,(BANKSP+2)
  CCB0  87            		ADD	A,A
  CCB1  3803          		JR	C,BDRDC1
  CCB3  31D4FF        		LD	SP,EXTSP
  CCB6                	BDRDC1:
  CCB6  D5            		PUSH	DE
  CCB7  D9            		EXX
  CCB8  C5            		 PUSH	 BC
  CCB9  D5            		 PUSH	 DE
  CCBA  CDEECC        		 CALL	 BADR
  CCBD  CD0BCD        		CALL	BTFR
  CCC0  D9            		EXX
  CCC1                	BDWTCE:
  CCC1  D1            		 POP	 DE
  CCC2  C1            		 POP	 BC
  CCC3  D9            		 EXX
  CCC4  D1            		POP	DE
  CCC5  13            		INC	DE
  CCC6  FB            		EI
  CCC7  310000        	BANKSP:	LD	SP,0
  CCCA  AF            		XOR	A
  CCCB  C9            		RET
                      	
  CCCC                	BDWTC:
  CCCC  ED73C8CC      		LD	(BANKSP+1),SP
  CCD0  3AC9CC        		LD	A,(BANKSP+2)
  CCD3  87            		ADD	A,A
  CCD4  3803          		JR	C,BDWTC1
  CCD6  31D4FF        		LD	SP,EXTSP
  CCD9                	BDWTC1:
  CCD9  D5            		PUSH	DE
  CCDA  D9            		EXX
  CCDB  C5            		 PUSH	 BC
  CCDC  D5            		 PUSH	 DE
  CCDD  CDEECC        		 CALL	 BADR
  CCE0  D9            		EXX
  CCE1  53            		 LD	D,E
  CCE2  5F            		 LD	E,A
  CCE3  D9            		 EXX
  CCE4  EB            		EX	DE,HL
  CCE5  CD0BCD        		CALL	BTFR
  CCE8  EB            		EX	DE,HL
  CCE9  D9            		EXX
  CCEA  ED51          		 OUT	 (C),D	 ;MAIN
  CCEC  18D3          		 JR	 BDWTCE
                      	
  CCEE                	BADR:
  CCEE  D9            		 EXX
  CCEF  7B            		LD	A,E
  CCF0  87            		ADD	A,A
  CCF1  CB12          		RL	D
  CCF3  87            		ADD	A,A
  CCF4  CB12          		RL	D
  CCF6  F5            		PUSH	AF
  CCF7  87            		ADD	A,A
  CCF8  7A            		LD	A,D
  CCF9  8F            		ADC	A,A
  CCFA  E60F          		AND	00FH
  CCFC  D9            		EXX
  CCFD  01000B        		 LD	 BC,00B00H
  CD00  57            		 LD	 D,A	  ;BANK
  CD01  1E10          		 LD	 E,010H	  ;MAIN
  CD03  D9            		 EXX
  CD04  D1            		POP	DE
  CD05  0600          		LD	B,0
  CD07  58            		LD	E,B
  CD08  CBBA          		RES	7,D
  CD0A  C9            		RET
                      	
  CD0B                	BTFR:
  CD0B  D5            		PUSH	DE
  CD0C  F3            		DI
                      	
  CD0D                	BTFR1:
  CD0D  D9            		EXX
  CD0E  ED51          		 OUT	 (C),D	 ;BANK(MAIN)
  CD10  D9            		 EXX
  CD11  E3            		EX	(SP),HL
  CD12  7E            		LD	A,(HL)
  CD13  23            		INC	HL
  CD14  4E            		LD	C,(HL)
  CD15  23            		INC	HL
  CD16  56            		LD	D,(HL)
  CD17  23            		INC	HL
  CD18  5E            		LD	E,(HL)
  CD19  23            		INC	HL
  CD1A  E3            		EX	(SP),HL
  CD1B  D9            		EXX
  CD1C  ED59          		 OUT	 (C),E	 ;MAIN(BANK)
  CD1E  D9            		 EXX
  CD1F  77            		LD	(HL),A
  CD20  23            		INC	HL
  CD21  71            		LD	(HL),C
  CD22  23            		INC	HL
  CD23  72            		LD	(HL),D
  CD24  23            		INC	HL
  CD25  73            		LD	(HL),E
  CD26  23            		INC	HL
  CD27  10E4          		DJNZ	BTFR1
  CD29  D1            		POP	DE
  CD2A  C9            		RET
                      	
                      	
                      	;	EMM DRIVER(DMA)
                      	
                      	
  CD2B                	EDWTC:
  CD2B  3E11          		LD	A,17
  CD2D  01            		DB	1
  CD2E                	EDRDC:
  CD2E  3E0F          		LD	A,15
  CD30                	EDWTC1:
  CD30  D5            		PUSH	DE
  CD31  226DCD        		LD	(EDMAD+12),HL
  CD34  EB            		EX	DE,HL
  CD35  29            		ADD	HL,HL
  CD36  29            		ADD	HL,HL
  CD37  ED4BA0EC      		LD	BC,(_MAXCYL-1)
  CD3B  0E00          		LD	C,0
  CD3D  09            		ADD	HL,BC
  CD3E  ED4B84EC      		LD	BC,(_DRIVE)
  CD42  060D          		LD	B,00DH
  CD44  ED49          		OUT	(C),C
  CD46  0C            		INC	C
  CD47  ED69          		OUT	(C),L
  CD49  0C            		INC	C
  CD4A  ED61          		OUT	(C),H
                      	
  CD4C  2161CD        		LD	HL,EDMAD
  CD4F  CDE6EA        		CALL	SETDMA
  CD52  3EB3          		LD	A,0B3H
  CD54  ED79          		OUT	(C),A
  CD56  ED49          		OUT	(C),C		;OUT 01F87H,087H
  CD58  EB            		EX	DE,HL
  CD59  24            		INC	H
  CD5A  24            		INC	H
  CD5B  24            		INC	H
  CD5C  24            		INC	H
  CD5D  D1            		POP	DE
  CD5E  13            		INC	DE
  CD5F  AF            		XOR	A
  CD60  C9            		RET
                      	
  CD61  C37D030DFF032C	EDMAD:	DB	0C3H,07DH,003H,00DH,0FFH,003H,02CH,050H,002H
  CD6A  809AAD0000CF01		DB	080H,09AH,0ADH,000H,000H,0CFH,001H,0CFH
                      	
  CD72                	EMME:
                      	
  01D0                	AT_RE	EQU	EDWTC-AT_EDWTC
                      	
                      	
                      	;LDCCP.ASM
                      	
                      	;	LSX-Dodgers CCP
                      	
  0040                	PATHX	EQU	64
  CD72                	PATHD:	DS	PATHX
  CDB2  00            	PATHE:	DB	0
                      	
  CDB3  4F4B24        	OK:	DB	"OK$"
  CDB6  536B697024    	SKIP:	DB	"Skip$"
  CDBB  6B206279746573	KBFREE:	DB	"k bytes free",9,'$'
  CDC9  20202020646972	DIRMES:	DB	"    dir $"
  CDD2  074572726F7221	COMERM:	DB	7,"Error!$"
                      	
  0009                	COMS	EQU	9
  CDDA                	COMTB:
  CDDA  44202020      		DB	"D   "	;1
  CDDE  2ED0          		DW	C_DIR
  CDE0  44495220      		DB	"DIR "	;2
  CDE4  2ED0          		DW	C_DIR
  CDE6  434F5059      		DB	"COPY"	;3
  CDEA  26D2          		DW	C_COPY
  CDEC  43442020      		DB	"CD  "	;4
  CDF0  26CF          		DW	C_CD
  CDF2  44454C20      		DB	"DEL "	;5
  CDF6  11D0          		DW	C_DEL
  CDF8  50415448      		DB	"PATH"	;6
  CDFC  DFD0          		DW	C_PATH
  CDFE  52454E20      		DB	"REN "	;7
  CE02  1BD0          		DW	C_REN
  CE04  54595045      		DB	"TYPE"	;8
  CE08  49D3          		DW	C_TYPE
  CE0A  52454D20      		DB	"REM "	;9
  CE0E  0FD0          		DW	C_REM
                      	
  CE10                	WBOOT1:
  CE10  F3            		DI
  CE11  310000        		LD	SP,STACK
                      	
  CE14  3EEC          		LD	A,INTVEC/256
  CE16  ED47          		LD	I,A
                      	
  CE18  3EE4          		LD	A,0E4H
  CE1A  CD04DB        		CALL	COMOUT
  CE1D  3EC8          		LD	A,INTVEC
  CE1F  CDDEDA        		CALL	OT49SB
                      	
  CE22  3ABCEC        		LD	A,(CRTCD+12)
  CE25  B7            		OR	A
  CE26  200C          		JR	NZ,SETCRT0
  CE28  2130F8        		LD	HL,0-80*LINE
  CE2B  22BAEC        		LD	(CRTCD+10),HL
  CE2E  21B0FF        		LD	HL,0-80
  CE31  22BCEC        		LD	(CRTCD+12),HL
  CE34                	SETCRT0:
  CE34  21B0EC        		LD	HL,CRTCD
  CE37  AF            		XOR	A
  CE38                	SETCRT2:
  CE38  010018        		LD	BC,01800H
  CE3B  ED79          		OUT	(C),A
  CE3D  0C            		INC	C
  CE3E  04            		INC	B
  CE3F  EDA3          		OUTI
  CE41  3C            		INC	A
  CE42  FE0C          		CP	12
  CE44  20F2          		JR	NZ,SETCRT2
  CE46  0D            		DEC	C
  CE47  ED79          		OUT	(C),A
  CE49  0C            		INC	C
                      	;	OUT	(C),0		;未定義命令ニーモニック
  CE4A  ED71          		DB	0EDH,071H
  CE4C  0D            		DEC	C
  CE4D  3C            		INC	A
  CE4E  ED79          		OUT	(C),A
  CE50  0C            		INC	C
                      	;	OUT	(C),0		;未定義命令ニーモニック
  CE51  ED71          		DB	0EDH,071H
  CE53  23            		INC	HL
  CE54  23            		INC	HL
  CE55  01031B        		LD	BC,01A03H+00100H
  CE58  EDA3          		OUTI
  CE5A  01D020        		LD	BC,01FD0H+00100H
  CE5D  EDA3          		OUTI
  CE5F  CDD5D0        		CALL	LTNL
  CE62                	COMMAND:
  CE62  CD1ACF        		CALL	SETDTA1
  CE65  D5            		PUSH	DE
  CE66  3A87EC        		LD	A,(_DVSW)
  CE69  C641          		ADD	A,'A'
  CE6B  5F            		LD	E,A
  CE6C  CDCDEC        		CALL	_PRINT
  CE6F  1E3E          		LD	E,'>'
  CE71  CDCDEC        		CALL	_PRINT
  CE74  D1            		POP	DE		;DE=DTA1
  CE75  3E50          		LD	A,80
  CE77  12            		LD	(DE),A
  CE78  CD1FD8        		CALL	_SYS0A		;(BDOS)文字列入力
  CE7B  CDD5D0        		CALL	LTNL
                      	
  CE7E  118200        		LD	DE,DTA1+2
  CE81  CDFDEC        		CALL	_COMANL
  CE84  30DC          		JR	NC,COMMAND
  CE86  CD99D7        		CALL	KEYBC
  CE89  11D2CD        		LD	DE,COMERM
  CE8C  CDDAD3        		CALL	_SYS09		;(BDOS)文字列出力
  CE8F  C7            		RST	0
                      	
  CE90                	COMANL:
  CE90  CDDDDC        		CALL	FILE
  CE93  D5            		PUSH	DE
  CE94  11DC00        		LD	DE,FNAME
  CE97  1A            		LD	A,(DE)
  CE98  FE20          		CP	020H
  CE9A  2848          		JR	Z,SDVSW
  CE9C  1B            		DEC	DE
  CE9D  1A            		LD	A,(DE)
  CE9E  C6FF          		ADD	A,0FFH
  CEA0  380A          		JR	C,COMB
  CEA2  13            		INC	DE
                      	
  CEA3  21DACD        		LD	HL,COMTB
  CEA6  3E09          		LD	A,COMS
  CEA8  47            		LD	B,A
  CEA9  CD70DF        		CALL	CPNAME
  CEAC                	COMB:
  CEAC  D1            		POP	DE
  CEAD  D20F00        		JP	NC,JP_HL
  CEB0  EB            		EX	DE,HL
  CEB1  2290CF        		LD	(COMPAT+1),HL
  CEB4  22E7CF        		LD	(BATPAT+1),HL
  CEB7  F5            		PUSH	AF
  CEB8  CD38CF        		CALL	CEXE4
  CEBB  F1            		POP	AF
  CEBC  21DC00        		LD	HL,FNAME
  CEBF  116D00        		LD	DE,FCB2+1	;COMMAND NAME
  CEC2  010B00        		LD	BC,11
  CEC5  EDB0          		LDIR
  CEC7  1172CD        		LD	DE,PATHD
  CECA                	CEX1:
  CECA  1A            		LD	A,(DE)
  CECB  FE20          		CP	020H
  CECD  D8            		RET	C
  CECE  CDD2DC        		CALL	FILEC
  CED1  D5            		PUSH	DE
  CED2  216D00        		LD	HL,FCB2+1	;COMMAND NAME
  CED5  11DC00        		LD	DE,FNAME
  CED8  010B00        		LD	BC,11
  CEDB  EDB0          		LDIR
  CEDD  CD38CF        		CALL	CEXE4
  CEE0  D1            		POP	DE
  CEE1  13            		INC	DE
  CEE2  18E6          		JR	CEX1
                      	
  CEE4                	SDVSW:
  CEE4  F1            		POP	AF
  CEE5  3ADB00        		LD	A,(FDRV)
  CEE8  3D            		DEC	A
  CEE9  5F            		LD	E,A
  CEEA  0E0E          		LD	C,00EH		;(BDOS)カレント・ドライブの設定
  CEEC  1833          		JR	SYSTEM0
                      	
  CEEE                	OPEN1:
  CEEE  21DB00        		LD	HL,FDRV
  CEF1                	OPEN:
  CEF1  0E11          		LD	C,011H		;(BDOS)最初のファイルの検索
  CEF3                	OPEN3:
  CEF3  D5            		PUSH	DE
  CEF4  1151FF        		LD	DE,DTA
  CEF7  CD17CF        		CALL	SETDTA
  CEFA  EB            		EX	DE,HL
  CEFB  CD0500        		CALL	SYSTEM
  CEFE  D1            		POP	DE
  CEFF  B7            		OR	A
  CF00  C9            		RET
                      	
  CF01                	OPEN2:
  CF01  0E12          		LD	C,012H
  CF03  18EE          		JR	OPEN3
                      	
  CF05                	DEFCB:				;Z=Ok NZ=Error
  CF05  1151FF        		LD	DE,DTA
  CF08  CD1FCF        		CALL	SYSC0F
                      	
  CF0B  210000        		LD	HL,0
  CF0E  2272FF        		LD	(DTA+33),HL
  CF11  2274FF        		LD	(DTA+35),HL
  CF14  110001        		LD	DE,00100H
  CF17                	SETDTA:
  CF17  C3F3D5        		JP	_SYS1A		;(BDOS)DTAの設定
                      	
  CF1A                	SETDTA1:
  CF1A  118000        		LD	DE,DTA1
  CF1D  18F8          		JR	SETDTA
                      	
  CF1F                	SYSC0F:
  CF1F  0E0F          		LD	C,00FH		;(BDOS)ファイルのオープン
  CF21                	SYSTEM0:
  CF21  CD0500        		CALL	SYSTEM
  CF24  B7            		OR	A
  CF25  C9            		RET
                      	
  CF26                	C_CD:
  CF26  CDD2DC        		CALL	FILEC
  CF29  210000        		LD	HL,0
  CF2C  11DB00        		LD	DE,FDRV
  CF2F  1803          		JR	S27
                      	
  CF31                	S27DTA:
  CF31  1151FF        		LD	DE,DTA
  CF34                	S27:
  CF34  0E27          		LD	C,027H		;(BDOS)ランダム・ブロック・リード
  CF36  18E9          		JR	SYSTEM0
                      	
  CF38                	CEXE4:
  CF38  3ADB00        		LD	A,(FDRV)
  CF3B  325700        		LD	(00057H),A
  CF3E  2AE900        		LD	HL,(FDRV+14)
  CF41  225800        		LD	(00058H),HL
                      	
  CF44  21E400        		LD	HL,FNAME+8
  CF47  7E            		LD	A,(HL)
  CF48  FE20          		CP	020H
  CF4A  2007          		JR	NZ,CEXE7
  CF4C  3E3F          		LD	A,'?'
  CF4E  77            		LD	(HL),A
  CF4F  23            		INC	HL
  CF50  77            		LD	(HL),A
  CF51  23            		INC	HL
  CF52  77            		LD	(HL),A
  CF53                	CEXE7:
  CF53  CDEECE        		CALL	OPEN1
  CF56                	CEXE5:
  CF56  C0            		RET	NZ
  CF57  2A5BFF        		LD	HL,(DTA+1+9)
  CF5A  7C            		LD	A,H
  CF5B  CDDDDF        		CALL	CAP
  CF5E  67            		LD	H,A
  CF5F  7D            		LD	A,L
  CF60  CDDDDF        		CALL	CAP
  CF63  6F            		LD	L,A
  CF64  3A5AFF        		LD	A,(DTA+1+8)
  CF67  CDDDDF        		CALL	CAP
  CF6A  D642          		SUB	'B'
  CF6C  282E          		JR	Z,C_BAT
  CF6E  3D            		DEC	A		;'C'
  CF6F  2805          		JR	Z,C_EXE
  CF71                	CEXE6:
  CF71  CD01CF        		CALL	OPEN2
  CF74  18E0          		JR	CEXE5
                      	
  CF76                	C_EXE:
  CF76  7C            		LD	A,H
  CF77  FE4D          		CP	'M'
  CF79  20F6          		JR	NZ,CEXE6
                      	
  CF7B  CD05CF        		CALL	DEFCB
  CF7E  2A0600        		LD	HL,(SYSTEM+1)
  CF81  25            		DEC	H
  CF82  CD31CF        		CALL	S27DTA
  CF85  3D            		DEC	A
  CF86  37            		SCF
  CF87  C0            		RET	NZ
  CF88  7C            		LD	A,H
  CF89  B5            		OR	L
  CF8A  37            		SCF
  CF8B  C8            		RET	Z
  CF8C  CD1ACF        		CALL	SETDTA1
  CF8F  110000        	COMPAT:	LD	DE,0
  CF92  CDE5D1        		CALL	SETFCB
  CF95  AF            		XOR	A
  CF96  67            		LD	H,A
  CF97  6F            		LD	L,A	;HL=0x0000
  CF98  F9            		LD	SP,HL	;STACK=0
  CF99  E5            		PUSH	HL
  CF9A  24            		INC	H	;HL=0x0100
  CF9B  E9            		JP	(HL)
                      	
  CF9C                	C_BAT:
  CF9C  114154        		LD	DE,'A'+'T'*256
  CF9F  ED52          		SBC	HL,DE
  CFA1  20CE          		JR	NZ,CEXE6
                      	
  CFA3  F1            		POP	AF
  CFA4  F1            		POP	AF
  CFA5  CD05CF        		CALL	DEFCB
  CFA8  210002        		LD	HL,00200H
  CFAB  CD31CF        		CALL	S27DTA
  CFAE  C6FE          		ADD	A,0FEH
  CFB0  D8            		RET	C
  CFB1  7D            		LD	A,L
  CFB2  B7            		OR	A
  CFB3  37            		SCF
  CFB4  C8            		RET	Z
  CFB5  3C            		INC	A
  CFB6  F5            		PUSH	AF
                      	
  CFB7  CD99D7        		CALL	KEYBC
  CFBA  1E1A          		LD	E,01AH
  CFBC  CDCDEC        		CALL	_PRINT
  CFBF  C1            		POP	BC
  CFC0  210001        		LD	HL,00100H
  CFC3                	BAT1:
  CFC3  A7            		AND	A
  CFC4  05            		DEC	B
  CFC5  C8            		RET	Z
  CFC6  7E            		LD	A,(HL)
  CFC7  FE25          		CP	'%'
  CFC9  280C          		JR	Z,BAT2
  CFCB                	BAT1X:
  CFCB  7E            		LD	A,(HL)
  CFCC  23            		INC	HL
  CFCD  FE1A          		CP	01AH
  CFCF  C8            		RET	Z
  CFD0  FE0A          		CP	00AH
  CFD2  C47FD7        		CALL	NZ,KEYBS
  CFD5  18EC          		JR	BAT1
                      	
  CFD7                	BAT2:
  CFD7  23            		INC	HL
  CFD8  7E            		LD	A,(HL)
  CFD9  2B            		DEC	HL
  CFDA  D631          		SUB	'1'
  CFDC  38ED          		JR	C,BAT1X
  CFDE  FE09          		CP	9
  CFE0  30E9          		JR	NC,BAT1X
  CFE2  23            		INC	HL
  CFE3  23            		INC	HL
  CFE4  3C            		INC	A
  CFE5  4F            		LD	C,A
  CFE6  110000        	BATPAT:	LD	DE,0
  CFE9                	BAT3:
  CFE9  1A            		LD	A,(DE)
  CFEA  B7            		OR	A
  CFEB  28D6          		JR	Z,BAT1
  CFED  CDB7DD        		CALL	SPCUT
  CFF0  0D            		DEC	C
  CFF1  2808          		JR	Z,BAT5
  CFF3                	BAT4:
  CFF3  1A            		LD	A,(DE)
  CFF4  FE21          		CP	021H
  CFF6  38F1          		JR	C,BAT3
  CFF8  13            		INC	DE
  CFF9  18F8          		JR	BAT4
  CFFB                	BAT5:
  CFFB  1A            		LD	A,(DE)
  CFFC  FE21          		CP	021H
  CFFE  38C3          		JR	C,BAT1
  D000  13            		INC	DE
  D001  CD7FD7        		CALL	KEYBS
  D004  18F5          		JR	BAT5
                      	
  D006                	SWITCH:
  D006  1A            		LD	A,(DE)
  D007                	SW1:
  D007  13            		INC	DE
  D008  B9            		CP	C
  D009  1A            		LD	A,(DE)
  D00A  C8            		RET	Z
  D00B  FE20          		CP	020H
  D00D  30F8          		JR	NC,SW1
  D00F                	C_REM:
  D00F  AF            		XOR	A
  D010  C9            		RET
                      	
  D011                	C_DEL:
  D011  CDE5D1        		CALL	SETFCB
  D014  CDE6D7        		CALL	_SYS08		;(BDOS)エコーなしコンソール入力
                      	
  D017  0E13          		LD	C,013H
  D019  180A          		JR	CDEL1
                      	
  D01B                	C_REN:
  D01B  CDE5D1        		CALL	SETFCB
  D01E  3E10          		LD	A,010H		;ディレクトリも対象にする
  D020  326900        		LD	(FCB1+13),A	;属性
  D023  0E17          		LD	C,017H		;(BDOS)ファイル名の変更
  D025                	CDEL1:
  D025  115C00        		LD	DE,FCB1
  D028  CD0500        		CALL	SYSTEM
  D02B  C6FF          		ADD	A,0FFH
  D02D  C9            		RET
                      	
  D02E                	C_DIR:
  D02E  CDD2DC        		CALL	FILEC
  D031  21DC00        		LD	HL,FDRV+1
  D034  CD85D3        		CALL	CWILD1
  D037  3EF1          		LD	A,0F1H
  D039  32E800        		LD	(FDRV+13),A
  D03C  CDEECE        		CALL	OPEN1
  D03F                	CDIR1:
  D03F  B7            		OR	A
  D040  2008          		JR	NZ,PDSKF
  D042  CD8ED0        		CALL	P_NAME
  D045  CD01CF        		CALL	OPEN2
  D048  18F5          		JR	CDIR1
                      	
  D04A                	PDSKF:
  D04A  3ADB00        		LD	A,(FDRV)
  D04D  5F            		LD	E,A
  D04E  0E1B          		LD	C,01BH		;(BDOS)ディスク情報の獲得
  D050  CD0500        		CALL	SYSTEM
  D053  4F            		LD	C,A
  D054  C601          		ADD	A,001H
  D056  D8            		RET	C
  D057  AF            		XOR	A
  D058                	PDS1:
  D058  CB19          		RR	C
  D05A  3804          		JR	C,PDS2
  D05C  29            		ADD	HL,HL
  D05D  8F            		ADC	A,A
  D05E  18F8          		JR	PDS1
  D060                	PDS2:
  D060  CB50          		BIT	2,B
  D062  200A          		JR	NZ,PDSKF1
  D064  CB3F          		SRL	A
  D066  CB1C          		RR	H
  D068  CB1D          		RR	L
  D06A  CB10          		RL	B
  D06C  18F2          		JR	PDS2
  D06E                	PDSKF1:
  D06E  CD11D1        		CALL	PRDEC
  D071  11BBCD        		LD	DE,KBFREE
  D074  CDDAD3        		CALL	_SYS09		;(BDOS)文字列出力
  D077  CD03D1        		CALL	PUTDRV
  D07A  3E5C          		LD	A,05CH
  D07C  CDD0D7        		CALL	MSG_
  D07F  2AE900        		LD	HL,(FDRV+14)
  D082  7C            		LD	A,H
  D083  B5            		OR	L
  D084  284F          		JR	Z,LTNL
  D086  2B            		DEC	HL
  D087  7C            		LD	A,H
  D088  B5            		OR	L
  D089  C410D1        		CALL	NZ,PRDEC0
  D08C  1847          		JR	LTNL
                      	
  D08E                	P_NAME:
  D08E  3A52FF        		LD	A,(DTA+1)
  D091  FE2E          		CP	'.'
  D093  C8            		RET	Z
  D094  3E20          		LD	A,020H
  D096  CDD0D7        		CALL	MSG_
  D099  CDD0D7        		CALL	MSG_
  D09C  3E3A          		LD	A,':'
  D09E  CDD0D7        		CALL	MSG_
  D0A1  3A5DFF        		LD	A,(DTA+1+00BH)
  D0A4  F5            		PUSH	AF
  D0A5  0F            		RRCA
  D0A6  9F            		SBC	A,A
  D0A7  E60A          		AND	'*'-020H
  D0A9  C620          		ADD	A,020H
  D0AB  CDD0D7        		CALL	MSG_
  D0AE  CD03D1        		CALL	PUTDRV
  D0B1  2152FF        		LD	HL,DTA+1
  D0B4  CD52D1        		CALL	FPRNT
                      	
  D0B7  F1            		POP	AF
  D0B8  CB67          		BIT	4,A
  D0BA  2808          		JR	Z,DIR3
  D0BC  11C9CD        		LD	DE,DIRMES
  D0BF  CDDAD3        		CALL	_SYS09		;(BDOS)文字列出力
  D0C2  1809          		JR	DIR6
  D0C4                	DIR3:
  D0C4  3A70FF        		LD	A,(DTA+1+01EH)
  D0C7  2A6EFF        		LD	HL,(DTA+1+01CH)
  D0CA  CD11D1        		CALL	PRDEC
  D0CD                	DIR6:
  D0CD  3AB1EC        		LD	A,(CRTCD+1)
  D0D0  FE29          		CP	40+1
  D0D2  D474D1        		CALL	NC,PRTTMS
                      	
  D0D5                	LTNL:
  D0D5  1E0D          		LD	E,00DH
  D0D7  CDE3D7        		CALL	PRINTX
  D0DA  1E0A          		LD	E,00AH
  D0DC  C3E3D7        		JP	PRINTX
                      	
  D0DF                	C_PATH:
  D0DF  CDB7DD        		CALL	SPCUT
  D0E2  2172CD        		LD	HL,PATHD
  D0E5  FE21          		CP	021H
  D0E7  300E          		JR	NC,CPATH0
  D0E9  2B            		DEC	HL
  D0EA  2B            		DEC	HL
  D0EB                	CPATHP:
  D0EB  7E            		LD	A,(HL)
  D0EC  23            		INC	HL
  D0ED  FE20          		CP	020H
  D0EF  3F            		CCF
  D0F0  30E3          		JR	NC,LTNL
  D0F2  CDD0D7        		CALL	MSG_
  D0F5  18F4          		JR	CPATHP
  D0F7                	CPATH0:
  D0F7  FE3B          		CP	';'
  D0F9  2001          		JR	NZ,CPATH1
  D0FB  13            		INC	DE
  D0FC                	CPATH1:
  D0FC  EB            		EX	DE,HL
  D0FD  014000        		LD	BC,PATHX
  D100  EDB0          		LDIR
  D102  C9            		RET
                      	
  D103                	PUTDRV:
  D103  3ADB00        		LD	A,(FDRV)
  D106  C640          		ADD	A,'A'-1
  D108  CDD0D7        		CALL	MSG_
  D10B  3E3A          		LD	A,':'
  D10D                	MSGR:
  D10D  C3D0D7        		JP	MSG_
                      	
  D110                	PRDEC0:
  D110  AF            		XOR	A
  D111                	PRDEC:
  D111  5F            		LD	E,A
  D112  010000        		LD	BC,0
  D115  ED43D600      		LD	(DECBF),BC
  D119  ED43D800      		LD	(DECBF+2),BC
                      	
  D11D  0E18          		LD	C,24
  D11F                	DEC1:
  D11F  29            		ADD	HL,HL
  D120  7B            		LD	A,E
  D121  8F            		ADC	A,A
  D122  5F            		LD	E,A
  D123  E5            		PUSH	HL
  D124  21D900        		LD	HL,DECBF+3
  D127  0604          		LD	B,4
  D129                	DEC2:
  D129  7E            		LD	A,(HL)
  D12A  8F            		ADC	A,A
  D12B  27            		DAA
  D12C  77            		LD	(HL),A
  D12D  2B            		DEC	HL
  D12E  10F9          		DJNZ	DEC2
  D130  E1            		POP	HL
  D131  0D            		DEC	C
  D132  20EB          		JR	NZ,DEC1
                      	
  D134  21D600        		LD	HL,DECBF
  D137  3E20          		LD	A,020H
  D139  0603          		LD	B,3
  D13B                	DEC3:
  D13B  CD48D1        		CALL	DEC4
  D13E  CD48D1        		CALL	DEC4
  D141  23            		INC	HL
  D142  10F7          		DJNZ	DEC3
  D144                	DECX:
  D144  CD48D1        		CALL	DEC4
  D147  AF            		XOR	A
  D148                	DEC4:
  D148  ED6F          		RLD
  D14A  FE20          		CP	020H
  D14C  2802          		JR	Z,DEC5
  D14E  F630          		OR	030H
  D150                	DEC5:
  D150  18BB          		JR	MSGR
                      	
  D152                	FPRNT:
  D152  0608          		LD	B,8
  D154  CD65D1        		CALL	P_N1
  D157  7E            		LD	A,(HL)
  D158  C680          		ADD	A,0A0H-020H
  D15A  FEA0          		CP	0A0H
  D15C  2802          		JR	Z,FPR1
  D15E  3E2E          		LD	A,'.'
  D160                	FPR1:
  D160  CDD0D7        		CALL	MSG_
  D163  0603          		LD	B,3
                      	
  D165                	P_N1:
  D165  C5            		PUSH	BC
  D166  E5            		PUSH	HL
  D167  7E            		LD	A,(HL)
  D168  CDE9DF        		CALL	CAP3
  D16B  CDD0D7        		CALL	MSG_
  D16E  E1            		POP	HL
  D16F  C1            		POP	BC
  D170  23            		INC	HL
  D171  10F2          		DJNZ	P_N1
  D173  C9            		RET
                      	
  D174                	PRTTMS:
  D174  3E20          		LD	A,020H
  D176  CDD0D7        		CALL	MSG_
                      	
  D179  2A6AFF        		LD	HL,(DTA+1+24)
  D17C  7D            		LD	A,L
  D17D  B7            		OR	A
  D17E  C8            		RET	Z
  D17F  CB3C          		SRL	H
  D181  17            		RLA
  D182  17            		RLA
  D183  17            		RLA
  D184  17            		RLA
  D185  E60F          		AND	00FH
  D187  57            		LD	D,A
  D188  7C            		LD	A,H
  D189  C650          		ADD	A,80
  D18B  CDD0D1        		CALL	PRTA
  D18E  3E2D          		LD	A,'-'
  D190  CDD0D7        		CALL	MSG_
  D193  7A            		LD	A,D
  D194  CDD0D1        		CALL	PRTA
  D197  3E2D          		LD	A,'-'
  D199  CDD0D7        		CALL	MSG_
  D19C  7D            		LD	A,L
  D19D  E61F          		AND	01FH
  D19F  CDD0D1        		CALL	PRTA
                      	
  D1A2  2A68FF        		LD	HL,(DTA+1+22)
                      	
  D1A5  3E20          		LD	A,020H
  D1A7  CDD0D7        		CALL	MSG_
  D1AA  7C            		LD	A,H
  D1AB  65            		LD	H,L
  D1AC  1F            		RRA
  D1AD  CB1D          		RR	L
  D1AF  1F            		RRA
  D1B0  CB1D          		RR	L
  D1B2  1F            		RRA
  D1B3  CB1D          		RR	L
  D1B5  E61F          		AND	01FH
  D1B7  CDD0D1        		CALL	PRTA
  D1BA  3E3A          		LD	A,':'
  D1BC  CDD0D7        		CALL	MSG_
  D1BF  7D            		LD	A,L
  D1C0  0F            		RRCA
  D1C1  0F            		RRCA
  D1C2  E63F          		AND	03FH
  D1C4  CDD0D1        		CALL	PRTA
  D1C7  3E3A          		LD	A,':'
  D1C9  CDD0D7        		CALL	MSG_
  D1CC  7C            		LD	A,H
  D1CD  E61F          		AND	01FH
  D1CF  87            		ADD	A,A
                      	
                      	;	PRINT10
                      	
  D1D0                	PRTA:
  D1D0  E5            		PUSH	HL
  D1D1  0608          		LD	B,8
  D1D3  4F            		LD	C,A
  D1D4  AF            		XOR	A
  D1D5                	PRTA1:
  D1D5  CB01          		RLC	C
  D1D7  8F            		ADC	A,A
  D1D8  27            		DAA
  D1D9  10FA          		DJNZ	PRTA1
  D1DB  21D600        		LD	HL,DECBF
  D1DE  77            		LD	(HL),A
  D1DF  AF            		XOR	A
  D1E0  CD44D1        		CALL	DECX
  D1E3  E1            		POP	HL
  D1E4  C9            		RET
                      	
  D1E5                	SETFCB:
  D1E5  CDB7DD        		CALL	SPCUT
  D1E8  1A            		LD	A,(DE)
  D1E9  FE20          		CP	020H
  D1EB  3801          		JR	C,SETFCBA
  D1ED  1B            		DEC	DE
  D1EE                	SETFCBA:
  D1EE  D5            		PUSH	DE
  D1EF  215C00        		LD	HL,FCB1
  D1F2  115D00        		LD	DE,FCB1+1
  D1F5  012300        		LD	BC,00023H
  D1F8  70            		LD	(HL),B		;B=0
  D1F9  EDB0          		LDIR
  D1FB  D1            		POP	DE
  D1FC  D5            		PUSH	DE
  D1FD  215C00        		LD	HL,FCB1
  D200  CD51D6        		CALL	_SYS29		;(BDOS)ファイル名の解析
  D203  216C00        		LD	HL,FCB2
  D206  CD51D6        		CALL	_SYS29		;(BDOS)ファイル名の解析
  D209  E1            		POP	HL
  D20A  010050        		LD	BC,05000H
  D20D  118100        		LD	DE,00081H
  D210                	SETFCB1:
  D210  7E            		LD	A,(HL)
  D211  23            		INC	HL
  D212  FE20          		CP	020H
  D214  3805          		JR	C,SETFCB2
  D216  12            		LD	(DE),A
  D217  13            		INC	DE
  D218  0C            		INC	C
  D219  10F5          		DJNZ	SETFCB1
  D21B                	SETFCB2:
  D21B  79            		LD	A,C
  D21C  328000        		LD	(DTA1),A
  D21F  04            		INC	B
  D220  AF            		XOR	A
  D221                	SETFCB3:
  D221  12            		LD	(DE),A
  D222  13            		INC	DE
  D223  10FC          		DJNZ	SETFCB3
  D225  C9            		RET
                      	
  D226                	C_COPY:
  D226  CDE5D1        		CALL	SETFCB
  D229  118100        		LD	DE,DTA1+1
  D22C  0E2F          		LD	C,'/'
  D22E  CD06D0        		CALL	SWITCH
  D231  CDDDDF        		CALL	CAP
  D234  32BCD2        		LD	(SW+1),A
                      	
  D237  11E4EB        		LD	DE,BEEPD
  D23A  CDD5DC        		CALL	FILEC2
  D23D  216C00        		LD	HL,FCB2
  D240  CD58D6        		CALL	S29X1
                      	
  D243  3E10          		LD	A,010H
  D245  326900        		LD	(FCB1+13),A
  D248  216D00        		LD	HL,FCB2+1
  D24B  CD85D3        		CALL	CWILD1
  D24E                	COPY0:
  D24E  CD82D3        		CALL	CWILD
  D251  215C00        		LD	HL,FCB1
  D254  CDF1CE        		CALL	OPEN
  D257  37            		SCF
  D258                	COPY1:
  D258  C0            		RET	NZ
  D259  CD05CF        		CALL	DEFCB
                      	
  D25C  3A5EFF        		LD	A,(DTA+13)
  D25F  CB67          		BIT	4,A
  D261  2824          		JR	Z,COPY1A
                      	
  D263  215D00        		LD	HL,FCB1+1
  D266  CD06E1        		CALL	CHKWILD
  D269  3817          		JR	C,COPY9
                      	
  D26B  3E20          		LD	A,020H
  D26D  325D00        		LD	(FCB1+1),A
  D270  2A6BFF        		LD	HL,(DTA+26)
  D273  23            		INC	HL
  D274  226A00        		LD	(FCB1+14),HL
  D277  18D5          		JR	COPY0
                      	
  D279                	COPYS:
  D279  11B6CD        		LD	DE,SKIP
  D27C                	COPY8:
  D27C  CDDAD3        		CALL	_SYS09		;(BDOS)文字列出力
  D27F  CDD5D0        		CALL	LTNL
  D282                	COPY9:
  D282  CD01CF        		CALL	OPEN2
  D285  18D1          		JR	COPY1
                      	
  D287                	COPY1A:
  D287  216C00        		LD	HL,FCB2
  D28A  11DB00        		LD	DE,FDRV
  D28D  0153FF        		LD	BC,DTA+2
  D290  EDA0          		LDI
  D292  3E0B          		LD	A,11
  D294                	COPY2:
  D294  F5            		PUSH	AF
  D295  7E            		LD	A,(HL)
  D296  FE3F          		CP	'?'
  D298  2001          		JR	NZ,COPY3
  D29A  0A            		LD	A,(BC)
  D29B                	COPY3:
  D29B  12            		LD	(DE),A
  D29C  03            		INC	BC
  D29D  13            		INC	DE
  D29E  23            		INC	HL
  D29F  F1            		POP	AF
  D2A0  3D            		DEC	A
  D2A1  20F1          		JR	NZ,COPY2
  D2A3  010500        		LD	BC,16-11
  D2A6  EDB0          		LDIR
  D2A8                	PUTNAME:
  D2A8  215D00        		LD	HL,FCB1+1
  D2AB  CD06E1        		CALL	CHKWILD
  D2AE  300B          		JR	NC,PUTN1
  D2B0  21DC00        		LD	HL,FDRV+1
  D2B3  CD52D1        		CALL	FPRNT
  D2B6  3E20          		LD	A,020H
  D2B8  CDD0D7        		CALL	MSG_
  D2BB                	PUTN1:
  D2BB  3E00          	SW:	LD	A,000H
  D2BD  FE54          		CP	'T'
  D2BF  2005          		JR	NZ,CSW1
  D2C1  21DBD2        		LD	HL,SWNE
  D2C4  1807          		JR	SWT1
  D2C6                	CSW1:
  D2C6  FE4E          		CP	'N'
  D2C8  2011          		JR	NZ,SWNE
  D2CA  2179D2        		LD	HL,COPYS
  D2CD                	SWT1:
  D2CD  11DB00        		LD	DE,FDRV
  D2D0  CD1FCF        		CALL	SYSC0F
  D2D3  2801          		JR	Z,SWN1
  D2D5  E9            		JP	(HL)
  D2D6                	SWN1:
  D2D6  CD34D3        		CALL	CTIME
  D2D9  309E          		JR	NC,COPYS
  D2DB                	SWNE:
  D2DB  11DB00        		LD	DE,FDRV
  D2DE  0E16          		LD	C,016H		;(BDOS)ファイルの作成
  D2E0  CD21CF        		CALL	SYSTEM0
  D2E3  204D          		JR	NZ,COPYE2
  D2E5  67            		LD	H,A		;A=0
  D2E6  6F            		LD	L,A
  D2E7  22FC00        		LD	(FDRV+33),HL
  D2EA  22FE00        		LD	(FDRV+35),HL
  D2ED                	COPY6:
  D2ED  CD94D3        		CALL	BUFSIZ
  D2F0  CD31CF        		CALL	S27DTA
  D2F3  47            		LD	B,A
  D2F4  3C            		INC	A
  D2F5  2833          		JR	Z,COPYE
  D2F7  7C            		LD	A,H
  D2F8  B5            		OR	L
  D2F9  280E          		JR	Z,COPY7
  D2FB  11DB00        		LD	DE,FDRV
  D2FE  0E26          		LD	C,026H		;(BDOS)ランダム・ブロック・ライト
  D300  CD0500        		CALL	SYSTEM
  D303  B7            		OR	A
  D304  2024          		JR	NZ,COPYE
  D306  05            		DEC	B
  D307  20E4          		JR	NZ,COPY6
  D309                	COPY7:
  D309  3A5EFF        		LD	A,(DTA+13)
  D30C  32E800        		LD	(FDRV+13),A
  D30F  2165FF        		LD	HL,DTA+20
  D312  11EF00        		LD	DE,FDRV+20
  D315  010400        		LD	BC,4
  D318  EDB0          		LDIR
                      	
  D31A  11DB00        		LD	DE,FDRV
  D31D  0E10          		LD	C,010H		;(BDOS)ファイルのクローズ
  D31F  CD21CF        		CALL	SYSTEM0
  D322  2006          		JR	NZ,COPYE
                      	
  D324  11B3CD        		LD	DE,OK
  D327  C37CD2        		JP	COPY8
                      	
  D32A                	COPYE:
  D32A  11DB00        		LD	DE,FDRV
  D32D  0E13          		LD	C,013H		;(BDOS)ファイルの削除
  D32F  CD0500        		CALL	SYSTEM
  D332                	COPYE2:
  D332  37            		SCF
  D333  C9            		RET
                      	
  D334                	CTIME:
  D334  ED5B65FF      		LD	DE,(DTA+20)
  D338  2AEF00        		LD	HL,(FDRV+20)
  D33B  A7            		AND	A
  D33C  ED52          		SBC	HL,DE
  D33E  C0            		RET	NZ
  D33F  ED5B67FF      		LD	DE,(DTA+22)
  D343  2AF100        		LD	HL,(FDRV+22)
  D346  ED52          		SBC	HL,DE
  D348  C9            		RET
                      	
  D349                	C_TYPE:
  D349  CDE5D1        		CALL	SETFCB
  D34C  215C00        		LD	HL,FCB1
  D34F  CDF1CE        		CALL	OPEN
  D352  37            		SCF
  D353                	TYPE1:
  D353  C0            		RET	NZ
  D354  CD05CF        		CALL	DEFCB
  D357  1E1A          		LD	E,01AH
  D359  CDCDEC        		CALL	_PRINT
  D35C                	TYPE2:
  D35C  CD94D3        		CALL	BUFSIZ
  D35F  CD31CF        		CALL	S27DTA
  D362  C6FE          		ADD	A,0FEH
  D364  D8            		RET	C
  D365  7C            		LD	A,H
  D366  B5            		OR	L
  D367  2814          		JR	Z,TYPEE
  D369  010001        		LD	BC,00100H
  D36C                	TYPE3:
  D36C  0A            		LD	A,(BC)
  D36D  03            		INC	BC
  D36E  FE1A          		CP	01AH
  D370  280B          		JR	Z,TYPEE
  D372  5F            		LD	E,A
  D373  CDD9D7        		CALL	_SYS02		;(BDOS)コンソール出力
  D376  2B            		DEC	HL
  D377  7C            		LD	A,H
  D378  B5            		OR	L
  D379  20F1          		JR	NZ,TYPE3
  D37B  18DF          		JR	TYPE2
  D37D                	TYPEE:
  D37D  CD01CF        		CALL	OPEN2
  D380  18D1          		JR	TYPE1
                      	
  D382                	CWILD:
  D382  215D00        		LD	HL,FCB1+1
  D385                	CWILD1:
  D385  7E            		LD	A,(HL)
  D386  FE20          		CP	020H
  D388  C0            		RET	NZ
  D389                	CWILD2:
  D389  54            		LD	D,H
  D38A  5D            		LD	E,L
  D38B  13            		INC	DE
  D38C  010A00        		LD	BC,10
  D38F  363F          		LD	(HL),'?'
  D391  EDB0          		LDIR
  D393  C9            		RET
                      	
  D394                	BUFSIZ:
  D394  3A0700        		LD	A,(SYSTEM+2)
  D397  D603          		SUB	3
  D399  E6F8          		AND	0F8H
  D39B  67            		LD	H,A
  D39C  2E00          		LD	L,0
  D39E  C9            		RET
                      	
                      	
                      	;LDOS.ASM
                      	
                      	;	LSX-Dodgers OS
                      	
  D39F                	BOOT:
  D39F  C30000        		JP	0
  D3A2                	_SYS00:		;(BDOS)プログラム終了
  D3A2                	WBOOT:
  D3A2  C310CE        		JP	WBOOT1
  D3A5                	CONST_:
  D3A5  C353D8        		JP	CONSTX
  D3A8                	_SYS07:		;(BDOS)コンソール直接入力
  D3A8                	CONIN:
  D3A8  C3FAD7        		JP	FLGET
  D3AB                	CONOUT:
  D3AB  C3ABDA        		JP	CONOUT1
                      	
  D3AE                	BDOS0:
  D3AE  E5            		PUSH	HL
  D3AF  210001        		LD	HL,00100H
  D3B2  39            		ADD	HL,SP
  D3B3  3810          		JR	C,BDOS1X	;EXTSP = 0FFD4H
  D3B5                	BDOS2:
  D3B5  E1            		POP	HL
  D3B6  ED73C1D3      		LD	(BDSP+1),SP
  D3BA  31D4FF        		LD	SP,EXTSP
  D3BD  CDC4D3        		CALL	BDOS1
  D3C0  310000        	BDSP:	LD	SP,0
  D3C3  C9            		RET
  D3C4                	BDOS1:
  D3C4  E5            		PUSH	HL
  D3C5                	BDOS1X:
  D3C5  79            		LD	A,C
  D3C6  FE31          		CP	031H
  D3C8  300A          		JR	NC,OVERFN
  D3CA  87            		ADD	A,A
  D3CB  6F            		LD	L,A
  D3CC  26EC          		LD	H,STABLE/256
  D3CE  7E            		LD	A,(HL)
  D3CF  2C            		INC	L
  D3D0  66            		LD	H,(HL)
  D3D1  6F            		LD	L,A
  D3D2  E3            		EX	(SP),HL
  D3D3  C9            		RET
  D3D4                	OVERFN
  D3D4  E1            		POP	HL
  D3D5                	_ERROR:
  D3D5                	_SYS2B:		;(BDOS)日付の設定
  D3D5                	_SYS2D:		;(BDOS)時刻の設定
  D3D5  37            		SCF			;CF=1
  D3D6  9F            		SBC	A,A		;A=0FFH
  D3D7  C9            		RET
  D3D8                	_SYS1C:		;(BDOS)ディスクの書き込み禁止化
  D3D8                	_SYS1E:		;(BDOS)ファイル属性の設定
  D3D8                	_SYS20:		;(BDOS)利用者番号の設定と読み出し
  D3D8                	_SYS2E:		;(BDOS)ベリファイ・フラグの設定
  D3D8  AF            		XOR	A
  D3D9  C9            		RET
                      	
  D3DA                	_SYS09:		;文字列出力
  D3DA  D5            		PUSH	DE
  D3DB                	_SX09:
  D3DB  1A            		LD	A,(DE)
  D3DC  13            		INC	DE
  D3DD  FE24          		CP	'$'
  D3DF  282C          		JR	Z,SX0E2
  D3E1  D5            		PUSH	DE
  D3E2  5F            		LD	E,A
  D3E3  CDD9D7        		CALL	_SYS02
  D3E6  D1            		POP	DE
  D3E7  18F2          		JR	_SX09
                      	
  D3E9                	_SYS0C:		;(BDOS)バージョン番号の獲得
  D3E9  212200        		LD	HL,00022H
  D3EC  AF            		XOR	A
  D3ED  7D            		LD	A,L
  D3EE  C9            		RET
                      	
  D3EF                	_SYS0D:		;(BDOS)ディスク・リセット
  D3EF  CDDFEC        		CALL	_FFLUSH
  D3F2  E5            		PUSH	HL
  D3F3  218000        		LD	HL,00080H
  D3F6  228AEC        		LD	(_DTA),HL
  D3F9  E1            		POP	HL
  D3FA  D5            		PUSH	DE
  D3FB  1E00          		LD	E,0
  D3FD  3E            		DB	03EH
                      	
  D3FE                	_SYS0E:		;(BDOS)カレント・ドライブの設定
  D3FE  D5            		PUSH	DE
  D3FF  7B            		LD	A,E
  D400  DDE5          		PUSH	IX
  D402  CDDCEC        		CALL	_GETDPB
  D405  DDE1          		POP	IX
  D407  3804          		JR	C,SX0E2
  D409  7B            		LD	A,E
  D40A  3287EC        		LD	(_DVSW),A
  D40D                	SX0E2:
  D40D  3E08          		LD	A,8
  D40F  D1            		POP	DE
  D410  C9            		RET
                      	
  D411                	_SYS0F:		;(BDOS)ファイルのオープン
  D411  CDC9DD        		CALL	SETDRV
  D414  FD7E1C        		LD	A,(IY+28)	;(FCB)オープン・モード
  D417  C602          		ADD	A,002H		;Write
  D419  2848          		JR	Z,FEND0F
  D41B  CD02E1        		CALL	CHKWILDX
                      	
  D41E  D4E9DD        		CALL	NC,SOPENX
  D421                	_S16XX:
  D421  3840          		JR	C,FEND0F
                      					;Directory location
  D423  3A9FEC        		LD	A,(_FILEN)
  D426  FD7719        		LD	(IY+25),A	;(FCB)ディレクトリ・ロケーション
                      	;				_DIRF
  D429  3AA0EC        		LD	A,(_DIRF)
  D42C  FD771D        		LD	(IY+29),A	;(FCB)ディレクトリ・モード
                      	;				_FBPS
  D42F  FD731E        		LD	(IY+30),E	;(FCB)ディレクトリ・ポジション
  D432  FD721F        		LD	(IY+31),D
                      	;				Open(Read)
  D435  FD361CFF      		LD	(IY+28),0FFH	;(FCB)オープン・モード
                      	;				FILENAME
  D439  FDE5          		PUSH	IY
  D43B  D1            		POP	DE
  D43C  13            		INC	DE
  D43D  010B00        		LD	BC,11
  D440  EDB0          		LDIR
                      	;				Attribute
  D442  7E            		LD	A,(HL)
  D443  FD770D        		LD	(IY+13),A	;(FCB)属性(アトリビュート)
  D446  110B00        		LD	DE,11		;Reserved
  D449  19            		ADD	HL,DE
                      						;(FCB)ファイルを最後に変更した時刻
  D44A  11DAEB        		LD	DE,SDDATA		;(FCB)ファイルを最後に変更した日付
  D44D  060A          		LD	B,SDDATAE-SDDATA	;(FCB)ファイルの先頭クラスタ
  D44F                	S16LOOP:				;(FCB)ファイルのサイズ(バイト単位)
  D44F  1A            		LD	A,(DE)
  D450  13            		INC	DE
  D451  3258D4        		LD	(S16PAT+2),A
  D454  7E            		LD	A,(HL)
  D455  23            		INC	HL
  D456  FD7700        	S16PAT:	LD	(IY+0),A
  D459  10F4          		DJNZ	S16LOOP
                      	
  D45B  AF            		XOR	A
  D45C  FD770C        		LD	(IY+12),A	;(FCB)カレント・ブロック
  D45F  FD2221D5      		LD	(OFCB+1),IY
  D463                	FEND0F:
  D463  C308D5        		JP	FEND
                      	
  D466                	_SYS10:		;(BDOS)ファイルのクローズ
  D466  CDC9DD        		CALL	SETDRV
  D469  FD7E1C        		LD	A,(IY+28)	;(FCB)オープン・モード
  D46C  D6FE          		SUB	0FEH
  D46E  37            		SCF
  D46F  3F            		CCF
  D470  2032          		JR	NZ,FEND10
  D472                	_S10A:				;Write
  D472  FD770E        		LD	(IY+14),A	;(FCB)レコード・サイズ/アクセスするディレクトリのクラスタ番号+1
  D475  FD770F        		LD	(IY+15),A
                      	
  D478  FD341C        		INC	(IY+28)		;0FEH->0FFH ;オープン・モード
  D47B  CDFBE1        		CALL	SETTMS
                      	
  D47E  FD7E1D        		LD	A,(IY+29)	;(FCB)ディレクトリ・モード
  D481  32A0EC        		LD	(_DIRF),A
  D484  FD5E1E        		LD	E,(IY+30)	;(FCB)ディレクトリ・ポジション
  D487  FD561F        		LD	D,(IY+31)
  D48A  CD1CDF        		CALL	DC
  D48D  3879          		JR	C,FEND
                      	
  D48F  FD7E19        		LD	A,(IY+25)	;(FCB)ディレクトリ・ロケーション
  D492  E61F          	SDECM1:	AND	01FH		;自己書き換え(1セクタ辺りのディレクトリエントリ数-1) 1024=01FH / 512=00FH / 256=7
  D494  6F            		LD	L,A
  D495  2600          		LD	H,0
  D497  29            		ADD	HL,HL		;*2
  D498  29            		ADD	HL,HL		;*4
  D499  29            		ADD	HL,HL		;*8
  D49A  29            		ADD	HL,HL		;*16
  D49B  29            		ADD	HL,HL		;*32
  D49C  ED4B7EEC      		LD	BC,(_DTBUF)
  D4A0  09            		ADD	HL,BC
                      	
  D4A1  CD12E1        		CALL	SDIRENT
  D4A4                	FEND10:
  D4A4  1862          		JR	FEND
                      	
  D4A6                	OPENDD:
  D4A6  FD361CFD      		LD	(IY+28),0FDH	;(FCB)オープン・モード
  D4AA  FD360D20      		LD	(IY+13),020H	;(FCB)属性(アトリビュート)
  D4AE  CD00E2        		CALL	SETTMSX
  D4B1  1855          		JR	FEND
                      	
  D4B3                	_SYS11:		;(BDOS)最初のファイルの検索
  D4B3  CDC9DD        		CALL	SETDRV
  D4B6  CD63DF        		CALL	CHKDDX
  D4B9  3818          		JR	C,_S11A
  D4BB  FDE5          		PUSH	IY
  D4BD  E1            		POP	HL
  D4BE  ED5B8AEC      		LD	DE,(_DTA)
  D4C2  010C00        		LD	BC,12
  D4C5  EDB0          		LDIR
  D4C7  3E20          		LD	A,020H
  D4C9  12            		LD	(DE),A
  D4CA  13            		INC	DE
  D4CB  62            		LD	H,D
  D4CC  6B            		LD	L,E
  D4CD  13            		INC	DE
  D4CE  0E13          		LD	C,19
  D4D0  70            		LD	(HL),B
  D4D1  1833          		JR	_S11B
  D4D3                	_S11A:
  D4D3  CD1DDE        		CALL	SOPEN
  D4D6                	_S12X1:
  D4D6  3830          		JR	C,FEND
  D4D8  CDBBDE        		CALL	SOPENE2
  D4DB  ED5B8AEC      		LD	DE,(_DTA)
  D4DF  3A88EC        		LD	A,(_DRV)
  D4E2  3C            		INC	A
  D4E3  12            		LD	(DE),A
  D4E4  D5            		PUSH	DE
  D4E5  13            		INC	DE
  D4E6  012000        		LD	BC,32
  D4E9  EDB0          		LDIR
  D4EB  FD6E0E        		LD	L,(IY+14)	;(FCB)レコード・サイズ/アクセスするディレクトリのクラスタ番号+1
  D4EE  FD660F        		LD	H,(IY+15)
  D4F1  22F4EB        		LD	(SCDIR),HL
  D4F4  2A9AEC        		LD	HL,(_FBPS)
  D4F7  22F6EB        		LD	(SFBPS),HL
  D4FA  2A9FEC        		LD	HL,(_FILEN)
  D4FD  22F8EB        		LD	(SFNDF),HL	;Directory position and Flags
  D500  E1            		POP	HL
  D501  11A6E2        		LD	DE,SFILE
  D504  0E21          		LD	C,33
  D506                	_S11B:
  D506  EDB0          		LDIR
  D508                	FEND:
  D508  9F            		SBC	A,A		;CF=0 A=0 : CF=1 A=0FFH
  D509                	FENDE:
  D509  FDE1          		POP	IY
  D50B  C1            		POP	BC
  D50C  D1            		POP	DE
  D50D  E1            		POP	HL
  D50E  C9            		RET
                      	
  D50F                	_SYS12:		;(BDOS)次のファイルの検索
  D50F  E5            		PUSH	HL
  D510  D5            		PUSH	DE
  D511  C5            		PUSH	BC
  D512  FDE5          		PUSH	IY
  D514  CD85DE        		CALL	NOPEN
  D517  18BD          		JR	_S12X1
                      	
  D519                	_S16K:
  D519  FD7E1C        		LD	A,(IY+28)	;(FCB)オープン・モード
  D51C  FEFD          		CP	0FDH		;Device(0FDH)
  D51E  37            		SCF
  D51F  C8            		RET	Z
                      	
  D520  110000        	OFCB:	LD	DE,0
  D523  D5            		PUSH	DE
  D524  061A          		LD	B,26		;First cluster
  D526                	S16K1:
  D526  13            		INC	DE
  D527  23            		INC	HL
  D528  10FC          		DJNZ	S16K1
                      	
  D52A  1A            		LD	A,(DE)
  D52B  BE            		CP	(HL)
  D52C  2013          		JR	NZ,S16K2
  D52E  13            		INC	DE
  D52F  23            		INC	HL
  D530  1A            		LD	A,(DE)
  D531  BE            		CP	(HL)
  D532  200D          		JR	NZ,S16K2
                      	
  D534  E1            		POP	HL
  D535  FDE5          		PUSH	IY
  D537  D1            		POP	DE
  D538  1A            		LD	A,(DE)		;Drive
  D539  BE            		CP	(HL)
  D53A  2005          		JR	NZ,S16K2
                      					;ここはCFが必ず0
  D53C  ED52          		SBC	HL,DE		;CP HL,DE
  D53E  37            		SCF
  D53F  C0            		RET	NZ
  D540  E5            		PUSH	HL
  D541                	S16K2:
  D541  E1            		POP	HL
  D542  FDE5          		PUSH	IY
  D544  D1            		POP	DE
  D545                	_SYS13:		;(BDOS)ファイルの削除
  D545  CDC9DD        		CALL	SETDRV
  D548  CD2CE0        		CALL	KILL
  D54B                	FEND13:
  D54B  18BB          		JR	FEND
                      	
  D54D                	_SYS14:		;(BDOS)シーケンシャルな読み出し
  D54D  CDC9DD        		CALL	SETDRV
  D550  CD2DE2        		CALL	PUSHRR
  D553  CD6EE2        		CALL	GETSEQ
                      	
  D556  CD82E2        		CALL	RB_READ
  D559  E5            		PUSH	HL
  D55A  CD41E2        		CALL	SETSEQ
  D55D                	SREAD:
  D55D  E1            		POP	HL
                      	
  D55E  C601          		ADD	A,001H
  D560  38A6          		JR	C,FEND
                      	
  D562  7D            		LD	A,L
  D563  D601          		SUB	001H
  D565                	FENDX:
  D565  9F            		SBC	A,A
  D566  E603          		AND	3
  D568  1F            		RRA
  D569  189E          		JR	FENDE
                      	
  D56B                	_SYS15:		;(BDOS)シーケンシャルな書き込み
  D56B  CDC9DD        		CALL	SETDRV
  D56E  CD2DE2        		CALL	PUSHRR
  D571  CD6EE2        		CALL	GETSEQ
                      	
  D574  CD7BE2        		CALL	RB_WRITE
  D577  E5            		PUSH	HL
  D578  CD41E2        		CALL	SETSEQ
  D57B                	SWRITE:
  D57B  E1            		POP	HL
                      	
  D57C  C6FF          		ADD	A,0FFH
  D57E  18E5          		JR	FENDX
                      	
  D580                	_SYS17:		;(BDOS)ファイル名の変更
  D580  CDC9DD        		CALL	SETDRV
  D583  CD88E0        		CALL	NAME
  D586  18C3          		JR	FEND13
                      	
  D588                	_SYS16:		;(BDOS)ファイルの作成
  D588  CDC9DD        		CALL	SETDRV
                      	
  D58B  CD02E1        		CALL	CHKWILDX
  D58E  38BB          		JR	C,FEND13
  D590  FD7E01        		LD	A,(IY+1)	;(FCB)主ファイル名
  D593  FE05          		CP	5
  D595  2805          		JR	Z,_S16X2
  D597  FE21          		CP	021H
  D599  DA4BD5        		JP	C,FEND13
  D59C                	_S16X2:
                      	;				Clear FCB
  D59C  FDE5          		PUSH	IY
  D59E  E1            		POP	HL
  D59F  011000        		LD	BC,16
  D5A2  09            		ADD	HL,BC
  D5A3                	_S16X1:
  D5A3  70            		LD	(HL),B		;B=0
  D5A4  23            		INC	HL
  D5A5  0D            		DEC	C
  D5A6  20FB          		JR	NZ,_S16X1
                      	
  D5A8  CD00E2        		CALL	SETTMSX
  D5AB  FD360DFF      		LD	(IY+13),0FFH	;(FCB)Attribute
  D5AF  CDE9DD        		CALL	SOPENX
  D5B2  3F            		CCF
  D5B3  CC19D5        		CALL	Z,_S16K
  D5B6  D4CCDE        		CALL	NC,COPEN
  D5B9  D412E1        		CALL	NC,SDIRENT
  D5BC  C321D4        		JP	_S16XX
                      	
  D5BF                	_SYS21:		;(BDOS)ランダムな読み出し
                      	
  D5BF  CDC9DD        		CALL	SETDRV
  D5C2  CD2DE2        		CALL	PUSHRR
  D5C5  FD6E21        		LD	L,(IY+33)	;(FCB)Random record
  D5C8  FD6622        		LD	H,(IY+34)
                      	
  D5CB  CD82E2        		CALL	RB_READ
  D5CE  E5            		PUSH	HL
  D5CF  CD58E2        		CALL	POPRR
  D5D2  1889          		JR	SREAD
                      	
  D5D4                	_SYS22:		;(BDOS)ランダムな書き込み
  D5D4                	_SYS28:		;(BDOS)ランダムな書き込み・その2
  D5D4  CDC9DD        		CALL	SETDRV
  D5D7  CD2DE2        		CALL	PUSHRR
  D5DA  FD6E21        		LD	L,(IY+33)	;(FCB)Random record
  D5DD  FD6622        		LD	H,(IY+34)
                      	
  D5E0  CD7BE2        		CALL	RB_WRITE
  D5E3  E5            		PUSH	HL
  D5E4  CD58E2        		CALL	POPRR
  D5E7  1892          		JR	SWRITE
                      	
  D5E9                	_SYS18:		;(BDOS)ログイン・ベクトルの獲得
  D5E9  21FF00        		LD	HL,000FFH
  D5EC  AF            		XOR	A
  D5ED  C9            		RET
                      	
  D5EE                	_SYS19:		;(BDOS)カレント・ドライブ番号の獲得
  D5EE  3A87EC        		LD	A,(_DVSW)
  D5F1  A7            		AND	A
  D5F2  C9            		RET
                      	
  D5F3                	_SYS1A:		;(BDOS)DTAの設定
  D5F3  ED538AEC      		LD	(_DTA),DE
  D5F7  AF            		XOR	A
  D5F8  C9            		RET
                      	
  D5F9                	_SYS1B:		;(BDOS)ディスク情報の獲得
  D5F9  7B            		LD	A,E
  D5FA  CDDCDD        		CALL	GETDRV
  D5FD  CDDCEC        		CALL	_GETDPB
  D600  D4E2EC        		CALL	NC,_RDFATX
  D603  210000        		LD	HL,0
  D606  D4E0E1        		CALL	NC,DSKF
                      	
  D609  ED5BE1E1      		LD	DE,(MAXCLP+1)	;DPB_08_MAXCL-1
  D60D  1B            		DEC	DE		;DE←クラスタの総数
  D60E  FD2A7CEC      		LD	IY,(_FATBF)	;IY←メモリ上のFATの先頭アドレス
  D612  9F            		SBC	A,A
  D613  D8            		RET	C
  D614  4F            		LD	C,A		;C=0
  D615  DD460F        		LD	B,(IX+00FH)	;DPB_0F_BPS
  D618  CBB8          		RES	7,B
  D61A  DD7E07        		LD	A,(IX+7)	;DPB_07_SECPCL
  D61D  C9            		RET
                      	
  D61E                	_SYS1D:		;(BDOS)書き込みが禁止されているディスクの調査
  D61E  AF            		XOR	A
  D61F  67            		LD	H,A
  D620  6F            		LD	L,A
  D621  C9            		RET
                      	
  D622                	_SYS1F:		;(BDOS)ディスク装置のパラメータの読み出し
  D622  2100ED        		LD	HL,DEVICE
  D625  7B            		LD	A,E
  D626  C3DCEC        		JP	_GETDPB
                      	
  D629                	_SYS23:		;(BDOS)ファイル・サイズの獲得
  D629  E5            		PUSH	HL
  D62A  2A1EEC        		LD	HL,(STABLE+2*00FH)	;ファイルのオープン
  D62D  CD0F00        		CALL	JP_HL
  D630  3814          		JR	C,_S23X1
                      	
  D632  D5            		PUSH	DE		;EX DE,IY
  D633  FDE3          		EX	(SP),IY		;
                      	;	POP	DE		;
                      	;	PUSH	DE		;DEを破壊しないように注意vv
  D635  CD5EE2        		CALL	GETSIZE
  D638                	_S24X1:
  D638  FD7521        		LD	(IY+33),L	;(FCB)Random record
  D63B  FD7422        		LD	(IY+34),H
  D63E  FD362300      		LD	(IY+35),0
                      	;	POP	DE		;^^^^^^^^^^^^^^^^^^^^^^^^
                      	;	PUSH	DE		;EX DE,IY
  D642  FDE3          		EX	(SP),IY		;
  D644  D1            		POP	DE		;
                      	
  D645  AF            		XOR	A
  D646                	_S23X1:
  D646  E1            		POP	HL
  D647  C9            		RET
                      	
  D648                	_SYS24:		;(BDOS)ランダム・レコード・フィールドの設定
  D648  E5            		PUSH	HL
  D649  D5            		PUSH	DE		;EX DE,IY
  D64A  FDE3          		EX	(SP),IY		;
                      	;	POP	DE		;
                      	;	PUSH	DE		;DEを破壊しないように注意vv
  D64C  CD6EE2        		CALL	GETSEQ
  D64F  18E7          		JR	_S24X1		;^^^^^^^^^^^^^^^^^^^^^^^^
                      	
  D651                	_SYS29:		;(BDOS)ファイル名の解析
  D651  C5            		PUSH	BC
  D652  E5            		PUSH	HL
  D653  CDDDDC        		CALL	FILE
  D656  E1            		POP	HL
  D657  C1            		POP	BC
  D658                	S29X1:
  D658  C5            		PUSH	BC
  D659  D5            		PUSH	DE
  D65A  E5            		PUSH	HL
  D65B  EB            		EX	DE,HL
  D65C  21DB00        		LD	HL,FDRV
  D65F  010D00        		LD	BC,13
  D662  EDB0          		LDIR
  D664  70            		LD	(HL),B
  D665  0E03          		LD	C,3
  D667  EDB0          		LDIR
  D669  E1            		POP	HL
  D66A  D1            		POP	DE
  D66B  C1            		POP	BC
  D66C  AF            		XOR	A
  D66D  C9            		RET
                      	
  D66E                	_SYS30:		;(BDOS)論理セクタを用いた書き込み
  D66E  C5            		PUSH	BC
  D66F  011BE8        		LD	BC,DWT_DPB
  D672  1804          		JR	S2FX
  D674                	_SYS2F:
  D674  C5            		PUSH	BC
  D675  01CBE7        		LD	BC,DRD_DPB
  D678                	S2FX:
  D678  ED438DD6      		LD	(S2FPAT+1),BC
  D67C  CDDFEC        		CALL	_FFLUSH
                      	
  D67F  D5            		PUSH	DE
  D680  E5            		PUSH	HL
  D681  7D            		LD	A,L		;Drive
  D682  CDD9EC        		CALL	_CHGDRV
  D685  380D          		JR	C,S30X2
  D687  44            		LD	B,H		;Number of clusters
  D688  2A8AEC        		LD	HL,(_DTA)
  D68B                	S30X:
  D68B  C5            		PUSH	BC
  D68C  CDCBE7        	S2FPAT:	CALL	DRD_DPB
  D68F  C1            		POP	BC
  D690  3802          		JR	C,S30X2
  D692  10F7          		DJNZ	S30X
  D694                	S30X2:
  D694  E1            		POP	HL
  D695  D1            		POP	DE
  D696  C1            		POP	BC
  D697  9F            		SBC	A,A
  D698  C9            		RET
                      	
                      	;LDIO.ASM
                      	
                      	;	LSX-Dodgers IO
                      	
                      	
  D699                	BIOS:
  D699  E5            		PUSH	HL
  D69A  210081        		LD	HL,08100H
  D69D  39            		ADD	HL,SP
  D69E  E1            		POP	HL
  D69F  300E          		JR	NC,BIOS2
  D6A1                	BIOS1:
  D6A1  CDA9D6        		CALL	BIOS3
  D6A4  061E          		LD	B,01EH
  D6A6  ED79          		OUT	(C),A
  D6A8  C9            		RET
  D6A9                	BIOS3:
  D6A9  C5            		PUSH	BC
  D6AA  061D          		LD	B,01DH
  D6AC  ED79          		OUT	(C),A
  D6AE  C9            		RET
  D6AF                	BIOS2:
  D6AF  ED73BAD6      		LD	(SPPAT+1),SP	;スタックがBIOS-ROMと被っている場合
  D6B3  31D4FF        		LD	SP,EXTSP
  D6B6  CDA1D6        		CALL	BIOS1
  D6B9  310000        	SPPAT:	LD	SP,0
  D6BC  C9            		RET
                      	
  D6BD                	INT:
  D6BD  F5            		PUSH	AF
  D6BE  E5            		PUSH	HL
  D6BF  C5            		PUSH	BC
  D6C0  210001        		LD	HL,00100H
  D6C3  39            		ADD	HL,SP
  D6C4  3807          		JR	C,INTP1
  D6C6  ED73F8D6      		LD	(INTSP+1),SP
  D6CA  31D4FF        		LD	SP,EXTSP
  D6CD                	INTP1:
  D6CD  CDE9DA        		CALL	IN49SB
  D6D0  67            		LD	H,A
  D6D1  CDE9DA        		CALL	IN49SB
  D6D4  6F            		LD	L,A
                      	
  D6D5  CB64          		BIT	4,H		;[GRAPH]
  D6D7  2010          		JR	NZ,SCEXE
  D6D9  7D            		LD	A,L
  D6DA  EE09          		XOR	9
  D6DC  2839          		JR	Z,DIAN
  D6DE  7C            		LD	A,H
  D6DF  0F            		RRCA			;[CTRL]
  D6E0  301E          		JR	NC,SCL
  D6E2  0F            		RRCA			;[SHIFT]
  D6E3  3804          		JR	C,SCEXE
  D6E5  3E80          		LD	A,080H
  D6E7  181E          		JR	SCG1
  D6E9                	SCEXE:
  D6E9  2292EC        		LD	(_KEYD),HL
  D6EC  CD4CD7        		CALL	KEYSET1
                      	
  D6EF  21D4FF        		LD	HL,EXTSP
  D6F2  A7            		AND	A
  D6F3  ED72          		SBC	HL,SP
  D6F5  2003          		JR	NZ,INTPE1
                      	
  D6F7  310000        	INTSP:	LD	SP,0
  D6FA                	INTPE1:
  D6FA  C1            		POP	BC
  D6FB                	INTPE:
  D6FB  E1            		POP	HL
  D6FC                	INTPE2:
  D6FC  F1            		POP	AF
  D6FD                	INTCTCE:
  D6FD  FB            		EI
  D6FE  ED4D          		RETI
                      	
  D700                	SCL:
  D700  7D            		LD	A,L
  D701  FE08          		CP	008H
  D703  280D          		JR	Z,RESET
                      	
  D705  3E02          		LD	A,002H
  D707                	SCG1:
  D707  E5            		PUSH	HL
  D708  21BFEC        		LD	HL,WK1FD0
  D70B  AE            		XOR	(HL)
  D70C  CD9CCC        		CALL	S1FD0
  D70F  E1            		POP	HL
  D710  18D7          		JR	SCEXE
                      	
  D712                	RESET:
  D712  3E1D          		LD	A,01DH
  D714  D300          		OUT	(0),A
  D716  C7            		RST	0
                      	
  D717                	DIAN:
  D717  6F            		LD	L,A
  D718  C5            		PUSH	BC
  D719  01B01F        		LD	BC,01FB0H
  D71C  ED78          		IN	A,(C)
  D71E  EE80          		XOR	080H
  D720  ED79          		OUT	(C),A
  D722  C1            		POP	BC
  D723  18C4          		JR	SCEXE
                      	
  D725                	INTCTC2:
  D725  F5            		PUSH	AF
  D726  3E00          	INTCPAT:LD	A,000H
  D728  3D            		DEC	A
  D729  3227D7        		LD	(INTCPAT+1),A
  D72C  20CE          		JR	NZ,INTPE2
                      	
  D72E  3A92EC        		LD	A,(_KEYD)
  D731  B7            		OR	A
  D732  28C8          		JR	Z,INTPE2
  D734                	KEYSET0:
  D734  E5            		PUSH	HL
  D735  2A90EC        		LD	HL,(_KEYPS)
  D738  7C            		LD	A,H
  D739  AD            		XOR	L
  D73A  2006          		JR	NZ,INTC2A
                      	
  D73C  2A92EC        		LD	HL,(_KEYD)
  D73F  CD76D7        		CALL	KEYSET
  D742                	INTC2A:
  D742  3A94EC        		LD	A,(_KEYSP)
  D745  E60F          		AND	00FH
  D747  3227D7        		LD	(INTCPAT+1),A
                      	
  D74A  18AF          		JR	INTPE
                      	
  D74C                	KEYSET1:
  D74C  CB6C          		BIT	5,H
  D74E  F5            		PUSH	AF
  D74F  ED4B8CEC      		LD	BC,(_CTC)
  D753  78            		LD	A,B
  D754  B1            		OR	C
  D755  2006          		JR	NZ,KEYS10E
                      	
  D757  F1            		POP	AF
  D758  201C          		JR	NZ,KEYSET
  D75A  F5            		PUSH	AF
  D75B  18D7          		JR	KEYSET0
  D75D                	KEYS10E:
  D75D  F1            		POP	AF
  D75E  C8            		RET	Z
  D75F  F5            		PUSH	AF
  D760  3E03          		LD	A,3		;CTC STOP
  D762  ED79          		OUT	(C),A
  D764  F1            		POP	AF
                      	
  D765  B7            		OR	A
  D766  C8            		RET	Z
                      	
  D767  E5            		PUSH	HL
  D768  2A94EC        		LD	HL,(_KEYSP)
  D76B  3EA7          		LD	A,0A7H
  D76D  ED79          		OUT	(C),A
  D76F  ED69          		OUT	(C),L
  D771  7C            		LD	A,H
  D772  3227D7        		LD	(INTCPAT+1),A
  D775  E1            		POP	HL
                      	
  D776                	KEYSET:
  D776  7D            		LD	A,L
  D777  CB7C          		BIT	7,H
  D779  CCA6D7        		CALL	Z,FKEY
  D77C  CB74          		BIT	6,H
  D77E  C0            		RET	NZ
  D77F                	KEYBS:
  D77F  B7            		OR	A
  D780  C8            		RET	Z
  D781                	KEYBS1:
  D781  FE03          		CP	3
  D783  CC99D7        		CALL	Z,KEYBC
  D786  E5            		PUSH	HL
  D787  F5            		PUSH	AF
  D788  2A90EC        		LD	HL,(_KEYPS)
  D78B  2C            		INC	L
  D78C  7D            		LD	A,L
  D78D  BC            		CP	H
  D78E  2812          		JR	Z,KEYBE
  D790  3290EC        		LD	(_KEYPS),A
  D793  26FE          		LD	H,KEYBF/256
  D795  F1            		POP	AF
  D796  77            		LD	(HL),A
  D797  E1            		POP	HL
  D798  C9            		RET
                      	
  D799                	KEYBC:
  D799  E5            		PUSH	HL
  D79A  210000        		LD	HL,0
  D79D  2290EC        		LD	(_KEYPS),HL
  D7A0  E1            		POP	HL
  D7A1  C9            		RET
                      	
  D7A2                	KEYBE:
  D7A2  F1            		POP	AF
  D7A3  E1            		POP	HL
  D7A4  37            		SCF
  D7A5  C9            		RET
                      	
  D7A6                	FKEY:
  D7A6  CB75          		BIT	6,L
  D7A8  C8            		RET	Z
  D7A9  3E1B          		LD	A,01BH
  D7AB  CD81D7        		CALL	KEYBS1
  D7AE  7D            		LD	A,L
  D7AF  C6AF          		ADD	A,020H-'q'
  D7B1  CB7D          		BIT	7,L
  D7B3  C8            		RET	Z
  D7B4  2E50          		LD	L,'P'
  D7B6  D690          		SUB	0E1H+020H-'q'
  D7B8  2810          		JR	Z,KEYBSL
  D7BA  2C            		INC	L
  D7BB  3D            		DEC	A
  D7BC  280C          		JR	Z,KEYBSL
  D7BE  2C            		INC	L
  D7BF  D609          		SUB	0EBH-0E2H
  D7C1  2807          		JR	Z,KEYBSL
  D7C3  2E43          		LD	L,'C'
  D7C5  3D            		DEC	A
  D7C6  2802          		JR	Z,KEYBSL
  D7C8  2E58          		LD	L,'X'
  D7CA                	KEYBSL:
  D7CA  7D            		LD	A,L
  D7CB  18B4          		JR	KEYBS1
                      	
  D7CD                	_SYS01:		;(BDOS)コンソール入力
  D7CD  CDA8D3        		CALL	_SYS07
  D7D0                	MSG_:
  D7D0  F5            		PUSH	AF
  D7D1  D5            		PUSH	DE
  D7D2  5F            		LD	E,A
  D7D3  CDD9D7        		CALL	_SYS02
  D7D6  D1            		POP	DE
  D7D7  F1            		POP	AF
  D7D8  C9            		RET
                      	
  D7D9                	_SYS02:		;(BDOS)コンソール出力
  D7D9  CDEBD7        		CALL	BREAK
  D7DC  1805          		JR	PRINTX
                      	
  D7DE                	_SYS06:		;(BDOS)コンソール直接入出力
  D7DE  7B            		LD	A,E
  D7DF  3C            		INC	A
  D7E0  CACAEC        		JP	Z,_INKEY
  D7E3                	PRINTX:
  D7E3  C3CDEC        		JP	_PRINT
                      	
  D7E6                	_SYS08:		;(BDOS)エコーなしコンソール入力
  D7E6  CDA8D3        		CALL	_SYS07
  D7E9  1804          		JR	BREAK1
  D7EB                	BREAK:
  D7EB  FB            		EI
  D7EC  3A92EC        		LD	A,(_KEYD)
  D7EF                	BREAK1:
  D7EF  FE03          		CP	3
  D7F1  CA0000        		JP	Z,0
  D7F4  FE13          		CP	013H
  D7F6  C0            		RET	NZ
                      	
  D7F7                	PAUSE:
  D7F7  CD99D7        		CALL	KEYBC
                      	
  D7FA                	FLGET:
  D7FA  CDDFEC        		CALL	_FFLUSH
  D7FD  C5            		PUSH	BC
  D7FE  E5            		PUSH	HL
  D7FF  ED4B8EEC      		LD	BC,(_TXADR)
  D803  CBE8          		SET	5,B
  D805  ED60          		IN	H,(C)
  D807                	FLGET1:
  D807  3A93EC        		LD	A,(_KEYD+1)
  D80A  0F            		RRCA
  D80B  0F            		RRCA
  D80C  E610          		AND	010H
  D80E  F608          		OR	8
  D810  ED68          		IN	L,(C)
  D812  B5            		OR	L
  D813  ED79          		OUT	(C),A
  D815  CDCAEC        		CALL	_INKEY
  D818  28ED          		JR	Z,FLGET1
  D81A  ED61          		OUT	(C),H
  D81C  E1            		POP	HL
  D81D  C1            		POP	BC
  D81E  C9            		RET
                      	
  D81F                	_SYS0A:		;(BDOS)文字列入力
  D81F  C5            		PUSH	BC
  D820  E5            		PUSH	HL
  D821  D5            		PUSH	DE
  D822  CD44DC        		CALL	GETL
  D825  1100FF        		LD	DE,KBUF
  D828  E1            		POP	HL
  D829  E5            		PUSH	HL
  D82A  0E00          		LD	C,0
  D82C  3004          		JR	NC,SAX0
  D82E  23            		INC	HL
  D82F  23            		INC	HL
  D830  1808          		JR	SAX4
  D832                	SAX0:
  D832  46            		LD	B,(HL)
  D833  23            		INC	HL
  D834                	SAX1:
  D834  23            		INC	HL
  D835  1A            		LD	A,(DE)
  D836  13            		INC	DE
  D837  B7            		OR	A
  D838  2004          		JR	NZ,SAX2
  D83A                	SAX4:
  D83A  360D          		LD	(HL),00DH
  D83C  1804          		JR	SAX3
  D83E                	SAX2:
  D83E  77            		LD	(HL),A
  D83F  0C            		INC	C
  D840  10F2          		DJNZ	SAX1
  D842                	SAX3:
  D842  D1            		POP	DE
  D843  79            		LD	A,C
  D844  13            		INC	DE
  D845  12            		LD	(DE),A
  D846  1B            		DEC	DE
  D847  E1            		POP	HL
  D848  C1            		POP	BC
  D849  A7            		AND	A
  D84A  C9            		RET
                      	
  D84B                	_SYS0B:		;(BDOS)コンソール状態のチェック
  D84B  CDEBD7        		CALL	BREAK
  D84E  3A92EC        		LD	A,(_KEYD)
  D851  B7            		OR	A
  D852  C8            		RET	Z
  D853                	CONSTX:
  D853  CDDFEC        		CALL	_FFLUSH
  D856  E5            		PUSH	HL
  D857  2A90EC        		LD	HL,(_KEYPS)
  D85A  7C            		LD	A,H
  D85B  AD            		XOR	L
  D85C  E1            		POP	HL
  D85D  C6FF          		ADD	A,0FFH
  D85F  9F            		SBC	A,A
  D860  C9            		RET
                      	
  D861                	_SYS2A:		;(BDOS)日付の獲得
  D861  C5            		PUSH	BC
  D862  3EED          		LD	A,0EDH		;Read calendar
  D864  CD04DB        		CALL	COMOUT
  D867  CD8AD8        		CALL	IN49SB_BCD	;YY
  D86A  6F            		LD	L,A
  D86B  2600          		LD	H,0
  D86D  116C07        		LD	DE,1900		;0076CH
  D870  FE5A          		CP	90		;90以上は1900年代 1990-1999
  D872  3002          		JR	NC,RDDATE1	;90未満は2000年代 2000-2089
  D874  1ED0          		LD	E,0D0H		;2000 & 0FFH D=007H
  D876                	RDDATE1:
  D876  19            		ADD	HL,DE
  D877  CDE9DA        		CALL	IN49SB		;MM
  D87A  57            		LD	D,A
  D87B  CD8AD8        		CALL	IN49SB_BCD	;DD
  D87E  5F            		LD	E,A
  D87F  7A            		LD	A,D
  D880  E607          		AND	7
  D882  0604          		LD	B,4
  D884                	RDDATE2:
  D884  CB3A          		SRL	D
  D886  10FC          		DJNZ	RDDATE2
  D888  C1            		POP	BC
  D889  C9            		RET
  D88A                	IN49SB_BCD:
  D88A  CDE9DA        		CALL	IN49SB
                      	;------------------------
                      	;BCDの10進数化
                      	;in
                      	;	A  : BCD
                      	;out
                      	;	A  : 10進数
                      	;------------------------
  D88D  4F            		LD	C,A
  D88E  E6F0          		AND	0F0H	;10の位
  D890  0F            		RRCA
  D891  47            		LD	B,A
  D892  0F            		RRCA
  D893  0F            		RRCA
  D894  80            		ADD	A,B
  D895  47            		LD	B,A
  D896  79            		LD	A,C
  D897  E60F          		AND	00FH	;1の位
  D899  80            		ADD	A,B
  D89A  C9            		RET
                      	
  D89B                	_SYS2C:		;(BDOS)時刻の獲得
  D89B  C5            		PUSH	BC
  D89C  3EEF          		LD	A,0EFH		;Read time
  D89E  CD04DB        		CALL	COMOUT
  D8A1  CD8AD8        		CALL	IN49SB_BCD	;TT
  D8A4  67            		LD	H,A
  D8A5  CD8AD8        		CALL	IN49SB_BCD	;MM
  D8A8  6F            		LD	L,A
  D8A9  CD8AD8        		CALL	IN49SB_BCD	;SS
  D8AC  57            		LD	D,A
  D8AD  C1            		POP	BC
  D8AE  AF            		XOR	A
  D8AF  C9            		RET
                      	
  D8B0                	MSX1:
  D8B0  5F            		LD	E,A
  D8B1  CDCDEC        		CALL	_PRINT
  D8B4                	MSX:
  D8B4  7E            		LD	A,(HL)
  D8B5  23            		INC	HL
  D8B6  B7            		OR	A
  D8B7  20F7          		JR	NZ,MSX1
  D8B9  C9            		RET
                      	
  D8BA                	ESC1:
  D8BA  7B            		LD	A,E
  D8BB  FE41          		CP	'A'
  D8BD  CAF7D9        		JP	Z,CTRL1E
  D8C0  FE42          		CP	'B'
  D8C2  CA6FDB        		JP	Z,CTRL1F
  D8C5  FE43          		CP	'C'
  D8C7  CA04DA        		JP	Z,CTRL1C
  D8CA  FE44          		CP	'D'
  D8CC  CAEDD9        		JP	Z,CTRL1D
  D8CF  FE45          		CP	'E'
  D8D1  2802          		JR	Z,CT0CX
  D8D3  FE6A          		CP	'j'
  D8D5                	CT0CX:
  D8D5  CA42DB        		JP	Z,CTRL0C
  D8D8  FE48          		CP	'H'
  D8DA  CA82DA        		JP	Z,CTRL0B
  D8DD  FE4A          		CP	'J'
  D8DF  CA45DB        		JP	Z,CTRL1A
  D8E2  FE4B          		CP	'K'
  D8E4  CA44DA        		JP	Z,CTRL05
  D8E7  FE4C          		CP	'L'
  D8E9  CA84DB        		JP	Z,CTRL0E
  D8EC  FE78          		CP	'x'
  D8EE  2804          		JR	Z,ESC1X
  D8F0  FE79          		CP	'y'
  D8F2  2002          		JR	NZ,ESC1Y
  D8F4                	ESC1X:
  D8F4  3601          		LD	(HL),1
  D8F6                	ESC1Y:
  D8F6  FE3D          		CP	'='
  D8F8  2804          		JR	Z,ESC1W
  D8FA  FE59          		CP	'Y'
  D8FC  2002          		JR	NZ,ESC1Z
  D8FE                	ESC1W:
  D8FE  3602          		LD	(HL),2
  D900                	ESC1Z:
  D900  FE20          		CP	020H
  D902  3802          		JR	C,ESC1C
  D904  87            		ADD	A,A
  D905  D0            		RET	NC
  D906                	ESC1C:
  D906  E1            		POP	HL
  D907  184A          		JR	ANK
                      	
  D909                	ESC:
  D909  2164D9        		LD	HL,PRINTE5
  D90C  E5            		PUSH	HL
  D90D  212FD9        		LD	HL,ESCFLG+1
  D910  3600          		LD	(HL),0
  D912  3D            		DEC	A
  D913  28A5          		JR	Z,ESC1
  D915  3D            		DEC	A
  D916  2009          		JR	NZ,ESC2
  D918  3603          		LD	(HL),3
  D91A  7B            		LD	A,E
  D91B  D620          		SUB	020H
  D91D  3224D9        		LD	(ESCYP+1),A
  D920  C9            		RET
  D921                	ESC2:
  D921  3D            		DEC	A
  D922  C0            		RET	NZ
  D923  2600          	ESCYP:	LD	H,0
  D925  7B            		LD	A,E
  D926  D620          		SUB	020H
  D928  6F            		LD	L,A
  D929  C3D6EC        		JP	_LOC
                      	
  D92C                	PRINT:
  D92C  C5            		PUSH	BC
  D92D  E5            		PUSH	HL
  D92E  3E00          	ESCFLG:	LD	A,000H
  D930  B7            		OR	A
  D931  20D6          		JR	NZ,ESC
                      	
  D933  3E1F          		LD	A,01FH
  D935  BB            		CP	E
  D936  3030          		JR	NC,CTRL
  D938                	PRINTC:
  D938  A7            	INSFLG:	AND	A
  D939  DC0DDB        		CALL	C,CTRL12
                      	
  D93C  3E00          	KANFLG:	LD	A,000H
  D93E  B7            		OR	A
  D93F  203D          		JR	NZ,KANJI2
  D941  7B            	X1KPAT:	LD	A,E
  D942  FE80          		CP	080H
  D944  380D          		JR	C,ANK
  D946  FEA0          		CP	0A0H
  D948  3804          		JR	C,KANJI1
  D94A  FEE0          		CP	0E0H
  D94C  3805          		JR	C,ANK
  D94E                	KANJI1:
  D94E  323DD9        		LD	(KANFLG+1),A
  D951  1811          		JR	PRINTE5
  D953                	ANK:
  D953  ED4B8EEC      		LD	BC,(_TXADR)
  D957  78            		LD	A,B
  D958  F638          		OR	038H
  D95A  47            		LD	B,A
                      	;	OUT	(C),0		;未定義命令ニーモニック
  D95B  ED71          		DB	0EDH,071H	;Kanji
  D95D  CB98          		RES	3,B
  D95F  ED59          		OUT	(C),E		;Text
  D961                	KANJIE:
  D961  CDC9D9        		CALL	PRINTE7
  D964                	PRINTE5:
  D964  E1            		POP	HL
  D965  C1            		POP	BC
  D966  AF            		XOR	A
  D967  C9            		RET
                      	
  D968                	CTRL:
  D968  CDB0D9        		CALL	KANCLR
  D96B  3EA7          		LD	A,0A7H		;AND	A
  D96D  3238D9        		LD	(INSFLG),A
  D970  7B            		LD	A,E
  D971  87            		ADD	A,A
  D972  6F            		LD	L,A
  D973  26EB          		LD	H,CTRLTB/256
  D975  7E            		LD	A,(HL)
  D976  2C            		INC	L
  D977  66            		LD	H,(HL)
  D978  6F            		LD	L,A
  D979  CD0F00        		CALL	JP_HL
  D97C  18E6          		JR	PRINTE5
                      	
  D97E                	KANJI2:
  D97E  D5            		PUSH	DE
  D97F  57            		LD	D,A
  D980  01812F        		LD	BC,02F81H	;SFTJIS
  D983  DF            		RST	018H
  D984  01C32F        		LD	BC,02FC3H	;Instead or JISVRM
  D987  DF            		RST	018H
                      	
  D988  ED4B8EEC      		LD	BC,(_TXADR)
  D98C  78            		LD	A,B
  D98D  F638          		OR	038H
  D98F  47            		LD	B,A
  D990  ED51          		OUT	(C),D		;kanji
  D992  CB98          		RES	3,B
  D994  ED59          		OUT	(C),E		;Text
  D996  CDC9D9        		CALL	PRINTE7
  D999  ED4B8EEC      		LD	BC,(_TXADR)
  D99D  78            		LD	A,B
  D99E  F638          		OR	038H
  D9A0  47            		LD	B,A
  D9A1  CBF2          		SET	6,D
  D9A3  ED51          		OUT	(C),D		;Kanji
  D9A5  CB98          		RES	3,B
  D9A7  ED59          		OUT	(C),E		;Text
  D9A9  D1            		POP	DE
  D9AA  AF            		XOR	A
  D9AB  323DD9        		LD	(KANFLG+1),A
  D9AE  18B1          		JR	KANJIE
                      	
  D9B0                	KANCLR:
  D9B0  3A3DD9        		LD	A,(KANFLG+1)
  D9B3  B7            		OR	A
  D9B4  C8            		RET	Z
  D9B5  ED4B8EEC      		LD	BC,(_TXADR)
  D9B9  78            		LD	A,B
  D9BA  F638          		OR	038H
  D9BC  47            		LD	B,A
  D9BD  AF            		XOR	A
  D9BE  323DD9        		LD	(KANFLG+1),A
  D9C1  ED79          		OUT	(C),A		;Kanji
  D9C3  CB98          		RES	3,B
  D9C5  3E20          		LD	A,020H
  D9C7  ED79          		OUT	(C),A		;Text
  D9C9                	PRINTE7:
  D9C9  CBA0          		RES	4,B
  D9CB                	PRINTE6:
  D9CB  3A96EC        		LD	A,(_COLORF)
  D9CE                	PRINTE4:
  D9CE  ED79          		OUT	(C),A		;Color
  D9D0  78            		LD	A,B
  D9D1  E607          		AND	7
  D9D3  47            		LD	B,A
  D9D4                	PRINTE2:
  D9D4  03            		INC	BC
  D9D5                	PRINTE3:
  D9D5  2ABAEC        		LD	HL,(CRTCD+10)
  D9D8  A7            		AND	A
  D9D9  ED4A          		ADC	HL,BC
  D9DB                	PRINTE8:
  D9DB  2805          		JR	Z,PRINT2
  D9DD                	PRINTE1:
  D9DD  ED438EEC      		LD	(_TXADR),BC
  D9E1                	PRINTE:
  D9E1  C9            		RET
                      	
  D9E2                	PRINT2:
  D9E2  CD8ADB        		CALL	SCR
  D9E5  2ABCEC        		LD	HL,(CRTCD+12)
  D9E8  09            		ADD	HL,BC
  D9E9  228EEC        		LD	(_TXADR),HL
  D9EC  C9            		RET
                      	
  D9ED                	CTRL08:
  D9ED                	CTRL1D:
  D9ED  ED4B8EEC      		LD	BC,(_TXADR)
  D9F1  78            		LD	A,B
  D9F2  B1            		OR	C
  D9F3  C8            		RET	Z
  D9F4  0B            		DEC	BC
  D9F5  18E6          		JR	PRINTE1
                      	
  D9F7                	CTRL1E:
  D9F7  ED4B8EEC      		LD	BC,(_TXADR)
  D9FB  2ABCEC        		LD	HL,(CRTCD+12)
  D9FE  09            		ADD	HL,BC
  D9FF  D0            		RET	NC
  DA00  44            		LD	B,H
  DA01  4D            		LD	C,L
  DA02  18D9          		JR	PRINTE1
                      	
  DA04                	CTRL1C:
  DA04  ED4B8EEC      		LD	BC,(_TXADR)
  DA08  18CA          		JR	PRINTE2
                      	
  DA0A                	CTRL09:
  DA0A  ED4B8EEC      		LD	BC,(_TXADR)
  DA0E  79            		LD	A,C
  DA0F  E6F8          		AND	0F8H
  DA11  C608          		ADD	A,8
  DA13  4F            		LD	C,A
  DA14  88            		ADC	A,B
  DA15  91            		SUB	C
  DA16  47            		LD	B,A
  DA17  18BC          		JR	PRINTE3
                      	
  DA19                	CTRL02:
  DA19  2A8EEC        		LD	HL,(_TXADR)
  DA1C  7C            		LD	A,H
  DA1D  B5            		OR	L
  DA1E  C8            		RET	Z
  DA1F  2B            		DEC	HL
  DA20  228EEC        		LD	(_TXADR),HL
  DA23  D5            		PUSH	DE
  DA24  CDD3EC        		CALL	_POS
  DA27  3AB1EC        		LD	A,(CRTCD+1)
  DA2A  95            		SUB	L
  DA2B  6F            		LD	L,A
  DA2C  2D            		DEC	L
  DA2D  2638          		LD	H,038H
  DA2F  ED4B8EEC      		LD	BC,(_TXADR)
  DA33  09            		ADD	HL,BC
  DA34  44            		LD	B,H
  DA35  4D            		LD	C,L
  DA36  110020        		LD	DE,02000H	;D:Text E:kanji
  DA39  2A96EC        		LD	HL,(_COLORF)	;L:Color
  DA3C                	C8X1:
  DA3C  CD29DB        		CALL	C12S
  DA3F  0B            		DEC	BC
  DA40  20FA          		JR	NZ,C8X1
  DA42  D1            		POP	DE
  DA43  C9            		RET
                      	
  DA44                	CTRL05:
  DA44  CDD3EC        		CALL	_POS
  DA47  3AB1EC        		LD	A,(CRTCD+1)
  DA4A  95            		SUB	L
  DA4B  6F            		LD	L,A
  DA4C  2620          		LD	H,020H
  DA4E  ED4B8EEC      		LD	BC,(_TXADR)
  DA52                	C05X1:
  DA52  78            		LD	A,B
  DA53  F638          		OR	038H
  DA55  47            		LD	B,A
                      	;	OUT	(C),0		;未定義命令ニーモニック
  DA56  ED71          		DB	0EDH,071H	;kanji
  DA58  CB98          		RES	3,B
  DA5A  ED61          		OUT	(C),H		;Text
  DA5C  CBA0          		RES	4,B
  DA5E  3A96EC        		LD	A,(_COLORF)
  DA61  ED79          		OUT	(C),A		;Color
  DA63  03            		INC	BC
  DA64  2D            		DEC	L
  DA65  20EB          		JR	NZ,C05X1
  DA67  C9            		RET
                      	
  DA68                	CTRL0D:
  DA68  CDD3EC        		CALL	_POS
  DA6B  2E00          		LD	L,0
  DA6D                	LOC:
  DA6D  C5            		PUSH	BC
  DA6E  E5            		PUSH	HL
  DA6F  CDB0D9        		CALL	KANCLR
  DA72  CD95DA        		CALL	LOC1
  DA75  ED438EEC      		LD	(_TXADR),BC
  DA79  E1            		POP	HL
  DA7A  C1            		POP	BC
  DA7B  C9            		RET
                      	
  DA7C                	CTRL01:
  DA7C  3E37          		LD	A,037H		;SCF
  DA7E  3238D9        		LD	(INSFLG),A
  DA81  C9            		RET
                      	
  DA82                	CTRL0B:
  DA82  210000        		LD	HL,0
  DA85  228EEC        		LD	(_TXADR),HL
  DA88  C9            		RET
                      	
  DA89                	PRINTS:
  DA89  CDEBD7        		CALL	BREAK
  DA8C  C3CDEC        		JP	_PRINT
                      	
  DA8F                	CTRL1B:
  DA8F  3E01          		LD	A,1
  DA91  322FD9        		LD	(ESCFLG+1),A
  DA94  C9            		RET
                      	
  DA95                	LOC1:
  DA95  44            		LD	B,H
  DA96  4D            		LD	C,L
  DA97  04            		INC	B
  DA98  05            		DEC	B
  DA99  C8            		RET	Z
  DA9A  D5            		PUSH	DE
  DA9B  ED5BB1EC      		LD	DE,(CRTCD+1)
  DA9F  210000        		LD	HL,0
  DAA2  55            		LD	D,L
  DAA3                	LOC2:
  DAA3  19            		ADD	HL,DE
  DAA4  10FD          		DJNZ	LOC2
  DAA6  09            		ADD	HL,BC
  DAA7  D1            		POP	DE
  DAA8                	LOC3:
  DAA8  44            		LD	B,H
  DAA9  4D            		LD	C,L
  DAAA  C9            		RET
                      	
  DAAB                	CONOUT1:
  DAAB  CDBDDA        		CALL	CURSOR
  DAAE  59            		LD	E,C
  DAAF  CDCDEC        		CALL	_PRINT
  DAB2  7B            		LD	A,E
  DAB3  FE0A          		CP	00AH
  DAB5  2006          		JR	NZ,CURSOR
  DAB7  CD68DA        		CALL	CTRL0D
  DABA  CD44DA        		CALL	CTRL05
  DABD                	CURSOR:
  DABD  C5            		PUSH	BC
  DABE  ED4B8EEC      		LD	BC,(_TXADR)
  DAC2  CBE8          		SET	5,B
  DAC4  ED78          		IN	A,(C)
  DAC6  EE18          		XOR	018H
  DAC8  ED79          		OUT	(C),A
  DACA  C1            		POP	BC
  DACB  C9            		RET
                      	
  DACC                	CTRL07:
  DACC  21E4EB        		LD	HL,BEEPD
  DACF                	BEEP1:
  DACF  7E            		LD	A,(HL)
  DAD0  23            		INC	HL
  DAD1  FEFF          		CP	0FFH
  DAD3  C8            		RET	Z
  DAD4  F3            		DI
  DAD5  061C          		LD	B,01CH
  DAD7  ED79          		OUT	(C),A
  DAD9  EDA3          		OUTI
  DADB  FB            		EI
  DADC  18F1          		JR	BEEP1
                      	
  DADE                	OT49SB:
  DADE  C5            		PUSH	BC
  DADF  CDFADA        		CALL	CANW
  DAE2  010019        		LD	BC,01900H
  DAE5  ED79          		OUT	(C),A
  DAE7  C1            		POP	BC
  DAE8  C9            		RET
                      	
  DAE9                	IN49SB:
  DAE9  C5            		PUSH	BC
  DAEA  01011A        		LD	BC,01A01H
  DAED                	CANR:
  DAED  ED78          		IN	A,(C)
  DAEF  E620          		AND	020H
  DAF1  20FA          		JR	NZ,CANR
  DAF3  010019        		LD	BC,01900H
  DAF6  ED78          		IN	A,(C)
  DAF8  C1            		POP	BC
  DAF9  C9            		RET
                      	
  DAFA                	CANW:
  DAFA  01011A        		LD	BC,01A01H
  DAFD  ED48          		IN	C,(C)
  DAFF  CB71          		BIT	6,C
  DB01  20F7          		JR	NZ,CANW
  DB03  C9            		RET
                      	
  DB04                	COMOUT:
  DB04  FB            		EI
  DB05  CDDEDA        		CALL	OT49SB
  DB08  CDFADA        		CALL	CANW
  DB0B  F3            		DI
  DB0C  C9            		RET
                      	
  DB0D                	CTRL12:
  DB0D  D5            		PUSH	DE
  DB0E  CDD3EC        		CALL	_POS
  DB11  3AB1EC        		LD	A,(CRTCD+1)
  DB14  95            		SUB	L
  DB15  ED4B8EEC      		LD	BC,(_TXADR)
  DB19  110020        		LD	DE,02000H	;D:Text E:Kanji
  DB1C  2A96EC        		LD	HL,(_COLORF)	;L:Color
  DB1F  CBE8          		SET	5,B
  DB21                	C12X1:
  DB21  CD29DB        		CALL	C12S
  DB24  03            		INC	BC
  DB25  20FA          		JR	NZ,C12X1
  DB27  D1            		POP	DE
  DB28  C9            		RET
                      	
  DB29                	C12S:
  DB29  CBE0          		SET	4,B
  DB2B  CBD8          		SET	3,B
  DB2D  ED60          		IN	H,(C)
  DB2F  ED59          	X1PAT:	OUT	(C),E
  DB31  5C            		LD	E,H
  DB32  CB98          		RES	3,B
  DB34  ED60          		IN	H,(C)
  DB36  ED51          		OUT	(C),D
  DB38  54            		LD	D,H
  DB39  CBA0          		RES	4,B
  DB3B  ED60          		IN	H,(C)
  DB3D  ED69          		OUT	(C),L
  DB3F  6C            		LD	L,H
  DB40  3D            		DEC	A
  DB41  C9            		RET
                      	
  DB42                	CTRL0C:
  DB42  CD82DA        		CALL	CTRL0B
  DB45                	CTRL1A:
  DB45  ED4B8EEC      		LD	BC,(_TXADR)
  DB49                	C1AX1:
  DB49  78            		LD	A,B
  DB4A  F638          		OR	038H
  DB4C  47            		LD	B,A
                      	;	OUT	(C),0		;未定義命令ニーモニック
  DB4D  ED71          		DB	0EDH,071H	;kanji
  DB4F  CB98          		RES	3,B
  DB51  3E20          		LD	A,020H
  DB53  ED79          		OUT	(C),A		;Text
  DB55  CBA0          		RES	4,B
  DB57  3A96EC        		LD	A,(_COLORF)
  DB5A  ED79          		OUT	(C),A		;Color
  DB5C  03            		INC	BC
  DB5D  CBA8          		RES	5,B
  DB5F  2ABAEC        		LD	HL,(CRTCD+10)
  DB62  09            		ADD	HL,BC
  DB63  30E4          		JR	NC,C1AX1
  DB65  C9            		RET
                      	
  DB66                	CTRL04:
  DB66  CDD3EC        		CALL	_POS
  DB69  7D            		LD	A,L
  DB6A  B7            		OR	A
  DB6B  C8            		RET	Z
  DB6C                	CTRL03:
  DB6C  CD68DA        		CALL	CTRL0D
  DB6F                	CTRL0A:
  DB6F                	CTRL1F:
  DB6F  ED4B8EEC      		LD	BC,(_TXADR)
  DB73  2AB1EC        		LD	HL,(CRTCD+1)
  DB76  2600          		LD	H,0
  DB78  09            		ADD	HL,BC
  DB79  44            		LD	B,H
  DB7A  4D            		LD	C,L
  DB7B  2ABAEC        		LD	HL,(CRTCD+10)
  DB7E  09            		ADD	HL,BC
  DB7F  3F            		CCF
  DB80  9F            		SBC	A,A
  DB81  C3DBD9        		JP	PRINTE8
                      	
  DB84                	CTRL0E:
  DB84  CDD3EC        		CALL	_POS
  DB87  7C            		LD	A,H
  DB88  1804          		JR	SCR1
  DB8A                	SCR:
  DB8A  3A97EC        		LD	A,(_LINE)
  DB8D  3D            		DEC	A
  DB8E                	SCR1:
  DB8E  C5            		PUSH	BC
  DB8F  D5            		PUSH	DE
  DB90  01801F        		LD	BC,01F80H	;DMA
  DB93  1EC3          		LD	E,0C3H
  DB95  ED59          		OUT	(C),E
  DB97  119A65        		LD	DE,0659AH
  DB9A  ED59          		OUT	(C),E
  DB9C  ED51          		OUT	(C),D
  DB9E  114F00        		LD	DE,79
  DBA1  ED59          		OUT	(C),E
  DBA3  ED51          		OUT	(C),D
                      	
  DBA5  210038        		LD	HL,03800H
  DBA8  11181C        		LD	DE,01C18H
  DBAB  ED51          		OUT	(C),D
  DBAD  ED59          		OUT	(C),E
                      	
  DBAF                	SCRUP1:
  DBAF  B7            		OR	A
  DBB0  2839          		JR	Z,SCRCL
  DBB2  F5            		PUSH	AF
  DBB3  CDCCDB        		CALL	UPSUB		;kanji
  DBB6  ED5BBCEC      		LD	DE,(CRTCD+12)
  DBBA  16F7          		LD	D,0F7H
  DBBC  19            		ADD	HL,DE
  DBBD  D5            		PUSH	DE
  DBBE  CDCCDB        		CALL	UPSUB		;Text
  DBC1  D1            		POP	DE
  DBC2  19            		ADD	HL,DE
  DBC3  CDCCDB        		CALL	UPSUB		;Color
  DBC6  CBE4          		SET	4,H
  DBC8  F1            		POP	AF
  DBC9  3D            		DEC	A
  DBCA  18E3          		JR	SCRUP1
                      	
  DBCC                	UPSUB:
  DBCC  ED5BB1EC      		LD	DE,(CRTCD+1)
  DBD0  1600          		LD	D,0
  DBD2  3ECD          		LD	A,0CDH
  DBD4  ED79          		OUT	(C),A
  DBD6  ED69          		OUT	(C),L		;SOURCE
  DBD8  ED61          		OUT	(C),H
  DBDA  19            		ADD	HL,DE
  DBDB  3E1D          		LD	A,01DH
  DBDD  ED79          		OUT	(C),A		;DEST
  DBDF  ED69          		OUT	(C),L
  DBE1  ED61          		OUT	(C),H
  DBE3  1187CF        		LD	DE,0CF87H
  DBE6  ED51          		OUT	(C),D
  DBE8  ED59          		OUT	(C),E
  DBEA  C9            		RET
                      	
  DBEB                	SCRCL:
  DBEB  44            		LD	B,H
  DBEC  4D            		LD	C,L
  DBED  215020        		LD	HL,02000H+80
  DBF0  3A96EC        		LD	A,(_COLORF)
  DBF3                	SCRCL1:
                      	;	OUT	(C),0		;未定義命令ニーモニック
  DBF3  ED71          		DB	0EDH,071H
  DBF5  CB98          		RES	3,B
  DBF7  ED61          		OUT	(C),H
  DBF9  CBA0          		RES	4,B
  DBFB  ED79          		OUT	(C),A
  DBFD  CBD8          		SET	3,B
  DBFF  CBE0          		SET	4,B
  DC01  03            		INC	BC
  DC02  2D            		DEC	L
  DC03  20EE          		JR	NZ,SCRCL1
  DC05  D1            		POP	DE
  DC06  C1            		POP	BC
  DC07  C9            		RET
                      	
  DC08                	SCRN:
  DC08  D5            		PUSH	DE
  DC09  ED58          		IN	E,(C)		;Text
  DC0B  CBD8          		SET	3,B
  DC0D  ED50          		IN	D,(C)		;Kanji
  DC0F  2819          		JR	Z,SCRNE
  DC11  AF            		XOR	A
  DC12  C5            		PUSH	BC
  DC13  013730        		LD	BC,03037H	;VRMJIS
  DC16  DF            		RST	018H
  DC17  01522F        		LD	BC,02F52H	;JISSFT
  DC1A  DF            		RST	018H
  DC1B  C1            		POP	BC
  DC1C  ED78          		IN	A,(C)
  DC1E  CB98          		RES	3,B
  DC20  E640          		AND	040H
  DC22  2003          		JR	NZ,SCRN1
  DC24  7A            		LD	A,D
  DC25  D1            		POP	DE
  DC26  C9            		RET
  DC27                	SCRN1:
  DC27  7B            		LD	A,E
  DC28  D1            		POP	DE
  DC29  C9            		RET
                      	
  DC2A                	SCRNE:
  DC2A  D1            		POP	DE
  DC2B  CB98          		RES	3,B
  DC2D                	SCRNX:
  DC2D  ED78          		IN	A,(C)
  DC2F  C9            		RET
                      	
  DC30                	POS:
  DC30  2A8EEC        		LD	HL,(_TXADR)
  DC33  C5            		PUSH	BC
  DC34  ED4BBCEC      		LD	BC,(CRTCD+12)
  DC38  AF            		XOR	A
  DC39                	POS1:
  DC39  09            		ADD	HL,BC
  DC3A  3C            		INC	A
  DC3B  38FC          		JR	C,POS1
  DC3D  ED42          		SBC	HL,BC
  DC3F  3D            		DEC	A
  DC40  67            		LD	H,A
  DC41  C1            		POP	BC
  DC42  A7            		AND	A
  DC43  C9            		RET
                      	
  DC44                	GETL:
  DC44  CDD3EC        		CALL	_POS
  DC47  E5            		PUSH	HL
  DC48                	GETL1:
  DC48  CDD3EC        		CALL	_POS
  DC4B  C1            		POP	BC
  DC4C  C5            		PUSH	BC
  DC4D  7D            		LD	A,L
  DC4E  91            		SUB	C
  DC4F  69            		LD	L,C
  DC50  4F            		LD	C,A
  DC51  DCD6EC        		CALL	C,_LOC
  DC54                	GET1W:
  DC54  CDE6D7        		CALL	_SYS08
  DC57  FE08          		CP	8
  DC59  2007          		JR	NZ,GETL1X
  DC5B  0D            		DEC	C
  DC5C  CB79          		BIT	7,C
  DC5E  2002          		JR	NZ,GETL1X
  DC60  3E02          		LD	A,2
  DC62                	GETL1X:
  DC62  FE1B          		CP	01BH
  DC64  2016          		JR	NZ,GETL1V
  DC66  CDE6D7        		CALL	_SYS08
  DC69  FE22          		CP	022H
  DC6B  2008          		JR	NZ,GETL1Y
  DC6D  2100FF        		LD	HL,KBUF
  DC70  CDB4D8        		CALL	MSX
  DC73  180E          		JR	GETL1Z
  DC75                	GETL1Y:
  DC75  F5            		PUSH	AF
  DC76  1E1B          		LD	E,01BH
  DC78  CDCDEC        		CALL	_PRINT
  DC7B  F1            		POP	AF
  DC7C                	GETL1V:
  DC7C  5F            		LD	E,A
  DC7D  CD7CDA        		CALL	CTRL01
  DC80  CDCDEC        		CALL	_PRINT
  DC83                	GETL1Z:
  DC83  7B            		LD	A,E
  DC84  FE0D          		CP	00DH
  DC86  20C0          		JR	NZ,GETL1
                      	
  DC88  2100FF        		LD	HL,KBUF
  DC8B  AF            		XOR	A
  DC8C  ED4BB0EC      		LD	BC,(CRTCD)
  DC90                	GETL0:
  DC90  77            		LD	(HL),A
  DC91  23            		INC	HL
  DC92  10FC          		DJNZ	GETL0
                      	
  DC94  D1            		POP	DE
  DC95  CDD3EC        		CALL	_POS
  DC98  6B            		LD	L,E
  DC99  3AB1EC        		LD	A,(CRTCD+1)
  DC9C  95            		SUB	L
  DC9D  57            		LD	D,A
  DC9E  CD95DA        		CALL	LOC1
  DCA1  78            		LD	A,B
  DCA2  F630          		OR	030H
  DCA4  47            		LD	B,A
  DCA5  5A            		LD	E,D
  DCA6  2100FF        		LD	HL,KBUF
  DCA9                	GETL2:
  DCA9  CDD0EC        		CALL	_SCRN
  DCAC  03            		INC	BC
  DCAD  77            		LD	(HL),A
  DCAE  23            		INC	HL
  DCAF  1D            		DEC	E
  DCB0  20F7          		JR	NZ,GETL2
  DCB2                	GETL3:
  DCB2  2B            		DEC	HL
  DCB3  7E            		LD	A,(HL)
  DCB4  FE21          		CP	021H
  DCB6  D0            		RET	NC
  DCB7  3600          		LD	(HL),0
  DCB9  15            		DEC	D
  DCBA  20F6          		JR	NZ,GETL3
  DCBC  C9            		RET
                      	
  DCBD                	INKEY:
  DCBD  FB            		EI
  DCBE  E5            		PUSH	HL
  DCBF  2A90EC        		LD	HL,(_KEYPS)
  DCC2  7C            		LD	A,H
  DCC3  AD            		XOR	L
  DCC4  2809          		JR	Z,INKEY1
  DCC6  7C            		LD	A,H
  DCC7  3C            		INC	A
  DCC8  3291EC        		LD	(_KEYPS+1),A
  DCCB  6F            		LD	L,A
  DCCC  26FE          		LD	H,KEYBF/256
  DCCE  7E            		LD	A,(HL)
  DCCF                	INKEY1:
  DCCF  E1            		POP	HL
  DCD0  B7            		OR	A
  DCD1  C9            		RET
                      	
  116D                	AT_RS	EQU	SCR1-AT_SCR1
                      	
                      	;LDFILE.ASM
                      	
                      	;	LSX-Dodgers FILE
                      	
  DCD2                	FILEC:
  DCD2  CDDDDC        		CALL	FILE
  DCD5                	FILEC2:
  DCD5  3ADC00        		LD	A,(FDRV+1)
  DCD8  FE20          		CP	020H
  DCDA  C8            		RET	Z
  DCDB  183B          		JR	SETDIR1
                      	
  DCDD                	FILE:
  DCDD  AF            		XOR	A
  DCDE  32DB00        		LD	(FDRV),A
  DCE1  67            		LD	H,A
  DCE2  6F            		LD	L,A
  DCE3  22E900        		LD	(FDRV+14),HL
  DCE6  CDB7DD        		CALL	SPCUT
  DCE9  CD9CDD        		CALL	CCHK3
  DCEC  2812          		JR	Z,DEVI1
  DCEE  13            		INC	DE
  DCEF  1A            		LD	A,(DE)
  DCF0  1B            		DEC	DE
  DCF1  FE3A          		CP	':'
  DCF3  200B          		JR	NZ,DEVI1
  DCF5  1A            		LD	A,(DE)		;DRIVE
  DCF6  CDDDDF        		CALL	CAP
  DCF9  D640          		SUB	'@'
  DCFB  13            		INC	DE
  DCFC  13            		INC	DE
  DCFD  32DB00        		LD	(FDRV),A
  DD00                	DEVI1:
  DD00  1A            		LD	A,(DE)
  DD01  D65C          		SUB	05CH
  DD03  200B          		JR	NZ,NOROOT
  DD05  210000        		LD	HL,0
  DD08  22F500        		LD	(FDRV+26),HL
  DD0B  2C            		INC	L
  DD0C  22E900        		LD	(FDRV+14),HL
  DD0F  13            		INC	DE
  DD10                	NOROOT:
                      	
  DD10                	SETDIR:
  DD10  CD3CDD        		CALL	FILED
  DD13  1A            		LD	A,(DE)
  DD14  FE5C          		CP	05CH
  DD16  C0            		RET	NZ
  DD17  13            		INC	DE
  DD18                	SETDIR1:
  DD18  3E10          		LD	A,010H		;Directory
  DD1A  32E800        		LD	(FDRV+13),A
  DD1D  D5            		PUSH	DE
  DD1E  11DB00        		LD	DE,FDRV
  DD21  2A1EEC        		LD	HL,(STABLE+2*00FH)
  DD24  CD0F00        		CALL	JP_HL
  DD27  D1            		POP	DE
  DD28  B7            		OR	A
  DD29  C0            		RET	NZ
                      	
  DD2A  3AE800        		LD	A,(FDRV+13)
  DD2D  CB67          		BIT	4,A
  DD2F  C8            		RET	Z
                      	
  DD30  CD83DD        		CALL	FILEI
  DD33  2AF500        		LD	HL,(FDRV+26)
  DD36  23            		INC	HL
  DD37  22E900        		LD	(FDRV+14),HL
  DD3A  18D4          		JR	SETDIR
                      	
  DD3C                	FILED:
  DD3C  CD83DD        		CALL	FILEI
                      	
  DD3F  0608          		LD	B,8
  DD41                	FILE2:
  DD41  CD91DD        		CALL	CCHKF
  DD44  C8            		RET	Z
  DD45  FE2A          		CP	'*'
  DD47  282E          		JR	Z,FILE9
  DD49  FE2E          		CP	'.'
  DD4B  280C          		JR	Z,FILE4
  DD4D  77            		LD	(HL),A
  DD4E  23            		INC	HL
  DD4F  10F0          		DJNZ	FILE2
                      	
  DD51                	FILE3:
  DD51  CD91DD        		CALL	CCHKF
  DD54  C8            		RET	Z
  DD55  FE2E          		CP	'.'
  DD57  20F8          		JR	NZ,FILE3
                      	
  DD59                	FILE4:
  DD59  21E400        		LD	HL,FNAME+8
  DD5C  0603          		LD	B,3
                      	
  DD5E                	FILE4L:
  DD5E  CD91DD        		CALL	CCHKF
  DD61  C8            		RET	Z
  DD62  FE2E          		CP	'.'
  DD64  2008          		JR	NZ,FILE12
  DD66  32DC00        		LD	(FNAME),A	;Parent directory(..)
  DD69  32DD00        		LD	(FNAME+1),A
  DD6C  3E20          		LD	A,020H
  DD6E                	FILE12:
  DD6E  FE2A          		CP	'*'
  DD70  280A          		JR	Z,FILE10
  DD72  77            		LD	(HL),A
  DD73  23            		INC	HL
  DD74  10E8          		DJNZ	FILE4L
  DD76  C9            		RET
                      	
  DD77                	FILE9:
  DD77  CD7CDD        		CALL	FILE10
  DD7A  18D5          		JR	FILE3
                      	
  DD7C                	FILE10:
  DD7C  3E3F          		LD	A,'?'
                      	
  DD7E                	FILE7:
  DD7E  77            		LD	(HL),A
  DD7F  23            		INC	HL
  DD80  10FC          		DJNZ	FILE7
  DD82  C9            		RET
                      	
  DD83                	FILEI:
  DD83  3E20          		LD	A,020H
  DD85  01000B        		LD	BC,11*256
  DD88  21DC00        		LD	HL,FNAME
  DD8B  E5            		PUSH	HL
  DD8C  CD7EDD        		CALL	FILE7
  DD8F  E1            		POP	HL
  DD90  C9            		RET
                      	
  DD91                	CCHKF:
  DD91  1A            		LD	A,(DE)
  DD92  CD99DD        		CALL	CCHK2
  DD95  C8            		RET	Z
  DD96  C3EFE0        		JP	FKAN
                      	
  DD99                	CCHK2:
  DD99  0C            		INC	C
  DD9A  0D            		DEC	C
  DD9B  C0            		RET	NZ
  DD9C                	CCHK3:
  DD9C  FE2B          		CP	'+'
  DD9E  C8            		RET	Z
  DD9F  FE2C          		CP	','
  DDA1  C8            		RET	Z
  DDA2  FE2F          		CP	'/'
  DDA4  C8            		RET	Z
  DDA5  FE3A          		CP	':'
  DDA7  C8            		RET	Z
  DDA8  FE3B          		CP	';'
  DDAA  C8            		RET	Z
  DDAB  FE3D          		CP	'='
  DDAD  C8            		RET	Z
  DDAE  FE5C          		CP	05CH
  DDB0  C8            		RET	Z
  DDB1  FE20          		CP	020H
  DDB3  D0            		RET	NC
  DDB4  BF            		CP	A		;Z=1
  DDB5  C9            		RET
                      	
  DDB6                	SS1:
  DDB6  13            		INC	DE
  DDB7                	SPCUT:
  DDB7  1A            		LD	A,(DE)
  DDB8  FE20          		CP	020H
  DDBA  28FA          		JR	Z,SS1
  DDBC  C9            		RET
                      	
  DDBD                	SETDRVF:
  DDBD  11DB00        		LD	DE,FDRV
  DDC0                	SETDRV0:
  DDC0  CDC9DD        		CALL	SETDRV
  DDC3  FDE1          		POP	IY
  DDC5  C1            		POP	BC
  DDC6  D1            		POP	DE
  DDC7  E1            		POP	HL
  DDC8  C9            		RET
                      	
  DDC9                	SETDRV:
  DDC9  E3            		EX	(SP),HL		;HL=RETRN ADDRESS
  DDCA  D5            		PUSH	DE		;PUSH HL/DE/BC/IY
  DDCB  C5            		PUSH	BC
  DDCC  1A            		LD	A,(DE)
  DDCD  D5            		PUSH	DE
  DDCE  FDE3          		EX	(SP),IY
                      	
  DDD0  CDDCDD        		CALL	GETDRV
  DDD3  3C            		INC	A
  DDD4  FD7700        		LD	(IY+0),A	;(FCB)ドライブ番号
  DDD7  3D            		DEC	A
  DDD8  CDD9EC        		CALL	_CHGDRV
                      	
  DDDB  E9            		JP	(HL)
                      	
  DDDC                	GETDRV:
  DDDC  E67F          		AND	07FH
  DDDE  D601          		SUB	001H
  DDE0  3003          		JR	NC,GETDRV1
  DDE2  3A87EC        		LD	A,(_DVSW)	;Current Drive
  DDE5                	GETDRV1:
  DDE5  3288EC        		LD	(_DRV),A
  DDE8  C9            		RET
                      	
  DDE9                	SOPENX:
  DDE9  CD63DF        		CALL	CHKDDX
  DDEC  3802          		JR	C,SOPENX1
  DDEE  C1            		POP	BC
  DDEF  E9            		JP	(HL)
  DDF0                	SOPENX1:
  DDF0  11A6E2        		LD	DE,SFILE
  DDF3  1A            		LD	A,(DE)
  DDF4  FDBE00        		CP	(IY+0)		;(FCB)ドライブ番号
  DDF7  2024          		JR	NZ,SOPEN
  DDF9  13            		INC	DE
  DDFA  FDE5          		PUSH	IY
  DDFC  E1            		POP	HL
  DDFD  23            		INC	HL
  DDFE  CD93DF        		CALL	CPFILE
  DE01  201A          		JR	NZ,SOPEN
                      	
  DE03  2AF4EB        		LD	HL,(SCDIR)
  DE06  FD750E        		LD	(IY+14),L	;(FCB)アクセスするディレクトリのクラスタ番号+1
  DE09  FD740F        		LD	(IY+15),H
                      	
  DE0C  2AF8EB        		LD	HL,(SFNDF)	;Direcroty location and Flags
  DE0F  229FEC        		LD	(_FILEN),HL
                      	
  DE12  ED5BF6EB      		LD	DE,(SFBPS)
  DE16  21A6E2        		LD	HL,SFILE
  DE19  36FF          		LD	(HL),0FFH
  DE1B  23            		INC	HL
  DE1C  C9            		RET
  DE1D                	SOPEN:
  DE1D  212BDF        		LD	HL,FILESE
  DE20                	SOPENC:
  DE20  225DDE        		LD	(OPENPAT+1),HL
                      	
  DE23  CDE2EC        		CALL	_RDFATX		;Detect Media
  DE26  385A          		JR	C,RDDERR
                      	
  DE28  AF            		XOR	A
  DE29  329FEC        		LD	(_FILEN),A
  DE2C                	SOPEN0:
  DE2C  CD19E0        		CALL	LDDIRX
  DE2F  281C          		JR	Z,SDIRX1
                      	
  DE31  CDCAE6        		CALL	MULSPC
  DE34  CD1CDF        		CALL	DC		;Sub Directory
  DE37  3808          		JR	C,SDIRX0
  DE39  2A7EEC        		LD	HL,(_DTBUF)
  DE3C  7E            		LD	A,(HL)
  DE3D  FE2E          		CP	'.'
  DE3F  2810          		JR	Z,SOPEN1
  DE41                	SDIRX0:
  DE41  AF            		XOR	A
  DE42  32A0EC        		LD	(_DIRF),A
  DE45  FD360E01      		LD	(IY+14),1	;(FCB)レコード・サイズ
  DE49  FD360F00      		LD	(IY+15),0
  DE4D                	SDIRX1:
  DE4D  ED5BFCEB      		LD	DE,(_DIRPS)	;Root Directory
                      	
  DE51                	SOPEN1:
  DE51  0E20          	SDECPAT:LD	C,32		;自己書き換え 1セクタ辺りのディレクトリエントリ数  1024=32 / 512=16
  DE53                	SOPEN1X:
  DE53  CD1CDF        		CALL	DC		;FILE SEARCH
  DE56  382A          		JR	C,RDDERR
  DE58  2A7EEC        		LD	HL,(_DTBUF)
  DE5B                	SOPEN2:
  DE5B  D5            		PUSH	DE
  DE5C  CD2BDF        	OPENPAT:CALL	FILESE		;(Self-rewriting)
  DE5F  D1            		POP	DE
  DE60  3868          		JR	C,SOPENE
  DE62  281B          		JR	Z,NOTSE
  DE64                	SOPEN3:
  DE64  3AA0EC        		LD	A,(_DIRF)
  DE67  B7            		OR	A
  DE68  200C          		JR	NZ,SOPEN5
  DE6A  13            		INC	DE		;ルートディレクトリ
  DE6B  E5            		PUSH	HL
  DE6C  210C00        	RTEPAT:	LD	HL,12		;(Self-rewriting)DPB_0B_MAXDIR
  DE6F  ED52          		SBC	HL,DE		;CF=0 なので SUB HL,DE
  DE71  E1            		POP	HL
  DE72  20DD          		JR	NZ,SOPEN1
  DE74  1807          		JR	SOPEN6
  DE76                	SOPEN5:
  DE76  CDBCE6        		CALL	GNCLX	;END DIR
  DE79  D8            		RET	C
  DE7A  CDD4DF        		CALL	ENDCLX
  DE7D                	SOPEN6:
  DE7D  38D2          		JR	C,SOPEN1
  DE7F                	NOTSE:
  DE7F  37            		SCF			;CF=1
  DE80  9F            		SBC	A,A		;A=0FFH
  DE81  C9            		RET
                      	
  DE82                	RDDERR:
  DE82  BF            		CP	A		;READ ERR CF=1 ZF=1
  DE83  37            		SCF
  DE84  C9            		RET
                      	
  DE85                	NOPEN:
  DE85  212BDF        		LD	HL,FILESE
  DE88  225DDE        		LD	(OPENPAT+1),HL
  DE8B  FD2A98EC      		LD	IY,(_FCB)
  DE8F  CD02E1        		CALL	CHKWILDX
  DE92  30EB          		JR	NC,NOTSE
  DE94  FD7E00        		LD	A,(IY+0)	;(FCB)ドライブ番号
  DE97  3D            		DEC	A
  DE98  3288EC        		LD	(_DRV),A
  DE9B  CDD9EC        		CALL	_CHGDRV
  DE9E  D8            		RET	C
                      	
  DE9F  CD19E0        		CALL	LDDIRX
  DEA2  ED5B9AEC      		LD	DE,(_FBPS)
  DEA6  CD1CDF        		CALL	DC
  DEA9  38D7          		JR	C,RDDERR
  DEAB  3A9EEC        		LD	A,(_FBCNT)
  DEAE  3D            		DEC	A
  DEAF  28B3          		JR	Z,SOPEN3
  DEB1                	NOPEN2:
  DEB1  2A9CEC        		LD	HL,(_FBAD)
  DEB4  012000        		LD	BC,020H
  DEB7  09            		ADD	HL,BC
  DEB8  4F            		LD	C,A
  DEB9  18A0          		JR	SOPEN2
                      	
  DEBB                	SOPENE2:
  DEBB  229CEC        		LD	(_FBAD),HL
  DEBE  79            		LD	A,C
  DEBF  329EEC        		LD	(_FBCNT),A
  DEC2  ED539AEC      		LD	(_FBPS),DE
  DEC6  FD2298EC      		LD	(_FCB),IY
  DECA                	SOPENE:
  DECA  AF            		XOR	A
  DECB  C9            		RET
                      	
  DECC                	COPEN:
  DECC  FD360D20      		LD	(IY+13),020H	;(FCB)属性(アトリビュート)
                      	
  DED0  2148DF        		LD	HL,NEXTSE
  DED3  CD20DE        		CALL	SOPENC
  DED6  D0            		RET	NC
  DED7  C8            		RET	Z
  DED8  3AA0EC        		LD	A,(_DIRF)
  DEDB  D601          		SUB	001H
  DEDD  D8            		RET	C
  DEDE  0601          		LD	B,1
  DEE0  CD5EE1        		CALL	WRDF
  DEE3  D8            		RET	C
  DEE4  ED5BFEEB      		LD	DE,(_CLPS)
  DEE8  D5            		PUSH	DE
  DEE9  CDBCDF        		CALL	DCPAT
  DEEC  CD9FE5        		CALL	DRDNX
  DEEF  2A7EEC        		LD	HL,(_DTBUF)	;ディレクトリエントリを0クリア
  DEF2  5D            		LD	E,L
  DEF3  54            		LD	D,H
  DEF4  13            		INC	DE		;DE,DTBUF+1
  DEF5  01FF03        	SECSZM1:LD	BC,003FFH	;自己書き換え セクタサイズ-1(0x3FF:1023 or 0x1FF:511 or 0xFF:255)
  DEF8  AF            		XOR	A		;データバッファをセクタサイズ分ゼロクリア
  DEF9  77            		LD	(HL),A
  DEFA  EDB0          		LDIR
                      	
  DEFC  3AA0EC        		LD	A,(_DIRF)
  DEFF  B7            		OR	A
  DF00  2815          		JR	Z,COPENE	;ルートディレクトリ
                      	
  DF02  D1            		POP	DE		;DE=(_CLPS)
  DF03  D5            		PUSH	DE
  DF04  3ACDE6        		LD	A,(SPCPAT+1)	;1クラスタの論理セクタ数
  DF07                	COPEN1:
  DF07  3D            		DEC	A
  DF08  280D          		JR	Z,COPENE	;1セクタ辺りのセクタ数が2以上の場合
  DF0A  F5            		PUSH	AF		;データバッファに入らないセクタもゼロクリア
  DF0B  13            		INC	DE
  DF0C  D5            		PUSH	DE
  DF0D  CDBCDF        		CALL	DCPAT
  DF10  CD1BE8        		CALL	DWT_DPB
  DF13  D1            		POP	DE
  DF14  F1            		POP	AF
  DF15  18F0          		JR	COPEN1
  DF17                	COPENE:
  DF17  2A7EEC        		LD	HL,(_DTBUF)
  DF1A  D1            		POP	DE
  DF1B  C9            		RET
                      	
  DF1C                	DC:
  DF1C  ED53FEEB      		LD	(_CLPS),DE
  DF20  C5            		PUSH	BC
  DF21  D5            		PUSH	DE
  DF22  CDBCDF        		CALL	DCPAT
  DF25  CD83E5        		CALL	DRDX
  DF28  D1            		POP	DE
  DF29  C1            		POP	BC
  DF2A  C9            		RET
                      	
  DF2B                	FILESE:
  DF2B  7E            		LD	A,(HL)
  DF2C  B7            		OR	A
  DF2D  C8            		RET	Z		;END:ZF=1 CF=0
  DF2E  FEE5          		CP	0E5H
  DF30  280E          		JR	Z,FILESE1
  DF32  FDE5          		PUSH	IY
  DF34  D1            		POP	DE
  DF35  13            		INC	DE
  DF36  E5            		PUSH	HL
  DF37  CD93DF        		CALL	CPFILE
  DF3A  CCB4DF        		CALL	Z,CPFILE2
  DF3D  E1            		POP	HL
  DF3E  37            		SCF
  DF3F  C8            		RET	Z		;!!!:(ZF=1) CF=1
  DF40                	FILESE1:
  DF40  CD57DF        		CALL	FNEXT
  DF43  20E6          		JR	NZ,FILESE
  DF45                	ZFCF0:
  DF45  F6FF          		OR	0FFH		;ZF=0 CF=0
  DF47  C9            		RET
                      	
  DF48                	NEXTSE:
  DF48  7E            		LD	A,(HL)
  DF49  B7            		OR	A
  DF4A  37            		SCF
  DF4B  C8            		RET	Z		;!!!:ZF=1 CF=1
  DF4C  FEE5          		CP	0E5H
  DF4E  37            		SCF
  DF4F  C8            		RET	Z		;!!!:(ZF=1) CF=1
  DF50  CD57DF        		CALL	FNEXT
  DF53  20F3          		JR	NZ,NEXTSE
  DF55  18EE          		JR	ZFCF0
                      	
  DF57                	FNEXT:
  DF57  E5            		PUSH	HL
  DF58  219FEC        		LD	HL,_FILEN
  DF5B  34            		INC	(HL)
  DF5C  E1            		POP	HL
  DF5D  112000        		LD	DE,020H
  DF60  19            		ADD	HL,DE
  DF61  0D            		DEC	C
  DF62  C9            		RET
                      	
  DF63                	CHKDDX:
  DF63  CD02E1        		CALL	CHKWILDX
  DF66  D8            		RET	C
  DF67  FDE5          		PUSH	IY
  DF69  D1            		POP	DE
  DF6A  13            		INC	DE
  DF6B  2162EC        		LD	HL,DDTB
  DF6E  0604          		LD	B,DDS
  DF70                	CPNAME:
  DF70  C5            		PUSH	BC
  DF71  D5            		PUSH	DE
  DF72  1178E5        		LD	DE,CPBUF
  DF75  010400        		LD	BC,4
  DF78  EDB0          		LDIR
  DF7A  D1            		POP	DE
  DF7B  D5            		PUSH	DE
  DF7C  E5            		PUSH	HL
  DF7D  2178E5        		LD	HL,CPBUF
  DF80  CD93DF        		CALL	CPFILE
  DF83  E1            		POP	HL
  DF84  D1            		POP	DE
  DF85  C1            		POP	BC
  DF86  2005          		JR	NZ,CPNAME1
  DF88  7E            		LD	A,(HL)
  DF89  23            		INC	HL
  DF8A  66            		LD	H,(HL)
  DF8B  6F            		LD	L,A
  DF8C  C9            		RET
  DF8D                	CPNAME1:
  DF8D  23            		INC	HL
  DF8E  23            		INC	HL
  DF8F  10DF          		DJNZ	CPNAME
  DF91  37            		SCF
  DF92  C9            		RET
                      	
  DF93                	CPFILE:
  DF93  C5            		PUSH	BC
  DF94  01000B        		LD	BC,00B00H
  DF97                	CPSTR1:
  DF97  1A            		LD	A,(DE)
  DF98  FE3F          		CP	'?'		;Wild card
  DF9A  2812          		JR	Z,CPSTR2
  DF9C  7E            		LD	A,(HL)
  DF9D  CDE8E0        		CALL	FKANC
  DFA0  E5            		PUSH	HL
  DFA1  67            		LD	H,A
  DFA2  1A            		LD	A,(DE)
  DFA3  CB01          		RLC	C
  DFA5  CDE8E0        		CALL	FKANC
  DFA8  CB09          		RRC	C
  DFAA  BC            		CP	H		;CP (HL),(DE)
  DFAB  E1            		POP	HL
  DFAC  2004          		JR	NZ,CPSTR3
  DFAE                	CPSTR2:
  DFAE  13            		INC	DE
  DFAF  23            		INC	HL
  DFB0  10E5          		DJNZ	CPSTR1
  DFB2                	CPSTR3:
  DFB2  C1            		POP	BC
  DFB3  C9            		RET
                      	
  DFB4                	CPFILE2:
  DFB4  FD7E0D        		LD	A,(IY+13)	;(FCB)属性(アトリビュート)
  DFB7  F6E1          		OR	0E1H
  DFB9  2F            		CPL
  DFBA  A6            		AND	(HL)
  DFBB  C9            		RET
                      	
  DFBC                	DCPAT:
  DFBC  2A7EEC        		LD	HL,(_DTBUF)
  DFBF  3AA0EC        		LD	A,(_DIRF)
  DFC2  B7            		OR	A
  DFC3  C8            		RET	Z
                      	
  DFC4                	CLUST:
  DFC4  3E08          	CLSPAT:	LD	A,8	;+8 (2D)  !ADDCL (Self-rewriting)
  DFC6                	ADD_DE_A:
  DFC6  83            		ADD	A,E	;DE=DE+A
  DFC7  5F            		LD	E,A
  DFC8  8A            		ADC	A,D
  DFC9  93            		SUB	E
  DFCA  57            		LD	D,A
  DFCB  C9            		RET
                      	
  DFCC                	ENDCL:
  DFCC  7A            		LD	A,D	;END CLUSTER
  DFCD  FE01          	CLPAT1:	CP	1	;164=356	(Self-rewriting)
  DFCF  C0            		RET	NZ
  DFD0  7B            		LD	A,E
  DFD1  FE64          	CLPAT2:	CP	064H	;		(Self-rewriting)
  DFD3  C9            		RET
                      	
  DFD4                	ENDCLX:
  DFD4  D5            		PUSH	DE
  DFD5  CDD7E6        		CALL	DIVSPC
  DFD8  CDCCDF        		CALL	ENDCL
  DFDB  D1            		POP	DE
  DFDC  C9            		RET
  DFDD                	CAP:
  DFDD  FE61          		CP	'a'
  DFDF  D8            		RET	C
  DFE0  FE7B          		CP	'z'+1
  DFE2  D0            		RET	NC
  DFE3  D620          		SUB	020H
  DFE5  C9            		RET
  DFE6                	CAP2:
  DFE6  CDDDDF        		CALL	CAP
  DFE9                	CAP3:
  DFE9  CDF2DF        		CALL	CAP4
  DFEC  FE21          		CP	021H
  DFEE  D0            		RET	NC
  DFEF  3EA0          		LD	A,0A0H
  DFF1  C9            		RET
  DFF2                	CAP4:
  DFF2  FE05          		CP	5
  DFF4  C0            		RET	NZ
  DFF5  3EE5          		LD	A,0E5H
  DFF7  C9            		RET
                      	
  DFF8                	CHDIR:
  DFF8  CD38E9        		CALL	GETDPBD
  DFFB  3806          		JR	C,CHDIR2
  DFFD  DD751A        		LD	(IX+01AH),L		;_SDIR_
  E000  DD741B        		LD	(IX+01BH),H		;_SDIR_+1
  E003                	CHDIR2:
  E003  DDE1          		POP	IX
  E005  C9            		RET
                      	
  E006                	LDDIR:
  E006  CD38E9        		CALL	GETDPBD
  E009  DD5E1A        		LD	E,(IX+01AH)		;_SDIR_
  E00C  DD561B        		LD	D,(IX+01BH)		;_SDIR_+1
  E00F  13            		INC	DE
  E010  FD730E        		LD	(IY+14),E	;(FCB)アクセスするディレクトリのクラスタ番号+1
  E013  FD720F        		LD	(IY+15),D
  E016  1B            		DEC	DE
  E017  18EA          		JR	CHDIR2
                      	
  E019                	LDDIRX:
  E019  FD5E0E        		LD	E,(IY+14)	;(FCB)アクセスするディレクトリのクラスタ番号+1
  E01C  FD560F        		LD	D,(IY+15)
  E01F  1B            		DEC	DE
  E020  CDCCDF        		CALL	ENDCL
  E023  D406E0        		CALL	NC,LDDIR
  E026                	LDDIRS:
  E026  7A            		LD	A,D
  E027  B3            		OR	E
  E028  32A0EC        		LD	(_DIRF),A
  E02B  C9            		RET
                      	
  E02C                	KILL:
  E02C  CD02E1        		CALL	CHKWILDX
  E02F  383A          		JR	C,KILLW
  E031  CD63DF        		CALL	CHKDDX
  E034  3F            		CCF
  E035  D4F0DD        		CALL	NC,SOPENX1
  E038                	KILLS:
  E038  3E1F          		LD	A,01FH
  E03A  D47EE0        		CALL	NC,CHKATT
  E03D  D8            		RET	C
  E03E                	KILLSX:
  E03E  36E5          		LD	(HL),0E5H	;DIR
  E040  CDDCE0        		CALL	WTDB
  E043  111A00        		LD	DE,01AH
  E046  19            		ADD	HL,DE
  E047  5E            		LD	E,(HL)
  E048  23            		INC	HL
  E049  56            		LD	D,(HL)
  E04A  1804          		JR	KILLS2
  E04C                	KILLS1:
  E04C  ED5BFEEB      		LD	DE,(_CLPS)	;FAT
  E050                	KILLS2:
  E050  CDCCDF        		CALL	ENDCL
  E053  D0            		RET	NC		;CF=0
  E054  21FEFF        		LD	HL,0-2
  E057  19            		ADD	HL,DE
  E058  D0            		RET	NC		;DE= 0 or 1
  E059  D5            		PUSH	DE
  E05A  CD26E8        		CALL	_GNCL
  E05D  ED53FEEB      		LD	(_CLPS),DE
  E061  D1            		POP	DE
  E062  210000        		LD	HL,0
  E065  D429E8        		CALL	NC,_SNCL
  E068  30E2          		JR	NC,KILLS1
  E06A  C9            		RET
                      	
  E06B                	KILLW:
  E06B  CD1DDE        		CALL	SOPEN
  E06E                	KILLW1:
  E06E  380B          		JR	C,KILLW2
  E070  CDBBDE        		CALL	SOPENE2
  E073  CD38E0        		CALL	KILLS
  E076  CD85DE        		CALL	NOPEN
  E079  18F3          		JR	KILLW1
  E07B                	KILLW2:
  E07B  C8            		RET	Z
  E07C  3F            		CCF
  E07D  C9            		RET
                      	
  E07E                	CHKATT:
  E07E  E5            		PUSH	HL
  E07F  110B00        		LD	DE,00BH
  E082  19            		ADD	HL,DE
  E083  A6            		AND	(HL)
  E084  E1            		POP	HL
  E085  C8            		RET	Z
  E086  37            		SCF
  E087  C9            		RET
                      	
  E088                	NAME:
  E088  CD02E1        		CALL	CHKWILDX
  E08B  D8            		RET	C
  E08C  110400        		LD	DE,4
  E08F  19            		ADD	HL,DE
  E090  22A8E0        		LD	(NAMEP+2),HL
  E093  23            		INC	HL
  E094  CD06E1        		CALL	CHKWILD
  E097  D8            		RET	C
                      	
  E098  CDF0DD        		CALL	SOPENX1
  E09B  3E0F          		LD	A,00FH
  E09D  D47EE0        		CALL	NC,CHKATT
  E0A0  D8            		RET	C
                      	
  E0A1  FD7E00        		LD	A,(IY+0)
  E0A4  FDE5          		PUSH	IY
  E0A6  FD210000      	NAMEP:	LD	IY,0
  E0AA  FD7700        		LD	(IY+0),A
  E0AD  CDF0DD        		CALL	SOPENX1
  E0B0  FDE3          		EX	(SP),IY
  E0B2  3F            		CCF
  E0B3  D41DDE        		CALL	NC,SOPEN
  E0B6  EB            		EX	DE,HL
  E0B7  E1            		POP	HL
  E0B8  D8            		RET	C
                      	
  E0B9                	SETNAME:
  E0B9  01000B        		LD	BC,11*256
  E0BC  23            		INC	HL
  E0BD  7E            		LD	A,(HL)
  E0BE  FEE5          		CP	0E5H
  E0C0  2004          		JR	NZ,SNAME1
  E0C2  3E05          		LD	A,5
  E0C4  180E          		JR	SNAME3
  E0C6                	SNAME1:
  E0C6  7E            		LD	A,(HL)
  E0C7  0C            		INC	C
  E0C8  0D            		DEC	C
  E0C9  2009          		JR	NZ,SNAME3
  E0CB  CDDDDF        		CALL	CAP
  E0CE  FEA0          		CP	0A0H
  E0D0  2002          		JR	NZ,SNAME3
  E0D2  3E20          		LD	A,020H
  E0D4                	SNAME3:
  E0D4  12            		LD	(DE),A
  E0D5  7E            		LD	A,(HL)
  E0D6  23            		INC	HL
  E0D7  CDEFE0        		CALL	FKAN
  E0DA  10EA          		DJNZ	SNAME1
  E0DC                	WTDB:
  E0DC  3EFF          		LD	A,0FFH
  E0DE  32A6E2        		LD	(SFILE),A
  E0E1                	SWTDBF:
  E0E1  3E01          		LD	A,1
  E0E3  32A4EC        		LD	(_WTDBF),A
  E0E6  AF            		XOR	A
  E0E7  C9            		RET
                      	
  E0E8                	FKANC:
  E0E8  CB41          		BIT	0,C
  E0EA  CCE6DF        		CALL	Z,CAP2
  E0ED  1801          		JR	FKANX
  E0EF                	FKAN:
  E0EF  13            		INC	DE
  E0F0                	FKANX:
  E0F0  CB41          		BIT	0,C
  E0F2  CB81          		RES	0,C
  E0F4  C0            		RET	NZ
  E0F5  FE80          		CP	080H
  E0F7  D8            		RET	C
  E0F8  FEA0          		CP	0A0H
  E0FA  3803          		JR	C,FKAN1
  E0FC  FEE0          		CP	0E0H
  E0FE  D8            		RET	C
  E0FF                	FKAN1:
  E0FF  0C            		INC	C
  E100  A7            		AND	A
  E101  C9            		RET
                      	
  E102                	CHKWILDX:
  E102  FDE5          		PUSH	IY
  E104  E1            		POP	HL
  E105  23            		INC	HL
  E106                	CHKWILD:
  E106  060B          		LD	B,11
  E108  3E3F          		LD	A,'?'
  E10A                	CHKWIL1:
  E10A  BE            		CP	(HL)
  E10B  23            		INC	HL
  E10C  37            		SCF
  E10D  C8            		RET	Z
  E10E  10FA          		DJNZ	CHKWIL1
  E110  AF            		XOR	A
  E111  C9            		RET
                      	
  E112                	SDIRENT:		;IY=FCB HL=DIR
  E112  D5            		PUSH	DE
  E113  E5            		PUSH	HL
  E114  FDE5          		PUSH	IY
  E116  D1            		POP	DE
  E117  EB            		EX	DE,HL
  E118  CDB9E0        		CALL	SETNAME
                      	;				Attribute
  E11B  FD7E0D        		LD	A,(IY+13)	;(FCB)属性(アトリビュート)
  E11E  12            		LD	(DE),A
  E11F  13            		INC	DE
                      	;				Reserved
  E120  AF            		XOR	A
  E121  060A          		LD	B,10
  E123                	SDE1:
  E123  12            		LD	(DE),A
  E124  13            		INC	DE
  E125  10FC          		DJNZ	SDE1
                      						;(FCB)ファイルを最後に変更した時刻
  E127  21DAEB        		LD	HL,SDDATA		;(FCB)ファイルを最後に変更した日付
  E12A  060A          		LD	B,SDDATAE-SDDATA	;(FCB)ファイルの先頭クラスタ
  E12C                	SDLOOP:					;(FCB)ファイルのサイズ(バイト単位)
  E12C  7E            		LD	A,(HL)
  E12D  23            		INC	HL
  E12E  3233E1        		LD	(SDPAT+2),A
  E131  FD7E00        	SDPAT:	LD	A,(IY+0)	;LD A,(IY+A)
  E134  12            		LD	(DE),A
  E135  13            		INC	DE
  E136  10F4          		DJNZ	SDLOOP
                      	
  E138  AF            		XOR	A
  E139  E1            		POP	HL
  E13A  D1            		POP	DE
  E13B  C9            		RET
                      	
  E13C                	WOPEN:
  E13C  FD7E0D        		LD	A,(IY+13)	;(FCB)属性(アトリビュート)
  E13F  E61F          		AND	01FH
  E141  37            		SCF
  E142  C0            		RET	NZ
  E143  FD361CFE      		LD	(IY+28),0FEH	;(FCB)オープン・モード
  E147                	TOPEN2:
  E147  AF            		XOR	A
  E148                	TOPEN:				;Initializes the time stamp
  E148  FD3617FF      		LD	(IY+23),0FFH	;(FCB)ファイルを最後に変更した時刻
  E14C  C9            		RET
                      	
  E14D                	WRDFX:
  E14D  3ACDE6        		LD	A,(SPCPAT+1)	;1クラスタの論理セクタ
  E150                	L_WRFX:
  E150  1F            		RRA		;->CF
  E151  3804          		JR	C,E_WRFX
  E153  CB39          		SRL	C	;C=C/2
  E155  18F9          		JR	L_WRFX
  E157                	E_WRFX:
  E157  41            		LD	B,C
  E158  04            		INC	B
  E159  3E37          		LD	A,037H		;SCF
  E15B  329CE5        		LD	(DRDN1),A
                      	
  E15E                	WRDF:				;Bクラスタ分FATを確保する
  E15E  110200        		LD	DE,2
  E161  CDCAE6        		CALL	MULSPC
  E164                	WRDF1:
  E164  C5            		PUSH	BC
  E165  D5            		PUSH	DE
  E166  CDD7E6        		CALL	DIVSPC
  E169  CD26E8        		CALL	_GNCL
  E16C  3824          		JR	C,WRDF3
  E16E  7A            		LD	A,D		;空いているかチェック
  E16F  B3            		OR	E
  E170  2032          		JR	NZ,WRDF4
  E172  E1            		POP	HL		;HL=空いているクラスタ
  E173  E5            		PUSH	HL
  E174  ED5BFEEB      		LD	DE,(_CLPS)	;DE=元の(_CLPS)
  E178  22FEEB        		LD	(_CLPS),HL
  E17B  7A            		LD	A,D		;元の(_CLPS)が 0 か?
  E17C  B3            		OR	E
  E17D  EB            		EX	DE,HL		;
  E17E  CDD7E6        		CALL	DIVSPC		;ここでフラグは変化しない
  E181  EB            		EX	DE,HL		;
  E182  2008          		JR	NZ,WRDF2
  E184  FD751A        		LD	(IY+26),L	;(FCB)ファイルの先頭クラスタ
  E187  FD741B        		LD	(IY+27),H	;元が空の場合はFCBにクラスタをセットする
  E18A  1806          		JR	WRDF3
  E18C                	WRDF2:
  E18C  CDD7E6        		CALL	DIVSPC
  E18F  CD29E8        		CALL	_SNCL
  E192                	WRDF3:
  E192  D1            		POP	DE
  E193  C1            		POP	BC
  E194  D8            		RET	C
  E195  100F          		DJNZ	WRDF5		;ここでループカウンタチェック
  E197  ED5BFEEB      		LD	DE,(_CLPS)
  E19B  CDD7E6        		CALL	DIVSPC
  E19E  21FFFF        		LD	HL,0FFFFH	;FATエントリ終了(EOCマーク)
  E1A1  C329E8        		JP	_SNCL
                      	
  E1A4                	WRDF4:				;DEクラスタが空じゃないので次に移動する
  E1A4  D1            		POP	DE
  E1A5  C1            		POP	BC
  E1A6                	WRDF5:
  E1A6  CDD7E6        		CALL	DIVSPC
  E1A9  13            		INC	DE
  E1AA  CDCCDF        		CALL	ENDCL
  E1AD  CDCAE6        		CALL	MULSPC
  E1B0  38B2          		JR	C,WRDF1
  E1B2  37            		SCF
  E1B3  C9            		RET
                      	
  E1B4                	RWXR:
  E1B4  3A14E5        		LD	A,(SECSZ+2)	;1024=4 / 512=2 / 256=1
  E1B7                	L_RWX:
  E1B7  1F            		RRA		;->CF
  E1B8  3806          		JR	C,E_RWX
  E1BA  CB38          		SRL	B	;BC=BC/2
  E1BC  CB19          		RR	C	;
  E1BE  18F7          		JR	L_RWX
  E1C0                	E_RWX:
  E1C0  FD5E1A        		LD	E,(IY+26)	;(FCB)ファイルの先頭クラスタ
  E1C3  FD561B        		LD	D,(IY+27)
  E1C6  CDCAE6        		CALL	MULSPC
  E1C9                	RWX1:
  E1C9  ED53FEEB      		LD	(_CLPS),DE
  E1CD  7A            		LD	A,D
  E1CE  B3            		OR	E
  E1CF  37            		SCF
  E1D0  C8            		RET	Z	;RET DE==0
                      	
  E1D1  78            		LD	A,B
  E1D2  B1            		OR	C
  E1D3  C8            		RET	Z	;RET BC==0
                      	
  E1D4  CDBCE6        		CALL	GNCLX
  E1D7  D8            		RET	C
  E1D8  0B            		DEC	BC
                      	
  E1D9  CDD4DF        		CALL	ENDCLX
  E1DC  38EB          		JR	C,RWX1
  E1DE  37            		SCF
  E1DF  C9            		RET
                      	
  E1E0                	DSKF:
  E1E0  110000        	MAXCLP:	LD	DE,0
  E1E3  210000        		LD	HL,0
  E1E6                	DSKF1:
  E1E6  D5            		PUSH	DE
  E1E7  CD26E8        		CALL	_GNCL
  E1EA  380C          		JR	C,POPSCF
  E1EC  7A            		LD	A,D
  E1ED  B3            		OR	E
  E1EE  2001          		JR	NZ,DSKF2
  E1F0  23            		INC	HL
  E1F1                	DSKF2:
  E1F1  D1            		POP	DE
  E1F2  1B            		DEC	DE
  E1F3  7A            		LD	A,D
  E1F4  B3            		OR	E
  E1F5  20EF          		JR	NZ,DSKF1
  E1F7  C9            		RET
                      	
  E1F8                	POPSCF:
  E1F8  F1            		POP	AF
  E1F9  37            		SCF
  E1FA  C9            		RET
                      	
  E1FB                	SETTMS:
  E1FB  FD7E17        		LD	A,(IY+23)	;(FCB)ファイルを最後に変更した時刻
  E1FE  3C            		INC	A
  E1FF  C0            		RET	NZ		;ファイルが更新されていない
  E200                	SETTMSX:			;FCBに日付時刻をセットする
  E200  CD9BD8        		CALL	_SYS2C		;(BDOS)時刻の獲得
                      					;H←時  L←分  D←秒
  E203  CB25          		SLA	L		;L=L/2
  E205  CB25          		SLA	L		;L=L/2
  E207  29            		ADD	HL,HL		;*2
  E208  29            		ADD	HL,HL		;*4
  E209  29            		ADD	HL,HL		;*8
  E20A  7A            		LD	A,D
  E20B  0F            		RRCA			;bit.0->7->->->0->C
  E20C  E61F          		AND	01FH
  E20E  B5            		OR	L
  E20F  FD7716        		LD	(IY+22),A	;(FCB)ファイルを最後に変更した時刻
  E212  FD7417        		LD	(IY+23),H
                      	
  E215  CD61D8        		CALL	_SYS2A		;(BDOS)日付の獲得
                      					;HL←年  D←月  E←日
  E218  0144F8        		LD	BC,0-1980
  E21B  09            		ADD	HL,BC
  E21C  65            		LD	H,L
                      	
  E21D  7A            		LD	A,D
  E21E  87            		ADD	A,A		;*2
  E21F  87            		ADD	A,A		;*4
  E220  87            		ADD	A,A		;*8
  E221  87            		ADD	A,A		;*16
  E222  6F            		LD	L,A
  E223  29            		ADD	HL,HL		;*32
  E224  7D            		LD	A,L
  E225  B3            		OR	E
  E226  FD7714        		LD	(IY+20),A	;(FCB)ファイルを最後に変更した日付
  E229  FD7415        		LD	(IY+21),H
  E22C  C9            		RET
                      	
  E22D                	PUSHRR:
  E22D  CD33E2        		CALL	SUBRR
  E230                	POPRR1:
  E230  EDB0          		LDIR
  E232  C9            		RET
                      	
  E233                	SUBRR:
  E233  FDE5          		PUSH	IY
  E235  E1            		POP	HL
  E236  112100        		LD	DE,33
  E239  19            		ADD	HL,DE
  E23A  11C7E2        		LD	DE,HLBUF
  E23D  010300        		LD	BC,3
  E240  C9            		RET
                      	
  E241                	SETSEQ:
  E241  F5            		PUSH	AF		;AHL=Random record
  E242  FD7E21        		LD	A,(IY+33)	;(FCB)ランダム・レコード
  E245  FD6E22        		LD	L,(IY+34)
  E248  FD6623        		LD	H,(IY+35)
                      	
  E24B  CD67E2        		CALL	SSQ1
                      	
  E24E  29            		ADD	HL,HL
  E24F  CB3D          		SRL	L		;L=L/2
  E251  FD7520        		LD	(IY+32),L	;(FCB)カレント・レコード
  E254  FD740C        		LD	(IY+12),H	;(FCB)カレント・ブロック
  E257  F1            		POP	AF
                      	
  E258                	POPRR:
  E258  CD33E2        		CALL	SUBRR
  E25B  EB            		EX	DE,HL
  E25C  18D2          		JR	POPRR1
                      	
  E25E                	GETSIZE:
  E25E  FD7E10        		LD	A,(IY+16)	;(FCB)ファイルのサイズ(バイト単位)
  E261  FD6E11        		LD	L,(IY+17)
  E264  FD6612        		LD	H,(IY+18)
  E267                	SSQ1:				;バイト単位からCP/Mのレコード単位を求める（1レコード=128バイト）
  E267  87            		ADD	A,A		;in HLA => out HL
  E268  ED6A          		ADC	HL,HL
  E26A  B7            		OR	A
  E26B  C8            		RET	Z
  E26C  23            		INC	HL
  E26D  C9            		RET
                      	
  E26E                	GETSEQ:
  E26E  FD6E20        		LD	L,(IY+32)	;(FCB)カレント・レコード
  E271  FD660C        		LD	H,(IY+12)	;(FCB)カレント・ブロック
                      	
  E274  CB25          		SLA	L	;L=L*2
                      	
  E276  CB3C          		SRL	H	;HL=HL/2
  E278  CB1D          		RR	L	;
  E27A  C9            		RET
                      	
  E27B                	RB_WRITE:
  E27B  C5            		PUSH	BC
  E27C  ED4B4CEC      		LD	BC,(STABLE+2*026H)	;(BDOS)ランダム・ブロック・ライト
  E280  1805          		JR	RBRW
  E282                	RB_READ:
  E282  C5            		PUSH	BC
  E283  ED4B4EEC      		LD	BC,(STABLE+2*027H)	;(BDOS)ランダム・ブロック・リード
  E287                	RBRW:
  E287  AF            		XOR	A	;HLA = HL*128
  E288  CB3C          		SRL	H	;HL=HL/2
  E28A  CB1D          		RR	L	;
  E28C  1F            		RRA			;HLA
  E28D  FD7721        		LD	(IY+33),A	;(FCB)ランダム・レコード
  E290  FD7522        		LD	(IY+34),L
  E293  FD7423        		LD	(IY+35),H
  E296  218000        		LD	HL,128
                      	
  E299  FDE5          		PUSH	IY
  E29B  D1            		POP	DE
  E29C  D5            		PUSH	DE
  E29D  CDA4E2        		CALL	JP_BC
  E2A0  FDE1          		POP	IY
  E2A2  C1            		POP	BC
  E2A3  C9            		RET
  E2A4                	JP_BC:
  E2A4  C5            		PUSH	BC
  E2A5  C9            		RET
                      	
  E2A6                	SFILE:	DS	33		;DRV FILENAME
  E2C7                	HLBUF:	DS	3		;Random record buffer
                      	
                      	;LDFILE2.ASM
                      	
                      	;	LSX-Dodgers FILE2
                      	
  E2CA                	RBWDD:
  E2CA  E5            		PUSH	HL
  E2CB  C1            		POP	BC
  E2CC  21A4E3        		LD	HL,NUL
  E2CF  CDD8E3        		CALL	DDX
  E2D2  2003          		JR	NZ,RBWDD2
  E2D4  2A08EC        		LD	HL,(STABLE+2*4)
  E2D7                	RBWDD2:
  E2D7  FE43          		CP	'C'
  E2D9  2003          		JR	NZ,RBWDD3
  E2DB  2189DA        		LD	HL,PRINTS
  E2DE                	RBWDD3:
  E2DE  FE50          		CP	'P'
  E2E0  2003          		JR	NZ,RBWDD4
  E2E2  2A0AEC        		LD	HL,(STABLE+2*5)
  E2E5                	RBWDD4:
  E2E5  22F3E2        		LD	(RBWDDP+1),HL
  E2E8  2A8AEC        		LD	HL,(_DTA)
  E2EB                	RBWDD1:
  E2EB  78            		LD	A,B
  E2EC  B1            		OR	C
  E2ED                	RBWDD5:
  E2ED  CA9FE3        		JP	Z,RBW1
  E2F0  5E            		LD	E,(HL)
  E2F1  23            		INC	HL
  E2F2  CDD9D7        	RBWDDP:	CALL	_SYS02
  E2F5  DABBE3        		JP	C,RBRERR
  E2F8  3E1A          		LD	A,01AH
  E2FA  BB            		CP	E
  E2FB  28F0          		JR	Z,RBWDD5
  E2FD  0B            		DEC	BC
  E2FE  18EB          		JR	RBWDD1
                      	
                      					;Write random block
  E300                	_SYS26:		;(BDOS)ランダム・ブロック・ライト
  E300  AF            		XOR	A
  E301  329CE5        		LD	(DRDN1),A	;NOP
  E304  2256E5        		LD	(LEFT+1),HL	;HL←書き込むレコード数
  E307  2278E5        		LD	(LEFTX),HL
  E30A  CDC9DD        		CALL	SETDRV
                      	
  E30D  CDC2E4        		CALL	RBX0
  E310  DAA6E3        		JP	C,RBWERR
  E313  28B5          		JR	Z,RBWDD		;デバイスデスクプリタ
  E315  CD3CE1        		CALL	WOPEN
  E318  DAA6E3        		JP	C,RBWERR
  E31B  7C            		LD	A,H
  E31C  B5            		OR	L
  E31D  CA9FE3        		JP	Z,RBW1
                      	
  E320  2B            		DEC	HL
                      	
  E321  CD6EE5        		CALL	GET_RR_CDE	;CDE=Random record
                      	
  E324  AF            		XOR	A	;AHL=HL+CDE
  E325  19            		ADD	HL,DE
  E326  89            		ADC	A,C
                      	
  E327  47            		LD	B,A
  E328  4C            		LD	C,H
                      	
  E329  CDB4E1        		CALL	RWXR
  E32C  DC4DE1        		CALL	C,WRDFX
  E32F  DAA6E3        		JP	C,RBWERR
                      		
  E332  CDEBE4        		CALL	RBX2
  E335  281A          		JR	Z,RBWB		;NZ=セクタ以下の端数がある
  E337  CDFEE4        		CALL	RBXA		
  E33A  386A          		JR	C,RBWERR
  E33C  EB            		EX	DE,HL
  E33D  C5            		PUSH	BC
  E33E  EDB0          		LDIR
  E340  227AE5        		LD	(DTAX),HL
                      	
  E343  CDE1E0        		CALL	SWTDBF		;バッファデータは更新された
                      	
  E346  2A78E5        		LD	HL,(LEFTX)
  E349  D1            		POP	DE
  E34A  ED52          		SBC	HL,DE
  E34C  2278E5        		LD	(LEFTX),HL
  E34F  282E          		JR	Z,RBWEND
                      	
  E351                	RBWB:
  E351  CD32E5        		CALL	RBXB
  E354  2813          		JR	Z,RBWC
  E356                	RBWB1:
  E356  C5            		PUSH	BC
  E357  D5            		PUSH	DE
  E358  CDC4DF        		CALL	CLUST
  E35B  CD1BE8        		CALL	DWT_DPB
  E35E  D1            		POP	DE
  E35F  C1            		POP	BC
  E360  3844          		JR	C,RBWERR
  E362  CDBCE6        		CALL	GNCLX
  E365  383F          		JR	C,RBWERR
  E367  10ED          		DJNZ	RBWB1
  E369                	RBWC:
  E369  CD4AE5        		CALL	RBXC
  E36C  2811          		JR	Z,RBWEND
                      	
  E36E  CDC4DF        		CALL	CLUST
  E371  CD9BE5        		CALL	DRDN
  E374  3830          		JR	C,RBWERR
  E376  ED5B7EEC      		LD	DE,(_DTBUF)
  E37A  EDB0          		LDIR
  E37C  CDE1E0        		CALL	SWTDBF		;バッファデータは更新された
  E37F                	RBWEND:
  E37F  CD55E5        		CALL	RBXEND
                      	
  E382  CDD1E4        		CALL	RBX1
  E385  3018          		JR	NC,RBW1
  E387  2A56E5        		LD	HL,(LEFT+1)
  E38A  FD5E10        		LD	E,(IY+16)	;(FCB)ファイルのサイズ(バイト単位)
  E38D  FD5611        		LD	D,(IY+17)	;CDE=File size
  E390  FD4E12        		LD	C,(IY+18)
  E393  AF            		XOR	A
  E394  19            		ADD	HL,DE
  E395  89            		ADC	A,C
  E396  FD7510        		LD	(IY+16),L	;(FCB)ファイルのサイズ(バイト単位)
  E399  FD7411        		LD	(IY+17),H
  E39C  FD7712        		LD	(IY+18),A
  E39F                	RBW1:
  E39F  FDE1          		POP	IY
  E3A1  C1            		POP	BC
  E3A2  D1            		POP	DE
  E3A3  E1            		POP	HL
  E3A4                	NUL:
  E3A4  AF            		XOR	A
  E3A5  C9            		RET
                      	
  E3A6                	RBWERR:
  E3A6  FDE5          		PUSH	IY
  E3A8  D1            		POP	DE
  E3A9  2A20EC        		LD	HL,(STABLE+2*010H)
  E3AC  CD0F00        		CALL	JP_HL
  E3AF                	RBRERR1:
  E3AF  3E01          		LD	A,001H
  E3B1                	RBRERR2:
  E3B1  FDE1          		POP	IY
  E3B3  C1            		POP	BC
  E3B4  D1            		POP	DE
  E3B5  E1            		POP	HL
  E3B6  37            		SCF
  E3B7  210000        		LD	HL,0
  E3BA  C9            		RET
                      	
  E3BB                	RBRERR:
  E3BB  3EFF          		LD	A,0FFH
  E3BD  18F2          		JR	RBRERR2
                      	
  E3BF                	RBRFL:
  E3BF  3E00          	RBRFLP:	LD	A,000H
  E3C1  FE0D          		CP	00DH
  E3C3  2005          		JR	NZ,RBRFL1
  E3C5  D5            		PUSH	DE
  E3C6  1E0A          		LD	E,00AH
  E3C8  1805          		JR	RBRFL2
  E3CA                	RBRFL1:
  E3CA  D5            		PUSH	DE
  E3CB  CDA8D3        		CALL	_SYS07
  E3CE  5F            		LD	E,A
  E3CF                	RBRFL2:
  E3CF  CDCDEC        		CALL	_PRINT
  E3D2  7B            		LD	A,E
  E3D3  D1            		POP	DE
  E3D4  32C0E3        		LD	(RBRFLP+1),A
  E3D7  C9            		RET
  E3D8                	DDX:
  E3D8  FD7E01        		LD	A,(IY+1)	;(FCB)主ファイル名
  E3DB  CDDDDF        		CALL	CAP
  E3DE  FE41          		CP	'A'
  E3E0  C9            		RET
                      	
  E3E1                	RBRDD:
  E3E1  E5            		PUSH	HL
  E3E2  C1            		POP	BC
  E3E3  21BFE3        		LD	HL,RBRFL
  E3E6  CDD8E3        		CALL	DDX
  E3E9  2005          		JR	NZ,RBRDD2
  E3EB  2A06EC        		LD	HL,(STABLE+2*3)
  E3EE  1804          		JR	RBRDD3
  E3F0                	RBRDD2:
  E3F0  FE43          		CP	'C'
  E3F2  202C          		JR	NZ,RBRDERR
  E3F4                	RBRDD3:
  E3F4  2204E4        		LD	(RBRDDP+1),HL
                      	
  E3F7  ED5B8AEC      		LD	DE,(_DTA)
  E3FB  210000        		LD	HL,0
  E3FE                	RBRDD1:
  E3FE  78            		LD	A,B
  E3FF  B1            		OR	C
  E400  2818          		JR	Z,RBRDDE1
  E402  23            		INC	HL
  E403  CDBFE3        	RBRDDP:	CALL	RBRFL
  E406  380D          		JR	C,RBRDDE
  E408  FE1A          		CP	01AH
  E40A  2809          		JR	Z,RBRDDE
  E40C  FE03          		CP	3
  E40E  2805          		JR	Z,RBRDDE
  E410  12            		LD	(DE),A
  E411  13            		INC	DE
  E412  0B            		DEC	BC
  E413  18E9          		JR	RBRDD1
                      	
  E415                	RBRDDE:
  E415  3E1A          		LD	A,01AH
  E417  12            		LD	(DE),A
  E418                	RBRDDE2:
  E418  AF            		XOR	A
  E419  3C            		INC	A
  E41A                	RBRDDE1:
  E41A  32AEE4        		LD	(RBRAP+1),A
  E41D  C3A7E4        		JP	RBREND0
  E420                	RBRDERR:
  E420  210000        		LD	HL,0
  E423  18F3          		JR	RBRDDE2
                      	
                      					;Read random block
  E425                	_SYS27:		;(BDOS)ランダム・ブロック・リード
  E425  2278E5        		LD	(LEFTX),HL
  E428  CDC9DD        		CALL	SETDRV
                      	
  E42B  FDCB0D66      		BIT	4,(IY+13)	;(FCB)属性(アトリビュート)
  E42F  C2B0E4        		JP	NZ,RBRDIR	;ディレクトリ
  E432  CDC2E4        		CALL	RBX0
  E435  DABBE3        		JP	C,RBRERR
  E438  28A7          		JR	Z,RBRDD
  E43A  CDD1E4        		CALL	RBX1
  E43D  DAAFE3        		JP	C,RBRERR1
  E440  79            		LD	A,C
  E441  EB            		EX	DE,HL
  E442  ED52          		SBC	HL,DE		;CP 0HL,CDE
  E444  19            		ADD	HL,DE
  E445  DE00          		SBC	A,000H
  E447  3801          		JR	C,RBR1
  E449  EB            		EX	DE,HL
  E44A                	RBR1:
  E44A  9F            		SBC	A,A
  E44B  E601          		AND	1
  E44D  32AEE4        		LD	(RBRAP+1),A
                      	
  E450  7C            		LD	A,H
  E451  B5            		OR	L
  E452  CAA7E4        		JP	Z,RBREND0
                      	
  E455  2256E5        		LD	(LEFT+1),HL	;Read record byte
  E458  2278E5        		LD	(LEFTX),HL
                      	
  E45B  CDEBE4        		CALL	RBX2
  E45E  2819          		JR	Z,RBRB
  E460  CDFEE4        		CALL	RBXA
  E463  DABBE3        		JP	C,RBRERR
  E466  C5            		PUSH	BC
  E467  EDB0          		LDIR
  E469  ED537AE5      		LD	(DTAX),DE
  E46D  2A78E5        		LD	HL,(LEFTX)
  E470  D1            		POP	DE
  E471  A7            		AND	A
  E472  ED52          		SBC	HL,DE
  E474  2278E5        		LD	(LEFTX),HL
  E477  282B          		JR	Z,RBREND
                      	
  E479                	RBRB:
  E479  CD32E5        		CALL	RBXB
  E47C  2812          		JR	Z,RBRC
  E47E                	RBRB1:
  E47E  C5            		PUSH	BC
  E47F  D5            		PUSH	DE
  E480  CDC4DF        		CALL	CLUST
  E483  CDCBE7        		CALL	DRD_DPB
  E486  D1            		POP	DE
  E487  C1            		POP	BC
  E488  D4BCE6        		CALL	NC,GNCLX
  E48B  DABBE3        		JP	C,RBRERR
  E48E  10EE          		DJNZ	RBRB1
  E490                	RBRC:
  E490  CD4AE5        		CALL	RBXC
  E493  280F          		JR	Z,RBREND
                      	
  E495  CDC4DF        		CALL	CLUST
  E498  CD83E5        		CALL	DRDX
  E49B  DABBE3        		JP	C,RBRERR
  E49E  EB            		EX	DE,HL
  E49F  2A7EEC        		LD	HL,(_DTBUF)
  E4A2  EDB0          		LDIR
  E4A4                	RBREND:
  E4A4  CD55E5        		CALL	RBXEND
  E4A7                	RBREND0:
  E4A7  FDE1          		POP	IY
  E4A9  C1            		POP	BC
  E4AA  D1            		POP	DE
  E4AB  F1            		POP	AF	;(HL)
  E4AC  AF            		XOR	A
  E4AD  3E00          	RBRAP:	LD	A,000H
  E4AF  C9            		RET
                      	
  E4B0                	RBRDIR:
  E4B0  FD6E1A        		LD	L,(IY+26)	;(FCB)ファイルの先頭クラスタ
  E4B3  FD661B        		LD	H,(IY+27)
  E4B6  CDF8DF        		CALL	CHDIR
  E4B9  AF            		XOR	A
  E4BA  67            		LD	H,A
  E4BB  6F            		LD	L,A
  E4BC  3C            		INC	A
  E4BD  32AEE4        		LD	(RBRAP+1),A
  E4C0  18E5          		JR	RBREND0
                      	
  E4C2                	RBX0:
  E4C2  2A8AEC        		LD	HL,(_DTA)
  E4C5  227AE5        		LD	(DTAX),HL
  E4C8  2A78E5        		LD	HL,(LEFTX)
  E4CB  FD7E1C        		LD	A,(IY+28)	;(FCB)オープン・モード
  E4CE  D6FD          		SUB	0FDH
  E4D0  C9            		RET
                      	
  E4D1                	RBX1:
  E4D1  E5            		PUSH	HL		;Record byte
                      					;AHL=File size
  E4D2  FD6E10        		LD	L,(IY+16)	;ファイルのサイズ(バイト単位)
  E4D5  FD6611        		LD	H,(IY+17)
  E4D8  FD7E12        		LD	A,(IY+18)
                      	
  E4DB  CD6EE5        		CALL	GET_RR_CDE	;CDE=Random record
                      	
  E4DE  A7            		AND	A
  E4DF  ED52          		SBC	HL,DE
  E4E1  99            		SBC	A,C
  E4E2  D1            		POP	DE
                      	
  E4E3  D8            		RET	C
  E4E4  4F            		LD	C,A
  E4E5  EB            		EX	DE,HL	;CDE=File byte	HL=Record byte
  E4E6  B2            		OR	D
  E4E7  B3            		OR	E
  E4E8  C0            		RET	NZ
  E4E9  37            		SCF
  E4EA  C9            		RET
                      	
  E4EB                	RBX2:				;Cluster settings
  E4EB  FD4E22        		LD	C,(IY+34)	;(+33)(FCB)ランダム・レコード
  E4EE  FD4623        		LD	B,(IY+35)
  E4F1  CDB4E1        		CALL	RWXR
  E4F4  3AF7DE        		LD	A,(SECSZM1+2)	;1024=3 / 512=1 / 256=0
  E4F7  FDA622        		AND	(IY+34)
  E4FA  FDB621        		OR	(IY+33)
  E4FD  C9            		RET
                      	
  E4FE                	RBXA:
  E4FE  D5            		PUSH	DE
  E4FF  CDC4DF        		CALL	CLUST
  E502  CD83E5        		CALL	DRDX
  E505  D1            		POP	DE
  E506  D8            		RET	C
  E507  CDBCE6        		CALL	GNCLX
  E50A  D8            		RET	C
  E50B  ED53FEEB      		LD	(_CLPS),DE
                      	
  E50F  FD4E21        		LD	C,(IY+33)	;(FCB)ランダム・レコード
  E512  210004        	SECSZ:	LD	HL,0400H	;自己書き換え 1024=0400H / 512=0200H ここに1セクタのサイズが格納される
  E515  7C            		LD	A,H
  E516  3D            		DEC	A		;1024=3 / 512=1
  E517  FDA622        		AND	(IY+34)		;(FCB)ランダム・レコード
  E51A  47            		LD	B,A		;BCに1セクタ以下の端数が入る
  E51B  ED42          		SBC	HL,BC		;残りを計算
                      	
  E51D  ED5B78E5      		LD	DE,(LEFTX)
  E521  ED52          		SBC	HL,DE		;CP HL,DE
  E523  19            		ADD	HL,DE		;
  E524  3801          		JR	C,RBXA1		;DEとHLを比較して大きい方をHLに
  E526  EB            		EX	DE,HL
  E527                	RBXA1:
  E527  E5            		PUSH	HL
  E528  2A7EEC        		LD	HL,(_DTBUF)
  E52B  09            		ADD	HL,BC
  E52C  ED5B7AE5      		LD	DE,(DTAX)
  E530  C1            		POP	BC
  E531  C9            		RET
                      	
  E532                	RBXB:
  E532  2A7AE5        		LD	HL,(DTAX)
  E535  ED5BFEEB      		LD	DE,(_CLPS)
  E539  3A79E5        		LD	A,(LEFTX+1)
  E53C  47            		LD	B,A
  E53D  3A14E5        		LD	A,(SECSZ+2)	;1024=4 / 512=2 / 256=1
  E540                	RBXB1:
  E540  1F            		RRA		;->CF
  E541  3804          		JR	C,RBXB2
  E543  CB38          		SRL	B	;B=B/2
  E545  18F9          		JR	RBXB1
  E547                	RBXB2:
  E547  78            		LD	A,B
  E548  B7            		OR	A
  E549  C9            		RET
                      	
  E54A                	RBXC:
  E54A  ED4B78E5      		LD	BC,(LEFTX)
  E54E  3AF7DE        		LD	A,(SECSZM1+2)	;1024=3 / 512=1 / 256=0
  E551  A0            		AND	B
  E552  47            		LD	B,A		;1セクタ以下の端数がない場合はZ
  E553  B1            		OR	C
  E554  C9            		RET
                      	
  E555                	RBXEND:
  E555  110000        	LEFT:	LD	DE,0
  E558  AF            		XOR	A
  E559  FD6E21        		LD	L,(IY+33)	;(FCB)ランダム・レコード
  E55C  FD6622        		LD	H,(IY+34)
  E55F  19            		ADD	HL,DE
  E560  FD8E23        		ADC	A,(IY+35)
  E563  FD7521        		LD	(IY+33),L	;(FCB)ランダム・レコード
  E566  FD7422        		LD	(IY+34),H
  E569  FD7723        		LD	(IY+35),A
  E56C  EB            		EX	DE,HL		;HL=Read byte
  E56D  C9            		RET
                      	
  E56E                	GET_RR_CDE:			;CDE=Random record
  E56E  FD5E21        		LD	E,(IY+33)	;(FCB)ランダム・レコード
  E571  FD5622        		LD	D,(IY+34)
  E574  FD4E23        		LD	C,(IY+35)
  E577  C9            		RET
                      	
  E578                	CPBUF:
  E578  0000          	LEFTX:	DW	0
  E57A  0000          	DTAX:	DW	0
  E57C  20            		DB	020H	;DS 7,20h
  E57D  20            		DB	020H
  E57E  20            		DB	020H
  E57F  20            		DB	020H
  E580  20            		DB	020H
  E581  20            		DB	020H
  E582  20            		DB	020H
                      	;
                      	
                      	;LDDIO.ASM
                      	
                      	;	LSX-Dodgers DIO
                      	
  E583                	DRDX:
  E583  CDB9E5        		CALL	DRDY
  E586  C8            		RET	Z
  E587  CDA3E5        		CALL	DRDX1		;データバッファの情報を保存
  E58A  D8            		RET	C
  E58B  E5            		PUSH	HL
  E58C  C5            		PUSH	BC
  E58D  D5            		PUSH	DE
  E58E  2A7EEC        		LD	HL,(_DTBUF)
  E591  CDCBE7        		CALL	DRD_DPB
  E594  DCB4E5        		CALL	C,DRDNE
  E597                	POP_DE_BC_HL_RET:
  E597  D1            		POP	DE
  E598  C1            		POP	BC
  E599  E1            		POP	HL
  E59A  C9            		RET
                      	
  E59B                	DRDN:
  E59B  AF            		XOR	A
  E59C  00            	DRDN1:	NOP			;自己書き換え NOP / SCF
  E59D  30E4          		JR	NC,DRDX
  E59F                	DRDNX:
  E59F  CDB9E5        		CALL	DRDY
  E5A2  C8            		RET	Z
  E5A3                	DRDX1:				;データバッファの情報を保存
  E5A3  CDCAE5        		CALL	DWTX
  E5A6  ED53A6EC      		LD	(_DBSEC),DE
  E5AA  3A88EC        		LD	A,(_DRV)
  E5AD  32A5EC        		LD	(_DBDRV),A
  E5B0  CDD9EC        		CALL	_CHGDRV
  E5B3  D0            		RET	NC
  E5B4                	DRDNE:
  E5B4  9F            		SBC	A,A
  E5B5  32A5EC        		LD	(_DBDRV),A
  E5B8  C9            		RET
                      	
  E5B9                	DRDY:
  E5B9  E5            		PUSH	HL
  E5BA  3A88EC        		LD	A,(_DRV)
  E5BD  21A5EC        		LD	HL,_DBDRV
  E5C0  AE            		XOR	(HL)
  E5C1  2005          		JR	NZ,POP_HL_RET
                      	
  E5C3  2AA6EC        		LD	HL,(_DBSEC)
  E5C6  ED52          		SBC	HL,DE		;CF=0
  E5C8                	POP_HL_RET:
  E5C8  E1            		POP	HL
  E5C9  C9            		RET
                      	
  E5CA                	DWTX:
  E5CA  3AA4EC        		LD	A,(_WTDBF)
  E5CD  B7            		OR	A
  E5CE  C8            		RET	Z
  E5CF  AF            		XOR	A
  E5D0  32A4EC        		LD	(_WTDBF),A
                      	
  E5D3  E5            		PUSH	HL
  E5D4  C5            		PUSH	BC
  E5D5  D5            		PUSH	DE
  E5D6  3AA5EC        		LD	A,(_DBDRV)
  E5D9  CDD9EC        		CALL	_CHGDRV
  E5DC  ED5BA6EC      		LD	DE,(_DBSEC)
  E5E0  2A7EEC        		LD	HL,(_DTBUF)
  E5E3  D41BE8        		CALL	NC,DWT_DPB
  E5E6  18AF          		JR	POP_DE_BC_HL_RET
                      	
  E5E8                	RDFATX:
  E5E8  E5            		PUSH	HL
  E5E9  3A88EC        		LD	A,(_DRV)
  E5EC  21AAEC        		LD	HL,_FATDRV
  E5EF  AE            		XOR	(HL)
  E5F0  28D6          		JR	Z,POP_HL_RET
                      	
  E5F2  C5            		PUSH	BC
  E5F3  D5            		PUSH	DE
  E5F4  DDE5          		PUSH	IX
  E5F6  CD12E6        		CALL	WTFATX
  E5F9  3813          		JR	C,POP_IX_DE_BC_HL_RET
                      	
  E5FB  AF            		XOR	A
  E5FC  32ABEC        		LD	(_FATIX),A
  E5FF  3A88EC        		LD	A,(_DRV)
  E602  32AAEC        		LD	(_FATDRV),A
  E605  CDE5EC        		CALL	_RDFAT
  E608                	RDFATE2:
  E608  3004          		JR	NC,POP_IX_DE_BC_HL_RET
  E60A  9F            		SBC	A,A		;A=0xFF
  E60B  32AAEC        		LD	(_FATDRV),A
  E60E                	POP_IX_DE_BC_HL_RET:
  E60E  DDE1          		POP	IX
  E610  1885          		JR	POP_DE_BC_HL_RET
                      	
  E612                	WTFATX:
  E612  3AA2EC        		LD	A,(_WTFATF)
  E615  B7            		OR	A
  E616  C8            		RET	Z
  E617  E5            		PUSH	HL
  E618  3AAAEC        		LD	A,(_FATDRV)
  E61B  21A5EC        		LD	HL,_DBDRV
  E61E  AE            		XOR	(HL)
  E61F  CCCAE5        		CALL	Z,DWTX
  E622  38A4          		JR	C,POP_HL_RET
  E624  C5            		PUSH	BC
  E625  D5            		PUSH	DE
  E626  DDE5          		PUSH	IX
  E628  CD2CE8        		CALL	WTFAT
  E62B  AF            		XOR	A
  E62C  32A2EC        		LD	(_WTFATF),A
  E62F  18DD          		JR	POP_IX_DE_BC_HL_RET
                      	
  E631                	NCL1:
  E631  7A            		LD	A,D
  E632  B3            		OR	E
  E633  37            		SCF
  E634  C8            		RET	Z
                      	
  E635  E5            		PUSH	HL
  E636  7A            		LD	A,D
  E637  E608          		AND	8		;DE(targetCluster >= 0x800)
  E639  3258E6        		LD	(NCLPAT+2),A
  E63C  2AAAEC        		LD	HL,(_FATDRV)	;L=_FATDRV H=FATIX
  E63F  BC            		CP	H
  E640  3A88EC        		LD	A,(_DRV)	;この間でフラグは変化しない
  E643  3257E6        		LD	(NCLPAT+1),A	;
  E646  2005          		JR	NZ,NCL2		;FATIXが違う
  E648  BD            		CP	L
  E649  2002          		JR	NZ,NCL2		;ドライブが違う
  E64B  E1            		POP	HL
  E64C  C9            		RET
  E64D                	NCL2:
  E64D  C5            		PUSH	BC
  E64E  D5            		PUSH	DE
  E64F  DDE5          		PUSH	IX
  E651  CD12E6        		CALL	WTFATX
  E654  38B8          		JR	C,POP_IX_DE_BC_HL_RET
  E656  010000        	NCLPAT:	LD	BC,0
  E659  ED43AAEC      		LD	(_FATDRV),BC
  E65D  CD0AE8        		CALL	RDFATS
  E660  18A6          		JR	RDFATE2
                      	
  E662                	NCL3:
  E662  CB9A          		RES	3,D
  E664  6B            		LD	L,E
  E665  62            		LD	H,D
  E666  CB3C          		SRL	H	;
  E668  CB1D          		RR	L	;HLA=HLA/2
  E66A  1F            		RRA		;
  E66B  ED4B7CEC      		LD	BC,(_FATBF)
  E66F  19            		ADD	HL,DE
  E670  09            		ADD	HL,BC
  E671  17            		RLA
  E672  C9            		RET
                      	
  E673                	GNCL:
  E673  CD31E6        		CALL	NCL1		;GET NEXT CLUSTER
  E676  D8            		RET	C
  E677  C5            		PUSH	BC
  E678  E5            		PUSH	HL
  E679  CD62E6        		CALL	NCL3
  E67C  3809          		JR	C,GNC1
  E67E  5E            		LD	E,(HL)
  E67F  23            		INC	HL
  E680  7E            		LD	A,(HL)
  E681  E60F          		AND	00FH
  E683  57            		LD	D,A
  E684  E1            		POP	HL
  E685  C1            		POP	BC
  E686  C9            		RET
  E687                	GNC1:
  E687  7E            		LD	A,(HL)
  E688  23            		INC	HL
  E689  56            		LD	D,(HL)
  E68A  0604          		LD	B,4
  E68C                	GNC1L:
  E68C  CB3A          		SRL	D	;DA=DA/2
  E68E  1F            		RRA		;
  E68F  10FB          		DJNZ	GNC1L
                      	
  E691  5F            		LD	E,A
  E692  E1            		POP	HL
  E693  C1            		POP	BC
  E694  A7            		AND	A
  E695  C9            		RET
                      	
  E696                	SNCL:
  E696  CD31E6        		CALL	NCL1
  E699  D8            		RET	C
  E69A  3E01          		LD	A,1
  E69C  32A2EC        		LD	(_WTFATF),A
                      	;				SET NEXT CLUSTER
  E69F  E5            		PUSH	HL
  E6A0  C5            		PUSH	BC
  E6A1  D5            		PUSH	DE
  E6A2  E5            		PUSH	HL
  E6A3  CD62E6        		CALL	NCL3
  E6A6  D1            		POP	DE
                      	;CF=ODD
  E6A7  7E            		LD	A,(HL)
  E6A8  73            		LD	(HL),E
  E6A9  3806          		JR	C,SNC1
                      	;EVEN
                      	;M[0] = E
                      	;M[1] = (M[1] & 0xF0) | (D & 0x0F)
  E6AB  23            		INC	HL
  E6AC  ED67          		RRD		;M={A[3:0],E[3:0]}
  E6AE  7A            		LD	A,D
  E6AF  1804          		JR	SNC11
  E6B1                	SNC1:
                      	;ODD
                      	;HL[0] = (HL[0]&0x0F) | (E<<4)
                      	;HL[1] = DE>>4
  E6B1  ED6F          		RLD		;M={D[3:0],E[7:4]}
  E6B3  23            		INC	HL
  E6B4  72            		LD	(HL),D	;M={D[3:0],E[7:4]}
  E6B5                	SNC11:
  E6B5  ED6F          		RLD		;M={M[7:4],D[3:0]}
  E6B7  B7            		OR	A
  E6B8  D1            		POP	DE
  E6B9  C1            		POP	BC
  E6BA  E1            		POP	HL
  E6BB  C9            		RET
                      	
                      	
                      	;------------------------
                      	;次のセクタを探す際に「1クラスタの論理セクタ数」を掛けてまとめて扱う
                      	;in
                      	;	DE : セクタ番号
                      	;out
                      	;	DE : まとめた値
                      	;note
                      	;	「FAT12」最大12ビット + 「1クラスタの論理セクタ数」4ビットで計16ビットとして扱う
                      	;------------------------
  E6BC                	GNCLX:
  E6BC  7B            		LD	A,E
  E6BD  3C            		INC	A
  E6BE  E600          	NCPAT:	AND	0	;自己書き換え　1クラスタの論理セクタ数-1
  E6C0  2802          		JR	Z,GNCLX1
  E6C2  13            		INC	DE	;クラスタを跨がない場合は単純に+1する
  E6C3  C9            		RET
  E6C4                	GNCLX1:
  E6C4  CDD7E6        		CALL	DIVSPC	;クラスタを跨ぐ場合は
  E6C7  CD26E8        		CALL	_GNCL	;次のクラスタを探す
                      	
                      	;------------------------
                      	;クラスタと「1クラスタの論理セクタ数」を掛ける
                      	;in
                      	;	DE : セクタ番号
                      	;out
                      	;	DE : 掛けられた値
                      	;note
                      	;	DE以外のレジスタとフラグは保持する
                      	;------------------------
  E6CA                	MULSPC:
  E6CA  F5            		PUSH	AF
  E6CB  EB            		EX	DE,HL
  E6CC  3E01          	SPCPAT:	LD	A,1		;自己書き換え（1クラスタの論理セクタ数）
  E6CE                	CLDBL:
  E6CE  0F            		RRCA			;->CF
  E6CF  3803          		JR	C,CLDBL_RET
  E6D1  29            		ADD	HL,HL		;*2
  E6D2  18FA          		JR	CLDBL
  E6D4                	CLDBL_RET:
  E6D4  EB            		EX	DE,HL
  E6D5                	POP_AF_RET
  E6D5  F1            		POP	AF
  E6D6  C9            		RET
                      	
                      	;------------------------
                      	;「1クラスタの論理セクタ数」を割って論理セクタだけに戻す
                      	;in
                      	;	DE : 掛けられた値
                      	;out
                      	;	DE : セクタ番号
                      	;note
                      	;	DE以外のレジスタとフラグは保持する
                      	;------------------------
  E6D7                	DIVSPC:
  E6D7  F5            		PUSH	AF
  E6D8  3ACDE6        		LD	A,(SPCPAT+1)	;1クラスタの論理セクタ
  E6DB                	CLDIV1:
  E6DB  0F            		RRCA			;->CF
  E6DC  38F7          		JR	C,POP_AF_RET
  E6DE  CB3A          		SRL	D		;DE=DE/2
  E6E0  CB1B          		RR	E		;
  E6E2  18F7          		JR	CLDIV1
                      	
  E6E4                	RDFAT0X:
  E6E4  CD0AE8        		CALL	RDFATS
  E6E7  D8            		RET	C
  E6E8  DDBE01        		CP	(IX+1)		;DPB_01_FATID
  E6EB  C8            		RET	Z
  E6EC  37            		SCF
  E6ED  C9            		RET
                      	
  E6EE                	RDFAT:
  E6EE  3A88EC        		LD	A,(_DRV)
  E6F1  CD41E9        		CALL	CHGDRVR
  E6F4  D8            		RET	C
  E6F5  DD7E12        		LD	A,(IX+012H)	;DPB_12_DEVNO
  E6F8  FE87          		CP	087H
  E6FA  20E8          		JR	NZ,RDFAT0X
                      	
  E6FC  3E7F          		LD	A,07FH
  E6FE  32F3EB        		LD	(CHECK),A	;A=07FH
  E701  DDCB0A46      		BIT	0,(IX+00AH)	;DPB_0A_FDMODE
  E705  284D          		JR	Z,X2HX
  E707                	E2DX:
  E707  2140EB        		LD	HL,M2D
  E70A  CDD7E7        		CALL	DRDF
  E70D  383D          		JR	C,E2HX
  E70F  FEFD          		CP	0FDH		;2D
  E711  C8            		RET	Z
  E712  FEF9          		CP	0F9H		;2DD9
  E714  CABEE7        		JP	Z,E2DD9
  E717  FEFB          		CP	0FBH		;2DD8
  E719  37            		SCF
  E71A  C0            		RET	NZ		;NOT 2DD
  E71B  214EEB        		LD	HL,M2DD8
  E71E                	CHGTYPE:
  E71E  D5            		PUSH	DE
  E71F  CD31E7        		CALL	CHGDV
  E722  3A84EC        		LD	A,(_DRIVE)
  E725  E603          		AND	3
  E727  F680          		OR	080H
  E729  6F            		LD	L,A
  E72A  26EC          		LD	H,_CYL0/256
  E72C  3EFF          		LD	A,0FFH
  E72E  77            		LD	(HL),A
  E72F  D1            		POP	DE
  E730  C9            		RET
                      	
  E731                	CHGDV:
  E731  DDE5          		PUSH	IX
  E733  D1            		POP	DE
  E734  EDA0          		LDI
  E736  EDA0          		LDI
  E738  13            		INC	DE
  E739  13            		INC	DE
  E73A  13            		INC	DE
  E73B  13            		INC	DE
  E73C  010C00        		LD	BC,12
  E73F  EDB0          		LDIR
  E741                	CHGDV2:
  E741  3EFF          		LD	A,0FFH
  E743  3289EC        		LD	(_DSK),A
  E746  3A88EC        		LD	A,(_DRV)
  E749  C3D9EC        		JP	_CHGDRV
                      	
  E74C                	E2HX:
  E74C  3C            		INC	A
  E74D  C8            		RET	Z
  E74E  21F3EB        		LD	HL,CHECK
  E751  CB06          		RLC	(HL)
  E753  D8            		RET	C
  E754                	X2HX:
  E754  2178EB        		LD	HL,M2HD
  E757  110000        		LD	DE,0
  E75A  CDDBE7        		CALL	DRDD
  E75D  300A          		JR	NC,X2HX1
  E75F  3C            		INC	A
  E760  C8            		RET	Z
  E761  21F3EB        		LD	HL,CHECK
  E764  CB06          		RLC	(HL)
  E766  D8            		RET	C
  E767  189E          		JR	E2DX
  E769                	X2HX1:
  E769  23            		INC	HL
  E76A  7E            		LD	A,(HL)
  E76B  06FE          		LD	B,0FEH
  E76D  FE0C          		CP	00CH
  E76F  2838          		JR	Z,X2HDE
  E771  06F8          		LD	B,0F8H
  E773  D620          		SUB	020H		;020H
  E775  2832          		JR	Z,X2HDE
  E777  3C            		INC	A		;01FH
  E778  282F          		JR	Z,X2HDE
  E77A  3C            		INC	A		;01EH
  E77B  206C          		JR	NZ,C2HX		;2HD/2HC/2HQ
  E77D                	X2HS:
  E77D  21A2EB        		LD	HL,M2HS
  E780  CDAFE7        		CALL	X2HSS
  E783  D8            		RET	C
  E784  2A7CEC        		LD	HL,(_FATBF)
  E787  23            		INC	HL
  E788  7E            		LD	A,(HL)		;FATBF+1
  E789  FE50          		CP	80
  E78B  3F            		CCF
  E78C  D0            		RET	NC
  E78D  FE5A          		CP	90
  E78F  D0            		RET	NC
  E790  DD770C        		LD	(IX+00CH),A	;DPB_0C_MAXCYL
  E793  D650          		SUB	80
  E795  87            		ADD	A,A	;*2
  E796  4F            		LD	C,A
  E797  87            		ADD	A,A	;*4
  E798  87            		ADD	A,A	;*8
  E799  87            		ADD	A,A	;*16
  E79A  81            		ADD	A,C	;*18
  E79B  C698          		ADD	A,098H
  E79D  DD7708        		LD	(IX+8),A	;DPB_08_MAXCL_LOW
  E7A0  3E05          		LD	A,5
  E7A2  CE00          		ADC	A,0
  E7A4  DD7709        		LD	(IX+9),A	;DPB_08_MAXCL_HIGH
  E7A7  1898          		JR	CHGDV2
  E7A9                	X2HDE:
  E7A9  2194EB        		LD	HL,M2HDE
  E7AC  23            		INC	HL
  E7AD  70            		LD	(HL),B
  E7AE  2B            		DEC	HL
  E7AF                	X2HSS:
  E7AF  CDD7E7        		CALL	DRDF
  E7B2  D8            		RET	C
  E7B3  DDBE01        		CP	(IX+1)		;DPB_01_FATID
  E7B6  37            		SCF
  E7B7  C0            		RET	NZ
  E7B8  CDC7E7        		CALL	INCDRD
  E7BB  300E          		JR	NC,DRD_DPB
  E7BD  C9            		RET
                      	
  E7BE                	E2DD9:
  E7BE  215CEB        		LD	HL,M2DD
  E7C1  CD1EE7        		CALL	CHGTYPE
  E7C4  2A7CEC        		LD	HL,(_FATBF)
  E7C7                	INCDRD:
  E7C7  24            		INC	H
  E7C8  24            		INC	H
  E7C9  24            		INC	H
  E7CA  24            		INC	H
  E7CB                	DRD_DPB:
  E7CB  DDE5          		PUSH	IX
  E7CD  DD2AA8EC      		LD	IX,(_DPB)
  E7D1  CD56EA        	DRDPAT:	CALL	FDRD		;自己書き換え（ディスク読み込み）
  E7D4                	POP_IX_RET:
  E7D4  DDE1          		POP	IX
  E7D6  C9            		RET
                      	
  E7D7                	DRDF:
  E7D7  ED5BFAEB      		LD	DE,(_FATPS)
  E7DB                	DRDD:
  E7DB  CD1EE7        		CALL	CHGTYPE
  E7DE  2A7CEC        		LD	HL,(_FATBF)
  E7E1  E5            		PUSH	HL
  E7E2  CDCBE7        		CALL	DRD_DPB
  E7E5  E1            		POP	HL
  E7E6  D8            		RET	C
  E7E7  7E            		LD	A,(HL)
  E7E8  C9            		RET
                      	
  E7E9                	C2HX:
  E7E9  CD0AE8        		CALL	RDFATS
  E7EC  D8            		RET	C
  E7ED  FEFE          		CP	0FEH	;2HD
  E7EF  C8            		RET	Z
  E7F0  2186EB        		LD	HL,M2HQ
  E7F3  FEF0          		CP	0F0H
  E7F5  2807          		JR	Z,X2HQ
  E7F7  FEF9          		CP	0F9H
  E7F9  37            		SCF
  E7FA  C0            		RET	NZ
  E7FB  216AEB        		LD	HL,M2HC
  E7FE                	X2HQ:
  E7FE  CD1EE7        		CALL	CHGTYPE
  E801  CD52E8        		CALL	FATS2
  E804  24            		INC	H	;先頭の1セクタはすでに読み込まれているのでスキップ
  E805  24            		INC	H
  E806  05            		DEC	B
  E807  13            		INC	DE
  E808  1804          		JR	RDFATL
  E80A                	RDFATS:
  E80A  CD4BE8        		CALL	FATS
  E80D  D8            		RET	C
  E80E                	RDFATL:
  E80E  C5            		PUSH	BC
  E80F  CDCBE7        		CALL	DRD_DPB
  E812  C1            		POP	BC
  E813  D8            		RET	C
  E814  10F8          		DJNZ	RDFATL
  E816  2A7CEC        		LD	HL,(_FATBF)
  E819  7E            		LD	A,(HL)
  E81A  C9            		RET
                      	
  E81B                	DWT_DPB:
  E81B  DDE5          		PUSH	IX
  E81D  DD2AA8EC      		LD	IX,(_DPB)
  E821  CD4DEA        	DWTPAT:	CALL	FDWT		;自己書き換え（ディスク書き込み）
  E824  18AE          		JR	POP_IX_RET
                      	
  E826                	_GNCL:
  E826  C373E6        	GNCPAT:	JP	GNCL		;自己書き換え
                      	
  E829                	_SNCL:
  E829  C396E6        	SNCPAT:	JP	SNCL		;自己書き換え
                      	
  E82C                	WTFAT:
  E82C  CD4BE8        		CALL	FATS
  E82F  D442E8        		CALL	NC,WTFATL
  E832  D8            		RET	C
  E833  DDCB0F7E      		BIT	7,(IX+00FH)	;DPB_0F_BPS
  E837  C8            		RET	Z		;予備FATが無い
  E838  CD52E8        		CALL	FATS2
  E83B  DD7E00        		LD	A,(IX+0)	;DPB_00_FATLN
  E83E                	WTFAT2:
  E83E  13            		INC	DE
  E83F  3D            		DEC	A
  E840  20FC          		JR	NZ,WTFAT2
  E842                	WTFATL:
  E842  C5            		PUSH	BC
  E843  CD1BE8        		CALL	DWT_DPB
  E846  C1            		POP	BC
  E847  D8            		RET	C
  E848  10F8          		DJNZ	WTFATL
  E84A  C9            		RET
                      	;------------------------
                      	;FATのセットアップ
                      	;out
                      	;	B  : FATセクタ数
                      	;	DE : FAT先頭セクタ番号
                      	;	HL : FATバッファポインタ
                      	;	CF : 1=ドライブ切り替えエラー
                      	;note
                      	;	FATサイズがFATバッファを超える場合は
                      	;	対象クラスタ領域==(_FATIX)によって
                      	;	FATの前半3KBと後半3KBを切り替える
                      	;------------------------
  E84B                	FATS:
  E84B  3AAAEC        		LD	A,(_FATDRV)
  E84E  CD41E9        		CALL	CHGDRVR		;ドライブ切り替え
  E851  D8            		RET	C
  E852                	FATS2:
  E852  ED5BFAEB      		LD	DE,(_FATPS)	;fat sector pos
  E856  2A7CEC        		LD	HL,(_FATBF)
  E859  C35CE8        	FATSX:	JP	FATS_FAT12	;自己書き換え
                      	
  E85C                	FATS_FAT12:
  E85C  DD460F        		LD	B,(IX+00FH)	;DPB_0F_BPS
  E85F  3E0C          		LD	A,12		;3072 / 256 FATバッファに読み込めるセクタ数
  E861                	L_FATS2:
  E861  CB18          		RR	B		;->CF
  E863  3803          		JR	C,E_FATS2
  E865  1F            		RRA			;CF=0 なので A=A/2
  E866  18F9          		JR	L_FATS2
  E868                	E_FATS2:
  E868  DD4600        		LD	B,(IX+0)	;DPB_00_FATLN
  E86B  B8            		CP	B
  E86C  D0            		RET	NC		;DPB_00_FATLN x sectorSize < fatBufSize
                      	;targetCluster
  E86D  4F            		LD	C,A		;C = skipCount
  E86E  3AABEC        		LD	A,(_FATIX)	;(targetCluster >= 0x800)
  E871  B7            		OR	A
  E872  2806          		JR	Z,FATS3
                      	;(targerCluster>=0x800)
  E874                	FAT_SKP:
  E874  13            		INC	DE		;FATPS++
  E875  05            		DEC	B		;FATSIZE--
  E876  0D            		DEC	C		;skipCnt--
  E877  20FB          		JR	NZ,FAT_SKP
  E879  48            		LD	C,B
  E87A                	FATS3:
  E87A  41            		LD	B,C		;3 or 6 or 12
  E87B  AF            		XOR	A
  E87C  C9            		RET
                      	
  E87D                	CHGDRV:
  E87D  E67F          		AND	07FH
  E87F  E5            		PUSH	HL
  E880  2189EC        		LD	HL,_DSK
  E883  BE            		CP	(HL)
  E884  280A          		JR	Z,CHGDRVE
  E886                	CHGDRV1:
  E886  DDE5          		PUSH	IX
  E888  CD92E8        		CALL	CHGDRV0
  E88B  3A89EC        		LD	A,(_DSK)
  E88E  DDE1          		POP	IX
  E890                	CHGDRVE:
  E890  E1            		POP	HL
  E891  C9            		RET
                      	
  E892                	CHGDRV0:
  E892  6F            		LD	L,A
  E893  CDDCEC        		CALL	_GETDPB
  E896  D8            		RET	C
                      	
  E897  DD22A8EC      		LD	(_DPB),IX
  E89B  7D            		LD	A,L
  E89C  3289EC        		LD	(_DSK),A
                      	
  E89F  F3            		DI
  E8A0  ED7333E9      		LD	(SPPAT2+1),SP
                      	
  E8A4  DDF9          		LD	SP,IX
                      	
  E8A6  E1            		POP	HL		;L=DPB_00_FATLN H=DPB_01_FATID
  E8A7  E1            		POP	HL		;DPB_02_DRD
  E8A8  22D2E7        		LD	(DRDPAT+1),HL
                      	
  E8AB  E1            		POP	HL
  E8AC  2222E8        		LD	(DWTPAT+1),HL	;DPB_04_DWT
                      	
  E8AF  E1            		POP	HL		;L=DPB_06_ADDCL H=DPB_07_SECPCL
  E8B0  7D            		LD	A,L
  E8B1  32C5DF        		LD	(CLSPAT+1),A
  E8B4  7C            		LD	A,H
  E8B5  32CDE6        		LD	(SPCPAT+1),A	;1クラスタの論理セクタ数
  E8B8  3D            		DEC	A
  E8B9  32BFE6        		LD	(NCPAT+1),A
                      	
  E8BC  E1            		POP	HL		;DPB_08_MAXCL
  E8BD  7D            		LD	A,L
  E8BE  32D2DF        		LD	(CLPAT2+1),A
  E8C1  7C            		LD	A,H
  E8C2  32CEDF        		LD	(CLPAT1+1),A
  E8C5  2B            		DEC	HL
  E8C6  22E1E1        		LD	(MAXCLP+1),HL
                      	
  E8C9  E1            		POP	HL		;L=DPB_0A_FDMODE H=DPB_0B_MAXDIR
  E8CA  7D            		LD	A,L
  E8CB  F6FE          		OR	0FEH
  E8CD  32F8E9        		LD	(FDMODE+1),A
  E8D0  07            		RLCA
  E8D1  E603          		AND	3
  E8D3  32E0E9        		LD	(FSPAT+1),A
  E8D6  7C            		LD	A,H
  E8D7  326DDE        		LD	(RTEPAT+1),A	;DPB_0B_MAXDIR
                      	
  E8DA  E1            		POP	HL		;L=DPB_0C_MAXCYL H=DPB_0D_MAXSEC
  E8DB  7D            		LD	A,L
  E8DC  32A1EC        		LD	(_MAXCYL),A
  E8DF  7C            		LD	A,H
  E8E0  3288E9        		LD	(MAXSEC+1),A
                      	
  E8E3  E1            		POP	HL		;L=DPB_0E_FATPS H=DPB_0F_BPS
  E8E4  7C            		LD	A,H		;DPB_0F_BPS
  E8E5  E607          		AND	7
  E8E7  3214E5        		LD	(SECSZ+2),A	;1セクタのサイズの上位1バイト 0x400 - 0x200 - 0x100
  E8EA  3D            		DEC	A		;1セクタ512 2D/2DD/2HC/2HQ(2HD1.44MB)等
                      					;1セクタ1024 2HD/EMM/BRAM
                      					;1セクタ256 GRAM等
                      					;1024	512	256
  E8EB  32F7DE        		LD	(SECSZM1+2),A	;3	1	0	1セクタのサイズ-1したものの上位1バイト (0x3FF - 0x1FF - 0xFF)
  E8EE  3C            		INC	A		;4	2	1
  E8EF  87            		ADD	A,A		;8	4	2
  E8F0  87            		ADD	A,A		;010H	8	4
  E8F1  87            		ADD	A,A		;020H	010H	8
  E8F2  3252DE        		LD	(SDECPAT+1),A	;1セクタ辺りのディレクトリエントリ数
  E8F5  3D            		DEC	A		;01FH	00FH	7
  E8F6  3293D4        		LD	(SDECM1+1),A	;1セクタ辺りのディレクトリエントリ数-1
                      	
  E8F9  2600          		LD	H,0
  E8FB  22FAEB        		LD	(_FATPS),HL
                      	
  E8FE  E1            		POP	HL		;L=DPB_10_DIRPS H=DPB_11_MINSEC
  E8FF  7C            		LD	A,H
  E900  3295E9        		LD	(SECPAT+1),A
  E903  2600          		LD	H,0
  E905  22FCEB        		LD	(_DIRPS),HL
                      	
  E908  E1            		POP	HL		;L=DPB_12_DEVNO H=DPB_13_UNITNO
  E909  7C            		LD	A,H
  E90A  3284EC        		LD	(_DRIVE),A
                      	
  E90D  E1            		POP	HL		;DPB_14_EXTRA
  E90E  7C            		LD	A,H
  E90F  B5            		OR	L
  E910  2011          		JR	NZ,EXTRA
  E912  2173E6        		LD	HL,GNCL		;FAT12(default)
  E915  2227E8        		LD	(GNCPAT+1),HL
  E918  2196E6        		LD	HL,SNCL
  E91B  222AE8        		LD	(SNCPAT+1),HL
  E91E  215CE8        		LD	HL,FATS_FAT12
  E921  180C          		JR	EXTRA1
  E923                	EXTRA:
  E923  2227E8        		LD	(GNCPAT+1),HL
  E926  23            		INC	HL
  E927  23            		INC	HL
  E928  23            		INC	HL
  E929  222AE8        		LD	(SNCPAT+1),HL
  E92C  23            		INC	HL
  E92D  23            		INC	HL
  E92E  23            		INC	HL
  E92F                	EXTRA1:
  E92F  225AE8        		LD	(FATSX+1),HL
                      	
  E932  310000        	SPPAT2:	LD	SP,0		;元のSPを復元
  E935  FB            		EI
  E936  AF            		XOR	A
  E937  C9            		RET
                      	
  E938                	GETDPBD:
  E938  DDE3          		EX	(SP),IX
  E93A  DDE5          		PUSH	IX
  E93C  3A88EC        		LD	A,(_DRV)
  E93F  1807          		JR	GETDPB1
                      	
  E941                	CHGDRVR:
  E941  CDD9EC        		CALL	_CHGDRV
  E944  D8            		RET	C
  E945  3A89EC        		LD	A,(_DSK)
  E948                	GETDPB1:
  E948  C3DCEC        		JP	_GETDPB
                      	
  E94B                	GETDPB:
  E94B  FE08          		CP	8
  E94D  3F            		CCF
  E94E  D8            		RET	C
  E94F  87            		ADD	A,A	;*2
  E950  87            		ADD	A,A	;*4
  E951  87            		ADD	A,A	;*8
  E952  87            		ADD	A,A	;*16
  E953  87            		ADD	A,A	;*32
  E954  DD            		DB	0DDH		;Z80未定義命令
  E955  6F            		LD	L,A		;LD	IXL,A
  E956  DD            		DB	0DDH		;Z80未定義命令
  E957  26ED          		LD	H,DEVICE/256	;LD	IXH,DEVICE/256
  E959  DD7E00        		LD	A,(IX+0)	;DPB_00_FATLN
  E95C  DDCB0F76      		BIT	6,(IX+00FH)	;DPB_0F_BPS
  E960  C0            		RET	NZ		;FAT12じゃない
  E961  FE01          		CP	001H		;A=0 THEN CF=1
  E963  C9            		RET
                      	
  E964                	FFLUSH:
  E964  F5            		PUSH	AF
  E965  3EFF          		LD	A,0FFH
  E967  32A6E2        		LD	(SFILE),A
  E96A  CDCAE5        		CALL	DWTX
  E96D  3EFF          		LD	A,0FFH
  E96F  32A5EC        		LD	(_DBDRV),A
  E972  CD12E6        		CALL	WTFATX
  E975  AF            		XOR	A
  E976  32ABEC        		LD	(_FATIX),A
  E979  2F            		CPL
  E97A  32AAEC        		LD	(_FATDRV),A
  E97D  F1            		POP	AF
  E97E  C9            		RET
                      	
                      	
                      	;LDDISK.ASM
                      	
                      	;	LSX-Dodgers DISK
                      	
                      	
  E97F                	SEEK:
  E97F  7A            		LD	A,D
  E980  B3            		OR	E
  E981  3E01          		LD	A,001H
  E983  2812          		JR	Z,DIV3
                      	
  E985  0610          		LD	B,16
  E987  0E00          	MAXSEC:	LD	C,000H
  E989  AF            		XOR	A
  E98A  EB            		EX	DE,HL
  E98B                	DIV1:
  E98B  29            		ADD	HL,HL
  E98C  8F            		ADC	A,A
  E98D  B9            		CP	C
  E98E  3802          		JR	C,DIV2
  E990  91            		SUB	C
  E991  2C            		INC	L
  E992                	DIV2:
  E992  10F7          		DJNZ	DIV1
                      	
  E994  C601          	SECPAT:	ADD	A,001H		;(Self-rewriting)
  E996  55            		LD	D,L	;Quotient(TRACK)
  E997                	DIV3:
  E997  5F            		LD	E,A	;Remainder
  E998  CB3A          		SRL	D	;CYLINDER
  E99A  9F            		SBC	A,A
  E99B  E610          		AND	010H	;SIDE
  E99D  4F            		LD	C,A
                      	
  E99E  3A84EC        		LD	A,(_DRIVE)
  E9A1  FE04          		CP	4
  E9A3  3F            		CCF
  E9A4  D8            		RET	C
  E9A5  B1            		OR	C
  E9A6  3224EA        		LD	(MOPAT+1),A	;Motor off data
  E9A9  01FC0F        		LD	BC,00FFCH
  E9AC  F680          		OR	080H		;Mortor on
  E9AE  ED79          		OUT	(C),A
                      	
  E9B0  CDF6E9        		CALL	SETMODE
  E9B3  D8            		RET	C
                      	
  E9B4  CD39EA        		CALL	DRIVE
  E9B7  FEFF          		CP	0FFH		;A=0FFH Unknown CYLINDER
  E9B9  CC18EA        		CALL	Z,FDCRES	;Restore
  E9BC  0EF9          		LD	C,0F9H
  E9BE  ED79          		OUT	(C),A		;Currrent CYLINDER
  E9C0  92            		SUB	D
  E9C1  C8            		RET	Z		;No seek
                      	
  E9C2  3A86EC        		LD	A,(_ISEEK)
  E9C5  4F            		LD	C,A
                      	
  E9C6  3AA1EC        		LD	A,(_MAXCYL)	;Max CYLINDER
  E9C9  3D            		DEC	A
  E9CA  BA            		CP	D		;Over CYLINDER
  E9CB  D8            		RET	C
                      	
  E9CC  B9            		CP	C		;for Built-in 2DD
  E9CD  3803          		JR	C,SETM2
  E9CF  78            		LD	A,B		;B=00FH
  E9D0  DBFE          		IN	A,(0FEH)		;2HD mode for 2DD seek
  E9D2                	SETM2:
  E9D2  78            		LD	A,B
  E9D3  DBFD          		IN	A,(0FDH)		;MFM mode
                      	
  E9D5  0EFB          		LD	C,0FBH
  E9D7  ED51          		OUT	(C),D
  E9D9  72            		LD	(HL),D
  E9DA  0E18          		LD	C,018H		;Seek
  E9DC                	FDCCMD2:
  E9DC  3A85EC        		LD	A,(_SEEKSP)
  E9DF  E6FF          	FSPAT:	AND	0FFH
  E9E1  B1            		OR	C
                      	
  E9E2                	FDCCMD:
  E9E2  CD2FEA        		CALL	COMSET
                      	
  E9E5  3E80          	FDCPAT:	LD	A,080H		;FDC COMMAND(Self-rewriting)
  E9E7  E620          		AND	020H		;Write data Write track
  E9E9  3C            		INC	A
                      	
  E9EA                	SST:
  E9EA  0E00          		LD	C,0
  E9EC                	SST1:
  E9EC  0D            		DEC	C		; 4
  E9ED  20FD          		JR	NZ,SST1		;12 * 256 / 4 = About 1ms
  E9EF  3D            		DEC	A
  E9F0  20FA          		JR	NZ,SST1
                      	
  E9F2  3C            		INC	A		;A=1
  E9F3  CD01EA        		CALL	READY
  E9F6                	SETMODE:
  E9F6  78            		LD	A,B		;B=00FH
  E9F7  DBFF          	FDMODE:	IN	A,(0FFH)		;Floppy mode(2D/2HD) (Self-rewriting)
                      	
  E9F9  78            		LD	A,B
  E9FA  DBFD          		IN	A,(0FDH)		;MFM mode
                      	
  E9FC  CD33EA        		CALL	DELAY0		;Head select time
  E9FF  3E81          		LD	A,081H
  EA01                	READY:
  EA01  320BEA        		LD	(WAITA+1),A
  EA04  E5            		PUSH	HL
  EA05  0EF8          		LD	C,0F8H
  EA07  61            		LD	H,C
  EA08                	READY2:
  EA08  ED78          		IN	A,(C)
  EA0A  E681          	WAITA:	AND	081H		;NOT READY,BUSY
  EA0C  2808          		JR	Z,READYE
  EA0E  E3            		EX	(SP),HL		;wait 19clock
  EA0F  E3            		EX	(SP),HL		; //
  EA10  2B            		DEC	HL
  EA11  7C            		LD	A,H
  EA12  B5            		OR	L
  EA13  20F3          		JR	NZ,READY2
  EA15  37            		SCF
  EA16                	READYE:
  EA16  E1            		POP	HL
  EA17  C9            		RET
                      	
  EA18                	FDCRES:
  EA18  3600          		LD	(HL),0
  EA1A  0E08          		LD	C,8
  EA1C  18BE          		JR	FDCCMD2
                      	
  EA1E                	FDMOFF:
  EA1E  F5            		PUSH	AF
  EA1F  C5            		PUSH	BC
  EA20  01FC0F        		LD	BC,00FFCH	;Motor off
  EA23  3E00          	MOPAT:	LD	A,000H		;(Self-rewriting)
  EA25  ED79          		OUT	(C),A
  EA27  C1            		POP	BC
  EA28  F1            		POP	AF
  EA29  C9            		RET
                      	
  EA2A                	SECSET:
  EA2A  01FA0F        		LD	BC,00FFAH
  EA2D  ED59          		OUT	(C),E
  EA2F                	COMSET:
  EA2F  0EF8          		LD	C,0F8H
  EA31  ED79          		OUT	(C),A
  EA33                	DELAY0:
  EA33  3E1A          		LD	A,26
  EA35                	DELAY:
  EA35  3D            		DEC	A
  EA36  20FD          		JR	NZ,DELAY
  EA38  C9            		RET
                      	
  EA39                	DRIVE:
  EA39  2A84EC        		LD	HL,(_DRIVE)
  EA3C  26EC          		LD	H,_CYL0/256
  EA3E  CBFD          		SET	7,L
  EA40  7E            		LD	A,(HL)
  EA41  C9            		RET
                      	
  EA42                	RNF:
  EA42  CD39EA        		CALL	DRIVE
  EA45  36FF          		LD	(HL),0FFH
  EA47  C9            		RET
                      	
  EA48  02            	RETRY:	DB	2
                      	
                      	
                      	;	FLOPPY DISK DRIVER(DMA)
                      	
                      	
  EA49                	WTTRK:
  EA49  3EF4          		LD	A,0F4H
  EA4B  1802          		JR	WTTRK1
  EA4D                	FDWT:
  EA4D  3EA0          		LD	A,0A0H
  EA4F                	WTTRK1:
  EA4F  32E6E9        		LD	(FDCPAT+1),A
  EA52  3E10          		LD	A,16
  EA54  1807          		JR	DISK
                      	
  EA56                	FDRD:
  EA56  3E80          		LD	A,080H
  EA58  32E6E9        		LD	(FDCPAT+1),A
  EA5B  3E0E          		LD	A,14
                      	
  EA5D                	DISK:
  EA5D  3270EA        		LD	(DMAPAT+1),A
                      	
  EA60  22FBEA        		LD	(DMAD+11),HL
  EA63                	DISKR:
  EA63  3E02          		LD	A,2		;Retry count
  EA65  3248EA        		LD	(RETRY),A
  EA68                	DISK2:
  EA68  D5            		PUSH	DE
  EA69  CD7FE9        		CALL	SEEK
  EA6C  3842          		JR	C,ERRF
  EA6E  F3            		DI
                      	
  EA6F  3E0E          	DMAPAT:	LD	A,14		;自己書き換え
  EA71  21F0EA        		LD	HL,DMAD
  EA74  CDE6EA        		CALL	SETDMA
  EA77  ED49          		OUT	(C),C		;OUT 01F87H,087H
  EA79  3AE6E9        		LD	A,(FDCPAT+1)
  EA7C  C5            		PUSH	BC
  EA7D  CD2AEA        		CALL	SECSET
  EA80  2AFBEA        		LD	HL,(DMAD+11)
  EA83  23            		INC	HL
  EA84  1106BB        		LD	DE,0BB06H	;READ DMA
                      	
  EA87  3E03          		LD	A,3
  EA89  CD01EA        		CALL	READY
  EA8C  ED78          		IN	A,(C)
                      	
  EA8E  C1            		POP	BC
  EA8F  ED51          		OUT	(C),D
  EA91  ED59          		OUT	(C),E
  EA93  ED58          		IN	E,(C)
  EA95  ED50          		IN	D,(C)
  EA97  19            		ADD	HL,DE
  EA98  D1            		POP	DE
  EA99  13            		INC	DE
  EA9A  FB            		EI
  EA9B  CD1EEA        		CALL	FDMOFF
  EA9E  B7            		OR	A
  EA9F  C8            		RET	Z
  EAA0  1B            		DEC	DE
  EAA1  CB67          		BIT	4,A
  EAA3  C442EA        		CALL	NZ,RNF
  EAA6                	DISKE2:
  EAA6  2148EA        		LD	HL,RETRY
  EAA9  35            		DEC	(HL)
  EAAA  20BC          		JR	NZ,DISK2
  EAAC  B7            		OR	A
  EAAD  2834          		JR	Z,ERR
  EAAF  D5            		PUSH	DE
  EAB0                	ERRF:
  EAB0  D1            		POP	DE
  EAB1                	DELP:
  EAB1  CD42EA        		CALL	RNF
  EAB4  CD1EEA        		CALL	FDMOFF
  EAB7  3A85EC        		LD	A,(_SEEKSP)
  EABA  87            		ADD	A,A
  EABB  9F            		SBC	A,A
  EABC  3825          		JR	C,ERR
  EABE                	DELP1:
  EABE  D5            		PUSH	DE
  EABF  21B0EB        		LD	HL,DEMES
  EAC2  CDB4D8        		CALL	MSX
  EAC5  CD99D7        		CALL	KEYBC
  EAC8                	DELP2:
  EAC8  CDCAEC        		CALL	_INKEY
  EACB  28FB          		JR	Z,DELP2
                      	
  EACD  D1            		POP	DE
  EACE  CDDDDF        		CALL	CAP
  EAD1  FE52          		CP	'R'		;Retry
  EAD3  CA63EA        		JP	Z,DISKR
  EAD6  FE49          		CP	'I'		;Ignore
  EAD8  2807          		JR	Z,IGNORE
  EADA  FE41          		CP	'A'		;Abort
  EADC  20E0          		JR	NZ,DELP1
  EADE  C39FD3        		JP	BOOT
  EAE1                	IGNORE:
  EAE1  3EFF          		LD	A,0FFH
  EAE3                	ERR:
  EAE3  BF            		CP	A
  EAE4  37            		SCF
  EAE5  C9            		RET
                      	
  EAE6                	SETDMA:
  EAE6  01871F        		LD	BC,01F87H
  EAE9                	SDMA:
  EAE9  04            		INC	B
  EAEA  EDA3          		OUTI
  EAEC  3D            		DEC	A
  EAED  20FA          		JR	NZ,SDMA
  EAEF  C9            		RET
                      	
  EAF0  C37DFB0FFFFF2C	DMAD:	DB	0C3H,07DH,0FBH,00FH,0FFH,0FFH,02CH,010H		;X1turbo
  EAF8  80928D0000CF01		DB	080H,092H,08DH,000H,000H,0CFH,001H,0CFH		;DISK DMA
                      	
  EB00                	DMAE:
                      	
  1F89                	AT_R	EQU	WTTRK-AT_WTTRK
                      	
                      	;LDCALL.ASM
                      	
                      	;	LSX-Dodgers TABLES
                      	;	CTRLTB:アドレス下位1バイトが0になるように
                      	
  EB00                	CTRLTB:
  EB00  E1D97CDA19DA6C		DW	PRINTE,CTRL01,CTRL02,CTRL03
  EB08  66DB44DA45DBCC		DW	CTRL04,CTRL05,CTRL1A,CTRL07
  EB10  EDD90ADA6FDB82		DW	CTRL08,CTRL09,CTRL0A,CTRL0B
  EB18  42DB68DA84DBE1		DW	CTRL0C,CTRL0D,CTRL0E,PRINTE
  EB20  E1D9E1D97CDAE1		DW	PRINTE,PRINTE,CTRL01,PRINTE
  EB28  E1D9E1D9E1D9E1		DW	PRINTE,PRINTE,PRINTE,PRINTE
  EB30  E1D9E1D945DB8F		DW	PRINTE,PRINTE,CTRL1A,CTRL1B
  EB38  04DAEDD9F7D96F		DW	CTRL1C,CTRL1D,CTRL1E,CTRL1F
                      	
  EB40                	M2D:
  EB40  02FD0802      		DB	2,0FDH,8,2
  EB44  6401          		DW	356
  EB46  FF0C2809018205		DB	0FFH,12,40,9,1,082H,5,1
                      	
  EB4E                	M2DD8:
  EB4E  02FB0802      		DB	2,0FBH,8,2
  EB52  7C02          		DW	636
  EB54  FF0C5008018205		DB	0FFH,12,80,8,1,082H,5,1
                      	
  EB5C                	M2DD:
  EB5C  03F90A02      		DB	3,0F9H,10,2
  EB60  CB02          		DW	715
  EB62  FF0E5009018207		DB	0FFH,14,80,9,1,082H,7,1
                      	
  EB6A                	M2HC:
  EB6A  07F91B01      		DB	7,0F9H,27,1
  EB6E  4509          		DW	2373
  EB70  FE1D500F01820F		DB	0FEH,29,80,15,1,082H,15,1
                      	
  EB78                	M2HD:
  EB78  02FE0901      		DB	2,0FEH,9,1
  EB7C  C704          		DW	1223
  EB7E  FE0B4D08018405		DB	0FEH,11,77,8,1,084H,5,1
                      	
  EB86                	M2HQ:
  EB86  09F01F01      		DB	9,0F0H,31,1
  EB8A  210B          		DW	2849
  EB8C  FE215012018213		DB	0FEH,33,80,18,1,082H,19,1
                      	
  EB94                	M2HDE:
  EB94  03FE0B01      		DB	3,0FEH,11,1
  EB98  9505          		DW	1429
  EB9A  FE0D5009018407		DB	0FEH,13,80,9,1,084H,7,1
                      	
  EBA2                	M2HS:
  EBA2  03FB0801      		DB	3,0FBH,8,1
  EBA6  9805          		DW	1432
  EBA8  FE0A5009010404		DB	0FEH,10,80,9,1,4,4,10
                      	
  EBB0  0307          	DEMES:	DB	3,7
  EBB2  44657669636520		DB	"Device I/O Error",5,3
  EBC4  41626F72742052		DB	"Abort Retry Ignore?",5,3,0
                      	
  EBDA  1617          	SDDATA:	DB	22,23		;(FCB)ファイルを最後に変更した時刻
  EBDC  1415          		DB	20,21		;(FCB)ファイルを最後に変更した日付
  EBDE  1A1B          		DB	26,27		;(FCB)ファイルの先頭クラスタ
  EBE0  10111213      		DB	16,17,18,19	;(FCB)ファイルのサイズ(バイト単位)
  EBE4                	SDDATAE:
                      	
  EBE4  008E01000B000C	BEEPD:	DB	0,08EH,1,0,00BH,0,00CH,010H
  EBEC  073E08100D00FF		DB	007H,03EH,008H,010H,00DH,0,0FFH
                      	
  EBF3  00            	CHECK:	DB	0
                      	
  EBF4                	SCDIR:	DS	2		;+14 +15
  EBF6                	SFBPS:	DS	2		;FBPS
  EBF8                	SFNDF:	DS	2		;FILEN DIRF
                      	
  EBFA  0000          	_FATPS:	DW	0
  EBFC  0000          	_DIRPS:	DW	0
  EBFE  0000          	_CLPS:	DW	0
                      	
  EC00                	_PE:
                      	
                      	;	LSX-Dodgers SYSTEM CALL
                      	;	STABLE:アドレス下位1バイトが0になるように
                      	
  EC00                	STABLE:
                      	;0
  EC00  0000CDD7D9D713		DW	 00000H,_SYS01,_SYS02,_SYS03
  EC08  43CC5ACCDED7A8		DW	_SYS04,_SYS05,_SYS06,_SYS07
  EC10  E6D7DAD31FD84B		DW	_SYS08,_SYS09,_SYS0A,_SYS0B
  EC18  E9D3EFD3FED311		DW	_SYS0C,_SYS0D,_SYS0E,_SYS0F
                      	;1
  EC20  66D4B3D40FD545		DW	_SYS10,_SYS11,_SYS12,_SYS13
  EC28  4DD56BD588D580		DW	_SYS14,_SYS15,_SYS16,_SYS17
  EC30  E9D5EED5F3D5F9		DW	_SYS18,_SYS19,_SYS1A,_SYS1B
  EC38  D8D31ED6D8D322		DW	_SYS1C,_SYS1D,_SYS1E,_SYS1F
                      	;2
  EC40  D8D3BFD5D4D529		DW	_SYS20,_SYS21,_SYS22,_SYS23
  EC48  48D6D5D300E325		DW	_SYS24,_ERROR,_SYS26,_SYS27
  EC50  D4D551D661D8D5		DW	_SYS28,_SYS29,_SYS2A,_SYS2B
  EC58  9BD8D5D3D8D374		DW	_SYS2C,_SYS2D,_SYS2E,_SYS2F
                      	;3
  EC60  6ED6          		DW	_SYS30
                      	
                      	;LDWORK.ASM
                      	
                      	;	LSX-Dodgers WORK
                      	
  0004                	DDS	EQU	4
  EC62                	DDTB:
  EC62  434F4E20      		DB	"CON "
  EC66  A6D4          		DW	OPENDD
  EC68  41555820      		DB	"AUX "
  EC6C  A6D4          		DW	OPENDD
  EC6E  50524E20      		DB	"PRN "
  EC72  A6D4          		DW	OPENDD
  EC74  4E554C20      		DB	"NUL "
  EC78  A6D4          		DW	OPENDD
                      	
  EC7A                		DS	2
  EC7C  00EE          	_FATBF:	DW	FATBF
  EC7E  00FA          	_DTBUF:	DW	DTBUF
                      	
  EC80  FF            	_CYL0:	DB	0FFH	;Cylinder
  EC81  FF            	_CYL1:	DB	0FFH	;Cylinder
  EC82  FF            	_CYL2:	DB	0FFH	;Cylinder
  EC83  FF            	_CYL3:	DB	0FFH	;Cylinder
  EC84  00            	_DRIVE:	DB	0	;unit number
  EC85  00            	_SEEKSP:DB	0	;Seek speed
  EC86  FF            	_ISEEK:	DB	0FFH	;
  EC87  00            	_DVSW:	DB	0
  EC88  00            	_DRV:	DB	0
  EC89  FF            	_DSK:	DB	0FFH
  EC8A  8000          	_DTA:	DW	00080H
  EC8C  0000          	_CTC:	DW	0
  EC8E  0000          	_TXADR:	DW	0
  EC90  0000          	_KEYPS	DW	0
  EC92  00FF          	_KEYD	DW	0FF00H
  EC94  C210          	_KEYSP:	DW	010C2H
  EC96  07            	_COLORF:DB	7
  EC97  19            	_LINE:	DB	LINE
                      	
  EC98  0000          	_FCB:	DW	0
  EC9A  0000          	_FBPS:	DW	0	;SEARCH FILES
  EC9C  0000          	_FBAD:	DW	0	;    //
  EC9E  00            	_FBCNT:	DB	0	;    //
  EC9F  00            	_FILEN:	DB	0
  ECA0  00            	_DIRF:	DB	0
  ECA1  00            	_MAXCYL:DB	0
  ECA2  00            	_WTFATF:DB	0	;FATバッファの更新フラグ
  ECA3                			DS	1
  ECA4  00            	_WTDBF:	DB	0	;データバッファの更新フラグ
  ECA5  FF            	_DBDRV:	DB	0FFH	;データバッファにあるデータを読み込んだドライブ
  ECA6  0000          	_DBSEC:	DW	0	;データバッファにあるデータを読み込んだセクタ番号
  ECA8  0000          	_DPB:	DW	0
  ECAA  FF            	_FATDRV:DB	0FFH	;FATバッファに読み込んでいるドライブ
  ECAB  00            	_FATIX:	DB	0	;FATバッファに読み込んでいるインデックス
                      	
  ECAC                		DS	4
                      	
  ECB0  6F5059381F0219	CRTCD:	DB	06FH,050H,059H,038H,01FH,002H,019H,01CH
  ECB8  0007          		DB	000H,007H
  ECBA  30F8B0FF      		DW	0-80*LINE,0-80
  ECBE  0C            		DB	00CH
  ECBF  A0            	WK1FD0:	DB	0A0H
                      	
  ECC0  FDD6          	CTC0:	DW	INTCTCE
  ECC2  FDD6          	CTC1:	DW	INTCTCE
  ECC4  25D7          	CTC2:	DW	INTCTC2
  ECC6  FDD6          	CTC3:	DW	INTCTCE
  ECC8  BDD6          	INTVEC:	DW	INT
                      	
                      	;	JUMP
                      	
  ECCA  C3BDDC        	_INKEY:	JP	INKEY
  ECCD  C32CD9        	_PRINT:	JP	PRINT
  ECD0  C308DC        	_SCRN:	JP	SCRN
  ECD3  C330DC        	_POS:	JP	POS
  ECD6  C36DDA        	_LOC:	JP	LOC
  ECD9  C37DE8        	_CHGDRV:JP	CHGDRV
  ECDC  C34BE9        	_GETDPB:JP	GETDPB
  ECDF  C364E9        	_FFLUSH:JP	FFLUSH
  ECE2  C3E8E5        	_RDFATX:JP	RDFATX
  ECE5  C3EEE6        	_RDFAT:	JP	RDFAT
  ECE8  C349EA        	_WTTRK:	JP	WTTRK
  ECEB  C356EA        	_FDRD:	JP	FDRD
  ECEE  C34DEA        	_FDWT:	JP	FDWT
  ECF1  C3CBE7        	_DRD:	JP	DRD_DPB
  ECF4  C31BE8        	_DWT:	JP	DWT_DPB
  ECF7  C312E6        	_WTFATX:JP	WTFATX
  ECFA                		DS	3
  ECFD  C390CE        	_COMANL:JP	COMANL
                      	
  ED00                	WE:
                      	
                      	;LDDPB.ASM
                      	
                      	;	LSX-Dodgers DPB
                      	
  ED00                	DEVICE:
                      	
                      	;	A:
                      	
  ED00  02            	DPB_00_FATLN:	DB	2
  ED01  FD            	DPB_01_FATID:	DB	0FDH
  ED02  EBEC          	DPB_02_DRD:	DW	_FDRD
  ED04  EEEC          	DPB_04_DWT:	DW	_FDWT
  ED06  08            	DPB_06_ADDCL:	DB	8
  ED07  02            	DPB_07_SECPCL:	DB	2
  ED08  6401          	DPB_08_MAXCL:	DW	356
  ED0A  FF            	DPB_0A_FDMODE:	DB	0FFH	;0FFH=2D / 0FEH=2HD
  ED0B  0C            	DPB_0B_MAXDIR:	DB	12
  ED0C  28            	DPB_0C_MAXCYL:	DB	40
  ED0D  09            	DPB_0D_MAXSEC:	DB	9	;Number of sectors
  ED0E  01            	DPB_0E_FATPS:	DB	1
  ED0F  82            	DPB_0F_BPS:	DB	082H
  ED10  05            	DPB_10_DIRPS:	DB	5
  ED11  01            	DPB_11_MINSEC:	DB	1	;Minimum sector
  ED12  87            	DPB_12_DEVNO:	DB	087H	;Device Number
  ED13  00            	DPB_13_UNITNO:	DB	0
  ED14  0000          	DPB_14_EXTEND:	DW	0
  ED16  0000          	DPB_16:		DW	0
  ED18  0000          	DPB_18:		DW	0
  ED1A  0000          	DPB_1A_SDIR:	DW	0
  ED1C  46444430      	DPB_1C_NAME:	DB	"FDD0"
                      	
                      	;	B:
                      	
  ED20  02            		DB	2
  ED21  FD            		DB	0FDH
  ED22  EBEC          		DW	_FDRD
  ED24  EEEC          		DW	_FDWT
  ED26  08            		DB	8
  ED27  02            		DB	2
  ED28  6401          		DW	356
  ED2A  FF            		DB	0FFH	;0FFH=2D / 0FEH=2HD
  ED2B  0C            		DB	12
  ED2C  28            		DB	40
  ED2D  09            		DB	9
  ED2E  01            		DB	1
  ED2F  82            		DB	082H
  ED30  05            		DB	5
  ED31  01            		DB	1
  ED32  87            		DB	087H	;Device Number
  ED33  01            		DB	1
  ED34  0000          		DW	0
  ED36  0000          		DW	0
  ED38  0000          		DW	0
  ED3A  0000          		DW	0
  ED3C  46444431      		DB	"FDD1"
                      	
                      	;	C:
                      	
  ED40  02            		DB	2
  ED41  FD            		DB	0FDH
  ED42  EBEC          		DW	_FDRD
  ED44  EEEC          		DW	_FDWT
  ED46  08            		DB	8
  ED47  02            		DB	2
  ED48  6401          		DW	356
  ED4A  FF            		DB	0FFH	;0FFH=2D / 0FEH=2HD
  ED4B  0C            		DB	12
  ED4C  28            		DB	40
  ED4D  09            		DB	9
  ED4E  01            		DB	1
  ED4F  82            		DB	082H
  ED50  05            		DB	5
  ED51  01            		DB	1
  ED52  87            		DB	087H	;Device Number
  ED53  02            		DB	2
  ED54  0000          		DW	0
  ED56  0000          		DW	0
  ED58  0000          		DW	0
  ED5A  0000          		DW	0
  ED5C  46444432      		DB	"FDD2"
                      	
                      	;	D:
                      	
  ED60  02            		DB	2
  ED61  FD            		DB	0FDH
  ED62  EBEC          		DW	_FDRD
  ED64  EEEC          		DW	_FDWT
  ED66  08            		DB	8
  ED67  02            		DB	2
  ED68  6401          		DW	356
  ED6A  FF            		DB	0FFH	;0FFH=2D / 0FEH=2HD
  ED6B  0C            		DB	12
  ED6C  28            		DB	40
  ED6D  09            		DB	9
  ED6E  01            		DB	1
  ED6F  82            		DB	082H
  ED70  05            		DB	5
  ED71  01            		DB	1
  ED72  87            		DB	087H	;Device Number
  ED73  03            		DB	3
  ED74  0000          		DW	0
  ED76  0000          		DW	0
  ED78  0000          		DW	0
  ED7A  0000          		DW	0
  ED7C  46444433      		DB	"FDD3"
                      	
                      	;	E:
                      	
  ED80  00            	EMMFL:	DB	0
  ED81  FE            		DB	0FEH
  ED82  2ECD          	EMMRD:	DW	EDRDC
  ED84  2BCD          	EMMWR:	DW	EDWTC
  ED86  09            		DB	9
  ED87  01            		DB	1
  ED88  0000          	EMMCL:	DW	0
  ED8A  00            		DB	0
  ED8B  0B            		DB	11
  ED8C  00            	EMMBL:	DB	0
  ED8D  01            		DB	1
  ED8E  01            		DB	1
  ED8F  04            		DB	4
  ED90  05            		DB	5
  ED91  01            		DB	1
  ED92  06            		DB	6	;Device Number
  ED93  00            	EMMDV:	DB	0
  ED94  0000          		DW	0
  ED96  0000          		DW	0
  ED98  0000          		DW	0
  ED9A  0000          		DW	0
  ED9C  454D4D30      		DB	"EMM0"
                      	
                      	;	F:
                      	
  EDA0  00            	BANKFL:	DB	0
  EDA1  F9            		DB	0F9H
  EDA2  A9CC          		DW	BDRDC
  EDA4  CCCC          		DW	BDWTC
  EDA6  03            		DB	3
  EDA7  01            		DB	1
  EDA8  0000          	BANKCL:	DW	0
  EDAA  00            		DB	0
  EDAB  05            		DB	5
  EDAC  00            		DB	0
  EDAD  01            		DB	1
  EDAE  00            		DB	0
  EDAF  04            		DB	4
  EDB0  01            		DB	1
  EDB1  01            		DB	1
  EDB2  0B            		DB	00BH	;Device Number
  EDB3  00            		DB	0
  EDB4  0000          		DW	0
  EDB6  0000          		DW	0
  EDB8  0000          		DW	0
  EDBA  0000          		DW	0
  EDBC  4252414D      		DB	"BRAM"
                      	
                      	;	G:
                      	
  EDC0  01            		DB	1
  EDC1  F9            		DB	0F9H
  EDC2  7ACC          		DW	GDRD
  EDC4  85CC          		DW	GDWT
  EDC6  00            		DB	0
  EDC7  04            		DB	4
  EDC8  3000          		DW	48
  EDCA  00            		DB	0
  EDCB  08            		DB	8
  EDCC  00            		DB	0
  EDCD  01            		DB	1
  EDCE  00            		DB	0
  EDCF  01            		DB	1
  EDD0  04            		DB	4
  EDD1  01            		DB	1
  EDD2  05            		DB	5	;Device Number
  EDD3  01            		DB	1
  EDD4  0000          		DW	0
  EDD6  0000          		DW	0
  EDD8  0000          		DW	0
  EDDA  0000          		DW	0
  EDDC  4752414D      		DB	"GRAM"
                      	
                      	
                      	
  EDE0  00            	LDEND:	DB	0
                      	
  EDE1                		END
