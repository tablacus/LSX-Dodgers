			  Z80 ASSEMBLER - ZASM VER 1.6
                      	;	LSX-Dodgers for X1/turbo/Z
                      	;	Programmed by
                      	;	Gaku (Lovers/Tablacus)
                      	
  C600                	RUN	EQU	0C600h
                      	
  C5F9                		ORG	RUN-7
                      	
                      	;	MSX BINARY HEADER
  C5F9  FE            		DB	0FEH
                      	;	MSX BINARY START ADDRESS
  C5FA  00C6          		DW	RUN
                      	;	MSX BINARY END ADDRESS
  C5FC  E0ED          		DW	LDEND
                      	;	MSX BINARY EXEC ADDRESS
  C5FE  00C6          		DW	RUN
                      	;LDDEF.ASM
                      	
                      	;	LSX-Dodgers DEF
                      	
  1D00                	MAC	EQU	01D00H		;X1
  0001                	VER_1   EQU	1
  0004                	VER_2   EQU	4
  0000                	VER_3   EQU	0
  0144                	VER	EQU	VER_1 * 256 + VER_2 * 17 + VER_3
                      	
  0005                	SYSTEM	EQU	00005H
  000F                	JP_HL	EQU	0000FH
  005C                	FCB1	EQU	0005CH
  006C                	FCB2	EQU	0006CH
  005D                	FCB1FN	EQU	FCB1+1
  006D                	FCB2FN	EQU	FCB2+1
  0080                	DTA1	EQU	00080H
  EE00                	FATBF	EQU	0EE00H
  FA00                	DTBUF	EQU	0FA00H
  FE00                	KEYBF	EQU	0FE00H
  FF00                	KBUF	EQU	0FF00H
  0000                	EXTSP	EQU	00000H
  0018                	LINE	EQU	24
                      	
                      	;LDINIT.ASM
                      	
                      	;	LSX-Dodgers INIT
                      	
  C600  C307C6        		JP	START
  C603  001D          	MACHINE:DW	MAC
  C605  4401          	VERSION:DW	VER
                      	
  C607                	START:
  C607  F3            		DI
  C608  ED5E          		IM	2
  C60A  310000        		LD	SP,EXTSP
  C60D  CD1BC6        		CALL	INIT		;NZならAUTOEXECを実行
  C610  210000        		LD	HL,0
  C613  E5            		PUSH	HL
  C614  C8            		RET	Z
  C615  11B6C9        		LD	DE,AUTOD
  C618  C3FDEC        		JP	_COMANL
                      	
  C61B                	INIT:
  C61B  3E1E          		LD	A,01EH
  C61D  D300          		OUT	(0),A
                      	
  C61F  010000        		LD	BC,0
  C622  ED438CEC      		LD	(_CTC),BC
  C626  01040A        		LD	BC,00A04H
  C629  CD60C9        		CALL	CHKCTC
  C62C  010407        		LD	BC,00704H
  C62F  CD60C9        		CALL	CHKCTC
  C632  01A81F        		LD	BC,01FA8H
  C635  CD60C9        		CALL	CHKCTC
  C638  01A01F        		LD	BC,01FA0H
  C63B  CD60C9        		CALL	CHKCTC
                      	;
  C63E                	INISIO:
  C63E  01911F        		LD	BC,01F91H	;INIT SIO
  C641  1601          		LD	D,1
  C643  ED51          		OUT	(C),D
                      	
  C645  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  C647  0E93          		LD	C,093H
  C649  ED51          		OUT	(C),D
  C64B  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  C64D  0E99          		LD	C,099H		;INIT SIO
  C64F  1601          		LD	D,1
  C651  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  C653  0E9B          		LD	C,09BH
  C655  ED51          		OUT	(C),D
  C657  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
                      	
  C659  0E80          		LD	C,080H		;INIT DMA
  C65B  2106C3        		LD	HL,0C306H
  C65E                	INIDMA:
  C65E  ED61          		OUT	(C),H
  C660  2D            		DEC	L
  C661  20FB          		JR	NZ,INIDMA
                      	
  C663  3EE4          		LD	A,0E4H
  C665  CD9EDA        		CALL	COMOUT
  C668  AF            		XOR	A
  C669  CD78DA        		CALL	OT49SB
                      	
  C66C  3EEC          		LD	A,INTVEC/256
  C66E  ED47          		LD	I,A
                      	
  C670  ED4B8CEC      		LD	BC,(_CTC)
  C674  0B            		DEC	BC
  C675  0B            		DEC	BC
                      	
  C676  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  C678  3EC0          		LD	A,CTC0
  C67A  ED79          		OUT	(C),A
                      	
  C67C  0C            		INC	C
  C67D  3E47          		LD	A,047H
  C67F  ED79          		OUT	(C),A
  C681  3E0D          		LD	A,13		;Baudrate 9600-13
  C683  ED79          		OUT	(C),A
                      	
  C685  79            		LD	A,C
  C686  D610          		SUB	010H
  C688  4F            		LD	C,A
                      	;	LD	(SIOAD+1),BC
                      	;	LD	(SIOAD0+1),BC
                      	;	LD	(SIOAD1+1),BC
                      	
  C689  2118CA        		LD	HL,SIODATA
  C68C                	SINIT1:
  C68C  7E            		LD	A,(HL)
  C68D  23            		INC	HL
  C68E  FEFF          		CP	0FFH
  C690  2804          		JR	Z,SINIT2
  C692  ED79          		OUT	(C),A
  C694  18F6          		JR	SINIT1
  C696                	SINIT2:
  C696  3EE4          		LD	A,0E4H
  C698  CD9EDA        		CALL	COMOUT
  C69B  3EC8          		LD	A,INTVEC
  C69D  CD78DA        		CALL	OT49SB
                      	;
  C6A0  01C41F        		LD	BC,01FC4H
  C6A3  3E0C          		LD	A,00CH
  C6A5  ED79          		OUT	(C),A
                      	
  C6A7  0EC0          		LD	C,0C0H
  C6A9  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
                      	
  C6AB  0C            		INC	C
  C6AC  3E28          		LD	A,40
  C6AE  ED79          		OUT	(C),A
                      	
  C6B0  0C            		INC	C
  C6B1  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
                      	
  C6B3  0C            		INC	C
  C6B4  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
                      	
  C6B6  0EC5          		LD	C,0C5H
  C6B8  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
                      	
  C6BA                	TEXT:
  C6BA  0EB0          		LD	C,0B0H
  C6BC  3E80          		LD	A,080H
  C6BE  ED79          		OUT	(C),A
  C6C0  1607          		LD	D,7
  C6C2  0EB9          		LD	C,0B9H
  C6C4  2111CA        		LD	HL,TEXTDT
  C6C7                	TEXT1:
  C6C7  04            		INC	B
  C6C8  EDA3          		OUTI
  C6CA  0C            		INC	C
  C6CB  15            		DEC	D
  C6CC  20F9          		JR	NZ,TEXT1
  C6CE  01B01F        		LD	BC,01FB0H
  C6D1  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
                      	
  C6D3  0EC4          		LD	C,0C4H
  C6D5  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
                      	
  C6D7  01011A        		LD	BC,01A01H
  C6DA  ED78          		IN	A,(C)
  C6DC  E608          		AND	8
  C6DE  2809          		JR	Z,PRN
  C6E0  0E03          		LD	C,003H
  C6E2  3E0F          		LD	A,00FH
  C6E4  ED79          		OUT	(C),A
  C6E6  01040A        		LD	BC,00A04H
  C6E9                	PRN:
  C6E9  210000        		LD	HL,0
  C6EC  065C          		LD	B,05CH
  C6EE  3EC9          		LD	A,0C9H	;C9=RET
  C6F0  CD05DD        		CALL	FILL_MEMORY
  C6F3  06A4          		LD	B,0A4H
  C6F5  AF            		XOR	A
  C6F6  CD05DD        		CALL	FILL_MEMORY
                      	
  C6F9  3EC3          		LD	A,0C3H		;JP
  C6FB  2103EB        		LD	HL,WBOOT
  C6FE  320000        		LD	(00000H),A
  C701  220100        		LD	(00001H),HL	;IPL
                      	
  C704  2A03C6        		LD	HL,(MACHINE)	;3 bit7  DPB Original(1)
                      					;  bit6-4 DPB_LEVEL
  C707  220300        		LD	(00003H),HL	;  bit3-0 Machine X1(0)
                      	;				;4 LSX-Dodgers(01DH)
  C70A  2106CC        		LD	HL,BDOS
  C70D  320500        		LD	(00005H),A
  C710  220600        		LD	(00006H),HL	;BDOS
                      	
  C713  2174D6        		LD	HL,BIOS
  C716  321800        		LD	(00018H),A	;BIOS-ROM
  C719  221900        		LD	(00019H),HL
                      	
  C71C  210000        		LD	HL,0
  C71F  323800        		LD	(00038H),A	;RST038H
  C722  223900        		LD	(00039H),HL
                      	
  C725  3EEC          		LD	A,STABLE/256
  C727  320B00        		LD	(0000BH),A
                      	
  C72A  3EE9          		LD	A,0E9H		;JP (HL)
  C72C  320F00        		LD	(0000FH),A
                      	
  C72F  3A7DEC        		LD	A,(_FATBF+1)
  C732  321300        		LD	(00013H),A
                      	
  C735  3A7FEC        		LD	A,(_DTBUF+1)
  C738  321700        		LD	(00017H),A
                      	
  C73B  3EFE          		LD	A,KEYBF/256
  C73D  321B00        		LD	(0001BH),A
                      	
  C740  3EFF          		LD	A,KBUF/256
  C742  321F00        		LD	(0001FH),A
                      	
  C745  2A05C6        		LD	HL,(VERSION)
  C748  225A00        		LD	(0005AH),HL
                      	
  C74B  3EE6          		LD	A,0E6H
  C74D  CD9EDA        		CALL	COMOUT
  C750  CD83DA        		CALL	IN49SB
  C753  F5            		PUSH	AF
  C754  CD83DA        		CALL	IN49SB
  C757  F1            		POP	AF
  C758  F5            		PUSH	AF
  C759  E612          		AND	012H
  C75B  2005          		JR	NZ,KEYR
  C75D  3E01          		LD	A,1
  C75F  32C6C8        		LD	(KEYREP+1),A
  C762                	KEYR:
  C762  F1            		POP	AF
  C763  E603          		AND	3
  C765  280E          		JR	Z,NON
                      	
  C767  01D03F        		LD	BC,03FD0H
  C76A  ED49          		OUT	(C),C
  C76C  3E37          		LD	A,037H
  C76E  D3D0          		OUT	(0D0H),A
  C770  ED78          		IN	A,(C)
  C772  B9            		CP	C
  C773  2878          		JR	Z,TURBO
  C775                	NON:
  C775  3D            		DEC	A		;A=0FFH
  C776  321800        		LD	(00018H),A	;BIOS-ROM
                      	
  C779  2124CA        		LD	HL,AT_SCR1
  C77C  1128DB        		LD	DE,SCR1
  C77F  01A100        		LD	BC,SCRNX-SCR1	;転送先のサイズ確認用
  C782  019F00        		LD	BC,AT_SCRE-AT_SCR1
  C785  EDB0          		LDIR
                      	
  C787  21C3CA        		LD	HL,AT_WTTRK
  C78A  1147EA        		LD	DE,WTTRK
  C78D  01B900        		LD	BC,DMAE-WTTRK	;転送先のサイズ確認用
  C790  01B100        		LD	BC,AT_CPUE-AT_WTTRK
  C793  EDB0          		LDIR
                      	
  C795  2174CB        		LD	HL,AT_EDWT
  C798  1125D3        		LD	DE,EDWT
  C79B  014C00        		LD	BC,EMME-EDWT	;転送先のサイズ確認用
  C79E  014800        		LD	BC,AT_EMME-AT_EDWT
  C7A1  EDB0          		LDIR
                      	
  C7A3  21A8EA        		LD	HL,AT_DRD+AT_R
  C7A6  22ECEC        		LD	(_FDRD+1),HL
  C7A9  214DEA        		LD	HL,AT_DWT+AT_R
  C7AC  22EFEC        		LD	(_FDWT+1),HL
  C7AF  2139D3        		LD	HL,AT_EDRD+AT_RE
  C7B2  2282ED        		LD	(EMMRD),HL
  C7B5  2125D3        		LD	HL,AT_EDWT+AT_RE
  C7B8  2284ED        		LD	(EMMWR),HL
                      	
  C7BB  3E27          		LD	A,027H			;ノンターボはMFM切り替えを行わない
  C7BD  3212ED        		LD	(DEVICE+012H),A		;Aドライブ
  C7C0  3232ED        		LD	(DEVICE+012H+32),A	;Bドライブ
  C7C3  3252ED        		LD	(DEVICE+012H+32*2),A	;Cドライブ
  C7C6  3272ED        		LD	(DEVICE+012H+32*3),A	;Dドライブ
                      	
  C7C9  210000        		LD	HL,0
  C7CC  22C9DA        		LD	(X1PAT),HL
                      	
  C7CF  3EAF          		LD	A,0AFH		;XOR	A
  C7D1  32E2D8        		LD	(X1KPAT),A
                      	
  C7D4  21C9DB        		LD	HL,SCRNX
  C7D7  22D1EC        		LD	(_SCRN+1),HL
                      	
  C7DA  CD87C9        		CALL	SETCRTC
  C7DD  0610          		LD	B,010H		;PALET
  C7DF  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  C7E1  04            		INC	B
  C7E2  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  C7E4  04            		INC	B
  C7E5  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  C7E7  04            		INC	B
  C7E8  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  C7EA  C381C8        		JP	NOBANK
                      	
  C7ED                	TURBO:
  C7ED  F3            		DI			;Check BIOS
  C7EE  061D          		LD	B,01DH
  C7F0  ED79          		OUT	(C),A		;BIOS ON
  C7F2  3A512F        		LD	A,(02F51H)
  C7F5  04            		INC	B		;B=01EH
  C7F6  ED79          		OUT	(C),A		;BIOS OFF
  C7F8  FB            		EI
  C7F9  FEC9          		CP	0C9H
  C7FB  280B          		JR	Z,BIOSOK
  C7FD  3EAF          		LD	A,0AFH		;XOR	A
  C7FF  32E2D8        		LD	(X1KPAT),A
  C802  21C9DB        		LD	HL,SCRNX
  C805  22D1EC        		LD	(_SCRN+1),HL
  C808                	BIOSOK:
  C808  3E1F          		LD	A,01FH		;スタートポート
  C80A  DBF0          		IN	A,(0F0H)
  C80C  0F            		RRCA
  C80D  380B          		JR	C,CRT1
  C80F  2101CA        		LD	HL,_C8025H
  C812  11B0EC        		LD	DE,CRTCD
  C815  011000        		LD	BC,16
  C818  EDB0          		LDIR
  C81A                	CRT1:
  C81A  CD87C9        		CALL	SETCRTC
  C81D  01AA10        		LD	BC,010AAH	;PALET
  C820  ED49          		OUT	(C),C
  C822  01CC11        		LD	BC,011CCH
  C825  ED49          		OUT	(C),C
  C827  01F012        		LD	BC,012F0H
  C82A  ED49          		OUT	(C),C
  C82C  04            		INC	B
  C82D  ED71          		DB	0EDH,071H
                      	
  C82F  3E1F          		LD	A,01FH		;スタートポート
  C831  DBF0          		IN	A,(0F0H)
  C833  CB57          		BIT	2,A
  C835  2818          		JR	Z,BANK
                      	
  C837  AF            		XOR	A
  C838                	TZ1:				;前面スイッチが2HDの場合はMFMモードを2HDにしておく
  C838  F5            		PUSH	AF
  C839  CDDCEC        		CALL	_GETDPB
  C83C  DD7E12        		LD	A,(IX+012H)	;DPB_12_DEVICE
  C83F  E68F          		AND	08FH
  C841  FE87          		CP	087H		;フロッピーでMEM切り替えがON
  C843  2004          		JR	NZ,TZ2
  C845  DDCB0A86      		RES	0,(IX+0AH)	;(DPB_0A_FDMODE)
  C849                	TZ2:
  C849  F1            		POP	AF
  C84A  3C            		INC	A
  C84B  FE08          		CP	8
  C84D  38E9          		JR	C,TZ1
                      	
  C84F                	BANK:
  C84F  01000B        		LD	BC,00B00H
  C852  21007F        		LD	HL,07F00H
  C855  F3            		DI
  C856                	BANK1:
  C856  ED69          		OUT	(C),L
  C858  5E            		LD	E,(HL)
  C859  7B            		LD	A,E
  C85A  C6A5          		ADD	A,0A5H
  C85C  77            		LD	(HL),A
  C85D  BE            		CP	(HL)
  C85E  73            		LD	(HL),E
  C85F  2005          		JR	NZ,BANK2
  C861  2C            		INC	L
  C862  CB65          		BIT	4,L
  C864  28F0          		JR	Z,BANK1
  C866                	BANK2:
  C866  3E10          		LD	A,010H
  C868  ED79          		OUT	(C),A
  C86A  7D            		LD	A,L
  C86B  B7            		OR	A
  C86C  2813          		JR	Z,NOBANK
  C86E  2600          		LD	H,0
  C870  29            		ADD	HL,HL	;*2
  C871  29            		ADD	HL,HL	;*4
  C872  29            		ADD	HL,HL	;*8
  C873  29            		ADD	HL,HL	;*16
  C874  29            		ADD	HL,HL	;*32
  C875  2B            		DEC	HL	;-1
  C876  2B            		DEC	HL	;-2
  C877  2B            		DEC	HL	;-3
  C878  22A8ED        		LD	(BANKCL),HL
  C87B  CDA6C9        		CALL	CALC_FATLN
  C87E  32A0ED        		LD	(BANKFL),A
  C881                	NOBANK:
  C881                	EMM:
  C881  CD50C9        		CALL	EADR0
  C884  ED78          		IN	A,(C)
  C886  F5            		PUSH	AF
                      	
  C887  110000        		LD	DE,0
  C88A                	ECHECK1:
  C88A  13            		INC	DE
  C88B  CD33C9        		CALL	EADR2
  C88E  ED60          		IN	H,(C)
  C890  CD33C9        		CALL	EADR2
  C893  7C            		LD	A,H
  C894  C6E5          		ADD	A,0E5H
  C896  ED79          		OUT	(C),A
  C898  3C            		INC	A
  C899  CD50C9        		CALL	EADR0
  C89C  ED79          		OUT	(C),A
  C89E  3D            		DEC	A
  C89F  CD33C9        		CALL	EADR2
  C8A2  ED68          		IN	L,(C)
  C8A4  CD33C9        		CALL	EADR2
  C8A7  ED61          		OUT	(C),H
  C8A9  BD            		CP	L
  C8AA  2004          		JR	NZ,ECHECK2
  C8AC  CB5A          		BIT	3,D
  C8AE  28DA          		JR	Z,ECHECK1
  C8B0                	ECHECK2:
  C8B0  CD50C9        		CALL	EADR0
  C8B3  F1            		POP	AF
  C8B4  ED79          		OUT	(C),A
                      	
  C8B6  21F7FF        		LD	HL,0-9
  C8B9  19            		ADD	HL,DE
  C8BA  3009          		JR	NC,NOEMM
  C8BC  2288ED        		LD	(EMMCL),HL
  C8BF  CDA6C9        		CALL	CALC_FATLN
  C8C2  3280ED        		LD	(EMMFL),A
  C8C5                	NOEMM:
  C8C5  3E00          	KEYREP:	LD	A,000H
  C8C7  B7            		OR	A
  C8C8  2807          		JR	Z,KEYR1
  C8CA  010000        		LD	BC,0
  C8CD  ED438CEC      		LD	(_CTC),BC
  C8D1                	KEYR1:
  C8D1  0130F8        		LD	BC,0-80*25
  C8D4  2ABAEC        		LD	HL,(CRTCD+10)
  C8D7  ED43BAEC      		LD	(CRTCD+10),BC
  C8DB  1E0C          		LD	E,00CH
  C8DD  CDCDEC        		CALL	_PRINT
  C8E0  22BAEC        		LD	(CRTCD+10),HL
                      	
  C8E3  21C2C9        		LD	HL,INIMES
  C8E6  CDB3D3        		CALL	MSX
                      	
  C8E9  3A87FF        		LD	A,(0FF87H)
  C8EC  FE08          		CP	8
  C8EE  301E          		JR	NC,INIT0
  C8F0  5F            		LD	E,A
  C8F1  C641          		ADD	A,'A'
  C8F3  32BFC9        		LD	(AUTODV),A
  C8F6  0E0E          		LD	C,00EH
  C8F8  CD0500        		CALL	SYSTEM
  C8FB  1C            		INC	E
  C8FC  2185EC        		LD	HL,_SEEKSP	;Disk error Ignore
  C8FF  CBFE          		SET	7,(HL)
  C901  0E1B          		LD	C,01BH
  C903  CD0500        		CALL	SYSTEM
                      	
  C906  2185EC        		LD	HL,_SEEKSP
  C909  CBBE          		RES	7,(HL)
                      	
  C90B  3C            		INC	A
  C90C  2008          		JR	NZ,INIT1
  C90E                	INIT0:
  C90E  1E00          		LD	E,0
  C910  0E0E          		LD	C,00EH
  C912  CD0500        		CALL	SYSTEM
  C915  AF            		XOR	A
  C916                	INIT1:
  C916  F3            		DI
  C917  08            		EX	AF,AF'
  C918  2EFE          		LD	L,0-2		;CALLのスタック分減らす
  C91A  39            		ADD	HL,SP
  C91B  1100FF        		LD	DE,0FF00H
  C91E  45            		LD	B,L
  C91F  CD5DD0        		CALL	ZERO_MEMORY_DE
  C922  08            		EX	AF,AF'
  C923  B7            		OR	A
  C924  C8            		RET	Z
                      	
  C925  3EE6          		LD	A,0E6H
  C927  CD9EDA        		CALL	COMOUT
  C92A  CD83DA        		CALL	IN49SB
  C92D  CD83DA        		CALL	IN49SB
  C930  FE1B          		CP	01BH
  C932  C9            		RET
                      	
  C933                	EADR2:
  C933  D5            		PUSH	DE
  C934  EB            		EX	DE,HL
  C935  29            		ADD	HL,HL
  C936  29            		ADD	HL,HL
  C937  ED4B8BED      		LD	BC,(EMMBL-1)
  C93B  0E00          		LD	C,0
  C93D  09            		ADD	HL,BC
  C93E  ED4B93ED      		LD	BC,(EMMDV)
  C942  060D          		LD	B,00DH
  C944  ED49          		OUT	(C),C
  C946  0C            		INC	C
  C947  ED69          		OUT	(C),L
  C949  0C            		INC	C
  C94A  ED61          		OUT	(C),H
  C94C  0C            		INC	C
  C94D  EB            		EX	DE,HL
  C94E  D1            		POP	DE
  C94F  C9            		RET
                      	
  C950                	EADR0:
  C950  ED4B93ED      		LD	BC,(EMMDV)
  C954  060D          		LD	B,00DH
  C956  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  C958  0C            		INC	C
  C959  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  C95B  0C            		INC	C
  C95C  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  C95E  0C            		INC	C
  C95F  C9            		RET
                      	
  C960                	CHKCTC:
  C960  C5            		PUSH	BC
  C961  110347        		LD	DE,04703H
  C964                	INICTC1:
  C964  0C            		INC	C
  C965  ED51          		OUT	(C),D
  C967  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  C969  1D            		DEC	E
  C96A  20F8          		JR	NZ,INICTC1
  C96C  C1            		POP	BC
                      	
  C96D  11FA07        		LD	DE,007FAH
  C970  ED51          		OUT	(C),D
  C972  ED59          		OUT	(C),E
  C974  ED78          		IN	A,(C)
  C976  BB            		CP	E
  C977  C0            		RET	NZ
  C978  ED51          		OUT	(C),D
  C97A  ED51          		OUT	(C),D
  C97C  ED78          		IN	A,(C)
  C97E  BA            		CP	D
  C97F  C0            		RET	NZ
  C980  03            		INC	BC
  C981  03            		INC	BC
  C982  ED438CEC      		LD	(_CTC),BC
  C986  C9            		RET
                      	
  C987                	SETCRTC:
  C987  21B0EC        		LD	HL,CRTCD
  C98A  AF            		XOR	A
  C98B                	SETCRT1:
  C98B  010018        		LD	BC,01800H
  C98E  ED79          		OUT	(C),A
  C990  0C            		INC	C
  C991  04            		INC	B
  C992  EDA3          		OUTI
  C994  3C            		INC	A
  C995  FE0C          		CP	12
  C997  20F2          		JR	NZ,SETCRT1
  C999  23            		INC	HL
  C99A  23            		INC	HL
  C99B  01031B        		LD	BC,01A03H+00100H
  C99E  EDA3          		OUTI
  C9A0  01D020        		LD	BC,01FD0H+00100H
  C9A3  EDA3          		OUTI
  C9A5  C9            		RET
                      	
  C9A6                	CALC_FATLN:	;FAT12のクラスタ数から必要なFATサイズを求める(セクタサイズ512)
  C9A6  5D            		LD	E,L
  C9A7  54            		LD	D,H
  C9A8  29            		ADD	HL,HL	;*2
  C9A9  19            		ADD	HL,DE	;*3
  C9AA  CB3C          		SRL	H	;/2
  C9AC  CB1D          		RR	L	;1クラスタ辺り1.5バイト必要
  C9AE  11FF01        		LD	DE,511	;切り上げる
  C9B1  19            		ADD	HL,DE
  C9B2  7C            		LD	A,H
  C9B3  CB3F          		SRL	A
  C9B5  C9            		RET
                      	
  C9B6  4155544F455845	AUTOD:	DB	"AUTOEXEC "
  C9BF  413A00        	AUTODV:	DB	"A:",0
                      	
  C9C2  4C53582D446F64	INIMES:	DB	"LSX-Dodgers for X1/turbo version "
  C9E3  312E          		DB	030H + VER_1, '.'
  C9E5  3430          		DB	030H + VER_2 ,030H + VER_3
  C9E7  2047616B752028		DB	' Gaku (Lovers/Tablacus)',0DH,0AH
  CA00  00            		DB	0
                      	
  CA01                	_C8025H:
  CA01  6B5059881B0119		DB	06BH,050H,059H,088H,01BH,001H,019H,01AH
  CA09  000F          		DB	000H,00FH
  CA0B  80F8B0FF      		DW	0-80*LINE,0-80
  CA0F  0CA3          		DB	00CH,0A3H
                      	
  CA11  030C0F30333C3F	TEXTDT:	DB	003H,00CH,00FH,030H,033H,03CH,03FH
                      	
  CA18                	SIODATA:
  CA18  18            		DB	018H
  CA19  0100          		DB	1,0
  CA1B  0200          		DB	2,0
  CA1D  03C1          		DB	3,0C1H
  CA1F  0444          		DB	4,044H
  CA21  05E8          		DB	5,0E8H
  CA23  FF            		DB	0FFH
                      	
                      	;	ノンターボ用パッチ
                      	
  CA24                	AT_SCR1:
  CA24  D9            		EXX
  CA25  C5            		PUSH	BC
  CA26  015020        		LD	BC,02000H+80
  CA29  D9            		EXX
  CA2A  C5            		PUSH	BC
  CA2B  010020        		LD	BC,02000H
                      	
  CA2E  67            		LD	H,A
  CA2F  B7            		OR	A
  CA30                	AT_SCRUP1:
  CA30  2815          		JR	Z,AT_SCRCL
  CA32  C5            		PUSH	BC
  CA33  CBE0          		SET	4,B
  CA35  D9            		EXX
  CA36  C5            		PUSH	BC
  CA37  CBE0          		SET	4,B
  CA39  D9            		EXX
  CA3A  CD62DB        		CALL	AT_UPSUB+AT_RS
  CA3D  D9            		EXX
  CA3E  C1            		POP	BC
  CA3F  D9            		EXX
  CA40  C1            		POP	BC
  CA41  CD62DB        		CALL	AT_UPSUB+AT_RS
  CA44  25            		DEC	H
  CA45  18E9          		JR	AT_SCRUP1
                      	
  CA47                	AT_SCRCL:
  CA47  215020        		LD	HL,02000H+80
  CA4A  3A96EC        		LD	A,(_COLORF)
  CA4D                	AT_SCRCL1:
  CA4D  CBE0          		SET	4,B
  CA4F  ED61          		OUT	(C),H
  CA51  CBA0          		RES	4,B
  CA53  ED79          		OUT	(C),A
  CA55  03            		INC	BC
  CA56  2D            		DEC	L
  CA57  20F4          		JR	NZ,AT_SCRCL1
  CA59  C1            		POP	BC
  CA5A  D9            		EXX
  CA5B  C1            		POP	BC
  CA5C  D9            		EXX
  CA5D  C9            		RET
                      	
  CA5E                	AT_UPSUB:
  CA5E  2E28          		LD	L,40
  CA60                	AT_UPSUB1:
  CA60  D9            		EXX
  CA61  ED78          		IN	A,(C)
  CA63  03            		INC	BC
  CA64  D9            		EXX
  CA65  ED79          		OUT	(C),A
  CA67  03            		INC	BC
  CA68  D9            		EXX
  CA69  ED78          		IN	A,(C)
  CA6B  03            		INC	BC
  CA6C  D9            		EXX
  CA6D  ED79          		OUT	(C),A
  CA6F  03            		INC	BC
  CA70  2D            		DEC	L
  CA71  20ED          		JR	NZ,AT_UPSUB1
  CA73  C9            		RET
                      	
                      	;	FLOPPY DISK DRIVER(CPU)
                      	
  CA74                	DISKC:
  CA74  1B            		DEC	DE
  CA75  CB5F          		BIT	3,A
  CA77  C440EA        		CALL	NZ,RNF
  CA7A                	DISKD:
  CA7A  E5            		PUSH	HL
  CA7B  2146EA        		LD	HL,RETRY
  CA7E  35            		DEC	(HL)
  CA7F  E1            		POP	HL
  CA80  203E          		JR	NZ,AT_ERR		;Retry
  CA82  B7            		OR	A
  CA83  283B          		JR	Z,AT_ERR		;Error
                      	
  CA85                	AT_DELP:
  CA85  CD40EA        		CALL	RNF
  CA88  CD1CEA        		CALL	FDMOFF
  CA8B  3A85EC        		LD	A,(_SEEKSP)
  CA8E  87            		ADD	A,A
  CA8F  382E          		JR	C,AT_ERRZ
  CA91                	AT_DELP1:
  CA91  D5            		PUSH	DE
  CA92  21C0EB        		LD	HL,DEMES
  CA95  CDB3D3        		CALL	MSX
  CA98  CD45D7        		CALL	KEYBC
  CA9B                	AT_DELP2:
  CA9B  CDCAEC        		CALL	_INKEY
  CA9E  28FB          		JR	Z,AT_DELP2
                      	
  CAA0  D1            		POP	DE
  CAA1  CD79DF        		CALL	CAP
  CAA4  FE52          		CP	'R'		;Retry
  CAA6  200A          		JR	NZ,AT_DELP3
  CAA8  210000        	DHLPAT:	LD	HL,0
  CAAB  3E02          		LD	A,2
  CAAD  3246EA        		LD	(RETRY),A
  CAB0  B7            		OR	A
  CAB1  C9            		RET
  CAB2                	AT_DELP3:
  CAB2  FE49          		CP	'I'		;Ignore
  CAB4  2807          		JR	Z,AT_IGNORE
  CAB6  FE41          		CP	'A'		;Abort
  CAB8  20D7          		JR	NZ,AT_DELP1
  CABA  C300EB        		JP	BOOT
  CABD                	AT_IGNORE:
  CABD  3EFF          		LD	A,0FFH
  CABF                	AT_ERRZ:
  CABF  BF            		CP	A
  CAC0                	AT_ERR:
  CAC0  3EFF          		LD	A,0FFH
  CAC2  C9            		RET
                      	
  CAC3                	AT_SCRE:
                      	
  CAC3                	AT_WTTRK:
  CAC3  0601          		LD	B,1
  CAC5  3EF0          		LD	A,0F0H
  CAC7  1802          		JR	AT_WTTRK1
  CAC9                	AT_DWT:
  CAC9  3EA0          		LD	A,0A0H
  CACB                	AT_WTTRK1:
  CACB  32E4E9        		LD	(FDCPAT+1),A
  CACE                	DWTBL:
  CACE  78            		LD	A,B
  CACF  3293EA        		LD	(AT_WTB+1+AT_R),A
  CAD2  3E02          		LD	A,2		;Retry count
  CAD4  3246EA        		LD	(RETRY),A
                      	
  CAD7                	DWT0:
  CAD7  D5            		PUSH	DE
  CAD8  E5            		PUSH	HL
  CAD9  22ADDB        		LD	(DHLPAT+1+AT_RS),HL
  CADC  CD7EE9        		CALL	SEEK		;Write disk
  CADF  E1            		POP	HL
  CAE0  3838          		JR	C,ERRDW
  CAE2  F3            		DI
  CAE3  3AE4E9        		LD	A,(FDCPAT+1)
  CAE6  CD28EA        		CALL	SECSET
  CAE9  0EFB          		LD	C,0FBH
                      	
  CAEB                	DWT1:
  CAEB  56            		LD	D,(HL)
  CAEC                	DWT2:
  CAEC  78            		LD	A,B
  CAED  DBF8          		IN	A,(0F8H)
  CAEF  0F            		RRCA
  CAF0  3008          		JR	NC,DWT4
  CAF2  0F            		RRCA
  CAF3  30F7          		JR	NC,DWT2
  CAF5                	DWT3:
  CAF5  ED51          		OUT	(C),D
  CAF7  23            		INC	HL
  CAF8  18F1          		JR	DWT1
                      	
  CAFA                	DWT4:
  CAFA  3D            		DEC	A
  CAFB  28F8          		JR	Z,DWT3
  CAFD  3C            		INC	A
  CAFE  FB            		EI
  CAFF  D1            		POP	DE
  CB00  13            		INC	DE
  CB01  CD1CEA        		CALL	FDMOFF
  CB04  2808          		JR	Z,DISKOK_WT
  CB06  CD78DB        		CALL	DISKC+AT_RS
  CB09  20CC          		JR	NZ,DWT0
  CB0B  B7            		OR	A
  CB0C  2005          		JR	NZ,ERRW
                      	
  CB0E                	DISKOK_WT:
  CB0E  0601          	AT_WTB:	LD	B,1
  CB10  10BC          		DJNZ	DWTBL
  CB12  C9            		RET
                      	
  CB13                	ERRW:
  CB13  3EFF          		LD	A,0FFH
  CB15                	ERRZ:
  CB15  BF            		CP	A
  CB16  37            		SCF
  CB17  C31CEA        		JP	FDMOFF
                      	
  CB1A                	ERRDW:
  CB1A  D1            		POP	DE
  CB1B  CD89DB        		CALL	AT_DELP+AT_RS
  CB1E  20B7          		JR	NZ,DWT0
  CB20  B7            		OR	A
  CB21  20F0          		JR	NZ,ERRW
  CB23  C9            		RET
                      	
  CB24                	AT_DRD:
  CB24  3E80          		LD	A,080H
  CB26  32E4E9        		LD	(FDCPAT+1),A
  CB29                	DRDBL:
  CB29  78            		LD	A,B
  CB2A  32EAEA        		LD	(AT_RDB+1+AT_R),A
  CB2D  3E02          		LD	A,2		;Retry count
  CB2F  3246EA        		LD	(RETRY),A
  CB32                	DRD0:
  CB32  D5            		PUSH	DE
  CB33  E5            		PUSH	HL
  CB34  22ADDB        		LD	(DHLPAT+1+AT_RS),HL
  CB37  CD7EE9        		CALL	SEEK		;Read disk
  CB3A  E1            		POP	HL
  CB3B  382D          		JR	C,ERRDR
  CB3D  F3            		DI
  CB3E  3AE4E9        		LD	A,(FDCPAT+1)
  CB41  CD28EA        		CALL	SECSET
  CB44  0EFB          		LD	C,0FBH
  CB46                	DRD1:
  CB46  78            		LD	A,B
  CB47  DBF8          		IN	A,(0F8H)
  CB49  0F            		RRCA
  CB4A  3008          		JR	NC,DRD3
  CB4C  0F            		RRCA
  CB4D  30F7          		JR	NC,DRD1
  CB4F  EDA2          		INI
  CB51  04            		INC	B
  CB52  18F2          		JR	DRD1
                      	
  CB54                	DRD3:
  CB54  B7            		OR	A
  CB55  FB            		EI
  CB56  D1            		POP	DE
  CB57  13            		INC	DE
  CB58  CD1CEA        		CALL	FDMOFF
  CB5B  2808          		JR	Z,DISKOK_RD
  CB5D  CD78DB        		CALL	DISKC+AT_RS
  CB60  20D0          		JR	NZ,DRD0
  CB62  B7            		OR	A
  CB63  20AE          		JR	NZ,ERRW
                      	
  CB65                	DISKOK_RD:
  CB65  0601          	AT_RDB:	LD	B,1
  CB67  10C0          		DJNZ	DRDBL
  CB69  C9            		RET
                      	
  CB6A                	ERRDR:
  CB6A  D1            		POP	DE
  CB6B  CD89DB        		CALL	AT_DELP+AT_RS
  CB6E  20C2          		JR	NZ,DRD0
  CB70  B7            		OR	A
  CB71  20A0          		JR	NZ,ERRW
  CB73  C9            		RET
                      	
  CB74                	AT_CPUE:
                      	
                      	
                      	;	EMM DRIVER(CPU)
                      	
                      	
  CB74                	AT_EDWT:
  CB74  CD4DD3        		CALL	AT_EADR+AT_RE
  CB77                	AT_EDWT0:
  CB77  F5            		PUSH	AF
  CB78  AF            		XOR	A
  CB79                	AT_EDWT1:
  CB79  04            		INC	B
  CB7A  EDA3          		OUTI
  CB7C  04            		INC	B
  CB7D  EDA3          		OUTI
  CB7F  3D            		DEC	A
  CB80  20F7          		JR	NZ,AT_EDWT1
  CB82  13            		INC	DE
  CB83  F1            		POP	AF
  CB84  3D            		DEC	A
  CB85  20F0          		JR	NZ,AT_EDWT0
  CB87  C9            		RET
                      	
  CB88                	AT_EDRD:
  CB88  CD4DD3        		CALL	AT_EADR+AT_RE
  CB8B                	AT_EDRD0:
  CB8B  F5            		PUSH	AF
  CB8C  AF            		XOR	A
  CB8D                	AT_EDRD1:
  CB8D  EDA2          		INI
  CB8F  04            		INC	B
  CB90  EDA2          		INI
  CB92  04            		INC	B
  CB93  3D            		DEC	A
  CB94  20F7          		JR	NZ,AT_EDRD1
  CB96  13            		INC	DE
  CB97  F1            		POP	AF
  CB98  3D            		DEC	A
  CB99  20F0          		JR	NZ,AT_EDRD0
  CB9B  C9            		RET
                      	
  CB9C                	AT_EADR:
  CB9C  C5            		PUSH	BC
  CB9D  D5            		PUSH	DE
  CB9E  EB            		EX	DE,HL
  CB9F  29            		ADD	HL,HL
  CBA0  29            		ADD	HL,HL
  CBA1  0E00          		LD	C,0
  CBA3  3AA1EC        		LD	A,(_MAXCYL)
  CBA6  47            		LD	B,A
  CBA7  09            		ADD	HL,BC
  CBA8  3A84EC        		LD	A,(_DRIVE)
  CBAB  4F            		LD	C,A
  CBAC  060D          		LD	B,00DH
  CBAE  ED49          		OUT	(C),C
  CBB0  0C            		INC	C
  CBB1  ED69          		OUT	(C),L
  CBB3  0C            		INC	C
  CBB4  ED61          		OUT	(C),H
  CBB6  0C            		INC	C
  CBB7  EB            		EX	DE,HL
  CBB8  D1            		POP	DE
  CBB9  F1            		POP	AF
  CBBA  A7            		AND	A	;CF=0
  CBBB  C9            		RET
                      	
  CBBC                	AT_EMME:
                      	
  CBBC                	INITE:
  CBBC                		DS	0CC06H-INITE
                      	
  CC06                	BDOS:
  CC06  C371D3        		JP	BDOS0
  CC09                		DS	71	;Reserved
                      	
                      	;LDCCP.ASM
                      	
                      	;	LSX-Dodgers CCP
                      	
  CC50                	WBOOT1:
  CC50  F3            		DI
  CC51  ED7B0600      		LD	SP,(SYSTEM+1)
                      	
  CC55  3EEC          		LD	A,INTVEC/256
  CC57  ED47          		LD	I,A
                      	
  CC59  3EE4          		LD	A,0E4H
  CC5B  CD9EDA        		CALL	COMOUT
  CC5E  3EC8          		LD	A,INTVEC
  CC60  CD78DA        		CALL	OT49SB
                      	
  CC63  3ABCEC        		LD	A,(CRTCD+12)
  CC66  B7            		OR	A
  CC67  200C          		JR	NZ,SETCRT0
  CC69  2180F8        		LD	HL,0-80*LINE
  CC6C  22BAEC        		LD	(CRTCD+10),HL
  CC6F  21B0FF        		LD	HL,0-80
  CC72  22BCEC        		LD	(CRTCD+12),HL
  CC75                	SETCRT0:
  CC75  21B0EC        		LD	HL,CRTCD
  CC78  AF            		XOR	A
  CC79                	SETCRT2:
  CC79  010018        		LD	BC,01800H
  CC7C  ED79          		OUT	(C),A
  CC7E  0C            		INC	C
  CC7F  04            		INC	B
  CC80  EDA3          		OUTI
  CC82  3C            		INC	A
  CC83  FE0C          		CP	12
  CC85  20F2          		JR	NZ,SETCRT2
  CC87  0D            		DEC	C
  CC88  ED79          		OUT	(C),A
  CC8A  0C            		INC	C
  CC8B  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
                      	
  CC8D  0D            		DEC	C
  CC8E  3C            		INC	A
  CC8F  ED79          		OUT	(C),A
  CC91  0C            		INC	C
  CC92  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  CC94  23            		INC	HL
  CC95  23            		INC	HL
  CC96  01031B        		LD	BC,01A03H+00100H
  CC99  EDA3          		OUTI
  CC9B  01D020        		LD	BC,01FD0H+00100H
  CC9E  EDA3          		OUTI
  CCA0  2192EC        		LD	HL,_KEYD
  CCA3  3E03          		LD	A,3
  CCA5  BE            		CP	(HL)
  CCA6  CC45D7        		CALL	Z,KEYBC
  CCA9  3600          		LD	(HL),0
  CCAB  3E04          		LD	A,4
  CCAD  CD7CD7        		CALL	MSG_A
  CCB0                	COMMAND:
  CCB0  CD63CD        		CALL	SETDTA1
  CCB3  3A87EC        		LD	A,(_DVSW)
  CCB6  C641          		ADD	A,'A'
  CCB8  CD7CD7        		CALL	MSG_A
  CCBB  3E3E          		LD	A,'>'
  CCBD  CD7CD7        		CALL	MSG_A
  CCC0  3E50          		LD	A,80
  CCC2  12            		LD	(DE),A
  CCC3  CDCBD7        		CALL	_SYS0A		;(BDOS)文字列入力
  CCC6  CD1FCF        		CALL	LTNL
                      	
  CCC9  118200        		LD	DE,DTA1+2
  CCCC  CDFDEC        		CALL	_COMANL
  CCCF  30DF          		JR	NC,COMMAND
  CCD1  1179EB        		LD	DE,COMERM
  CCD4  CDA4D3        		CALL	_SYS09		;(BDOS)文字列出力
  CCD7  C7            		RST	0
                      	
  CCD8                	COMANL:
  CCD8  CD59DC        		CALL	FILE
  CCDB  3A19EB        		LD	A,(FNAME+4)
  CCDE  FE20          		CP	020H
  CCE0  201C          		JR	NZ,COMB2
  CCE2  D5            		PUSH	DE
  CCE3  1115EB        		LD	DE,FNAME
  CCE6  1A            		LD	A,(DE)
  CCE7  FE20          		CP	020H
  CCE9  2844          		JR	Z,SDVSW
  CCEB  1B            		DEC	DE
  CCEC  1A            		LD	A,(DE)
  CCED  C6FF          		ADD	A,0FFH
  CCEF  3809          		JR	C,COMB
  CCF1  13            		INC	DE
                      	
  CCF2  212AD2        		LD	HL,COMTB
  CCF5  0609          		LD	B,COMS
  CCF7  CDF1DE        		CALL	CPNAME
  CCFA                	COMB:
  CCFA  D1            		POP	DE
  CCFB  D20F00        		JP	NC,JP_HL
  CCFE                	COMB2:
  CCFE  EB            		EX	DE,HL
  CCFF  22DECD        		LD	(COMPAT+1),HL
  CD02  F5            		PUSH	AF
  CD03  CD8ACD        		CALL	CEXE4
  CD06  F1            		POP	AF
  CD07  2115EB        		LD	HL,FNAME
  CD0A  116D00        		LD	DE,FCB2+1	;COMMAND NAME
  CD0D  010B00        		LD	BC,11
  CD10  EDB0          		LDIR
  CD12  11E9D1        		LD	DE,PATHD
  CD15                	CEX1:
  CD15  1A            		LD	A,(DE)
  CD16  FE20          		CP	020H
  CD18  D8            		RET	C
  CD19  CD4EDC        		CALL	FILEC
  CD1C  D5            		PUSH	DE
  CD1D  216D00        		LD	HL,FCB2+1	;COMMAND NAME
  CD20  1115EB        		LD	DE,FNAME
  CD23  010B00        		LD	BC,11
  CD26  EDB0          		LDIR
  CD28  CD8ACD        		CALL	CEXE4
  CD2B  D1            		POP	DE
  CD2C  13            		INC	DE
  CD2D  18E6          		JR	CEX1
                      	
  CD2F                	SDVSW:
  CD2F  F1            		POP	AF
  CD30  3A14EB        		LD	A,(FDRV)
  CD33  3D            		DEC	A
  CD34  5F            		LD	E,A
  CD35  0E0E          		LD	C,00EH		;(BDOS)カレントドライブの設定
  CD37  1831          		JR	SYSTEM0
                      	
  CD39                	OPEN1:
  CD39  2114EB        		LD	HL,FDRV
  CD3C                	OPEN:
  CD3C  0E11          		LD	C,011H		;(BDOS)ファイルの検索
  CD3E                	OPEN3:
  CD3E  D5            		PUSH	DE
  CD3F  11C4D1        		LD	DE,DTA_CCP
  CD42  CD60CD        		CALL	SETDTA
  CD45  EB            		EX	DE,HL
  CD46  CD6ACD        		CALL	SYSTEM0
  CD49  D1            		POP	DE
  CD4A  C9            		RET
                      	
  CD4B                	OPEN2:
  CD4B  0E12          		LD	C,012H
  CD4D  18EF          		JR	OPEN3
                      	
  CD4F                	DEFCB:				;Z=Ok NZ=Error
  CD4F  11C4D1        		LD	DE,DTA_CCP
  CD52  CD68CD        		CALL	SYSC0F
                      	
  CD55  11E5D1        		LD	DE,DTA_CCP+33	;(FCB)ランダムレコード
  CD58  0604          		LD	B,4
  CD5A  CD5DD0        		CALL	ZERO_MEMORY_DE
  CD5D  110001        		LD	DE,00100H
  CD60                	SETDTA:
  CD60  C3D1D5        		JP	_SYS1A		;(BDOS)DTAの設定
                      	
  CD63                	SETDTA1:
  CD63  118000        		LD	DE,DTA1
  CD66  18F8          		JR	SETDTA
                      	
  CD68                	SYSC0F:
  CD68  0E0F          		LD	C,00FH		;(BDOS)ファイルのオープン
  CD6A                	SYSTEM0:
  CD6A  CD0500        		CALL	SYSTEM
  CD6D  B7            		OR	A
  CD6E  C9            		RET
                      	
  CD6F                	C_CD:
  CD6F  CD4EDC        		CALL	FILEC
  CD72  210000        		LD	HL,0
  CD75  1114EB        		LD	DE,FDRV
  CD78  180C          		JR	S27
                      	
  CD7A                	S27BUF:
  CD7A  3A0700        		LD	A,(SYSTEM+2)
  CD7D  3D            		DEC	A
  CD7E  E6F8          		AND	0F8H
  CD80  67            		LD	H,A
  CD81  2E00          		LD	L,0
  CD83                	S27DTA:
  CD83  11C4D1        		LD	DE,DTA_CCP
  CD86                	S27:
  CD86  0E27          		LD	C,027H		;(BDOS)ランダムブロック読み込み
  CD88  18E0          		JR	SYSTEM0
                      	
  CD8A                	CEXE4:
  CD8A  3A14EB        		LD	A,(FDRV)
  CD8D  325700        		LD	(00057H),A
  CD90  2A22EB        		LD	HL,(FDRV+14)
  CD93  225800        		LD	(00058H),HL
                      	
  CD96  211DEB        		LD	HL,FNAME+8
  CD99  7E            		LD	A,(HL)
  CD9A  FE20          		CP	020H
  CD9C  2007          		JR	NZ,CEXE7
  CD9E  3E3F          		LD	A,'?'
  CDA0  77            		LD	(HL),A
  CDA1  23            		INC	HL
  CDA2  77            		LD	(HL),A
  CDA3  23            		INC	HL
  CDA4  77            		LD	(HL),A
  CDA5                	CEXE7:
  CDA5  CD39CD        		CALL	OPEN1
  CDA8                	CEXE5:
  CDA8  C0            		RET	NZ
  CDA9  2ACED1        		LD	HL,(DTA_CCP+1+9)
  CDAC  7C            		LD	A,H
  CDAD  CD79DF        		CALL	CAP
  CDB0  67            		LD	H,A
  CDB1  7D            		LD	A,L
  CDB2  CD79DF        		CALL	CAP
  CDB5  6F            		LD	L,A
  CDB6  3ACDD1        		LD	A,(DTA_CCP+1+8)
  CDB9  CD79DF        		CALL	CAP
  CDBC  D642          		SUB	'B'
  CDBE  282C          		JR	Z,C_BAT
  CDC0  3D            		DEC	A		;'C'
  CDC1  2805          		JR	Z,C_EXE
  CDC3                	CEXE6:
  CDC3  CD4BCD        		CALL	OPEN2
  CDC6  18E0          		JR	CEXE5
                      	
  CDC8                	C_EXE:
  CDC8  7C            		LD	A,H
  CDC9  FE4D          		CP	'M'
  CDCB  20F6          		JR	NZ,CEXE6
                      	
  CDCD  CD4FCD        		CALL	DEFCB
  CDD0  CD7ACD        		CALL	S27BUF
  CDD3  3D            		DEC	A
  CDD4  37            		SCF
  CDD5  C0            		RET	NZ
  CDD6  7C            		LD	A,H
  CDD7  B5            		OR	L
  CDD8  37            		SCF
  CDD9  C8            		RET	Z
  CDDA  CD63CD        		CALL	SETDTA1
  CDDD  110000        	COMPAT:	LD	DE,0				; self-modifying code
  CDE0  ED7B0600      		LD	SP,(SYSTEM+1)
  CDE4  67            		LD	H,A				; A=0 in SETDTA1(_SYS1A)
  CDE5  6F            		LD	L,A
  CDE6  E5            		PUSH	HL				; push $0000 (reboot address)
  CDE7  24            		INC	H
  CDE8  E5            		PUSH	HL				; push $0100 (TPA address)
  CDE9  C328D0        		JP	SETFCB				; and JP $0100
                      	
  CDEC                	C_BAT:
  CDEC  114154        		LD	DE,'A'+'T'*256
  CDEF  ED52          		SBC	HL,DE
  CDF1  20D0          		JR	NZ,CEXE6
                      	
  CDF3  F1            		POP	AF
  CDF4  F1            		POP	AF
  CDF5  CD4FCD        		CALL	DEFCB
  CDF8  210002        		LD	HL,00200H
  CDFB  CD83CD        		CALL	S27DTA
  CDFE  C6FE          		ADD	A,0FEH
  CE00  D8            		RET	C
  CE01  7D            		LD	A,L
  CE02  B7            		OR	A
  CE03  37            		SCF
  CE04  C8            		RET	Z
  CE05  3C            		INC	A
  CE06  F5            		PUSH	AF
                      	
  CE07  CD45D7        		CALL	KEYBC
  CE0A  3E06          		LD	A,6
  CE0C  CD7CD7        		CALL	MSG_A
  CE0F  C1            		POP	BC
  CE10  210001        		LD	HL,00100H
  CE13                	BAT1:
  CE13  A7            		AND	A
  CE14  05            		DEC	B
  CE15  C8            		RET	Z
  CE16  7E            		LD	A,(HL)
  CE17  FE25          		CP	'%'
  CE19  280C          		JR	Z,BAT2
  CE1B                	BAT1X:
  CE1B  7E            		LD	A,(HL)
  CE1C  23            		INC	HL
  CE1D  FE1A          		CP	01AH
  CE1F  C8            		RET	Z
  CE20  FE0A          		CP	00AH
  CE22  C42BD7        		CALL	NZ,KEYBS
  CE25  18EC          		JR	BAT1
                      	
  CE27                	BAT2:
  CE27  23            		INC	HL
  CE28  7E            		LD	A,(HL)
  CE29  2B            		DEC	HL
  CE2A  D631          		SUB	'1'
  CE2C  38ED          		JR	C,BAT1X
  CE2E  FE09          		CP	9
  CE30  30E9          		JR	NC,BAT1X
  CE32  23            		INC	HL
  CE33  23            		INC	HL
  CE34  3C            		INC	A
  CE35  4F            		LD	C,A
  CE36  ED5BDECD      		LD	DE,(COMPAT+1)
  CE3A                	BAT3:
  CE3A  1A            		LD	A,(DE)
  CE3B  B7            		OR	A
  CE3C  28D5          		JR	Z,BAT1
  CE3E  CD30DD        		CALL	SPCUT
  CE41  0D            		DEC	C
  CE42  2808          		JR	Z,BAT5
  CE44                	BAT4:
  CE44  1A            		LD	A,(DE)
  CE45  FE21          		CP	021H
  CE47  38F1          		JR	C,BAT3
  CE49  13            		INC	DE
  CE4A  18F8          		JR	BAT4
  CE4C                	BAT5:
  CE4C  1A            		LD	A,(DE)
  CE4D  FE21          		CP	021H
  CE4F  38C2          		JR	C,BAT1
  CE51  13            		INC	DE
  CE52  CD2BD7        		CALL	KEYBS
  CE55  18F5          		JR	BAT5
                      	
  CE57                	SWITCH:
  CE57  1A            		LD	A,(DE)
  CE58                	SW1:
  CE58  13            		INC	DE
  CE59  B9            		CP	C
  CE5A  1A            		LD	A,(DE)
  CE5B  C8            		RET	Z
  CE5C  FE20          		CP	020H
  CE5E  30F8          		JR	NC,SW1
  CE60                	C_REM:
  CE60  AF            		XOR	A
  CE61  C9            		RET
                      	
  CE62                	C_DEL:
  CE62  CD28D0        		CALL	SETFCB
  CE65  CD92D7        		CALL	_SYS08		;(BDOS)エコーなしコンソール入力
                      	
  CE68  0E13          		LD	C,013H
  CE6A  180A          		JR	CDEL1		;(BDOS)ファイルの削除
                      	
  CE6C                	C_REN:
  CE6C  CD28D0        		CALL	SETFCB
  CE6F  3E10          		LD	A,010H		;ディレクトリも対象にする
  CE71  326900        		LD	(FCB1+13),A	;属性
  CE74  0E17          		LD	C,017H		;(BDOS)ファイル名の変更
  CE76                	CDEL1:
  CE76  115C00        		LD	DE,FCB1
  CE79  CD0500        		CALL	SYSTEM
  CE7C  C6FF          		ADD	A,0FFH
  CE7E  C9            		RET
                      	
  CE7F                	C_DIR:
  CE7F  CD4EDC        		CALL	FILEC
  CE82  2115EB        		LD	HL,FDRV+1
  CE85  CDB9D1        		CALL	CWILD1
  CE88  3EF1          		LD	A,0F1H
  CE8A  3221EB        		LD	(FDRV+13),A
  CE8D  CD39CD        		CALL	OPEN1
  CE90                	CDIR1:
  CE90  B7            		OR	A
  CE91  2008          		JR	NZ,PDSKF
  CE93  CDDECE        		CALL	P_NAME
  CE96  CD4BCD        		CALL	OPEN2
  CE99  18F5          		JR	CDIR1
                      	
  CE9B                	PDSKF:
  CE9B  3A14EB        		LD	A,(FDRV)
  CE9E  5F            		LD	E,A
  CE9F  0E1B          		LD	C,01BH		;(BDOS)ディスク情報の獲得
  CEA1  CD0500        		CALL	SYSTEM
  CEA4  4F            		LD	C,A		;C←1クラスタ辺りの論理セクタ数
  CEA5  C601          		ADD	A,001H
  CEA7  D8            		RET	C		;Aが0FFHだった場合
  CEA8  AF            		XOR	A
  CEA9                	PDS1:				;HL=未使用クラスタの総数
  CEA9  CB19          		RR	C
  CEAB  3804          		JR	C,PDS2
  CEAD  29            		ADD	HL,HL
  CEAE  8F            		ADC	A,A
  CEAF  18F8          		JR	PDS1
  CEB1                	PDS2:
  CEB1  CB50          		BIT	2,B		;B←論理セクタのサイズの上位8ビット
  CEB3  200A          		JR	NZ,PDSKF1	;K単位(4)になるまで未使用を2で割る
  CEB5  CB3F          		SRL	A
  CEB7  CB1C          		RR	H
  CEB9  CB1D          		RR	L
  CEBB  CB10          		RL	B
  CEBD  18F2          		JR	PDS2
  CEBF                	PDSKF1:
  CEBF  CD54CF        		CALL	PRDEC_AHL
  CEC2  1160D2        		LD	DE,KBFREE
  CEC5  CDA4D3        		CALL	_SYS09		;(BDOS)文字列出力
  CEC8  CD46CF        		CALL	PUTDRV
  CECB  3E5C          		LD	A,05CH
  CECD  CD7CD7        		CALL	MSG_A
  CED0  2A22EB        		LD	HL,(FDRV+14)	;ディレクトリのクラスタ番号
  CED3  AF            		XOR	A
  CED4  11FEFF        		LD	DE,0-2
  CED7  19            		ADD	HL,DE
  CED8  23            		INC	HL
  CED9  DC53CF        		CALL	C,PRDEC_HL
  CEDC  1841          		JR	LTNL
                      	
  CEDE                	P_NAME:
  CEDE  3AC5D1        		LD	A,(DTA_CCP+1)
  CEE1  FE2E          		CP	'.'
  CEE3  C8            		RET	Z
  CEE4  1179D2        		LD	DE,DIRHD
  CEE7  CDA4D3        		CALL	_SYS09		;(BDOS)文字列出力
  CEEA  3AD0D1        		LD	A,(DTA_CCP+1+00BH)
  CEED  F5            		PUSH	AF
  CEEE  0F            		RRCA
  CEEF  9F            		SBC	A,A
  CEF0  E60A          		AND	'*'-020H
  CEF2  C620          		ADD	A,020H
  CEF4  CD7CD7        		CALL	MSG_A
  CEF7  CD46CF        		CALL	PUTDRV
  CEFA  21C5D1        		LD	HL,DTA_CCP+1
  CEFD  CD97CF        		CALL	FPRNT
                      	
  CF00  F1            		POP	AF
  CF01  CB67          		BIT	4,A
  CF03  2808          		JR	Z,DIR3
  CF05  116ED2        		LD	DE,DIRMES
  CF08  CDA4D3        		CALL	_SYS09		;(BDOS)文字列出力
  CF0B  180A          		JR	DIR6
  CF0D                	DIR3:
  CF0D  ED5BE3D1      		LD	DE,(DTA_CCP+1+01EH)
  CF11  2AE1D1        		LD	HL,(DTA_CCP+1+01CH)
  CF14  CD57CF        		CALL	PRDEC_DEHL
  CF17                	DIR6:
  CF17  3AB1EC        		LD	A,(CRTCD+1)
  CF1A  FE29          		CP	40+1
  CF1C  D4B9CF        		CALL	NC,PRTTMS
                      	
  CF1F                	LTNL:
  CF1F  1E03          		LD	E,3
  CF21  C3CDEC        		JP	_PRINT
                      	
  CF24                	C_PATH:
  CF24  CD30DD        		CALL	SPCUT
  CF27  21E9D1        		LD	HL,PATHD
  CF2A  FE21          		CP	021H
  CF2C  300C          		JR	NC,CPATH0
  CF2E                	CPATHP:
  CF2E  7E            		LD	A,(HL)
  CF2F  23            		INC	HL
  CF30  FE20          		CP	020H
  CF32  3F            		CCF
  CF33  30EA          		JR	NC,LTNL
  CF35  CD7CD7        		CALL	MSG_A
  CF38  18F4          		JR	CPATHP
  CF3A                	CPATH0:
  CF3A  FE3B          		CP	';'
  CF3C  2001          		JR	NZ,CPATH1
  CF3E  13            		INC	DE
  CF3F                	CPATH1:
  CF3F  EB            		EX	DE,HL
  CF40  014000        		LD	BC,PATHX
  CF43  EDB0          		LDIR
  CF45  C9            		RET
                      	
  CF46                	PUTDRV:
  CF46  3A14EB        		LD	A,(FDRV)
  CF49  C640          		ADD	A,'A'-1
  CF4B  CD7CD7        		CALL	MSG_A
  CF4E  3E3A          		LD	A,':'
  CF50                	MSG_AR:
  CF50  C37CD7        		JP	MSG_A
                      	
  CF53                	PRDEC_HL:
  CF53  AF            		XOR	A
  CF54                	PRDEC_AHL:
  CF54  5F            		LD	E,A
  CF55  1600          		LD	D,0
  CF57                	PRDEC_DEHL:
  CF57  D5            		PUSH	DE
  CF58  110FEB        		LD	DE,DECBF
  CF5B  0605          		LD	B,5
  CF5D  CD5DD0        		CALL	ZERO_MEMORY_DE	;A=0
  CF60  D1            		POP	DE
                      	
  CF61  0E20          		LD	C,32
  CF63                	DEC1:
  CF63  29            		ADD	HL,HL
  CF64  EB            		EX	DE,HL
  CF65  ED6A          		ADC	HL,HL
  CF67  EB            		EX	DE,HL
  CF68  E5            		PUSH	HL
  CF69  2113EB        		LD	HL,DECBF+4
  CF6C  0605          		LD	B,5
  CF6E                	DEC2:
  CF6E  7E            		LD	A,(HL)
  CF6F  8F            		ADC	A,A
  CF70  27            		DAA
  CF71  77            		LD	(HL),A
  CF72  2B            		DEC	HL
  CF73  10F9          		DJNZ	DEC2
  CF75  E1            		POP	HL
  CF76  0D            		DEC	C
  CF77  20EA          		JR	NZ,DEC1
                      	
  CF79  210FEB        		LD	HL,DECBF
  CF7C  3E20          		LD	A,020H
  CF7E  0604          		LD	B,4
  CF80                	DEC3:
  CF80  CD8DCF        		CALL	DEC4
  CF83  CD8DCF        		CALL	DEC4
  CF86  23            		INC	HL
  CF87  10F7          		DJNZ	DEC3
  CF89                	DECX:
  CF89  CD8DCF        		CALL	DEC4
  CF8C  AF            		XOR	A
  CF8D                	DEC4:
  CF8D  ED6F          		RLD
  CF8F  FE20          		CP	020H
  CF91  2802          		JR	Z,DEC5
  CF93  F630          		OR	030H
  CF95                	DEC5:
  CF95  18B9          		JR	MSG_AR
                      	
  CF97                	FPRNT:
  CF97  0608          		LD	B,8
  CF99  CDAACF        		CALL	P_N1
  CF9C  7E            		LD	A,(HL)
  CF9D  C680          		ADD	A,0A0H-020H
  CF9F  FEA0          		CP	0A0H
  CFA1  2802          		JR	Z,FPR1
  CFA3  3E2E          		LD	A,'.'
  CFA5                	FPR1:
  CFA5  CD7CD7        		CALL	MSG_A
  CFA8  0603          		LD	B,3
                      	
  CFAA                	P_N1:
  CFAA  C5            		PUSH	BC
  CFAB  E5            		PUSH	HL
  CFAC  7E            		LD	A,(HL)
  CFAD  CD85DF        		CALL	CAP3
  CFB0  CD7CD7        		CALL	MSG_A
  CFB3  E1            		POP	HL
  CFB4  C1            		POP	BC
  CFB5  23            		INC	HL
  CFB6  10F2          		DJNZ	P_N1
  CFB8  C9            		RET
                      	
  CFB9                	PRTTMS:
  CFB9  3E20          		LD	A,020H
  CFBB  CD7CD7        		CALL	MSG_A
                      	
  CFBE  2ADDD1        		LD	HL,(DTA_CCP+1+24)
  CFC1  7D            		LD	A,L
  CFC2  B7            		OR	A
  CFC3  C8            		RET	Z
  CFC4  CB3C          		SRL	H
  CFC6  17            		RLA
  CFC7  17            		RLA
  CFC8  17            		RLA
  CFC9  17            		RLA
  CFCA  E60F          		AND	00FH
  CFCC  57            		LD	D,A
  CFCD  7C            		LD	A,H
  CFCE  C650          		ADD	A,80
  CFD0  CD13D0        		CALL	PRDEC_A
  CFD3  3E2D          		LD	A,'-'
  CFD5  CD7CD7        		CALL	MSG_A
  CFD8  7A            		LD	A,D
  CFD9  CD13D0        		CALL	PRDEC_A
  CFDC  3E2D          		LD	A,'-'
  CFDE  CD7CD7        		CALL	MSG_A
  CFE1  7D            		LD	A,L
  CFE2  E61F          		AND	01FH
  CFE4  CD13D0        		CALL	PRDEC_A
                      	
  CFE7  2ADBD1        		LD	HL,(DTA_CCP+1+22)
                      	
  CFEA  3E20          		LD	A,020H
  CFEC  CD7CD7        		CALL	MSG_A
  CFEF  7C            		LD	A,H
  CFF0  65            		LD	H,L
  CFF1  0603          		LD	B,3
  CFF3                	PRTTMS1:
  CFF3  1F            		RRA
  CFF4  CB1D          		RR	L
  CFF6  10FB          		DJNZ	PRTTMS1
  CFF8  E61F          		AND	01FH
  CFFA  CD13D0        		CALL	PRDEC_A
  CFFD  3E3A          		LD	A,':'
  CFFF  CD7CD7        		CALL	MSG_A
  D002  7D            		LD	A,L
  D003  0F            		RRCA
  D004  0F            		RRCA
  D005  E63F          		AND	03FH
  D007  CD13D0        		CALL	PRDEC_A
  D00A  3E3A          		LD	A,':'
  D00C  CD7CD7        		CALL	MSG_A
  D00F  7C            		LD	A,H
  D010  E61F          		AND	01FH
  D012  87            		ADD	A,A
                      	
                      	;	PRINT10
                      	
  D013                	PRDEC_A:
  D013  E5            		PUSH	HL
  D014  0608          		LD	B,8
  D016  4F            		LD	C,A
  D017  AF            		XOR	A
  D018                	PRTA1:
  D018  CB01          		RLC	C
  D01A  8F            		ADC	A,A
  D01B  27            		DAA
  D01C  10FA          		DJNZ	PRTA1
  D01E  210FEB        		LD	HL,DECBF
  D021  77            		LD	(HL),A
  D022  AF            		XOR	A
  D023  CD89CF        		CALL	DECX
  D026  E1            		POP	HL
  D027  C9            		RET
                      	
  D028                	SETFCB:
  D028  CD30DD        		CALL	SPCUT
  D02B  1A            		LD	A,(DE)
  D02C  FE20          		CP	020H
  D02E  3801          		JR	C,SETFCBA
  D030  1B            		DEC	DE
  D031                	SETFCBA:
  D031  0624          		LD	B,36
  D033  215C00        		LD	HL,FCB1
  D036  E5            		PUSH	HL
  D037  AF            		XOR	A
  D038  CD05DD        		CALL	FILL_MEMORY
  D03B  E1            		POP	HL
  D03C  D5            		PUSH	DE
  D03D  CD30D6        		CALL	_SYS29		;(BDOS)ファイル名の解析
  D040  216C00        		LD	HL,FCB2
  D043  CD30D6        		CALL	_SYS29		;(BDOS)ファイル名の解析
  D046  E1            		POP	HL
  D047  010050        		LD	BC,05000H
  D04A  118100        		LD	DE,00081H
  D04D                	SETFCB1:
  D04D  7E            		LD	A,(HL)
  D04E  23            		INC	HL
  D04F  FE20          		CP	020H
  D051  3805          		JR	C,SETFCB2
  D053  12            		LD	(DE),A
  D054  13            		INC	DE
  D055  0C            		INC	C
  D056  10F5          		DJNZ	SETFCB1
  D058                	SETFCB2:
  D058  79            		LD	A,C
  D059  328000        		LD	(DTA1),A
  D05C  04            		INC	B
  D05D                	ZERO_MEMORY_DE:
  D05D  AF            		XOR	A
  D05E                	FILL_MEMORY_DE:
  D05E  12            		LD	(DE),A
  D05F  13            		INC	DE
  D060  10FC          		DJNZ	FILL_MEMORY_DE
  D062  C9            		RET
                      	
  D063                	C_COPY:
  D063  CD28D0        		CALL	SETFCB
  D066  118100        		LD	DE,DTA1+1
  D069  0E2F          		LD	C,'/'
  D06B  CD57CE        		CALL	SWITCH
  D06E  CD79DF        		CALL	CAP
  D071  32F9D0        		LD	(SW+1),A
                      	
  D074  1161EB        		LD	DE,BEEPD
  D077  CD51DC        		CALL	FILEC2
  D07A  216C00        		LD	HL,FCB2
  D07D  CD37D6        		CALL	S29X1
                      	
  D080  3E10          		LD	A,010H
  D082  326900        		LD	(FCB1+13),A
  D085  216D00        		LD	HL,FCB2+1
  D088  CDB9D1        		CALL	CWILD1
  D08B                	COPY0:
  D08B  CDB6D1        		CALL	CWILD
  D08E  215C00        		LD	HL,FCB1
  D091  CD3CCD        		CALL	OPEN
  D094  37            		SCF
  D095                	COPY1:
  D095  C0            		RET	NZ
  D096  CD4FCD        		CALL	DEFCB
                      	
  D099  3AD1D1        		LD	A,(DTA_CCP+13)
  D09C  CB67          		BIT	4,A
  D09E  2824          		JR	Z,COPY1A
                      	
  D0A0  215D00        		LD	HL,FCB1+1
  D0A3  CDAEE0        		CALL	CHKWILD
  D0A6  3817          		JR	C,COPY9
                      	
  D0A8  3E20          		LD	A,020H
  D0AA  325D00        		LD	(FCB1+1),A
  D0AD  2ADED1        		LD	HL,(DTA_CCP+26)
  D0B0  23            		INC	HL
  D0B1  226A00        		LD	(FCB1+14),HL
  D0B4  18D5          		JR	COPY0
                      	
  D0B6                	COPYS:
  D0B6  1174EB        		LD	DE,SKIP
  D0B9                	COPY8:
  D0B9  CDA4D3        		CALL	_SYS09		;(BDOS)文字列出力
  D0BC  CD1FCF        		CALL	LTNL
  D0BF                	COPY9:
  D0BF  CD4BCD        		CALL	OPEN2
  D0C2  18D1          		JR	COPY1
                      	
  D0C4                	COPY1A:
  D0C4  216C00        		LD	HL,FCB2
  D0C7  1114EB        		LD	DE,FDRV
  D0CA  01C6D1        		LD	BC,DTA_CCP+2
  D0CD  EDA0          		LDI
  D0CF  3E0B          		LD	A,11
  D0D1                	COPY2:
  D0D1  F5            		PUSH	AF
  D0D2  7E            		LD	A,(HL)
  D0D3  FE3F          		CP	'?'
  D0D5  2001          		JR	NZ,COPY3
  D0D7  0A            		LD	A,(BC)
  D0D8                	COPY3:
  D0D8  12            		LD	(DE),A
  D0D9  03            		INC	BC
  D0DA  13            		INC	DE
  D0DB  23            		INC	HL
  D0DC  F1            		POP	AF
  D0DD  3D            		DEC	A
  D0DE  20F1          		JR	NZ,COPY2
  D0E0  010500        		LD	BC,16-11
  D0E3  EDB0          		LDIR
  D0E5                	PUTNAME:
  D0E5  215D00        		LD	HL,FCB1+1
  D0E8  CDAEE0        		CALL	CHKWILD
  D0EB  300B          		JR	NC,PUTN1
  D0ED  2115EB        		LD	HL,FDRV+1
  D0F0  CD97CF        		CALL	FPRNT
  D0F3  3E20          		LD	A,020H
  D0F5  CD7CD7        		CALL	MSG_A
  D0F8                	PUTN1:
  D0F8  3E00          	SW:	LD	A,000H
  D0FA  FE54          		CP	'T'
  D0FC  2005          		JR	NZ,CSW1
  D0FE  2118D1        		LD	HL,SWNE
  D101  1807          		JR	SWT1
  D103                	CSW1:
  D103  FE4E          		CP	'N'
  D105  2011          		JR	NZ,SWNE
  D107  21B6D0        		LD	HL,COPYS
  D10A                	SWT1:
  D10A  1114EB        		LD	DE,FDRV
  D10D  CD68CD        		CALL	SYSC0F
  D110  2801          		JR	Z,SWN1
  D112  E9            		JP	(HL)
  D113                	SWN1:
  D113  CD6CD1        		CALL	CTIME
  D116  309E          		JR	NC,COPYS
  D118                	SWNE:
  D118  1114EB        		LD	DE,FDRV
  D11B  0E16          		LD	C,016H		;(BDOS)ファイルの作成
  D11D  CD6ACD        		CALL	SYSTEM0
  D120  2048          		JR	NZ,COPYE2
  D122  67            		LD	H,A		;A=0
  D123  6F            		LD	L,A
  D124  2235EB        		LD	(FDRV+33),HL	;(FCB)ランダムレコード
  D127  2237EB        		LD	(FDRV+35),HL
  D12A                	COPY6:
  D12A  CD7ACD        		CALL	S27BUF
  D12D  47            		LD	B,A
  D12E  3C            		INC	A
  D12F  2831          		JR	Z,COPYE
  D131  7C            		LD	A,H
  D132  B5            		OR	L
  D133  280C          		JR	Z,COPY7
  D135  1114EB        		LD	DE,FDRV
  D138  0E26          		LD	C,026H		;(BDOS)ランダムブロック書き込み
  D13A  CD6ACD        		CALL	SYSTEM0
  D13D  2023          		JR	NZ,COPYE
  D13F  10E9          		DJNZ	COPY6
  D141                	COPY7:
  D141  3AD1D1        		LD	A,(DTA_CCP+13)	;(FCB)属性
  D144  3221EB        		LD	(FDRV+13),A
  D147  21D8D1        		LD	HL,DTA_CCP+20	;(FCB)タイムスタンプ
  D14A  1128EB        		LD	DE,FDRV+20
  D14D  010400        		LD	BC,4
  D150  EDB0          		LDIR
                      	
  D152  1114EB        		LD	DE,FDRV
  D155  0E10          		LD	C,010H		;(BDOS)ファイルのクローズ
  D157  CD6ACD        		CALL	SYSTEM0
  D15A  2006          		JR	NZ,COPYE
                      	
  D15C  1171EB        		LD	DE,OK
  D15F  C3B9D0        		JP	COPY8
                      	
  D162                	COPYE:
  D162  1114EB        		LD	DE,FDRV
  D165  0E13          		LD	C,013H		;(BDOS)ファイルの削除
  D167  CD0500        		CALL	SYSTEM
  D16A                	COPYE2:
  D16A  37            		SCF
  D16B  C9            		RET
                      	
  D16C                	CTIME:
  D16C  ED5BD8D1      		LD	DE,(DTA_CCP+20)
  D170  2A28EB        		LD	HL,(FDRV+20)
  D173  A7            		AND	A
  D174  ED52          		SBC	HL,DE
  D176  C0            		RET	NZ
  D177  ED5BDAD1      		LD	DE,(DTA_CCP+22)
  D17B  2A2AEB        		LD	HL,(FDRV+22)
  D17E  ED52          		SBC	HL,DE
  D180  C9            		RET
                      	
  D181                	C_TYPE:
  D181  CD28D0        		CALL	SETFCB
  D184  215C00        		LD	HL,FCB1
  D187  CD3CCD        		CALL	OPEN
  D18A  37            		SCF
  D18B                	TYPE1:
  D18B  C0            		RET	NZ
  D18C  CD4FCD        		CALL	DEFCB
  D18F  3E06          		LD	A,6
  D191  CD7CD7        		CALL	MSG_A
  D194                	TYPE2:
  D194  CD7ACD        		CALL	S27BUF
  D197  C6FE          		ADD	A,0FEH
  D199  D8            		RET	C
  D19A  7C            		LD	A,H
  D19B  B5            		OR	L
  D19C  2813          		JR	Z,TYPEE
  D19E  010001        		LD	BC,00100H
  D1A1                	TYPE3:
  D1A1  0A            		LD	A,(BC)
  D1A2  03            		INC	BC
  D1A3  FE1A          		CP	01AH
  D1A5  280A          		JR	Z,TYPEE
  D1A7  CD7CD7        		CALL	MSG_A
  D1AA  2B            		DEC	HL
  D1AB  7C            		LD	A,H
  D1AC  B5            		OR	L
  D1AD  20F2          		JR	NZ,TYPE3
  D1AF  18E3          		JR	TYPE2
  D1B1                	TYPEE:
  D1B1  CD4BCD        		CALL	OPEN2
  D1B4  18D5          		JR	TYPE1
                      	
  D1B6                	CWILD:
  D1B6  215D00        		LD	HL,FCB1+1
  D1B9                	CWILD1:
  D1B9  7E            		LD	A,(HL)
  D1BA  FE20          		CP	020H
  D1BC  C0            		RET	NZ
  D1BD                	CWILD2:
  D1BD  3E3F          		LD	A,'?'
  D1BF  060B          		LD	B,11
  D1C1  C305DD        		JP	FILL_MEMORY
                      	
  D1C4                	DTA_CCP:
  D1C4                		DS	37
                      	
  0040                	PATHX	EQU	64
  D1E9                	PATHD:	DS	PATHX
  D229  00            	PATHE:	DB	0
                      	
  0009                	COMS	EQU	9
  D22A                	COMTB:
  D22A  44202020      		DB	"D   "	;1
  D22E  7FCE          		DW	C_DIR
  D230  44495220      		DB	"DIR "	;2
  D234  7FCE          		DW	C_DIR
  D236  434F5059      		DB	"COPY"	;3
  D23A  63D0          		DW	C_COPY
  D23C  43442020      		DB	"CD  "	;4
  D240  6FCD          		DW	C_CD
  D242  44454C20      		DB	"DEL "	;5
  D246  62CE          		DW	C_DEL
  D248  50415448      		DB	"PATH"	;6
  D24C  24CF          		DW	C_PATH
  D24E  52454E20      		DB	"REN "	;7
  D252  6CCE          		DW	C_REN
  D254  54595045      		DB	"TYPE"	;8
  D258  81D1          		DW	C_TYPE
  D25A  52454D20      		DB	"REM "	;9
  D25E  60CE          		DW	C_REM
                      	
  D260  6B206279746573	KBFREE:	DB	"k bytes free",9,'$'
  D26E  20202020203C44	DIRMES:	DB	"     <DIR>$"
  D279  20203A24      	DIRHD:	DB	"  :$"
                      	
                      	;LDDISK2.ASM
                      	
                      	;	LSX-Dodgers DISK2
                      	
                      	
                      	;	GRAPHIC RAM DISK DRIVER
                      	
                      	
  D27D                	GDRD:
  D27D  C5            		PUSH	BC
  D27E  CDA6D2        		CALL	GADR
  D281  F1            		POP	AF
  D282                	GDRD1:
  D282  EDA2          		INI
  D284  04            		INC	B
  D285  0C            		INC	C
  D286  20FA          		JR	NZ,GDRD1
  D288  04            		INC	B
  D289  13            		INC	DE
  D28A  3D            		DEC	A
  D28B  20F5          		JR	NZ,GDRD1
  D28D                	GBANK0:
  D28D  3ABFEC        		LD	A,(WK1FD0)
  D290  E6EF          		AND	0EFH		;BANK0
  D292  181D          		JR	S1FD0
                      	
  D294                	GDWT:
  D294  C5            		PUSH	BC
  D295  CDA6D2        		CALL	GADR
  D298  F1            		POP	AF
  D299                	GDWT1:
  D299  04            		INC	B
  D29A  EDA3          		OUTI
  D29C  0C            		INC	C
  D29D  20FA          		JR	NZ,GDWT1
  D29F  04            		INC	B
  D2A0  13            		INC	DE
  D2A1  3D            		DEC	A
  D2A2  20F5          		JR	NZ,GDWT1
  D2A4  18E7          		JR	GBANK0
                      	
  D2A6                	GADR:
  D2A6  0E00          		LD	C,0
  D2A8  7B            		LD	A,E
  D2A9  C640          		ADD	A,040H
  D2AB  47            		LD	B,A
  D2AC  3ABFEC        		LD	A,(WK1FD0)
  D2AF  F610          		OR	010H		;BANK1
  D2B1                	S1FD0:
  D2B1  C5            		PUSH	BC
  D2B2  32BFEC        		LD	(WK1FD0),A
  D2B5  01D01F        		LD	BC,01FD0H
  D2B8  ED79          		OUT	(C),A
  D2BA  C1            		POP	BC
  D2BB  C9            		RET
                      	
                      	
                      	;	BANK RAM DISK DRIVER
                      	
  D2BC                	BDWT:
  D2BC  3E            		DB	03EH	;LD A,??
  D2BD  37            		SCF
  D2BE  1802          		JR	BRW
                      	
  D2C0                	BDRD:
  D2C0  3E            		DB	03EH	;LD A,??
  D2C1  A7            		AND	A
  D2C2                	BRW:
  D2C2  F3            		DI
  D2C3  32EBD2        		LD	(BRWPAT),A
  D2C6  ED730BD3      		LD	(BANKSP+1),SP
  D2CA  3A0CD3        		LD	A,(BANKSP+2)
  D2CD  87            		ADD	A,A
  D2CE  3803          		JR	C,BRW0
  D2D0  310000        		LD	SP,EXTSP
  D2D3                	BRW0:
  D2D3  D9            		EXX		;裏レジスタ
  D2D4  C5            		 PUSH	 BC
  D2D5  D5            		 PUSH	 DE
  D2D6  01000B        		 LD	 BC,00B00H	 ;バンクメモリ
  D2D9  111010        		 LD	 DE,01010H
  D2DC  D9            		 EXX		;表レジスタ
  D2DD                	BRW1:
  D2DD  C5            		PUSH	BC
  D2DE  D5            		PUSH	DE
  D2DF  EB            		EX	DE,HL
  D2E0  29            		ADD	HL,HL
  D2E1  29            		ADD	HL,HL
  D2E2  7C            		LD	A,H
  D2E3  E60F          		AND	00FH	;バンク
  D2E5  65            		LD	H,L
  D2E6  CB3C          		SRL	H	;/2
  D2E8  2E00          		LD	L,0
  D2EA  D9            		EXX		;裏レジスタ
  D2EB  A7            	BRWPAT:	 AND	 A	;自己書き換え(AND A:読み出し/SCF:書き込み)
  D2EC  3808          		 JR	 C,BRWT
  D2EE  57            		 LD	 D,A	 ;D=バンク
  D2EF  D9            		 EXX		;表レジスタ
  D2F0  EB            		EX	DE,HL
  D2F1  CD0FD3        		CALL	BTFR
  D2F4  1806          		JR	BRW2
  D2F6                	BRWT:
  D2F6  5F            		 LD	E,A	 ;E=バンク
  D2F7  D9            		 EXX		;表レジスタ
  D2F8  CD0FD3        		CALL	BTFR
  D2FB  EB            		EX	DE,HL
  D2FC                	BRW2:
  D2FC  D1            		POP	DE
  D2FD  C1            		POP	BC
  D2FE  13            		INC	DE
  D2FF  10DC          		DJNZ	BRW1
                      	
  D301  D9            		EXX		;裏レジスタ
  D302  3E10          		 LD	 A,10H
  D304  ED79          		 OUT	 (C),A		;メインメモリに切り替える
  D306  D1            		 POP	 DE
  D307  C1            		 POP	 BC
  D308  D9            		 EXX		;表レジスタ
  D309  AF            		XOR	A
  D30A  310000        	BANKSP:	LD	SP,0
  D30D  FB            		EI
  D30E  C9            		RET
                      	
                      	;メインメモリ←→バンクメモリ 512バイトの転送を行う
                      	; DE:転送元アドレス
                      	; HL:転送先アドレス
                      	; 裏BC:バンク切り替えポート(0B00H)
                      	; 裏D:転送元バンク(0-0FH:10Hはメインメモリ)
                      	; 裏E:転送先バンク(0-0FH:10Hはメインメモリ)
                      	
  D30F                	BTFR:
  D30F  0600          		LD	B,0	;256回ループ(256*2)
  D311                	BTFR1:
  D311  D9            		EXX		;裏レジスタ
  D312  ED51          		 OUT	 (C),D	 ;BANK(MAIN)
  D314  D9            		 EXX		;表レジスタ
  D315  1A            		LD	A,(DE)
  D316  4F            		LD	C,A
  D317  13            		INC	DE
  D318  1A            		LD	A,(DE)
  D319  13            		INC	DE
  D31A  D9            		EXX		;裏レジスタ
  D31B  ED59          		 OUT	 (C),E	 ;MAIN(BANK)
  D31D  D9            		 EXX		;表レジスタ
  D31E  71            		LD	(HL),C
  D31F  23            		INC	HL
  D320  77            		LD	(HL),A
  D321  23            		INC	HL
  D322  10ED          		DJNZ	BTFR1
  D324  C9            		RET
                      	
                      	;	EMM DRIVER(DMA)
                      	
                      	
  D325                	EDWT:
  D325  0E0F          		LD	C,15
  D327  1802          		JR	EDWT1
  D329                	EDRD:
  D329  0E0E          		LD	C,14
  D32B                	EDWT1:
  D32B  C5            		PUSH	BC
  D32C  D5            		PUSH	DE
  D32D  226ED3        		LD	(DMAB),HL
  D330  78            		LD	A,B
  D331  87            		ADD	A,A
  D332  3D            		DEC	A
  D333  3267D3        		LD	(DMALEN+1),A
  D336  3C            		INC	A
  D337  84            		ADD	A,H	;HL(アドレス)を先に進めておく
  D338  67            		LD	H,A
  D339  EB            		EX	DE,HL
  D33A  29            		ADD	HL,HL
  D33B  3AA1EC        		LD	A,(_MAXCYL)
  D33E  47            		LD	B,A
  D33F  79            		LD	A,C
  D340  0E00          		LD	C,0
  D342  09            		ADD	HL,BC
  D343  ED4B84EC      		LD	BC,(_DRIVE)
  D347  060D          		LD	B,00DH
  D349  ED49          		OUT	(C),C
  D34B  0C            		INC	C
  D34C  ED69          		OUT	(C),L
  D34E  0C            		INC	C
  D34F  ED61          		OUT	(C),H
                      	
  D351  2162D3        		LD	HL,EDMAD
  D354  CD54DB        		CALL	SETDMA
  D357  CD7CDB        		CALL	GO_DMA
  D35A  EB            		EX	DE,HL
  D35B  D1            		POP	DE
  D35C  C1            		POP	BC
  D35D                	DMA_ADD_SEC:
  D35D  13            		INC	DE
  D35E  10FD          		DJNZ	DMA_ADD_SEC
  D360  AF            		XOR	A
  D361  C9            		RET
                      	
  D362                	EDMAD:
  D362  C3            		DB	0C3H	;WR6 リセット
  D363  7D            		DB	07DH	;WR0 ポートA→ポートB 転送
  D364  030D          		DW	00D03H	;ポートA開始アドレス EMMリード/ライト
  D366  FF01          	DMALEN:	DW	001FFH	;ブロック長(転送サイズ-1)
  D368  2C            		DB	02CH	;WR1 ポートAアドレス固定 I/O
  D369  50            		DB	050H	;WR2 ポートBアドレスインクリメント メモリ
  D36A  02            		DB	002H	;ポートBタイミング
  D36B  80            		DB	080H	;WR3
  D36C  9A            		DB	09AH	;WR5 WAIT RDY:HIGH
  D36D  AD            		DB	0ADH	;WR4 連続 ポートB開始アドレス
  D36E  0000          	DMAB:	DW	0
  D370  01            		DB	001H	;WR0 ポートA←ポートB 転送
  D371                	EMME:
                      	
  07B1                	AT_RE	EQU	EDWT-AT_EDWT
                      	
                      	
                      	;LDOS.ASM
                      	
                      	;	LSX-Dodgers OS
                      	
  D371                	BDOS0:
  D371  E5            		PUSH	HL
  D372  210001        		LD	HL,00100H
  D375  39            		ADD	HL,SP
  D376  3810          		JR	C,BDOS1X
  D378                	BDOS2:
  D378  E1            		POP	HL
  D379  ED7384D3      		LD	(BDSP+1),SP
  D37D  310000        		LD	SP,EXTSP
  D380  CD87D3        		CALL	BDOS1
  D383  310000        	BDSP:	LD	SP,0
  D386  C9            		RET
  D387                	BDOS1:
  D387  E5            		PUSH	HL
  D388                	BDOS1X:
  D388  79            		LD	A,C
  D389  FE31          		CP	031H
  D38B  300A          		JR	NC,OVERFN
  D38D  87            		ADD	A,A
  D38E  6F            		LD	L,A
  D38F  26EC          		LD	H,STABLE/256
  D391  7E            		LD	A,(HL)
  D392  2C            		INC	L
  D393  66            		LD	H,(HL)
  D394  6F            		LD	L,A
  D395  E3            		EX	(SP),HL
  D396  C9            		RET
  D397                	OVERFN
  D397  E1            		POP	HL
  D398  FE6F          		CP	06FH		;DOSVER MSX-DOS のバージョン番号の獲得
  D39A  2006          		JR	NZ,_ERROR
  D39C  011D01        		LD	BC,011DH
  D39F  114401        		LD	DE,VER
  D3A2                	_ERROR:
  D3A2  AF            		XOR	A
  D3A3  C9            		RET
                      	
  D3A4                	_SYS09:		;文字列出力
  D3A4  D5            		PUSH	DE
  D3A5                	_SX09:
  D3A5  1A            		LD	A,(DE)
  D3A6  13            		INC	DE
  D3A7  FE24          		CP	'$'
  D3A9  2832          		JR	Z,SX0E2
  D3AB  CD7CD7        		CALL	MSG_A
  D3AE  18F5          		JR	_SX09
                      	
  D3B0                	MSX1:
  D3B0  CD7CD7        		CALL	MSG_A
  D3B3                	MSX:
  D3B3  7E            		LD	A,(HL)
  D3B4  23            		INC	HL
  D3B5  B7            		OR	A
  D3B6  20F8          		JR	NZ,MSX1
  D3B8  C9            		RET
                      	
  D3B9                	_SYS0C:		;(BDOS)バージョン番号の獲得
  D3B9  212200        		LD	HL,00022H
  D3BC  AF            		XOR	A
  D3BD  7D            		LD	A,L
  D3BE  C9            		RET
                      	
  D3BF                	_SYS0D:		;(BDOS)ディスクリセット
  D3BF  CDDFEC        		CALL	_FFLUSH
  D3C2  E5            		PUSH	HL
  D3C3  218000        		LD	HL,00080H
  D3C6  228AEC        		LD	(_DTA),HL
  D3C9  E1            		POP	HL
  D3CA  D5            		PUSH	DE
  D3CB  1E00          		LD	E,0
  D3CD  3E            		DB	03EH
                      	
  D3CE                	_SYS0E:		;(BDOS)カレントドライブの設定
  D3CE  D5            		PUSH	DE
  D3CF  7B            		LD	A,E
  D3D0  DDE5          		PUSH	IX
  D3D2  CDDCEC        		CALL	_GETDPB
  D3D5  DDE1          		POP	IX
  D3D7  3804          		JR	C,SX0E2
  D3D9  7B            		LD	A,E
  D3DA  3287EC        		LD	(_DVSW),A
  D3DD                	SX0E2:
  D3DD  3E08          		LD	A,8
  D3DF  D1            		POP	DE
  D3E0  C9            		RET
                      	
  D3E1                	_SYS0F:		;(BDOS)ファイルのオープン
  D3E1  CD42DD        		CALL	SETDRV
  D3E4  FD7E1C        		LD	A,(IY+28)	;(FCB)オープンモード
  D3E7  C602          		ADD	A,002H		;Write
  D3E9  2848          		JR	Z,FEND0F
  D3EB  CDAAE0        		CALL	CHKWILDX
                      	
  D3EE  D462DD        		CALL	NC,SOPENX
  D3F1                	_S16XX:
  D3F1  3840          		JR	C,FEND0F
                      					;Directory location
  D3F3  3A9FEC        		LD	A,(_FILEN)
  D3F6  FD7719        		LD	(IY+25),A	;(FCB)ディレクトリロケーション
                      	;				_DIRF
  D3F9  3AA0EC        		LD	A,(_DIRF)
  D3FC  FD771D        		LD	(IY+29),A	;(FCB)ディレクトリモード
                      	;				_FBPS
  D3FF  FD731E        		LD	(IY+30),E	;(FCB)ディレクトリポジション
  D402  FD721F        		LD	(IY+31),D
                      	;				Open(Read)
  D405  FD361CFF      		LD	(IY+28),0FFH	;(FCB)オープンモード
                      	;				FILENAME
  D409  FDE5          		PUSH	IY
  D40B  D1            		POP	DE
  D40C  13            		INC	DE
  D40D  010B00        		LD	BC,11
  D410  EDB0          		LDIR
                      	;				Attribute
  D412  7E            		LD	A,(HL)
  D413  FD770D        		LD	(IY+13),A	;(FCB)属性(アトリビュート)
  D416  110B00        		LD	DE,11		;Reserved
  D419  19            		ADD	HL,DE
                      						;(FCB)ファイルを最後に変更した時刻
  D41A  11EAEB        		LD	DE,SDDATA		;(FCB)ファイルを最後に変更した日付
  D41D  060A          		LD	B,SDDATAE-SDDATA	;(FCB)ファイルの先頭クラスタ
  D41F                	S16LOOP:				;(FCB)ファイルのサイズ(バイト単位)
  D41F  1A            		LD	A,(DE)
  D420  13            		INC	DE
  D421  3228D4        		LD	(S16PAT+2),A
  D424  7E            		LD	A,(HL)
  D425  23            		INC	HL
  D426  FD7700        	S16PAT:	LD	(IY+0),A
  D429  10F4          		DJNZ	S16LOOP
                      	
  D42B  AF            		XOR	A
  D42C  FD770C        		LD	(IY+12),A	;(FCB)カレントブロック
  D42F  FD22FFD4      		LD	(OFCB+1),IY
  D433                	FEND0F:
  D433  1843          		JR	FEND10
                      	
  D435                	_SYS10:		;(BDOS)ファイルのクローズ
  D435  CD42DD        		CALL	SETDRV
  D438  FD7E1C        		LD	A,(IY+28)	;(FCB)オープンモード
  D43B  D6FE          		SUB	0FEH
  D43D  37            		SCF
  D43E  3F            		CCF
  D43F  2037          		JR	NZ,FEND10
  D441                	_S10A:				;Write
  D441  FD770E        		LD	(IY+14),A	;(FCB)レコードサイズ/アクセスするディレクトリのクラスタ番号+1
  D444  FD770F        		LD	(IY+15),A
                      	
  D447  FD341C        		INC	(IY+28)		;0FEH->0FFH ;オープンモード
  D44A  CD98E1        		CALL	SETTMS
                      	
  D44D  FD7E1D        		LD	A,(IY+29)	;(FCB)ディレクトリモード
  D450  32A0EC        		LD	(_DIRF),A
  D453  E67F          		AND	07FH
  D455  327AE6        		LD	(_SECPS+1),A
  D458  FD5E1E        		LD	E,(IY+30)	;(FCB)ディレクトリポジション
  D45B  FD561F        		LD	D,(IY+31)
  D45E  CD9DDE        		CALL	READ_DIR
  D461  3815          		JR	C,FEND10
                      	
  D463  FD7E19        		LD	A,(IY+25)	;(FCB)ディレクトリロケーション
  D466  E61F          	SDECM1:	AND	01FH		;自己書き換え(1セクタ辺りのディレクトリエントリ数-1) 1024=01FH / 512=00FH / 256=7
  D468  6F            		LD	L,A
  D469  2600          		LD	H,0
  D46B  29            		ADD	HL,HL		;*2
  D46C  29            		ADD	HL,HL		;*4
  D46D  29            		ADD	HL,HL		;*8
  D46E  29            		ADD	HL,HL		;*16
  D46F  29            		ADD	HL,HL		;*32
  D470  ED4B7EEC      		LD	BC,(_DTBUF)
  D474  09            		ADD	HL,BC
                      	
  D475  CDBAE0        		CALL	SDIRENT
  D478                	FEND10:
  D478  186C          		JR	FEND
                      	
  D47A                	OPENDD:
  D47A  FD361CFD      		LD	(IY+28),0FDH	;(FCB)オープンモード
  D47E  FD360D20      		LD	(IY+13),020H	;(FCB)属性(アトリビュート)
  D482  CD9DE1        		CALL	SETTMSX
  D485  185F          		JR	FEND
                      	
  D487                	_SYS11:		;(BDOS)最初のファイルの検索
  D487  CD42DD        		CALL	SETDRV
  D48A  CDE4DE        		CALL	CHKDDX
  D48D  3818          		JR	C,_S11A
  D48F  FDE5          		PUSH	IY
  D491  E1            		POP	HL
  D492  ED5B8AEC      		LD	DE,(_DTA)
  D496  010C00        		LD	BC,12
  D499  EDB0          		LDIR
  D49B  3E20          		LD	A,020H
  D49D  12            		LD	(DE),A
  D49E  13            		INC	DE
  D49F  62            		LD	H,D
  D4A0  6B            		LD	L,E
  D4A1  13            		INC	DE
  D4A2  0E13          		LD	C,19
  D4A4  70            		LD	(HL),B
  D4A5  183D          		JR	_S11B
  D4A7                	_S11A:
  D4A7  CD96DD        		CALL	SOPEN
  D4AA                	_S12X1:
  D4AA  383A          		JR	C,FEND
  D4AC  CD36DE        		CALL	SOPENE2
  D4AF  ED5B8AEC      		LD	DE,(_DTA)
  D4B3  3A88EC        		LD	A,(_DRV)
  D4B6  3C            		INC	A
  D4B7  12            		LD	(DE),A
  D4B8  D5            		PUSH	DE
  D4B9  13            		INC	DE
  D4BA  012000        		LD	BC,32
  D4BD  EDB0          		LDIR
  D4BF  FD6E0E        		LD	L,(IY+14)	;(FCB)レコードサイズ/アクセスするディレクトリのクラスタ番号+1
  D4C2  FD660F        		LD	H,(IY+15)
  D4C5  22F4EB        		LD	(SCDIR),HL
  D4C8  2A9AEC        		LD	HL,(_FBPS)
  D4CB  22F6EB        		LD	(SFBPS),HL
  D4CE  2A9FEC        		LD	HL,(_FILEN)
  D4D1  7C            		LD	A,H
  D4D2  B7            		OR	A
  D4D3  2806          		JR	Z,_S12DIR
  D4D5  3A7AE6        		LD	A,(_SECPS+1)
  D4D8  F680          		OR	080H
  D4DA  67            		LD	H,A
  D4DB                	_S12DIR
  D4DB  22F8EB        		LD	(SFNDF),HL	;Directory position and Flags
  D4DE  E1            		POP	HL
  D4DF  1139EB        		LD	DE,SFILE
  D4E2  0E21          		LD	C,33
  D4E4                	_S11B:
  D4E4  EDB0          		LDIR
  D4E6                	FEND:
  D4E6  9F            		SBC	A,A		;CF=0 A=0 : CF=1 A=0FFH
  D4E7                	FENDE:
  D4E7  FDE1          		POP	IY
  D4E9  C1            		POP	BC
  D4EA  D1            		POP	DE
  D4EB  E1            		POP	HL
  D4EC  C9            		RET
                      	
  D4ED                	_SYS12:		;(BDOS)次のファイルの検索
  D4ED  E5            		PUSH	HL
  D4EE  D5            		PUSH	DE
  D4EF  C5            		PUSH	BC
  D4F0  FDE5          		PUSH	IY
  D4F2  CDFADD        		CALL	NOPEN
  D4F5  18B3          		JR	_S12X1
                      	
  D4F7                	_S16K:
  D4F7  FD7E1C        		LD	A,(IY+28)	;(FCB)オープンモード
  D4FA  FEFD          		CP	0FDH		;Device(0FDH)
  D4FC  37            		SCF
  D4FD  C8            		RET	Z
                      	
  D4FE  110000        	OFCB:	LD	DE,0
  D501  D5            		PUSH	DE
  D502  061A          		LD	B,26		;First cluster
  D504                	S16K1:
  D504  13            		INC	DE
  D505  23            		INC	HL
  D506  10FC          		DJNZ	S16K1
                      	
  D508  1A            		LD	A,(DE)
  D509  BE            		CP	(HL)
  D50A  2013          		JR	NZ,S16K2
  D50C  13            		INC	DE
  D50D  23            		INC	HL
  D50E  1A            		LD	A,(DE)
  D50F  BE            		CP	(HL)
  D510  200D          		JR	NZ,S16K2
                      	
  D512  E1            		POP	HL
  D513  FDE5          		PUSH	IY
  D515  D1            		POP	DE
  D516  1A            		LD	A,(DE)		;Drive
  D517  BE            		CP	(HL)
  D518  2006          		JR	NZ,S16K3
                      					;ここはCFが必ず0
  D51A  ED52          		SBC	HL,DE		;CP HL,DE
  D51C  37            		SCF
  D51D  C0            		RET	NZ
  D51E  E5            		PUSH	HL
  D51F                	S16K2:
  D51F  E1            		POP	HL
  D520                	S16K3:
  D520  FDE5          		PUSH	IY
  D522  D1            		POP	DE
  D523                	_SYS13:		;(BDOS)ファイルの削除
  D523  CD42DD        		CALL	SETDRV
  D526  CDD4DF        		CALL	KILL
  D529                	FEND13:
  D529  18BB          		JR	FEND
                      	
  D52B                	_SYS14:		;(BDOS)シーケンシャルな読み出し
  D52B  CD42DD        		CALL	SETDRV
  D52E  CDCAE1        		CALL	PUSHRR
  D531  CD0BE2        		CALL	GETSEQ
                      	
  D534  CD1FE2        		CALL	RB_READ
  D537  E5            		PUSH	HL
  D538  CDDEE1        		CALL	SETSEQ
  D53B                	SREAD:
  D53B  E1            		POP	HL
                      	
  D53C  C601          		ADD	A,001H
  D53E  38A6          		JR	C,FEND
                      	
  D540  7D            		LD	A,L
  D541  D601          		SUB	001H
  D543                	FENDX:
  D543  9F            		SBC	A,A
  D544  E603          		AND	3
  D546  1F            		RRA
  D547  189E          		JR	FENDE
                      	
  D549                	_SYS15:		;(BDOS)シーケンシャルな書き込み
  D549  CD42DD        		CALL	SETDRV
  D54C  CDCAE1        		CALL	PUSHRR
  D54F  CD0BE2        		CALL	GETSEQ
                      	
  D552  CD18E2        		CALL	RB_WRITE
  D555  E5            		PUSH	HL
  D556  CDDEE1        		CALL	SETSEQ
  D559                	SWRITE:
  D559  E1            		POP	HL
                      	
  D55A  C6FF          		ADD	A,0FFH
  D55C  18E5          		JR	FENDX
                      	
  D55E                	_SYS17:		;(BDOS)ファイル名の変更
  D55E  CD42DD        		CALL	SETDRV
  D561  CD30E0        		CALL	NAME
  D564  18C3          		JR	FEND13
                      	
  D566                	_SYS16:		;(BDOS)ファイルの作成
  D566  CD42DD        		CALL	SETDRV
                      	
  D569  CDAAE0        		CALL	CHKWILDX
  D56C  38BB          		JR	C,FEND13
  D56E  FD7E01        		LD	A,(IY+1)	;(FCB)主ファイル名
  D571  FE05          		CP	5
  D573  2805          		JR	Z,_S16X2
  D575  FE21          		CP	021H
  D577  DA29D5        		JP	C,FEND13
  D57A                	_S16X2:
                      	;				Clear FCB
  D57A  FDE5          		PUSH	IY
  D57C  E1            		POP	HL
  D57D  011000        		LD	BC,16
  D580  09            		ADD	HL,BC
  D581                	_S16X1:
  D581  70            		LD	(HL),B		;B=0
  D582  23            		INC	HL
  D583  0D            		DEC	C
  D584  20FB          		JR	NZ,_S16X1
                      	
  D586  CD9DE1        		CALL	SETTMSX
  D589  FD360DFF      		LD	(IY+13),0FFH	;(FCB)Attribute
  D58D  CD62DD        		CALL	SOPENX
  D590  3F            		CCF
  D591  CCF7D4        		CALL	Z,_S16K
  D594  D447DE        		CALL	NC,COPEN
  D597  D4BAE0        		CALL	NC,SDIRENT
  D59A  C3F1D3        		JP	_S16XX
                      	
  D59D                	_SYS21:		;(BDOS)ランダムな読み出し
                      	
  D59D  CD42DD        		CALL	SETDRV
  D5A0  CDCAE1        		CALL	PUSHRR
  D5A3  FD6E21        		LD	L,(IY+33)	;(FCB)Random record
  D5A6  FD6622        		LD	H,(IY+34)
                      	
  D5A9  CD1FE2        		CALL	RB_READ
  D5AC  E5            		PUSH	HL
  D5AD  CDF5E1        		CALL	POPRR
  D5B0  1889          		JR	SREAD
                      	
  D5B2                	_SYS22:		;(BDOS)ランダムな書き込み
  D5B2                	_SYS28:		;(BDOS)ランダムな書き込み・その2
  D5B2  CD42DD        		CALL	SETDRV
  D5B5  CDCAE1        		CALL	PUSHRR
  D5B8  FD6E21        		LD	L,(IY+33)	;(FCB)Random record
  D5BB  FD6622        		LD	H,(IY+34)
                      	
  D5BE  CD18E2        		CALL	RB_WRITE
  D5C1  E5            		PUSH	HL
  D5C2  CDF5E1        		CALL	POPRR
  D5C5  1892          		JR	SWRITE
                      	
  D5C7                	_SYS18:		;(BDOS)ログインベクトルの獲得
  D5C7  21FF00        		LD	HL,000FFH
  D5CA  AF            		XOR	A
  D5CB  C9            		RET
                      	
  D5CC                	_SYS19:		;(BDOS)カレントドライブ番号の獲得
  D5CC  3A87EC        		LD	A,(_DVSW)
  D5CF  A7            		AND	A
  D5D0  C9            		RET
                      	
  D5D1                	_SYS1A:		;(BDOS)DTAの設定
  D5D1  ED538AEC      		LD	(_DTA),DE
  D5D5  AF            		XOR	A
  D5D6  C9            		RET
                      	
  D5D7                	_SYS1B:		;(BDOS)ディスク情報の獲得
  D5D7  7B            		LD	A,E
  D5D8  CD55DD        		CALL	GETDRV
  D5DB  CDDCEC        		CALL	_GETDPB
  D5DE  D4E2EC        		CALL	NC,_RDFATX
  D5E1  210000        		LD	HL,0
  D5E4  D476E1        		CALL	NC,DSKF
                      	
  D5E7  ED5B77E1      		LD	DE,(MAXCLP+1)	;DPB_08_MAXCL-1
  D5EB  1B            		DEC	DE		;DE←クラスタの総数
  D5EC  FD2A7CEC      		LD	IY,(_FATBF)	;IY←メモリ上のFATの先頭アドレス
  D5F0  9F            		SBC	A,A
  D5F1  D8            		RET	C
  D5F2  4F            		LD	C,A		;C=0
  D5F3  DD7E0F        		LD	A,(IX+00FH)	;DPB_0F_BPS
  D5F6  E60F          		AND	00FH
  D5F8  47            		LD	B,A
  D5F9  DD7E07        		LD	A,(IX+7)	;DPB_07_SECPCL
  D5FC  C9            		RET
                      	
  D5FD                	_SYS1D:		;(BDOS)書き込みが禁止されているディスクの調査
  D5FD  AF            		XOR	A
  D5FE  67            		LD	H,A
  D5FF  6F            		LD	L,A
  D600  C9            		RET
                      	
  D601                	_SYS1F:		;(BDOS)ディスク装置のパラメータの読み出し
  D601  2100ED        		LD	HL,DEVICE
  D604  7B            		LD	A,E
  D605  C3DCEC        		JP	_GETDPB
                      	
  D608                	_SYS23:		;(BDOS)ファイルサイズの獲得
  D608  E5            		PUSH	HL
  D609  2A1EEC        		LD	HL,(STABLE+2*00FH)	;ファイルのオープン
  D60C  CD0F00        		CALL	JP_HL
  D60F  3814          		JR	C,_S23X1
                      	
  D611  D5            		PUSH	DE		;EX DE,IY
  D612  FDE3          		EX	(SP),IY		;
                      	;	POP	DE		;
                      	;	PUSH	DE		;DEを破壊しないように注意vv
  D614  CDFBE1        		CALL	GETSIZE
  D617                	_S24X1:
  D617  FD7521        		LD	(IY+33),L	;(FCB)Random record
  D61A  FD7422        		LD	(IY+34),H
  D61D  FD362300      		LD	(IY+35),0
                      	;	POP	DE		;^^^^^^^^^^^^^^^^^^^^^^^^
                      	;	PUSH	DE		;EX DE,IY
  D621  FDE3          		EX	(SP),IY		;
  D623  D1            		POP	DE		;
                      	
  D624  AF            		XOR	A
  D625                	_S23X1:
  D625  E1            		POP	HL
  D626  C9            		RET
                      	
  D627                	_SYS24:		;(BDOS)ランダムレコードフィールドの設定
  D627  E5            		PUSH	HL
  D628  D5            		PUSH	DE		;EX DE,IY
  D629  FDE3          		EX	(SP),IY		;
                      	;	POP	DE		;
                      	;	PUSH	DE		;DEを破壊しないように注意vv
  D62B  CD0BE2        		CALL	GETSEQ
  D62E  18E7          		JR	_S24X1		;^^^^^^^^^^^^^^^^^^^^^^^^
                      	
  D630                	_SYS29:		;(BDOS)ファイル名の解析
  D630  C5            		PUSH	BC
  D631  E5            		PUSH	HL
  D632  CD59DC        		CALL	FILE
  D635  E1            		POP	HL
  D636  C1            		POP	BC
  D637                	S29X1:
  D637  C5            		PUSH	BC
  D638  D5            		PUSH	DE
  D639  E5            		PUSH	HL
  D63A  EB            		EX	DE,HL
  D63B  2114EB        		LD	HL,FDRV
  D63E  010D00        		LD	BC,13
  D641  EDB0          		LDIR
  D643  70            		LD	(HL),B		;B=0
  D644  0E03          		LD	C,3
  D646  EDB0          		LDIR
  D648  E1            		POP	HL
  D649  D1            		POP	DE
  D64A  C1            		POP	BC
  D64B  AF            		XOR	A
  D64C  C9            		RET
                      	
  D64D                	_SYS30:		;(BDOS)論理セクタを用いた書き込み
  D64D  C5            		PUSH	BC
  D64E  01EAE7        		LD	BC,DWT24B
  D651  1804          		JR	S2FX
  D653                	_SYS2F:
  D653  C5            		PUSH	BC
  D654  01DAE7        		LD	BC,DRD24B
  D657                	S2FX:
  D657  ED436DD6      		LD	(S2FPAT+1),BC
  D65B  CDDFEC        		CALL	_FFLUSH
                      	
  D65E  D5            		PUSH	DE
  D65F  E5            		PUSH	HL
  D660  7D            		LD	A,L		;Drive
  D661  CDD9EC        		CALL	_CHGDRV
  D664  3809          		JR	C,S30X2
  D666  44            		LD	B,H		;Number of clusters
  D667  2A8AEC        		LD	HL,(_DTA)
                      	
  D66A  0E00          		LD	C,0
  D66C  CDDAE7        	S2FPAT:	CALL	DRD24B
  D66F                	S30X2:
  D66F  E1            		POP	HL
  D670  D1            		POP	DE
  D671  C1            		POP	BC
  D672  9F            		SBC	A,A
  D673  C9            		RET
                      	
                      	;LDIO.ASM
                      	
                      	;	LSX-Dodgers IO
                      	
  D3A2                	_SYS04	EQU	_ERROR		;(BDOS)外部出力
  D3A2                	_SYS05	EQU	_ERROR		;(BDOS)プリンタ出力
  D3A2                	_SYS1C	EQU	_ERROR		;(BDOS)ディスクの書き込み禁止化
  D3A2                	_SYS1E	EQU	_ERROR		;(BDOS)ファイル属性の設定
  D3A2                	_SYS20	EQU	_ERROR		;(BDOS)利用者番号の設定と読み出し
  D3A2                	_SYS2E	EQU	_ERROR		;(BDOS)ベリファイ・フラグの設定
                      	
  D674                	BIOS:
  D674  E5            		PUSH	HL
  D675  211080        		LD	HL,08010H
  D678  39            		ADD	HL,SP
  D679  E1            		POP	HL
  D67A  300E          		JR	NC,BIOS2
  D67C                	BIOS1:
  D67C  CD84D6        		CALL	BIOS3
  D67F  061E          		LD	B,01EH
  D681  ED79          		OUT	(C),A
  D683  C9            		RET
  D684                	BIOS3:
  D684  C5            		PUSH	BC
  D685  061D          		LD	B,01DH
  D687  ED79          		OUT	(C),A
  D689  C9            		RET
  D68A                	BIOS2:
  D68A  ED7395D6      		LD	(SPPAT+1),SP	;スタックがBIOS-ROMと被っている場合
  D68E  310000        		LD	SP,EXTSP
  D691  CD7CD6        		CALL	BIOS1
  D694  310000        	SPPAT:	LD	SP,0
  D697  C9            		RET
                      	
  D698                	INT:
  D698  F5            		PUSH	AF
  D699  E5            		PUSH	HL
  D69A  ED73ABD6      		LD	(INTSP+1),SP
  D69E  210001        		LD	HL,00100H
  D6A1  39            		ADD	HL,SP
  D6A2  3803          		JR	C,INTP1X
  D6A4  310000        		LD	SP,EXTSP
  D6A7                	INTP1X:
  D6A7  CDB2D6        		CALL	INTP1
  D6AA  310000        	INTSP:	LD	SP,0
  D6AD                	INTPE:
  D6AD  E1            		POP	HL
  D6AE                	INTPE2:
  D6AE  F1            		POP	AF
  D6AF                	INTCTCE:
  D6AF  FB            		EI
  D6B0  ED4D          		RETI
  D6B2                	INTP1:
  D6B2  C5            		PUSH	BC
                      	
  D6B3  CD83DA        		CALL	IN49SB
  D6B6  67            		LD	H,A
  D6B7  CD83DA        		CALL	IN49SB
  D6BA  6F            		LD	L,A
                      	
  D6BB  FE08          		CP	8		;DELキー
  D6BD  2005          		JR	NZ,SCEXE
  D6BF  7C            		LD	A,H
  D6C0  E611          		AND	011H		;CTRLキー + GRAPHキー
  D6C2  2808          		JR	Z,RESET
  D6C4                	SCEXE:
  D6C4  2292EC        		LD	(_KEYD),HL
  D6C7  CDF8D6        		CALL	KEYSET1
                      	
  D6CA  C1            		POP	BC
  D6CB  C9            		RET
                      	
  D6CC                	RESET:
  D6CC  3E1D          		LD	A,01DH
  D6CE  D300          		OUT	(0),A
  D6D0  C7            		RST	0
                      	
  D6D1                	INTCTC2:
  D6D1  F5            		PUSH	AF
  D6D2  3E00          	INTCPAT:LD	A,000H
  D6D4  3D            		DEC	A
  D6D5  32D3D6        		LD	(INTCPAT+1),A
  D6D8  20D4          		JR	NZ,INTPE2
                      	
  D6DA  3A92EC        		LD	A,(_KEYD)
  D6DD  B7            		OR	A
  D6DE  28CE          		JR	Z,INTPE2
  D6E0                	KEYSET0:
  D6E0  E5            		PUSH	HL
  D6E1  2A90EC        		LD	HL,(_KEYPS)
  D6E4  7C            		LD	A,H
  D6E5  AD            		XOR	L
  D6E6  2006          		JR	NZ,INTC2A
                      	
  D6E8  2A92EC        		LD	HL,(_KEYD)
  D6EB  CD22D7        		CALL	KEYSET
  D6EE                	INTC2A:
  D6EE  3A94EC        		LD	A,(_KEYSP)
  D6F1  E60F          		AND	00FH
  D6F3  32D3D6        		LD	(INTCPAT+1),A
                      	
  D6F6  18B5          		JR	INTPE
                      	
  D6F8                	KEYSET1:
  D6F8  CB6C          		BIT	5,H
  D6FA  F5            		PUSH	AF
  D6FB  ED4B8CEC      		LD	BC,(_CTC)
  D6FF  78            		LD	A,B
  D700  B1            		OR	C
  D701  2006          		JR	NZ,KEYS10E
                      	
  D703  F1            		POP	AF
  D704  201C          		JR	NZ,KEYSET
  D706  F5            		PUSH	AF
  D707  18D7          		JR	KEYSET0
  D709                	KEYS10E:
  D709  F1            		POP	AF
  D70A  C8            		RET	Z
  D70B  F5            		PUSH	AF
  D70C  3E03          		LD	A,3		;CTC STOP
  D70E  ED79          		OUT	(C),A
  D710  F1            		POP	AF
                      	
  D711  B7            		OR	A
  D712  C8            		RET	Z
                      	
  D713  E5            		PUSH	HL
  D714  2A94EC        		LD	HL,(_KEYSP)
  D717  3EA7          		LD	A,0A7H
  D719  ED79          		OUT	(C),A
  D71B  ED69          		OUT	(C),L
  D71D  7C            		LD	A,H
  D71E  32D3D6        		LD	(INTCPAT+1),A
  D721  E1            		POP	HL
                      	
  D722                	KEYSET:
  D722  7D            		LD	A,L
  D723  CB7C          		BIT	7,H
  D725  CC52D7        		CALL	Z,FKEY
  D728  CB74          		BIT	6,H
  D72A  C0            		RET	NZ
  D72B                	KEYBS:
  D72B  B7            		OR	A
  D72C  C8            		RET	Z
  D72D                	KEYBS1:
  D72D  FE03          		CP	3
  D72F  CC45D7        		CALL	Z,KEYBC
  D732  E5            		PUSH	HL
  D733  F5            		PUSH	AF
  D734  2A90EC        		LD	HL,(_KEYPS)
  D737  2C            		INC	L
  D738  7D            		LD	A,L
  D739  BC            		CP	H
  D73A  2812          		JR	Z,POP_AF_HL_SCF_RET
  D73C  3290EC        		LD	(_KEYPS),A
  D73F  26FE          		LD	H,KEYBF/256
  D741  F1            		POP	AF
  D742  77            		LD	(HL),A
  D743  E1            		POP	HL
  D744  C9            		RET
                      	
  D745                	KEYBC:
  D745  E5            		PUSH	HL
  D746  210000        		LD	HL,0
  D749  2290EC        		LD	(_KEYPS),HL
  D74C  E1            		POP	HL
  D74D  C9            		RET
                      	
  D74E                	POP_AF_HL_SCF_RET:
  D74E  F1            		POP	AF
  D74F  E1            		POP	HL
  D750  37            		SCF
  D751  C9            		RET
                      	
  D752                	FKEY:
  D752  CB75          		BIT	6,L
  D754  C8            		RET	Z
  D755  3E1B          		LD	A,01BH
  D757  CD2DD7        		CALL	KEYBS1
  D75A  7D            		LD	A,L
  D75B  C6AF          		ADD	A,020H-'q'
  D75D  CB7D          		BIT	7,L
  D75F  C8            		RET	Z
  D760  2E50          		LD	L,'P'
  D762  D690          		SUB	0E1H+020H-'q'
  D764  2810          		JR	Z,KEYBSL
  D766  2C            		INC	L
  D767  3D            		DEC	A
  D768  280C          		JR	Z,KEYBSL
  D76A  2C            		INC	L
  D76B  D609          		SUB	0EBH-0E2H
  D76D  2807          		JR	Z,KEYBSL
  D76F  2E43          		LD	L,'C'
  D771  3D            		DEC	A
  D772  2802          		JR	Z,KEYBSL
  D774  2E58          		LD	L,'X'
  D776                	KEYBSL:
  D776  7D            		LD	A,L
  D777  18B4          		JR	KEYBS1
                      	
  D779                	_SYS01:		;(BDOS)コンソール入力
  D779  CD09EB        		CALL	_SYS07
  D77C                	MSG_A:
  D77C  F5            		PUSH	AF
  D77D  D5            		PUSH	DE
  D77E  5F            		LD	E,A
  D77F  CD85D7        		CALL	_SYS02
  D782  D1            		POP	DE
  D783  F1            		POP	AF
  D784  C9            		RET
                      	
  D785                	_SYS02:		;(BDOS)コンソール出力
  D785  CD97D7        		CALL	BREAK
  D788  1805          		JR	PRINTX
                      	
  D78A                	_SYS06:		;(BDOS)コンソール直接入出力
  D78A  7B            		LD	A,E
  D78B  3C            		INC	A
  D78C  CACAEC        		JP	Z,_INKEY
  D78F                	PRINTX:
  D78F  C3CDEC        		JP	_PRINT
                      	
  D792                	_SYS08:		;(BDOS)エコーなしコンソール入力
  D792  CD09EB        		CALL	_SYS07
  D795  1804          		JR	BREAK1
  D797                	BREAK:
  D797  FB            		EI
  D798  3A92EC        		LD	A,(_KEYD)
  D79B                	BREAK1:
  D79B  FE03          		CP	3
  D79D  CA0000        		JP	Z,0
  D7A0  FE13          		CP	013H
  D7A2  C0            		RET	NZ
                      	
  D7A3                	PAUSE:
  D7A3  CD45D7        		CALL	KEYBC
                      	
  D7A6                	FLGET:
  D7A6  CDDFEC        		CALL	_FFLUSH
  D7A9  C5            		PUSH	BC
  D7AA  E5            		PUSH	HL
  D7AB  ED4B8EEC      		LD	BC,(_TXADR)
  D7AF  CBE8          		SET	5,B
  D7B1  ED60          		IN	H,(C)
  D7B3                	FLGET1:
  D7B3  3A93EC        		LD	A,(_KEYD+1)
  D7B6  0F            		RRCA
  D7B7  0F            		RRCA
  D7B8  E610          		AND	010H
  D7BA  F608          		OR	8
  D7BC  ED68          		IN	L,(C)
  D7BE  B5            		OR	L
  D7BF  ED79          		OUT	(C),A
  D7C1  CDCAEC        		CALL	_INKEY
  D7C4  28ED          		JR	Z,FLGET1
  D7C6  ED61          		OUT	(C),H
  D7C8  E1            		POP	HL
  D7C9  C1            		POP	BC
  D7CA  C9            		RET
                      	
  D7CB                	_SYS0A:		;(BDOS)文字列入力
  D7CB  C5            		PUSH	BC
  D7CC  E5            		PUSH	HL
  D7CD  D5            		PUSH	DE
  D7CE  CDE0DB        		CALL	GETL
  D7D1  1100FF        		LD	DE,KBUF
  D7D4  E1            		POP	HL
  D7D5  E5            		PUSH	HL
  D7D6  0E00          		LD	C,0
  D7D8  3004          		JR	NC,SAX0
  D7DA  23            		INC	HL
  D7DB  23            		INC	HL
  D7DC  1808          		JR	SAX4
  D7DE                	SAX0:
  D7DE  46            		LD	B,(HL)
  D7DF  23            		INC	HL
  D7E0                	SAX1:
  D7E0  23            		INC	HL
  D7E1  1A            		LD	A,(DE)
  D7E2  13            		INC	DE
  D7E3  B7            		OR	A
  D7E4  2004          		JR	NZ,SAX2
  D7E6                	SAX4:
  D7E6  360D          		LD	(HL),00DH
  D7E8  1804          		JR	SAX3
  D7EA                	SAX2:
  D7EA  77            		LD	(HL),A
  D7EB  0C            		INC	C
  D7EC  10F2          		DJNZ	SAX1
  D7EE                	SAX3:
  D7EE  D1            		POP	DE
  D7EF  79            		LD	A,C
  D7F0  13            		INC	DE
  D7F1  12            		LD	(DE),A
  D7F2  1B            		DEC	DE
  D7F3  E1            		POP	HL
  D7F4  C1            		POP	BC
  D7F5  A7            		AND	A
  D7F6  C9            		RET
                      	
  D7F7                	_SYS0B:		;(BDOS)コンソール状態のチェック
  D7F7  CD97D7        		CALL	BREAK
  D7FA  3A92EC        		LD	A,(_KEYD)
  D7FD  B7            		OR	A
  D7FE  C8            		RET	Z
  D7FF                	CONSTX:
  D7FF  CDDFEC        		CALL	_FFLUSH
  D802  E5            		PUSH	HL
  D803  2A90EC        		LD	HL,(_KEYPS)
  D806  7C            		LD	A,H
  D807  AD            		XOR	L
  D808  E1            		POP	HL
  D809  C6FF          		ADD	A,0FFH
  D80B  9F            		SBC	A,A
  D80C  C9            		RET
                      	
  D80D                	_SYS2A:		;(BDOS)日付の獲得
  D80D  C5            		PUSH	BC
  D80E  3EED          		LD	A,0EDH		;Read calendar
  D810  CD9EDA        		CALL	COMOUT
  D813  CD30D8        		CALL	IN49SB_BCD	;YY
  D816  6F            		LD	L,A
  D817  2600          		LD	H,0
                      	;	LD	DE,1900		;0076CH
                      	;	CP	90		;90以上は1900年代 1990-1999
                      	;	JR	NC,RDDATE1	;90未満は2000年代 2000-2089
                      	;	LD	E,0D0H		;2000 & 0FFH D=007H
  D819  11D007        		LD	DE,2000		;すべて2000年代で処理 2000-2099
  D81C                	RDDATE1:
  D81C  19            		ADD	HL,DE
  D81D  CD83DA        		CALL	IN49SB		;MM
  D820  57            		LD	D,A
  D821  CD30D8        		CALL	IN49SB_BCD	;DD
  D824  5F            		LD	E,A
  D825  7A            		LD	A,D
  D826  E607          		AND	7
  D828  0604          		LD	B,4
  D82A                	RDDATE2:
  D82A  CB3A          		SRL	D
  D82C  10FC          		DJNZ	RDDATE2
  D82E  C1            		POP	BC
  D82F  C9            		RET
  D830                	IN49SB_BCD:
  D830  CD83DA        		CALL	IN49SB
                      	;------------------------
                      	;BCDの10進数化
                      	;in
                      	;	A  : BCD
                      	;out
                      	;	A  : 10進数
                      	;------------------------
  D833  4F            		LD	C,A
  D834  E6F0          		AND	0F0H	;10の位
  D836  0F            		RRCA
  D837  47            		LD	B,A
  D838  0F            		RRCA
  D839  0F            		RRCA
  D83A  80            		ADD	A,B
  D83B  47            		LD	B,A
  D83C  79            		LD	A,C
  D83D  E60F          		AND	00FH	;1の位
  D83F  80            		ADD	A,B
  D840  C9            		RET
                      	
  D841                	_SYS2C:		;(BDOS)時刻の獲得
  D841  C5            		PUSH	BC
  D842  3EEF          		LD	A,0EFH		;Read time
  D844  CD9EDA        		CALL	COMOUT
  D847  CD30D8        		CALL	IN49SB_BCD	;TT
  D84A  67            		LD	H,A
  D84B  CD30D8        		CALL	IN49SB_BCD	;MM
  D84E  6F            		LD	L,A
  D84F  CD30D8        		CALL	IN49SB_BCD	;SS
  D852  57            		LD	D,A
  D853  C1            		POP	BC
  D854  AF            		XOR	A
  D855  C9            		RET
                      	
  D856                	ESC1:
  D856  7B            		LD	A,E
  D857  FE41          		CP	'A'
  D859  CA9AD9        		JP	Z,CTRL1E
  D85C  FE42          		CP	'B'
  D85E  CA09DB        		JP	Z,CTRL1F
  D861  FE43          		CP	'C'
  D863  CAA7D9        		JP	Z,CTRL1C
  D866  FE44          		CP	'D'
  D868  CA90D9        		JP	Z,CTRL1D
  D86B  FE45          		CP	'E'
  D86D  2802          		JR	Z,CT0CX
  D86F  FE6A          		CP	'j'
  D871                	CT0CX:
  D871  CADCDA        		JP	Z,CTRL0C
  D874  FE48          		CP	'H'
  D876  CA24DA        		JP	Z,CTRL0B
  D879  FE4A          		CP	'J'
  D87B  CADFDA        		JP	Z,CTRL06
  D87E  FE4B          		CP	'K'
  D880  CAE7D9        		JP	Z,CTRL05
  D883  FE4C          		CP	'L'
  D885  CA1EDB        		JP	Z,CTRL0E
  D888  FE54          		CP	'T'
  D88A  CAE7D9        		JP	Z,CTRL05
  D88D  FE78          		CP	'x'
  D88F  2804          		JR	Z,ESC1X
  D891  FE79          		CP	'y'
  D893  2002          		JR	NZ,ESC1Y
  D895                	ESC1X:
  D895  3601          		LD	(HL),1
  D897                	ESC1Y:
  D897  FE3D          		CP	'='
  D899  2804          		JR	Z,ESC1W
  D89B  FE59          		CP	'Y'
  D89D  2002          		JR	NZ,ESC1Z
  D89F                	ESC1W:
  D89F  3602          		LD	(HL),2
  D8A1                	ESC1Z:
  D8A1  FE20          		CP	020H
  D8A3  3802          		JR	C,ESC1C
  D8A5  87            		ADD	A,A
  D8A6  D0            		RET	NC
  D8A7                	ESC1C:
  D8A7  E1            		POP	HL
  D8A8  184A          		JR	ANK
                      	
  D8AA                	ESC:
  D8AA  2105D9        		LD	HL,PRINTE5
  D8AD  E5            		PUSH	HL
  D8AE  21D0D8        		LD	HL,ESCFLG+1
  D8B1  3600          		LD	(HL),0
  D8B3  3D            		DEC	A
  D8B4  28A0          		JR	Z,ESC1
  D8B6  3D            		DEC	A
  D8B7  2009          		JR	NZ,ESC2
  D8B9  3603          		LD	(HL),3
  D8BB  7B            		LD	A,E
  D8BC  D620          		SUB	020H
  D8BE  32C5D8        		LD	(ESCYP+1),A
  D8C1  C9            		RET
  D8C2                	ESC2:
  D8C2  3D            		DEC	A
  D8C3  C0            		RET	NZ
  D8C4  2600          	ESCYP:	LD	H,0
  D8C6  7B            		LD	A,E
  D8C7  D620          		SUB	020H
  D8C9  6F            		LD	L,A
  D8CA  C3D6EC        		JP	_LOC
                      	
  D8CD                	PRINT:
  D8CD  C5            		PUSH	BC
  D8CE  E5            		PUSH	HL
  D8CF  3E00          	ESCFLG:	LD	A,000H
  D8D1  B7            		OR	A
  D8D2  20D6          		JR	NZ,ESC
                      	
  D8D4  3E1F          		LD	A,01FH
  D8D6  BB            		CP	E
  D8D7  3030          		JR	NC,CTRL
  D8D9                	PRINTC:
  D8D9  A7            	INSFLG:	AND	A
  D8DA  DCA7DA        		CALL	C,CTRL12
                      	
  D8DD  3E00          	KANFLG:	LD	A,000H
  D8DF  B7            		OR	A
  D8E0  203F          		JR	NZ,KANJI2
  D8E2  7B            	X1KPAT:	LD	A,E
  D8E3  FE80          		CP	080H
  D8E5  380D          		JR	C,ANK
  D8E7  FEA0          		CP	0A0H
  D8E9  3804          		JR	C,KANJI1
  D8EB  FEE0          		CP	0E0H
  D8ED  3805          		JR	C,ANK
  D8EF                	KANJI1:
  D8EF  32DED8        		LD	(KANFLG+1),A
  D8F2  1811          		JR	PRINTE5
  D8F4                	ANK:
  D8F4  ED4B8EEC      		LD	BC,(_TXADR)
  D8F8  78            		LD	A,B
  D8F9  F638          		OR	038H
  D8FB  47            		LD	B,A
  D8FC  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令	kanji
  D8FE  CB98          		RES	3,B
  D900  ED59          		OUT	(C),E		;Text
  D902                	KANJIE:
  D902  CD6CD9        		CALL	PRINTE7
  D905                	PRINTE5:
  D905  E1            		POP	HL
  D906  C1            		POP	BC
  D907  AF            		XOR	A
  D908  C9            		RET
                      	
  D909                	CTRL:
  D909  CD53D9        		CALL	KANCLR
  D90C  3EA7          		LD	A,0A7H		;AND	A
  D90E  32D9D8        		LD	(INSFLG),A
  D911  7B            		LD	A,E
  D912  87            		ADD	A,A
  D913  F680          		OR	080H
  D915  6F            		LD	L,A
  D916  26EB          		LD	H,CTRLTB/256
  D918  7E            		LD	A,(HL)
  D919  2C            		INC	L
  D91A  66            		LD	H,(HL)
  D91B  6F            		LD	L,A
  D91C  CD0F00        		CALL	JP_HL
  D91F  18E4          		JR	PRINTE5
                      	
  D921                	KANJI2:
  D921  D5            		PUSH	DE
  D922  57            		LD	D,A
  D923  01812F        		LD	BC,02F81H	;SFTJIS
  D926  DF            		RST	018H
  D927  01C32F        		LD	BC,02FC3H	;Instead or JISVRM
  D92A  DF            		RST	018H
                      	
  D92B  ED4B8EEC      		LD	BC,(_TXADR)
  D92F  78            		LD	A,B
  D930  F638          		OR	038H
  D932  47            		LD	B,A
  D933  ED51          		OUT	(C),D		;kanji
  D935  CB98          		RES	3,B
  D937  ED59          		OUT	(C),E		;Text
  D939  CD6CD9        		CALL	PRINTE7
  D93C  ED4B8EEC      		LD	BC,(_TXADR)
  D940  78            		LD	A,B
  D941  F638          		OR	038H
  D943  47            		LD	B,A
  D944  CBF2          		SET	6,D
  D946  ED51          		OUT	(C),D		;Kanji
  D948  CB98          		RES	3,B
  D94A  ED59          		OUT	(C),E		;Text
  D94C  D1            		POP	DE
  D94D  AF            		XOR	A
  D94E  32DED8        		LD	(KANFLG+1),A
  D951  18AF          		JR	KANJIE
                      	
  D953                	KANCLR:
  D953  3ADED8        		LD	A,(KANFLG+1)
  D956  B7            		OR	A
  D957  C8            		RET	Z
  D958  ED4B8EEC      		LD	BC,(_TXADR)
  D95C  78            		LD	A,B
  D95D  F638          		OR	038H
  D95F  47            		LD	B,A
  D960  AF            		XOR	A
  D961  32DED8        		LD	(KANFLG+1),A
  D964  ED79          		OUT	(C),A		;Kanji
  D966  CB98          		RES	3,B
  D968  3E20          		LD	A,020H
  D96A  ED79          		OUT	(C),A		;Text
  D96C                	PRINTE7:
  D96C  CBA0          		RES	4,B
  D96E                	PRINTE6:
  D96E  3A96EC        		LD	A,(_COLORF)
  D971                	PRINTE4:
  D971  ED79          		OUT	(C),A		;Color
  D973  78            		LD	A,B
  D974  E607          		AND	7
  D976  47            		LD	B,A
  D977                	PRINTE2:
  D977  03            		INC	BC
  D978                	PRINTE3:
  D978  2ABAEC        		LD	HL,(CRTCD+10)
  D97B  A7            		AND	A
  D97C  ED4A          		ADC	HL,BC
  D97E                	PRINTE8:
  D97E  2805          		JR	Z,PRINT2
  D980                	PRINTE1:
  D980  ED438EEC      		LD	(_TXADR),BC
  D984                	PRINTE:
  D984  C9            		RET
                      	
  D985                	PRINT2:
  D985  CD24DB        		CALL	SCR
  D988  2ABCEC        		LD	HL,(CRTCD+12)
  D98B  09            		ADD	HL,BC
  D98C  228EEC        		LD	(_TXADR),HL
  D98F  C9            		RET
                      	
  D990                	CTRL08:
  D990                	CTRL1D:
  D990  ED4B8EEC      		LD	BC,(_TXADR)
  D994  78            		LD	A,B
  D995  B1            		OR	C
  D996  C8            		RET	Z
  D997  0B            		DEC	BC
  D998  18E6          		JR	PRINTE1
                      	
  D99A                	CTRL1E:
  D99A  ED4B8EEC      		LD	BC,(_TXADR)
  D99E  2ABCEC        		LD	HL,(CRTCD+12)
  D9A1  09            		ADD	HL,BC
  D9A2  D0            		RET	NC
  D9A3  44            		LD	B,H
  D9A4  4D            		LD	C,L
  D9A5  18D9          		JR	PRINTE1
                      	
  D9A7                	CTRL1C:
  D9A7  ED4B8EEC      		LD	BC,(_TXADR)
  D9AB  18CA          		JR	PRINTE2
                      	
  D9AD                	CTRL09:
  D9AD  ED4B8EEC      		LD	BC,(_TXADR)
  D9B1  79            		LD	A,C
  D9B2  E6F8          		AND	0F8H
  D9B4  C608          		ADD	A,8
  D9B6  4F            		LD	C,A
  D9B7  88            		ADC	A,B
  D9B8  91            		SUB	C
  D9B9  47            		LD	B,A
  D9BA  18BC          		JR	PRINTE3
                      	
  D9BC                	CTRL02:
  D9BC  2A8EEC        		LD	HL,(_TXADR)
  D9BF  7C            		LD	A,H
  D9C0  B5            		OR	L
  D9C1  C8            		RET	Z
  D9C2  2B            		DEC	HL
  D9C3  228EEC        		LD	(_TXADR),HL
  D9C6  D5            		PUSH	DE
  D9C7  CDD3EC        		CALL	_POS
  D9CA  3AB1EC        		LD	A,(CRTCD+1)
  D9CD  95            		SUB	L
  D9CE  6F            		LD	L,A
  D9CF  2D            		DEC	L
  D9D0  2638          		LD	H,038H
  D9D2  ED4B8EEC      		LD	BC,(_TXADR)
  D9D6  09            		ADD	HL,BC
  D9D7  44            		LD	B,H
  D9D8  4D            		LD	C,L
  D9D9  110020        		LD	DE,02000H	;D:Text E:kanji
  D9DC  2A96EC        		LD	HL,(_COLORF)	;L:Color
  D9DF                	C8X1:
  D9DF  CDC3DA        		CALL	C12S
  D9E2  0B            		DEC	BC
  D9E3  20FA          		JR	NZ,C8X1
  D9E5  D1            		POP	DE
  D9E6  C9            		RET
                      	
  D9E7                	CTRL05:
  D9E7  CDD3EC        		CALL	_POS
  D9EA  3AB1EC        		LD	A,(CRTCD+1)
  D9ED  95            		SUB	L
  D9EE  6F            		LD	L,A
  D9EF  2620          		LD	H,020H
  D9F1  ED4B8EEC      		LD	BC,(_TXADR)
  D9F5                	C05X1:
  D9F5  78            		LD	A,B
  D9F6  F638          		OR	038H
  D9F8  47            		LD	B,A
  D9F9  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令	kanji
  D9FB  CB98          		RES	3,B
  D9FD  ED61          		OUT	(C),H		;Text
  D9FF  CBA0          		RES	4,B
  DA01  3A96EC        		LD	A,(_COLORF)
  DA04  ED79          		OUT	(C),A		;Color
  DA06  03            		INC	BC
  DA07  2D            		DEC	L
  DA08  20EB          		JR	NZ,C05X1
  DA0A  C9            		RET
                      	
  DA0B                	CTRL0D:
  DA0B  CDD3EC        		CALL	_POS
  DA0E  2E00          		LD	L,0
  DA10                	LOC:
  DA10  C5            		PUSH	BC
  DA11  E5            		PUSH	HL
  DA12  CD53D9        		CALL	KANCLR
  DA15  CD31DA        		CALL	LOC1
  DA18  228EEC        		LD	(_TXADR),HL
  DA1B  E1            		POP	HL
  DA1C  C1            		POP	BC
  DA1D  C9            		RET
                      	
  DA1E                	CTRL01:
  DA1E  3E37          		LD	A,037H		;SCF
  DA20  32D9D8        		LD	(INSFLG),A
  DA23  C9            		RET
                      	
  DA24                	CTRL0B:
  DA24  210000        		LD	HL,0
  DA27  228EEC        		LD	(_TXADR),HL
  DA2A  C9            		RET
                      	
  DA2B                	CTRL1B:
  DA2B  3E01          		LD	A,1
  DA2D  32D0D8        		LD	(ESCFLG+1),A
  DA30  C9            		RET
                      	
  DA31                	LOC1:
  DA31  D5            		PUSH	DE
  DA32  4D            		LD	C,L
  DA33  0608          		LD	B,8
  DA35  5C            		LD	E,H
  DA36  1600          		LD	D,0
  DA38  2AB0EC        		LD	HL,(CRTCD)
  DA3B  6A            		LD	L,D
  DA3C                	LOC2:
  DA3C  29            		ADD	HL,HL
  DA3D  3001          		JR	NC,LOC3
  DA3F  19            		ADD	HL,DE
  DA40                	LOC3:
  DA40  10FA          		DJNZ	LOC2
  DA42  09            		ADD	HL,BC
  DA43  D1            		POP	DE
  DA44  C9            		RET
                      	
  DA45                	CONOUT1:
  DA45  CD57DA        		CALL	CURSOR
  DA48  59            		LD	E,C
  DA49  CDCDEC        		CALL	_PRINT
  DA4C  7B            		LD	A,E
  DA4D  FE0A          		CP	00AH
  DA4F  2006          		JR	NZ,CURSOR
  DA51  CD0BDA        		CALL	CTRL0D
  DA54  CDE7D9        		CALL	CTRL05
  DA57                	CURSOR:
  DA57  C5            		PUSH	BC
  DA58  ED4B8EEC      		LD	BC,(_TXADR)
  DA5C  CBE8          		SET	5,B
  DA5E  ED78          		IN	A,(C)
  DA60  EE18          		XOR	018H
  DA62  ED79          		OUT	(C),A
  DA64  C1            		POP	BC
  DA65  C9            		RET
                      	
  DA66                	CTRL07:
  DA66  2161EB        		LD	HL,BEEPD
  DA69                	BEEP1:
  DA69  7E            		LD	A,(HL)
  DA6A  23            		INC	HL
  DA6B  FEFF          		CP	0FFH
  DA6D  C8            		RET	Z
  DA6E  F3            		DI
  DA6F  061C          		LD	B,01CH
  DA71  ED79          		OUT	(C),A
  DA73  EDA3          		OUTI
  DA75  FB            		EI
  DA76  18F1          		JR	BEEP1
                      	
  DA78                	OT49SB:
  DA78  C5            		PUSH	BC
  DA79  CD94DA        		CALL	CANW
  DA7C  010019        		LD	BC,01900H
  DA7F  ED79          		OUT	(C),A
  DA81  C1            		POP	BC
  DA82  C9            		RET
                      	
  DA83                	IN49SB:
  DA83  C5            		PUSH	BC
  DA84  01011A        		LD	BC,01A01H
  DA87                	CANR:
  DA87  ED78          		IN	A,(C)
  DA89  E620          		AND	020H
  DA8B  20FA          		JR	NZ,CANR
  DA8D  010019        		LD	BC,01900H
  DA90  ED78          		IN	A,(C)
  DA92  C1            		POP	BC
  DA93  C9            		RET
                      	
  DA94                	CANW:
  DA94  01011A        		LD	BC,01A01H
  DA97  ED48          		IN	C,(C)
  DA99  CB71          		BIT	6,C
  DA9B  20F7          		JR	NZ,CANW
  DA9D  C9            		RET
                      	
  DA9E                	COMOUT:
  DA9E  FB            		EI
  DA9F  CD78DA        		CALL	OT49SB
  DAA2  CD94DA        		CALL	CANW
  DAA5  F3            		DI
  DAA6  C9            		RET
                      	
  DAA7                	CTRL12:
  DAA7  D5            		PUSH	DE
  DAA8  CDD3EC        		CALL	_POS
  DAAB  3AB1EC        		LD	A,(CRTCD+1)
  DAAE  95            		SUB	L
  DAAF  ED4B8EEC      		LD	BC,(_TXADR)
  DAB3  110020        		LD	DE,02000H	;D:Text E:Kanji
  DAB6  2A96EC        		LD	HL,(_COLORF)	;L:Color
  DAB9  CBE8          		SET	5,B
  DABB                	C12X1:
  DABB  CDC3DA        		CALL	C12S
  DABE  03            		INC	BC
  DABF  20FA          		JR	NZ,C12X1
  DAC1  D1            		POP	DE
  DAC2  C9            		RET
                      	
  DAC3                	C12S:
  DAC3  CBE0          		SET	4,B
  DAC5  CBD8          		SET	3,B
  DAC7  ED60          		IN	H,(C)
  DAC9  ED59          	X1PAT:	OUT	(C),E
  DACB  5C            		LD	E,H
  DACC  CB98          		RES	3,B
  DACE  ED60          		IN	H,(C)
  DAD0  ED51          		OUT	(C),D
  DAD2  54            		LD	D,H
  DAD3  CBA0          		RES	4,B
  DAD5  ED60          		IN	H,(C)
  DAD7  ED69          		OUT	(C),L
  DAD9  6C            		LD	L,H
  DADA  3D            		DEC	A
  DADB  C9            		RET
                      	
  DADC                	CTRL0C:
  DADC  CD24DA        		CALL	CTRL0B
  DADF                	CTRL06:
  DADF  ED4B8EEC      		LD	BC,(_TXADR)
  DAE3                	C1AX1:
  DAE3  78            		LD	A,B
  DAE4  F638          		OR	038H
  DAE6  47            		LD	B,A
  DAE7  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令	kanji
  DAE9  CB98          		RES	3,B
  DAEB  3E20          		LD	A,020H
  DAED  ED79          		OUT	(C),A		;Text
  DAEF  CBA0          		RES	4,B
  DAF1  3A96EC        		LD	A,(_COLORF)
  DAF4  ED79          		OUT	(C),A		;Color
  DAF6  03            		INC	BC
  DAF7  CBA8          		RES	5,B
  DAF9  2ABAEC        		LD	HL,(CRTCD+10)
  DAFC  09            		ADD	HL,BC
  DAFD  30E4          		JR	NC,C1AX1
  DAFF  C9            		RET
                      	
  DB00                	CTRL04:
  DB00  CDD3EC        		CALL	_POS
  DB03  7D            		LD	A,L
  DB04  B7            		OR	A
  DB05  C8            		RET	Z
  DB06                	CTRL03:
  DB06  CD0BDA        		CALL	CTRL0D
  DB09                	CTRL0A:
  DB09                	CTRL1F:
  DB09  ED4B8EEC      		LD	BC,(_TXADR)
  DB0D  2AB1EC        		LD	HL,(CRTCD+1)
  DB10  2600          		LD	H,0
  DB12  09            		ADD	HL,BC
  DB13  44            		LD	B,H
  DB14  4D            		LD	C,L
  DB15  2ABAEC        		LD	HL,(CRTCD+10)
  DB18  09            		ADD	HL,BC
  DB19  3F            		CCF
  DB1A  9F            		SBC	A,A
  DB1B  C37ED9        		JP	PRINTE8
                      	
  DB1E                	CTRL0E:
  DB1E  CDD3EC        		CALL	_POS
  DB21  7C            		LD	A,H
  DB22  1804          		JR	SCR1
  DB24                	SCR:
  DB24  3A97EC        		LD	A,(_LINE)
  DB27  3D            		DEC	A
  DB28                	SCR1:
  DB28  C5            		PUSH	BC
  DB29  D5            		PUSH	DE
  DB2A  F5            		PUSH	AF
  DB2B  3E07          		LD	A,7
  DB2D  215EDB        		LD	HL,SCRDMAD
  DB30  CD54DB        		CALL	SETDMA
  DB33  F1            		POP	AF
  DB34  210038        		LD	HL,03800H
                      	
  DB37                	SCRUP1:
  DB37  B7            		OR	A
  DB38  284D          		JR	Z,SCRCL
  DB3A  F5            		PUSH	AF
  DB3B  CD65DB        		CALL	UPSUB		;kanji
  DB3E  3ABCEC        		LD	A,(CRTCD+12)
  DB41  5F            		LD	E,A
  DB42  16F7          		LD	D,0F7H
  DB44  19            		ADD	HL,DE
  DB45  D5            		PUSH	DE
  DB46  CD65DB        		CALL	UPSUB		;Text
  DB49  D1            		POP	DE
  DB4A  19            		ADD	HL,DE
  DB4B  CD65DB        		CALL	UPSUB		;Color
  DB4E  CBE4          		SET	4,H
  DB50  F1            		POP	AF
  DB51  3D            		DEC	A
  DB52  18E3          		JR	SCRUP1
                      	
  DB54                	SETDMA:
  DB54  01871F        		LD	BC,01F87H
  DB57                	SDMA:
  DB57  04            		INC	B
  DB58  EDA3          		OUTI
  DB5A  3D            		DEC	A
  DB5B  20FA          		JR	NZ,SDMA
  DB5D  C9            		RET
                      	
  DB5E                	SCRDMAD:
  DB5E  C3            		DB	0C3H		;WR6 リセット
  DB5F  9A            		DB	09AH		;WR5 ストップ WAIT READY:HIGH
  DB60  65            		DB	065H		;WR0 ブロック長(LH)
  DB61  4F00          		DW	79
  DB63  1C            		DB	01CH		;WR1 ポートAインクリメント I/O
  DB64  18            		DB	018H		;WR0 ポートAアドレス(LH)
                      	
  DB65                	UPSUB:
  DB65  3AB1EC        		LD	A,(CRTCD+1)
  DB68  5F            		LD	E,A
  DB69  1600          		LD	D,0
  DB6B  3ECD          		LD	A,0CDH		;WR4 バースト ポートB開始アドレス(LH)
  DB6D  ED79          		OUT	(C),A
  DB6F  ED69          		OUT	(C),L		;SOURCE
  DB71  ED61          		OUT	(C),H
  DB73  19            		ADD	HL,DE
  DB74  3E1D          		LD	A,01DH		;WR0 ポートA開始アドレス(LH) ポートA→ポートB 転送
  DB76  ED79          		OUT	(C),A
  DB78  ED69          		OUT	(C),L		;DEST
  DB7A  ED61          		OUT	(C),H
  DB7C                	GO_DMA:
  DB7C  3ECF          		LD	A,0CFH
  DB7E  ED79          		OUT	(C),A		;WR6 ロード
  DB80  3EB3          		LD	A,0B3H
  DB82  ED79          		OUT	(C),A		;WR6 強制RDY
  DB84  ED49          		OUT	(C),C		;WR6 イネーブル
  DB86  C9            		RET
                      	
  DB87                	SCRCL:
  DB87  44            		LD	B,H
  DB88  4D            		LD	C,L
  DB89  215020        		LD	HL,02000H+80
  DB8C  3A96EC        		LD	A,(_COLORF)
  DB8F                	SCRCL1:
  DB8F  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  DB91  CB98          		RES	3,B
  DB93  ED61          		OUT	(C),H
  DB95  CBA0          		RES	4,B
  DB97  ED79          		OUT	(C),A
  DB99  CBD8          		SET	3,B
  DB9B  CBE0          		SET	4,B
  DB9D  03            		INC	BC
  DB9E  2D            		DEC	L
  DB9F  20EE          		JR	NZ,SCRCL1
  DBA1  D1            		POP	DE
  DBA2  C1            		POP	BC
  DBA3  C9            		RET
                      	
  DBA4                	SCRN:
  DBA4  D5            		PUSH	DE
  DBA5  ED58          		IN	E,(C)		;Text
  DBA7  CBD8          		SET	3,B
  DBA9  ED50          		IN	D,(C)		;Kanji
  DBAB  2819          		JR	Z,SCRNE
  DBAD  AF            		XOR	A
  DBAE  C5            		PUSH	BC
  DBAF  013730        		LD	BC,03037H	;VRMJIS
  DBB2  DF            		RST	018H
  DBB3  01522F        		LD	BC,02F52H	;JISSFT
  DBB6  DF            		RST	018H
  DBB7  C1            		POP	BC
  DBB8  ED78          		IN	A,(C)
  DBBA  CB98          		RES	3,B
  DBBC  E640          		AND	040H
  DBBE  2003          		JR	NZ,SCRN1
  DBC0  7A            		LD	A,D
  DBC1  D1            		POP	DE
  DBC2  C9            		RET
  DBC3                	SCRN1:
  DBC3  7B            		LD	A,E
  DBC4  D1            		POP	DE
  DBC5  C9            		RET
                      	
  DBC6                	SCRNE:
  DBC6  D1            		POP	DE
  DBC7  CB98          		RES	3,B
  DBC9                	SCRNX:
  DBC9  ED78          		IN	A,(C)
  DBCB  C9            		RET
                      	
  DBCC                	POS:
  DBCC  2A8EEC        		LD	HL,(_TXADR)
  DBCF  C5            		PUSH	BC
  DBD0  ED4BBCEC      		LD	BC,(CRTCD+12)
  DBD4  AF            		XOR	A
  DBD5                	POS1:
  DBD5  09            		ADD	HL,BC
  DBD6  3C            		INC	A
  DBD7  38FC          		JR	C,POS1
  DBD9  ED42          		SBC	HL,BC
  DBDB  3D            		DEC	A
  DBDC  67            		LD	H,A
  DBDD  C1            		POP	BC
  DBDE  A7            		AND	A
  DBDF  C9            		RET
                      	
  DBE0                	GETL:
  DBE0  CDD3EC        		CALL	_POS
  DBE3  E5            		PUSH	HL
  DBE4                	GETL1:
  DBE4  CD92D7        		CALL	_SYS08
  DBE7  FE09          		CP	9
  DBE9  2008          		JR	NZ,GETL1V
  DBEB  2100FF        		LD	HL,KBUF
  DBEE  CDB3D3        		CALL	MSX
  DBF1  18F1          		JR	GETL1
  DBF3                	GETL1V:
  DBF3  FE08          		CP	8
  DBF5  2002          		JR	NZ,GETL1X
  DBF7  3E02          		LD	A,2
  DBF9                	GETL1X:
  DBF9  5F            		LD	E,A
  DBFA  CD1EDA        		CALL	CTRL01
  DBFD  CDCDEC        		CALL	_PRINT
                      	
  DC00  7B            		LD	A,E
  DC01  FE0D          		CP	00DH
  DC03  20DF          		JR	NZ,GETL1
                      	
  DC05  1100FF        		LD	DE,KBUF
  DC08  3AB1EC        		LD	A,(CRTCD+1)
  DC0B  47            		LD	B,A
  DC0C  CD5DD0        		CALL	ZERO_MEMORY_DE
                      	
  DC0F  D1            		POP	DE
  DC10  CDD3EC        		CALL	_POS
  DC13  6B            		LD	L,E
  DC14  3AB1EC        		LD	A,(CRTCD+1)
  DC17  95            		SUB	L
  DC18  57            		LD	D,A
  DC19  CD31DA        		CALL	LOC1
  DC1C  4D            		LD	C,L
  DC1D  7C            		LD	A,H
  DC1E  F630          		OR	030H
  DC20  47            		LD	B,A
  DC21  5A            		LD	E,D
  DC22  2100FF        		LD	HL,KBUF
  DC25                	GETL2:
  DC25  CDD0EC        		CALL	_SCRN
  DC28  03            		INC	BC
  DC29  77            		LD	(HL),A
  DC2A  23            		INC	HL
  DC2B  1D            		DEC	E
  DC2C  20F7          		JR	NZ,GETL2
  DC2E                	GETL3:
  DC2E  2B            		DEC	HL
  DC2F  7E            		LD	A,(HL)
  DC30  FE21          		CP	021H
  DC32  D0            		RET	NC
  DC33  3600          		LD	(HL),0
  DC35  15            		DEC	D
  DC36  20F6          		JR	NZ,GETL3
  DC38  C9            		RET
                      	
  DC39                	INKEY:
  DC39  FB            		EI
  DC3A  E5            		PUSH	HL
  DC3B  2A90EC        		LD	HL,(_KEYPS)
  DC3E  7C            		LD	A,H
  DC3F  AD            		XOR	L
  DC40  2809          		JR	Z,INKEY1
  DC42  7C            		LD	A,H
  DC43  3C            		INC	A
  DC44  3291EC        		LD	(_KEYPS+1),A
  DC47  6F            		LD	L,A
  DC48  26FE          		LD	H,KEYBF/256
  DC4A  7E            		LD	A,(HL)
  DC4B                	INKEY1:
  DC4B  E1            		POP	HL
  DC4C  B7            		OR	A
  DC4D  C9            		RET
                      	
  1104                	AT_RS	EQU	SCR1-AT_SCR1
                      	
                      	;LDFILE.ASM
                      	
                      	;	LSX-Dodgers FILE
                      	
  DC4E                	FILEC:
  DC4E  CD59DC        		CALL	FILE
  DC51                	FILEC2:
  DC51  3A15EB        		LD	A,(FDRV+1)
  DC54  FE20          		CP	020H
  DC56  C8            		RET	Z
  DC57  1839          		JR	SETDIR1
                      	
  DC59                	FILE:
  DC59  AF            		XOR	A
  DC5A  3214EB        		LD	(FDRV),A
  DC5D  67            		LD	H,A
  DC5E  6F            		LD	L,A
  DC5F  2222EB        		LD	(FDRV+14),HL
  DC62  CD30DD        		CALL	SPCUT
  DC65  CD15DD        		CALL	CCHK3
  DC68  2812          		JR	Z,DEVI1
  DC6A  13            		INC	DE
  DC6B  1A            		LD	A,(DE)
  DC6C  1B            		DEC	DE
  DC6D  FE3A          		CP	':'
  DC6F  200B          		JR	NZ,DEVI1
  DC71  1A            		LD	A,(DE)		;DRIVE
  DC72  CD79DF        		CALL	CAP
  DC75  D640          		SUB	'@'
  DC77  13            		INC	DE
  DC78  13            		INC	DE
  DC79  3214EB        		LD	(FDRV),A
  DC7C                	DEVI1:
  DC7C  1A            		LD	A,(DE)
  DC7D  D65C          		SUB	05CH		;\
  DC7F  2009          		JR	NZ,NOROOT
  DC81  6F            		LD	L,A		;A=0でH=0のはずなのでHL=0
  DC82  222EEB        		LD	(FDRV+26),HL
  DC85  2C            		INC	L
  DC86  2222EB        		LD	(FDRV+14),HL
  DC89  13            		INC	DE
  DC8A                	NOROOT:
                      	
  DC8A                	SETDIR:
  DC8A  CDB6DC        		CALL	FILED
  DC8D  1A            		LD	A,(DE)
  DC8E  FE5C          		CP	05CH		;\
  DC90  C0            		RET	NZ
  DC91  13            		INC	DE
  DC92                	SETDIR1:
  DC92  3E10          		LD	A,010H		;Directory
  DC94  3221EB        		LD	(FDRV+13),A
  DC97  D5            		PUSH	DE
  DC98  1114EB        		LD	DE,FDRV
  DC9B  2A1EEC        		LD	HL,(STABLE+2*00FH)
  DC9E  CD0F00        		CALL	JP_HL
  DCA1  D1            		POP	DE
  DCA2  B7            		OR	A
  DCA3  C0            		RET	NZ
                      	
  DCA4  3A21EB        		LD	A,(FDRV+13)
  DCA7  CB67          		BIT	4,A
  DCA9  C8            		RET	Z
                      	
  DCAA  CDFDDC        		CALL	FILEI
  DCAD  2A2EEB        		LD	HL,(FDRV+26)
  DCB0  23            		INC	HL
  DCB1  2222EB        		LD	(FDRV+14),HL
  DCB4  18D4          		JR	SETDIR
                      	
  DCB6                	FILED:
  DCB6  CDFDDC        		CALL	FILEI
  DCB9  2115EB        		LD	HL,FNAME
                      	
  DCBC  0608          		LD	B,8
  DCBE                	FILE2:
  DCBE  CD0ADD        		CALL	CCHKF
  DCC1  C8            		RET	Z
  DCC2  FE2A          		CP	'*'
  DCC4  282E          		JR	Z,FILE9
  DCC6  FE2E          		CP	'.'
  DCC8  280C          		JR	Z,FILE4
  DCCA  77            		LD	(HL),A
  DCCB  23            		INC	HL
  DCCC  10F0          		DJNZ	FILE2
                      	
  DCCE                	FILE3:
  DCCE  CD0ADD        		CALL	CCHKF
  DCD1  C8            		RET	Z
  DCD2  FE2E          		CP	'.'
  DCD4  20F8          		JR	NZ,FILE3
                      	
  DCD6                	FILE4:
  DCD6  211DEB        		LD	HL,FNAME+8
  DCD9  0603          		LD	B,3
                      	
  DCDB                	FILE4L:
  DCDB  CD0ADD        		CALL	CCHKF
  DCDE  C8            		RET	Z
  DCDF  FE2E          		CP	'.'
  DCE1  2008          		JR	NZ,FILE12
  DCE3  3215EB        		LD	(FNAME),A	;Parent directory(..)
  DCE6  3216EB        		LD	(FNAME+1),A
  DCE9  3E20          		LD	A,020H
  DCEB                	FILE12:
  DCEB  FE2A          		CP	'*'
  DCED  280A          		JR	Z,FILE10
  DCEF  77            		LD	(HL),A
  DCF0  23            		INC	HL
  DCF1  10E8          		DJNZ	FILE4L
  DCF3  C9            		RET
                      	
  DCF4                	FILE9:				;名前の*処理、名前の残りを?で埋める
  DCF4  CDF9DC        		CALL	FILE10
  DCF7  18D5          		JR	FILE3
                      	
  DCF9                	FILE10:
  DCF9  3E3F          		LD	A,'?'
  DCFB  1808          		JR	FILL_MEMORY
  DCFD                	FILEI:				;名前＋拡張子をスペースで初期化
  DCFD  3E20          		LD	A,020H
  DCFF  01000B        		LD	BC,11*256	;C=0にしておく
  DD02  2115EB        		LD	HL,FNAME
  DD05                	FILL_MEMORY:			;HLからBバイトAで埋める
  DD05  77            		LD	(HL),A
  DD06  23            		INC	HL
  DD07  10FC          		DJNZ	FILL_MEMORY
  DD09  C9            		RET
                      	
  DD0A                	CCHKF:
  DD0A  1A            		LD	A,(DE)
  DD0B  CD12DD        		CALL	CCHK2
  DD0E  C8            		RET	Z
  DD0F  C397E0        		JP	FKAN
                      	
  DD12                	CCHK2:
  DD12  0C            		INC	C
  DD13  0D            		DEC	C
  DD14  C0            		RET	NZ
  DD15                	CCHK3:				;ZF=1 で使えない文字
  DD15  FE2B          		CP	'+'
  DD17  C8            		RET	Z
  DD18  FE2C          		CP	','
  DD1A  C8            		RET	Z
  DD1B  FE2F          		CP	'/'
  DD1D  C8            		RET	Z
  DD1E  FE3A          		CP	':'
  DD20  C8            		RET	Z
  DD21  FE3B          		CP	';'
  DD23  C8            		RET	Z
  DD24  FE3D          		CP	'='
  DD26  C8            		RET	Z
  DD27  FE5C          		CP	05CH	;\
  DD29  C8            		RET	Z
  DD2A  FE20          		CP	020H
  DD2C  D0            		RET	NC
  DD2D  BF            		CP	A		;Z=1
  DD2E  C9            		RET
                      	
  DD2F                	SS1:
  DD2F  13            		INC	DE
  DD30                	SPCUT:				;スペースをカット
  DD30  1A            		LD	A,(DE)
  DD31  FE20          		CP	020H
  DD33  28FA          		JR	Z,SS1
  DD35  C9            		RET
                      	
  DD36                	SETDRVF:
  DD36  1114EB        		LD	DE,FDRV
  DD39                	SETDRV0:
  DD39  CD42DD        		CALL	SETDRV
  DD3C  FDE1          		POP	IY
  DD3E  C1            		POP	BC
  DD3F  D1            		POP	DE
  DD40  E1            		POP	HL
  DD41  C9            		RET
                      	
  DD42                	SETDRV:
  DD42  E3            		EX	(SP),HL		;HL=RETRN ADDRESS
  DD43  D5            		PUSH	DE		;PUSH HL/DE/BC/IY
  DD44  C5            		PUSH	BC
  DD45  1A            		LD	A,(DE)
  DD46  D5            		PUSH	DE
  DD47  FDE3          		EX	(SP),IY
                      	
  DD49  CD55DD        		CALL	GETDRV
  DD4C  3C            		INC	A
  DD4D  FD7700        		LD	(IY+0),A	;(FCB)ドライブ番号
  DD50  3D            		DEC	A
  DD51  CDD9EC        		CALL	_CHGDRV
                      	
  DD54  E9            		JP	(HL)
                      	
  DD55                	GETDRV:
  DD55  E67F          		AND	07FH
  DD57  D601          		SUB	001H
  DD59  3003          		JR	NC,GETDRV1
  DD5B  3A87EC        		LD	A,(_DVSW)	;Current Drive
  DD5E                	GETDRV1:
  DD5E  3288EC        		LD	(_DRV),A
  DD61  C9            		RET
                      	
  DD62                	SOPENX:
  DD62  CDE4DE        		CALL	CHKDDX
  DD65  3802          		JR	C,SOPENX1
  DD67  C1            		POP	BC
  DD68  E9            		JP	(HL)
  DD69                	SOPENX1:
  DD69  1139EB        		LD	DE,SFILE
  DD6C  1A            		LD	A,(DE)
  DD6D  FDBE00        		CP	(IY+0)		;(FCB)ドライブ番号
  DD70  2024          		JR	NZ,SOPEN
  DD72  13            		INC	DE
  DD73  FDE5          		PUSH	IY
  DD75  E1            		POP	HL
  DD76  23            		INC	HL
  DD77  CD11DF        		CALL	CPFILE
  DD7A  201A          		JR	NZ,SOPEN
                      	
  DD7C  2AF4EB        		LD	HL,(SCDIR)
  DD7F  FD750E        		LD	(IY+14),L	;(FCB)アクセスするディレクトリのクラスタ番号+1
  DD82  FD740F        		LD	(IY+15),H
                      	
  DD85  2AF8EB        		LD	HL,(SFNDF)	;Direcroty location and Flags
  DD88  229FEC        		LD	(_FILEN),HL
                      	
  DD8B  ED5BF6EB      		LD	DE,(SFBPS)
  DD8F  2139EB        		LD	HL,SFILE
  DD92  36FF          		LD	(HL),0FFH
  DD94  23            		INC	HL
  DD95  C9            		RET
  DD96                	SOPEN:
  DD96  21ACDE        		LD	HL,FILESE
  DD99                	SOPENC:
  DD99  22D2DD        		LD	(OPENPAT+1),HL
                      	
  DD9C  CDE2EC        		CALL	_RDFATX		;Detect Media
  DD9F  3856          		JR	C,RDDERR
                      	
  DDA1  AF            		XOR	A
  DDA2  329FEC        		LD	(_FILEN),A
  DDA5  CDBEDF        		CALL	LDDIRX1		;A=0で呼び出す
  DDA8  2818          		JR	Z,SDIRX1
                      	
  DDAA  CD9DDE        		CALL	READ_DIR	;Sub Directory
  DDAD  3808          		JR	C,SDIRX0
  DDAF  2A7EEC        		LD	HL,(_DTBUF)
  DDB2  7E            		LD	A,(HL)
  DDB3  FE2E          		CP	'.'
  DDB5  280F          		JR	Z,SOPEN1
  DDB7                	SDIRX0:
  DDB7  AF            		XOR	A
  DDB8  32A0EC        		LD	(_DIRF),A
  DDBB  FD360E01      		LD	(IY+14),1	;(FCB)レコードサイズ
  DDBF  FD770F        		LD	(IY+15),A
  DDC2                	SDIRX1:
  DDC2  ED5BFCEB      		LD	DE,(_DIRPS)	;Root Directory
  DDC6                	SOPEN1:
  DDC6  0E20          	SDECPAT:LD	C,32		;自己書き換え 1セクタ辺りのディレクトリエントリ数  1024=32 / 512=16
  DDC8                	SOPEN1X:
  DDC8  CD9DDE        		CALL	READ_DIR	;FILE SEARCH
  DDCB  382A          		JR	C,RDDERR
  DDCD  2A7EEC        		LD	HL,(_DTBUF)
  DDD0                	SOPEN2:
  DDD0  D5            		PUSH	DE
  DDD1  CDACDE        	OPENPAT:CALL	FILESE		;(Self-rewriting)
  DDD4  D1            		POP	DE
  DDD5  386E          		JR	C,SOPENE
  DDD7  281B          		JR	Z,SCF_FF_RET
  DDD9                	SOPEN3:
  DDD9  3AA0EC        		LD	A,(_DIRF)	;ディレクトリか判別
  DDDC  B7            		OR	A
  DDDD  200C          		JR	NZ,SOPEN5
  DDDF  13            		INC	DE		;ルートディレクトリ
  DDE0  E5            		PUSH	HL
  DDE1  210C00        	MD_PAT:	LD	HL,12		;(Self-rewriting)MAXDIR
  DDE4  ED52          		SBC	HL,DE		;CF=0 なので SUB HL,DE
  DDE6  E1            		POP	HL
  DDE7  20DD          		JR	NZ,SOPEN1
  DDE9  1807          		JR	SOPEN6
  DDEB                	SOPEN5:
  DDEB  CD82E6        		CALL	GNCLX		;END DIR
  DDEE  D8            		RET	C
  DDEF  CD71DF        		CALL	ENDCL
  DDF2                	SOPEN6:
  DDF2  38D2          		JR	C,SOPEN1
  DDF4                	SCF_FF_RET:
  DDF4  37            		SCF			;CF=1
  DDF5  9F            		SBC	A,A		;A=0FFH
  DDF6  C9            		RET
                      	
  DDF7                	RDDERR:
  DDF7  BF            		CP	A		;READ ERR CF=1 ZF=1
  DDF8  37            		SCF
  DDF9  C9            		RET
                      	
  DDFA                	NOPEN:
  DDFA  21ACDE        		LD	HL,FILESE
  DDFD  22D2DD        		LD	(OPENPAT+1),HL
  DE00  FD2A98EC      		LD	IY,(_FCB)
  DE04  CDAAE0        		CALL	CHKWILDX
  DE07  30EB          		JR	NC,SCF_FF_RET
  DE09  FD7E00        		LD	A,(IY+0)	;(FCB)ドライブ番号
  DE0C  3D            		DEC	A
  DE0D  3288EC        		LD	(_DRV),A
  DE10  CDD9EC        		CALL	_CHGDRV
  DE13  D8            		RET	C
  DE14  2AF8EB        		LD	HL,(SFNDF)	;Direcroty location and Flags
  DE17  229FEC        		LD	(_FILEN),HL
                      	
  DE1A  CDB9DF        		CALL	LDDIRX
  DE1D  ED5B9AEC      		LD	DE,(_FBPS)
  DE21  CD9DDE        		CALL	READ_DIR
  DE24  38D1          		JR	C,RDDERR
  DE26  3A9EEC        		LD	A,(_FBCNT)
  DE29  3D            		DEC	A
  DE2A  28AD          		JR	Z,SOPEN3
  DE2C                	NOPEN2:
  DE2C  2A9CEC        		LD	HL,(_FBAD)
  DE2F  012000        		LD	BC,020H
  DE32  09            		ADD	HL,BC
  DE33  4F            		LD	C,A
  DE34  189A          		JR	SOPEN2
                      	
  DE36                	SOPENE2:
  DE36  229CEC        		LD	(_FBAD),HL
  DE39  79            		LD	A,C
  DE3A  329EEC        		LD	(_FBCNT),A
  DE3D  ED539AEC      		LD	(_FBPS),DE
  DE41  FD2298EC      		LD	(_FCB),IY
  DE45                	SOPENE:
  DE45  AF            		XOR	A
  DE46  C9            		RET
                      	
  DE47                	COPEN:
  DE47  FD360D20      		LD	(IY+13),020H	;(FCB)属性(アトリビュート)
                      	
  DE4B  21C9DE        		LD	HL,NEXTSE
  DE4E  CD99DD        		CALL	SOPENC
  DE51  D0            		RET	NC
  DE52  C8            		RET	Z
  DE53  3AA0EC        		LD	A,(_DIRF)	;ディレクトリか判別
  DE56  B7            		OR	A
  DE57  37            		SCF
  DE58  C8            		RET	Z		;ルートディレクトリ
  DE59  0601          		LD	B,1
  DE5B  CD06E1        		CALL	WRDF
  DE5E  D8            		RET	C
  DE5F  ED5BFEEB      		LD	DE,(_CLPS)
  DE63  D5            		PUSH	DE
  DE64  CD3ADF        		CALL	DCPAT
  DE67  CD19E5        		CALL	DRDNX
  DE6A  2A7EEC        		LD	HL,(_DTBUF)	;ディレクトリエントリを0クリア
  DE6D  3A94E4        		LD	A,(SECSZ+2)	;1024=4 / 512=2 / 256=1
  DE70  47            		LD	B,A
  DE71  AF            		XOR	A
  DE72  4F            		LD	C,A
  DE73                	COPENCL:
  DE73  77            		LD	(HL),A
  DE74  EDA1          		CPI			;HL=HL+1 BC=BC-1 BCが0の場合にP/V=0
  DE76  EA73DE        		JP	PE,COPENCL
                      	
  DE79  3A58DF        		LD	A,(SPCPAT+1)	;1クラスタの論理セクタ数
  DE7C  3D            		DEC	A
  DE7D  2819          		JR	Z,COPENE
  DE7F  3E01          		LD	A,1		;1セクタ辺りのセクタ数が2以上の場合
  DE81  327AE6        		LD	(_SECPS+1),A
  DE84  D1            		POP	DE		;DE=(_CLPS)
  DE85  D5            		PUSH	DE
  DE86                	COPEN1:
  DE86  D5            		PUSH	DE		;データバッファに入らないセクタもゼロクリア
  DE87  C5            		PUSH	BC
  DE88  2A7EEC        		LD	HL,(_DTBUF)
  DE8B  CD54DF        		CALL	CLUSTX
  DE8E  CDE8E7        		CALL	DWT24
  DE91  C1            		POP	BC
  DE92  D1            		POP	DE
  DE93  CD79E6        		CALL	NEXTX
  DE96  20EE          		JR	NZ,COPEN1
  DE98                	COPENE:
  DE98  2A7EEC        		LD	HL,(_DTBUF)
  DE9B  D1            		POP	DE
  DE9C  C9            		RET
                      	
  DE9D                	READ_DIR:
  DE9D  ED53FEEB      		LD	(_CLPS),DE
  DEA1  C5            		PUSH	BC
  DEA2  D5            		PUSH	DE
  DEA3  CD3ADF        		CALL	DCPAT
  DEA6  CDF9E4        		CALL	DRDX
  DEA9  D1            		POP	DE
  DEAA  C1            		POP	BC
  DEAB  C9            		RET
                      	
  DEAC                	FILESE:
  DEAC  7E            		LD	A,(HL)
  DEAD  B7            		OR	A
  DEAE  C8            		RET	Z		;END:ZF=1 CF=0
  DEAF  FEE5          		CP	0E5H
  DEB1  280E          		JR	Z,FILESE1
  DEB3  FDE5          		PUSH	IY
  DEB5  D1            		POP	DE
  DEB6  13            		INC	DE
  DEB7  E5            		PUSH	HL
  DEB8  CD11DF        		CALL	CPFILE
  DEBB  CC32DF        		CALL	Z,CPFILE2
  DEBE  E1            		POP	HL
  DEBF  37            		SCF
  DEC0  C8            		RET	Z		;!!!:(ZF=1) CF=1
  DEC1                	FILESE1:
  DEC1  CDD8DE        		CALL	FNEXT
  DEC4  20E6          		JR	NZ,FILESE
  DEC6                	ZF0_CF0_AFF_RET:
  DEC6  F6FF          		OR	0FFH		;ZF=0 CF=0
  DEC8  C9            		RET
                      	
  DEC9                	NEXTSE:
  DEC9  7E            		LD	A,(HL)
  DECA  B7            		OR	A
  DECB  37            		SCF
  DECC  C8            		RET	Z		;!!!:ZF=1 CF=1
  DECD  FEE5          		CP	0E5H
  DECF  37            		SCF
  DED0  C8            		RET	Z		;!!!:(ZF=1) CF=1
  DED1  CDD8DE        		CALL	FNEXT
  DED4  20F3          		JR	NZ,NEXTSE
  DED6  18EE          		JR	ZF0_CF0_AFF_RET
                      	
  DED8                	FNEXT:
  DED8  E5            		PUSH	HL
  DED9  219FEC        		LD	HL,_FILEN
  DEDC  34            		INC	(HL)
  DEDD  E1            		POP	HL
  DEDE  112000        		LD	DE,020H
  DEE1  19            		ADD	HL,DE
  DEE2  0D            		DEC	C
  DEE3  C9            		RET
                      	
  DEE4                	CHKDDX:
  DEE4  CDAAE0        		CALL	CHKWILDX
  DEE7  D8            		RET	C
  DEE8  FDE5          		PUSH	IY
  DEEA  D1            		POP	DE
  DEEB  13            		INC	DE
  DEEC  2162EC        		LD	HL,DDTB
  DEEF  0604          		LD	B,DDS
  DEF1                	CPNAME:
  DEF1  C5            		PUSH	BC
  DEF2  D5            		PUSH	DE
  DEF3  E5            		PUSH	HL
  DEF4  CD0BDF        		CALL	CPFILE4
  DEF7  E1            		POP	HL
  DEF8  23            		INC	HL
  DEF9  23            		INC	HL
  DEFA  23            		INC	HL
  DEFB  23            		INC	HL
  DEFC  D1            		POP	DE
  DEFD  C1            		POP	BC
  DEFE  2005          		JR	NZ,CPNAME1
  DF00  7E            		LD	A,(HL)
  DF01  23            		INC	HL
  DF02  66            		LD	H,(HL)
  DF03  6F            		LD	L,A
  DF04  C9            		RET
  DF05                	CPNAME1:
  DF05  23            		INC	HL
  DF06  23            		INC	HL
  DF07  10E8          		DJNZ	CPNAME
  DF09  37            		SCF
  DF0A  C9            		RET
                      	
  DF0B                	CPFILE4:
  DF0B  C5            		PUSH	BC
  DF0C  010004        		LD	BC,00400H
  DF0F  1804          		JR	CPSTR1
  DF11                	CPFILE:
  DF11  C5            		PUSH	BC
  DF12  01000B        		LD	BC,00B00H
  DF15                	CPSTR1:
  DF15  1A            		LD	A,(DE)
  DF16  FE3F          		CP	'?'		;Wild card
  DF18  2812          		JR	Z,CPSTR2
  DF1A  7E            		LD	A,(HL)
  DF1B  CD90E0        		CALL	FKANC
  DF1E  E5            		PUSH	HL
  DF1F  67            		LD	H,A
  DF20  1A            		LD	A,(DE)
  DF21  CB01          		RLC	C
  DF23  CD90E0        		CALL	FKANC
  DF26  CB09          		RRC	C
  DF28  BC            		CP	H		;CP (HL),(DE)
  DF29  E1            		POP	HL
  DF2A  2004          		JR	NZ,CPSTR3
  DF2C                	CPSTR2:
  DF2C  13            		INC	DE
  DF2D  23            		INC	HL
  DF2E  10E5          		DJNZ	CPSTR1
  DF30                	CPSTR3:
  DF30  C1            		POP	BC
  DF31  C9            		RET
                      	
  DF32                	CPFILE2:
  DF32  FD7E0D        		LD	A,(IY+13)	;(FCB)属性(アトリビュート)
  DF35  F6E1          		OR	0E1H
  DF37  2F            		CPL
  DF38  A6            		AND	(HL)
  DF39  C9            		RET
                      	
  DF3A                	DCPAT:
  DF3A  0E00          		LD	C,0
  DF3C  2A7EEC        		LD	HL,(_DTBUF)
  DF3F  3AA0EC        		LD	A,(_DIRF)	;ディレクトリか判別
  DF42  B7            		OR	A
  DF43  C8            		RET	Z		;ルートディレクトリの場合はCレジスタを0にしておく(CDEがセクタ番号)
  DF44  3A58DF        		LD	A,(SPCPAT+1)
  DF47  4F            		LD	C,A
  DF48  3A7AE6        		LD	A,(_SECPS+1)
  DF4B  B9            		CP	C
  DF4C  3801          		JR	C,DC1
  DF4E  AF            		XOR	A
  DF4F                	DC1:
  DF4F  F680          		OR	080H
  DF51  32A0EC        		LD	(_DIRF),A	;bit0-6:セクタインデックス
  DF54                	CLUSTX:
  DF54  E5            		PUSH	HL
  DF55  EB            		EX	DE,HL
  DF56  AF            		XOR	A
  DF57  0E01          	SPCPAT:	LD	C,1		;自己書き換え（1クラスタの論理セクタ数）
  DF59                	L_CLDBL:
  DF59  CB19          		RR	C		;->CF
  DF5B  3804          		JR	C,E_CLDBL
  DF5D  29            		ADD	HL,HL		;*2
  DF5E  8F            		ADC	A,A
  DF5F  18F8          		JR	L_CLDBL
  DF61                	E_CLDBL
  DF61  4F            		LD	C,A
  DF62  3A7AE6        		LD	A,(_SECPS+1)
  DF65  B5            		OR	L
  DF66  6F            		LD	L,A
  DF67  110800        	CLSPAT:	LD	DE,8	;+8 (2D)  !ADDCL (Self-rewriting)
  DF6A  AF            		XOR	A
  DF6B  19            		ADD	HL,DE	;データ格納領域の先頭論理セクタ番号
  DF6C  89            		ADC	A,C
  DF6D  4F            		LD	C,A
  DF6E  EB            		EX	DE,HL
  DF6F  E1            		POP	HL
  DF70  C9            		RET
                      	
  DF71                	ENDCL:
  DF71  7A            		LD	A,D	;END CLUSTER
  DF72  FE01          	CLPAT1:	CP	1	;164=356	(Self-rewriting)
  DF74  C0            		RET	NZ
  DF75  7B            		LD	A,E
  DF76  FE64          	CLPAT2:	CP	064H	;		(Self-rewriting)
  DF78  C9            		RET
                      	
  DF79                	CAP:
  DF79  FE61          		CP	'a'
  DF7B  D8            		RET	C
  DF7C  FE7B          		CP	'z'+1
  DF7E  D0            		RET	NC
  DF7F  D620          		SUB	020H
  DF81  C9            		RET
  DF82                	CAP2:
  DF82  CD79DF        		CALL	CAP
  DF85                	CAP3:
  DF85  CD8EDF        		CALL	CAP4
  DF88  FE21          		CP	021H
  DF8A  D0            		RET	NC
  DF8B  3EA0          		LD	A,0A0H
  DF8D  C9            		RET
  DF8E                	CAP4:
  DF8E  FE05          		CP	5
  DF90  C0            		RET	NZ
  DF91  3EE5          		LD	A,0E5H
  DF93  C9            		RET
                      	
  DF94                	CHDIR:
  DF94  CD33E9        		CALL	GETDPBD
  DF97  381D          		JR	C,CHDIR2
  DF99  DD751A        		LD	(IX+01AH),L		;_SDIR_
  DF9C  DD741B        		LD	(IX+01BH),H		;_SDIR_+1
  DF9F  1815          		JR	CHDIR2		;POP_IX_RET
                      	
  DFA1                	LDDIR:
  DFA1  CD33E9        		CALL	GETDPBD
  DFA4  DD5E1A        		LD	E,(IX+01AH)		;_SDIR_
  DFA7  DD561B        		LD	D,(IX+01BH)		;_SDIR_+1
  DFAA  13            		INC	DE
  DFAB  FD730E        		LD	(IY+14),E	;(FCB)アクセスするディレクトリのクラスタ番号+1
  DFAE  FD720F        		LD	(IY+15),D
  DFB1  1B            		DEC	DE
  DFB2  AF            		XOR	A
  DFB3  32A0EC        		LD	(_DIRF),A
  DFB6                	CHDIR2:
  DFB6  DDE1          		POP	IX
  DFB8  C9            		RET
                      	
  DFB9                	LDDIRX:
  DFB9  3AA0EC        		LD	A,(_DIRF)	;(FCB)アクセスするディレクトリのセクタインデックス
  DFBC  E67F          		AND	07FH
  DFBE                	LDDIRX1:
  DFBE  327AE6        		LD	(_SECPS+1),A
  DFC1  FD5E0E        		LD	E,(IY+14)	;(FCB)アクセスするディレクトリのクラスタ番号+1
  DFC4  FD560F        		LD	D,(IY+15)
  DFC7  1B            		DEC	DE
  DFC8  CD71DF        		CALL	ENDCL
  DFCB  D4A1DF        		CALL	NC,LDDIR
  DFCE                	LDDIRS:
  DFCE  7A            		LD	A,D
  DFCF  B3            		OR	E
  DFD0  32A0EC        		LD	(_DIRF),A	;ディレクトリか判別
  DFD3  C9            		RET
                      	
  DFD4                	KILL:
  DFD4  CDAAE0        		CALL	CHKWILDX
  DFD7  383A          		JR	C,KILLW
  DFD9  CDE4DE        		CALL	CHKDDX
  DFDC  3F            		CCF
  DFDD  D469DD        		CALL	NC,SOPENX1
  DFE0                	KILLS:
  DFE0  3E1F          		LD	A,01FH
  DFE2  D426E0        		CALL	NC,CHKATT
  DFE5  D8            		RET	C
  DFE6                	KILLSX:
  DFE6  36E5          		LD	(HL),0E5H	;DIR
  DFE8  CD84E0        		CALL	WTDB
  DFEB  111A00        		LD	DE,01AH
  DFEE  19            		ADD	HL,DE
  DFEF  5E            		LD	E,(HL)
  DFF0  23            		INC	HL
  DFF1  56            		LD	D,(HL)
  DFF2  1804          		JR	KILLS2
  DFF4                	KILLS1:
  DFF4  ED5BFEEB      		LD	DE,(_CLPS)	;FAT
  DFF8                	KILLS2:
  DFF8  CD71DF        		CALL	ENDCL
  DFFB  D0            		RET	NC		;CF=0
  DFFC  21FEFF        		LD	HL,0-2
  DFFF  19            		ADD	HL,DE
  E000  D0            		RET	NC		;DE= 0 or 1
  E001  D5            		PUSH	DE
  E002  CDF7EC        		CALL	_GNCL
  E005  ED53FEEB      		LD	(_CLPS),DE
  E009  D1            		POP	DE
  E00A  210000        		LD	HL,0
  E00D  D4FAEC        		CALL	NC,_SNCL
  E010  30E2          		JR	NC,KILLS1
  E012  C9            		RET
                      	
  E013                	KILLW:
  E013  CD96DD        		CALL	SOPEN
  E016                	KILLW1:
  E016  380B          		JR	C,KILLW2
  E018  CD36DE        		CALL	SOPENE2
  E01B  CDE0DF        		CALL	KILLS
  E01E  CDFADD        		CALL	NOPEN
  E021  18F3          		JR	KILLW1
  E023                	KILLW2:
  E023  C8            		RET	Z
  E024  3F            		CCF
  E025  C9            		RET
                      	
  E026                	CHKATT:
  E026  E5            		PUSH	HL
  E027  110B00        		LD	DE,00BH
  E02A  19            		ADD	HL,DE
  E02B  A6            		AND	(HL)
  E02C  E1            		POP	HL
  E02D  C8            		RET	Z
  E02E  37            		SCF
  E02F  C9            		RET
                      	
  E030                	NAME:
  E030  CDAAE0        		CALL	CHKWILDX
  E033  D8            		RET	C
  E034  110400        		LD	DE,4
  E037  19            		ADD	HL,DE
  E038  2250E0        		LD	(NAMEP+2),HL
  E03B  23            		INC	HL
  E03C  CDAEE0        		CALL	CHKWILD
  E03F  D8            		RET	C
                      	
  E040  CD69DD        		CALL	SOPENX1
  E043  3E0F          		LD	A,00FH
  E045  D426E0        		CALL	NC,CHKATT
  E048  D8            		RET	C
                      	
  E049  FD7E00        		LD	A,(IY+0)
  E04C  FDE5          		PUSH	IY
  E04E  FD210000      	NAMEP:	LD	IY,0
  E052  FD7700        		LD	(IY+0),A
  E055  CD69DD        		CALL	SOPENX1
  E058  FDE3          		EX	(SP),IY
  E05A  3F            		CCF
  E05B  D496DD        		CALL	NC,SOPEN
  E05E  EB            		EX	DE,HL
  E05F  E1            		POP	HL
  E060  D8            		RET	C
                      	
  E061                	SETNAME:
  E061  01000B        		LD	BC,11*256
  E064  23            		INC	HL
  E065  7E            		LD	A,(HL)
  E066  FEE5          		CP	0E5H
  E068  2004          		JR	NZ,SNAME1
  E06A  3E05          		LD	A,5
  E06C  180E          		JR	SNAME3
  E06E                	SNAME1:
  E06E  7E            		LD	A,(HL)
  E06F  0C            		INC	C
  E070  0D            		DEC	C
  E071  2009          		JR	NZ,SNAME3
  E073  CD79DF        		CALL	CAP
  E076  FEA0          		CP	0A0H
  E078  2002          		JR	NZ,SNAME3
  E07A  3E20          		LD	A,020H
  E07C                	SNAME3:
  E07C  12            		LD	(DE),A
  E07D  7E            		LD	A,(HL)
  E07E  23            		INC	HL
  E07F  CD97E0        		CALL	FKAN
  E082  10EA          		DJNZ	SNAME1
  E084                	WTDB:
  E084  3EFF          		LD	A,0FFH
  E086  3239EB        		LD	(SFILE),A
  E089                	SWTDBF:
  E089  3E01          		LD	A,1
  E08B  32A4EC        		LD	(_WTDBF),A
  E08E  AF            		XOR	A
  E08F  C9            		RET
                      	
  E090                	FKANC:
  E090  CB41          		BIT	0,C
  E092  CC82DF        		CALL	Z,CAP2
  E095  1801          		JR	FKANX
  E097                	FKAN:			;漢字チェック
  E097  13            		INC	DE
  E098                	FKANX:
  E098  CB41          		BIT	0,C
  E09A  CB81          		RES	0,C
  E09C  C0            		RET	NZ
  E09D  FE80          		CP	080H
  E09F  D8            		RET	C
  E0A0  FEA0          		CP	0A0H
  E0A2  3803          		JR	C,FKAN1
  E0A4  FEE0          		CP	0E0H
  E0A6  D8            		RET	C
  E0A7                	FKAN1:
  E0A7  0C            		INC	C
  E0A8  A7            		AND	A
  E0A9  C9            		RET
                      	
  E0AA                	CHKWILDX:
  E0AA  FDE5          		PUSH	IY
  E0AC  E1            		POP	HL
  E0AD  23            		INC	HL
  E0AE                	CHKWILD:
  E0AE  060B          		LD	B,11
  E0B0  3E3F          		LD	A,'?'
  E0B2                	CHKWIL1:
  E0B2  BE            		CP	(HL)
  E0B3  23            		INC	HL
  E0B4  37            		SCF
  E0B5  C8            		RET	Z
  E0B6  10FA          		DJNZ	CHKWIL1
  E0B8  AF            		XOR	A
  E0B9  C9            		RET
                      	
  E0BA                	SDIRENT:		;IY=FCB HL=DIR
  E0BA  D5            		PUSH	DE
  E0BB  E5            		PUSH	HL
  E0BC  FDE5          		PUSH	IY
  E0BE  D1            		POP	DE
  E0BF  EB            		EX	DE,HL
  E0C0  CD61E0        		CALL	SETNAME
                      	;				Attribute
  E0C3  FD7E0D        		LD	A,(IY+13)	;(FCB)属性(アトリビュート)
  E0C6  12            		LD	(DE),A
  E0C7  13            		INC	DE
                      	;				Reserved
  E0C8  AF            		XOR	A
  E0C9  060A          		LD	B,10
  E0CB                	SDE1:
  E0CB  12            		LD	(DE),A
  E0CC  13            		INC	DE
  E0CD  10FC          		DJNZ	SDE1
                      						;(FCB)更新時刻
  E0CF  21EAEB        		LD	HL,SDDATA		;(FCB)更新年月日
  E0D2  060A          		LD	B,SDDATAE-SDDATA	;(FCB)ファイルの先頭クラスタ
  E0D4                	SDLOOP:					;(FCB)ファイルのサイズ(バイト単位)
  E0D4  7E            		LD	A,(HL)
  E0D5  23            		INC	HL
  E0D6  32DBE0        		LD	(SDPAT+2),A
  E0D9  FD7E00        	SDPAT:	LD	A,(IY+0)	;LD A,(IY+A)
  E0DC  12            		LD	(DE),A
  E0DD  13            		INC	DE
  E0DE  10F4          		DJNZ	SDLOOP
                      	
  E0E0  AF            		XOR	A
  E0E1  E1            		POP	HL
  E0E2  D1            		POP	DE
  E0E3  C9            		RET
                      	
  E0E4                	WOPEN:
  E0E4  FD7E0D        		LD	A,(IY+13)	;(FCB)属性(アトリビュート)
  E0E7  E61F          		AND	01FH
  E0E9  37            		SCF
  E0EA  C0            		RET	NZ
  E0EB  FD361CFE      		LD	(IY+28),0FEH	;(FCB)オープンモード
  E0EF                	TOPEN2:
  E0EF  AF            		XOR	A
  E0F0                	TOPEN:				;Initializes the time stamp
  E0F0  FD3617FF      		LD	(IY+23),0FFH	;(FCB)更新時刻
  E0F4  C9            		RET
                      	
  E0F5                	WRDFX:
  E0F5  3A58DF        		LD	A,(SPCPAT+1)	;1クラスタの論理セクタ
  E0F8                	L_WRFX:
  E0F8  1F            		RRA		;->CF
  E0F9  3804          		JR	C,E_WRFX
  E0FB  CB39          		SRL	C	;C=C/2
  E0FD  18F9          		JR	L_WRFX
  E0FF                	E_WRFX:
  E0FF  41            		LD	B,C
  E100  04            		INC	B
  E101  3E37          		LD	A,037H		;SCF
  E103  3216E5        		LD	(DRDN1),A
                      	
  E106                	WRDF:				;Bクラスタ分FATを確保する
  E106  110200        		LD	DE,2
  E109  AF            		XOR	A
  E10A  327AE6        		LD	(_SECPS+1),A
  E10D                	WRDF1:
  E10D  C5            		PUSH	BC
  E10E  D5            		PUSH	DE
  E10F  CDF7EC        		CALL	_GNCL
  E112  381C          		JR	C,WRDF3
  E114  7A            		LD	A,D		;空いているかチェック
  E115  B3            		OR	E
  E116  2027          		JR	NZ,WRDF4
  E118  E1            		POP	HL		;HL=空いているクラスタ
  E119  E5            		PUSH	HL
  E11A  ED5BFEEB      		LD	DE,(_CLPS)	;DE=元の(_CLPS)
  E11E  22FEEB        		LD	(_CLPS),HL
  E121  7A            		LD	A,D		;元の(_CLPS)が 0 か?
  E122  B3            		OR	E
  E123  2008          		JR	NZ,WRDF2
  E125  FD751A        		LD	(IY+26),L	;(FCB)ファイルの先頭クラスタ
  E128  FD741B        		LD	(IY+27),H	;元が空の場合はFCBにクラスタをセットする
  E12B  1803          		JR	WRDF3
  E12D                	WRDF2:
  E12D  CDFAEC        		CALL	_SNCL
  E130                	WRDF3:
  E130  D1            		POP	DE
  E131  C1            		POP	BC
  E132  D8            		RET	C
  E133  100C          		DJNZ	WRDF5		;ここでループカウンタチェック
  E135  ED5BFEEB      		LD	DE,(_CLPS)
  E139  21FFFF        		LD	HL,0FFFFH	;FATエントリ終了(EOCマーク)
  E13C  C3FAEC        		JP	_SNCL
                      	
  E13F                	WRDF4:				;DEクラスタが空じゃないので次に移動する
  E13F  D1            		POP	DE
  E140  C1            		POP	BC
  E141                	WRDF5:
  E141  13            		INC	DE
  E142  CD71DF        		CALL	ENDCL
  E145  38C6          		JR	C,WRDF1
  E147  37            		SCF
  E148  C9            		RET
                      	
  E149                	RWXR:
  E149  3A94E4        		LD	A,(SECSZ+2)	;1024=4 / 512=2 / 256=1
  E14C                	L_RWX:
  E14C  1F            		RRA		;->CF
  E14D  3806          		JR	C,E_RWX
  E14F  CB38          		SRL	B	;BC=BC/2
  E151  CB19          		RR	C	;
  E153  18F7          		JR	L_RWX
  E155                	E_RWX:
  E155  FD5E1A        		LD	E,(IY+26)	;(FCB)ファイルの先頭クラスタ
  E158  FD561B        		LD	D,(IY+27)
  E15B  AF            		XOR	A
  E15C  327AE6        		LD	(_SECPS+1),A
  E15F                	RWX1:
  E15F  ED53FEEB      		LD	(_CLPS),DE
  E163  7A            		LD	A,D
  E164  B3            		OR	E
  E165  280D          		JR	Z,SCF_RET	;RET DE==0 => CF=1
                      	
  E167  78            		LD	A,B
  E168  B1            		OR	C
  E169  C8            		RET	Z		;RET BC==0 => CF=0
                      	
  E16A  CD82E6        		CALL	GNCLX
  E16D  D8            		RET	C
  E16E  0B            		DEC	BC
                      	
  E16F  CD71DF        		CALL	ENDCL
  E172  38EB          		JR	C,RWX1
  E174                	SCF_RET:
  E174  37            		SCF
  E175  C9            		RET
                      	
  E176                	DSKF:
  E176  110000        	MAXCLP:	LD	DE,0
  E179  2AACEC        		LD	HL,(_FAKEFREE)
  E17C  7C            		LD	A,H
  E17D  B5            		OR	L
  E17E  2803          		JR	Z,DSKF1
  E180  110100        		LD	DE,1
  E183                	DSKF1:
  E183  D5            		PUSH	DE
  E184  CDF7EC        		CALL	_GNCL
  E187  380C          		JR	C,POPSCF
  E189  7A            		LD	A,D
  E18A  B3            		OR	E
  E18B  2001          		JR	NZ,DSKF2
  E18D  23            		INC	HL
  E18E                	DSKF2:
  E18E  D1            		POP	DE
  E18F  1B            		DEC	DE
  E190  7A            		LD	A,D
  E191  B3            		OR	E
  E192  20EF          		JR	NZ,DSKF1
  E194  C9            		RET
                      	
  E195                	POPSCF:
  E195  F1            		POP	AF
  E196  37            		SCF
  E197  C9            		RET
                      	
  E198                	SETTMS:
  E198  FD7E17        		LD	A,(IY+23)	;(FCB)ファイルを最後に変更した時刻
  E19B  3C            		INC	A
  E19C  C0            		RET	NZ		;ファイルが更新されていない
  E19D                	SETTMSX:			;FCBに日付時刻をセットする
  E19D  CD41D8        		CALL	_SYS2C		;(BDOS)時刻の獲得
                      					;H←時  L←分  D←秒
  E1A0  CB25          		SLA	L		;   *2
  E1A2  CB25          		SLA	L		;   *4
  E1A4  29            		ADD	HL,HL		;*2 *8
  E1A5  29            		ADD	HL,HL		;*4 *16
  E1A6  29            		ADD	HL,HL		;*8 *32
  E1A7  7A            		LD	A,D
  E1A8  0F            		RRCA			;bit.0->7->->->0->C
  E1A9  E61F          		AND	01FH
  E1AB  B5            		OR	L
  E1AC  FD7716        		LD	(IY+22),A	;(FCB)ファイルを最後に変更した時刻
  E1AF  FD7417        		LD	(IY+23),H
                      	
  E1B2  CD0DD8        		CALL	_SYS2A		;(BDOS)日付の獲得
                      					;HL←年  D←月  E←日
  E1B5  0144F8        		LD	BC,0-1980
  E1B8  09            		ADD	HL,BC
  E1B9  65            		LD	H,L
                      	
  E1BA  7A            		LD	A,D
  E1BB  87            		ADD	A,A		;*2
  E1BC  87            		ADD	A,A		;*4
  E1BD  87            		ADD	A,A		;*8
  E1BE  87            		ADD	A,A		;*16
  E1BF  6F            		LD	L,A
  E1C0  29            		ADD	HL,HL		;*32
  E1C1  7D            		LD	A,L
  E1C2  B3            		OR	E
  E1C3  FD7714        		LD	(IY+20),A	;(FCB)ファイルを最後に変更した日付
  E1C6  FD7415        		LD	(IY+21),H
  E1C9  C9            		RET
                      	
  E1CA                	PUSHRR:
  E1CA  CDD0E1        		CALL	SUBRR
  E1CD                	POPRR1:
  E1CD  EDB0          		LDIR
  E1CF  C9            		RET
                      	
  E1D0                	SUBRR:
  E1D0  FDE5          		PUSH	IY
  E1D2  E1            		POP	HL
  E1D3  112100        		LD	DE,33
  E1D6  19            		ADD	HL,DE
  E1D7  115AEB        		LD	DE,HLBUF
  E1DA  010300        		LD	BC,3
  E1DD  C9            		RET
                      	
  E1DE                	SETSEQ:
  E1DE  F5            		PUSH	AF		;AHL=Random record
  E1DF  FD7E21        		LD	A,(IY+33)	;(FCB)ランダムレコード
  E1E2  FD6E22        		LD	L,(IY+34)
  E1E5  FD6623        		LD	H,(IY+35)
                      	
  E1E8  CD04E2        		CALL	SSQ1
                      	
  E1EB  29            		ADD	HL,HL
  E1EC  CB3D          		SRL	L		;L=L/2
  E1EE  FD7520        		LD	(IY+32),L	;(FCB)カレントレコード
  E1F1  FD740C        		LD	(IY+12),H	;(FCB)カレントブロック
  E1F4  F1            		POP	AF
                      	
  E1F5                	POPRR:
  E1F5  CDD0E1        		CALL	SUBRR
  E1F8  EB            		EX	DE,HL
  E1F9  18D2          		JR	POPRR1
                      	
  E1FB                	GETSIZE:
  E1FB  FD7E10        		LD	A,(IY+16)	;(FCB)ファイルのサイズ(バイト単位)
  E1FE  FD6E11        		LD	L,(IY+17)
  E201  FD6612        		LD	H,(IY+18)
  E204                	SSQ1:				;バイト単位からCP/Mのレコード単位を求める（1レコード=128バイト）
  E204  87            		ADD	A,A		;in HLA => out HL
  E205  ED6A          		ADC	HL,HL
  E207  B7            		OR	A
  E208  C8            		RET	Z
  E209  23            		INC	HL
  E20A  C9            		RET
                      	
  E20B                	GETSEQ:
  E20B  FD6E20        		LD	L,(IY+32)	;(FCB)カレントレコード
  E20E  FD660C        		LD	H,(IY+12)	;(FCB)カレントブロック
                      	
  E211  CB25          		SLA	L	;L=L*2
                      	
  E213  CB3C          		SRL	H	;HL=HL/2
  E215  CB1D          		RR	L	;
  E217  C9            		RET
                      	
  E218                	RB_WRITE:
  E218  C5            		PUSH	BC
  E219  ED4B4CEC      		LD	BC,(STABLE+2*026H)	;(BDOS)ランダムブロック書き込み
  E21D  1805          		JR	RBRW
  E21F                	RB_READ:
  E21F  C5            		PUSH	BC
  E220  ED4B4EEC      		LD	BC,(STABLE+2*027H)	;(BDOS)ランダムブロック読み込み
  E224                	RBRW:
  E224  AF            		XOR	A	;HLA = HL*128
  E225  CB3C          		SRL	H	;HL=HL/2
  E227  CB1D          		RR	L	;
  E229  1F            		RRA			;HLA
  E22A  FD7721        		LD	(IY+33),A	;(FCB)ランダムレコード
  E22D  FD7522        		LD	(IY+34),L
  E230  FD7423        		LD	(IY+35),H
  E233  218000        		LD	HL,128
                      	
  E236  FDE5          		PUSH	IY
  E238  D1            		POP	DE
  E239  D5            		PUSH	DE
  E23A  CD41E2        		CALL	JP_BC
  E23D  FDE1          		POP	IY
  E23F  C1            		POP	BC
  E240  C9            		RET
  E241                	JP_BC:
  E241  C5            		PUSH	BC
  E242  C9            		RET
                      	
  DDF4                	_SYS03	EQU	SCF_FF_RET	;(BDOS)外部入力
  DDF4                	_SYS2B	EQU	SCF_FF_RET	;(BDOS)日付の設定
  DDF4                	_SYS2D	EQU	SCF_FF_RET	;(BDOS)時刻の設定
                      	
                      	;LDFILE2.ASM
                      	
                      	;	LSX-Dodgers FILE2
                      	
  E243                	RBWDD:					;デバイスディスクプリタ
  E243  E5            		PUSH	HL
  E244  C1            		POP	BC
  E245  211FE3        		LD	HL,DD_NUL		;NUL
  E248  CD53E3        		CALL	DDX
  E24B  2003          		JR	NZ,RBWDD2
  E24D  2A08EC        		LD	HL,(STABLE+2*4)		;AUX
  E250                	RBWDD2:
  E250  FE43          		CP	'C'
  E252  2003          		JR	NZ,RBWDD3
  E254  2A04EC        		LD	HL,(STABLE+2*2)		;COM
  E257                	RBWDD3:
  E257  FE50          		CP	'P'
  E259  2003          		JR	NZ,RBWDD4
  E25B  2A0AEC        		LD	HL,(STABLE+2*5)		;PRN
  E25E                	RBWDD4:
  E25E  226CE2        		LD	(RBWDDP+1),HL
  E261  2A8AEC        		LD	HL,(_DTA)
  E264                	RBWDD1:
  E264  78            		LD	A,B
  E265  B1            		OR	C
  E266                	RBWDD5:
  E266  CA1AE3        		JP	Z,RBW1
  E269  5E            		LD	E,(HL)
  E26A  23            		INC	HL
  E26B  CD85D7        	RBWDDP:	CALL	_SYS02
  E26E  DA36E3        		JP	C,RBRERR
  E271  3E1A          		LD	A,01AH
  E273  BB            		CP	E
  E274  28F0          		JR	Z,RBWDD5
  E276  0B            		DEC	BC
  E277  18EB          		JR	RBWDD1
                      	
                      					;Write random block
  E279                	_SYS26:		;(BDOS)ランダムブロック書き込み
  E279  AF            		XOR	A
  E27A  3216E5        		LD	(DRDN1),A	;NOP
  E27D  22D7E4        		LD	(LEFT+1),HL	;HL←書き込むレコード数
  E280  225DEB        		LD	(LEFTX),HL
  E283  CD42DD        		CALL	SETDRV
                      	
  E286  CD3FE4        		CALL	RBX0
  E289  DA21E3        		JP	C,RBWERR
  E28C  28B5          		JR	Z,RBWDD		;デバイスデスクプリタ
  E28E  CDE4E0        		CALL	WOPEN
  E291  DA21E3        		JP	C,RBWERR
  E294  7C            		LD	A,H
  E295  B5            		OR	L
  E296  CA1AE3        		JP	Z,RBW1
                      	
  E299  2B            		DEC	HL
                      	
  E29A  CDEFE4        		CALL	GET_RR_CDE	;CDE=Random record
                      	
  E29D  AF            		XOR	A	;AHL=HL+CDE
  E29E  19            		ADD	HL,DE
  E29F  89            		ADC	A,C
                      	
  E2A0  47            		LD	B,A
  E2A1  4C            		LD	C,H
                      	
  E2A2  CD49E1        		CALL	RWXR
  E2A5  DCF5E0        		CALL	C,WRDFX
  E2A8  DA21E3        		JP	C,RBWERR
                      	
  E2AB  CD68E4        		CALL	RBX2
  E2AE  281A          		JR	Z,RBWB		;NZ=セクタ以下の端数がある
  E2B0  CD7CE4        		CALL	RBXA
  E2B3  386C          		JR	C,RBWERR
  E2B5  EB            		EX	DE,HL
  E2B6  C5            		PUSH	BC
  E2B7  EDB0          		LDIR
  E2B9  225FEB        		LD	(DTAX),HL
                      	
  E2BC  CD89E0        		CALL	SWTDBF		;バッファデータは更新された
                      	
  E2BF  2A5DEB        		LD	HL,(LEFTX)
  E2C2  D1            		POP	DE
  E2C3  ED52          		SBC	HL,DE
  E2C5  225DEB        		LD	(LEFTX),HL
  E2C8  2830          		JR	Z,RBWEND
                      	
  E2CA                	RBWB:
  E2CA  CDB2E4        		CALL	RBXB
  E2CD  2813          		JR	Z,RBWC
  E2CF                	RBWB1:
  E2CF  C5            		PUSH	BC
  E2D0  D5            		PUSH	DE
  E2D1  CD54DF        		CALL	CLUSTX
  E2D4  CDE8E7        		CALL	DWT24
  E2D7  D1            		POP	DE
  E2D8  C1            		POP	BC
  E2D9  3846          		JR	C,RBWERR
  E2DB  CD82E6        		CALL	GNCLX
  E2DE  3841          		JR	C,RBWERR
  E2E0  10ED          		DJNZ	RBWB1
  E2E2                	RBWC:
  E2E2  CDCAE4        		CALL	RBXC
  E2E5  2813          		JR	Z,RBWEND
  E2E7  C5            		PUSH	BC
  E2E8  CD54DF        		CALL	CLUSTX
  E2EB  CD15E5        		CALL	DRDN
  E2EE  C1            		POP	BC
  E2EF  3830          		JR	C,RBWERR
  E2F1  ED5B7EEC      		LD	DE,(_DTBUF)
  E2F5  EDB0          		LDIR
  E2F7  CD89E0        		CALL	SWTDBF		;バッファデータは更新された
  E2FA                	RBWEND:
  E2FA  CDD6E4        		CALL	RBXEND
                      	
  E2FD  CD4EE4        		CALL	RBX1
  E300  3018          		JR	NC,RBW1
  E302  2AD7E4        		LD	HL,(LEFT+1)
  E305  FD5E10        		LD	E,(IY+16)	;(FCB)ファイルのサイズ(バイト単位)
  E308  FD5611        		LD	D,(IY+17)	;CDE=File size
  E30B  FD4E12        		LD	C,(IY+18)
  E30E  AF            		XOR	A
  E30F  19            		ADD	HL,DE
  E310  89            		ADC	A,C
  E311  FD7510        		LD	(IY+16),L	;(FCB)ファイルのサイズ(バイト単位)
  E314  FD7411        		LD	(IY+17),H
  E317  FD7712        		LD	(IY+18),A
  E31A                	RBW1:
  E31A  FDE1          		POP	IY
  E31C  C1            		POP	BC
  E31D  D1            		POP	DE
  E31E  E1            		POP	HL
  E31F                	DD_NUL:
  E31F  AF            		XOR	A
  E320  C9            		RET
                      	
  E321                	RBWERR:
  E321  FDE5          		PUSH	IY
  E323  D1            		POP	DE
  E324  2A20EC        		LD	HL,(STABLE+2*010H)
  E327  CD0F00        		CALL	JP_HL
  E32A                	RBRERR1:
  E32A  3E01          		LD	A,001H
  E32C                	RBRERR2:
  E32C  FDE1          		POP	IY
  E32E  C1            		POP	BC
  E32F  D1            		POP	DE
  E330  E1            		POP	HL
  E331  37            		SCF
  E332  210000        		LD	HL,0
  E335  C9            		RET
                      	
  E336                	RBRERR:
  E336  3EFF          		LD	A,0FFH
  E338  18F2          		JR	RBRERR2
                      	
  E33A                	RBRFL:
  E33A  3E00          	RBRFLP:	LD	A,000H
  E33C  FE0D          		CP	00DH
  E33E  2005          		JR	NZ,RBRFL1
  E340  D5            		PUSH	DE
  E341  1E0A          		LD	E,00AH
  E343  1805          		JR	RBRFL2
  E345                	RBRFL1:
  E345  D5            		PUSH	DE
  E346  CD09EB        		CALL	_SYS07
  E349  5F            		LD	E,A
  E34A                	RBRFL2:
  E34A  CDCDEC        		CALL	_PRINT
  E34D  7B            		LD	A,E
  E34E  D1            		POP	DE
  E34F  323BE3        		LD	(RBRFLP+1),A
  E352  C9            		RET
  E353                	DDX:
  E353  FD7E01        		LD	A,(IY+1)	;(FCB)主ファイル名
  E356  CD79DF        		CALL	CAP
  E359  FE41          		CP	'A'
  E35B  C9            		RET
                      	
  E35C                	RBRDD:
  E35C  E5            		PUSH	HL
  E35D  C1            		POP	BC
  E35E  213AE3        		LD	HL,RBRFL
  E361  CD53E3        		CALL	DDX
  E364  2005          		JR	NZ,RBRDD2
  E366  2A06EC        		LD	HL,(STABLE+2*3)
  E369  1804          		JR	RBRDD3
  E36B                	RBRDD2:
  E36B  FE43          		CP	'C'
  E36D  202C          		JR	NZ,RBRDERR
  E36F                	RBRDD3:
  E36F  227FE3        		LD	(RBRDDP+1),HL
                      	
  E372  ED5B8AEC      		LD	DE,(_DTA)
  E376  210000        		LD	HL,0
  E379                	RBRDD1:
  E379  78            		LD	A,B
  E37A  B1            		OR	C
  E37B  2818          		JR	Z,RBRDDE1
  E37D  23            		INC	HL
  E37E  CD3AE3        	RBRDDP:	CALL	RBRFL
  E381  380D          		JR	C,RBRDDE
  E383  FE1A          		CP	01AH
  E385  2809          		JR	Z,RBRDDE
  E387  FE03          		CP	3
  E389  2805          		JR	Z,RBRDDE
  E38B  12            		LD	(DE),A
  E38C  13            		INC	DE
  E38D  0B            		DEC	BC
  E38E  18E9          		JR	RBRDD1
                      	
  E390                	RBRDDE:
  E390  3E1A          		LD	A,01AH
  E392  12            		LD	(DE),A
  E393                	RBRDDE2:
  E393  AF            		XOR	A
  E394  3C            		INC	A
  E395                	RBRDDE1:
  E395  322BE4        		LD	(RBRAP+1),A
  E398  C324E4        		JP	RBREND0
  E39B                	RBRDERR:
  E39B  210000        		LD	HL,0
  E39E  18F3          		JR	RBRDDE2
                      	
                      					;Read random block
  E3A0                	_SYS27:		;(BDOS)ランダムブロック読み込み
  E3A0  225DEB        		LD	(LEFTX),HL
  E3A3  CD42DD        		CALL	SETDRV
                      	
  E3A6  FDCB0D66      		BIT	4,(IY+13)	;(FCB)属性(アトリビュート)
  E3AA  C22DE4        		JP	NZ,RBRDIR	;ディレクトリ
  E3AD  CD3FE4        		CALL	RBX0
  E3B0  DA36E3        		JP	C,RBRERR
  E3B3  28A7          		JR	Z,RBRDD
  E3B5  CD4EE4        		CALL	RBX1
  E3B8  DA2AE3        		JP	C,RBRERR1
  E3BB  79            		LD	A,C
  E3BC  EB            		EX	DE,HL
  E3BD  ED52          		SBC	HL,DE		;CP 0HL,CDE
  E3BF  19            		ADD	HL,DE
  E3C0  DE00          		SBC	A,000H
  E3C2  3801          		JR	C,RBR1
  E3C4  EB            		EX	DE,HL
  E3C5                	RBR1:
  E3C5  9F            		SBC	A,A
  E3C6  E601          		AND	1
  E3C8  322BE4        		LD	(RBRAP+1),A
                      	
  E3CB  7C            		LD	A,H
  E3CC  B5            		OR	L
  E3CD  CA24E4        		JP	Z,RBREND0
                      	
  E3D0  22D7E4        		LD	(LEFT+1),HL	;Read record byte
  E3D3  225DEB        		LD	(LEFTX),HL
                      	
  E3D6  CD68E4        		CALL	RBX2
  E3D9  2819          		JR	Z,RBRB
  E3DB  CD7CE4        		CALL	RBXA
  E3DE  DA36E3        		JP	C,RBRERR
  E3E1  C5            		PUSH	BC
  E3E2  EDB0          		LDIR
  E3E4  ED535FEB      		LD	(DTAX),DE
  E3E8  2A5DEB        		LD	HL,(LEFTX)
  E3EB  D1            		POP	DE
  E3EC  A7            		AND	A
  E3ED  ED52          		SBC	HL,DE
  E3EF  225DEB        		LD	(LEFTX),HL
  E3F2  282D          		JR	Z,RBREND
                      	
  E3F4                	RBRB:
  E3F4  CDB2E4        		CALL	RBXB
  E3F7  2812          		JR	Z,RBRC
  E3F9                	RBRB1:
  E3F9  C5            		PUSH	BC
  E3FA  D5            		PUSH	DE
  E3FB  CD54DF        		CALL	CLUSTX
  E3FE  CDD8E7        		CALL	DRD24
  E401  D1            		POP	DE
  E402  C1            		POP	BC
  E403  D482E6        		CALL	NC,GNCLX
  E406  DA36E3        		JP	C,RBRERR
  E409  10EE          		DJNZ	RBRB1
  E40B                	RBRC:
  E40B  CDCAE4        		CALL	RBXC
  E40E  2811          		JR	Z,RBREND
  E410  C5            		PUSH	BC
  E411  CD54DF        		CALL	CLUSTX
  E414  CDF9E4        		CALL	DRDX
  E417  C1            		POP	BC
  E418  DA36E3        		JP	C,RBRERR
  E41B  EB            		EX	DE,HL
  E41C  2A7EEC        		LD	HL,(_DTBUF)
  E41F  EDB0          		LDIR
  E421                	RBREND:
  E421  CDD6E4        		CALL	RBXEND
  E424                	RBREND0:
  E424  FDE1          		POP	IY
  E426  C1            		POP	BC
  E427  D1            		POP	DE
  E428  F1            		POP	AF	;(HL)
  E429  AF            		XOR	A
  E42A  3E00          	RBRAP:	LD	A,000H
  E42C  C9            		RET
                      	
  E42D                	RBRDIR:
  E42D  FD6E1A        		LD	L,(IY+26)	;(FCB)ファイルの先頭クラスタ
  E430  FD661B        		LD	H,(IY+27)
  E433  CD94DF        		CALL	CHDIR
  E436  AF            		XOR	A
  E437  67            		LD	H,A
  E438  6F            		LD	L,A
  E439  3C            		INC	A
  E43A  322BE4        		LD	(RBRAP+1),A
  E43D  18E5          		JR	RBREND0
                      	
  E43F                	RBX0:
  E43F  2A8AEC        		LD	HL,(_DTA)
  E442  225FEB        		LD	(DTAX),HL
  E445  2A5DEB        		LD	HL,(LEFTX)
  E448  FD7E1C        		LD	A,(IY+28)	;(FCB)オープンモード
  E44B  D6FD          		SUB	0FDH
  E44D  C9            		RET
                      	
  E44E                	RBX1:
  E44E  E5            		PUSH	HL		;Record byte
                      					;AHL=File size
  E44F  FD6E10        		LD	L,(IY+16)	;ファイルのサイズ(バイト単位)
  E452  FD6611        		LD	H,(IY+17)
  E455  FD7E12        		LD	A,(IY+18)
                      	
  E458  CDEFE4        		CALL	GET_RR_CDE	;CDE=Random record
                      	
  E45B  A7            		AND	A
  E45C  ED52          		SBC	HL,DE
  E45E  99            		SBC	A,C
  E45F  D1            		POP	DE
                      	
  E460  D8            		RET	C
  E461  4F            		LD	C,A
  E462  EB            		EX	DE,HL	;CDE=File byte	HL=Record byte
  E463  B2            		OR	D
  E464  B3            		OR	E
  E465  C0            		RET	NZ
  E466  37            		SCF
  E467  C9            		RET
                      	
  E468                	RBX2:				;Cluster settings
  E468  FD4E22        		LD	C,(IY+34)	;(+33)(FCB)ランダムレコード
  E46B  FD4623        		LD	B,(IY+35)
  E46E  CD49E1        		CALL	RWXR
  E471  3A94E4        		LD	A,(SECSZ+2)	;1024=4 / 512=2 / 256=1
  E474  3D            		DEC	A
  E475  FDA622        		AND	(IY+34)
  E478  FDB621        		OR	(IY+33)
  E47B  C9            		RET
                      	
  E47C                	RBXA:
  E47C  C5            		PUSH	BC
  E47D  D5            		PUSH	DE
  E47E  CD54DF        		CALL	CLUSTX
  E481  CDF9E4        		CALL	DRDX
  E484  D1            		POP	DE
  E485  C1            		POP	BC
  E486  D8            		RET	C
  E487  CD82E6        		CALL	GNCLX
  E48A  D8            		RET	C
  E48B  ED53FEEB      		LD	(_CLPS),DE
                      	
  E48F  FD4E21        		LD	C,(IY+33)	;(FCB)ランダムレコード
  E492  210004        	SECSZ:	LD	HL,0400H	;自己書き換え 1024=0400H / 512=0200H ここに1セクタのサイズが格納される
  E495  7C            		LD	A,H
  E496  3D            		DEC	A		;1024=3 / 512=1
  E497  FDA622        		AND	(IY+34)		;(FCB)ランダムレコード
  E49A  47            		LD	B,A		;BCに1セクタ以下の端数が入る
  E49B  ED42          		SBC	HL,BC		;残りを計算
                      	
  E49D  ED5B5DEB      		LD	DE,(LEFTX)
  E4A1  ED52          		SBC	HL,DE		;CP HL,DE
  E4A3  19            		ADD	HL,DE		;
  E4A4  3801          		JR	C,RBXA1		;DEとHLを比較して大きい方をHLに
  E4A6  EB            		EX	DE,HL
  E4A7                	RBXA1:
  E4A7  E5            		PUSH	HL
  E4A8  2A7EEC        		LD	HL,(_DTBUF)
  E4AB  09            		ADD	HL,BC
  E4AC  ED5B5FEB      		LD	DE,(DTAX)
  E4B0  C1            		POP	BC
  E4B1  C9            		RET
                      	
  E4B2                	RBXB:
  E4B2  2A5FEB        		LD	HL,(DTAX)
  E4B5  ED5BFEEB      		LD	DE,(_CLPS)
  E4B9  3A5EEB        		LD	A,(LEFTX+1)
  E4BC  47            		LD	B,A
  E4BD  3A94E4        		LD	A,(SECSZ+2)	;1024=4 / 512=2 / 256=1
  E4C0                	RBXB1:
  E4C0  1F            		RRA		;->CF
  E4C1  3804          		JR	C,RBXB2
  E4C3  CB38          		SRL	B	;B=B/2
  E4C5  18F9          		JR	RBXB1
  E4C7                	RBXB2:
  E4C7  78            		LD	A,B
  E4C8  B7            		OR	A
  E4C9  C9            		RET
                      	
  E4CA                	RBXC:
  E4CA  ED4B5DEB      		LD	BC,(LEFTX)
  E4CE  3A94E4        		LD	A,(SECSZ+2)	;1024=4 / 512=2 / 256=1
  E4D1  3D            		DEC	A
  E4D2  A0            		AND	B
  E4D3  47            		LD	B,A		;1セクタ以下の端数がない場合はZ
  E4D4  B1            		OR	C
  E4D5  C9            		RET
                      	
  E4D6                	RBXEND:
  E4D6  110000        	LEFT:	LD	DE,0
  E4D9  AF            		XOR	A
  E4DA  FD6E21        		LD	L,(IY+33)	;(FCB)ランダムレコード
  E4DD  FD6622        		LD	H,(IY+34)
  E4E0  19            		ADD	HL,DE
  E4E1  FD8E23        		ADC	A,(IY+35)
  E4E4  FD7521        		LD	(IY+33),L	;(FCB)ランダムレコード
  E4E7  FD7422        		LD	(IY+34),H
  E4EA  FD7723        		LD	(IY+35),A
  E4ED  EB            		EX	DE,HL		;HL=Read byte
  E4EE  C9            		RET
                      	
  E4EF                	GET_RR_CDE:			;CDE=Random record
  E4EF  FD5E21        		LD	E,(IY+33)	;(FCB)ランダムレコード
  E4F2  FD5622        		LD	D,(IY+34)
  E4F5  FD4E23        		LD	C,(IY+35)
  E4F8  C9            		RET
                      	
                      	
                      	;LDDIO.ASM
                      	
                      	;	LSX-Dodgers DIO
                      	
  E4F9                	DRDX:
  E4F9  CD37E5        		CALL	DRDY
  E4FC  C8            		RET	Z
  E4FD  CD1DE5        		CALL	DRDX1		;データバッファの情報を保存
  E500  D8            		RET	C
  E501  E5            		PUSH	HL
  E502  C5            		PUSH	BC
  E503  D5            		PUSH	DE
  E504  2A7EEC        		LD	HL,(_DTBUF)
  E507  3A60E5        		LD	A,(_DBS24+1)
  E50A  4F            		LD	C,A
  E50B  CDD8E7        		CALL	DRD24
  E50E  DC32E5        		CALL	C,DRDNE
  E511                	POP_DE_BC_HL_RET:
  E511  D1            		POP	DE
  E512  C1            		POP	BC
  E513  E1            		POP	HL
  E514  C9            		RET
                      	
                      	;	CDE:セクタ番号
  E515                	DRDN:
  E515  AF            		XOR	A
  E516  00            	DRDN1:	NOP			;自己書き換え NOP / SCF
  E517  30E0          		JR	NC,DRDX
  E519                	DRDNX:
  E519  CD37E5        		CALL	DRDY
  E51C  C8            		RET	Z
  E51D                	DRDX1:
  E51D  CD4DE5        		CALL	DWTX
                      					;データバッファの読み込んだドライブ・セクタ情報を保存
  E520  ED53A6EC      		LD	(_DBSEC),DE
  E524  79            		LD	A,C
  E525  3260E5        		LD	(_DBS24+1),A
                      	
  E528  3A88EC        		LD	A,(_DRV)
  E52B  32A5EC        		LD	(_DBDRV),A
  E52E  CDD9EC        		CALL	_CHGDRV
  E531  D0            		RET	NC
  E532                	DRDNE:
  E532  9F            		SBC	A,A		;CF=1ならばA=0FFH
  E533  32A5EC        		LD	(_DBDRV),A
  E536  C9            		RET
                      	
                      	;	CDE:セクタ番号
  E537                	DRDY:
  E537  3A60E5        		LD	A,(_DBS24+1)
  E53A  B9            		CP	C
  E53B  C0            		RET	NZ
                      	
  E53C  E5            		PUSH	HL
  E53D  3A88EC        		LD	A,(_DRV)
  E540  21A5EC        		LD	HL,_DBDRV
  E543  AE            		XOR	(HL)
  E544  2005          		JR	NZ,POP_HL_RET
                      	
  E546  2AA6EC        		LD	HL,(_DBSEC)
  E549  ED52          		SBC	HL,DE		;CF=0
  E54B                	POP_HL_RET:
  E54B  E1            		POP	HL
  E54C  C9            		RET
                      	
  E54D                	DWTX:
  E54D  3AA4EC        		LD	A,(_WTDBF)
  E550  B7            		OR	A
  E551  C8            		RET	Z
  E552  AF            		XOR	A
  E553  32A4EC        		LD	(_WTDBF),A
                      	
  E556  E5            		PUSH	HL
  E557  C5            		PUSH	BC
  E558  D5            		PUSH	DE
  E559  3AA5EC        		LD	A,(_DBDRV)
  E55C  CDD9EC        		CALL	_CHGDRV
  E55F  0E00          	_DBS24:	LD	C,0
  E561  ED5BA6EC      		LD	DE,(_DBSEC)
  E565  2A7EEC        		LD	HL,(_DTBUF)
  E568  D4E8E7        		CALL	NC,DWT24
  E56B                	POP_DE_BC_HL_RET2:
  E56B  18A4          		JR	POP_DE_BC_HL_RET
                      	
  E56D                	RDFATX:
  E56D  E5            		PUSH	HL
  E56E  3A88EC        		LD	A,(_DRV)
  E571  21AAEC        		LD	HL,_FATDRV
  E574  AE            		XOR	(HL)
  E575  28D4          		JR	Z,POP_HL_RET
                      	
  E577  C5            		PUSH	BC
  E578  D5            		PUSH	DE
  E579  DDE5          		PUSH	IX
  E57B  CD97E5        		CALL	WTFATX
  E57E  3813          		JR	C,POP_IX_DE_BC_HL_RET
                      	
  E580  AF            		XOR	A
  E581  32ABEC        		LD	(_FATIX),A
  E584  3A88EC        		LD	A,(_DRV)
  E587  32AAEC        		LD	(_FATDRV),A
  E58A  CDE5EC        		CALL	_RDFAT
  E58D                	RDFATE2:
  E58D  3004          		JR	NC,POP_IX_DE_BC_HL_RET
  E58F  9F            		SBC	A,A		;A=0xFF
  E590  32AAEC        		LD	(_FATDRV),A
  E593                	POP_IX_DE_BC_HL_RET:
  E593  DDE1          		POP	IX
  E595  18D4          		JR	POP_DE_BC_HL_RET2
                      	
  E597                	WTFATX:
  E597  3AA2EC        		LD	A,(_WTFATF)
  E59A  B7            		OR	A
  E59B  C8            		RET	Z
  E59C  E5            		PUSH	HL
  E59D  3AAAEC        		LD	A,(_FATDRV)
  E5A0  21A5EC        		LD	HL,_DBDRV
  E5A3  AE            		XOR	(HL)
  E5A4  CC4DE5        		CALL	Z,DWTX
  E5A7  38A2          		JR	C,POP_HL_RET
  E5A9  C5            		PUSH	BC
  E5AA  D5            		PUSH	DE
  E5AB  DDE5          		PUSH	IX
  E5AD  CDF5E7        		CALL	WTFAT
  E5B0  AF            		XOR	A
  E5B1  32A2EC        		LD	(_WTFATF),A
  E5B4  18DD          		JR	POP_IX_DE_BC_HL_RET
                      	
  E5B6                	NCL1:
  E5B6  7A            		LD	A,D
  E5B7  B3            		OR	E
  E5B8  37            		SCF
  E5B9  C8            		RET	Z
                      	
  E5BA  7A            		LD	A,D
  E5BB  E608          		AND	8		;DE(targetCluster >= 0x800)
  E5BD                	N16CL1X:
  E5BD  E5            		PUSH	HL
  E5BE  32DDE5        		LD	(NCLPAT+2),A	;_FATIX
  E5C1  2AAAEC        		LD	HL,(_FATDRV)	;L=_FATDRV H=_FATIX
  E5C4  BC            		CP	H
  E5C5  3A88EC        		LD	A,(_DRV)	;この間でフラグは変化しない
  E5C8  32DCE5        		LD	(NCLPAT+1),A	;_FATDRV
  E5CB  2005          		JR	NZ,NCL2		;FATIXが違う
  E5CD  BD            		CP	L
  E5CE  2002          		JR	NZ,NCL2		;ドライブが違う
  E5D0  E1            		POP	HL
  E5D1  C9            		RET
  E5D2                	NCL2:
  E5D2  C5            		PUSH	BC
  E5D3  D5            		PUSH	DE
  E5D4  DDE5          		PUSH	IX
  E5D6  CD97E5        		CALL	WTFATX
  E5D9  38B8          		JR	C,POP_IX_DE_BC_HL_RET
  E5DB  010000        	NCLPAT:	LD	BC,0		;自己書き換え C=_FATDRV B=_FATIX
  E5DE  ED43AAEC      		LD	(_FATDRV),BC
  E5E2  CDC8E7        		CALL	RDFATS
  E5E5  18A6          		JR	RDFATE2
                      	
  E5E7                	NCL3:
  E5E7  CB9A          		RES	3,D
  E5E9  6B            		LD	L,E
  E5EA  62            		LD	H,D
  E5EB  CB3C          		SRL	H	;
  E5ED  CB1D          		RR	L	;HLA=HLA/2
  E5EF  1F            		RRA		;
  E5F0  ED4B7CEC      		LD	BC,(_FATBF)
  E5F4  19            		ADD	HL,DE
  E5F5  09            		ADD	HL,BC
  E5F6  17            		RLA
  E5F7  C9            		RET
                      	
  E5F8                	N16CL1:
  E5F8  7A            		LD	A,D
  E5F9  B3            		OR	E
  E5FA  37            		SCF
  E5FB  C8            		RET	Z
                      	
  E5FC  7A            		LD	A,D
  E5FD  CB3F          		SRL	A	;/2
  E5FF  CB3F          		SRL	A	;/2
  E601  18BA          		JR	N16CL1X
                      	
  E603                	GNCL:
  E603  CDB6E5        		CALL	NCL1		;GET NEXT CLUSTER
  E606  D8            		RET	C
  E607  C5            		PUSH	BC
  E608  E5            		PUSH	HL
  E609  CDE7E5        		CALL	NCL3
  E60C  3809          		JR	C,GNC1
  E60E  5E            		LD	E,(HL)
  E60F  23            		INC	HL
  E610  7E            		LD	A,(HL)
  E611  E60F          		AND	00FH
  E613  57            		LD	D,A
  E614  E1            		POP	HL
  E615  C1            		POP	BC
  E616  C9            		RET
  E617                	GNC1:
  E617  7E            		LD	A,(HL)
  E618  23            		INC	HL
  E619  56            		LD	D,(HL)
  E61A  0604          		LD	B,4
  E61C                	GNC1L:
  E61C  CB3A          		SRL	D	;DA=DA/2
  E61E  1F            		RRA		;
  E61F  10FB          		DJNZ	GNC1L
                      	
  E621  5F            		LD	E,A
  E622  E1            		POP	HL
  E623  C1            		POP	BC
  E624  A7            		AND	A
  E625  C9            		RET
                      	
  E626                	SNCL:
  E626  CDB6E5        		CALL	NCL1
  E629  D8            		RET	C
                      	;				SET NEXT CLUSTER
  E62A  E5            		PUSH	HL
  E62B  C5            		PUSH	BC
  E62C  D5            		PUSH	DE
  E62D  E5            		PUSH	HL
  E62E  CDE7E5        		CALL	NCL3
  E631  D1            		POP	DE
                      	;CF=ODD
  E632  7E            		LD	A,(HL)
  E633  73            		LD	(HL),E
  E634  3806          		JR	C,SNC1
                      	;EVEN
                      	;M[0] = E
                      	;M[1] = (M[1] & 0xF0) | (D & 0x0F)
  E636  23            		INC	HL
  E637  ED67          		RRD		;M={A[3:0],E[3:0]}
  E639  7A            		LD	A,D
  E63A  1804          		JR	SNC11
  E63C                	SNC1:
                      	;ODD
                      	;HL[0] = (HL[0]&0x0F) | (E<<4)
                      	;HL[1] = DE>>4
  E63C  ED6F          		RLD		;M={D[3:0],E[7:4]}
  E63E  23            		INC	HL
  E63F  72            		LD	(HL),D	;M={D[3:0],E[7:4]}
  E640                	SNC11:
  E640  ED6F          		RLD		;M={M[7:4],D[3:0]}
  E642  B7            		OR	A
  E643  D1            		POP	DE
  E644  C1            		POP	BC
  E645  E1            		POP	HL
  E646                	FAT_CHANGED:
  E646  3E01          		LD	A,1
  E648  32A2EC        		LD	(_WTFATF),A
  E64B  C9            		RET
                      	
  E64C                	N16CL3:
  E64C  C5            		PUSH	BC
  E64D  6B            		LD	L,E
  E64E  7A            		LD	A,D
  E64F  E603          		AND	3
  E651  67            		LD	H,A
  E652  29            		ADD	HL,HL
  E653  ED4B7CEC      		LD	BC,(_FATBF)
  E657  09            		ADD	HL,BC
  E658  C1            		POP	BC
  E659  C9            		RET
                      	
  E65A                	GNCL16:
  E65A  CDF8E5        		CALL	N16CL1		;GET NEXT CLUSTER for FAT16
  E65D  D8            		RET	C
  E65E  E5            		PUSH	HL
  E65F  CD4CE6        		CALL	N16CL3
  E662  5E            		LD	E,(HL)
  E663  23            		INC	HL
  E664  56            		LD	D,(HL)
  E665  E1            		POP	HL
  E666  C9            		RET
                      	
  E667                	SNCL16:
  E667  CDF8E5        		CALL	N16CL1		;GET NEXT CLUSTER for FAT16
  E66A  D8            		RET	C
  E66B  D5            		PUSH	DE
  E66C  E5            		PUSH	HL
  E66D  CD4CE6        		CALL	N16CL3
  E670  D1            		POP	DE		;HL
  E671  73            		LD	(HL),E
  E672  23            		INC	HL
  E673  72            		LD	(HL),D
  E674  6B            		LD	L,E
  E675  62            		LD	H,D
  E676  D1            		POP	DE
  E677  18CD          		JR	FAT_CHANGED
                      	
                      	;------------------------
                      	;次のセクタを探す際に_SECPSの値をチェック
                      	;in
                      	;	DE : セクタ番号
                      	;out
                      	;	DE : 次のセクタ番号
                      	;note
                      	;
                      	;------------------------
  E679                	NEXTX:
  E679  3E00          	_SECPS:	LD	A,0	;自己書き換え
  E67B  3C            		INC	A
  E67C  E600          	NCPAT:	AND	0	;自己書き換え　1クラスタの論理セクタ数-1
  E67E  327AE6        		LD	(_SECPS+1),A
  E681  C9            		RET
                      	
  E682                	GNCLX:
  E682  CD79E6        		CALL	NEXTX
  E685  C0            		RET	NZ	;1クラスタのセクタ未満の場合は戻る
  E686  C3F7EC        		JP	_GNCL	;次のクラスタを探す
                      	
  E689                	RDFAT:
  E689  3E80          		LD	A,080H
  E68B  3270EB        		LD	(CHECK),A
  E68E                	RDFAT1:
  E68E  3A88EC        		LD	A,(_DRV)
  E691  CD3CE9        		CALL	CHGDRVR
  E694  D8            		RET	C
  E695  DD7E12        		LD	A,(IX+012H)	;DPB_12_DEVICE
  E698  CB6F          		BIT	5,A
  E69A  2843          		JR	Z,RDFAT0X
  E69C  2170EB        		LD	HL,CHECK
  E69F  A6            		AND	(HL)
  E6A0  77            		LD	(HL),A
  E6A1  110000        		LD	DE,0		;BPB
  E6A4  2A7CEC        		LD	HL,(_FATBF)
  E6A7  CDD6E7        		CALL	DRD16
  E6AA  3024          		JR	NC,GETBPB
  E6AC  2170EB        		LD	HL,CHECK
  E6AF  CB06          		RLC	(HL)
  E6B1  3F            		CCF
  E6B2  D8            		RET	C
  E6B3  DDCB0A1E      		RR	(IX+00AH)	;DPB_0A_FDMODE
  E6B7  3F            		CCF			;フロッピーディスクのMFMモードを切り替える
  E6B8  DDCB0A16      		RL	(IX+00AH)	;DPB_0A_FDMODE
  E6BC  3EFF          		LD	A,0FFH
  E6BE  3289EC        		LD	(_DSK),A
  E6C1  3A84EC        		LD	A,(_DRIVE)
  E6C4  E603          		AND	3
  E6C6  F680          		OR	080H
  E6C8  6F            		LD	L,A
  E6C9  26EC          		LD	H,_CYL0/256
  E6CB  3EFF          		LD	A,0FFH
  E6CD  77            		LD	(HL),A
  E6CE  18BE          		JR	RDFAT1
  E6D0                	GETBPB:
  E6D0  FDE5          		PUSH	IY
  E6D2  FD2A7CEC      		LD	IY,(_FATBF)	;BPB
  E6D6  CDF1EC        		CALL	_BPB2DPB
  E6D9  FDE1          		POP	IY
  E6DB  D8            		RET	C
  E6DC  CD8EE8        		CALL	CHGDRV2
  E6DF                	RDFAT0X:
  E6DF  CDC8E7        		CALL	RDFATS
  E6E2  D8            		RET	C
  E6E3  DDBE06        		CP	(IX+6)		;DPB_06_FATID
  E6E6  C8            		RET	Z
  E6E7  DDCB126E      		BIT	5,(IX+012H)	;DPB_12_DEVICE
  E6EB  C0            		RET	NZ		;BPBを取得している場合はFATIDをチェックしない
  E6EC  37            		SCF
  E6ED  C9            		RET
                      	
  E6EE                	BPB2DPB:
  E6EE  FD7E00        		LD	A,(IY+0)	;BS_JmpBoot
  E6F1  FEEB          		CP	0EBH		;Short jump
  E6F3  2808          		JR	Z,BPBOK
  E6F5  FEE9          		CP	0E9H		;Near jump
  E6F7  2804          		JR	Z,BPBOK
  E6F9  FE60          		CP	060H		;X68k
  E6FB  37            		SCF
  E6FC  C0            		RET	NZ
  E6FD                	BPBOK:
  E6FD  FD7E0D        		LD	A,(IY+13)	;BPB_SecPerClus
  E700  DD7707        		LD	(IX+7),A	;DPB_07_SECPCL
                      	
  E703  FD7E16        		LD	A,(IY+22)	;BPB_FATSz16
  E706  DD7700        		LD	(IX+0),A	;DPB_00_FATLN
  E709  FD7E17        		LD	A,(IY+23)	;BPB_FATSz16
  E70C  DD7701        		LD	(IX+1),A	;DPB_00_FATLN
                      	
  E70F  FD6E0E        		LD	L,(IY+14)	;BPB_RsvdSecCnt
  E712  FD660F        		LD	H,(IY+15)
  E715  DD750E        		LD	(IX+00EH),L	;DPB_0E_FATPS
  E718  FD5E16        		LD	E,(IY+22)	;BPB_FATSz16
  E71B  FD5617        		LD	D,(IY+23)
  E71E  FD4610        		LD	B,(IY+16)	;BPB_NumFATs
  E721                	BPBDP1:				;BPB_FATSz16 * BPB_NumFATs
  E721  19            		ADD	HL,DE
  E722  10FD          		DJNZ	BPBDP1
  E724                	BPBDP2:
  E724  DD7510        		LD	(IX+010H),L	;DPB_10_DIRPS
  E727  DD7411        		LD	(IX+011H),H
  E72A  E5            		PUSH	HL
                      	
  E72B  FD6E11        		LD	L,(IY+17)	;BPB_RootEntCnt
  E72E  FD6612        		LD	H,(IY+18)
  E731  FD7E0C        		LD	A,(IY+12)	;BPB_BytsPerSec
  E734  0606          		LD	B,6
  E736                	BPBBPS1:
  E736  05            		DEC	B
  E737  0F            		RRCA
  E738  30FC          		JR	NC,BPBBPS1
  E73A                	BPBDE1:
  E73A  29            		ADD	HL,HL
  E73B  10FD          		DJNZ	BPBDE1
                      	
  E73D  7C            		LD	A,H
  E73E  DD770B        		LD	(IX+00BH),A	;DPB_0B_DIRSCNT
                      	
  E741  D1            		POP	DE		;DPB_10_DIRPS
  E742  6C            		LD	L,H
  E743  2600          		LD	H,0
  E745  19            		ADD	HL,DE		;MAXDIR
  E746  E5            		PUSH	HL
  E747  FD4E0D        		LD	C,(IY+13)	;BPB_SecPerClus
  E74A  CB21          		SLA	C		;*2
  E74C  AF            		XOR	A
  E74D  47            		LD	B,A
  E74E  ED42          		SBC	HL,BC
  E750  DD7514        		LD	(IX+014H),L	;DPB_14_ADDCL16
  E753  DD7415        		LD	(IX+015H),H
                      	
  E756  D1            		POP	DE		;DE=DPB_0B_MAXDIR
  E757  FD6E13        		LD	L,(IY+19)	;BPB_TotSec16
  E75A  FD6614        		LD	H,(IY+20)
  E75D  7C            		LD	A,H
  E75E  B5            		OR	L
  E75F  3E00          		LD	A,0		;LDでフラグは変化しない。BPB_TotSec16を AHL で扱う為、Aに0を入れる
  E761  2010          		JR	NZ,BPB16BIT
  E763  FD7E23        		LD	A,(IY+35)	;BPB_TotSec16が「0」の場合はBPB_TotSec32で計算
  E766  B7            		OR	A
  E767  37            		SCF
  E768  C0            		RET	NZ		;念のため(総セクタ数が24ビットを超える場合)
  E769  FD6E20        		LD	L,(IY+32)	;BPB_TotSec32 は AHL の24ビットで扱う
  E76C  FD6621        		LD	H,(IY+33)	;1クラスタの論理セクタ数(DPB_07_SECPCL)が最大128なので
  E76F  FD7E22        		LD	A,(IY+34)	;24ビットを超えると必ずクラスタ数が16ビットを超えてしまうのでこれで十分
  E772  A7            		AND	A		;CF=0
  E773                	BPB16BIT:
  E773  ED52          		SBC	HL,DE
  E775  DE00          		SBC	A,0
  E777  FD460D        		LD	B,(IY+13)	;BPB_SecPerClus
  E77A                	BPBTC1:				;総クラスタ数(AHL) = 総セクタ数(AHL) / セクタサイズ(B)
  E77A  CB18          		RR	B		;->CY
  E77C  3808          		JR	C,BPBTC2
  E77E  CB3F          		SRL	A
  E780  CB1C          		RR	H		;AHL=AHL/2
  E782  CB1D          		RR	L
  E784  18F4          		JR	BPBTC1
  E786                	BPBTC2:
  E786  B7            		OR	A
  E787  37            		SCF
  E788  C0            		RET	NZ		;念のため(クラスタ数が16ビットを超える場合)
  E789  23            		INC	HL
  E78A  23            		INC	HL
  E78B  DD7508        		LD	(IX+8),L	;DPB_08_MAXCL
  E78E  DD7409        		LD	(IX+9),H
                      	
  E791  FD7E15        		LD	A,(IY+21)	;BPB_Media
  E794  DD7706        		LD	(IX+6),A	;DPB_06_FATID
                      	
  E797  DDCB0A7E      		BIT	7,(IX+00AH)	;DPB_0A_FDMODE
  E79B  2817          		JR	Z,NOT_FD
  E79D  2E28          		LD	L,40		;MAXCYLの設定（要検討）ここから下はフロッピーのみ書き換える
  E79F  FEFD          		CP	0FDH	;2D
  E7A1  2808          		JR	Z,SETCYL
  E7A3  2E4D          		LD	L,77
  E7A5  FEFE          		CP	0FEH	;2HD
  E7A7  2802          		JR	Z,SETCYL
  E7A9  2E50          		LD	L,80	;その他2DD等
  E7AB                	SETCYL:
  E7AB  DD750C        		LD	(IX+00CH),L	;DPB_0C_MAXCYL
  E7AE  FD7E18        		LD	A,(IY+24)	;BPB_SecPerTr
  E7B1  DD770D        		LD	(IX+00DH),A	;DPB_0D_MAXSEC	;ここまでフロッピー専用
  E7B4                	NOT_FD:
  E7B4  FD7E10        		LD	A,(IY+16)	;BPB_NumFATs
  E7B7  FE02          		CP	2		;>2:NC
  E7B9  FD7E0C        		LD	A,(IY+12)	;BPB_BytsPerSec
  E7BC  3802          		JR	C,BPBFAT1
  E7BE  F680          		OR	080H
  E7C0                	BPBFAT1:
  E7C0  DD770F        		LD	(IX+00FH),A	;DPB_0F_BPS
                      	
  E7C3  E67F          		AND	07FH		;セクタバッファが1KBしかないので1KBを超える場合はCF=1でエラーにする
  E7C5  C6FB          		ADD	A,0-5		;0-4:NC 5以上:C
  E7C7  C9            		RET
                      	
  E7C8                	RDFATS:
  E7C8  CD13E8        		CALL	FATSETUP
  E7CB  D8            		RET	C
  E7CC                	RDFATL:
  E7CC  0E00          		LD	C,0
  E7CE  CDDAE7        		CALL	DRD24B
  E7D1  2A7CEC        		LD	HL,(_FATBF)
  E7D4  7E            		LD	A,(HL)
  E7D5  C9            		RET
                      	
  E7D6                	DRD16:
  E7D6  0E00          		LD	C,0
  E7D8                	DRD24:
  E7D8  0601          		LD	B,1
  E7DA                	DRD24B:
  E7DA  DDE5          		PUSH	IX
  E7DC  DD2AA8EC      		LD	IX,(_DPB)
  E7E0  CD5BEA        	DRDPAT:	CALL	FDRD		;自己書き換え（ディスク読み込み）
  E7E3                	POP_IX_RET:
  E7E3  DDE1          		POP	IX
  E7E5  C9            		RET
                      	
  E7E6                	DWT16:
  E7E6  0E00          		LD	C,0
  E7E8                	DWT24:
  E7E8  0601          		LD	B,1
  E7EA                	DWT24B:
  E7EA  DDE5          		PUSH	IX
  E7EC  DD2AA8EC      		LD	IX,(_DPB)
  E7F0  CD4DEA        	DWTPAT:	CALL	FDWT		;自己書き換え（ディスク書き込み）
  E7F3  18EE          		JR	POP_IX_RET
                      	
  E7F5                	WTFAT:
  E7F5  CD13E8        		CALL	FATSETUP
  E7F8  D40EE8        		CALL	NC,WTFATL
  E7FB  D8            		RET	C
  E7FC  DDCB0F7E      		BIT	7,(IX+00FH)	;DPB_0F_BPS
  E800  C8            		RET	Z		;予備FATが無い
  E801  CD1AE8        		CALL	FATS2
  E804  E5            		PUSH	HL		;予備FAT
  E805  DD6E00        		LD	L,(IX+0)	;DPB_00_FATLN
  E808  DD6601        		LD	H,(IX+1)
  E80B  19            		ADD	HL,DE
  E80C  EB            		EX	DE,HL
  E80D  E1            		POP	HL
  E80E                	WTFATL:
  E80E  0E00          		LD	C,0
  E810  C3EAE7        		JP	DWT24B
                      	;------------------------
                      	;FATのセットアップ
                      	;out
                      	;	B  : FATセクタ数
                      	;	DE : FAT先頭セクタ番号
                      	;	HL : FATバッファポインタ
                      	;	CF : 1=ドライブ切り替えエラー
                      	;note
                      	;	FATサイズがFATバッファを超える場合は
                      	;	対象クラスタ領域==(_FATIX)によって
                      	;	FAT12:FATの前半3KBと後半3KBを切り替える
                      	;	FAT16:対象クラスタ1024毎に2KBを切り替える
                      	;------------------------
  E813                	FATSETUP:
  E813  3AAAEC        		LD	A,(_FATDRV)
  E816  CD3CE9        		CALL	CHGDRVR		;ドライブ切り替え
  E819  D8            		RET	C
  E81A                	FATS2:
  E81A  ED5BFAEB      		LD	DE,(_FATPS)	;fat sector pos
  E81E  C321E8        	FATSX:	JP	FATSETUP12	;自己書き換え
                      	
  E821                	FATSETUP12:
  E821  2A7CEC        		LD	HL,(_FATBF)
  E824  3E18          		LD	A,24		;3072 / 256 FATバッファに読み込めるセクタ数
  E826  DD460F        		LD	B,(IX+00FH)	;DPB_0F_BPS
  E829                	L_FATS2:
  E829  1F            		RRA			;CF=0 なので A=A/2
  E82A  CB18          		RR	B		;->CF
  E82C  30FB          		JR	NC,L_FATS2
                      	
  E82E  DD4600        		LD	B,(IX+0)	;DPB_00_FATLN
  E831  B8            		CP	B
  E832  D0            		RET	NC		;DPB_00_FATLN x sectorSize < fatBufSize
                      	;targetCluster
  E833  4F            		LD	C,A		;C = skipCount
  E834  3AABEC        		LD	A,(_FATIX)	;(targetCluster >= 0x800)
  E837  B7            		OR	A
  E838  2806          		JR	Z,FATS3
                      	;(targerCluster>=0x800)
  E83A                	FAT_SKP:
  E83A  13            		INC	DE		;FATPS++
  E83B  05            		DEC	B		;FATSIZE--
  E83C  0D            		DEC	C		;skipCnt--
  E83D  20FB          		JR	NZ,FAT_SKP
  E83F  48            		LD	C,B
  E840                	FATS3:
  E840  41            		LD	B,C		;3 or 6 or 12
  E841  AF            		XOR	A
  E842  C9            		RET
                      	
  E843                	FATSETUP16:
  E843  DD7E0F        		LD	A,(IX+00FH)	;DPB_0F_BPS 512=2 1024=4
  E846  0610          		LD	B,16		;2048 / 256 FATバッファに読み込むセクタ数 512=4/1024=2
  E848  67            		LD	H,A		;DPB_0F_BPS
  E849                	L_F16S2:
  E849  CB38          		SRL	B		;/2
  E84B  1F            		RRA			;->CF
  E84C  30FB          		JR	NC,L_F16S2
                      	
  E84E  7C            		LD	A,H		;DPB_0F_BPS
  E84F  2AABEC        		LD	HL,(_FATIX)	;範囲は0-63(0-03FH):65535*2/2048
  E852  2600          		LD	H,0
  E854  4D            		LD	C,L		;_FATIX
  E855                	L_F16S3:
  E855  29            		ADD	HL,HL
  E856  87            		ADD	A,A
  E857  CB5F          		BIT	3,A
  E859  28FA          		JR	Z,L_F16S3
                      	
  E85B  19            		ADD	HL,DE
  E85C  EB            		EX	DE,HL
                      	
  E85D  79            		LD	A,C		;_FATIX
  E85E  DD6E00        		LD	L,(IX+0)	;DPB_00_FATLN
  E861  2D            		DEC	L		;DPB_00_FATLN-1
  E862  AD            		XOR	L		;Lと同じか比較してCFを0に
  E863  2005          		JR	NZ,F16E		;FATバッファが最後の場合はFATセクタ数を調整
  E865  7D            		LD	A,L		;DPB_00_FATLN-1
  E866  05            		DEC	B
  E867  A0            		AND	B
  E868  47            		LD	B,A
  E869  04            		INC	B
  E86A                	F16E:
  E86A  2A7CEC        		LD	HL,(_FATBF)
  E86D  C9            		RET
                      	
  E86E                	CHGDRV:
  E86E  E5            		PUSH	HL
  E86F  2189EC        		LD	HL,_DSK
  E872  BE            		CP	(HL)
  E873  280A          		JR	Z,CHGDRVE
  E875                	CHGDRV1:
  E875  DDE5          		PUSH	IX
  E877  CD81E8        		CALL	CHGDRV0
  E87A  3A89EC        		LD	A,(_DSK)
  E87D  DDE1          		POP	IX
  E87F                	CHGDRVE:
  E87F  E1            		POP	HL
  E880  C9            		RET
                      	
  E881                	CHGDRV0:
  E881  6F            		LD	L,A
  E882  CDDCEC        		CALL	_GETDPB
  E885  D8            		RET	C
  E886  DD22A8EC      		LD	(_DPB),IX
  E88A  7D            		LD	A,L
  E88B  3289EC        		LD	(_DSK),A
  E88E                	CHGDRV2:
  E88E  F3            		DI
  E88F  C5            		PUSH	BC
  E890  D5            		PUSH	DE
  E891  ED73F1E8      		LD	(SPPAT2+1),SP
                      	
  E895  DDF9          		LD	SP,IX
                      	
  E897  E1            		POP	HL		;DPB_00_FATLN
  E898  E1            		POP	HL		;DPB_02_DRD
  E899  22E1E7        		LD	(DRDPAT+1),HL
                      	
  E89C  E1            		POP	HL
  E89D  22F1E7        		LD	(DWTPAT+1),HL	;DPB_04_DWT
                      	
  E8A0  E1            		POP	HL		;L=DPB_06_FATID H=DPB_07_SECPCL
  E8A1  7C            		LD	A,H
  E8A2  3258DF        		LD	(SPCPAT+1),A	;1クラスタの論理セクタ数
  E8A5  3D            		DEC	A
  E8A6  327DE6        		LD	(NCPAT+1),A
                      	
  E8A9  E1            		POP	HL		;DPB_08_MAXCL
  E8AA  7D            		LD	A,L
  E8AB  3277DF        		LD	(CLPAT2+1),A
  E8AE  7C            		LD	A,H
  E8AF  3273DF        		LD	(CLPAT1+1),A
  E8B2  2B            		DEC	HL
  E8B3  2277E1        		LD	(MAXCLP+1),HL
                      	
  E8B6  E1            		POP	HL		;L=DPB_0A_FDMODE H=DPB_0B_DIRSCNT
  E8B7  7D            		LD	A,L
  E8B8  F6FE          		OR	0FEH
  E8BA  32F6E9        		LD	(FDMODE+1),A
  E8BD  07            		RLCA
  E8BE  E603          		AND	3
  E8C0  32DEE9        		LD	(FSPAT+1),A
  E8C3  4C            		LD	C,H
                      	
  E8C4  E1            		POP	HL		;L=DPB_0C_MAXCYL H=DPB_0D_MAXSEC
  E8C5  7D            		LD	A,L
  E8C6  32A1EC        		LD	(_MAXCYL),A
  E8C9  7C            		LD	A,H
  E8CA  3287E9        		LD	(MAXSEC+1),A
                      	
  E8CD  E1            		POP	HL		;L=DPB_0E_FATPS H=DPB_0F_BPS
  E8CE  7C            		LD	A,H		;DPB_0F_BPS
  E8CF  E607          		AND	7
  E8D1  3294E4        		LD	(SECSZ+2),A	;1セクタのサイズの上位1バイト 0x400 - 0x200 - 0x100
                      					;1セクタ512 2D/2DD/2HC/2HQ(2HD1.44MB)等
                      					;1セクタ1024 2HD/EMM/BRAM
                      					;1セクタ256 GRAM等
                      					;1024	512	256
                      					;4	2	1
  E8D4  87            		ADD	A,A		;8	4	2
  E8D5  87            		ADD	A,A		;010H	8	4
  E8D6  87            		ADD	A,A		;020H	010H	8
  E8D7  32C7DD        		LD	(SDECPAT+1),A	;1セクタ辺りのディレクトリエントリ数
  E8DA  3D            		DEC	A		;01FH	00FH	7
  E8DB  3267D4        		LD	(SDECM1+1),A	;1セクタ辺りのディレクトリエントリ数-1
                      	
  E8DE  2600          		LD	H,0
  E8E0  22FAEB        		LD	(_FATPS),HL
                      	
  E8E3  E1            		POP	HL		;L=DPB_10_DIRPS
  E8E4  22FCEB        		LD	(_DIRPS),HL
                      	
  E8E7  E1            		POP	HL		;L=DPB_12_DEVICE H=DPB_13_UNITNO
  E8E8  7C            		LD	A,H
  E8E9  3284EC        		LD	(_DRIVE),A
                      	
  E8EC  E1            		POP	HL		;DPB_14_ADDCL16
  E8ED  2268DF        		LD	(CLSPAT+1),HL
                      	
  E8F0  310000        	SPPAT2:	LD	SP,0		;元のSPを復元
  E8F3  FB            		EI
  E8F4  2AFCEB        		LD	HL,(_DIRPS)
  E8F7  0600          		LD	B,0
  E8F9  09            		ADD	HL,BC
  E8FA  22E2DD        		LD	(MD_PAT+1),HL
                      	
  E8FD  2A77E1        		LD	HL,(MAXCLP+1);
  E900  11F60F        		LD	DE,4086
  E903  B7            		OR	A
  E904  ED52          		SBC	HL,DE
  E906  300F          		JR	NC,SETFAT16
  E908  2103E6        		LD	HL,GNCL		;FAT12
  E90B  1126E6        		LD	DE,SNCL
  E90E  0121E8        		LD	BC,FATSETUP12
  E911  DDCB0FAE      		RES	5,(IX+00FH)	;DPB_0F_BPS(FAT12)
  E915  180D          		JR	EXTRA1
  E917                	SETFAT16:
  E917  215AE6        		LD	HL,GNCL16	;FAT16
  E91A  1167E6        		LD	DE,SNCL16
  E91D  0143E8        		LD	BC,FATSETUP16
  E920  DDCB0FEE      		SET	5,(IX+00FH)	;DPB_0F_BPS(FAT16)
  E924                	EXTRA1:
  E924  22F8EC        		LD	(GNCPAT+1),HL
  E927  ED53FBEC      		LD	(SNCPAT+1),DE
  E92B  ED431FE8      		LD	(FATSX+1),BC
  E92F  D1            		POP	DE
  E930  C1            		POP	BC
  E931  AF            		XOR	A
  E932  C9            		RET
                      	
  E933                	GETDPBD:
  E933  DDE3          		EX	(SP),IX
  E935  DDE5          		PUSH	IX
  E937  3A88EC        		LD	A,(_DRV)
  E93A  1807          		JR	GETDPB1
                      	
  E93C                	CHGDRVR:
  E93C  CDD9EC        		CALL	_CHGDRV
  E93F  D8            		RET	C
  E940  3A89EC        		LD	A,(_DSK)
  E943                	GETDPB1:
  E943  C3DCEC        		JP	_GETDPB
                      	
  E946                	GETDPB:
  E946  FE08          		CP	8
  E948  3F            		CCF
  E949  D8            		RET	C
  E94A  0F            		RRCA
  E94B  0F            		RRCA
  E94C  0F            		RRCA
  E94D  DD            		DB	0DDH		;Z80未定義命令
  E94E  6F            		LD	L,A		;LD	IXL,A
  E94F  DD            		DB	0DDH		;Z80未定義命令
  E950  26ED          		LD	H,DEVICE/256	;LD	IXH,DEVICE/256
  E952  DD7E00        		LD	A,(IX+0)	;DPB_00_FATLN
  E955  B7            		OR	A		;CF=0の為
  E956  DDCB0F76      		BIT	6,(IX+00FH)	;DPB_0F_BPS
  E95A  C0            		RET	NZ		;FAT16
  E95B  DDCB126E      		BIT	5,(IX+012H)	;DPB_12_DEVICE
  E95F  C0            		RET	NZ		;BPB
  E960  FE01          		CP	001H		;A=0 THEN CF=1
  E962  C9            		RET
                      	
  E963                	FFLUSH:
  E963  F5            		PUSH	AF
  E964  3EFF          		LD	A,0FFH
  E966  3239EB        		LD	(SFILE),A
  E969  CD4DE5        		CALL	DWTX
  E96C  3EFF          		LD	A,0FFH
  E96E  32A5EC        		LD	(_DBDRV),A
  E971  CD97E5        		CALL	WTFATX
  E974  AF            		XOR	A
  E975  32ABEC        		LD	(_FATIX),A
  E978  2F            		CPL
  E979  32AAEC        		LD	(_FATDRV),A
  E97C  F1            		POP	AF
  E97D  C9            		RET
                      	
                      	
                      	;LDDISK.ASM
                      	
                      	;	LSX-Dodgers DISK
                      	
                      	
  E97E                	SEEK:
  E97E  7A            		LD	A,D
  E97F  B3            		OR	E
  E980  3E01          		LD	A,001H
  E982  2811          		JR	Z,DIV3
                      	
  E984  0610          		LD	B,16
  E986  0E00          	MAXSEC:	LD	C,000H
  E988  AF            		XOR	A
  E989  EB            		EX	DE,HL
  E98A                	DIV1:
  E98A  29            		ADD	HL,HL
  E98B  8F            		ADC	A,A
  E98C  B9            		CP	C
  E98D  3802          		JR	C,DIV2
  E98F  91            		SUB	C
  E990  2C            		INC	L
  E991                	DIV2:
  E991  10F7          		DJNZ	DIV1
                      	
  E993  3C            		INC	A	;最小のセクタは１固定
  E994  55            		LD	D,L	;Quotient(TRACK)
  E995                	DIV3:
  E995  5F            		LD	E,A	;Remainder
  E996  CB3A          		SRL	D	;CYLINDER
  E998  9F            		SBC	A,A
  E999  E610          		AND	010H	;SIDE
  E99B  4F            		LD	C,A
                      	
  E99C  3A84EC        		LD	A,(_DRIVE)
  E99F  FE04          		CP	4
  E9A1  3F            		CCF
  E9A2  D8            		RET	C
  E9A3  B1            		OR	C
  E9A4  3222EA        		LD	(MOPAT+1),A	;Motor off data
  E9A7  01FC0F        		LD	BC,00FFCH
  E9AA  F680          		OR	080H		;Mortor on
  E9AC  ED79          		OUT	(C),A
                      	
  E9AE  CDF4E9        		CALL	SETMODE
  E9B1  D8            		RET	C
                      	
  E9B2  CD37EA        		CALL	DRIVE
  E9B5  FEFF          		CP	0FFH		;A=0FFH Unknown CYLINDER
  E9B7  CC16EA        		CALL	Z,FDCRES	;Restore
  E9BA  0EF9          		LD	C,0F9H
  E9BC  ED79          		OUT	(C),A		;Currrent CYLINDER
  E9BE  92            		SUB	D
  E9BF  C8            		RET	Z		;No seek
                      	
  E9C0  3A86EC        		LD	A,(_ISEEK)
  E9C3  4F            		LD	C,A
                      	
  E9C4  3AA1EC        		LD	A,(_MAXCYL)	;Max CYLINDER
  E9C7  3D            		DEC	A
  E9C8  BA            		CP	D		;Over CYLINDER
  E9C9  D8            		RET	C
                      	
  E9CA  B9            		CP	C		;for Built-in 2DD
  E9CB  3803          		JR	C,SETM2
  E9CD  78            		LD	A,B		;B=00FH
  E9CE  DBFE          		IN	A,(0FEH)		;2HD mode for 2DD seek
  E9D0                	SETM2:
  E9D0  78            		LD	A,B
  E9D1  DBFD          		IN	A,(0FDH)		;MFM mode
                      	
  E9D3  0EFB          		LD	C,0FBH
  E9D5  ED51          		OUT	(C),D
  E9D7  72            		LD	(HL),D
  E9D8  0E18          		LD	C,018H		;Seek
  E9DA                	FDCCMD2:
  E9DA  3A85EC        		LD	A,(_SEEKSP)
  E9DD  E6FF          	FSPAT:	AND	0FFH
  E9DF  B1            		OR	C
                      	
  E9E0                	FDCCMD:
  E9E0  CD2DEA        		CALL	COMSET
                      	
  E9E3  3E80          	FDCPAT:	LD	A,080H		;FDC COMMAND(Self-rewriting)
  E9E5  E620          		AND	020H		;Write data Write track
  E9E7  3C            		INC	A
                      	
  E9E8                	SST:
  E9E8  0E00          		LD	C,0
  E9EA                	SST1:
  E9EA  0D            		DEC	C		; 4
  E9EB  20FD          		JR	NZ,SST1		;12 * 256 / 4 = About 1ms
  E9ED  3D            		DEC	A
  E9EE  20FA          		JR	NZ,SST1
                      	
  E9F0  3C            		INC	A		;A=1
  E9F1  CDFFE9        		CALL	READY
  E9F4                	SETMODE:
  E9F4  78            		LD	A,B		;B=00FH
  E9F5  DBFF          	FDMODE:	IN	A,(0FFH)		;Floppy mode(2D/2HD) (Self-rewriting)
                      	
  E9F7  78            		LD	A,B
  E9F8  DBFD          		IN	A,(0FDH)		;MFM mode
                      	
  E9FA  CD31EA        		CALL	DELAY0		;Head select time
  E9FD  3E81          		LD	A,081H
  E9FF                	READY:
  E9FF  3209EA        		LD	(WAITA+1),A
  EA02  E5            		PUSH	HL
  EA03  0EF8          		LD	C,0F8H
  EA05  61            		LD	H,C
  EA06                	READY2:
  EA06  ED78          		IN	A,(C)
  EA08  E681          	WAITA:	AND	081H		;NOT READY,BUSY
  EA0A  2808          		JR	Z,READYE
  EA0C  E3            		EX	(SP),HL		;wait 19clock
  EA0D  E3            		EX	(SP),HL		; //
  EA0E  2B            		DEC	HL
  EA0F  7C            		LD	A,H
  EA10  B5            		OR	L
  EA11  20F3          		JR	NZ,READY2
  EA13  37            		SCF
  EA14                	READYE:
  EA14  E1            		POP	HL
  EA15  C9            		RET
                      	
  EA16                	FDCRES:
  EA16  3600          		LD	(HL),0
  EA18  0E08          		LD	C,8
  EA1A  18BE          		JR	FDCCMD2
                      	
  EA1C                	FDMOFF:
  EA1C  F5            		PUSH	AF
  EA1D  C5            		PUSH	BC
  EA1E  01FC0F        		LD	BC,00FFCH	;Motor off
  EA21  3E00          	MOPAT:	LD	A,000H		;(Self-rewriting)
  EA23  ED79          		OUT	(C),A
  EA25  C1            		POP	BC
  EA26  F1            		POP	AF
  EA27  C9            		RET
                      	
  EA28                	SECSET:
  EA28  01FA0F        		LD	BC,00FFAH
  EA2B  ED59          		OUT	(C),E
  EA2D                	COMSET:
  EA2D  0EF8          		LD	C,0F8H
  EA2F  ED79          		OUT	(C),A
  EA31                	DELAY0:
  EA31  3E1A          		LD	A,26
  EA33                	DELAY:
  EA33  3D            		DEC	A
  EA34  20FD          		JR	NZ,DELAY
  EA36  C9            		RET
                      	
  EA37                	DRIVE:
  EA37  2A84EC        		LD	HL,(_DRIVE)
  EA3A  26EC          		LD	H,_CYL0/256
  EA3C  CBFD          		SET	7,L
  EA3E  7E            		LD	A,(HL)
  EA3F  C9            		RET
                      	
  EA40                	RNF:
  EA40  CD37EA        		CALL	DRIVE
  EA43  36FF          		LD	(HL),0FFH
  EA45  C9            		RET
                      	
  EA46  02            	RETRY:	DB	2
                      	
                      	
                      	;	FLOPPY DISK DRIVER(DMA)
                      	
                      	
  EA47                	WTTRK:
  EA47  0601          		LD	B,1
  EA49  3EF4          		LD	A,0F4H
  EA4B  1802          		JR	WTTRK1
  EA4D                	FDWT:
  EA4D  3EA0          		LD	A,0A0H
  EA4F                	WTTRK1:
  EA4F  32E4E9        		LD	(FDCPAT+1),A
  EA52  3E10          		LD	A,16
  EA54  180C          		JR	DISK
                      	
  EA56                	DISKOK:
  EA56  0601          	FDCNT:	LD	B,1
  EA58  100B          		DJNZ	DISK1
  EA5A  C9            		RET
                      	
  EA5B                	FDRD:
  EA5B  3E80          		LD	A,080H
  EA5D  32E4E9        		LD	(FDCPAT+1),A
  EA60  3E0E          		LD	A,14
                      	
  EA62                	DISK:
  EA62  3279EA        		LD	(DMAPAT+1),A
  EA65                	DISK1:
  EA65  78            		LD	A,B
  EA66  3257EA        		LD	(FDCNT+1),A
  EA69  22FBEA        		LD	(DMAD+11),HL
  EA6C                	DISKR:
  EA6C  3E02          		LD	A,2		;Retry count
  EA6E  3246EA        		LD	(RETRY),A
  EA71                	DISK2:
  EA71  D5            		PUSH	DE
  EA72  CD7EE9        		CALL	SEEK
  EA75  3843          		JR	C,ERRF
  EA77  F3            		DI
                      	
  EA78  3E0E          	DMAPAT:	LD	A,14		;自己書き換え
  EA7A  21F0EA        		LD	HL,DMAD
  EA7D  CD54DB        		CALL	SETDMA
  EA80  ED49          		OUT	(C),C		;OUT 01F87H,087H WR6 イネーブル
  EA82  3AE4E9        		LD	A,(FDCPAT+1)
  EA85  C5            		PUSH	BC
  EA86  CD28EA        		CALL	SECSET
  EA89  2AFBEA        		LD	HL,(DMAHL)
  EA8C  23            		INC	HL
  EA8D  1106BB        		LD	DE,0BB06H	;READ DMA
                      	
  EA90  3E03          		LD	A,3
  EA92  CDFFE9        		CALL	READY
  EA95  ED78          		IN	A,(C)
                      	
  EA97  C1            		POP	BC
  EA98  ED51          		OUT	(C),D		;読み出しマスク設定
  EA9A  ED59          		OUT	(C),E		;バイトカウンタ(LH)
  EA9C  ED58          		IN	E,(C)
  EA9E  ED50          		IN	D,(C)
  EAA0  19            		ADD	HL,DE
  EAA1  D1            		POP	DE
  EAA2  13            		INC	DE
  EAA3  FB            		EI
  EAA4  CD1CEA        		CALL	FDMOFF
  EAA7  B7            		OR	A
  EAA8  28AC          		JR	Z,DISKOK
  EAAA  1B            		DEC	DE
  EAAB  CB67          		BIT	4,A
  EAAD  C440EA        		CALL	NZ,RNF
  EAB0                	DISKE2:
  EAB0  2146EA        		LD	HL,RETRY
  EAB3  35            		DEC	(HL)
  EAB4  20BB          		JR	NZ,DISK2
  EAB6  B7            		OR	A
  EAB7  2834          		JR	Z,ERR
  EAB9  D5            		PUSH	DE
  EABA                	ERRF:
  EABA  D1            		POP	DE
  EABB                	DELP:
  EABB  CD40EA        		CALL	RNF
  EABE  CD1CEA        		CALL	FDMOFF
  EAC1  3A85EC        		LD	A,(_SEEKSP)
  EAC4  87            		ADD	A,A
  EAC5  9F            		SBC	A,A
  EAC6  3825          		JR	C,ERR
  EAC8                	DELP1:
  EAC8  D5            		PUSH	DE
  EAC9  21C0EB        		LD	HL,DEMES
  EACC  CDB3D3        		CALL	MSX
  EACF  CD45D7        		CALL	KEYBC
  EAD2                	DELP2:
  EAD2  CDCAEC        		CALL	_INKEY
  EAD5  28FB          		JR	Z,DELP2
                      	
  EAD7  D1            		POP	DE
  EAD8  CD79DF        		CALL	CAP
  EADB  FE52          		CP	'R'		;Retry
  EADD  CA6CEA        		JP	Z,DISKR
  EAE0  FE49          		CP	'I'		;Ignore
  EAE2  2807          		JR	Z,IGNORE
  EAE4  FE41          		CP	'A'		;Abort
  EAE6  20E0          		JR	NZ,DELP1
  EAE8  C300EB        		JP	BOOT
  EAEB                	IGNORE:
  EAEB  3EFF          		LD	A,0FFH
  EAED                	ERR:
  EAED  BF            		CP	A
  EAEE  37            		SCF
  EAEF  C9            		RET
                      	
                      				;X1turbo DISK DMA
  EAF0  C3            	DMAD:	DB	0C3H	;WR6 リセット
  EAF1  7D            		DB	07DH	;WR0 ポートA→ポートB 転送
  EAF2  FB0F          		DW	00FFBH	;ポートA開始アドレス FDC データレジスタ
  EAF4  FFFF          		DW	0FFFFH	;ブロック長(転送サイズ-1)
  EAF6  2C            		DB	02CH	;WR1 ポートAアドレス固定 I/O
  EAF7  10            		DB	010H	;WR2 ポートBインクリメント
  EAF8  80            		DB	080H	;WR3
  EAF9  92            		DB	092H	;WR5 WAIT RDY:LOW
  EAFA  8D            		DB	08DH	;WR4 バイト ポートB開始アドレス(LH)
  EAFB  0000          	DMAHL:	DW	0	;ポートB開始アドレス
  EAFD  CF            		DB	0CFH	;WR6 ロード
  EAFE  01            		DB	001H	;WR0 ポートB←ポートB 転送
  EAFF  CF            		DB	0CFH	;WR6 ロード
                      	
  EB00                	DMAE:
                      	
  1F84                	AT_R	EQU	WTTRK-AT_WTTRK
                      	
                      	;LDCALL.ASM
                      	
                      	;	LSX-Dodgers TABLES
                      	;
                      	;	CP/M互換BIOS
                      	;	BOOT:アドレス下位1バイトが0になるように
  EB00                	BOOT:
  EB00  C30000        		JP	0
  EB03                	_SYS00:		;(BDOS)プログラム終了
  EB03                	WBOOT:
  EB03  C350CC        		JP	WBOOT1
  EB06                	CONST_:
  EB06  C3FFD7        		JP	CONSTX
  EB09                	_SYS07:		;(BDOS)コンソール直接入力
  EB09                	CONIN:
  EB09  C3A6D7        		JP	FLGET
  EB0C                	CONOUT:
  EB0C  C345DA        		JP	CONOUT1
                      	
  EB0F                	DECBF:
  EB0F                		DS	5
  EB14  00            	FDRV	DB	0
  EB15                	FNAME	DS	36
  EB39                	SFILE:	DS	33		;DRV FILENAME
  EB5A                	HLBUF:	DS	3		;Random record buffer
                      	
  EB5D  0000          	LEFTX:	DW	0
  EB5F  0000          	DTAX:	DW	0
                      	
  EB61  008E01000B000C	BEEPD:	DB	0,08EH,1,0,00BH,0,00CH,010H
  EB69  073E08100D00FF		DB	007H,03EH,008H,010H,00DH,0,0FFH
                      	
  EB70  00            	CHECK:	DB	0
                      	
  EB71  4F4B24        	OK:	DB	"OK$"
  EB74  536B697024    	SKIP:	DB	"Skip$"
  EB79  4572726F722124	COMERM:	DB	"Error!$"
                      	
                      	;	CTRLTB:アドレス下位1バイトが080Hになるように
                      	
  EB80                	CTRLTB:
  EB80  84D91EDABCD906		DW	PRINTE,CTRL01,CTRL02,CTRL03
  EB88  00DBE7D9DFDA66		DW	CTRL04,CTRL05,CTRL06,CTRL07
  EB90  90D9ADD909DB24		DW	CTRL08,CTRL09,CTRL0A,CTRL0B
  EB98  DCDA0BDA1EDB84		DW	CTRL0C,CTRL0D,CTRL0E,PRINTE
  EBA0  84D984D91EDA84		DW	PRINTE,PRINTE,CTRL01,PRINTE
  EBA8  84D984D984D984		DW	PRINTE,PRINTE,PRINTE,PRINTE
  EBB0  84D984D9DCDA2B		DW	PRINTE,PRINTE,CTRL0C,CTRL1B
  EBB8  A7D990D99AD909		DW	CTRL1C,CTRL1D,CTRL1E,CTRL1F
                      	
  EBC0  0307          	DEMES:	DB	3,7
  EBC2  44657669636520		DB	"Device I/O Error",5,3
  EBD4  41626F72742052		DB	"Abort Retry Ignore?",5,3,0
                      	
  EBEA  1617          	SDDATA:	DB	22,23		;(FCB)ファイルを最後に変更した時刻
  EBEC  1415          		DB	20,21		;(FCB)ファイルを最後に変更した日付
  EBEE  1A1B          		DB	26,27		;(FCB)ファイルの先頭クラスタ
  EBF0  10111213      		DB	16,17,18,19	;(FCB)ファイルのサイズ(バイト単位)
  EBF4                	SDDATAE:
                      	
  EBF4                	SCDIR:	DS	2		;+14 +15
  EBF6                	SFBPS:	DS	2		;FBPS
  EBF8                	SFNDF:	DS	2		;FILEN DIRF
                      	
  EBFA  0000          	_FATPS:	DW	0
  EBFC  0000          	_DIRPS:	DW	0
  EBFE  0000          	_CLPS:	DW	0
                      	
  EC00                	_PE:
                      	
                      	;	LSX-Dodgers SYSTEM CALL
                      	;	STABLE:アドレス下位1バイトが0になるように
                      	
  EC00                	STABLE:
                      	;0
  EC00  03EB79D785D7F4		DW	_SYS00,_SYS01,_SYS02,_SYS03
  EC08  A2D3A2D38AD709		DW	_SYS04,_SYS05,_SYS06,_SYS07
  EC10  92D7A4D3CBD7F7		DW	_SYS08,_SYS09,_SYS0A,_SYS0B
  EC18  B9D3BFD3CED3E1		DW	_SYS0C,_SYS0D,_SYS0E,_SYS0F
                      	;1
  EC20  35D487D4EDD423		DW	_SYS10,_SYS11,_SYS12,_SYS13
  EC28  2BD549D566D55E		DW	_SYS14,_SYS15,_SYS16,_SYS17
  EC30  C7D5CCD5D1D5D7		DW	_SYS18,_SYS19,_SYS1A,_SYS1B
  EC38  A2D3FDD5A2D301		DW	_SYS1C,_SYS1D,_SYS1E,_SYS1F
                      	;2
  EC40  A2D39DD5B2D508		DW	_SYS20,_SYS21,_SYS22,_SYS23
  EC48  27D6A2D379E2A0		DW	_SYS24,_ERROR,_SYS26,_SYS27
  EC50  B2D530D60DD8F4		DW	_SYS28,_SYS29,_SYS2A,_SYS2B
  EC58  41D8F4DDA2D353		DW	_SYS2C,_SYS2D,_SYS2E,_SYS2F
                      	;3
  EC60  4DD6          		DW	_SYS30
                      	
                      	;LDWORK.ASM
                      	
                      	;	LSX-Dodgers WORK
                      	
  0004                	DDS	EQU	4
  EC62                	DDTB:
  EC62  434F4E20      		DB	"CON "
  EC66  7AD4          		DW	OPENDD
  EC68  41555820      		DB	"AUX "
  EC6C  7AD4          		DW	OPENDD
  EC6E  50524E20      		DB	"PRN "
  EC72  7AD4          		DW	OPENDD
  EC74  4E554C20      		DB	"NUL "
  EC78  7AD4          		DW	OPENDD
                      	
  EC7A                		DS	2
  EC7C  00EE          	_FATBF:	DW	FATBF
  EC7E  00FA          	_DTBUF:	DW	DTBUF
                      	
                      	;	_CYL0:アドレス下位1バイトが080Hになるように
  EC80  FF            	_CYL0:	DB	0FFH	;Cylinder
  EC81  FF            	_CYL1:	DB	0FFH	;Cylinder
  EC82  FF            	_CYL2:	DB	0FFH	;Cylinder
  EC83  FF            	_CYL3:	DB	0FFH	;Cylinder
  EC84  00            	_DRIVE:	DB	0	;unit number
  EC85  00            	_SEEKSP:DB	0	;Seek speed
  EC86  FF            	_ISEEK:	DB	0FFH	;
  EC87  00            	_DVSW:	DB	0
  EC88  00            	_DRV:	DB	0
  EC89  FF            	_DSK:	DB	0FFH
  EC8A  8000          	_DTA:	DW	00080H
  EC8C  0000          	_CTC:	DW	0
  EC8E  0000          	_TXADR:	DW	0
  EC90  0000          	_KEYPS:	DW	0
  EC92  00FF          	_KEYD:	DW	0FF00H
  EC94  C210          	_KEYSP:	DW	010C2H
  EC96  07            	_COLORF:DB	7
  EC97  18            	_LINE:	DB	LINE
                      	
  EC98  0000          	_FCB:	DW	0
  EC9A  0000          	_FBPS:	DW	0	;SEARCH FILES
  EC9C  0000          	_FBAD:	DW	0	;    //
  EC9E  00            	_FBCNT:	DB	0	;    //
  EC9F  00            	_FILEN:	DB	0
  ECA0  00            	_DIRF:	DB	0	;bit7:ディレクトリ bit0-6:セクタインデックス 
  ECA1  00            	_MAXCYL:DB	0
  ECA2  00            	_WTFATF:DB	0	;FATバッファの更新フラグ
  ECA3                			DS	1
  ECA4  00            	_WTDBF:	DB	0	;データバッファの更新フラグ
  ECA5  FF            	_DBDRV:	DB	0FFH	;データバッファにあるデータを読み込んだドライブ
  ECA6  0000          	_DBSEC:	DW	0	;データバッファにあるデータを読み込んだセクタ番号
  ECA8  0000          	_DPB:	DW	0
  ECAA  FF            	_FATDRV:DB	0FFH	;FATバッファに読み込んでいるドライブ
  ECAB  00            	_FATIX:	DB	0	;FATバッファに読み込んでいるインデックス
  ECAC  0000          	_FAKEFREE:	DW	0	;偽の残量（FATサイズが大きくなると重くなるのでその対策）
                      	
  ECAE                		DS	2
                      	
  ECB0  6F5059381F0219	CRTCD:	DB	06FH,050H,059H,038H,01FH,002H,019H,01CH
  ECB8  0007          		DB	000H,007H
  ECBA  80F8B0FF      		DW	0-80*LINE,0-80
  ECBE  0C            		DB	00CH
  ECBF  A0            	WK1FD0:	DB	0A0H
                      	
  ECC0  AFD6          	CTC0:	DW	INTCTCE
  ECC2  AFD6          	CTC1:	DW	INTCTCE
  ECC4  D1D6          	CTC2:	DW	INTCTC2
  ECC6  AFD6          	CTC3:	DW	INTCTCE
  ECC8  98D6          	INTVEC:	DW	INT
                      	
                      	;	JUMP
                      	
  ECCA  C339DC        	_INKEY:	JP	INKEY
  ECCD  C3CDD8        	_PRINT:	JP	PRINT
  ECD0  C3A4DB        	_SCRN:	JP	SCRN
  ECD3  C3CCDB        	_POS:	JP	POS
  ECD6  C310DA        	_LOC:	JP	LOC
  ECD9                	_CHGDRV:
  ECD9  C36EE8        		JP	CHGDRV
  ECDC                	_GETDPB:
  ECDC  C346E9        		JP	GETDPB
  ECDF                	_FFLUSH:
  ECDF  C363E9        		JP	FFLUSH
  ECE2                	_RDFATX:
  ECE2  C36DE5        		JP	RDFATX
  ECE5  C389E6        	_RDFAT:	JP	RDFAT
  ECE8  C347EA        	_WTTRK:	JP	WTTRK
  ECEB  C35BEA        	_FDRD:	JP	FDRD
  ECEE  C34DEA        	_FDWT:	JP	FDWT
  ECF1                	_BPB2DPB:
  ECF1  C3EEE6        		JP	BPB2DPB
  ECF4                		DS	3
  ECF7                	_GNCL:
  ECF7  C303E6        	GNCPAT:	JP	GNCL		;自己書き換え
  ECFA                	_SNCL:
  ECFA  C326E6        	SNCPAT:	JP	SNCL		;自己書き換え
  ECFD  C3D8CC        	_COMANL:JP	COMANL
                      	
  ED00                	WE:
                      	
                      	;LDDPB.ASM
                      	
                      	;	LSX-Dodgers DPB
                      	
  ED00                	DEVICE:
                      	
                      	;	A:
                      	
  ED00  0200          		DW	2	;DPB_00_FATLN
  ED02  EBEC          		DW	_FDRD	;DPB_02_DRD
  ED04  EEEC          		DW	_FDWT	;DPB_04_DWT
  ED06  FD            		DB	0FDH	;DPB_06_FATID
  ED07  02            		DB	2	;DPB_07_SECPCL
  ED08  6401          		DW	356	;DPB_08_MAXCL
  ED0A  FF            		DB	0FFH	;DPB_0A_FDMODE	0FFH=2D / 0FEH=2HD
  ED0B  07            		DB	7	;DPB_0B_DIRSCNT
  ED0C  28            		DB	40	;DPB_0C_MAXCYL
  ED0D  09            		DB	9	;DPB_0D_MAXSEC	Number of sectors
  ED0E  01            		DB	1	;DPB_0E_FATPS
  ED0F  82            		DB	082H	;DPB_0F_BPS
  ED10  0500          		DW	5	;DPB_10_DIRPS
  ED12  A7            		DB	0A7H	;DPB_12_DEVICE	Device Number
  ED13  00            		DB	0	;DPB_13_UNITNO
  ED14  0800          		DW	8	;DPB_14_ADDCL16
  ED16  0000          		DW	0	;DPB_16
  ED18  0000          		DW	0	;DPB_18
  ED1A  0000          		DW	0	;DPB_1A_SDIR
  ED1C  46444430      		DB	"FDD0"	;DPB_1C_NAME
                      	
                      	;	B:
                      	
  ED20  0200          		DW	2	;DPB_00_FATLN
  ED22  EBEC          		DW	_FDRD	;DPB_02_DRD
  ED24  EEEC          		DW	_FDWT	;DPB_04_DWT
  ED26  FD            		DB	0FDH	;DPB_06_FATID
  ED27  02            		DB	2	;DPB_07_SECPCL
  ED28  6401          		DW	356	;DPB_08_MAXCL
  ED2A  FF            		DB	0FFH	;DPB_0A_FDMODE	0FFH=2D / 0FEH=2HD
  ED2B  07            		DB	7	;DPB_0B_DIRSCNT
  ED2C  28            		DB	40	;DPB_0C_MAXCYL
  ED2D  09            		DB	9	;DPB_0D_MAXSEC	Number of sectors
  ED2E  01            		DB	1	;DPB_0E_FATPS
  ED2F  82            		DB	082H	;DPB_0F_BPS
  ED30  0500          		DW	5	;DPB_10_DIRPS
  ED32  A7            		DB	0A7H	;DPB_12_DEVICE	Device Number
  ED33  01            		DB	1	;DPB_13_UNITNO
  ED34  0800          		DW	8	;DPB_14_ADDCL16
  ED36  0000          		DW	0	;DPB_16
  ED38  0000          		DW	0	;DPB_18
  ED3A  0000          		DW	0	;DPB_1A_SDIR
  ED3C  46444431      		DB	"FDD1"	;DPB_1C_NAME
                      	
                      	;	C:
                      	
  ED40  0200          		DW	2	;DPB_00_FATLN
  ED42  EBEC          		DW	_FDRD	;DPB_02_DRD
  ED44  EEEC          		DW	_FDWT	;DPB_04_DWT
  ED46  FD            		DB	0FDH	;DPB_06_FATID
  ED47  02            		DB	2	;DPB_07_SECPCL
  ED48  6401          		DW	356	;DPB_08_MAXCL
  ED4A  FF            		DB	0FFH	;DPB_0A_FDMODE	0FFH=2D / 0FEH=2HD
  ED4B  07            		DB	7	;DPB_0B_DIRSCNT
  ED4C  28            		DB	40	;DPB_0C_MAXCYL
  ED4D  09            		DB	9	;DPB_0D_MAXSEC	Number of sectors
  ED4E  01            		DB	1	;DPB_0E_FATPS
  ED4F  82            		DB	082H	;DPB_0F_BPS
  ED50  0500          		DW	5	;DPB_10_DIRPS
  ED52  A7            		DB	0A7H	;DPB_12_DEVICE	Device Number
  ED53  02            		DB	2	;DPB_13_UNITNO
  ED54  0800          		DW	8	;DPB_14_ADDCL16
  ED56  0000          		DW	0	;DPB_16
  ED58  0000          		DW	0	;DPB_18
  ED5A  0000          		DW	0	;DPB_1A_SDIR
  ED5C  46444432      		DB	"FDD2"	;DPB_1C_NAME
                      	
                      	;	D:
                      	
  ED60  0200          		DW	2	;DPB_00_FATLN
  ED62  EBEC          		DW	_FDRD	;DPB_02_DRD
  ED64  EEEC          		DW	_FDWT	;DPB_04_DWT
  ED66  FD            		DB	0FDH	;DPB_06_FATID
  ED67  02            		DB	2	;DPB_07_SECPCL
  ED68  6401          		DW	356	;DPB_08_MAXCL
  ED6A  FF            		DB	0FFH	;DPB_0A_FDMODE	0FFH=2D / 0FEH=2HD
  ED6B  07            		DB	7	;DPB_0B_DIRSCNT
  ED6C  28            		DB	40	;DPB_0C_MAXCYL
  ED6D  09            		DB	9	;DPB_0D_MAXSEC	Number of sectors
  ED6E  01            		DB	1	;DPB_0E_FATPS
  ED6F  82            		DB	082H	;DPB_0F_BPS
  ED70  0500          		DW	5	;DPB_10_DIRPS
  ED72  A7            		DB	0A7H	;DPB_12_DEVICE
  ED73  03            		DB	3	;DPB_13_UNITNO
  ED74  0800          		DW	8	;DPB_14_ADDCL16
  ED76  0000          		DW	0	;DPB_16
  ED78  0000          		DW	0	;DPB_18
  ED7A  0000          		DW	0	;DPB_1A_SDIR
  ED7C  46444433      		DB	"FDD3"	;DPB_1C_NAME
                      	
                      	;	E:
                      	
  ED80  0000          	EMMFL:	DW	0	;DPB_00_FATLN
  ED82  29D3          	EMMRD:	DW	EDRD	;DPB_02_DRD
  ED84  25D3          	EMMWR:	DW	EDWT	;DPB_04_DWT
  ED86  FE            		DB	0FEH	;DPB_06_FATID
  ED87  02            		DB	2	;DPB_07_SECPCL
  ED88  0000          	EMMCL:	DW	0	;DPB_08_MAXCL
  ED8A  00            		DB	0	;DPB_0A_FDMODE
  ED8B  0C            		DB	12	;DPB_0B_DIRSCNT
  ED8C  00            	EMMBL:	DB	0	;DPB_0C_MAXCYL
  ED8D  01            		DB	1	;DPB_0D_MAXSEC
  ED8E  02            		DB	2	;DPB_0E_FATPS
  ED8F  02            		DB	2	;DPB_0F_BPS
  ED90  0A00          		DW	10	;DPB_10_DIRPS
  ED92  06            		DB	6	;DPB_12_DEVICE
  ED93  00            	EMMDV:	DB	0	;DPB_13_UNITNO
  ED94  1200          		DW	18	;DPB_14_ADDCL16
  ED96  0000          		DW	0	;DPB_16
  ED98  0000          		DW	0	;DPB_18
  ED9A  0000          		DW	0	;DPB_1A_SDIR
  ED9C  454D4D30      		DB	"EMM0"	;DPB_1C_NAME
                      	
                      	;	F:
                      	
  EDA0  0000          	BANKFL:	DW	0	;DPB_00_FATLN
  EDA2  C0D2          		DW	BDRD	;DPB_02_DRD
  EDA4  BCD2          		DW	BDWT	;DPB_04_DWT
  EDA6  F9            		DB	0F9H	;DPB_06_FATID
  EDA7  02            		DB	2	;DPB_07_SECPCL
  EDA8  0000          	BANKCL:	DW	0	;DPB_08_MAXCL
  EDAA  00            		DB	0	;DPB_0A_FDMODE
  EDAB  08            		DB	8	;DPB_0B_DIRSCNT
  EDAC  00            		DB	0	;DPB_0C_MAXCYL
  EDAD  01            		DB	1	;DPB_0D_MAXSEC
  EDAE  00            		DB	0	;DPB_0E_FATPS
  EDAF  02            		DB	2	;DPB_0F_BPS
  EDB0  0200          		DW	2	;DPB_10_DIRPS
  EDB2  0B            		DB	00BH	;DPB_12_DEVICE
  EDB3  00            		DB	0	;DPB_13_UNITNO
  EDB4  0600          		DW	6	;DPB_14_ADDCL16
  EDB6  0000          		DW	0	;DPB_16
  EDB8  0000          		DW	0	;DPB_18
  EDBA  0000          		DW	0	;DPB_1A_SDIR
  EDBC  4252414D      		DB	"BRAM"	;DPB_1C_NAME
                      	
                      	;	G:
                      	
  EDC0  0100          		DW	1	;DPB_00_FATLN
  EDC2  7DD2          		DW	GDRD	;DPB_02_DRD
  EDC4  94D2          		DW	GDWT	;DPB_04_DWT
  EDC6  F9            		DB	0F9H	;DPB_06_FATID
  EDC7  04            		DB	4	;DPB_07_SECPCL
  EDC8  3000          		DW	48	;DPB_08_MAXCL
  EDCA  00            		DB	0	;DPB_0A_FDMODE
  EDCB  04            		DB	4	;DPB_0B_DIRSCNT
  EDCC  00            		DB	0	;DPB_0C_MAXCYL
  EDCD  01            		DB	1	;DPB_0D_MAXSEC
  EDCE  00            		DB	0	;DPB_0E_FATPS
  EDCF  01            		DB	1	;DPB_0F_BPS
  EDD0  0400          		DW	4	;DPB_10_DIRPS
  EDD2  05            		DB	5	;DPB_12_DEVICE
  EDD3  01            		DB	1	;DPB_13_UNITNO
  EDD4  0000          		DW	0	;DPB_14_ADDCL16
  EDD6  0000          		DW	0	;DPB_16
  EDD8  0000          		DW	0	;DPB_18
  EDDA  0000          		DW	0	;DPB_1A_SDIR
  EDDC  4752414D      		DB	"GRAM"	;DPB_1C_NAME
                      	
                      	
                      	
  EDE0  00            	LDEND:	DB	0
                      	
  EDE1                		END
