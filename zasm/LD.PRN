			  Z80 ASSEMBLER - ZASM VER 1.6
                      	;	LSX-Dodgers for X1/turbo/Z
                      	;	Programmed by
                      	;	Gaku (Lovers/Tablacus)
                      	
  C600                	RUN	EQU	0C600h
                      	
  C5F9                		ORG	RUN-7
                      	
                      	;	MSX BINARY HEADER
  C5F9  FE            		DB	0FEH
                      	;	MSX BINARY START ADDRESS
  C5FA  00C6          		DW	RUN
                      	;	MSX BINARY END ADDRESS
  C5FC  E0ED          		DW	LDEND
                      	;	MSX BINARY EXEC ADDRESS
  C5FE  00C6          		DW	RUN
                      	;LDDEF.ASM
                      	
                      	;	LSX-Dodgers DEF
                      	
  1D90                	MAC	EQU	01D90H		;X1
  0001                	VER_1   EQU	1
  0003                	VER_2   EQU	3
  0005                	VER_3   EQU	5
  0135                	VER	EQU	VER_1 * 256 + VER_2 * 16 + VER_3
                      	
  0000                	STACK	EQU	00000H
  0005                	SYSTEM	EQU	00005H
  000F                	JP_HL	EQU	0000FH
  005C                	FCB1	EQU	0005CH
  006C                	FCB2	EQU	0006CH
  0080                	DTA1	EQU	00080H
  00DB                	FDRV	EQU	00100H-37
  00DC                	FNAME	EQU	FDRV+1
  00D6                	DECBF	EQU	FDRV-5
  EE00                	FATBF	EQU	0EE00H
  FA00                	DTBUF	EQU	0FA00H
  FE00                	KEYBF	EQU	0FE00H
  FF00                	KBUF	EQU	0FF00H
  FF51                	DTA	EQU	KBUF+81
  FFD4                	EXTSP	EQU	0FFD4H
  0019                	LINE	EQU	25
                      	
                      	;LDINIT.ASM
                      	
                      	;	LSX-Dodgers INIT
                      	
  C600  C307C6        		JP	START
  C603  901D          	MACHINE:DW	MAC
  C605  3501          	VERSION:DW	VER
                      	
  C607                	START:
  C607  F3            		DI
  C608  ED5E          		IM	2
  C60A  310000        		LD	SP,STACK
  C60D  CD1BC6        		CALL	INIT		;NZならAUTOEXECを実行
  C610  210000        		LD	HL,0
  C613  E5            		PUSH	HL
  C614  C8            		RET	Z
  C615  11A6C9        		LD	DE,AUTOD
  C618  C3FDEC        		JP	_COMANL
                      	
  C61B                	INIT:
  C61B  3E1E          		LD	A,01EH
  C61D  D300          		OUT	(0),A
                      	
  C61F  010000        		LD	BC,0
  C622  ED438CEC      		LD	(_CTC),BC
  C626  01040A        		LD	BC,00A04H
  C629  CD60C9        		CALL	CHKCTC
  C62C  010407        		LD	BC,00704H
  C62F  CD60C9        		CALL	CHKCTC
  C632  01A81F        		LD	BC,01FA8H
  C635  CD60C9        		CALL	CHKCTC
  C638  01A01F        		LD	BC,01FA0H
  C63B  CD60C9        		CALL	CHKCTC
                      	;
  C63E                	INISIO:
  C63E  01911F        		LD	BC,01F91H	;INIT SIO
  C641  1601          		LD	D,1
  C643  ED51          		OUT	(C),D
                      	
  C645  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  C647  0E93          		LD	C,093H
  C649  ED51          		OUT	(C),D
  C64B  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  C64D  0E99          		LD	C,099H		;INIT SIO
  C64F  1601          		LD	D,1
  C651  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  C653  0E9B          		LD	C,09BH
  C655  ED51          		OUT	(C),D
  C657  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
                      	
  C659  0E80          		LD	C,080H		;INIT DMA
  C65B  2106C3        		LD	HL,0C306H
  C65E                	INIDMA:
  C65E  ED61          		OUT	(C),H
  C660  2D            		DEC	L
  C661  20FB          		JR	NZ,INIDMA
                      	
  C663  3EE4          		LD	A,0E4H
  C665  CDAFDA        		CALL	COMOUT
  C668  AF            		XOR	A
  C669  CD89DA        		CALL	OT49SB
                      	
  C66C  3EEC          		LD	A,INTVEC/256
  C66E  ED47          		LD	I,A
                      	
  C670  ED4B8CEC      		LD	BC,(_CTC)
  C674  0B            		DEC	BC
  C675  0B            		DEC	BC
                      	
  C676  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  C678  3EC0          		LD	A,CTC0
  C67A  ED79          		OUT	(C),A
                      	
  C67C  0C            		INC	C
  C67D  3E47          		LD	A,047H
  C67F  ED79          		OUT	(C),A
  C681  3E0D          		LD	A,13		;Baudrate 9600-13
  C683  ED79          		OUT	(C),A
                      	
  C685  79            		LD	A,C
  C686  D610          		SUB	010H
  C688  4F            		LD	C,A
                      	;	LD	(SIOAD+1),BC
                      	;	LD	(SIOAD0+1),BC
                      	;	LD	(SIOAD1+1),BC
                      	
  C689  2108CA        		LD	HL,SIODATA
  C68C                	SINIT1:
  C68C  7E            		LD	A,(HL)
  C68D  23            		INC	HL
  C68E  FEFF          		CP	0FFH
  C690  2804          		JR	Z,SINIT2
  C692  ED79          		OUT	(C),A
  C694  18F6          		JR	SINIT1
  C696                	SINIT2:
  C696  3EE4          		LD	A,0E4H
  C698  CDAFDA        		CALL	COMOUT
  C69B  3EC8          		LD	A,INTVEC
  C69D  CD89DA        		CALL	OT49SB
                      	;
  C6A0  01C41F        		LD	BC,01FC4H
  C6A3  3E0C          		LD	A,00CH
  C6A5  ED79          		OUT	(C),A
                      	
  C6A7  0EC0          		LD	C,0C0H
  C6A9  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
                      	
  C6AB  0C            		INC	C
  C6AC  3E28          		LD	A,40
  C6AE  ED79          		OUT	(C),A
                      	
  C6B0  0C            		INC	C
  C6B1  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
                      	
  C6B3  0C            		INC	C
  C6B4  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
                      	
  C6B6  0EC5          		LD	C,0C5H
  C6B8  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
                      	
  C6BA                	TEXT:
  C6BA  0EB0          		LD	C,0B0H
  C6BC  3E80          		LD	A,080H
  C6BE  ED79          		OUT	(C),A
  C6C0  1607          		LD	D,7
  C6C2  0EB9          		LD	C,0B9H
  C6C4  2101CA        		LD	HL,TEXTDT
  C6C7                	TEXT1:
  C6C7  04            		INC	B
  C6C8  EDA3          		OUTI
  C6CA  0C            		INC	C
  C6CB  15            		DEC	D
  C6CC  20F9          		JR	NZ,TEXT1
  C6CE  01B01F        		LD	BC,01FB0H
  C6D1  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
                      	
  C6D3  0EC4          		LD	C,0C4H
  C6D5  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
                      	
  C6D7  01011A        		LD	BC,01A01H
  C6DA  ED78          		IN	A,(C)
  C6DC  E608          		AND	8
  C6DE  2809          		JR	Z,PRN
  C6E0  0E03          		LD	C,003H
  C6E2  3E0F          		LD	A,00FH
  C6E4  ED79          		OUT	(C),A
  C6E6  01040A        		LD	BC,00A04H
  C6E9                	PRN:
  C6E9  110100        		LD	DE,1
  C6EC  62            		LD	H,D
  C6ED  6A            		LD	L,D
  C6EE  017F00        		LD	BC,07FH
  C6F1  36FF          		LD	(HL),0FFH
  C6F3  EDB0          		LDIR
  C6F5  017F00        		LD	BC,07FH
  C6F8  3600          		LD	(HL),0
  C6FA  EDB0          		LDIR
                      	
  C6FC  3EC3          		LD	A,0C3H		;JP
  C6FE  2165D3        		LD	HL,WBOOT
  C701  320000        		LD	(00000H),A
  C704  220100        		LD	(00001H),HL	;IPL
                      	
  C707  2A03C6        		LD	HL,(MACHINE)	;3 bit7  DPB Original(1)
                      					;  bit6-4 DPB_LEVEL
  C70A  220300        		LD	(00003H),HL	;  bit3-0 Machine X1(0)
                      	;				;4 LSX-Dodgers(01DH)
  C70D  2106CC        		LD	HL,BDOS
  C710  320500        		LD	(00005H),A
  C713  220600        		LD	(00006H),HL	;BDOS
                      	
  C716  2175D6        		LD	HL,BIOS
  C719  321800        		LD	(00018H),A	;BIOS-ROM
  C71C  221900        		LD	(00019H),HL
                      	
  C71F  210000        		LD	HL,0
  C722  323800        		LD	(00038H),A	;RST038H
  C725  223900        		LD	(00039H),HL
                      	
  C728  3EEC          		LD	A,STABLE/256
  C72A  320B00        		LD	(0000BH),A
                      	
  C72D  3EE9          		LD	A,0E9H		;JP (HL)
  C72F  320F00        		LD	(0000FH),A
                      	
  C732  3A7DEC        		LD	A,(_FATBF+1)
  C735  321300        		LD	(00013H),A
                      	
  C738  3A7FEC        		LD	A,(_DTBUF+1)
  C73B  321700        		LD	(00017H),A
                      	
  C73E  3EFE          		LD	A,KEYBF/256
  C740  321B00        		LD	(0001BH),A
                      	
  C743  3EFF          		LD	A,KBUF/256
  C745  321F00        		LD	(0001FH),A
                      	
  C748  2A05C6        		LD	HL,(VERSION)
  C74B  225A00        		LD	(0005AH),HL
                      	
  C74E  3EE6          		LD	A,0E6H
  C750  CDAFDA        		CALL	COMOUT
  C753  CD94DA        		CALL	IN49SB
  C756  F5            		PUSH	AF
  C757  CD94DA        		CALL	IN49SB
  C75A  F1            		POP	AF
  C75B  F5            		PUSH	AF
  C75C  E612          		AND	012H
  C75E  2005          		JR	NZ,KEYR
  C760  3E01          		LD	A,1
  C762  32C7C8        		LD	(KEYREP+1),A
  C765                	KEYR:
  C765  F1            		POP	AF
  C766  E603          		AND	3
  C768  280E          		JR	Z,NON
                      	
  C76A  01D03F        		LD	BC,03FD0H
  C76D  ED49          		OUT	(C),C
  C76F  3E37          		LD	A,037H
  C771  D3D0          		OUT	(0D0H),A
  C773  ED78          		IN	A,(C)
  C775  B9            		CP	C
  C776  2878          		JR	Z,TURBO
  C778                	NON:
  C778  3D            		DEC	A		;A=0FFH
  C779  321800        		LD	(00018H),A	;BIOS-ROM
                      	
  C77C  2114CA        		LD	HL,AT_SCR1
  C77F  1139DB        		LD	DE,SCR1
  C782  019F00        		LD	BC,SCRNX-SCR1	;転送先のサイズ確認用
  C785  019F00        		LD	BC,AT_SCRE-AT_SCR1
  C788  EDB0          		LDIR
                      	
  C78A  21B3CA        		LD	HL,AT_WTTRK
  C78D  11B9EA        		LD	DE,WTTRK
  C790  01B700        		LD	BC,DMAE-WTTRK	;転送先のサイズ確認用
  C793  019B00        		LD	BC,AT_CPUE-AT_WTTRK
  C796  EDB0          		LDIR
                      	
  C798  214ECB        		LD	HL,AT_EDWTC
  C79B  111BD3        		LD	DE,EDWTC
  C79E  014700        		LD	BC,EMME-EDWTC	;転送先のサイズ確認用
  C7A1  014300        		LD	BC,AT_EMME-AT_EDWTC
  C7A4  EDB0          		LDIR
                      	
  C7A6  210DEB        		LD	HL,AT_DRD+AT_R
  C7A9  22ECEC        		LD	(_FDRD+1),HL
  C7AC  21BDEA        		LD	HL,AT_DWT+AT_R
  C7AF  22EFEC        		LD	(_FDWT+1),HL
  C7B2  212FD3        		LD	HL,AT_EDRDC+AT_RE
  C7B5  2282ED        		LD	(EMMRD),HL
  C7B8  211BD3        		LD	HL,AT_EDWTC+AT_RE
  C7BB  2284ED        		LD	(EMMWR),HL
                      	
  C7BE  3E27          		LD	A,027H			;ノンターボはMFM切り替えを行わない
  C7C0  3212ED        		LD	(DEVICE+012H),A		;Aドライブ
  C7C3  3232ED        		LD	(DEVICE+012H+32),A	;Bドライブ
  C7C6  3252ED        		LD	(DEVICE+012H+32*2),A	;Cドライブ
  C7C9  3272ED        		LD	(DEVICE+012H+32*3),A	;Dドライブ
                      	
  C7CC  210000        		LD	HL,0
  C7CF  22DADA        		LD	(X1PAT),HL
                      	
  C7D2  3EAF          		LD	A,0AFH		;XOR	A
  C7D4  32EAD8        		LD	(X1KPAT),A
                      	
  C7D7  21D8DB        		LD	HL,SCRNX
  C7DA  22D1EC        		LD	(_SCRN+1),HL
                      	
  C7DD  CD87C9        		CALL	SETCRTC
  C7E0  0610          		LD	B,010H		;PALET
  C7E2  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  C7E4  04            		INC	B
  C7E5  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  C7E7  04            		INC	B
  C7E8  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  C7EA  04            		INC	B
  C7EB  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  C7ED  C383C8        		JP	NOBANK
                      	
  C7F0                	TURBO:
  C7F0  F3            		DI			;Check BIOS
  C7F1  061D          		LD	B,01DH
  C7F3  ED79          		OUT	(C),A		;BIOS ON
  C7F5  3A512F        		LD	A,(02F51H)
  C7F8  04            		INC	B		;B=01EH
  C7F9  ED79          		OUT	(C),A		;BIOS OFF
  C7FB  FB            		EI
  C7FC  FEC9          		CP	0C9H
  C7FE  280B          		JR	Z,BIOSOK
  C800  3EAF          		LD	A,0AFH		;XOR	A
  C802  32EAD8        		LD	(X1KPAT),A
  C805  21D8DB        		LD	HL,SCRNX
  C808  22D1EC        		LD	(_SCRN+1),HL
  C80B                	BIOSOK:
  C80B  3E1F          		LD	A,01FH
  C80D  DBF0          		IN	A,(0F0H)
  C80F  0F            		RRCA
  C810  380B          		JR	C,CRT1
  C812  21F1C9        		LD	HL,_C8025H
  C815  11B0EC        		LD	DE,CRTCD
  C818  011000        		LD	BC,16
  C81B  EDB0          		LDIR
  C81D                	CRT1:
  C81D  CD87C9        		CALL	SETCRTC
  C820  01AA10        		LD	BC,010AAH	;PALET
  C823  ED49          		OUT	(C),C
  C825  01CC11        		LD	BC,011CCH
  C828  ED49          		OUT	(C),C
  C82A  01F012        		LD	BC,012F0H
  C82D  ED49          		OUT	(C),C
  C82F  04            		INC	B
  C830  ED71          		DB	0EDH,071H
                      	
  C832  3E1F          		LD	A,01FH		;スタートポート
  C834  DBF0          		IN	A,(0F0H)
  C836  CB57          		BIT	2,A
  C838  2818          		JR	Z,BANK
                      	
  C83A  AF            		XOR	A
  C83B                	TZ1:				;前面スイッチが2HDの場合はMFMモードを2HDにしておく
  C83B  F5            		PUSH	AF
  C83C  CDDCEC        		CALL	_GETDPB
  C83F  DD7E12        		LD	A,(IX+012H)	;DPB_12_DEVICE
  C842  E68F          		AND	08FH
  C844  FE87          		CP	087H		;フロッピーでMEM切り替えがON
  C846  2004          		JR	NZ,TZ2
  C848  DDCB0A86      		RES	0,(IX+0AH)	;(DPB_0A_FDMODE)
  C84C                	TZ2:
  C84C  F1            		POP	AF
  C84D  3C            		INC	A
  C84E  FE08          		CP	8
  C850  38E9          		JR	C,TZ1
                      	
  C852                	BANK:
  C852  01000B        		LD	BC,00B00H
  C855  21007F        		LD	HL,07F00H
  C858  F3            		DI
  C859                	BANK1:
  C859  ED69          		OUT	(C),L
  C85B  5E            		LD	E,(HL)
  C85C  7B            		LD	A,E
  C85D  C6A5          		ADD	A,0A5H
  C85F  77            		LD	(HL),A
  C860  BE            		CP	(HL)
  C861  73            		LD	(HL),E
  C862  2005          		JR	NZ,BANK2
  C864  2C            		INC	L
  C865  CB65          		BIT	4,L
  C867  28F0          		JR	Z,BANK1
  C869                	BANK2:
  C869  3E10          		LD	A,010H
  C86B  ED79          		OUT	(C),A
  C86D  7D            		LD	A,L
  C86E  B7            		OR	A
  C86F  2812          		JR	Z,NOBANK
  C871  2600          		LD	H,0
  C873  29            		ADD	HL,HL	;*2
  C874  29            		ADD	HL,HL	;*4
  C875  29            		ADD	HL,HL	;*8
  C876  29            		ADD	HL,HL	;*16
  C877  29            		ADD	HL,HL	;*32
  C878  2B            		DEC	HL	;-1
  C879  2B            		DEC	HL	;-2
  C87A  2B            		DEC	HL	;-3
  C87B  22A8ED        		LD	(BANKCL),HL
  C87E  3E01          		LD	A,1
  C880  32A0ED        		LD	(BANKFL),A
  C883                	NOBANK:
  C883                	EMM:
  C883  CD50C9        		CALL	EADR0
  C886  ED78          		IN	A,(C)
  C888  F5            		PUSH	AF
                      	
  C889  110000        		LD	DE,0
  C88C                	ECHECK1:
  C88C  13            		INC	DE
  C88D  CD33C9        		CALL	EADR2
  C890  ED60          		IN	H,(C)
  C892  CD33C9        		CALL	EADR2
  C895  7C            		LD	A,H
  C896  C6E5          		ADD	A,0E5H
  C898  ED79          		OUT	(C),A
  C89A  3C            		INC	A
  C89B  CD50C9        		CALL	EADR0
  C89E  ED79          		OUT	(C),A
  C8A0  3D            		DEC	A
  C8A1  CD33C9        		CALL	EADR2
  C8A4  ED68          		IN	L,(C)
  C8A6  CD33C9        		CALL	EADR2
  C8A9  ED61          		OUT	(C),H
  C8AB  BD            		CP	L
  C8AC  2004          		JR	NZ,ECHECK2
  C8AE  CB5A          		BIT	3,D
  C8B0  28DA          		JR	Z,ECHECK1
  C8B2                	ECHECK2:
  C8B2  CD50C9        		CALL	EADR0
  C8B5  F1            		POP	AF
  C8B6  ED79          		OUT	(C),A
                      	
  C8B8  21F7FF        		LD	HL,0-9
  C8BB  19            		ADD	HL,DE
  C8BC  3008          		JR	NC,NOEMM
  C8BE  2288ED        		LD	(EMMCL),HL
  C8C1  3E03          		LD	A,3
  C8C3  3280ED        		LD	(EMMFL),A
  C8C6                	NOEMM:
  C8C6  3E00          	KEYREP:	LD	A,000H
  C8C8  B7            		OR	A
  C8C9  2807          		JR	Z,KEYR1
  C8CB  010000        		LD	BC,0
  C8CE  ED438CEC      		LD	(_CTC),BC
  C8D2                	KEYR1:
  C8D2  0130F8        		LD	BC,0-80*25
  C8D5  2ABAEC        		LD	HL,(CRTCD+10)
  C8D8  ED43BAEC      		LD	(CRTCD+10),BC
  C8DC  1E0C          		LD	E,00CH
  C8DE  CDCDEC        		CALL	_PRINT
  C8E1  22BAEC        		LD	(CRTCD+10),HL
                      	
  C8E4  21B2C9        		LD	HL,INIMES
  C8E7  CD5DD8        		CALL	MSX
                      	
  C8EA  3A87FF        		LD	A,(0FF87H)
  C8ED  FE08          		CP	8
  C8EF  301E          		JR	NC,INIT0
  C8F1  5F            		LD	E,A
  C8F2  C641          		ADD	A,'A'
  C8F4  32AFC9        		LD	(AUTODV),A
  C8F7  0E0E          		LD	C,00EH
  C8F9  CD0500        		CALL	SYSTEM
  C8FC  1C            		INC	E
  C8FD  2185EC        		LD	HL,_SEEKSP	;Disk error Ignore
  C900  CBFE          		SET	7,(HL)
  C902  0E1B          		LD	C,01BH
  C904  CD0500        		CALL	SYSTEM
                      	
  C907  2185EC        		LD	HL,_SEEKSP
  C90A  CBBE          		RES	7,(HL)
                      	
  C90C  3C            		INC	A
  C90D  2008          		JR	NZ,INIT1
  C90F                	INIT0:
  C90F  1E00          		LD	E,0
  C911  0E0E          		LD	C,00EH
  C913  CD0500        		CALL	SYSTEM
  C916  AF            		XOR	A
  C917                	INIT1:
  C917  2100FF        		LD	HL,0FF00H
  C91A  1101FF        		LD	DE,0FF01H
  C91D  01FF00        		LD	BC,000FFH
  C920  75            		LD	(HL),L
  C921  EDB0          		LDIR
                      	
  C923  B7            		OR	A
  C924  C8            		RET	Z
                      	
  C925  3EE6          		LD	A,0E6H
  C927  CDAFDA        		CALL	COMOUT
  C92A  CD94DA        		CALL	IN49SB
  C92D  CD94DA        		CALL	IN49SB
  C930  FE1B          		CP	01BH
  C932  C9            		RET
                      	
  C933                	EADR2:
  C933  D5            		PUSH	DE
  C934  EB            		EX	DE,HL
  C935  29            		ADD	HL,HL
  C936  29            		ADD	HL,HL
  C937  ED4B8BED      		LD	BC,(EMMBL-1)
  C93B  0E00          		LD	C,0
  C93D  09            		ADD	HL,BC
  C93E  ED4B93ED      		LD	BC,(EMMDV)
  C942  060D          		LD	B,00DH
  C944  ED49          		OUT	(C),C
  C946  0C            		INC	C
  C947  ED69          		OUT	(C),L
  C949  0C            		INC	C
  C94A  ED61          		OUT	(C),H
  C94C  0C            		INC	C
  C94D  EB            		EX	DE,HL
  C94E  D1            		POP	DE
  C94F  C9            		RET
                      	
  C950                	EADR0:
  C950  ED4B93ED      		LD	BC,(EMMDV)
  C954  060D          		LD	B,00DH
  C956  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  C958  0C            		INC	C
  C959  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  C95B  0C            		INC	C
  C95C  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  C95E  0C            		INC	C
  C95F  C9            		RET
                      	
  C960                	CHKCTC:
  C960  C5            		PUSH	BC
  C961  110347        		LD	DE,04703H
  C964                	INICTC1:
  C964  0C            		INC	C
  C965  ED51          		OUT	(C),D
  C967  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  C969  1D            		DEC	E
  C96A  20F8          		JR	NZ,INICTC1
  C96C  C1            		POP	BC
                      	
  C96D  11FA07        		LD	DE,007FAH
  C970  ED51          		OUT	(C),D
  C972  ED59          		OUT	(C),E
  C974  ED78          		IN	A,(C)
  C976  BB            		CP	E
  C977  C0            		RET	NZ
  C978  ED51          		OUT	(C),D
  C97A  ED51          		OUT	(C),D
  C97C  ED78          		IN	A,(C)
  C97E  BA            		CP	D
  C97F  C0            		RET	NZ
  C980  03            		INC	BC
  C981  03            		INC	BC
  C982  ED438CEC      		LD	(_CTC),BC
  C986  C9            		RET
                      	
  C987                	SETCRTC:
  C987  21B0EC        		LD	HL,CRTCD
  C98A  AF            		XOR	A
  C98B                	SETCRT1:
  C98B  010018        		LD	BC,01800H
  C98E  ED79          		OUT	(C),A
  C990  0C            		INC	C
  C991  04            		INC	B
  C992  EDA3          		OUTI
  C994  3C            		INC	A
  C995  FE0C          		CP	12
  C997  20F2          		JR	NZ,SETCRT1
  C999  23            		INC	HL
  C99A  23            		INC	HL
  C99B  01031B        		LD	BC,01A03H+00100H
  C99E  EDA3          		OUTI
  C9A0  01D020        		LD	BC,01FD0H+00100H
  C9A3  EDA3          		OUTI
  C9A5  C9            		RET
                      	
  C9A6  4155544F455845	AUTOD:	DB	"AUTOEXEC "
  C9AF  413A00        	AUTODV:	DB	"A:",0
                      	
  C9B2  4C53582D446F64	INIMES:	DB	"LSX-Dodgers for X1/turbo version "
  C9D3  312E          		DB	030H + VER_1, '.'
  C9D5  3335          		DB	030H + VER_2 ,030H + VER_3
  C9D7  2047616B752028		DB	' Gaku (Lovers/Tablacus)',0DH,0AH
  C9F0  00            		DB	0
                      	
  C9F1                	_C8025H:
  C9F1  6B5059881B0119		DB	06BH,050H,059H,088H,01BH,001H,019H,01AH
  C9F9  000F          		DB	000H,00FH
  C9FB  30F8B0FF      		DW	0-80*LINE,0-80
  C9FF  0CA3          		DB	00CH,0A3H
                      	
  CA01  030C0F30333C3F	TEXTDT:	DB	003H,00CH,00FH,030H,033H,03CH,03FH
                      	
  CA08                	SIODATA:
  CA08  18            		DB	018H
  CA09  0100          		DB	1,0
  CA0B  0200          		DB	2,0
  CA0D  03C1          		DB	3,0C1H
  CA0F  0444          		DB	4,044H
  CA11  05E8          		DB	5,0E8H
  CA13  FF            		DB	0FFH
                      	
                      	;	ノンターボ用パッチ
                      	
  CA14                	AT_SCR1:
  CA14  D9            		EXX
  CA15  C5            		PUSH	BC
  CA16  015020        		LD	BC,02000H+80
  CA19  D9            		EXX
  CA1A  C5            		PUSH	BC
  CA1B  010020        		LD	BC,02000H
                      	
  CA1E  67            		LD	H,A
  CA1F  B7            		OR	A
  CA20                	AT_SCRUP1:
  CA20  2815          		JR	Z,AT_SCRCL
  CA22  C5            		PUSH	BC
  CA23  CBE0          		SET	4,B
  CA25  D9            		EXX
  CA26  C5            		PUSH	BC
  CA27  CBE0          		SET	4,B
  CA29  D9            		EXX
  CA2A  CD73DB        		CALL	AT_UPSUB+AT_RS
  CA2D  D9            		EXX
  CA2E  C1            		POP	BC
  CA2F  D9            		EXX
  CA30  C1            		POP	BC
  CA31  CD73DB        		CALL	AT_UPSUB+AT_RS
  CA34  25            		DEC	H
  CA35  18E9          		JR	AT_SCRUP1
                      	
  CA37                	AT_SCRCL:
  CA37  215020        		LD	HL,02000H+80
  CA3A  3A96EC        		LD	A,(_COLORF)
  CA3D                	AT_SCRCL1:
  CA3D  CBE0          		SET	4,B
  CA3F  ED61          		OUT	(C),H
  CA41  CBA0          		RES	4,B
  CA43  ED79          		OUT	(C),A
  CA45  03            		INC	BC
  CA46  2D            		DEC	L
  CA47  20F4          		JR	NZ,AT_SCRCL1
  CA49  C1            		POP	BC
  CA4A  D9            		EXX
  CA4B  C1            		POP	BC
  CA4C  D9            		EXX
  CA4D  C9            		RET
                      	
  CA4E                	AT_UPSUB:
  CA4E  2E28          		LD	L,40
  CA50                	AT_UPSUB1:
  CA50  D9            		EXX
  CA51  ED78          		IN	A,(C)
  CA53  03            		INC	BC
  CA54  D9            		EXX
  CA55  ED79          		OUT	(C),A
  CA57  03            		INC	BC
  CA58  D9            		EXX
  CA59  ED78          		IN	A,(C)
  CA5B  03            		INC	BC
  CA5C  D9            		EXX
  CA5D  ED79          		OUT	(C),A
  CA5F  03            		INC	BC
  CA60  2D            		DEC	L
  CA61  20ED          		JR	NZ,AT_UPSUB1
  CA63  C9            		RET
                      	
                      	;	FLOPPY DISK DRIVER(CPU)
                      	
  CA64                	DISKC:
  CA64  1B            		DEC	DE
  CA65  CB5F          		BIT	3,A
  CA67  C4B2EA        		CALL	NZ,RNF
  CA6A                	DISKD:
  CA6A  E5            		PUSH	HL
  CA6B  21B8EA        		LD	HL,RETRY
  CA6E  35            		DEC	(HL)
  CA6F  E1            		POP	HL
  CA70  203E          		JR	NZ,AT_ERR		;Retry
  CA72  B7            		OR	A
  CA73  283B          		JR	Z,AT_ERR		;Error
                      	
  CA75                	AT_DELP:
  CA75  CDB2EA        		CALL	RNF
  CA78  CD8EEA        		CALL	FDMOFF
  CA7B  3A85EC        		LD	A,(_SEEKSP)
  CA7E  87            		ADD	A,A
  CA7F  382E          		JR	C,AT_ERRZ
  CA81                	AT_DELP1:
  CA81  D5            		PUSH	DE
  CA82  21C0EB        		LD	HL,DEMES
  CA85  CD5DD8        		CALL	MSX
  CA88  CD48D7        		CALL	KEYBC
  CA8B                	AT_DELP2:
  CA8B  CDCAEC        		CALL	_INKEY
  CA8E  28FB          		JR	Z,AT_DELP2
                      	
  CA90  D1            		POP	DE
  CA91  CDB3DF        		CALL	CAP
  CA94  FE52          		CP	'R'		;Retry
  CA96  200A          		JR	NZ,AT_DELP3
  CA98  210000        	DHLPAT:	LD	HL,0
  CA9B  3E02          		LD	A,2
  CA9D  32B8EA        		LD	(RETRY),A
  CAA0  B7            		OR	A
  CAA1  C9            		RET
  CAA2                	AT_DELP3:
  CAA2  FE49          		CP	'I'		;Ignore
  CAA4  2807          		JR	Z,AT_IGNORE
  CAA6  FE41          		CP	'A'		;Abort
  CAA8  20D7          		JR	NZ,AT_DELP1
  CAAA  C362D3        		JP	BOOT
  CAAD                	AT_IGNORE:
  CAAD  3EFF          		LD	A,0FFH
  CAAF                	AT_ERRZ:
  CAAF  BF            		CP	A
  CAB0                	AT_ERR:
  CAB0  3EFF          		LD	A,0FFH
  CAB2  C9            		RET
                      	
  CAB3                	AT_SCRE:
                      	
  CAB3                	AT_WTTRK:
  CAB3  3EF0          		LD	A,0F0H
  CAB5  1802          		JR	AT_WTTRK1
                      	
  CAB7                	AT_DWT:
  CAB7  3EA0          		LD	A,0A0H
  CAB9                	AT_WTTRK1:
  CAB9  3256EA        		LD	(FDCPAT+1),A
                      	
  CABC  3E02          		LD	A,2		;Retry count
  CABE  32B8EA        		LD	(RETRY),A
                      	
  CAC1                	DWT0:
  CAC1  D5            		PUSH	DE
  CAC2  E5            		PUSH	HL
  CAC3  22BEDB        		LD	(DHLPAT+1+AT_RS),HL
  CAC6  CDF0E9        		CALL	SEEK		;Write disk
  CAC9  E1            		POP	HL
  CACA  3831          		JR	C,ERRDW
  CACC  F3            		DI
  CACD  3A56EA        		LD	A,(FDCPAT+1)
  CAD0  CD9AEA        		CALL	SECSET
  CAD3  0EFB          		LD	C,0FBH
                      	
  CAD5                	DWT1:
  CAD5  56            		LD	D,(HL)
  CAD6                	DWT2:
  CAD6  78            		LD	A,B
  CAD7  DBF8          		IN	A,(0F8H)
  CAD9  0F            		RRCA
  CADA  3008          		JR	NC,DWT4
  CADC  0F            		RRCA
  CADD  30F7          		JR	NC,DWT2
  CADF                	DWT3:
  CADF  ED51          		OUT	(C),D
  CAE1  23            		INC	HL
  CAE2  18F1          		JR	DWT1
                      	
  CAE4                	DWT4:
  CAE4  3D            		DEC	A
  CAE5  28F8          		JR	Z,DWT3
  CAE7  3C            		INC	A
  CAE8  FB            		EI
  CAE9  D1            		POP	DE
  CAEA  13            		INC	DE
  CAEB  CD8EEA        		CALL	FDMOFF
  CAEE  C8            		RET	Z
  CAEF  CD89DB        		CALL	DISKC+AT_RS
  CAF2  20CD          		JR	NZ,DWT0
  CAF4  B7            		OR	A
  CAF5  C8            		RET	Z
  CAF6                	ERRW:
  CAF6  3EFF          		LD	A,0FFH
  CAF8                	ERRZ:
  CAF8  BF            		CP	A
  CAF9  37            		SCF
  CAFA  C38EEA        		JP	FDMOFF
                      	
  CAFD                	ERRDW:
  CAFD  D1            		POP	DE
  CAFE  CD9ADB        		CALL	AT_DELP+AT_RS
  CB01  20BE          		JR	NZ,DWT0
  CB03  B7            		OR	A
  CB04  20F0          		JR	NZ,ERRW
  CB06  C9            		RET
                      	
  CB07                	AT_DRD:
  CB07  3E80          		LD	A,080H
  CB09  3256EA        		LD	(FDCPAT+1),A
                      	
  CB0C  3E02          		LD	A,2		;Retry count
  CB0E  32B8EA        		LD	(RETRY),A
                      	
  CB11                	DRD0:
  CB11  D5            		PUSH	DE
  CB12  E5            		PUSH	HL
  CB13  22BEDB        		LD	(DHLPAT+1+AT_RS),HL
  CB16  CDF0E9        		CALL	SEEK		;Read disk
  CB19  E1            		POP	HL
  CB1A  3828          		JR	C,ERRDR
  CB1C  F3            		DI
  CB1D  3A56EA        		LD	A,(FDCPAT+1)
  CB20  CD9AEA        		CALL	SECSET
  CB23  0EFB          		LD	C,0FBH
  CB25                	DRD1:
  CB25  78            		LD	A,B
  CB26  DBF8          		IN	A,(0F8H)
  CB28  0F            		RRCA
  CB29  3008          		JR	NC,DRD3
  CB2B  0F            		RRCA
  CB2C  30F7          		JR	NC,DRD1
  CB2E  EDA2          		INI
  CB30  04            		INC	B
  CB31  18F2          		JR	DRD1
                      	
  CB33                	DRD3:
  CB33  B7            		OR	A
  CB34  FB            		EI
  CB35  D1            		POP	DE
  CB36  13            		INC	DE
  CB37  CD8EEA        		CALL	FDMOFF
  CB3A  C8            		RET	Z
  CB3B  CD89DB        		CALL	DISKC+AT_RS
  CB3E  20D1          		JR	NZ,DRD0
  CB40  B7            		OR	A
  CB41  20B3          		JR	NZ,ERRW
  CB43  C9            		RET
                      	
  CB44                	ERRDR:
  CB44  D1            		POP	DE
  CB45  CD9ADB        		CALL	AT_DELP+AT_RS
  CB48  20C7          		JR	NZ,DRD0
  CB4A  B7            		OR	A
  CB4B  20A9          		JR	NZ,ERRW
  CB4D  C9            		RET
                      	
  CB4E                	AT_CPUE:
                      	
                      	
                      	;	EMM DRIVER(CPU)
                      	
                      	
  CB4E                	AT_EDWTC:
  CB4E  CD43D3        		CALL	AT_EADR+AT_RE
  CB51                	AT_EDWTC1:
  CB51  04            		INC	B
  CB52  EDA3          		OUTI
  CB54  04            		INC	B
  CB55  EDA3          		OUTI
  CB57  04            		INC	B
  CB58  EDA3          		OUTI
  CB5A  04            		INC	B
  CB5B  EDA3          		OUTI
  CB5D  3D            		DEC	A
  CB5E  20F1          		JR	NZ,AT_EDWTC1
  CB60  AF            		XOR	A
  CB61  C9            		RET
                      	
  CB62                	AT_EDRDC:
  CB62  CD43D3        		CALL	AT_EADR+AT_RE
  CB65                	AT_EDRDC1:
  CB65  EDA2          		INI
  CB67  04            		INC	B
  CB68  EDA2          		INI
  CB6A  04            		INC	B
  CB6B  EDA2          		INI
  CB6D  04            		INC	B
  CB6E  EDA2          		INI
  CB70  04            		INC	B
  CB71  3D            		DEC	A
  CB72  20F1          		JR	NZ,AT_EDRDC1
  CB74  AF            		XOR	A
  CB75  C9            		RET
                      	
  CB76                	AT_EADR:
  CB76  D5            		PUSH	DE
  CB77  EB            		EX	DE,HL
  CB78  29            		ADD	HL,HL
  CB79  29            		ADD	HL,HL
  CB7A  ED4BA0EC      		LD	BC,(_MAXCYL-1)
  CB7E  0E00          		LD	C,0
  CB80  09            		ADD	HL,BC
  CB81  060D          		LD	B,00DH
  CB83  ED49          		OUT	(C),C
  CB85  0C            		INC	C
  CB86  ED69          		OUT	(C),L
  CB88  0C            		INC	C
  CB89  ED61          		OUT	(C),H
  CB8B  0C            		INC	C
  CB8C  EB            		EX	DE,HL
  CB8D  D1            		POP	DE
  CB8E  13            		INC	DE
  CB8F  AF            		XOR	A
  CB90  C9            		RET
                      	
  CB91                	AT_EMME:
                      	
  CB91                	INITE:
  CB91                		DS	0CC06H-INITE
                      	
  CC06                	BDOS:
  CC06  C371D3        		JP	BDOS0
  CC09                		DS	53	;Reserved
                      	
                      	;LDCCP.ASM
                      	
                      	;	LSX-Dodgers CCP
                      	
  CC3E                	WBOOT1:
  CC3E  F3            		DI
  CC3F  310000        		LD	SP,STACK
                      	
  CC42  3EEC          		LD	A,INTVEC/256
  CC44  ED47          		LD	I,A
                      	
  CC46  3EE4          		LD	A,0E4H
  CC48  CDAFDA        		CALL	COMOUT
  CC4B  3EC8          		LD	A,INTVEC
  CC4D  CD89DA        		CALL	OT49SB
                      	
  CC50  3ABCEC        		LD	A,(CRTCD+12)
  CC53  B7            		OR	A
  CC54  200C          		JR	NZ,SETCRT0
  CC56  2130F8        		LD	HL,0-80*LINE
  CC59  22BAEC        		LD	(CRTCD+10),HL
  CC5C  21B0FF        		LD	HL,0-80
  CC5F  22BCEC        		LD	(CRTCD+12),HL
  CC62                	SETCRT0:
  CC62  21B0EC        		LD	HL,CRTCD
  CC65  AF            		XOR	A
  CC66                	SETCRT2:
  CC66  010018        		LD	BC,01800H
  CC69  ED79          		OUT	(C),A
  CC6B  0C            		INC	C
  CC6C  04            		INC	B
  CC6D  EDA3          		OUTI
  CC6F  3C            		INC	A
  CC70  FE0C          		CP	12
  CC72  20F2          		JR	NZ,SETCRT2
  CC74  0D            		DEC	C
  CC75  ED79          		OUT	(C),A
  CC77  0C            		INC	C
                      	;	OUT	(C),0		;未定義命令ニーモニック
  CC78  ED71          		DB	0EDH,071H
  CC7A  0D            		DEC	C
  CC7B  3C            		INC	A
  CC7C  ED79          		OUT	(C),A
  CC7E  0C            		INC	C
                      	;	OUT	(C),0		;未定義命令ニーモニック
  CC7F  ED71          		DB	0EDH,071H
  CC81  23            		INC	HL
  CC82  23            		INC	HL
  CC83  01031B        		LD	BC,01A03H+00100H
  CC86  EDA3          		OUTI
  CC88  01D020        		LD	BC,01FD0H+00100H
  CC8B  EDA3          		OUTI
  CC8D  CD03CF        		CALL	LTNL
  CC90                	COMMAND:
  CC90  CD48CD        		CALL	SETDTA1
  CC93  D5            		PUSH	DE
  CC94  3A87EC        		LD	A,(_DVSW)
  CC97  C641          		ADD	A,'A'
  CC99  5F            		LD	E,A
  CC9A  CDCDEC        		CALL	_PRINT
  CC9D  1E3E          		LD	E,'>'
  CC9F  CDCDEC        		CALL	_PRINT
  CCA2  D1            		POP	DE		;DE=DTA1
  CCA3  3E50          		LD	A,80
  CCA5  12            		LD	(DE),A
  CCA6  CDCED7        		CALL	_SYS0A		;(BDOS)文字列入力
  CCA9  CD03CF        		CALL	LTNL
                      	
  CCAC  118200        		LD	DE,DTA1+2
  CCAF  CDFDEC        		CALL	_COMANL
  CCB2  30DC          		JR	NC,COMMAND
  CCB4  CD48D7        		CALL	KEYBC
  CCB7  1163D2        		LD	DE,COMERM
  CCBA  CDA7D3        		CALL	_SYS09		;(BDOS)文字列出力
  CCBD  C7            		RST	0
                      	
  CCBE                	COMANL:
  CCBE  CD88DC        		CALL	FILE
  CCC1  D5            		PUSH	DE
  CCC2  11DC00        		LD	DE,FNAME
  CCC5  1A            		LD	A,(DE)
  CCC6  FE20          		CP	020H
  CCC8  2848          		JR	Z,SDVSW
  CCCA  1B            		DEC	DE
  CCCB  1A            		LD	A,(DE)
  CCCC  C6FF          		ADD	A,0FFH
  CCCE  380A          		JR	C,COMB
  CCD0  13            		INC	DE
                      	
  CCD1  210ED2        		LD	HL,COMTB
  CCD4  3E09          		LD	A,COMS
  CCD6  47            		LD	B,A
  CCD7  CD30DF        		CALL	CPNAME
  CCDA                	COMB:
  CCDA  D1            		POP	DE
  CCDB  D20F00        		JP	NC,JP_HL
  CCDE  EB            		EX	DE,HL
  CCDF  22BECD        		LD	(COMPAT+1),HL
  CCE2  2215CE        		LD	(BATPAT+1),HL
  CCE5  F5            		PUSH	AF
  CCE6  CD66CD        		CALL	CEXE4
  CCE9  F1            		POP	AF
  CCEA  21DC00        		LD	HL,FNAME
  CCED  116D00        		LD	DE,FCB2+1	;COMMAND NAME
  CCF0  010B00        		LD	BC,11
  CCF3  EDB0          		LDIR
  CCF5  11CDD1        		LD	DE,PATHD
  CCF8                	CEX1:
  CCF8  1A            		LD	A,(DE)
  CCF9  FE20          		CP	020H
  CCFB  D8            		RET	C
  CCFC  CD7DDC        		CALL	FILEC
  CCFF  D5            		PUSH	DE
  CD00  216D00        		LD	HL,FCB2+1	;COMMAND NAME
  CD03  11DC00        		LD	DE,FNAME
  CD06  010B00        		LD	BC,11
  CD09  EDB0          		LDIR
  CD0B  CD66CD        		CALL	CEXE4
  CD0E  D1            		POP	DE
  CD0F  13            		INC	DE
  CD10  18E6          		JR	CEX1
                      	
  CD12                	SDVSW:
  CD12  F1            		POP	AF
  CD13  3ADB00        		LD	A,(FDRV)
  CD16  3D            		DEC	A
  CD17  5F            		LD	E,A
  CD18  0E0E          		LD	C,00EH		;(BDOS)カレント・ドライブの設定
  CD1A  1833          		JR	SYSTEM0
                      	
  CD1C                	OPEN1:
  CD1C  21DB00        		LD	HL,FDRV
  CD1F                	OPEN:
  CD1F  0E11          		LD	C,011H		;(BDOS)最初のファイルの検索
  CD21                	OPEN3:
  CD21  D5            		PUSH	DE
  CD22  1151FF        		LD	DE,DTA
  CD25  CD45CD        		CALL	SETDTA
  CD28  EB            		EX	DE,HL
  CD29  CD0500        		CALL	SYSTEM
  CD2C  D1            		POP	DE
  CD2D  B7            		OR	A
  CD2E  C9            		RET
                      	
  CD2F                	OPEN2:
  CD2F  0E12          		LD	C,012H
  CD31  18EE          		JR	OPEN3
                      	
  CD33                	DEFCB:				;Z=Ok NZ=Error
  CD33  1151FF        		LD	DE,DTA
  CD36  CD4DCD        		CALL	SYSC0F
                      	
  CD39  210000        		LD	HL,0
  CD3C  2272FF        		LD	(DTA+33),HL
  CD3F  2274FF        		LD	(DTA+35),HL
  CD42  110001        		LD	DE,00100H
  CD45                	SETDTA:
  CD45  C3CED5        		JP	_SYS1A		;(BDOS)DTAの設定
                      	
  CD48                	SETDTA1:
  CD48  118000        		LD	DE,DTA1
  CD4B  18F8          		JR	SETDTA
                      	
  CD4D                	SYSC0F:
  CD4D  0E0F          		LD	C,00FH		;(BDOS)ファイルのオープン
  CD4F                	SYSTEM0:
  CD4F  CD0500        		CALL	SYSTEM
  CD52  B7            		OR	A
  CD53  C9            		RET
                      	
  CD54                	C_CD:
  CD54  CD7DDC        		CALL	FILEC
  CD57  210000        		LD	HL,0
  CD5A  11DB00        		LD	DE,FDRV
  CD5D  1803          		JR	S27
                      	
  CD5F                	S27DTA:
  CD5F  1151FF        		LD	DE,DTA
  CD62                	S27:
  CD62  0E27          		LD	C,027H		;(BDOS)ランダム・ブロック・リード
  CD64  18E9          		JR	SYSTEM0
                      	
  CD66                	CEXE4:
  CD66  3ADB00        		LD	A,(FDRV)
  CD69  325700        		LD	(00057H),A
  CD6C  2AE900        		LD	HL,(FDRV+14)
  CD6F  225800        		LD	(00058H),HL
                      	
  CD72  21E400        		LD	HL,FNAME+8
  CD75  7E            		LD	A,(HL)
  CD76  FE20          		CP	020H
  CD78  2007          		JR	NZ,CEXE7
  CD7A  3E3F          		LD	A,'?'
  CD7C  77            		LD	(HL),A
  CD7D  23            		INC	HL
  CD7E  77            		LD	(HL),A
  CD7F  23            		INC	HL
  CD80  77            		LD	(HL),A
  CD81                	CEXE7:
  CD81  CD1CCD        		CALL	OPEN1
  CD84                	CEXE5:
  CD84  C0            		RET	NZ
  CD85  2A5BFF        		LD	HL,(DTA+1+9)
  CD88  7C            		LD	A,H
  CD89  CDB3DF        		CALL	CAP
  CD8C  67            		LD	H,A
  CD8D  7D            		LD	A,L
  CD8E  CDB3DF        		CALL	CAP
  CD91  6F            		LD	L,A
  CD92  3A5AFF        		LD	A,(DTA+1+8)
  CD95  CDB3DF        		CALL	CAP
  CD98  D642          		SUB	'B'
  CD9A  282E          		JR	Z,C_BAT
  CD9C  3D            		DEC	A		;'C'
  CD9D  2805          		JR	Z,C_EXE
  CD9F                	CEXE6:
  CD9F  CD2FCD        		CALL	OPEN2
  CDA2  18E0          		JR	CEXE5
                      	
  CDA4                	C_EXE:
  CDA4  7C            		LD	A,H
  CDA5  FE4D          		CP	'M'
  CDA7  20F6          		JR	NZ,CEXE6
                      	
  CDA9  CD33CD        		CALL	DEFCB
  CDAC  2A0600        		LD	HL,(SYSTEM+1)
  CDAF  25            		DEC	H
  CDB0  CD5FCD        		CALL	S27DTA
  CDB3  3D            		DEC	A
  CDB4  37            		SCF
  CDB5  C0            		RET	NZ
  CDB6  7C            		LD	A,H
  CDB7  B5            		OR	L
  CDB8  37            		SCF
  CDB9  C8            		RET	Z
  CDBA  CD48CD        		CALL	SETDTA1
  CDBD  110000        	COMPAT:	LD	DE,0
  CDC0  CD13D0        		CALL	SETFCB
  CDC3  AF            		XOR	A
  CDC4  67            		LD	H,A
  CDC5  6F            		LD	L,A	;HL=0x0000
  CDC6  F9            		LD	SP,HL	;STACK=0
  CDC7  E5            		PUSH	HL
  CDC8  24            		INC	H	;HL=0x0100
  CDC9  E9            		JP	(HL)
                      	
  CDCA                	C_BAT:
  CDCA  114154        		LD	DE,'A'+'T'*256
  CDCD  ED52          		SBC	HL,DE
  CDCF  20CE          		JR	NZ,CEXE6
                      	
  CDD1  F1            		POP	AF
  CDD2  F1            		POP	AF
  CDD3  CD33CD        		CALL	DEFCB
  CDD6  210002        		LD	HL,00200H
  CDD9  CD5FCD        		CALL	S27DTA
  CDDC  C6FE          		ADD	A,0FEH
  CDDE  D8            		RET	C
  CDDF  7D            		LD	A,L
  CDE0  B7            		OR	A
  CDE1  37            		SCF
  CDE2  C8            		RET	Z
  CDE3  3C            		INC	A
  CDE4  F5            		PUSH	AF
                      	
  CDE5  CD48D7        		CALL	KEYBC
  CDE8  1E1A          		LD	E,01AH
  CDEA  CDCDEC        		CALL	_PRINT
  CDED  C1            		POP	BC
  CDEE  210001        		LD	HL,00100H
  CDF1                	BAT1:
  CDF1  A7            		AND	A
  CDF2  05            		DEC	B
  CDF3  C8            		RET	Z
  CDF4  7E            		LD	A,(HL)
  CDF5  FE25          		CP	'%'
  CDF7  280C          		JR	Z,BAT2
  CDF9                	BAT1X:
  CDF9  7E            		LD	A,(HL)
  CDFA  23            		INC	HL
  CDFB  FE1A          		CP	01AH
  CDFD  C8            		RET	Z
  CDFE  FE0A          		CP	00AH
  CE00  C42ED7        		CALL	NZ,KEYBS
  CE03  18EC          		JR	BAT1
                      	
  CE05                	BAT2:
  CE05  23            		INC	HL
  CE06  7E            		LD	A,(HL)
  CE07  2B            		DEC	HL
  CE08  D631          		SUB	'1'
  CE0A  38ED          		JR	C,BAT1X
  CE0C  FE09          		CP	9
  CE0E  30E9          		JR	NC,BAT1X
  CE10  23            		INC	HL
  CE11  23            		INC	HL
  CE12  3C            		INC	A
  CE13  4F            		LD	C,A
  CE14  110000        	BATPAT:	LD	DE,0
  CE17                	BAT3:
  CE17  1A            		LD	A,(DE)
  CE18  B7            		OR	A
  CE19  28D6          		JR	Z,BAT1
  CE1B  CD62DD        		CALL	SPCUT
  CE1E  0D            		DEC	C
  CE1F  2808          		JR	Z,BAT5
  CE21                	BAT4:
  CE21  1A            		LD	A,(DE)
  CE22  FE21          		CP	021H
  CE24  38F1          		JR	C,BAT3
  CE26  13            		INC	DE
  CE27  18F8          		JR	BAT4
  CE29                	BAT5:
  CE29  1A            		LD	A,(DE)
  CE2A  FE21          		CP	021H
  CE2C  38C3          		JR	C,BAT1
  CE2E  13            		INC	DE
  CE2F  CD2ED7        		CALL	KEYBS
  CE32  18F5          		JR	BAT5
                      	
  CE34                	SWITCH:
  CE34  1A            		LD	A,(DE)
  CE35                	SW1:
  CE35  13            		INC	DE
  CE36  B9            		CP	C
  CE37  1A            		LD	A,(DE)
  CE38  C8            		RET	Z
  CE39  FE20          		CP	020H
  CE3B  30F8          		JR	NC,SW1
  CE3D                	C_REM:
  CE3D  AF            		XOR	A
  CE3E  C9            		RET
                      	
  CE3F                	C_DEL:
  CE3F  CD13D0        		CALL	SETFCB
  CE42  CD95D7        		CALL	_SYS08		;(BDOS)エコーなしコンソール入力
                      	
  CE45  0E13          		LD	C,013H
  CE47  180A          		JR	CDEL1
                      	
  CE49                	C_REN:
  CE49  CD13D0        		CALL	SETFCB
  CE4C  3E10          		LD	A,010H		;ディレクトリも対象にする
  CE4E  326900        		LD	(FCB1+13),A	;属性
  CE51  0E17          		LD	C,017H		;(BDOS)ファイル名の変更
  CE53                	CDEL1:
  CE53  115C00        		LD	DE,FCB1
  CE56  CD0500        		CALL	SYSTEM
  CE59  C6FF          		ADD	A,0FFH
  CE5B  C9            		RET
                      	
  CE5C                	C_DIR:
  CE5C  CD7DDC        		CALL	FILEC
  CE5F  21DC00        		LD	HL,FDRV+1
  CE62  CDB3D1        		CALL	CWILD1
  CE65  3EF1          		LD	A,0F1H
  CE67  32E800        		LD	(FDRV+13),A
  CE6A  CD1CCD        		CALL	OPEN1
  CE6D                	CDIR1:
  CE6D  B7            		OR	A
  CE6E  2008          		JR	NZ,PDSKF
  CE70  CDBCCE        		CALL	P_NAME
  CE73  CD2FCD        		CALL	OPEN2
  CE76  18F5          		JR	CDIR1
                      	
  CE78                	PDSKF:
  CE78  3ADB00        		LD	A,(FDRV)
  CE7B  5F            		LD	E,A
  CE7C  0E1B          		LD	C,01BH		;(BDOS)ディスク情報の獲得
  CE7E  CD0500        		CALL	SYSTEM
  CE81  4F            		LD	C,A
  CE82  C601          		ADD	A,001H
  CE84  D8            		RET	C
  CE85  AF            		XOR	A
  CE86                	PDS1:
  CE86  CB19          		RR	C
  CE88  3804          		JR	C,PDS2
  CE8A  29            		ADD	HL,HL
  CE8B  8F            		ADC	A,A
  CE8C  18F8          		JR	PDS1
  CE8E                	PDS2:
  CE8E  CB50          		BIT	2,B
  CE90  200A          		JR	NZ,PDSKF1
  CE92  CB3F          		SRL	A
  CE94  CB1C          		RR	H
  CE96  CB1D          		RR	L
  CE98  CB10          		RL	B
  CE9A  18F2          		JR	PDS2
  CE9C                	PDSKF1:
  CE9C  CD3FCF        		CALL	PRDEC
  CE9F  1144D2        		LD	DE,KBFREE
  CEA2  CDA7D3        		CALL	_SYS09		;(BDOS)文字列出力
  CEA5  CD31CF        		CALL	PUTDRV
  CEA8  3E5C          		LD	A,05CH
  CEAA  CD7FD7        		CALL	MSG_
  CEAD  2AE900        		LD	HL,(FDRV+14)
  CEB0  7C            		LD	A,H
  CEB1  B5            		OR	L
  CEB2  284F          		JR	Z,LTNL
  CEB4  2B            		DEC	HL
  CEB5  7C            		LD	A,H
  CEB6  B5            		OR	L
  CEB7  C43ECF        		CALL	NZ,PRDEC0
  CEBA  1847          		JR	LTNL
                      	
  CEBC                	P_NAME:
  CEBC  3A52FF        		LD	A,(DTA+1)
  CEBF  FE2E          		CP	'.'
  CEC1  C8            		RET	Z
  CEC2  3E20          		LD	A,020H
  CEC4  CD7FD7        		CALL	MSG_
  CEC7  CD7FD7        		CALL	MSG_
  CECA  3E3A          		LD	A,':'
  CECC  CD7FD7        		CALL	MSG_
  CECF  3A5DFF        		LD	A,(DTA+1+00BH)
  CED2  F5            		PUSH	AF
  CED3  0F            		RRCA
  CED4  9F            		SBC	A,A
  CED5  E60A          		AND	'*'-020H
  CED7  C620          		ADD	A,020H
  CED9  CD7FD7        		CALL	MSG_
  CEDC  CD31CF        		CALL	PUTDRV
  CEDF  2152FF        		LD	HL,DTA+1
  CEE2  CD80CF        		CALL	FPRNT
                      	
  CEE5  F1            		POP	AF
  CEE6  CB67          		BIT	4,A
  CEE8  2808          		JR	Z,DIR3
  CEEA  1152D2        		LD	DE,DIRMES
  CEED  CDA7D3        		CALL	_SYS09		;(BDOS)文字列出力
  CEF0  1809          		JR	DIR6
  CEF2                	DIR3:
  CEF2  3A70FF        		LD	A,(DTA+1+01EH)
  CEF5  2A6EFF        		LD	HL,(DTA+1+01CH)
  CEF8  CD3FCF        		CALL	PRDEC
  CEFB                	DIR6:
  CEFB  3AB1EC        		LD	A,(CRTCD+1)
  CEFE  FE29          		CP	40+1
  CF00  D4A2CF        		CALL	NC,PRTTMS
                      	
  CF03                	LTNL:
  CF03  1E0D          		LD	E,00DH
  CF05  CD92D7        		CALL	PRINTX
  CF08  1E0A          		LD	E,00AH
  CF0A  C392D7        		JP	PRINTX
                      	
  CF0D                	C_PATH:
  CF0D  CD62DD        		CALL	SPCUT
  CF10  21CDD1        		LD	HL,PATHD
  CF13  FE21          		CP	021H
  CF15  300E          		JR	NC,CPATH0
  CF17  2B            		DEC	HL
  CF18  2B            		DEC	HL
  CF19                	CPATHP:
  CF19  7E            		LD	A,(HL)
  CF1A  23            		INC	HL
  CF1B  FE20          		CP	020H
  CF1D  3F            		CCF
  CF1E  30E3          		JR	NC,LTNL
  CF20  CD7FD7        		CALL	MSG_
  CF23  18F4          		JR	CPATHP
  CF25                	CPATH0:
  CF25  FE3B          		CP	';'
  CF27  2001          		JR	NZ,CPATH1
  CF29  13            		INC	DE
  CF2A                	CPATH1:
  CF2A  EB            		EX	DE,HL
  CF2B  014000        		LD	BC,PATHX
  CF2E  EDB0          		LDIR
  CF30  C9            		RET
                      	
  CF31                	PUTDRV:
  CF31  3ADB00        		LD	A,(FDRV)
  CF34  C640          		ADD	A,'A'-1
  CF36  CD7FD7        		CALL	MSG_
  CF39  3E3A          		LD	A,':'
  CF3B                	MSGR:
  CF3B  C37FD7        		JP	MSG_
                      	
  CF3E                	PRDEC0:
  CF3E  AF            		XOR	A
  CF3F                	PRDEC:
  CF3F  5F            		LD	E,A
  CF40  010000        		LD	BC,0
  CF43  ED43D600      		LD	(DECBF),BC
  CF47  ED43D800      		LD	(DECBF+2),BC
                      	
  CF4B  0E18          		LD	C,24
  CF4D                	DEC1:
  CF4D  29            		ADD	HL,HL
  CF4E  7B            		LD	A,E
  CF4F  8F            		ADC	A,A
  CF50  5F            		LD	E,A
  CF51  E5            		PUSH	HL
  CF52  21D900        		LD	HL,DECBF+3
  CF55  0604          		LD	B,4
  CF57                	DEC2:
  CF57  7E            		LD	A,(HL)
  CF58  8F            		ADC	A,A
  CF59  27            		DAA
  CF5A  77            		LD	(HL),A
  CF5B  2B            		DEC	HL
  CF5C  10F9          		DJNZ	DEC2
  CF5E  E1            		POP	HL
  CF5F  0D            		DEC	C
  CF60  20EB          		JR	NZ,DEC1
                      	
  CF62  21D600        		LD	HL,DECBF
  CF65  3E20          		LD	A,020H
  CF67  0603          		LD	B,3
  CF69                	DEC3:
  CF69  CD76CF        		CALL	DEC4
  CF6C  CD76CF        		CALL	DEC4
  CF6F  23            		INC	HL
  CF70  10F7          		DJNZ	DEC3
  CF72                	DECX:
  CF72  CD76CF        		CALL	DEC4
  CF75  AF            		XOR	A
  CF76                	DEC4:
  CF76  ED6F          		RLD
  CF78  FE20          		CP	020H
  CF7A  2802          		JR	Z,DEC5
  CF7C  F630          		OR	030H
  CF7E                	DEC5:
  CF7E  18BB          		JR	MSGR
                      	
  CF80                	FPRNT:
  CF80  0608          		LD	B,8
  CF82  CD93CF        		CALL	P_N1
  CF85  7E            		LD	A,(HL)
  CF86  C680          		ADD	A,0A0H-020H
  CF88  FEA0          		CP	0A0H
  CF8A  2802          		JR	Z,FPR1
  CF8C  3E2E          		LD	A,'.'
  CF8E                	FPR1:
  CF8E  CD7FD7        		CALL	MSG_
  CF91  0603          		LD	B,3
                      	
  CF93                	P_N1:
  CF93  C5            		PUSH	BC
  CF94  E5            		PUSH	HL
  CF95  7E            		LD	A,(HL)
  CF96  CDBFDF        		CALL	CAP3
  CF99  CD7FD7        		CALL	MSG_
  CF9C  E1            		POP	HL
  CF9D  C1            		POP	BC
  CF9E  23            		INC	HL
  CF9F  10F2          		DJNZ	P_N1
  CFA1  C9            		RET
                      	
  CFA2                	PRTTMS:
  CFA2  3E20          		LD	A,020H
  CFA4  CD7FD7        		CALL	MSG_
                      	
  CFA7  2A6AFF        		LD	HL,(DTA+1+24)
  CFAA  7D            		LD	A,L
  CFAB  B7            		OR	A
  CFAC  C8            		RET	Z
  CFAD  CB3C          		SRL	H
  CFAF  17            		RLA
  CFB0  17            		RLA
  CFB1  17            		RLA
  CFB2  17            		RLA
  CFB3  E60F          		AND	00FH
  CFB5  57            		LD	D,A
  CFB6  7C            		LD	A,H
  CFB7  C650          		ADD	A,80
  CFB9  CDFECF        		CALL	PRTA
  CFBC  3E2D          		LD	A,'-'
  CFBE  CD7FD7        		CALL	MSG_
  CFC1  7A            		LD	A,D
  CFC2  CDFECF        		CALL	PRTA
  CFC5  3E2D          		LD	A,'-'
  CFC7  CD7FD7        		CALL	MSG_
  CFCA  7D            		LD	A,L
  CFCB  E61F          		AND	01FH
  CFCD  CDFECF        		CALL	PRTA
                      	
  CFD0  2A68FF        		LD	HL,(DTA+1+22)
                      	
  CFD3  3E20          		LD	A,020H
  CFD5  CD7FD7        		CALL	MSG_
  CFD8  7C            		LD	A,H
  CFD9  65            		LD	H,L
  CFDA  1F            		RRA
  CFDB  CB1D          		RR	L
  CFDD  1F            		RRA
  CFDE  CB1D          		RR	L
  CFE0  1F            		RRA
  CFE1  CB1D          		RR	L
  CFE3  E61F          		AND	01FH
  CFE5  CDFECF        		CALL	PRTA
  CFE8  3E3A          		LD	A,':'
  CFEA  CD7FD7        		CALL	MSG_
  CFED  7D            		LD	A,L
  CFEE  0F            		RRCA
  CFEF  0F            		RRCA
  CFF0  E63F          		AND	03FH
  CFF2  CDFECF        		CALL	PRTA
  CFF5  3E3A          		LD	A,':'
  CFF7  CD7FD7        		CALL	MSG_
  CFFA  7C            		LD	A,H
  CFFB  E61F          		AND	01FH
  CFFD  87            		ADD	A,A
                      	
                      	;	PRINT10
                      	
  CFFE                	PRTA:
  CFFE  E5            		PUSH	HL
  CFFF  0608          		LD	B,8
  D001  4F            		LD	C,A
  D002  AF            		XOR	A
  D003                	PRTA1:
  D003  CB01          		RLC	C
  D005  8F            		ADC	A,A
  D006  27            		DAA
  D007  10FA          		DJNZ	PRTA1
  D009  21D600        		LD	HL,DECBF
  D00C  77            		LD	(HL),A
  D00D  AF            		XOR	A
  D00E  CD72CF        		CALL	DECX
  D011  E1            		POP	HL
  D012  C9            		RET
                      	
  D013                	SETFCB:
  D013  CD62DD        		CALL	SPCUT
  D016  1A            		LD	A,(DE)
  D017  FE20          		CP	020H
  D019  3801          		JR	C,SETFCBA
  D01B  1B            		DEC	DE
  D01C                	SETFCBA:
  D01C  D5            		PUSH	DE
  D01D  215C00        		LD	HL,FCB1
  D020  115D00        		LD	DE,FCB1+1
  D023  012300        		LD	BC,00023H
  D026  70            		LD	(HL),B		;B=0
  D027  EDB0          		LDIR
  D029  D1            		POP	DE
  D02A  D5            		PUSH	DE
  D02B  215C00        		LD	HL,FCB1
  D02E  CD2DD6        		CALL	_SYS29		;(BDOS)ファイル名の解析
  D031  216C00        		LD	HL,FCB2
  D034  CD2DD6        		CALL	_SYS29		;(BDOS)ファイル名の解析
  D037  E1            		POP	HL
  D038  010050        		LD	BC,05000H
  D03B  118100        		LD	DE,00081H
  D03E                	SETFCB1:
  D03E  7E            		LD	A,(HL)
  D03F  23            		INC	HL
  D040  FE20          		CP	020H
  D042  3805          		JR	C,SETFCB2
  D044  12            		LD	(DE),A
  D045  13            		INC	DE
  D046  0C            		INC	C
  D047  10F5          		DJNZ	SETFCB1
  D049                	SETFCB2:
  D049  79            		LD	A,C
  D04A  328000        		LD	(DTA1),A
  D04D  04            		INC	B
  D04E  AF            		XOR	A
  D04F                	SETFCB3:
  D04F  12            		LD	(DE),A
  D050  13            		INC	DE
  D051  10FC          		DJNZ	SETFCB3
  D053  C9            		RET
                      	
  D054                	C_COPY:
  D054  CD13D0        		CALL	SETFCB
  D057  118100        		LD	DE,DTA1+1
  D05A  0E2F          		LD	C,'/'
  D05C  CD34CE        		CALL	SWITCH
  D05F  CDB3DF        		CALL	CAP
  D062  32EAD0        		LD	(SW+1),A
                      	
  D065  1170EB        		LD	DE,BEEPD
  D068  CD80DC        		CALL	FILEC2
  D06B  216C00        		LD	HL,FCB2
  D06E  CD34D6        		CALL	S29X1
                      	
  D071  3E10          		LD	A,010H
  D073  326900        		LD	(FCB1+13),A
  D076  216D00        		LD	HL,FCB2+1
  D079  CDB3D1        		CALL	CWILD1
  D07C                	COPY0:
  D07C  CDB0D1        		CALL	CWILD
  D07F  215C00        		LD	HL,FCB1
  D082  CD1FCD        		CALL	OPEN
  D085  37            		SCF
  D086                	COPY1:
  D086  C0            		RET	NZ
  D087  CD33CD        		CALL	DEFCB
                      	
  D08A  3A5EFF        		LD	A,(DTA+13)
  D08D  CB67          		BIT	4,A
  D08F  2824          		JR	Z,COPY1A
                      	
  D091  215D00        		LD	HL,FCB1+1
  D094  CDECE0        		CALL	CHKWILD
  D097  3817          		JR	C,COPY9
                      	
  D099  3E20          		LD	A,020H
  D09B  325D00        		LD	(FCB1+1),A
  D09E  2A6BFF        		LD	HL,(DTA+26)
  D0A1  23            		INC	HL
  D0A2  226A00        		LD	(FCB1+14),HL
  D0A5  18D5          		JR	COPY0
                      	
  D0A7                	COPYS:
  D0A7  115ED2        		LD	DE,SKIP
  D0AA                	COPY8:
  D0AA  CDA7D3        		CALL	_SYS09		;(BDOS)文字列出力
  D0AD  CD03CF        		CALL	LTNL
  D0B0                	COPY9:
  D0B0  CD2FCD        		CALL	OPEN2
  D0B3  18D1          		JR	COPY1
                      	
  D0B5                	COPY1A:
  D0B5  216C00        		LD	HL,FCB2
  D0B8  11DB00        		LD	DE,FDRV
  D0BB  0153FF        		LD	BC,DTA+2
  D0BE  EDA0          		LDI
  D0C0  3E0B          		LD	A,11
  D0C2                	COPY2:
  D0C2  F5            		PUSH	AF
  D0C3  7E            		LD	A,(HL)
  D0C4  FE3F          		CP	'?'
  D0C6  2001          		JR	NZ,COPY3
  D0C8  0A            		LD	A,(BC)
  D0C9                	COPY3:
  D0C9  12            		LD	(DE),A
  D0CA  03            		INC	BC
  D0CB  13            		INC	DE
  D0CC  23            		INC	HL
  D0CD  F1            		POP	AF
  D0CE  3D            		DEC	A
  D0CF  20F1          		JR	NZ,COPY2
  D0D1  010500        		LD	BC,16-11
  D0D4  EDB0          		LDIR
  D0D6                	PUTNAME:
  D0D6  215D00        		LD	HL,FCB1+1
  D0D9  CDECE0        		CALL	CHKWILD
  D0DC  300B          		JR	NC,PUTN1
  D0DE  21DC00        		LD	HL,FDRV+1
  D0E1  CD80CF        		CALL	FPRNT
  D0E4  3E20          		LD	A,020H
  D0E6  CD7FD7        		CALL	MSG_
  D0E9                	PUTN1:
  D0E9  3E00          	SW:	LD	A,000H
  D0EB  FE54          		CP	'T'
  D0ED  2005          		JR	NZ,CSW1
  D0EF  2109D1        		LD	HL,SWNE
  D0F2  1807          		JR	SWT1
  D0F4                	CSW1:
  D0F4  FE4E          		CP	'N'
  D0F6  2011          		JR	NZ,SWNE
  D0F8  21A7D0        		LD	HL,COPYS
  D0FB                	SWT1:
  D0FB  11DB00        		LD	DE,FDRV
  D0FE  CD4DCD        		CALL	SYSC0F
  D101  2801          		JR	Z,SWN1
  D103  E9            		JP	(HL)
  D104                	SWN1:
  D104  CD62D1        		CALL	CTIME
  D107  309E          		JR	NC,COPYS
  D109                	SWNE:
  D109  11DB00        		LD	DE,FDRV
  D10C  0E16          		LD	C,016H		;(BDOS)ファイルの作成
  D10E  CD4FCD        		CALL	SYSTEM0
  D111  204D          		JR	NZ,COPYE2
  D113  67            		LD	H,A		;A=0
  D114  6F            		LD	L,A
  D115  22FC00        		LD	(FDRV+33),HL
  D118  32FE00        		LD	(FDRV+35),A
  D11B                	COPY6:
  D11B  CDC2D1        		CALL	BUFSIZ
  D11E  CD5FCD        		CALL	S27DTA
  D121  47            		LD	B,A
  D122  3C            		INC	A
  D123  2833          		JR	Z,COPYE
  D125  7C            		LD	A,H
  D126  B5            		OR	L
  D127  280E          		JR	Z,COPY7
  D129  11DB00        		LD	DE,FDRV
  D12C  0E26          		LD	C,026H		;(BDOS)ランダム・ブロック・ライト
  D12E  CD0500        		CALL	SYSTEM
  D131  B7            		OR	A
  D132  2024          		JR	NZ,COPYE
  D134  05            		DEC	B
  D135  20E4          		JR	NZ,COPY6
  D137                	COPY7:
  D137  3A5EFF        		LD	A,(DTA+13)
  D13A  32E800        		LD	(FDRV+13),A
  D13D  2165FF        		LD	HL,DTA+20
  D140  11EF00        		LD	DE,FDRV+20
  D143  010400        		LD	BC,4
  D146  EDB0          		LDIR
                      	
  D148  11DB00        		LD	DE,FDRV
  D14B  0E10          		LD	C,010H		;(BDOS)ファイルのクローズ
  D14D  CD4FCD        		CALL	SYSTEM0
  D150  2006          		JR	NZ,COPYE
                      	
  D152  115BD2        		LD	DE,OK
  D155  C3AAD0        		JP	COPY8
                      	
  D158                	COPYE:
  D158  11DB00        		LD	DE,FDRV
  D15B  0E13          		LD	C,013H		;(BDOS)ファイルの削除
  D15D  CD0500        		CALL	SYSTEM
  D160                	COPYE2:
  D160  37            		SCF
  D161  C9            		RET
                      	
  D162                	CTIME:
  D162  ED5B65FF      		LD	DE,(DTA+20)
  D166  2AEF00        		LD	HL,(FDRV+20)
  D169  A7            		AND	A
  D16A  ED52          		SBC	HL,DE
  D16C  C0            		RET	NZ
  D16D  ED5B67FF      		LD	DE,(DTA+22)
  D171  2AF100        		LD	HL,(FDRV+22)
  D174  ED52          		SBC	HL,DE
  D176  C9            		RET
                      	
  D177                	C_TYPE:
  D177  CD13D0        		CALL	SETFCB
  D17A  215C00        		LD	HL,FCB1
  D17D  CD1FCD        		CALL	OPEN
  D180  37            		SCF
  D181                	TYPE1:
  D181  C0            		RET	NZ
  D182  CD33CD        		CALL	DEFCB
  D185  1E1A          		LD	E,01AH
  D187  CDCDEC        		CALL	_PRINT
  D18A                	TYPE2:
  D18A  CDC2D1        		CALL	BUFSIZ
  D18D  CD5FCD        		CALL	S27DTA
  D190  C6FE          		ADD	A,0FEH
  D192  D8            		RET	C
  D193  7C            		LD	A,H
  D194  B5            		OR	L
  D195  2814          		JR	Z,TYPEE
  D197  010001        		LD	BC,00100H
  D19A                	TYPE3:
  D19A  0A            		LD	A,(BC)
  D19B  03            		INC	BC
  D19C  FE1A          		CP	01AH
  D19E  280B          		JR	Z,TYPEE
  D1A0  5F            		LD	E,A
  D1A1  CD88D7        		CALL	_SYS02		;(BDOS)コンソール出力
  D1A4  2B            		DEC	HL
  D1A5  7C            		LD	A,H
  D1A6  B5            		OR	L
  D1A7  20F1          		JR	NZ,TYPE3
  D1A9  18DF          		JR	TYPE2
  D1AB                	TYPEE:
  D1AB  CD2FCD        		CALL	OPEN2
  D1AE  18D1          		JR	TYPE1
                      	
  D1B0                	CWILD:
  D1B0  215D00        		LD	HL,FCB1+1
  D1B3                	CWILD1:
  D1B3  7E            		LD	A,(HL)
  D1B4  FE20          		CP	020H
  D1B6  C0            		RET	NZ
  D1B7                	CWILD2:
  D1B7  54            		LD	D,H
  D1B8  5D            		LD	E,L
  D1B9  13            		INC	DE
  D1BA  010A00        		LD	BC,10
  D1BD  363F          		LD	(HL),'?'
  D1BF  EDB0          		LDIR
  D1C1  C9            		RET
                      	
  D1C2                	BUFSIZ:
  D1C2  3A0700        		LD	A,(SYSTEM+2)
  D1C5  D603          		SUB	3
  D1C7  E6F8          		AND	0F8H
  D1C9  67            		LD	H,A
  D1CA  2E00          		LD	L,0
  D1CC  C9            		RET
                      	
  0040                	PATHX	EQU	64
  D1CD                	PATHD:	DS	PATHX
  D20D  00            	PATHE:	DB	0
                      	
  0009                	COMS	EQU	9
  D20E                	COMTB:
  D20E  44202020      		DB	"D   "	;1
  D212  5CCE          		DW	C_DIR
  D214  44495220      		DB	"DIR "	;2
  D218  5CCE          		DW	C_DIR
  D21A  434F5059      		DB	"COPY"	;3
  D21E  54D0          		DW	C_COPY
  D220  43442020      		DB	"CD  "	;4
  D224  54CD          		DW	C_CD
  D226  44454C20      		DB	"DEL "	;5
  D22A  3FCE          		DW	C_DEL
  D22C  50415448      		DB	"PATH"	;6
  D230  0DCF          		DW	C_PATH
  D232  52454E20      		DB	"REN "	;7
  D236  49CE          		DW	C_REN
  D238  54595045      		DB	"TYPE"	;8
  D23C  77D1          		DW	C_TYPE
  D23E  52454D20      		DB	"REM "	;9
  D242  3DCE          		DW	C_REM
                      	
  D244  6B206279746573	KBFREE:	DB	"k bytes free",9,'$'
  D252  20202020646972	DIRMES:	DB	"    dir $"
  D25B  4F4B24        	OK:	DB	"OK$"
  D25E  536B697024    	SKIP:	DB	"Skip$"
  D263  4572726F722124	COMERM:	DB	"Error!$"
                      	
                      	;LDDISK2.ASM
                      	
                      	;	LSX-Dodgers DISK2
                      	
                      	
                      	;	GRAPHIC RAM DISK DRIVER
                      	
                      	
  D26A                	GDRD:
  D26A  CD80D2        		CALL	GADR
  D26D                	GDRDC1:
  D26D  EDA2          		INI
  D26F  04            		INC	B
  D270  0C            		INC	C
  D271  20FA          		JR	NZ,GDRDC1
  D273  1817          		JR	S1FD0
                      	
  D275                	GDWT:
  D275  CD80D2        		CALL	GADR
  D278                	GDWTC1:
  D278  04            		INC	B
  D279  EDA3          		OUTI
  D27B  0C            		INC	C
  D27C  20FA          		JR	NZ,GDWTC1
  D27E  180C          		JR	S1FD0
                      	
  D280                	GADR:
  D280  0E00          		LD	C,0
  D282  7B            		LD	A,E
  D283  C640          		ADD	A,040H
  D285  47            		LD	B,A
  D286  13            		INC	DE
  D287  3ABFEC        		LD	A,(WK1FD0)
  D28A  F610          		OR	010H		;BANK1
  D28C                	S1FD0:
  D28C  C5            		PUSH	BC
  D28D  32BFEC        		LD	(WK1FD0),A
  D290  01D01F        		LD	BC,01FD0H
  D293  ED79          		OUT	(C),A
  D295  C1            		POP	BC
  D296  E6EF          		AND	0EFH		;BANK0
  D298  C9            		RET
                      	
                      	
                      	;	BANK RAM DISK DRIVER
                      	
                      	
  D299                	BDRDC:
  D299  ED73B8D2      		LD	(BANKSP+1),SP
  D29D  3AB9D2        		LD	A,(BANKSP+2)
  D2A0  87            		ADD	A,A
  D2A1  3803          		JR	C,BDRDC1
  D2A3  31D4FF        		LD	SP,EXTSP
  D2A6                	BDRDC1:
  D2A6  D5            		PUSH	DE
  D2A7  D9            		EXX
  D2A8  C5            		 PUSH	 BC
  D2A9  D5            		 PUSH	 DE
  D2AA  CDDED2        		 CALL	 BADR
  D2AD  CDFBD2        		CALL	BTFR
  D2B0  D9            		EXX
  D2B1                	BDWTCE:
  D2B1  D1            		 POP	 DE
  D2B2  C1            		 POP	 BC
  D2B3  D9            		 EXX
  D2B4  D1            		POP	DE
  D2B5  13            		INC	DE
  D2B6  AF            		XOR	A
  D2B7  310000        	BANKSP:	LD	SP,0
  D2BA  FB            		EI
  D2BB  C9            		RET
                      	
  D2BC                	BDWTC:
  D2BC  ED73B8D2      		LD	(BANKSP+1),SP
  D2C0  3AB9D2        		LD	A,(BANKSP+2)
  D2C3  87            		ADD	A,A
  D2C4  3803          		JR	C,BDWTC1
  D2C6  31D4FF        		LD	SP,EXTSP
  D2C9                	BDWTC1:
  D2C9  D5            		PUSH	DE
  D2CA  D9            		EXX
  D2CB  C5            		 PUSH	 BC
  D2CC  D5            		 PUSH	 DE
  D2CD  CDDED2        		 CALL	 BADR
  D2D0  D9            		EXX
  D2D1  53            		 LD	D,E
  D2D2  5F            		 LD	E,A
  D2D3  D9            		 EXX
  D2D4  EB            		EX	DE,HL
  D2D5  CDFBD2        		CALL	BTFR
  D2D8  EB            		EX	DE,HL
  D2D9  D9            		EXX
  D2DA  ED51          		 OUT	 (C),D	 ;MAIN
  D2DC  18D3          		 JR	 BDWTCE
                      	
  D2DE                	BADR:
  D2DE  D9            		 EXX
  D2DF  7B            		LD	A,E
  D2E0  87            		ADD	A,A
  D2E1  CB12          		RL	D
  D2E3  87            		ADD	A,A
  D2E4  CB12          		RL	D
  D2E6  F5            		PUSH	AF
  D2E7  87            		ADD	A,A
  D2E8  7A            		LD	A,D
  D2E9  8F            		ADC	A,A
  D2EA  E60F          		AND	00FH
  D2EC  D9            		EXX
  D2ED  01000B        		 LD	 BC,00B00H
  D2F0  57            		 LD	 D,A	  ;BANK
  D2F1  1E10          		 LD	 E,010H	  ;MAIN
  D2F3  D9            		 EXX
  D2F4  D1            		POP	DE
  D2F5  0600          		LD	B,0
  D2F7  58            		LD	E,B
  D2F8  CBBA          		RES	7,D
  D2FA  C9            		RET
                      	
  D2FB                	BTFR:
  D2FB  D5            		PUSH	DE
  D2FC  F3            		DI
                      	
  D2FD                	BTFR1:
  D2FD  D9            		EXX
  D2FE  ED51          		 OUT	 (C),D	 ;BANK(MAIN)
  D300  D9            		 EXX
  D301  E3            		EX	(SP),HL
  D302  7E            		LD	A,(HL)
  D303  23            		INC	HL
  D304  4E            		LD	C,(HL)
  D305  23            		INC	HL
  D306  56            		LD	D,(HL)
  D307  23            		INC	HL
  D308  5E            		LD	E,(HL)
  D309  23            		INC	HL
  D30A  E3            		EX	(SP),HL
  D30B  D9            		EXX
  D30C  ED59          		 OUT	 (C),E	 ;MAIN(BANK)
  D30E  D9            		 EXX
  D30F  77            		LD	(HL),A
  D310  23            		INC	HL
  D311  71            		LD	(HL),C
  D312  23            		INC	HL
  D313  72            		LD	(HL),D
  D314  23            		INC	HL
  D315  73            		LD	(HL),E
  D316  23            		INC	HL
  D317  10E4          		DJNZ	BTFR1
  D319  D1            		POP	DE
  D31A  C9            		RET
                      	
                      	
                      	;	EMM DRIVER(DMA)
                      	
                      	
  D31B                	EDWTC:
  D31B  3E11          		LD	A,17
  D31D  01            		DB	1
  D31E                	EDRDC:
  D31E  3E0F          		LD	A,15
  D320                	EDWTC1:
  D320  D5            		PUSH	DE
  D321  225DD3        		LD	(EDMAD+12),HL
  D324  EB            		EX	DE,HL
  D325  29            		ADD	HL,HL
  D326  29            		ADD	HL,HL
  D327  ED4BA0EC      		LD	BC,(_MAXCYL-1)
  D32B  0E00          		LD	C,0
  D32D  09            		ADD	HL,BC
  D32E  ED4B84EC      		LD	BC,(_DRIVE)
  D332  060D          		LD	B,00DH
  D334  ED49          		OUT	(C),C
  D336  0C            		INC	C
  D337  ED69          		OUT	(C),L
  D339  0C            		INC	C
  D33A  ED61          		OUT	(C),H
                      	
  D33C  2151D3        		LD	HL,EDMAD
  D33F  CD56EB        		CALL	SETDMA
  D342  3EB3          		LD	A,0B3H
  D344  ED79          		OUT	(C),A
  D346  ED49          		OUT	(C),C		;OUT 01F87H,087H
  D348  EB            		EX	DE,HL
  D349  24            		INC	H
  D34A  24            		INC	H
  D34B  24            		INC	H
  D34C  24            		INC	H
  D34D  D1            		POP	DE
  D34E  13            		INC	DE
  D34F  AF            		XOR	A
  D350  C9            		RET
                      	
  D351  C37D030DFF032C	EDMAD:	DB	0C3H,07DH,003H,00DH,0FFH,003H,02CH,050H,002H
  D35A  809AAD0000CF01		DB	080H,09AH,0ADH,000H,000H,0CFH,001H,0CFH
                      	
  D362                	EMME:
                      	
  07CD                	AT_RE	EQU	EDWTC-AT_EDWTC
                      	
                      	
                      	;LDOS.ASM
                      	
                      	;	LSX-Dodgers OS
                      	
  D362                	BOOT:
  D362  C30000        		JP	0
  D365                	_SYS00:		;(BDOS)プログラム終了
  D365                	WBOOT:
  D365  C33ECC        		JP	WBOOT1
  D368                	CONST_:
  D368  C302D8        		JP	CONSTX
  D36B                	_SYS07:		;(BDOS)コンソール直接入力
  D36B                	CONIN:
  D36B  C3A9D7        		JP	FLGET
  D36E                	CONOUT:
  D36E  C356DA        		JP	CONOUT1
                      	
  D371                	BDOS0:
  D371  E5            		PUSH	HL
  D372  210001        		LD	HL,00100H
  D375  39            		ADD	HL,SP
  D376  3810          		JR	C,BDOS1X	;EXTSP = 0FFD4H
  D378                	BDOS2:
  D378  E1            		POP	HL
  D379  ED7384D3      		LD	(BDSP+1),SP
  D37D  31D4FF        		LD	SP,EXTSP
  D380  CD87D3        		CALL	BDOS1
  D383  310000        	BDSP:	LD	SP,0
  D386  C9            		RET
  D387                	BDOS1:
  D387  E5            		PUSH	HL
  D388                	BDOS1X:
  D388  79            		LD	A,C
  D389  FE31          		CP	031H
  D38B  300A          		JR	NC,OVERFN
  D38D  87            		ADD	A,A
  D38E  6F            		LD	L,A
  D38F  26EC          		LD	H,STABLE/256
  D391  7E            		LD	A,(HL)
  D392  2C            		INC	L
  D393  66            		LD	H,(HL)
  D394  6F            		LD	L,A
  D395  E3            		EX	(SP),HL
  D396  C9            		RET
  D397                	OVERFN
  D397  E1            		POP	HL
  D398  FE6F          		CP	06FH		;DOSVER MSX-DOS のバージョン番号の獲得
  D39A  2006          		JR	NZ,_ERROR
  D39C  011D01        		LD	BC,011DH
  D39F  113501        		LD	DE,VER
  D3A2                	_ERROR:
  D3A2                	_SYS04:		;(BDOS)外部出力
  D3A2                	_SYS05:		;(BDOS)プリンタ出力
  D3A2                	_SYS1C:		;(BDOS)ディスクの書き込み禁止化
  D3A2                	_SYS1E:		;(BDOS)ファイル属性の設定
  D3A2                	_SYS20:		;(BDOS)利用者番号の設定と読み出し
  D3A2                	_SYS2E:		;(BDOS)ベリファイ・フラグの設定
  D3A2  AF            		XOR	A
  D3A3  C9            		RET
  D3A4                	_SYS03:		;(BDOS)外部入力
  D3A4                	_SYS2B:		;(BDOS)日付の設定
  D3A4                	_SYS2D:		;(BDOS)時刻の設定
  D3A4  37            		SCF			;CF=1
  D3A5  9F            		SBC	A,A		;A=0FFH
  D3A6  C9            		RET
                      	
  D3A7                	_SYS09:		;文字列出力
  D3A7  D5            		PUSH	DE
  D3A8                	_SX09:
  D3A8  1A            		LD	A,(DE)
  D3A9  13            		INC	DE
  D3AA  FE24          		CP	'$'
  D3AC  282C          		JR	Z,SX0E2
  D3AE  D5            		PUSH	DE
  D3AF  5F            		LD	E,A
  D3B0  CD88D7        		CALL	_SYS02
  D3B3  D1            		POP	DE
  D3B4  18F2          		JR	_SX09
                      	
  D3B6                	_SYS0C:		;(BDOS)バージョン番号の獲得
  D3B6  212200        		LD	HL,00022H
  D3B9  AF            		XOR	A
  D3BA  7D            		LD	A,L
  D3BB  C9            		RET
                      	
  D3BC                	_SYS0D:		;(BDOS)ディスク・リセット
  D3BC  CDDFEC        		CALL	_FFLUSH
  D3BF  E5            		PUSH	HL
  D3C0  218000        		LD	HL,00080H
  D3C3  228AEC        		LD	(_DTA),HL
  D3C6  E1            		POP	HL
  D3C7  D5            		PUSH	DE
  D3C8  1E00          		LD	E,0
  D3CA  3E            		DB	03EH
                      	
  D3CB                	_SYS0E:		;(BDOS)カレント・ドライブの設定
  D3CB  D5            		PUSH	DE
  D3CC  7B            		LD	A,E
  D3CD  DDE5          		PUSH	IX
  D3CF  CDDCEC        		CALL	_GETDPB
  D3D2  DDE1          		POP	IX
  D3D4  3804          		JR	C,SX0E2
  D3D6  7B            		LD	A,E
  D3D7  3287EC        		LD	(_DVSW),A
  D3DA                	SX0E2:
  D3DA  3E08          		LD	A,8
  D3DC  D1            		POP	DE
  D3DD  C9            		RET
                      	
  D3DE                	_SYS0F:		;(BDOS)ファイルのオープン
  D3DE  CD74DD        		CALL	SETDRV
  D3E1  FD7E1C        		LD	A,(IY+28)	;(FCB)オープン・モード
  D3E4  C602          		ADD	A,002H		;Write
  D3E6  2848          		JR	Z,FEND0F
  D3E8  CDE8E0        		CALL	CHKWILDX
                      	
  D3EB  D494DD        		CALL	NC,SOPENX
  D3EE                	_S16XX:
  D3EE  3840          		JR	C,FEND0F
                      					;Directory location
  D3F0  3A9FEC        		LD	A,(_FILEN)
  D3F3  FD7719        		LD	(IY+25),A	;(FCB)ディレクトリ・ロケーション
                      	;				_DIRF
  D3F6  3AA0EC        		LD	A,(_DIRF)
  D3F9  FD771D        		LD	(IY+29),A	;(FCB)ディレクトリ・モード
                      	;				_FBPS
  D3FC  FD731E        		LD	(IY+30),E	;(FCB)ディレクトリ・ポジション
  D3FF  FD721F        		LD	(IY+31),D
                      	;				Open(Read)
  D402  FD361CFF      		LD	(IY+28),0FFH	;(FCB)オープン・モード
                      	;				FILENAME
  D406  FDE5          		PUSH	IY
  D408  D1            		POP	DE
  D409  13            		INC	DE
  D40A  010B00        		LD	BC,11
  D40D  EDB0          		LDIR
                      	;				Attribute
  D40F  7E            		LD	A,(HL)
  D410  FD770D        		LD	(IY+13),A	;(FCB)属性(アトリビュート)
  D413  110B00        		LD	DE,11		;Reserved
  D416  19            		ADD	HL,DE
                      						;(FCB)ファイルを最後に変更した時刻
  D417  11EAEB        		LD	DE,SDDATA		;(FCB)ファイルを最後に変更した日付
  D41A  060A          		LD	B,SDDATAE-SDDATA	;(FCB)ファイルの先頭クラスタ
  D41C                	S16LOOP:				;(FCB)ファイルのサイズ(バイト単位)
  D41C  1A            		LD	A,(DE)
  D41D  13            		INC	DE
  D41E  3225D4        		LD	(S16PAT+2),A
  D421  7E            		LD	A,(HL)
  D422  23            		INC	HL
  D423  FD7700        	S16PAT:	LD	(IY+0),A
  D426  10F4          		DJNZ	S16LOOP
                      	
  D428  AF            		XOR	A
  D429  FD770C        		LD	(IY+12),A	;(FCB)カレント・ブロック
  D42C  FD22FCD4      		LD	(OFCB+1),IY
  D430                	FEND0F:
  D430  C3E3D4        		JP	FEND
                      	
  D433                	_SYS10:		;(BDOS)ファイルのクローズ
  D433  CD74DD        		CALL	SETDRV
  D436  FD7E1C        		LD	A,(IY+28)	;(FCB)オープン・モード
  D439  D6FE          		SUB	0FEH
  D43B  37            		SCF
  D43C  3F            		CCF
  D43D  203A          		JR	NZ,FEND10
  D43F                	_S10A:				;Write
  D43F  FD770E        		LD	(IY+14),A	;(FCB)レコード・サイズ/アクセスするディレクトリのクラスタ番号+1
  D442  FD770F        		LD	(IY+15),A
  D445  FD770C        		LD	(IY+12),A	;(FCB)レコード・サイズ/アクセスするディレクトリのセクタインデックス
                      	
  D448  FD341C        		INC	(IY+28)		;0FEH->0FFH ;オープン・モード
  D44B  CDD6E1        		CALL	SETTMS
                      	
  D44E  FD7E1D        		LD	A,(IY+29)	;(FCB)ディレクトリ・モード
  D451  32A0EC        		LD	(_DIRF),A
  D454  E67F          		AND	07FH
  D456  32E5E6        		LD	(_SECPS+1),A
  D459  FD5E1E        		LD	E,(IY+30)	;(FCB)ディレクトリ・ポジション
  D45C  FD561F        		LD	D,(IY+31)
  D45F  CDDCDE        		CALL	READ_DIR
  D462  387F          		JR	C,FEND
                      	
  D464  FD7E19        		LD	A,(IY+25)	;(FCB)ディレクトリ・ロケーション
  D467  E61F          	SDECM1:	AND	01FH		;自己書き換え(1セクタ辺りのディレクトリエントリ数-1) 1024=01FH / 512=00FH / 256=7
  D469  6F            		LD	L,A
  D46A  2600          		LD	H,0
  D46C  29            		ADD	HL,HL		;*2
  D46D  29            		ADD	HL,HL		;*4
  D46E  29            		ADD	HL,HL		;*8
  D46F  29            		ADD	HL,HL		;*16
  D470  29            		ADD	HL,HL		;*32
  D471  ED4B7EEC      		LD	BC,(_DTBUF)
  D475  09            		ADD	HL,BC
                      	
  D476  CDF8E0        		CALL	SDIRENT
  D479                	FEND10:
  D479  1868          		JR	FEND
                      	
  D47B                	OPENDD:
  D47B  FD361CFD      		LD	(IY+28),0FDH	;(FCB)オープン・モード
  D47F  FD360D20      		LD	(IY+13),020H	;(FCB)属性(アトリビュート)
  D483  CDDBE1        		CALL	SETTMSX
  D486  185B          		JR	FEND
                      	
  D488                	_SYS11:		;(BDOS)最初のファイルの検索
  D488  CD74DD        		CALL	SETDRV
  D48B  CD23DF        		CALL	CHKDDX
  D48E  3818          		JR	C,_S11A
  D490  FDE5          		PUSH	IY
  D492  E1            		POP	HL
  D493  ED5B8AEC      		LD	DE,(_DTA)
  D497  010C00        		LD	BC,12
  D49A  EDB0          		LDIR
  D49C  3E20          		LD	A,020H
  D49E  12            		LD	(DE),A
  D49F  13            		INC	DE
  D4A0  62            		LD	H,D
  D4A1  6B            		LD	L,E
  D4A2  13            		INC	DE
  D4A3  0E13          		LD	C,19
  D4A5  70            		LD	(HL),B
  D4A6  1839          		JR	_S11B
  D4A8                	_S11A:
  D4A8  CDCEDD        		CALL	SOPEN
  D4AB                	_S12X1:
  D4AB  3836          		JR	C,FEND
  D4AD  CD71DE        		CALL	SOPENE2
  D4B0  ED5B8AEC      		LD	DE,(_DTA)
  D4B4  3A88EC        		LD	A,(_DRV)
  D4B7  3C            		INC	A
  D4B8  12            		LD	(DE),A
  D4B9  D5            		PUSH	DE
  D4BA  13            		INC	DE
  D4BB  012000        		LD	BC,32
  D4BE  EDB0          		LDIR
  D4C0  FD6E0E        		LD	L,(IY+14)	;(FCB)レコード・サイズ/アクセスするディレクトリのクラスタ番号+1
  D4C3  FD660F        		LD	H,(IY+15)
  D4C6  22F4EB        		LD	(SCDIR),HL
  D4C9  FD7E0C        		LD	A,(IY+12)	;(FCB)レコード・サイズ/アクセスするディレクトリのセクタインデックス
  D4CC  32E5E6        		LD	(_SECPS+1),A
                      	
  D4CF  2A9AEC        		LD	HL,(_FBPS)
  D4D2  22F6EB        		LD	(SFBPS),HL
  D4D5  2A9FEC        		LD	HL,(_FILEN)
  D4D8  22F8EB        		LD	(SFNDF),HL	;Directory position and Flags
  D4DB  E1            		POP	HL
  D4DC  1181E2        		LD	DE,SFILE
  D4DF  0E21          		LD	C,33
  D4E1                	_S11B:
  D4E1  EDB0          		LDIR
  D4E3                	FEND:
  D4E3  9F            		SBC	A,A		;CF=0 A=0 : CF=1 A=0FFH
  D4E4                	FENDE:
  D4E4  FDE1          		POP	IY
  D4E6  C1            		POP	BC
  D4E7  D1            		POP	DE
  D4E8  E1            		POP	HL
  D4E9  C9            		RET
                      	
  D4EA                	_SYS12:		;(BDOS)次のファイルの検索
  D4EA  E5            		PUSH	HL
  D4EB  D5            		PUSH	DE
  D4EC  C5            		PUSH	BC
  D4ED  FDE5          		PUSH	IY
  D4EF  CD3BDE        		CALL	NOPEN
  D4F2  18B7          		JR	_S12X1
                      	
  D4F4                	_S16K:
  D4F4  FD7E1C        		LD	A,(IY+28)	;(FCB)オープン・モード
  D4F7  FEFD          		CP	0FDH		;Device(0FDH)
  D4F9  37            		SCF
  D4FA  C8            		RET	Z
                      	
  D4FB  110000        	OFCB:	LD	DE,0
  D4FE  D5            		PUSH	DE
  D4FF  061A          		LD	B,26		;First cluster
  D501                	S16K1:
  D501  13            		INC	DE
  D502  23            		INC	HL
  D503  10FC          		DJNZ	S16K1
                      	
  D505  1A            		LD	A,(DE)
  D506  BE            		CP	(HL)
  D507  2013          		JR	NZ,S16K2
  D509  13            		INC	DE
  D50A  23            		INC	HL
  D50B  1A            		LD	A,(DE)
  D50C  BE            		CP	(HL)
  D50D  200D          		JR	NZ,S16K2
                      	
  D50F  E1            		POP	HL
  D510  FDE5          		PUSH	IY
  D512  D1            		POP	DE
  D513  1A            		LD	A,(DE)		;Drive
  D514  BE            		CP	(HL)
  D515  2005          		JR	NZ,S16K2
                      					;ここはCFが必ず0
  D517  ED52          		SBC	HL,DE		;CP HL,DE
  D519  37            		SCF
  D51A  C0            		RET	NZ
  D51B  E5            		PUSH	HL
  D51C                	S16K2:
  D51C  E1            		POP	HL
  D51D  FDE5          		PUSH	IY
  D51F  D1            		POP	DE
  D520                	_SYS13:		;(BDOS)ファイルの削除
  D520  CD74DD        		CALL	SETDRV
  D523  CD12E0        		CALL	KILL
  D526                	FEND13:
  D526  18BB          		JR	FEND
                      	
  D528                	_SYS14:		;(BDOS)シーケンシャルな読み出し
  D528  CD74DD        		CALL	SETDRV
  D52B  CD08E2        		CALL	PUSHRR
  D52E  CD49E2        		CALL	GETSEQ
                      	
  D531  CD5DE2        		CALL	RB_READ
  D534  E5            		PUSH	HL
  D535  CD1CE2        		CALL	SETSEQ
  D538                	SREAD:
  D538  E1            		POP	HL
                      	
  D539  C601          		ADD	A,001H
  D53B  38A6          		JR	C,FEND
                      	
  D53D  7D            		LD	A,L
  D53E  D601          		SUB	001H
  D540                	FENDX:
  D540  9F            		SBC	A,A
  D541  E603          		AND	3
  D543  1F            		RRA
  D544  189E          		JR	FENDE
                      	
  D546                	_SYS15:		;(BDOS)シーケンシャルな書き込み
  D546  CD74DD        		CALL	SETDRV
  D549  CD08E2        		CALL	PUSHRR
  D54C  CD49E2        		CALL	GETSEQ
                      	
  D54F  CD56E2        		CALL	RB_WRITE
  D552  E5            		PUSH	HL
  D553  CD1CE2        		CALL	SETSEQ
  D556                	SWRITE:
  D556  E1            		POP	HL
                      	
  D557  C6FF          		ADD	A,0FFH
  D559  18E5          		JR	FENDX
                      	
  D55B                	_SYS17:		;(BDOS)ファイル名の変更
  D55B  CD74DD        		CALL	SETDRV
  D55E  CD6EE0        		CALL	NAME
  D561  18C3          		JR	FEND13
                      	
  D563                	_SYS16:		;(BDOS)ファイルの作成
  D563  CD74DD        		CALL	SETDRV
                      	
  D566  CDE8E0        		CALL	CHKWILDX
  D569  38BB          		JR	C,FEND13
  D56B  FD7E01        		LD	A,(IY+1)	;(FCB)主ファイル名
  D56E  FE05          		CP	5
  D570  2805          		JR	Z,_S16X2
  D572  FE21          		CP	021H
  D574  DA26D5        		JP	C,FEND13
  D577                	_S16X2:
                      	;				Clear FCB
  D577  FDE5          		PUSH	IY
  D579  E1            		POP	HL
  D57A  011000        		LD	BC,16
  D57D  09            		ADD	HL,BC
  D57E                	_S16X1:
  D57E  70            		LD	(HL),B		;B=0
  D57F  23            		INC	HL
  D580  0D            		DEC	C
  D581  20FB          		JR	NZ,_S16X1
                      	
  D583  CDDBE1        		CALL	SETTMSX
  D586  FD360DFF      		LD	(IY+13),0FFH	;(FCB)Attribute
  D58A  CD94DD        		CALL	SOPENX
  D58D  3F            		CCF
  D58E  CCF4D4        		CALL	Z,_S16K
  D591  D482DE        		CALL	NC,COPEN
  D594  D4F8E0        		CALL	NC,SDIRENT
  D597  C3EED3        		JP	_S16XX
                      	
  D59A                	_SYS21:		;(BDOS)ランダムな読み出し
                      	
  D59A  CD74DD        		CALL	SETDRV
  D59D  CD08E2        		CALL	PUSHRR
  D5A0  FD6E21        		LD	L,(IY+33)	;(FCB)Random record
  D5A3  FD6622        		LD	H,(IY+34)
                      	
  D5A6  CD5DE2        		CALL	RB_READ
  D5A9  E5            		PUSH	HL
  D5AA  CD33E2        		CALL	POPRR
  D5AD  1889          		JR	SREAD
                      	
  D5AF                	_SYS22:		;(BDOS)ランダムな書き込み
  D5AF                	_SYS28:		;(BDOS)ランダムな書き込み・その2
  D5AF  CD74DD        		CALL	SETDRV
  D5B2  CD08E2        		CALL	PUSHRR
  D5B5  FD6E21        		LD	L,(IY+33)	;(FCB)Random record
  D5B8  FD6622        		LD	H,(IY+34)
                      	
  D5BB  CD56E2        		CALL	RB_WRITE
  D5BE  E5            		PUSH	HL
  D5BF  CD33E2        		CALL	POPRR
  D5C2  1892          		JR	SWRITE
                      	
  D5C4                	_SYS18:		;(BDOS)ログイン・ベクトルの獲得
  D5C4  21FF00        		LD	HL,000FFH
  D5C7  AF            		XOR	A
  D5C8  C9            		RET
                      	
  D5C9                	_SYS19:		;(BDOS)カレント・ドライブ番号の獲得
  D5C9  3A87EC        		LD	A,(_DVSW)
  D5CC  A7            		AND	A
  D5CD  C9            		RET
                      	
  D5CE                	_SYS1A:		;(BDOS)DTAの設定
  D5CE  ED538AEC      		LD	(_DTA),DE
  D5D2  AF            		XOR	A
  D5D3  C9            		RET
                      	
  D5D4                	_SYS1B:		;(BDOS)ディスク情報の獲得
  D5D4  7B            		LD	A,E
  D5D5  CD87DD        		CALL	GETDRV
  D5D8  CDDCEC        		CALL	_GETDPB
  D5DB  D4E2EC        		CALL	NC,_RDFATX
  D5DE  210000        		LD	HL,0
  D5E1  D4B4E1        		CALL	NC,DSKF
                      	
  D5E4  ED5BB5E1      		LD	DE,(MAXCLP+1)	;DPB_08_MAXCL-1
  D5E8  1B            		DEC	DE		;DE←クラスタの総数
  D5E9  FD2A7CEC      		LD	IY,(_FATBF)	;IY←メモリ上のFATの先頭アドレス
  D5ED  9F            		SBC	A,A
  D5EE  D8            		RET	C
  D5EF  4F            		LD	C,A		;C=0
  D5F0  DD7E0F        		LD	A,(IX+00FH)	;DPB_0F_BPS
  D5F3  E60F          		AND	00FH
  D5F5  47            		LD	B,A
  D5F6  DD7E07        		LD	A,(IX+7)	;DPB_07_SECPCL
  D5F9  C9            		RET
                      	
  D5FA                	_SYS1D:		;(BDOS)書き込みが禁止されているディスクの調査
  D5FA  AF            		XOR	A
  D5FB  67            		LD	H,A
  D5FC  6F            		LD	L,A
  D5FD  C9            		RET
                      	
  D5FE                	_SYS1F:		;(BDOS)ディスク装置のパラメータの読み出し
  D5FE  2100ED        		LD	HL,DEVICE
  D601  7B            		LD	A,E
  D602  C3DCEC        		JP	_GETDPB
                      	
  D605                	_SYS23:		;(BDOS)ファイル・サイズの獲得
  D605  E5            		PUSH	HL
  D606  2A1EEC        		LD	HL,(STABLE+2*00FH)	;ファイルのオープン
  D609  CD0F00        		CALL	JP_HL
  D60C  3814          		JR	C,_S23X1
                      	
  D60E  D5            		PUSH	DE		;EX DE,IY
  D60F  FDE3          		EX	(SP),IY		;
                      	;	POP	DE		;
                      	;	PUSH	DE		;DEを破壊しないように注意vv
  D611  CD39E2        		CALL	GETSIZE
  D614                	_S24X1:
  D614  FD7521        		LD	(IY+33),L	;(FCB)Random record
  D617  FD7422        		LD	(IY+34),H
  D61A  FD362300      		LD	(IY+35),0
                      	;	POP	DE		;^^^^^^^^^^^^^^^^^^^^^^^^
                      	;	PUSH	DE		;EX DE,IY
  D61E  FDE3          		EX	(SP),IY		;
  D620  D1            		POP	DE		;
                      	
  D621  AF            		XOR	A
  D622                	_S23X1:
  D622  E1            		POP	HL
  D623  C9            		RET
                      	
  D624                	_SYS24:		;(BDOS)ランダム・レコード・フィールドの設定
  D624  E5            		PUSH	HL
  D625  D5            		PUSH	DE		;EX DE,IY
  D626  FDE3          		EX	(SP),IY		;
                      	;	POP	DE		;
                      	;	PUSH	DE		;DEを破壊しないように注意vv
  D628  CD49E2        		CALL	GETSEQ
  D62B  18E7          		JR	_S24X1		;^^^^^^^^^^^^^^^^^^^^^^^^
                      	
  D62D                	_SYS29:		;(BDOS)ファイル名の解析
  D62D  C5            		PUSH	BC
  D62E  E5            		PUSH	HL
  D62F  CD88DC        		CALL	FILE
  D632  E1            		POP	HL
  D633  C1            		POP	BC
  D634                	S29X1:
  D634  C5            		PUSH	BC
  D635  D5            		PUSH	DE
  D636  E5            		PUSH	HL
  D637  EB            		EX	DE,HL
  D638  21DB00        		LD	HL,FDRV
  D63B  010D00        		LD	BC,13
  D63E  EDB0          		LDIR
  D640  70            		LD	(HL),B
  D641  0E03          		LD	C,3
  D643  EDB0          		LDIR
  D645  E1            		POP	HL
  D646  D1            		POP	DE
  D647  C1            		POP	BC
  D648  AF            		XOR	A
  D649  C9            		RET
                      	
  D64A                	_SYS30:		;(BDOS)論理セクタを用いた書き込み
  D64A  C5            		PUSH	BC
  D64B  014FE8        		LD	BC,DWT16
  D64E  1804          		JR	S2FX
  D650                	_SYS2F:
  D650  C5            		PUSH	BC
  D651  012EE8        		LD	BC,DRD16
  D654                	S2FX:
  D654  ED4369D6      		LD	(S2FPAT+1),BC
  D658  CDDFEC        		CALL	_FFLUSH
                      	
  D65B  D5            		PUSH	DE
  D65C  E5            		PUSH	HL
  D65D  7D            		LD	A,L		;Drive
  D65E  CDD9EC        		CALL	_CHGDRV
  D661  380D          		JR	C,S30X2
  D663  44            		LD	B,H		;Number of clusters
  D664  2A8AEC        		LD	HL,(_DTA)
  D667                	S30X:
  D667  C5            		PUSH	BC
  D668  CD2EE8        	S2FPAT:	CALL	DRD16
  D66B  C1            		POP	BC
  D66C  3802          		JR	C,S30X2
  D66E  10F7          		DJNZ	S30X
  D670                	S30X2:
  D670  E1            		POP	HL
  D671  D1            		POP	DE
  D672  C1            		POP	BC
  D673  9F            		SBC	A,A
  D674  C9            		RET
                      	
                      	;LDIO.ASM
                      	
                      	;	LSX-Dodgers IO
                      	
                      	
  D675                	BIOS:
  D675  E5            		PUSH	HL
  D676  210081        		LD	HL,08100H
  D679  39            		ADD	HL,SP
  D67A  E1            		POP	HL
  D67B  300E          		JR	NC,BIOS2
  D67D                	BIOS1:
  D67D  CD85D6        		CALL	BIOS3
  D680  061E          		LD	B,01EH
  D682  ED79          		OUT	(C),A
  D684  C9            		RET
  D685                	BIOS3:
  D685  C5            		PUSH	BC
  D686  061D          		LD	B,01DH
  D688  ED79          		OUT	(C),A
  D68A  C9            		RET
  D68B                	BIOS2:
  D68B  ED7396D6      		LD	(SPPAT+1),SP	;スタックがBIOS-ROMと被っている場合
  D68F  31D4FF        		LD	SP,EXTSP
  D692  CD7DD6        		CALL	BIOS1
  D695  310000        	SPPAT:	LD	SP,0
  D698  C9            		RET
                      	
  D699                	INT:
  D699  F5            		PUSH	AF
  D69A  E5            		PUSH	HL
  D69B  210001        		LD	HL,00100H
  D69E  39            		ADD	HL,SP
  D69F  380C          		JR	C,INTP1X
  D6A1  ED73A9D6      		LD	(INTSP+1),SP
  D6A5  CDB5D6        		CALL	INTP1
  D6A8  310000        	INTSP:	LD	SP,0
  D6AB  1803          		JR	INTPE
  D6AD                	INTP1X:
  D6AD  CDB5D6        		CALL	INTP1
  D6B0                	INTPE:
  D6B0  E1            		POP	HL
  D6B1                	INTPE2:
  D6B1  F1            		POP	AF
  D6B2                	INTCTCE:
  D6B2  FB            		EI
  D6B3  ED4D          		RETI
  D6B5                	INTP1:
  D6B5  C5            		PUSH	BC
                      	
  D6B6  CD94DA        		CALL	IN49SB
  D6B9  67            		LD	H,A
  D6BA  CD94DA        		CALL	IN49SB
  D6BD  6F            		LD	L,A
                      	
  D6BE  FE08          		CP	8		;DELキー
  D6C0  2005          		JR	NZ,SCEXE
  D6C2  7C            		LD	A,H
  D6C3  E611          		AND	011H		;CTRLキー + GRAPHキー
  D6C5  2808          		JR	Z,RESET
  D6C7                	SCEXE:
  D6C7  2292EC        		LD	(_KEYD),HL
  D6CA  CDFBD6        		CALL	KEYSET1
                      	
  D6CD  C1            		POP	BC
  D6CE  C9            		RET
                      	
  D6CF                	RESET:
  D6CF  3E1D          		LD	A,01DH
  D6D1  D300          		OUT	(0),A
  D6D3  C7            		RST	0
                      	
  D6D4                	INTCTC2:
  D6D4  F5            		PUSH	AF
  D6D5  3E00          	INTCPAT:LD	A,000H
  D6D7  3D            		DEC	A
  D6D8  32D6D6        		LD	(INTCPAT+1),A
  D6DB  20D4          		JR	NZ,INTPE2
                      	
  D6DD  3A92EC        		LD	A,(_KEYD)
  D6E0  B7            		OR	A
  D6E1  28CE          		JR	Z,INTPE2
  D6E3                	KEYSET0:
  D6E3  E5            		PUSH	HL
  D6E4  2A90EC        		LD	HL,(_KEYPS)
  D6E7  7C            		LD	A,H
  D6E8  AD            		XOR	L
  D6E9  2006          		JR	NZ,INTC2A
                      	
  D6EB  2A92EC        		LD	HL,(_KEYD)
  D6EE  CD25D7        		CALL	KEYSET
  D6F1                	INTC2A:
  D6F1  3A94EC        		LD	A,(_KEYSP)
  D6F4  E60F          		AND	00FH
  D6F6  32D6D6        		LD	(INTCPAT+1),A
                      	
  D6F9  18B5          		JR	INTPE
                      	
  D6FB                	KEYSET1:
  D6FB  CB6C          		BIT	5,H
  D6FD  F5            		PUSH	AF
  D6FE  ED4B8CEC      		LD	BC,(_CTC)
  D702  78            		LD	A,B
  D703  B1            		OR	C
  D704  2006          		JR	NZ,KEYS10E
                      	
  D706  F1            		POP	AF
  D707  201C          		JR	NZ,KEYSET
  D709  F5            		PUSH	AF
  D70A  18D7          		JR	KEYSET0
  D70C                	KEYS10E:
  D70C  F1            		POP	AF
  D70D  C8            		RET	Z
  D70E  F5            		PUSH	AF
  D70F  3E03          		LD	A,3		;CTC STOP
  D711  ED79          		OUT	(C),A
  D713  F1            		POP	AF
                      	
  D714  B7            		OR	A
  D715  C8            		RET	Z
                      	
  D716  E5            		PUSH	HL
  D717  2A94EC        		LD	HL,(_KEYSP)
  D71A  3EA7          		LD	A,0A7H
  D71C  ED79          		OUT	(C),A
  D71E  ED69          		OUT	(C),L
  D720  7C            		LD	A,H
  D721  32D6D6        		LD	(INTCPAT+1),A
  D724  E1            		POP	HL
                      	
  D725                	KEYSET:
  D725  7D            		LD	A,L
  D726  CB7C          		BIT	7,H
  D728  CC55D7        		CALL	Z,FKEY
  D72B  CB74          		BIT	6,H
  D72D  C0            		RET	NZ
  D72E                	KEYBS:
  D72E  B7            		OR	A
  D72F  C8            		RET	Z
  D730                	KEYBS1:
  D730  FE03          		CP	3
  D732  CC48D7        		CALL	Z,KEYBC
  D735  E5            		PUSH	HL
  D736  F5            		PUSH	AF
  D737  2A90EC        		LD	HL,(_KEYPS)
  D73A  2C            		INC	L
  D73B  7D            		LD	A,L
  D73C  BC            		CP	H
  D73D  2812          		JR	Z,POP_AF_HL_SCF_RET
  D73F  3290EC        		LD	(_KEYPS),A
  D742  26FE          		LD	H,KEYBF/256
  D744  F1            		POP	AF
  D745  77            		LD	(HL),A
  D746  E1            		POP	HL
  D747  C9            		RET
                      	
  D748                	KEYBC:
  D748  E5            		PUSH	HL
  D749  210000        		LD	HL,0
  D74C  2290EC        		LD	(_KEYPS),HL
  D74F  E1            		POP	HL
  D750  C9            		RET
                      	
  D751                	POP_AF_HL_SCF_RET:
  D751  F1            		POP	AF
  D752  E1            		POP	HL
  D753  37            		SCF
  D754  C9            		RET
                      	
  D755                	FKEY:
  D755  CB75          		BIT	6,L
  D757  C8            		RET	Z
  D758  3E1B          		LD	A,01BH
  D75A  CD30D7        		CALL	KEYBS1
  D75D  7D            		LD	A,L
  D75E  C6AF          		ADD	A,020H-'q'
  D760  CB7D          		BIT	7,L
  D762  C8            		RET	Z
  D763  2E50          		LD	L,'P'
  D765  D690          		SUB	0E1H+020H-'q'
  D767  2810          		JR	Z,KEYBSL
  D769  2C            		INC	L
  D76A  3D            		DEC	A
  D76B  280C          		JR	Z,KEYBSL
  D76D  2C            		INC	L
  D76E  D609          		SUB	0EBH-0E2H
  D770  2807          		JR	Z,KEYBSL
  D772  2E43          		LD	L,'C'
  D774  3D            		DEC	A
  D775  2802          		JR	Z,KEYBSL
  D777  2E58          		LD	L,'X'
  D779                	KEYBSL:
  D779  7D            		LD	A,L
  D77A  18B4          		JR	KEYBS1
                      	
  D77C                	_SYS01:		;(BDOS)コンソール入力
  D77C  CD6BD3        		CALL	_SYS07
  D77F                	MSG_:
  D77F  F5            		PUSH	AF
  D780  D5            		PUSH	DE
  D781  5F            		LD	E,A
  D782  CD88D7        		CALL	_SYS02
  D785  D1            		POP	DE
  D786  F1            		POP	AF
  D787  C9            		RET
                      	
  D788                	_SYS02:		;(BDOS)コンソール出力
  D788  CD9AD7        		CALL	BREAK
  D78B  1805          		JR	PRINTX
                      	
  D78D                	_SYS06:		;(BDOS)コンソール直接入出力
  D78D  7B            		LD	A,E
  D78E  3C            		INC	A
  D78F  CACAEC        		JP	Z,_INKEY
  D792                	PRINTX:
  D792  C3CDEC        		JP	_PRINT
                      	
  D795                	_SYS08:		;(BDOS)エコーなしコンソール入力
  D795  CD6BD3        		CALL	_SYS07
  D798  1804          		JR	BREAK1
  D79A                	BREAK:
  D79A  FB            		EI
  D79B  3A92EC        		LD	A,(_KEYD)
  D79E                	BREAK1:
  D79E  FE03          		CP	3
  D7A0  CA0000        		JP	Z,0
  D7A3  FE13          		CP	013H
  D7A5  C0            		RET	NZ
                      	
  D7A6                	PAUSE:
  D7A6  CD48D7        		CALL	KEYBC
                      	
  D7A9                	FLGET:
  D7A9  CDDFEC        		CALL	_FFLUSH
  D7AC  C5            		PUSH	BC
  D7AD  E5            		PUSH	HL
  D7AE  ED4B8EEC      		LD	BC,(_TXADR)
  D7B2  CBE8          		SET	5,B
  D7B4  ED60          		IN	H,(C)
  D7B6                	FLGET1:
  D7B6  3A93EC        		LD	A,(_KEYD+1)
  D7B9  0F            		RRCA
  D7BA  0F            		RRCA
  D7BB  E610          		AND	010H
  D7BD  F608          		OR	8
  D7BF  ED68          		IN	L,(C)
  D7C1  B5            		OR	L
  D7C2  ED79          		OUT	(C),A
  D7C4  CDCAEC        		CALL	_INKEY
  D7C7  28ED          		JR	Z,FLGET1
  D7C9  ED61          		OUT	(C),H
  D7CB  E1            		POP	HL
  D7CC  C1            		POP	BC
  D7CD  C9            		RET
                      	
  D7CE                	_SYS0A:		;(BDOS)文字列入力
  D7CE  C5            		PUSH	BC
  D7CF  E5            		PUSH	HL
  D7D0  D5            		PUSH	DE
  D7D1  CDEFDB        		CALL	GETL
  D7D4  1100FF        		LD	DE,KBUF
  D7D7  E1            		POP	HL
  D7D8  E5            		PUSH	HL
  D7D9  0E00          		LD	C,0
  D7DB  3004          		JR	NC,SAX0
  D7DD  23            		INC	HL
  D7DE  23            		INC	HL
  D7DF  1808          		JR	SAX4
  D7E1                	SAX0:
  D7E1  46            		LD	B,(HL)
  D7E2  23            		INC	HL
  D7E3                	SAX1:
  D7E3  23            		INC	HL
  D7E4  1A            		LD	A,(DE)
  D7E5  13            		INC	DE
  D7E6  B7            		OR	A
  D7E7  2004          		JR	NZ,SAX2
  D7E9                	SAX4:
  D7E9  360D          		LD	(HL),00DH
  D7EB  1804          		JR	SAX3
  D7ED                	SAX2:
  D7ED  77            		LD	(HL),A
  D7EE  0C            		INC	C
  D7EF  10F2          		DJNZ	SAX1
  D7F1                	SAX3:
  D7F1  D1            		POP	DE
  D7F2  79            		LD	A,C
  D7F3  13            		INC	DE
  D7F4  12            		LD	(DE),A
  D7F5  1B            		DEC	DE
  D7F6  E1            		POP	HL
  D7F7  C1            		POP	BC
  D7F8  A7            		AND	A
  D7F9  C9            		RET
                      	
  D7FA                	_SYS0B:		;(BDOS)コンソール状態のチェック
  D7FA  CD9AD7        		CALL	BREAK
  D7FD  3A92EC        		LD	A,(_KEYD)
  D800  B7            		OR	A
  D801  C8            		RET	Z
  D802                	CONSTX:
  D802  CDDFEC        		CALL	_FFLUSH
  D805  E5            		PUSH	HL
  D806  2A90EC        		LD	HL,(_KEYPS)
  D809  7C            		LD	A,H
  D80A  AD            		XOR	L
  D80B  E1            		POP	HL
  D80C  C6FF          		ADD	A,0FFH
  D80E  9F            		SBC	A,A
  D80F  C9            		RET
                      	
  D810                	_SYS2A:		;(BDOS)日付の獲得
  D810  C5            		PUSH	BC
  D811  3EED          		LD	A,0EDH		;Read calendar
  D813  CDAFDA        		CALL	COMOUT
  D816  CD33D8        		CALL	IN49SB_BCD	;YY
  D819  6F            		LD	L,A
  D81A  2600          		LD	H,0
                      	;	LD	DE,1900		;0076CH
                      	;	CP	90		;90以上は1900年代 1990-1999
                      	;	JR	NC,RDDATE1	;90未満は2000年代 2000-2089
                      	;	LD	E,0D0H		;2000 & 0FFH D=007H
  D81C  11D007        		LD	DE,2000		;すべて2000年代で処理 2000-2099
  D81F                	RDDATE1:
  D81F  19            		ADD	HL,DE
  D820  CD94DA        		CALL	IN49SB		;MM
  D823  57            		LD	D,A
  D824  CD33D8        		CALL	IN49SB_BCD	;DD
  D827  5F            		LD	E,A
  D828  7A            		LD	A,D
  D829  E607          		AND	7
  D82B  0604          		LD	B,4
  D82D                	RDDATE2:
  D82D  CB3A          		SRL	D
  D82F  10FC          		DJNZ	RDDATE2
  D831  C1            		POP	BC
  D832  C9            		RET
  D833                	IN49SB_BCD:
  D833  CD94DA        		CALL	IN49SB
                      	;------------------------
                      	;BCDの10進数化
                      	;in
                      	;	A  : BCD
                      	;out
                      	;	A  : 10進数
                      	;------------------------
  D836  4F            		LD	C,A
  D837  E6F0          		AND	0F0H	;10の位
  D839  0F            		RRCA
  D83A  47            		LD	B,A
  D83B  0F            		RRCA
  D83C  0F            		RRCA
  D83D  80            		ADD	A,B
  D83E  47            		LD	B,A
  D83F  79            		LD	A,C
  D840  E60F          		AND	00FH	;1の位
  D842  80            		ADD	A,B
  D843  C9            		RET
                      	
  D844                	_SYS2C:		;(BDOS)時刻の獲得
  D844  C5            		PUSH	BC
  D845  3EEF          		LD	A,0EFH		;Read time
  D847  CDAFDA        		CALL	COMOUT
  D84A  CD33D8        		CALL	IN49SB_BCD	;TT
  D84D  67            		LD	H,A
  D84E  CD33D8        		CALL	IN49SB_BCD	;MM
  D851  6F            		LD	L,A
  D852  CD33D8        		CALL	IN49SB_BCD	;SS
  D855  57            		LD	D,A
  D856  C1            		POP	BC
  D857  AF            		XOR	A
  D858  C9            		RET
                      	
  D859                	MSX1:
  D859  5F            		LD	E,A
  D85A  CDCDEC        		CALL	_PRINT
  D85D                	MSX:
  D85D  7E            		LD	A,(HL)
  D85E  23            		INC	HL
  D85F  B7            		OR	A
  D860  20F7          		JR	NZ,MSX1
  D862  C9            		RET
                      	
  D863                	ESC1:
  D863  7B            		LD	A,E
  D864  FE41          		CP	'A'
  D866  CAA2D9        		JP	Z,CTRL1E
  D869  FE42          		CP	'B'
  D86B  CA1ADB        		JP	Z,CTRL1F
  D86E  FE43          		CP	'C'
  D870  CAAFD9        		JP	Z,CTRL1C
  D873  FE44          		CP	'D'
  D875  CA98D9        		JP	Z,CTRL1D
  D878  FE45          		CP	'E'
  D87A  2802          		JR	Z,CT0CX
  D87C  FE6A          		CP	'j'
  D87E                	CT0CX:
  D87E  CAEDDA        		JP	Z,CTRL0C
  D881  FE48          		CP	'H'
  D883  CA2DDA        		JP	Z,CTRL0B
  D886  FE4A          		CP	'J'
  D888  CAF0DA        		JP	Z,CTRL1A
  D88B  FE4B          		CP	'K'
  D88D  CAEFD9        		JP	Z,CTRL05
  D890  FE4C          		CP	'L'
  D892  CA2FDB        		JP	Z,CTRL0E
  D895  FE78          		CP	'x'
  D897  2804          		JR	Z,ESC1X
  D899  FE79          		CP	'y'
  D89B  2002          		JR	NZ,ESC1Y
  D89D                	ESC1X:
  D89D  3601          		LD	(HL),1
  D89F                	ESC1Y:
  D89F  FE3D          		CP	'='
  D8A1  2804          		JR	Z,ESC1W
  D8A3  FE59          		CP	'Y'
  D8A5  2002          		JR	NZ,ESC1Z
  D8A7                	ESC1W:
  D8A7  3602          		LD	(HL),2
  D8A9                	ESC1Z:
  D8A9  FE20          		CP	020H
  D8AB  3802          		JR	C,ESC1C
  D8AD  87            		ADD	A,A
  D8AE  D0            		RET	NC
  D8AF                	ESC1C:
  D8AF  E1            		POP	HL
  D8B0  184A          		JR	ANK
                      	
  D8B2                	ESC:
  D8B2  210DD9        		LD	HL,PRINTE5
  D8B5  E5            		PUSH	HL
  D8B6  21D8D8        		LD	HL,ESCFLG+1
  D8B9  3600          		LD	(HL),0
  D8BB  3D            		DEC	A
  D8BC  28A5          		JR	Z,ESC1
  D8BE  3D            		DEC	A
  D8BF  2009          		JR	NZ,ESC2
  D8C1  3603          		LD	(HL),3
  D8C3  7B            		LD	A,E
  D8C4  D620          		SUB	020H
  D8C6  32CDD8        		LD	(ESCYP+1),A
  D8C9  C9            		RET
  D8CA                	ESC2:
  D8CA  3D            		DEC	A
  D8CB  C0            		RET	NZ
  D8CC  2600          	ESCYP:	LD	H,0
  D8CE  7B            		LD	A,E
  D8CF  D620          		SUB	020H
  D8D1  6F            		LD	L,A
  D8D2  C3D6EC        		JP	_LOC
                      	
  D8D5                	PRINT:
  D8D5  C5            		PUSH	BC
  D8D6  E5            		PUSH	HL
  D8D7  3E00          	ESCFLG:	LD	A,000H
  D8D9  B7            		OR	A
  D8DA  20D6          		JR	NZ,ESC
                      	
  D8DC  3E1F          		LD	A,01FH
  D8DE  BB            		CP	E
  D8DF  3030          		JR	NC,CTRL
  D8E1                	PRINTC:
  D8E1  A7            	INSFLG:	AND	A
  D8E2  DCB8DA        		CALL	C,CTRL12
                      	
  D8E5  3E00          	KANFLG:	LD	A,000H
  D8E7  B7            		OR	A
  D8E8  203F          		JR	NZ,KANJI2
  D8EA  7B            	X1KPAT:	LD	A,E
  D8EB  FE80          		CP	080H
  D8ED  380D          		JR	C,ANK
  D8EF  FEA0          		CP	0A0H
  D8F1  3804          		JR	C,KANJI1
  D8F3  FEE0          		CP	0E0H
  D8F5  3805          		JR	C,ANK
  D8F7                	KANJI1:
  D8F7  32E6D8        		LD	(KANFLG+1),A
  D8FA  1811          		JR	PRINTE5
  D8FC                	ANK:
  D8FC  ED4B8EEC      		LD	BC,(_TXADR)
  D900  78            		LD	A,B
  D901  F638          		OR	038H
  D903  47            		LD	B,A
  D904  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令	kanji
  D906  CB98          		RES	3,B
  D908  ED59          		OUT	(C),E		;Text
  D90A                	KANJIE:
  D90A  CD74D9        		CALL	PRINTE7
  D90D                	PRINTE5:
  D90D  E1            		POP	HL
  D90E  C1            		POP	BC
  D90F  AF            		XOR	A
  D910  C9            		RET
                      	
  D911                	CTRL:
  D911  CD5BD9        		CALL	KANCLR
  D914  3EA7          		LD	A,0A7H		;AND	A
  D916  32E1D8        		LD	(INSFLG),A
  D919  7B            		LD	A,E
  D91A  87            		ADD	A,A
  D91B  F680          		OR	080H
  D91D  6F            		LD	L,A
  D91E  26EB          		LD	H,CTRLTB/256
  D920  7E            		LD	A,(HL)
  D921  2C            		INC	L
  D922  66            		LD	H,(HL)
  D923  6F            		LD	L,A
  D924  CD0F00        		CALL	JP_HL
  D927  18E4          		JR	PRINTE5
                      	
  D929                	KANJI2:
  D929  D5            		PUSH	DE
  D92A  57            		LD	D,A
  D92B  01812F        		LD	BC,02F81H	;SFTJIS
  D92E  DF            		RST	018H
  D92F  01C32F        		LD	BC,02FC3H	;Instead or JISVRM
  D932  DF            		RST	018H
                      	
  D933  ED4B8EEC      		LD	BC,(_TXADR)
  D937  78            		LD	A,B
  D938  F638          		OR	038H
  D93A  47            		LD	B,A
  D93B  ED51          		OUT	(C),D		;kanji
  D93D  CB98          		RES	3,B
  D93F  ED59          		OUT	(C),E		;Text
  D941  CD74D9        		CALL	PRINTE7
  D944  ED4B8EEC      		LD	BC,(_TXADR)
  D948  78            		LD	A,B
  D949  F638          		OR	038H
  D94B  47            		LD	B,A
  D94C  CBF2          		SET	6,D
  D94E  ED51          		OUT	(C),D		;Kanji
  D950  CB98          		RES	3,B
  D952  ED59          		OUT	(C),E		;Text
  D954  D1            		POP	DE
  D955  AF            		XOR	A
  D956  32E6D8        		LD	(KANFLG+1),A
  D959  18AF          		JR	KANJIE
                      	
  D95B                	KANCLR:
  D95B  3AE6D8        		LD	A,(KANFLG+1)
  D95E  B7            		OR	A
  D95F  C8            		RET	Z
  D960  ED4B8EEC      		LD	BC,(_TXADR)
  D964  78            		LD	A,B
  D965  F638          		OR	038H
  D967  47            		LD	B,A
  D968  AF            		XOR	A
  D969  32E6D8        		LD	(KANFLG+1),A
  D96C  ED79          		OUT	(C),A		;Kanji
  D96E  CB98          		RES	3,B
  D970  3E20          		LD	A,020H
  D972  ED79          		OUT	(C),A		;Text
  D974                	PRINTE7:
  D974  CBA0          		RES	4,B
  D976                	PRINTE6:
  D976  3A96EC        		LD	A,(_COLORF)
  D979                	PRINTE4:
  D979  ED79          		OUT	(C),A		;Color
  D97B  78            		LD	A,B
  D97C  E607          		AND	7
  D97E  47            		LD	B,A
  D97F                	PRINTE2:
  D97F  03            		INC	BC
  D980                	PRINTE3:
  D980  2ABAEC        		LD	HL,(CRTCD+10)
  D983  A7            		AND	A
  D984  ED4A          		ADC	HL,BC
  D986                	PRINTE8:
  D986  2805          		JR	Z,PRINT2
  D988                	PRINTE1:
  D988  ED438EEC      		LD	(_TXADR),BC
  D98C                	PRINTE:
  D98C  C9            		RET
                      	
  D98D                	PRINT2:
  D98D  CD35DB        		CALL	SCR
  D990  2ABCEC        		LD	HL,(CRTCD+12)
  D993  09            		ADD	HL,BC
  D994  228EEC        		LD	(_TXADR),HL
  D997  C9            		RET
                      	
  D998                	CTRL08:
  D998                	CTRL1D:
  D998  ED4B8EEC      		LD	BC,(_TXADR)
  D99C  78            		LD	A,B
  D99D  B1            		OR	C
  D99E  C8            		RET	Z
  D99F  0B            		DEC	BC
  D9A0  18E6          		JR	PRINTE1
                      	
  D9A2                	CTRL1E:
  D9A2  ED4B8EEC      		LD	BC,(_TXADR)
  D9A6  2ABCEC        		LD	HL,(CRTCD+12)
  D9A9  09            		ADD	HL,BC
  D9AA  D0            		RET	NC
  D9AB  44            		LD	B,H
  D9AC  4D            		LD	C,L
  D9AD  18D9          		JR	PRINTE1
                      	
  D9AF                	CTRL1C:
  D9AF  ED4B8EEC      		LD	BC,(_TXADR)
  D9B3  18CA          		JR	PRINTE2
                      	
  D9B5                	CTRL09:
  D9B5  ED4B8EEC      		LD	BC,(_TXADR)
  D9B9  79            		LD	A,C
  D9BA  E6F8          		AND	0F8H
  D9BC  C608          		ADD	A,8
  D9BE  4F            		LD	C,A
  D9BF  88            		ADC	A,B
  D9C0  91            		SUB	C
  D9C1  47            		LD	B,A
  D9C2  18BC          		JR	PRINTE3
                      	
  D9C4                	CTRL02:
  D9C4  2A8EEC        		LD	HL,(_TXADR)
  D9C7  7C            		LD	A,H
  D9C8  B5            		OR	L
  D9C9  C8            		RET	Z
  D9CA  2B            		DEC	HL
  D9CB  228EEC        		LD	(_TXADR),HL
  D9CE  D5            		PUSH	DE
  D9CF  CDD3EC        		CALL	_POS
  D9D2  3AB1EC        		LD	A,(CRTCD+1)
  D9D5  95            		SUB	L
  D9D6  6F            		LD	L,A
  D9D7  2D            		DEC	L
  D9D8  2638          		LD	H,038H
  D9DA  ED4B8EEC      		LD	BC,(_TXADR)
  D9DE  09            		ADD	HL,BC
  D9DF  44            		LD	B,H
  D9E0  4D            		LD	C,L
  D9E1  110020        		LD	DE,02000H	;D:Text E:kanji
  D9E4  2A96EC        		LD	HL,(_COLORF)	;L:Color
  D9E7                	C8X1:
  D9E7  CDD4DA        		CALL	C12S
  D9EA  0B            		DEC	BC
  D9EB  20FA          		JR	NZ,C8X1
  D9ED  D1            		POP	DE
  D9EE  C9            		RET
                      	
  D9EF                	CTRL05:
  D9EF  CDD3EC        		CALL	_POS
  D9F2  3AB1EC        		LD	A,(CRTCD+1)
  D9F5  95            		SUB	L
  D9F6  6F            		LD	L,A
  D9F7  2620          		LD	H,020H
  D9F9  ED4B8EEC      		LD	BC,(_TXADR)
  D9FD                	C05X1:
  D9FD  78            		LD	A,B
  D9FE  F638          		OR	038H
  DA00  47            		LD	B,A
  DA01  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令	kanji
  DA03  CB98          		RES	3,B
  DA05  ED61          		OUT	(C),H		;Text
  DA07  CBA0          		RES	4,B
  DA09  3A96EC        		LD	A,(_COLORF)
  DA0C  ED79          		OUT	(C),A		;Color
  DA0E  03            		INC	BC
  DA0F  2D            		DEC	L
  DA10  20EB          		JR	NZ,C05X1
  DA12  C9            		RET
                      	
  DA13                	CTRL0D:
  DA13  CDD3EC        		CALL	_POS
  DA16  2E00          		LD	L,0
  DA18                	LOC:
  DA18  C5            		PUSH	BC
  DA19  E5            		PUSH	HL
  DA1A  CD5BD9        		CALL	KANCLR
  DA1D  CD40DA        		CALL	LOC1
  DA20  ED438EEC      		LD	(_TXADR),BC
  DA24  E1            		POP	HL
  DA25  C1            		POP	BC
  DA26  C9            		RET
                      	
  DA27                	CTRL01:
  DA27  3E37          		LD	A,037H		;SCF
  DA29  32E1D8        		LD	(INSFLG),A
  DA2C  C9            		RET
                      	
  DA2D                	CTRL0B:
  DA2D  210000        		LD	HL,0
  DA30  228EEC        		LD	(_TXADR),HL
  DA33  C9            		RET
                      	
  DA34                	PRINTS:
  DA34  CD9AD7        		CALL	BREAK
  DA37  C3CDEC        		JP	_PRINT
                      	
  DA3A                	CTRL1B:
  DA3A  3E01          		LD	A,1
  DA3C  32D8D8        		LD	(ESCFLG+1),A
  DA3F  C9            		RET
                      	
  DA40                	LOC1:
  DA40  44            		LD	B,H
  DA41  4D            		LD	C,L
  DA42  04            		INC	B
  DA43  05            		DEC	B
  DA44  C8            		RET	Z
  DA45  D5            		PUSH	DE
  DA46  ED5BB1EC      		LD	DE,(CRTCD+1)
  DA4A  210000        		LD	HL,0
  DA4D  55            		LD	D,L
  DA4E                	LOC2:
  DA4E  19            		ADD	HL,DE
  DA4F  10FD          		DJNZ	LOC2
  DA51  09            		ADD	HL,BC
  DA52  D1            		POP	DE
  DA53                	LOC3:
  DA53  44            		LD	B,H
  DA54  4D            		LD	C,L
  DA55  C9            		RET
                      	
  DA56                	CONOUT1:
  DA56  CD68DA        		CALL	CURSOR
  DA59  59            		LD	E,C
  DA5A  CDCDEC        		CALL	_PRINT
  DA5D  7B            		LD	A,E
  DA5E  FE0A          		CP	00AH
  DA60  2006          		JR	NZ,CURSOR
  DA62  CD13DA        		CALL	CTRL0D
  DA65  CDEFD9        		CALL	CTRL05
  DA68                	CURSOR:
  DA68  C5            		PUSH	BC
  DA69  ED4B8EEC      		LD	BC,(_TXADR)
  DA6D  CBE8          		SET	5,B
  DA6F  ED78          		IN	A,(C)
  DA71  EE18          		XOR	018H
  DA73  ED79          		OUT	(C),A
  DA75  C1            		POP	BC
  DA76  C9            		RET
                      	
  DA77                	CTRL07:
  DA77  2170EB        		LD	HL,BEEPD
  DA7A                	BEEP1:
  DA7A  7E            		LD	A,(HL)
  DA7B  23            		INC	HL
  DA7C  FEFF          		CP	0FFH
  DA7E  C8            		RET	Z
  DA7F  F3            		DI
  DA80  061C          		LD	B,01CH
  DA82  ED79          		OUT	(C),A
  DA84  EDA3          		OUTI
  DA86  FB            		EI
  DA87  18F1          		JR	BEEP1
                      	
  DA89                	OT49SB:
  DA89  C5            		PUSH	BC
  DA8A  CDA5DA        		CALL	CANW
  DA8D  010019        		LD	BC,01900H
  DA90  ED79          		OUT	(C),A
  DA92  C1            		POP	BC
  DA93  C9            		RET
                      	
  DA94                	IN49SB:
  DA94  C5            		PUSH	BC
  DA95  01011A        		LD	BC,01A01H
  DA98                	CANR:
  DA98  ED78          		IN	A,(C)
  DA9A  E620          		AND	020H
  DA9C  20FA          		JR	NZ,CANR
  DA9E  010019        		LD	BC,01900H
  DAA1  ED78          		IN	A,(C)
  DAA3  C1            		POP	BC
  DAA4  C9            		RET
                      	
  DAA5                	CANW:
  DAA5  01011A        		LD	BC,01A01H
  DAA8  ED48          		IN	C,(C)
  DAAA  CB71          		BIT	6,C
  DAAC  20F7          		JR	NZ,CANW
  DAAE  C9            		RET
                      	
  DAAF                	COMOUT:
  DAAF  FB            		EI
  DAB0  CD89DA        		CALL	OT49SB
  DAB3  CDA5DA        		CALL	CANW
  DAB6  F3            		DI
  DAB7  C9            		RET
                      	
  DAB8                	CTRL12:
  DAB8  D5            		PUSH	DE
  DAB9  CDD3EC        		CALL	_POS
  DABC  3AB1EC        		LD	A,(CRTCD+1)
  DABF  95            		SUB	L
  DAC0  ED4B8EEC      		LD	BC,(_TXADR)
  DAC4  110020        		LD	DE,02000H	;D:Text E:Kanji
  DAC7  2A96EC        		LD	HL,(_COLORF)	;L:Color
  DACA  CBE8          		SET	5,B
  DACC                	C12X1:
  DACC  CDD4DA        		CALL	C12S
  DACF  03            		INC	BC
  DAD0  20FA          		JR	NZ,C12X1
  DAD2  D1            		POP	DE
  DAD3  C9            		RET
                      	
  DAD4                	C12S:
  DAD4  CBE0          		SET	4,B
  DAD6  CBD8          		SET	3,B
  DAD8  ED60          		IN	H,(C)
  DADA  ED59          	X1PAT:	OUT	(C),E
  DADC  5C            		LD	E,H
  DADD  CB98          		RES	3,B
  DADF  ED60          		IN	H,(C)
  DAE1  ED51          		OUT	(C),D
  DAE3  54            		LD	D,H
  DAE4  CBA0          		RES	4,B
  DAE6  ED60          		IN	H,(C)
  DAE8  ED69          		OUT	(C),L
  DAEA  6C            		LD	L,H
  DAEB  3D            		DEC	A
  DAEC  C9            		RET
                      	
  DAED                	CTRL0C:
  DAED  CD2DDA        		CALL	CTRL0B
  DAF0                	CTRL1A:
  DAF0  ED4B8EEC      		LD	BC,(_TXADR)
  DAF4                	C1AX1:
  DAF4  78            		LD	A,B
  DAF5  F638          		OR	038H
  DAF7  47            		LD	B,A
  DAF8  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令	kanji
  DAFA  CB98          		RES	3,B
  DAFC  3E20          		LD	A,020H
  DAFE  ED79          		OUT	(C),A		;Text
  DB00  CBA0          		RES	4,B
  DB02  3A96EC        		LD	A,(_COLORF)
  DB05  ED79          		OUT	(C),A		;Color
  DB07  03            		INC	BC
  DB08  CBA8          		RES	5,B
  DB0A  2ABAEC        		LD	HL,(CRTCD+10)
  DB0D  09            		ADD	HL,BC
  DB0E  30E4          		JR	NC,C1AX1
  DB10  C9            		RET
                      	
  DB11                	CTRL04:
  DB11  CDD3EC        		CALL	_POS
  DB14  7D            		LD	A,L
  DB15  B7            		OR	A
  DB16  C8            		RET	Z
  DB17                	CTRL03:
  DB17  CD13DA        		CALL	CTRL0D
  DB1A                	CTRL0A:
  DB1A                	CTRL1F:
  DB1A  ED4B8EEC      		LD	BC,(_TXADR)
  DB1E  2AB1EC        		LD	HL,(CRTCD+1)
  DB21  2600          		LD	H,0
  DB23  09            		ADD	HL,BC
  DB24  44            		LD	B,H
  DB25  4D            		LD	C,L
  DB26  2ABAEC        		LD	HL,(CRTCD+10)
  DB29  09            		ADD	HL,BC
  DB2A  3F            		CCF
  DB2B  9F            		SBC	A,A
  DB2C  C386D9        		JP	PRINTE8
                      	
  DB2F                	CTRL0E:
  DB2F  CDD3EC        		CALL	_POS
  DB32  7C            		LD	A,H
  DB33  1804          		JR	SCR1
  DB35                	SCR:
  DB35  3A97EC        		LD	A,(_LINE)
  DB38  3D            		DEC	A
  DB39                	SCR1:
  DB39  C5            		PUSH	BC
  DB3A  D5            		PUSH	DE
  DB3B  01801F        		LD	BC,01F80H	;DMA
  DB3E  1EC3          		LD	E,0C3H
  DB40  ED59          		OUT	(C),E
  DB42  119A65        		LD	DE,0659AH
  DB45  ED59          		OUT	(C),E
  DB47  ED51          		OUT	(C),D
  DB49  114F00        		LD	DE,79
  DB4C  ED59          		OUT	(C),E
  DB4E  ED51          		OUT	(C),D
                      	
  DB50  210038        		LD	HL,03800H
  DB53  11181C        		LD	DE,01C18H
  DB56  ED51          		OUT	(C),D
  DB58  ED59          		OUT	(C),E
                      	
  DB5A                	SCRUP1:
  DB5A  B7            		OR	A
  DB5B  2839          		JR	Z,SCRCL
  DB5D  F5            		PUSH	AF
  DB5E  CD77DB        		CALL	UPSUB		;kanji
  DB61  ED5BBCEC      		LD	DE,(CRTCD+12)
  DB65  16F7          		LD	D,0F7H
  DB67  19            		ADD	HL,DE
  DB68  D5            		PUSH	DE
  DB69  CD77DB        		CALL	UPSUB		;Text
  DB6C  D1            		POP	DE
  DB6D  19            		ADD	HL,DE
  DB6E  CD77DB        		CALL	UPSUB		;Color
  DB71  CBE4          		SET	4,H
  DB73  F1            		POP	AF
  DB74  3D            		DEC	A
  DB75  18E3          		JR	SCRUP1
                      	
  DB77                	UPSUB:
  DB77  ED5BB1EC      		LD	DE,(CRTCD+1)
  DB7B  1600          		LD	D,0
  DB7D  3ECD          		LD	A,0CDH
  DB7F  ED79          		OUT	(C),A
  DB81  ED69          		OUT	(C),L		;SOURCE
  DB83  ED61          		OUT	(C),H
  DB85  19            		ADD	HL,DE
  DB86  3E1D          		LD	A,01DH
  DB88  ED79          		OUT	(C),A		;DEST
  DB8A  ED69          		OUT	(C),L
  DB8C  ED61          		OUT	(C),H
  DB8E  1187CF        		LD	DE,0CF87H
  DB91  ED51          		OUT	(C),D
  DB93  ED59          		OUT	(C),E
  DB95  C9            		RET
                      	
  DB96                	SCRCL:
  DB96  44            		LD	B,H
  DB97  4D            		LD	C,L
  DB98  215020        		LD	HL,02000H+80
  DB9B  3A96EC        		LD	A,(_COLORF)
  DB9E                	SCRCL1:
  DB9E  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  DBA0  CB98          		RES	3,B
  DBA2  ED61          		OUT	(C),H
  DBA4  CBA0          		RES	4,B
  DBA6  ED79          		OUT	(C),A
  DBA8  CBD8          		SET	3,B
  DBAA  CBE0          		SET	4,B
  DBAC  03            		INC	BC
  DBAD  2D            		DEC	L
  DBAE  20EE          		JR	NZ,SCRCL1
  DBB0  D1            		POP	DE
  DBB1  C1            		POP	BC
  DBB2  C9            		RET
                      	
  DBB3                	SCRN:
  DBB3  D5            		PUSH	DE
  DBB4  ED58          		IN	E,(C)		;Text
  DBB6  CBD8          		SET	3,B
  DBB8  ED50          		IN	D,(C)		;Kanji
  DBBA  2819          		JR	Z,SCRNE
  DBBC  AF            		XOR	A
  DBBD  C5            		PUSH	BC
  DBBE  013730        		LD	BC,03037H	;VRMJIS
  DBC1  DF            		RST	018H
  DBC2  01522F        		LD	BC,02F52H	;JISSFT
  DBC5  DF            		RST	018H
  DBC6  C1            		POP	BC
  DBC7  ED78          		IN	A,(C)
  DBC9  CB98          		RES	3,B
  DBCB  E640          		AND	040H
  DBCD  2003          		JR	NZ,SCRN1
  DBCF  7A            		LD	A,D
  DBD0  D1            		POP	DE
  DBD1  C9            		RET
  DBD2                	SCRN1:
  DBD2  7B            		LD	A,E
  DBD3  D1            		POP	DE
  DBD4  C9            		RET
                      	
  DBD5                	SCRNE:
  DBD5  D1            		POP	DE
  DBD6  CB98          		RES	3,B
  DBD8                	SCRNX:
  DBD8  ED78          		IN	A,(C)
  DBDA  C9            		RET
                      	
  DBDB                	POS:
  DBDB  2A8EEC        		LD	HL,(_TXADR)
  DBDE  C5            		PUSH	BC
  DBDF  ED4BBCEC      		LD	BC,(CRTCD+12)
  DBE3  AF            		XOR	A
  DBE4                	POS1:
  DBE4  09            		ADD	HL,BC
  DBE5  3C            		INC	A
  DBE6  38FC          		JR	C,POS1
  DBE8  ED42          		SBC	HL,BC
  DBEA  3D            		DEC	A
  DBEB  67            		LD	H,A
  DBEC  C1            		POP	BC
  DBED  A7            		AND	A
  DBEE  C9            		RET
                      	
  DBEF                	GETL:
  DBEF  CDD3EC        		CALL	_POS
  DBF2  E5            		PUSH	HL
  DBF3                	GETL1:
  DBF3  CDD3EC        		CALL	_POS
  DBF6  C1            		POP	BC
  DBF7  C5            		PUSH	BC
  DBF8  7D            		LD	A,L
  DBF9  91            		SUB	C
  DBFA  69            		LD	L,C
  DBFB  4F            		LD	C,A
  DBFC  DCD6EC        		CALL	C,_LOC
  DBFF                	GET1W:
  DBFF  CD95D7        		CALL	_SYS08
  DC02  FE08          		CP	8
  DC04  2007          		JR	NZ,GETL1X
  DC06  0D            		DEC	C
  DC07  CB79          		BIT	7,C
  DC09  2002          		JR	NZ,GETL1X
  DC0B  3E02          		LD	A,2
  DC0D                	GETL1X:
  DC0D  FE1B          		CP	01BH
  DC0F  2016          		JR	NZ,GETL1V
  DC11  CD95D7        		CALL	_SYS08
  DC14  FE22          		CP	022H
  DC16  2008          		JR	NZ,GETL1Y
  DC18  2100FF        		LD	HL,KBUF
  DC1B  CD5DD8        		CALL	MSX
  DC1E  180E          		JR	GETL1Z
  DC20                	GETL1Y:
  DC20  F5            		PUSH	AF
  DC21  1E1B          		LD	E,01BH
  DC23  CDCDEC        		CALL	_PRINT
  DC26  F1            		POP	AF
  DC27                	GETL1V:
  DC27  5F            		LD	E,A
  DC28  CD27DA        		CALL	CTRL01
  DC2B  CDCDEC        		CALL	_PRINT
  DC2E                	GETL1Z:
  DC2E  7B            		LD	A,E
  DC2F  FE0D          		CP	00DH
  DC31  20C0          		JR	NZ,GETL1
                      	
  DC33  2100FF        		LD	HL,KBUF
  DC36  AF            		XOR	A
  DC37  ED4BB0EC      		LD	BC,(CRTCD)
  DC3B                	GETL0:
  DC3B  77            		LD	(HL),A
  DC3C  23            		INC	HL
  DC3D  10FC          		DJNZ	GETL0
                      	
  DC3F  D1            		POP	DE
  DC40  CDD3EC        		CALL	_POS
  DC43  6B            		LD	L,E
  DC44  3AB1EC        		LD	A,(CRTCD+1)
  DC47  95            		SUB	L
  DC48  57            		LD	D,A
  DC49  CD40DA        		CALL	LOC1
  DC4C  78            		LD	A,B
  DC4D  F630          		OR	030H
  DC4F  47            		LD	B,A
  DC50  5A            		LD	E,D
  DC51  2100FF        		LD	HL,KBUF
  DC54                	GETL2:
  DC54  CDD0EC        		CALL	_SCRN
  DC57  03            		INC	BC
  DC58  77            		LD	(HL),A
  DC59  23            		INC	HL
  DC5A  1D            		DEC	E
  DC5B  20F7          		JR	NZ,GETL2
  DC5D                	GETL3:
  DC5D  2B            		DEC	HL
  DC5E  7E            		LD	A,(HL)
  DC5F  FE21          		CP	021H
  DC61  D0            		RET	NC
  DC62  3600          		LD	(HL),0
  DC64  15            		DEC	D
  DC65  20F6          		JR	NZ,GETL3
  DC67  C9            		RET
                      	
  DC68                	INKEY:
  DC68  FB            		EI
  DC69  E5            		PUSH	HL
  DC6A  2A90EC        		LD	HL,(_KEYPS)
  DC6D  7C            		LD	A,H
  DC6E  AD            		XOR	L
  DC6F  2809          		JR	Z,INKEY1
  DC71  7C            		LD	A,H
  DC72  3C            		INC	A
  DC73  3291EC        		LD	(_KEYPS+1),A
  DC76  6F            		LD	L,A
  DC77  26FE          		LD	H,KEYBF/256
  DC79  7E            		LD	A,(HL)
  DC7A                	INKEY1:
  DC7A  E1            		POP	HL
  DC7B  B7            		OR	A
  DC7C  C9            		RET
                      	
  1125                	AT_RS	EQU	SCR1-AT_SCR1
                      	
                      	;LDFILE.ASM
                      	
                      	;	LSX-Dodgers FILE
                      	
  DC7D                	FILEC:
  DC7D  CD88DC        		CALL	FILE
  DC80                	FILEC2:
  DC80  3ADC00        		LD	A,(FDRV+1)
  DC83  FE20          		CP	020H
  DC85  C8            		RET	Z
  DC86  183B          		JR	SETDIR1
                      	
  DC88                	FILE:
  DC88  AF            		XOR	A
  DC89  32DB00        		LD	(FDRV),A
  DC8C  67            		LD	H,A
  DC8D  6F            		LD	L,A
  DC8E  22E900        		LD	(FDRV+14),HL
  DC91  CD62DD        		CALL	SPCUT
  DC94  CD47DD        		CALL	CCHK3
  DC97  2812          		JR	Z,DEVI1
  DC99  13            		INC	DE
  DC9A  1A            		LD	A,(DE)
  DC9B  1B            		DEC	DE
  DC9C  FE3A          		CP	':'
  DC9E  200B          		JR	NZ,DEVI1
  DCA0  1A            		LD	A,(DE)		;DRIVE
  DCA1  CDB3DF        		CALL	CAP
  DCA4  D640          		SUB	'@'
  DCA6  13            		INC	DE
  DCA7  13            		INC	DE
  DCA8  32DB00        		LD	(FDRV),A
  DCAB                	DEVI1:
  DCAB  1A            		LD	A,(DE)
  DCAC  D65C          		SUB	05CH
  DCAE  200B          		JR	NZ,NOROOT
  DCB0  210000        		LD	HL,0
  DCB3  22F500        		LD	(FDRV+26),HL
  DCB6  2C            		INC	L
  DCB7  22E900        		LD	(FDRV+14),HL
  DCBA  13            		INC	DE
  DCBB                	NOROOT:
                      	
  DCBB                	SETDIR:
  DCBB  CDE7DC        		CALL	FILED
  DCBE  1A            		LD	A,(DE)
  DCBF  FE5C          		CP	05CH
  DCC1  C0            		RET	NZ
  DCC2  13            		INC	DE
  DCC3                	SETDIR1:
  DCC3  3E10          		LD	A,010H		;Directory
  DCC5  32E800        		LD	(FDRV+13),A
  DCC8  D5            		PUSH	DE
  DCC9  11DB00        		LD	DE,FDRV
  DCCC  2A1EEC        		LD	HL,(STABLE+2*00FH)
  DCCF  CD0F00        		CALL	JP_HL
  DCD2  D1            		POP	DE
  DCD3  B7            		OR	A
  DCD4  C0            		RET	NZ
                      	
  DCD5  3AE800        		LD	A,(FDRV+13)
  DCD8  CB67          		BIT	4,A
  DCDA  C8            		RET	Z
                      	
  DCDB  CD2EDD        		CALL	FILEI
  DCDE  2AF500        		LD	HL,(FDRV+26)
  DCE1  23            		INC	HL
  DCE2  22E900        		LD	(FDRV+14),HL
  DCE5  18D4          		JR	SETDIR
                      	
  DCE7                	FILED:
  DCE7  CD2EDD        		CALL	FILEI
                      	
  DCEA  0608          		LD	B,8
  DCEC                	FILE2:
  DCEC  CD3CDD        		CALL	CCHKF
  DCEF  C8            		RET	Z
  DCF0  FE2A          		CP	'*'
  DCF2  282E          		JR	Z,FILE9
  DCF4  FE2E          		CP	'.'
  DCF6  280C          		JR	Z,FILE4
  DCF8  77            		LD	(HL),A
  DCF9  23            		INC	HL
  DCFA  10F0          		DJNZ	FILE2
                      	
  DCFC                	FILE3:
  DCFC  CD3CDD        		CALL	CCHKF
  DCFF  C8            		RET	Z
  DD00  FE2E          		CP	'.'
  DD02  20F8          		JR	NZ,FILE3
                      	
  DD04                	FILE4:
  DD04  21E400        		LD	HL,FNAME+8
  DD07  0603          		LD	B,3
                      	
  DD09                	FILE4L:
  DD09  CD3CDD        		CALL	CCHKF
  DD0C  C8            		RET	Z
  DD0D  FE2E          		CP	'.'
  DD0F  2008          		JR	NZ,FILE12
  DD11  32DC00        		LD	(FNAME),A	;Parent directory(..)
  DD14  32DD00        		LD	(FNAME+1),A
  DD17  3E20          		LD	A,020H
  DD19                	FILE12:
  DD19  FE2A          		CP	'*'
  DD1B  280A          		JR	Z,FILE10
  DD1D  77            		LD	(HL),A
  DD1E  23            		INC	HL
  DD1F  10E8          		DJNZ	FILE4L
  DD21  C9            		RET
                      	
  DD22                	FILE9:
  DD22  CD27DD        		CALL	FILE10
  DD25  18D5          		JR	FILE3
                      	
  DD27                	FILE10:
  DD27  3E3F          		LD	A,'?'
                      	
  DD29                	FILE7:
  DD29  77            		LD	(HL),A
  DD2A  23            		INC	HL
  DD2B  10FC          		DJNZ	FILE7
  DD2D  C9            		RET
                      	
  DD2E                	FILEI:
  DD2E  3E20          		LD	A,020H
  DD30  01000B        		LD	BC,11*256
  DD33  21DC00        		LD	HL,FNAME
  DD36  E5            		PUSH	HL
  DD37  CD29DD        		CALL	FILE7
  DD3A  E1            		POP	HL
  DD3B  C9            		RET
                      	
  DD3C                	CCHKF:
  DD3C  1A            		LD	A,(DE)
  DD3D  CD44DD        		CALL	CCHK2
  DD40  C8            		RET	Z
  DD41  C3D5E0        		JP	FKAN
                      	
  DD44                	CCHK2:
  DD44  0C            		INC	C
  DD45  0D            		DEC	C
  DD46  C0            		RET	NZ
  DD47                	CCHK3:
  DD47  FE2B          		CP	'+'
  DD49  C8            		RET	Z
  DD4A  FE2C          		CP	','
  DD4C  C8            		RET	Z
  DD4D  FE2F          		CP	'/'
  DD4F  C8            		RET	Z
  DD50  FE3A          		CP	':'
  DD52  C8            		RET	Z
  DD53  FE3B          		CP	';'
  DD55  C8            		RET	Z
  DD56  FE3D          		CP	'='
  DD58  C8            		RET	Z
  DD59  FE5C          		CP	05CH
  DD5B  C8            		RET	Z
  DD5C  FE20          		CP	020H
  DD5E  D0            		RET	NC
  DD5F  BF            		CP	A		;Z=1
  DD60  C9            		RET
                      	
  DD61                	SS1:
  DD61  13            		INC	DE
  DD62                	SPCUT:
  DD62  1A            		LD	A,(DE)
  DD63  FE20          		CP	020H
  DD65  28FA          		JR	Z,SS1
  DD67  C9            		RET
                      	
  DD68                	SETDRVF:
  DD68  11DB00        		LD	DE,FDRV
  DD6B                	SETDRV0:
  DD6B  CD74DD        		CALL	SETDRV
  DD6E  FDE1          		POP	IY
  DD70  C1            		POP	BC
  DD71  D1            		POP	DE
  DD72  E1            		POP	HL
  DD73  C9            		RET
                      	
  DD74                	SETDRV:
  DD74  E3            		EX	(SP),HL		;HL=RETRN ADDRESS
  DD75  D5            		PUSH	DE		;PUSH HL/DE/BC/IY
  DD76  C5            		PUSH	BC
  DD77  1A            		LD	A,(DE)
  DD78  D5            		PUSH	DE
  DD79  FDE3          		EX	(SP),IY
                      	
  DD7B  CD87DD        		CALL	GETDRV
  DD7E  3C            		INC	A
  DD7F  FD7700        		LD	(IY+0),A	;(FCB)ドライブ番号
  DD82  3D            		DEC	A
  DD83  CDD9EC        		CALL	_CHGDRV
                      	
  DD86  E9            		JP	(HL)
                      	
  DD87                	GETDRV:
  DD87  E67F          		AND	07FH
  DD89  D601          		SUB	001H
  DD8B  3003          		JR	NC,GETDRV1
  DD8D  3A87EC        		LD	A,(_DVSW)	;Current Drive
  DD90                	GETDRV1:
  DD90  3288EC        		LD	(_DRV),A
  DD93  C9            		RET
                      	
  DD94                	SOPENX:
  DD94  CD23DF        		CALL	CHKDDX
  DD97  3802          		JR	C,SOPENX1
  DD99  C1            		POP	BC
  DD9A  E9            		JP	(HL)
  DD9B                	SOPENX1:
  DD9B  1181E2        		LD	DE,SFILE
  DD9E  1A            		LD	A,(DE)
  DD9F  FDBE00        		CP	(IY+0)		;(FCB)ドライブ番号
  DDA2  202A          		JR	NZ,SOPEN
  DDA4  13            		INC	DE
  DDA5  FDE5          		PUSH	IY
  DDA7  E1            		POP	HL
  DDA8  23            		INC	HL
  DDA9  CD53DF        		CALL	CPFILE
  DDAC  2020          		JR	NZ,SOPEN
                      	
  DDAE  2AF4EB        		LD	HL,(SCDIR)
  DDB1  FD750E        		LD	(IY+14),L	;(FCB)アクセスするディレクトリのクラスタ番号+1
  DDB4  FD740F        		LD	(IY+15),H
  DDB7  3AE5E6        		LD	A,(_SECPS+1)
  DDBA  FD770C        		LD	(IY+12),A	;(FCB)アクセスするディレクトリのセクタインデックス
                      	
  DDBD  2AF8EB        		LD	HL,(SFNDF)	;Direcroty location and Flags
  DDC0  229FEC        		LD	(_FILEN),HL
                      	
  DDC3  ED5BF6EB      		LD	DE,(SFBPS)
  DDC7  2181E2        		LD	HL,SFILE
  DDCA  36FF          		LD	(HL),0FFH
  DDCC  23            		INC	HL
  DDCD  C9            		RET
  DDCE                	SOPEN:
  DDCE  21EBDE        		LD	HL,FILESE
  DDD1                	SOPENC:
  DDD1  220DDE        		LD	(OPENPAT+1),HL
                      	
  DDD4  CDE2EC        		CALL	_RDFATX		;Detect Media
  DDD7  385F          		JR	C,RDDERR
                      	
  DDD9  AF            		XOR	A
  DDDA  329FEC        		LD	(_FILEN),A
  DDDD  CDF9DF        		CALL	LDDIRX1		;A=0で呼び出す
  DDE0  281B          		JR	Z,SDIRX1
                      	
  DDE2  CDDCDE        		CALL	READ_DIR	;Sub Directory
  DDE5  3808          		JR	C,SDIRX0
  DDE7  2A7EEC        		LD	HL,(_DTBUF)
  DDEA  7E            		LD	A,(HL)
  DDEB  FE2E          		CP	'.'
  DDED  2812          		JR	Z,SOPEN1
  DDEF                	SDIRX0:
  DDEF  AF            		XOR	A
  DDF0  32A0EC        		LD	(_DIRF),A
  DDF3  FD770C        		LD	(IY+12),A	;(FCB)カレント・ブロック
  DDF6  FD360E01      		LD	(IY+14),1	;(FCB)レコード・サイズ
  DDFA  FD770F        		LD	(IY+15),A
  DDFD                	SDIRX1:
  DDFD  ED5BFCEB      		LD	DE,(_DIRPS)	;Root Directory
  DE01                	SOPEN1:
  DE01  0E20          	SDECPAT:LD	C,32		;自己書き換え 1セクタ辺りのディレクトリエントリ数  1024=32 / 512=16
  DE03                	SOPEN1X:
  DE03  CDDCDE        		CALL	READ_DIR	;FILE SEARCH
  DE06  3830          		JR	C,RDDERR
  DE08  2A7EEC        		LD	HL,(_DTBUF)
  DE0B                	SOPEN2:
  DE0B  D5            		PUSH	DE
  DE0C  CDEBDE        	OPENPAT:CALL	FILESE		;(Self-rewriting)
  DE0F  D1            		POP	DE
  DE10  386E          		JR	C,SOPENE
  DE12  2821          		JR	Z,NOTSE
  DE14                	SOPEN3:
  DE14  3AA0EC        		LD	A,(_DIRF)	;bit7:ディレクトリか判別
  DE17  87            		ADD	A,A
  DE18  380C          		JR	C,SOPEN5
  DE1A  13            		INC	DE		;ルートディレクトリ
  DE1B  E5            		PUSH	HL
  DE1C  210C00        	MD_PAT:	LD	HL,12		;(Self-rewriting)MAXDIR
  DE1F  ED52          		SBC	HL,DE		;CF=0 なので SUB HL,DE
  DE21  E1            		POP	HL
  DE22  20DD          		JR	NZ,SOPEN1
  DE24  180D          		JR	SOPEN6
  DE26                	SOPEN5:
  DE26  CDEDE6        		CALL	GNCLX		;END DIR
  DE29  D8            		RET	C
  DE2A  CDABDF        		CALL	ENDCL
  DE2D  3AE5E6        		LD	A,(_SECPS+1)
  DE30  FD770C        		LD	(IY+12),A	;(FCB)アクセスするディレクトリのセクタインデックス
  DE33                	SOPEN6:
  DE33  38CC          		JR	C,SOPEN1
  DE35                	NOTSE:
  DE35  37            		SCF			;CF=1
  DE36  9F            		SBC	A,A		;A=0FFH
  DE37  C9            		RET
                      	
  DE38                	RDDERR:
  DE38  BF            		CP	A		;READ ERR CF=1 ZF=1
  DE39  37            		SCF
  DE3A  C9            		RET
                      	
  DE3B                	NOPEN:
  DE3B  21EBDE        		LD	HL,FILESE
  DE3E  220DDE        		LD	(OPENPAT+1),HL
  DE41  FD2A98EC      		LD	IY,(_FCB)
  DE45  CDE8E0        		CALL	CHKWILDX
  DE48  30EB          		JR	NC,NOTSE
  DE4A  FD7E00        		LD	A,(IY+0)	;(FCB)ドライブ番号
  DE4D  3D            		DEC	A
  DE4E  3288EC        		LD	(_DRV),A
  DE51  CDD9EC        		CALL	_CHGDRV
  DE54  D8            		RET	C
                      	
  DE55  CDF6DF        		CALL	LDDIRX
  DE58  ED5B9AEC      		LD	DE,(_FBPS)
  DE5C  CDDCDE        		CALL	READ_DIR
  DE5F  38D7          		JR	C,RDDERR
  DE61  3A9EEC        		LD	A,(_FBCNT)
  DE64  3D            		DEC	A
  DE65  28AD          		JR	Z,SOPEN3
  DE67                	NOPEN2:
  DE67  2A9CEC        		LD	HL,(_FBAD)
  DE6A  012000        		LD	BC,020H
  DE6D  09            		ADD	HL,BC
  DE6E  4F            		LD	C,A
  DE6F  189A          		JR	SOPEN2
                      	
  DE71                	SOPENE2:
  DE71  229CEC        		LD	(_FBAD),HL
  DE74  79            		LD	A,C
  DE75  329EEC        		LD	(_FBCNT),A
  DE78  ED539AEC      		LD	(_FBPS),DE
  DE7C  FD2298EC      		LD	(_FCB),IY
  DE80                	SOPENE:
  DE80  AF            		XOR	A
  DE81  C9            		RET
                      	
  DE82                	COPEN:
  DE82  FD360D20      		LD	(IY+13),020H	;(FCB)属性(アトリビュート)
                      	
  DE86  2108DF        		LD	HL,NEXTSE
  DE89  CDD1DD        		CALL	SOPENC
  DE8C  D0            		RET	NC
  DE8D  C8            		RET	Z
  DE8E  3AA0EC        		LD	A,(_DIRF)	;bit7:ディレクトリか判別
  DE91  87            		ADD	A,A
  DE92  3F            		CCF
  DE93  D8            		RET	C		;ルートディレクトリ
  DE94  0601          		LD	B,1
  DE96  CD44E1        		CALL	WRDF
  DE99  D8            		RET	C
  DE9A  ED5BFEEB      		LD	DE,(_CLPS)
  DE9E  D5            		PUSH	DE
  DE9F  CD7CDF        		CALL	DCPAT
  DEA2  CD84E5        		CALL	DRDNX
  DEA5  2A7EEC        		LD	HL,(_DTBUF)	;ディレクトリエントリを0クリア
  DEA8  5D            		LD	E,L
  DEA9  54            		LD	D,H
  DEAA  13            		INC	DE		;DE,DTBUF+1
  DEAB  01FF03        	SECSZM1:LD	BC,003FFH	;自己書き換え セクタサイズ-1(0x3FF:1023 or 0x1FF:511 or 0xFF:255)
  DEAE  AF            		XOR	A		;データバッファをセクタサイズ分ゼロクリア
  DEAF  77            		LD	(HL),A
  DEB0  EDB0          		LDIR
                      	
  DEB2  3AA0EC        		LD	A,(_DIRF)
  DEB5  87            		ADD	A,A
  DEB6  301F          		JR	NC,COPENE	;ルートディレクトリ
                      	
  DEB8  D1            		POP	DE		;DE=(_CLPS)
  DEB9  D5            		PUSH	DE
  DEBA  3A92DF        		LD	A,(SPCPAT+1)	;1クラスタの論理セクタ数
  DEBD  3D            		DEC	A
  DEBE  2817          		JR	Z,COPENE
  DEC0  3E01          		LD	A,1		;1セクタ辺りのセクタ数が2以上の場合
  DEC2  32E5E6        		LD	(_SECPS+1),A
  DEC5                	COPEN1:
  DEC5  D5            		PUSH	DE		;データバッファに入らないセクタもゼロクリア
  DEC6  C5            		PUSH	BC
  DEC7  2A7EEC        		LD	HL,(_DTBUF)
  DECA  CD8EDF        		CALL	CLUSTX
  DECD  CD51E8        		CALL	DWT24
  DED0  C1            		POP	BC
  DED1  D1            		POP	DE
  DED2  CDE4E6        		CALL	NEXTX
  DED5  20EE          		JR	NZ,COPEN1
  DED7                	COPENE:
  DED7  2A7EEC        		LD	HL,(_DTBUF)
  DEDA  D1            		POP	DE
  DEDB  C9            		RET
                      	
  DEDC                	READ_DIR:
  DEDC  ED53FEEB      		LD	(_CLPS),DE
  DEE0  C5            		PUSH	BC
  DEE1  D5            		PUSH	DE
  DEE2  CD7CDF        		CALL	DCPAT
  DEE5  CD64E5        		CALL	DRDX
  DEE8  D1            		POP	DE
  DEE9  C1            		POP	BC
  DEEA  C9            		RET
                      	
  DEEB                	FILESE:
  DEEB  7E            		LD	A,(HL)
  DEEC  B7            		OR	A
  DEED  C8            		RET	Z		;END:ZF=1 CF=0
  DEEE  FEE5          		CP	0E5H
  DEF0  280E          		JR	Z,FILESE1
  DEF2  FDE5          		PUSH	IY
  DEF4  D1            		POP	DE
  DEF5  13            		INC	DE
  DEF6  E5            		PUSH	HL
  DEF7  CD53DF        		CALL	CPFILE
  DEFA  CC74DF        		CALL	Z,CPFILE2
  DEFD  E1            		POP	HL
  DEFE  37            		SCF
  DEFF  C8            		RET	Z		;!!!:(ZF=1) CF=1
  DF00                	FILESE1:
  DF00  CD17DF        		CALL	FNEXT
  DF03  20E6          		JR	NZ,FILESE
  DF05                	ZF0_CF0_AFF_RET:
  DF05  F6FF          		OR	0FFH		;ZF=0 CF=0
  DF07  C9            		RET
                      	
  DF08                	NEXTSE:
  DF08  7E            		LD	A,(HL)
  DF09  B7            		OR	A
  DF0A  37            		SCF
  DF0B  C8            		RET	Z		;!!!:ZF=1 CF=1
  DF0C  FEE5          		CP	0E5H
  DF0E  37            		SCF
  DF0F  C8            		RET	Z		;!!!:(ZF=1) CF=1
  DF10  CD17DF        		CALL	FNEXT
  DF13  20F3          		JR	NZ,NEXTSE
  DF15  18EE          		JR	ZF0_CF0_AFF_RET
                      	
  DF17                	FNEXT:
  DF17  E5            		PUSH	HL
  DF18  219FEC        		LD	HL,_FILEN
  DF1B  34            		INC	(HL)
  DF1C  E1            		POP	HL
  DF1D  112000        		LD	DE,020H
  DF20  19            		ADD	HL,DE
  DF21  0D            		DEC	C
  DF22  C9            		RET
                      	
  DF23                	CHKDDX:
  DF23  CDE8E0        		CALL	CHKWILDX
  DF26  D8            		RET	C
  DF27  FDE5          		PUSH	IY
  DF29  D1            		POP	DE
  DF2A  13            		INC	DE
  DF2B  2162EC        		LD	HL,DDTB
  DF2E  0604          		LD	B,DDS
  DF30                	CPNAME:
  DF30  C5            		PUSH	BC
  DF31  D5            		PUSH	DE
  DF32  1159E5        		LD	DE,CPBUF
  DF35  010400        		LD	BC,4
  DF38  EDB0          		LDIR
  DF3A  D1            		POP	DE
  DF3B  D5            		PUSH	DE
  DF3C  E5            		PUSH	HL
  DF3D  2159E5        		LD	HL,CPBUF
  DF40  CD53DF        		CALL	CPFILE
  DF43  E1            		POP	HL
  DF44  D1            		POP	DE
  DF45  C1            		POP	BC
  DF46  2005          		JR	NZ,CPNAME1
  DF48  7E            		LD	A,(HL)
  DF49  23            		INC	HL
  DF4A  66            		LD	H,(HL)
  DF4B  6F            		LD	L,A
  DF4C  C9            		RET
  DF4D                	CPNAME1:
  DF4D  23            		INC	HL
  DF4E  23            		INC	HL
  DF4F  10DF          		DJNZ	CPNAME
  DF51  37            		SCF
  DF52  C9            		RET
                      	
  DF53                	CPFILE:
  DF53  C5            		PUSH	BC
  DF54  01000B        		LD	BC,00B00H
  DF57                	CPSTR1:
  DF57  1A            		LD	A,(DE)
  DF58  FE3F          		CP	'?'		;Wild card
  DF5A  2812          		JR	Z,CPSTR2
  DF5C  7E            		LD	A,(HL)
  DF5D  CDCEE0        		CALL	FKANC
  DF60  E5            		PUSH	HL
  DF61  67            		LD	H,A
  DF62  1A            		LD	A,(DE)
  DF63  CB01          		RLC	C
  DF65  CDCEE0        		CALL	FKANC
  DF68  CB09          		RRC	C
  DF6A  BC            		CP	H		;CP (HL),(DE)
  DF6B  E1            		POP	HL
  DF6C  2004          		JR	NZ,CPSTR3
  DF6E                	CPSTR2:
  DF6E  13            		INC	DE
  DF6F  23            		INC	HL
  DF70  10E5          		DJNZ	CPSTR1
  DF72                	CPSTR3:
  DF72  C1            		POP	BC
  DF73  C9            		RET
                      	
  DF74                	CPFILE2:
  DF74  FD7E0D        		LD	A,(IY+13)	;(FCB)属性(アトリビュート)
  DF77  F6E1          		OR	0E1H
  DF79  2F            		CPL
  DF7A  A6            		AND	(HL)
  DF7B  C9            		RET
                      	
  DF7C                	DCPAT:
  DF7C  0E00          		LD	C,0
  DF7E  2A7EEC        		LD	HL,(_DTBUF)
  DF81  3AA0EC        		LD	A,(_DIRF)	;bit7:ディレクトリか判別
  DF84  87            		ADD	A,A
  DF85  D0            		RET	NC		;ルートディレクトリの場合はCレジスタを0にしておく(CDEがセクタ番号)
  DF86  3AE5E6        		LD	A,(_SECPS+1)
  DF89  F680          		OR	080H
  DF8B  32A0EC        		LD	(_DIRF),A	;bit0-6:セクタインデックス
  DF8E                	CLUSTX:
  DF8E  E5            		PUSH	HL
  DF8F  EB            		EX	DE,HL
  DF90  AF            		XOR	A
  DF91  0E01          	SPCPAT:	LD	C,1		;自己書き換え（1クラスタの論理セクタ数）
  DF93                	L_CLDBL:
  DF93  CB19          		RR	C		;->CF
  DF95  3804          		JR	C,E_CLDBL
  DF97  29            		ADD	HL,HL		;*2
  DF98  8F            		ADC	A,A
  DF99  18F8          		JR	L_CLDBL
  DF9B                	E_CLDBL
  DF9B  4F            		LD	C,A
  DF9C  3AE5E6        		LD	A,(_SECPS+1)
  DF9F  B5            		OR	L
  DFA0  6F            		LD	L,A
  DFA1  110800        	CLSPAT:	LD	DE,8	;+8 (2D)  !ADDCL (Self-rewriting)
  DFA4  AF            		XOR	A
  DFA5  19            		ADD	HL,DE	;データ格納領域の先頭論理セクタ番号
  DFA6  89            		ADC	A,C
  DFA7  4F            		LD	C,A
  DFA8  EB            		EX	DE,HL
  DFA9  E1            		POP	HL
  DFAA  C9            		RET
                      	
  DFAB                	ENDCL:
  DFAB  7A            		LD	A,D	;END CLUSTER
  DFAC  FE01          	CLPAT1:	CP	1	;164=356	(Self-rewriting)
  DFAE  C0            		RET	NZ
  DFAF  7B            		LD	A,E
  DFB0  FE64          	CLPAT2:	CP	064H	;		(Self-rewriting)
  DFB2  C9            		RET
                      	
  DFB3                	CAP:
  DFB3  FE61          		CP	'a'
  DFB5  D8            		RET	C
  DFB6  FE7B          		CP	'z'+1
  DFB8  D0            		RET	NC
  DFB9  D620          		SUB	020H
  DFBB  C9            		RET
  DFBC                	CAP2:
  DFBC  CDB3DF        		CALL	CAP
  DFBF                	CAP3:
  DFBF  CDC8DF        		CALL	CAP4
  DFC2  FE21          		CP	021H
  DFC4  D0            		RET	NC
  DFC5  3EA0          		LD	A,0A0H
  DFC7  C9            		RET
  DFC8                	CAP4:
  DFC8  FE05          		CP	5
  DFCA  C0            		RET	NZ
  DFCB  3EE5          		LD	A,0E5H
  DFCD  C9            		RET
                      	
  DFCE                	CHDIR:
  DFCE  CDA5E9        		CALL	GETDPBD
  DFD1  3806          		JR	C,CHDIR2
  DFD3  DD751A        		LD	(IX+01AH),L		;_SDIR_
  DFD6  DD741B        		LD	(IX+01BH),H		;_SDIR_+1
  DFD9                	CHDIR2:
  DFD9  DDE1          		POP	IX
  DFDB  C9            		RET
                      	
  DFDC                	LDDIR:
  DFDC  CDA5E9        		CALL	GETDPBD
  DFDF  DD5E1A        		LD	E,(IX+01AH)		;_SDIR_
  DFE2  DD561B        		LD	D,(IX+01BH)		;_SDIR_+1
  DFE5  13            		INC	DE
  DFE6  FD730E        		LD	(IY+14),E	;(FCB)アクセスするディレクトリのクラスタ番号+1
  DFE9  FD720F        		LD	(IY+15),D
  DFEC  1B            		DEC	DE
  DFED  AF            		XOR	A
  DFEE  FD770C        		LD	(IY+12),A	;(FCB)アクセスするディレクトリのセクタインデックス
  DFF1  32E5E6        		LD	(_SECPS+1),A
  DFF4  18E3          		JR	CHDIR2		;POP_IX_RET
                      	
  DFF6                	LDDIRX:
  DFF6  FD7E0C        		LD	A,(IY+12)	;(FCB)アクセスするディレクトリのセクタインデックス
  DFF9                	LDDIRX1:
  DFF9  32E5E6        		LD	(_SECPS+1),A
  DFFC  FD5E0E        		LD	E,(IY+14)	;(FCB)アクセスするディレクトリのクラスタ番号+1
  DFFF  FD560F        		LD	D,(IY+15)
  E002  1B            		DEC	DE
  E003  CDABDF        		CALL	ENDCL
  E006  D4DCDF        		CALL	NC,LDDIR
  E009                	LDDIRS:
  E009  7A            		LD	A,D
  E00A  B3            		OR	E
  E00B  C6FF          		ADD	A,0FFH
  E00D  9F            		SBC	A,A
  E00E  32A0EC        		LD	(_DIRF),A	;bit7:ディレクトリか判別
  E011  C9            		RET
                      	
  E012                	KILL:
  E012  CDE8E0        		CALL	CHKWILDX
  E015  383A          		JR	C,KILLW
  E017  CD23DF        		CALL	CHKDDX
  E01A  3F            		CCF
  E01B  D49BDD        		CALL	NC,SOPENX1
  E01E                	KILLS:
  E01E  3E1F          		LD	A,01FH
  E020  D464E0        		CALL	NC,CHKATT
  E023  D8            		RET	C
  E024                	KILLSX:
  E024  36E5          		LD	(HL),0E5H	;DIR
  E026  CDC2E0        		CALL	WTDB
  E029  111A00        		LD	DE,01AH
  E02C  19            		ADD	HL,DE
  E02D  5E            		LD	E,(HL)
  E02E  23            		INC	HL
  E02F  56            		LD	D,(HL)
  E030  1804          		JR	KILLS2
  E032                	KILLS1:
  E032  ED5BFEEB      		LD	DE,(_CLPS)	;FAT
  E036                	KILLS2:
  E036  CDABDF        		CALL	ENDCL
  E039  D0            		RET	NC		;CF=0
  E03A  21FEFF        		LD	HL,0-2
  E03D  19            		ADD	HL,DE
  E03E  D0            		RET	NC		;DE= 0 or 1
  E03F  D5            		PUSH	DE
  E040  CDF7EC        		CALL	_GNCL
  E043  ED53FEEB      		LD	(_CLPS),DE
  E047  D1            		POP	DE
  E048  210000        		LD	HL,0
  E04B  D4FAEC        		CALL	NC,_SNCL
  E04E  30E2          		JR	NC,KILLS1
  E050  C9            		RET
                      	
  E051                	KILLW:
  E051  CDCEDD        		CALL	SOPEN
  E054                	KILLW1:
  E054  380B          		JR	C,KILLW2
  E056  CD71DE        		CALL	SOPENE2
  E059  CD1EE0        		CALL	KILLS
  E05C  CD3BDE        		CALL	NOPEN
  E05F  18F3          		JR	KILLW1
  E061                	KILLW2:
  E061  C8            		RET	Z
  E062  3F            		CCF
  E063  C9            		RET
                      	
  E064                	CHKATT:
  E064  E5            		PUSH	HL
  E065  110B00        		LD	DE,00BH
  E068  19            		ADD	HL,DE
  E069  A6            		AND	(HL)
  E06A  E1            		POP	HL
  E06B  C8            		RET	Z
  E06C  37            		SCF
  E06D  C9            		RET
                      	
  E06E                	NAME:
  E06E  CDE8E0        		CALL	CHKWILDX
  E071  D8            		RET	C
  E072  110400        		LD	DE,4
  E075  19            		ADD	HL,DE
  E076  228EE0        		LD	(NAMEP+2),HL
  E079  23            		INC	HL
  E07A  CDECE0        		CALL	CHKWILD
  E07D  D8            		RET	C
                      	
  E07E  CD9BDD        		CALL	SOPENX1
  E081  3E0F          		LD	A,00FH
  E083  D464E0        		CALL	NC,CHKATT
  E086  D8            		RET	C
                      	
  E087  FD7E00        		LD	A,(IY+0)
  E08A  FDE5          		PUSH	IY
  E08C  FD210000      	NAMEP:	LD	IY,0
  E090  FD7700        		LD	(IY+0),A
  E093  CD9BDD        		CALL	SOPENX1
  E096  FDE3          		EX	(SP),IY
  E098  3F            		CCF
  E099  D4CEDD        		CALL	NC,SOPEN
  E09C  EB            		EX	DE,HL
  E09D  E1            		POP	HL
  E09E  D8            		RET	C
                      	
  E09F                	SETNAME:
  E09F  01000B        		LD	BC,11*256
  E0A2  23            		INC	HL
  E0A3  7E            		LD	A,(HL)
  E0A4  FEE5          		CP	0E5H
  E0A6  2004          		JR	NZ,SNAME1
  E0A8  3E05          		LD	A,5
  E0AA  180E          		JR	SNAME3
  E0AC                	SNAME1:
  E0AC  7E            		LD	A,(HL)
  E0AD  0C            		INC	C
  E0AE  0D            		DEC	C
  E0AF  2009          		JR	NZ,SNAME3
  E0B1  CDB3DF        		CALL	CAP
  E0B4  FEA0          		CP	0A0H
  E0B6  2002          		JR	NZ,SNAME3
  E0B8  3E20          		LD	A,020H
  E0BA                	SNAME3:
  E0BA  12            		LD	(DE),A
  E0BB  7E            		LD	A,(HL)
  E0BC  23            		INC	HL
  E0BD  CDD5E0        		CALL	FKAN
  E0C0  10EA          		DJNZ	SNAME1
  E0C2                	WTDB:
  E0C2  3EFF          		LD	A,0FFH
  E0C4  3281E2        		LD	(SFILE),A
  E0C7                	SWTDBF:
  E0C7  3E01          		LD	A,1
  E0C9  32A4EC        		LD	(_WTDBF),A
  E0CC  AF            		XOR	A
  E0CD  C9            		RET
                      	
  E0CE                	FKANC:
  E0CE  CB41          		BIT	0,C
  E0D0  CCBCDF        		CALL	Z,CAP2
  E0D3  1801          		JR	FKANX
  E0D5                	FKAN:
  E0D5  13            		INC	DE
  E0D6                	FKANX:
  E0D6  CB41          		BIT	0,C
  E0D8  CB81          		RES	0,C
  E0DA  C0            		RET	NZ
  E0DB  FE80          		CP	080H
  E0DD  D8            		RET	C
  E0DE  FEA0          		CP	0A0H
  E0E0  3803          		JR	C,FKAN1
  E0E2  FEE0          		CP	0E0H
  E0E4  D8            		RET	C
  E0E5                	FKAN1:
  E0E5  0C            		INC	C
  E0E6  A7            		AND	A
  E0E7  C9            		RET
                      	
  E0E8                	CHKWILDX:
  E0E8  FDE5          		PUSH	IY
  E0EA  E1            		POP	HL
  E0EB  23            		INC	HL
  E0EC                	CHKWILD:
  E0EC  060B          		LD	B,11
  E0EE  3E3F          		LD	A,'?'
  E0F0                	CHKWIL1:
  E0F0  BE            		CP	(HL)
  E0F1  23            		INC	HL
  E0F2  37            		SCF
  E0F3  C8            		RET	Z
  E0F4  10FA          		DJNZ	CHKWIL1
  E0F6  AF            		XOR	A
  E0F7  C9            		RET
                      	
  E0F8                	SDIRENT:		;IY=FCB HL=DIR
  E0F8  D5            		PUSH	DE
  E0F9  E5            		PUSH	HL
  E0FA  FDE5          		PUSH	IY
  E0FC  D1            		POP	DE
  E0FD  EB            		EX	DE,HL
  E0FE  CD9FE0        		CALL	SETNAME
                      	;				Attribute
  E101  FD7E0D        		LD	A,(IY+13)	;(FCB)属性(アトリビュート)
  E104  12            		LD	(DE),A
  E105  13            		INC	DE
                      	;				Reserved
  E106  AF            		XOR	A
  E107  060A          		LD	B,10
  E109                	SDE1:
  E109  12            		LD	(DE),A
  E10A  13            		INC	DE
  E10B  10FC          		DJNZ	SDE1
                      						;(FCB)ファイルを最後に変更した時刻
  E10D  21EAEB        		LD	HL,SDDATA		;(FCB)ファイルを最後に変更した日付
  E110  060A          		LD	B,SDDATAE-SDDATA	;(FCB)ファイルの先頭クラスタ
  E112                	SDLOOP:					;(FCB)ファイルのサイズ(バイト単位)
  E112  7E            		LD	A,(HL)
  E113  23            		INC	HL
  E114  3219E1        		LD	(SDPAT+2),A
  E117  FD7E00        	SDPAT:	LD	A,(IY+0)	;LD A,(IY+A)
  E11A  12            		LD	(DE),A
  E11B  13            		INC	DE
  E11C  10F4          		DJNZ	SDLOOP
                      	
  E11E  AF            		XOR	A
  E11F  E1            		POP	HL
  E120  D1            		POP	DE
  E121  C9            		RET
                      	
  E122                	WOPEN:
  E122  FD7E0D        		LD	A,(IY+13)	;(FCB)属性(アトリビュート)
  E125  E61F          		AND	01FH
  E127  37            		SCF
  E128  C0            		RET	NZ
  E129  FD361CFE      		LD	(IY+28),0FEH	;(FCB)オープン・モード
  E12D                	TOPEN2:
  E12D  AF            		XOR	A
  E12E                	TOPEN:				;Initializes the time stamp
  E12E  FD3617FF      		LD	(IY+23),0FFH	;(FCB)ファイルを最後に変更した時刻
  E132  C9            		RET
                      	
  E133                	WRDFX:
  E133  3A92DF        		LD	A,(SPCPAT+1)	;1クラスタの論理セクタ
  E136                	L_WRFX:
  E136  1F            		RRA		;->CF
  E137  3804          		JR	C,E_WRFX
  E139  CB39          		SRL	C	;C=C/2
  E13B  18F9          		JR	L_WRFX
  E13D                	E_WRFX:
  E13D  41            		LD	B,C
  E13E  04            		INC	B
  E13F  3E37          		LD	A,037H		;SCF
  E141  3281E5        		LD	(DRDN1),A
                      	
  E144                	WRDF:				;Bクラスタ分FATを確保する
  E144  110200        		LD	DE,2
  E147  AF            		XOR	A
  E148  32E5E6        		LD	(_SECPS+1),A
  E14B                	WRDF1:
  E14B  C5            		PUSH	BC
  E14C  D5            		PUSH	DE
  E14D  CDF7EC        		CALL	_GNCL
  E150  381C          		JR	C,WRDF3
  E152  7A            		LD	A,D		;空いているかチェック
  E153  B3            		OR	E
  E154  2027          		JR	NZ,WRDF4
  E156  E1            		POP	HL		;HL=空いているクラスタ
  E157  E5            		PUSH	HL
  E158  ED5BFEEB      		LD	DE,(_CLPS)	;DE=元の(_CLPS)
  E15C  22FEEB        		LD	(_CLPS),HL
  E15F  7A            		LD	A,D		;元の(_CLPS)が 0 か?
  E160  B3            		OR	E
  E161  2008          		JR	NZ,WRDF2
  E163  FD751A        		LD	(IY+26),L	;(FCB)ファイルの先頭クラスタ
  E166  FD741B        		LD	(IY+27),H	;元が空の場合はFCBにクラスタをセットする
  E169  1803          		JR	WRDF3
  E16B                	WRDF2:
  E16B  CDFAEC        		CALL	_SNCL
  E16E                	WRDF3:
  E16E  D1            		POP	DE
  E16F  C1            		POP	BC
  E170  D8            		RET	C
  E171  100C          		DJNZ	WRDF5		;ここでループカウンタチェック
  E173  ED5BFEEB      		LD	DE,(_CLPS)
  E177  21FFFF        		LD	HL,0FFFFH	;FATエントリ終了(EOCマーク)
  E17A  C3FAEC        		JP	_SNCL
                      	
  E17D                	WRDF4:				;DEクラスタが空じゃないので次に移動する
  E17D  D1            		POP	DE
  E17E  C1            		POP	BC
  E17F                	WRDF5:
  E17F  13            		INC	DE
  E180  CDABDF        		CALL	ENDCL
  E183  38C6          		JR	C,WRDF1
  E185  37            		SCF
  E186  C9            		RET
                      	
  E187                	RWXR:
  E187  3AF5E4        		LD	A,(SECSZ+2)	;1024=4 / 512=2 / 256=1
  E18A                	L_RWX:
  E18A  1F            		RRA		;->CF
  E18B  3806          		JR	C,E_RWX
  E18D  CB38          		SRL	B	;BC=BC/2
  E18F  CB19          		RR	C	;
  E191  18F7          		JR	L_RWX
  E193                	E_RWX:
  E193  FD5E1A        		LD	E,(IY+26)	;(FCB)ファイルの先頭クラスタ
  E196  FD561B        		LD	D,(IY+27)
  E199  AF            		XOR	A
  E19A  32E5E6        		LD	(_SECPS+1),A
  E19D                	RWX1:
  E19D  ED53FEEB      		LD	(_CLPS),DE
  E1A1  7A            		LD	A,D
  E1A2  B3            		OR	E
  E1A3  280D          		JR	Z,SCF_RET	;RET DE==0 => CF=1
                      	
  E1A5  78            		LD	A,B
  E1A6  B1            		OR	C
  E1A7  C8            		RET	Z		;RET BC==0 => CF=0
                      	
  E1A8  CDEDE6        		CALL	GNCLX
  E1AB  D8            		RET	C
  E1AC  0B            		DEC	BC
                      	
  E1AD  CDABDF        		CALL	ENDCL
  E1B0  38EB          		JR	C,RWX1
  E1B2                	SCF_RET:
  E1B2  37            		SCF
  E1B3  C9            		RET
                      	
  E1B4                	DSKF:
  E1B4  110000        	MAXCLP:	LD	DE,0
  E1B7  2AACEC        		LD	HL,(_FAKEFREE)
  E1BA  7C            		LD	A,H
  E1BB  B5            		OR	L
  E1BC  2803          		JR	Z,DSKF1
  E1BE  110100        		LD	DE,1
  E1C1                	DSKF1:
  E1C1  D5            		PUSH	DE
  E1C2  CDF7EC        		CALL	_GNCL
  E1C5  380C          		JR	C,POPSCF
  E1C7  7A            		LD	A,D
  E1C8  B3            		OR	E
  E1C9  2001          		JR	NZ,DSKF2
  E1CB  23            		INC	HL
  E1CC                	DSKF2:
  E1CC  D1            		POP	DE
  E1CD  1B            		DEC	DE
  E1CE  7A            		LD	A,D
  E1CF  B3            		OR	E
  E1D0  20EF          		JR	NZ,DSKF1
  E1D2  C9            		RET
                      	
  E1D3                	POPSCF:
  E1D3  F1            		POP	AF
  E1D4  37            		SCF
  E1D5  C9            		RET
                      	
  E1D6                	SETTMS:
  E1D6  FD7E17        		LD	A,(IY+23)	;(FCB)ファイルを最後に変更した時刻
  E1D9  3C            		INC	A
  E1DA  C0            		RET	NZ		;ファイルが更新されていない
  E1DB                	SETTMSX:			;FCBに日付時刻をセットする
  E1DB  CD44D8        		CALL	_SYS2C		;(BDOS)時刻の獲得
                      					;H←時  L←分  D←秒
  E1DE  CB25          		SLA	L		;L=L/2
  E1E0  CB25          		SLA	L		;L=L/2
  E1E2  29            		ADD	HL,HL		;*2
  E1E3  29            		ADD	HL,HL		;*4
  E1E4  29            		ADD	HL,HL		;*8
  E1E5  7A            		LD	A,D
  E1E6  0F            		RRCA			;bit.0->7->->->0->C
  E1E7  E61F          		AND	01FH
  E1E9  B5            		OR	L
  E1EA  FD7716        		LD	(IY+22),A	;(FCB)ファイルを最後に変更した時刻
  E1ED  FD7417        		LD	(IY+23),H
                      	
  E1F0  CD10D8        		CALL	_SYS2A		;(BDOS)日付の獲得
                      					;HL←年  D←月  E←日
  E1F3  0144F8        		LD	BC,0-1980
  E1F6  09            		ADD	HL,BC
  E1F7  65            		LD	H,L
                      	
  E1F8  7A            		LD	A,D
  E1F9  87            		ADD	A,A		;*2
  E1FA  87            		ADD	A,A		;*4
  E1FB  87            		ADD	A,A		;*8
  E1FC  87            		ADD	A,A		;*16
  E1FD  6F            		LD	L,A
  E1FE  29            		ADD	HL,HL		;*32
  E1FF  7D            		LD	A,L
  E200  B3            		OR	E
  E201  FD7714        		LD	(IY+20),A	;(FCB)ファイルを最後に変更した日付
  E204  FD7415        		LD	(IY+21),H
  E207  C9            		RET
                      	
  E208                	PUSHRR:
  E208  CD0EE2        		CALL	SUBRR
  E20B                	POPRR1:
  E20B  EDB0          		LDIR
  E20D  C9            		RET
                      	
  E20E                	SUBRR:
  E20E  FDE5          		PUSH	IY
  E210  E1            		POP	HL
  E211  112100        		LD	DE,33
  E214  19            		ADD	HL,DE
  E215  11A2E2        		LD	DE,HLBUF
  E218  010300        		LD	BC,3
  E21B  C9            		RET
                      	
  E21C                	SETSEQ:
  E21C  F5            		PUSH	AF		;AHL=Random record
  E21D  FD7E21        		LD	A,(IY+33)	;(FCB)ランダム・レコード
  E220  FD6E22        		LD	L,(IY+34)
  E223  FD6623        		LD	H,(IY+35)
                      	
  E226  CD42E2        		CALL	SSQ1
                      	
  E229  29            		ADD	HL,HL
  E22A  CB3D          		SRL	L		;L=L/2
  E22C  FD7520        		LD	(IY+32),L	;(FCB)カレント・レコード
  E22F  FD740C        		LD	(IY+12),H	;(FCB)カレント・ブロック
  E232  F1            		POP	AF
                      	
  E233                	POPRR:
  E233  CD0EE2        		CALL	SUBRR
  E236  EB            		EX	DE,HL
  E237  18D2          		JR	POPRR1
                      	
  E239                	GETSIZE:
  E239  FD7E10        		LD	A,(IY+16)	;(FCB)ファイルのサイズ(バイト単位)
  E23C  FD6E11        		LD	L,(IY+17)
  E23F  FD6612        		LD	H,(IY+18)
  E242                	SSQ1:				;バイト単位からCP/Mのレコード単位を求める（1レコード=128バイト）
  E242  87            		ADD	A,A		;in HLA => out HL
  E243  ED6A          		ADC	HL,HL
  E245  B7            		OR	A
  E246  C8            		RET	Z
  E247  23            		INC	HL
  E248  C9            		RET
                      	
  E249                	GETSEQ:
  E249  FD6E20        		LD	L,(IY+32)	;(FCB)カレント・レコード
  E24C  FD660C        		LD	H,(IY+12)	;(FCB)カレント・ブロック
                      	
  E24F  CB25          		SLA	L	;L=L*2
                      	
  E251  CB3C          		SRL	H	;HL=HL/2
  E253  CB1D          		RR	L	;
  E255  C9            		RET
                      	
  E256                	RB_WRITE:
  E256  C5            		PUSH	BC
  E257  ED4B4CEC      		LD	BC,(STABLE+2*026H)	;(BDOS)ランダム・ブロック・ライト
  E25B  1805          		JR	RBRW
  E25D                	RB_READ:
  E25D  C5            		PUSH	BC
  E25E  ED4B4EEC      		LD	BC,(STABLE+2*027H)	;(BDOS)ランダム・ブロック・リード
  E262                	RBRW:
  E262  AF            		XOR	A	;HLA = HL*128
  E263  CB3C          		SRL	H	;HL=HL/2
  E265  CB1D          		RR	L	;
  E267  1F            		RRA			;HLA
  E268  FD7721        		LD	(IY+33),A	;(FCB)ランダム・レコード
  E26B  FD7522        		LD	(IY+34),L
  E26E  FD7423        		LD	(IY+35),H
  E271  218000        		LD	HL,128
                      	
  E274  FDE5          		PUSH	IY
  E276  D1            		POP	DE
  E277  D5            		PUSH	DE
  E278  CD7FE2        		CALL	JP_BC
  E27B  FDE1          		POP	IY
  E27D  C1            		POP	BC
  E27E  C9            		RET
  E27F                	JP_BC:
  E27F  C5            		PUSH	BC
  E280  C9            		RET
                      	
  E281                	SFILE:	DS	33		;DRV FILENAME
  E2A2                	HLBUF:	DS	3		;Random record buffer
                      	
                      	;LDFILE2.ASM
                      	
                      	;	LSX-Dodgers FILE2
                      	
  E2A5                	RBWDD:
  E2A5  E5            		PUSH	HL
  E2A6  C1            		POP	BC
  E2A7  2181E3        		LD	HL,NUL
  E2AA  CDB5E3        		CALL	DDX
  E2AD  2003          		JR	NZ,RBWDD2
  E2AF  2A08EC        		LD	HL,(STABLE+2*4)
  E2B2                	RBWDD2:
  E2B2  FE43          		CP	'C'
  E2B4  2003          		JR	NZ,RBWDD3
  E2B6  2134DA        		LD	HL,PRINTS
  E2B9                	RBWDD3:
  E2B9  FE50          		CP	'P'
  E2BB  2003          		JR	NZ,RBWDD4
  E2BD  2A0AEC        		LD	HL,(STABLE+2*5)
  E2C0                	RBWDD4:
  E2C0  22CEE2        		LD	(RBWDDP+1),HL
  E2C3  2A8AEC        		LD	HL,(_DTA)
  E2C6                	RBWDD1:
  E2C6  78            		LD	A,B
  E2C7  B1            		OR	C
  E2C8                	RBWDD5:
  E2C8  CA7CE3        		JP	Z,RBW1
  E2CB  5E            		LD	E,(HL)
  E2CC  23            		INC	HL
  E2CD  CD88D7        	RBWDDP:	CALL	_SYS02
  E2D0  DA98E3        		JP	C,RBRERR
  E2D3  3E1A          		LD	A,01AH
  E2D5  BB            		CP	E
  E2D6  28F0          		JR	Z,RBWDD5
  E2D8  0B            		DEC	BC
  E2D9  18EB          		JR	RBWDD1
                      	
                      					;Write random block
  E2DB                	_SYS26:		;(BDOS)ランダム・ブロック・ライト
  E2DB  AF            		XOR	A
  E2DC  3281E5        		LD	(DRDN1),A	;NOP
  E2DF  2237E5        		LD	(LEFT+1),HL	;HL←書き込むレコード数
  E2E2  2259E5        		LD	(LEFTX),HL
  E2E5  CD74DD        		CALL	SETDRV
                      	
  E2E8  CDA1E4        		CALL	RBX0
  E2EB  DA83E3        		JP	C,RBWERR
  E2EE  28B5          		JR	Z,RBWDD		;デバイスデスクプリタ
  E2F0  CD22E1        		CALL	WOPEN
  E2F3  DA83E3        		JP	C,RBWERR
  E2F6  7C            		LD	A,H
  E2F7  B5            		OR	L
  E2F8  CA7CE3        		JP	Z,RBW1
                      	
  E2FB  2B            		DEC	HL
                      	
  E2FC  CD4FE5        		CALL	GET_RR_CDE	;CDE=Random record
                      	
  E2FF  AF            		XOR	A	;AHL=HL+CDE
  E300  19            		ADD	HL,DE
  E301  89            		ADC	A,C
                      	
  E302  47            		LD	B,A
  E303  4C            		LD	C,H
                      	
  E304  CD87E1        		CALL	RWXR
  E307  DC33E1        		CALL	C,WRDFX
  E30A  DA83E3        		JP	C,RBWERR
                      		
  E30D  CDCAE4        		CALL	RBX2
  E310  281A          		JR	Z,RBWB		;NZ=セクタ以下の端数がある
  E312  CDDDE4        		CALL	RBXA		
  E315  386C          		JR	C,RBWERR
  E317  EB            		EX	DE,HL
  E318  C5            		PUSH	BC
  E319  EDB0          		LDIR
  E31B  225BE5        		LD	(DTAX),HL
                      	
  E31E  CDC7E0        		CALL	SWTDBF		;バッファデータは更新された
                      	
  E321  2A59E5        		LD	HL,(LEFTX)
  E324  D1            		POP	DE
  E325  ED52          		SBC	HL,DE
  E327  2259E5        		LD	(LEFTX),HL
  E32A  2830          		JR	Z,RBWEND
                      	
  E32C                	RBWB:
  E32C  CD13E5        		CALL	RBXB
  E32F  2813          		JR	Z,RBWC
  E331                	RBWB1:
  E331  C5            		PUSH	BC
  E332  D5            		PUSH	DE
  E333  CD8EDF        		CALL	CLUSTX
  E336  CD51E8        		CALL	DWT24
  E339  D1            		POP	DE
  E33A  C1            		POP	BC
  E33B  3846          		JR	C,RBWERR
  E33D  CDEDE6        		CALL	GNCLX
  E340  3841          		JR	C,RBWERR
  E342  10ED          		DJNZ	RBWB1
  E344                	RBWC:
  E344  CD2BE5        		CALL	RBXC
  E347  2813          		JR	Z,RBWEND
  E349  C5            		PUSH	BC
  E34A  CD8EDF        		CALL	CLUSTX
  E34D  CD80E5        		CALL	DRDN
  E350  C1            		POP	BC
  E351  3830          		JR	C,RBWERR
  E353  ED5B7EEC      		LD	DE,(_DTBUF)
  E357  EDB0          		LDIR
  E359  CDC7E0        		CALL	SWTDBF		;バッファデータは更新された
  E35C                	RBWEND:
  E35C  CD36E5        		CALL	RBXEND
                      	
  E35F  CDB0E4        		CALL	RBX1
  E362  3018          		JR	NC,RBW1
  E364  2A37E5        		LD	HL,(LEFT+1)
  E367  FD5E10        		LD	E,(IY+16)	;(FCB)ファイルのサイズ(バイト単位)
  E36A  FD5611        		LD	D,(IY+17)	;CDE=File size
  E36D  FD4E12        		LD	C,(IY+18)
  E370  AF            		XOR	A
  E371  19            		ADD	HL,DE
  E372  89            		ADC	A,C
  E373  FD7510        		LD	(IY+16),L	;(FCB)ファイルのサイズ(バイト単位)
  E376  FD7411        		LD	(IY+17),H
  E379  FD7712        		LD	(IY+18),A
  E37C                	RBW1:
  E37C  FDE1          		POP	IY
  E37E  C1            		POP	BC
  E37F  D1            		POP	DE
  E380  E1            		POP	HL
  E381                	NUL:
  E381  AF            		XOR	A
  E382  C9            		RET
                      	
  E383                	RBWERR:
  E383  FDE5          		PUSH	IY
  E385  D1            		POP	DE
  E386  2A20EC        		LD	HL,(STABLE+2*010H)
  E389  CD0F00        		CALL	JP_HL
  E38C                	RBRERR1:
  E38C  3E01          		LD	A,001H
  E38E                	RBRERR2:
  E38E  FDE1          		POP	IY
  E390  C1            		POP	BC
  E391  D1            		POP	DE
  E392  E1            		POP	HL
  E393  37            		SCF
  E394  210000        		LD	HL,0
  E397  C9            		RET
                      	
  E398                	RBRERR:
  E398  3EFF          		LD	A,0FFH
  E39A  18F2          		JR	RBRERR2
                      	
  E39C                	RBRFL:
  E39C  3E00          	RBRFLP:	LD	A,000H
  E39E  FE0D          		CP	00DH
  E3A0  2005          		JR	NZ,RBRFL1
  E3A2  D5            		PUSH	DE
  E3A3  1E0A          		LD	E,00AH
  E3A5  1805          		JR	RBRFL2
  E3A7                	RBRFL1:
  E3A7  D5            		PUSH	DE
  E3A8  CD6BD3        		CALL	_SYS07
  E3AB  5F            		LD	E,A
  E3AC                	RBRFL2:
  E3AC  CDCDEC        		CALL	_PRINT
  E3AF  7B            		LD	A,E
  E3B0  D1            		POP	DE
  E3B1  329DE3        		LD	(RBRFLP+1),A
  E3B4  C9            		RET
  E3B5                	DDX:
  E3B5  FD7E01        		LD	A,(IY+1)	;(FCB)主ファイル名
  E3B8  CDB3DF        		CALL	CAP
  E3BB  FE41          		CP	'A'
  E3BD  C9            		RET
                      	
  E3BE                	RBRDD:
  E3BE  E5            		PUSH	HL
  E3BF  C1            		POP	BC
  E3C0  219CE3        		LD	HL,RBRFL
  E3C3  CDB5E3        		CALL	DDX
  E3C6  2005          		JR	NZ,RBRDD2
  E3C8  2A06EC        		LD	HL,(STABLE+2*3)
  E3CB  1804          		JR	RBRDD3
  E3CD                	RBRDD2:
  E3CD  FE43          		CP	'C'
  E3CF  202C          		JR	NZ,RBRDERR
  E3D1                	RBRDD3:
  E3D1  22E1E3        		LD	(RBRDDP+1),HL
                      	
  E3D4  ED5B8AEC      		LD	DE,(_DTA)
  E3D8  210000        		LD	HL,0
  E3DB                	RBRDD1:
  E3DB  78            		LD	A,B
  E3DC  B1            		OR	C
  E3DD  2818          		JR	Z,RBRDDE1
  E3DF  23            		INC	HL
  E3E0  CD9CE3        	RBRDDP:	CALL	RBRFL
  E3E3  380D          		JR	C,RBRDDE
  E3E5  FE1A          		CP	01AH
  E3E7  2809          		JR	Z,RBRDDE
  E3E9  FE03          		CP	3
  E3EB  2805          		JR	Z,RBRDDE
  E3ED  12            		LD	(DE),A
  E3EE  13            		INC	DE
  E3EF  0B            		DEC	BC
  E3F0  18E9          		JR	RBRDD1
                      	
  E3F2                	RBRDDE:
  E3F2  3E1A          		LD	A,01AH
  E3F4  12            		LD	(DE),A
  E3F5                	RBRDDE2:
  E3F5  AF            		XOR	A
  E3F6  3C            		INC	A
  E3F7                	RBRDDE1:
  E3F7  328DE4        		LD	(RBRAP+1),A
  E3FA  C386E4        		JP	RBREND0
  E3FD                	RBRDERR:
  E3FD  210000        		LD	HL,0
  E400  18F3          		JR	RBRDDE2
                      	
                      					;Read random block
  E402                	_SYS27:		;(BDOS)ランダム・ブロック・リード
  E402  2259E5        		LD	(LEFTX),HL
  E405  CD74DD        		CALL	SETDRV
                      	
  E408  FDCB0D66      		BIT	4,(IY+13)	;(FCB)属性(アトリビュート)
  E40C  C28FE4        		JP	NZ,RBRDIR	;ディレクトリ
  E40F  CDA1E4        		CALL	RBX0
  E412  DA98E3        		JP	C,RBRERR
  E415  28A7          		JR	Z,RBRDD
  E417  CDB0E4        		CALL	RBX1
  E41A  DA8CE3        		JP	C,RBRERR1
  E41D  79            		LD	A,C
  E41E  EB            		EX	DE,HL
  E41F  ED52          		SBC	HL,DE		;CP 0HL,CDE
  E421  19            		ADD	HL,DE
  E422  DE00          		SBC	A,000H
  E424  3801          		JR	C,RBR1
  E426  EB            		EX	DE,HL
  E427                	RBR1:
  E427  9F            		SBC	A,A
  E428  E601          		AND	1
  E42A  328DE4        		LD	(RBRAP+1),A
                      	
  E42D  7C            		LD	A,H
  E42E  B5            		OR	L
  E42F  CA86E4        		JP	Z,RBREND0
                      	
  E432  2237E5        		LD	(LEFT+1),HL	;Read record byte
  E435  2259E5        		LD	(LEFTX),HL
                      	
  E438  CDCAE4        		CALL	RBX2
  E43B  2819          		JR	Z,RBRB
  E43D  CDDDE4        		CALL	RBXA
  E440  DA98E3        		JP	C,RBRERR
  E443  C5            		PUSH	BC
  E444  EDB0          		LDIR
  E446  ED535BE5      		LD	(DTAX),DE
  E44A  2A59E5        		LD	HL,(LEFTX)
  E44D  D1            		POP	DE
  E44E  A7            		AND	A
  E44F  ED52          		SBC	HL,DE
  E451  2259E5        		LD	(LEFTX),HL
  E454  282D          		JR	Z,RBREND
                      	
  E456                	RBRB:
  E456  CD13E5        		CALL	RBXB
  E459  2812          		JR	Z,RBRC
  E45B                	RBRB1:
  E45B  C5            		PUSH	BC
  E45C  D5            		PUSH	DE
  E45D  CD8EDF        		CALL	CLUSTX
  E460  CD30E8        		CALL	DRD24
  E463  D1            		POP	DE
  E464  C1            		POP	BC
  E465  D4EDE6        		CALL	NC,GNCLX
  E468  DA98E3        		JP	C,RBRERR
  E46B  10EE          		DJNZ	RBRB1
  E46D                	RBRC:
  E46D  CD2BE5        		CALL	RBXC
  E470  2811          		JR	Z,RBREND
  E472  C5            		PUSH	BC
  E473  CD8EDF        		CALL	CLUSTX
  E476  CD64E5        		CALL	DRDX
  E479  C1            		POP	BC
  E47A  DA98E3        		JP	C,RBRERR
  E47D  EB            		EX	DE,HL
  E47E  2A7EEC        		LD	HL,(_DTBUF)
  E481  EDB0          		LDIR
  E483                	RBREND:
  E483  CD36E5        		CALL	RBXEND
  E486                	RBREND0:
  E486  FDE1          		POP	IY
  E488  C1            		POP	BC
  E489  D1            		POP	DE
  E48A  F1            		POP	AF	;(HL)
  E48B  AF            		XOR	A
  E48C  3E00          	RBRAP:	LD	A,000H
  E48E  C9            		RET
                      	
  E48F                	RBRDIR:
  E48F  FD6E1A        		LD	L,(IY+26)	;(FCB)ファイルの先頭クラスタ
  E492  FD661B        		LD	H,(IY+27)
  E495  CDCEDF        		CALL	CHDIR
  E498  AF            		XOR	A
  E499  67            		LD	H,A
  E49A  6F            		LD	L,A
  E49B  3C            		INC	A
  E49C  328DE4        		LD	(RBRAP+1),A
  E49F  18E5          		JR	RBREND0
                      	
  E4A1                	RBX0:
  E4A1  2A8AEC        		LD	HL,(_DTA)
  E4A4  225BE5        		LD	(DTAX),HL
  E4A7  2A59E5        		LD	HL,(LEFTX)
  E4AA  FD7E1C        		LD	A,(IY+28)	;(FCB)オープン・モード
  E4AD  D6FD          		SUB	0FDH
  E4AF  C9            		RET
                      	
  E4B0                	RBX1:
  E4B0  E5            		PUSH	HL		;Record byte
                      					;AHL=File size
  E4B1  FD6E10        		LD	L,(IY+16)	;ファイルのサイズ(バイト単位)
  E4B4  FD6611        		LD	H,(IY+17)
  E4B7  FD7E12        		LD	A,(IY+18)
                      	
  E4BA  CD4FE5        		CALL	GET_RR_CDE	;CDE=Random record
                      	
  E4BD  A7            		AND	A
  E4BE  ED52          		SBC	HL,DE
  E4C0  99            		SBC	A,C
  E4C1  D1            		POP	DE
                      	
  E4C2  D8            		RET	C
  E4C3  4F            		LD	C,A
  E4C4  EB            		EX	DE,HL	;CDE=File byte	HL=Record byte
  E4C5  B2            		OR	D
  E4C6  B3            		OR	E
  E4C7  C0            		RET	NZ
  E4C8  37            		SCF
  E4C9  C9            		RET
                      	
  E4CA                	RBX2:				;Cluster settings
  E4CA  FD4E22        		LD	C,(IY+34)	;(+33)(FCB)ランダム・レコード
  E4CD  FD4623        		LD	B,(IY+35)
  E4D0  CD87E1        		CALL	RWXR
  E4D3  3AADDE        		LD	A,(SECSZM1+2)	;1024=3 / 512=1 / 256=0
  E4D6  FDA622        		AND	(IY+34)
  E4D9  FDB621        		OR	(IY+33)
  E4DC  C9            		RET
                      	
  E4DD                	RBXA:
  E4DD  C5            		PUSH	BC
  E4DE  D5            		PUSH	DE
  E4DF  CD8EDF        		CALL	CLUSTX
  E4E2  CD64E5        		CALL	DRDX
  E4E5  D1            		POP	DE
  E4E6  C1            		POP	BC
  E4E7  D8            		RET	C
  E4E8  CDEDE6        		CALL	GNCLX
  E4EB  D8            		RET	C
  E4EC  ED53FEEB      		LD	(_CLPS),DE
                      	
  E4F0  FD4E21        		LD	C,(IY+33)	;(FCB)ランダム・レコード
  E4F3  210004        	SECSZ:	LD	HL,0400H	;自己書き換え 1024=0400H / 512=0200H ここに1セクタのサイズが格納される
  E4F6  7C            		LD	A,H
  E4F7  3D            		DEC	A		;1024=3 / 512=1
  E4F8  FDA622        		AND	(IY+34)		;(FCB)ランダム・レコード
  E4FB  47            		LD	B,A		;BCに1セクタ以下の端数が入る
  E4FC  ED42          		SBC	HL,BC		;残りを計算
                      	
  E4FE  ED5B59E5      		LD	DE,(LEFTX)
  E502  ED52          		SBC	HL,DE		;CP HL,DE
  E504  19            		ADD	HL,DE		;
  E505  3801          		JR	C,RBXA1		;DEとHLを比較して大きい方をHLに
  E507  EB            		EX	DE,HL
  E508                	RBXA1:
  E508  E5            		PUSH	HL
  E509  2A7EEC        		LD	HL,(_DTBUF)
  E50C  09            		ADD	HL,BC
  E50D  ED5B5BE5      		LD	DE,(DTAX)
  E511  C1            		POP	BC
  E512  C9            		RET
                      	
  E513                	RBXB:
  E513  2A5BE5        		LD	HL,(DTAX)
  E516  ED5BFEEB      		LD	DE,(_CLPS)
  E51A  3A5AE5        		LD	A,(LEFTX+1)
  E51D  47            		LD	B,A
  E51E  3AF5E4        		LD	A,(SECSZ+2)	;1024=4 / 512=2 / 256=1
  E521                	RBXB1:
  E521  1F            		RRA		;->CF
  E522  3804          		JR	C,RBXB2
  E524  CB38          		SRL	B	;B=B/2
  E526  18F9          		JR	RBXB1
  E528                	RBXB2:
  E528  78            		LD	A,B
  E529  B7            		OR	A
  E52A  C9            		RET
                      	
  E52B                	RBXC:
  E52B  ED4B59E5      		LD	BC,(LEFTX)
  E52F  3AADDE        		LD	A,(SECSZM1+2)	;1024=3 / 512=1 / 256=0
  E532  A0            		AND	B
  E533  47            		LD	B,A		;1セクタ以下の端数がない場合はZ
  E534  B1            		OR	C
  E535  C9            		RET
                      	
  E536                	RBXEND:
  E536  110000        	LEFT:	LD	DE,0
  E539  AF            		XOR	A
  E53A  FD6E21        		LD	L,(IY+33)	;(FCB)ランダム・レコード
  E53D  FD6622        		LD	H,(IY+34)
  E540  19            		ADD	HL,DE
  E541  FD8E23        		ADC	A,(IY+35)
  E544  FD7521        		LD	(IY+33),L	;(FCB)ランダム・レコード
  E547  FD7422        		LD	(IY+34),H
  E54A  FD7723        		LD	(IY+35),A
  E54D  EB            		EX	DE,HL		;HL=Read byte
  E54E  C9            		RET
                      	
  E54F                	GET_RR_CDE:			;CDE=Random record
  E54F  FD5E21        		LD	E,(IY+33)	;(FCB)ランダム・レコード
  E552  FD5622        		LD	D,(IY+34)
  E555  FD4E23        		LD	C,(IY+35)
  E558  C9            		RET
                      	
  E559                	CPBUF:
  E559  0000          	LEFTX:	DW	0
  E55B  0000          	DTAX:	DW	0
  E55D  20            		DB	020H	;CPBUFで使う
  E55E  20            		DB	020H
  E55F  20            		DB	020H
  E560  20            		DB	020H
  E561  20            		DB	020H
  E562  20            		DB	020H
  E563  20            		DB	020H
                      	;
                      	
                      	;LDDIO.ASM
                      	
                      	;	LSX-Dodgers DIO
                      	
  E564                	DRDX:
  E564  CDA2E5        		CALL	DRDY
  E567  C8            		RET	Z
  E568  CD88E5        		CALL	DRDX1		;データバッファの情報を保存
  E56B  D8            		RET	C
  E56C  E5            		PUSH	HL
  E56D  C5            		PUSH	BC
  E56E  D5            		PUSH	DE
  E56F  2A7EEC        		LD	HL,(_DTBUF)
  E572  3ACBE5        		LD	A,(_DBS24+1)
  E575  4F            		LD	C,A
  E576  CD30E8        		CALL	DRD24
  E579  DC9DE5        		CALL	C,DRDNE
  E57C                	POP_DE_BC_HL_RET:
  E57C  D1            		POP	DE
  E57D  C1            		POP	BC
  E57E  E1            		POP	HL
  E57F  C9            		RET
                      	
                      	;	CDE:セクタ番号
  E580                	DRDN:
  E580  AF            		XOR	A
  E581  00            	DRDN1:	NOP			;自己書き換え NOP / SCF
  E582  30E0          		JR	NC,DRDX
  E584                	DRDNX:
  E584  CDA2E5        		CALL	DRDY
  E587  C8            		RET	Z
  E588                	DRDX1:
  E588  CDB8E5        		CALL	DWTX
                      					;データバッファの読み込んだドライブ・セクタ情報を保存
  E58B  ED53A6EC      		LD	(_DBSEC),DE
  E58F  79            		LD	A,C
  E590  32CBE5        		LD	(_DBS24+1),A
                      	
  E593  3A88EC        		LD	A,(_DRV)
  E596  32A5EC        		LD	(_DBDRV),A
  E599  CDD9EC        		CALL	_CHGDRV
  E59C  D0            		RET	NC
  E59D                	DRDNE:
  E59D  9F            		SBC	A,A		;CF=1ならばA=0FFH
  E59E  32A5EC        		LD	(_DBDRV),A
  E5A1  C9            		RET
                      	
                      	;	CDE:セクタ番号
  E5A2                	DRDY:
  E5A2  3ACBE5        		LD	A,(_DBS24+1)
  E5A5  B9            		CP	C
  E5A6  C0            		RET	NZ
                      	
  E5A7  E5            		PUSH	HL
  E5A8  3A88EC        		LD	A,(_DRV)
  E5AB  21A5EC        		LD	HL,_DBDRV
  E5AE  AE            		XOR	(HL)
  E5AF  2005          		JR	NZ,POP_HL_RET
                      	
  E5B1  2AA6EC        		LD	HL,(_DBSEC)
  E5B4  ED52          		SBC	HL,DE		;CF=0
  E5B6                	POP_HL_RET:
  E5B6  E1            		POP	HL
  E5B7  C9            		RET
                      	
  E5B8                	DWTX:
  E5B8  3AA4EC        		LD	A,(_WTDBF)
  E5BB  B7            		OR	A
  E5BC  C8            		RET	Z
  E5BD  AF            		XOR	A
  E5BE  32A4EC        		LD	(_WTDBF),A
                      	
  E5C1  E5            		PUSH	HL
  E5C2  C5            		PUSH	BC
  E5C3  D5            		PUSH	DE
  E5C4  3AA5EC        		LD	A,(_DBDRV)
  E5C7  CDD9EC        		CALL	_CHGDRV
  E5CA  0E00          	_DBS24:	LD	C,0
  E5CC  ED5BA6EC      		LD	DE,(_DBSEC)
  E5D0  2A7EEC        		LD	HL,(_DTBUF)
  E5D3  D451E8        		CALL	NC,DWT24
  E5D6                	POP_DE_BC_HL_RET2:
  E5D6  18A4          		JR	POP_DE_BC_HL_RET
                      	
  E5D8                	RDFATX:
  E5D8  E5            		PUSH	HL
  E5D9  3A88EC        		LD	A,(_DRV)
  E5DC  21AAEC        		LD	HL,_FATDRV
  E5DF  AE            		XOR	(HL)
  E5E0  28D4          		JR	Z,POP_HL_RET
                      	
  E5E2  C5            		PUSH	BC
  E5E3  D5            		PUSH	DE
  E5E4  DDE5          		PUSH	IX
  E5E6  CD02E6        		CALL	WTFATX
  E5E9  3813          		JR	C,POP_IX_DE_BC_HL_RET
                      	
  E5EB  AF            		XOR	A
  E5EC  32ABEC        		LD	(_FATIX),A
  E5EF  3A88EC        		LD	A,(_DRV)
  E5F2  32AAEC        		LD	(_FATDRV),A
  E5F5  CDE5EC        		CALL	_RDFAT
  E5F8                	RDFATE2:
  E5F8  3004          		JR	NC,POP_IX_DE_BC_HL_RET
  E5FA  9F            		SBC	A,A		;A=0xFF
  E5FB  32AAEC        		LD	(_FATDRV),A
  E5FE                	POP_IX_DE_BC_HL_RET:
  E5FE  DDE1          		POP	IX
  E600  18D4          		JR	POP_DE_BC_HL_RET2
                      	
  E602                	WTFATX:
  E602  3AA2EC        		LD	A,(_WTFATF)
  E605  B7            		OR	A
  E606  C8            		RET	Z
  E607  E5            		PUSH	HL
  E608  3AAAEC        		LD	A,(_FATDRV)
  E60B  21A5EC        		LD	HL,_DBDRV
  E60E  AE            		XOR	(HL)
  E60F  CCB8E5        		CALL	Z,DWTX
  E612  38A2          		JR	C,POP_HL_RET
  E614  C5            		PUSH	BC
  E615  D5            		PUSH	DE
  E616  DDE5          		PUSH	IX
  E618  CD5EE8        		CALL	WTFAT
  E61B  AF            		XOR	A
  E61C  32A2EC        		LD	(_WTFATF),A
  E61F  18DD          		JR	POP_IX_DE_BC_HL_RET
                      	
  E621                	NCL1:
  E621  7A            		LD	A,D
  E622  B3            		OR	E
  E623  37            		SCF
  E624  C8            		RET	Z
                      	
  E625  7A            		LD	A,D
  E626  E608          		AND	8		;DE(targetCluster >= 0x800)
  E628                	N16CL1X:
  E628  E5            		PUSH	HL
  E629  3248E6        		LD	(NCLPAT+2),A	;_FATIX
  E62C  2AAAEC        		LD	HL,(_FATDRV)	;L=_FATDRV H=_FATIX
  E62F  BC            		CP	H
  E630  3A88EC        		LD	A,(_DRV)	;この間でフラグは変化しない
  E633  3247E6        		LD	(NCLPAT+1),A	;_FATDRV
  E636  2005          		JR	NZ,NCL2		;FATIXが違う
  E638  BD            		CP	L
  E639  2002          		JR	NZ,NCL2		;ドライブが違う
  E63B  E1            		POP	HL
  E63C  C9            		RET
  E63D                	NCL2:
  E63D  C5            		PUSH	BC
  E63E  D5            		PUSH	DE
  E63F  DDE5          		PUSH	IX
  E641  CD02E6        		CALL	WTFATX
  E644  38B8          		JR	C,POP_IX_DE_BC_HL_RET
  E646  010000        	NCLPAT:	LD	BC,0		;自己書き換え C=_FATDRV B=_FATIX
  E649  ED43AAEC      		LD	(_FATDRV),BC
  E64D  CD3EE8        		CALL	RDFATS
  E650  18A6          		JR	RDFATE2
                      	
  E652                	NCL3:
  E652  CB9A          		RES	3,D
  E654  6B            		LD	L,E
  E655  62            		LD	H,D
  E656  CB3C          		SRL	H	;
  E658  CB1D          		RR	L	;HLA=HLA/2
  E65A  1F            		RRA		;
  E65B  ED4B7CEC      		LD	BC,(_FATBF)
  E65F  19            		ADD	HL,DE
  E660  09            		ADD	HL,BC
  E661  17            		RLA
  E662  C9            		RET
                      	
  E663                	N16CL1:
  E663  7A            		LD	A,D
  E664  B3            		OR	E
  E665  37            		SCF
  E666  C8            		RET	Z
                      	
  E667  7A            		LD	A,D
  E668  CB3F          		SRL	A	;/2
  E66A  CB3F          		SRL	A	;/2
  E66C  18BA          		JR	N16CL1X
                      	
  E66E                	GNCL:
  E66E  CD21E6        		CALL	NCL1		;GET NEXT CLUSTER
  E671  D8            		RET	C
  E672  C5            		PUSH	BC
  E673  E5            		PUSH	HL
  E674  CD52E6        		CALL	NCL3
  E677  3809          		JR	C,GNC1
  E679  5E            		LD	E,(HL)
  E67A  23            		INC	HL
  E67B  7E            		LD	A,(HL)
  E67C  E60F          		AND	00FH
  E67E  57            		LD	D,A
  E67F  E1            		POP	HL
  E680  C1            		POP	BC
  E681  C9            		RET
  E682                	GNC1:
  E682  7E            		LD	A,(HL)
  E683  23            		INC	HL
  E684  56            		LD	D,(HL)
  E685  0604          		LD	B,4
  E687                	GNC1L:
  E687  CB3A          		SRL	D	;DA=DA/2
  E689  1F            		RRA		;
  E68A  10FB          		DJNZ	GNC1L
                      	
  E68C  5F            		LD	E,A
  E68D  E1            		POP	HL
  E68E  C1            		POP	BC
  E68F  A7            		AND	A
  E690  C9            		RET
                      	
  E691                	SNCL:
  E691  CD21E6        		CALL	NCL1
  E694  D8            		RET	C
                      	;				SET NEXT CLUSTER
  E695  E5            		PUSH	HL
  E696  C5            		PUSH	BC
  E697  D5            		PUSH	DE
  E698  E5            		PUSH	HL
  E699  CD52E6        		CALL	NCL3
  E69C  D1            		POP	DE
                      	;CF=ODD
  E69D  7E            		LD	A,(HL)
  E69E  73            		LD	(HL),E
  E69F  3806          		JR	C,SNC1
                      	;EVEN
                      	;M[0] = E
                      	;M[1] = (M[1] & 0xF0) | (D & 0x0F)
  E6A1  23            		INC	HL
  E6A2  ED67          		RRD		;M={A[3:0],E[3:0]}
  E6A4  7A            		LD	A,D
  E6A5  1804          		JR	SNC11
  E6A7                	SNC1:
                      	;ODD
                      	;HL[0] = (HL[0]&0x0F) | (E<<4)
                      	;HL[1] = DE>>4
  E6A7  ED6F          		RLD		;M={D[3:0],E[7:4]}
  E6A9  23            		INC	HL
  E6AA  72            		LD	(HL),D	;M={D[3:0],E[7:4]}
  E6AB                	SNC11:
  E6AB  ED6F          		RLD		;M={M[7:4],D[3:0]}
  E6AD  B7            		OR	A
  E6AE  D1            		POP	DE
  E6AF  C1            		POP	BC
  E6B0  E1            		POP	HL
  E6B1                	FAT_CHANGED:
  E6B1  3E01          		LD	A,1
  E6B3  32A2EC        		LD	(_WTFATF),A
  E6B6  C9            		RET
                      	
  E6B7                	N16CL3:
  E6B7  C5            		PUSH	BC
  E6B8  6B            		LD	L,E
  E6B9  7A            		LD	A,D
  E6BA  E603          		AND	3
  E6BC  67            		LD	H,A
  E6BD  29            		ADD	HL,HL
  E6BE  ED4B7CEC      		LD	BC,(_FATBF)
  E6C2  09            		ADD	HL,BC
  E6C3  C1            		POP	BC
  E6C4  C9            		RET
                      	
  E6C5                	GNCL16:
  E6C5  CD63E6        		CALL	N16CL1		;GET NEXT CLUSTER for FAT16
  E6C8  D8            		RET	C
  E6C9  E5            		PUSH	HL
  E6CA  CDB7E6        		CALL	N16CL3
  E6CD  5E            		LD	E,(HL)
  E6CE  23            		INC	HL
  E6CF  56            		LD	D,(HL)
  E6D0  E1            		POP	HL
  E6D1  C9            		RET
                      	
  E6D2                	SNCL16:
  E6D2  CD63E6        		CALL	N16CL1		;GET NEXT CLUSTER for FAT16
  E6D5  D8            		RET	C
  E6D6  D5            		PUSH	DE
  E6D7  E5            		PUSH	HL
  E6D8  CDB7E6        		CALL	N16CL3
  E6DB  D1            		POP	DE		;HL
  E6DC  73            		LD	(HL),E
  E6DD  23            		INC	HL
  E6DE  72            		LD	(HL),D
  E6DF  6B            		LD	L,E
  E6E0  62            		LD	H,D
  E6E1  D1            		POP	DE
  E6E2  18CD          		JR	FAT_CHANGED
                      	
                      	;------------------------
                      	;次のセクタを探す際に_SECPSの値をチェック
                      	;in
                      	;	DE : セクタ番号
                      	;out
                      	;	DE : 次のセクタ番号
                      	;note
                      	;
                      	;------------------------
  E6E4                	NEXTX:
  E6E4  3E00          	_SECPS:	LD	A,0
  E6E6  3C            		INC	A
  E6E7  E600          	NCPAT:	AND	0	;自己書き換え　1クラスタの論理セクタ数-1
  E6E9  32E5E6        		LD	(_SECPS+1),A
  E6EC  C9            		RET
                      	
  E6ED                	GNCLX:
  E6ED  CDE4E6        		CALL	NEXTX
  E6F0  C0            		RET	NZ	;1クラスタのセクタ未満の場合は戻る
  E6F1  C3F7EC        		JP	_GNCL	;次のクラスタを探す
                      	
  E6F4                	RDFAT:
  E6F4  3E80          		LD	A,080H
  E6F6  327FEB        		LD	(CHECK),A
  E6F9                	RDFAT1:
  E6F9  3A88EC        		LD	A,(_DRV)
  E6FC  CDAEE9        		CALL	CHGDRVR
  E6FF  D8            		RET	C
  E700  DD7E12        		LD	A,(IX+012H)	;DPB_12_DEVICE
  E703  CB6F          		BIT	5,A
  E705  CA24E8        		JP	Z,RDFAT0X
  E708  217FEB        		LD	HL,CHECK
  E70B  A6            		AND	(HL)
  E70C  77            		LD	(HL),A
  E70D  110000        		LD	DE,0		;BPB
  E710  2A7CEC        		LD	HL,(_FATBF)
  E713  CD2EE8        		CALL	DRD16
  E716  3024          		JR	NC,GET_BPB
  E718  217FEB        		LD	HL,CHECK
  E71B  CB06          		RLC	(HL)
  E71D  3F            		CCF
  E71E  D8            		RET	C
  E71F  DDCB0A1E      		RR	(IX+00AH)	;DPB_0A_FDMODE
  E723  3F            		CCF			;フロッピーディスクのMFMモードを切り替える
  E724  DDCB0A16      		RL	(IX+00AH)	;DPB_0A_FDMODE
  E728  3EFF          		LD	A,0FFH
  E72A  3289EC        		LD	(_DSK),A
  E72D  3A84EC        		LD	A,(_DRIVE)
  E730  E603          		AND	3
  E732  F680          		OR	080H
  E734  6F            		LD	L,A
  E735  26EC          		LD	H,_CYL0/256
  E737  3EFF          		LD	A,0FFH
  E739  77            		LD	(HL),A
  E73A  18BD          		JR	RDFAT1
  E73C                	GET_BPB:
  E73C  FDE5          		PUSH	IY
  E73E  FD2A7CEC      		LD	IY,(_FATBF)	;BPB
                      	
  E742  FD7E00        		LD	A,(IY+0)	;BS_JmpBoot
  E745  FEEB          		CP	0EBH		;Short jump
  E747  280C          		JR	Z,BPBOK
  E749  FEE9          		CP	0E9H		;Near jump
  E74B  2808          		JR	Z,BPBOK
  E74D  FE60          		CP	060H		;X68k
  E74F  2804          		JR	Z,BPBOK
  E751                	NOT_BPB
  E751  FDE1          		POP	IY
  E753  37            		SCF
  E754  C9            		RET
  E755                	BPBOK:
  E755  FD7E0D        		LD	A,(IY+13)	;BPB_SecPerClus
  E758  DD7707        		LD	(IX+7),A	;DPB_07_SECPCL
                      	
  E75B  FD7E10        		LD	A,(IY+16)	;BPB_NumFATs
  E75E  FE02          		CP	2		;>2:NC
  E760  FD7E0C        		LD	A,(IY+12)	;BPB_BytsPerSec
  E763  3806          		JR	C,BPBFAT1
  E765  FE05          		CP	5
  E767  30E8          		JR	NC,NOT_BPB	;1セクタ1024以上は無効
  E769  F680          		OR	080H
  E76B                	BPBFAT1:
  E76B  DD770F        		LD	(IX+00FH),A	;DPB_0F_BPS
                      	
  E76E  FD7E16        		LD	A,(IY+22)	;BPB_FATSz16
  E771  DD7700        		LD	(IX+0),A	;DPB_00_FATLN
  E774  FD7E17        		LD	A,(IY+23)	;BPB_FATSz16
  E777  DD7701        		LD	(IX+1),A	;DPB_00_FATLN
                      	
  E77A  FD6E0E        		LD	L,(IY+14)	;BPB_RsvdSecCnt
  E77D  FD660F        		LD	H,(IY+15)
  E780  DD750E        		LD	(IX+00EH),L	;DPB_0E_FATPS
  E783  FD5E16        		LD	E,(IY+22)	;BPB_FATSz16
  E786  FD5617        		LD	D,(IY+23)
  E789  FD4610        		LD	B,(IY+16)	;BPB_NumFATs
  E78C                	BPBDP1:				;BPB_FATSz16 * BPB_NumFATs
  E78C  19            		ADD	HL,DE
  E78D  10FD          		DJNZ	BPBDP1
  E78F                	BPBDP2:
  E78F  DD7510        		LD	(IX+010H),L	;DPB_10_DIRPS
  E792  DD7411        		LD	(IX+011H),H
  E795  E5            		PUSH	HL
                      	
  E796  FD6E11        		LD	L,(IY+17)	;BPB_RootEntCnt
  E799  FD6612        		LD	H,(IY+18)
  E79C  FD7E0C        		LD	A,(IY+12)	;BPB_BytsPerSec
  E79F  0606          		LD	B,6
  E7A1                	BPBBPS1:
  E7A1  05            		DEC	B
  E7A2  0F            		RRCA
  E7A3  30FC          		JR	NC,BPBBPS1
  E7A5                	BPBDE1:
  E7A5  29            		ADD	HL,HL
  E7A6  10FD          		DJNZ	BPBDE1
                      	
  E7A8  7C            		LD	A,H
  E7A9  DD770B        		LD	(IX+00BH),A	;DPB_0B_DIRSCNT
                      	
  E7AC  D1            		POP	DE		;DPB_10_DIRPS
  E7AD  6C            		LD	L,H
  E7AE  2600          		LD	H,0
  E7B0  19            		ADD	HL,DE		;MAXDIR
  E7B1  E5            		PUSH	HL
  E7B2  FD4E0D        		LD	C,(IY+13)	;BPB_SecPerClus
  E7B5  CB21          		SLA	C		;*2
  E7B7  AF            		XOR	A
  E7B8  47            		LD	B,A
  E7B9  ED42          		SBC	HL,BC
  E7BB  DD7514        		LD	(IX+014H),L	;DPB_14_ADDCL16
  E7BE  DD7415        		LD	(IX+015H),H
                      	
  E7C1  D1            		POP	DE		;DE=DPB_0B_MAXDIR
  E7C2  FD6E13        		LD	L,(IY+19)	;BPB_TotSec16
  E7C5  FD6614        		LD	H,(IY+20)
  E7C8  7C            		LD	A,H
  E7C9  B5            		OR	L		;ここでCF=0
  E7CA  3E00          		LD	A,0		;LDでフラグは変化しない。BPB_TotSec16を AHL で扱う為、Aに0を入れる
  E7CC  2010          		JR	NZ,BPB16BIT
  E7CE  FD7E23        		LD	A,(IY+35)	;BPB_TotSec16が「0」の場合はBPB_TotSec32で計算
  E7D1  B7            		OR	A
  E7D2                	NOT_BPB1:
  E7D2  C251E7        		JP	NZ,NOT_BPB	;念のため(総セクタ数が24ビットを超える場合)
  E7D5  FD6E20        		LD	L,(IY+32)	;BPB_TotSec32 は AHL の24ビットで扱う
  E7D8  FD6621        		LD	H,(IY+33)	;1クラスタの論理セクタ数(DPB_07_SECPCL)が最大128なので
  E7DB  FD7E22        		LD	A,(IY+34)	;24ビットを超えると必ずクラスタ数が16ビットを超えてしまうのでこれで十分
  E7DE                	BPB16BIT:
  E7DE  ED52          		SBC	HL,DE		;CF=0のはず
  E7E0  DE00          		SBC	A,0
  E7E2  FD460D        		LD	B,(IY+13)	;BPB_SecPerClus
  E7E5                	BPBTC1:				;総クラスタ数(AHL) = 総セクタ数(AHL) / セクタサイズ(B)
  E7E5  CB18          		RR	B		;->CY
  E7E7  3808          		JR	C,BPBTC2
  E7E9  CB3F          		SRL	A
  E7EB  CB1C          		RR	H		;AHL=AHL/2
  E7ED  CB1D          		RR	L
  E7EF  18F4          		JR	BPBTC1
  E7F1                	BPBTC2:
  E7F1  B7            		OR	A
  E7F2  20DE          		JR	NZ,NOT_BPB1	;念のため(クラスタ数が16ビットを超える場合)
  E7F4  23            		INC	HL
  E7F5  23            		INC	HL
  E7F6  DD7508        		LD	(IX+8),L	;DPB_08_MAXCL
  E7F9  DD7409        		LD	(IX+9),H
                      	
  E7FC  FD7E15        		LD	A,(IY+21)	;BPB_Media
  E7FF  DD7706        		LD	(IX+6),A	;DPB_06_FATID
                      	
  E802  DDCB0A7E      		BIT	7,(IX+00AH)	;DPB_0A_FDMODE
  E806  2817          		JR	Z,NOT_FD
  E808  2E28          		LD	L,40		;MAXCYLの設定（要検討）ここから下はフロッピーのみ書き換える
  E80A  FEFD          		CP	0FDH	;2D
  E80C  2808          		JR	Z,SETCYL
  E80E  2E4D          		LD	L,77
  E810  FEFE          		CP	0FEH	;2HD
  E812  2802          		JR	Z,SETCYL
  E814  2E50          		LD	L,80	;その他2DD等
  E816                	SETCYL:	
  E816  DD750C        		LD	(IX+00CH),L	;DPB_0C_MAXCYL
  E819  FD7E18        		LD	A,(IY+24)	;BPB_SecPerTr
  E81C  DD770D        		LD	(IX+00DH),A	;DPB_0D_MAXSEC
  E81F                	NOT_FD:
  E81F  FDE1          		POP	IY
  E821  CDFBE8        		CALL	CHGDRV2
  E824                	RDFAT0X:
  E824  CD3EE8        		CALL	RDFATS
  E827  D8            		RET	C
  E828  DDBE06        		CP	(IX+6)		;DPB_06_FATID
  E82B  C8            		RET	Z
  E82C  37            		SCF
  E82D  C9            		RET
                      	
  E82E                	DRD16:
  E82E  0E00          		LD	C,0
  E830                	DRD24:
  E830  0601          		LD	B,1
  E832  DDE5          		PUSH	IX
  E834  DD2AA8EC      		LD	IX,(_DPB)
  E838  CDC6EA        	DRDPAT:	CALL	FDRD		;自己書き換え（ディスク読み込み）
  E83B                	POP_IX_RET:
  E83B  DDE1          		POP	IX
  E83D  C9            		RET
                      	
  E83E                	RDFATS:
  E83E  CD80E8        		CALL	FATSETUP
  E841  D8            		RET	C
  E842                	RDFATL:
  E842  C5            		PUSH	BC
  E843  CD2EE8        		CALL	DRD16
  E846  C1            		POP	BC
  E847  D8            		RET	C
  E848  10F8          		DJNZ	RDFATL
  E84A  2A7CEC        		LD	HL,(_FATBF)
  E84D  7E            		LD	A,(HL)
  E84E  C9            		RET
                      	
  E84F                	DWT16:
  E84F  0E00          		LD	C,0
  E851                	DWT24:
  E851  0601          		LD	B,1
  E853  DDE5          		PUSH	IX
  E855  DD2AA8EC      		LD	IX,(_DPB)
  E859  CDBDEA        	DWTPAT:	CALL	FDWT		;自己書き換え（ディスク書き込み）
  E85C  18DD          		JR	POP_IX_RET
                      	
  E85E                	WTFAT:
  E85E  CD80E8        		CALL	FATSETUP
  E861  D477E8        		CALL	NC,WTFATL
  E864  D8            		RET	C
  E865  DDCB0F7E      		BIT	7,(IX+00FH)	;DPB_0F_BPS
  E869  C8            		RET	Z		;予備FATが無い
  E86A  CD87E8        		CALL	FATS2
  E86D  E5            		PUSH	HL		;予備FAT
  E86E  DD6E00        		LD	L,(IX+0)	;DPB_00_FATLN
  E871  DD6601        		LD	H,(IX+1)
  E874  19            		ADD	HL,DE
  E875  EB            		EX	DE,HL
  E876  E1            		POP	HL
  E877                	WTFATL:
  E877  C5            		PUSH	BC
  E878  CD4FE8        		CALL	DWT16
  E87B  C1            		POP	BC
  E87C  D8            		RET	C
  E87D  10F8          		DJNZ	WTFATL
  E87F  C9            		RET
                      	;------------------------
                      	;FATのセットアップ
                      	;out
                      	;	B  : FATセクタ数
                      	;	DE : FAT先頭セクタ番号
                      	;	HL : FATバッファポインタ
                      	;	CF : 1=ドライブ切り替えエラー
                      	;note
                      	;	FATサイズがFATバッファを超える場合は
                      	;	対象クラスタ領域==(_FATIX)によって
                      	;	FAT12:FATの前半3KBと後半3KBを切り替える
                      	;	FAT16:対象クラスタ1024毎に2KBを切り替える
                      	;------------------------
  E880                	FATSETUP:
  E880  3AAAEC        		LD	A,(_FATDRV)
  E883  CDAEE9        		CALL	CHGDRVR		;ドライブ切り替え
  E886  D8            		RET	C
  E887                	FATS2:
  E887  ED5BFAEB      		LD	DE,(_FATPS)	;fat sector pos
  E88B  C38EE8        	FATSX:	JP	FATSETUP12	;自己書き換え
                      	
  E88E                	FATSETUP12:
  E88E  2A7CEC        		LD	HL,(_FATBF)
  E891  3E18          		LD	A,24		;3072 / 256 FATバッファに読み込めるセクタ数
  E893  DD460F        		LD	B,(IX+00FH)	;DPB_0F_BPS
  E896                	L_FATS2:
  E896  1F            		RRA			;CF=0 なので A=A/2
  E897  CB18          		RR	B		;->CF
  E899  30FB          		JR	NC,L_FATS2
                      	
  E89B  DD4600        		LD	B,(IX+0)	;DPB_00_FATLN
  E89E  B8            		CP	B
  E89F  D0            		RET	NC		;DPB_00_FATLN x sectorSize < fatBufSize
                      	;targetCluster
  E8A0  4F            		LD	C,A		;C = skipCount
  E8A1  3AABEC        		LD	A,(_FATIX)	;(targetCluster >= 0x800)
  E8A4  B7            		OR	A
  E8A5  2806          		JR	Z,FATS3
                      	;(targerCluster>=0x800)
  E8A7                	FAT_SKP:
  E8A7  13            		INC	DE		;FATPS++
  E8A8  05            		DEC	B		;FATSIZE--
  E8A9  0D            		DEC	C		;skipCnt--
  E8AA  20FB          		JR	NZ,FAT_SKP
  E8AC  48            		LD	C,B
  E8AD                	FATS3:
  E8AD  41            		LD	B,C		;3 or 6 or 12
  E8AE  AF            		XOR	A
  E8AF  C9            		RET
                      	
  E8B0                	FATSETUP16:
  E8B0  DD7E0F        		LD	A,(IX+00FH)	;DPB_0F_BPS 512=2 1024=4
  E8B3  0610          		LD	B,16		;2048 / 256 FATバッファに読み込むセクタ数 512=4/1024=2
  E8B5  67            		LD	H,A		;DPB_0F_BPS
  E8B6                	L_F16S2:
  E8B6  CB38          		SRL	B		;/2
  E8B8  1F            		RRA			;->CF
  E8B9  30FB          		JR	NC,L_F16S2
                      	
  E8BB  7C            		LD	A,H		;DPB_0F_BPS
  E8BC  2AABEC        		LD	HL,(_FATIX)	;範囲は0-63(0-03FH):65535*2/2048
  E8BF  2600          		LD	H,0
  E8C1  4D            		LD	C,L		;_FATIX
  E8C2                	L_F16S3:
  E8C2  29            		ADD	HL,HL
  E8C3  87            		ADD	A,A
  E8C4  CB5F          		BIT	3,A
  E8C6  28FA          		JR	Z,L_F16S3
                      	
  E8C8  19            		ADD	HL,DE
  E8C9  EB            		EX	DE,HL
                      	
  E8CA  79            		LD	A,C		;_FATIX
  E8CB  DD6E00        		LD	L,(IX+0)	;DPB_00_FATLN
  E8CE  2D            		DEC	L		;DPB_00_FATLN-1
  E8CF  AD            		XOR	L		;Lと同じか比較してCFを0に
  E8D0  2005          		JR	NZ,F16E		;FATバッファが最後の場合はFATセクタ数を調整
  E8D2  7D            		LD	A,L		;DPB_00_FATLN-1
  E8D3  05            		DEC	B
  E8D4  A0            		AND	B
  E8D5  47            		LD	B,A
  E8D6  04            		INC	B
  E8D7                	F16E:
  E8D7  2A7CEC        		LD	HL,(_FATBF)
  E8DA  C9            		RET
                      	
  E8DB                	CHGDRV:
  E8DB  E5            		PUSH	HL
  E8DC  2189EC        		LD	HL,_DSK
  E8DF  BE            		CP	(HL)
  E8E0  280A          		JR	Z,CHGDRVE
  E8E2                	CHGDRV1:
  E8E2  DDE5          		PUSH	IX
  E8E4  CDEEE8        		CALL	CHGDRV0
  E8E7  3A89EC        		LD	A,(_DSK)
  E8EA  DDE1          		POP	IX
  E8EC                	CHGDRVE:
  E8EC  E1            		POP	HL
  E8ED  C9            		RET
                      	
  E8EE                	CHGDRV0:
  E8EE  6F            		LD	L,A
  E8EF  CDDCEC        		CALL	_GETDPB
  E8F2  D8            		RET	C
  E8F3  DD22A8EC      		LD	(_DPB),IX
  E8F7  7D            		LD	A,L
  E8F8  3289EC        		LD	(_DSK),A
  E8FB                	CHGDRV2:
  E8FB  F3            		DI
  E8FC  C5            		PUSH	BC
  E8FD  D5            		PUSH	DE
  E8FE  ED7363E9      		LD	(SPPAT2+1),SP
                      	
  E902  DDF9          		LD	SP,IX
                      	
  E904  E1            		POP	HL		;DPB_00_FATLN
  E905  E1            		POP	HL		;DPB_02_DRD
  E906  2239E8        		LD	(DRDPAT+1),HL
                      	
  E909  E1            		POP	HL
  E90A  225AE8        		LD	(DWTPAT+1),HL	;DPB_04_DWT
                      	
  E90D  E1            		POP	HL		;L=DPB_06_FATID H=DPB_07_SECPCL
  E90E  7C            		LD	A,H
  E90F  3292DF        		LD	(SPCPAT+1),A	;1クラスタの論理セクタ数
  E912  3D            		DEC	A
  E913  32E8E6        		LD	(NCPAT+1),A
                      	
  E916  E1            		POP	HL		;DPB_08_MAXCL
  E917  7D            		LD	A,L
  E918  32B1DF        		LD	(CLPAT2+1),A
  E91B  7C            		LD	A,H
  E91C  32ADDF        		LD	(CLPAT1+1),A
  E91F  2B            		DEC	HL
  E920  22B5E1        		LD	(MAXCLP+1),HL
                      	
  E923  E1            		POP	HL		;L=DPB_0A_FDMODE H=DPB_0B_DIRSCNT
  E924  7D            		LD	A,L
  E925  F6FE          		OR	0FEH
  E927  3268EA        		LD	(FDMODE+1),A
  E92A  07            		RLCA
  E92B  E603          		AND	3
  E92D  3250EA        		LD	(FSPAT+1),A
  E930  4C            		LD	C,H
                      	
  E931  E1            		POP	HL		;L=DPB_0C_MAXCYL H=DPB_0D_MAXSEC
  E932  7D            		LD	A,L
  E933  32A1EC        		LD	(_MAXCYL),A
  E936  7C            		LD	A,H
  E937  32F9E9        		LD	(MAXSEC+1),A
                      	
  E93A  E1            		POP	HL		;L=DPB_0E_FATPS H=DPB_0F_BPS
  E93B  7C            		LD	A,H		;DPB_0F_BPS
  E93C  E607          		AND	7
  E93E  32F5E4        		LD	(SECSZ+2),A	;1セクタのサイズの上位1バイト 0x400 - 0x200 - 0x100
  E941  3D            		DEC	A		;1セクタ512 2D/2DD/2HC/2HQ(2HD1.44MB)等
                      					;1セクタ1024 2HD/EMM/BRAM
                      					;1セクタ256 GRAM等
                      					;1024	512	256
  E942  32ADDE        		LD	(SECSZM1+2),A	;3	1	0	1セクタのサイズ-1したものの上位1バイト (0x3FF - 0x1FF - 0xFF)
  E945  3C            		INC	A		;4	2	1
  E946  87            		ADD	A,A		;8	4	2
  E947  87            		ADD	A,A		;010H	8	4
  E948  87            		ADD	A,A		;020H	010H	8
  E949  3202DE        		LD	(SDECPAT+1),A	;1セクタ辺りのディレクトリエントリ数
  E94C  3D            		DEC	A		;01FH	00FH	7
  E94D  3268D4        		LD	(SDECM1+1),A	;1セクタ辺りのディレクトリエントリ数-1
                      	
  E950  2600          		LD	H,0
  E952  22FAEB        		LD	(_FATPS),HL
                      	
  E955  E1            		POP	HL		;L=DPB_10_DIRPS
  E956  22FCEB        		LD	(_DIRPS),HL
                      	
  E959  E1            		POP	HL		;L=DPB_12_DEVICE H=DPB_13_UNITNO
  E95A  7C            		LD	A,H
  E95B  3284EC        		LD	(_DRIVE),A
                      	
  E95E  E1            		POP	HL		;DPB_14_ADDCL16
  E95F  22A2DF        		LD	(CLSPAT+1),HL
                      	
  E962  310000        	SPPAT2:	LD	SP,0		;元のSPを復元
  E965  FB            		EI
  E966  2AFCEB        		LD	HL,(_DIRPS)
  E969  0600          		LD	B,0
  E96B  09            		ADD	HL,BC
  E96C  221DDE        		LD	(MD_PAT+1),HL
                      	
  E96F  2AB5E1        		LD	HL,(MAXCLP+1);
  E972  11F60F        		LD	DE,4086
  E975  B7            		OR	A
  E976  ED52          		SBC	HL,DE
  E978  300F          		JR	NC,SETFAT16
  E97A  216EE6        		LD	HL,GNCL		;FAT12
  E97D  1191E6        		LD	DE,SNCL
  E980  018EE8        		LD	BC,FATSETUP12
  E983  DDCB0FAE      		RES	5,(IX+00FH)	;DPB_0F_BPS(FAT12)
  E987  180D          		JR	EXTRA1
  E989                	SETFAT16:
  E989  21C5E6        		LD	HL,GNCL16	;FAT16
  E98C  11D2E6        		LD	DE,SNCL16
  E98F  01B0E8        		LD	BC,FATSETUP16
  E992  DDCB0FEE      		SET	5,(IX+00FH)	;DPB_0F_BPS(FAT16)
  E996                	EXTRA1:
  E996  22F8EC        		LD	(GNCPAT+1),HL
  E999  ED53FBEC      		LD	(SNCPAT+1),DE
  E99D  ED438CE8      		LD	(FATSX+1),BC
  E9A1  D1            		POP	DE
  E9A2  C1            		POP	BC
  E9A3  AF            		XOR	A
  E9A4  C9            		RET
                      	
  E9A5                	GETDPBD:
  E9A5  DDE3          		EX	(SP),IX
  E9A7  DDE5          		PUSH	IX
  E9A9  3A88EC        		LD	A,(_DRV)
  E9AC  1807          		JR	GETDPB1
                      	
  E9AE                	CHGDRVR:
  E9AE  CDD9EC        		CALL	_CHGDRV
  E9B1  D8            		RET	C
  E9B2  3A89EC        		LD	A,(_DSK)
  E9B5                	GETDPB1:
  E9B5  C3DCEC        		JP	_GETDPB
                      	
  E9B8                	GETDPB:
  E9B8  FE08          		CP	8
  E9BA  3F            		CCF
  E9BB  D8            		RET	C
  E9BC  0F            		RRCA
  E9BD  0F            		RRCA
  E9BE  0F            		RRCA
  E9BF  DD            		DB	0DDH		;Z80未定義命令
  E9C0  6F            		LD	L,A		;LD	IXL,A
  E9C1  DD            		DB	0DDH		;Z80未定義命令
  E9C2  26ED          		LD	H,DEVICE/256	;LD	IXH,DEVICE/256
  E9C4  DD7E00        		LD	A,(IX+0)	;DPB_00_FATLN
  E9C7  B7            		OR	A		;CF=0の為
  E9C8  DDCB0F76      		BIT	6,(IX+00FH)	;DPB_0F_BPS
  E9CC  C0            		RET	NZ		;FAT16
  E9CD  DDCB126E      		BIT	5,(IX+012H)	;DPB_12_DEVICE
  E9D1  C0            		RET	NZ		;BPB
  E9D2  FE01          		CP	001H		;A=0 THEN CF=1
  E9D4  C9            		RET
                      	
  E9D5                	FFLUSH:
  E9D5  F5            		PUSH	AF
  E9D6  3EFF          		LD	A,0FFH
  E9D8  3281E2        		LD	(SFILE),A
  E9DB  CDB8E5        		CALL	DWTX
  E9DE  3EFF          		LD	A,0FFH
  E9E0  32A5EC        		LD	(_DBDRV),A
  E9E3  CD02E6        		CALL	WTFATX
  E9E6  AF            		XOR	A
  E9E7  32ABEC        		LD	(_FATIX),A
  E9EA  2F            		CPL
  E9EB  32AAEC        		LD	(_FATDRV),A
  E9EE  F1            		POP	AF
  E9EF  C9            		RET
                      	
                      	
                      	;LDDISK.ASM
                      	
                      	;	LSX-Dodgers DISK
                      	
                      	
  E9F0                	SEEK:
  E9F0  7A            		LD	A,D
  E9F1  B3            		OR	E
  E9F2  3E01          		LD	A,001H
  E9F4  2811          		JR	Z,DIV3
                      	
  E9F6  0610          		LD	B,16
  E9F8  0E00          	MAXSEC:	LD	C,000H
  E9FA  AF            		XOR	A
  E9FB  EB            		EX	DE,HL
  E9FC                	DIV1:
  E9FC  29            		ADD	HL,HL
  E9FD  8F            		ADC	A,A
  E9FE  B9            		CP	C
  E9FF  3802          		JR	C,DIV2
  EA01  91            		SUB	C
  EA02  2C            		INC	L
  EA03                	DIV2:
  EA03  10F7          		DJNZ	DIV1
                      	
  EA05  3C            		INC	A	;最小のセクタは１固定
  EA06  55            		LD	D,L	;Quotient(TRACK)
  EA07                	DIV3:
  EA07  5F            		LD	E,A	;Remainder
  EA08  CB3A          		SRL	D	;CYLINDER
  EA0A  9F            		SBC	A,A
  EA0B  E610          		AND	010H	;SIDE
  EA0D  4F            		LD	C,A
                      	
  EA0E  3A84EC        		LD	A,(_DRIVE)
  EA11  FE04          		CP	4
  EA13  3F            		CCF
  EA14  D8            		RET	C
  EA15  B1            		OR	C
  EA16  3294EA        		LD	(MOPAT+1),A	;Motor off data
  EA19  01FC0F        		LD	BC,00FFCH
  EA1C  F680          		OR	080H		;Mortor on
  EA1E  ED79          		OUT	(C),A
                      	
  EA20  CD66EA        		CALL	SETMODE
  EA23  D8            		RET	C
                      	
  EA24  CDA9EA        		CALL	DRIVE
  EA27  FEFF          		CP	0FFH		;A=0FFH Unknown CYLINDER
  EA29  CC88EA        		CALL	Z,FDCRES	;Restore
  EA2C  0EF9          		LD	C,0F9H
  EA2E  ED79          		OUT	(C),A		;Currrent CYLINDER
  EA30  92            		SUB	D
  EA31  C8            		RET	Z		;No seek
                      	
  EA32  3A86EC        		LD	A,(_ISEEK)
  EA35  4F            		LD	C,A
                      	
  EA36  3AA1EC        		LD	A,(_MAXCYL)	;Max CYLINDER
  EA39  3D            		DEC	A
  EA3A  BA            		CP	D		;Over CYLINDER
  EA3B  D8            		RET	C
                      	
  EA3C  B9            		CP	C		;for Built-in 2DD
  EA3D  3803          		JR	C,SETM2
  EA3F  78            		LD	A,B		;B=00FH
  EA40  DBFE          		IN	A,(0FEH)		;2HD mode for 2DD seek
  EA42                	SETM2:
  EA42  78            		LD	A,B
  EA43  DBFD          		IN	A,(0FDH)		;MFM mode
                      	
  EA45  0EFB          		LD	C,0FBH
  EA47  ED51          		OUT	(C),D
  EA49  72            		LD	(HL),D
  EA4A  0E18          		LD	C,018H		;Seek
  EA4C                	FDCCMD2:
  EA4C  3A85EC        		LD	A,(_SEEKSP)
  EA4F  E6FF          	FSPAT:	AND	0FFH
  EA51  B1            		OR	C
                      	
  EA52                	FDCCMD:
  EA52  CD9FEA        		CALL	COMSET
                      	
  EA55  3E80          	FDCPAT:	LD	A,080H		;FDC COMMAND(Self-rewriting)
  EA57  E620          		AND	020H		;Write data Write track
  EA59  3C            		INC	A
                      	
  EA5A                	SST:
  EA5A  0E00          		LD	C,0
  EA5C                	SST1:
  EA5C  0D            		DEC	C		; 4
  EA5D  20FD          		JR	NZ,SST1		;12 * 256 / 4 = About 1ms
  EA5F  3D            		DEC	A
  EA60  20FA          		JR	NZ,SST1
                      	
  EA62  3C            		INC	A		;A=1
  EA63  CD71EA        		CALL	READY
  EA66                	SETMODE:
  EA66  78            		LD	A,B		;B=00FH
  EA67  DBFF          	FDMODE:	IN	A,(0FFH)		;Floppy mode(2D/2HD) (Self-rewriting)
                      	
  EA69  78            		LD	A,B
  EA6A  DBFD          		IN	A,(0FDH)		;MFM mode
                      	
  EA6C  CDA3EA        		CALL	DELAY0		;Head select time
  EA6F  3E81          		LD	A,081H
  EA71                	READY:
  EA71  327BEA        		LD	(WAITA+1),A
  EA74  E5            		PUSH	HL
  EA75  0EF8          		LD	C,0F8H
  EA77  61            		LD	H,C
  EA78                	READY2:
  EA78  ED78          		IN	A,(C)
  EA7A  E681          	WAITA:	AND	081H		;NOT READY,BUSY
  EA7C  2808          		JR	Z,READYE
  EA7E  E3            		EX	(SP),HL		;wait 19clock
  EA7F  E3            		EX	(SP),HL		; //
  EA80  2B            		DEC	HL
  EA81  7C            		LD	A,H
  EA82  B5            		OR	L
  EA83  20F3          		JR	NZ,READY2
  EA85  37            		SCF
  EA86                	READYE:
  EA86  E1            		POP	HL
  EA87  C9            		RET
                      	
  EA88                	FDCRES:
  EA88  3600          		LD	(HL),0
  EA8A  0E08          		LD	C,8
  EA8C  18BE          		JR	FDCCMD2
                      	
  EA8E                	FDMOFF:
  EA8E  F5            		PUSH	AF
  EA8F  C5            		PUSH	BC
  EA90  01FC0F        		LD	BC,00FFCH	;Motor off
  EA93  3E00          	MOPAT:	LD	A,000H		;(Self-rewriting)
  EA95  ED79          		OUT	(C),A
  EA97  C1            		POP	BC
  EA98  F1            		POP	AF
  EA99  C9            		RET
                      	
  EA9A                	SECSET:
  EA9A  01FA0F        		LD	BC,00FFAH
  EA9D  ED59          		OUT	(C),E
  EA9F                	COMSET:
  EA9F  0EF8          		LD	C,0F8H
  EAA1  ED79          		OUT	(C),A
  EAA3                	DELAY0:
  EAA3  3E1A          		LD	A,26
  EAA5                	DELAY:
  EAA5  3D            		DEC	A
  EAA6  20FD          		JR	NZ,DELAY
  EAA8  C9            		RET
                      	
  EAA9                	DRIVE:
  EAA9  2A84EC        		LD	HL,(_DRIVE)
  EAAC  26EC          		LD	H,_CYL0/256
  EAAE  CBFD          		SET	7,L
  EAB0  7E            		LD	A,(HL)
  EAB1  C9            		RET
                      	
  EAB2                	RNF:
  EAB2  CDA9EA        		CALL	DRIVE
  EAB5  36FF          		LD	(HL),0FFH
  EAB7  C9            		RET
                      	
  EAB8  02            	RETRY:	DB	2
                      	
                      	
                      	;	FLOPPY DISK DRIVER(DMA)
                      	
                      	
  EAB9                	WTTRK:
  EAB9  3EF4          		LD	A,0F4H
  EABB  1802          		JR	WTTRK1
  EABD                	FDWT:
  EABD  3EA0          		LD	A,0A0H
  EABF                	WTTRK1:
  EABF  3256EA        		LD	(FDCPAT+1),A
  EAC2  3E10          		LD	A,16
  EAC4  1807          		JR	DISK
                      	
  EAC6                	FDRD:
  EAC6  3E80          		LD	A,080H
  EAC8  3256EA        		LD	(FDCPAT+1),A
  EACB  3E0E          		LD	A,14
                      	
  EACD                	DISK:
  EACD  32E0EA        		LD	(DMAPAT+1),A
                      	
  EAD0  226BEB        		LD	(DMAD+11),HL
  EAD3                	DISKR:
  EAD3  3E02          		LD	A,2		;Retry count
  EAD5  32B8EA        		LD	(RETRY),A
  EAD8                	DISK2:
  EAD8  D5            		PUSH	DE
  EAD9  CDF0E9        		CALL	SEEK
  EADC  3842          		JR	C,ERRF
  EADE  F3            		DI
                      	
  EADF  3E0E          	DMAPAT:	LD	A,14		;自己書き換え
  EAE1  2160EB        		LD	HL,DMAD
  EAE4  CD56EB        		CALL	SETDMA
  EAE7  ED49          		OUT	(C),C		;OUT 01F87H,087H
  EAE9  3A56EA        		LD	A,(FDCPAT+1)
  EAEC  C5            		PUSH	BC
  EAED  CD9AEA        		CALL	SECSET
  EAF0  2A6BEB        		LD	HL,(DMAD+11)
  EAF3  23            		INC	HL
  EAF4  1106BB        		LD	DE,0BB06H	;READ DMA
                      	
  EAF7  3E03          		LD	A,3
  EAF9  CD71EA        		CALL	READY
  EAFC  ED78          		IN	A,(C)
                      	
  EAFE  C1            		POP	BC
  EAFF  ED51          		OUT	(C),D
  EB01  ED59          		OUT	(C),E
  EB03  ED58          		IN	E,(C)
  EB05  ED50          		IN	D,(C)
  EB07  19            		ADD	HL,DE
  EB08  D1            		POP	DE
  EB09  13            		INC	DE
  EB0A  FB            		EI
  EB0B  CD8EEA        		CALL	FDMOFF
  EB0E  B7            		OR	A
  EB0F  C8            		RET	Z
  EB10  1B            		DEC	DE
  EB11  CB67          		BIT	4,A
  EB13  C4B2EA        		CALL	NZ,RNF
  EB16                	DISKE2:
  EB16  21B8EA        		LD	HL,RETRY
  EB19  35            		DEC	(HL)
  EB1A  20BC          		JR	NZ,DISK2
  EB1C  B7            		OR	A
  EB1D  2834          		JR	Z,ERR
  EB1F  D5            		PUSH	DE
  EB20                	ERRF:
  EB20  D1            		POP	DE
  EB21                	DELP:
  EB21  CDB2EA        		CALL	RNF
  EB24  CD8EEA        		CALL	FDMOFF
  EB27  3A85EC        		LD	A,(_SEEKSP)
  EB2A  87            		ADD	A,A
  EB2B  9F            		SBC	A,A
  EB2C  3825          		JR	C,ERR
  EB2E                	DELP1:
  EB2E  D5            		PUSH	DE
  EB2F  21C0EB        		LD	HL,DEMES
  EB32  CD5DD8        		CALL	MSX
  EB35  CD48D7        		CALL	KEYBC
  EB38                	DELP2:
  EB38  CDCAEC        		CALL	_INKEY
  EB3B  28FB          		JR	Z,DELP2
                      	
  EB3D  D1            		POP	DE
  EB3E  CDB3DF        		CALL	CAP
  EB41  FE52          		CP	'R'		;Retry
  EB43  CAD3EA        		JP	Z,DISKR
  EB46  FE49          		CP	'I'		;Ignore
  EB48  2807          		JR	Z,IGNORE
  EB4A  FE41          		CP	'A'		;Abort
  EB4C  20E0          		JR	NZ,DELP1
  EB4E  C362D3        		JP	BOOT
  EB51                	IGNORE:
  EB51  3EFF          		LD	A,0FFH
  EB53                	ERR:
  EB53  BF            		CP	A
  EB54  37            		SCF
  EB55  C9            		RET
                      	
  EB56                	SETDMA:
  EB56  01871F        		LD	BC,01F87H
  EB59                	SDMA:
  EB59  04            		INC	B
  EB5A  EDA3          		OUTI
  EB5C  3D            		DEC	A
  EB5D  20FA          		JR	NZ,SDMA
  EB5F  C9            		RET
                      	
  EB60  C37DFB0FFFFF2C	DMAD:	DB	0C3H,07DH,0FBH,00FH,0FFH,0FFH,02CH,010H		;X1turbo
  EB68  80928D0000CF01		DB	080H,092H,08DH,000H,000H,0CFH,001H,0CFH		;DISK DMA
                      	
  EB70                	DMAE:
                      	
  2006                	AT_R	EQU	WTTRK-AT_WTTRK
                      	
                      	;LDCALL.ASM
                      	
                      	;	LSX-Dodgers TABLES
                      	
  EB70  008E01000B000C	BEEPD:	DB	0,08EH,1,0,00BH,0,00CH,010H
  EB78  073E08100D00FF		DB	007H,03EH,008H,010H,00DH,0,0FFH
                      	
  EB7F  00            	CHECK:	DB	0
                      	
                      	;	CTRLTB:アドレス下位1バイトが080Hになるように
                      	
  EB80                	CTRLTB:
  EB80  8CD927DAC4D917		DW	PRINTE,CTRL01,CTRL02,CTRL03
  EB88  11DBEFD9F0DA77		DW	CTRL04,CTRL05,CTRL1A,CTRL07
  EB90  98D9B5D91ADB2D		DW	CTRL08,CTRL09,CTRL0A,CTRL0B
  EB98  EDDA13DA2FDB8C		DW	CTRL0C,CTRL0D,CTRL0E,PRINTE
  EBA0  8CD98CD927DA8C		DW	PRINTE,PRINTE,CTRL01,PRINTE
  EBA8  8CD98CD98CD98C		DW	PRINTE,PRINTE,PRINTE,PRINTE
  EBB0  8CD98CD9F0DA3A		DW	PRINTE,PRINTE,CTRL1A,CTRL1B
  EBB8  AFD998D9A2D91A		DW	CTRL1C,CTRL1D,CTRL1E,CTRL1F
                      	
  EBC0  0307          	DEMES:	DB	3,7
  EBC2  44657669636520		DB	"Device I/O Error",5,3
  EBD4  41626F72742052		DB	"Abort Retry Ignore?",5,3,0
                      	
  EBEA  1617          	SDDATA:	DB	22,23		;(FCB)ファイルを最後に変更した時刻
  EBEC  1415          		DB	20,21		;(FCB)ファイルを最後に変更した日付
  EBEE  1A1B          		DB	26,27		;(FCB)ファイルの先頭クラスタ
  EBF0  10111213      		DB	16,17,18,19	;(FCB)ファイルのサイズ(バイト単位)
  EBF4                	SDDATAE:
                      	
  EBF4                	SCDIR:	DS	2		;+14 +15
  EBF6                	SFBPS:	DS	2		;FBPS
  EBF8                	SFNDF:	DS	2		;FILEN DIRF
                      	
  EBFA  0000          	_FATPS:	DW	0
  EBFC  0000          	_DIRPS:	DW	0
  EBFE  0000          	_CLPS:	DW	0
                      	
  EC00                	_PE:
                      	
                      	;	LSX-Dodgers SYSTEM CALL
                      	;	STABLE:アドレス下位1バイトが0になるように
                      	
  EC00                	STABLE:
                      	;0
  EC00  00007CD788D7A4		DW	 00000H,_SYS01,_SYS02,_SYS03
  EC08  A2D3A2D38DD76B		DW	_SYS04,_SYS05,_SYS06,_SYS07
  EC10  95D7A7D3CED7FA		DW	_SYS08,_SYS09,_SYS0A,_SYS0B
  EC18  B6D3BCD3CBD3DE		DW	_SYS0C,_SYS0D,_SYS0E,_SYS0F
                      	;1
  EC20  33D488D4EAD420		DW	_SYS10,_SYS11,_SYS12,_SYS13
  EC28  28D546D563D55B		DW	_SYS14,_SYS15,_SYS16,_SYS17
  EC30  C4D5C9D5CED5D4		DW	_SYS18,_SYS19,_SYS1A,_SYS1B
  EC38  A2D3FAD5A2D3FE		DW	_SYS1C,_SYS1D,_SYS1E,_SYS1F
                      	;2
  EC40  A2D39AD5AFD505		DW	_SYS20,_SYS21,_SYS22,_SYS23
  EC48  24D6A2D3DBE202		DW	_SYS24,_ERROR,_SYS26,_SYS27
  EC50  AFD52DD610D8A4		DW	_SYS28,_SYS29,_SYS2A,_SYS2B
  EC58  44D8A4D3A2D350		DW	_SYS2C,_SYS2D,_SYS2E,_SYS2F
                      	;3
  EC60  4AD6          		DW	_SYS30
                      	
                      	;LDWORK.ASM
                      	
                      	;	LSX-Dodgers WORK
                      	
  0004                	DDS	EQU	4
  EC62                	DDTB:
  EC62  434F4E20      		DB	"CON "
  EC66  7BD4          		DW	OPENDD
  EC68  41555820      		DB	"AUX "
  EC6C  7BD4          		DW	OPENDD
  EC6E  50524E20      		DB	"PRN "
  EC72  7BD4          		DW	OPENDD
  EC74  4E554C20      		DB	"NUL "
  EC78  7BD4          		DW	OPENDD
                      	
  EC7A                		DS	2
  EC7C  00EE          	_FATBF:	DW	FATBF
  EC7E  00FA          	_DTBUF:	DW	DTBUF
                      	
                      	;	_CYL0:アドレス下位1バイトが080Hになるように
  EC80  FF            	_CYL0:	DB	0FFH	;Cylinder
  EC81  FF            	_CYL1:	DB	0FFH	;Cylinder
  EC82  FF            	_CYL2:	DB	0FFH	;Cylinder
  EC83  FF            	_CYL3:	DB	0FFH	;Cylinder
  EC84  00            	_DRIVE:	DB	0	;unit number
  EC85  00            	_SEEKSP:DB	0	;Seek speed
  EC86  FF            	_ISEEK:	DB	0FFH	;
  EC87  00            	_DVSW:	DB	0
  EC88  00            	_DRV:	DB	0
  EC89  FF            	_DSK:	DB	0FFH
  EC8A  8000          	_DTA:	DW	00080H
  EC8C  0000          	_CTC:	DW	0
  EC8E  0000          	_TXADR:	DW	0
  EC90  0000          	_KEYPS	DW	0
  EC92  00FF          	_KEYD	DW	0FF00H
  EC94  C210          	_KEYSP:	DW	010C2H
  EC96  07            	_COLORF:DB	7
  EC97  19            	_LINE:	DB	LINE
                      	
  EC98  0000          	_FCB:	DW	0
  EC9A  0000          	_FBPS:	DW	0	;SEARCH FILES
  EC9C  0000          	_FBAD:	DW	0	;    //
  EC9E  00            	_FBCNT:	DB	0	;    //
  EC9F  00            	_FILEN:	DB	0
  ECA0  00            	_DIRF:	DB	0	;bit7:ディレクトリ bit0-6:セクタインデックス 
  ECA1  00            	_MAXCYL:DB	0
  ECA2  00            	_WTFATF:DB	0	;FATバッファの更新フラグ
  ECA3                			DS	1
  ECA4  00            	_WTDBF:	DB	0	;データバッファの更新フラグ
  ECA5  FF            	_DBDRV:	DB	0FFH	;データバッファにあるデータを読み込んだドライブ
  ECA6  0000          	_DBSEC:	DW	0	;データバッファにあるデータを読み込んだセクタ番号
  ECA8  0000          	_DPB:	DW	0
  ECAA  FF            	_FATDRV:DB	0FFH	;FATバッファに読み込んでいるドライブ
  ECAB  00            	_FATIX:	DB	0	;FATバッファに読み込んでいるインデックス
  ECAC  0000          	_FAKEFREE:	DW	0	;偽の残量（FATサイズが大きくなると重くなるのでその対策）
                      	
  ECAE                		DS	2
                      	
  ECB0  6F5059381F0219	CRTCD:	DB	06FH,050H,059H,038H,01FH,002H,019H,01CH
  ECB8  0007          		DB	000H,007H
  ECBA  30F8B0FF      		DW	0-80*LINE,0-80
  ECBE  0C            		DB	00CH
  ECBF  A0            	WK1FD0:	DB	0A0H
                      	
  ECC0  B2D6          	CTC0:	DW	INTCTCE
  ECC2  B2D6          	CTC1:	DW	INTCTCE
  ECC4  D4D6          	CTC2:	DW	INTCTC2
  ECC6  B2D6          	CTC3:	DW	INTCTCE
  ECC8  99D6          	INTVEC:	DW	INT
                      	
                      	;	JUMP
                      	
  ECCA  C368DC        	_INKEY:	JP	INKEY
  ECCD  C3D5D8        	_PRINT:	JP	PRINT
  ECD0  C3B3DB        	_SCRN:	JP	SCRN
  ECD3  C3DBDB        	_POS:	JP	POS
  ECD6  C318DA        	_LOC:	JP	LOC
  ECD9  C3DBE8        	_CHGDRV:JP	CHGDRV
  ECDC  C3B8E9        	_GETDPB:JP	GETDPB
  ECDF  C3D5E9        	_FFLUSH:JP	FFLUSH
  ECE2  C3D8E5        	_RDFATX:JP	RDFATX
  ECE5  C3F4E6        	_RDFAT:	JP	RDFAT
  ECE8  C3B9EA        	_WTTRK:	JP	WTTRK
  ECEB  C3C6EA        	_FDRD:	JP	FDRD
  ECEE  C3BDEA        	_FDWT:	JP	FDWT
  ECF1  C32EE8        	_DRD:	JP	DRD16
  ECF4  C34FE8        	_DWT:	JP	DWT16
  ECF7                	_GNCL:
  ECF7  C36EE6        	GNCPAT:	JP	GNCL		;自己書き換え
  ECFA                	_SNCL:
  ECFA  C391E6        	SNCPAT:	JP	SNCL		;自己書き換え
  ECFD  C3BECC        	_COMANL:JP	COMANL
                      	
  ED00                	WE:
                      	
                      	;LDDPB.ASM
                      	
                      	;	LSX-Dodgers DPB
                      	
  ED00                	DEVICE:
                      	
                      	;	A:
                      	
  ED00  0200          		DW	2	;DPB_00_FATLN
  ED02  EBEC          		DW	_FDRD	;DPB_02_DRD
  ED04  EEEC          		DW	_FDWT	;DPB_04_DWT
  ED06  FD            		DB	0FDH	;DPB_06_FATID
  ED07  02            		DB	2	;DPB_07_SECPCL
  ED08  6401          		DW	356	;DPB_08_MAXCL
  ED0A  FF            		DB	0FFH	;DPB_0A_FDMODE	0FFH=2D / 0FEH=2HD
  ED0B  07            		DB	7	;DPB_0B_DIRSCNT
  ED0C  28            		DB	40	;DPB_0C_MAXCYL
  ED0D  09            		DB	9	;DPB_0D_MAXSEC	Number of sectors
  ED0E  01            		DB	1	;DPB_0E_FATPS
  ED0F  82            		DB	082H	;DPB_0F_BPS
  ED10  0500          		DW	5	;DPB_10_DIRPS
  ED12  A7            		DB	0A7H	;DPB_12_DEVICE	Device Number
  ED13  00            		DB	0	;DPB_13_UNITNO
  ED14  0800          		DW	8	;DPB_14_ADDCL16
  ED16  0000          		DW	0	;DPB_16
  ED18  0000          		DW	0	;DPB_18
  ED1A  0000          		DW	0	;DPB_1A_SDIR
  ED1C  46444430      		DB	"FDD0"	;DPB_1C_NAME
                      	
                      	;	B:
                      	
  ED20  0200          		DW	2	;DPB_00_FATLN
  ED22  EBEC          		DW	_FDRD	;DPB_02_DRD
  ED24  EEEC          		DW	_FDWT	;DPB_04_DWT
  ED26  FD            		DB	0FDH	;DPB_06_FATID
  ED27  02            		DB	2	;DPB_07_SECPCL
  ED28  6401          		DW	356	;DPB_08_MAXCL
  ED2A  FF            		DB	0FFH	;DPB_0A_FDMODE	0FFH=2D / 0FEH=2HD
  ED2B  07            		DB	7	;DPB_0B_DIRSCNT
  ED2C  28            		DB	40	;DPB_0C_MAXCYL
  ED2D  09            		DB	9	;DPB_0D_MAXSEC	Number of sectors
  ED2E  01            		DB	1	;DPB_0E_FATPS
  ED2F  82            		DB	082H	;DPB_0F_BPS
  ED30  0500          		DW	5	;DPB_10_DIRPS
  ED32  A7            		DB	0A7H	;DPB_12_DEVICE	Device Number
  ED33  01            		DB	1	;DPB_13_UNITNO
  ED34  0800          		DW	8	;DPB_14_ADDCL16
  ED36  0000          		DW	0	;DPB_16
  ED38  0000          		DW	0	;DPB_18
  ED3A  0000          		DW	0	;DPB_1A_SDIR
  ED3C  46444431      		DB	"FDD1"	;DPB_1C_NAME
                      	
                      	;	C:
                      	
  ED40  0200          		DW	2	;DPB_00_FATLN
  ED42  EBEC          		DW	_FDRD	;DPB_02_DRD
  ED44  EEEC          		DW	_FDWT	;DPB_04_DWT
  ED46  FD            		DB	0FDH	;DPB_06_FATID
  ED47  02            		DB	2	;DPB_07_SECPCL
  ED48  6401          		DW	356	;DPB_08_MAXCL
  ED4A  FF            		DB	0FFH	;DPB_0A_FDMODE	0FFH=2D / 0FEH=2HD
  ED4B  07            		DB	7	;DPB_0B_DIRSCNT
  ED4C  28            		DB	40	;DPB_0C_MAXCYL
  ED4D  09            		DB	9	;DPB_0D_MAXSEC	Number of sectors
  ED4E  01            		DB	1	;DPB_0E_FATPS
  ED4F  82            		DB	082H	;DPB_0F_BPS
  ED50  0500          		DW	5	;DPB_10_DIRPS
  ED52  A7            		DB	0A7H	;DPB_12_DEVICE	Device Number
  ED53  02            		DB	2	;DPB_13_UNITNO
  ED54  0800          		DW	8	;DPB_14_ADDCL16
  ED56  0000          		DW	0	;DPB_16
  ED58  0000          		DW	0	;DPB_18
  ED5A  0000          		DW	0	;DPB_1A_SDIR
  ED5C  46444432      		DB	"FDD2"	;DPB_1C_NAME
                      	
                      	;	D:
                      	
  ED60  0200          		DW	2	;DPB_00_FATLN
  ED62  EBEC          		DW	_FDRD	;DPB_02_DRD
  ED64  EEEC          		DW	_FDWT	;DPB_04_DWT
  ED66  FD            		DB	0FDH	;DPB_06_FATID
  ED67  02            		DB	2	;DPB_07_SECPCL
  ED68  6401          		DW	356	;DPB_08_MAXCL
  ED6A  FF            		DB	0FFH	;DPB_0A_FDMODE	0FFH=2D / 0FEH=2HD
  ED6B  07            		DB	7	;DPB_0B_DIRSCNT
  ED6C  28            		DB	40	;DPB_0C_MAXCYL
  ED6D  09            		DB	9	;DPB_0D_MAXSEC	Number of sectors
  ED6E  01            		DB	1	;DPB_0E_FATPS
  ED6F  82            		DB	082H	;DPB_0F_BPS
  ED70  0500          		DW	5	;DPB_10_DIRPS
  ED72  A7            		DB	0A7H	;DPB_12_DEVICE
  ED73  03            		DB	3	;DPB_13_UNITNO
  ED74  0800          		DW	8	;DPB_14_ADDCL16
  ED76  0000          		DW	0	;DPB_16
  ED78  0000          		DW	0	;DPB_18
  ED7A  0000          		DW	0	;DPB_1A_SDIR
  ED7C  46444433      		DB	"FDD3"	;DPB_1C_NAME
                      	
                      	;	E:
                      	
  ED80  0000          	EMMFL:	DW	0	;DPB_00_FATLN
  ED82  1ED3          	EMMRD:	DW	EDRDC	;DPB_02_DRD
  ED84  1BD3          	EMMWR:	DW	EDWTC	;DPB_04_DWT
  ED86  FE            		DB	0FEH	;DPB_06_FATID
  ED87  01            		DB	1	;DPB_07_SECPCL
  ED88  0000          	EMMCL:	DW	0	;DPB_08_MAXCL
  ED8A  00            		DB	0	;DPB_0A_FDMODE
  ED8B  06            		DB	6	;DPB_0B_DIRSCNT
  ED8C  00            	EMMBL:	DB	0	;DPB_0C_MAXCYL
  ED8D  01            		DB	1	;DPB_0D_MAXSEC
  ED8E  01            		DB	1	;DPB_0E_FATPS
  ED8F  04            		DB	4	;DPB_0F_BPS
  ED90  0500          		DW	5	;DPB_10_DIRPS
  ED92  06            		DB	6	;DPB_12_DEVICE
  ED93  00            	EMMDV:	DB	0	;DPB_13_UNITNO
  ED94  0900          		DW	9	;DPB_14_ADDCL16
  ED96  0000          		DW	0	;DPB_16
  ED98  0000          		DW	0	;DPB_18
  ED9A  0000          		DW	0	;DPB_1A_SDIR
  ED9C  454D4D30      		DB	"EMM0"	;DPB_1C_NAME
                      	
                      	;	F:
                      	
  EDA0  0000          	BANKFL:	DW	0	;DPB_00_FATLN
  EDA2  99D2          		DW	BDRDC	;DPB_02_DRD
  EDA4  BCD2          		DW	BDWTC	;DPB_04_DWT
  EDA6  F9            		DB	0F9H	;DPB_06_FATID
  EDA7  01            		DB	1	;DPB_07_SECPCL
  EDA8  0000          	BANKCL:	DW	0	;DPB_08_MAXCL
  EDAA  00            		DB	0	;DPB_0A_FDMODE
  EDAB  04            		DB	4	;DPB_0B_DIRSCNT
  EDAC  00            		DB	0	;DPB_0C_MAXCYL
  EDAD  01            		DB	1	;DPB_0D_MAXSEC
  EDAE  00            		DB	0	;DPB_0E_FATPS
  EDAF  04            		DB	4	;DPB_0F_BPS
  EDB0  0100          		DW	1	;DPB_10_DIRPS
  EDB2  0B            		DB	00BH	;DPB_12_DEVICE
  EDB3  00            		DB	0	;DPB_13_UNITNO
  EDB4  0300          		DW	3	;DPB_14_ADDCL16
  EDB6  0000          		DW	0	;DPB_16
  EDB8  0000          		DW	0	;DPB_18
  EDBA  0000          		DW	0	;DPB_1A_SDIR
  EDBC  4252414D      		DB	"BRAM"	;DPB_1C_NAME
                      	
                      	;	G:
                      	
  EDC0  0100          		DW	1	;DPB_00_FATLN
  EDC2  6AD2          		DW	GDRD	;DPB_02_DRD
  EDC4  75D2          		DW	GDWT	;DPB_04_DWT
  EDC6  F9            		DB	0F9H	;DPB_06_FATID
  EDC7  04            		DB	4	;DPB_07_SECPCL
  EDC8  3000          		DW	48	;DPB_08_MAXCL
  EDCA  00            		DB	0	;DPB_0A_FDMODE
  EDCB  04            		DB	4	;DPB_0B_DIRSCNT
  EDCC  00            		DB	0	;DPB_0C_MAXCYL
  EDCD  01            		DB	1	;DPB_0D_MAXSEC
  EDCE  00            		DB	0	;DPB_0E_FATPS
  EDCF  01            		DB	1	;DPB_0F_BPS
  EDD0  0400          		DW	4	;DPB_10_DIRPS
  EDD2  05            		DB	5	;DPB_12_DEVICE
  EDD3  01            		DB	1	;DPB_13_UNITNO
  EDD4  0000          		DW	0	;DPB_14_ADDCL16
  EDD6  0000          		DW	0	;DPB_16
  EDD8  0000          		DW	0	;DPB_18
  EDDA  0000          		DW	0	;DPB_1A_SDIR
  EDDC  4752414D      		DB	"GRAM"	;DPB_1C_NAME
                      	
                      	
                      	
  EDE0  00            	LDEND:	DB	0
                      	
  EDE1                		END
