			  Z80 ASSEMBLER - ZASM VER 1.6
                      	;	LSX-Dodgers for X1/turbo/Z
                      	;	Programmed by
                      	;	Gaku (Lovers/Tablacus)
                      	
  C600                	RUN	EQU	0C600h
                      	
  C5F9                		ORG	RUN-7
                      	
                      	;	MSX BINARY HEADER
  C5F9  FE            		DB	0FEH
                      	;	MSX BINARY START ADDRESS
  C5FA  00C6          		DW	RUN
                      	;	MSX BINARY END ADDRESS
  C5FC  E0ED          		DW	LDEND
                      	;	MSX BINARY EXEC ADDRESS
  C5FE  00C6          		DW	RUN
                      	;LDDEF.ASM
                      	
                      	;	LSX-Dodgers DEF
                      	
  1D90                	MAC	EQU	01D90H		;X1
  0001                	VER_1   EQU	1
  0003                	VER_2   EQU	3
  0006                	VER_3   EQU	6
  0136                	VER	EQU	VER_1 * 256 + VER_2 * 16 + VER_3
                      	
  0000                	STACK	EQU	00000H
  0005                	SYSTEM	EQU	00005H
  000F                	JP_HL	EQU	0000FH
  005C                	FCB1	EQU	0005CH
  006C                	FCB2	EQU	0006CH
  0080                	DTA1	EQU	00080H
  00DB                	FDRV	EQU	00100H-37
  00DC                	FNAME	EQU	FDRV+1
  00D6                	DECBF	EQU	FDRV-5
  EE00                	FATBF	EQU	0EE00H
  FA00                	DTBUF	EQU	0FA00H
  FE00                	KEYBF	EQU	0FE00H
  FF00                	KBUF	EQU	0FF00H
  FF51                	DTA	EQU	KBUF+81
  FFD4                	EXTSP	EQU	0FFD4H
  0019                	LINE	EQU	25
                      	
                      	;LDINIT.ASM
                      	
                      	;	LSX-Dodgers INIT
                      	
  C600  C307C6        		JP	START
  C603  901D          	MACHINE:DW	MAC
  C605  3601          	VERSION:DW	VER
                      	
  C607                	START:
  C607  F3            		DI
  C608  ED5E          		IM	2
  C60A  310000        		LD	SP,STACK
  C60D  CD1BC6        		CALL	INIT		;NZならAUTOEXECを実行
  C610  210000        		LD	HL,0
  C613  E5            		PUSH	HL
  C614  C8            		RET	Z
  C615  11A6C9        		LD	DE,AUTOD
  C618  C3FDEC        		JP	_COMANL
                      	
  C61B                	INIT:
  C61B  3E1E          		LD	A,01EH
  C61D  D300          		OUT	(0),A
                      	
  C61F  010000        		LD	BC,0
  C622  ED438CEC      		LD	(_CTC),BC
  C626  01040A        		LD	BC,00A04H
  C629  CD60C9        		CALL	CHKCTC
  C62C  010407        		LD	BC,00704H
  C62F  CD60C9        		CALL	CHKCTC
  C632  01A81F        		LD	BC,01FA8H
  C635  CD60C9        		CALL	CHKCTC
  C638  01A01F        		LD	BC,01FA0H
  C63B  CD60C9        		CALL	CHKCTC
                      	;
  C63E                	INISIO:
  C63E  01911F        		LD	BC,01F91H	;INIT SIO
  C641  1601          		LD	D,1
  C643  ED51          		OUT	(C),D
                      	
  C645  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  C647  0E93          		LD	C,093H
  C649  ED51          		OUT	(C),D
  C64B  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  C64D  0E99          		LD	C,099H		;INIT SIO
  C64F  1601          		LD	D,1
  C651  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  C653  0E9B          		LD	C,09BH
  C655  ED51          		OUT	(C),D
  C657  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
                      	
  C659  0E80          		LD	C,080H		;INIT DMA
  C65B  2106C3        		LD	HL,0C306H
  C65E                	INIDMA:
  C65E  ED61          		OUT	(C),H
  C660  2D            		DEC	L
  C661  20FB          		JR	NZ,INIDMA
                      	
  C663  3EE4          		LD	A,0E4H
  C665  CDBDDA        		CALL	COMOUT
  C668  AF            		XOR	A
  C669  CD97DA        		CALL	OT49SB
                      	
  C66C  3EEC          		LD	A,INTVEC/256
  C66E  ED47          		LD	I,A
                      	
  C670  ED4B8CEC      		LD	BC,(_CTC)
  C674  0B            		DEC	BC
  C675  0B            		DEC	BC
                      	
  C676  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  C678  3EC0          		LD	A,CTC0
  C67A  ED79          		OUT	(C),A
                      	
  C67C  0C            		INC	C
  C67D  3E47          		LD	A,047H
  C67F  ED79          		OUT	(C),A
  C681  3E0D          		LD	A,13		;Baudrate 9600-13
  C683  ED79          		OUT	(C),A
                      	
  C685  79            		LD	A,C
  C686  D610          		SUB	010H
  C688  4F            		LD	C,A
                      	;	LD	(SIOAD+1),BC
                      	;	LD	(SIOAD0+1),BC
                      	;	LD	(SIOAD1+1),BC
                      	
  C689  2108CA        		LD	HL,SIODATA
  C68C                	SINIT1:
  C68C  7E            		LD	A,(HL)
  C68D  23            		INC	HL
  C68E  FEFF          		CP	0FFH
  C690  2804          		JR	Z,SINIT2
  C692  ED79          		OUT	(C),A
  C694  18F6          		JR	SINIT1
  C696                	SINIT2:
  C696  3EE4          		LD	A,0E4H
  C698  CDBDDA        		CALL	COMOUT
  C69B  3EC8          		LD	A,INTVEC
  C69D  CD97DA        		CALL	OT49SB
                      	;
  C6A0  01C41F        		LD	BC,01FC4H
  C6A3  3E0C          		LD	A,00CH
  C6A5  ED79          		OUT	(C),A
                      	
  C6A7  0EC0          		LD	C,0C0H
  C6A9  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
                      	
  C6AB  0C            		INC	C
  C6AC  3E28          		LD	A,40
  C6AE  ED79          		OUT	(C),A
                      	
  C6B0  0C            		INC	C
  C6B1  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
                      	
  C6B3  0C            		INC	C
  C6B4  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
                      	
  C6B6  0EC5          		LD	C,0C5H
  C6B8  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
                      	
  C6BA                	TEXT:
  C6BA  0EB0          		LD	C,0B0H
  C6BC  3E80          		LD	A,080H
  C6BE  ED79          		OUT	(C),A
  C6C0  1607          		LD	D,7
  C6C2  0EB9          		LD	C,0B9H
  C6C4  2101CA        		LD	HL,TEXTDT
  C6C7                	TEXT1:
  C6C7  04            		INC	B
  C6C8  EDA3          		OUTI
  C6CA  0C            		INC	C
  C6CB  15            		DEC	D
  C6CC  20F9          		JR	NZ,TEXT1
  C6CE  01B01F        		LD	BC,01FB0H
  C6D1  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
                      	
  C6D3  0EC4          		LD	C,0C4H
  C6D5  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
                      	
  C6D7  01011A        		LD	BC,01A01H
  C6DA  ED78          		IN	A,(C)
  C6DC  E608          		AND	8
  C6DE  2809          		JR	Z,PRN
  C6E0  0E03          		LD	C,003H
  C6E2  3E0F          		LD	A,00FH
  C6E4  ED79          		OUT	(C),A
  C6E6  01040A        		LD	BC,00A04H
  C6E9                	PRN:
  C6E9  110100        		LD	DE,1
  C6EC  62            		LD	H,D
  C6ED  6A            		LD	L,D
  C6EE  017F00        		LD	BC,07FH
  C6F1  36FF          		LD	(HL),0FFH
  C6F3  EDB0          		LDIR
  C6F5  017F00        		LD	BC,07FH
  C6F8  3600          		LD	(HL),0
  C6FA  EDB0          		LDIR
                      	
  C6FC  3EC3          		LD	A,0C3H		;JP
  C6FE  2172D3        		LD	HL,WBOOT
  C701  320000        		LD	(00000H),A
  C704  220100        		LD	(00001H),HL	;IPL
                      	
  C707  2A03C6        		LD	HL,(MACHINE)	;3 bit7  DPB Original(1)
                      					;  bit6-4 DPB_LEVEL
  C70A  220300        		LD	(00003H),HL	;  bit3-0 Machine X1(0)
                      	;				;4 LSX-Dodgers(01DH)
  C70D  2106CC        		LD	HL,BDOS
  C710  320500        		LD	(00005H),A
  C713  220600        		LD	(00006H),HL	;BDOS
                      	
  C716  2183D6        		LD	HL,BIOS
  C719  321800        		LD	(00018H),A	;BIOS-ROM
  C71C  221900        		LD	(00019H),HL
                      	
  C71F  210000        		LD	HL,0
  C722  323800        		LD	(00038H),A	;RST038H
  C725  223900        		LD	(00039H),HL
                      	
  C728  3EEC          		LD	A,STABLE/256
  C72A  320B00        		LD	(0000BH),A
                      	
  C72D  3EE9          		LD	A,0E9H		;JP (HL)
  C72F  320F00        		LD	(0000FH),A
                      	
  C732  3A7DEC        		LD	A,(_FATBF+1)
  C735  321300        		LD	(00013H),A
                      	
  C738  3A7FEC        		LD	A,(_DTBUF+1)
  C73B  321700        		LD	(00017H),A
                      	
  C73E  3EFE          		LD	A,KEYBF/256
  C740  321B00        		LD	(0001BH),A
                      	
  C743  3EFF          		LD	A,KBUF/256
  C745  321F00        		LD	(0001FH),A
                      	
  C748  2A05C6        		LD	HL,(VERSION)
  C74B  225A00        		LD	(0005AH),HL
                      	
  C74E  3EE6          		LD	A,0E6H
  C750  CDBDDA        		CALL	COMOUT
  C753  CDA2DA        		CALL	IN49SB
  C756  F5            		PUSH	AF
  C757  CDA2DA        		CALL	IN49SB
  C75A  F1            		POP	AF
  C75B  F5            		PUSH	AF
  C75C  E612          		AND	012H
  C75E  2005          		JR	NZ,KEYR
  C760  3E01          		LD	A,1
  C762  32C7C8        		LD	(KEYREP+1),A
  C765                	KEYR:
  C765  F1            		POP	AF
  C766  E603          		AND	3
  C768  280E          		JR	Z,NON
                      	
  C76A  01D03F        		LD	BC,03FD0H
  C76D  ED49          		OUT	(C),C
  C76F  3E37          		LD	A,037H
  C771  D3D0          		OUT	(0D0H),A
  C773  ED78          		IN	A,(C)
  C775  B9            		CP	C
  C776  2878          		JR	Z,TURBO
  C778                	NON:
  C778  3D            		DEC	A		;A=0FFH
  C779  321800        		LD	(00018H),A	;BIOS-ROM
                      	
  C77C  2114CA        		LD	HL,AT_SCR1
  C77F  1147DB        		LD	DE,SCR1
  C782  01A100        		LD	BC,SCRNX-SCR1	;転送先のサイズ確認用
  C785  019F00        		LD	BC,AT_SCRE-AT_SCR1
  C788  EDB0          		LDIR
                      	
  C78A  21B3CA        		LD	HL,AT_WTTRK
  C78D  11C3EA        		LD	DE,WTTRK
  C790  01AD00        		LD	BC,DMAE-WTTRK	;転送先のサイズ確認用
  C793  019B00        		LD	BC,AT_CPUE-AT_WTTRK
  C796  EDB0          		LDIR
                      	
  C798  214ECB        		LD	HL,AT_EDWTC
  C79B  112DD3        		LD	DE,EDWTC
  C79E  014200        		LD	BC,EMME-EDWTC	;転送先のサイズ確認用
  C7A1  014300        		LD	BC,AT_EMME-AT_EDWTC
  C7A4  EDB0          		LDIR
                      	
  C7A6  2117EB        		LD	HL,AT_DRD+AT_R
  C7A9  22ECEC        		LD	(_FDRD+1),HL
  C7AC  21C7EA        		LD	HL,AT_DWT+AT_R
  C7AF  22EFEC        		LD	(_FDWT+1),HL
  C7B2  2141D3        		LD	HL,AT_EDRDC+AT_RE
  C7B5  2282ED        		LD	(EMMRD),HL
  C7B8  212DD3        		LD	HL,AT_EDWTC+AT_RE
  C7BB  2284ED        		LD	(EMMWR),HL
                      	
  C7BE  3E27          		LD	A,027H			;ノンターボはMFM切り替えを行わない
  C7C0  3212ED        		LD	(DEVICE+012H),A		;Aドライブ
  C7C3  3232ED        		LD	(DEVICE+012H+32),A	;Bドライブ
  C7C6  3252ED        		LD	(DEVICE+012H+32*2),A	;Cドライブ
  C7C9  3272ED        		LD	(DEVICE+012H+32*3),A	;Dドライブ
                      	
  C7CC  210000        		LD	HL,0
  C7CF  22E8DA        		LD	(X1PAT),HL
                      	
  C7D2  3EAF          		LD	A,0AFH		;XOR	A
  C7D4  32F8D8        		LD	(X1KPAT),A
                      	
  C7D7  21E8DB        		LD	HL,SCRNX
  C7DA  22D1EC        		LD	(_SCRN+1),HL
                      	
  C7DD  CD87C9        		CALL	SETCRTC
  C7E0  0610          		LD	B,010H		;PALET
  C7E2  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  C7E4  04            		INC	B
  C7E5  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  C7E7  04            		INC	B
  C7E8  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  C7EA  04            		INC	B
  C7EB  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  C7ED  C383C8        		JP	NOBANK
                      	
  C7F0                	TURBO:
  C7F0  F3            		DI			;Check BIOS
  C7F1  061D          		LD	B,01DH
  C7F3  ED79          		OUT	(C),A		;BIOS ON
  C7F5  3A512F        		LD	A,(02F51H)
  C7F8  04            		INC	B		;B=01EH
  C7F9  ED79          		OUT	(C),A		;BIOS OFF
  C7FB  FB            		EI
  C7FC  FEC9          		CP	0C9H
  C7FE  280B          		JR	Z,BIOSOK
  C800  3EAF          		LD	A,0AFH		;XOR	A
  C802  32F8D8        		LD	(X1KPAT),A
  C805  21E8DB        		LD	HL,SCRNX
  C808  22D1EC        		LD	(_SCRN+1),HL
  C80B                	BIOSOK:
  C80B  3E1F          		LD	A,01FH
  C80D  DBF0          		IN	A,(0F0H)
  C80F  0F            		RRCA
  C810  380B          		JR	C,CRT1
  C812  21F1C9        		LD	HL,_C8025H
  C815  11B0EC        		LD	DE,CRTCD
  C818  011000        		LD	BC,16
  C81B  EDB0          		LDIR
  C81D                	CRT1:
  C81D  CD87C9        		CALL	SETCRTC
  C820  01AA10        		LD	BC,010AAH	;PALET
  C823  ED49          		OUT	(C),C
  C825  01CC11        		LD	BC,011CCH
  C828  ED49          		OUT	(C),C
  C82A  01F012        		LD	BC,012F0H
  C82D  ED49          		OUT	(C),C
  C82F  04            		INC	B
  C830  ED71          		DB	0EDH,071H
                      	
  C832  3E1F          		LD	A,01FH		;スタートポート
  C834  DBF0          		IN	A,(0F0H)
  C836  CB57          		BIT	2,A
  C838  2818          		JR	Z,BANK
                      	
  C83A  AF            		XOR	A
  C83B                	TZ1:				;前面スイッチが2HDの場合はMFMモードを2HDにしておく
  C83B  F5            		PUSH	AF
  C83C  CDDCEC        		CALL	_GETDPB
  C83F  DD7E12        		LD	A,(IX+012H)	;DPB_12_DEVICE
  C842  E68F          		AND	08FH
  C844  FE87          		CP	087H		;フロッピーでMEM切り替えがON
  C846  2004          		JR	NZ,TZ2
  C848  DDCB0A86      		RES	0,(IX+0AH)	;(DPB_0A_FDMODE)
  C84C                	TZ2:
  C84C  F1            		POP	AF
  C84D  3C            		INC	A
  C84E  FE08          		CP	8
  C850  38E9          		JR	C,TZ1
                      	
  C852                	BANK:
  C852  01000B        		LD	BC,00B00H
  C855  21007F        		LD	HL,07F00H
  C858  F3            		DI
  C859                	BANK1:
  C859  ED69          		OUT	(C),L
  C85B  5E            		LD	E,(HL)
  C85C  7B            		LD	A,E
  C85D  C6A5          		ADD	A,0A5H
  C85F  77            		LD	(HL),A
  C860  BE            		CP	(HL)
  C861  73            		LD	(HL),E
  C862  2005          		JR	NZ,BANK2
  C864  2C            		INC	L
  C865  CB65          		BIT	4,L
  C867  28F0          		JR	Z,BANK1
  C869                	BANK2:
  C869  3E10          		LD	A,010H
  C86B  ED79          		OUT	(C),A
  C86D  7D            		LD	A,L
  C86E  B7            		OR	A
  C86F  2812          		JR	Z,NOBANK
  C871  2600          		LD	H,0
  C873  29            		ADD	HL,HL	;*2
  C874  29            		ADD	HL,HL	;*4
  C875  29            		ADD	HL,HL	;*8
  C876  29            		ADD	HL,HL	;*16
  C877  29            		ADD	HL,HL	;*32
  C878  2B            		DEC	HL	;-1
  C879  2B            		DEC	HL	;-2
  C87A  2B            		DEC	HL	;-3
  C87B  22A8ED        		LD	(BANKCL),HL
  C87E  3E01          		LD	A,1
  C880  32A0ED        		LD	(BANKFL),A
  C883                	NOBANK:
  C883                	EMM:
  C883  CD50C9        		CALL	EADR0
  C886  ED78          		IN	A,(C)
  C888  F5            		PUSH	AF
                      	
  C889  110000        		LD	DE,0
  C88C                	ECHECK1:
  C88C  13            		INC	DE
  C88D  CD33C9        		CALL	EADR2
  C890  ED60          		IN	H,(C)
  C892  CD33C9        		CALL	EADR2
  C895  7C            		LD	A,H
  C896  C6E5          		ADD	A,0E5H
  C898  ED79          		OUT	(C),A
  C89A  3C            		INC	A
  C89B  CD50C9        		CALL	EADR0
  C89E  ED79          		OUT	(C),A
  C8A0  3D            		DEC	A
  C8A1  CD33C9        		CALL	EADR2
  C8A4  ED68          		IN	L,(C)
  C8A6  CD33C9        		CALL	EADR2
  C8A9  ED61          		OUT	(C),H
  C8AB  BD            		CP	L
  C8AC  2004          		JR	NZ,ECHECK2
  C8AE  CB5A          		BIT	3,D
  C8B0  28DA          		JR	Z,ECHECK1
  C8B2                	ECHECK2:
  C8B2  CD50C9        		CALL	EADR0
  C8B5  F1            		POP	AF
  C8B6  ED79          		OUT	(C),A
                      	
  C8B8  21F7FF        		LD	HL,0-9
  C8BB  19            		ADD	HL,DE
  C8BC  3008          		JR	NC,NOEMM
  C8BE  2288ED        		LD	(EMMCL),HL
  C8C1  3E03          		LD	A,3
  C8C3  3280ED        		LD	(EMMFL),A
  C8C6                	NOEMM:
  C8C6  3E00          	KEYREP:	LD	A,000H
  C8C8  B7            		OR	A
  C8C9  2807          		JR	Z,KEYR1
  C8CB  010000        		LD	BC,0
  C8CE  ED438CEC      		LD	(_CTC),BC
  C8D2                	KEYR1:
  C8D2  0130F8        		LD	BC,0-80*25
  C8D5  2ABAEC        		LD	HL,(CRTCD+10)
  C8D8  ED43BAEC      		LD	(CRTCD+10),BC
  C8DC  1E0C          		LD	E,00CH
  C8DE  CDCDEC        		CALL	_PRINT
  C8E1  22BAEC        		LD	(CRTCD+10),HL
                      	
  C8E4  21B2C9        		LD	HL,INIMES
  C8E7  CD6BD8        		CALL	MSX
                      	
  C8EA  3A87FF        		LD	A,(0FF87H)
  C8ED  FE08          		CP	8
  C8EF  301E          		JR	NC,INIT0
  C8F1  5F            		LD	E,A
  C8F2  C641          		ADD	A,'A'
  C8F4  32AFC9        		LD	(AUTODV),A
  C8F7  0E0E          		LD	C,00EH
  C8F9  CD0500        		CALL	SYSTEM
  C8FC  1C            		INC	E
  C8FD  2185EC        		LD	HL,_SEEKSP	;Disk error Ignore
  C900  CBFE          		SET	7,(HL)
  C902  0E1B          		LD	C,01BH
  C904  CD0500        		CALL	SYSTEM
                      	
  C907  2185EC        		LD	HL,_SEEKSP
  C90A  CBBE          		RES	7,(HL)
                      	
  C90C  3C            		INC	A
  C90D  2008          		JR	NZ,INIT1
  C90F                	INIT0:
  C90F  1E00          		LD	E,0
  C911  0E0E          		LD	C,00EH
  C913  CD0500        		CALL	SYSTEM
  C916  AF            		XOR	A
  C917                	INIT1:
  C917  2100FF        		LD	HL,0FF00H
  C91A  1101FF        		LD	DE,0FF01H
  C91D  01FF00        		LD	BC,000FFH
  C920  75            		LD	(HL),L
  C921  EDB0          		LDIR
                      	
  C923  B7            		OR	A
  C924  C8            		RET	Z
                      	
  C925  3EE6          		LD	A,0E6H
  C927  CDBDDA        		CALL	COMOUT
  C92A  CDA2DA        		CALL	IN49SB
  C92D  CDA2DA        		CALL	IN49SB
  C930  FE1B          		CP	01BH
  C932  C9            		RET
                      	
  C933                	EADR2:
  C933  D5            		PUSH	DE
  C934  EB            		EX	DE,HL
  C935  29            		ADD	HL,HL
  C936  29            		ADD	HL,HL
  C937  ED4B8BED      		LD	BC,(EMMBL-1)
  C93B  0E00          		LD	C,0
  C93D  09            		ADD	HL,BC
  C93E  ED4B93ED      		LD	BC,(EMMDV)
  C942  060D          		LD	B,00DH
  C944  ED49          		OUT	(C),C
  C946  0C            		INC	C
  C947  ED69          		OUT	(C),L
  C949  0C            		INC	C
  C94A  ED61          		OUT	(C),H
  C94C  0C            		INC	C
  C94D  EB            		EX	DE,HL
  C94E  D1            		POP	DE
  C94F  C9            		RET
                      	
  C950                	EADR0:
  C950  ED4B93ED      		LD	BC,(EMMDV)
  C954  060D          		LD	B,00DH
  C956  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  C958  0C            		INC	C
  C959  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  C95B  0C            		INC	C
  C95C  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  C95E  0C            		INC	C
  C95F  C9            		RET
                      	
  C960                	CHKCTC:
  C960  C5            		PUSH	BC
  C961  110347        		LD	DE,04703H
  C964                	INICTC1:
  C964  0C            		INC	C
  C965  ED51          		OUT	(C),D
  C967  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  C969  1D            		DEC	E
  C96A  20F8          		JR	NZ,INICTC1
  C96C  C1            		POP	BC
                      	
  C96D  11FA07        		LD	DE,007FAH
  C970  ED51          		OUT	(C),D
  C972  ED59          		OUT	(C),E
  C974  ED78          		IN	A,(C)
  C976  BB            		CP	E
  C977  C0            		RET	NZ
  C978  ED51          		OUT	(C),D
  C97A  ED51          		OUT	(C),D
  C97C  ED78          		IN	A,(C)
  C97E  BA            		CP	D
  C97F  C0            		RET	NZ
  C980  03            		INC	BC
  C981  03            		INC	BC
  C982  ED438CEC      		LD	(_CTC),BC
  C986  C9            		RET
                      	
  C987                	SETCRTC:
  C987  21B0EC        		LD	HL,CRTCD
  C98A  AF            		XOR	A
  C98B                	SETCRT1:
  C98B  010018        		LD	BC,01800H
  C98E  ED79          		OUT	(C),A
  C990  0C            		INC	C
  C991  04            		INC	B
  C992  EDA3          		OUTI
  C994  3C            		INC	A
  C995  FE0C          		CP	12
  C997  20F2          		JR	NZ,SETCRT1
  C999  23            		INC	HL
  C99A  23            		INC	HL
  C99B  01031B        		LD	BC,01A03H+00100H
  C99E  EDA3          		OUTI
  C9A0  01D020        		LD	BC,01FD0H+00100H
  C9A3  EDA3          		OUTI
  C9A5  C9            		RET
                      	
  C9A6  4155544F455845	AUTOD:	DB	"AUTOEXEC "
  C9AF  413A00        	AUTODV:	DB	"A:",0
                      	
  C9B2  4C53582D446F64	INIMES:	DB	"LSX-Dodgers for X1/turbo version "
  C9D3  312E          		DB	030H + VER_1, '.'
  C9D5  3336          		DB	030H + VER_2 ,030H + VER_3
  C9D7  2047616B752028		DB	' Gaku (Lovers/Tablacus)',0DH,0AH
  C9F0  00            		DB	0
                      	
  C9F1                	_C8025H:
  C9F1  6B5059881B0119		DB	06BH,050H,059H,088H,01BH,001H,019H,01AH
  C9F9  000F          		DB	000H,00FH
  C9FB  30F8B0FF      		DW	0-80*LINE,0-80
  C9FF  0CA3          		DB	00CH,0A3H
                      	
  CA01  030C0F30333C3F	TEXTDT:	DB	003H,00CH,00FH,030H,033H,03CH,03FH
                      	
  CA08                	SIODATA:
  CA08  18            		DB	018H
  CA09  0100          		DB	1,0
  CA0B  0200          		DB	2,0
  CA0D  03C1          		DB	3,0C1H
  CA0F  0444          		DB	4,044H
  CA11  05E8          		DB	5,0E8H
  CA13  FF            		DB	0FFH
                      	
                      	;	ノンターボ用パッチ
                      	
  CA14                	AT_SCR1:
  CA14  D9            		EXX
  CA15  C5            		PUSH	BC
  CA16  015020        		LD	BC,02000H+80
  CA19  D9            		EXX
  CA1A  C5            		PUSH	BC
  CA1B  010020        		LD	BC,02000H
                      	
  CA1E  67            		LD	H,A
  CA1F  B7            		OR	A
  CA20                	AT_SCRUP1:
  CA20  2815          		JR	Z,AT_SCRCL
  CA22  C5            		PUSH	BC
  CA23  CBE0          		SET	4,B
  CA25  D9            		EXX
  CA26  C5            		PUSH	BC
  CA27  CBE0          		SET	4,B
  CA29  D9            		EXX
  CA2A  CD81DB        		CALL	AT_UPSUB+AT_RS
  CA2D  D9            		EXX
  CA2E  C1            		POP	BC
  CA2F  D9            		EXX
  CA30  C1            		POP	BC
  CA31  CD81DB        		CALL	AT_UPSUB+AT_RS
  CA34  25            		DEC	H
  CA35  18E9          		JR	AT_SCRUP1
                      	
  CA37                	AT_SCRCL:
  CA37  215020        		LD	HL,02000H+80
  CA3A  3A96EC        		LD	A,(_COLORF)
  CA3D                	AT_SCRCL1:
  CA3D  CBE0          		SET	4,B
  CA3F  ED61          		OUT	(C),H
  CA41  CBA0          		RES	4,B
  CA43  ED79          		OUT	(C),A
  CA45  03            		INC	BC
  CA46  2D            		DEC	L
  CA47  20F4          		JR	NZ,AT_SCRCL1
  CA49  C1            		POP	BC
  CA4A  D9            		EXX
  CA4B  C1            		POP	BC
  CA4C  D9            		EXX
  CA4D  C9            		RET
                      	
  CA4E                	AT_UPSUB:
  CA4E  2E28          		LD	L,40
  CA50                	AT_UPSUB1:
  CA50  D9            		EXX
  CA51  ED78          		IN	A,(C)
  CA53  03            		INC	BC
  CA54  D9            		EXX
  CA55  ED79          		OUT	(C),A
  CA57  03            		INC	BC
  CA58  D9            		EXX
  CA59  ED78          		IN	A,(C)
  CA5B  03            		INC	BC
  CA5C  D9            		EXX
  CA5D  ED79          		OUT	(C),A
  CA5F  03            		INC	BC
  CA60  2D            		DEC	L
  CA61  20ED          		JR	NZ,AT_UPSUB1
  CA63  C9            		RET
                      	
                      	;	FLOPPY DISK DRIVER(CPU)
                      	
  CA64                	DISKC:
  CA64  1B            		DEC	DE
  CA65  CB5F          		BIT	3,A
  CA67  C4BCEA        		CALL	NZ,RNF
  CA6A                	DISKD:
  CA6A  E5            		PUSH	HL
  CA6B  21C2EA        		LD	HL,RETRY
  CA6E  35            		DEC	(HL)
  CA6F  E1            		POP	HL
  CA70  203E          		JR	NZ,AT_ERR		;Retry
  CA72  B7            		OR	A
  CA73  283B          		JR	Z,AT_ERR		;Error
                      	
  CA75                	AT_DELP:
  CA75  CDBCEA        		CALL	RNF
  CA78  CD98EA        		CALL	FDMOFF
  CA7B  3A85EC        		LD	A,(_SEEKSP)
  CA7E  87            		ADD	A,A
  CA7F  382E          		JR	C,AT_ERRZ
  CA81                	AT_DELP1:
  CA81  D5            		PUSH	DE
  CA82  21C0EB        		LD	HL,DEMES
  CA85  CD6BD8        		CALL	MSX
  CA88  CD56D7        		CALL	KEYBC
  CA8B                	AT_DELP2:
  CA8B  CDCAEC        		CALL	_INKEY
  CA8E  28FB          		JR	Z,AT_DELP2
                      	
  CA90  D1            		POP	DE
  CA91  CDBCDF        		CALL	CAP
  CA94  FE52          		CP	'R'		;Retry
  CA96  200A          		JR	NZ,AT_DELP3
  CA98  210000        	DHLPAT:	LD	HL,0
  CA9B  3E02          		LD	A,2
  CA9D  32C2EA        		LD	(RETRY),A
  CAA0  B7            		OR	A
  CAA1  C9            		RET
  CAA2                	AT_DELP3:
  CAA2  FE49          		CP	'I'		;Ignore
  CAA4  2807          		JR	Z,AT_IGNORE
  CAA6  FE41          		CP	'A'		;Abort
  CAA8  20D7          		JR	NZ,AT_DELP1
  CAAA  C36FD3        		JP	BOOT
  CAAD                	AT_IGNORE:
  CAAD  3EFF          		LD	A,0FFH
  CAAF                	AT_ERRZ:
  CAAF  BF            		CP	A
  CAB0                	AT_ERR:
  CAB0  3EFF          		LD	A,0FFH
  CAB2  C9            		RET
                      	
  CAB3                	AT_SCRE:
                      	
  CAB3                	AT_WTTRK:
  CAB3  3EF0          		LD	A,0F0H
  CAB5  1802          		JR	AT_WTTRK1
                      	
  CAB7                	AT_DWT:
  CAB7  3EA0          		LD	A,0A0H
  CAB9                	AT_WTTRK1:
  CAB9  3260EA        		LD	(FDCPAT+1),A
                      	
  CABC  3E02          		LD	A,2		;Retry count
  CABE  32C2EA        		LD	(RETRY),A
                      	
  CAC1                	DWT0:
  CAC1  D5            		PUSH	DE
  CAC2  E5            		PUSH	HL
  CAC3  22CCDB        		LD	(DHLPAT+1+AT_RS),HL
  CAC6  CDFAE9        		CALL	SEEK		;Write disk
  CAC9  E1            		POP	HL
  CACA  3831          		JR	C,ERRDW
  CACC  F3            		DI
  CACD  3A60EA        		LD	A,(FDCPAT+1)
  CAD0  CDA4EA        		CALL	SECSET
  CAD3  0EFB          		LD	C,0FBH
                      	
  CAD5                	DWT1:
  CAD5  56            		LD	D,(HL)
  CAD6                	DWT2:
  CAD6  78            		LD	A,B
  CAD7  DBF8          		IN	A,(0F8H)
  CAD9  0F            		RRCA
  CADA  3008          		JR	NC,DWT4
  CADC  0F            		RRCA
  CADD  30F7          		JR	NC,DWT2
  CADF                	DWT3:
  CADF  ED51          		OUT	(C),D
  CAE1  23            		INC	HL
  CAE2  18F1          		JR	DWT1
                      	
  CAE4                	DWT4:
  CAE4  3D            		DEC	A
  CAE5  28F8          		JR	Z,DWT3
  CAE7  3C            		INC	A
  CAE8  FB            		EI
  CAE9  D1            		POP	DE
  CAEA  13            		INC	DE
  CAEB  CD98EA        		CALL	FDMOFF
  CAEE  C8            		RET	Z
  CAEF  CD97DB        		CALL	DISKC+AT_RS
  CAF2  20CD          		JR	NZ,DWT0
  CAF4  B7            		OR	A
  CAF5  C8            		RET	Z
  CAF6                	ERRW:
  CAF6  3EFF          		LD	A,0FFH
  CAF8                	ERRZ:
  CAF8  BF            		CP	A
  CAF9  37            		SCF
  CAFA  C398EA        		JP	FDMOFF
                      	
  CAFD                	ERRDW:
  CAFD  D1            		POP	DE
  CAFE  CDA8DB        		CALL	AT_DELP+AT_RS
  CB01  20BE          		JR	NZ,DWT0
  CB03  B7            		OR	A
  CB04  20F0          		JR	NZ,ERRW
  CB06  C9            		RET
                      	
  CB07                	AT_DRD:
  CB07  3E80          		LD	A,080H
  CB09  3260EA        		LD	(FDCPAT+1),A
                      	
  CB0C  3E02          		LD	A,2		;Retry count
  CB0E  32C2EA        		LD	(RETRY),A
                      	
  CB11                	DRD0:
  CB11  D5            		PUSH	DE
  CB12  E5            		PUSH	HL
  CB13  22CCDB        		LD	(DHLPAT+1+AT_RS),HL
  CB16  CDFAE9        		CALL	SEEK		;Read disk
  CB19  E1            		POP	HL
  CB1A  3828          		JR	C,ERRDR
  CB1C  F3            		DI
  CB1D  3A60EA        		LD	A,(FDCPAT+1)
  CB20  CDA4EA        		CALL	SECSET
  CB23  0EFB          		LD	C,0FBH
  CB25                	DRD1:
  CB25  78            		LD	A,B
  CB26  DBF8          		IN	A,(0F8H)
  CB28  0F            		RRCA
  CB29  3008          		JR	NC,DRD3
  CB2B  0F            		RRCA
  CB2C  30F7          		JR	NC,DRD1
  CB2E  EDA2          		INI
  CB30  04            		INC	B
  CB31  18F2          		JR	DRD1
                      	
  CB33                	DRD3:
  CB33  B7            		OR	A
  CB34  FB            		EI
  CB35  D1            		POP	DE
  CB36  13            		INC	DE
  CB37  CD98EA        		CALL	FDMOFF
  CB3A  C8            		RET	Z
  CB3B  CD97DB        		CALL	DISKC+AT_RS
  CB3E  20D1          		JR	NZ,DRD0
  CB40  B7            		OR	A
  CB41  20B3          		JR	NZ,ERRW
  CB43  C9            		RET
                      	
  CB44                	ERRDR:
  CB44  D1            		POP	DE
  CB45  CDA8DB        		CALL	AT_DELP+AT_RS
  CB48  20C7          		JR	NZ,DRD0
  CB4A  B7            		OR	A
  CB4B  20A9          		JR	NZ,ERRW
  CB4D  C9            		RET
                      	
  CB4E                	AT_CPUE:
                      	
                      	
                      	;	EMM DRIVER(CPU)
                      	
                      	
  CB4E                	AT_EDWTC:
  CB4E  CD55D3        		CALL	AT_EADR+AT_RE
  CB51                	AT_EDWTC1:
  CB51  04            		INC	B
  CB52  EDA3          		OUTI
  CB54  04            		INC	B
  CB55  EDA3          		OUTI
  CB57  04            		INC	B
  CB58  EDA3          		OUTI
  CB5A  04            		INC	B
  CB5B  EDA3          		OUTI
  CB5D  3D            		DEC	A
  CB5E  20F1          		JR	NZ,AT_EDWTC1
  CB60  AF            		XOR	A
  CB61  C9            		RET
                      	
  CB62                	AT_EDRDC:
  CB62  CD55D3        		CALL	AT_EADR+AT_RE
  CB65                	AT_EDRDC1:
  CB65  EDA2          		INI
  CB67  04            		INC	B
  CB68  EDA2          		INI
  CB6A  04            		INC	B
  CB6B  EDA2          		INI
  CB6D  04            		INC	B
  CB6E  EDA2          		INI
  CB70  04            		INC	B
  CB71  3D            		DEC	A
  CB72  20F1          		JR	NZ,AT_EDRDC1
  CB74  AF            		XOR	A
  CB75  C9            		RET
                      	
  CB76                	AT_EADR:
  CB76  D5            		PUSH	DE
  CB77  EB            		EX	DE,HL
  CB78  29            		ADD	HL,HL
  CB79  29            		ADD	HL,HL
  CB7A  ED4BA0EC      		LD	BC,(_MAXCYL-1)
  CB7E  0E00          		LD	C,0
  CB80  09            		ADD	HL,BC
  CB81  060D          		LD	B,00DH
  CB83  ED49          		OUT	(C),C
  CB85  0C            		INC	C
  CB86  ED69          		OUT	(C),L
  CB88  0C            		INC	C
  CB89  ED61          		OUT	(C),H
  CB8B  0C            		INC	C
  CB8C  EB            		EX	DE,HL
  CB8D  D1            		POP	DE
  CB8E  13            		INC	DE
  CB8F  AF            		XOR	A
  CB90  C9            		RET
                      	
  CB91                	AT_EMME:
                      	
  CB91                	INITE:
  CB91                		DS	0CC06H-INITE
                      	
  CC06                	BDOS:
  CC06  C37ED3        		JP	BDOS0
  CC09                		DS	71	;Reserved
                      	
                      	;LDCCP.ASM
                      	
                      	;	LSX-Dodgers CCP
                      	
  CC50                	WBOOT1:
  CC50  F3            		DI
  CC51  310000        		LD	SP,STACK
                      	
  CC54  3EEC          		LD	A,INTVEC/256
  CC56  ED47          		LD	I,A
                      	
  CC58  3EE4          		LD	A,0E4H
  CC5A  CDBDDA        		CALL	COMOUT
  CC5D  3EC8          		LD	A,INTVEC
  CC5F  CD97DA        		CALL	OT49SB
                      	
  CC62  3ABCEC        		LD	A,(CRTCD+12)
  CC65  B7            		OR	A
  CC66  200C          		JR	NZ,SETCRT0
  CC68  2130F8        		LD	HL,0-80*LINE
  CC6B  22BAEC        		LD	(CRTCD+10),HL
  CC6E  21B0FF        		LD	HL,0-80
  CC71  22BCEC        		LD	(CRTCD+12),HL
  CC74                	SETCRT0:
  CC74  21B0EC        		LD	HL,CRTCD
  CC77  AF            		XOR	A
  CC78                	SETCRT2:
  CC78  010018        		LD	BC,01800H
  CC7B  ED79          		OUT	(C),A
  CC7D  0C            		INC	C
  CC7E  04            		INC	B
  CC7F  EDA3          		OUTI
  CC81  3C            		INC	A
  CC82  FE0C          		CP	12
  CC84  20F2          		JR	NZ,SETCRT2
  CC86  0D            		DEC	C
  CC87  ED79          		OUT	(C),A
  CC89  0C            		INC	C
                      	;	OUT	(C),0		;未定義命令ニーモニック
  CC8A  ED71          		DB	0EDH,071H
  CC8C  0D            		DEC	C
  CC8D  3C            		INC	A
  CC8E  ED79          		OUT	(C),A
  CC90  0C            		INC	C
                      	;	OUT	(C),0		;未定義命令ニーモニック
  CC91  ED71          		DB	0EDH,071H
  CC93  23            		INC	HL
  CC94  23            		INC	HL
  CC95  01031B        		LD	BC,01A03H+00100H
  CC98  EDA3          		OUTI
  CC9A  01D020        		LD	BC,01FD0H+00100H
  CC9D  EDA3          		OUTI
  CC9F  CD15CF        		CALL	LTNL
  CCA2                	COMMAND:
  CCA2  CD5ACD        		CALL	SETDTA1
  CCA5  D5            		PUSH	DE
  CCA6  3A87EC        		LD	A,(_DVSW)
  CCA9  C641          		ADD	A,'A'
  CCAB  5F            		LD	E,A
  CCAC  CDCDEC        		CALL	_PRINT
  CCAF  1E3E          		LD	E,'>'
  CCB1  CDCDEC        		CALL	_PRINT
  CCB4  D1            		POP	DE		;DE=DTA1
  CCB5  3E50          		LD	A,80
  CCB7  12            		LD	(DE),A
  CCB8  CDDCD7        		CALL	_SYS0A		;(BDOS)文字列入力
  CCBB  CD15CF        		CALL	LTNL
                      	
  CCBE  118200        		LD	DE,DTA1+2
  CCC1  CDFDEC        		CALL	_COMANL
  CCC4  30DC          		JR	NC,COMMAND
  CCC6  CD56D7        		CALL	KEYBC
  CCC9  1175D2        		LD	DE,COMERM
  CCCC  CDB4D3        		CALL	_SYS09		;(BDOS)文字列出力
  CCCF  C7            		RST	0
                      	
  CCD0                	COMANL:
  CCD0  CD98DC        		CALL	FILE
  CCD3  D5            		PUSH	DE
  CCD4  11DC00        		LD	DE,FNAME
  CCD7  1A            		LD	A,(DE)
  CCD8  FE20          		CP	020H
  CCDA  2848          		JR	Z,SDVSW
  CCDC  1B            		DEC	DE
  CCDD  1A            		LD	A,(DE)
  CCDE  C6FF          		ADD	A,0FFH
  CCE0  380A          		JR	C,COMB
  CCE2  13            		INC	DE
                      	
  CCE3  2120D2        		LD	HL,COMTB
  CCE6  3E09          		LD	A,COMS
  CCE8  47            		LD	B,A
  CCE9  CD31DF        		CALL	CPNAME
  CCEC                	COMB:
  CCEC  D1            		POP	DE
  CCED  D20F00        		JP	NC,JP_HL
  CCF0  EB            		EX	DE,HL
  CCF1  22D0CD        		LD	(COMPAT+1),HL
  CCF4  2227CE        		LD	(BATPAT+1),HL
  CCF7  F5            		PUSH	AF
  CCF8  CD78CD        		CALL	CEXE4
  CCFB  F1            		POP	AF
  CCFC  21DC00        		LD	HL,FNAME
  CCFF  116D00        		LD	DE,FCB2+1	;COMMAND NAME
  CD02  010B00        		LD	BC,11
  CD05  EDB0          		LDIR
  CD07  11DFD1        		LD	DE,PATHD
  CD0A                	CEX1:
  CD0A  1A            		LD	A,(DE)
  CD0B  FE20          		CP	020H
  CD0D  D8            		RET	C
  CD0E  CD8DDC        		CALL	FILEC
  CD11  D5            		PUSH	DE
  CD12  216D00        		LD	HL,FCB2+1	;COMMAND NAME
  CD15  11DC00        		LD	DE,FNAME
  CD18  010B00        		LD	BC,11
  CD1B  EDB0          		LDIR
  CD1D  CD78CD        		CALL	CEXE4
  CD20  D1            		POP	DE
  CD21  13            		INC	DE
  CD22  18E6          		JR	CEX1
                      	
  CD24                	SDVSW:
  CD24  F1            		POP	AF
  CD25  3ADB00        		LD	A,(FDRV)
  CD28  3D            		DEC	A
  CD29  5F            		LD	E,A
  CD2A  0E0E          		LD	C,00EH		;(BDOS)カレント・ドライブの設定
  CD2C  1833          		JR	SYSTEM0
                      	
  CD2E                	OPEN1:
  CD2E  21DB00        		LD	HL,FDRV
  CD31                	OPEN:
  CD31  0E11          		LD	C,011H		;(BDOS)最初のファイルの検索
  CD33                	OPEN3:
  CD33  D5            		PUSH	DE
  CD34  1151FF        		LD	DE,DTA
  CD37  CD57CD        		CALL	SETDTA
  CD3A  EB            		EX	DE,HL
  CD3B  CD0500        		CALL	SYSTEM
  CD3E  D1            		POP	DE
  CD3F  B7            		OR	A
  CD40  C9            		RET
                      	
  CD41                	OPEN2:
  CD41  0E12          		LD	C,012H
  CD43  18EE          		JR	OPEN3
                      	
  CD45                	DEFCB:				;Z=Ok NZ=Error
  CD45  1151FF        		LD	DE,DTA
  CD48  CD5FCD        		CALL	SYSC0F
                      	
  CD4B  210000        		LD	HL,0
  CD4E  2272FF        		LD	(DTA+33),HL
  CD51  2274FF        		LD	(DTA+35),HL
  CD54  110001        		LD	DE,00100H
  CD57                	SETDTA:
  CD57  C3DCD5        		JP	_SYS1A		;(BDOS)DTAの設定
                      	
  CD5A                	SETDTA1:
  CD5A  118000        		LD	DE,DTA1
  CD5D  18F8          		JR	SETDTA
                      	
  CD5F                	SYSC0F:
  CD5F  0E0F          		LD	C,00FH		;(BDOS)ファイルのオープン
  CD61                	SYSTEM0:
  CD61  CD0500        		CALL	SYSTEM
  CD64  B7            		OR	A
  CD65  C9            		RET
                      	
  CD66                	C_CD:
  CD66  CD8DDC        		CALL	FILEC
  CD69  210000        		LD	HL,0
  CD6C  11DB00        		LD	DE,FDRV
  CD6F  1803          		JR	S27
                      	
  CD71                	S27DTA:
  CD71  1151FF        		LD	DE,DTA
  CD74                	S27:
  CD74  0E27          		LD	C,027H		;(BDOS)ランダム・ブロック・リード
  CD76  18E9          		JR	SYSTEM0
                      	
  CD78                	CEXE4:
  CD78  3ADB00        		LD	A,(FDRV)
  CD7B  325700        		LD	(00057H),A
  CD7E  2AE900        		LD	HL,(FDRV+14)
  CD81  225800        		LD	(00058H),HL
                      	
  CD84  21E400        		LD	HL,FNAME+8
  CD87  7E            		LD	A,(HL)
  CD88  FE20          		CP	020H
  CD8A  2007          		JR	NZ,CEXE7
  CD8C  3E3F          		LD	A,'?'
  CD8E  77            		LD	(HL),A
  CD8F  23            		INC	HL
  CD90  77            		LD	(HL),A
  CD91  23            		INC	HL
  CD92  77            		LD	(HL),A
  CD93                	CEXE7:
  CD93  CD2ECD        		CALL	OPEN1
  CD96                	CEXE5:
  CD96  C0            		RET	NZ
  CD97  2A5BFF        		LD	HL,(DTA+1+9)
  CD9A  7C            		LD	A,H
  CD9B  CDBCDF        		CALL	CAP
  CD9E  67            		LD	H,A
  CD9F  7D            		LD	A,L
  CDA0  CDBCDF        		CALL	CAP
  CDA3  6F            		LD	L,A
  CDA4  3A5AFF        		LD	A,(DTA+1+8)
  CDA7  CDBCDF        		CALL	CAP
  CDAA  D642          		SUB	'B'
  CDAC  282E          		JR	Z,C_BAT
  CDAE  3D            		DEC	A		;'C'
  CDAF  2805          		JR	Z,C_EXE
  CDB1                	CEXE6:
  CDB1  CD41CD        		CALL	OPEN2
  CDB4  18E0          		JR	CEXE5
                      	
  CDB6                	C_EXE:
  CDB6  7C            		LD	A,H
  CDB7  FE4D          		CP	'M'
  CDB9  20F6          		JR	NZ,CEXE6
                      	
  CDBB  CD45CD        		CALL	DEFCB
  CDBE  2A0600        		LD	HL,(SYSTEM+1)
  CDC1  25            		DEC	H
  CDC2  CD71CD        		CALL	S27DTA
  CDC5  3D            		DEC	A
  CDC6  37            		SCF
  CDC7  C0            		RET	NZ
  CDC8  7C            		LD	A,H
  CDC9  B5            		OR	L
  CDCA  37            		SCF
  CDCB  C8            		RET	Z
  CDCC  CD5ACD        		CALL	SETDTA1
  CDCF  110000        	COMPAT:	LD	DE,0
  CDD2  CD25D0        		CALL	SETFCB
  CDD5  AF            		XOR	A
  CDD6  67            		LD	H,A
  CDD7  6F            		LD	L,A	;HL=0x0000
  CDD8  F9            		LD	SP,HL	;STACK=0
  CDD9  E5            		PUSH	HL
  CDDA  24            		INC	H	;HL=0x0100
  CDDB  E9            		JP	(HL)
                      	
  CDDC                	C_BAT:
  CDDC  114154        		LD	DE,'A'+'T'*256
  CDDF  ED52          		SBC	HL,DE
  CDE1  20CE          		JR	NZ,CEXE6
                      	
  CDE3  F1            		POP	AF
  CDE4  F1            		POP	AF
  CDE5  CD45CD        		CALL	DEFCB
  CDE8  210002        		LD	HL,00200H
  CDEB  CD71CD        		CALL	S27DTA
  CDEE  C6FE          		ADD	A,0FEH
  CDF0  D8            		RET	C
  CDF1  7D            		LD	A,L
  CDF2  B7            		OR	A
  CDF3  37            		SCF
  CDF4  C8            		RET	Z
  CDF5  3C            		INC	A
  CDF6  F5            		PUSH	AF
                      	
  CDF7  CD56D7        		CALL	KEYBC
  CDFA  1E1A          		LD	E,01AH
  CDFC  CDCDEC        		CALL	_PRINT
  CDFF  C1            		POP	BC
  CE00  210001        		LD	HL,00100H
  CE03                	BAT1:
  CE03  A7            		AND	A
  CE04  05            		DEC	B
  CE05  C8            		RET	Z
  CE06  7E            		LD	A,(HL)
  CE07  FE25          		CP	'%'
  CE09  280C          		JR	Z,BAT2
  CE0B                	BAT1X:
  CE0B  7E            		LD	A,(HL)
  CE0C  23            		INC	HL
  CE0D  FE1A          		CP	01AH
  CE0F  C8            		RET	Z
  CE10  FE0A          		CP	00AH
  CE12  C43CD7        		CALL	NZ,KEYBS
  CE15  18EC          		JR	BAT1
                      	
  CE17                	BAT2:
  CE17  23            		INC	HL
  CE18  7E            		LD	A,(HL)
  CE19  2B            		DEC	HL
  CE1A  D631          		SUB	'1'
  CE1C  38ED          		JR	C,BAT1X
  CE1E  FE09          		CP	9
  CE20  30E9          		JR	NC,BAT1X
  CE22  23            		INC	HL
  CE23  23            		INC	HL
  CE24  3C            		INC	A
  CE25  4F            		LD	C,A
  CE26  110000        	BATPAT:	LD	DE,0
  CE29                	BAT3:
  CE29  1A            		LD	A,(DE)
  CE2A  B7            		OR	A
  CE2B  28D6          		JR	Z,BAT1
  CE2D  CD72DD        		CALL	SPCUT
  CE30  0D            		DEC	C
  CE31  2808          		JR	Z,BAT5
  CE33                	BAT4:
  CE33  1A            		LD	A,(DE)
  CE34  FE21          		CP	021H
  CE36  38F1          		JR	C,BAT3
  CE38  13            		INC	DE
  CE39  18F8          		JR	BAT4
  CE3B                	BAT5:
  CE3B  1A            		LD	A,(DE)
  CE3C  FE21          		CP	021H
  CE3E  38C3          		JR	C,BAT1
  CE40  13            		INC	DE
  CE41  CD3CD7        		CALL	KEYBS
  CE44  18F5          		JR	BAT5
                      	
  CE46                	SWITCH:
  CE46  1A            		LD	A,(DE)
  CE47                	SW1:
  CE47  13            		INC	DE
  CE48  B9            		CP	C
  CE49  1A            		LD	A,(DE)
  CE4A  C8            		RET	Z
  CE4B  FE20          		CP	020H
  CE4D  30F8          		JR	NC,SW1
  CE4F                	C_REM:
  CE4F  AF            		XOR	A
  CE50  C9            		RET
                      	
  CE51                	C_DEL:
  CE51  CD25D0        		CALL	SETFCB
  CE54  CDA3D7        		CALL	_SYS08		;(BDOS)エコーなしコンソール入力
                      	
  CE57  0E13          		LD	C,013H
  CE59  180A          		JR	CDEL1
                      	
  CE5B                	C_REN:
  CE5B  CD25D0        		CALL	SETFCB
  CE5E  3E10          		LD	A,010H		;ディレクトリも対象にする
  CE60  326900        		LD	(FCB1+13),A	;属性
  CE63  0E17          		LD	C,017H		;(BDOS)ファイル名の変更
  CE65                	CDEL1:
  CE65  115C00        		LD	DE,FCB1
  CE68  CD0500        		CALL	SYSTEM
  CE6B  C6FF          		ADD	A,0FFH
  CE6D  C9            		RET
                      	
  CE6E                	C_DIR:
  CE6E  CD8DDC        		CALL	FILEC
  CE71  21DC00        		LD	HL,FDRV+1
  CE74  CDC5D1        		CALL	CWILD1
  CE77  3EF1          		LD	A,0F1H
  CE79  32E800        		LD	(FDRV+13),A
  CE7C  CD2ECD        		CALL	OPEN1
  CE7F                	CDIR1:
  CE7F  B7            		OR	A
  CE80  2008          		JR	NZ,PDSKF
  CE82  CDCECE        		CALL	P_NAME
  CE85  CD41CD        		CALL	OPEN2
  CE88  18F5          		JR	CDIR1
                      	
  CE8A                	PDSKF:
  CE8A  3ADB00        		LD	A,(FDRV)
  CE8D  5F            		LD	E,A
  CE8E  0E1B          		LD	C,01BH		;(BDOS)ディスク情報の獲得
  CE90  CD0500        		CALL	SYSTEM
  CE93  4F            		LD	C,A
  CE94  C601          		ADD	A,001H
  CE96  D8            		RET	C
  CE97  AF            		XOR	A
  CE98                	PDS1:
  CE98  CB19          		RR	C
  CE9A  3804          		JR	C,PDS2
  CE9C  29            		ADD	HL,HL
  CE9D  8F            		ADC	A,A
  CE9E  18F8          		JR	PDS1
  CEA0                	PDS2:
  CEA0  CB50          		BIT	2,B
  CEA2  200A          		JR	NZ,PDSKF1
  CEA4  CB3F          		SRL	A
  CEA6  CB1C          		RR	H
  CEA8  CB1D          		RR	L
  CEAA  CB10          		RL	B
  CEAC  18F2          		JR	PDS2
  CEAE                	PDSKF1:
  CEAE  CD51CF        		CALL	PRDEC
  CEB1  1156D2        		LD	DE,KBFREE
  CEB4  CDB4D3        		CALL	_SYS09		;(BDOS)文字列出力
  CEB7  CD43CF        		CALL	PUTDRV
  CEBA  3E5C          		LD	A,05CH
  CEBC  CD8DD7        		CALL	MSG_
  CEBF  2AE900        		LD	HL,(FDRV+14)
  CEC2  7C            		LD	A,H
  CEC3  B5            		OR	L
  CEC4  284F          		JR	Z,LTNL
  CEC6  2B            		DEC	HL
  CEC7  7C            		LD	A,H
  CEC8  B5            		OR	L
  CEC9  C450CF        		CALL	NZ,PRDEC0
  CECC  1847          		JR	LTNL
                      	
  CECE                	P_NAME:
  CECE  3A52FF        		LD	A,(DTA+1)
  CED1  FE2E          		CP	'.'
  CED3  C8            		RET	Z
  CED4  3E20          		LD	A,020H
  CED6  CD8DD7        		CALL	MSG_
  CED9  CD8DD7        		CALL	MSG_
  CEDC  3E3A          		LD	A,':'
  CEDE  CD8DD7        		CALL	MSG_
  CEE1  3A5DFF        		LD	A,(DTA+1+00BH)
  CEE4  F5            		PUSH	AF
  CEE5  0F            		RRCA
  CEE6  9F            		SBC	A,A
  CEE7  E60A          		AND	'*'-020H
  CEE9  C620          		ADD	A,020H
  CEEB  CD8DD7        		CALL	MSG_
  CEEE  CD43CF        		CALL	PUTDRV
  CEF1  2152FF        		LD	HL,DTA+1
  CEF4  CD92CF        		CALL	FPRNT
                      	
  CEF7  F1            		POP	AF
  CEF8  CB67          		BIT	4,A
  CEFA  2808          		JR	Z,DIR3
  CEFC  1164D2        		LD	DE,DIRMES
  CEFF  CDB4D3        		CALL	_SYS09		;(BDOS)文字列出力
  CF02  1809          		JR	DIR6
  CF04                	DIR3:
  CF04  3A70FF        		LD	A,(DTA+1+01EH)
  CF07  2A6EFF        		LD	HL,(DTA+1+01CH)
  CF0A  CD51CF        		CALL	PRDEC
  CF0D                	DIR6:
  CF0D  3AB1EC        		LD	A,(CRTCD+1)
  CF10  FE29          		CP	40+1
  CF12  D4B4CF        		CALL	NC,PRTTMS
                      	
  CF15                	LTNL:
  CF15  1E0D          		LD	E,00DH
  CF17  CDA0D7        		CALL	PRINTX
  CF1A  1E0A          		LD	E,00AH
  CF1C  C3A0D7        		JP	PRINTX
                      	
  CF1F                	C_PATH:
  CF1F  CD72DD        		CALL	SPCUT
  CF22  21DFD1        		LD	HL,PATHD
  CF25  FE21          		CP	021H
  CF27  300E          		JR	NC,CPATH0
  CF29  2B            		DEC	HL
  CF2A  2B            		DEC	HL
  CF2B                	CPATHP:
  CF2B  7E            		LD	A,(HL)
  CF2C  23            		INC	HL
  CF2D  FE20          		CP	020H
  CF2F  3F            		CCF
  CF30  30E3          		JR	NC,LTNL
  CF32  CD8DD7        		CALL	MSG_
  CF35  18F4          		JR	CPATHP
  CF37                	CPATH0:
  CF37  FE3B          		CP	';'
  CF39  2001          		JR	NZ,CPATH1
  CF3B  13            		INC	DE
  CF3C                	CPATH1:
  CF3C  EB            		EX	DE,HL
  CF3D  014000        		LD	BC,PATHX
  CF40  EDB0          		LDIR
  CF42  C9            		RET
                      	
  CF43                	PUTDRV:
  CF43  3ADB00        		LD	A,(FDRV)
  CF46  C640          		ADD	A,'A'-1
  CF48  CD8DD7        		CALL	MSG_
  CF4B  3E3A          		LD	A,':'
  CF4D                	MSGR:
  CF4D  C38DD7        		JP	MSG_
                      	
  CF50                	PRDEC0:
  CF50  AF            		XOR	A
  CF51                	PRDEC:
  CF51  5F            		LD	E,A
  CF52  010000        		LD	BC,0
  CF55  ED43D600      		LD	(DECBF),BC
  CF59  ED43D800      		LD	(DECBF+2),BC
                      	
  CF5D  0E18          		LD	C,24
  CF5F                	DEC1:
  CF5F  29            		ADD	HL,HL
  CF60  7B            		LD	A,E
  CF61  8F            		ADC	A,A
  CF62  5F            		LD	E,A
  CF63  E5            		PUSH	HL
  CF64  21D900        		LD	HL,DECBF+3
  CF67  0604          		LD	B,4
  CF69                	DEC2:
  CF69  7E            		LD	A,(HL)
  CF6A  8F            		ADC	A,A
  CF6B  27            		DAA
  CF6C  77            		LD	(HL),A
  CF6D  2B            		DEC	HL
  CF6E  10F9          		DJNZ	DEC2
  CF70  E1            		POP	HL
  CF71  0D            		DEC	C
  CF72  20EB          		JR	NZ,DEC1
                      	
  CF74  21D600        		LD	HL,DECBF
  CF77  3E20          		LD	A,020H
  CF79  0603          		LD	B,3
  CF7B                	DEC3:
  CF7B  CD88CF        		CALL	DEC4
  CF7E  CD88CF        		CALL	DEC4
  CF81  23            		INC	HL
  CF82  10F7          		DJNZ	DEC3
  CF84                	DECX:
  CF84  CD88CF        		CALL	DEC4
  CF87  AF            		XOR	A
  CF88                	DEC4:
  CF88  ED6F          		RLD
  CF8A  FE20          		CP	020H
  CF8C  2802          		JR	Z,DEC5
  CF8E  F630          		OR	030H
  CF90                	DEC5:
  CF90  18BB          		JR	MSGR
                      	
  CF92                	FPRNT:
  CF92  0608          		LD	B,8
  CF94  CDA5CF        		CALL	P_N1
  CF97  7E            		LD	A,(HL)
  CF98  C680          		ADD	A,0A0H-020H
  CF9A  FEA0          		CP	0A0H
  CF9C  2802          		JR	Z,FPR1
  CF9E  3E2E          		LD	A,'.'
  CFA0                	FPR1:
  CFA0  CD8DD7        		CALL	MSG_
  CFA3  0603          		LD	B,3
                      	
  CFA5                	P_N1:
  CFA5  C5            		PUSH	BC
  CFA6  E5            		PUSH	HL
  CFA7  7E            		LD	A,(HL)
  CFA8  CDC8DF        		CALL	CAP3
  CFAB  CD8DD7        		CALL	MSG_
  CFAE  E1            		POP	HL
  CFAF  C1            		POP	BC
  CFB0  23            		INC	HL
  CFB1  10F2          		DJNZ	P_N1
  CFB3  C9            		RET
                      	
  CFB4                	PRTTMS:
  CFB4  3E20          		LD	A,020H
  CFB6  CD8DD7        		CALL	MSG_
                      	
  CFB9  2A6AFF        		LD	HL,(DTA+1+24)
  CFBC  7D            		LD	A,L
  CFBD  B7            		OR	A
  CFBE  C8            		RET	Z
  CFBF  CB3C          		SRL	H
  CFC1  17            		RLA
  CFC2  17            		RLA
  CFC3  17            		RLA
  CFC4  17            		RLA
  CFC5  E60F          		AND	00FH
  CFC7  57            		LD	D,A
  CFC8  7C            		LD	A,H
  CFC9  C650          		ADD	A,80
  CFCB  CD10D0        		CALL	PRTA
  CFCE  3E2D          		LD	A,'-'
  CFD0  CD8DD7        		CALL	MSG_
  CFD3  7A            		LD	A,D
  CFD4  CD10D0        		CALL	PRTA
  CFD7  3E2D          		LD	A,'-'
  CFD9  CD8DD7        		CALL	MSG_
  CFDC  7D            		LD	A,L
  CFDD  E61F          		AND	01FH
  CFDF  CD10D0        		CALL	PRTA
                      	
  CFE2  2A68FF        		LD	HL,(DTA+1+22)
                      	
  CFE5  3E20          		LD	A,020H
  CFE7  CD8DD7        		CALL	MSG_
  CFEA  7C            		LD	A,H
  CFEB  65            		LD	H,L
  CFEC  1F            		RRA
  CFED  CB1D          		RR	L
  CFEF  1F            		RRA
  CFF0  CB1D          		RR	L
  CFF2  1F            		RRA
  CFF3  CB1D          		RR	L
  CFF5  E61F          		AND	01FH
  CFF7  CD10D0        		CALL	PRTA
  CFFA  3E3A          		LD	A,':'
  CFFC  CD8DD7        		CALL	MSG_
  CFFF  7D            		LD	A,L
  D000  0F            		RRCA
  D001  0F            		RRCA
  D002  E63F          		AND	03FH
  D004  CD10D0        		CALL	PRTA
  D007  3E3A          		LD	A,':'
  D009  CD8DD7        		CALL	MSG_
  D00C  7C            		LD	A,H
  D00D  E61F          		AND	01FH
  D00F  87            		ADD	A,A
                      	
                      	;	PRINT10
                      	
  D010                	PRTA:
  D010  E5            		PUSH	HL
  D011  0608          		LD	B,8
  D013  4F            		LD	C,A
  D014  AF            		XOR	A
  D015                	PRTA1:
  D015  CB01          		RLC	C
  D017  8F            		ADC	A,A
  D018  27            		DAA
  D019  10FA          		DJNZ	PRTA1
  D01B  21D600        		LD	HL,DECBF
  D01E  77            		LD	(HL),A
  D01F  AF            		XOR	A
  D020  CD84CF        		CALL	DECX
  D023  E1            		POP	HL
  D024  C9            		RET
                      	
  D025                	SETFCB:
  D025  CD72DD        		CALL	SPCUT
  D028  1A            		LD	A,(DE)
  D029  FE20          		CP	020H
  D02B  3801          		JR	C,SETFCBA
  D02D  1B            		DEC	DE
  D02E                	SETFCBA:
  D02E  D5            		PUSH	DE
  D02F  215C00        		LD	HL,FCB1
  D032  115D00        		LD	DE,FCB1+1
  D035  012300        		LD	BC,00023H
  D038  70            		LD	(HL),B		;B=0
  D039  EDB0          		LDIR
  D03B  D1            		POP	DE
  D03C  D5            		PUSH	DE
  D03D  215C00        		LD	HL,FCB1
  D040  CD3BD6        		CALL	_SYS29		;(BDOS)ファイル名の解析
  D043  216C00        		LD	HL,FCB2
  D046  CD3BD6        		CALL	_SYS29		;(BDOS)ファイル名の解析
  D049  E1            		POP	HL
  D04A  010050        		LD	BC,05000H
  D04D  118100        		LD	DE,00081H
  D050                	SETFCB1:
  D050  7E            		LD	A,(HL)
  D051  23            		INC	HL
  D052  FE20          		CP	020H
  D054  3805          		JR	C,SETFCB2
  D056  12            		LD	(DE),A
  D057  13            		INC	DE
  D058  0C            		INC	C
  D059  10F5          		DJNZ	SETFCB1
  D05B                	SETFCB2:
  D05B  79            		LD	A,C
  D05C  328000        		LD	(DTA1),A
  D05F  04            		INC	B
  D060  AF            		XOR	A
  D061                	SETFCB3:
  D061  12            		LD	(DE),A
  D062  13            		INC	DE
  D063  10FC          		DJNZ	SETFCB3
  D065  C9            		RET
                      	
  D066                	C_COPY:
  D066  CD25D0        		CALL	SETFCB
  D069  118100        		LD	DE,DTA1+1
  D06C  0E2F          		LD	C,'/'
  D06E  CD46CE        		CALL	SWITCH
  D071  CDBCDF        		CALL	CAP
  D074  32FCD0        		LD	(SW+1),A
                      	
  D077  1170EB        		LD	DE,BEEPD
  D07A  CD90DC        		CALL	FILEC2
  D07D  216C00        		LD	HL,FCB2
  D080  CD42D6        		CALL	S29X1
                      	
  D083  3E10          		LD	A,010H
  D085  326900        		LD	(FCB1+13),A
  D088  216D00        		LD	HL,FCB2+1
  D08B  CDC5D1        		CALL	CWILD1
  D08E                	COPY0:
  D08E  CDC2D1        		CALL	CWILD
  D091  215C00        		LD	HL,FCB1
  D094  CD31CD        		CALL	OPEN
  D097  37            		SCF
  D098                	COPY1:
  D098  C0            		RET	NZ
  D099  CD45CD        		CALL	DEFCB
                      	
  D09C  3A5EFF        		LD	A,(DTA+13)
  D09F  CB67          		BIT	4,A
  D0A1  2824          		JR	Z,COPY1A
                      	
  D0A3  215D00        		LD	HL,FCB1+1
  D0A6  CDF1E0        		CALL	CHKWILD
  D0A9  3817          		JR	C,COPY9
                      	
  D0AB  3E20          		LD	A,020H
  D0AD  325D00        		LD	(FCB1+1),A
  D0B0  2A6BFF        		LD	HL,(DTA+26)
  D0B3  23            		INC	HL
  D0B4  226A00        		LD	(FCB1+14),HL
  D0B7  18D5          		JR	COPY0
                      	
  D0B9                	COPYS:
  D0B9  1170D2        		LD	DE,SKIP
  D0BC                	COPY8:
  D0BC  CDB4D3        		CALL	_SYS09		;(BDOS)文字列出力
  D0BF  CD15CF        		CALL	LTNL
  D0C2                	COPY9:
  D0C2  CD41CD        		CALL	OPEN2
  D0C5  18D1          		JR	COPY1
                      	
  D0C7                	COPY1A:
  D0C7  216C00        		LD	HL,FCB2
  D0CA  11DB00        		LD	DE,FDRV
  D0CD  0153FF        		LD	BC,DTA+2
  D0D0  EDA0          		LDI
  D0D2  3E0B          		LD	A,11
  D0D4                	COPY2:
  D0D4  F5            		PUSH	AF
  D0D5  7E            		LD	A,(HL)
  D0D6  FE3F          		CP	'?'
  D0D8  2001          		JR	NZ,COPY3
  D0DA  0A            		LD	A,(BC)
  D0DB                	COPY3:
  D0DB  12            		LD	(DE),A
  D0DC  03            		INC	BC
  D0DD  13            		INC	DE
  D0DE  23            		INC	HL
  D0DF  F1            		POP	AF
  D0E0  3D            		DEC	A
  D0E1  20F1          		JR	NZ,COPY2
  D0E3  010500        		LD	BC,16-11
  D0E6  EDB0          		LDIR
  D0E8                	PUTNAME:
  D0E8  215D00        		LD	HL,FCB1+1
  D0EB  CDF1E0        		CALL	CHKWILD
  D0EE  300B          		JR	NC,PUTN1
  D0F0  21DC00        		LD	HL,FDRV+1
  D0F3  CD92CF        		CALL	FPRNT
  D0F6  3E20          		LD	A,020H
  D0F8  CD8DD7        		CALL	MSG_
  D0FB                	PUTN1:
  D0FB  3E00          	SW:	LD	A,000H
  D0FD  FE54          		CP	'T'
  D0FF  2005          		JR	NZ,CSW1
  D101  211BD1        		LD	HL,SWNE
  D104  1807          		JR	SWT1
  D106                	CSW1:
  D106  FE4E          		CP	'N'
  D108  2011          		JR	NZ,SWNE
  D10A  21B9D0        		LD	HL,COPYS
  D10D                	SWT1:
  D10D  11DB00        		LD	DE,FDRV
  D110  CD5FCD        		CALL	SYSC0F
  D113  2801          		JR	Z,SWN1
  D115  E9            		JP	(HL)
  D116                	SWN1:
  D116  CD74D1        		CALL	CTIME
  D119  309E          		JR	NC,COPYS
  D11B                	SWNE:
  D11B  11DB00        		LD	DE,FDRV
  D11E  0E16          		LD	C,016H		;(BDOS)ファイルの作成
  D120  CD61CD        		CALL	SYSTEM0
  D123  204D          		JR	NZ,COPYE2
  D125  67            		LD	H,A		;A=0
  D126  6F            		LD	L,A
  D127  22FC00        		LD	(FDRV+33),HL
  D12A  32FE00        		LD	(FDRV+35),A
  D12D                	COPY6:
  D12D  CDD4D1        		CALL	BUFSIZ
  D130  CD71CD        		CALL	S27DTA
  D133  47            		LD	B,A
  D134  3C            		INC	A
  D135  2833          		JR	Z,COPYE
  D137  7C            		LD	A,H
  D138  B5            		OR	L
  D139  280E          		JR	Z,COPY7
  D13B  11DB00        		LD	DE,FDRV
  D13E  0E26          		LD	C,026H		;(BDOS)ランダム・ブロック・ライト
  D140  CD0500        		CALL	SYSTEM
  D143  B7            		OR	A
  D144  2024          		JR	NZ,COPYE
  D146  05            		DEC	B
  D147  20E4          		JR	NZ,COPY6
  D149                	COPY7:
  D149  3A5EFF        		LD	A,(DTA+13)
  D14C  32E800        		LD	(FDRV+13),A
  D14F  2165FF        		LD	HL,DTA+20
  D152  11EF00        		LD	DE,FDRV+20
  D155  010400        		LD	BC,4
  D158  EDB0          		LDIR
                      	
  D15A  11DB00        		LD	DE,FDRV
  D15D  0E10          		LD	C,010H		;(BDOS)ファイルのクローズ
  D15F  CD61CD        		CALL	SYSTEM0
  D162  2006          		JR	NZ,COPYE
                      	
  D164  116DD2        		LD	DE,OK
  D167  C3BCD0        		JP	COPY8
                      	
  D16A                	COPYE:
  D16A  11DB00        		LD	DE,FDRV
  D16D  0E13          		LD	C,013H		;(BDOS)ファイルの削除
  D16F  CD0500        		CALL	SYSTEM
  D172                	COPYE2:
  D172  37            		SCF
  D173  C9            		RET
                      	
  D174                	CTIME:
  D174  ED5B65FF      		LD	DE,(DTA+20)
  D178  2AEF00        		LD	HL,(FDRV+20)
  D17B  A7            		AND	A
  D17C  ED52          		SBC	HL,DE
  D17E  C0            		RET	NZ
  D17F  ED5B67FF      		LD	DE,(DTA+22)
  D183  2AF100        		LD	HL,(FDRV+22)
  D186  ED52          		SBC	HL,DE
  D188  C9            		RET
                      	
  D189                	C_TYPE:
  D189  CD25D0        		CALL	SETFCB
  D18C  215C00        		LD	HL,FCB1
  D18F  CD31CD        		CALL	OPEN
  D192  37            		SCF
  D193                	TYPE1:
  D193  C0            		RET	NZ
  D194  CD45CD        		CALL	DEFCB
  D197  1E1A          		LD	E,01AH
  D199  CDCDEC        		CALL	_PRINT
  D19C                	TYPE2:
  D19C  CDD4D1        		CALL	BUFSIZ
  D19F  CD71CD        		CALL	S27DTA
  D1A2  C6FE          		ADD	A,0FEH
  D1A4  D8            		RET	C
  D1A5  7C            		LD	A,H
  D1A6  B5            		OR	L
  D1A7  2814          		JR	Z,TYPEE
  D1A9  010001        		LD	BC,00100H
  D1AC                	TYPE3:
  D1AC  0A            		LD	A,(BC)
  D1AD  03            		INC	BC
  D1AE  FE1A          		CP	01AH
  D1B0  280B          		JR	Z,TYPEE
  D1B2  5F            		LD	E,A
  D1B3  CD96D7        		CALL	_SYS02		;(BDOS)コンソール出力
  D1B6  2B            		DEC	HL
  D1B7  7C            		LD	A,H
  D1B8  B5            		OR	L
  D1B9  20F1          		JR	NZ,TYPE3
  D1BB  18DF          		JR	TYPE2
  D1BD                	TYPEE:
  D1BD  CD41CD        		CALL	OPEN2
  D1C0  18D1          		JR	TYPE1
                      	
  D1C2                	CWILD:
  D1C2  215D00        		LD	HL,FCB1+1
  D1C5                	CWILD1:
  D1C5  7E            		LD	A,(HL)
  D1C6  FE20          		CP	020H
  D1C8  C0            		RET	NZ
  D1C9                	CWILD2:
  D1C9  54            		LD	D,H
  D1CA  5D            		LD	E,L
  D1CB  13            		INC	DE
  D1CC  010A00        		LD	BC,10
  D1CF  363F          		LD	(HL),'?'
  D1D1  EDB0          		LDIR
  D1D3  C9            		RET
                      	
  D1D4                	BUFSIZ:
  D1D4  3A0700        		LD	A,(SYSTEM+2)
  D1D7  D603          		SUB	3
  D1D9  E6F8          		AND	0F8H
  D1DB  67            		LD	H,A
  D1DC  2E00          		LD	L,0
  D1DE  C9            		RET
                      	
  0040                	PATHX	EQU	64
  D1DF                	PATHD:	DS	PATHX
  D21F  00            	PATHE:	DB	0
                      	
  0009                	COMS	EQU	9
  D220                	COMTB:
  D220  44202020      		DB	"D   "	;1
  D224  6ECE          		DW	C_DIR
  D226  44495220      		DB	"DIR "	;2
  D22A  6ECE          		DW	C_DIR
  D22C  434F5059      		DB	"COPY"	;3
  D230  66D0          		DW	C_COPY
  D232  43442020      		DB	"CD  "	;4
  D236  66CD          		DW	C_CD
  D238  44454C20      		DB	"DEL "	;5
  D23C  51CE          		DW	C_DEL
  D23E  50415448      		DB	"PATH"	;6
  D242  1FCF          		DW	C_PATH
  D244  52454E20      		DB	"REN "	;7
  D248  5BCE          		DW	C_REN
  D24A  54595045      		DB	"TYPE"	;8
  D24E  89D1          		DW	C_TYPE
  D250  52454D20      		DB	"REM "	;9
  D254  4FCE          		DW	C_REM
                      	
  D256  6B206279746573	KBFREE:	DB	"k bytes free",9,'$'
  D264  2020203C444952	DIRMES:	DB	"   <DIR>$"
  D26D  4F4B24        	OK:	DB	"OK$"
  D270  536B697024    	SKIP:	DB	"Skip$"
  D275  4572726F722124	COMERM:	DB	"Error!$"
                      	
                      	;LDDISK2.ASM
                      	
                      	;	LSX-Dodgers DISK2
                      	
                      	
                      	;	GRAPHIC RAM DISK DRIVER
                      	
                      	
  D27C                	GDRD:
  D27C  CD92D2        		CALL	GADR
  D27F                	GDRDC1:
  D27F  EDA2          		INI
  D281  04            		INC	B
  D282  0C            		INC	C
  D283  20FA          		JR	NZ,GDRDC1
  D285  1817          		JR	S1FD0
                      	
  D287                	GDWT:
  D287  CD92D2        		CALL	GADR
  D28A                	GDWTC1:
  D28A  04            		INC	B
  D28B  EDA3          		OUTI
  D28D  0C            		INC	C
  D28E  20FA          		JR	NZ,GDWTC1
  D290  180C          		JR	S1FD0
                      	
  D292                	GADR:
  D292  0E00          		LD	C,0
  D294  7B            		LD	A,E
  D295  C640          		ADD	A,040H
  D297  47            		LD	B,A
  D298  13            		INC	DE
  D299  3ABFEC        		LD	A,(WK1FD0)
  D29C  F610          		OR	010H		;BANK1
  D29E                	S1FD0:
  D29E  C5            		PUSH	BC
  D29F  32BFEC        		LD	(WK1FD0),A
  D2A2  01D01F        		LD	BC,01FD0H
  D2A5  ED79          		OUT	(C),A
  D2A7  C1            		POP	BC
  D2A8  E6EF          		AND	0EFH		;BANK0
  D2AA  C9            		RET
                      	
                      	
                      	;	BANK RAM DISK DRIVER
                      	
                      	
  D2AB                	BDRDC:
  D2AB  ED73CAD2      		LD	(BANKSP+1),SP
  D2AF  3ACBD2        		LD	A,(BANKSP+2)
  D2B2  87            		ADD	A,A
  D2B3  3803          		JR	C,BDRDC1
  D2B5  31D4FF        		LD	SP,EXTSP
  D2B8                	BDRDC1:
  D2B8  D5            		PUSH	DE
  D2B9  D9            		EXX
  D2BA  C5            		 PUSH	 BC
  D2BB  D5            		 PUSH	 DE
  D2BC  CDF0D2        		 CALL	 BADR
  D2BF  CD0DD3        		CALL	BTFR
  D2C2  D9            		EXX
  D2C3                	BDWTCE:
  D2C3  D1            		 POP	 DE
  D2C4  C1            		 POP	 BC
  D2C5  D9            		 EXX
  D2C6  D1            		POP	DE
  D2C7  13            		INC	DE
  D2C8  AF            		XOR	A
  D2C9  310000        	BANKSP:	LD	SP,0
  D2CC  FB            		EI
  D2CD  C9            		RET
                      	
  D2CE                	BDWTC:
  D2CE  ED73CAD2      		LD	(BANKSP+1),SP
  D2D2  3ACBD2        		LD	A,(BANKSP+2)
  D2D5  87            		ADD	A,A
  D2D6  3803          		JR	C,BDWTC1
  D2D8  31D4FF        		LD	SP,EXTSP
  D2DB                	BDWTC1:
  D2DB  D5            		PUSH	DE
  D2DC  D9            		EXX
  D2DD  C5            		 PUSH	 BC
  D2DE  D5            		 PUSH	 DE
  D2DF  CDF0D2        		 CALL	 BADR
  D2E2  D9            		EXX
  D2E3  53            		 LD	D,E
  D2E4  5F            		 LD	E,A
  D2E5  D9            		 EXX
  D2E6  EB            		EX	DE,HL
  D2E7  CD0DD3        		CALL	BTFR
  D2EA  EB            		EX	DE,HL
  D2EB  D9            		EXX
  D2EC  ED51          		 OUT	 (C),D	 ;MAIN
  D2EE  18D3          		 JR	 BDWTCE
                      	
  D2F0                	BADR:
  D2F0  D9            		 EXX
  D2F1  7B            		LD	A,E
  D2F2  87            		ADD	A,A
  D2F3  CB12          		RL	D
  D2F5  87            		ADD	A,A
  D2F6  CB12          		RL	D
  D2F8  F5            		PUSH	AF
  D2F9  87            		ADD	A,A
  D2FA  7A            		LD	A,D
  D2FB  8F            		ADC	A,A
  D2FC  E60F          		AND	00FH
  D2FE  D9            		EXX
  D2FF  01000B        		 LD	 BC,00B00H
  D302  57            		 LD	 D,A	  ;BANK
  D303  1E10          		 LD	 E,010H	  ;MAIN
  D305  D9            		 EXX
  D306  D1            		POP	DE
  D307  0600          		LD	B,0
  D309  58            		LD	E,B
  D30A  CBBA          		RES	7,D
  D30C  C9            		RET
                      	
  D30D                	BTFR:
  D30D  D5            		PUSH	DE
  D30E  F3            		DI
                      	
  D30F                	BTFR1:
  D30F  D9            		EXX
  D310  ED51          		 OUT	 (C),D	 ;BANK(MAIN)
  D312  D9            		 EXX
  D313  E3            		EX	(SP),HL
  D314  7E            		LD	A,(HL)
  D315  23            		INC	HL
  D316  4E            		LD	C,(HL)
  D317  23            		INC	HL
  D318  56            		LD	D,(HL)
  D319  23            		INC	HL
  D31A  5E            		LD	E,(HL)
  D31B  23            		INC	HL
  D31C  E3            		EX	(SP),HL
  D31D  D9            		EXX
  D31E  ED59          		 OUT	 (C),E	 ;MAIN(BANK)
  D320  D9            		 EXX
  D321  77            		LD	(HL),A
  D322  23            		INC	HL
  D323  71            		LD	(HL),C
  D324  23            		INC	HL
  D325  72            		LD	(HL),D
  D326  23            		INC	HL
  D327  73            		LD	(HL),E
  D328  23            		INC	HL
  D329  10E4          		DJNZ	BTFR1
  D32B  D1            		POP	DE
  D32C  C9            		RET
                      	
                      	
                      	;	EMM DRIVER(DMA)
                      	
                      	
  D32D                	EDWTC:
  D32D  3E0F          		LD	A,15
  D32F  01            		DB	1
  D330                	EDRDC:
  D330  3E0E          		LD	A,14
  D332                	EDWTC1:
  D332  D5            		PUSH	DE
  D333  226CD3        		LD	(DMAB),HL
  D336  EB            		EX	DE,HL
  D337  29            		ADD	HL,HL
  D338  29            		ADD	HL,HL
  D339  ED4BA0EC      		LD	BC,(_MAXCYL-1)
  D33D  0E00          		LD	C,0
  D33F  09            		ADD	HL,BC
  D340  ED4B84EC      		LD	BC,(_DRIVE)
  D344  060D          		LD	B,00DH
  D346  ED49          		OUT	(C),C
  D348  0C            		INC	C
  D349  ED69          		OUT	(C),L
  D34B  0C            		INC	C
  D34C  ED61          		OUT	(C),H
                      	
  D34E  2160D3        		LD	HL,EDMAD
  D351  CD73DB        		CALL	SETDMA
  D354  CD9BDB        		CALL	GO_DMA
  D357  EB            		EX	DE,HL
  D358  24            		INC	H
  D359  24            		INC	H
  D35A  24            		INC	H
  D35B  24            		INC	H
  D35C  D1            		POP	DE
  D35D  13            		INC	DE
  D35E  AF            		XOR	A
  D35F  C9            		RET
                      	
  D360  C3            	EDMAD:	DB	0C3H	;WR6 リセット
  D361  7D            		DB	07DH	;WR0 ポートA→ポートB 転送
  D362  030D          		DW	00D03H	;ポートA開始アドレス EMMリード/ライト
  D364  FF03          		DW	003FFH	;ブロック長(転送サイズ-1)
  D366  2C            		DB	02CH	;WR1 ポートAアドレス固定 I/O
  D367  50            		DB	050H	;WR2 ポートBアドレスインクリメント メモリ
  D368  02            		DB	002H	;ポートBタイミング
  D369  80            		DB	080H	;WR3
  D36A  9A            		DB	09AH	;WR5 WAIT RDY:HIGH
  D36B  AD            		DB	0ADH	;WR4 連続 ポートB開始アドレス
  D36C  0000          	DMAB:	DW	0
  D36E  01            		DB	001H	;WR0 ポートB←ポートB 転送
                      	
  D36F                	EMME:
                      	
  07DF                	AT_RE	EQU	EDWTC-AT_EDWTC
                      	
                      	
                      	;LDOS.ASM
                      	
                      	;	LSX-Dodgers OS
                      	
  D36F                	BOOT:
  D36F  C30000        		JP	0
  D372                	_SYS00:		;(BDOS)プログラム終了
  D372                	WBOOT:
  D372  C350CC        		JP	WBOOT1
  D375                	CONST_:
  D375  C310D8        		JP	CONSTX
  D378                	_SYS07:		;(BDOS)コンソール直接入力
  D378                	CONIN:
  D378  C3B7D7        		JP	FLGET
  D37B                	CONOUT:
  D37B  C364DA        		JP	CONOUT1
                      	
  D37E                	BDOS0:
  D37E  E5            		PUSH	HL
  D37F  210001        		LD	HL,00100H
  D382  39            		ADD	HL,SP
  D383  3810          		JR	C,BDOS1X	;EXTSP = 0FFD4H
  D385                	BDOS2:
  D385  E1            		POP	HL
  D386  ED7391D3      		LD	(BDSP+1),SP
  D38A  31D4FF        		LD	SP,EXTSP
  D38D  CD94D3        		CALL	BDOS1
  D390  310000        	BDSP:	LD	SP,0
  D393  C9            		RET
  D394                	BDOS1:
  D394  E5            		PUSH	HL
  D395                	BDOS1X:
  D395  79            		LD	A,C
  D396  FE31          		CP	031H
  D398  300A          		JR	NC,OVERFN
  D39A  87            		ADD	A,A
  D39B  6F            		LD	L,A
  D39C  26EC          		LD	H,STABLE/256
  D39E  7E            		LD	A,(HL)
  D39F  2C            		INC	L
  D3A0  66            		LD	H,(HL)
  D3A1  6F            		LD	L,A
  D3A2  E3            		EX	(SP),HL
  D3A3  C9            		RET
  D3A4                	OVERFN
  D3A4  E1            		POP	HL
  D3A5  FE6F          		CP	06FH		;DOSVER MSX-DOS のバージョン番号の獲得
  D3A7  2006          		JR	NZ,_ERROR
  D3A9  011D01        		LD	BC,011DH
  D3AC  113601        		LD	DE,VER
  D3AF                	_ERROR:
  D3AF                	_SYS04:		;(BDOS)外部出力
  D3AF                	_SYS05:		;(BDOS)プリンタ出力
  D3AF                	_SYS1C:		;(BDOS)ディスクの書き込み禁止化
  D3AF                	_SYS1E:		;(BDOS)ファイル属性の設定
  D3AF                	_SYS20:		;(BDOS)利用者番号の設定と読み出し
  D3AF                	_SYS2E:		;(BDOS)ベリファイ・フラグの設定
  D3AF  AF            		XOR	A
  D3B0  C9            		RET
  D3B1                	_SYS03:		;(BDOS)外部入力
  D3B1                	_SYS2B:		;(BDOS)日付の設定
  D3B1                	_SYS2D:		;(BDOS)時刻の設定
  D3B1  37            		SCF			;CF=1
  D3B2  9F            		SBC	A,A		;A=0FFH
  D3B3  C9            		RET
                      	
  D3B4                	_SYS09:		;文字列出力
  D3B4  D5            		PUSH	DE
  D3B5                	_SX09:
  D3B5  1A            		LD	A,(DE)
  D3B6  13            		INC	DE
  D3B7  FE24          		CP	'$'
  D3B9  282C          		JR	Z,SX0E2
  D3BB  D5            		PUSH	DE
  D3BC  5F            		LD	E,A
  D3BD  CD96D7        		CALL	_SYS02
  D3C0  D1            		POP	DE
  D3C1  18F2          		JR	_SX09
                      	
  D3C3                	_SYS0C:		;(BDOS)バージョン番号の獲得
  D3C3  212200        		LD	HL,00022H
  D3C6  AF            		XOR	A
  D3C7  7D            		LD	A,L
  D3C8  C9            		RET
                      	
  D3C9                	_SYS0D:		;(BDOS)ディスク・リセット
  D3C9  CDDFEC        		CALL	_FFLUSH
  D3CC  E5            		PUSH	HL
  D3CD  218000        		LD	HL,00080H
  D3D0  228AEC        		LD	(_DTA),HL
  D3D3  E1            		POP	HL
  D3D4  D5            		PUSH	DE
  D3D5  1E00          		LD	E,0
  D3D7  3E            		DB	03EH
                      	
  D3D8                	_SYS0E:		;(BDOS)カレント・ドライブの設定
  D3D8  D5            		PUSH	DE
  D3D9  7B            		LD	A,E
  D3DA  DDE5          		PUSH	IX
  D3DC  CDDCEC        		CALL	_GETDPB
  D3DF  DDE1          		POP	IX
  D3E1  3804          		JR	C,SX0E2
  D3E3  7B            		LD	A,E
  D3E4  3287EC        		LD	(_DVSW),A
  D3E7                	SX0E2:
  D3E7  3E08          		LD	A,8
  D3E9  D1            		POP	DE
  D3EA  C9            		RET
                      	
  D3EB                	_SYS0F:		;(BDOS)ファイルのオープン
  D3EB  CD84DD        		CALL	SETDRV
  D3EE  FD7E1C        		LD	A,(IY+28)	;(FCB)オープン・モード
  D3F1  C602          		ADD	A,002H		;Write
  D3F3  2848          		JR	Z,FEND0F
  D3F5  CDEDE0        		CALL	CHKWILDX
                      	
  D3F8  D4A4DD        		CALL	NC,SOPENX
  D3FB                	_S16XX:
  D3FB  3840          		JR	C,FEND0F
                      					;Directory location
  D3FD  3A9FEC        		LD	A,(_FILEN)
  D400  FD7719        		LD	(IY+25),A	;(FCB)ディレクトリ・ロケーション
                      	;				_DIRF
  D403  3AA0EC        		LD	A,(_DIRF)
  D406  FD771D        		LD	(IY+29),A	;(FCB)ディレクトリ・モード
                      	;				_FBPS
  D409  FD731E        		LD	(IY+30),E	;(FCB)ディレクトリ・ポジション
  D40C  FD721F        		LD	(IY+31),D
                      	;				Open(Read)
  D40F  FD361CFF      		LD	(IY+28),0FFH	;(FCB)オープン・モード
                      	;				FILENAME
  D413  FDE5          		PUSH	IY
  D415  D1            		POP	DE
  D416  13            		INC	DE
  D417  010B00        		LD	BC,11
  D41A  EDB0          		LDIR
                      	;				Attribute
  D41C  7E            		LD	A,(HL)
  D41D  FD770D        		LD	(IY+13),A	;(FCB)属性(アトリビュート)
  D420  110B00        		LD	DE,11		;Reserved
  D423  19            		ADD	HL,DE
                      						;(FCB)ファイルを最後に変更した時刻
  D424  11EAEB        		LD	DE,SDDATA		;(FCB)ファイルを最後に変更した日付
  D427  060A          		LD	B,SDDATAE-SDDATA	;(FCB)ファイルの先頭クラスタ
  D429                	S16LOOP:				;(FCB)ファイルのサイズ(バイト単位)
  D429  1A            		LD	A,(DE)
  D42A  13            		INC	DE
  D42B  3232D4        		LD	(S16PAT+2),A
  D42E  7E            		LD	A,(HL)
  D42F  23            		INC	HL
  D430  FD7700        	S16PAT:	LD	(IY+0),A
  D433  10F4          		DJNZ	S16LOOP
                      	
  D435  AF            		XOR	A
  D436  FD770C        		LD	(IY+12),A	;(FCB)カレント・ブロック
  D439  FD220AD5      		LD	(OFCB+1),IY
  D43D                	FEND0F:
  D43D  C3F1D4        		JP	FEND
                      	
  D440                	_SYS10:		;(BDOS)ファイルのクローズ
  D440  CD84DD        		CALL	SETDRV
  D443  FD7E1C        		LD	A,(IY+28)	;(FCB)オープン・モード
  D446  D6FE          		SUB	0FEH
  D448  37            		SCF
  D449  3F            		CCF
  D44A  2037          		JR	NZ,FEND10
  D44C                	_S10A:				;Write
  D44C  FD770E        		LD	(IY+14),A	;(FCB)レコード・サイズ/アクセスするディレクトリのクラスタ番号+1
  D44F  FD770F        		LD	(IY+15),A
                      	
  D452  FD341C        		INC	(IY+28)		;0FEH->0FFH ;オープン・モード
  D455  CDDBE1        		CALL	SETTMS
                      	
  D458  FD7E1D        		LD	A,(IY+29)	;(FCB)ディレクトリ・モード
  D45B  32A0EC        		LD	(_DIRF),A
  D45E  E67F          		AND	07FH
  D460  32EAE6        		LD	(_SECPS+1),A
  D463  FD5E1E        		LD	E,(IY+30)	;(FCB)ディレクトリ・ポジション
  D466  FD561F        		LD	D,(IY+31)
  D469  CDDDDE        		CALL	READ_DIR
  D46C  3815          		JR	C,FEND10
                      	
  D46E  FD7E19        		LD	A,(IY+25)	;(FCB)ディレクトリ・ロケーション
  D471  E61F          	SDECM1:	AND	01FH		;自己書き換え(1セクタ辺りのディレクトリエントリ数-1) 1024=01FH / 512=00FH / 256=7
  D473  6F            		LD	L,A
  D474  2600          		LD	H,0
  D476  29            		ADD	HL,HL		;*2
  D477  29            		ADD	HL,HL		;*4
  D478  29            		ADD	HL,HL		;*8
  D479  29            		ADD	HL,HL		;*16
  D47A  29            		ADD	HL,HL		;*32
  D47B  ED4B7EEC      		LD	BC,(_DTBUF)
  D47F  09            		ADD	HL,BC
                      	
  D480  CDFDE0        		CALL	SDIRENT
  D483                	FEND10:
  D483  186C          		JR	FEND
                      	
  D485                	OPENDD:
  D485  FD361CFD      		LD	(IY+28),0FDH	;(FCB)オープン・モード
  D489  FD360D20      		LD	(IY+13),020H	;(FCB)属性(アトリビュート)
  D48D  CDE0E1        		CALL	SETTMSX
  D490  185F          		JR	FEND
                      	
  D492                	_SYS11:		;(BDOS)最初のファイルの検索
  D492  CD84DD        		CALL	SETDRV
  D495  CD24DF        		CALL	CHKDDX
  D498  3818          		JR	C,_S11A
  D49A  FDE5          		PUSH	IY
  D49C  E1            		POP	HL
  D49D  ED5B8AEC      		LD	DE,(_DTA)
  D4A1  010C00        		LD	BC,12
  D4A4  EDB0          		LDIR
  D4A6  3E20          		LD	A,020H
  D4A8  12            		LD	(DE),A
  D4A9  13            		INC	DE
  D4AA  62            		LD	H,D
  D4AB  6B            		LD	L,E
  D4AC  13            		INC	DE
  D4AD  0E13          		LD	C,19
  D4AF  70            		LD	(HL),B
  D4B0  183D          		JR	_S11B
  D4B2                	_S11A:
  D4B2  CDD8DD        		CALL	SOPEN
  D4B5                	_S12X1:
  D4B5  383A          		JR	C,FEND
  D4B7  CD78DE        		CALL	SOPENE2
  D4BA  ED5B8AEC      		LD	DE,(_DTA)
  D4BE  3A88EC        		LD	A,(_DRV)
  D4C1  3C            		INC	A
  D4C2  12            		LD	(DE),A
  D4C3  D5            		PUSH	DE
  D4C4  13            		INC	DE
  D4C5  012000        		LD	BC,32
  D4C8  EDB0          		LDIR
  D4CA  FD6E0E        		LD	L,(IY+14)	;(FCB)レコード・サイズ/アクセスするディレクトリのクラスタ番号+1
  D4CD  FD660F        		LD	H,(IY+15)
  D4D0  22F4EB        		LD	(SCDIR),HL
  D4D3  2A9AEC        		LD	HL,(_FBPS)
  D4D6  22F6EB        		LD	(SFBPS),HL
  D4D9  2A9FEC        		LD	HL,(_FILEN)
  D4DC  7C            		LD	A,H
  D4DD  B7            		OR	A
  D4DE  2806          		JR	Z,_S12DIR
  D4E0  3AEAE6        		LD	A,(_SECPS+1)
  D4E3  F680          		OR	080H
  D4E5  67            		LD	H,A
  D4E6                	_S12DIR
  D4E6  22F8EB        		LD	(SFNDF),HL	;Directory position and Flags
  D4E9  E1            		POP	HL
  D4EA  1186E2        		LD	DE,SFILE
  D4ED  0E21          		LD	C,33
  D4EF                	_S11B:
  D4EF  EDB0          		LDIR
  D4F1                	FEND:
  D4F1  9F            		SBC	A,A		;CF=0 A=0 : CF=1 A=0FFH
  D4F2                	FENDE:
  D4F2  FDE1          		POP	IY
  D4F4  C1            		POP	BC
  D4F5  D1            		POP	DE
  D4F6  E1            		POP	HL
  D4F7  C9            		RET
                      	
  D4F8                	_SYS12:		;(BDOS)次のファイルの検索
  D4F8  E5            		PUSH	HL
  D4F9  D5            		PUSH	DE
  D4FA  C5            		PUSH	BC
  D4FB  FDE5          		PUSH	IY
  D4FD  CD3CDE        		CALL	NOPEN
  D500  18B3          		JR	_S12X1
                      	
  D502                	_S16K:
  D502  FD7E1C        		LD	A,(IY+28)	;(FCB)オープン・モード
  D505  FEFD          		CP	0FDH		;Device(0FDH)
  D507  37            		SCF
  D508  C8            		RET	Z
                      	
  D509  110000        	OFCB:	LD	DE,0
  D50C  D5            		PUSH	DE
  D50D  061A          		LD	B,26		;First cluster
  D50F                	S16K1:
  D50F  13            		INC	DE
  D510  23            		INC	HL
  D511  10FC          		DJNZ	S16K1
                      	
  D513  1A            		LD	A,(DE)
  D514  BE            		CP	(HL)
  D515  2013          		JR	NZ,S16K2
  D517  13            		INC	DE
  D518  23            		INC	HL
  D519  1A            		LD	A,(DE)
  D51A  BE            		CP	(HL)
  D51B  200D          		JR	NZ,S16K2
                      	
  D51D  E1            		POP	HL
  D51E  FDE5          		PUSH	IY
  D520  D1            		POP	DE
  D521  1A            		LD	A,(DE)		;Drive
  D522  BE            		CP	(HL)
  D523  2005          		JR	NZ,S16K2
                      					;ここはCFが必ず0
  D525  ED52          		SBC	HL,DE		;CP HL,DE
  D527  37            		SCF
  D528  C0            		RET	NZ
  D529  E5            		PUSH	HL
  D52A                	S16K2:
  D52A  E1            		POP	HL
  D52B  FDE5          		PUSH	IY
  D52D  D1            		POP	DE
  D52E                	_SYS13:		;(BDOS)ファイルの削除
  D52E  CD84DD        		CALL	SETDRV
  D531  CD17E0        		CALL	KILL
  D534                	FEND13:
  D534  18BB          		JR	FEND
                      	
  D536                	_SYS14:		;(BDOS)シーケンシャルな読み出し
  D536  CD84DD        		CALL	SETDRV
  D539  CD0DE2        		CALL	PUSHRR
  D53C  CD4EE2        		CALL	GETSEQ
                      	
  D53F  CD62E2        		CALL	RB_READ
  D542  E5            		PUSH	HL
  D543  CD21E2        		CALL	SETSEQ
  D546                	SREAD:
  D546  E1            		POP	HL
                      	
  D547  C601          		ADD	A,001H
  D549  38A6          		JR	C,FEND
                      	
  D54B  7D            		LD	A,L
  D54C  D601          		SUB	001H
  D54E                	FENDX:
  D54E  9F            		SBC	A,A
  D54F  E603          		AND	3
  D551  1F            		RRA
  D552  189E          		JR	FENDE
                      	
  D554                	_SYS15:		;(BDOS)シーケンシャルな書き込み
  D554  CD84DD        		CALL	SETDRV
  D557  CD0DE2        		CALL	PUSHRR
  D55A  CD4EE2        		CALL	GETSEQ
                      	
  D55D  CD5BE2        		CALL	RB_WRITE
  D560  E5            		PUSH	HL
  D561  CD21E2        		CALL	SETSEQ
  D564                	SWRITE:
  D564  E1            		POP	HL
                      	
  D565  C6FF          		ADD	A,0FFH
  D567  18E5          		JR	FENDX
                      	
  D569                	_SYS17:		;(BDOS)ファイル名の変更
  D569  CD84DD        		CALL	SETDRV
  D56C  CD73E0        		CALL	NAME
  D56F  18C3          		JR	FEND13
                      	
  D571                	_SYS16:		;(BDOS)ファイルの作成
  D571  CD84DD        		CALL	SETDRV
                      	
  D574  CDEDE0        		CALL	CHKWILDX
  D577  38BB          		JR	C,FEND13
  D579  FD7E01        		LD	A,(IY+1)	;(FCB)主ファイル名
  D57C  FE05          		CP	5
  D57E  2805          		JR	Z,_S16X2
  D580  FE21          		CP	021H
  D582  DA34D5        		JP	C,FEND13
  D585                	_S16X2:
                      	;				Clear FCB
  D585  FDE5          		PUSH	IY
  D587  E1            		POP	HL
  D588  011000        		LD	BC,16
  D58B  09            		ADD	HL,BC
  D58C                	_S16X1:
  D58C  70            		LD	(HL),B		;B=0
  D58D  23            		INC	HL
  D58E  0D            		DEC	C
  D58F  20FB          		JR	NZ,_S16X1
                      	
  D591  CDE0E1        		CALL	SETTMSX
  D594  FD360DFF      		LD	(IY+13),0FFH	;(FCB)Attribute
  D598  CDA4DD        		CALL	SOPENX
  D59B  3F            		CCF
  D59C  CC02D5        		CALL	Z,_S16K
  D59F  D489DE        		CALL	NC,COPEN
  D5A2  D4FDE0        		CALL	NC,SDIRENT
  D5A5  C3FBD3        		JP	_S16XX
                      	
  D5A8                	_SYS21:		;(BDOS)ランダムな読み出し
                      	
  D5A8  CD84DD        		CALL	SETDRV
  D5AB  CD0DE2        		CALL	PUSHRR
  D5AE  FD6E21        		LD	L,(IY+33)	;(FCB)Random record
  D5B1  FD6622        		LD	H,(IY+34)
                      	
  D5B4  CD62E2        		CALL	RB_READ
  D5B7  E5            		PUSH	HL
  D5B8  CD38E2        		CALL	POPRR
  D5BB  1889          		JR	SREAD
                      	
  D5BD                	_SYS22:		;(BDOS)ランダムな書き込み
  D5BD                	_SYS28:		;(BDOS)ランダムな書き込み・その2
  D5BD  CD84DD        		CALL	SETDRV
  D5C0  CD0DE2        		CALL	PUSHRR
  D5C3  FD6E21        		LD	L,(IY+33)	;(FCB)Random record
  D5C6  FD6622        		LD	H,(IY+34)
                      	
  D5C9  CD5BE2        		CALL	RB_WRITE
  D5CC  E5            		PUSH	HL
  D5CD  CD38E2        		CALL	POPRR
  D5D0  1892          		JR	SWRITE
                      	
  D5D2                	_SYS18:		;(BDOS)ログイン・ベクトルの獲得
  D5D2  21FF00        		LD	HL,000FFH
  D5D5  AF            		XOR	A
  D5D6  C9            		RET
                      	
  D5D7                	_SYS19:		;(BDOS)カレント・ドライブ番号の獲得
  D5D7  3A87EC        		LD	A,(_DVSW)
  D5DA  A7            		AND	A
  D5DB  C9            		RET
                      	
  D5DC                	_SYS1A:		;(BDOS)DTAの設定
  D5DC  ED538AEC      		LD	(_DTA),DE
  D5E0  AF            		XOR	A
  D5E1  C9            		RET
                      	
  D5E2                	_SYS1B:		;(BDOS)ディスク情報の獲得
  D5E2  7B            		LD	A,E
  D5E3  CD97DD        		CALL	GETDRV
  D5E6  CDDCEC        		CALL	_GETDPB
  D5E9  D4E2EC        		CALL	NC,_RDFATX
  D5EC  210000        		LD	HL,0
  D5EF  D4B9E1        		CALL	NC,DSKF
                      	
  D5F2  ED5BBAE1      		LD	DE,(MAXCLP+1)	;DPB_08_MAXCL-1
  D5F6  1B            		DEC	DE		;DE←クラスタの総数
  D5F7  FD2A7CEC      		LD	IY,(_FATBF)	;IY←メモリ上のFATの先頭アドレス
  D5FB  9F            		SBC	A,A
  D5FC  D8            		RET	C
  D5FD  4F            		LD	C,A		;C=0
  D5FE  DD7E0F        		LD	A,(IX+00FH)	;DPB_0F_BPS
  D601  E60F          		AND	00FH
  D603  47            		LD	B,A
  D604  DD7E07        		LD	A,(IX+7)	;DPB_07_SECPCL
  D607  C9            		RET
                      	
  D608                	_SYS1D:		;(BDOS)書き込みが禁止されているディスクの調査
  D608  AF            		XOR	A
  D609  67            		LD	H,A
  D60A  6F            		LD	L,A
  D60B  C9            		RET
                      	
  D60C                	_SYS1F:		;(BDOS)ディスク装置のパラメータの読み出し
  D60C  2100ED        		LD	HL,DEVICE
  D60F  7B            		LD	A,E
  D610  C3DCEC        		JP	_GETDPB
                      	
  D613                	_SYS23:		;(BDOS)ファイル・サイズの獲得
  D613  E5            		PUSH	HL
  D614  2A1EEC        		LD	HL,(STABLE+2*00FH)	;ファイルのオープン
  D617  CD0F00        		CALL	JP_HL
  D61A  3814          		JR	C,_S23X1
                      	
  D61C  D5            		PUSH	DE		;EX DE,IY
  D61D  FDE3          		EX	(SP),IY		;
                      	;	POP	DE		;
                      	;	PUSH	DE		;DEを破壊しないように注意vv
  D61F  CD3EE2        		CALL	GETSIZE
  D622                	_S24X1:
  D622  FD7521        		LD	(IY+33),L	;(FCB)Random record
  D625  FD7422        		LD	(IY+34),H
  D628  FD362300      		LD	(IY+35),0
                      	;	POP	DE		;^^^^^^^^^^^^^^^^^^^^^^^^
                      	;	PUSH	DE		;EX DE,IY
  D62C  FDE3          		EX	(SP),IY		;
  D62E  D1            		POP	DE		;
                      	
  D62F  AF            		XOR	A
  D630                	_S23X1:
  D630  E1            		POP	HL
  D631  C9            		RET
                      	
  D632                	_SYS24:		;(BDOS)ランダム・レコード・フィールドの設定
  D632  E5            		PUSH	HL
  D633  D5            		PUSH	DE		;EX DE,IY
  D634  FDE3          		EX	(SP),IY		;
                      	;	POP	DE		;
                      	;	PUSH	DE		;DEを破壊しないように注意vv
  D636  CD4EE2        		CALL	GETSEQ
  D639  18E7          		JR	_S24X1		;^^^^^^^^^^^^^^^^^^^^^^^^
                      	
  D63B                	_SYS29:		;(BDOS)ファイル名の解析
  D63B  C5            		PUSH	BC
  D63C  E5            		PUSH	HL
  D63D  CD98DC        		CALL	FILE
  D640  E1            		POP	HL
  D641  C1            		POP	BC
  D642                	S29X1:
  D642  C5            		PUSH	BC
  D643  D5            		PUSH	DE
  D644  E5            		PUSH	HL
  D645  EB            		EX	DE,HL
  D646  21DB00        		LD	HL,FDRV
  D649  010D00        		LD	BC,13
  D64C  EDB0          		LDIR
  D64E  70            		LD	(HL),B		;B=0
  D64F  0E03          		LD	C,3
  D651  EDB0          		LDIR
  D653  E1            		POP	HL
  D654  D1            		POP	DE
  D655  C1            		POP	BC
  D656  AF            		XOR	A
  D657  C9            		RET
                      	
  D658                	_SYS30:		;(BDOS)論理セクタを用いた書き込み
  D658  C5            		PUSH	BC
  D659  0159E8        		LD	BC,DWT16
  D65C  1804          		JR	S2FX
  D65E                	_SYS2F:
  D65E  C5            		PUSH	BC
  D65F  0149E8        		LD	BC,DRD16
  D662                	S2FX:
  D662  ED4377D6      		LD	(S2FPAT+1),BC
  D666  CDDFEC        		CALL	_FFLUSH
                      	
  D669  D5            		PUSH	DE
  D66A  E5            		PUSH	HL
  D66B  7D            		LD	A,L		;Drive
  D66C  CDD9EC        		CALL	_CHGDRV
  D66F  380D          		JR	C,S30X2
  D671  44            		LD	B,H		;Number of clusters
  D672  2A8AEC        		LD	HL,(_DTA)
  D675                	S30X:
  D675  C5            		PUSH	BC
  D676  CD49E8        	S2FPAT:	CALL	DRD16
  D679  C1            		POP	BC
  D67A  3802          		JR	C,S30X2
  D67C  10F7          		DJNZ	S30X
  D67E                	S30X2:
  D67E  E1            		POP	HL
  D67F  D1            		POP	DE
  D680  C1            		POP	BC
  D681  9F            		SBC	A,A
  D682  C9            		RET
                      	
                      	;LDIO.ASM
                      	
                      	;	LSX-Dodgers IO
                      	
                      	
  D683                	BIOS:
  D683  E5            		PUSH	HL
  D684  210081        		LD	HL,08100H
  D687  39            		ADD	HL,SP
  D688  E1            		POP	HL
  D689  300E          		JR	NC,BIOS2
  D68B                	BIOS1:
  D68B  CD93D6        		CALL	BIOS3
  D68E  061E          		LD	B,01EH
  D690  ED79          		OUT	(C),A
  D692  C9            		RET
  D693                	BIOS3:
  D693  C5            		PUSH	BC
  D694  061D          		LD	B,01DH
  D696  ED79          		OUT	(C),A
  D698  C9            		RET
  D699                	BIOS2:
  D699  ED73A4D6      		LD	(SPPAT+1),SP	;スタックがBIOS-ROMと被っている場合
  D69D  31D4FF        		LD	SP,EXTSP
  D6A0  CD8BD6        		CALL	BIOS1
  D6A3  310000        	SPPAT:	LD	SP,0
  D6A6  C9            		RET
                      	
  D6A7                	INT:
  D6A7  F5            		PUSH	AF
  D6A8  E5            		PUSH	HL
  D6A9  210001        		LD	HL,00100H
  D6AC  39            		ADD	HL,SP
  D6AD  380C          		JR	C,INTP1X
  D6AF  ED73B7D6      		LD	(INTSP+1),SP
  D6B3  CDC3D6        		CALL	INTP1
  D6B6  310000        	INTSP:	LD	SP,0
  D6B9  1803          		JR	INTPE
  D6BB                	INTP1X:
  D6BB  CDC3D6        		CALL	INTP1
  D6BE                	INTPE:
  D6BE  E1            		POP	HL
  D6BF                	INTPE2:
  D6BF  F1            		POP	AF
  D6C0                	INTCTCE:
  D6C0  FB            		EI
  D6C1  ED4D          		RETI
  D6C3                	INTP1:
  D6C3  C5            		PUSH	BC
                      	
  D6C4  CDA2DA        		CALL	IN49SB
  D6C7  67            		LD	H,A
  D6C8  CDA2DA        		CALL	IN49SB
  D6CB  6F            		LD	L,A
                      	
  D6CC  FE08          		CP	8		;DELキー
  D6CE  2005          		JR	NZ,SCEXE
  D6D0  7C            		LD	A,H
  D6D1  E611          		AND	011H		;CTRLキー + GRAPHキー
  D6D3  2808          		JR	Z,RESET
  D6D5                	SCEXE:
  D6D5  2292EC        		LD	(_KEYD),HL
  D6D8  CD09D7        		CALL	KEYSET1
                      	
  D6DB  C1            		POP	BC
  D6DC  C9            		RET
                      	
  D6DD                	RESET:
  D6DD  3E1D          		LD	A,01DH
  D6DF  D300          		OUT	(0),A
  D6E1  C7            		RST	0
                      	
  D6E2                	INTCTC2:
  D6E2  F5            		PUSH	AF
  D6E3  3E00          	INTCPAT:LD	A,000H
  D6E5  3D            		DEC	A
  D6E6  32E4D6        		LD	(INTCPAT+1),A
  D6E9  20D4          		JR	NZ,INTPE2
                      	
  D6EB  3A92EC        		LD	A,(_KEYD)
  D6EE  B7            		OR	A
  D6EF  28CE          		JR	Z,INTPE2
  D6F1                	KEYSET0:
  D6F1  E5            		PUSH	HL
  D6F2  2A90EC        		LD	HL,(_KEYPS)
  D6F5  7C            		LD	A,H
  D6F6  AD            		XOR	L
  D6F7  2006          		JR	NZ,INTC2A
                      	
  D6F9  2A92EC        		LD	HL,(_KEYD)
  D6FC  CD33D7        		CALL	KEYSET
  D6FF                	INTC2A:
  D6FF  3A94EC        		LD	A,(_KEYSP)
  D702  E60F          		AND	00FH
  D704  32E4D6        		LD	(INTCPAT+1),A
                      	
  D707  18B5          		JR	INTPE
                      	
  D709                	KEYSET1:
  D709  CB6C          		BIT	5,H
  D70B  F5            		PUSH	AF
  D70C  ED4B8CEC      		LD	BC,(_CTC)
  D710  78            		LD	A,B
  D711  B1            		OR	C
  D712  2006          		JR	NZ,KEYS10E
                      	
  D714  F1            		POP	AF
  D715  201C          		JR	NZ,KEYSET
  D717  F5            		PUSH	AF
  D718  18D7          		JR	KEYSET0
  D71A                	KEYS10E:
  D71A  F1            		POP	AF
  D71B  C8            		RET	Z
  D71C  F5            		PUSH	AF
  D71D  3E03          		LD	A,3		;CTC STOP
  D71F  ED79          		OUT	(C),A
  D721  F1            		POP	AF
                      	
  D722  B7            		OR	A
  D723  C8            		RET	Z
                      	
  D724  E5            		PUSH	HL
  D725  2A94EC        		LD	HL,(_KEYSP)
  D728  3EA7          		LD	A,0A7H
  D72A  ED79          		OUT	(C),A
  D72C  ED69          		OUT	(C),L
  D72E  7C            		LD	A,H
  D72F  32E4D6        		LD	(INTCPAT+1),A
  D732  E1            		POP	HL
                      	
  D733                	KEYSET:
  D733  7D            		LD	A,L
  D734  CB7C          		BIT	7,H
  D736  CC63D7        		CALL	Z,FKEY
  D739  CB74          		BIT	6,H
  D73B  C0            		RET	NZ
  D73C                	KEYBS:
  D73C  B7            		OR	A
  D73D  C8            		RET	Z
  D73E                	KEYBS1:
  D73E  FE03          		CP	3
  D740  CC56D7        		CALL	Z,KEYBC
  D743  E5            		PUSH	HL
  D744  F5            		PUSH	AF
  D745  2A90EC        		LD	HL,(_KEYPS)
  D748  2C            		INC	L
  D749  7D            		LD	A,L
  D74A  BC            		CP	H
  D74B  2812          		JR	Z,POP_AF_HL_SCF_RET
  D74D  3290EC        		LD	(_KEYPS),A
  D750  26FE          		LD	H,KEYBF/256
  D752  F1            		POP	AF
  D753  77            		LD	(HL),A
  D754  E1            		POP	HL
  D755  C9            		RET
                      	
  D756                	KEYBC:
  D756  E5            		PUSH	HL
  D757  210000        		LD	HL,0
  D75A  2290EC        		LD	(_KEYPS),HL
  D75D  E1            		POP	HL
  D75E  C9            		RET
                      	
  D75F                	POP_AF_HL_SCF_RET:
  D75F  F1            		POP	AF
  D760  E1            		POP	HL
  D761  37            		SCF
  D762  C9            		RET
                      	
  D763                	FKEY:
  D763  CB75          		BIT	6,L
  D765  C8            		RET	Z
  D766  3E1B          		LD	A,01BH
  D768  CD3ED7        		CALL	KEYBS1
  D76B  7D            		LD	A,L
  D76C  C6AF          		ADD	A,020H-'q'
  D76E  CB7D          		BIT	7,L
  D770  C8            		RET	Z
  D771  2E50          		LD	L,'P'
  D773  D690          		SUB	0E1H+020H-'q'
  D775  2810          		JR	Z,KEYBSL
  D777  2C            		INC	L
  D778  3D            		DEC	A
  D779  280C          		JR	Z,KEYBSL
  D77B  2C            		INC	L
  D77C  D609          		SUB	0EBH-0E2H
  D77E  2807          		JR	Z,KEYBSL
  D780  2E43          		LD	L,'C'
  D782  3D            		DEC	A
  D783  2802          		JR	Z,KEYBSL
  D785  2E58          		LD	L,'X'
  D787                	KEYBSL:
  D787  7D            		LD	A,L
  D788  18B4          		JR	KEYBS1
                      	
  D78A                	_SYS01:		;(BDOS)コンソール入力
  D78A  CD78D3        		CALL	_SYS07
  D78D                	MSG_:
  D78D  F5            		PUSH	AF
  D78E  D5            		PUSH	DE
  D78F  5F            		LD	E,A
  D790  CD96D7        		CALL	_SYS02
  D793  D1            		POP	DE
  D794  F1            		POP	AF
  D795  C9            		RET
                      	
  D796                	_SYS02:		;(BDOS)コンソール出力
  D796  CDA8D7        		CALL	BREAK
  D799  1805          		JR	PRINTX
                      	
  D79B                	_SYS06:		;(BDOS)コンソール直接入出力
  D79B  7B            		LD	A,E
  D79C  3C            		INC	A
  D79D  CACAEC        		JP	Z,_INKEY
  D7A0                	PRINTX:
  D7A0  C3CDEC        		JP	_PRINT
                      	
  D7A3                	_SYS08:		;(BDOS)エコーなしコンソール入力
  D7A3  CD78D3        		CALL	_SYS07
  D7A6  1804          		JR	BREAK1
  D7A8                	BREAK:
  D7A8  FB            		EI
  D7A9  3A92EC        		LD	A,(_KEYD)
  D7AC                	BREAK1:
  D7AC  FE03          		CP	3
  D7AE  CA0000        		JP	Z,0
  D7B1  FE13          		CP	013H
  D7B3  C0            		RET	NZ
                      	
  D7B4                	PAUSE:
  D7B4  CD56D7        		CALL	KEYBC
                      	
  D7B7                	FLGET:
  D7B7  CDDFEC        		CALL	_FFLUSH
  D7BA  C5            		PUSH	BC
  D7BB  E5            		PUSH	HL
  D7BC  ED4B8EEC      		LD	BC,(_TXADR)
  D7C0  CBE8          		SET	5,B
  D7C2  ED60          		IN	H,(C)
  D7C4                	FLGET1:
  D7C4  3A93EC        		LD	A,(_KEYD+1)
  D7C7  0F            		RRCA
  D7C8  0F            		RRCA
  D7C9  E610          		AND	010H
  D7CB  F608          		OR	8
  D7CD  ED68          		IN	L,(C)
  D7CF  B5            		OR	L
  D7D0  ED79          		OUT	(C),A
  D7D2  CDCAEC        		CALL	_INKEY
  D7D5  28ED          		JR	Z,FLGET1
  D7D7  ED61          		OUT	(C),H
  D7D9  E1            		POP	HL
  D7DA  C1            		POP	BC
  D7DB  C9            		RET
                      	
  D7DC                	_SYS0A:		;(BDOS)文字列入力
  D7DC  C5            		PUSH	BC
  D7DD  E5            		PUSH	HL
  D7DE  D5            		PUSH	DE
  D7DF  CDFFDB        		CALL	GETL
  D7E2  1100FF        		LD	DE,KBUF
  D7E5  E1            		POP	HL
  D7E6  E5            		PUSH	HL
  D7E7  0E00          		LD	C,0
  D7E9  3004          		JR	NC,SAX0
  D7EB  23            		INC	HL
  D7EC  23            		INC	HL
  D7ED  1808          		JR	SAX4
  D7EF                	SAX0:
  D7EF  46            		LD	B,(HL)
  D7F0  23            		INC	HL
  D7F1                	SAX1:
  D7F1  23            		INC	HL
  D7F2  1A            		LD	A,(DE)
  D7F3  13            		INC	DE
  D7F4  B7            		OR	A
  D7F5  2004          		JR	NZ,SAX2
  D7F7                	SAX4:
  D7F7  360D          		LD	(HL),00DH
  D7F9  1804          		JR	SAX3
  D7FB                	SAX2:
  D7FB  77            		LD	(HL),A
  D7FC  0C            		INC	C
  D7FD  10F2          		DJNZ	SAX1
  D7FF                	SAX3:
  D7FF  D1            		POP	DE
  D800  79            		LD	A,C
  D801  13            		INC	DE
  D802  12            		LD	(DE),A
  D803  1B            		DEC	DE
  D804  E1            		POP	HL
  D805  C1            		POP	BC
  D806  A7            		AND	A
  D807  C9            		RET
                      	
  D808                	_SYS0B:		;(BDOS)コンソール状態のチェック
  D808  CDA8D7        		CALL	BREAK
  D80B  3A92EC        		LD	A,(_KEYD)
  D80E  B7            		OR	A
  D80F  C8            		RET	Z
  D810                	CONSTX:
  D810  CDDFEC        		CALL	_FFLUSH
  D813  E5            		PUSH	HL
  D814  2A90EC        		LD	HL,(_KEYPS)
  D817  7C            		LD	A,H
  D818  AD            		XOR	L
  D819  E1            		POP	HL
  D81A  C6FF          		ADD	A,0FFH
  D81C  9F            		SBC	A,A
  D81D  C9            		RET
                      	
  D81E                	_SYS2A:		;(BDOS)日付の獲得
  D81E  C5            		PUSH	BC
  D81F  3EED          		LD	A,0EDH		;Read calendar
  D821  CDBDDA        		CALL	COMOUT
  D824  CD41D8        		CALL	IN49SB_BCD	;YY
  D827  6F            		LD	L,A
  D828  2600          		LD	H,0
                      	;	LD	DE,1900		;0076CH
                      	;	CP	90		;90以上は1900年代 1990-1999
                      	;	JR	NC,RDDATE1	;90未満は2000年代 2000-2089
                      	;	LD	E,0D0H		;2000 & 0FFH D=007H
  D82A  11D007        		LD	DE,2000		;すべて2000年代で処理 2000-2099
  D82D                	RDDATE1:
  D82D  19            		ADD	HL,DE
  D82E  CDA2DA        		CALL	IN49SB		;MM
  D831  57            		LD	D,A
  D832  CD41D8        		CALL	IN49SB_BCD	;DD
  D835  5F            		LD	E,A
  D836  7A            		LD	A,D
  D837  E607          		AND	7
  D839  0604          		LD	B,4
  D83B                	RDDATE2:
  D83B  CB3A          		SRL	D
  D83D  10FC          		DJNZ	RDDATE2
  D83F  C1            		POP	BC
  D840  C9            		RET
  D841                	IN49SB_BCD:
  D841  CDA2DA        		CALL	IN49SB
                      	;------------------------
                      	;BCDの10進数化
                      	;in
                      	;	A  : BCD
                      	;out
                      	;	A  : 10進数
                      	;------------------------
  D844  4F            		LD	C,A
  D845  E6F0          		AND	0F0H	;10の位
  D847  0F            		RRCA
  D848  47            		LD	B,A
  D849  0F            		RRCA
  D84A  0F            		RRCA
  D84B  80            		ADD	A,B
  D84C  47            		LD	B,A
  D84D  79            		LD	A,C
  D84E  E60F          		AND	00FH	;1の位
  D850  80            		ADD	A,B
  D851  C9            		RET
                      	
  D852                	_SYS2C:		;(BDOS)時刻の獲得
  D852  C5            		PUSH	BC
  D853  3EEF          		LD	A,0EFH		;Read time
  D855  CDBDDA        		CALL	COMOUT
  D858  CD41D8        		CALL	IN49SB_BCD	;TT
  D85B  67            		LD	H,A
  D85C  CD41D8        		CALL	IN49SB_BCD	;MM
  D85F  6F            		LD	L,A
  D860  CD41D8        		CALL	IN49SB_BCD	;SS
  D863  57            		LD	D,A
  D864  C1            		POP	BC
  D865  AF            		XOR	A
  D866  C9            		RET
                      	
  D867                	MSX1:
  D867  5F            		LD	E,A
  D868  CDCDEC        		CALL	_PRINT
  D86B                	MSX:
  D86B  7E            		LD	A,(HL)
  D86C  23            		INC	HL
  D86D  B7            		OR	A
  D86E  20F7          		JR	NZ,MSX1
  D870  C9            		RET
                      	
  D871                	ESC1:
  D871  7B            		LD	A,E
  D872  FE41          		CP	'A'
  D874  CAB0D9        		JP	Z,CTRL1E
  D877  FE42          		CP	'B'
  D879  CA28DB        		JP	Z,CTRL1F
  D87C  FE43          		CP	'C'
  D87E  CABDD9        		JP	Z,CTRL1C
  D881  FE44          		CP	'D'
  D883  CAA6D9        		JP	Z,CTRL1D
  D886  FE45          		CP	'E'
  D888  2802          		JR	Z,CT0CX
  D88A  FE6A          		CP	'j'
  D88C                	CT0CX:
  D88C  CAFBDA        		JP	Z,CTRL0C
  D88F  FE48          		CP	'H'
  D891  CA3BDA        		JP	Z,CTRL0B
  D894  FE4A          		CP	'J'
  D896  CAFEDA        		JP	Z,CTRL1A
  D899  FE4B          		CP	'K'
  D89B  CAFDD9        		JP	Z,CTRL05
  D89E  FE4C          		CP	'L'
  D8A0  CA3DDB        		JP	Z,CTRL0E
  D8A3  FE78          		CP	'x'
  D8A5  2804          		JR	Z,ESC1X
  D8A7  FE79          		CP	'y'
  D8A9  2002          		JR	NZ,ESC1Y
  D8AB                	ESC1X:
  D8AB  3601          		LD	(HL),1
  D8AD                	ESC1Y:
  D8AD  FE3D          		CP	'='
  D8AF  2804          		JR	Z,ESC1W
  D8B1  FE59          		CP	'Y'
  D8B3  2002          		JR	NZ,ESC1Z
  D8B5                	ESC1W:
  D8B5  3602          		LD	(HL),2
  D8B7                	ESC1Z:
  D8B7  FE20          		CP	020H
  D8B9  3802          		JR	C,ESC1C
  D8BB  87            		ADD	A,A
  D8BC  D0            		RET	NC
  D8BD                	ESC1C:
  D8BD  E1            		POP	HL
  D8BE  184A          		JR	ANK
                      	
  D8C0                	ESC:
  D8C0  211BD9        		LD	HL,PRINTE5
  D8C3  E5            		PUSH	HL
  D8C4  21E6D8        		LD	HL,ESCFLG+1
  D8C7  3600          		LD	(HL),0
  D8C9  3D            		DEC	A
  D8CA  28A5          		JR	Z,ESC1
  D8CC  3D            		DEC	A
  D8CD  2009          		JR	NZ,ESC2
  D8CF  3603          		LD	(HL),3
  D8D1  7B            		LD	A,E
  D8D2  D620          		SUB	020H
  D8D4  32DBD8        		LD	(ESCYP+1),A
  D8D7  C9            		RET
  D8D8                	ESC2:
  D8D8  3D            		DEC	A
  D8D9  C0            		RET	NZ
  D8DA  2600          	ESCYP:	LD	H,0
  D8DC  7B            		LD	A,E
  D8DD  D620          		SUB	020H
  D8DF  6F            		LD	L,A
  D8E0  C3D6EC        		JP	_LOC
                      	
  D8E3                	PRINT:
  D8E3  C5            		PUSH	BC
  D8E4  E5            		PUSH	HL
  D8E5  3E00          	ESCFLG:	LD	A,000H
  D8E7  B7            		OR	A
  D8E8  20D6          		JR	NZ,ESC
                      	
  D8EA  3E1F          		LD	A,01FH
  D8EC  BB            		CP	E
  D8ED  3030          		JR	NC,CTRL
  D8EF                	PRINTC:
  D8EF  A7            	INSFLG:	AND	A
  D8F0  DCC6DA        		CALL	C,CTRL12
                      	
  D8F3  3E00          	KANFLG:	LD	A,000H
  D8F5  B7            		OR	A
  D8F6  203F          		JR	NZ,KANJI2
  D8F8  7B            	X1KPAT:	LD	A,E
  D8F9  FE80          		CP	080H
  D8FB  380D          		JR	C,ANK
  D8FD  FEA0          		CP	0A0H
  D8FF  3804          		JR	C,KANJI1
  D901  FEE0          		CP	0E0H
  D903  3805          		JR	C,ANK
  D905                	KANJI1:
  D905  32F4D8        		LD	(KANFLG+1),A
  D908  1811          		JR	PRINTE5
  D90A                	ANK:
  D90A  ED4B8EEC      		LD	BC,(_TXADR)
  D90E  78            		LD	A,B
  D90F  F638          		OR	038H
  D911  47            		LD	B,A
  D912  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令	kanji
  D914  CB98          		RES	3,B
  D916  ED59          		OUT	(C),E		;Text
  D918                	KANJIE:
  D918  CD82D9        		CALL	PRINTE7
  D91B                	PRINTE5:
  D91B  E1            		POP	HL
  D91C  C1            		POP	BC
  D91D  AF            		XOR	A
  D91E  C9            		RET
                      	
  D91F                	CTRL:
  D91F  CD69D9        		CALL	KANCLR
  D922  3EA7          		LD	A,0A7H		;AND	A
  D924  32EFD8        		LD	(INSFLG),A
  D927  7B            		LD	A,E
  D928  87            		ADD	A,A
  D929  F680          		OR	080H
  D92B  6F            		LD	L,A
  D92C  26EB          		LD	H,CTRLTB/256
  D92E  7E            		LD	A,(HL)
  D92F  2C            		INC	L
  D930  66            		LD	H,(HL)
  D931  6F            		LD	L,A
  D932  CD0F00        		CALL	JP_HL
  D935  18E4          		JR	PRINTE5
                      	
  D937                	KANJI2:
  D937  D5            		PUSH	DE
  D938  57            		LD	D,A
  D939  01812F        		LD	BC,02F81H	;SFTJIS
  D93C  DF            		RST	018H
  D93D  01C32F        		LD	BC,02FC3H	;Instead or JISVRM
  D940  DF            		RST	018H
                      	
  D941  ED4B8EEC      		LD	BC,(_TXADR)
  D945  78            		LD	A,B
  D946  F638          		OR	038H
  D948  47            		LD	B,A
  D949  ED51          		OUT	(C),D		;kanji
  D94B  CB98          		RES	3,B
  D94D  ED59          		OUT	(C),E		;Text
  D94F  CD82D9        		CALL	PRINTE7
  D952  ED4B8EEC      		LD	BC,(_TXADR)
  D956  78            		LD	A,B
  D957  F638          		OR	038H
  D959  47            		LD	B,A
  D95A  CBF2          		SET	6,D
  D95C  ED51          		OUT	(C),D		;Kanji
  D95E  CB98          		RES	3,B
  D960  ED59          		OUT	(C),E		;Text
  D962  D1            		POP	DE
  D963  AF            		XOR	A
  D964  32F4D8        		LD	(KANFLG+1),A
  D967  18AF          		JR	KANJIE
                      	
  D969                	KANCLR:
  D969  3AF4D8        		LD	A,(KANFLG+1)
  D96C  B7            		OR	A
  D96D  C8            		RET	Z
  D96E  ED4B8EEC      		LD	BC,(_TXADR)
  D972  78            		LD	A,B
  D973  F638          		OR	038H
  D975  47            		LD	B,A
  D976  AF            		XOR	A
  D977  32F4D8        		LD	(KANFLG+1),A
  D97A  ED79          		OUT	(C),A		;Kanji
  D97C  CB98          		RES	3,B
  D97E  3E20          		LD	A,020H
  D980  ED79          		OUT	(C),A		;Text
  D982                	PRINTE7:
  D982  CBA0          		RES	4,B
  D984                	PRINTE6:
  D984  3A96EC        		LD	A,(_COLORF)
  D987                	PRINTE4:
  D987  ED79          		OUT	(C),A		;Color
  D989  78            		LD	A,B
  D98A  E607          		AND	7
  D98C  47            		LD	B,A
  D98D                	PRINTE2:
  D98D  03            		INC	BC
  D98E                	PRINTE3:
  D98E  2ABAEC        		LD	HL,(CRTCD+10)
  D991  A7            		AND	A
  D992  ED4A          		ADC	HL,BC
  D994                	PRINTE8:
  D994  2805          		JR	Z,PRINT2
  D996                	PRINTE1:
  D996  ED438EEC      		LD	(_TXADR),BC
  D99A                	PRINTE:
  D99A  C9            		RET
                      	
  D99B                	PRINT2:
  D99B  CD43DB        		CALL	SCR
  D99E  2ABCEC        		LD	HL,(CRTCD+12)
  D9A1  09            		ADD	HL,BC
  D9A2  228EEC        		LD	(_TXADR),HL
  D9A5  C9            		RET
                      	
  D9A6                	CTRL08:
  D9A6                	CTRL1D:
  D9A6  ED4B8EEC      		LD	BC,(_TXADR)
  D9AA  78            		LD	A,B
  D9AB  B1            		OR	C
  D9AC  C8            		RET	Z
  D9AD  0B            		DEC	BC
  D9AE  18E6          		JR	PRINTE1
                      	
  D9B0                	CTRL1E:
  D9B0  ED4B8EEC      		LD	BC,(_TXADR)
  D9B4  2ABCEC        		LD	HL,(CRTCD+12)
  D9B7  09            		ADD	HL,BC
  D9B8  D0            		RET	NC
  D9B9  44            		LD	B,H
  D9BA  4D            		LD	C,L
  D9BB  18D9          		JR	PRINTE1
                      	
  D9BD                	CTRL1C:
  D9BD  ED4B8EEC      		LD	BC,(_TXADR)
  D9C1  18CA          		JR	PRINTE2
                      	
  D9C3                	CTRL09:
  D9C3  ED4B8EEC      		LD	BC,(_TXADR)
  D9C7  79            		LD	A,C
  D9C8  E6F8          		AND	0F8H
  D9CA  C608          		ADD	A,8
  D9CC  4F            		LD	C,A
  D9CD  88            		ADC	A,B
  D9CE  91            		SUB	C
  D9CF  47            		LD	B,A
  D9D0  18BC          		JR	PRINTE3
                      	
  D9D2                	CTRL02:
  D9D2  2A8EEC        		LD	HL,(_TXADR)
  D9D5  7C            		LD	A,H
  D9D6  B5            		OR	L
  D9D7  C8            		RET	Z
  D9D8  2B            		DEC	HL
  D9D9  228EEC        		LD	(_TXADR),HL
  D9DC  D5            		PUSH	DE
  D9DD  CDD3EC        		CALL	_POS
  D9E0  3AB1EC        		LD	A,(CRTCD+1)
  D9E3  95            		SUB	L
  D9E4  6F            		LD	L,A
  D9E5  2D            		DEC	L
  D9E6  2638          		LD	H,038H
  D9E8  ED4B8EEC      		LD	BC,(_TXADR)
  D9EC  09            		ADD	HL,BC
  D9ED  44            		LD	B,H
  D9EE  4D            		LD	C,L
  D9EF  110020        		LD	DE,02000H	;D:Text E:kanji
  D9F2  2A96EC        		LD	HL,(_COLORF)	;L:Color
  D9F5                	C8X1:
  D9F5  CDE2DA        		CALL	C12S
  D9F8  0B            		DEC	BC
  D9F9  20FA          		JR	NZ,C8X1
  D9FB  D1            		POP	DE
  D9FC  C9            		RET
                      	
  D9FD                	CTRL05:
  D9FD  CDD3EC        		CALL	_POS
  DA00  3AB1EC        		LD	A,(CRTCD+1)
  DA03  95            		SUB	L
  DA04  6F            		LD	L,A
  DA05  2620          		LD	H,020H
  DA07  ED4B8EEC      		LD	BC,(_TXADR)
  DA0B                	C05X1:
  DA0B  78            		LD	A,B
  DA0C  F638          		OR	038H
  DA0E  47            		LD	B,A
  DA0F  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令	kanji
  DA11  CB98          		RES	3,B
  DA13  ED61          		OUT	(C),H		;Text
  DA15  CBA0          		RES	4,B
  DA17  3A96EC        		LD	A,(_COLORF)
  DA1A  ED79          		OUT	(C),A		;Color
  DA1C  03            		INC	BC
  DA1D  2D            		DEC	L
  DA1E  20EB          		JR	NZ,C05X1
  DA20  C9            		RET
                      	
  DA21                	CTRL0D:
  DA21  CDD3EC        		CALL	_POS
  DA24  2E00          		LD	L,0
  DA26                	LOC:
  DA26  C5            		PUSH	BC
  DA27  E5            		PUSH	HL
  DA28  CD69D9        		CALL	KANCLR
  DA2B  CD4EDA        		CALL	LOC1
  DA2E  ED438EEC      		LD	(_TXADR),BC
  DA32  E1            		POP	HL
  DA33  C1            		POP	BC
  DA34  C9            		RET
                      	
  DA35                	CTRL01:
  DA35  3E37          		LD	A,037H		;SCF
  DA37  32EFD8        		LD	(INSFLG),A
  DA3A  C9            		RET
                      	
  DA3B                	CTRL0B:
  DA3B  210000        		LD	HL,0
  DA3E  228EEC        		LD	(_TXADR),HL
  DA41  C9            		RET
                      	
  DA42                	PRINTS:
  DA42  CDA8D7        		CALL	BREAK
  DA45  C3CDEC        		JP	_PRINT
                      	
  DA48                	CTRL1B:
  DA48  3E01          		LD	A,1
  DA4A  32E6D8        		LD	(ESCFLG+1),A
  DA4D  C9            		RET
                      	
  DA4E                	LOC1:
  DA4E  44            		LD	B,H
  DA4F  4D            		LD	C,L
  DA50  04            		INC	B
  DA51  05            		DEC	B
  DA52  C8            		RET	Z
  DA53  D5            		PUSH	DE
  DA54  ED5BB1EC      		LD	DE,(CRTCD+1)
  DA58  210000        		LD	HL,0
  DA5B  55            		LD	D,L
  DA5C                	LOC2:
  DA5C  19            		ADD	HL,DE
  DA5D  10FD          		DJNZ	LOC2
  DA5F  09            		ADD	HL,BC
  DA60  D1            		POP	DE
  DA61                	LOC3:
  DA61  44            		LD	B,H
  DA62  4D            		LD	C,L
  DA63  C9            		RET
                      	
  DA64                	CONOUT1:
  DA64  CD76DA        		CALL	CURSOR
  DA67  59            		LD	E,C
  DA68  CDCDEC        		CALL	_PRINT
  DA6B  7B            		LD	A,E
  DA6C  FE0A          		CP	00AH
  DA6E  2006          		JR	NZ,CURSOR
  DA70  CD21DA        		CALL	CTRL0D
  DA73  CDFDD9        		CALL	CTRL05
  DA76                	CURSOR:
  DA76  C5            		PUSH	BC
  DA77  ED4B8EEC      		LD	BC,(_TXADR)
  DA7B  CBE8          		SET	5,B
  DA7D  ED78          		IN	A,(C)
  DA7F  EE18          		XOR	018H
  DA81  ED79          		OUT	(C),A
  DA83  C1            		POP	BC
  DA84  C9            		RET
                      	
  DA85                	CTRL07:
  DA85  2170EB        		LD	HL,BEEPD
  DA88                	BEEP1:
  DA88  7E            		LD	A,(HL)
  DA89  23            		INC	HL
  DA8A  FEFF          		CP	0FFH
  DA8C  C8            		RET	Z
  DA8D  F3            		DI
  DA8E  061C          		LD	B,01CH
  DA90  ED79          		OUT	(C),A
  DA92  EDA3          		OUTI
  DA94  FB            		EI
  DA95  18F1          		JR	BEEP1
                      	
  DA97                	OT49SB:
  DA97  C5            		PUSH	BC
  DA98  CDB3DA        		CALL	CANW
  DA9B  010019        		LD	BC,01900H
  DA9E  ED79          		OUT	(C),A
  DAA0  C1            		POP	BC
  DAA1  C9            		RET
                      	
  DAA2                	IN49SB:
  DAA2  C5            		PUSH	BC
  DAA3  01011A        		LD	BC,01A01H
  DAA6                	CANR:
  DAA6  ED78          		IN	A,(C)
  DAA8  E620          		AND	020H
  DAAA  20FA          		JR	NZ,CANR
  DAAC  010019        		LD	BC,01900H
  DAAF  ED78          		IN	A,(C)
  DAB1  C1            		POP	BC
  DAB2  C9            		RET
                      	
  DAB3                	CANW:
  DAB3  01011A        		LD	BC,01A01H
  DAB6  ED48          		IN	C,(C)
  DAB8  CB71          		BIT	6,C
  DABA  20F7          		JR	NZ,CANW
  DABC  C9            		RET
                      	
  DABD                	COMOUT:
  DABD  FB            		EI
  DABE  CD97DA        		CALL	OT49SB
  DAC1  CDB3DA        		CALL	CANW
  DAC4  F3            		DI
  DAC5  C9            		RET
                      	
  DAC6                	CTRL12:
  DAC6  D5            		PUSH	DE
  DAC7  CDD3EC        		CALL	_POS
  DACA  3AB1EC        		LD	A,(CRTCD+1)
  DACD  95            		SUB	L
  DACE  ED4B8EEC      		LD	BC,(_TXADR)
  DAD2  110020        		LD	DE,02000H	;D:Text E:Kanji
  DAD5  2A96EC        		LD	HL,(_COLORF)	;L:Color
  DAD8  CBE8          		SET	5,B
  DADA                	C12X1:
  DADA  CDE2DA        		CALL	C12S
  DADD  03            		INC	BC
  DADE  20FA          		JR	NZ,C12X1
  DAE0  D1            		POP	DE
  DAE1  C9            		RET
                      	
  DAE2                	C12S:
  DAE2  CBE0          		SET	4,B
  DAE4  CBD8          		SET	3,B
  DAE6  ED60          		IN	H,(C)
  DAE8  ED59          	X1PAT:	OUT	(C),E
  DAEA  5C            		LD	E,H
  DAEB  CB98          		RES	3,B
  DAED  ED60          		IN	H,(C)
  DAEF  ED51          		OUT	(C),D
  DAF1  54            		LD	D,H
  DAF2  CBA0          		RES	4,B
  DAF4  ED60          		IN	H,(C)
  DAF6  ED69          		OUT	(C),L
  DAF8  6C            		LD	L,H
  DAF9  3D            		DEC	A
  DAFA  C9            		RET
                      	
  DAFB                	CTRL0C:
  DAFB  CD3BDA        		CALL	CTRL0B
  DAFE                	CTRL1A:
  DAFE  ED4B8EEC      		LD	BC,(_TXADR)
  DB02                	C1AX1:
  DB02  78            		LD	A,B
  DB03  F638          		OR	038H
  DB05  47            		LD	B,A
  DB06  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令	kanji
  DB08  CB98          		RES	3,B
  DB0A  3E20          		LD	A,020H
  DB0C  ED79          		OUT	(C),A		;Text
  DB0E  CBA0          		RES	4,B
  DB10  3A96EC        		LD	A,(_COLORF)
  DB13  ED79          		OUT	(C),A		;Color
  DB15  03            		INC	BC
  DB16  CBA8          		RES	5,B
  DB18  2ABAEC        		LD	HL,(CRTCD+10)
  DB1B  09            		ADD	HL,BC
  DB1C  30E4          		JR	NC,C1AX1
  DB1E  C9            		RET
                      	
  DB1F                	CTRL04:
  DB1F  CDD3EC        		CALL	_POS
  DB22  7D            		LD	A,L
  DB23  B7            		OR	A
  DB24  C8            		RET	Z
  DB25                	CTRL03:
  DB25  CD21DA        		CALL	CTRL0D
  DB28                	CTRL0A:
  DB28                	CTRL1F:
  DB28  ED4B8EEC      		LD	BC,(_TXADR)
  DB2C  2AB1EC        		LD	HL,(CRTCD+1)
  DB2F  2600          		LD	H,0
  DB31  09            		ADD	HL,BC
  DB32  44            		LD	B,H
  DB33  4D            		LD	C,L
  DB34  2ABAEC        		LD	HL,(CRTCD+10)
  DB37  09            		ADD	HL,BC
  DB38  3F            		CCF
  DB39  9F            		SBC	A,A
  DB3A  C394D9        		JP	PRINTE8
                      	
  DB3D                	CTRL0E:
  DB3D  CDD3EC        		CALL	_POS
  DB40  7C            		LD	A,H
  DB41  1804          		JR	SCR1
  DB43                	SCR:
  DB43  3A97EC        		LD	A,(_LINE)
  DB46  3D            		DEC	A
  DB47                	SCR1:
  DB47  C5            		PUSH	BC
  DB48  D5            		PUSH	DE
  DB49  F5            		PUSH	AF
  DB4A  3E07          		LD	A,7
  DB4C  217DDB        		LD	HL,SCRDMAD
  DB4F  CD73DB        		CALL	SETDMA
  DB52  F1            		POP	AF
  DB53  210038        		LD	HL,03800H
                      	
  DB56                	SCRUP1:
  DB56  B7            		OR	A
  DB57  284D          		JR	Z,SCRCL
  DB59  F5            		PUSH	AF
  DB5A  CD84DB        		CALL	UPSUB		;kanji
  DB5D  ED5BBCEC      		LD	DE,(CRTCD+12)
  DB61  16F7          		LD	D,0F7H
  DB63  19            		ADD	HL,DE
  DB64  D5            		PUSH	DE
  DB65  CD84DB        		CALL	UPSUB		;Text
  DB68  D1            		POP	DE
  DB69  19            		ADD	HL,DE
  DB6A  CD84DB        		CALL	UPSUB		;Color
  DB6D  CBE4          		SET	4,H
  DB6F  F1            		POP	AF
  DB70  3D            		DEC	A
  DB71  18E3          		JR	SCRUP1
                      	
  DB73                	SETDMA:
  DB73  01871F        		LD	BC,01F87H
  DB76                	SDMA:
  DB76  04            		INC	B
  DB77  EDA3          		OUTI
  DB79  3D            		DEC	A
  DB7A  20FA          		JR	NZ,SDMA
  DB7C  C9            		RET
                      	
  DB7D                	SCRDMAD:
  DB7D  C3            		DB	0C3H		;WR6 リセット
  DB7E  9A            		DB	09AH		;WR5 ストップ WAIT READY:HIGH
  DB7F  65            		DB	065H		;WR0 ブロック長(LH)
  DB80  4F00          		DW	79
  DB82  1C            		DB	01CH		;WR1 ポートAインクリメント I/O
  DB83  18            		DB	018H		;WR0 ポートAアドレス(LH)
                      	
  DB84                	UPSUB:
  DB84  ED5BB1EC      		LD	DE,(CRTCD+1)
  DB88  1600          		LD	D,0
  DB8A  3ECD          		LD	A,0CDH		;WR4 バースト ポートB開始アドレス(LH)
  DB8C  ED79          		OUT	(C),A
  DB8E  ED69          		OUT	(C),L		;SOURCE
  DB90  ED61          		OUT	(C),H
  DB92  19            		ADD	HL,DE
  DB93  3E1D          		LD	A,01DH		;WR0 ポートA開始アドレス(LH) ポートA→ポートB 転送
  DB95  ED79          		OUT	(C),A
  DB97  ED69          		OUT	(C),L		;DEST
  DB99  ED61          		OUT	(C),H
  DB9B                	GO_DMA:
  DB9B  3ECF          		LD	A,0CFH
  DB9D  ED79          		OUT	(C),A		;WR6 ロード
  DB9F  3EB3          		LD	A,0B3H
  DBA1  ED79          		OUT	(C),A		;WR6 強制RDY
  DBA3  ED49          		OUT	(C),C		;WR6 イネーブル
  DBA5  C9            		RET
                      	
  DBA6                	SCRCL:
  DBA6  44            		LD	B,H
  DBA7  4D            		LD	C,L
  DBA8  215020        		LD	HL,02000H+80
  DBAB  3A96EC        		LD	A,(_COLORF)
  DBAE                	SCRCL1:
  DBAE  ED71          		DB	0EDH,071H	;OUT (C),0	Z80未定義命令
  DBB0  CB98          		RES	3,B
  DBB2  ED61          		OUT	(C),H
  DBB4  CBA0          		RES	4,B
  DBB6  ED79          		OUT	(C),A
  DBB8  CBD8          		SET	3,B
  DBBA  CBE0          		SET	4,B
  DBBC  03            		INC	BC
  DBBD  2D            		DEC	L
  DBBE  20EE          		JR	NZ,SCRCL1
  DBC0  D1            		POP	DE
  DBC1  C1            		POP	BC
  DBC2  C9            		RET
                      	
  DBC3                	SCRN:
  DBC3  D5            		PUSH	DE
  DBC4  ED58          		IN	E,(C)		;Text
  DBC6  CBD8          		SET	3,B
  DBC8  ED50          		IN	D,(C)		;Kanji
  DBCA  2819          		JR	Z,SCRNE
  DBCC  AF            		XOR	A
  DBCD  C5            		PUSH	BC
  DBCE  013730        		LD	BC,03037H	;VRMJIS
  DBD1  DF            		RST	018H
  DBD2  01522F        		LD	BC,02F52H	;JISSFT
  DBD5  DF            		RST	018H
  DBD6  C1            		POP	BC
  DBD7  ED78          		IN	A,(C)
  DBD9  CB98          		RES	3,B
  DBDB  E640          		AND	040H
  DBDD  2003          		JR	NZ,SCRN1
  DBDF  7A            		LD	A,D
  DBE0  D1            		POP	DE
  DBE1  C9            		RET
  DBE2                	SCRN1:
  DBE2  7B            		LD	A,E
  DBE3  D1            		POP	DE
  DBE4  C9            		RET
                      	
  DBE5                	SCRNE:
  DBE5  D1            		POP	DE
  DBE6  CB98          		RES	3,B
  DBE8                	SCRNX:
  DBE8  ED78          		IN	A,(C)
  DBEA  C9            		RET
                      	
  DBEB                	POS:
  DBEB  2A8EEC        		LD	HL,(_TXADR)
  DBEE  C5            		PUSH	BC
  DBEF  ED4BBCEC      		LD	BC,(CRTCD+12)
  DBF3  AF            		XOR	A
  DBF4                	POS1:
  DBF4  09            		ADD	HL,BC
  DBF5  3C            		INC	A
  DBF6  38FC          		JR	C,POS1
  DBF8  ED42          		SBC	HL,BC
  DBFA  3D            		DEC	A
  DBFB  67            		LD	H,A
  DBFC  C1            		POP	BC
  DBFD  A7            		AND	A
  DBFE  C9            		RET
                      	
  DBFF                	GETL:
  DBFF  CDD3EC        		CALL	_POS
  DC02  E5            		PUSH	HL
  DC03                	GETL1:
  DC03  CDD3EC        		CALL	_POS
  DC06  C1            		POP	BC
  DC07  C5            		PUSH	BC
  DC08  7D            		LD	A,L
  DC09  91            		SUB	C
  DC0A  69            		LD	L,C
  DC0B  4F            		LD	C,A
  DC0C  DCD6EC        		CALL	C,_LOC
  DC0F                	GET1W:
  DC0F  CDA3D7        		CALL	_SYS08
  DC12  FE08          		CP	8
  DC14  2007          		JR	NZ,GETL1X
  DC16  0D            		DEC	C
  DC17  CB79          		BIT	7,C
  DC19  2002          		JR	NZ,GETL1X
  DC1B  3E02          		LD	A,2
  DC1D                	GETL1X:
  DC1D  FE1B          		CP	01BH
  DC1F  2016          		JR	NZ,GETL1V
  DC21  CDA3D7        		CALL	_SYS08
  DC24  FE22          		CP	022H
  DC26  2008          		JR	NZ,GETL1Y
  DC28  2100FF        		LD	HL,KBUF
  DC2B  CD6BD8        		CALL	MSX
  DC2E  180E          		JR	GETL1Z
  DC30                	GETL1Y:
  DC30  F5            		PUSH	AF
  DC31  1E1B          		LD	E,01BH
  DC33  CDCDEC        		CALL	_PRINT
  DC36  F1            		POP	AF
  DC37                	GETL1V:
  DC37  5F            		LD	E,A
  DC38  CD35DA        		CALL	CTRL01
  DC3B  CDCDEC        		CALL	_PRINT
  DC3E                	GETL1Z:
  DC3E  7B            		LD	A,E
  DC3F  FE0D          		CP	00DH
  DC41  20C0          		JR	NZ,GETL1
                      	
  DC43  2100FF        		LD	HL,KBUF
  DC46  AF            		XOR	A
  DC47  ED4BB0EC      		LD	BC,(CRTCD)
  DC4B                	GETL0:
  DC4B  77            		LD	(HL),A
  DC4C  23            		INC	HL
  DC4D  10FC          		DJNZ	GETL0
                      	
  DC4F  D1            		POP	DE
  DC50  CDD3EC        		CALL	_POS
  DC53  6B            		LD	L,E
  DC54  3AB1EC        		LD	A,(CRTCD+1)
  DC57  95            		SUB	L
  DC58  57            		LD	D,A
  DC59  CD4EDA        		CALL	LOC1
  DC5C  78            		LD	A,B
  DC5D  F630          		OR	030H
  DC5F  47            		LD	B,A
  DC60  5A            		LD	E,D
  DC61  2100FF        		LD	HL,KBUF
  DC64                	GETL2:
  DC64  CDD0EC        		CALL	_SCRN
  DC67  03            		INC	BC
  DC68  77            		LD	(HL),A
  DC69  23            		INC	HL
  DC6A  1D            		DEC	E
  DC6B  20F7          		JR	NZ,GETL2
  DC6D                	GETL3:
  DC6D  2B            		DEC	HL
  DC6E  7E            		LD	A,(HL)
  DC6F  FE21          		CP	021H
  DC71  D0            		RET	NC
  DC72  3600          		LD	(HL),0
  DC74  15            		DEC	D
  DC75  20F6          		JR	NZ,GETL3
  DC77  C9            		RET
                      	
  DC78                	INKEY:
  DC78  FB            		EI
  DC79  E5            		PUSH	HL
  DC7A  2A90EC        		LD	HL,(_KEYPS)
  DC7D  7C            		LD	A,H
  DC7E  AD            		XOR	L
  DC7F  2809          		JR	Z,INKEY1
  DC81  7C            		LD	A,H
  DC82  3C            		INC	A
  DC83  3291EC        		LD	(_KEYPS+1),A
  DC86  6F            		LD	L,A
  DC87  26FE          		LD	H,KEYBF/256
  DC89  7E            		LD	A,(HL)
  DC8A                	INKEY1:
  DC8A  E1            		POP	HL
  DC8B  B7            		OR	A
  DC8C  C9            		RET
                      	
  1133                	AT_RS	EQU	SCR1-AT_SCR1
                      	
                      	;LDFILE.ASM
                      	
                      	;	LSX-Dodgers FILE
                      	
  DC8D                	FILEC:
  DC8D  CD98DC        		CALL	FILE
  DC90                	FILEC2:
  DC90  3ADC00        		LD	A,(FDRV+1)
  DC93  FE20          		CP	020H
  DC95  C8            		RET	Z
  DC96  183B          		JR	SETDIR1
                      	
  DC98                	FILE:
  DC98  AF            		XOR	A
  DC99  32DB00        		LD	(FDRV),A
  DC9C  67            		LD	H,A
  DC9D  6F            		LD	L,A
  DC9E  22E900        		LD	(FDRV+14),HL
  DCA1  CD72DD        		CALL	SPCUT
  DCA4  CD57DD        		CALL	CCHK3
  DCA7  2812          		JR	Z,DEVI1
  DCA9  13            		INC	DE
  DCAA  1A            		LD	A,(DE)
  DCAB  1B            		DEC	DE
  DCAC  FE3A          		CP	':'
  DCAE  200B          		JR	NZ,DEVI1
  DCB0  1A            		LD	A,(DE)		;DRIVE
  DCB1  CDBCDF        		CALL	CAP
  DCB4  D640          		SUB	'@'
  DCB6  13            		INC	DE
  DCB7  13            		INC	DE
  DCB8  32DB00        		LD	(FDRV),A
  DCBB                	DEVI1:
  DCBB  1A            		LD	A,(DE)
  DCBC  D65C          		SUB	05CH		;\
  DCBE  200B          		JR	NZ,NOROOT
  DCC0  210000        		LD	HL,0
  DCC3  22F500        		LD	(FDRV+26),HL
  DCC6  2C            		INC	L
  DCC7  22E900        		LD	(FDRV+14),HL
  DCCA  13            		INC	DE
  DCCB                	NOROOT:
                      	
  DCCB                	SETDIR:
  DCCB  CDF7DC        		CALL	FILED
  DCCE  1A            		LD	A,(DE)
  DCCF  FE5C          		CP	05CH		;\
  DCD1  C0            		RET	NZ
  DCD2  13            		INC	DE
  DCD3                	SETDIR1:
  DCD3  3E10          		LD	A,010H		;Directory
  DCD5  32E800        		LD	(FDRV+13),A
  DCD8  D5            		PUSH	DE
  DCD9  11DB00        		LD	DE,FDRV
  DCDC  2A1EEC        		LD	HL,(STABLE+2*00FH)
  DCDF  CD0F00        		CALL	JP_HL
  DCE2  D1            		POP	DE
  DCE3  B7            		OR	A
  DCE4  C0            		RET	NZ
                      	
  DCE5  3AE800        		LD	A,(FDRV+13)
  DCE8  CB67          		BIT	4,A
  DCEA  C8            		RET	Z
                      	
  DCEB  CD3EDD        		CALL	FILEI
  DCEE  2AF500        		LD	HL,(FDRV+26)
  DCF1  23            		INC	HL
  DCF2  22E900        		LD	(FDRV+14),HL
  DCF5  18D4          		JR	SETDIR
                      	
  DCF7                	FILED:
  DCF7  CD3EDD        		CALL	FILEI
                      	
  DCFA  0608          		LD	B,8
  DCFC                	FILE2:
  DCFC  CD4CDD        		CALL	CCHKF
  DCFF  C8            		RET	Z
  DD00  FE2A          		CP	'*'
  DD02  282E          		JR	Z,FILE9
  DD04  FE2E          		CP	'.'
  DD06  280C          		JR	Z,FILE4
  DD08  77            		LD	(HL),A
  DD09  23            		INC	HL
  DD0A  10F0          		DJNZ	FILE2
                      	
  DD0C                	FILE3:
  DD0C  CD4CDD        		CALL	CCHKF
  DD0F  C8            		RET	Z
  DD10  FE2E          		CP	'.'
  DD12  20F8          		JR	NZ,FILE3
                      	
  DD14                	FILE4:
  DD14  21E400        		LD	HL,FNAME+8
  DD17  0603          		LD	B,3
                      	
  DD19                	FILE4L:
  DD19  CD4CDD        		CALL	CCHKF
  DD1C  C8            		RET	Z
  DD1D  FE2E          		CP	'.'
  DD1F  2008          		JR	NZ,FILE12
  DD21  32DC00        		LD	(FNAME),A	;Parent directory(..)
  DD24  32DD00        		LD	(FNAME+1),A
  DD27  3E20          		LD	A,020H
  DD29                	FILE12:
  DD29  FE2A          		CP	'*'
  DD2B  280A          		JR	Z,FILE10
  DD2D  77            		LD	(HL),A
  DD2E  23            		INC	HL
  DD2F  10E8          		DJNZ	FILE4L
  DD31  C9            		RET
                      	
  DD32                	FILE9:
  DD32  CD37DD        		CALL	FILE10
  DD35  18D5          		JR	FILE3
                      	
  DD37                	FILE10:
  DD37  3E3F          		LD	A,'?'
                      	
  DD39                	FILE7:
  DD39  77            		LD	(HL),A
  DD3A  23            		INC	HL
  DD3B  10FC          		DJNZ	FILE7
  DD3D  C9            		RET
                      	
  DD3E                	FILEI:
  DD3E  3E20          		LD	A,020H
  DD40  01000B        		LD	BC,11*256
  DD43  21DC00        		LD	HL,FNAME
  DD46  E5            		PUSH	HL
  DD47  CD39DD        		CALL	FILE7
  DD4A  E1            		POP	HL
  DD4B  C9            		RET
                      	
  DD4C                	CCHKF:
  DD4C  1A            		LD	A,(DE)
  DD4D  CD54DD        		CALL	CCHK2
  DD50  C8            		RET	Z
  DD51  C3DAE0        		JP	FKAN
                      	
  DD54                	CCHK2:
  DD54  0C            		INC	C
  DD55  0D            		DEC	C
  DD56  C0            		RET	NZ
  DD57                	CCHK3:
  DD57  FE2B          		CP	'+'
  DD59  C8            		RET	Z
  DD5A  FE2C          		CP	','
  DD5C  C8            		RET	Z
  DD5D  FE2F          		CP	'/'
  DD5F  C8            		RET	Z
  DD60  FE3A          		CP	':'
  DD62  C8            		RET	Z
  DD63  FE3B          		CP	';'
  DD65  C8            		RET	Z
  DD66  FE3D          		CP	'='
  DD68  C8            		RET	Z
  DD69  FE5C          		CP	05CH
  DD6B  C8            		RET	Z
  DD6C  FE20          		CP	020H
  DD6E  D0            		RET	NC
  DD6F  BF            		CP	A		;Z=1
  DD70  C9            		RET
                      	
  DD71                	SS1:
  DD71  13            		INC	DE
  DD72                	SPCUT:
  DD72  1A            		LD	A,(DE)
  DD73  FE20          		CP	020H
  DD75  28FA          		JR	Z,SS1
  DD77  C9            		RET
                      	
  DD78                	SETDRVF:
  DD78  11DB00        		LD	DE,FDRV
  DD7B                	SETDRV0:
  DD7B  CD84DD        		CALL	SETDRV
  DD7E  FDE1          		POP	IY
  DD80  C1            		POP	BC
  DD81  D1            		POP	DE
  DD82  E1            		POP	HL
  DD83  C9            		RET
                      	
  DD84                	SETDRV:
  DD84  E3            		EX	(SP),HL		;HL=RETRN ADDRESS
  DD85  D5            		PUSH	DE		;PUSH HL/DE/BC/IY
  DD86  C5            		PUSH	BC
  DD87  1A            		LD	A,(DE)
  DD88  D5            		PUSH	DE
  DD89  FDE3          		EX	(SP),IY
                      	
  DD8B  CD97DD        		CALL	GETDRV
  DD8E  3C            		INC	A
  DD8F  FD7700        		LD	(IY+0),A	;(FCB)ドライブ番号
  DD92  3D            		DEC	A
  DD93  CDD9EC        		CALL	_CHGDRV
                      	
  DD96  E9            		JP	(HL)
                      	
  DD97                	GETDRV:
  DD97  E67F          		AND	07FH
  DD99  D601          		SUB	001H
  DD9B  3003          		JR	NC,GETDRV1
  DD9D  3A87EC        		LD	A,(_DVSW)	;Current Drive
  DDA0                	GETDRV1:
  DDA0  3288EC        		LD	(_DRV),A
  DDA3  C9            		RET
                      	
  DDA4                	SOPENX:
  DDA4  CD24DF        		CALL	CHKDDX
  DDA7  3802          		JR	C,SOPENX1
  DDA9  C1            		POP	BC
  DDAA  E9            		JP	(HL)
  DDAB                	SOPENX1:
  DDAB  1186E2        		LD	DE,SFILE
  DDAE  1A            		LD	A,(DE)
  DDAF  FDBE00        		CP	(IY+0)		;(FCB)ドライブ番号
  DDB2  2024          		JR	NZ,SOPEN
  DDB4  13            		INC	DE
  DDB5  FDE5          		PUSH	IY
  DDB7  E1            		POP	HL
  DDB8  23            		INC	HL
  DDB9  CD54DF        		CALL	CPFILE
  DDBC  201A          		JR	NZ,SOPEN
                      	
  DDBE  2AF4EB        		LD	HL,(SCDIR)
  DDC1  FD750E        		LD	(IY+14),L	;(FCB)アクセスするディレクトリのクラスタ番号+1
  DDC4  FD740F        		LD	(IY+15),H
                      	
  DDC7  2AF8EB        		LD	HL,(SFNDF)	;Direcroty location and Flags
  DDCA  229FEC        		LD	(_FILEN),HL
                      	
  DDCD  ED5BF6EB      		LD	DE,(SFBPS)
  DDD1  2186E2        		LD	HL,SFILE
  DDD4  36FF          		LD	(HL),0FFH
  DDD6  23            		INC	HL
  DDD7  C9            		RET
  DDD8                	SOPEN:
  DDD8  21ECDE        		LD	HL,FILESE
  DDDB                	SOPENC:
  DDDB  2214DE        		LD	(OPENPAT+1),HL
                      	
  DDDE  CDE2EC        		CALL	_RDFATX		;Detect Media
  DDE1  3856          		JR	C,RDDERR
                      	
  DDE3  AF            		XOR	A
  DDE4  329FEC        		LD	(_FILEN),A
  DDE7  CD01E0        		CALL	LDDIRX1		;A=0で呼び出す
  DDEA  2818          		JR	Z,SDIRX1
                      	
  DDEC  CDDDDE        		CALL	READ_DIR	;Sub Directory
  DDEF  3808          		JR	C,SDIRX0
  DDF1  2A7EEC        		LD	HL,(_DTBUF)
  DDF4  7E            		LD	A,(HL)
  DDF5  FE2E          		CP	'.'
  DDF7  280F          		JR	Z,SOPEN1
  DDF9                	SDIRX0:
  DDF9  AF            		XOR	A
  DDFA  32A0EC        		LD	(_DIRF),A
  DDFD  FD360E01      		LD	(IY+14),1	;(FCB)レコード・サイズ
  DE01  FD770F        		LD	(IY+15),A
  DE04                	SDIRX1:
  DE04  ED5BFCEB      		LD	DE,(_DIRPS)	;Root Directory
  DE08                	SOPEN1:
  DE08  0E20          	SDECPAT:LD	C,32		;自己書き換え 1セクタ辺りのディレクトリエントリ数  1024=32 / 512=16
  DE0A                	SOPEN1X:
  DE0A  CDDDDE        		CALL	READ_DIR	;FILE SEARCH
  DE0D  382A          		JR	C,RDDERR
  DE0F  2A7EEC        		LD	HL,(_DTBUF)
  DE12                	SOPEN2:
  DE12  D5            		PUSH	DE
  DE13  CDECDE        	OPENPAT:CALL	FILESE		;(Self-rewriting)
  DE16  D1            		POP	DE
  DE17  386E          		JR	C,SOPENE
  DE19  281B          		JR	Z,NOTSE
  DE1B                	SOPEN3:
  DE1B  3AA0EC        		LD	A,(_DIRF)	;ディレクトリか判別
  DE1E  B7            		OR	A
  DE1F  200C          		JR	NZ,SOPEN5
  DE21  13            		INC	DE		;ルートディレクトリ
  DE22  E5            		PUSH	HL
  DE23  210C00        	MD_PAT:	LD	HL,12		;(Self-rewriting)MAXDIR
  DE26  ED52          		SBC	HL,DE		;CF=0 なので SUB HL,DE
  DE28  E1            		POP	HL
  DE29  20DD          		JR	NZ,SOPEN1
  DE2B  1807          		JR	SOPEN6
  DE2D                	SOPEN5:
  DE2D  CDF2E6        		CALL	GNCLX		;END DIR
  DE30  D8            		RET	C
  DE31  CDB4DF        		CALL	ENDCL
  DE34                	SOPEN6:
  DE34  38D2          		JR	C,SOPEN1
  DE36                	NOTSE:
  DE36  37            		SCF			;CF=1
  DE37  9F            		SBC	A,A		;A=0FFH
  DE38  C9            		RET
                      	
  DE39                	RDDERR:
  DE39  BF            		CP	A		;READ ERR CF=1 ZF=1
  DE3A  37            		SCF
  DE3B  C9            		RET
                      	
  DE3C                	NOPEN:
  DE3C  21ECDE        		LD	HL,FILESE
  DE3F  2214DE        		LD	(OPENPAT+1),HL
  DE42  FD2A98EC      		LD	IY,(_FCB)
  DE46  CDEDE0        		CALL	CHKWILDX
  DE49  30EB          		JR	NC,NOTSE
  DE4B  FD7E00        		LD	A,(IY+0)	;(FCB)ドライブ番号
  DE4E  3D            		DEC	A
  DE4F  3288EC        		LD	(_DRV),A
  DE52  CDD9EC        		CALL	_CHGDRV
  DE55  D8            		RET	C
  DE56  2AF8EB        		LD	HL,(SFNDF)	;Direcroty location and Flags
  DE59  229FEC        		LD	(_FILEN),HL
                      	
  DE5C  CDFCDF        		CALL	LDDIRX
  DE5F  ED5B9AEC      		LD	DE,(_FBPS)
  DE63  CDDDDE        		CALL	READ_DIR
  DE66  38D1          		JR	C,RDDERR
  DE68  3A9EEC        		LD	A,(_FBCNT)
  DE6B  3D            		DEC	A
  DE6C  28AD          		JR	Z,SOPEN3
  DE6E                	NOPEN2:
  DE6E  2A9CEC        		LD	HL,(_FBAD)
  DE71  012000        		LD	BC,020H
  DE74  09            		ADD	HL,BC
  DE75  4F            		LD	C,A
  DE76  189A          		JR	SOPEN2
                      	
  DE78                	SOPENE2:
  DE78  229CEC        		LD	(_FBAD),HL
  DE7B  79            		LD	A,C
  DE7C  329EEC        		LD	(_FBCNT),A
  DE7F  ED539AEC      		LD	(_FBPS),DE
  DE83  FD2298EC      		LD	(_FCB),IY
  DE87                	SOPENE:
  DE87  AF            		XOR	A
  DE88  C9            		RET
                      	
  DE89                	COPEN:
  DE89  FD360D20      		LD	(IY+13),020H	;(FCB)属性(アトリビュート)
                      	
  DE8D  2109DF        		LD	HL,NEXTSE
  DE90  CDDBDD        		CALL	SOPENC
  DE93  D0            		RET	NC
  DE94  C8            		RET	Z
  DE95  3AA0EC        		LD	A,(_DIRF)	;ディレクトリか判別
  DE98  B7            		OR	A
  DE99  37            		SCF
  DE9A  C8            		RET	Z		;ルートディレクトリ
  DE9B  0601          		LD	B,1
  DE9D  CD49E1        		CALL	WRDF
  DEA0  D8            		RET	C
  DEA1  ED5BFEEB      		LD	DE,(_CLPS)
  DEA5  D5            		PUSH	DE
  DEA6  CD7DDF        		CALL	DCPAT
  DEA9  CD89E5        		CALL	DRDNX
  DEAC  2A7EEC        		LD	HL,(_DTBUF)	;ディレクトリエントリを0クリア
  DEAF  5D            		LD	E,L
  DEB0  54            		LD	D,H
  DEB1  13            		INC	DE		;DE,DTBUF+1
  DEB2  01FF03        	SECSZM1:LD	BC,003FFH	;自己書き換え セクタサイズ-1(0x3FF:1023 or 0x1FF:511 or 0xFF:255)
  DEB5  AF            		XOR	A		;データバッファをセクタサイズ分ゼロクリア
  DEB6  77            		LD	(HL),A
  DEB7  EDB0          		LDIR
                      	
  DEB9  D1            		POP	DE		;DE=(_CLPS)
  DEBA  D5            		PUSH	DE
  DEBB  3A9BDF        		LD	A,(SPCPAT+1)	;1クラスタの論理セクタ数
  DEBE  3D            		DEC	A
  DEBF  2817          		JR	Z,COPENE
  DEC1  3E01          		LD	A,1		;1セクタ辺りのセクタ数が2以上の場合
  DEC3  32EAE6        		LD	(_SECPS+1),A
  DEC6                	COPEN1:
  DEC6  D5            		PUSH	DE		;データバッファに入らないセクタもゼロクリア
  DEC7  C5            		PUSH	BC
  DEC8  2A7EEC        		LD	HL,(_DTBUF)
  DECB  CD97DF        		CALL	CLUSTX
  DECE  CD5BE8        		CALL	DWT24
  DED1  C1            		POP	BC
  DED2  D1            		POP	DE
  DED3  CDE9E6        		CALL	NEXTX
  DED6  20EE          		JR	NZ,COPEN1
  DED8                	COPENE:
  DED8  2A7EEC        		LD	HL,(_DTBUF)
  DEDB  D1            		POP	DE
  DEDC  C9            		RET
                      	
  DEDD                	READ_DIR:
  DEDD  ED53FEEB      		LD	(_CLPS),DE
  DEE1  C5            		PUSH	BC
  DEE2  D5            		PUSH	DE
  DEE3  CD7DDF        		CALL	DCPAT
  DEE6  CD69E5        		CALL	DRDX
  DEE9  D1            		POP	DE
  DEEA  C1            		POP	BC
  DEEB  C9            		RET
                      	
  DEEC                	FILESE:
  DEEC  7E            		LD	A,(HL)
  DEED  B7            		OR	A
  DEEE  C8            		RET	Z		;END:ZF=1 CF=0
  DEEF  FEE5          		CP	0E5H
  DEF1  280E          		JR	Z,FILESE1
  DEF3  FDE5          		PUSH	IY
  DEF5  D1            		POP	DE
  DEF6  13            		INC	DE
  DEF7  E5            		PUSH	HL
  DEF8  CD54DF        		CALL	CPFILE
  DEFB  CC75DF        		CALL	Z,CPFILE2
  DEFE  E1            		POP	HL
  DEFF  37            		SCF
  DF00  C8            		RET	Z		;!!!:(ZF=1) CF=1
  DF01                	FILESE1:
  DF01  CD18DF        		CALL	FNEXT
  DF04  20E6          		JR	NZ,FILESE
  DF06                	ZF0_CF0_AFF_RET:
  DF06  F6FF          		OR	0FFH		;ZF=0 CF=0
  DF08  C9            		RET
                      	
  DF09                	NEXTSE:
  DF09  7E            		LD	A,(HL)
  DF0A  B7            		OR	A
  DF0B  37            		SCF
  DF0C  C8            		RET	Z		;!!!:ZF=1 CF=1
  DF0D  FEE5          		CP	0E5H
  DF0F  37            		SCF
  DF10  C8            		RET	Z		;!!!:(ZF=1) CF=1
  DF11  CD18DF        		CALL	FNEXT
  DF14  20F3          		JR	NZ,NEXTSE
  DF16  18EE          		JR	ZF0_CF0_AFF_RET
                      	
  DF18                	FNEXT:
  DF18  E5            		PUSH	HL
  DF19  219FEC        		LD	HL,_FILEN
  DF1C  34            		INC	(HL)
  DF1D  E1            		POP	HL
  DF1E  112000        		LD	DE,020H
  DF21  19            		ADD	HL,DE
  DF22  0D            		DEC	C
  DF23  C9            		RET
                      	
  DF24                	CHKDDX:
  DF24  CDEDE0        		CALL	CHKWILDX
  DF27  D8            		RET	C
  DF28  FDE5          		PUSH	IY
  DF2A  D1            		POP	DE
  DF2B  13            		INC	DE
  DF2C  2162EC        		LD	HL,DDTB
  DF2F  0604          		LD	B,DDS
  DF31                	CPNAME:
  DF31  C5            		PUSH	BC
  DF32  D5            		PUSH	DE
  DF33  115EE5        		LD	DE,CPBUF
  DF36  010400        		LD	BC,4
  DF39  EDB0          		LDIR
  DF3B  D1            		POP	DE
  DF3C  D5            		PUSH	DE
  DF3D  E5            		PUSH	HL
  DF3E  215EE5        		LD	HL,CPBUF
  DF41  CD54DF        		CALL	CPFILE
  DF44  E1            		POP	HL
  DF45  D1            		POP	DE
  DF46  C1            		POP	BC
  DF47  2005          		JR	NZ,CPNAME1
  DF49  7E            		LD	A,(HL)
  DF4A  23            		INC	HL
  DF4B  66            		LD	H,(HL)
  DF4C  6F            		LD	L,A
  DF4D  C9            		RET
  DF4E                	CPNAME1:
  DF4E  23            		INC	HL
  DF4F  23            		INC	HL
  DF50  10DF          		DJNZ	CPNAME
  DF52  37            		SCF
  DF53  C9            		RET
                      	
  DF54                	CPFILE:
  DF54  C5            		PUSH	BC
  DF55  01000B        		LD	BC,00B00H
  DF58                	CPSTR1:
  DF58  1A            		LD	A,(DE)
  DF59  FE3F          		CP	'?'		;Wild card
  DF5B  2812          		JR	Z,CPSTR2
  DF5D  7E            		LD	A,(HL)
  DF5E  CDD3E0        		CALL	FKANC
  DF61  E5            		PUSH	HL
  DF62  67            		LD	H,A
  DF63  1A            		LD	A,(DE)
  DF64  CB01          		RLC	C
  DF66  CDD3E0        		CALL	FKANC
  DF69  CB09          		RRC	C
  DF6B  BC            		CP	H		;CP (HL),(DE)
  DF6C  E1            		POP	HL
  DF6D  2004          		JR	NZ,CPSTR3
  DF6F                	CPSTR2:
  DF6F  13            		INC	DE
  DF70  23            		INC	HL
  DF71  10E5          		DJNZ	CPSTR1
  DF73                	CPSTR3:
  DF73  C1            		POP	BC
  DF74  C9            		RET
                      	
  DF75                	CPFILE2:
  DF75  FD7E0D        		LD	A,(IY+13)	;(FCB)属性(アトリビュート)
  DF78  F6E1          		OR	0E1H
  DF7A  2F            		CPL
  DF7B  A6            		AND	(HL)
  DF7C  C9            		RET
                      	
  DF7D                	DCPAT:
  DF7D  0E00          		LD	C,0
  DF7F  2A7EEC        		LD	HL,(_DTBUF)
  DF82  3AA0EC        		LD	A,(_DIRF)	;ディレクトリか判別
  DF85  B7            		OR	A
  DF86  C8            		RET	Z		;ルートディレクトリの場合はCレジスタを0にしておく(CDEがセクタ番号)
  DF87  3A9BDF        		LD	A,(SPCPAT+1)
  DF8A  4F            		LD	C,A
  DF8B  3AEAE6        		LD	A,(_SECPS+1)
  DF8E  B9            		CP	C
  DF8F  3001          		JR	NC,DC1
  DF91  AF            		XOR	A
  DF92                	DC1:
  DF92  F680          		OR	080H
  DF94  32A0EC        		LD	(_DIRF),A	;bit0-6:セクタインデックス
  DF97                	CLUSTX:
  DF97  E5            		PUSH	HL
  DF98  EB            		EX	DE,HL
  DF99  AF            		XOR	A
  DF9A  0E01          	SPCPAT:	LD	C,1		;自己書き換え（1クラスタの論理セクタ数）
  DF9C                	L_CLDBL:
  DF9C  CB19          		RR	C		;->CF
  DF9E  3804          		JR	C,E_CLDBL
  DFA0  29            		ADD	HL,HL		;*2
  DFA1  8F            		ADC	A,A
  DFA2  18F8          		JR	L_CLDBL
  DFA4                	E_CLDBL
  DFA4  4F            		LD	C,A
  DFA5  3AEAE6        		LD	A,(_SECPS+1)
  DFA8  B5            		OR	L
  DFA9  6F            		LD	L,A
  DFAA  110800        	CLSPAT:	LD	DE,8	;+8 (2D)  !ADDCL (Self-rewriting)
  DFAD  AF            		XOR	A
  DFAE  19            		ADD	HL,DE	;データ格納領域の先頭論理セクタ番号
  DFAF  89            		ADC	A,C
  DFB0  4F            		LD	C,A
  DFB1  EB            		EX	DE,HL
  DFB2  E1            		POP	HL
  DFB3  C9            		RET
                      	
  DFB4                	ENDCL:
  DFB4  7A            		LD	A,D	;END CLUSTER
  DFB5  FE01          	CLPAT1:	CP	1	;164=356	(Self-rewriting)
  DFB7  C0            		RET	NZ
  DFB8  7B            		LD	A,E
  DFB9  FE64          	CLPAT2:	CP	064H	;		(Self-rewriting)
  DFBB  C9            		RET
                      	
  DFBC                	CAP:
  DFBC  FE61          		CP	'a'
  DFBE  D8            		RET	C
  DFBF  FE7B          		CP	'z'+1
  DFC1  D0            		RET	NC
  DFC2  D620          		SUB	020H
  DFC4  C9            		RET
  DFC5                	CAP2:
  DFC5  CDBCDF        		CALL	CAP
  DFC8                	CAP3:
  DFC8  CDD1DF        		CALL	CAP4
  DFCB  FE21          		CP	021H
  DFCD  D0            		RET	NC
  DFCE  3EA0          		LD	A,0A0H
  DFD0  C9            		RET
  DFD1                	CAP4:
  DFD1  FE05          		CP	5
  DFD3  C0            		RET	NZ
  DFD4  3EE5          		LD	A,0E5H
  DFD6  C9            		RET
                      	
  DFD7                	CHDIR:
  DFD7  CDAFE9        		CALL	GETDPBD
  DFDA  381D          		JR	C,CHDIR2
  DFDC  DD751A        		LD	(IX+01AH),L		;_SDIR_
  DFDF  DD741B        		LD	(IX+01BH),H		;_SDIR_+1
  DFE2  1815          		JR	CHDIR2		;POP_IX_RET
                      	
  DFE4                	LDDIR:
  DFE4  CDAFE9        		CALL	GETDPBD
  DFE7  DD5E1A        		LD	E,(IX+01AH)		;_SDIR_
  DFEA  DD561B        		LD	D,(IX+01BH)		;_SDIR_+1
  DFED  13            		INC	DE
  DFEE  FD730E        		LD	(IY+14),E	;(FCB)アクセスするディレクトリのクラスタ番号+1
  DFF1  FD720F        		LD	(IY+15),D
  DFF4  1B            		DEC	DE
  DFF5  AF            		XOR	A
  DFF6  32A0EC        		LD	(_DIRF),A
  DFF9                	CHDIR2:
  DFF9  DDE1          		POP	IX
  DFFB  C9            		RET
                      	
  DFFC                	LDDIRX:
  DFFC  3AA0EC        		LD	A,(_DIRF)	;(FCB)アクセスするディレクトリのセクタインデックス
  DFFF  E67F          		AND	07FH
  E001                	LDDIRX1:
  E001  32EAE6        		LD	(_SECPS+1),A
  E004  FD5E0E        		LD	E,(IY+14)	;(FCB)アクセスするディレクトリのクラスタ番号+1
  E007  FD560F        		LD	D,(IY+15)
  E00A  1B            		DEC	DE
  E00B  CDB4DF        		CALL	ENDCL
  E00E  D4E4DF        		CALL	NC,LDDIR
  E011                	LDDIRS:
  E011  7A            		LD	A,D
  E012  B3            		OR	E
  E013  32A0EC        		LD	(_DIRF),A	;ディレクトリか判別
  E016  C9            		RET
                      	
  E017                	KILL:
  E017  CDEDE0        		CALL	CHKWILDX
  E01A  383A          		JR	C,KILLW
  E01C  CD24DF        		CALL	CHKDDX
  E01F  3F            		CCF
  E020  D4ABDD        		CALL	NC,SOPENX1
  E023                	KILLS:
  E023  3E1F          		LD	A,01FH
  E025  D469E0        		CALL	NC,CHKATT
  E028  D8            		RET	C
  E029                	KILLSX:
  E029  36E5          		LD	(HL),0E5H	;DIR
  E02B  CDC7E0        		CALL	WTDB
  E02E  111A00        		LD	DE,01AH
  E031  19            		ADD	HL,DE
  E032  5E            		LD	E,(HL)
  E033  23            		INC	HL
  E034  56            		LD	D,(HL)
  E035  1804          		JR	KILLS2
  E037                	KILLS1:
  E037  ED5BFEEB      		LD	DE,(_CLPS)	;FAT
  E03B                	KILLS2:
  E03B  CDB4DF        		CALL	ENDCL
  E03E  D0            		RET	NC		;CF=0
  E03F  21FEFF        		LD	HL,0-2
  E042  19            		ADD	HL,DE
  E043  D0            		RET	NC		;DE= 0 or 1
  E044  D5            		PUSH	DE
  E045  CDF7EC        		CALL	_GNCL
  E048  ED53FEEB      		LD	(_CLPS),DE
  E04C  D1            		POP	DE
  E04D  210000        		LD	HL,0
  E050  D4FAEC        		CALL	NC,_SNCL
  E053  30E2          		JR	NC,KILLS1
  E055  C9            		RET
                      	
  E056                	KILLW:
  E056  CDD8DD        		CALL	SOPEN
  E059                	KILLW1:
  E059  380B          		JR	C,KILLW2
  E05B  CD78DE        		CALL	SOPENE2
  E05E  CD23E0        		CALL	KILLS
  E061  CD3CDE        		CALL	NOPEN
  E064  18F3          		JR	KILLW1
  E066                	KILLW2:
  E066  C8            		RET	Z
  E067  3F            		CCF
  E068  C9            		RET
                      	
  E069                	CHKATT:
  E069  E5            		PUSH	HL
  E06A  110B00        		LD	DE,00BH
  E06D  19            		ADD	HL,DE
  E06E  A6            		AND	(HL)
  E06F  E1            		POP	HL
  E070  C8            		RET	Z
  E071  37            		SCF
  E072  C9            		RET
                      	
  E073                	NAME:
  E073  CDEDE0        		CALL	CHKWILDX
  E076  D8            		RET	C
  E077  110400        		LD	DE,4
  E07A  19            		ADD	HL,DE
  E07B  2293E0        		LD	(NAMEP+2),HL
  E07E  23            		INC	HL
  E07F  CDF1E0        		CALL	CHKWILD
  E082  D8            		RET	C
                      	
  E083  CDABDD        		CALL	SOPENX1
  E086  3E0F          		LD	A,00FH
  E088  D469E0        		CALL	NC,CHKATT
  E08B  D8            		RET	C
                      	
  E08C  FD7E00        		LD	A,(IY+0)
  E08F  FDE5          		PUSH	IY
  E091  FD210000      	NAMEP:	LD	IY,0
  E095  FD7700        		LD	(IY+0),A
  E098  CDABDD        		CALL	SOPENX1
  E09B  FDE3          		EX	(SP),IY
  E09D  3F            		CCF
  E09E  D4D8DD        		CALL	NC,SOPEN
  E0A1  EB            		EX	DE,HL
  E0A2  E1            		POP	HL
  E0A3  D8            		RET	C
                      	
  E0A4                	SETNAME:
  E0A4  01000B        		LD	BC,11*256
  E0A7  23            		INC	HL
  E0A8  7E            		LD	A,(HL)
  E0A9  FEE5          		CP	0E5H
  E0AB  2004          		JR	NZ,SNAME1
  E0AD  3E05          		LD	A,5
  E0AF  180E          		JR	SNAME3
  E0B1                	SNAME1:
  E0B1  7E            		LD	A,(HL)
  E0B2  0C            		INC	C
  E0B3  0D            		DEC	C
  E0B4  2009          		JR	NZ,SNAME3
  E0B6  CDBCDF        		CALL	CAP
  E0B9  FEA0          		CP	0A0H
  E0BB  2002          		JR	NZ,SNAME3
  E0BD  3E20          		LD	A,020H
  E0BF                	SNAME3:
  E0BF  12            		LD	(DE),A
  E0C0  7E            		LD	A,(HL)
  E0C1  23            		INC	HL
  E0C2  CDDAE0        		CALL	FKAN
  E0C5  10EA          		DJNZ	SNAME1
  E0C7                	WTDB:
  E0C7  3EFF          		LD	A,0FFH
  E0C9  3286E2        		LD	(SFILE),A
  E0CC                	SWTDBF:
  E0CC  3E01          		LD	A,1
  E0CE  32A4EC        		LD	(_WTDBF),A
  E0D1  AF            		XOR	A
  E0D2  C9            		RET
                      	
  E0D3                	FKANC:
  E0D3  CB41          		BIT	0,C
  E0D5  CCC5DF        		CALL	Z,CAP2
  E0D8  1801          		JR	FKANX
  E0DA                	FKAN:
  E0DA  13            		INC	DE
  E0DB                	FKANX:
  E0DB  CB41          		BIT	0,C
  E0DD  CB81          		RES	0,C
  E0DF  C0            		RET	NZ
  E0E0  FE80          		CP	080H
  E0E2  D8            		RET	C
  E0E3  FEA0          		CP	0A0H
  E0E5  3803          		JR	C,FKAN1
  E0E7  FEE0          		CP	0E0H
  E0E9  D8            		RET	C
  E0EA                	FKAN1:
  E0EA  0C            		INC	C
  E0EB  A7            		AND	A
  E0EC  C9            		RET
                      	
  E0ED                	CHKWILDX:
  E0ED  FDE5          		PUSH	IY
  E0EF  E1            		POP	HL
  E0F0  23            		INC	HL
  E0F1                	CHKWILD:
  E0F1  060B          		LD	B,11
  E0F3  3E3F          		LD	A,'?'
  E0F5                	CHKWIL1:
  E0F5  BE            		CP	(HL)
  E0F6  23            		INC	HL
  E0F7  37            		SCF
  E0F8  C8            		RET	Z
  E0F9  10FA          		DJNZ	CHKWIL1
  E0FB  AF            		XOR	A
  E0FC  C9            		RET
                      	
  E0FD                	SDIRENT:		;IY=FCB HL=DIR
  E0FD  D5            		PUSH	DE
  E0FE  E5            		PUSH	HL
  E0FF  FDE5          		PUSH	IY
  E101  D1            		POP	DE
  E102  EB            		EX	DE,HL
  E103  CDA4E0        		CALL	SETNAME
                      	;				Attribute
  E106  FD7E0D        		LD	A,(IY+13)	;(FCB)属性(アトリビュート)
  E109  12            		LD	(DE),A
  E10A  13            		INC	DE
                      	;				Reserved
  E10B  AF            		XOR	A
  E10C  060A          		LD	B,10
  E10E                	SDE1:
  E10E  12            		LD	(DE),A
  E10F  13            		INC	DE
  E110  10FC          		DJNZ	SDE1
                      						;(FCB)ファイルを最後に変更した時刻
  E112  21EAEB        		LD	HL,SDDATA		;(FCB)ファイルを最後に変更した日付
  E115  060A          		LD	B,SDDATAE-SDDATA	;(FCB)ファイルの先頭クラスタ
  E117                	SDLOOP:					;(FCB)ファイルのサイズ(バイト単位)
  E117  7E            		LD	A,(HL)
  E118  23            		INC	HL
  E119  321EE1        		LD	(SDPAT+2),A
  E11C  FD7E00        	SDPAT:	LD	A,(IY+0)	;LD A,(IY+A)
  E11F  12            		LD	(DE),A
  E120  13            		INC	DE
  E121  10F4          		DJNZ	SDLOOP
                      	
  E123  AF            		XOR	A
  E124  E1            		POP	HL
  E125  D1            		POP	DE
  E126  C9            		RET
                      	
  E127                	WOPEN:
  E127  FD7E0D        		LD	A,(IY+13)	;(FCB)属性(アトリビュート)
  E12A  E61F          		AND	01FH
  E12C  37            		SCF
  E12D  C0            		RET	NZ
  E12E  FD361CFE      		LD	(IY+28),0FEH	;(FCB)オープン・モード
  E132                	TOPEN2:
  E132  AF            		XOR	A
  E133                	TOPEN:				;Initializes the time stamp
  E133  FD3617FF      		LD	(IY+23),0FFH	;(FCB)ファイルを最後に変更した時刻
  E137  C9            		RET
                      	
  E138                	WRDFX:
  E138  3A9BDF        		LD	A,(SPCPAT+1)	;1クラスタの論理セクタ
  E13B                	L_WRFX:
  E13B  1F            		RRA		;->CF
  E13C  3804          		JR	C,E_WRFX
  E13E  CB39          		SRL	C	;C=C/2
  E140  18F9          		JR	L_WRFX
  E142                	E_WRFX:
  E142  41            		LD	B,C
  E143  04            		INC	B
  E144  3E37          		LD	A,037H		;SCF
  E146  3286E5        		LD	(DRDN1),A
                      	
  E149                	WRDF:				;Bクラスタ分FATを確保する
  E149  110200        		LD	DE,2
  E14C  AF            		XOR	A
  E14D  32EAE6        		LD	(_SECPS+1),A
  E150                	WRDF1:
  E150  C5            		PUSH	BC
  E151  D5            		PUSH	DE
  E152  CDF7EC        		CALL	_GNCL
  E155  381C          		JR	C,WRDF3
  E157  7A            		LD	A,D		;空いているかチェック
  E158  B3            		OR	E
  E159  2027          		JR	NZ,WRDF4
  E15B  E1            		POP	HL		;HL=空いているクラスタ
  E15C  E5            		PUSH	HL
  E15D  ED5BFEEB      		LD	DE,(_CLPS)	;DE=元の(_CLPS)
  E161  22FEEB        		LD	(_CLPS),HL
  E164  7A            		LD	A,D		;元の(_CLPS)が 0 か?
  E165  B3            		OR	E
  E166  2008          		JR	NZ,WRDF2
  E168  FD751A        		LD	(IY+26),L	;(FCB)ファイルの先頭クラスタ
  E16B  FD741B        		LD	(IY+27),H	;元が空の場合はFCBにクラスタをセットする
  E16E  1803          		JR	WRDF3
  E170                	WRDF2:
  E170  CDFAEC        		CALL	_SNCL
  E173                	WRDF3:
  E173  D1            		POP	DE
  E174  C1            		POP	BC
  E175  D8            		RET	C
  E176  100C          		DJNZ	WRDF5		;ここでループカウンタチェック
  E178  ED5BFEEB      		LD	DE,(_CLPS)
  E17C  21FFFF        		LD	HL,0FFFFH	;FATエントリ終了(EOCマーク)
  E17F  C3FAEC        		JP	_SNCL
                      	
  E182                	WRDF4:				;DEクラスタが空じゃないので次に移動する
  E182  D1            		POP	DE
  E183  C1            		POP	BC
  E184                	WRDF5:
  E184  13            		INC	DE
  E185  CDB4DF        		CALL	ENDCL
  E188  38C6          		JR	C,WRDF1
  E18A  37            		SCF
  E18B  C9            		RET
                      	
  E18C                	RWXR:
  E18C  3AFAE4        		LD	A,(SECSZ+2)	;1024=4 / 512=2 / 256=1
  E18F                	L_RWX:
  E18F  1F            		RRA		;->CF
  E190  3806          		JR	C,E_RWX
  E192  CB38          		SRL	B	;BC=BC/2
  E194  CB19          		RR	C	;
  E196  18F7          		JR	L_RWX
  E198                	E_RWX:
  E198  FD5E1A        		LD	E,(IY+26)	;(FCB)ファイルの先頭クラスタ
  E19B  FD561B        		LD	D,(IY+27)
  E19E  AF            		XOR	A
  E19F  32EAE6        		LD	(_SECPS+1),A
  E1A2                	RWX1:
  E1A2  ED53FEEB      		LD	(_CLPS),DE
  E1A6  7A            		LD	A,D
  E1A7  B3            		OR	E
  E1A8  280D          		JR	Z,SCF_RET	;RET DE==0 => CF=1
                      	
  E1AA  78            		LD	A,B
  E1AB  B1            		OR	C
  E1AC  C8            		RET	Z		;RET BC==0 => CF=0
                      	
  E1AD  CDF2E6        		CALL	GNCLX
  E1B0  D8            		RET	C
  E1B1  0B            		DEC	BC
                      	
  E1B2  CDB4DF        		CALL	ENDCL
  E1B5  38EB          		JR	C,RWX1
  E1B7                	SCF_RET:
  E1B7  37            		SCF
  E1B8  C9            		RET
                      	
  E1B9                	DSKF:
  E1B9  110000        	MAXCLP:	LD	DE,0
  E1BC  2AACEC        		LD	HL,(_FAKEFREE)
  E1BF  7C            		LD	A,H
  E1C0  B5            		OR	L
  E1C1  2803          		JR	Z,DSKF1
  E1C3  110100        		LD	DE,1
  E1C6                	DSKF1:
  E1C6  D5            		PUSH	DE
  E1C7  CDF7EC        		CALL	_GNCL
  E1CA  380C          		JR	C,POPSCF
  E1CC  7A            		LD	A,D
  E1CD  B3            		OR	E
  E1CE  2001          		JR	NZ,DSKF2
  E1D0  23            		INC	HL
  E1D1                	DSKF2:
  E1D1  D1            		POP	DE
  E1D2  1B            		DEC	DE
  E1D3  7A            		LD	A,D
  E1D4  B3            		OR	E
  E1D5  20EF          		JR	NZ,DSKF1
  E1D7  C9            		RET
                      	
  E1D8                	POPSCF:
  E1D8  F1            		POP	AF
  E1D9  37            		SCF
  E1DA  C9            		RET
                      	
  E1DB                	SETTMS:
  E1DB  FD7E17        		LD	A,(IY+23)	;(FCB)ファイルを最後に変更した時刻
  E1DE  3C            		INC	A
  E1DF  C0            		RET	NZ		;ファイルが更新されていない
  E1E0                	SETTMSX:			;FCBに日付時刻をセットする
  E1E0  CD52D8        		CALL	_SYS2C		;(BDOS)時刻の獲得
                      					;H←時  L←分  D←秒
  E1E3  CB25          		SLA	L		;L=L/2
  E1E5  CB25          		SLA	L		;L=L/2
  E1E7  29            		ADD	HL,HL		;*2
  E1E8  29            		ADD	HL,HL		;*4
  E1E9  29            		ADD	HL,HL		;*8
  E1EA  7A            		LD	A,D
  E1EB  0F            		RRCA			;bit.0->7->->->0->C
  E1EC  E61F          		AND	01FH
  E1EE  B5            		OR	L
  E1EF  FD7716        		LD	(IY+22),A	;(FCB)ファイルを最後に変更した時刻
  E1F2  FD7417        		LD	(IY+23),H
                      	
  E1F5  CD1ED8        		CALL	_SYS2A		;(BDOS)日付の獲得
                      					;HL←年  D←月  E←日
  E1F8  0144F8        		LD	BC,0-1980
  E1FB  09            		ADD	HL,BC
  E1FC  65            		LD	H,L
                      	
  E1FD  7A            		LD	A,D
  E1FE  87            		ADD	A,A		;*2
  E1FF  87            		ADD	A,A		;*4
  E200  87            		ADD	A,A		;*8
  E201  87            		ADD	A,A		;*16
  E202  6F            		LD	L,A
  E203  29            		ADD	HL,HL		;*32
  E204  7D            		LD	A,L
  E205  B3            		OR	E
  E206  FD7714        		LD	(IY+20),A	;(FCB)ファイルを最後に変更した日付
  E209  FD7415        		LD	(IY+21),H
  E20C  C9            		RET
                      	
  E20D                	PUSHRR:
  E20D  CD13E2        		CALL	SUBRR
  E210                	POPRR1:
  E210  EDB0          		LDIR
  E212  C9            		RET
                      	
  E213                	SUBRR:
  E213  FDE5          		PUSH	IY
  E215  E1            		POP	HL
  E216  112100        		LD	DE,33
  E219  19            		ADD	HL,DE
  E21A  11A7E2        		LD	DE,HLBUF
  E21D  010300        		LD	BC,3
  E220  C9            		RET
                      	
  E221                	SETSEQ:
  E221  F5            		PUSH	AF		;AHL=Random record
  E222  FD7E21        		LD	A,(IY+33)	;(FCB)ランダム・レコード
  E225  FD6E22        		LD	L,(IY+34)
  E228  FD6623        		LD	H,(IY+35)
                      	
  E22B  CD47E2        		CALL	SSQ1
                      	
  E22E  29            		ADD	HL,HL
  E22F  CB3D          		SRL	L		;L=L/2
  E231  FD7520        		LD	(IY+32),L	;(FCB)カレント・レコード
  E234  FD740C        		LD	(IY+12),H	;(FCB)カレント・ブロック
  E237  F1            		POP	AF
                      	
  E238                	POPRR:
  E238  CD13E2        		CALL	SUBRR
  E23B  EB            		EX	DE,HL
  E23C  18D2          		JR	POPRR1
                      	
  E23E                	GETSIZE:
  E23E  FD7E10        		LD	A,(IY+16)	;(FCB)ファイルのサイズ(バイト単位)
  E241  FD6E11        		LD	L,(IY+17)
  E244  FD6612        		LD	H,(IY+18)
  E247                	SSQ1:				;バイト単位からCP/Mのレコード単位を求める（1レコード=128バイト）
  E247  87            		ADD	A,A		;in HLA => out HL
  E248  ED6A          		ADC	HL,HL
  E24A  B7            		OR	A
  E24B  C8            		RET	Z
  E24C  23            		INC	HL
  E24D  C9            		RET
                      	
  E24E                	GETSEQ:
  E24E  FD6E20        		LD	L,(IY+32)	;(FCB)カレント・レコード
  E251  FD660C        		LD	H,(IY+12)	;(FCB)カレント・ブロック
                      	
  E254  CB25          		SLA	L	;L=L*2
                      	
  E256  CB3C          		SRL	H	;HL=HL/2
  E258  CB1D          		RR	L	;
  E25A  C9            		RET
                      	
  E25B                	RB_WRITE:
  E25B  C5            		PUSH	BC
  E25C  ED4B4CEC      		LD	BC,(STABLE+2*026H)	;(BDOS)ランダム・ブロック・ライト
  E260  1805          		JR	RBRW
  E262                	RB_READ:
  E262  C5            		PUSH	BC
  E263  ED4B4EEC      		LD	BC,(STABLE+2*027H)	;(BDOS)ランダム・ブロック・リード
  E267                	RBRW:
  E267  AF            		XOR	A	;HLA = HL*128
  E268  CB3C          		SRL	H	;HL=HL/2
  E26A  CB1D          		RR	L	;
  E26C  1F            		RRA			;HLA
  E26D  FD7721        		LD	(IY+33),A	;(FCB)ランダム・レコード
  E270  FD7522        		LD	(IY+34),L
  E273  FD7423        		LD	(IY+35),H
  E276  218000        		LD	HL,128
                      	
  E279  FDE5          		PUSH	IY
  E27B  D1            		POP	DE
  E27C  D5            		PUSH	DE
  E27D  CD84E2        		CALL	JP_BC
  E280  FDE1          		POP	IY
  E282  C1            		POP	BC
  E283  C9            		RET
  E284                	JP_BC:
  E284  C5            		PUSH	BC
  E285  C9            		RET
                      	
  E286                	SFILE:	DS	33		;DRV FILENAME
  E2A7                	HLBUF:	DS	3		;Random record buffer
                      	
                      	;LDFILE2.ASM
                      	
                      	;	LSX-Dodgers FILE2
                      	
  E2AA                	RBWDD:
  E2AA  E5            		PUSH	HL
  E2AB  C1            		POP	BC
  E2AC  2186E3        		LD	HL,NUL
  E2AF  CDBAE3        		CALL	DDX
  E2B2  2003          		JR	NZ,RBWDD2
  E2B4  2A08EC        		LD	HL,(STABLE+2*4)
  E2B7                	RBWDD2:
  E2B7  FE43          		CP	'C'
  E2B9  2003          		JR	NZ,RBWDD3
  E2BB  2142DA        		LD	HL,PRINTS
  E2BE                	RBWDD3:
  E2BE  FE50          		CP	'P'
  E2C0  2003          		JR	NZ,RBWDD4
  E2C2  2A0AEC        		LD	HL,(STABLE+2*5)
  E2C5                	RBWDD4:
  E2C5  22D3E2        		LD	(RBWDDP+1),HL
  E2C8  2A8AEC        		LD	HL,(_DTA)
  E2CB                	RBWDD1:
  E2CB  78            		LD	A,B
  E2CC  B1            		OR	C
  E2CD                	RBWDD5:
  E2CD  CA81E3        		JP	Z,RBW1
  E2D0  5E            		LD	E,(HL)
  E2D1  23            		INC	HL
  E2D2  CD96D7        	RBWDDP:	CALL	_SYS02
  E2D5  DA9DE3        		JP	C,RBRERR
  E2D8  3E1A          		LD	A,01AH
  E2DA  BB            		CP	E
  E2DB  28F0          		JR	Z,RBWDD5
  E2DD  0B            		DEC	BC
  E2DE  18EB          		JR	RBWDD1
                      	
                      					;Write random block
  E2E0                	_SYS26:		;(BDOS)ランダム・ブロック・ライト
  E2E0  AF            		XOR	A
  E2E1  3286E5        		LD	(DRDN1),A	;NOP
  E2E4  223CE5        		LD	(LEFT+1),HL	;HL←書き込むレコード数
  E2E7  225EE5        		LD	(LEFTX),HL
  E2EA  CD84DD        		CALL	SETDRV
                      	
  E2ED  CDA6E4        		CALL	RBX0
  E2F0  DA88E3        		JP	C,RBWERR
  E2F3  28B5          		JR	Z,RBWDD		;デバイスデスクプリタ
  E2F5  CD27E1        		CALL	WOPEN
  E2F8  DA88E3        		JP	C,RBWERR
  E2FB  7C            		LD	A,H
  E2FC  B5            		OR	L
  E2FD  CA81E3        		JP	Z,RBW1
                      	
  E300  2B            		DEC	HL
                      	
  E301  CD54E5        		CALL	GET_RR_CDE	;CDE=Random record
                      	
  E304  AF            		XOR	A	;AHL=HL+CDE
  E305  19            		ADD	HL,DE
  E306  89            		ADC	A,C
                      	
  E307  47            		LD	B,A
  E308  4C            		LD	C,H
                      	
  E309  CD8CE1        		CALL	RWXR
  E30C  DC38E1        		CALL	C,WRDFX
  E30F  DA88E3        		JP	C,RBWERR
                      		
  E312  CDCFE4        		CALL	RBX2
  E315  281A          		JR	Z,RBWB		;NZ=セクタ以下の端数がある
  E317  CDE2E4        		CALL	RBXA		
  E31A  386C          		JR	C,RBWERR
  E31C  EB            		EX	DE,HL
  E31D  C5            		PUSH	BC
  E31E  EDB0          		LDIR
  E320  2260E5        		LD	(DTAX),HL
                      	
  E323  CDCCE0        		CALL	SWTDBF		;バッファデータは更新された
                      	
  E326  2A5EE5        		LD	HL,(LEFTX)
  E329  D1            		POP	DE
  E32A  ED52          		SBC	HL,DE
  E32C  225EE5        		LD	(LEFTX),HL
  E32F  2830          		JR	Z,RBWEND
                      	
  E331                	RBWB:
  E331  CD18E5        		CALL	RBXB
  E334  2813          		JR	Z,RBWC
  E336                	RBWB1:
  E336  C5            		PUSH	BC
  E337  D5            		PUSH	DE
  E338  CD97DF        		CALL	CLUSTX
  E33B  CD5BE8        		CALL	DWT24
  E33E  D1            		POP	DE
  E33F  C1            		POP	BC
  E340  3846          		JR	C,RBWERR
  E342  CDF2E6        		CALL	GNCLX
  E345  3841          		JR	C,RBWERR
  E347  10ED          		DJNZ	RBWB1
  E349                	RBWC:
  E349  CD30E5        		CALL	RBXC
  E34C  2813          		JR	Z,RBWEND
  E34E  C5            		PUSH	BC
  E34F  CD97DF        		CALL	CLUSTX
  E352  CD85E5        		CALL	DRDN
  E355  C1            		POP	BC
  E356  3830          		JR	C,RBWERR
  E358  ED5B7EEC      		LD	DE,(_DTBUF)
  E35C  EDB0          		LDIR
  E35E  CDCCE0        		CALL	SWTDBF		;バッファデータは更新された
  E361                	RBWEND:
  E361  CD3BE5        		CALL	RBXEND
                      	
  E364  CDB5E4        		CALL	RBX1
  E367  3018          		JR	NC,RBW1
  E369  2A3CE5        		LD	HL,(LEFT+1)
  E36C  FD5E10        		LD	E,(IY+16)	;(FCB)ファイルのサイズ(バイト単位)
  E36F  FD5611        		LD	D,(IY+17)	;CDE=File size
  E372  FD4E12        		LD	C,(IY+18)
  E375  AF            		XOR	A
  E376  19            		ADD	HL,DE
  E377  89            		ADC	A,C
  E378  FD7510        		LD	(IY+16),L	;(FCB)ファイルのサイズ(バイト単位)
  E37B  FD7411        		LD	(IY+17),H
  E37E  FD7712        		LD	(IY+18),A
  E381                	RBW1:
  E381  FDE1          		POP	IY
  E383  C1            		POP	BC
  E384  D1            		POP	DE
  E385  E1            		POP	HL
  E386                	NUL:
  E386  AF            		XOR	A
  E387  C9            		RET
                      	
  E388                	RBWERR:
  E388  FDE5          		PUSH	IY
  E38A  D1            		POP	DE
  E38B  2A20EC        		LD	HL,(STABLE+2*010H)
  E38E  CD0F00        		CALL	JP_HL
  E391                	RBRERR1:
  E391  3E01          		LD	A,001H
  E393                	RBRERR2:
  E393  FDE1          		POP	IY
  E395  C1            		POP	BC
  E396  D1            		POP	DE
  E397  E1            		POP	HL
  E398  37            		SCF
  E399  210000        		LD	HL,0
  E39C  C9            		RET
                      	
  E39D                	RBRERR:
  E39D  3EFF          		LD	A,0FFH
  E39F  18F2          		JR	RBRERR2
                      	
  E3A1                	RBRFL:
  E3A1  3E00          	RBRFLP:	LD	A,000H
  E3A3  FE0D          		CP	00DH
  E3A5  2005          		JR	NZ,RBRFL1
  E3A7  D5            		PUSH	DE
  E3A8  1E0A          		LD	E,00AH
  E3AA  1805          		JR	RBRFL2
  E3AC                	RBRFL1:
  E3AC  D5            		PUSH	DE
  E3AD  CD78D3        		CALL	_SYS07
  E3B0  5F            		LD	E,A
  E3B1                	RBRFL2:
  E3B1  CDCDEC        		CALL	_PRINT
  E3B4  7B            		LD	A,E
  E3B5  D1            		POP	DE
  E3B6  32A2E3        		LD	(RBRFLP+1),A
  E3B9  C9            		RET
  E3BA                	DDX:
  E3BA  FD7E01        		LD	A,(IY+1)	;(FCB)主ファイル名
  E3BD  CDBCDF        		CALL	CAP
  E3C0  FE41          		CP	'A'
  E3C2  C9            		RET
                      	
  E3C3                	RBRDD:
  E3C3  E5            		PUSH	HL
  E3C4  C1            		POP	BC
  E3C5  21A1E3        		LD	HL,RBRFL
  E3C8  CDBAE3        		CALL	DDX
  E3CB  2005          		JR	NZ,RBRDD2
  E3CD  2A06EC        		LD	HL,(STABLE+2*3)
  E3D0  1804          		JR	RBRDD3
  E3D2                	RBRDD2:
  E3D2  FE43          		CP	'C'
  E3D4  202C          		JR	NZ,RBRDERR
  E3D6                	RBRDD3:
  E3D6  22E6E3        		LD	(RBRDDP+1),HL
                      	
  E3D9  ED5B8AEC      		LD	DE,(_DTA)
  E3DD  210000        		LD	HL,0
  E3E0                	RBRDD1:
  E3E0  78            		LD	A,B
  E3E1  B1            		OR	C
  E3E2  2818          		JR	Z,RBRDDE1
  E3E4  23            		INC	HL
  E3E5  CDA1E3        	RBRDDP:	CALL	RBRFL
  E3E8  380D          		JR	C,RBRDDE
  E3EA  FE1A          		CP	01AH
  E3EC  2809          		JR	Z,RBRDDE
  E3EE  FE03          		CP	3
  E3F0  2805          		JR	Z,RBRDDE
  E3F2  12            		LD	(DE),A
  E3F3  13            		INC	DE
  E3F4  0B            		DEC	BC
  E3F5  18E9          		JR	RBRDD1
                      	
  E3F7                	RBRDDE:
  E3F7  3E1A          		LD	A,01AH
  E3F9  12            		LD	(DE),A
  E3FA                	RBRDDE2:
  E3FA  AF            		XOR	A
  E3FB  3C            		INC	A
  E3FC                	RBRDDE1:
  E3FC  3292E4        		LD	(RBRAP+1),A
  E3FF  C38BE4        		JP	RBREND0
  E402                	RBRDERR:
  E402  210000        		LD	HL,0
  E405  18F3          		JR	RBRDDE2
                      	
                      					;Read random block
  E407                	_SYS27:		;(BDOS)ランダム・ブロック・リード
  E407  225EE5        		LD	(LEFTX),HL
  E40A  CD84DD        		CALL	SETDRV
                      	
  E40D  FDCB0D66      		BIT	4,(IY+13)	;(FCB)属性(アトリビュート)
  E411  C294E4        		JP	NZ,RBRDIR	;ディレクトリ
  E414  CDA6E4        		CALL	RBX0
  E417  DA9DE3        		JP	C,RBRERR
  E41A  28A7          		JR	Z,RBRDD
  E41C  CDB5E4        		CALL	RBX1
  E41F  DA91E3        		JP	C,RBRERR1
  E422  79            		LD	A,C
  E423  EB            		EX	DE,HL
  E424  ED52          		SBC	HL,DE		;CP 0HL,CDE
  E426  19            		ADD	HL,DE
  E427  DE00          		SBC	A,000H
  E429  3801          		JR	C,RBR1
  E42B  EB            		EX	DE,HL
  E42C                	RBR1:
  E42C  9F            		SBC	A,A
  E42D  E601          		AND	1
  E42F  3292E4        		LD	(RBRAP+1),A
                      	
  E432  7C            		LD	A,H
  E433  B5            		OR	L
  E434  CA8BE4        		JP	Z,RBREND0
                      	
  E437  223CE5        		LD	(LEFT+1),HL	;Read record byte
  E43A  225EE5        		LD	(LEFTX),HL
                      	
  E43D  CDCFE4        		CALL	RBX2
  E440  2819          		JR	Z,RBRB
  E442  CDE2E4        		CALL	RBXA
  E445  DA9DE3        		JP	C,RBRERR
  E448  C5            		PUSH	BC
  E449  EDB0          		LDIR
  E44B  ED5360E5      		LD	(DTAX),DE
  E44F  2A5EE5        		LD	HL,(LEFTX)
  E452  D1            		POP	DE
  E453  A7            		AND	A
  E454  ED52          		SBC	HL,DE
  E456  225EE5        		LD	(LEFTX),HL
  E459  282D          		JR	Z,RBREND
                      	
  E45B                	RBRB:
  E45B  CD18E5        		CALL	RBXB
  E45E  2812          		JR	Z,RBRC
  E460                	RBRB1:
  E460  C5            		PUSH	BC
  E461  D5            		PUSH	DE
  E462  CD97DF        		CALL	CLUSTX
  E465  CD4BE8        		CALL	DRD24
  E468  D1            		POP	DE
  E469  C1            		POP	BC
  E46A  D4F2E6        		CALL	NC,GNCLX
  E46D  DA9DE3        		JP	C,RBRERR
  E470  10EE          		DJNZ	RBRB1
  E472                	RBRC:
  E472  CD30E5        		CALL	RBXC
  E475  2811          		JR	Z,RBREND
  E477  C5            		PUSH	BC
  E478  CD97DF        		CALL	CLUSTX
  E47B  CD69E5        		CALL	DRDX
  E47E  C1            		POP	BC
  E47F  DA9DE3        		JP	C,RBRERR
  E482  EB            		EX	DE,HL
  E483  2A7EEC        		LD	HL,(_DTBUF)
  E486  EDB0          		LDIR
  E488                	RBREND:
  E488  CD3BE5        		CALL	RBXEND
  E48B                	RBREND0:
  E48B  FDE1          		POP	IY
  E48D  C1            		POP	BC
  E48E  D1            		POP	DE
  E48F  F1            		POP	AF	;(HL)
  E490  AF            		XOR	A
  E491  3E00          	RBRAP:	LD	A,000H
  E493  C9            		RET
                      	
  E494                	RBRDIR:
  E494  FD6E1A        		LD	L,(IY+26)	;(FCB)ファイルの先頭クラスタ
  E497  FD661B        		LD	H,(IY+27)
  E49A  CDD7DF        		CALL	CHDIR
  E49D  AF            		XOR	A
  E49E  67            		LD	H,A
  E49F  6F            		LD	L,A
  E4A0  3C            		INC	A
  E4A1  3292E4        		LD	(RBRAP+1),A
  E4A4  18E5          		JR	RBREND0
                      	
  E4A6                	RBX0:
  E4A6  2A8AEC        		LD	HL,(_DTA)
  E4A9  2260E5        		LD	(DTAX),HL
  E4AC  2A5EE5        		LD	HL,(LEFTX)
  E4AF  FD7E1C        		LD	A,(IY+28)	;(FCB)オープン・モード
  E4B2  D6FD          		SUB	0FDH
  E4B4  C9            		RET
                      	
  E4B5                	RBX1:
  E4B5  E5            		PUSH	HL		;Record byte
                      					;AHL=File size
  E4B6  FD6E10        		LD	L,(IY+16)	;ファイルのサイズ(バイト単位)
  E4B9  FD6611        		LD	H,(IY+17)
  E4BC  FD7E12        		LD	A,(IY+18)
                      	
  E4BF  CD54E5        		CALL	GET_RR_CDE	;CDE=Random record
                      	
  E4C2  A7            		AND	A
  E4C3  ED52          		SBC	HL,DE
  E4C5  99            		SBC	A,C
  E4C6  D1            		POP	DE
                      	
  E4C7  D8            		RET	C
  E4C8  4F            		LD	C,A
  E4C9  EB            		EX	DE,HL	;CDE=File byte	HL=Record byte
  E4CA  B2            		OR	D
  E4CB  B3            		OR	E
  E4CC  C0            		RET	NZ
  E4CD  37            		SCF
  E4CE  C9            		RET
                      	
  E4CF                	RBX2:				;Cluster settings
  E4CF  FD4E22        		LD	C,(IY+34)	;(+33)(FCB)ランダム・レコード
  E4D2  FD4623        		LD	B,(IY+35)
  E4D5  CD8CE1        		CALL	RWXR
  E4D8  3AB4DE        		LD	A,(SECSZM1+2)	;1024=3 / 512=1 / 256=0
  E4DB  FDA622        		AND	(IY+34)
  E4DE  FDB621        		OR	(IY+33)
  E4E1  C9            		RET
                      	
  E4E2                	RBXA:
  E4E2  C5            		PUSH	BC
  E4E3  D5            		PUSH	DE
  E4E4  CD97DF        		CALL	CLUSTX
  E4E7  CD69E5        		CALL	DRDX
  E4EA  D1            		POP	DE
  E4EB  C1            		POP	BC
  E4EC  D8            		RET	C
  E4ED  CDF2E6        		CALL	GNCLX
  E4F0  D8            		RET	C
  E4F1  ED53FEEB      		LD	(_CLPS),DE
                      	
  E4F5  FD4E21        		LD	C,(IY+33)	;(FCB)ランダム・レコード
  E4F8  210004        	SECSZ:	LD	HL,0400H	;自己書き換え 1024=0400H / 512=0200H ここに1セクタのサイズが格納される
  E4FB  7C            		LD	A,H
  E4FC  3D            		DEC	A		;1024=3 / 512=1
  E4FD  FDA622        		AND	(IY+34)		;(FCB)ランダム・レコード
  E500  47            		LD	B,A		;BCに1セクタ以下の端数が入る
  E501  ED42          		SBC	HL,BC		;残りを計算
                      	
  E503  ED5B5EE5      		LD	DE,(LEFTX)
  E507  ED52          		SBC	HL,DE		;CP HL,DE
  E509  19            		ADD	HL,DE		;
  E50A  3801          		JR	C,RBXA1		;DEとHLを比較して大きい方をHLに
  E50C  EB            		EX	DE,HL
  E50D                	RBXA1:
  E50D  E5            		PUSH	HL
  E50E  2A7EEC        		LD	HL,(_DTBUF)
  E511  09            		ADD	HL,BC
  E512  ED5B60E5      		LD	DE,(DTAX)
  E516  C1            		POP	BC
  E517  C9            		RET
                      	
  E518                	RBXB:
  E518  2A60E5        		LD	HL,(DTAX)
  E51B  ED5BFEEB      		LD	DE,(_CLPS)
  E51F  3A5FE5        		LD	A,(LEFTX+1)
  E522  47            		LD	B,A
  E523  3AFAE4        		LD	A,(SECSZ+2)	;1024=4 / 512=2 / 256=1
  E526                	RBXB1:
  E526  1F            		RRA		;->CF
  E527  3804          		JR	C,RBXB2
  E529  CB38          		SRL	B	;B=B/2
  E52B  18F9          		JR	RBXB1
  E52D                	RBXB2:
  E52D  78            		LD	A,B
  E52E  B7            		OR	A
  E52F  C9            		RET
                      	
  E530                	RBXC:
  E530  ED4B5EE5      		LD	BC,(LEFTX)
  E534  3AB4DE        		LD	A,(SECSZM1+2)	;1024=3 / 512=1 / 256=0
  E537  A0            		AND	B
  E538  47            		LD	B,A		;1セクタ以下の端数がない場合はZ
  E539  B1            		OR	C
  E53A  C9            		RET
                      	
  E53B                	RBXEND:
  E53B  110000        	LEFT:	LD	DE,0
  E53E  AF            		XOR	A
  E53F  FD6E21        		LD	L,(IY+33)	;(FCB)ランダム・レコード
  E542  FD6622        		LD	H,(IY+34)
  E545  19            		ADD	HL,DE
  E546  FD8E23        		ADC	A,(IY+35)
  E549  FD7521        		LD	(IY+33),L	;(FCB)ランダム・レコード
  E54C  FD7422        		LD	(IY+34),H
  E54F  FD7723        		LD	(IY+35),A
  E552  EB            		EX	DE,HL		;HL=Read byte
  E553  C9            		RET
                      	
  E554                	GET_RR_CDE:			;CDE=Random record
  E554  FD5E21        		LD	E,(IY+33)	;(FCB)ランダム・レコード
  E557  FD5622        		LD	D,(IY+34)
  E55A  FD4E23        		LD	C,(IY+35)
  E55D  C9            		RET
                      	
  E55E                	CPBUF:
  E55E  0000          	LEFTX:	DW	0
  E560  0000          	DTAX:	DW	0
  E562  20            		DB	020H	;CPBUFで使う
  E563  20            		DB	020H
  E564  20            		DB	020H
  E565  20            		DB	020H
  E566  20            		DB	020H
  E567  20            		DB	020H
  E568  20            		DB	020H
                      	;
                      	
                      	;LDDIO.ASM
                      	
                      	;	LSX-Dodgers DIO
                      	
  E569                	DRDX:
  E569  CDA7E5        		CALL	DRDY
  E56C  C8            		RET	Z
  E56D  CD8DE5        		CALL	DRDX1		;データバッファの情報を保存
  E570  D8            		RET	C
  E571  E5            		PUSH	HL
  E572  C5            		PUSH	BC
  E573  D5            		PUSH	DE
  E574  2A7EEC        		LD	HL,(_DTBUF)
  E577  3AD0E5        		LD	A,(_DBS24+1)
  E57A  4F            		LD	C,A
  E57B  CD4BE8        		CALL	DRD24
  E57E  DCA2E5        		CALL	C,DRDNE
  E581                	POP_DE_BC_HL_RET:
  E581  D1            		POP	DE
  E582  C1            		POP	BC
  E583  E1            		POP	HL
  E584  C9            		RET
                      	
                      	;	CDE:セクタ番号
  E585                	DRDN:
  E585  AF            		XOR	A
  E586  00            	DRDN1:	NOP			;自己書き換え NOP / SCF
  E587  30E0          		JR	NC,DRDX
  E589                	DRDNX:
  E589  CDA7E5        		CALL	DRDY
  E58C  C8            		RET	Z
  E58D                	DRDX1:
  E58D  CDBDE5        		CALL	DWTX
                      					;データバッファの読み込んだドライブ・セクタ情報を保存
  E590  ED53A6EC      		LD	(_DBSEC),DE
  E594  79            		LD	A,C
  E595  32D0E5        		LD	(_DBS24+1),A
                      	
  E598  3A88EC        		LD	A,(_DRV)
  E59B  32A5EC        		LD	(_DBDRV),A
  E59E  CDD9EC        		CALL	_CHGDRV
  E5A1  D0            		RET	NC
  E5A2                	DRDNE:
  E5A2  9F            		SBC	A,A		;CF=1ならばA=0FFH
  E5A3  32A5EC        		LD	(_DBDRV),A
  E5A6  C9            		RET
                      	
                      	;	CDE:セクタ番号
  E5A7                	DRDY:
  E5A7  3AD0E5        		LD	A,(_DBS24+1)
  E5AA  B9            		CP	C
  E5AB  C0            		RET	NZ
                      	
  E5AC  E5            		PUSH	HL
  E5AD  3A88EC        		LD	A,(_DRV)
  E5B0  21A5EC        		LD	HL,_DBDRV
  E5B3  AE            		XOR	(HL)
  E5B4  2005          		JR	NZ,POP_HL_RET
                      	
  E5B6  2AA6EC        		LD	HL,(_DBSEC)
  E5B9  ED52          		SBC	HL,DE		;CF=0
  E5BB                	POP_HL_RET:
  E5BB  E1            		POP	HL
  E5BC  C9            		RET
                      	
  E5BD                	DWTX:
  E5BD  3AA4EC        		LD	A,(_WTDBF)
  E5C0  B7            		OR	A
  E5C1  C8            		RET	Z
  E5C2  AF            		XOR	A
  E5C3  32A4EC        		LD	(_WTDBF),A
                      	
  E5C6  E5            		PUSH	HL
  E5C7  C5            		PUSH	BC
  E5C8  D5            		PUSH	DE
  E5C9  3AA5EC        		LD	A,(_DBDRV)
  E5CC  CDD9EC        		CALL	_CHGDRV
  E5CF  0E00          	_DBS24:	LD	C,0
  E5D1  ED5BA6EC      		LD	DE,(_DBSEC)
  E5D5  2A7EEC        		LD	HL,(_DTBUF)
  E5D8  D45BE8        		CALL	NC,DWT24
  E5DB                	POP_DE_BC_HL_RET2:
  E5DB  18A4          		JR	POP_DE_BC_HL_RET
                      	
  E5DD                	RDFATX:
  E5DD  E5            		PUSH	HL
  E5DE  3A88EC        		LD	A,(_DRV)
  E5E1  21AAEC        		LD	HL,_FATDRV
  E5E4  AE            		XOR	(HL)
  E5E5  28D4          		JR	Z,POP_HL_RET
                      	
  E5E7  C5            		PUSH	BC
  E5E8  D5            		PUSH	DE
  E5E9  DDE5          		PUSH	IX
  E5EB  CD07E6        		CALL	WTFATX
  E5EE  3813          		JR	C,POP_IX_DE_BC_HL_RET
                      	
  E5F0  AF            		XOR	A
  E5F1  32ABEC        		LD	(_FATIX),A
  E5F4  3A88EC        		LD	A,(_DRV)
  E5F7  32AAEC        		LD	(_FATDRV),A
  E5FA  CDE5EC        		CALL	_RDFAT
  E5FD                	RDFATE2:
  E5FD  3004          		JR	NC,POP_IX_DE_BC_HL_RET
  E5FF  9F            		SBC	A,A		;A=0xFF
  E600  32AAEC        		LD	(_FATDRV),A
  E603                	POP_IX_DE_BC_HL_RET:
  E603  DDE1          		POP	IX
  E605  18D4          		JR	POP_DE_BC_HL_RET2
                      	
  E607                	WTFATX:
  E607  3AA2EC        		LD	A,(_WTFATF)
  E60A  B7            		OR	A
  E60B  C8            		RET	Z
  E60C  E5            		PUSH	HL
  E60D  3AAAEC        		LD	A,(_FATDRV)
  E610  21A5EC        		LD	HL,_DBDRV
  E613  AE            		XOR	(HL)
  E614  CCBDE5        		CALL	Z,DWTX
  E617  38A2          		JR	C,POP_HL_RET
  E619  C5            		PUSH	BC
  E61A  D5            		PUSH	DE
  E61B  DDE5          		PUSH	IX
  E61D  CD68E8        		CALL	WTFAT
  E620  AF            		XOR	A
  E621  32A2EC        		LD	(_WTFATF),A
  E624  18DD          		JR	POP_IX_DE_BC_HL_RET
                      	
  E626                	NCL1:
  E626  7A            		LD	A,D
  E627  B3            		OR	E
  E628  37            		SCF
  E629  C8            		RET	Z
                      	
  E62A  7A            		LD	A,D
  E62B  E608          		AND	8		;DE(targetCluster >= 0x800)
  E62D                	N16CL1X:
  E62D  E5            		PUSH	HL
  E62E  324DE6        		LD	(NCLPAT+2),A	;_FATIX
  E631  2AAAEC        		LD	HL,(_FATDRV)	;L=_FATDRV H=_FATIX
  E634  BC            		CP	H
  E635  3A88EC        		LD	A,(_DRV)	;この間でフラグは変化しない
  E638  324CE6        		LD	(NCLPAT+1),A	;_FATDRV
  E63B  2005          		JR	NZ,NCL2		;FATIXが違う
  E63D  BD            		CP	L
  E63E  2002          		JR	NZ,NCL2		;ドライブが違う
  E640  E1            		POP	HL
  E641  C9            		RET
  E642                	NCL2:
  E642  C5            		PUSH	BC
  E643  D5            		PUSH	DE
  E644  DDE5          		PUSH	IX
  E646  CD07E6        		CALL	WTFATX
  E649  38B8          		JR	C,POP_IX_DE_BC_HL_RET
  E64B  010000        	NCLPAT:	LD	BC,0		;自己書き換え C=_FATDRV B=_FATIX
  E64E  ED43AAEC      		LD	(_FATDRV),BC
  E652  CD38E8        		CALL	RDFATS
  E655  18A6          		JR	RDFATE2
                      	
  E657                	NCL3:
  E657  CB9A          		RES	3,D
  E659  6B            		LD	L,E
  E65A  62            		LD	H,D
  E65B  CB3C          		SRL	H	;
  E65D  CB1D          		RR	L	;HLA=HLA/2
  E65F  1F            		RRA		;
  E660  ED4B7CEC      		LD	BC,(_FATBF)
  E664  19            		ADD	HL,DE
  E665  09            		ADD	HL,BC
  E666  17            		RLA
  E667  C9            		RET
                      	
  E668                	N16CL1:
  E668  7A            		LD	A,D
  E669  B3            		OR	E
  E66A  37            		SCF
  E66B  C8            		RET	Z
                      	
  E66C  7A            		LD	A,D
  E66D  CB3F          		SRL	A	;/2
  E66F  CB3F          		SRL	A	;/2
  E671  18BA          		JR	N16CL1X
                      	
  E673                	GNCL:
  E673  CD26E6        		CALL	NCL1		;GET NEXT CLUSTER
  E676  D8            		RET	C
  E677  C5            		PUSH	BC
  E678  E5            		PUSH	HL
  E679  CD57E6        		CALL	NCL3
  E67C  3809          		JR	C,GNC1
  E67E  5E            		LD	E,(HL)
  E67F  23            		INC	HL
  E680  7E            		LD	A,(HL)
  E681  E60F          		AND	00FH
  E683  57            		LD	D,A
  E684  E1            		POP	HL
  E685  C1            		POP	BC
  E686  C9            		RET
  E687                	GNC1:
  E687  7E            		LD	A,(HL)
  E688  23            		INC	HL
  E689  56            		LD	D,(HL)
  E68A  0604          		LD	B,4
  E68C                	GNC1L:
  E68C  CB3A          		SRL	D	;DA=DA/2
  E68E  1F            		RRA		;
  E68F  10FB          		DJNZ	GNC1L
                      	
  E691  5F            		LD	E,A
  E692  E1            		POP	HL
  E693  C1            		POP	BC
  E694  A7            		AND	A
  E695  C9            		RET
                      	
  E696                	SNCL:
  E696  CD26E6        		CALL	NCL1
  E699  D8            		RET	C
                      	;				SET NEXT CLUSTER
  E69A  E5            		PUSH	HL
  E69B  C5            		PUSH	BC
  E69C  D5            		PUSH	DE
  E69D  E5            		PUSH	HL
  E69E  CD57E6        		CALL	NCL3
  E6A1  D1            		POP	DE
                      	;CF=ODD
  E6A2  7E            		LD	A,(HL)
  E6A3  73            		LD	(HL),E
  E6A4  3806          		JR	C,SNC1
                      	;EVEN
                      	;M[0] = E
                      	;M[1] = (M[1] & 0xF0) | (D & 0x0F)
  E6A6  23            		INC	HL
  E6A7  ED67          		RRD		;M={A[3:0],E[3:0]}
  E6A9  7A            		LD	A,D
  E6AA  1804          		JR	SNC11
  E6AC                	SNC1:
                      	;ODD
                      	;HL[0] = (HL[0]&0x0F) | (E<<4)
                      	;HL[1] = DE>>4
  E6AC  ED6F          		RLD		;M={D[3:0],E[7:4]}
  E6AE  23            		INC	HL
  E6AF  72            		LD	(HL),D	;M={D[3:0],E[7:4]}
  E6B0                	SNC11:
  E6B0  ED6F          		RLD		;M={M[7:4],D[3:0]}
  E6B2  B7            		OR	A
  E6B3  D1            		POP	DE
  E6B4  C1            		POP	BC
  E6B5  E1            		POP	HL
  E6B6                	FAT_CHANGED:
  E6B6  3E01          		LD	A,1
  E6B8  32A2EC        		LD	(_WTFATF),A
  E6BB  C9            		RET
                      	
  E6BC                	N16CL3:
  E6BC  C5            		PUSH	BC
  E6BD  6B            		LD	L,E
  E6BE  7A            		LD	A,D
  E6BF  E603          		AND	3
  E6C1  67            		LD	H,A
  E6C2  29            		ADD	HL,HL
  E6C3  ED4B7CEC      		LD	BC,(_FATBF)
  E6C7  09            		ADD	HL,BC
  E6C8  C1            		POP	BC
  E6C9  C9            		RET
                      	
  E6CA                	GNCL16:
  E6CA  CD68E6        		CALL	N16CL1		;GET NEXT CLUSTER for FAT16
  E6CD  D8            		RET	C
  E6CE  E5            		PUSH	HL
  E6CF  CDBCE6        		CALL	N16CL3
  E6D2  5E            		LD	E,(HL)
  E6D3  23            		INC	HL
  E6D4  56            		LD	D,(HL)
  E6D5  E1            		POP	HL
  E6D6  C9            		RET
                      	
  E6D7                	SNCL16:
  E6D7  CD68E6        		CALL	N16CL1		;GET NEXT CLUSTER for FAT16
  E6DA  D8            		RET	C
  E6DB  D5            		PUSH	DE
  E6DC  E5            		PUSH	HL
  E6DD  CDBCE6        		CALL	N16CL3
  E6E0  D1            		POP	DE		;HL
  E6E1  73            		LD	(HL),E
  E6E2  23            		INC	HL
  E6E3  72            		LD	(HL),D
  E6E4  6B            		LD	L,E
  E6E5  62            		LD	H,D
  E6E6  D1            		POP	DE
  E6E7  18CD          		JR	FAT_CHANGED
                      	
                      	;------------------------
                      	;次のセクタを探す際に_SECPSの値をチェック
                      	;in
                      	;	DE : セクタ番号
                      	;out
                      	;	DE : 次のセクタ番号
                      	;note
                      	;
                      	;------------------------
  E6E9                	NEXTX:
  E6E9  3E00          	_SECPS:	LD	A,0
  E6EB  3C            		INC	A
  E6EC  E600          	NCPAT:	AND	0	;自己書き換え　1クラスタの論理セクタ数-1
  E6EE  32EAE6        		LD	(_SECPS+1),A
  E6F1  C9            		RET
                      	
  E6F2                	GNCLX:
  E6F2  CDE9E6        		CALL	NEXTX
  E6F5  C0            		RET	NZ	;1クラスタのセクタ未満の場合は戻る
  E6F6  C3F7EC        		JP	_GNCL	;次のクラスタを探す
                      	
  E6F9                	RDFAT:
  E6F9  3E80          		LD	A,080H
  E6FB  327FEB        		LD	(CHECK),A
  E6FE                	RDFAT1:
  E6FE  3A88EC        		LD	A,(_DRV)
  E701  CDB8E9        		CALL	CHGDRVR
  E704  D8            		RET	C
  E705  DD7E12        		LD	A,(IX+012H)	;DPB_12_DEVICE
  E708  CB6F          		BIT	5,A
  E70A  CA29E8        		JP	Z,RDFAT0X
  E70D  217FEB        		LD	HL,CHECK
  E710  A6            		AND	(HL)
  E711  77            		LD	(HL),A
  E712  110000        		LD	DE,0		;BPB
  E715  2A7CEC        		LD	HL,(_FATBF)
  E718  CD49E8        		CALL	DRD16
  E71B  3024          		JR	NC,GET_BPB
  E71D  217FEB        		LD	HL,CHECK
  E720  CB06          		RLC	(HL)
  E722  3F            		CCF
  E723  D8            		RET	C
  E724  DDCB0A1E      		RR	(IX+00AH)	;DPB_0A_FDMODE
  E728  3F            		CCF			;フロッピーディスクのMFMモードを切り替える
  E729  DDCB0A16      		RL	(IX+00AH)	;DPB_0A_FDMODE
  E72D  3EFF          		LD	A,0FFH
  E72F  3289EC        		LD	(_DSK),A
  E732  3A84EC        		LD	A,(_DRIVE)
  E735  E603          		AND	3
  E737  F680          		OR	080H
  E739  6F            		LD	L,A
  E73A  26EC          		LD	H,_CYL0/256
  E73C  3EFF          		LD	A,0FFH
  E73E  77            		LD	(HL),A
  E73F  18BD          		JR	RDFAT1
  E741                	GET_BPB:
  E741  FDE5          		PUSH	IY
  E743  FD2A7CEC      		LD	IY,(_FATBF)	;BPB
                      	
  E747  FD7E00        		LD	A,(IY+0)	;BS_JmpBoot
  E74A  FEEB          		CP	0EBH		;Short jump
  E74C  280C          		JR	Z,BPBOK
  E74E  FEE9          		CP	0E9H		;Near jump
  E750  2808          		JR	Z,BPBOK
  E752  FE60          		CP	060H		;X68k
  E754  2804          		JR	Z,BPBOK
  E756                	NOT_BPB
  E756  FDE1          		POP	IY
  E758  37            		SCF
  E759  C9            		RET
  E75A                	BPBOK:
  E75A  FD7E0D        		LD	A,(IY+13)	;BPB_SecPerClus
  E75D  DD7707        		LD	(IX+7),A	;DPB_07_SECPCL
                      	
  E760  FD7E10        		LD	A,(IY+16)	;BPB_NumFATs
  E763  FE02          		CP	2		;>2:NC
  E765  FD7E0C        		LD	A,(IY+12)	;BPB_BytsPerSec
  E768  3806          		JR	C,BPBFAT1
  E76A  FE05          		CP	5
  E76C  30E8          		JR	NC,NOT_BPB	;1セクタ1024以上は無効
  E76E  F680          		OR	080H
  E770                	BPBFAT1:
  E770  DD770F        		LD	(IX+00FH),A	;DPB_0F_BPS
                      	
  E773  FD7E16        		LD	A,(IY+22)	;BPB_FATSz16
  E776  DD7700        		LD	(IX+0),A	;DPB_00_FATLN
  E779  FD7E17        		LD	A,(IY+23)	;BPB_FATSz16
  E77C  DD7701        		LD	(IX+1),A	;DPB_00_FATLN
                      	
  E77F  FD6E0E        		LD	L,(IY+14)	;BPB_RsvdSecCnt
  E782  FD660F        		LD	H,(IY+15)
  E785  DD750E        		LD	(IX+00EH),L	;DPB_0E_FATPS
  E788  FD5E16        		LD	E,(IY+22)	;BPB_FATSz16
  E78B  FD5617        		LD	D,(IY+23)
  E78E  FD4610        		LD	B,(IY+16)	;BPB_NumFATs
  E791                	BPBDP1:				;BPB_FATSz16 * BPB_NumFATs
  E791  19            		ADD	HL,DE
  E792  10FD          		DJNZ	BPBDP1
  E794                	BPBDP2:
  E794  DD7510        		LD	(IX+010H),L	;DPB_10_DIRPS
  E797  DD7411        		LD	(IX+011H),H
  E79A  E5            		PUSH	HL
                      	
  E79B  FD6E11        		LD	L,(IY+17)	;BPB_RootEntCnt
  E79E  FD6612        		LD	H,(IY+18)
  E7A1  FD7E0C        		LD	A,(IY+12)	;BPB_BytsPerSec
  E7A4  0606          		LD	B,6
  E7A6                	BPBBPS1:
  E7A6  05            		DEC	B
  E7A7  0F            		RRCA
  E7A8  30FC          		JR	NC,BPBBPS1
  E7AA                	BPBDE1:
  E7AA  29            		ADD	HL,HL
  E7AB  10FD          		DJNZ	BPBDE1
                      	
  E7AD  7C            		LD	A,H
  E7AE  DD770B        		LD	(IX+00BH),A	;DPB_0B_DIRSCNT
                      	
  E7B1  D1            		POP	DE		;DPB_10_DIRPS
  E7B2  6C            		LD	L,H
  E7B3  2600          		LD	H,0
  E7B5  19            		ADD	HL,DE		;MAXDIR
  E7B6  E5            		PUSH	HL
  E7B7  FD4E0D        		LD	C,(IY+13)	;BPB_SecPerClus
  E7BA  CB21          		SLA	C		;*2
  E7BC  AF            		XOR	A
  E7BD  47            		LD	B,A
  E7BE  ED42          		SBC	HL,BC
  E7C0  DD7514        		LD	(IX+014H),L	;DPB_14_ADDCL16
  E7C3  DD7415        		LD	(IX+015H),H
                      	
  E7C6  D1            		POP	DE		;DE=DPB_0B_MAXDIR
  E7C7  FD6E13        		LD	L,(IY+19)	;BPB_TotSec16
  E7CA  FD6614        		LD	H,(IY+20)
  E7CD  7C            		LD	A,H
  E7CE  B5            		OR	L		;ここでCF=0
  E7CF  3E00          		LD	A,0		;LDでフラグは変化しない。BPB_TotSec16を AHL で扱う為、Aに0を入れる
  E7D1  2010          		JR	NZ,BPB16BIT
  E7D3  FD7E23        		LD	A,(IY+35)	;BPB_TotSec16が「0」の場合はBPB_TotSec32で計算
  E7D6  B7            		OR	A
  E7D7                	NOT_BPB1:
  E7D7  C256E7        		JP	NZ,NOT_BPB	;念のため(総セクタ数が24ビットを超える場合)
  E7DA  FD6E20        		LD	L,(IY+32)	;BPB_TotSec32 は AHL の24ビットで扱う
  E7DD  FD6621        		LD	H,(IY+33)	;1クラスタの論理セクタ数(DPB_07_SECPCL)が最大128なので
  E7E0  FD7E22        		LD	A,(IY+34)	;24ビットを超えると必ずクラスタ数が16ビットを超えてしまうのでこれで十分
  E7E3                	BPB16BIT:
  E7E3  ED52          		SBC	HL,DE		;CF=0のはず
  E7E5  DE00          		SBC	A,0
  E7E7  FD460D        		LD	B,(IY+13)	;BPB_SecPerClus
  E7EA                	BPBTC1:				;総クラスタ数(AHL) = 総セクタ数(AHL) / セクタサイズ(B)
  E7EA  CB18          		RR	B		;->CY
  E7EC  3808          		JR	C,BPBTC2
  E7EE  CB3F          		SRL	A
  E7F0  CB1C          		RR	H		;AHL=AHL/2
  E7F2  CB1D          		RR	L
  E7F4  18F4          		JR	BPBTC1
  E7F6                	BPBTC2:
  E7F6  B7            		OR	A
  E7F7  20DE          		JR	NZ,NOT_BPB1	;念のため(クラスタ数が16ビットを超える場合)
  E7F9  23            		INC	HL
  E7FA  23            		INC	HL
  E7FB  DD7508        		LD	(IX+8),L	;DPB_08_MAXCL
  E7FE  DD7409        		LD	(IX+9),H
                      	
  E801  FD7E15        		LD	A,(IY+21)	;BPB_Media
  E804  DD7706        		LD	(IX+6),A	;DPB_06_FATID
                      	
  E807  DDCB0A7E      		BIT	7,(IX+00AH)	;DPB_0A_FDMODE
  E80B  2817          		JR	Z,NOT_FD
  E80D  2E28          		LD	L,40		;MAXCYLの設定（要検討）ここから下はフロッピーのみ書き換える
  E80F  FEFD          		CP	0FDH	;2D
  E811  2808          		JR	Z,SETCYL
  E813  2E4D          		LD	L,77
  E815  FEFE          		CP	0FEH	;2HD
  E817  2802          		JR	Z,SETCYL
  E819  2E50          		LD	L,80	;その他2DD等
  E81B                	SETCYL:
  E81B  DD750C        		LD	(IX+00CH),L	;DPB_0C_MAXCYL
  E81E  FD7E18        		LD	A,(IY+24)	;BPB_SecPerTr
  E821  DD770D        		LD	(IX+00DH),A	;DPB_0D_MAXSEC
  E824                	NOT_FD:
  E824  FDE1          		POP	IY
  E826  CD05E9        		CALL	CHGDRV2
  E829                	RDFAT0X:
  E829  CD38E8        		CALL	RDFATS
  E82C  D8            		RET	C
  E82D  DDBE06        		CP	(IX+6)		;DPB_06_FATID
  E830  C8            		RET	Z
  E831  DDCB126E      		BIT	5,(IX+012H)	;DPB_12_DEVICE
  E835  C0            		RET	NZ		;BPBを取得している場合はFATIDをチェックしない
  E836  37            		SCF
  E837  C9            		RET
                      	
  E838                	RDFATS:
  E838  CD8AE8        		CALL	FATSETUP
  E83B  D8            		RET	C
  E83C                	RDFATL:
  E83C  C5            		PUSH	BC
  E83D  CD49E8        		CALL	DRD16
  E840  C1            		POP	BC
  E841  D8            		RET	C
  E842  10F8          		DJNZ	RDFATL
  E844  2A7CEC        		LD	HL,(_FATBF)
  E847  7E            		LD	A,(HL)
  E848  C9            		RET
                      	
  E849                	DRD16:
  E849  0E00          		LD	C,0
  E84B                	DRD24:
  E84B  0601          		LD	B,1
  E84D  DDE5          		PUSH	IX
  E84F  DD2AA8EC      		LD	IX,(_DPB)
  E853  CDD0EA        	DRDPAT:	CALL	FDRD		;自己書き換え（ディスク読み込み）
  E856                	POP_IX_RET:
  E856  DDE1          		POP	IX
  E858  C9            		RET
                      	
  E859                	DWT16:
  E859  0E00          		LD	C,0
  E85B                	DWT24:
  E85B  0601          		LD	B,1
  E85D  DDE5          		PUSH	IX
  E85F  DD2AA8EC      		LD	IX,(_DPB)
  E863  CDC7EA        	DWTPAT:	CALL	FDWT		;自己書き換え（ディスク書き込み）
  E866  18EE          		JR	POP_IX_RET
                      	
  E868                	WTFAT:
  E868  CD8AE8        		CALL	FATSETUP
  E86B  D481E8        		CALL	NC,WTFATL
  E86E  D8            		RET	C
  E86F  DDCB0F7E      		BIT	7,(IX+00FH)	;DPB_0F_BPS
  E873  C8            		RET	Z		;予備FATが無い
  E874  CD91E8        		CALL	FATS2
  E877  E5            		PUSH	HL		;予備FAT
  E878  DD6E00        		LD	L,(IX+0)	;DPB_00_FATLN
  E87B  DD6601        		LD	H,(IX+1)
  E87E  19            		ADD	HL,DE
  E87F  EB            		EX	DE,HL
  E880  E1            		POP	HL
  E881                	WTFATL:
  E881  C5            		PUSH	BC
  E882  CD59E8        		CALL	DWT16
  E885  C1            		POP	BC
  E886  D8            		RET	C
  E887  10F8          		DJNZ	WTFATL
  E889  C9            		RET
                      	;------------------------
                      	;FATのセットアップ
                      	;out
                      	;	B  : FATセクタ数
                      	;	DE : FAT先頭セクタ番号
                      	;	HL : FATバッファポインタ
                      	;	CF : 1=ドライブ切り替えエラー
                      	;note
                      	;	FATサイズがFATバッファを超える場合は
                      	;	対象クラスタ領域==(_FATIX)によって
                      	;	FAT12:FATの前半3KBと後半3KBを切り替える
                      	;	FAT16:対象クラスタ1024毎に2KBを切り替える
                      	;------------------------
  E88A                	FATSETUP:
  E88A  3AAAEC        		LD	A,(_FATDRV)
  E88D  CDB8E9        		CALL	CHGDRVR		;ドライブ切り替え
  E890  D8            		RET	C
  E891                	FATS2:
  E891  ED5BFAEB      		LD	DE,(_FATPS)	;fat sector pos
  E895  C398E8        	FATSX:	JP	FATSETUP12	;自己書き換え
                      	
  E898                	FATSETUP12:
  E898  2A7CEC        		LD	HL,(_FATBF)
  E89B  3E18          		LD	A,24		;3072 / 256 FATバッファに読み込めるセクタ数
  E89D  DD460F        		LD	B,(IX+00FH)	;DPB_0F_BPS
  E8A0                	L_FATS2:
  E8A0  1F            		RRA			;CF=0 なので A=A/2
  E8A1  CB18          		RR	B		;->CF
  E8A3  30FB          		JR	NC,L_FATS2
                      	
  E8A5  DD4600        		LD	B,(IX+0)	;DPB_00_FATLN
  E8A8  B8            		CP	B
  E8A9  D0            		RET	NC		;DPB_00_FATLN x sectorSize < fatBufSize
                      	;targetCluster
  E8AA  4F            		LD	C,A		;C = skipCount
  E8AB  3AABEC        		LD	A,(_FATIX)	;(targetCluster >= 0x800)
  E8AE  B7            		OR	A
  E8AF  2806          		JR	Z,FATS3
                      	;(targerCluster>=0x800)
  E8B1                	FAT_SKP:
  E8B1  13            		INC	DE		;FATPS++
  E8B2  05            		DEC	B		;FATSIZE--
  E8B3  0D            		DEC	C		;skipCnt--
  E8B4  20FB          		JR	NZ,FAT_SKP
  E8B6  48            		LD	C,B
  E8B7                	FATS3:
  E8B7  41            		LD	B,C		;3 or 6 or 12
  E8B8  AF            		XOR	A
  E8B9  C9            		RET
                      	
  E8BA                	FATSETUP16:
  E8BA  DD7E0F        		LD	A,(IX+00FH)	;DPB_0F_BPS 512=2 1024=4
  E8BD  0610          		LD	B,16		;2048 / 256 FATバッファに読み込むセクタ数 512=4/1024=2
  E8BF  67            		LD	H,A		;DPB_0F_BPS
  E8C0                	L_F16S2:
  E8C0  CB38          		SRL	B		;/2
  E8C2  1F            		RRA			;->CF
  E8C3  30FB          		JR	NC,L_F16S2
                      	
  E8C5  7C            		LD	A,H		;DPB_0F_BPS
  E8C6  2AABEC        		LD	HL,(_FATIX)	;範囲は0-63(0-03FH):65535*2/2048
  E8C9  2600          		LD	H,0
  E8CB  4D            		LD	C,L		;_FATIX
  E8CC                	L_F16S3:
  E8CC  29            		ADD	HL,HL
  E8CD  87            		ADD	A,A
  E8CE  CB5F          		BIT	3,A
  E8D0  28FA          		JR	Z,L_F16S3
                      	
  E8D2  19            		ADD	HL,DE
  E8D3  EB            		EX	DE,HL
                      	
  E8D4  79            		LD	A,C		;_FATIX
  E8D5  DD6E00        		LD	L,(IX+0)	;DPB_00_FATLN
  E8D8  2D            		DEC	L		;DPB_00_FATLN-1
  E8D9  AD            		XOR	L		;Lと同じか比較してCFを0に
  E8DA  2005          		JR	NZ,F16E		;FATバッファが最後の場合はFATセクタ数を調整
  E8DC  7D            		LD	A,L		;DPB_00_FATLN-1
  E8DD  05            		DEC	B
  E8DE  A0            		AND	B
  E8DF  47            		LD	B,A
  E8E0  04            		INC	B
  E8E1                	F16E:
  E8E1  2A7CEC        		LD	HL,(_FATBF)
  E8E4  C9            		RET
                      	
  E8E5                	CHGDRV:
  E8E5  E5            		PUSH	HL
  E8E6  2189EC        		LD	HL,_DSK
  E8E9  BE            		CP	(HL)
  E8EA  280A          		JR	Z,CHGDRVE
  E8EC                	CHGDRV1:
  E8EC  DDE5          		PUSH	IX
  E8EE  CDF8E8        		CALL	CHGDRV0
  E8F1  3A89EC        		LD	A,(_DSK)
  E8F4  DDE1          		POP	IX
  E8F6                	CHGDRVE:
  E8F6  E1            		POP	HL
  E8F7  C9            		RET
                      	
  E8F8                	CHGDRV0:
  E8F8  6F            		LD	L,A
  E8F9  CDDCEC        		CALL	_GETDPB
  E8FC  D8            		RET	C
  E8FD  DD22A8EC      		LD	(_DPB),IX
  E901  7D            		LD	A,L
  E902  3289EC        		LD	(_DSK),A
  E905                	CHGDRV2:
  E905  F3            		DI
  E906  C5            		PUSH	BC
  E907  D5            		PUSH	DE
  E908  ED736DE9      		LD	(SPPAT2+1),SP
                      	
  E90C  DDF9          		LD	SP,IX
                      	
  E90E  E1            		POP	HL		;DPB_00_FATLN
  E90F  E1            		POP	HL		;DPB_02_DRD
  E910  2254E8        		LD	(DRDPAT+1),HL
                      	
  E913  E1            		POP	HL
  E914  2264E8        		LD	(DWTPAT+1),HL	;DPB_04_DWT
                      	
  E917  E1            		POP	HL		;L=DPB_06_FATID H=DPB_07_SECPCL
  E918  7C            		LD	A,H
  E919  329BDF        		LD	(SPCPAT+1),A	;1クラスタの論理セクタ数
  E91C  3D            		DEC	A
  E91D  32EDE6        		LD	(NCPAT+1),A
                      	
  E920  E1            		POP	HL		;DPB_08_MAXCL
  E921  7D            		LD	A,L
  E922  32BADF        		LD	(CLPAT2+1),A
  E925  7C            		LD	A,H
  E926  32B6DF        		LD	(CLPAT1+1),A
  E929  2B            		DEC	HL
  E92A  22BAE1        		LD	(MAXCLP+1),HL
                      	
  E92D  E1            		POP	HL		;L=DPB_0A_FDMODE H=DPB_0B_DIRSCNT
  E92E  7D            		LD	A,L
  E92F  F6FE          		OR	0FEH
  E931  3272EA        		LD	(FDMODE+1),A
  E934  07            		RLCA
  E935  E603          		AND	3
  E937  325AEA        		LD	(FSPAT+1),A
  E93A  4C            		LD	C,H
                      	
  E93B  E1            		POP	HL		;L=DPB_0C_MAXCYL H=DPB_0D_MAXSEC
  E93C  7D            		LD	A,L
  E93D  32A1EC        		LD	(_MAXCYL),A
  E940  7C            		LD	A,H
  E941  3203EA        		LD	(MAXSEC+1),A
                      	
  E944  E1            		POP	HL		;L=DPB_0E_FATPS H=DPB_0F_BPS
  E945  7C            		LD	A,H		;DPB_0F_BPS
  E946  E607          		AND	7
  E948  32FAE4        		LD	(SECSZ+2),A	;1セクタのサイズの上位1バイト 0x400 - 0x200 - 0x100
  E94B  3D            		DEC	A		;1セクタ512 2D/2DD/2HC/2HQ(2HD1.44MB)等
                      					;1セクタ1024 2HD/EMM/BRAM
                      					;1セクタ256 GRAM等
                      					;1024	512	256
  E94C  32B4DE        		LD	(SECSZM1+2),A	;3	1	0	1セクタのサイズ-1したものの上位1バイト (0x3FF - 0x1FF - 0xFF)
  E94F  3C            		INC	A		;4	2	1
  E950  87            		ADD	A,A		;8	4	2
  E951  87            		ADD	A,A		;010H	8	4
  E952  87            		ADD	A,A		;020H	010H	8
  E953  3209DE        		LD	(SDECPAT+1),A	;1セクタ辺りのディレクトリエントリ数
  E956  3D            		DEC	A		;01FH	00FH	7
  E957  3272D4        		LD	(SDECM1+1),A	;1セクタ辺りのディレクトリエントリ数-1
                      	
  E95A  2600          		LD	H,0
  E95C  22FAEB        		LD	(_FATPS),HL
                      	
  E95F  E1            		POP	HL		;L=DPB_10_DIRPS
  E960  22FCEB        		LD	(_DIRPS),HL
                      	
  E963  E1            		POP	HL		;L=DPB_12_DEVICE H=DPB_13_UNITNO
  E964  7C            		LD	A,H
  E965  3284EC        		LD	(_DRIVE),A
                      	
  E968  E1            		POP	HL		;DPB_14_ADDCL16
  E969  22ABDF        		LD	(CLSPAT+1),HL
                      	
  E96C  310000        	SPPAT2:	LD	SP,0		;元のSPを復元
  E96F  FB            		EI
  E970  2AFCEB        		LD	HL,(_DIRPS)
  E973  0600          		LD	B,0
  E975  09            		ADD	HL,BC
  E976  2224DE        		LD	(MD_PAT+1),HL
                      	
  E979  2ABAE1        		LD	HL,(MAXCLP+1);
  E97C  11F60F        		LD	DE,4086
  E97F  B7            		OR	A
  E980  ED52          		SBC	HL,DE
  E982  300F          		JR	NC,SETFAT16
  E984  2173E6        		LD	HL,GNCL		;FAT12
  E987  1196E6        		LD	DE,SNCL
  E98A  0198E8        		LD	BC,FATSETUP12
  E98D  DDCB0FAE      		RES	5,(IX+00FH)	;DPB_0F_BPS(FAT12)
  E991  180D          		JR	EXTRA1
  E993                	SETFAT16:
  E993  21CAE6        		LD	HL,GNCL16	;FAT16
  E996  11D7E6        		LD	DE,SNCL16
  E999  01BAE8        		LD	BC,FATSETUP16
  E99C  DDCB0FEE      		SET	5,(IX+00FH)	;DPB_0F_BPS(FAT16)
  E9A0                	EXTRA1:
  E9A0  22F8EC        		LD	(GNCPAT+1),HL
  E9A3  ED53FBEC      		LD	(SNCPAT+1),DE
  E9A7  ED4396E8      		LD	(FATSX+1),BC
  E9AB  D1            		POP	DE
  E9AC  C1            		POP	BC
  E9AD  AF            		XOR	A
  E9AE  C9            		RET
                      	
  E9AF                	GETDPBD:
  E9AF  DDE3          		EX	(SP),IX
  E9B1  DDE5          		PUSH	IX
  E9B3  3A88EC        		LD	A,(_DRV)
  E9B6  1807          		JR	GETDPB1
                      	
  E9B8                	CHGDRVR:
  E9B8  CDD9EC        		CALL	_CHGDRV
  E9BB  D8            		RET	C
  E9BC  3A89EC        		LD	A,(_DSK)
  E9BF                	GETDPB1:
  E9BF  C3DCEC        		JP	_GETDPB
                      	
  E9C2                	GETDPB:
  E9C2  FE08          		CP	8
  E9C4  3F            		CCF
  E9C5  D8            		RET	C
  E9C6  0F            		RRCA
  E9C7  0F            		RRCA
  E9C8  0F            		RRCA
  E9C9  DD            		DB	0DDH		;Z80未定義命令
  E9CA  6F            		LD	L,A		;LD	IXL,A
  E9CB  DD            		DB	0DDH		;Z80未定義命令
  E9CC  26ED          		LD	H,DEVICE/256	;LD	IXH,DEVICE/256
  E9CE  DD7E00        		LD	A,(IX+0)	;DPB_00_FATLN
  E9D1  B7            		OR	A		;CF=0の為
  E9D2  DDCB0F76      		BIT	6,(IX+00FH)	;DPB_0F_BPS
  E9D6  C0            		RET	NZ		;FAT16
  E9D7  DDCB126E      		BIT	5,(IX+012H)	;DPB_12_DEVICE
  E9DB  C0            		RET	NZ		;BPB
  E9DC  FE01          		CP	001H		;A=0 THEN CF=1
  E9DE  C9            		RET
                      	
  E9DF                	FFLUSH:
  E9DF  F5            		PUSH	AF
  E9E0  3EFF          		LD	A,0FFH
  E9E2  3286E2        		LD	(SFILE),A
  E9E5  CDBDE5        		CALL	DWTX
  E9E8  3EFF          		LD	A,0FFH
  E9EA  32A5EC        		LD	(_DBDRV),A
  E9ED  CD07E6        		CALL	WTFATX
  E9F0  AF            		XOR	A
  E9F1  32ABEC        		LD	(_FATIX),A
  E9F4  2F            		CPL
  E9F5  32AAEC        		LD	(_FATDRV),A
  E9F8  F1            		POP	AF
  E9F9  C9            		RET
                      	
                      	
                      	;LDDISK.ASM
                      	
                      	;	LSX-Dodgers DISK
                      	
                      	
  E9FA                	SEEK:
  E9FA  7A            		LD	A,D
  E9FB  B3            		OR	E
  E9FC  3E01          		LD	A,001H
  E9FE  2811          		JR	Z,DIV3
                      	
  EA00  0610          		LD	B,16
  EA02  0E00          	MAXSEC:	LD	C,000H
  EA04  AF            		XOR	A
  EA05  EB            		EX	DE,HL
  EA06                	DIV1:
  EA06  29            		ADD	HL,HL
  EA07  8F            		ADC	A,A
  EA08  B9            		CP	C
  EA09  3802          		JR	C,DIV2
  EA0B  91            		SUB	C
  EA0C  2C            		INC	L
  EA0D                	DIV2:
  EA0D  10F7          		DJNZ	DIV1
                      	
  EA0F  3C            		INC	A	;最小のセクタは１固定
  EA10  55            		LD	D,L	;Quotient(TRACK)
  EA11                	DIV3:
  EA11  5F            		LD	E,A	;Remainder
  EA12  CB3A          		SRL	D	;CYLINDER
  EA14  9F            		SBC	A,A
  EA15  E610          		AND	010H	;SIDE
  EA17  4F            		LD	C,A
                      	
  EA18  3A84EC        		LD	A,(_DRIVE)
  EA1B  FE04          		CP	4
  EA1D  3F            		CCF
  EA1E  D8            		RET	C
  EA1F  B1            		OR	C
  EA20  329EEA        		LD	(MOPAT+1),A	;Motor off data
  EA23  01FC0F        		LD	BC,00FFCH
  EA26  F680          		OR	080H		;Mortor on
  EA28  ED79          		OUT	(C),A
                      	
  EA2A  CD70EA        		CALL	SETMODE
  EA2D  D8            		RET	C
                      	
  EA2E  CDB3EA        		CALL	DRIVE
  EA31  FEFF          		CP	0FFH		;A=0FFH Unknown CYLINDER
  EA33  CC92EA        		CALL	Z,FDCRES	;Restore
  EA36  0EF9          		LD	C,0F9H
  EA38  ED79          		OUT	(C),A		;Currrent CYLINDER
  EA3A  92            		SUB	D
  EA3B  C8            		RET	Z		;No seek
                      	
  EA3C  3A86EC        		LD	A,(_ISEEK)
  EA3F  4F            		LD	C,A
                      	
  EA40  3AA1EC        		LD	A,(_MAXCYL)	;Max CYLINDER
  EA43  3D            		DEC	A
  EA44  BA            		CP	D		;Over CYLINDER
  EA45  D8            		RET	C
                      	
  EA46  B9            		CP	C		;for Built-in 2DD
  EA47  3803          		JR	C,SETM2
  EA49  78            		LD	A,B		;B=00FH
  EA4A  DBFE          		IN	A,(0FEH)		;2HD mode for 2DD seek
  EA4C                	SETM2:
  EA4C  78            		LD	A,B
  EA4D  DBFD          		IN	A,(0FDH)		;MFM mode
                      	
  EA4F  0EFB          		LD	C,0FBH
  EA51  ED51          		OUT	(C),D
  EA53  72            		LD	(HL),D
  EA54  0E18          		LD	C,018H		;Seek
  EA56                	FDCCMD2:
  EA56  3A85EC        		LD	A,(_SEEKSP)
  EA59  E6FF          	FSPAT:	AND	0FFH
  EA5B  B1            		OR	C
                      	
  EA5C                	FDCCMD:
  EA5C  CDA9EA        		CALL	COMSET
                      	
  EA5F  3E80          	FDCPAT:	LD	A,080H		;FDC COMMAND(Self-rewriting)
  EA61  E620          		AND	020H		;Write data Write track
  EA63  3C            		INC	A
                      	
  EA64                	SST:
  EA64  0E00          		LD	C,0
  EA66                	SST1:
  EA66  0D            		DEC	C		; 4
  EA67  20FD          		JR	NZ,SST1		;12 * 256 / 4 = About 1ms
  EA69  3D            		DEC	A
  EA6A  20FA          		JR	NZ,SST1
                      	
  EA6C  3C            		INC	A		;A=1
  EA6D  CD7BEA        		CALL	READY
  EA70                	SETMODE:
  EA70  78            		LD	A,B		;B=00FH
  EA71  DBFF          	FDMODE:	IN	A,(0FFH)		;Floppy mode(2D/2HD) (Self-rewriting)
                      	
  EA73  78            		LD	A,B
  EA74  DBFD          		IN	A,(0FDH)		;MFM mode
                      	
  EA76  CDADEA        		CALL	DELAY0		;Head select time
  EA79  3E81          		LD	A,081H
  EA7B                	READY:
  EA7B  3285EA        		LD	(WAITA+1),A
  EA7E  E5            		PUSH	HL
  EA7F  0EF8          		LD	C,0F8H
  EA81  61            		LD	H,C
  EA82                	READY2:
  EA82  ED78          		IN	A,(C)
  EA84  E681          	WAITA:	AND	081H		;NOT READY,BUSY
  EA86  2808          		JR	Z,READYE
  EA88  E3            		EX	(SP),HL		;wait 19clock
  EA89  E3            		EX	(SP),HL		; //
  EA8A  2B            		DEC	HL
  EA8B  7C            		LD	A,H
  EA8C  B5            		OR	L
  EA8D  20F3          		JR	NZ,READY2
  EA8F  37            		SCF
  EA90                	READYE:
  EA90  E1            		POP	HL
  EA91  C9            		RET
                      	
  EA92                	FDCRES:
  EA92  3600          		LD	(HL),0
  EA94  0E08          		LD	C,8
  EA96  18BE          		JR	FDCCMD2
                      	
  EA98                	FDMOFF:
  EA98  F5            		PUSH	AF
  EA99  C5            		PUSH	BC
  EA9A  01FC0F        		LD	BC,00FFCH	;Motor off
  EA9D  3E00          	MOPAT:	LD	A,000H		;(Self-rewriting)
  EA9F  ED79          		OUT	(C),A
  EAA1  C1            		POP	BC
  EAA2  F1            		POP	AF
  EAA3  C9            		RET
                      	
  EAA4                	SECSET:
  EAA4  01FA0F        		LD	BC,00FFAH
  EAA7  ED59          		OUT	(C),E
  EAA9                	COMSET:
  EAA9  0EF8          		LD	C,0F8H
  EAAB  ED79          		OUT	(C),A
  EAAD                	DELAY0:
  EAAD  3E1A          		LD	A,26
  EAAF                	DELAY:
  EAAF  3D            		DEC	A
  EAB0  20FD          		JR	NZ,DELAY
  EAB2  C9            		RET
                      	
  EAB3                	DRIVE:
  EAB3  2A84EC        		LD	HL,(_DRIVE)
  EAB6  26EC          		LD	H,_CYL0/256
  EAB8  CBFD          		SET	7,L
  EABA  7E            		LD	A,(HL)
  EABB  C9            		RET
                      	
  EABC                	RNF:
  EABC  CDB3EA        		CALL	DRIVE
  EABF  36FF          		LD	(HL),0FFH
  EAC1  C9            		RET
                      	
  EAC2  02            	RETRY:	DB	2
                      	
                      	
                      	;	FLOPPY DISK DRIVER(DMA)
                      	
                      	
  EAC3                	WTTRK:
  EAC3  3EF4          		LD	A,0F4H
  EAC5  1802          		JR	WTTRK1
  EAC7                	FDWT:
  EAC7  3EA0          		LD	A,0A0H
  EAC9                	WTTRK1:
  EAC9  3260EA        		LD	(FDCPAT+1),A
  EACC  3E10          		LD	A,16
  EACE  1807          		JR	DISK
                      	
  EAD0                	FDRD:
  EAD0  3E80          		LD	A,080H
  EAD2  3260EA        		LD	(FDCPAT+1),A
  EAD5  3E0E          		LD	A,14
                      	
  EAD7                	DISK:
  EAD7  32EAEA        		LD	(DMAPAT+1),A
                      	
  EADA  226BEB        		LD	(DMAD+11),HL
  EADD                	DISKR:
  EADD  3E02          		LD	A,2		;Retry count
  EADF  32C2EA        		LD	(RETRY),A
  EAE2                	DISK2:
  EAE2  D5            		PUSH	DE
  EAE3  CDFAE9        		CALL	SEEK
  EAE6  3842          		JR	C,ERRF
  EAE8  F3            		DI
                      	
  EAE9  3E0E          	DMAPAT:	LD	A,14		;自己書き換え
  EAEB  2160EB        		LD	HL,DMAD
  EAEE  CD73DB        		CALL	SETDMA
  EAF1  ED49          		OUT	(C),C		;OUT 01F87H,087H WR6 イネーブル
  EAF3  3A60EA        		LD	A,(FDCPAT+1)
  EAF6  C5            		PUSH	BC
  EAF7  CDA4EA        		CALL	SECSET
  EAFA  2A6BEB        		LD	HL,(DMAD+11)
  EAFD  23            		INC	HL
  EAFE  1106BB        		LD	DE,0BB06H	;READ DMA
                      	
  EB01  3E03          		LD	A,3
  EB03  CD7BEA        		CALL	READY
  EB06  ED78          		IN	A,(C)
                      	
  EB08  C1            		POP	BC
  EB09  ED51          		OUT	(C),D		;読み出しマスク設定
  EB0B  ED59          		OUT	(C),E		;バイトカウンタ(LH)
  EB0D  ED58          		IN	E,(C)
  EB0F  ED50          		IN	D,(C)
  EB11  19            		ADD	HL,DE
  EB12  D1            		POP	DE
  EB13  13            		INC	DE
  EB14  FB            		EI
  EB15  CD98EA        		CALL	FDMOFF
  EB18  B7            		OR	A
  EB19  C8            		RET	Z
  EB1A  1B            		DEC	DE
  EB1B  CB67          		BIT	4,A
  EB1D  C4BCEA        		CALL	NZ,RNF
  EB20                	DISKE2:
  EB20  21C2EA        		LD	HL,RETRY
  EB23  35            		DEC	(HL)
  EB24  20BC          		JR	NZ,DISK2
  EB26  B7            		OR	A
  EB27  2834          		JR	Z,ERR
  EB29  D5            		PUSH	DE
  EB2A                	ERRF:
  EB2A  D1            		POP	DE
  EB2B                	DELP:
  EB2B  CDBCEA        		CALL	RNF
  EB2E  CD98EA        		CALL	FDMOFF
  EB31  3A85EC        		LD	A,(_SEEKSP)
  EB34  87            		ADD	A,A
  EB35  9F            		SBC	A,A
  EB36  3825          		JR	C,ERR
  EB38                	DELP1:
  EB38  D5            		PUSH	DE
  EB39  21C0EB        		LD	HL,DEMES
  EB3C  CD6BD8        		CALL	MSX
  EB3F  CD56D7        		CALL	KEYBC
  EB42                	DELP2:
  EB42  CDCAEC        		CALL	_INKEY
  EB45  28FB          		JR	Z,DELP2
                      	
  EB47  D1            		POP	DE
  EB48  CDBCDF        		CALL	CAP
  EB4B  FE52          		CP	'R'		;Retry
  EB4D  CADDEA        		JP	Z,DISKR
  EB50  FE49          		CP	'I'		;Ignore
  EB52  2807          		JR	Z,IGNORE
  EB54  FE41          		CP	'A'		;Abort
  EB56  20E0          		JR	NZ,DELP1
  EB58  C36FD3        		JP	BOOT
  EB5B                	IGNORE:
  EB5B  3EFF          		LD	A,0FFH
  EB5D                	ERR:
  EB5D  BF            		CP	A
  EB5E  37            		SCF
  EB5F  C9            		RET
                      	
                      				;X1turbo DISK DMA
  EB60  C3            	DMAD:	DB	0C3H	;WR6 リセット
  EB61  7D            		DB	07DH	;WR0 ポートA→ポートB 転送
  EB62  FB0F          		DW	00FFBH	;ポートA開始アドレス FDC データレジスタ
  EB64  FFFF          		DW	0FFFFH	;ブロック長(転送サイズ-1)
  EB66  2C            		DB	02CH	;WR1 ポートAアドレス固定 I/O
  EB67  10            		DB	010H	;WR2 ポートBインクリメント
  EB68  80            		DB	080H	;WR3
  EB69  92            		DB	092H	;WR5 WAIT RDY:LOW
  EB6A  8D            		DB	08DH	;WR4 バイト ポートB開始アドレス(LH)
  EB6B  0000          		DW	0	;ポートB開始アドレス
  EB6D  CF            		DB	0CFH	;WR6 ロード
  EB6E  01            		DB	001H	;WR0 ポートB←ポートB 転送
  EB6F  CF            		DB	0CFH	;WR6 ロード
                      	
  EB70                	DMAE:
                      	
  2010                	AT_R	EQU	WTTRK-AT_WTTRK
                      	
                      	;LDCALL.ASM
                      	
                      	;	LSX-Dodgers TABLES
                      	
  EB70  008E01000B000C	BEEPD:	DB	0,08EH,1,0,00BH,0,00CH,010H
  EB78  073E08100D00FF		DB	007H,03EH,008H,010H,00DH,0,0FFH
                      	
  EB7F  00            	CHECK:	DB	0
                      	
                      	;	CTRLTB:アドレス下位1バイトが080Hになるように
                      	
  EB80                	CTRLTB:
  EB80  9AD935DAD2D925		DW	PRINTE,CTRL01,CTRL02,CTRL03
  EB88  1FDBFDD9FEDA85		DW	CTRL04,CTRL05,CTRL1A,CTRL07
  EB90  A6D9C3D928DB3B		DW	CTRL08,CTRL09,CTRL0A,CTRL0B
  EB98  FBDA21DA3DDB9A		DW	CTRL0C,CTRL0D,CTRL0E,PRINTE
  EBA0  9AD99AD935DA9A		DW	PRINTE,PRINTE,CTRL01,PRINTE
  EBA8  9AD99AD99AD99A		DW	PRINTE,PRINTE,PRINTE,PRINTE
  EBB0  9AD99AD9FEDA48		DW	PRINTE,PRINTE,CTRL1A,CTRL1B
  EBB8  BDD9A6D9B0D928		DW	CTRL1C,CTRL1D,CTRL1E,CTRL1F
                      	
  EBC0  0307          	DEMES:	DB	3,7
  EBC2  44657669636520		DB	"Device I/O Error",5,3
  EBD4  41626F72742052		DB	"Abort Retry Ignore?",5,3,0
                      	
  EBEA  1617          	SDDATA:	DB	22,23		;(FCB)ファイルを最後に変更した時刻
  EBEC  1415          		DB	20,21		;(FCB)ファイルを最後に変更した日付
  EBEE  1A1B          		DB	26,27		;(FCB)ファイルの先頭クラスタ
  EBF0  10111213      		DB	16,17,18,19	;(FCB)ファイルのサイズ(バイト単位)
  EBF4                	SDDATAE:
                      	
  EBF4                	SCDIR:	DS	2		;+14 +15
  EBF6                	SFBPS:	DS	2		;FBPS
  EBF8                	SFNDF:	DS	2		;FILEN DIRF
                      	
  EBFA  0000          	_FATPS:	DW	0
  EBFC  0000          	_DIRPS:	DW	0
  EBFE  0000          	_CLPS:	DW	0
                      	
  EC00                	_PE:
                      	
                      	;	LSX-Dodgers SYSTEM CALL
                      	;	STABLE:アドレス下位1バイトが0になるように
                      	
  EC00                	STABLE:
                      	;0
  EC00  00008AD796D7B1		DW	 00000H,_SYS01,_SYS02,_SYS03
  EC08  AFD3AFD39BD778		DW	_SYS04,_SYS05,_SYS06,_SYS07
  EC10  A3D7B4D3DCD708		DW	_SYS08,_SYS09,_SYS0A,_SYS0B
  EC18  C3D3C9D3D8D3EB		DW	_SYS0C,_SYS0D,_SYS0E,_SYS0F
                      	;1
  EC20  40D492D4F8D42E		DW	_SYS10,_SYS11,_SYS12,_SYS13
  EC28  36D554D571D569		DW	_SYS14,_SYS15,_SYS16,_SYS17
  EC30  D2D5D7D5DCD5E2		DW	_SYS18,_SYS19,_SYS1A,_SYS1B
  EC38  AFD308D6AFD30C		DW	_SYS1C,_SYS1D,_SYS1E,_SYS1F
                      	;2
  EC40  AFD3A8D5BDD513		DW	_SYS20,_SYS21,_SYS22,_SYS23
  EC48  32D6AFD3E0E207		DW	_SYS24,_ERROR,_SYS26,_SYS27
  EC50  BDD53BD61ED8B1		DW	_SYS28,_SYS29,_SYS2A,_SYS2B
  EC58  52D8B1D3AFD35E		DW	_SYS2C,_SYS2D,_SYS2E,_SYS2F
                      	;3
  EC60  58D6          		DW	_SYS30
                      	
                      	;LDWORK.ASM
                      	
                      	;	LSX-Dodgers WORK
                      	
  0004                	DDS	EQU	4
  EC62                	DDTB:
  EC62  434F4E20      		DB	"CON "
  EC66  85D4          		DW	OPENDD
  EC68  41555820      		DB	"AUX "
  EC6C  85D4          		DW	OPENDD
  EC6E  50524E20      		DB	"PRN "
  EC72  85D4          		DW	OPENDD
  EC74  4E554C20      		DB	"NUL "
  EC78  85D4          		DW	OPENDD
                      	
  EC7A                		DS	2
  EC7C  00EE          	_FATBF:	DW	FATBF
  EC7E  00FA          	_DTBUF:	DW	DTBUF
                      	
                      	;	_CYL0:アドレス下位1バイトが080Hになるように
  EC80  FF            	_CYL0:	DB	0FFH	;Cylinder
  EC81  FF            	_CYL1:	DB	0FFH	;Cylinder
  EC82  FF            	_CYL2:	DB	0FFH	;Cylinder
  EC83  FF            	_CYL3:	DB	0FFH	;Cylinder
  EC84  00            	_DRIVE:	DB	0	;unit number
  EC85  00            	_SEEKSP:DB	0	;Seek speed
  EC86  FF            	_ISEEK:	DB	0FFH	;
  EC87  00            	_DVSW:	DB	0
  EC88  00            	_DRV:	DB	0
  EC89  FF            	_DSK:	DB	0FFH
  EC8A  8000          	_DTA:	DW	00080H
  EC8C  0000          	_CTC:	DW	0
  EC8E  0000          	_TXADR:	DW	0
  EC90  0000          	_KEYPS	DW	0
  EC92  00FF          	_KEYD	DW	0FF00H
  EC94  C210          	_KEYSP:	DW	010C2H
  EC96  07            	_COLORF:DB	7
  EC97  19            	_LINE:	DB	LINE
                      	
  EC98  0000          	_FCB:	DW	0
  EC9A  0000          	_FBPS:	DW	0	;SEARCH FILES
  EC9C  0000          	_FBAD:	DW	0	;    //
  EC9E  00            	_FBCNT:	DB	0	;    //
  EC9F  00            	_FILEN:	DB	0
  ECA0  00            	_DIRF:	DB	0	;bit7:ディレクトリ bit0-6:セクタインデックス 
  ECA1  00            	_MAXCYL:DB	0
  ECA2  00            	_WTFATF:DB	0	;FATバッファの更新フラグ
  ECA3                			DS	1
  ECA4  00            	_WTDBF:	DB	0	;データバッファの更新フラグ
  ECA5  FF            	_DBDRV:	DB	0FFH	;データバッファにあるデータを読み込んだドライブ
  ECA6  0000          	_DBSEC:	DW	0	;データバッファにあるデータを読み込んだセクタ番号
  ECA8  0000          	_DPB:	DW	0
  ECAA  FF            	_FATDRV:DB	0FFH	;FATバッファに読み込んでいるドライブ
  ECAB  00            	_FATIX:	DB	0	;FATバッファに読み込んでいるインデックス
  ECAC  0000          	_FAKEFREE:	DW	0	;偽の残量（FATサイズが大きくなると重くなるのでその対策）
                      	
  ECAE                		DS	2
                      	
  ECB0  6F5059381F0219	CRTCD:	DB	06FH,050H,059H,038H,01FH,002H,019H,01CH
  ECB8  0007          		DB	000H,007H
  ECBA  30F8B0FF      		DW	0-80*LINE,0-80
  ECBE  0C            		DB	00CH
  ECBF  A0            	WK1FD0:	DB	0A0H
                      	
  ECC0  C0D6          	CTC0:	DW	INTCTCE
  ECC2  C0D6          	CTC1:	DW	INTCTCE
  ECC4  E2D6          	CTC2:	DW	INTCTC2
  ECC6  C0D6          	CTC3:	DW	INTCTCE
  ECC8  A7D6          	INTVEC:	DW	INT
                      	
                      	;	JUMP
                      	
  ECCA  C378DC        	_INKEY:	JP	INKEY
  ECCD  C3E3D8        	_PRINT:	JP	PRINT
  ECD0  C3C3DB        	_SCRN:	JP	SCRN
  ECD3  C3EBDB        	_POS:	JP	POS
  ECD6  C326DA        	_LOC:	JP	LOC
  ECD9  C3E5E8        	_CHGDRV:JP	CHGDRV
  ECDC  C3C2E9        	_GETDPB:JP	GETDPB
  ECDF  C3DFE9        	_FFLUSH:JP	FFLUSH
  ECE2  C3DDE5        	_RDFATX:JP	RDFATX
  ECE5  C3F9E6        	_RDFAT:	JP	RDFAT
  ECE8  C3C3EA        	_WTTRK:	JP	WTTRK
  ECEB  C3D0EA        	_FDRD:	JP	FDRD
  ECEE  C3C7EA        	_FDWT:	JP	FDWT
  ECF1  C349E8        	_DRD:	JP	DRD16
  ECF4  C359E8        	_DWT:	JP	DWT16
  ECF7                	_GNCL:
  ECF7  C373E6        	GNCPAT:	JP	GNCL		;自己書き換え
  ECFA                	_SNCL:
  ECFA  C396E6        	SNCPAT:	JP	SNCL		;自己書き換え
  ECFD  C3D0CC        	_COMANL:JP	COMANL
                      	
  ED00                	WE:
                      	
                      	;LDDPB.ASM
                      	
                      	;	LSX-Dodgers DPB
                      	
  ED00                	DEVICE:
                      	
                      	;	A:
                      	
  ED00  0200          		DW	2	;DPB_00_FATLN
  ED02  EBEC          		DW	_FDRD	;DPB_02_DRD
  ED04  EEEC          		DW	_FDWT	;DPB_04_DWT
  ED06  FD            		DB	0FDH	;DPB_06_FATID
  ED07  02            		DB	2	;DPB_07_SECPCL
  ED08  6401          		DW	356	;DPB_08_MAXCL
  ED0A  FF            		DB	0FFH	;DPB_0A_FDMODE	0FFH=2D / 0FEH=2HD
  ED0B  07            		DB	7	;DPB_0B_DIRSCNT
  ED0C  28            		DB	40	;DPB_0C_MAXCYL
  ED0D  09            		DB	9	;DPB_0D_MAXSEC	Number of sectors
  ED0E  01            		DB	1	;DPB_0E_FATPS
  ED0F  82            		DB	082H	;DPB_0F_BPS
  ED10  0500          		DW	5	;DPB_10_DIRPS
  ED12  A7            		DB	0A7H	;DPB_12_DEVICE	Device Number
  ED13  00            		DB	0	;DPB_13_UNITNO
  ED14  0800          		DW	8	;DPB_14_ADDCL16
  ED16  0000          		DW	0	;DPB_16
  ED18  0000          		DW	0	;DPB_18
  ED1A  0000          		DW	0	;DPB_1A_SDIR
  ED1C  46444430      		DB	"FDD0"	;DPB_1C_NAME
                      	
                      	;	B:
                      	
  ED20  0200          		DW	2	;DPB_00_FATLN
  ED22  EBEC          		DW	_FDRD	;DPB_02_DRD
  ED24  EEEC          		DW	_FDWT	;DPB_04_DWT
  ED26  FD            		DB	0FDH	;DPB_06_FATID
  ED27  02            		DB	2	;DPB_07_SECPCL
  ED28  6401          		DW	356	;DPB_08_MAXCL
  ED2A  FF            		DB	0FFH	;DPB_0A_FDMODE	0FFH=2D / 0FEH=2HD
  ED2B  07            		DB	7	;DPB_0B_DIRSCNT
  ED2C  28            		DB	40	;DPB_0C_MAXCYL
  ED2D  09            		DB	9	;DPB_0D_MAXSEC	Number of sectors
  ED2E  01            		DB	1	;DPB_0E_FATPS
  ED2F  82            		DB	082H	;DPB_0F_BPS
  ED30  0500          		DW	5	;DPB_10_DIRPS
  ED32  A7            		DB	0A7H	;DPB_12_DEVICE	Device Number
  ED33  01            		DB	1	;DPB_13_UNITNO
  ED34  0800          		DW	8	;DPB_14_ADDCL16
  ED36  0000          		DW	0	;DPB_16
  ED38  0000          		DW	0	;DPB_18
  ED3A  0000          		DW	0	;DPB_1A_SDIR
  ED3C  46444431      		DB	"FDD1"	;DPB_1C_NAME
                      	
                      	;	C:
                      	
  ED40  0200          		DW	2	;DPB_00_FATLN
  ED42  EBEC          		DW	_FDRD	;DPB_02_DRD
  ED44  EEEC          		DW	_FDWT	;DPB_04_DWT
  ED46  FD            		DB	0FDH	;DPB_06_FATID
  ED47  02            		DB	2	;DPB_07_SECPCL
  ED48  6401          		DW	356	;DPB_08_MAXCL
  ED4A  FF            		DB	0FFH	;DPB_0A_FDMODE	0FFH=2D / 0FEH=2HD
  ED4B  07            		DB	7	;DPB_0B_DIRSCNT
  ED4C  28            		DB	40	;DPB_0C_MAXCYL
  ED4D  09            		DB	9	;DPB_0D_MAXSEC	Number of sectors
  ED4E  01            		DB	1	;DPB_0E_FATPS
  ED4F  82            		DB	082H	;DPB_0F_BPS
  ED50  0500          		DW	5	;DPB_10_DIRPS
  ED52  A7            		DB	0A7H	;DPB_12_DEVICE	Device Number
  ED53  02            		DB	2	;DPB_13_UNITNO
  ED54  0800          		DW	8	;DPB_14_ADDCL16
  ED56  0000          		DW	0	;DPB_16
  ED58  0000          		DW	0	;DPB_18
  ED5A  0000          		DW	0	;DPB_1A_SDIR
  ED5C  46444432      		DB	"FDD2"	;DPB_1C_NAME
                      	
                      	;	D:
                      	
  ED60  0200          		DW	2	;DPB_00_FATLN
  ED62  EBEC          		DW	_FDRD	;DPB_02_DRD
  ED64  EEEC          		DW	_FDWT	;DPB_04_DWT
  ED66  FD            		DB	0FDH	;DPB_06_FATID
  ED67  02            		DB	2	;DPB_07_SECPCL
  ED68  6401          		DW	356	;DPB_08_MAXCL
  ED6A  FF            		DB	0FFH	;DPB_0A_FDMODE	0FFH=2D / 0FEH=2HD
  ED6B  07            		DB	7	;DPB_0B_DIRSCNT
  ED6C  28            		DB	40	;DPB_0C_MAXCYL
  ED6D  09            		DB	9	;DPB_0D_MAXSEC	Number of sectors
  ED6E  01            		DB	1	;DPB_0E_FATPS
  ED6F  82            		DB	082H	;DPB_0F_BPS
  ED70  0500          		DW	5	;DPB_10_DIRPS
  ED72  A7            		DB	0A7H	;DPB_12_DEVICE
  ED73  03            		DB	3	;DPB_13_UNITNO
  ED74  0800          		DW	8	;DPB_14_ADDCL16
  ED76  0000          		DW	0	;DPB_16
  ED78  0000          		DW	0	;DPB_18
  ED7A  0000          		DW	0	;DPB_1A_SDIR
  ED7C  46444433      		DB	"FDD3"	;DPB_1C_NAME
                      	
                      	;	E:
                      	
  ED80  0000          	EMMFL:	DW	0	;DPB_00_FATLN
  ED82  30D3          	EMMRD:	DW	EDRDC	;DPB_02_DRD
  ED84  2DD3          	EMMWR:	DW	EDWTC	;DPB_04_DWT
  ED86  FE            		DB	0FEH	;DPB_06_FATID
  ED87  01            		DB	1	;DPB_07_SECPCL
  ED88  0000          	EMMCL:	DW	0	;DPB_08_MAXCL
  ED8A  00            		DB	0	;DPB_0A_FDMODE
  ED8B  06            		DB	6	;DPB_0B_DIRSCNT
  ED8C  00            	EMMBL:	DB	0	;DPB_0C_MAXCYL
  ED8D  01            		DB	1	;DPB_0D_MAXSEC
  ED8E  01            		DB	1	;DPB_0E_FATPS
  ED8F  04            		DB	4	;DPB_0F_BPS
  ED90  0500          		DW	5	;DPB_10_DIRPS
  ED92  06            		DB	6	;DPB_12_DEVICE
  ED93  00            	EMMDV:	DB	0	;DPB_13_UNITNO
  ED94  0900          		DW	9	;DPB_14_ADDCL16
  ED96  0000          		DW	0	;DPB_16
  ED98  0000          		DW	0	;DPB_18
  ED9A  0000          		DW	0	;DPB_1A_SDIR
  ED9C  454D4D30      		DB	"EMM0"	;DPB_1C_NAME
                      	
                      	;	F:
                      	
  EDA0  0000          	BANKFL:	DW	0	;DPB_00_FATLN
  EDA2  ABD2          		DW	BDRDC	;DPB_02_DRD
  EDA4  CED2          		DW	BDWTC	;DPB_04_DWT
  EDA6  F9            		DB	0F9H	;DPB_06_FATID
  EDA7  01            		DB	1	;DPB_07_SECPCL
  EDA8  0000          	BANKCL:	DW	0	;DPB_08_MAXCL
  EDAA  00            		DB	0	;DPB_0A_FDMODE
  EDAB  04            		DB	4	;DPB_0B_DIRSCNT
  EDAC  00            		DB	0	;DPB_0C_MAXCYL
  EDAD  01            		DB	1	;DPB_0D_MAXSEC
  EDAE  00            		DB	0	;DPB_0E_FATPS
  EDAF  04            		DB	4	;DPB_0F_BPS
  EDB0  0100          		DW	1	;DPB_10_DIRPS
  EDB2  0B            		DB	00BH	;DPB_12_DEVICE
  EDB3  00            		DB	0	;DPB_13_UNITNO
  EDB4  0300          		DW	3	;DPB_14_ADDCL16
  EDB6  0000          		DW	0	;DPB_16
  EDB8  0000          		DW	0	;DPB_18
  EDBA  0000          		DW	0	;DPB_1A_SDIR
  EDBC  4252414D      		DB	"BRAM"	;DPB_1C_NAME
                      	
                      	;	G:
                      	
  EDC0  0100          		DW	1	;DPB_00_FATLN
  EDC2  7CD2          		DW	GDRD	;DPB_02_DRD
  EDC4  87D2          		DW	GDWT	;DPB_04_DWT
  EDC6  F9            		DB	0F9H	;DPB_06_FATID
  EDC7  04            		DB	4	;DPB_07_SECPCL
  EDC8  3000          		DW	48	;DPB_08_MAXCL
  EDCA  00            		DB	0	;DPB_0A_FDMODE
  EDCB  04            		DB	4	;DPB_0B_DIRSCNT
  EDCC  00            		DB	0	;DPB_0C_MAXCYL
  EDCD  01            		DB	1	;DPB_0D_MAXSEC
  EDCE  00            		DB	0	;DPB_0E_FATPS
  EDCF  01            		DB	1	;DPB_0F_BPS
  EDD0  0400          		DW	4	;DPB_10_DIRPS
  EDD2  05            		DB	5	;DPB_12_DEVICE
  EDD3  01            		DB	1	;DPB_13_UNITNO
  EDD4  0000          		DW	0	;DPB_14_ADDCL16
  EDD6  0000          		DW	0	;DPB_16
  EDD8  0000          		DW	0	;DPB_18
  EDDA  0000          		DW	0	;DPB_1A_SDIR
  EDDC  4752414D      		DB	"GRAM"	;DPB_1C_NAME
                      	
                      	
                      	
  EDE0  00            	LDEND:	DB	0
                      	
  EDE1                		END
