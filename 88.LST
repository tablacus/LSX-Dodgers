                                ;*** AILZ80ASM *** Z-80 Assembler, version 1.0.0.0, LST:Full:4
                                ;   LSX-Dodgers for PC-8801mkIISR
                                ;   Programmed by
                                ;   Gaku (Lovers/Tablacus)
                                
                                    INCLUDE "88DEF.ASM"
                                
                                ;   LSX-Dodgers DEF
                                ;   PC-8001mkIISR
                                
       0002                     MAC EQU 2   ;PC-8001mkIISR
       0001                     DEV EQU 1
                                
                                
       CD00                     RUN EQU 0CD00H
       CCF9                     OFFSET  EQU RUN-7
                                
       D106                     BDOS    EQU 0D106H
       EE00                     INTAD   EQU 0EE00H
       EF00                     WORKAD  EQU 0EF00H
       F300                     FATBF   EQU 0F300H
       FB00                     DTBUF   EQU 0FB00H
       FF00                     KEYBF   EQU 0FF00H
       FF20                     KBUF    EQU 0FF20H
       FFD9                     TRAP38  EQU 0FFD9H
       0050                     WIDTH   EQU 80
       0018                     LINE    EQU 24
       0000                     COLORF  EQU 0
       0010                     KEYSP_H EQU 16
       0000                     KEYSP_L EQU 0
       0009                     COMS    EQU 9
                                
                                ; ディスクサブシステム
       002A                     MAIN        EQU 0002AH
                                
       4000                     DSS_DATA    EQU 04000H
                                
       7C00                     DSS     EQU 07C00H
[EOF:88DEF.ASM:SHIFT_JIS]
                                    INCLUDE "LDDEF.ASM"
                                
                                ;   LSX-Dodgers DEF
                                
       0001                     VER_1   EQU 1
       0005                     VER_2   EQU 5
       0002                     VER_3   EQU 2
       1D02                     MACW    EQU MAC + 01D00H    ;機種フラグとLD判別フラグ
       0102                     MACD    EQU MAC + DEV * 256 ;機種フラグとデバイスフラグ
       0152                     VER EQU VER_1 * 256 + VER_2 * 16 + VER_3
                                
       0005                     SYSTEM  EQU 00005H
       000F                     JP_HL   EQU 0000FH
       005C                     FCB1    EQU 0005CH
       006C                     FCB2    EQU 0006CH
       005D                     FCB1FN  EQU FCB1+1
       006D                     FCB2FN  EQU FCB2+1
       0080                     DTA1    EQU 00080H
                                
       FFCA                     EXTBIO  EQU 0FFCAH
                                
[EOF:LDDEF.ASM:SHIFT_JIS]
                                
000000 CCF9                         ORG OFFSET
                                
                                ;   MSX BINARY HEADER
000000 CCF9 FE                      DB  0FEH
                                ;   MSX BINARY START ADDRESS
000001 CCFA 00CD                    DW  RUN
                                ;   MSX BINARY END ADDRESS
000003 CCFC F9F2                    DW  LAST_ADR
                                ;   MSX BINARY EXEC ADDRESS
000005 CCFE 07CD                    DW  START
                                
                                    INCLUDE "88INIT.ASM"
                                
                                ;   LSX-Dodgers INIT
                                ;   PC-8801mkIISR
                                
000007 CD00 C307CD          10      JP  START
00000A CD03 021D                    DW  MACW
00000C CD05 5201                    DW  VER
                                
       CD07                     START:
00000E CD07 F3               4      DI
00000F CD08 ED5E             8      IM  2
000011 CD0A 3107CD          10      LD  SP,START
000014 CD0D CD1BCD          17      CALL    INIT        ;NZならAUTOEXECを実行
000017 CD10 210000          10      LD  HL,0
00001A CD13 E5              11      PUSH    HL
00001B CD14 C8              11      RET Z
00001C CD15 1140CE          10      LD  DE,AUTOD
00001F CD18 C3FDEF          10      JP  _COMANL
                                
       CD1B                     INIT:
000022 CD1B DB32            11      IN  A,(032H)
000024 CD1D CBA7             8      RES 4,A     ;高速RAMアクセスモード
000026 CD1F D332            11      OUT (032H),A
                                
000028 CD21 21C8F3          10      LD  HL,0F3C8H   ;テキストをクリア
00002B CD24 11E880          10      LD  DE,080E8H
00002E CD27 0E20             7      LD  C,' '
000030 CD29 3E19             7      LD  A,25
       CD2B                     TVCL1:
000032 CD2B 0650             7      LD  B,80
       CD2D                     TVCL2:
000034 CD2D 71               7      LD  (HL),C
000035 CD2E 23               6      INC HL
000036 CD2F 10FC            13      DJNZ    TVCL2
000038 CD31 0614             7      LD  B,20
       CD33                     TVCL3:
00003A CD33 72               7      LD  (HL),D
00003B CD34 2C               4      INC L
00003C CD35 73               7      LD  (HL),E
00003D CD36 23               6      INC HL
00003E CD37 10FA            13      DJNZ    TVCL3
000040 CD39 3D               4      DEC A
000041 CD3A 20EF            12      JR  NZ,TVCL1
                                
000043 CD3C DB32            11      IN  A,(032H)
000045 CD3E F610             7      OR  010H        ;高速RAMアクセスモードOFF
000047 CD40 D332            11      OUT (032H),A
                                
000049 CD42 AF               4      XOR A
00004A CD43 32B8EF          13      LD  (WKE6),A
00004D CD46 2F               4      CPL
00004E CD47 32B7EF          13      LD  (WKE4),A
                                
000051 CD4A CDF5DD          17      CALL    INIT_CRTC
       CD4D                     BANK:
000054 CD4D DBE2            11      IN  A,(0E2H)
000056 CD4F 06E3             7      LD  B,0E3H      ;拡張RAM バンク選択
000058 CD51 21007F          10      LD  HL,07F00H
00005B CD54 F3               4      DI
00005C CD55 3E11             7      LD  A,011H
00005E CD57 D3E2            11      OUT (0E2H),A    ;拡張RAM リード/ライト制御
000060 CD59 ED69            12      OUT (C),L
000062 CD5B 3A0000          13      LD  A,(0)
000065 CD5E FEEB             7      CP  0EBH
000067 CD60 2005            12      JR  NZ,BANK1
000069 CD62 3E2B             7      LD  A,02BH
00006B CD64 32B2F2          13      LD  (BANKDV),A
       CD67                     BANK1:
00006E CD67 3E11             7      LD  A,011H
000070 CD69 D3E2            11      OUT (0E2H),A    ;拡張RAM リード/ライト制御
000072 CD6B ED69            12      OUT (C),L
000074 CD6D 5E               7      LD  E,(HL)
000075 CD6E 7B               4      LD  A,E
000076 CD6F C6A5             7      ADD A,0A5H
000078 CD71 77               7      LD  (HL),A
000079 CD72 BE               7      CP  (HL)
00007A CD73 73               7      LD  (HL),E
00007B CD74 2005            12      JR  NZ,BANK2
00007D CD76 2C               4      INC L
00007E CD77 CB65             8      BIT 4,L
000080 CD79 28EC            12      JR  Z,BANK1
       CD7B                     BANK2:
000082 CD7B AF               4      XOR A
000083 CD7C D3E2            11      OUT (0E2H),A    ;拡張RAM リード/ライト制御
000085 CD7E 7D               4      LD  A,L
000086 CD7F B7               4      OR  A
000087 CD80 2813            12      JR  Z,NOBANK
000089 CD82 2600             7      LD  H,0
00008B CD84 29              11      ADD HL,HL   ;*2
00008C CD85 29              11      ADD HL,HL   ;*4
00008D CD86 29              11      ADD HL,HL   ;*8
00008E CD87 29              11      ADD HL,HL   ;*16
00008F CD88 29              11      ADD HL,HL   ;*32
000090 CD89 2B               6      DEC HL  ;-1
000091 CD8A 2B               6      DEC HL  ;-2
000092 CD8B 2B               6      DEC HL  ;-3
000093 CD8C 22A8F2          16      LD  (BANKCL),HL
000096 CD8F CD30CE          17      CALL    CALC_FATLN
000099 CD92 32A0F2          13      LD  (BANKFL),A
       CD95                     NOBANK:
                                                ;初期化
00009C CD95 AF               4      XOR A       ;イニシャライズ
00009D CD96 CD19EC          17      CALL    PUTCOM
0000A0 CD99 3E16             7      LD  A,16H       ;高速レシーブメモリ
0000A2 CD9B CD19EC          17      CALL    PUTCOM
0000A5 CD9E 3E7C             7      LD  A,DSS/256   ;開始アドレスH
0000A7 CDA0 CD1FEC          17      CALL    PUTDAT
0000AA CDA3 AF               4      XOR A       ;開始アドレスL
0000AB CDA4 CD1FEC          17      CALL    PUTDAT
0000AE CDA7 013902          10      LD  BC,AT_DSSE-AT_DSS
0000B1 CDAA CB41             8      BIT 0,C
0000B3 CDAC 2801            12      JR  Z,SUBPG1
0000B5 CDAE 03               6      INC BC      ;偶数にする
       CDAF                     SUBPG1:
0000B6 CDAF 78               4      LD  A,B     ;バイト数H
0000B7 CDB0 CD1FEC          17      CALL    PUTDAT
0000BA CDB3 79               4      LD  A,C
0000BB CDB4 CD1FEC          17      CALL    PUTDAT
0000BE CDB7 219FCE          10      LD  HL,AT_DSS
0000C1 CDBA CD63EC          17      CALL    FPUTDAT
                                
0000C4 CDBD 210000          10      LD  HL,0
0000C7 CDC0 065C             7      LD  B,05CH
0000C9 CDC2 3EFF             7      LD  A,0FFH      ;RST 38H
0000CB CDC4 CD3BDF          17      CALL    FILL_MEMORY
0000CE CDC7 06A4             7      LD  B,0A4H
0000D0 CDC9 AF               4      XOR A
0000D1 CDCA CD3BDF          17      CALL    FILL_MEMORY
                                
0000D4 CDCD 3EC3             7      LD  A,0C3H      ;JP
0000D6 CDCF 2103EF          10      LD  HL,CPM_WBOOT
0000D9 CDD2 320000          13      LD  (00000H),A
0000DC CDD5 220100          16      LD  (00001H),HL ;IPL
                                
0000DF CDD8 21021D          10      LD  HL,MACW     ;3 bit7  DPB Compatible LA(1)
0000E2 CDDB 220300          16      LD  (00003H),HL ;  bit6-0 Machine
                                ;               ;4 LSX-Dodgers(01DH)
0000E5 CDDE 2106D1          10      LD  HL,BDOS
0000E8 CDE1 320500          13      LD  (00005H),A
0000EB CDE4 220600          16      LD  (00006H),HL ;BDOS
                                
0000EE CDE7 216EDE          10      LD  HL,BIOS
0000F1 CDEA 321800          13      LD  (00018H),A
0000F4 CDED 221900          16      LD  (00019H),HL ;BIOS-ROM
                                
0000F7 CDF0 21D9FF          10      LD  HL,TRAP38   ;TRAP38
0000FA CDF3 323800          13      LD  (00038H),A
0000FD CDF6 223900          16      LD  (00039H),HL ;RST 038H
                                
000100 CDF9 3EEF             7      LD  A,CPM_BOOT/256
000102 CDFB 320B00          13      LD  (0000BH),A
                                
000105 CDFE 3EE9             7      LD  A,0E9H      ;JP (HL)
000107 CE00 320F00          13      LD  (0000FH),A
                                
00010A CE03 214CCE          10      LD  HL,INIMES
00010D CE06 CDAAD6          17      CALL    MSX
       CE09                     INIT1:
000110 CE09 F3               4      DI
000111 CE0A 1100FF          10      LD  DE,0FF00H
000114 CE0D 0600             7      LD  B,0
000116 CE0F CDBDD4          17      CALL    ZERO_MEMORY_DE
000119 CE12 21CAFF          10      LD  HL,EXTBIO
00011C CE15 36C9            10      LD  (HL),0C9H   ;RET
00011E CE17 23               6      INC HL
00011F CE18 060E             7      LD  B,TRAP38-EXTBIO-1
000121 CE1A 3EFF             7      LD  A,0FFH      ;RST 38H
000123 CE1C CD3BDF          17      CALL    FILL_MEMORY
000126 CE1F 2178CE          10      LD  HL,AT_TRAP38
000129 CE22 11D9FF          10      LD  DE,TRAP38
00012C CE25 012700          10      LD  BC,AT_TRAPE-AT_TRAP38
00012F CE28 EDB0                    LDIR
                                
000131 CE2A CD94DD          17      CALL    CHKEY
000134 CE2D FE03             7      CP  3
000136 CE2F C9              10      RET
                                
       CE30                     CALC_FATLN: ;FAT12のクラスタ数から必要なFATサイズを求める(セクタサイズ512)
000137 CE30 5D               4      LD  E,L
000138 CE31 54               4      LD  D,H
000139 CE32 29              11      ADD HL,HL   ;*2
00013A CE33 19              11      ADD HL,DE   ;*3
00013B CE34 CB3C             8      SRL H   ;/2
00013D CE36 CB1D             8      RR  L   ;1クラスタ辺り1.5バイト必要
00013F CE38 11FF01          10      LD  DE,511  ;切り上げる
000142 CE3B 19              11      ADD HL,DE
000143 CE3C 7C               4      LD  A,H
000144 CE3D CB3F             8      SRL A
000146 CE3F C9              10      RET
                                
000147 CE40 4155544F45584543    AUTOD:  DB  "AUTOEXEC "
            20                  
000150 CE49 413A00              AUTODV: DB  "A:",0
                                
000153 CE4C 0C4C53582D446F64    INIMES: DB  00CH,"LSX-Dodgers for PC-8801mkIISR v"
            6765727320666F72    
            2050432D38383031    
            6D6B494953522076    
000173 CE6C 312E                    DB  030H + VER_1, '.'
000175 CE6E 3532                    DB  030H + VER_2 ,030H + VER_3
                                ;   DB  ""
000177 CE70 2047616B750D0A          DB  ' Gaku',0DH,0AH
00017E CE77 00                      DB  0
                                
       CE78                     AT_TRAP38:
00017F FFD9                         ORG TRAP38,AT_TRAP38-OFFSET
00017F FFD9 210000          10      LD  HL,0
000182 FFDC E3              19      EX  (SP),HL
000183 FFDD 3E24             7      LD  A,'$'
000185 FFDF CD9AD9          17      CALL    MSG_A
000188 FFE2 2B               6      DEC HL
000189 FFE3 7C               4      LD  A,H
00018A FFE4 CDE8FF          17      CALL    PRHX
00018D FFE7 7D               4      LD  A,L
       FFE8                     PRHX:
00018E FFE8 F5              11      PUSH    AF
00018F FFE9 07               4      RLCA
000190 FFEA 07               4      RLCA
000191 FFEB 07               4      RLCA
000192 FFEC 07               4      RLCA
000193 FFED CDF1FF          17      CALL    PRHX2
000196 FFF0 F1              10      POP AF
       FFF1                     PRHX2:
000197 FFF1 E60F             7      AND 00FH
000199 FFF3 FE0A             7      CP  10
00019B FFF5 3F               4      CCF
00019C FFF6 CE30             7      ADC A,'0'
00019E FFF8 27               4      DAA
00019F FFF9 C39AD9          10      JP  MSG_A
0001A2 FFFC                         DS  4
0001A6 CE9F                         ORG $$+OFFSET   ;$DEPHASE
       CE9F                     AT_TRAPE:
[EOF:88INIT.ASM:SHIFT_JIS]
                                    INCLUDE "88SUB.ASM"
                                
                                ;   LSX-Dodgers SUB DISK SYSTEM
                                ;   PC-8801mkIISR
                                
       CE9F                     AT_DSS:
0001A6 7C00                         ORG DSS,AT_DSS-OFFSET
0001A6 7C00 C3187C          10      JP  READDISKEX
0001A9 7C03 C3787C          10      JP  WRITEDISKEX
0001AC 7C06 C3907C          10      JP  GETPARAMS_N
0001AF 7C09 C39B7C          10      JP  SEEK
0001B2 7C0C C3297D          10      JP  FDCOMMAND
0001B5 7C0F C3F57D          10      JP  CHECKRESULT
0001B8 7C12 C3177E          10      JP  GETDEVSTAT
0001BB 7C15 C31C7E          10      JP  RDFDC
                                
       7C18                     READDISKEX:
0001BE 7C18 CD8E7C          17      CALL    GETPARAMS
0001C1 7C1B AF               4      XOR A
0001C2 7C1C 324F7C          13      LD  (RETRY_RDDISK),A
0001C5 7C1F 2A287E          16      LD  HL,(S_PARAMS+2)
0001C8 7C22 7D               4      LD  A,L
0001C9 7C23 3D               4      DEC A
0001CA 7C24 B4               4      OR  H
0001CB 7C25 200C            12      JR  NZ,RDDISK0
0001CD 7C27 2A2B7E          16      LD  HL,(S_PARAMS+5)
0001D0 7C2A 7C               4      LD  A,H
0001D1 7C2B BD               4      CP  L
0001D2 7C2C 2005            12      JR  NZ,RDDISK0
0001D4 7C2E 3E03             7      LD  A,3
0001D6 7C30 324F7C          13      LD  (RETRY_RDDISK),A
       7C33                     RDDISK0:
0001D9 7C33 CD9B7C          17      CALL    SEEK
0001DC 7C36 3E46             7      LD  A,46H       ;READ DATA
0001DE 7C38 CD297D          17      CALL    FDCOMMAND
0001E1 7C3B 3834            12      JR  C,FINISH_DISK
0001E3 7C3D CD5A7D          17      CALL    RDDISK1
       7C40                     WRDISK3:
0001E6 7C40 78               4      LD  A,B
0001E7 7C41 B2               4      OR  D
0001E8 7C42 32377E          13      LD  (S_LEFT),A
0001EB 7C45 DBF8            11      IN  A,(0F8H)    ;FDC μPD765A TC入力
0001ED 7C47 FB               4      EI
0001EE 7C48 76               4      HALT
0001EF 7C49 CDF57D          17      CALL    CHECKRESULT
0001F2 7C4C 301D            12      JR  NC,FINISH_DISK0
       7C4F                     RETRY_RDDISK    EQU $+1
0001F4 7C4E 3E00             7      LD  A,0
0001F6 7C50 B7               4      OR  A
0001F7 7C51 2818            12      JR  Z,FINISH_DISK0
0001F9 7C53 3D               4      DEC A
0001FA 7C54 324F7C          13      LD  (RETRY_RDDISK),A
0001FD 7C57 3A2B7E          13      LD  A,(S_PARAMS+5)
000200 7C5A FE04             7      CP  4
000202 7C5C 3003            12      JR  NC,RETRY_RDDISK1
000204 7C5E 87               4      ADD A,A
000205 7C5F 1802            12      JR  RETRY_RDDISK2
       7C61                     RETRY_RDDISK1:
000207 7C61 3E01             7      LD  A,1
       7C63                     RETRY_RDDISK2:
000209 7C63 67               4      LD  H,A
00020A 7C64 6F               4      LD  L,A
00020B 7C65 222B7E          16      LD  (S_PARAMS+5),HL
00020E 7C68 C3337C          10      JP  RDDISK0
       7C6B                     FINISH_DISK0:
000211 7C6B 3A377E          13      LD  A,(S_LEFT)
000214 7C6E D601             7      SUB 1
000216 7C70 3F               4      CCF
       7C71                     FINISH_DISK:
000217 7C71 9F               4      SBC A,A
000218 7C72 32367E          13      LD  (S_CMD_STATUS),A
00021B 7C75 C32A00          10      JP  MAIN
                                
       7C78                     WRITEDISKEX:
00021E 7C78 AF               4      XOR A
00021F 7C79 324F7C          13      LD  (RETRY_RDDISK),A
000222 7C7C CD8E7C          17      CALL    GETPARAMS
000225 7C7F CD9B7C          17      CALL    SEEK
000228 7C82 3E45             7      LD  A,45H       ;WRITE DATA
00022A 7C84 CD297D          17      CALL    FDCOMMAND
00022D 7C87 38E8            12      JR  C,FINISH_DISK
00022F 7C89 CDA17D          17      CALL    WRDISK1
000232 7C8C 18B2            12      JR  WRDISK3
                                
       7C8E                     GETPARAMS:
000234 7C8E 0608             7      LD  B,8
       7C90                     GETPARAMS_N:
000236 7C90 E5              11      PUSH    HL
000237 7C91 21267E          10      LD  HL,S_PARAMS
       7C94                     GETPARAMS1:
00023A 7C94 D7              12      RST 10H
00023B 7C95 77               7      LD  (HL),A
00023C 7C96 23               6      INC HL
00023D 7C97 10FB            13      DJNZ    GETPARAMS1
00023F 7C99 E1              10      POP HL
000240 7C9A C9              10      RET
                                
       7C9B                     SEEK:
000241 7C9B E5              11      PUSH    HL
000242 7C9C 3A2A7E          13      LD  A,(S_PARAMS+4)  ;MFMモード切り替え $FF:2D/2DD $FE:2HD
000245 7C9F 1F               4      RRA
000246 7CA0 3F               4      CCF
000247 7CA1 9F               4      SBC A,A
000248 7CA2 F5              11      PUSH    AF
000249 7CA3 E605             7      AND 5
00024B 7CA5 4F               4      LD  C,A
00024C 7CA6 3A2D7E          13      LD  A,(S_PARAMS+7)  ;シリンダ数
00024F 7CA9 C6D3             7      ADD A,0-45      ;オーバートラックを考慮して40+α
000251 7CAB 9F               4      SBC A,A
000252 7CAC E604             7      AND 4
000254 7CAE B1               4      OR  C
000255 7CAF 0EFA             7      LD  C,0FFH-5    ;マスク
000257 7CB1 47               4      LD  B,A
000258 7CB2 3A267E          13      LD  A,(S_PARAMS)    ;0:ドライブA 1:ドライブB
00025B 7CB5 B7               4      OR  A
00025C 7CB6 2804            12      JR  Z,SET_WKF4
00025E 7CB8 CB20             8      SLA B
000260 7CBA CB01             4      RLC C
       7CBC                     SET_WKF4:
000262 7CBC 3A387E          13      LD  A,(S_WKF4)
000265 7CBF A1               4      AND C
000266 7CC0 B0               4      OR  B
000267 7CC1 4F               4      LD  C,A
000268 7CC2 D3F4            11      OUT (0F4H),A    ;ドライブ制御
00026A 7CC4 E6DF             7      AND 0FFH-020H   ;CLKの分は抜いておく
00026C 7CC6 47               4      LD  B,A
00026D 7CC7 F1              10      POP AF
00026E 7CC8 E620             7      AND 020H        ;bit5:CLK
000270 7CCA B0               4      OR  B
000271 7CCB D3F4            11      OUT (0F4H),A    ;ドライブ制御
000273 7CCD 32387E          13      LD  (S_WKF4),A
000276 7CD0 47               4      LD  B,A
000277 7CD1 A9               4      XOR C
000278 7CD2 E620             7      AND 020H        ;CLKが変化したら一定時間待つ
00027A 7CD4 2808            12      JR  Z,NOCHGCLK
00027C 7CD6 2160F0          10      LD  HL,0F060H
       7CD9                     WAIT_CLK:
00027F 7CD9 2B               6      DEC HL
000280 7CDA 7C               4      LD  A,H
000281 7CDB B5               4      OR  L
000282 7CDC 20FB            12      JR  NZ,WAIT_CLK
       7CDE                     NOCHGCLK:
000284 7CDE 78               4      LD  A,B
000285 7CDF E620             7      AND 020H
000287 7CE1 2805            12      JR  Z,SPECIFY2D
000289 7CE3 1131DF          10      LD  DE,0DF31H   ;SPECIFY 2HD / SRT:13 HUT:15 HLT:24 NON-DMA
00028C 7CE6 1803            12      JR  SPECIFYOK
       7CE8                     SPECIFY2D:
00028E 7CE8 1119DA          10      LD  DE,0DA19H   ;SPECIFY 2D/2DD / SRT:13 HUT 10 HLT:12 NON-DMA
       7CEB                     SPECIFYOK:
000291 7CEB 3E03             7      LD  A,3     ;SPECIFY
000293 7CED E7              12      RST 20H
000294 7CEE 7A               4      LD  A,D
000295 7CEF E7              12      RST 20H
000296 7CF0 7B               4      LD  A,E
000297 7CF1 E7              12      RST 20H
       7CF2                     NOSPECIFY:
000298 7CF2 ED4B267E        20      LD  BC,(S_PARAMS)
00029C 7CF6 ED5B287E        20      LD  DE,(S_PARAMS+2)
0002A0 7CFA 7A               4      LD  A,D     ;TRACK
0002A1 7CFB CB3F             8      SRL A       ;CYLINDER
0002A3 7CFD 3E0F             7      LD  A,00FH      ;SEEK
0002A5 7CFF 2002            12      JR  NZ,SEEK1    ;0シリンダの場合はRECALIBRATE、それ以外はSEEKを使う
0002A7 7D01 3E07             7      LD  A,7     ;RECALIBRATE
       7D03                     SEEK1:
0002A9 7D03 E7              12      RST 20H
0002AA 7D04 79               4      LD  A,C     ;DR/HD
0002AB 7D05 E7              12      RST 20H
0002AC 7D06 7A               4      LD  A,D     ;TRACK
0002AD 7D07 CB3F             8      SRL A       ;CYLINDER
0002AF 7D09 C42000          17      CALL    NZ,20H      ;SEEKの場合だけ呼ぶ(0シリンダの場合はRECALIBRATEを使うのでシリンダの設定は不要)
0002B2 7D0C FB               4      EI
0002B3 7D0D 76               4      HALT
0002B4 7D0E 3E08             7      LD  A,8     ;SENSE
0002B6 7D10 E7              12      RST 20H
0002B7 7D11 CD1C7E          17      CALL    RDFDC       ;ST0
0002BA 7D14 CD1C7E          17      CALL    RDFDC       ;PCN(CYLINDER)
0002BD 7D17 210040          10      LD  HL,04000H
       7D1A                     WAIT_SEEK:
0002C0 7D1A CD177E          17      CALL    GETDEVSTAT
0002C3 7D1D E608             7      AND 8
0002C5 7D1F 2006            12      JR  NZ,SEEK_OK
0002C7 7D21 2B               6      DEC HL
0002C8 7D22 7C               4      LD  A,H
0002C9 7D23 B5               4      OR  L
0002CA 7D24 20F4            12      JR  NZ,WAIT_SEEK
0002CC 7D26 37               4      SCF
       7D27                     SEEK_OK:
0002CD 7D27 E1              10      POP HL
0002CE 7D28 C9              10      RET
                                
       7D29                     FDCOMMAND:
0002CF 7D29 E7              12      RST 20H
0002D0 7D2A 7A               4      LD  A,D     ;HD US1 US0
0002D1 7D2B E601             7      AND 1
0002D3 7D2D 87               4      ADD A,A
0002D4 7D2E 87               4      ADD A,A
0002D5 7D2F B1               4      OR  C
0002D6 7D30 E7              12      RST 20H
0002D7 7D31 7A               4      LD  A,D     ;C
0002D8 7D32 CB3F             8      SRL A
0002DA 7D34 E7              12      RST 20H
0002DB 7D35 7A               4      LD  A,D     ;H
0002DC 7D36 E601             7      AND 1
0002DE 7D38 E7              12      RST 20H
0002DF 7D39 7B               4      LD  A,E     ;R
0002E0 7D3A E7              12      RST 20H
0002E1 7D3B 3A2B7E          13      LD  A,(S_PARAMS+5)  ;N
0002E4 7D3E FE04             7      CP  4
0002E6 7D40 3802            12      JR  C,FDCOMMAND2
                                
0002E8 7D42 3E03             7      LD  A,3
       7D44                     FDCOMMAND2:
0002EA 7D44 1E20             7      LD  E,020H      ;NO SERVICE
0002EC 7D46 E7              12      RST 20H
                                
0002ED 7D47 210040          10      LD  HL,DSS_DATA ;開始アドレス
0002F0 7D4A 78               4      LD  A,B     ;EOT
0002F1 7D4B E7              12      RST 20H
                                
0002F2 7D4C 01FB00          10      LD  BC,000FBH   ;B:バイト数L C:FDC μPD765A データレジスタ
0002F5 7D4F 3E54             7      LD  A,054H      ;GSL
0002F7 7D51 E7              12      RST 20H
                                
0002F8 7D52 3A2C7E          13      LD  A,(S_PARAMS+6)
0002FB 7D55 57               4      LD  D,A     ;バイト数H
                                
0002FC 7D56 AF               4      XOR A       ;DTL
0002FD 7D57 E7              12      RST 20H
0002FE 7D58 A7               4      AND A
0002FF 7D59 C9              10      RET
                                
       7D5A                     RDDISK1:            ;高速化の為にループ展開x8
000300 7D5A FB               4      EI
000301 7D5B 76               4      HALT
000302 7D5C DBFA            11      IN  A,(0FAH)    ;FDC μPD765A ステータスレジスタリード
000304 7D5E A3               4      AND E       ;NO SERVICE
000305 7D5F C8              11      RET Z
000306 7D60 EDA2            16      INI
                                
000308 7D62 FB               4      EI
000309 7D63 76               4      HALT
00030A 7D64 DBFA            11      IN  A,(0FAH)    ;FDC μPD765A ステータスレジスタリード
00030C 7D66 A3               4      AND E       ;NO SERVICE
00030D 7D67 C8              11      RET Z
00030E 7D68 EDA2            16      INI
                                
000310 7D6A FB               4      EI
000311 7D6B 76               4      HALT
000312 7D6C DBFA            11      IN  A,(0FAH)    ;FDC μPD765A ステータスレジスタリード
000314 7D6E A3               4      AND E       ;NO SERVICE
000315 7D6F C8              11      RET Z
000316 7D70 EDA2            16      INI
                                
000318 7D72 FB               4      EI
000319 7D73 76               4      HALT
00031A 7D74 DBFA            11      IN  A,(0FAH)    ;FDC μPD765A ステータスレジスタリード
00031C 7D76 A3               4      AND E       ;NO SERVICE
00031D 7D77 C8              11      RET Z
00031E 7D78 EDA2            16      INI
                                
000320 7D7A FB               4      EI
000321 7D7B 76               4      HALT
000322 7D7C DBFA            11      IN  A,(0FAH)    ;FDC μPD765A ステータスレジスタリード
000324 7D7E A3               4      AND E       ;NO SERVICE
000325 7D7F C8              11      RET Z
000326 7D80 EDA2            16      INI
                                
000328 7D82 FB               4      EI
000329 7D83 76               4      HALT
00032A 7D84 DBFA            11      IN  A,(0FAH)    ;FDC μPD765A ステータスレジスタリード
00032C 7D86 A3               4      AND E       ;NO SERVICE
00032D 7D87 C8              11      RET Z
00032E 7D88 EDA2            16      INI
                                
000330 7D8A FB               4      EI
000331 7D8B 76               4      HALT
000332 7D8C DBFA            11      IN  A,(0FAH)    ;FDC μPD765A ステータスレジスタリード
000334 7D8E A3               4      AND E       ;NO SERVICE
000335 7D8F C8              11      RET Z
000336 7D90 EDA2            16      INI
                                
000338 7D92 FB               4      EI
000339 7D93 76               4      HALT
00033A 7D94 DBFA            11      IN  A,(0FAH)    ;FDC μPD765A ステータスレジスタリード
00033C 7D96 A3               4      AND E       ;NO SERVICE
00033D 7D97 C8              11      RET Z
00033E 7D98 EDA2            16      INI
                                
000340 7D9A 20BE            12      JR  NZ,RDDISK1
000342 7D9C 15               4      DEC D
000343 7D9D C25A7D          10      JP  NZ,RDDISK1
000346 7DA0 C9              10      RET
                                
       7DA1                     WRDISK1:            ;高速化の為にループ展開x8
000347 7DA1 FB               4      EI
000348 7DA2 76               4      HALT
000349 7DA3 DBFA            11      IN  A,(0FAH)    ;FDC μPD765A ステータスレジスタリード
00034B 7DA5 A3               4      AND E
00034C 7DA6 C8              11      RET Z
00034D 7DA7 EDA3            16      OUTI
                                
00034F 7DA9 FB               4      EI
000350 7DAA 76               4      HALT
000351 7DAB DBFA            11      IN  A,(0FAH)    ;FDC μPD765A ステータスレジスタリード
000353 7DAD A3               4      AND E
000354 7DAE C8              11      RET Z
000355 7DAF EDA3            16      OUTI
                                
000357 7DB1 FB               4      EI
000358 7DB2 76               4      HALT
000359 7DB3 DBFA            11      IN  A,(0FAH)    ;FDC μPD765A ステータスレジスタリード
00035B 7DB5 A3               4      AND E
00035C 7DB6 C8              11      RET Z
00035D 7DB7 EDA3            16      OUTI
                                
00035F 7DB9 FB               4      EI
000360 7DBA 76               4      HALT
000361 7DBB DBFA            11      IN  A,(0FAH)    ;FDC μPD765A ステータスレジスタリード
000363 7DBD A3               4      AND E
000364 7DBE C8              11      RET Z
000365 7DBF EDA3            16      OUTI
                                
000367 7DC1 FB               4      EI
000368 7DC2 76               4      HALT
000369 7DC3 DBFA            11      IN  A,(0FAH)    ;FDC μPD765A ステータスレジスタリード
00036B 7DC5 A3               4      AND E
00036C 7DC6 C8              11      RET Z
00036D 7DC7 EDA3            16      OUTI
                                
00036F 7DC9 FB               4      EI
000370 7DCA 76               4      HALT
000371 7DCB DBFA            11      IN  A,(0FAH)    ;FDC μPD765A ステータスレジスタリード
000373 7DCD A3               4      AND E
000374 7DCE C8              11      RET Z
000375 7DCF EDA3            16      OUTI
                                
000377 7DD1 FB               4      EI
000378 7DD2 76               4      HALT
000379 7DD3 DBFA            11      IN  A,(0FAH)    ;FDC μPD765A ステータスレジスタリード
00037B 7DD5 A3               4      AND E
00037C 7DD6 C8              11      RET Z
00037D 7DD7 EDA3            16      OUTI
                                
00037F 7DD9 FB               4      EI
000380 7DDA 76               4      HALT
000381 7DDB DBFA            11      IN  A,(0FAH)    ;FDC μPD765A ステータスレジスタリード
000383 7DDD A3               4      AND E
000384 7DDE C8              11      RET Z
000385 7DDF EDA3            16      OUTI
                                
000387 7DE1 20BE            12      JR  NZ,WRDISK1
000389 7DE3 15               4      DEC D
00038A 7DE4 C2A17D          10      JP  NZ,WRDISK1
00038D 7DE7 C9              10      RET
                                
       7DE8                     RESULTEX:
00038E 7DE8 3A367E          13      LD  A,(S_CMD_STATUS)
000391 7DEB 3C               4      INC A
000392 7DEC 2803            12      JR  Z,RESULTEX1
000394 7DEE 3A2C7E          13      LD  A,(S_PARAMS+6)  ;バイト数H
       7DF1                     RESULTEX1:
000397 7DF1 DF              12      RST 18H
000398 7DF2 C32A00          10      JP  MAIN
                                
       7DF5                     CHECKRESULT:
00039B 7DF5 C5              11      PUSH    BC
00039C 7DF6 CD1C7E          17      CALL    RDFDC       ;ST0
00039F 7DF9 E6D8             7      AND 0D8H
0003A1 7DFB 4F               4      LD  C,A
0003A2 7DFC CD1C7E          17      CALL    RDFDC       ;ST1
0003A5 7DFF E6B7             7      AND 0B7H
0003A7 7E01 B1               4      OR  C
0003A8 7E02 4F               4      LD  C,A
0003A9 7E03 CD1C7E          17      CALL    RDFDC       ;ST2
0003AC 7E06 E673             7      AND 073H
0003AE 7E08 B1               4      OR  C
0003AF 7E09 4F               4      LD  C,A
0003B0 7E0A 0604             7      LD  B,4
       7E0C                     CHECKRESULT1:           ;C H R N
0003B2 7E0C CD1C7E          17      CALL    RDFDC
0003B5 7E0F 10FB            13      DJNZ    CHECKRESULT1
0003B7 7E11 79               4      LD  A,C
0003B8 7E12 A7               4      AND A
0003B9 7E13 C1              10      POP BC
0003BA 7E14 C8              11      RET Z
0003BB 7E15 37               4      SCF
0003BC 7E16 C9              10      RET
                                
       7E17                     GETDEVSTAT:
0003BD 7E17 3E04             7      LD  A,4
0003BF 7E19 E7              12      RST 20H
0003C0 7E1A 79               4      LD  A,C
0003C1 7E1B E7              12      RST 20H
                                
       7E1C                     RDFDC:
0003C2 7E1C DBFA            11      IN  A,(0FAH)    ;FDC μPD765A ステータスレジスタリード
0003C4 7E1E 2F               4      CPL
0003C5 7E1F E6C0             7      AND 0C0H        ;RQMとDIOが両方1になるまで待つ
0003C7 7E21 20F9            12      JR  NZ,RDFDC
0003C9 7E23 DBFB            11      IN  A,(0FBH)    ;FDC μPD765A データレジスタリード
0003CB 7E25 C9              10      RET
                                
       7E26                     S_PARAMS:
0003CC 7E26                         DS  16
       7E36                     S_CMD_STATUS:
0003DC 7E36 00                      DB  0
       7E37                     S_LEFT:
0003DD 7E37 00                      DB  0
       7E38                     S_WKF4:
0003DE 7E38 00                      DB  0
                                
0003DF D0D8                         ORG $$+OFFSET   ;$DEPHASE
       D0D8                     AT_DSSE:
       D0D8                     INITE:
0003DF D0D8                         DS  BDOS-INITE
00040D D106 C331D9          10      JP  BDOS_RF
[EOF:88SUB.ASM:SHIFT_JIS]
                                    INCLUDE "88CCP.ASM"
                                
                                ;   LSX-Dodgers CCP
                                ;   PC-8801mkIISR
                                
       D109                     WBOOT1:
000410 D109 ED7B0600        20      LD  SP,(SYSTEM+1)
000414 D10D DB32            11      IN  A,(032H)
000416 D10F F610             7      OR  10H     ;高速RAMアクセスモードOFF
000418 D111 D332            11      OUT (032H),A
                                
00041A D113 3EEE             7      LD  A,IVRTC/256
00041C D115 ED47             9      LD  I,A
00041E D117 3AB8EF          13      LD  A,(WKE6)
000421 D11A F602             7      OR  2       ;VRTC割り込みマスク
000423 D11C D3E6            11      OUT (0E6H),A    ;割り込みマスク
000425 D11E 32B8EF          13      LD  (WKE6),A
000428 D121 3AB7EF          13      LD  A,(WKE4)
00042B D124 D3E4            11      OUT (0E4H),A    ;割り込みレベル設定 
                                
00042D D126 FB               4      EI
00042E D127 2192EF          10      LD  HL,_KEYD
000431 D12A 3600            10      LD  (HL),0
000433 D12C CD94DD          17      CALL    CHKEY
000436 D12F CD87D9          17      CALL    KEYBC_IFBREAK
000439 D132 3E04             7      LD  A,4
00043B D134 CD9AD9          17      CALL    MSG_A
[EOF:88CCP.ASM:SHIFT_JIS]
                                    INCLUDE "LDCCP.ASM"
                                
                                ;   LSX-Dodgers CCP
                                
       D137                     COMMAND:
00043E D137 3A66F1          13      LD  A,(FCB_BAT)
000441 D13A B7               4      OR  A
000442 D13B C27CD2          10      JP  NZ,C_BAT1
000445 D13E CDF1D1          17      CALL    SETDTA1
000448 D141 3A87EF          13      LD  A,(_DVSW)
00044B D144 C641             7      ADD A,'A'
00044D D146 CD9AD9          17      CALL    MSG_A
000450 D149 3E3E             7      LD  A,'>'
000452 D14B CD9AD9          17      CALL    MSG_A
000455 D14E 3E50             7      LD  A,80
000457 D150 12               7      LD  (DE),A
000458 D151 CDD8D9          17      CALL    _SYS0A      ;(BDOS)文字列入力
00045B D154 CD7FD3          17      CALL    LTNL
       D157                     COMMAND2:
00045E D157 118200          10      LD  DE,DTA1+2
000461 D15A CDFDEF          17      CALL    _COMANL
000464 D15D 30D8            12      JR  NC,COMMAND
000466 D15F 1179EF          10      LD  DE,COMERM
000469 D162 CD9BD6          17      CALL    _SYS09      ;(BDOS)文字列出力
00046C D165 C7              12      RST 0
                                
       D166                     COMANL:
00046D D166 CD8FDE          17      CALL    FILE
000470 D169 3A19EF          13      LD  A,(FNAME+4)
000473 D16C FE20             7      CP  020H
000475 D16E 201C            12      JR  NZ,COMB2
000477 D170 D5              11      PUSH    DE
000478 D171 1115EF          10      LD  DE,FNAME
00047B D174 1A               7      LD  A,(DE)
00047C D175 FE20             7      CP  020H
00047E D177 2844            12      JR  Z,SDVSW
000480 D179 1B               6      DEC DE
000481 D17A 1A               7      LD  A,(DE)
000482 D17B C6FF             7      ADD A,0FFH
000484 D17D 3809            12      JR  C,COMB
000486 D17F 13               6      INC DE
                                
000487 D180 21EDD5          10      LD  HL,COMTB
00048A D183 0609             7      LD  B,COMS
00048C D185 CD13E1          17      CALL    CPNAME
       D188                     COMB:
00048F D188 D1              10      POP DE
000490 D189 D20F00          10      JP  NC,JP_HL
       D18C                     COMB2:
000493 D18C EB               4      EX  DE,HL
000494 D18D 2259D2          16      LD  (COMPAT+1),HL
000497 D190 F5              11      PUSH    AF
000498 D191 CD11D2          17      CALL    CEXE4
00049B D194 F1              10      POP AF
00049C D195 2115EF          10      LD  HL,FNAME
00049F D198 116D00          10      LD  DE,FCB2+1   ;COMMAND NAME
0004A2 D19B 010B00          10      LD  BC,11
0004A5 D19E EDB0                    LDIR
0004A7 D1A0 1100F1          10      LD  DE,PATHD
       D1A3                     CEX1:
0004AA D1A3 1A               7      LD  A,(DE)
0004AB D1A4 FE20             7      CP  020H
0004AD D1A6 D8              11      RET C
0004AE D1A7 CD84DE          17      CALL    FILEC
0004B1 D1AA D5              11      PUSH    DE
0004B2 D1AB 216D00          10      LD  HL,FCB2+1   ;COMMAND NAME
0004B5 D1AE 1115EF          10      LD  DE,FNAME
0004B8 D1B1 010B00          10      LD  BC,11
0004BB D1B4 EDB0                    LDIR
0004BD D1B6 CD11D2          17      CALL    CEXE4
0004C0 D1B9 D1              10      POP DE
0004C1 D1BA 13               6      INC DE
0004C2 D1BB 18E6            12      JR  CEX1
                                
       D1BD                     SDVSW:
0004C4 D1BD F1              10      POP AF
0004C5 D1BE 3A14EF          13      LD  A,(FDRV)
0004C8 D1C1 3D               4      DEC A
0004C9 D1C2 5F               4      LD  E,A
0004CA D1C3 0E0E             7      LD  C,00EH      ;(BDOS)カレントドライブの設定
0004CC D1C5 1831            12      JR  SYSTEM0
                                
       D1C7                     OPEN1:
0004CE D1C7 2114EF          10      LD  HL,FDRV
       D1CA                     OPEN:
0004D1 D1CA 0E11             7      LD  C,011H      ;(BDOS)ファイルの検索
       D1CC                     OPEN3:
0004D3 D1CC D5              11      PUSH    DE
0004D4 D1CD 1141F1          10      LD  DE,DTA_CCP
0004D7 D1D0 CDEED1          17      CALL    SETDTA
0004DA D1D3 EB               4      EX  DE,HL
0004DB D1D4 CDF8D1          17      CALL    SYSTEM0
0004DE D1D7 D1              10      POP DE
0004DF D1D8 C9              10      RET
                                
       D1D9                     OPEN2:
0004E0 D1D9 0E12             7      LD  C,012H
0004E2 D1DB 18EF            12      JR  OPEN3
                                
       D1DD                     DEFCB:              ;Z=Ok NZ=Error
0004E4 D1DD 1141F1          10      LD  DE,DTA_CCP
0004E7 D1E0 CDF6D1          17      CALL    SYSC0F
                                
0004EA D1E3 1162F1          10      LD  DE,DTA_CCP+33   ;(FCB)ランダムレコード
0004ED D1E6 0604             7      LD  B,4
0004EF D1E8 CDBDD4          17      CALL    ZERO_MEMORY_DE
       D1EB                     SETDTA100:
0004F2 D1EB 110001          10      LD  DE,00100H
       D1EE                     SETDTA:
0004F5 D1EE C373D8          10      JP  _SYS1A      ;(BDOS)DTAの設定
                                
       D1F1                     SETDTA1:
0004F8 D1F1 118000          10      LD  DE,DTA1
0004FB D1F4 18F8            12      JR  SETDTA
                                
       D1F6                     SYSC0F:
0004FD D1F6 0E0F             7      LD  C,00FH      ;(BDOS)ファイルのオープン
       D1F8                     SYSTEM0:
0004FF D1F8 CD0500          17      CALL    SYSTEM
000502 D1FB B7               4      OR  A
000503 D1FC C9              10      RET
                                
       D1FD                     C_CD:
000504 D1FD 0E5A             7      LD  C,5AH
000506 D1FF 18F7            12      JR  SYSTEM0
                                
       D201                     S27BUF:
000508 D201 3A0700          13      LD  A,(SYSTEM+2)
00050B D204 3D               4      DEC A
00050C D205 E6F8             7      AND 0F8H
00050E D207 67               4      LD  H,A
00050F D208 2E00             7      LD  L,0
       D20A                     S27DTA:
000511 D20A 1141F1          10      LD  DE,DTA_CCP
       D20D                     S27:
000514 D20D 0E27             7      LD  C,027H      ;(BDOS)ランダムブロック読み込み
000516 D20F 18E7            12      JR  SYSTEM0
                                
       D211                     CEXE4:
000518 D211 211DEF          10      LD  HL,FNAME+8
00051B D214 7E               7      LD  A,(HL)
00051C D215 FE20             7      CP  020H
00051E D217 2007            12      JR  NZ,CEXE7
000520 D219 3E3F             7      LD  A,'?'
000522 D21B 77               7      LD  (HL),A
000523 D21C 23               6      INC HL
000524 D21D 77               7      LD  (HL),A
000525 D21E 23               6      INC HL
000526 D21F 77               7      LD  (HL),A
       D220                     CEXE7:
000527 D220 CDC7D1          17      CALL    OPEN1
       D223                     CEXE5:
00052A D223 C0              11      RET NZ
00052B D224 2A4BF1          16      LD  HL,(DTA_CCP+1+9)
00052E D227 7C               4      LD  A,H
00052F D228 CD9BE1          17      CALL    CAP
000532 D22B 67               4      LD  H,A
000533 D22C 7D               4      LD  A,L
000534 D22D CD9BE1          17      CALL    CAP
000537 D230 6F               4      LD  L,A
000538 D231 3A4AF1          13      LD  A,(DTA_CCP+1+8)
00053B D234 CD9BE1          17      CALL    CAP
00053E D237 D642             7      SUB 'B'
000540 D239 282C            12      JR  Z,C_BAT
000542 D23B 3D               4      DEC A       ;'C'
000543 D23C 2805            12      JR  Z,C_EXE
       D23E                     CEXE6:
000545 D23E CDD9D1          17      CALL    OPEN2
000548 D241 18E0            12      JR  CEXE5
                                
       D243                     C_EXE:
00054A D243 7C               4      LD  A,H
00054B D244 FE4D             7      CP  'M'
00054D D246 20F6            12      JR  NZ,CEXE6
                                
00054F D248 CDDDD1          17      CALL    DEFCB
000552 D24B CD01D2          17      CALL    S27BUF
000555 D24E 3D               4      DEC A
000556 D24F 37               4      SCF
000557 D250 C0              11      RET NZ
000558 D251 7C               4      LD  A,H
000559 D252 B5               4      OR  L
00055A D253 37               4      SCF
00055B D254 C8              11      RET Z
00055C D255 CDF1D1          17      CALL    SETDTA1
00055F D258 110000          10  COMPAT: LD  DE,0                ; self-modifying code
000562 D25B ED7B0600        20      LD  SP,(SYSTEM+1)
000566 D25F 67               4      LD  H,A             ; A=0 in SETDTA1(_SYS1A)
000567 D260 6F               4      LD  L,A
000568 D261 E5              11      PUSH    HL              ; push $0000 (reboot address)
000569 D262 24               4      INC H
00056A D263 E5              11      PUSH    HL              ; push $0100 (TPA address)
00056B D264 C388D4          10      JP  SETFCB              ; and JP $0100
                                
       D267                     C_BAT:
00056E D267 114154          10      LD  DE,'A'+'T'*256
000571 D26A ED52            15      SBC HL,DE
000573 D26C 20D0            12      JR  NZ,CEXE6
                                
000575 D26E CDDDD1          17      CALL    DEFCB
                                
000578 D271 2141F1          10      LD  HL,DTA_CCP
00057B D274 1166F1          10      LD  DE,FCB_BAT
00057E D277 012500          10      LD  BC,37
000581 D27A EDB0                    LDIR
       D27C                     C_BAT1:
000583 D27C CDEBD1          17      CALL    SETDTA100
000586 D27F CDB3D2          17      CALL    FGETC_BAT
000589 D282 218100          10      LD  HL,DTA1+1
00058C D285 2025            12      JR  NZ,END_BATCH
00058E D287 FE21             7      CP  021H        ;スペースや改行など制御文字を飛ばす
000590 D289 38F1            12      JR  C,C_BAT1
000592 D28B 3620            10      LD  (HL),' '
000594 D28D 23               6      INC HL
       D28E                     C_BAT2:
000595 D28E 77               7      LD  (HL),A
000596 D28F 23               6      INC HL
000597 D290 7D               4      LD  A,L
000598 D291 3C               4      INC A       ;L==0FFH
000599 D292 2809            12      JR  Z,RUN_BATCH
00059B D294 CDB3D2          17      CALL    FGETC_BAT
00059E D297 2004            12      JR  NZ,RUN_BATCH
0005A0 D299 FE20             7      CP  020H
0005A2 D29B 30F1            12      JR  NC,C_BAT2
       D29D                     RUN_BATCH:
0005A4 D29D 7D               4      LD  A,L
0005A5 D29E D67F             7      SUB DTA1-1
0005A7 D2A0 328000          13      LD  (DTA1),A
0005AA D2A3 FE04             7      CP  4
0005AC D2A5 3805            12      JR  C,END_BATCH
0005AE D2A7 3600            10      LD  (HL),0
0005B0 D2A9 C357D1          10      JP  COMMAND2
       D2AC                     END_BATCH:
0005B3 D2AC AF               4      XOR A       ;バッチファイルを閉じる
0005B4 D2AD 3266F1          13      LD  (FCB_BAT),A
0005B7 D2B0 C300EF          10      JP  CPM_BOOT
                                
       D2B3                     FGETC_BAT:
0005BA D2B3 1166F1          10      LD  DE,FCB_BAT
       D2B6                     FGETC:              ;1文字ずつ読み込む
0005BD D2B6 E5              11      PUSH    HL      ;Z:成功
0005BE D2B7 210100          10      LD  HL,1
0005C1 D2BA CD0DD2          17      CALL    S27
0005C4 D2BD E1              10      POP HL
0005C5 D2BE 3A0001          13      LD  A,(00100H)
0005C8 D2C1 C9              10      RET
                                
       D2C2                     C_DEL:
0005C9 D2C2 CD88D4          17      CALL    SETFCB
0005CC D2C5 CDB0D9          17      CALL    _SYS08      ;(BDOS)エコーなしコンソール入力
                                
0005CF D2C8 0E13             7      LD  C,013H
0005D1 D2CA 180A            12      JR  CDEL1       ;(BDOS)ファイルの削除
                                
       D2CC                     C_REN:
0005D3 D2CC CD88D4          17      CALL    SETFCB
0005D6 D2CF 3E10             7      LD  A,010H      ;ディレクトリも対象にする
0005D8 D2D1 326900          13      LD  (FCB1+13),A ;属性
0005DB D2D4 0E17             7      LD  C,017H      ;(BDOS)ファイル名の変更
       D2D6                     CDEL1:
0005DD D2D6 115C00          10      LD  DE,FCB1
0005E0 D2D9 CD0500          17      CALL    SYSTEM
0005E3 D2DC C6FF             7      ADD A,0FFH
0005E5 D2DE C9              10      RET
                                
       D2DF                     C_DIR:
0005E6 D2DF CD84DE          17      CALL    FILEC
0005E9 D2E2 2115EF          10      LD  HL,FDRV+1
0005EC D2E5 CDD3D5          17      CALL    CWILD1
0005EF D2E8 3EF1             7      LD  A,0F1H
0005F1 D2EA 3221EF          13      LD  (FDRV+13),A
0005F4 D2ED CDC7D1          17      CALL    OPEN1
       D2F0                     CDIR1:
0005F7 D2F0 B7               4      OR  A
0005F8 D2F1 2008            12      JR  NZ,PDSKF
0005FA D2F3 CD3ED3          17      CALL    P_NAME
0005FD D2F6 CDD9D1          17      CALL    OPEN2
000600 D2F9 18F5            12      JR  CDIR1
                                
       D2FB                     PDSKF:
000602 D2FB 3A14EF          13      LD  A,(FDRV)
000605 D2FE 5F               4      LD  E,A
000606 D2FF 0E1B             7      LD  C,01BH      ;(BDOS)ディスク情報の獲得
000608 D301 CD0500          17      CALL    SYSTEM
00060B D304 4F               4      LD  C,A     ;C←1クラスタ辺りの論理セクタ数
00060C D305 C601             7      ADD A,001H
00060E D307 D8              11      RET C       ;Aが0FFHだった場合
00060F D308 3E06             7      LD  A,8-2
       D30A                     PDS1:               ;HL=未使用クラスタの総数
000611 D30A 3C               4      INC A
000612 D30B CB19             8      RR  C
000614 D30D 30FB            12      JR  NC,PDS1
       D30F                     PDS2:               ;B←論理セクタのサイズの上位8ビット
000616 D30F 3C               4      INC A
000617 D310 CB18             8      RR  B
000619 D312 30FB            12      JR  NC,PDS2
00061B D314 47               4      LD  B,A
                                
00061C D315 110000          10      LD  DE,0
       D318                     PDS3:
00061F D318 29              11      ADD HL,HL
000620 D319 EB               4      EX  DE,HL
000621 D31A ED6A            15      ADC HL,HL
000623 D31C EB               4      EX  DE,HL
000624 D31D 10F9            13      DJNZ    PDS3
       D31F                     PDSKF1:
000626 D31F CDB7D3          17      CALL    PRDEC_DEHL
000629 D322 118BF1          10      LD  DE,FREE
00062C D325 CD9BD6          17      CALL    _SYS09      ;(BDOS)文字列出力
00062F D328 CDA6D3          17      CALL    PUTDRV
000632 D32B 3E5C             7      LD  A,05CH      ;\
000634 D32D CD9AD9          17      CALL    MSG_A
000637 D330 2A22EF          16      LD  HL,(FDRV+14)    ;ディレクトリのクラスタ番号
00063A D333 AF               4      XOR A
00063B D334 11FEFF          10      LD  DE,0-2
00063E D337 19              11      ADD HL,DE
00063F D338 23               6      INC HL
000640 D339 DCB3D3          17      CALL    C,PRDEC_HL
000643 D33C 1841            12      JR  LTNL
                                
       D33E                     P_NAME:
000645 D33E 3A42F1          13      LD  A,(DTA_CCP+1)
000648 D341 FE2E             7      CP  '.'
00064A D343 C8              11      RET Z
00064B D344 11E9D5          10      LD  DE,DIRHD
00064E D347 CD9BD6          17      CALL    _SYS09      ;(BDOS)文字列出力
000651 D34A 3A4DF1          13      LD  A,(DTA_CCP+1+00BH)
000654 D34D F5              11      PUSH    AF
000655 D34E 0F               4      RRCA
000656 D34F 9F               4      SBC A,A
000657 D350 E60A             7      AND '*'-020H
000659 D352 C620             7      ADD A,020H
00065B D354 CD9AD9          17      CALL    MSG_A
00065E D357 CDA6D3          17      CALL    PUTDRV
000661 D35A 2142F1          10      LD  HL,DTA_CCP+1
000664 D35D CDF7D3          17      CALL    FPRNT
                                
000667 D360 F1              10      POP AF
000668 D361 CB67             8      BIT 4,A
00066A D363 2808            12      JR  Z,DIR3
00066C D365 11DED5          10      LD  DE,DIRMES
00066F D368 CD9BD6          17      CALL    _SYS09      ;(BDOS)文字列出力
000672 D36B 180A            12      JR  DIR6
       D36D                     DIR3:
000674 D36D ED5B60F1        20      LD  DE,(DTA_CCP+1+01EH)
000678 D371 2A5EF1          16      LD  HL,(DTA_CCP+1+01CH)
00067B D374 CDB7D3          17      CALL    PRDEC_DEHL
       D377                     DIR6:
00067E D377 3AB1EF          13      LD  A,(_WIDTH)
000681 D37A FE29             7      CP  40+1
000683 D37C D419D4          17      CALL    NC,PRTTMS
                                
       D37F                     LTNL:
000686 D37F 1E03             7      LD  E,3
000688 D381 C3CDEF          10      JP  _PRINT
                                
       D384                     C_PATH:
00068B D384 CD66DF          17      CALL    SPCUT
00068E D387 2100F1          10      LD  HL,PATHD
000691 D38A FE21             7      CP  021H
000693 D38C 300C            12      JR  NC,CPATH0
       D38E                     CPATHP:
000695 D38E 7E               7      LD  A,(HL)
000696 D38F 23               6      INC HL
000697 D390 FE20             7      CP  020H
000699 D392 3F               4      CCF
00069A D393 30EA            12      JR  NC,LTNL
00069C D395 CD9AD9          17      CALL    MSG_A
00069F D398 18F4            12      JR  CPATHP
       D39A                     CPATH0:
0006A1 D39A FE3B             7      CP  ';'
0006A3 D39C 2001            12      JR  NZ,CPATH1
0006A5 D39E 13               6      INC DE
       D39F                     CPATH1:
0006A6 D39F EB               4      EX  DE,HL
0006A7 D3A0 014000          10      LD  BC,PATHX
0006AA D3A3 EDB0                    LDIR
0006AC D3A5 C9              10      RET
                                
       D3A6                     PUTDRV:
0006AD D3A6 3A14EF          13      LD  A,(FDRV)
0006B0 D3A9 C640             7      ADD A,'A'-1
0006B2 D3AB CD9AD9          17      CALL    MSG_A
0006B5 D3AE 3E3A             7      LD  A,':'
       D3B0                     MSG_AR:
0006B7 D3B0 C39AD9          10      JP  MSG_A
                                
       D3B3                     PRDEC_HL:
0006BA D3B3 AF               4      XOR A
       D3B4                     PRDEC_AHL:
0006BB D3B4 5F               4      LD  E,A
0006BC D3B5 1600             7      LD  D,0
       D3B7                     PRDEC_DEHL:
0006BE D3B7 D5              11      PUSH    DE
0006BF D3B8 110FEF          10      LD  DE,DECBF
0006C2 D3BB 0605             7      LD  B,5
0006C4 D3BD CDBDD4          17      CALL    ZERO_MEMORY_DE  ;A=0
0006C7 D3C0 D1              10      POP DE
                                
0006C8 D3C1 0E20             7      LD  C,32
       D3C3                     DEC1:
0006CA D3C3 29              11      ADD HL,HL
0006CB D3C4 EB               4      EX  DE,HL
0006CC D3C5 ED6A            15      ADC HL,HL
0006CE D3C7 EB               4      EX  DE,HL
0006CF D3C8 E5              11      PUSH    HL
0006D0 D3C9 2113EF          10      LD  HL,DECBF+4
0006D3 D3CC 0605             7      LD  B,5
       D3CE                     DEC2:
0006D5 D3CE 7E               7      LD  A,(HL)
0006D6 D3CF 8F               4      ADC A,A
0006D7 D3D0 27               4      DAA
0006D8 D3D1 77               7      LD  (HL),A
0006D9 D3D2 2B               6      DEC HL
0006DA D3D3 10F9            13      DJNZ    DEC2
0006DC D3D5 E1              10      POP HL
0006DD D3D6 0D               4      DEC C
0006DE D3D7 20EA            12      JR  NZ,DEC1
                                
0006E0 D3D9 210FEF          10      LD  HL,DECBF
0006E3 D3DC 3E20             7      LD  A,020H
0006E5 D3DE 0604             7      LD  B,4
       D3E0                     DEC3:
0006E7 D3E0 CDEDD3          17      CALL    DEC4
0006EA D3E3 CDEDD3          17      CALL    DEC4
0006ED D3E6 23               6      INC HL
0006EE D3E7 10F7            13      DJNZ    DEC3
       D3E9                     DECX:
0006F0 D3E9 CDEDD3          17      CALL    DEC4
0006F3 D3EC AF               4      XOR A
       D3ED                     DEC4:
0006F4 D3ED ED6F            18      RLD
0006F6 D3EF FE20             7      CP  020H
0006F8 D3F1 2802            12      JR  Z,DEC5
0006FA D3F3 F630             7      OR  030H
       D3F5                     DEC5:
0006FC D3F5 18B9            12      JR  MSG_AR
                                
       D3F7                     FPRNT:
0006FE D3F7 0608             7      LD  B,8
000700 D3F9 CD0AD4          17      CALL    P_N1
000703 D3FC 7E               7      LD  A,(HL)
000704 D3FD C680             7      ADD A,0A0H-020H
000706 D3FF FEA0             7      CP  0A0H
000708 D401 2802            12      JR  Z,FPR1
00070A D403 3E2E             7      LD  A,'.'
       D405                     FPR1:
00070C D405 CD9AD9          17      CALL    MSG_A
00070F D408 0603             7      LD  B,3
                                
       D40A                     P_N1:
000711 D40A C5              11      PUSH    BC
000712 D40B E5              11      PUSH    HL
000713 D40C 7E               7      LD  A,(HL)
000714 D40D CDA7E1          17      CALL    CAP3
000717 D410 CD9AD9          17      CALL    MSG_A
00071A D413 E1              10      POP HL
00071B D414 C1              10      POP BC
00071C D415 23               6      INC HL
00071D D416 10F2            13      DJNZ    P_N1
00071F D418 C9              10      RET
                                
       D419                     PRTTMS:
000720 D419 3E20             7      LD  A,020H
000722 D41B CD9AD9          17      CALL    MSG_A
                                
000725 D41E 2A5AF1          16      LD  HL,(DTA_CCP+1+24)
000728 D421 7D               4      LD  A,L
000729 D422 B7               4      OR  A
00072A D423 C8              11      RET Z
00072B D424 CB3C             8      SRL H
00072D D426 17               4      RLA
00072E D427 17               4      RLA
00072F D428 17               4      RLA
000730 D429 17               4      RLA
000731 D42A E60F             7      AND 00FH
000733 D42C 57               4      LD  D,A
000734 D42D 7C               4      LD  A,H
000735 D42E C650             7      ADD A,80
000737 D430 CD73D4          17      CALL    PRDEC_A
00073A D433 3E2D             7      LD  A,'-'
00073C D435 CD9AD9          17      CALL    MSG_A
00073F D438 7A               4      LD  A,D
000740 D439 CD73D4          17      CALL    PRDEC_A
000743 D43C 3E2D             7      LD  A,'-'
000745 D43E CD9AD9          17      CALL    MSG_A
000748 D441 7D               4      LD  A,L
000749 D442 E61F             7      AND 01FH
00074B D444 CD73D4          17      CALL    PRDEC_A
                                
00074E D447 2A58F1          16      LD  HL,(DTA_CCP+1+22)
                                
000751 D44A 3E20             7      LD  A,020H
000753 D44C CD9AD9          17      CALL    MSG_A
000756 D44F 7C               4      LD  A,H
000757 D450 65               4      LD  H,L
000758 D451 0603             7      LD  B,3
       D453                     PRTTMS1:
00075A D453 1F               4      RRA
00075B D454 CB1D             8      RR  L
00075D D456 10FB            13      DJNZ    PRTTMS1
00075F D458 E61F             7      AND 01FH
000761 D45A CD73D4          17      CALL    PRDEC_A
000764 D45D 3E3A             7      LD  A,':'
000766 D45F CD9AD9          17      CALL    MSG_A
000769 D462 7D               4      LD  A,L
00076A D463 0F               4      RRCA
00076B D464 0F               4      RRCA
00076C D465 E63F             7      AND 03FH
00076E D467 CD73D4          17      CALL    PRDEC_A
000771 D46A 3E3A             7      LD  A,':'
000773 D46C CD9AD9          17      CALL    MSG_A
000776 D46F 7C               4      LD  A,H
000777 D470 E61F             7      AND 01FH
000779 D472 87               4      ADD A,A
                                
                                ;   PRINT10
                                
       D473                     PRDEC_A:
00077A D473 E5              11      PUSH    HL
00077B D474 0608             7      LD  B,8
00077D D476 4F               4      LD  C,A
00077E D477 AF               4      XOR A
       D478                     PRTA1:
00077F D478 CB01             4      RLC C
000781 D47A 8F               4      ADC A,A
000782 D47B 27               4      DAA
000783 D47C 10FA            13      DJNZ    PRTA1
000785 D47E 210FEF          10      LD  HL,DECBF
000788 D481 77               7      LD  (HL),A
000789 D482 AF               4      XOR A
00078A D483 CDE9D3          17      CALL    DECX
00078D D486 E1              10      POP HL
00078E D487 C9              10      RET
                                
       D488                     SETFCB:
00078F D488 CD66DF          17      CALL    SPCUT
000792 D48B 1A               7      LD  A,(DE)
000793 D48C FE20             7      CP  020H
000795 D48E 3801            12      JR  C,SETFCBA
000797 D490 1B               6      DEC DE
       D491                     SETFCBA:
000798 D491 0624             7      LD  B,36
00079A D493 215C00          10      LD  HL,FCB1
00079D D496 E5              11      PUSH    HL
00079E D497 AF               4      XOR A
00079F D498 CD3BDF          17      CALL    FILL_MEMORY
0007A2 D49B E1              10      POP HL
0007A3 D49C D5              11      PUSH    DE
0007A4 D49D CDD9D8          17      CALL    _SYS5C      ;(BDOS)ファイル名の解析
0007A7 D4A0 216C00          10      LD  HL,FCB2
0007AA D4A3 CDD9D8          17      CALL    _SYS5C      ;(BDOS)ファイル名の解析
0007AD D4A6 E1              10      POP HL
0007AE D4A7 010050          10      LD  BC,05000H
0007B1 D4AA 118100          10      LD  DE,00081H
       D4AD                     SETFCB1:
0007B4 D4AD 7E               7      LD  A,(HL)
0007B5 D4AE 23               6      INC HL
0007B6 D4AF FE20             7      CP  020H
0007B8 D4B1 3805            12      JR  C,SETFCB2
0007BA D4B3 12               7      LD  (DE),A
0007BB D4B4 13               6      INC DE
0007BC D4B5 0C               4      INC C
0007BD D4B6 10F5            13      DJNZ    SETFCB1
       D4B8                     SETFCB2:
0007BF D4B8 79               4      LD  A,C
0007C0 D4B9 328000          13      LD  (DTA1),A
0007C3 D4BC 04               4      INC B
       D4BD                     ZERO_MEMORY_DE:
0007C4 D4BD AF               4      XOR A
       D4BE                     FILL_MEMORY_DE:
0007C5 D4BE 12               7      LD  (DE),A
0007C6 D4BF 13               6      INC DE
0007C7 D4C0 10FC            13      DJNZ    FILL_MEMORY_DE
0007C9 D4C2 C9              10      RET
                                
       D4C3                     C_COPY:
0007CA D4C3 CD88D4          17      CALL    SETFCB
                                
0007CD D4C6 1161EF          10      LD  DE,ZERO
0007D0 D4C9 CD87DE          17      CALL    FILEC2
0007D3 D4CC 216C00          10      LD  HL,FCB2
0007D6 D4CF CDE0D8          17      CALL    S29X1
                                
0007D9 D4D2 3E10             7      LD  A,010H
0007DB D4D4 326900          13      LD  (FCB1+13),A
0007DE D4D7 216D00          10      LD  HL,FCB2+1
0007E1 D4DA CDD3D5          17      CALL    CWILD1
       D4DD                     COPY0:
0007E4 D4DD CDD0D5          17      CALL    CWILD
0007E7 D4E0 215C00          10      LD  HL,FCB1
0007EA D4E3 CDCAD1          17      CALL    OPEN
0007ED D4E6 37               4      SCF
       D4E7                     COPY1:
0007EE D4E7 C0              11      RET NZ
0007EF D4E8 CDDDD1          17      CALL    DEFCB
                                
0007F2 D4EB 3A4EF1          13      LD  A,(DTA_CCP+13)
0007F5 D4EE CB67             8      BIT 4,A
0007F7 D4F0 2821            12      JR  Z,COPY1A
                                
0007F9 D4F2 215D00          10      LD  HL,FCB1+1
0007FC D4F5 CDCAE2          17      CALL    CHKWILD
0007FF D4F8 3814            12      JR  C,COPY9
                                
000801 D4FA 3E20             7      LD  A,020H
000803 D4FC 325D00          13      LD  (FCB1+1),A
000806 D4FF 2A5BF1          16      LD  HL,(DTA_CCP+26)
000809 D502 23               6      INC HL
00080A D503 226A00          16      LD  (FCB1+14),HL
00080D D506 18D5            12      JR  COPY0
                                
       D508                     COPY8:
00080F D508 CD9BD6          17      CALL    _SYS09      ;(BDOS)文字列出力
000812 D50B CD7FD3          17      CALL    LTNL
       D50E                     COPY9:
000815 D50E CDD9D1          17      CALL    OPEN2
000818 D511 18D4            12      JR  COPY1
                                
       D513                     COPY1A:
00081A D513 216C00          10      LD  HL,FCB2
00081D D516 1114EF          10      LD  DE,FDRV
000820 D519 0143F1          10      LD  BC,DTA_CCP+2
000823 D51C EDA0            16      LDI
000825 D51E 3E0B             7      LD  A,11
       D520                     COPY2:
000827 D520 F5              11      PUSH    AF
000828 D521 7E               7      LD  A,(HL)
000829 D522 FE3F             7      CP  '?'
00082B D524 2001            12      JR  NZ,COPY3
00082D D526 0A               7      LD  A,(BC)
       D527                     COPY3:
00082E D527 12               7      LD  (DE),A
00082F D528 03               6      INC BC
000830 D529 13               6      INC DE
000831 D52A 23               6      INC HL
000832 D52B F1              10      POP AF
000833 D52C 3D               4      DEC A
000834 D52D 20F1            12      JR  NZ,COPY2
000836 D52F 010500          10      LD  BC,16-11
000839 D532 EDB0                    LDIR
       D534                     PUTNAME:
00083B D534 215D00          10      LD  HL,FCB1+1
00083E D537 CDCAE2          17      CALL    CHKWILD
000841 D53A 300B            12      JR  NC,PUTN1
000843 D53C 2115EF          10      LD  HL,FDRV+1
000846 D53F CDF7D3          17      CALL    FPRNT
000849 D542 3E20             7      LD  A,020H
00084B D544 CD9AD9          17      CALL    MSG_A
       D547                     PUTN1:
00084E D547 1114EF          10      LD  DE,FDRV
000851 D54A 0E16             7      LD  C,016H      ;(BDOS)ファイルの作成
000853 D54C CDF8D1          17      CALL    SYSTEM0
000856 D54F 2048            12      JR  NZ,COPYE2
000858 D551 67               4      LD  H,A     ;A=0
000859 D552 6F               4      LD  L,A
00085A D553 2235EF          16      LD  (FDRV+33),HL    ;(FCB)ランダムレコード
00085D D556 2237EF          16      LD  (FDRV+35),HL
       D559                     COPY6:
000860 D559 CD01D2          17      CALL    S27BUF
000863 D55C 47               4      LD  B,A
000864 D55D 3C               4      INC A
000865 D55E 2831            12      JR  Z,COPYE
000867 D560 7C               4      LD  A,H
000868 D561 B5               4      OR  L
000869 D562 280C            12      JR  Z,COPY7
00086B D564 1114EF          10      LD  DE,FDRV
00086E D567 0E26             7      LD  C,026H      ;(BDOS)ランダムブロック書き込み
000870 D569 CDF8D1          17      CALL    SYSTEM0
000873 D56C 2023            12      JR  NZ,COPYE
000875 D56E 10E9            13      DJNZ    COPY6
       D570                     COPY7:
000877 D570 3A4EF1          13      LD  A,(DTA_CCP+13)  ;(FCB)属性
00087A D573 3221EF          13      LD  (FDRV+13),A
00087D D576 2155F1          10      LD  HL,DTA_CCP+20   ;(FCB)タイムスタンプ
000880 D579 1128EF          10      LD  DE,FDRV+20
000883 D57C 010400          10      LD  BC,4
000886 D57F EDB0                    LDIR
                                
000888 D581 1114EF          10      LD  DE,FDRV
00088B D584 0E10             7      LD  C,010H      ;(BDOS)ファイルのクローズ
00088D D586 CDF8D1          17      CALL    SYSTEM0
000890 D589 2006            12      JR  NZ,COPYE
                                
000892 D58B 1171EF          10      LD  DE,OK
000895 D58E C308D5          10      JP  COPY8
                                
       D591                     COPYE:
000898 D591 1114EF          10      LD  DE,FDRV
00089B D594 0E13             7      LD  C,013H      ;(BDOS)ファイルの削除
00089D D596 CD0500          17      CALL    SYSTEM
       D599                     COPYE2:
0008A0 D599 37               4      SCF
0008A1 D59A C9              10      RET
                                
       D59B                     C_TYPE:
0008A2 D59B CD88D4          17      CALL    SETFCB
0008A5 D59E 215C00          10      LD  HL,FCB1
0008A8 D5A1 CDCAD1          17      CALL    OPEN
0008AB D5A4 37               4      SCF
       D5A5                     TYPE1:
0008AC D5A5 C0              11      RET NZ
0008AD D5A6 CDDDD1          17      CALL    DEFCB
0008B0 D5A9 3E06             7      LD  A,6
0008B2 D5AB CD9AD9          17      CALL    MSG_A
       D5AE                     TYPE2:
0008B5 D5AE CD01D2          17      CALL    S27BUF
0008B8 D5B1 C6FE             7      ADD A,0FEH
0008BA D5B3 D8              11      RET C
0008BB D5B4 7C               4      LD  A,H
0008BC D5B5 B5               4      OR  L
0008BD D5B6 2813            12      JR  Z,TYPEE
0008BF D5B8 010001          10      LD  BC,00100H
       D5BB                     TYPE3:
0008C2 D5BB 0A               7      LD  A,(BC)
0008C3 D5BC 03               6      INC BC
0008C4 D5BD FE1A             7      CP  01AH
0008C6 D5BF 280A            12      JR  Z,TYPEE
0008C8 D5C1 CD9AD9          17      CALL    MSG_A
0008CB D5C4 2B               6      DEC HL
0008CC D5C5 7C               4      LD  A,H
0008CD D5C6 B5               4      OR  L
0008CE D5C7 20F2            12      JR  NZ,TYPE3
0008D0 D5C9 18E3            12      JR  TYPE2
       D5CB                     TYPEE:
0008D2 D5CB CDD9D1          17      CALL    OPEN2
0008D5 D5CE 18D5            12      JR  TYPE1
                                
       D5D0                     CWILD:
0008D7 D5D0 215D00          10      LD  HL,FCB1+1
       D5D3                     CWILD1:
0008DA D5D3 7E               7      LD  A,(HL)
0008DB D5D4 FE20             7      CP  020H
0008DD D5D6 C0              11      RET NZ
       D5D7                     CWILD2:
0008DE D5D7 3E3F             7      LD  A,'?'
0008E0 D5D9 060B             7      LD  B,11
0008E2 D5DB C33BDF          10      JP  FILL_MEMORY
                                
0008E5 D5DE 20202020203C4449    DIRMES: DB  "     <DIR>$"
            523E24              
0008F0 D5E9 20203A24            DIRHD:  DB  "  :$"
                                
       D5ED                     COMTB:
0008F4 D5ED 44202020                DB  "D   "  ;1
0008F8 D5F1 DFD2                    DW  C_DIR
0008FA D5F3 44495220                DB  "DIR "  ;2
0008FE D5F7 DFD2                    DW  C_DIR
000900 D5F9 434F5059                DB  "COPY"  ;3
000904 D5FD C3D4                    DW  C_COPY
000906 D5FF 43442020                DB  "CD  "  ;4
00090A D603 FDD1                    DW  C_CD
00090C D605 44454C20                DB  "DEL "  ;5
000910 D609 C2D2                    DW  C_DEL
000912 D60B 50415448                DB  "PATH"  ;6
000916 D60F 84D3                    DW  C_PATH
000918 D611 52454E20                DB  "REN "  ;7
00091C D615 CCD2                    DW  C_REN
00091E D617 54595045                DB  "TYPE"  ;8
000922 D61B 9BD5                    DW  C_TYPE
000924 D61D 52454D20                DB  "REM "  ;9
000928 D621 98D6                    DW  C_REM
[EOF:LDCCP.ASM:SHIFT_JIS]
                                    INCLUDE "88DISK2.ASM"
                                
                                ;   LSX-Dodgers DISK2
                                ;   PC-8801mkIISR
                                
                                ;   BANK RAM DISK DRIVER
                                
       D623                     BDWT:
00092A D623 3E10             7      LD  A,010H  ;ライト可　リード不可
00092C D625 1802            12  JR  BRW
                                
       D627                     BDRD:
00092E D627 3E01             7      LD  A,001H  ;ライト不可　リード可
       D629                     BRW:
000930 D629 F3               4      DI
000931 D62A D3E2            11      OUT (0E2H),A    ;拡張RAM リード/ライト制御
000933 D62C ED7365D6        20      LD  (BANKSP+1),SP
000937 D630 3A66D6          13      LD  A,(BANKSP+2)
00093A D633 87               4      ADD A,A
00093B D634 3803            12      JR  C,BRW1
00093D D636 3130EE          10      LD  SP,EXTSP
       D639                     BRW1:
000940 D639 C5              11      PUSH    BC
000941 D63A D5              11      PUSH    DE
000942 D63B EB               4      EX  DE,HL
000943 D63C 29              11      ADD HL,HL
000944 D63D 29              11      ADD HL,HL
000945 D63E 7C               4      LD  A,H
000946 D63F DD860C          19      ADD A,(IX+00CH) ;DPB_0C_MAXCYL
000949 D642 E60F             7      AND 00FH        ;バンク
00094B D644 D3E3            11      OUT (0E3H),A    ;拡張RAM バンク選択
00094D D646 65               4      LD  H,L
00094E D647 CB3C             8      SRL H   ;/2
000950 D649 2E00             7      LD  L,0
000952 D64B DBE2            11      IN  A,(0E2H)    ;拡張RAM リード/ライト制御
000954 D64D 0F               4      RRCA
000955 D64E 3001            12      JR  NC,BRW2
000957 D650 EB               4      EX  DE,HL
       D651                     BRW2:
000958 D651 010002          10      LD  BC,512
00095B D654 EDB0                    LDIR
                                
00095D D656 DBE2            11      IN  A,(0E2H)    ;拡張RAM リード/ライト制御
00095F D658 0F               4      RRCA
000960 D659 3801            12      JR  C,BRW3
000962 D65B EB               4      EX  DE,HL
       D65C                     BRW3:
000963 D65C D1              10      POP DE
000964 D65D C1              10      POP BC
000965 D65E 13               6      INC DE
000966 D65F 10D8            13      DJNZ    BRW1
                                
000968 D661 AF               4      XOR A
000969 D662 D3E2            11      OUT (0E2H),A    ;メインメモリに切り替える
00096B D664 310000          10  BANKSP: LD  SP,0
00096E D667 FB               4      EI
00096F D668 C9              10      RET
                                
[EOF:88DISK2.ASM:SHIFT_JIS]
                                    INCLUDE "LDOS.ASM"
                                
                                ;   LSX-Dodgers OS
                                
       D669                     BDOS0:
000970 D669 E5              11      PUSH    HL
000971 D66A 79               4      LD  A,C
000972 D66B FE3C             7      CP  03CH
000974 D66D 3802            12      JR  C,DOS1
000976 D66F 3E3C             7      LD  A,03CH
       D671                     DOS1:
000978 D671 87               4      ADD A,A
000979 D672 6F               4      LD  L,A
00097A D673 26F0             7      LD  H,STABLE/256
00097C D675 7E               7      LD  A,(HL)
00097D D676 2C               4      INC L
00097E D677 66               7      LD  H,(HL)
00097F D678 6F               4      LD  L,A
000980 D679 E3              19      EX  (SP),HL
000981 D67A 79               4      LD  A,C
                                ;確認用
                                ;   LD  (0050H),A
000982 D67B C9              10      RET
       D67C                     _DOS2:
000983 D67C FE5A             7      CP  05AH        ;(BDOS)カレントディレクトリの変更(_CHDIR)
000985 D67E CA1DD9          10      JP  Z,_SYS5A
000988 D681 FE5C             7      CP  05CH        ;(BDOS)ファイル名の解析(_PFILE)
00098A D683 CAD9D8          10      JP  Z,_SYS5C
00098D D686 FE5F             7      CP  05FH        ;(BDOS)ディスクバッファのフラッシュ(_FLUSH)
00098F D688 CAFDEB          10      JP  Z,_SYS5F
000992 D68B FE6F             7      CP  06FH        ;(BDOS)MSX-DOS のバージョン番号の獲得(_DOSVER)
000994 D68D 200A            12      JR  NZ,_ERROR
000996 D68F 011D01          10      LD  BC,011DH
000999 D692 115201          10      LD  DE,VER
00099C D695 210201          10      LD  HL,MACD
       D698                     C_REM:
00099F D698 AF               4      XOR A
       D699                     _ERROR:
0009A0 D699 A7               4      AND A
0009A1 D69A C9              10      RET
                                
       D69B                     _SYS09:     ;文字列出力
0009A2 D69B D5              11      PUSH    DE
       D69C                     _SX09:
0009A3 D69C 1A               7      LD  A,(DE)
0009A4 D69D 13               6      INC DE
0009A5 D69E FE24             7      CP  '$'
0009A7 D6A0 2831            12      JR  Z,SX0E2
0009A9 D6A2 CD9AD9          17      CALL    MSG_A
0009AC D6A5 18F5            12      JR  _SX09
                                
       D6A7                     MSX1:
0009AE D6A7 CD9AD9          17      CALL    MSG_A
       D6AA                     MSX:
0009B1 D6AA 7E               7      LD  A,(HL)
0009B2 D6AB 23               6      INC HL
0009B3 D6AC B7               4      OR  A
0009B4 D6AD 20F8            12      JR  NZ,MSX1
0009B6 D6AF C9              10      RET
                                
       D6B0                     _SYS0C:     ;(BDOS)バージョン番号の獲得
0009B7 D6B0 212200          10      LD  HL,00022H
0009BA D6B3 7D               4      LD  A,L
0009BB D6B4 C9              10      RET
                                
       D6B5                     _SYS0D:     ;(BDOS)ディスクリセット
0009BC D6B5 CDDFEF          17      CALL    _FFLUSH
0009BF D6B8 E5              11      PUSH    HL
0009C0 D6B9 218000          10      LD  HL,00080H
0009C3 D6BC 228AEF          16      LD  (_DTA),HL
0009C6 D6BF E1              10      POP HL
0009C7 D6C0 D5              11      PUSH    DE
0009C8 D6C1 1E00             7      LD  E,0
0009CA D6C3 3E                      DB  03EH
                                
       D6C4                     _SYS0E:     ;(BDOS)カレントドライブの設定
0009CB D6C4 D5              11      PUSH    DE
0009CC D6C5 7B               4      LD  A,E
0009CD D6C6 DDE5            15      PUSH    IX
0009CF D6C8 CDDCEF          17      CALL    _GETDPB
0009D2 D6CB DDE1            14      POP IX
0009D4 D6CD 3804            12      JR  C,SX0E2
0009D6 D6CF 7B               4      LD  A,E
0009D7 D6D0 3287EF          13      LD  (_DVSW),A
       D6D3                     SX0E2:
0009DA D6D3 D1              10      POP DE
0009DB D6D4 C9              10      RET
                                
       D6D5                     _SYS0F:     ;(BDOS)ファイルのオープン
0009DC D6D5 CD78DF          17      CALL    SETDRV
0009DF D6D8 FD7E1C          19      LD  A,(IY+28)   ;(FCB)オープンモード
0009E2 D6DB C602             7      ADD A,002H      ;Write
0009E4 D6DD 2848            12      JR  Z,FEND0F
0009E6 D6DF CDC6E2          17      CALL    CHKWILDX
                                
0009E9 D6E2 D498DF          17      CALL    NC,SOPENX
       D6E5                     _S16XX:
0009EC D6E5 3840            12      JR  C,FEND0F
                                                ;Directory location
0009EE D6E7 3A9FEF          13      LD  A,(_FILEN)
0009F1 D6EA FD7719          19      LD  (IY+25),A   ;(FCB)ディレクトリロケーション
                                ;               _DIRF
0009F4 D6ED 3AA0EF          13      LD  A,(_DIRF)
0009F7 D6F0 FD771D          19      LD  (IY+29),A   ;(FCB)ディレクトリモード
                                ;               _FBPS
0009FA D6F3 FD731E          19      LD  (IY+30),E   ;(FCB)ディレクトリポジション
0009FD D6F6 FD721F          19      LD  (IY+31),D
                                ;               Open(Read)
000A00 D6F9 FD361CFF        19      LD  (IY+28),0FFH    ;(FCB)オープンモード
                                ;               FILENAME
000A04 D6FD FDE5            15      PUSH    IY
000A06 D6FF D1              10      POP DE
000A07 D700 13               6      INC DE
000A08 D701 010B00          10      LD  BC,11
000A0B D704 EDB0                    LDIR
                                ;               Attribute
000A0D D706 7E               7      LD  A,(HL)
000A0E D707 FD770D          19      LD  (IY+13),A   ;(FCB)属性(アトリビュート)
000A11 D70A 110B00          10      LD  DE,11       ;Reserved
000A14 D70D 19              11      ADD HL,DE
                                                    ;(FCB)ファイルを最後に変更した時刻
000A15 D70E 11EAF0          10      LD  DE,SDDATA       ;(FCB)ファイルを最後に変更した日付
000A18 D711 060A             7      LD  B,SDDATAE-SDDATA    ;(FCB)ファイルの先頭クラスタ
       D713                     S16LOOP:                ;(FCB)ファイルのサイズ(バイト単位)
000A1A D713 1A               7      LD  A,(DE)
000A1B D714 13               6      INC DE
000A1C D715 321CD7          13      LD  (S16PAT+2),A
000A1F D718 7E               7      LD  A,(HL)
000A20 D719 23               6      INC HL
000A21 D71A FD7700          19  S16PAT: LD  (IY+0),A
000A24 D71D 10F4            13      DJNZ    S16LOOP
                                
000A26 D71F AF               4      XOR A
000A27 D720 FD770C          19      LD  (IY+12),A   ;(FCB)カレントブロック
000A2A D723 FD22CBD7        20      LD  (OFCB+1),IY
       D727                     FEND0F:
000A2E D727 1845            12      JR  FEND10
                                
       D729                     _SYS10:     ;(BDOS)ファイルのクローズ
000A30 D729 CD78DF          17      CALL    SETDRV
000A33 D72C FD7E1C          19      LD  A,(IY+28)   ;(FCB)オープンモード
000A36 D72F D6FE             7      SUB 0FEH
000A38 D731 37               4      SCF
000A39 D732 3F               4      CCF
000A3A D733 2039            12      JR  NZ,FEND10
       D735                     _S10A:              ;Write
000A3C D735 FD770E          19      LD  (IY+14),A   ;(FCB)レコードサイズ/アクセスするディレクトリのクラスタ番号+1
000A3F D738 FD770F          19      LD  (IY+15),A
                                
000A42 D73B FD341C          23      INC (IY+28)     ;0FEH->0FFH ;オープンモード
000A45 D73E CDBEE3          17      CALL    SETTMS
                                
000A48 D741 FD7E1D          19      LD  A,(IY+29)   ;(FCB)ディレクトリモード
000A4B D744 32A0EF          13      LD  (_DIRF),A
000A4E D747 E67F             7      AND 07FH
000A50 D749 3207E9          13      LD  (_SECPS+1),A
000A53 D74C FD5E1E          19      LD  E,(IY+30)   ;(FCB)ディレクトリポジション
000A56 D74F FD561F          19      LD  D,(IY+31)
000A59 D752 CDCCE0          17      CALL    READ_DIR
000A5C D755 3817            12      JR  C,FEND10
                                
000A5E D757 3AF6DF          13  SDECM1: LD  A,(SDECPAT+1)   ;1セクタ辺りのディレクトリエントリ数
000A61 D75A 3D               4      DEC A       ;1024=01FH / 512=00FH / 256=7
000A62 D75B FDA619          19      AND (IY+25)     ;(FCB)ディレクトリロケーション
000A65 D75E 6F               4      LD  L,A
000A66 D75F 2600             7      LD  H,0
000A68 D761 29              11      ADD HL,HL       ;*2
000A69 D762 29              11      ADD HL,HL       ;*4
000A6A D763 29              11      ADD HL,HL       ;*8
000A6B D764 29              11      ADD HL,HL       ;*16
000A6C D765 29              11      ADD HL,HL       ;*32
000A6D D766 ED4B7EF0        20      LD  BC,(_DTBUF)
000A71 D76A 09              11      ADD HL,BC
                                
000A72 D76B CDD6E2          17      CALL    SDIRENT
       D76E                     FEND10:
000A75 D76E 1842            12      JR  FEND
                                
       D770                     _SYS11:     ;(BDOS)最初のファイルの検索
000A77 D770 CD78DF          17      CALL    SETDRV
000A7A D773 CDC5DF          17      CALL    SOPEN
       D776                     _S12X1:
000A7D D776 383A            12      JR  C,FEND
000A7F D778 CD65E0          17      CALL    SOPENE2
000A82 D77B ED5B8AEF        20      LD  DE,(_DTA)
000A86 D77F 3A88EF          13      LD  A,(_DRV)
000A89 D782 3C               4      INC A
000A8A D783 12               7      LD  (DE),A
000A8B D784 D5              11      PUSH    DE
000A8C D785 13               6      INC DE
000A8D D786 012000          10      LD  BC,32
000A90 D789 EDB0                    LDIR
000A92 D78B FD6E0E          19      LD  L,(IY+14)   ;(FCB)レコードサイズ/アクセスするディレクトリのクラスタ番号+1
000A95 D78E FD660F          19      LD  H,(IY+15)
000A98 D791 22F4F0          16      LD  (SCDIR),HL
000A9B D794 2A9AEF          16      LD  HL,(_FBPS)
000A9E D797 22F6F0          16      LD  (SFBPS),HL
000AA1 D79A 2A9FEF          16      LD  HL,(_FILEN)
000AA4 D79D 7C               4      LD  A,H
000AA5 D79E B7               4      OR  A
000AA6 D79F 2806            12      JR  Z,_S12DIR
000AA8 D7A1 3A07E9          13      LD  A,(_SECPS+1)
000AAB D7A4 F680             7      OR  080H
000AAD D7A6 67               4      LD  H,A
       D7A7                     _S12DIR:
000AAE D7A7 22F8F0          16      LD  (SFNDF),HL  ;Directory position and Flags
000AB1 D7AA E1              10      POP HL
000AB2 D7AB 1139EF          10      LD  DE,SFILE
000AB5 D7AE 0E21             7      LD  C,33
       D7B0                     _S11B:
000AB7 D7B0 EDB0                    LDIR
       D7B2                     FEND:
000AB9 D7B2 9F               4      SBC A,A     ;CF=0 A=0 : CF=1 A=0FFH
       D7B3                     FENDE:
000ABA D7B3 FDE1            14      POP IY
000ABC D7B5 C1              10      POP BC
000ABD D7B6 D1              10      POP DE
000ABE D7B7 E1              10      POP HL
000ABF D7B8 C9              10      RET
                                
       D7B9                     _SYS12:     ;(BDOS)次のファイルの検索
000AC0 D7B9 E5              11      PUSH    HL
000AC1 D7BA D5              11      PUSH    DE
000AC2 D7BB C5              11      PUSH    BC
000AC3 D7BC FDE5            15      PUSH    IY
000AC5 D7BE CD29E0          17      CALL    NOPEN
000AC8 D7C1 18B3            12      JR  _S12X1
                                
       D7C3                     _S16K:
000ACA D7C3 FD7E1C          19      LD  A,(IY+28)   ;(FCB)オープンモード
000ACD D7C6 FEFD             7      CP  0FDH        ;Device(0FDH)
000ACF D7C8 37               4      SCF
000AD0 D7C9 C8              11      RET Z
                                
000AD1 D7CA 110000          10  OFCB:   LD  DE,0
000AD4 D7CD D5              11      PUSH    DE
000AD5 D7CE 061A             7      LD  B,26        ;First cluster
       D7D0                     S16K1:
000AD7 D7D0 13               6      INC DE
000AD8 D7D1 23               6      INC HL
000AD9 D7D2 10FC            13      DJNZ    S16K1
                                
000ADB D7D4 1A               7      LD  A,(DE)
000ADC D7D5 BE               7      CP  (HL)
000ADD D7D6 2013            12      JR  NZ,S16K2
000ADF D7D8 13               6      INC DE
000AE0 D7D9 23               6      INC HL
000AE1 D7DA 1A               7      LD  A,(DE)
000AE2 D7DB BE               7      CP  (HL)
000AE3 D7DC 200D            12      JR  NZ,S16K2
                                
000AE5 D7DE E1              10      POP HL
000AE6 D7DF FDE5            15      PUSH    IY
000AE8 D7E1 D1              10      POP DE
000AE9 D7E2 1A               7      LD  A,(DE)      ;Drive
000AEA D7E3 BE               7      CP  (HL)
000AEB D7E4 2006            12      JR  NZ,S16K3
                                                ;ここはCFが必ず0
000AED D7E6 ED52            15      SBC HL,DE       ;CP HL,DE
000AEF D7E8 37               4      SCF
000AF0 D7E9 C0              11      RET NZ
000AF1 D7EA E5              11      PUSH    HL
       D7EB                     S16K2:
000AF2 D7EB E1              10      POP HL
       D7EC                     S16K3:
000AF3 D7EC FDE5            15      PUSH    IY
000AF5 D7EE D1              10      POP DE
       D7EF                     _SYS13:     ;(BDOS)ファイルの削除
000AF6 D7EF CD78DF          17      CALL    SETDRV
000AF9 D7F2 CDF6E1          17      CALL    KILL
       D7F5                     FEND13:
000AFC D7F5 18BB            12      JR  FEND
                                
       D7F7                     _SYS14:     ;(BDOS)シーケンシャルな読み出し
000AFE D7F7 CD78DF          17      CALL    SETDRV
000B01 D7FA CD2AE4          17      CALL    INIT_SEQ
       D7FD                     SREAD:
000B04 D7FD CD74E4          17      CALL    RB_READ
                                
000B07 D800 C601             7      ADD A,001H
000B09 D802 38AE            12      JR  C,FEND
                                
000B0B D804 7D               4      LD  A,L
000B0C D805 D601             7      SUB 001H
       D807                     FENDX:
000B0E D807 9F               4      SBC A,A
000B0F D808 E603             7      AND 3
000B11 D80A 1F               4      RRA
000B12 D80B 18A6            12      JR  FENDE
                                
       D80D                     _SYS15:     ;(BDOS)シーケンシャルな書き込み
000B14 D80D CD78DF          17      CALL    SETDRV
000B17 D810 CD2AE4          17      CALL    INIT_SEQ
       D813                     SWRITE:
000B1A D813 CD6DE4          17      CALL    RB_WRITE
                                
000B1D D816 C6FF             7      ADD A,0FFH
000B1F D818 18ED            12      JR  FENDX
                                
       D81A                     _SYS17:     ;(BDOS)ファイル名の変更
000B21 D81A CD78DF          17      CALL    SETDRV
000B24 D81D CD4CE2          17      CALL    NAME
000B27 D820 18D3            12      JR  FEND13
                                
       D822                     _SYS16:     ;(BDOS)ファイルの作成
000B29 D822 CD78DF          17      CALL    SETDRV
                                
000B2C D825 CDC6E2          17      CALL    CHKWILDX
000B2F D828 38CB            12      JR  C,FEND13
000B31 D82A FD7E01          19      LD  A,(IY+1)    ;(FCB)主ファイル名
000B34 D82D FE05             7      CP  5
000B36 D82F 2805            12      JR  Z,_S16X2
000B38 D831 FE21             7      CP  021H
000B3A D833 DAF5D7          10      JP  C,FEND13
       D836                     _S16X2:
                                ;               Clear FCB
000B3D D836 FDE5            15      PUSH    IY
000B3F D838 E1              10      POP HL
000B40 D839 011000          10      LD  BC,16
000B43 D83C 09              11      ADD HL,BC
       D83D                     _S16X1:
000B44 D83D 70               7      LD  (HL),B      ;B=0
000B45 D83E 23               6      INC HL
000B46 D83F 0D               4      DEC C
000B47 D840 20FB            12      JR  NZ,_S16X1
                                
000B49 D842 CDC3E3          17      CALL    SETTMSX
000B4C D845 FD360DFF        19      LD  (IY+13),0FFH    ;(FCB)Attribute
000B50 D849 CD98DF          17      CALL    SOPENX
000B53 D84C 3F               4      CCF
000B54 D84D CCC3D7          17      CALL    Z,_S16K
000B57 D850 D476E0          17      CALL    NC,COPEN
000B5A D853 D4D6E2          17      CALL    NC,SDIRENT
000B5D D856 C3E5D6          10      JP  _S16XX
                                
       D859                     _SYS21:     ;(BDOS)ランダムな読み出し
000B60 D859 CD78DF          17      CALL    SETDRV
000B63 D85C CD0EE4          17      CALL    INIT_RND
000B66 D85F 189C            12      JR  SREAD
                                
       D861                     _SYS22:     ;(BDOS)ランダムな書き込み
       D861                     _SYS28:     ;(BDOS)ランダムな書き込み・その2
000B68 D861 CD78DF          17      CALL    SETDRV
000B6B D864 CD0EE4          17      CALL    INIT_RND
000B6E D867 18AA            12      JR  SWRITE
                                
       D869                     _SYS18:     ;(BDOS)ログインベクトルの獲得
000B70 D869 21FF00          10      LD  HL,000FFH
000B73 D86C AF               4      XOR A
000B74 D86D C9              10      RET
                                
       D86E                     _SYS19:     ;(BDOS)カレントドライブ番号の獲得
000B75 D86E 3A87EF          13      LD  A,(_DVSW)
000B78 D871 A7               4      AND A
000B79 D872 C9              10      RET
                                
       D873                     _SYS1A:     ;(BDOS)DTAの設定
000B7A D873 ED538AEF        20      LD  (_DTA),DE
000B7E D877 AF               4      XOR A
000B7F D878 C9              10      RET
                                
       D879                     _SYS1B:     ;(BDOS)ディスク情報の獲得
000B80 D879 7B               4      LD  A,E
000B81 D87A CD8BDF          17      CALL    GETDRV
000B84 D87D CDDCEF          17      CALL    _GETDPB
000B87 D880 D4E2EF          17      CALL    NC,_RDFATX
000B8A D883 210000          10      LD  HL,0
000B8D D886 D49CE3          17      CALL    NC,DSKF
                                
000B90 D889 ED5B9DE3        20      LD  DE,(MAXCLP+1)   ;DPB_08_MAXCL-1
000B94 D88D 1B               6      DEC DE      ;DE←クラスタの総数
000B95 D88E FD2A7CF0        20      LD  IY,(_FATBF) ;IY←メモリ上のFATの先頭アドレス
000B99 D892 9F               4      SBC A,A
000B9A D893 D8              11      RET C
000B9B D894 4F               4      LD  C,A     ;C=0
000B9C D895 DD7E0F          19      LD  A,(IX+00FH) ;DPB_0F_BPS
000B9F D898 E60F             7      AND 00FH
000BA1 D89A 47               4      LD  B,A
000BA2 D89B DD7E07          19      LD  A,(IX+7)    ;DPB_07_SECPCL
000BA5 D89E C9              10      RET
                                
       D89F                     _SYS1D:     ;(BDOS)書き込みが禁止されているディスクの調査
000BA6 D89F AF               4      XOR A
000BA7 D8A0 67               4      LD  H,A
000BA8 D8A1 6F               4      LD  L,A
000BA9 D8A2 C9              10      RET
                                
       D8A3                     _SYS1F:     ;(BDOS)ディスク装置のパラメータの読み出し
000BAA D8A3 2100F2          10      LD  HL,DEVICE
000BAD D8A6 7B               4      LD  A,E
000BAE D8A7 C3DCEF          10      JP  _GETDPB
                                
       D8AA                     _SYS23:     ;(BDOS)ファイルサイズの獲得
000BB1 D8AA E5              11      PUSH    HL
000BB2 D8AB 2A1EF0          16      LD  HL,(STABLE+2*00FH)  ;ファイルのオープン
000BB5 D8AE CD0F00          17      CALL    JP_HL
000BB8 D8B1 381B            12      JR  C,_S23X1
                                
000BBA D8B3 D5              11      PUSH    DE      ;EX DE,IY
000BBB D8B4 FDE3            23      EX  (SP),IY     ;
                                ;   POP DE      ;
                                ;   PUSH    DE      ;DEを破壊しないように注意vv
000BBD D8B6 FD7E10          19      LD  A,(IY+16)   ;(FCB)ファイルのサイズ(バイト単位)
000BC0 D8B9 FD6E11          19      LD  L,(IY+17)   ;
000BC3 D8BC FD6612          19      LD  H,(IY+18)   ;
000BC6 D8BF C5              11      PUSH    BC      ;
000BC7 D8C0 FD4613          19      LD  B,(IY+19)   ;
000BCA D8C3 CD00E4          17      CALL    GET_CPM_R_SIZE
000BCD D8C6 C1              10      POP BC
       D8C7                     _S24X1:
000BCE D8C7 CD20E4          17      CALL    SET_RR_AHL
                                ;   POP DE      ;^^^^^^^^^^^^^^^^^^^^^^^^
                                ;   PUSH    DE      ;EX DE,IY
000BD1 D8CA FDE3            23      EX  (SP),IY     ;
000BD3 D8CC D1              10      POP DE      ;
                                
000BD4 D8CD AF               4      XOR A
       D8CE                     _S23X1:
000BD5 D8CE E1              10      POP HL
000BD6 D8CF C9              10      RET
                                
       D8D0                     _SYS24:     ;(BDOS)ランダムレコードフィールドの設定
000BD7 D8D0 E5              11      PUSH    HL
000BD8 D8D1 D5              11      PUSH    DE      ;EX DE,IY
000BD9 D8D2 FDE3            23      EX  (SP),IY     ;
                                ;   POP DE      ;
                                ;   PUSH    DE      ;DEを破壊しないように注意vv
000BDB D8D4 CD32E4          17      CALL    GETSEQ
000BDE D8D7 18EE            12      JR  _S24X1      ;^^^^^^^^^^^^^^^^^^^^^^^^
                                
       D8D9                     _SYS5C:     ;(BDOS)ファイル名の解析
000BE0 D8D9 C5              11      PUSH    BC
000BE1 D8DA E5              11      PUSH    HL
000BE2 D8DB CD8FDE          17      CALL    FILE
000BE5 D8DE E1              10      POP HL
000BE6 D8DF C1              10      POP BC
       D8E0                     S29X1:
000BE7 D8E0 C5              11      PUSH    BC
000BE8 D8E1 D5              11      PUSH    DE
000BE9 D8E2 E5              11      PUSH    HL
000BEA D8E3 EB               4      EX  DE,HL
000BEB D8E4 2114EF          10      LD  HL,FDRV
000BEE D8E7 010D00          10      LD  BC,13
000BF1 D8EA EDB0                    LDIR
000BF3 D8EC 70               7      LD  (HL),B      ;B=0
000BF4 D8ED 0E03             7      LD  C,3
000BF6 D8EF EDB0                    LDIR
000BF8 D8F1 E1              10      POP HL
000BF9 D8F2 D1              10      POP DE
000BFA D8F3 C1              10      POP BC
000BFB D8F4 AF               4      XOR A
000BFC D8F5 C9              10      RET
                                
       D8F6                     _SYS30:     ;(BDOS)論理セクタを用いた書き込み
000BFD D8F6 C5              11      PUSH    BC
000BFE D8F7 01A1EA          10      LD  BC,DWT24B
000C01 D8FA 1804            12      JR  S2FX
       D8FC                     _SYS2F:
000C03 D8FC C5              11      PUSH    BC
000C04 D8FD 0191EA          10      LD  BC,DRD24B
       D900                     S2FX:
000C07 D900 ED4316D9        20      LD  (S2FPAT+1),BC
000C0B D904 CDDFEF          17      CALL    _FFLUSH
                                
000C0E D907 D5              11      PUSH    DE
000C0F D908 E5              11      PUSH    HL
000C10 D909 7D               4      LD  A,L     ;Drive
000C11 D90A CDD9EF          17      CALL    _CHGDRV
000C14 D90D 3809            12      JR  C,S30X2
000C16 D90F 44               4      LD  B,H     ;Number of clusters
000C17 D910 2A8AEF          16      LD  HL,(_DTA)
                                
000C1A D913 0E00             7      LD  C,0
000C1C D915 CD91EA          17  S2FPAT: CALL    DRD24B
       D918                     S30X2:
000C1F D918 E1              10      POP HL
000C20 D919 D1              10      POP DE
000C21 D91A C1              10      POP BC
000C22 D91B 9F               4      SBC A,A
000C23 D91C C9              10      RET
                                
       D91D                     _SYS5A:     ;(BDOS)カレントディレクトリの変更
000C24 D91D C5              11      PUSH    BC
000C25 D91E D5              11      PUSH    DE
000C26 D91F E5              11      PUSH    HL
000C27 D920 CD84DE          17      CALL    FILEC
000C2A D923 210000          10      LD  HL,0
000C2D D926 1114EF          10      LD  DE,FDRV
000C30 D929 2A4EF0          16      LD  HL,(STABLE+2*027H)  ;ランダムブロック読み込み
000C33 D92C CD0F00          17      CALL    JP_HL
000C36 D92F 18E7            12      JR  S30X2
[EOF:LDOS.ASM:SHIFT_JIS]
                                    INCLUDE "88IO.ASM"
                                
                                ;   LSX-Dodgers IO
                                ;   PC-8801mkIISR
                                
       D699                     _SYS04  EQU _ERROR      ;(BDOS)外部出力
       D699                     _SYS05  EQU _ERROR      ;(BDOS)プリンタ出力
       D699                     _SYS1C  EQU _ERROR      ;(BDOS)ディスクの書き込み禁止化
       D699                     _SYS1E  EQU _ERROR      ;(BDOS)ファイル属性の設定
       D699                     _SYS20  EQU _ERROR      ;(BDOS)利用者番号の設定と読み出し
       D699                     _SYS2E  EQU _ERROR      ;(BDOS)ベリファイ・フラグの設定
                                
       0000                     INT EQU 0
       0000                     INTCTCE EQU 0
       0000                     INTCTC2 EQU 0
                                
       D931                     BDOS_RF:
000C38 D931 DB32            11      IN  A,(032H)
000C3A D933 F610             7      OR  010H        ;高速RAMアクセスモードOFF
000C3C D935 D332            11      OUT (032H),A
000C3E D937 C369D6          10      JP  BDOS0
                                
       D93A                     INTVRTC:
000C41 D93A F3               4      DI
000C42 D93B F5              11      PUSH    AF
000C43 D93C CD94DD          17      CALL    CHKEY
       D940                     KEYDT   EQU $+1
000C46 D93F FE00             7      CP  0
000C48 D941 201F            12      JR  NZ,SETKEY1
       D944                     KEYAR   EQU $+1
000C4A D943 3E00             7      LD  A,0
000C4C D945 B7               4      OR  A
000C4D D946 2014            12      JR  NZ,ARWKEY
       D948                     SETKEY:
000C4F D948 3244D9          13      LD  (KEYAR),A
000C52 D94B 3A92EF          13      LD  A,(_KEYD)
000C55 D94E 3240D9          13      LD  (KEYDT),A
000C58 D951 CD6FD9          17      CALL    KEYSET
       D954                     ENDKEY:
000C5B D954 3AB7EF          13      LD  A,(WKE4)
000C5E D957 D3E4            11      OUT (0E4H),A
000C60 D959 F1              10      POP AF
000C61 D95A FB               4      EI
000C62 D95B C9              10      RET
       D95C                     ARWKEY:
000C63 D95C 3D               4      DEC A
000C64 D95D 3244D9          13      LD  (KEYAR),A
000C67 D960 18F2            12      JR  ENDKEY
       D962                     SETKEY1:
000C69 D962 3A95EF          13      LD  A,(_KEYSP+1)
000C6C D965 18E1            12      JR  SETKEY
                                
       D967                     INTE88:
000C6E D967 F5              11      PUSH    AF
000C6F D968 3AB7EF          13      LD  A,(WKE4)
000C72 D96B D3E4            11      OUT (0E4H),A
000C74 D96D F1              10      POP AF
000C75 D96E C9              10      RET
       D96F                     KEYSET:
       D96F                     KEYBS:
000C76 D96F B7               4      OR  A
000C77 D970 C8              11      RET Z
       D971                     KEYBS1:
000C78 D971 CD87D9          17      CALL    KEYBC_IFBREAK
000C7B D974 E5              11      PUSH    HL
000C7C D975 F5              11      PUSH    AF
000C7D D976 2A90EF          16      LD  HL,(_KEYPS)
000C80 D979 2C               4      INC L
000C81 D97A 7D               4      LD  A,L
000C82 D97B BC               4      CP  H
000C83 D97C 2815            12      JR  Z,POP_AF_HL_SCF_RET
000C85 D97E 3290EF          13      LD  (_KEYPS),A
000C88 D981 26FF             7      LD  H,KEYBF/256
000C8A D983 F1              10      POP AF
000C8B D984 77               7      LD  (HL),A
000C8C D985 E1              10      POP HL
000C8D D986 C9              10      RET
       D987                     KEYBC_IFBREAK:
000C8E D987 FE03             7      CP  3
000C90 D989 C0              11      RET NZ
       D98A                     KEYBC:
000C91 D98A E5              11      PUSH    HL
000C92 D98B 210000          10      LD  HL,0
000C95 D98E 2290EF          16      LD  (_KEYPS),HL
000C98 D991 E1              10      POP HL
000C99 D992 C9              10      RET
                                
       D993                     POP_AF_HL_SCF_RET:
000C9A D993 F1              10      POP AF
000C9B D994 E1              10      POP HL
000C9C D995 37               4      SCF
000C9D D996 C9              10      RET
                                
       D997                     _SYS01:     ;(BDOS)コンソール入力
000C9E D997 CD09EF          17      CALL    _SYS07
       D99A                     MSG_A:
000CA1 D99A F5              11      PUSH    AF
000CA2 D99B D5              11      PUSH    DE
000CA3 D99C 5F               4      LD  E,A
000CA4 D99D CDA3D9          17      CALL    _SYS02
000CA7 D9A0 D1              10      POP DE
000CA8 D9A1 F1              10      POP AF
000CA9 D9A2 C9              10      RET
                                
       D9A3                     _SYS02:     ;(BDOS)コンソール出力
000CAA D9A3 CDB5D9          17      CALL    BREAK
000CAD D9A6 1805            12      JR  PRINTX
                                
       D9A8                     _SYS06:     ;(BDOS)コンソール直接入出力
000CAF D9A8 7B               4      LD  A,E
000CB0 D9A9 3C               4      INC A
000CB1 D9AA CACAEF          10      JP  Z,_INKEY
       D9AD                     PRINTX:
000CB4 D9AD C3CDEF          10      JP  _PRINT
                                
       D9B0                     _SYS08:     ;(BDOS)エコーなしコンソール入力
000CB7 D9B0 CD09EF          17      CALL    _SYS07
000CBA D9B3 1804            12      JR  BREAK1
       D9B5                     BREAK:
000CBC D9B5 FB               4      EI
000CBD D9B6 3A92EF          13      LD  A,(_KEYD)
       D9B9                     BREAK1:
000CC0 D9B9 FE03             7      CP  3       ;CTRL+C
000CC2 D9BB CCF4EF          17      CALL    Z,_BREAK
000CC5 D9BE FE13             7      CP  013H        ;CTRL+S
000CC7 D9C0 C0              11      RET NZ
                                
       D9C1                     PAUSE:
000CC8 D9C1 CD8AD9          17      CALL    KEYBC
                                
       D9C4                     FLGET:
000CCB D9C4 CDDFEF          17      CALL    _FFLUSH
000CCE D9C7 E5              11      PUSH    HL
000CCF D9C8 2A8EEF          16      LD  HL,(_TXADR)
000CD2 D9CB CD55DC          17      CALL    CURSOR_ON
       D9CE                     FLGET1:
000CD5 D9CE CDCAEF          17      CALL    _INKEY
000CD8 D9D1 28FB            12      JR  Z,FLGET1
000CDA D9D3 CD66DC          17      CALL    CURSOR_OFF
000CDD D9D6 E1              10      POP HL
000CDE D9D7 C9              10      RET
                                
       D9D8                     _SYS0A:     ;(BDOS)文字列入力
000CDF D9D8 C5              11      PUSH    BC
000CE0 D9D9 E5              11      PUSH    HL
000CE1 D9DA D5              11      PUSH    DE
000CE2 D9DB CD25DD          17      CALL    GETL
000CE5 D9DE 1120FF          10      LD  DE,KBUF
000CE8 D9E1 E1              10      POP HL
000CE9 D9E2 E5              11      PUSH    HL
000CEA D9E3 0E00             7      LD  C,0
000CEC D9E5 3004            12      JR  NC,SAX0
000CEE D9E7 23               6      INC HL
000CEF D9E8 23               6      INC HL
000CF0 D9E9 1808            12      JR  SAX4
       D9EB                     SAX0:
000CF2 D9EB 46               7      LD  B,(HL)
000CF3 D9EC 23               6      INC HL
       D9ED                     SAX1:
000CF4 D9ED 23               6      INC HL
000CF5 D9EE 1A               7      LD  A,(DE)
000CF6 D9EF 13               6      INC DE
000CF7 D9F0 B7               4      OR  A
000CF8 D9F1 2004            12      JR  NZ,SAX2
       D9F3                     SAX4:
000CFA D9F3 360D            10      LD  (HL),00DH
000CFC D9F5 1804            12      JR  SAX3
       D9F7                     SAX2:
000CFE D9F7 77               7      LD  (HL),A
000CFF D9F8 0C               4      INC C
000D00 D9F9 10F2            13      DJNZ    SAX1
       D9FB                     SAX3:
000D02 D9FB D1              10      POP DE
000D03 D9FC 79               4      LD  A,C
000D04 D9FD 13               6      INC DE
000D05 D9FE 12               7      LD  (DE),A
000D06 D9FF 1B               6      DEC DE
000D07 DA00 E1              10      POP HL
000D08 DA01 C1              10      POP BC
000D09 DA02 A7               4      AND A
000D0A DA03 C9              10      RET
                                
       DA04                     _SYS0B:     ;(BDOS)コンソール状態のチェック
000D0B DA04 CDB5D9          17      CALL    BREAK
000D0E DA07 3A92EF          13      LD  A,(_KEYD)
000D11 DA0A B7               4      OR  A
000D12 DA0B C8              11      RET Z
       DA0C                     CONSTX:
000D13 DA0C CDDFEF          17      CALL    _FFLUSH
000D16 DA0F E5              11      PUSH    HL
000D17 DA10 2A90EF          16      LD  HL,(_KEYPS)
000D1A DA13 7C               4      LD  A,H
000D1B DA14 AD               4      XOR L
000D1C DA15 E1              10      POP HL
000D1D DA16 C6FF             7      ADD A,0FFH
000D1F DA18 9F               4      SBC A,A
000D20 DA19 C9              10      RET
                                
       DA1A                     _SYS2A:     ;(BDOS)日付の獲得
000D21 DA1A C5              11      PUSH    BC
000D22 DA1B CD5ADA          17      CALL    RTCREAD
000D25 DA1E 3A62EF          13      LD  A,(RTC_YY)
000D28 DA21 CDBDDA          17      CALL    BCD
000D2B DA24 6F               4      LD  L,A
000D2C DA25 2600             7      LD  H,0
                                ;   LD  DE,1900     ;0076CH
                                ;   CP  90      ;90以上は1900年代 1990-1999
                                ;   JR  NC,RDDATE1  ;90未満は2000年代 2000-2089
                                ;   LD  E,0D0H      ;2000 & 0FFH D=007H
000D2E DA27 11D007          10      LD  DE,2000     ;すべて2000年代で処理 2000-2099
       DA2A                     RDDATE1:
000D31 DA2A 19              11      ADD HL,DE
000D32 DA2B 3A63EF          13      LD  A,(RTC_MW)
000D35 DA2E 57               4      LD  D,A
000D36 DA2F 3A64EF          13      LD  A,(RTC_DD)
000D39 DA32 CDBDDA          17      CALL    BCD
000D3C DA35 5F               4      LD  E,A
000D3D DA36 7A               4      LD  A,D
000D3E DA37 0604             7      LD  B,4
       DA39                     RDDATE2:
000D40 DA39 CB3A             8      SRL D
000D42 DA3B 10FC            13      DJNZ    RDDATE2
000D44 DA3D C1              10      POP BC
000D45 DA3E E607             7      AND 7
000D47 DA40 C9              10      RET
                                
       DA41                     _SYS2C:     ;(BDOS)時刻の獲得
000D48 DA41 C5              11      PUSH    BC
000D49 DA42 CD5ADA          17      CALL    RTCREAD
000D4C DA45 3A65EF          13      LD  A,(RTC_TT)
000D4F DA48 CDBDDA          17      CALL    BCD
000D52 DA4B 67               4      LD  H,A
000D53 DA4C 3A66EF          13      LD  A,(RTC_MM)
000D56 DA4F CDBDDA          17      CALL    BCD
000D59 DA52 6F               4      LD  L,A
000D5A DA53 3A67EF          13      LD  A,(RTC_SS)
000D5D DA56 57               4      LD  D,A
000D5E DA57 C1              10      POP BC
000D5F DA58 AF               4      XOR A
000D60 DA59 C9              10      RET
                                
       DA5A                     RTCREAD:
000D61 DA5A 0EF9             7      LD  C,0F9H
000D63 DA5C 3AB9EF          13      LD  A,(WK40)
000D66 DA5F 5F               4      LD  E,A
000D67 DA60 3E03             7      LD  A,3     ;コマンド３：タイムリードにセット
000D69 DA62 CD8CDA          17      CALL    RTCCMD
000D6C DA65 3E01             7      LD  A,1     ;コマンド１：レジスタシフトにセット
000D6E DA67 CD8CDA          17      CALL    RTCCMD
000D71 DA6A 0606             7      LD  B,6
000D73 DA6C 2167EF          10      LD  HL,RTC_SS
       DA6F                     RTCREAD1:
000D76 DA6F C5              11      PUSH    BC
000D77 DA70 0608             7      LD  B,8
       DA72                     RTCREAD2:
000D79 DA72 DB40            11      IN  A,(40H)     ;システムモードセンス BIT4:CDI
000D7B DA74 87               4      ADD A,A
000D7C DA75 87               4      ADD A,A
000D7D DA76 87               4      ADD A,A
000D7E DA77 87               4      ADD A,A
000D7F DA78 CB1E            15      RR  (HL)
000D81 DA7A CDB1DA          17      CALL    RTCCLK
000D84 DA7D 10F3            13      DJNZ    RTCREAD2
000D86 DA7F C1              10      POP BC
000D87 DA80 2B               6      DEC HL
000D88 DA81 10EC            13      DJNZ    RTCREAD1
000D8A DA83 AF               4      XOR A
000D8B DA84 CD8CDA          17      CALL    RTCCMD
000D8E DA87 7B               4      LD  A,E
000D8F DA88 32B9EF          13      LD  (WK40),A
000D92 DA8B C9              10      RET
                                
       DA8C                     RTCCMD:
000D93 DA8C 0604             7      LD  B,4
000D95 DA8E 07               4      RLCA
000D96 DA8F 07               4      RLCA
000D97 DA90 07               4      RLCA
       DA91                     RTCCMD1:
000D98 DA91 F5              11      PUSH    AF
000D99 DA92 F607             7      OR  7
000D9B DA94 D310            11      OUT (10H),A     ;プリンタデータ出力 兼 カレンダクロック(μPD1990AC)出力
000D9D DA96 CDB1DA          17      CALL    RTCCLK
000DA0 DA99 F1              10      POP AF
000DA1 DA9A 0F               4      RRCA
000DA2 DA9B 10F4            13      DJNZ    RTCCMD1
000DA4 DA9D 3E07             7      LD  A,7
000DA6 DA9F D310            11      OUT (10H),A     ;プリンタデータ出力 兼 カレンダクロック(μPD1990AC)出力
000DA8 DAA1 7B               4      LD  A,E
000DA9 DAA2 A1               4      AND C
000DAA DAA3 F602             7      OR  2
000DAC DAA5 D340            11      OUT (40H),A     ;ストローブポート
000DAE DAA7 A1               4      AND C
000DAF DAA8 00               4      NOP
000DB0 DAA9 D340            11      OUT (40H),A     ;ストローブポート
000DB2 DAAB 5F               4      LD  E,A
000DB3 DAAC 060D             7      LD  B,13
       DAAE                     RTCCMD3:
000DB5 DAAE 10FE            13      DJNZ    RTCCMD3
000DB7 DAB0 C9              10      RET
                                
       DAB1                     RTCCLK:
000DB8 DAB1 7B               4      LD  A,E
000DB9 DAB2 A1               4      AND C
000DBA DAB3 F604             7      OR  04H
000DBC DAB5 D340            11      OUT (40H),A
000DBE DAB7 A1               4      AND C
000DBF DAB8 00               4      NOP
000DC0 DAB9 D340            11      OUT (40H),A
000DC2 DABB 5F               4      LD  E,A
000DC3 DABC C9              10      RET
                                
                                ;------------------------
                                ;BCDの10進数化
                                ;in
                                ;   A  : BCD
                                ;out
                                ;   A  : 10進数
                                ;------------------------
       DABD                     BCD:
000DC4 DABD 4F               4      LD  C,A
000DC5 DABE E6F0             7      AND 0F0H    ;10の位
000DC7 DAC0 0F               4      RRCA
000DC8 DAC1 47               4      LD  B,A
000DC9 DAC2 0F               4      RRCA
000DCA DAC3 0F               4      RRCA
000DCB DAC4 80               4      ADD A,B
000DCC DAC5 47               4      LD  B,A
000DCD DAC6 79               4      LD  A,C
000DCE DAC7 E60F             7      AND 00FH    ;1の位
000DD0 DAC9 80               4      ADD A,B
000DD1 DACA C9              10      RET
                                
       DACB                     ESC1:
000DD2 DACB 7B               4      LD  A,E
000DD3 DACC FE41             7      CP  'A'
000DD5 DACE CAB0DB          10      JP  Z,CTRL1E
000DD8 DAD1 FE42             7      CP  'B'
000DDA DAD3 CACFDC          10      JP  Z,CTRL1F
000DDD DAD6 FE43             7      CP  'C'
000DDF DAD8 CA76DB          10      JP  Z,CTRL1C
000DE2 DADB FE44             7      CP  'D'
000DE4 DADD CA9BDB          10      JP  Z,CTRL1D
000DE7 DAE0 FE45             7      CP  'E'
000DE9 DAE2 2802            12      JR  Z,CT0CX
000DEB DAE4 FE6A             7      CP  'j'
       DAE6                     CT0CX:
000DED DAE6 CA9CDC          10      JP  Z,CTRL0C
000DF0 DAE9 FE48             7      CP  'H'
000DF2 DAEB CA1BDC          10      JP  Z,CTRL0B
000DF5 DAEE FE4A             7      CP  'J'
000DF7 DAF0 CA9FDC          10      JP  Z,CTRL06
000DFA DAF3 FE4B             7      CP  'K'
000DFC DAF5 CAEFDB          10      JP  Z,CTRL05
000DFF DAF8 FE4C             7      CP  'L'
000E01 DAFA CAD6DC          10      JP  Z,CTRL0E
000E04 DAFD FE54             7      CP  'T'
000E06 DAFF CAEFDB          10      JP  Z,CTRL05
000E09 DB02 FE78             7      CP  'x'
000E0B DB04 2804            12      JR  Z,ESC1X
000E0D DB06 FE79             7      CP  'y'
000E0F DB08 2002            12      JR  NZ,ESC1Y
       DB0A                     ESC1X:
000E11 DB0A 3601            10      LD  (HL),1
       DB0C                     ESC1Y:
000E13 DB0C FE3D             7      CP  '='
000E15 DB0E 2804            12      JR  Z,ESC1W
000E17 DB10 FE59             7      CP  'Y'
000E19 DB12 2002            12      JR  NZ,ESC1Z
       DB14                     ESC1W:
000E1B DB14 3602            10      LD  (HL),2
       DB16                     ESC1Z:
000E1D DB16 FE20             7      CP  020H
000E1F DB18 3802            12      JR  C,ESC1C
000E21 DB1A 87               4      ADD A,A
000E22 DB1B D0              11      RET NC
       DB1C                     ESC1C:
000E23 DB1C E1              10      POP HL
000E24 DB1D 1832            12      JR  ANK
                                
       DB1F                     ESC:
000E26 DB1F 2162DB          10      LD  HL,PRINTE5
000E29 DB22 E5              11      PUSH    HL
000E2A DB23 2145DB          10      LD  HL,ESCFLG
000E2D DB26 3600            10      LD  (HL),0
000E2F DB28 3D               4      DEC A
000E30 DB29 28A0            12      JR  Z,ESC1
000E32 DB2B 3D               4      DEC A
000E33 DB2C 2009            12      JR  NZ,ESC2
000E35 DB2E 3603            10      LD  (HL),3
000E37 DB30 7B               4      LD  A,E
000E38 DB31 D620             7      SUB 020H
000E3A DB33 323ADB          13      LD  (ESCYP+1),A
000E3D DB36 C9              10      RET
       DB37                     ESC2:
000E3E DB37 3D               4      DEC A
000E3F DB38 C0              11      RET NZ
000E40 DB39 2600             7  ESCYP:  LD  H,0
000E42 DB3B 7B               4      LD  A,E
000E43 DB3C D620             7      SUB 020H
000E45 DB3E 6F               4      LD  L,A
000E46 DB3F C3D6EF          10      JP  _LOC
                                
       DB42                     PRINT:
000E49 DB42 C5              11      PUSH    BC
000E4A DB43 E5              11      PUSH    HL
       DB45                     ESCFLG  EQU $+1
000E4B DB44 3E00             7      LD  A,000H      ;自己書き換え
000E4D DB46 B7               4      OR  A
000E4E DB47 20D6            12      JR  NZ,ESC
                                
000E50 DB49 3E1F             7      LD  A,01FH
000E52 DB4B BB               4      CP  E
000E53 DB4C 3018            12      JR  NC,CTRL
       DB4E                     INSFLG  EQU $
000E55 DB4E 017EDC          10      LD  BC,INSERT   ;自己書き換え
       DB51                     ANK:
000E58 DB51 CD28DC          17      CALL    LOC0
000E5B DB54 DB32            11      IN  A,(032H)
000E5D DB56 F5              11      PUSH    AF
000E5E DB57 E6EF             7      AND 0EFH        ;高速RAMアクセスモード
000E60 DB59 D332            11      OUT (032H),A
000E62 DB5B 73               7      LD  (HL),E
000E63 DB5C F1              10      POP AF
000E64 DB5D D332            11      OUT (032H),A
000E66 DB5F CD76DB          17      CALL    CTRL1C
       DB62                     PRINTE5:
000E69 DB62 E1              10      POP HL
000E6A DB63 C1              10      POP BC
000E6B DB64 AF               4      XOR A
000E6C DB65 C9              10      RET
                                
       DB66                     CTRL:
000E6D DB66 7B               4      LD  A,E
000E6E DB67 87               4      ADD A,A
000E6F DB68 F680             7      OR  080H
000E71 DB6A 6F               4      LD  L,A
000E72 DB6B 26F0             7      LD  H,CTRLTB/256
000E74 DB6D 7E               7      LD  A,(HL)
000E75 DB6E 2C               4      INC L
000E76 DB6F 66               7      LD  H,(HL)
000E77 DB70 6F               4      LD  L,A
000E78 DB71 CD0F00          17      CALL    JP_HL
000E7B DB74 18EC            12      JR  PRINTE5
                                
       DB76                     CTRL1C:
000E7D DB76 2A8EEF          16      LD  HL,(_TXADR)
000E80 DB79 2C               4      INC L
       DB7A                     PRINTE3:
000E81 DB7A 3AB1EF          13      LD  A,(_WIDTH)
000E84 DB7D 3D               4      DEC A
000E85 DB7E BD               4      CP  L
000E86 DB7F 3009            12      JR  NC,SET_TXADR_HL
000E88 DB81 2E00             7      LD  L,0
000E8A DB83 24               4      INC H
       DB84                     PRINTE8:
000E8B DB84 3A97EF          13      LD  A,(_LINE)
000E8E DB87 BC               4      CP  H
000E8F DB88 2804            12      JR  Z,PRINT2
       DB8A                     LOC:
       DB8A                     SET_TXADR_HL:
000E91 DB8A 228EEF          16      LD  (_TXADR),HL
       DB8D                     CTRL00:
000E94 DB8D C9              10      RET
                                
       DB8E                     PRINT2:
000E95 DB8E CDDCDC          17      CALL    SCR
000E98 DB91 25               4      DEC H
000E99 DB92 18F6            12      JR  SET_TXADR_HL
                                
       DB94                     CTRL08:
000E9B DB94 3A4EDB          13      LD  A,(INSFLG)
000E9E DB97 FECD             7      CP  0CDH        ;CALL ????
000EA0 DB99 2829            12      JR  Z,CTRL02
       DB9B                     CTRL1D:
000EA2 DB9B 2A8EEF          16      LD  HL,(_TXADR)
000EA5 DB9E 7C               4      LD  A,H
000EA6 DB9F B5               4      OR  L
000EA7 DBA0 C8              11      RET Z
000EA8 DBA1 7D               4      LD  A,L
000EA9 DBA2 B7               4      OR  A
000EAA DBA3 2803            12      JR  Z,CTRL1DX1
000EAC DBA5 2D               4      DEC L
000EAD DBA6 18E2            12      JR  SET_TXADR_HL
       DBA8                     CTRL1DX1:
000EAF DBA8 3AB1EF          13      LD  A,(_WIDTH)
000EB2 DBAB 3D               4      DEC A
000EB3 DBAC 6F               4      LD  L,A
000EB4 DBAD 25               4      DEC H
000EB5 DBAE 18DA            12      JR  SET_TXADR_HL
       DBB0                     CTRL1E:
000EB7 DBB0 2A8EEF          16      LD  HL,(_TXADR)
000EBA DBB3 7C               4      LD  A,H
000EBB DBB4 B7               4      OR  A
000EBC DBB5 C8              11      RET Z
000EBD DBB6 25               4      DEC H
000EBE DBB7 18D1            12      JR  SET_TXADR_HL
                                
       DBB9                     CTRL09:
000EC0 DBB9 2A8EEF          16      LD  HL,(_TXADR)
000EC3 DBBC 7D               4      LD  A,L
000EC4 DBBD E6F8             7      AND 0F8H
000EC6 DBBF C608             7      ADD A,8
000EC8 DBC1 6F               4      LD  L,A
000EC9 DBC2 18B6            12      JR  PRINTE3
                                
       DBC4                     CTRL02:
000ECB DBC4 3A8EEF          13      LD  A,(_TXADR)
000ECE DBC7 B7               4      OR  A
000ECF DBC8 28D1            12      JR  Z,CTRL1D
000ED1 DBCA CD9BDB          17      CALL    CTRL1D
000ED4 DBCD 2A8EEF          16      LD  HL,(_TXADR)
000ED7 DBD0 3AB1EF          13      LD  A,(_WIDTH)
000EDA DBD3 4F               4      LD  C,A
000EDB DBD4 95               4      SUB L
000EDC DBD5 47               4      LD  B,A
000EDD DBD6 79               4      LD  A,C
000EDE DBD7 3D               4      DEC A
000EDF DBD8 6F               4      LD  L,A
000EE0 DBD9 CD2BDC          17      CALL    LOC1
                                
000EE3 DBDC DB32            11      IN  A,(032H)
000EE5 DBDE F5              11      PUSH    AF
000EE6 DBDF E6EF             7      AND 0EFH        ;高速RAMアクセスモード
000EE8 DBE1 D332            11      OUT (032H),A
                                
000EEA DBE3 3E20             7      LD  A,020H
       DBE5                     C8X1:
000EEC DBE5 4E               7      LD  C,(HL)
000EED DBE6 77               7      LD  (HL),A
000EEE DBE7 2B               6      DEC HL
000EEF DBE8 79               4      LD  A,C
000EF0 DBE9 10FA            13      DJNZ    C8X1
                                
000EF2 DBEB F1              10      POP AF
000EF3 DBEC D332            11      OUT (032H),A
000EF5 DBEE C9              10      RET
                                
       DBEF                     CTRL05:
000EF6 DBEF CDD3EF          17      CALL    _POS
000EF9 DBF2 2A8EEF          16      LD  HL,(_TXADR)
000EFC DBF5 3AB1EF          13      LD  A,(_WIDTH)
000EFF DBF8 95               4      SUB L
000F00 DBF9 47               4      LD  B,A
000F01 DBFA CD28DC          17      CALL    LOC0
       DBFD                     CLLINE:
000F04 DBFD DB32            11      IN  A,(032H)
000F06 DBFF F5              11      PUSH    AF
000F07 DC00 E6EF             7      AND 0EFH        ;高速RAMアクセスモード
000F09 DC02 D332            11      OUT (032H),A
000F0B DC04 3E20             7      LD  A,020H
       DC06                     CLLINE1:
000F0D DC06 77               7      LD  (HL),A
000F0E DC07 23               6      INC HL
000F0F DC08 10FC            13      DJNZ    CLLINE1
                                
000F11 DC0A F1              10      POP AF
000F12 DC0B D332            11      OUT (032H),A
000F14 DC0D C9              10      RET
                                
       DC0E                     CTRL0D:
000F15 DC0E AF               4      XOR A
000F16 DC0F 328EEF          13      LD  (_TXADR),A
000F19 DC12 C9              10      RET
                                
       DC13                     CTRL12:
000F1A DC13 214EDB          10      LD  HL,INSFLG
000F1D DC16 7E               7      LD  A,(HL)
000F1E DC17 EECC             7      XOR 0CCH        ;CD:CALL ???? 1:LD BC,????
000F20 DC19 77               7      LD  (HL),A
000F21 DC1A C9              10      RET
                                
       DC1B                     CTRL0B:
000F22 DC1B 210000          10      LD  HL,0
000F25 DC1E 228EEF          16      LD  (_TXADR),HL
000F28 DC21 C9              10      RET
                                
       DC22                     CTRL1B:
000F29 DC22 3E01             7      LD  A,1
000F2B DC24 3245DB          13      LD  (ESCFLG),A
000F2E DC27 C9              10      RET
       DC28                     LOC0:
000F2F DC28 2A8EEF          16      LD  HL,(_TXADR)
       DC2B                     LOC1:
000F32 DC2B D5              11      PUSH    DE
000F33 DC2C E5              11      PUSH    HL
000F34 DC2D 6C               4      LD  L,H ;Y
000F35 DC2E 5C               4      LD  E,H
000F36 DC2F 2600             7      LD  H,0
000F38 DC31 54               4      LD  D,H
000F39 DC32 29              11      ADD HL,HL   ;*2
000F3A DC33 29              11      ADD HL,HL   ;*4
000F3B DC34 29              11      ADD HL,HL   ;*8
000F3C DC35 29              11      ADD HL,HL   ;*16
000F3D DC36 ED52            15      SBC HL,DE   ;*15
000F3F DC38 29              11      ADD HL,HL   ;*30
000F40 DC39 29              11      ADD HL,HL   ;*60
000F41 DC3A 29              11      ADD HL,HL   ;*120
000F42 DC3B D1              10      POP DE
000F43 DC3C 1600             7      LD  D,0
000F45 DC3E 19              11      ADD HL,DE   ;X
000F46 DC3F ED5BB2EF        20      LD  DE,(TVRAMTOP)
000F4A DC43 19              11      ADD HL,DE
000F4B DC44 D1              10      POP DE
000F4C DC45 C9              10      RET
                                
       DC46                     CONOUT1:
000F4D DC46 59               4      LD  E,C
000F4E DC47 CDCDEF          17      CALL    _PRINT
000F51 DC4A 7B               4      LD  A,E
000F52 DC4B FE0A             7      CP  00AH
000F54 DC4D 2006            12      JR  NZ,CURSOR_ON
000F56 DC4F CD0EDC          17      CALL    CTRL0D
000F59 DC52 CDEFDB          17      CALL    CTRL05
       DC55                     CURSOR_ON:
000F5C DC55 F5              11      PUSH    AF
000F5D DC56 3E81             7      LD  A,081H
       DC58                     CURSOR0:
000F5F DC58 D351            11      OUT (051H),A
000F61 DC5A 3A8EEF          13      LD  A,(_TXADR)
000F64 DC5D D350            11      OUT (050H),A
000F66 DC5F 3A8FEF          13      LD  A,(_TXADR+1)
000F69 DC62 D350            11      OUT (050H),A
000F6B DC64 F1              10      POP AF
000F6C DC65 C9              10      RET
       DC66                     CURSOR_OFF:
000F6D DC66 F5              11      PUSH    AF
000F6E DC67 3E80             7      LD  A,080H
000F70 DC69 18ED            12      JR  CURSOR0
                                
       DC6B                     CTRL07:
000F72 DC6B 3AB9EF          13      LD  A,(WK40)
000F75 DC6E F5              11      PUSH    AF
000F76 DC6F F620             7      OR  20H
000F78 DC71 D340            11      OUT (040H),A
000F7A DC73 0610             7      LD  B,16
       DC75                     C07X1:
000F7C DC75 CDE6DD          17      CALL    VBLANK
000F7F DC78 10FB            13      DJNZ    C07X1
000F81 DC7A F1              10      POP AF
000F82 DC7B D340            11      OUT (040H),A
000F84 DC7D C9              10      RET
                                
       DC7E                     INSERT:
000F85 DC7E 2A8EEF          16      LD  HL,(_TXADR)
000F88 DC81 3AB1EF          13      LD  A,(_WIDTH)
000F8B DC84 95               4      SUB L
000F8C DC85 47               4      LD  B,A
                                
000F8D DC86 CD28DC          17      CALL    LOC0
                                
000F90 DC89 DB32            11      IN  A,(032H)
000F92 DC8B F5              11      PUSH    AF
000F93 DC8C E6EF             7      AND 0EFH        ;高速RAMアクセスモード
000F95 DC8E D332            11      OUT (032H),A
                                
000F97 DC90 3E20             7      LD  A,020H
       DC92                     INS1:
000F99 DC92 4E               7      LD  C,(HL)
000F9A DC93 77               7      LD  (HL),A
000F9B DC94 79               4      LD  A,C
000F9C DC95 23               6      INC HL
000F9D DC96 10FA            13      DJNZ    INS1
                                
000F9F DC98 F1              10      POP AF
000FA0 DC99 D332            11      OUT (032H),A
000FA2 DC9B C9              10      RET
                                
       DC9C                     CTRL0C:
000FA3 DC9C CD1BDC          17      CALL    CTRL0B
       DC9F                     CTRL06:
000FA6 DC9F 2A8EEF          16      LD  HL,(_TXADR)
       DCA2                     CLS1:
000FA9 DCA2 DB32            11      IN  A,(032H)
000FAB DCA4 F5              11      PUSH    AF
000FAC DCA5 E6EF             7      AND 0EFH        ;高速RAMアクセスモード
000FAE DCA7 D332            11      OUT (032H),A
       DCA9                     CLS2:
000FB0 DCA9 E5              11      PUSH    HL
000FB1 DCAA 3AB1EF          13      LD  A,(_WIDTH)
000FB4 DCAD 95               4      SUB L
000FB5 DCAE 47               4      LD  B,A
000FB6 DCAF CD2BDC          17      CALL    LOC1
000FB9 DCB2 3E20             7      LD  A,020H
       DCB4                     CLS3:
000FBB DCB4 77               7      LD  (HL),A
000FBC DCB5 23               6      INC HL
000FBD DCB6 10FC            13      DJNZ    CLS3
000FBF DCB8 E1              10      POP HL
000FC0 DCB9 2E00             7      LD  L,0
000FC2 DCBB 24               4      INC H
000FC3 DCBC 3A97EF          13      LD  A,(_LINE)
000FC6 DCBF BC               4      CP  H
000FC7 DCC0 20E7            12      JR  NZ,CLS2
000FC9 DCC2 F1              10      POP AF
000FCA DCC3 D332            11      OUT (032H),A
000FCC DCC5 C9              10      RET
                                
       DCC6                     CTRL04:
000FCD DCC6 CDD3EF          17      CALL    _POS
000FD0 DCC9 7D               4      LD  A,L
000FD1 DCCA B7               4      OR  A
000FD2 DCCB C8              11      RET Z
       DCCC                     CTRL03:
000FD3 DCCC CD0EDC          17      CALL    CTRL0D
       DCCF                     CTRL0A:
       DCCF                     CTRL1F:
000FD6 DCCF 2A8EEF          16      LD  HL,(_TXADR)
000FD9 DCD2 24               4      INC H
000FDA DCD3 C384DB          10      JP  PRINTE8
                                
       DCD6                     CTRL0E:
000FDD DCD6 CDD3EF          17      CALL    _POS
000FE0 DCD9 7C               4      LD  A,H
000FE1 DCDA 1804            12      JR  SCR1
       DCDC                     SCR:
000FE3 DCDC 3A97EF          13      LD  A,(_LINE)
000FE6 DCDF 3D               4      DEC A
       DCE0                     SCR1:
000FE7 DCE0 C5              11      PUSH    BC
000FE8 DCE1 D5              11      PUSH    DE
000FE9 DCE2 E5              11      PUSH    HL
000FEA DCE3 F5              11      PUSH    AF
000FEB DCE4 210000          10      LD  HL,0
000FEE DCE7 CD2BDC          17      CALL    LOC1
000FF1 DCEA EB               4      EX  DE,HL
000FF2 DCEB 210001          10      LD  HL,0100H
000FF5 DCEE CD2BDC          17      CALL    LOC1
000FF8 DCF1 C1              10      POP BC
000FF9 DCF2 DB32            11      IN  A,(032H)
000FFB DCF4 F5              11      PUSH    AF
000FFC DCF5 E6EF             7      AND 0EFH        ;高速RAMアクセスモード
000FFE DCF7 D332            11      OUT (032H),A
001000 DCF9 78               4      LD  A,B
001001 DCFA B7               4      OR  A
       DCFB                     SCRUP1:
001002 DCFB 2815            12      JR  Z,SCRCL
001004 DCFD E5              11      PUSH    HL
001005 DCFE D5              11      PUSH    DE
001006 DCFF 0608             7      LD  B,8
001008 DD01 5F               4      LD  E,A
001009 DD02 210078          10      LD  HL,120*256
00100C DD05 55               4      LD  D,L
       DD06                     SCRH2:
00100D DD06 29              11      ADD HL,HL
00100E DD07 3001            12      JR  NC,SCRH3
001010 DD09 19              11      ADD HL,DE
       DD0A                     SCRH3:
001011 DD0A 10FA            13      DJNZ    SCRH2
001013 DD0C 4D               4      LD  C,L
001014 DD0D 44               4      LD  B,H
001015 DD0E D1              10      POP DE
001016 DD0F E1              10      POP HL
001017 DD10 EDB0                    LDIR
                                
       DD12                     SCRCL:
001019 DD12 F1              10      POP AF
00101A DD13 D332            11      OUT (032H),A
                                
00101C DD15 3AB1EF          13      LD  A,(_WIDTH)
00101F DD18 47               4      LD  B,A
001020 DD19 EB               4      EX  DE,HL
001021 DD1A CDFDDB          17      CALL    CLLINE
001024 DD1D E1              10      POP HL
001025 DD1E D1              10      POP DE
001026 DD1F C1              10      POP BC
001027 DD20 C9              10      RET
       DD21                     POS:
001028 DD21 2A8EEF          16      LD  HL,(_TXADR)
00102B DD24 C9              10      RET
                                
       DD25                     GETL:
00102C DD25 CDD3EF          17      CALL    _POS
00102F DD28 E5              11      PUSH    HL
001030 DD29 3ECD             7      LD  A,0CDH      ;CALL ????
001032 DD2B 324EDB          13      LD  (INSFLG),A
       DD2E                     GETL1:
001035 DD2E CDB0D9          17      CALL    _SYS08
001038 DD31 FE09             7      CP  9
00103A DD33 2008            12      JR  NZ,GETL1V
00103C DD35 2120FF          10      LD  HL,KBUF
00103F DD38 CDAAD6          17      CALL    MSX
001042 DD3B 18F1            12      JR  GETL1
       DD3D                     GETL1V:
001044 DD3D 5F               4      LD  E,A
001045 DD3E CDCDEF          17      CALL    _PRINT
                                
001048 DD41 7B               4      LD  A,E
001049 DD42 FE0D             7      CP  00DH
00104B DD44 20E8            12      JR  NZ,GETL1
00104D DD46 3E01             7      LD  A,1     ;LD BC,????
00104F DD48 324EDB          13      LD  (INSFLG),A
001052 DD4B 1120FF          10      LD  DE,KBUF
001055 DD4E 3AB1EF          13      LD  A,(_WIDTH)
001058 DD51 47               4      LD  B,A
001059 DD52 CDBDD4          17      CALL    ZERO_MEMORY_DE
                                
00105C DD55 D1              10      POP DE
00105D DD56 CDD3EF          17      CALL    _POS
001060 DD59 6B               4      LD  L,E
001061 DD5A 3AB1EF          13      LD  A,(_WIDTH)
001064 DD5D 95               4      SUB L
001065 DD5E 57               4      LD  D,A
001066 DD5F CD2BDC          17      CALL    LOC1
001069 DD62 4D               4      LD  C,L
00106A DD63 7C               4      LD  A,H
00106B DD64 F630             7      OR  030H
00106D DD66 47               4      LD  B,A
00106E DD67 5A               4      LD  E,D
00106F DD68 2120FF          10      LD  HL,KBUF
       DD6B                     GETL2:
001072 DD6B CDD0EF          17      CALL    _SCRN
001075 DD6E 03               6      INC BC
001076 DD6F 77               7      LD  (HL),A
001077 DD70 23               6      INC HL
001078 DD71 1D               4      DEC E
001079 DD72 20F7            12      JR  NZ,GETL2
       DD74                     GETL3:
00107B DD74 2B               6      DEC HL
00107C DD75 7E               7      LD  A,(HL)
00107D DD76 FE21             7      CP  021H
00107F DD78 D0              11      RET NC
001080 DD79 3600            10      LD  (HL),0
001082 DD7B 15               4      DEC D
001083 DD7C 20F6            12      JR  NZ,GETL3
001085 DD7E C9              10      RET
                                
       DD7F                     INKEY:
001086 DD7F FB               4      EI
001087 DD80 E5              11      PUSH    HL
001088 DD81 2A90EF          16      LD  HL,(_KEYPS)
00108B DD84 7C               4      LD  A,H
00108C DD85 AD               4      XOR L
00108D DD86 2809            12      JR  Z,INKEY1
00108F DD88 7C               4      LD  A,H
001090 DD89 3C               4      INC A
001091 DD8A 3291EF          13      LD  (_KEYPS+1),A
001094 DD8D 6F               4      LD  L,A
001095 DD8E 26FF             7      LD  H,KEYBF/256
001097 DD90 7E               7      LD  A,(HL)
       DD91                     INKEY1:
001098 DD91 E1              10      POP HL
001099 DD92 B7               4      OR  A
00109A DD93 C9              10      RET
                                
       DD94                     CHKEY:
00109B DD94 C5              11      PUSH    BC
00109C DD95 DB08            11      IN  A,(8)       ;6:SHIFT,7:CTRL
00109E DD97 4F               4      LD  C,A
00109F DD98 3A0E00          13      LD  A,(00EH)
0010A2 DD9B CB5F             8      BIT 3,A
0010A4 DD9D 2002            12      JR  NZ,CHKEYRSHIFT
0010A6 DD9F CBB1             8      RES 6,C
       DDA1                     CHKEYRSHIFT:
0010A8 DDA1 79               4      LD  A,C
0010A9 DDA2 3293EF          13      LD  (_KEYD+1),A
0010AC DDA5 E5              11      PUSH    HL
0010AD DDA6 0E00             7      LD  C,0
0010AF DDA8 2198F1          10      LD  HL,KEY_TABLE
0010B2 DDAB CB77             8      BIT 6,A
0010B4 DDAD 2003            12      JR  NZ,CHKEY0
0010B6 DDAF 2130EE          10      LD  HL,SHIFT_TABLE
       DDB2                     CHKEY0:
0010B9 DDB2 CB7F             8      BIT 7,A
0010BB DDB4 2003            12      JR  NZ,CHKEY1
0010BD DDB6 2198EE          10      LD  HL,CTRL_TABLE
       DDB9                     CHKEY1:
0010C0 DDB9 ED78            12      IN  A,(C)
0010C2 DDBB 0608             7      LD  B,8
       DDBD                     CHKEY2:
0010C4 DDBD 0F               4      RRCA
0010C5 DDBE 300B            12      JR  NC,CHKEY4
       DDC0                     CHKEY3:
0010C7 DDC0 23               6      INC HL
0010C8 DDC1 10FA            13      DJNZ    CHKEY2
0010CA DDC3 0C               4      INC C
0010CB DDC4 79               4      LD  A,C
0010CC DDC5 D60D             7      SUB 00DH
0010CE DDC7 20F0            12      JR  NZ,CHKEY1
0010D0 DDC9 1804            12      JR  CHKEY5
       DDCB                     CHKEY4:
0010D2 DDCB 7E               7      LD  A,(HL)
0010D3 DDCC B7               4      OR  A
0010D4 DDCD 28F1            12      JR  Z,CHKEY3
       DDCF                     CHKEY5:
0010D6 DDCF E1              10      POP HL
0010D7 DDD0 C1              10      POP BC
0010D8 DDD1 B7               4      OR  A
0010D9 DDD2 3292EF          13      LD  (_KEYD),A
0010DC DDD5 C9              10      RET
                                
       DDD6                     SCRN:
0010DD DDD6 E5              11      PUSH    HL
0010DE DDD7 DB32            11      IN  A,(032H)
0010E0 DDD9 67               4      LD  H,A
0010E1 DDDA E6EF             7      AND 0EFH        ;高速RAMアクセスモード
0010E3 DDDC D332            11      OUT (032H),A
0010E5 DDDE 0A               7      LD  A,(BC)
0010E6 DDDF 6F               4      LD  L,A
0010E7 DDE0 7C               4      LD  A,H
0010E8 DDE1 D332            11      OUT (032H),A
0010EA DDE3 7D               4      LD  A,L
0010EB DDE4 E1              10      POP HL
0010EC DDE5 C9              10      RET
                                
       DDE6                     VBLANK:
0010ED DDE6 F5              11      PUSH    AF
       DDE7                     VBLANK0:
0010EE DDE7 DB40            11      IN  A,(040H)
0010F0 DDE9 E620             7      AND 020H
0010F2 DDEB 20FA            12      JR  NZ,VBLANK0
       DDED                     VBLANK1:
0010F4 DDED DB40            11      IN  A,(040H)
0010F6 DDEF E620             7      AND 020H
0010F8 DDF1 28FA            12      JR  Z,VBLANK1
0010FA DDF3 F1              10      POP AF
0010FB DDF4 C9              10      RET
                                
       DDF5                     INIT_CRTC:
0010FC DDF5 3E03             7      LD  A,3     ;80桁
0010FE DDF7 D330            11      OUT (030H),A
001100 DDF9 32BEEF          13      LD  (WK30),A
                                
001103 DDFC 3E22             7      LD  A,022H      ;25行 64K RAM
001105 DDFE D331            11      OUT (031H),A
001107 DE00 32BFEF          13      LD  (WK31),A
                                
00110A DE03 3EFF             7      LD  A,0FFH
00110C DE05 D3E4            11      OUT (0E4H),A    ;割り込みレベル設定
00110E DE07 32B7EF          13      LD  (WKE4),A
001111 DE0A 3E00             7      LD  A,0
001113 DE0C D3E6            11      OUT (0E6H),A    ;割り込みマスク
                                
001115 DE0E 3E19             7      LD  A,019H
001117 DE10 D340            11      OUT (040H),A    ;CRT I/F 同期ビットオン
001119 DE12 32B9EF          13      LD  (WK40),A
00111C DE15 CDE6DD          17      CALL    VBLANK
                                
00111F DE18 AF               4      XOR A
001120 DE19 D351            11      OUT (051H),A    ;Reset CRTC
001122 DE1B 3EA0             7      LD  A,0A0H
001124 DE1D D368            11      OUT (068H),A    ;DMAC: Mode Set(Reset)
001126 DE1F 21C8F3          10      LD  HL,0F3C8H
001129 DE22 22B2EF          16      LD  (TVRAMTOP),HL
00112C DE25 0E64             7      LD  C,064H
00112E DE27 ED69            12      OUT (C),L       ;TVRAM LOW
001130 DE29 ED61            12      OUT (C),H       ;TVRAM HIGH
001132 DE2B 21B78B          10      LD  HL,08000H+120*25-1
001135 DE2E 0C               4      INC C       ;65H
001136 DE2F ED69            12      OUT (C),L
001138 DE31 ED61            12      OUT (C),H
00113A DE33 3ECE             7      LD  A,080H+80-2
00113C DE35 D350            11      OUT (050H),A
00113E DE37 3E98             7      LD  A,080H+25-1
001140 DE39 D350            11      OUT (050H),A
001142 DE3B DB40            11      IN  A,(040H)
001144 DE3D CB4F             8      BIT 1,A
001146 DE3F 21DE67          10      LD  HL,067DEH
001149 DE42 2003            12      JR  NZ,RESO1
00114B DE44 21586F          10      LD  HL,06F58H
       DE47                     RESO1:
00114E DE47 0E50             7      LD  C,050H
001150 DE49 ED61            12      OUT (C),H
001152 DE4B ED69            12      OUT (C),L
                                
001154 DE4D 3E53             7      LD  A,053H
001156 DE4F D350            11      OUT (050H),A
                                
001158 DE51 3E43             7      LD  A,043H
00115A DE53 D351            11      OUT (051H),A
                                
00115C DE55 3EE4             7      LD  A,0E4H
00115E DE57 D368            11      OUT (068H),A
                                
001160 DE59 3E20             7      LD  A,020H
001162 DE5B D351            11      OUT (051H),A
                                
001164 DE5D CDE6DD          17      CALL    VBLANK
       DE60                     IVBL1:
001167 DE60 DB40            11      IN  A,(040H)
001169 DE62 CB6F             8      BIT 5,A
00116B DE64 20FA            12      JR  NZ,IVBL1
                                
00116D DE66 3E11             7      LD  A,011H
00116F DE68 D340            11      OUT (040H),A    ;CRT I/F 同期ビットオフ
001171 DE6A 32B9EF          13      LD  (WK40),A
001174 DE6D C9              10      RET
                                
       DE6E                     BIOS:
001175 DE6E F3               4      DI
001176 DE6F F5              11      PUSH    AF
001177 DE70 3ABFEF          13      LD  A,(WK31)
00117A DE73 CB8F             8      RES 1,A
00117C DE75 D331            11      OUT (031H),A
00117E DE77 F1              10      POP AF
00117F DE78 CDA9E4          17      CALL    JP_BC
001182 DE7B F5              11      PUSH    AF
001183 DE7C 3ABFEF          13      LD  A,(WK31)
001186 DE7F D331            11      OUT (031H),A
001188 DE81 F1              10      POP AF
001189 DE82 FB               4      EI
00118A DE83 C9              10      RET
[EOF:88IO.ASM:SHIFT_JIS]
                                    INCLUDE "LDFILE.ASM"
                                
                                ;   LSX-Dodgers FILE
                                
       DE84                     FILEC:
00118B DE84 CD8FDE          17      CALL    FILE
       DE87                     FILEC2:
00118E DE87 3A15EF          13      LD  A,(FDRV+1)
001191 DE8A FE20             7      CP  020H
001193 DE8C C8              11      RET Z
001194 DE8D 1839            12      JR  SETDIR1
                                
       DE8F                     FILE:
001196 DE8F AF               4      XOR A
001197 DE90 3214EF          13      LD  (FDRV),A
00119A DE93 67               4      LD  H,A
00119B DE94 6F               4      LD  L,A
00119C DE95 2222EF          16      LD  (FDRV+14),HL
00119F DE98 CD66DF          17      CALL    SPCUT
0011A2 DE9B CD4BDF          17      CALL    CCHK3
0011A5 DE9E 2812            12      JR  Z,DEVI1
0011A7 DEA0 13               6      INC DE
0011A8 DEA1 1A               7      LD  A,(DE)
0011A9 DEA2 1B               6      DEC DE
0011AA DEA3 FE3A             7      CP  ':'
0011AC DEA5 200B            12      JR  NZ,DEVI1
0011AE DEA7 1A               7      LD  A,(DE)      ;DRIVE
0011AF DEA8 CD9BE1          17      CALL    CAP
0011B2 DEAB D640             7      SUB '@'
0011B4 DEAD 13               6      INC DE
0011B5 DEAE 13               6      INC DE
0011B6 DEAF 3214EF          13      LD  (FDRV),A
       DEB2                     DEVI1:
0011B9 DEB2 1A               7      LD  A,(DE)
0011BA DEB3 D65C             7      SUB 05CH        ;\
0011BC DEB5 2009            12      JR  NZ,NOROOT
0011BE DEB7 6F               4      LD  L,A     ;A=0でH=0のはずなのでHL=0
0011BF DEB8 222EEF          16      LD  (FDRV+26),HL
0011C2 DEBB 2C               4      INC L
0011C3 DEBC 2222EF          16      LD  (FDRV+14),HL
0011C6 DEBF 13               6      INC DE
       DEC0                     NOROOT:
                                
       DEC0                     SETDIR:
0011C7 DEC0 CDECDE          17      CALL    FILED
0011CA DEC3 1A               7      LD  A,(DE)
0011CB DEC4 FE5C             7      CP  05CH        ;\
0011CD DEC6 C0              11      RET NZ
0011CE DEC7 13               6      INC DE
       DEC8                     SETDIR1:
0011CF DEC8 3E10             7      LD  A,010H      ;Directory
0011D1 DECA 3221EF          13      LD  (FDRV+13),A
0011D4 DECD D5              11      PUSH    DE
0011D5 DECE 1114EF          10      LD  DE,FDRV
0011D8 DED1 2A1EF0          16      LD  HL,(STABLE+2*00FH)
0011DB DED4 CD0F00          17      CALL    JP_HL
0011DE DED7 D1              10      POP DE
0011DF DED8 B7               4      OR  A
0011E0 DED9 C0              11      RET NZ
                                
0011E1 DEDA 3A21EF          13      LD  A,(FDRV+13)
0011E4 DEDD CB67             8      BIT 4,A
0011E6 DEDF C8              11      RET Z
                                
0011E7 DEE0 CD33DF          17      CALL    FILEI
0011EA DEE3 2A2EEF          16      LD  HL,(FDRV+26)
0011ED DEE6 23               6      INC HL
0011EE DEE7 2222EF          16      LD  (FDRV+14),HL
0011F1 DEEA 18D4            12      JR  SETDIR
                                
       DEEC                     FILED:
0011F3 DEEC CD33DF          17      CALL    FILEI
0011F6 DEEF 2115EF          10      LD  HL,FNAME
                                
0011F9 DEF2 0608             7      LD  B,8
       DEF4                     FILE2:
0011FB DEF4 CD40DF          17      CALL    CCHKF
0011FE DEF7 C8              11      RET Z
0011FF DEF8 FE2A             7      CP  '*'
001201 DEFA 282E            12      JR  Z,FILE9
001203 DEFC FE2E             7      CP  '.'
001205 DEFE 280C            12      JR  Z,FILE4
001207 DF00 77               7      LD  (HL),A
001208 DF01 23               6      INC HL
001209 DF02 10F0            13      DJNZ    FILE2
                                
       DF04                     FILE3:
00120B DF04 CD40DF          17      CALL    CCHKF
00120E DF07 C8              11      RET Z
00120F DF08 FE2E             7      CP  '.'
001211 DF0A 20F8            12      JR  NZ,FILE3
                                
       DF0C                     FILE4:
001213 DF0C 211DEF          10      LD  HL,FNAME+8
001216 DF0F 0603             7      LD  B,3
                                
       DF11                     FILE4L:
001218 DF11 CD40DF          17      CALL    CCHKF
00121B DF14 C8              11      RET Z
00121C DF15 FE2E             7      CP  '.'
00121E DF17 2008            12      JR  NZ,FILE12
001220 DF19 3215EF          13      LD  (FNAME),A   ;Parent directory(..)
001223 DF1C 3216EF          13      LD  (FNAME+1),A
001226 DF1F 3E20             7      LD  A,020H
       DF21                     FILE12:
001228 DF21 FE2A             7      CP  '*'
00122A DF23 280A            12      JR  Z,FILE10
00122C DF25 77               7      LD  (HL),A
00122D DF26 23               6      INC HL
00122E DF27 10E8            13      DJNZ    FILE4L
001230 DF29 C9              10      RET
                                
       DF2A                     FILE9:              ;名前の*処理、名前の残りを?で埋める
001231 DF2A CD2FDF          17      CALL    FILE10
001234 DF2D 18D5            12      JR  FILE3
                                
       DF2F                     FILE10:
001236 DF2F 3E3F             7      LD  A,'?'
001238 DF31 1808            12      JR  FILL_MEMORY
       DF33                     FILEI:              ;名前＋拡張子をスペースで初期化
00123A DF33 3E20             7      LD  A,020H
00123C DF35 01000B          10      LD  BC,11*256   ;C=0にしておく
00123F DF38 2115EF          10      LD  HL,FNAME
       DF3B                     FILL_MEMORY:            ;HLからBバイトAで埋める
001242 DF3B 77               7      LD  (HL),A
001243 DF3C 23               6      INC HL
001244 DF3D 10FC            13      DJNZ    FILL_MEMORY
001246 DF3F C9              10      RET
                                
       DF40                     CCHKF:
001247 DF40 1A               7      LD  A,(DE)
001248 DF41 CD48DF          17      CALL    CCHK2
00124B DF44 C8              11      RET Z
00124C DF45 C3B3E2          10      JP  FKAN
                                
       DF48                     CCHK2:
00124F DF48 0C               4      INC C
001250 DF49 0D               4      DEC C
001251 DF4A C0              11      RET NZ
       DF4B                     CCHK3:              ;ZF=1 で使えない文字
001252 DF4B FE2B             7      CP  '+'
001254 DF4D C8              11      RET Z
001255 DF4E FE2C             7      CP  ','
001257 DF50 C8              11      RET Z
001258 DF51 FE2F             7      CP  '/'
00125A DF53 C8              11      RET Z
00125B DF54 FE3A             7      CP  ':'
00125D DF56 C8              11      RET Z
00125E DF57 FE3B             7      CP  ';'
001260 DF59 C8              11      RET Z
001261 DF5A FE3D             7      CP  '='
001263 DF5C C8              11      RET Z
001264 DF5D FE5C             7      CP  05CH    ;\
001266 DF5F C8              11      RET Z
001267 DF60 FE20             7      CP  020H
001269 DF62 D0              11      RET NC
00126A DF63 BF               4      CP  A       ;Z=1
00126B DF64 C9              10      RET
                                
       DF65                     SS1:
00126C DF65 13               6      INC DE
       DF66                     SPCUT:              ;スペースをカット
00126D DF66 1A               7      LD  A,(DE)
00126E DF67 FE20             7      CP  020H
001270 DF69 28FA            12      JR  Z,SS1
001272 DF6B C9              10      RET
                                
       DF6C                     SETDRVF:
001273 DF6C 1114EF          10      LD  DE,FDRV
       DF6F                     SETDRV0:
001276 DF6F CD78DF          17      CALL    SETDRV
001279 DF72 FDE1            14      POP IY
00127B DF74 C1              10      POP BC
00127C DF75 D1              10      POP DE
00127D DF76 E1              10      POP HL
00127E DF77 C9              10      RET
                                
       DF78                     SETDRV:
00127F DF78 E3              19      EX  (SP),HL     ;HL=RETRN ADDRESS
001280 DF79 D5              11      PUSH    DE      ;PUSH HL/DE/BC/IY
001281 DF7A C5              11      PUSH    BC
001282 DF7B 1A               7      LD  A,(DE)
001283 DF7C D5              11      PUSH    DE
001284 DF7D FDE3            23      EX  (SP),IY
                                
001286 DF7F CD8BDF          17      CALL    GETDRV
001289 DF82 3C               4      INC A
00128A DF83 FD7700          19      LD  (IY+0),A    ;(FCB)ドライブ番号
00128D DF86 3D               4      DEC A
00128E DF87 CDD9EF          17      CALL    _CHGDRV
                                
001291 DF8A E9               4      JP  (HL)
                                
       DF8B                     GETDRV:
001292 DF8B E67F             7      AND 07FH
001294 DF8D D601             7      SUB 001H
001296 DF8F 3003            12      JR  NC,GETDRV1
001298 DF91 3A87EF          13      LD  A,(_DVSW)   ;Current Drive
       DF94                     GETDRV1:
00129B DF94 3288EF          13      LD  (_DRV),A
00129E DF97 C9              10      RET
                                
       DF98                     SOPENX:
00129F DF98 1139EF          10      LD  DE,SFILE
0012A2 DF9B 1A               7      LD  A,(DE)
0012A3 DF9C FDBE00           7      CP  (IY+0)      ;(FCB)ドライブ番号
0012A6 DF9F 2024            12      JR  NZ,SOPEN
0012A8 DFA1 13               6      INC DE
0012A9 DFA2 FDE5            15      PUSH    IY
0012AB DFA4 E1              10      POP HL
0012AC DFA5 23               6      INC HL
0012AD DFA6 CD33E1          17      CALL    CPFILE
0012B0 DFA9 201A            12      JR  NZ,SOPEN
                                
0012B2 DFAB 2AF4F0          16      LD  HL,(SCDIR)
0012B5 DFAE FD750E          19      LD  (IY+14),L   ;(FCB)アクセスするディレクトリのクラスタ番号+1
0012B8 DFB1 FD740F          19      LD  (IY+15),H
                                
0012BB DFB4 2AF8F0          16      LD  HL,(SFNDF)  ;Direcroty location and Flags
0012BE DFB7 229FEF          16      LD  (_FILEN),HL
                                
0012C1 DFBA ED5BF6F0        20      LD  DE,(SFBPS)
0012C5 DFBE 2139EF          10      LD  HL,SFILE
0012C8 DFC1 36FF            10      LD  (HL),0FFH
0012CA DFC3 23               6      INC HL
0012CB DFC4 C9              10      RET
       DFC5                     SOPEN:
0012CC DFC5 21DBE0          10      LD  HL,FILESE
       DFC8                     SOPENC:
0012CF DFC8 2201E0          16      LD  (OPENPAT+1),HL
                                
0012D2 DFCB CDE2EF          17      CALL    _RDFATX     ;Detect Media
0012D5 DFCE 3856            12      JR  C,RDDERR
                                
0012D7 DFD0 AF               4      XOR A
0012D8 DFD1 329FEF          13      LD  (_FILEN),A
0012DB DFD4 CDE0E1          17      CALL    LDDIRX1     ;A=0で呼び出す
0012DE DFD7 2818            12      JR  Z,SDIRX1
                                
0012E0 DFD9 CDCCE0          17      CALL    READ_DIR    ;Sub Directory
0012E3 DFDC 3808            12      JR  C,SDIRX0
0012E5 DFDE 2A7EF0          16      LD  HL,(_DTBUF)
0012E8 DFE1 7E               7      LD  A,(HL)
0012E9 DFE2 FE2E             7      CP  '.'
0012EB DFE4 280F            12      JR  Z,SOPEN1
       DFE6                     SDIRX0:
0012ED DFE6 AF               4      XOR A
0012EE DFE7 32A0EF          13      LD  (_DIRF),A
0012F1 DFEA FD360E01        19      LD  (IY+14),1   ;(FCB)レコードサイズ
0012F5 DFEE FD770F          19      LD  (IY+15),A
       DFF1                     SDIRX1:
0012F8 DFF1 ED5BFCF0        20      LD  DE,(_DIRPS) ;Root Directory
       DFF5                     SOPEN1:
0012FC DFF5 0E20             7  SDECPAT:LD  C,32        ;自己書き換え 1セクタ辺りのディレクトリエントリ数  1024=32 / 512=16 / 256=8
       DFF7                     SOPEN1X:
0012FE DFF7 CDCCE0          17      CALL    READ_DIR    ;FILE SEARCH
001301 DFFA 382A            12      JR  C,RDDERR
001303 DFFC 2A7EF0          16      LD  HL,(_DTBUF)
       DFFF                     SOPEN2:
001306 DFFF D5              11      PUSH    DE
001307 E000 CDDBE0          17  OPENPAT:CALL    FILESE      ;(self-modifying code)
00130A E003 D1              10      POP DE
00130B E004 386E            12      JR  C,SOPENE
00130D E006 281B            12      JR  Z,SCF_FF_RET
       E008                     SOPEN3:
00130F E008 3AA0EF          13      LD  A,(_DIRF)   ;ディレクトリか判別
001312 E00B B7               4      OR  A
001313 E00C 200C            12      JR  NZ,SOPEN5
001315 E00E 13               6      INC DE      ;ルートディレクトリ
001316 E00F E5              11      PUSH    HL
001317 E010 210C00          10  MD_PAT: LD  HL,12       ;(self-modifying code)MAXDIR
00131A E013 ED52            15      SBC HL,DE       ;CF=0 なので SUB HL,DE
00131C E015 E1              10      POP HL
00131D E016 20DD            12      JR  NZ,SOPEN1
00131F E018 1807            12      JR  SOPEN6
       E01A                     SOPEN5:
001321 E01A CD0FE9          17      CALL    GNCLX       ;END DIR
001324 E01D D8              11      RET C
001325 E01E CD93E1          17      CALL    ENDCL
       E021                     SOPEN6:
001328 E021 38D2            12      JR  C,SOPEN1
       E023                     SCF_FF_RET:
00132A E023 37               4      SCF         ;CF=1
00132B E024 9F               4      SBC A,A     ;A=0FFH
00132C E025 C9              10      RET
                                
       E026                     RDDERR:
00132D E026 BF               4      CP  A       ;READ ERR CF=1 ZF=1
00132E E027 37               4      SCF
00132F E028 C9              10      RET
                                
       E029                     NOPEN:
001330 E029 21DBE0          10      LD  HL,FILESE
001333 E02C 2201E0          16      LD  (OPENPAT+1),HL
001336 E02F FD2A98EF        20      LD  IY,(_FCB)
00133A E033 CDC6E2          17      CALL    CHKWILDX
00133D E036 30EB            12      JR  NC,SCF_FF_RET
00133F E038 FD7E00          19      LD  A,(IY+0)    ;(FCB)ドライブ番号
001342 E03B 3D               4      DEC A
001343 E03C 3288EF          13      LD  (_DRV),A
001346 E03F CDD9EF          17      CALL    _CHGDRV
001349 E042 D8              11      RET C
00134A E043 2AF8F0          16      LD  HL,(SFNDF)  ;Direcroty location and Flags
00134D E046 229FEF          16      LD  (_FILEN),HL
                                
001350 E049 CDDBE1          17      CALL    LDDIRX
001353 E04C ED5B9AEF        20      LD  DE,(_FBPS)
001357 E050 CDCCE0          17      CALL    READ_DIR
00135A E053 38D1            12      JR  C,RDDERR
00135C E055 3A9EEF          13      LD  A,(_FBCNT)
00135F E058 3D               4      DEC A
001360 E059 28AD            12      JR  Z,SOPEN3
       E05B                     NOPEN2:
001362 E05B 2A9CEF          16      LD  HL,(_FBAD)
001365 E05E 012000          10      LD  BC,020H
001368 E061 09              11      ADD HL,BC
001369 E062 4F               4      LD  C,A
00136A E063 189A            12      JR  SOPEN2
                                
       E065                     SOPENE2:
00136C E065 229CEF          16      LD  (_FBAD),HL
00136F E068 79               4      LD  A,C
001370 E069 329EEF          13      LD  (_FBCNT),A
001373 E06C ED539AEF        20      LD  (_FBPS),DE
001377 E070 FD2298EF        20      LD  (_FCB),IY
       E074                     SOPENE:
00137B E074 AF               4      XOR A
00137C E075 C9              10      RET
                                
       E076                     COPEN:
00137D E076 FD360D20        19      LD  (IY+13),020H    ;(FCB)属性(アトリビュート)
                                
001381 E07A 21F8E0          10      LD  HL,NEXTSE
001384 E07D CDC8DF          17      CALL    SOPENC
001387 E080 D0              11      RET NC
001388 E081 C8              11      RET Z
001389 E082 3AA0EF          13      LD  A,(_DIRF)   ;ディレクトリか判別
00138C E085 B7               4      OR  A
00138D E086 37               4      SCF
00138E E087 C8              11      RET Z       ;ルートディレクトリ
00138F E088 0601             7      LD  B,1
001391 E08A CD24E3          17      CALL    WRDF
001394 E08D D8              11      RET C
001395 E08E ED5BFEF0        20      LD  DE,(_CLPS)
001399 E092 D5              11      PUSH    DE
00139A E093 CD5CE1          17      CALL    DCPAT
00139D E096 CD9AE7          17      CALL    DRDNX
0013A0 E099 2A7EF0          16      LD  HL,(_DTBUF) ;ディレクトリエントリを0クリア
0013A3 E09C 3A98E6          13      LD  A,(SECSZ+2) ;1024=4 / 512=2 / 256=1
0013A6 E09F 47               4      LD  B,A
0013A7 E0A0 AF               4      XOR A
0013A8 E0A1 4F               4      LD  C,A
       E0A2                     COPENCL:
0013A9 E0A2 77               7      LD  (HL),A
0013AA E0A3 EDA1            16      CPI         ;HL=HL+1 BC=BC-1 BCが0の場合にP/V=0
0013AC E0A5 EAA2E0          10      JP  PE,COPENCL
                                
0013AF E0A8 3A7AE1          13      LD  A,(SPCPAT+1)    ;1クラスタの論理セクタ数
0013B2 E0AB 3D               4      DEC A
0013B3 E0AC 2819            12      JR  Z,COPENE
0013B5 E0AE 3E01             7      LD  A,1     ;1セクタ辺りのセクタ数が2以上の場合
0013B7 E0B0 3207E9          13      LD  (_SECPS+1),A
0013BA E0B3 D1              10      POP DE      ;DE=(_CLPS)
0013BB E0B4 D5              11      PUSH    DE
       E0B5                     COPEN1:
0013BC E0B5 D5              11      PUSH    DE      ;データバッファに入らないセクタもゼロクリア
0013BD E0B6 C5              11      PUSH    BC
0013BE E0B7 2A7EF0          16      LD  HL,(_DTBUF)
0013C1 E0BA CD76E1          17      CALL    CLUSTX
0013C4 E0BD CD9FEA          17      CALL    DWT24
0013C7 E0C0 C1              10      POP BC
0013C8 E0C1 D1              10      POP DE
0013C9 E0C2 CD06E9          17      CALL    NEXTX
0013CC E0C5 20EE            12      JR  NZ,COPEN1
       E0C7                     COPENE:
0013CE E0C7 2A7EF0          16      LD  HL,(_DTBUF)
0013D1 E0CA D1              10      POP DE
0013D2 E0CB C9              10      RET
                                
       E0CC                     READ_DIR:
0013D3 E0CC ED53FEF0        20      LD  (_CLPS),DE
0013D7 E0D0 C5              11      PUSH    BC
0013D8 E0D1 D5              11      PUSH    DE
0013D9 E0D2 CD5CE1          17      CALL    DCPAT
0013DC E0D5 CD7AE7          17      CALL    DRDX
0013DF E0D8 D1              10      POP DE
0013E0 E0D9 C1              10      POP BC
0013E1 E0DA C9              10      RET
                                
       E0DB                     FILESE:
0013E2 E0DB 7E               7      LD  A,(HL)
0013E3 E0DC B7               4      OR  A
0013E4 E0DD C8              11      RET Z       ;END:ZF=1 CF=0
0013E5 E0DE FEE5             7      CP  0E5H
0013E7 E0E0 280E            12      JR  Z,FILESE1
0013E9 E0E2 FDE5            15      PUSH    IY
0013EB E0E4 D1              10      POP DE
0013EC E0E5 13               6      INC DE
0013ED E0E6 E5              11      PUSH    HL
0013EE E0E7 CD33E1          17      CALL    CPFILE
0013F1 E0EA CC54E1          17      CALL    Z,CPFILE2
0013F4 E0ED E1              10      POP HL
0013F5 E0EE 37               4      SCF
0013F6 E0EF C8              11      RET Z       ;!!!:(ZF=1) CF=1
       E0F0                     FILESE1:
0013F7 E0F0 CD07E1          17      CALL    FNEXT
0013FA E0F3 20E6            12      JR  NZ,FILESE
       E0F5                     ZF0_CF0_AFF_RET:
0013FC E0F5 F6FF             7      OR  0FFH        ;ZF=0 CF=0
0013FE E0F7 C9              10      RET
                                
       E0F8                     NEXTSE:
0013FF E0F8 7E               7      LD  A,(HL)
001400 E0F9 B7               4      OR  A
001401 E0FA 37               4      SCF
001402 E0FB C8              11      RET Z       ;!!!:ZF=1 CF=1
001403 E0FC FEE5             7      CP  0E5H
001405 E0FE 37               4      SCF
001406 E0FF C8              11      RET Z       ;!!!:(ZF=1) CF=1
001407 E100 CD07E1          17      CALL    FNEXT
00140A E103 20F3            12      JR  NZ,NEXTSE
00140C E105 18EE            12      JR  ZF0_CF0_AFF_RET
                                
       E107                     FNEXT:
00140E E107 E5              11      PUSH    HL
00140F E108 219FEF          10      LD  HL,_FILEN
001412 E10B 34              11      INC (HL)
001413 E10C E1              10      POP HL
001414 E10D 112000          10      LD  DE,020H
001417 E110 19              11      ADD HL,DE
001418 E111 0D               4      DEC C
001419 E112 C9              10      RET
                                
       E113                     CPNAME:
00141A E113 C5              11      PUSH    BC
00141B E114 D5              11      PUSH    DE
00141C E115 E5              11      PUSH    HL
00141D E116 CD2DE1          17      CALL    CPFILE4
001420 E119 E1              10      POP HL
001421 E11A 23               6      INC HL
001422 E11B 23               6      INC HL
001423 E11C 23               6      INC HL
001424 E11D 23               6      INC HL
001425 E11E D1              10      POP DE
001426 E11F C1              10      POP BC
001427 E120 2005            12      JR  NZ,CPNAME1
001429 E122 7E               7      LD  A,(HL)
00142A E123 23               6      INC HL
00142B E124 66               7      LD  H,(HL)
00142C E125 6F               4      LD  L,A
00142D E126 C9              10      RET
       E127                     CPNAME1:
00142E E127 23               6      INC HL
00142F E128 23               6      INC HL
001430 E129 10E8            13      DJNZ    CPNAME
001432 E12B 37               4      SCF
001433 E12C C9              10      RET
                                
       E12D                     CPFILE4:
001434 E12D C5              11      PUSH    BC
001435 E12E 010004          10      LD  BC,00400H
001438 E131 1804            12      JR  CPSTR1
       E133                     CPFILE:
00143A E133 C5              11      PUSH    BC
00143B E134 01000B          10      LD  BC,00B00H
       E137                     CPSTR1:
00143E E137 1A               7      LD  A,(DE)
00143F E138 FE3F             7      CP  '?'     ;Wild card
001441 E13A 2812            12      JR  Z,CPSTR2
001443 E13C 7E               7      LD  A,(HL)
001444 E13D CDACE2          17      CALL    FKANC
001447 E140 E5              11      PUSH    HL
001448 E141 67               4      LD  H,A
001449 E142 1A               7      LD  A,(DE)
00144A E143 CB01             4      RLC C
00144C E145 CDACE2          17      CALL    FKANC
00144F E148 CB09             4      RRC C
001451 E14A BC               4      CP  H       ;CP (HL),(DE)
001452 E14B E1              10      POP HL
001453 E14C 2004            12      JR  NZ,CPSTR3
       E14E                     CPSTR2:
001455 E14E 13               6      INC DE
001456 E14F 23               6      INC HL
001457 E150 10E5            13      DJNZ    CPSTR1
       E152                     CPSTR3:
001459 E152 C1              10      POP BC
00145A E153 C9              10      RET
                                
       E154                     CPFILE2:
00145B E154 FD7E0D          19      LD  A,(IY+13)   ;(FCB)属性(アトリビュート)
00145E E157 F6E1             7      OR  0E1H
001460 E159 2F               4      CPL
001461 E15A A6               7      AND (HL)
001462 E15B C9              10      RET
                                
       E15C                     DCPAT:
001463 E15C 0E00             7      LD  C,0
001465 E15E 2A7EF0          16      LD  HL,(_DTBUF)
001468 E161 3AA0EF          13      LD  A,(_DIRF)   ;ディレクトリか判別
00146B E164 B7               4      OR  A
00146C E165 C8              11      RET Z       ;ルートディレクトリの場合はCレジスタを0にしておく(CDEがセクタ番号)
00146D E166 3A7AE1          13      LD  A,(SPCPAT+1)
001470 E169 4F               4      LD  C,A
001471 E16A 3A07E9          13      LD  A,(_SECPS+1)
001474 E16D B9               4      CP  C
001475 E16E 3801            12      JR  C,DC1
001477 E170 AF               4      XOR A
       E171                     DC1:
001478 E171 F680             7      OR  080H
00147A E173 32A0EF          13      LD  (_DIRF),A   ;bit0-6:セクタインデックス
       E176                     CLUSTX:
00147D E176 E5              11      PUSH    HL
00147E E177 EB               4      EX  DE,HL
00147F E178 AF               4      XOR A
001480 E179 0E01             7  SPCPAT: LD  C,1     ;自己書き換え（1クラスタの論理セクタ数）
       E17B                     L_CLDBL:
001482 E17B CB19             8      RR  C       ;->CF
001484 E17D 3804            12      JR  C,E_CLDBL
001486 E17F 29              11      ADD HL,HL       ;*2
001487 E180 8F               4      ADC A,A
001488 E181 18F8            12      JR  L_CLDBL
       E183                     E_CLDBL:
00148A E183 4F               4      LD  C,A
00148B E184 3A07E9          13      LD  A,(_SECPS+1)
00148E E187 B5               4      OR  L
00148F E188 6F               4      LD  L,A
001490 E189 110800          10  CLSPAT: LD  DE,8    ;+8 (2D)  !ADDCL (self-modifying code)
001493 E18C AF               4      XOR A
001494 E18D 19              11      ADD HL,DE   ;データ格納領域の先頭論理セクタ番号
001495 E18E 89               4      ADC A,C
001496 E18F 4F               4      LD  C,A
001497 E190 EB               4      EX  DE,HL
001498 E191 E1              10      POP HL
001499 E192 C9              10      RET
                                
       E193                     ENDCL:
00149A E193 7A               4      LD  A,D ;END CLUSTER
00149B E194 FE01             7  CLPAT1: CP  1   ;164=356    (self-modifying code)
00149D E196 C0              11      RET NZ
00149E E197 7B               4      LD  A,E
00149F E198 FE64             7  CLPAT2: CP  064H    ;       (self-modifying code)
0014A1 E19A C9              10      RET
                                
       E19B                     CAP:
0014A2 E19B FE61             7      CP  'a'
0014A4 E19D D8              11      RET C
0014A5 E19E FE7B             7      CP  'z'+1
0014A7 E1A0 D0              11      RET NC
0014A8 E1A1 D620             7      SUB 020H
0014AA E1A3 C9              10      RET
       E1A4                     CAP2:
0014AB E1A4 CD9BE1          17      CALL    CAP
       E1A7                     CAP3:
0014AE E1A7 CDB0E1          17      CALL    CAP4
0014B1 E1AA FE21             7      CP  021H
0014B3 E1AC D0              11      RET NC
0014B4 E1AD 3EA0             7      LD  A,0A0H
0014B6 E1AF C9              10      RET
       E1B0                     CAP4:
0014B7 E1B0 FE05             7      CP  5
0014B9 E1B2 C0              11      RET NZ
0014BA E1B3 3EE5             7      LD  A,0E5H
0014BC E1B5 C9              10      RET
                                
       E1B6                     CHDIR:
0014BD E1B6 CDCDEB          17      CALL    GETDPBD
0014C0 E1B9 381D            12      JR  C,CHDIR2
0014C2 E1BB DD751A          19      LD  (IX+01AH),L     ;_SDIR_
0014C5 E1BE DD741B          19      LD  (IX+01BH),H     ;_SDIR_+1
0014C8 E1C1 1815            12      JR  CHDIR2      ;POP_IX_RET
                                
       E1C3                     LDDIR:
0014CA E1C3 CDCDEB          17      CALL    GETDPBD
0014CD E1C6 DD5E1A          19      LD  E,(IX+01AH)     ;_SDIR_
0014D0 E1C9 DD561B          19      LD  D,(IX+01BH)     ;_SDIR_+1
0014D3 E1CC 13               6      INC DE
0014D4 E1CD FD730E          19      LD  (IY+14),E   ;(FCB)アクセスするディレクトリのクラスタ番号+1
0014D7 E1D0 FD720F          19      LD  (IY+15),D
0014DA E1D3 1B               6      DEC DE
0014DB E1D4 AF               4      XOR A
0014DC E1D5 32A0EF          13      LD  (_DIRF),A
       E1D8                     CHDIR2:
0014DF E1D8 DDE1            14      POP IX
0014E1 E1DA C9              10      RET
                                
       E1DB                     LDDIRX:
0014E2 E1DB 3AA0EF          13      LD  A,(_DIRF)   ;(FCB)アクセスするディレクトリのセクタインデックス
0014E5 E1DE E67F             7      AND 07FH
       E1E0                     LDDIRX1:
0014E7 E1E0 3207E9          13      LD  (_SECPS+1),A
0014EA E1E3 FD5E0E          19      LD  E,(IY+14)   ;(FCB)アクセスするディレクトリのクラスタ番号+1
0014ED E1E6 FD560F          19      LD  D,(IY+15)
0014F0 E1E9 1B               6      DEC DE
0014F1 E1EA CD93E1          17      CALL    ENDCL
0014F4 E1ED D4C3E1          17      CALL    NC,LDDIR
       E1F0                     LDDIRS:
0014F7 E1F0 7A               4      LD  A,D
0014F8 E1F1 B3               4      OR  E
0014F9 E1F2 32A0EF          13      LD  (_DIRF),A   ;ディレクトリか判別
0014FC E1F5 C9              10      RET
                                
       E1F6                     KILL:
0014FD E1F6 CDC6E2          17      CALL    CHKWILDX
001500 E1F9 3834            12      JR  C,KILLW
001502 E1FB CD98DF          17      CALL    SOPENX
       E1FE                     KILLS:
001505 E1FE 3E1F             7      LD  A,01FH
001507 E200 D442E2          17      CALL    NC,CHKATT
00150A E203 D8              11      RET C
       E204                     KILLSX:
00150B E204 36E5            10      LD  (HL),0E5H   ;DIR
00150D E206 CDA0E2          17      CALL    WTDB
001510 E209 111A00          10      LD  DE,01AH
001513 E20C 19              11      ADD HL,DE
001514 E20D 5E               7      LD  E,(HL)
001515 E20E 23               6      INC HL
001516 E20F 56               7      LD  D,(HL)
       E210                     KILLS1:
001517 E210 CD93E1          17      CALL    ENDCL
00151A E213 D0              11      RET NC      ;CF=0
00151B E214 21FEFF          10      LD  HL,0-2
00151E E217 19              11      ADD HL,DE
00151F E218 D0              11      RET NC      ;DE= 0 or 1
001520 E219 D5              11      PUSH    DE
001521 E21A CDF7EF          17      CALL    _GNCL
001524 E21D ED53FEF0        20      LD  (_CLPS),DE
001528 E221 D1              10      POP DE
001529 E222 210000          10      LD  HL,0
00152C E225 D4FAEF          17      CALL    NC,_SNCL
00152F E228 D8              11      RET C
001530 E229 ED5BFEF0        20      LD  DE,(_CLPS)  ;FAT
001534 E22D 18E1            12      JR  KILLS1
                                
       E22F                     KILLW:
001536 E22F CDC5DF          17      CALL    SOPEN
       E232                     KILLW1:
001539 E232 380B            12      JR  C,KILLW2
00153B E234 CD65E0          17      CALL    SOPENE2
00153E E237 CDFEE1          17      CALL    KILLS
001541 E23A CD29E0          17      CALL    NOPEN
001544 E23D 18F3            12      JR  KILLW1
       E23F                     KILLW2:
001546 E23F C8              11      RET Z
001547 E240 3F               4      CCF
001548 E241 C9              10      RET
                                
       E242                     CHKATT:
001549 E242 E5              11      PUSH    HL
00154A E243 110B00          10      LD  DE,00BH
00154D E246 19              11      ADD HL,DE
00154E E247 A6               7      AND (HL)
00154F E248 E1              10      POP HL
001550 E249 C8              11      RET Z
001551 E24A 37               4      SCF
001552 E24B C9              10      RET
                                
       E24C                     NAME:
001553 E24C CDC6E2          17      CALL    CHKWILDX
001556 E24F D8              11      RET C
001557 E250 110400          10      LD  DE,4
00155A E253 19              11      ADD HL,DE
00155B E254 226CE2          16      LD  (NAMEP+2),HL
00155E E257 23               6      INC HL
00155F E258 CDCAE2          17      CALL    CHKWILD
001562 E25B D8              11      RET C
                                
001563 E25C CD98DF          17      CALL    SOPENX
001566 E25F 3E0F             7      LD  A,00FH
001568 E261 D442E2          17      CALL    NC,CHKATT
00156B E264 D8              11      RET C
                                
00156C E265 FD7E00          19      LD  A,(IY+0)
00156F E268 FDE5            15      PUSH    IY
001571 E26A FD210000        14  NAMEP:  LD  IY,0        ;自己書き換え
001575 E26E FD7700          19      LD  (IY+0),A
001578 E271 CD98DF          17      CALL    SOPENX
00157B E274 FDE3            23      EX  (SP),IY
00157D E276 3F               4      CCF
00157E E277 D4C5DF          17      CALL    NC,SOPEN
001581 E27A EB               4      EX  DE,HL
001582 E27B E1              10      POP HL
001583 E27C D8              11      RET C
                                
       E27D                     SETNAME:
001584 E27D 01000B          10      LD  BC,11*256
001587 E280 23               6      INC HL
001588 E281 7E               7      LD  A,(HL)
001589 E282 FEE5             7      CP  0E5H
00158B E284 2004            12      JR  NZ,SNAME1
00158D E286 3E05             7      LD  A,5
00158F E288 180E            12      JR  SNAME3
       E28A                     SNAME1:
001591 E28A 7E               7      LD  A,(HL)
001592 E28B 0C               4      INC C
001593 E28C 0D               4      DEC C
001594 E28D 2009            12      JR  NZ,SNAME3
001596 E28F CD9BE1          17      CALL    CAP
001599 E292 FEA0             7      CP  0A0H
00159B E294 2002            12      JR  NZ,SNAME3
00159D E296 3E20             7      LD  A,020H
       E298                     SNAME3:
00159F E298 12               7      LD  (DE),A
0015A0 E299 7E               7      LD  A,(HL)
0015A1 E29A 23               6      INC HL
0015A2 E29B CDB3E2          17      CALL    FKAN
0015A5 E29E 10EA            13      DJNZ    SNAME1
       E2A0                     WTDB:
0015A7 E2A0 3EFF             7      LD  A,0FFH
0015A9 E2A2 3239EF          13      LD  (SFILE),A
       E2A5                     SWTDBF:
0015AC E2A5 3E01             7      LD  A,1
0015AE E2A7 32A4EF          13      LD  (_WTDBF),A
0015B1 E2AA AF               4      XOR A
0015B2 E2AB C9              10      RET
                                
       E2AC                     FKANC:
0015B3 E2AC CB41             8      BIT 0,C
0015B5 E2AE CCA4E1          17      CALL    Z,CAP2
0015B8 E2B1 1801            12      JR  FKANX
       E2B3                     FKAN:           ;漢字チェック
0015BA E2B3 13               6      INC DE
       E2B4                     FKANX:
0015BB E2B4 CB41             8      BIT 0,C
0015BD E2B6 CB81             8      RES 0,C
0015BF E2B8 C0              11      RET NZ
0015C0 E2B9 FE80             7      CP  080H
0015C2 E2BB D8              11      RET C
0015C3 E2BC FEA0             7      CP  0A0H
0015C5 E2BE 3803            12      JR  C,FKAN1
0015C7 E2C0 FEE0             7      CP  0E0H
0015C9 E2C2 D8              11      RET C
       E2C3                     FKAN1:
0015CA E2C3 0C               4      INC C
0015CB E2C4 A7               4      AND A
0015CC E2C5 C9              10      RET
                                
       E2C6                     CHKWILDX:
0015CD E2C6 FDE5            15      PUSH    IY
0015CF E2C8 E1              10      POP HL
0015D0 E2C9 23               6      INC HL
       E2CA                     CHKWILD:
0015D1 E2CA 060B             7      LD  B,11
0015D3 E2CC 3E3F             7      LD  A,'?'
       E2CE                     CHKWIL1:
0015D5 E2CE BE               7      CP  (HL)
0015D6 E2CF 23               6      INC HL
0015D7 E2D0 37               4      SCF
0015D8 E2D1 C8              11      RET Z
0015D9 E2D2 10FA            13      DJNZ    CHKWIL1
0015DB E2D4 AF               4      XOR A
0015DC E2D5 C9              10      RET
                                
       E2D6                     SDIRENT:        ;IY=FCB HL=DIR
0015DD E2D6 D5              11      PUSH    DE
0015DE E2D7 E5              11      PUSH    HL
0015DF E2D8 FDE5            15      PUSH    IY
0015E1 E2DA D1              10      POP DE
0015E2 E2DB EB               4      EX  DE,HL
0015E3 E2DC CD7DE2          17      CALL    SETNAME
                                ;               Attribute
0015E6 E2DF FD7E0D          19      LD  A,(IY+13)   ;(FCB)属性(アトリビュート)
0015E9 E2E2 12               7      LD  (DE),A
0015EA E2E3 13               6      INC DE
                                ;               Reserved
0015EB E2E4 AF               4      XOR A
0015EC E2E5 060A             7      LD  B,10
       E2E7                     SDE1:
0015EE E2E7 12               7      LD  (DE),A
0015EF E2E8 13               6      INC DE
0015F0 E2E9 10FC            13      DJNZ    SDE1
                                                    ;(FCB)更新時刻
0015F2 E2EB 21EAF0          10      LD  HL,SDDATA       ;(FCB)更新年月日
0015F5 E2EE 060A             7      LD  B,SDDATAE-SDDATA    ;(FCB)ファイルの先頭クラスタ
       E2F0                     SDLOOP:                 ;(FCB)ファイルのサイズ(バイト単位)
0015F7 E2F0 7E               7      LD  A,(HL)
0015F8 E2F1 23               6      INC HL
0015F9 E2F2 32F7E2          13      LD  (SDPAT+2),A
0015FC E2F5 FD7E00          19  SDPAT:  LD  A,(IY+0)    ;LD A,(IY+A)
0015FF E2F8 12               7      LD  (DE),A
001600 E2F9 13               6      INC DE
001601 E2FA 10F4            13      DJNZ    SDLOOP
                                
001603 E2FC AF               4      XOR A
001604 E2FD E1              10      POP HL
001605 E2FE D1              10      POP DE
001606 E2FF C9              10      RET
                                
       E300                     WOPEN:
001607 E300 FD7E0D          19      LD  A,(IY+13)   ;(FCB)属性(アトリビュート)
00160A E303 E61F             7      AND 01FH
00160C E305 37               4      SCF
00160D E306 C0              11      RET NZ
00160E E307 FD361CFE        19      LD  (IY+28),0FEH    ;(FCB)オープンモード
       E30B                     TOPEN2:
001612 E30B AF               4      XOR A
       E30C                     TOPEN:              ;Initializes the time stamp
001613 E30C FD3617FF        19      LD  (IY+23),0FFH    ;(FCB)更新時刻
001617 E310 C9              10      RET
                                
       E311                     WRDFX:
001618 E311 3A7AE1          13      LD  A,(SPCPAT+1)    ;1クラスタの論理セクタ
       E314                     L_WRFX:
00161B E314 1F               4      RRA         ;->CF
00161C E315 3806            12      JR  C,E_WRFX
00161E E317 CB39             8      SRL C
001620 E319 CB1C             8      RR  H       ;CH=CH/2
001622 E31B 18F7            12      JR  L_WRFX
       E31D                     E_WRFX:
001624 E31D 44               4      LD  B,H
001625 E31E 04               4      INC B
001626 E31F 3E37             7      LD  A,037H      ;SCF
001628 E321 3297E7          13      LD  (DRDN1),A
                                
       E324                     WRDF:               ;Bクラスタ分FATを確保する
00162B E324 110200          10      LD  DE,2
00162E E327 AF               4      XOR A
00162F E328 3207E9          13      LD  (_SECPS+1),A
       E32B                     WRDF1:
001632 E32B C5              11      PUSH    BC
001633 E32C D5              11      PUSH    DE
001634 E32D CDF7EF          17      CALL    _GNCL
001637 E330 381C            12      JR  C,WRDF3
001639 E332 7A               4      LD  A,D     ;空いているかチェック
00163A E333 B3               4      OR  E
00163B E334 2027            12      JR  NZ,WRDF4
00163D E336 E1              10      POP HL      ;HL=空いているクラスタ
00163E E337 E5              11      PUSH    HL
00163F E338 ED5BFEF0        20      LD  DE,(_CLPS)  ;DE=元の(_CLPS)
001643 E33C 22FEF0          16      LD  (_CLPS),HL
001646 E33F 7A               4      LD  A,D     ;元の(_CLPS)が 0 か?
001647 E340 B3               4      OR  E
001648 E341 2008            12      JR  NZ,WRDF2
00164A E343 FD751A          19      LD  (IY+26),L   ;(FCB)ファイルの先頭クラスタ
00164D E346 FD741B          19      LD  (IY+27),H   ;元が空の場合はFCBにクラスタをセットする
001650 E349 1803            12      JR  WRDF3
       E34B                     WRDF2:
001652 E34B CDFAEF          17      CALL    _SNCL
       E34E                     WRDF3:
001655 E34E D1              10      POP DE
001656 E34F C1              10      POP BC
001657 E350 D8              11      RET C
001658 E351 100C            13      DJNZ    WRDF5       ;ここでループカウンタチェック
00165A E353 ED5BFEF0        20      LD  DE,(_CLPS)
00165E E357 21FFFF          10      LD  HL,0FFFFH   ;FATエントリ終了(EOCマーク)
001661 E35A C3FAEF          10      JP  _SNCL
                                
       E35D                     WRDF4:              ;DEクラスタが空じゃないので次に移動する
001664 E35D D1              10      POP DE
001665 E35E C1              10      POP BC
       E35F                     WRDF5:
001666 E35F 13               6      INC DE
001667 E360 CD93E1          17      CALL    ENDCL
00166A E363 38C6            12      JR  C,WRDF1
00166C E365 37               4      SCF
00166D E366 C9              10      RET
                                
       E367                     RWXR:
00166E E367 3A98E6          13      LD  A,(SECSZ+2) ;1024=4 / 512=2 / 256=1
       E36A                     L_RWX:
001671 E36A 1F               4      RRA     ;->CF
001672 E36B 3808            12      JR  C,E_RWX
001674 E36D CB38             8      SRL B   ;BCH=BCH/2
001676 E36F CB19             8      RR  C   ;
001678 E371 CB1C             8      RR  H   ;
00167A E373 18F5            12      JR  L_RWX
       E375                     E_RWX:
00167C E375 FD5E1A          19      LD  E,(IY+26)   ;(FCB)ファイルの先頭クラスタ
00167F E378 FD561B          19      LD  D,(IY+27)
001682 E37B AF               4      XOR A
001683 E37C 3207E9          13      LD  (_SECPS+1),A
       E37F                     RWX1:
001686 E37F ED53FEF0        20      LD  (_CLPS),DE
00168A E383 7A               4      LD  A,D
00168B E384 B3               4      OR  E
00168C E385 2813            12      JR  Z,SCF_RET   ;RET DE==0 => CF=1
                                
00168E E387 78               4      LD  A,B
00168F E388 B1               4      OR  C
001690 E389 B4               4      OR  H
001691 E38A C8              11      RET Z       ;RET BCH==0 => CF=0
                                
001692 E38B CD0FE9          17      CALL    GNCLX
001695 E38E D8              11      RET C
001696 E38F 7C               4      LD  A,H     ;
001697 E390 25               4      DEC H       ;
001698 E391 B7               4      OR  A       ;DEC BCH
001699 E392 2001            12      JR  NZ,RWX2     ;
00169B E394 0B               6      DEC BC      ;
       E395                     RWX2:
00169C E395 CD93E1          17      CALL    ENDCL
00169F E398 38E5            12      JR  C,RWX1
       E39A                     SCF_RET:
0016A1 E39A 37               4      SCF
0016A2 E39B C9              10      RET
                                
       E39C                     DSKF:
0016A3 E39C 110000          10  MAXCLP: LD  DE,0
0016A6 E39F 2AACEF          16      LD  HL,(_FAKEFREE)
0016A9 E3A2 7C               4      LD  A,H
0016AA E3A3 B5               4      OR  L
0016AB E3A4 2803            12      JR  Z,DSKF1
0016AD E3A6 110100          10      LD  DE,1
       E3A9                     DSKF1:
0016B0 E3A9 D5              11      PUSH    DE
0016B1 E3AA CDF7EF          17      CALL    _GNCL
0016B4 E3AD 380C            12      JR  C,POPSCF
0016B6 E3AF 7A               4      LD  A,D
0016B7 E3B0 B3               4      OR  E
0016B8 E3B1 2001            12      JR  NZ,DSKF2
0016BA E3B3 23               6      INC HL
       E3B4                     DSKF2:
0016BB E3B4 D1              10      POP DE
0016BC E3B5 1B               6      DEC DE
0016BD E3B6 7A               4      LD  A,D
0016BE E3B7 B3               4      OR  E
0016BF E3B8 20EF            12      JR  NZ,DSKF1
0016C1 E3BA C9              10      RET
                                
       E3BB                     POPSCF:
0016C2 E3BB F1              10      POP AF
0016C3 E3BC 37               4      SCF
0016C4 E3BD C9              10      RET
                                
       E3BE                     SETTMS:
0016C5 E3BE FD7E17          19      LD  A,(IY+23)   ;(FCB)ファイルを最後に変更した時刻
0016C8 E3C1 3C               4      INC A
0016C9 E3C2 C0              11      RET NZ      ;ファイルが更新されていない
       E3C3                     SETTMSX:            ;FCBに日付時刻をセットする
0016CA E3C3 CD41DA          17      CALL    _SYS2C      ;(BDOS)時刻の獲得
                                                ;H←時  L←分  D←秒
0016CD E3C6 CB25             8      SLA L       ;   *2
0016CF E3C8 CB25             8      SLA L       ;   *4
0016D1 E3CA 29              11      ADD HL,HL       ;*2 *8
0016D2 E3CB 29              11      ADD HL,HL       ;*4 *16
0016D3 E3CC 29              11      ADD HL,HL       ;*8 *32
0016D4 E3CD 7A               4      LD  A,D
0016D5 E3CE 0F               4      RRCA            ;bit.0->7->->->0->C
0016D6 E3CF E61F             7      AND 01FH
0016D8 E3D1 B5               4      OR  L
0016D9 E3D2 FD7716          19      LD  (IY+22),A   ;(FCB)ファイルを最後に変更した時刻
0016DC E3D5 FD7417          19      LD  (IY+23),H
                                
0016DF E3D8 CD1ADA          17      CALL    _SYS2A      ;(BDOS)日付の獲得
                                                ;HL←年  D←月  E←日
0016E2 E3DB 0144F8          10      LD  BC,0-1980
0016E5 E3DE 09              11      ADD HL,BC
0016E6 E3DF 65               4      LD  H,L
                                
0016E7 E3E0 7A               4      LD  A,D
0016E8 E3E1 87               4      ADD A,A     ;*2
0016E9 E3E2 87               4      ADD A,A     ;*4
0016EA E3E3 87               4      ADD A,A     ;*8
0016EB E3E4 87               4      ADD A,A     ;*16
0016EC E3E5 6F               4      LD  L,A
0016ED E3E6 29              11      ADD HL,HL       ;*32
0016EE E3E7 7D               4      LD  A,L
0016EF E3E8 B3               4      OR  E
0016F0 E3E9 FD7714          19      LD  (IY+20),A   ;(FCB)ファイルを最後に変更した日付
0016F3 E3EC FD7415          19      LD  (IY+21),H
0016F6 E3EF C9              10      RET
                                
       E3F0                     PUSHRR:
0016F7 E3F0 328FE4          13      LD  (SETSEQ_SWC_RND),A
0016FA E3F3 22A1E4          16      LD  (SETSEQ_SWC_SEQ_RR),HL
0016FD E3F6 CD16E4          17      CALL    GET_RR_AHL
001700 E3F9 225AEF          16      LD  (HLBUF),HL
001703 E3FC 325CEF          13      LD  (HLBUF+2),A
001706 E3FF C9              10      RET
                                
       E400                     GET_CPM_R_SIZE:     ;バイト単位からCP/Mのレコード単位を求める（1レコード=128バイト）
001707 E400 87               4      ADD A,A     ;in BHLA => out AHL
001708 E401 ED6A            15      ADC HL,HL
00170A E403 CB18             8      RR  B
00170C E405 B7               4      OR  A
00170D E406 78               4      LD  A,B     ;ここでフラグは変化しない
00170E E407 C8              11      RET Z
00170F E408 2C               4      INC L       ;INC AHL
001710 E409 C0              11      RET NZ      ;
001711 E40A 24               4      INC H       ;
001712 E40B C0              11      RET NZ      ;
001713 E40C 3C               4      INC A       ;
001714 E40D C9              10      RET
                                
       E40E                     INIT_RND:
001715 E40E 3ECD             7      LD  A,0CDH      ;CALL ????
001717 E410 215FE4          10      LD  HL,POPRR
00171A E413 CDF0E3          17      CALL    PUSHRR
       E416                     GET_RR_AHL:
00171D E416 FD6E21          19      LD  L,(IY+33)   ;(FCB)Random record
001720 E419 FD6622          19      LD  H,(IY+34)   ;
001723 E41C FD7E23          19      LD  A,(IY+35)   ;
001726 E41F C9              10      RET
       E420                     SET_RR_AHL:
001727 E420 FD7521          19      LD  (IY+33),L   ;(FCB)Random record
00172A E423 FD7422          19      LD  (IY+34),H
00172D E426 FD7723          19      LD  (IY+35),A
001730 E429 C9              10      RET
       E42A                     INIT_SEQ:
001731 E42A 3E01             7      LD  A,1     ;LD BC,????
001733 E42C 215CE4          10      LD  HL,SETSEQ
001736 E42F CDF0E3          17      CALL    PUSHRR
       E432                     GETSEQ:
001739 E432 FD6E20          19      LD  L,(IY+32)   ;(FCB)カレントレコード
00173C E435 FD660C          19      LD  H,(IY+12)   ;(FCB)カレントブロック
00173F E438 AF               4      XOR A
                                
001740 E439 CB25             8      SLA L   ;L=L*2
                                
001742 E43B CB3C             8      SRL H   ;HL=HL/2
001744 E43D CB1D             8      RR  L   ;
001746 E43F C9              10      RET
                                
       E440                     SETSEQ1:
001747 E440 F5              11      PUSH    AF      
001748 E441 E5              11      PUSH    HL      ;AHL=Random record
001749 E442 FD7E21          19      LD  A,(IY+33)   ;(FCB)ランダムレコード
00174C E445 FD6E22          19      LD  L,(IY+34)
00174F E448 FD6623          19      LD  H,(IY+35)
001752 E44B 0600             7      LD  B,0
                                
001754 E44D CD00E4          17      CALL    GET_CPM_R_SIZE
                                
001757 E450 29              11      ADD HL,HL
001758 E451 CB3D             8      SRL L       ;L=L/2
00175A E453 FD7520          19      LD  (IY+32),L   ;(FCB)カレントレコード
00175D E456 FD740C          19      LD  (IY+12),H   ;(FCB)カレントブロック
001760 E459 E1              10      POP HL
001761 E45A F1              10      POP AF
001762 E45B C9              10      RET
       E45C                     SETSEQ:
001763 E45C CD40E4          17      CALL    SETSEQ1
       E45F                     POPRR:
001766 E45F F5              11      PUSH    AF
001767 E460 E5              11      PUSH    HL
001768 E461 2A5AEF          16      LD  HL,(HLBUF)
00176B E464 3A5CEF          13      LD  A,(HLBUF+2)
00176E E467 CD20E4          17      CALL    SET_RR_AHL
001771 E46A E1              10      POP HL
001772 E46B F1              10      POP AF
001773 E46C C9              10      RET
                                
       E46D                     RB_WRITE:
001774 E46D C5              11      PUSH    BC
001775 E46E ED4B4CF0        20      LD  BC,(STABLE+2*026H)  ;(BDOS)ランダムブロック書き込み
001779 E472 1805            12      JR  RBRW
       E474                     RB_READ:
00177B E474 C5              11      PUSH    BC
00177C E475 ED4B4EF0        20      LD  BC,(STABLE+2*027H)  ;(BDOS)ランダムブロック読み込み
       E479                     RBRW:
001780 E479 CB3F             8      SRL A   ;AHLA' = HL*128
001782 E47B CB1C             8      RR  H   ;AHL=AHL/2
001784 E47D CB1D             8      RR  L   ;
001786 E47F 3E00             7      LD  A,0
001788 E481 1F               4      RRA     ;A'HLA
001789 E482 FD7721          19      LD  (IY+33),A   ;(FCB)ランダムレコード
00178C E485 FD7522          19      LD  (IY+34),L
00178F E488 FD7423          19      LD  (IY+35),H
001792 E48B 218000          10      LD  HL,128
001795 E48E C5              11      PUSH    BC
       E48F                     SETSEQ_SWC_RND:
001796 E48F CD40E4          17      CALL    SETSEQ1
001799 E492 C1              10      POP BC
00179A E493 FDCB20FE        23      SET 7,(IY+32)   ;(FCB)カレントレコード
00179E E497 FDE5            15      PUSH    IY
0017A0 E499 D1              10      POP DE
0017A1 E49A D5              11      PUSH    DE
0017A2 E49B CDA9E4          17      CALL    JP_BC
0017A5 E49E FDE1            14      POP IY
       E4A1                     SETSEQ_SWC_SEQ_RR   EQU $+1
0017A7 E4A0 CD5CE4          17      CALL    SETSEQ
0017AA E4A3 FDCB20BE        23      RES 7,(IY+32)   ;(FCB)カレントレコード
                                
0017AE E4A7 C1              10      POP BC
0017AF E4A8 C9              10      RET
       E4A9                     JP_BC:
0017B0 E4A9 C5              11      PUSH    BC
0017B1 E4AA C9              10      RET
                                
       E023                     _SYS03  EQU SCF_FF_RET  ;(BDOS)外部入力
       E023                     _SYS2B  EQU SCF_FF_RET  ;(BDOS)日付の設定
       E023                     _SYS2D  EQU SCF_FF_RET  ;(BDOS)時刻の設定
       E023                     _SYS39  EQU SCF_FF_RET  ;(BDOS)サブディレクトリの作成
       E023                     _SYS3A  EQU SCF_FF_RET  ;(BDOS)サブディレクトリの削除
                                
[EOF:LDFILE.ASM:SHIFT_JIS]
                                    INCLUDE "LDFILE2.ASM"
                                
                                ;   LSX-Dodgers FILE2
                                
                                                ;Write random block
       E4AB                     _SYS26:     ;(BDOS)ランダムブロック書き込み
0017B2 E4AB AF               4      XOR A
0017B3 E4AC 3297E7          13      LD  (DRDN1),A   ;NOP
0017B6 E4AF 22DBE6          16      LD  (LEFT+1),HL ;HL←書き込むレコード数
0017B9 E4B2 225DEF          16      LD  (LEFTX),HL
0017BC E4B5 CD78DF          17      CALL    SETDRV
                                
0017BF E4B8 CD32E6          17      CALL    RBX0
0017C2 E4BB DA55E5          10      JP  C,RBWERR
0017C5 E4BE CD00E3          17      CALL    WOPEN
0017C8 E4C1 DA55E5          10      JP  C,RBWERR
0017CB E4C4 7C               4      LD  A,H
0017CC E4C5 B5               4      OR  L
0017CD E4C6 CA4EE5          10      JP  Z,RBW1
                                
0017D0 E4C9 2B               6      DEC HL
                                
0017D1 E4CA CDFDE6          17      CALL    GET_RR_BCDE ;BCDE=Random record
                                
0017D4 E4CD 19              11      ADD HL,DE       ;BCHL=HL+BCDE
0017D5 E4CE 3001            12      JR  NC,S26X1    ;
0017D7 E4D0 03               6      INC BC      ;
       E4D1                     S26X1:
0017D8 E4D1 CD67E3          17      CALL    RWXR
0017DB E4D4 DC11E3          17      CALL    C,WRDFX
0017DE E4D7 DA55E5          10      JP  C,RBWERR
                                
0017E1 E4DA CD61E6          17      CALL    RBX2
0017E4 E4DD 281A            12      JR  Z,RBWB      ;NZ=セクタ以下の端数がある
0017E6 E4DF CD80E6          17      CALL    RBXA
0017E9 E4E2 3871            12      JR  C,RBWERR
0017EB E4E4 EB               4      EX  DE,HL
0017EC E4E5 C5              11      PUSH    BC
0017ED E4E6 EDB0                    LDIR
0017EF E4E8 225FEF          16      LD  (DTAX),HL
                                
0017F2 E4EB CDA5E2          17      CALL    SWTDBF      ;バッファデータは更新された
                                
0017F5 E4EE 2A5DEF          16      LD  HL,(LEFTX)
0017F8 E4F1 D1              10      POP DE
0017F9 E4F2 ED52            15      SBC HL,DE
0017FB E4F4 225DEF          16      LD  (LEFTX),HL
0017FE E4F7 2833            12      JR  Z,RBWEND
                                
       E4F9                     RBWB:
001800 E4F9 CDB6E6          17      CALL    RBXB
001803 E4FC 2816            12      JR  Z,RBWC
       E4FE                     RBWB1:
001805 E4FE C5              11      PUSH    BC
001806 E4FF D5              11      PUSH    DE
001807 E500 CD76E1          17      CALL    CLUSTX
00180A E503 CD11E7          17      CALL    DWTC
00180D E506 D1              10      POP DE
00180E E507 C1              10      POP BC
00180F E508 384B            12      JR  C,RBWERR
001811 E50A CD0FE9          17      CALL    GNCLX
001814 E50D 3846            12      JR  C,RBWERR
001816 E50F 10ED            13      DJNZ    RBWB1
001818 E511 CD61E7          17      CALL    DRW_FLUSH
       E514                     RBWC:
00181B E514 CDCEE6          17      CALL    RBXC
00181E E517 2813            12      JR  Z,RBWEND
001820 E519 C5              11      PUSH    BC
001821 E51A CD76E1          17      CALL    CLUSTX
001824 E51D CD96E7          17      CALL    DRDN
001827 E520 C1              10      POP BC
001828 E521 3832            12      JR  C,RBWERR
00182A E523 ED5B7EF0        20      LD  DE,(_DTBUF)
00182E E527 EDB0                    LDIR
001830 E529 CDA5E2          17      CALL    SWTDBF      ;バッファデータは更新された
       E52C                     RBWEND:
001833 E52C CDDAE6          17      CALL    RBXEND
                                
001836 E52F CD41E6          17      CALL    RBX1
001839 E532 301A            12      JR  NC,RBW1
00183B E534 2ADBE6          16      LD  HL,(LEFT+1)
00183E E537 FD5E10          19      LD  E,(IY+16)   ;(FCB)ファイルのサイズ(バイト単位)
001841 E53A FD5611          19      LD  D,(IY+17)   ;DE=File size
001844 E53D 19              11      ADD HL,DE
001845 E53E FD7510          19      LD  (IY+16),L   ;(FCB)ファイルのサイズ(バイト単位)
001848 E541 FD7411          19      LD  (IY+17),H
00184B E544 3008            12      JR  NC,RBW1
00184D E546 FD3412          23      INC (IY+18)
001850 E549 2003            12      JR  NZ,RBW1
001852 E54B FD3413          23      INC (IY+19)
       E54E                     RBW1:
001855 E54E FDE1            14      POP IY
001857 E550 C1              10      POP BC
001858 E551 D1              10      POP DE
001859 E552 E1              10      POP HL
       E553                     DD_NUL:
00185A E553 AF               4      XOR A
       E554                     DRDF0:
       E554                     DWTF0:
00185B E554 C9              10      RET
                                
       E555                     RBWERR:
00185C E555 FDE5            15      PUSH    IY
00185E E557 D1              10      POP DE
00185F E558 2A20F0          16      LD  HL,(STABLE+2*010H)
001862 E55B CD0F00          17      CALL    JP_HL
       E55E                     RBRERR1:
001865 E55E 3E01             7      LD  A,001H
       E560                     RBRERR2:
001867 E560 FDE1            14      POP IY
001869 E562 C1              10      POP BC
00186A E563 D1              10      POP DE
00186B E564 E1              10      POP HL
00186C E565 37               4      SCF
00186D E566 210000          10      LD  HL,0
001870 E569 C9              10      RET
                                
       E56A                     RBRERR:
001871 E56A 3EFF             7      LD  A,0FFH
001873 E56C 18F2            12      JR  RBRERR2
                                
       E56E                     RBRFL:
001875 E56E 3E00             7  RBRFLP: LD  A,000H
001877 E570 FE0D             7      CP  00DH
001879 E572 2005            12      JR  NZ,RBRFL1
00187B E574 D5              11      PUSH    DE
00187C E575 1E0A             7      LD  E,00AH
00187E E577 1805            12      JR  RBRFL2
       E579                     RBRFL1:
001880 E579 D5              11      PUSH    DE
001881 E57A CD09EF          17      CALL    _SYS07
001884 E57D 5F               4      LD  E,A
       E57E                     RBRFL2:
001885 E57E CDCDEF          17      CALL    _PRINT
001888 E581 7B               4      LD  A,E
001889 E582 D1              10      POP DE
00188A E583 326FE5          13      LD  (RBRFLP+1),A
00188D E586 C9              10      RET
       E587                     DDX:
00188E E587 FD7E01          19      LD  A,(IY+1)    ;(FCB)主ファイル名
001891 E58A CD9BE1          17      CALL    CAP
001894 E58D FE41             7      CP  'A'
001896 E58F C9              10      RET
                                
                                                ;Read random block
       E590                     _SYS27:     ;(BDOS)ランダムブロック読み込み
001897 E590 225DEF          16      LD  (LEFTX),HL
00189A E593 CD78DF          17      CALL    SETDRV
                                
00189D E596 FDCB0D66        20      BIT 4,(IY+13)   ;(FCB)属性(アトリビュート)
0018A1 E59A C220E6          10      JP  NZ,RBRDIR   ;ディレクトリ
0018A4 E59D CD32E6          17      CALL    RBX0
0018A7 E5A0 DA6AE5          10      JP  C,RBRERR
0018AA E5A3 CD41E6          17      CALL    RBX1
0018AD E5A6 DA5EE5          10      JP  C,RBRERR1
0018B0 E5A9 EB               4      EX  DE,HL
0018B1 E5AA ED52            15      SBC HL,DE       ;CP 00HL,BCDE
0018B3 E5AC 19              11      ADD HL,DE
0018B4 E5AD 79               4      LD  A,C
0018B5 E5AE DE00             7      SBC A,0
0018B7 E5B0 78               4      LD  A,B
0018B8 E5B1 DE00             7      SBC A,0
0018BA E5B3 3801            12      JR  C,RBR1
0018BC E5B5 EB               4      EX  DE,HL
       E5B6                     RBR1:
0018BD E5B6 9F               4      SBC A,A
0018BE E5B7 E601             7      AND 1
0018C0 E5B9 321EE6          13      LD  (RBRAP+1),A
                                
0018C3 E5BC 7C               4      LD  A,H
0018C4 E5BD B5               4      OR  L
0018C5 E5BE 2857            12      JR  Z,RBREND0
                                
0018C7 E5C0 22DBE6          16      LD  (LEFT+1),HL ;Read record byte
0018CA E5C3 225DEF          16      LD  (LEFTX),HL
                                
0018CD E5C6 CD61E6          17      CALL    RBX2
0018D0 E5C9 2819            12      JR  Z,RBRB
0018D2 E5CB CD80E6          17      CALL    RBXA
0018D5 E5CE DA6AE5          10      JP  C,RBRERR
0018D8 E5D1 C5              11      PUSH    BC
0018D9 E5D2 EDB0                    LDIR
0018DB E5D4 ED535FEF        20      LD  (DTAX),DE
0018DF E5D8 2A5DEF          16      LD  HL,(LEFTX)
0018E2 E5DB D1              10      POP DE
0018E3 E5DC A7               4      AND A
0018E4 E5DD ED52            15      SBC HL,DE
0018E6 E5DF 225DEF          16      LD  (LEFTX),HL
0018E9 E5E2 2830            12      JR  Z,RBREND
                                
       E5E4                     RBRB:
0018EB E5E4 CDB6E6          17      CALL    RBXB
0018EE E5E7 2815            12      JR  Z,RBRC
       E5E9                     RBRB1:
0018F0 E5E9 C5              11      PUSH    BC
0018F1 E5EA D5              11      PUSH    DE
0018F2 E5EB CD76E1          17      CALL    CLUSTX
0018F5 E5EE CD17E7          17      CALL    DRDC
0018F8 E5F1 D1              10      POP DE
0018F9 E5F2 C1              10      POP BC
0018FA E5F3 D40FE9          17      CALL    NC,GNCLX
0018FD E5F6 DA6AE5          10      JP  C,RBRERR
001900 E5F9 10EE            13      DJNZ    RBRB1
001902 E5FB CD61E7          17      CALL    DRW_FLUSH
       E5FE                     RBRC:
001905 E5FE CDCEE6          17      CALL    RBXC
001908 E601 2811            12      JR  Z,RBREND
00190A E603 C5              11      PUSH    BC
00190B E604 CD76E1          17      CALL    CLUSTX
00190E E607 CD7AE7          17      CALL    DRDX
001911 E60A C1              10      POP BC
001912 E60B DA6AE5          10      JP  C,RBRERR
001915 E60E EB               4      EX  DE,HL
001916 E60F 2A7EF0          16      LD  HL,(_DTBUF)
001919 E612 EDB0                    LDIR
       E614                     RBREND:
00191B E614 CDDAE6          17      CALL    RBXEND
       E617                     RBREND0:
00191E E617 FDE1            14      POP IY
001920 E619 C1              10      POP BC
001921 E61A D1              10      POP DE
001922 E61B F1              10      POP AF  ;(HL)
001923 E61C AF               4      XOR A
001924 E61D 3E00             7  RBRAP:  LD  A,000H
001926 E61F C9              10      RET
                                
       E620                     RBRDIR:
001927 E620 FD6E1A          19      LD  L,(IY+26)   ;(FCB)ファイルの先頭クラスタ
00192A E623 FD661B          19      LD  H,(IY+27)
00192D E626 CDB6E1          17      CALL    CHDIR
001930 E629 AF               4      XOR A
001931 E62A 67               4      LD  H,A
001932 E62B 6F               4      LD  L,A
001933 E62C 3C               4      INC A
001934 E62D 321EE6          13      LD  (RBRAP+1),A
001937 E630 18E5            12      JR  RBREND0
                                
       E632                     RBX0:
001939 E632 2A8AEF          16      LD  HL,(_DTA)
00193C E635 225FEF          16      LD  (DTAX),HL
00193F E638 2A5DEF          16      LD  HL,(LEFTX)
001942 E63B FD7E1C          19      LD  A,(IY+28)   ;(FCB)オープンモード
001945 E63E D6FD             7      SUB 0FDH
001947 E640 C9              10      RET
                                
       E641                     RBX1:
001948 E641 E5              11      PUSH    HL      ;Record byte
                                                ;AHL=File size
001949 E642 FD6E10          19      LD  L,(IY+16)   ;ファイルのサイズ(バイト単位)
00194C E645 FD6611          19      LD  H,(IY+17)   ;
00194F E648 FD7E12          19      LD  A,(IY+18)   ;
                                
001952 E64B CDFDE6          17      CALL    GET_RR_BCDE ;BCDE=Random record
                                
001955 E64E A7               4      AND A
001956 E64F ED52            15      SBC HL,DE
001958 E651 99               4      SBC A,C
001959 E652 4F               4      LD  C,A
00195A E653 FD7E13          19      LD  A,(IY+19)   ;ファイルのサイズ
00195D E656 98               4      SBC A,B
00195E E657 D1              10      POP DE
                                
00195F E658 D8              11      RET C
001960 E659 47               4      LD  B,A
001961 E65A B1               4      OR  C
001962 E65B EB               4      EX  DE,HL   ;BCDE=File byte HL=Record byte
001963 E65C B2               4      OR  D
001964 E65D B3               4      OR  E
001965 E65E C0              11      RET NZ
001966 E65F 37               4      SCF
001967 E660 C9              10      RET
                                
       E661                     RBX2:               ;Cluster settings
001968 E661 FD6622          19      LD  H,(IY+34)   ;(+33)(FCB)ランダムレコード
00196B E664 FD4E23          19      LD  C,(IY+35)
00196E E667 0600             7      LD  B,0
001970 E669 FDCB207E        20      BIT 7,(IY+32)   ;(FCB)カレントレコード
001974 E66D 2003            12      JR  NZ,RBX3
001976 E66F FD4624          19      LD  B,(IY+36)
       E672                     RBX3:
001979 E672 CD67E3          17      CALL    RWXR
00197C E675 3A98E6          13      LD  A,(SECSZ+2) ;1024=4 / 512=2 / 256=1
00197F E678 3D               4      DEC A
001980 E679 FDA622          19      AND (IY+34)
001983 E67C FDB621          19      OR  (IY+33)
001986 E67F C9              10      RET
                                
       E680                     RBXA:
001987 E680 C5              11      PUSH    BC
001988 E681 D5              11      PUSH    DE
001989 E682 CD76E1          17      CALL    CLUSTX
00198C E685 CD7AE7          17      CALL    DRDX
00198F E688 D1              10      POP DE
001990 E689 C1              10      POP BC
001991 E68A D8              11      RET C
001992 E68B CD0FE9          17      CALL    GNCLX
001995 E68E D8              11      RET C
001996 E68F ED53FEF0        20      LD  (_CLPS),DE
                                
00199A E693 FD4E21          19      LD  C,(IY+33)   ;(FCB)ランダムレコード
00199D E696 210004          10  SECSZ:  LD  HL,0400H    ;自己書き換え 1024=0400H / 512=0200H ここに1セクタのサイズが格納される
0019A0 E699 7C               4      LD  A,H
0019A1 E69A 3D               4      DEC A       ;1024=3 / 512=1
0019A2 E69B FDA622          19      AND (IY+34)     ;(FCB)ランダムレコード
0019A5 E69E 47               4      LD  B,A     ;BCに1セクタ以下の端数が入る
0019A6 E69F ED42            15      SBC HL,BC       ;残りを計算
                                
0019A8 E6A1 ED5B5DEF        20      LD  DE,(LEFTX)
0019AC E6A5 ED52            15      SBC HL,DE       ;CP HL,DE
0019AE E6A7 19              11      ADD HL,DE       ;
0019AF E6A8 3801            12      JR  C,RBXA1     ;DEとHLを比較して大きい方をHLに
0019B1 E6AA EB               4      EX  DE,HL
       E6AB                     RBXA1:
0019B2 E6AB E5              11      PUSH    HL
0019B3 E6AC 2A7EF0          16      LD  HL,(_DTBUF)
0019B6 E6AF 09              11      ADD HL,BC
0019B7 E6B0 ED5B5FEF        20      LD  DE,(DTAX)
0019BB E6B4 C1              10      POP BC
0019BC E6B5 C9              10      RET
                                
       E6B6                     RBXB:
0019BD E6B6 2A5FEF          16      LD  HL,(DTAX)
0019C0 E6B9 ED5BFEF0        20      LD  DE,(_CLPS)
0019C4 E6BD 3A5EEF          13      LD  A,(LEFTX+1)
0019C7 E6C0 47               4      LD  B,A
0019C8 E6C1 3A98E6          13      LD  A,(SECSZ+2) ;1024=4 / 512=2 / 256=1
       E6C4                     RBXB1:
0019CB E6C4 1F               4      RRA     ;->CF
0019CC E6C5 3804            12      JR  C,RBXB2
0019CE E6C7 CB38             8      SRL B   ;B=B/2
0019D0 E6C9 18F9            12      JR  RBXB1
       E6CB                     RBXB2:
0019D2 E6CB 78               4      LD  A,B
0019D3 E6CC B7               4      OR  A
0019D4 E6CD C9              10      RET
                                
       E6CE                     RBXC:
0019D5 E6CE ED4B5DEF        20      LD  BC,(LEFTX)
0019D9 E6D2 3A98E6          13      LD  A,(SECSZ+2) ;1024=4 / 512=2 / 256=1
0019DC E6D5 3D               4      DEC A
0019DD E6D6 A0               4      AND B
0019DE E6D7 47               4      LD  B,A     ;1セクタ以下の端数がない場合はZ
0019DF E6D8 B1               4      OR  C
0019E0 E6D9 C9              10      RET
                                
       E6DA                     RBXEND:
0019E1 E6DA 110000          10  LEFT:   LD  DE,0
0019E4 E6DD AF               4      XOR A
0019E5 E6DE FD6E21          19      LD  L,(IY+33)   ;(FCB)ランダムレコード
0019E8 E6E1 FD6622          19      LD  H,(IY+34)
0019EB E6E4 19              11      ADD HL,DE
0019EC E6E5 FD7521          19      LD  (IY+33),L   ;(FCB)ランダムレコード
0019EF E6E8 FD7422          19      LD  (IY+34),H
0019F2 E6EB 300E            12      JR  NC,RBXEND1
0019F4 E6ED FD3423          23      INC (IY+35)
0019F7 E6F0 2009            12      JR  NZ,RBXEND1
0019F9 E6F2 FDCB207E        20      BIT 7,(IY+32)   ;(FCB)カレントレコード
0019FD E6F6 2003            12      JR  NZ,RBXEND1
0019FF E6F8 FD3424          23      INC (IY+36)
       E6FB                     RBXEND1:
001A02 E6FB EB               4      EX  DE,HL       ;HL=Read byte
001A03 E6FC C9              10      RET
                                
       E6FD                     GET_RR_BCDE:            ;BCDE=Random record
001A04 E6FD FD5E21          19      LD  E,(IY+33)   ;(FCB)ランダムレコード
001A07 E700 FD5622          19      LD  D,(IY+34)
001A0A E703 FD4E23          19      LD  C,(IY+35)
001A0D E706 FD4624          19      LD  B,(IY+36)
001A10 E709 FDCB207E        20      BIT 7,(IY+32)   ;(FCB)カレントレコード
001A14 E70D C8              11      RET Z
001A15 E70E 0600             7      LD  B,0     ;CP/M互換のアクセスの場合はFCBは36バイト
001A17 E710 C9              10      RET
                                
                                ;   ランダムブロックアクセスの連続したセクタをまとめる
                                
       E711                     DWTC:
001A18 E711 E5              11      PUSH    HL
001A19 E712 21A1EA          10      LD  HL,DWT24B
001A1C E715 1804            12      JR  DWTC1
       E717                     DRDC:
001A1E E717 E5              11      PUSH    HL
001A1F E718 2191EA          10      LD  HL,DRD24B
       E71B                     DWTC1:
001A22 E71B 2275E7          16      LD  (DRWF_MODE),HL
001A25 E71E E1              10      POP HL
001A26 E71F 3A65E7          13      LD  A,(DRWF_B)
001A29 E722 B7               4      OR  A
001A2A E723 200F            12      JR  NZ,DRDC1
       E725                     SAVE_DRWC:
001A2C E725 0601             7      LD  B,1
001A2E E727 ED4364E7        20      LD  (DRWF_C),BC
001A32 E72B ED536BE7        20      LD  (DRWF_E),DE
001A36 E72F 226EE7          16      LD  (DRWF_HL),HL
001A39 E732 1820            12      JR  INC_HL_DRWC
       E734                     DRDC1:
001A3B E734 E5              11      PUSH    HL
001A3C E735 216BE7          10      LD  HL,DRWF_E
001A3F E738 86               7      ADD A,(HL)
001A40 E739 F5              11      PUSH    AF
001A41 E73A BB               4      CP  E
001A42 E73B 201D            12      JR  NZ,DRDC2
001A44 E73D F1              10      POP AF
001A45 E73E 23               6      INC HL
001A46 E73F 7E               7      LD  A,(HL)
001A47 E740 CE00             7      ADC A,0
001A49 E742 F5              11      PUSH    AF
001A4A E743 BA               4      CP  D
001A4B E744 2014            12      JR  NZ,DRDC2
001A4D E746 F1              10      POP AF
001A4E E747 3A64E7          13      LD  A,(DRWF_C)
001A51 E74A CE00             7      ADC A,0
001A53 E74C B9               4      CP  C
001A54 E74D 200C            12      JR  NZ,DRDC3
001A56 E74F 2165E7          10      LD  HL,DRWF_B
001A59 E752 34              11      INC (HL)
001A5A E753 E1              10      POP HL
       E754                     INC_HL_DRWC:
001A5B E754 3A98E6          13      LD  A,(SECSZ+2)     ;1セクタのサイズの上位1バイト
001A5E E757 84               4      ADD A,H
001A5F E758 67               4      LD  H,A
001A60 E759 C9              10      RET
       E75A                     DRDC2:
001A61 E75A F1              10      POP AF
       E75B                     DRDC3:
001A62 E75B CD61E7          17      CALL    DRW_FLUSH
001A65 E75E E1              10      POP HL
001A66 E75F 18C4            12      JR  SAVE_DRWC
                                
                                ;   ランダムブロックアクセスの連続したセクタをまとめたものをフラッシュする
       E761                     DRW_FLUSH:
001A68 E761 C5              11      PUSH    BC
001A69 E762 D5              11      PUSH    DE
       E764                     DRWF_C  EQU $+1
       E765                     DRWF_B  EQU $+2
001A6A E763 010000          10      LD  BC,0
001A6D E766 78               4      LD  A,B
001A6E E767 B7               4      OR  A
001A6F E768 280D            12      JR  Z,DRDF1
       E76B                     DRWF_E  EQU $+1
       E76C                     DRWF_D  EQU $+2
001A71 E76A 110000          10      LD  DE,0
       E76E                     DRWF_HL EQU $+1
001A74 E76D 210000          10      LD  HL,0
001A77 E770 AF               4      XOR A
001A78 E771 3265E7          13      LD  (DRWF_B),A
       E775                     DRWF_MODE   EQU $+1
001A7B E774 CD91EA          17      CALL    DRD24B
       E777                     DRDF1:
001A7E E777 D1              10      POP DE
001A7F E778 C1              10      POP BC
001A80 E779 C9              10      RET
[EOF:LDFILE2.ASM:SHIFT_JIS]
                                    INCLUDE "LDDIO.ASM"
                                
                                ;   LSX-Dodgers DIO
                                
       E77A                     DRDX:
001A81 E77A CDB8E7          17      CALL    DRDY
001A84 E77D C8              11      RET Z
001A85 E77E CD9EE7          17      CALL    DRDX1       ;データバッファの情報を保存
001A88 E781 D8              11      RET C
001A89 E782 E5              11      PUSH    HL
001A8A E783 C5              11      PUSH    BC
001A8B E784 D5              11      PUSH    DE
001A8C E785 2A7EF0          16      LD  HL,(_DTBUF)
001A8F E788 3AE1E7          13      LD  A,(_DBS24+1)
001A92 E78B 4F               4      LD  C,A
001A93 E78C CD8FEA          17      CALL    DRD24
001A96 E78F DCB3E7          17      CALL    C,DRDNE
       E792                     POP_DE_BC_HL_RET:
001A99 E792 D1              10      POP DE
001A9A E793 C1              10      POP BC
001A9B E794 E1              10      POP HL
001A9C E795 C9              10      RET
                                
                                ;   CDE:セクタ番号
       E796                     DRDN:
001A9D E796 AF               4      XOR A
001A9E E797 00               4  DRDN1:  NOP         ;自己書き換え NOP / SCF
001A9F E798 30E0            12      JR  NC,DRDX
       E79A                     DRDNX:
001AA1 E79A CDB8E7          17      CALL    DRDY
001AA4 E79D C8              11      RET Z
       E79E                     DRDX1:
001AA5 E79E CDCEE7          17      CALL    DWTX
                                                ;データバッファの読み込んだドライブ・セクタ情報を保存
001AA8 E7A1 ED53A6EF        20      LD  (_DBSEC),DE
001AAC E7A5 79               4      LD  A,C
001AAD E7A6 32E1E7          13      LD  (_DBS24+1),A
                                
001AB0 E7A9 3A88EF          13      LD  A,(_DRV)
001AB3 E7AC 32A5EF          13      LD  (_DBDRV),A
001AB6 E7AF CDD9EF          17      CALL    _CHGDRV
001AB9 E7B2 D0              11      RET NC
       E7B3                     DRDNE:
001ABA E7B3 9F               4      SBC A,A     ;CF=1ならばA=0FFH
001ABB E7B4 32A5EF          13      LD  (_DBDRV),A
001ABE E7B7 C9              10      RET
                                
                                ;   CDE:セクタ番号
       E7B8                     DRDY:
001ABF E7B8 3AE1E7          13      LD  A,(_DBS24+1)
001AC2 E7BB B9               4      CP  C
001AC3 E7BC C0              11      RET NZ
                                
001AC4 E7BD E5              11      PUSH    HL
001AC5 E7BE 3A88EF          13      LD  A,(_DRV)
001AC8 E7C1 21A5EF          10      LD  HL,_DBDRV
001ACB E7C4 AE               7      XOR (HL)
001ACC E7C5 2005            12      JR  NZ,POP_HL_RET
                                
001ACE E7C7 2AA6EF          16      LD  HL,(_DBSEC)
001AD1 E7CA ED52            15      SBC HL,DE       ;CF=0
       E7CC                     POP_HL_RET:
001AD3 E7CC E1              10      POP HL
001AD4 E7CD C9              10      RET
                                
       E7CE                     DWTX:
001AD5 E7CE 3AA4EF          13      LD  A,(_WTDBF)
001AD8 E7D1 B7               4      OR  A
001AD9 E7D2 C8              11      RET Z
001ADA E7D3 AF               4      XOR A
001ADB E7D4 32A4EF          13      LD  (_WTDBF),A
                                
001ADE E7D7 E5              11      PUSH    HL
001ADF E7D8 C5              11      PUSH    BC
001AE0 E7D9 D5              11      PUSH    DE
001AE1 E7DA 3AA5EF          13      LD  A,(_DBDRV)
001AE4 E7DD CDD9EF          17      CALL    _CHGDRV
001AE7 E7E0 0E00             7  _DBS24: LD  C,0
001AE9 E7E2 ED5BA6EF        20      LD  DE,(_DBSEC)
001AED E7E6 2A7EF0          16      LD  HL,(_DTBUF)
001AF0 E7E9 D49FEA          17      CALL    NC,DWT24
       E7EC                     POP_DE_BC_HL_RET2:
001AF3 E7EC 18A4            12      JR  POP_DE_BC_HL_RET
                                
       E7EE                     RDFATX:
001AF5 E7EE E5              11      PUSH    HL
001AF6 E7EF 3A88EF          13      LD  A,(_DRV)
001AF9 E7F2 21AAEF          10      LD  HL,_FATDRV
001AFC E7F5 AE               7      XOR (HL)
001AFD E7F6 28D4            12      JR  Z,POP_HL_RET
                                
001AFF E7F8 C5              11      PUSH    BC
001B00 E7F9 D5              11      PUSH    DE
001B01 E7FA DDE5            15      PUSH    IX
001B03 E7FC CD18E8          17      CALL    WTFATX
001B06 E7FF 3813            12      JR  C,POP_IX_DE_BC_HL_RET
                                
001B08 E801 AF               4      XOR A
001B09 E802 32ABEF          13      LD  (_FATIX),A
001B0C E805 3A88EF          13      LD  A,(_DRV)
001B0F E808 32AAEF          13      LD  (_FATDRV),A
001B12 E80B CDE5EF          17      CALL    _RDFAT
       E80E                     RDFATE2:
001B15 E80E 3004            12      JR  NC,POP_IX_DE_BC_HL_RET
001B17 E810 9F               4      SBC A,A     ;A=0xFF
001B18 E811 32AAEF          13      LD  (_FATDRV),A
       E814                     POP_IX_DE_BC_HL_RET:
001B1B E814 DDE1            14      POP IX
001B1D E816 18D4            12      JR  POP_DE_BC_HL_RET2
                                
       E818                     WTFATX:
001B1F E818 3AA2EF          13      LD  A,(_WTFATF)
001B22 E81B B7               4      OR  A
001B23 E81C C8              11      RET Z
001B24 E81D E5              11      PUSH    HL
001B25 E81E 3AAAEF          13      LD  A,(_FATDRV)
001B28 E821 21A5EF          10      LD  HL,_DBDRV
001B2B E824 AE               7      XOR (HL)
001B2C E825 CCCEE7          17      CALL    Z,DWTX
001B2F E828 38A2            12      JR  C,POP_HL_RET
001B31 E82A C5              11      PUSH    BC
001B32 E82B D5              11      PUSH    DE
001B33 E82C DDE5            15      PUSH    IX
001B35 E82E CDACEA          17      CALL    WTFAT
001B38 E831 AF               4      XOR A
001B39 E832 32A2EF          13      LD  (_WTFATF),A
001B3C E835 18DD            12      JR  POP_IX_DE_BC_HL_RET
                                
       E837                     NCL1:
001B3E E837 7A               4      LD  A,D
001B3F E838 B3               4      OR  E
001B40 E839 37               4      SCF
001B41 E83A C8              11      RET Z
                                
001B42 E83B 7A               4      LD  A,D
001B43 E83C CB3F             8      SRL A   ;/2
001B45 E83E CB3F             8      SRL A   ;/2
                                
001B47 E840 E5              11      PUSH    HL
001B48 E841 3260E8          13      LD  (NCLPAT+2),A    ;_FATIX
001B4B E844 2AAAEF          16      LD  HL,(_FATDRV)    ;L=_FATDRV H=_FATIX
001B4E E847 BC               4      CP  H
001B4F E848 3A88EF          13      LD  A,(_DRV)    ;この間でフラグは変化しない
001B52 E84B 325FE8          13      LD  (NCLPAT+1),A    ;_FATDRV
001B55 E84E 2005            12      JR  NZ,NCL2     ;FATIXが違う
001B57 E850 BD               4      CP  L
001B58 E851 2002            12      JR  NZ,NCL2     ;ドライブが違う
001B5A E853 E1              10      POP HL
001B5B E854 C9              10      RET
       E855                     NCL2:
001B5C E855 C5              11      PUSH    BC
001B5D E856 D5              11      PUSH    DE
001B5E E857 DDE5            15      PUSH    IX
001B60 E859 CD18E8          17      CALL    WTFATX
001B63 E85C 38B6            12      JR  C,POP_IX_DE_BC_HL_RET
001B65 E85E 010000          10  NCLPAT: LD  BC,0        ;自己書き換え C=_FATDRV B=_FATIX
001B68 E861 ED43AAEF        20      LD  (_FATDRV),BC
001B6C E865 CD81EA          17      CALL    RDFATS
001B6F E868 18A4            12      JR  RDFATE2
                                
       E86A                     NCL3:
001B71 E86A CB9A             8      RES 3,D
001B73 E86C CB92             8      RES 2,D
001B75 E86E 6B               4      LD  L,E
001B76 E86F 62               4      LD  H,D
001B77 E870 CB3C             8      SRL H   ;
001B79 E872 CB1D             8      RR  L   ;HLA=HLA/2
001B7B E874 1F               4      RRA     ;
001B7C E875 F5              11      PUSH    AF
001B7D E876 3AABEF          13      LD  A,(_FATIX)
001B80 E879 0F               4      RRCA
001B81 E87A 300B            12      JR  NC,NCL3X1
001B83 E87C 3A98E6          13      LD  A,(SECSZ+2)
001B86 E87F FE04             7      CP  4       ;1セクタ1024バイトの場合は奇数インデックスの場合に先頭を512バイトずらす
001B88 E881 2004            12      JR  NZ,NCL3X1
001B8A E883 010002          10      LD  BC,512
001B8D E886 09              11      ADD HL,BC
       E887                     NCL3X1:
001B8E E887 F1              10      POP AF
001B8F E888 ED4B7CF0        20      LD  BC,(_FATBF)
001B93 E88C 19              11      ADD HL,DE
001B94 E88D 09              11      ADD HL,BC
001B95 E88E 17               4      RLA
001B96 E88F C9              10      RET
                                
       E890                     GNCL:
001B97 E890 CD37E8          17      CALL    NCL1        ;GET NEXT CLUSTER
001B9A E893 D8              11      RET C
001B9B E894 C5              11      PUSH    BC
001B9C E895 E5              11      PUSH    HL
001B9D E896 CD6AE8          17      CALL    NCL3
001BA0 E899 3809            12      JR  C,GNC1
001BA2 E89B 5E               7      LD  E,(HL)
001BA3 E89C 23               6      INC HL
001BA4 E89D 7E               7      LD  A,(HL)
001BA5 E89E E60F             7      AND 00FH
001BA7 E8A0 57               4      LD  D,A
001BA8 E8A1 E1              10      POP HL
001BA9 E8A2 C1              10      POP BC
001BAA E8A3 C9              10      RET
       E8A4                     GNC1:
001BAB E8A4 7E               7      LD  A,(HL)
001BAC E8A5 23               6      INC HL
001BAD E8A6 56               7      LD  D,(HL)
001BAE E8A7 0604             7      LD  B,4
       E8A9                     GNC1L:
001BB0 E8A9 CB3A             8      SRL D   ;DA=DA/2
001BB2 E8AB 1F               4      RRA     ;
001BB3 E8AC 10FB            13      DJNZ    GNC1L
                                
001BB5 E8AE 5F               4      LD  E,A
001BB6 E8AF E1              10      POP HL
001BB7 E8B0 C1              10      POP BC
001BB8 E8B1 A7               4      AND A
001BB9 E8B2 C9              10      RET
                                
       E8B3                     SNCL:
001BBA E8B3 CD37E8          17      CALL    NCL1
001BBD E8B6 D8              11      RET C
                                ;               SET NEXT CLUSTER
001BBE E8B7 E5              11      PUSH    HL
001BBF E8B8 C5              11      PUSH    BC
001BC0 E8B9 D5              11      PUSH    DE
001BC1 E8BA E5              11      PUSH    HL
001BC2 E8BB CD6AE8          17      CALL    NCL3
001BC5 E8BE D1              10      POP DE
                                ;CF=ODD
001BC6 E8BF 7E               7      LD  A,(HL)
001BC7 E8C0 73               7      LD  (HL),E
001BC8 E8C1 3806            12      JR  C,SNC1
                                ;EVEN
                                ;M[0] = E
                                ;M[1] = (M[1] & 0xF0) | (D & 0x0F)
001BCA E8C3 23               6      INC HL
001BCB E8C4 ED67            18      RRD     ;M={A[3:0],E[3:0]}
001BCD E8C6 7A               4      LD  A,D
001BCE E8C7 1804            12      JR  SNC11
       E8C9                     SNC1:
                                ;ODD
                                ;HL[0] = (HL[0]&0x0F) | (E<<4)
                                ;HL[1] = DE>>4
001BD0 E8C9 ED6F            18      RLD     ;M={D[3:0],E[7:4]}
001BD2 E8CB 23               6      INC HL
001BD3 E8CC 72               7      LD  (HL),D  ;M={D[3:0],E[7:4]}
       E8CD                     SNC11:
001BD4 E8CD ED6F            18      RLD     ;M={M[7:4],D[3:0]}
001BD6 E8CF B7               4      OR  A
001BD7 E8D0 D1              10      POP DE
001BD8 E8D1 C1              10      POP BC
001BD9 E8D2 E1              10      POP HL
       E8D3                     FAT_CHANGED:
001BDA E8D3 3E01             7      LD  A,1
001BDC E8D5 32A2EF          13      LD  (_WTFATF),A
001BDF E8D8 C9              10      RET
                                
       E8D9                     N16CL3:
001BE0 E8D9 C5              11      PUSH    BC
001BE1 E8DA 6B               4      LD  L,E
001BE2 E8DB 7A               4      LD  A,D
001BE3 E8DC E603             7      AND 3
001BE5 E8DE 67               4      LD  H,A
001BE6 E8DF 29              11      ADD HL,HL
001BE7 E8E0 ED4B7CF0        20      LD  BC,(_FATBF)
001BEB E8E4 09              11      ADD HL,BC
001BEC E8E5 C1              10      POP BC
001BED E8E6 C9              10      RET
                                
       E8E7                     GNCL16:
001BEE E8E7 CD37E8          17      CALL    NCL1        ;GET NEXT CLUSTER for FAT16
001BF1 E8EA D8              11      RET C
001BF2 E8EB E5              11      PUSH    HL
001BF3 E8EC CDD9E8          17      CALL    N16CL3
001BF6 E8EF 5E               7      LD  E,(HL)
001BF7 E8F0 23               6      INC HL
001BF8 E8F1 56               7      LD  D,(HL)
001BF9 E8F2 E1              10      POP HL
001BFA E8F3 C9              10      RET
                                
       E8F4                     SNCL16:
001BFB E8F4 CD37E8          17      CALL    NCL1        ;GET NEXT CLUSTER for FAT16
001BFE E8F7 D8              11      RET C
001BFF E8F8 D5              11      PUSH    DE
001C00 E8F9 E5              11      PUSH    HL
001C01 E8FA CDD9E8          17      CALL    N16CL3
001C04 E8FD D1              10      POP DE      ;HL
001C05 E8FE 73               7      LD  (HL),E
001C06 E8FF 23               6      INC HL
001C07 E900 72               7      LD  (HL),D
001C08 E901 6B               4      LD  L,E
001C09 E902 62               4      LD  H,D
001C0A E903 D1              10      POP DE
001C0B E904 18CD            12      JR  FAT_CHANGED
                                
                                ;------------------------
                                ;次のセクタを探す際に_SECPSの値をチェック
                                ;in
                                ;   DE : セクタ番号
                                ;out
                                ;   DE : 次のセクタ番号
                                ;note
                                ;
                                ;------------------------
       E906                     NEXTX:
001C0D E906 3E00             7  _SECPS: LD  A,0 ;自己書き換え
001C0F E908 3C               4      INC A
001C10 E909 E600             7  NCPAT:  AND 0   ;自己書き換え　1クラスタの論理セクタ数-1
001C12 E90B 3207E9          13      LD  (_SECPS+1),A
001C15 E90E C9              10      RET
                                
       E90F                     GNCLX:
001C16 E90F CD06E9          17      CALL    NEXTX
001C19 E912 C0              11      RET NZ  ;1クラスタのセクタ未満の場合は戻る
001C1A E913 C3F7EF          10      JP  _GNCL   ;次のクラスタを探す
                                
       E916                     RDFAT:
001C1D E916 3E80             7      LD  A,080H
001C1F E918 3270EF          13      LD  (CHECK),A
       E91B                     RDFAT1:
001C22 E91B 3A88EF          13      LD  A,(_DRV)
001C25 E91E CDD6EB          17      CALL    CHGDRVR
001C28 E921 D8              11      RET C
001C29 E922 DD7E12          19      LD  A,(IX+012H) ;DPB_12_DEVICE
001C2C E925 CB6F             8      BIT 5,A
001C2E E927 286B            12      JR  Z,RDFAT0X
001C30 E929 2170EF          10      LD  HL,CHECK
001C33 E92C A6               7      AND (HL)
001C34 E92D 77               7      LD  (HL),A
001C35 E92E 110000          10      LD  DE,0        ;BPB
001C38 E931 2A7CF0          16      LD  HL,(_FATBF)
001C3B E934 CD8DEA          17      CALL    DRD16
001C3E E937 3024            12      JR  NC,GETBPB
001C40 E939 2170EF          10      LD  HL,CHECK
001C43 E93C CB06            15      RLC (HL)
001C45 E93E 3F               4      CCF
001C46 E93F D8              11      RET C
001C47 E940 DDCB0A1E        23      RR  (IX+00AH)   ;DPB_0A_FDMODE
001C4B E944 3F               4      CCF         ;フロッピーディスクのFDモードを切り替える
001C4C E945 DDCB0A16        23      RL  (IX+00AH)   ;DPB_0A_FDMODE
001C50 E949 3EFF             7      LD  A,0FFH
001C52 E94B 3289EF          13      LD  (_DSK),A
001C55 E94E 3A84EF          13      LD  A,(_DRIVE)
001C58 E951 E603             7      AND 3
001C5A E953 F680             7      OR  080H
001C5C E955 6F               4      LD  L,A
001C5D E956 26EF             7      LD  H,_CYL0/256
001C5F E958 3EFF             7      LD  A,0FFH
001C61 E95A 77               7      LD  (HL),A
001C62 E95B 18BE            12      JR  RDFAT1
       E95D                     GETBPB:
001C64 E95D FDE5            15      PUSH    IY
001C66 E95F FD2A7CF0        20      LD  IY,(_FATBF) ;BPB
001C6A E963 CDF1EF          17      CALL    _BPB2DPB
001C6D E966 FDE1            14      POP IY
001C6F E968 DD7E12          19      LD  A,(IX+012H) ;DPB_12_DEVICE
001C72 E96B 3021            12      JR  NC,GETBPBOK
001C74 E96D E60F             7      AND 00FH
001C76 E96F FE07             7      CP  7
001C78 E971 37               4      SCF
001C79 E972 C0              11      RET NZ
001C7A E973 DDCB0A46        20      BIT 0,(IX+00AH) ;DPB_0A_FDMODE
001C7E E977 21C0F0          10      LD  HL,M2D
001C81 E97A 2002            12      JR  NZ,SETFDMODE
001C83 E97C 2ED2             7      LD  L,M2HD-STABLE
       E97E                     SETFDMODE:
001C85 E97E DDE5            15      PUSH    IX
001C87 E980 D1              10      POP DE
001C88 E981 EDA0            16      LDI
001C8A E983 EDA0            16      LDI
001C8C E985 13               6      INC DE
001C8D E986 13               6      INC DE
001C8E E987 13               6      INC DE
001C8F E988 13               6      INC DE
001C90 E989 010C00          10      LD  BC,12
001C93 E98C EDB0                    LDIR
       E98E                     GETBPBOK:
001C95 E98E 329DE9          13      LD  (DEVSWC),A
001C98 E991 CD35EB          17      CALL    CHGDRV2
       E994                     RDFAT0X:
001C9B E994 CD81EA          17      CALL    RDFATS
001C9E E997 D8              11      RET C
001C9F E998 DDAE06          19      XOR (IX+6)      ;DPB_06_FATID
001CA2 E99B C8              11      RET Z
       E99D                     DEVSWC  EQU $+1
001CA3 E99C 3E00             7      LD  A,0     ;DPB_12_DEVICE
001CA5 E99E CB6F             8      BIT 5,A
001CA7 E9A0 C0              11      RET NZ      ;BPBを取得している場合はFATIDをチェックしない
001CA8 E9A1 37               4      SCF
001CA9 E9A2 C9              10      RET
                                
       E9A3                     BPB2DPB:
001CAA E9A3 FD7E0B          19      LD  A,(IY+11)   ;BPB_BytsPerSec
001CAD E9A6 B7               4      OR  A
001CAE E9A7 37               4      SCF
001CAF E9A8 C0              11      RET NZ
       E9A9                     BPBOK:
001CB0 E9A9 FD7E0D          19      LD  A,(IY+13)   ;BPB_SecPerClus
001CB3 E9AC DD7707          19      LD  (IX+7),A    ;DPB_07_SECPCL
                                
001CB6 E9AF FD7E16          19      LD  A,(IY+22)   ;BPB_FATSz16
001CB9 E9B2 DD7700          19      LD  (IX+0),A    ;DPB_00_FATLN
001CBC E9B5 FD7E17          19      LD  A,(IY+23)   ;BPB_FATSz16
001CBF E9B8 DD7701          19      LD  (IX+1),A    ;DPB_00_FATLN
                                
001CC2 E9BB FD6E0E          19      LD  L,(IY+14)   ;BPB_RsvdSecCnt
001CC5 E9BE FD660F          19      LD  H,(IY+15)
001CC8 E9C1 DD750E          19      LD  (IX+00EH),L ;DPB_0E_FATPS
001CCB E9C4 FD5E16          19      LD  E,(IY+22)   ;BPB_FATSz16
001CCE E9C7 FD5617          19      LD  D,(IY+23)
001CD1 E9CA FD4610          19      LD  B,(IY+16)   ;BPB_NumFATs
       E9CD                     BPBDP1:             ;BPB_FATSz16 * BPB_NumFATs
001CD4 E9CD 19              11      ADD HL,DE
001CD5 E9CE 10FD            13      DJNZ    BPBDP1
       E9D0                     BPBDP2:
001CD7 E9D0 DD7510          19      LD  (IX+010H),L ;DPB_10_DIRPS
001CDA E9D3 DD7411          19      LD  (IX+011H),H
001CDD E9D6 E5              11      PUSH    HL
                                
001CDE E9D7 FD6E11          19      LD  L,(IY+17)   ;BPB_RootEntCnt
001CE1 E9DA FD6612          19      LD  H,(IY+18)
001CE4 E9DD FD7E0C          19      LD  A,(IY+12)   ;BPB_BytsPerSec
001CE7 E9E0 B7               4      OR  A
001CE8 E9E1 37               4      SCF
001CE9 E9E2 C8              11      RET Z
001CEA E9E3 0606             7      LD  B,6
       E9E5                     BPBBPS1:
001CEC E9E5 05               4      DEC B
001CED E9E6 0F               4      RRCA
001CEE E9E7 30FC            12      JR  NC,BPBBPS1
       E9E9                     BPBDE1:
001CF0 E9E9 29              11      ADD HL,HL
001CF1 E9EA 10FD            13      DJNZ    BPBDE1
                                
001CF3 E9EC 7C               4      LD  A,H
001CF4 E9ED DD770B          19      LD  (IX+00BH),A ;DPB_0B_DIRSCNT
                                
001CF7 E9F0 D1              10      POP DE      ;DPB_10_DIRPS
001CF8 E9F1 6C               4      LD  L,H
001CF9 E9F2 2600             7      LD  H,0
001CFB E9F4 19              11      ADD HL,DE       ;MAXDIR
001CFC E9F5 E5              11      PUSH    HL
001CFD E9F6 FD4E0D          19      LD  C,(IY+13)   ;BPB_SecPerClus
001D00 E9F9 CB21             8      SLA C       ;*2
001D02 E9FB AF               4      XOR A
001D03 E9FC 47               4      LD  B,A
001D04 E9FD ED42            15      SBC HL,BC
001D06 E9FF DD7514          19      LD  (IX+014H),L ;DPB_14_ADDCL16
001D09 EA02 DD7415          19      LD  (IX+015H),H
                                
001D0C EA05 D1              10      POP DE      ;DE=DPB_0B_MAXDIR
001D0D EA06 FD6E13          19      LD  L,(IY+19)   ;BPB_TotSec16
001D10 EA09 FD6614          19      LD  H,(IY+20)
                                
001D13 EA0C DD7E12          19      LD  A,(IX+012H) ;DPB_12_DEVICE
001D16 EA0F E60F             7      AND 00FH
001D18 EA11 FE07             7      CP  7       ;フロッピー
001D1A EA13 2019            12      JR  NZ,NOT_FD
001D1C EA15 E5              11      PUSH    HL
001D1D EA16 FD4E18          19      LD  C,(IY+24)   ;BPB_SecPerTr
001D20 EA19 DD710D          19      LD  (IX+00DH),C ;DPB_0D_MAXSEC
001D23 EA1C AF               4      XOR A
001D24 EA1D CB21             8      SLA C       ;両面なのでセクタ数を２倍
001D26 EA1F 0610             7      LD  B,16
       EA21                     DIVSEC:             ;MAXCYL = BPB_TotSec16 / (BPB_SecPerTr * 2)
001D28 EA21 29              11      ADD HL,HL
001D29 EA22 17               4      RLA
001D2A EA23 B9               4      CP  C
001D2B EA24 3802            12      JR  C,DIVSEC1
001D2D EA26 91               4      SUB C
001D2E EA27 2C               4      INC L
       EA28                     DIVSEC1:
001D2F EA28 10F7            13      DJNZ    DIVSEC
001D31 EA2A DD750C          19      LD  (IX+00CH),L ;DPB_0C_MAXCYL
001D34 EA2D E1              10      POP HL  ;ここまでフロッピー専用
       EA2E                     NOT_FD:
001D35 EA2E 7C               4      LD  A,H
001D36 EA2F B5               4      OR  L
001D37 EA30 3E00             7      LD  A,0     ;LDでフラグは変化しない。BPB_TotSec16を AHL で扱う為、Aに0を入れる
001D39 EA32 2010            12      JR  NZ,BPB16BIT ;BPB_TotSec16が「0」の場合はBPB_TotSec32で計算
001D3B EA34 FD7E23          19      LD  A,(IY+35)   ;念のために総セクタ数が24ビットを超える場合はエラーを返す
001D3E EA37 B7               4      OR  A
001D3F EA38 37               4      SCF
001D40 EA39 C0              11      RET NZ
001D41 EA3A FD6E20          19      LD  L,(IY+32)   ;BPB_TotSec32 は AHL の24ビットで扱う
001D44 EA3D FD6621          19      LD  H,(IY+33)   ;1クラスタの論理セクタ数(DPB_07_SECPCL)が最大128なので
001D47 EA40 FD7E22          19      LD  A,(IY+34)   ;24ビットを超えると必ずクラスタ数が16ビットを超えてしまうのでこれで十分
001D4A EA43 A7               4      AND A       ;CF=0
       EA44                     BPB16BIT:
001D4B EA44 ED52            15      SBC HL,DE
001D4D EA46 DE00             7      SBC A,0
001D4F EA48 FD460D          19      LD  B,(IY+13)   ;BPB_SecPerClus
       EA4B                     BPBTC1:             ;総クラスタ数(AHL) = 総セクタ数(AHL) / セクタサイズ(B)
001D52 EA4B CB18             8      RR  B       ;->CY
001D54 EA4D 3808            12      JR  C,BPBTC2
001D56 EA4F CB3F             8      SRL A
001D58 EA51 CB1C             8      RR  H       ;AHL=AHL/2
001D5A EA53 CB1D             8      RR  L
001D5C EA55 18F4            12      JR  BPBTC1
       EA57                     BPBTC2:
001D5E EA57 B7               4      OR  A
001D5F EA58 37               4      SCF
001D60 EA59 C0              11      RET NZ      ;念のため(クラスタ数が16ビットを超える場合)
001D61 EA5A 23               6      INC HL
001D62 EA5B 23               6      INC HL
001D63 EA5C DD7508          19      LD  (IX+8),L    ;DPB_08_MAXCL
001D66 EA5F DD7409          19      LD  (IX+9),H
                                
001D69 EA62 FD7E15          19      LD  A,(IY+21)   ;BPB_Media
001D6C EA65 DD7706          19      LD  (IX+6),A    ;DPB_06_FATID
                                
001D6F EA68 FD7E10          19      LD  A,(IY+16)   ;BPB_NumFATs
001D72 EA6B C6FE             7      ADD A,0-2       ;>2:CF=1
001D74 EA6D FD7E0C          19      LD  A,(IY+12)   ;BPB_BytsPerSec
001D77 EA70 6F               4      LD  L,A
001D78 EA71 3002            12      JR  NC,BPBFAT1
001D7A EA73 F680             7      OR  080H
       EA75                     BPBFAT1:
001D7C EA75 DD770F          19      LD  (IX+00FH),A ;DPB_0F_BPS
001D7F EA78 2D               4      DEC L       ;以下のセクタサイズに合致しない場合はCF=1でエラーにする
001D80 EA79 C8              11      RET Z       ;1セクタ256バイト
001D81 EA7A 2D               4      DEC L
001D82 EA7B C8              11      RET Z       ;1セクタ512バイト
001D83 EA7C 2D               4      DEC L
001D84 EA7D 2D               4      DEC L
001D85 EA7E C8              11      RET Z       ;1セクタ1024バイト
001D86 EA7F 37               4      SCF
001D87 EA80 C9              10      RET
                                
       EA81                     RDFATS:
001D88 EA81 CDC7EA          17      CALL    FATSETUP
001D8B EA84 D8              11      RET C
001D8C EA85 CD91EA          17      CALL    DRD24B
001D8F EA88 2A7CF0          16      LD  HL,(_FATBF)
001D92 EA8B 7E               7      LD  A,(HL)
001D93 EA8C C9              10      RET
                                
       EA8D                     DRD16:
001D94 EA8D 0E00             7      LD  C,0
       EA8F                     DRD24:
001D96 EA8F 0601             7      LD  B,1
       EA91                     DRD24B:
001D98 EA91 DDE5            15      PUSH    IX
001D9A EA93 DD2AA8EF        20      LD  IX,(_DPB)
001D9E EA97 CD6BED          17  DRDPAT: CALL    FDRD        ;自己書き換え（ディスク読み込み）
       EA9A                     POP_IX_RET:
001DA1 EA9A DDE1            14      POP IX
001DA3 EA9C C9              10      RET
                                
       EA9D                     DWT16:
001DA4 EA9D 0E00             7      LD  C,0
       EA9F                     DWT24:
001DA6 EA9F 0601             7      LD  B,1
       EAA1                     DWT24B:
001DA8 EAA1 DDE5            15      PUSH    IX
001DAA EAA3 DD2AA8EF        20      LD  IX,(_DPB)
001DAE EAA7 CDCFEC          17  DWTPAT: CALL    FDWT        ;自己書き換え（ディスク書き込み）
001DB1 EAAA 18EE            12      JR  POP_IX_RET
                                
       EAAC                     WTFAT:
001DB3 EAAC CDC7EA          17      CALL    FATSETUP
001DB6 EAAF D4A1EA          17      CALL    NC,DWT24B
001DB9 EAB2 D8              11      RET C
001DBA EAB3 DDCB0F7E        20      BIT 7,(IX+00FH) ;DPB_0F_BPS
001DBE EAB7 C8              11      RET Z       ;予備FATが無い
001DBF EAB8 CDCEEA          17      CALL    FATS2
001DC2 EABB E5              11      PUSH    HL      ;予備FAT
001DC3 EABC DD6E00          19      LD  L,(IX+0)    ;DPB_00_FATLN
001DC6 EABF DD6601          19      LD  H,(IX+1)
001DC9 EAC2 19              11      ADD HL,DE
001DCA EAC3 EB               4      EX  DE,HL
001DCB EAC4 E1              10      POP HL
001DCC EAC5 18DA            12      JR  DWT24B
                                ;------------------------
                                ;FATのセットアップ
                                ;out
                                ;   B  : FATセクタ数
                                ;   DE : FAT先頭セクタ番号
                                ;   HL : FATバッファポインタ
                                ;   CF : 1=ドライブ切り替えエラー
                                ;note
                                ;   FATサイズがFATバッファを超える場合は
                                ;   対象クラスタ領域==(_FATIX)によって
                                ;   FAT12:対象クラスタ1024毎に1.5KBを切り替える
                                ;   FAT16:対象クラスタ1024毎に2KBを切り替える
                                ;------------------------
       EAC7                     FATSETUP:
001DCE EAC7 3AAAEF          13      LD  A,(_FATDRV)
001DD1 EACA CDD6EB          17      CALL    CHGDRVR     ;ドライブ切り替え
001DD4 EACD D8              11      RET C
       EACE                     FATS2:
001DD5 EACE DD7E0F          19      LD  A,(IX+00FH) ;DPB_0F_BPS 512=2 1024=4
001DD8 EAD1 0F               4      RRCA
001DD9 EAD2 CDFBEA          17  FATSX:  CALL    FATSETUP12  ;自己書き換え
001DDC EAD5 210000          10      LD  HL,0
001DDF EAD8 4A               4      LD  C,D
001DE0 EAD9 54               4      LD  D,H
001DE1 EADA 3AABEF          13      LD  A,(_FATIX)  ;範囲FAT12:0-3/FAT16:0-63(0-03FH):65535*2/2048
001DE4 EADD 47               4      LD  B,A
001DE5 EADE 04               4      INC B
001DE6 EADF DD7E00          19      LD  A,(IX+0)    ;DPB_00_FATLN
       EAE2                     FAT_SKP:
001DE9 EAE2 05               4      DEC B
001DEA EAE3 2805            12      JR  Z,FAT1
001DEC EAE5 19              11      ADD HL,DE
001DED EAE6 93               4      SUB E
001DEE EAE7 30F9            12      JR  NC,FAT_SKP
001DF0 EAE9 C9              10      RET
       EAEA                     FAT1:
001DF1 EAEA EB               4      EX  DE,HL
001DF2 EAEB B9               4      CP  C       ;C=FATバッファに読み込めるセクタ数
001DF3 EAEC 3801            12      JR  C,FAT2
001DF5 EAEE 79               4      LD  A,C
       EAEF                     FAT2:
001DF6 EAEF 47               4      LD  B,A
                                
001DF7 EAF0 2AFAF0          16      LD  HL,(_FATPS) ;fat sector pos
001DFA EAF3 19              11      ADD HL,DE
001DFB EAF4 EB               4      EX  DE,HL
001DFC EAF5 2A7CF0          16      LD  HL,(_FATBF)
001DFF EAF8 AF               4      XOR A       ;CF=0
001E00 EAF9 4F               4      LD  C,A
001E01 EAFA C9              10      RET
                                ;
                                ;   FATバッファに読み込める最大のセクタ数と_FATIXで進めるセクタ数
                                ;   FATSETUP* (FAT12/FAT16)
                                ;out
                                ;   D : FATバッファに読み込める最大のセクタ数
                                ;   E : _FATIXで進めるセクタ数
       EAFB                     FATSETUP12:
001E02 EAFB 110606          10      LD  DE,0606H    ;256
001E05 EAFE D8              11      RET C
001E06 EAFF 110303          10      LD  DE,0303H    ;512
001E09 EB02 0F               4      RRCA
001E0A EB03 D8              11      RET C
001E0B EB04 110102          10      LD  DE,0201H    ;1024
001E0E EB07 C9              10      RET
                                
       EB08                     FATSETUP16:
001E0F EB08 110808          10      LD  DE,0808H    ;256
001E12 EB0B D8              11      RET C
001E13 EB0C 110404          10      LD  DE,0404H
001E16 EB0F 0F               4      RRCA            ;512
001E17 EB10 D8              11      RET C
001E18 EB11 110202          10      LD  DE,0202H    ;1024
001E1B EB14 C9              10      RET
                                
       EB15                     CHGDRV:
001E1C EB15 E5              11      PUSH    HL
001E1D EB16 2189EF          10      LD  HL,_DSK
001E20 EB19 BE               7      CP  (HL)
001E21 EB1A 280A            12      JR  Z,CHGDRVE
       EB1C                     CHGDRV1:
001E23 EB1C DDE5            15      PUSH    IX
001E25 EB1E CD28EB          17      CALL    CHGDRV0
001E28 EB21 3A89EF          13      LD  A,(_DSK)
001E2B EB24 DDE1            14      POP IX
       EB26                     CHGDRVE:
001E2D EB26 E1              10      POP HL
001E2E EB27 C9              10      RET
                                
       EB28                     CHGDRV0:
001E2F EB28 6F               4      LD  L,A
001E30 EB29 CDDCEF          17      CALL    _GETDPB
001E33 EB2C D8              11      RET C
001E34 EB2D DD22A8EF        20      LD  (_DPB),IX
001E38 EB31 7D               4      LD  A,L
001E39 EB32 3289EF          13      LD  (_DSK),A
       EB35                     CHGDRV2:
001E3C EB35 C5              11      PUSH    BC
001E3D EB36 D5              11      PUSH    DE
001E3E EB37 ED738CEB        20      LD  (SPPAT2+1),SP
001E42 EB3B F3               4      DI
001E43 EB3C DDF9            10      LD  SP,IX
                                
001E45 EB3E E1              10      POP HL      ;DPB_00_FATLN
001E46 EB3F E1              10      POP HL      ;DPB_02_DRD
001E47 EB40 2298EA          16      LD  (DRDPAT+1),HL
                                
001E4A EB43 E1              10      POP HL
001E4B EB44 22A8EA          16      LD  (DWTPAT+1),HL   ;DPB_04_DWT
                                
001E4E EB47 E1              10      POP HL      ;L=DPB_06_FATID H=DPB_07_SECPCL
001E4F EB48 7C               4      LD  A,H
001E50 EB49 327AE1          13      LD  (SPCPAT+1),A    ;1クラスタの論理セクタ数
001E53 EB4C 3D               4      DEC A
001E54 EB4D 320AE9          13      LD  (NCPAT+1),A
                                
001E57 EB50 E1              10      POP HL      ;DPB_08_MAXCL
001E58 EB51 7D               4      LD  A,L
001E59 EB52 3299E1          13      LD  (CLPAT2+1),A
001E5C EB55 7C               4      LD  A,H
001E5D EB56 3295E1          13      LD  (CLPAT1+1),A
001E60 EB59 2B               6      DEC HL
001E61 EB5A 229DE3          16      LD  (MAXCLP+1),HL
                                
001E64 EB5D E1              10      POP HL      ;L=DPB_0A_FDMODE H=DPB_0B_DIRSCNT
001E65 EB5E 7D               4      LD  A,L
001E66 EB5F F6FE             7      OR  0FEH
001E68 EB61 329AED          13      LD  (FDMODE+1),A
001E6B EB64 07               4      RLCA
001E6C EB65 E603             7      AND 3
001E6E EB67 326BEF          13      LD  (FSPAT+1),A
001E71 EB6A 4C               4      LD  C,H
                                
001E72 EB6B E1              10      POP HL      ;L=DPB_0C_MAXCYL H=DPB_0D_MAXSEC
                                
001E73 EB6C E1              10      POP HL      ;L=DPB_0E_FATPS H=DPB_0F_BPS
001E74 EB6D 7C               4      LD  A,H     ;DPB_0F_BPS
001E75 EB6E E607             7      AND 7
001E77 EB70 3298E6          13      LD  (SECSZ+2),A ;1セクタのサイズの上位1バイト 0x400 - 0x200 - 0x100
                                                ;1セクタ512 2D/2DD/2HC/2HQ(2HD1.44MB)/EMM/BRAM/EMEM等
                                                ;1セクタ1024 2HD/2HDE98
                                                ;1セクタ256 GRAM/RAMF/CMOS/等
                                                ;1024   512 256
                                                ;4  2   1
001E7A EB73 87               4      ADD A,A     ;8  4   2
001E7B EB74 87               4      ADD A,A     ;010H   8   4
001E7C EB75 87               4      ADD A,A     ;020H   010H    8
001E7D EB76 32F6DF          13      LD  (SDECPAT+1),A   ;1セクタ辺りのディレクトリエントリ数
                                
001E80 EB79 2600             7      LD  H,0
001E82 EB7B 22FAF0          16      LD  (_FATPS),HL
                                
001E85 EB7E E1              10      POP HL      ;DPB_10_DIRPS
001E86 EB7F 22FCF0          16      LD  (_DIRPS),HL
                                
001E89 EB82 E1              10      POP HL      ;L=DPB_12_DEVICE H=DPB_13_UNITNO
001E8A EB83 7C               4      LD  A,H
001E8B EB84 3284EF          13      LD  (_DRIVE),A
                                
001E8E EB87 E1              10      POP HL      ;DPB_14_ADDCL16
001E8F EB88 228AE1          16      LD  (CLSPAT+1),HL
                                
001E92 EB8B 310000          10  SPPAT2: LD  SP,0        ;元のSPを復元
001E95 EB8E FB               4      EI
001E96 EB8F 2AFCF0          16      LD  HL,(_DIRPS)
001E99 EB92 0600             7      LD  B,0
001E9B EB94 09              11      ADD HL,BC       ;C=DPB_0B_DIRSCNT
001E9C EB95 2211E0          16      LD  (MD_PAT+1),HL
                                
001E9F EB98 2A9DE3          16      LD  HL,(MAXCLP+1);
001EA2 EB9B 11F60F          10      LD  DE,4086     ;クラスタ数が4086未満:FAT12 4086以上:FAT16
001EA5 EB9E ED52            15      SBC HL,DE       ;CF=0のはず
001EA7 EBA0 300F            12      JR  NC,SETFAT16
001EA9 EBA2 2190E8          10      LD  HL,GNCL     ;FAT12
001EAC EBA5 11B3E8          10      LD  DE,SNCL
001EAF EBA8 01FBEA          10      LD  BC,FATSETUP12
001EB2 EBAB DDCB0FAE        23      RES 5,(IX+00FH) ;DPB_0F_BPS(FAT12)
001EB6 EBAF 180D            12      JR  EXTRA1
       EBB1                     SETFAT16:
001EB8 EBB1 21E7E8          10      LD  HL,GNCL16   ;FAT16
001EBB EBB4 11F4E8          10      LD  DE,SNCL16
001EBE EBB7 0108EB          10      LD  BC,FATSETUP16
001EC1 EBBA DDCB0FEE        23      SET 5,(IX+00FH) ;DPB_0F_BPS(FAT16)
       EBBE                     EXTRA1:
001EC5 EBBE 22F8EF          16      LD  (GNCPAT+1),HL
001EC8 EBC1 ED53FBEF        20      LD  (SNCPAT+1),DE
001ECC EBC5 ED43D3EA        20      LD  (FATSX+1),BC
001ED0 EBC9 D1              10      POP DE
001ED1 EBCA C1              10      POP BC
001ED2 EBCB AF               4      XOR A
001ED3 EBCC C9              10      RET
                                
       EBCD                     GETDPBD:
001ED4 EBCD DDE3            23      EX  (SP),IX
001ED6 EBCF DDE5            15      PUSH    IX
001ED8 EBD1 3A88EF          13      LD  A,(_DRV)
001EDB EBD4 1807            12      JR  GETDPB1
                                
       EBD6                     CHGDRVR:
001EDD EBD6 CDD9EF          17      CALL    _CHGDRV
001EE0 EBD9 D8              11      RET C
001EE1 EBDA 3A89EF          13      LD  A,(_DSK)
       EBDD                     GETDPB1:
001EE4 EBDD C3DCEF          10      JP  _GETDPB
                                
       EBE0                     GETDPB:
001EE7 EBE0 FE08             7      CP  8
001EE9 EBE2 3F               4      CCF
001EEA EBE3 D8              11      RET C
001EEB EBE4 0F               4      RRCA
001EEC EBE5 0F               4      RRCA
001EED EBE6 0F               4      RRCA
001EEE EBE7 DD                      DB  0DDH        ;Z80未定義命令
001EEF EBE8 6F               4      LD  L,A     ;LD IXL,A
001EF0 EBE9 DD                      DB  0DDH        ;Z80未定義命令
001EF1 EBEA 26F2             7      LD  H,DEVICE/256    ;LD IXH,DEVICE/256
001EF3 EBEC DD7E00          19      LD  A,(IX+0)    ;DPB_00_FATLN
001EF6 EBEF A7               4      AND A       ;CF=0の為
001EF7 EBF0 DDCB0F6E        20      BIT 5,(IX+00FH) ;DPB_0F_BPS
001EFB EBF4 C0              11      RET NZ      ;FAT16
001EFC EBF5 DDCB126E        20      BIT 5,(IX+012H) ;DPB_12_DEVICE
001F00 EBF9 C0              11      RET NZ      ;BPB
001F01 EBFA FE01             7      CP  001H        ;A=0 THEN CF=1
001F03 EBFC C9              10      RET
                                
       EBFD                     _SYS5F:
001F04 EBFD AF               4      XOR A
       EBFE                     FFLUSH:
001F05 EBFE F5              11      PUSH    AF
001F06 EBFF 3EFF             7      LD  A,0FFH
001F08 EC01 3239EF          13      LD  (SFILE),A
001F0B EC04 CDCEE7          17      CALL    DWTX
001F0E EC07 3EFF             7      LD  A,0FFH
001F10 EC09 32A5EF          13      LD  (_DBDRV),A
001F13 EC0C CD18E8          17      CALL    WTFATX
001F16 EC0F AF               4      XOR A
001F17 EC10 32ABEF          13      LD  (_FATIX),A
001F1A EC13 2F               4      CPL         ;0FFH
001F1B EC14 32AAEF          13      LD  (_FATDRV),A
001F1E EC17 F1              10      POP AF
001F1F EC18 C9              10      RET
                                
[EOF:LDDIO.ASM:SHIFT_JIS]
                                    INCLUDE "88DISK.ASM"
                                
                                ;   LSX-Dodgers DISK
                                ;   PC-8801mkIISR
                                
                                ;   FLOPPY DISK DRIVER
                                ;
                                ;   コマンド送信
       EC19                     PUTCOM:
001F20 EC19 F5              11      PUSH    AF
001F21 EC1A 3E0F             7      LD  A,00FH
001F23 EC1C D3FF            11      OUT (0FFH),A    ;ディスクサブシステムI/F 8255 コントロール
001F25 EC1E F1              10      POP AF
                                ;   通常ハンドシェイク（ホストが送信）
       EC1F                     PUTDAT:
001F26 EC1F F5              11      PUSH    AF
       EC20                     PUTDAT1:
001F27 EC20 DBFE            11      IN  A,(0FEH)    ;ディスクサブシステムI/F 8255 ポートC
001F29 EC22 E602             7      AND 2       ;RFD
001F2B EC24 28FA            12      JR  Z,PUTDAT1
001F2D EC26 3E0E             7      LD  A,00EH      ;ATN=0
001F2F EC28 D3FF            11      OUT (0FFH),A    ;ディスクサブシステムI/F 8255 コントロール
001F31 EC2A F1              10      POP AF
001F32 EC2B D3FD            11      OUT (0FDH),A    ;標準状態ではサブシステムへのデータ送信ポート
001F34 EC2D F5              11      PUSH    AF
001F35 EC2E 3E09             7      LD  A,9     ;DAV=1
001F37 EC30 D3FF            11      OUT (0FFH),A
       EC32                     PUTDAT2:
001F39 EC32 DBFE            11      IN  A,(0FEH)    ;ディスクサブシステムI/F 8255 ポートC
001F3B EC34 E604             7      AND 4       ;DAC
001F3D EC36 28FA            12      JR  Z,PUTDAT2
                                
001F3F EC38 3E08             7      LD  A,8     ;DAV=0
001F41 EC3A D3FF            11      OUT (0FFH),A
       EC3C                     PUTDAT3:
001F43 EC3C DBFE            11      IN  A,(0FEH)    ;ディスクサブシステムI/F 8255 ポートC
001F45 EC3E E604             7      AND 4       ;DAC
001F47 EC40 20FA            12      JR  NZ,PUTDAT3
001F49 EC42 F1              10      POP AF
001F4A EC43 C9              10      RET
                                
                                ;   通常ハンドシェイク（ホストが受信）
       EC44                     GETDAT:
001F4B EC44 3E0B             7      LD  A,00BH      ;RFD=1
001F4D EC46 D3FF            11      OUT (0FFH),A    ;ディスクサブシステムI/F 8255 コントロール
       EC48                     GETDAT1:
001F4F EC48 DBFE            11      IN  A,(0FEH)    ;ディスクサブシステムI/F 8255 ポートC
001F51 EC4A 0F               4      RRCA            ;DAV
001F52 EC4B 30FB            12      JR  NC,GETDAT1
                                    
001F54 EC4D 3E0A             7      LD  A,00AH      ;RFD=0
001F56 EC4F D3FF            11      OUT (0FFH),A    ;ディスクサブシステムI/F 8255 コントロール
                                    
001F58 EC51 DBFC            11      IN  A,(0FCH)    ;標準状態ではサブシステムからのデータ受信ポート
001F5A EC53 F5              11      PUSH    AF
001F5B EC54 3E0D             7      LD  A,00DH      ;DAC=1
001F5D EC56 D3FF            11      OUT (0FFH),A    ;ディスクサブシステムI/F 8255 コントロール
                                
       EC58                     GETDAT2:
001F5F EC58 DBFE            11      IN  A,(0FEH)    ;ディスクサブシステムI/F 8255 ポートC
001F61 EC5A 0F               4      RRCA            ;DAV
001F62 EC5B 38FB            12      JR  C,GETDAT2
                                
001F64 EC5D 3E0C             7      LD  A,00CH      ;DAC=0
001F66 EC5F D3FF            11      OUT (0FFH),A
001F68 EC61 F1              10      POP AF
001F69 EC62 C9              10      RET
                                
                                ;   高速ハンドシェイク（ホストが送信）
                                ;   HL:アドレス BC:受信サイズ（必ず偶数にする）
       EC63                     FPUTDAT:
       EC63                     FPUTDAT1:
001F6A EC63 DBFE            11      IN  A,(0FEH)    ;ディスクサブシステムI/F 8255 ポートC
001F6C EC65 E602             7      AND 2       ;RFD
001F6E EC67 28FA            12      JR  Z,FPUTDAT1
001F70 EC69 3E0E             7      LD  A,00EH      ;ATN=0
001F72 EC6B D3FF            11      OUT (0FFH),A    ;ディスクサブシステムI/F 8255 コントロール
                                
001F74 EC6D 7E               7      LD  A,(HL)
001F75 EC6E D3FD            11      OUT (0FDH),A    ;標準状態ではサブシステムへのデータ送信ポート
                                
001F77 EC70 3E09             7      LD  A,9     ;DAV=1
001F79 EC72 D3FF            11      OUT (0FFH),A
001F7B EC74 23               6      INC HL
001F7C EC75 0B               6      DEC BC
       EC76                     FPUTDAT2:
001F7D EC76 DBFE            11      IN  A,(0FEH)    ;ディスクサブシステムI/F 8255 ポートC
001F7F EC78 E604             7      AND 4       ;DAC
001F81 EC7A 28FA            12      JR  Z,FPUTDAT2
                                
001F83 EC7C 7E               7      LD  A,(HL)
001F84 EC7D D3FD            11      OUT (0FDH),A    ;標準状態ではサブシステムへのデータ送信ポート
                                
001F86 EC7F 3E08             7      LD  A,8     ;DAV=0
001F88 EC81 D3FF            11      OUT (0FFH),A
       EC83                     FPUTDAT3:
001F8A EC83 DBFE            11      IN  A,(0FEH)    ;ディスクサブシステムI/F 8255 ポートC
001F8C EC85 E604             7      AND 4       ;DAC
001F8E EC87 20FA            12      JR  NZ,FPUTDAT3
                                
001F90 EC89 EDA1            16      CPI         ;HL=HL+1 BC=BC-1 BCが0の場合にP/V=0
001F92 EC8B EA63EC          10      JP  PE,FPUTDAT
001F95 EC8E C9              10      RET
                                
                                
                                ;   高速ハンドシェイク（ホストが受信）
                                ;   HL:アドレス BC:受信サイズ（必ず偶数にする）
       EC8F                     FGETDAT:
001F96 EC8F 3E0B             7      LD  A,00BH      ;RFD=1
001F98 EC91 D3FF            11      OUT (0FFH),A    ;ディスクサブシステムI/F 8255 コントロール
       EC93                     FGETDAT1:
001F9A EC93 DBFE            11      IN  A,(0FEH)    ;ディスクサブシステムI/F 8255 ポートC
001F9C EC95 0F               4      RRCA            ;DAV
001F9D EC96 30FB            12      JR  NC,FGETDAT1
                                    
001F9F EC98 3E0A             7      LD  A,00AH      ;RFD=0
001FA1 EC9A D3FF            11      OUT (0FFH),A    ;ディスクサブシステムI/F 8255 コントロール
                                    
001FA3 EC9C DBFC            11      IN  A,(0FCH)    ;標準状態ではサブシステムからのデータ受信ポート
001FA5 EC9E 77               7      LD  (HL),A
                                
001FA6 EC9F 3E0D             7      LD  A,00DH      ;DAC=1
001FA8 ECA1 D3FF            11      OUT (0FFH),A    ;ディスクサブシステムI/F 8255 コントロール
001FAA ECA3 23               6      INC HL
001FAB ECA4 0B               6      DEC BC
       ECA5                     FGETDAT2:
001FAC ECA5 DBFE            11      IN  A,(0FEH)    ;ディスクサブシステムI/F 8255 ポートC
001FAE ECA7 0F               4      RRCA            ;DAV
001FAF ECA8 38FB            12      JR  C,FGETDAT2
                                
001FB1 ECAA DBFC            11      IN  A,(0FCH)    ;標準状態ではサブシステムからのデータ受信ポート
001FB3 ECAC 77               7      LD  (HL),A
                                
001FB4 ECAD 3E0C             7      LD  A,00CH      ;DAC=0
001FB6 ECAF D3FF            11      OUT (0FFH),A
                                
001FB8 ECB1 EDA1            16      CPI         ;HL=HL+1 BC=BC-1 BCが0の場合にP/V=0
001FBA ECB3 EA8FEC          10      JP  PE,FGETDAT
001FBD ECB6 C9              10      RET
                                
                                ;   論理セクタ番号からトラック番号とセクタ番号を得る
                                ;   in 
                                ;   DE:論理セクタ
       ECB7                     CALC_SECTOR:
001FBE ECB7 C5              11      PUSH    BC
001FBF ECB8 DD4E0D          19      LD  C,(IX+00DH) ;フロッピーディスクの1トラックのセクタ数(DPB_0D_MAXSEC)
001FC2 ECBB 0610             7      LD  B,16
001FC4 ECBD AF               4      XOR A
001FC5 ECBE EB               4      EX  DE,HL
       ECBF                     DIV1:
001FC6 ECBF 29              11      ADD HL,HL
001FC7 ECC0 8F               4      ADC A,A
001FC8 ECC1 B9               4      CP  C
001FC9 ECC2 3802            12      JR  C,DIV2
001FCB ECC4 91               4      SUB C
001FCC ECC5 2C               4      INC L
       ECC6                     DIV2:
001FCD ECC6 10F7            13      DJNZ    DIV1
                                
001FCF ECC8 3C               4      INC A   ;最小のセクタは１固定
001FD0 ECC9 55               4      LD  D,L ;TRACK
       ECCA                     DIV3:
001FD1 ECCA 5F               4      LD  E,A ;SECTOR
001FD2 ECCB C1              10      POP BC
001FD3 ECCC C9              10      RET
                                
       ECCD                     WTTRK:
001FD4 ECCD 37               4      SCF
001FD5 ECCE C9              10      RET
       ECCF                     FDWT:
001FD6 ECCF E5              11      PUSH    HL
001FD7 ECD0 D5              11      PUSH    DE
001FD8 ECD1 CDB7EC          17      CALL    CALC_SECTOR
001FDB ECD4 7A               4      LD  A,D     ;トラック
001FDC ECD5 3235ED          13      LD  (FDWT_TRACK),A
001FDF ECD8 7B               4      LD  A,E     ;セクタ
001FE0 ECD9 3230ED          13      LD  (FDWT_SECTOR),A
001FE3 ECDC DD7E0D          19      LD  A,(IX+00DH) ;フロッピーディスクの1トラックのセクタ数(DPB_0D_MAXSEC)
001FE6 ECDF 93               4      SUB E
001FE7 ECE0 3C               4      INC A
001FE8 ECE1 67               4      LD  H,A
001FE9 ECE2 D1              10      POP DE
001FEA ECE3 3A98E6          13      LD  A,(SECSZ+2) ;1セクタのサイズの上位1バイト
001FED ECE6 4F               4      LD  C,A
001FEE ECE7 AF               4      XOR A
       ECE8                     FDWT2:
001FEF ECE8 81               4      ADD A,C
001FF0 ECE9 13               6      INC DE
001FF1 ECEA 05               4      DEC B
001FF2 ECEB 2807            12      JR  Z,FDWT3
001FF4 ECED 25               4      DEC H       ;トラック、ヘッドを跨がない
001FF5 ECEE 2804            12      JR  Z,FDWT3
001FF7 ECF0 FE3A             7      CP  03AH        ;バッファとして04000H-07BFFHまで使える
001FF9 ECF2 38F4            12      JR  C,FDWT2
       ECF4                     FDWT3:
001FFB ECF4 4F               4      LD  C,A
001FFC ECF5 E1              10      POP HL
001FFD ECF6 3E16             7      LD  A,16H       ;高速レシーブメモリ
001FFF ECF8 CD19EC          17      CALL    PUTCOM
002002 ECFB 3E40             7      LD  A,DSS_DATA/256  ;開始アドレスH
002004 ECFD CD1FEC          17      CALL    PUTDAT
002007 ED00 AF               4      XOR A       ;開始アドレスL
002008 ED01 CD1FEC          17      CALL    PUTDAT
00200B ED04 79               4      LD  A,C     ;バイト数H
00200C ED05 CD1FEC          17      CALL    PUTDAT
00200F ED08 AF               4      XOR A       ;バイト数L
002010 ED09 CD1FEC          17      CALL    PUTDAT
002013 ED0C C5              11      PUSH    BC
002014 ED0D 41               4      LD  B,C
002015 ED0E 0E00             7      LD  C,0
002017 ED10 CD63EC          17      CALL    FPUTDAT
00201A ED13 C1              10      POP BC
00201B ED14 3E0D             7      LD  A,0DH       ;エグゼキュート
00201D ED16 CD19EC          17      CALL    PUTCOM
002020 ED19 3E7C             7      LD  A,WRITEDISKEX/256
002022 ED1B CD1FEC          17      CALL    PUTDAT
002025 ED1E 3E78             7      LD  A,WRITEDISKEX%256
002027 ED20 CD1FEC          17      CALL    PUTDAT
00202A ED23 DD7E13          19      LD  A,(IX+013H) ;デバイスドライバ内におけるユニット番号(DPB_13_UNITNO)
00202D ED26 CD1FEC          17      CALL    PUTDAT
002030 ED29 DD7E0D          19      LD  A,(IX+00DH) ;フロッピーディスクの1トラックのセクタ数(DPB_0D_MAXSEC)
002033 ED2C CD1FEC          17      CALL    PUTDAT
       ED30                     FDWT_SECTOR EQU $+1
002036 ED2F 3E00             7      LD  A,0     ;セクタ
002038 ED31 CD1FEC          17      CALL    PUTDAT
       ED35                     FDWT_TRACK  EQU $+1
00203B ED34 3E00             7      LD  A,0     ;トラック
00203D ED36 CD1FEC          17      CALL    PUTDAT
002040 ED39 3A9AED          13      LD  A,(FDMODE+1)    ;フロッピーディスクのモード(DPB_0A_FDMODE)
002043 ED3C CD1FEC          17      CALL    PUTDAT
002046 ED3F 3A98E6          13      LD  A,(SECSZ+2) ;1セクタのサイズの上位1バイト
002049 ED42 CD1FEC          17      CALL    PUTDAT
00204C ED45 79               4      LD  A,C
00204D ED46 CD1FEC          17      CALL    PUTDAT      ;バイト数H
002050 ED49 DD7E0C          19      LD  A,(IX+$0C)  ;フロッピーディスクのシリンダ数(DPB_0C_MAXCYL)
002053 ED4C CD1FEC          17      CALL    PUTDAT
                                
002056 ED4F 3E0D             7      LD  A,0DH       ;エグゼキュート
002058 ED51 CD19EC          17      CALL    PUTCOM
00205B ED54 3E7D             7      LD  A,RESULTEX/256
00205D ED56 CD1FEC          17      CALL    PUTDAT
002060 ED59 3EE8             7      LD  A,RESULTEX%256
002062 ED5B CD1FEC          17      CALL    PUTDAT
                                
002065 ED5E CD44EC          17      CALL    GETDAT
002068 ED61 4F               4      LD  C,A
002069 ED62 FE01             7      CP  1
00206B ED64 D8              11      RET C
                                
00206C ED65 78               4      LD  A,B
00206D ED66 B7               4      OR  A
00206E ED67 C2CFEC          10      JP  NZ,FDWT
002071 ED6A C9              10      RET
                                
       ED6B                     FDRD:
002072 ED6B 3E0D             7      LD  A,0DH       ;エグゼキュート
002074 ED6D CD19EC          17      CALL    PUTCOM
002077 ED70 3E7C             7      LD  A,READDISKEX/256
002079 ED72 CD1FEC          17      CALL    PUTDAT
00207C ED75 AF               4      XOR A
00207D ED76 CD1FEC          17      CALL    PUTDAT
002080 ED79 DD7E13          19      LD  A,(IX+013H) ;デバイスドライバ内におけるユニット番号(DPB_13_UNITNO)
002083 ED7C CD1FEC          17      CALL    PUTDAT
002086 ED7F DD7E0D          19      LD  A,(IX+00DH) ;フロッピーディスクの1トラックのセクタ数(DPB_0D_MAXSEC)
002089 ED82 CD1FEC          17      CALL    PUTDAT
00208C ED85 E5              11      PUSH    HL
00208D ED86 D5              11      PUSH    DE
00208E ED87 CDB7EC          17      CALL    CALC_SECTOR
002091 ED8A 7B               4      LD  A,E     ;セクタ
002092 ED8B CD1FEC          17      CALL    PUTDAT
002095 ED8E 7A               4      LD  A,D     ;トラック
002096 ED8F CD1FEC          17      CALL    PUTDAT
002099 ED92 DD7E0D          19      LD  A,(IX+00DH) ;フロッピーディスクの1トラックのセクタ数(DPB_0D_MAXSEC)
00209C ED95 93               4      SUB E
00209D ED96 3C               4      INC A
00209E ED97 67               4      LD  H,A
00209F ED98 D1              10      POP DE
0020A0 ED99 3EFF             7  FDMODE: LD  A,0FFH      ;フロッピーディスクのモード(DPB_0A_FDMODE)
0020A2 ED9B CD1FEC          17      CALL    PUTDAT
0020A5 ED9E 3A98E6          13      LD  A,(SECSZ+2) ;1セクタのサイズの上位1バイト
0020A8 EDA1 CD1FEC          17      CALL    PUTDAT
0020AB EDA4 4F               4      LD  C,A
0020AC EDA5 AF               4      XOR A
       EDA6                     FDRD2:
0020AD EDA6 81               4      ADD A,C
0020AE EDA7 13               6      INC DE
0020AF EDA8 05               4      DEC B
0020B0 EDA9 2807            12      JR  Z,FDRD3
0020B2 EDAB 25               4      DEC H       ;トラック、ヘッドを跨がない
0020B3 EDAC 2804            12      JR  Z,FDRD3
0020B5 EDAE FE3A             7      CP  03AH        ;バッファとして04000H-07BFFHまで使える
0020B7 EDB0 38F4            12      JR  C,FDRD2
       EDB2                     FDRD3:
0020B9 EDB2 E1              10      POP HL
0020BA EDB3 4F               4      LD  C,A
0020BB EDB4 CD1FEC          17      CALL    PUTDAT      ;バイト数H
0020BE EDB7 DD7E0C          19      LD  A,(IX+$0C)  ;フロッピーディスクのシリンダ数(DPB_0C_MAXCYL)
0020C1 EDBA CD1FEC          17      CALL    PUTDAT
                                
0020C4 EDBD 3E0D             7      LD  A,0DH       ;エグゼキュート
0020C6 EDBF CD19EC          17      CALL    PUTCOM
0020C9 EDC2 3E7D             7      LD  A,RESULTEX/256
0020CB EDC4 CD1FEC          17      CALL    PUTDAT
0020CE EDC7 3EE8             7      LD  A,RESULTEX%256
0020D0 EDC9 CD1FEC          17      CALL    PUTDAT
                                
0020D3 EDCC CD44EC          17      CALL    GETDAT
0020D6 EDCF 4F               4      LD  C,A
0020D7 EDD0 FE01             7      CP  1
0020D9 EDD2 D8              11      RET C
                                
0020DA EDD3 3E15             7      LD  A,15H       ;高速センドメモリ
0020DC EDD5 CD19EC          17      CALL    PUTCOM
0020DF EDD8 3E40             7      LD  A,DSS_DATA/256  ;開始アドレスH
0020E1 EDDA CD1FEC          17      CALL    PUTDAT
0020E4 EDDD AF               4      XOR A       ;開始アドレスL
0020E5 EDDE CD1FEC          17      CALL    PUTDAT
0020E8 EDE1 79               4      LD  A,C     ;バイト数H
0020E9 EDE2 CD1FEC          17      CALL    PUTDAT
0020EC EDE5 AF               4      XOR A       ;バイト数L
0020ED EDE6 CD1FEC          17      CALL    PUTDAT
0020F0 EDE9 C5              11      PUSH    BC
0020F1 EDEA 41               4      LD  B,C
0020F2 EDEB 0E00             7      LD  C,0
0020F4 EDED CD8FEC          17      CALL    FGETDAT
0020F7 EDF0 C1              10      POP BC
0020F8 EDF1 78               4      LD  A,B
0020F9 EDF2 B7               4      OR  A
0020FA EDF3 C26BED          10      JP  NZ,FDRD
0020FD EDF6 C9              10      RET
                                
       EF6A                     FSPAT   EQU BEEPD+9
                                
[EOF:88DISK.ASM:UTF_8]
                                    INCLUDE "88INTVEC.ASM"
                                
                                ;   LSX-Dodgers TABLE 割り込みベクタとキーのテーブル(Shift/Ctrl)
                                
       EDF7                     AT_TABLE:
0020FE EDF7                         DS  INTAD-AT_TABLE
                                
                                ;
                                ;   割り込みベクタ:アドレス下位1バイトが0になるように
                                ;
002107 EE00 67D9                I232C:  DW  INTE88
002109 EE02 3AD9                IVRTC:  DW  INTVRTC
00210B EE04 67D9                I1D600: DW  INTE88
00210D EE06 67D9                    DW  INTE88
00210F EE08 67D9                    DW  INTE88
002111 EE0A                     IFM:    DS  030H-10
       EE30                     EXTSP:
                                
       EE30                     SHIFT_TABLE:
002137 EE30 3031323334353637        DB  '0','1','2','3','4','5','6','7' ;0
00213F EE38 38392A2B3D2E2C0D        DB  '8','9','*','+','=','.',',',0DH ;1
002147 EE40 4041424344454647        DB  '@','A','B','C','D','E','F','G' ;2
00214F EE48 48494A4B4C4D4E4F        DB  'H','I','J','K','L','M','N','O' ;3
002157 EE50 5051525354555657        DB  'P','Q','R','S','T','U','V','W' ;4
00215F EE58 58595A7B7C7D7E3D        DB  'X','Y','Z','{','|','}','~','=' ;5
002167 EE60 3021222324252627        DB  '0','!','"','#','$','%','&',27H ;6
00216F EE68 28292A2B3C3E3F5F        DB  '(',')','*','+','<','>','?','_' ;7
002177 EE70 0B1E1C0800000000        DB  0BH,1EH,1CH,08H,00H,00H,00H,00H ;8
00217F EE78 030000000000201B        DB  03H,00H,00H,00H,00H,00H,' ',1BH ;9
002187 EE80 091F1D00002D2F00        DB  09H,1FH,1DH,00H,00H,'-','/',00H ;A
00218F EE88 0000000000000000        DB  00H,00H,00H,00H,00H,00H,00H,00H ;B
002197 EE90 0000000000081208        DB  00H,00H,00H,00H,00H,08H,12H,08H ;C
                                
       EE98                     CTRL_TABLE:
00219F EE98 3031323334353637        DB  '0','1','2','3','4','5','6','7' ;0
0021A7 EEA0 38392A2B3D2E2C0D        DB  '8','9','*','+','=','.',',',0DH ;1
0021AF EEA8 4001020304050607        DB  '@',01H,02H,03H,04H,05H,06H,07H ;2
0021B7 EEB0 08090A0B0C0D0E0F        DB  08H,09H,0AH,0BH,0CH,0DH,0EH,0FH ;3
0021BF EEB8 1011121314151617        DB  10H,11H,12H,13H,14H,15H,16H,17H ;4
0021C7 EEC0 18191A5B5C5D5E2D        DB  18H,19H,1AH,'[',5CH,']','^','-' ;5
0021CF EEC8 3031323334353637        DB  '0','1','2','3','4','5','6','7' ;6
0021D7 EED0 38393A3B2C2E2F5F        DB  '8','9',':',';',',','.','/','_' ;7
0021DF EED8 0C1E1C0800000000        DB  0CH,1EH,1CH,08H,00H,00H,00H,00H ;8
0021E7 EEE0 030000000000201B        DB  03H,00H,00H,00H,00H,00H,' ',1BH ;9
0021EF EEE8 091F1D00002D2F00        DB  09H,1FH,1DH,00H,00H,'-','/',00H ;A
0021F7 EEF0 0000000000000000        DB  00H,00H,00H,00H,00H,00H,00H,00H ;B
0021FF EEF8 0000000000081208        DB  00H,00H,00H,00H,00H,08H,12H,08H ;C
[EOF:88INTVEC.ASM:SHIFT_JIS]
                                    INCLUDE "LDWORK.ASM"
                                
                                ;   LSX-Dodgers WORK0
                                ;
                                ;   CP/M互換BIOS
                                ;   BOOT:アドレス下位1バイトが0になるように
       EF00                     AT_WORK:
002207 EF00                         DS  WORKAD-AT_WORK
                                
       EF00                     CPM_BOOT:
002207 EF00 C30000          10      JP  0
       EF03                     _SYS00:     ;(BDOS)プログラム終了
       EF03                     CPM_WBOOT:
00220A EF03 C309D1          10      JP  WBOOT1
       EF06                     CPM_CONST:
00220D EF06 C30CDA          10      JP  CONSTX
       EF09                     _SYS07:     ;(BDOS)コンソール直接入力
       EF09                     CPM_CONIN:
002210 EF09 C3C4D9          10      JP  FLGET
       EF0C                     CPM_CONOUT:
002213 EF0C C346DC          10      JP  CONOUT1
                                
       EF0F                     DECBF:
002216 EF0F                         DS  5
00221B EF14 00                  FDRV    DB  0
00221C EF15                     FNAME   DS  36
002240 EF39                     SFILE:  DS  33      ;DRV FILENAME
002261 EF5A                     HLBUF:  DS  3       ;Random record buffer
                                
002264 EF5D 0000                LEFTX:  DW  0
002266 EF5F 0000                DTAX:   DW  0
                                
       EF61                     ZERO:
       EF61                     BEEPD:
002268 EF61 008E01000B000C10        DB  0,08EH,1,0,00BH,0,00CH,010H
002270 EF69 073E08100D00FF          DB  007H,03EH,008H,010H,00DH,0,0FFH
       EF62                     RTC_YY  EQU BEEPD+1
       EF63                     RTC_MW  EQU BEEPD+2
       EF64                     RTC_DD  EQU BEEPD+3
       EF65                     RTC_TT  EQU BEEPD+4
       EF66                     RTC_MM  EQU BEEPD+5
       EF67                     RTC_SS  EQU BEEPD+6
                                
002277 EF70 00                  CHECK:  DB  0
                                
002278 EF71 4F4B24              OK: DB  "OK$"
00227B EF74                         DS  5
002280 EF79 4572726F722124      COMERM: DB  "Error!$"
                                ;   システムワークエリア
                                ;   _CYL0:アドレス下位1バイトが080Hになるように
002287 EF80 FF                  _CYL0:  DB  0FFH    ;Cylinder
002288 EF81 FF                  _CYL1:  DB  0FFH    ;Cylinder
002289 EF82 FF                  _CYL2:  DB  0FFH    ;Cylinder
00228A EF83 FF                  _CYL3:  DB  0FFH    ;Cylinder
00228B EF84 00                  _DRIVE: DB  0   ;unit number
00228C EF85 00                  _SEEKSP:DB  0   ;Seek speed
00228D EF86 FF                  _ISEEK: DB  0FFH    ;
00228E EF87 00                  _DVSW:  DB  0
00228F EF88 00                  _DRV:   DB  0
002290 EF89 FF                  _DSK:   DB  0FFH
002291 EF8A 8000                _DTA:   DW  00080H
002293 EF8C 0000                _CTC:   DW  0
002295 EF8E 0000                _TXADR: DW  0
002297 EF90 0000                _KEYPS: DW  0
002299 EF92 00FF                _KEYD:  DW  0FF00H  ;キーデータ
00229B EF94 0010                _KEYSP: DB  KEYSP_L,KEYSP_H ;オートリピートの速度
00229D EF96 00                  _COLORF:DB  COLORF  ;色
00229E EF97 18                  _LINE:  DB  LINE
                                
00229F EF98 0000                _FCB:   DW  0   ;SEARCH FILES
0022A1 EF9A 0000                _FBPS:  DW  0   ;    //
0022A3 EF9C 0000                _FBAD:  DW  0   ;    //
0022A5 EF9E 00                  _FBCNT: DB  0   ;    //
0022A6 EF9F 00                  _FILEN: DB  0   ;    //
0022A7 EFA0 00                  _DIRF:  DB  0   ;bit7:ディレクトリ bit0-6:セクタインデックス
0022A8 EFA1                         DS  1
0022A9 EFA2 00                  _WTFATF:DB  0   ;FATバッファの更新フラグ
0022AA EFA3                         DS  1
0022AB EFA4 00                  _WTDBF: DB  0   ;データバッファの更新フラグ
0022AC EFA5 FF                  _DBDRV: DB  0FFH    ;データバッファにあるデータを読み込んだドライブ
0022AD EFA6 0000                _DBSEC: DW  0   ;データバッファにあるデータを読み込んだセクタ番号
0022AF EFA8 0000                _DPB:   DW  0
       EFAA                     _FATDRV:
0022B1 EFAA FF                      DB  0FFH    ;FATバッファに読み込んでいるドライブ
0022B2 EFAB 00                  _FATIX: DB  0   ;FATバッファに読み込んでいるインデックス
       EFAC                     _FAKEFREE:
0022B3 EFAC 0000                    DW  0   ;偽の残量（FATサイズが大きくなると重くなるのでその対策）
                                
0022B5 EFAE                         DS  2
                                
       EFB0                     CRTCD:
0022B7 EFB0 6F                      DB  06FH
       EFB1                     _WIDTH:
0022B8 EFB1 50                      DB  WIDTH
       EFB2                     TVRAMTOP:
0022B9 EFB2 5938                    DB  059H,038H
0022BB EFB4 1F02                    DB  01FH,002H
       EFB6                     _LINE2:
0022BD EFB6 19                      DB  019H
       EFB7                     WKE4:
0022BE EFB7 1C                      DB  01CH
       EFB8                     WKE6:
0022BF EFB8 00                      DB  000H
       EFB9                     WK40:
0022C0 EFB9 07                      DB  007H
       EFBA                     _PAGE_MINUS:
0022C1 EFBA 80F8                    DW  0-WIDTH*LINE
       EFBC                     _WIDTH_MINUS:
0022C3 EFBC B0FF                    DW  0-WIDTH
       EFBE                     WK30:
0022C5 EFBE 0C                      DB  00CH
       EFBF                     WK31:
       EFBF                     WK1FD0:
0022C6 EFBF 20                      DB  020H
                                
0022C7 EFC0 0000                CTC0:   DW  INTCTCE
0022C9 EFC2 0000                CTC1:   DW  INTCTCE
0022CB EFC4 0000                CTC2:   DW  INTCTC2
0022CD EFC6 0000                CTC3:   DW  INTCTCE
0022CF EFC8 0000                INTVEC: DW  INT
                                
                                ;   LSX-Dodgers 独自BIOS
                                
0022D1 EFCA C37FDD          10  _INKEY: JP  INKEY
0022D4 EFCD C342DB          10  _PRINT: JP  PRINT
0022D7 EFD0 C3D6DD          10  _SCRN:  JP  SCRN
0022DA EFD3 C321DD          10  _POS:   JP  POS
0022DD EFD6 C38ADB          10  _LOC:   JP  LOC
       EFD9                     _CHGDRV:
0022E0 EFD9 C315EB          10      JP  CHGDRV
       EFDC                     _GETDPB:
0022E3 EFDC C3E0EB          10      JP  GETDPB
       EFDF                     _FFLUSH:
0022E6 EFDF C3FEEB          10      JP  FFLUSH
       EFE2                     _RDFATX:
0022E9 EFE2 C3EEE7          10      JP  RDFATX
0022EC EFE5 C316E9          10  _RDFAT: JP  RDFAT
0022EF EFE8 C3CDEC          10  _WTTRK: JP  WTTRK
0022F2 EFEB C36BED          10  _FDRD:  JP  FDRD
0022F5 EFEE C3CFEC          10  _FDWT:  JP  FDWT
       EFF1                     _BPB2DPB:
0022F8 EFF1 C3A3E9          10      JP  BPB2DPB
       EFF4                     _BREAK:
0022FB EFF4 C3ACD2          10      JP  END_BATCH
       EFF7                     _GNCL:
0022FE EFF7 C390E8          10  GNCPAT: JP  GNCL        ; self-modifying code
       EFFA                     _SNCL:
002301 EFFA C3B3E8          10  SNCPAT: JP  SNCL        ; self-modifying code
002304 EFFD C366D1          10  _COMANL:JP  COMANL
                                
       F000                     _WE:
[EOF:LDWORK.ASM:SHIFT_JIS]
                                    INCLUDE "LDCALL.ASM"
                                
                                ;   LSX-Dodgers システムコール(BDOS)
                                ;
                                ;   LSX-Dodgers SYSTEM CALL
                                ;   STABLE:アドレス下位1バイトが0になるように
                                
       F000                     STABLE:
                                ;0
002307 F000 03EF97D9A3D923E0        DW  _SYS00,_SYS01,_SYS02,_SYS03
00230F F008 99D699D6A8D909EF        DW  _SYS04,_SYS05,_SYS06,_SYS07
002317 F010 B0D99BD6D8D904DA        DW  _SYS08,_SYS09,_SYS0A,_SYS0B
00231F F018 B0D6B5D6C4D6D5D6        DW  _SYS0C,_SYS0D,_SYS0E,_SYS0F
                                ;1
002327 F020 29D770D7B9D7EFD7        DW  _SYS10,_SYS11,_SYS12,_SYS13
00232F F028 F7D70DD822D81AD8        DW  _SYS14,_SYS15,_SYS16,_SYS17
002337 F030 69D86ED873D879D8        DW  _SYS18,_SYS19,_SYS1A,_SYS1B
00233F F038 99D69FD899D6A3D8        DW  _SYS1C,_SYS1D,_SYS1E,_SYS1F
                                ;2
002347 F040 99D659D861D8AAD8        DW  _SYS20,_SYS21,_SYS22,_SYS23
00234F F048 D0D899D6ABE490E5        DW  _SYS24,_ERROR,_SYS26,_SYS27
002357 F050 61D8D9D81ADA23E0        DW  _SYS28,_SYS5C,_SYS2A,_SYS2B
00235F F058 41DA23E099D6FCD8        DW  _SYS2C,_SYS2D,_SYS2E,_SYS2F
                                ;3
002367 F060 F6D899D699D699D6        DW  _SYS30,_ERROR,_ERROR,_ERROR
00236F F068 99D699D699D699D6        DW  _ERROR,_ERROR,_ERROR,_ERROR
002377 F070 99D623E023E01DD9        DW  _ERROR,_SYS39,_SYS3A,_SYS5A
                                ;DOS2
00237F F078 7CD6                    DW  _DOS2
                                
002381 F07A                         DS  2
002383 F07C 00F3                _FATBF: DW  FATBF
002385 F07E 00FB                _DTBUF: DW  DTBUF
                                
                                ;   コントロールコードテーブル
                                ;   CTRLTB:アドレス下位1バイトが080Hになるように
                                
       F080                     CTRLTB:
002387 F080 8DDB8DDBC4DBCCDC        DW  CTRL00,CTRL00,CTRL02,CTRL03 ;  A,B,C
00238F F088 C6DCEFDB9FDC6BDC        DW  CTRL04,CTRL05,CTRL06,CTRL07 ;D,E,F,G
002397 F090 94DBB9DBCFDC1BDC        DW  CTRL08,CTRL09,CTRL0A,CTRL0B ;H,I,J,K
00239F F098 9CDC0EDCD6DC8DDB        DW  CTRL0C,CTRL0D,CTRL0E,CTRL00 ;L,M,N,O
0023A7 F0A0 8DDB8DDB13DC8DDB        DW  CTRL00,CTRL00,CTRL12,CTRL00 ;P,Q,R,S
0023AF F0A8 8DDB8DDB8DDB8DDB        DW  CTRL00,CTRL00,CTRL00,CTRL00 ;T,U,V,W
0023B7 F0B0 8DDB8DDB9CDC22DC        DW  CTRL00,CTRL00,CTRL0C,CTRL1B ;X,Y,Z,ESC
0023BF F0B8 76DB9BDBB0DBCFDC        DW  CTRL1C,CTRL1D,CTRL1E,CTRL1F ;→,←,↑,↓
                                
0023C7 F0C0 0200                M2D:    DW  2
0023C9 F0C2 FD02                    DB  0FDH,2
0023CB F0C4 6401                    DW  356
0023CD F0C6 FF0728090182            DB  0FFH,7,40,9,1,082H
0023D3 F0CC 0500A7000800            DW  5,0A7H,8
                                
0023D9 F0D2 0200                M2HD:   DW  2
0023DB F0D4 FE01                    DB  0FEH,1
0023DD F0D6 C704                    DW  1223
0023DF F0D8 FE064D080184            DB  0FEH,6,77,8,1,084H
0023E5 F0DE 0500A7000900            DW  5,0A7H,9
                                
0023EB F0E4                         DS  6
                                
0023F1 F0EA 1617                SDDATA: DB  22,23       ;(FCB)ファイルを最後に変更した時刻
0023F3 F0EC 1415                    DB  20,21       ;(FCB)ファイルを最後に変更した日付
0023F5 F0EE 1A1B                    DB  26,27       ;(FCB)ファイルの先頭クラスタ
0023F7 F0F0 10111213                DB  16,17,18,19 ;(FCB)ファイルのサイズ(バイト単位)
       F0F4                     SDDATAE:
                                
0023FB F0F4                     SCDIR:  DS  2       ;+14 +15
0023FD F0F6                     SFBPS:  DS  2       ;FBPS
0023FF F0F8                     SFNDF:  DS  2       ;FILEN DIRF
                                
002401 F0FA 0000                _FATPS: DW  0
002403 F0FC 0000                _DIRPS: DW  0
002405 F0FE 0000                _CLPS:  DW  0
                                
       F100                     _PE:
[EOF:LDCALL.ASM:SHIFT_JIS]
                                    INCLUDE "LDCCPWK.ASM"
                                
                                ;   LSX-Dodgers CCP WORK
                                
       0040                     PATHX   EQU 64
002407 F100                     PATHD:  DS  PATHX
002447 F140 00                  PATHE:  DB  0
                                
       F141                     DTA_CCP:
002448 F141                         DS  37
                                
       F166                     FCB_BAT:
00246D F166                         DS  37
                                
                                
002492 F18B 2062797465732066    FREE:   DB  " bytes free",9,'$'
            7265650924          
[EOF:LDCCPWK.ASM:UTF_8]
                                    INCLUDE "88TABLE.ASM"
                                
                                ;   LSX-Dodgers TABLE キーのテーブル
                                
       F198                     KEY_TABLE:
00249F F198 3031323334353637        DB  '0','1','2','3','4','5','6','7' ;0
0024A7 F1A0 38392A2B3D2E2C0D        DB  '8','9','*','+','=','.',',',0DH ;1
0024AF F1A8 4061626364656667        DB  '@','a','b','c','d','e','f','g' ;2
0024B7 F1B0 68696A6B6C6D6E6F        DB  'h','i','j','k','l','m','n','o' ;3
0024BF F1B8 7071727374757677        DB  'p','q','r','s','t','u','v','w' ;4
0024C7 F1C0 78797A5B5C5D5E2D        DB  'x','y','z','[',5CH,']','^','-' ;5
0024CF F1C8 3031323334353637        DB  '0','1','2','3','4','5','6','7' ;6
0024D7 F1D0 38393A3B2C2E2F5C        DB  '8','9',':',';',',','.','/',5CH ;7
0024DF F1D8 0C1E1C0800000000        DB  0CH,1EH,1CH,08H,00H,00H,00H,00H ;8
0024E7 F1E0 030000000000201B        DB  03H,00H,00H,00H,00H,00H,' ',1BH ;9
0024EF F1E8 091F1D00002D2F00        DB  09H,1FH,1DH,00H,00H,'-','/',00H ;A
0024F7 F1F0 0000000000000000        DB  00H,00H,00H,00H,00H,00H,00H,00H ;B
0024FF F1F8 0000000000081208        DB  00H,00H,00H,00H,00H,08H,12H,08H ;C
[EOF:88TABLE.ASM:SHIFT_JIS]
                                    INCLUDE "88DPB.ASM"
                                
                                ;   LSX-Dodgers DPB
                                ;   PC-8801mkIISR
                                
       F200                     DEVICE:
                                
                                ;   A:
                                
002507 F200 0200                    DW  2   ;DPB_00_FATLN
002509 F202 EBEF                    DW  _FDRD   ;DPB_02_DRD
00250B F204 EEEF                    DW  _FDWT   ;DPB_04_DWT
00250D F206 FD                      DB  0FDH    ;DPB_06_FATID
00250E F207 02                      DB  2   ;DPB_07_SECPCL
00250F F208 6401                    DW  356 ;DPB_08_MAXCL
002511 F20A FF                      DB  0FFH    ;DPB_0A_FDMODE  0FFH=2D / 0FEH=2HD
002512 F20B 07                      DB  7   ;DPB_0B_DIRSCNT
002513 F20C 28                      DB  40  ;DPB_0C_MAXCYL
002514 F20D 09                      DB  9   ;DPB_0D_MAXSEC  Number of sectors
002515 F20E 01                      DB  1   ;DPB_0E_FATPS
002516 F20F 82                      DB  082H    ;DPB_0F_BPS
002517 F210 0500                    DW  5   ;DPB_10_DIRPS
002519 F212 A7                      DB  0A7H    ;DPB_12_DEVICE  Device Number
00251A F213 00                      DB  0   ;DPB_13_UNITNO
00251B F214 0800                    DW  8   ;DPB_14_ADDCL16
00251D F216 0000                    DW  0   ;DPB_16
00251F F218 0000                    DW  0   ;DPB_18
002521 F21A 0000                    DW  0   ;DPB_1A_SDIR
002523 F21C 46444430                DB  "FDD0"  ;DPB_1C_NAME
                                
                                ;   B:
                                
002527 F220 0200                    DW  2   ;DPB_00_FATLN
002529 F222 EBEF                    DW  _FDRD   ;DPB_02_DRD
00252B F224 EEEF                    DW  _FDWT   ;DPB_04_DWT
00252D F226 FD                      DB  0FDH    ;DPB_06_FATID
00252E F227 02                      DB  2   ;DPB_07_SECPCL
00252F F228 6401                    DW  356 ;DPB_08_MAXCL
002531 F22A FF                      DB  0FFH    ;DPB_0A_FDMODE  0FFH=2D / 0FEH=2HD
002532 F22B 07                      DB  7   ;DPB_0B_DIRSCNT
002533 F22C 28                      DB  40  ;DPB_0C_MAXCYL
002534 F22D 09                      DB  9   ;DPB_0D_MAXSEC  Number of sectors
002535 F22E 01                      DB  1   ;DPB_0E_FATPS
002536 F22F 82                      DB  082H    ;DPB_0F_BPS
002537 F230 0500                    DW  5   ;DPB_10_DIRPS
002539 F232 A7                      DB  0A7H    ;DPB_12_DEVICE  Device Number
00253A F233 01                      DB  1   ;DPB_13_UNITNO
00253B F234 0800                    DW  8   ;DPB_14_ADDCL16
00253D F236 0000                    DW  0   ;DPB_16
00253F F238 0000                    DW  0   ;DPB_18
002541 F23A 0000                    DW  0   ;DPB_1A_SDIR
002543 F23C 46444431                DB  "FDD1"  ;DPB_1C_NAME
                                
                                ;   C:
                                
002547 F240                         DS  32
                                
                                ;   D:
                                
002567 F260                         DS  32
                                
                                ;   E:
                                
002587 F280                         DS  32
                                
                                ;   F:
                                
0025A7 F2A0 0000                BANKFL: DW  0   ;DPB_00_FATLN
0025A9 F2A2 27D6                    DW  BDRD    ;DPB_02_DRD
0025AB F2A4 23D6                    DW  BDWT    ;DPB_04_DWT
0025AD F2A6 F9                      DB  0F9H    ;DPB_06_FATID
0025AE F2A7 02                      DB  2   ;DPB_07_SECPCL
0025AF F2A8 0000                BANKCL: DW  0   ;DPB_08_MAXCL
0025B1 F2AA 00                      DB  0   ;DPB_0A_FDMODE
0025B2 F2AB 08                      DB  8   ;DPB_0B_DIRSCNT
0025B3 F2AC 00                      DB  0   ;DPB_0C_MAXCYL
0025B4 F2AD 01                      DB  1   ;DPB_0D_MAXSEC
0025B5 F2AE 00                      DB  0   ;DPB_0E_FATPS
0025B6 F2AF 02                      DB  2   ;DPB_0F_BPS
0025B7 F2B0 0200                    DW  2   ;DPB_10_DIRPS
0025B9 F2B2 0B                  BANKDV: DB  00BH    ;DPB_12_DEVICE
0025BA F2B3 00                      DB  0   ;DPB_13_UNITNO
0025BB F2B4 0600                    DW  6   ;DPB_14_ADDCL16
0025BD F2B6 0000                    DW  0   ;DPB_16
0025BF F2B8 0000                    DW  0   ;DPB_18
0025C1 F2BA 0000                    DW  0   ;DPB_1A_SDIR
0025C3 F2BC 454D454D                DB  "EMEM"  ;DPB_1C_NAME
                                
                                ;   G:
                                
0025C7 F2C0                         DS  32
                                
                                ;   H:
0025E7 F2E0                         DS  32-8
0025FF F2F8 00                      DB  0
[EOF:88DPB.ASM:UTF_8]
                                
       F2F9                     LAST_ADR:
                                
                                    END
[EOF:88.ASM:UTF_8]
