                                ;*** AILZ80ASM *** Z-80 Assembler, version 1.0.13.0, LST:Full:4
                                ;   LSX-Dodgers for PC-8801mkIISR
                                ;   Programmed by
                                ;   Gaku (Lovers/Tablacus)
                                
                                    INCLUDE "88DEF.ASM"
                                
                                ;   LSX-Dodgers DEF
                                ;   PC-8001mkIISR
                                
       0002                     MAC EQU 2   ;PC-8001mkIISR
       0001                     DEV EQU 1
                                
       011D                     VER_6F  EQU 0011DH
                                
       D100                     RUN EQU 0D100H
       D0F9                     OFFSET  EQU RUN-7
                                
       D906                     BDOS    EQU 0D906H
       ED00                     INTAD   EQU 0ED00H
       EE00                     WORKAD  EQU 0EE00H
       F600                     DEVD    EQU 0F600H
       F700                     FATBF   EQU 0F700H
       FD00                     DTBUF   EQU 0FD00H
       FF00                     KEYBF   EQU 0FF00H
       FF20                     KBUF    EQU 0FF20H
       FFBB                     SUBSYS  EQU EXTBIO-5*3
       FFD9                     TRAP38  EQU 0FFD9H
       0050                     WIDTH   EQU 80
       0018                     LINE    EQU 24
       0000                     COLORF  EQU 0
       0010                     KEYSP_H EQU 16
       0000                     KEYSP_L EQU 0
       0008                     COMS    EQU 8
       0002                     MAX_SEC_SZ_H    EQU 2       ;1セクタ1024バイトのサポート(2:off 4:on)
       0100                     BUFFER  EQU 00100H
       D9FD                     S27BUF_COM  EQU S27BUF
                                
                                ; ディスクサブシステム
       002A                     MAIN        EQU 0002AH
                                
       4000                     DSS_DATA    EQU 04000H
                                
       7C00                     DSS     EQU 07C00H
[EOF:88DEF.ASM:SHIFT_JIS]
                                    INCLUDE "LDDEF.ASM"
                                
                                ;   LSX-Dodgers DEF
                                
       0001                     VER_1   EQU 1
       0006                     VER_2   EQU 6
       0001                     VER_3   EQU 1
       1D02                     MACW    EQU MAC + 01D00H    ;機種フラグとLD判別フラグ
       0102                     MACD    EQU MAC + DEV * 256 ;機種フラグとデバイスフラグ
       0161                     VER EQU VER_1 * 256 + VER_2 * 16 + VER_3
                                
       0004                     _DVSW   EQU 00004H
       0005                     SYSTEM  EQU 00005H
       000F                     JP_HL   EQU 0000FH
       005C                     FCB1    EQU 0005CH
       006C                     FCB2    EQU 0006CH
       005D                     FCB1FN  EQU FCB1+1
       006D                     FCB2FN  EQU FCB2+1
       0080                     DTA1    EQU 00080H
                                
       F323                     DISKVE  EQU 0F323H
       F325                     BREAKV  EQU 0F325H
       FFCA                     EXTBIO  EQU 0FFCAH
                                
       0000                     DPB_FATLN   EQU 00H
       0002                     DPB_DRD     EQU 02H
       0004                     DPB_DWT     EQU 04H
       0006                     DPB_FATID   EQU 06H
       0007                     DPB_SECPCL  EQU 07H
       0008                     DPB_MAXCL   EQU 08H
       000A                     DPB_FDMODE  EQU 0AH
       000B                     DPB_DIRSCNT EQU 0BH
       000C                     DPB_MAXCYL  EQU 0CH
       000D                     DPB_MAXSEC  EQU 0DH
       000E                     DPB_FATPS   EQU 0EH
       000F                     DPB_BPS     EQU 0FH
       0010                     DPB_DIRPS   EQU 10H
       0012                     DPB_DEVICE  EQU 12H
       0013                     DPB_UNITNO  EQU 13H
       0014                     DPB_ADDCL   EQU 14H
                                
       001A                     DPB_SDIR    EQU 1AH
       001C                     DPB_NAME    EQU 1CH
                                
[EOF:LDDEF.ASM:SHIFT_JIS]
                                
000000 D0F9                         ORG OFFSET
                                
                                ;   MSX BINARY HEADER
000000 D0F9 FE                      DB  0FEH
                                ;   MSX BINARY START ADDRESS
000001 D0FA 00D1                    DW  RUN
                                ;   MSX BINARY END ADDRESS
000003 D0FC F9F6                    DW  LAST_ADR
                                ;   MSX BINARY EXEC ADDRESS
000005 D0FE 07D1                    DW  START
                                
                                    INCLUDE "88INIT.ASM"
                                
                                ;   LSX-Dodgers INIT
                                ;   PC-8801mkIISR
                                
000007 D100 C307D1          10      JP  START
00000A D103 021D                    DW  MACW
00000C D105 6101                    DW  VER
                                
       D107                     START:
00000E D107 F3               4      DI
00000F D108 ED5E             8      IM  2
000011 D10A 3107D1          10      LD  SP,START
000014 D10D CD1BD1          17      CALL    INIT        ;NZならAUTOEXECを実行
000017 D110 210000          10      LD  HL,0
00001A D113 E5              11      PUSH    HL
00001B D114 C8              11      RET Z
00001C D115 11ACD2          10      LD  DE,AUTOD
00001F D118 C3FDEE          10      JP  _COMANL
                                
       D11B                     INIT:
000022 D11B DB32            11      IN  A,(032H)
000024 D11D E6EF             7      AND 0EFH        ;高速RAMアクセスモード/高速RAM
000026 D11F D332            11      OUT (032H),A
                                
000028 D121 21C8F3          10      LD  HL,0F3C8H   ;テキストをクリア
00002B D124 11E880          10      LD  DE,080E8H
00002E D127 0E20             7      LD  C,' '
000030 D129 3E19             7      LD  A,25
       D12B                     TVCL1:
000032 D12B 0650             7      LD  B,80
       D12D                     TVCL2:
000034 D12D 71               7      LD  (HL),C
000035 D12E 23               6      INC HL
000036 D12F 10FC            13      DJNZ    TVCL2
000038 D131 0614             7      LD  B,20
       D133                     TVCL3:
00003A D133 72               7      LD  (HL),D
00003B D134 2C               4      INC L
00003C D135 73               7      LD  (HL),E
00003D D136 23               6      INC HL
00003E D137 10FA            13      DJNZ    TVCL3
000040 D139 3D               4      DEC A
000041 D13A 20EF            12      JR  NZ,TVCL1
                                
000043 D13C 212AD3          10      LD  HL,AT_VRAM
000046 D13F 1100F0          10      LD  DE,0F000H
000049 D142 01F702          10      LD  BC,AT_VRAME-AT_VRAM
00004C D145 EDB0                    LDIR
                                
00004E D147 DB32            11      IN  A,(032H)
000050 D149 F610             7      OR  010H        ;高速RAMアクセスモード/メインRAM
000052 D14B D332            11      OUT (032H),A
       D14D                     INIT_CRTC:
000054 D14D 3E03             7      LD  A,3     ;80桁
000056 D14F D330            11      OUT (030H),A
000058 D151 32BEEE          13      LD  (WK30),A
                                
00005B D154 3E22             7      LD  A,022H      ;25行 64K RAM
00005D D156 D331            11      OUT (031H),A
00005F D158 32BFEE          13      LD  (WK31),A
                                
000062 D15B 3EFF             7      LD  A,0FFH
000064 D15D D3E4            11      OUT (0E4H),A    ;割り込みレベル設定
000066 D15F 32B7EE          13      LD  (WKE4),A
000069 D162 3E00             7      LD  A,0
00006B D164 D3E6            11      OUT (0E6H),A    ;割り込みマスク
                                
00006D D166 3E19             7      LD  A,019H
00006F D168 D340            11      OUT (040H),A    ;CRT I/F 同期ビットオン
000071 D16A 32B9EE          13      LD  (WK40),A
000074 D16D CD7EE2          17      CALL    VBLANK
                                
000077 D170 AF               4      XOR A
000078 D171 D351            11      OUT (051H),A    ;Reset CRTC
00007A D173 3EA0             7      LD  A,0A0H
00007C D175 D368            11      OUT (068H),A    ;DMAC: Mode Set(Reset)
00007E D177 21C8F3          10      LD  HL,0F3C8H
000081 D17A 22B2EE          16      LD  (TVRAMTOP),HL
000084 D17D 0E64             7      LD  C,064H
000086 D17F ED69            12      OUT (C),L       ;TVRAM LOW
000088 D181 ED61            12      OUT (C),H       ;TVRAM HIGH
00008A D183 21B78B          10      LD  HL,08000H+120*25-1
00008D D186 0C               4      INC C       ;65H
00008E D187 ED69            12      OUT (C),L
000090 D189 ED61            12      OUT (C),H
000092 D18B 3ECE             7      LD  A,080H+80-2
000094 D18D D350            11      OUT (050H),A
000096 D18F 3E98             7      LD  A,080H+25-1
000098 D191 D350            11      OUT (050H),A
00009A D193 DB40            11      IN  A,(040H)
00009C D195 CB4F             8      BIT 1,A
00009E D197 21DE67          10      LD  HL,067DEH
0000A1 D19A 2003            12      JR  NZ,RESO1
0000A3 D19C 21586F          10      LD  HL,06F58H
       D19F                     RESO1:
0000A6 D19F 0E50             7      LD  C,050H
0000A8 D1A1 ED61            12      OUT (C),H
0000AA D1A3 ED69            12      OUT (C),L
                                
0000AC D1A5 3E53             7      LD  A,053H
0000AE D1A7 D350            11      OUT (050H),A
                                
0000B0 D1A9 3E43             7      LD  A,043H
0000B2 D1AB D351            11      OUT (051H),A
                                
0000B4 D1AD 3EE4             7      LD  A,0E4H
0000B6 D1AF D368            11      OUT (068H),A
                                
0000B8 D1B1 3E20             7      LD  A,020H
0000BA D1B3 D351            11      OUT (051H),A
                                
0000BC D1B5 CD7EE2          17      CALL    VBLANK
       D1B8                     IVBL1:
0000BF D1B8 DB40            11      IN  A,(040H)
0000C1 D1BA CB6F             8      BIT 5,A
0000C3 D1BC 20FA            12      JR  NZ,IVBL1
                                
0000C5 D1BE 3E11             7      LD  A,011H
0000C7 D1C0 D340            11      OUT (040H),A    ;CRT I/F 同期ビットオフ
0000C9 D1C2 32B9EE          13      LD  (WK40),A
       D1C5                     BANK:
0000CC D1C5 01E300          10      LD  BC,000E3H   ;拡張RAM バンク選択
0000CF D1C8 21007F          10      LD  HL,07F00H
0000D2 D1CB 56               7      LD  D,(HL)
0000D3 D1CC F3               4      DI
0000D4 D1CD 3E01             7      LD  A,1     ;リード可
0000D6 D1CF D3E2            11      OUT (0E2H),A    ;拡張RAM リード/ライト制御
0000D8 D1D1 ED41            12      OUT (C),B       ;拡張RAM バンク選択
0000DA D1D3 3A0000          13      LD  A,(0)
0000DD D1D6 FEEB             7      CP  0EBH
0000DF D1D8 2005            12      JR  NZ,BANK1
0000E1 D1DA 3E2B             7      LD  A,02BH
0000E3 D1DC 32B2F6          13      LD  (BANKDV),A
       D1DF                     BANK1:
0000E6 D1DF 3E01             7      LD  A,1     ;リード可
0000E8 D1E1 D3E2            11      OUT (0E2H),A    ;拡張RAM リード/ライト制御
0000EA D1E3 ED41            12      OUT (C),B       ;拡張RAM バンク選択
0000EC D1E5 5E               7      LD  E,(HL)
0000ED D1E6 7B               4      LD  A,E
0000EE D1E7 C6A5             7      ADD A,0A5H
0000F0 D1E9 77               7      LD  (HL),A      ;メインメモリに書き込む
0000F1 D1EA BE               7      CP  (HL)
0000F2 D1EB 2811            12      JR  Z,BANK2     ;メインメモリが反映されているか？
0000F4 D1ED 3E11             7      LD  A,011H      ;ライト/リード可
0000F6 D1EF D3E2            11      OUT (0E2H),A    ;拡張RAM リード/ライト制御
0000F8 D1F1 7B               4      LD  A,E
0000F9 D1F2 C6A5             7      ADD A,0A5H
0000FB D1F4 77               7      LD  (HL),A
0000FC D1F5 BE               7      CP  (HL)
0000FD D1F6 73               7      LD  (HL),E      ;拡張RAM に元の値を戻す
0000FE D1F7 2005            12      JR  NZ,BANK2    ;拡張RAM に反映しているか？
000100 D1F9 04               4      INC B
000101 D1FA CB60             8      BIT 4,B
000103 D1FC 28E1            12      JR  Z,BANK1
       D1FE                     BANK2:
000105 D1FE AF               4      XOR A       ;ライト/リード不可
000106 D1FF D3E2            11      OUT (0E2H),A    ;拡張RAM リード/ライト制御
000108 D201 72               7      LD  (HL),D      ;メインメモリ に元の値を戻す
000109 D202 78               4      LD  A,B
00010A D203 B7               4      OR  A
00010B D204 2814            12      JR  Z,NOBANK
00010D D206 68               4      LD  L,B
00010E D207 2600             7      LD  H,0
000110 D209 29              11      ADD HL,HL   ;*2
000111 D20A 29              11      ADD HL,HL   ;*4
000112 D20B 29              11      ADD HL,HL   ;*8
000113 D20C 29              11      ADD HL,HL   ;*16
000114 D20D 29              11      ADD HL,HL   ;*32
000115 D20E 2B               6      DEC HL  ;-1
000116 D20F 2B               6      DEC HL  ;-2
000117 D210 2B               6      DEC HL  ;-3
000118 D211 22A8F6          16      LD  (BANKCL),HL
00011B D214 CD9CD2          17      CALL    CALC_FATLN
00011E D217 32A0F6          13      LD  (BANKFL),A
       D21A                     NOBANK:
                                                ;初期化
000121 D21A AF               4      XOR A       ;イニシャライズ
000122 D21B CDBBEA          17      CALL    PUTCOM
000125 D21E 3E16             7      LD  A,16H       ;高速レシーブメモリ
000127 D220 CDBBEA          17      CALL    PUTCOM
00012A D223 3E7C             7      LD  A,DSS/256   ;開始アドレスH
00012C D225 CDC1EA          17      CALL    PUTDAT
00012F D228 AF               4      XOR A       ;開始アドレスL
000130 D229 CDC1EA          17      CALL    PUTDAT
000133 D22C 015102          10      LD  BC,AT_DSSE-AT_DSS
000136 D22F CB41             8      BIT 0,C
000138 D231 2801            12      JR  Z,SUBPG1
00013A D233 03               6      INC BC      ;偶数にする
       D234                     SUBPG1:
00013B D234 78               4      LD  A,B     ;バイト数H
00013C D235 CDC1EA          17      CALL    PUTDAT
00013F D238 79               4      LD  A,C
000140 D239 CDC1EA          17      CALL    PUTDAT
000143 D23C 2121D6          10      LD  HL,AT_DSS
000146 D23F CD05EB          17      CALL    FPUTDAT
                                
000149 D242 210000          10      LD  HL,0
00014C D245 065C             7      LD  B,05CH
00014E D247 3E                      DB  03EH    ;LD A,??
00014F D248 FF              12      RST 38H
000150 D249 CDB6F0          17      CALL    FILL_MEMORY
000153 D24C 06A4             7      LD  B,0A4H
000155 D24E AF               4      XOR A
000156 D24F 320400          13      LD  (_DVSW),A
000159 D252 CDB6F0          17      CALL    FILL_MEMORY
                                
00015C D255 3EC3             7      LD  A,0C3H      ;JP
00015E D257 2103EE          10      LD  HL,CPM_WBOOT
000161 D25A 320000          13      LD  (00000H),A
000164 D25D 220100          16      LD  (00001H),HL ;IPL
                                
000167 D260 2106D9          10      LD  HL,BDOS
00016A D263 320500          13      LD  (00005H),A
00016D D266 220600          16      LD  (00006H),HL ;BDOS
                                
000170 D269 21D9FF          10      LD  HL,TRAP38   ;TRAP38
000173 D26C 323800          13      LD  (00038H),A
000176 D26F 223900          16      LD  (00039H),HL ;RST 038H
                                
000179 D272 3EEE             7      LD  A,CPM_BOOT/256
00017B D274 320B00          13      LD  (0000BH),A
                                
00017E D277 3E                      DB  03EH    ;LD A,??
00017F D278 E9               4      JP  (HL)
000180 D279 320F00          13      LD  (0000FH),A
                                
000183 D27C 21B8D2          10      LD  HL,INIMES
000186 D27F CDDFDD          17      CALL    MSX
       D282                     INIT1:
000189 D282 F3               4      DI
00018A D283 1100FF          10      LD  DE,0FF00H
00018D D286 06BB             7      LD  B,SUBSYS%256
00018F D288 CD3FDC          17      CALL    ZERO_MEMORY_DE
                                
000192 D28B 21E5D2          10      LD  HL,AT_SUBSYS
000195 D28E 11BBFF          10      LD  DE,SUBSYS
000198 D291 014500          10      LD  BC,AT_TRAPE-AT_SUBSYS
00019B D294 EDB0                    LDIR
                                
00019D D296 CD1FE2          17      CALL    CHKEY
0001A0 D299 FE03             7      CP  3
0001A2 D29B C9              10      RET
                                
       D29C                     CALC_FATLN: ;FAT12のクラスタ数から必要なFATサイズを求める(セクタサイズ512)
0001A3 D29C 5D               4      LD  E,L
0001A4 D29D 54               4      LD  D,H
0001A5 D29E 29              11      ADD HL,HL   ;*2
0001A6 D29F 19              11      ADD HL,DE   ;*3
0001A7 D2A0 CB3C             8      SRL H   ;/2
0001A9 D2A2 CB1D             8      RR  L   ;1クラスタ辺り1.5バイト必要
0001AB D2A4 11FF01          10      LD  DE,511  ;切り上げる
0001AE D2A7 19              11      ADD HL,DE
0001AF D2A8 7C               4      LD  A,H
0001B0 D2A9 CB3F             8      SRL A
0001B2 D2AB C9              10      RET
                                
0001B3 D2AC 4155544F45584543    AUTOD:  DB  "AUTOEXEC "
            20                  
0001BC D2B5 413A00              AUTODV: DB  "A:",0
                                
0001BF D2B8 0C4C53582D446F64    INIMES: DB  00CH,"LSX-Dodgers for PC-8801mkIISR v"
            6765727320666F72    
            2050432D38383031    
            6D6B494953522076    
0001DF D2D8 312E                    DB  030H + VER_1, '.'
0001E1 D2DA 3631                    DB  030H + VER_2 ,030H + VER_3
0001E3 D2DC 63                      DB  'c'
0001E4 D2DD 2047616B750D0A          DB  " Gaku",0DH,0AH
0001EB D2E4 00                      DB  0
                                
       D2E5                     AT_SUBSYS:
0001EC FFBB                         ORG SUBSYS,AT_SUBSYS-OFFSET
0001EC FFBB C3BBEA          10      JP  PUTCOM
0001EF FFBE C3C1EA          10      JP  PUTDAT
0001F2 FFC1 C3E6EA          10      JP  GETDAT
0001F5 FFC4 C305EB          10      JP  FPUTDAT
0001F8 FFC7 C330EB          10      JP  FGETDAT
                                ;EXTBIO
0001FB FFCA C9              10      RET
0001FC FFCB                         DS  14,0FFH
                                ;TRAP38:
00020A FFD9 210000          10      LD  HL,0
00020D FFDC E3              19      EX  (SP),HL
00020E FFDD 3E24             7      LD  A,'$'
000210 FFDF CDF8E2          17      CALL    MSG_A
000213 FFE2 2B               6      DEC HL
000214 FFE3 7C               4      LD  A,H
000215 FFE4 CDE8FF          17      CALL    PRHX
000218 FFE7 7D               4      LD  A,L
       FFE8                     PRHX:
000219 FFE8 F5              11      PUSH    AF
00021A FFE9 07               4      RLCA
00021B FFEA 07               4      RLCA
00021C FFEB 07               4      RLCA
00021D FFEC 07               4      RLCA
00021E FFED CDF1FF          17      CALL    PRHX2
000221 FFF0 F1              10      POP AF
       FFF1                     PRHX2:
000222 FFF1 E60F             7      AND 00FH
000224 FFF3 FE0A             7      CP  10
000226 FFF5 3F               4      CCF
000227 FFF6 CE30             7      ADC A,'0'
000229 FFF8 27               4      DAA
00022A FFF9 C3F8E2          10      JP  MSG_A
00022D FFFC                         DS  4
000231 D32A                         ORG $$+OFFSET,$$    ;$DEPHASE
       D32A                     AT_TRAPE:
[EOF:88INIT.ASM:SHIFT_JIS]
                                    INCLUDE "88VRAM.ASM"
                                
                                ;   LSX-Dodgers VRAM
                                ;   PC-8801mkIISR
                                
       D32A                     AT_VRAM:
000231 F000                         ORG 0F000H,AT_VRAM-OFFSET
       F000                     ESC1:
000231 F000 7B               4      LD  A,E
000232 F001 FE41             7      CP  'A'
000234 F003 CAC3F0          10      JP  Z,CTRL1E
000237 F006 FE42             7      CP  'B'
000239 F008 CA77F1          10      JP  Z,CTRL1F
00023C F00B FE43             7      CP  'C'
00023E F00D CA89F0          10      JP  Z,CTRL1C
000241 F010 FE44             7      CP  'D'
000243 F012 CAAEF0          10      JP  Z,CTRL1D
000246 F015 FE45             7      CP  'E'
000248 F017 2802            12      JR  Z,CT0CX
00024A F019 FE6A             7      CP  'j'
       F01B                     CT0CX:
00024C F01B CA4EF1          10      JP  Z,CTRL0C
00024F F01E FE48             7      CP  'H'
000251 F020 CA1AF1          10      JP  Z,CTRL0B
000254 F023 FE4A             7      CP  'J'
000256 F025 CA51F1          10      JP  Z,CTRL06
000259 F028 FE4B             7      CP  'K'
00025B F02A CAF8F0          10      JP  Z,CTRL05
00025E F02D FE4C             7      CP  'L'
000260 F02F CA7EF1          10      JP  Z,CTRL0E
000263 F032 FE54             7      CP  'T'
000265 F034 CAF8F0          10      JP  Z,CTRL05
000268 F037 FE78             7      CP  'x'
00026A F039 2804            12      JR  Z,ESC1X
00026C F03B FE79             7      CP  'y'
00026E F03D 2002            12      JR  NZ,ESC1Y
       F03F                     ESC1X:
000270 F03F 3601            10      LD  (HL),1
       F041                     ESC1Y:
000272 F041 FE3D             7      CP  '='
000274 F043 2804            12      JR  Z,ESC1W
000276 F045 FE59             7      CP  'Y'
000278 F047 2002            12      JR  NZ,ESC1Z
       F049                     ESC1W:
00027A F049 3602            10      LD  (HL),2
       F04B                     ESC1Z:
00027C F04B FE20             7      CP  020H
00027E F04D 3802            12      JR  C,ESC1C
000280 F04F 87               4      ADD A,A
000281 F050 D0              11      RET NC
       F051                     ESC1C:
000282 F051 E1              10      POP HL
000283 F052 C35CE1          10      JP  ANK
                                
       F055                     ESC:
000286 F055 2163E1          10      LD  HL,PRINTE5
000289 F058 E5              11      PUSH    HL
00028A F059 214EE1          10      LD  HL,ESCFLG
00028D F05C 3600            10      LD  (HL),0
00028F F05E 3D               4      DEC A
000290 F05F 289F            12      JR  Z,ESC1
000292 F061 3D               4      DEC A
000293 F062 2009            12      JR  NZ,ESC2
000295 F064 3603            10      LD  (HL),3
000297 F066 7B               4      LD  A,E
000298 F067 D620             7      SUB 020H
00029A F069 3270F0          13      LD  (ESCYP+1),A
00029D F06C C9              10      RET
       F06D                     ESC2:
00029E F06D 3D               4      DEC A
00029F F06E C0              11      RET NZ
0002A0 F06F 2600             7  ESCYP:  LD  H,0
0002A2 F071 7B               4      LD  A,E
0002A3 F072 D620             7      SUB 020H
0002A5 F074 6F               4      LD  L,A
0002A6 F075 C3D6EE          10      JP  _LOC
                                
       F078                     CTRL:
0002A9 F078 7B               4      LD  A,E
0002AA F079 87               4      ADD A,A
0002AB F07A F680             7      OR  080H
0002AD F07C 6F               4      LD  L,A
0002AE F07D 26EF             7      LD  H,CTRLTB/256
0002B0 F07F 7E               7      LD  A,(HL)
0002B1 F080 2C               4      INC L
0002B2 F081 66               7      LD  H,(HL)
0002B3 F082 6F               4      LD  L,A
0002B4 F083 CD62E0          17      CALL    JPHL
0002B7 F086 C363E1          10      JP  PRINTE5
                                
       F089                     CTRL1C:
0002BA F089 2A8EEE          16      LD  HL,(_TXADR)
0002BD F08C 2C               4      INC L
       F08D                     PRINTE3:
0002BE F08D 3AB1EE          13      LD  A,(_WIDTH)
0002C1 F090 3D               4      DEC A
0002C2 F091 BD               4      CP  L
0002C3 F092 3009            12      JR  NC,SET_TXADR_HL
0002C5 F094 2E00             7      LD  L,0
0002C7 F096 24               4      INC H
       F097                     PRINTE8:
0002C8 F097 3A97EE          13      LD  A,(_LINE)
0002CB F09A BC               4      CP  H
0002CC F09B 2804            12      JR  Z,PRINT2
       F09D                     LOC:
       F09D                     SET_TXADR_HL:
0002CE F09D 228EEE          16      LD  (_TXADR),HL
       F0A0                     CTRL00:
0002D1 F0A0 C9              10      RET
                                
       F0A1                     PRINT2:
0002D2 F0A1 CD84F1          17      CALL    SCR
0002D5 F0A4 25               4      DEC H
0002D6 F0A5 18F6            12      JR  SET_TXADR_HL
                                
       F0A7                     CTRL08:
0002D8 F0A7 3A59E1          13      LD  A,(INSFLG)
0002DB F0AA FECD             7      CP  0CDH        ;CALL ????
0002DD F0AC 2829            12      JR  Z,CTRL02
       F0AE                     CTRL1D:
0002DF F0AE 2A8EEE          16      LD  HL,(_TXADR)
0002E2 F0B1 7C               4      LD  A,H
0002E3 F0B2 B5               4      OR  L
0002E4 F0B3 C8              11      RET Z
0002E5 F0B4 7D               4      LD  A,L
0002E6 F0B5 B7               4      OR  A
0002E7 F0B6 2803            12      JR  Z,CTRL1DX1
0002E9 F0B8 2D               4      DEC L
0002EA F0B9 18E2            12      JR  SET_TXADR_HL
       F0BB                     CTRL1DX1:
0002EC F0BB 3AB1EE          13      LD  A,(_WIDTH)
0002EF F0BE 3D               4      DEC A
0002F0 F0BF 6F               4      LD  L,A
0002F1 F0C0 25               4      DEC H
0002F2 F0C1 18DA            12      JR  SET_TXADR_HL
       F0C3                     CTRL1E:
0002F4 F0C3 2A8EEE          16      LD  HL,(_TXADR)
0002F7 F0C6 7C               4      LD  A,H
0002F8 F0C7 B7               4      OR  A
0002F9 F0C8 C8              11      RET Z
0002FA F0C9 25               4      DEC H
0002FB F0CA 18D1            12      JR  SET_TXADR_HL
                                
       F0CC                     CTRL09:
0002FD F0CC 2A8EEE          16      LD  HL,(_TXADR)
000300 F0CF 7D               4      LD  A,L
000301 F0D0 E6F8             7      AND 0F8H
000303 F0D2 C608             7      ADD A,8
000305 F0D4 6F               4      LD  L,A
000306 F0D5 18B6            12      JR  PRINTE3
                                
       F0D7                     CTRL02:
000308 F0D7 3A8EEE          13      LD  A,(_TXADR)
00030B F0DA B7               4      OR  A
00030C F0DB 28D1            12      JR  Z,CTRL1D
00030E F0DD CDAEF0          17      CALL    CTRL1D
000311 F0E0 2A8EEE          16      LD  HL,(_TXADR)
000314 F0E3 3AB1EE          13      LD  A,(_WIDTH)
000317 F0E6 4F               4      LD  C,A
000318 F0E7 95               4      SUB L
000319 F0E8 47               4      LD  B,A
00031A F0E9 79               4      LD  A,C
00031B F0EA 3D               4      DEC A
00031C F0EB 6F               4      LD  L,A
00031D F0EC CD6DE1          17      CALL    LOC1
                                
000320 F0EF 3E20             7      LD  A,020H
       F0F1                     C8X1:
000322 F0F1 4E               7      LD  C,(HL)
000323 F0F2 77               7      LD  (HL),A
000324 F0F3 2B               6      DEC HL
000325 F0F4 79               4      LD  A,C
000326 F0F5 10FA            13      DJNZ    C8X1
000328 F0F7 C9              10      RET
                                
       F0F8                     CTRL05:
000329 F0F8 CDD3EE          17      CALL    _POS
00032C F0FB 2A8EEE          16      LD  HL,(_TXADR)
00032F F0FE 3AB1EE          13      LD  A,(_WIDTH)
000332 F101 95               4      SUB L
000333 F102 47               4      LD  B,A
000334 F103 CD6AE1          17      CALL    LOC0
       F106                     CLLINE:
000337 F106 3E20             7      LD  A,020H
       F108                     CLLINE1:
000339 F108 77               7      LD  (HL),A
00033A F109 23               6      INC HL
00033B F10A 10FC            13      DJNZ    CLLINE1
00033D F10C C9              10      RET
                                
       F10D                     CTRL0D:
00033E F10D AF               4      XOR A
00033F F10E 328EEE          13      LD  (_TXADR),A
000342 F111 C9              10      RET
                                
       F112                     CTRL12:
000343 F112 2159E1          10      LD  HL,INSFLG
000346 F115 7E               7      LD  A,(HL)
000347 F116 EECC             7      XOR 0CCH        ;CD:CALL ???? 1:LD BC,????
000349 F118 77               7      LD  (HL),A
00034A F119 C9              10      RET
                                
       F11A                     CTRL0B:
00034B F11A 210000          10      LD  HL,0
00034E F11D 228EEE          16      LD  (_TXADR),HL
000351 F120 C9              10      RET
                                
       F121                     CTRL1B:
000352 F121 3E01             7      LD  A,1
000354 F123 324EE1          13      LD  (ESCFLG),A
000357 F126 C9              10      RET
                                
       F127                     CTRL07:
000358 F127 3AB9EE          13      LD  A,(WK40)
00035B F12A F5              11      PUSH    AF
00035C F12B F620             7      OR  20H
00035E F12D D340            11      OUT (040H),A
000360 F12F 0610             7      LD  B,16
       F131                     C07X1:
000362 F131 CD7EE2          17      CALL    VBLANK
000365 F134 10FB            13      DJNZ    C07X1
000367 F136 F1              10      POP AF
000368 F137 D340            11      OUT (040H),A
00036A F139 C9              10      RET
                                
       F13A                     INSERT:
00036B F13A 2A8EEE          16      LD  HL,(_TXADR)
00036E F13D 3AB1EE          13      LD  A,(_WIDTH)
000371 F140 95               4      SUB L
000372 F141 47               4      LD  B,A
                                
000373 F142 CD6AE1          17      CALL    LOC0
                                
000376 F145 3E20             7      LD  A,020H
       F147                     INS1:
000378 F147 4E               7      LD  C,(HL)
000379 F148 77               7      LD  (HL),A
00037A F149 79               4      LD  A,C
00037B F14A 23               6      INC HL
00037C F14B 10FA            13      DJNZ    INS1
00037E F14D C9              10      RET
                                
       F14E                     CTRL0C:
00037F F14E CD1AF1          17      CALL    CTRL0B
       F151                     CTRL06:
000382 F151 2A8EEE          16      LD  HL,(_TXADR)
       F154                     CLS1:
       F154                     CLS2:
000385 F154 E5              11      PUSH    HL
000386 F155 3AB1EE          13      LD  A,(_WIDTH)
000389 F158 95               4      SUB L
00038A F159 47               4      LD  B,A
00038B F15A CD6DE1          17      CALL    LOC1
00038E F15D 3E20             7      LD  A,020H
       F15F                     CLS3:
000390 F15F 77               7      LD  (HL),A
000391 F160 23               6      INC HL
000392 F161 10FC            13      DJNZ    CLS3
000394 F163 E1              10      POP HL
000395 F164 2E00             7      LD  L,0
000397 F166 24               4      INC H
000398 F167 3A97EE          13      LD  A,(_LINE)
00039B F16A BC               4      CP  H
00039C F16B 20E7            12      JR  NZ,CLS2
00039E F16D C9              10      RET
                                
       F16E                     CTRL04:
00039F F16E CDD3EE          17      CALL    _POS
0003A2 F171 7D               4      LD  A,L
0003A3 F172 B7               4      OR  A
0003A4 F173 C8              11      RET Z
       F174                     CTRL03:
0003A5 F174 CD0DF1          17      CALL    CTRL0D
       F177                     CTRL0A:
       F177                     CTRL1F:
0003A8 F177 2A8EEE          16      LD  HL,(_TXADR)
0003AB F17A 24               4      INC H
0003AC F17B C397F0          10      JP  PRINTE8
                                
       F17E                     CTRL0E:
0003AF F17E CDD3EE          17      CALL    _POS
0003B2 F181 7C               4      LD  A,H
0003B3 F182 1804            12      JR  SCR1
       F184                     SCR:
0003B5 F184 3A97EE          13      LD  A,(_LINE)
0003B8 F187 3D               4      DEC A
       F188                     SCR1:
0003B9 F188 C5              11      PUSH    BC
0003BA F189 D5              11      PUSH    DE
0003BB F18A E5              11      PUSH    HL
0003BC F18B F5              11      PUSH    AF
0003BD F18C 210000          10      LD  HL,0
0003C0 F18F CD6DE1          17      CALL    LOC1
0003C3 F192 EB               4      EX  DE,HL
0003C4 F193 210001          10      LD  HL,0100H
0003C7 F196 CD6DE1          17      CALL    LOC1
0003CA F199 C1              10      POP BC
0003CB F19A 78               4      LD  A,B
0003CC F19B B7               4      OR  A
       F19C                     SCRUP1:
0003CD F19C 2815            12      JR  Z,SCRCL
0003CF F19E E5              11      PUSH    HL
0003D0 F19F D5              11      PUSH    DE
0003D1 F1A0 0608             7      LD  B,8
0003D3 F1A2 5F               4      LD  E,A
0003D4 F1A3 210078          10      LD  HL,120*256
0003D7 F1A6 55               4      LD  D,L
       F1A7                     SCRH2:
0003D8 F1A7 29              11      ADD HL,HL
0003D9 F1A8 3001            12      JR  NC,SCRH3
0003DB F1AA 19              11      ADD HL,DE
       F1AB                     SCRH3:
0003DC F1AB 10FA            13      DJNZ    SCRH2
0003DE F1AD 4D               4      LD  C,L
0003DF F1AE 44               4      LD  B,H
0003E0 F1AF D1              10      POP DE
0003E1 F1B0 E1              10      POP HL
0003E2 F1B1 EDB0                    LDIR
                                
       F1B3                     SCRCL:
0003E4 F1B3 3AB1EE          13      LD  A,(_WIDTH)
0003E7 F1B6 47               4      LD  B,A
0003E8 F1B7 EB               4      EX  DE,HL
0003E9 F1B8 CD06F1          17      CALL    CLLINE
0003EC F1BB E1              10      POP HL
0003ED F1BC D1              10      POP DE
0003EE F1BD C1              10      POP BC
0003EF F1BE C9              10      RET
[EOF:88VRAM.ASM:UTF_8]
                                    INCLUDE "88TABLE.ASM"
                                
                                ;   LSX-Dodgers TABLE キーのテーブル
                                
       F1BF                     KEY_TABLE:
0003F0 F1BF 3031323334353637        DB  '0','1','2','3','4','5','6','7' ;0
0003F8 F1C7 38392A2B3D2E2C0D        DB  '8','9','*','+','=','.',',',0DH ;1
000400 F1CF 4061626364656667        DB  '@','a','b','c','d','e','f','g' ;2
000408 F1D7 68696A6B6C6D6E6F        DB  'h','i','j','k','l','m','n','o' ;3
000410 F1DF 7071727374757677        DB  'p','q','r','s','t','u','v','w' ;4
000418 F1E7 78797A5B5C5D5E2D        DB  'x','y','z','[',5CH,']','^','-' ;5
000420 F1EF 3031323334353637        DB  '0','1','2','3','4','5','6','7' ;6
000428 F1F7 38393A3B2C2E2F5C        DB  '8','9',':',';',',','.','/',5CH ;7
000430 F1FF 0C1E1C0800000000        DB  0CH,1EH,1CH,08H,00H,00H,00H,00H ;8
000438 F207 030000000000201B        DB  03H,00H,00H,00H,00H,00H,' ',1BH ;9
000440 F20F 091F1D00002D2F00        DB  09H,1FH,1DH,00H,00H,'-','/',00H ;A
000448 F217 0000000000000000        DB  00H,00H,00H,00H,00H,00H,00H,00H ;B
000450 F21F 0000000000081208        DB  00H,00H,00H,00H,00H,08H,12H,08H ;C
                                
       F227                     SHIFT_TABLE:
000458 F227 3031323334353637        DB  '0','1','2','3','4','5','6','7' ;0
000460 F22F 38392A2B3D2E2C0D        DB  '8','9','*','+','=','.',',',0DH ;1
000468 F237 4041424344454647        DB  '@','A','B','C','D','E','F','G' ;2
000470 F23F 48494A4B4C4D4E4F        DB  'H','I','J','K','L','M','N','O' ;3
000478 F247 5051525354555657        DB  'P','Q','R','S','T','U','V','W' ;4
000480 F24F 58595A7B7C7D7E3D        DB  'X','Y','Z','{','|','}','~','=' ;5
000488 F257 3021222324252627        DB  '0','!','"','#','$','%','&',27H ;6
000490 F25F 28292A2B3C3E3F5F        DB  '(',')','*','+','<','>','?','_' ;7
000498 F267 0B1E1C0800000000        DB  0BH,1EH,1CH,08H,00H,00H,00H,00H ;8
0004A0 F26F 030000000000201B        DB  03H,00H,00H,00H,00H,00H,' ',1BH ;9
0004A8 F277 091F1D00002D2F00        DB  09H,1FH,1DH,00H,00H,'-','/',00H ;A
0004B0 F27F 0000000000000000        DB  00H,00H,00H,00H,00H,00H,00H,00H ;B
0004B8 F287 0000000000081208        DB  00H,00H,00H,00H,00H,08H,12H,08H ;C
                                
       F28F                     CTRL_TABLE:
0004C0 F28F 3031323334353637        DB  '0','1','2','3','4','5','6','7' ;0
0004C8 F297 38392A2B3D2E2C0D        DB  '8','9','*','+','=','.',',',0DH ;1
0004D0 F29F 4001020304050607        DB  '@',01H,02H,03H,04H,05H,06H,07H ;2
0004D8 F2A7 08090A0B0C0D0E0F        DB  08H,09H,0AH,0BH,0CH,0DH,0EH,0FH ;3
0004E0 F2AF 1011121314151617        DB  10H,11H,12H,13H,14H,15H,16H,17H ;4
0004E8 F2B7 18191A5B5C5D5E2D        DB  18H,19H,1AH,'[',5CH,']','^','-' ;5
0004F0 F2BF 3031323334353637        DB  '0','1','2','3','4','5','6','7' ;6
0004F8 F2C7 38393A3B2C2E2F5F        DB  '8','9',':',';',',','.','/','_' ;7
000500 F2CF 0C1E1C0800000000        DB  0CH,1EH,1CH,08H,00H,00H,00H,00H ;8
000508 F2D7 030000000000201B        DB  03H,00H,00H,00H,00H,00H,' ',1BH ;9
000510 F2DF 091F1D00002D2F00        DB  09H,1FH,1DH,00H,00H,'-','/',00H ;A
000518 F2E7 0000000000000000        DB  00H,00H,00H,00H,00H,00H,00H,00H ;B
000520 F2EF 0000000000081208        DB  00H,00H,00H,00H,00H,08H,12H,08H ;C
       F2F7                     VRAME:
000528 D621                         ORG $$+OFFSET,$$    ;$DEPHASE
       D621                     AT_VRAME:
[EOF:88TABLE.ASM:SHIFT_JIS]
                                    INCLUDE "88SUB.ASM"
                                
                                ;   LSX-Dodgers SUB DISK SYSTEM
                                ;   PC-8801mkIISR
                                
       D621                     AT_DSS:
000528 7C00                         ORG DSS,AT_DSS-OFFSET
000528 7C00 C3437C          10      JP  READDISKEX
00052B 7C03 C3A37C          10      JP  WRITEDISKEX
00052E 7C06 C3BB7C          10      JP  GETPARAMS_N
000531 7C09 C3C67C          10      JP  SEEK
000534 7C0C C3547D          10      JP  FDCOMMAND
000537 7C0F C3207E          10      JP  CHECKRESULT
00053A 7C12 C3427E          10      JP  GETDEVSTAT
00053D 7C15 C3477E          10      JP  RDFDC
                                
000540 7C18                         DS  8*3
                                
       7C30                     S_PARAMS:
000558 7C30                         DS  16
       7C30                     S_UNITNO    EQU S_PARAMS    ;ユニット番号 0:ドライブA 1:ドライブB
       7C31                     S_DPS       EQU S_PARAMS+1  ;1トラックのセクタ数
       7C32                     S_SECTOR_R  EQU S_PARAMS+2  ;セクタ番号
       7C33                     S_TRACK     EQU S_PARAMS+3  ;トラック番号
       7C34                     S_FDMODE    EQU S_PARAMS+4  ;FDモード切り替え $FF:2D/2DD $FE:2HD
       7C35                     S_SECSIZE_N EQU S_PARAMS+5  ;N セクタサイズ
       7C36                     S_BYTE_H    EQU S_PARAMS+6  ;バイト数H
       7C37                     S_MAXCL     EQU S_PARAMS+7  ;シリンダ数
                                
       7C40                     S_CMD_STATUS:
000568 7C40 00                      DB  0
       7C41                     S_LEFT:
000569 7C41 00                      DB  0
       7C42                     S_WKF4:
00056A 7C42 00                      DB  0
                                
       7C43                     READDISKEX:
00056B 7C43 CDB97C          17      CALL    GETPARAMS
00056E 7C46 AF               4      XOR A
00056F 7C47 327A7C          13      LD  (RETRY_RDDISK),A
000572 7C4A 2A327C          16      LD  HL,(S_PARAMS+2)
000575 7C4D 7D               4      LD  A,L
000576 7C4E 3D               4      DEC A
000577 7C4F B4               4      OR  H
000578 7C50 200C            12      JR  NZ,RDDISK0
00057A 7C52 2A357C          16      LD  HL,(S_PARAMS+5)
00057D 7C55 7C               4      LD  A,H
00057E 7C56 BD               4      CP  L
00057F 7C57 2005            12      JR  NZ,RDDISK0
000581 7C59 3E03             7      LD  A,3
000583 7C5B 327A7C          13      LD  (RETRY_RDDISK),A
       7C5E                     RDDISK0:
000586 7C5E CDC67C          17      CALL    SEEK
000589 7C61 3E46             7      LD  A,46H       ;READ DATA
00058B 7C63 CD547D          17      CALL    FDCOMMAND
00058E 7C66 3834            12      JR  C,FINISH_DISK
000590 7C68 CD857D          17      CALL    RDDISK1
       7C6B                     WRDISK3:
000593 7C6B 78               4      LD  A,B
000594 7C6C B2               4      OR  D
000595 7C6D 32417C          13      LD  (S_LEFT),A
000598 7C70 DBF8            11      IN  A,(0F8H)    ;FDC μPD765A TC入力
00059A 7C72 FB               4      EI
00059B 7C73 76               4      HALT
00059C 7C74 CD207E          17      CALL    CHECKRESULT
00059F 7C77 301D            12      JR  NC,FINISH_DISK0
       7C7A                     RETRY_RDDISK    EQU $+1
0005A1 7C79 3E00             7      LD  A,0
0005A3 7C7B B7               4      OR  A
0005A4 7C7C 2818            12      JR  Z,FINISH_DISK0
0005A6 7C7E 3D               4      DEC A
0005A7 7C7F 327A7C          13      LD  (RETRY_RDDISK),A
0005AA 7C82 3A357C          13      LD  A,(S_PARAMS+5)
0005AD 7C85 FE04             7      CP  4
0005AF 7C87 3003            12      JR  NC,RETRY_RDDISK1
0005B1 7C89 87               4      ADD A,A
0005B2 7C8A 1802            12      JR  RETRY_RDDISK2
       7C8C                     RETRY_RDDISK1:
0005B4 7C8C 3E01             7      LD  A,1
       7C8E                     RETRY_RDDISK2:
0005B6 7C8E 67               4      LD  H,A
0005B7 7C8F 6F               4      LD  L,A
0005B8 7C90 22357C          16      LD  (S_PARAMS+5),HL
0005BB 7C93 C35E7C          10      JP  RDDISK0
       7C96                     FINISH_DISK0:
0005BE 7C96 3A417C          13      LD  A,(S_LEFT)
0005C1 7C99 D601             7      SUB 1
0005C3 7C9B 3F               4      CCF
       7C9C                     FINISH_DISK:
0005C4 7C9C 9F               4      SBC A,A
0005C5 7C9D 32407C          13      LD  (S_CMD_STATUS),A
0005C8 7CA0 C32A00          10      JP  MAIN
                                
       7CA3                     WRITEDISKEX:
0005CB 7CA3 AF               4      XOR A
0005CC 7CA4 327A7C          13      LD  (RETRY_RDDISK),A
0005CF 7CA7 CDB97C          17      CALL    GETPARAMS
0005D2 7CAA CDC67C          17      CALL    SEEK
0005D5 7CAD 3E45             7      LD  A,45H       ;WRITE DATA
0005D7 7CAF CD547D          17      CALL    FDCOMMAND
0005DA 7CB2 38E8            12      JR  C,FINISH_DISK
0005DC 7CB4 CDCC7D          17      CALL    WRDISK1
0005DF 7CB7 18B2            12      JR  WRDISK3
                                
       7CB9                     GETPARAMS:
0005E1 7CB9 0608             7      LD  B,8
       7CBB                     GETPARAMS_N:
0005E3 7CBB E5              11      PUSH    HL
0005E4 7CBC 21307C          10      LD  HL,S_PARAMS
       7CBF                     GETPARAMS1:
0005E7 7CBF D7              12      RST 10H
0005E8 7CC0 77               7      LD  (HL),A
0005E9 7CC1 23               6      INC HL
0005EA 7CC2 10FB            13      DJNZ    GETPARAMS1
0005EC 7CC4 E1              10      POP HL
0005ED 7CC5 C9              10      RET
                                
       7CC6                     SEEK:
0005EE 7CC6 E5              11      PUSH    HL
0005EF 7CC7 3A347C          13      LD  A,(S_FDMODE)    ;FDモード切り替え $FF:2D/2DD $FE:2HD
0005F2 7CCA 1F               4      RRA
0005F3 7CCB 3F               4      CCF
0005F4 7CCC 9F               4      SBC A,A
0005F5 7CCD F5              11      PUSH    AF
0005F6 7CCE E605             7      AND 5
0005F8 7CD0 4F               4      LD  C,A
0005F9 7CD1 3A377C          13      LD  A,(S_MAXCL) ;シリンダ数
0005FC 7CD4 C6D3             7      ADD A,0-45      ;オーバートラックを考慮して40+α
0005FE 7CD6 9F               4      SBC A,A
0005FF 7CD7 E604             7      AND 4
000601 7CD9 B1               4      OR  C
000602 7CDA 0EFA             7      LD  C,0FFH-5    ;マスク
000604 7CDC 47               4      LD  B,A
000605 7CDD 3A307C          13      LD  A,(S_UNITNO)    ;0:ドライブA 1:ドライブB
000608 7CE0 B7               4      OR  A
000609 7CE1 2804            12      JR  Z,SET_WKF4
00060B 7CE3 CB20             8      SLA B
00060D 7CE5 CB01             4      RLC C
       7CE7                     SET_WKF4:
00060F 7CE7 3A427C          13      LD  A,(S_WKF4)
000612 7CEA A1               4      AND C
000613 7CEB B0               4      OR  B
000614 7CEC 4F               4      LD  C,A
000615 7CED D3F4            11      OUT (0F4H),A    ;ドライブ制御
000617 7CEF E6DF             7      AND 0FFH-020H   ;CLKの分は抜いておく
000619 7CF1 47               4      LD  B,A
00061A 7CF2 F1              10      POP AF
00061B 7CF3 E620             7      AND 020H        ;bit5:CLK
00061D 7CF5 B0               4      OR  B
00061E 7CF6 D3F4            11      OUT (0F4H),A    ;ドライブ制御
000620 7CF8 32427C          13      LD  (S_WKF4),A
000623 7CFB 47               4      LD  B,A
000624 7CFC A9               4      XOR C
000625 7CFD E620             7      AND 020H        ;CLKが変化したら一定時間待つ
000627 7CFF 2808            12      JR  Z,NOCHGCLK
000629 7D01 2160F0          10      LD  HL,0F060H
       7D04                     WAIT_CLK:
00062C 7D04 2B               6      DEC HL
00062D 7D05 7C               4      LD  A,H
00062E 7D06 B5               4      OR  L
00062F 7D07 20FB            12      JR  NZ,WAIT_CLK
       7D09                     NOCHGCLK:
000631 7D09 78               4      LD  A,B
000632 7D0A E620             7      AND 020H
000634 7D0C 2805            12      JR  Z,SPECIFY2D
000636 7D0E 1131DF          10      LD  DE,0DF31H   ;SPECIFY 2HD / SRT:13 HUT:15 HLT:24 NON-DMA
000639 7D11 1803            12      JR  SPECIFYOK
       7D13                     SPECIFY2D:
00063B 7D13 1119DA          10      LD  DE,0DA19H   ;SPECIFY 2D/2DD / SRT:13 HUT 10 HLT:12 NON-DMA
       7D16                     SPECIFYOK:
00063E 7D16 3E03             7      LD  A,3     ;SPECIFY
000640 7D18 E7              12      RST 20H
000641 7D19 7A               4      LD  A,D
000642 7D1A E7              12      RST 20H
000643 7D1B 7B               4      LD  A,E
000644 7D1C E7              12      RST 20H
       7D1D                     NOSPECIFY:
000645 7D1D ED4B307C        20      LD  BC,(S_PARAMS)
000649 7D21 ED5B327C        20      LD  DE,(S_PARAMS+2)
00064D 7D25 7A               4      LD  A,D     ;TRACK
00064E 7D26 CB3F             8      SRL A       ;CYLINDER
000650 7D28 3E0F             7      LD  A,00FH      ;SEEK
000652 7D2A 2002            12      JR  NZ,SEEK1    ;0シリンダの場合はRECALIBRATE、それ以外はSEEKを使う
000654 7D2C 3E07             7      LD  A,7     ;RECALIBRATE
       7D2E                     SEEK1:
000656 7D2E E7              12      RST 20H
000657 7D2F 79               4      LD  A,C     ;DR/HD
000658 7D30 E7              12      RST 20H
000659 7D31 7A               4      LD  A,D     ;TRACK
00065A 7D32 CB3F             8      SRL A       ;CYLINDER
00065C 7D34 C42000          17      CALL    NZ,20H      ;SEEKの場合だけ呼ぶ(0シリンダの場合はRECALIBRATEを使うのでシリンダの設定は不要)
00065F 7D37 FB               4      EI
000660 7D38 76               4      HALT
000661 7D39 3E08             7      LD  A,8     ;SENSE
000663 7D3B E7              12      RST 20H
000664 7D3C CD477E          17      CALL    RDFDC       ;ST0
000667 7D3F CD477E          17      CALL    RDFDC       ;PCN(CYLINDER)
00066A 7D42 210040          10      LD  HL,04000H
       7D45                     WAIT_SEEK:
00066D 7D45 CD427E          17      CALL    GETDEVSTAT
000670 7D48 E608             7      AND 8
000672 7D4A 2006            12      JR  NZ,SEEK_OK
000674 7D4C 2B               6      DEC HL
000675 7D4D 7C               4      LD  A,H
000676 7D4E B5               4      OR  L
000677 7D4F 20F4            12      JR  NZ,WAIT_SEEK
000679 7D51 37               4      SCF
       7D52                     SEEK_OK:
00067A 7D52 E1              10      POP HL
00067B 7D53 C9              10      RET
                                
       7D54                     FDCOMMAND:
00067C 7D54 E7              12      RST 20H
00067D 7D55 7A               4      LD  A,D     ;HD US1 US0
00067E 7D56 E601             7      AND 1
000680 7D58 87               4      ADD A,A
000681 7D59 87               4      ADD A,A
000682 7D5A B1               4      OR  C
000683 7D5B E7              12      RST 20H
000684 7D5C 7A               4      LD  A,D     ;C
000685 7D5D CB3F             8      SRL A
000687 7D5F E7              12      RST 20H
000688 7D60 7A               4      LD  A,D     ;H
000689 7D61 E601             7      AND 1
00068B 7D63 E7              12      RST 20H
00068C 7D64 7B               4      LD  A,E     ;R
00068D 7D65 E7              12      RST 20H
00068E 7D66 3A357C          13      LD  A,(S_PARAMS+5)  ;N
000691 7D69 FE04             7      CP  4
000693 7D6B 3802            12      JR  C,FDCOMMAND2
                                
000695 7D6D 3E03             7      LD  A,3
       7D6F                     FDCOMMAND2:
000697 7D6F 1E20             7      LD  E,020H      ;NO SERVICE
000699 7D71 E7              12      RST 20H
                                
00069A 7D72 210040          10      LD  HL,DSS_DATA ;開始アドレス
00069D 7D75 78               4      LD  A,B     ;EOT
00069E 7D76 E7              12      RST 20H
                                
00069F 7D77 01FB00          10      LD  BC,000FBH   ;B:バイト数L C:FDC μPD765A データレジスタ
0006A2 7D7A 3E54             7      LD  A,054H      ;GSL
0006A4 7D7C E7              12      RST 20H
                                
0006A5 7D7D 3A367C          13      LD  A,(S_BYTE_H)
0006A8 7D80 57               4      LD  D,A     ;バイト数H
                                
0006A9 7D81 AF               4      XOR A       ;DTL
0006AA 7D82 E7              12      RST 20H
0006AB 7D83 A7               4      AND A
0006AC 7D84 C9              10      RET
                                
       7D85                     RDDISK1:            ;高速化の為にループ展開x8
0006AD 7D85 FB               4      EI
0006AE 7D86 76               4      HALT
0006AF 7D87 DBFA            11      IN  A,(0FAH)    ;FDC μPD765A ステータスレジスタリード
0006B1 7D89 A3               4      AND E       ;NO SERVICE
0006B2 7D8A C8              11      RET Z
0006B3 7D8B EDA2            16      INI
                                
0006B5 7D8D FB               4      EI
0006B6 7D8E 76               4      HALT
0006B7 7D8F DBFA            11      IN  A,(0FAH)    ;FDC μPD765A ステータスレジスタリード
0006B9 7D91 A3               4      AND E       ;NO SERVICE
0006BA 7D92 C8              11      RET Z
0006BB 7D93 EDA2            16      INI
                                
0006BD 7D95 FB               4      EI
0006BE 7D96 76               4      HALT
0006BF 7D97 DBFA            11      IN  A,(0FAH)    ;FDC μPD765A ステータスレジスタリード
0006C1 7D99 A3               4      AND E       ;NO SERVICE
0006C2 7D9A C8              11      RET Z
0006C3 7D9B EDA2            16      INI
                                
0006C5 7D9D FB               4      EI
0006C6 7D9E 76               4      HALT
0006C7 7D9F DBFA            11      IN  A,(0FAH)    ;FDC μPD765A ステータスレジスタリード
0006C9 7DA1 A3               4      AND E       ;NO SERVICE
0006CA 7DA2 C8              11      RET Z
0006CB 7DA3 EDA2            16      INI
                                
0006CD 7DA5 FB               4      EI
0006CE 7DA6 76               4      HALT
0006CF 7DA7 DBFA            11      IN  A,(0FAH)    ;FDC μPD765A ステータスレジスタリード
0006D1 7DA9 A3               4      AND E       ;NO SERVICE
0006D2 7DAA C8              11      RET Z
0006D3 7DAB EDA2            16      INI
                                
0006D5 7DAD FB               4      EI
0006D6 7DAE 76               4      HALT
0006D7 7DAF DBFA            11      IN  A,(0FAH)    ;FDC μPD765A ステータスレジスタリード
0006D9 7DB1 A3               4      AND E       ;NO SERVICE
0006DA 7DB2 C8              11      RET Z
0006DB 7DB3 EDA2            16      INI
                                
0006DD 7DB5 FB               4      EI
0006DE 7DB6 76               4      HALT
0006DF 7DB7 DBFA            11      IN  A,(0FAH)    ;FDC μPD765A ステータスレジスタリード
0006E1 7DB9 A3               4      AND E       ;NO SERVICE
0006E2 7DBA C8              11      RET Z
0006E3 7DBB EDA2            16      INI
                                
0006E5 7DBD FB               4      EI
0006E6 7DBE 76               4      HALT
0006E7 7DBF DBFA            11      IN  A,(0FAH)    ;FDC μPD765A ステータスレジスタリード
0006E9 7DC1 A3               4      AND E       ;NO SERVICE
0006EA 7DC2 C8              11      RET Z
0006EB 7DC3 EDA2            16      INI
                                
0006ED 7DC5 20BE            12      JR  NZ,RDDISK1
0006EF 7DC7 15               4      DEC D
0006F0 7DC8 C2857D          10      JP  NZ,RDDISK1
0006F3 7DCB C9              10      RET
                                
       7DCC                     WRDISK1:            ;高速化の為にループ展開x8
0006F4 7DCC FB               4      EI
0006F5 7DCD 76               4      HALT
0006F6 7DCE DBFA            11      IN  A,(0FAH)    ;FDC μPD765A ステータスレジスタリード
0006F8 7DD0 A3               4      AND E
0006F9 7DD1 C8              11      RET Z
0006FA 7DD2 EDA3            16      OUTI
                                
0006FC 7DD4 FB               4      EI
0006FD 7DD5 76               4      HALT
0006FE 7DD6 DBFA            11      IN  A,(0FAH)    ;FDC μPD765A ステータスレジスタリード
000700 7DD8 A3               4      AND E
000701 7DD9 C8              11      RET Z
000702 7DDA EDA3            16      OUTI
                                
000704 7DDC FB               4      EI
000705 7DDD 76               4      HALT
000706 7DDE DBFA            11      IN  A,(0FAH)    ;FDC μPD765A ステータスレジスタリード
000708 7DE0 A3               4      AND E
000709 7DE1 C8              11      RET Z
00070A 7DE2 EDA3            16      OUTI
                                
00070C 7DE4 FB               4      EI
00070D 7DE5 76               4      HALT
00070E 7DE6 DBFA            11      IN  A,(0FAH)    ;FDC μPD765A ステータスレジスタリード
000710 7DE8 A3               4      AND E
000711 7DE9 C8              11      RET Z
000712 7DEA EDA3            16      OUTI
                                
000714 7DEC FB               4      EI
000715 7DED 76               4      HALT
000716 7DEE DBFA            11      IN  A,(0FAH)    ;FDC μPD765A ステータスレジスタリード
000718 7DF0 A3               4      AND E
000719 7DF1 C8              11      RET Z
00071A 7DF2 EDA3            16      OUTI
                                
00071C 7DF4 FB               4      EI
00071D 7DF5 76               4      HALT
00071E 7DF6 DBFA            11      IN  A,(0FAH)    ;FDC μPD765A ステータスレジスタリード
000720 7DF8 A3               4      AND E
000721 7DF9 C8              11      RET Z
000722 7DFA EDA3            16      OUTI
                                
000724 7DFC FB               4      EI
000725 7DFD 76               4      HALT
000726 7DFE DBFA            11      IN  A,(0FAH)    ;FDC μPD765A ステータスレジスタリード
000728 7E00 A3               4      AND E
000729 7E01 C8              11      RET Z
00072A 7E02 EDA3            16      OUTI
                                
00072C 7E04 FB               4      EI
00072D 7E05 76               4      HALT
00072E 7E06 DBFA            11      IN  A,(0FAH)    ;FDC μPD765A ステータスレジスタリード
000730 7E08 A3               4      AND E
000731 7E09 C8              11      RET Z
000732 7E0A EDA3            16      OUTI
                                
000734 7E0C 20BE            12      JR  NZ,WRDISK1
000736 7E0E 15               4      DEC D
000737 7E0F C2CC7D          10      JP  NZ,WRDISK1
00073A 7E12 C9              10      RET
                                
       7E13                     RESULTEX:
00073B 7E13 3A407C          13      LD  A,(S_CMD_STATUS)
00073E 7E16 3C               4      INC A
00073F 7E17 2803            12      JR  Z,RESULTEX1
000741 7E19 3A367C          13      LD  A,(S_BYTE_H)    ;バイト数H
       7E1C                     RESULTEX1:
000744 7E1C DF              12      RST 18H
000745 7E1D C32A00          10      JP  MAIN
                                
       7E20                     CHECKRESULT:
000748 7E20 C5              11      PUSH    BC
000749 7E21 CD477E          17      CALL    RDFDC       ;ST0
00074C 7E24 E6D8             7      AND 0D8H
00074E 7E26 4F               4      LD  C,A
00074F 7E27 CD477E          17      CALL    RDFDC       ;ST1
000752 7E2A E6B7             7      AND 0B7H
000754 7E2C B1               4      OR  C
000755 7E2D 4F               4      LD  C,A
000756 7E2E CD477E          17      CALL    RDFDC       ;ST2
000759 7E31 E673             7      AND 073H
00075B 7E33 B1               4      OR  C
00075C 7E34 4F               4      LD  C,A
00075D 7E35 0604             7      LD  B,4
       7E37                     CHECKRESULT1:           ;C H R N
00075F 7E37 CD477E          17      CALL    RDFDC
000762 7E3A 10FB            13      DJNZ    CHECKRESULT1
000764 7E3C 79               4      LD  A,C
000765 7E3D A7               4      AND A
000766 7E3E C1              10      POP BC
000767 7E3F C8              11      RET Z
000768 7E40 37               4      SCF
000769 7E41 C9              10      RET
                                
       7E42                     GETDEVSTAT:
00076A 7E42 3E04             7      LD  A,4
00076C 7E44 E7              12      RST 20H
00076D 7E45 79               4      LD  A,C
00076E 7E46 E7              12      RST 20H
                                
       7E47                     RDFDC:
00076F 7E47 DBFA            11      IN  A,(0FAH)    ;FDC μPD765A ステータスレジスタリード
000771 7E49 2F               4      CPL
000772 7E4A E6C0             7      AND 0C0H        ;RQMとDIOが両方1になるまで待つ
000774 7E4C 20F9            12      JR  NZ,RDFDC
000776 7E4E DBFB            11      IN  A,(0FBH)    ;FDC μPD765A データレジスタリード
000778 7E50 C9              10      RET
                                
000779 D872                         ORG $$+OFFSET,$$    ;$DEPHASE
       D872                     AT_DSSE:
       D872                     INITE:
000779 D872                         DS  BDOS-INITE
00080D D906 C36CE0          10      JP  BDOS_RF
[EOF:88SUB.ASM:SHIFT_JIS]
                                    INCLUDE "88CCP.ASM"
                                
                                ;   LSX-Dodgers CCP
                                ;   PC-8801mkIISR
                                
       D909                     WBOOT1:
000810 D909 ED7B0600        20      LD  SP,(SYSTEM+1)
000814 D90D DB32            11      IN  A,(032H)
000816 D90F F610             7      OR  10H     ;高速RAMアクセスモードOFF
000818 D911 D332            11      OUT (032H),A
                                
00081A D913 3EED             7      LD  A,IVRTC/256
00081C D915 ED47             9      LD  I,A
00081E D917 3AB8EE          13      LD  A,(WKE6)
000821 D91A F602             7      OR  2       ;VRTC割り込みマスク
000823 D91C D3E6            11      OUT (0E6H),A    ;割り込みマスク
000825 D91E 32B8EE          13      LD  (WKE6),A
000828 D921 3AB7EE          13      LD  A,(WKE4)
00082B D924 D3E4            11      OUT (0E4H),A    ;割り込みレベル設定 
                                
00082D D926 FB               4      EI
00082E D927 2192EE          10      LD  HL,_KEYD
000831 D92A 3600            10      LD  (HL),0
000833 D92C CD1FE2          17      CALL    CHKEY
000836 D92F CDE5E2          17      CALL    KEYBC_IFBREAK
000839 D932 3E04             7      LD  A,4
00083B D934 CDF8E2          17      CALL    MSG_A
[EOF:88CCP.ASM:SHIFT_JIS]
                                    INCLUDE "LDCCP.ASM"
                                
                                ;   LSX-Dodgers CCP
                                
       D937                     COMMAND:
00083E D937 3A8FED          13      LD  A,(FCB_BAT)
000841 D93A B7               4      OR  A
000842 D93B C279DA          10      JP  NZ,C_BAT1
000845 D93E CDEDD9          17      CALL    SETDTA1
000848 D941 3A0400          13      LD  A,(_DVSW)
00084B D944 C641             7      ADD A,'A'
00084D D946 CDF8E2          17      CALL    MSG_A
000850 D949 3E3E             7      LD  A,'>'
000852 D94B CDF8E2          17      CALL    MSG_A
000855 D94E 3E50             7      LD  A,80
000857 D950 12               7      LD  (DE),A
000858 D951 CD75E0          17      CALL    _SYS0A      ;(BDOS)文字列入力
00085B D954 CD6EDB          17      CALL    LTNL
       D957                     COMMAND2:
00085E D957 118200          10      LD  DE,DTA1+2
000861 D95A CDFDEE          17      CALL    _COMANL
000864 D95D DC63E0          17      CALL    C,SHOW_ERROR
000867 D960 18D5            12      JR  COMMAND
                                
       D962                     COMANL:
000869 D962 CD0BF0          17      CALL    FILE
00086C D965 3A19EE          13      LD  A,(FNAME+4)
00086F D968 FE20             7      CP  020H
000871 D96A 201C            12      JR  NZ,COMB2
000873 D96C D5              11      PUSH    DE
000874 D96D 1115EE          10      LD  DE,FNAME
000877 D970 1A               7      LD  A,(DE)
000878 D971 FE20             7      CP  020H
00087A D973 2844            12      JR  Z,SDVSW
00087C D975 1B               6      DEC DE
00087D D976 1A               7      LD  A,(DE)
00087E D977 C6FF             7      ADD A,0FFH
000880 D979 3809            12      JR  C,COMB
000882 D97B 13               6      INC DE
                                
000883 D97C 212BDD          10      LD  HL,COMTB
000886 D97F 0608             7      LD  B,COMS
000888 D981 CD98F2          17      CALL    CPNAME
       D984                     COMB:
00088B D984 D1              10      POP DE
00088C D985 D262E0          10      JP  NC,JPHL
       D988                     COMB2:
00088F D988 EB               4      EX  DE,HL
000890 D989 2256DA          16      LD  (COMSWC),HL
000893 D98C F5              11      PUSH    AF
000894 D98D CD0EDA          17      CALL    CEXE4
000897 D990 F1              10      POP AF
000898 D991 2115EE          10      LD  HL,FNAME
00089B D994 116D00          10      LD  DE,FCB2FN   ;COMMAND NAME
00089E D997 010B00          10      LD  BC,11
0008A1 D99A EDB0                    LDIR
0008A3 D99C 112EED          10      LD  DE,PATHD
       D99F                     CEX1:
0008A6 D99F 1A               7      LD  A,(DE)
0008A7 D9A0 FE20             7      CP  020H
0008A9 D9A2 D8              11      RET C
0008AA D9A3 CD00F0          17      CALL    FILEC
0008AD D9A6 D5              11      PUSH    DE
0008AE D9A7 216D00          10      LD  HL,FCB2FN   ;COMMAND NAME
0008B1 D9AA 1115EE          10      LD  DE,FNAME
0008B4 D9AD 010B00          10      LD  BC,11
0008B7 D9B0 EDB0                    LDIR
0008B9 D9B2 CD0EDA          17      CALL    CEXE4
0008BC D9B5 D1              10      POP DE
0008BD D9B6 13               6      INC DE
0008BE D9B7 18E6            12      JR  CEX1
                                
       D9B9                     SDVSW:
0008C0 D9B9 F1              10      POP AF
0008C1 D9BA 3A14EE          13      LD  A,(FDRV)
0008C4 D9BD 3D               4      DEC A
0008C5 D9BE 5F               4      LD  E,A
0008C6 D9BF 0E0E             7      LD  C,00EH      ;(BDOS)カレントドライブの設定
0008C8 D9C1 1831            12      JR  SYSTEM0
                                
       D9C3                     OPEN1:
0008CA D9C3 2114EE          10      LD  HL,FDRV
       D9C6                     OPEN:
0008CD D9C6 0E11             7      LD  C,011H      ;(BDOS)ファイルの検索
       D9C8                     OPEN3:
0008CF D9C8 D5              11      PUSH    DE
0008D0 D9C9 116AED          10      LD  DE,DTA_CCP
0008D3 D9CC CDEAD9          17      CALL    SETDTA
0008D6 D9CF EB               4      EX  DE,HL
0008D7 D9D0 CDF4D9          17      CALL    SYSTEM0
0008DA D9D3 D1              10      POP DE
0008DB D9D4 C9              10      RET
                                
       D9D5                     OPEN2:
0008DC D9D5 0E12             7      LD  C,012H
0008DE D9D7 18EF            12      JR  OPEN3
                                
       D9D9                     DEFCB:              ;Z=Ok NZ=Error
0008E0 D9D9 116AED          10      LD  DE,DTA_CCP
0008E3 D9DC CDF2D9          17      CALL    SYSC0F
                                
0008E6 D9DF 118BED          10      LD  DE,DTA_CCP+33   ;(FCB)ランダムレコード
0008E9 D9E2 0604             7      LD  B,4
0008EB D9E4 CD3FDC          17      CALL    ZERO_MEMORY_DE
       D9E7                     SETDTA100:
0008EE D9E7 110001          10      LD  DE,BUFFER
       D9EA                     SETDTA:
0008F1 D9EA C3A3DF          10      JP  _SYS1A      ;(BDOS)DTAの設定
                                
       D9ED                     SETDTA1:
0008F4 D9ED 118000          10      LD  DE,DTA1
0008F7 D9F0 18F8            12      JR  SETDTA
                                
       D9F2                     SYSC0F:
0008F9 D9F2 0E0F             7      LD  C,00FH      ;(BDOS)ファイルのオープン
       D9F4                     SYSTEM0:
0008FB D9F4 CD0500          17      CALL    SYSTEM
0008FE D9F7 B7               4      OR  A
0008FF D9F8 C9              10      RET
                                
       D9F9                     C_CD:
000900 D9F9 0E5A             7      LD  C,05AH
000902 D9FB 18F7            12      JR  SYSTEM0
                                
       D9FD                     S27BUF:
000904 D9FD 2100FE          10      LD  HL,0-BUFFER-00100H  ;バッファー+スタック予備(0100H)
       DA00                     S27BUF2:
000907 DA00 39              11      ADD HL,SP
000908 DA01 2E00             7      LD  L,0
00090A DA03 7C               4      LD  A,H
00090B DA04 E6F8             7      AND 0F8H
00090D DA06 67               4      LD  H,A
       DA07                     S27DTA:
00090E DA07 116AED          10      LD  DE,DTA_CCP
       DA0A                     S27:
000911 DA0A 0E27             7      LD  C,027H      ;(BDOS)ランダムブロック読み込み
000913 DA0C 18E6            12      JR  SYSTEM0
                                
       DA0E                     CEXE4:
000915 DA0E 211DEE          10      LD  HL,FNAME+8
000918 DA11 7E               7      LD  A,(HL)
000919 DA12 FE20             7      CP  020H
00091B DA14 2007            12      JR  NZ,CEXE7
00091D DA16 3E3F             7      LD  A,'?'
00091F DA18 77               7      LD  (HL),A
000920 DA19 23               6      INC HL
000921 DA1A 77               7      LD  (HL),A
000922 DA1B 23               6      INC HL
000923 DA1C 77               7      LD  (HL),A
       DA1D                     CEXE7:
000924 DA1D CDC3D9          17      CALL    OPEN1
       DA20                     CEXE5:
000927 DA20 C0              11      RET NZ
000928 DA21 2A74ED          16      LD  HL,(DTA_CCP+1+9)
00092B DA24 7C               4      LD  A,H
00092C DA25 CD27F3          17      CALL    CAP
00092F DA28 67               4      LD  H,A
000930 DA29 7D               4      LD  A,L
000931 DA2A CD27F3          17      CALL    CAP
000934 DA2D 6F               4      LD  L,A
000935 DA2E 3A73ED          13      LD  A,(DTA_CCP+1+8)
000938 DA31 CD27F3          17      CALL    CAP
00093B DA34 D642             7      SUB 'B'
00093D DA36 282C            12      JR  Z,C_BAT
00093F DA38 3D               4      DEC A       ;'C'
000940 DA39 2805            12      JR  Z,C_EXE
       DA3B                     CEXE6:
000942 DA3B CDD5D9          17      CALL    OPEN2
000945 DA3E 18E0            12      JR  CEXE5
                                
       DA40                     C_EXE:
000947 DA40 7C               4      LD  A,H
000948 DA41 FE4D             7      CP  'M'
00094A DA43 20F6            12      JR  NZ,CEXE6
                                
00094C DA45 CDD9D9          17      CALL    DEFCB
00094F DA48 CDFDD9          17      CALL    S27BUF_COM
000952 DA4B 3D               4      DEC A
000953 DA4C 37               4      SCF
000954 DA4D C0              11      RET NZ
000955 DA4E 7C               4      LD  A,H
000956 DA4F B5               4      OR  L
000957 DA50 37               4      SCF
000958 DA51 C8              11      RET Z
000959 DA52 CDEDD9          17      CALL    SETDTA1
00095C DA55 110000          10      LD  DE,0                ; self-modifying code
       DA56                     COMSWC  EQU $-2
00095F DA58 ED7B0600        20      LD  SP,(SYSTEM+1)
000963 DA5C 67               4      LD  H,A             ; A=0 in SETDTA1(_SYS1A)
000964 DA5D 6F               4      LD  L,A
000965 DA5E E5              11      PUSH    HL              ; push $0000 (reboot address)
000966 DA5F 24               4      INC H
000967 DA60 E5              11      PUSH    HL              ; push $0100 (TPA address)
000968 DA61 C30ADC          10      JP  SETFCB              ; and JP $0100
                                
       DA64                     C_BAT:
00096B DA64 114154          10      LD  DE,'A'+'T'*256
00096E DA67 ED52            15      SBC HL,DE
000970 DA69 20D0            12      JR  NZ,CEXE6
                                
000972 DA6B CDD9D9          17      CALL    DEFCB
                                
000975 DA6E 216AED          10      LD  HL,DTA_CCP
000978 DA71 118FED          10      LD  DE,FCB_BAT
00097B DA74 012500          10      LD  BC,37
00097E DA77 EDB0                    LDIR
       DA79                     C_BAT1:
000980 DA79 CDE7D9          17      CALL    SETDTA100
000983 DA7C CDB0DA          17      CALL    FGETC_BAT
000986 DA7F 218100          10      LD  HL,DTA1+1
000989 DA82 2025            12      JR  NZ,END_BATCH
00098B DA84 FE21             7      CP  021H        ;スペースや改行など制御文字を飛ばす
00098D DA86 38F1            12      JR  C,C_BAT1
00098F DA88 3620            10      LD  (HL),' '
000991 DA8A 23               6      INC HL
       DA8B                     C_BAT2:
000992 DA8B 77               7      LD  (HL),A
000993 DA8C 23               6      INC HL
000994 DA8D 7D               4      LD  A,L
000995 DA8E 3C               4      INC A       ;L==0FFH
000996 DA8F 2809            12      JR  Z,RUN_BATCH
000998 DA91 CDB0DA          17      CALL    FGETC_BAT
00099B DA94 2004            12      JR  NZ,RUN_BATCH
00099D DA96 FE20             7      CP  020H
00099F DA98 30F1            12      JR  NC,C_BAT2
       DA9A                     RUN_BATCH:
0009A1 DA9A 7D               4      LD  A,L
0009A2 DA9B D67F             7      SUB DTA1-1
0009A4 DA9D 328000          13      LD  (DTA1),A
0009A7 DAA0 FE04             7      CP  4
0009A9 DAA2 3805            12      JR  C,END_BATCH
0009AB DAA4 3600            10      LD  (HL),0
0009AD DAA6 C357D9          10      JP  COMMAND2
       DAA9                     END_BATCH:
0009B0 DAA9 AF               4      XOR A       ;バッチファイルを閉じる
0009B1 DAAA 328FED          13      LD  (FCB_BAT),A
0009B4 DAAD C300EE          10      JP  CPM_BOOT
                                
       DAB0                     FGETC_BAT:
0009B7 DAB0 118FED          10      LD  DE,FCB_BAT
       DAB3                     FGETC:              ;1文字ずつ読み込む
0009BA DAB3 E5              11      PUSH    HL      ;Z:成功
0009BB DAB4 210100          10      LD  HL,1
0009BE DAB7 CD0ADA          17      CALL    S27
0009C1 DABA E1              10      POP HL
0009C2 DABB 3A0001          13      LD  A,(BUFFER)
0009C5 DABE C9              10      RET
                                
       DABF                     C_DEL:
0009C6 DABF CD0ADC          17      CALL    SETFCB
0009C9 DAC2 CD0EE3          17      CALL    _SYS08      ;(BDOS)エコーなしコンソール入力
                                
0009CC DAC5 0E13             7      LD  C,013H
0009CE DAC7 180A            12      JR  CDEL1       ;(BDOS)ファイルの削除
                                
       DAC9                     C_REN:
0009D0 DAC9 CD0ADC          17      CALL    SETFCB
0009D3 DACC 3E10             7      LD  A,010H      ;ディレクトリも対象にする
0009D5 DACE 326900          13      LD  (FCB1+13),A ;属性
0009D8 DAD1 0E17             7      LD  C,017H      ;(BDOS)ファイル名の変更
       DAD3                     CDEL1:
0009DA DAD3 115C00          10      LD  DE,FCB1
0009DD DAD6 CD0500          17      CALL    SYSTEM
0009E0 DAD9 C6FF             7      ADD A,0FFH
0009E2 DADB C9              10      RET
                                
       DADC                     C_DIR:
0009E3 DADC CD00F0          17      CALL    FILEC
0009E6 DADF 2115EE          10      LD  HL,FDRV+1
0009E9 DAE2 CD20DD          17      CALL    CWILD1
0009EC DAE5 3EF1             7      LD  A,0F1H
0009EE DAE7 3221EE          13      LD  (FDRV+13),A
0009F1 DAEA CDC3D9          17      CALL    OPEN1
       DAED                     CDIR1:
0009F4 DAED B7               4      OR  A
0009F5 DAEE 2008            12      JR  NZ,PDSKF
0009F7 DAF0 CD3BDB          17      CALL    P_NAME
0009FA DAF3 CDD5D9          17      CALL    OPEN2
0009FD DAF6 18F5            12      JR  CDIR1
       DAF8                     PDSKF:
0009FF DAF8 3A14EE          13      LD  A,(FDRV)
000A02 DAFB 5F               4      LD  E,A
000A03 DAFC 0E1B             7      LD  C,01BH      ;(BDOS)ディスク情報の獲得
000A05 DAFE CD0500          17      CALL    SYSTEM
000A08 DB01 4F               4      LD  C,A     ;C←1クラスタ辺りの論理セクタ数
000A09 DB02 C601             7      ADD A,001H
000A0B DB04 D8              11      RET C       ;Aが0FFHだった場合
000A0C DB05 3E06             7      LD  A,8-2
       DB07                     PDS1:               ;HL=未使用クラスタの総数
000A0E DB07 3C               4      INC A
000A0F DB08 CB19             8      RR  C
000A11 DB0A 30FB            12      JR  NC,PDS1
       DB0C                     PDS2:               ;B←論理セクタのサイズの上位8ビット
000A13 DB0C 3C               4      INC A
000A14 DB0D CB18             8      RR  B
000A16 DB0F 30FB            12      JR  NC,PDS2
000A18 DB11 47               4      LD  B,A
                                
000A19 DB12 110000          10      LD  DE,0
       DB15                     PDS3:
000A1C DB15 29              11      ADD HL,HL
000A1D DB16 EB               4      EX  DE,HL
000A1E DB17 ED6A            15      ADC HL,HL
000A20 DB19 EB               4      EX  DE,HL
000A21 DB1A 10F9            13      DJNZ    PDS3
       DB1C                     PDSKF1:
000A23 DB1C CDA8DB          17      CALL    PRDEC_DEHL
000A26 DB1F 11BFED          10      LD  DE,FREE
000A29 DB22 CDD0DD          17      CALL    _SYS09      ;(BDOS)文字列出力
000A2C DB25 CD95DB          17      CALL    PUTDRV
000A2F DB28 3E5C             7      LD  A,05CH      ;\
000A31 DB2A CDF8E2          17      CALL    MSG_A
000A34 DB2D 2A22EE          16      LD  HL,(FDRV+14)    ;ディレクトリのクラスタ番号
000A37 DB30 AF               4      XOR A
000A38 DB31 11FEFF          10      LD  DE,0-2
000A3B DB34 19              11      ADD HL,DE
000A3C DB35 23               6      INC HL
000A3D DB36 DCA5DB          17      CALL    C,PRDEC_HL
000A40 DB39 1833            12      JR  LTNL
                                
       DB3B                     P_NAME:
000A42 DB3B 3A6BED          13      LD  A,(DTA_CCP+1)
000A45 DB3E FE2E             7      CP  '.'
000A47 DB40 C8              11      RET Z
                                
000A48 DB41 3A76ED          13      LD  A,(DTA_CCP+1+00BH)
000A4B DB44 F5              11      PUSH    AF
000A4C DB45 CB67             8      BIT 4,A
000A4E DB47 2808            12      JR  Z,DIR3
000A50 DB49 11B4ED          10      LD  DE,DIRMES
000A53 DB4C CDD0DD          17      CALL    _SYS09      ;(BDOS)文字列出力
000A56 DB4F 180A            12      JR  DIR6
       DB51                     DIR3:
000A58 DB51 ED5B89ED        20      LD  DE,(DTA_CCP+1+01EH)
000A5C DB55 2A87ED          16      LD  HL,(DTA_CCP+1+01CH)
000A5F DB58 CDA8DB          17      CALL    PRDEC_DEHL
       DB5B                     DIR6:
000A62 DB5B F1              10      POP AF
000A63 DB5C 0F               4      RRCA
000A64 DB5D 9F               4      SBC A,A
000A65 DB5E E60A             7      AND '*'-020H
000A67 DB60 C620             7      ADD A,020H
000A69 DB62 CDF8E2          17      CALL    MSG_A
000A6C DB65 CD95DB          17      CALL    PUTDRV
000A6F DB68 216BED          10      LD  HL,DTA_CCP+1
000A72 DB6B CDE8DB          17      CALL    FPRNT
                                
       DB6E                     LTNL:
000A75 DB6E 1E03             7      LD  E,3
000A77 DB70 C3CDEE          10      JP  _PRINT
                                
       DB73                     C_PATH:
000A7A DB73 CDE1F0          17      CALL    SPCUT
000A7D DB76 212EED          10      LD  HL,PATHD
000A80 DB79 FE21             7      CP  021H
000A82 DB7B 300C            12      JR  NC,CPATH0
       DB7D                     CPATHP:
000A84 DB7D 7E               7      LD  A,(HL)
000A85 DB7E 23               6      INC HL
000A86 DB7F FE20             7      CP  020H
000A88 DB81 3F               4      CCF
000A89 DB82 30EA            12      JR  NC,LTNL
000A8B DB84 CDF8E2          17      CALL    MSG_A
000A8E DB87 18F4            12      JR  CPATHP
       DB89                     CPATH0:
000A90 DB89 FE3B             7      CP  ';'
000A92 DB8B 2001            12      JR  NZ,CPATH1
000A94 DB8D 13               6      INC DE
       DB8E                     CPATH1:
000A95 DB8E EB               4      EX  DE,HL
000A96 DB8F 013B00          10      LD  BC,PATHX
000A99 DB92 EDB0                    LDIR
000A9B DB94 C9              10      RET
                                
       DB95                     PUTDRV:
000A9C DB95 3A14EE          13      LD  A,(FDRV)
000A9F DB98 CD14F1          17      CALL    GETDRV1
000AA2 DB9B C641             7      ADD A,'A'
000AA4 DB9D CDF8E2          17      CALL    MSG_A
000AA7 DBA0 3E3A             7      LD  A,':'
       DBA2                     MSG_AR:
000AA9 DBA2 C3F8E2          10      JP  MSG_A
                                
       DBA5                     PRDEC_HL:
000AAC DBA5 AF               4      XOR A
000AAD DBA6 5F               4      LD  E,A
000AAE DBA7 57               4      LD  D,A
       DBA8                     PRDEC_DEHL:
000AAF DBA8 D5              11      PUSH    DE
000AB0 DBA9 110FEE          10      LD  DE,DECBF
000AB3 DBAC 0605             7      LD  B,5
000AB5 DBAE CD3FDC          17      CALL    ZERO_MEMORY_DE  ;A=0
000AB8 DBB1 D1              10      POP DE
                                
000AB9 DBB2 0E20             7      LD  C,32
       DBB4                     DEC1:
000ABB DBB4 29              11      ADD HL,HL
000ABC DBB5 EB               4      EX  DE,HL
000ABD DBB6 ED6A            15      ADC HL,HL
000ABF DBB8 EB               4      EX  DE,HL
000AC0 DBB9 E5              11      PUSH    HL
000AC1 DBBA 2113EE          10      LD  HL,DECBF+4
000AC4 DBBD 0605             7      LD  B,5
       DBBF                     DEC2:
000AC6 DBBF 7E               7      LD  A,(HL)
000AC7 DBC0 8F               4      ADC A,A
000AC8 DBC1 27               4      DAA
000AC9 DBC2 77               7      LD  (HL),A
000ACA DBC3 2B               6      DEC HL
000ACB DBC4 10F9            13      DJNZ    DEC2
000ACD DBC6 E1              10      POP HL
000ACE DBC7 0D               4      DEC C
000ACF DBC8 20EA            12      JR  NZ,DEC1
                                
000AD1 DBCA 210FEE          10      LD  HL,DECBF
000AD4 DBCD 3E20             7      LD  A,020H
000AD6 DBCF 0604             7      LD  B,4
       DBD1                     DEC3:
000AD8 DBD1 CDDEDB          17      CALL    DEC4
000ADB DBD4 CDDEDB          17      CALL    DEC4
000ADE DBD7 23               6      INC HL
000ADF DBD8 10F7            13      DJNZ    DEC3
       DBDA                     DECX:
000AE1 DBDA CDDEDB          17      CALL    DEC4
000AE4 DBDD AF               4      XOR A
       DBDE                     DEC4:
000AE5 DBDE ED6F            18      RLD
000AE7 DBE0 FE20             7      CP  020H
000AE9 DBE2 2802            12      JR  Z,DEC5
000AEB DBE4 F630             7      OR  030H
       DBE6                     DEC5:
000AED DBE6 18BA            12      JR  MSG_AR
                                
       DBE8                     FPRNT:
000AEF DBE8 0608             7      LD  B,8 ;ファイル名を表示
000AF1 DBEA CDF9DB          17      CALL    P_N1
000AF4 DBED 7E               7      LD  A,(HL)
000AF5 DBEE CD33F3          17      CALL    CAP3
000AF8 DBF1 D8              11      RET C   ;拡張子が無い
                                
000AF9 DBF2 3E2E             7      LD  A,'.'
000AFB DBF4 CDF8E2          17      CALL    MSG_A
000AFE DBF7 0603             7      LD  B,3 ;拡張子を表示
       DBF9                     P_N1:
000B00 DBF9 7E               7      LD  A,(HL)
000B01 DBFA CD33F3          17      CALL    CAP3
000B04 DBFD 3807            12      JR  C,P_N2
000B06 DBFF CDF8E2          17      CALL    MSG_A
000B09 DC02 23               6      INC HL
000B0A DC03 10F4            13      DJNZ    P_N1
000B0C DC05 C9              10      RET
       DC06                     P_N2:
000B0D DC06 23               6      INC HL
000B0E DC07 10FD            13      DJNZ    P_N2
000B10 DC09 C9              10      RET
                                
       DC0A                     SETFCB:
000B11 DC0A CDE1F0          17      CALL    SPCUT
000B14 DC0D 1A               7      LD  A,(DE)
000B15 DC0E FE20             7      CP  020H
000B17 DC10 3801            12      JR  C,SETFCBA
000B19 DC12 1B               6      DEC DE
       DC13                     SETFCBA:
000B1A DC13 0624             7      LD  B,36
000B1C DC15 215C00          10      LD  HL,FCB1
000B1F DC18 E5              11      PUSH    HL
000B20 DC19 AF               4      XOR A
000B21 DC1A CDB6F0          17      CALL    FILL_MEMORY
000B24 DC1D E1              10      POP HL
000B25 DC1E D5              11      PUSH    DE
000B26 DC1F CD09E0          17      CALL    _SYS29      ;(BDOS)ファイル名の解析
000B29 DC22 216C00          10      LD  HL,FCB2
000B2C DC25 CD09E0          17      CALL    _SYS29      ;(BDOS)ファイル名の解析
000B2F DC28 E1              10      POP HL
000B30 DC29 010050          10      LD  BC,05000H
000B33 DC2C 118100          10      LD  DE,00081H
       DC2F                     SETFCB1:
000B36 DC2F 7E               7      LD  A,(HL)
000B37 DC30 23               6      INC HL
000B38 DC31 FE20             7      CP  020H
000B3A DC33 3805            12      JR  C,SETFCB2
000B3C DC35 12               7      LD  (DE),A
000B3D DC36 13               6      INC DE
000B3E DC37 0C               4      INC C
000B3F DC38 10F5            13      DJNZ    SETFCB1
       DC3A                     SETFCB2:
000B41 DC3A 79               4      LD  A,C
000B42 DC3B 328000          13      LD  (DTA1),A
000B45 DC3E 04               4      INC B
       DC3F                     ZERO_MEMORY_DE:
000B46 DC3F AF               4      XOR A
       DC40                     FILL_MEMORY_DE:
000B47 DC40 12               7      LD  (DE),A
000B48 DC41 13               6      INC DE
000B49 DC42 10FC            13      DJNZ    FILL_MEMORY_DE
000B4B DC44 C9              10      RET
                                
       DC45                     C_COPY:
000B4C DC45 CD0ADC          17      CALL    SETFCB
                                
000B4F DC48 1161EE          10      LD  DE,ZERO
000B52 DC4B CD03F0          17      CALL    FILEC2
000B55 DC4E 216C00          10      LD  HL,FCB2
000B58 DC51 CD10E0          17      CALL    S29X1
                                
000B5B DC54 3E10             7      LD  A,010H
000B5D DC56 326900          13      LD  (FCB1+13),A
000B60 DC59 216D00          10      LD  HL,FCB2FN
000B63 DC5C CD20DD          17      CALL    CWILD1
       DC5F                     COPY0:
000B66 DC5F CD1DDD          17      CALL    CWILD
000B69 DC62 215C00          10      LD  HL,FCB1
000B6C DC65 CDC6D9          17      CALL    OPEN
000B6F DC68 37               4      SCF
       DC69                     COPY1:
000B70 DC69 C0              11      RET NZ
000B71 DC6A CDD9D9          17      CALL    DEFCB
                                
000B74 DC6D 3A77ED          13      LD  A,(DTA_CCP+13)
000B77 DC70 CB67             8      BIT 4,A
000B79 DC72 2821            12      JR  Z,COPY1A
                                
000B7B DC74 215D00          10      LD  HL,FCB1FN
000B7E DC77 CD46F4          17      CALL    CHKWILD
000B81 DC7A 3814            12      JR  C,COPY9
                                
000B83 DC7C 3E20             7      LD  A,020H
000B85 DC7E 325D00          13      LD  (FCB1FN),A
000B88 DC81 2A84ED          16      LD  HL,(DTA_CCP+26)
000B8B DC84 23               6      INC HL
000B8C DC85 226A00          16      LD  (FCB1+14),HL
000B8F DC88 18D5            12      JR  COPY0
                                
       DC8A                     COPY8:
000B91 DC8A CDD0DD          17      CALL    _SYS09      ;(BDOS)文字列出力
000B94 DC8D CD6EDB          17      CALL    LTNL
       DC90                     COPY9:
000B97 DC90 CDD5D9          17      CALL    OPEN2
000B9A DC93 18D4            12      JR  COPY1
                                
       DC95                     COPY1A:
000B9C DC95 216C00          10      LD  HL,FCB2
000B9F DC98 1114EE          10      LD  DE,FDRV
000BA2 DC9B 016CED          10      LD  BC,DTA_CCP+2
000BA5 DC9E EDA0            16      LDI
000BA7 DCA0 3E0B             7      LD  A,11
       DCA2                     COPY2:
000BA9 DCA2 F5              11      PUSH    AF
000BAA DCA3 7E               7      LD  A,(HL)
000BAB DCA4 FE3F             7      CP  '?'
000BAD DCA6 2001            12      JR  NZ,COPY3
000BAF DCA8 0A               7      LD  A,(BC)
       DCA9                     COPY3:
000BB0 DCA9 12               7      LD  (DE),A
000BB1 DCAA 03               6      INC BC
000BB2 DCAB 13               6      INC DE
000BB3 DCAC 23               6      INC HL
000BB4 DCAD F1              10      POP AF
000BB5 DCAE 3D               4      DEC A
000BB6 DCAF 20F1            12      JR  NZ,COPY2
000BB8 DCB1 010500          10      LD  BC,16-11
000BBB DCB4 EDB0                    LDIR
       DCB6                     PUTNAME:
000BBD DCB6 215D00          10      LD  HL,FCB1FN
000BC0 DCB9 CD46F4          17      CALL    CHKWILD
000BC3 DCBC 300B            12      JR  NC,PUTN1
000BC5 DCBE 2115EE          10      LD  HL,FDRV+1
000BC8 DCC1 CDE8DB          17      CALL    FPRNT
000BCB DCC4 3E20             7      LD  A,020H
000BCD DCC6 CDF8E2          17      CALL    MSG_A
       DCC9                     PUTN1:
000BD0 DCC9 1114EE          10      LD  DE,FDRV
000BD3 DCCC 0E16             7      LD  C,016H      ;(BDOS)ファイルの作成
000BD5 DCCE CDF4D9          17      CALL    SYSTEM0
000BD8 DCD1 2048            12      JR  NZ,COPYE2
000BDA DCD3 67               4      LD  H,A     ;A=0
000BDB DCD4 6F               4      LD  L,A
000BDC DCD5 2235EE          16      LD  (FDRV+33),HL    ;(FCB)ランダムレコード
000BDF DCD8 2237EE          16      LD  (FDRV+35),HL
       DCDB                     COPY6:
000BE2 DCDB CDFDD9          17      CALL    S27BUF
000BE5 DCDE 47               4      LD  B,A
000BE6 DCDF 3C               4      INC A
000BE7 DCE0 2831            12      JR  Z,COPYE
000BE9 DCE2 7C               4      LD  A,H
000BEA DCE3 B5               4      OR  L
000BEB DCE4 280C            12      JR  Z,COPY7
000BED DCE6 1114EE          10      LD  DE,FDRV
000BF0 DCE9 0E26             7      LD  C,026H      ;(BDOS)ランダムブロック書き込み
000BF2 DCEB CDF4D9          17      CALL    SYSTEM0
000BF5 DCEE 2023            12      JR  NZ,COPYE
000BF7 DCF0 10E9            13      DJNZ    COPY6
       DCF2                     COPY7:
000BF9 DCF2 3A77ED          13      LD  A,(DTA_CCP+13)  ;(FCB)属性
000BFC DCF5 3221EE          13      LD  (FDRV+13),A
000BFF DCF8 217EED          10      LD  HL,DTA_CCP+20   ;(FCB)タイムスタンプ
000C02 DCFB 1128EE          10      LD  DE,FDRV+20
000C05 DCFE 010400          10      LD  BC,4
000C08 DD01 EDB0                    LDIR
                                
000C0A DD03 1114EE          10      LD  DE,FDRV
000C0D DD06 0E10             7      LD  C,010H      ;(BDOS)ファイルのクローズ
000C0F DD08 CDF4D9          17      CALL    SYSTEM0
000C12 DD0B 2006            12      JR  NZ,COPYE
                                
000C14 DD0D 1171EE          10      LD  DE,OK
000C17 DD10 C38ADC          10      JP  COPY8
                                
       DD13                     COPYE:
000C1A DD13 1114EE          10      LD  DE,FDRV
000C1D DD16 0E13             7      LD  C,013H      ;(BDOS)ファイルの削除
000C1F DD18 CD0500          17      CALL    SYSTEM
       DD1B                     COPYE2:
000C22 DD1B 37               4      SCF
000C23 DD1C C9              10      RET
                                
       DD1D                     CWILD:
000C24 DD1D 215D00          10      LD  HL,FCB1FN
       DD20                     CWILD1:
000C27 DD20 7E               7      LD  A,(HL)
000C28 DD21 FE20             7      CP  020H
000C2A DD23 C0              11      RET NZ
       DD24                     CWILD2:
000C2B DD24 3E3F             7      LD  A,'?'
000C2D DD26 060B             7      LD  B,11
000C2F DD28 C3B6F0          10      JP  FILL_MEMORY
                                
       DD2B                     COMTB:
000C32 DD2B 44202020                DB  "D   "  ;1
000C36 DD2F DCDA                    DW  C_DIR
000C38 DD31 44495220                DB  "DIR "  ;2
000C3C DD35 DCDA                    DW  C_DIR
000C3E DD37 434F5059                DB  "COPY"  ;3
000C42 DD3B 45DC                    DW  C_COPY
000C44 DD3D 43442020                DB  "CD  "  ;4
000C48 DD41 F9D9                    DW  C_CD
000C4A DD43 44454C20                DB  "DEL "  ;5
000C4E DD47 BFDA                    DW  C_DEL
000C50 DD49 50415448                DB  "PATH"  ;6
000C54 DD4D 73DB                    DW  C_PATH
000C56 DD4F 52454E20                DB  "REN "  ;7
000C5A DD53 C9DA                    DW  C_REN
000C5C DD55 52454D20                DB  "REM "  ;8
000C60 DD59 CDDD                    DW  C_REM
[EOF:LDCCP.ASM:SHIFT_JIS]
                                    INCLUDE "88DISK2.ASM"
                                
                                ;   LSX-Dodgers DISK2
                                ;   PC-8801mkIISR
                                
                                ;   BANK RAM DISK DRIVER
                                
       DD5B                     BDWT:
000C62 DD5B 3E10             7      LD  A,010H  ;ライト可　リード不可
000C64 DD5D 1802            12  JR  BRW
                                
       DD5F                     BDRD:
000C66 DD5F 3E01             7      LD  A,001H  ;ライト不可　リード可
       DD61                     BRW:
000C68 DD61 F3               4      DI
000C69 DD62 D3E2            11      OUT (0E2H),A    ;拡張RAM リード/ライト制御
000C6B DD64 ED739BDD        20      LD  (BANKSP),SP
000C6F DD68 3A9CDD          13      LD  A,(BANKSPH)
000C72 DD6B 87               4      ADD A,A
000C73 DD6C 3803            12      JR  C,BRW1
000C75 DD6E 312EED          10      LD  SP,EXTSP    ;拡張メモリにスタックが重なる場合
       DD71                     BRW1:
000C78 DD71 C5              11      PUSH    BC
000C79 DD72 D5              11      PUSH    DE
000C7A DD73 EB               4      EX  DE,HL       ;DE=メインメモリ
000C7B DD74 29              11      ADD HL,HL
000C7C DD75 29              11      ADD HL,HL
000C7D DD76 7C               4      LD  A,H
000C7E DD77 DD860C          19      ADD A,(IX+DPB_MAXCYL)
000C81 DD7A D3E3            11      OUT (0E3H),A    ;拡張RAM バンク選択
000C83 DD7C 65               4      LD  H,L
000C84 DD7D CB3C             8      SRL H   ;/2
000C86 DD7F 2E00             7      LD  L,0
000C88 DD81 DBE2            11      IN  A,(0E2H)    ;拡張RAM リード/ライト制御
000C8A DD83 0F               4      RRCA
000C8B DD84 3001            12      JR  NC,BRW2     ;0: リード可
000C8D DD86 EB               4      EX  DE,HL       ;DE=拡張メモリ HL=メインメモリ
       DD87                     BRW2:
000C8E DD87 010002          10      LD  BC,512
000C91 DD8A EDB0                    LDIR
                                
000C93 DD8C DBE2            11      IN  A,(0E2H)    ;拡張RAM リード/ライト制御
000C95 DD8E 0F               4      RRCA
000C96 DD8F 3801            12      JR  C,BRW3      ;1: リード不可
000C98 DD91 EB               4      EX  DE,HL       ;DE=拡張メモリ HL=メインメモリ
       DD92                     BRW3:
000C99 DD92 D1              10      POP DE
000C9A DD93 C1              10      POP BC
000C9B DD94 13               6      INC DE
000C9C DD95 10DA            13      DJNZ    BRW1
                                
000C9E DD97 AF               4      XOR A
000C9F DD98 D3E2            11      OUT (0E2H),A    ;メインメモリに切り替える
000CA1 DD9A 310000          10      LD  SP,0
       DD9B                     BANKSP  EQU $-2
       DD9C                     BANKSPH EQU $-1
000CA4 DD9D FB               4      EI
000CA5 DD9E C9              10      RET
                                
[EOF:88DISK2.ASM:SHIFT_JIS]
                                    INCLUDE "LDOS.ASM"
                                
                                ;   LSX-Dodgers OS
                                
       DD9F                     BDOS0:
000CA6 DD9F E5              11      PUSH    HL
000CA7 DDA0 79               4      LD  A,C
000CA8 DDA1 FE3C             7      CP  03CH
000CAA DDA3 3802            12      JR  C,DOS1
000CAC DDA5 3E3C             7      LD  A,03CH
       DDA7                     DOS1:
000CAE DDA7 87               4      ADD A,A
000CAF DDA8 32ACDD          13      LD  (DOS1_SWC),A
000CB2 DDAB 2A00EF          16      LD  HL,(STABLE)
       DDAC                     DOS1_SWC    EQU $-2
000CB5 DDAE E3              19      EX  (SP),HL
000CB6 DDAF 79               4      LD  A,C
                                ;確認用
                                ;   LD  (0050H),A
000CB7 DDB0 C9              10      RET
       DDB1                     _DOS2:
000CB8 DDB1 FE5A             7      CP  05AH        ;(BDOS)カレントディレクトリの変更(_CHDIR)
000CBA DDB3 CA4BE0          10      JP  Z,_SYS5A
000CBD DDB6 FE5C             7      CP  05CH        ;(BDOS)ファイル名の解析(_PFILE)
000CBF DDB8 CA08E0          10      JP  Z,_SYS5C
000CC2 DDBB FE5F             7      CP  05FH        ;(BDOS)ディスクバッファのフラッシュ(_FLUSH)
000CC4 DDBD CA9DEA          10      JP  Z,_SYS5F
000CC7 DDC0 FE6F             7      CP  06FH        ;(BDOS)MSX-DOS のバージョン番号の獲得(_DOSVER)
000CC9 DDC2 200A            12      JR  NZ,_ERROR
000CCB DDC4 011D01          10      LD  BC,VER_6F
000CCE DDC7 116101          10      LD  DE,VER
000CD1 DDCA 210201          10      LD  HL,MACD
       DDCD                     C_REM:
000CD4 DDCD AF               4      XOR A
       DDCE                     _ERROR:
000CD5 DDCE A7               4      AND A
000CD6 DDCF C9              10      RET
                                
       DDD0                     _SYS09:     ;文字列出力
000CD7 DDD0 D5              11      PUSH    DE
       DDD1                     _SX09:
000CD8 DDD1 1A               7      LD  A,(DE)
000CD9 DDD2 13               6      INC DE
000CDA DDD3 FE24             7      CP  '$'
000CDC DDD5 2831            12      JR  Z,SX0E2
000CDE DDD7 CDF8E2          17      CALL    MSG_A
000CE1 DDDA 18F5            12      JR  _SX09
                                
       DDDC                     MSX1:
000CE3 DDDC CDF8E2          17      CALL    MSG_A
       DDDF                     MSX:
000CE6 DDDF 7E               7      LD  A,(HL)
000CE7 DDE0 23               6      INC HL
000CE8 DDE1 B7               4      OR  A
000CE9 DDE2 20F8            12      JR  NZ,MSX1
000CEB DDE4 C9              10      RET
                                
       DDE5                     _SYS0C:     ;(BDOS)バージョン番号の獲得
000CEC DDE5 212200          10      LD  HL,00022H
000CEF DDE8 7D               4      LD  A,L
000CF0 DDE9 C9              10      RET
                                
       DDEA                     _SYS0D:     ;(BDOS)ディスクリセット
000CF1 DDEA CDDFEE          17      CALL    _FFLUSH
000CF4 DDED E5              11      PUSH    HL
000CF5 DDEE 218000          10      LD  HL,00080H
000CF8 DDF1 228AEE          16      LD  (_DTA),HL
000CFB DDF4 E1              10      POP HL
000CFC DDF5 D5              11      PUSH    DE
000CFD DDF6 1E00             7      LD  E,0
000CFF DDF8 3E                      DB  03EH    ;次の PUSH DE をスキップ
                                
       DDF9                     _SYS0E:     ;(BDOS)カレントドライブの設定
000D00 DDF9 D5              11      PUSH    DE
000D01 DDFA 7B               4      LD  A,E
000D02 DDFB DDE5            15      PUSH    IX
000D04 DDFD CDDCEE          17      CALL    _GETDPB
000D07 DE00 DDE1            14      POP IX
000D09 DE02 3804            12      JR  C,SX0E2
000D0B DE04 7B               4      LD  A,E
000D0C DE05 320400          13      LD  (_DVSW),A
       DE08                     SX0E2:
000D0F DE08 D1              10      POP DE
000D10 DE09 C9              10      RET
                                
       DE0A                     _SYS0F:     ;(BDOS)ファイルのオープン
000D11 DE0A CDF3F0          17      CALL    SETDRV
000D14 DE0D FD7E1C          19      LD  A,(IY+28)   ;(FCB)オープンモード
000D17 DE10 C602             7      ADD A,002H      ;Write
000D19 DE12 2848            12      JR  Z,FEND0F
000D1B DE14 CD42F4          17      CALL    CHKWILDX
                                
000D1E DE17 D41DF1          17      CALL    NC,SOPENX
       DE1A                     _S16XX:
000D21 DE1A 3840            12      JR  C,FEND0F
                                                ;Directory location
000D23 DE1C 3A9FEE          13      LD  A,(_FILEN)
000D26 DE1F FD7719          19      LD  (IY+25),A   ;(FCB)ディレクトリロケーション
                                ;               _DIRF
000D29 DE22 3AA0EE          13      LD  A,(_DIRF)
000D2C DE25 FD771D          19      LD  (IY+29),A   ;(FCB)ディレクトリモード
                                ;               _FBPS
000D2F DE28 FD731E          19      LD  (IY+30),E   ;(FCB)ディレクトリポジション
000D32 DE2B FD721F          19      LD  (IY+31),D
                                ;               Open(Read)
000D35 DE2E FD361CFF        19      LD  (IY+28),0FFH    ;(FCB)オープンモード
                                ;               FILENAME
000D39 DE32 FDE5            15      PUSH    IY
000D3B DE34 D1              10      POP DE
000D3C DE35 13               6      INC DE
000D3D DE36 010B00          10      LD  BC,11
000D40 DE39 EDB0                    LDIR
                                ;               Attribute
000D42 DE3B 7E               7      LD  A,(HL)
000D43 DE3C FD770D          19      LD  (IY+13),A   ;(FCB)属性(アトリビュート)
000D46 DE3F 110B00          10      LD  DE,11       ;Reserved
000D49 DE42 19              11      ADD HL,DE
                                                    ;(FCB)ファイルを最後に変更した時刻
000D4A DE43 11E4EF          10      LD  DE,SDDATA       ;(FCB)ファイルを最後に変更した日付
000D4D DE46 060A             7      LD  B,SDDATAE-SDDATA    ;(FCB)ファイルの先頭クラスタ
       DE48                     S16LOOP:                ;(FCB)ファイルのサイズ(バイト単位)
000D4F DE48 1A               7      LD  A,(DE)
000D50 DE49 13               6      INC DE
000D51 DE4A 3251DE          13      LD  (S16PAT),A
000D54 DE4D 7E               7      LD  A,(HL)
000D55 DE4E 23               6      INC HL
000D56 DE4F FD7700          19      LD  (IY+0),A
       DE51                     S16PAT  EQU $-1
000D59 DE52 10F4            13      DJNZ    S16LOOP
                                
000D5B DE54 AF               4      XOR A
000D5C DE55 FD770C          19      LD  (IY+12),A   ;(FCB)カレントブロック
000D5F DE58 FD22F9DE        20      LD  (OFCB_SWC),IY
       DE5C                     FEND0F:
000D63 DE5C 1845            12      JR  FEND10
                                
       DE5E                     _SYS10:     ;(BDOS)ファイルのクローズ
000D65 DE5E CDF3F0          17      CALL    SETDRV
000D68 DE61 FD7E1C          19      LD  A,(IY+28)   ;(FCB)オープンモード
000D6B DE64 D6FE             7      SUB 0FEH
000D6D DE66 37               4      SCF
000D6E DE67 3F               4      CCF
000D6F DE68 2039            12      JR  NZ,FEND10
       DE6A                     _S10A:              ;Write
000D71 DE6A FD770E          19      LD  (IY+14),A   ;(FCB)レコードサイズ/アクセスするディレクトリのクラスタ番号+1
000D74 DE6D FD770F          19      LD  (IY+15),A
                                
000D77 DE70 FD341C          23      INC (IY+28)     ;(FCB)オープンモード 0FEH->0FFH
000D7A DE73 CD3EF5          17      CALL    SETTMS
                                
000D7D DE76 FD7E1D          19      LD  A,(IY+29)   ;(FCB)ディレクトリモード
000D80 DE79 32A0EE          13      LD  (_DIRF),A
000D83 DE7C E67F             7      AND 07FH
000D85 DE7E 32BDE7          13      LD  (_SECPS),A
000D88 DE81 FD5E1E          19      LD  E,(IY+30)   ;(FCB)ディレクトリポジション
000D8B DE84 FD561F          19      LD  D,(IY+31)
000D8E DE87 CD51F2          17      CALL    READ_DIR
000D91 DE8A 3817            12      JR  C,FEND10
                                
000D93 DE8C 3A7DF1          13  SDECM1: LD  A,(SDECPAT) ;1セクタ辺りのディレクトリエントリ数
000D96 DE8F 3D               4      DEC A       ;1024=01FH / 512=00FH / 256=7
000D97 DE90 FDA619          19      AND (IY+25)     ;(FCB)ディレクトリロケーション
000D9A DE93 6F               4      LD  L,A
000D9B DE94 2600             7      LD  H,0
000D9D DE96 29              11      ADD HL,HL       ;*2
000D9E DE97 29              11      ADD HL,HL       ;*4
000D9F DE98 29              11      ADD HL,HL       ;*8
000DA0 DE99 29              11      ADD HL,HL       ;*16
000DA1 DE9A 29              11      ADD HL,HL       ;*32
000DA2 DE9B ED4B7EEF        20      LD  BC,(_DTBUF)
000DA6 DE9F 09              11      ADD HL,BC
                                
000DA7 DEA0 CD52F4          17      CALL    SDIRENT
       DEA3                     FEND10:
000DAA DEA3 1842            12      JR  FEND
                                
       DEA5                     _SYS11:     ;(BDOS)最初のファイルの検索
000DAC DEA5 CDF3F0          17      CALL    SETDRV
000DAF DEA8 CD4CF1          17      CALL    SOPEN
       DEAB                     _S12X1:
000DB2 DEAB 383A            12      JR  C,FEND
000DB4 DEAD CDEBF1          17      CALL    SOPENE2
000DB7 DEB0 ED5B8AEE        20      LD  DE,(_DTA)
000DBB DEB4 3A88EE          13      LD  A,(_DRV)
000DBE DEB7 3C               4      INC A
000DBF DEB8 12               7      LD  (DE),A
000DC0 DEB9 D5              11      PUSH    DE
000DC1 DEBA 13               6      INC DE
000DC2 DEBB 012000          10      LD  BC,32
000DC5 DEBE EDB0                    LDIR
000DC7 DEC0 FD6E0E          19      LD  L,(IY+14)   ;(FCB)レコードサイズ/アクセスするディレクトリのクラスタ番号+1
000DCA DEC3 FD660F          19      LD  H,(IY+15)
000DCD DEC6 22F4EF          16      LD  (SCDIR),HL
000DD0 DEC9 2A9AEE          16      LD  HL,(_FBPS)
000DD3 DECC 22F6EF          16      LD  (SFBPS),HL
000DD6 DECF 2A9FEE          16      LD  HL,(_FILEN)
000DD9 DED2 7C               4      LD  A,H
000DDA DED3 B7               4      OR  A
000DDB DED4 2806            12      JR  Z,_S12DIR
000DDD DED6 3ABDE7          13      LD  A,(_SECPS)
000DE0 DED9 F680             7      OR  080H
000DE2 DEDB 67               4      LD  H,A
       DEDC                     _S12DIR:
000DE3 DEDC 22F8EF          16      LD  (SFNDF),HL  ;Directory position and Flags
000DE6 DEDF E1              10      POP HL
000DE7 DEE0 1139EE          10      LD  DE,SFILE
000DEA DEE3 0E21             7      LD  C,33
       DEE5                     _S11B:
000DEC DEE5 EDB0                    LDIR
       DEE7                     FEND:
000DEE DEE7 9F               4      SBC A,A     ;CF=0 A=0 : CF=1 A=0FFH
       DEE8                     FENDE:
000DEF DEE8 FDE1            14      POP IY
000DF1 DEEA C1              10      POP BC
000DF2 DEEB D1              10      POP DE
000DF3 DEEC E1              10      POP HL
000DF4 DEED C9              10      RET
                                
       DEEE                     _SYS12:     ;(BDOS)次のファイルの検索
000DF5 DEEE E5              11      PUSH    HL
000DF6 DEEF D5              11      PUSH    DE
000DF7 DEF0 C5              11      PUSH    BC
000DF8 DEF1 FDE5            15      PUSH    IY
000DFA DEF3 CDB0F1          17      CALL    NOPEN
000DFD DEF6 18B3            12      JR  _S12X1
                                
       DEF8                     _S16K:
000DFF DEF8 110000          10      LD  DE,0
       DEF9                     OFCB_SWC    EQU $-2
000E02 DEFB D5              11      PUSH    DE
000E03 DEFC 061A             7      LD  B,26        ;First cluster
       DEFE                     S16K1:
000E05 DEFE 13               6      INC DE
000E06 DEFF 23               6      INC HL
000E07 DF00 10FC            13      DJNZ    S16K1
                                
000E09 DF02 1A               7      LD  A,(DE)
000E0A DF03 BE               7      CP  (HL)
000E0B DF04 2015            12      JR  NZ,S16K2
000E0D DF06 13               6      INC DE
000E0E DF07 23               6      INC HL
000E0F DF08 1A               7      LD  A,(DE)
000E10 DF09 BE               7      CP  (HL)
000E11 DF0A 200F            12      JR  NZ,S16K2
                                
000E13 DF0C E1              10      POP HL
000E14 DF0D FDE5            15      PUSH    IY
000E16 DF0F D1              10      POP DE
000E17 DF10 7E               7      LD  A,(HL)
000E18 DF11 CD08F1          17      CALL    IS_SAME_DRV_A_DE
000E1B DF14 2006            12      JR  NZ,S16K3
                                                ;ここはCFが必ず0
000E1D DF16 ED52            15      SBC HL,DE       ;CP HL,DE
000E1F DF18 37               4      SCF
000E20 DF19 C0              11      RET NZ
000E21 DF1A E5              11      PUSH    HL
       DF1B                     S16K2:
000E22 DF1B E1              10      POP HL
       DF1C                     S16K3:
000E23 DF1C FDE5            15      PUSH    IY
000E25 DF1E D1              10      POP DE
       DF1F                     _SYS13:     ;(BDOS)ファイルの削除
000E26 DF1F CDF3F0          17      CALL    SETDRV
000E29 DF22 CD7AF3          17      CALL    KILL
       DF25                     FEND13:
000E2C DF25 18C0            12      JR  FEND
                                
       DF27                     _SYS14:     ;(BDOS)シーケンシャルな読み出し
000E2E DF27 CDF3F0          17      CALL    SETDRV
000E31 DF2A CD10E6          17      CALL    INIT_SEQ
       DF2D                     SREAD:
000E34 DF2D CDE2E5          17      CALL    RB_READ
                                
000E37 DF30 C601             7      ADD A,001H
000E39 DF32 38B3            12      JR  C,FEND
                                
000E3B DF34 7D               4      LD  A,L
000E3C DF35 D601             7      SUB 001H
       DF37                     FENDX:
000E3E DF37 9F               4      SBC A,A
000E3F DF38 E603             7      AND 3
000E41 DF3A 1F               4      RRA
000E42 DF3B 18AB            12      JR  FENDE
                                
       DF3D                     _SYS15:     ;(BDOS)シーケンシャルな書き込み
000E44 DF3D CDF3F0          17      CALL    SETDRV
000E47 DF40 CD10E6          17      CALL    INIT_SEQ
       DF43                     SWRITE:
000E4A DF43 CDDDE5          17      CALL    RB_WRITE
                                
000E4D DF46 C6FF             7      ADD A,0FFH
000E4F DF48 18ED            12      JR  FENDX
                                
       DF4A                     _SYS17:     ;(BDOS)ファイル名の変更
000E51 DF4A CDF3F0          17      CALL    SETDRV
000E54 DF4D CDD0F3          17      CALL    NAME
000E57 DF50 18D3            12      JR  FEND13
                                
       DF52                     _SYS16:     ;(BDOS)ファイルの作成
000E59 DF52 CDF3F0          17      CALL    SETDRV
                                
000E5C DF55 CD42F4          17      CALL    CHKWILDX
000E5F DF58 38CB            12      JR  C,FEND13
000E61 DF5A FD7E01          19      LD  A,(IY+1)    ;(FCB)主ファイル名
000E64 DF5D FE05             7      CP  5
000E66 DF5F 2805            12      JR  Z,_S16X2
000E68 DF61 FE21             7      CP  021H
000E6A DF63 DA25DF          10      JP  C,FEND13
       DF66                     _S16X2:
                                ;               Clear FCB
000E6D DF66 FDE5            15      PUSH    IY
000E6F DF68 E1              10      POP HL
000E70 DF69 011000          10      LD  BC,16
000E73 DF6C 09              11      ADD HL,BC
       DF6D                     _S16X1:
000E74 DF6D 70               7      LD  (HL),B      ;B=0
000E75 DF6E 23               6      INC HL
000E76 DF6F 0D               4      DEC C
000E77 DF70 20FB            12      JR  NZ,_S16X1
                                
000E79 DF72 CD43F5          17      CALL    SETTMSX
000E7C DF75 FD360DFF        19      LD  (IY+13),0FFH    ;(FCB)Attribute
000E80 DF79 CD1DF1          17      CALL    SOPENX
000E83 DF7C 3F               4      CCF
000E84 DF7D CCF8DE          17      CALL    Z,_S16K
000E87 DF80 D4FCF1          17      CALL    NC,COPEN
000E8A DF83 D452F4          17      CALL    NC,SDIRENT
000E8D DF86 C31ADE          10      JP  _S16XX
                                
       DF89                     _SYS21:     ;(BDOS)ランダムな読み出し
000E90 DF89 CDF3F0          17      CALL    SETDRV
000E93 DF8C CD8EF5          17      CALL    INIT_RND
000E96 DF8F 189C            12      JR  SREAD
                                
       DF91                     _SYS22:     ;(BDOS)ランダムな書き込み
       DF91                     _SYS28:     ;(BDOS)ランダムな書き込み・その2
000E98 DF91 CDF3F0          17      CALL    SETDRV
000E9B DF94 CD8EF5          17      CALL    INIT_RND
000E9E DF97 18AA            12      JR  SWRITE
                                
       DF99                     _SYS18:     ;(BDOS)ログインベクトルの獲得
000EA0 DF99 21FF00          10      LD  HL,000FFH
000EA3 DF9C AF               4      XOR A
000EA4 DF9D C9              10      RET
                                
       DF9E                     _SYS19:     ;(BDOS)カレントドライブ番号の獲得
000EA5 DF9E 3A0400          13      LD  A,(_DVSW)   ;from LDOS
000EA8 DFA1 A7               4      AND A
000EA9 DFA2 C9              10      RET
                                
       DFA3                     _SYS1A:     ;(BDOS)DTAの設定
000EAA DFA3 ED538AEE        20      LD  (_DTA),DE
000EAE DFA7 AF               4      XOR A
000EAF DFA8 C9              10      RET
                                
       DFA9                     _SYS1B:     ;(BDOS)ディスク情報の獲得
000EB0 DFA9 7B               4      LD  A,E
000EB1 DFAA CD01F1          17      CALL    GETDRV
000EB4 DFAD CDDCEE          17      CALL    _GETDPB
000EB7 DFB0 D4E2EE          17      CALL    NC,_RDFATX
000EBA DFB3 210000          10      LD  HL,0
000EBD DFB6 D41CF5          17      CALL    NC,DSKF
                                
000EC0 DFB9 ED5B1DF5        20      LD  DE,(MAXCLP) ;DPB_MAXCL-1
000EC4 DFBD 1B               6      DEC DE      ;DE←クラスタの総数
000EC5 DFBE FD2A7CEF        20      LD  IY,(_FATBF) ;IY←メモリ上のFATの先頭アドレス
000EC9 DFC2 9F               4      SBC A,A
000ECA DFC3 D8              11      RET C
000ECB DFC4 4F               4      LD  C,A     ;C=0
000ECC DFC5 DD7E0F          19      LD  A,(IX+DPB_BPS)
000ECF DFC8 E607             7      AND 7
000ED1 DFCA 47               4      LD  B,A
000ED2 DFCB DD7E07          19      LD  A,(IX+DPB_SECPCL)
000ED5 DFCE C9              10      RET
                                
       DFCF                     _SYS1D:     ;(BDOS)書き込みが禁止されているディスクの調査
000ED6 DFCF AF               4      XOR A
000ED7 DFD0 67               4      LD  H,A
000ED8 DFD1 6F               4      LD  L,A
000ED9 DFD2 C9              10      RET
                                
       DFD3                     _SYS1F:     ;(BDOS)ディスク装置のパラメータの読み出し
000EDA DFD3 2100F6          10      LD  HL,_DEVICE
000EDD DFD6 7B               4      LD  A,E
000EDE DFD7 C3DCEE          10      JP  _GETDPB
                                
       DFDA                     _SYS23:     ;(BDOS)ファイルサイズの獲得
000EE1 DFDA E5              11      PUSH    HL
000EE2 DFDB 0E0F             7      LD  C,00FH      ;(BDOS)ファイルのオープン
000EE4 DFDD CD9FDD          17      CALL    BDOS0
000EE7 DFE0 381B            12      JR  C,_S23X1
                                
000EE9 DFE2 D5              11      PUSH    DE      ;EX DE,IY
000EEA DFE3 FDE3            23      EX  (SP),IY     ;
                                ;   POP DE      ;
                                ;   PUSH    DE      ;DEを破壊しないように注意vv
000EEC DFE5 FD7E10          19      LD  A,(IY+16)   ;(FCB)ファイルのサイズ(バイト単位)
000EEF DFE8 FD6E11          19      LD  L,(IY+17)   ;
000EF2 DFEB FD6612          19      LD  H,(IY+18)   ;
000EF5 DFEE C5              11      PUSH    BC      ;
000EF6 DFEF FD4613          19      LD  B,(IY+19)   ;
000EF9 DFF2 CD80F5          17      CALL    GET_CPM_R_SIZE
000EFC DFF5 C1              10      POP BC
       DFF6                     _S24X1:
000EFD DFF6 CDA0F5          17      CALL    SET_RR_AHL
                                ;   POP DE      ;^^^^^^^^^^^^^^^^^^^^^^^^
                                ;   PUSH    DE      ;EX DE,IY
000F00 DFF9 FDE3            23      EX  (SP),IY     ;
000F02 DFFB D1              10      POP DE      ;
                                
000F03 DFFC AF               4      XOR A
       DFFD                     _S23X1:
000F04 DFFD E1              10      POP HL
000F05 DFFE C9              10      RET
                                
       DFFF                     _SYS24:     ;(BDOS)ランダムレコードフィールドの設定
000F06 DFFF E5              11      PUSH    HL
000F07 E000 D5              11      PUSH    DE      ;EX DE,IY
000F08 E001 FDE3            23      EX  (SP),IY     ;
                                ;   POP DE      ;
                                ;   PUSH    DE      ;DEを破壊しないように注意vv
000F0A E003 CD18E6          17      CALL    GETSEQ
000F0D E006 18EE            12      JR  _S24X1      ;^^^^^^^^^^^^^^^^^^^^^^^^
                                
       E008                     _SYS5C:     ;(BDOS)ファイル名の解析(_PFILE)
000F0F E008 2B               6      DEC HL
       E009                     _SYS29:     ;(BDOS)ファイル名の解析(_PPATH)
000F10 E009 C5              11      PUSH    BC
000F11 E00A E5              11      PUSH    HL
000F12 E00B CD0BF0          17      CALL    FILE
000F15 E00E E1              10      POP HL
000F16 E00F C1              10      POP BC
       E010                     S29X1:
000F17 E010 C5              11      PUSH    BC
000F18 E011 D5              11      PUSH    DE
000F19 E012 E5              11      PUSH    HL
000F1A E013 EB               4      EX  DE,HL
000F1B E014 AF               4      XOR A
000F1C E015 3221EE          13      LD  (FDRV+13),A
000F1F E018 2114EE          10      LD  HL,FDRV
000F22 E01B 011000          10      LD  BC,16
000F25 E01E EDB0                    LDIR
000F27 E020 E1              10      POP HL
000F28 E021 D1              10      POP DE
000F29 E022 C1              10      POP BC
000F2A E023 C9              10      RET
                                
       E024                     _SYS30:     ;(BDOS)論理セクタを用いた書き込み
000F2B E024 C5              11      PUSH    BC
000F2C E025 015EE9          10      LD  BC,DWT24B
000F2F E028 1804            12      JR  S2FX
       E02A                     _SYS2F:
000F31 E02A C5              11      PUSH    BC
000F32 E02B 0150E9          10      LD  BC,DRD24B
       E02E                     S2FX:
000F35 E02E ED4344E0        20      LD  (S2F_SWC),BC
000F39 E032 CDDFEE          17      CALL    _FFLUSH
                                
000F3C E035 D5              11      PUSH    DE
000F3D E036 E5              11      PUSH    HL
000F3E E037 7D               4      LD  A,L     ;Drive
000F3F E038 CDD9EE          17      CALL    _CHGDRV
000F42 E03B 3809            12      JR  C,POP_HL_DE_BC_SBCAA_RET
000F44 E03D 44               4      LD  B,H     ;Number of clusters
000F45 E03E 2A8AEE          16      LD  HL,(_DTA)
                                
000F48 E041 0E00             7      LD  C,0
000F4A E043 CD50E9          17      CALL    DRD24B
       E044                     S2F_SWC EQU $-2
       E046                     POP_HL_DE_BC_SBCAA_RET:
000F4D E046 E1              10      POP HL
000F4E E047 D1              10      POP DE
000F4F E048 C1              10      POP BC
000F50 E049 9F               4      SBC A,A
000F51 E04A C9              10      RET
                                
       E04B                     _SYS5A:     ;(BDOS)カレントディレクトリの変更
000F52 E04B C5              11      PUSH    BC
000F53 E04C D5              11      PUSH    DE
000F54 E04D E5              11      PUSH    HL
000F55 E04E CD00F0          17      CALL    FILEC
000F58 E051 2146E0          10      LD  HL,POP_HL_DE_BC_SBCAA_RET
000F5B E054 E5              11      PUSH    HL
000F5C E055 3A21EE          13      LD  A,(FDRV+13) ;(FCB)属性(アトリビュート))
000F5F E058 E610             7      AND 010H        ;ディレクトリ
000F61 E05A 37               4      SCF
000F62 E05B C8              11      RET Z
000F63 E05C 1114EE          10      LD  DE,FDRV
000F66 E05F 2A4EEF          16      LD  HL,(STABLE+2*027H)  ;(BDOS)ランダムブロック読み込み
       E062                     JPHL:
000F69 E062 E9               4      JP  (HL)
                                
       E063                     SHOW_ERROR:         ;(9)
000F6A E063 1179EE          10      LD  DE,COMERM
000F6D E066 CDD0DD          17      CALL    _SYS09      ;(BDOS)文字列出力
000F70 E069 C300EE          10      JP  CPM_BOOT
[EOF:LDOS.ASM:SHIFT_JIS]
                                    INCLUDE "88IO.ASM"
                                
                                ;   LSX-Dodgers IO
                                ;   PC-8801mkIISR
                                ;   割り込み処理は0F000Hより前にする
                                
       DDCE                     _SYS04  EQU _ERROR      ;(BDOS)外部出力
       DDCE                     _SYS05  EQU _ERROR      ;(BDOS)プリンタ出力
       DDCE                     _SYS1C  EQU _ERROR      ;(BDOS)ディスクの書き込み禁止化
       DDCE                     _SYS1E  EQU _ERROR      ;(BDOS)ファイル属性の設定
       DDCE                     _SYS20  EQU _ERROR      ;(BDOS)利用者番号の設定と読み出し
       DDCE                     _SYS2E  EQU _ERROR      ;(BDOS)ベリファイ・フラグの設定
                                
       0000                     INT EQU 0
       0000                     INTCTCE EQU 0
       0000                     INTCTC2 EQU 0
                                
       E06C                     BDOS_RF:
000F73 E06C DB32            11      IN  A,(032H)
000F75 E06E F610             7      OR  010H        ;高速RAMアクセスモード/メインRAM
000F77 E070 D332            11      OUT (032H),A
000F79 E072 C39FDD          10      JP  BDOS0
                                
       E075                     _SYS0A:     ;(BDOS)文字列入力
000F7C E075 C5              11      PUSH    BC
000F7D E076 E5              11      PUSH    HL
000F7E E077 D5              11      PUSH    DE
000F7F E078 CDAEE1          17      CALL    GETL
000F82 E07B 1120FF          10      LD  DE,KBUF
000F85 E07E E1              10      POP HL
000F86 E07F E5              11      PUSH    HL
000F87 E080 0E00             7      LD  C,0
000F89 E082 3004            12      JR  NC,SAX0
000F8B E084 23               6      INC HL
000F8C E085 23               6      INC HL
000F8D E086 1808            12      JR  SAX4
       E088                     SAX0:
000F8F E088 46               7      LD  B,(HL)
000F90 E089 23               6      INC HL
       E08A                     SAX1:
000F91 E08A 23               6      INC HL
000F92 E08B 1A               7      LD  A,(DE)
000F93 E08C 13               6      INC DE
000F94 E08D B7               4      OR  A
000F95 E08E 2004            12      JR  NZ,SAX2
       E090                     SAX4:
000F97 E090 360D            10      LD  (HL),00DH
000F99 E092 1804            12      JR  SAX3
       E094                     SAX2:
000F9B E094 77               7      LD  (HL),A
000F9C E095 0C               4      INC C
000F9D E096 10F2            13      DJNZ    SAX1
       E098                     SAX3:
000F9F E098 D1              10      POP DE
000FA0 E099 79               4      LD  A,C
000FA1 E09A 13               6      INC DE
000FA2 E09B 12               7      LD  (DE),A
000FA3 E09C 1B               6      DEC DE
000FA4 E09D E1              10      POP HL
000FA5 E09E C1              10      POP BC
000FA6 E09F A7               4      AND A
000FA7 E0A0 C9              10      RET
                                
       E0A1                     _SYS2A:     ;(BDOS)日付の獲得
000FA8 E0A1 C5              11      PUSH    BC
000FA9 E0A2 CDE1E0          17      CALL    RTCREAD
000FAC E0A5 3A62EE          13      LD  A,(RTC_YY)
000FAF E0A8 CD4CE3          17      CALL    BCD
000FB2 E0AB 6F               4      LD  L,A
000FB3 E0AC 2600             7      LD  H,0
                                ;   LD  DE,1900     ;0076CH
                                ;   CP  90      ;90以上は1900年代 1990-1999
                                ;   JR  NC,RDDATE1  ;90未満は2000年代 2000-2089
                                ;   LD  E,0D0H      ;2000 & 0FFH D=007H
000FB5 E0AE 11D007          10      LD  DE,2000     ;すべて2000年代で処理 2000-2099
       E0B1                     RDDATE1:
000FB8 E0B1 19              11      ADD HL,DE
000FB9 E0B2 3A63EE          13      LD  A,(RTC_MW)
000FBC E0B5 57               4      LD  D,A
000FBD E0B6 3A64EE          13      LD  A,(RTC_DD)
000FC0 E0B9 CD4CE3          17      CALL    BCD
000FC3 E0BC 5F               4      LD  E,A
000FC4 E0BD 7A               4      LD  A,D
000FC5 E0BE 0604             7      LD  B,4
       E0C0                     RDDATE2:
000FC7 E0C0 CB3A             8      SRL D
000FC9 E0C2 10FC            13      DJNZ    RDDATE2
000FCB E0C4 C1              10      POP BC
000FCC E0C5 E607             7      AND 7
000FCE E0C7 C9              10      RET
                                
       E0C8                     _SYS2C:     ;(BDOS)時刻の獲得
000FCF E0C8 C5              11      PUSH    BC
000FD0 E0C9 CDE1E0          17      CALL    RTCREAD
000FD3 E0CC 3A65EE          13      LD  A,(RTC_TT)
000FD6 E0CF CD4CE3          17      CALL    BCD
000FD9 E0D2 67               4      LD  H,A
000FDA E0D3 3A66EE          13      LD  A,(RTC_MM)
000FDD E0D6 CD4CE3          17      CALL    BCD
000FE0 E0D9 6F               4      LD  L,A
000FE1 E0DA 3A67EE          13      LD  A,(RTC_SS)
000FE4 E0DD 57               4      LD  D,A
000FE5 E0DE C1              10      POP BC
000FE6 E0DF AF               4      XOR A
000FE7 E0E0 C9              10      RET
                                
       E0E1                     RTCREAD:
000FE8 E0E1 0EF9             7      LD  C,0F9H
000FEA E0E3 3AB9EE          13      LD  A,(WK40)
000FED E0E6 5F               4      LD  E,A
000FEE E0E7 3E03             7      LD  A,3     ;コマンド３：タイムリードにセット
000FF0 E0E9 CD13E1          17      CALL    RTCCMD
000FF3 E0EC 3E01             7      LD  A,1     ;コマンド１：レジスタシフトにセット
000FF5 E0EE CD13E1          17      CALL    RTCCMD
000FF8 E0F1 0606             7      LD  B,6
000FFA E0F3 2167EE          10      LD  HL,RTC_SS
       E0F6                     RTCREAD1:
000FFD E0F6 C5              11      PUSH    BC
000FFE E0F7 0608             7      LD  B,8
       E0F9                     RTCREAD2:
001000 E0F9 DB40            11      IN  A,(40H)     ;システムモードセンス BIT4:CDI
001002 E0FB 87               4      ADD A,A
001003 E0FC 87               4      ADD A,A
001004 E0FD 87               4      ADD A,A
001005 E0FE 87               4      ADD A,A
001006 E0FF CB1E            15      RR  (HL)
001008 E101 CD38E1          17      CALL    RTCCLK
00100B E104 10F3            13      DJNZ    RTCREAD2
00100D E106 C1              10      POP BC
00100E E107 2B               6      DEC HL
00100F E108 10EC            13      DJNZ    RTCREAD1
001011 E10A AF               4      XOR A
001012 E10B CD13E1          17      CALL    RTCCMD
001015 E10E 7B               4      LD  A,E
001016 E10F 32B9EE          13      LD  (WK40),A
001019 E112 C9              10      RET
                                
       E113                     RTCCMD:
00101A E113 0604             7      LD  B,4
00101C E115 07               4      RLCA
00101D E116 07               4      RLCA
00101E E117 07               4      RLCA
       E118                     RTCCMD1:
00101F E118 F5              11      PUSH    AF
001020 E119 F607             7      OR  7
001022 E11B D310            11      OUT (10H),A     ;プリンタデータ出力 兼 カレンダクロック(μPD1990AC)出力
001024 E11D CD38E1          17      CALL    RTCCLK
001027 E120 F1              10      POP AF
001028 E121 0F               4      RRCA
001029 E122 10F4            13      DJNZ    RTCCMD1
00102B E124 3E07             7      LD  A,7
00102D E126 D310            11      OUT (10H),A     ;プリンタデータ出力 兼 カレンダクロック(μPD1990AC)出力
00102F E128 7B               4      LD  A,E
001030 E129 A1               4      AND C
001031 E12A F602             7      OR  2
001033 E12C D340            11      OUT (40H),A     ;ストローブポート
001035 E12E A1               4      AND C
001036 E12F 00               4      NOP
001037 E130 D340            11      OUT (40H),A     ;ストローブポート
001039 E132 5F               4      LD  E,A
00103A E133 060D             7      LD  B,13
       E135                     RTCCMD3:
00103C E135 10FE            13      DJNZ    RTCCMD3
00103E E137 C9              10      RET
                                
       E138                     RTCCLK:
00103F E138 7B               4      LD  A,E
001040 E139 A1               4      AND C
001041 E13A F604             7      OR  04H
001043 E13C D340            11      OUT (40H),A
001045 E13E A1               4      AND C
001046 E13F 00               4      NOP
001047 E140 D340            11      OUT (40H),A
001049 E142 5F               4      LD  E,A
00104A E143 C9              10      RET
                                
       E144                     PRINT:
00104B E144 DB32            11      IN  A,(032H)
00104D E146 F5              11      PUSH    AF
00104E E147 E6EF             7      AND 0EFH        ;高速RAMアクセスモード/高速RAM
001050 E149 D332            11      OUT (032H),A
001052 E14B C5              11      PUSH    BC
001053 E14C E5              11      PUSH    HL
001054 E14D 3E00             7      LD  A,000H      ;自己書き換え
       E14E                     ESCFLG  EQU $-1
001056 E14F B7               4      OR  A
001057 E150 C255F0          10      JP  NZ,ESC
                                
00105A E153 3E1F             7      LD  A,01FH
00105C E155 BB               4      CP  E
00105D E156 D278F0          10      JP  NC,CTRL
       E159                     INSFLG  EQU $
001060 E159 013AF1          10      LD  BC,INSERT   ;自己書き換え
       E15C                     ANK:
001063 E15C CD6AE1          17      CALL    LOC0
001066 E15F 73               7      LD  (HL),E
001067 E160 CD89F0          17      CALL    CTRL1C
       E163                     PRINTE5:
00106A E163 E1              10      POP HL
00106B E164 C1              10      POP BC
00106C E165 F1              10      POP AF
00106D E166 D332            11      OUT (032H),A
00106F E168 AF               4      XOR A
001070 E169 C9              10      RET
                                
       E16A                     LOC0:
001071 E16A 2A8EEE          16      LD  HL,(_TXADR) ;L=x H=y
       E16D                     LOC1:
001074 E16D D5              11      PUSH    DE
001075 E16E 7C               4      LD  A,H
001076 E16F CB15             8      RL  L
001078 E171 CB3C             8      SRL H   ;*128
00107A E173 CB1D             8      RR  L
                                
00107C E175 87               4      ADD A,A ;*2
00107D E176 87               4      ADD A,A ;*4
00107E E177 87               4      ADD A,A ;*8
00107F E178 5F               4      LD  E,A
001080 E179 7D               4      LD  A,L
001081 E17A 93               4      SUB E
001082 E17B 5F               4      LD  E,A
                                
001083 E17C 9F               4      SBC A,A
001084 E17D 84               4      ADD A,H
001085 E17E 57               4      LD  D,A
                                
001086 E17F 2AB2EE          16      LD  HL,(TVRAMTOP)
001089 E182 19              11      ADD HL,DE
00108A E183 D1              10      POP DE
00108B E184 C9              10      RET
                                
       E185                     CONOUT1:
00108C E185 59               4      LD  E,C
00108D E186 CDCDEE          17      CALL    _PRINT
001090 E189 7B               4      LD  A,E
001091 E18A FE0A             7      CP  00AH
001093 E18C 2006            12      JR  NZ,CURSOR_ON
001095 E18E CD0DF1          17      CALL    CTRL0D
001098 E191 CDF8F0          17      CALL    CTRL05
       E194                     CURSOR_ON:
00109B E194 F5              11      PUSH    AF
00109C E195 3E81             7      LD  A,081H
       E197                     CURSOR0:
00109E E197 D351            11      OUT (051H),A
0010A0 E199 3A8EEE          13      LD  A,(_TXADR)
0010A3 E19C D350            11      OUT (050H),A
0010A5 E19E 3A8FEE          13      LD  A,(_TXADR+1)
0010A8 E1A1 D350            11      OUT (050H),A
0010AA E1A3 F1              10      POP AF
0010AB E1A4 C9              10      RET
       E1A5                     CURSOR_OFF:
0010AC E1A5 F5              11      PUSH    AF
0010AD E1A6 3E80             7      LD  A,080H
0010AF E1A8 18ED            12      JR  CURSOR0
                                
       E1AA                     POS:
0010B1 E1AA 2A8EEE          16      LD  HL,(_TXADR)
0010B4 E1AD C9              10      RET
                                
       E1AE                     GETL:
0010B5 E1AE CDD3EE          17      CALL    _POS
0010B8 E1B1 E5              11      PUSH    HL
0010B9 E1B2 3ECD             7      LD  A,0CDH      ;CALL ????
0010BB E1B4 3259E1          13      LD  (INSFLG),A
       E1B7                     GETL1:
0010BE E1B7 CD0EE3          17      CALL    _SYS08
0010C1 E1BA FE09             7      CP  9
0010C3 E1BC 2008            12      JR  NZ,GETL1V
0010C5 E1BE 2120FF          10      LD  HL,KBUF
0010C8 E1C1 CDDFDD          17      CALL    MSX
0010CB E1C4 18F1            12      JR  GETL1
       E1C6                     GETL1V:
0010CD E1C6 5F               4      LD  E,A
0010CE E1C7 CDCDEE          17      CALL    _PRINT
                                
0010D1 E1CA 7B               4      LD  A,E
0010D2 E1CB FE0D             7      CP  00DH
0010D4 E1CD 20E8            12      JR  NZ,GETL1
0010D6 E1CF 3E01             7      LD  A,1     ;LD BC,????
0010D8 E1D1 3259E1          13      LD  (INSFLG),A
0010DB E1D4 1120FF          10      LD  DE,KBUF
0010DE E1D7 3AB1EE          13      LD  A,(_WIDTH)
0010E1 E1DA 47               4      LD  B,A
0010E2 E1DB CD3FDC          17      CALL    ZERO_MEMORY_DE
                                
0010E5 E1DE D1              10      POP DE
0010E6 E1DF CDD3EE          17      CALL    _POS
0010E9 E1E2 6B               4      LD  L,E
0010EA E1E3 3AB1EE          13      LD  A,(_WIDTH)
0010ED E1E6 95               4      SUB L
0010EE E1E7 57               4      LD  D,A
0010EF E1E8 CD6DE1          17      CALL    LOC1
0010F2 E1EB 4D               4      LD  C,L
0010F3 E1EC 7C               4      LD  A,H
0010F4 E1ED F630             7      OR  030H
0010F6 E1EF 47               4      LD  B,A
0010F7 E1F0 5A               4      LD  E,D
0010F8 E1F1 2120FF          10      LD  HL,KBUF
       E1F4                     GETL2:
0010FB E1F4 CDD0EE          17      CALL    _SCRN
0010FE E1F7 03               6      INC BC
0010FF E1F8 77               7      LD  (HL),A
001100 E1F9 23               6      INC HL
001101 E1FA 1D               4      DEC E
001102 E1FB 20F7            12      JR  NZ,GETL2
       E1FD                     GETL3:
001104 E1FD 2B               6      DEC HL
001105 E1FE 7E               7      LD  A,(HL)
001106 E1FF FE21             7      CP  021H
001108 E201 D0              11      RET NC
001109 E202 3600            10      LD  (HL),0
00110B E204 15               4      DEC D
00110C E205 20F6            12      JR  NZ,GETL3
00110E E207 C9              10      RET
                                
       E208                     INKEY:
00110F E208 FB               4      EI
001110 E209 E5              11      PUSH    HL
001111 E20A 2A90EE          16      LD  HL,(_KEYPS)
001114 E20D 7C               4      LD  A,H
001115 E20E AD               4      XOR L
001116 E20F 280C            12      JR  Z,INKEY1
001118 E211 7C               4      LD  A,H
001119 E212 3C               4      INC A
00111A E213 E61F             7      AND 01FH
00111C E215 3291EE          13      LD  (_KEYPS+1),A
00111F E218 6F               4      LD  L,A
001120 E219 26FF             7      LD  H,KEYBF/256
001122 E21B 7E               7      LD  A,(HL)
001123 E21C B7               4      OR  A
       E21D                     INKEY1:
001124 E21D E1              10      POP HL
001125 E21E C9              10      RET
                                
       E21F                     CHKEY:
001126 E21F C5              11      PUSH    BC
001127 E220 DB32            11      IN  A,(032H)
001129 E222 F5              11      PUSH    AF
00112A E223 E6EF             7      AND 0EFH        ;高速RAMアクセスモード/高速RAM
00112C E225 D332            11      OUT (032H),A
00112E E227 DB08            11      IN  A,(8)       ;6:SHIFT,7:CTRL
001130 E229 4F               4      LD  C,A
001131 E22A 3A0E00          13      LD  A,(00EH)
001134 E22D CB5F             8      BIT 3,A
001136 E22F 2002            12      JR  NZ,CHKEYRSHIFT
001138 E231 CBB1             8      RES 6,C
       E233                     CHKEYRSHIFT:
00113A E233 79               4      LD  A,C
00113B E234 3293EE          13      LD  (_KEYD+1),A
00113E E237 E5              11      PUSH    HL
00113F E238 0E00             7      LD  C,0
001141 E23A 21BFF1          10      LD  HL,KEY_TABLE
001144 E23D CB77             8      BIT 6,A
001146 E23F 2003            12      JR  NZ,CHKEY0
001148 E241 2127F2          10      LD  HL,SHIFT_TABLE
       E244                     CHKEY0:
00114B E244 CB7F             8      BIT 7,A
00114D E246 2003            12      JR  NZ,CHKEY1
00114F E248 218FF2          10      LD  HL,CTRL_TABLE
       E24B                     CHKEY1:
001152 E24B ED78            12      IN  A,(C)
001154 E24D 0608             7      LD  B,8
       E24F                     CHKEY2:
001156 E24F 0F               4      RRCA
001157 E250 300B            12      JR  NC,CHKEY4
       E252                     CHKEY3:
001159 E252 23               6      INC HL
00115A E253 10FA            13      DJNZ    CHKEY2
00115C E255 0C               4      INC C
00115D E256 79               4      LD  A,C
00115E E257 D60D             7      SUB 00DH
001160 E259 20F0            12      JR  NZ,CHKEY1
001162 E25B 1804            12      JR  CHKEY5
       E25D                     CHKEY4:
001164 E25D 7E               7      LD  A,(HL)
001165 E25E B7               4      OR  A
001166 E25F 28F1            12      JR  Z,CHKEY3
       E261                     CHKEY5:
001168 E261 E1              10      POP HL
001169 E262 C1              10      POP BC
00116A E263 4F               4      LD  C,A
00116B E264 78               4      LD  A,B
00116C E265 D332            11      OUT (032H),A
00116E E267 79               4      LD  A,C
00116F E268 C1              10      POP BC
001170 E269 B7               4      OR  A
001171 E26A 3292EE          13      LD  (_KEYD),A
001174 E26D C9              10      RET
                                
       E26E                     SCRN:
001175 E26E E5              11      PUSH    HL
001176 E26F DB32            11      IN  A,(032H)
001178 E271 67               4      LD  H,A
001179 E272 E6EF             7      AND 0EFH        ;高速RAMアクセスモード/高速RAM
00117B E274 D332            11      OUT (032H),A
00117D E276 0A               7      LD  A,(BC)
00117E E277 6F               4      LD  L,A
00117F E278 7C               4      LD  A,H
001180 E279 D332            11      OUT (032H),A
001182 E27B 7D               4      LD  A,L
001183 E27C E1              10      POP HL
001184 E27D C9              10      RET
                                
       E27E                     VBLANK:
001185 E27E F5              11      PUSH    AF
       E27F                     VBLANK0:
001186 E27F DB40            11      IN  A,(040H)
001188 E281 E620             7      AND 020H
00118A E283 20FA            12      JR  NZ,VBLANK0
       E285                     VBLANK1:
00118C E285 DB40            11      IN  A,(040H)
00118E E287 E620             7      AND 020H
001190 E289 28FA            12      JR  Z,VBLANK1
001192 E28B F1              10      POP AF
001193 E28C C9              10      RET
                                
       E28D                     INTVRTC:
001194 E28D F3               4      DI
001195 E28E F5              11      PUSH    AF
001196 E28F CD1FE2          17      CALL    CHKEY
001199 E292 FE00             7      CP  0
       E293                     KEYDT   EQU $-1
00119B E294 2028            12      JR  NZ,SETKEY1
00119D E296 E5              11      PUSH    HL
00119E E297 2A90EE          16      LD  HL,(_KEYPS)
0011A1 E29A 7C               4      LD  A,H
0011A2 E29B AD               4      XOR L
0011A3 E29C E1              10      POP HL
0011A4 E29D 2011            12      JR  NZ,ENDKEY
0011A6 E29F 3E00             7      LD  A,0
       E2A0                     KEYAR   EQU $-1
0011A8 E2A1 B7               4      OR  A
0011A9 E2A2 2014            12      JR  NZ,ARWKEY
       E2A4                     SETKEY:
0011AB E2A4 32A0E2          13      LD  (KEYAR),A
0011AE E2A7 3A92EE          13      LD  A,(_KEYD)
0011B1 E2AA 3293E2          13      LD  (KEYDT),A
0011B4 E2AD CDCBE2          17      CALL    KEYSET
       E2B0                     ENDKEY:
0011B7 E2B0 3AB7EE          13      LD  A,(WKE4)
0011BA E2B3 D3E4            11      OUT (0E4H),A
0011BC E2B5 F1              10      POP AF
0011BD E2B6 FB               4      EI
0011BE E2B7 C9              10      RET
       E2B8                     ARWKEY:
0011BF E2B8 3D               4      DEC A
0011C0 E2B9 32A0E2          13      LD  (KEYAR),A
0011C3 E2BC 18F2            12      JR  ENDKEY
       E2BE                     SETKEY1:
0011C5 E2BE 3A95EE          13      LD  A,(_KEYSP+1)
0011C8 E2C1 18E1            12      JR  SETKEY
                                
       E2C3                     INTE88:
0011CA E2C3 F5              11      PUSH    AF
0011CB E2C4 3AB7EE          13      LD  A,(WKE4)
0011CE E2C7 D3E4            11      OUT (0E4H),A
0011D0 E2C9 F1              10      POP AF
0011D1 E2CA C9              10      RET
       E2CB                     KEYSET:
       E2CB                     KEYBS:
0011D2 E2CB B7               4      OR  A
0011D3 E2CC C8              11      RET Z
       E2CD                     KEYBS1:
0011D4 E2CD CDE5E2          17      CALL    KEYBC_IFBREAK
0011D7 E2D0 E5              11      PUSH    HL
0011D8 E2D1 F5              11      PUSH    AF
0011D9 E2D2 2A90EE          16      LD  HL,(_KEYPS)
0011DC E2D5 2C               4      INC L
0011DD E2D6 CBAD             8      RES 5,L
0011DF E2D8 7D               4      LD  A,L
0011E0 E2D9 BC               4      CP  H
0011E1 E2DA 2815            12      JR  Z,POP_AF_HL_SCF_RET
0011E3 E2DC 3290EE          13      LD  (_KEYPS),A
0011E6 E2DF 26FF             7      LD  H,KEYBF/256
0011E8 E2E1 F1              10      POP AF
0011E9 E2E2 77               7      LD  (HL),A
0011EA E2E3 E1              10      POP HL
0011EB E2E4 C9              10      RET
       E2E5                     KEYBC_IFBREAK:
0011EC E2E5 FE03             7      CP  3
0011EE E2E7 C0              11      RET NZ
       E2E8                     KEYBC:
0011EF E2E8 E5              11      PUSH    HL
0011F0 E2E9 210000          10      LD  HL,0
0011F3 E2EC 2290EE          16      LD  (_KEYPS),HL
0011F6 E2EF E1              10      POP HL
0011F7 E2F0 C9              10      RET
                                
       E2F1                     POP_AF_HL_SCF_RET:
0011F8 E2F1 F1              10      POP AF
0011F9 E2F2 E1              10      POP HL
0011FA E2F3 37               4      SCF
0011FB E2F4 C9              10      RET
                                
       E2F5                     _SYS01:     ;(BDOS)コンソール入力
0011FC E2F5 CD09EE          17      CALL    _SYS07
       E2F8                     MSG_A:
0011FF E2F8 F5              11      PUSH    AF
001200 E2F9 D5              11      PUSH    DE
001201 E2FA 5F               4      LD  E,A
001202 E2FB CD01E3          17      CALL    _SYS02
001205 E2FE D1              10      POP DE
001206 E2FF F1              10      POP AF
001207 E300 C9              10      RET
                                
       E301                     _SYS02:     ;(BDOS)コンソール出力
001208 E301 CD13E3          17      CALL    BREAK
00120B E304 1805            12      JR  PRINTX
                                
       E306                     _SYS06:     ;(BDOS)コンソール直接入出力
00120D E306 7B               4      LD  A,E
00120E E307 3C               4      INC A
00120F E308 CACAEE          10      JP  Z,_INKEY
       E30B                     PRINTX:
001212 E30B C3CDEE          10      JP  _PRINT
                                
       E30E                     _SYS08:     ;(BDOS)エコーなしコンソール入力
001215 E30E CD09EE          17      CALL    _SYS07
001218 E311 1804            12      JR  BREAK1
       E313                     BREAK:
00121A E313 FB               4      EI
00121B E314 3A92EE          13      LD  A,(_KEYD)
       E317                     BREAK1:
00121E E317 FE03             7      CP  3       ;CTRL+C
001220 E319 CCF4EE          17      CALL    Z,_BREAK
001223 E31C FE13             7      CP  013H        ;CTRL+S
001225 E31E C0              11      RET NZ
                                
       E31F                     PAUSE:
001226 E31F CDE8E2          17      CALL    KEYBC
                                
       E322                     FLGET:
001229 E322 CDDFEE          17      CALL    _FFLUSH
00122C E325 E5              11      PUSH    HL
00122D E326 2A8EEE          16      LD  HL,(_TXADR)
001230 E329 CD94E1          17      CALL    CURSOR_ON
       E32C                     FLGET1:
001233 E32C CDCAEE          17      CALL    _INKEY
001236 E32F 28FB            12      JR  Z,FLGET1
001238 E331 CDA5E1          17      CALL    CURSOR_OFF
00123B E334 E1              10      POP HL
00123C E335 C9              10      RET
                                
       E336                     _SYS0B:     ;(BDOS)コンソール状態のチェック
00123D E336 CD13E3          17      CALL    BREAK
001240 E339 3A92EE          13      LD  A,(_KEYD)
001243 E33C B7               4      OR  A
001244 E33D C8              11      RET Z
       E33E                     CONSTX:
001245 E33E CDDFEE          17      CALL    _FFLUSH
001248 E341 E5              11      PUSH    HL
001249 E342 2A90EE          16      LD  HL,(_KEYPS)
00124C E345 7C               4      LD  A,H
00124D E346 AD               4      XOR L
00124E E347 E1              10      POP HL
00124F E348 C6FF             7      ADD A,0FFH
001251 E34A 9F               4      SBC A,A
001252 E34B C9              10      RET
                                
                                ;------------------------
                                ;BCDの10進数化
                                ;in
                                ;   A  : BCD
                                ;out
                                ;   A  : 10進数
                                ;------------------------
       E34C                     BCD:
001253 E34C 4F               4      LD  C,A
001254 E34D E6F0             7      AND 0F0H    ;10の位
001256 E34F 0F               4      RRCA
001257 E350 47               4      LD  B,A
001258 E351 0F               4      RRCA
001259 E352 0F               4      RRCA
00125A E353 80               4      ADD A,B
00125B E354 47               4      LD  B,A
00125C E355 79               4      LD  A,C
00125D E356 E60F             7      AND 00FH    ;1の位
00125F E358 80               4      ADD A,B
001260 E359 C9              10      RET
[EOF:88IO.ASM:SHIFT_JIS]
                                    INCLUDE "LDFILE2.ASM"
                                
                                ;   LSX-Dodgers FILE2
                                
                                                ;Write random block
       E35A                     _SYS26:     ;(BDOS)ランダムブロック書き込み
001261 E35A AF               4      XOR A
001262 E35B 3243E6          13      LD  (DRDN1),A   ;NOP
001265 E35E 22EAF5          16      LD  (RBSIZE),HL ;HL←書き込むレコード数
001268 E361 225DEE          16      LD  (LEFTX),HL
00126B E364 CDF3F0          17      CALL    SETDRV
                                
00126E E367 CDCDE4          17      CALL    RBX0
001271 E36A DAF7E3          10      JP  C,RBWERR
001274 E36D CD7CF4          17      CALL    WOPEN
001277 E370 DAF7E3          10      JP  C,RBWERR
00127A E373 7C               4      LD  A,H
00127B E374 B5               4      OR  L
00127C E375 CAF0E3          10      JP  Z,RBW1
                                
00127F E378 2B               6      DEC HL
                                
001280 E379 CDBBF5          17      CALL    GET_RR_BCDE ;BCDE=Random record
                                
001283 E37C 19              11      ADD HL,DE       ;BCHL=HL+BCDE
001284 E37D 3001            12      JR  NC,S26X1    ;
001286 E37F 03               6      INC BC      ;
       E380                     S26X1:
001287 E380 CDE7F4          17      CALL    RWXR
00128A E383 DC8DF4          17      CALL    C,WRDFX
00128D E386 DAF7E3          10      JP  C,RBWERR
                                
001290 E389 CDFCE4          17      CALL    RBX2
001293 E38C 281A            12      JR  Z,RBWB      ;NZ=セクタ以下の端数がある
001295 E38E CD1BE5          17      CALL    RBXA
001298 E391 3864            12      JR  C,RBWERR
00129A E393 EB               4      EX  DE,HL
00129B E394 C5              11      PUSH    BC
00129C E395 EDB0                    LDIR
00129E E397 225FEE          16      LD  (DTAX),HL
                                
0012A1 E39A CD1EF4          17      CALL    WTDB        ;バッファデータは更新された
                                
0012A4 E39D 2A5DEE          16      LD  HL,(LEFTX)
0012A7 E3A0 D1              10      POP DE
0012A8 E3A1 ED52            15      SBC HL,DE
0012AA E3A3 225DEE          16      LD  (LEFTX),HL
0012AD E3A6 2831            12      JR  Z,RBWEND
                                
       E3A8                     RBWB:
0012AF E3A8 CD50E5          17      CALL    RBXB
0012B2 E3AB 2814            12      JR  Z,RBWC
       E3AD                     RBWB1:
0012B4 E3AD C5              11      PUSH    BC
0012B5 E3AE D5              11      PUSH    DE
0012B6 E3AF CDFBF2          17      CALL    CLUSTX
0012B9 E3B2 CD74E5          17      CALL    DWTC
0012BC E3B5 D1              10      POP DE
0012BD E3B6 C1              10      POP BC
0012BE E3B7 D4C5E7          17      CALL    NC,GNCLX
0012C1 E3BA 383B            12      JR  C,RBWERR
0012C3 E3BC 10EF            13      DJNZ    RBWB1
0012C5 E3BE CDC4E5          17      CALL    DRW_FLUSH
       E3C1                     RBWC:
0012C8 E3C1 CD68E5          17      CALL    RBXC
0012CB E3C4 2813            12      JR  Z,RBWEND
0012CD E3C6 C5              11      PUSH    BC
0012CE E3C7 CDFBF2          17      CALL    CLUSTX
0012D1 E3CA CD42E6          17      CALL    DRDN
0012D4 E3CD C1              10      POP BC
0012D5 E3CE 3827            12      JR  C,RBWERR
0012D7 E3D0 ED5B7EEF        20      LD  DE,(_DTBUF)
0012DB E3D4 EDB0                    LDIR
0012DD E3D6 CD1EF4          17      CALL    WTDB        ;バッファデータは更新された
       E3D9                     RBWEND:
0012E0 E3D9 CDE9F5          17      CALL    RBXEND
                                
0012E3 E3DC CDDCE4          17      CALL    RBX1
0012E6 E3DF 300F            12      JR  NC,RBW1     ;ランダムレコードの方が大きい場合はサイズを合わせる
0012E8 E3E1 CDBBF5          17      CALL    GET_RR_BCDE ;BCDE=Random record
0012EB E3E4 FD7310          19      LD  (IY+16),E   ;ファイルのサイズ(バイト単位)
0012EE E3E7 FD7211          19      LD  (IY+17),D   ;
0012F1 E3EA FD7112          19      LD  (IY+18),C   ;
0012F4 E3ED FD7013          19      LD  (IY+19),B   ;
       E3F0                     RBW1:
0012F7 E3F0 FDE1            14      POP IY
0012F9 E3F2 C1              10      POP BC
0012FA E3F3 D1              10      POP DE
0012FB E3F4 E1              10      POP HL
       E3F5                     DD_NUL:
0012FC E3F5 AF               4      XOR A
       E3F6                     DRDF0:
       E3F6                     DWTF0:
0012FD E3F6 C9              10      RET
                                
       E3F7                     RBWERR:
0012FE E3F7 FDE5            15      PUSH    IY
001300 E3F9 D1              10      POP DE
001301 E3FA 0E10             7      LD  C,010H      ;(BDOS)ファイルのクローズ
001303 E3FC CD9FDD          17      CALL    BDOS0
       E3FF                     RBRERR1:
001306 E3FF 3E01             7      LD  A,001H
       E401                     RBRERR2:
001308 E401 FDE1            14      POP IY
00130A E403 C1              10      POP BC
00130B E404 D1              10      POP DE
00130C E405 E1              10      POP HL
00130D E406 37               4      SCF
00130E E407 210000          10      LD  HL,0
001311 E40A C9              10      RET
                                
       E40B                     RBRERR:
001312 E40B 3EFF             7      LD  A,0FFH
001314 E40D 18F2            12      JR  RBRERR2
                                
       E40F                     RBRFL:
001316 E40F 3E00             7  RBRFLP: LD  A,000H
001318 E411 FE0D             7      CP  00DH
00131A E413 2005            12      JR  NZ,RBRFL1
00131C E415 D5              11      PUSH    DE
00131D E416 1E0A             7      LD  E,00AH
00131F E418 1805            12      JR  RBRFL2
       E41A                     RBRFL1:
001321 E41A D5              11      PUSH    DE
001322 E41B CD09EE          17      CALL    _SYS07
001325 E41E 5F               4      LD  E,A
       E41F                     RBRFL2:
001326 E41F CDCDEE          17      CALL    _PRINT
001329 E422 7B               4      LD  A,E
00132A E423 D1              10      POP DE
00132B E424 3210E4          13      LD  (RBRFLP+1),A
00132E E427 C9              10      RET
                                
                                                ;Read random block
       E428                     _SYS27:     ;(BDOS)ランダムブロック読み込み
00132F E428 225DEE          16      LD  (LEFTX),HL
001332 E42B CDF3F0          17      CALL    SETDRV
                                
001335 E42E FDCB0D66        20      BIT 4,(IY+13)   ;(FCB)属性(アトリビュート)
001339 E432 C2BBE4          10      JP  NZ,RBRDIR   ;ディレクトリ
00133C E435 CDCDE4          17      CALL    RBX0
00133F E438 DA0BE4          10      JP  C,RBRERR
001342 E43B CDDCE4          17      CALL    RBX1
001345 E43E D4F4E4          17      CALL    NC,RBX1R
001348 E441 DAFFE3          10      JP  C,RBRERR1
00134B E444 EB               4      EX  DE,HL
00134C E445 ED52            15      SBC HL,DE       ;CP 00HL,BCDE
00134E E447 19              11      ADD HL,DE
00134F E448 79               4      LD  A,C
001350 E449 DE00             7      SBC A,0
001352 E44B 78               4      LD  A,B
001353 E44C DE00             7      SBC A,0
001355 E44E 3801            12      JR  C,RBR1
001357 E450 EB               4      EX  DE,HL
       E451                     RBR1:
001358 E451 9F               4      SBC A,A
001359 E452 E601             7      AND 1
00135B E454 32B9E4          13      LD  (RBRA_SWC),A
                                
00135E E457 7C               4      LD  A,H
00135F E458 B5               4      OR  L
001360 E459 2857            12      JR  Z,RBREND0
                                
001362 E45B 22EAF5          16      LD  (RBSIZE),HL ;HL←読み込むレコード数
001365 E45E 225DEE          16      LD  (LEFTX),HL
                                
001368 E461 CDFCE4          17      CALL    RBX2
00136B E464 2819            12      JR  Z,RBRB
00136D E466 CD1BE5          17      CALL    RBXA
001370 E469 DA0BE4          10      JP  C,RBRERR
001373 E46C C5              11      PUSH    BC
001374 E46D EDB0                    LDIR
001376 E46F ED535FEE        20      LD  (DTAX),DE
00137A E473 2A5DEE          16      LD  HL,(LEFTX)
00137D E476 D1              10      POP DE
00137E E477 A7               4      AND A
00137F E478 ED52            15      SBC HL,DE
001381 E47A 225DEE          16      LD  (LEFTX),HL
001384 E47D 2830            12      JR  Z,RBREND
                                
       E47F                     RBRB:
001386 E47F CD50E5          17      CALL    RBXB
001389 E482 2815            12      JR  Z,RBRC
       E484                     RBRB1:
00138B E484 C5              11      PUSH    BC
00138C E485 D5              11      PUSH    DE
00138D E486 CDFBF2          17      CALL    CLUSTX
001390 E489 CD7AE5          17      CALL    DRDC
001393 E48C D1              10      POP DE
001394 E48D C1              10      POP BC
001395 E48E D4C5E7          17      CALL    NC,GNCLX
001398 E491 DA0BE4          10      JP  C,RBRERR
00139B E494 10EE            13      DJNZ    RBRB1
00139D E496 CDC4E5          17      CALL    DRW_FLUSH
       E499                     RBRC:
0013A0 E499 CD68E5          17      CALL    RBXC
0013A3 E49C 2811            12      JR  Z,RBREND
0013A5 E49E C5              11      PUSH    BC
0013A6 E49F CDFBF2          17      CALL    CLUSTX
0013A9 E4A2 CD26E6          17      CALL    DRDX
0013AC E4A5 C1              10      POP BC
0013AD E4A6 DA0BE4          10      JP  C,RBRERR
0013B0 E4A9 EB               4      EX  DE,HL
0013B1 E4AA 2A7EEF          16      LD  HL,(_DTBUF)
0013B4 E4AD EDB0                    LDIR
       E4AF                     RBREND:
0013B6 E4AF CDE9F5          17      CALL    RBXEND
       E4B2                     RBREND0:
0013B9 E4B2 FDE1            14      POP IY
0013BB E4B4 C1              10      POP BC
0013BC E4B5 D1              10      POP DE
0013BD E4B6 F1              10      POP AF  ;(HL)
0013BE E4B7 AF               4      XOR A
0013BF E4B8 3E00             7      LD  A,000H
       E4B9                     RBRA_SWC    EQU $-1
0013C1 E4BA C9              10      RET
                                
       E4BB                     RBRDIR:
0013C2 E4BB FD6E1A          19      LD  L,(IY+26)   ;(FCB)ファイルの先頭クラスタ
0013C5 E4BE FD661B          19      LD  H,(IY+27)
0013C8 E4C1 CD3AF3          17      CALL    CHDIR
0013CB E4C4 AF               4      XOR A
0013CC E4C5 67               4      LD  H,A
0013CD E4C6 6F               4      LD  L,A
0013CE E4C7 3C               4      INC A
0013CF E4C8 32B9E4          13      LD  (RBRA_SWC),A
0013D2 E4CB 18E5            12      JR  RBREND0
                                ;(15)
       E4CD                     RBX0:
0013D4 E4CD 2A8AEE          16      LD  HL,(_DTA)
0013D7 E4D0 225FEE          16      LD  (DTAX),HL
0013DA E4D3 2A5DEE          16      LD  HL,(LEFTX)
0013DD E4D6 FD7E1C          19      LD  A,(IY+28)   ;(FCB)オープンモード
0013E0 E4D9 D6FD             7      SUB 0FDH
0013E2 E4DB C9              10      RET
                                
       E4DC                     RBX1:               ;ファイルサイズとランダムレコードを比べる
0013E3 E4DC E5              11      PUSH    HL      ;Record byte
                                                ;AHL=File size
0013E4 E4DD FD6E10          19      LD  L,(IY+16)   ;ファイルのサイズ(バイト単位)
0013E7 E4E0 FD6611          19      LD  H,(IY+17)   ;
0013EA E4E3 FD7E12          19      LD  A,(IY+18)   ;
                                
0013ED E4E6 CDBBF5          17      CALL    GET_RR_BCDE ;BCDE=Random record
                                
0013F0 E4E9 A7               4      AND A
0013F1 E4EA ED52            15      SBC HL,DE
0013F3 E4EC 99               4      SBC A,C
0013F4 E4ED 4F               4      LD  C,A
0013F5 E4EE FD7E13          19      LD  A,(IY+19)   ;ファイルのサイズ
0013F8 E4F1 98               4      SBC A,B
0013F9 E4F2 D1              10      POP DE
0013FA E4F3 C9              10      RET
       E4F4                     RBX1R:              ;(8)
0013FB E4F4 47               4      LD  B,A
0013FC E4F5 B1               4      OR  C
0013FD E4F6 EB               4      EX  DE,HL   ;BCDE=File byte HL=Record byte
0013FE E4F7 B2               4      OR  D
0013FF E4F8 B3               4      OR  E
001400 E4F9 C0              11      RET NZ
001401 E4FA 37               4      SCF
001402 E4FB C9              10      RET
                                
       E4FC                     RBX2:               ;Cluster settings
001403 E4FC FD6622          19      LD  H,(IY+34)   ;(+33)(FCB)ランダムレコード
001406 E4FF FD4E23          19      LD  C,(IY+35)
001409 E502 0600             7      LD  B,0
00140B E504 FDCB207E        20      BIT 7,(IY+32)   ;(FCB)カレントレコード
00140F E508 2003            12      JR  NZ,RBX3
001411 E50A FD4624          19      LD  B,(IY+36)
       E50D                     RBX3:
001414 E50D CDE7F4          17      CALL    RWXR
001417 E510 3A32E5          13      LD  A,(SECSZ_H) ;1024=4 / 512=2 / 256=1
00141A E513 3D               4      DEC A
00141B E514 FDA622          19      AND (IY+34)
00141E E517 FDB621          19      OR  (IY+33)
001421 E51A C9              10      RET
                                
       E51B                     RBXA:
001422 E51B C5              11      PUSH    BC
001423 E51C D5              11      PUSH    DE
001424 E51D CDFBF2          17      CALL    CLUSTX
001427 E520 CD26E6          17      CALL    DRDX
00142A E523 D1              10      POP DE
00142B E524 C1              10      POP BC
00142C E525 D4C5E7          17      CALL    NC,GNCLX
00142F E528 D8              11      RET C
001430 E529 ED53FEEF        20      LD  (_CLPS),DE
                                
001434 E52D FD4E21          19      LD  C,(IY+33)   ;(FCB)ランダムレコード
001437 E530 210004          10      LD  HL,0400H    ;自己書き換え 1024=0400H / 512=0200H ここに1セクタのサイズが格納される
       E531                     SECSZ   EQU $-2
       E532                     SECSZ_H EQU $-1
00143A E533 7C               4      LD  A,H
00143B E534 3D               4      DEC A       ;1024=3 / 512=1
00143C E535 FDA622          19      AND (IY+34)     ;(FCB)ランダムレコード
00143F E538 47               4      LD  B,A     ;BCに1セクタ以下の端数が入る
001440 E539 ED42            15      SBC HL,BC       ;残りを計算
                                
001442 E53B ED5B5DEE        20      LD  DE,(LEFTX)
001446 E53F ED52            15      SBC HL,DE       ;CP HL,DE
001448 E541 19              11      ADD HL,DE       ;
001449 E542 3801            12      JR  C,RBXA1     ;DEとHLを比較して大きい方をHLに
00144B E544 EB               4      EX  DE,HL
       E545                     RBXA1:
00144C E545 E5              11      PUSH    HL
00144D E546 2A7EEF          16      LD  HL,(_DTBUF)
001450 E549 09              11      ADD HL,BC
001451 E54A ED5B5FEE        20      LD  DE,(DTAX)
001455 E54E C1              10      POP BC
001456 E54F C9              10      RET
                                
       E550                     RBXB:
001457 E550 2A5FEE          16      LD  HL,(DTAX)
00145A E553 ED5BFEEF        20      LD  DE,(_CLPS)
00145E E557 3A5EEE          13      LD  A,(LEFTX+1)
001461 E55A 47               4      LD  B,A
001462 E55B 3A32E5          13      LD  A,(SECSZ_H) ;1024=4 / 512=2 / 256=1
       E55E                     RBXB1:
001465 E55E 1F               4      RRA     ;->CF
001466 E55F 3804            12      JR  C,RBXB2
001468 E561 CB38             8      SRL B   ;B=B/2
00146A E563 18F9            12      JR  RBXB1
       E565                     RBXB2:
00146C E565 78               4      LD  A,B
00146D E566 B7               4      OR  A
00146E E567 C9              10      RET
                                ;(12)
       E568                     RBXC:
00146F E568 ED4B5DEE        20      LD  BC,(LEFTX)
001473 E56C 3A32E5          13      LD  A,(SECSZ_H) ;1024=4 / 512=2 / 256=1
001476 E56F 3D               4      DEC A
001477 E570 A0               4      AND B
001478 E571 47               4      LD  B,A     ;1セクタ以下の端数がない場合はZ
001479 E572 B1               4      OR  C
00147A E573 C9              10      RET
                                
                                ;   ランダムブロックアクセスの連続したセクタをまとめる
                                
       E574                     DWTC:
00147B E574 E5              11      PUSH    HL
00147C E575 215EE9          10      LD  HL,DWT24B
00147F E578 1804            12      JR  DWTC1
       E57A                     DRDC:
001481 E57A E5              11      PUSH    HL
001482 E57B 2150E9          10      LD  HL,DRD24B
       E57E                     DWTC1:
001485 E57E 22D8E5          16      LD  (DRWF_MODE),HL
001488 E581 E1              10      POP HL
001489 E582 3AC8E5          13      LD  A,(DRWF_B)
00148C E585 B7               4      OR  A
00148D E586 200F            12      JR  NZ,DRDC1
       E588                     SAVE_DRWC:
00148F E588 0601             7      LD  B,1
001491 E58A ED43C7E5        20      LD  (DRWF_C),BC
001495 E58E ED53CEE5        20      LD  (DRWF_E),DE
001499 E592 22D1E5          16      LD  (DRWF_HL),HL
00149C E595 1820            12      JR  INC_HL_DRWC
       E597                     DRDC1:
00149E E597 E5              11      PUSH    HL
00149F E598 21CEE5          10      LD  HL,DRWF_E
0014A2 E59B 86               7      ADD A,(HL)
0014A3 E59C F5              11      PUSH    AF
0014A4 E59D BB               4      CP  E
0014A5 E59E 201D            12      JR  NZ,DRDC2
0014A7 E5A0 F1              10      POP AF
0014A8 E5A1 23               6      INC HL
0014A9 E5A2 7E               7      LD  A,(HL)
0014AA E5A3 CE00             7      ADC A,0
0014AC E5A5 F5              11      PUSH    AF
0014AD E5A6 BA               4      CP  D
0014AE E5A7 2014            12      JR  NZ,DRDC2
0014B0 E5A9 F1              10      POP AF
0014B1 E5AA 3AC7E5          13      LD  A,(DRWF_C)
0014B4 E5AD CE00             7      ADC A,0
0014B6 E5AF B9               4      CP  C
0014B7 E5B0 200C            12      JR  NZ,DRDC3
0014B9 E5B2 21C8E5          10      LD  HL,DRWF_B
0014BC E5B5 34              11      INC (HL)
0014BD E5B6 E1              10      POP HL
       E5B7                     INC_HL_DRWC:
0014BE E5B7 3A32E5          13      LD  A,(SECSZ_H)     ;1セクタのサイズの上位1バイト
0014C1 E5BA 84               4      ADD A,H
0014C2 E5BB 67               4      LD  H,A
0014C3 E5BC C9              10      RET
       E5BD                     DRDC2:
0014C4 E5BD F1              10      POP AF
       E5BE                     DRDC3:
0014C5 E5BE CDC4E5          17      CALL    DRW_FLUSH
0014C8 E5C1 E1              10      POP HL
0014C9 E5C2 18C4            12      JR  SAVE_DRWC
                                
                                ;   ランダムブロックアクセスの連続したセクタをまとめたものをフラッシュする
       E5C4                     DRW_FLUSH:
0014CB E5C4 C5              11      PUSH    BC
0014CC E5C5 D5              11      PUSH    DE
0014CD E5C6 010000          10      LD  BC,0
       E5C7                     DRWF_C  EQU $-2
       E5C8                     DRWF_B  EQU $-1
0014D0 E5C9 78               4      LD  A,B
0014D1 E5CA B7               4      OR  A
0014D2 E5CB 280D            12      JR  Z,DRDF1
0014D4 E5CD 110000          10      LD  DE,0
       E5CE                     DRWF_E  EQU $-2
       E5CF                     DRWF_D  EQU $-1
0014D7 E5D0 210000          10      LD  HL,0
       E5D1                     DRWF_HL EQU $-2
0014DA E5D3 AF               4      XOR A
0014DB E5D4 32C8E5          13      LD  (DRWF_B),A
0014DE E5D7 CD50E9          17      CALL    DRD24B
       E5D8                     DRWF_MODE   EQU $-2
       E5DA                     DRDF1:
0014E1 E5DA D1              10      POP DE
0014E2 E5DB C1              10      POP BC
0014E3 E5DC C9              10      RET
                                
       E5DD                     RB_WRITE:
0014E4 E5DD C5              11      PUSH    BC
0014E5 E5DE 0E26             7      LD  C,026H      ;(BDOS)ランダムブロック書き込み
0014E7 E5E0 1803            12      JR  RBRW
       E5E2                     RB_READ:
0014E9 E5E2 C5              11      PUSH    BC
0014EA E5E3 0E27             7      LD  C,027H      ;(BDOS)ランダムブロック読み込み
       E5E5                     RBRW:
0014EC E5E5 1F               4      RRA     ;AHL = AHL*128
0014ED E5E6 7C               4      LD  A,H ;AHL = AHL0/2
0014EE E5E7 1F               4      RRA     ;A
0014EF E5E8 65               4      LD  H,L ;
0014F0 E5E9 CB1C             8      RR  H   ;H
0014F2 E5EB 2E00             7      LD  L,0 ;
0014F4 E5ED CB1D             8      RR  L   ;L
0014F6 E5EF CDA0F5          17      CALL    SET_RR_AHL
0014F9 E5F2 218000          10      LD  HL,128
0014FC E5F5 C5              11      PUSH    BC
       E5F6                     SETSEQ_SWC_RND:
0014FD E5F6 CDCFF5          17      CALL    SETSEQ1     ;CALL SETSEQ1 or LD BC,SETSEQ1
001500 E5F9 C1              10      POP BC
001501 E5FA FDCB20FE        23      SET 7,(IY+32)   ;(FCB)カレントレコード
001505 E5FE FDE5            15      PUSH    IY
001507 E600 D1              10      POP DE
001508 E601 D5              11      PUSH    DE
001509 E602 CD9FDD          17      CALL    BDOS0
00150C E605 FDE1            14      POP IY
00150E E607 CDAAF5          17      CALL    SETSEQ      ;SETSEQ or POPRR
       E608                     SETSEQ_SWC_SEQ_RR   EQU $-2
001511 E60A FDCB20BE        23      RES 7,(IY+32)   ;(FCB)カレントレコード
                                
001515 E60E C1              10      POP BC
001516 E60F C9              10      RET
                                
                                ;(22)
       E610                     INIT_SEQ:
001517 E610 3E01             7      LD  A,1     ;LD BC,????
001519 E612 21AAF5          10      LD  HL,SETSEQ
00151C E615 CD70F5          17      CALL    PUSHRR
       E618                     GETSEQ:
00151F E618 FD6E20          19      LD  L,(IY+32)   ;(FCB)カレントレコード
001522 E61B FD660C          19      LD  H,(IY+12)   ;(FCB)カレントブロック
001525 E61E AF               4      XOR A
                                
001526 E61F CB25             8      SLA L   ;L=L*2
                                
001528 E621 CB3C             8      SRL H   ;HL=HL/2
00152A E623 CB1D             8      RR  L   ;
00152C E625 C9              10      RET
[EOF:LDFILE2.ASM:SHIFT_JIS]
                                    INCLUDE "LDDIO.ASM"
                                
                                ;   LSX-Dodgers DIO
                                
       E626                     DRDX:
00152D E626 CD64E6          17      CALL    DRDY
001530 E629 C8              11      RET Z
001531 E62A CD4AE6          17      CALL    DRDX1       ;データバッファの情報を保存
001534 E62D D8              11      RET C
001535 E62E E5              11      PUSH    HL
001536 E62F C5              11      PUSH    BC
001537 E630 D5              11      PUSH    DE
001538 E631 2A7EEF          16      LD  HL,(_DTBUF)
00153B E634 3A8DE6          13      LD  A,(_DBS24)
00153E E637 4F               4      LD  C,A
00153F E638 CD4EE9          17      CALL    DRD24
001542 E63B DC5FE6          17      CALL    C,DRDNE
       E63E                     POP_DE_BC_HL_RET:
001545 E63E D1              10      POP DE
001546 E63F C1              10      POP BC
001547 E640 E1              10      POP HL
001548 E641 C9              10      RET
                                
                                ;   CDE:セクタ番号
       E642                     DRDN:
001549 E642 AF               4      XOR A
00154A E643 00               4  DRDN1:  NOP         ;自己書き換え NOP / SCF
00154B E644 30E0            12      JR  NC,DRDX
       E646                     DRDNX:
00154D E646 CD64E6          17      CALL    DRDY
001550 E649 C8              11      RET Z
       E64A                     DRDX1:
001551 E64A CD7AE6          17      CALL    DWTX
                                                ;データバッファの読み込んだドライブ・セクタ情報を保存
001554 E64D ED53A6EE        20      LD  (_DBSEC),DE
001558 E651 79               4      LD  A,C
001559 E652 328DE6          13      LD  (_DBS24),A
                                
00155C E655 3A88EE          13      LD  A,(_DRV)
00155F E658 32A5EE          13      LD  (_DBDRV),A
001562 E65B CDD9EE          17      CALL    _CHGDRV
001565 E65E D0              11      RET NC
       E65F                     DRDNE:
001566 E65F 9F               4      SBC A,A     ;CF=1ならばA=0FFH
001567 E660 32A5EE          13      LD  (_DBDRV),A
00156A E663 C9              10      RET
                                
                                ;   CDE:セクタ番号
       E664                     DRDY:
00156B E664 3A8DE6          13      LD  A,(_DBS24)
00156E E667 B9               4      CP  C
00156F E668 C0              11      RET NZ
                                
001570 E669 E5              11      PUSH    HL
001571 E66A 3A88EE          13      LD  A,(_DRV)
001574 E66D 21A5EE          10      LD  HL,_DBDRV
001577 E670 AE               7      XOR (HL)
001578 E671 2005            12      JR  NZ,POP_HL_RET
                                
00157A E673 2AA6EE          16      LD  HL,(_DBSEC)
00157D E676 ED52            15      SBC HL,DE       ;上でXORを使っているのでCF=0のはず
       E678                     POP_HL_RET:
00157F E678 E1              10      POP HL
001580 E679 C9              10      RET
                                
       E67A                     DWTX:
001581 E67A 3AA4EE          13      LD  A,(_WTDBF)
001584 E67D B7               4      OR  A
001585 E67E C8              11      RET Z
001586 E67F AF               4      XOR A
001587 E680 32A4EE          13      LD  (_WTDBF),A
                                
00158A E683 E5              11      PUSH    HL
00158B E684 C5              11      PUSH    BC
00158C E685 D5              11      PUSH    DE
00158D E686 3AA5EE          13      LD  A,(_DBDRV)
001590 E689 CDD9EE          17      CALL    _CHGDRV
001593 E68C 0E00             7      LD  C,0
       E68D                     _DBS24  EQU $-1
001595 E68E ED5BA6EE        20      LD  DE,(_DBSEC)
001599 E692 2A7EEF          16      LD  HL,(_DTBUF)
00159C E695 D45CE9          17      CALL    NC,DWT24
       E698                     POP_DE_BC_HL_RET2:
00159F E698 18A4            12      JR  POP_DE_BC_HL_RET
                                
       E69A                     RDFATX:
0015A1 E69A E5              11      PUSH    HL
0015A2 E69B 3A88EE          13      LD  A,(_DRV)
0015A5 E69E 21AAEE          10      LD  HL,_FATDRV
0015A8 E6A1 AE               7      XOR (HL)
0015A9 E6A2 28D4            12      JR  Z,POP_HL_RET
                                
0015AB E6A4 C5              11      PUSH    BC
0015AC E6A5 D5              11      PUSH    DE
0015AD E6A6 DDE5            15      PUSH    IX
0015AF E6A8 CDC4E6          17      CALL    WTFATX
0015B2 E6AB 3813            12      JR  C,POP_IX_DE_BC_HL_RET
                                
0015B4 E6AD AF               4      XOR A
0015B5 E6AE 32ABEE          13      LD  (_FATIX),A
0015B8 E6B1 3A88EE          13      LD  A,(_DRV)
0015BB E6B4 32AAEE          13      LD  (_FATDRV),A
0015BE E6B7 CDE5EE          17      CALL    _RDFAT
       E6BA                     RDFATE2:
0015C1 E6BA 3004            12      JR  NC,POP_IX_DE_BC_HL_RET
0015C3 E6BC 9F               4      SBC A,A     ;A=0xFF
0015C4 E6BD 32AAEE          13      LD  (_FATDRV),A
       E6C0                     POP_IX_DE_BC_HL_RET:
0015C7 E6C0 DDE1            14      POP IX
0015C9 E6C2 18D4            12      JR  POP_DE_BC_HL_RET2
                                
       E6C4                     WTFATX:
0015CB E6C4 3AA2EE          13      LD  A,(_WTFATF)
0015CE E6C7 B7               4      OR  A
0015CF E6C8 C8              11      RET Z
0015D0 E6C9 AF               4      XOR A
0015D1 E6CA 32A2EE          13      LD  (_WTFATF),A
                                
0015D4 E6CD E5              11      PUSH    HL
0015D5 E6CE 3AAAEE          13      LD  A,(_FATDRV)
0015D8 E6D1 21A5EE          10      LD  HL,_DBDRV
0015DB E6D4 AE               7      XOR (HL)
0015DC E6D5 CC7AE6          17      CALL    Z,DWTX
0015DF E6D8 389E            12      JR  C,POP_HL_RET
0015E1 E6DA C5              11      PUSH    BC
0015E2 E6DB D5              11      PUSH    DE
0015E3 E6DC DDE5            15      PUSH    IX
0015E5 E6DE CD6DE9          17      CALL    FATSETUP
0015E8 E6E1 D45EE9          17      CALL    NC,DWT24B
0015EB E6E4 18DA            12      JR  POP_IX_DE_BC_HL_RET
                                
       E6E6                     N16CL1:
0015ED E6E6 7A               4      LD  A,D
0015EE E6E7 B3               4      OR  E
0015EF E6E8 37               4      SCF
0015F0 E6E9 C8              11      RET Z
                                
0015F1 E6EA 7A               4      LD  A,D
0015F2 E6EB 1807            12      JR  NCL1X
       E6ED                     NCL1:
0015F4 E6ED 7A               4      LD  A,D
0015F5 E6EE B3               4      OR  E
0015F6 E6EF 37               4      SCF
0015F7 E6F0 C8              11      RET Z
                                
0015F8 E6F1 7A               4      LD  A,D
0015F9 E6F2 CB3F             8      SRL A   ;/2
       E6F4                     NCL1X:
0015FB E6F4 CB3F             8      SRL A   ;/2
                                
0015FD E6F6 E5              11      PUSH    HL
0015FE E6F7 3216E7          13      LD  (NCLPAT_FATIX),A    ;_FATIX
001601 E6FA 2AAAEE          16      LD  HL,(_FATDRV)    ;L=_FATDRV H=_FATIX
001604 E6FD BC               4      CP  H
001605 E6FE 3A88EE          13      LD  A,(_DRV)    ;LDではフラグは変化しない
001608 E701 3215E7          13      LD  (NCLPAT_FATDRV),A   ;_FATDRV
00160B E704 2005            12      JR  NZ,NCL2     ;FATIXが違う
00160D E706 BD               4      CP  L
00160E E707 2002            12      JR  NZ,NCL2     ;ドライブが違う
001610 E709 E1              10      POP HL
001611 E70A C9              10      RET
       E70B                     NCL2:
001612 E70B C5              11      PUSH    BC
001613 E70C D5              11      PUSH    DE
001614 E70D DDE5            15      PUSH    IX
001616 E70F CDC4E6          17      CALL    WTFATX
001619 E712 38AC            12      JR  C,POP_IX_DE_BC_HL_RET
00161B E714 010000          10      LD  BC,0        ;自己書き換え C=_FATDRV B=_FATIX
       E716                     NCLPAT_FATIX    EQU $-1
       E715                     NCLPAT_FATDRV   EQU $-2
00161E E717 ED43AAEE        20      LD  (_FATDRV),BC
001622 E71B CD42E9          17      CALL    RDFATS
001625 E71E 189A            12      JR  RDFATE2
                                
       E720                     NCL3:
001627 E720 CB9A             8      RES 3,D
001629 E722 CB92             8      RES 2,D
00162B E724 6B               4      LD  L,E
00162C E725 62               4      LD  H,D
00162D E726 CB3C             8      SRL H   ;
00162F E728 CB1D             8      RR  L   ;HLA=HLA/2
001631 E72A 1F               4      RRA     ;
001632 E72B F5              11      PUSH    AF
001633 E72C 3AABEE          13      LD  A,(_FATIX)
001636 E72F 0F               4      RRCA
001637 E730 300B            12      JR  NC,NCL3X1
001639 E732 3A32E5          13      LD  A,(SECSZ_H)
00163C E735 FE04             7      CP  4       ;1セクタ1024バイトの場合は奇数インデックスの場合に先頭を512バイトずらす
00163E E737 2004            12      JR  NZ,NCL3X1
001640 E739 010002          10      LD  BC,512
001643 E73C 09              11      ADD HL,BC
       E73D                     NCL3X1:
001644 E73D F1              10      POP AF
001645 E73E ED4B7CEF        20      LD  BC,(_FATBF)
001649 E742 19              11      ADD HL,DE
00164A E743 09              11      ADD HL,BC
00164B E744 17               4      RLA
00164C E745 C9              10      RET
                                
       E746                     GNCL:
00164D E746 CDEDE6          17      CALL    NCL1        ;GET NEXT CLUSTER
001650 E749 D8              11      RET C
001651 E74A C5              11      PUSH    BC
001652 E74B E5              11      PUSH    HL
001653 E74C CD20E7          17      CALL    NCL3
001656 E74F 3809            12      JR  C,GNC1
001658 E751 5E               7      LD  E,(HL)
001659 E752 23               6      INC HL
00165A E753 7E               7      LD  A,(HL)
00165B E754 E60F             7      AND 00FH
00165D E756 57               4      LD  D,A
00165E E757 E1              10      POP HL
00165F E758 C1              10      POP BC
001660 E759 C9              10      RET
       E75A                     GNC1:
001661 E75A 7E               7      LD  A,(HL)
001662 E75B 23               6      INC HL
001663 E75C 56               7      LD  D,(HL)
001664 E75D 0604             7      LD  B,4
       E75F                     GNC1L:
001666 E75F CB3A             8      SRL D   ;DA=DA/2
001668 E761 1F               4      RRA     ;
001669 E762 10FB            13      DJNZ    GNC1L
                                
00166B E764 5F               4      LD  E,A
00166C E765 E1              10      POP HL
00166D E766 C1              10      POP BC
00166E E767 A7               4      AND A
00166F E768 C9              10      RET
                                
       E769                     SNCL:
001670 E769 CDEDE6          17      CALL    NCL1
001673 E76C D8              11      RET C
                                ;               SET NEXT CLUSTER
001674 E76D E5              11      PUSH    HL
001675 E76E C5              11      PUSH    BC
001676 E76F D5              11      PUSH    DE
001677 E770 E5              11      PUSH    HL
001678 E771 CD20E7          17      CALL    NCL3
00167B E774 D1              10      POP DE
                                ;CF=ODD
00167C E775 7E               7      LD  A,(HL)
00167D E776 73               7      LD  (HL),E
00167E E777 3806            12      JR  C,SNC1
                                ;EVEN
                                ;M[0] = E
                                ;M[1] = (M[1] & 0xF0) | (D & 0x0F)
001680 E779 23               6      INC HL
001681 E77A ED67            18      RRD     ;M={A[3:0],E[3:0]}
001683 E77C 7A               4      LD  A,D
001684 E77D 1804            12      JR  SNC11
       E77F                     SNC1:
                                ;ODD
                                ;HL[0] = (HL[0]&0x0F) | (E<<4)
                                ;HL[1] = DE>>4
001686 E77F ED6F            18      RLD     ;M={D[3:0],E[7:4]}
001688 E781 23               6      INC HL
001689 E782 72               7      LD  (HL),D  ;M={D[3:0],E[7:4]}
       E783                     SNC11:
00168A E783 ED6F            18      RLD     ;M={M[7:4],D[3:0]}
00168C E785 B7               4      OR  A
00168D E786 D1              10      POP DE
00168E E787 C1              10      POP BC
00168F E788 E1              10      POP HL
       E789                     FAT_CHANGED:
001690 E789 3EFF             7      LD  A,0FFH
001692 E78B 32A2EE          13      LD  (_WTFATF),A
001695 E78E C9              10      RET
                                
       E78F                     N16CL3:
001696 E78F C5              11      PUSH    BC
001697 E790 6B               4      LD  L,E
001698 E791 7A               4      LD  A,D
001699 E792 E601             7      AND 1
00169B E794 67               4      LD  H,A
00169C E795 29              11      ADD HL,HL
00169D E796 ED4B7CEF        20      LD  BC,(_FATBF)
0016A1 E79A 09              11      ADD HL,BC
0016A2 E79B C1              10      POP BC
0016A3 E79C C9              10      RET
                                
       E79D                     GNCL16:
0016A4 E79D CDE6E6          17      CALL    N16CL1      ;GET NEXT CLUSTER for FAT16
0016A7 E7A0 D8              11      RET C
0016A8 E7A1 E5              11      PUSH    HL
0016A9 E7A2 CD8FE7          17      CALL    N16CL3
0016AC E7A5 5E               7      LD  E,(HL)
0016AD E7A6 23               6      INC HL
0016AE E7A7 56               7      LD  D,(HL)
0016AF E7A8 E1              10      POP HL
0016B0 E7A9 C9              10      RET
                                
       E7AA                     SNCL16:
0016B1 E7AA CDE6E6          17      CALL    N16CL1      ;GET NEXT CLUSTER for FAT16
0016B4 E7AD D8              11      RET C
0016B5 E7AE D5              11      PUSH    DE
0016B6 E7AF E5              11      PUSH    HL
0016B7 E7B0 CD8FE7          17      CALL    N16CL3
0016BA E7B3 D1              10      POP DE      ;HL
0016BB E7B4 73               7      LD  (HL),E
0016BC E7B5 23               6      INC HL
0016BD E7B6 72               7      LD  (HL),D
0016BE E7B7 6B               4      LD  L,E
0016BF E7B8 62               4      LD  H,D
0016C0 E7B9 D1              10      POP DE
0016C1 E7BA 18CD            12      JR  FAT_CHANGED
                                
                                ;------------------------
                                ;次のセクタを探す際に_SECPSの値をチェック
                                ;in
                                ;   DE : セクタ番号
                                ;out
                                ;   DE : 次のセクタ番号
                                ;note
                                ;
                                ;------------------------
       E7BC                     NEXTX:
0016C3 E7BC 3E00             7      LD  A,0 ;自己書き換え
       E7BD                     _SECPS  EQU $-1
0016C5 E7BE 3C               4      INC A
0016C6 E7BF E600             7      AND 0   ;自己書き換え　1クラスタの論理セクタ数-1
       E7C0                     _NCPAT  EQU $-1
0016C8 E7C1 32BDE7          13      LD  (_SECPS),A
0016CB E7C4 C9              10      RET
                                
       E7C5                     GNCLX:
0016CC E7C5 CDBCE7          17      CALL    NEXTX
0016CF E7C8 C0              11      RET NZ  ;1クラスタのセクタ未満の場合は戻る
0016D0 E7C9 C3F7EE          10      JP  _GNCL   ;次のクラスタを探す
                                
       E7CC                     RDFAT:
0016D3 E7CC 3E80             7      LD  A,080H
0016D5 E7CE 3270EE          13      LD  (CHECK),A
       E7D1                     RDFAT1:
0016D8 E7D1 3A88EE          13      LD  A,(_DRV)
0016DB E7D4 CD76EA          17      CALL    CHGDRVR
0016DE E7D7 D8              11      RET C
0016DF E7D8 DD7E12          19      LD  A,(IX+DPB_DEVICE)
0016E2 E7DB CB6F             8      BIT 5,A
0016E4 E7DD 286E            12      JR  Z,RDFAT0X
0016E6 E7DF 2170EE          10      LD  HL,CHECK
0016E9 E7E2 A6               7      AND (HL)
0016EA E7E3 77               7      LD  (HL),A
0016EB E7E4 110000          10      LD  DE,0        ;BPB
0016EE E7E7 2A7CEF          16      LD  HL,(_FATBF)
0016F1 E7EA 0E00             7      LD  C,0
0016F3 E7EC CD4EE9          17      CALL    DRD24
0016F6 E7EF 3024            12      JR  NC,GETBPB
0016F8 E7F1 2170EE          10      LD  HL,CHECK
0016FB E7F4 CB06            15      RLC (HL)
0016FD E7F6 3F               4      CCF
0016FE E7F7 D8              11      RET C
0016FF E7F8 DDCB0A1E        23      RR  (IX+DPB_FDMODE)
001703 E7FC 3F               4      CCF         ;フロッピーディスクのFDモードを切り替える
001704 E7FD DDCB0A16        23      RL  (IX+DPB_FDMODE)
001708 E801 3EFF             7      LD  A,0FFH
00170A E803 3289EE          13      LD  (_DSK),A
00170D E806 3A84EE          13      LD  A,(_DRIVE)
001710 E809 E603             7      AND 3
001712 E80B F680             7      OR  080H
001714 E80D 6F               4      LD  L,A
001715 E80E 26EE             7      LD  H,_CYL0/256
001717 E810 3EFF             7      LD  A,0FFH
001719 E812 77               7      LD  (HL),A
00171A E813 18BC            12      JR  RDFAT1
       E815                     GETBPB:
00171C E815 FDE5            15      PUSH    IY
00171E E817 FD2A7CEF        20      LD  IY,(_FATBF) ;BPB
001722 E81B CDF1EE          17      CALL    _BPB2DPB
001725 E81E FDE1            14      POP IY
001727 E820 DD7E12          19      LD  A,(IX+DPB_DEVICE)
00172A E823 3025            12      JR  NC,GETBPBOK
00172C E825 E60F             7      AND 00FH
00172E E827 FE07             7      CP  7
001730 E829 37               4      SCF
001731 E82A C0              11      RET NZ
001732 E82B DDCB0A46        20      BIT 0,(IX+DPB_FDMODE)
001736 E82F 21C0EF          10      LD  HL,M2D
001739 E832 2006            12      JR  NZ,SETFDMODE
00173B E834 CD27E9          17      CALL    CHECK1024
00173E E837 D8              11      RET C
00173F E838 2ED2             7      LD  L,M2HD-STABLE
       E83A                     SETFDMODE:
001741 E83A DDE5            15      PUSH    IX
001743 E83C D1              10      POP DE
001744 E83D EDA0            16      LDI
001746 E83F EDA0            16      LDI
001748 E841 13               6      INC DE
001749 E842 13               6      INC DE
00174A E843 13               6      INC DE
00174B E844 13               6      INC DE
00174C E845 010C00          10      LD  BC,12
00174F E848 EDB0                    LDIR
       E84A                     GETBPBOK:
001751 E84A CDE2E9          17      CALL    CHGDRV2
       E84D                     RDFAT0X:
001754 E84D CD42E9          17      CALL    RDFATS
001757 E850 D8              11      RET C
001758 E851 DDAE06          19      XOR (IX+DPB_FATID)
00175B E854 C8              11      RET Z
00175C E855 DD7E12          19      LD  A,(IX+DPB_DEVICE)
00175F E858 CB5F             8      BIT 3,A
001761 E85A 2803            12      JR  Z,RDFAT0X1
001763 E85C CB6F             8      BIT 5,A
001765 E85E C0              11      RET NZ      ;BPBを取得している場合はFATIDをチェックしない
       E85F                     RDFAT0X1:
001766 E85F 37               4      SCF
001767 E860 C9              10      RET
                                
       E861                     POP_HL_SCF_RET:
001768 E861 E1              10      POP HL
001769 E862 37               4      SCF
00176A E863 C9              10      RET
                                
       E864                     BPB2DPB:
00176B E864 FD7E0B          19      LD  A,(IY+11)   ;BPB_BytsPerSec
00176E E867 B7               4      OR  A
00176F E868 37               4      SCF
001770 E869 C0              11      RET NZ
       E86A                     BPBOK:
001771 E86A FD7E0D          19      LD  A,(IY+13)   ;BPB_SecPerClus
001774 E86D DD7707          19      LD  (IX+DPB_SECPCL),A
                                
001777 E870 FD7E16          19      LD  A,(IY+22)   ;BPB_FATSz16
00177A E873 DD7700          19      LD  (IX+DPB_FATLN),A
00177D E876 FD7E17          19      LD  A,(IY+23)   ;BPB_FATSz16
001780 E879 DD7701          19      LD  (IX+DPB_FATLN+1),A
                                
001783 E87C FD6E0E          19      LD  L,(IY+14)   ;BPB_RsvdSecCnt
001786 E87F FD660F          19      LD  H,(IY+15)
001789 E882 DD750E          19      LD  (IX+DPB_FATPS),L
00178C E885 FD5E16          19      LD  E,(IY+22)   ;BPB_FATSz16
00178F E888 FD5617          19      LD  D,(IY+23)
001792 E88B FD4610          19      LD  B,(IY+16)   ;BPB_NumFATs
       E88E                     BPBDP1:             ;BPB_FATSz16 * BPB_NumFATs
001795 E88E 19              11      ADD HL,DE
001796 E88F 10FD            13      DJNZ    BPBDP1
       E891                     BPBDP2:
001798 E891 DD7510          19      LD  (IX+DPB_DIRPS),L
00179B E894 DD7411          19      LD  (IX+DPB_DIRPS+1),H
00179E E897 E5              11      PUSH    HL
                                
00179F E898 FD6E11          19      LD  L,(IY+17)   ;BPB_RootEntCnt
0017A2 E89B FD6612          19      LD  H,(IY+18)
0017A5 E89E FD7E0C          19      LD  A,(IY+12)   ;BPB_BytsPerSec
0017A8 E8A1 B7               4      OR  A
0017A9 E8A2 28BD            12      JR  Z,POP_HL_SCF_RET
0017AB E8A4 0606             7      LD  B,6
       E8A6                     BPBBPS1:
0017AD E8A6 05               4      DEC B
0017AE E8A7 0F               4      RRCA
0017AF E8A8 30FC            12      JR  NC,BPBBPS1
       E8AA                     BPBDE1:
0017B1 E8AA 29              11      ADD HL,HL
0017B2 E8AB 10FD            13      DJNZ    BPBDE1
                                
0017B4 E8AD 7C               4      LD  A,H
0017B5 E8AE DD770B          19      LD  (IX+DPB_DIRSCNT),A  ;
                                
0017B8 E8B1 D1              10      POP DE      ;DPB_DIRPS
0017B9 E8B2 6C               4      LD  L,H
0017BA E8B3 2600             7      LD  H,0
0017BC E8B5 19              11      ADD HL,DE       ;MAXDIR
0017BD E8B6 E5              11      PUSH    HL
0017BE E8B7 FD4E0D          19      LD  C,(IY+13)   ;BPB_SecPerClus
0017C1 E8BA CB21             8      SLA C       ;*2
0017C3 E8BC AF               4      XOR A
0017C4 E8BD 47               4      LD  B,A
0017C5 E8BE ED42            15      SBC HL,BC
0017C7 E8C0 DD7514          19      LD  (IX+DPB_ADDCL),L
0017CA E8C3 DD7415          19      LD  (IX+DPB_ADDCL+1),H
                                
0017CD E8C6 D1              10      POP DE      ;DE=DPB_MAXDIR
0017CE E8C7 FD6E13          19      LD  L,(IY+19)   ;BPB_TotSec16
0017D1 E8CA FD6614          19      LD  H,(IY+20)
                                
0017D4 E8CD DD7E12          19      LD  A,(IX+DPB_DEVICE)
0017D7 E8D0 E60F             7      AND 00FH
0017D9 E8D2 FE07             7      CP  7       ;フロッピー
0017DB E8D4 2019            12      JR  NZ,NOT_FD
0017DD E8D6 E5              11      PUSH    HL
0017DE E8D7 FD4E18          19      LD  C,(IY+24)   ;BPB_SecPerTr
0017E1 E8DA DD710D          19      LD  (IX+DPB_MAXSEC),C
0017E4 E8DD AF               4      XOR A
0017E5 E8DE CB21             8      SLA C       ;両面なのでセクタ数を２倍
0017E7 E8E0 0610             7      LD  B,16
       E8E2                     DIVSEC:             ;MAXCYL = BPB_TotSec16 / (BPB_SecPerTr * 2)
0017E9 E8E2 29              11      ADD HL,HL
0017EA E8E3 17               4      RLA
0017EB E8E4 B9               4      CP  C
0017EC E8E5 3802            12      JR  C,DIVSEC1
0017EE E8E7 91               4      SUB C
0017EF E8E8 2C               4      INC L
       E8E9                     DIVSEC1:
0017F0 E8E9 10F7            13      DJNZ    DIVSEC
0017F2 E8EB DD750C          19      LD  (IX+DPB_MAXCYL),L
0017F5 E8EE E1              10      POP HL  ;ここまでフロッピー専用
       E8EF                     NOT_FD:
0017F6 E8EF 7C               4      LD  A,H
0017F7 E8F0 B5               4      OR  L
0017F8 E8F1 3E00             7      LD  A,0     ;LDでフラグは変化しない。BPB_TotSec16を AHL で扱う為、Aに0を入れる
0017FA E8F3 200E            12      JR  NZ,BPB16BIT ;BPB_TotSec16が「0」の場合はBPB_TotSec32で計算
0017FC E8F5 2F               4      CPL         ;A=0FFH
0017FD E8F6 FD8623          19      ADD A,(IY+35)   ;念のために総セクタ数が24ビットを超える場合はエラーを返す
001800 E8F9 D8              11      RET C
001801 E8FA FD6E20          19      LD  L,(IY+32)   ;BPB_TotSec32 は AHL の24ビットで扱う
001804 E8FD FD6621          19      LD  H,(IY+33)   ;1クラスタの論理セクタ数(DPB_SECPCL)が最大128なので、
001807 E900 FD7E22          19      LD  A,(IY+34)   ;FAT12,FAT16では総セクタ数が24ビットを超えることは無い
       E903                     BPB16BIT:
00180A E903 ED52            15      SBC HL,DE       ;DE=DPB_MAXDIR
00180C E905 DE00             7      SBC A,0
00180E E907 FD460D          19      LD  B,(IY+13)   ;BPB_SecPerClus
       E90A                     BPBTC1:             ;総クラスタ数(AHL) = 総セクタ数(AHL) / セクタサイズ(B)
001811 E90A CB18             8      RR  B       ;->CY
001813 E90C 3808            12      JR  C,BPBTC2
001815 E90E CB3F             8      SRL A
001817 E910 CB1C             8      RR  H       ;AHL=AHL/2
001819 E912 CB1D             8      RR  L
00181B E914 18F4            12      JR  BPBTC1
       E916                     BPBTC2:
00181D E916 C6FF             7      ADD A,0FFH
00181F E918 D8              11      RET C       ;念のため(クラスタ数が16ビットを超える場合)
001820 E919 23               6      INC HL
001821 E91A 23               6      INC HL
001822 E91B DD7508          19      LD  (IX+DPB_MAXCL),L
001825 E91E DD7409          19      LD  (IX+DPB_MAXCL+1),H
                                
001828 E921 FD7E15          19      LD  A,(IY+21)   ;BPB_Media
00182B E924 DD7706          19      LD  (IX+DPB_FATID),A
       E927                     CHECK1024:
00182E E927 FD7E10          19      LD  A,(IY+16)   ;BPB_NumFATs
001831 E92A C6FE             7      ADD A,0-2       ;>2:CF=1
001833 E92C FD7E0C          19      LD  A,(IY+12)   ;BPB_BytsPerSec
001836 E92F 6F               4      LD  L,A
001837 E930 3002            12      JR  NC,BPBFAT1
001839 E932 F680             7      OR  080H
       E934                     BPBFAT1:            ;ここではCF=0
00183B E934 DD770F          19      LD  (IX+DPB_BPS),A
00183E E937 3A7BEF          13      LD  A,(_MAX_SEC_SZ_H)
001841 E93A BD               4      CP  L
001842 E93B C8              11      RET Z       ;1セクタ1024バイト
001843 E93C 2D               4      DEC L       ;以下のセクタサイズに合致しない場合はCF=1でエラーにする
001844 E93D C8              11      RET Z       ;1セクタ256バイト
001845 E93E 2D               4      DEC L
001846 E93F C8              11      RET Z       ;1セクタ512バイト
001847 E940 37               4      SCF
001848 E941 C9              10      RET
                                
       E942                     RDFATS:
001849 E942 CD6DE9          17      CALL    FATSETUP
00184C E945 D8              11      RET C
00184D E946 CD50E9          17      CALL    DRD24B
001850 E949 2A7CEF          16      LD  HL,(_FATBF)
001853 E94C 7E               7      LD  A,(HL)
001854 E94D C9              10      RET
                                
       E94E                     DRD24:
001855 E94E 0601             7      LD  B,1
       E950                     DRD24B:
001857 E950 DDE5            15      PUSH    IX
001859 E952 DD2AA8EE        20      LD  IX,(_DPB)
00185D E956 CD07EC          17      CALL    FDRD        ;自己書き換え（ディスク読み込み）
       E957                     DRDPAT  EQU $-2
001860 E959 DDE1            14      POP IX
001862 E95B C9              10      RET
                                
       E95C                     DWT24:
001863 E95C 0601             7      LD  B,1
       E95E                     DWT24B:
001865 E95E DDE5            15      PUSH    IX
001867 E960 DD2AA8EE        20      LD  IX,(_DPB)
00186B E964 CD6FEB          17      CALL    FDWT        ;自己書き換え（ディスク書き込み）
       E965                     DWTPAT  EQU $-2
00186E E967 DDE1            14      POP IX
001870 E969 D0              11      RET NC
001871 E96A C35AEE          10      JP  _DISKE
                                
                                ;------------------------
                                ;FATのセットアップ
                                ;out
                                ;   B  : FATセクタ数
                                ;   DE : FAT先頭セクタ番号
                                ;   HL : FATバッファポインタ
                                ;   CF : 1=ドライブ切り替えエラー
                                ;note
                                ;   FATサイズがFATバッファを超える場合は
                                ;   対象クラスタ領域==(_FATIX)によって
                                ;   FAT12:対象クラスタ1024毎に1.5KBを切り替える
                                ;   FAT16:対象クラスタ512毎に1KBを切り替える
                                ;------------------------
       E96D                     FATSETUP:
001874 E96D 3AAAEE          13      LD  A,(_FATDRV)
001877 E970 CD76EA          17      CALL    CHGDRVR     ;ドライブ切り替え
00187A E973 D8              11      RET C
       E974                     FATS2:
00187B E974 DD7E0F          19      LD  A,(IX+DPB_BPS)  ;512=2 1024=4
00187E E977 0F               4      RRCA
00187F E978 CDA8E9          17      CALL    FATSETUP12  ;自己書き換え
       E979                     FATSX   EQU $-2
001882 E97B 210000          10      LD  HL,0
001885 E97E 4A               4      LD  C,D
001886 E97F 54               4      LD  D,H
001887 E980 3AABEE          13      LD  A,(_FATIX)  ;範囲FAT12:0-3/FAT16:0-127(0-07FH):65535*2/1024
00188A E983 47               4      LD  B,A
00188B E984 04               4      INC B
00188C E985 DD7E00          19      LD  A,(IX+DPB_FATLN)
       E988                     FAT_SKP:
00188F E988 05               4      DEC B
001890 E989 2809            12      JR  Z,FAT1
001892 E98B 19              11      ADD HL,DE
001893 E98C 93               4      SUB E
001894 E98D 30F9            12      JR  NC,FAT_SKP
001896 E98F DDCB0146        20      BIT 0,(IX+DPB_FATLN+1)  ;FATサイズが0100H(256)の場合
00189A E993 C8              11      RET Z
       E994                     FAT1:
00189B E994 EB               4      EX  DE,HL
00189C E995 B7               4      OR  A       ;0の場合は0100Hとして扱う
00189D E996 2803            12      JR  Z,FAT3
00189F E998 B9               4      CP  C       ;C=FATバッファに読み込めるセクタ数
0018A0 E999 3801            12      JR  C,FAT2
       E99B                     FAT3:
0018A2 E99B 79               4      LD  A,C
       E99C                     FAT2:
0018A3 E99C 47               4      LD  B,A
                                
0018A4 E99D 2AFAEF          16      LD  HL,(_FATPS) ;fat sector pos
0018A7 E9A0 19              11      ADD HL,DE
0018A8 E9A1 EB               4      EX  DE,HL
0018A9 E9A2 2A7CEF          16      LD  HL,(_FATBF)
0018AC E9A5 AF               4      XOR A       ;CF=0
0018AD E9A6 4F               4      LD  C,A
0018AE E9A7 C9              10      RET
                                ;
                                ;   FATバッファに読み込める最大のセクタ数と_FATIXで進めるセクタ数
                                ;   FATSETUP* (FAT12/FAT16)
                                ;out
                                ;   D : FATバッファに読み込める最大のセクタ数
                                ;   E : _FATIXで進めるセクタ数
       E9A8                     FATSETUP12:
0018AF E9A8 110606          10      LD  DE,0606H    ;256
0018B2 E9AB D8              11      RET C
0018B3 E9AC 110303          10      LD  DE,0303H    ;512
0018B6 E9AF 0F               4      RRCA
0018B7 E9B0 D8              11      RET C
0018B8 E9B1 110102          10      LD  DE,0201H    ;1024
0018BB E9B4 C9              10      RET
                                
       E9B5                     FATSETUP16:
0018BC E9B5 110404          10      LD  DE,0404H    ;256
0018BF E9B8 D8              11      RET C
0018C0 E9B9 110202          10      LD  DE,0202H    ;512
0018C3 E9BC 0F               4      RRCA
0018C4 E9BD D8              11      RET C
0018C5 E9BE 110101          10      LD  DE,0101H    ;1024
0018C8 E9C1 C9              10      RET
                                
       E9C2                     CHGDRV:
0018C9 E9C2 E5              11      PUSH    HL
0018CA E9C3 2189EE          10      LD  HL,_DSK
0018CD E9C6 BE               7      CP  (HL)
0018CE E9C7 280A            12      JR  Z,CHGDRVE
       E9C9                     CHGDRV1:
0018D0 E9C9 DDE5            15      PUSH    IX
0018D2 E9CB CDD5E9          17      CALL    CHGDRV0
0018D5 E9CE 3A89EE          13      LD  A,(_DSK)
0018D8 E9D1 DDE1            14      POP IX
       E9D3                     CHGDRVE:
0018DA E9D3 E1              10      POP HL
0018DB E9D4 C9              10      RET
                                
       E9D5                     CHGDRV0:
0018DC E9D5 6F               4      LD  L,A
0018DD E9D6 CDDCEE          17      CALL    _GETDPB
0018E0 E9D9 D8              11      RET C
0018E1 E9DA DD22A8EE        20      LD  (_DPB),IX
0018E5 E9DE 7D               4      LD  A,L
0018E6 E9DF 3289EE          13      LD  (_DSK),A
       E9E2                     CHGDRV2:
0018E9 E9E2 C5              11      PUSH    BC
0018EA E9E3 D5              11      PUSH    DE
0018EB E9E4 ED732DEA        20      LD  (SPPAT2),SP
0018EF E9E8 F3               4      DI
0018F0 E9E9 DDF9            10      LD  SP,IX
                                
0018F2 E9EB E1              10      POP HL      ;00:DPB_FATLN
0018F3 E9EC E1              10      POP HL      ;02:DPB_DRD
0018F4 E9ED 2257E9          16      LD  (DRDPAT),HL
                                
0018F7 E9F0 E1              10      POP HL
0018F8 E9F1 2265E9          16      LD  (DWTPAT),HL ;04:DPB_DWT
                                
0018FB E9F4 E1              10      POP HL      ;L=06:DPB_FATID H=07:DPB_SECPCL
0018FC E9F5 7C               4      LD  A,H
0018FD E9F6 32FFF2          13      LD  (SPCPAT),A  ;1クラスタの論理セクタ数
001900 E9F9 3D               4      DEC A
001901 E9FA 32C0E7          13      LD  (_NCPAT),A
                                
001904 E9FD E1              10      POP HL      ;08:DPB_MAXCL
001905 E9FE 7D               4      LD  A,L
001906 E9FF 321EF3          13      LD  (CLPAT2),A
001909 EA02 7C               4      LD  A,H
00190A EA03 321AF3          13      LD  (CLPAT1),A
00190D EA06 2B               6      DEC HL
00190E EA07 221DF5          16      LD  (MAXCLP),HL
                                
001911 EA0A E1              10      POP HL      ;L=0A:DPB_FDMODE H=0B:DPB_DIRSCNT
001912 EA0B 4C               4      LD  C,H
                                
001913 EA0C E1              10      POP HL      ;L=0C:DPB_MAXCYL H=0D:DPB_MAXSEC
                                
001914 EA0D E1              10      POP HL      ;L=0E:DPB_FATPS H=0F:DPB_BPS
001915 EA0E 7C               4      LD  A,H     ;DPB_BPS
001916 EA0F E607             7      AND 7
001918 EA11 3232E5          13      LD  (SECSZ_H),A ;1セクタのサイズの上位1バイト 0x400 - 0x200 - 0x100
                                                ;1セクタ512 2D/2DD/2HC/2HQ(2HD1.44MB)/EMM/BRAM/EMEM等
                                                ;1セクタ1024 2HD/2HDE98等
                                                ;1セクタ256 GRAM/RAMF/CMOS等
                                                ;1024   512 256
                                                ;4  2   1
00191B EA14 87               4      ADD A,A     ;8  4   2
00191C EA15 87               4      ADD A,A     ;010H   8   4
00191D EA16 87               4      ADD A,A     ;020H   010H    8
00191E EA17 327DF1          13      LD  (SDECPAT),A ;1セクタ辺りのディレクトリエントリ数
                                
001921 EA1A 2600             7      LD  H,0
001923 EA1C 22FAEF          16      LD  (_FATPS),HL
                                
001926 EA1F E1              10      POP HL      ;10:DPB_DIRPS
001927 EA20 22FCEF          16      LD  (_DIRPS),HL
                                
00192A EA23 E1              10      POP HL      ;L=12:DPB_DEVICE H=13:DPB_UNITNO
00192B EA24 7C               4      LD  A,H
00192C EA25 3284EE          13      LD  (_DRIVE),A
                                
00192F EA28 E1              10      POP HL      ;14:DPB_ADDCL
001930 EA29 220FF3          16      LD  (CLSPAT),HL
                                
001933 EA2C 310000          10      LD  SP,0        ;元のSPを復元
       EA2D                     SPPAT2  EQU $-2
001936 EA2F FB               4      EI
001937 EA30 2AFCEF          16      LD  HL,(_DIRPS)
00193A EA33 0600             7      LD  B,0
00193C EA35 09              11      ADD HL,BC       ;C=DPB_DIRSCNT
00193D EA36 2298F1          16      LD  (MD_PAT),HL
                                
001940 EA39 2A1DF5          16      LD  HL,(MAXCLP)
001943 EA3C 110AF0          10      LD  DE,0-4086   ;クラスタ数が4086未満:FAT12 4086以上:FAT16
001946 EA3F 19              11      ADD HL,DE
001947 EA40 380F            12      JR  C,SETFAT16
001949 EA42 2146E7          10      LD  HL,GNCL     ;FAT12
00194C EA45 1169E7          10      LD  DE,SNCL
00194F EA48 01A8E9          10      LD  BC,FATSETUP12
001952 EA4B DDCB0FAE        23      RES 5,(IX+DPB_BPS)  ;DPB_BPS(FAT12)
001956 EA4F 180D            12      JR  EXTRA1
       EA51                     SETFAT16:
001958 EA51 219DE7          10      LD  HL,GNCL16   ;FAT16
00195B EA54 11AAE7          10      LD  DE,SNCL16
00195E EA57 01B5E9          10      LD  BC,FATSETUP16
001961 EA5A DDCB0FEE        23      SET 5,(IX+DPB_BPS)  ;DPB_BPS(FAT16)
       EA5E                     EXTRA1:
001965 EA5E 22F8EE          16      LD  (GNCPAT),HL
001968 EA61 ED53FBEE        20      LD  (SNCPAT),DE
00196C EA65 ED4379E9        20      LD  (FATSX),BC
001970 EA69 D1              10      POP DE
001971 EA6A C1              10      POP BC
001972 EA6B AF               4      XOR A
001973 EA6C C9              10      RET
                                
       EA6D                     GETDPBD:
001974 EA6D DDE3            23      EX  (SP),IX
001976 EA6F DDE5            15      PUSH    IX
001978 EA71 3A88EE          13      LD  A,(_DRV)
00197B EA74 1807            12      JR  GETDPB1
                                
       EA76                     CHGDRVR:
00197D EA76 CDD9EE          17      CALL    _CHGDRV
001980 EA79 D8              11      RET C
001981 EA7A 3A89EE          13      LD  A,(_DSK)
       EA7D                     GETDPB1:
001984 EA7D C3DCEE          10      JP  _GETDPB
                                
       EA80                     GETDPB:
001987 EA80 FE08             7      CP  8
001989 EA82 3F               4      CCF
00198A EA83 D8              11      RET C
00198B EA84 0F               4      RRCA
00198C EA85 0F               4      RRCA
00198D EA86 0F               4      RRCA
00198E EA87 DD                      DB  0DDH        ;Z80未定義命令
00198F EA88 6F               4      LD  L,A     ;LD IXL,A
001990 EA89 DD                      DB  0DDH        ;Z80未定義命令
001991 EA8A 26F6             7      LD  H,_DEVICE/256   ;LD IXH,_DEVICE/256
001993 EA8C DD7E00          19      LD  A,(IX+DPB_FATLN)
001996 EA8F A7               4      AND A       ;CF=0の為
001997 EA90 DDCB0F6E        20      BIT 5,(IX+DPB_BPS)
00199B EA94 C0              11      RET NZ      ;FAT16
00199C EA95 DDCB126E        20      BIT 5,(IX+DPB_DEVICE)
0019A0 EA99 C0              11      RET NZ      ;BPB
0019A1 EA9A FE01             7      CP  001H        ;A=0 THEN CF=1
0019A3 EA9C C9              10      RET
                                
       EA9D                     _SYS5F:
0019A4 EA9D AF               4      XOR A
       EA9E                     FFLUSH:
0019A5 EA9E F5              11      PUSH    AF
0019A6 EA9F CDC4E6          17      CALL    WTFATX
0019A9 EAA2 AF               4      XOR A
0019AA EAA3 32ABEE          13      LD  (_FATIX),A
0019AD EAA6 2F               4      CPL         ;0FFH
0019AE EAA7 32AAEE          13      LD  (_FATDRV),A
0019B1 EAAA 3E                      DB  03EH        ;次のPUSH AFをスキップ
       EAAB                     FFLUSHBUF:
0019B2 EAAB F5              11      PUSH    AF
0019B3 EAAC CD7AE6          17      CALL    DWTX
0019B6 EAAF 3EFF             7      LD  A,0FFH
0019B8 EAB1 3239EE          13      LD  (SFILE),A
0019BB EAB4 32A5EE          13      LD  (_DBDRV),A
0019BE EAB7 F1              10      POP AF
0019BF EAB8 C9              10      RET
                                
[EOF:LDDIO.ASM:SHIFT_JIS]
                                    INCLUDE "88DISK.ASM"
                                
                                ;   LSX-Dodgers DISK
                                ;   PC-8801mkIISR
                                
                                ;   FLOPPY DISK DRIVER
                                ;
       EAB9                     PUTCOM_EXECUTE:
0019C0 EAB9 3E0D             7      LD  A,0DH       ;エグゼキュート
                                ;   コマンド送信
       EABB                     PUTCOM:
0019C2 EABB F5              11      PUSH    AF
0019C3 EABC 3E0F             7      LD  A,00FH
0019C5 EABE D3FF            11      OUT (0FFH),A    ;ディスクサブシステムI/F 8255 コントロール
0019C7 EAC0 F1              10      POP AF
                                ;   通常ハンドシェイク（ホストが送信）
       EAC1                     PUTDAT:
0019C8 EAC1 F5              11      PUSH    AF
       EAC2                     PUTDAT1:
0019C9 EAC2 DBFE            11      IN  A,(0FEH)    ;ディスクサブシステムI/F 8255 ポートC
0019CB EAC4 E602             7      AND 2       ;RFD
0019CD EAC6 28FA            12      JR  Z,PUTDAT1
0019CF EAC8 3E0E             7      LD  A,00EH      ;ATN=0
0019D1 EACA D3FF            11      OUT (0FFH),A    ;ディスクサブシステムI/F 8255 コントロール
0019D3 EACC F1              10      POP AF
0019D4 EACD D3FD            11      OUT (0FDH),A    ;標準状態ではサブシステムへのデータ送信ポート
0019D6 EACF F5              11      PUSH    AF
0019D7 EAD0 3E09             7      LD  A,9     ;DAV=1
0019D9 EAD2 D3FF            11      OUT (0FFH),A
       EAD4                     PUTDAT2:
0019DB EAD4 DBFE            11      IN  A,(0FEH)    ;ディスクサブシステムI/F 8255 ポートC
0019DD EAD6 E604             7      AND 4       ;DAC
0019DF EAD8 28FA            12      JR  Z,PUTDAT2
                                
0019E1 EADA 3E08             7      LD  A,8     ;DAV=0
0019E3 EADC D3FF            11      OUT (0FFH),A
       EADE                     PUTDAT3:
0019E5 EADE DBFE            11      IN  A,(0FEH)    ;ディスクサブシステムI/F 8255 ポートC
0019E7 EAE0 E604             7      AND 4       ;DAC
0019E9 EAE2 20FA            12      JR  NZ,PUTDAT3
0019EB EAE4 F1              10      POP AF
0019EC EAE5 C9              10      RET
                                
                                ;   通常ハンドシェイク（ホストが受信）
       EAE6                     GETDAT:
0019ED EAE6 3E0B             7      LD  A,00BH      ;RFD=1
0019EF EAE8 D3FF            11      OUT (0FFH),A    ;ディスクサブシステムI/F 8255 コントロール
       EAEA                     GETDAT1:
0019F1 EAEA DBFE            11      IN  A,(0FEH)    ;ディスクサブシステムI/F 8255 ポートC
0019F3 EAEC 0F               4      RRCA            ;DAV
0019F4 EAED 30FB            12      JR  NC,GETDAT1
                                
0019F6 EAEF 3E0A             7      LD  A,00AH      ;RFD=0
0019F8 EAF1 D3FF            11      OUT (0FFH),A    ;ディスクサブシステムI/F 8255 コントロール
                                
0019FA EAF3 DBFC            11      IN  A,(0FCH)    ;標準状態ではサブシステムからのデータ受信ポート
0019FC EAF5 F5              11      PUSH    AF
0019FD EAF6 3E0D             7      LD  A,00DH      ;DAC=1
0019FF EAF8 D3FF            11      OUT (0FFH),A    ;ディスクサブシステムI/F 8255 コントロール
                                
       EAFA                     GETDAT2:
001A01 EAFA DBFE            11      IN  A,(0FEH)    ;ディスクサブシステムI/F 8255 ポートC
001A03 EAFC 0F               4      RRCA            ;DAV
001A04 EAFD 38FB            12      JR  C,GETDAT2
                                
001A06 EAFF 3E0C             7      LD  A,00CH      ;DAC=0
001A08 EB01 D3FF            11      OUT (0FFH),A
001A0A EB03 F1              10      POP AF
001A0B EB04 C9              10      RET
                                
                                ;   高速ハンドシェイク（ホストが送信）
                                ;   HL:アドレス BC:受信サイズ（必ず偶数にする）
       EB05                     FPUTDAT:
       EB05                     FPUTDAT1:
001A0C EB05 DBFE            11      IN  A,(0FEH)    ;ディスクサブシステムI/F 8255 ポートC
001A0E EB07 E602             7      AND 2       ;RFD
001A10 EB09 28FA            12      JR  Z,FPUTDAT1
001A12 EB0B 3E0E             7      LD  A,00EH      ;ATN=0
001A14 EB0D D3FF            11      OUT (0FFH),A    ;ディスクサブシステムI/F 8255 コントロール
                                
001A16 EB0F 7E               7      LD  A,(HL)
001A17 EB10 D3FD            11      OUT (0FDH),A    ;標準状態ではサブシステムへのデータ送信ポート
                                
001A19 EB12 3E09             7      LD  A,9     ;DAV=1
001A1B EB14 D3FF            11      OUT (0FFH),A
001A1D EB16 23               6      INC HL
001A1E EB17 0B               6      DEC BC
       EB18                     FPUTDAT2:
001A1F EB18 DBFE            11      IN  A,(0FEH)    ;ディスクサブシステムI/F 8255 ポートC
001A21 EB1A E604             7      AND 4       ;DAC
001A23 EB1C 28FA            12      JR  Z,FPUTDAT2
                                
001A25 EB1E 7E               7      LD  A,(HL)
001A26 EB1F D3FD            11      OUT (0FDH),A    ;標準状態ではサブシステムへのデータ送信ポート
                                
001A28 EB21 3E08             7      LD  A,8     ;DAV=0
001A2A EB23 D3FF            11      OUT (0FFH),A
       EB25                     FPUTDAT3:
001A2C EB25 DBFE            11      IN  A,(0FEH)    ;ディスクサブシステムI/F 8255 ポートC
001A2E EB27 E604             7      AND 4       ;DAC
001A30 EB29 20FA            12      JR  NZ,FPUTDAT3
                                
001A32 EB2B EDA1            16      CPI         ;HL=HL+1 BC=BC-1 BCが0の場合にP/V=0
001A34 EB2D E0              11      RET PO
001A35 EB2E 18D5            12      JR  FPUTDAT
                                
                                
                                ;   高速ハンドシェイク（ホストが受信）
                                ;   HL:アドレス BC:受信サイズ（必ず偶数にする）
       EB30                     FGETDAT:
001A37 EB30 3E0B             7      LD  A,00BH      ;RFD=1
001A39 EB32 D3FF            11      OUT (0FFH),A    ;ディスクサブシステムI/F 8255 コントロール
       EB34                     FGETDAT1:
001A3B EB34 DBFE            11      IN  A,(0FEH)    ;ディスクサブシステムI/F 8255 ポートC
001A3D EB36 0F               4      RRCA            ;DAV
001A3E EB37 30FB            12      JR  NC,FGETDAT1
                                
001A40 EB39 3E0A             7      LD  A,00AH      ;RFD=0
001A42 EB3B D3FF            11      OUT (0FFH),A    ;ディスクサブシステムI/F 8255 コントロール
                                
001A44 EB3D DBFC            11      IN  A,(0FCH)    ;標準状態ではサブシステムからのデータ受信ポート
001A46 EB3F 77               7      LD  (HL),A
                                
001A47 EB40 3E0D             7      LD  A,00DH      ;DAC=1
001A49 EB42 D3FF            11      OUT (0FFH),A    ;ディスクサブシステムI/F 8255 コントロール
001A4B EB44 23               6      INC HL
001A4C EB45 0B               6      DEC BC
       EB46                     FGETDAT2:
001A4D EB46 DBFE            11      IN  A,(0FEH)    ;ディスクサブシステムI/F 8255 ポートC
001A4F EB48 0F               4      RRCA            ;DAV
001A50 EB49 38FB            12      JR  C,FGETDAT2
                                
001A52 EB4B DBFC            11      IN  A,(0FCH)    ;標準状態ではサブシステムからのデータ受信ポート
001A54 EB4D 77               7      LD  (HL),A
                                
001A55 EB4E 3E0C             7      LD  A,00CH      ;DAC=0
001A57 EB50 D3FF            11      OUT (0FFH),A
                                
001A59 EB52 EDA1            16      CPI         ;HL=HL+1 BC=BC-1 BCが0の場合にP/V=0
001A5B EB54 E0              11      RET PO
001A5C EB55 18D9            12      JR  FGETDAT
                                
                                ;   論理セクタ番号からトラック番号とセクタ番号を得る
                                ;   in
                                ;   DE:論理セクタ
       EB57                     CALC_SECTOR:
001A5E EB57 C5              11      PUSH    BC
001A5F EB58 DD4E0D          19      LD  C,(IX+DPB_MAXSEC)   ;フロッピーディスクの1トラックのセクタ数
001A62 EB5B 0610             7      LD  B,16
001A64 EB5D AF               4      XOR A
001A65 EB5E EB               4      EX  DE,HL
       EB5F                     DIV1:
001A66 EB5F 29              11      ADD HL,HL
001A67 EB60 8F               4      ADC A,A
001A68 EB61 B9               4      CP  C
001A69 EB62 3802            12      JR  C,DIV2
001A6B EB64 91               4      SUB C
001A6C EB65 2C               4      INC L
       EB66                     DIV2:
001A6D EB66 10F7            13      DJNZ    DIV1
                                
001A6F EB68 3C               4      INC A   ;最小のセクタは１固定
001A70 EB69 55               4      LD  D,L ;TRACK
       EB6A                     DIV3:
001A71 EB6A 5F               4      LD  E,A ;SECTOR
001A72 EB6B C1              10      POP BC
001A73 EB6C C9              10      RET
                                
       EB6D                     WTTRK:
001A74 EB6D 37               4      SCF
001A75 EB6E C9              10      RET
       EB6F                     FDWT:
001A76 EB6F E5              11      PUSH    HL
001A77 EB70 D5              11      PUSH    DE
001A78 EB71 CD57EB          17      CALL    CALC_SECTOR
001A7B EB74 7A               4      LD  A,D     ;トラック
001A7C EB75 32D3EB          13      LD  (FDWT_TRACK),A
001A7F EB78 7B               4      LD  A,E     ;セクタ
001A80 EB79 32CEEB          13      LD  (FDWT_SECTOR),A
001A83 EB7C DD7E0D          19      LD  A,(IX+DPB_MAXSEC)   ;フロッピーディスクの1トラックのセクタ数
001A86 EB7F 93               4      SUB E
001A87 EB80 3C               4      INC A
001A88 EB81 67               4      LD  H,A
001A89 EB82 D1              10      POP DE
001A8A EB83 3A32E5          13      LD  A,(SECSZ_H) ;1セクタのサイズの上位1バイト
001A8D EB86 4F               4      LD  C,A
001A8E EB87 AF               4      XOR A
       EB88                     FDWT2:
001A8F EB88 81               4      ADD A,C
001A90 EB89 13               6      INC DE
001A91 EB8A 05               4      DEC B
001A92 EB8B 2807            12      JR  Z,FDWT3
001A94 EB8D 25               4      DEC H       ;トラック、ヘッドを跨がない
001A95 EB8E 2804            12      JR  Z,FDWT3
001A97 EB90 FE3A             7      CP  03AH        ;バッファとして04000H-07BFFHまで使える
001A99 EB92 38F4            12      JR  C,FDWT2
       EB94                     FDWT3:
001A9B EB94 4F               4      LD  C,A
001A9C EB95 E1              10      POP HL
001A9D EB96 3E16             7      LD  A,16H       ;高速レシーブメモリ
001A9F EB98 CDBBEA          17      CALL    PUTCOM
001AA2 EB9B 3E40             7      LD  A,DSS_DATA/256  ;開始アドレスH
001AA4 EB9D CDC1EA          17      CALL    PUTDAT
001AA7 EBA0 AF               4      XOR A       ;開始アドレスL
001AA8 EBA1 CDC1EA          17      CALL    PUTDAT
001AAB EBA4 79               4      LD  A,C     ;バイト数H
001AAC EBA5 CDC1EA          17      CALL    PUTDAT
001AAF EBA8 AF               4      XOR A       ;バイト数L
001AB0 EBA9 CDC1EA          17      CALL    PUTDAT
001AB3 EBAC C5              11      PUSH    BC
001AB4 EBAD 41               4      LD  B,C
001AB5 EBAE 0E00             7      LD  C,0
001AB7 EBB0 CD05EB          17      CALL    FPUTDAT
001ABA EBB3 C1              10      POP BC
001ABB EBB4 CDB9EA          17      CALL    PUTCOM_EXECUTE      ;エグゼキュート
001ABE EBB7 3E7C             7      LD  A,WRITEDISKEX/256
001AC0 EBB9 CDC1EA          17      CALL    PUTDAT
001AC3 EBBC 3EA3             7      LD  A,WRITEDISKEX%256
001AC5 EBBE CDC1EA          17      CALL    PUTDAT
001AC8 EBC1 DD7E13          19      LD  A,(IX+DPB_UNITNO)   ;デバイスドライバ内におけるユニット番号
001ACB EBC4 CDC1EA          17      CALL    PUTDAT
001ACE EBC7 DD7E0D          19      LD  A,(IX+DPB_MAXSEC)   ;フロッピーディスクの1トラックのセクタ数
001AD1 EBCA CDC1EA          17      CALL    PUTDAT
001AD4 EBCD 3E00             7      LD  A,0     ;セクタ
       EBCE                     FDWT_SECTOR EQU $-1
001AD6 EBCF CDC1EA          17      CALL    PUTDAT
001AD9 EBD2 3E00             7      LD  A,0     ;トラック
       EBD3                     FDWT_TRACK  EQU $-1
001ADB EBD4 CDC1EA          17      CALL    PUTDAT
001ADE EBD7 DD7E0A          19      LD  A,(IX+DPB_FDMODE)   ;フロッピーディスクのモード
001AE1 EBDA CDC1EA          17      CALL    PUTDAT
001AE4 EBDD 3A32E5          13      LD  A,(SECSZ_H) ;1セクタのサイズの上位1バイト
001AE7 EBE0 CDC1EA          17      CALL    PUTDAT
001AEA EBE3 79               4      LD  A,C
001AEB EBE4 CDC1EA          17      CALL    PUTDAT      ;バイト数H
001AEE EBE7 DD7E0C          19      LD  A,(IX+DPB_MAXCYL)   ;フロッピーディスクのシリンダ数
001AF1 EBEA CDC1EA          17      CALL    PUTDAT
                                
001AF4 EBED CDB9EA          17      CALL    PUTCOM_EXECUTE      ;エグゼキュート
001AF7 EBF0 3E7E             7      LD  A,RESULTEX/256
001AF9 EBF2 CDC1EA          17      CALL    PUTDAT
001AFC EBF5 3E13             7      LD  A,RESULTEX%256
001AFE EBF7 CDC1EA          17      CALL    PUTDAT
                                
001B01 EBFA CDE6EA          17      CALL    GETDAT
001B04 EBFD 4F               4      LD  C,A
001B05 EBFE FE01             7      CP  1
001B07 EC00 D8              11      RET C
                                
001B08 EC01 78               4      LD  A,B
001B09 EC02 B7               4      OR  A
001B0A EC03 C26FEB          10      JP  NZ,FDWT
001B0D EC06 C9              10      RET
                                
       EC07                     FDRD:
001B0E EC07 CDB9EA          17      CALL    PUTCOM_EXECUTE      ;エグゼキュート
001B11 EC0A 3E7C             7      LD  A,READDISKEX/256
001B13 EC0C CDC1EA          17      CALL    PUTDAT
001B16 EC0F AF               4      XOR A
001B17 EC10 CDC1EA          17      CALL    PUTDAT
001B1A EC13 DD7E13          19      LD  A,(IX+DPB_UNITNO)   ;デバイスドライバ内におけるユニット番号
001B1D EC16 CDC1EA          17      CALL    PUTDAT
001B20 EC19 DD7E0D          19      LD  A,(IX+DPB_MAXSEC)   ;フロッピーディスクの1トラックのセクタ数
001B23 EC1C CDC1EA          17      CALL    PUTDAT
001B26 EC1F E5              11      PUSH    HL
001B27 EC20 D5              11      PUSH    DE
001B28 EC21 CD57EB          17      CALL    CALC_SECTOR
001B2B EC24 7B               4      LD  A,E     ;セクタ
001B2C EC25 CDC1EA          17      CALL    PUTDAT
001B2F EC28 7A               4      LD  A,D     ;トラック
001B30 EC29 CDC1EA          17      CALL    PUTDAT
001B33 EC2C DD7E0D          19      LD  A,(IX+DPB_MAXSEC)   ;フロッピーディスクの1トラックのセクタ数
001B36 EC2F 93               4      SUB E
001B37 EC30 3C               4      INC A
001B38 EC31 67               4      LD  H,A
001B39 EC32 D1              10      POP DE
001B3A EC33 DD7E0A          19      LD  A,(IX+DPB_FDMODE)   ;フロッピーディスクのモード
001B3D EC36 CDC1EA          17      CALL    PUTDAT
001B40 EC39 3A32E5          13      LD  A,(SECSZ_H) ;1セクタのサイズの上位1バイト
001B43 EC3C CDC1EA          17      CALL    PUTDAT
001B46 EC3F 4F               4      LD  C,A
001B47 EC40 AF               4      XOR A
       EC41                     FDRD2:
001B48 EC41 81               4      ADD A,C
001B49 EC42 13               6      INC DE
001B4A EC43 05               4      DEC B
001B4B EC44 2807            12      JR  Z,FDRD3
001B4D EC46 25               4      DEC H       ;トラック、ヘッドを跨がない
001B4E EC47 2804            12      JR  Z,FDRD3
001B50 EC49 FE3A             7      CP  03AH        ;バッファとして04000H-07BFFHまで使える
001B52 EC4B 38F4            12      JR  C,FDRD2
       EC4D                     FDRD3:
001B54 EC4D E1              10      POP HL
001B55 EC4E 4F               4      LD  C,A
001B56 EC4F CDC1EA          17      CALL    PUTDAT      ;バイト数H
001B59 EC52 DD7E0C          19      LD  A,(IX+DPB_MAXCYL)   ;フロッピーディスクのシリンダ数
001B5C EC55 CDC1EA          17      CALL    PUTDAT
                                
001B5F EC58 CDB9EA          17      CALL    PUTCOM_EXECUTE      ;エグゼキュート
001B62 EC5B 3E7E             7      LD  A,RESULTEX/256
001B64 EC5D CDC1EA          17      CALL    PUTDAT
001B67 EC60 3E13             7      LD  A,RESULTEX%256
001B69 EC62 CDC1EA          17      CALL    PUTDAT
                                
001B6C EC65 CDE6EA          17      CALL    GETDAT
001B6F EC68 4F               4      LD  C,A
001B70 EC69 FE01             7      CP  1
001B72 EC6B D8              11      RET C
                                
001B73 EC6C 3E15             7      LD  A,15H       ;高速センドメモリ
001B75 EC6E CDBBEA          17      CALL    PUTCOM
001B78 EC71 3E40             7      LD  A,DSS_DATA/256  ;開始アドレスH
001B7A EC73 CDC1EA          17      CALL    PUTDAT
001B7D EC76 AF               4      XOR A       ;開始アドレスL
001B7E EC77 CDC1EA          17      CALL    PUTDAT
001B81 EC7A 79               4      LD  A,C     ;バイト数H
001B82 EC7B CDC1EA          17      CALL    PUTDAT
001B85 EC7E AF               4      XOR A       ;バイト数L
001B86 EC7F CDC1EA          17      CALL    PUTDAT
001B89 EC82 C5              11      PUSH    BC
001B8A EC83 41               4      LD  B,C
001B8B EC84 0E00             7      LD  C,0
001B8D EC86 CD30EB          17      CALL    FGETDAT
001B90 EC89 C1              10      POP BC
001B91 EC8A 78               4      LD  A,B
001B92 EC8B B7               4      OR  A
001B93 EC8C C207EC          10      JP  NZ,FDRD
001B96 EC8F C9              10      RET
                                
[EOF:88DISK.ASM:UTF_8]
                                    INCLUDE "88INTVEC.ASM"
                                
                                ;   LSX-Dodgers TABLE 割り込みベクタとI/Oルーチン
                                
       EC90                     AT_TABLE:
001B97 EC90                         DS  INTAD-AT_TABLE
                                
                                ;
                                ;   割り込みベクタ:アドレス下位1バイトが0になるように
                                ;   高速RAM(0F000H-0FFFFH)と被らないようにする
                                ;
       ED00                     IRXRDY:
001C07 ED00 C3E2                    DW  INTE88
       ED02                     IVRTC:
001C09 ED02 8DE2                    DW  INTVRTC
       ED04                     ICLOCK:
001C0B ED04 C3E2                    DW  INTE88
       ED06                     IINT4:
001C0D ED06 C3E2                    DW  INTE88
       ED08                     IINT3:
001C0F ED08 C3E2                    DW  INTE88
       ED0A                     IINT2:
001C11 ED0A C3E2                    DW  INTE88
       ED0C                     IFDINT1:
001C13 ED0C C3E2                    DW  INTE88
       ED0E                     IFDINT2:
001C15 ED0E C3E2                    DW  INTE88
                                
001C17 ED10                         DS  030H-18
       ED2E                     EXTSP:
                                
[EOF:88INTVEC.ASM:SHIFT_JIS]
                                    INCLUDE "LDCCPWK.ASM"
                                
                                ;   LSX-Dodgers CCP WORK
                                
       003B                     PATHX   EQU 59
001C35 ED2E                     PATHD:  DS  PATHX
001C70 ED69 00                  PATHE:  DB  0
                                
       ED6A                     DTA_CCP:
001C71 ED6A                         DS  37
                                
       ED8F                     FCB_BAT:
001C96 ED8F                         DS  37
                                
001CBB EDB4 2020203C4449523E    DIRMES: DB  "   <DIR>  $"
            202024              
001CC6 EDBF 20667265652024      FREE:   DB  " free $"
[EOF:LDCCPWK.ASM:UTF_8]
                                    INCLUDE "LDWORK.ASM"
                                
                                ;   LSX-Dodgers WORK0
                                ;
                                ;   CP/M互換BIOS
                                ;   BOOT:アドレス下位1バイトが0になるように
       EDC6                     AT_WORK:
001CCD EDC6                         DS  WORKAD-AT_WORK
                                
       EE00                     CPM_BOOT:
001D07 EE00 C30000          10      JP  0
       EE03                     _SYS00:     ;(BDOS)プログラム終了
       EE03                     CPM_WBOOT:
001D0A EE03 C309D9          10      JP  WBOOT1
       EE06                     CPM_CONST:
001D0D EE06 C33EE3          10      JP  CONSTX
       EE09                     _SYS07:     ;(BDOS)コンソール直接入力
       EE09                     CPM_CONIN:
001D10 EE09 C322E3          10      JP  FLGET
       EE0C                     CPM_CONOUT:
001D13 EE0C C385E1          10      JP  CONOUT1
                                
       EE0F                     DECBF:              ;10進数表示時のバッファ(5バイト)
001D16 EE0F                         DS  5
       EE0F                     RR_BUF_HL   EQU DECBF   ;CP/M互換ファイルアクセスの際のランダムレコードの一時的な保管場所
       EE11                     RR_BUF_A    EQU DECBF+2 ;計3バイト
                                
       EE14                     FDRV:
001D1B EE14 00                      DB  0
       EE15                     FNAME:
001D1C EE15                         DS  36
       EE39                     SFILE:
001D40 EE39                         DS  33      ;DRV FILENAME
       EE5A                     _DISKE:
001D61 EE5A C363E0          10      JP  SHOW_ERROR
                                
001D64 EE5D 0000                LEFTX:  DW  0
001D66 EE5F 0000                DTAX:   DW  0
                                
       EE61                     ZERO:
       EE61                     BEEPD:
001D68 EE61 008E01000B000C10        DB  0,08EH,1,0,00BH,0,00CH,010H
001D70 EE69 073E08100D00FF          DB  007H,03EH,008H,010H,00DH,0,0FFH
       EE62                     RTC_YY  EQU BEEPD+1
       EE63                     RTC_MW  EQU BEEPD+2
       EE64                     RTC_DD  EQU BEEPD+3
       EE65                     RTC_TT  EQU BEEPD+4
       EE66                     RTC_MM  EQU BEEPD+5
       EE67                     RTC_SS  EQU BEEPD+6
       EE62                     ROM_SLT EQU BEEPD+1
                                
       EE70                     CHECK:
001D77 EE70 00                      DB  0
                                
       EE71                     OK:
001D78 EE71 4F4B24                  DB  "OK$"
001D7B EE74                         DS  5
       EE79                     COMERM:
001D80 EE79 4572726F722124          DB  "Error!$"
                                ;   システムワークエリア
                                ;   _CYL0:アドレス下位1バイトが080Hになるように
       EE80                     _CYL0:
001D87 EE80 FF                      DB  0FFH    ;Cylinder
       EE81                     _CYL1:
001D88 EE81 FF                      DB  0FFH    ;Cylinder
       EE82                     _CYL2:
001D89 EE82 FF                      DB  0FFH    ;Cylinder
       EE83                     _CYL3:
001D8A EE83 FF                      DB  0FFH    ;Cylinder
       EE84                     _DRIVE:
001D8B EE84 00                      DB  0   ;unit number
       EE85                     _SEEKSP:
001D8C EE85 00                      DB  0   ;Seek speed
       EE86                     _ISEEK:
001D8D EE86 32                      DB  50  ;
001D8E EE87                         DS  1
       EE88                     _DRV:
001D8F EE88 00                      DB  0
       EE89                     _DSK:
001D90 EE89 FF                      DB  0FFH
       EE8A                     _DTA:
001D91 EE8A 8000                    DW  00080H
       EE8C                     _CTC:
001D93 EE8C 0000                    DW  0
       EE8E                     _TXADR:
001D95 EE8E 0000                    DW  0
       EE90                     _KEYPS:
001D97 EE90 0000                    DW  0
       EE92                     _KEYD:
001D99 EE92 00FF                    DW  0FF00H  ;キーデータ
       EE94                     _KEYSP:
001D9B EE94 0010                    DB  KEYSP_L,KEYSP_H ;オートリピートの速度
       EE96                     _COLORF:
001D9D EE96 00                      DB  COLORF  ;色
       EE97                     _LINE:
001D9E EE97 18                      DB  LINE
                                
       EE98                     _FCB:
001D9F EE98 0000                    DW  0   ;SEARCH FILES
       EE9A                     _FBPS:
001DA1 EE9A 0000                    DW  0   ;    //
       EE9C                     _FBAD:
001DA3 EE9C 0000                    DW  0   ;    //
       EE9E                     _FBCNT:
001DA5 EE9E 00                      DB  0   ;    //
       EE9F                     _FILEN:
001DA6 EE9F 00                      DB  0   ;    //
       EEA0                     _DIRF:
001DA7 EEA0 00                      DB  0   ;bit7:ディレクトリ bit0-6:セクタインデックス
001DA8 EEA1                         DS  1
       EEA2                     _WTFATF:
001DA9 EEA2 00                      DB  0   ;FATバッファの更新フラグ
001DAA EEA3                         DS  1
       EEA4                     _WTDBF:
001DAB EEA4 00                      DB  0   ;データバッファの更新フラグ
       EEA5                     _DBDRV:
001DAC EEA5 FF                      DB  0FFH    ;データバッファにあるデータを読み込んだドライブ
       EEA6                     _DBSEC:
001DAD EEA6 0000                    DW  0   ;データバッファにあるデータを読み込んだセクタ番号
       EEA8                     _DPB:
001DAF EEA8 0000                    DW  0
       EEAA                     _FATDRV:
001DB1 EEAA FF                      DB  0FFH    ;FATバッファに読み込んでいるドライブ
       EEAB                     _FATIX:
001DB2 EEAB 00                      DB  0   ;FATバッファに読み込んでいるインデックス
       EEAC                     _FAKEFREE:
001DB3 EEAC 0000                    DW  0   ;偽の残量（FATサイズが大きくなると重くなるのでその対策）
                                
001DB5 EEAE                         DS  2
                                
       EEB0                     CRTCD:
001DB7 EEB0 6F                      DB  06FH
       EEB1                     _WIDTH:
001DB8 EEB1 50                      DB  WIDTH
       EEB2                     TVRAMTOP:
001DB9 EEB2 5938                    DB  059H,038H
001DBB EEB4 1F02                    DB  01FH,002H
       EEB6                     _LINE2:
001DBD EEB6 19                      DB  019H
       EEB7                     WKE4:
001DBE EEB7 1C                      DB  01CH
       EEB8                     WKE6:
001DBF EEB8 00                      DB  000H
       EEB9                     WK40:
001DC0 EEB9 07                      DB  007H
       EEBA                     _PAGE_MINUS:
001DC1 EEBA 80F8                    DW  0-WIDTH*LINE
       EEBC                     _WIDTH_MINUS:
001DC3 EEBC B0FF                    DW  0-WIDTH
       EEBE                     WK30:
001DC5 EEBE 0C                      DB  00CH
       EEBF                     WK31:
       EEBF                     WK1FD0:
001DC6 EEBF 20                      DB  020H
                                
001DC7 EEC0 0000                CTC0:   DW  INTCTCE
001DC9 EEC2 0000                CTC1:   DW  INTCTCE
001DCB EEC4 0000                CTC2:   DW  INTCTCE
001DCD EEC6 0000                CTC3:   DW  INTCTCE
001DCF EEC8 0000                INTVEC: DW  INT
                                
                                ;   LSX-Dodgers 独自BIOS
                                
001DD1 EECA C308E2          10  _INKEY: JP  INKEY
001DD4 EECD C344E1          10  _PRINT: JP  PRINT
001DD7 EED0 C36EE2          10  _SCRN:  JP  SCRN
001DDA EED3 C3AAE1          10  _POS:   JP  POS
001DDD EED6 C39DF0          10  _LOC:   JP  LOC
       EED9                     _CHGDRV:
001DE0 EED9 C3C2E9          10      JP  CHGDRV
       EEDC                     _GETDPB:
001DE3 EEDC C380EA          10      JP  GETDPB
       EEDF                     _FFLUSH:
001DE6 EEDF C39EEA          10      JP  FFLUSH
       EEE2                     _RDFATX:
001DE9 EEE2 C39AE6          10      JP  RDFATX
001DEC EEE5 C3CCE7          10  _RDFAT: JP  RDFAT
001DEF EEE8 C36DEB          10  _WTTRK: JP  WTTRK
001DF2 EEEB C307EC          10  _FDRD:  JP  FDRD
001DF5 EEEE C36FEB          10  _FDWT:  JP  FDWT
       EEF1                     _BPB2DPB:
001DF8 EEF1 C364E8          10      JP  BPB2DPB
       EEF4                     _BREAK:
001DFB EEF4 C3A9DA          10      JP  END_BATCH
       EEF7                     _GNCL:
001DFE EEF7 C346E7          10      JP  GNCL        ; self-modifying code
       EEF8                     GNCPAT  EQU $-2
       EEFA                     _SNCL:
001E01 EEFA C369E7          10      JP  SNCL        ; self-modifying code
       EEFB                     SNCPAT  EQU $-2
       EEFD                     _COMANL:
001E04 EEFD C362D9          10      JP  COMANL
                                
       EF00                     _WE:
[EOF:LDWORK.ASM:SHIFT_JIS]
                                    INCLUDE "LDCALL.ASM"
                                
                                ;   LSX-Dodgers システムコール(BDOS)
                                ;
                                ;   LSX-Dodgers SYSTEM CALL
                                ;   STABLE:アドレス下位1バイトが0になるように
                                
       EF00                     STABLE:
                                ;0
001E07 EF00 03EEF5E201E3AAF1        DW  _SYS00,_SYS01,_SYS02,_SYS03
001E0F EF08 CEDDCEDD06E309EE        DW  _SYS04,_SYS05,_SYS06,_SYS07
001E17 EF10 0EE3D0DD75E036E3        DW  _SYS08,_SYS09,_SYS0A,_SYS0B
001E1F EF18 E5DDEADDF9DD0ADE        DW  _SYS0C,_SYS0D,_SYS0E,_SYS0F
                                ;1
001E27 EF20 5EDEA5DEEEDE1FDF        DW  _SYS10,_SYS11,_SYS12,_SYS13
001E2F EF28 27DF3DDF52DF4ADF        DW  _SYS14,_SYS15,_SYS16,_SYS17
001E37 EF30 99DF9EDFA3DFA9DF        DW  _SYS18,_SYS19,_SYS1A,_SYS1B
001E3F EF38 CEDDCFDFCEDDD3DF        DW  _SYS1C,_SYS1D,_SYS1E,_SYS1F
                                ;2
001E47 EF40 CEDD89DF91DFDADF        DW  _SYS20,_SYS21,_SYS22,_SYS23
001E4F EF48 FFDFCEDD5AE328E4        DW  _SYS24,_ERROR,_SYS26,_SYS27
001E57 EF50 91DF09E0A1E0AAF1        DW  _SYS28,_SYS29,_SYS2A,_SYS2B
001E5F EF58 C8E0AAF1CEDD2AE0        DW  _SYS2C,_SYS2D,_SYS2E,_SYS2F
                                ;3
001E67 EF60 24E0CEDDCEDDCEDD        DW  _SYS30,_ERROR,_ERROR,_ERROR
001E6F EF68 CEDDCEDDCEDDCEDD        DW  _ERROR,_ERROR,_ERROR,_ERROR
001E77 EF70 CEDDAAF1AAF14BE0        DW  _ERROR,_SYS39,_SYS3A,_SYS5A
                                ;DOS2
001E7F EF78 B1DD                    DW  _DOS2
                                
001E81 EF7A                         DS  1
       EF7B                     _MAX_SEC_SZ_H:
001E82 EF7B 02                      DB  MAX_SEC_SZ_H
       EF7C                     _FATBF:
001E83 EF7C 00F7                    DW  FATBF
       EF7E                     _DTBUF:
001E85 EF7E 00FD                    DW  DTBUF
                                
                                ;   コントロールコードテーブル
                                ;   CTRLTB:アドレス下位1バイトが080Hになるように
                                
       EF80                     CTRLTB:
001E87 EF80 A0F0A0F0D7F074F1        DW  CTRL00,CTRL00,CTRL02,CTRL03 ;  A,B,C
001E8F EF88 6EF1F8F051F127F1        DW  CTRL04,CTRL05,CTRL06,CTRL07 ;D,E,F,G
001E97 EF90 A7F0CCF077F11AF1        DW  CTRL08,CTRL09,CTRL0A,CTRL0B ;H,I,J,K
001E9F EF98 4EF10DF17EF1A0F0        DW  CTRL0C,CTRL0D,CTRL0E,CTRL00 ;L,M,N,O
001EA7 EFA0 A0F0A0F012F1A0F0        DW  CTRL00,CTRL00,CTRL12,CTRL00 ;P,Q,R,S
001EAF EFA8 A0F0A0F0A0F0A0F0        DW  CTRL00,CTRL00,CTRL00,CTRL00 ;T,U,V,W
001EB7 EFB0 A0F0A0F04EF121F1        DW  CTRL00,CTRL00,CTRL0C,CTRL1B ;X,Y,Z,ESC
001EBF EFB8 89F0AEF0C3F077F1        DW  CTRL1C,CTRL1D,CTRL1E,CTRL1F ;→,←,↑,↓
                                
001EC7 EFC0 0200                M2D:    DW  2
001EC9 EFC2 FD02                    DB  0FDH,2
001ECB EFC4 6401                    DW  356
001ECD EFC6 FF0728090182            DB  0FFH,7,40,9,1,082H
001ED3 EFCC 0500A7000800            DW  5,0A7H,8
                                
001ED9 EFD2 0200                M2HD:   DW  2
001EDB EFD4 FE01                    DB  0FEH,1
001EDD EFD6 C704                    DW  1223
001EDF EFD8 FE064D080184            DB  0FEH,6,77,8,1,084H
001EE5 EFDE 0500A7000900            DW  5,0A7H,9
                                
001EEB EFE4 1617                SDDATA: DB  22,23       ;(FCB)ファイルを最後に変更した時刻
001EED EFE6 1415                    DB  20,21       ;(FCB)ファイルを最後に変更した日付
001EEF EFE8 1A1B                    DB  26,27       ;(FCB)ファイルの先頭クラスタ
001EF1 EFEA 10111213                DB  16,17,18,19 ;(FCB)ファイルのサイズ(バイト単位)
       EFEE                     SDDATAE:
                                
001EF5 EFEE                         DS  2
       EFF0                     _FCB_BAT:
001EF7 EFF0 8FED                    DW  FCB_BAT
       EFF2                     _PATH:
001EF9 EFF2 2EED                    DW  PATHD
                                
001EFB EFF4                     SCDIR:  DS  2       ;+14 +15
001EFD EFF6                     SFBPS:  DS  2       ;FBPS
001EFF EFF8                     SFNDF:  DS  2       ;FILEN DIRF
                                
001F01 EFFA 0000                _FATPS: DW  0
001F03 EFFC 0000                _DIRPS: DW  0
001F05 EFFE 0000                _CLPS:  DW  0
                                
       F000                     _PE:
[EOF:LDCALL.ASM:SHIFT_JIS]
                                    INCLUDE "LDFILE.ASM"
                                
                                ;   LSX-Dodgers FILE
                                
                                ;   【注意】バイナリサイズを下位1バイトを0丁度に調整する必要あり(X1/88)
       0000                     CHECK_FILE_SIZE EQU (FILEC-FILE_E) & 0FFH
       F000                     FILEC:
001F07 F000 CD0BF0          17      CALL    FILE
       F003                     FILEC2:
001F0A F003 3A15EE          13      LD  A,(FDRV+1)
001F0D F006 FE20             7      CP  020H
001F0F F008 C8              11      RET Z
001F10 F009 1839            12      JR  SETDIR1
                                
       F00B                     FILE:
001F12 F00B AF               4      XOR A
001F13 F00C 3214EE          13      LD  (FDRV),A
001F16 F00F 67               4      LD  H,A
001F17 F010 6F               4      LD  L,A
001F18 F011 2222EE          16      LD  (FDRV+14),HL
001F1B F014 CDE1F0          17      CALL    SPCUT
001F1E F017 CDC6F0          17      CALL    CCHK3
001F21 F01A 2812            12      JR  Z,DEVI1
001F23 F01C 13               6      INC DE
001F24 F01D 1A               7      LD  A,(DE)
001F25 F01E 1B               6      DEC DE
001F26 F01F FE3A             7      CP  ':'
001F28 F021 200B            12      JR  NZ,DEVI1
001F2A F023 1A               7      LD  A,(DE)      ;DRIVE
001F2B F024 CD27F3          17      CALL    CAP
001F2E F027 D640             7      SUB '@'
001F30 F029 13               6      INC DE
001F31 F02A 13               6      INC DE
001F32 F02B 3214EE          13      LD  (FDRV),A
       F02E                     DEVI1:
001F35 F02E 1A               7      LD  A,(DE)
001F36 F02F D65C             7      SUB 05CH        ;\
001F38 F031 2009            12      JR  NZ,NOROOT
001F3A F033 6F               4      LD  L,A     ;A=0でH=0のはずなのでHL=0
001F3B F034 222EEE          16      LD  (FDRV+26),HL
001F3E F037 2C               4      INC L
001F3F F038 2222EE          16      LD  (FDRV+14),HL
001F42 F03B 13               6      INC DE
       F03C                     NOROOT:
                                
       F03C                     SETDIR:
001F43 F03C CD67F0          17      CALL    FILED
001F46 F03F 1A               7      LD  A,(DE)
001F47 F040 FE5C             7      CP  05CH        ;\
001F49 F042 C0              11      RET NZ
001F4A F043 13               6      INC DE
       F044                     SETDIR1:
001F4B F044 3E10             7      LD  A,010H      ;Directory
001F4D F046 3221EE          13      LD  (FDRV+13),A
001F50 F049 D5              11      PUSH    DE
001F51 F04A 1114EE          10      LD  DE,FDRV
001F54 F04D 0E0F             7      LD  C,00FH      ;(BDOS)ファイルのオープン
001F56 F04F CD9FDD          17      CALL    BDOS0
001F59 F052 D1              10      POP DE
001F5A F053 B7               4      OR  A
001F5B F054 C0              11      RET NZ
                                
001F5C F055 3A21EE          13      LD  A,(FDRV+13)
001F5F F058 E610             7      AND 010H        ;ディレクトリ
001F61 F05A C8              11      RET Z
                                
001F62 F05B CDAEF0          17      CALL    FILEI
001F65 F05E 2A2EEE          16      LD  HL,(FDRV+26)
001F68 F061 23               6      INC HL
001F69 F062 2222EE          16      LD  (FDRV+14),HL
001F6C F065 18D5            12      JR  SETDIR
                                
       F067                     FILED:
001F6E F067 CDAEF0          17      CALL    FILEI
001F71 F06A 2115EE          10      LD  HL,FNAME
                                
001F74 F06D 0608             7      LD  B,8
       F06F                     FILE2:
001F76 F06F CDBBF0          17      CALL    CCHKF
001F79 F072 C8              11      RET Z
001F7A F073 FE2A             7      CP  '*'
001F7C F075 282E            12      JR  Z,FILE9
001F7E F077 FE2E             7      CP  '.'
001F80 F079 280C            12      JR  Z,FILE4
001F82 F07B 77               7      LD  (HL),A
001F83 F07C 23               6      INC HL
001F84 F07D 10F0            13      DJNZ    FILE2
                                
       F07F                     FILE3:
001F86 F07F CDBBF0          17      CALL    CCHKF
001F89 F082 C8              11      RET Z
001F8A F083 FE2E             7      CP  '.'
001F8C F085 20F8            12      JR  NZ,FILE3
                                
       F087                     FILE4:
001F8E F087 211DEE          10      LD  HL,FNAME+8
001F91 F08A 0603             7      LD  B,3
                                
       F08C                     FILE4L:
001F93 F08C CDBBF0          17      CALL    CCHKF
001F96 F08F C8              11      RET Z
001F97 F090 FE2E             7      CP  '.'
001F99 F092 2008            12      JR  NZ,FILE12
001F9B F094 3215EE          13      LD  (FNAME),A   ;Parent directory(..)
001F9E F097 3216EE          13      LD  (FNAME+1),A
001FA1 F09A 3E20             7      LD  A,020H
       F09C                     FILE12:
001FA3 F09C FE2A             7      CP  '*'
001FA5 F09E 280A            12      JR  Z,FILE10
001FA7 F0A0 77               7      LD  (HL),A
001FA8 F0A1 23               6      INC HL
001FA9 F0A2 10E8            13      DJNZ    FILE4L
001FAB F0A4 C9              10      RET
                                
       F0A5                     FILE9:              ;名前の*処理、名前の残りを?で埋める
001FAC F0A5 CDAAF0          17      CALL    FILE10
001FAF F0A8 18D5            12      JR  FILE3
                                
       F0AA                     FILE10:
001FB1 F0AA 3E3F             7      LD  A,'?'
001FB3 F0AC 1808            12      JR  FILL_MEMORY
       F0AE                     FILEI:              ;名前＋拡張子をスペースで初期化
001FB5 F0AE 3E20             7      LD  A,020H
001FB7 F0B0 01000B          10      LD  BC,11*256   ;C=0にしておく
001FBA F0B3 2115EE          10      LD  HL,FNAME
       F0B6                     FILL_MEMORY:            ;HLからBバイトAで埋める
001FBD F0B6 77               7      LD  (HL),A
001FBE F0B7 23               6      INC HL
001FBF F0B8 10FC            13      DJNZ    FILL_MEMORY
001FC1 F0BA C9              10      RET
                                
       F0BB                     CCHKF:
001FC2 F0BB 1A               7      LD  A,(DE)
001FC3 F0BC CDC3F0          17      CALL    CCHK2
001FC6 F0BF C8              11      RET Z
001FC7 F0C0 C32FF4          10      JP  FKAN
                                
       F0C3                     CCHK2:
001FCA F0C3 0C               4      INC C
001FCB F0C4 0D               4      DEC C
001FCC F0C5 C0              11      RET NZ
       F0C6                     CCHK3:              ;ZF=1 で使えない文字
001FCD F0C6 FE2B             7      CP  '+'
001FCF F0C8 C8              11      RET Z
001FD0 F0C9 FE2C             7      CP  ','
001FD2 F0CB C8              11      RET Z
001FD3 F0CC FE2F             7      CP  '/'
001FD5 F0CE C8              11      RET Z
001FD6 F0CF FE3A             7      CP  ':'
001FD8 F0D1 C8              11      RET Z
001FD9 F0D2 FE3B             7      CP  ';'
001FDB F0D4 C8              11      RET Z
001FDC F0D5 FE3D             7      CP  '='
001FDE F0D7 C8              11      RET Z
001FDF F0D8 FE5C             7      CP  05CH    ;\
001FE1 F0DA C8              11      RET Z
001FE2 F0DB FE20             7      CP  020H
001FE4 F0DD D0              11      RET NC
001FE5 F0DE BF               4      CP  A       ;Z=1
001FE6 F0DF C9              10      RET
                                
       F0E0                     SS1:
001FE7 F0E0 13               6      INC DE
       F0E1                     SPCUT:              ;スペースをカット
001FE8 F0E1 1A               7      LD  A,(DE)
001FE9 F0E2 FE20             7      CP  020H
001FEB F0E4 28FA            12      JR  Z,SS1
001FED F0E6 C9              10      RET
                                
       F0E7                     SETDRVF:
001FEE F0E7 1114EE          10      LD  DE,FDRV
       F0EA                     SETDRV0:
001FF1 F0EA CDF3F0          17      CALL    SETDRV
001FF4 F0ED FDE1            14      POP IY
001FF6 F0EF C1              10      POP BC
001FF7 F0F0 D1              10      POP DE
001FF8 F0F1 E1              10      POP HL
001FF9 F0F2 C9              10      RET
                                
       F0F3                     SETDRV:
001FFA F0F3 E3              19      EX  (SP),HL     ;HL=RETRN ADDRESS
001FFB F0F4 D5              11      PUSH    DE      ;PUSH HL/DE/BC/IY
001FFC F0F5 C5              11      PUSH    BC
001FFD F0F6 1A               7      LD  A,(DE)
001FFE F0F7 D5              11      PUSH    DE
001FFF F0F8 FDE3            23      EX  (SP),IY
                                
002001 F0FA CD01F1          17      CALL    GETDRV
002004 F0FD CDD9EE          17      CALL    _CHGDRV
                                
002007 F100 E9               4      JP  (HL)
                                
       F101                     GETDRV:
002008 F101 CD14F1          17      CALL    GETDRV1
00200B F104 3288EE          13      LD  (_DRV),A
00200E F107 C9              10      RET
                                
       F108                     IS_SAME_DRV_A_DE:
                                ;   A と (DE) が同じドライブか調べる
                                ;   ZF=1ならば同じドライブ
00200F F108 CD14F1          17      CALL    GETDRV1
002012 F10B C5              11      PUSH    BC
002013 F10C 4F               4      LD  C,A
002014 F10D 1A               7      LD  A,(DE)
002015 F10E CD14F1          17      CALL    GETDRV1
002018 F111 A9               4      XOR C
002019 F112 C1              10      POP BC
00201A F113 C9              10      RET
       F114                     GETDRV1:
00201B F114 E67F             7      AND 07FH
00201D F116 D601             7      SUB 001H
00201F F118 D0              11      RET NC
002020 F119 3A0400          13      LD  A,(_DVSW)   ;Current Drive
002023 F11C C9              10      RET
                                
       F11D                     SOPENX:
002024 F11D 1139EE          10      LD  DE,SFILE
002027 F120 FD7E00          19      LD  A,(IY+0)        ;(FCB)ドライブ番号
00202A F123 CD08F1          17      CALL    IS_SAME_DRV_A_DE
00202D F126 2024            12      JR  NZ,SOPEN
00202F F128 13               6      INC DE
002030 F129 FDE5            15      PUSH    IY
002032 F12B E1              10      POP HL
002033 F12C 23               6      INC HL
002034 F12D CDB8F2          17      CALL    CPFILE
002037 F130 201A            12      JR  NZ,SOPEN
                                
002039 F132 2AF4EF          16      LD  HL,(SCDIR)
00203C F135 FD750E          19      LD  (IY+14),L   ;(FCB)アクセスするディレクトリのクラスタ番号+1
00203F F138 FD740F          19      LD  (IY+15),H
                                
002042 F13B 2AF8EF          16      LD  HL,(SFNDF)  ;Direcroty location and Flags
002045 F13E 229FEE          16      LD  (_FILEN),HL
                                
002048 F141 ED5BF6EF        20      LD  DE,(SFBPS)
00204C F145 2139EE          10      LD  HL,SFILE
00204F F148 36FF            10      LD  (HL),0FFH
002051 F14A 23               6      INC HL
002052 F14B C9              10      RET
       F14C                     SOPEN:
002053 F14C 2160F2          10      LD  HL,FILESE
       F14F                     SOPENC:
002056 F14F 2288F1          16      LD  (OPENPAT),HL
                                
002059 F152 CDE2EE          17      CALL    _RDFATX     ;Detect Media
00205C F155 3856            12      JR  C,RDDERR
                                
00205E F157 AF               4      XOR A
00205F F158 329FEE          13      LD  (_FILEN),A
002062 F15B CD64F3          17      CALL    LDDIRX1     ;A=0で呼び出す
002065 F15E 2818            12      JR  Z,SDIRX1
                                
002067 F160 CD51F2          17      CALL    READ_DIR    ;Sub Directory
00206A F163 3808            12      JR  C,SDIRX0
00206C F165 2A7EEF          16      LD  HL,(_DTBUF)
00206F F168 7E               7      LD  A,(HL)
002070 F169 FE2E             7      CP  '.'
002072 F16B 280F            12      JR  Z,SOPEN1
       F16D                     SDIRX0:
002074 F16D AF               4      XOR A
002075 F16E 32A0EE          13      LD  (_DIRF),A
002078 F171 FD360E01        19      LD  (IY+14),1   ;(FCB)レコードサイズ
00207C F175 FD770F          19      LD  (IY+15),A
       F178                     SDIRX1:
00207F F178 ED5BFCEF        20      LD  DE,(_DIRPS) ;Root Directory
       F17C                     SOPEN1:
002083 F17C 0E20             7      LD  C,32        ;自己書き換え 1セクタ辺りのディレクトリエントリ数  1024=32 / 512=16 / 256=8
       F17D                     SDECPAT EQU $-1
       F17E                     SOPEN1X:
002085 F17E CD51F2          17      CALL    READ_DIR    ;FILE SEARCH
002088 F181 382A            12      JR  C,RDDERR
00208A F183 2A7EEF          16      LD  HL,(_DTBUF)
       F186                     SOPEN2:
00208D F186 D5              11      PUSH    DE
00208E F187 CD60F2          17      CALL    FILESE      ;(self-modifying code)
       F188                     OPENPAT EQU $-2
002091 F18A D1              10      POP DE
002092 F18B 386D            12      JR  C,SOPENE
002094 F18D 281B            12      JR  Z,SCF_FF_RET
       F18F                     SOPEN3:
002096 F18F 3AA0EE          13      LD  A,(_DIRF)   ;ディレクトリか判別
002099 F192 B7               4      OR  A
00209A F193 200C            12      JR  NZ,SOPEN5
00209C F195 13               6      INC DE      ;ルートディレクトリ
00209D F196 E5              11      PUSH    HL
00209E F197 210C00          10      LD  HL,12       ;(self-modifying code)MAXDIR
       F198                     MD_PAT  EQU $-2
0020A1 F19A ED52            15      SBC HL,DE       ;CF=0 なので SUB HL,DE
0020A3 F19C E1              10      POP HL
0020A4 F19D 20DD            12      JR  NZ,SOPEN1
0020A6 F19F 1807            12      JR  SOPEN6
       F1A1                     SOPEN5:
0020A8 F1A1 CDC5E7          17      CALL    GNCLX       ;END DIR
0020AB F1A4 D8              11      RET C
0020AC F1A5 CD18F3          17      CALL    ENDCL
       F1A8                     SOPEN6:
0020AF F1A8 38D2            12      JR  C,SOPEN1
       F1AA                     SCF_FF_RET:
0020B1 F1AA 37               4      SCF         ;CF=1
0020B2 F1AB 9F               4      SBC A,A     ;A=0FFH
0020B3 F1AC C9              10      RET
                                
       F1AD                     RDDERR:
0020B4 F1AD BF               4      CP  A       ;READ ERR CF=1 ZF=1
0020B5 F1AE 37               4      SCF
0020B6 F1AF C9              10      RET
                                
       F1B0                     NOPEN:
0020B7 F1B0 2160F2          10      LD  HL,FILESE
0020BA F1B3 2288F1          16      LD  (OPENPAT),HL
0020BD F1B6 FD2A98EE        20      LD  IY,(_FCB)
0020C1 F1BA CD42F4          17      CALL    CHKWILDX
0020C4 F1BD 30EB            12      JR  NC,SCF_FF_RET
0020C6 F1BF FD7E00          19      LD  A,(IY+0)
0020C9 F1C2 CD01F1          17      CALL    GETDRV
0020CC F1C5 CDD9EE          17      CALL    _CHGDRV
0020CF F1C8 D8              11      RET C
0020D0 F1C9 2AF8EF          16      LD  HL,(SFNDF)  ;Direcroty location and Flags
0020D3 F1CC 229FEE          16      LD  (_FILEN),HL
                                
0020D6 F1CF CD5FF3          17      CALL    LDDIRX
0020D9 F1D2 ED5B9AEE        20      LD  DE,(_FBPS)
0020DD F1D6 CD51F2          17      CALL    READ_DIR
0020E0 F1D9 38D2            12      JR  C,RDDERR
0020E2 F1DB 3A9EEE          13      LD  A,(_FBCNT)
0020E5 F1DE 3D               4      DEC A
0020E6 F1DF 28AE            12      JR  Z,SOPEN3
       F1E1                     NOPEN2:
0020E8 F1E1 2A9CEE          16      LD  HL,(_FBAD)
0020EB F1E4 012000          10      LD  BC,020H
0020EE F1E7 09              11      ADD HL,BC
0020EF F1E8 4F               4      LD  C,A
0020F0 F1E9 189B            12      JR  SOPEN2
                                
       F1EB                     SOPENE2:
0020F2 F1EB 229CEE          16      LD  (_FBAD),HL
0020F5 F1EE 79               4      LD  A,C
0020F6 F1EF 329EEE          13      LD  (_FBCNT),A
0020F9 F1F2 ED539AEE        20      LD  (_FBPS),DE
0020FD F1F6 FD2298EE        20      LD  (_FCB),IY
       F1FA                     SOPENE:
002101 F1FA AF               4      XOR A
002102 F1FB C9              10      RET
                                
       F1FC                     COPEN:
002103 F1FC FD360D20        19      LD  (IY+13),020H    ;(FCB)属性(アトリビュート)
                                
002107 F200 217DF2          10      LD  HL,NEXTSE
00210A F203 CD4FF1          17      CALL    SOPENC
00210D F206 D0              11      RET NC
00210E F207 C8              11      RET Z
00210F F208 3AA0EE          13      LD  A,(_DIRF)   ;ディレクトリか判別
002112 F20B B7               4      OR  A
002113 F20C 37               4      SCF
002114 F20D C8              11      RET Z       ;ルートディレクトリ
002115 F20E 0601             7      LD  B,1
002117 F210 CDA1F4          17      CALL    WRDF
00211A F213 D8              11      RET C
00211B F214 ED5BFEEF        20      LD  DE,(_CLPS)
00211F F218 D5              11      PUSH    DE
002120 F219 CDE1F2          17      CALL    DCPAT
002123 F21C CD46E6          17      CALL    DRDNX
002126 F21F 2A7EEF          16      LD  HL,(_DTBUF) ;ディレクトリエントリを0クリア
002129 F222 ED4B31E5        20      LD  BC,(SECSZ)  ;1セクタのサイズ
00212D F226 AF               4      XOR A
       F227                     COPENCL:
00212E F227 77               7      LD  (HL),A
00212F F228 EDA1            16      CPI         ;HL=HL+1 BC=BC-1 BCが0の場合にP/V=0
002131 F22A EA27F2          10      JP  PE,COPENCL
                                
002134 F22D 3AFFF2          13      LD  A,(SPCPAT)  ;1クラスタの論理セクタ数
002137 F230 3D               4      DEC A
002138 F231 2819            12      JR  Z,COPENE
00213A F233 3E01             7      LD  A,1     ;1セクタ辺りのセクタ数が2以上の場合
00213C F235 32BDE7          13      LD  (_SECPS),A
00213F F238 D1              10      POP DE      ;DE=(_CLPS)
002140 F239 D5              11      PUSH    DE
       F23A                     COPEN1:
002141 F23A D5              11      PUSH    DE      ;データバッファに入らないセクタもゼロクリア
002142 F23B C5              11      PUSH    BC
002143 F23C 2A7EEF          16      LD  HL,(_DTBUF)
002146 F23F CDFBF2          17      CALL    CLUSTX
002149 F242 CD5CE9          17      CALL    DWT24
00214C F245 C1              10      POP BC
00214D F246 D1              10      POP DE
00214E F247 CDBCE7          17      CALL    NEXTX
002151 F24A 20EE            12      JR  NZ,COPEN1
       F24C                     COPENE:
002153 F24C 2A7EEF          16      LD  HL,(_DTBUF)
002156 F24F D1              10      POP DE
002157 F250 C9              10      RET
                                
       F251                     READ_DIR:
002158 F251 ED53FEEF        20      LD  (_CLPS),DE
00215C F255 C5              11      PUSH    BC
00215D F256 D5              11      PUSH    DE
00215E F257 CDE1F2          17      CALL    DCPAT
002161 F25A CD26E6          17      CALL    DRDX
002164 F25D D1              10      POP DE
002165 F25E C1              10      POP BC
002166 F25F C9              10      RET
                                
       F260                     FILESE:
002167 F260 7E               7      LD  A,(HL)
002168 F261 B7               4      OR  A
002169 F262 C8              11      RET Z       ;END:ZF=1 CF=0
00216A F263 FEE5             7      CP  0E5H
00216C F265 280E            12      JR  Z,FILESE1
00216E F267 FDE5            15      PUSH    IY
002170 F269 D1              10      POP DE
002171 F26A 13               6      INC DE
002172 F26B E5              11      PUSH    HL
002173 F26C CDB8F2          17      CALL    CPFILE
002176 F26F CCD9F2          17      CALL    Z,CPFILE2
002179 F272 E1              10      POP HL
00217A F273 37               4      SCF
00217B F274 C8              11      RET Z       ;!!!:(ZF=1) CF=1
       F275                     FILESE1:
00217C F275 CD8CF2          17      CALL    FNEXT
00217F F278 20E6            12      JR  NZ,FILESE
       F27A                     ZF0_CF0_AFF_RET:
002181 F27A F6FF             7      OR  0FFH        ;ZF=0 CF=0
002183 F27C C9              10      RET
                                
       F27D                     NEXTSE:
002184 F27D 7E               7      LD  A,(HL)
002185 F27E B7               4      OR  A
002186 F27F 37               4      SCF
002187 F280 C8              11      RET Z       ;!!!:ZF=1 CF=1
002188 F281 FEE5             7      CP  0E5H
00218A F283 37               4      SCF
00218B F284 C8              11      RET Z       ;!!!:(ZF=1) CF=1
00218C F285 CD8CF2          17      CALL    FNEXT
00218F F288 20F3            12      JR  NZ,NEXTSE
002191 F28A 18EE            12      JR  ZF0_CF0_AFF_RET
                                
       F28C                     FNEXT:
002193 F28C E5              11      PUSH    HL
002194 F28D 219FEE          10      LD  HL,_FILEN
002197 F290 34              11      INC (HL)
002198 F291 E1              10      POP HL
002199 F292 112000          10      LD  DE,020H
00219C F295 19              11      ADD HL,DE
00219D F296 0D               4      DEC C
00219E F297 C9              10      RET
                                
       F298                     CPNAME:
00219F F298 C5              11      PUSH    BC
0021A0 F299 D5              11      PUSH    DE
0021A1 F29A E5              11      PUSH    HL
0021A2 F29B CDB2F2          17      CALL    CPFILE4
0021A5 F29E E1              10      POP HL
0021A6 F29F 23               6      INC HL
0021A7 F2A0 23               6      INC HL
0021A8 F2A1 23               6      INC HL
0021A9 F2A2 23               6      INC HL
0021AA F2A3 D1              10      POP DE
0021AB F2A4 C1              10      POP BC
0021AC F2A5 2005            12      JR  NZ,CPNAME1
0021AE F2A7 7E               7      LD  A,(HL)
0021AF F2A8 23               6      INC HL
0021B0 F2A9 66               7      LD  H,(HL)
0021B1 F2AA 6F               4      LD  L,A
0021B2 F2AB C9              10      RET
       F2AC                     CPNAME1:
0021B3 F2AC 23               6      INC HL
0021B4 F2AD 23               6      INC HL
0021B5 F2AE 10E8            13      DJNZ    CPNAME
0021B7 F2B0 37               4      SCF
0021B8 F2B1 C9              10      RET
                                
       F2B2                     CPFILE4:
0021B9 F2B2 C5              11      PUSH    BC
0021BA F2B3 010004          10      LD  BC,00400H
0021BD F2B6 1804            12      JR  CPSTR1
       F2B8                     CPFILE:
0021BF F2B8 C5              11      PUSH    BC
0021C0 F2B9 01000B          10      LD  BC,00B00H
       F2BC                     CPSTR1:
0021C3 F2BC 1A               7      LD  A,(DE)
0021C4 F2BD FE3F             7      CP  '?'     ;Wild card
0021C6 F2BF 2812            12      JR  Z,CPSTR2
0021C8 F2C1 7E               7      LD  A,(HL)
0021C9 F2C2 CD28F4          17      CALL    FKANC
0021CC F2C5 E5              11      PUSH    HL
0021CD F2C6 67               4      LD  H,A
0021CE F2C7 1A               7      LD  A,(DE)
0021CF F2C8 CB01             4      RLC C
0021D1 F2CA CD28F4          17      CALL    FKANC
0021D4 F2CD CB09             4      RRC C
0021D6 F2CF BC               4      CP  H       ;CP (HL),(DE)
0021D7 F2D0 E1              10      POP HL
0021D8 F2D1 2004            12      JR  NZ,CPSTR3
       F2D3                     CPSTR2:
0021DA F2D3 13               6      INC DE
0021DB F2D4 23               6      INC HL
0021DC F2D5 10E5            13      DJNZ    CPSTR1
       F2D7                     CPSTR3:
0021DE F2D7 C1              10      POP BC
0021DF F2D8 C9              10      RET
                                
       F2D9                     CPFILE2:
0021E0 F2D9 FD7E0D          19      LD  A,(IY+13)   ;(FCB)属性(アトリビュート)
0021E3 F2DC F6E1             7      OR  0E1H
0021E5 F2DE 2F               4      CPL
0021E6 F2DF A6               7      AND (HL)
0021E7 F2E0 C9              10      RET
                                
       F2E1                     DCPAT:
0021E8 F2E1 0E00             7      LD  C,0
0021EA F2E3 2A7EEF          16      LD  HL,(_DTBUF)
0021ED F2E6 3AA0EE          13      LD  A,(_DIRF)   ;ディレクトリか判別
0021F0 F2E9 B7               4      OR  A
0021F1 F2EA C8              11      RET Z       ;ルートディレクトリの場合はCレジスタを0にしておく(CDEがセクタ番号)
0021F2 F2EB 3AFFF2          13      LD  A,(SPCPAT)
0021F5 F2EE 4F               4      LD  C,A
0021F6 F2EF 3ABDE7          13      LD  A,(_SECPS)
0021F9 F2F2 B9               4      CP  C
0021FA F2F3 3801            12      JR  C,DC1
0021FC F2F5 AF               4      XOR A
       F2F6                     DC1:
0021FD F2F6 F680             7      OR  080H
0021FF F2F8 32A0EE          13      LD  (_DIRF),A   ;bit0-6:セクタインデックス
       F2FB                     CLUSTX:
002202 F2FB E5              11      PUSH    HL
002203 F2FC EB               4      EX  DE,HL
002204 F2FD AF               4      XOR A
002205 F2FE 0E01             7      LD  C,1     ;自己書き換え（1クラスタの論理セクタ数）
       F2FF                     SPCPAT  EQU $-1
       F300                     L_CLDBL:
002207 F300 CB19             8      RR  C       ;->CF
002209 F302 3804            12      JR  C,E_CLDBL
00220B F304 29              11      ADD HL,HL       ;*2
00220C F305 8F               4      ADC A,A
00220D F306 18F8            12      JR  L_CLDBL
       F308                     E_CLDBL:
00220F F308 4F               4      LD  C,A
002210 F309 3ABDE7          13      LD  A,(_SECPS)
002213 F30C B5               4      OR  L
002214 F30D 6F               4      LD  L,A
002215 F30E 110800          10      LD  DE,8    ;+8 (2D)  !ADDCL (self-modifying code)
       F30F                     CLSPAT  EQU $-2
002218 F311 AF               4      XOR A
002219 F312 19              11      ADD HL,DE   ;データ格納領域の先頭論理セクタ番号
00221A F313 89               4      ADC A,C
00221B F314 4F               4      LD  C,A
00221C F315 EB               4      EX  DE,HL
00221D F316 E1              10      POP HL
00221E F317 C9              10      RET
                                ;(8)
       F318                     ENDCL:
00221F F318 7A               4      LD  A,D ;END CLUSTER
002220 F319 FE01             7      CP  1   ;164=356    (self-modifying code)
       F31A                     CLPAT1  EQU $-1
002222 F31B C0              11      RET NZ
002223 F31C 7B               4      LD  A,E
002224 F31D FE64             7      CP  064H    ;       (self-modifying code)
       F31E                     CLPAT2  EQU $-1
002226 F31F C9              10      RET
                                ;(3)
       F320                     CAP4:
002227 F320 3EE5             7      LD  A,0E5H
002229 F322 C9              10      RET
                                                    ;for X1/88 ワークエリア
00222A F323 5BEE                    DW  _DISKE+1        ;DISKVE($F323)
00222C F325 F5EE                    DW  _BREAK+1        ;BREAKV($F325)
                                
       F327                     CAP:            ;(9)
00222E F327 FE61             7      CP  'a'
002230 F329 D8              11      RET C
002231 F32A FE7B             7      CP  'z'+1
002233 F32C D0              11      RET NC
002234 F32D D620             7      SUB 020H
002236 F32F C9              10      RET
                                ;(10)
       F330                     CAP2:
002237 F330 CD27F3          17      CALL    CAP
       F333                     CAP3:               ;
00223A F333 FE05             7      CP  5
00223C F335 28E9            12      JR  Z,CAP4
00223E F337 FE21             7      CP  021H
002240 F339 C9              10      RET
                                                    ;
       F33A                     CHDIR:
002241 F33A CD6DEA          17      CALL    GETDPBD
002244 F33D 381D            12      JR  C,CHDIR2
002246 F33F DD751A          19      LD  (IX+DPB_SDIR),L
002249 F342 DD741B          19      LD  (IX+DPB_SDIR+1),H
00224C F345 1815            12      JR  CHDIR2      ;POP_IX_RET
                                
       F347                     LDDIR:
00224E F347 CD6DEA          17      CALL    GETDPBD
002251 F34A DD5E1A          19      LD  E,(IX+DPB_SDIR)
002254 F34D DD561B          19      LD  D,(IX+DPB_SDIR+1)
002257 F350 13               6      INC DE
002258 F351 FD730E          19      LD  (IY+14),E   ;(FCB)アクセスするディレクトリのクラスタ番号+1
00225B F354 FD720F          19      LD  (IY+15),D
00225E F357 1B               6      DEC DE
00225F F358 AF               4      XOR A
002260 F359 32A0EE          13      LD  (_DIRF),A
       F35C                     CHDIR2:
002263 F35C DDE1            14      POP IX
002265 F35E C9              10      RET
                                
       F35F                     LDDIRX:
002266 F35F 3AA0EE          13      LD  A,(_DIRF)   ;(FCB)アクセスするディレクトリのセクタインデックス
002269 F362 E67F             7      AND 07FH
       F364                     LDDIRX1:
00226B F364 32BDE7          13      LD  (_SECPS),A
00226E F367 FD5E0E          19      LD  E,(IY+14)   ;(FCB)アクセスするディレクトリのクラスタ番号+1
002271 F36A FD560F          19      LD  D,(IY+15)
002274 F36D 1B               6      DEC DE
002275 F36E CD18F3          17      CALL    ENDCL
002278 F371 D447F3          17      CALL    NC,LDDIR
       F374                     LDDIRS:
00227B F374 7A               4      LD  A,D
00227C F375 B3               4      OR  E
00227D F376 32A0EE          13      LD  (_DIRF),A   ;ディレクトリか判別
002280 F379 C9              10      RET
                                
       F37A                     KILL:
002281 F37A CD42F4          17      CALL    CHKWILDX
002284 F37D 3834            12      JR  C,KILLW
002286 F37F CD1DF1          17      CALL    SOPENX
       F382                     KILLS:
002289 F382 3E1F             7      LD  A,01FH
00228B F384 D4C6F3          17      CALL    NC,CHKATT
00228E F387 D8              11      RET C
       F388                     KILLSX:
00228F F388 36E5            10      LD  (HL),0E5H   ;DIR
002291 F38A CD1EF4          17      CALL    WTDB
002294 F38D 111A00          10      LD  DE,01AH
002297 F390 19              11      ADD HL,DE
002298 F391 5E               7      LD  E,(HL)
002299 F392 23               6      INC HL
00229A F393 56               7      LD  D,(HL)
       F394                     KILLS1:
00229B F394 CD18F3          17      CALL    ENDCL
00229E F397 D0              11      RET NC      ;CF=0
00229F F398 21FEFF          10      LD  HL,0-2
0022A2 F39B 19              11      ADD HL,DE
0022A3 F39C D0              11      RET NC      ;DE= 0 or 1
0022A4 F39D D5              11      PUSH    DE
0022A5 F39E CDF7EE          17      CALL    _GNCL
0022A8 F3A1 ED53FEEF        20      LD  (_CLPS),DE
0022AC F3A5 D1              10      POP DE
0022AD F3A6 210000          10      LD  HL,0
0022B0 F3A9 D4FAEE          17      CALL    NC,_SNCL
0022B3 F3AC D8              11      RET C
0022B4 F3AD ED5BFEEF        20      LD  DE,(_CLPS)  ;FAT
0022B8 F3B1 18E1            12      JR  KILLS1
                                
       F3B3                     KILLW:
0022BA F3B3 CD4CF1          17      CALL    SOPEN
       F3B6                     KILLW1:
0022BD F3B6 380B            12      JR  C,KILLW2
0022BF F3B8 CDEBF1          17      CALL    SOPENE2
0022C2 F3BB CD82F3          17      CALL    KILLS
0022C5 F3BE CDB0F1          17      CALL    NOPEN
0022C8 F3C1 18F3            12      JR  KILLW1
       F3C3                     KILLW2:
0022CA F3C3 C8              11      RET Z
0022CB F3C4 3F               4      CCF
0022CC F3C5 C9              10      RET
                                
       F3C6                     CHKATT:
0022CD F3C6 E5              11      PUSH    HL
0022CE F3C7 110B00          10      LD  DE,00BH
0022D1 F3CA 19              11      ADD HL,DE
0022D2 F3CB A6               7      AND (HL)
0022D3 F3CC E1              10      POP HL
0022D4 F3CD C8              11      RET Z
0022D5 F3CE 37               4      SCF
0022D6 F3CF C9              10      RET
                                
       F3D0                     NAME:
0022D7 F3D0 CD42F4          17      CALL    CHKWILDX
0022DA F3D3 D8              11      RET C
0022DB F3D4 110400          10      LD  DE,4
0022DE F3D7 19              11      ADD HL,DE
0022DF F3D8 22EDF3          16      LD  (NAMEP),HL
0022E2 F3DB 23               6      INC HL
0022E3 F3DC CD46F4          17      CALL    CHKWILD
0022E6 F3DF D8              11      RET C
                                
0022E7 F3E0 CD1DF1          17      CALL    SOPENX
0022EA F3E3 3E0F             7      LD  A,00FH
0022EC F3E5 D4C6F3          17      CALL    NC,CHKATT
0022EF F3E8 D8              11      RET C
                                
0022F0 F3E9 FDE5            15      PUSH    IY
0022F2 F3EB FD210000        14      LD  IY,0        ;自己書き換え
       F3ED                     NAMEP   EQU $-2
0022F6 F3EF CD1DF1          17      CALL    SOPENX
0022F9 F3F2 FDE3            23      EX  (SP),IY
0022FB F3F4 3F               4      CCF
0022FC F3F5 D44CF1          17      CALL    NC,SOPEN
0022FF F3F8 EB               4      EX  DE,HL
002300 F3F9 E1              10      POP HL
002301 F3FA D8              11      RET C
                                
       F3FB                     SETNAME:
002302 F3FB 01000B          10      LD  BC,11*256
002305 F3FE 23               6      INC HL
002306 F3FF 7E               7      LD  A,(HL)
002307 F400 FEE5             7      CP  0E5H
002309 F402 2004            12      JR  NZ,SNAME1
00230B F404 3E05             7      LD  A,5
00230D F406 180E            12      JR  SNAME3
       F408                     SNAME1:
00230F F408 7E               7      LD  A,(HL)
002310 F409 0C               4      INC C
002311 F40A 0D               4      DEC C
002312 F40B 2009            12      JR  NZ,SNAME3
002314 F40D CD27F3          17      CALL    CAP
002317 F410 FEA0             7      CP  0A0H
002319 F412 2002            12      JR  NZ,SNAME3
00231B F414 3E20             7      LD  A,020H
       F416                     SNAME3:
00231D F416 12               7      LD  (DE),A
00231E F417 7E               7      LD  A,(HL)
00231F F418 23               6      INC HL
002320 F419 CD2FF4          17      CALL    FKAN
002323 F41C 10EA            13      DJNZ    SNAME1
       F41E                     WTDB:               ;バッファデータが更新された
002325 F41E 3EFF             7      LD  A,0FFH
002327 F420 3239EE          13      LD  (SFILE),A
00232A F423 32A4EE          13      LD  (_WTDBF),A
00232D F426 AF               4      XOR A
00232E F427 C9              10      RET
                                
       F428                     FKANC:
00232F F428 CB41             8      BIT 0,C
002331 F42A CC30F3          17      CALL    Z,CAP2
002334 F42D 1801            12      JR  FKANX
       F42F                     FKAN:           ;漢字チェック
002336 F42F 13               6      INC DE
       F430                     FKANX:
002337 F430 CB41             8      BIT 0,C
002339 F432 CB81             8      RES 0,C
00233B F434 C0              11      RET NZ
00233C F435 FE80             7      CP  080H
00233E F437 D8              11      RET C
00233F F438 FEA0             7      CP  0A0H
002341 F43A 3803            12      JR  C,FKAN1
002343 F43C FEE0             7      CP  0E0H
002345 F43E D8              11      RET C
       F43F                     FKAN1:
002346 F43F 0C               4      INC C
002347 F440 A7               4      AND A
002348 F441 C9              10      RET
                                
       F442                     CHKWILDX:
002349 F442 FDE5            15      PUSH    IY
00234B F444 E1              10      POP HL
00234C F445 23               6      INC HL
       F446                     CHKWILD:
00234D F446 060B             7      LD  B,11
00234F F448 3E3F             7      LD  A,'?'
       F44A                     CHKWIL1:
002351 F44A BE               7      CP  (HL)
002352 F44B 23               6      INC HL
002353 F44C 37               4      SCF
002354 F44D C8              11      RET Z
002355 F44E 10FA            13      DJNZ    CHKWIL1
002357 F450 AF               4      XOR A
002358 F451 C9              10      RET
                                
       F452                     SDIRENT:        ;IY=FCB HL=DIR
002359 F452 D5              11      PUSH    DE
00235A F453 E5              11      PUSH    HL
00235B F454 FDE5            15      PUSH    IY
00235D F456 D1              10      POP DE
00235E F457 EB               4      EX  DE,HL
00235F F458 CDFBF3          17      CALL    SETNAME
                                ;               Attribute
002362 F45B FD7E0D          19      LD  A,(IY+13)   ;(FCB)属性(アトリビュート)
002365 F45E 12               7      LD  (DE),A
002366 F45F 13               6      INC DE
                                ;               Reserved
002367 F460 AF               4      XOR A
002368 F461 060A             7      LD  B,10
       F463                     SDE1:
00236A F463 12               7      LD  (DE),A
00236B F464 13               6      INC DE
00236C F465 10FC            13      DJNZ    SDE1
                                                    ;(FCB)更新時刻
00236E F467 21E4EF          10      LD  HL,SDDATA       ;(FCB)更新年月日
002371 F46A 060A             7      LD  B,SDDATAE-SDDATA    ;(FCB)ファイルの先頭クラスタ
       F46C                     SDLOOP:                 ;(FCB)ファイルのサイズ(バイト単位)
002373 F46C 7E               7      LD  A,(HL)
002374 F46D 23               6      INC HL
002375 F46E 3273F4          13      LD  (SDPAT),A
002378 F471 FD7E00          19      LD  A,(IY+0)    ;LD A,(IY+A)
       F473                     SDPAT   EQU $-1
00237B F474 12               7      LD  (DE),A
00237C F475 13               6      INC DE
00237D F476 10F4            13      DJNZ    SDLOOP
                                
00237F F478 AF               4      XOR A
002380 F479 E1              10      POP HL
002381 F47A D1              10      POP DE
002382 F47B C9              10      RET
                                
       F47C                     WOPEN:
002383 F47C FD7E0D          19      LD  A,(IY+13)   ;(FCB)属性(アトリビュート)
002386 F47F E61F             7      AND 01FH
002388 F481 37               4      SCF
002389 F482 C0              11      RET NZ
00238A F483 FD361CFE        19      LD  (IY+28),0FEH    ;(FCB)オープンモード
       F487                     TOPEN2:
00238E F487 AF               4      XOR A
       F488                     TOPEN:              ;Initializes the time stamp
00238F F488 FD3617FF        19      LD  (IY+23),0FFH    ;(FCB)更新時刻
002393 F48C C9              10      RET
                                
       F48D                     WRDFX:
002394 F48D 3AFFF2          13      LD  A,(SPCPAT)  ;1クラスタの論理セクタ
       F490                     L_WRFX:
002397 F490 1F               4      RRA         ;->CF
002398 F491 3806            12      JR  C,E_WRFX
00239A F493 CB39             8      SRL C
00239C F495 CB1C             8      RR  H       ;CH=CH/2
00239E F497 18F7            12      JR  L_WRFX
       F499                     E_WRFX:
0023A0 F499 41               4      LD  B,C
0023A1 F49A 4C               4      LD  C,H
0023A2 F49B 03               6      INC BC
0023A3 F49C 3E37             7      LD  A,037H      ;SCF
0023A5 F49E 3243E6          13      LD  (DRDN1),A
                                
       F4A1                     WRDF:               ;BCクラスタ分FATを確保する
0023A8 F4A1 110200          10      LD  DE,2
0023AB F4A4 AF               4      XOR A
0023AC F4A5 32BDE7          13      LD  (_SECPS),A
       F4A8                     WRDF1:
0023AF F4A8 C5              11      PUSH    BC
0023B0 F4A9 D5              11      PUSH    DE
0023B1 F4AA CDF7EE          17      CALL    _GNCL
0023B4 F4AD 381C            12      JR  C,WRDF3
0023B6 F4AF 7A               4      LD  A,D     ;空いているかチェック
0023B7 F4B0 B3               4      OR  E
0023B8 F4B1 202A            12      JR  NZ,WRDF4
0023BA F4B3 E1              10      POP HL      ;HL=空いているクラスタ
0023BB F4B4 E5              11      PUSH    HL
0023BC F4B5 ED5BFEEF        20      LD  DE,(_CLPS)  ;DE=元の(_CLPS)
0023C0 F4B9 22FEEF          16      LD  (_CLPS),HL
0023C3 F4BC 7A               4      LD  A,D     ;元の(_CLPS)が 0 か?
0023C4 F4BD B3               4      OR  E
0023C5 F4BE 2008            12      JR  NZ,WRDF2
0023C7 F4C0 FD751A          19      LD  (IY+26),L   ;(FCB)ファイルの先頭クラスタ
0023CA F4C3 FD741B          19      LD  (IY+27),H   ;元が空の場合はFCBにクラスタをセットする
0023CD F4C6 1803            12      JR  WRDF3
       F4C8                     WRDF2:
0023CF F4C8 CDFAEE          17      CALL    _SNCL
       F4CB                     WRDF3:
0023D2 F4CB D1              10      POP DE
0023D3 F4CC C1              10      POP BC
0023D4 F4CD D8              11      RET C
0023D5 F4CE 0B               6      DEC BC
0023D6 F4CF 78               4      LD  A,B
0023D7 F4D0 B1               4      OR  C
0023D8 F4D1 200C            12      JR  NZ,WRDF5    ;ここでループカウンタチェック
0023DA F4D3 ED5BFEEF        20      LD  DE,(_CLPS)
0023DE F4D7 21FFFF          10      LD  HL,0FFFFH   ;FATエントリ終了(EOCマーク)
0023E1 F4DA C3FAEE          10      JP  _SNCL
                                
       F4DD                     WRDF4:              ;DEクラスタが空じゃないので次に移動する
0023E4 F4DD D1              10      POP DE
0023E5 F4DE C1              10      POP BC
       F4DF                     WRDF5:
0023E6 F4DF 13               6      INC DE
0023E7 F4E0 CD18F3          17      CALL    ENDCL
0023EA F4E3 38C3            12      JR  C,WRDF1
0023EC F4E5 37               4      SCF
0023ED F4E6 C9              10      RET
                                
       F4E7                     RWXR:
0023EE F4E7 3A32E5          13      LD  A,(SECSZ_H) ;1024=4 / 512=2 / 256=1
       F4EA                     L_RWX:
0023F1 F4EA 1F               4      RRA     ;->CF
0023F2 F4EB 3808            12      JR  C,E_RWX
0023F4 F4ED CB38             8      SRL B   ;BCH=BCH/2
0023F6 F4EF CB19             8      RR  C   ;
0023F8 F4F1 CB1C             8      RR  H   ;
0023FA F4F3 18F5            12      JR  L_RWX
       F4F5                     E_RWX:
0023FC F4F5 FD5E1A          19      LD  E,(IY+26)   ;(FCB)ファイルの先頭クラスタ
0023FF F4F8 FD561B          19      LD  D,(IY+27)
002402 F4FB AF               4      XOR A
002403 F4FC 32BDE7          13      LD  (_SECPS),A
       F4FF                     RWX1:
002406 F4FF ED53FEEF        20      LD  (_CLPS),DE
00240A F503 7A               4      LD  A,D
00240B F504 B3               4      OR  E
00240C F505 2813            12      JR  Z,SCF_RET   ;RET DE==0 => CF=1
                                
00240E F507 78               4      LD  A,B
00240F F508 B1               4      OR  C
002410 F509 B4               4      OR  H
002411 F50A C8              11      RET Z       ;RET BCH==0 => CF=0
                                
002412 F50B CDC5E7          17      CALL    GNCLX
002415 F50E D8              11      RET C
002416 F50F 7C               4      LD  A,H     ;
002417 F510 25               4      DEC H       ;
002418 F511 B7               4      OR  A       ;DEC BCH
002419 F512 2001            12      JR  NZ,RWX2     ;
00241B F514 0B               6      DEC BC      ;
       F515                     RWX2:
00241C F515 CD18F3          17      CALL    ENDCL
00241F F518 38E5            12      JR  C,RWX1
       F51A                     SCF_RET:
002421 F51A 37               4      SCF
002422 F51B C9              10      RET
                                
       F51C                     DSKF:
002423 F51C 110000          10      LD  DE,0
       F51D                     MAXCLP  EQU $-2
002426 F51F 2AACEE          16      LD  HL,(_FAKEFREE)
002429 F522 7C               4      LD  A,H
00242A F523 B5               4      OR  L
00242B F524 2803            12      JR  Z,DSKF1
00242D F526 110100          10      LD  DE,1
       F529                     DSKF1:
002430 F529 D5              11      PUSH    DE
002431 F52A CDF7EE          17      CALL    _GNCL
002434 F52D 380C            12      JR  C,POPSCF
002436 F52F 7A               4      LD  A,D
002437 F530 B3               4      OR  E
002438 F531 2001            12      JR  NZ,DSKF2
00243A F533 23               6      INC HL
       F534                     DSKF2:
00243B F534 D1              10      POP DE
00243C F535 1B               6      DEC DE
00243D F536 7A               4      LD  A,D
00243E F537 B3               4      OR  E
00243F F538 20EF            12      JR  NZ,DSKF1
002441 F53A C9              10      RET
                                
       F53B                     POPSCF:
002442 F53B F1              10      POP AF
002443 F53C 37               4      SCF
002444 F53D C9              10      RET
                                
       F53E                     SETTMS:
002445 F53E FD7E17          19      LD  A,(IY+23)   ;(FCB)ファイルを最後に変更した時刻
002448 F541 3C               4      INC A
002449 F542 C0              11      RET NZ      ;ファイルが更新されていない
       F543                     SETTMSX:            ;FCBに日付時刻をセットする
00244A F543 CDC8E0          17      CALL    _SYS2C      ;(BDOS)時刻の獲得
                                                ;H←時  L←分  D←秒
00244D F546 CB25             8      SLA L       ;   *2
00244F F548 CB25             8      SLA L       ;   *4
002451 F54A 29              11      ADD HL,HL       ;*2 *8
002452 F54B 29              11      ADD HL,HL       ;*4 *16
002453 F54C 29              11      ADD HL,HL       ;*8 *32
002454 F54D 7A               4      LD  A,D
002455 F54E 0F               4      RRCA            ;bit.0->7->->->0->C
002456 F54F E61F             7      AND 01FH
002458 F551 B5               4      OR  L
002459 F552 FD7716          19      LD  (IY+22),A   ;(FCB)ファイルを最後に変更した時刻
00245C F555 FD7417          19      LD  (IY+23),H
                                
00245F F558 CDA1E0          17      CALL    _SYS2A      ;(BDOS)日付の獲得
                                                ;HL←年  D←月  E←日
002462 F55B 0144F8          10      LD  BC,0-1980
002465 F55E 09              11      ADD HL,BC
002466 F55F 65               4      LD  H,L
                                
002467 F560 7A               4      LD  A,D
002468 F561 87               4      ADD A,A     ;*2
002469 F562 87               4      ADD A,A     ;*4
00246A F563 87               4      ADD A,A     ;*8
00246B F564 87               4      ADD A,A     ;*16
00246C F565 6F               4      LD  L,A
00246D F566 29              11      ADD HL,HL       ;*32
00246E F567 7D               4      LD  A,L
00246F F568 B3               4      OR  E
002470 F569 FD7714          19      LD  (IY+20),A   ;(FCB)ファイルを最後に変更した日付
002473 F56C FD7415          19      LD  (IY+21),H
002476 F56F C9              10      RET
                                ;(16)
       F570                     PUSHRR:
002477 F570 32F6E5          13      LD  (SETSEQ_SWC_RND),A
00247A F573 2208E6          16      LD  (SETSEQ_SWC_SEQ_RR),HL
00247D F576 CD96F5          17      CALL    GET_RR_AHL
002480 F579 220FEE          16      LD  (RR_BUF_HL),HL
002483 F57C 3211EE          13      LD  (RR_BUF_A),A
002486 F57F C9              10      RET
                                ;(14)
       F580                     GET_CPM_R_SIZE:     ;バイト単位からCP/Mのレコード単位を求める（1レコード=128バイト）
002487 F580 87               4      ADD A,A     ;in BHLA => out AHL
002488 F581 ED6A            15      ADC HL,HL
00248A F583 CB18             8      RR  B
00248C F585 B7               4      OR  A
00248D F586 78               4      LD  A,B     ;ここでフラグは変化しない
00248E F587 C8              11      RET Z
00248F F588 2C               4      INC L       ;INC AHL
002490 F589 C0              11      RET NZ      ;
002491 F58A 24               4      INC H       ;
002492 F58B C0              11      RET NZ      ;
002493 F58C 3C               4      INC A       ;
002494 F58D C9              10      RET
                                ;(18)
       F58E                     INIT_RND:
002495 F58E 3ECD             7      LD  A,0CDH      ;CALL ????
002497 F590 21ADF5          10      LD  HL,POPRR
00249A F593 CD70F5          17      CALL    PUSHRR
       F596                     GET_RR_AHL:
00249D F596 FD6E21          19      LD  L,(IY+33)   ;(FCB)Random record
0024A0 F599 FD6622          19      LD  H,(IY+34)   ;
0024A3 F59C FD7E23          19      LD  A,(IY+35)   ;
0024A6 F59F C9              10      RET
                                ;(10)
       F5A0                     SET_RR_AHL:
0024A7 F5A0 FD7521          19      LD  (IY+33),L   ;(FCB)Random record
0024AA F5A3 FD7422          19      LD  (IY+34),H   ;
0024AD F5A6 FD7723          19      LD  (IY+35),A   ;
0024B0 F5A9 C9              10      RET
                                ;(17)
       F5AA                     SETSEQ:
0024B1 F5AA CDCFF5          17      CALL    SETSEQ1
       F5AD                     POPRR:
0024B4 F5AD F5              11      PUSH    AF
0024B5 F5AE E5              11      PUSH    HL
0024B6 F5AF 2A0FEE          16      LD  HL,(RR_BUF_HL)
0024B9 F5B2 3A11EE          13      LD  A,(RR_BUF_A)
0024BC F5B5 CDA0F5          17      CALL    SET_RR_AHL
0024BF F5B8 E1              10      POP HL
0024C0 F5B9 F1              10      POP AF
0024C1 F5BA C9              10      RET
                                ;(20)
       F5BB                     GET_RR_BCDE:            ;BCDE=Random record
0024C2 F5BB FD5E21          19      LD  E,(IY+33)   ;(FCB)ランダムレコード
0024C5 F5BE FD5622          19      LD  D,(IY+34)
0024C8 F5C1 FD4E23          19      LD  C,(IY+35)
0024CB F5C4 0600             7      LD  B,0     ;CP/M互換のアクセスの場合はFCBは36バイト
0024CD F5C6 FDCB207E        20      BIT 7,(IY+32)   ;(FCB)カレントレコード
0024D1 F5CA C0              11      RET NZ
0024D2 F5CB FD4624          19      LD  B,(IY+36)
0024D5 F5CE C9              10      RET
                                
       F5CF                     SETSEQ1:
0024D6 F5CF F5              11      PUSH    AF
0024D7 F5D0 E5              11      PUSH    HL      ;AHL=Random record
0024D8 F5D1 CD96F5          17      CALL    GET_RR_AHL
0024DB F5D4 47               4      LD  B,A     ;AHL→HLA
0024DC F5D5 7D               4      LD  A,L     ;(IY+33)(FCB)ランダムレコード
0024DD F5D6 6C               4      LD  L,H     ;(IY+34)
0024DE F5D7 60               4      LD  H,B     ;(IY+35)
0024DF F5D8 0600             7      LD  B,0
                                
0024E1 F5DA CD80F5          17      CALL    GET_CPM_R_SIZE
                                
0024E4 F5DD 29              11      ADD HL,HL
0024E5 F5DE CB3D             8      SRL L       ;L=L/2
0024E7 F5E0 FD7520          19      LD  (IY+32),L   ;(FCB)カレントレコード
0024EA F5E3 FD740C          19      LD  (IY+12),H   ;(FCB)カレントブロック
0024ED F5E6 E1              10      POP HL
0024EE F5E7 F1              10      POP AF
0024EF F5E8 C9              10      RET
                                
                                ;(23)
       F5E9                     RBXEND:             ;レコード数だけランダムレコードを進める
0024F0 F5E9 110000          10      LD  DE,0        ;進めるレコード数(RBSIZE)
       F5EA                     RBSIZE  EQU $-2
0024F3 F5EC CD96F5          17      CALL    GET_RR_AHL
0024F6 F5EF 19              11      ADD HL,DE
0024F7 F5F0 CE00             7      ADC A,0
0024F9 F5F2 CDA0F5          17      CALL    SET_RR_AHL
0024FC F5F5 EB               4      EX  DE,HL       ;HL=進めるレコード数
0024FD F5F6 D0              11      RET NC
0024FE F5F7 FDCB207E        20      BIT 7,(IY+32)   ;(FCB)カレントレコード
002502 F5FB C0              11      RET NZ
002503 F5FC FD3424          23      INC (IY+36)
002506 F5FF C9              10      RET
       F600                     FILE_E:
                                
       F1AA                     _SYS03  EQU SCF_FF_RET  ;(BDOS)外部入力
       F1AA                     _SYS2B  EQU SCF_FF_RET  ;(BDOS)日付の設定
       F1AA                     _SYS2D  EQU SCF_FF_RET  ;(BDOS)時刻の設定
       F1AA                     _SYS39  EQU SCF_FF_RET  ;(BDOS)サブディレクトリの作成
       F1AA                     _SYS3A  EQU SCF_FF_RET  ;(BDOS)サブディレクトリの削除
                                
[EOF:LDFILE.ASM:SHIFT_JIS]
                                    INCLUDE "88DPB.ASM"
                                
                                ;   LSX-Dodgers DPB
                                ;   PC-8801mkIISR
                                
       F600                     _DEVICE:
                                
                                ;   A:
                                
002507 F600 0200                    DW  2   ;DPB_FATLN
002509 F602 EBEE                    DW  _FDRD   ;DPB_DRD
00250B F604 EEEE                    DW  _FDWT   ;DPB_DWT
00250D F606 FD                      DB  0FDH    ;DPB_FATID
00250E F607 02                      DB  2   ;DPB_SECPCL
00250F F608 6401                    DW  356 ;DPB_MAXCL
002511 F60A FF                      DB  0FFH    ;DPB_FDMODE 0FFH=2D / 0FEH=2HD
002512 F60B 07                      DB  7   ;DPB_DIRSCNT
002513 F60C 28                      DB  40  ;DPB_MAXCYL
002514 F60D 09                      DB  9   ;DPB_MAXSEC Number of sectors
002515 F60E 01                      DB  1   ;DPB_FATPS
002516 F60F 82                      DB  082H    ;DPB_BPS
002517 F610 0500                    DW  5   ;DPB_DIRPS
002519 F612 A7                      DB  0A7H    ;DPB_DEVICE Device Number
00251A F613 00                      DB  0   ;DPB_UNITNO
00251B F614 0800                    DW  8   ;DPB_ADDCL
00251D F616 0000                    DW  0   ;DPB_16
00251F F618 0000                    DW  0   ;DPB_18
002521 F61A 0000                    DW  0   ;DPB_SDIR
002523 F61C 46444430                DB  "FDD0"  ;DPB_NAME
                                
                                ;   B:
                                
002527 F620 0200                    DW  2   ;DPB_FATLN
002529 F622 EBEE                    DW  _FDRD   ;DPB_DRD
00252B F624 EEEE                    DW  _FDWT   ;DPB_DWT
00252D F626 FD                      DB  0FDH    ;DPB_FATID
00252E F627 02                      DB  2   ;DPB_SECPCL
00252F F628 6401                    DW  356 ;DPB_MAXCL
002531 F62A FF                      DB  0FFH    ;DPB_FDMODE 0FFH=2D / 0FEH=2HD
002532 F62B 07                      DB  7   ;DPB_DIRSCNT
002533 F62C 28                      DB  40  ;DPB_MAXCYL
002534 F62D 09                      DB  9   ;DPB_MAXSEC Number of sectors
002535 F62E 01                      DB  1   ;DPB_FATPS
002536 F62F 82                      DB  082H    ;DPB_BPS
002537 F630 0500                    DW  5   ;DPB_DIRPS
002539 F632 A7                      DB  0A7H    ;DPB_DEVICE Device Number
00253A F633 01                      DB  1   ;DPB_UNITNO
00253B F634 0800                    DW  8   ;DPB_ADDCL
00253D F636 0000                    DW  0   ;DPB_16
00253F F638 0000                    DW  0   ;DPB_18
002541 F63A 0000                    DW  0   ;DPB_SDIR
002543 F63C 46444431                DB  "FDD1"  ;DPB_NAME
                                
                                ;   C:
                                
002547 F640                         DS  32
                                
                                ;   D:
                                
002567 F660                         DS  32
                                
                                ;   E:
                                
002587 F680                         DS  32
                                
                                ;   F:
                                
0025A7 F6A0 0000                BANKFL: DW  0   ;DPB_FATLN
0025A9 F6A2 5FDD                    DW  BDRD    ;DPB_DRD
0025AB F6A4 5BDD                    DW  BDWT    ;DPB_DWT
0025AD F6A6 F9                      DB  0F9H    ;DPB_FATID
0025AE F6A7 02                      DB  2   ;DPB_SECPCL
0025AF F6A8 0000                BANKCL: DW  0   ;DPB_MAXCL
0025B1 F6AA 00                      DB  0   ;DPB_FDMODE
0025B2 F6AB 08                      DB  8   ;DPB_DIRSCNT
0025B3 F6AC 00                      DB  0   ;DPB_MAXCYL
0025B4 F6AD 01                      DB  1   ;DPB_MAXSEC
0025B5 F6AE 00                      DB  0   ;DPB_FATPS
0025B6 F6AF 02                      DB  2   ;DPB_BPS
0025B7 F6B0 0200                    DW  2   ;DPB_DIRPS
0025B9 F6B2 0B                  BANKDV: DB  00BH    ;DPB_DEVICE
0025BA F6B3 00                      DB  0   ;DPB_UNITNO
0025BB F6B4 0600                    DW  6   ;DPB_ADDCL
0025BD F6B6 0000                    DW  0   ;DPB_16
0025BF F6B8 0000                    DW  0   ;DPB_18
0025C1 F6BA 0000                    DW  0   ;DPB_SDIR
0025C3 F6BC 454D454D                DB  "EMEM"  ;DPB_NAME
                                
                                ;   G:
                                
0025C7 F6C0                         DS  32
                                
                                ;   H:
0025E7 F6E0                         DS  32-8
0025FF F6F8 00                      DB  0
[EOF:88DPB.ASM:UTF_8]
                                
       F6F9                     LAST_ADR:
                                
                                    END
[EOF:88.ASM:UTF_8]
