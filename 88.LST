                                ;*** AILZ80ASM *** Z-80 Assembler, version 1.0.0.0, LST:Full:4
                                ;   LSX-Dodgers for X1/turbo/Z
                                ;   Programmed by
                                ;   Gaku (Lovers/Tablacus)
                                
                                    INCLUDE "88DEF.ASM"
                                
                                ;   LSX-Dodgers DEF
                                ;   PC-8001mkIISR
                                
       0002                     MAC EQU 2   ;PC-8001mkIISR
       0001                     DEV EQU 1
                                
                                
       CC00                     RUN EQU 0CC00H
       CBF9                     OFFSET  EQU RUN-7
                                
       D006                     BDOS    EQU 0D006H
       EDC8                     TABLEAD EQU 0EDC8H
       EF00                     WORKAD  EQU 0EF00H
       F200                     FATBF   EQU 0F200H
       FA00                     DTBUF   EQU 0FA00H
       FE00                     KEYBF   EQU 0FE00H
       FF00                     KBUF    EQU 0FF00H
       FFD9                     TRAP38  EQU 0FFD9H
       0050                     WIDTH   EQU 80
       0018                     LINE    EQU 24
       0000                     COLORF  EQU 0
       0009                     COMS    EQU 9
                                
                                ; ディスクサブシステム
       002A                     MAIN        EQU 0002AH
                                
       4000                     DSS_DATA    EQU 04000H
                                
       7C00                     DSS     EQU 07C00H
[EOF:88DEF.ASM:SHIFT_JIS]
                                    INCLUDE "LDDEF.ASM"
                                
                                ;   LSX-Dodgers DEF
                                
       0001                     VER_1   EQU 1
       0004                     VER_2   EQU 4
       0007                     VER_3   EQU 7
       1D02                     MACW    EQU MAC + 01D00H    ;機種フラグとLD判別フラグ
       0102                     MACD    EQU MAC + DEV * 256 ;機種フラグとデバイスフラグ
       0147                     VER EQU VER_1 * 256 + VER_2 * 16 + VER_3
                                
       0005                     SYSTEM  EQU 00005H
       000F                     JP_HL   EQU 0000FH
       005C                     FCB1    EQU 0005CH
       006C                     FCB2    EQU 0006CH
       005D                     FCB1FN  EQU FCB1+1
       006D                     FCB2FN  EQU FCB2+1
       0080                     DTA1    EQU 00080H
                                
       FFCA                     EXTBIO  EQU 0FFCAH
                                
[EOF:LDDEF.ASM:SHIFT_JIS]
                                
000000 CBF9                         ORG OFFSET
                                
                                ;   MSX BINARY HEADER
000000 CBF9 FE                      DB  0FEH
                                ;   MSX BINARY START ADDRESS
000001 CBFA 00CC                    DW  RUN
                                ;   MSX BINARY END ADDRESS
000003 CBFC F9F1                    DW  LAST_ADR
                                ;   MSX BINARY EXEC ADDRESS
000005 CBFE 07CC                    DW  START
                                
                                    INCLUDE "88INIT.ASM"
                                
                                ;   LSX-Dodgers INIT
                                ;   PC-8801mkIISR
                                
000007 CC00 C307CC          10      JP  START
00000A CC03 021D                    DW  MACW
00000C CC05 4701                    DW  VER
                                
       CC07                     START:
00000E CC07 F3               4      DI
00000F CC08 ED5E             8      IM  2
000011 CC0A 3107CC          10      LD  SP,START
000014 CC0D CD1CCC          17      CALL    INIT        ;NZならAUTOEXECを実行
000017 CC10 210000          10      LD  HL,0
00001A CC13 E5              11      PUSH    HL
                                
00001B CC14 C9              10      RET
                                
00001C CC15 C8              11      RET Z
00001D CC16 1152CD          10      LD  DE,AUTOD
000020 CC19 C3FDEF          10      JP  _COMANL
                                
       CC1C                     INIT:
000023 CC1C DB32            11      IN  A,(032H)
000025 CC1E CBA7             8      RES 4,A     ;高速RAMアクセスモード
000027 CC20 D332            11      OUT (032H),A
                                
000029 CC22 21C8F3          10      LD  HL,0F3C8H   ;テキストをクリア
00002C CC25 11E880          10      LD  DE,080E8H
00002F CC28 0E20             7      LD  C,' '
000031 CC2A 3E19             7      LD  A,25
       CC2C                     TVCL1:
000033 CC2C 0650             7      LD  B,80
       CC2E                     TVCL2:
000035 CC2E 71               7      LD  (HL),C
000036 CC2F 23               6      INC HL
000037 CC30 10FC            13      DJNZ    TVCL2
000039 CC32 0614             7      LD  B,20
       CC34                     TVCL3:
00003B CC34 72               7      LD  (HL),D
00003C CC35 2C               4      INC L
00003D CC36 73               7      LD  (HL),E
00003E CC37 23               6      INC HL
00003F CC38 10FA            13      DJNZ    TVCL3
000041 CC3A 3D               4      DEC A
000042 CC3B 20EF            12      JR  NZ,TVCL1
                                
000044 CC3D DB32            11      IN  A,(032H)
000046 CC3F F610             7      OR  010H        ;高速RAMアクセスモードOFF
000048 CC41 D332            11      OUT (032H),A
                                
00004A CC43 CDADDD          17      CALL    INIT_CRTC
       CC46                     BANK:
00004D CC46 DBE2            11      IN  A,(0E2H)
00004F CC48 06E3             7      LD  B,0E3H      ;拡張RAM バンク選択
000051 CC4A 21007F          10      LD  HL,07F00H
000054 CC4D F3               4      DI
000055 CC4E 3E11             7      LD  A,011H
000057 CC50 D3E2            11      OUT (0E2H),A    ;拡張RAM リード/ライト制御
000059 CC52 ED69            12      OUT (C),L
00005B CC54 3A0000          13      LD  A,(0)
00005E CC57 FEEB             7      CP  0EBH
000060 CC59 2005            12      JR  NZ,BANK1
000062 CC5B 3E2B             7      LD  A,02BH
000064 CC5D 32B2F1          13      LD  (BANKDV),A
       CC60                     BANK1:
000067 CC60 3E11             7      LD  A,011H
000069 CC62 D3E2            11      OUT (0E2H),A    ;拡張RAM リード/ライト制御
00006B CC64 ED69            12      OUT (C),L
00006D CC66 5E               7      LD  E,(HL)
00006E CC67 7B               4      LD  A,E
00006F CC68 C6A5             7      ADD A,0A5H
000071 CC6A 77               7      LD  (HL),A
000072 CC6B BE               7      CP  (HL)
000073 CC6C 73               7      LD  (HL),E
000074 CC6D 2005            12      JR  NZ,BANK2
000076 CC6F 2C               4      INC L
000077 CC70 CB65             8      BIT 4,L
000079 CC72 28EC            12      JR  Z,BANK1
       CC74                     BANK2:
00007B CC74 AF               4      XOR A
00007C CC75 D3E2            11      OUT (0E2H),A    ;拡張RAM リード/ライト制御
00007E CC77 7D               4      LD  A,L
00007F CC78 B7               4      OR  A
000080 CC79 2813            12      JR  Z,NOBANK
000082 CC7B 2600             7      LD  H,0
000084 CC7D 29              11      ADD HL,HL   ;*2
000085 CC7E 29              11      ADD HL,HL   ;*4
000086 CC7F 29              11      ADD HL,HL   ;*8
000087 CC80 29              11      ADD HL,HL   ;*16
000088 CC81 29              11      ADD HL,HL   ;*32
000089 CC82 2B               6      DEC HL  ;-1
00008A CC83 2B               6      DEC HL  ;-2
00008B CC84 2B               6      DEC HL  ;-3
00008C CC85 22A8F1          16      LD  (BANKCL),HL
00008F CC88 CD42CD          17      CALL    CALC_FATLN
000092 CC8B 32A0F1          13      LD  (BANKFL),A
       CC8E                     NOBANK:
                                                ;初期化
000095 CC8E AF               4      XOR A       ;イニシャライズ
000096 CC8F CD7BEB          17      CALL    PUTCOM
000099 CC92 3E16             7      LD  A,16H       ;高速レシーブメモリ
00009B CC94 CD7BEB          17      CALL    PUTCOM
00009E CC97 3E7C             7      LD  A,DSS/256   ;開始アドレスH
0000A0 CC99 CD81EB          17      CALL    PUTDAT
0000A3 CC9C AF               4      XOR A       ;開始アドレスL
0000A4 CC9D CD81EB          17      CALL    PUTDAT
0000A7 CCA0 01F701          10      LD  BC,AT_DSSE-AT_DSS
0000AA CCA3 CB41             8      BIT 0,C
0000AC CCA5 2801            12      JR  Z,SUBPG1
0000AE CCA7 03               6      INC BC      ;偶数にする
       CCA8                     SUBPG1:
0000AF CCA8 78               4      LD  A,B     ;バイト数H
0000B0 CCA9 CD81EB          17      CALL    PUTDAT
0000B3 CCAC 79               4      LD  A,C
0000B4 CCAD CD81EB          17      CALL    PUTDAT
0000B7 CCB0 21B4CD          10      LD  HL,AT_DSS
0000BA CCB3 CDC5EB          17      CALL    FPUTDAT
                                
0000BD CCB6 210000          10      LD  HL,0
0000C0 CCB9 065C             7      LD  B,05CH
0000C2 CCBB 3EFF             7      LD  A,0FFH      ;RST 38H
0000C4 CCBD CDF3DE          17      CALL    FILL_MEMORY
0000C7 CCC0 06A4             7      LD  B,0A4H
0000C9 CCC2 AF               4      XOR A
0000CA CCC3 CDF3DE          17      CALL    FILL_MEMORY
                                
0000CD CCC6 3EC3             7      LD  A,0C3H      ;JP
0000CF CCC8 2103EF          10      LD  HL,CPM_WBOOT
0000D2 CCCB 320000          13      LD  (00000H),A
0000D5 CCCE 220100          16      LD  (00001H),HL ;IPL
                                
0000D8 CCD1 21021D          10      LD  HL,MACW     ;3 bit7  DPB Compatible LA(1)
0000DB CCD4 220300          16      LD  (00003H),HL ;  bit6-0 Machine
                                ;               ;4 LSX-Dodgers(01DH)
0000DE CCD7 2106D0          10      LD  HL,BDOS
0000E1 CCDA 320500          13      LD  (00005H),A
0000E4 CCDD 220600          16      LD  (00006H),HL ;BDOS
                                
0000E7 CCE0 2126DE          10      LD  HL,BIOS
0000EA CCE3 321800          13      LD  (00018H),A
0000ED CCE6 221900          16      LD  (00019H),HL ;BIOS-ROM
                                
0000F0 CCE9 21D9FF          10      LD  HL,TRAP38   ;TRAP38
0000F3 CCEC 323800          13      LD  (00038H),A
0000F6 CCEF 223900          16      LD  (00039H),HL ;RST 038H
                                
0000F9 CCF2 3EEF             7      LD  A,CPM_BOOT/256
0000FB CCF4 320B00          13      LD  (0000BH),A
                                
0000FE CCF7 3EE9             7      LD  A,0E9H      ;JP (HL)
000100 CCF9 320F00          13      LD  (0000FH),A
                                
000103 CCFC 3A7DF0          13      LD  A,(_FATBF+1)
000106 CCFF 321300          13      LD  (00013H),A
                                
000109 CD02 3A7FF0          13      LD  A,(_DTBUF+1)
00010C CD05 321700          13      LD  (00017H),A
                                
00010F CD08 3EFE             7      LD  A,KEYBF/256
000111 CD0A 321B00          13      LD  (0001BH),A
                                
000114 CD0D 3EFF             7      LD  A,KBUF/256
000116 CD0F 321F00          13      LD  (0001FH),A
                                
000119 CD12 214701          10      LD  HL,VER
00011C CD15 225A00          16      LD  (0005AH),HL
                                
00011F CD18 215ECD          10      LD  HL,INIMES
000122 CD1B CD34D6          17      CALL    MSX
       CD1E                     INIT1:
000125 CD1E F3               4      DI
000126 CD1F 1100FF          10      LD  DE,0FF00H
000129 CD22 0600             7      LD  B,0
00012B CD24 CDBFD3          17      CALL    ZERO_MEMORY_DE
00012E CD27 21CAFF          10      LD  HL,EXTBIO
000131 CD2A 060F             7      LD  B,TRAP38-EXTBIO
000133 CD2C 3EFF             7      LD  A,0FFH      ;RST 38H
000135 CD2E CDF3DE          17      CALL    FILL_MEMORY
000138 CD31 218DCD          10      LD  HL,AT_TRAP38
00013B CD34 11D9FF          10      LD  DE,TRAP38
00013E CD37 012700          10      LD  BC,AT_TRAPE-AT_TRAP38
000141 CD3A EDB0                    LDIR
                                
000143 CD3C CD4FDD          17      CALL    CHKEY
000146 CD3F FE03             7      CP  3
000148 CD41 C9              10      RET
                                
       CD42                     CALC_FATLN: ;FAT12のクラスタ数から必要なFATサイズを求める(セクタサイズ512)
000149 CD42 5D               4      LD  E,L
00014A CD43 54               4      LD  D,H
00014B CD44 29              11      ADD HL,HL   ;*2
00014C CD45 19              11      ADD HL,DE   ;*3
00014D CD46 CB3C             8      SRL H   ;/2
00014F CD48 CB1D             8      RR  L   ;1クラスタ辺り1.5バイト必要
000151 CD4A 11FF01          10      LD  DE,511  ;切り上げる
000154 CD4D 19              11      ADD HL,DE
000155 CD4E 7C               4      LD  A,H
000156 CD4F CB3F             8      SRL A
000158 CD51 C9              10      RET
                                
000159 CD52 4155544F45584543    AUTOD:  DB  "AUTOEXEC "
            20                  
000162 CD5B 413A00              AUTODV: DB  "A:",0
                                
000165 CD5E 0C4C53582D446F64    INIMES: DB  00CH,"LSX-Dodgers for PC-8801mkIISR v"
            6765727320666F72    
            2050432D38383031    
            6D6B494953522076    
000185 CD7E 312E                    DB  030H + VER_1, '.'
000187 CD80 3437                    DB  030H + VER_2 ,030H + VER_3
000189 CD82 505233                  DB  "PR3"
00018C CD85 2047616B750D0A          DB  ' Gaku',0DH,0AH
000193 CD8C 00                      DB  0
                                
       CD8D                     AT_TRAP38:
000194 FFD9                         ORG TRAP38,AT_TRAP38-OFFSET
000194 FFD9 210000          10      LD  HL,0
000197 FFDC E3              19      EX  (SP),HL
000198 FFDD 3E24             7      LD  A,'$'
00019A FFDF CD1BD9          17      CALL    MSG_A
00019D FFE2 2B               6      DEC HL
00019E FFE3 7C               4      LD  A,H
00019F FFE4 CDE8FF          17      CALL    PRHX
0001A2 FFE7 7D               4      LD  A,L
       FFE8                     PRHX:
0001A3 FFE8 F5              11      PUSH    AF
0001A4 FFE9 07               4      RLCA
0001A5 FFEA 07               4      RLCA
0001A6 FFEB 07               4      RLCA
0001A7 FFEC 07               4      RLCA
0001A8 FFED CDF1FF          17      CALL    PRHX2
0001AB FFF0 F1              10      POP AF
       FFF1                     PRHX2:
0001AC FFF1 E60F             7      AND 00FH
0001AE FFF3 FE0A             7      CP  10
0001B0 FFF5 3F               4      CCF
0001B1 FFF6 CE30             7      ADC A,'0'
0001B3 FFF8 27               4      DAA
0001B4 FFF9 C31BD9          10      JP  MSG_A
0001B7 FFFC                         DS  4
0001BB CDB4                         ORG $$+OFFSET   ;$DEPHASE
       CDB4                     AT_TRAPE:
                                
       CDB4                     AT_DSS:
0001BB 7C00                         ORG DSS,AT_DSS-OFFSET
       7C00                     READDISKEX:
0001BB 7C00 CD707C          17      CALL    GETPARAMS
0001BE 7C03 AF               4      XOR A
0001BF 7C04 32347C          13      LD  (RETRY_RDDISK),A
0001C2 7C07 2AEE7D          16      LD  HL,(S_PARAMS+2)
0001C5 7C0A 7D               4      LD  A,L
0001C6 7C0B 3D               4      DEC A
0001C7 7C0C B4               4      OR  H
0001C8 7C0D 200C            12      JR  NZ,RDDISK0
0001CA 7C0F 2AF17D          16      LD  HL,(S_PARAMS+5)
0001CD 7C12 7C               4      LD  A,H
0001CE 7C13 BD               4      CP  L
0001CF 7C14 2005            12      JR  NZ,RDDISK0
0001D1 7C16 3E03             7      LD  A,3
0001D3 7C18 32347C          13      LD  (RETRY_RDDISK),A
       7C1B                     RDDISK0:
0001D6 7C1B 3E46             7      LD  A,46H       ;READ DATA
0001D8 7C1D CD7D7C          17      CALL    FDCOMMAND
0001DB 7C20 3834            12      JR  C,FINISH_DISK
0001DD 7C22 CD227D          17      CALL    RDDISK1
       7C25                     WRDISK3:
0001E0 7C25 78               4      LD  A,B
0001E1 7C26 B2               4      OR  D
0001E2 7C27 32F57D          13      LD  (S_LEFT),A
0001E5 7C2A DBF8            11      IN  A,(0F8H)    ;FDC μPD765A TC入力
0001E7 7C2C FB               4      EI
0001E8 7C2D 76               4      HALT
0001E9 7C2E CDBD7D          17      CALL    CHECKRESULT
0001EC 7C31 301D            12      JR  NC,FINISH_DISK0
       7C34                     RETRY_RDDISK    EQU $+1
0001EE 7C33 3E00             7      LD  A,0
0001F0 7C35 B7               4      OR  A
0001F1 7C36 2818            12      JR  Z,FINISH_DISK0
0001F3 7C38 3D               4      DEC A
0001F4 7C39 32347C          13      LD  (RETRY_RDDISK),A
0001F7 7C3C 3AF17D          13      LD  A,(S_PARAMS+5)
0001FA 7C3F FE04             7      CP  4
0001FC 7C41 3003            12      JR  NC,RETRY_RDDISK1
0001FE 7C43 87               4      ADD A,A
0001FF 7C44 1802            12      JR  RETRY_RDDISK2
       7C46                     RETRY_RDDISK1:
000201 7C46 3E01             7      LD  A,1
       7C48                     RETRY_RDDISK2:
000203 7C48 67               4      LD  H,A
000204 7C49 6F               4      LD  L,A
000205 7C4A 22F17D          16      LD  (S_PARAMS+5),HL
000208 7C4D C31B7C          10      JP  RDDISK0
       7C50                     FINISH_DISK0:
00020B 7C50 3AF57D          13      LD  A,(S_LEFT)
00020E 7C53 D601             7      SUB 1
000210 7C55 3F               4      CCF
       7C56                     FINISH_DISK:
000211 7C56 9F               4      SBC A,A
000212 7C57 32F47D          13      LD  (S_CMD_STATUS),A
000215 7C5A C32A00          10      JP  MAIN
                                
       7C5D                     WRITEDISKEX:
000218 7C5D AF               4      XOR A
000219 7C5E 32347C          13      LD  (RETRY_RDDISK),A
00021C 7C61 CD707C          17      CALL    GETPARAMS
00021F 7C64 3E45             7      LD  A,45H       ;WRITE DATA
000221 7C66 CD7D7C          17      CALL    FDCOMMAND
000224 7C69 38EB            12      JR  C,FINISH_DISK
000226 7C6B CD697D          17      CALL    WRDISK1
000229 7C6E 18B5            12      JR  WRDISK3
                                
       7C70                     GETPARAMS:
00022B 7C70 0608             7      LD  B,8
00022D 7C72 E5              11      PUSH    HL
00022E 7C73 21EC7D          10      LD  HL,S_PARAMS
       7C76                     GETPARAMS1:
000231 7C76 D7              12      RST 10H
000232 7C77 77               7      LD  (HL),A
000233 7C78 23               6      INC HL
000234 7C79 10FB            13      DJNZ    GETPARAMS1
000236 7C7B E1              10      POP HL
000237 7C7C C9              10      RET
                                
       7C7D                     FDCOMMAND:
000238 7C7D F5              11      PUSH    AF
000239 7C7E 3AF07D          13      LD  A,(S_PARAMS+4)  ;MFMモード切り替え $FF:2D/2DD $FE:2HD
00023C 7C81 1F               4      RRA
00023D 7C82 3F               4      CCF
00023E 7C83 9F               4      SBC A,A
00023F 7C84 F5              11      PUSH    AF
000240 7C85 E605             7      AND 5
000242 7C87 4F               4      LD  C,A
000243 7C88 3AF37D          13      LD  A,(S_PARAMS+7)  ;シリンダ数
000246 7C8B C6CE             7      ADD A,0-50
000248 7C8D 9F               4      SBC A,A
000249 7C8E E604             7      AND 4
00024B 7C90 B1               4      OR  C
00024C 7C91 0EFA             7      LD  C,0FFH-5    ;マスク
00024E 7C93 47               4      LD  B,A
00024F 7C94 3AEC7D          13      LD  A,(S_PARAMS)    ;0:ドライブA 1:ドライブB
000252 7C97 B7               4      OR  A
000253 7C98 2804            12      JR  Z,SET_WKF4
000255 7C9A CB20             8      SLA B
000257 7C9C CB21             8      SLA C
       7C9E                     SET_WKF4:
000259 7C9E 3AF67D          13      LD  A,(S_WKF4)
00025C 7CA1 A1               4      AND C
00025D 7CA2 B0               4      OR  B
00025E 7CA3 32F67D          13      LD  (S_WKF4),A
000261 7CA6 F1              10      POP AF
000262 7CA7 F620             7      OR  020H        ;bit5:CLK
000264 7CA9 4F               4      LD  C,A
000265 7CAA 3AF67D          13      LD  A,(S_WKF4)
000268 7CAD E6DF             7      AND 0FFH-020H   ;20Hのマスク
00026A 7CAF B1               4      OR  C
00026B 7CB0 D3F4            11      OUT (0F4H),A    ;ドライブ制御
00026D 7CB2 32F67D          13      LD  (S_WKF4),A
                                
000270 7CB5 ED4BEC7D        20      LD  BC,(S_PARAMS)
000274 7CB9 ED5BEE7D        20      LD  DE,(S_PARAMS+2)
000278 7CBD 7A               4      LD  A,D     ;TRACK
000279 7CBE CB3F             8      SRL A       ;CYLINDER
00027B 7CC0 C6FF             7      ADD A,0FFH      ;0の場合、CF=0 それ以外CF=1
00027D 7CC2 9F               4      SBC A,A
00027E 7CC3 E608             7      AND 8       ;SEEK:0FH = 8 | 7
000280 7CC5 F607             7      OR  7       ;RECALIBRATE:7
000282 7CC7 E7              12      RST 20H
000283 7CC8 79               4      LD  A,C     ;DR/HD
000284 7CC9 E7              12      RST 20H
000285 7CCA 7A               4      LD  A,D     ;TRACK
000286 7CCB CB3F             8      SRL A       ;CYLINDER
000288 7CCD C42000          17      CALL    NZ,20H
00028B 7CD0 FB               4      EI
00028C 7CD1 76               4      HALT
00028D 7CD2 3E08             7      LD  A,8     ;SENSE
00028F 7CD4 E7              12      RST 20H
000290 7CD5 CDE27D          17      CALL    RDFDC       ;ST0
000293 7CD8 CDE27D          17      CALL    RDFDC       ;PNC(CYLINDER)
000296 7CDB E5              11      PUSH    HL
000297 7CDC 210040          10      LD  HL,04000H
       7CDF                     WAIT_SEEK:
00029A 7CDF CDDD7D          17      CALL    GETDEVSTAT
00029D 7CE2 E608             7      AND 8
00029F 7CE4 2009            12      JR  NZ,SEEK_OK
0002A1 7CE6 2B               6      DEC HL
0002A2 7CE7 7C               4      LD  A,H
0002A3 7CE8 B5               4      OR  L
0002A4 7CE9 20F4            12      JR  NZ,WAIT_SEEK
0002A6 7CEB E1              10      POP HL
0002A7 7CEC F1              10      POP AF
0002A8 7CED 37               4      SCF
0002A9 7CEE C9              10      RET
       7CEF                     SEEK_OK:
0002AA 7CEF E1              10      POP HL
0002AB 7CF0 F1              10      POP AF
0002AC 7CF1 E7              12      RST 20H
0002AD 7CF2 7A               4      LD  A,D     ;HD US1 US0
0002AE 7CF3 E601             7      AND 1
0002B0 7CF5 87               4      ADD A,A
0002B1 7CF6 87               4      ADD A,A
0002B2 7CF7 B1               4      OR  C
0002B3 7CF8 E7              12      RST 20H
0002B4 7CF9 7A               4      LD  A,D     ;C
0002B5 7CFA CB3F             8      SRL A
0002B7 7CFC E7              12      RST 20H
0002B8 7CFD 7A               4      LD  A,D     ;H
0002B9 7CFE E601             7      AND 1
0002BB 7D00 E7              12      RST 20H
0002BC 7D01 7B               4      LD  A,E     ;R
0002BD 7D02 E7              12      RST 20H
0002BE 7D03 3AF17D          13      LD  A,(S_PARAMS+5)  ;N
0002C1 7D06 FE04             7      CP  4
0002C3 7D08 3802            12      JR  C,FDCOMMAND2
                                
0002C5 7D0A 3E03             7      LD  A,3
       7D0C                     FDCOMMAND2:
0002C7 7D0C E7              12      RST 20H
0002C8 7D0D 78               4      LD  A,B     ;EOT
0002C9 7D0E E7              12      RST 20H
0002CA 7D0F 3E54             7      LD  A,054H      ;GSL
0002CC 7D11 E7              12      RST 20H
                                
0002CD 7D12 3AF27D          13      LD  A,(S_PARAMS+6)
0002D0 7D15 57               4      LD  D,A     ;バイト数H
0002D1 7D16 1E20             7      LD  E,020H      ;NO SERVICE
0002D3 7D18 210040          10      LD  HL,DSS_DATA ;開始アドレス
0002D6 7D1B 01FB00          10      LD  BC,000FBH   ;B:バイト数L C:FDC μPD765A データレジスタ
                                
0002D9 7D1E AF               4      XOR A       ;DTL
0002DA 7D1F E7              12      RST 20H
0002DB 7D20 A7               4      AND A
0002DC 7D21 C9              10      RET
                                
       7D22                     RDDISK1:            ;高速化の為にループ展開x8
0002DD 7D22 FB               4      EI
0002DE 7D23 76               4      HALT
0002DF 7D24 DBFA            11      IN  A,(0FAH)    ;FDC μPD765A ステータスレジスタリード
0002E1 7D26 A3               4      AND E       ;NO SERVICE
0002E2 7D27 C8              11      RET Z
0002E3 7D28 EDA2            16      INI
                                
0002E5 7D2A FB               4      EI
0002E6 7D2B 76               4      HALT
0002E7 7D2C DBFA            11      IN  A,(0FAH)    ;FDC μPD765A ステータスレジスタリード
0002E9 7D2E A3               4      AND E       ;NO SERVICE
0002EA 7D2F C8              11      RET Z
0002EB 7D30 EDA2            16      INI
                                
0002ED 7D32 FB               4      EI
0002EE 7D33 76               4      HALT
0002EF 7D34 DBFA            11      IN  A,(0FAH)    ;FDC μPD765A ステータスレジスタリード
0002F1 7D36 A3               4      AND E       ;NO SERVICE
0002F2 7D37 C8              11      RET Z
0002F3 7D38 EDA2            16      INI
                                
0002F5 7D3A FB               4      EI
0002F6 7D3B 76               4      HALT
0002F7 7D3C DBFA            11      IN  A,(0FAH)    ;FDC μPD765A ステータスレジスタリード
0002F9 7D3E A3               4      AND E       ;NO SERVICE
0002FA 7D3F C8              11      RET Z
0002FB 7D40 EDA2            16      INI
                                
0002FD 7D42 FB               4      EI
0002FE 7D43 76               4      HALT
0002FF 7D44 DBFA            11      IN  A,(0FAH)    ;FDC μPD765A ステータスレジスタリード
000301 7D46 A3               4      AND E       ;NO SERVICE
000302 7D47 C8              11      RET Z
000303 7D48 EDA2            16      INI
                                
000305 7D4A FB               4      EI
000306 7D4B 76               4      HALT
000307 7D4C DBFA            11      IN  A,(0FAH)    ;FDC μPD765A ステータスレジスタリード
000309 7D4E A3               4      AND E       ;NO SERVICE
00030A 7D4F C8              11      RET Z
00030B 7D50 EDA2            16      INI
                                
00030D 7D52 FB               4      EI
00030E 7D53 76               4      HALT
00030F 7D54 DBFA            11      IN  A,(0FAH)    ;FDC μPD765A ステータスレジスタリード
000311 7D56 A3               4      AND E       ;NO SERVICE
000312 7D57 C8              11      RET Z
000313 7D58 EDA2            16      INI
                                
000315 7D5A FB               4      EI
000316 7D5B 76               4      HALT
000317 7D5C DBFA            11      IN  A,(0FAH)    ;FDC μPD765A ステータスレジスタリード
000319 7D5E A3               4      AND E       ;NO SERVICE
00031A 7D5F C8              11      RET Z
00031B 7D60 EDA2            16      INI
                                
00031D 7D62 20BE            12      JR  NZ,RDDISK1
00031F 7D64 15               4      DEC D
000320 7D65 C2227D          10      JP  NZ,RDDISK1
000323 7D68 C9              10      RET
                                
       7D69                     WRDISK1:            ;高速化の為にループ展開x8
000324 7D69 FB               4      EI
000325 7D6A 76               4      HALT
000326 7D6B DBFA            11      IN  A,(0FAH)    ;FDC μPD765A ステータスレジスタリード
000328 7D6D A3               4      AND E
000329 7D6E C8              11      RET Z
00032A 7D6F EDA3            16      OUTI
                                
00032C 7D71 FB               4      EI
00032D 7D72 76               4      HALT
00032E 7D73 DBFA            11      IN  A,(0FAH)    ;FDC μPD765A ステータスレジスタリード
000330 7D75 A3               4      AND E
000331 7D76 C8              11      RET Z
000332 7D77 EDA3            16      OUTI
                                
000334 7D79 FB               4      EI
000335 7D7A 76               4      HALT
000336 7D7B DBFA            11      IN  A,(0FAH)    ;FDC μPD765A ステータスレジスタリード
000338 7D7D A3               4      AND E
000339 7D7E C8              11      RET Z
00033A 7D7F EDA3            16      OUTI
                                
00033C 7D81 FB               4      EI
00033D 7D82 76               4      HALT
00033E 7D83 DBFA            11      IN  A,(0FAH)    ;FDC μPD765A ステータスレジスタリード
000340 7D85 A3               4      AND E
000341 7D86 C8              11      RET Z
000342 7D87 EDA3            16      OUTI
                                
000344 7D89 FB               4      EI
000345 7D8A 76               4      HALT
000346 7D8B DBFA            11      IN  A,(0FAH)    ;FDC μPD765A ステータスレジスタリード
000348 7D8D A3               4      AND E
000349 7D8E C8              11      RET Z
00034A 7D8F EDA3            16      OUTI
                                
00034C 7D91 FB               4      EI
00034D 7D92 76               4      HALT
00034E 7D93 DBFA            11      IN  A,(0FAH)    ;FDC μPD765A ステータスレジスタリード
000350 7D95 A3               4      AND E
000351 7D96 C8              11      RET Z
000352 7D97 EDA3            16      OUTI
                                
000354 7D99 FB               4      EI
000355 7D9A 76               4      HALT
000356 7D9B DBFA            11      IN  A,(0FAH)    ;FDC μPD765A ステータスレジスタリード
000358 7D9D A3               4      AND E
000359 7D9E C8              11      RET Z
00035A 7D9F EDA3            16      OUTI
                                
00035C 7DA1 FB               4      EI
00035D 7DA2 76               4      HALT
00035E 7DA3 DBFA            11      IN  A,(0FAH)    ;FDC μPD765A ステータスレジスタリード
000360 7DA5 A3               4      AND E
000361 7DA6 C8              11      RET Z
000362 7DA7 EDA3            16      OUTI
                                
000364 7DA9 20BE            12      JR  NZ,WRDISK1
000366 7DAB 15               4      DEC D
000367 7DAC C2697D          10      JP  NZ,WRDISK1
00036A 7DAF C9              10      RET
                                
       7DB0                     RESULTEX:
00036B 7DB0 3AF47D          13      LD  A,(S_CMD_STATUS)
00036E 7DB3 3C               4      INC A
00036F 7DB4 2803            12      JR  Z,RESULTEX1
000371 7DB6 3AF27D          13      LD  A,(S_PARAMS+6)  ;バイト数H
       7DB9                     RESULTEX1:
000374 7DB9 DF              12      RST 18H
000375 7DBA C32A00          10      JP  MAIN
                                
       7DBD                     CHECKRESULT:
000378 7DBD C5              11      PUSH    BC
000379 7DBE CDE27D          17      CALL    RDFDC       ;ST0
00037C 7DC1 E6D8             7      AND 0D8H
00037E 7DC3 4F               4      LD  C,A
00037F 7DC4 CDE27D          17      CALL    RDFDC       ;ST1
000382 7DC7 B1               4      OR  C
000383 7DC8 4F               4      LD  C,A
000384 7DC9 CDE27D          17      CALL    RDFDC       ;ST2
000387 7DCC E673             7      AND 073H
000389 7DCE B1               4      OR  C
00038A 7DCF 4F               4      LD  C,A
00038B 7DD0 0604             7      LD  B,4
       7DD2                     CHECKRESULT1:           ;C H R N
00038D 7DD2 CDE27D          17      CALL    RDFDC
000390 7DD5 10FB            13      DJNZ    CHECKRESULT1
000392 7DD7 79               4      LD  A,C
000393 7DD8 A7               4      AND A
000394 7DD9 C1              10      POP BC
000395 7DDA C8              11      RET Z
000396 7DDB 37               4      SCF
000397 7DDC C9              10      RET
                                
       7DDD                     GETDEVSTAT:
000398 7DDD 3E04             7      LD  A,4
00039A 7DDF E7              12      RST 20H
00039B 7DE0 79               4      LD  A,C
00039C 7DE1 E7              12      RST 20H
                                
       7DE2                     RDFDC:
00039D 7DE2 DBFA            11      IN  A,(0FAH)    ;FDC μPD765A ステータスレジスタリード
00039F 7DE4 2F               4      CPL
0003A0 7DE5 E6C0             7      AND 0C0H        ;RQMとDIOが両方1になるまで待つ
0003A2 7DE7 20F9            12      JR  NZ,RDFDC
0003A4 7DE9 DBFB            11      IN  A,(0FBH)    ;FDC μPD765A データレジスタリード
0003A6 7DEB C9              10      RET
                                
       7DEC                     S_PARAMS:
0003A7 7DEC                         DS  8
       7DF4                     S_CMD_STATUS:
0003AF 7DF4 00                      DB  0
       7DF5                     S_LEFT:
0003B0 7DF5 00                      DB  0
       7DF6                     S_WKF4:
0003B1 7DF6 00                      DB  0
                                
0003B2 CFAB                         ORG $$+OFFSET   ;$DEPHASE
       CFAB                     AT_DSSE:
                                
       CFAB                     INITE:
                                ;   ORG BDOS,INITE-OFFSET
0003B2 CFAB                         DS  BDOS-INITE
00040D D006 C3E7D8          10      JP  BDOS_RF
[EOF:88INIT.ASM:SHIFT_JIS]
                                    INCLUDE "88CCP.ASM"
                                
                                ;   LSX-Dodgers CCP
                                ;   PC-8801mkIISR
                                
       D009                     WBOOT1:
000410 D009 ED7B0600        20      LD  SP,(SYSTEM+1)
000414 D00D DB32            11      IN  A,(032H)
000416 D00F F610             7      OR  10H     ;高速RAMアクセスモードOFF
000418 D011 D332            11      OUT (032H),A
00041A D013 FB               4      EI
00041B D014 2192EF          10      LD  HL,_KEYD
00041E D017 3600            10      LD  (HL),0
000420 D019 CD4FDD          17      CALL    CHKEY
000423 D01C CD08D9          17      CALL    KEYBC_IFBREAK
000426 D01F 3E04             7      LD  A,4
000428 D021 CD1BD9          17      CALL    MSG_A
[EOF:88CCP.ASM:SHIFT_JIS]
                                    INCLUDE "LDCCP.ASM"
                                
                                ;   LSX-Dodgers CCP
                                
       D024                     COMMAND:
00042B D024 CDD7D0          17      CALL    SETDTA1
00042E D027 3A87EF          13      LD  A,(_DVSW)
000431 D02A C641             7      ADD A,'A'
000433 D02C CD1BD9          17      CALL    MSG_A
000436 D02F 3E3E             7      LD  A,'>'
000438 D031 CD1BD9          17      CALL    MSG_A
00043B D034 3E50             7      LD  A,80
00043D D036 12               7      LD  (DE),A
00043E D037 CD58D9          17      CALL    _SYS0A      ;(BDOS)文字列入力
000441 D03A CD81D2          17      CALL    LTNL
                                
000444 D03D 118200          10      LD  DE,DTA1+2
000447 D040 CDFDEF          17      CALL    _COMANL
00044A D043 30DF            12      JR  NC,COMMAND
00044C D045 1179EF          10      LD  DE,COMERM
00044F D048 CD25D6          17      CALL    _SYS09      ;(BDOS)文字列出力
000452 D04B C7              12      RST 0
                                
       D04C                     COMANL:
000453 D04C CD47DE          17      CALL    FILE
000456 D04F 3A19EF          13      LD  A,(FNAME+4)
000459 D052 FE20             7      CP  020H
00045B D054 201C            12      JR  NZ,COMB2
00045D D056 D5              11      PUSH    DE
00045E D057 1115EF          10      LD  DE,FNAME
000461 D05A 1A               7      LD  A,(DE)
000462 D05B FE20             7      CP  020H
000464 D05D 2844            12      JR  Z,SDVSW
000466 D05F 1B               6      DEC DE
000467 D060 1A               7      LD  A,(DE)
000468 D061 C6FF             7      ADD A,0FFH
00046A D063 3809            12      JR  C,COMB
00046C D065 13               6      INC DE
                                
00046D D066 2162D5          10      LD  HL,COMTB
000470 D069 0609             7      LD  B,COMS
000472 D06B CDCBE0          17      CALL    CPNAME
       D06E                     COMB:
000475 D06E D1              10      POP DE
000476 D06F D20F00          10      JP  NC,JP_HL
       D072                     COMB2:
000479 D072 EB               4      EX  DE,HL
00047A D073 224BD1          16      LD  (COMPAT+1),HL
00047D D076 F5              11      PUSH    AF
00047E D077 CDF7D0          17      CALL    CEXE4
000481 D07A F1              10      POP AF
000482 D07B 2115EF          10      LD  HL,FNAME
000485 D07E 116D00          10      LD  DE,FCB2+1   ;COMMAND NAME
000488 D081 010B00          10      LD  BC,11
00048B D084 EDB0                    LDIR
00048D D086 1105D5          10      LD  DE,PATHD
       D089                     CEX1:
000490 D089 1A               7      LD  A,(DE)
000491 D08A FE20             7      CP  020H
000493 D08C D8              11      RET C
000494 D08D CD3CDE          17      CALL    FILEC
000497 D090 D5              11      PUSH    DE
000498 D091 216D00          10      LD  HL,FCB2+1   ;COMMAND NAME
00049B D094 1115EF          10      LD  DE,FNAME
00049E D097 010B00          10      LD  BC,11
0004A1 D09A EDB0                    LDIR
0004A3 D09C CDF7D0          17      CALL    CEXE4
0004A6 D09F D1              10      POP DE
0004A7 D0A0 13               6      INC DE
0004A8 D0A1 18E6            12      JR  CEX1
                                
       D0A3                     SDVSW:
0004AA D0A3 F1              10      POP AF
0004AB D0A4 3A14EF          13      LD  A,(FDRV)
0004AE D0A7 3D               4      DEC A
0004AF D0A8 5F               4      LD  E,A
0004B0 D0A9 0E0E             7      LD  C,00EH      ;(BDOS)カレントドライブの設定
0004B2 D0AB 1831            12      JR  SYSTEM0
                                
       D0AD                     OPEN1:
0004B4 D0AD 2114EF          10      LD  HL,FDRV
       D0B0                     OPEN:
0004B7 D0B0 0E11             7      LD  C,011H      ;(BDOS)ファイルの検索
       D0B2                     OPEN3:
0004B9 D0B2 D5              11      PUSH    DE
0004BA D0B3 11E0D4          10      LD  DE,DTA_CCP
0004BD D0B6 CDD4D0          17      CALL    SETDTA
0004C0 D0B9 EB               4      EX  DE,HL
0004C1 D0BA CDDED0          17      CALL    SYSTEM0
0004C4 D0BD D1              10      POP DE
0004C5 D0BE C9              10      RET
                                
       D0BF                     OPEN2:
0004C6 D0BF 0E12             7      LD  C,012H
0004C8 D0C1 18EF            12      JR  OPEN3
                                
       D0C3                     DEFCB:              ;Z=Ok NZ=Error
0004CA D0C3 11E0D4          10      LD  DE,DTA_CCP
0004CD D0C6 CDDCD0          17      CALL    SYSC0F
                                
0004D0 D0C9 1101D5          10      LD  DE,DTA_CCP+33   ;(FCB)ランダムレコード
0004D3 D0CC 0604             7      LD  B,4
0004D5 D0CE CDBFD3          17      CALL    ZERO_MEMORY_DE
0004D8 D0D1 110001          10      LD  DE,00100H
       D0D4                     SETDTA:
0004DB D0D4 C323D8          10      JP  _SYS1A      ;(BDOS)DTAの設定
                                
       D0D7                     SETDTA1:
0004DE D0D7 118000          10      LD  DE,DTA1
0004E1 D0DA 18F8            12      JR  SETDTA
                                
       D0DC                     SYSC0F:
0004E3 D0DC 0E0F             7      LD  C,00FH      ;(BDOS)ファイルのオープン
       D0DE                     SYSTEM0:
0004E5 D0DE CD0500          17      CALL    SYSTEM
0004E8 D0E1 B7               4      OR  A
0004E9 D0E2 C9              10      RET
                                
       D0E3                     C_CD:
0004EA D0E3 0E5A             7      LD  C,5AH
0004EC D0E5 18F7            12      JR  SYSTEM0
                                
       D0E7                     S27BUF:
0004EE D0E7 3A0700          13      LD  A,(SYSTEM+2)
0004F1 D0EA 3D               4      DEC A
0004F2 D0EB E6F8             7      AND 0F8H
0004F4 D0ED 67               4      LD  H,A
0004F5 D0EE 2E00             7      LD  L,0
       D0F0                     S27DTA:
0004F7 D0F0 11E0D4          10      LD  DE,DTA_CCP
       D0F3                     S27:
0004FA D0F3 0E27             7      LD  C,027H      ;(BDOS)ランダムブロック読み込み
0004FC D0F5 18E7            12      JR  SYSTEM0
                                
       D0F7                     CEXE4:
0004FE D0F7 3A14EF          13      LD  A,(FDRV)
000501 D0FA 325700          13      LD  (00057H),A
000504 D0FD 2A22EF          16      LD  HL,(FDRV+14)
000507 D100 225800          16      LD  (00058H),HL
                                
00050A D103 211DEF          10      LD  HL,FNAME+8
00050D D106 7E               7      LD  A,(HL)
00050E D107 FE20             7      CP  020H
000510 D109 2007            12      JR  NZ,CEXE7
000512 D10B 3E3F             7      LD  A,'?'
000514 D10D 77               7      LD  (HL),A
000515 D10E 23               6      INC HL
000516 D10F 77               7      LD  (HL),A
000517 D110 23               6      INC HL
000518 D111 77               7      LD  (HL),A
       D112                     CEXE7:
000519 D112 CDADD0          17      CALL    OPEN1
       D115                     CEXE5:
00051C D115 C0              11      RET NZ
00051D D116 2AEAD4          16      LD  HL,(DTA_CCP+1+9)
000520 D119 7C               4      LD  A,H
000521 D11A CD53E1          17      CALL    CAP
000524 D11D 67               4      LD  H,A
000525 D11E 7D               4      LD  A,L
000526 D11F CD53E1          17      CALL    CAP
000529 D122 6F               4      LD  L,A
00052A D123 3AE9D4          13      LD  A,(DTA_CCP+1+8)
00052D D126 CD53E1          17      CALL    CAP
000530 D129 D642             7      SUB 'B'
000532 D12B 282C            12      JR  Z,C_BAT
000534 D12D 3D               4      DEC A       ;'C'
000535 D12E 2805            12      JR  Z,C_EXE
       D130                     CEXE6:
000537 D130 CDBFD0          17      CALL    OPEN2
00053A D133 18E0            12      JR  CEXE5
                                
       D135                     C_EXE:
00053C D135 7C               4      LD  A,H
00053D D136 FE4D             7      CP  'M'
00053F D138 20F6            12      JR  NZ,CEXE6
                                
000541 D13A CDC3D0          17      CALL    DEFCB
000544 D13D CDE7D0          17      CALL    S27BUF
000547 D140 3D               4      DEC A
000548 D141 37               4      SCF
000549 D142 C0              11      RET NZ
00054A D143 7C               4      LD  A,H
00054B D144 B5               4      OR  L
00054C D145 37               4      SCF
00054D D146 C8              11      RET Z
00054E D147 CDD7D0          17      CALL    SETDTA1
000551 D14A 110000          10  COMPAT: LD  DE,0                ; self-modifying code
000554 D14D ED7B0600        20      LD  SP,(SYSTEM+1)
000558 D151 67               4      LD  H,A             ; A=0 in SETDTA1(_SYS1A)
000559 D152 6F               4      LD  L,A
00055A D153 E5              11      PUSH    HL              ; push $0000 (reboot address)
00055B D154 24               4      INC H
00055C D155 E5              11      PUSH    HL              ; push $0100 (TPA address)
00055D D156 C38AD3          10      JP  SETFCB              ; and JP $0100
                                
       D159                     C_BAT:
000560 D159 114154          10      LD  DE,'A'+'T'*256
000563 D15C ED52            15      SBC HL,DE
000565 D15E 20D0            12      JR  NZ,CEXE6
                                
000567 D160 F1              10      POP AF
000568 D161 F1              10      POP AF
000569 D162 CDC3D0          17      CALL    DEFCB
00056C D165 210002          10      LD  HL,00200H
00056F D168 CDF0D0          17      CALL    S27DTA
000572 D16B C6FE             7      ADD A,0FEH
000574 D16D D8              11      RET C
000575 D16E 7D               4      LD  A,L
000576 D16F B7               4      OR  A
000577 D170 37               4      SCF
000578 D171 C8              11      RET Z
000579 D172 3C               4      INC A
00057A D173 F5              11      PUSH    AF
                                
00057B D174 CD0BD9          17      CALL    KEYBC
00057E D177 3E06             7      LD  A,6
000580 D179 CD1BD9          17      CALL    MSG_A
000583 D17C C1              10      POP BC
000584 D17D 210001          10      LD  HL,00100H
       D180                     BAT1:
000587 D180 A7               4      AND A
000588 D181 05               4      DEC B
000589 D182 C8              11      RET Z
00058A D183 7E               7      LD  A,(HL)
00058B D184 FE25             7      CP  '%'
00058D D186 280C            12      JR  Z,BAT2
       D188                     BAT1X:
00058F D188 7E               7      LD  A,(HL)
000590 D189 23               6      INC HL
000591 D18A FE1A             7      CP  01AH
000593 D18C C8              11      RET Z
000594 D18D FE0A             7      CP  00AH
000596 D18F C4F0D8          17      CALL    NZ,KEYBS
000599 D192 18EC            12      JR  BAT1
                                
       D194                     BAT2:
00059B D194 23               6      INC HL
00059C D195 7E               7      LD  A,(HL)
00059D D196 2B               6      DEC HL
00059E D197 D631             7      SUB '1'
0005A0 D199 38ED            12      JR  C,BAT1X
0005A2 D19B FE09             7      CP  9
0005A4 D19D 30E9            12      JR  NC,BAT1X
0005A6 D19F 23               6      INC HL
0005A7 D1A0 23               6      INC HL
0005A8 D1A1 3C               4      INC A
0005A9 D1A2 4F               4      LD  C,A
0005AA D1A3 ED5B4BD1        20      LD  DE,(COMPAT+1)
       D1A7                     BAT3:
0005AE D1A7 1A               7      LD  A,(DE)
0005AF D1A8 B7               4      OR  A
0005B0 D1A9 28D5            12      JR  Z,BAT1
0005B2 D1AB CD1EDF          17      CALL    SPCUT
0005B5 D1AE 0D               4      DEC C
0005B6 D1AF 2808            12      JR  Z,BAT5
       D1B1                     BAT4:
0005B8 D1B1 1A               7      LD  A,(DE)
0005B9 D1B2 FE21             7      CP  021H
0005BB D1B4 38F1            12      JR  C,BAT3
0005BD D1B6 13               6      INC DE
0005BE D1B7 18F8            12      JR  BAT4
       D1B9                     BAT5:
0005C0 D1B9 1A               7      LD  A,(DE)
0005C1 D1BA FE21             7      CP  021H
0005C3 D1BC 38C2            12      JR  C,BAT1
0005C5 D1BE 13               6      INC DE
0005C6 D1BF CDF0D8          17      CALL    KEYBS
0005C9 D1C2 18F5            12      JR  BAT5
                                
       D1C4                     C_DEL:
0005CB D1C4 CD8AD3          17      CALL    SETFCB
0005CE D1C7 CD31D9          17      CALL    _SYS08      ;(BDOS)エコーなしコンソール入力
                                
0005D1 D1CA 0E13             7      LD  C,013H
0005D3 D1CC 180A            12      JR  CDEL1       ;(BDOS)ファイルの削除
                                
       D1CE                     C_REN:
0005D5 D1CE CD8AD3          17      CALL    SETFCB
0005D8 D1D1 3E10             7      LD  A,010H      ;ディレクトリも対象にする
0005DA D1D3 326900          13      LD  (FCB1+13),A ;属性
0005DD D1D6 0E17             7      LD  C,017H      ;(BDOS)ファイル名の変更
       D1D8                     CDEL1:
0005DF D1D8 115C00          10      LD  DE,FCB1
0005E2 D1DB CD0500          17      CALL    SYSTEM
0005E5 D1DE C6FF             7      ADD A,0FFH
0005E7 D1E0 C9              10      RET
                                
       D1E1                     C_DIR:
0005E8 D1E1 CD3CDE          17      CALL    FILEC
0005EB D1E4 2115EF          10      LD  HL,FDRV+1
0005EE D1E7 CDD5D4          17      CALL    CWILD1
0005F1 D1EA 3EF1             7      LD  A,0F1H
0005F3 D1EC 3221EF          13      LD  (FDRV+13),A
0005F6 D1EF CDADD0          17      CALL    OPEN1
       D1F2                     CDIR1:
0005F9 D1F2 B7               4      OR  A
0005FA D1F3 2008            12      JR  NZ,PDSKF
0005FC D1F5 CD40D2          17      CALL    P_NAME
0005FF D1F8 CDBFD0          17      CALL    OPEN2
000602 D1FB 18F5            12      JR  CDIR1
                                
       D1FD                     PDSKF:
000604 D1FD 3A14EF          13      LD  A,(FDRV)
000607 D200 5F               4      LD  E,A
000608 D201 0E1B             7      LD  C,01BH      ;(BDOS)ディスク情報の獲得
00060A D203 CD0500          17      CALL    SYSTEM
00060D D206 4F               4      LD  C,A     ;C←1クラスタ辺りの論理セクタ数
00060E D207 C601             7      ADD A,001H
000610 D209 D8              11      RET C       ;Aが0FFHだった場合
000611 D20A 3E06             7      LD  A,8-2
       D20C                     PDS1:               ;HL=未使用クラスタの総数
000613 D20C 3C               4      INC A
000614 D20D CB19             8      RR  C
000616 D20F 30FB            12      JR  NC,PDS1
       D211                     PDS2:               ;B←論理セクタのサイズの上位8ビット
000618 D211 3C               4      INC A
000619 D212 CB18             8      RR  B
00061B D214 30FB            12      JR  NC,PDS2
00061D D216 47               4      LD  B,A
                                
00061E D217 110000          10      LD  DE,0
       D21A                     PDS3:
000621 D21A 29              11      ADD HL,HL
000622 D21B EB               4      EX  DE,HL
000623 D21C ED6A            15      ADC HL,HL
000625 D21E EB               4      EX  DE,HL
000626 D21F 10F9            13      DJNZ    PDS3
       D221                     PDSKF1:
000628 D221 CDB9D2          17      CALL    PRDEC_DEHL
00062B D224 1146D5          10      LD  DE,FREE
00062E D227 CD25D6          17      CALL    _SYS09      ;(BDOS)文字列出力
000631 D22A CDA8D2          17      CALL    PUTDRV
000634 D22D 3E5C             7      LD  A,05CH      ;\
000636 D22F CD1BD9          17      CALL    MSG_A
000639 D232 2A22EF          16      LD  HL,(FDRV+14)    ;ディレクトリのクラスタ番号
00063C D235 AF               4      XOR A
00063D D236 11FEFF          10      LD  DE,0-2
000640 D239 19              11      ADD HL,DE
000641 D23A 23               6      INC HL
000642 D23B DCB5D2          17      CALL    C,PRDEC_HL
000645 D23E 1841            12      JR  LTNL
                                
       D240                     P_NAME:
000647 D240 3AE1D4          13      LD  A,(DTA_CCP+1)
00064A D243 FE2E             7      CP  '.'
00064C D245 C8              11      RET Z
00064D D246 115ED5          10      LD  DE,DIRHD
000650 D249 CD25D6          17      CALL    _SYS09      ;(BDOS)文字列出力
000653 D24C 3AECD4          13      LD  A,(DTA_CCP+1+00BH)
000656 D24F F5              11      PUSH    AF
000657 D250 0F               4      RRCA
000658 D251 9F               4      SBC A,A
000659 D252 E60A             7      AND '*'-020H
00065B D254 C620             7      ADD A,020H
00065D D256 CD1BD9          17      CALL    MSG_A
000660 D259 CDA8D2          17      CALL    PUTDRV
000663 D25C 21E1D4          10      LD  HL,DTA_CCP+1
000666 D25F CDF9D2          17      CALL    FPRNT
                                
000669 D262 F1              10      POP AF
00066A D263 CB67             8      BIT 4,A
00066C D265 2808            12      JR  Z,DIR3
00066E D267 1153D5          10      LD  DE,DIRMES
000671 D26A CD25D6          17      CALL    _SYS09      ;(BDOS)文字列出力
000674 D26D 180A            12      JR  DIR6
       D26F                     DIR3:
000676 D26F ED5BFFD4        20      LD  DE,(DTA_CCP+1+01EH)
00067A D273 2AFDD4          16      LD  HL,(DTA_CCP+1+01CH)
00067D D276 CDB9D2          17      CALL    PRDEC_DEHL
       D279                     DIR6:
000680 D279 3AB1EF          13      LD  A,(_WIDTH)
000683 D27C FE29             7      CP  40+1
000685 D27E D41BD3          17      CALL    NC,PRTTMS
                                
       D281                     LTNL:
000688 D281 1E03             7      LD  E,3
00068A D283 C3CDEF          10      JP  _PRINT
                                
       D286                     C_PATH:
00068D D286 CD1EDF          17      CALL    SPCUT
000690 D289 2105D5          10      LD  HL,PATHD
000693 D28C FE21             7      CP  021H
000695 D28E 300C            12      JR  NC,CPATH0
       D290                     CPATHP:
000697 D290 7E               7      LD  A,(HL)
000698 D291 23               6      INC HL
000699 D292 FE20             7      CP  020H
00069B D294 3F               4      CCF
00069C D295 30EA            12      JR  NC,LTNL
00069E D297 CD1BD9          17      CALL    MSG_A
0006A1 D29A 18F4            12      JR  CPATHP
       D29C                     CPATH0:
0006A3 D29C FE3B             7      CP  ';'
0006A5 D29E 2001            12      JR  NZ,CPATH1
0006A7 D2A0 13               6      INC DE
       D2A1                     CPATH1:
0006A8 D2A1 EB               4      EX  DE,HL
0006A9 D2A2 014000          10      LD  BC,PATHX
0006AC D2A5 EDB0                    LDIR
0006AE D2A7 C9              10      RET
                                
       D2A8                     PUTDRV:
0006AF D2A8 3A14EF          13      LD  A,(FDRV)
0006B2 D2AB C640             7      ADD A,'A'-1
0006B4 D2AD CD1BD9          17      CALL    MSG_A
0006B7 D2B0 3E3A             7      LD  A,':'
       D2B2                     MSG_AR:
0006B9 D2B2 C31BD9          10      JP  MSG_A
                                
       D2B5                     PRDEC_HL:
0006BC D2B5 AF               4      XOR A
       D2B6                     PRDEC_AHL:
0006BD D2B6 5F               4      LD  E,A
0006BE D2B7 1600             7      LD  D,0
       D2B9                     PRDEC_DEHL:
0006C0 D2B9 D5              11      PUSH    DE
0006C1 D2BA 110FEF          10      LD  DE,DECBF
0006C4 D2BD 0605             7      LD  B,5
0006C6 D2BF CDBFD3          17      CALL    ZERO_MEMORY_DE  ;A=0
0006C9 D2C2 D1              10      POP DE
                                
0006CA D2C3 0E20             7      LD  C,32
       D2C5                     DEC1:
0006CC D2C5 29              11      ADD HL,HL
0006CD D2C6 EB               4      EX  DE,HL
0006CE D2C7 ED6A            15      ADC HL,HL
0006D0 D2C9 EB               4      EX  DE,HL
0006D1 D2CA E5              11      PUSH    HL
0006D2 D2CB 2113EF          10      LD  HL,DECBF+4
0006D5 D2CE 0605             7      LD  B,5
       D2D0                     DEC2:
0006D7 D2D0 7E               7      LD  A,(HL)
0006D8 D2D1 8F               4      ADC A,A
0006D9 D2D2 27               4      DAA
0006DA D2D3 77               7      LD  (HL),A
0006DB D2D4 2B               6      DEC HL
0006DC D2D5 10F9            13      DJNZ    DEC2
0006DE D2D7 E1              10      POP HL
0006DF D2D8 0D               4      DEC C
0006E0 D2D9 20EA            12      JR  NZ,DEC1
                                
0006E2 D2DB 210FEF          10      LD  HL,DECBF
0006E5 D2DE 3E20             7      LD  A,020H
0006E7 D2E0 0604             7      LD  B,4
       D2E2                     DEC3:
0006E9 D2E2 CDEFD2          17      CALL    DEC4
0006EC D2E5 CDEFD2          17      CALL    DEC4
0006EF D2E8 23               6      INC HL
0006F0 D2E9 10F7            13      DJNZ    DEC3
       D2EB                     DECX:
0006F2 D2EB CDEFD2          17      CALL    DEC4
0006F5 D2EE AF               4      XOR A
       D2EF                     DEC4:
0006F6 D2EF ED6F            18      RLD
0006F8 D2F1 FE20             7      CP  020H
0006FA D2F3 2802            12      JR  Z,DEC5
0006FC D2F5 F630             7      OR  030H
       D2F7                     DEC5:
0006FE D2F7 18B9            12      JR  MSG_AR
                                
       D2F9                     FPRNT:
000700 D2F9 0608             7      LD  B,8
000702 D2FB CD0CD3          17      CALL    P_N1
000705 D2FE 7E               7      LD  A,(HL)
000706 D2FF C680             7      ADD A,0A0H-020H
000708 D301 FEA0             7      CP  0A0H
00070A D303 2802            12      JR  Z,FPR1
00070C D305 3E2E             7      LD  A,'.'
       D307                     FPR1:
00070E D307 CD1BD9          17      CALL    MSG_A
000711 D30A 0603             7      LD  B,3
                                
       D30C                     P_N1:
000713 D30C C5              11      PUSH    BC
000714 D30D E5              11      PUSH    HL
000715 D30E 7E               7      LD  A,(HL)
000716 D30F CD5FE1          17      CALL    CAP3
000719 D312 CD1BD9          17      CALL    MSG_A
00071C D315 E1              10      POP HL
00071D D316 C1              10      POP BC
00071E D317 23               6      INC HL
00071F D318 10F2            13      DJNZ    P_N1
000721 D31A C9              10      RET
                                
       D31B                     PRTTMS:
000722 D31B 3E20             7      LD  A,020H
000724 D31D CD1BD9          17      CALL    MSG_A
                                
000727 D320 2AF9D4          16      LD  HL,(DTA_CCP+1+24)
00072A D323 7D               4      LD  A,L
00072B D324 B7               4      OR  A
00072C D325 C8              11      RET Z
00072D D326 CB3C             8      SRL H
00072F D328 17               4      RLA
000730 D329 17               4      RLA
000731 D32A 17               4      RLA
000732 D32B 17               4      RLA
000733 D32C E60F             7      AND 00FH
000735 D32E 57               4      LD  D,A
000736 D32F 7C               4      LD  A,H
000737 D330 C650             7      ADD A,80
000739 D332 CD75D3          17      CALL    PRDEC_A
00073C D335 3E2D             7      LD  A,'-'
00073E D337 CD1BD9          17      CALL    MSG_A
000741 D33A 7A               4      LD  A,D
000742 D33B CD75D3          17      CALL    PRDEC_A
000745 D33E 3E2D             7      LD  A,'-'
000747 D340 CD1BD9          17      CALL    MSG_A
00074A D343 7D               4      LD  A,L
00074B D344 E61F             7      AND 01FH
00074D D346 CD75D3          17      CALL    PRDEC_A
                                
000750 D349 2AF7D4          16      LD  HL,(DTA_CCP+1+22)
                                
000753 D34C 3E20             7      LD  A,020H
000755 D34E CD1BD9          17      CALL    MSG_A
000758 D351 7C               4      LD  A,H
000759 D352 65               4      LD  H,L
00075A D353 0603             7      LD  B,3
       D355                     PRTTMS1:
00075C D355 1F               4      RRA
00075D D356 CB1D             8      RR  L
00075F D358 10FB            13      DJNZ    PRTTMS1
000761 D35A E61F             7      AND 01FH
000763 D35C CD75D3          17      CALL    PRDEC_A
000766 D35F 3E3A             7      LD  A,':'
000768 D361 CD1BD9          17      CALL    MSG_A
00076B D364 7D               4      LD  A,L
00076C D365 0F               4      RRCA
00076D D366 0F               4      RRCA
00076E D367 E63F             7      AND 03FH
000770 D369 CD75D3          17      CALL    PRDEC_A
000773 D36C 3E3A             7      LD  A,':'
000775 D36E CD1BD9          17      CALL    MSG_A
000778 D371 7C               4      LD  A,H
000779 D372 E61F             7      AND 01FH
00077B D374 87               4      ADD A,A
                                
                                ;   PRINT10
                                
       D375                     PRDEC_A:
00077C D375 E5              11      PUSH    HL
00077D D376 0608             7      LD  B,8
00077F D378 4F               4      LD  C,A
000780 D379 AF               4      XOR A
       D37A                     PRTA1:
000781 D37A CB01             4      RLC C
000783 D37C 8F               4      ADC A,A
000784 D37D 27               4      DAA
000785 D37E 10FA            13      DJNZ    PRTA1
000787 D380 210FEF          10      LD  HL,DECBF
00078A D383 77               7      LD  (HL),A
00078B D384 AF               4      XOR A
00078C D385 CDEBD2          17      CALL    DECX
00078F D388 E1              10      POP HL
000790 D389 C9              10      RET
                                
       D38A                     SETFCB:
000791 D38A CD1EDF          17      CALL    SPCUT
000794 D38D 1A               7      LD  A,(DE)
000795 D38E FE20             7      CP  020H
000797 D390 3801            12      JR  C,SETFCBA
000799 D392 1B               6      DEC DE
       D393                     SETFCBA:
00079A D393 0624             7      LD  B,36
00079C D395 215C00          10      LD  HL,FCB1
00079F D398 E5              11      PUSH    HL
0007A0 D399 AF               4      XOR A
0007A1 D39A CDF3DE          17      CALL    FILL_MEMORY
0007A4 D39D E1              10      POP HL
0007A5 D39E D5              11      PUSH    DE
0007A6 D39F CD8FD8          17      CALL    _SYS5C      ;(BDOS)ファイル名の解析
0007A9 D3A2 216C00          10      LD  HL,FCB2
0007AC D3A5 CD8FD8          17      CALL    _SYS5C      ;(BDOS)ファイル名の解析
0007AF D3A8 E1              10      POP HL
0007B0 D3A9 010050          10      LD  BC,05000H
0007B3 D3AC 118100          10      LD  DE,00081H
       D3AF                     SETFCB1:
0007B6 D3AF 7E               7      LD  A,(HL)
0007B7 D3B0 23               6      INC HL
0007B8 D3B1 FE20             7      CP  020H
0007BA D3B3 3805            12      JR  C,SETFCB2
0007BC D3B5 12               7      LD  (DE),A
0007BD D3B6 13               6      INC DE
0007BE D3B7 0C               4      INC C
0007BF D3B8 10F5            13      DJNZ    SETFCB1
       D3BA                     SETFCB2:
0007C1 D3BA 79               4      LD  A,C
0007C2 D3BB 328000          13      LD  (DTA1),A
0007C5 D3BE 04               4      INC B
       D3BF                     ZERO_MEMORY_DE:
0007C6 D3BF AF               4      XOR A
       D3C0                     FILL_MEMORY_DE:
0007C7 D3C0 12               7      LD  (DE),A
0007C8 D3C1 13               6      INC DE
0007C9 D3C2 10FC            13      DJNZ    FILL_MEMORY_DE
0007CB D3C4 C9              10      RET
                                
       D3C5                     C_COPY:
0007CC D3C5 CD8AD3          17      CALL    SETFCB
                                
0007CF D3C8 1161EF          10      LD  DE,ZERO
0007D2 D3CB CD3FDE          17      CALL    FILEC2
0007D5 D3CE 216C00          10      LD  HL,FCB2
0007D8 D3D1 CD96D8          17      CALL    S29X1
                                
0007DB D3D4 3E10             7      LD  A,010H
0007DD D3D6 326900          13      LD  (FCB1+13),A
0007E0 D3D9 216D00          10      LD  HL,FCB2+1
0007E3 D3DC CDD5D4          17      CALL    CWILD1
       D3DF                     COPY0:
0007E6 D3DF CDD2D4          17      CALL    CWILD
0007E9 D3E2 215C00          10      LD  HL,FCB1
0007EC D3E5 CDB0D0          17      CALL    OPEN
0007EF D3E8 37               4      SCF
       D3E9                     COPY1:
0007F0 D3E9 C0              11      RET NZ
0007F1 D3EA CDC3D0          17      CALL    DEFCB
                                
0007F4 D3ED 3AEDD4          13      LD  A,(DTA_CCP+13)
0007F7 D3F0 CB67             8      BIT 4,A
0007F9 D3F2 2821            12      JR  Z,COPY1A
                                
0007FB D3F4 215D00          10      LD  HL,FCB1+1
0007FE D3F7 CD82E2          17      CALL    CHKWILD
000801 D3FA 3814            12      JR  C,COPY9
                                
000803 D3FC 3E20             7      LD  A,020H
000805 D3FE 325D00          13      LD  (FCB1+1),A
000808 D401 2AFAD4          16      LD  HL,(DTA_CCP+26)
00080B D404 23               6      INC HL
00080C D405 226A00          16      LD  (FCB1+14),HL
00080F D408 18D5            12      JR  COPY0
                                
       D40A                     COPY8:
000811 D40A CD25D6          17      CALL    _SYS09      ;(BDOS)文字列出力
000814 D40D CD81D2          17      CALL    LTNL
       D410                     COPY9:
000817 D410 CDBFD0          17      CALL    OPEN2
00081A D413 18D4            12      JR  COPY1
                                
       D415                     COPY1A:
00081C D415 216C00          10      LD  HL,FCB2
00081F D418 1114EF          10      LD  DE,FDRV
000822 D41B 01E2D4          10      LD  BC,DTA_CCP+2
000825 D41E EDA0            16      LDI
000827 D420 3E0B             7      LD  A,11
       D422                     COPY2:
000829 D422 F5              11      PUSH    AF
00082A D423 7E               7      LD  A,(HL)
00082B D424 FE3F             7      CP  '?'
00082D D426 2001            12      JR  NZ,COPY3
00082F D428 0A               7      LD  A,(BC)
       D429                     COPY3:
000830 D429 12               7      LD  (DE),A
000831 D42A 03               6      INC BC
000832 D42B 13               6      INC DE
000833 D42C 23               6      INC HL
000834 D42D F1              10      POP AF
000835 D42E 3D               4      DEC A
000836 D42F 20F1            12      JR  NZ,COPY2
000838 D431 010500          10      LD  BC,16-11
00083B D434 EDB0                    LDIR
       D436                     PUTNAME:
00083D D436 215D00          10      LD  HL,FCB1+1
000840 D439 CD82E2          17      CALL    CHKWILD
000843 D43C 300B            12      JR  NC,PUTN1
000845 D43E 2115EF          10      LD  HL,FDRV+1
000848 D441 CDF9D2          17      CALL    FPRNT
00084B D444 3E20             7      LD  A,020H
00084D D446 CD1BD9          17      CALL    MSG_A
       D449                     PUTN1:
000850 D449 1114EF          10      LD  DE,FDRV
000853 D44C 0E16             7      LD  C,016H      ;(BDOS)ファイルの作成
000855 D44E CDDED0          17      CALL    SYSTEM0
000858 D451 2048            12      JR  NZ,COPYE2
00085A D453 67               4      LD  H,A     ;A=0
00085B D454 6F               4      LD  L,A
00085C D455 2235EF          16      LD  (FDRV+33),HL    ;(FCB)ランダムレコード
00085F D458 2237EF          16      LD  (FDRV+35),HL
       D45B                     COPY6:
000862 D45B CDE7D0          17      CALL    S27BUF
000865 D45E 47               4      LD  B,A
000866 D45F 3C               4      INC A
000867 D460 2831            12      JR  Z,COPYE
000869 D462 7C               4      LD  A,H
00086A D463 B5               4      OR  L
00086B D464 280C            12      JR  Z,COPY7
00086D D466 1114EF          10      LD  DE,FDRV
000870 D469 0E26             7      LD  C,026H      ;(BDOS)ランダムブロック書き込み
000872 D46B CDDED0          17      CALL    SYSTEM0
000875 D46E 2023            12      JR  NZ,COPYE
000877 D470 10E9            13      DJNZ    COPY6
       D472                     COPY7:
000879 D472 3AEDD4          13      LD  A,(DTA_CCP+13)  ;(FCB)属性
00087C D475 3221EF          13      LD  (FDRV+13),A
00087F D478 21F4D4          10      LD  HL,DTA_CCP+20   ;(FCB)タイムスタンプ
000882 D47B 1128EF          10      LD  DE,FDRV+20
000885 D47E 010400          10      LD  BC,4
000888 D481 EDB0                    LDIR
                                
00088A D483 1114EF          10      LD  DE,FDRV
00088D D486 0E10             7      LD  C,010H      ;(BDOS)ファイルのクローズ
00088F D488 CDDED0          17      CALL    SYSTEM0
000892 D48B 2006            12      JR  NZ,COPYE
                                
000894 D48D 1171EF          10      LD  DE,OK
000897 D490 C30AD4          10      JP  COPY8
                                
       D493                     COPYE:
00089A D493 1114EF          10      LD  DE,FDRV
00089D D496 0E13             7      LD  C,013H      ;(BDOS)ファイルの削除
00089F D498 CD0500          17      CALL    SYSTEM
       D49B                     COPYE2:
0008A2 D49B 37               4      SCF
0008A3 D49C C9              10      RET
                                
       D49D                     C_TYPE:
0008A4 D49D CD8AD3          17      CALL    SETFCB
0008A7 D4A0 215C00          10      LD  HL,FCB1
0008AA D4A3 CDB0D0          17      CALL    OPEN
0008AD D4A6 37               4      SCF
       D4A7                     TYPE1:
0008AE D4A7 C0              11      RET NZ
0008AF D4A8 CDC3D0          17      CALL    DEFCB
0008B2 D4AB 3E06             7      LD  A,6
0008B4 D4AD CD1BD9          17      CALL    MSG_A
       D4B0                     TYPE2:
0008B7 D4B0 CDE7D0          17      CALL    S27BUF
0008BA D4B3 C6FE             7      ADD A,0FEH
0008BC D4B5 D8              11      RET C
0008BD D4B6 7C               4      LD  A,H
0008BE D4B7 B5               4      OR  L
0008BF D4B8 2813            12      JR  Z,TYPEE
0008C1 D4BA 010001          10      LD  BC,00100H
       D4BD                     TYPE3:
0008C4 D4BD 0A               7      LD  A,(BC)
0008C5 D4BE 03               6      INC BC
0008C6 D4BF FE1A             7      CP  01AH
0008C8 D4C1 280A            12      JR  Z,TYPEE
0008CA D4C3 CD1BD9          17      CALL    MSG_A
0008CD D4C6 2B               6      DEC HL
0008CE D4C7 7C               4      LD  A,H
0008CF D4C8 B5               4      OR  L
0008D0 D4C9 20F2            12      JR  NZ,TYPE3
0008D2 D4CB 18E3            12      JR  TYPE2
       D4CD                     TYPEE:
0008D4 D4CD CDBFD0          17      CALL    OPEN2
0008D7 D4D0 18D5            12      JR  TYPE1
                                
       D4D2                     CWILD:
0008D9 D4D2 215D00          10      LD  HL,FCB1+1
       D4D5                     CWILD1:
0008DC D4D5 7E               7      LD  A,(HL)
0008DD D4D6 FE20             7      CP  020H
0008DF D4D8 C0              11      RET NZ
       D4D9                     CWILD2:
0008E0 D4D9 3E3F             7      LD  A,'?'
0008E2 D4DB 060B             7      LD  B,11
0008E4 D4DD C3F3DE          10      JP  FILL_MEMORY
                                
       D4E0                     DTA_CCP:
0008E7 D4E0                         DS  37
                                
       0040                     PATHX   EQU 64
00090C D505                     PATHD:  DS  PATHX
00094C D545 00                  PATHE:  DB  0
                                
00094D D546 2062797465732066    FREE:   DB  " bytes free",9,'$'
            7265650924          
00095A D553 20202020203C4449    DIRMES: DB  "     <DIR>$"
            523E24              
000965 D55E 20203A24            DIRHD:  DB  "  :$"
                                
       D562                     COMTB:
000969 D562 44202020                DB  "D   "  ;1
00096D D566 E1D1                    DW  C_DIR
00096F D568 44495220                DB  "DIR "  ;2
000973 D56C E1D1                    DW  C_DIR
000975 D56E 434F5059                DB  "COPY"  ;3
000979 D572 C5D3                    DW  C_COPY
00097B D574 43442020                DB  "CD  "  ;4
00097F D578 E3D0                    DW  C_CD
000981 D57A 44454C20                DB  "DEL "  ;5
000985 D57E C4D1                    DW  C_DEL
000987 D580 50415448                DB  "PATH"  ;6
00098B D584 86D2                    DW  C_PATH
00098D D586 52454E20                DB  "REN "  ;7
000991 D58A CED1                    DW  C_REN
000993 D58C 54595045                DB  "TYPE"  ;8
000997 D590 9DD4                    DW  C_TYPE
000999 D592 52454D20                DB  "REM "  ;9
00099D D596 22D6                    DW  C_REM
[EOF:LDCCP.ASM:SHIFT_JIS]
                                    INCLUDE "88DISK2.ASM"
                                
                                ;   LSX-Dodgers DISK2
                                ;   PC-8801mkIISR
                                
                                ;   BANK RAM DISK DRIVER
                                
       D598                     BDWT:
00099F D598 3E10             7      LD  A,010H  ;ライト可　リード不可
0009A1 D59A 1802            12  JR  BRW
                                
       D59C                     BDRD:
0009A3 D59C 3E01             7      LD  A,001H  ;ライト不可　リード可
       D59E                     BRW:
0009A5 D59E F3               4      DI
0009A6 D59F D3E2            11      OUT (0E2H),A    ;拡張RAM リード/ライト制御
0009A8 D5A1 ED73D7D5        20      LD  (BANKSP+1),SP
0009AC D5A5 3AD8D5          13      LD  A,(BANKSP+2)
0009AF D5A8 87               4      ADD A,A
0009B0 D5A9 3803            12      JR  C,BRW1
0009B2 D5AB 31C8ED          10      LD  SP,EXTSP
       D5AE                     BRW1:
0009B5 D5AE C5              11      PUSH    BC
0009B6 D5AF D5              11      PUSH    DE
0009B7 D5B0 EB               4      EX  DE,HL
0009B8 D5B1 29              11      ADD HL,HL
0009B9 D5B2 29              11      ADD HL,HL
0009BA D5B3 7C               4      LD  A,H
0009BB D5B4 E60F             7      AND 00FH        ;バンク
0009BD D5B6 D3E3            11      OUT (0E3H),A    ;拡張RAM バンク選択
0009BF D5B8 65               4      LD  H,L
0009C0 D5B9 CB3C             8      SRL H   ;/2
0009C2 D5BB 2E00             7      LD  L,0
0009C4 D5BD DBE2            11      IN  A,(0E2H)    ;拡張RAM リード/ライト制御
0009C6 D5BF 0F               4      RRCA
0009C7 D5C0 3001            12      JR  NC,BRW2
0009C9 D5C2 EB               4      EX  DE,HL
       D5C3                     BRW2:
0009CA D5C3 010002          10      LD  BC,512
0009CD D5C6 EDB0                    LDIR
                                
0009CF D5C8 DBE2            11      IN  A,(0E2H)    ;拡張RAM リード/ライト制御
0009D1 D5CA 0F               4      RRCA
0009D2 D5CB 3801            12      JR  C,BRW3
0009D4 D5CD EB               4      EX  DE,HL
       D5CE                     BRW3:
0009D5 D5CE D1              10      POP DE
0009D6 D5CF C1              10      POP BC
0009D7 D5D0 13               6      INC DE
0009D8 D5D1 10DB            13      DJNZ    BRW1
                                
0009DA D5D3 AF               4      XOR A
0009DB D5D4 D3E2            11      OUT (0E2H),A    ;メインメモリに切り替える
0009DD D5D6 310000          10  BANKSP: LD  SP,0
0009E0 D5D9 FB               4      EI
0009E1 D5DA C9              10      RET
                                
[EOF:88DISK2.ASM:SHIFT_JIS]
                                    INCLUDE "LDOS.ASM"
                                
                                ;   LSX-Dodgers OS
                                
       D5DB                     BDOS0:
0009E2 D5DB ED73EFD5        20      LD  (BDSP+1),SP
0009E6 D5DF F5              11      PUSH    AF
0009E7 D5E0 3AF0D5          13      LD  A,(BDSP+2)
0009EA D5E3 FEED             7      CP  EXTSP/256
0009EC D5E5 280B            12      JR  Z,BDOS1X
       D5E7                     BDOS2:
0009EE D5E7 F1              10      POP AF
0009EF D5E8 31C8ED          10      LD  SP,EXTSP
0009F2 D5EB CDF3D5          17      CALL    BDOS1
0009F5 D5EE 310000          10  BDSP:   LD  SP,0
0009F8 D5F1 C9              10      RET
       D5F2                     BDOS1X:
0009F9 D5F2 F1              10      POP AF
       D5F3                     BDOS1:
0009FA D5F3 E5              11      PUSH    HL
0009FB D5F4 79               4      LD  A,C
0009FC D5F5 FE3C             7      CP  03CH
0009FE D5F7 3802            12      JR  C,DOS1
000A00 D5F9 3E3C             7      LD  A,03CH
       D5FB                     DOS1:
000A02 D5FB 87               4      ADD A,A
000A03 D5FC 6F               4      LD  L,A
000A04 D5FD 26F0             7      LD  H,STABLE/256
000A06 D5FF 7E               7      LD  A,(HL)
000A07 D600 2C               4      INC L
000A08 D601 66               7      LD  H,(HL)
000A09 D602 6F               4      LD  L,A
000A0A D603 E3              19      EX  (SP),HL
000A0B D604 79               4      LD  A,C
000A0C D605 C9              10      RET
       D606                     _DOS2:
000A0D D606 FE5A             7      CP  05AH        ;(BDOS)カレントディレクトリの変更(_CHDIR)
000A0F D608 CAD3D8          10      JP  Z,_SYS5A
000A12 D60B FE5C             7      CP  05CH        ;(BDOS)ファイル名の解析(_PFILE)
000A14 D60D CA8FD8          10      JP  Z,_SYS5C
000A17 D610 FE5F             7      CP  05FH        ;(BDOS)ディスクバッファのフラッシュ(_FLUSH)
000A19 D612 CA5FEB          10      JP  Z,_SYS5F
000A1C D615 FE6F             7      CP  06FH        ;(BDOS)MSX-DOS のバージョン番号の獲得(_DOSVER)
000A1E D617 200A            12      JR  NZ,_ERROR
000A20 D619 011D01          10      LD  BC,011DH
000A23 D61C 114701          10      LD  DE,VER
000A26 D61F 210201          10      LD  HL,MACD
       D622                     C_REM:
000A29 D622 AF               4      XOR A
       D623                     _ERROR:
000A2A D623 A7               4      AND A
000A2B D624 C9              10      RET
                                
       D625                     _SYS09:     ;文字列出力
000A2C D625 D5              11      PUSH    DE
       D626                     _SX09:
000A2D D626 1A               7      LD  A,(DE)
000A2E D627 13               6      INC DE
000A2F D628 FE24             7      CP  '$'
000A31 D62A 2831            12      JR  Z,SX0E2
000A33 D62C CD1BD9          17      CALL    MSG_A
000A36 D62F 18F5            12      JR  _SX09
                                
       D631                     MSX1:
000A38 D631 CD1BD9          17      CALL    MSG_A
       D634                     MSX:
000A3B D634 7E               7      LD  A,(HL)
000A3C D635 23               6      INC HL
000A3D D636 B7               4      OR  A
000A3E D637 20F8            12      JR  NZ,MSX1
000A40 D639 C9              10      RET
                                
       D63A                     _SYS0C:     ;(BDOS)バージョン番号の獲得
000A41 D63A 212200          10      LD  HL,00022H
000A44 D63D 7D               4      LD  A,L
000A45 D63E C9              10      RET
                                
       D63F                     _SYS0D:     ;(BDOS)ディスクリセット
000A46 D63F CDDFEF          17      CALL    _FFLUSH
000A49 D642 E5              11      PUSH    HL
000A4A D643 218000          10      LD  HL,00080H
000A4D D646 228AEF          16      LD  (_DTA),HL
000A50 D649 E1              10      POP HL
000A51 D64A D5              11      PUSH    DE
000A52 D64B 1E00             7      LD  E,0
000A54 D64D 3E                      DB  03EH
                                
       D64E                     _SYS0E:     ;(BDOS)カレントドライブの設定
000A55 D64E D5              11      PUSH    DE
000A56 D64F 7B               4      LD  A,E
000A57 D650 DDE5            15      PUSH    IX
000A59 D652 CDDCEF          17      CALL    _GETDPB
000A5C D655 DDE1            14      POP IX
000A5E D657 3804            12      JR  C,SX0E2
000A60 D659 7B               4      LD  A,E
000A61 D65A 3287EF          13      LD  (_DVSW),A
       D65D                     SX0E2:
000A64 D65D 3E08             7      LD  A,8
000A66 D65F D1              10      POP DE
000A67 D660 C9              10      RET
                                
       D661                     _SYS0F:     ;(BDOS)ファイルのオープン
000A68 D661 CD30DF          17      CALL    SETDRV
000A6B D664 FD7E1C          19      LD  A,(IY+28)   ;(FCB)オープンモード
000A6E D667 C602             7      ADD A,002H      ;Write
000A70 D669 2848            12      JR  Z,FEND0F
000A72 D66B CD7EE2          17      CALL    CHKWILDX
                                
000A75 D66E D450DF          17      CALL    NC,SOPENX
       D671                     _S16XX:
000A78 D671 3840            12      JR  C,FEND0F
                                                ;Directory location
000A7A D673 3A9FEF          13      LD  A,(_FILEN)
000A7D D676 FD7719          19      LD  (IY+25),A   ;(FCB)ディレクトリロケーション
                                ;               _DIRF
000A80 D679 3AA0EF          13      LD  A,(_DIRF)
000A83 D67C FD771D          19      LD  (IY+29),A   ;(FCB)ディレクトリモード
                                ;               _FBPS
000A86 D67F FD731E          19      LD  (IY+30),E   ;(FCB)ディレクトリポジション
000A89 D682 FD721F          19      LD  (IY+31),D
                                ;               Open(Read)
000A8C D685 FD361CFF        19      LD  (IY+28),0FFH    ;(FCB)オープンモード
                                ;               FILENAME
000A90 D689 FDE5            15      PUSH    IY
000A92 D68B D1              10      POP DE
000A93 D68C 13               6      INC DE
000A94 D68D 010B00          10      LD  BC,11
000A97 D690 EDB0                    LDIR
                                ;               Attribute
000A99 D692 7E               7      LD  A,(HL)
000A9A D693 FD770D          19      LD  (IY+13),A   ;(FCB)属性(アトリビュート)
000A9D D696 110B00          10      LD  DE,11       ;Reserved
000AA0 D699 19              11      ADD HL,DE
                                                    ;(FCB)ファイルを最後に変更した時刻
000AA1 D69A 11EAF0          10      LD  DE,SDDATA       ;(FCB)ファイルを最後に変更した日付
000AA4 D69D 060A             7      LD  B,SDDATAE-SDDATA    ;(FCB)ファイルの先頭クラスタ
       D69F                     S16LOOP:                ;(FCB)ファイルのサイズ(バイト単位)
000AA6 D69F 1A               7      LD  A,(DE)
000AA7 D6A0 13               6      INC DE
000AA8 D6A1 32A8D6          13      LD  (S16PAT+2),A
000AAB D6A4 7E               7      LD  A,(HL)
000AAC D6A5 23               6      INC HL
000AAD D6A6 FD7700          19  S16PAT: LD  (IY+0),A
000AB0 D6A9 10F4            13      DJNZ    S16LOOP
                                
000AB2 D6AB AF               4      XOR A
000AB3 D6AC FD770C          19      LD  (IY+12),A   ;(FCB)カレントブロック
000AB6 D6AF FD2257D7        20      LD  (OFCB+1),IY
       D6B3                     FEND0F:
000ABA D6B3 1845            12      JR  FEND10
                                
       D6B5                     _SYS10:     ;(BDOS)ファイルのクローズ
000ABC D6B5 CD30DF          17      CALL    SETDRV
000ABF D6B8 FD7E1C          19      LD  A,(IY+28)   ;(FCB)オープンモード
000AC2 D6BB D6FE             7      SUB 0FEH
000AC4 D6BD 37               4      SCF
000AC5 D6BE 3F               4      CCF
000AC6 D6BF 2039            12      JR  NZ,FEND10
       D6C1                     _S10A:              ;Write
000AC8 D6C1 FD770E          19      LD  (IY+14),A   ;(FCB)レコードサイズ/アクセスするディレクトリのクラスタ番号+1
000ACB D6C4 FD770F          19      LD  (IY+15),A
                                
000ACE D6C7 FD341C          23      INC (IY+28)     ;0FEH->0FFH ;オープンモード
000AD1 D6CA CD76E3          17      CALL    SETTMS
                                
000AD4 D6CD FD7E1D          19      LD  A,(IY+29)   ;(FCB)ディレクトリモード
000AD7 D6D0 32A0EF          13      LD  (_DIRF),A
000ADA D6D3 E67F             7      AND 07FH
000ADC D6D5 3295E8          13      LD  (_SECPS+1),A
000ADF D6D8 FD5E1E          19      LD  E,(IY+30)   ;(FCB)ディレクトリポジション
000AE2 D6DB FD561F          19      LD  D,(IY+31)
000AE5 D6DE CD84E0          17      CALL    READ_DIR
000AE8 D6E1 3817            12      JR  C,FEND10
                                
000AEA D6E3 3AAEDF          13  SDECM1: LD  A,(SDECPAT+1)   ;1セクタ辺りのディレクトリエントリ数
000AED D6E6 3D               4      DEC A       ;1024=01FH / 512=00FH / 256=7
000AEE D6E7 FDA619          19      AND (IY+25)     ;(FCB)ディレクトリロケーション
000AF1 D6EA 6F               4      LD  L,A
000AF2 D6EB 2600             7      LD  H,0
000AF4 D6ED 29              11      ADD HL,HL       ;*2
000AF5 D6EE 29              11      ADD HL,HL       ;*4
000AF6 D6EF 29              11      ADD HL,HL       ;*8
000AF7 D6F0 29              11      ADD HL,HL       ;*16
000AF8 D6F1 29              11      ADD HL,HL       ;*32
000AF9 D6F2 ED4B7EF0        20      LD  BC,(_DTBUF)
000AFD D6F6 09              11      ADD HL,BC
                                
000AFE D6F7 CD8EE2          17      CALL    SDIRENT
       D6FA                     FEND10:
000B01 D6FA 1842            12      JR  FEND
                                
       D6FC                     _SYS11:     ;(BDOS)最初のファイルの検索
000B03 D6FC CD30DF          17      CALL    SETDRV
000B06 D6FF CD7DDF          17      CALL    SOPEN
       D702                     _S12X1:
000B09 D702 383A            12      JR  C,FEND
000B0B D704 CD1DE0          17      CALL    SOPENE2
000B0E D707 ED5B8AEF        20      LD  DE,(_DTA)
000B12 D70B 3A88EF          13      LD  A,(_DRV)
000B15 D70E 3C               4      INC A
000B16 D70F 12               7      LD  (DE),A
000B17 D710 D5              11      PUSH    DE
000B18 D711 13               6      INC DE
000B19 D712 012000          10      LD  BC,32
000B1C D715 EDB0                    LDIR
000B1E D717 FD6E0E          19      LD  L,(IY+14)   ;(FCB)レコードサイズ/アクセスするディレクトリのクラスタ番号+1
000B21 D71A FD660F          19      LD  H,(IY+15)
000B24 D71D 22F4F0          16      LD  (SCDIR),HL
000B27 D720 2A9AEF          16      LD  HL,(_FBPS)
000B2A D723 22F6F0          16      LD  (SFBPS),HL
000B2D D726 2A9FEF          16      LD  HL,(_FILEN)
000B30 D729 7C               4      LD  A,H
000B31 D72A B7               4      OR  A
000B32 D72B 2806            12      JR  Z,_S12DIR
000B34 D72D 3A95E8          13      LD  A,(_SECPS+1)
000B37 D730 F680             7      OR  080H
000B39 D732 67               4      LD  H,A
       D733                     _S12DIR:
000B3A D733 22F8F0          16      LD  (SFNDF),HL  ;Directory position and Flags
000B3D D736 E1              10      POP HL
000B3E D737 1139EF          10      LD  DE,SFILE
000B41 D73A 0E21             7      LD  C,33
       D73C                     _S11B:
000B43 D73C EDB0                    LDIR
       D73E                     FEND:
000B45 D73E 9F               4      SBC A,A     ;CF=0 A=0 : CF=1 A=0FFH
       D73F                     FENDE:
000B46 D73F FDE1            14      POP IY
000B48 D741 C1              10      POP BC
000B49 D742 D1              10      POP DE
000B4A D743 E1              10      POP HL
000B4B D744 C9              10      RET
                                
       D745                     _SYS12:     ;(BDOS)次のファイルの検索
000B4C D745 E5              11      PUSH    HL
000B4D D746 D5              11      PUSH    DE
000B4E D747 C5              11      PUSH    BC
000B4F D748 FDE5            15      PUSH    IY
000B51 D74A CDE1DF          17      CALL    NOPEN
000B54 D74D 18B3            12      JR  _S12X1
                                
       D74F                     _S16K:
000B56 D74F FD7E1C          19      LD  A,(IY+28)   ;(FCB)オープンモード
000B59 D752 FEFD             7      CP  0FDH        ;Device(0FDH)
000B5B D754 37               4      SCF
000B5C D755 C8              11      RET Z
                                
000B5D D756 110000          10  OFCB:   LD  DE,0
000B60 D759 D5              11      PUSH    DE
000B61 D75A 061A             7      LD  B,26        ;First cluster
       D75C                     S16K1:
000B63 D75C 13               6      INC DE
000B64 D75D 23               6      INC HL
000B65 D75E 10FC            13      DJNZ    S16K1
                                
000B67 D760 1A               7      LD  A,(DE)
000B68 D761 BE               7      CP  (HL)
000B69 D762 2013            12      JR  NZ,S16K2
000B6B D764 13               6      INC DE
000B6C D765 23               6      INC HL
000B6D D766 1A               7      LD  A,(DE)
000B6E D767 BE               7      CP  (HL)
000B6F D768 200D            12      JR  NZ,S16K2
                                
000B71 D76A E1              10      POP HL
000B72 D76B FDE5            15      PUSH    IY
000B74 D76D D1              10      POP DE
000B75 D76E 1A               7      LD  A,(DE)      ;Drive
000B76 D76F BE               7      CP  (HL)
000B77 D770 2006            12      JR  NZ,S16K3
                                                ;ここはCFが必ず0
000B79 D772 ED52            15      SBC HL,DE       ;CP HL,DE
000B7B D774 37               4      SCF
000B7C D775 C0              11      RET NZ
000B7D D776 E5              11      PUSH    HL
       D777                     S16K2:
000B7E D777 E1              10      POP HL
       D778                     S16K3:
000B7F D778 FDE5            15      PUSH    IY
000B81 D77A D1              10      POP DE
       D77B                     _SYS13:     ;(BDOS)ファイルの削除
000B82 D77B CD30DF          17      CALL    SETDRV
000B85 D77E CDAEE1          17      CALL    KILL
       D781                     FEND13:
000B88 D781 18BB            12      JR  FEND
                                
       D783                     _SYS14:     ;(BDOS)シーケンシャルな読み出し
000B8A D783 CD30DF          17      CALL    SETDRV
000B8D D786 CDA8E3          17      CALL    PUSHRR
000B90 D789 CDEBE3          17      CALL    GETSEQ
                                
000B93 D78C CD00E4          17      CALL    RB_READ
000B96 D78F E5              11      PUSH    HL
000B97 D790 CDBCE3          17      CALL    SETSEQ
       D793                     SREAD:
000B9A D793 E1              10      POP HL
                                
000B9B D794 C601             7      ADD A,001H
000B9D D796 38A6            12      JR  C,FEND
                                
000B9F D798 7D               4      LD  A,L
000BA0 D799 D601             7      SUB 001H
       D79B                     FENDX:
000BA2 D79B 9F               4      SBC A,A
000BA3 D79C E603             7      AND 3
000BA5 D79E 1F               4      RRA
000BA6 D79F 189E            12      JR  FENDE
                                
       D7A1                     _SYS15:     ;(BDOS)シーケンシャルな書き込み
000BA8 D7A1 CD30DF          17      CALL    SETDRV
000BAB D7A4 CDA8E3          17      CALL    PUSHRR
000BAE D7A7 CDEBE3          17      CALL    GETSEQ
                                
000BB1 D7AA CDF9E3          17      CALL    RB_WRITE
000BB4 D7AD E5              11      PUSH    HL
000BB5 D7AE CDBCE3          17      CALL    SETSEQ
       D7B1                     SWRITE:
000BB8 D7B1 E1              10      POP HL
                                
000BB9 D7B2 C6FF             7      ADD A,0FFH
000BBB D7B4 18E5            12      JR  FENDX
                                
       D7B6                     _SYS17:     ;(BDOS)ファイル名の変更
000BBD D7B6 CD30DF          17      CALL    SETDRV
000BC0 D7B9 CD04E2          17      CALL    NAME
000BC3 D7BC 18C3            12      JR  FEND13
                                
       D7BE                     _SYS16:     ;(BDOS)ファイルの作成
000BC5 D7BE CD30DF          17      CALL    SETDRV
                                
000BC8 D7C1 CD7EE2          17      CALL    CHKWILDX
000BCB D7C4 38BB            12      JR  C,FEND13
000BCD D7C6 FD7E01          19      LD  A,(IY+1)    ;(FCB)主ファイル名
000BD0 D7C9 FE05             7      CP  5
000BD2 D7CB 2805            12      JR  Z,_S16X2
000BD4 D7CD FE21             7      CP  021H
000BD6 D7CF DA81D7          10      JP  C,FEND13
       D7D2                     _S16X2:
                                ;               Clear FCB
000BD9 D7D2 FDE5            15      PUSH    IY
000BDB D7D4 E1              10      POP HL
000BDC D7D5 011000          10      LD  BC,16
000BDF D7D8 09              11      ADD HL,BC
       D7D9                     _S16X1:
000BE0 D7D9 70               7      LD  (HL),B      ;B=0
000BE1 D7DA 23               6      INC HL
000BE2 D7DB 0D               4      DEC C
000BE3 D7DC 20FB            12      JR  NZ,_S16X1
                                
000BE5 D7DE CD7BE3          17      CALL    SETTMSX
000BE8 D7E1 FD360DFF        19      LD  (IY+13),0FFH    ;(FCB)Attribute
000BEC D7E5 CD50DF          17      CALL    SOPENX
000BEF D7E8 3F               4      CCF
000BF0 D7E9 CC4FD7          17      CALL    Z,_S16K
000BF3 D7EC D42EE0          17      CALL    NC,COPEN
000BF6 D7EF D48EE2          17      CALL    NC,SDIRENT
000BF9 D7F2 C371D6          10      JP  _S16XX
                                
       D7F5                     _SYS21:     ;(BDOS)ランダムな読み出し
                                
000BFC D7F5 CD30DF          17      CALL    SETDRV
000BFF D7F8 CDA8E3          17      CALL    PUSHRR
000C02 D7FB CD81E6          17      CALL    GET_RR_AHL
                                
000C05 D7FE CD00E4          17      CALL    RB_READ
000C08 D801 E5              11      PUSH    HL
000C09 D802 CDD7E3          17      CALL    POPRR
000C0C D805 188C            12      JR  SREAD
                                
       D807                     _SYS22:     ;(BDOS)ランダムな書き込み
       D807                     _SYS28:     ;(BDOS)ランダムな書き込み・その2
000C0E D807 CD30DF          17      CALL    SETDRV
000C11 D80A CDA8E3          17      CALL    PUSHRR
000C14 D80D CD81E6          17      CALL    GET_RR_AHL
                                
000C17 D810 CDF9E3          17      CALL    RB_WRITE
000C1A D813 E5              11      PUSH    HL
000C1B D814 CDD7E3          17      CALL    POPRR
000C1E D817 1898            12      JR  SWRITE
                                
       D819                     _SYS18:     ;(BDOS)ログインベクトルの獲得
000C20 D819 21FF00          10      LD  HL,000FFH
000C23 D81C AF               4      XOR A
000C24 D81D C9              10      RET
                                
       D81E                     _SYS19:     ;(BDOS)カレントドライブ番号の獲得
000C25 D81E 3A87EF          13      LD  A,(_DVSW)
000C28 D821 A7               4      AND A
000C29 D822 C9              10      RET
                                
       D823                     _SYS1A:     ;(BDOS)DTAの設定
000C2A D823 ED538AEF        20      LD  (_DTA),DE
000C2E D827 AF               4      XOR A
000C2F D828 C9              10      RET
                                
       D829                     _SYS1B:     ;(BDOS)ディスク情報の獲得
000C30 D829 7B               4      LD  A,E
000C31 D82A CD43DF          17      CALL    GETDRV
000C34 D82D CDDCEF          17      CALL    _GETDPB
000C37 D830 D4E2EF          17      CALL    NC,_RDFATX
000C3A D833 210000          10      LD  HL,0
000C3D D836 D454E3          17      CALL    NC,DSKF
                                
000C40 D839 ED5B55E3        20      LD  DE,(MAXCLP+1)   ;DPB_08_MAXCL-1
000C44 D83D 1B               6      DEC DE      ;DE←クラスタの総数
000C45 D83E FD2A7CF0        20      LD  IY,(_FATBF) ;IY←メモリ上のFATの先頭アドレス
000C49 D842 9F               4      SBC A,A
000C4A D843 D8              11      RET C
000C4B D844 4F               4      LD  C,A     ;C=0
000C4C D845 DD7E0F          19      LD  A,(IX+00FH) ;DPB_0F_BPS
000C4F D848 E60F             7      AND 00FH
000C51 D84A 47               4      LD  B,A
000C52 D84B DD7E07          19      LD  A,(IX+7)    ;DPB_07_SECPCL
000C55 D84E C9              10      RET
                                
       D84F                     _SYS1D:     ;(BDOS)書き込みが禁止されているディスクの調査
000C56 D84F AF               4      XOR A
000C57 D850 67               4      LD  H,A
000C58 D851 6F               4      LD  L,A
000C59 D852 C9              10      RET
                                
       D853                     _SYS1F:     ;(BDOS)ディスク装置のパラメータの読み出し
000C5A D853 2100F1          10      LD  HL,DEVICE
000C5D D856 7B               4      LD  A,E
000C5E D857 C3DCEF          10      JP  _GETDPB
                                
       D85A                     _SYS23:     ;(BDOS)ファイルサイズの獲得
000C61 D85A E5              11      PUSH    HL
000C62 D85B 2A1EF0          16      LD  HL,(STABLE+2*00FH)  ;ファイルのオープン
000C65 D85E CD0F00          17      CALL    JP_HL
000C68 D861 3821            12      JR  C,_S23X1
                                
000C6A D863 D5              11      PUSH    DE      ;EX DE,IY
000C6B D864 FDE3            23      EX  (SP),IY     ;
                                ;   POP DE      ;
                                ;   PUSH    DE      ;DEを破壊しないように注意vv
000C6D D866 FD7E10          19      LD  A,(IY+16)   ;(FCB)ファイルのサイズ(バイト単位)
000C70 D869 FD6E11          19      LD  L,(IY+17)   ;
000C73 D86C FD6612          19      LD  H,(IY+18)   ;
000C76 D86F C5              11      PUSH    BC      ;
000C77 D870 FD4613          19      LD  B,(IY+19)   ;
000C7A D873 CDDDE3          17      CALL    GET_CPM_R_SIZE
000C7D D876 C1              10      POP BC
       D877                     _S24X1:
000C7E D877 FD7521          19      LD  (IY+33),L   ;(FCB)Random record
000C81 D87A FD7422          19      LD  (IY+34),H
000C84 D87D FD7723          19      LD  (IY+35),A
                                ;   POP DE      ;^^^^^^^^^^^^^^^^^^^^^^^^
                                ;   PUSH    DE      ;EX DE,IY
000C87 D880 FDE3            23      EX  (SP),IY     ;
000C89 D882 D1              10      POP DE      ;
                                
000C8A D883 AF               4      XOR A
       D884                     _S23X1:
000C8B D884 E1              10      POP HL
000C8C D885 C9              10      RET
                                
       D886                     _SYS24:     ;(BDOS)ランダムレコードフィールドの設定
000C8D D886 E5              11      PUSH    HL
000C8E D887 D5              11      PUSH    DE      ;EX DE,IY
000C8F D888 FDE3            23      EX  (SP),IY     ;
                                ;   POP DE      ;
                                ;   PUSH    DE      ;DEを破壊しないように注意vv
000C91 D88A CDEBE3          17      CALL    GETSEQ
000C94 D88D 18E8            12      JR  _S24X1      ;^^^^^^^^^^^^^^^^^^^^^^^^
                                
       D88F                     _SYS5C:     ;(BDOS)ファイル名の解析
000C96 D88F C5              11      PUSH    BC
000C97 D890 E5              11      PUSH    HL
000C98 D891 CD47DE          17      CALL    FILE
000C9B D894 E1              10      POP HL
000C9C D895 C1              10      POP BC
       D896                     S29X1:
000C9D D896 C5              11      PUSH    BC
000C9E D897 D5              11      PUSH    DE
000C9F D898 E5              11      PUSH    HL
000CA0 D899 EB               4      EX  DE,HL
000CA1 D89A 2114EF          10      LD  HL,FDRV
000CA4 D89D 010D00          10      LD  BC,13
000CA7 D8A0 EDB0                    LDIR
000CA9 D8A2 70               7      LD  (HL),B      ;B=0
000CAA D8A3 0E03             7      LD  C,3
000CAC D8A5 EDB0                    LDIR
000CAE D8A7 E1              10      POP HL
000CAF D8A8 D1              10      POP DE
000CB0 D8A9 C1              10      POP BC
000CB1 D8AA AF               4      XOR A
000CB2 D8AB C9              10      RET
                                
       D8AC                     _SYS30:     ;(BDOS)論理セクタを用いた書き込み
000CB3 D8AC C5              11      PUSH    BC
000CB4 D8AD 0102EA          10      LD  BC,DWT24B
000CB7 D8B0 1804            12      JR  S2FX
       D8B2                     _SYS2F:
000CB9 D8B2 C5              11      PUSH    BC
000CBA D8B3 01F2E9          10      LD  BC,DRD24B
       D8B6                     S2FX:
000CBD D8B6 ED43CCD8        20      LD  (S2FPAT+1),BC
000CC1 D8BA CDDFEF          17      CALL    _FFLUSH
                                
000CC4 D8BD D5              11      PUSH    DE
000CC5 D8BE E5              11      PUSH    HL
000CC6 D8BF 7D               4      LD  A,L     ;Drive
000CC7 D8C0 CDD9EF          17      CALL    _CHGDRV
000CCA D8C3 3809            12      JR  C,S30X2
000CCC D8C5 44               4      LD  B,H     ;Number of clusters
000CCD D8C6 2A8AEF          16      LD  HL,(_DTA)
                                
000CD0 D8C9 0E00             7      LD  C,0
000CD2 D8CB CDF2E9          17  S2FPAT: CALL    DRD24B
       D8CE                     S30X2:
000CD5 D8CE E1              10      POP HL
000CD6 D8CF D1              10      POP DE
000CD7 D8D0 C1              10      POP BC
000CD8 D8D1 9F               4      SBC A,A
000CD9 D8D2 C9              10      RET
                                
       D8D3                     _SYS5A:     ;(BDOS)カレントディレクトリの変更
000CDA D8D3 C5              11      PUSH    BC
000CDB D8D4 D5              11      PUSH    DE
000CDC D8D5 E5              11      PUSH    HL
000CDD D8D6 CD3CDE          17      CALL    FILEC
000CE0 D8D9 210000          10      LD  HL,0
000CE3 D8DC 1114EF          10      LD  DE,FDRV
000CE6 D8DF 2A4EF0          16      LD  HL,(STABLE+2*027H)  ;ランダムブロック読み込み
000CE9 D8E2 CD0F00          17      CALL    JP_HL
000CEC D8E5 18E7            12      JR  S30X2
[EOF:LDOS.ASM:SHIFT_JIS]
                                    INCLUDE "88IO.ASM"
                                
                                ;   LSX-Dodgers IO
                                ;   PC-8801mkIISR
                                
       D623                     _SYS04  EQU _ERROR      ;(BDOS)外部出力
       D623                     _SYS05  EQU _ERROR      ;(BDOS)プリンタ出力
       D623                     _SYS1C  EQU _ERROR      ;(BDOS)ディスクの書き込み禁止化
       D623                     _SYS1E  EQU _ERROR      ;(BDOS)ファイル属性の設定
       D623                     _SYS20  EQU _ERROR      ;(BDOS)利用者番号の設定と読み出し
       D623                     _SYS2E  EQU _ERROR      ;(BDOS)ベリファイ・フラグの設定
                                
       0000                     INT EQU 0
       0000                     INTCTCE EQU 0
       0000                     INTCTC2 EQU 0
                                
       D8E7                     BDOS_RF:
000CEE D8E7 DB32            11      IN  A,(032H)
000CF0 D8E9 F610             7      OR  010H        ;高速RAMアクセスモードOFF
000CF2 D8EB D332            11      OUT (032H),A
000CF4 D8ED C3DBD5          10      JP  BDOS0
                                
       D8F0                     KEYSET:
       D8F0                     KEYBS:
000CF7 D8F0 B7               4      OR  A
000CF8 D8F1 C8              11      RET Z
       D8F2                     KEYBS1:
000CF9 D8F2 CD08D9          17      CALL    KEYBC_IFBREAK
000CFC D8F5 E5              11      PUSH    HL
000CFD D8F6 F5              11      PUSH    AF
000CFE D8F7 2A90EF          16      LD  HL,(_KEYPS)
000D01 D8FA 2C               4      INC L
000D02 D8FB 7D               4      LD  A,L
000D03 D8FC BC               4      CP  H
000D04 D8FD 2815            12      JR  Z,POP_AF_HL_SCF_RET
000D06 D8FF 3290EF          13      LD  (_KEYPS),A
000D09 D902 26FE             7      LD  H,KEYBF/256
000D0B D904 F1              10      POP AF
000D0C D905 77               7      LD  (HL),A
000D0D D906 E1              10      POP HL
000D0E D907 C9              10      RET
       D908                     KEYBC_IFBREAK:
000D0F D908 FE03             7      CP  3
000D11 D90A C0              11      RET NZ
       D90B                     KEYBC:
000D12 D90B E5              11      PUSH    HL
000D13 D90C 210000          10      LD  HL,0
000D16 D90F 2290EF          16      LD  (_KEYPS),HL
000D19 D912 E1              10      POP HL
000D1A D913 C9              10      RET
                                
       D914                     POP_AF_HL_SCF_RET:
000D1B D914 F1              10      POP AF
000D1C D915 E1              10      POP HL
000D1D D916 37               4      SCF
000D1E D917 C9              10      RET
                                
       D918                     _SYS01:     ;(BDOS)コンソール入力
000D1F D918 CD09EF          17      CALL    _SYS07
       D91B                     MSG_A:
000D22 D91B F5              11      PUSH    AF
000D23 D91C D5              11      PUSH    DE
000D24 D91D 5F               4      LD  E,A
000D25 D91E CD24D9          17      CALL    _SYS02
000D28 D921 D1              10      POP DE
000D29 D922 F1              10      POP AF
000D2A D923 C9              10      RET
                                
       D924                     _SYS02:     ;(BDOS)コンソール出力
000D2B D924 CD36D9          17      CALL    BREAK
000D2E D927 1805            12      JR  PRINTX
                                
       D929                     _SYS06:     ;(BDOS)コンソール直接入出力
000D30 D929 7B               4      LD  A,E
000D31 D92A 3C               4      INC A
000D32 D92B CACAEF          10      JP  Z,_INKEY
       D92E                     PRINTX:
000D35 D92E C3CDEF          10      JP  _PRINT
                                
       D931                     _SYS08:     ;(BDOS)エコーなしコンソール入力
000D38 D931 CD09EF          17      CALL    _SYS07
000D3B D934 1803            12      JR  BREAK1
       D936                     BREAK:
000D3D D936 CD4FDD          17      CALL    CHKEY
       D939                     BREAK1:
000D40 D939 FE03             7      CP  3       ;CTRL+C
000D42 D93B CA00EF          10      JP  Z,CPM_BOOT
000D45 D93E FE13             7      CP  013H        ;CTRL+S
000D47 D940 C0              11      RET NZ
                                
       D941                     PAUSE:
000D48 D941 CD0BD9          17      CALL    KEYBC
                                
       D944                     FLGET:
000D4B D944 CDDFEF          17      CALL    _FFLUSH
000D4E D947 E5              11      PUSH    HL
000D4F D948 2A8EEF          16      LD  HL,(_TXADR)
000D52 D94B CDEADB          17      CALL    CURSOR_ON
       D94E                     FLGET1:
000D55 D94E CDCAEF          17      CALL    _INKEY
000D58 D951 28FB            12      JR  Z,FLGET1
000D5A D953 CDD9DB          17      CALL    CURSOR_OFF
000D5D D956 E1              10      POP HL
000D5E D957 C9              10      RET
                                
       D958                     _SYS0A:     ;(BDOS)文字列入力
000D5F D958 C5              11      PUSH    BC
000D60 D959 E5              11      PUSH    HL
000D61 D95A D5              11      PUSH    DE
000D62 D95B CDA9DC          17      CALL    GETL
000D65 D95E 1100FF          10      LD  DE,KBUF
000D68 D961 E1              10      POP HL
000D69 D962 E5              11      PUSH    HL
000D6A D963 0E00             7      LD  C,0
000D6C D965 3004            12      JR  NC,SAX0
000D6E D967 23               6      INC HL
000D6F D968 23               6      INC HL
000D70 D969 1808            12      JR  SAX4
       D96B                     SAX0:
000D72 D96B 46               7      LD  B,(HL)
000D73 D96C 23               6      INC HL
       D96D                     SAX1:
000D74 D96D 23               6      INC HL
000D75 D96E 1A               7      LD  A,(DE)
000D76 D96F 13               6      INC DE
000D77 D970 B7               4      OR  A
000D78 D971 2004            12      JR  NZ,SAX2
       D973                     SAX4:
000D7A D973 360D            10      LD  (HL),00DH
000D7C D975 1804            12      JR  SAX3
       D977                     SAX2:
000D7E D977 77               7      LD  (HL),A
000D7F D978 0C               4      INC C
000D80 D979 10F2            13      DJNZ    SAX1
       D97B                     SAX3:
000D82 D97B D1              10      POP DE
000D83 D97C 79               4      LD  A,C
000D84 D97D 13               6      INC DE
000D85 D97E 12               7      LD  (DE),A
000D86 D97F 1B               6      DEC DE
000D87 D980 E1              10      POP HL
000D88 D981 C1              10      POP BC
000D89 D982 A7               4      AND A
000D8A D983 C9              10      RET
                                
       D984                     _SYS0B:     ;(BDOS)コンソール状態のチェック
000D8B D984 CD36D9          17      CALL    BREAK
000D8E D987 3A92EF          13      LD  A,(_KEYD)
000D91 D98A B7               4      OR  A
000D92 D98B C8              11      RET Z
       D98C                     CONSTX:
000D93 D98C CDDFEF          17      CALL    _FFLUSH
000D96 D98F E5              11      PUSH    HL
000D97 D990 2A90EF          16      LD  HL,(_KEYPS)
000D9A D993 7C               4      LD  A,H
000D9B D994 AD               4      XOR L
000D9C D995 E1              10      POP HL
000D9D D996 CC4FDD          17      CALL    Z,CHKEY
000DA0 D999 C6FF             7      ADD A,0FFH
000DA2 D99B 9F               4      SBC A,A
000DA3 D99C C9              10      RET
                                
       D99D                     _SYS2A:     ;(BDOS)日付の獲得
000DA4 D99D C5              11      PUSH    BC
000DA5 D99E CDDDD9          17      CALL    RTCREAD
000DA8 D9A1 3A62EF          13      LD  A,(RTC_YY)
000DAB D9A4 CD40DA          17      CALL    BCD
000DAE D9A7 6F               4      LD  L,A
000DAF D9A8 2600             7      LD  H,0
                                ;   LD  DE,1900     ;0076CH
                                ;   CP  90      ;90以上は1900年代 1990-1999
                                ;   JR  NC,RDDATE1  ;90未満は2000年代 2000-2089
                                ;   LD  E,0D0H      ;2000 & 0FFH D=007H
000DB1 D9AA 11D007          10      LD  DE,2000     ;すべて2000年代で処理 2000-2099
       D9AD                     RDDATE1:
000DB4 D9AD 19              11      ADD HL,DE
000DB5 D9AE 3A63EF          13      LD  A,(RTC_MW)
000DB8 D9B1 57               4      LD  D,A
000DB9 D9B2 3A64EF          13      LD  A,(RTC_DD)
000DBC D9B5 CD40DA          17      CALL    BCD
000DBF D9B8 5F               4      LD  E,A
000DC0 D9B9 7A               4      LD  A,D
000DC1 D9BA 0604             7      LD  B,4
       D9BC                     RDDATE2:
000DC3 D9BC CB3A             8      SRL D
000DC5 D9BE 10FC            13      DJNZ    RDDATE2
000DC7 D9C0 C1              10      POP BC
000DC8 D9C1 E607             7      AND 7
000DCA D9C3 C9              10      RET
                                
       D9C4                     _SYS2C:     ;(BDOS)時刻の獲得
000DCB D9C4 C5              11      PUSH    BC
000DCC D9C5 CDDDD9          17      CALL    RTCREAD
000DCF D9C8 3A65EF          13      LD  A,(RTC_TT)
000DD2 D9CB CD40DA          17      CALL    BCD
000DD5 D9CE 67               4      LD  H,A
000DD6 D9CF 3A66EF          13      LD  A,(RTC_MM)
000DD9 D9D2 CD40DA          17      CALL    BCD
000DDC D9D5 6F               4      LD  L,A
000DDD D9D6 3A67EF          13      LD  A,(RTC_SS)
000DE0 D9D9 57               4      LD  D,A
000DE1 D9DA C1              10      POP BC
000DE2 D9DB AF               4      XOR A
000DE3 D9DC C9              10      RET
                                
       D9DD                     RTCREAD:
000DE4 D9DD 0EF9             7      LD  C,0F9H
000DE6 D9DF 3AB9EF          13      LD  A,(WK40)
000DE9 D9E2 5F               4      LD  E,A
000DEA D9E3 3E03             7      LD  A,3     ;コマンド３：タイムリードにセット
000DEC D9E5 CD0FDA          17      CALL    RTCCMD
000DEF D9E8 3E01             7      LD  A,1     ;コマンド１：レジスタシフトにセット
000DF1 D9EA CD0FDA          17      CALL    RTCCMD
000DF4 D9ED 0606             7      LD  B,6
000DF6 D9EF 2167EF          10      LD  HL,RTC_SS
       D9F2                     RTCREAD1:
000DF9 D9F2 C5              11      PUSH    BC
000DFA D9F3 0608             7      LD  B,8
       D9F5                     RTCREAD2:
000DFC D9F5 DB40            11      IN  A,(40H)     ;システムモードセンス BIT4:CDI
000DFE D9F7 87               4      ADD A,A
000DFF D9F8 87               4      ADD A,A
000E00 D9F9 87               4      ADD A,A
000E01 D9FA 87               4      ADD A,A
000E02 D9FB CB1E            15      RR  (HL)
000E04 D9FD CD34DA          17      CALL    RTCCLK
000E07 DA00 10F3            13      DJNZ    RTCREAD2
000E09 DA02 C1              10      POP BC
000E0A DA03 2B               6      DEC HL
000E0B DA04 10EC            13      DJNZ    RTCREAD1
000E0D DA06 AF               4      XOR A
000E0E DA07 CD0FDA          17      CALL    RTCCMD
000E11 DA0A 7B               4      LD  A,E
000E12 DA0B 32B9EF          13      LD  (WK40),A
000E15 DA0E C9              10      RET
                                
       DA0F                     RTCCMD:
000E16 DA0F 0604             7      LD  B,4
000E18 DA11 07               4      RLCA
000E19 DA12 07               4      RLCA
000E1A DA13 07               4      RLCA
       DA14                     RTCCMD1:
000E1B DA14 F5              11      PUSH    AF
000E1C DA15 F607             7      OR  7
000E1E DA17 D310            11      OUT (10H),A     ;プリンタデータ出力 兼 カレンダクロック(μPD1990AC)出力
000E20 DA19 CD34DA          17      CALL    RTCCLK
000E23 DA1C F1              10      POP AF
000E24 DA1D 0F               4      RRCA
000E25 DA1E 10F4            13      DJNZ    RTCCMD1
000E27 DA20 3E07             7      LD  A,7
000E29 DA22 D310            11      OUT (10H),A     ;プリンタデータ出力 兼 カレンダクロック(μPD1990AC)出力
000E2B DA24 7B               4      LD  A,E
000E2C DA25 A1               4      AND C
000E2D DA26 F602             7      OR  2
000E2F DA28 D340            11      OUT (40H),A     ;ストローブポート
000E31 DA2A A1               4      AND C
000E32 DA2B 00               4      NOP
000E33 DA2C D340            11      OUT (40H),A     ;ストローブポート
000E35 DA2E 5F               4      LD  E,A
000E36 DA2F 060D             7      LD  B,13
       DA31                     RTCCMD3:
000E38 DA31 10FE            13      DJNZ    RTCCMD3
000E3A DA33 C9              10      RET
                                
       DA34                     RTCCLK:
000E3B DA34 7B               4      LD  A,E
000E3C DA35 A1               4      AND C
000E3D DA36 F604             7      OR  04H
000E3F DA38 D340            11      OUT (40H),A
000E41 DA3A A1               4      AND C
000E42 DA3B 00               4      NOP
000E43 DA3C D340            11      OUT (40H),A
000E45 DA3E 5F               4      LD  E,A
000E46 DA3F C9              10      RET
                                
                                ;------------------------
                                ;BCDの10進数化
                                ;in
                                ;   A  : BCD
                                ;out
                                ;   A  : 10進数
                                ;------------------------
       DA40                     BCD:
000E47 DA40 4F               4      LD  C,A
000E48 DA41 E6F0             7      AND 0F0H    ;10の位
000E4A DA43 0F               4      RRCA
000E4B DA44 47               4      LD  B,A
000E4C DA45 0F               4      RRCA
000E4D DA46 0F               4      RRCA
000E4E DA47 80               4      ADD A,B
000E4F DA48 47               4      LD  B,A
000E50 DA49 79               4      LD  A,C
000E51 DA4A E60F             7      AND 00FH    ;1の位
000E53 DA4C 80               4      ADD A,B
000E54 DA4D C9              10      RET
                                
       DA4E                     ESC1:
000E55 DA4E 7B               4      LD  A,E
000E56 DA4F FE41             7      CP  'A'
000E58 DA51 CA33DB          10      JP  Z,CTRL1E
000E5B DA54 FE42             7      CP  'B'
000E5D DA56 CA53DC          10      JP  Z,CTRL1F
000E60 DA59 FE43             7      CP  'C'
000E62 DA5B CAF9DA          10      JP  Z,CTRL1C
000E65 DA5E FE44             7      CP  'D'
000E67 DA60 CA1EDB          10      JP  Z,CTRL1D
000E6A DA63 FE45             7      CP  'E'
000E6C DA65 2802            12      JR  Z,CT0CX
000E6E DA67 FE6A             7      CP  'j'
       DA69                     CT0CX:
000E70 DA69 CA20DC          10      JP  Z,CTRL0C
000E73 DA6C FE48             7      CP  'H'
000E75 DA6E CA9EDB          10      JP  Z,CTRL0B
000E78 DA71 FE4A             7      CP  'J'
000E7A DA73 CA23DC          10      JP  Z,CTRL06
000E7D DA76 FE4B             7      CP  'K'
000E7F DA78 CA72DB          10      JP  Z,CTRL05
000E82 DA7B FE4C             7      CP  'L'
000E84 DA7D CA5ADC          10      JP  Z,CTRL0E
000E87 DA80 FE54             7      CP  'T'
000E89 DA82 CA72DB          10      JP  Z,CTRL05
000E8C DA85 FE78             7      CP  'x'
000E8E DA87 2804            12      JR  Z,ESC1X
000E90 DA89 FE79             7      CP  'y'
000E92 DA8B 2002            12      JR  NZ,ESC1Y
       DA8D                     ESC1X:
000E94 DA8D 3601            10      LD  (HL),1
       DA8F                     ESC1Y:
000E96 DA8F FE3D             7      CP  '='
000E98 DA91 2804            12      JR  Z,ESC1W
000E9A DA93 FE59             7      CP  'Y'
000E9C DA95 2002            12      JR  NZ,ESC1Z
       DA97                     ESC1W:
000E9E DA97 3602            10      LD  (HL),2
       DA99                     ESC1Z:
000EA0 DA99 FE20             7      CP  020H
000EA2 DA9B 3802            12      JR  C,ESC1C
000EA4 DA9D 87               4      ADD A,A
000EA5 DA9E D0              11      RET NC
       DA9F                     ESC1C:
000EA6 DA9F E1              10      POP HL
000EA7 DAA0 1832            12      JR  ANK
                                
       DAA2                     ESC:
000EA9 DAA2 21E5DA          10      LD  HL,PRINTE5
000EAC DAA5 E5              11      PUSH    HL
000EAD DAA6 21C8DA          10      LD  HL,ESCFLG
000EB0 DAA9 3600            10      LD  (HL),0
000EB2 DAAB 3D               4      DEC A
000EB3 DAAC 28A0            12      JR  Z,ESC1
000EB5 DAAE 3D               4      DEC A
000EB6 DAAF 2009            12      JR  NZ,ESC2
000EB8 DAB1 3603            10      LD  (HL),3
000EBA DAB3 7B               4      LD  A,E
000EBB DAB4 D620             7      SUB 020H
000EBD DAB6 32BDDA          13      LD  (ESCYP+1),A
000EC0 DAB9 C9              10      RET
       DABA                     ESC2:
000EC1 DABA 3D               4      DEC A
000EC2 DABB C0              11      RET NZ
000EC3 DABC 2600             7  ESCYP:  LD  H,0
000EC5 DABE 7B               4      LD  A,E
000EC6 DABF D620             7      SUB 020H
000EC8 DAC1 6F               4      LD  L,A
000EC9 DAC2 C3D6EF          10      JP  _LOC
                                
       DAC5                     PRINT:
000ECC DAC5 C5              11      PUSH    BC
000ECD DAC6 E5              11      PUSH    HL
       DAC8                     ESCFLG  EQU $+1
000ECE DAC7 3E00             7      LD  A,000H      ;自己書き換え
000ED0 DAC9 B7               4      OR  A
000ED1 DACA 20D6            12      JR  NZ,ESC
                                
000ED3 DACC 3E1F             7      LD  A,01FH
000ED5 DACE BB               4      CP  E
000ED6 DACF 3018            12      JR  NC,CTRL
       DAD1                     INSFLG  EQU $
000ED8 DAD1 0102DC          10      LD  BC,INSERT   ;自己書き換え
       DAD4                     ANK:
000EDB DAD4 CDABDB          17      CALL    LOC0
000EDE DAD7 DB32            11      IN  A,(032H)
000EE0 DAD9 F5              11      PUSH    AF
000EE1 DADA CBA7             8      RES 4,A     ;高速RAMアクセスモード
000EE3 DADC D332            11      OUT (032H),A
000EE5 DADE 73               7      LD  (HL),E
000EE6 DADF F1              10      POP AF
000EE7 DAE0 D332            11      OUT (032H),A
000EE9 DAE2 CDF9DA          17      CALL    CTRL1C
       DAE5                     PRINTE5:
000EEC DAE5 E1              10      POP HL
000EED DAE6 C1              10      POP BC
000EEE DAE7 AF               4      XOR A
000EEF DAE8 C9              10      RET
                                
       DAE9                     CTRL:
000EF0 DAE9 7B               4      LD  A,E
000EF1 DAEA 87               4      ADD A,A
000EF2 DAEB F680             7      OR  080H
000EF4 DAED 6F               4      LD  L,A
000EF5 DAEE 26F0             7      LD  H,CTRLTB/256
000EF7 DAF0 7E               7      LD  A,(HL)
000EF8 DAF1 2C               4      INC L
000EF9 DAF2 66               7      LD  H,(HL)
000EFA DAF3 6F               4      LD  L,A
000EFB DAF4 CD0F00          17      CALL    JP_HL
000EFE DAF7 18EC            12      JR  PRINTE5
                                
       DAF9                     CTRL1C:
000F00 DAF9 2A8EEF          16      LD  HL,(_TXADR)
000F03 DAFC 2C               4      INC L
       DAFD                     PRINTE3:
000F04 DAFD 3AB1EF          13      LD  A,(_WIDTH)
000F07 DB00 3D               4      DEC A
000F08 DB01 BD               4      CP  L
000F09 DB02 3009            12      JR  NC,SET_TXADR_HL
000F0B DB04 2E00             7      LD  L,0
000F0D DB06 24               4      INC H
       DB07                     PRINTE8:
000F0E DB07 3A97EF          13      LD  A,(_LINE)
000F11 DB0A BC               4      CP  H
000F12 DB0B 2804            12      JR  Z,PRINT2
       DB0D                     LOC:
       DB0D                     SET_TXADR_HL:
000F14 DB0D 228EEF          16      LD  (_TXADR),HL
       DB10                     CTRL00:
000F17 DB10 C9              10      RET
                                
       DB11                     PRINT2:
000F18 DB11 CD60DC          17      CALL    SCR
000F1B DB14 25               4      DEC H
000F1C DB15 18F6            12      JR  SET_TXADR_HL
                                
       DB17                     CTRL08:
000F1E DB17 3AD1DA          13      LD  A,(INSFLG)
000F21 DB1A FECD             7      CP  0CDH        ;CALL ????
000F23 DB1C 2829            12      JR  Z,CTRL02
       DB1E                     CTRL1D:
000F25 DB1E 2A8EEF          16      LD  HL,(_TXADR)
000F28 DB21 7C               4      LD  A,H
000F29 DB22 B5               4      OR  L
000F2A DB23 C8              11      RET Z
000F2B DB24 7D               4      LD  A,L
000F2C DB25 B7               4      OR  A
000F2D DB26 2803            12      JR  Z,CTRL1DX1
000F2F DB28 2D               4      DEC L
000F30 DB29 18E2            12      JR  SET_TXADR_HL
       DB2B                     CTRL1DX1:
000F32 DB2B 3AB1EF          13      LD  A,(_WIDTH)
000F35 DB2E 3D               4      DEC A
000F36 DB2F 6F               4      LD  L,A
000F37 DB30 25               4      DEC H
000F38 DB31 18DA            12      JR  SET_TXADR_HL
       DB33                     CTRL1E:
000F3A DB33 2A8EEF          16      LD  HL,(_TXADR)
000F3D DB36 7C               4      LD  A,H
000F3E DB37 B7               4      OR  A
000F3F DB38 C8              11      RET Z
000F40 DB39 25               4      DEC H
000F41 DB3A 18D1            12      JR  SET_TXADR_HL
                                
       DB3C                     CTRL09:
000F43 DB3C 2A8EEF          16      LD  HL,(_TXADR)
000F46 DB3F 7D               4      LD  A,L
000F47 DB40 E6F8             7      AND 0F8H
000F49 DB42 C608             7      ADD A,8
000F4B DB44 6F               4      LD  L,A
000F4C DB45 18B6            12      JR  PRINTE3
                                
       DB47                     CTRL02:
000F4E DB47 3A8EEF          13      LD  A,(_TXADR)
000F51 DB4A B7               4      OR  A
000F52 DB4B 28D1            12      JR  Z,CTRL1D
000F54 DB4D CD1EDB          17      CALL    CTRL1D
000F57 DB50 2A8EEF          16      LD  HL,(_TXADR)
000F5A DB53 3AB1EF          13      LD  A,(_WIDTH)
000F5D DB56 4F               4      LD  C,A
000F5E DB57 95               4      SUB L
000F5F DB58 47               4      LD  B,A
000F60 DB59 79               4      LD  A,C
000F61 DB5A 3D               4      DEC A
000F62 DB5B 6F               4      LD  L,A
000F63 DB5C CDAEDB          17      CALL    LOC1
                                
000F66 DB5F DB32            11      IN  A,(032H)
000F68 DB61 F5              11      PUSH    AF
000F69 DB62 CBA7             8      RES 4,A     ;高速RAMアクセスモード
000F6B DB64 D332            11      OUT (032H),A
                                
000F6D DB66 3E20             7      LD  A,020H
       DB68                     C8X1:
000F6F DB68 4E               7      LD  C,(HL)
000F70 DB69 77               7      LD  (HL),A
000F71 DB6A 2B               6      DEC HL
000F72 DB6B 79               4      LD  A,C
000F73 DB6C 10FA            13      DJNZ    C8X1
                                
000F75 DB6E F1              10      POP AF
000F76 DB6F D332            11      OUT (032H),A
000F78 DB71 C9              10      RET
                                
       DB72                     CTRL05:
000F79 DB72 CDD3EF          17      CALL    _POS
000F7C DB75 2A8EEF          16      LD  HL,(_TXADR)
000F7F DB78 3AB1EF          13      LD  A,(_WIDTH)
000F82 DB7B 95               4      SUB L
000F83 DB7C 47               4      LD  B,A
000F84 DB7D CDABDB          17      CALL    LOC0
       DB80                     CLLINE:
000F87 DB80 DB32            11      IN  A,(032H)
000F89 DB82 F5              11      PUSH    AF
000F8A DB83 CBA7             8      RES 4,A     ;高速RAMアクセスモード
000F8C DB85 D332            11      OUT (032H),A
000F8E DB87 3E20             7      LD  A,020H
       DB89                     CLLINE1:
000F90 DB89 77               7      LD  (HL),A
000F91 DB8A 23               6      INC HL
000F92 DB8B 10FC            13      DJNZ    CLLINE1
                                
000F94 DB8D F1              10      POP AF
000F95 DB8E D332            11      OUT (032H),A
000F97 DB90 C9              10      RET
                                
       DB91                     CTRL0D:
000F98 DB91 AF               4      XOR A
000F99 DB92 328EEF          13      LD  (_TXADR),A
000F9C DB95 C9              10      RET
                                
       DB96                     CTRL12:
000F9D DB96 21D1DA          10      LD  HL,INSFLG
000FA0 DB99 7E               7      LD  A,(HL)
000FA1 DB9A EECC             7      XOR 0CCH        ;CD:CALL ???? 1:LD BC,????
000FA3 DB9C 77               7      LD  (HL),A
000FA4 DB9D C9              10      RET
                                
       DB9E                     CTRL0B:
000FA5 DB9E 210000          10      LD  HL,0
000FA8 DBA1 228EEF          16      LD  (_TXADR),HL
000FAB DBA4 C9              10      RET
                                
       DBA5                     CTRL1B:
000FAC DBA5 3E01             7      LD  A,1
000FAE DBA7 32C8DA          13      LD  (ESCFLG),A
000FB1 DBAA C9              10      RET
       DBAB                     LOC0:
000FB2 DBAB 2A8EEF          16      LD  HL,(_TXADR)
       DBAE                     LOC1:
000FB5 DBAE C5              11      PUSH    BC
000FB6 DBAF D5              11      PUSH    DE
000FB7 DBB0 4D               4      LD  C,L
000FB8 DBB1 0608             7      LD  B,8
000FBA DBB3 5C               4      LD  E,H
000FBB DBB4 210078          10      LD  HL,120*256
000FBE DBB7 55               4      LD  D,L
       DBB8                     LOC2:
000FBF DBB8 29              11      ADD HL,HL
000FC0 DBB9 3001            12      JR  NC,LOC3
000FC2 DBBB 19              11      ADD HL,DE
       DBBC                     LOC3:
000FC3 DBBC 10FA            13      DJNZ    LOC2
000FC5 DBBE 09              11      ADD HL,BC
000FC6 DBBF ED5BB2EF        20      LD  DE,(TVRAMTOP)
000FCA DBC3 19              11      ADD HL,DE
000FCB DBC4 D1              10      POP DE
000FCC DBC5 C1              10      POP BC
000FCD DBC6 C9              10      RET
                                
       DBC7                     CONOUT1:
000FCE DBC7 CDEADB          17      CALL    CURSOR_ON
000FD1 DBCA 59               4      LD  E,C
000FD2 DBCB CDCDEF          17      CALL    _PRINT
000FD5 DBCE 7B               4      LD  A,E
000FD6 DBCF FE0A             7      CP  00AH
000FD8 DBD1 2006            12      JR  NZ,CURSOR_OFF
000FDA DBD3 CD91DB          17      CALL    CTRL0D
000FDD DBD6 CD72DB          17      CALL    CTRL05
       DBD9                     CURSOR_OFF:
000FE0 DBD9 F5              11      PUSH    AF
000FE1 DBDA 3E80             7      LD  A,080H
       DBDC                     CURSOR0:
000FE3 DBDC D351            11      OUT (051H),A
000FE5 DBDE 3A8EEF          13      LD  A,(_TXADR)
000FE8 DBE1 D350            11      OUT (050H),A
000FEA DBE3 3A8FEF          13      LD  A,(_TXADR+1)
000FED DBE6 D350            11      OUT (050H),A
000FEF DBE8 F1              10      POP AF
000FF0 DBE9 C9              10      RET
       DBEA                     CURSOR_ON:
000FF1 DBEA F5              11      PUSH    AF
000FF2 DBEB 3E81             7      LD  A,081H
000FF4 DBED 18ED            12      JR  CURSOR0
                                
       DBEF                     CTRL07:
000FF6 DBEF 3AB9EF          13      LD  A,(WK40)
000FF9 DBF2 F5              11      PUSH    AF
000FFA DBF3 F620             7      OR  20H
000FFC DBF5 D340            11      OUT (040H),A
000FFE DBF7 0610             7      LD  B,16
       DBF9                     C07X1:
001000 DBF9 CD9EDD          17      CALL    VBLANK
001003 DBFC 10FB            13      DJNZ    C07X1
001005 DBFE F1              10      POP AF
001006 DBFF D340            11      OUT (040H),A
001008 DC01 C9              10      RET
                                
       DC02                     INSERT:
001009 DC02 2A8EEF          16      LD  HL,(_TXADR)
00100C DC05 3AB1EF          13      LD  A,(_WIDTH)
00100F DC08 95               4      SUB L
001010 DC09 47               4      LD  B,A
                                
001011 DC0A CDABDB          17      CALL    LOC0
                                
001014 DC0D DB32            11      IN  A,(032H)
001016 DC0F F5              11      PUSH    AF
001017 DC10 CBA7             8      RES 4,A     ;高速RAMアクセスモード
001019 DC12 D332            11      OUT (032H),A
                                
00101B DC14 3E20             7      LD  A,020H
       DC16                     INS1:
00101D DC16 4E               7      LD  C,(HL)
00101E DC17 77               7      LD  (HL),A
00101F DC18 79               4      LD  A,C
001020 DC19 23               6      INC HL
001021 DC1A 10FA            13      DJNZ    INS1
                                
001023 DC1C F1              10      POP AF
001024 DC1D D332            11      OUT (032H),A
001026 DC1F C9              10      RET
                                
       DC20                     CTRL0C:
001027 DC20 CD9EDB          17      CALL    CTRL0B
       DC23                     CTRL06:
00102A DC23 2A8EEF          16      LD  HL,(_TXADR)
       DC26                     CLS1:
00102D DC26 DB32            11      IN  A,(032H)
00102F DC28 F5              11      PUSH    AF
001030 DC29 CBA7             8      RES 4,A     ;高速RAMアクセスモード
001032 DC2B D332            11      OUT (032H),A
       DC2D                     CLS2:
001034 DC2D E5              11      PUSH    HL
001035 DC2E 3AB1EF          13      LD  A,(_WIDTH)
001038 DC31 95               4      SUB L
001039 DC32 47               4      LD  B,A
00103A DC33 CDAEDB          17      CALL    LOC1
00103D DC36 3E20             7      LD  A,020H
       DC38                     CLS3:
00103F DC38 77               7      LD  (HL),A
001040 DC39 23               6      INC HL
001041 DC3A 10FC            13      DJNZ    CLS3
001043 DC3C E1              10      POP HL
001044 DC3D 2E00             7      LD  L,0
001046 DC3F 24               4      INC H
001047 DC40 3A97EF          13      LD  A,(_LINE)
00104A DC43 BC               4      CP  H
00104B DC44 20E7            12      JR  NZ,CLS2
00104D DC46 F1              10      POP AF
00104E DC47 D332            11      OUT (032H),A
001050 DC49 C9              10      RET
                                
       DC4A                     CTRL04:
001051 DC4A CDD3EF          17      CALL    _POS
001054 DC4D 7D               4      LD  A,L
001055 DC4E B7               4      OR  A
001056 DC4F C8              11      RET Z
       DC50                     CTRL03:
001057 DC50 CD91DB          17      CALL    CTRL0D
       DC53                     CTRL0A:
       DC53                     CTRL1F:
00105A DC53 2A8EEF          16      LD  HL,(_TXADR)
00105D DC56 24               4      INC H
00105E DC57 C307DB          10      JP  PRINTE8
                                
       DC5A                     CTRL0E:
001061 DC5A CDD3EF          17      CALL    _POS
001064 DC5D 7C               4      LD  A,H
001065 DC5E 1804            12      JR  SCR1
       DC60                     SCR:
001067 DC60 3A97EF          13      LD  A,(_LINE)
00106A DC63 3D               4      DEC A
       DC64                     SCR1:
00106B DC64 C5              11      PUSH    BC
00106C DC65 D5              11      PUSH    DE
00106D DC66 E5              11      PUSH    HL
00106E DC67 F5              11      PUSH    AF
00106F DC68 210000          10      LD  HL,0
001072 DC6B CDAEDB          17      CALL    LOC1
001075 DC6E EB               4      EX  DE,HL
001076 DC6F 210001          10      LD  HL,0100H
001079 DC72 CDAEDB          17      CALL    LOC1
00107C DC75 C1              10      POP BC
00107D DC76 DB32            11      IN  A,(032H)
00107F DC78 F5              11      PUSH    AF
001080 DC79 CBA7             8      RES 4,A     ;高速RAMアクセスモード
001082 DC7B D332            11      OUT (032H),A
001084 DC7D 78               4      LD  A,B
001085 DC7E B7               4      OR  A
       DC7F                     SCRUP1:
001086 DC7F 2815            12      JR  Z,SCRCL
001088 DC81 E5              11      PUSH    HL
001089 DC82 D5              11      PUSH    DE
00108A DC83 0608             7      LD  B,8
00108C DC85 5F               4      LD  E,A
00108D DC86 210078          10      LD  HL,120*256
001090 DC89 55               4      LD  D,L
       DC8A                     SCRH2:
001091 DC8A 29              11      ADD HL,HL
001092 DC8B 3001            12      JR  NC,SCRH3
001094 DC8D 19              11      ADD HL,DE
       DC8E                     SCRH3:
001095 DC8E 10FA            13      DJNZ    SCRH2
001097 DC90 4D               4      LD  C,L
001098 DC91 44               4      LD  B,H
001099 DC92 D1              10      POP DE
00109A DC93 E1              10      POP HL
00109B DC94 EDB0                    LDIR
                                
       DC96                     SCRCL:
00109D DC96 F1              10      POP AF
00109E DC97 D332            11      OUT (032H),A
                                
0010A0 DC99 3AB1EF          13      LD  A,(_WIDTH)
0010A3 DC9C 47               4      LD  B,A
0010A4 DC9D EB               4      EX  DE,HL
0010A5 DC9E CD80DB          17      CALL    CLLINE
0010A8 DCA1 E1              10      POP HL
0010A9 DCA2 D1              10      POP DE
0010AA DCA3 C1              10      POP BC
0010AB DCA4 C9              10      RET
       DCA5                     POS:
0010AC DCA5 2A8EEF          16      LD  HL,(_TXADR)
0010AF DCA8 C9              10      RET
                                
       DCA9                     GETL:
0010B0 DCA9 CDD3EF          17      CALL    _POS
0010B3 DCAC E5              11      PUSH    HL
0010B4 DCAD 3ECD             7      LD  A,0CDH      ;CALL ????
0010B6 DCAF 32D1DA          13      LD  (INSFLG),A
       DCB2                     GETL1:
0010B9 DCB2 CD31D9          17      CALL    _SYS08
0010BC DCB5 FE09             7      CP  9
0010BE DCB7 2008            12      JR  NZ,GETL1V
0010C0 DCB9 2100FF          10      LD  HL,KBUF
0010C3 DCBC CD34D6          17      CALL    MSX
0010C6 DCBF 18F1            12      JR  GETL1
       DCC1                     GETL1V:
0010C8 DCC1 5F               4      LD  E,A
0010C9 DCC2 CDCDEF          17      CALL    _PRINT
                                
0010CC DCC5 7B               4      LD  A,E
0010CD DCC6 FE0D             7      CP  00DH
0010CF DCC8 20E8            12      JR  NZ,GETL1
0010D1 DCCA 3E01             7      LD  A,1     ;LD BC,????
0010D3 DCCC 32D1DA          13      LD  (INSFLG),A
0010D6 DCCF 1100FF          10      LD  DE,KBUF
0010D9 DCD2 3AB1EF          13      LD  A,(_WIDTH)
0010DC DCD5 47               4      LD  B,A
0010DD DCD6 CDBFD3          17      CALL    ZERO_MEMORY_DE
                                
0010E0 DCD9 D1              10      POP DE
0010E1 DCDA CDD3EF          17      CALL    _POS
0010E4 DCDD 6B               4      LD  L,E
0010E5 DCDE 3AB1EF          13      LD  A,(_WIDTH)
0010E8 DCE1 95               4      SUB L
0010E9 DCE2 57               4      LD  D,A
0010EA DCE3 CDAEDB          17      CALL    LOC1
0010ED DCE6 4D               4      LD  C,L
0010EE DCE7 7C               4      LD  A,H
0010EF DCE8 F630             7      OR  030H
0010F1 DCEA 47               4      LD  B,A
0010F2 DCEB 5A               4      LD  E,D
0010F3 DCEC 2100FF          10      LD  HL,KBUF
       DCEF                     GETL2:
0010F6 DCEF CDD0EF          17      CALL    _SCRN
0010F9 DCF2 03               6      INC BC
0010FA DCF3 77               7      LD  (HL),A
0010FB DCF4 23               6      INC HL
0010FC DCF5 1D               4      DEC E
0010FD DCF6 20F7            12      JR  NZ,GETL2
       DCF8                     GETL3:
0010FF DCF8 2B               6      DEC HL
001100 DCF9 7E               7      LD  A,(HL)
001101 DCFA FE21             7      CP  021H
001103 DCFC D0              11      RET NC
001104 DCFD 3600            10      LD  (HL),0
001106 DCFF 15               4      DEC D
001107 DD00 20F6            12      JR  NZ,GETL3
001109 DD02 C9              10      RET
                                
       DD03                     INKEY:
00110A DD03 E5              11      PUSH    HL
00110B DD04 2A90EF          16      LD  HL,(_KEYPS)
00110E DD07 7C               4      LD  A,H
00110F DD08 AD               4      XOR L
001110 DD09 280F            12      JR  Z,GETKEY
001112 DD0B 7C               4      LD  A,H
001113 DD0C 3C               4      INC A
001114 DD0D 3291EF          13      LD  (_KEYPS+1),A
001117 DD10 6F               4      LD  L,A
001118 DD11 26FE             7      LD  H,KEYBF/256
00111A DD13 7E               7      LD  A,(HL)
00111B DD14 E1              10      POP HL
       DD15                     INKEYD:
00111C DD15 B7               4      OR  A
00111D DD16 3292EF          13      LD  (_KEYD),A
001120 DD19 C9              10      RET
       DD1A                     GETKEY:
001121 DD1A 3A92EF          13      LD  A,(_KEYD)
001124 DD1D B7               4      OR  A
001125 DD1E 6F               4      LD  L,A
001126 DD1F 2610             7  GKSMC:  LD  H,16
       DD21                     GETKEY1:
001128 DD21 CD4FDD          17      CALL    CHKEY       ;キーを離すまで待つ
00112B DD24 281E            12      JR  Z,GETKEY2
00112D DD26 BD               4      CP  L
00112E DD27 201B            12      JR  NZ,GETKEY2
001130 DD29 DB40            11      IN  A,(040H)
001132 DD2B CB6F             8      BIT 5,A
001134 DD2D 28F2            12      JR  Z,GETKEY1
       DD2F                     GETKEY1X:
001136 DD2F CD4FDD          17      CALL    CHKEY       ;キーを離すまで待つ
001139 DD32 2810            12      JR  Z,GETKEY2
00113B DD34 BD               4      CP  L
00113C DD35 200D            12      JR  NZ,GETKEY2
00113E DD37 DB40            11      IN  A,(040H)
001140 DD39 CB6F             8      BIT 5,A
001142 DD3B 20F2            12      JR  NZ,GETKEY1X
001144 DD3D 25               4      DEC H
001145 DD3E 20E1            12      JR  NZ,GETKEY1
001147 DD40 3E01             7      LD  A,1
001149 DD42 1802            12      JR  GETKEY3
       DD44                     GETKEY2:
00114B DD44 3E10             7      LD  A,16
       DD46                     GETKEY3:
00114D DD46 3220DD          13      LD  (GKSMC+1),A
001150 DD49 3A92EF          13      LD  A,(_KEYD)
001153 DD4C B7               4      OR  A
001154 DD4D E1              10      POP HL
001155 DD4E C0              11      RET NZ
       DD4F                     CHKEY:
001156 DD4F C5              11      PUSH    BC
001157 DD50 DB08            11      IN  A,(8)       ;6:SHIFT,7:CTRL
001159 DD52 4F               4      LD  C,A
00115A DD53 3A0E00          13      LD  A,(00EH)
00115D DD56 CB5F             8      BIT 3,A
00115F DD58 2002            12      JR  NZ,CHKEYRSHIFT
001161 DD5A CBB1             8      RES 6,C
       DD5C                     CHKEYRSHIFT:
001163 DD5C 79               4      LD  A,C
001164 DD5D 3293EF          13      LD  (_KEYD+1),A
001167 DD60 E5              11      PUSH    HL
001168 DD61 0E00             7      LD  C,0
00116A DD63 21C8ED          10      LD  HL,KEY_TABLE
00116D DD66 CB77             8      BIT 6,A
00116F DD68 2003            12      JR  NZ,INKEY0
001171 DD6A 2130EE          10      LD  HL,SHIFT_TABLE
       DD6D                     INKEY0:
001174 DD6D CB7F             8      BIT 7,A
001176 DD6F 2003            12      JR  NZ,INKEY1
001178 DD71 2198EE          10      LD  HL,CTRL_TABLE
       DD74                     INKEY1:
00117B DD74 ED78            12      IN  A,(C)
00117D DD76 0608             7      LD  B,8
       DD78                     INKEY2:
00117F DD78 0F               4      RRCA
001180 DD79 300B            12      JR  NC,INKEY4
       DD7B                     INKEY3:
001182 DD7B 23               6      INC HL
001183 DD7C 10FA            13      DJNZ    INKEY2
001185 DD7E 0C               4      INC C
001186 DD7F 79               4      LD  A,C
001187 DD80 D60D             7      SUB 00DH
001189 DD82 20F0            12      JR  NZ,INKEY1
00118B DD84 1804            12      JR  INKEY5
       DD86                     INKEY4:
00118D DD86 7E               7      LD  A,(HL)
00118E DD87 B7               4      OR  A
00118F DD88 28F1            12      JR  Z,INKEY3
       DD8A                     INKEY5:
001191 DD8A E1              10      POP HL
001192 DD8B C1              10      POP BC
001193 DD8C 1887            12      JR  INKEYD
                                
       DD8E                     SCRN:
001195 DD8E E5              11      PUSH    HL
001196 DD8F DB32            11      IN  A,(032H)
001198 DD91 67               4      LD  H,A
001199 DD92 CBA7             8      RES 4,A     ;高速RAMアクセスモード
00119B DD94 D332            11      OUT (032H),A
00119D DD96 0A               7      LD  A,(BC)
00119E DD97 6F               4      LD  L,A
00119F DD98 7C               4      LD  A,H
0011A0 DD99 D332            11      OUT (032H),A
0011A2 DD9B 7D               4      LD  A,L
0011A3 DD9C E1              10      POP HL
0011A4 DD9D C9              10      RET
                                
       DD9E                     VBLANK:
0011A5 DD9E F5              11      PUSH    AF
       DD9F                     VBLANK0:
0011A6 DD9F DB40            11      IN  A,(040H)
0011A8 DDA1 E620             7      AND 020H
0011AA DDA3 20FA            12      JR  NZ,VBLANK0
       DDA5                     VBLANK1:
0011AC DDA5 DB40            11      IN  A,(040H)
0011AE DDA7 E620             7      AND 020H
0011B0 DDA9 28FA            12      JR  Z,VBLANK1
0011B2 DDAB F1              10      POP AF
0011B3 DDAC C9              10      RET
                                
       DDAD                     INIT_CRTC:
0011B4 DDAD 3E03             7      LD  A,3     ;80桁
0011B6 DDAF D330            11      OUT (030H),A
0011B8 DDB1 32BEEF          13      LD  (WK30),A
                                
0011BB DDB4 3E22             7      LD  A,022H      ;25行 64K RAM
0011BD DDB6 D331            11      OUT (031H),A
0011BF DDB8 32BFEF          13      LD  (WK31),A
                                
0011C2 DDBB 3EFF             7      LD  A,0FFH
0011C4 DDBD D3E4            11      OUT (0E4H),A    ;割り込みレベル設定
0011C6 DDBF 32B8EF          13      LD  (WKE4),A
0011C9 DDC2 3E00             7      LD  A,0
0011CB DDC4 D3E6            11      OUT (0E6H),A    ;割り込みマスク
                                
0011CD DDC6 3E19             7      LD  A,019H
0011CF DDC8 D340            11      OUT (040H),A    ;CRT I/F 同期ビットオン
0011D1 DDCA 32B9EF          13      LD  (WK40),A
0011D4 DDCD CD9EDD          17      CALL    VBLANK
                                
0011D7 DDD0 AF               4      XOR A
0011D8 DDD1 D351            11      OUT (051H),A    ;Reset CRTC
0011DA DDD3 3EA0             7      LD  A,0A0H
0011DC DDD5 D368            11      OUT (068H),A    ;DMAC: Mode Set(Reset)
0011DE DDD7 21C8F3          10      LD  HL,0F3C8H
0011E1 DDDA 22B2EF          16      LD  (TVRAMTOP),HL
0011E4 DDDD 0E64             7      LD  C,064H
0011E6 DDDF ED69            12      OUT (C),L       ;TVRAM LOW
0011E8 DDE1 ED61            12      OUT (C),H       ;TVRAM HIGH
0011EA DDE3 21B78B          10      LD  HL,08000H+120*25-1
0011ED DDE6 0C               4      INC C       ;65H
0011EE DDE7 ED69            12      OUT (C),L
0011F0 DDE9 ED61            12      OUT (C),H
0011F2 DDEB 3ECE             7      LD  A,080H+80-2
0011F4 DDED D350            11      OUT (050H),A
0011F6 DDEF 3E98             7      LD  A,080H+25-1
0011F8 DDF1 D350            11      OUT (050H),A
0011FA DDF3 DB40            11      IN  A,(040H)
0011FC DDF5 CB4F             8      BIT 1,A
0011FE DDF7 21DE67          10      LD  HL,067DEH
001201 DDFA 2003            12      JR  NZ,RESO1
001203 DDFC 21586F          10      LD  HL,06F58H
       DDFF                     RESO1:
001206 DDFF 0E50             7      LD  C,050H
001208 DE01 ED61            12      OUT (C),H
00120A DE03 ED69            12      OUT (C),L
                                
00120C DE05 3E53             7      LD  A,053H
00120E DE07 D350            11      OUT (050H),A
                                
001210 DE09 3E43             7      LD  A,043H
001212 DE0B D351            11      OUT (051H),A
                                
001214 DE0D 3EE4             7      LD  A,0E4H
001216 DE0F D368            11      OUT (068H),A
                                
001218 DE11 3E20             7      LD  A,020H
00121A DE13 D351            11      OUT (051H),A
                                
00121C DE15 CD9EDD          17      CALL    VBLANK
       DE18                     IVBL1:
00121F DE18 DB40            11      IN  A,(040H)
001221 DE1A CB6F             8      BIT 5,A
001223 DE1C 20FA            12      JR  NZ,IVBL1
                                
001225 DE1E 3E11             7      LD  A,011H
001227 DE20 D340            11      OUT (040H),A    ;CRT I/F 同期ビットオフ
001229 DE22 32B9EF          13      LD  (WK40),A
00122C DE25 C9              10      RET
                                
       DE26                     BIOS:
00122D DE26 F3               4      DI
00122E DE27 F5              11      PUSH    AF
00122F DE28 3ABFEF          13      LD  A,(WK31)
001232 DE2B CB8F             8      RES 1,A
001234 DE2D D331            11      OUT (031H),A
001236 DE2F F1              10      POP AF
001237 DE30 CD2DE4          17      CALL    JP_BC
00123A DE33 F5              11      PUSH    AF
00123B DE34 3ABFEF          13      LD  A,(WK31)
00123E DE37 D331            11      OUT (031H),A
001240 DE39 F1              10      POP AF
001241 DE3A FB               4      EI
001242 DE3B C9              10      RET
[EOF:88IO.ASM:SHIFT_JIS]
                                    INCLUDE "LDFILE.ASM"
                                
                                ;   LSX-Dodgers FILE
                                
       DE3C                     FILEC:
001243 DE3C CD47DE          17      CALL    FILE
       DE3F                     FILEC2:
001246 DE3F 3A15EF          13      LD  A,(FDRV+1)
001249 DE42 FE20             7      CP  020H
00124B DE44 C8              11      RET Z
00124C DE45 1839            12      JR  SETDIR1
                                
       DE47                     FILE:
00124E DE47 AF               4      XOR A
00124F DE48 3214EF          13      LD  (FDRV),A
001252 DE4B 67               4      LD  H,A
001253 DE4C 6F               4      LD  L,A
001254 DE4D 2222EF          16      LD  (FDRV+14),HL
001257 DE50 CD1EDF          17      CALL    SPCUT
00125A DE53 CD03DF          17      CALL    CCHK3
00125D DE56 2812            12      JR  Z,DEVI1
00125F DE58 13               6      INC DE
001260 DE59 1A               7      LD  A,(DE)
001261 DE5A 1B               6      DEC DE
001262 DE5B FE3A             7      CP  ':'
001264 DE5D 200B            12      JR  NZ,DEVI1
001266 DE5F 1A               7      LD  A,(DE)      ;DRIVE
001267 DE60 CD53E1          17      CALL    CAP
00126A DE63 D640             7      SUB '@'
00126C DE65 13               6      INC DE
00126D DE66 13               6      INC DE
00126E DE67 3214EF          13      LD  (FDRV),A
       DE6A                     DEVI1:
001271 DE6A 1A               7      LD  A,(DE)
001272 DE6B D65C             7      SUB 05CH        ;\
001274 DE6D 2009            12      JR  NZ,NOROOT
001276 DE6F 6F               4      LD  L,A     ;A=0でH=0のはずなのでHL=0
001277 DE70 222EEF          16      LD  (FDRV+26),HL
00127A DE73 2C               4      INC L
00127B DE74 2222EF          16      LD  (FDRV+14),HL
00127E DE77 13               6      INC DE
       DE78                     NOROOT:
                                
       DE78                     SETDIR:
00127F DE78 CDA4DE          17      CALL    FILED
001282 DE7B 1A               7      LD  A,(DE)
001283 DE7C FE5C             7      CP  05CH        ;\
001285 DE7E C0              11      RET NZ
001286 DE7F 13               6      INC DE
       DE80                     SETDIR1:
001287 DE80 3E10             7      LD  A,010H      ;Directory
001289 DE82 3221EF          13      LD  (FDRV+13),A
00128C DE85 D5              11      PUSH    DE
00128D DE86 1114EF          10      LD  DE,FDRV
001290 DE89 2A1EF0          16      LD  HL,(STABLE+2*00FH)
001293 DE8C CD0F00          17      CALL    JP_HL
001296 DE8F D1              10      POP DE
001297 DE90 B7               4      OR  A
001298 DE91 C0              11      RET NZ
                                
001299 DE92 3A21EF          13      LD  A,(FDRV+13)
00129C DE95 CB67             8      BIT 4,A
00129E DE97 C8              11      RET Z
                                
00129F DE98 CDEBDE          17      CALL    FILEI
0012A2 DE9B 2A2EEF          16      LD  HL,(FDRV+26)
0012A5 DE9E 23               6      INC HL
0012A6 DE9F 2222EF          16      LD  (FDRV+14),HL
0012A9 DEA2 18D4            12      JR  SETDIR
                                
       DEA4                     FILED:
0012AB DEA4 CDEBDE          17      CALL    FILEI
0012AE DEA7 2115EF          10      LD  HL,FNAME
                                
0012B1 DEAA 0608             7      LD  B,8
       DEAC                     FILE2:
0012B3 DEAC CDF8DE          17      CALL    CCHKF
0012B6 DEAF C8              11      RET Z
0012B7 DEB0 FE2A             7      CP  '*'
0012B9 DEB2 282E            12      JR  Z,FILE9
0012BB DEB4 FE2E             7      CP  '.'
0012BD DEB6 280C            12      JR  Z,FILE4
0012BF DEB8 77               7      LD  (HL),A
0012C0 DEB9 23               6      INC HL
0012C1 DEBA 10F0            13      DJNZ    FILE2
                                
       DEBC                     FILE3:
0012C3 DEBC CDF8DE          17      CALL    CCHKF
0012C6 DEBF C8              11      RET Z
0012C7 DEC0 FE2E             7      CP  '.'
0012C9 DEC2 20F8            12      JR  NZ,FILE3
                                
       DEC4                     FILE4:
0012CB DEC4 211DEF          10      LD  HL,FNAME+8
0012CE DEC7 0603             7      LD  B,3
                                
       DEC9                     FILE4L:
0012D0 DEC9 CDF8DE          17      CALL    CCHKF
0012D3 DECC C8              11      RET Z
0012D4 DECD FE2E             7      CP  '.'
0012D6 DECF 2008            12      JR  NZ,FILE12
0012D8 DED1 3215EF          13      LD  (FNAME),A   ;Parent directory(..)
0012DB DED4 3216EF          13      LD  (FNAME+1),A
0012DE DED7 3E20             7      LD  A,020H
       DED9                     FILE12:
0012E0 DED9 FE2A             7      CP  '*'
0012E2 DEDB 280A            12      JR  Z,FILE10
0012E4 DEDD 77               7      LD  (HL),A
0012E5 DEDE 23               6      INC HL
0012E6 DEDF 10E8            13      DJNZ    FILE4L
0012E8 DEE1 C9              10      RET
                                
       DEE2                     FILE9:              ;名前の*処理、名前の残りを?で埋める
0012E9 DEE2 CDE7DE          17      CALL    FILE10
0012EC DEE5 18D5            12      JR  FILE3
                                
       DEE7                     FILE10:
0012EE DEE7 3E3F             7      LD  A,'?'
0012F0 DEE9 1808            12      JR  FILL_MEMORY
       DEEB                     FILEI:              ;名前＋拡張子をスペースで初期化
0012F2 DEEB 3E20             7      LD  A,020H
0012F4 DEED 01000B          10      LD  BC,11*256   ;C=0にしておく
0012F7 DEF0 2115EF          10      LD  HL,FNAME
       DEF3                     FILL_MEMORY:            ;HLからBバイトAで埋める
0012FA DEF3 77               7      LD  (HL),A
0012FB DEF4 23               6      INC HL
0012FC DEF5 10FC            13      DJNZ    FILL_MEMORY
0012FE DEF7 C9              10      RET
                                
       DEF8                     CCHKF:
0012FF DEF8 1A               7      LD  A,(DE)
001300 DEF9 CD00DF          17      CALL    CCHK2
001303 DEFC C8              11      RET Z
001304 DEFD C36BE2          10      JP  FKAN
                                
       DF00                     CCHK2:
001307 DF00 0C               4      INC C
001308 DF01 0D               4      DEC C
001309 DF02 C0              11      RET NZ
       DF03                     CCHK3:              ;ZF=1 で使えない文字
00130A DF03 FE2B             7      CP  '+'
00130C DF05 C8              11      RET Z
00130D DF06 FE2C             7      CP  ','
00130F DF08 C8              11      RET Z
001310 DF09 FE2F             7      CP  '/'
001312 DF0B C8              11      RET Z
001313 DF0C FE3A             7      CP  ':'
001315 DF0E C8              11      RET Z
001316 DF0F FE3B             7      CP  ';'
001318 DF11 C8              11      RET Z
001319 DF12 FE3D             7      CP  '='
00131B DF14 C8              11      RET Z
00131C DF15 FE5C             7      CP  05CH    ;\
00131E DF17 C8              11      RET Z
00131F DF18 FE20             7      CP  020H
001321 DF1A D0              11      RET NC
001322 DF1B BF               4      CP  A       ;Z=1
001323 DF1C C9              10      RET
                                
       DF1D                     SS1:
001324 DF1D 13               6      INC DE
       DF1E                     SPCUT:              ;スペースをカット
001325 DF1E 1A               7      LD  A,(DE)
001326 DF1F FE20             7      CP  020H
001328 DF21 28FA            12      JR  Z,SS1
00132A DF23 C9              10      RET
                                
       DF24                     SETDRVF:
00132B DF24 1114EF          10      LD  DE,FDRV
       DF27                     SETDRV0:
00132E DF27 CD30DF          17      CALL    SETDRV
001331 DF2A FDE1            14      POP IY
001333 DF2C C1              10      POP BC
001334 DF2D D1              10      POP DE
001335 DF2E E1              10      POP HL
001336 DF2F C9              10      RET
                                
       DF30                     SETDRV:
001337 DF30 E3              19      EX  (SP),HL     ;HL=RETRN ADDRESS
001338 DF31 D5              11      PUSH    DE      ;PUSH HL/DE/BC/IY
001339 DF32 C5              11      PUSH    BC
00133A DF33 1A               7      LD  A,(DE)
00133B DF34 D5              11      PUSH    DE
00133C DF35 FDE3            23      EX  (SP),IY
                                
00133E DF37 CD43DF          17      CALL    GETDRV
001341 DF3A 3C               4      INC A
001342 DF3B FD7700          19      LD  (IY+0),A    ;(FCB)ドライブ番号
001345 DF3E 3D               4      DEC A
001346 DF3F CDD9EF          17      CALL    _CHGDRV
                                
001349 DF42 E9               4      JP  (HL)
                                
       DF43                     GETDRV:
00134A DF43 E67F             7      AND 07FH
00134C DF45 D601             7      SUB 001H
00134E DF47 3003            12      JR  NC,GETDRV1
001350 DF49 3A87EF          13      LD  A,(_DVSW)   ;Current Drive
       DF4C                     GETDRV1:
001353 DF4C 3288EF          13      LD  (_DRV),A
001356 DF4F C9              10      RET
                                
       DF50                     SOPENX:
001357 DF50 1139EF          10      LD  DE,SFILE
00135A DF53 1A               7      LD  A,(DE)
00135B DF54 FDBE00           7      CP  (IY+0)      ;(FCB)ドライブ番号
00135E DF57 2024            12      JR  NZ,SOPEN
001360 DF59 13               6      INC DE
001361 DF5A FDE5            15      PUSH    IY
001363 DF5C E1              10      POP HL
001364 DF5D 23               6      INC HL
001365 DF5E CDEBE0          17      CALL    CPFILE
001368 DF61 201A            12      JR  NZ,SOPEN
                                
00136A DF63 2AF4F0          16      LD  HL,(SCDIR)
00136D DF66 FD750E          19      LD  (IY+14),L   ;(FCB)アクセスするディレクトリのクラスタ番号+1
001370 DF69 FD740F          19      LD  (IY+15),H
                                
001373 DF6C 2AF8F0          16      LD  HL,(SFNDF)  ;Direcroty location and Flags
001376 DF6F 229FEF          16      LD  (_FILEN),HL
                                
001379 DF72 ED5BF6F0        20      LD  DE,(SFBPS)
00137D DF76 2139EF          10      LD  HL,SFILE
001380 DF79 36FF            10      LD  (HL),0FFH
001382 DF7B 23               6      INC HL
001383 DF7C C9              10      RET
       DF7D                     SOPEN:
001384 DF7D 2193E0          10      LD  HL,FILESE
       DF80                     SOPENC:
001387 DF80 22B9DF          16      LD  (OPENPAT+1),HL
                                
00138A DF83 CDE2EF          17      CALL    _RDFATX     ;Detect Media
00138D DF86 3856            12      JR  C,RDDERR
                                
00138F DF88 AF               4      XOR A
001390 DF89 329FEF          13      LD  (_FILEN),A
001393 DF8C CD98E1          17      CALL    LDDIRX1     ;A=0で呼び出す
001396 DF8F 2818            12      JR  Z,SDIRX1
                                
001398 DF91 CD84E0          17      CALL    READ_DIR    ;Sub Directory
00139B DF94 3808            12      JR  C,SDIRX0
00139D DF96 2A7EF0          16      LD  HL,(_DTBUF)
0013A0 DF99 7E               7      LD  A,(HL)
0013A1 DF9A FE2E             7      CP  '.'
0013A3 DF9C 280F            12      JR  Z,SOPEN1
       DF9E                     SDIRX0:
0013A5 DF9E AF               4      XOR A
0013A6 DF9F 32A0EF          13      LD  (_DIRF),A
0013A9 DFA2 FD360E01        19      LD  (IY+14),1   ;(FCB)レコードサイズ
0013AD DFA6 FD770F          19      LD  (IY+15),A
       DFA9                     SDIRX1:
0013B0 DFA9 ED5BFCF0        20      LD  DE,(_DIRPS) ;Root Directory
       DFAD                     SOPEN1:
0013B4 DFAD 0E20             7  SDECPAT:LD  C,32        ;自己書き換え 1セクタ辺りのディレクトリエントリ数  1024=32 / 512=16 / 256=8
       DFAF                     SOPEN1X:
0013B6 DFAF CD84E0          17      CALL    READ_DIR    ;FILE SEARCH
0013B9 DFB2 382A            12      JR  C,RDDERR
0013BB DFB4 2A7EF0          16      LD  HL,(_DTBUF)
       DFB7                     SOPEN2:
0013BE DFB7 D5              11      PUSH    DE
0013BF DFB8 CD93E0          17  OPENPAT:CALL    FILESE      ;(self-modifying code)
0013C2 DFBB D1              10      POP DE
0013C3 DFBC 386E            12      JR  C,SOPENE
0013C5 DFBE 281B            12      JR  Z,SCF_FF_RET
       DFC0                     SOPEN3:
0013C7 DFC0 3AA0EF          13      LD  A,(_DIRF)   ;ディレクトリか判別
0013CA DFC3 B7               4      OR  A
0013CB DFC4 200C            12      JR  NZ,SOPEN5
0013CD DFC6 13               6      INC DE      ;ルートディレクトリ
0013CE DFC7 E5              11      PUSH    HL
0013CF DFC8 210C00          10  MD_PAT: LD  HL,12       ;(self-modifying code)MAXDIR
0013D2 DFCB ED52            15      SBC HL,DE       ;CF=0 なので SUB HL,DE
0013D4 DFCD E1              10      POP HL
0013D5 DFCE 20DD            12      JR  NZ,SOPEN1
0013D7 DFD0 1807            12      JR  SOPEN6
       DFD2                     SOPEN5:
0013D9 DFD2 CD9DE8          17      CALL    GNCLX       ;END DIR
0013DC DFD5 D8              11      RET C
0013DD DFD6 CD4BE1          17      CALL    ENDCL
       DFD9                     SOPEN6:
0013E0 DFD9 38D2            12      JR  C,SOPEN1
       DFDB                     SCF_FF_RET:
0013E2 DFDB 37               4      SCF         ;CF=1
0013E3 DFDC 9F               4      SBC A,A     ;A=0FFH
0013E4 DFDD C9              10      RET
                                
       DFDE                     RDDERR:
0013E5 DFDE BF               4      CP  A       ;READ ERR CF=1 ZF=1
0013E6 DFDF 37               4      SCF
0013E7 DFE0 C9              10      RET
                                
       DFE1                     NOPEN:
0013E8 DFE1 2193E0          10      LD  HL,FILESE
0013EB DFE4 22B9DF          16      LD  (OPENPAT+1),HL
0013EE DFE7 FD2A98EF        20      LD  IY,(_FCB)
0013F2 DFEB CD7EE2          17      CALL    CHKWILDX
0013F5 DFEE 30EB            12      JR  NC,SCF_FF_RET
0013F7 DFF0 FD7E00          19      LD  A,(IY+0)    ;(FCB)ドライブ番号
0013FA DFF3 3D               4      DEC A
0013FB DFF4 3288EF          13      LD  (_DRV),A
0013FE DFF7 CDD9EF          17      CALL    _CHGDRV
001401 DFFA D8              11      RET C
001402 DFFB 2AF8F0          16      LD  HL,(SFNDF)  ;Direcroty location and Flags
001405 DFFE 229FEF          16      LD  (_FILEN),HL
                                
001408 E001 CD93E1          17      CALL    LDDIRX
00140B E004 ED5B9AEF        20      LD  DE,(_FBPS)
00140F E008 CD84E0          17      CALL    READ_DIR
001412 E00B 38D1            12      JR  C,RDDERR
001414 E00D 3A9EEF          13      LD  A,(_FBCNT)
001417 E010 3D               4      DEC A
001418 E011 28AD            12      JR  Z,SOPEN3
       E013                     NOPEN2:
00141A E013 2A9CEF          16      LD  HL,(_FBAD)
00141D E016 012000          10      LD  BC,020H
001420 E019 09              11      ADD HL,BC
001421 E01A 4F               4      LD  C,A
001422 E01B 189A            12      JR  SOPEN2
                                
       E01D                     SOPENE2:
001424 E01D 229CEF          16      LD  (_FBAD),HL
001427 E020 79               4      LD  A,C
001428 E021 329EEF          13      LD  (_FBCNT),A
00142B E024 ED539AEF        20      LD  (_FBPS),DE
00142F E028 FD2298EF        20      LD  (_FCB),IY
       E02C                     SOPENE:
001433 E02C AF               4      XOR A
001434 E02D C9              10      RET
                                
       E02E                     COPEN:
001435 E02E FD360D20        19      LD  (IY+13),020H    ;(FCB)属性(アトリビュート)
                                
001439 E032 21B0E0          10      LD  HL,NEXTSE
00143C E035 CD80DF          17      CALL    SOPENC
00143F E038 D0              11      RET NC
001440 E039 C8              11      RET Z
001441 E03A 3AA0EF          13      LD  A,(_DIRF)   ;ディレクトリか判別
001444 E03D B7               4      OR  A
001445 E03E 37               4      SCF
001446 E03F C8              11      RET Z       ;ルートディレクトリ
001447 E040 0601             7      LD  B,1
001449 E042 CDDCE2          17      CALL    WRDF
00144C E045 D8              11      RET C
00144D E046 ED5BFEF0        20      LD  DE,(_CLPS)
001451 E04A D5              11      PUSH    DE
001452 E04B CD14E1          17      CALL    DCPAT
001455 E04E CD28E7          17      CALL    DRDNX
001458 E051 2A7EF0          16      LD  HL,(_DTBUF) ;ディレクトリエントリを0クリア
00145B E054 3A1CE6          13      LD  A,(SECSZ+2) ;1024=4 / 512=2 / 256=1
00145E E057 47               4      LD  B,A
00145F E058 AF               4      XOR A
001460 E059 4F               4      LD  C,A
       E05A                     COPENCL:
001461 E05A 77               7      LD  (HL),A
001462 E05B EDA1            16      CPI         ;HL=HL+1 BC=BC-1 BCが0の場合にP/V=0
001464 E05D EA5AE0          10      JP  PE,COPENCL
                                
001467 E060 3A32E1          13      LD  A,(SPCPAT+1)    ;1クラスタの論理セクタ数
00146A E063 3D               4      DEC A
00146B E064 2819            12      JR  Z,COPENE
00146D E066 3E01             7      LD  A,1     ;1セクタ辺りのセクタ数が2以上の場合
00146F E068 3295E8          13      LD  (_SECPS+1),A
001472 E06B D1              10      POP DE      ;DE=(_CLPS)
001473 E06C D5              11      PUSH    DE
       E06D                     COPEN1:
001474 E06D D5              11      PUSH    DE      ;データバッファに入らないセクタもゼロクリア
001475 E06E C5              11      PUSH    BC
001476 E06F 2A7EF0          16      LD  HL,(_DTBUF)
001479 E072 CD2EE1          17      CALL    CLUSTX
00147C E075 CD00EA          17      CALL    DWT24
00147F E078 C1              10      POP BC
001480 E079 D1              10      POP DE
001481 E07A CD94E8          17      CALL    NEXTX
001484 E07D 20EE            12      JR  NZ,COPEN1
       E07F                     COPENE:
001486 E07F 2A7EF0          16      LD  HL,(_DTBUF)
001489 E082 D1              10      POP DE
00148A E083 C9              10      RET
                                
       E084                     READ_DIR:
00148B E084 ED53FEF0        20      LD  (_CLPS),DE
00148F E088 C5              11      PUSH    BC
001490 E089 D5              11      PUSH    DE
001491 E08A CD14E1          17      CALL    DCPAT
001494 E08D CD08E7          17      CALL    DRDX
001497 E090 D1              10      POP DE
001498 E091 C1              10      POP BC
001499 E092 C9              10      RET
                                
       E093                     FILESE:
00149A E093 7E               7      LD  A,(HL)
00149B E094 B7               4      OR  A
00149C E095 C8              11      RET Z       ;END:ZF=1 CF=0
00149D E096 FEE5             7      CP  0E5H
00149F E098 280E            12      JR  Z,FILESE1
0014A1 E09A FDE5            15      PUSH    IY
0014A3 E09C D1              10      POP DE
0014A4 E09D 13               6      INC DE
0014A5 E09E E5              11      PUSH    HL
0014A6 E09F CDEBE0          17      CALL    CPFILE
0014A9 E0A2 CC0CE1          17      CALL    Z,CPFILE2
0014AC E0A5 E1              10      POP HL
0014AD E0A6 37               4      SCF
0014AE E0A7 C8              11      RET Z       ;!!!:(ZF=1) CF=1
       E0A8                     FILESE1:
0014AF E0A8 CDBFE0          17      CALL    FNEXT
0014B2 E0AB 20E6            12      JR  NZ,FILESE
       E0AD                     ZF0_CF0_AFF_RET:
0014B4 E0AD F6FF             7      OR  0FFH        ;ZF=0 CF=0
0014B6 E0AF C9              10      RET
                                
       E0B0                     NEXTSE:
0014B7 E0B0 7E               7      LD  A,(HL)
0014B8 E0B1 B7               4      OR  A
0014B9 E0B2 37               4      SCF
0014BA E0B3 C8              11      RET Z       ;!!!:ZF=1 CF=1
0014BB E0B4 FEE5             7      CP  0E5H
0014BD E0B6 37               4      SCF
0014BE E0B7 C8              11      RET Z       ;!!!:(ZF=1) CF=1
0014BF E0B8 CDBFE0          17      CALL    FNEXT
0014C2 E0BB 20F3            12      JR  NZ,NEXTSE
0014C4 E0BD 18EE            12      JR  ZF0_CF0_AFF_RET
                                
       E0BF                     FNEXT:
0014C6 E0BF E5              11      PUSH    HL
0014C7 E0C0 219FEF          10      LD  HL,_FILEN
0014CA E0C3 34              11      INC (HL)
0014CB E0C4 E1              10      POP HL
0014CC E0C5 112000          10      LD  DE,020H
0014CF E0C8 19              11      ADD HL,DE
0014D0 E0C9 0D               4      DEC C
0014D1 E0CA C9              10      RET
                                
       E0CB                     CPNAME:
0014D2 E0CB C5              11      PUSH    BC
0014D3 E0CC D5              11      PUSH    DE
0014D4 E0CD E5              11      PUSH    HL
0014D5 E0CE CDE5E0          17      CALL    CPFILE4
0014D8 E0D1 E1              10      POP HL
0014D9 E0D2 23               6      INC HL
0014DA E0D3 23               6      INC HL
0014DB E0D4 23               6      INC HL
0014DC E0D5 23               6      INC HL
0014DD E0D6 D1              10      POP DE
0014DE E0D7 C1              10      POP BC
0014DF E0D8 2005            12      JR  NZ,CPNAME1
0014E1 E0DA 7E               7      LD  A,(HL)
0014E2 E0DB 23               6      INC HL
0014E3 E0DC 66               7      LD  H,(HL)
0014E4 E0DD 6F               4      LD  L,A
0014E5 E0DE C9              10      RET
       E0DF                     CPNAME1:
0014E6 E0DF 23               6      INC HL
0014E7 E0E0 23               6      INC HL
0014E8 E0E1 10E8            13      DJNZ    CPNAME
0014EA E0E3 37               4      SCF
0014EB E0E4 C9              10      RET
                                
       E0E5                     CPFILE4:
0014EC E0E5 C5              11      PUSH    BC
0014ED E0E6 010004          10      LD  BC,00400H
0014F0 E0E9 1804            12      JR  CPSTR1
       E0EB                     CPFILE:
0014F2 E0EB C5              11      PUSH    BC
0014F3 E0EC 01000B          10      LD  BC,00B00H
       E0EF                     CPSTR1:
0014F6 E0EF 1A               7      LD  A,(DE)
0014F7 E0F0 FE3F             7      CP  '?'     ;Wild card
0014F9 E0F2 2812            12      JR  Z,CPSTR2
0014FB E0F4 7E               7      LD  A,(HL)
0014FC E0F5 CD64E2          17      CALL    FKANC
0014FF E0F8 E5              11      PUSH    HL
001500 E0F9 67               4      LD  H,A
001501 E0FA 1A               7      LD  A,(DE)
001502 E0FB CB01             4      RLC C
001504 E0FD CD64E2          17      CALL    FKANC
001507 E100 CB09             4      RRC C
001509 E102 BC               4      CP  H       ;CP (HL),(DE)
00150A E103 E1              10      POP HL
00150B E104 2004            12      JR  NZ,CPSTR3
       E106                     CPSTR2:
00150D E106 13               6      INC DE
00150E E107 23               6      INC HL
00150F E108 10E5            13      DJNZ    CPSTR1
       E10A                     CPSTR3:
001511 E10A C1              10      POP BC
001512 E10B C9              10      RET
                                
       E10C                     CPFILE2:
001513 E10C FD7E0D          19      LD  A,(IY+13)   ;(FCB)属性(アトリビュート)
001516 E10F F6E1             7      OR  0E1H
001518 E111 2F               4      CPL
001519 E112 A6               7      AND (HL)
00151A E113 C9              10      RET
                                
       E114                     DCPAT:
00151B E114 0E00             7      LD  C,0
00151D E116 2A7EF0          16      LD  HL,(_DTBUF)
001520 E119 3AA0EF          13      LD  A,(_DIRF)   ;ディレクトリか判別
001523 E11C B7               4      OR  A
001524 E11D C8              11      RET Z       ;ルートディレクトリの場合はCレジスタを0にしておく(CDEがセクタ番号)
001525 E11E 3A32E1          13      LD  A,(SPCPAT+1)
001528 E121 4F               4      LD  C,A
001529 E122 3A95E8          13      LD  A,(_SECPS+1)
00152C E125 B9               4      CP  C
00152D E126 3801            12      JR  C,DC1
00152F E128 AF               4      XOR A
       E129                     DC1:
001530 E129 F680             7      OR  080H
001532 E12B 32A0EF          13      LD  (_DIRF),A   ;bit0-6:セクタインデックス
       E12E                     CLUSTX:
001535 E12E E5              11      PUSH    HL
001536 E12F EB               4      EX  DE,HL
001537 E130 AF               4      XOR A
001538 E131 0E01             7  SPCPAT: LD  C,1     ;自己書き換え（1クラスタの論理セクタ数）
       E133                     L_CLDBL:
00153A E133 CB19             8      RR  C       ;->CF
00153C E135 3804            12      JR  C,E_CLDBL
00153E E137 29              11      ADD HL,HL       ;*2
00153F E138 8F               4      ADC A,A
001540 E139 18F8            12      JR  L_CLDBL
       E13B                     E_CLDBL:
001542 E13B 4F               4      LD  C,A
001543 E13C 3A95E8          13      LD  A,(_SECPS+1)
001546 E13F B5               4      OR  L
001547 E140 6F               4      LD  L,A
001548 E141 110800          10  CLSPAT: LD  DE,8    ;+8 (2D)  !ADDCL (self-modifying code)
00154B E144 AF               4      XOR A
00154C E145 19              11      ADD HL,DE   ;データ格納領域の先頭論理セクタ番号
00154D E146 89               4      ADC A,C
00154E E147 4F               4      LD  C,A
00154F E148 EB               4      EX  DE,HL
001550 E149 E1              10      POP HL
001551 E14A C9              10      RET
                                
       E14B                     ENDCL:
001552 E14B 7A               4      LD  A,D ;END CLUSTER
001553 E14C FE01             7  CLPAT1: CP  1   ;164=356    (self-modifying code)
001555 E14E C0              11      RET NZ
001556 E14F 7B               4      LD  A,E
001557 E150 FE64             7  CLPAT2: CP  064H    ;       (self-modifying code)
001559 E152 C9              10      RET
                                
       E153                     CAP:
00155A E153 FE61             7      CP  'a'
00155C E155 D8              11      RET C
00155D E156 FE7B             7      CP  'z'+1
00155F E158 D0              11      RET NC
001560 E159 D620             7      SUB 020H
001562 E15B C9              10      RET
       E15C                     CAP2:
001563 E15C CD53E1          17      CALL    CAP
       E15F                     CAP3:
001566 E15F CD68E1          17      CALL    CAP4
001569 E162 FE21             7      CP  021H
00156B E164 D0              11      RET NC
00156C E165 3EA0             7      LD  A,0A0H
00156E E167 C9              10      RET
       E168                     CAP4:
00156F E168 FE05             7      CP  5
001571 E16A C0              11      RET NZ
001572 E16B 3EE5             7      LD  A,0E5H
001574 E16D C9              10      RET
                                
       E16E                     CHDIR:
001575 E16E CD2FEB          17      CALL    GETDPBD
001578 E171 381D            12      JR  C,CHDIR2
00157A E173 DD751A          19      LD  (IX+01AH),L     ;_SDIR_
00157D E176 DD741B          19      LD  (IX+01BH),H     ;_SDIR_+1
001580 E179 1815            12      JR  CHDIR2      ;POP_IX_RET
                                
       E17B                     LDDIR:
001582 E17B CD2FEB          17      CALL    GETDPBD
001585 E17E DD5E1A          19      LD  E,(IX+01AH)     ;_SDIR_
001588 E181 DD561B          19      LD  D,(IX+01BH)     ;_SDIR_+1
00158B E184 13               6      INC DE
00158C E185 FD730E          19      LD  (IY+14),E   ;(FCB)アクセスするディレクトリのクラスタ番号+1
00158F E188 FD720F          19      LD  (IY+15),D
001592 E18B 1B               6      DEC DE
001593 E18C AF               4      XOR A
001594 E18D 32A0EF          13      LD  (_DIRF),A
       E190                     CHDIR2:
001597 E190 DDE1            14      POP IX
001599 E192 C9              10      RET
                                
       E193                     LDDIRX:
00159A E193 3AA0EF          13      LD  A,(_DIRF)   ;(FCB)アクセスするディレクトリのセクタインデックス
00159D E196 E67F             7      AND 07FH
       E198                     LDDIRX1:
00159F E198 3295E8          13      LD  (_SECPS+1),A
0015A2 E19B FD5E0E          19      LD  E,(IY+14)   ;(FCB)アクセスするディレクトリのクラスタ番号+1
0015A5 E19E FD560F          19      LD  D,(IY+15)
0015A8 E1A1 1B               6      DEC DE
0015A9 E1A2 CD4BE1          17      CALL    ENDCL
0015AC E1A5 D47BE1          17      CALL    NC,LDDIR
       E1A8                     LDDIRS:
0015AF E1A8 7A               4      LD  A,D
0015B0 E1A9 B3               4      OR  E
0015B1 E1AA 32A0EF          13      LD  (_DIRF),A   ;ディレクトリか判別
0015B4 E1AD C9              10      RET
                                
       E1AE                     KILL:
0015B5 E1AE CD7EE2          17      CALL    CHKWILDX
0015B8 E1B1 3834            12      JR  C,KILLW
0015BA E1B3 CD50DF          17      CALL    SOPENX
       E1B6                     KILLS:
0015BD E1B6 3E1F             7      LD  A,01FH
0015BF E1B8 D4FAE1          17      CALL    NC,CHKATT
0015C2 E1BB D8              11      RET C
       E1BC                     KILLSX:
0015C3 E1BC 36E5            10      LD  (HL),0E5H   ;DIR
0015C5 E1BE CD58E2          17      CALL    WTDB
0015C8 E1C1 111A00          10      LD  DE,01AH
0015CB E1C4 19              11      ADD HL,DE
0015CC E1C5 5E               7      LD  E,(HL)
0015CD E1C6 23               6      INC HL
0015CE E1C7 56               7      LD  D,(HL)
       E1C8                     KILLS1:
0015CF E1C8 CD4BE1          17      CALL    ENDCL
0015D2 E1CB D0              11      RET NC      ;CF=0
0015D3 E1CC 21FEFF          10      LD  HL,0-2
0015D6 E1CF 19              11      ADD HL,DE
0015D7 E1D0 D0              11      RET NC      ;DE= 0 or 1
0015D8 E1D1 D5              11      PUSH    DE
0015D9 E1D2 CDF7EF          17      CALL    _GNCL
0015DC E1D5 ED53FEF0        20      LD  (_CLPS),DE
0015E0 E1D9 D1              10      POP DE
0015E1 E1DA 210000          10      LD  HL,0
0015E4 E1DD D4FAEF          17      CALL    NC,_SNCL
0015E7 E1E0 D8              11      RET C
0015E8 E1E1 ED5BFEF0        20      LD  DE,(_CLPS)  ;FAT
0015EC E1E5 18E1            12      JR  KILLS1
                                
       E1E7                     KILLW:
0015EE E1E7 CD7DDF          17      CALL    SOPEN
       E1EA                     KILLW1:
0015F1 E1EA 380B            12      JR  C,KILLW2
0015F3 E1EC CD1DE0          17      CALL    SOPENE2
0015F6 E1EF CDB6E1          17      CALL    KILLS
0015F9 E1F2 CDE1DF          17      CALL    NOPEN
0015FC E1F5 18F3            12      JR  KILLW1
       E1F7                     KILLW2:
0015FE E1F7 C8              11      RET Z
0015FF E1F8 3F               4      CCF
001600 E1F9 C9              10      RET
                                
       E1FA                     CHKATT:
001601 E1FA E5              11      PUSH    HL
001602 E1FB 110B00          10      LD  DE,00BH
001605 E1FE 19              11      ADD HL,DE
001606 E1FF A6               7      AND (HL)
001607 E200 E1              10      POP HL
001608 E201 C8              11      RET Z
001609 E202 37               4      SCF
00160A E203 C9              10      RET
                                
       E204                     NAME:
00160B E204 CD7EE2          17      CALL    CHKWILDX
00160E E207 D8              11      RET C
00160F E208 110400          10      LD  DE,4
001612 E20B 19              11      ADD HL,DE
001613 E20C 2224E2          16      LD  (NAMEP+2),HL
001616 E20F 23               6      INC HL
001617 E210 CD82E2          17      CALL    CHKWILD
00161A E213 D8              11      RET C
                                
00161B E214 CD50DF          17      CALL    SOPENX
00161E E217 3E0F             7      LD  A,00FH
001620 E219 D4FAE1          17      CALL    NC,CHKATT
001623 E21C D8              11      RET C
                                
001624 E21D FD7E00          19      LD  A,(IY+0)
001627 E220 FDE5            15      PUSH    IY
001629 E222 FD210000        14  NAMEP:  LD  IY,0        ;自己書き換え
00162D E226 FD7700          19      LD  (IY+0),A
001630 E229 CD50DF          17      CALL    SOPENX
001633 E22C FDE3            23      EX  (SP),IY
001635 E22E 3F               4      CCF
001636 E22F D47DDF          17      CALL    NC,SOPEN
001639 E232 EB               4      EX  DE,HL
00163A E233 E1              10      POP HL
00163B E234 D8              11      RET C
                                
       E235                     SETNAME:
00163C E235 01000B          10      LD  BC,11*256
00163F E238 23               6      INC HL
001640 E239 7E               7      LD  A,(HL)
001641 E23A FEE5             7      CP  0E5H
001643 E23C 2004            12      JR  NZ,SNAME1
001645 E23E 3E05             7      LD  A,5
001647 E240 180E            12      JR  SNAME3
       E242                     SNAME1:
001649 E242 7E               7      LD  A,(HL)
00164A E243 0C               4      INC C
00164B E244 0D               4      DEC C
00164C E245 2009            12      JR  NZ,SNAME3
00164E E247 CD53E1          17      CALL    CAP
001651 E24A FEA0             7      CP  0A0H
001653 E24C 2002            12      JR  NZ,SNAME3
001655 E24E 3E20             7      LD  A,020H
       E250                     SNAME3:
001657 E250 12               7      LD  (DE),A
001658 E251 7E               7      LD  A,(HL)
001659 E252 23               6      INC HL
00165A E253 CD6BE2          17      CALL    FKAN
00165D E256 10EA            13      DJNZ    SNAME1
       E258                     WTDB:
00165F E258 3EFF             7      LD  A,0FFH
001661 E25A 3239EF          13      LD  (SFILE),A
       E25D                     SWTDBF:
001664 E25D 3E01             7      LD  A,1
001666 E25F 32A4EF          13      LD  (_WTDBF),A
001669 E262 AF               4      XOR A
00166A E263 C9              10      RET
                                
       E264                     FKANC:
00166B E264 CB41             8      BIT 0,C
00166D E266 CC5CE1          17      CALL    Z,CAP2
001670 E269 1801            12      JR  FKANX
       E26B                     FKAN:           ;漢字チェック
001672 E26B 13               6      INC DE
       E26C                     FKANX:
001673 E26C CB41             8      BIT 0,C
001675 E26E CB81             8      RES 0,C
001677 E270 C0              11      RET NZ
001678 E271 FE80             7      CP  080H
00167A E273 D8              11      RET C
00167B E274 FEA0             7      CP  0A0H
00167D E276 3803            12      JR  C,FKAN1
00167F E278 FEE0             7      CP  0E0H
001681 E27A D8              11      RET C
       E27B                     FKAN1:
001682 E27B 0C               4      INC C
001683 E27C A7               4      AND A
001684 E27D C9              10      RET
                                
       E27E                     CHKWILDX:
001685 E27E FDE5            15      PUSH    IY
001687 E280 E1              10      POP HL
001688 E281 23               6      INC HL
       E282                     CHKWILD:
001689 E282 060B             7      LD  B,11
00168B E284 3E3F             7      LD  A,'?'
       E286                     CHKWIL1:
00168D E286 BE               7      CP  (HL)
00168E E287 23               6      INC HL
00168F E288 37               4      SCF
001690 E289 C8              11      RET Z
001691 E28A 10FA            13      DJNZ    CHKWIL1
001693 E28C AF               4      XOR A
001694 E28D C9              10      RET
                                
       E28E                     SDIRENT:        ;IY=FCB HL=DIR
001695 E28E D5              11      PUSH    DE
001696 E28F E5              11      PUSH    HL
001697 E290 FDE5            15      PUSH    IY
001699 E292 D1              10      POP DE
00169A E293 EB               4      EX  DE,HL
00169B E294 CD35E2          17      CALL    SETNAME
                                ;               Attribute
00169E E297 FD7E0D          19      LD  A,(IY+13)   ;(FCB)属性(アトリビュート)
0016A1 E29A 12               7      LD  (DE),A
0016A2 E29B 13               6      INC DE
                                ;               Reserved
0016A3 E29C AF               4      XOR A
0016A4 E29D 060A             7      LD  B,10
       E29F                     SDE1:
0016A6 E29F 12               7      LD  (DE),A
0016A7 E2A0 13               6      INC DE
0016A8 E2A1 10FC            13      DJNZ    SDE1
                                                    ;(FCB)更新時刻
0016AA E2A3 21EAF0          10      LD  HL,SDDATA       ;(FCB)更新年月日
0016AD E2A6 060A             7      LD  B,SDDATAE-SDDATA    ;(FCB)ファイルの先頭クラスタ
       E2A8                     SDLOOP:                 ;(FCB)ファイルのサイズ(バイト単位)
0016AF E2A8 7E               7      LD  A,(HL)
0016B0 E2A9 23               6      INC HL
0016B1 E2AA 32AFE2          13      LD  (SDPAT+2),A
0016B4 E2AD FD7E00          19  SDPAT:  LD  A,(IY+0)    ;LD A,(IY+A)
0016B7 E2B0 12               7      LD  (DE),A
0016B8 E2B1 13               6      INC DE
0016B9 E2B2 10F4            13      DJNZ    SDLOOP
                                
0016BB E2B4 AF               4      XOR A
0016BC E2B5 E1              10      POP HL
0016BD E2B6 D1              10      POP DE
0016BE E2B7 C9              10      RET
                                
       E2B8                     WOPEN:
0016BF E2B8 FD7E0D          19      LD  A,(IY+13)   ;(FCB)属性(アトリビュート)
0016C2 E2BB E61F             7      AND 01FH
0016C4 E2BD 37               4      SCF
0016C5 E2BE C0              11      RET NZ
0016C6 E2BF FD361CFE        19      LD  (IY+28),0FEH    ;(FCB)オープンモード
       E2C3                     TOPEN2:
0016CA E2C3 AF               4      XOR A
       E2C4                     TOPEN:              ;Initializes the time stamp
0016CB E2C4 FD3617FF        19      LD  (IY+23),0FFH    ;(FCB)更新時刻
0016CF E2C8 C9              10      RET
                                
       E2C9                     WRDFX:
0016D0 E2C9 3A32E1          13      LD  A,(SPCPAT+1)    ;1クラスタの論理セクタ
       E2CC                     L_WRFX:
0016D3 E2CC 1F               4      RRA         ;->CF
0016D4 E2CD 3806            12      JR  C,E_WRFX
0016D6 E2CF CB39             8      SRL C
0016D8 E2D1 CB1C             8      RR  H       ;CH=CH/2
0016DA E2D3 18F7            12      JR  L_WRFX
       E2D5                     E_WRFX:
0016DC E2D5 44               4      LD  B,H
0016DD E2D6 04               4      INC B
0016DE E2D7 3E37             7      LD  A,037H      ;SCF
0016E0 E2D9 3225E7          13      LD  (DRDN1),A
                                
       E2DC                     WRDF:               ;Bクラスタ分FATを確保する
0016E3 E2DC 110200          10      LD  DE,2
0016E6 E2DF AF               4      XOR A
0016E7 E2E0 3295E8          13      LD  (_SECPS+1),A
       E2E3                     WRDF1:
0016EA E2E3 C5              11      PUSH    BC
0016EB E2E4 D5              11      PUSH    DE
0016EC E2E5 CDF7EF          17      CALL    _GNCL
0016EF E2E8 381C            12      JR  C,WRDF3
0016F1 E2EA 7A               4      LD  A,D     ;空いているかチェック
0016F2 E2EB B3               4      OR  E
0016F3 E2EC 2027            12      JR  NZ,WRDF4
0016F5 E2EE E1              10      POP HL      ;HL=空いているクラスタ
0016F6 E2EF E5              11      PUSH    HL
0016F7 E2F0 ED5BFEF0        20      LD  DE,(_CLPS)  ;DE=元の(_CLPS)
0016FB E2F4 22FEF0          16      LD  (_CLPS),HL
0016FE E2F7 7A               4      LD  A,D     ;元の(_CLPS)が 0 か?
0016FF E2F8 B3               4      OR  E
001700 E2F9 2008            12      JR  NZ,WRDF2
001702 E2FB FD751A          19      LD  (IY+26),L   ;(FCB)ファイルの先頭クラスタ
001705 E2FE FD741B          19      LD  (IY+27),H   ;元が空の場合はFCBにクラスタをセットする
001708 E301 1803            12      JR  WRDF3
       E303                     WRDF2:
00170A E303 CDFAEF          17      CALL    _SNCL
       E306                     WRDF3:
00170D E306 D1              10      POP DE
00170E E307 C1              10      POP BC
00170F E308 D8              11      RET C
001710 E309 100C            13      DJNZ    WRDF5       ;ここでループカウンタチェック
001712 E30B ED5BFEF0        20      LD  DE,(_CLPS)
001716 E30F 21FFFF          10      LD  HL,0FFFFH   ;FATエントリ終了(EOCマーク)
001719 E312 C3FAEF          10      JP  _SNCL
                                
       E315                     WRDF4:              ;DEクラスタが空じゃないので次に移動する
00171C E315 D1              10      POP DE
00171D E316 C1              10      POP BC
       E317                     WRDF5:
00171E E317 13               6      INC DE
00171F E318 CD4BE1          17      CALL    ENDCL
001722 E31B 38C6            12      JR  C,WRDF1
001724 E31D 37               4      SCF
001725 E31E C9              10      RET
                                
       E31F                     RWXR:
001726 E31F 3A1CE6          13      LD  A,(SECSZ+2) ;1024=4 / 512=2 / 256=1
       E322                     L_RWX:
001729 E322 1F               4      RRA     ;->CF
00172A E323 3808            12      JR  C,E_RWX
00172C E325 CB38             8      SRL B   ;BCH=BCH/2
00172E E327 CB19             8      RR  C   ;
001730 E329 CB1C             8      RR  H   ;
001732 E32B 18F5            12      JR  L_RWX
       E32D                     E_RWX:
001734 E32D FD5E1A          19      LD  E,(IY+26)   ;(FCB)ファイルの先頭クラスタ
001737 E330 FD561B          19      LD  D,(IY+27)
00173A E333 AF               4      XOR A
00173B E334 3295E8          13      LD  (_SECPS+1),A
       E337                     RWX1:
00173E E337 ED53FEF0        20      LD  (_CLPS),DE
001742 E33B 7A               4      LD  A,D
001743 E33C B3               4      OR  E
001744 E33D 2813            12      JR  Z,SCF_RET   ;RET DE==0 => CF=1
                                
001746 E33F 78               4      LD  A,B
001747 E340 B1               4      OR  C
001748 E341 B4               4      OR  H
001749 E342 C8              11      RET Z       ;RET BCH==0 => CF=0
                                
00174A E343 CD9DE8          17      CALL    GNCLX
00174D E346 D8              11      RET C
00174E E347 7C               4      LD  A,H     ;
00174F E348 25               4      DEC H       ;
001750 E349 B7               4      OR  A       ;DEC BCH
001751 E34A 2001            12      JR  NZ,RWX2     ;
001753 E34C 0B               6      DEC BC      ;
       E34D                     RWX2:
001754 E34D CD4BE1          17      CALL    ENDCL
001757 E350 38E5            12      JR  C,RWX1
       E352                     SCF_RET:
001759 E352 37               4      SCF
00175A E353 C9              10      RET
                                
       E354                     DSKF:
00175B E354 110000          10  MAXCLP: LD  DE,0
00175E E357 2AACEF          16      LD  HL,(_FAKEFREE)
001761 E35A 7C               4      LD  A,H
001762 E35B B5               4      OR  L
001763 E35C 2803            12      JR  Z,DSKF1
001765 E35E 110100          10      LD  DE,1
       E361                     DSKF1:
001768 E361 D5              11      PUSH    DE
001769 E362 CDF7EF          17      CALL    _GNCL
00176C E365 380C            12      JR  C,POPSCF
00176E E367 7A               4      LD  A,D
00176F E368 B3               4      OR  E
001770 E369 2001            12      JR  NZ,DSKF2
001772 E36B 23               6      INC HL
       E36C                     DSKF2:
001773 E36C D1              10      POP DE
001774 E36D 1B               6      DEC DE
001775 E36E 7A               4      LD  A,D
001776 E36F B3               4      OR  E
001777 E370 20EF            12      JR  NZ,DSKF1
001779 E372 C9              10      RET
                                
       E373                     POPSCF:
00177A E373 F1              10      POP AF
00177B E374 37               4      SCF
00177C E375 C9              10      RET
                                
       E376                     SETTMS:
00177D E376 FD7E17          19      LD  A,(IY+23)   ;(FCB)ファイルを最後に変更した時刻
001780 E379 3C               4      INC A
001781 E37A C0              11      RET NZ      ;ファイルが更新されていない
       E37B                     SETTMSX:            ;FCBに日付時刻をセットする
001782 E37B CDC4D9          17      CALL    _SYS2C      ;(BDOS)時刻の獲得
                                                ;H←時  L←分  D←秒
001785 E37E CB25             8      SLA L       ;   *2
001787 E380 CB25             8      SLA L       ;   *4
001789 E382 29              11      ADD HL,HL       ;*2 *8
00178A E383 29              11      ADD HL,HL       ;*4 *16
00178B E384 29              11      ADD HL,HL       ;*8 *32
00178C E385 7A               4      LD  A,D
00178D E386 0F               4      RRCA            ;bit.0->7->->->0->C
00178E E387 E61F             7      AND 01FH
001790 E389 B5               4      OR  L
001791 E38A FD7716          19      LD  (IY+22),A   ;(FCB)ファイルを最後に変更した時刻
001794 E38D FD7417          19      LD  (IY+23),H
                                
001797 E390 CD9DD9          17      CALL    _SYS2A      ;(BDOS)日付の獲得
                                                ;HL←年  D←月  E←日
00179A E393 0144F8          10      LD  BC,0-1980
00179D E396 09              11      ADD HL,BC
00179E E397 65               4      LD  H,L
                                
00179F E398 7A               4      LD  A,D
0017A0 E399 87               4      ADD A,A     ;*2
0017A1 E39A 87               4      ADD A,A     ;*4
0017A2 E39B 87               4      ADD A,A     ;*8
0017A3 E39C 87               4      ADD A,A     ;*16
0017A4 E39D 6F               4      LD  L,A
0017A5 E39E 29              11      ADD HL,HL       ;*32
0017A6 E39F 7D               4      LD  A,L
0017A7 E3A0 B3               4      OR  E
0017A8 E3A1 FD7714          19      LD  (IY+20),A   ;(FCB)ファイルを最後に変更した日付
0017AB E3A4 FD7415          19      LD  (IY+21),H
0017AE E3A7 C9              10      RET
                                
       E3A8                     PUSHRR:
0017AF E3A8 CDAEE3          17      CALL    SUBRR
       E3AB                     POPRR1:
0017B2 E3AB EDB0                    LDIR
0017B4 E3AD C9              10      RET
                                
       E3AE                     SUBRR:
0017B5 E3AE FDE5            15      PUSH    IY
0017B7 E3B0 E1              10      POP HL
0017B8 E3B1 112100          10      LD  DE,33
0017BB E3B4 19              11      ADD HL,DE
0017BC E3B5 115AEF          10      LD  DE,HLBUF
0017BF E3B8 010300          10      LD  BC,3
0017C2 E3BB C9              10      RET
                                
       E3BC                     SETSEQ:
0017C3 E3BC F5              11      PUSH    AF      ;AHL=Random record
0017C4 E3BD C5              11      PUSH    BC
0017C5 E3BE FD7E21          19      LD  A,(IY+33)   ;(FCB)ランダムレコード
0017C8 E3C1 FD6E22          19      LD  L,(IY+34)
0017CB E3C4 FD6623          19      LD  H,(IY+35)
0017CE E3C7 0600             7      LD  B,0
                                
0017D0 E3C9 CDDDE3          17      CALL    GET_CPM_R_SIZE
                                
0017D3 E3CC 29              11      ADD HL,HL
0017D4 E3CD CB3D             8      SRL L       ;L=L/2
0017D6 E3CF FD7520          19      LD  (IY+32),L   ;(FCB)カレントレコード
0017D9 E3D2 FD740C          19      LD  (IY+12),H   ;(FCB)カレントブロック
0017DC E3D5 C1              10      POP BC
0017DD E3D6 F1              10      POP AF
                                
       E3D7                     POPRR:
0017DE E3D7 CDAEE3          17      CALL    SUBRR
0017E1 E3DA EB               4      EX  DE,HL
0017E2 E3DB 18CE            12      JR  POPRR1
                                
       E3DD                     GET_CPM_R_SIZE:     ;バイト単位からCP/Mのレコード単位を求める（1レコード=128バイト）
0017E4 E3DD 87               4      ADD A,A     ;in BHLA => out AHL
0017E5 E3DE ED6A            15      ADC HL,HL
0017E7 E3E0 CB18             8      RR  B
0017E9 E3E2 B7               4      OR  A
0017EA E3E3 78               4      LD  A,B     ;ここでフラグは変化しない
0017EB E3E4 C8              11      RET Z
0017EC E3E5 2C               4      INC L       ;INC AHL
0017ED E3E6 C0              11      RET NZ      ;
0017EE E3E7 24               4      INC H       ;
0017EF E3E8 C0              11      RET NZ      ;
0017F0 E3E9 3C               4      INC A       ;
0017F1 E3EA C9              10      RET
                                
       E3EB                     GETSEQ:
0017F2 E3EB FD6E20          19      LD  L,(IY+32)   ;(FCB)カレントレコード
0017F5 E3EE FD660C          19      LD  H,(IY+12)   ;(FCB)カレントブロック
0017F8 E3F1 AF               4      XOR A
                                
0017F9 E3F2 CB25             8      SLA L   ;L=L*2
                                
0017FB E3F4 CB3C             8      SRL H   ;HL=HL/2
0017FD E3F6 CB1D             8      RR  L   ;
0017FF E3F8 C9              10      RET
                                
       E3F9                     RB_WRITE:
001800 E3F9 C5              11      PUSH    BC
001801 E3FA ED4B4CF0        20      LD  BC,(STABLE+2*026H)  ;(BDOS)ランダムブロック書き込み
001805 E3FE 1805            12      JR  RBRW
       E400                     RB_READ:
001807 E400 C5              11      PUSH    BC
001808 E401 ED4B4EF0        20      LD  BC,(STABLE+2*027H)  ;(BDOS)ランダムブロック読み込み
       E405                     RBRW:
00180C E405 CB3F             8      SRL A   ;AHLA' = HL*128
00180E E407 CB1C             8      RR  H   ;AHL=AHL/2
001810 E409 CB1D             8      RR  L   ;
001812 E40B 3E00             7      LD  A,0
001814 E40D 1F               4      RRA     ;A'HLA
001815 E40E FD7721          19      LD  (IY+33),A   ;(FCB)ランダムレコード
001818 E411 FD7522          19      LD  (IY+34),L
00181B E414 FD7423          19      LD  (IY+35),H
00181E E417 FDCB20FE        23      SET 7,(IY+32)   ;(FCB)カレントレコード
001822 E41B 218000          10      LD  HL,128
                                
001825 E41E FDE5            15      PUSH    IY
001827 E420 D1              10      POP DE
001828 E421 D5              11      PUSH    DE
001829 E422 CD2DE4          17      CALL    JP_BC
00182C E425 FDE1            14      POP IY
00182E E427 C1              10      POP BC
00182F E428 FDCB20BE        23      RES 7,(IY+32)   ;(FCB)カレントレコード
001833 E42C C9              10      RET
       E42D                     JP_BC:
001834 E42D C5              11      PUSH    BC
001835 E42E C9              10      RET
                                
       DFDB                     _SYS03  EQU SCF_FF_RET  ;(BDOS)外部入力
       DFDB                     _SYS2B  EQU SCF_FF_RET  ;(BDOS)日付の設定
       DFDB                     _SYS2D  EQU SCF_FF_RET  ;(BDOS)時刻の設定
       DFDB                     _SYS39  EQU SCF_FF_RET  ;(BDOS)サブディレクトリの作成
       DFDB                     _SYS3A  EQU SCF_FF_RET  ;(BDOS)サブディレクトリの削除
                                
[EOF:LDFILE.ASM:SHIFT_JIS]
                                    INCLUDE "LDFILE2.ASM"
                                
                                ;   LSX-Dodgers FILE2
                                
                                                ;Write random block
       E42F                     _SYS26:     ;(BDOS)ランダムブロック書き込み
001836 E42F AF               4      XOR A
001837 E430 3225E7          13      LD  (DRDN1),A   ;NOP
00183A E433 225FE6          16      LD  (LEFT+1),HL ;HL←書き込むレコード数
00183D E436 225DEF          16      LD  (LEFTX),HL
001840 E439 CD30DF          17      CALL    SETDRV
                                
001843 E43C CDB6E5          17      CALL    RBX0
001846 E43F DAD9E4          10      JP  C,RBWERR
001849 E442 CDB8E2          17      CALL    WOPEN
00184C E445 DAD9E4          10      JP  C,RBWERR
00184F E448 7C               4      LD  A,H
001850 E449 B5               4      OR  L
001851 E44A CAD2E4          10      JP  Z,RBW1
                                
001854 E44D 2B               6      DEC HL
                                
001855 E44E CD8BE6          17      CALL    GET_RR_BCDE ;BCDE=Random record
                                
001858 E451 19              11      ADD HL,DE       ;BCHL=HL+BCDE
001859 E452 3001            12      JR  NC,S26X1    ;
00185B E454 03               6      INC BC      ;
       E455                     S26X1:
00185C E455 CD1FE3          17      CALL    RWXR
00185F E458 DCC9E2          17      CALL    C,WRDFX
001862 E45B DAD9E4          10      JP  C,RBWERR
                                
001865 E45E CDE5E5          17      CALL    RBX2
001868 E461 281A            12      JR  Z,RBWB      ;NZ=セクタ以下の端数がある
00186A E463 CD04E6          17      CALL    RBXA
00186D E466 3871            12      JR  C,RBWERR
00186F E468 EB               4      EX  DE,HL
001870 E469 C5              11      PUSH    BC
001871 E46A EDB0                    LDIR
001873 E46C 225FEF          16      LD  (DTAX),HL
                                
001876 E46F CD5DE2          17      CALL    SWTDBF      ;バッファデータは更新された
                                
001879 E472 2A5DEF          16      LD  HL,(LEFTX)
00187C E475 D1              10      POP DE
00187D E476 ED52            15      SBC HL,DE
00187F E478 225DEF          16      LD  (LEFTX),HL
001882 E47B 2833            12      JR  Z,RBWEND
                                
       E47D                     RBWB:
001884 E47D CD3AE6          17      CALL    RBXB
001887 E480 2816            12      JR  Z,RBWC
       E482                     RBWB1:
001889 E482 C5              11      PUSH    BC
00188A E483 D5              11      PUSH    DE
00188B E484 CD2EE1          17      CALL    CLUSTX
00188E E487 CD9FE6          17      CALL    DWTC
001891 E48A D1              10      POP DE
001892 E48B C1              10      POP BC
001893 E48C 384B            12      JR  C,RBWERR
001895 E48E CD9DE8          17      CALL    GNCLX
001898 E491 3846            12      JR  C,RBWERR
00189A E493 10ED            13      DJNZ    RBWB1
00189C E495 CDEFE6          17      CALL    DRW_FLUSH
       E498                     RBWC:
00189F E498 CD52E6          17      CALL    RBXC
0018A2 E49B 2813            12      JR  Z,RBWEND
0018A4 E49D C5              11      PUSH    BC
0018A5 E49E CD2EE1          17      CALL    CLUSTX
0018A8 E4A1 CD24E7          17      CALL    DRDN
0018AB E4A4 C1              10      POP BC
0018AC E4A5 3832            12      JR  C,RBWERR
0018AE E4A7 ED5B7EF0        20      LD  DE,(_DTBUF)
0018B2 E4AB EDB0                    LDIR
0018B4 E4AD CD5DE2          17      CALL    SWTDBF      ;バッファデータは更新された
       E4B0                     RBWEND:
0018B7 E4B0 CD5EE6          17      CALL    RBXEND
                                
0018BA E4B3 CDC5E5          17      CALL    RBX1
0018BD E4B6 301A            12      JR  NC,RBW1
0018BF E4B8 2A5FE6          16      LD  HL,(LEFT+1)
0018C2 E4BB FD5E10          19      LD  E,(IY+16)   ;(FCB)ファイルのサイズ(バイト単位)
0018C5 E4BE FD5611          19      LD  D,(IY+17)   ;DE=File size
0018C8 E4C1 19              11      ADD HL,DE
0018C9 E4C2 FD7510          19      LD  (IY+16),L   ;(FCB)ファイルのサイズ(バイト単位)
0018CC E4C5 FD7411          19      LD  (IY+17),H
0018CF E4C8 3008            12      JR  NC,RBW1
0018D1 E4CA FD3412          23      INC (IY+18)
0018D4 E4CD 2003            12      JR  NZ,RBW1
0018D6 E4CF FD3413          23      INC (IY+19)
       E4D2                     RBW1:
0018D9 E4D2 FDE1            14      POP IY
0018DB E4D4 C1              10      POP BC
0018DC E4D5 D1              10      POP DE
0018DD E4D6 E1              10      POP HL
       E4D7                     DD_NUL:
0018DE E4D7 AF               4      XOR A
       E4D8                     DRDF0:
       E4D8                     DWTF0:
0018DF E4D8 C9              10      RET
                                
       E4D9                     RBWERR:
0018E0 E4D9 FDE5            15      PUSH    IY
0018E2 E4DB D1              10      POP DE
0018E3 E4DC 2A20F0          16      LD  HL,(STABLE+2*010H)
0018E6 E4DF CD0F00          17      CALL    JP_HL
       E4E2                     RBRERR1:
0018E9 E4E2 3E01             7      LD  A,001H
       E4E4                     RBRERR2:
0018EB E4E4 FDE1            14      POP IY
0018ED E4E6 C1              10      POP BC
0018EE E4E7 D1              10      POP DE
0018EF E4E8 E1              10      POP HL
0018F0 E4E9 37               4      SCF
0018F1 E4EA 210000          10      LD  HL,0
0018F4 E4ED C9              10      RET
                                
       E4EE                     RBRERR:
0018F5 E4EE 3EFF             7      LD  A,0FFH
0018F7 E4F0 18F2            12      JR  RBRERR2
                                
       E4F2                     RBRFL:
0018F9 E4F2 3E00             7  RBRFLP: LD  A,000H
0018FB E4F4 FE0D             7      CP  00DH
0018FD E4F6 2005            12      JR  NZ,RBRFL1
0018FF E4F8 D5              11      PUSH    DE
001900 E4F9 1E0A             7      LD  E,00AH
001902 E4FB 1805            12      JR  RBRFL2
       E4FD                     RBRFL1:
001904 E4FD D5              11      PUSH    DE
001905 E4FE CD09EF          17      CALL    _SYS07
001908 E501 5F               4      LD  E,A
       E502                     RBRFL2:
001909 E502 CDCDEF          17      CALL    _PRINT
00190C E505 7B               4      LD  A,E
00190D E506 D1              10      POP DE
00190E E507 32F3E4          13      LD  (RBRFLP+1),A
001911 E50A C9              10      RET
       E50B                     DDX:
001912 E50B FD7E01          19      LD  A,(IY+1)    ;(FCB)主ファイル名
001915 E50E CD53E1          17      CALL    CAP
001918 E511 FE41             7      CP  'A'
00191A E513 C9              10      RET
                                
                                                ;Read random block
       E514                     _SYS27:     ;(BDOS)ランダムブロック読み込み
00191B E514 225DEF          16      LD  (LEFTX),HL
00191E E517 CD30DF          17      CALL    SETDRV
                                
001921 E51A FDCB0D66        20      BIT 4,(IY+13)   ;(FCB)属性(アトリビュート)
001925 E51E C2A4E5          10      JP  NZ,RBRDIR   ;ディレクトリ
001928 E521 CDB6E5          17      CALL    RBX0
00192B E524 DAEEE4          10      JP  C,RBRERR
00192E E527 CDC5E5          17      CALL    RBX1
001931 E52A DAE2E4          10      JP  C,RBRERR1
001934 E52D EB               4      EX  DE,HL
001935 E52E ED52            15      SBC HL,DE       ;CP 00HL,BCDE
001937 E530 19              11      ADD HL,DE
001938 E531 79               4      LD  A,C
001939 E532 DE00             7      SBC A,0
00193B E534 78               4      LD  A,B
00193C E535 DE00             7      SBC A,0
00193E E537 3801            12      JR  C,RBR1
001940 E539 EB               4      EX  DE,HL
       E53A                     RBR1:
001941 E53A 9F               4      SBC A,A
001942 E53B E601             7      AND 1
001944 E53D 32A2E5          13      LD  (RBRAP+1),A
                                
001947 E540 7C               4      LD  A,H
001948 E541 B5               4      OR  L
001949 E542 2857            12      JR  Z,RBREND0
                                
00194B E544 225FE6          16      LD  (LEFT+1),HL ;Read record byte
00194E E547 225DEF          16      LD  (LEFTX),HL
                                
001951 E54A CDE5E5          17      CALL    RBX2
001954 E54D 2819            12      JR  Z,RBRB
001956 E54F CD04E6          17      CALL    RBXA
001959 E552 DAEEE4          10      JP  C,RBRERR
00195C E555 C5              11      PUSH    BC
00195D E556 EDB0                    LDIR
00195F E558 ED535FEF        20      LD  (DTAX),DE
001963 E55C 2A5DEF          16      LD  HL,(LEFTX)
001966 E55F D1              10      POP DE
001967 E560 A7               4      AND A
001968 E561 ED52            15      SBC HL,DE
00196A E563 225DEF          16      LD  (LEFTX),HL
00196D E566 2830            12      JR  Z,RBREND
                                
       E568                     RBRB:
00196F E568 CD3AE6          17      CALL    RBXB
001972 E56B 2815            12      JR  Z,RBRC
       E56D                     RBRB1:
001974 E56D C5              11      PUSH    BC
001975 E56E D5              11      PUSH    DE
001976 E56F CD2EE1          17      CALL    CLUSTX
001979 E572 CDA5E6          17      CALL    DRDC
00197C E575 D1              10      POP DE
00197D E576 C1              10      POP BC
00197E E577 D49DE8          17      CALL    NC,GNCLX
001981 E57A DAEEE4          10      JP  C,RBRERR
001984 E57D 10EE            13      DJNZ    RBRB1
001986 E57F CDEFE6          17      CALL    DRW_FLUSH
       E582                     RBRC:
001989 E582 CD52E6          17      CALL    RBXC
00198C E585 2811            12      JR  Z,RBREND
00198E E587 C5              11      PUSH    BC
00198F E588 CD2EE1          17      CALL    CLUSTX
001992 E58B CD08E7          17      CALL    DRDX
001995 E58E C1              10      POP BC
001996 E58F DAEEE4          10      JP  C,RBRERR
001999 E592 EB               4      EX  DE,HL
00199A E593 2A7EF0          16      LD  HL,(_DTBUF)
00199D E596 EDB0                    LDIR
       E598                     RBREND:
00199F E598 CD5EE6          17      CALL    RBXEND
       E59B                     RBREND0:
0019A2 E59B FDE1            14      POP IY
0019A4 E59D C1              10      POP BC
0019A5 E59E D1              10      POP DE
0019A6 E59F F1              10      POP AF  ;(HL)
0019A7 E5A0 AF               4      XOR A
0019A8 E5A1 3E00             7  RBRAP:  LD  A,000H
0019AA E5A3 C9              10      RET
                                
       E5A4                     RBRDIR:
0019AB E5A4 FD6E1A          19      LD  L,(IY+26)   ;(FCB)ファイルの先頭クラスタ
0019AE E5A7 FD661B          19      LD  H,(IY+27)
0019B1 E5AA CD6EE1          17      CALL    CHDIR
0019B4 E5AD AF               4      XOR A
0019B5 E5AE 67               4      LD  H,A
0019B6 E5AF 6F               4      LD  L,A
0019B7 E5B0 3C               4      INC A
0019B8 E5B1 32A2E5          13      LD  (RBRAP+1),A
0019BB E5B4 18E5            12      JR  RBREND0
                                
       E5B6                     RBX0:
0019BD E5B6 2A8AEF          16      LD  HL,(_DTA)
0019C0 E5B9 225FEF          16      LD  (DTAX),HL
0019C3 E5BC 2A5DEF          16      LD  HL,(LEFTX)
0019C6 E5BF FD7E1C          19      LD  A,(IY+28)   ;(FCB)オープンモード
0019C9 E5C2 D6FD             7      SUB 0FDH
0019CB E5C4 C9              10      RET
                                
       E5C5                     RBX1:
0019CC E5C5 E5              11      PUSH    HL      ;Record byte
                                                ;AHL=File size
0019CD E5C6 FD6E10          19      LD  L,(IY+16)   ;ファイルのサイズ(バイト単位)
0019D0 E5C9 FD6611          19      LD  H,(IY+17)   ;
0019D3 E5CC FD7E12          19      LD  A,(IY+18)   ;
                                
0019D6 E5CF CD8BE6          17      CALL    GET_RR_BCDE ;BCDE=Random record
                                
0019D9 E5D2 A7               4      AND A
0019DA E5D3 ED52            15      SBC HL,DE
0019DC E5D5 99               4      SBC A,C
0019DD E5D6 4F               4      LD  C,A
0019DE E5D7 FD7E13          19      LD  A,(IY+19)   ;ファイルのサイズ
0019E1 E5DA 98               4      SBC A,B
0019E2 E5DB D1              10      POP DE
                                
0019E3 E5DC D8              11      RET C
0019E4 E5DD 47               4      LD  B,A
0019E5 E5DE B1               4      OR  C
0019E6 E5DF EB               4      EX  DE,HL   ;BCDE=File byte HL=Record byte
0019E7 E5E0 B2               4      OR  D
0019E8 E5E1 B3               4      OR  E
0019E9 E5E2 C0              11      RET NZ
0019EA E5E3 37               4      SCF
0019EB E5E4 C9              10      RET
                                
       E5E5                     RBX2:               ;Cluster settings
0019EC E5E5 FD6622          19      LD  H,(IY+34)   ;(+33)(FCB)ランダムレコード
0019EF E5E8 FD4E23          19      LD  C,(IY+35)
0019F2 E5EB 0600             7      LD  B,0
0019F4 E5ED FDCB207E        20      BIT 7,(IY+32)   ;(FCB)カレントレコード
0019F8 E5F1 2003            12      JR  NZ,RBX3
0019FA E5F3 FD4624          19      LD  B,(IY+36)
       E5F6                     RBX3:
0019FD E5F6 CD1FE3          17      CALL    RWXR
001A00 E5F9 3A1CE6          13      LD  A,(SECSZ+2) ;1024=4 / 512=2 / 256=1
001A03 E5FC 3D               4      DEC A
001A04 E5FD FDA622          19      AND (IY+34)
001A07 E600 FDB621          19      OR  (IY+33)
001A0A E603 C9              10      RET
                                
       E604                     RBXA:
001A0B E604 C5              11      PUSH    BC
001A0C E605 D5              11      PUSH    DE
001A0D E606 CD2EE1          17      CALL    CLUSTX
001A10 E609 CD08E7          17      CALL    DRDX
001A13 E60C D1              10      POP DE
001A14 E60D C1              10      POP BC
001A15 E60E D8              11      RET C
001A16 E60F CD9DE8          17      CALL    GNCLX
001A19 E612 D8              11      RET C
001A1A E613 ED53FEF0        20      LD  (_CLPS),DE
                                
001A1E E617 FD4E21          19      LD  C,(IY+33)   ;(FCB)ランダムレコード
001A21 E61A 210004          10  SECSZ:  LD  HL,0400H    ;自己書き換え 1024=0400H / 512=0200H ここに1セクタのサイズが格納される
001A24 E61D 7C               4      LD  A,H
001A25 E61E 3D               4      DEC A       ;1024=3 / 512=1
001A26 E61F FDA622          19      AND (IY+34)     ;(FCB)ランダムレコード
001A29 E622 47               4      LD  B,A     ;BCに1セクタ以下の端数が入る
001A2A E623 ED42            15      SBC HL,BC       ;残りを計算
                                
001A2C E625 ED5B5DEF        20      LD  DE,(LEFTX)
001A30 E629 ED52            15      SBC HL,DE       ;CP HL,DE
001A32 E62B 19              11      ADD HL,DE       ;
001A33 E62C 3801            12      JR  C,RBXA1     ;DEとHLを比較して大きい方をHLに
001A35 E62E EB               4      EX  DE,HL
       E62F                     RBXA1:
001A36 E62F E5              11      PUSH    HL
001A37 E630 2A7EF0          16      LD  HL,(_DTBUF)
001A3A E633 09              11      ADD HL,BC
001A3B E634 ED5B5FEF        20      LD  DE,(DTAX)
001A3F E638 C1              10      POP BC
001A40 E639 C9              10      RET
                                
       E63A                     RBXB:
001A41 E63A 2A5FEF          16      LD  HL,(DTAX)
001A44 E63D ED5BFEF0        20      LD  DE,(_CLPS)
001A48 E641 3A5EEF          13      LD  A,(LEFTX+1)
001A4B E644 47               4      LD  B,A
001A4C E645 3A1CE6          13      LD  A,(SECSZ+2) ;1024=4 / 512=2 / 256=1
       E648                     RBXB1:
001A4F E648 1F               4      RRA     ;->CF
001A50 E649 3804            12      JR  C,RBXB2
001A52 E64B CB38             8      SRL B   ;B=B/2
001A54 E64D 18F9            12      JR  RBXB1
       E64F                     RBXB2:
001A56 E64F 78               4      LD  A,B
001A57 E650 B7               4      OR  A
001A58 E651 C9              10      RET
                                
       E652                     RBXC:
001A59 E652 ED4B5DEF        20      LD  BC,(LEFTX)
001A5D E656 3A1CE6          13      LD  A,(SECSZ+2) ;1024=4 / 512=2 / 256=1
001A60 E659 3D               4      DEC A
001A61 E65A A0               4      AND B
001A62 E65B 47               4      LD  B,A     ;1セクタ以下の端数がない場合はZ
001A63 E65C B1               4      OR  C
001A64 E65D C9              10      RET
                                
       E65E                     RBXEND:
001A65 E65E 110000          10  LEFT:   LD  DE,0
001A68 E661 AF               4      XOR A
001A69 E662 FD6E21          19      LD  L,(IY+33)   ;(FCB)ランダムレコード
001A6C E665 FD6622          19      LD  H,(IY+34)
001A6F E668 19              11      ADD HL,DE
001A70 E669 FD7521          19      LD  (IY+33),L   ;(FCB)ランダムレコード
001A73 E66C FD7422          19      LD  (IY+34),H
001A76 E66F 300E            12      JR  NC,RBXEND1
001A78 E671 FD3423          23      INC (IY+35)
001A7B E674 2009            12      JR  NZ,RBXEND1
001A7D E676 FDCB207E        20      BIT 7,(IY+32)   ;(FCB)カレントレコード
001A81 E67A 2003            12      JR  NZ,RBXEND1
001A83 E67C FD3424          23      INC (IY+36)
       E67F                     RBXEND1:
001A86 E67F EB               4      EX  DE,HL       ;HL=Read byte
001A87 E680 C9              10      RET
                                
       E681                     GET_RR_AHL:
001A88 E681 FD6E21          19      LD  L,(IY+33)   ;(FCB)Random record
001A8B E684 FD6622          19      LD  H,(IY+34)   ;
001A8E E687 FD7E23          19      LD  A,(IY+35)   ;
001A91 E68A C9              10      RET
                                
       E68B                     GET_RR_BCDE:            ;BCDE=Random record
001A92 E68B FD5E21          19      LD  E,(IY+33)   ;(FCB)ランダムレコード
001A95 E68E FD5622          19      LD  D,(IY+34)
001A98 E691 FD4E23          19      LD  C,(IY+35)
001A9B E694 FD4624          19      LD  B,(IY+36)
001A9E E697 FDCB207E        20      BIT 7,(IY+32)   ;(FCB)カレントレコード
001AA2 E69B C8              11      RET Z
001AA3 E69C 0600             7      LD  B,0     ;CP/M互換のアクセスの場合はFCBは36バイト
001AA5 E69E C9              10      RET
                                
                                ;   ランダムブロックアクセスの連続したセクタをまとめる
                                
       E69F                     DWTC:
001AA6 E69F E5              11      PUSH    HL
001AA7 E6A0 2102EA          10      LD  HL,DWT24B
001AAA E6A3 1804            12      JR  DWTC1
       E6A5                     DRDC:
001AAC E6A5 E5              11      PUSH    HL
001AAD E6A6 21F2E9          10      LD  HL,DRD24B
       E6A9                     DWTC1:
001AB0 E6A9 2203E7          16      LD  (DRWF_MODE),HL
001AB3 E6AC E1              10      POP HL
001AB4 E6AD 3AF3E6          13      LD  A,(DRWF_B)
001AB7 E6B0 B7               4      OR  A
001AB8 E6B1 200F            12      JR  NZ,DRDC1
       E6B3                     SAVE_DRWC:
001ABA E6B3 0601             7      LD  B,1
001ABC E6B5 ED43F2E6        20      LD  (DRWF_C),BC
001AC0 E6B9 ED53F9E6        20      LD  (DRWF_E),DE
001AC4 E6BD 22FCE6          16      LD  (DRWF_HL),HL
001AC7 E6C0 1820            12      JR  INC_HL_DRWC
       E6C2                     DRDC1:
001AC9 E6C2 E5              11      PUSH    HL
001ACA E6C3 21F9E6          10      LD  HL,DRWF_E
001ACD E6C6 86               7      ADD A,(HL)
001ACE E6C7 F5              11      PUSH    AF
001ACF E6C8 BB               4      CP  E
001AD0 E6C9 201D            12      JR  NZ,DRDC2
001AD2 E6CB F1              10      POP AF
001AD3 E6CC 23               6      INC HL
001AD4 E6CD 7E               7      LD  A,(HL)
001AD5 E6CE CE00             7      ADC A,0
001AD7 E6D0 F5              11      PUSH    AF
001AD8 E6D1 BA               4      CP  D
001AD9 E6D2 2014            12      JR  NZ,DRDC2
001ADB E6D4 F1              10      POP AF
001ADC E6D5 3AF2E6          13      LD  A,(DRWF_C)
001ADF E6D8 CE00             7      ADC A,0
001AE1 E6DA B9               4      CP  C
001AE2 E6DB 200C            12      JR  NZ,DRDC3
001AE4 E6DD 21F3E6          10      LD  HL,DRWF_B
001AE7 E6E0 34              11      INC (HL)
001AE8 E6E1 E1              10      POP HL
       E6E2                     INC_HL_DRWC:
001AE9 E6E2 3A1CE6          13      LD  A,(SECSZ+2)     ;1セクタのサイズの上位1バイト
001AEC E6E5 84               4      ADD A,H
001AED E6E6 67               4      LD  H,A
001AEE E6E7 C9              10      RET
       E6E8                     DRDC2:
001AEF E6E8 F1              10      POP AF
       E6E9                     DRDC3:
001AF0 E6E9 CDEFE6          17      CALL    DRW_FLUSH
001AF3 E6EC E1              10      POP HL
001AF4 E6ED 18C4            12      JR  SAVE_DRWC
                                
                                ;   ランダムブロックアクセスの連続したセクタをまとめたものをフラッシュする
       E6EF                     DRW_FLUSH:
001AF6 E6EF C5              11      PUSH    BC
001AF7 E6F0 D5              11      PUSH    DE
       E6F2                     DRWF_C  EQU $+1
       E6F3                     DRWF_B  EQU $+2
001AF8 E6F1 010000          10      LD  BC,0
001AFB E6F4 78               4      LD  A,B
001AFC E6F5 B7               4      OR  A
001AFD E6F6 280D            12      JR  Z,DRDF1
       E6F9                     DRWF_E  EQU $+1
       E6FA                     DRWF_D  EQU $+2
001AFF E6F8 110000          10      LD  DE,0
       E6FC                     DRWF_HL EQU $+1
001B02 E6FB 210000          10      LD  HL,0
001B05 E6FE AF               4      XOR A
001B06 E6FF 32F3E6          13      LD  (DRWF_B),A
       E703                     DRWF_MODE   EQU $+1
001B09 E702 CDF2E9          17      CALL    DRD24B
       E705                     DRDF1:
001B0C E705 D1              10      POP DE
001B0D E706 C1              10      POP BC
001B0E E707 C9              10      RET
[EOF:LDFILE2.ASM:SHIFT_JIS]
                                    INCLUDE "LDDIO.ASM"
                                
                                ;   LSX-Dodgers DIO
                                
       E708                     DRDX:
001B0F E708 CD46E7          17      CALL    DRDY
001B12 E70B C8              11      RET Z
001B13 E70C CD2CE7          17      CALL    DRDX1       ;データバッファの情報を保存
001B16 E70F D8              11      RET C
001B17 E710 E5              11      PUSH    HL
001B18 E711 C5              11      PUSH    BC
001B19 E712 D5              11      PUSH    DE
001B1A E713 2A7EF0          16      LD  HL,(_DTBUF)
001B1D E716 3A6FE7          13      LD  A,(_DBS24+1)
001B20 E719 4F               4      LD  C,A
001B21 E71A CDF0E9          17      CALL    DRD24
001B24 E71D DC41E7          17      CALL    C,DRDNE
       E720                     POP_DE_BC_HL_RET:
001B27 E720 D1              10      POP DE
001B28 E721 C1              10      POP BC
001B29 E722 E1              10      POP HL
001B2A E723 C9              10      RET
                                
                                ;   CDE:セクタ番号
       E724                     DRDN:
001B2B E724 AF               4      XOR A
001B2C E725 00               4  DRDN1:  NOP         ;自己書き換え NOP / SCF
001B2D E726 30E0            12      JR  NC,DRDX
       E728                     DRDNX:
001B2F E728 CD46E7          17      CALL    DRDY
001B32 E72B C8              11      RET Z
       E72C                     DRDX1:
001B33 E72C CD5CE7          17      CALL    DWTX
                                                ;データバッファの読み込んだドライブ・セクタ情報を保存
001B36 E72F ED53A6EF        20      LD  (_DBSEC),DE
001B3A E733 79               4      LD  A,C
001B3B E734 326FE7          13      LD  (_DBS24+1),A
                                
001B3E E737 3A88EF          13      LD  A,(_DRV)
001B41 E73A 32A5EF          13      LD  (_DBDRV),A
001B44 E73D CDD9EF          17      CALL    _CHGDRV
001B47 E740 D0              11      RET NC
       E741                     DRDNE:
001B48 E741 9F               4      SBC A,A     ;CF=1ならばA=0FFH
001B49 E742 32A5EF          13      LD  (_DBDRV),A
001B4C E745 C9              10      RET
                                
                                ;   CDE:セクタ番号
       E746                     DRDY:
001B4D E746 3A6FE7          13      LD  A,(_DBS24+1)
001B50 E749 B9               4      CP  C
001B51 E74A C0              11      RET NZ
                                
001B52 E74B E5              11      PUSH    HL
001B53 E74C 3A88EF          13      LD  A,(_DRV)
001B56 E74F 21A5EF          10      LD  HL,_DBDRV
001B59 E752 AE               7      XOR (HL)
001B5A E753 2005            12      JR  NZ,POP_HL_RET
                                
001B5C E755 2AA6EF          16      LD  HL,(_DBSEC)
001B5F E758 ED52            15      SBC HL,DE       ;CF=0
       E75A                     POP_HL_RET:
001B61 E75A E1              10      POP HL
001B62 E75B C9              10      RET
                                
       E75C                     DWTX:
001B63 E75C 3AA4EF          13      LD  A,(_WTDBF)
001B66 E75F B7               4      OR  A
001B67 E760 C8              11      RET Z
001B68 E761 AF               4      XOR A
001B69 E762 32A4EF          13      LD  (_WTDBF),A
                                
001B6C E765 E5              11      PUSH    HL
001B6D E766 C5              11      PUSH    BC
001B6E E767 D5              11      PUSH    DE
001B6F E768 3AA5EF          13      LD  A,(_DBDRV)
001B72 E76B CDD9EF          17      CALL    _CHGDRV
001B75 E76E 0E00             7  _DBS24: LD  C,0
001B77 E770 ED5BA6EF        20      LD  DE,(_DBSEC)
001B7B E774 2A7EF0          16      LD  HL,(_DTBUF)
001B7E E777 D400EA          17      CALL    NC,DWT24
       E77A                     POP_DE_BC_HL_RET2:
001B81 E77A 18A4            12      JR  POP_DE_BC_HL_RET
                                
       E77C                     RDFATX:
001B83 E77C E5              11      PUSH    HL
001B84 E77D 3A88EF          13      LD  A,(_DRV)
001B87 E780 21AAEF          10      LD  HL,_FATDRV
001B8A E783 AE               7      XOR (HL)
001B8B E784 28D4            12      JR  Z,POP_HL_RET
                                
001B8D E786 C5              11      PUSH    BC
001B8E E787 D5              11      PUSH    DE
001B8F E788 DDE5            15      PUSH    IX
001B91 E78A CDA6E7          17      CALL    WTFATX
001B94 E78D 3813            12      JR  C,POP_IX_DE_BC_HL_RET
                                
001B96 E78F AF               4      XOR A
001B97 E790 32ABEF          13      LD  (_FATIX),A
001B9A E793 3A88EF          13      LD  A,(_DRV)
001B9D E796 32AAEF          13      LD  (_FATDRV),A
001BA0 E799 CDE5EF          17      CALL    _RDFAT
       E79C                     RDFATE2:
001BA3 E79C 3004            12      JR  NC,POP_IX_DE_BC_HL_RET
001BA5 E79E 9F               4      SBC A,A     ;A=0xFF
001BA6 E79F 32AAEF          13      LD  (_FATDRV),A
       E7A2                     POP_IX_DE_BC_HL_RET:
001BA9 E7A2 DDE1            14      POP IX
001BAB E7A4 18D4            12      JR  POP_DE_BC_HL_RET2
                                
       E7A6                     WTFATX:
001BAD E7A6 3AA2EF          13      LD  A,(_WTFATF)
001BB0 E7A9 B7               4      OR  A
001BB1 E7AA C8              11      RET Z
001BB2 E7AB E5              11      PUSH    HL
001BB3 E7AC 3AAAEF          13      LD  A,(_FATDRV)
001BB6 E7AF 21A5EF          10      LD  HL,_DBDRV
001BB9 E7B2 AE               7      XOR (HL)
001BBA E7B3 CC5CE7          17      CALL    Z,DWTX
001BBD E7B6 38A2            12      JR  C,POP_HL_RET
001BBF E7B8 C5              11      PUSH    BC
001BC0 E7B9 D5              11      PUSH    DE
001BC1 E7BA DDE5            15      PUSH    IX
001BC3 E7BC CD0DEA          17      CALL    WTFAT
001BC6 E7BF AF               4      XOR A
001BC7 E7C0 32A2EF          13      LD  (_WTFATF),A
001BCA E7C3 18DD            12      JR  POP_IX_DE_BC_HL_RET
                                
       E7C5                     NCL1:
001BCC E7C5 7A               4      LD  A,D
001BCD E7C6 B3               4      OR  E
001BCE E7C7 37               4      SCF
001BCF E7C8 C8              11      RET Z
                                
001BD0 E7C9 7A               4      LD  A,D
001BD1 E7CA CB3F             8      SRL A   ;/2
001BD3 E7CC CB3F             8      SRL A   ;/2
                                
001BD5 E7CE E5              11      PUSH    HL
001BD6 E7CF 32EEE7          13      LD  (NCLPAT+2),A    ;_FATIX
001BD9 E7D2 2AAAEF          16      LD  HL,(_FATDRV)    ;L=_FATDRV H=_FATIX
001BDC E7D5 BC               4      CP  H
001BDD E7D6 3A88EF          13      LD  A,(_DRV)    ;この間でフラグは変化しない
001BE0 E7D9 32EDE7          13      LD  (NCLPAT+1),A    ;_FATDRV
001BE3 E7DC 2005            12      JR  NZ,NCL2     ;FATIXが違う
001BE5 E7DE BD               4      CP  L
001BE6 E7DF 2002            12      JR  NZ,NCL2     ;ドライブが違う
001BE8 E7E1 E1              10      POP HL
001BE9 E7E2 C9              10      RET
       E7E3                     NCL2:
001BEA E7E3 C5              11      PUSH    BC
001BEB E7E4 D5              11      PUSH    DE
001BEC E7E5 DDE5            15      PUSH    IX
001BEE E7E7 CDA6E7          17      CALL    WTFATX
001BF1 E7EA 38B6            12      JR  C,POP_IX_DE_BC_HL_RET
001BF3 E7EC 010000          10  NCLPAT: LD  BC,0        ;自己書き換え C=_FATDRV B=_FATIX
001BF6 E7EF ED43AAEF        20      LD  (_FATDRV),BC
001BFA E7F3 CDE2E9          17      CALL    RDFATS
001BFD E7F6 18A4            12      JR  RDFATE2
                                
       E7F8                     NCL3:
001BFF E7F8 CB9A             8      RES 3,D
001C01 E7FA CB92             8      RES 2,D
001C03 E7FC 6B               4      LD  L,E
001C04 E7FD 62               4      LD  H,D
001C05 E7FE CB3C             8      SRL H   ;
001C07 E800 CB1D             8      RR  L   ;HLA=HLA/2
001C09 E802 1F               4      RRA     ;
001C0A E803 F5              11      PUSH    AF
001C0B E804 3AABEF          13      LD  A,(_FATIX)
001C0E E807 0F               4      RRCA
001C0F E808 300B            12      JR  NC,NCL3X1
001C11 E80A 3A1CE6          13      LD  A,(SECSZ+2)
001C14 E80D FE04             7      CP  4       ;1セクタ1024バイトの場合は奇数インデックスの場合に先頭を512バイトずらす
001C16 E80F 2004            12      JR  NZ,NCL3X1
001C18 E811 010002          10      LD  BC,512
001C1B E814 09              11      ADD HL,BC
       E815                     NCL3X1:
001C1C E815 F1              10      POP AF
001C1D E816 ED4B7CF0        20      LD  BC,(_FATBF)
001C21 E81A 19              11      ADD HL,DE
001C22 E81B 09              11      ADD HL,BC
001C23 E81C 17               4      RLA
001C24 E81D C9              10      RET
                                
       E81E                     GNCL:
001C25 E81E CDC5E7          17      CALL    NCL1        ;GET NEXT CLUSTER
001C28 E821 D8              11      RET C
001C29 E822 C5              11      PUSH    BC
001C2A E823 E5              11      PUSH    HL
001C2B E824 CDF8E7          17      CALL    NCL3
001C2E E827 3809            12      JR  C,GNC1
001C30 E829 5E               7      LD  E,(HL)
001C31 E82A 23               6      INC HL
001C32 E82B 7E               7      LD  A,(HL)
001C33 E82C E60F             7      AND 00FH
001C35 E82E 57               4      LD  D,A
001C36 E82F E1              10      POP HL
001C37 E830 C1              10      POP BC
001C38 E831 C9              10      RET
       E832                     GNC1:
001C39 E832 7E               7      LD  A,(HL)
001C3A E833 23               6      INC HL
001C3B E834 56               7      LD  D,(HL)
001C3C E835 0604             7      LD  B,4
       E837                     GNC1L:
001C3E E837 CB3A             8      SRL D   ;DA=DA/2
001C40 E839 1F               4      RRA     ;
001C41 E83A 10FB            13      DJNZ    GNC1L
                                
001C43 E83C 5F               4      LD  E,A
001C44 E83D E1              10      POP HL
001C45 E83E C1              10      POP BC
001C46 E83F A7               4      AND A
001C47 E840 C9              10      RET
                                
       E841                     SNCL:
001C48 E841 CDC5E7          17      CALL    NCL1
001C4B E844 D8              11      RET C
                                ;               SET NEXT CLUSTER
001C4C E845 E5              11      PUSH    HL
001C4D E846 C5              11      PUSH    BC
001C4E E847 D5              11      PUSH    DE
001C4F E848 E5              11      PUSH    HL
001C50 E849 CDF8E7          17      CALL    NCL3
001C53 E84C D1              10      POP DE
                                ;CF=ODD
001C54 E84D 7E               7      LD  A,(HL)
001C55 E84E 73               7      LD  (HL),E
001C56 E84F 3806            12      JR  C,SNC1
                                ;EVEN
                                ;M[0] = E
                                ;M[1] = (M[1] & 0xF0) | (D & 0x0F)
001C58 E851 23               6      INC HL
001C59 E852 ED67            18      RRD     ;M={A[3:0],E[3:0]}
001C5B E854 7A               4      LD  A,D
001C5C E855 1804            12      JR  SNC11
       E857                     SNC1:
                                ;ODD
                                ;HL[0] = (HL[0]&0x0F) | (E<<4)
                                ;HL[1] = DE>>4
001C5E E857 ED6F            18      RLD     ;M={D[3:0],E[7:4]}
001C60 E859 23               6      INC HL
001C61 E85A 72               7      LD  (HL),D  ;M={D[3:0],E[7:4]}
       E85B                     SNC11:
001C62 E85B ED6F            18      RLD     ;M={M[7:4],D[3:0]}
001C64 E85D B7               4      OR  A
001C65 E85E D1              10      POP DE
001C66 E85F C1              10      POP BC
001C67 E860 E1              10      POP HL
       E861                     FAT_CHANGED:
001C68 E861 3E01             7      LD  A,1
001C6A E863 32A2EF          13      LD  (_WTFATF),A
001C6D E866 C9              10      RET
                                
       E867                     N16CL3:
001C6E E867 C5              11      PUSH    BC
001C6F E868 6B               4      LD  L,E
001C70 E869 7A               4      LD  A,D
001C71 E86A E603             7      AND 3
001C73 E86C 67               4      LD  H,A
001C74 E86D 29              11      ADD HL,HL
001C75 E86E ED4B7CF0        20      LD  BC,(_FATBF)
001C79 E872 09              11      ADD HL,BC
001C7A E873 C1              10      POP BC
001C7B E874 C9              10      RET
                                
       E875                     GNCL16:
001C7C E875 CDC5E7          17      CALL    NCL1        ;GET NEXT CLUSTER for FAT16
001C7F E878 D8              11      RET C
001C80 E879 E5              11      PUSH    HL
001C81 E87A CD67E8          17      CALL    N16CL3
001C84 E87D 5E               7      LD  E,(HL)
001C85 E87E 23               6      INC HL
001C86 E87F 56               7      LD  D,(HL)
001C87 E880 E1              10      POP HL
001C88 E881 C9              10      RET
                                
       E882                     SNCL16:
001C89 E882 CDC5E7          17      CALL    NCL1        ;GET NEXT CLUSTER for FAT16
001C8C E885 D8              11      RET C
001C8D E886 D5              11      PUSH    DE
001C8E E887 E5              11      PUSH    HL
001C8F E888 CD67E8          17      CALL    N16CL3
001C92 E88B D1              10      POP DE      ;HL
001C93 E88C 73               7      LD  (HL),E
001C94 E88D 23               6      INC HL
001C95 E88E 72               7      LD  (HL),D
001C96 E88F 6B               4      LD  L,E
001C97 E890 62               4      LD  H,D
001C98 E891 D1              10      POP DE
001C99 E892 18CD            12      JR  FAT_CHANGED
                                
                                ;------------------------
                                ;次のセクタを探す際に_SECPSの値をチェック
                                ;in
                                ;   DE : セクタ番号
                                ;out
                                ;   DE : 次のセクタ番号
                                ;note
                                ;
                                ;------------------------
       E894                     NEXTX:
001C9B E894 3E00             7  _SECPS: LD  A,0 ;自己書き換え
001C9D E896 3C               4      INC A
001C9E E897 E600             7  NCPAT:  AND 0   ;自己書き換え　1クラスタの論理セクタ数-1
001CA0 E899 3295E8          13      LD  (_SECPS+1),A
001CA3 E89C C9              10      RET
                                
       E89D                     GNCLX:
001CA4 E89D CD94E8          17      CALL    NEXTX
001CA7 E8A0 C0              11      RET NZ  ;1クラスタのセクタ未満の場合は戻る
001CA8 E8A1 C3F7EF          10      JP  _GNCL   ;次のクラスタを探す
                                
       E8A4                     RDFAT:
001CAB E8A4 3E80             7      LD  A,080H
001CAD E8A6 3270EF          13      LD  (CHECK),A
       E8A9                     RDFAT1:
001CB0 E8A9 3A88EF          13      LD  A,(_DRV)
001CB3 E8AC CD38EB          17      CALL    CHGDRVR
001CB6 E8AF D8              11      RET C
001CB7 E8B0 DD7E12          19      LD  A,(IX+012H) ;DPB_12_DEVICE
001CBA E8B3 CB6F             8      BIT 5,A
001CBC E8B5 2843            12      JR  Z,RDFAT0X
001CBE E8B7 2170EF          10      LD  HL,CHECK
001CC1 E8BA A6               7      AND (HL)
001CC2 E8BB 77               7      LD  (HL),A
001CC3 E8BC 110000          10      LD  DE,0        ;BPB
001CC6 E8BF 2A7CF0          16      LD  HL,(_FATBF)
001CC9 E8C2 CDEEE9          17      CALL    DRD16
001CCC E8C5 3024            12      JR  NC,GETBPB
001CCE E8C7 2170EF          10      LD  HL,CHECK
001CD1 E8CA CB06            15      RLC (HL)
001CD3 E8CC 3F               4      CCF
001CD4 E8CD D8              11      RET C
001CD5 E8CE DDCB0A1E        23      RR  (IX+00AH)   ;DPB_0A_FDMODE
001CD9 E8D2 3F               4      CCF         ;フロッピーディスクのMFMモードを切り替える
001CDA E8D3 DDCB0A16        23      RL  (IX+00AH)   ;DPB_0A_FDMODE
001CDE E8D7 3EFF             7      LD  A,0FFH
001CE0 E8D9 3289EF          13      LD  (_DSK),A
001CE3 E8DC 3A84EF          13      LD  A,(_DRIVE)
001CE6 E8DF E603             7      AND 3
001CE8 E8E1 F680             7      OR  080H
001CEA E8E3 6F               4      LD  L,A
001CEB E8E4 26EF             7      LD  H,_CYL0/256
001CED E8E6 3EFF             7      LD  A,0FFH
001CEF E8E8 77               7      LD  (HL),A
001CF0 E8E9 18BE            12      JR  RDFAT1
       E8EB                     GETBPB:
001CF2 E8EB FDE5            15      PUSH    IY
001CF4 E8ED FD2A7CF0        20      LD  IY,(_FATBF) ;BPB
001CF8 E8F1 CDF1EF          17      CALL    _BPB2DPB
001CFB E8F4 FDE1            14      POP IY
001CFD E8F6 D8              11      RET C
001CFE E8F7 CD96EA          17      CALL    CHGDRV2
       E8FA                     RDFAT0X:
001D01 E8FA CDE2E9          17      CALL    RDFATS
001D04 E8FD D8              11      RET C
001D05 E8FE DDBE06           7      CP  (IX+6)      ;DPB_06_FATID
001D08 E901 C8              11      RET Z
001D09 E902 DDCB126E        20      BIT 5,(IX+012H) ;DPB_12_DEVICE
001D0D E906 C0              11      RET NZ      ;BPBを取得している場合はFATIDをチェックしない
001D0E E907 37               4      SCF
001D0F E908 C9              10      RET
                                
       E909                     BPB2DPB:
001D10 E909 FD7E0B          19      LD  A,(IY+11)   ;BPB_BytsPerSec
001D13 E90C B7               4      OR  A
001D14 E90D 37               4      SCF
001D15 E90E C0              11      RET NZ
       E90F                     BPBOK:
001D16 E90F FD7E0D          19      LD  A,(IY+13)   ;BPB_SecPerClus
001D19 E912 DD7707          19      LD  (IX+7),A    ;DPB_07_SECPCL
                                
001D1C E915 FD7E16          19      LD  A,(IY+22)   ;BPB_FATSz16
001D1F E918 DD7700          19      LD  (IX+0),A    ;DPB_00_FATLN
001D22 E91B FD7E17          19      LD  A,(IY+23)   ;BPB_FATSz16
001D25 E91E DD7701          19      LD  (IX+1),A    ;DPB_00_FATLN
                                
001D28 E921 FD6E0E          19      LD  L,(IY+14)   ;BPB_RsvdSecCnt
001D2B E924 FD660F          19      LD  H,(IY+15)
001D2E E927 DD750E          19      LD  (IX+00EH),L ;DPB_0E_FATPS
001D31 E92A FD5E16          19      LD  E,(IY+22)   ;BPB_FATSz16
001D34 E92D FD5617          19      LD  D,(IY+23)
001D37 E930 FD4610          19      LD  B,(IY+16)   ;BPB_NumFATs
       E933                     BPBDP1:             ;BPB_FATSz16 * BPB_NumFATs
001D3A E933 19              11      ADD HL,DE
001D3B E934 10FD            13      DJNZ    BPBDP1
       E936                     BPBDP2:
001D3D E936 DD7510          19      LD  (IX+010H),L ;DPB_10_DIRPS
001D40 E939 DD7411          19      LD  (IX+011H),H
001D43 E93C E5              11      PUSH    HL
                                
001D44 E93D FD6E11          19      LD  L,(IY+17)   ;BPB_RootEntCnt
001D47 E940 FD6612          19      LD  H,(IY+18)
001D4A E943 FD7E0C          19      LD  A,(IY+12)   ;BPB_BytsPerSec
001D4D E946 B7               4      OR  A
001D4E E947 37               4      SCF
001D4F E948 C8              11      RET Z
001D50 E949 0606             7      LD  B,6
       E94B                     BPBBPS1:
001D52 E94B 05               4      DEC B
001D53 E94C 0F               4      RRCA
001D54 E94D 30FC            12      JR  NC,BPBBPS1
       E94F                     BPBDE1:
001D56 E94F 29              11      ADD HL,HL
001D57 E950 10FD            13      DJNZ    BPBDE1
                                
001D59 E952 7C               4      LD  A,H
001D5A E953 DD770B          19      LD  (IX+00BH),A ;DPB_0B_DIRSCNT
                                
001D5D E956 D1              10      POP DE      ;DPB_10_DIRPS
001D5E E957 6C               4      LD  L,H
001D5F E958 2600             7      LD  H,0
001D61 E95A 19              11      ADD HL,DE       ;MAXDIR
001D62 E95B E5              11      PUSH    HL
001D63 E95C FD4E0D          19      LD  C,(IY+13)   ;BPB_SecPerClus
001D66 E95F CB21             8      SLA C       ;*2
001D68 E961 AF               4      XOR A
001D69 E962 47               4      LD  B,A
001D6A E963 ED42            15      SBC HL,BC
001D6C E965 DD7514          19      LD  (IX+014H),L ;DPB_14_ADDCL16
001D6F E968 DD7415          19      LD  (IX+015H),H
                                
001D72 E96B D1              10      POP DE      ;DE=DPB_0B_MAXDIR
001D73 E96C FD6E13          19      LD  L,(IY+19)   ;BPB_TotSec16
001D76 E96F FD6614          19      LD  H,(IY+20)
                                
001D79 E972 DDCB0A7E        20      BIT 7,(IX+00AH) ;DPB_0A_FDMODE
001D7D E976 2817            12      JR  Z,NOT_FD
001D7F E978 E5              11      PUSH    HL
001D80 E979 FD4E18          19      LD  C,(IY+24)   ;BPB_SecPerTr
001D83 E97C DD710D          19      LD  (IX+00DH),C ;DPB_0D_MAXSEC
001D86 E97F AF               4      XOR A
001D87 E980 47               4      LD  B,A
001D88 E981 CB21             8      SLA C       ;両面なのでセクタ数を２倍
001D8A E983 2B               6      DEC HL
       E984                     CNTSEC:             ;MAXCYL = BPB_TotSec16 / (BPB_SecPerTr * 2)
001D8B E984 3C               4      INC A
001D8C E985 2804            12      JR  Z,CNTSECE
001D8E E987 ED42            15      SBC HL,BC
001D90 E989 30F9            12      JR  NC,CNTSEC
       E98B                     CNTSECE:
001D92 E98B DD770C          19      LD  (IX+00CH),A ;DPB_0C_MAXCYL
001D95 E98E E1              10      POP HL  ;ここまでフロッピー専用
       E98F                     NOT_FD:
001D96 E98F 7C               4      LD  A,H
001D97 E990 B5               4      OR  L
001D98 E991 3E00             7      LD  A,0     ;LDでフラグは変化しない。BPB_TotSec16を AHL で扱う為、Aに0を入れる
001D9A E993 2010            12      JR  NZ,BPB16BIT ;BPB_TotSec16が「0」の場合はBPB_TotSec32で計算
001D9C E995 FD7E23          19      LD  A,(IY+35)   ;念のために総セクタ数が24ビットを超える場合はエラーを返す
001D9F E998 B7               4      OR  A
001DA0 E999 37               4      SCF
001DA1 E99A C0              11      RET NZ
001DA2 E99B FD6E20          19      LD  L,(IY+32)   ;BPB_TotSec32 は AHL の24ビットで扱う
001DA5 E99E FD6621          19      LD  H,(IY+33)   ;1クラスタの論理セクタ数(DPB_07_SECPCL)が最大128なので
001DA8 E9A1 FD7E22          19      LD  A,(IY+34)   ;24ビットを超えると必ずクラスタ数が16ビットを超えてしまうのでこれで十分
001DAB E9A4 A7               4      AND A       ;CF=0
       E9A5                     BPB16BIT:
001DAC E9A5 ED52            15      SBC HL,DE
001DAE E9A7 DE00             7      SBC A,0
001DB0 E9A9 FD460D          19      LD  B,(IY+13)   ;BPB_SecPerClus
       E9AC                     BPBTC1:             ;総クラスタ数(AHL) = 総セクタ数(AHL) / セクタサイズ(B)
001DB3 E9AC CB18             8      RR  B       ;->CY
001DB5 E9AE 3808            12      JR  C,BPBTC2
001DB7 E9B0 CB3F             8      SRL A
001DB9 E9B2 CB1C             8      RR  H       ;AHL=AHL/2
001DBB E9B4 CB1D             8      RR  L
001DBD E9B6 18F4            12      JR  BPBTC1
       E9B8                     BPBTC2:
001DBF E9B8 B7               4      OR  A
001DC0 E9B9 37               4      SCF
001DC1 E9BA C0              11      RET NZ      ;念のため(クラスタ数が16ビットを超える場合)
001DC2 E9BB 23               6      INC HL
001DC3 E9BC 23               6      INC HL
001DC4 E9BD DD7508          19      LD  (IX+8),L    ;DPB_08_MAXCL
001DC7 E9C0 DD7409          19      LD  (IX+9),H
                                
001DCA E9C3 FD7E15          19      LD  A,(IY+21)   ;BPB_Media
001DCD E9C6 DD7706          19      LD  (IX+6),A    ;DPB_06_FATID
                                
001DD0 E9C9 FD7E10          19      LD  A,(IY+16)   ;BPB_NumFATs
001DD3 E9CC C6FE             7      ADD A,0-2       ;>2:CF=1
001DD5 E9CE FD7E0C          19      LD  A,(IY+12)   ;BPB_BytsPerSec
001DD8 E9D1 6F               4      LD  L,A
001DD9 E9D2 3002            12      JR  NC,BPBFAT1
001DDB E9D4 F680             7      OR  080H
       E9D6                     BPBFAT1:
001DDD E9D6 DD770F          19      LD  (IX+00FH),A ;DPB_0F_BPS
001DE0 E9D9 2D               4      DEC L       ;以下のセクタサイズに合致しない場合はCF=1でエラーにする
001DE1 E9DA C8              11      RET Z       ;1セクタ256バイト
001DE2 E9DB 2D               4      DEC L
001DE3 E9DC C8              11      RET Z       ;1セクタ512バイト
001DE4 E9DD 2D               4      DEC L
001DE5 E9DE 2D               4      DEC L
001DE6 E9DF C8              11      RET Z       ;1セクタ1024バイト
001DE7 E9E0 37               4      SCF
001DE8 E9E1 C9              10      RET
                                
       E9E2                     RDFATS:
001DE9 E9E2 CD28EA          17      CALL    FATSETUP
001DEC E9E5 D8              11      RET C
001DED E9E6 CDF2E9          17      CALL    DRD24B
001DF0 E9E9 2A7CF0          16      LD  HL,(_FATBF)
001DF3 E9EC 7E               7      LD  A,(HL)
001DF4 E9ED C9              10      RET
                                
       E9EE                     DRD16:
001DF5 E9EE 0E00             7      LD  C,0
       E9F0                     DRD24:
001DF7 E9F0 0601             7      LD  B,1
       E9F2                     DRD24B:
001DF9 E9F2 DDE5            15      PUSH    IX
001DFB E9F4 DD2AA8EF        20      LD  IX,(_DPB)
001DFF E9F8 CDCDEC          17  DRDPAT: CALL    FDRD        ;自己書き換え（ディスク読み込み）
       E9FB                     POP_IX_RET:
001E02 E9FB DDE1            14      POP IX
001E04 E9FD C9              10      RET
                                
       E9FE                     DWT16:
001E05 E9FE 0E00             7      LD  C,0
       EA00                     DWT24:
001E07 EA00 0601             7      LD  B,1
       EA02                     DWT24B:
001E09 EA02 DDE5            15      PUSH    IX
001E0B EA04 DD2AA8EF        20      LD  IX,(_DPB)
001E0F EA08 CD31EC          17  DWTPAT: CALL    FDWT        ;自己書き換え（ディスク書き込み）
001E12 EA0B 18EE            12      JR  POP_IX_RET
                                
       EA0D                     WTFAT:
001E14 EA0D CD28EA          17      CALL    FATSETUP
001E17 EA10 D402EA          17      CALL    NC,DWT24B
001E1A EA13 D8              11      RET C
001E1B EA14 DDCB0F7E        20      BIT 7,(IX+00FH) ;DPB_0F_BPS
001E1F EA18 C8              11      RET Z       ;予備FATが無い
001E20 EA19 CD2FEA          17      CALL    FATS2
001E23 EA1C E5              11      PUSH    HL      ;予備FAT
001E24 EA1D DD6E00          19      LD  L,(IX+0)    ;DPB_00_FATLN
001E27 EA20 DD6601          19      LD  H,(IX+1)
001E2A EA23 19              11      ADD HL,DE
001E2B EA24 EB               4      EX  DE,HL
001E2C EA25 E1              10      POP HL
001E2D EA26 18DA            12      JR  DWT24B
                                ;------------------------
                                ;FATのセットアップ
                                ;out
                                ;   B  : FATセクタ数
                                ;   DE : FAT先頭セクタ番号
                                ;   HL : FATバッファポインタ
                                ;   CF : 1=ドライブ切り替えエラー
                                ;note
                                ;   FATサイズがFATバッファを超える場合は
                                ;   対象クラスタ領域==(_FATIX)によって
                                ;   FAT12:対象クラスタ1024毎に1.5KBを切り替える
                                ;   FAT16:対象クラスタ1024毎に2KBを切り替える
                                ;------------------------
       EA28                     FATSETUP:
001E2F EA28 3AAAEF          13      LD  A,(_FATDRV)
001E32 EA2B CD38EB          17      CALL    CHGDRVR     ;ドライブ切り替え
001E35 EA2E D8              11      RET C
       EA2F                     FATS2:
001E36 EA2F DD7E0F          19      LD  A,(IX+00FH) ;DPB_0F_BPS 512=2 1024=4
001E39 EA32 0F               4      RRCA
001E3A EA33 CD5CEA          17  FATSX:  CALL    FATSETUP12  ;自己書き換え
001E3D EA36 210000          10      LD  HL,0
001E40 EA39 4A               4      LD  C,D
001E41 EA3A 54               4      LD  D,H
001E42 EA3B 3AABEF          13      LD  A,(_FATIX)  ;範囲FAT12:0-3/FAT16:0-63(0-03FH):65535*2/2048
001E45 EA3E 47               4      LD  B,A
001E46 EA3F 04               4      INC B
001E47 EA40 DD7E00          19      LD  A,(IX+0)    ;DPB_00_FATLN
       EA43                     FAT_SKP:
001E4A EA43 05               4      DEC B
001E4B EA44 2805            12      JR  Z,FAT1
001E4D EA46 19              11      ADD HL,DE
001E4E EA47 93               4      SUB E
001E4F EA48 30F9            12      JR  NC,FAT_SKP
001E51 EA4A C9              10      RET
       EA4B                     FAT1:
001E52 EA4B EB               4      EX  DE,HL
001E53 EA4C B9               4      CP  C       ;C=FATバッファに読み込めるセクタ数
001E54 EA4D 3801            12      JR  C,FAT2
001E56 EA4F 79               4      LD  A,C
       EA50                     FAT2:
001E57 EA50 47               4      LD  B,A
                                
001E58 EA51 2AFAF0          16      LD  HL,(_FATPS) ;fat sector pos
001E5B EA54 19              11      ADD HL,DE
001E5C EA55 EB               4      EX  DE,HL
001E5D EA56 2A7CF0          16      LD  HL,(_FATBF)
001E60 EA59 AF               4      XOR A       ;CF=0
001E61 EA5A 4F               4      LD  C,A
001E62 EA5B C9              10      RET
                                ;
                                ;   FATバッファに読み込める最大のセクタ数と_FATIXで進めるセクタ数
                                ;   FATSETUP* (FAT12/FAT16)
                                ;out
                                ;   D : FATバッファに読み込める最大のセクタ数
                                ;   E : _FATIXで進めるセクタ数
       EA5C                     FATSETUP12:
001E63 EA5C 110606          10      LD  DE,0606H    ;256
001E66 EA5F D8              11      RET C
001E67 EA60 110303          10      LD  DE,0303H    ;512
001E6A EA63 0F               4      RRCA
001E6B EA64 D8              11      RET C
001E6C EA65 110102          10      LD  DE,0201H    ;1024
001E6F EA68 C9              10      RET
                                
       EA69                     FATSETUP16:
001E70 EA69 110808          10      LD  DE,0808H    ;256
001E73 EA6C D8              11      RET C
001E74 EA6D 110404          10      LD  DE,0404H
001E77 EA70 0F               4      RRCA            ;512
001E78 EA71 D8              11      RET C
001E79 EA72 110202          10      LD  DE,0202H    ;1024
001E7C EA75 C9              10      RET
                                
       EA76                     CHGDRV:
001E7D EA76 E5              11      PUSH    HL
001E7E EA77 2189EF          10      LD  HL,_DSK
001E81 EA7A BE               7      CP  (HL)
001E82 EA7B 280A            12      JR  Z,CHGDRVE
       EA7D                     CHGDRV1:
001E84 EA7D DDE5            15      PUSH    IX
001E86 EA7F CD89EA          17      CALL    CHGDRV0
001E89 EA82 3A89EF          13      LD  A,(_DSK)
001E8C EA85 DDE1            14      POP IX
       EA87                     CHGDRVE:
001E8E EA87 E1              10      POP HL
001E8F EA88 C9              10      RET
                                
       EA89                     CHGDRV0:
001E90 EA89 6F               4      LD  L,A
001E91 EA8A CDDCEF          17      CALL    _GETDPB
001E94 EA8D D8              11      RET C
001E95 EA8E DD22A8EF        20      LD  (_DPB),IX
001E99 EA92 7D               4      LD  A,L
001E9A EA93 3289EF          13      LD  (_DSK),A
       EA96                     CHGDRV2:
001E9D EA96 C5              11      PUSH    BC
001E9E EA97 D5              11      PUSH    DE
001E9F EA98 ED73EDEA        20      LD  (SPPAT2+1),SP
001EA3 EA9C F3               4      DI
001EA4 EA9D DDF9            10      LD  SP,IX
                                
001EA6 EA9F E1              10      POP HL      ;DPB_00_FATLN
001EA7 EAA0 E1              10      POP HL      ;DPB_02_DRD
001EA8 EAA1 22F9E9          16      LD  (DRDPAT+1),HL
                                
001EAB EAA4 E1              10      POP HL
001EAC EAA5 2209EA          16      LD  (DWTPAT+1),HL   ;DPB_04_DWT
                                
001EAF EAA8 E1              10      POP HL      ;L=DPB_06_FATID H=DPB_07_SECPCL
001EB0 EAA9 7C               4      LD  A,H
001EB1 EAAA 3232E1          13      LD  (SPCPAT+1),A    ;1クラスタの論理セクタ数
001EB4 EAAD 3D               4      DEC A
001EB5 EAAE 3298E8          13      LD  (NCPAT+1),A
                                
001EB8 EAB1 E1              10      POP HL      ;DPB_08_MAXCL
001EB9 EAB2 7D               4      LD  A,L
001EBA EAB3 3251E1          13      LD  (CLPAT2+1),A
001EBD EAB6 7C               4      LD  A,H
001EBE EAB7 324DE1          13      LD  (CLPAT1+1),A
001EC1 EABA 2B               6      DEC HL
001EC2 EABB 2255E3          16      LD  (MAXCLP+1),HL
                                
001EC5 EABE E1              10      POP HL      ;L=DPB_0A_FDMODE H=DPB_0B_DIRSCNT
001EC6 EABF 7D               4      LD  A,L
001EC7 EAC0 F6FE             7      OR  0FEH
001EC9 EAC2 3269EF          13      LD  (FDMODE+1),A
001ECC EAC5 07               4      RLCA
001ECD EAC6 E603             7      AND 3
001ECF EAC8 326BEF          13      LD  (FSPAT+1),A
001ED2 EACB 4C               4      LD  C,H
                                
001ED3 EACC E1              10      POP HL      ;L=DPB_0C_MAXCYL H=DPB_0D_MAXSEC
                                
001ED4 EACD E1              10      POP HL      ;L=DPB_0E_FATPS H=DPB_0F_BPS
001ED5 EACE 7C               4      LD  A,H     ;DPB_0F_BPS
001ED6 EACF E607             7      AND 7
001ED8 EAD1 321CE6          13      LD  (SECSZ+2),A ;1セクタのサイズの上位1バイト 0x400 - 0x200 - 0x100
                                                ;1セクタ512 2D/2DD/2HC/2HQ(2HD1.44MB)/EMM/BRAM等
                                                ;1セクタ1024 2HD/2HDE98
                                                ;1セクタ256 GRAM/RAMF/CMOS/等
                                                ;1024   512 256
                                                ;4  2   1
001EDB EAD4 87               4      ADD A,A     ;8  4   2
001EDC EAD5 87               4      ADD A,A     ;010H   8   4
001EDD EAD6 87               4      ADD A,A     ;020H   010H    8
001EDE EAD7 32AEDF          13      LD  (SDECPAT+1),A   ;1セクタ辺りのディレクトリエントリ数
                                
001EE1 EADA 2600             7      LD  H,0
001EE3 EADC 22FAF0          16      LD  (_FATPS),HL
                                
001EE6 EADF E1              10      POP HL      ;L=DPB_10_DIRPS
001EE7 EAE0 22FCF0          16      LD  (_DIRPS),HL
                                
001EEA EAE3 E1              10      POP HL      ;L=DPB_12_DEVICE H=DPB_13_UNITNO
001EEB EAE4 7C               4      LD  A,H
001EEC EAE5 3284EF          13      LD  (_DRIVE),A
                                
001EEF EAE8 E1              10      POP HL      ;DPB_14_ADDCL16
001EF0 EAE9 2242E1          16      LD  (CLSPAT+1),HL
                                
001EF3 EAEC 310000          10  SPPAT2: LD  SP,0        ;元のSPを復元
001EF6 EAEF FB               4      EI
001EF7 EAF0 2AFCF0          16      LD  HL,(_DIRPS)
001EFA EAF3 0600             7      LD  B,0
001EFC EAF5 09              11      ADD HL,BC
001EFD EAF6 22C9DF          16      LD  (MD_PAT+1),HL
                                
001F00 EAF9 2A55E3          16      LD  HL,(MAXCLP+1);
001F03 EAFC 11F60F          10      LD  DE,4086
001F06 EAFF B7               4      OR  A
001F07 EB00 ED52            15      SBC HL,DE
001F09 EB02 300F            12      JR  NC,SETFAT16
001F0B EB04 211EE8          10      LD  HL,GNCL     ;FAT12
001F0E EB07 1141E8          10      LD  DE,SNCL
001F11 EB0A 015CEA          10      LD  BC,FATSETUP12
001F14 EB0D DDCB0FAE        23      RES 5,(IX+00FH) ;DPB_0F_BPS(FAT12)
001F18 EB11 180D            12      JR  EXTRA1
       EB13                     SETFAT16:
001F1A EB13 2175E8          10      LD  HL,GNCL16   ;FAT16
001F1D EB16 1182E8          10      LD  DE,SNCL16
001F20 EB19 0169EA          10      LD  BC,FATSETUP16
001F23 EB1C DDCB0FEE        23      SET 5,(IX+00FH) ;DPB_0F_BPS(FAT16)
       EB20                     EXTRA1:
001F27 EB20 22F8EF          16      LD  (GNCPAT+1),HL
001F2A EB23 ED53FBEF        20      LD  (SNCPAT+1),DE
001F2E EB27 ED4334EA        20      LD  (FATSX+1),BC
001F32 EB2B D1              10      POP DE
001F33 EB2C C1              10      POP BC
001F34 EB2D AF               4      XOR A
001F35 EB2E C9              10      RET
                                
       EB2F                     GETDPBD:
001F36 EB2F DDE3            23      EX  (SP),IX
001F38 EB31 DDE5            15      PUSH    IX
001F3A EB33 3A88EF          13      LD  A,(_DRV)
001F3D EB36 1807            12      JR  GETDPB1
                                
       EB38                     CHGDRVR:
001F3F EB38 CDD9EF          17      CALL    _CHGDRV
001F42 EB3B D8              11      RET C
001F43 EB3C 3A89EF          13      LD  A,(_DSK)
       EB3F                     GETDPB1:
001F46 EB3F C3DCEF          10      JP  _GETDPB
                                
       EB42                     GETDPB:
001F49 EB42 FE08             7      CP  8
001F4B EB44 3F               4      CCF
001F4C EB45 D8              11      RET C
001F4D EB46 0F               4      RRCA
001F4E EB47 0F               4      RRCA
001F4F EB48 0F               4      RRCA
001F50 EB49 DD                      DB  0DDH        ;Z80未定義命令
001F51 EB4A 6F               4      LD  L,A     ;LD IXL,A
001F52 EB4B DD                      DB  0DDH        ;Z80未定義命令
001F53 EB4C 26F1             7      LD  H,DEVICE/256    ;LD IXH,DEVICE/256
001F55 EB4E DD7E00          19      LD  A,(IX+0)    ;DPB_00_FATLN
001F58 EB51 B7               4      OR  A       ;CF=0の為
001F59 EB52 DDCB0F6E        20      BIT 5,(IX+00FH) ;DPB_0F_BPS
001F5D EB56 C0              11      RET NZ      ;FAT16
001F5E EB57 DDCB126E        20      BIT 5,(IX+012H) ;DPB_12_DEVICE
001F62 EB5B C0              11      RET NZ      ;BPB
001F63 EB5C FE01             7      CP  001H        ;A=0 THEN CF=1
001F65 EB5E C9              10      RET
                                
       EB5F                     _SYS5F:
001F66 EB5F AF               4      XOR A
       EB60                     FFLUSH:
001F67 EB60 F5              11      PUSH    AF
001F68 EB61 3EFF             7      LD  A,0FFH
001F6A EB63 3239EF          13      LD  (SFILE),A
001F6D EB66 CD5CE7          17      CALL    DWTX
001F70 EB69 3EFF             7      LD  A,0FFH
001F72 EB6B 32A5EF          13      LD  (_DBDRV),A
001F75 EB6E CDA6E7          17      CALL    WTFATX
001F78 EB71 AF               4      XOR A
001F79 EB72 32ABEF          13      LD  (_FATIX),A
001F7C EB75 2F               4      CPL
001F7D EB76 32AAEF          13      LD  (_FATDRV),A
001F80 EB79 F1              10      POP AF
001F81 EB7A C9              10      RET
                                
[EOF:LDDIO.ASM:SHIFT_JIS]
                                    INCLUDE "88DISK.ASM"
                                
                                ;   LSX-Dodgers DISK
                                ;   PC-8801mkIISR
                                
                                ;   FLOPPY DISK DRIVER
                                ;
                                ;   コマンド送信
       EB7B                     PUTCOM:
001F82 EB7B F5              11      PUSH    AF
001F83 EB7C 3E0F             7      LD  A,00FH
001F85 EB7E D3FF            11      OUT (0FFH),A    ;ディスクサブシステムI/F 8255 コントロール
001F87 EB80 F1              10      POP AF
                                ;   通常ハンドシェイク（ホストが送信）
       EB81                     PUTDAT:
001F88 EB81 F5              11      PUSH    AF
       EB82                     PUTDAT1:
001F89 EB82 DBFE            11      IN  A,(0FEH)    ;ディスクサブシステムI/F 8255 ポートC
001F8B EB84 E602             7      AND 2       ;RFD
001F8D EB86 28FA            12      JR  Z,PUTDAT1
001F8F EB88 3E0E             7      LD  A,00EH      ;ATN=0
001F91 EB8A D3FF            11      OUT (0FFH),A    ;ディスクサブシステムI/F 8255 コントロール
001F93 EB8C F1              10      POP AF
001F94 EB8D D3FD            11      OUT (0FDH),A    ;標準状態ではサブシステムへのデータ送信ポート
001F96 EB8F F5              11      PUSH    AF
001F97 EB90 3E09             7      LD  A,9     ;DAV=1
001F99 EB92 D3FF            11      OUT (0FFH),A
       EB94                     PUTDAT2:
001F9B EB94 DBFE            11      IN  A,(0FEH)    ;ディスクサブシステムI/F 8255 ポートC
001F9D EB96 E604             7      AND 4       ;DAC
001F9F EB98 28FA            12      JR  Z,PUTDAT2
                                
001FA1 EB9A 3E08             7      LD  A,8     ;DAV=0
001FA3 EB9C D3FF            11      OUT (0FFH),A
       EB9E                     PUTDAT3:
001FA5 EB9E DBFE            11      IN  A,(0FEH)    ;ディスクサブシステムI/F 8255 ポートC
001FA7 EBA0 E604             7      AND 4       ;DAC
001FA9 EBA2 20FA            12      JR  NZ,PUTDAT3
001FAB EBA4 F1              10      POP AF
001FAC EBA5 C9              10      RET
                                
                                ;   通常ハンドシェイク（ホストが受信）
       EBA6                     GETDAT:
001FAD EBA6 3E0B             7      LD  A,00BH      ;RFD=1
001FAF EBA8 D3FF            11      OUT (0FFH),A    ;ディスクサブシステムI/F 8255 コントロール
       EBAA                     GETDAT1:
001FB1 EBAA DBFE            11      IN  A,(0FEH)    ;ディスクサブシステムI/F 8255 ポートC
001FB3 EBAC 0F               4      RRCA            ;DAV
001FB4 EBAD 30FB            12      JR  NC,GETDAT1
                                    
001FB6 EBAF 3E0A             7      LD  A,00AH      ;RFD=0
001FB8 EBB1 D3FF            11      OUT (0FFH),A    ;ディスクサブシステムI/F 8255 コントロール
                                    
001FBA EBB3 DBFC            11      IN  A,(0FCH)    ;標準状態ではサブシステムからのデータ受信ポート
001FBC EBB5 F5              11      PUSH    AF
001FBD EBB6 3E0D             7      LD  A,00DH      ;DAC=1
001FBF EBB8 D3FF            11      OUT (0FFH),A    ;ディスクサブシステムI/F 8255 コントロール
                                
       EBBA                     GETDAT2:
001FC1 EBBA DBFE            11      IN  A,(0FEH)    ;ディスクサブシステムI/F 8255 ポートC
001FC3 EBBC 0F               4      RRCA            ;DAV
001FC4 EBBD 38FB            12      JR  C,GETDAT2
                                
001FC6 EBBF 3E0C             7      LD  A,00CH      ;DAC=0
001FC8 EBC1 D3FF            11      OUT (0FFH),A
001FCA EBC3 F1              10      POP AF
001FCB EBC4 C9              10      RET
                                
                                ;   高速ハンドシェイク（ホストが送信）
                                ;   HL:アドレス BC:受信サイズ（必ず偶数にする）
       EBC5                     FPUTDAT:
       EBC5                     FPUTDAT1:
001FCC EBC5 DBFE            11      IN  A,(0FEH)    ;ディスクサブシステムI/F 8255 ポートC
001FCE EBC7 E602             7      AND 2       ;RFD
001FD0 EBC9 28FA            12      JR  Z,FPUTDAT1
001FD2 EBCB 3E0E             7      LD  A,00EH      ;ATN=0
001FD4 EBCD D3FF            11      OUT (0FFH),A    ;ディスクサブシステムI/F 8255 コントロール
                                
001FD6 EBCF 7E               7      LD  A,(HL)
001FD7 EBD0 D3FD            11      OUT (0FDH),A    ;標準状態ではサブシステムへのデータ送信ポート
                                
001FD9 EBD2 3E09             7      LD  A,9     ;DAV=1
001FDB EBD4 D3FF            11      OUT (0FFH),A
001FDD EBD6 23               6      INC HL
001FDE EBD7 0B               6      DEC BC
       EBD8                     FPUTDAT2:
001FDF EBD8 DBFE            11      IN  A,(0FEH)    ;ディスクサブシステムI/F 8255 ポートC
001FE1 EBDA E604             7      AND 4       ;DAC
001FE3 EBDC 28FA            12      JR  Z,FPUTDAT2
                                
001FE5 EBDE 7E               7      LD  A,(HL)
001FE6 EBDF D3FD            11      OUT (0FDH),A    ;標準状態ではサブシステムへのデータ送信ポート
                                
001FE8 EBE1 3E08             7      LD  A,8     ;DAV=0
001FEA EBE3 D3FF            11      OUT (0FFH),A
       EBE5                     FPUTDAT3:
001FEC EBE5 DBFE            11      IN  A,(0FEH)    ;ディスクサブシステムI/F 8255 ポートC
001FEE EBE7 E604             7      AND 4       ;DAC
001FF0 EBE9 20FA            12      JR  NZ,FPUTDAT3
                                
001FF2 EBEB EDA1            16      CPI         ;HL=HL+1 BC=BC-1 BCが0の場合にP/V=0
001FF4 EBED EAC5EB          10      JP  PE,FPUTDAT
001FF7 EBF0 C9              10      RET
                                
                                
                                ;   高速ハンドシェイク（ホストが受信）
                                ;   HL:アドレス BC:受信サイズ（必ず偶数にする）
       EBF1                     FGETDAT:
001FF8 EBF1 3E0B             7      LD  A,00BH      ;RFD=1
001FFA EBF3 D3FF            11      OUT (0FFH),A    ;ディスクサブシステムI/F 8255 コントロール
       EBF5                     FGETDAT1:
001FFC EBF5 DBFE            11      IN  A,(0FEH)    ;ディスクサブシステムI/F 8255 ポートC
001FFE EBF7 0F               4      RRCA            ;DAV
001FFF EBF8 30FB            12      JR  NC,FGETDAT1
                                    
002001 EBFA 3E0A             7      LD  A,00AH      ;RFD=0
002003 EBFC D3FF            11      OUT (0FFH),A    ;ディスクサブシステムI/F 8255 コントロール
                                    
002005 EBFE DBFC            11      IN  A,(0FCH)    ;標準状態ではサブシステムからのデータ受信ポート
002007 EC00 77               7      LD  (HL),A
                                
002008 EC01 3E0D             7      LD  A,00DH      ;DAC=1
00200A EC03 D3FF            11      OUT (0FFH),A    ;ディスクサブシステムI/F 8255 コントロール
00200C EC05 23               6      INC HL
00200D EC06 0B               6      DEC BC
       EC07                     FGETDAT2:
00200E EC07 DBFE            11      IN  A,(0FEH)    ;ディスクサブシステムI/F 8255 ポートC
002010 EC09 0F               4      RRCA            ;DAV
002011 EC0A 38FB            12      JR  C,FGETDAT2
                                
002013 EC0C DBFC            11      IN  A,(0FCH)    ;標準状態ではサブシステムからのデータ受信ポート
002015 EC0E 77               7      LD  (HL),A
                                
002016 EC0F 3E0C             7      LD  A,00CH      ;DAC=0
002018 EC11 D3FF            11      OUT (0FFH),A
                                
00201A EC13 EDA1            16      CPI         ;HL=HL+1 BC=BC-1 BCが0の場合にP/V=0
00201C EC15 EAF1EB          10      JP  PE,FGETDAT
00201F EC18 C9              10      RET
                                
                                ;   論理セクタ番号からトラック番号とセクタ番号を得る
                                ;   in 
                                ;   DE:論理セクタ
       EC19                     CALC_SECTOR:
002020 EC19 C5              11      PUSH    BC
002021 EC1A DD4E0D          19      LD  C,(IX+00DH) ;フロッピーディスクの1トラックのセクタ数(DPB_0D_MAXSEC)
002024 EC1D 0610             7      LD  B,16
002026 EC1F AF               4      XOR A
002027 EC20 EB               4      EX  DE,HL
       EC21                     DIV1:
002028 EC21 29              11      ADD HL,HL
002029 EC22 8F               4      ADC A,A
00202A EC23 B9               4      CP  C
00202B EC24 3802            12      JR  C,DIV2
00202D EC26 91               4      SUB C
00202E EC27 2C               4      INC L
       EC28                     DIV2:
00202F EC28 10F7            13      DJNZ    DIV1
                                
002031 EC2A 3C               4      INC A   ;最小のセクタは１固定
002032 EC2B 55               4      LD  D,L ;TRACK
       EC2C                     DIV3:
002033 EC2C 5F               4      LD  E,A ;SECTOR
002034 EC2D C1              10      POP BC
002035 EC2E C9              10      RET
                                
       EC2F                     WTTRK:
002036 EC2F 37               4      SCF
002037 EC30 C9              10      RET
       EC31                     FDWT:
002038 EC31 E5              11      PUSH    HL
002039 EC32 D5              11      PUSH    DE
00203A EC33 CD19EC          17      CALL    CALC_SECTOR
00203D EC36 7A               4      LD  A,D     ;トラック
00203E EC37 3297EC          13      LD  (FDWT_TRACK),A
002041 EC3A 7B               4      LD  A,E     ;セクタ
002042 EC3B 3292EC          13      LD  (FDWT_SECTOR),A
002045 EC3E DD7E0D          19      LD  A,(IX+00DH) ;フロッピーディスクの1トラックのセクタ数(DPB_0D_MAXSEC)
002048 EC41 93               4      SUB E
002049 EC42 3C               4      INC A
00204A EC43 67               4      LD  H,A
00204B EC44 D1              10      POP DE
00204C EC45 3A1CE6          13      LD  A,(SECSZ+2) ;1セクタのサイズの上位1バイト
00204F EC48 4F               4      LD  C,A
002050 EC49 AF               4      XOR A
       EC4A                     FDWT2:
002051 EC4A 81               4      ADD A,C
002052 EC4B 13               6      INC DE
002053 EC4C 05               4      DEC B
002054 EC4D 2807            12      JR  Z,FDWT3
002056 EC4F 25               4      DEC H       ;トラック、ヘッドを跨がない
002057 EC50 2804            12      JR  Z,FDWT3
002059 EC52 FE3A             7      CP  03AH        ;バッファとして04000H-07BFFHまで使える
00205B EC54 38F4            12      JR  C,FDWT2
       EC56                     FDWT3:
00205D EC56 4F               4      LD  C,A
00205E EC57 E1              10      POP HL
00205F EC58 3E16             7      LD  A,16H       ;高速レシーブメモリ
002061 EC5A CD7BEB          17      CALL    PUTCOM
002064 EC5D 3E40             7      LD  A,DSS_DATA/256  ;開始アドレスH
002066 EC5F CD81EB          17      CALL    PUTDAT
002069 EC62 AF               4      XOR A       ;開始アドレスL
00206A EC63 CD81EB          17      CALL    PUTDAT
00206D EC66 79               4      LD  A,C     ;バイト数H
00206E EC67 CD81EB          17      CALL    PUTDAT
002071 EC6A AF               4      XOR A       ;バイト数L
002072 EC6B CD81EB          17      CALL    PUTDAT
002075 EC6E C5              11      PUSH    BC
002076 EC6F 41               4      LD  B,C
002077 EC70 0E00             7      LD  C,0
002079 EC72 CDC5EB          17      CALL    FPUTDAT
00207C EC75 C1              10      POP BC
00207D EC76 3E0D             7      LD  A,0DH       ;エグゼキュート
00207F EC78 CD7BEB          17      CALL    PUTCOM
002082 EC7B 3E7C             7      LD  A,WRITEDISKEX/256
002084 EC7D CD81EB          17      CALL    PUTDAT
002087 EC80 3E5D             7      LD  A,WRITEDISKEX%256
002089 EC82 CD81EB          17      CALL    PUTDAT
00208C EC85 DD7E13          19      LD  A,(IX+013H) ;デバイスドライバ内におけるユニット番号(DPB_13_UNITNO)
00208F EC88 CD81EB          17      CALL    PUTDAT
002092 EC8B DD7E0D          19      LD  A,(IX+00DH) ;フロッピーディスクの1トラックのセクタ数(DPB_0D_MAXSEC)
002095 EC8E CD81EB          17      CALL    PUTDAT
       EC92                     FDWT_SECTOR EQU $+1
002098 EC91 3E00             7      LD  A,0     ;セクタ
00209A EC93 CD81EB          17      CALL    PUTDAT
       EC97                     FDWT_TRACK  EQU $+1
00209D EC96 3E00             7      LD  A,0     ;トラック
00209F EC98 CD81EB          17      CALL    PUTDAT
0020A2 EC9B DD7E0A          19      LD  A,(IX+00AH) ;フロッピーディスクのモード(DPB_0A_FDMODE)
0020A5 EC9E CD81EB          17      CALL    PUTDAT
0020A8 ECA1 3A1CE6          13      LD  A,(SECSZ+2) ;1セクタのサイズの上位1バイト
0020AB ECA4 CD81EB          17      CALL    PUTDAT
0020AE ECA7 79               4      LD  A,C
0020AF ECA8 CD81EB          17      CALL    PUTDAT      ;バイト数H
0020B2 ECAB DD7E0C          19      LD  A,(IX+$0C)  ;フロッピーディスクのシリンダ数(DPB_0C_MAXCYL)
0020B5 ECAE CD81EB          17      CALL    PUTDAT
                                
0020B8 ECB1 3E0D             7      LD  A,0DH       ;エグゼキュート
0020BA ECB3 CD7BEB          17      CALL    PUTCOM
0020BD ECB6 3E7D             7      LD  A,RESULTEX/256
0020BF ECB8 CD81EB          17      CALL    PUTDAT
0020C2 ECBB 3EB0             7      LD  A,RESULTEX%256
0020C4 ECBD CD81EB          17      CALL    PUTDAT
                                
0020C7 ECC0 CDA6EB          17      CALL    GETDAT
0020CA ECC3 4F               4      LD  C,A
0020CB ECC4 FE01             7      CP  1
0020CD ECC6 D8              11      RET C
                                
0020CE ECC7 78               4      LD  A,B
0020CF ECC8 B7               4      OR  A
0020D0 ECC9 C231EC          10      JP  NZ,FDWT
0020D3 ECCC C9              10      RET
                                
       ECCD                     FDRD:
0020D4 ECCD 3E0D             7      LD  A,0DH       ;エグゼキュート
0020D6 ECCF CD7BEB          17      CALL    PUTCOM
0020D9 ECD2 3E7C             7      LD  A,READDISKEX/256
0020DB ECD4 CD81EB          17      CALL    PUTDAT
0020DE ECD7 AF               4      XOR A
0020DF ECD8 CD81EB          17      CALL    PUTDAT
0020E2 ECDB DD7E13          19      LD  A,(IX+013H) ;デバイスドライバ内におけるユニット番号(DPB_13_UNITNO)
0020E5 ECDE CD81EB          17      CALL    PUTDAT
0020E8 ECE1 DD7E0D          19      LD  A,(IX+00DH) ;フロッピーディスクの1トラックのセクタ数(DPB_0D_MAXSEC)
0020EB ECE4 CD81EB          17      CALL    PUTDAT
0020EE ECE7 E5              11      PUSH    HL
0020EF ECE8 D5              11      PUSH    DE
0020F0 ECE9 CD19EC          17      CALL    CALC_SECTOR
0020F3 ECEC 7B               4      LD  A,E     ;セクタ
0020F4 ECED CD81EB          17      CALL    PUTDAT
0020F7 ECF0 7A               4      LD  A,D     ;トラック
0020F8 ECF1 CD81EB          17      CALL    PUTDAT
0020FB ECF4 DD7E0D          19      LD  A,(IX+00DH) ;フロッピーディスクの1トラックのセクタ数(DPB_0D_MAXSEC)
0020FE ECF7 93               4      SUB E
0020FF ECF8 3C               4      INC A
002100 ECF9 67               4      LD  H,A
002101 ECFA D1              10      POP DE
002102 ECFB DD7E0A          19      LD  A,(IX+00AH) ;フロッピーディスクのモード(DPB_0A_FDMODE)
002105 ECFE CD81EB          17      CALL    PUTDAT
002108 ED01 3A1CE6          13      LD  A,(SECSZ+2) ;1セクタのサイズの上位1バイト
00210B ED04 CD81EB          17      CALL    PUTDAT
00210E ED07 4F               4      LD  C,A
00210F ED08 AF               4      XOR A
       ED09                     FDRD2:
002110 ED09 81               4      ADD A,C
002111 ED0A 13               6      INC DE
002112 ED0B 05               4      DEC B
002113 ED0C 2807            12      JR  Z,FDRD3
002115 ED0E 25               4      DEC H       ;トラック、ヘッドを跨がない
002116 ED0F 2804            12      JR  Z,FDRD3
002118 ED11 FE3A             7      CP  03AH        ;バッファとして04000H-07BFFHまで使える
00211A ED13 38F4            12      JR  C,FDRD2
       ED15                     FDRD3:
00211C ED15 E1              10      POP HL
00211D ED16 4F               4      LD  C,A
00211E ED17 CD81EB          17      CALL    PUTDAT      ;バイト数H
002121 ED1A DD7E0C          19      LD  A,(IX+$0C)  ;フロッピーディスクのシリンダ数(DPB_0C_MAXCYL)
002124 ED1D CD81EB          17      CALL    PUTDAT
                                
002127 ED20 3E0D             7      LD  A,0DH       ;エグゼキュート
002129 ED22 CD7BEB          17      CALL    PUTCOM
00212C ED25 3E7D             7      LD  A,RESULTEX/256
00212E ED27 CD81EB          17      CALL    PUTDAT
002131 ED2A 3EB0             7      LD  A,RESULTEX%256
002133 ED2C CD81EB          17      CALL    PUTDAT
                                
002136 ED2F CDA6EB          17      CALL    GETDAT
002139 ED32 4F               4      LD  C,A
00213A ED33 FE01             7      CP  1
00213C ED35 D8              11      RET C
                                
00213D ED36 3E15             7      LD  A,15H       ;高速センドメモリ
00213F ED38 CD7BEB          17      CALL    PUTCOM
002142 ED3B 3E40             7      LD  A,DSS_DATA/256  ;開始アドレスH
002144 ED3D CD81EB          17      CALL    PUTDAT
002147 ED40 AF               4      XOR A       ;開始アドレスL
002148 ED41 CD81EB          17      CALL    PUTDAT
00214B ED44 79               4      LD  A,C     ;バイト数H
00214C ED45 CD81EB          17      CALL    PUTDAT
00214F ED48 AF               4      XOR A       ;バイト数L
002150 ED49 CD81EB          17      CALL    PUTDAT
002153 ED4C C5              11      PUSH    BC
002154 ED4D 41               4      LD  B,C
002155 ED4E 0E00             7      LD  C,0
002157 ED50 CDF1EB          17      CALL    FGETDAT
00215A ED53 C1              10      POP BC
00215B ED54 78               4      LD  A,B
00215C ED55 B7               4      OR  A
00215D ED56 C2CDEC          10      JP  NZ,FDRD
002160 ED59 C9              10      RET
                                
       EF68                     FDMODE  EQU BEEPD+7
       EF6A                     FSPAT   EQU BEEPD+9
                                
[EOF:88DISK.ASM:UTF_8]
                                
                                    INCLUDE "88TABLE.ASM"
                                
                                ;   LSX-Dodgers TABLE キーのテーブル
                                
       ED5A                     AT_TABLE:
002161 ED5A                         DS  TABLEAD-AT_TABLE
       EDC8                     EXTSP:
                                
       EDC8                     KEY_TABLE:
0021CF EDC8 3031323334353637        DB  '0','1','2','3','4','5','6','7' ;0
0021D7 EDD0 38392A2B3D2E2C0D        DB  '8','9','*','+','=','.',',',0DH ;1
0021DF EDD8 4061626364656667        DB  '@','a','b','c','d','e','f','g' ;2
0021E7 EDE0 68696A6B6C6D6E6F        DB  'h','i','j','k','l','m','n','o' ;3
0021EF EDE8 7071727374757677        DB  'p','q','r','s','t','u','v','w' ;4
0021F7 EDF0 78797A5B5C5D5E2D        DB  'x','y','z','[',5CH,']','^','-' ;5
0021FF EDF8 3031323334353637        DB  '0','1','2','3','4','5','6','7' ;6
002207 EE00 38393A3B2C2E2F5C        DB  '8','9',':',';',',','.','/',5CH ;7
00220F EE08 0C1E1C0800000000        DB  0CH,1EH,1CH,08H,00H,00H,00H,00H ;8
002217 EE10 030000000000201B        DB  03H,00H,00H,00H,00H,00H,' ',1BH ;9
00221F EE18 091F1D00002D2F00        DB  09H,1FH,1DH,00H,00H,'-','/',00H ;A
002227 EE20 0000000000000000        DB  00H,00H,00H,00H,00H,00H,00H,00H ;B
00222F EE28 0000000000081208        DB  00H,00H,00H,00H,00H,08H,12H,08H ;C
                                
       EE30                     SHIFT_TABLE:
002237 EE30 3031323334353637        DB  '0','1','2','3','4','5','6','7' ;0
00223F EE38 38392A2B3D2E2C0D        DB  '8','9','*','+','=','.',',',0DH ;1
002247 EE40 4041424344454647        DB  '@','A','B','C','D','E','F','G' ;2
00224F EE48 48494A4B4C4D4E4F        DB  'H','I','J','K','L','M','N','O' ;3
002257 EE50 5051525354555657        DB  'P','Q','R','S','T','U','V','W' ;4
00225F EE58 58595A7B7C7D7E3D        DB  'X','Y','Z','{','|','}','~','=' ;5
002267 EE60 3021222324252627        DB  '0','!','"','#','$','%','&',27H ;6
00226F EE68 28292A2B3C3E3F5F        DB  '(',')','*','+','<','>','?','_' ;7
002277 EE70 0B1E1C0800000000        DB  0BH,1EH,1CH,08H,00H,00H,00H,00H ;8
00227F EE78 030000000000201B        DB  03H,00H,00H,00H,00H,00H,' ',1BH ;9
002287 EE80 091F1D00002D2F00        DB  09H,1FH,1DH,00H,00H,'-','/',00H ;A
00228F EE88 0000000000000000        DB  00H,00H,00H,00H,00H,00H,00H,00H ;B
002297 EE90 0000000000081208        DB  00H,00H,00H,00H,00H,08H,12H,08H ;C
                                
       EE98                     CTRL_TABLE:
00229F EE98 3031323334353637        DB  '0','1','2','3','4','5','6','7' ;0
0022A7 EEA0 38392A2B3D2E2C0D        DB  '8','9','*','+','=','.',',',0DH ;1
0022AF EEA8 4001020304050607        DB  '@',01H,02H,03H,04H,05H,06H,07H ;2
0022B7 EEB0 08090A0B0C0D0E0F        DB  08H,09H,0AH,0BH,0CH,0DH,0EH,0FH ;3
0022BF EEB8 1011121314151617        DB  10H,11H,12H,13H,14H,15H,16H,17H ;4
0022C7 EEC0 18191A5B5C5D5E2D        DB  18H,19H,1AH,'[',5CH,']','^','-' ;5
0022CF EEC8 3031323334353637        DB  '0','1','2','3','4','5','6','7' ;6
0022D7 EED0 38393A3B2C2E2F5F        DB  '8','9',':',';',',','.','/','_' ;7
0022DF EED8 0C1E1C0800000000        DB  0CH,1EH,1CH,08H,00H,00H,00H,00H ;8
0022E7 EEE0 030000000000201B        DB  03H,00H,00H,00H,00H,00H,' ',1BH ;9
0022EF EEE8 091F1D00002D2F00        DB  09H,1FH,1DH,00H,00H,'-','/',00H ;A
0022F7 EEF0 0000000000000000        DB  00H,00H,00H,00H,00H,00H,00H,00H ;B
0022FF EEF8 0000000000081208        DB  00H,00H,00H,00H,00H,08H,12H,08H ;C
[EOF:88TABLE.ASM:SHIFT_JIS]
                                    INCLUDE "LDWORK.ASM"
                                
                                ;   LSX-Dodgers WORK0
                                ;
                                ;   CP/M互換BIOS
                                ;   BOOT:アドレス下位1バイトが0になるように
       EF00                     AT_WORK:
002307 EF00                         DS  WORKAD-AT_WORK
                                
       EF00                     CPM_BOOT:
002307 EF00 C30000          10      JP  0
       EF03                     _SYS00:     ;(BDOS)プログラム終了
       EF03                     CPM_WBOOT:
00230A EF03 C309D0          10      JP  WBOOT1
       EF06                     CPM_CONST:
00230D EF06 C38CD9          10      JP  CONSTX
       EF09                     _SYS07:     ;(BDOS)コンソール直接入力
       EF09                     CPM_CONIN:
002310 EF09 C344D9          10      JP  FLGET
       EF0C                     CPM_CONOUT:
002313 EF0C C3C7DB          10      JP  CONOUT1
                                
       EF0F                     DECBF:
002316 EF0F                         DS  5
00231B EF14 00                  FDRV    DB  0
00231C EF15                     FNAME   DS  36
002340 EF39                     SFILE:  DS  33      ;DRV FILENAME
002361 EF5A                     HLBUF:  DS  3       ;Random record buffer
                                
002364 EF5D 0000                LEFTX:  DW  0
002366 EF5F 0000                DTAX:   DW  0
                                
       EF61                     ZERO:
       EF61                     BEEPD:
002368 EF61 008E01000B000C10        DB  0,08EH,1,0,00BH,0,00CH,010H
002370 EF69 073E08100D00FF          DB  007H,03EH,008H,010H,00DH,0,0FFH
       EF62                     RTC_YY  EQU BEEPD+1
       EF63                     RTC_MW  EQU BEEPD+2
       EF64                     RTC_DD  EQU BEEPD+3
       EF65                     RTC_TT  EQU BEEPD+4
       EF66                     RTC_MM  EQU BEEPD+5
       EF67                     RTC_SS  EQU BEEPD+6
                                
002377 EF70 00                  CHECK:  DB  0
                                
002378 EF71 4F4B24              OK: DB  "OK$"
00237B EF74                         DS  5
002380 EF79 4572726F722124      COMERM: DB  "Error!$"
                                ;   システムワークエリア
                                ;   _CYL0:アドレス下位1バイトが080Hになるように
002387 EF80 FF                  _CYL0:  DB  0FFH    ;Cylinder
002388 EF81 FF                  _CYL1:  DB  0FFH    ;Cylinder
002389 EF82 FF                  _CYL2:  DB  0FFH    ;Cylinder
00238A EF83 FF                  _CYL3:  DB  0FFH    ;Cylinder
00238B EF84 00                  _DRIVE: DB  0   ;unit number
00238C EF85 00                  _SEEKSP:DB  0   ;Seek speed
00238D EF86 FF                  _ISEEK: DB  0FFH    ;
00238E EF87 00                  _DVSW:  DB  0
00238F EF88 00                  _DRV:   DB  0
002390 EF89 FF                  _DSK:   DB  0FFH
002391 EF8A 8000                _DTA:   DW  00080H
002393 EF8C 0000                _CTC:   DW  0
002395 EF8E 0000                _TXADR: DW  0
002397 EF90 0000                _KEYPS: DW  0
002399 EF92 00FF                _KEYD:  DW  0FF00H  ;キーデータ
00239B EF94 C210                _KEYSP: DW  010C2H
00239D EF96 00                  _COLORF:DB  COLORF  ;色
00239E EF97 18                  _LINE:  DB  LINE
                                
00239F EF98 0000                _FCB:   DW  0
0023A1 EF9A 0000                _FBPS:  DW  0   ;SEARCH FILES
0023A3 EF9C 0000                _FBAD:  DW  0   ;    //
0023A5 EF9E 00                  _FBCNT: DB  0   ;    //
0023A6 EF9F 00                  _FILEN: DB  0
0023A7 EFA0 00                  _DIRF:  DB  0   ;bit7:ディレクトリ bit0-6:セクタインデックス
0023A8 EFA1                         DS  1
0023A9 EFA2 00                  _WTFATF:DB  0   ;FATバッファの更新フラグ
0023AA EFA3                         DS  1
0023AB EFA4 00                  _WTDBF: DB  0   ;データバッファの更新フラグ
0023AC EFA5 FF                  _DBDRV: DB  0FFH    ;データバッファにあるデータを読み込んだドライブ
0023AD EFA6 0000                _DBSEC: DW  0   ;データバッファにあるデータを読み込んだセクタ番号
0023AF EFA8 0000                _DPB:   DW  0
       EFAA                     _FATDRV:
0023B1 EFAA FF                      DB  0FFH    ;FATバッファに読み込んでいるドライブ
0023B2 EFAB 00                  _FATIX: DB  0   ;FATバッファに読み込んでいるインデックス
       EFAC                     _FAKEFREE:
0023B3 EFAC 0000                    DW  0   ;偽の残量（FATサイズが大きくなると重くなるのでその対策）
                                
0023B5 EFAE                         DS  2
                                
       EFB0                     CRTCD:  
0023B7 EFB0 6F                      DB  06FH
       EFB1                     _WIDTH: 
0023B8 EFB1 50                      DB  WIDTH
       EFB2                     TVRAMTOP:
0023B9 EFB2 5938                    DB  059H,038H
0023BB EFB4 1F02                    DB  01FH,002H
       EFB6                     _LINE2:
0023BD EFB6 19                      DB  019H
0023BE EFB7 1C                      DB  01CH
       EFB8                     WKE4:
0023BF EFB8 00                      DB  000H
       EFB9                     WK40:
0023C0 EFB9 07                      DB  007H
       EFBA                     _PAGE_MINUS:
0023C1 EFBA 80F8                    DW  0-WIDTH*LINE
       EFBC                     _WIDTH_MINUS:
0023C3 EFBC B0FF                    DW  0-WIDTH
       EFBE                     WK30:
0023C5 EFBE 0C                      DB  00CH
       EFBF                     WK31:
       EFBF                     WK1FD0:
0023C6 EFBF 20                      DB  020H
                                
0023C7 EFC0 0000                CTC0:   DW  INTCTCE
0023C9 EFC2 0000                CTC1:   DW  INTCTCE
0023CB EFC4 0000                CTC2:   DW  INTCTC2
0023CD EFC6 0000                CTC3:   DW  INTCTCE
0023CF EFC8 0000                INTVEC: DW  INT
                                
                                ;   LSX-Dodgers 独自BIOS
                                
0023D1 EFCA C303DD          10  _INKEY: JP  INKEY
0023D4 EFCD C3C5DA          10  _PRINT: JP  PRINT
0023D7 EFD0 C38EDD          10  _SCRN:  JP  SCRN
0023DA EFD3 C3A5DC          10  _POS:   JP  POS
0023DD EFD6 C30DDB          10  _LOC:   JP  LOC
       EFD9                     _CHGDRV:
0023E0 EFD9 C376EA          10      JP  CHGDRV
       EFDC                     _GETDPB:
0023E3 EFDC C342EB          10      JP  GETDPB
       EFDF                     _FFLUSH:
0023E6 EFDF C360EB          10      JP  FFLUSH
       EFE2                     _RDFATX:
0023E9 EFE2 C37CE7          10      JP  RDFATX
0023EC EFE5 C3A4E8          10  _RDFAT: JP  RDFAT
0023EF EFE8 C32FEC          10  _WTTRK: JP  WTTRK
0023F2 EFEB C3CDEC          10  _FDRD:  JP  FDRD
0023F5 EFEE C331EC          10  _FDWT:  JP  FDWT
       EFF1                     _BPB2DPB:
0023F8 EFF1 C309E9          10      JP  BPB2DPB
0023FB EFF4                         DS  3
       EFF7                     _GNCL:
0023FE EFF7 C31EE8          10  GNCPAT: JP  GNCL        ; self-modifying code
       EFFA                     _SNCL:
002401 EFFA C341E8          10  SNCPAT: JP  SNCL        ; self-modifying code
002404 EFFD C34CD0          10  _COMANL:JP  COMANL
                                
       F000                     _WE:
[EOF:LDWORK.ASM:SHIFT_JIS]
                                    INCLUDE "LDCALL.ASM"
                                
                                ;   LSX-Dodgers システムコール(BDOS)
                                ;
                                ;   LSX-Dodgers SYSTEM CALL
                                ;   STABLE:アドレス下位1バイトが0になるように
                                
       F000                     STABLE:
                                ;0
002407 F000 03EF18D924D9DBDF        DW  _SYS00,_SYS01,_SYS02,_SYS03
00240F F008 23D623D629D909EF        DW  _SYS04,_SYS05,_SYS06,_SYS07
002417 F010 31D925D658D984D9        DW  _SYS08,_SYS09,_SYS0A,_SYS0B
00241F F018 3AD63FD64ED661D6        DW  _SYS0C,_SYS0D,_SYS0E,_SYS0F
                                ;1
002427 F020 B5D6FCD645D77BD7        DW  _SYS10,_SYS11,_SYS12,_SYS13
00242F F028 83D7A1D7BED7B6D7        DW  _SYS14,_SYS15,_SYS16,_SYS17
002437 F030 19D81ED823D829D8        DW  _SYS18,_SYS19,_SYS1A,_SYS1B
00243F F038 23D64FD823D653D8        DW  _SYS1C,_SYS1D,_SYS1E,_SYS1F
                                ;2
002447 F040 23D6F5D707D85AD8        DW  _SYS20,_SYS21,_SYS22,_SYS23
00244F F048 86D823D62FE414E5        DW  _SYS24,_ERROR,_SYS26,_SYS27
002457 F050 07D88FD89DD9DBDF        DW  _SYS28,_SYS5C,_SYS2A,_SYS2B
00245F F058 C4D9DBDF23D6B2D8        DW  _SYS2C,_SYS2D,_SYS2E,_SYS2F
                                ;3
002467 F060 ACD823D623D623D6        DW  _SYS30,_ERROR,_ERROR,_ERROR
00246F F068 23D623D623D623D6        DW  _ERROR,_ERROR,_ERROR,_ERROR
002477 F070 23D6DBDFDBDFD3D8        DW  _ERROR,_SYS39,_SYS3A,_SYS5A
                                ;DOS2
00247F F078 06D6                    DW  _DOS2
                                
002481 F07A                         DS  2
002483 F07C 00F2                _FATBF: DW  FATBF
002485 F07E 00FA                _DTBUF: DW  DTBUF
                                
                                ;   コントロールコードテーブル
                                ;   CTRLTB:アドレス下位1バイトが080Hになるように
                                
       F080                     CTRLTB:
002487 F080 10DB10DB47DB50DC        DW  CTRL00,CTRL00,CTRL02,CTRL03 ;  A,B,C
00248F F088 4ADC72DB23DCEFDB        DW  CTRL04,CTRL05,CTRL06,CTRL07 ;D,E,F,G
002497 F090 17DB3CDB53DC9EDB        DW  CTRL08,CTRL09,CTRL0A,CTRL0B ;H,I,J,K
00249F F098 20DC91DB5ADC10DB        DW  CTRL0C,CTRL0D,CTRL0E,CTRL00 ;L,M,N,O
0024A7 F0A0 10DB10DB96DB10DB        DW  CTRL00,CTRL00,CTRL12,CTRL00 ;P,Q,R,S
0024AF F0A8 10DB10DB10DB10DB        DW  CTRL00,CTRL00,CTRL00,CTRL00 ;T,U,V,W
0024B7 F0B0 10DB10DB20DCA5DB        DW  CTRL00,CTRL00,CTRL0C,CTRL1B ;X,Y,Z,ESC
0024BF F0B8 F9DA1EDB33DB53DC        DW  CTRL1C,CTRL1D,CTRL1E,CTRL1F ;→,←,↑,↓
                                
0024C7 F0C0                         DS  02AH
                                
0024F1 F0EA 1617                SDDATA: DB  22,23       ;(FCB)ファイルを最後に変更した時刻
0024F3 F0EC 1415                    DB  20,21       ;(FCB)ファイルを最後に変更した日付
0024F5 F0EE 1A1B                    DB  26,27       ;(FCB)ファイルの先頭クラスタ
0024F7 F0F0 10111213                DB  16,17,18,19 ;(FCB)ファイルのサイズ(バイト単位)
       F0F4                     SDDATAE:
                                
0024FB F0F4                     SCDIR:  DS  2       ;+14 +15
0024FD F0F6                     SFBPS:  DS  2       ;FBPS
0024FF F0F8                     SFNDF:  DS  2       ;FILEN DIRF
                                
002501 F0FA 0000                _FATPS: DW  0
002503 F0FC 0000                _DIRPS: DW  0
002505 F0FE 0000                _CLPS:  DW  0
                                
       F100                     _PE:
[EOF:LDCALL.ASM:SHIFT_JIS]
                                    INCLUDE "88DPB.ASM"
                                
                                ;   LSX-Dodgers DPB
                                ;   PC-8801mkIISR
                                
       F100                     DEVICE:
                                
                                ;   A:
                                
002507 F100 0200                    DW  2   ;DPB_00_FATLN
002509 F102 EBEF                    DW  _FDRD   ;DPB_02_DRD
00250B F104 EEEF                    DW  _FDWT   ;DPB_04_DWT
00250D F106 FD                      DB  0FDH    ;DPB_06_FATID
00250E F107 02                      DB  2   ;DPB_07_SECPCL
00250F F108 6401                    DW  356 ;DPB_08_MAXCL
002511 F10A FF                      DB  0FFH    ;DPB_0A_FDMODE  0FFH=2D / 0FEH=2HD
002512 F10B 07                      DB  7   ;DPB_0B_DIRSCNT
002513 F10C 28                      DB  40  ;DPB_0C_MAXCYL
002514 F10D 09                      DB  9   ;DPB_0D_MAXSEC  Number of sectors
002515 F10E 01                      DB  1   ;DPB_0E_FATPS
002516 F10F 82                      DB  082H    ;DPB_0F_BPS
002517 F110 0500                    DW  5   ;DPB_10_DIRPS
002519 F112 A7                      DB  0A7H    ;DPB_12_DEVICE  Device Number
00251A F113 00                      DB  0   ;DPB_13_UNITNO
00251B F114 0800                    DW  8   ;DPB_14_ADDCL16
00251D F116 0000                    DW  0   ;DPB_16
00251F F118 0000                    DW  0   ;DPB_18
002521 F11A 0000                    DW  0   ;DPB_1A_SDIR
002523 F11C 46444430                DB  "FDD0"  ;DPB_1C_NAME
                                
                                ;   B:
                                
002527 F120 0200                    DW  2   ;DPB_00_FATLN
002529 F122 EBEF                    DW  _FDRD   ;DPB_02_DRD
00252B F124 EEEF                    DW  _FDWT   ;DPB_04_DWT
00252D F126 FD                      DB  0FDH    ;DPB_06_FATID
00252E F127 02                      DB  2   ;DPB_07_SECPCL
00252F F128 6401                    DW  356 ;DPB_08_MAXCL
002531 F12A FF                      DB  0FFH    ;DPB_0A_FDMODE  0FFH=2D / 0FEH=2HD
002532 F12B 07                      DB  7   ;DPB_0B_DIRSCNT
002533 F12C 28                      DB  40  ;DPB_0C_MAXCYL
002534 F12D 09                      DB  9   ;DPB_0D_MAXSEC  Number of sectors
002535 F12E 01                      DB  1   ;DPB_0E_FATPS
002536 F12F 82                      DB  082H    ;DPB_0F_BPS
002537 F130 0500                    DW  5   ;DPB_10_DIRPS
002539 F132 A7                      DB  0A7H    ;DPB_12_DEVICE  Device Number
00253A F133 01                      DB  1   ;DPB_13_UNITNO
00253B F134 0800                    DW  8   ;DPB_14_ADDCL16
00253D F136 0000                    DW  0   ;DPB_16
00253F F138 0000                    DW  0   ;DPB_18
002541 F13A 0000                    DW  0   ;DPB_1A_SDIR
002543 F13C 46444431                DB  "FDD1"  ;DPB_1C_NAME
                                
                                ;   C:
                                
002547 F140                         DS  32
                                
                                ;   D:
                                
002567 F160                         DS  32
                                
                                ;   E:
                                
002587 F180                         DS  32
                                
                                ;   F:
                                
0025A7 F1A0 0000                BANKFL: DW  0   ;DPB_00_FATLN
0025A9 F1A2 9CD5                    DW  BDRD    ;DPB_02_DRD
0025AB F1A4 98D5                    DW  BDWT    ;DPB_04_DWT
0025AD F1A6 F9                      DB  0F9H    ;DPB_06_FATID
0025AE F1A7 02                      DB  2   ;DPB_07_SECPCL
0025AF F1A8 0000                BANKCL: DW  0   ;DPB_08_MAXCL
0025B1 F1AA 00                      DB  0   ;DPB_0A_FDMODE
0025B2 F1AB 08                      DB  8   ;DPB_0B_DIRSCNT
0025B3 F1AC 00                      DB  0   ;DPB_0C_MAXCYL
0025B4 F1AD 01                      DB  1   ;DPB_0D_MAXSEC
0025B5 F1AE 00                      DB  0   ;DPB_0E_FATPS
0025B6 F1AF 02                      DB  2   ;DPB_0F_BPS
0025B7 F1B0 0200                    DW  2   ;DPB_10_DIRPS
0025B9 F1B2 0B                  BANKDV: DB  00BH    ;DPB_12_DEVICE
0025BA F1B3 00                      DB  0   ;DPB_13_UNITNO
0025BB F1B4 0600                    DW  6   ;DPB_14_ADDCL16
0025BD F1B6 0000                    DW  0   ;DPB_16
0025BF F1B8 0000                    DW  0   ;DPB_18
0025C1 F1BA 0000                    DW  0   ;DPB_1A_SDIR
0025C3 F1BC 454D454D                DB  "EMEM"  ;DPB_1C_NAME
                                
                                ;   G:
                                
0025C7 F1C0                         DS  32
                                
                                ;   H:
0025E7 F1E0                         DS  32-8
0025FF F1F8 00                      DB  0
[EOF:88DPB.ASM:UTF_8]
                                
       F1F9                     LAST_ADR:
                                
                                    END
[EOF:88.ASM:UTF_8]
