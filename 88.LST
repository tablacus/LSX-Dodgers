                                ;*** AILZ80ASM *** Z-80 Assembler, version 1.0.0.0, LST:Full:4
                                ;   LSX-Dodgers for X1/turbo/Z
                                ;   Programmed by
                                ;   Gaku (Lovers/Tablacus)
                                
                                    INCLUDE "88DEF.ASM"
                                
                                ;   LSX-Dodgers DEF
                                ;   PC-8001mkIISR
                                
       0002                     MAC EQU 2   ;PC-8001mkIISR
       0001                     DEV EQU 1
                                
                                
       CD00                     RUN EQU 0CD00H
       CCF9                     OFFSET  EQU RUN-7
                                
       D006                     BDOS    EQU 0D006H
       EDC8                     TABLEAD EQU 0EDC8H
       EF00                     WORKAD  EQU 0EF00H
       F200                     FATBF   EQU 0F200H
       FA00                     DTBUF   EQU 0FA00H
       FE00                     KEYBF   EQU 0FE00H
       FF00                     KBUF    EQU 0FF00H
       FFD9                     TRAP38  EQU 0FFD9H
       0050                     WIDTH   EQU 80
       0018                     LINE    EQU 24
       0000                     COLORF  EQU 0
       0009                     COMS    EQU 9
                                
                                ; ディスクサブシステム
       002A                     MAIN        EQU 0002AH
       003F                     RDFDC       EQU 0003FH
       0045                     CHECKRESULT EQU 00045H
       01AA                     SEEK        EQU 01AAh
       03E9                     GETDEVSTAT  EQU 003E9H
       040E                     MAPDRV      EQU 0040EH
       06A6                     GETPARAM    EQU 006A6H
       07D6                     SEEK_AND_WAIT   EQU 007D6H
                                
       4000                     DSS_DATA    EQU 04000H
                                
       7C00                     DSS     EQU 07C00H
[EOF:88DEF.ASM:SHIFT_JIS]
                                    INCLUDE "LDDEF.ASM"
                                
                                ;   LSX-Dodgers DEF
                                
       0001                     VER_1   EQU 1
       0004                     VER_2   EQU 4
       0007                     VER_3   EQU 7
       1D02                     MACW    EQU MAC + 01D00H    ;機種フラグとLD判別フラグ
       0102                     MACD    EQU MAC + DEV * 256 ;機種フラグとデバイスフラグ
       0147                     VER EQU VER_1 * 256 + VER_2 * 16 + VER_3
                                
       0005                     SYSTEM  EQU 00005H
       000F                     JP_HL   EQU 0000FH
       005C                     FCB1    EQU 0005CH
       006C                     FCB2    EQU 0006CH
       005D                     FCB1FN  EQU FCB1+1
       006D                     FCB2FN  EQU FCB2+1
       0080                     DTA1    EQU 00080H
                                
       FFCA                     EXTBIO  EQU 0FFCAH
                                
[EOF:LDDEF.ASM:SHIFT_JIS]
                                
000000 CCF9                         ORG OFFSET
                                
                                ;   MSX BINARY HEADER
000000 CCF9 FE                      DB  0FEH
                                ;   MSX BINARY START ADDRESS
000001 CCFA 00CD                    DW  RUN
                                ;   MSX BINARY END ADDRESS
000003 CCFC F9F1                    DW  LAST_ADR
                                ;   MSX BINARY EXEC ADDRESS
000005 CCFE 07CD                    DW  START
                                
                                    INCLUDE "88INIT.ASM"
                                
                                ;   LSX-Dodgers INIT
                                ;   PC-8801mkIISR
                                
000007 CD00 C307CD          10      JP  START
00000A CD03 021D                    DW  MACW
00000C CD05 4701                    DW  VER
                                
       CD07                     START:
00000E CD07 F3               4      DI
00000F CD08 ED5E             8      IM  2
000011 CD0A 3107CD          10      LD  SP,START
000014 CD0D CD1CCD          17      CALL    INIT        ;NZならAUTOEXECを実行
000017 CD10 210000          10      LD  HL,0
00001A CD13 E5              11      PUSH    HL
                                
00001B CD14 C9              10      RET
                                
00001C CD15 C8              11      RET Z
00001D CD16 113DCE          10      LD  DE,AUTOD
000020 CD19 C3FDEF          10      JP  _COMANL
                                
       CD1C                     INIT:
000023 CD1C DB32            11      IN  A,(032H)
000025 CD1E CBA7             8      RES 4,A     ;高速RAMアクセスモード
000027 CD20 D332            11      OUT (032H),A
                                
000029 CD22 21C8F3          10      LD  HL,0F3C8H   ;テキストをクリア
00002C CD25 11E880          10      LD  DE,080E8H
00002F CD28 0E20             7      LD  C,' '
000031 CD2A 3E19             7      LD  A,25
       CD2C                     TVCL1:
000033 CD2C 0650             7      LD  B,80
       CD2E                     TVCL2:
000035 CD2E 71               7      LD  (HL),C
000036 CD2F 23               6      INC HL
000037 CD30 10FC            13      DJNZ    TVCL2
000039 CD32 0614             7      LD  B,20
       CD34                     TVCL3:
00003B CD34 72               7      LD  (HL),D
00003C CD35 2C               4      INC L
00003D CD36 73               7      LD  (HL),E
00003E CD37 23               6      INC HL
00003F CD38 10FA            13      DJNZ    TVCL3
000041 CD3A 3D               4      DEC A
000042 CD3B 20EF            12      JR  NZ,TVCL1
                                
000044 CD3D DB32            11      IN  A,(032H)
000046 CD3F F610             7      OR  010H        ;高速RAMアクセスモードOFF
000048 CD41 D332            11      OUT (032H),A
                                
00004A CD43 CDADDD          17      CALL    INIT_CRTC
       CD46                     BANK:
00004D CD46 DBE2            11      IN  A,(0E2H)
00004F CD48 06E3             7      LD  B,0E3H      ;拡張RAM バンク選択
000051 CD4A 21007F          10      LD  HL,07F00H
000054 CD4D F3               4      DI
       CD4E                     BANK1:
000055 CD4E 3E11             7      LD  A,011H
000057 CD50 D3E2            11      OUT (0E2H),A    ;拡張RAM リード/ライト制御
000059 CD52 ED69            12      OUT (C),L
00005B CD54 5E               7      LD  E,(HL)
00005C CD55 7B               4      LD  A,E
00005D CD56 C6A5             7      ADD A,0A5H
00005F CD58 77               7      LD  (HL),A
000060 CD59 BE               7      CP  (HL)
000061 CD5A 73               7      LD  (HL),E
000062 CD5B 2005            12      JR  NZ,BANK2
000064 CD5D 2C               4      INC L
000065 CD5E CB65             8      BIT 4,L
000067 CD60 28EC            12      JR  Z,BANK1
       CD62                     BANK2:
000069 CD62 AF               4      XOR A
00006A CD63 D3E2            11      OUT (0E2H),A    ;拡張RAM リード/ライト制御
00006C CD65 7D               4      LD  A,L
00006D CD66 B7               4      OR  A
00006E CD67 2813            12      JR  Z,NOBANK
000070 CD69 2600             7      LD  H,0
000072 CD6B 29              11      ADD HL,HL   ;*2
000073 CD6C 29              11      ADD HL,HL   ;*4
000074 CD6D 29              11      ADD HL,HL   ;*8
000075 CD6E 29              11      ADD HL,HL   ;*16
000076 CD6F 29              11      ADD HL,HL   ;*32
000077 CD70 2B               6      DEC HL  ;-1
000078 CD71 2B               6      DEC HL  ;-2
000079 CD72 2B               6      DEC HL  ;-3
00007A CD73 22A8F1          16      LD  (BANKCL),HL
00007D CD76 CD2DCE          17      CALL    CALC_FATLN
000080 CD79 32A0F1          13      LD  (BANKFL),A
       CD7C                     NOBANK:
000083 CD7C 3E0C             7      LD  A,0CH       ;レシーブメモリ
000085 CD7E CD7EEB          17      CALL    PUTCOM
000088 CD81 3E7C             7      LD  A,DSS/256   ;開始アドレスH
00008A CD83 CD84EB          17      CALL    PUTDAT
00008D CD86 AF               4      XOR A       ;開始アドレスL
00008E CD87 CD84EB          17      CALL    PUTDAT
000091 CD8A 016501          10      LD  BC,AT_DSSE-AT_DSS
000094 CD8D 78               4      LD  A,B     ;バイト数H
000095 CD8E CD84EB          17      CALL    PUTDAT
000098 CD91 79               4      LD  A,C     ;バイト数H
000099 CD92 CD84EB          17      CALL    PUTDAT
00009C CD95 219FCE          10      LD  HL,AT_DSS
       CD98                     SUBPG1:
00009F CD98 7E               7      LD  A,(HL)
0000A0 CD99 CD84EB          17      CALL    PUTDAT
0000A3 CD9C EDA1            16      CPI
0000A5 CD9E EA98CD          10      JP  PE,SUBPG1
                                
0000A8 CDA1 210000          10      LD  HL,0
0000AB CDA4 065C             7      LD  B,05CH
0000AD CDA6 3EFF             7      LD  A,0FFH      ;RST 38H
0000AF CDA8 CDF3DE          17      CALL    FILL_MEMORY
0000B2 CDAB 06A4             7      LD  B,0A4H
0000B4 CDAD AF               4      XOR A
0000B5 CDAE CDF3DE          17      CALL    FILL_MEMORY
                                
0000B8 CDB1 3EC3             7      LD  A,0C3H      ;JP
0000BA CDB3 2103EF          10      LD  HL,CPM_WBOOT
0000BD CDB6 320000          13      LD  (00000H),A
0000C0 CDB9 220100          16      LD  (00001H),HL ;IPL
                                
0000C3 CDBC 21021D          10      LD  HL,MACW     ;3 bit7  DPB Compatible LA(1)
0000C6 CDBF 220300          16      LD  (00003H),HL ;  bit6-0 Machine
                                ;               ;4 LSX-Dodgers(01DH)
0000C9 CDC2 2106D0          10      LD  HL,BDOS
0000CC CDC5 320500          13      LD  (00005H),A
0000CF CDC8 220600          16      LD  (00006H),HL ;BDOS
                                
0000D2 CDCB 2126DE          10      LD  HL,BIOS
0000D5 CDCE 321800          13      LD  (00018H),A
0000D8 CDD1 221900          16      LD  (00019H),HL ;BIOS-ROM
                                
0000DB CDD4 21D9FF          10      LD  HL,TRAP38   ;TRAP38
0000DE CDD7 323800          13      LD  (00038H),A
0000E1 CDDA 223900          16      LD  (00039H),HL ;RST 038H
                                
0000E4 CDDD 3EEF             7      LD  A,CPM_BOOT/256
0000E6 CDDF 320B00          13      LD  (0000BH),A
                                
0000E9 CDE2 3EE9             7      LD  A,0E9H      ;JP (HL)
0000EB CDE4 320F00          13      LD  (0000FH),A
                                
0000EE CDE7 3A7DF0          13      LD  A,(_FATBF+1)
0000F1 CDEA 321300          13      LD  (00013H),A
                                
0000F4 CDED 3A7FF0          13      LD  A,(_DTBUF+1)
0000F7 CDF0 321700          13      LD  (00017H),A
                                
0000FA CDF3 3EFE             7      LD  A,KEYBF/256
0000FC CDF5 321B00          13      LD  (0001BH),A
                                
0000FF CDF8 3EFF             7      LD  A,KBUF/256
000101 CDFA 321F00          13      LD  (0001FH),A
                                
000104 CDFD 214701          10      LD  HL,VER
000107 CE00 225A00          16      LD  (0005AH),HL
                                
00010A CE03 2149CE          10      LD  HL,INIMES
00010D CE06 CD34D6          17      CALL    MSX
       CE09                     INIT1:
000110 CE09 F3               4      DI
000111 CE0A 1100FF          10      LD  DE,0FF00H
000114 CE0D 0600             7      LD  B,0
000116 CE0F CDBFD3          17      CALL    ZERO_MEMORY_DE
000119 CE12 21CAFF          10      LD  HL,EXTBIO
00011C CE15 060F             7      LD  B,TRAP38-EXTBIO
00011E CE17 3EFF             7      LD  A,0FFH      ;RST 38H
000120 CE19 CDF3DE          17      CALL    FILL_MEMORY
000123 CE1C 2178CE          10      LD  HL,AT_TRAP38
000126 CE1F 11D9FF          10      LD  DE,TRAP38
000129 CE22 012700          10      LD  BC,AT_TRAPE-AT_TRAP38
00012C CE25 EDB0                    LDIR
                                
00012E CE27 CD4FDD          17      CALL    CHKEY
000131 CE2A FE03             7      CP  3
000133 CE2C C9              10      RET
                                
       CE2D                     CALC_FATLN: ;FAT12のクラスタ数から必要なFATサイズを求める(セクタサイズ512)
000134 CE2D 5D               4      LD  E,L
000135 CE2E 54               4      LD  D,H
000136 CE2F 29              11      ADD HL,HL   ;*2
000137 CE30 19              11      ADD HL,DE   ;*3
000138 CE31 CB3C             8      SRL H   ;/2
00013A CE33 CB1D             8      RR  L   ;1クラスタ辺り1.5バイト必要
00013C CE35 11FF01          10      LD  DE,511  ;切り上げる
00013F CE38 19              11      ADD HL,DE
000140 CE39 7C               4      LD  A,H
000141 CE3A CB3F             8      SRL A
000143 CE3C C9              10      RET
                                
000144 CE3D 4155544F45584543    AUTOD:  DB  "AUTOEXEC "
            20                  
00014D CE46 413A00              AUTODV: DB  "A:",0
                                
000150 CE49 0C4C53582D446F64    INIMES: DB  00CH,"LSX-Dodgers for PC-8801mkIISR v"
            6765727320666F72    
            2050432D38383031    
            6D6B494953522076    
000170 CE69 312E                    DB  030H + VER_1, '.'
000172 CE6B 3437                    DB  030H + VER_2 ,030H + VER_3
000174 CE6D 505232                  DB  "PR2"
000177 CE70 2047616B750D0A          DB  ' Gaku',0DH,0AH
00017E CE77 00                      DB  0
                                
       CE78                     AT_TRAP38:
00017F FFD9                         ORG TRAP38,AT_TRAP38-OFFSET
00017F FFD9 210000          10      LD  HL,0
000182 FFDC E3              19      EX  (SP),HL
000183 FFDD 3E24             7      LD  A,'$'
000185 FFDF CD1BD9          17      CALL    MSG_A
000188 FFE2 2B               6      DEC HL
000189 FFE3 7C               4      LD  A,H
00018A FFE4 CDE8FF          17      CALL    PRHX
00018D FFE7 7D               4      LD  A,L
       FFE8                     PRHX:
00018E FFE8 F5              11      PUSH    AF
00018F FFE9 07               4      RLCA
000190 FFEA 07               4      RLCA
000191 FFEB 07               4      RLCA
000192 FFEC 07               4      RLCA
000193 FFED CDF1FF          17      CALL    PRHX2
000196 FFF0 F1              10      POP AF
       FFF1                     PRHX2:
000197 FFF1 E60F             7      AND 00FH
000199 FFF3 FE0A             7      CP  10
00019B FFF5 3F               4      CCF
00019C FFF6 CE30             7      ADC A,'0'
00019E FFF8 27               4      DAA
00019F FFF9 C31BD9          10      JP  MSG_A
0001A2 FFFC                         DS  4
0001A6 CE9F                         ORG $$+OFFSET   ;$DEPHASE
       CE9F                     AT_TRAPE:
                                
       CE9F                     AT_DSS:
0001A6 7C00                         ORG DSS,AT_DSS-OFFSET
       7C00                     READDISKEX:
0001A6 7C00 CDD07C          17      CALL    GETPARAMS
0001A9 7C03 AF               4      XOR A
0001AA 7C04 32827C          13      LD  (RETRY_RDDISK),A
0001AD 7C07 2A5C7D          16      LD  HL,(S_PARAMS+2)
0001B0 7C0A 7D               4      LD  A,L
0001B1 7C0B 3D               4      DEC A
0001B2 7C0C B4               4      OR  H
0001B3 7C0D 200C            12      JR  NZ,RDDISK0
0001B5 7C0F 2A5F7D          16      LD  HL,(S_PARAMS+5)
0001B8 7C12 7C               4      LD  A,H
0001B9 7C13 BD               4      CP  L
0001BA 7C14 2005            12      JR  NZ,RDDISK0
0001BC 7C16 3E03             7      LD  A,3
0001BE 7C18 32827C          13      LD  (RETRY_RDDISK),A
       7C1B                     RDDISK0:
0001C1 7C1B 3E46             7      LD  A,46H       ;READ DATA
0001C3 7C1D CDDD7C          17      CALL    FDCOMMAND
0001C6 7C20 DAA47C          10      JP  C,FINISH_DISK
       7C23                     RDDISK1:
0001C9 7C23 FB               4      EI
0001CA 7C24 76               4      HALT
0001CB 7C25 DBFA            11      IN  A,(0FAH)    ;FDC μPD765A ステータスレジスタリード
0001CD 7C27 E620             7      AND 20H     ;NO SERVICE
0001CF 7C29 2808            12      JR  Z,RDDISK2
0001D1 7C2B DBFB            11      IN  A,(0FBH)    ;FDC μPD765A データレジスタ
0001D3 7C2D 77               7      LD  (HL),A
0001D4 7C2E EDA1            16      CPI
0001D6 7C30 EA237C          10      JP  PE,RDDISK1
       7C33                     RDDISK2:
0001D9 7C33 78               4      LD  A,B
0001DA 7C34 B1               4      OR  C
0001DB 7C35 32637D          13      LD  (S_LEFT),A
0001DE 7C38 7B               4      LD  A,E
0001DF 7C39 3D               4      DEC A
0001E0 7C3A B2               4      OR  D
0001E1 7C3B 2037            12      JR  NZ,WRDISK3
                                                ;2D/2DDを見分ける
                                                ;BPB
0001E3 7C3D 2A0B40          16      LD  HL,(DSS_DATA+11);BPB_BytsPerSec
0001E6 7C40 7D               4      LD  A,L
0001E7 7C41 B7               4      OR  A
0001E8 7C42 200D            12      JR  NZ,S_NOTBPB
0001EA 7C44 7C               4      LD  A,H
0001EB 7C45 FE02             7      CP  2
0001ED 7C47 2810            12      JR  Z,S_BPBOK
0001EF 7C49 FE04             7      CP  4
0001F1 7C4B 280C            12      JR  Z,S_BPBOK
0001F3 7C4D FE01             7      CP  1
0001F5 7C4F 2808            12      JR  Z,S_BPBOK
       7C51                     S_NOTBPB:   
0001F7 7C51 3A617D          13      LD  A,(S_PARAMS+7)  ;シリンダ数
0001FA 7C54 D64D             7      SUB 77
0001FC 7C56 3F               4      CCF
0001FD 7C57 1813            12      JR  DSSBPB3
       7C59                     S_BPBOK:
0001FF 7C59 3A0C40          13      LD  A,(DSS_DATA+12) ;BPB_BytsPerSec
000202 7C5C 2A1340          16      LD  HL,(DSS_DATA+19);BPB_TotSec16
000205 7C5F F604             7      OR  4
       7C61                     DSSBPB1:
000207 7C61 0F               4      RRCA
000208 7C62 3803            12      JR  C,DSSBPB2
00020A 7C64 29              11      ADD HL,HL
00020B 7C65 18FA            12      JR  DSSBPB1
       7C67                     DSSBPB2:
00020D 7C67 11C1F9          10      LD  DE,-(40*2*5*4+1)
000210 7C6A AF               4      XOR A
000211 7C6B 19              11      ADD HL,DE
       7C6C                     DSSBPB3:
000212 7C6C 8F               4      ADC A,A
000213 7C6D 87               4      ADD A,A
000214 7C6E 87               4      ADD A,A
000215 7C6F 0EFB             7      LD  C,0FBH
000217 7C71 CD467D          17      CALL    SET_WKF4
       7C74                     WRDISK3:
00021A 7C74 DBF8            11      IN  A,(0F8H)    ;FDC μPD765A TC入力
00021C 7C76 FB               4      EI
00021D 7C77 76               4      HALT
00021E 7C78 CD4500          17      CALL    CHECKRESULT
000221 7C7B 3A637D          13      LD  A,(S_LEFT)
000224 7C7E B7               4      OR  A
000225 7C7F 281D            12      JR  Z,FINISH_DISK0
       7C82                     RETRY_RDDISK    EQU $+1
000227 7C81 3E00             7      LD  A,0
000229 7C83 B7               4      OR  A
00022A 7C84 2818            12      JR  Z,FINISH_DISK0
00022C 7C86 3D               4      DEC A
00022D 7C87 32827C          13      LD  (RETRY_RDDISK),A
000230 7C8A 3A5F7D          13      LD  A,(S_PARAMS+5)
000233 7C8D FE04             7      CP  4
000235 7C8F 3003            12      JR  NC,RETRY_RDDISK1
000237 7C91 87               4      ADD A,A
000238 7C92 1802            12      JR  RETRY_RDDISK2
       7C94                     RETRY_RDDISK1:
00023A 7C94 3E01             7      LD  A,1
       7C96                     RETRY_RDDISK2:
00023C 7C96 67               4      LD  H,A
00023D 7C97 6F               4      LD  L,A
00023E 7C98 225F7D          16      LD  (S_PARAMS+5),HL
000241 7C9B C31B7C          10      JP  RDDISK0
       7C9E                     FINISH_DISK0:
000244 7C9E 3A637D          13      LD  A,(S_LEFT)
000247 7CA1 D601             7      SUB 1
000249 7CA3 3F               4      CCF
       7CA4                     FINISH_DISK:
00024A 7CA4 9F               4      SBC A,A
00024B 7CA5 32627D          13      LD  (S_CMD_STATUS),A
00024E 7CA8 C32A00          10      JP  MAIN
                                
       7CAB                     WRITEDISKEX:
000251 7CAB AF               4      XOR A
000252 7CAC 32827C          13      LD  (RETRY_RDDISK),A
000255 7CAF CDD07C          17      CALL    GETPARAMS
000258 7CB2 3E45             7      LD  A,45H       ;WRITE DATA
00025A 7CB4 CDDD7C          17      CALL    FDCOMMAND
00025D 7CB7 38EB            12      JR  C,FINISH_DISK
       7CB9                     WRDISK1:
00025F 7CB9 FB               4      EI
000260 7CBA 76               4      HALT
000261 7CBB DBFA            11      IN  A,(0FAH)    ;FDC μPD765A ステータスレジスタリード
000263 7CBD E620             7      AND 20H
000265 7CBF 2808            12      JR  Z,WRDISK2
000267 7CC1 7E               7      LD  A,(HL)
000268 7CC2 D3FB            11      OUT (0FBH),A    ;FDC μPD765A データレジスタ
00026A 7CC4 EDA1            16      CPI
00026C 7CC6 EAB97C          10      JP  PE,WRDISK1
       7CC9                     WRDISK2:
00026F 7CC9 78               4      LD  A,B
000270 7CCA B1               4      OR  C
000271 7CCB 32637D          13      LD  (S_LEFT),A
000274 7CCE 18A4            12      JR  WRDISK3
                                
       7CD0                     GETPARAMS:
000276 7CD0 0608             7      LD  B,8
000278 7CD2 E5              11      PUSH    HL
000279 7CD3 215A7D          10      LD  HL,S_PARAMS
       7CD6                     GETPARAMS1:
00027C 7CD6 D7              12      RST 10H
00027D 7CD7 77               7      LD  (HL),A
00027E 7CD8 23               6      INC HL
00027F 7CD9 10FB            13      DJNZ    GETPARAMS1
000281 7CDB E1              10      POP HL
000282 7CDC C9              10      RET
                                
       7CDD                     FDCOMMAND:
000283 7CDD F5              11      PUSH    AF
000284 7CDE 3A5E7D          13      LD  A,(S_PARAMS+4)  ;MFMモード切り替え $FF:2D/2DD $FE:2HD
000287 7CE1 1F               4      RRA
000288 7CE2 3F               4      CCF
000289 7CE3 9F               4      SBC A,A
00028A 7CE4 E605             7      AND 5
00028C 7CE6 0EFE             7      LD  C,0FEH  ;マスク
00028E 7CE8 CD467D          17      CALL    SET_WKF4
000291 7CEB D3F4            11      OUT (0F4H),A    ;ドライブ制御
                                
000293 7CED ED4B5A7D        20      LD  BC,(S_PARAMS)
000297 7CF1 ED5B5C7D        20      LD  DE,(S_PARAMS+2)
00029B 7CF5 CDAA01          17      CALL    SEEK
00029E 7CF8 E5              11      PUSH    HL
00029F 7CF9 210040          10      LD  HL,04000H
       7CFC                     WAIT_SEEK:
0002A2 7CFC CDE903          17      CALL    GETDEVSTAT
0002A5 7CFF E608             7      AND 8
0002A7 7D01 2009            12      JR  NZ,SEEK_OK
0002A9 7D03 2B               6      DEC HL
0002AA 7D04 7C               4      LD  A,H
0002AB 7D05 B5               4      OR  L
0002AC 7D06 20F4            12      JR  NZ,WAIT_SEEK
0002AE 7D08 E1              10      POP HL
0002AF 7D09 F1              10      POP AF
0002B0 7D0A 37               4      SCF
0002B1 7D0B C9              10      RET
       7D0C                     SEEK_OK:
0002B2 7D0C E1              10      POP HL
0002B3 7D0D F1              10      POP AF
0002B4 7D0E E7              12      RST 20H
0002B5 7D0F CD0E04          17      CALL    MAPDRV      ;HD US1 US0
0002B8 7D12 E7              12      RST 20H
0002B9 7D13 7A               4      LD  A,D     ;C
0002BA 7D14 CB3F             8      SRL A
0002BC 7D16 E7              12      RST 20H
0002BD 7D17 7A               4      LD  A,D     ;H
0002BE 7D18 E601             7      AND 1
0002C0 7D1A E7              12      RST 20H
0002C1 7D1B 7B               4      LD  A,E     ;R
0002C2 7D1C E7              12      RST 20H
0002C3 7D1D 3A5F7D          13      LD  A,(S_PARAMS+5)  ;N
0002C6 7D20 FE04             7      CP  4
0002C8 7D22 3802            12      JR  C,FDCOMMAND2
0002CA 7D24 3E03             7      LD  A,3
       7D26                     FDCOMMAND2:
0002CC 7D26 E7              12      RST 20H
0002CD 7D27 78               4      LD  A,B     ;EOT
0002CE 7D28 E7              12      RST 20H
0002CF 7D29 3E54             7      LD  A,054H      ;GSL
0002D1 7D2B E7              12      RST 20H
0002D2 7D2C AF               4      XOR A       ;DTL
0002D3 7D2D E7              12      RST 20H
0002D4 7D2E 0E00             7      LD  C,0
0002D6 7D30 3A607D          13      LD  A,(S_PARAMS+6)
0002D9 7D33 47               4      LD  B,A     ;バイト数H
0002DA 7D34 210040          10      LD  HL,DSS_DATA ;開始アドレス
0002DD 7D37 A7               4      AND A
0002DE 7D38 C9              10      RET
                                
       7D39                     RESULTEX:
0002DF 7D39 3A627D          13      LD  A,(S_CMD_STATUS)
0002E2 7D3C 3C               4      INC A
0002E3 7D3D 2803            12      JR  Z,RESULTEX1
0002E5 7D3F 3A607D          13      LD  A,(S_PARAMS+6)  ;バイト数H
       7D42                     RESULTEX1:
0002E8 7D42 DF              12      RST 18H
0002E9 7D43 C32A00          10      JP  MAIN
                                
       7D46                     SET_WKF4:
0002EC 7D46 47               4      LD  B,A
0002ED 7D47 3A5A7D          13      LD  A,(S_PARAMS)    ;0:ドライブA 1:ドライブB
0002F0 7D4A B7               4      OR  A
0002F1 7D4B 2804            12      JR  Z,SET_WKF4_1
0002F3 7D4D CB20             8      SLA B
0002F5 7D4F CB21             8      SLA C
       7D51                     SET_WKF4_1:
0002F7 7D51 3A647D          13      LD  A,(S_WKF4)
0002FA 7D54 A1               4      AND C
0002FB 7D55 B0               4      OR  B
0002FC 7D56 32647D          13      LD  (S_WKF4),A
0002FF 7D59 C9              10      RET
                                
       7D5A                     S_PARAMS:
000300 7D5A                         DS  8
       7D62                     S_CMD_STATUS:
000308 7D62 00                      DB  0
       7D63                     S_LEFT:
000309 7D63 00                      DB  0
       7D64                     S_WKF4:
00030A 7D64 00                      DB  0
                                
00030B D004                         ORG $$+OFFSET   ;$DEPHASE
       D004                     AT_DSSE:
                                
       D004                     INITE:
                                ;   ORG BDOS,INITE-OFFSET
00030B D004                         DS  BDOS-INITE
00030D D006 C3E7D8          10      JP  BDOS_RF
[EOF:88INIT.ASM:SHIFT_JIS]
                                    INCLUDE "88CCP.ASM"
                                
                                ;   LSX-Dodgers CCP
                                ;   PC-8801mkIISR
                                
       D009                     WBOOT1:
000310 D009 ED7B0600        20      LD  SP,(SYSTEM+1)
000314 D00D DB32            11      IN  A,(032H)
000316 D00F F610             7      OR  10H     ;高速RAMアクセスモードOFF
000318 D011 D332            11      OUT (032H),A
00031A D013 FB               4      EI
00031B D014 2192EF          10      LD  HL,_KEYD
00031E D017 3600            10      LD  (HL),0
000320 D019 CD4FDD          17      CALL    CHKEY
000323 D01C CD08D9          17      CALL    KEYBC_IFBREAK
000326 D01F 3E04             7      LD  A,4
000328 D021 CD1BD9          17      CALL    MSG_A
[EOF:88CCP.ASM:SHIFT_JIS]
                                    INCLUDE "LDCCP.ASM"
                                
                                ;   LSX-Dodgers CCP
                                
       D024                     COMMAND:
00032B D024 CDD7D0          17      CALL    SETDTA1
00032E D027 3A87EF          13      LD  A,(_DVSW)
000331 D02A C641             7      ADD A,'A'
000333 D02C CD1BD9          17      CALL    MSG_A
000336 D02F 3E3E             7      LD  A,'>'
000338 D031 CD1BD9          17      CALL    MSG_A
00033B D034 3E50             7      LD  A,80
00033D D036 12               7      LD  (DE),A
00033E D037 CD58D9          17      CALL    _SYS0A      ;(BDOS)文字列入力
000341 D03A CD81D2          17      CALL    LTNL
                                
000344 D03D 118200          10      LD  DE,DTA1+2
000347 D040 CDFDEF          17      CALL    _COMANL
00034A D043 30DF            12      JR  NC,COMMAND
00034C D045 1179EF          10      LD  DE,COMERM
00034F D048 CD25D6          17      CALL    _SYS09      ;(BDOS)文字列出力
000352 D04B C7              12      RST 0
                                
       D04C                     COMANL:
000353 D04C CD47DE          17      CALL    FILE
000356 D04F 3A19EF          13      LD  A,(FNAME+4)
000359 D052 FE20             7      CP  020H
00035B D054 201C            12      JR  NZ,COMB2
00035D D056 D5              11      PUSH    DE
00035E D057 1115EF          10      LD  DE,FNAME
000361 D05A 1A               7      LD  A,(DE)
000362 D05B FE20             7      CP  020H
000364 D05D 2844            12      JR  Z,SDVSW
000366 D05F 1B               6      DEC DE
000367 D060 1A               7      LD  A,(DE)
000368 D061 C6FF             7      ADD A,0FFH
00036A D063 3809            12      JR  C,COMB
00036C D065 13               6      INC DE
                                
00036D D066 2162D5          10      LD  HL,COMTB
000370 D069 0609             7      LD  B,COMS
000372 D06B CDCBE0          17      CALL    CPNAME
       D06E                     COMB:
000375 D06E D1              10      POP DE
000376 D06F D20F00          10      JP  NC,JP_HL
       D072                     COMB2:
000379 D072 EB               4      EX  DE,HL
00037A D073 224BD1          16      LD  (COMPAT+1),HL
00037D D076 F5              11      PUSH    AF
00037E D077 CDF7D0          17      CALL    CEXE4
000381 D07A F1              10      POP AF
000382 D07B 2115EF          10      LD  HL,FNAME
000385 D07E 116D00          10      LD  DE,FCB2+1   ;COMMAND NAME
000388 D081 010B00          10      LD  BC,11
00038B D084 EDB0                    LDIR
00038D D086 1105D5          10      LD  DE,PATHD
       D089                     CEX1:
000390 D089 1A               7      LD  A,(DE)
000391 D08A FE20             7      CP  020H
000393 D08C D8              11      RET C
000394 D08D CD3CDE          17      CALL    FILEC
000397 D090 D5              11      PUSH    DE
000398 D091 216D00          10      LD  HL,FCB2+1   ;COMMAND NAME
00039B D094 1115EF          10      LD  DE,FNAME
00039E D097 010B00          10      LD  BC,11
0003A1 D09A EDB0                    LDIR
0003A3 D09C CDF7D0          17      CALL    CEXE4
0003A6 D09F D1              10      POP DE
0003A7 D0A0 13               6      INC DE
0003A8 D0A1 18E6            12      JR  CEX1
                                
       D0A3                     SDVSW:
0003AA D0A3 F1              10      POP AF
0003AB D0A4 3A14EF          13      LD  A,(FDRV)
0003AE D0A7 3D               4      DEC A
0003AF D0A8 5F               4      LD  E,A
0003B0 D0A9 0E0E             7      LD  C,00EH      ;(BDOS)カレントドライブの設定
0003B2 D0AB 1831            12      JR  SYSTEM0
                                
       D0AD                     OPEN1:
0003B4 D0AD 2114EF          10      LD  HL,FDRV
       D0B0                     OPEN:
0003B7 D0B0 0E11             7      LD  C,011H      ;(BDOS)ファイルの検索
       D0B2                     OPEN3:
0003B9 D0B2 D5              11      PUSH    DE
0003BA D0B3 11E0D4          10      LD  DE,DTA_CCP
0003BD D0B6 CDD4D0          17      CALL    SETDTA
0003C0 D0B9 EB               4      EX  DE,HL
0003C1 D0BA CDDED0          17      CALL    SYSTEM0
0003C4 D0BD D1              10      POP DE
0003C5 D0BE C9              10      RET
                                
       D0BF                     OPEN2:
0003C6 D0BF 0E12             7      LD  C,012H
0003C8 D0C1 18EF            12      JR  OPEN3
                                
       D0C3                     DEFCB:              ;Z=Ok NZ=Error
0003CA D0C3 11E0D4          10      LD  DE,DTA_CCP
0003CD D0C6 CDDCD0          17      CALL    SYSC0F
                                
0003D0 D0C9 1101D5          10      LD  DE,DTA_CCP+33   ;(FCB)ランダムレコード
0003D3 D0CC 0604             7      LD  B,4
0003D5 D0CE CDBFD3          17      CALL    ZERO_MEMORY_DE
0003D8 D0D1 110001          10      LD  DE,00100H
       D0D4                     SETDTA:
0003DB D0D4 C323D8          10      JP  _SYS1A      ;(BDOS)DTAの設定
                                
       D0D7                     SETDTA1:
0003DE D0D7 118000          10      LD  DE,DTA1
0003E1 D0DA 18F8            12      JR  SETDTA
                                
       D0DC                     SYSC0F:
0003E3 D0DC 0E0F             7      LD  C,00FH      ;(BDOS)ファイルのオープン
       D0DE                     SYSTEM0:
0003E5 D0DE CD0500          17      CALL    SYSTEM
0003E8 D0E1 B7               4      OR  A
0003E9 D0E2 C9              10      RET
                                
       D0E3                     C_CD:
0003EA D0E3 0E5A             7      LD  C,5AH
0003EC D0E5 18F7            12      JR  SYSTEM0
                                
       D0E7                     S27BUF:
0003EE D0E7 3A0700          13      LD  A,(SYSTEM+2)
0003F1 D0EA 3D               4      DEC A
0003F2 D0EB E6F8             7      AND 0F8H
0003F4 D0ED 67               4      LD  H,A
0003F5 D0EE 2E00             7      LD  L,0
       D0F0                     S27DTA:
0003F7 D0F0 11E0D4          10      LD  DE,DTA_CCP
       D0F3                     S27:
0003FA D0F3 0E27             7      LD  C,027H      ;(BDOS)ランダムブロック読み込み
0003FC D0F5 18E7            12      JR  SYSTEM0
                                
       D0F7                     CEXE4:
0003FE D0F7 3A14EF          13      LD  A,(FDRV)
000401 D0FA 325700          13      LD  (00057H),A
000404 D0FD 2A22EF          16      LD  HL,(FDRV+14)
000407 D100 225800          16      LD  (00058H),HL
                                
00040A D103 211DEF          10      LD  HL,FNAME+8
00040D D106 7E               7      LD  A,(HL)
00040E D107 FE20             7      CP  020H
000410 D109 2007            12      JR  NZ,CEXE7
000412 D10B 3E3F             7      LD  A,'?'
000414 D10D 77               7      LD  (HL),A
000415 D10E 23               6      INC HL
000416 D10F 77               7      LD  (HL),A
000417 D110 23               6      INC HL
000418 D111 77               7      LD  (HL),A
       D112                     CEXE7:
000419 D112 CDADD0          17      CALL    OPEN1
       D115                     CEXE5:
00041C D115 C0              11      RET NZ
00041D D116 2AEAD4          16      LD  HL,(DTA_CCP+1+9)
000420 D119 7C               4      LD  A,H
000421 D11A CD53E1          17      CALL    CAP
000424 D11D 67               4      LD  H,A
000425 D11E 7D               4      LD  A,L
000426 D11F CD53E1          17      CALL    CAP
000429 D122 6F               4      LD  L,A
00042A D123 3AE9D4          13      LD  A,(DTA_CCP+1+8)
00042D D126 CD53E1          17      CALL    CAP
000430 D129 D642             7      SUB 'B'
000432 D12B 282C            12      JR  Z,C_BAT
000434 D12D 3D               4      DEC A       ;'C'
000435 D12E 2805            12      JR  Z,C_EXE
       D130                     CEXE6:
000437 D130 CDBFD0          17      CALL    OPEN2
00043A D133 18E0            12      JR  CEXE5
                                
       D135                     C_EXE:
00043C D135 7C               4      LD  A,H
00043D D136 FE4D             7      CP  'M'
00043F D138 20F6            12      JR  NZ,CEXE6
                                
000441 D13A CDC3D0          17      CALL    DEFCB
000444 D13D CDE7D0          17      CALL    S27BUF
000447 D140 3D               4      DEC A
000448 D141 37               4      SCF
000449 D142 C0              11      RET NZ
00044A D143 7C               4      LD  A,H
00044B D144 B5               4      OR  L
00044C D145 37               4      SCF
00044D D146 C8              11      RET Z
00044E D147 CDD7D0          17      CALL    SETDTA1
000451 D14A 110000          10  COMPAT: LD  DE,0                ; self-modifying code
000454 D14D ED7B0600        20      LD  SP,(SYSTEM+1)
000458 D151 67               4      LD  H,A             ; A=0 in SETDTA1(_SYS1A)
000459 D152 6F               4      LD  L,A
00045A D153 E5              11      PUSH    HL              ; push $0000 (reboot address)
00045B D154 24               4      INC H
00045C D155 E5              11      PUSH    HL              ; push $0100 (TPA address)
00045D D156 C38AD3          10      JP  SETFCB              ; and JP $0100
                                
       D159                     C_BAT:
000460 D159 114154          10      LD  DE,'A'+'T'*256
000463 D15C ED52            15      SBC HL,DE
000465 D15E 20D0            12      JR  NZ,CEXE6
                                
000467 D160 F1              10      POP AF
000468 D161 F1              10      POP AF
000469 D162 CDC3D0          17      CALL    DEFCB
00046C D165 210002          10      LD  HL,00200H
00046F D168 CDF0D0          17      CALL    S27DTA
000472 D16B C6FE             7      ADD A,0FEH
000474 D16D D8              11      RET C
000475 D16E 7D               4      LD  A,L
000476 D16F B7               4      OR  A
000477 D170 37               4      SCF
000478 D171 C8              11      RET Z
000479 D172 3C               4      INC A
00047A D173 F5              11      PUSH    AF
                                
00047B D174 CD0BD9          17      CALL    KEYBC
00047E D177 3E06             7      LD  A,6
000480 D179 CD1BD9          17      CALL    MSG_A
000483 D17C C1              10      POP BC
000484 D17D 210001          10      LD  HL,00100H
       D180                     BAT1:
000487 D180 A7               4      AND A
000488 D181 05               4      DEC B
000489 D182 C8              11      RET Z
00048A D183 7E               7      LD  A,(HL)
00048B D184 FE25             7      CP  '%'
00048D D186 280C            12      JR  Z,BAT2
       D188                     BAT1X:
00048F D188 7E               7      LD  A,(HL)
000490 D189 23               6      INC HL
000491 D18A FE1A             7      CP  01AH
000493 D18C C8              11      RET Z
000494 D18D FE0A             7      CP  00AH
000496 D18F C4F0D8          17      CALL    NZ,KEYBS
000499 D192 18EC            12      JR  BAT1
                                
       D194                     BAT2:
00049B D194 23               6      INC HL
00049C D195 7E               7      LD  A,(HL)
00049D D196 2B               6      DEC HL
00049E D197 D631             7      SUB '1'
0004A0 D199 38ED            12      JR  C,BAT1X
0004A2 D19B FE09             7      CP  9
0004A4 D19D 30E9            12      JR  NC,BAT1X
0004A6 D19F 23               6      INC HL
0004A7 D1A0 23               6      INC HL
0004A8 D1A1 3C               4      INC A
0004A9 D1A2 4F               4      LD  C,A
0004AA D1A3 ED5B4BD1        20      LD  DE,(COMPAT+1)
       D1A7                     BAT3:
0004AE D1A7 1A               7      LD  A,(DE)
0004AF D1A8 B7               4      OR  A
0004B0 D1A9 28D5            12      JR  Z,BAT1
0004B2 D1AB CD1EDF          17      CALL    SPCUT
0004B5 D1AE 0D               4      DEC C
0004B6 D1AF 2808            12      JR  Z,BAT5
       D1B1                     BAT4:
0004B8 D1B1 1A               7      LD  A,(DE)
0004B9 D1B2 FE21             7      CP  021H
0004BB D1B4 38F1            12      JR  C,BAT3
0004BD D1B6 13               6      INC DE
0004BE D1B7 18F8            12      JR  BAT4
       D1B9                     BAT5:
0004C0 D1B9 1A               7      LD  A,(DE)
0004C1 D1BA FE21             7      CP  021H
0004C3 D1BC 38C2            12      JR  C,BAT1
0004C5 D1BE 13               6      INC DE
0004C6 D1BF CDF0D8          17      CALL    KEYBS
0004C9 D1C2 18F5            12      JR  BAT5
                                
       D1C4                     C_DEL:
0004CB D1C4 CD8AD3          17      CALL    SETFCB
0004CE D1C7 CD31D9          17      CALL    _SYS08      ;(BDOS)エコーなしコンソール入力
                                
0004D1 D1CA 0E13             7      LD  C,013H
0004D3 D1CC 180A            12      JR  CDEL1       ;(BDOS)ファイルの削除
                                
       D1CE                     C_REN:
0004D5 D1CE CD8AD3          17      CALL    SETFCB
0004D8 D1D1 3E10             7      LD  A,010H      ;ディレクトリも対象にする
0004DA D1D3 326900          13      LD  (FCB1+13),A ;属性
0004DD D1D6 0E17             7      LD  C,017H      ;(BDOS)ファイル名の変更
       D1D8                     CDEL1:
0004DF D1D8 115C00          10      LD  DE,FCB1
0004E2 D1DB CD0500          17      CALL    SYSTEM
0004E5 D1DE C6FF             7      ADD A,0FFH
0004E7 D1E0 C9              10      RET
                                
       D1E1                     C_DIR:
0004E8 D1E1 CD3CDE          17      CALL    FILEC
0004EB D1E4 2115EF          10      LD  HL,FDRV+1
0004EE D1E7 CDD5D4          17      CALL    CWILD1
0004F1 D1EA 3EF1             7      LD  A,0F1H
0004F3 D1EC 3221EF          13      LD  (FDRV+13),A
0004F6 D1EF CDADD0          17      CALL    OPEN1
       D1F2                     CDIR1:
0004F9 D1F2 B7               4      OR  A
0004FA D1F3 2008            12      JR  NZ,PDSKF
0004FC D1F5 CD40D2          17      CALL    P_NAME
0004FF D1F8 CDBFD0          17      CALL    OPEN2
000502 D1FB 18F5            12      JR  CDIR1
                                
       D1FD                     PDSKF:
000504 D1FD 3A14EF          13      LD  A,(FDRV)
000507 D200 5F               4      LD  E,A
000508 D201 0E1B             7      LD  C,01BH      ;(BDOS)ディスク情報の獲得
00050A D203 CD0500          17      CALL    SYSTEM
00050D D206 4F               4      LD  C,A     ;C←1クラスタ辺りの論理セクタ数
00050E D207 C601             7      ADD A,001H
000510 D209 D8              11      RET C       ;Aが0FFHだった場合
000511 D20A 3E06             7      LD  A,8-2
       D20C                     PDS1:               ;HL=未使用クラスタの総数
000513 D20C 3C               4      INC A
000514 D20D CB19             8      RR  C
000516 D20F 30FB            12      JR  NC,PDS1
       D211                     PDS2:               ;B←論理セクタのサイズの上位8ビット
000518 D211 3C               4      INC A
000519 D212 CB18             8      RR  B
00051B D214 30FB            12      JR  NC,PDS2
00051D D216 47               4      LD  B,A
                                
00051E D217 110000          10      LD  DE,0
       D21A                     PDS3:
000521 D21A 29              11      ADD HL,HL
000522 D21B EB               4      EX  DE,HL
000523 D21C ED6A            15      ADC HL,HL
000525 D21E EB               4      EX  DE,HL
000526 D21F 10F9            13      DJNZ    PDS3
       D221                     PDSKF1:
000528 D221 CDB9D2          17      CALL    PRDEC_DEHL
00052B D224 1146D5          10      LD  DE,FREE
00052E D227 CD25D6          17      CALL    _SYS09      ;(BDOS)文字列出力
000531 D22A CDA8D2          17      CALL    PUTDRV
000534 D22D 3E5C             7      LD  A,05CH      ;\
000536 D22F CD1BD9          17      CALL    MSG_A
000539 D232 2A22EF          16      LD  HL,(FDRV+14)    ;ディレクトリのクラスタ番号
00053C D235 AF               4      XOR A
00053D D236 11FEFF          10      LD  DE,0-2
000540 D239 19              11      ADD HL,DE
000541 D23A 23               6      INC HL
000542 D23B DCB5D2          17      CALL    C,PRDEC_HL
000545 D23E 1841            12      JR  LTNL
                                
       D240                     P_NAME:
000547 D240 3AE1D4          13      LD  A,(DTA_CCP+1)
00054A D243 FE2E             7      CP  '.'
00054C D245 C8              11      RET Z
00054D D246 115ED5          10      LD  DE,DIRHD
000550 D249 CD25D6          17      CALL    _SYS09      ;(BDOS)文字列出力
000553 D24C 3AECD4          13      LD  A,(DTA_CCP+1+00BH)
000556 D24F F5              11      PUSH    AF
000557 D250 0F               4      RRCA
000558 D251 9F               4      SBC A,A
000559 D252 E60A             7      AND '*'-020H
00055B D254 C620             7      ADD A,020H
00055D D256 CD1BD9          17      CALL    MSG_A
000560 D259 CDA8D2          17      CALL    PUTDRV
000563 D25C 21E1D4          10      LD  HL,DTA_CCP+1
000566 D25F CDF9D2          17      CALL    FPRNT
                                
000569 D262 F1              10      POP AF
00056A D263 CB67             8      BIT 4,A
00056C D265 2808            12      JR  Z,DIR3
00056E D267 1153D5          10      LD  DE,DIRMES
000571 D26A CD25D6          17      CALL    _SYS09      ;(BDOS)文字列出力
000574 D26D 180A            12      JR  DIR6
       D26F                     DIR3:
000576 D26F ED5BFFD4        20      LD  DE,(DTA_CCP+1+01EH)
00057A D273 2AFDD4          16      LD  HL,(DTA_CCP+1+01CH)
00057D D276 CDB9D2          17      CALL    PRDEC_DEHL
       D279                     DIR6:
000580 D279 3AB1EF          13      LD  A,(_WIDTH)
000583 D27C FE29             7      CP  40+1
000585 D27E D41BD3          17      CALL    NC,PRTTMS
                                
       D281                     LTNL:
000588 D281 1E03             7      LD  E,3
00058A D283 C3CDEF          10      JP  _PRINT
                                
       D286                     C_PATH:
00058D D286 CD1EDF          17      CALL    SPCUT
000590 D289 2105D5          10      LD  HL,PATHD
000593 D28C FE21             7      CP  021H
000595 D28E 300C            12      JR  NC,CPATH0
       D290                     CPATHP:
000597 D290 7E               7      LD  A,(HL)
000598 D291 23               6      INC HL
000599 D292 FE20             7      CP  020H
00059B D294 3F               4      CCF
00059C D295 30EA            12      JR  NC,LTNL
00059E D297 CD1BD9          17      CALL    MSG_A
0005A1 D29A 18F4            12      JR  CPATHP
       D29C                     CPATH0:
0005A3 D29C FE3B             7      CP  ';'
0005A5 D29E 2001            12      JR  NZ,CPATH1
0005A7 D2A0 13               6      INC DE
       D2A1                     CPATH1:
0005A8 D2A1 EB               4      EX  DE,HL
0005A9 D2A2 014000          10      LD  BC,PATHX
0005AC D2A5 EDB0                    LDIR
0005AE D2A7 C9              10      RET
                                
       D2A8                     PUTDRV:
0005AF D2A8 3A14EF          13      LD  A,(FDRV)
0005B2 D2AB C640             7      ADD A,'A'-1
0005B4 D2AD CD1BD9          17      CALL    MSG_A
0005B7 D2B0 3E3A             7      LD  A,':'
       D2B2                     MSG_AR:
0005B9 D2B2 C31BD9          10      JP  MSG_A
                                
       D2B5                     PRDEC_HL:
0005BC D2B5 AF               4      XOR A
       D2B6                     PRDEC_AHL:
0005BD D2B6 5F               4      LD  E,A
0005BE D2B7 1600             7      LD  D,0
       D2B9                     PRDEC_DEHL:
0005C0 D2B9 D5              11      PUSH    DE
0005C1 D2BA 110FEF          10      LD  DE,DECBF
0005C4 D2BD 0605             7      LD  B,5
0005C6 D2BF CDBFD3          17      CALL    ZERO_MEMORY_DE  ;A=0
0005C9 D2C2 D1              10      POP DE
                                
0005CA D2C3 0E20             7      LD  C,32
       D2C5                     DEC1:
0005CC D2C5 29              11      ADD HL,HL
0005CD D2C6 EB               4      EX  DE,HL
0005CE D2C7 ED6A            15      ADC HL,HL
0005D0 D2C9 EB               4      EX  DE,HL
0005D1 D2CA E5              11      PUSH    HL
0005D2 D2CB 2113EF          10      LD  HL,DECBF+4
0005D5 D2CE 0605             7      LD  B,5
       D2D0                     DEC2:
0005D7 D2D0 7E               7      LD  A,(HL)
0005D8 D2D1 8F               4      ADC A,A
0005D9 D2D2 27               4      DAA
0005DA D2D3 77               7      LD  (HL),A
0005DB D2D4 2B               6      DEC HL
0005DC D2D5 10F9            13      DJNZ    DEC2
0005DE D2D7 E1              10      POP HL
0005DF D2D8 0D               4      DEC C
0005E0 D2D9 20EA            12      JR  NZ,DEC1
                                
0005E2 D2DB 210FEF          10      LD  HL,DECBF
0005E5 D2DE 3E20             7      LD  A,020H
0005E7 D2E0 0604             7      LD  B,4
       D2E2                     DEC3:
0005E9 D2E2 CDEFD2          17      CALL    DEC4
0005EC D2E5 CDEFD2          17      CALL    DEC4
0005EF D2E8 23               6      INC HL
0005F0 D2E9 10F7            13      DJNZ    DEC3
       D2EB                     DECX:
0005F2 D2EB CDEFD2          17      CALL    DEC4
0005F5 D2EE AF               4      XOR A
       D2EF                     DEC4:
0005F6 D2EF ED6F            18      RLD
0005F8 D2F1 FE20             7      CP  020H
0005FA D2F3 2802            12      JR  Z,DEC5
0005FC D2F5 F630             7      OR  030H
       D2F7                     DEC5:
0005FE D2F7 18B9            12      JR  MSG_AR
                                
       D2F9                     FPRNT:
000600 D2F9 0608             7      LD  B,8
000602 D2FB CD0CD3          17      CALL    P_N1
000605 D2FE 7E               7      LD  A,(HL)
000606 D2FF C680             7      ADD A,0A0H-020H
000608 D301 FEA0             7      CP  0A0H
00060A D303 2802            12      JR  Z,FPR1
00060C D305 3E2E             7      LD  A,'.'
       D307                     FPR1:
00060E D307 CD1BD9          17      CALL    MSG_A
000611 D30A 0603             7      LD  B,3
                                
       D30C                     P_N1:
000613 D30C C5              11      PUSH    BC
000614 D30D E5              11      PUSH    HL
000615 D30E 7E               7      LD  A,(HL)
000616 D30F CD5FE1          17      CALL    CAP3
000619 D312 CD1BD9          17      CALL    MSG_A
00061C D315 E1              10      POP HL
00061D D316 C1              10      POP BC
00061E D317 23               6      INC HL
00061F D318 10F2            13      DJNZ    P_N1
000621 D31A C9              10      RET
                                
       D31B                     PRTTMS:
000622 D31B 3E20             7      LD  A,020H
000624 D31D CD1BD9          17      CALL    MSG_A
                                
000627 D320 2AF9D4          16      LD  HL,(DTA_CCP+1+24)
00062A D323 7D               4      LD  A,L
00062B D324 B7               4      OR  A
00062C D325 C8              11      RET Z
00062D D326 CB3C             8      SRL H
00062F D328 17               4      RLA
000630 D329 17               4      RLA
000631 D32A 17               4      RLA
000632 D32B 17               4      RLA
000633 D32C E60F             7      AND 00FH
000635 D32E 57               4      LD  D,A
000636 D32F 7C               4      LD  A,H
000637 D330 C650             7      ADD A,80
000639 D332 CD75D3          17      CALL    PRDEC_A
00063C D335 3E2D             7      LD  A,'-'
00063E D337 CD1BD9          17      CALL    MSG_A
000641 D33A 7A               4      LD  A,D
000642 D33B CD75D3          17      CALL    PRDEC_A
000645 D33E 3E2D             7      LD  A,'-'
000647 D340 CD1BD9          17      CALL    MSG_A
00064A D343 7D               4      LD  A,L
00064B D344 E61F             7      AND 01FH
00064D D346 CD75D3          17      CALL    PRDEC_A
                                
000650 D349 2AF7D4          16      LD  HL,(DTA_CCP+1+22)
                                
000653 D34C 3E20             7      LD  A,020H
000655 D34E CD1BD9          17      CALL    MSG_A
000658 D351 7C               4      LD  A,H
000659 D352 65               4      LD  H,L
00065A D353 0603             7      LD  B,3
       D355                     PRTTMS1:
00065C D355 1F               4      RRA
00065D D356 CB1D             8      RR  L
00065F D358 10FB            13      DJNZ    PRTTMS1
000661 D35A E61F             7      AND 01FH
000663 D35C CD75D3          17      CALL    PRDEC_A
000666 D35F 3E3A             7      LD  A,':'
000668 D361 CD1BD9          17      CALL    MSG_A
00066B D364 7D               4      LD  A,L
00066C D365 0F               4      RRCA
00066D D366 0F               4      RRCA
00066E D367 E63F             7      AND 03FH
000670 D369 CD75D3          17      CALL    PRDEC_A
000673 D36C 3E3A             7      LD  A,':'
000675 D36E CD1BD9          17      CALL    MSG_A
000678 D371 7C               4      LD  A,H
000679 D372 E61F             7      AND 01FH
00067B D374 87               4      ADD A,A
                                
                                ;   PRINT10
                                
       D375                     PRDEC_A:
00067C D375 E5              11      PUSH    HL
00067D D376 0608             7      LD  B,8
00067F D378 4F               4      LD  C,A
000680 D379 AF               4      XOR A
       D37A                     PRTA1:
000681 D37A CB01             4      RLC C
000683 D37C 8F               4      ADC A,A
000684 D37D 27               4      DAA
000685 D37E 10FA            13      DJNZ    PRTA1
000687 D380 210FEF          10      LD  HL,DECBF
00068A D383 77               7      LD  (HL),A
00068B D384 AF               4      XOR A
00068C D385 CDEBD2          17      CALL    DECX
00068F D388 E1              10      POP HL
000690 D389 C9              10      RET
                                
       D38A                     SETFCB:
000691 D38A CD1EDF          17      CALL    SPCUT
000694 D38D 1A               7      LD  A,(DE)
000695 D38E FE20             7      CP  020H
000697 D390 3801            12      JR  C,SETFCBA
000699 D392 1B               6      DEC DE
       D393                     SETFCBA:
00069A D393 0624             7      LD  B,36
00069C D395 215C00          10      LD  HL,FCB1
00069F D398 E5              11      PUSH    HL
0006A0 D399 AF               4      XOR A
0006A1 D39A CDF3DE          17      CALL    FILL_MEMORY
0006A4 D39D E1              10      POP HL
0006A5 D39E D5              11      PUSH    DE
0006A6 D39F CD8FD8          17      CALL    _SYS5C      ;(BDOS)ファイル名の解析
0006A9 D3A2 216C00          10      LD  HL,FCB2
0006AC D3A5 CD8FD8          17      CALL    _SYS5C      ;(BDOS)ファイル名の解析
0006AF D3A8 E1              10      POP HL
0006B0 D3A9 010050          10      LD  BC,05000H
0006B3 D3AC 118100          10      LD  DE,00081H
       D3AF                     SETFCB1:
0006B6 D3AF 7E               7      LD  A,(HL)
0006B7 D3B0 23               6      INC HL
0006B8 D3B1 FE20             7      CP  020H
0006BA D3B3 3805            12      JR  C,SETFCB2
0006BC D3B5 12               7      LD  (DE),A
0006BD D3B6 13               6      INC DE
0006BE D3B7 0C               4      INC C
0006BF D3B8 10F5            13      DJNZ    SETFCB1
       D3BA                     SETFCB2:
0006C1 D3BA 79               4      LD  A,C
0006C2 D3BB 328000          13      LD  (DTA1),A
0006C5 D3BE 04               4      INC B
       D3BF                     ZERO_MEMORY_DE:
0006C6 D3BF AF               4      XOR A
       D3C0                     FILL_MEMORY_DE:
0006C7 D3C0 12               7      LD  (DE),A
0006C8 D3C1 13               6      INC DE
0006C9 D3C2 10FC            13      DJNZ    FILL_MEMORY_DE
0006CB D3C4 C9              10      RET
                                
       D3C5                     C_COPY:
0006CC D3C5 CD8AD3          17      CALL    SETFCB
                                
0006CF D3C8 1161EF          10      LD  DE,ZERO
0006D2 D3CB CD3FDE          17      CALL    FILEC2
0006D5 D3CE 216C00          10      LD  HL,FCB2
0006D8 D3D1 CD96D8          17      CALL    S29X1
                                
0006DB D3D4 3E10             7      LD  A,010H
0006DD D3D6 326900          13      LD  (FCB1+13),A
0006E0 D3D9 216D00          10      LD  HL,FCB2+1
0006E3 D3DC CDD5D4          17      CALL    CWILD1
       D3DF                     COPY0:
0006E6 D3DF CDD2D4          17      CALL    CWILD
0006E9 D3E2 215C00          10      LD  HL,FCB1
0006EC D3E5 CDB0D0          17      CALL    OPEN
0006EF D3E8 37               4      SCF
       D3E9                     COPY1:
0006F0 D3E9 C0              11      RET NZ
0006F1 D3EA CDC3D0          17      CALL    DEFCB
                                
0006F4 D3ED 3AEDD4          13      LD  A,(DTA_CCP+13)
0006F7 D3F0 CB67             8      BIT 4,A
0006F9 D3F2 2821            12      JR  Z,COPY1A
                                
0006FB D3F4 215D00          10      LD  HL,FCB1+1
0006FE D3F7 CD82E2          17      CALL    CHKWILD
000701 D3FA 3814            12      JR  C,COPY9
                                
000703 D3FC 3E20             7      LD  A,020H
000705 D3FE 325D00          13      LD  (FCB1+1),A
000708 D401 2AFAD4          16      LD  HL,(DTA_CCP+26)
00070B D404 23               6      INC HL
00070C D405 226A00          16      LD  (FCB1+14),HL
00070F D408 18D5            12      JR  COPY0
                                
       D40A                     COPY8:
000711 D40A CD25D6          17      CALL    _SYS09      ;(BDOS)文字列出力
000714 D40D CD81D2          17      CALL    LTNL
       D410                     COPY9:
000717 D410 CDBFD0          17      CALL    OPEN2
00071A D413 18D4            12      JR  COPY1
                                
       D415                     COPY1A:
00071C D415 216C00          10      LD  HL,FCB2
00071F D418 1114EF          10      LD  DE,FDRV
000722 D41B 01E2D4          10      LD  BC,DTA_CCP+2
000725 D41E EDA0            16      LDI
000727 D420 3E0B             7      LD  A,11
       D422                     COPY2:
000729 D422 F5              11      PUSH    AF
00072A D423 7E               7      LD  A,(HL)
00072B D424 FE3F             7      CP  '?'
00072D D426 2001            12      JR  NZ,COPY3
00072F D428 0A               7      LD  A,(BC)
       D429                     COPY3:
000730 D429 12               7      LD  (DE),A
000731 D42A 03               6      INC BC
000732 D42B 13               6      INC DE
000733 D42C 23               6      INC HL
000734 D42D F1              10      POP AF
000735 D42E 3D               4      DEC A
000736 D42F 20F1            12      JR  NZ,COPY2
000738 D431 010500          10      LD  BC,16-11
00073B D434 EDB0                    LDIR
       D436                     PUTNAME:
00073D D436 215D00          10      LD  HL,FCB1+1
000740 D439 CD82E2          17      CALL    CHKWILD
000743 D43C 300B            12      JR  NC,PUTN1
000745 D43E 2115EF          10      LD  HL,FDRV+1
000748 D441 CDF9D2          17      CALL    FPRNT
00074B D444 3E20             7      LD  A,020H
00074D D446 CD1BD9          17      CALL    MSG_A
       D449                     PUTN1:
000750 D449 1114EF          10      LD  DE,FDRV
000753 D44C 0E16             7      LD  C,016H      ;(BDOS)ファイルの作成
000755 D44E CDDED0          17      CALL    SYSTEM0
000758 D451 2048            12      JR  NZ,COPYE2
00075A D453 67               4      LD  H,A     ;A=0
00075B D454 6F               4      LD  L,A
00075C D455 2235EF          16      LD  (FDRV+33),HL    ;(FCB)ランダムレコード
00075F D458 2237EF          16      LD  (FDRV+35),HL
       D45B                     COPY6:
000762 D45B CDE7D0          17      CALL    S27BUF
000765 D45E 47               4      LD  B,A
000766 D45F 3C               4      INC A
000767 D460 2831            12      JR  Z,COPYE
000769 D462 7C               4      LD  A,H
00076A D463 B5               4      OR  L
00076B D464 280C            12      JR  Z,COPY7
00076D D466 1114EF          10      LD  DE,FDRV
000770 D469 0E26             7      LD  C,026H      ;(BDOS)ランダムブロック書き込み
000772 D46B CDDED0          17      CALL    SYSTEM0
000775 D46E 2023            12      JR  NZ,COPYE
000777 D470 10E9            13      DJNZ    COPY6
       D472                     COPY7:
000779 D472 3AEDD4          13      LD  A,(DTA_CCP+13)  ;(FCB)属性
00077C D475 3221EF          13      LD  (FDRV+13),A
00077F D478 21F4D4          10      LD  HL,DTA_CCP+20   ;(FCB)タイムスタンプ
000782 D47B 1128EF          10      LD  DE,FDRV+20
000785 D47E 010400          10      LD  BC,4
000788 D481 EDB0                    LDIR
                                
00078A D483 1114EF          10      LD  DE,FDRV
00078D D486 0E10             7      LD  C,010H      ;(BDOS)ファイルのクローズ
00078F D488 CDDED0          17      CALL    SYSTEM0
000792 D48B 2006            12      JR  NZ,COPYE
                                
000794 D48D 1171EF          10      LD  DE,OK
000797 D490 C30AD4          10      JP  COPY8
                                
       D493                     COPYE:
00079A D493 1114EF          10      LD  DE,FDRV
00079D D496 0E13             7      LD  C,013H      ;(BDOS)ファイルの削除
00079F D498 CD0500          17      CALL    SYSTEM
       D49B                     COPYE2:
0007A2 D49B 37               4      SCF
0007A3 D49C C9              10      RET
                                
       D49D                     C_TYPE:
0007A4 D49D CD8AD3          17      CALL    SETFCB
0007A7 D4A0 215C00          10      LD  HL,FCB1
0007AA D4A3 CDB0D0          17      CALL    OPEN
0007AD D4A6 37               4      SCF
       D4A7                     TYPE1:
0007AE D4A7 C0              11      RET NZ
0007AF D4A8 CDC3D0          17      CALL    DEFCB
0007B2 D4AB 3E06             7      LD  A,6
0007B4 D4AD CD1BD9          17      CALL    MSG_A
       D4B0                     TYPE2:
0007B7 D4B0 CDE7D0          17      CALL    S27BUF
0007BA D4B3 C6FE             7      ADD A,0FEH
0007BC D4B5 D8              11      RET C
0007BD D4B6 7C               4      LD  A,H
0007BE D4B7 B5               4      OR  L
0007BF D4B8 2813            12      JR  Z,TYPEE
0007C1 D4BA 010001          10      LD  BC,00100H
       D4BD                     TYPE3:
0007C4 D4BD 0A               7      LD  A,(BC)
0007C5 D4BE 03               6      INC BC
0007C6 D4BF FE1A             7      CP  01AH
0007C8 D4C1 280A            12      JR  Z,TYPEE
0007CA D4C3 CD1BD9          17      CALL    MSG_A
0007CD D4C6 2B               6      DEC HL
0007CE D4C7 7C               4      LD  A,H
0007CF D4C8 B5               4      OR  L
0007D0 D4C9 20F2            12      JR  NZ,TYPE3
0007D2 D4CB 18E3            12      JR  TYPE2
       D4CD                     TYPEE:
0007D4 D4CD CDBFD0          17      CALL    OPEN2
0007D7 D4D0 18D5            12      JR  TYPE1
                                
       D4D2                     CWILD:
0007D9 D4D2 215D00          10      LD  HL,FCB1+1
       D4D5                     CWILD1:
0007DC D4D5 7E               7      LD  A,(HL)
0007DD D4D6 FE20             7      CP  020H
0007DF D4D8 C0              11      RET NZ
       D4D9                     CWILD2:
0007E0 D4D9 3E3F             7      LD  A,'?'
0007E2 D4DB 060B             7      LD  B,11
0007E4 D4DD C3F3DE          10      JP  FILL_MEMORY
                                
       D4E0                     DTA_CCP:
0007E7 D4E0                         DS  37
                                
       0040                     PATHX   EQU 64
00080C D505                     PATHD:  DS  PATHX
00084C D545 00                  PATHE:  DB  0
                                
00084D D546 2062797465732066    FREE:   DB  " bytes free",9,'$'
            7265650924          
00085A D553 20202020203C4449    DIRMES: DB  "     <DIR>$"
            523E24              
000865 D55E 20203A24            DIRHD:  DB  "  :$"
                                
       D562                     COMTB:
000869 D562 44202020                DB  "D   "  ;1
00086D D566 E1D1                    DW  C_DIR
00086F D568 44495220                DB  "DIR "  ;2
000873 D56C E1D1                    DW  C_DIR
000875 D56E 434F5059                DB  "COPY"  ;3
000879 D572 C5D3                    DW  C_COPY
00087B D574 43442020                DB  "CD  "  ;4
00087F D578 E3D0                    DW  C_CD
000881 D57A 44454C20                DB  "DEL "  ;5
000885 D57E C4D1                    DW  C_DEL
000887 D580 50415448                DB  "PATH"  ;6
00088B D584 86D2                    DW  C_PATH
00088D D586 52454E20                DB  "REN "  ;7
000891 D58A CED1                    DW  C_REN
000893 D58C 54595045                DB  "TYPE"  ;8
000897 D590 9DD4                    DW  C_TYPE
000899 D592 52454D20                DB  "REM "  ;9
00089D D596 22D6                    DW  C_REM
[EOF:LDCCP.ASM:SHIFT_JIS]
                                    INCLUDE "88DISK2.ASM"
                                
                                ;   LSX-Dodgers DISK2
                                ;   PC-8801mkIISR
                                
                                ;   BANK RAM DISK DRIVER
                                
       D598                     BDWT:
00089F D598 3E10             7      LD  A,010H  ;ライト可　リード不可
0008A1 D59A 1802            12  JR  BRW
                                
       D59C                     BDRD:
0008A3 D59C 3E01             7      LD  A,001H  ;ライト不可　リード可
       D59E                     BRW:
0008A5 D59E F3               4      DI
0008A6 D59F D3E2            11      OUT (0E2H),A    ;拡張RAM リード/ライト制御
0008A8 D5A1 ED73D7D5        20      LD  (BANKSP+1),SP
0008AC D5A5 3AD8D5          13      LD  A,(BANKSP+2)
0008AF D5A8 87               4      ADD A,A
0008B0 D5A9 3803            12      JR  C,BRW1
0008B2 D5AB 31C8ED          10      LD  SP,EXTSP
       D5AE                     BRW1:
0008B5 D5AE C5              11      PUSH    BC
0008B6 D5AF D5              11      PUSH    DE
0008B7 D5B0 EB               4      EX  DE,HL
0008B8 D5B1 29              11      ADD HL,HL
0008B9 D5B2 29              11      ADD HL,HL
0008BA D5B3 7C               4      LD  A,H
0008BB D5B4 E60F             7      AND 00FH        ;バンク
0008BD D5B6 D3E3            11      OUT (0E3H),A    ;拡張RAM バンク選択
0008BF D5B8 65               4      LD  H,L
0008C0 D5B9 CB3C             8      SRL H   ;/2
0008C2 D5BB 2E00             7      LD  L,0
0008C4 D5BD DBE2            11      IN  A,(0E2H)    ;拡張RAM リード/ライト制御
0008C6 D5BF 0F               4      RRCA
0008C7 D5C0 3001            12      JR  NC,BRW2
0008C9 D5C2 EB               4      EX  DE,HL
       D5C3                     BRW2:
0008CA D5C3 010002          10      LD  BC,512
0008CD D5C6 EDB0                    LDIR
                                
0008CF D5C8 DBE2            11      IN  A,(0E2H)    ;拡張RAM リード/ライト制御
0008D1 D5CA 0F               4      RRCA
0008D2 D5CB 3801            12      JR  C,BRW3
0008D4 D5CD EB               4      EX  DE,HL
       D5CE                     BRW3:
0008D5 D5CE D1              10      POP DE
0008D6 D5CF C1              10      POP BC
0008D7 D5D0 13               6      INC DE
0008D8 D5D1 10DB            13      DJNZ    BRW1
                                
0008DA D5D3 AF               4      XOR A
0008DB D5D4 D3E2            11      OUT (0E2H),A    ;メインメモリに切り替える
0008DD D5D6 310000          10  BANKSP: LD  SP,0
0008E0 D5D9 FB               4      EI
0008E1 D5DA C9              10      RET
                                
[EOF:88DISK2.ASM:SHIFT_JIS]
                                    INCLUDE "LDOS.ASM"
                                
                                ;   LSX-Dodgers OS
                                
       D5DB                     BDOS0:
0008E2 D5DB ED73EFD5        20      LD  (BDSP+1),SP
0008E6 D5DF F5              11      PUSH    AF
0008E7 D5E0 3AF0D5          13      LD  A,(BDSP+2)
0008EA D5E3 FEED             7      CP  EXTSP/256
0008EC D5E5 280B            12      JR  Z,BDOS1X
       D5E7                     BDOS2:
0008EE D5E7 F1              10      POP AF
0008EF D5E8 31C8ED          10      LD  SP,EXTSP
0008F2 D5EB CDF3D5          17      CALL    BDOS1
0008F5 D5EE 310000          10  BDSP:   LD  SP,0
0008F8 D5F1 C9              10      RET
       D5F2                     BDOS1X:
0008F9 D5F2 F1              10      POP AF
       D5F3                     BDOS1:
0008FA D5F3 E5              11      PUSH    HL
0008FB D5F4 79               4      LD  A,C
0008FC D5F5 FE3C             7      CP  03CH
0008FE D5F7 3802            12      JR  C,DOS1
000900 D5F9 3E3C             7      LD  A,03CH
       D5FB                     DOS1:
000902 D5FB 87               4      ADD A,A
000903 D5FC 6F               4      LD  L,A
000904 D5FD 26F0             7      LD  H,STABLE/256
000906 D5FF 7E               7      LD  A,(HL)
000907 D600 2C               4      INC L
000908 D601 66               7      LD  H,(HL)
000909 D602 6F               4      LD  L,A
00090A D603 E3              19      EX  (SP),HL
00090B D604 79               4      LD  A,C
00090C D605 C9              10      RET
       D606                     _DOS2:
00090D D606 FE5A             7      CP  05AH        ;(BDOS)カレントディレクトリの変更(_CHDIR)
00090F D608 CAD3D8          10      JP  Z,_SYS5A
000912 D60B FE5C             7      CP  05CH        ;(BDOS)ファイル名の解析(_PFILE)
000914 D60D CA8FD8          10      JP  Z,_SYS5C
000917 D610 FE5F             7      CP  05FH        ;(BDOS)ディスクバッファのフラッシュ(_FLUSH)
000919 D612 CA62EB          10      JP  Z,_SYS5F
00091C D615 FE6F             7      CP  06FH        ;(BDOS)MSX-DOS のバージョン番号の獲得(_DOSVER)
00091E D617 200A            12      JR  NZ,_ERROR
000920 D619 011D01          10      LD  BC,011DH
000923 D61C 114701          10      LD  DE,VER
000926 D61F 210201          10      LD  HL,MACD
       D622                     C_REM:
000929 D622 AF               4      XOR A
       D623                     _ERROR:
00092A D623 A7               4      AND A
00092B D624 C9              10      RET
                                
       D625                     _SYS09:     ;文字列出力
00092C D625 D5              11      PUSH    DE
       D626                     _SX09:
00092D D626 1A               7      LD  A,(DE)
00092E D627 13               6      INC DE
00092F D628 FE24             7      CP  '$'
000931 D62A 2831            12      JR  Z,SX0E2
000933 D62C CD1BD9          17      CALL    MSG_A
000936 D62F 18F5            12      JR  _SX09
                                
       D631                     MSX1:
000938 D631 CD1BD9          17      CALL    MSG_A
       D634                     MSX:
00093B D634 7E               7      LD  A,(HL)
00093C D635 23               6      INC HL
00093D D636 B7               4      OR  A
00093E D637 20F8            12      JR  NZ,MSX1
000940 D639 C9              10      RET
                                
       D63A                     _SYS0C:     ;(BDOS)バージョン番号の獲得
000941 D63A 212200          10      LD  HL,00022H
000944 D63D 7D               4      LD  A,L
000945 D63E C9              10      RET
                                
       D63F                     _SYS0D:     ;(BDOS)ディスクリセット
000946 D63F CDDFEF          17      CALL    _FFLUSH
000949 D642 E5              11      PUSH    HL
00094A D643 218000          10      LD  HL,00080H
00094D D646 228AEF          16      LD  (_DTA),HL
000950 D649 E1              10      POP HL
000951 D64A D5              11      PUSH    DE
000952 D64B 1E00             7      LD  E,0
000954 D64D 3E                      DB  03EH
                                
       D64E                     _SYS0E:     ;(BDOS)カレントドライブの設定
000955 D64E D5              11      PUSH    DE
000956 D64F 7B               4      LD  A,E
000957 D650 DDE5            15      PUSH    IX
000959 D652 CDDCEF          17      CALL    _GETDPB
00095C D655 DDE1            14      POP IX
00095E D657 3804            12      JR  C,SX0E2
000960 D659 7B               4      LD  A,E
000961 D65A 3287EF          13      LD  (_DVSW),A
       D65D                     SX0E2:
000964 D65D 3E08             7      LD  A,8
000966 D65F D1              10      POP DE
000967 D660 C9              10      RET
                                
       D661                     _SYS0F:     ;(BDOS)ファイルのオープン
000968 D661 CD30DF          17      CALL    SETDRV
00096B D664 FD7E1C          19      LD  A,(IY+28)   ;(FCB)オープンモード
00096E D667 C602             7      ADD A,002H      ;Write
000970 D669 2848            12      JR  Z,FEND0F
000972 D66B CD7EE2          17      CALL    CHKWILDX
                                
000975 D66E D450DF          17      CALL    NC,SOPENX
       D671                     _S16XX:
000978 D671 3840            12      JR  C,FEND0F
                                                ;Directory location
00097A D673 3A9FEF          13      LD  A,(_FILEN)
00097D D676 FD7719          19      LD  (IY+25),A   ;(FCB)ディレクトリロケーション
                                ;               _DIRF
000980 D679 3AA0EF          13      LD  A,(_DIRF)
000983 D67C FD771D          19      LD  (IY+29),A   ;(FCB)ディレクトリモード
                                ;               _FBPS
000986 D67F FD731E          19      LD  (IY+30),E   ;(FCB)ディレクトリポジション
000989 D682 FD721F          19      LD  (IY+31),D
                                ;               Open(Read)
00098C D685 FD361CFF        19      LD  (IY+28),0FFH    ;(FCB)オープンモード
                                ;               FILENAME
000990 D689 FDE5            15      PUSH    IY
000992 D68B D1              10      POP DE
000993 D68C 13               6      INC DE
000994 D68D 010B00          10      LD  BC,11
000997 D690 EDB0                    LDIR
                                ;               Attribute
000999 D692 7E               7      LD  A,(HL)
00099A D693 FD770D          19      LD  (IY+13),A   ;(FCB)属性(アトリビュート)
00099D D696 110B00          10      LD  DE,11       ;Reserved
0009A0 D699 19              11      ADD HL,DE
                                                    ;(FCB)ファイルを最後に変更した時刻
0009A1 D69A 11EAF0          10      LD  DE,SDDATA       ;(FCB)ファイルを最後に変更した日付
0009A4 D69D 060A             7      LD  B,SDDATAE-SDDATA    ;(FCB)ファイルの先頭クラスタ
       D69F                     S16LOOP:                ;(FCB)ファイルのサイズ(バイト単位)
0009A6 D69F 1A               7      LD  A,(DE)
0009A7 D6A0 13               6      INC DE
0009A8 D6A1 32A8D6          13      LD  (S16PAT+2),A
0009AB D6A4 7E               7      LD  A,(HL)
0009AC D6A5 23               6      INC HL
0009AD D6A6 FD7700          19  S16PAT: LD  (IY+0),A
0009B0 D6A9 10F4            13      DJNZ    S16LOOP
                                
0009B2 D6AB AF               4      XOR A
0009B3 D6AC FD770C          19      LD  (IY+12),A   ;(FCB)カレントブロック
0009B6 D6AF FD2257D7        20      LD  (OFCB+1),IY
       D6B3                     FEND0F:
0009BA D6B3 1845            12      JR  FEND10
                                
       D6B5                     _SYS10:     ;(BDOS)ファイルのクローズ
0009BC D6B5 CD30DF          17      CALL    SETDRV
0009BF D6B8 FD7E1C          19      LD  A,(IY+28)   ;(FCB)オープンモード
0009C2 D6BB D6FE             7      SUB 0FEH
0009C4 D6BD 37               4      SCF
0009C5 D6BE 3F               4      CCF
0009C6 D6BF 2039            12      JR  NZ,FEND10
       D6C1                     _S10A:              ;Write
0009C8 D6C1 FD770E          19      LD  (IY+14),A   ;(FCB)レコードサイズ/アクセスするディレクトリのクラスタ番号+1
0009CB D6C4 FD770F          19      LD  (IY+15),A
                                
0009CE D6C7 FD341C          23      INC (IY+28)     ;0FEH->0FFH ;オープンモード
0009D1 D6CA CD76E3          17      CALL    SETTMS
                                
0009D4 D6CD FD7E1D          19      LD  A,(IY+29)   ;(FCB)ディレクトリモード
0009D7 D6D0 32A0EF          13      LD  (_DIRF),A
0009DA D6D3 E67F             7      AND 07FH
0009DC D6D5 3295E8          13      LD  (_SECPS+1),A
0009DF D6D8 FD5E1E          19      LD  E,(IY+30)   ;(FCB)ディレクトリポジション
0009E2 D6DB FD561F          19      LD  D,(IY+31)
0009E5 D6DE CD84E0          17      CALL    READ_DIR
0009E8 D6E1 3817            12      JR  C,FEND10
                                
0009EA D6E3 3AAEDF          13  SDECM1: LD  A,(SDECPAT+1)   ;1セクタ辺りのディレクトリエントリ数
0009ED D6E6 3D               4      DEC A       ;1024=01FH / 512=00FH / 256=7
0009EE D6E7 FDA619          19      AND (IY+25)     ;(FCB)ディレクトリロケーション
0009F1 D6EA 6F               4      LD  L,A
0009F2 D6EB 2600             7      LD  H,0
0009F4 D6ED 29              11      ADD HL,HL       ;*2
0009F5 D6EE 29              11      ADD HL,HL       ;*4
0009F6 D6EF 29              11      ADD HL,HL       ;*8
0009F7 D6F0 29              11      ADD HL,HL       ;*16
0009F8 D6F1 29              11      ADD HL,HL       ;*32
0009F9 D6F2 ED4B7EF0        20      LD  BC,(_DTBUF)
0009FD D6F6 09              11      ADD HL,BC
                                
0009FE D6F7 CD8EE2          17      CALL    SDIRENT
       D6FA                     FEND10:
000A01 D6FA 1842            12      JR  FEND
                                
       D6FC                     _SYS11:     ;(BDOS)最初のファイルの検索
000A03 D6FC CD30DF          17      CALL    SETDRV
000A06 D6FF CD7DDF          17      CALL    SOPEN
       D702                     _S12X1:
000A09 D702 383A            12      JR  C,FEND
000A0B D704 CD1DE0          17      CALL    SOPENE2
000A0E D707 ED5B8AEF        20      LD  DE,(_DTA)
000A12 D70B 3A88EF          13      LD  A,(_DRV)
000A15 D70E 3C               4      INC A
000A16 D70F 12               7      LD  (DE),A
000A17 D710 D5              11      PUSH    DE
000A18 D711 13               6      INC DE
000A19 D712 012000          10      LD  BC,32
000A1C D715 EDB0                    LDIR
000A1E D717 FD6E0E          19      LD  L,(IY+14)   ;(FCB)レコードサイズ/アクセスするディレクトリのクラスタ番号+1
000A21 D71A FD660F          19      LD  H,(IY+15)
000A24 D71D 22F4F0          16      LD  (SCDIR),HL
000A27 D720 2A9AEF          16      LD  HL,(_FBPS)
000A2A D723 22F6F0          16      LD  (SFBPS),HL
000A2D D726 2A9FEF          16      LD  HL,(_FILEN)
000A30 D729 7C               4      LD  A,H
000A31 D72A B7               4      OR  A
000A32 D72B 2806            12      JR  Z,_S12DIR
000A34 D72D 3A95E8          13      LD  A,(_SECPS+1)
000A37 D730 F680             7      OR  080H
000A39 D732 67               4      LD  H,A
       D733                     _S12DIR:
000A3A D733 22F8F0          16      LD  (SFNDF),HL  ;Directory position and Flags
000A3D D736 E1              10      POP HL
000A3E D737 1139EF          10      LD  DE,SFILE
000A41 D73A 0E21             7      LD  C,33
       D73C                     _S11B:
000A43 D73C EDB0                    LDIR
       D73E                     FEND:
000A45 D73E 9F               4      SBC A,A     ;CF=0 A=0 : CF=1 A=0FFH
       D73F                     FENDE:
000A46 D73F FDE1            14      POP IY
000A48 D741 C1              10      POP BC
000A49 D742 D1              10      POP DE
000A4A D743 E1              10      POP HL
000A4B D744 C9              10      RET
                                
       D745                     _SYS12:     ;(BDOS)次のファイルの検索
000A4C D745 E5              11      PUSH    HL
000A4D D746 D5              11      PUSH    DE
000A4E D747 C5              11      PUSH    BC
000A4F D748 FDE5            15      PUSH    IY
000A51 D74A CDE1DF          17      CALL    NOPEN
000A54 D74D 18B3            12      JR  _S12X1
                                
       D74F                     _S16K:
000A56 D74F FD7E1C          19      LD  A,(IY+28)   ;(FCB)オープンモード
000A59 D752 FEFD             7      CP  0FDH        ;Device(0FDH)
000A5B D754 37               4      SCF
000A5C D755 C8              11      RET Z
                                
000A5D D756 110000          10  OFCB:   LD  DE,0
000A60 D759 D5              11      PUSH    DE
000A61 D75A 061A             7      LD  B,26        ;First cluster
       D75C                     S16K1:
000A63 D75C 13               6      INC DE
000A64 D75D 23               6      INC HL
000A65 D75E 10FC            13      DJNZ    S16K1
                                
000A67 D760 1A               7      LD  A,(DE)
000A68 D761 BE               7      CP  (HL)
000A69 D762 2013            12      JR  NZ,S16K2
000A6B D764 13               6      INC DE
000A6C D765 23               6      INC HL
000A6D D766 1A               7      LD  A,(DE)
000A6E D767 BE               7      CP  (HL)
000A6F D768 200D            12      JR  NZ,S16K2
                                
000A71 D76A E1              10      POP HL
000A72 D76B FDE5            15      PUSH    IY
000A74 D76D D1              10      POP DE
000A75 D76E 1A               7      LD  A,(DE)      ;Drive
000A76 D76F BE               7      CP  (HL)
000A77 D770 2006            12      JR  NZ,S16K3
                                                ;ここはCFが必ず0
000A79 D772 ED52            15      SBC HL,DE       ;CP HL,DE
000A7B D774 37               4      SCF
000A7C D775 C0              11      RET NZ
000A7D D776 E5              11      PUSH    HL
       D777                     S16K2:
000A7E D777 E1              10      POP HL
       D778                     S16K3:
000A7F D778 FDE5            15      PUSH    IY
000A81 D77A D1              10      POP DE
       D77B                     _SYS13:     ;(BDOS)ファイルの削除
000A82 D77B CD30DF          17      CALL    SETDRV
000A85 D77E CDAEE1          17      CALL    KILL
       D781                     FEND13:
000A88 D781 18BB            12      JR  FEND
                                
       D783                     _SYS14:     ;(BDOS)シーケンシャルな読み出し
000A8A D783 CD30DF          17      CALL    SETDRV
000A8D D786 CDA8E3          17      CALL    PUSHRR
000A90 D789 CDEBE3          17      CALL    GETSEQ
                                
000A93 D78C CD00E4          17      CALL    RB_READ
000A96 D78F E5              11      PUSH    HL
000A97 D790 CDBCE3          17      CALL    SETSEQ
       D793                     SREAD:
000A9A D793 E1              10      POP HL
                                
000A9B D794 C601             7      ADD A,001H
000A9D D796 38A6            12      JR  C,FEND
                                
000A9F D798 7D               4      LD  A,L
000AA0 D799 D601             7      SUB 001H
       D79B                     FENDX:
000AA2 D79B 9F               4      SBC A,A
000AA3 D79C E603             7      AND 3
000AA5 D79E 1F               4      RRA
000AA6 D79F 189E            12      JR  FENDE
                                
       D7A1                     _SYS15:     ;(BDOS)シーケンシャルな書き込み
000AA8 D7A1 CD30DF          17      CALL    SETDRV
000AAB D7A4 CDA8E3          17      CALL    PUSHRR
000AAE D7A7 CDEBE3          17      CALL    GETSEQ
                                
000AB1 D7AA CDF9E3          17      CALL    RB_WRITE
000AB4 D7AD E5              11      PUSH    HL
000AB5 D7AE CDBCE3          17      CALL    SETSEQ
       D7B1                     SWRITE:
000AB8 D7B1 E1              10      POP HL
                                
000AB9 D7B2 C6FF             7      ADD A,0FFH
000ABB D7B4 18E5            12      JR  FENDX
                                
       D7B6                     _SYS17:     ;(BDOS)ファイル名の変更
000ABD D7B6 CD30DF          17      CALL    SETDRV
000AC0 D7B9 CD04E2          17      CALL    NAME
000AC3 D7BC 18C3            12      JR  FEND13
                                
       D7BE                     _SYS16:     ;(BDOS)ファイルの作成
000AC5 D7BE CD30DF          17      CALL    SETDRV
                                
000AC8 D7C1 CD7EE2          17      CALL    CHKWILDX
000ACB D7C4 38BB            12      JR  C,FEND13
000ACD D7C6 FD7E01          19      LD  A,(IY+1)    ;(FCB)主ファイル名
000AD0 D7C9 FE05             7      CP  5
000AD2 D7CB 2805            12      JR  Z,_S16X2
000AD4 D7CD FE21             7      CP  021H
000AD6 D7CF DA81D7          10      JP  C,FEND13
       D7D2                     _S16X2:
                                ;               Clear FCB
000AD9 D7D2 FDE5            15      PUSH    IY
000ADB D7D4 E1              10      POP HL
000ADC D7D5 011000          10      LD  BC,16
000ADF D7D8 09              11      ADD HL,BC
       D7D9                     _S16X1:
000AE0 D7D9 70               7      LD  (HL),B      ;B=0
000AE1 D7DA 23               6      INC HL
000AE2 D7DB 0D               4      DEC C
000AE3 D7DC 20FB            12      JR  NZ,_S16X1
                                
000AE5 D7DE CD7BE3          17      CALL    SETTMSX
000AE8 D7E1 FD360DFF        19      LD  (IY+13),0FFH    ;(FCB)Attribute
000AEC D7E5 CD50DF          17      CALL    SOPENX
000AEF D7E8 3F               4      CCF
000AF0 D7E9 CC4FD7          17      CALL    Z,_S16K
000AF3 D7EC D42EE0          17      CALL    NC,COPEN
000AF6 D7EF D48EE2          17      CALL    NC,SDIRENT
000AF9 D7F2 C371D6          10      JP  _S16XX
                                
       D7F5                     _SYS21:     ;(BDOS)ランダムな読み出し
                                
000AFC D7F5 CD30DF          17      CALL    SETDRV
000AFF D7F8 CDA8E3          17      CALL    PUSHRR
000B02 D7FB CD81E6          17      CALL    GET_RR_AHL
                                
000B05 D7FE CD00E4          17      CALL    RB_READ
000B08 D801 E5              11      PUSH    HL
000B09 D802 CDD7E3          17      CALL    POPRR
000B0C D805 188C            12      JR  SREAD
                                
       D807                     _SYS22:     ;(BDOS)ランダムな書き込み
       D807                     _SYS28:     ;(BDOS)ランダムな書き込み・その2
000B0E D807 CD30DF          17      CALL    SETDRV
000B11 D80A CDA8E3          17      CALL    PUSHRR
000B14 D80D CD81E6          17      CALL    GET_RR_AHL
                                
000B17 D810 CDF9E3          17      CALL    RB_WRITE
000B1A D813 E5              11      PUSH    HL
000B1B D814 CDD7E3          17      CALL    POPRR
000B1E D817 1898            12      JR  SWRITE
                                
       D819                     _SYS18:     ;(BDOS)ログインベクトルの獲得
000B20 D819 21FF00          10      LD  HL,000FFH
000B23 D81C AF               4      XOR A
000B24 D81D C9              10      RET
                                
       D81E                     _SYS19:     ;(BDOS)カレントドライブ番号の獲得
000B25 D81E 3A87EF          13      LD  A,(_DVSW)
000B28 D821 A7               4      AND A
000B29 D822 C9              10      RET
                                
       D823                     _SYS1A:     ;(BDOS)DTAの設定
000B2A D823 ED538AEF        20      LD  (_DTA),DE
000B2E D827 AF               4      XOR A
000B2F D828 C9              10      RET
                                
       D829                     _SYS1B:     ;(BDOS)ディスク情報の獲得
000B30 D829 7B               4      LD  A,E
000B31 D82A CD43DF          17      CALL    GETDRV
000B34 D82D CDDCEF          17      CALL    _GETDPB
000B37 D830 D4E2EF          17      CALL    NC,_RDFATX
000B3A D833 210000          10      LD  HL,0
000B3D D836 D454E3          17      CALL    NC,DSKF
                                
000B40 D839 ED5B55E3        20      LD  DE,(MAXCLP+1)   ;DPB_08_MAXCL-1
000B44 D83D 1B               6      DEC DE      ;DE←クラスタの総数
000B45 D83E FD2A7CF0        20      LD  IY,(_FATBF) ;IY←メモリ上のFATの先頭アドレス
000B49 D842 9F               4      SBC A,A
000B4A D843 D8              11      RET C
000B4B D844 4F               4      LD  C,A     ;C=0
000B4C D845 DD7E0F          19      LD  A,(IX+00FH) ;DPB_0F_BPS
000B4F D848 E60F             7      AND 00FH
000B51 D84A 47               4      LD  B,A
000B52 D84B DD7E07          19      LD  A,(IX+7)    ;DPB_07_SECPCL
000B55 D84E C9              10      RET
                                
       D84F                     _SYS1D:     ;(BDOS)書き込みが禁止されているディスクの調査
000B56 D84F AF               4      XOR A
000B57 D850 67               4      LD  H,A
000B58 D851 6F               4      LD  L,A
000B59 D852 C9              10      RET
                                
       D853                     _SYS1F:     ;(BDOS)ディスク装置のパラメータの読み出し
000B5A D853 2100F1          10      LD  HL,DEVICE
000B5D D856 7B               4      LD  A,E
000B5E D857 C3DCEF          10      JP  _GETDPB
                                
       D85A                     _SYS23:     ;(BDOS)ファイルサイズの獲得
000B61 D85A E5              11      PUSH    HL
000B62 D85B 2A1EF0          16      LD  HL,(STABLE+2*00FH)  ;ファイルのオープン
000B65 D85E CD0F00          17      CALL    JP_HL
000B68 D861 3821            12      JR  C,_S23X1
                                
000B6A D863 D5              11      PUSH    DE      ;EX DE,IY
000B6B D864 FDE3            23      EX  (SP),IY     ;
                                ;   POP DE      ;
                                ;   PUSH    DE      ;DEを破壊しないように注意vv
000B6D D866 FD7E10          19      LD  A,(IY+16)   ;(FCB)ファイルのサイズ(バイト単位)
000B70 D869 FD6E11          19      LD  L,(IY+17)   ;
000B73 D86C FD6612          19      LD  H,(IY+18)   ;
000B76 D86F C5              11      PUSH    BC      ;
000B77 D870 FD4613          19      LD  B,(IY+19)   ;
000B7A D873 CDDDE3          17      CALL    GET_CPM_R_SIZE
000B7D D876 C1              10      POP BC
       D877                     _S24X1:
000B7E D877 FD7521          19      LD  (IY+33),L   ;(FCB)Random record
000B81 D87A FD7422          19      LD  (IY+34),H
000B84 D87D FD7723          19      LD  (IY+35),A
                                ;   POP DE      ;^^^^^^^^^^^^^^^^^^^^^^^^
                                ;   PUSH    DE      ;EX DE,IY
000B87 D880 FDE3            23      EX  (SP),IY     ;
000B89 D882 D1              10      POP DE      ;
                                
000B8A D883 AF               4      XOR A
       D884                     _S23X1:
000B8B D884 E1              10      POP HL
000B8C D885 C9              10      RET
                                
       D886                     _SYS24:     ;(BDOS)ランダムレコードフィールドの設定
000B8D D886 E5              11      PUSH    HL
000B8E D887 D5              11      PUSH    DE      ;EX DE,IY
000B8F D888 FDE3            23      EX  (SP),IY     ;
                                ;   POP DE      ;
                                ;   PUSH    DE      ;DEを破壊しないように注意vv
000B91 D88A CDEBE3          17      CALL    GETSEQ
000B94 D88D 18E8            12      JR  _S24X1      ;^^^^^^^^^^^^^^^^^^^^^^^^
                                
       D88F                     _SYS5C:     ;(BDOS)ファイル名の解析
000B96 D88F C5              11      PUSH    BC
000B97 D890 E5              11      PUSH    HL
000B98 D891 CD47DE          17      CALL    FILE
000B9B D894 E1              10      POP HL
000B9C D895 C1              10      POP BC
       D896                     S29X1:
000B9D D896 C5              11      PUSH    BC
000B9E D897 D5              11      PUSH    DE
000B9F D898 E5              11      PUSH    HL
000BA0 D899 EB               4      EX  DE,HL
000BA1 D89A 2114EF          10      LD  HL,FDRV
000BA4 D89D 010D00          10      LD  BC,13
000BA7 D8A0 EDB0                    LDIR
000BA9 D8A2 70               7      LD  (HL),B      ;B=0
000BAA D8A3 0E03             7      LD  C,3
000BAC D8A5 EDB0                    LDIR
000BAE D8A7 E1              10      POP HL
000BAF D8A8 D1              10      POP DE
000BB0 D8A9 C1              10      POP BC
000BB1 D8AA AF               4      XOR A
000BB2 D8AB C9              10      RET
                                
       D8AC                     _SYS30:     ;(BDOS)論理セクタを用いた書き込み
000BB3 D8AC C5              11      PUSH    BC
000BB4 D8AD 0105EA          10      LD  BC,DWT24B
000BB7 D8B0 1804            12      JR  S2FX
       D8B2                     _SYS2F:
000BB9 D8B2 C5              11      PUSH    BC
000BBA D8B3 01F5E9          10      LD  BC,DRD24B
       D8B6                     S2FX:
000BBD D8B6 ED43CCD8        20      LD  (S2FPAT+1),BC
000BC1 D8BA CDDFEF          17      CALL    _FFLUSH
                                
000BC4 D8BD D5              11      PUSH    DE
000BC5 D8BE E5              11      PUSH    HL
000BC6 D8BF 7D               4      LD  A,L     ;Drive
000BC7 D8C0 CDD9EF          17      CALL    _CHGDRV
000BCA D8C3 3809            12      JR  C,S30X2
000BCC D8C5 44               4      LD  B,H     ;Number of clusters
000BCD D8C6 2A8AEF          16      LD  HL,(_DTA)
                                
000BD0 D8C9 0E00             7      LD  C,0
000BD2 D8CB CDF5E9          17  S2FPAT: CALL    DRD24B
       D8CE                     S30X2:
000BD5 D8CE E1              10      POP HL
000BD6 D8CF D1              10      POP DE
000BD7 D8D0 C1              10      POP BC
000BD8 D8D1 9F               4      SBC A,A
000BD9 D8D2 C9              10      RET
                                
       D8D3                     _SYS5A:     ;(BDOS)カレントディレクトリの変更
000BDA D8D3 C5              11      PUSH    BC
000BDB D8D4 D5              11      PUSH    DE
000BDC D8D5 E5              11      PUSH    HL
000BDD D8D6 CD3CDE          17      CALL    FILEC
000BE0 D8D9 210000          10      LD  HL,0
000BE3 D8DC 1114EF          10      LD  DE,FDRV
000BE6 D8DF 2A4EF0          16      LD  HL,(STABLE+2*027H)  ;ランダムブロック読み込み
000BE9 D8E2 CD0F00          17      CALL    JP_HL
000BEC D8E5 18E7            12      JR  S30X2
[EOF:LDOS.ASM:SHIFT_JIS]
                                    INCLUDE "88IO.ASM"
                                
                                ;   LSX-Dodgers IO
                                ;   PC-8801mkIISR
                                
       D623                     _SYS04  EQU _ERROR      ;(BDOS)外部出力
       D623                     _SYS05  EQU _ERROR      ;(BDOS)プリンタ出力
       D623                     _SYS1C  EQU _ERROR      ;(BDOS)ディスクの書き込み禁止化
       D623                     _SYS1E  EQU _ERROR      ;(BDOS)ファイル属性の設定
       D623                     _SYS20  EQU _ERROR      ;(BDOS)利用者番号の設定と読み出し
       D623                     _SYS2E  EQU _ERROR      ;(BDOS)ベリファイ・フラグの設定
                                
       0000                     INT EQU 0
       0000                     INTCTCE EQU 0
       0000                     INTCTC2 EQU 0
                                
       D8E7                     BDOS_RF:
000BEE D8E7 DB32            11      IN  A,(032H)
000BF0 D8E9 F610             7      OR  010H        ;高速RAMアクセスモードOFF
000BF2 D8EB D332            11      OUT (032H),A
000BF4 D8ED C3DBD5          10      JP  BDOS0
                                
       D8F0                     KEYSET:
       D8F0                     KEYBS:
000BF7 D8F0 B7               4      OR  A
000BF8 D8F1 C8              11      RET Z
       D8F2                     KEYBS1:
000BF9 D8F2 CD08D9          17      CALL    KEYBC_IFBREAK
000BFC D8F5 E5              11      PUSH    HL
000BFD D8F6 F5              11      PUSH    AF
000BFE D8F7 2A90EF          16      LD  HL,(_KEYPS)
000C01 D8FA 2C               4      INC L
000C02 D8FB 7D               4      LD  A,L
000C03 D8FC BC               4      CP  H
000C04 D8FD 2815            12      JR  Z,POP_AF_HL_SCF_RET
000C06 D8FF 3290EF          13      LD  (_KEYPS),A
000C09 D902 26FE             7      LD  H,KEYBF/256
000C0B D904 F1              10      POP AF
000C0C D905 77               7      LD  (HL),A
000C0D D906 E1              10      POP HL
000C0E D907 C9              10      RET
       D908                     KEYBC_IFBREAK:
000C0F D908 FE03             7      CP  3
000C11 D90A C0              11      RET NZ
       D90B                     KEYBC:
000C12 D90B E5              11      PUSH    HL
000C13 D90C 210000          10      LD  HL,0
000C16 D90F 2290EF          16      LD  (_KEYPS),HL
000C19 D912 E1              10      POP HL
000C1A D913 C9              10      RET
                                
       D914                     POP_AF_HL_SCF_RET:
000C1B D914 F1              10      POP AF
000C1C D915 E1              10      POP HL
000C1D D916 37               4      SCF
000C1E D917 C9              10      RET
                                
       D918                     _SYS01:     ;(BDOS)コンソール入力
000C1F D918 CD09EF          17      CALL    _SYS07
       D91B                     MSG_A:
000C22 D91B F5              11      PUSH    AF
000C23 D91C D5              11      PUSH    DE
000C24 D91D 5F               4      LD  E,A
000C25 D91E CD24D9          17      CALL    _SYS02
000C28 D921 D1              10      POP DE
000C29 D922 F1              10      POP AF
000C2A D923 C9              10      RET
                                
       D924                     _SYS02:     ;(BDOS)コンソール出力
000C2B D924 CD36D9          17      CALL    BREAK
000C2E D927 1805            12      JR  PRINTX
                                
       D929                     _SYS06:     ;(BDOS)コンソール直接入出力
000C30 D929 7B               4      LD  A,E
000C31 D92A 3C               4      INC A
000C32 D92B CACAEF          10      JP  Z,_INKEY
       D92E                     PRINTX:
000C35 D92E C3CDEF          10      JP  _PRINT
                                
       D931                     _SYS08:     ;(BDOS)エコーなしコンソール入力
000C38 D931 CD09EF          17      CALL    _SYS07
000C3B D934 1803            12      JR  BREAK1
       D936                     BREAK:
000C3D D936 CD4FDD          17      CALL    CHKEY
       D939                     BREAK1:
000C40 D939 FE03             7      CP  3       ;CTRL+C
000C42 D93B CA00EF          10      JP  Z,CPM_BOOT
000C45 D93E FE13             7      CP  013H        ;CTRL+S
000C47 D940 C0              11      RET NZ
                                
       D941                     PAUSE:
000C48 D941 CD0BD9          17      CALL    KEYBC
                                
       D944                     FLGET:
000C4B D944 CDDFEF          17      CALL    _FFLUSH
000C4E D947 E5              11      PUSH    HL
000C4F D948 2A8EEF          16      LD  HL,(_TXADR)
000C52 D94B CDEADB          17      CALL    CURSOR_ON
       D94E                     FLGET1:
000C55 D94E CDCAEF          17      CALL    _INKEY
000C58 D951 28FB            12      JR  Z,FLGET1
000C5A D953 CDD9DB          17      CALL    CURSOR_OFF
000C5D D956 E1              10      POP HL
000C5E D957 C9              10      RET
                                
       D958                     _SYS0A:     ;(BDOS)文字列入力
000C5F D958 C5              11      PUSH    BC
000C60 D959 E5              11      PUSH    HL
000C61 D95A D5              11      PUSH    DE
000C62 D95B CDA9DC          17      CALL    GETL
000C65 D95E 1100FF          10      LD  DE,KBUF
000C68 D961 E1              10      POP HL
000C69 D962 E5              11      PUSH    HL
000C6A D963 0E00             7      LD  C,0
000C6C D965 3004            12      JR  NC,SAX0
000C6E D967 23               6      INC HL
000C6F D968 23               6      INC HL
000C70 D969 1808            12      JR  SAX4
       D96B                     SAX0:
000C72 D96B 46               7      LD  B,(HL)
000C73 D96C 23               6      INC HL
       D96D                     SAX1:
000C74 D96D 23               6      INC HL
000C75 D96E 1A               7      LD  A,(DE)
000C76 D96F 13               6      INC DE
000C77 D970 B7               4      OR  A
000C78 D971 2004            12      JR  NZ,SAX2
       D973                     SAX4:
000C7A D973 360D            10      LD  (HL),00DH
000C7C D975 1804            12      JR  SAX3
       D977                     SAX2:
000C7E D977 77               7      LD  (HL),A
000C7F D978 0C               4      INC C
000C80 D979 10F2            13      DJNZ    SAX1
       D97B                     SAX3:
000C82 D97B D1              10      POP DE
000C83 D97C 79               4      LD  A,C
000C84 D97D 13               6      INC DE
000C85 D97E 12               7      LD  (DE),A
000C86 D97F 1B               6      DEC DE
000C87 D980 E1              10      POP HL
000C88 D981 C1              10      POP BC
000C89 D982 A7               4      AND A
000C8A D983 C9              10      RET
                                
       D984                     _SYS0B:     ;(BDOS)コンソール状態のチェック
000C8B D984 CD36D9          17      CALL    BREAK
000C8E D987 3A92EF          13      LD  A,(_KEYD)
000C91 D98A B7               4      OR  A
000C92 D98B C8              11      RET Z
       D98C                     CONSTX:
000C93 D98C CDDFEF          17      CALL    _FFLUSH
000C96 D98F E5              11      PUSH    HL
000C97 D990 2A90EF          16      LD  HL,(_KEYPS)
000C9A D993 7C               4      LD  A,H
000C9B D994 AD               4      XOR L
000C9C D995 E1              10      POP HL
000C9D D996 CC4FDD          17      CALL    Z,CHKEY
000CA0 D999 C6FF             7      ADD A,0FFH
000CA2 D99B 9F               4      SBC A,A
000CA3 D99C C9              10      RET
                                
       D99D                     _SYS2A:     ;(BDOS)日付の獲得
000CA4 D99D C5              11      PUSH    BC
000CA5 D99E CDDDD9          17      CALL    RTCREAD
000CA8 D9A1 3A62EF          13      LD  A,(RTC_YY)
000CAB D9A4 CD40DA          17      CALL    BCD
000CAE D9A7 6F               4      LD  L,A
000CAF D9A8 2600             7      LD  H,0
                                ;   LD  DE,1900     ;0076CH
                                ;   CP  90      ;90以上は1900年代 1990-1999
                                ;   JR  NC,RDDATE1  ;90未満は2000年代 2000-2089
                                ;   LD  E,0D0H      ;2000 & 0FFH D=007H
000CB1 D9AA 11D007          10      LD  DE,2000     ;すべて2000年代で処理 2000-2099
       D9AD                     RDDATE1:
000CB4 D9AD 19              11      ADD HL,DE
000CB5 D9AE 3A63EF          13      LD  A,(RTC_MW)
000CB8 D9B1 57               4      LD  D,A
000CB9 D9B2 3A64EF          13      LD  A,(RTC_DD)
000CBC D9B5 CD40DA          17      CALL    BCD
000CBF D9B8 5F               4      LD  E,A
000CC0 D9B9 7A               4      LD  A,D
000CC1 D9BA 0604             7      LD  B,4
       D9BC                     RDDATE2:
000CC3 D9BC CB3A             8      SRL D
000CC5 D9BE 10FC            13      DJNZ    RDDATE2
000CC7 D9C0 C1              10      POP BC
000CC8 D9C1 E607             7      AND 7
000CCA D9C3 C9              10      RET
                                
       D9C4                     _SYS2C:     ;(BDOS)時刻の獲得
000CCB D9C4 C5              11      PUSH    BC
000CCC D9C5 CDDDD9          17      CALL    RTCREAD
000CCF D9C8 3A65EF          13      LD  A,(RTC_TT)
000CD2 D9CB CD40DA          17      CALL    BCD
000CD5 D9CE 67               4      LD  H,A
000CD6 D9CF 3A66EF          13      LD  A,(RTC_MM)
000CD9 D9D2 CD40DA          17      CALL    BCD
000CDC D9D5 6F               4      LD  L,A
000CDD D9D6 3A67EF          13      LD  A,(RTC_SS)
000CE0 D9D9 57               4      LD  D,A
000CE1 D9DA C1              10      POP BC
000CE2 D9DB AF               4      XOR A
000CE3 D9DC C9              10      RET
                                
       D9DD                     RTCREAD:
000CE4 D9DD 0EF9             7      LD  C,0F9H
000CE6 D9DF 3AB9EF          13      LD  A,(WK40)
000CE9 D9E2 5F               4      LD  E,A
000CEA D9E3 3E03             7      LD  A,3     ;コマンド３：タイムリードにセット
000CEC D9E5 CD0FDA          17      CALL    RTCCMD
000CEF D9E8 3E01             7      LD  A,1     ;コマンド１：レジスタシフトにセット
000CF1 D9EA CD0FDA          17      CALL    RTCCMD
000CF4 D9ED 0606             7      LD  B,6
000CF6 D9EF 2167EF          10      LD  HL,RTC_SS
       D9F2                     RTCREAD1:
000CF9 D9F2 C5              11      PUSH    BC
000CFA D9F3 0608             7      LD  B,8
       D9F5                     RTCREAD2:
000CFC D9F5 DB40            11      IN  A,(40H)     ;システムモードセンス BIT4:CDI
000CFE D9F7 87               4      ADD A,A
000CFF D9F8 87               4      ADD A,A
000D00 D9F9 87               4      ADD A,A
000D01 D9FA 87               4      ADD A,A
000D02 D9FB CB1E            15      RR  (HL)
000D04 D9FD CD34DA          17      CALL    RTCCLK
000D07 DA00 10F3            13      DJNZ    RTCREAD2
000D09 DA02 C1              10      POP BC
000D0A DA03 2B               6      DEC HL
000D0B DA04 10EC            13      DJNZ    RTCREAD1
000D0D DA06 AF               4      XOR A
000D0E DA07 CD0FDA          17      CALL    RTCCMD
000D11 DA0A 7B               4      LD  A,E
000D12 DA0B 32B9EF          13      LD  (WK40),A
000D15 DA0E C9              10      RET
                                
       DA0F                     RTCCMD:
000D16 DA0F 0604             7      LD  B,4
000D18 DA11 07               4      RLCA
000D19 DA12 07               4      RLCA
000D1A DA13 07               4      RLCA
       DA14                     RTCCMD1:
000D1B DA14 F5              11      PUSH    AF
000D1C DA15 F607             7      OR  7
000D1E DA17 D310            11      OUT (10H),A     ;プリンタデータ出力 兼 カレンダクロック(μPD1990AC)出力
000D20 DA19 CD34DA          17      CALL    RTCCLK
000D23 DA1C F1              10      POP AF
000D24 DA1D 0F               4      RRCA
000D25 DA1E 10F4            13      DJNZ    RTCCMD1
000D27 DA20 3E07             7      LD  A,7
000D29 DA22 D310            11      OUT (10H),A     ;プリンタデータ出力 兼 カレンダクロック(μPD1990AC)出力
000D2B DA24 7B               4      LD  A,E
000D2C DA25 A1               4      AND C
000D2D DA26 F602             7      OR  2
000D2F DA28 D340            11      OUT (40H),A     ;ストローブポート
000D31 DA2A A1               4      AND C
000D32 DA2B 00               4      NOP
000D33 DA2C D340            11      OUT (40H),A     ;ストローブポート
000D35 DA2E 5F               4      LD  E,A
000D36 DA2F 060D             7      LD  B,13
       DA31                     RTCCMD3:
000D38 DA31 10FE            13      DJNZ    RTCCMD3
000D3A DA33 C9              10      RET
                                
       DA34                     RTCCLK:
000D3B DA34 7B               4      LD  A,E
000D3C DA35 A1               4      AND C
000D3D DA36 F604             7      OR  04H
000D3F DA38 D340            11      OUT (40H),A
000D41 DA3A A1               4      AND C
000D42 DA3B 00               4      NOP
000D43 DA3C D340            11      OUT (40H),A
000D45 DA3E 5F               4      LD  E,A
000D46 DA3F C9              10      RET
                                
                                ;------------------------
                                ;BCDの10進数化
                                ;in
                                ;   A  : BCD
                                ;out
                                ;   A  : 10進数
                                ;------------------------
       DA40                     BCD:
000D47 DA40 4F               4      LD  C,A
000D48 DA41 E6F0             7      AND 0F0H    ;10の位
000D4A DA43 0F               4      RRCA
000D4B DA44 47               4      LD  B,A
000D4C DA45 0F               4      RRCA
000D4D DA46 0F               4      RRCA
000D4E DA47 80               4      ADD A,B
000D4F DA48 47               4      LD  B,A
000D50 DA49 79               4      LD  A,C
000D51 DA4A E60F             7      AND 00FH    ;1の位
000D53 DA4C 80               4      ADD A,B
000D54 DA4D C9              10      RET
                                
       DA4E                     ESC1:
000D55 DA4E 7B               4      LD  A,E
000D56 DA4F FE41             7      CP  'A'
000D58 DA51 CA33DB          10      JP  Z,CTRL1E
000D5B DA54 FE42             7      CP  'B'
000D5D DA56 CA53DC          10      JP  Z,CTRL1F
000D60 DA59 FE43             7      CP  'C'
000D62 DA5B CAF9DA          10      JP  Z,CTRL1C
000D65 DA5E FE44             7      CP  'D'
000D67 DA60 CA1EDB          10      JP  Z,CTRL1D
000D6A DA63 FE45             7      CP  'E'
000D6C DA65 2802            12      JR  Z,CT0CX
000D6E DA67 FE6A             7      CP  'j'
       DA69                     CT0CX:
000D70 DA69 CA20DC          10      JP  Z,CTRL0C
000D73 DA6C FE48             7      CP  'H'
000D75 DA6E CA9EDB          10      JP  Z,CTRL0B
000D78 DA71 FE4A             7      CP  'J'
000D7A DA73 CA23DC          10      JP  Z,CTRL06
000D7D DA76 FE4B             7      CP  'K'
000D7F DA78 CA72DB          10      JP  Z,CTRL05
000D82 DA7B FE4C             7      CP  'L'
000D84 DA7D CA5ADC          10      JP  Z,CTRL0E
000D87 DA80 FE54             7      CP  'T'
000D89 DA82 CA72DB          10      JP  Z,CTRL05
000D8C DA85 FE78             7      CP  'x'
000D8E DA87 2804            12      JR  Z,ESC1X
000D90 DA89 FE79             7      CP  'y'
000D92 DA8B 2002            12      JR  NZ,ESC1Y
       DA8D                     ESC1X:
000D94 DA8D 3601            10      LD  (HL),1
       DA8F                     ESC1Y:
000D96 DA8F FE3D             7      CP  '='
000D98 DA91 2804            12      JR  Z,ESC1W
000D9A DA93 FE59             7      CP  'Y'
000D9C DA95 2002            12      JR  NZ,ESC1Z
       DA97                     ESC1W:
000D9E DA97 3602            10      LD  (HL),2
       DA99                     ESC1Z:
000DA0 DA99 FE20             7      CP  020H
000DA2 DA9B 3802            12      JR  C,ESC1C
000DA4 DA9D 87               4      ADD A,A
000DA5 DA9E D0              11      RET NC
       DA9F                     ESC1C:
000DA6 DA9F E1              10      POP HL
000DA7 DAA0 1832            12      JR  ANK
                                
       DAA2                     ESC:
000DA9 DAA2 21E5DA          10      LD  HL,PRINTE5
000DAC DAA5 E5              11      PUSH    HL
000DAD DAA6 21C8DA          10      LD  HL,ESCFLG
000DB0 DAA9 3600            10      LD  (HL),0
000DB2 DAAB 3D               4      DEC A
000DB3 DAAC 28A0            12      JR  Z,ESC1
000DB5 DAAE 3D               4      DEC A
000DB6 DAAF 2009            12      JR  NZ,ESC2
000DB8 DAB1 3603            10      LD  (HL),3
000DBA DAB3 7B               4      LD  A,E
000DBB DAB4 D620             7      SUB 020H
000DBD DAB6 32BDDA          13      LD  (ESCYP+1),A
000DC0 DAB9 C9              10      RET
       DABA                     ESC2:
000DC1 DABA 3D               4      DEC A
000DC2 DABB C0              11      RET NZ
000DC3 DABC 2600             7  ESCYP:  LD  H,0
000DC5 DABE 7B               4      LD  A,E
000DC6 DABF D620             7      SUB 020H
000DC8 DAC1 6F               4      LD  L,A
000DC9 DAC2 C3D6EF          10      JP  _LOC
                                
       DAC5                     PRINT:
000DCC DAC5 C5              11      PUSH    BC
000DCD DAC6 E5              11      PUSH    HL
       DAC8                     ESCFLG  EQU $+1
000DCE DAC7 3E00             7      LD  A,000H      ;自己書き換え
000DD0 DAC9 B7               4      OR  A
000DD1 DACA 20D6            12      JR  NZ,ESC
                                
000DD3 DACC 3E1F             7      LD  A,01FH
000DD5 DACE BB               4      CP  E
000DD6 DACF 3018            12      JR  NC,CTRL
       DAD1                     INSFLG  EQU $
000DD8 DAD1 0102DC          10      LD  BC,INSERT   ;自己書き換え
       DAD4                     ANK:
000DDB DAD4 CDABDB          17      CALL    LOC0
000DDE DAD7 DB32            11      IN  A,(032H)
000DE0 DAD9 F5              11      PUSH    AF
000DE1 DADA CBA7             8      RES 4,A     ;高速RAMアクセスモード
000DE3 DADC D332            11      OUT (032H),A
000DE5 DADE 73               7      LD  (HL),E
000DE6 DADF F1              10      POP AF
000DE7 DAE0 D332            11      OUT (032H),A
000DE9 DAE2 CDF9DA          17      CALL    CTRL1C
       DAE5                     PRINTE5:
000DEC DAE5 E1              10      POP HL
000DED DAE6 C1              10      POP BC
000DEE DAE7 AF               4      XOR A
000DEF DAE8 C9              10      RET
                                
       DAE9                     CTRL:
000DF0 DAE9 7B               4      LD  A,E
000DF1 DAEA 87               4      ADD A,A
000DF2 DAEB F680             7      OR  080H
000DF4 DAED 6F               4      LD  L,A
000DF5 DAEE 26F0             7      LD  H,CTRLTB/256
000DF7 DAF0 7E               7      LD  A,(HL)
000DF8 DAF1 2C               4      INC L
000DF9 DAF2 66               7      LD  H,(HL)
000DFA DAF3 6F               4      LD  L,A
000DFB DAF4 CD0F00          17      CALL    JP_HL
000DFE DAF7 18EC            12      JR  PRINTE5
                                
       DAF9                     CTRL1C:
000E00 DAF9 2A8EEF          16      LD  HL,(_TXADR)
000E03 DAFC 2C               4      INC L
       DAFD                     PRINTE3:
000E04 DAFD 3AB1EF          13      LD  A,(_WIDTH)
000E07 DB00 3D               4      DEC A
000E08 DB01 BD               4      CP  L
000E09 DB02 3009            12      JR  NC,SET_TXADR_HL
000E0B DB04 2E00             7      LD  L,0
000E0D DB06 24               4      INC H
       DB07                     PRINTE8:
000E0E DB07 3A97EF          13      LD  A,(_LINE)
000E11 DB0A BC               4      CP  H
000E12 DB0B 2804            12      JR  Z,PRINT2
       DB0D                     LOC:
       DB0D                     SET_TXADR_HL:
000E14 DB0D 228EEF          16      LD  (_TXADR),HL
       DB10                     CTRL00:
000E17 DB10 C9              10      RET
                                
       DB11                     PRINT2:
000E18 DB11 CD60DC          17      CALL    SCR
000E1B DB14 25               4      DEC H
000E1C DB15 18F6            12      JR  SET_TXADR_HL
                                
       DB17                     CTRL08:
000E1E DB17 3AD1DA          13      LD  A,(INSFLG)
000E21 DB1A FECD             7      CP  0CDH        ;CALL ????
000E23 DB1C 2829            12      JR  Z,CTRL02
       DB1E                     CTRL1D:
000E25 DB1E 2A8EEF          16      LD  HL,(_TXADR)
000E28 DB21 7C               4      LD  A,H
000E29 DB22 B5               4      OR  L
000E2A DB23 C8              11      RET Z
000E2B DB24 7D               4      LD  A,L
000E2C DB25 B7               4      OR  A
000E2D DB26 2803            12      JR  Z,CTRL1DX1
000E2F DB28 2D               4      DEC L
000E30 DB29 18E2            12      JR  SET_TXADR_HL
       DB2B                     CTRL1DX1:
000E32 DB2B 3AB1EF          13      LD  A,(_WIDTH)
000E35 DB2E 3D               4      DEC A
000E36 DB2F 6F               4      LD  L,A
000E37 DB30 25               4      DEC H
000E38 DB31 18DA            12      JR  SET_TXADR_HL
       DB33                     CTRL1E:
000E3A DB33 2A8EEF          16      LD  HL,(_TXADR)
000E3D DB36 7C               4      LD  A,H
000E3E DB37 B7               4      OR  A
000E3F DB38 C8              11      RET Z
000E40 DB39 25               4      DEC H
000E41 DB3A 18D1            12      JR  SET_TXADR_HL
                                
       DB3C                     CTRL09:
000E43 DB3C 2A8EEF          16      LD  HL,(_TXADR)
000E46 DB3F 7D               4      LD  A,L
000E47 DB40 E6F8             7      AND 0F8H
000E49 DB42 C608             7      ADD A,8
000E4B DB44 6F               4      LD  L,A
000E4C DB45 18B6            12      JR  PRINTE3
                                
       DB47                     CTRL02:
000E4E DB47 3A8EEF          13      LD  A,(_TXADR)
000E51 DB4A B7               4      OR  A
000E52 DB4B 28D1            12      JR  Z,CTRL1D
000E54 DB4D CD1EDB          17      CALL    CTRL1D
000E57 DB50 2A8EEF          16      LD  HL,(_TXADR)
000E5A DB53 3AB1EF          13      LD  A,(_WIDTH)
000E5D DB56 4F               4      LD  C,A
000E5E DB57 95               4      SUB L
000E5F DB58 47               4      LD  B,A
000E60 DB59 79               4      LD  A,C
000E61 DB5A 3D               4      DEC A
000E62 DB5B 6F               4      LD  L,A
000E63 DB5C CDAEDB          17      CALL    LOC1
                                
000E66 DB5F DB32            11      IN  A,(032H)
000E68 DB61 F5              11      PUSH    AF
000E69 DB62 CBA7             8      RES 4,A     ;高速RAMアクセスモード
000E6B DB64 D332            11      OUT (032H),A
                                
000E6D DB66 3E20             7      LD  A,020H
       DB68                     C8X1:
000E6F DB68 4E               7      LD  C,(HL)
000E70 DB69 77               7      LD  (HL),A
000E71 DB6A 2B               6      DEC HL
000E72 DB6B 79               4      LD  A,C
000E73 DB6C 10FA            13      DJNZ    C8X1
                                
000E75 DB6E F1              10      POP AF
000E76 DB6F D332            11      OUT (032H),A
000E78 DB71 C9              10      RET
                                
       DB72                     CTRL05:
000E79 DB72 CDD3EF          17      CALL    _POS
000E7C DB75 2A8EEF          16      LD  HL,(_TXADR)
000E7F DB78 3AB1EF          13      LD  A,(_WIDTH)
000E82 DB7B 95               4      SUB L
000E83 DB7C 47               4      LD  B,A
000E84 DB7D CDABDB          17      CALL    LOC0
       DB80                     CLLINE:
000E87 DB80 DB32            11      IN  A,(032H)
000E89 DB82 F5              11      PUSH    AF
000E8A DB83 CBA7             8      RES 4,A     ;高速RAMアクセスモード
000E8C DB85 D332            11      OUT (032H),A
000E8E DB87 3E20             7      LD  A,020H
       DB89                     CLLINE1:
000E90 DB89 77               7      LD  (HL),A
000E91 DB8A 23               6      INC HL
000E92 DB8B 10FC            13      DJNZ    CLLINE1
                                
000E94 DB8D F1              10      POP AF
000E95 DB8E D332            11      OUT (032H),A
000E97 DB90 C9              10      RET
                                
       DB91                     CTRL0D:
000E98 DB91 AF               4      XOR A
000E99 DB92 328EEF          13      LD  (_TXADR),A
000E9C DB95 C9              10      RET
                                
       DB96                     CTRL12:
000E9D DB96 21D1DA          10      LD  HL,INSFLG
000EA0 DB99 7E               7      LD  A,(HL)
000EA1 DB9A EECC             7      XOR 0CCH        ;CD:CALL ???? 1:LD BC,????
000EA3 DB9C 77               7      LD  (HL),A
000EA4 DB9D C9              10      RET
                                
       DB9E                     CTRL0B:
000EA5 DB9E 210000          10      LD  HL,0
000EA8 DBA1 228EEF          16      LD  (_TXADR),HL
000EAB DBA4 C9              10      RET
                                
       DBA5                     CTRL1B:
000EAC DBA5 3E01             7      LD  A,1
000EAE DBA7 32C8DA          13      LD  (ESCFLG),A
000EB1 DBAA C9              10      RET
       DBAB                     LOC0:
000EB2 DBAB 2A8EEF          16      LD  HL,(_TXADR)
       DBAE                     LOC1:
000EB5 DBAE C5              11      PUSH    BC
000EB6 DBAF D5              11      PUSH    DE
000EB7 DBB0 4D               4      LD  C,L
000EB8 DBB1 0608             7      LD  B,8
000EBA DBB3 5C               4      LD  E,H
000EBB DBB4 210078          10      LD  HL,120*256
000EBE DBB7 55               4      LD  D,L
       DBB8                     LOC2:
000EBF DBB8 29              11      ADD HL,HL
000EC0 DBB9 3001            12      JR  NC,LOC3
000EC2 DBBB 19              11      ADD HL,DE
       DBBC                     LOC3:
000EC3 DBBC 10FA            13      DJNZ    LOC2
000EC5 DBBE 09              11      ADD HL,BC
000EC6 DBBF ED5BB2EF        20      LD  DE,(TVRAMTOP)
000ECA DBC3 19              11      ADD HL,DE
000ECB DBC4 D1              10      POP DE
000ECC DBC5 C1              10      POP BC
000ECD DBC6 C9              10      RET
                                
       DBC7                     CONOUT1:
000ECE DBC7 CDEADB          17      CALL    CURSOR_ON
000ED1 DBCA 59               4      LD  E,C
000ED2 DBCB CDCDEF          17      CALL    _PRINT
000ED5 DBCE 7B               4      LD  A,E
000ED6 DBCF FE0A             7      CP  00AH
000ED8 DBD1 2006            12      JR  NZ,CURSOR_OFF
000EDA DBD3 CD91DB          17      CALL    CTRL0D
000EDD DBD6 CD72DB          17      CALL    CTRL05
       DBD9                     CURSOR_OFF:
000EE0 DBD9 F5              11      PUSH    AF
000EE1 DBDA 3E80             7      LD  A,080H
       DBDC                     CURSOR0:
000EE3 DBDC D351            11      OUT (051H),A
000EE5 DBDE 3A8EEF          13      LD  A,(_TXADR)
000EE8 DBE1 D350            11      OUT (050H),A
000EEA DBE3 3A8FEF          13      LD  A,(_TXADR+1)
000EED DBE6 D350            11      OUT (050H),A
000EEF DBE8 F1              10      POP AF
000EF0 DBE9 C9              10      RET
       DBEA                     CURSOR_ON:
000EF1 DBEA F5              11      PUSH    AF
000EF2 DBEB 3E81             7      LD  A,081H
000EF4 DBED 18ED            12      JR  CURSOR0
                                
       DBEF                     CTRL07:
000EF6 DBEF 3AB9EF          13      LD  A,(WK40)
000EF9 DBF2 F5              11      PUSH    AF
000EFA DBF3 F620             7      OR  20H
000EFC DBF5 D340            11      OUT (040H),A
000EFE DBF7 0610             7      LD  B,16
       DBF9                     C07X1:
000F00 DBF9 CD9EDD          17      CALL    VBLANK
000F03 DBFC 10FB            13      DJNZ    C07X1
000F05 DBFE F1              10      POP AF
000F06 DBFF D340            11      OUT (040H),A
000F08 DC01 C9              10      RET
                                
       DC02                     INSERT:
000F09 DC02 2A8EEF          16      LD  HL,(_TXADR)
000F0C DC05 3AB1EF          13      LD  A,(_WIDTH)
000F0F DC08 95               4      SUB L
000F10 DC09 47               4      LD  B,A
                                
000F11 DC0A CDABDB          17      CALL    LOC0
                                
000F14 DC0D DB32            11      IN  A,(032H)
000F16 DC0F F5              11      PUSH    AF
000F17 DC10 CBA7             8      RES 4,A     ;高速RAMアクセスモード
000F19 DC12 D332            11      OUT (032H),A
                                
000F1B DC14 3E20             7      LD  A,020H
       DC16                     INS1:
000F1D DC16 4E               7      LD  C,(HL)
000F1E DC17 77               7      LD  (HL),A
000F1F DC18 79               4      LD  A,C
000F20 DC19 23               6      INC HL
000F21 DC1A 10FA            13      DJNZ    INS1
                                
000F23 DC1C F1              10      POP AF
000F24 DC1D D332            11      OUT (032H),A
000F26 DC1F C9              10      RET
                                
       DC20                     CTRL0C:
000F27 DC20 CD9EDB          17      CALL    CTRL0B
       DC23                     CTRL06:
000F2A DC23 2A8EEF          16      LD  HL,(_TXADR)
       DC26                     CLS1:
000F2D DC26 DB32            11      IN  A,(032H)
000F2F DC28 F5              11      PUSH    AF
000F30 DC29 CBA7             8      RES 4,A     ;高速RAMアクセスモード
000F32 DC2B D332            11      OUT (032H),A
       DC2D                     CLS2:
000F34 DC2D E5              11      PUSH    HL
000F35 DC2E 3AB1EF          13      LD  A,(_WIDTH)
000F38 DC31 95               4      SUB L
000F39 DC32 47               4      LD  B,A
000F3A DC33 CDAEDB          17      CALL    LOC1
000F3D DC36 3E20             7      LD  A,020H
       DC38                     CLS3:
000F3F DC38 77               7      LD  (HL),A
000F40 DC39 23               6      INC HL
000F41 DC3A 10FC            13      DJNZ    CLS3
000F43 DC3C E1              10      POP HL
000F44 DC3D 2E00             7      LD  L,0
000F46 DC3F 24               4      INC H
000F47 DC40 3A97EF          13      LD  A,(_LINE)
000F4A DC43 BC               4      CP  H
000F4B DC44 20E7            12      JR  NZ,CLS2
000F4D DC46 F1              10      POP AF
000F4E DC47 D332            11      OUT (032H),A
000F50 DC49 C9              10      RET
                                
       DC4A                     CTRL04:
000F51 DC4A CDD3EF          17      CALL    _POS
000F54 DC4D 7D               4      LD  A,L
000F55 DC4E B7               4      OR  A
000F56 DC4F C8              11      RET Z
       DC50                     CTRL03:
000F57 DC50 CD91DB          17      CALL    CTRL0D
       DC53                     CTRL0A:
       DC53                     CTRL1F:
000F5A DC53 2A8EEF          16      LD  HL,(_TXADR)
000F5D DC56 24               4      INC H
000F5E DC57 C307DB          10      JP  PRINTE8
                                
       DC5A                     CTRL0E:
000F61 DC5A CDD3EF          17      CALL    _POS
000F64 DC5D 7C               4      LD  A,H
000F65 DC5E 1804            12      JR  SCR1
       DC60                     SCR:
000F67 DC60 3A97EF          13      LD  A,(_LINE)
000F6A DC63 3D               4      DEC A
       DC64                     SCR1:
000F6B DC64 C5              11      PUSH    BC
000F6C DC65 D5              11      PUSH    DE
000F6D DC66 E5              11      PUSH    HL
000F6E DC67 F5              11      PUSH    AF
000F6F DC68 210000          10      LD  HL,0
000F72 DC6B CDAEDB          17      CALL    LOC1
000F75 DC6E EB               4      EX  DE,HL
000F76 DC6F 210001          10      LD  HL,0100H
000F79 DC72 CDAEDB          17      CALL    LOC1
000F7C DC75 C1              10      POP BC
000F7D DC76 DB32            11      IN  A,(032H)
000F7F DC78 F5              11      PUSH    AF
000F80 DC79 CBA7             8      RES 4,A     ;高速RAMアクセスモード
000F82 DC7B D332            11      OUT (032H),A
000F84 DC7D 78               4      LD  A,B
000F85 DC7E B7               4      OR  A
       DC7F                     SCRUP1:
000F86 DC7F 2815            12      JR  Z,SCRCL
000F88 DC81 E5              11      PUSH    HL
000F89 DC82 D5              11      PUSH    DE
000F8A DC83 0608             7      LD  B,8
000F8C DC85 5F               4      LD  E,A
000F8D DC86 210078          10      LD  HL,120*256
000F90 DC89 55               4      LD  D,L
       DC8A                     SCRH2:
000F91 DC8A 29              11      ADD HL,HL
000F92 DC8B 3001            12      JR  NC,SCRH3
000F94 DC8D 19              11      ADD HL,DE
       DC8E                     SCRH3:
000F95 DC8E 10FA            13      DJNZ    SCRH2
000F97 DC90 4D               4      LD  C,L
000F98 DC91 44               4      LD  B,H
000F99 DC92 D1              10      POP DE
000F9A DC93 E1              10      POP HL
000F9B DC94 EDB0                    LDIR
                                
       DC96                     SCRCL:
000F9D DC96 F1              10      POP AF
000F9E DC97 D332            11      OUT (032H),A
                                
000FA0 DC99 3AB1EF          13      LD  A,(_WIDTH)
000FA3 DC9C 47               4      LD  B,A
000FA4 DC9D EB               4      EX  DE,HL
000FA5 DC9E CD80DB          17      CALL    CLLINE
000FA8 DCA1 E1              10      POP HL
000FA9 DCA2 D1              10      POP DE
000FAA DCA3 C1              10      POP BC
000FAB DCA4 C9              10      RET
       DCA5                     POS:
000FAC DCA5 2A8EEF          16      LD  HL,(_TXADR)
000FAF DCA8 C9              10      RET
                                
       DCA9                     GETL:
000FB0 DCA9 CDD3EF          17      CALL    _POS
000FB3 DCAC E5              11      PUSH    HL
000FB4 DCAD 3ECD             7      LD  A,0CDH      ;CALL ????
000FB6 DCAF 32D1DA          13      LD  (INSFLG),A
       DCB2                     GETL1:
000FB9 DCB2 CD31D9          17      CALL    _SYS08
000FBC DCB5 FE09             7      CP  9
000FBE DCB7 2008            12      JR  NZ,GETL1V
000FC0 DCB9 2100FF          10      LD  HL,KBUF
000FC3 DCBC CD34D6          17      CALL    MSX
000FC6 DCBF 18F1            12      JR  GETL1
       DCC1                     GETL1V:
000FC8 DCC1 5F               4      LD  E,A
000FC9 DCC2 CDCDEF          17      CALL    _PRINT
                                
000FCC DCC5 7B               4      LD  A,E
000FCD DCC6 FE0D             7      CP  00DH
000FCF DCC8 20E8            12      JR  NZ,GETL1
000FD1 DCCA 3E01             7      LD  A,1     ;LD BC,????
000FD3 DCCC 32D1DA          13      LD  (INSFLG),A
000FD6 DCCF 1100FF          10      LD  DE,KBUF
000FD9 DCD2 3AB1EF          13      LD  A,(_WIDTH)
000FDC DCD5 47               4      LD  B,A
000FDD DCD6 CDBFD3          17      CALL    ZERO_MEMORY_DE
                                
000FE0 DCD9 D1              10      POP DE
000FE1 DCDA CDD3EF          17      CALL    _POS
000FE4 DCDD 6B               4      LD  L,E
000FE5 DCDE 3AB1EF          13      LD  A,(_WIDTH)
000FE8 DCE1 95               4      SUB L
000FE9 DCE2 57               4      LD  D,A
000FEA DCE3 CDAEDB          17      CALL    LOC1
000FED DCE6 4D               4      LD  C,L
000FEE DCE7 7C               4      LD  A,H
000FEF DCE8 F630             7      OR  030H
000FF1 DCEA 47               4      LD  B,A
000FF2 DCEB 5A               4      LD  E,D
000FF3 DCEC 2100FF          10      LD  HL,KBUF
       DCEF                     GETL2:
000FF6 DCEF CDD0EF          17      CALL    _SCRN
000FF9 DCF2 03               6      INC BC
000FFA DCF3 77               7      LD  (HL),A
000FFB DCF4 23               6      INC HL
000FFC DCF5 1D               4      DEC E
000FFD DCF6 20F7            12      JR  NZ,GETL2
       DCF8                     GETL3:
000FFF DCF8 2B               6      DEC HL
001000 DCF9 7E               7      LD  A,(HL)
001001 DCFA FE21             7      CP  021H
001003 DCFC D0              11      RET NC
001004 DCFD 3600            10      LD  (HL),0
001006 DCFF 15               4      DEC D
001007 DD00 20F6            12      JR  NZ,GETL3
001009 DD02 C9              10      RET
                                
       DD03                     INKEY:
00100A DD03 E5              11      PUSH    HL
00100B DD04 2A90EF          16      LD  HL,(_KEYPS)
00100E DD07 7C               4      LD  A,H
00100F DD08 AD               4      XOR L
001010 DD09 280F            12      JR  Z,GETKEY
001012 DD0B 7C               4      LD  A,H
001013 DD0C 3C               4      INC A
001014 DD0D 3291EF          13      LD  (_KEYPS+1),A
001017 DD10 6F               4      LD  L,A
001018 DD11 26FE             7      LD  H,KEYBF/256
00101A DD13 7E               7      LD  A,(HL)
00101B DD14 E1              10      POP HL
       DD15                     INKEYD:
00101C DD15 B7               4      OR  A
00101D DD16 3292EF          13      LD  (_KEYD),A
001020 DD19 C9              10      RET
       DD1A                     GETKEY:
001021 DD1A 3A92EF          13      LD  A,(_KEYD)
001024 DD1D B7               4      OR  A
001025 DD1E 6F               4      LD  L,A
001026 DD1F 2610             7  GKSMC:  LD  H,16
       DD21                     GETKEY1:
001028 DD21 CD4FDD          17      CALL    CHKEY       ;キーを離すまで待つ
00102B DD24 281E            12      JR  Z,GETKEY2
00102D DD26 BD               4      CP  L
00102E DD27 201B            12      JR  NZ,GETKEY2
001030 DD29 DB40            11      IN  A,(040H)
001032 DD2B CB6F             8      BIT 5,A
001034 DD2D 28F2            12      JR  Z,GETKEY1
       DD2F                     GETKEY1X:
001036 DD2F CD4FDD          17      CALL    CHKEY       ;キーを離すまで待つ
001039 DD32 2810            12      JR  Z,GETKEY2
00103B DD34 BD               4      CP  L
00103C DD35 200D            12      JR  NZ,GETKEY2
00103E DD37 DB40            11      IN  A,(040H)
001040 DD39 CB6F             8      BIT 5,A
001042 DD3B 20F2            12      JR  NZ,GETKEY1X
001044 DD3D 25               4      DEC H
001045 DD3E 20E1            12      JR  NZ,GETKEY1
001047 DD40 3E01             7      LD  A,1
001049 DD42 1802            12      JR  GETKEY3
       DD44                     GETKEY2:
00104B DD44 3E10             7      LD  A,16
       DD46                     GETKEY3:
00104D DD46 3220DD          13      LD  (GKSMC+1),A
001050 DD49 3A92EF          13      LD  A,(_KEYD)
001053 DD4C B7               4      OR  A
001054 DD4D E1              10      POP HL
001055 DD4E C0              11      RET NZ
       DD4F                     CHKEY:
001056 DD4F C5              11      PUSH    BC
001057 DD50 DB08            11      IN  A,(8)       ;6:SHIFT,7:CTRL
001059 DD52 4F               4      LD  C,A
00105A DD53 3A0E00          13      LD  A,(00EH)
00105D DD56 CB5F             8      BIT 3,A
00105F DD58 2002            12      JR  NZ,CHKEYRSHIFT
001061 DD5A CBB1             8      RES 6,C
       DD5C                     CHKEYRSHIFT:
001063 DD5C 79               4      LD  A,C
001064 DD5D 3293EF          13      LD  (_KEYD+1),A
001067 DD60 E5              11      PUSH    HL
001068 DD61 0E00             7      LD  C,0
00106A DD63 21C8ED          10      LD  HL,KEY_TABLE
00106D DD66 CB77             8      BIT 6,A
00106F DD68 2003            12      JR  NZ,INKEY0
001071 DD6A 2130EE          10      LD  HL,SHIFT_TABLE
       DD6D                     INKEY0:
001074 DD6D CB7F             8      BIT 7,A
001076 DD6F 2003            12      JR  NZ,INKEY1
001078 DD71 2198EE          10      LD  HL,CTRL_TABLE
       DD74                     INKEY1:
00107B DD74 ED78            12      IN  A,(C)
00107D DD76 0608             7      LD  B,8
       DD78                     INKEY2:
00107F DD78 0F               4      RRCA
001080 DD79 300B            12      JR  NC,INKEY4
       DD7B                     INKEY3:
001082 DD7B 23               6      INC HL
001083 DD7C 10FA            13      DJNZ    INKEY2
001085 DD7E 0C               4      INC C
001086 DD7F 79               4      LD  A,C
001087 DD80 D60D             7      SUB 00DH
001089 DD82 20F0            12      JR  NZ,INKEY1
00108B DD84 1804            12      JR  INKEY5
       DD86                     INKEY4:
00108D DD86 7E               7      LD  A,(HL)
00108E DD87 B7               4      OR  A
00108F DD88 28F1            12      JR  Z,INKEY3
       DD8A                     INKEY5:
001091 DD8A E1              10      POP HL
001092 DD8B C1              10      POP BC
001093 DD8C 1887            12      JR  INKEYD
                                
       DD8E                     SCRN:
001095 DD8E E5              11      PUSH    HL
001096 DD8F DB32            11      IN  A,(032H)
001098 DD91 67               4      LD  H,A
001099 DD92 CBA7             8      RES 4,A     ;高速RAMアクセスモード
00109B DD94 D332            11      OUT (032H),A
00109D DD96 0A               7      LD  A,(BC)
00109E DD97 6F               4      LD  L,A
00109F DD98 7C               4      LD  A,H
0010A0 DD99 D332            11      OUT (032H),A
0010A2 DD9B 7D               4      LD  A,L
0010A3 DD9C E1              10      POP HL
0010A4 DD9D C9              10      RET
                                
       DD9E                     VBLANK:
0010A5 DD9E F5              11      PUSH    AF
       DD9F                     VBLANK0:
0010A6 DD9F DB40            11      IN  A,(040H)
0010A8 DDA1 E620             7      AND 020H
0010AA DDA3 20FA            12      JR  NZ,VBLANK0
       DDA5                     VBLANK1:
0010AC DDA5 DB40            11      IN  A,(040H)
0010AE DDA7 E620             7      AND 020H
0010B0 DDA9 28FA            12      JR  Z,VBLANK1
0010B2 DDAB F1              10      POP AF
0010B3 DDAC C9              10      RET
                                
       DDAD                     INIT_CRTC:
0010B4 DDAD 3E03             7      LD  A,3     ;80桁
0010B6 DDAF D330            11      OUT (030H),A
0010B8 DDB1 32BEEF          13      LD  (WK30),A
                                
0010BB DDB4 3E22             7      LD  A,022H      ;25行 64K RAM
0010BD DDB6 D331            11      OUT (031H),A
0010BF DDB8 32BFEF          13      LD  (WK31),A
                                
0010C2 DDBB 3EFF             7      LD  A,0FFH
0010C4 DDBD D3E4            11      OUT (0E4H),A    ;割り込みレベル設定
0010C6 DDBF 32B8EF          13      LD  (WKE4),A
0010C9 DDC2 3E00             7      LD  A,0
0010CB DDC4 D3E6            11      OUT (0E6H),A    ;割り込みマスク
                                
0010CD DDC6 3E19             7      LD  A,019H
0010CF DDC8 D340            11      OUT (040H),A    ;CRT I/F 同期ビットオン
0010D1 DDCA 32B9EF          13      LD  (WK40),A
0010D4 DDCD CD9EDD          17      CALL    VBLANK
                                
0010D7 DDD0 AF               4      XOR A
0010D8 DDD1 D351            11      OUT (051H),A    ;Reset CRTC
0010DA DDD3 3EA0             7      LD  A,0A0H
0010DC DDD5 D368            11      OUT (068H),A    ;DMAC: Mode Set(Reset)
0010DE DDD7 21C8F3          10      LD  HL,0F3C8H
0010E1 DDDA 22B2EF          16      LD  (TVRAMTOP),HL
0010E4 DDDD 0E64             7      LD  C,064H
0010E6 DDDF ED69            12      OUT (C),L       ;TVRAM LOW
0010E8 DDE1 ED61            12      OUT (C),H       ;TVRAM HIGH
0010EA DDE3 21B78B          10      LD  HL,08000H+120*25-1
0010ED DDE6 0C               4      INC C       ;65H
0010EE DDE7 ED69            12      OUT (C),L
0010F0 DDE9 ED61            12      OUT (C),H
0010F2 DDEB 3ECE             7      LD  A,080H+80-2
0010F4 DDED D350            11      OUT (050H),A
0010F6 DDEF 3E98             7      LD  A,080H+25-1
0010F8 DDF1 D350            11      OUT (050H),A
0010FA DDF3 DB40            11      IN  A,(040H)
0010FC DDF5 CB4F             8      BIT 1,A
0010FE DDF7 21DE67          10      LD  HL,067DEH
001101 DDFA 2003            12      JR  NZ,RESO1
001103 DDFC 21586F          10      LD  HL,06F58H
       DDFF                     RESO1:
001106 DDFF 0E50             7      LD  C,050H
001108 DE01 ED61            12      OUT (C),H
00110A DE03 ED69            12      OUT (C),L
                                
00110C DE05 3E53             7      LD  A,053H
00110E DE07 D350            11      OUT (050H),A
                                
001110 DE09 3E43             7      LD  A,043H
001112 DE0B D351            11      OUT (051H),A
                                
001114 DE0D 3EE4             7      LD  A,0E4H
001116 DE0F D368            11      OUT (068H),A
                                
001118 DE11 3E20             7      LD  A,020H
00111A DE13 D351            11      OUT (051H),A
                                
00111C DE15 CD9EDD          17      CALL    VBLANK
       DE18                     IVBL1:
00111F DE18 DB40            11      IN  A,(040H)
001121 DE1A CB6F             8      BIT 5,A
001123 DE1C 20FA            12      JR  NZ,IVBL1
                                
001125 DE1E 3E11             7      LD  A,011H
001127 DE20 D340            11      OUT (040H),A    ;CRT I/F 同期ビットオフ
001129 DE22 32B9EF          13      LD  (WK40),A
00112C DE25 C9              10      RET
                                
       DE26                     BIOS:
00112D DE26 F3               4      DI
00112E DE27 F5              11      PUSH    AF
00112F DE28 3ABFEF          13      LD  A,(WK31)
001132 DE2B CB8F             8      RES 1,A
001134 DE2D D331            11      OUT (031H),A
001136 DE2F F1              10      POP AF
001137 DE30 CD2DE4          17      CALL    JP_BC
00113A DE33 F5              11      PUSH    AF
00113B DE34 3ABFEF          13      LD  A,(WK31)
00113E DE37 D331            11      OUT (031H),A
001140 DE39 F1              10      POP AF
001141 DE3A FB               4      EI
001142 DE3B C9              10      RET
[EOF:88IO.ASM:SHIFT_JIS]
                                    INCLUDE "LDFILE.ASM"
                                
                                ;   LSX-Dodgers FILE
                                
       DE3C                     FILEC:
001143 DE3C CD47DE          17      CALL    FILE
       DE3F                     FILEC2:
001146 DE3F 3A15EF          13      LD  A,(FDRV+1)
001149 DE42 FE20             7      CP  020H
00114B DE44 C8              11      RET Z
00114C DE45 1839            12      JR  SETDIR1
                                
       DE47                     FILE:
00114E DE47 AF               4      XOR A
00114F DE48 3214EF          13      LD  (FDRV),A
001152 DE4B 67               4      LD  H,A
001153 DE4C 6F               4      LD  L,A
001154 DE4D 2222EF          16      LD  (FDRV+14),HL
001157 DE50 CD1EDF          17      CALL    SPCUT
00115A DE53 CD03DF          17      CALL    CCHK3
00115D DE56 2812            12      JR  Z,DEVI1
00115F DE58 13               6      INC DE
001160 DE59 1A               7      LD  A,(DE)
001161 DE5A 1B               6      DEC DE
001162 DE5B FE3A             7      CP  ':'
001164 DE5D 200B            12      JR  NZ,DEVI1
001166 DE5F 1A               7      LD  A,(DE)      ;DRIVE
001167 DE60 CD53E1          17      CALL    CAP
00116A DE63 D640             7      SUB '@'
00116C DE65 13               6      INC DE
00116D DE66 13               6      INC DE
00116E DE67 3214EF          13      LD  (FDRV),A
       DE6A                     DEVI1:
001171 DE6A 1A               7      LD  A,(DE)
001172 DE6B D65C             7      SUB 05CH        ;\
001174 DE6D 2009            12      JR  NZ,NOROOT
001176 DE6F 6F               4      LD  L,A     ;A=0でH=0のはずなのでHL=0
001177 DE70 222EEF          16      LD  (FDRV+26),HL
00117A DE73 2C               4      INC L
00117B DE74 2222EF          16      LD  (FDRV+14),HL
00117E DE77 13               6      INC DE
       DE78                     NOROOT:
                                
       DE78                     SETDIR:
00117F DE78 CDA4DE          17      CALL    FILED
001182 DE7B 1A               7      LD  A,(DE)
001183 DE7C FE5C             7      CP  05CH        ;\
001185 DE7E C0              11      RET NZ
001186 DE7F 13               6      INC DE
       DE80                     SETDIR1:
001187 DE80 3E10             7      LD  A,010H      ;Directory
001189 DE82 3221EF          13      LD  (FDRV+13),A
00118C DE85 D5              11      PUSH    DE
00118D DE86 1114EF          10      LD  DE,FDRV
001190 DE89 2A1EF0          16      LD  HL,(STABLE+2*00FH)
001193 DE8C CD0F00          17      CALL    JP_HL
001196 DE8F D1              10      POP DE
001197 DE90 B7               4      OR  A
001198 DE91 C0              11      RET NZ
                                
001199 DE92 3A21EF          13      LD  A,(FDRV+13)
00119C DE95 CB67             8      BIT 4,A
00119E DE97 C8              11      RET Z
                                
00119F DE98 CDEBDE          17      CALL    FILEI
0011A2 DE9B 2A2EEF          16      LD  HL,(FDRV+26)
0011A5 DE9E 23               6      INC HL
0011A6 DE9F 2222EF          16      LD  (FDRV+14),HL
0011A9 DEA2 18D4            12      JR  SETDIR
                                
       DEA4                     FILED:
0011AB DEA4 CDEBDE          17      CALL    FILEI
0011AE DEA7 2115EF          10      LD  HL,FNAME
                                
0011B1 DEAA 0608             7      LD  B,8
       DEAC                     FILE2:
0011B3 DEAC CDF8DE          17      CALL    CCHKF
0011B6 DEAF C8              11      RET Z
0011B7 DEB0 FE2A             7      CP  '*'
0011B9 DEB2 282E            12      JR  Z,FILE9
0011BB DEB4 FE2E             7      CP  '.'
0011BD DEB6 280C            12      JR  Z,FILE4
0011BF DEB8 77               7      LD  (HL),A
0011C0 DEB9 23               6      INC HL
0011C1 DEBA 10F0            13      DJNZ    FILE2
                                
       DEBC                     FILE3:
0011C3 DEBC CDF8DE          17      CALL    CCHKF
0011C6 DEBF C8              11      RET Z
0011C7 DEC0 FE2E             7      CP  '.'
0011C9 DEC2 20F8            12      JR  NZ,FILE3
                                
       DEC4                     FILE4:
0011CB DEC4 211DEF          10      LD  HL,FNAME+8
0011CE DEC7 0603             7      LD  B,3
                                
       DEC9                     FILE4L:
0011D0 DEC9 CDF8DE          17      CALL    CCHKF
0011D3 DECC C8              11      RET Z
0011D4 DECD FE2E             7      CP  '.'
0011D6 DECF 2008            12      JR  NZ,FILE12
0011D8 DED1 3215EF          13      LD  (FNAME),A   ;Parent directory(..)
0011DB DED4 3216EF          13      LD  (FNAME+1),A
0011DE DED7 3E20             7      LD  A,020H
       DED9                     FILE12:
0011E0 DED9 FE2A             7      CP  '*'
0011E2 DEDB 280A            12      JR  Z,FILE10
0011E4 DEDD 77               7      LD  (HL),A
0011E5 DEDE 23               6      INC HL
0011E6 DEDF 10E8            13      DJNZ    FILE4L
0011E8 DEE1 C9              10      RET
                                
       DEE2                     FILE9:              ;名前の*処理、名前の残りを?で埋める
0011E9 DEE2 CDE7DE          17      CALL    FILE10
0011EC DEE5 18D5            12      JR  FILE3
                                
       DEE7                     FILE10:
0011EE DEE7 3E3F             7      LD  A,'?'
0011F0 DEE9 1808            12      JR  FILL_MEMORY
       DEEB                     FILEI:              ;名前＋拡張子をスペースで初期化
0011F2 DEEB 3E20             7      LD  A,020H
0011F4 DEED 01000B          10      LD  BC,11*256   ;C=0にしておく
0011F7 DEF0 2115EF          10      LD  HL,FNAME
       DEF3                     FILL_MEMORY:            ;HLからBバイトAで埋める
0011FA DEF3 77               7      LD  (HL),A
0011FB DEF4 23               6      INC HL
0011FC DEF5 10FC            13      DJNZ    FILL_MEMORY
0011FE DEF7 C9              10      RET
                                
       DEF8                     CCHKF:
0011FF DEF8 1A               7      LD  A,(DE)
001200 DEF9 CD00DF          17      CALL    CCHK2
001203 DEFC C8              11      RET Z
001204 DEFD C36BE2          10      JP  FKAN
                                
       DF00                     CCHK2:
001207 DF00 0C               4      INC C
001208 DF01 0D               4      DEC C
001209 DF02 C0              11      RET NZ
       DF03                     CCHK3:              ;ZF=1 で使えない文字
00120A DF03 FE2B             7      CP  '+'
00120C DF05 C8              11      RET Z
00120D DF06 FE2C             7      CP  ','
00120F DF08 C8              11      RET Z
001210 DF09 FE2F             7      CP  '/'
001212 DF0B C8              11      RET Z
001213 DF0C FE3A             7      CP  ':'
001215 DF0E C8              11      RET Z
001216 DF0F FE3B             7      CP  ';'
001218 DF11 C8              11      RET Z
001219 DF12 FE3D             7      CP  '='
00121B DF14 C8              11      RET Z
00121C DF15 FE5C             7      CP  05CH    ;\
00121E DF17 C8              11      RET Z
00121F DF18 FE20             7      CP  020H
001221 DF1A D0              11      RET NC
001222 DF1B BF               4      CP  A       ;Z=1
001223 DF1C C9              10      RET
                                
       DF1D                     SS1:
001224 DF1D 13               6      INC DE
       DF1E                     SPCUT:              ;スペースをカット
001225 DF1E 1A               7      LD  A,(DE)
001226 DF1F FE20             7      CP  020H
001228 DF21 28FA            12      JR  Z,SS1
00122A DF23 C9              10      RET
                                
       DF24                     SETDRVF:
00122B DF24 1114EF          10      LD  DE,FDRV
       DF27                     SETDRV0:
00122E DF27 CD30DF          17      CALL    SETDRV
001231 DF2A FDE1            14      POP IY
001233 DF2C C1              10      POP BC
001234 DF2D D1              10      POP DE
001235 DF2E E1              10      POP HL
001236 DF2F C9              10      RET
                                
       DF30                     SETDRV:
001237 DF30 E3              19      EX  (SP),HL     ;HL=RETRN ADDRESS
001238 DF31 D5              11      PUSH    DE      ;PUSH HL/DE/BC/IY
001239 DF32 C5              11      PUSH    BC
00123A DF33 1A               7      LD  A,(DE)
00123B DF34 D5              11      PUSH    DE
00123C DF35 FDE3            23      EX  (SP),IY
                                
00123E DF37 CD43DF          17      CALL    GETDRV
001241 DF3A 3C               4      INC A
001242 DF3B FD7700          19      LD  (IY+0),A    ;(FCB)ドライブ番号
001245 DF3E 3D               4      DEC A
001246 DF3F CDD9EF          17      CALL    _CHGDRV
                                
001249 DF42 E9               4      JP  (HL)
                                
       DF43                     GETDRV:
00124A DF43 E67F             7      AND 07FH
00124C DF45 D601             7      SUB 001H
00124E DF47 3003            12      JR  NC,GETDRV1
001250 DF49 3A87EF          13      LD  A,(_DVSW)   ;Current Drive
       DF4C                     GETDRV1:
001253 DF4C 3288EF          13      LD  (_DRV),A
001256 DF4F C9              10      RET
                                
       DF50                     SOPENX:
001257 DF50 1139EF          10      LD  DE,SFILE
00125A DF53 1A               7      LD  A,(DE)
00125B DF54 FDBE00           7      CP  (IY+0)      ;(FCB)ドライブ番号
00125E DF57 2024            12      JR  NZ,SOPEN
001260 DF59 13               6      INC DE
001261 DF5A FDE5            15      PUSH    IY
001263 DF5C E1              10      POP HL
001264 DF5D 23               6      INC HL
001265 DF5E CDEBE0          17      CALL    CPFILE
001268 DF61 201A            12      JR  NZ,SOPEN
                                
00126A DF63 2AF4F0          16      LD  HL,(SCDIR)
00126D DF66 FD750E          19      LD  (IY+14),L   ;(FCB)アクセスするディレクトリのクラスタ番号+1
001270 DF69 FD740F          19      LD  (IY+15),H
                                
001273 DF6C 2AF8F0          16      LD  HL,(SFNDF)  ;Direcroty location and Flags
001276 DF6F 229FEF          16      LD  (_FILEN),HL
                                
001279 DF72 ED5BF6F0        20      LD  DE,(SFBPS)
00127D DF76 2139EF          10      LD  HL,SFILE
001280 DF79 36FF            10      LD  (HL),0FFH
001282 DF7B 23               6      INC HL
001283 DF7C C9              10      RET
       DF7D                     SOPEN:
001284 DF7D 2193E0          10      LD  HL,FILESE
       DF80                     SOPENC:
001287 DF80 22B9DF          16      LD  (OPENPAT+1),HL
                                
00128A DF83 CDE2EF          17      CALL    _RDFATX     ;Detect Media
00128D DF86 3856            12      JR  C,RDDERR
                                
00128F DF88 AF               4      XOR A
001290 DF89 329FEF          13      LD  (_FILEN),A
001293 DF8C CD98E1          17      CALL    LDDIRX1     ;A=0で呼び出す
001296 DF8F 2818            12      JR  Z,SDIRX1
                                
001298 DF91 CD84E0          17      CALL    READ_DIR    ;Sub Directory
00129B DF94 3808            12      JR  C,SDIRX0
00129D DF96 2A7EF0          16      LD  HL,(_DTBUF)
0012A0 DF99 7E               7      LD  A,(HL)
0012A1 DF9A FE2E             7      CP  '.'
0012A3 DF9C 280F            12      JR  Z,SOPEN1
       DF9E                     SDIRX0:
0012A5 DF9E AF               4      XOR A
0012A6 DF9F 32A0EF          13      LD  (_DIRF),A
0012A9 DFA2 FD360E01        19      LD  (IY+14),1   ;(FCB)レコードサイズ
0012AD DFA6 FD770F          19      LD  (IY+15),A
       DFA9                     SDIRX1:
0012B0 DFA9 ED5BFCF0        20      LD  DE,(_DIRPS) ;Root Directory
       DFAD                     SOPEN1:
0012B4 DFAD 0E20             7  SDECPAT:LD  C,32        ;自己書き換え 1セクタ辺りのディレクトリエントリ数  1024=32 / 512=16 / 256=8
       DFAF                     SOPEN1X:
0012B6 DFAF CD84E0          17      CALL    READ_DIR    ;FILE SEARCH
0012B9 DFB2 382A            12      JR  C,RDDERR
0012BB DFB4 2A7EF0          16      LD  HL,(_DTBUF)
       DFB7                     SOPEN2:
0012BE DFB7 D5              11      PUSH    DE
0012BF DFB8 CD93E0          17  OPENPAT:CALL    FILESE      ;(self-modifying code)
0012C2 DFBB D1              10      POP DE
0012C3 DFBC 386E            12      JR  C,SOPENE
0012C5 DFBE 281B            12      JR  Z,SCF_FF_RET
       DFC0                     SOPEN3:
0012C7 DFC0 3AA0EF          13      LD  A,(_DIRF)   ;ディレクトリか判別
0012CA DFC3 B7               4      OR  A
0012CB DFC4 200C            12      JR  NZ,SOPEN5
0012CD DFC6 13               6      INC DE      ;ルートディレクトリ
0012CE DFC7 E5              11      PUSH    HL
0012CF DFC8 210C00          10  MD_PAT: LD  HL,12       ;(self-modifying code)MAXDIR
0012D2 DFCB ED52            15      SBC HL,DE       ;CF=0 なので SUB HL,DE
0012D4 DFCD E1              10      POP HL
0012D5 DFCE 20DD            12      JR  NZ,SOPEN1
0012D7 DFD0 1807            12      JR  SOPEN6
       DFD2                     SOPEN5:
0012D9 DFD2 CD9DE8          17      CALL    GNCLX       ;END DIR
0012DC DFD5 D8              11      RET C
0012DD DFD6 CD4BE1          17      CALL    ENDCL
       DFD9                     SOPEN6:
0012E0 DFD9 38D2            12      JR  C,SOPEN1
       DFDB                     SCF_FF_RET:
0012E2 DFDB 37               4      SCF         ;CF=1
0012E3 DFDC 9F               4      SBC A,A     ;A=0FFH
0012E4 DFDD C9              10      RET
                                
       DFDE                     RDDERR:
0012E5 DFDE BF               4      CP  A       ;READ ERR CF=1 ZF=1
0012E6 DFDF 37               4      SCF
0012E7 DFE0 C9              10      RET
                                
       DFE1                     NOPEN:
0012E8 DFE1 2193E0          10      LD  HL,FILESE
0012EB DFE4 22B9DF          16      LD  (OPENPAT+1),HL
0012EE DFE7 FD2A98EF        20      LD  IY,(_FCB)
0012F2 DFEB CD7EE2          17      CALL    CHKWILDX
0012F5 DFEE 30EB            12      JR  NC,SCF_FF_RET
0012F7 DFF0 FD7E00          19      LD  A,(IY+0)    ;(FCB)ドライブ番号
0012FA DFF3 3D               4      DEC A
0012FB DFF4 3288EF          13      LD  (_DRV),A
0012FE DFF7 CDD9EF          17      CALL    _CHGDRV
001301 DFFA D8              11      RET C
001302 DFFB 2AF8F0          16      LD  HL,(SFNDF)  ;Direcroty location and Flags
001305 DFFE 229FEF          16      LD  (_FILEN),HL
                                
001308 E001 CD93E1          17      CALL    LDDIRX
00130B E004 ED5B9AEF        20      LD  DE,(_FBPS)
00130F E008 CD84E0          17      CALL    READ_DIR
001312 E00B 38D1            12      JR  C,RDDERR
001314 E00D 3A9EEF          13      LD  A,(_FBCNT)
001317 E010 3D               4      DEC A
001318 E011 28AD            12      JR  Z,SOPEN3
       E013                     NOPEN2:
00131A E013 2A9CEF          16      LD  HL,(_FBAD)
00131D E016 012000          10      LD  BC,020H
001320 E019 09              11      ADD HL,BC
001321 E01A 4F               4      LD  C,A
001322 E01B 189A            12      JR  SOPEN2
                                
       E01D                     SOPENE2:
001324 E01D 229CEF          16      LD  (_FBAD),HL
001327 E020 79               4      LD  A,C
001328 E021 329EEF          13      LD  (_FBCNT),A
00132B E024 ED539AEF        20      LD  (_FBPS),DE
00132F E028 FD2298EF        20      LD  (_FCB),IY
       E02C                     SOPENE:
001333 E02C AF               4      XOR A
001334 E02D C9              10      RET
                                
       E02E                     COPEN:
001335 E02E FD360D20        19      LD  (IY+13),020H    ;(FCB)属性(アトリビュート)
                                
001339 E032 21B0E0          10      LD  HL,NEXTSE
00133C E035 CD80DF          17      CALL    SOPENC
00133F E038 D0              11      RET NC
001340 E039 C8              11      RET Z
001341 E03A 3AA0EF          13      LD  A,(_DIRF)   ;ディレクトリか判別
001344 E03D B7               4      OR  A
001345 E03E 37               4      SCF
001346 E03F C8              11      RET Z       ;ルートディレクトリ
001347 E040 0601             7      LD  B,1
001349 E042 CDDCE2          17      CALL    WRDF
00134C E045 D8              11      RET C
00134D E046 ED5BFEF0        20      LD  DE,(_CLPS)
001351 E04A D5              11      PUSH    DE
001352 E04B CD14E1          17      CALL    DCPAT
001355 E04E CD28E7          17      CALL    DRDNX
001358 E051 2A7EF0          16      LD  HL,(_DTBUF) ;ディレクトリエントリを0クリア
00135B E054 3A1CE6          13      LD  A,(SECSZ+2) ;1024=4 / 512=2 / 256=1
00135E E057 47               4      LD  B,A
00135F E058 AF               4      XOR A
001360 E059 4F               4      LD  C,A
       E05A                     COPENCL:
001361 E05A 77               7      LD  (HL),A
001362 E05B EDA1            16      CPI         ;HL=HL+1 BC=BC-1 BCが0の場合にP/V=0
001364 E05D EA5AE0          10      JP  PE,COPENCL
                                
001367 E060 3A32E1          13      LD  A,(SPCPAT+1)    ;1クラスタの論理セクタ数
00136A E063 3D               4      DEC A
00136B E064 2819            12      JR  Z,COPENE
00136D E066 3E01             7      LD  A,1     ;1セクタ辺りのセクタ数が2以上の場合
00136F E068 3295E8          13      LD  (_SECPS+1),A
001372 E06B D1              10      POP DE      ;DE=(_CLPS)
001373 E06C D5              11      PUSH    DE
       E06D                     COPEN1:
001374 E06D D5              11      PUSH    DE      ;データバッファに入らないセクタもゼロクリア
001375 E06E C5              11      PUSH    BC
001376 E06F 2A7EF0          16      LD  HL,(_DTBUF)
001379 E072 CD2EE1          17      CALL    CLUSTX
00137C E075 CD03EA          17      CALL    DWT24
00137F E078 C1              10      POP BC
001380 E079 D1              10      POP DE
001381 E07A CD94E8          17      CALL    NEXTX
001384 E07D 20EE            12      JR  NZ,COPEN1
       E07F                     COPENE:
001386 E07F 2A7EF0          16      LD  HL,(_DTBUF)
001389 E082 D1              10      POP DE
00138A E083 C9              10      RET
                                
       E084                     READ_DIR:
00138B E084 ED53FEF0        20      LD  (_CLPS),DE
00138F E088 C5              11      PUSH    BC
001390 E089 D5              11      PUSH    DE
001391 E08A CD14E1          17      CALL    DCPAT
001394 E08D CD08E7          17      CALL    DRDX
001397 E090 D1              10      POP DE
001398 E091 C1              10      POP BC
001399 E092 C9              10      RET
                                
       E093                     FILESE:
00139A E093 7E               7      LD  A,(HL)
00139B E094 B7               4      OR  A
00139C E095 C8              11      RET Z       ;END:ZF=1 CF=0
00139D E096 FEE5             7      CP  0E5H
00139F E098 280E            12      JR  Z,FILESE1
0013A1 E09A FDE5            15      PUSH    IY
0013A3 E09C D1              10      POP DE
0013A4 E09D 13               6      INC DE
0013A5 E09E E5              11      PUSH    HL
0013A6 E09F CDEBE0          17      CALL    CPFILE
0013A9 E0A2 CC0CE1          17      CALL    Z,CPFILE2
0013AC E0A5 E1              10      POP HL
0013AD E0A6 37               4      SCF
0013AE E0A7 C8              11      RET Z       ;!!!:(ZF=1) CF=1
       E0A8                     FILESE1:
0013AF E0A8 CDBFE0          17      CALL    FNEXT
0013B2 E0AB 20E6            12      JR  NZ,FILESE
       E0AD                     ZF0_CF0_AFF_RET:
0013B4 E0AD F6FF             7      OR  0FFH        ;ZF=0 CF=0
0013B6 E0AF C9              10      RET
                                
       E0B0                     NEXTSE:
0013B7 E0B0 7E               7      LD  A,(HL)
0013B8 E0B1 B7               4      OR  A
0013B9 E0B2 37               4      SCF
0013BA E0B3 C8              11      RET Z       ;!!!:ZF=1 CF=1
0013BB E0B4 FEE5             7      CP  0E5H
0013BD E0B6 37               4      SCF
0013BE E0B7 C8              11      RET Z       ;!!!:(ZF=1) CF=1
0013BF E0B8 CDBFE0          17      CALL    FNEXT
0013C2 E0BB 20F3            12      JR  NZ,NEXTSE
0013C4 E0BD 18EE            12      JR  ZF0_CF0_AFF_RET
                                
       E0BF                     FNEXT:
0013C6 E0BF E5              11      PUSH    HL
0013C7 E0C0 219FEF          10      LD  HL,_FILEN
0013CA E0C3 34              11      INC (HL)
0013CB E0C4 E1              10      POP HL
0013CC E0C5 112000          10      LD  DE,020H
0013CF E0C8 19              11      ADD HL,DE
0013D0 E0C9 0D               4      DEC C
0013D1 E0CA C9              10      RET
                                
       E0CB                     CPNAME:
0013D2 E0CB C5              11      PUSH    BC
0013D3 E0CC D5              11      PUSH    DE
0013D4 E0CD E5              11      PUSH    HL
0013D5 E0CE CDE5E0          17      CALL    CPFILE4
0013D8 E0D1 E1              10      POP HL
0013D9 E0D2 23               6      INC HL
0013DA E0D3 23               6      INC HL
0013DB E0D4 23               6      INC HL
0013DC E0D5 23               6      INC HL
0013DD E0D6 D1              10      POP DE
0013DE E0D7 C1              10      POP BC
0013DF E0D8 2005            12      JR  NZ,CPNAME1
0013E1 E0DA 7E               7      LD  A,(HL)
0013E2 E0DB 23               6      INC HL
0013E3 E0DC 66               7      LD  H,(HL)
0013E4 E0DD 6F               4      LD  L,A
0013E5 E0DE C9              10      RET
       E0DF                     CPNAME1:
0013E6 E0DF 23               6      INC HL
0013E7 E0E0 23               6      INC HL
0013E8 E0E1 10E8            13      DJNZ    CPNAME
0013EA E0E3 37               4      SCF
0013EB E0E4 C9              10      RET
                                
       E0E5                     CPFILE4:
0013EC E0E5 C5              11      PUSH    BC
0013ED E0E6 010004          10      LD  BC,00400H
0013F0 E0E9 1804            12      JR  CPSTR1
       E0EB                     CPFILE:
0013F2 E0EB C5              11      PUSH    BC
0013F3 E0EC 01000B          10      LD  BC,00B00H
       E0EF                     CPSTR1:
0013F6 E0EF 1A               7      LD  A,(DE)
0013F7 E0F0 FE3F             7      CP  '?'     ;Wild card
0013F9 E0F2 2812            12      JR  Z,CPSTR2
0013FB E0F4 7E               7      LD  A,(HL)
0013FC E0F5 CD64E2          17      CALL    FKANC
0013FF E0F8 E5              11      PUSH    HL
001400 E0F9 67               4      LD  H,A
001401 E0FA 1A               7      LD  A,(DE)
001402 E0FB CB01             4      RLC C
001404 E0FD CD64E2          17      CALL    FKANC
001407 E100 CB09             4      RRC C
001409 E102 BC               4      CP  H       ;CP (HL),(DE)
00140A E103 E1              10      POP HL
00140B E104 2004            12      JR  NZ,CPSTR3
       E106                     CPSTR2:
00140D E106 13               6      INC DE
00140E E107 23               6      INC HL
00140F E108 10E5            13      DJNZ    CPSTR1
       E10A                     CPSTR3:
001411 E10A C1              10      POP BC
001412 E10B C9              10      RET
                                
       E10C                     CPFILE2:
001413 E10C FD7E0D          19      LD  A,(IY+13)   ;(FCB)属性(アトリビュート)
001416 E10F F6E1             7      OR  0E1H
001418 E111 2F               4      CPL
001419 E112 A6               7      AND (HL)
00141A E113 C9              10      RET
                                
       E114                     DCPAT:
00141B E114 0E00             7      LD  C,0
00141D E116 2A7EF0          16      LD  HL,(_DTBUF)
001420 E119 3AA0EF          13      LD  A,(_DIRF)   ;ディレクトリか判別
001423 E11C B7               4      OR  A
001424 E11D C8              11      RET Z       ;ルートディレクトリの場合はCレジスタを0にしておく(CDEがセクタ番号)
001425 E11E 3A32E1          13      LD  A,(SPCPAT+1)
001428 E121 4F               4      LD  C,A
001429 E122 3A95E8          13      LD  A,(_SECPS+1)
00142C E125 B9               4      CP  C
00142D E126 3801            12      JR  C,DC1
00142F E128 AF               4      XOR A
       E129                     DC1:
001430 E129 F680             7      OR  080H
001432 E12B 32A0EF          13      LD  (_DIRF),A   ;bit0-6:セクタインデックス
       E12E                     CLUSTX:
001435 E12E E5              11      PUSH    HL
001436 E12F EB               4      EX  DE,HL
001437 E130 AF               4      XOR A
001438 E131 0E01             7  SPCPAT: LD  C,1     ;自己書き換え（1クラスタの論理セクタ数）
       E133                     L_CLDBL:
00143A E133 CB19             8      RR  C       ;->CF
00143C E135 3804            12      JR  C,E_CLDBL
00143E E137 29              11      ADD HL,HL       ;*2
00143F E138 8F               4      ADC A,A
001440 E139 18F8            12      JR  L_CLDBL
       E13B                     E_CLDBL:
001442 E13B 4F               4      LD  C,A
001443 E13C 3A95E8          13      LD  A,(_SECPS+1)
001446 E13F B5               4      OR  L
001447 E140 6F               4      LD  L,A
001448 E141 110800          10  CLSPAT: LD  DE,8    ;+8 (2D)  !ADDCL (self-modifying code)
00144B E144 AF               4      XOR A
00144C E145 19              11      ADD HL,DE   ;データ格納領域の先頭論理セクタ番号
00144D E146 89               4      ADC A,C
00144E E147 4F               4      LD  C,A
00144F E148 EB               4      EX  DE,HL
001450 E149 E1              10      POP HL
001451 E14A C9              10      RET
                                
       E14B                     ENDCL:
001452 E14B 7A               4      LD  A,D ;END CLUSTER
001453 E14C FE01             7  CLPAT1: CP  1   ;164=356    (self-modifying code)
001455 E14E C0              11      RET NZ
001456 E14F 7B               4      LD  A,E
001457 E150 FE64             7  CLPAT2: CP  064H    ;       (self-modifying code)
001459 E152 C9              10      RET
                                
       E153                     CAP:
00145A E153 FE61             7      CP  'a'
00145C E155 D8              11      RET C
00145D E156 FE7B             7      CP  'z'+1
00145F E158 D0              11      RET NC
001460 E159 D620             7      SUB 020H
001462 E15B C9              10      RET
       E15C                     CAP2:
001463 E15C CD53E1          17      CALL    CAP
       E15F                     CAP3:
001466 E15F CD68E1          17      CALL    CAP4
001469 E162 FE21             7      CP  021H
00146B E164 D0              11      RET NC
00146C E165 3EA0             7      LD  A,0A0H
00146E E167 C9              10      RET
       E168                     CAP4:
00146F E168 FE05             7      CP  5
001471 E16A C0              11      RET NZ
001472 E16B 3EE5             7      LD  A,0E5H
001474 E16D C9              10      RET
                                
       E16E                     CHDIR:
001475 E16E CD32EB          17      CALL    GETDPBD
001478 E171 381D            12      JR  C,CHDIR2
00147A E173 DD751A          19      LD  (IX+01AH),L     ;_SDIR_
00147D E176 DD741B          19      LD  (IX+01BH),H     ;_SDIR_+1
001480 E179 1815            12      JR  CHDIR2      ;POP_IX_RET
                                
       E17B                     LDDIR:
001482 E17B CD32EB          17      CALL    GETDPBD
001485 E17E DD5E1A          19      LD  E,(IX+01AH)     ;_SDIR_
001488 E181 DD561B          19      LD  D,(IX+01BH)     ;_SDIR_+1
00148B E184 13               6      INC DE
00148C E185 FD730E          19      LD  (IY+14),E   ;(FCB)アクセスするディレクトリのクラスタ番号+1
00148F E188 FD720F          19      LD  (IY+15),D
001492 E18B 1B               6      DEC DE
001493 E18C AF               4      XOR A
001494 E18D 32A0EF          13      LD  (_DIRF),A
       E190                     CHDIR2:
001497 E190 DDE1            14      POP IX
001499 E192 C9              10      RET
                                
       E193                     LDDIRX:
00149A E193 3AA0EF          13      LD  A,(_DIRF)   ;(FCB)アクセスするディレクトリのセクタインデックス
00149D E196 E67F             7      AND 07FH
       E198                     LDDIRX1:
00149F E198 3295E8          13      LD  (_SECPS+1),A
0014A2 E19B FD5E0E          19      LD  E,(IY+14)   ;(FCB)アクセスするディレクトリのクラスタ番号+1
0014A5 E19E FD560F          19      LD  D,(IY+15)
0014A8 E1A1 1B               6      DEC DE
0014A9 E1A2 CD4BE1          17      CALL    ENDCL
0014AC E1A5 D47BE1          17      CALL    NC,LDDIR
       E1A8                     LDDIRS:
0014AF E1A8 7A               4      LD  A,D
0014B0 E1A9 B3               4      OR  E
0014B1 E1AA 32A0EF          13      LD  (_DIRF),A   ;ディレクトリか判別
0014B4 E1AD C9              10      RET
                                
       E1AE                     KILL:
0014B5 E1AE CD7EE2          17      CALL    CHKWILDX
0014B8 E1B1 3834            12      JR  C,KILLW
0014BA E1B3 CD50DF          17      CALL    SOPENX
       E1B6                     KILLS:
0014BD E1B6 3E1F             7      LD  A,01FH
0014BF E1B8 D4FAE1          17      CALL    NC,CHKATT
0014C2 E1BB D8              11      RET C
       E1BC                     KILLSX:
0014C3 E1BC 36E5            10      LD  (HL),0E5H   ;DIR
0014C5 E1BE CD58E2          17      CALL    WTDB
0014C8 E1C1 111A00          10      LD  DE,01AH
0014CB E1C4 19              11      ADD HL,DE
0014CC E1C5 5E               7      LD  E,(HL)
0014CD E1C6 23               6      INC HL
0014CE E1C7 56               7      LD  D,(HL)
       E1C8                     KILLS1:
0014CF E1C8 CD4BE1          17      CALL    ENDCL
0014D2 E1CB D0              11      RET NC      ;CF=0
0014D3 E1CC 21FEFF          10      LD  HL,0-2
0014D6 E1CF 19              11      ADD HL,DE
0014D7 E1D0 D0              11      RET NC      ;DE= 0 or 1
0014D8 E1D1 D5              11      PUSH    DE
0014D9 E1D2 CDF7EF          17      CALL    _GNCL
0014DC E1D5 ED53FEF0        20      LD  (_CLPS),DE
0014E0 E1D9 D1              10      POP DE
0014E1 E1DA 210000          10      LD  HL,0
0014E4 E1DD D4FAEF          17      CALL    NC,_SNCL
0014E7 E1E0 D8              11      RET C
0014E8 E1E1 ED5BFEF0        20      LD  DE,(_CLPS)  ;FAT
0014EC E1E5 18E1            12      JR  KILLS1
                                
       E1E7                     KILLW:
0014EE E1E7 CD7DDF          17      CALL    SOPEN
       E1EA                     KILLW1:
0014F1 E1EA 380B            12      JR  C,KILLW2
0014F3 E1EC CD1DE0          17      CALL    SOPENE2
0014F6 E1EF CDB6E1          17      CALL    KILLS
0014F9 E1F2 CDE1DF          17      CALL    NOPEN
0014FC E1F5 18F3            12      JR  KILLW1
       E1F7                     KILLW2:
0014FE E1F7 C8              11      RET Z
0014FF E1F8 3F               4      CCF
001500 E1F9 C9              10      RET
                                
       E1FA                     CHKATT:
001501 E1FA E5              11      PUSH    HL
001502 E1FB 110B00          10      LD  DE,00BH
001505 E1FE 19              11      ADD HL,DE
001506 E1FF A6               7      AND (HL)
001507 E200 E1              10      POP HL
001508 E201 C8              11      RET Z
001509 E202 37               4      SCF
00150A E203 C9              10      RET
                                
       E204                     NAME:
00150B E204 CD7EE2          17      CALL    CHKWILDX
00150E E207 D8              11      RET C
00150F E208 110400          10      LD  DE,4
001512 E20B 19              11      ADD HL,DE
001513 E20C 2224E2          16      LD  (NAMEP+2),HL
001516 E20F 23               6      INC HL
001517 E210 CD82E2          17      CALL    CHKWILD
00151A E213 D8              11      RET C
                                
00151B E214 CD50DF          17      CALL    SOPENX
00151E E217 3E0F             7      LD  A,00FH
001520 E219 D4FAE1          17      CALL    NC,CHKATT
001523 E21C D8              11      RET C
                                
001524 E21D FD7E00          19      LD  A,(IY+0)
001527 E220 FDE5            15      PUSH    IY
001529 E222 FD210000        14  NAMEP:  LD  IY,0        ;自己書き換え
00152D E226 FD7700          19      LD  (IY+0),A
001530 E229 CD50DF          17      CALL    SOPENX
001533 E22C FDE3            23      EX  (SP),IY
001535 E22E 3F               4      CCF
001536 E22F D47DDF          17      CALL    NC,SOPEN
001539 E232 EB               4      EX  DE,HL
00153A E233 E1              10      POP HL
00153B E234 D8              11      RET C
                                
       E235                     SETNAME:
00153C E235 01000B          10      LD  BC,11*256
00153F E238 23               6      INC HL
001540 E239 7E               7      LD  A,(HL)
001541 E23A FEE5             7      CP  0E5H
001543 E23C 2004            12      JR  NZ,SNAME1
001545 E23E 3E05             7      LD  A,5
001547 E240 180E            12      JR  SNAME3
       E242                     SNAME1:
001549 E242 7E               7      LD  A,(HL)
00154A E243 0C               4      INC C
00154B E244 0D               4      DEC C
00154C E245 2009            12      JR  NZ,SNAME3
00154E E247 CD53E1          17      CALL    CAP
001551 E24A FEA0             7      CP  0A0H
001553 E24C 2002            12      JR  NZ,SNAME3
001555 E24E 3E20             7      LD  A,020H
       E250                     SNAME3:
001557 E250 12               7      LD  (DE),A
001558 E251 7E               7      LD  A,(HL)
001559 E252 23               6      INC HL
00155A E253 CD6BE2          17      CALL    FKAN
00155D E256 10EA            13      DJNZ    SNAME1
       E258                     WTDB:
00155F E258 3EFF             7      LD  A,0FFH
001561 E25A 3239EF          13      LD  (SFILE),A
       E25D                     SWTDBF:
001564 E25D 3E01             7      LD  A,1
001566 E25F 32A4EF          13      LD  (_WTDBF),A
001569 E262 AF               4      XOR A
00156A E263 C9              10      RET
                                
       E264                     FKANC:
00156B E264 CB41             8      BIT 0,C
00156D E266 CC5CE1          17      CALL    Z,CAP2
001570 E269 1801            12      JR  FKANX
       E26B                     FKAN:           ;漢字チェック
001572 E26B 13               6      INC DE
       E26C                     FKANX:
001573 E26C CB41             8      BIT 0,C
001575 E26E CB81             8      RES 0,C
001577 E270 C0              11      RET NZ
001578 E271 FE80             7      CP  080H
00157A E273 D8              11      RET C
00157B E274 FEA0             7      CP  0A0H
00157D E276 3803            12      JR  C,FKAN1
00157F E278 FEE0             7      CP  0E0H
001581 E27A D8              11      RET C
       E27B                     FKAN1:
001582 E27B 0C               4      INC C
001583 E27C A7               4      AND A
001584 E27D C9              10      RET
                                
       E27E                     CHKWILDX:
001585 E27E FDE5            15      PUSH    IY
001587 E280 E1              10      POP HL
001588 E281 23               6      INC HL
       E282                     CHKWILD:
001589 E282 060B             7      LD  B,11
00158B E284 3E3F             7      LD  A,'?'
       E286                     CHKWIL1:
00158D E286 BE               7      CP  (HL)
00158E E287 23               6      INC HL
00158F E288 37               4      SCF
001590 E289 C8              11      RET Z
001591 E28A 10FA            13      DJNZ    CHKWIL1
001593 E28C AF               4      XOR A
001594 E28D C9              10      RET
                                
       E28E                     SDIRENT:        ;IY=FCB HL=DIR
001595 E28E D5              11      PUSH    DE
001596 E28F E5              11      PUSH    HL
001597 E290 FDE5            15      PUSH    IY
001599 E292 D1              10      POP DE
00159A E293 EB               4      EX  DE,HL
00159B E294 CD35E2          17      CALL    SETNAME
                                ;               Attribute
00159E E297 FD7E0D          19      LD  A,(IY+13)   ;(FCB)属性(アトリビュート)
0015A1 E29A 12               7      LD  (DE),A
0015A2 E29B 13               6      INC DE
                                ;               Reserved
0015A3 E29C AF               4      XOR A
0015A4 E29D 060A             7      LD  B,10
       E29F                     SDE1:
0015A6 E29F 12               7      LD  (DE),A
0015A7 E2A0 13               6      INC DE
0015A8 E2A1 10FC            13      DJNZ    SDE1
                                                    ;(FCB)更新時刻
0015AA E2A3 21EAF0          10      LD  HL,SDDATA       ;(FCB)更新年月日
0015AD E2A6 060A             7      LD  B,SDDATAE-SDDATA    ;(FCB)ファイルの先頭クラスタ
       E2A8                     SDLOOP:                 ;(FCB)ファイルのサイズ(バイト単位)
0015AF E2A8 7E               7      LD  A,(HL)
0015B0 E2A9 23               6      INC HL
0015B1 E2AA 32AFE2          13      LD  (SDPAT+2),A
0015B4 E2AD FD7E00          19  SDPAT:  LD  A,(IY+0)    ;LD A,(IY+A)
0015B7 E2B0 12               7      LD  (DE),A
0015B8 E2B1 13               6      INC DE
0015B9 E2B2 10F4            13      DJNZ    SDLOOP
                                
0015BB E2B4 AF               4      XOR A
0015BC E2B5 E1              10      POP HL
0015BD E2B6 D1              10      POP DE
0015BE E2B7 C9              10      RET
                                
       E2B8                     WOPEN:
0015BF E2B8 FD7E0D          19      LD  A,(IY+13)   ;(FCB)属性(アトリビュート)
0015C2 E2BB E61F             7      AND 01FH
0015C4 E2BD 37               4      SCF
0015C5 E2BE C0              11      RET NZ
0015C6 E2BF FD361CFE        19      LD  (IY+28),0FEH    ;(FCB)オープンモード
       E2C3                     TOPEN2:
0015CA E2C3 AF               4      XOR A
       E2C4                     TOPEN:              ;Initializes the time stamp
0015CB E2C4 FD3617FF        19      LD  (IY+23),0FFH    ;(FCB)更新時刻
0015CF E2C8 C9              10      RET
                                
       E2C9                     WRDFX:
0015D0 E2C9 3A32E1          13      LD  A,(SPCPAT+1)    ;1クラスタの論理セクタ
       E2CC                     L_WRFX:
0015D3 E2CC 1F               4      RRA         ;->CF
0015D4 E2CD 3806            12      JR  C,E_WRFX
0015D6 E2CF CB39             8      SRL C
0015D8 E2D1 CB1C             8      RR  H       ;CH=CH/2
0015DA E2D3 18F7            12      JR  L_WRFX
       E2D5                     E_WRFX:
0015DC E2D5 44               4      LD  B,H
0015DD E2D6 04               4      INC B
0015DE E2D7 3E37             7      LD  A,037H      ;SCF
0015E0 E2D9 3225E7          13      LD  (DRDN1),A
                                
       E2DC                     WRDF:               ;Bクラスタ分FATを確保する
0015E3 E2DC 110200          10      LD  DE,2
0015E6 E2DF AF               4      XOR A
0015E7 E2E0 3295E8          13      LD  (_SECPS+1),A
       E2E3                     WRDF1:
0015EA E2E3 C5              11      PUSH    BC
0015EB E2E4 D5              11      PUSH    DE
0015EC E2E5 CDF7EF          17      CALL    _GNCL
0015EF E2E8 381C            12      JR  C,WRDF3
0015F1 E2EA 7A               4      LD  A,D     ;空いているかチェック
0015F2 E2EB B3               4      OR  E
0015F3 E2EC 2027            12      JR  NZ,WRDF4
0015F5 E2EE E1              10      POP HL      ;HL=空いているクラスタ
0015F6 E2EF E5              11      PUSH    HL
0015F7 E2F0 ED5BFEF0        20      LD  DE,(_CLPS)  ;DE=元の(_CLPS)
0015FB E2F4 22FEF0          16      LD  (_CLPS),HL
0015FE E2F7 7A               4      LD  A,D     ;元の(_CLPS)が 0 か?
0015FF E2F8 B3               4      OR  E
001600 E2F9 2008            12      JR  NZ,WRDF2
001602 E2FB FD751A          19      LD  (IY+26),L   ;(FCB)ファイルの先頭クラスタ
001605 E2FE FD741B          19      LD  (IY+27),H   ;元が空の場合はFCBにクラスタをセットする
001608 E301 1803            12      JR  WRDF3
       E303                     WRDF2:
00160A E303 CDFAEF          17      CALL    _SNCL
       E306                     WRDF3:
00160D E306 D1              10      POP DE
00160E E307 C1              10      POP BC
00160F E308 D8              11      RET C
001610 E309 100C            13      DJNZ    WRDF5       ;ここでループカウンタチェック
001612 E30B ED5BFEF0        20      LD  DE,(_CLPS)
001616 E30F 21FFFF          10      LD  HL,0FFFFH   ;FATエントリ終了(EOCマーク)
001619 E312 C3FAEF          10      JP  _SNCL
                                
       E315                     WRDF4:              ;DEクラスタが空じゃないので次に移動する
00161C E315 D1              10      POP DE
00161D E316 C1              10      POP BC
       E317                     WRDF5:
00161E E317 13               6      INC DE
00161F E318 CD4BE1          17      CALL    ENDCL
001622 E31B 38C6            12      JR  C,WRDF1
001624 E31D 37               4      SCF
001625 E31E C9              10      RET
                                
       E31F                     RWXR:
001626 E31F 3A1CE6          13      LD  A,(SECSZ+2) ;1024=4 / 512=2 / 256=1
       E322                     L_RWX:
001629 E322 1F               4      RRA     ;->CF
00162A E323 3808            12      JR  C,E_RWX
00162C E325 CB38             8      SRL B   ;BCH=BCH/2
00162E E327 CB19             8      RR  C   ;
001630 E329 CB1C             8      RR  H   ;
001632 E32B 18F5            12      JR  L_RWX
       E32D                     E_RWX:
001634 E32D FD5E1A          19      LD  E,(IY+26)   ;(FCB)ファイルの先頭クラスタ
001637 E330 FD561B          19      LD  D,(IY+27)
00163A E333 AF               4      XOR A
00163B E334 3295E8          13      LD  (_SECPS+1),A
       E337                     RWX1:
00163E E337 ED53FEF0        20      LD  (_CLPS),DE
001642 E33B 7A               4      LD  A,D
001643 E33C B3               4      OR  E
001644 E33D 2813            12      JR  Z,SCF_RET   ;RET DE==0 => CF=1
                                
001646 E33F 78               4      LD  A,B
001647 E340 B1               4      OR  C
001648 E341 B4               4      OR  H
001649 E342 C8              11      RET Z       ;RET BCH==0 => CF=0
                                
00164A E343 CD9DE8          17      CALL    GNCLX
00164D E346 D8              11      RET C
00164E E347 7C               4      LD  A,H     ;
00164F E348 25               4      DEC H       ;
001650 E349 B7               4      OR  A       ;DEC BCH
001651 E34A 2001            12      JR  NZ,RWX2     ;
001653 E34C 0B               6      DEC BC      ;
       E34D                     RWX2:
001654 E34D CD4BE1          17      CALL    ENDCL
001657 E350 38E5            12      JR  C,RWX1
       E352                     SCF_RET:
001659 E352 37               4      SCF
00165A E353 C9              10      RET
                                
       E354                     DSKF:
00165B E354 110000          10  MAXCLP: LD  DE,0
00165E E357 2AACEF          16      LD  HL,(_FAKEFREE)
001661 E35A 7C               4      LD  A,H
001662 E35B B5               4      OR  L
001663 E35C 2803            12      JR  Z,DSKF1
001665 E35E 110100          10      LD  DE,1
       E361                     DSKF1:
001668 E361 D5              11      PUSH    DE
001669 E362 CDF7EF          17      CALL    _GNCL
00166C E365 380C            12      JR  C,POPSCF
00166E E367 7A               4      LD  A,D
00166F E368 B3               4      OR  E
001670 E369 2001            12      JR  NZ,DSKF2
001672 E36B 23               6      INC HL
       E36C                     DSKF2:
001673 E36C D1              10      POP DE
001674 E36D 1B               6      DEC DE
001675 E36E 7A               4      LD  A,D
001676 E36F B3               4      OR  E
001677 E370 20EF            12      JR  NZ,DSKF1
001679 E372 C9              10      RET
                                
       E373                     POPSCF:
00167A E373 F1              10      POP AF
00167B E374 37               4      SCF
00167C E375 C9              10      RET
                                
       E376                     SETTMS:
00167D E376 FD7E17          19      LD  A,(IY+23)   ;(FCB)ファイルを最後に変更した時刻
001680 E379 3C               4      INC A
001681 E37A C0              11      RET NZ      ;ファイルが更新されていない
       E37B                     SETTMSX:            ;FCBに日付時刻をセットする
001682 E37B CDC4D9          17      CALL    _SYS2C      ;(BDOS)時刻の獲得
                                                ;H←時  L←分  D←秒
001685 E37E CB25             8      SLA L       ;   *2
001687 E380 CB25             8      SLA L       ;   *4
001689 E382 29              11      ADD HL,HL       ;*2 *8
00168A E383 29              11      ADD HL,HL       ;*4 *16
00168B E384 29              11      ADD HL,HL       ;*8 *32
00168C E385 7A               4      LD  A,D
00168D E386 0F               4      RRCA            ;bit.0->7->->->0->C
00168E E387 E61F             7      AND 01FH
001690 E389 B5               4      OR  L
001691 E38A FD7716          19      LD  (IY+22),A   ;(FCB)ファイルを最後に変更した時刻
001694 E38D FD7417          19      LD  (IY+23),H
                                
001697 E390 CD9DD9          17      CALL    _SYS2A      ;(BDOS)日付の獲得
                                                ;HL←年  D←月  E←日
00169A E393 0144F8          10      LD  BC,0-1980
00169D E396 09              11      ADD HL,BC
00169E E397 65               4      LD  H,L
                                
00169F E398 7A               4      LD  A,D
0016A0 E399 87               4      ADD A,A     ;*2
0016A1 E39A 87               4      ADD A,A     ;*4
0016A2 E39B 87               4      ADD A,A     ;*8
0016A3 E39C 87               4      ADD A,A     ;*16
0016A4 E39D 6F               4      LD  L,A
0016A5 E39E 29              11      ADD HL,HL       ;*32
0016A6 E39F 7D               4      LD  A,L
0016A7 E3A0 B3               4      OR  E
0016A8 E3A1 FD7714          19      LD  (IY+20),A   ;(FCB)ファイルを最後に変更した日付
0016AB E3A4 FD7415          19      LD  (IY+21),H
0016AE E3A7 C9              10      RET
                                
       E3A8                     PUSHRR:
0016AF E3A8 CDAEE3          17      CALL    SUBRR
       E3AB                     POPRR1:
0016B2 E3AB EDB0                    LDIR
0016B4 E3AD C9              10      RET
                                
       E3AE                     SUBRR:
0016B5 E3AE FDE5            15      PUSH    IY
0016B7 E3B0 E1              10      POP HL
0016B8 E3B1 112100          10      LD  DE,33
0016BB E3B4 19              11      ADD HL,DE
0016BC E3B5 115AEF          10      LD  DE,HLBUF
0016BF E3B8 010300          10      LD  BC,3
0016C2 E3BB C9              10      RET
                                
       E3BC                     SETSEQ:
0016C3 E3BC F5              11      PUSH    AF      ;AHL=Random record
0016C4 E3BD C5              11      PUSH    BC
0016C5 E3BE FD7E21          19      LD  A,(IY+33)   ;(FCB)ランダムレコード
0016C8 E3C1 FD6E22          19      LD  L,(IY+34)
0016CB E3C4 FD6623          19      LD  H,(IY+35)
0016CE E3C7 0600             7      LD  B,0
                                
0016D0 E3C9 CDDDE3          17      CALL    GET_CPM_R_SIZE
                                
0016D3 E3CC 29              11      ADD HL,HL
0016D4 E3CD CB3D             8      SRL L       ;L=L/2
0016D6 E3CF FD7520          19      LD  (IY+32),L   ;(FCB)カレントレコード
0016D9 E3D2 FD740C          19      LD  (IY+12),H   ;(FCB)カレントブロック
0016DC E3D5 C1              10      POP BC
0016DD E3D6 F1              10      POP AF
                                
       E3D7                     POPRR:
0016DE E3D7 CDAEE3          17      CALL    SUBRR
0016E1 E3DA EB               4      EX  DE,HL
0016E2 E3DB 18CE            12      JR  POPRR1
                                
       E3DD                     GET_CPM_R_SIZE:     ;バイト単位からCP/Mのレコード単位を求める（1レコード=128バイト）
0016E4 E3DD 87               4      ADD A,A     ;in BHLA => out AHL
0016E5 E3DE ED6A            15      ADC HL,HL
0016E7 E3E0 CB18             8      RR  B
0016E9 E3E2 B7               4      OR  A
0016EA E3E3 78               4      LD  A,B     ;ここでフラグは変化しない
0016EB E3E4 C8              11      RET Z
0016EC E3E5 2C               4      INC L       ;INC AHL
0016ED E3E6 C0              11      RET NZ      ;
0016EE E3E7 24               4      INC H       ;
0016EF E3E8 C0              11      RET NZ      ;
0016F0 E3E9 3C               4      INC A       ;
0016F1 E3EA C9              10      RET
                                
       E3EB                     GETSEQ:
0016F2 E3EB FD6E20          19      LD  L,(IY+32)   ;(FCB)カレントレコード
0016F5 E3EE FD660C          19      LD  H,(IY+12)   ;(FCB)カレントブロック
0016F8 E3F1 AF               4      XOR A
                                
0016F9 E3F2 CB25             8      SLA L   ;L=L*2
                                
0016FB E3F4 CB3C             8      SRL H   ;HL=HL/2
0016FD E3F6 CB1D             8      RR  L   ;
0016FF E3F8 C9              10      RET
                                
       E3F9                     RB_WRITE:
001700 E3F9 C5              11      PUSH    BC
001701 E3FA ED4B4CF0        20      LD  BC,(STABLE+2*026H)  ;(BDOS)ランダムブロック書き込み
001705 E3FE 1805            12      JR  RBRW
       E400                     RB_READ:
001707 E400 C5              11      PUSH    BC
001708 E401 ED4B4EF0        20      LD  BC,(STABLE+2*027H)  ;(BDOS)ランダムブロック読み込み
       E405                     RBRW:
00170C E405 CB3F             8      SRL A   ;AHLA' = HL*128
00170E E407 CB1C             8      RR  H   ;AHL=AHL/2
001710 E409 CB1D             8      RR  L   ;
001712 E40B 3E00             7      LD  A,0
001714 E40D 1F               4      RRA     ;A'HLA
001715 E40E FD7721          19      LD  (IY+33),A   ;(FCB)ランダムレコード
001718 E411 FD7522          19      LD  (IY+34),L
00171B E414 FD7423          19      LD  (IY+35),H
00171E E417 FDCB20FE        23      SET 7,(IY+32)   ;(FCB)カレントレコード
001722 E41B 218000          10      LD  HL,128
                                
001725 E41E FDE5            15      PUSH    IY
001727 E420 D1              10      POP DE
001728 E421 D5              11      PUSH    DE
001729 E422 CD2DE4          17      CALL    JP_BC
00172C E425 FDE1            14      POP IY
00172E E427 C1              10      POP BC
00172F E428 FDCB20BE        23      RES 7,(IY+32)   ;(FCB)カレントレコード
001733 E42C C9              10      RET
       E42D                     JP_BC:
001734 E42D C5              11      PUSH    BC
001735 E42E C9              10      RET
                                
       DFDB                     _SYS03  EQU SCF_FF_RET  ;(BDOS)外部入力
       DFDB                     _SYS2B  EQU SCF_FF_RET  ;(BDOS)日付の設定
       DFDB                     _SYS2D  EQU SCF_FF_RET  ;(BDOS)時刻の設定
       DFDB                     _SYS39  EQU SCF_FF_RET  ;(BDOS)サブディレクトリの作成
       DFDB                     _SYS3A  EQU SCF_FF_RET  ;(BDOS)サブディレクトリの削除
                                
[EOF:LDFILE.ASM:SHIFT_JIS]
                                    INCLUDE "LDFILE2.ASM"
                                
                                ;   LSX-Dodgers FILE2
                                
                                                ;Write random block
       E42F                     _SYS26:     ;(BDOS)ランダムブロック書き込み
001736 E42F AF               4      XOR A
001737 E430 3225E7          13      LD  (DRDN1),A   ;NOP
00173A E433 225FE6          16      LD  (LEFT+1),HL ;HL←書き込むレコード数
00173D E436 225DEF          16      LD  (LEFTX),HL
001740 E439 CD30DF          17      CALL    SETDRV
                                
001743 E43C CDB6E5          17      CALL    RBX0
001746 E43F DAD9E4          10      JP  C,RBWERR
001749 E442 CDB8E2          17      CALL    WOPEN
00174C E445 DAD9E4          10      JP  C,RBWERR
00174F E448 7C               4      LD  A,H
001750 E449 B5               4      OR  L
001751 E44A CAD2E4          10      JP  Z,RBW1
                                
001754 E44D 2B               6      DEC HL
                                
001755 E44E CD8BE6          17      CALL    GET_RR_BCDE ;BCDE=Random record
                                
001758 E451 19              11      ADD HL,DE       ;BCHL=HL+BCDE
001759 E452 3001            12      JR  NC,S26X1    ;
00175B E454 03               6      INC BC      ;
       E455                     S26X1:
00175C E455 CD1FE3          17      CALL    RWXR
00175F E458 DCC9E2          17      CALL    C,WRDFX
001762 E45B DAD9E4          10      JP  C,RBWERR
                                
001765 E45E CDE5E5          17      CALL    RBX2
001768 E461 281A            12      JR  Z,RBWB      ;NZ=セクタ以下の端数がある
00176A E463 CD04E6          17      CALL    RBXA
00176D E466 3871            12      JR  C,RBWERR
00176F E468 EB               4      EX  DE,HL
001770 E469 C5              11      PUSH    BC
001771 E46A EDB0                    LDIR
001773 E46C 225FEF          16      LD  (DTAX),HL
                                
001776 E46F CD5DE2          17      CALL    SWTDBF      ;バッファデータは更新された
                                
001779 E472 2A5DEF          16      LD  HL,(LEFTX)
00177C E475 D1              10      POP DE
00177D E476 ED52            15      SBC HL,DE
00177F E478 225DEF          16      LD  (LEFTX),HL
001782 E47B 2833            12      JR  Z,RBWEND
                                
       E47D                     RBWB:
001784 E47D CD3AE6          17      CALL    RBXB
001787 E480 2816            12      JR  Z,RBWC
       E482                     RBWB1:
001789 E482 C5              11      PUSH    BC
00178A E483 D5              11      PUSH    DE
00178B E484 CD2EE1          17      CALL    CLUSTX
00178E E487 CD9FE6          17      CALL    DWTC
001791 E48A D1              10      POP DE
001792 E48B C1              10      POP BC
001793 E48C 384B            12      JR  C,RBWERR
001795 E48E CD9DE8          17      CALL    GNCLX
001798 E491 3846            12      JR  C,RBWERR
00179A E493 10ED            13      DJNZ    RBWB1
00179C E495 CDEFE6          17      CALL    DRW_FLUSH
       E498                     RBWC:
00179F E498 CD52E6          17      CALL    RBXC
0017A2 E49B 2813            12      JR  Z,RBWEND
0017A4 E49D C5              11      PUSH    BC
0017A5 E49E CD2EE1          17      CALL    CLUSTX
0017A8 E4A1 CD24E7          17      CALL    DRDN
0017AB E4A4 C1              10      POP BC
0017AC E4A5 3832            12      JR  C,RBWERR
0017AE E4A7 ED5B7EF0        20      LD  DE,(_DTBUF)
0017B2 E4AB EDB0                    LDIR
0017B4 E4AD CD5DE2          17      CALL    SWTDBF      ;バッファデータは更新された
       E4B0                     RBWEND:
0017B7 E4B0 CD5EE6          17      CALL    RBXEND
                                
0017BA E4B3 CDC5E5          17      CALL    RBX1
0017BD E4B6 301A            12      JR  NC,RBW1
0017BF E4B8 2A5FE6          16      LD  HL,(LEFT+1)
0017C2 E4BB FD5E10          19      LD  E,(IY+16)   ;(FCB)ファイルのサイズ(バイト単位)
0017C5 E4BE FD5611          19      LD  D,(IY+17)   ;DE=File size
0017C8 E4C1 19              11      ADD HL,DE
0017C9 E4C2 FD7510          19      LD  (IY+16),L   ;(FCB)ファイルのサイズ(バイト単位)
0017CC E4C5 FD7411          19      LD  (IY+17),H
0017CF E4C8 3008            12      JR  NC,RBW1
0017D1 E4CA FD3412          23      INC (IY+18)
0017D4 E4CD 2003            12      JR  NZ,RBW1
0017D6 E4CF FD3413          23      INC (IY+19)
       E4D2                     RBW1:
0017D9 E4D2 FDE1            14      POP IY
0017DB E4D4 C1              10      POP BC
0017DC E4D5 D1              10      POP DE
0017DD E4D6 E1              10      POP HL
       E4D7                     DD_NUL:
0017DE E4D7 AF               4      XOR A
       E4D8                     DRDF0:
       E4D8                     DWTF0:
0017DF E4D8 C9              10      RET
                                
       E4D9                     RBWERR:
0017E0 E4D9 FDE5            15      PUSH    IY
0017E2 E4DB D1              10      POP DE
0017E3 E4DC 2A20F0          16      LD  HL,(STABLE+2*010H)
0017E6 E4DF CD0F00          17      CALL    JP_HL
       E4E2                     RBRERR1:
0017E9 E4E2 3E01             7      LD  A,001H
       E4E4                     RBRERR2:
0017EB E4E4 FDE1            14      POP IY
0017ED E4E6 C1              10      POP BC
0017EE E4E7 D1              10      POP DE
0017EF E4E8 E1              10      POP HL
0017F0 E4E9 37               4      SCF
0017F1 E4EA 210000          10      LD  HL,0
0017F4 E4ED C9              10      RET
                                
       E4EE                     RBRERR:
0017F5 E4EE 3EFF             7      LD  A,0FFH
0017F7 E4F0 18F2            12      JR  RBRERR2
                                
       E4F2                     RBRFL:
0017F9 E4F2 3E00             7  RBRFLP: LD  A,000H
0017FB E4F4 FE0D             7      CP  00DH
0017FD E4F6 2005            12      JR  NZ,RBRFL1
0017FF E4F8 D5              11      PUSH    DE
001800 E4F9 1E0A             7      LD  E,00AH
001802 E4FB 1805            12      JR  RBRFL2
       E4FD                     RBRFL1:
001804 E4FD D5              11      PUSH    DE
001805 E4FE CD09EF          17      CALL    _SYS07
001808 E501 5F               4      LD  E,A
       E502                     RBRFL2:
001809 E502 CDCDEF          17      CALL    _PRINT
00180C E505 7B               4      LD  A,E
00180D E506 D1              10      POP DE
00180E E507 32F3E4          13      LD  (RBRFLP+1),A
001811 E50A C9              10      RET
       E50B                     DDX:
001812 E50B FD7E01          19      LD  A,(IY+1)    ;(FCB)主ファイル名
001815 E50E CD53E1          17      CALL    CAP
001818 E511 FE41             7      CP  'A'
00181A E513 C9              10      RET
                                
                                                ;Read random block
       E514                     _SYS27:     ;(BDOS)ランダムブロック読み込み
00181B E514 225DEF          16      LD  (LEFTX),HL
00181E E517 CD30DF          17      CALL    SETDRV
                                
001821 E51A FDCB0D66        20      BIT 4,(IY+13)   ;(FCB)属性(アトリビュート)
001825 E51E C2A4E5          10      JP  NZ,RBRDIR   ;ディレクトリ
001828 E521 CDB6E5          17      CALL    RBX0
00182B E524 DAEEE4          10      JP  C,RBRERR
00182E E527 CDC5E5          17      CALL    RBX1
001831 E52A DAE2E4          10      JP  C,RBRERR1
001834 E52D EB               4      EX  DE,HL
001835 E52E ED52            15      SBC HL,DE       ;CP 00HL,BCDE
001837 E530 19              11      ADD HL,DE
001838 E531 79               4      LD  A,C
001839 E532 DE00             7      SBC A,0
00183B E534 78               4      LD  A,B
00183C E535 DE00             7      SBC A,0
00183E E537 3801            12      JR  C,RBR1
001840 E539 EB               4      EX  DE,HL
       E53A                     RBR1:
001841 E53A 9F               4      SBC A,A
001842 E53B E601             7      AND 1
001844 E53D 32A2E5          13      LD  (RBRAP+1),A
                                
001847 E540 7C               4      LD  A,H
001848 E541 B5               4      OR  L
001849 E542 2857            12      JR  Z,RBREND0
                                
00184B E544 225FE6          16      LD  (LEFT+1),HL ;Read record byte
00184E E547 225DEF          16      LD  (LEFTX),HL
                                
001851 E54A CDE5E5          17      CALL    RBX2
001854 E54D 2819            12      JR  Z,RBRB
001856 E54F CD04E6          17      CALL    RBXA
001859 E552 DAEEE4          10      JP  C,RBRERR
00185C E555 C5              11      PUSH    BC
00185D E556 EDB0                    LDIR
00185F E558 ED535FEF        20      LD  (DTAX),DE
001863 E55C 2A5DEF          16      LD  HL,(LEFTX)
001866 E55F D1              10      POP DE
001867 E560 A7               4      AND A
001868 E561 ED52            15      SBC HL,DE
00186A E563 225DEF          16      LD  (LEFTX),HL
00186D E566 2830            12      JR  Z,RBREND
                                
       E568                     RBRB:
00186F E568 CD3AE6          17      CALL    RBXB
001872 E56B 2815            12      JR  Z,RBRC
       E56D                     RBRB1:
001874 E56D C5              11      PUSH    BC
001875 E56E D5              11      PUSH    DE
001876 E56F CD2EE1          17      CALL    CLUSTX
001879 E572 CDA5E6          17      CALL    DRDC
00187C E575 D1              10      POP DE
00187D E576 C1              10      POP BC
00187E E577 D49DE8          17      CALL    NC,GNCLX
001881 E57A DAEEE4          10      JP  C,RBRERR
001884 E57D 10EE            13      DJNZ    RBRB1
001886 E57F CDEFE6          17      CALL    DRW_FLUSH
       E582                     RBRC:
001889 E582 CD52E6          17      CALL    RBXC
00188C E585 2811            12      JR  Z,RBREND
00188E E587 C5              11      PUSH    BC
00188F E588 CD2EE1          17      CALL    CLUSTX
001892 E58B CD08E7          17      CALL    DRDX
001895 E58E C1              10      POP BC
001896 E58F DAEEE4          10      JP  C,RBRERR
001899 E592 EB               4      EX  DE,HL
00189A E593 2A7EF0          16      LD  HL,(_DTBUF)
00189D E596 EDB0                    LDIR
       E598                     RBREND:
00189F E598 CD5EE6          17      CALL    RBXEND
       E59B                     RBREND0:
0018A2 E59B FDE1            14      POP IY
0018A4 E59D C1              10      POP BC
0018A5 E59E D1              10      POP DE
0018A6 E59F F1              10      POP AF  ;(HL)
0018A7 E5A0 AF               4      XOR A
0018A8 E5A1 3E00             7  RBRAP:  LD  A,000H
0018AA E5A3 C9              10      RET
                                
       E5A4                     RBRDIR:
0018AB E5A4 FD6E1A          19      LD  L,(IY+26)   ;(FCB)ファイルの先頭クラスタ
0018AE E5A7 FD661B          19      LD  H,(IY+27)
0018B1 E5AA CD6EE1          17      CALL    CHDIR
0018B4 E5AD AF               4      XOR A
0018B5 E5AE 67               4      LD  H,A
0018B6 E5AF 6F               4      LD  L,A
0018B7 E5B0 3C               4      INC A
0018B8 E5B1 32A2E5          13      LD  (RBRAP+1),A
0018BB E5B4 18E5            12      JR  RBREND0
                                
       E5B6                     RBX0:
0018BD E5B6 2A8AEF          16      LD  HL,(_DTA)
0018C0 E5B9 225FEF          16      LD  (DTAX),HL
0018C3 E5BC 2A5DEF          16      LD  HL,(LEFTX)
0018C6 E5BF FD7E1C          19      LD  A,(IY+28)   ;(FCB)オープンモード
0018C9 E5C2 D6FD             7      SUB 0FDH
0018CB E5C4 C9              10      RET
                                
       E5C5                     RBX1:
0018CC E5C5 E5              11      PUSH    HL      ;Record byte
                                                ;AHL=File size
0018CD E5C6 FD6E10          19      LD  L,(IY+16)   ;ファイルのサイズ(バイト単位)
0018D0 E5C9 FD6611          19      LD  H,(IY+17)   ;
0018D3 E5CC FD7E12          19      LD  A,(IY+18)   ;
                                
0018D6 E5CF CD8BE6          17      CALL    GET_RR_BCDE ;BCDE=Random record
                                
0018D9 E5D2 A7               4      AND A
0018DA E5D3 ED52            15      SBC HL,DE
0018DC E5D5 99               4      SBC A,C
0018DD E5D6 4F               4      LD  C,A
0018DE E5D7 FD7E13          19      LD  A,(IY+19)   ;ファイルのサイズ
0018E1 E5DA 98               4      SBC A,B
0018E2 E5DB D1              10      POP DE
                                
0018E3 E5DC D8              11      RET C
0018E4 E5DD 47               4      LD  B,A
0018E5 E5DE B1               4      OR  C
0018E6 E5DF EB               4      EX  DE,HL   ;BCDE=File byte HL=Record byte
0018E7 E5E0 B2               4      OR  D
0018E8 E5E1 B3               4      OR  E
0018E9 E5E2 C0              11      RET NZ
0018EA E5E3 37               4      SCF
0018EB E5E4 C9              10      RET
                                
       E5E5                     RBX2:               ;Cluster settings
0018EC E5E5 FD6622          19      LD  H,(IY+34)   ;(+33)(FCB)ランダムレコード
0018EF E5E8 FD4E23          19      LD  C,(IY+35)
0018F2 E5EB 0600             7      LD  B,0
0018F4 E5ED FDCB207E        20      BIT 7,(IY+32)   ;(FCB)カレントレコード
0018F8 E5F1 2003            12      JR  NZ,RBX3
0018FA E5F3 FD4624          19      LD  B,(IY+36)
       E5F6                     RBX3:
0018FD E5F6 CD1FE3          17      CALL    RWXR
001900 E5F9 3A1CE6          13      LD  A,(SECSZ+2) ;1024=4 / 512=2 / 256=1
001903 E5FC 3D               4      DEC A
001904 E5FD FDA622          19      AND (IY+34)
001907 E600 FDB621          19      OR  (IY+33)
00190A E603 C9              10      RET
                                
       E604                     RBXA:
00190B E604 C5              11      PUSH    BC
00190C E605 D5              11      PUSH    DE
00190D E606 CD2EE1          17      CALL    CLUSTX
001910 E609 CD08E7          17      CALL    DRDX
001913 E60C D1              10      POP DE
001914 E60D C1              10      POP BC
001915 E60E D8              11      RET C
001916 E60F CD9DE8          17      CALL    GNCLX
001919 E612 D8              11      RET C
00191A E613 ED53FEF0        20      LD  (_CLPS),DE
                                
00191E E617 FD4E21          19      LD  C,(IY+33)   ;(FCB)ランダムレコード
001921 E61A 210004          10  SECSZ:  LD  HL,0400H    ;自己書き換え 1024=0400H / 512=0200H ここに1セクタのサイズが格納される
001924 E61D 7C               4      LD  A,H
001925 E61E 3D               4      DEC A       ;1024=3 / 512=1
001926 E61F FDA622          19      AND (IY+34)     ;(FCB)ランダムレコード
001929 E622 47               4      LD  B,A     ;BCに1セクタ以下の端数が入る
00192A E623 ED42            15      SBC HL,BC       ;残りを計算
                                
00192C E625 ED5B5DEF        20      LD  DE,(LEFTX)
001930 E629 ED52            15      SBC HL,DE       ;CP HL,DE
001932 E62B 19              11      ADD HL,DE       ;
001933 E62C 3801            12      JR  C,RBXA1     ;DEとHLを比較して大きい方をHLに
001935 E62E EB               4      EX  DE,HL
       E62F                     RBXA1:
001936 E62F E5              11      PUSH    HL
001937 E630 2A7EF0          16      LD  HL,(_DTBUF)
00193A E633 09              11      ADD HL,BC
00193B E634 ED5B5FEF        20      LD  DE,(DTAX)
00193F E638 C1              10      POP BC
001940 E639 C9              10      RET
                                
       E63A                     RBXB:
001941 E63A 2A5FEF          16      LD  HL,(DTAX)
001944 E63D ED5BFEF0        20      LD  DE,(_CLPS)
001948 E641 3A5EEF          13      LD  A,(LEFTX+1)
00194B E644 47               4      LD  B,A
00194C E645 3A1CE6          13      LD  A,(SECSZ+2) ;1024=4 / 512=2 / 256=1
       E648                     RBXB1:
00194F E648 1F               4      RRA     ;->CF
001950 E649 3804            12      JR  C,RBXB2
001952 E64B CB38             8      SRL B   ;B=B/2
001954 E64D 18F9            12      JR  RBXB1
       E64F                     RBXB2:
001956 E64F 78               4      LD  A,B
001957 E650 B7               4      OR  A
001958 E651 C9              10      RET
                                
       E652                     RBXC:
001959 E652 ED4B5DEF        20      LD  BC,(LEFTX)
00195D E656 3A1CE6          13      LD  A,(SECSZ+2) ;1024=4 / 512=2 / 256=1
001960 E659 3D               4      DEC A
001961 E65A A0               4      AND B
001962 E65B 47               4      LD  B,A     ;1セクタ以下の端数がない場合はZ
001963 E65C B1               4      OR  C
001964 E65D C9              10      RET
                                
       E65E                     RBXEND:
001965 E65E 110000          10  LEFT:   LD  DE,0
001968 E661 AF               4      XOR A
001969 E662 FD6E21          19      LD  L,(IY+33)   ;(FCB)ランダムレコード
00196C E665 FD6622          19      LD  H,(IY+34)
00196F E668 19              11      ADD HL,DE
001970 E669 FD7521          19      LD  (IY+33),L   ;(FCB)ランダムレコード
001973 E66C FD7422          19      LD  (IY+34),H
001976 E66F 300E            12      JR  NC,RBXEND1
001978 E671 FD3423          23      INC (IY+35)
00197B E674 2009            12      JR  NZ,RBXEND1
00197D E676 FDCB207E        20      BIT 7,(IY+32)   ;(FCB)カレントレコード
001981 E67A 2003            12      JR  NZ,RBXEND1
001983 E67C FD3424          23      INC (IY+36)
       E67F                     RBXEND1:
001986 E67F EB               4      EX  DE,HL       ;HL=Read byte
001987 E680 C9              10      RET
                                
       E681                     GET_RR_AHL:
001988 E681 FD6E21          19      LD  L,(IY+33)   ;(FCB)Random record
00198B E684 FD6622          19      LD  H,(IY+34)   ;
00198E E687 FD7E23          19      LD  A,(IY+35)   ;
001991 E68A C9              10      RET
                                
       E68B                     GET_RR_BCDE:            ;BCDE=Random record
001992 E68B FD5E21          19      LD  E,(IY+33)   ;(FCB)ランダムレコード
001995 E68E FD5622          19      LD  D,(IY+34)
001998 E691 FD4E23          19      LD  C,(IY+35)
00199B E694 FD4624          19      LD  B,(IY+36)
00199E E697 FDCB207E        20      BIT 7,(IY+32)   ;(FCB)カレントレコード
0019A2 E69B C8              11      RET Z
0019A3 E69C 0600             7      LD  B,0     ;CP/M互換のアクセスの場合はFCBは36バイト
0019A5 E69E C9              10      RET
                                
                                ;   ランダムブロックアクセスの連続したセクタをまとめる
                                
       E69F                     DWTC:
0019A6 E69F E5              11      PUSH    HL
0019A7 E6A0 2105EA          10      LD  HL,DWT24B
0019AA E6A3 1804            12      JR  DWTC1
       E6A5                     DRDC:
0019AC E6A5 E5              11      PUSH    HL
0019AD E6A6 21F5E9          10      LD  HL,DRD24B
       E6A9                     DWTC1:
0019B0 E6A9 2203E7          16      LD  (DRWF_MODE),HL
0019B3 E6AC E1              10      POP HL
0019B4 E6AD 3AF3E6          13      LD  A,(DRWF_B)
0019B7 E6B0 B7               4      OR  A
0019B8 E6B1 200F            12      JR  NZ,DRDC1
       E6B3                     SAVE_DRWC:
0019BA E6B3 0601             7      LD  B,1
0019BC E6B5 ED43F2E6        20      LD  (DRWF_C),BC
0019C0 E6B9 ED53F9E6        20      LD  (DRWF_E),DE
0019C4 E6BD 22FCE6          16      LD  (DRWF_HL),HL
0019C7 E6C0 1820            12      JR  INC_HL_DRWC
       E6C2                     DRDC1:
0019C9 E6C2 E5              11      PUSH    HL
0019CA E6C3 21F9E6          10      LD  HL,DRWF_E
0019CD E6C6 86               7      ADD A,(HL)
0019CE E6C7 F5              11      PUSH    AF
0019CF E6C8 BB               4      CP  E
0019D0 E6C9 201D            12      JR  NZ,DRDC2
0019D2 E6CB F1              10      POP AF
0019D3 E6CC 23               6      INC HL
0019D4 E6CD 7E               7      LD  A,(HL)
0019D5 E6CE CE00             7      ADC A,0
0019D7 E6D0 F5              11      PUSH    AF
0019D8 E6D1 BA               4      CP  D
0019D9 E6D2 2014            12      JR  NZ,DRDC2
0019DB E6D4 F1              10      POP AF
0019DC E6D5 3AF2E6          13      LD  A,(DRWF_C)
0019DF E6D8 CE00             7      ADC A,0
0019E1 E6DA B9               4      CP  C
0019E2 E6DB 200C            12      JR  NZ,DRDC3
0019E4 E6DD 21F3E6          10      LD  HL,DRWF_B
0019E7 E6E0 34              11      INC (HL)
0019E8 E6E1 E1              10      POP HL
       E6E2                     INC_HL_DRWC:
0019E9 E6E2 3A1CE6          13      LD  A,(SECSZ+2)     ;1セクタのサイズの上位1バイト
0019EC E6E5 84               4      ADD A,H
0019ED E6E6 67               4      LD  H,A
0019EE E6E7 C9              10      RET
       E6E8                     DRDC2:
0019EF E6E8 F1              10      POP AF
       E6E9                     DRDC3:
0019F0 E6E9 CDEFE6          17      CALL    DRW_FLUSH
0019F3 E6EC E1              10      POP HL
0019F4 E6ED 18C4            12      JR  SAVE_DRWC
                                
                                ;   ランダムブロックアクセスの連続したセクタをまとめたものをフラッシュする
       E6EF                     DRW_FLUSH:
0019F6 E6EF C5              11      PUSH    BC
0019F7 E6F0 D5              11      PUSH    DE
       E6F2                     DRWF_C  EQU $+1
       E6F3                     DRWF_B  EQU $+2
0019F8 E6F1 010000          10      LD  BC,0
0019FB E6F4 78               4      LD  A,B
0019FC E6F5 B7               4      OR  A
0019FD E6F6 280D            12      JR  Z,DRDF1
       E6F9                     DRWF_E  EQU $+1
       E6FA                     DRWF_D  EQU $+2
0019FF E6F8 110000          10      LD  DE,0
       E6FC                     DRWF_HL EQU $+1
001A02 E6FB 210000          10      LD  HL,0
001A05 E6FE AF               4      XOR A
001A06 E6FF 32F3E6          13      LD  (DRWF_B),A
       E703                     DRWF_MODE   EQU $+1
001A09 E702 CDF5E9          17      CALL    DRD24B
       E705                     DRDF1:
001A0C E705 D1              10      POP DE
001A0D E706 C1              10      POP BC
001A0E E707 C9              10      RET
[EOF:LDFILE2.ASM:SHIFT_JIS]
                                    INCLUDE "LDDIO.ASM"
                                
                                ;   LSX-Dodgers DIO
                                
       E708                     DRDX:
001A0F E708 CD46E7          17      CALL    DRDY
001A12 E70B C8              11      RET Z
001A13 E70C CD2CE7          17      CALL    DRDX1       ;データバッファの情報を保存
001A16 E70F D8              11      RET C
001A17 E710 E5              11      PUSH    HL
001A18 E711 C5              11      PUSH    BC
001A19 E712 D5              11      PUSH    DE
001A1A E713 2A7EF0          16      LD  HL,(_DTBUF)
001A1D E716 3A6FE7          13      LD  A,(_DBS24+1)
001A20 E719 4F               4      LD  C,A
001A21 E71A CDF3E9          17      CALL    DRD24
001A24 E71D DC41E7          17      CALL    C,DRDNE
       E720                     POP_DE_BC_HL_RET:
001A27 E720 D1              10      POP DE
001A28 E721 C1              10      POP BC
001A29 E722 E1              10      POP HL
001A2A E723 C9              10      RET
                                
                                ;   CDE:セクタ番号
       E724                     DRDN:
001A2B E724 AF               4      XOR A
001A2C E725 00               4  DRDN1:  NOP         ;自己書き換え NOP / SCF
001A2D E726 30E0            12      JR  NC,DRDX
       E728                     DRDNX:
001A2F E728 CD46E7          17      CALL    DRDY
001A32 E72B C8              11      RET Z
       E72C                     DRDX1:
001A33 E72C CD5CE7          17      CALL    DWTX
                                                ;データバッファの読み込んだドライブ・セクタ情報を保存
001A36 E72F ED53A6EF        20      LD  (_DBSEC),DE
001A3A E733 79               4      LD  A,C
001A3B E734 326FE7          13      LD  (_DBS24+1),A
                                
001A3E E737 3A88EF          13      LD  A,(_DRV)
001A41 E73A 32A5EF          13      LD  (_DBDRV),A
001A44 E73D CDD9EF          17      CALL    _CHGDRV
001A47 E740 D0              11      RET NC
       E741                     DRDNE:
001A48 E741 9F               4      SBC A,A     ;CF=1ならばA=0FFH
001A49 E742 32A5EF          13      LD  (_DBDRV),A
001A4C E745 C9              10      RET
                                
                                ;   CDE:セクタ番号
       E746                     DRDY:
001A4D E746 3A6FE7          13      LD  A,(_DBS24+1)
001A50 E749 B9               4      CP  C
001A51 E74A C0              11      RET NZ
                                
001A52 E74B E5              11      PUSH    HL
001A53 E74C 3A88EF          13      LD  A,(_DRV)
001A56 E74F 21A5EF          10      LD  HL,_DBDRV
001A59 E752 AE               7      XOR (HL)
001A5A E753 2005            12      JR  NZ,POP_HL_RET
                                
001A5C E755 2AA6EF          16      LD  HL,(_DBSEC)
001A5F E758 ED52            15      SBC HL,DE       ;CF=0
       E75A                     POP_HL_RET:
001A61 E75A E1              10      POP HL
001A62 E75B C9              10      RET
                                
       E75C                     DWTX:
001A63 E75C 3AA4EF          13      LD  A,(_WTDBF)
001A66 E75F B7               4      OR  A
001A67 E760 C8              11      RET Z
001A68 E761 AF               4      XOR A
001A69 E762 32A4EF          13      LD  (_WTDBF),A
                                
001A6C E765 E5              11      PUSH    HL
001A6D E766 C5              11      PUSH    BC
001A6E E767 D5              11      PUSH    DE
001A6F E768 3AA5EF          13      LD  A,(_DBDRV)
001A72 E76B CDD9EF          17      CALL    _CHGDRV
001A75 E76E 0E00             7  _DBS24: LD  C,0
001A77 E770 ED5BA6EF        20      LD  DE,(_DBSEC)
001A7B E774 2A7EF0          16      LD  HL,(_DTBUF)
001A7E E777 D403EA          17      CALL    NC,DWT24
       E77A                     POP_DE_BC_HL_RET2:
001A81 E77A 18A4            12      JR  POP_DE_BC_HL_RET
                                
       E77C                     RDFATX:
001A83 E77C E5              11      PUSH    HL
001A84 E77D 3A88EF          13      LD  A,(_DRV)
001A87 E780 21AAEF          10      LD  HL,_FATDRV
001A8A E783 AE               7      XOR (HL)
001A8B E784 28D4            12      JR  Z,POP_HL_RET
                                
001A8D E786 C5              11      PUSH    BC
001A8E E787 D5              11      PUSH    DE
001A8F E788 DDE5            15      PUSH    IX
001A91 E78A CDA6E7          17      CALL    WTFATX
001A94 E78D 3813            12      JR  C,POP_IX_DE_BC_HL_RET
                                
001A96 E78F AF               4      XOR A
001A97 E790 32ABEF          13      LD  (_FATIX),A
001A9A E793 3A88EF          13      LD  A,(_DRV)
001A9D E796 32AAEF          13      LD  (_FATDRV),A
001AA0 E799 CDE5EF          17      CALL    _RDFAT
       E79C                     RDFATE2:
001AA3 E79C 3004            12      JR  NC,POP_IX_DE_BC_HL_RET
001AA5 E79E 9F               4      SBC A,A     ;A=0xFF
001AA6 E79F 32AAEF          13      LD  (_FATDRV),A
       E7A2                     POP_IX_DE_BC_HL_RET:
001AA9 E7A2 DDE1            14      POP IX
001AAB E7A4 18D4            12      JR  POP_DE_BC_HL_RET2
                                
       E7A6                     WTFATX:
001AAD E7A6 3AA2EF          13      LD  A,(_WTFATF)
001AB0 E7A9 B7               4      OR  A
001AB1 E7AA C8              11      RET Z
001AB2 E7AB E5              11      PUSH    HL
001AB3 E7AC 3AAAEF          13      LD  A,(_FATDRV)
001AB6 E7AF 21A5EF          10      LD  HL,_DBDRV
001AB9 E7B2 AE               7      XOR (HL)
001ABA E7B3 CC5CE7          17      CALL    Z,DWTX
001ABD E7B6 38A2            12      JR  C,POP_HL_RET
001ABF E7B8 C5              11      PUSH    BC
001AC0 E7B9 D5              11      PUSH    DE
001AC1 E7BA DDE5            15      PUSH    IX
001AC3 E7BC CD10EA          17      CALL    WTFAT
001AC6 E7BF AF               4      XOR A
001AC7 E7C0 32A2EF          13      LD  (_WTFATF),A
001ACA E7C3 18DD            12      JR  POP_IX_DE_BC_HL_RET
                                
       E7C5                     NCL1:
001ACC E7C5 7A               4      LD  A,D
001ACD E7C6 B3               4      OR  E
001ACE E7C7 37               4      SCF
001ACF E7C8 C8              11      RET Z
                                
001AD0 E7C9 7A               4      LD  A,D
001AD1 E7CA CB3F             8      SRL A   ;/2
001AD3 E7CC CB3F             8      SRL A   ;/2
                                
001AD5 E7CE E5              11      PUSH    HL
001AD6 E7CF 32EEE7          13      LD  (NCLPAT+2),A    ;_FATIX
001AD9 E7D2 2AAAEF          16      LD  HL,(_FATDRV)    ;L=_FATDRV H=_FATIX
001ADC E7D5 BC               4      CP  H
001ADD E7D6 3A88EF          13      LD  A,(_DRV)    ;この間でフラグは変化しない
001AE0 E7D9 32EDE7          13      LD  (NCLPAT+1),A    ;_FATDRV
001AE3 E7DC 2005            12      JR  NZ,NCL2     ;FATIXが違う
001AE5 E7DE BD               4      CP  L
001AE6 E7DF 2002            12      JR  NZ,NCL2     ;ドライブが違う
001AE8 E7E1 E1              10      POP HL
001AE9 E7E2 C9              10      RET
       E7E3                     NCL2:
001AEA E7E3 C5              11      PUSH    BC
001AEB E7E4 D5              11      PUSH    DE
001AEC E7E5 DDE5            15      PUSH    IX
001AEE E7E7 CDA6E7          17      CALL    WTFATX
001AF1 E7EA 38B6            12      JR  C,POP_IX_DE_BC_HL_RET
001AF3 E7EC 010000          10  NCLPAT: LD  BC,0        ;自己書き換え C=_FATDRV B=_FATIX
001AF6 E7EF ED43AAEF        20      LD  (_FATDRV),BC
001AFA E7F3 CDE5E9          17      CALL    RDFATS
001AFD E7F6 18A4            12      JR  RDFATE2
                                
       E7F8                     NCL3:
001AFF E7F8 CB9A             8      RES 3,D
001B01 E7FA CB92             8      RES 2,D
001B03 E7FC 6B               4      LD  L,E
001B04 E7FD 62               4      LD  H,D
001B05 E7FE CB3C             8      SRL H   ;
001B07 E800 CB1D             8      RR  L   ;HLA=HLA/2
001B09 E802 1F               4      RRA     ;
001B0A E803 F5              11      PUSH    AF
001B0B E804 3AABEF          13      LD  A,(_FATIX)
001B0E E807 0F               4      RRCA
001B0F E808 300B            12      JR  NC,NCL3X1
001B11 E80A 3A1CE6          13      LD  A,(SECSZ+2)
001B14 E80D FE04             7      CP  4       ;1セクタ1024バイトの場合は奇数インデックスの場合に先頭を512バイトずらす
001B16 E80F 2004            12      JR  NZ,NCL3X1
001B18 E811 010002          10      LD  BC,512
001B1B E814 09              11      ADD HL,BC
       E815                     NCL3X1:
001B1C E815 F1              10      POP AF
001B1D E816 ED4B7CF0        20      LD  BC,(_FATBF)
001B21 E81A 19              11      ADD HL,DE
001B22 E81B 09              11      ADD HL,BC
001B23 E81C 17               4      RLA
001B24 E81D C9              10      RET
                                
       E81E                     GNCL:
001B25 E81E CDC5E7          17      CALL    NCL1        ;GET NEXT CLUSTER
001B28 E821 D8              11      RET C
001B29 E822 C5              11      PUSH    BC
001B2A E823 E5              11      PUSH    HL
001B2B E824 CDF8E7          17      CALL    NCL3
001B2E E827 3809            12      JR  C,GNC1
001B30 E829 5E               7      LD  E,(HL)
001B31 E82A 23               6      INC HL
001B32 E82B 7E               7      LD  A,(HL)
001B33 E82C E60F             7      AND 00FH
001B35 E82E 57               4      LD  D,A
001B36 E82F E1              10      POP HL
001B37 E830 C1              10      POP BC
001B38 E831 C9              10      RET
       E832                     GNC1:
001B39 E832 7E               7      LD  A,(HL)
001B3A E833 23               6      INC HL
001B3B E834 56               7      LD  D,(HL)
001B3C E835 0604             7      LD  B,4
       E837                     GNC1L:
001B3E E837 CB3A             8      SRL D   ;DA=DA/2
001B40 E839 1F               4      RRA     ;
001B41 E83A 10FB            13      DJNZ    GNC1L
                                
001B43 E83C 5F               4      LD  E,A
001B44 E83D E1              10      POP HL
001B45 E83E C1              10      POP BC
001B46 E83F A7               4      AND A
001B47 E840 C9              10      RET
                                
       E841                     SNCL:
001B48 E841 CDC5E7          17      CALL    NCL1
001B4B E844 D8              11      RET C
                                ;               SET NEXT CLUSTER
001B4C E845 E5              11      PUSH    HL
001B4D E846 C5              11      PUSH    BC
001B4E E847 D5              11      PUSH    DE
001B4F E848 E5              11      PUSH    HL
001B50 E849 CDF8E7          17      CALL    NCL3
001B53 E84C D1              10      POP DE
                                ;CF=ODD
001B54 E84D 7E               7      LD  A,(HL)
001B55 E84E 73               7      LD  (HL),E
001B56 E84F 3806            12      JR  C,SNC1
                                ;EVEN
                                ;M[0] = E
                                ;M[1] = (M[1] & 0xF0) | (D & 0x0F)
001B58 E851 23               6      INC HL
001B59 E852 ED67            18      RRD     ;M={A[3:0],E[3:0]}
001B5B E854 7A               4      LD  A,D
001B5C E855 1804            12      JR  SNC11
       E857                     SNC1:
                                ;ODD
                                ;HL[0] = (HL[0]&0x0F) | (E<<4)
                                ;HL[1] = DE>>4
001B5E E857 ED6F            18      RLD     ;M={D[3:0],E[7:4]}
001B60 E859 23               6      INC HL
001B61 E85A 72               7      LD  (HL),D  ;M={D[3:0],E[7:4]}
       E85B                     SNC11:
001B62 E85B ED6F            18      RLD     ;M={M[7:4],D[3:0]}
001B64 E85D B7               4      OR  A
001B65 E85E D1              10      POP DE
001B66 E85F C1              10      POP BC
001B67 E860 E1              10      POP HL
       E861                     FAT_CHANGED:
001B68 E861 3E01             7      LD  A,1
001B6A E863 32A2EF          13      LD  (_WTFATF),A
001B6D E866 C9              10      RET
                                
       E867                     N16CL3:
001B6E E867 C5              11      PUSH    BC
001B6F E868 6B               4      LD  L,E
001B70 E869 7A               4      LD  A,D
001B71 E86A E603             7      AND 3
001B73 E86C 67               4      LD  H,A
001B74 E86D 29              11      ADD HL,HL
001B75 E86E ED4B7CF0        20      LD  BC,(_FATBF)
001B79 E872 09              11      ADD HL,BC
001B7A E873 C1              10      POP BC
001B7B E874 C9              10      RET
                                
       E875                     GNCL16:
001B7C E875 CDC5E7          17      CALL    NCL1        ;GET NEXT CLUSTER for FAT16
001B7F E878 D8              11      RET C
001B80 E879 E5              11      PUSH    HL
001B81 E87A CD67E8          17      CALL    N16CL3
001B84 E87D 5E               7      LD  E,(HL)
001B85 E87E 23               6      INC HL
001B86 E87F 56               7      LD  D,(HL)
001B87 E880 E1              10      POP HL
001B88 E881 C9              10      RET
                                
       E882                     SNCL16:
001B89 E882 CDC5E7          17      CALL    NCL1        ;GET NEXT CLUSTER for FAT16
001B8C E885 D8              11      RET C
001B8D E886 D5              11      PUSH    DE
001B8E E887 E5              11      PUSH    HL
001B8F E888 CD67E8          17      CALL    N16CL3
001B92 E88B D1              10      POP DE      ;HL
001B93 E88C 73               7      LD  (HL),E
001B94 E88D 23               6      INC HL
001B95 E88E 72               7      LD  (HL),D
001B96 E88F 6B               4      LD  L,E
001B97 E890 62               4      LD  H,D
001B98 E891 D1              10      POP DE
001B99 E892 18CD            12      JR  FAT_CHANGED
                                
                                ;------------------------
                                ;次のセクタを探す際に_SECPSの値をチェック
                                ;in
                                ;   DE : セクタ番号
                                ;out
                                ;   DE : 次のセクタ番号
                                ;note
                                ;
                                ;------------------------
       E894                     NEXTX:
001B9B E894 3E00             7  _SECPS: LD  A,0 ;自己書き換え
001B9D E896 3C               4      INC A
001B9E E897 E600             7  NCPAT:  AND 0   ;自己書き換え　1クラスタの論理セクタ数-1
001BA0 E899 3295E8          13      LD  (_SECPS+1),A
001BA3 E89C C9              10      RET
                                
       E89D                     GNCLX:
001BA4 E89D CD94E8          17      CALL    NEXTX
001BA7 E8A0 C0              11      RET NZ  ;1クラスタのセクタ未満の場合は戻る
001BA8 E8A1 C3F7EF          10      JP  _GNCL   ;次のクラスタを探す
                                
       E8A4                     RDFAT:
001BAB E8A4 3E80             7      LD  A,080H
001BAD E8A6 3270EF          13      LD  (CHECK),A
       E8A9                     RDFAT1:
001BB0 E8A9 3A88EF          13      LD  A,(_DRV)
001BB3 E8AC CD3BEB          17      CALL    CHGDRVR
001BB6 E8AF D8              11      RET C
001BB7 E8B0 DD7E12          19      LD  A,(IX+012H) ;DPB_12_DEVICE
001BBA E8B3 CB6F             8      BIT 5,A
001BBC E8B5 2843            12      JR  Z,RDFAT0X
001BBE E8B7 2170EF          10      LD  HL,CHECK
001BC1 E8BA A6               7      AND (HL)
001BC2 E8BB 77               7      LD  (HL),A
001BC3 E8BC 110000          10      LD  DE,0        ;BPB
001BC6 E8BF 2A7CF0          16      LD  HL,(_FATBF)
001BC9 E8C2 CDF1E9          17      CALL    DRD16
001BCC E8C5 3024            12      JR  NC,GETBPB
001BCE E8C7 2170EF          10      LD  HL,CHECK
001BD1 E8CA CB06            15      RLC (HL)
001BD3 E8CC 3F               4      CCF
001BD4 E8CD D8              11      RET C
001BD5 E8CE DDCB0A1E        23      RR  (IX+00AH)   ;DPB_0A_FDMODE
001BD9 E8D2 3F               4      CCF         ;フロッピーディスクのMFMモードを切り替える
001BDA E8D3 DDCB0A16        23      RL  (IX+00AH)   ;DPB_0A_FDMODE
001BDE E8D7 3EFF             7      LD  A,0FFH
001BE0 E8D9 3289EF          13      LD  (_DSK),A
001BE3 E8DC 3A84EF          13      LD  A,(_DRIVE)
001BE6 E8DF E603             7      AND 3
001BE8 E8E1 F680             7      OR  080H
001BEA E8E3 6F               4      LD  L,A
001BEB E8E4 26EF             7      LD  H,_CYL0/256
001BED E8E6 3EFF             7      LD  A,0FFH
001BEF E8E8 77               7      LD  (HL),A
001BF0 E8E9 18BE            12      JR  RDFAT1
       E8EB                     GETBPB:
001BF2 E8EB FDE5            15      PUSH    IY
001BF4 E8ED FD2A7CF0        20      LD  IY,(_FATBF) ;BPB
001BF8 E8F1 CDF1EF          17      CALL    _BPB2DPB
001BFB E8F4 FDE1            14      POP IY
001BFD E8F6 D8              11      RET C
001BFE E8F7 CD99EA          17      CALL    CHGDRV2
       E8FA                     RDFAT0X:
001C01 E8FA CDE5E9          17      CALL    RDFATS
001C04 E8FD D8              11      RET C
001C05 E8FE DDBE06           7      CP  (IX+6)      ;DPB_06_FATID
001C08 E901 C8              11      RET Z
001C09 E902 DDCB126E        20      BIT 5,(IX+012H) ;DPB_12_DEVICE
001C0D E906 C0              11      RET NZ      ;BPBを取得している場合はFATIDをチェックしない
001C0E E907 37               4      SCF
001C0F E908 C9              10      RET
                                
       E909                     BPB2DPB:
001C10 E909 FD7E0B          19      LD  A,(IY+11)   ;BPB_BytsPerSec
001C13 E90C B7               4      OR  A
001C14 E90D 37               4      SCF
001C15 E90E C0              11      RET NZ
       E90F                     BPBOK:
001C16 E90F FD7E0D          19      LD  A,(IY+13)   ;BPB_SecPerClus
001C19 E912 DD7707          19      LD  (IX+7),A    ;DPB_07_SECPCL
                                
001C1C E915 FD7E16          19      LD  A,(IY+22)   ;BPB_FATSz16
001C1F E918 DD7700          19      LD  (IX+0),A    ;DPB_00_FATLN
001C22 E91B FD7E17          19      LD  A,(IY+23)   ;BPB_FATSz16
001C25 E91E DD7701          19      LD  (IX+1),A    ;DPB_00_FATLN
                                
001C28 E921 FD6E0E          19      LD  L,(IY+14)   ;BPB_RsvdSecCnt
001C2B E924 FD660F          19      LD  H,(IY+15)
001C2E E927 DD750E          19      LD  (IX+00EH),L ;DPB_0E_FATPS
001C31 E92A FD5E16          19      LD  E,(IY+22)   ;BPB_FATSz16
001C34 E92D FD5617          19      LD  D,(IY+23)
001C37 E930 FD4610          19      LD  B,(IY+16)   ;BPB_NumFATs
       E933                     BPBDP1:             ;BPB_FATSz16 * BPB_NumFATs
001C3A E933 19              11      ADD HL,DE
001C3B E934 10FD            13      DJNZ    BPBDP1
       E936                     BPBDP2:
001C3D E936 DD7510          19      LD  (IX+010H),L ;DPB_10_DIRPS
001C40 E939 DD7411          19      LD  (IX+011H),H
001C43 E93C E5              11      PUSH    HL
                                
001C44 E93D FD6E11          19      LD  L,(IY+17)   ;BPB_RootEntCnt
001C47 E940 FD6612          19      LD  H,(IY+18)
001C4A E943 FD7E0C          19      LD  A,(IY+12)   ;BPB_BytsPerSec
001C4D E946 B7               4      OR  A
001C4E E947 37               4      SCF
001C4F E948 C8              11      RET Z
001C50 E949 0606             7      LD  B,6
       E94B                     BPBBPS1:
001C52 E94B 05               4      DEC B
001C53 E94C 0F               4      RRCA
001C54 E94D 30FC            12      JR  NC,BPBBPS1
       E94F                     BPBDE1:
001C56 E94F 29              11      ADD HL,HL
001C57 E950 10FD            13      DJNZ    BPBDE1
                                
001C59 E952 7C               4      LD  A,H
001C5A E953 DD770B          19      LD  (IX+00BH),A ;DPB_0B_DIRSCNT
                                
001C5D E956 D1              10      POP DE      ;DPB_10_DIRPS
001C5E E957 6C               4      LD  L,H
001C5F E958 2600             7      LD  H,0
001C61 E95A 19              11      ADD HL,DE       ;MAXDIR
001C62 E95B E5              11      PUSH    HL
001C63 E95C FD4E0D          19      LD  C,(IY+13)   ;BPB_SecPerClus
001C66 E95F CB21             8      SLA C       ;*2
001C68 E961 AF               4      XOR A
001C69 E962 47               4      LD  B,A
001C6A E963 ED42            15      SBC HL,BC
001C6C E965 DD7514          19      LD  (IX+014H),L ;DPB_14_ADDCL16
001C6F E968 DD7415          19      LD  (IX+015H),H
                                
001C72 E96B D1              10      POP DE      ;DE=DPB_0B_MAXDIR
001C73 E96C FD6E13          19      LD  L,(IY+19)   ;BPB_TotSec16
001C76 E96F FD6614          19      LD  H,(IY+20)
001C79 E972 7C               4      LD  A,H
001C7A E973 B5               4      OR  L
001C7B E974 3E00             7      LD  A,0     ;LDでフラグは変化しない。BPB_TotSec16を AHL で扱う為、Aに0を入れる
001C7D E976 2010            12      JR  NZ,BPB16BIT ;BPB_TotSec16が「0」の場合はBPB_TotSec32で計算
001C7F E978 FD7E23          19      LD  A,(IY+35)   ;念のために総セクタ数が24ビットを超える場合はエラーを返す
001C82 E97B B7               4      OR  A
001C83 E97C 37               4      SCF
001C84 E97D C0              11      RET NZ
001C85 E97E FD6E20          19      LD  L,(IY+32)   ;BPB_TotSec32 は AHL の24ビットで扱う
001C88 E981 FD6621          19      LD  H,(IY+33)   ;1クラスタの論理セクタ数(DPB_07_SECPCL)が最大128なので
001C8B E984 FD7E22          19      LD  A,(IY+34)   ;24ビットを超えると必ずクラスタ数が16ビットを超えてしまうのでこれで十分
001C8E E987 A7               4      AND A       ;CF=0
       E988                     BPB16BIT:
001C8F E988 ED52            15      SBC HL,DE
001C91 E98A DE00             7      SBC A,0
001C93 E98C FD460D          19      LD  B,(IY+13)   ;BPB_SecPerClus
       E98F                     BPBTC1:             ;総クラスタ数(AHL) = 総セクタ数(AHL) / セクタサイズ(B)
001C96 E98F CB18             8      RR  B       ;->CY
001C98 E991 3808            12      JR  C,BPBTC2
001C9A E993 CB3F             8      SRL A
001C9C E995 CB1C             8      RR  H       ;AHL=AHL/2
001C9E E997 CB1D             8      RR  L
001CA0 E999 18F4            12      JR  BPBTC1
       E99B                     BPBTC2:
001CA2 E99B B7               4      OR  A
001CA3 E99C 37               4      SCF
001CA4 E99D C0              11      RET NZ      ;念のため(クラスタ数が16ビットを超える場合)
001CA5 E99E 23               6      INC HL
001CA6 E99F 23               6      INC HL
001CA7 E9A0 DD7508          19      LD  (IX+8),L    ;DPB_08_MAXCL
001CAA E9A3 DD7409          19      LD  (IX+9),H
                                
001CAD E9A6 FD7E15          19      LD  A,(IY+21)   ;BPB_Media
001CB0 E9A9 DD7706          19      LD  (IX+6),A    ;DPB_06_FATID
                                
001CB3 E9AC DDCB0A7E        20      BIT 7,(IX+00AH) ;DPB_0A_FDMODE
001CB7 E9B0 2817            12      JR  Z,NOT_FD
001CB9 E9B2 2E28             7      LD  L,40        ;MAXCYLの設定（要検討）ここから下はフロッピーのみ書き換える
001CBB E9B4 FEFD             7      CP  0FDH    ;2D
001CBD E9B6 2808            12      JR  Z,SETCYL
001CBF E9B8 2E4D             7      LD  L,77
001CC1 E9BA FEFE             7      CP  0FEH    ;2HD
001CC3 E9BC 2802            12      JR  Z,SETCYL
001CC5 E9BE 2E50             7      LD  L,80    ;その他2DD等
       E9C0                     SETCYL:
001CC7 E9C0 DD750C          19      LD  (IX+00CH),L ;DPB_0C_MAXCYL
001CCA E9C3 FD7E18          19      LD  A,(IY+24)   ;BPB_SecPerTr
001CCD E9C6 DD770D          19      LD  (IX+00DH),A ;DPB_0D_MAXSEC  ;ここまでフロッピー専用
       E9C9                     NOT_FD:
001CD0 E9C9 FD7E10          19      LD  A,(IY+16)   ;BPB_NumFATs
001CD3 E9CC FE02             7      CP  2       ;>2:NC
001CD5 E9CE FD7E0C          19      LD  A,(IY+12)   ;BPB_BytsPerSec
001CD8 E9D1 6F               4      LD  L,A
001CD9 E9D2 3802            12      JR  C,BPBFAT1
001CDB E9D4 F680             7      OR  080H
       E9D6                     BPBFAT1:
001CDD E9D6 DD770F          19      LD  (IX+00FH),A ;DPB_0F_BPS
001CE0 E9D9 7D               4      LD  A,L     ;セクタバッファが1KBしかないので1KBを超える場合はCF=1でエラーにする
001CE1 E9DA FE02             7      CP  2       ;1セクタ512バイト
001CE3 E9DC C8              11      RET Z
001CE4 E9DD FE04             7      CP  4       ;1セクタ1024バイト
001CE6 E9DF C8              11      RET Z
001CE7 E9E0 FE01             7      CP  1       ;1セクタ256バイト
001CE9 E9E2 C8              11      RET Z
001CEA E9E3 37               4      SCF
001CEB E9E4 C9              10      RET
                                
       E9E5                     RDFATS:
001CEC E9E5 CD2BEA          17      CALL    FATSETUP
001CEF E9E8 D8              11      RET C
001CF0 E9E9 CDF5E9          17      CALL    DRD24B
001CF3 E9EC 2A7CF0          16      LD  HL,(_FATBF)
001CF6 E9EF 7E               7      LD  A,(HL)
001CF7 E9F0 C9              10      RET
                                
       E9F1                     DRD16:
001CF8 E9F1 0E00             7      LD  C,0
       E9F3                     DRD24:
001CFA E9F3 0601             7      LD  B,1
       E9F5                     DRD24B:
001CFC E9F5 DDE5            15      PUSH    IX
001CFE E9F7 DD2AA8EF        20      LD  IX,(_DPB)
001D02 E9FB CDD0EC          17  DRDPAT: CALL    FDRD        ;自己書き換え（ディスク読み込み）
       E9FE                     POP_IX_RET:
001D05 E9FE DDE1            14      POP IX
001D07 EA00 C9              10      RET
                                
       EA01                     DWT16:
001D08 EA01 0E00             7      LD  C,0
       EA03                     DWT24:
001D0A EA03 0601             7      LD  B,1
       EA05                     DWT24B:
001D0C EA05 DDE5            15      PUSH    IX
001D0E EA07 DD2AA8EF        20      LD  IX,(_DPB)
001D12 EA0B CD34EC          17  DWTPAT: CALL    FDWT        ;自己書き換え（ディスク書き込み）
001D15 EA0E 18EE            12      JR  POP_IX_RET
                                
       EA10                     WTFAT:
001D17 EA10 CD2BEA          17      CALL    FATSETUP
001D1A EA13 D405EA          17      CALL    NC,DWT24B
001D1D EA16 D8              11      RET C
001D1E EA17 DDCB0F7E        20      BIT 7,(IX+00FH) ;DPB_0F_BPS
001D22 EA1B C8              11      RET Z       ;予備FATが無い
001D23 EA1C CD32EA          17      CALL    FATS2
001D26 EA1F E5              11      PUSH    HL      ;予備FAT
001D27 EA20 DD6E00          19      LD  L,(IX+0)    ;DPB_00_FATLN
001D2A EA23 DD6601          19      LD  H,(IX+1)
001D2D EA26 19              11      ADD HL,DE
001D2E EA27 EB               4      EX  DE,HL
001D2F EA28 E1              10      POP HL
001D30 EA29 18DA            12      JR  DWT24B
                                ;------------------------
                                ;FATのセットアップ
                                ;out
                                ;   B  : FATセクタ数
                                ;   DE : FAT先頭セクタ番号
                                ;   HL : FATバッファポインタ
                                ;   CF : 1=ドライブ切り替えエラー
                                ;note
                                ;   FATサイズがFATバッファを超える場合は
                                ;   対象クラスタ領域==(_FATIX)によって
                                ;   FAT12:対象クラスタ1024毎に1.5KBを切り替える
                                ;   FAT16:対象クラスタ1024毎に2KBを切り替える
                                ;------------------------
       EA2B                     FATSETUP:
001D32 EA2B 3AAAEF          13      LD  A,(_FATDRV)
001D35 EA2E CD3BEB          17      CALL    CHGDRVR     ;ドライブ切り替え
001D38 EA31 D8              11      RET C
       EA32                     FATS2:
001D39 EA32 DD7E0F          19      LD  A,(IX+00FH) ;DPB_0F_BPS 512=2 1024=4
001D3C EA35 0F               4      RRCA
001D3D EA36 CD5FEA          17  FATSX:  CALL    FATSETUP12  ;自己書き換え
001D40 EA39 210000          10      LD  HL,0
001D43 EA3C 4A               4      LD  C,D
001D44 EA3D 54               4      LD  D,H
001D45 EA3E 3AABEF          13      LD  A,(_FATIX)  ;範囲FAT12:0-3/FAT16:0-63(0-03FH):65535*2/2048
001D48 EA41 47               4      LD  B,A
001D49 EA42 04               4      INC B
001D4A EA43 DD7E00          19      LD  A,(IX+0)    ;DPB_00_FATLN
       EA46                     FAT_SKP:
001D4D EA46 05               4      DEC B
001D4E EA47 2805            12      JR  Z,FAT1
001D50 EA49 19              11      ADD HL,DE
001D51 EA4A 93               4      SUB E
001D52 EA4B 30F9            12      JR  NC,FAT_SKP
001D54 EA4D C9              10      RET
       EA4E                     FAT1:
001D55 EA4E EB               4      EX  DE,HL
001D56 EA4F B9               4      CP  C       ;C=FATバッファに読み込めるセクタ数
001D57 EA50 3801            12      JR  C,FAT2
001D59 EA52 79               4      LD  A,C
       EA53                     FAT2:
001D5A EA53 47               4      LD  B,A
                                
001D5B EA54 2AFAF0          16      LD  HL,(_FATPS) ;fat sector pos
001D5E EA57 19              11      ADD HL,DE
001D5F EA58 EB               4      EX  DE,HL
001D60 EA59 2A7CF0          16      LD  HL,(_FATBF)
001D63 EA5C AF               4      XOR A       ;CF=0
001D64 EA5D 4F               4      LD  C,A
001D65 EA5E C9              10      RET
                                ;
                                ;   FATバッファに読み込める最大のセクタ数と_FATIXで進めるセクタ数
                                ;   FATSETUP* (FAT12/FAT16)
                                ;out
                                ;   D : FATバッファに読み込める最大のセクタ数
                                ;   E : _FATIXで進めるセクタ数
       EA5F                     FATSETUP12:
001D66 EA5F 110606          10      LD  DE,0606H    ;256
001D69 EA62 D8              11      RET C
001D6A EA63 110303          10      LD  DE,0303H    ;512
001D6D EA66 0F               4      RRCA
001D6E EA67 D8              11      RET C
001D6F EA68 110102          10      LD  DE,0201H    ;1024
001D72 EA6B C9              10      RET
                                
       EA6C                     FATSETUP16:
001D73 EA6C 110808          10      LD  DE,0808H    ;256
001D76 EA6F D8              11      RET C
001D77 EA70 110404          10      LD  DE,0404H
001D7A EA73 0F               4      RRCA            ;512
001D7B EA74 D8              11      RET C
001D7C EA75 110202          10      LD  DE,0202H    ;1024
001D7F EA78 C9              10      RET
                                
       EA79                     CHGDRV:
001D80 EA79 E5              11      PUSH    HL
001D81 EA7A 2189EF          10      LD  HL,_DSK
001D84 EA7D BE               7      CP  (HL)
001D85 EA7E 280A            12      JR  Z,CHGDRVE
       EA80                     CHGDRV1:
001D87 EA80 DDE5            15      PUSH    IX
001D89 EA82 CD8CEA          17      CALL    CHGDRV0
001D8C EA85 3A89EF          13      LD  A,(_DSK)
001D8F EA88 DDE1            14      POP IX
       EA8A                     CHGDRVE:
001D91 EA8A E1              10      POP HL
001D92 EA8B C9              10      RET
                                
       EA8C                     CHGDRV0:
001D93 EA8C 6F               4      LD  L,A
001D94 EA8D CDDCEF          17      CALL    _GETDPB
001D97 EA90 D8              11      RET C
001D98 EA91 DD22A8EF        20      LD  (_DPB),IX
001D9C EA95 7D               4      LD  A,L
001D9D EA96 3289EF          13      LD  (_DSK),A
       EA99                     CHGDRV2:
001DA0 EA99 C5              11      PUSH    BC
001DA1 EA9A D5              11      PUSH    DE
001DA2 EA9B ED73F0EA        20      LD  (SPPAT2+1),SP
001DA6 EA9F F3               4      DI
001DA7 EAA0 DDF9            10      LD  SP,IX
                                
001DA9 EAA2 E1              10      POP HL      ;DPB_00_FATLN
001DAA EAA3 E1              10      POP HL      ;DPB_02_DRD
001DAB EAA4 22FCE9          16      LD  (DRDPAT+1),HL
                                
001DAE EAA7 E1              10      POP HL
001DAF EAA8 220CEA          16      LD  (DWTPAT+1),HL   ;DPB_04_DWT
                                
001DB2 EAAB E1              10      POP HL      ;L=DPB_06_FATID H=DPB_07_SECPCL
001DB3 EAAC 7C               4      LD  A,H
001DB4 EAAD 3232E1          13      LD  (SPCPAT+1),A    ;1クラスタの論理セクタ数
001DB7 EAB0 3D               4      DEC A
001DB8 EAB1 3298E8          13      LD  (NCPAT+1),A
                                
001DBB EAB4 E1              10      POP HL      ;DPB_08_MAXCL
001DBC EAB5 7D               4      LD  A,L
001DBD EAB6 3251E1          13      LD  (CLPAT2+1),A
001DC0 EAB9 7C               4      LD  A,H
001DC1 EABA 324DE1          13      LD  (CLPAT1+1),A
001DC4 EABD 2B               6      DEC HL
001DC5 EABE 2255E3          16      LD  (MAXCLP+1),HL
                                
001DC8 EAC1 E1              10      POP HL      ;L=DPB_0A_FDMODE H=DPB_0B_DIRSCNT
001DC9 EAC2 7D               4      LD  A,L
001DCA EAC3 F6FE             7      OR  0FEH
001DCC EAC5 3269EF          13      LD  (FDMODE+1),A
001DCF EAC8 07               4      RLCA
001DD0 EAC9 E603             7      AND 3
001DD2 EACB 326BEF          13      LD  (FSPAT+1),A
001DD5 EACE 4C               4      LD  C,H
                                
001DD6 EACF E1              10      POP HL      ;L=DPB_0C_MAXCYL H=DPB_0D_MAXSEC
                                
001DD7 EAD0 E1              10      POP HL      ;L=DPB_0E_FATPS H=DPB_0F_BPS
001DD8 EAD1 7C               4      LD  A,H     ;DPB_0F_BPS
001DD9 EAD2 E607             7      AND 7
001DDB EAD4 321CE6          13      LD  (SECSZ+2),A ;1セクタのサイズの上位1バイト 0x400 - 0x200 - 0x100
                                                ;1セクタ512 2D/2DD/2HC/2HQ(2HD1.44MB)/EMM/BRAM等
                                                ;1セクタ1024 2HD/2HDE98
                                                ;1セクタ256 GRAM/RAMF/CMOS/等
                                                ;1024   512 256
                                                ;4  2   1
001DDE EAD7 87               4      ADD A,A     ;8  4   2
001DDF EAD8 87               4      ADD A,A     ;010H   8   4
001DE0 EAD9 87               4      ADD A,A     ;020H   010H    8
001DE1 EADA 32AEDF          13      LD  (SDECPAT+1),A   ;1セクタ辺りのディレクトリエントリ数
                                
001DE4 EADD 2600             7      LD  H,0
001DE6 EADF 22FAF0          16      LD  (_FATPS),HL
                                
001DE9 EAE2 E1              10      POP HL      ;L=DPB_10_DIRPS
001DEA EAE3 22FCF0          16      LD  (_DIRPS),HL
                                
001DED EAE6 E1              10      POP HL      ;L=DPB_12_DEVICE H=DPB_13_UNITNO
001DEE EAE7 7C               4      LD  A,H
001DEF EAE8 3284EF          13      LD  (_DRIVE),A
                                
001DF2 EAEB E1              10      POP HL      ;DPB_14_ADDCL16
001DF3 EAEC 2242E1          16      LD  (CLSPAT+1),HL
                                
001DF6 EAEF 310000          10  SPPAT2: LD  SP,0        ;元のSPを復元
001DF9 EAF2 FB               4      EI
001DFA EAF3 2AFCF0          16      LD  HL,(_DIRPS)
001DFD EAF6 0600             7      LD  B,0
001DFF EAF8 09              11      ADD HL,BC
001E00 EAF9 22C9DF          16      LD  (MD_PAT+1),HL
                                
001E03 EAFC 2A55E3          16      LD  HL,(MAXCLP+1);
001E06 EAFF 11F60F          10      LD  DE,4086
001E09 EB02 B7               4      OR  A
001E0A EB03 ED52            15      SBC HL,DE
001E0C EB05 300F            12      JR  NC,SETFAT16
001E0E EB07 211EE8          10      LD  HL,GNCL     ;FAT12
001E11 EB0A 1141E8          10      LD  DE,SNCL
001E14 EB0D 015FEA          10      LD  BC,FATSETUP12
001E17 EB10 DDCB0FAE        23      RES 5,(IX+00FH) ;DPB_0F_BPS(FAT12)
001E1B EB14 180D            12      JR  EXTRA1
       EB16                     SETFAT16:
001E1D EB16 2175E8          10      LD  HL,GNCL16   ;FAT16
001E20 EB19 1182E8          10      LD  DE,SNCL16
001E23 EB1C 016CEA          10      LD  BC,FATSETUP16
001E26 EB1F DDCB0FEE        23      SET 5,(IX+00FH) ;DPB_0F_BPS(FAT16)
       EB23                     EXTRA1:
001E2A EB23 22F8EF          16      LD  (GNCPAT+1),HL
001E2D EB26 ED53FBEF        20      LD  (SNCPAT+1),DE
001E31 EB2A ED4337EA        20      LD  (FATSX+1),BC
001E35 EB2E D1              10      POP DE
001E36 EB2F C1              10      POP BC
001E37 EB30 AF               4      XOR A
001E38 EB31 C9              10      RET
                                
       EB32                     GETDPBD:
001E39 EB32 DDE3            23      EX  (SP),IX
001E3B EB34 DDE5            15      PUSH    IX
001E3D EB36 3A88EF          13      LD  A,(_DRV)
001E40 EB39 1807            12      JR  GETDPB1
                                
       EB3B                     CHGDRVR:
001E42 EB3B CDD9EF          17      CALL    _CHGDRV
001E45 EB3E D8              11      RET C
001E46 EB3F 3A89EF          13      LD  A,(_DSK)
       EB42                     GETDPB1:
001E49 EB42 C3DCEF          10      JP  _GETDPB
                                
       EB45                     GETDPB:
001E4C EB45 FE08             7      CP  8
001E4E EB47 3F               4      CCF
001E4F EB48 D8              11      RET C
001E50 EB49 0F               4      RRCA
001E51 EB4A 0F               4      RRCA
001E52 EB4B 0F               4      RRCA
001E53 EB4C DD                      DB  0DDH        ;Z80未定義命令
001E54 EB4D 6F               4      LD  L,A     ;LD IXL,A
001E55 EB4E DD                      DB  0DDH        ;Z80未定義命令
001E56 EB4F 26F1             7      LD  H,DEVICE/256    ;LD IXH,DEVICE/256
001E58 EB51 DD7E00          19      LD  A,(IX+0)    ;DPB_00_FATLN
001E5B EB54 B7               4      OR  A       ;CF=0の為
001E5C EB55 DDCB0F6E        20      BIT 5,(IX+00FH) ;DPB_0F_BPS
001E60 EB59 C0              11      RET NZ      ;FAT16
001E61 EB5A DDCB126E        20      BIT 5,(IX+012H) ;DPB_12_DEVICE
001E65 EB5E C0              11      RET NZ      ;BPB
001E66 EB5F FE01             7      CP  001H        ;A=0 THEN CF=1
001E68 EB61 C9              10      RET
                                
       EB62                     _SYS5F:
001E69 EB62 AF               4      XOR A
       EB63                     FFLUSH:
001E6A EB63 F5              11      PUSH    AF
001E6B EB64 3EFF             7      LD  A,0FFH
001E6D EB66 3239EF          13      LD  (SFILE),A
001E70 EB69 CD5CE7          17      CALL    DWTX
001E73 EB6C 3EFF             7      LD  A,0FFH
001E75 EB6E 32A5EF          13      LD  (_DBDRV),A
001E78 EB71 CDA6E7          17      CALL    WTFATX
001E7B EB74 AF               4      XOR A
001E7C EB75 32ABEF          13      LD  (_FATIX),A
001E7F EB78 2F               4      CPL
001E80 EB79 32AAEF          13      LD  (_FATDRV),A
001E83 EB7C F1              10      POP AF
001E84 EB7D C9              10      RET
                                
[EOF:LDDIO.ASM:SHIFT_JIS]
                                    INCLUDE "88DISK.ASM"
                                
                                ;   LSX-Dodgers DISK
                                ;   PC-8801mkIISR
                                
                                ;   FLOPPY DISK DRIVER
                                ;
                                ;   コマンド送信
       EB7E                     PUTCOM:
001E85 EB7E F5              11      PUSH    AF
001E86 EB7F 3E0F             7      LD  A,00FH
001E88 EB81 D3FF            11      OUT (0FFH),A    ;ディスクサブシステムI/F 8255 コントロール
001E8A EB83 F1              10      POP AF
                                ;   通常ハンドシェイク（ホストが送信）
       EB84                     PUTDAT:
001E8B EB84 F5              11      PUSH    AF
       EB85                     PUTDAT1:
001E8C EB85 DBFE            11      IN  A,(0FEH)    ;ディスクサブシステムI/F 8255 ポートC
001E8E EB87 E602             7      AND 2       ;RFD
001E90 EB89 28FA            12      JR  Z,PUTDAT1
001E92 EB8B 3E0E             7      LD  A,00EH      ;ATN=0
001E94 EB8D D3FF            11      OUT (0FFH),A    ;ディスクサブシステムI/F 8255 コントロール
001E96 EB8F F1              10      POP AF
001E97 EB90 D3FD            11      OUT (0FDH),A    ;標準状態ではサブシステムへのデータ送信ポート
001E99 EB92 F5              11      PUSH    AF
001E9A EB93 3E09             7      LD  A,9     ;DAV=1
001E9C EB95 D3FF            11      OUT (0FFH),A
       EB97                     PUTDAT2:
001E9E EB97 DBFE            11      IN  A,(0FEH)    ;ディスクサブシステムI/F 8255 ポートC
001EA0 EB99 E604             7      AND 4       ;DAC
001EA2 EB9B 28FA            12      JR  Z,PUTDAT2
                                
001EA4 EB9D 3E08             7      LD  A,8     ;DAV=0
001EA6 EB9F D3FF            11      OUT (0FFH),A
       EBA1                     PUTDAT3:
001EA8 EBA1 DBFE            11      IN  A,(0FEH)    ;ディスクサブシステムI/F 8255 ポートC
001EAA EBA3 E604             7      AND 4       ;DAC
001EAC EBA5 20FA            12      JR  NZ,PUTDAT3
001EAE EBA7 F1              10      POP AF
001EAF EBA8 C9              10      RET
                                
                                ;   通常ハンドシェイク（ホストが受信）
       EBA9                     GETDAT:
001EB0 EBA9 3E0B             7      LD  A,00BH      ;RFD=1
001EB2 EBAB D3FF            11      OUT (0FFH),A    ;ディスクサブシステムI/F 8255 コントロール
       EBAD                     GETDAT1:
001EB4 EBAD DBFE            11      IN  A,(0FEH)    ;ディスクサブシステムI/F 8255 ポートC
001EB6 EBAF 0F               4      RRCA            ;DAV
001EB7 EBB0 30FB            12      JR  NC,GETDAT1
                                    
001EB9 EBB2 3E0A             7      LD  A,00AH      ;RFD=0
001EBB EBB4 D3FF            11      OUT (0FFH),A    ;ディスクサブシステムI/F 8255 コントロール
                                    
001EBD EBB6 DBFC            11      IN  A,(0FCH)    ;標準状態ではサブシステムからのデータ受信ポート
001EBF EBB8 F5              11      PUSH    AF
001EC0 EBB9 3E0D             7      LD  A,00DH      ;DAC=1
001EC2 EBBB D3FF            11      OUT (0FFH),A    ;ディスクサブシステムI/F 8255 コントロール
                                
       EBBD                     GETDAT2:
001EC4 EBBD DBFE            11      IN  A,(0FEH)    ;ディスクサブシステムI/F 8255 ポートC
001EC6 EBBF 0F               4      RRCA            ;DAV
001EC7 EBC0 38FB            12      JR  C,GETDAT2
                                
001EC9 EBC2 3E0C             7      LD  A,00CH      ;DAC=0
001ECB EBC4 D3FF            11      OUT (0FFH),A
001ECD EBC6 F1              10      POP AF
001ECE EBC7 C9              10      RET
                                
                                ;   高速ハンドシェイク（ホストが送信）
                                ;   HL:アドレス BC:受信サイズ（必ず偶数にする）
       EBC8                     FPUTDAT:
       EBC8                     FPUTDAT1:
001ECF EBC8 DBFE            11      IN  A,(0FEH)    ;ディスクサブシステムI/F 8255 ポートC
001ED1 EBCA E602             7      AND 2       ;RFD
001ED3 EBCC 28FA            12      JR  Z,FPUTDAT1
001ED5 EBCE 3E0E             7      LD  A,00EH      ;ATN=0
001ED7 EBD0 D3FF            11      OUT (0FFH),A    ;ディスクサブシステムI/F 8255 コントロール
                                
001ED9 EBD2 7E               7      LD  A,(HL)
001EDA EBD3 D3FD            11      OUT (0FDH),A    ;標準状態ではサブシステムへのデータ送信ポート
                                
001EDC EBD5 3E09             7      LD  A,9     ;DAV=1
001EDE EBD7 D3FF            11      OUT (0FFH),A
001EE0 EBD9 23               6      INC HL
001EE1 EBDA 0B               6      DEC BC
       EBDB                     FPUTDAT2:
001EE2 EBDB DBFE            11      IN  A,(0FEH)    ;ディスクサブシステムI/F 8255 ポートC
001EE4 EBDD E604             7      AND 4       ;DAC
001EE6 EBDF 28FA            12      JR  Z,FPUTDAT2
                                
001EE8 EBE1 7E               7      LD  A,(HL)
001EE9 EBE2 D3FD            11      OUT (0FDH),A    ;標準状態ではサブシステムへのデータ送信ポート
                                
001EEB EBE4 3E08             7      LD  A,8     ;DAV=0
001EED EBE6 D3FF            11      OUT (0FFH),A
       EBE8                     FPUTDAT3:
001EEF EBE8 DBFE            11      IN  A,(0FEH)    ;ディスクサブシステムI/F 8255 ポートC
001EF1 EBEA E604             7      AND 4       ;DAC
001EF3 EBEC 20FA            12      JR  NZ,FPUTDAT3
                                
001EF5 EBEE EDA1            16      CPI         ;HL=HL+1 BC=BC-1 BCが0の場合にP/V=0
001EF7 EBF0 EAC8EB          10      JP  PE,FPUTDAT
001EFA EBF3 C9              10      RET
                                
                                
                                ;   高速ハンドシェイク（ホストが受信）
                                ;   HL:アドレス BC:受信サイズ（必ず偶数にする）
       EBF4                     FGETDAT:
001EFB EBF4 3E0B             7      LD  A,00BH      ;RFD=1
001EFD EBF6 D3FF            11      OUT (0FFH),A    ;ディスクサブシステムI/F 8255 コントロール
       EBF8                     FGETDAT1:
001EFF EBF8 DBFE            11      IN  A,(0FEH)    ;ディスクサブシステムI/F 8255 ポートC
001F01 EBFA 0F               4      RRCA            ;DAV
001F02 EBFB 30FB            12      JR  NC,FGETDAT1
                                    
001F04 EBFD 3E0A             7      LD  A,00AH      ;RFD=0
001F06 EBFF D3FF            11      OUT (0FFH),A    ;ディスクサブシステムI/F 8255 コントロール
                                    
001F08 EC01 DBFC            11      IN  A,(0FCH)    ;標準状態ではサブシステムからのデータ受信ポート
001F0A EC03 77               7      LD  (HL),A
                                
001F0B EC04 3E0D             7      LD  A,00DH      ;DAC=1
001F0D EC06 D3FF            11      OUT (0FFH),A    ;ディスクサブシステムI/F 8255 コントロール
001F0F EC08 23               6      INC HL
001F10 EC09 0B               6      DEC BC
       EC0A                     FGETDAT2:
001F11 EC0A DBFE            11      IN  A,(0FEH)    ;ディスクサブシステムI/F 8255 ポートC
001F13 EC0C 0F               4      RRCA            ;DAV
001F14 EC0D 38FB            12      JR  C,FGETDAT2
                                
001F16 EC0F DBFC            11      IN  A,(0FCH)    ;標準状態ではサブシステムからのデータ受信ポート
001F18 EC11 77               7      LD  (HL),A
                                
001F19 EC12 3E0C             7      LD  A,00CH      ;DAC=0
001F1B EC14 D3FF            11      OUT (0FFH),A
                                
001F1D EC16 EDA1            16      CPI         ;HL=HL+1 BC=BC-1 BCが0の場合にP/V=0
001F1F EC18 EAF4EB          10      JP  PE,FGETDAT
001F22 EC1B C9              10      RET
                                
                                ;   論理セクタ番号からトラック番号とセクタ番号を得る
                                ;   in 
                                ;   DE:論理セクタ
       EC1C                     CALC_SECTOR:
001F23 EC1C C5              11      PUSH    BC
001F24 EC1D DD4E0D          19      LD  C,(IX+00DH) ;フロッピーディスクの1トラックのセクタ数(DPB_0D_MAXSEC)
001F27 EC20 0610             7      LD  B,16
001F29 EC22 AF               4      XOR A
001F2A EC23 EB               4      EX  DE,HL
       EC24                     DIV1:
001F2B EC24 29              11      ADD HL,HL
001F2C EC25 8F               4      ADC A,A
001F2D EC26 B9               4      CP  C
001F2E EC27 3802            12      JR  C,DIV2
001F30 EC29 91               4      SUB C
001F31 EC2A 2C               4      INC L
       EC2B                     DIV2:
001F32 EC2B 10F7            13      DJNZ    DIV1
                                
001F34 EC2D 3C               4      INC A   ;最小のセクタは１固定
001F35 EC2E 55               4      LD  D,L ;TRACK
       EC2F                     DIV3:
001F36 EC2F 5F               4      LD  E,A ;SECTOR
001F37 EC30 C1              10      POP BC
001F38 EC31 C9              10      RET
                                
       EC32                     WTTRK:
001F39 EC32 37               4      SCF
001F3A EC33 C9              10      RET
       EC34                     FDWT:
001F3B EC34 E5              11      PUSH    HL
001F3C EC35 D5              11      PUSH    DE
001F3D EC36 CD1CEC          17      CALL    CALC_SECTOR
001F40 EC39 7A               4      LD  A,D     ;トラック
001F41 EC3A 329AEC          13      LD  (FDWT_TRACK),A
001F44 EC3D 7B               4      LD  A,E     ;セクタ
001F45 EC3E 3295EC          13      LD  (FDWT_SECTOR),A
001F48 EC41 DD7E0D          19      LD  A,(IX+00DH) ;フロッピーディスクの1トラックのセクタ数(DPB_0D_MAXSEC)
001F4B EC44 93               4      SUB E
001F4C EC45 3C               4      INC A
001F4D EC46 67               4      LD  H,A
001F4E EC47 D1              10      POP DE
001F4F EC48 3A1CE6          13      LD  A,(SECSZ+2) ;1セクタのサイズの上位1バイト
001F52 EC4B 4F               4      LD  C,A
001F53 EC4C AF               4      XOR A
       EC4D                     FDWT2:
001F54 EC4D 81               4      ADD A,C
001F55 EC4E 13               6      INC DE
001F56 EC4F 05               4      DEC B
001F57 EC50 2807            12      JR  Z,FDWT3
001F59 EC52 25               4      DEC H       ;トラック、ヘッドを跨がない
001F5A EC53 2804            12      JR  Z,FDWT3
001F5C EC55 FE3A             7      CP  03AH        ;バッファとして04000H-07BFFHまで使える
001F5E EC57 38F4            12      JR  C,FDWT2
       EC59                     FDWT3:
001F60 EC59 4F               4      LD  C,A
001F61 EC5A E1              10      POP HL
001F62 EC5B 3E16             7      LD  A,16H       ;高速レシーブメモリ
001F64 EC5D CD7EEB          17      CALL    PUTCOM
001F67 EC60 3E40             7      LD  A,DSS_DATA/256  ;開始アドレスH
001F69 EC62 CD84EB          17      CALL    PUTDAT
001F6C EC65 AF               4      XOR A       ;開始アドレスL
001F6D EC66 CD84EB          17      CALL    PUTDAT
001F70 EC69 79               4      LD  A,C     ;バイト数H
001F71 EC6A CD84EB          17      CALL    PUTDAT
001F74 EC6D AF               4      XOR A       ;バイト数L
001F75 EC6E CD84EB          17      CALL    PUTDAT
001F78 EC71 C5              11      PUSH    BC
001F79 EC72 41               4      LD  B,C
001F7A EC73 0E00             7      LD  C,0
001F7C EC75 CDC8EB          17      CALL    FPUTDAT
001F7F EC78 C1              10      POP BC
001F80 EC79 3E0D             7      LD  A,0DH       ;エグゼキュート
001F82 EC7B CD7EEB          17      CALL    PUTCOM
001F85 EC7E 3E7C             7      LD  A,WRITEDISKEX/256
001F87 EC80 CD84EB          17      CALL    PUTDAT
001F8A EC83 3EAB             7      LD  A,WRITEDISKEX%256
001F8C EC85 CD84EB          17      CALL    PUTDAT
001F8F EC88 DD7E13          19      LD  A,(IX+013H) ;デバイスドライバ内におけるユニット番号(DPB_13_UNITNO)
001F92 EC8B CD84EB          17      CALL    PUTDAT
001F95 EC8E DD7E0D          19      LD  A,(IX+00DH) ;フロッピーディスクの1トラックのセクタ数(DPB_0D_MAXSEC)
001F98 EC91 CD84EB          17      CALL    PUTDAT
       EC95                     FDWT_SECTOR EQU $+1
001F9B EC94 3E00             7      LD  A,0     ;セクタ
001F9D EC96 CD84EB          17      CALL    PUTDAT
       EC9A                     FDWT_TRACK  EQU $+1
001FA0 EC99 3E00             7      LD  A,0     ;トラック
001FA2 EC9B CD84EB          17      CALL    PUTDAT
001FA5 EC9E DD7E0A          19      LD  A,(IX+00AH) ;フロッピーディスクのモード(DPB_0A_FDMODE)
001FA8 ECA1 CD84EB          17      CALL    PUTDAT
001FAB ECA4 3A1CE6          13      LD  A,(SECSZ+2) ;1セクタのサイズの上位1バイト
001FAE ECA7 CD84EB          17      CALL    PUTDAT
001FB1 ECAA 79               4      LD  A,C
001FB2 ECAB CD84EB          17      CALL    PUTDAT      ;バイト数H
001FB5 ECAE DD7E0C          19      LD  A,(IX+$0C)  ;フロッピーディスクのシリンダ数(DPB_0C_MAXCYL)
001FB8 ECB1 CD84EB          17      CALL    PUTDAT
                                
001FBB ECB4 3E0D             7      LD  A,0DH       ;エグゼキュート
001FBD ECB6 CD7EEB          17      CALL    PUTCOM
001FC0 ECB9 3E7D             7      LD  A,RESULTEX/256
001FC2 ECBB CD84EB          17      CALL    PUTDAT
001FC5 ECBE 3E39             7      LD  A,RESULTEX%256
001FC7 ECC0 CD84EB          17      CALL    PUTDAT
                                
001FCA ECC3 CDA9EB          17      CALL    GETDAT
001FCD ECC6 4F               4      LD  C,A
001FCE ECC7 FE01             7      CP  1
001FD0 ECC9 D8              11      RET C
                                
001FD1 ECCA 78               4      LD  A,B
001FD2 ECCB B7               4      OR  A
001FD3 ECCC C234EC          10      JP  NZ,FDWT
001FD6 ECCF C9              10      RET
                                
       ECD0                     FDRD:
001FD7 ECD0 7A               4      LD  A,D
001FD8 ECD1 B3               4      OR  E
001FD9 ECD2 200E            12      JR  NZ,FDRD1
                                                ;初期化
001FDB ECD4 AF               4      XOR A       ;イニシャライズ
001FDC ECD5 CD7EEB          17      CALL    PUTCOM
001FDF ECD8 3E17             7      LD  A,017H      ;セットサーフィスモード
001FE1 ECDA CD7EEB          17      CALL    PUTCOM
001FE4 ECDD 3E07             7      LD  A,7     ;Bit3～Bit0 0:片面 1:両面
001FE6 ECDF CD84EB          17      CALL    PUTDAT
       ECE2                     FDRD1:
001FE9 ECE2 3E0D             7      LD  A,0DH       ;エグゼキュート
001FEB ECE4 CD7EEB          17      CALL    PUTCOM
001FEE ECE7 3E7C             7      LD  A,READDISKEX/256
001FF0 ECE9 CD84EB          17      CALL    PUTDAT
001FF3 ECEC AF               4      XOR A
001FF4 ECED CD84EB          17      CALL    PUTDAT
001FF7 ECF0 DD7E13          19      LD  A,(IX+013H) ;デバイスドライバ内におけるユニット番号(DPB_13_UNITNO)
001FFA ECF3 CD84EB          17      CALL    PUTDAT
001FFD ECF6 DD7E0D          19      LD  A,(IX+00DH) ;フロッピーディスクの1トラックのセクタ数(DPB_0D_MAXSEC)
002000 ECF9 CD84EB          17      CALL    PUTDAT
002003 ECFC E5              11      PUSH    HL
002004 ECFD D5              11      PUSH    DE
002005 ECFE CD1CEC          17      CALL    CALC_SECTOR
002008 ED01 7B               4      LD  A,E     ;セクタ
002009 ED02 CD84EB          17      CALL    PUTDAT
00200C ED05 7A               4      LD  A,D     ;トラック
00200D ED06 CD84EB          17      CALL    PUTDAT
002010 ED09 DD7E0D          19      LD  A,(IX+00DH) ;フロッピーディスクの1トラックのセクタ数(DPB_0D_MAXSEC)
002013 ED0C 93               4      SUB E
002014 ED0D 3C               4      INC A
002015 ED0E 67               4      LD  H,A
002016 ED0F D1              10      POP DE
002017 ED10 DD7E0A          19      LD  A,(IX+00AH) ;フロッピーディスクのモード(DPB_0A_FDMODE)
00201A ED13 CD84EB          17      CALL    PUTDAT
00201D ED16 3A1CE6          13      LD  A,(SECSZ+2) ;1セクタのサイズの上位1バイト
002020 ED19 CD84EB          17      CALL    PUTDAT
002023 ED1C 4F               4      LD  C,A
002024 ED1D AF               4      XOR A
       ED1E                     FDRD2:
002025 ED1E 81               4      ADD A,C
002026 ED1F 13               6      INC DE
002027 ED20 05               4      DEC B
002028 ED21 2807            12      JR  Z,FDRD3
00202A ED23 25               4      DEC H       ;トラック、ヘッドを跨がない
00202B ED24 2804            12      JR  Z,FDRD3
00202D ED26 FE3A             7      CP  03AH        ;バッファとして04000H-07BFFHまで使える
00202F ED28 38F4            12      JR  C,FDRD2
       ED2A                     FDRD3:
002031 ED2A E1              10      POP HL
002032 ED2B 4F               4      LD  C,A
002033 ED2C CD84EB          17      CALL    PUTDAT      ;バイト数H
002036 ED2F DD7E0C          19      LD  A,(IX+$0C)  ;フロッピーディスクのシリンダ数(DPB_0C_MAXCYL)
002039 ED32 CD84EB          17      CALL    PUTDAT
                                
00203C ED35 3E0D             7      LD  A,0DH       ;エグゼキュート
00203E ED37 CD7EEB          17      CALL    PUTCOM
002041 ED3A 3E7D             7      LD  A,RESULTEX/256
002043 ED3C CD84EB          17      CALL    PUTDAT
002046 ED3F 3E39             7      LD  A,RESULTEX%256
002048 ED41 CD84EB          17      CALL    PUTDAT
                                
00204B ED44 CDA9EB          17      CALL    GETDAT
00204E ED47 4F               4      LD  C,A
00204F ED48 FE01             7      CP  1
002051 ED4A D8              11      RET C
                                
002052 ED4B 3E15             7      LD  A,15H       ;高速センドメモリ
002054 ED4D CD7EEB          17      CALL    PUTCOM
002057 ED50 3E40             7      LD  A,DSS_DATA/256  ;開始アドレスH
002059 ED52 CD84EB          17      CALL    PUTDAT
00205C ED55 AF               4      XOR A       ;開始アドレスL
00205D ED56 CD84EB          17      CALL    PUTDAT
002060 ED59 79               4      LD  A,C     ;バイト数H
002061 ED5A CD84EB          17      CALL    PUTDAT
002064 ED5D AF               4      XOR A       ;バイト数L
002065 ED5E CD84EB          17      CALL    PUTDAT
002068 ED61 C5              11      PUSH    BC
002069 ED62 41               4      LD  B,C
00206A ED63 0E00             7      LD  C,0
00206C ED65 CDF4EB          17      CALL    FGETDAT
00206F ED68 C1              10      POP BC
002070 ED69 78               4      LD  A,B
002071 ED6A B7               4      OR  A
002072 ED6B C2E2EC          10      JP  NZ,FDRD1
002075 ED6E C9              10      RET
                                
       EF68                     FDMODE  EQU BEEPD+7
       EF6A                     FSPAT   EQU BEEPD+9
                                
[EOF:88DISK.ASM:UTF_8]
                                
                                    INCLUDE "88TABLE.ASM"
                                
                                ;   LSX-Dodgers TABLE キーのテーブル
                                
       ED6F                     AT_TABLE:
002076 ED6F                         DS  TABLEAD-AT_TABLE
       EDC8                     EXTSP:
                                
       EDC8                     KEY_TABLE:
0020CF EDC8 3031323334353637        DB  '0','1','2','3','4','5','6','7' ;0
0020D7 EDD0 38392A2B3D2E2C0D        DB  '8','9','*','+','=','.',',',0DH ;1
0020DF EDD8 4061626364656667        DB  '@','a','b','c','d','e','f','g' ;2
0020E7 EDE0 68696A6B6C6D6E6F        DB  'h','i','j','k','l','m','n','o' ;3
0020EF EDE8 7071727374757677        DB  'p','q','r','s','t','u','v','w' ;4
0020F7 EDF0 78797A5B5C5D5E2D        DB  'x','y','z','[',5CH,']','^','-' ;5
0020FF EDF8 3031323334353637        DB  '0','1','2','3','4','5','6','7' ;6
002107 EE00 38393A3B2C2E2F5C        DB  '8','9',':',';',',','.','/',5CH ;7
00210F EE08 0C1E1C0800000000        DB  0CH,1EH,1CH,08H,00H,00H,00H,00H ;8
002117 EE10 030000000000201B        DB  03H,00H,00H,00H,00H,00H,' ',1BH ;9
00211F EE18 091F1D00002D2F00        DB  09H,1FH,1DH,00H,00H,'-','/',00H ;A
002127 EE20 0000000000000000        DB  00H,00H,00H,00H,00H,00H,00H,00H ;B
00212F EE28 0000000000081208        DB  00H,00H,00H,00H,00H,08H,12H,08H ;C
                                
       EE30                     SHIFT_TABLE:
002137 EE30 3031323334353637        DB  '0','1','2','3','4','5','6','7' ;0
00213F EE38 38392A2B3D2E2C0D        DB  '8','9','*','+','=','.',',',0DH ;1
002147 EE40 4041424344454647        DB  '@','A','B','C','D','E','F','G' ;2
00214F EE48 48494A4B4C4D4E4F        DB  'H','I','J','K','L','M','N','O' ;3
002157 EE50 5051525354555657        DB  'P','Q','R','S','T','U','V','W' ;4
00215F EE58 58595A7B7C7D7E3D        DB  'X','Y','Z','{','|','}','~','=' ;5
002167 EE60 3021222324252627        DB  '0','!','"','#','$','%','&',27H ;6
00216F EE68 28292A2B3C3E3F5F        DB  '(',')','*','+','<','>','?','_' ;7
002177 EE70 0B1E1C0800000000        DB  0BH,1EH,1CH,08H,00H,00H,00H,00H ;8
00217F EE78 030000000000201B        DB  03H,00H,00H,00H,00H,00H,' ',1BH ;9
002187 EE80 091F1D00002D2F00        DB  09H,1FH,1DH,00H,00H,'-','/',00H ;A
00218F EE88 0000000000000000        DB  00H,00H,00H,00H,00H,00H,00H,00H ;B
002197 EE90 0000000000081208        DB  00H,00H,00H,00H,00H,08H,12H,08H ;C
                                
       EE98                     CTRL_TABLE:
00219F EE98 3031323334353637        DB  '0','1','2','3','4','5','6','7' ;0
0021A7 EEA0 38392A2B3D2E2C0D        DB  '8','9','*','+','=','.',',',0DH ;1
0021AF EEA8 4001020304050607        DB  '@',01H,02H,03H,04H,05H,06H,07H ;2
0021B7 EEB0 08090A0B0C0D0E0F        DB  08H,09H,0AH,0BH,0CH,0DH,0EH,0FH ;3
0021BF EEB8 1011121314151617        DB  10H,11H,12H,13H,14H,15H,16H,17H ;4
0021C7 EEC0 18191A5B5C5D5E2D        DB  18H,19H,1AH,'[',5CH,']','^','-' ;5
0021CF EEC8 3031323334353637        DB  '0','1','2','3','4','5','6','7' ;6
0021D7 EED0 38393A3B2C2E2F5F        DB  '8','9',':',';',',','.','/','_' ;7
0021DF EED8 0C1E1C0800000000        DB  0CH,1EH,1CH,08H,00H,00H,00H,00H ;8
0021E7 EEE0 030000000000201B        DB  03H,00H,00H,00H,00H,00H,' ',1BH ;9
0021EF EEE8 091F1D00002D2F00        DB  09H,1FH,1DH,00H,00H,'-','/',00H ;A
0021F7 EEF0 0000000000000000        DB  00H,00H,00H,00H,00H,00H,00H,00H ;B
0021FF EEF8 0000000000081208        DB  00H,00H,00H,00H,00H,08H,12H,08H ;C
[EOF:88TABLE.ASM:SHIFT_JIS]
                                    INCLUDE "LDWORK.ASM"
                                
                                ;   LSX-Dodgers WORK0
                                ;
                                ;   CP/M互換BIOS
                                ;   BOOT:アドレス下位1バイトが0になるように
       EF00                     AT_WORK:
002207 EF00                         DS  WORKAD-AT_WORK
                                
       EF00                     CPM_BOOT:
002207 EF00 C30000          10      JP  0
       EF03                     _SYS00:     ;(BDOS)プログラム終了
       EF03                     CPM_WBOOT:
00220A EF03 C309D0          10      JP  WBOOT1
       EF06                     CPM_CONST:
00220D EF06 C38CD9          10      JP  CONSTX
       EF09                     _SYS07:     ;(BDOS)コンソール直接入力
       EF09                     CPM_CONIN:
002210 EF09 C344D9          10      JP  FLGET
       EF0C                     CPM_CONOUT:
002213 EF0C C3C7DB          10      JP  CONOUT1
                                
       EF0F                     DECBF:
002216 EF0F                         DS  5
00221B EF14 00                  FDRV    DB  0
00221C EF15                     FNAME   DS  36
002240 EF39                     SFILE:  DS  33      ;DRV FILENAME
002261 EF5A                     HLBUF:  DS  3       ;Random record buffer
                                
002264 EF5D 0000                LEFTX:  DW  0
002266 EF5F 0000                DTAX:   DW  0
                                
       EF61                     ZERO:
       EF61                     BEEPD:
002268 EF61 008E01000B000C10        DB  0,08EH,1,0,00BH,0,00CH,010H
002270 EF69 073E08100D00FF          DB  007H,03EH,008H,010H,00DH,0,0FFH
       EF62                     RTC_YY  EQU BEEPD+1
       EF63                     RTC_MW  EQU BEEPD+2
       EF64                     RTC_DD  EQU BEEPD+3
       EF65                     RTC_TT  EQU BEEPD+4
       EF66                     RTC_MM  EQU BEEPD+5
       EF67                     RTC_SS  EQU BEEPD+6
                                
002277 EF70 00                  CHECK:  DB  0
                                
002278 EF71 4F4B24              OK: DB  "OK$"
00227B EF74                         DS  5
002280 EF79 4572726F722124      COMERM: DB  "Error!$"
                                ;   システムワークエリア
                                ;   _CYL0:アドレス下位1バイトが080Hになるように
002287 EF80 FF                  _CYL0:  DB  0FFH    ;Cylinder
002288 EF81 FF                  _CYL1:  DB  0FFH    ;Cylinder
002289 EF82 FF                  _CYL2:  DB  0FFH    ;Cylinder
00228A EF83 FF                  _CYL3:  DB  0FFH    ;Cylinder
00228B EF84 00                  _DRIVE: DB  0   ;unit number
00228C EF85 00                  _SEEKSP:DB  0   ;Seek speed
00228D EF86 FF                  _ISEEK: DB  0FFH    ;
00228E EF87 00                  _DVSW:  DB  0
00228F EF88 00                  _DRV:   DB  0
002290 EF89 FF                  _DSK:   DB  0FFH
002291 EF8A 8000                _DTA:   DW  00080H
002293 EF8C 0000                _CTC:   DW  0
002295 EF8E 0000                _TXADR: DW  0
002297 EF90 0000                _KEYPS: DW  0
002299 EF92 00FF                _KEYD:  DW  0FF00H  ;キーデータ
00229B EF94 C210                _KEYSP: DW  010C2H
00229D EF96 00                  _COLORF:DB  COLORF  ;色
00229E EF97 18                  _LINE:  DB  LINE
                                
00229F EF98 0000                _FCB:   DW  0
0022A1 EF9A 0000                _FBPS:  DW  0   ;SEARCH FILES
0022A3 EF9C 0000                _FBAD:  DW  0   ;    //
0022A5 EF9E 00                  _FBCNT: DB  0   ;    //
0022A6 EF9F 00                  _FILEN: DB  0
0022A7 EFA0 00                  _DIRF:  DB  0   ;bit7:ディレクトリ bit0-6:セクタインデックス
0022A8 EFA1                         DS  1
0022A9 EFA2 00                  _WTFATF:DB  0   ;FATバッファの更新フラグ
0022AA EFA3                         DS  1
0022AB EFA4 00                  _WTDBF: DB  0   ;データバッファの更新フラグ
0022AC EFA5 FF                  _DBDRV: DB  0FFH    ;データバッファにあるデータを読み込んだドライブ
0022AD EFA6 0000                _DBSEC: DW  0   ;データバッファにあるデータを読み込んだセクタ番号
0022AF EFA8 0000                _DPB:   DW  0
       EFAA                     _FATDRV:
0022B1 EFAA FF                      DB  0FFH    ;FATバッファに読み込んでいるドライブ
0022B2 EFAB 00                  _FATIX: DB  0   ;FATバッファに読み込んでいるインデックス
       EFAC                     _FAKEFREE:
0022B3 EFAC 0000                    DW  0   ;偽の残量（FATサイズが大きくなると重くなるのでその対策）
                                
0022B5 EFAE                         DS  2
                                
       EFB0                     CRTCD:  
0022B7 EFB0 6F                      DB  06FH
       EFB1                     _WIDTH: 
0022B8 EFB1 50                      DB  WIDTH
       EFB2                     TVRAMTOP:
0022B9 EFB2 5938                    DB  059H,038H
0022BB EFB4 1F02                    DB  01FH,002H
       EFB6                     _LINE2:
0022BD EFB6 19                      DB  019H
0022BE EFB7 1C                      DB  01CH
       EFB8                     WKE4:
0022BF EFB8 00                      DB  000H
       EFB9                     WK40:
0022C0 EFB9 07                      DB  007H
       EFBA                     _PAGE_MINUS:
0022C1 EFBA 80F8                    DW  0-WIDTH*LINE
       EFBC                     _WIDTH_MINUS:
0022C3 EFBC B0FF                    DW  0-WIDTH
       EFBE                     WK30:
0022C5 EFBE 0C                      DB  00CH
       EFBF                     WK31:
       EFBF                     WK1FD0:
0022C6 EFBF 20                      DB  020H
                                
0022C7 EFC0 0000                CTC0:   DW  INTCTCE
0022C9 EFC2 0000                CTC1:   DW  INTCTCE
0022CB EFC4 0000                CTC2:   DW  INTCTC2
0022CD EFC6 0000                CTC3:   DW  INTCTCE
0022CF EFC8 0000                INTVEC: DW  INT
                                
                                ;   LSX-Dodgers 独自BIOS
                                
0022D1 EFCA C303DD          10  _INKEY: JP  INKEY
0022D4 EFCD C3C5DA          10  _PRINT: JP  PRINT
0022D7 EFD0 C38EDD          10  _SCRN:  JP  SCRN
0022DA EFD3 C3A5DC          10  _POS:   JP  POS
0022DD EFD6 C30DDB          10  _LOC:   JP  LOC
       EFD9                     _CHGDRV:
0022E0 EFD9 C379EA          10      JP  CHGDRV
       EFDC                     _GETDPB:
0022E3 EFDC C345EB          10      JP  GETDPB
       EFDF                     _FFLUSH:
0022E6 EFDF C363EB          10      JP  FFLUSH
       EFE2                     _RDFATX:
0022E9 EFE2 C37CE7          10      JP  RDFATX
0022EC EFE5 C3A4E8          10  _RDFAT: JP  RDFAT
0022EF EFE8 C332EC          10  _WTTRK: JP  WTTRK
0022F2 EFEB C3D0EC          10  _FDRD:  JP  FDRD
0022F5 EFEE C334EC          10  _FDWT:  JP  FDWT
       EFF1                     _BPB2DPB:
0022F8 EFF1 C309E9          10      JP  BPB2DPB
0022FB EFF4                         DS  3
       EFF7                     _GNCL:
0022FE EFF7 C31EE8          10  GNCPAT: JP  GNCL        ; self-modifying code
       EFFA                     _SNCL:
002301 EFFA C341E8          10  SNCPAT: JP  SNCL        ; self-modifying code
002304 EFFD C34CD0          10  _COMANL:JP  COMANL
                                
       F000                     _WE:
[EOF:LDWORK.ASM:SHIFT_JIS]
                                    INCLUDE "LDCALL.ASM"
                                
                                ;   LSX-Dodgers システムコール(BDOS)
                                ;
                                ;   LSX-Dodgers SYSTEM CALL
                                ;   STABLE:アドレス下位1バイトが0になるように
                                
       F000                     STABLE:
                                ;0
002307 F000 03EF18D924D9DBDF        DW  _SYS00,_SYS01,_SYS02,_SYS03
00230F F008 23D623D629D909EF        DW  _SYS04,_SYS05,_SYS06,_SYS07
002317 F010 31D925D658D984D9        DW  _SYS08,_SYS09,_SYS0A,_SYS0B
00231F F018 3AD63FD64ED661D6        DW  _SYS0C,_SYS0D,_SYS0E,_SYS0F
                                ;1
002327 F020 B5D6FCD645D77BD7        DW  _SYS10,_SYS11,_SYS12,_SYS13
00232F F028 83D7A1D7BED7B6D7        DW  _SYS14,_SYS15,_SYS16,_SYS17
002337 F030 19D81ED823D829D8        DW  _SYS18,_SYS19,_SYS1A,_SYS1B
00233F F038 23D64FD823D653D8        DW  _SYS1C,_SYS1D,_SYS1E,_SYS1F
                                ;2
002347 F040 23D6F5D707D85AD8        DW  _SYS20,_SYS21,_SYS22,_SYS23
00234F F048 86D823D62FE414E5        DW  _SYS24,_ERROR,_SYS26,_SYS27
002357 F050 07D88FD89DD9DBDF        DW  _SYS28,_SYS5C,_SYS2A,_SYS2B
00235F F058 C4D9DBDF23D6B2D8        DW  _SYS2C,_SYS2D,_SYS2E,_SYS2F
                                ;3
002367 F060 ACD823D623D623D6        DW  _SYS30,_ERROR,_ERROR,_ERROR
00236F F068 23D623D623D623D6        DW  _ERROR,_ERROR,_ERROR,_ERROR
002377 F070 23D6DBDFDBDFD3D8        DW  _ERROR,_SYS39,_SYS3A,_SYS5A
                                ;DOS2
00237F F078 06D6                    DW  _DOS2
                                
002381 F07A                         DS  2
002383 F07C 00F2                _FATBF: DW  FATBF
002385 F07E 00FA                _DTBUF: DW  DTBUF
                                
                                ;   コントロールコードテーブル
                                ;   CTRLTB:アドレス下位1バイトが080Hになるように
                                
       F080                     CTRLTB:
002387 F080 10DB10DB47DB50DC        DW  CTRL00,CTRL00,CTRL02,CTRL03 ;  A,B,C
00238F F088 4ADC72DB23DCEFDB        DW  CTRL04,CTRL05,CTRL06,CTRL07 ;D,E,F,G
002397 F090 17DB3CDB53DC9EDB        DW  CTRL08,CTRL09,CTRL0A,CTRL0B ;H,I,J,K
00239F F098 20DC91DB5ADC10DB        DW  CTRL0C,CTRL0D,CTRL0E,CTRL00 ;L,M,N,O
0023A7 F0A0 10DB10DB96DB10DB        DW  CTRL00,CTRL00,CTRL12,CTRL00 ;P,Q,R,S
0023AF F0A8 10DB10DB10DB10DB        DW  CTRL00,CTRL00,CTRL00,CTRL00 ;T,U,V,W
0023B7 F0B0 10DB10DB20DCA5DB        DW  CTRL00,CTRL00,CTRL0C,CTRL1B ;X,Y,Z,ESC
0023BF F0B8 F9DA1EDB33DB53DC        DW  CTRL1C,CTRL1D,CTRL1E,CTRL1F ;→,←,↑,↓
                                
0023C7 F0C0                         DS  02AH
                                
0023F1 F0EA 1617                SDDATA: DB  22,23       ;(FCB)ファイルを最後に変更した時刻
0023F3 F0EC 1415                    DB  20,21       ;(FCB)ファイルを最後に変更した日付
0023F5 F0EE 1A1B                    DB  26,27       ;(FCB)ファイルの先頭クラスタ
0023F7 F0F0 10111213                DB  16,17,18,19 ;(FCB)ファイルのサイズ(バイト単位)
       F0F4                     SDDATAE:
                                
0023FB F0F4                     SCDIR:  DS  2       ;+14 +15
0023FD F0F6                     SFBPS:  DS  2       ;FBPS
0023FF F0F8                     SFNDF:  DS  2       ;FILEN DIRF
                                
002401 F0FA 0000                _FATPS: DW  0
002403 F0FC 0000                _DIRPS: DW  0
002405 F0FE 0000                _CLPS:  DW  0
                                
       F100                     _PE:
[EOF:LDCALL.ASM:SHIFT_JIS]
                                    INCLUDE "88DPB.ASM"
                                
                                ;   LSX-Dodgers DPB
                                ;   PC-8801mkIISR
                                
       F100                     DEVICE:
                                
                                ;   A:
                                
002407 F100 0200                    DW  2   ;DPB_00_FATLN
002409 F102 EBEF                    DW  _FDRD   ;DPB_02_DRD
00240B F104 EEEF                    DW  _FDWT   ;DPB_04_DWT
00240D F106 FD                      DB  0FDH    ;DPB_06_FATID
00240E F107 02                      DB  2   ;DPB_07_SECPCL
00240F F108 6401                    DW  356 ;DPB_08_MAXCL
002411 F10A FF                      DB  0FFH    ;DPB_0A_FDMODE  0FFH=2D / 0FEH=2HD
002412 F10B 07                      DB  7   ;DPB_0B_DIRSCNT
002413 F10C 28                      DB  40  ;DPB_0C_MAXCYL
002414 F10D 09                      DB  9   ;DPB_0D_MAXSEC  Number of sectors
002415 F10E 01                      DB  1   ;DPB_0E_FATPS
002416 F10F 82                      DB  082H    ;DPB_0F_BPS
002417 F110 0500                    DW  5   ;DPB_10_DIRPS
002419 F112 A7                      DB  0A7H    ;DPB_12_DEVICE  Device Number
00241A F113 00                      DB  0   ;DPB_13_UNITNO
00241B F114 0800                    DW  8   ;DPB_14_ADDCL16
00241D F116 0000                    DW  0   ;DPB_16
00241F F118 0000                    DW  0   ;DPB_18
002421 F11A 0000                    DW  0   ;DPB_1A_SDIR
002423 F11C 46444430                DB  "FDD0"  ;DPB_1C_NAME
                                
                                ;   B:
                                
002427 F120 0200                    DW  2   ;DPB_00_FATLN
002429 F122 EBEF                    DW  _FDRD   ;DPB_02_DRD
00242B F124 EEEF                    DW  _FDWT   ;DPB_04_DWT
00242D F126 FD                      DB  0FDH    ;DPB_06_FATID
00242E F127 02                      DB  2   ;DPB_07_SECPCL
00242F F128 6401                    DW  356 ;DPB_08_MAXCL
002431 F12A FF                      DB  0FFH    ;DPB_0A_FDMODE  0FFH=2D / 0FEH=2HD
002432 F12B 07                      DB  7   ;DPB_0B_DIRSCNT
002433 F12C 28                      DB  40  ;DPB_0C_MAXCYL
002434 F12D 09                      DB  9   ;DPB_0D_MAXSEC  Number of sectors
002435 F12E 01                      DB  1   ;DPB_0E_FATPS
002436 F12F 82                      DB  082H    ;DPB_0F_BPS
002437 F130 0500                    DW  5   ;DPB_10_DIRPS
002439 F132 A7                      DB  0A7H    ;DPB_12_DEVICE  Device Number
00243A F133 01                      DB  1   ;DPB_13_UNITNO
00243B F134 0800                    DW  8   ;DPB_14_ADDCL16
00243D F136 0000                    DW  0   ;DPB_16
00243F F138 0000                    DW  0   ;DPB_18
002441 F13A 0000                    DW  0   ;DPB_1A_SDIR
002443 F13C 46444431                DB  "FDD1"  ;DPB_1C_NAME
                                
                                ;   C:
                                
002447 F140                         DS  32
                                
                                ;   D:
                                
002467 F160                         DS  32
                                
                                ;   E:
                                
002487 F180                         DS  32
                                
                                ;   F:
                                
0024A7 F1A0 0000                BANKFL: DW  0   ;DPB_00_FATLN
0024A9 F1A2 9CD5                    DW  BDRD    ;DPB_02_DRD
0024AB F1A4 98D5                    DW  BDWT    ;DPB_04_DWT
0024AD F1A6 F9                      DB  0F9H    ;DPB_06_FATID
0024AE F1A7 02                      DB  2   ;DPB_07_SECPCL
0024AF F1A8 0000                BANKCL: DW  0   ;DPB_08_MAXCL
0024B1 F1AA 00                      DB  0   ;DPB_0A_FDMODE
0024B2 F1AB 08                      DB  8   ;DPB_0B_DIRSCNT
0024B3 F1AC 00                      DB  0   ;DPB_0C_MAXCYL
0024B4 F1AD 01                      DB  1   ;DPB_0D_MAXSEC
0024B5 F1AE 00                      DB  0   ;DPB_0E_FATPS
0024B6 F1AF 02                      DB  2   ;DPB_0F_BPS
0024B7 F1B0 0200                    DW  2   ;DPB_10_DIRPS
0024B9 F1B2 0B                      DB  00BH    ;DPB_12_DEVICE
0024BA F1B3 00                      DB  0   ;DPB_13_UNITNO
0024BB F1B4 0600                    DW  6   ;DPB_14_ADDCL16
0024BD F1B6 0000                    DW  0   ;DPB_16
0024BF F1B8 0000                    DW  0   ;DPB_18
0024C1 F1BA 0000                    DW  0   ;DPB_1A_SDIR
0024C3 F1BC 454D454D                DB  "EMEM"  ;DPB_1C_NAME
                                
                                ;   G:
                                
0024C7 F1C0                         DS  32
                                
                                ;   H:
0024E7 F1E0                         DS  32-8
0024FF F1F8 00                      DB  0
[EOF:88DPB.ASM:UTF_8]
                                
       F1F9                     LAST_ADR:
                                
                                    END
[EOF:88.ASM:UTF_8]
